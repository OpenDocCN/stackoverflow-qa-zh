# StackOverflow 问答 000592000-000592999

# javascript - HTML 中 JavaScript 的正确内容类型是什么？

> ID：592001
> 
> 赞同：0
> 
> 时间：2009-02-26T19:15:06.953
> 
> 标签：javascript, html, xhtml

如果有的话，我应该在 HTML 内的内联 JavaScript 块中使用什么内容类型？

```
application/x-javascript
text/javascript 
```

或者是其他东西？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-26T19:18:50.127

根据您要使用“text/javascript”[的标准](http://www.w3.org/TR/REC-html40/interact/scripts.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-26T19:23:19.460

除此之外，[`application/javascript`JavaScript 的官方 MIME 类型](http://www.ietf.org/rfc/rfc4329.txt)，大多数浏览器只接受`text/javascript`或忽略`type`属性值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-26T19:18:42.873

文本/javascript

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T19:22:44.457

在通过一些标准链接之后，我来到了描述脚本媒体类型的[RFC 4329 。](http://www.rfc-editor.org/rfc/rfc4329.txt)它统计“text/javascript”已过时，并说您现在应该使用“application/javascript”。

编辑：显然**没有版本**的 Internet Explorer 支持“应用程序/javascript”，请参阅：[https://connect.microsoft.com/IE/feedback/ViewFeedback.aspx?FeedbackID=338278](https://connect.microsoft.com/IE/feedback/ViewFeedback.aspx?FeedbackID=338278)。因此，即使“应用程序/javascript”根据标准是正确的，我想您也需要使用 text/javascript 来弥补微软损坏的浏览器（像往常一样）。

# asp.net - 尝试发布到 Web 服务时出现 405 方法不允许错误

> ID：592005
> 
> 赞同：2
> 
> 时间：2009-02-26T19:16:38.837
> 
> 标签：asp.net, jquery, wcf, json

我借用了以下代码来尝试使启用 ajax 的 WCF 服务工作，因为我不断收到 405 method not allowed 错误：

```
$('#btnSave').click(function (e) {
  $.ajax({
    type: "POST",
    url: "AjaxWcf.svc/ConnectionTest",
    contentType: "application/json; charset=utf-8",
    data: '{"name":"Elemenex"}',
    dataType: "json",
    success: function (msg) {
      alert(msg.d);
    },
    error: AjaxFailed
  });

  function AjaxFailed(result) {
    alert(result.status + ' ' + result.statusText);
  }
}); 
```

在服务代码隐藏中，我有以下内容：

```
<OperationContract()> _
<WebInvoke(Method:="POST")> _

Public Function ConnectionTest(ByVal name As String) As String
    Return String.Format("Hello {0}", name)
End Function 
```

我看到今天整天在网上上下搜索，试图找出问题所在。我已经看到`.svc`没有与 IIS 中的 POST 动词映射的帖子。它不在我的开发 PC 上，但在服务器上。两者都给出 405 错误。

这可能与允许的动词有关`web.config`吗？

到目前为止，我有一个漂亮的网站，并且（很快）完成这项工作真的会给人留下好印象。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T19:25:32.390

您的`web.config`服务模型中有这条线吗？

```
<serviceHostingEnvironment aspNetCompatibilityEnabled="true">
</serviceHostingEnvironment> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T19:32:33.213

您需要将此属性添加到您的方法中：

```
ScriptMethodAttribute 
```

# .net - 我的图像很模糊！为什么 WPF 的 SnapsToDevicePixels 不起作用？

> ID：592017
> 
> 赞同：167
> 
> 时间：2009-02-26T19:19:21.810
> 
> 标签：.net, wpf, image, xaml

我在我的 WPF 应用程序中使用了一些图像。

XAML：

```
<Image Name="ImageOrderedList"
       Source="images/OrderedList.png"
       ToolTip="Ordered List"
       Margin="0,0,5,5"
       Width="20"
       Height="20"
       SnapsToDevicePixels="True"
       MouseUp="Image_MouseUp"
       MouseEnter="Image_MouseEnter"
       MouseLeave="Image_MouseLeave" /> 
```

但是，它们看起来很模糊。

为什么那条`SnapsToDevicePixels="True"`线不能防止这个问题？

* * *

## 回答 #1

> 赞同：246
> 
> 时间：2010-04-29T02:30:26.090

您可能需要考虑尝试**WPF4**中现在可用的新属性。`RenderOptions.BitmapScalingMode`将其留给*HighQuality*或只是不声明它。

*NearestNeighbor*对我有用，只是在放大应用程序时会导致位图出现锯齿状。它似乎也没有解决图标以奇怪的方式调整大小的任何故障。

在您的根元素（即您的主窗口）上添加此属性：`UseLayoutRounding="True"`.

以前仅在 Silverlight 中可用的属性现在已修复所有位图大小问题。:)

* * *

## 回答 #2

> 赞同：78
> 
> 时间：2009-02-26T21:33:54.000

我没有使用`SnapsToDevicePixels`，而是使用了`RenderOptions.BitmapScalingMode`，它们现在又好又脆！

XAML：

```
<Image Name="ImageOrderedList"
       Source="images/OrderedList.png"
       ToolTip="Ordered List"
       Margin="0,0,5,5"
       Width="20"
       Height="20"
       RenderOptions.BitmapScalingMode="NearestNeighbor"
       MouseUp="Image_MouseUp"
       MouseEnter="Image_MouseEnter"
       MouseLeave="Image_MouseLeave" /> 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2010-05-04T14:24:21.393

+1 扎克·彼得森

我正在使用 .Net 3.5 sp1，它看起来是处理大量模糊图像的最简单的解决方案。就地指定 RenderOptions 并不是什么大问题，但对于 3rd-party 组件，应用级资源中的样式是有意义的：

```
 <Style TargetType="{x:Type Image}">
    <Setter
        Property="RenderOptions.BitmapScalingMode"
        Value="NearestNeighbor" />
 </Style> 
```

当 AvalonDock 开始渲染模糊图标时效果很好。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2012-01-23T14:51:15.103

`UseLayoutRounding="True"`在许多情况下，在根窗口上使用都可以，但在使用*WPF 功能区*控件时遇到了问题。我的应用程序依赖于根据用户正在执行的操作显示的上下文选项卡，当我将 设置为`UseLayoutRounding`时`True`，上下文选项卡不会显示，RibbonButton 的图像也不会显示。此外，应用程序冻结了几秒钟，CPU 风扇开始唱歌。

在我的图像上使用`RenderOptions.BitmapScalingMode="NearestNeighbor"`可以纠正图像渲染问题（模糊和裁剪图像），并且与功能区上下文选项卡的使用完全兼容。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-06T20:22:45.167

RenderOptions.BitmapScalingMode="NearestNeighbor" 在大多数情况下运行良好。但是，有时您会遇到图形故障（在我的情况下，5 张图像中有 4 张显示良好，但第五张在右边缘有轻微变形）。我修复了它，将图像控件的右边距增加 1。

如果仍然不能解决问题，请尝试 EugeneZ 提到的上面的 Bitmap 类控件。它是 Image 控件的替代品，到目前为止它对我来说效果很好。请参阅[http://blogs.msdn.com/dwayneneed/archive/2007/10/05/blurry-bitmaps.aspx](http://blogs.msdn.com/dwayneneed/archive/2007/10/05/blurry-bitmaps.aspx)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2016-05-28T10:01:02.450

使用**UseLayoutRounding=True**到应用程序中最顶层的元素

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-04-06T20:31:18.703

确保将图像保存在与 WPF 应用程序相同的 DPI 中，某些图像格式将此信息存储为元数据。我不知道这是否能解决问题，但我遇到了一些问题，因为调整到 100% 的图像比预期的更大或更小。

可能是类似的东西。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-26T19:26:44.430

我相信这是一个错误（或者至少是）。查看此[Microsoft 支持电子邮件交换](http://www.developersdex.com/csharp/message.asp?p=1111&r=6274860)页面，了解一些修复它的想法。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-06-29T20:39:24.553

我发现 RenderOptions.BitmapScalingMode="NearestNeighbor" 对我不起作用。我正在使用带有 DirectX 9.0c 的 Windows XP x32。由于 WPF 的实际渲染是使用 DirectX 完成的，因此这可能会产生影响。我确实使用以下注册表项为 XP 启用了抗锯齿功能：

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Avalon.Graphics] "MaxMultisampleType"=dword:00000004 "EnableDebugControl"=dword:00000001

但是，使用这些设置关闭 aa 对图像没有影响。我认为这只会影响 3D 视口。

最后，我发现 TextBlocks 的文本和图像都会出现模糊。并且模糊只发生在某些文本块和图像上，而不是全部。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2013-09-14T16:24:01.213

我发现建议的解决方法的组合都无法解决我看似随机的图像模糊问题。我喜欢许多其他人无法升级到 .net 4 才能使用该`UseLayoutRendering`属性。

我发现工作：

*   确保您的 [原始] 图像尺寸是 2 的倍数。这似乎可以防止一些时髦的图像缩放问题。
*   有时我还发现将图像上的边距调整一个或 2 个像素可以防止这个问题。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-26T19:24:43.653

阅读问题时，我的第一个想法是，您是否将图像放大了太多，但是查看您拥有的应用程序图像似乎并非如此。

第二个想法是调色板，但黑色作为无法正确渲染的颜色之一，这不太可能。

如果你能完全排除以上两个，我目前很难过。

作为实验，您可以尝试其他图形格式，但 PNG 应该没问题。我将不得不考虑更多以提出更好的答案。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-03-17T09:17:14.570

我尝试使用 RenderOptions.BitmapScalingMode=HighQuality，似乎在 Windows 8.1 中会导致一些问题，所以我所做的是通过名为 PngOut.exe 的工具运行它们

[http://advsys.net/ken/utils.htm](http://advsys.net/ken/utils.htm)

这减少了 png 的标题，也减少了大小，但不改变图像质量。

现在我所有的图像都是完美的！:-)

# asp.net-mvc - 实现 ASP.NET MVC 视图引擎进行预处理

> ID：592022
> 
> 赞同：2
> 
> 时间：2009-02-26T19:21:21.853
> 
> 标签：asp.net-mvc, viewengine

我想实现一个 ASP.NET MVC 视图引擎来执行原始 .aspx/.ascx 的一些预处理。文件。然后，我想将结果传递给默认视图引擎（通常是 WebForm 视图引擎）。

这意味着，默认的视图引擎不应该从磁盘读取这个文件，因为它还没有被处理。相反，我希望 View Engine 从输入流中读取输入。

这可能吗？我应该创建一个映射到这个预处理视图引擎的新文件扩展名吗？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-09T19:38:00.800

您将需要创建一个自定义视图引擎来读取 aspx 文件，根据需要修改它们，然后将它们传递给某个构建提供程序。使用`WebFormsViewEngine`该类`System.Web.Complilation.BuildManager`来构建 aspx 文件。您将遇到的问题是`BuildManager`唯一接受虚拟路径，它不接受流或字符串。这意味着您可能还必须创建自己的构建管理器。在命名空间中四处寻找`System.Web.Compilcation`，看看是否能找到任何可能有帮助的东西。以下是一些可能为您指明正确方向的来源。

[这](http://aspnet.codeplex.com/SourceControl/changeset/view/21528#266536)可能是一个有用的资源。

# java - 如何摆脱 GWT 应用程序内部框架上的双滚动条

> ID：592024
> 
> 赞同：1
> 
> 时间：2009-02-26T19:22:18.543
> 
> 标签：java, javascript, css, gwt, scroll

作为将遗留应用程序移植到 GWT 的一部分，我们需要将现有的 JSP 嵌入到 GWT 应用程序中。其中许多页面都很长，导致出现双滚动条——一个用于主应用程序的窗口，另一个用于框架的内容。我想摆脱内部滚动条，只在主窗口上有普通的浏览器滚动条。如果我可以获得渲染内容的高度（整个可滚动区域），我可以设置我的框架上的高度以匹配这个，但我看不到我会从哪里获得这些信息。

**编辑**：澄清一下，GWT 是主要的应用导航，并使用 iframe ( `com.google.gwt.user.client.ui.Frame`) 嵌入遗留内容。我要做的是使页面足够大，以使封闭的框架不需要滚动条；只有主机页面会滚动。如果有任何方法可以确定框架的“可滚动区域”，我可以动态调整主页的大小以适应它。

**第二次编辑**：我最终或多或少地遵循了 Jack M 的建议。但是我没有使用 HTTPRequest，而是使用了 RequestBuilder，这使它变得很容易。我想走这条手动抓取 HTML 的路线，而不是从一开始就使用框架，但由于必须“修复”托管页面中的 URL 而受到阻碍；如果用户“点击”托管的 HTML，则必须修补许多相对 URL 实例才能正常工作。使历史导航与此一起工作也有点痛苦。稍微清理一下代码后，我会尝试将其发布到人们可以获取的地方，因为我确信这一定是人们将现有应用程序迁移到 GWT 的常见用例。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-04T17:51:52.267

我能想到的完全解决此问题的最简单方法是不使用 Frame 元素，而是使用[HTMLPanel](http://google-web-toolkit.googlecode.com/svn/javadoc/1.5/index.html?overview-summary.html)与[HTTPRequest](http://google-web-toolkit.googlecode.com/svn/javadoc/1.5/com/google/gwt/user/client/HTTPRequest.html)结合。这种方法增加了 RPC 调用的复杂性，但[HTMLPanel](http://google-web-toolkit.googlecode.com/svn/javadoc/1.5/index.html?overview-summary.html)很简单`<div>`，其中包含内容。因此，它可以扩展和/或联系您的 JSP 内容。最终结果将是两个页面的无缝集成。

Google 自己[的 JSON](http://code.google.com/webtoolkit/tutorials/1.5/JSON.html#http)示例有很好的用于发出 HTTP 请求的示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-03T15:41:25.647

[阅读本文，它很可能会解决您的问题](http://www.howtocreate.co.uk/tutorials/javascript/browserwindow)

它解释了如何在 JavaScript 中获取窗口的大小并管理它的滚动。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T20:05:57.393

将 GWT 嵌入旧 JSP 是否有意义？将 <div id="for.gwt"/> 放在 JSP 的某处，然后导入 JS。

不清楚您是如何将 JSP 嵌入 GWT 中的，抱歉。

我想知道框架内的 document.body.clientHeight 之类的东西会帮助你吗？

# interpolation - 哪种多元插值方法最适合实际使用？

> ID：592026
> 
> 赞同：11
> 
> 时间：2009-02-26T19:22:38.793
> 
> 标签：interpolation

在 Peter Alfred 关于多元分散数据插值的[文章](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.35.2949)中，他提到，从各种方案中，只有少数方案真正受到从业者的欢迎。例如，他命名为 Shepard 方法和 Hardy Multiquadrics。但是那篇文章到现在已经快 20 年了，真正有趣的是现在广泛使用的方法。

如果您有使用一些空间插值方案的经验，请告诉它。

UPD：为了让这个问题更具竞争力，我重申了它。它是“您曾经使用过哪些多元插值方法？”

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-08T11:43:29.203

（这会很长，除非我已经筋疲力尽了。）

首先，关于非分散数据的一些评论。（参见引用 littleCMS 的答案）

有两种常见的颜色插值。几年前，三线性插值（张量积线性插值）是颜色表插值的常用方法。三线性插值确实可以实现为一组顺序的一维插值，首先在一个轴上，然后沿着第二个轴，等等。

许多年前，我们都意识到，当应用于某些类型的变换时，三线性插值会在彩色成像中引入伪影。问题出现在中立者身上。一种解决方案是通过将立方体分解为 6 ​​个四面体来移动到 3-d 中的单纯插值。在 n 维中，单位立方体将被分解为阶乘 (n) 单纯形。立方体还有其他剖析，但这种特殊样式确保主对角线始终是所有单纯形的共享边。当应用于某些颜色查找表时，这反过来又恢复了中性色的良好行为。

现在让我进入真正分散数据插值的问题。

其他人提到了各种方案。克里金法、多二次法、基于距离的方法是少数。（当我过去用这些方案做一些工作时，我实际上更喜欢逆多二次方法。）所有这些实际上只是径向基函数方法的变体，一种常见的方案。RBF 方法有其优点和缺点。它们通常会生成一个平滑的插值，这当然取决于选择的具体基函数，以及您是否选择限制支持。RBF 方法还允许您进行外推，至少在径向基元素的支持将延伸的范围内。如果允许基础元素的范围是无限的，则不会应用任何明确的外推约束。（一般来说，外推是一件坏事。) RBF 方法的一个问题是它们需要求解大型线性方程组，而这些方程组通常是密集矩阵。这意味着问题的大小，就您可以处理的数据点数量而言，往往受到线性代数的限制。相反，如果您通过截断基元素来限制支持，那么矩阵可能会变得稀疏。如果您对解决方案使用稀疏矩阵包，这将改善线性代数。同时，支撑距离成为您必须控制的非线性参数。同样，像多二次和逆多二次方法这样的方法可能有一个次要的非线性参数来控制基本元素的形状。克里金法也有类似的问题，我会将所有这些方法放在一起。这些方程组通常是密集矩阵。这意味着问题的大小，就您可以处理的数据点数量而言，往往受到线性代数的限制。相反，如果您通过截断基元素来限制支持，那么矩阵可能会变得稀疏。如果您对解决方案使用稀疏矩阵包，这将改善线性代数。同时，支撑距离成为您必须控制的非线性参数。同样，像多二次和逆多二次方法这样的方法可能有一个次要的非线性参数来控制基本元素的形状。克里金法也有类似的问题，我会将所有这些方法放在一起。这些方程组通常是密集矩阵。这意味着问题的大小，就您可以处理的数据点数量而言，往往受到线性代数的限制。相反，如果您通过截断基元素来限制支持，那么矩阵可能会变得稀疏。如果您对解决方案使用稀疏矩阵包，这将改善线性代数。同时，支撑距离成为您必须控制的非线性参数。同样，像多二次和逆多二次方法这样的方法可能有一个次要的非线性参数来控制基本元素的形状。克里金法也有类似的问题，我会将所有这些方法放在一起。就您可以处理的数据点数量而言，往往受到线性代数的限制。相反，如果您通过截断基元素来限制支持，那么矩阵可能会变得稀疏。如果您对解决方案使用稀疏矩阵包，这将改善线性代数。同时，支撑距离成为您必须控制的非线性参数。同样，像多二次和逆多二次方法这样的方法可能有一个次要的非线性参数来控制基本元素的形状。克里金法也有类似的问题，我会将所有这些方法放在一起。就您可以处理的数据点数量而言，往往受到线性代数的限制。相反，如果您通过截断基元素来限制支持，那么矩阵可能会变得稀疏。如果您对解决方案使用稀疏矩阵包，这将改善线性代数。同时，支撑距离成为您必须控制的非线性参数。同样，像多二次和逆多二次方法这样的方法可能有一个次要的非线性参数来控制基本元素的形状。克里金法也有类似的问题，我会将所有这些方法放在一起。支撑距离成为您必须控制的非线性参数。同样，像多二次和逆多二次方法这样的方法可能有一个次要的非线性参数来控制基本元素的形状。克里金法也有类似的问题，我会将所有这些方法放在一起。支撑距离成为您必须控制的非线性参数。同样，像多二次和逆多二次方法这样的方法可能有一个次要的非线性参数来控制基本元素的形状。克里金法也有类似的问题，我会将所有这些方法放在一起。

对于这些问题，我归类为 RBF 变体的所有这些方法通常都受限于它们可以轻松处理的点数。根据您处理事物的方式和可用内存量，该限制通常可能在几千点左右。

RBF 方法的一般类的另一个问题是我称之为内插的问题。这是我多年前创建的一个新词，用于描述跨数据中相对较大的洞的插值。事实上，即使在数据中的较小孔进行插值时，也可能经常出现问题。这些方法，因为它们在某种程度上是平滑的，可能会在插值表面中引入不需要的极值（大的峰或谷）。即使是一维插值，这也是一个常见问题，通常被视为具有三次样条或多项式插值的环形伪影，并且肯定会在傅里叶级数插值中看到。更高维度的问题甚至是承认它确实发生了，因为在超过三个维度上绘制曲面往往很困难。

如果您的分数超过该限制，或者如果这些振铃伪影是不可接受的，那么其他方法通常是更好的选择。如果您愿意使用线性插值，那么在更高维度上最简单的解决方案是从数据的细分开始。因此，在 3 维中，将数据（通常是 delaunay 细分）细分为四面体。这是相当有效的，为此可以找到许多工具。然后，插入任何单个点是一个简单的问题。只需识别该点所在的单纯形，计算重心坐标作为单纯形内的插值权重，并在找到的单纯形的每个顶点处形成函数值的相应线性组合。这一切都非常快速和高效。

这些基于曲面细分的方法的一个缺点是它们通常将您限制在数据点的凸包中，而且更糟糕的是，如果您的数据恰好位于非凸域中，那么插值可能会在某些区域做奇怪的事情你的域名。我上面提到的方案的另一个问题是插值只能是分段线性的，但是一旦你进入更高的维度，事情就会变得非常糟糕。可以找到其他基于曲面细分的平滑插值方法，但它们会花费更多的精力，因此不太常见。

基本的权衡在这里应该是显而易见的。如果您需要一个平滑的插值并且只有几个点，那么通常会选择 RBF 方法。它们简单、易于使用等。实际选择的方法通常只是为了方便，甚至是习惯。如果我以前使用过一种工具并且很高兴，我可能会再次对它感到满意。由于问题是哪种方法“最适合实际使用”，我会指出，当脱离上下文应用时，最好是一个非常主观的词。您在插值问题中的目标是什么？你拥有什么技能？您知道如何使用哪组工具？你会在什么环境下工作？所有这些因素都会影响您选择最佳方法。

如果您有很多数据点，并且速度至关重要，但最终的平滑度并不那么重要，那么您通常会寻找单纯插值。当然，如果你有足够的积分，那么野兽的分段线性性质就不那么重要了。这里的分段线性插值在某些情况下具有很大的优点，即它永远不会在您的表面中生成数据中不存在的极值。对于某些问题，例如颜色表征，这是至关重要的。

另一个问题是噪音。虽然噪声的存在通常表明需要进行某种平滑处理，但并非所有此类表面都应用了平滑处理。任何平滑运算符有时也会平滑数据的重要特征。发生这种情况是因为我们可以将平滑算子视为低通滤波器。高频行为通常是噪音，但它也可能只是我表面上的一个尖锐的脚趾或肩膀，我不能失去。如果这是一个问题，那么即使有时存在明显的噪声，您也可能愿意使用插值法。在这种情况下，我建议最简单、最低阶的插值是最好的。一个平滑的、更全局的插值也倾向于放大数据中的任何噪声，所以如果你在存在噪声的情况下寻找最低方差的插值，

当然，薄板样条有很多种，插值或非插值。一旦你超越了一个维度，你的选择也会扩大，至少如果你愿意做这项工作的话。

在它变成一本书之前，我会在这里结束。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-26T20:20:53.207

我过去使用过[克里金法](http://en.wikipedia.org/wiki/Kriging)，其分散的数据伴随着每个样本的准确度估计。似乎是一种强大的技术，值得在地统计学世界之外更广泛地使用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-06-29T12:53:00.990

（一年后）见 [inverse-distance-weighted-idw-interpolation-with-python](https://stackoverflow.com/questions/3104781/inverse-distance-weighted-idw-interpolation-with-python)，一个反距离加权和 scipy.spatial.KDTree 的组合。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-26T20:15:43.487

我见过的唯一应用程序是[littleCMS](http://www.littlecms.com/)代码（一种开源色彩管理引擎）中的应用程序。

我第一次检查它时，它只是在一个轴上进行线性插值，然后在该结果和另一个轴上的点之间进行插值。我刚刚重新下载了它，并且似乎更加复杂。无法与您提到的文章进行比较，但可能想检查一下，它在`cmslut.c`文件中。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-02T05:36:55.623

我使用平滑 3D 分散数据进行表面操作[LINK](http://www.sciencedirect.com/science?_ob=ArticleURL&_udi=B6TYR-42G756X-5&_user=10&_rdoc=1&_fmt=&_orig=search&_sort=d&view=c&_acct=C000050221&_version=1&_urlVersion=0&_userid=10&md5=d1c250fd440ddd058ca1d51828ffd143)。这涉及到很多点，我想要一个非常光滑的表面，所以这个过程首先找到了一个最适合数据的二阶表面，然后是一个松弛阶段，将这些点拟合到表面上。这不是原始数据的插值表面，而是一种以优化方式降低插值阶数的方法。

该方法涉及对非常适合二阶近似的分段区域进行操作。

该方法的另一个有趣特征是这些点是三角形的顶点，并且在平滑过程中保持了连通性。

# c - MSP 430 显示错误值

> ID：592029
> 
> 赞同：3
> 
> 时间：2009-02-26T19:23:08.603
> 
> 标签：c, embedded, msp430

我正在开发压力测量装置。我使用过 MSP430F133 芯片并使用 IAR 嵌入式工作台。它以 3 个不同的单位显示压力。

我正在采集 32 个样本并取平均值。P5上的单位选择，根据单位选择的输出值计算并显示在LCD上。

现在一个单元“IN WC”显示输入的二进制平均值，仅用于分析。

问题：默认单位（MM WC）值显示正确，但在测试情况下，当压力释放时，它会下降并且 LCD 读数如下

```
+31.8
+31.7
+31.6
+31.5
+31.4
+31.3
+31.2
+31.2
+31.1
+31.5 (wrong reading randomly between *.4 to *.7)
+30.9 
```

如您所见，显示了一个错误的值，我无法找出原因。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T20:06:10.590

在下面的代码中 ptiveValue = value 和 d1 = value 所以 d2 总是 0 然后在你的循环中你有 for (i=0; i<= 3||res[i]!='\0'; i++) 这应该是for (i=0; i<= 3&&res[i]!='\0'; i++) 所以它总是打印出缓冲区中剩下的内容而不是你想要的

错误代码：

```
if (cntd <= 4)
{
    d2 = (unsigned int) abs((ptiveValue - d1) * 10000); // get 4 digits of real part
    itoa1(d2, res, &cntreal);  
    for (i=0; i<= 3||res[i]!='\0'; i++)
    {
       wr_lcd_dr(res[i]);

    }
 } 
```

固定代码

```
if (cntd <= 4)
{   
    // get 4 digits of real part
    d2 = (unsigned int) ((ptiveValue - (unsigned int)(d1)) * 10000); 
    itoa1(d2, res, &cntreal);  
    for (i=0; (i<= 3) && (res[i]!='\0'); i++)
    {
       wr_lcd_dr(res[i]);     
    }
 } 
```

您还覆盖了缓冲区并可能产生奇怪的行为。

```
unsigned short Adcinb[32];
for (i = 0; i <= 63; i++)
Adcinb[i] = 3180; 
```

应该

```
unsigned short Adcinb[32];
for (i = 0; i < 32; i++)
Adcinb[i] = 3180; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T12:06:25.563

不幸的是，源代码的两个链接都不再有效。但据我所知，原因可能是这个地方预期的“正确”最后一位数字为零。我的猜测是在计算或可视化代码的某个地方，这个零被错误地视为停止条件，并导致在其位置显示一个随机数字。（仅向输出提供“31”，但向显示器发送 3 位数字）

上面的 '||'/'&&' 问题表明代码不是很直接，如果其余部分也是如此，则此处的错误停止条件和那里的固定长度循环可能会导致此问题。

只是一个“疯狂的猜测”（TM），但我可以在不知道实际代码的情况下给出最好的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T19:44:16.150

这看起来很可疑，|| 可能应该是&&：

```
 for (i=0; i<= 3||res[i]!='\0'; i++) 
```

但我不明白它是如何导致你的问题的。

此外，您应该清理和简化您的代码。因为它很难阅读。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-12T02:53:03.190

我将继续建议您可以尝试的一种 ADC 101 解决方案。根据您使用的传感器类型，您可能需要执行自己的去弹跳以清理样本读数。我过去曾参考过这篇文章，发现它对学习这项技术很有帮助：[Jack G. Ganssle 的去弹跳指南](http://www.google.com/url?sa=t&rct=j&q=debouncing&source=web&cd=5&ved=0CFUQFjAE&url=http%3A%2F%2Fwww.eng.utah.edu%2F~cs5780%2Fdebouncing.pdf&ei=wBknUL2HC7So0AHnn4CgDg&usg=AFQjCNEppSfSIc313thRdgXgoWieieFjFw&cad=rja)！

就像我之前所说的，虽然这是假设您的硬件需要去弹跳，但该指南应该可以帮助您识别这一点。即使您不需要它，您也可能会觉得它很有趣！

附加：你知道我建议这样做的原因是你提到在释放压力时出现了奇怪的读数。在基于机械的开关和传感器的驱动过程中，采样中的去抖动误差很明显。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T20:21:03.630

查看您的代码，我看不出您获得该值的任何特定原因，除非它反映了所感知的实际值。

你能运行程序并在对有问题的数字、之前的数字和之后的数字进行平均之前输出 32 个值中的每一个吗？

或者，每次获得样本时写下新样本并将数据提供给我们。

-亚当

# java - ImageIO.write 不保存为 gif，但适用于 jpgs 和 pngs？

> ID：592032
> 
> 赞同：5
> 
> 时间：2009-02-26T19:23:25.063
> 
> 标签：java, javax.imageio

我怀疑这里的解决方案可能真的很简单，但我很难过......

```
// Create the buffered image.
BufferedImage bufferedImage = new BufferedImage(w,h,BufferedImage.TYPE_INT_RGB);

// fill image data (works fine)
ImageIO.write(bufferedImage, "JPG", f1); // works fine
ImageIO.write(bufferedImage, "PNG", f2); // works fine
ImageIO.write(bufferedImage, "GIF", f3); // this returns false, creates a broken gif file, but fires no exceptions 
```

`ImageIO.write()`不适用于 GIF ？这是某种对 gif 作为专有 Compuserve 事物的回归吗？还是我只是愚蠢（我猜这是最后一个:)）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T19:59:49.983

要扩展 Iny 的答案：

基本上，您应该做的不是另存为 gif。GIF 是一个 256 色托盘图像（因此它的文件很小）。如果您的图像有超过 256 种颜色，您需要在尝试保存之前将颜色降低到 256。编码器不会为你做这件事，因为它不知道该怎么做。它可能开始写入图像，一旦超过 256 色，就会退出。

我认为你可以这样做（伪代码）

```
// Create the buffered image.
BufferedImage bufferedImage = new BufferedImage(w,h,BufferedImage.TYPE_INT_RGB);

... //fill image data (works fine)

ImageIO.write(bufferedImage, "JPG", f1); // works fine

ImageIO.write(bufferedImage, "PNG", f2); //works fine

// downsample to lower color depth by using BYTE_RGB?
BufferedImage crappyImage = new BufferedImage(w,h,BufferedImage.TYPE_BYTE_RGB);
crappyImage.getGraphics().drawImage(bufferedImage, 0, 0, w, h, null);
// or you could repeat the drawing code above with less colors

if (!ImageIO.write(crappyImage , "GIF", f3))
{
   //still too many colors
   f3.delete();
   showError( "Could not save as gif, image had too many colors" );
} 
```

如果您的绘图代码使用抗锯齿看起来不错，那将增加颜色深度而无需您考虑。例如，在白色背景上绘制一条 AA 的蓝色对角线看起来是 2 种颜色，Color.WHITE 和 Color.BLUE，但如果你仔细观察，你会发现一大堆蓝色阴影可以去掉对角线的锯齿状外观。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T19:28:58.310

[http://java.sun.com/javase/6/docs/api/javax/imageio/package-summary.html#gif_plugin_notes](http://java.sun.com/javase/6/docs/api/javax/imageio/package-summary.html#gif_plugin_notes)

请注意，GIF 只能存储 256 种颜色。

# c# - 为什么 resharper 提出以下建议？

> ID：592035
> 
> 赞同：7
> 
> 时间：2009-02-26T19:25:11.033
> 
> 标签：c#, resharper

我的代码是...

```
public static void AssertNotNull<T>(string name, T val) {
    if (val == null)
        throw new ArgumentNullException(String.Format("{0} must not be null", name));
} 
```

Resharper 推荐...

```
public static void AssertNotNull<T>(string name, T val) {
    if (Equals(val, default(T)))
        throw new ArgumentNullException(String.Format("{0} must not be null", name));
} 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-26T19:26:20.907

因为它不知道`T`是值类型还是引用类型，所以它使代码可以同时使用两者。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-26T19:27:45.537

我支持 Berado 的回答，但要补充一点，您可以通过添加以下约束来防止这种情况：

```
public static void AssertNotNull<T>(string name, T val) where T : class 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-26T19:30:06.730

在这种情况下，这显然*不是*您想要的，但它只是试图提供帮助，确保您不会因为忘记引用类型可用于`T`. 就像[@Michael Meadows](https://stackoverflow.com/questions/592035/why-is-resharper-making-the-following-recommendation/592044#592044)所说，您可能希望将`class`约束添加到`T`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T19:29:43.050

这两种方法是不等价的。第一个允许 AssertNotNull( "foo", 0 ) 而第二个抛出。我认为 Resharper 在这种情况下过于热心了。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T19:30:29.693

我想是因为 T 可能是非引用类型。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T20:13:20.950

如果您知道 T 将始终是一个类，则添加一个 where 子句来说明，那么您的原始代码就可以了。

```
public static void AssertNotNull<T>(string name, T val)
    where T : class
    {
        if (val == null)
            throw new ArgumentNullException(String.Format("{0} must not be null", name));
    } 
```

# sql - 从临时表更新表

> ID：592038
> 
> 赞同：2
> 
> 时间：2009-02-26T19:26:09.580
> 
> 标签：sql, sql-server

我有一个存储处方药物信息的表格，需要每天从中央处方更新。临时表与药物表相同。临时表数据可能与主表相同（并且在大多数情况下都是），或者它可能具有更新的行或新行。

我有一个存储过程来更新主表，但它失败了，因为它不会更新 NULL 行（如果临时表中有新行）。

这是一个 MSSQL Server 2005。

我在哪里错了：

```
 -- Insert statements for procedure here
UPDATE [RX_Billing].[dbo].[FS_Drug]
SET [TRADENAME] = [RX_Billing].[dbo].[FS_Drug_TEMP].[TRADENAME]
  ,[CDM] = [RX_Billing].[dbo].[FS_Drug_TEMP].[CDM]
  ,[NDC] = [RX_Billing].[dbo].[FS_Drug_TEMP].[NDC]
  ,[IP_COST] = [RX_Billing].[dbo].[FS_Drug_TEMP].[IP_COST]
  ,[OP_COST] = [RX_Billing].[dbo].[FS_Drug_TEMP].[OP_COST]
  ,[HH_COST] = [RX_Billing].[dbo].[FS_Drug_TEMP].[HH_COST]
  ,[VAR_COST] = [RX_Billing].[dbo].[FS_Drug_TEMP].[VAR_COST]
  ,[LSTUPDATE] = [RX_Billing].[dbo].[FS_Drug_TEMP].[LSTUPDATE]
FROM [RX_Billing].[dbo].[FS_Drug]
RIGHT OUTER JOIN [RX_Billing].[dbo].[FS_Drug_TEMP] ON 
          [RX_Billing].[dbo].[FS_Drug].[TRADENAME] = 
                   [RX_Billing].[dbo].[FS_Drug_TEMP].[TRADENAME] 
```

**编辑：**

我选择了 Rory 的代码。谢谢，效果很好。

给 Orion Edwards 的说明：UPSERT/MERGE 正是我想要的，但 SQL Server 2005 不支持它。显然它是计划好的，但没有发布。它在 Server 2008 中可用。（根据 Interwebs 告诉我的内容。）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-26T20:09:23.220

标准方法是先进行更新，然后再进行插入：

```
-- UPDATE rows using an INNER JOIN with matching TRADENAME. No need to update TRADENAME column.
UPDATE drug
SET [CDM] = tmp.[CDM]
  , [NDC] = tmp.[NDC]
  , [IP_COST] = tmp.[IP_COST]
  , [OP_COST] = tmp.[OP_COST]
  , [HH_COST] = tmp.[HH_COST]
  , [VAR_COST] = tmp.[VAR_COST]
  , [LSTUPDATE] = tmp.[LSTUPDATE]
FROM [RX_Billing].[dbo].[FS_Drug] drug
INNER JOIN [RX_Billing].[dbo].[FS_Drug_TEMP] tmp  
    ON drug.[TRADENAME] = tmp.[TRADENAME]

-- Insert rows that don't have matching TRADENAME
INSERT INTO drug
SELECT 
    tmp.[TRADENAME]
  , tmp.[CDM]
  , tmp.[NDC]
  , tmp.[IP_COST]
  , tmp.[OP_COST]
  , tmp.[HH_COST]
  , tmp.[VAR_COST]
  , tmp.[LSTUPDATE]
FROM [RX_Billing].[dbo].[FS_Drug] drug
RIGHT OUTER JOIN [RX_Billing].[dbo].[FS_Drug_TEMP] tmp 
    ON  drug.[TRADENAME] = tmp.[TRADENAME]
WHERE drug.[TRADENAME] IS NULL 
```

您可能还想删除或标记为已删除 drug 中不再存在于 tmp 中的任何记录。将其作为与 UPDATE 相同的单独语句执行，但使用 tmp.TRADENAME 为 NULL 的 LEFT OUTER JOIN。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T19:30:30.490

你可以尝试做一个`UPSERT`（基本上是“如果存在，更新，否则插入”）。

[我相信 SQL server 调用它`MERGE`](http://www.kodyaz.com/blogs/software_development_blog/archive/2006/11/05/464.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-26T19:29:10.680

您不想对新行执行 INSERT 并在现有行上执行 UPDATE 吗？如果我理解正确，将其更新为 INNER JOIN 并添加单独的 INSERT 应该可以解决您的问题。

# c# - ASP.net Web 服务和智能感知

> ID：592045
> 
> 赞同：1
> 
> 时间：2009-02-26T19:28:11.073
> 
> 标签：c#, asp.net, web-services, soap, intellisense

好的，所以我有一个 ASP.Net 网站项目。该项目位于网络上的服务器上，由 Visual Studio 2008 通过文件共享访问。

在网站项目中，我添加了对之前创建的 Web 服务的 Web 引用。
我可以通过 winforms 应用程序使用这个 web 服务，没有任何问题。

但是当我尝试在我的代码中引用 Web 服务时，没有出现智能感知，并且服务名称在 Visual Studio 中得到红色下划线并说“找不到类型或命名空间名称‘IMWebService’，您是否缺少程序集引用或使用指令？”

但是，如果我知道 Web 服务方法的确切方法签名，我可以输入它，将它保存到 Web 服务器，它就可以正常工作。例如：

```
bool test = Contractor.CheckLogin(email, password); 
```

如何让我的 Visual Studio 像网站一样识别服务？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-02T19:33:18.797

我遇到了这个问题，仅与通过“Web 引用”创建的类隔离。一种解决方案是清除 bin 和 obj 文件夹并重新启动 Visual Studio。这并不总是奏效，所以也许这不是一个“解决方案”，但有时 Intellisense 会在那之后得到提升。我还尝试打开 Web 服务的自动生成代码并对其进行修改，然后保存。这似乎让 Intellisense 开始关注该文件。我做的其他任何事情似乎都没有效果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T23:29:03.303

检查命名空间，可能有问题。如果您输入全名，请在其下方查找小红框。

如果它不起作用，您可能已经破坏了 Intellisense，因为我每天都使用它并且它有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-02T19:36:54.107

您可以尝试从临时区域中提取 VS 为您制作的 Web 服务客户端自动生成的代码，并将其添加到您的实际项目中

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-08T08:58:14.873

使用 Web 应用程序项目而不是网站。

文件 -> 新建 -> 项目 -> C# -> Web -> ASP.NET Web 应用程序

这将解决您的问题以及其他问题。

网站项目很旧，无法正常工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-08T19:19:01.713

为了帮助缩小问题的范围：

*   您是否检查过通过 UNC 路径使用 VS 项目的代码访问策略？
*   您是否收到有关使用从文件共享打开不受信任的代码的任何警告？
*   如果您在本地运行所有代码，您会得到同样的行为吗？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-09T16:20:29.293

一旦我遇到同样的问题，我只需右键单击 Visual Studio 项目资源管理器中的 refrence 文件夹，选择刷新，然后在 2 或 3 分钟后，智能感知出现并且工作正常。我认为它需要一些时间下载架构和网络服务类信息或类似的东西。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-02T19:32:24.117

将以下行放在代码文件的顶部：

```
using Contrator; 
```

如果 Visual Studio 未提供智能感知，但代码在您使用完全限定名称时编译，那么您可以确信在 using 语句中添加命名空间将解决问题。

如果您没有在文件顶部指定命名空间，则 IDE 不知道如何解析该类型。

# java - 在 Guice 中注入对象数组

> ID：592046
> 
> 赞同：13
> 
> 时间：2009-02-26T19:28:22.413
> 
> 标签：java, guice

我想在 Guice 中实现类似于以下内容：

```
public MyClass {

    private final InjectedObject[] injectedObjects;

    @Inject
    public MyClass(InjectedObject[] injectedObjects) {
        this.injectedObjects=injectedObjects;
    }
} 
```

即我希望能够创建一定数量的对象实例，并将它们作为数组注入到另一个对象中。我可能可以这样做：

```
public MyClass {

    private final InjectedObject[] injectedObjects;

    @Inject
    public MyClass(InjectedObjectProvider injectedObjectProvider) {
        this.injectedObjects=injectedObjectProvider.getArrayOfInjectedObjects(5);
    }
} 
```

...但我想知道是否还有其他更优雅的路线？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-12-18T02:04:24.970

不确定这是否适合您的需求，但是当我需要注入多个相同类型的元素时， [Multibindings对我有用（尽管它会产生一个集合）。](http://code.google.com/p/google-guice/wiki/Multibindings)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-27T01:48:17.477

我很好奇你为什么要急切地创建几个对象。您可能会成功注入, 并在每次需要实例时`Provider<InjectedObject>`调用。`Provider.get()`如果你真的需要 5 个，你可以循环构建它们：

```
public MyClass {
  private final List<InjectedObject> injectedObjects;

  @Inject
  public MyClass(Provider<InjectedObject> injectedObjectProvider) {
    injectedObjects = new ArrayList<InjectedObject>();
    for (int i = 0; i < 5; i++) {
      injectedObjects.add(injectedObjectProvider.get());
    }
  }
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-24T21:25:49.130

正如 Jesse 提到的，一种选择是将 a`Provider<InjectedObject>`注入您的班级：

```
public class MyClass {
  private final List<InjectedObject> injectedObjects;

  @Inject
  public MyClass(Provider<InjectedObject> injectedObjectProvider) {
    List<InjectedObject> objects = new ArrayList<InjectedObject>();
    for (int i = 0; i < 5; i++) {
      objects.add(injectedObjectProvider.get());
    }
    injectedObjects = Collections.unmodifiableList(objects);
  }
} 
```

这样做可能会有问题。如果`InjectedObject`作用域为`@Singleton`or `@RequestScoped`，那么每次调用`injectedObjectProvider.get()`时都会得到相同的引用。注入 a 来执行此操作的另一个问题是，从依赖于多个 InjectedObject 实例`Provider`的 API 中不清楚。`MyClass`最后，您已经硬编码，`MyClass`因为它需要注入五个实例。

您很少需要将 a`Provider`注入对象。通常当我这样做时，这是因为当前对象的范围意味着它将比依赖对象的范围更长寿（例如，`@Singleton`需要访问`@RequestScoped`对象的 a ）。

`Provider`您可以将 a`List<InjectedObject>`注入构造函数，并在 Guice 模块中创建提供程序方法，而不是注入 a ：

```
@Provides
MyClass prividesMyClass(Provider<InjectedObject> injectedObjectProvider) {
  List<InjectedObject> objects = new ArrayList<InjectedObject>();
  for (int i = 0; i < 5; i++) {
   objects.add(injectedObjectProvider.get());
  }
  return new MyClass(objects);
} 
```

（当然，您可以使用 a 绑定`TypeLiteral`）

为什么这样更好？尽管您仍然在此代码中硬编码五个对象，但它并没有硬编码在 中`MyClass`，因此`MyClass`（包括`MyClass`自身的测试）的客户端可以选择以不同的方式构造对象。

如果在 Guice 模块中硬编码这些知识不是一个好主意，您可以改为创建一个具有比`Provider`

```
public interface InjectedObjectRepository {
  List<InjectedObject> getInjectedObjects();
} 
```

即使您决定要`MyClass`负责知道要创建多少个实例，您也可能希望创建一个接口（也许命名`InjectedObjectSupplier`以便您可以明确记录您每次都期望一个唯一的实例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-17T22:25:32.283

添加此答案以便人们知道如何注入数组，因为这首先出现在谷歌搜索中。我相信其中任何一个都会起作用：

在模块的配置中： `bind(InjectedObject[].class).toInstance(someArray);` 或作为提供者方法：

```
@Provides
InjectedObject[] getInjectedObject(@Inject Provider<InjectedObject> provider) {
  InjectedObject[] objects = new InjectedObject[5];
  for (int i = 0; i < objects.length; i++) {
    objects[i] = provider.get();
  }
} 
```

# c# - 巨大的 main.cs 文件

> ID：592050
> 
> 赞同：0
> 
> 时间：2009-02-26T19:29:08.747
> 
> 标签：c#, .net

我是 C# 新手（来自 Delphi），发现我的 main.cs 文件变得非常大。在 Delphi 中，我可以在 .pas 文件中创建类并从我的主应用程序文件中使用它。我只是添加了使用（文件名）关键字。

我的问题是如何在 C# 中做类似的事情？例子：

德尔福：

```
Button1.Visible = False; 
```

我可以通过添加对主单元的引用来引用另一个单元中的按钮属性：

```
frmMain.Button.Visible = True; 
```

在 C# 中，我想将此代码移动到另一个 .cs 文件并从我的主窗体中调用它。这没用。

```
private void manageMainMenuButtons()
{
  if (rtbSharedSARP.Text == "")
  {
    utmToolBar.Tools["First"].SharedProps.Enabled = false;
    utmToolBar.Tools["Previous"].SharedProps.Enabled = false;
    utmToolBar.Tools["Next"].SharedProps.Enabled = false;
    utmToolBar.Tools["Last"].SharedProps.Enabled = false;
  }
  else
  {
    utmToolBar.Tools["First"].SharedProps.Enabled = true;
    utmToolBar.Tools["Previous"].SharedProps.Enabled = true;
    utmToolBar.Tools["Next"].SharedProps.Enabled = true;
    utmToolBar.Tools["Last"].SharedProps.Enabled = true;
  }
} 
```

不是最好的例子，但我希望有人可以帮助我。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T19:35:49.773

首先，您需要确保您在同一个命名空间中：

```
namespace mynamesspace { 
```

接下来，如果您的班级成员是私下声明的，您需要表明您正在处理该班级：

```
public partial class frmMyForm : Form { 
```

但请注意，这是对原始类的扩展。如果您正在访问公共成员（这是处理事情的好方法），您可能只需要指定命名空间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T19:31:46.960

除非您在“主”表单上有数百个控件，否则听起来您没有将业务逻辑和表示逻辑分开。您应该设置单独的类（在单独的文件中）来处理您的业务逻辑，并且每个表单都应该有自己的设计器和代码隐藏文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-26T19:36:41.473

假设您正在使用最佳实践并适当地分离逻辑（如果您不是一个好的起点），C# 使用所谓的部分类来允许您将一个类分解为多个文件。例如：

Main1.cs：

```
namespace Program
{
    public partial class Main
    {
        private Form frmMain;
    }
} 
```

Main2.cs：

```
namespace Program
{
    public partial class Main
    {
        void MainMethod()
        {
             frmMain.Button.Visible = true;
        }
    }
} 
```

MainMethod 可以访问 frmMain，因为就编译器而言，尽管它们位于不同的文件中，但它们位于相同的类定义中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T19:35:31.587

C# 是面向对象的，因此您需要在其他类中引用实例化窗口。如果您`Form mainForm`在每个方法中添加作为参数，并从表单类中传递它`this`，那么在您的外部方法中您可以说`mainForm.property`.

话虽如此，你的问题让我认为你会从一些关于面向对象设计的阅读中受益，以及使用 c# 和 winforms 的应用程序架构。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T19:39:09.207

在这种特殊情况下，utmToolBar 几乎可以肯定是表单上的控件和表单类范围内的变量名。您*可以*将其迁移到另一个文件，但这可能不是分解文件的正确方法。

任何时候您想要将类添加到 C# 项目中，都可以通过在项目资源管理器中右键单击您的项目并选择添加类来实现。然后，您可以通过简单的剪切和粘贴将功能移动到该类中，替换为类引用。

这几乎没有触及冰山一角，我建议您拿起任何基本的 C# 书籍并开始阅读。这将比任何适合本论坛的答案更有意义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T19:40:31.947

您可以使 manageMainMenuButtons 成为任何其他文件的静态方法并传递引用，或者将其用作实用程序，甚至使用表单的 Partial 定义创建其他文件。这是一个带有一些重构的静态方法的示例。我不确定 utmToolBar 是什么，所以我尝试了我的想法。

```
XXX.manageMainMenuButtons(utmToolBar, string.IsNullOrEmpty(rtbSharedSARP.Text));

public static void manageMainMenuButtons(Object /*whatever utmToolBar actually is*/ utmToolBar, bool disable)
{
    utmToolBar.Tools["First"].SharedProps.Enabled = disable;
    utmToolBar.Tools["Previous"].SharedProps.Enabled = disable;
    utmToolBar.Tools["Next"].SharedProps.Enabled = disable;
    utmToolBar.Tools["Last"].SharedProps.Enabled = disable;
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-26T19:42:27.857

如果您想从单独文件中的代码访问控件（例如表单上的按钮），您只需确保该文件中的代码包含在与表单相同的命名空间中。

例如，在您的表单设计器文件中：

```
namespace MyWindowsApp{
    class MyForm{
        //various control declarations
    }  
} 
```

然后，在外部文件中：

```
namespace MyWindowsApp{
    class MyClass{
        //Miscellaneous code
    }
} 
```

MyClass 将了解并访问 MyForm 及其所有公共属性。

希望对你有帮助，李

# apache-flex - 语音回声问题

> ID：592058
> 
> 赞同：5
> 
> 时间：2009-02-26T19:31:00.893
> 
> 标签：apache-flex, flash, red5, signal-processing

我正在尝试使用 Adob​​e Flex 构建视频聊天程序，但回声存在巨大问题。如果参与者不使用耳机，他们所说的一切都会回声。更糟糕的是，它们实际上可以创建回声的正反馈循环，直到麦克风静音才会结束。

有没有人在 Flex/Flash 平台上找到了解决方案？

我的软件使用的是 Speex 编解码器，我已尽我所能消除所有缓冲（即它是一个实时流，我将缓冲长度设置为 0）。环回选项关闭，“使用回声抑制”打开。我正在使用[Red5](http://osflash.org/red5)服务器进行视频和音频流传输。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-11T13:03:31.030

这是 Adob​​e 软件中的一个已知问题，目前尚无修复程序。

现在你只能解决这个问题。

您应该在应用程序中实现一*键通*模式，并让用户在遇到音质问题时可以轻松切换到一键通。

如果应用程序的所有用户都有耳机，那么他们就不必求助于*Push-to-Talk*。

如果您的应用程序正在进行*多对多*会议，那么允许用户请求发言者令牌可能是一个有趣的想法。

使用基于[**tst**](https://stackoverflow.com/questions/592058/voice-echo-problem/618239#618239)[建议的](https://stackoverflow.com/questions/592058/voice-echo-problem/618239#618239)**方法，可以让应用程序检查哪些人在说话，然后自动授予扬声器令牌，而不是让用户手动请求它。显然，必须进行可用性测试以确保这在实践中运作良好。**

 ****有关该错误的更多信息**

您可以参考以下 Adob​​e 错误报告了解更多详细信息：

*   [http://bugs.adobe.com/jira/browse/FP-273](http://bugs.adobe.com/jira/browse/FP-273)

错误描述如下：

*Flash 播放器尚不支持 AEC。Flash player 10 beta 也没有 AEC 支持。开发人员需要内置 AEC 来创建方便的 Web 服务，并提供实时音频/视频通信，而无需用户佩戴耳机。根据 Speex 项目网站，Speex 支持 AEC。请为 Flash Player 10 的发布版本添加 AEC 支持，以使其适合通信 web 服务。*

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-26T19:59:03.557

您需要实施一些过滤，以确保扬声器的所有输出都从麦克风输入中消除（或尽可能接近）。我不知道执行此操作的具体工具，但基本思想是您获取输入和输出的并行时间片，然后从输入中*减去*输出的波形。由于延迟，您可能必须引入偏移量以使事情匹配。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-06T09:43:37.447

我在网络会议系统中遇到了同样的问题，但在网络上找不到任何解决方案。据我了解，“使用回声抑制”将仅取消由环回产生的回声。但我提出了一个简单的解决方案——并不完美，但总比没有好：

```
every 50ms check Microphone.activityLevel

if during last 1500ms activityLevel was greater than 20
then Microphone.gain *= 0.8 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-06T09:42:12.880

您也可以通过低通滤波器传递流以减少回声

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-09T00:46:40.600

另一个部分解决方案是在输入电平低于某个阈值时停止发送。这样，一旦有人停止说话，回声就会消失。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-09T19:55:54.737

您可以尝试使用卷积滤波器，它会尝试将麦克风输入与您发送到扬声器的最近输出相关联。当您检测到麦克风输入与最近的输出相似时，只需将麦克风静音，直到相关性消失。（但 IANAX，我不是专家）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-10T09:58:20.407

1）您应该定义问题 - 如果在没有人说话时发生这种情况，在扬声器听到声音之后，或者只有当很多人同时说话时等等......

2）请注意，与大多数软件问题不同，在该领域中，没有一种解决方案可以 100% 有效，而是解决方案由多种方法组成，并且通常效果很好，但并非一直有效。

因此，您应该实现上面的一些想法，将我的想法添加到这个受人尊敬的列表中：

a) 首先调整录音、增益等的电平...

b) 尝试插入从样本录制到播放时间的延迟。为了计算延迟，使用了尝试和错误的方法。

c) 你有均衡器吗？调整它 - 有时问题出在单个频率范围内，可能是低电平的......

如果你的努力没有奏效，问题更严重，你需要在 Flex 中找到，或者实现某种“回声消除”，这可以简单或聪明地完成，我确信有开放来源一些地方。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-12T02:39:10.427

我的妻子做了一个关于回声消除的自适应冷杉滤波的硕士项目。只要你知道一个来源，它似乎就能够管理可变延迟，你知道。尽管对于您的应用程序来说，这似乎有点过头了。查看有关[自适应滤波器](http://en.wikipedia.org/wiki/Adaptive_filter)、[fir 滤波器](http://en.wikipedia.org/wiki/Adaptive_filter)和 matlab 中的 wolfram [fir 滤波器](http://library.wolfram.com/infocenter/MathSource/1924/)代码的维基百科页面作为起点。

# .net - 如何在没有缓冲区的情况下同时将 .NET 流写入其他两个流？

> ID：592064
> 
> 赞同：2
> 
> 时间：2009-02-26T19:33:27.033
> 
> 标签：.net, multithreading, streaming

在我之前的问题中，有人评论说可以同时将一个 .NET 流写入另一个流。我只能找到一种方法，但使用一个临时变量（缓冲区）来存储输入流的内容（一次全部或部分）。

1.  有什么方法可以在不使用缓冲区的情况下做到这一点？
2.  有什么办法可以同时进行吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T19:38:26.803

假设流支持正确的异步访问，使用缓冲区可以异步写入两个流。这实际上是并发的 - 尽管您将有一项棘手的工作来保持所有缓冲区同步，因为一个人可以在另一个缓冲区完成写入之前很长时间完成写入第一个缓冲区。

据我所知，如果不使用至少一个字节的缓冲区，就无法从一个（一般）流复制到另一个流。（当然，只使用一个字节会非常低效。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-26T20:56:19.113

如果您乐于将并发性限制为最慢流的速率，那么这非常简单并且不需要额外的缓冲区，我是从内存中编写的，所以可能会有点混乱。

它也没有实现所有需要的覆盖，为了简单起见，CanRead、CanSeek 等都被跳过了，只是完成了核心并发写入。

```
using System;
using System.IO;
using System.Threading;

namespace MultiCastStream
{   
  public class MultiWriteStream : Stream
  {
    private readonly Stream[] streams;      
    private AutoResetEvent[] waits;
    private readonly IAsyncResult[] results;

    public MultiWriteStream(params Stream[] streams)
    {
      this.streams = (Stream[])streams.Clone();
      this.results = new IAsyncResult[this.streams.Length];
    }

    private void prepWaits()
    {
      if (waits == null)
      {
        this.waits = new AutoResetEvent[this.streams.Length];
        for(int i= 0; i < this.waits.Length; i++)
        {
          this.waits[i] = new AutoResetEvent(false);
        }
      }
      else
      {
        for(int i= 0; i < this.waits.Length; i++)
        {
          this.waits[i].Reset();
        }
      }
    }

    public override void Write (byte[] buffer, int offset, int count)
    {
      prepWaits();
      for( int i = 0; i < this.streams.Length; i++)
      {
        this.results[i] = streams[i].BeginWrite(
          buffer, offset, count, this.Release, waits[i]);   
      }
      WaitHandle.WaitAll(waits);
      for( int i = 0; i < this.streams.Length; i++)
      {
        this.results[i] = this.streams[i].EndWrite(results[i]); 
      }
    }

    private void Release(IAsyncResult result)
    {
      ((AutoResetEvent)result.AsyncState).Set();
    }

    public override void WriteByte (byte value)
    {
      // no point doing this asynchronously
      foreach (Stream s in this.streams) 
      s.WriteByte (value);
    }

    protected override void Dispose (bool disposing)
    {
      base.Dispose (disposing);
      if (this.waits != null)
      {
        foreach (AutoResetEvent w in this.waits)
          w.Close();
      }
      foreach (Stream s in this.streams)
        s.Dispose();
    }       
  }
} 
```

# c++ - 我在这里得到结构副本吗？

> ID：592067
> 
> 赞同：0
> 
> 时间：2009-02-26T19:34:32.600
> 
> 标签：c++, reference, overwrite

这是一个假代码示例

```
vector<Fred> gFred;
{
    // init gFred

    Fred &fred = gFred[0];

    size_t z = 0;
    do
    {
        fred = gFred[z];

        // do odd processing with fred

        z++;
    }
    while (fred.lastElementInSet == 0);
} 
```

引起我注意的是 gFred[0] 被覆盖的事实。这使我认为，与其将 init fred 作为对新元素的引用，

```
fred = gFred[z]; 
```

实际发生的是 gFred[1] 正在覆盖 gFred[0]。

我在想在这里做的正确的事情，就是把自己的头顶几次，然后把它变成一个指针实现，然后继续我的生活。

我是否正确诊断了这一点？还是我需要更多的教育？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T19:36:40.630

是的，你在那里得到了一个结构副本。引用不能被反弹，即它们一旦被初始化就保持不变。

你的解决方案也是合适的。不知道怎么打自己的头。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T19:44:04.530

查看引用的一种方法是将它们视为隐式取消引用的指针。简单地说，它们是指针，但你可以使用正常的变量访问语法来使用它们

```
Fred &fred = gFred[0]; 
```

这将创建对向量 gFred 的第一个元素的引用。（顺便说一句，你里面有什么吗？）编译器会做这样的事情：

```
Fred *pFred = &gFred[0]; 
```

现在，当你这样做时：

```
fred = gFred[z]; 
```

编译器实际上会做这样的事情：

```
*pFred = gFred[z]; 
```

翻译为：

```
gFred[0] = gFred[z]; 
```

如果你`N`有 N 个元素在你的`vector`.

如果您尝试初始化`vector`尝试此构造函数的所有元素：

```
vector(size_type n, const T& t) 
```

在哪里，

```
n = size of vector
t = gFred[0] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T19:48:55.343

使用您发布的代码（并假设 Fred 类型是 POD），gFred[0] 正在被覆盖，最终将包含 gFred[z] 中最后一个 z 的 wahatever 副本。

您可以切换到使用指针实现，或者您可以更紧密地确定引用范围：

```
{    
    size_t z = 0;
    do
    {
        Fred &fred = gFred[z];
        // do odd processing with fred
        z++;
    }
    while (fred.lastElementInSet == 0);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T19:44:28.240

在您提供的代码中，`fred`始终引用`gFred[0]`. 如果您希望`fred`引用随着循环的每次迭代而改变，请删除该行`Fred &fred=gFred[0];`。然后替换`fred = gFred[z];`为`Fred &fred = gFred[z]`. 这样，`fred`每次循环执行时都重新初始化引用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T19:52:42.760

编译的机制由 dirkgently 的答案解释，而基本解释是 MSN 的解释（“引用不能被反弹”）。

也许这样读起来更容易：

如果

```
ptr = &xxx; 
```

表示 的内容`ptr`是 的地址`xxx`，则

```
&fred = gFred[0]; 
```

表示 的地址*设置*`fred`为指向`gFred[0]`。IOW，`fred`现在是`gFred[0]`. 这就是为什么做`fred = xxx`覆盖`gFred[0]`

# visual-studio - Visual Studio 命令行上的 MSBuild

> ID：592072
> 
> 赞同：1
> 
> 时间：2009-02-26T19:36:23.767
> 
> 标签：visual-studio, msbuild

我正在尝试使用构建后构建事件在 .sln 上调用 msbuild

就像是：

```
xcopy "$(TargetDir)$(TargetName)*" "C:\TEST\" /Y. 
```

我可以在一行中做到这一点吗？？？基本上我想要类似的东西：

```
msbuild Solution.sln xcopy "$(TargetDir)$(TargetName)" "C:\TEST\" 
```

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-26T19:49:23.080

恕我直言，您最好直接编辑项目文件并将其添加到 AfterBuild 目标。下面是我们在发布版本中复制程序集 DLL、PDB 和 XML 文件的示例：

```
<Target Name="AfterBuild">
  <CallTarget Targets="CopyFrameworkToTools" 
              Condition="'$(Configuration)' == 'Release'"/>
</Target>
<Target Name="CopyFrameworkToTools">
  <CreateItem Include="$(OutputPath)$(AssemblyName).*">
    <Output ItemName="ReleaseFiles" TaskParameter="Include" />
  </CreateItem>
  <Copy SourceFiles="@(ReleaseFiles)" DestinationFolder="..\Tools\" />
</Target> 
```

您可以使用 Copy 任务将其简化为一行，但我想表明集成到 MSBuild 中可以为您提供更大的灵活性和控制力。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T19:49:35.450

你不能这样做。无法从命令行指定要执行的任务。您唯一能做的就是指定目标。

您可以：

*   将小型 MSBuild 项目文件写入您需要的任务。缺点：您无法在解决方案中引用其他项目的输出，因此您必须明确指定任何文件
*   将构建后事件添加到您的项目文件（通过 Visual Studio）。缺点：您必须修改您的项目，这可能并不总是可行的。（不，您不能从命令行注入该事件）此外，此事件将仅作为常规构建的一部分执行。
*   将单独的目标添加到您的项目文件中。与构建后事件相同的缺点。与 te post build 事件的区别在于，您可以将目标显式指定给 msbuild，它只会执行其任务。缺点：与构建后事件相同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T19:45:03.217

您的构建后事件是命名配置构建的一部分 - 因此它将作为项目/配置构建的一部分执行。

至少这是我从命令行运行 MSBuild 的经验。

也许我误解了你的问题。

也许如果您解释您正在尝试做什么，我们可以想出一种方法来解决这个问题 - 而不是试图回答您的具体实施......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T19:44:18.523

不，添加构建后事件将是正在构建的项目文件的一部分。我不知道将副本添加到命令行末尾的方法。

您可以在正在构建的项目中添加一个构建后事件，该事件将执行复制。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T19:39:50.810

您可以在正在构建的项目中添加一个构建后事件，该事件将执行复制。

# c++ - 为什么 winmain 不设置错误级别？

> ID：592075
> 
> 赞同：7
> 
> 时间：2009-02-26T19:37:03.860
> 
> 标签：c++, winapi, visual-c++, winmain

为什么这个程序能正确显示消息框，却没有设置错误级别？

```
int APIENTRY _tWinMain(HINSTANCE hInstance,
                     HINSTANCE hPrevInstance,
                     LPTSTR    lpCmdLine,
                     int       nCmdShow)
{
  MessageBox(NULL, _T("This should return 90 no?"), _T("OK"), MB_OK);
  return 90;
} 
```

我将上面的代码编译为名为 a.exe 的可执行文件。我在命令提示符下做了这个：

```
c:\> a.exe 
 (message box is displayed, I press ok)
c:\> echo %ERRORLEVEL% 
  0 
```

如果我`exit(90);`在退货前使用，我会得到相同的结果。它仍然说`0`。

我也尝试通过启动程序`CreateProcess`并获得结果，`GetExitCodeProcess`但它也返回`0`给我。我进行了错误检查以确保一切都正确启动。

我最初在一个更复杂的程序中看到了这个问题，所以我做了这个简单的程序来验证这个问题。结果是一样的，两个程序`WinMain`总是返回`0`。

我尝试了 x64、x86 和 unicode 和 MBCS 编译选项。所有都`0`作为错误级别/状态代码给出。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-26T19:56:10.287

如果您的程序是 Windows 应用程序，而不是控制台应用程序，命令解释器不会等待它完成（在您按 OK 之前，请查看命令窗口，您会看到它已准备好执行下一个命令）。

如果是这种情况，将您的应用程序构建为控制台子系统应用程序将解决问题。如果您需要作为 Windows 应用程序运行，您可能会尝试等待命令完成并查看它是否有效（我没有尝试过，但它似乎是一个好方法）：

```
start /wait a.exe
echo %ERRORLEVEL% 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T19:59:44.647

为了`%ERRORLEVEL%`工作，你必须启用命令扩展（我认为这是默认的，因为上帝知道什么时候）。

尝试做：

```
echo %CMDEXTVERSION% 
```

查看是否启用了扩展。当它们打开时我得到“ `2`”输出，`%CMDEXTVERSION%`当它们关闭时我得到“”输出。

您还可以使用旧样式测试错误级别：

```
if errorlevel 1 echo errorlevel is 1 or more... 
```

无论扩展如何，或者是否有人设置了名为“ `ERRORLEVEL`”的环境变量，这都应该有效

# coldfusion - ColdFusion 中的 form.fieldnames 中缺少值

> ID：592076
> 
> 赞同：10
> 
> 时间：2009-02-26T19:37:09.413
> 
> 标签：coldfusion

我一定是疯了。

```
<cfif cgi.request_method eq "POST">
    <cfoutput>
        Form.fieldnames = #form.fieldnames#<br>
        structKeyList(form) = #structKeyList(form)#
    </cfoutput>
</cfif>

<form  method="post" accept-charset="utf-8">

    <input type="text" name="graduation_date" value="x"><br>
    <input type="text" name="foo" value="y"><br>
    <input type="text" name="bar" value="z"><br>

    <input type="submit" value="Submit Form" >

</form> 
```

该`form.fieldnames`变量应包括提交字段的列表：`foo`、`bar`和`graduation_date`。却`graduation_date`不见了。

经过多一点测试，我发现任何`_date`以`form.fieldnames`.

我本来想问我的代码有什么问题，但现在我非常确信这是 ColdFusion 中的一个错误。（我在 ColdFusion 8.0.1 / OS X 10.5.6 上。）

这是 ColdFusion 中的一个错误，对吧？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-26T19:47:56.453

也许是[自定义验证功能](http://livedocs.adobe.com/coldfusion/8/htmldocs/validateData_10.html#1154690)（又名“使用隐藏字段验证表单数据”）？

本质上，通过使用一些特定格式的表单字段（`field_required`、`field_date`、`field_integer`等），您可以对表单执行服务器端验证。

这可以追溯到 ColdFusion 的几个版本，当时 CFFORM 不是很健壮，让您不必为每个表单字段编写验证代码。现在有更好的方法可以做到这一点，但它仍然存在以实现向后兼容性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-11T21:24:04.330

是的，我在使用 ColdFusion 8 时也遇到了这个小问题。我几乎已经准备好对我的服务器进行飞行测试，试图弄清楚为什么一个名为“asof_date”的文本框没有被处理，也没有出现在我发布的 FIELDNAMES 字段中数据（这解释了为什么它被忽略）。我将其称为正交性方面的错误。一旦我将名称更改为“pub_asof”，它就可以正常工作。啊！！

# compression - 熵与无损压缩率的关系

> ID：592077
> 
> 赞同：5
> 
> 时间：2009-02-26T19:38:01.737
> 
> 标签：compression, information-theory

根据[香农的源编码定理](http://en.wikipedia.org/wiki/Shannon%27s_source_coding_theorem)，我们知道压缩字符串的熵受原始字符串熵的限制，如下所示：

```
H(X) <= L < H(X) + 1/N 
```

其中 H(X) 是源字符串的熵，N 是源字符串的长度，L 是压缩字符串的预期长度。

这必然意味着无损压缩是有限度的。

我想知道的是：

*   我们可以直接将熵与一些预期的压缩比联系起来吗？

*   我们可以使用熵来找到压缩比的上限吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T19:57:22.500

香农定理是根据随机数据和概率定义的。类似地，字符串的*熵*仅针对随机字符串定义——熵是分布的属性，而不是字符串本身的属性。因此，我们可以将香农定理非正式地重述为：

> 如果你从给定的概率分布中随机选择一个字符串，那么我们可以得到的字符串的最佳平均压缩比由概率分布的熵率给出。

给定任何随机字符串，我可以轻松编写一个压缩算法，将该字符串压缩为 1 位，但我的算法必然会增加一些其他字符串的长度。我的压缩算法工作如下：

1.  如果输入字符串等于*某个预先选择的随机字符串*，则输出为 1 位字符串“0”
2.  否则，输出为“1”的N+1位字符串，后跟输入字符串

对应的解压算法为：

1.  如果输入为“0”，则输出为*我们之前预选的随机字符串*
2.  否则，输出是除了第一个输入位之外的所有内容

这里的关键是我们不能写出*一种*算法，对于给定分布的所有字符串，平均而言，它会以高速率压缩*它们*。字符串太多了。

如果我们给定字符串的概率分布，我们可以计算分布的熵率，然后如果*根据分布*随机选择一个字符串并尝试使用**任何**算法对其进行压缩，则压缩字符串的相对大小将，平均值，永远不会低于熵率。这就是香农定理所说的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T19:54:04.427

是的。英语的*熵率*通常被引用为每个字符 1.5 位（给予或接受）。典型的编码每个字符使用 8 位。因此，最大压缩文本应该是原始大小的 1.5/8 (~19%)。简奥斯汀的《傲慢与偏见》纯文本版本的实际结果：orig = 701K，bzip2 = 178K，约占 25%。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-26T19:46:56.487

在不知道源字符串长度的情况下，您无法直接将熵与压缩比联系起来，但您可以通过求解 L 的最小可能值来查看最大压缩比的理论限制。您可以将此限制用作衡量压缩算法的效率，尽管一个糟糕的指标并不意味着已经发现甚至存在更好的算法。

所以，是的。您可以使用熵来找到理论上的最大无损压缩比，但是不，您不能使用它来确定任何给定压缩算法的预期压缩比。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T19:47:27.750

是的！我认为[本文](http://ieeexplore.ieee.org/Xplore/login.jsp?url=/iel5/43/4068913/04068914.pdf?temp=x)将为您指明正确的方向。

**ETA**看起来您需要成为 IEEE 成员才能阅读实际论文。如果有人可以找到公开可用的资源（或在这里解释数学），那当然会好得多！

# jboss - 同时运行 JBoss AS 5 和 JBoss AS 4

> ID：592091
> 
> 赞同：3
> 
> 时间：2009-02-26T19:44:12.673
> 
> 标签：jboss

我以为这将是一个 JBoss 常见问题解答，但我找不到它。

我想同时运行 JBoss 4 和 JBoss 5。我通过将端口的前导数字更改为 9 手动更改了 JBoss 5 服务器/默认实例上的所有端口，它似乎可以工作。我可以在没有端口冲突的情况下启动 JBoss 4 和 JBoss 5。

我的一位同事说，他认为他听说有一种方法可以“变基”JBoss 5 以将所有端口号移动指定数量。这将是比手动编辑端口设置更清洁的解决方案。

有没有一种简单的方法可以更改 JBoss 5 中的端口设置，以便它可以与 JBoss 4 同时运行？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-27T15:20:44.607

两个很好的答案。IP 别名很聪明。

我还在 JBoss 论坛上问过这个问题，结果发现您可以调用其他端口绑定（“rebase”选项）。像这样启动 JBoss：

```
run -Djboss.service.binding.set=ports-01 
```

这是 JBoss 论坛上的主题链接（交叉引用到此主题）：

```
http://www.jboss.org/index.html?module=bb&op=viewtopic&p=4213775#4213775 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T21:50:52.773

我不知道“rebase”选项，但一种简单的方法是设置 IP 别名并指定 -b 选项`run.sh`以绑定到该别名接口。这比更改所有端口要容易得多。只要每个 JBoss 实例都绑定到自己的地址，端口就可以保持不变。例如，

```
$ sudo ip addr add dev lo local 127.0.0.100/24
$ run.sh -b 127.0.0.1
$ run.sh -b 127.0.0.100
$ wget http://127.0.0.1:8080
$ wget http://127.0.0.100:8080 
```

瞧！一台主机上的两个 JBoss 实例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T19:54:00.870

可能有一种规范的方法可以做到这一点，但在工作中，我们通过在配置文件中插入一个替换标记来做到这一点，这是脚本化的。您可能可以在线找到您必须更改的所有端口的列表。

一旦你这样做了，按照你的建议设置端口不重叠的端口窗口就不会太麻烦了。

这是我们使用的启动命令的示例（可以进一步改进）：

```
run.sh -c <service name> -DJPATH=/usr/local/bin:/usr/bin:/bin:/usr/local/jre1.6.0_03/bin/ -Djboss.bind.address=192.168.110.21 \
-Djboss.port.connector=37079 -Djboss.port.classloader=37080 -Djboss.port.naming=37081 -Djboss.port.namingrmi=37082 -Djboss.port.jmxrmi=37083 \
-Djboss.port.pooled=37084 -Djboss.port.jndinaming=37085 -Djboss.port.jndirmi=37086 -Djboss.port.jms=37087 -Djboss.port.ajp=37078 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-07T12:31:10.687

这是一个老话题，但最近在我们的 DMZ 上将 Jboss AS 4 迁移到 5 时，我一直在问自己同样的问题。由于我找不到任何关于此的最新帖子，我想我会在这里添加我的 2 美分。从第一个答案开始，我编写了这 2 个 sh 脚本，让 Jboss4 和 5 都运行并登录到单独的文件中：

开始-jboss4.sh：

```
#!/bin/sh
nohup /etc/jboss-4.2.3.GA/bin/run.sh -b 10.0.0.51 > jboss4.log & 
```

开始-jboss5.sh：

```
#!/bin/sh
nohup /etc/jboss-5.1.0.GA/bin/run.sh -Djboss.service.binding.set=ports-01 -b 10.0.0.51 >> jboss5.log & 
```

但更重要的是，有了这个解决方案，我最终问自己如何停止其中一个实例而不放弃另一个实例。这就是接下来的 2 个脚本出现的地方。

停止-jboss4.sh：

```
#!/bin/sh
/etc/jboss-4.2.3.GA/bin/shutdown.sh -S -s jnp://10.0.0.51 
```

停止-jboss5.sh：

```
#!/bin/sh
/etc/jboss-5.1.0.GA/bin/shutdown.sh -S -s jnp://10.0.0.51:1199 
```

请注意，第一个停止脚本使用 JBoss 的默认 JNDI 端口。但是随着第二个启动脚本带来的升级端口，第二个停止脚本使用 1199（默认 + 100）作为发送关闭命令时使用的 JNDI 端口。

希望这可以帮助某人。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-07-09T15:54:56.930

请注意 jboss.service.binding.set 属性仅由 JBoss 5 使用。因此，如果您希望 JBoss 4 在不同的端口配置文件上，您需要修改 ${JBOSS_HOME}/server/default/conf/jboss-service.xml .

查找引用 ServiceBindingManager 的元素并更改 ServerName 属性。

```
<mbean code="org.jboss.services.binding.ServiceBindingManager"
  name="jboss.system:service=ServiceBindingManager">
  <attribute name="ServerName">ports-01</attribute>
  <attribute name="StoreURL">${jboss.home.url}/docs/examples/binding-manager/sample-bindings.xml</attribute>
  <attribute name="StoreFactoryClassName">
    org.jboss.services.binding.XMLServicesStoreFactory
  </attribute>
</mbean> 
```

JBoss 4 使用的端口值是从 ${JBOSS_HOME}/docs/examples/binding-manager/sample-bindings.xml 读取的。默认端口配置文件名称如下：

*   端口默认
*   港口-01
*   端口-02
*   端口-03

# javascript - 带有 RS-232 串行端口的 Javascript 接口

> ID：592099
> 
> 赞同：5
> 
> 时间：2009-02-26T19:46:01.467
> 
> 标签：javascript, serial-port, windows-vista

我目前正在从事一个涉及 4 端口 A/V 开关的项目。此开关可通过 RS-232 控制。

与交换机接口的计算机运行 Vista。我想创建一个侧边栏小工具，它有 4 个按钮 - 交换机上的每个端口 1 个。当用户按下按钮时，它会切换到该端口。

我做了一些谷歌搜索，似乎没有一种很好的方式来在 javascript 和 rs-232 之间进行接口。

有人对我有什么建议吗？

谢谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-26T20:59:54.767

你喜欢复杂的黑客吗？

安装网络服务器。使用 CGI、Python、PHP、Perl 或其他方法从 Web 服务器上的页面控制串行端口。

将控件指向网页。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-26T19:50:22.330

我认为您需要在两者之间添加一个 Java 或 Active-X 层。JavaScript 与操作系统很好地隔离（故意）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-26T21:07:09.587

特别是 Javascript，或者只是通过某种方法从浏览器中获取？和哪个浏览器？（IE 还是 Firefox？）使用 XUL + javascript 的 Firefox 插件非常简单，尽管您仍然需要在 XPCOM（Mozilla 等效于 ActiveX/COM）中实现某些东西才能使用 RS232。

或者，您可以将[JSDB](http://www.jsdb.org)用作临时 Web 服务器（在本地机器的备用端口上）。在 JSDB 中使用 RS232 端口非常容易：

```
c:\>jsdb
js>S=new Stream('com1://115200');
com1
js>S.write('\x00');    // send ASCII character 0 to the serial port
1
js> 
```

因此，您的浏览器端实现可能只是您最喜欢的书签/链接/事物是链接到`http://localhost:9999/comport/1`9999 是 JSDB 正在侦听的端口的位置，而“1”是串行端口开关。JSDB 代码将监听端口并在解析来自浏览器的 GET 请求后发送适当的 RS232 命令。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-03-28T07:49:21.773

[RealTerm](http://realterm.sourceforge.net/)具有广泛的 COM 接口，并且易于通过 Windows 上的 JavaScript 进行控制。[SourceForge 下载页面](http://sourceforge.net/projects/realterm/files/)的版本为 2.0.0.57，[i2cchip.com](http://www.i2cchip.com/realterm) 的版本为 2.0.0.70。

默认安装的“examples”子目录中有一个 JavaScript 示例。

可悲的是，JavaScript 示例似乎已从更高版本中删除[4](http://sourceforge.net/projects/realterm/files/z_Examples/1.0/)仍​​然可以这样做，但没有示例。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-26T21:02:56.913

我没有解决方案，但这可能是一个开始。

1.  签名的 java 小程序可以让您访问系统
2.  使用 RXTX (Java Serial COM API) 连接串口
3.  Applet 需要将文件安装到 jre/ext 文件夹。这样做后重新启动应用程序。

现在，如果您在自己的机器上运行 javascript，您可以使用[HTA](http://en.wikipedia.org/wiki/HTML_Application)来完全访问系统。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-26T21:27:26.137

很抱歉在我自己的问题下发帖——我还没有注册，所以现在我无法编辑它。

我想为该任务实现一个 Vista 侧边栏小工具。不幸的是，看起来这些基本上只是带有 javascript 的 html 文档，所以看起来这对我来说不是一个好的解决方案。我可能只写一点.Net 应用程序之类的。

感谢您的所有意见。如果还有人有想法，我会采纳的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-26T20:26:25.487

您可以尝试查看 V8 之类的内容，并为 C 库编写一个小型包装器以向 VM 公开。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-26T20:51:26.083

您需要在系统上安装一个 RS-232 ActiveX 组件，然后在侧边栏小部件的 javascript 代码中创建一个对象。请注意，从 ActiveX 组件创建对象没有标准，这仅在 JScript 中可用，JScript 是微软对我们都知道的 Javascript 语言的实现。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-07T17:14:00.417

AFAIK，Vista 小工具的运行时支持使用签名的 ActiveX 控件。您也可以使用 Java。您可以为 .Net 创建一个 ActiveX 包装器，它对串行设备有相当多的支持。大多数情况下，ActiveX + Serial 通信仅限于商业控制。

# inversion-of-control - 什么是控制反转 (IoC)？

> ID：592102
> 
> 赞同：15
> 
> 时间：2009-02-26T19:47:14.850
> 
> 标签：inversion-of-control

有人可以指导我一些关于控制反转（IoC）的基本教程吗？（最好是 .net/c#）。

我需要一些代码来理解它:)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-26T19:57:08.397

在大多数应用程序中，IOC 或控制反转是反转从 UI 到数据库的代码路径。这不是一个完整的答案，但它是了解这个概念的最简单方法之一。

如果您想学习 IOC，请进入 TDD，因为一旦反转，您会发现设置测试要容易得多。

例子：

我见过的大多数 .NET 应用程序的典型流程是这样的：

```
UserCollection col = BusinessLayer.Class.GetLoggedInUsers();
//Business logic
return col; 
```

那么业务是这样的：

```
UserTable table = DataLayer.Class.GetLoggedInUsers();
return table; 
```

等等。这都是伪代码。要在此示例中使用 IOC，您需要为数据层类添加一个接口，例如 IUserRepository。您可以使用泛型，我建议在引擎盖下使用。

然后，您可以执行以下操作：

```
IUserRepository repository = SetUpRepository();
UserCollection col = BusinessLayer.Class.GetUsers(repository); 
```

为什么这很重要？对于测试，您可以创建一个模拟存储库并将其提供给业务类。模拟包含始终相同的数据，这意味着您正在执行代码，而不是端到端测试。

如果你想要 C#，下面是[weblogs.asp.net](http://weblogs.asp.net/ralfw/archive/2007/01/17/inversion-of-control-using-generics-revisiting-the-separation-of-use-and-implementation.aspx)上的一个基本示例：

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-26T19:49:27.387

阅读 Martin Fowler 的这篇优秀[文章](http://martinfowler.com/articles/injection.html) 。

另外，请查看[维基百科文章](http://en.wikipedia.org/wiki/Inversion_of_control)。

依赖注入是最著名的控制反转示例，简而言之，它会将您的代码从以下变为：

```
public class FileReader { }
public class Application {
    // inflexible concrete dependency
    private FileReader fileReader = new FileReader(); 
} 
```

至：

```
public interface Reader {}
public class FileReader implements Reader {}
public class Application {
    // flexible abstract dependency injected in
    private Reader reader;

    public Application(Reader reader) { // constructor injection
        this.reader = reader;
    }
    public void setReader(Reader reader) { // setter injection
        this.reader = reader;
    }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-01T20:10:29.930

用行话来说，控制反转是一种支持单一职责原则的模式。

要了解为什么所有这些都是有用的，您需要进行一些说明，所以请耐心等待。

单一职责基本上意味着您的类应该尽可能独立于系统的其他部分，以尽量减少更改一个部分对另一部分的影响。（您也可以将其与更改实现不应触发重新编译项目中的所有文件这一事实联系起来，例如在 C/C++ 项目中更改 .h 文件时就是这种情况）。副作用是你最终会得到很多只做一件事的小对象，但非常好（在理想世界中）

但在大多数情况下，要执行它的工作，一个对象需要与另一个对象对话：这取决于它们。

缓解的第一部分是将实现与接口分开。这意味着依赖于接口（或纯粹的抽象类，取决于您选择的语言），这样一个对象就不会与另一个对象的特定实现相关联。

所以用一个规范的例子，在业务层需要，你需要执行一个需要访问的功能 - 数据层来检索对象 - 其他一些服务 - 一个记录器来记录信息和/或错误

反过来，每个服务或依赖项都有自己的依赖项，即使您的类不使用它们，也需要注意这些依赖项。根据引用的数量，设置对象可能很快就会失控。现在将它乘以你需要编写的类的数量，你最终会得到一堆乱七八糟的东西。

使用 IOC 容器基本上可以帮助您摆脱这种混乱。当您需要一个对象时，您不会“新建它”。相反，您要求 IOC 容器为您检索它。容器负责交付一个功能对象，无论其依赖关系如何，都可以随时使用。

这意味着你的类不需要知道它所依赖的类的依赖关系，这减少了缠结。此外，它不需要知道哪个实际的类实现了它所依赖的服务，这意味着 - 服务实现可以在另一个项目（dll 或其他）中定义，因此修改它永远不会影响你的类 - 实现可以是根据上下文不同（考虑更改数据库，甚至根据配置甚至应用程序的当前状态访问 Web 服务来检索信息）。

为了尝试回答您的其他问题，IOC 是一种模式。TDD 和 DDD 是设计方法，因此不能等同于另一个。但 IOC 是支持 TDD 或 DDD 的宝贵工具。

我知道首字母缩略词汤和您可以在周围找到的部分样本不容易理解。我能给你的最好建议是尝试一些小项目，你会放弃的原型，只是为了掌握这些东西。如果您正在寻找工作，这不是一个简单的方法，但如果仅从个人角度来看，绝对值得。

希望那些对你有帮助。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-26T19:49:29.867

不，IoC 不是 DDD 或 TDD。

Martin Fowler 的[文章](http://martinfowler.com/articles/injection.html)是一个很好的介绍。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-26T19:50:27.697

对于您关于 IOC 是什么的问题，维基百科有[相当广泛的解释](http://en.wikipedia.org/wiki/Inversion_of_control)。

关于教程或示例[，本](http://jeremyjarrell.com/archive/2007/07/12/44.aspx)教程很好地涵盖了它，并且有很多示例代码。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T21:12:02.367

如果你了解 DIP（依赖倒置原则），IOC 就是小菜一碟。我建议在学习模式之前学习面向对象的原则。核心原则可以像乐高积木一样堆叠来完成任何模式。 [布兰登乔伊斯](http://www.brandonjoyce.org)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-12-04T17:24:45.717

控制反转是逻辑结构的抽象。一种方法（通常与 IoC 同义使用）是依赖注入，它抽象了对象之间的引用。当对象从应用程序的实现细节中解放出来时，例如哪个类实现了哪个服务，它们可以自由地专注于它们的核心功能。

例如，假设您有一个需要将`Foo`对象映射到`Bar`对象的类。你可以这样写：

```
public class FooMapper
{
    public Bar Map(Foo foo)
    {
        // ...
    }
} 
```

并像这样使用它：

```
public class NeedsToMapFoos
{
    public void MapSomeFoos()
    {
        var fooMapper = new FooMapper();

        // ...
    }
} 
```

虽然有效，但这也是严格的。`NeedsToMapFoos`只关心映射是否*发生*，而不是它以任何特定方式发生。

我们可以用一个接口来表示“操作无实现”的概念：

```
public interface IFooMapper
{
    Bar Map(Foo foo);
} 
```

并声明对该操作的依赖：

```
public class NeedsToMapFoos
{
    private readonly IFooMapper _fooMapper;

    public NeedsToMapFoos(IFooMapper fooMapper)
    {
        _fooMapper = fooMapper;
    }

    public void MapSomeFoos()
    {
        // ...use _fooMapper...
    }
} 
```

现在`NeedsToMapFoos`知识较少，这意味着它不那么复杂。无需执行行政职责，而是可以自由地专注于业务案例。

像这样精心设计的对象也更具适应性。正如钻石是坚硬的，粘土是可塑的，内部结构决定了对变化的反应。

最后，以这种风格编写的逻辑也很灵活。假设这`FooMapper.Map`是一项昂贵的操作，应该被缓存。您可以使用装饰器模式来包装现有实现并将其无缝传递给`NeedsToMapFoos`：

```
public class CachingFooMapper : IFooMapper
{
    private readonly IFooMapper _innerMapper;
    private readonly IDictionary<Foo, Bar> _cache;

    public CachingFooMapper(IFooMapper innerMapper)
    {
        _innerMapper = innerMapper;
    }

    public Bar Map(Foo foo)
    {
        // Read bar from _cache. If not there, read from inner mapper and add to _cache.
    }
}

// Usage

new NeedsToMapFoos(new CachingFooMapper(new FooMapper())); 
```

# c# - 如何从 GridView 中删除一行？

> ID：592106
> 
> 赞同：11
> 
> 时间：2009-02-26T19:47:43.163
> 
> 标签：asp.net, c#, c#, asp.net, gridview, delete-row

我`GridView`在[asp.net](/questions/tagged/asp.net "显示标记为“asp.net”的问题") 2005 [c#](/questions/tagged/c%23 "显示标记为“c#”的问题")中使用 .

如何从`GridView`.

我已经编写了以下代码。但它不工作...

```
DataRow dr = dtPrf_Mstr.NewRow();
dtPrf_Mstr.Rows.Add(dr);
GVGLCode.DataSource = dtPrf_Mstr;
GVGLCode.DataBind();

int iCount = GVGLCode.Rows.Count;
for (int i = 0; i <= iCount; i++)
{
    GVGLCode.DeleteRow(i);
}
GVGLCode.DataBind(); 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-26T19:54:31.790

您正在从 gridview 中删除该行，但随后您将再次调用 databind，这只是将 gridview 刷新到原始数据源所在的相同状态。

要么将其从数据源中删除，然后进行数据绑定，要么进行数据绑定并将其从网格视图中删除而不重新绑定。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-26T19:53:43.290

您正在从 gridview 中删除该行，然后将其重新绑定到数据源（仍包含该行）。从数据源中删除该行，或者之后不要重新绑定网格视图。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-26T19:52:19.923

默认答案是从您用作 GridView 的数据源的任何集合中删除该项目。

如果不需要该选项，那么我建议您使用 GridView 的`RowDataBound`事件来选择性地将行的 ( `e.Row`)`Visible`属性设置为 false。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-06-24T13:19:17.583

```
using System;
using System.Configuration;
using System.Data;
using System.Linq;
using System.Web;
using System.Web.Security;
using System.Web.UI;
using System.Web.UI.HtmlControls;
using System.Web.UI.WebControls;
using System.Web.UI.WebControls.WebParts;
using System.Xml.Linq;
using System.Data.SqlClient;

public partial class Default3 : System.Web.UI.Page
{
   DataTable dt = new DataTable();
    DataSet Gds = new DataSet();
   // DataColumn colm1 = new DataColumn();
   //DataColumn colm2 = new DataColumn();

    protected void Page_Load(object sender, EventArgs e)
    {
        dt.Columns.Add("ExpId", typeof(int));
        dt.Columns.Add("FirstName", typeof(string));

    }

    protected void BtnLoad_Click(object sender, EventArgs e)
    {
        //   gvLoad is Grid View Id
        if (gvLoad.Rows.Count == 0)
        {
            Gds.Tables.Add(tblLoad());
        }
        else
        {
            dt = tblGridRow();
            dt.Rows.Add(tblRow());
            Gds.Tables.Add(dt);
        }
        gvLoad.DataSource = Gds;
        gvLoad.DataBind();
    }

    protected DataTable tblLoad()
    {
        dt.Rows.Add(tblRow());
        return dt;
    }
    protected DataRow tblRow()
    {
        DataRow dr;
        dr = dt.NewRow();
        dr["Exp Id"] = Convert.ToInt16(txtId.Text);
        dr["First Name"] = Convert.ToString(txtName.Text);
        return dr;
    }

    protected DataTable tblGridRow()
    {
        DataRow dr;
        for (int i = 0; i < gvLoad.Rows.Count; i++)
        {
            if (gvLoad.Rows[i].Cells[0].Text != null)
            {

                dr = dt.NewRow();
                dr["Exp Id"] = gvLoad.Rows[i].Cells[1].Text.ToString();
                dr["First Name"] = gvLoad.Rows[i].Cells[2].Text.ToString();
                dt.Rows.Add(dr);

            }

        }
        return dt;
    }

    protected void btn_Click(object sender, EventArgs e)
    {
        dt = tblGridRow();
        dt.Rows.Add(tblRow());
        Session["tab"] = dt;
        // Response.Redirect("Default.aspx");
    }

    protected void gvLoad_RowDeleting(object sender, GridViewDeleteEventArgs e)
    {
        dt = tblGridRow();
        dt.Rows.RemoveAt(e.RowIndex);
        gvLoad.DataSource = dt;
        gvLoad.DataBind();
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-11-23T10:18:49.207

我的解决方案：

```
protected void GridView1_RowDeleting(object sender, GridViewDeleteEventArgs e)
{
    myobj.myconnection();// connection created
    string mystr = "Delete table_name where water_id= '" + GridView1.DataKeys[e.RowIndex].Value + "'";// query
    sqlcmd = new SqlCommand(mystr, myobj.mycon);
    sqlcmd.ExecuteNonQuery();
    fillgrid();
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T19:52:09.253

从表 dtPrf_Mstr 而不是从网格视图中删除该行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-12-24T07:33:09.407

嗨如何从datagridview中删除

1.make查询删除id
2.type

```
tabletableadaptor.delete
query(datagridwiewX1.selectedrows[0].cell[0].value.tostring); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-01-18T09:02:21.847

请尝试此代码.....

```
DataRow dr = dtPrf_Mstr.NewRow();
dtPrf_Mstr.Rows.Add(dr);
GVGLCode.DataSource = dtPrf_Mstr;
GVGLCode.DataBind();
int iCount = GVGLCode.Rows.Count;
for (int i = 0; i < iCount; i++)
{
   GVGLCode.Rows.Remove(GVGLCode.Rows[i]);
}
GVGLCode.DataBind(); 
```

# google-sheets - 从 Google 电子表格开始

> ID：592109
> 
> 赞同：-2
> 
> 时间：2009-02-26T19:48:09.120
> 
> 标签：google-sheets

除了快速图表，我从未使用过电子表格。我想学习如何充分利用电子表格公式，并且一直在使用 Google 电子表格。

似乎没有任何关于 Google 电子表格的详尽教程，甚至 Google 的文档也经常引用 Excel 功能而不对其进行解释。

我的问题是，我是否应该先学习在 Excel 上使用“高级”公式（例如 Google 上的 vlookups 或 ARRAYFORMULA）电子表格，然后再转到 Google 电子表格？我没有做任何特别复杂的事情，但我想知道在跨工作表提取信息并使用公式（而不是宏）重新组织和过滤信息时的一些最佳实践。

- 编辑澄清我希望使用公式，而不是宏

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-05-29T03:40:29.100

谷歌电子表格现在有一个[完整的 API 。](http://code.google.com/apis/spreadsheets/data/3.0/developers_guide.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T20:10:28.537

Excel 电子表格有一种编程语言（Excel VBA，请参阅 Joel Spolsky），它不在 Google 电子表格中，因此从 Excel 开始可能不是令人愉快的道路。

您可以从一些电子表格练习开始，例如

1.  使用相对单元格引用实现保龄球得分图表
2.  使用 ARRAYFORMULA 实现保龄球得分图表
3.  实施保龄球联赛报告，其中每个团队都使用自己的电子表格，您的报告会导入所有数据。
4.  等等

这将使您对 Google 电子表格的大小和位置合适的问题领域之一有所了解：随时随地协作记录和摘要。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T19:51:25.900

谷歌是免费的，但非常有限。Excel 功能强大且速度快（作为本机桌面应用程序），但价格昂贵。

您应该考虑下载免费且快速的 OpenOffice。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T19:53:51.400

同意 - 开放式办公室将是要走的路 - 这里有一个很好的[教程](http://tutorialsforopenoffice.org/category_index/spreadsheet.html)。

并且基于 Java，它可以在多个平台上运行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T20:05:40.780

AFAICT，谷歌电子表格不是可编程的。excel 和 OOo 都是，所以如果你想学习“电子表格编程”，你在谷歌上将一事无成。

OOo，尤其是在 Python 中是可编程的，因此它是一个更加结构化的开发平台。VBA OTOH 是一个非常进化的 BASIC，但要做好它仍然很痛苦。（见证任何 excel 会计系统慢慢走向不可维护性）

就个人而言，我想在数据库服务器中进行所有编程（加上一些脚本语言），并使用电子表格作为前端（而不是浏览器）；但似乎大多数“可集成性”功能意味着很容易将输出从数据库复制到电子表格，有时又复制回数据库，我所见过的没有一个是“实时”数据。

# c# - 如何避免大型多步骤单元测试？

> ID：592122
> 
> 赞同：3
> 
> 时间：2009-02-26T19:51:00.580
> 
> 标签：c#, unit-testing, inversion-of-control, mocking, rhino-mocks

我正在尝试对执行相当复杂操作的方法进行单元测试，但我已经能够将该操作分解为可模拟接口上的多个步骤，如下所示：

```
public class Foo
{  
    public Foo(IDependency1 dp1, IDependency2 dp2, IDependency3 dp3, IDependency4 dp4)
    {
        ...
    }

    public IEnumerable<int> Frobnicate(IInput input)
    {
        var step1 = _dependency1.DoSomeWork(input);
        var step2 = _dependency2.DoAdditionalWork(step1);
        var step3 = _dependency3.DoEvenMoreWork(step2);
        return _dependency4.DoFinalWork(step3);
    }

    private IDependency1 _dependency1;
    private IDependency2 _dependency2;
    private IDependency3 _dependency3;
    private IDependency4 _dependency4;
} 
```

我正在使用模拟框架 (Rhino.Mocks) 来生成模拟以进行测试，并且以此处显示的方式构建代码到目前为止非常有效。但是，我如何对这种方法进行单元测试，而无需每次都需要设置每个模拟对象和每个期望的大型测试呢？例如：

```
[Test]
public void FrobnicateDoesSomeWorkAndAdditionalWorkAndEvenMoreWorkAndFinalWorkAndReturnsResult()
{
    var fakeInput = ...;
    var step1 = ...;
    var step2 = ...;
    var step3 = ...;
    var fakeOutput = ...;

    MockRepository mocks = new MockRepository();

    var mockDependency1 = mocks.CreateMock<IDependency1>();
    Expect.Call(mockDependency1.DoSomeWork(fakeInput)).Return(step1);

    var mockDependency2 = mocks.CreateMock<IDependency2>();
    Expect.Call(mockDependency2.DoAdditionalWork(step1)).Return(step2);

    var mockDependency3 = mocks.CreateMock<IDependency3>();
    Expect.Call(mockDependency3.DoEvenMoreWork(step2)).Return(step3);

    var mockDependency4 = mocks.CreateMock<IDependency4>();
    Expect.Call(mockDependency4.DoFinalWork(step3)).Return(fakeOutput);

    mocks.ReplayAll();

    Foo foo = new Foo(mockDependency1, mockDependency2, mockDependency3, mockDependency4);
    Assert.AreSame(fakeOutput, foo.Frobnicate(fakeInput));

    mocks.VerifyAll();
} 
```

这似乎非常脆弱。对 Frobnicate 实现的任何更改都会导致此测试失败（例如将步骤 3 分解为 2 个子步骤）。这是一种一体化的东西，因此尝试使用多个较小的测试是行不通的。它开始为未来的维护者提供只写代码，下个月我也忘记了它是如何工作的。一定有更好的方法！对？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T20:00:57.763

单独测试 IDependencyX 的每个实现。然后，您将知道该过程的每个单独步骤都是正确的。在单独测试它们时，测试每个可能的输入和特殊条件。

然后使用 IDependencyX 的真实实现对 Foo 进行集成测试。然后你就会知道所有的单独的部分都正确地插在一起了。通常只用一个输入进行测试就足够了，因为您只是在测试简单的胶水代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-21T18:40:46.680

许多依赖项表明代码中隐含了中间概念，因此也许可以将一些依赖项打包起来，使代码更简单。

或者，也许您拥有的是某种处理程序链。在这种情况下，您为链中的每个环节编写单元测试，并编写集成测试以确保它们都适合。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T19:59:22.947

BDD 试图通过继承来解决这个问题。如果你习惯了，这确实是一种更简洁的编写单元测试的方式。

几个很好的链接：

*   [关联](http://www.lostechies.com/blogs/joe_ocampo/archive/2007/08/07/attempting-to-demystify-behavior-driven-development.aspx)
*   [关联](http://www.code-magazine.com/article.aspx?quickid=0805061)
*   [关联](http://jonkruger.com/blog/2008/07/25/why-behavior-driven-development-is-good/)
*   [关联](http://stevenharman.net/blog/archive/2009/01/14/saving-the-world-via-tdd.aspx)

问题是 BDD 需要一段时间才能掌握。

从最后一个链接 ( [Steve Harman](http://stevenharman.net) ) 中窃取的一个简单示例。注意每个测试方法只有一个断言。

```
using Skynet.Core

public class when_initializing_core_module
{
    ISkynetMasterController _skynet;

    public void establish_context()
    {
        //we'll stub it...you know...just in case
        _skynet = new MockRepository.GenerateStub<ISkynetMasterController>();
        _skynet.Initialize();
    }

    public void it_should_not_become_self_aware()
    {
        _skynet.AssertWasNotCalled(x => x.InitializeAutonomousExecutionMode());
    }

    public void it_should_default_to_human_friendly_mode()
    {
        _skynet.AssessHumans().ShouldEqual(RelationshipTypes.Friendly);
    }
}

public class when_attempting_to_wage_war_on_humans
{
    ISkynetMasterController _skynet;
    public void establish_context()
    {
        _skynet = new MockRepository.GenerateStub<ISkynetMasterController>();
        _skynet.Stub(x => 
            x.DeployRobotArmy(TargetTypes.Humans)).Throws<OperationInvalidException>();
    }

    public void because()
    {
        _skynet.DeployRobotArmy(TargetTypes.Humans);
    }

    public void it_should_not_allow_the_operation_to_succeed()
    {
        _skynet.AssertWasThrown<OperationInvalidException>();
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T20:19:51.213

依赖关系是否也相互依赖，必须按照确切的顺序调用它们？如果是这种情况，您实际上是在测试控制器流，这不是单元测试的实际目的。

例如，如果您的代码示例是 GPS 软件，您不是在测试实际功能，例如导航、计算正确路线等，而是用户可以打开它、输入一些数据、显示路线和关闭它再次。看到不同？

专注于测试模块功能，让更高级别的程序或质量保证测试完成您在本示例中尝试执行的操作。

# spring - 是否有一种静态方法可以在 Spring 中获取当前的 HttpServletRequest

> ID：592123
> 
> 赞同：49
> 
> 时间：2009-02-26T19:51:02.280
> 
> 标签：spring, servlets, request

我正在使用 Spring 注释，我可以将`HttpRequestContext`Controller 传递给 Service。

我正在寻找一种静态方式或任何比传递更好的解决方案`RequestContext`。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2014-10-12T09:10:44.993

如果您使用的是弹簧，您可以执行以下操作：

```
public static HttpServletRequest getCurrentHttpRequest(){
    RequestAttributes requestAttributes = RequestContextHolder.getRequestAttributes();
    if (requestAttributes instanceof ServletRequestAttributes) {
        HttpServletRequest request = ((ServletRequestAttributes)requestAttributes).getRequest();
        return request;
    }
    logger.debug("Not called in the context of an HTTP request");
    return null;
} 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2019-01-24T14:41:53.143

或者java8方式

```
public static Optional<HttpServletRequest> getCurrentHttpRequest() {
    return Optional.ofNullable(RequestContextHolder.getRequestAttributes())
        .filter(ServletRequestAttributes.class::isInstance)
        .map(ServletRequestAttributes.class::cast)
        .map(ServletRequestAttributes::getRequest);
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2020-07-05T09:52:26.640

作为参考，这将是 Kotlin 的方式：

```
 val currentRequest: HttpServletRequest?
        get() = (RequestContextHolder.getRequestAttributes() as? ServletRequestAttributes)?.request 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2020-08-17T14:21:39.853

作为对“或 Java 8 方式”上面的@andrebrait 评论的回应，这些方法出现在`ServletRequestAttributes.class`

```
 public static Optional<HttpServletRequest> getCurrentHttpRequest() {
        return
            Optional.ofNullable(
                RequestContextHolder.getRequestAttributes()
            )
            .filter(ServletRequestAttributes.class::isInstance)
            .map(ServletRequestAttributes.class::cast)
            .map(ServletRequestAttributes::getRequest);
    } 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2021-09-21T18:56:56.317

我知道，这已经是答案了。我想标记为新更新。我们可以`HttpServletRequest`使用`@Autowired`. 它在`springboot`.

```
@Autowired
private HttpServletRequest httpServletRequest; 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2021-03-11T11:17:30.483

这对我有用：

```
HttpServletRequest request = 
    ((ServletRequestAttributes) Objects.requireNonNull(
        RequestContextHolder.getRequestAttributes()))
    .getRequest(); 
```

# xcode - 我应该从 Vim 切换到 Emacs，如果是的话，有什么建议吗？

> ID：592125
> 
> 赞同：13
> 
> 时间：2009-02-26T19:51:48.893
> 
> 标签：xcode, vim, emacs, editor

首先，我喜欢 vim。我已经使用 vim 几年了，它改变了我对编辑器能力的看法。我也喜欢模式。

但是我正在考虑切换，原因如下：

我真的很喜欢 Xcode，它有 emacs 绑定。我使用 Mac OS X，它在所有文本输入字段中都有 emacs 功能。我讨厌使用鼠标，我认为切换是有意义的。

我也有点厌倦了在终端窗口中完成所有工作：使用 Xcode，我可以访问一个很棒的 IDE，以及一个很棒的无鼠编辑器 (emacs)。

说了这么多，我发现 emacs 元键方法有点不舒服，有点令人生畏，而且我花了很多时间学习在 vim 中做事。

我应该换吗？如果是这样，其他人是否进行了此转换或同时使用了 vim 和 emacs 并对他们更喜欢哪个以及为什么有意见？

同样对于使用过 Xcode 的 emacs 用户，Xcode 中的 emacs 实现有多好？值得换吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-26T20:20:57.997

为什么不能两者都用？使用 Emacs 并不意味着您必须停止使用 Vim。

学习和使用两者的好处：

*   对于某些特定的语言，有时一个编辑器比另一个更好。更好的语法高亮、更好的缩进规则、更好的宏、更好的与外部工具的集成等等。如果您能够在 Vim 和 Emacs 之间进行选择，那么您将始终使用最好的编辑器来完成这项工作。
*   有时，社区会倾向于一位编辑或另一位编辑。无论使用哪个，您都可以参与社区。
*   您可以从一个编辑器那里学习巧妙的技巧并将它们移植到另一个编辑器。如果您只坚持一个，这两个编辑器都具有您永远不会想到的功能。
*   如果某些计算机仅设置了其中一种，您仍然可以有效地使用它。
*   学习很有趣。
*   极客信誉。

缺点：

*   学习需要时间和精力。
*   碎片化和重复工作（所有你最喜欢的技巧和键盘映射都必须用 Vim 脚本和 elisp 编写两次）。

我看到利大于弊。

我将 Emacs 用于 Lisp 代码，并且因为我将 Lisp 用于 Web 开发，所以我也留在 Emacs 中用于 CSS 和 Javascript 等。我将 Vim 用于 Ruby、Python、Perl、PHP、BASH、纯文本以及几乎所有其他内容。两位编辑都有优点和缺点，但大多都有优点。

了解您更喜欢 Vim 还是 Emacs 的唯一方法是在两者上都投入时间，这样您就可以做出明智的决定。也许您会发现 Emacs 更适合您的思考和工作方式，也可能不适合。这是一件非常主观的事情，唯一知道的方法就是尝试。

文本编辑器不是宗教，您大脑中的可用磁盘空间可用于所有意图和目的，不受限制。因此，两者都使用并享受。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-26T19:54:28.107

不，一旦 vimer 永远是 vimer。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-26T19:54:53.333

请记住，emacs 具有 viper 模式，它允许您继续使用当前的 vi 键绑定。至于元键，我将大写锁定映射到 ctrl，将右移映射到 alt，对此我非常满意。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-26T19:54:43.350

这可能更容易：[Vi Input Manager Plugin](http://www.corsofamily.net/jcorso/vi/)（在 Xcode 中工作）

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-26T20:27:38.417

Mac OS X 和 Xcode 中没有太多的 Emacs 支持。它主要是几次击键。

Mac OS X 带有一个终端版本的 Emacs。适用于 Mac OS X 的一个非常好的 Emacs 是[Aquamacs](http://www.aquamacs.org)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-26T20:18:32.073

我会切换到 emacs（我每隔一段时间就会尝试一次）的唯一原因是因为出色的 elisp 包——特别是所有特殊的编辑模式和控制台/调试器模式。

我从未使用过 Xcode，但我从您的问题中假设这些只是 emacs 键绑定。即，您不能在 Xcode 中使用任何 emacs 包。

所以不行。我会说不要切换到emacs。如果你想使用 Xcode，要么学习键绑定，要么使用一些 Xcode vi 模式（正如其他人所建议的那样）。

# c# - 是否可以在运行时获取类摘要？

> ID：592139
> 
> 赞同：17
> 
> 时间：2009-02-26T19:54:12.740
> 
> 标签：c#, reflection, class, comments, summary

是否可以在 C# 中在运行时获取类摘要？我想通过反射获得课程摘要，然后将其写入控制台。类摘要是指类定义之前的摘要注释，如下所示：

```
/// <summary>
/// some description
/// </summary>
class SomeClass
{
} 
```

我不知道这些注释在编译代码后是否可用，但如果有的话，也许有办法在代码中获取它们。

提前感谢您的帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T20:00:03.553

前段时间我曾经搞砸过，并使用了这个家伙的解决方案。工作得很好：

[http://jimblackler.net/blog/?p=49](http://jimblackler.net/blog/?p=49)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-07-07T04:48:18.853

我在 CodePlex 上维护[Jolt.NET](http://jolt.codeplex.com)项目，并实现了执行此任务的功能。有关更多信息，请参阅[Jolt](http://jolt.codeplex.com/Wiki/View.aspx?title=Jolt)库。

本质上，该库允许您以编程方式定位和查询 XML 文档注释文件，以使用元数据类型`System.Reflection`（即`MethodInfo`，`PropertyInfo`等）中的程序集。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-26T19:58:09.363

不，它们不能通过反射获得。请参阅[msdn](http://msdn.microsoft.com/en-us/library/b2s063f7.aspx)：

> XML 文档注释不是元数据；它们不包含在已编译的程序集中，因此无法通过反射访问它们。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-26T19:59:29.297

您无法在运行时访问它们，因为它们被编译器视为注释。

但是，如果您想使用属性来指定信息并在运行时通过反射访问它，您可以这样做。

请参阅[创建自定义属性（C# 编程指南）](http://msdn.microsoft.com/en-us/library/sw480ze8.aspx)了解属性创建和[使用反射访问属性（C# 编程指南）](http://msdn.microsoft.com/en-us/library/z919e8tw.aspx)了解运行时访问。

来自 MSDN 的示例：

作者.cs：

```
public class Author : System.Attribute
{
    private string name;
    public double version;

    public Author(string name)
    {
        this.name = name;
        version = 1.0;
    }
} 
```

示例类.cs：

```
[Author("H. Ackerman", version = 1.1)]
class SampleClass
{
    // H. Ackerman's code goes here...
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-26T19:57:45.277

如果您发出 XML 文档文件，则可以。该过程将涉及使用反射来获取该类型的所有公共成员，然后使用 XPath 从生成的 XML 文档中读取文档。

更新：要将 XML 文档包含在您的 dll/exe 中，只需将其添加为嵌入式资源，并在文档更改时编译两次。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T19:58:25.070

不，这些注释不包含在您编译的程序集中。

Visual Studio 可以在包含这些注释的输出文件夹 (\bin\your_project.xml) 中创建一个 .xml 文件。如果您的应用程序与该 xml 文件一起分发，那么您将能够以编程方式访问它。

# python - 在 Python 中，创建和管理线程的首选方式是什么？

> ID：592143
> 
> 赞同：2
> 
> 时间：2009-02-26T19:54:47.793
> 
> 标签：python, multithreading

Python 提供了几种创建线程的方法。哪个提供最好的 API 和最多的控制？

谢谢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-26T20:00:54.333

必要时，[线程](http://docs.python.org/library/threading.html)模块及其高级接口是首选。当然，很多人认为它很少/从不需要，而且线程也不是很好处理。thread 模块对于一些奇怪的用例或其他可能是必需的，但我从来不需要它（当然，很久以前我很少使用线程）。还有一些其他模块可以做更整洁的事情，例如[multiprocessing](http://docs.python.org/library/multiprocessing.html)，这可能是有趣的。那不做线程，它只是共享接口（很酷）。我听说过关于它的好消息，但很长一段时间都没有想要像其中任何一个这样的东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-26T20:00:17.000

我相信该`threading`模块是推荐的。在 Python 3.x 中，该`thread`模块被重命名为 _thread，这意味着它是一个较低级别的接口。请参阅本页顶部的注释：

[http://docs.python.org/library/thread.html](http://docs.python.org/library/thread.html)

# apache-flex - 如何从匿名组件中删除事件侦听器？

> ID：592144
> 
> 赞同：3
> 
> 时间：2009-02-26T19:54:50.260
> 
> 标签：apache-flex, actionscript-3, events, listeners

> **可能重复：**
> [flash AS3 如何删除舞台事件侦听器](https://stackoverflow.com/questions/584787/flash-as3-how-do-i-remove-stage-event-listeners)

假设我有一个与组件绑定的事件侦听器，我想从组件中删除事件侦听器，以便对其进行垃圾收集。问题是我不知道它是什么类型的对象或它有什么事件监听器。

基本上我怎样才能找出一个对象有哪些事件侦听器以及如何删除其中一个或全部？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T20:01:07.733

复制。

添加事件侦听器时，通过将最后一个参数设置为 true 将其标记为弱引用。您不再需要担心删除它。[我在这里](https://stackoverflow.com/questions/584787/flash-as3-how-do-i-remove-stage-event-listeners/585004#585004)发布了一个较长的答案，所以你可能想看看。

# sql - SQL 包含的 HQL 等价物

> ID：592147
> 
> 赞同：17
> 
> 时间：2009-02-26T19:56:08.447
> 
> 标签：sql, hql, contains

我正在尝试编写一个 HQL 查询来选择包含子集合中的对象的对象。

例子：

**比赛对象**

```
ContestID  
ContestName  
RequiredCountries -> one to many collection of Country objects 
```

**国家对象**

```
CountryCode  
CountryName 
```

我想要的 sql 等价物：

```
SELECT * FROM CONTEST C  
WHERE C.CONTESTID IN(SELECT CONTESTID FROM CONTEST_COUNTRY CC INNER JOIN COUNTRY CTRY ON   
CC.COUNTRYCODE = CTRY.COUNTRYCODE WHERE COUNTRYCODE='USA') 
```

或者

```
SELECT * FROM CONTEST C  
WHERE EXISTS(SELECT CONTESTID FROM CONTEST_COUNTRY CC INNER JOIN COUNTRY CTRY ON 
CC.COUNTRYCODE = CTRY.COUNTRYCODE WHERE COUNTRYCODE='USA' AND CC.CONTESTID=C.CONTESTID) 
```

我有这个 hql，它可以工作，但似乎不是一个好的解决方案 -

```
from Contest C  
where (from Country where CountryCode = :CountryCode) =  some elements(C.RequiredCountries) 
```

我也考虑加入 Country，但由于我没有对象类来表示关系，我不确定如何加入 HQL。

有人有什么想法或建议吗？这应该很容易。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-02-26T21:29:06.430

试试这个：

```
from Contest Ct, Country Cr
where Cr.CountryCode = :CountryCode 
    and Cr.Country in elements(Ct.RequiredCountries) 
```

[相关文章](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/queryhql.html)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-08-01T15:05:45.093

前一个可以工作（至少它对我有用——我正在使用休眠），但“正确的方式”是“成员”运算符......像这样：

```
select ...
from Contest Ct, Country Cr
where Cr.CountryCode = :CountryCode
  and Cr.Country member of Ct.RequiredCountries 
```

（见[http://docs.oracle.com/javaee/6/tutorial/doc/bnbuf.html#bnbvk](http://docs.oracle.com/javaee/6/tutorial/doc/bnbuf.html#bnbvk)）

我认为elements() 是HQL 扩展。我认为尽可能使用标准（JPQL）会更好。

# c# - 如何在 StructureMap 中使用 InstanceScope.HttpSession？

> ID：592149
> 
> 赞同：2
> 
> 时间：2009-02-26T19:56:47.430
> 
> 标签：c#, dependency-injection, inversion-of-control, structuremap

我正在尝试使用 StructureMap 的 InstanceScope.HttpSession 功能，但遇到了问题。我有以下用于测试的方法：

```
public static class StructureMapTest {
    public static T Get<T>() {
        ObjectFactory.Configure(x => x.AddRegistry(new RepositoryRegistry()));
        return ObjectFactory.GetInstance<T>();
    }
} 
```

我的 RepositoryRegistry 类如下所示：

```
public class RepositoryRegistry : Registry {
    public RepositoryRegistry() {
        ForRequestedType<IClientRepository>()
            .CacheBy(InstanceScope.HttpSession)
            .TheDefault.Is.OfConcreteType<ClientRepository>();
    }
} 
```

因此，在我的客户端代码（ASP.NET MVC 控制器）中，我执行以下操作：

```
public ActionResult InjectionTest() {
    return Content(DataProvider.Clients.CreatedDate.ToString());
} 
```

每次我甚至从同一个会话中调用这个控制器时，我每次都会得到一个新实例。我在这里做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T06:50:39.107

将 ObjectFactory.Configure 移动到全局 asax。每次请求对象时，您不应该继续重新配置结构映射。

# sql-server - SQL Express 远程访问

> ID：592150
> 
> 赞同：0
> 
> 时间：2009-02-26T19:57:01.563
> 
> 标签：sql-server, sql-server-2005, sql-server-2005-express

有没有办法在配置允许远程访问时静默安装 SQL Express 2005，或者必须使用 SQL Server Management Studio UI 完成配置？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T08:25:03.290

安装 SQL 服务后，登录数据库并运行以下命令，然后重新启动 SQL 服务。

```
exec sp_configure 'remote access', 1
reconfigure 
```

这将允许远程访问该服务。如果要安装命名实例，则需要确保 SQL Browser 服务正在运行并设置为自动。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T20:02:48.087

问题之一是将 BROWSERSVCSTARTUP 设置为自动。检查 BOL，以防我输入错误的标志。我将不得不仔细考虑一下，并确定这是否是唯一的问题。

# c# - 如何将 DbType.Time 的 Datareader 结果转换为 Timespan 对象？

> ID：592151
> 
> 赞同：6
> 
> 时间：2009-02-26T19:57:07.960
> 
> 标签：c#, time, data-access, timespan, daab

我正在使用带有 DAAB 4.0 框架的 c# 从数据读取器中读取列类型为 dbtype.time 的 MS SQL 2008 数据库的结果。

我的问题是 MSDN 文档说 dbtype.time 应该映射到时间跨度，但我看到的唯一关闭的时间跨度构造函数接受 long，并且从数据读取器返回的结果不能转换为 long 或直接转换为时间跨度。

我发现这篇[文章](http://blogs.msdn.com/usisvde/archive/2007/11/14/time-for-ado-net.aspx)显示了 datareader.getTimeSpan() 方法，但是 daab 4.0 中的 datareader 似乎没有这个方法。

那么如何将数据读取器的结果转换为时间跨度对象呢？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-26T20:08:34.127

你试过这样的直接演员吗？

```
TimeSpan span = (TimeSpan)reader["timeField"]; 
```

I just tested this quickly on my machine and works fine when "timeField" is a Time datatype in the database (SQL).

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-26T20:05:05.790

`GetTimeSpan`是`OleDbDataReader`and的一个方法`SqlDataReader`（但不是 DAAB`ExecuteReader`返回的更通用的 IDataReader 接口）。我假设`IDataReader`DAAB 返回给您的实例实际上是`SqlDataReader`. 这允许您通过适当地转换实例来访问该`GetTimeSpan`方法：`IDataReader`

```
using (IDataReader dr = db.ExecuteReader(command))
{
    /* ... your code ... */
    if (dr is SqlDataReader)
    {
        TimeSpan myTimeSpan = ((SqlDataReader)dr).GetTimeSpan(columnIndex)
    }
    else
    {
        throw new Exception("The DataReader is not a SqlDataReader")
    }
    /* ... your code ... */
} 
```

编辑：如果`IDataReader`实例不是，`SqlDataReader`那么您可能缺少`provider`在 app.config（或 web.config）中定义的连接字符串的属性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-09T18:21:55.530

Here's my take:

```
 using (IDataReader reader = db.ExecuteReader(command))
{
    var timeSpan = reader.GetDateTime(index).TimeOfDay;
} 
```

Cleaner, perhaps!

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T20:05:50.920

列值的 .NET 类型是什么？如果它是 DateTime，那么您可以将其 Ticks 属性 (long) 的值传递给 TimeSpan 构造函数。例如

```
var span = new TimeSpan(colValue.Ticks); 
```

# http - Joomla！错误的 BASE HREF 将 HTTP 更改为 HTTPS

> ID：592156
> 
> 赞同：1
> 
> 时间：2009-02-26T19:58:01.360
> 
> 标签：http, https, joomla, href

我刚刚移动了我的 Joomla！从[BradPPresents.com](http://BradPPresents.com)到[BradP.com](http://BradP.com)的网站。没有裸体，但可能不是 SFW

在不安全的 HTTP 访问上一切正常；但是一旦站点更改为 HTTPS：BASE HREF 就会恢复为旧网址“BradPPresents.com”。

我已经更改了我能找到的所有 BradPPresents.com 实例，但没有成功。

有谁知道该怎么做？随意查看该网站并进行实验。

谢谢你。最好的，尼克

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-14T11:59:55.640

我相信您真正需要更改的唯一地方是 configuration.php 文件。不得保留对 BradPPresents.com 的单一引用

我最近将一个 Joomla 站点从一个地方移动到另一个地方，所要做的只是摆弄一下 configuration.php 文件。

# c++ - 静态与外部“C”/“C++”

> ID：592160
> 
> 赞同：22
> 
> 时间：2009-02-26T19:58:32.247
> 
> 标签：c++, function-pointers, static-members, linkage, extern-c

静态成员函数和外部“C”链接函数有什么区别？例如，在 C++ 中使用“makecontext”时，我需要传递一个指向函数的指针。Google 建议使用外部“C”链接，因为“makecontext”是 C。但我发现使用静态也可以。我只是幸运还是...

```
class X {
   public:
   static void proxy(int i) {}
}
makecontext(..., (void (*)(void)) X::proxy, ...); 
```

对比

```
extern "C" void proxy(int i) {}
makecontext(..., (void (*)(void)) proxy, ...); 
```

编辑：您能否展示静态成员版本不起作用的编译器或体系结构（并且它不是编译器中的错误）？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-26T20:06:24.913

是的，你很幸运 :) extern "C" 是每个 C++ 编译器都必须支持的 C 语言的一种语言链接，除了默认的 extern "C++"。编译器可能支持其他语言链接。例如，GCC 支持 extern "Java"，它允许与 java 代码交互（虽然这很麻烦）。

extern "C" 告诉编译器你的函数可以被 C 代码调用。这可以但不是必须包括适当的调用约定和适当的 C 语言名称修饰（有时称为“装饰”）等，具体取决于实现。如果你有一个静态成员函数，它的调用约定是你的 C++ 编译器之一。通常它们与该平台的 C 编译器相同 - 所以我说你很幸运。如果你有一个 C API 并且你传递了一个函数指针，最好总是把一个指向用 extern "C" 声明的函数，比如

```
extern "C" void foo() { ... } 
```

即使函数指针类型不包含链接规范，而是看起来像

```
void(*)(void) 
```

链接是类型的一个组成部分 - 如果没有 typedef，您将无法直接表达它：

```
extern "C" typedef void(*extern_c_funptr_t)(); 
```

Comeau C++ 编译器在严格模式下会发出错误，例如，如果您尝试将上面的 extern "C" 函数的地址分配给 a `(void(*)())`，因为这是指向具有 C++ 链接的函数的指针。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-26T20:07:09.263

请注意，这`extern C`是 C/C++ 互操作性的**推荐**方式。[这里](http://www.stroustrup.com/bs_faq2.html#callC)是大师讲的。添加到 eduffy 的答案：请注意，全局命名空间中的静态函数和变量已被弃用。至少使用匿名命名空间。

回到`extern C`：如果您不使用 extern C，您将必须知道确切的损坏名称并使用它。那更痛苦。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-26T20:02:33.597

`extern "C"`禁用 C++ 编译器的名称修饰（重载所必需的）。

如果将 A.cpp 中的函数声明为`static`，则 B.cpp 无法找到它（它是 C 的剩余部分，它与将函数放入匿名命名空间中的效果相同）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-26T20:26:24.817

所做的大部分工作`extern "C"`在很大程度上取决于编译器。许多平台根据声明更改名称修饰和调用约定，但标准都没有指定。实际上，该标准唯一需要的是块中的代码可以从 C 函数中调用。至于你的具体问题，标准说：

> 具有不同语言链接的两个函数类型是不同的类型，即使它们在其他方面相同。

这意味着`extern "C" void proxy(int i) {}`并且`/*extern "C++"*/void proxy(int i) {}`具有不同的类型，因此指向这些函数的指针也将具有不同的类型。编译器不会使您的代码失败，原因与它不会使一项伟大的工作失败的原因相同，例如：

```
int *foo = (int*)50;
makecontext(..., (void (*)(void)) foo, ...); 
```

此代码可能在某些平台上工作，但这并不意味着它可以在另一个平台上工作（即使编译器完全符合标准）。您正在利用您的特定平台的工作方式，如果您不关心编写可移植代码，这可能没问题。

至于静态成员函数，它们不需要有`this`指针，因此编译器可以自由地将它们视为非成员函数。同样，这里的行为是特定于平台的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-08-06T09:14:20.397

一般来说

**存储类：**

存储类用于指示变量或标识符的持续时间和范围。

**期间：**

持续时间表示变量的生命周期。

**范围：**

范围表示变量的可见性。

**静态存储类：**

静态存储类用于声明一个标识符，该标识符是函数或文件的局部变量，并且在控制从声明的位置传递后存在并保留其值。此存储类具有永久的持续时间。此类声明的变量在函数的一次调用到下一次调用中保留其值。范围是本地的。变量仅由它在其中声明的函数知道，或者如果在文件中全局声明，它仅由该文件中的函数知道或看到。这个存储类保证变量的声明也将变量初始化为零或所有位关闭。

**外部存储类：**

extern 存储类用于声明一个全局变量，该全局变量将被文件中的函数知道并且能够被程序中的所有函数知道。此存储类具有永久的持续时间。此类的任何变量都保留其值，直到被另一个赋值更改。范围是全球性的。程序中的所有函数都可以知道或看到变量。

# ide - 您多久重新评估和升级您的开发环境和开发。工具？

> ID：592172
> 
> 赞同：6
> 
> 时间：2009-02-26T20:00:57.810
> 
> 标签：ide, development-environment

我很好奇其他软件开发人员多久重新评估他们的开发环境和工具。我曾经在一家大公司工作，拥有每个人都讨厌的死板工具集，但却无能为力。所以没有人真正更新他们的开发环境，因为我们不能在那个环境中。

现在我在自己的初创公司中，我发现我可以花无数时间评估新工具和开发环境，但我真的不应该也负担不起。我已承诺每月花 1 天时间研究新的开发工具并试用它们，看看是否值得转换。

您多久试用一次新的 IDE、编辑器、错误跟踪工具、调试器？或者更新到您自己的新版本？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T20:06:10.763

这是一个持续的过程，但我不会比每两年左右更频繁地进行重大更改。一个重大的改变需要太多的时间，而且这种权衡通常是不值得的。主要更改可能被定义为更改现有项目的整个目标或编译器架构和工具链。

请注意，项目之间可能会发生重大变化——一个新项目可以采用完全不同的架构和工具链，而无需大量成本。但是应该注意不要在这里太过分了。需要一个评估过程来防止选择在以后项目变得复杂时不支持项目的设置。

但是对于较小的更改，我只是在找到机会和理由时升级我的工具和环境。

-亚当

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T20:07:08.793

对我来说，升级是事件驱动的，而不是计时器驱动的。我密切关注新工具（库、IDE、CASE 工具等），并在它们出现在我的雷达上时对其进行评估。

使用 Microsoft 技术，如果没有令人信服的理由阻止我，我会迁移到最新版本。对于 OSS，我使用我所知道的，除非有什么令人信服的东西推动我前进。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-26T20:32:50.370

**IDE 的**. 我倾向于坚持使用我知道会成长并支持我的语言的语言。在我的开发环境中，它是[vim](http://en.wikipedia.org/wiki/Integrated_development_environment#Attitudes_across_different_computing_platforms)。它正在积极开发中，并且有许多脚本（有点像插件）以及 DIY 文档。学习 IDE 也需要时间，而精通它、有效地使用它需要更多时间。

**修订控制**。我尽量保持在最前沿。新功能的好处很重要。例如 Subversion 1.4，仅支持基本合并。Subversion 1.5 大修了他们的合并系统，并添加了[新功能](http://svn.collab.net/repos/svn/tags/1.5.0/CHANGES)。

**任务和项目管理**。我倾向于每隔几年才这样做一次，并且只有在有良好的感知利益的情况下。否则，我将继续每隔几个月将我当前的系统升级到当前的稳定版本。

**图书馆**。他们是一个折腾。因为我所做的大多数事情都不会以出货的产品告终。我觉得经常升级更自由，但是当向后可比性被破坏时，我们倾向于回避升级。

希望我的 0.02 美元有用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-26T20:13:12.697

在工作中，当我们的版本达到支持生命周期结束时，我们会升级工具。我们升级到下一个旧版本。

在家里，我一找到新东西的免费副本就升级（例如，参加 3 次网络广播的某些交易会向您发送 vs2008 标准版、用户组等的副本）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-26T20:09:01.363

我只会更新，除非我真的错过了某个功能，或者意识到不使用一种工具而不是另一种工具会导致更多任务花费更长的时间/效率降低。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-01-11T19:15:38.127

IDE - 这可能很棘手，但这些年来我经历了一些不同的进展。有时，参与项目或特定功能可能会触发升级。例如，有人使用 LINQ 实现了一项功能，因此 ASP.Net 2.0 项目在一夜之间变成了 3.5 项目。其他时候，它只是当前使用的。这里的一点是，更改会影响整个团队，因此不能轻易做出更改。

错误跟踪工具 - 这也是必须仔细管理的集中式东西的土地。由于这是一个 QA 工具，我希望他们有自己的策略来查找更新的频率以及何时安装它们，因为有时新功能可能很酷。开发团队等价于何时更新 wiki。

版本控制——这些都是单独管理的，因为我们大多数人都使用 Tortoise SVN，所以我们每个人都有一个本地客户端副本。因此，当有人想要更新时，更新就完成了。就个人而言，我喜欢尽可能地了解最新情况。

操作系统——虽然其中一部分可以在部门基础上进行控制，但有足够多的不同部分需要更新，有时我会自己运行更新。我不确定我们什么时候会迁移到 Windows 7，因为我知道我们不会迁移到 Vista，而且我认为在某个时候我们会离开 XP，因为我已经使用 XP 大约 5 年了在此之前，我使用了几年的 Windows 2000 Professional 和 NT 4.0。

PC - 我相信每 3 年我们都会购买新机器的政策。当我开始现在的位置时，我使用的是 P4 机箱，因此升级到双核机箱非常好，并且 RAM 从 2 GB 提升到 4 GB。

# apache-flex - 在 Flex 中，删除在 Flash CS3 中创作的 swf 的最佳方法是什么？

> ID：592175
> 
> 赞同：2
> 
> 时间：2009-02-26T20:01:17.123
> 
> 标签：apache-flex, actionscript-3, memory-management, flash

所以，我有一个应用程序，我将在其中将任意数量的 swf 加载到 SWFLoader 中并在运行时删除它们。问题是 - 它们都是在 Flash CS3 中创作的基于时间线的电影。除了作者无法编程任何交互性（即没有事件侦听器）之外，我几乎无法控制电影中的内容，但我想确保我使用最好的技术来停止和丢弃这些东西，这样他们就不会'不要在记忆中停留太久。这是我现在用来摆脱它们的过程：

1.  尝试使用 MovieClip(content).stop(); 停止内容
2.  删除我知道的所有听众（ENTER_FRAME等...）
3.  将 SWFLoader 的源设置为 null。
4.  交叉手指，祈祷，做出牺牲（如果需要，人）

所以这似乎可行，但你们用一些更好（或更全面）的方法来完成同样的任务？老实说 - 我不完全确定这些东西不只是保存在记忆中，但我没有听到它们，所以我不知道它们在那里......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T06:42:49.483

[这是非常正确的](http://www.gskinner.com/blog/archives/2008/04/failure_to_unlo.html)。加载程序（SWFLoader 在后台使用），使用 .unload() 从舞台上删除它加载的剪辑，但根据剪辑引用的内容，剪辑仍然运行并且事件仍然触发。

Flash Player 10 添加了 .unloadAndStop()，但这主要是在做同样的事情。

您还可以尝试在 Loader.load() 的可选 LoaderContext 参数中提供一个显式的 SecurityDomain（可能还有 ApplicationDomain，因此任何包含的类也是独立的），以防止它在外部添加事件侦听器（如果您不信任剪辑不要），并避免形成对剪辑中任何内容的任何引用，以便可以将其作为垃圾收集 - 但显然在某些情况下它可能*仍然无法卸载。*

# wpf - 表达混合书籍？

> ID：592176
> 
> 赞同：2
> 
> 时间：2009-02-26T20:01:18.543
> 
> 标签：wpf, silverlight, xaml, expression-blend

那里有什么好的 Expression Blend 书籍吗？帮助文件比我预期的要好。但我真的很想加快速度。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T20:06:19.280

如果您正在从设计师的角度寻找一本书，目前最好的书是 Victor Guadioso 的 Foundation Expression Blend 2。它让我想起了用于图形程序的旧 PeachPit Press 书籍。书中也有一些代码，但更侧重于工具。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T18:41:25.963

我向您推荐Gurdy 和 Mary Leete 的[“Microsoft Expression Blend Bible”](https://rads.stackoverflow.com/amzn/click/com/0470055030)。这本书绝对值得一读。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T18:48:51.703

关于 SO 的一些相关讨论可能会有所帮助：

[https://stackoverflow.com/questions/562948/do-you-have-any-recommendations-on-blend-xaml-books-tutorials-for-designers](https://stackoverflow.com/questions/562948/do-you-have-any-recommendations-on-blend-xaml-books-tutorials-for-designers)

[学习 Expressions Blend 2 的最佳方法是什么？](https://stackoverflow.com/questions/369551/what-is-the-best-way-to-learn-expressions-blend-2)

[https://stackoverflow.com/questions/625407/expression-blend-2-wpf-book](https://stackoverflow.com/questions/625407/expression-blend-2-wpf-book)

# svn - SVN 将整个文件标记为冲突

> ID：592181
> 
> 赞同：5
> 
> 时间：2009-02-26T20:02:31.037
> 
> 标签：svn

我是 SVN 的新手。在一个分支上工作了一天左右后，我尝试将主干的更改合并到分支：

```
svn merge svn://server/trunk 
```

问题是，每当 SVN 遇到冲突文件时，它无法识别逐行更改并将整行标记为冲突。我尝试了其他几个 SVN 客户端，还尝试在没有任何进展的情况下切换 end-line 和 white-space 选项。我究竟做错了什么？我认为这是最简单的合并案例，所以我希望这适用于最默认的 Subversion 设置、任何客户端和任何 SVN 版本。它是一些已知的初学者的渔获吗？

客户端：1.5.5 (SlikSvn:tag/1.5.5@34877) WIN32

服务器：1.4.6 (r28521)，Windows

**编辑**

根据以下评论和答案中的建议，我进行了更多调查：

1.  有问题的文件是 UTF8。

2.  他们没有任何 SVN 属性。

3.  “svn diff”命令正确识别差异。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T21:45:15.313

我们最近遇到了这个问题，发现是使用 1.4.x 服务器和 1.5.x 客户端的问题。Subversion 1.5 引入了更智能的合并，但您需要服务器和客户端运行 1.5 才能利用这一点。

我们发现，指定我们想要合并的修订号范围会产生预期的结果。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T22:57:16.733

我选择了马克的答案。这只是为了总结和提供更多细节。我的问题是由于我们使用的是 SVN 1.4，它不支持更高级的 1.5 合并功能。如所选答案所示，我发现我必须使用以下格式的 SVN 合并命令（以防我想将更改从主干传播到我的分支）：

```
svn merge svn://dpr/branches/abc@REV svn://dpr/trunk@REV 
```

我想我的困惑是由于我使用的 SVN 书和客户端默默地假设我已经在运行 1.5 并且示例和默认合并方法正在使用新功能。公平地说，SVN 书籍中基本合并部分的介绍中提到了它（我只有在解决问题时才注意到）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T20:12:06.863

你试过使用[TortoiseSVN](http://tortoisesvn.tigris.org/)吗？它与 ToroiseMerge 捆绑在一起，我发现它也是一个不错的合并。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T20:49:37.633

我没有大量使用过 SVN，而且我只是通过 eclipse 插件使用它，但在某些情况下，您可能只需要告诉它使用哪种情况（您的本地文件与远程文件）。合并一组不相交的传出和传入更改通常不是问题，但是如果一行与某些类型的更改冲突（在 eclipse 中它将整行/块标记为红色），您可能只需要接受一个或另一个，因为它可能不会自行进一步合并。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T20:53:33.490

检查文件的 svn:mime-type 属性。如果有这样一个属性集并且它的值不是以'text/'开头的，那么Subversion会将这些文件视为二进制文件而不是文本文件。

如果你的文件是用 utf-16 编码的，Subversion 也会默认将这些文件视为二进制文件。

# sharepoint-2007 - Sharepoint Doc Lib 内容类型

> ID：592188
> 
> 赞同：0
> 
> 时间：2009-02-26T20:04:19.317
> 
> 标签：sharepoint-2007, workflow, document-library

因此，当用户在我的 sharepoint 文档库中创建一个新文件夹时，我希望在新文件夹中添加 4 个模板文档。我知道用户只需单击每个模板个人的文档模板，但我希望它们一直添加。

似乎没有将模板文档添加到文档库文件夹内容类型的选项。

Sooo .... 是我创建自定义共享点工作流的唯一选择，该工作流检查我的文档库中的文件夹创建。（理想情况下，可能将其限制为仅在创建我的自定义内容类型的特定文件夹时。）这似乎是一个简单的创建工作流程，但我想确保我什至需要创建一个，因为我实际上并没有创建一个自定义共享点工作流程尚未...

谢谢，

克里斯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T20:31:53.057

你是对的; 没有内置功能。编写一个在将某些内容添加到库时运行的工作流应该是相当简单的，检查它是否是一个文件夹，并将项目添加到文件夹中。将模板文档放在另一个文件夹中可能是最简单的，然后将它们复制过来。

祝你好运！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T21:03:36.467

我发现这个例子很有帮助：

[http://www.codeproject.com/KB/sharepoint/MOSS_FolderContentTypeWF.aspx](http://www.codeproject.com/KB/sharepoint/MOSS_FolderContentTypeWF.aspx)

# c# - 使用 OpenXML SDK 在 Excel 电子表格中创建单元格注释

> ID：592189
> 
> 赞同：2
> 
> 时间：2009-02-26T20:04:41.890
> 
> 标签：c#, excel, comments, openxml

我正在尝试向 Excel 2007 电子表格中的单元格添加注释。我正在使用 OpenXml SDK 2.0 来执行此操作。

我的用例是这样的：我创建了一个模板 Excel 文件，我将其复制并用作我的起点，而不是从头开始创建一个 OpenXML 文档。我的模板文件在单元格 A1 中有注释，因此 Excel 已经为我创建了 WorksheetCommentPart。

现在我的问题是，当我将评论节点添加到评论部分时，电子表格不会加载，Excel 会询问我是否要恢复。

真正困扰我的是我在 A1 中的原始评论仍然存在，但我以编程方式添加的任何评论都消失了！

这是我正在使用的代码：

使用 (MemoryStream 电子表格流 = 新的 MemoryStream()) { GetGradebookSpreadsheetTemplate(spreadsheetStream);

```
using (SpreadsheetDocument spDoc = SpreadsheetDocument.Open(spreadsheetStream, true))
{
    WorkbookPart wbPart = spDoc.WorkbookPart;
    WorksheetPart wsPart = wbPart.WorksheetParts.First();
    SheetData sheet = wsPart.Worksheet.GetFirstChild<SheetData>();
    Comments comments = wsPart.WorksheetCommentsPart.Comments;
    comments.Descendants<Author>().First().Text = string.Format("{0}, {1}", instructor.LastName, instructor.FirstName);
    comments.Descendants<Text>().First().Text = string.Format("{0}, {1}", instructor.LastName, instructor.FirstName);
    List<DefinedName> definedNames = new List<DefinedName>();
    definedNames.Add(CreateDefinedName("COLWeb_Gradebook", sheet.NamespaceURI, "Gradebook", "1", "A"));

    uint index = 4;
    foreach (User u in users)
        CreateUserDataRow(index++, definedNames, comments.CommentList, sheet, u, coursesForUsers[u], assignments, submissions[u]);
    Cell lastCell = sheet.Descendants<Cell>().Last();
    OpenXmlElement dimensionsElement = wsPart.Worksheet.Elements().Where(x => x.LocalName == "dimension").First();
    dimensionsElement.SetAttribute(new OpenXmlAttribute("ref", null, "A1:" + lastCell.CellReference));

    comments.Save();
    wsPart.Worksheet.Save();
    wbPart.Workbook.Save();
}

return spreadsheetStream.ToArray(); 
```

}

并且“CreateUserDataRow”创建一个新行，但相关部分是（其中“comment”是我的评论字符串，“c”是我想要创建评论的单元格）：

```
if (!string.IsNullOrEmpty(comment))
{
    List<OpenXmlElement> runs = new List<OpenXmlElement>();

    foreach (string row in comment.Split(new string[] { "<p>", "</p>" }, StringSplitOptions.RemoveEmptyEntries))
    {
        string trimmed = row.Trim();
        if (!string.IsNullOrEmpty(trimmed))
        {
            string escaped = System.Security.SecurityElement.Escape(trimmed);
            runs.Add(new Run(new RunProperties(), new Text(escaped)));
        }
    }

    Comment commentCell = new Comment();
    commentCell.Reference = c.CellReference;
    commentCell.AuthorId = 0;
    commentCell.AppendChild(new CommentText(runs));
    comments.AppendChild(commentCell);
} 
```

现在，就我的眼睛和 KDiff3 而言，我的文件与我打开 Excel 并在 Excel 中手动将注释放入单元格时输出的文件几乎相同。

有没有人有一个使用 OpenXml 将评论附加到单元格的好例子？关于一段关系，有什么我应该知道的吗？它是否与使用我创建的 Excel 文件有关，然后我将其用作模板（可能未设置某些尺寸）？

感谢我能得到的任何帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T21:48:19.393

不幸的是，事情并没有那么简单。

单元格注释也有一个图形对象，它位于 VML 绘图部件中。VML 是一个神秘的遗留规范，不在批准的 ECMA 标准中。您可以在 Microsoft 的 Open XML 文档中找到有关它的文档，但它并不漂亮。希望微软将在 Excel 14 中通过添加完整的单元格注释支持以及对也写入 VML 的控件的支持来解决这个问题。

话虽如此，我还没有使用过 Open XML SDK，也不能说是否可以使用它添加注释。我只是认为这可能会帮助您指出正确的方向。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-12-02T02:54:47.600

[http://openxmldeveloper.org/forums/thread/7396.aspx](http://openxmldeveloper.org/forums/thread/7396.aspx)上似乎有一个代码示例，它显示了如何创建必要的 VML 绘图。我现在正在尝试此代码，并且似乎已经取得了进展，尽管我仍然遇到某种未指明的错误，其中 Excel 决定在打开之前删除评论......

# testing - 测试任何网页方法

> ID：592191
> 
> 赞同：2
> 
> 时间：2009-02-26T20:04:57.473
> 
> 标签：testing, qa

一种方法应该如何测试带有标签（链接到其他页面）、框架或表单的网页？一般的方法应该是什么？各种测试用例可能是什么？

我被要求参加初级 QA 工程师职位的面试，而无需非常具体。而且，我不能很清楚地理解这个问题。

我能想到的一些测试用例： 1\. 使用各种浏览器来显示页面

2.  通过添加/删除某些字段来修改页面的地址

3.  对于需要数字输入的表单，输入边界值、一个合法值和几个无效值。对其他领域应用相同的逻辑。

我无法从面试官那里得到任何好的反馈。还有其他想法/建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T20:18:24.557

除了通常的功能软件测试（如 SQL 注入、业务用例和诸如此类的东西）对所有软件都适用之外，您还应该使用 Web 软件进行一些测试：

1.  通过不同的 Internet 连接进行测试
2.  使用在客户端上运行的不同网络使用应用程序进行测试（该站点是否在运行的比特洪流应用程序中工作？）
3.  使用多个浏览器、多个插件、定义不同的默认配色方案和默认字体大小/缩放级别/字体面进行测试。
4.  禁用 JavaScript（并不总是适用）
5.  摆弄 HTTP GET 和 POST 请求以确保正确处理验证。

根据应用程序，您可能还想在手机和视频游戏机的嵌入式浏览器上进行测试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T20:20:53.927

您列出的测试用例都很好。其他一些要考虑的。

*   确保所有用户输入都经过验证和清理。任何进入数据库的东西都可能是注入攻击。任何显示用户输入数据的东西都可能被用作跨站劫持。

*   如果站点使用 javaScript，如果禁用 javaScript，它是否仍然起作用/提供替代方案，对于 flash 也是如此

*   除了标准显示器之外，您是否有适用于其他设备的 CSS？用户能否以可接受的方式在手持设备上查看网站？打印机呢？

*   可访问性问题。是否有图像等的替代标题？

*   搜索引擎呢？网站/页面机器人友好吗？

*   更多的是一个设计问题：网站是否做/展示了公司认为重要的事情或用户认为重要的事情。

这些只是我脑海中的一些。要完成一份完整的工作，还有很多事情要做。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T05:53:32.787

当被问及测试的东西时，总是比你最初的反应推得更远。每当人们问这类问题时，他们都想看看你能谈论多久测试用例。更长的时间几乎总是更好。

一些我没有看到的 Web 应用程序测试： -安全性 - 涉及到这方面的所有方面 - 跨站点脚本，它是否包含安全数据？如果是这样，这些数据是如何处理的？

-负载测试。网站应该能够同时处理大量用户。您需要对此进行测试以确保它可以。通过负载和压力测试，通常可以尝试找到站点/系统的断点，然后验证该断点是否可以接受。

- 网站可以用多种语言浏览吗？如果使用了良好的字符编码，它应该可以正常工作。如果不是，那么它可能会显示为奇怪的字符。

- 尝试发送比它通常接受的值大得多的值。输入字段有限制吗？它会给出错误吗？或者只是炸毁？

- 如上所述，展示一些关于自动化工具的见解。你可以建立什么样的自动化框架？你能自己做工具吗？什么工具会很好用？等等

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-28T04:49:12.930

上面的答案给出了一些很好的例子，说明如何以及如何测试有关 Web 应用程序的内容。

我将快速回复您问题中的其他几点：

当我面试我们 QA 团队的职位时，我有两个主要关注点：面试者的思维*方式和他们对底层技术领域的了解。*

我采访过一些学生和专业人士，他们测试应用程序的想法是“打开它，看看它是否冒烟”。他们通常对产品技术有深刻的理解（例如 HTTP 的最内部工作原理），但他们无法将这些知识与实际和系统的应用程序联系起来（例如，如何测试通过 HTTP 与服务器通信的数据库应用程序）。

我也被那些根本不了解所使用的底层技术（例如网络工具、简单的 Java 应用程序、数据库客户端）的受访者淹没在测试用例中。尽管他们能够提供大量测试，但他们缺乏理解极大地削弱了他们获得有洞察力和*有用的测试用例的能力。*

无论哪种情况，我都强烈建议（对于任何类型的面试）你在面试之前首先研究你将工作的领域。不要只是试图整合行话和流行语（如果你弄错了，你会看起来很愚蠢），而是要调查这个职位，以了解它的含义。在面试之前你知道的越多，你就越能理解问题的背景。

此外，请毫不犹豫地要求澄清面试问题。当有人不明白我在问什么并试图伪造它时，我会很生气。如果有人让我改写或澄清我说过的话，我通常认为这是一个希望准确沟通的人的好兆头。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T05:40:06.140

对于奖励点，我还提到使用 WinRunner 或其他自动化 GUI 测试工具，这样您就不必为每个版本手动运行测试。

面试官喜欢跳出框框思考的人:)

# unix - cat 和 grep 匹配的文件名和行号

> ID：592194
> 
> 赞同：7
> 
> 时间：2009-02-26T20:05:12.403
> 
> 标签：unix, grep, cat

我的代码

```
$  *.php | grep google 
```

如何打印每个匹配项旁边的文件名和行号？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-26T20:07:18.543

```
grep google *.php 
```

如果你想跨越多个目录：

```
find . -name \*.php -print0 | xargs -0 grep -n -H google 
```

（如评论中所述，如果 xargs 仅提供一个剩余文件，则 -H 很有用）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-26T20:16:40.677

你不应该这样做

```
$ *.php | grep 
```

这意味着“运行第一个 PHP 程序，将其余通配符的名称作为参数，然后在输出上运行 grep”。

它应该是：

```
$ grep -n -H "google" *.php 
```

`-n`标志告诉它做行号，标志`-H`告诉它即使只有文件也显示文件名。如果搜索多个文件，Grep 将默认显示文件名，但您可能希望确保输出是一致的，无论有多少匹配文件。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-04-06T01:45:37.267

```
grep -RH "google" *.php 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-04-08T22:40:06.587

请查看[http://betterthangrep.com](http://betterthangrep.com)上的 ack 。ack 你正在尝试的等价物是：

```
ack google --php 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-05T21:21:24.347

```
find ./*.php -exec grep -l 'google' {} \; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T20:09:21.770

使用“man grep”查看其他功能。

```
for i in $(ls *.php); do  grep -n --with-filename "google" $i; done; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-14T12:27:03.707

```
find . -name "*.php" -print | xargs grep -n "searchstring" 
```

# apache-flex - 为什么在更新 HierarchicalData dataProvider 时 AdvancedDataGrid 不更新？

> ID：592198
> 
> 赞同：1
> 
> 时间：2009-02-26T20:05:50.157
> 
> 标签：apache-flex, actionscript-3, hierarchical-data, advanceddatagrid

我有一个带有 HierarchicalData 数据提供者的 AdvancedDataGrid (ADG)：

```
<mx:AdvancedDataGrid xmlns:mx="http://www.adobe.com/2006/mxml"
    dataProvider="{__model.myHierarchicalData}" 
    displayItemsExpanded="true" sortExpertMode="true" dropEnabled="true" 
    sortableColumns="false" draggableColumns="false" 
    resizableColumns="true" textAlign="left" defaultLeafIcon="{null}" 
    folderOpenIcon="{null}" folderClosedIcon="{null}"/> 
```

当我最初在模型中设置 HierarchicalData 实例时，它按预期显示：

```
function buildHierarchicalData(parentItems:ArrayCollection):void
{
    __model.myHierarchicalData = new HierarchicalData();

    __model.myHierarchicalData.source = parentItems;
} 
```

**parentItems**是 ParentItem 值对象的集合：

```
package
{
    [Bindable]
    public class ParentItem
    {
        public var children:ArrayCollection;

        public var label:String;
    }
} 
```

但是，当我将子项从一个父项移动到另一个父项（通过拖放）时，更新不可见，使用以下代码：

```
function moveChildren(movedChildren:Array /* of ParentItem */):void
{
    parentItem.children = new ArrayCollection(movedChildren);
} 
```

但是，出于某种原因，这确实有效：

```
function moveChildren(movedChildren:Array /* of ParentItem */):void
{
    parentItem.children.source = movedChildren;
} 
```

为什么我必须更新 ArrayCollection 的来源？？？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T20:11:51.873

看到[这个](http://livedocs.adobe.com/flex/3/html/help.html?content=advdatagrid_07.html)。建议`ArrayCollection`在处理`dataProviders`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T21:26:53.627

感谢dirkgently引导我找到答案。我现在不再需要在我的模型中使用 HierarchicalData 属性，而是在 MXML 中设置 Hierarchical dataProvider：

```
<mx:AdvancedDataGrid xmlns:mx="http://www.adobe.com/2006/mxml">
    <mx:dataProvider>
        <mx:HierarchicalData source="{__model.parentItems}" />
    </mx:dataProvider>
</mx:AdvancedDataGrid> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-20T17:57:58.427

尝试

```
IHierarchicalCollectionView(__model.myHierarchicalData).refresh(); 
```

# .net - WCF中的奇怪超时异常

> ID：592206
> 
> 赞同：1
> 
> 时间：2009-02-26T20:06:49.187
> 
> 标签：.net, wcf

我有一个 Web 应用程序正在与 Windows 服务中托管的 WCF 服务通信。每隔一段时间，我就会开始看到 EventLog 错误，指出对 WCF 服务的请求在 1 分钟后超时。我理解这个错误（尽管为什么需要这么长时间才能做出回应是个谜）。真正让我困惑的是这个错误：

> 00:00:00 后打开超时，同时建立到 net.pipe://localhost/service 的传输会话

我在所有客户端代理上调用 Close()，所以我 99% 确定没有未打开的连接。所以我唯一的想法是我的连接可能会用完，因为 WCF 服务的 MaxConnections 设置为 3000，每个 Web 应用程序设置为使用 1000。我的直觉反应是所有连接都用完了，并且他们在排队时超时。但是，我无法证明（我知道）。

这些调用最多应该花费一到两秒（平均为几百毫秒）。

1.  谁能给我一个关于上面发布的错误可能是由什么引起的指针？
2.  WCF 服务有没有办法为无限数量的连接提供服务？

    2a。如果不是，将最大连接数设置为 10,000 会有什么影响？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T21:35:00.237

1.  尝试打开 WCF 日志记录，看看是否可以在那里找到更有用的东西。
2.  不，那里没有。2a。您可能会遇到异常，因为您将用完所有资源（物理连接、处理程序线程、内存）。我也很确定操作系统本身有一个限制，而且它大大低于 10000

# sql - 在数据库中查找最接近的数值

> ID：592209
> 
> 赞同：45
> 
> 时间：2009-02-26T20:07:10.153
> 
> 标签：sql

我需要找到一个 select 语句，该语句将返回与我的输入完全匹配的记录，或者如果未找到完全匹配则返回最接近的匹配。

到目前为止，这是我的选择声明。

```
SELECT * FROM [myTable] 
WHERE Name = 'Test' AND Size = 2 AND PType = 'p' 
ORDER BY Area DESC 
```

我需要做的是找到与“区域”字段最接近的匹配项，因此如果我的输入是 1.125 并且数据库包含 2、1.5、1 和 .5，则查询将返回包含 1 的记录。

我的 SQL 技能非常有限，因此将不胜感激。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-02-26T20:12:49.343

获取区域和您的输入之间的差异，取绝对值，因此始终为正，然后按升序排列并取第一个

```
SELECT TOP 1 * FROM [myTable] 
WHERE Name = 'Test' and Size = 2 and PType = 'p'
ORDER BY ABS( Area - @input ) 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-26T20:13:50.167

一些可怕的事情，大致如下：

```
ORDER BY ABS( Area - 1.125 ) ASC LIMIT 1 
```

也许？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-27T17:13:30.437

如果您有许多行满足、 和列上的相等谓词`Name`，那么您可能希望在查询中包含列上的范围谓词。如果列被索引，这可以允许有效的基于索引的访问。`Size``PType``Area``Area`

以下查询（使用 Oracle 语法编写）使用 a 的一个分支`UNION ALL`查找目标最小的记录`Area >=`，而另一个分支查找`Area <`目标最大的记录。这两个记录之一将是您要查找的记录。然后，您可以`ORDER BY ABS(Area - ?input)`从这两个候选人中选出获胜者。不幸的是，由于执行所需的 ROWNUM / ORDER BY 优先级所需的嵌套 SELECTS，查询很复杂。

```
SELECT *
FROM
  (SELECT * FROM
    (SELECT * FROM
       (SELECT * FROM [myTable]
         WHERE Name = 'Test' AND Size = 2 AND PType = 'p' AND Area >= ?target
         ORDER BY Area)
       WHERE ROWNUM < 2
     UNION ALL
     SELECT * FROM 
       (SELECT * FROM [myTable]
         WHERE Name = 'Test' AND Size = 2 AND PType = 'p' AND Area < ?target
         ORDER BY Area DESC)
       WHERE ROWNUM < 2)
     ORDER BY ABS(Area - ?target))
WHERE rownum < 2 
```

此查询的一个好的索引是`(Name, Size, PType, Area)`，在这种情况下，预期的查询执行计划将基于两个索引范围扫描，每个扫描都返回一行。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-26T20:13:37.343

如何根据您的输入和 [Area] 之间的差异进行排序，例如：

```
DECLARE @InputValue DECIMAL(7, 3)

SET @InputValue = 1.125

SELECT TOP 1 * FROM [myTable]
WHERE Name = 'Test' AND Size = 2 AND PType = 'p'
ORDER BY ABS(@InputValue - Area) 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-26T20:14:42.130

```
SELECT * 
  FROM [myTable] 
  WHERE Name = 'Test' AND Size = 2 AND PType = 'p' 
  ORDER BY ABS(Area - 1.125)
  LIMIT 1 
```

——马库斯

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-26T20:13:47.360

如果使用 MySQL

```
SELECT * FROM [myTable] ... ORDER BY ABS(Area - SuppliedValue) LIMIT 1 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-26T20:29:21.300

请注意，尽管几乎所有东西都支持 ABS()，但它在技术上并不是标准的（至少在 SQL99 中）。如果您出于某种原因必须编写 ANSI 标准 SQL，则必须使用 CASE 运算符解决该问题：

```
SELECT * FROM myTable
WHERE Name='Test' AND Size=2 AND PType='p'
ORDER BY CASE Area>1.125 WHEN 1 THEN Area-1.125 ELSE 1.125-Area END 
```

# windows - 流程启动监控的已知/记录/未记录方法是什么？

> ID：592238
> 
> 赞同：1
> 
> 时间：2009-02-26T20:14:15.453
> 
> 标签：windows, security, process, monitoring

我需要监视，如果需要，拒绝在 Windows XP 和 Vista 操作系统中启动进程？什么是已知/记录/未记录的方法？这种方法的已知黑客呢？

（它将用于共享软件防火墙/安全软件）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T14:45:03.240

对任何认为它对用户正在做什么有足够了解以知道是否允许进程启动的代码要非常小心。这是找出您对您的用户有多少不了解的好方法，但前提是您提供了一个电子邮件地址供用户向其发送投诉。

一个例子是我使用的一些 VPN 软件，它连接到 Windows 系统，以便在加载 DLL 时收到通知。它实际上在运行一个非常常见的应用程序 - Visual Studio 时导致了 BSOD。制造商不知道 VS 的模块化程度如何，并且在启动它时会加载许多 DLL，有时甚至在执行期间加载更多 DLL，因为会加载新功能。

当您将自己置于为用户做事的位置时，您有责任了解足够多的知识以正确地完成它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T21:30:29.140

对于监视，您可以使用 WMI 事件。

没有^([1])方法来决定是否允许启动。如果您使用的是 Pro/Biz/Ent/Ultimate 版本，则可以使用组策略来阻止启动指定的可执行文件，或限制到指定的列表。

^([1])据我所知。

# google-translate - 谷歌翻译 API

> ID：592242
> 
> 赞同：2
> 
> 时间：2009-02-26T20:15:08.807
> 
> 标签：google-translate, google-translation-api

有人用过谷歌翻译API吗？使用它的最大长度限制是多少？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2010-01-03T00:41:27.303

限制是 500... 现在是 5000 个字符。

[资源](https://developers.google.com/translate/v2/faq#technical)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T20:18:18.347

500 个字符

[资源](http://googlesystem.blogspot.com/2008/03/google-launched-another-ajax-api-this.html#c8304624882908049429)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-04-05T11:53:01.420

目前，限制为每天100,000*个**字符*。看起来您可以申请增加/取消该限制。

 ** * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-21T14:59:37.147

请查看此链接，它将在页面底部给出正确答案。

[https://developers.google.com/translate/v2/faq](https://developers.google.com/translate/v2/faq)

> **每个请求的最大字符数是多少？**
> 要翻译的每个文本的最大大小为 5000 个字符，不包括任何 HTML 标记。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T20:38:28.237

我用它把日语翻译成英语。

[如果您使用http://code.google.com/p/jquery-translate/](http://code.google.com/p/jquery-translate/)我不相信 500 字符的限制是正确的，但是正确的一件事是您可以限制请求的数量一定时间内做出来。他们还尝试检测您是否在类似的时间段内发送了大量请求，就像迷你“拒绝服务”攻击一样。

因此，当我这样做时，我编写了一个在请求之间具有随机长度睡眠的客户端。我还在网格上运行它，因此所有请求都不是来自单个 IP 地址。

我必须将资源包中的约 2000 条 Java 消息从日语翻译成英语。只要文本是单个单词，它的效果就很好。带有上下文的较长短语笨拙地出现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-02-03T10:35:01.420

Cloud Translation API 针对翻译较小的请求进行了优化。每个请求的建议最大长度为 5K 个字符（代码点）。但是，您包含的字符越多，响应延迟就越高。对于 Cloud Translation - Advanced，单个请求的最大代码点数为 30K。Cloud Translation - Basic 的最大请求大小为 100K 字节。

[https://cloud.google.com/translate/quotas](https://cloud.google.com/translate/quotas)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-05-15T18:55:54.530

您可以发送最多 5,000 个字符的源字符串，但
有时会丢失一些附加条件。

1.  您只能通过 POST 方法发送 5,000 个字符。
2.  如果您使用 GET 方法，则 url 的长度限制为 2,000 个字符。如果一个 url 比这个长，谷歌的服务器就会拒绝它。

    **注意**：2,000 个字符的限制，包括路径和查询字符串的其余部分
    + 您必须计算 uri 编码（例如，每个空格变成 %20，每个引号
    变成 %22）

# c# - Difference between StreamReader.Read and StreamReader.ReadBlock

> ID：592244
> 
> 赞同：31
> 
> 时间：2009-02-26T20:16:34.543
> 
> 标签：c#, io, streamreader

The documentation simply says ReadBlock is

"a blocking version of Read"

but what does that mean?

Someone else has asked the question before but, huh?

[http://www.pcreview.co.uk/forums/thread-1385785.php](http://www.pcreview.co.uk/forums/thread-1385785.php)

The guy answering said

> Basically, it means that you can rely on StreamReader.ReadBlock not returning until either it's read as much as you've asked it to, or it's reached the end of the stream.

Am I understanding correctly that this is required because Read may not give you everything you asked for? And that just because it returns 0 does NOT mean you reached the end of the file?

So this means check something other than the number of bytes returned (EndOfStream?) or use ReadBlock instead?

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-02-26T20:41:43.767

ReadBlock does not mean it is thread safe. If you use Reflector to look at the implementation of StreamReader.ReadBlock (which is inherited from TextReader.ReadBlock), all it does is make multiple calls to the "Read" method until either the "Read" method returns 0 or we have read as many bytes as requested. This is needed because the "Read" method will not necessarily return as many bytes as you asked for.

# php - 使用 GD 在表单中插入图像时出现问题！

> ID：592246
> 
> 赞同：0
> 
> 时间：2009-02-26T20:16:44.980
> 
> 标签：php

我正在尝试为我的网站开发一个验证码类，在我尝试将使用 PHP GD 生成的图像嵌入我的订阅表单之前，一切都做得很好！

这是我班级的代码：

```
<?php
//captcha.php
header("Content-type: image/png");

class Captcha  {

  // some attributes bla bla

  public function __construct($new_string_length,$new_width_picture,
                              $new_height_picture,$new_string_color) {

    $this->string_length = $new_string_length;
    $this->width_picture = $new_width_picture;
    $this->height_picture = $new_height_picture;
    $this->string_color = $new_string_color;

  }

  public function getString() {
    return $this->string;
  }

  public function generateRandomString() {
    $str = "";
    $basket = "abcdefghijklmnopqrstuvwxyz0123456789";
    $basket_length = strlen($basket);
    srand ((double) microtime() * 1000000);
    for($i=0;$i<$this->string_length;$i++) {

        $generated_pos = rand(0,$basket_length);
        $str_substr = substr($basket,$generated_pos-1,1);
        if(!is_numeric($str_substr)) { 
          // if the character picked up isn't numeric
          if(rand(0,1)==1) {
            // we randomly upper the character
            $str_substr = strtoupper($str_substr);
          }
        }
        $str = $str.$str_substr;
    }

    $this->string = $str;
  } 

  **public function generatePictureFromString($new_string) {
      $root_fonts = '../fonts/';
      srand ((double) microtime() * 1000000);
      $list_fonts = array('ABODE.ttf','acme.ttf','Alcohole.ttf',
                   'Anarchistica.ttf','AMERIKAA.ttf');

      $image = @imagecreatetruecolor($this->width_picture,$this->height_picture);
      $noir  = imagecolorallocate($image,0,0,0);
      $clr = explode('/',$this->string_color);
      $clr = imagecolorallocate($image,$clr[0],$clr[1],$clr[2]);

      for($i=0;$i<strlen($new_string);$i++) {       
           imagettftext($image,rand(($this->height_picture/4.3),($this->height_picture)/4.2),
           rand(-45,45),($this->width_picture)/(5*$this->string_length)+($this->width_picture)/($this->string_length)*$i,0.6*($this->height_picture),$clr,
           $root_fonts.$list_fonts[rand(0,count($list_fonts)-1)],substr($new_string,$i,1));
      }

      imagepng($image);
      imagedestroy($image);

  }**

} 
```

我心甘情愿地避免展示课程中一些无用的部分。当我像这样调用 generatePictureFromString(..) 方法时，该类本身可以完美运行：

```
<?php
//testeur_classe.php
require_once '../classes/captcha.php';

$captcha = new Captcha(5,200,80,"255/255/255");
$captcha->generateRandomString();
$str  = $captcha->getString();
$captcha->generatePictureFromString($str); 
?> 
```

但是当我尝试使用以下方法插入在我的表单中生成的图片时：

```
<img src="<?php echo PATH_ROOT.'classes\testeur_classe.php'; ?>"/> 
```

什么都没有显示！

我该怎么做？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T20:49:33.297

*OK：*如果您在浏览器中打开 classes\testeur_classe.php，您会看到什么？（与瑞安格雷厄姆在问题评论中问你的问题相同）

*好的：*我认为您必须在图片输出之前设置正确的标题，例如：

```
header('Content-type: image/png'); 
```

ps

此代码有效，刚刚在我的机器上尝试过。你必须在 <img src="..." 或 <base href="" 上有错误，如果你有的话。您能否向我们展示您的 html 输出，以便我们查看可能是什么问题？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T20:29:37.087

您需要确保图像 src 是脚本的有效 URL。看看那里的反斜杠，我猜这实际上是一个文件系统路径。

# c# - 如何检查当前时间是否在时间范围内？

> ID：592248
> 
> 赞同：21
> 
> 时间：2009-02-26T20:17:42.263
> 
> 标签：c#, datetime

我有一项服务，用户可以将其配置为在“非高峰”时间运行。他们有能力设置服务可以运行的时间范围。

例如：

用户 A 的工作时间是上午 8 点到下午 5 点，因此他们希望将应用程序安排在下午 5:30 到上午 7:30 之间运行。

用户 B 的工作时间是晚上 9 点到早上 6 点，因此他们安排应用程序在早上 6:30 到晚上 8:30 之间运行。

关键是应用程序使用他们的计算机，而他们没有。

给定当前时间的 DateTime、开始的 DateTime 和停止时间的 DateTime，我如何检查当前是否在开始和停止之间。

对我来说棘手的部分是时间可以跨越午夜的界限。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-02-26T20:19:41.463

如果`startTime`和`endTime`表示单个时间间隔（它只会发生一次，并且`startTime`和`endTime`表示开始/停止的日期和时间），那么它就像说一样简单

```
bool isTimeBetween = someTime >= startTime && someTime <= endTime; 
```

如果它是重复事件（在某个时间间隔内每天发生），您可以使用该[`TimeOfDay`](http://msdn.microsoft.com/en-us/library/system.datetime.timeofday.aspx)属性进行比较。（经常出现的情况是您必须考虑跨过午夜的开始/停止）

```
static public bool IsTimeOfDayBetween(DateTime time, 
                                      TimeSpan startTime, TimeSpan endTime)
{
    if (endTime == startTime)
    {
        return true;   
    }
    else if (endTime < startTime)
    {
        return time.TimeOfDay <= endTime ||
            time.TimeOfDay >= startTime;
    }
    else
    {
        return time.TimeOfDay >= startTime &&
            time.TimeOfDay <= endTime;
    }

} 
```

（注意：此代码假定 if `start == end`，则它涵盖所有时间。您在另一篇文章中对此发表了评论）

例如，检查是否在上午 5 点到晚上 9:30 之间

```
IsTimeOfDayBetween(someTime, new TimeSpan(5, 0, 0), new TimeSpan(21, 30, 0)) 
```

如果`startTime`和`endTime`是`DateTime`s，你可以说

```
IsTimeOfDayBetween(someTime, startTime.TimeOfDay, endTime.TimeOfDay) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T21:00:44.423

因此，我从问题中假设您想知道是否给出了一天的开始时间和结束时间（不包括实际日期，即 1900 年 1 月 1 日或类似的日期），以查看其他时间是否与时间有关由开始和结束指定。例如，如果开始是晚上 9 点，结束是上午 9 点，则接受晚上 10 点但拒绝上午 10 点。

您可以按时间范围类型（​​时间相等，结束在开始之后，结束在开始之前）执行此操作，这很简单：

```
if (end==start) return true
else if (end>start) return start<=time && time<=end
else return !(time>end && time<start) 
```

或者您可以扩展 start 和 end 的范围，使得 end 总是在 start 之后：

```
if (end<=start) end += <24 hours>
if (time<start) time+= <24 hours>
return time<=end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T20:22:36.183

我假设您将开始和结束时间保存在应用程序配置文件中，所以您基本上要做的就是让您的应用程序在“开始时间”发生时将标志设置为“开启”并将其设置为“关闭”当停止时间发生时。

这样你就不必经常检查“现在”是否是“开始和结束之间”的时间。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2015-06-25T12:38:59.483

```
DateTime t1;
t1 = DateTime.Now;

// loop inbetween start and end time      

if (t1>=start_time &&t1<=end_time) 

{
   //your code / action
}

//if you are using sql to get values 

start_time = Convert.ToDateTime(row.Cells[10].Text);
end_time = Convert.ToDateTime(row.Cells[11].Text);
//convert them to string or you will get some error!!! 
```

# python - 确定（Windows）上是否存在PID的快速方法？

> ID：592256
> 
> 赞同：8
> 
> 时间：2009-02-26T20:19:23.320
> 
> 标签：python, c, winapi, pid

我意识到“快速”有点主观，所以我会用一些上下文来解释。我正在开发一个名为[**psutil**](http://code.google.com/p/psutil/)的 Python 模块，用于以跨平台方式读取进程信息。其中一个函数是`pid_exists(pid)`用于确定PID是否在当前进程列表中的函数。

现在我正在以明显的方式执行此操作，使用[EnumProcesses()](http://msdn.microsoft.com/en-us/library/ms682629(VS.85).aspx)拉取进程列表，然后遍历列表并查找 PID。但是，一些简单的基准测试表明，这比基于 UNIX 的平台（Linux、OS X、FreeBSD）上的 pid_exists 函数要慢得多，我们使用`kill(pid, 0)`0 信号来确定 PID 是否存在。额外的测试表明，几乎所有时间都在占用 EnumProcesses。

任何人都知道比使用 EnumProcesses 确定 PID 是否存在更快的方法吗？我尝试了[OpenProcess()](http://msdn.microsoft.com/en-us/library/ms684320(VS.85).aspx)并检查打开不存在的进程是否有错误，但结果证明这比遍历 EnumProcesses 列表慢 4 倍以上，所以这也是如此。还有其他（更好的）建议吗？

**注意**：这是一个 Python 库，旨在避免第三方库依赖项，如 pywin32 扩展。我需要一个比我们当前代码更快的解决方案，并且不依赖于 pywin32 或标准 Python 发行版中不存在的其他模块。

**编辑**：澄清 - 我们很清楚阅读过程信息中存在固有的竞争条件。如果在数据收集过程中流程消失或遇到其他问题，我们会引发异常。pid_exists() 函数并非旨在替换正确的错误处理。

**更新**：显然我早期的基准测试存在缺陷——我用 C 语言编写了一些简单的测试应用程序，并且 EnumProcesses 始终运行较慢，而 OpenProcess（与 GetProcessExitCode 结合，以防 PID 有效但进程已停止）实际上*更快*而不是更慢。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-26T22:41:23.947

[OpenProcess](http://msdn.microsoft.com/en-us/library/ms684320(VS.85).aspx)可以告诉你没有枚举所有。我不知道有多快。

**编辑**：请注意，`GetExitCodeProcess`即使您从中获得句柄，您也需要验证进程的状态`OpenProcess`。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-01T18:18:22.277

事实证明，我的基准测试显然存在某种缺陷，因为后来的测试显示 OpenProcess 和 GetExitCodeProcess 毕竟比使用 EnumProcesses 快得多。我不确定发生了什么，但我做了一些新测试并验证这是更快的解决方案：

```
int pid_is_running(DWORD pid)
{
    HANDLE hProcess;
    DWORD exitCode;

    //Special case for PID 0 System Idle Process
    if (pid == 0) {
        return 1;
    }

    //skip testing bogus PIDs
    if (pid < 0) {
        return 0;
    }

    hProcess = handle_from_pid(pid);
    if (NULL == hProcess) {
        //invalid parameter means PID isn't in the system
        if (GetLastError() == ERROR_INVALID_PARAMETER) { 
            return 0;
        }

        //some other error with OpenProcess
        return -1;
    }

    if (GetExitCodeProcess(hProcess, &exitCode)) {
        CloseHandle(hProcess);
        return (exitCode == STILL_ACTIVE);
    }

    //error in GetExitCodeProcess()
    CloseHandle(hProcess);
    return -1;
} 
```

请注意，您确实需要使用`GetExitCodeProcess()`，因为`OpenProcess()`将在最近死亡的进程上成功，因此您不能假设有效的进程句柄意味着该进程正在运行。

另请注意，`OpenProcess()`对于任何有效 PID 的 3 以内的 PID 都成功（请参阅[为什么即使我将三个添加到进程 ID，OpenProcess 也会成功？](http://blogs.msdn.com/oldnewthing/archive/2008/06/06/8576557.aspx)）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-26T21:08:02.940

使用 pid_exists 函数有一个固有的竞争条件：当调用程序开始使用答案时，进程可能已经消失，或者可能已经创建了具有查询 id 的新进程。我敢说，任何使用此功能的应用程序都存在设计缺陷，因此优化此功能是不值得的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-04T02:13:18.093

我会以这种方式编写 Jay 的最后一个函数。

```
int pid_is_running(DWORD pid){
    HANDLE hProcess;
    DWORD exitCode;
    //Special case for PID 0 System Idle Process
    if (pid == 0) {
        return 1;
    }
    //skip testing bogus PIDs
    if (pid < 0) {
        return 0;
    }
    hProcess = handle_from_pid(pid);
    if (NULL == hProcess) {
        //invalid parameter means PID isn't in the system
        if (GetLastError() == ERROR_INVALID_PARAMETER) {
             return 0;
        }
        //some other error with OpenProcess
        return -1;
    }
    DWORD dwRetval = WaitForSingleObject(hProcess, 0);
    CloseHandle(hProcess); // otherwise you'll be losing handles

    switch(dwRetval) {
    case WAIT_OBJECT_0;
        return 0;
    case WAIT_TIMEOUT;
        return 1;
    default:
        return -1;
    }
} 
```

主要区别在于关闭进程句柄（当该函数的客户端长时间运行时很重要）和进程终止检测策略。WaitForSingleObject 让您有机会等待一段时间（将 0 更改为函数参数值）直到过程结束。

# c# - 从带有单独 BLL 的页面方法返回自定义对象列表的快速方法

> ID：592260
> 
> 赞同：0
> 
> 时间：2009-02-26T20:20:05.097
> 
> 标签：c#, json, .net-2.0, subsonic

我正在使用 jQuery 从页面方法中检索 JSON 对象。我有一个使用 SubSonic 的 DAL，如果我返回从 SubSonic 生成的类创建的对象，我会堵塞管道。:) 你知道，所有公共属性都会被序列化。我不希望这个应用程序有一个单独的业务层，因为它很小并且专注于读取操作，而另一个层似乎有点矫枉过正。为了避免下载一些 SubSonic 臃肿的对象（也可能包含敏感信息）并避免构建单独的层，我尝试返回一个对象列表，如下所示：

```
[WebMethod]
public static List<object> GetFiles()
{
    FileCollection collection = DB
        .Select()
        .From(DataAccess.File.Schema)
        .ExecuteAsCollection<FileCollection>();

    List<object> files = new List<object>(collection.Count);

    foreach (DataAccess.File file in collection)
    {
        files.Add(new {
                          file.FileId,
                          file.ApplicantFirstName,
                          file.ApplicantLastName,
                          file.UploadDate
                      }
        );
    }

    return files;
} 
```

它有效，我得到了一个不错的 JSON 对象作为回报（忽略 DateTime 值）：

```
[{"FileId":1,"ApplicantFirstName":"Paweł","ApplicantLastName":"Krakowiak","UploadDate":"\/Date(1235656448387
)\/"}] 
```

这是一个好方法吗？我很担心`List<object>`- 是否比返回说一个`List<SomeDomainObject`> 更糟糕？表现？还有什么？

这是 .NET 2.0，我不能使用 3.5 的功能。至少匿名类型工作......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T20:25:09.203

最大的建议可能是将其设置为“集合”而不是列表，但是通过简单的 Web 服务返回，这没什么大不了的，因为该建议最常见于对象仍然存在于 . NET 程序集。

我认为它也很容易阅读。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T20:27:52.240

`List<object>`在这种情况下使用而不是在这种情况下使用的唯一缺点是在直接从 .net 代码`List<SomeDomainObject>`调用您的方法时会丢失强类型访问。`GetFiles`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T06:14:48.460

看起来我的方法没有任何问题。我要做的就是将一个 JSON 对象返回给调用客户端（浏览器）以更新 UI。这个应用程序执行 99% 的读取操作，所以我很好。我实际上开始添加一个服务和域（我在这里保留我的业务实体）层，但我要把它们扔掉。我真的尽量让这个应用程序保持简单，不要添加我不需要的东西。

# c# - C# Socket 服务器发送问题

> ID：592261
> 
> 赞同：1
> 
> 时间：2009-02-26T20:20:23.303
> 
> 标签：c#, .net, sockets

我有一个 .net 2.0 应用程序，它使用 System.Net.Sockets Send() 方法定期发送数据，例如每分钟。本质上它是一个套接字服务器。大多数情况下，没有客户端连接来接收这些数据，但偶尔用户会运行一个应用程序，该应用程序将连接以监控定期发送的数据。在每个间隔，我发送的最多大约是 1024 字节，大多数消息要小得多。

我的问题是，在没有人接收的情况下，每分钟调用 Send() 对系统资源有什么影响？这最终会吃掉我所有的记忆吗？我已经读到 Windows 套接字基于创建文件描述符的 Berkeley 套接字。是否执行了一些低级标准输出（stdout），而没有收到的数据只是进入了黑洞？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T20:33:46.220

**每分钟调用 Send() 而没有人接收它对系统资源有什么影响？**

应该是 none - 它应该抛出一个错误，因为套接字没有打开。

**这最终会吃掉我所有的记忆吗？**

不，它应该只是抛出一个错误。

**是否执行了一些低级标准输出（stdout），而没有收到的数据只是进入了黑洞？**

数据确实被丢弃了，如果你注意你会看到错误。

在发送之前，您应该首先检查套接字是否打开。如果没有人连接，请不要发送。一个额外的 if 语句。

-亚当

# java - 从 Java 复制 CMD 文件

> ID：592262
> 
> 赞同：2
> 
> 时间：2009-02-26T20:20:37.390
> 
> 标签：java

我正在寻找打开命令提示符并传入复制命令、一些开关以及源文件和目标文件。我已经尝试了下面的代码，但似乎没有发生任何事情。我没看到什么？我可能做错了什么？

```
String line;

line = "cmd COPY /Y C:\srcfolder\112.bin C:\destfolder";

Process p = Runtime.getRuntime().exec(line);

p.waitFor(); 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-26T20:27:05.020

**如果你真的必须**使用外部命令，那么你可能想要执行（注意 /C）：

```
CMD /C COPY /Y C:\srcfolder\112.bin C:\destfolder 
```

我建议您使用数组版本`exec`来避免处理引用（如果任何文件或目录中包含空格或双引号）：

```
String[] args = { "CMD", "/C", "COPY", "/Y", src_file, dest_folder };
Process p = Runtime.getRuntime().exec(args);
p.waitFor(); 
```

请记住，这不是可移植的（不适用于 Unix），因此除非您真的需要使用，否则`COPY`您应该使用链接到的方法 by `bstpierre`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T20:25:32.963

您是否有理由不简单地[在 Java 中复制文件](http://www.java2s.com/Code/Java/File-Input-Output/FileCopyinJava.htm)而不是创建系统进程？

使用 Java 而不是 exec 调用复制文件将使您的代码具有可移植性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-26T20:28:19.103

我第二个 bstpierre 的评论。

关于您的特定问题，我相信 cmd shell 在您创建后不会退出。（编辑：弗拉德已经指出如何纠正）

顺便说一句，对于将来的其他命令，不要忘记转义反斜杠： line="cmd copy /yc:\\srcfolder\\112.bin c:\\destfolder"

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T20:31:17.690

尝试

```
line = "cmd /C COPY /Y C:\srcfolder\112.bin C:\destfolder";
Process p = Runtime.getRuntime().exec(line);
p.waitFor(); 
```

但是，如果您的文件和文件夹中有空格，则会遇到问题。我发现执行命令最可靠的方法是使用[ProcessBuilder](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/ProcessBuilder.html)，并将所有参数作为参数传入命令。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-01-17T11:48:53.597

对于那些参考[Apache Commons IO](http://commons.apache.org/io/)的人。

由于java 7还有一个[`java.nio.Files#copy(Path, Path, CopyOption)`](https://docs.oracle.com/javase/8/docs/api/java/nio/file/Files.html#copy-java.nio.file.Path-java.nio.file.Path-java.nio.file.CopyOption...-)方法，非常方便。[您可以在此处](https://docs.oracle.com/javase/tutorial/essential/io/copy.html)找到更多信息。

从 java 7 开始，`Path`也更喜欢使用对象来支持以前的`File`对象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T20:31:52.370

使用 Windows 版本。

> CMD /C 复制 /YC:\srcfolder\112.bin C:\destfolder

另一种选择：[Apache Commons IO](http://commons.apache.org/io/)提供了一组很好的库来处理纯 Java 的文件传输。具体看 FileUtils.copyFileToDirectory(File srcFile, File destDir)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-26T20:50:02.467

啊，看起来有人确实提到了它，但我会澄清一下（特别是因为提到它的人忘记在帖子中引用他们的反斜杠，使它看起来像一个单一的！）。

所以列出的解决方案更好，但我很确定你失败的原因是在Java中你永远不能使用反斜杠作为单引号，它们是引号字符，所以你总是需要在字符串中使用 \\ 。对于连续 2 个反斜杠，我认为您需要 6 或 8 个 !!?!?? 查一下。

修复了在我之前发布它并给他 +1 的人

# asp.net - 如何计算查询中的相关行

> ID：592269
> 
> 赞同：0
> 
> 时间：2009-02-26T20:21:27.170
> 
> 标签：asp.net, sql, sql-server

我正在尝试进行查询，以提取特定公司的所有门票。在该表中将有一个名为 [Repeat] 的列

我需要查询做的是检查在该票的最后 30 天内是否有任何其他行具有匹配的 Circuit_ID。

```
"SELECT [MAIN_TICKET_ID], [CompID], [ActMTTR], [ActOTR], [DtCr], [DtRFC],
                CASE WHEN [PRIORITY] = 1 THEN '1' 
                     WHEN [PRIORITY] = 2 THEN '2' 
                     WHEN [PRIORITY] = 3 THEN '3' END AS [PRIORITY],
                CASE WHEN ([PRIORITY] = '1' AND [ActMTTR] >= '4' AND ([ResCd7] = 'Equipment (XX)' OR [ResCd7] = 'Lec Facilities (LEC)')) 
                       OR ([PRIORITY] = '1' AND [ActOTR] >= '14' AND ([ResCd7] = 'Equipment (XX)' OR [ResCd7] = 'Lec Facilities (LEC)')) 
                       OR ([PRIORITY] = '2' AND [ActMTTR] >= '6' AND ([ResCd7] = 'Equipment (XX)' OR [ResCd7] = 'Lec Facilities (LEC)')) 
                       OR ([PRIORITY] = '2' AND [ActOTR] >= '16' AND ([ResCd7] = 'Equipment (XX)' OR [ResCd7] = 'Lec Facilities (LEC)')) 
                       OR (([Rpt5] = '1' OR [Rpt30] = '1' OR [Chronic] = '1') AND ([ResCd7] = 'Equipment (XX)' OR [ResCd7] = 'Lec Facilities (LEC)')) THEN 'Yes' ELSE 'No' END AS [Measured],  
                CASE WHEN [Reviewed] = 1 THEN 'Yes' ELSE 'No' END AS [Reviewed],
                CASE WHEN [Rpt5] = 1 OR [Rpt30] = 1 THEN 'Yes' ELSE 'No' End As [Repeat],
                CASE WHEN [Chronic] = 1 THEN 'Yes' ELSE 'No' END AS [Chronic],
                CASE WHEN [ResCd7] = 'Equipment (XX)' THEN 'XX' 
                     WHEN [ResCd7] = 'Isolated to Customer (ITC)' THEN 'ITC' 
                     WHEN [ResCd7] = 'Information (INF)' THEN 'INF' 
                     WHEN [ResCd7] = 'Test OK (TOK)' THEN 'TOK' 
                     WHEN [ResCd7] = 'Lec Facilities (LEC)' THEN 'LEC' 
                     WHEN [ResCD7] = 'Dispatched No Trouble Found (NTF)' THEN 'NTF' 
                     WHEN [ResCD7] = 'Cleared While Testing (CWT)' THEN 'CWT' END AS [Resolution]
                FROM [SNA_Ticket_Detail] WHERE ([CompID] = @CompID)" 
```

上面是当前查询，它依赖于表中的 0 或 1 标志。见在线 CASE WHEN [Rpt5] = 1 OR [Rpt30] = 1 THEN 'Yes' ELSE 'No' End As [Repeat],

我想做的是用类似的东西代替它

```
CASE WHEN (SELECT COUNT([XX_CIRCUIT_ID]) FROM SNA_Ticket_Detail WHERE (CONVERT(CHAR(10), [DtRFC], 101) BETWEEN ([DtRFC] - 6) AND ([DtRFC])) AND (XX_CIRCUIT_ID = XX_CIRCUIT_ID)) > '1' THEN 'Yes' ELSE 'No' End As [Repeat], 
```

这不起作用..它基本上计算所有行，而不仅仅是与当前行电路 id 匹配且属于上个月的行。

我不知道如何正确编码以使其正常工作。或者即使在查询中是可能的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T20:25:19.000

您想对同一个表运行子查询，因此您需要为表的两种用途（最近和下面的 td）设置别名。在查找感兴趣的行时，在这种情况下，具有相同电路 ID 且在一定范围内的行，您需要确保您查看的不是完全相同的行。因此检查 [MAIN_TICKET_ID]。你可以按照你的例子做一个 COUNT ，或者你可以做一个 EXISTS() 如下。

```
SELECT [MAIN_TICKET_ID], [CompID], [ActMTTR], [ActOTR], [DtCr], [DtRFC],
                CASE WHEN [PRIORITY] = 1 THEN '1' 
                     WHEN [PRIORITY] = 2 THEN '2' 
                     WHEN [PRIORITY] = 3 THEN '3' END AS [PRIORITY],
                CASE WHEN ([PRIORITY] = '1' AND [ActMTTR] >= '4' AND ([ResCd7] = 'Equipment (XX)' OR [ResCd7] = 'Lec Facilities (LEC)')) 
                       OR ([PRIORITY] = '1' AND [ActOTR] >= '14' AND ([ResCd7] = 'Equipment (XX)' OR [ResCd7] = 'Lec Facilities (LEC)')) 
                       OR ([PRIORITY] = '2' AND [ActMTTR] >= '6' AND ([ResCd7] = 'Equipment (XX)' OR [ResCd7] = 'Lec Facilities (LEC)')) 
                       OR ([PRIORITY] = '2' AND [ActOTR] >= '16' AND ([ResCd7] = 'Equipment (XX)' OR [ResCd7] = 'Lec Facilities (LEC)')) 
                       OR (([Rpt5] = '1' OR [Rpt30] = '1' OR [Chronic] = '1') AND ([ResCd7] = 'Equipment (XX)' OR [ResCd7] = 'Lec Facilities (LEC)')) THEN 'Yes' ELSE 'No' END AS [Measured],  
                CASE WHEN [Reviewed] = 1 THEN 'Yes' ELSE 'No' END AS [Reviewed],
                CASE WHEN EXISTS ( select * from SNA_Ticket_Detail recent 
                       where recent.XX_CIRCUIT_ID = td.XX_CIRCUIT_ID
                       AND recent.[MAIN_TICKET_ID] <> td.[MAIN_TICKET_ID]
                       AND datediff( month, recent.[DtRFC], td.[DtRFC] ) < 1 
                      AND recent.[DtRFC] < td.[DtRFC]) 
            THEN 'Yes' ELSE 'No' End As [Repeat],
                CASE WHEN [Chronic] = 1 THEN 'Yes' ELSE 'No' END AS [Chronic],
                CASE WHEN [ResCd7] = 'Equipment (XX)' THEN 'XX' 
                     WHEN [ResCd7] = 'Isolated to Customer (ITC)' THEN 'ITC' 
                     WHEN [ResCd7] = 'Information (INF)' THEN 'INF' 
                     WHEN [ResCd7] = 'Test OK (TOK)' THEN 'TOK' 
                     WHEN [ResCd7] = 'Lec Facilities (LEC)' THEN 'LEC' 
                     WHEN [ResCD7] = 'Dispatched No Trouble Found (NTF)' THEN 'NTF' 
                     WHEN [ResCD7] = 'Cleared While Testing (CWT)' THEN 'CWT' END AS [Resolution]
                FROM [SNA_Ticket_Detail] td WHERE ([CompID] = @CompID) 
```

您应该检查 datediff 是否符合您的要求 - 只需使用一些测试数据即可。此外，您可能希望确保“最近”行实际上不在被检索的行之后，所以我添加了：

```
AND recent.[DtRFC] < td.[DtRFC] 
```

虽然如果您知道您的票证 ID 是连续的，您可以用它们代替日期字段做同样的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T20:27:00.290

如果您在外部查询中为 SNA_Ticket_Detail（例如 SNA_Ticket_Detail SNA）起别名，则可以在子查询中引用它

为简单起见，在子查询中还别名 SNA_Tick_Detail (SNA_Ticket_Detail SNA_sub)

然后，您当前拥有 (XX_CIRCUIT_ID = XX_CIRCUIT_ID) 的位置将更改为 (SNA_sub.XX_CIRCUIT_ID = SNA.XX_CIRCUIT_ID)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T20:29:00.600

为了对您的 SQL 进行最小的更改，请像这样更改您的子查询：

```
SELECT ... FROM SNA_Ticket_Detail AS i WHERE ... AND i.XX_CIRCUIT_ID = [SNA_Ticket_Detail].[XX_CIRCUIT_ID] 
```

你必须以某种方式引用外部表，你不能只是比较`XX_CIRCUIT_ID`和`XX_CIRCUIT_ID`平等 - 这将比较总是正确的。;-)

相反，您必须比较 external `XX_CIRCUIT_ID`，引用为`[SNA_Ticket_Detail].[XX_CIRCUIT_ID]`inner `XX_CIRCUIT_ID`，引用`i.XX_CIRCUIT_ID`为清楚起见。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T20:25:31.997

尝试

选择（计数（）...）> 1

代替

选择（计数（）...）>'1'

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T20:31:25.243

这是一个混乱的查询...

您需要将“内部”查询（又名子查询）过滤到外部查询。该概念通常称为[相关子查询](http://msdn.microsoft.com/en-us/library/ms187638.aspx)。请参阅 Rory 的解决方案。

或者，您可以对包含聚合数据的视图（或派生表）使用 JOIN。通常，这是性能的最佳选择。

# jquery - 使用 Asp.net mvc 和 jQuery load() 将变量传递给视图

> ID：592270
> 
> 赞同：2
> 
> 时间：2009-02-26T20:21:53.940
> 
> 标签：jquery, asp.net-mvc, json

我目前正在使用 jQuery load() 将视图（ascx）加载到 div 中。我想在加载视图时将一些变量传递给视图，所以我使用 $.load(view, data); 这似乎不会导致任何问题，但我不知道如何访问我传递给控件的 Json 对象。

这是jQuery：

```
var val = {"Id":"1"};
$("#DynamicForm").empty().load('/controller/view', val); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T20:51:56.520

在这种情况下，jQuery 发出一个 POST 请求：

```
POST /controller/view HTTP/1.1
...

Id=1 
```

因此，您可以将 Id 参数作为`Request.Form["Id"]`或仅作为操作参数访问：

```
public class Controller...
{
    public ActionResult Index(string Id) { ... }
} 
```

# java - 如何在 commons-lang 中使用 ToStringBuilder 设置 toString 方法的格式？

> ID：592276
> 
> 赞同：0
> 
> 时间：2009-02-26T20:23:07.180
> 
> 标签：java, tostring, apache-commons-lang

如何配置 toString 的格式设置

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T20:33:45.890

`ToStringBuilder.setDefaultStyle(ToStringStyle style)`

[http://commons.apache.org/proper/commons-lang//javadocs/api-2.6/org/apache/commons/lang/builder/ToStringStyle.html](http://commons.apache.org/proper/commons-lang//javadocs/api-2.6/org/apache/commons/lang/builder/ToStringStyle.html)

# sql-server - 触发更新另一个 sql server 上的数据

> ID：592280
> 
> 赞同：3
> 
> 时间：2009-02-26T20:25:10.827
> 
> 标签：sql-server, triggers

我正在使用两台 SQL Server，一台是 SQL Server 2000，另一台是 SQL Server 2005。

当 SQL Server 2000 中的 table1 得到更新/插入/删除时，我必须更新 SQL Server 2005 中的另一个表。是否可以在触发器中实现这一点？如果没有，可能的选择是什么？

感谢您有一个愉快的一天！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T20:48:02.597

如果您想复制数据，而不仅仅是设置不同的东西，您应该查看 SQL Replication，因为它会更好地管理事情。例如，它将异步进行更新。

如果您必须同步执行它们，或者您只是决定它更简单，或者您需要将整个操作包装为单个事务，我会将逻辑放在一个程序中以保持清洁。您可以从 2000 年到 2005 年创建链接服务器，并从那里将表称为 SERVER.DATABASE.SCHEMA.TABLE。或者，您可以在远程服务器上执行存储过程来执行插入/更新/删除。

如果您不想要 SQL 复制，则可以考虑通过触发器将 2000 年的插入/更新/删除写入同一数据库中的单独表中。然后有一个单独的作业将这些更改写入 2005，然后将它们从表中删除。这意味着您可以批量更改，意味着对原始表的更新将更快完成，将更好地处理两台服务器之间丢失的连接。但是，您无法保证这些更新实际上会应用于 2005 服务器，并且您必须运行的 sql 作业增加了复杂性。所以这是一个权衡。一旦你开始编写和维护这种逻辑，你就会意识到这就是 MS 编写复制东西的原因，所以你不必这样做。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-02T22:41:50.933

可以使用链接服务器和触发器，但我对此只有不好的经验。

**为什么不使用触发器？**

触发器的双向同步很棘手，因为触发器*会相互*触发。您将不得不以某种方式控制它，例如使用特殊值。否则，你会得到奇怪的锁定错误。

您需要在链接服务器之间设置 MSDTC（分布式事务协调器）

DBMS 在链接服务器方面无法为您提供太多帮助。调试 SQL 要困难得多。当类型不匹配等时，错误的查询通常只是挂起和超时。

在触发器中或在启动触发器的查询中具有多次写入的事务很容易导致**死锁。**我只会将触发器用于非常简单的更新（一个 INSERT/UPDATE/DELETE 语句），即使这样也要确保不会发生死锁。我记得当遗留应用程序导致触发器死锁时，我必须完全重写一个集成。

**备择方案**

至少有两个问题需要回答：

*   表之间的同步是单向的还是双向的？
*   两个表的模式是否匹配？

如果模式匹配，复制应该是单向和双向同步的理想选择。

如果架构不同，就像应用程序集成 (EAI) 的情况一样，您可能会考虑：

*   集成服务 (SSIS) 甚至导入/导出工具 - 生成的 dtsx 包
*   其他一些 EAI 工具（如果可用）（如 BizTalk）
*   编写自定义集成工具

我在 EAI 工具方面没有太多经验，但是将 SSIS 与自定义 .NET 解决方案进行比较我只能说，如果您可以使用 SSIS 完成工作，您将节省**大量时间。**

只有当 SSIS 不起作用或不可用（SQL Express）时，我才会尝试编写 Windows 服务、WCF 服务等。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-26T20:33:02.820

是的，您可以使用链接服务器和正在更新的数据库上的触发器来执行此操作。

所以在你的触发器里面你会做这样的事情。

```
UPDATE linkedserver.Database1.dbo.myTable
SET ...
WHERE --- 
```

用你的集合和 WHERE 的值。

现在，唯一的问题是如何在 2000 年到 2005 年之间设置链接服务器，您必须先尝试一下。

# visual-studio-2008 - 紧凑框架：Windows 安装程序问题

> ID：592287
> 
> 赞同：1
> 
> 时间：2009-02-26T20:26:34.303
> 
> 标签：visual-studio-2008, compact-framework, installation, c#-2.0, cab

我终于完成了我的杀手级应用程序，现在我遇到了一些问题。我已经创建了我的 cab 文件（构建良好并在 PDA 设备上完美安装/运行完美），现在我正在尝试创建我的 windows 安装程序。

我关注了一篇关于如何创建安装程序的 MSDN 文章（请参见[此处](http://msdn.microsoft.com/en-us/library/bb158529.aspx)），但是它似乎缺少一些信息，即 Ini 文件的格式是什么？

我做了一些挖掘，我想出了这个 Ini 文件内容（其中 AppName 是我的应用程序的名称）：

```
[ceAppManager]
Version = 3.0
Component = AppName

[AppName]
Description = AppName
Uninstall = AppName
CabFiles = AppName.cab 
```

这有什么问题吗？安装程序安装成功，我收到错误：

> 由于安装文件无效，应用程序管理器无法在您的移动设备上安装此应用程序。重新安装并重试。

我之前在另一个使用 ActiveSync 的应用程序上已经完成了这项工作。我目前正在使用 Windows Mobile Device Center，但安装程序肯定应该相同吗？我猜我的ini文件有问题？

即使有人可以给我一个更好的设置指南的链接，以便将出租车安装到 PDA 上，我也会很高兴。

提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-11T20:42:57.553

查看您修改后的 .INI 文件，它看起来正确。它应该可以工作——但是，Vista 和 WMDC 是奇怪的鸟。您是否有可能尝试将 .INI 文件从“标准”用户无权访问的位置加载到 WMDC？

我不知道您的 Windows 安装程序将文件提取到哪里，但也许尝试使用用户文件夹？

我唯一能想到的另一件事是旧的 .INI 以某种方式被 WMDC“缓存”，而不是注册新的（似乎我以前可能遇到过这种情况）。您可以尝试从 WMDC 中的“添加/删除程序”小程序中删除程序条目并重新安装您的应用程序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T21:14:50.427

版本号**必须**是“1.0”而不是您的示例中的“3.0”。CEAppManager 部分也可能区分大小写 - 我认为无论如何都是如此。查看[MSDN 文档](http://msdn.microsoft.com/en-us/library/bb158614.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-07-03T21:27:37.090

在遇到同样的问题（是的，我知道是 2016 年）之后，终于在这个旧文档中找到了关键信息：[Deploying .NET Compact Framework 2.0 Applications with .cab and .msi Files](https://msdn.microsoft.com/en-us/library/aa446504.aspx)

它比原始问题提到的较新文档要详细得多，并且包含以下有用的建议：

> 注意：在生成和测试 .ini 文件时，打开 CeAppMgr.exe 的调试输出会非常有帮助，它提供简单的 MessageBox 输出，报告它是如何解析 .ini 文件的。要打开调试，请在台式计算机上设置以下注册表项。

```
[HKLM\Software\Microsoft\Windows CE Services\AppMgr]
     "ReportErrors"=dword:1 
```

启用此功能后，它将弹出对话框，解释解析 INI 文件所采取的步骤，并向您报告它遇到的错误的所有详细信息，我很快让我的 INI 文件正常工作。

# c# - 二进制反序列化的问题 - 任何人都可以帮忙吗？

> ID：592288
> 
> 赞同：2
> 
> 时间：2009-02-26T20:26:47.453
> 
> 标签：c#, serialization, dictionary

我和这篇文章有同样的问题：

[http://social.microsoft.com/Forums/en-US/netfxbcl/thread/10027dd8-da47-4691-91a6-a8b89a7f514a](http://social.microsoft.com/Forums/en-US/netfxbcl/thread/10027dd8-da47-4691-91a6-a8b89a7f514a)

有人知道可能的答案/解决方案吗？有趣的是，我的可序列化类中有 2 个集合（二进制序列化）。一个是列表，一个是字典。List 集合正常，Dictionary 返回 0 作为 [Deserialized] 方法的 Count 属性。

更离奇的是，反序列化后，使用类对象就OK了。针对 Dictionary 集合的所有单元测试都通过了。这让我很沮丧，因为我想在反序列化后立即使用 Dictionary 对象，但由于这个奇怪的错误我不能。有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T20:55:04.047

是的; 看[这里](https://stackoverflow.com/questions/457134/strange-behaviour-of-net-binary-serialization-on-dictionrykey-value/457204#457204)；你只需要让字典完成反序列化：

```
public void OnDeserialization(object sender)
{
        this.Dictionary.OnDeserialization(sender);
} 
```

# php - Zend 框架（1.7.5）：如何更改控制器目录

> ID：592299
> 
> 赞同：4
> 
> 时间：2009-02-26T20:28:50.803
> 
> 标签：php, zend-framework

使用 Zend Framework 我想使用存储在非默认目录中的控制器。

我想要实现的是，如果请求的路径以 admin/controls/admin 开头，则使用 layout/admin 和 views/admin 等。

我将如何以相当优雅的方式实现这一目标？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T20:45:21.433

```
$front = Zend_Controller_Front::getInstance();
$front->setControllerDirectory(...path...); 
```

或多条路径

```
$front = Zend_Controller_Front::getInstance();
$front->setControllerDirectory(array(
    'default' => '/path/to/application/controllers',
    'blog'    => '/path/to/application/blog/controllers'
)); 
```

[http://framework.zend.com/manual/en/zend.controller.front.html](http://framework.zend.com/manual/en/zend.controller.front.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-26T20:49:24.403

您可以使用模块目录结构。创建目录结构

```
application
  default
    controllers
    views
    models
  admin
    controllers
    views
    models 
```

有关更多信息，请查看有关[使用传统模块化目录结构的文档](http://framework.zend.com/manual/en/zend.controller.modular.html)

# java - Java中的异步IO？

> ID：592303
> 
> 赞同：60
> 
> 时间：2009-02-26T20:29:41.300
> 
> 标签：java, networking, sockets, asynchronous

除了 java.nio 之外，java 中还有哪些异步 io（基于套接字）的选项？java.nio 是否在后台使用线程（正如我认为.NET 的 async-socket-library 所做的那样，也许它已被更改）还是使用正确的选择调用“真正的”异步 io？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-02-26T21:47:27.133

Java 的 NIO 包（从 Java6 开始）仅通过[Selector提供对](http://java.sun.com/javase/6/docs/api/java/nio/channels/Selector.html)*非阻塞 I/O*的支持。Java7 有望与 NIO.2 一起发布，其中包括异步 I/O 支持。今天，您最好的选择是使用框架。停战提到了米娜。这里有一些其他的。

1.  [灰熊](http://grizzly.java.net/)。这是 Sun 的[GlassFish](http://glassfish.java.net/)服务器的 I/O 核心。Grizzly 提供了进行异步读/写的工具（通过队列模型）。它支持 TCP 和 UDP。我在几个项目中使用过 Grizzly。这个框架有一些我喜欢和不喜欢的地方，但要详细说明这确实是另一个话题。我会说启动和运行某些东西很容易，而 Grizzly 为您完成了很多繁重的工作。
2.  [网状](http://www.jboss.org/netty/)。该项目来自 Mina 项目的原作者之一。我没有用过这个，所以我不知道它对异步 I/O 的支持。你应该看看。

现在，关于您关于线程的问题，NIO 选择器不使用线程进行非阻塞 I/O。在 JDK6 中，他们在 Windows 下使用**select()**，在较新的 Linux 内核上使用 epoll 工具。对于异步 I/O，线程细节取决于框架。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2013-01-29T13:46:33.473

JAVA 7 到了，所以新的答案是带有 Future 类的 NIO.2。例子 ：

在服务器端：

```
final AsynchronousServerSocketChannel serverSocket=
  AsynchronousServerSocketChannel.open().bind(new InetSocketAddress("127.0.0.1", 2587)); // Listening on port 2587 for client connection
Future<AsynchronousSocketChannel> future= serverSocket.accept();
final AsynchronousSocketChannel clientSocket= future.get(); // now it's blocking, useful: future.isDone() and .isCancelled()

//Do whatever you want ..
InputStream stream = Channels.newInputStream(clientSocket) (...) 
```

在客户端：

```
AsynchronousSocketChannel clientChannel = AsynchronousSocketChannel.open();
Future connected = localSocket.connect(ourServerSocketAddress);
// later: if(future.isDone())
connected.get();

//Send something
OutputStream os = Channels.newOutputStream(clientChannel );
os.write (...) 
```

**更新：** 如果您可以使用演员模型，那么[AKKA TCP IO](http://doc.akka.io/docs/akka/snapshot/scala/io-tcp.html)会更好。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-03T21:19:11.640

关于库的另一个建议是 Naga ( [http://naga.googlecode.com](http://naga.googlecode.com) )。它有点不像框架，更像是一个库。它试图看起来更像普通的 java 套接字，如果那是你的一杯茶的话。与 Grizzly、Mina 和 Netty 相比，它是极简主义的。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-02-26T20:33:54.067

`java.nio`只是一个包——“哑”类的集合——它本身不使用任何线程。如果使用得当，例如在[Reactor 设计模式](http://en.wikipedia.org/wiki/Reactor_pattern)中，您可以实现适当的、完全可扩展的异步 I/O。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-26T20:51:09.983

如果您有兴趣将其用于 Network Stuff。一个非常好的选择是：

[http://mina.apache.org/](http://mina.apache.org/)

看看那里它易于使用且非常强大。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-02-28T14:14:12.783

对于最初的问题，在 Unix/Linux 系统上的 AsynchronousFileChannel 的一种情况下，每个 I/O 操作的实现只消耗一个线程。

# iphone - 替换分组 UITableView 中的蓝灰色条纹背景？

> ID：592304
> 
> 赞同：9
> 
> 时间：2009-02-26T20:29:54.527
> 
> 标签：iphone, cocoa-touch

如何替换分组 UITableView 中的垂直蓝灰色条纹背景？例如，有一个横条纹的背景会很酷！

这是一个很好的例子：

[![像这个](https://i.stack.imgur.com/4GSud.jpg)](https://i.stack.imgur.com/4GSud.jpg)
[（来源：[pessoal.org](http://pessoal.org/blog/wp-content/uploads/2009/02/primary.jpg)）]

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-26T20:33:56.717

更改 tableView 上的 backgroundColor 应该可以

```
tableView.backgroundColor = [UIColor colorWithPatternImage:[UIImage imageNamed:@"image.png"]]; 
```

# c# - 如何从 javadoc 中排除某些类/包/公共成员

> ID：592307
> 
> 赞同：1
> 
> 时间：2009-02-26T20:31:17.817
> 
> 标签：c#, java, eclipse, javadoc

我创建了 java api - 从 C# 移植到更具体的 - 除了公共接口之外，它还包含许多我不希望用户知道的内部内容。在 C# 中，我使用 doxygen 来生成文档。我认为 javadoc 具有类似的功能来排除某些公共成员、类，甚至包。

有人会建议如何做到这一点，也许是通过日食？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T20:42:00.957

我相信在 Eclipse 中，您可以指定的唯一排除类型是“排除所有受保护的成员”和基于包的排除（而不是基于类的排除）。

如果您使用 Ant 生成它们，则可以使用嵌套的“package”元素，并且可以使用文件集嵌套元素并向该文件集添加排除项。

例如：

```
<javadoc >
    <sourcefiles>
          <fileset dir="${src}">
              <include name="**/*.java"/>
              <exclude name="**/ClassToExclude.java"/>
          </fileset>
    </sourcefiles>
    <packageset>
          <dirset dir="${src}">
              <include name="com.mydomain.*"/>
              <exclude name="com.mydomain.excludePackage"/>
          </dirset>
     </packageset>
</javadoc> 
```

PS - 我已经使用了`<sourcefiles>`很多元素，但从来没有使用过`<packageset>`元素。后者在句法上可能并不准确。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T20:41:27.900

当然，当你“生成Javadoc”时，你可以选择这个过程涉及的包并排除其他包

[替代文字 http://www.filigris.com/products/docflex_javadoc/images/eclipse_javadoc_1.png](http://www.filigris.com/products/docflex_javadoc/images/eclipse_javadoc_1.png)

（这里的图是用另外一个工具生成的javadoc，但这并没有改变大意）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T20:40:32.613

您可以在 Java 中使用 doxygen。我不知道有任何工具可以用 Javadoc 做你想做的事。

Superpackages 应该出现在 JDK 7 中，我相信可以解决这个问题：http: [//blogs.oracle.com/andreas/entry/superpackages_in_jsr_294](http://blogs.oracle.com/andreas/entry/superpackages_in_jsr_294)

# algorithm - 找到一组中距另一组最远的点

> ID：592310
> 
> 赞同：6
> 
> 时间：2009-02-26T20:31:38.410
> 
> 标签：algorithm, 3d, geometry

我的目标是更有效地实现[这个问题中](https://stackoverflow.com/questions/589145/what-does-this-mysterious-color-method-do-what-does-it-return)提出的算法。

考虑两组点（在 N 空间中。对于 RGB 颜色空间的示例情况是 3 空间，而~~1 空间~~2 空间的解决方案仅在距离计算上有所不同）。你如何找到第一组中离第二组最近邻最远的点？

在一个 1 空间示例中，给定集合 A:{2,4,6,8} 和 B:{1,3,5}，答案将是 8，因为 8 距离 5 3 个单位（它的最近邻在 B）中，而 A 的所有其他成员与 B 中的最近邻居仅相距 1 个单位。编辑：1 空间被过度简化，因为排序与距离相关，而它与更高维度无关。

源问题中的解决方案涉及一组中每个点的蛮力比较（所有 R、G、B，其中 512>=R+G+B>=256 和 R%4=0 和 G%4=0 和 B %4=0) 到另一组 (colorTable) 中的每个点。为了这个问题，请忽略第一组是通过编程方式详细说明的，而不是像第二组那样作为存储列表进行迭代。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-26T20:54:38.913

首先，您需要在另一个集合中找到每个元素的最近邻居。

为了有效地做到这一点，您需要一个[最近邻](http://en.wikipedia.org/wiki/Nearest_neighbor_search)算法。就我个人而言，我会实现一个[kd-tree](http://en.wikipedia.org/wiki/Kd_tree)只是因为我过去在我的算法类中做过它，而且它相当简单。另一个可行的替代方案是[R-tree](http://en.wikipedia.org/wiki/R-tree)。

对最小集合中的每个元素执行一次。（从小到大添加一个元素，然后运行算法找到它的最近邻居。）

从这里您应该能够获得每个元素的最近邻居列表。

在找到最近邻对时，将它们保存在一个排序的数据结构中，该数据结构具有快速加法和快速 getMax 方法，如[堆](http://en.wikipedia.org/wiki/Heap_(data_structure))，按[欧几里德距离](http://en.wikipedia.org/wiki/Euclidean_distance)排序。

然后，一旦完成，只需向堆询问最大值。

运行时间分解如下：

N = 较小集合的
大小 M = 较大集合的大小

*   N * O(log M + 1) 用于所有 kd-tree 最近邻居检查。
*   N * O(1) 用于计算欧几里得距离，然后再将其添加到堆中。
*   N * O(log N) 用于将对添加到堆中。
*   O(1) 得到最终答案 :D

所以最后整个算法是O(N*log M)。

如果您不关心每对的顺序，您可以通过只保留到目前为止找到的最大值来节省一些时间和空间。

*免责声明：这一切都假设您不会使用大量的维度，并且您的元素遵循大部分随机分布。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T20:56:34.887

在我看来，最明显的方法是在一个集合上构建一个树结构，以便您相对快速地搜索它。[kd-tree](http://en.wikipedia.org/wiki/Kd-tree)或类似的可能适合于此。

完成此操作后，您遍历另一组中的所有点，并使用树在第一组中找到它们最近的邻居，并随时跟踪最大值。

构建树是 nlog(n)，一次搜索是 log(n)，所以整个事情应该在 nlog(n) 中运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T21:01:51.720

为了提高效率，请考虑使用 Pigeonhole 算法 - 按它们在 n 空间中的位置对参考集（您的 colorTable）中的点进行分组。这使您可以有效地找到最近的邻居，而无需迭代所有点。

例如，如果您在 2 空间中工作，请将您的平面划分为 5 x 5 的网格，给出 25 个正方形和 25 组点。

在 3 个空间中，将您的立方体分成 5 x 5 x 5 的网格，给出 125 个立方体，每个立方体都有一组点。

然后，要测试点 n，找到包含 n 的正方形/立方体/组并测试到这些点的距离。如果点 n 比组中最近的邻居更靠近边缘，则只需要测试来自相邻组的点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T21:03:00.690

对于集合 B 中的每个点，找到到集合 A 中最近邻居的距离。

要查找到每个最近邻的距离，您可以使用[kd-tree](http://en.wikipedia.org/wiki/Kd-tree)，只要维度数合理，没有太多点，并且您将执行很多查询 - 否则构建成本太高这棵树是值得的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-09-25T22:26:19.783

也许我误解了这个问题，但是将一个数据集中所有坐标上的符号反转（即将一组坐标乘以-1），然后找到第一个最近的邻居（这将是最远的邻居）？您可以使用您最喜欢的 knn 算法，其中 k=1。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-26T20:52:37.110

**编辑**：我的意思是 nlog(n) 其中 n 是两组大小的总和。

在 1-Space 集中你可以做这样的事情（伪代码）

使用这样的结构

```
Struct Item {
    int value
    int setid
} 
```

(1) Max Distance = 0
(2) 将所有集合读入 Item 结构
(3) 创建指向所有
Item 的指针数组 (4) 按结构的 Item->value 字段对指针数组排序
(5) 步行从头到尾的数组，检查 Item->setid 是否与前一个 Item->setid 不同 如果（SetID 不同）
检查此距离是否大于 Max Distance 如果是则将 MaxDistance 设置为该距离

返回最大距离。

# excel - 如何将 Excel 电子表格导入博客..？

> ID：592320
> 
> 赞同：2
> 
> 时间：2009-02-26T20:34:25.547
> 
> 标签：excel

我们有兴趣尝试将 Excel 电子表格导入我们的博客。

我们每天生成并希望导出到博客中的 Excel 电子表格示例位于：

[http://www.wallstreetsignals.com/WhatsWorking.html](http://www.wallstreetsignals.com/WhatsWorking.html)

我们的博客位于：

[http://whatsworkinginthestockmarket.blogspot.com/](http://whatsworkinginthestockmarket.blogspot.com/)

我们对一种程序或方法感兴趣，它允许我们将 Excel 电子表格导入到我们的博客中，而不必手动输入所有数据，这就是我们现在正在做的事情。

感谢您的想法和让您帮助实现我们目标的成本。

Philip WallStreetSignals.com

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T20:43:32.920

好吧，除了创建一个程序（这是可能的，使用 PHP、Perl、Java 等以及一个 excel 输入模块或转换为 CSV 或 XML 并进行处理）......

您是否考虑过使用 Google Documents 或其他在线电子表格软件？导入 Excel 电子表格很容易，然后将电子表格嵌入博客文章或网页中。然后，如果您需要更改它，请修改 google 文档电子表格，更改会立即呈现在网页或博客文章上。

-亚当

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T20:44:00.873

最简单的事情可能是使用 Google Docs。上传您的电子表格，然后从 Google Docs 发布到您的博客。见[这篇文章](http://lifehacker.com/366821/use-google-docs-to-publish-blog-entries)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-11T03:06:26.800

您的博客可以使用 XML 吗？您可以在 Excel 2007 中设置 XML 架构，然后将其导出到 XML 文件。您需要编写一个 XSLT。

我还有一个宏，可以将 XML 写入文件...如果有帮助可以上传...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T21:42:17.943

如果您可以使用 ASP.NET，您可以使用[SpreadsheetGear for .NET](http://www.spreadsheetgear.com/)来加载 Excel 工作簿、抓取值、格式化值甚至图像以显示在网页上。如果您想查看的话，有带有源代码的[实时 ASP.NET 示例。](http://www.spreadsheetgear.com/support/samples/)

免责声明：我为 SpreadsheetGear LLC 工作

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T20:45:35.130

如果您的电子表格是由宏生成的，您只需修改宏以生成 html 或其他类型的博客标记，以便复制和粘贴。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T20:47:27.980

Excel 可以保存为 HTML，然后您可以从中剥离元数据并在您的网站中使用。不幸的是，它生成的 HTML 非常臃肿。如果您不介意客户端锁定，您可以考虑将 XLS 文件直接嵌入您的网站，并让您的查看器使用 IE 嵌入式 excel 查看器。

# php - PHP 期望 T_PAAMAYIM_NEKUDOTAYIM？

> ID：592322
> 
> 赞同：617
> 
> 时间：2009-02-26T20:34:52.957
> 
> 标签：php, syntax-error, runtime-error

有人有`T_PAAMAYIM_NEKUDOTAYIM`吗？

* * *

## 回答 #1

> 赞同：367
> 
> 时间：2009-02-26T20:36:31.750

它是双冒号运算符[`::`](http://php.net/manual/en/language.oop5.paamayim-nekudotayim.php)（请参阅[解析器标记列表](http://docs.php.net/manual/en/tokens.php)）。

* * *

## 回答 #2

> 赞同：122
> 
> 时间：2009-02-26T20:37:17.037

它是[希伯来语](https://en.wikipedia.org/wiki/Hebrew_language)的“双冒号”。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2009-02-26T20:37:22.140

它是`::`PHP 中运算符的名称。它的字面意思是“双冒号”。出于某种原因，他们用希伯来语命名它。检查您的代码语法，并`::`在适当的地方放置一个:-)

* * *

## 回答 #4

> 赞同：52
> 
> 时间：2014-03-13T20:52:40.517

来自[维基百科](http://en.wikipedia.org/wiki/Scope_resolution_operator)：

> 在 PHP 中，范围解析运算符也称为 Paamayim Nekudotayim（希伯来语：פעמיים נקודתיים‎），在希伯来语中意为“双冒号”。
> 
> “Paamayim Nekudotayim”这个名称是在 PHP 3 中使用的以色列开发的 Zend Engine 0.5 中引入的。虽然它让许多不会说希伯来语的开发人员感到困惑，但它仍然在 PHP 5 中使用，如本示例错误消息中所示：
> 
> $ php -r :: 解析错误：语法错误，意外的 T_PAAMAYIM_NEKUDOTAYIM
> 
> 自 PHP 5.4 起，有关范围解析运算符的错误消息仍包含此名称，但已在一定程度上阐明了其含义：
> 
> $ php -r :: 解析错误：语法错误，意外'::' (T_PAAMAYIM_NEKUDOTAYIM)

来自[官方 PHP 文档](http://www.php.net/manual/en/language.oop5.paamayim-nekudotayim.php)：

> 范围解析运算符（也称为 Paamayim Nekudotayim）或更简单的术语是双冒号，是允许访问类的静态、常量和重写属性或方法的标记。
> 
> 从类定义之外引用这些项目时，请使用类的名称。
> 
> 从 PHP 5.3.0 开始，可以使用变量来引用类。变量的值不能是关键字（例如 self、parent 和 static）。
> 
> 起初，Paamayim Nekudotayim 似乎是一个奇怪的命名双冒号的选择。然而，在编写 Zend Engine 0.5（为 PHP 3 提供支持）时，Zend 团队决定这样称呼它。它实际上确实意味着双冒号 - 在希伯来语中！

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2014-11-21T21:19:26.417

当您将 PHP 中的常量应用于 empty() 函数时，也会出现这种情况：

```
if (!empty(SOME_CONSTANT)) {

} 
```

那是我的情况。我用这个解决了它：

```
$string = SOME_CONSTANT;
if (!empty($string)) {

} 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2019-12-10T03:26:39.247

我非常了解希伯来语，所以为了澄清“Paamayim Nekudotayim”这个名字，解释的意思是“双冒号”，但字面意思是：

*   “Paamayim”的意思是“两个”或“两次”
*   “Nekudotayim”的意思是“点”（字面意思是“洞”）
    *   在希伯来语中，*nekuda*的意思是一个点。
    *   复数是*nekudot*，即点，用作元音
    *   之所以称它为 Nekudo- *tayim*，是因为后缀“-ayim”也表示“两次”或“两次”，因此`::`表示“两次，两个点”，或更常见的[范围解析运算符](https://en.wikipedia.org/wiki/Scope_resolution_operator)。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-10-08T09:21:59.980

使用时，这可能发生在 foreachs 上：

```
foreach( $array as $key = $value ) 
```

代替

```
foreach( $array as $key => $value ) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2020-06-26T08:37:16.840

**编辑**：不幸的是，从 PHP 8.0 开始，答案**不是**“不，不再是”。[这个 RFC](https://wiki.php.net/rfc/rename-double-colon-token)没有像我希望的那样被接受，建议`T_PAAMAYIM_NEKUDOTAYIM`改为`T_DOUBLE_COLON`; 但被拒绝了。

**注意**：出于历史目的，我保留此答案。实际上，由于 RFC 的创建和某个时候的投票率，我创建了这个答案。另外，我保留它是为了希望它在不久的将来被接受。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-07-12T05:29:33.717

对我来说，这发生在一个类函数中。

在 PHP 5.3 及更高版本中`$this::$defaults`运行良好；当我将代码交换到由于某种原因具有较低版本号的服务器时，它会引发此错误。

就我而言，解决方案是使用关键字`self`而不是`$this`：

`self::$defaults`工作得很好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-09-25T10:17:47.993

这只是在使用双引号的字符串赋值中发生在我身上。我错过了一个 POST 变量的结束卷曲......

`"for {$_POST['txtName'] on $date"`;

本来应该

`"for {$_POST['txtName']} on $date"`;

我无法解释为什么。我的意思是，我看到了会破坏代码的错误，但我不明白为什么它引用了类错误。

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2020-12-09T10:17:59.337

这只是在 foreach 循环中发生在我身上。我无意中输入`($array as $key as $value)`了第一个，PHP 反对`as`。

# python - 有什么理由不使用 SQLObject 而不是 SQLAlchemy？

> ID：592332
> 
> 赞同：14
> 
> 时间：2009-02-26T20:37:30.720
> 
> 标签：python, orm, sqlalchemy, sqlobject

我不希望需要比基本 CRUD 类型功能更多的东西。我知道 SQLAlchemy 更灵活，但 sqlobject 的语法等似乎更容易上手和使用。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-26T20:41:48.150

我认为 SQLObject 更 Pythonic/更简单，所以如果它适合你，那就坚持下去。
SQLAlchemy 需要更多的学习时间，但如果您需要，可以做更高级的事情。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-26T21:00:19.930

此外，您可能想看看[elixir](http://elixir.ematia.de/trac/wiki)，它是 SQLAlchemy 的一个相当厚实的包装器，它确实使基本任务变得容易，同时保留了 SQLA 的强大功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-06-30T03:41:30.537

试试 quick_orm。它与 SQLAlchemy 一样强大，比 SQLObject 更简单。

[https://github.com/tylerlong/quick_orm](https://github.com/tylerlong/quick_orm)

# wpf - 如何将数据集直接绑定到 TreeView（具有层次结构）？

> ID：592335
> 
> 赞同：0
> 
> 时间：2009-02-26T20:38:21.403
> 
> 标签：wpf, data-binding, xaml, treeview

如果我有一个作为 SQL 查询的结果的 DataSet，我可以将它直接绑定到 TreeView 并显示我的数据的层次结构吗？我知道我必须使用几个 HierarchicalDataTemplates，但我不知道如何告诉每个人要显示什么数据。

如果我有 4 级层次结构，如下所示：

```
<HierarchicalDataTemplate x:Key="FirstLevelTemplate" ItemTemplate="{StaticResource SecondLevelTemplate}"/>
<HierarchicalDataTemplate x:Key="SecondLevelTemplate" ItemTemplate="{StaticResource ThirdLevelTemplate}"/>
<HierarchicalDataTemplate x:Key="ThirdLevelTemplate" ItemTemplate="{StaticResource FourthLevelTemplate}"/>
<DataTemplate x:Key="FourthLevelTemplate"/> 
```

需要设置哪些属性才能直接从数据集中显示我的数据？

编辑：理想情况下，我想使用单个自引用 DataTable 来执行此操作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-22T02:34:21.760

这个站点有一些很好的使用树视图的例子。

[比斯托尔尼茨](http://bea.stollnitz.com/blog/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-22T03:41:18.337

我不认为你能做到这一点。

Treeview 控件和 HierarchicalDataTemplate 需要对象的层次结构。DataSet 本质上是扁平的。

您必须以某种方式将该数据集转换为对象层次结构，每个对象都有自己的“儿童”集合。树视图的 ItemsSource 将绑定到“顶级集合”（没有父引用的行）。

每个 HierarchicalDataTemplate 都将其 ItemsSource 属性绑定到相应的 Children 属性。

可能有一个使用转换器的解决方案，但如果它存在，它可能最终会比在绑定之前直接重塑数据更复杂。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-11T17:17:44.757

首先，将 TreeView 的 ItemsSource 设置为 DataSet。

接下来，将 TreeView 的 ItemTemplate 设置为 FirstLevelTemplate。

```
ItemTemplate="{StaticResource FirstLevelTemplate}" 
```

第一个模板必须引用将使用第二级模板的项目。将项目源添加到此分层模板，如下所示：

```
<HierarchicalDataTemplate x:Key="FirstLevelTemplate" ItemsSource="{Binding ChildItems}" ItemTemplate="{StaticResource SecondLevelTemplate}"/> 
```

更改“ChildItems”以引用包含子项的 DataSet 中的属性。对每个 HierarchicalDataTemplate 重复此操作。

最后，您需要向 DataTemplates 添加控件以显示数据。这是一个简单的例子：

```
<DataTemplate x:Key="FourthLevelTemplate"/>
   <Border BorderThickness="1" BorderBrush="Gray" CornerRadius="3">
      <TextBlock Text="{Binding DataProperty}"
                 HorizontalAlignment="Center" VerticalAlignment="Center"/>
   </Border>
</DataTemplate> 
```

在这种情况下，您可以将“DataProperty”替换为数据字段的属性名称。请注意，您可以添加其他控件（如 TextBox、ComboBox 等）来显示其他数据。

# scala - Scala 中的类型参数与成员类型

> ID：592344
> 
> 赞同：10
> 
> 时间：2009-02-26T20:40:34.237
> 
> 标签：scala, types, type-inference

我想知道成员类型在 Scala 中是如何工作的，以及我应该如何关联类型。

一种方法是使关联类型成为类型参数。这种方法的优点是我可以规定类型的变化，并且我可以确定子类型不会改变类型。缺点是，我无法从函数中的类型推断类型参数。

第二种方法是使关联类型成为第二种类型的成员，它的问题是我无法对子类型的关联类型规定界限，因此，我不能在函数参数中使用该类型（当 x ： X, X#T 可能与 xT 没有任何关系）

一个具体的例子是：

我有一个 DFA 的特征（可能没有 type 参数）

```
trait DFA[S] { /* S is the type of the symbols in the alphabet */
  trait State { def next(x : S); }
  /* final type Sigma = S */
} 
```

我想创建一个在输入序列上运行这个 DFA 的函数，我想要

*   该函数必须将任何内容`<% Seq[alphabet-type-of-the-dfa]`作为输入序列类型
*   函数调用者不需要指定类型参数，都必须推断
*   我希望使用具体的 DFA 类型调用该函数（但如果有一个解决方案，该函数没有 DFA 的类型参数，那没关系）
*   字母表类型必须不受约束（即，必须有一个用于 Char 以及未知用户定义类的 DFA）
*   具有不同字母类型的 DFA 不是子类型

我试过这个：

```
def runDFA[S, D <: DFA[S], SQ <% Seq[S]](d : D)(seq : SQ) = .... 
```

这行得通，除了这里没有推断出类型 S，所以我必须在每个调用站点上编写整个类型参数列表。

```
def runDFA[D <: DFA[S] forSome { type S }, SQ <% Seq[D#Sigma]]( ... same as above 
```

这不起作用（对类型 D 的无效循环引用？？？（它是什么？））

我还删除了类型参数，创建了一个抽象类型 Sigma 并尝试在具体类中绑定该类型。runDFA 看起来像

```
def runDFA[D <: DFA, SQ <% Seq[D#Sigma]]( ... same as above 
```

但这不可避免地会遇到诸如“类型不匹配：预期`dfa.Sigma`，得到`D#Sigma`”之类的问题

有任何想法吗？指针？

编辑：

由于答案表明没有简单的方法可以做到这一点，有人可以详细说明为什么这是不可能的以及必须改变什么才能奏效吗？

我希望 runDFA ro 成为一个自由函数（而不是方法）的原因是我想要其他类似的函数，如自动机最小化、常规语言操作、NFA 到 DFA 转换、语言分解等，并将所有这些都放在一个类中几乎违反了OO设计的任何原则。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-26T22:23:02.883

Scala 的类型推断有时还有很多不足之处。

有什么理由不能在 DFA 特征中包含该方法吗？

```
def run[SQ <% Seq[S]](seq: SQ) 
```

如果您以后不需要 D 参数，您也可以尝试在没有它的情况下定义您的方法：

```
def runDFA[S, SQ <% Seq[S]](d: DFA[S])(seq: SQ) = ... 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T22:53:14.480

首先，您不需要参数化 SQ <% Seq[S]。将方法参数写为 Seq[S]。如果 SQ <% Seq[S] 那么它的任何实例都可以隐式转换为 Seq[S] （这就是 <% 的含义），因此当作为 Seq[S] 传递时，编译器将自动插入转换。

此外，Jorge 谈到 D 上的类型参数并使其成为 DFA 上的方法时所说的话。由于内部类在 Scala 中的工作方式，我*强烈建议*将 runDFA 放在 DFA 上。在依赖于路径的类型工作起作用之前，处理一些外部类的内部类可能会有点痛苦。

所以现在你有

```
trait DFA[S]{
  ...

  def runDFA(seq : Seq[S]) = ...
} 
```

并且 runDFA 突然之间很容易推断类型参数：它没有任何类型参数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-04-27T09:53:41.980

关于两者有何不同的一些有用信息：

从无形[指南](https://github.com/underscoreio/shapeless-guide)：

例如，如果没有类型参数，您将无法创建依赖类型

```
trait Generic[A] {
  type Repr
  def to(value: A): Repr
  def from(value: Repr): A
}

import shapeless.Generic
def getRepr[A](value: A)(implicit gen: Generic[A]) =
  gen.to(value) 
```

这里返回的类型`to`取决于输入类型`A`（因为提供的隐式取决于`A`）：

```
case class Vec(x: Int, y: Int)
case class Rect(origin: Vec, size: Vec)
getRepr(Vec(1, 2))
// res1: shapeless.::[Int,shapeless.::[Int,shapeless.HNil]] = 1 :: 2 ::
     HNil
getRepr(Rect(Vec(0, 0), Vec(5, 5)))
// res2: shapeless.::[Vec,shapeless.::[Vec,shapeless.HNil]] = Vec(0,0)
     :: Vec(5,5) :: HNil 
```

没有类型成员，这是不可能的：

```
trait Generic2[A, Repr]
def getRepr2[A, R](value: A)(implicit generic: Generic2[A, R]): R =
  ??? 
```

> 我们必须将所需的 Repr 值作为类型参数传递给 getRepr，从而有效地使 getRepr 无用。直观的结论是类型参数可用作“输入”，类型成员可用作“输出”。

有关详细信息，请参阅无形[指南](https://github.com/underscoreio/shapeless-guide)。

# refactoring - 你做过哪些成功的软件转换/重写？

> ID：592350
> 
> 赞同：8
> 
> 时间：2009-02-26T20:43:05.307
> 
> 标签：refactoring, code-migration

您对您参与的软件进行了哪些成功的转换/重写？过程中涉及哪些语言和框架？有问题的软件有多大？最后，您从参与该过程中学到的最重要的一两件事是什么。

这与这个[问题有关](https://stackoverflow.com/questions/592354/what-failed-conversion-rewrite-of-sofware-have-you-done)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-26T20:47:00.557

我要在这里“最深奥”：

*   将用 FORTRAN 77 编写的 8080 模拟器从运行 TOPS-10 的 DECSystem-10 移植到运行 VM/CMS 的 IBM 4381 大型机。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T20:47:29.383

我重写了 20,000 行 Perl 以在每个文件中使用“use strict”。我必须在需要的地方添加“我的”，并且我必须修复在此过程中发现的错误。

我从中学到的最重要的事情是，“它总是比你想象的要长。”

我必须在一夜之间把它全部完成，这样其他编码人员就不会同时编写新的、未修复的代码。我以为它会很快完成，但没有，第二天早上 6 点我仍然在破解它。

不过，我确实在其他人开始工作之前完成并签到了！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T20:52:02.353

由于各种原因，我为一家房地产公司将一个大型 Java Web 应用程序重写为一个 ASP.Net 应用程序。

我学到的最大的一点是，无论原系统有多么微不足道的功能，如果它不在第二个系统中，客户就会认为重写是失败的。编写新系统时，期望管理就是一切。

这是重写如此困难的最大原因：对客户来说似乎很容易（“只需重新做我已经拥有的并添加一些东西。”）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T21:04:30.827

我认为对我来说最酷的[是 MAME 到 iPod 的端口](http://www.engadget.com/2006/03/08/ipodmame-brings-pac-man-to-the-ipod/)。这是嵌入式硬件的一次很棒的学习经历，我和很多很棒的人一起工作。[官方网站](http://www.ipodlinux.org/wiki/Ipodmame)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T20:46:15.423

将理论上可移植的 C 代码跨架构转换为理论上可移植的 C 代码，以支持硬件更改，从而为公司每单位节省 X 美元。

大小各不相同——这是一种常见的需求，我做过大大小小的项目。

我学会了编写更便携的 C 代码。优雅是伟大的，但当涉及到它时，编译器会照顾性能，并且代码应该尽可能简单和可移植。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T20:50:05.370

我正在将内部项目管理系统重写为更标准的 MVC 模型。它在 LAMP 堆栈（PHP）中，我接近第一个里程碑。

我目前从中学到的东西是程序在开始时感觉多么简单，我尽量不增加复杂性，直到我不得不这样做。

例如，我首先对所有功能进行了编程（就像我是管理员用户一样），然后在整理好之后，添加限制的复杂性（用户级别等）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-26T20:50:45.210

我将一个 30,000 行的 MS-DOS C++ 程序移植/重新设计/重写为一个长度相似但功能更全面且可用的 Java Swing 程序。

我学会了永远不要再从事涉及 C++ 或 Java 的工作。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-26T20:51:24.477

我将一个价值几百个屏幕的客户端服务器 Powerbuilder 应用程序移植到一个 ASP.NET 应用程序 (C#) 中。

由于性能和可维护性问题，我在前一年将大量嵌入式 SQL 从 Powerbuilder 脚本移到了存储过程中。

虽然这会让很多人畏缩，在数据库中有很多业务逻辑，这意味着 Powerbuilder 应用程序相对“轻”，当我们构建 .Net 前端时，它可以利用 SQL 代码库并拥有许多功能已经构建和测试。

并不是说我会推荐以这种方式构建应用程序，但在这种情况下它确实对我们有利。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-26T20:51:33.040

我们的应用程序框架中有一个代码生成工具，用于读取基于文本的数据文件，大约有 20 个其他应用程序使用了它。

我们想使用 XML 数据文件而不是结构化的基于文本的文件。原始代码已经过时且难以维护。我们用 XSLT 脚本和实用程序库的组合替换了这个工具。对于实用程序库，我们可以使用旧工具中的一些代码。

结果是所有 20 个应用程序现在都可以使用过时的基于文本的文件格式或新的基于 XML 的格式。我们还提供了一个转换生成工具，可以将旧数据文件转换为新的 XML 数据文件。

在推出一两个版本后，我们现在决定不再支持旧的基于文本的格式，每个人都可以将他们的数据转换为 XML。

我们几乎不需要手动转换，

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-26T20:54:48.010

将主要的公司应用程序从标准 C++ 转换为标准 C++。我们进行了数百万美元的销售，以使其能够在 AIX 上运行，在查看之后，我们决定转换为标准 C++ 与转换为 IBM 的传统 C++ 一样容易。

我不知道行数，但源代码运行到数百兆字节。

我们使用标准的 Unix 工具来做到这一点，包括 vi 和各种编译器。

花了几个月的时间。大多数修复都是简单的，被编译器捕获并且几乎是机械修复的。其中一些要复杂得多。

我认为我的主要收获是：不要太聪明地使用尚未标准化的语言编写代码，否则事情可能会以意想不到的方式发生变化。我们不得不对 C++ 流的一些巧妙改编/滥用进行大量挖掘。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-26T20:56:11.830

十年前，我管理的一个团队将 CAD 系统从 DOS 转换为 Windows。DOS 版本使用[自制库](http://www.spinellis.gr/pubs/tr/porgrlib/html/porgrlib.html)对于图形绘制，Windows 版本使用 MFC。在转换时，该软件大约有 70.000 行 C 代码。我们在这个过程中学到的最重要的东西是抽象的力量。所有特定于设备的非便携式例程都被隔离在几个文件中。因此，使用 Windows API 调用直接访问帧缓冲区来替换对基于 DOS 的库的调用相对容易。同样，对于输入，我们只是将检查键盘和鼠标事件的事件循环替换为相应的 Windows 事件循环。我们继续我们将不可移植（这次是 Windows）代码与系统其余部分隔离的政策，但我们还没有发现这特别有用。也许有一天我们会将系统移植到 Mac OS X 上，并再次心存感激。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-26T21:09:07.787

一些。但我提到一个。

它是一种性能建模工具。部分德尔福1，部分涡轮帕斯卡。它需要重写，否则它将无法生存。所以我们开始时是一个 2 人的团队，但只有我活到了最后。我在截止日期前就准备好了；-)。

我们做了几件事：

*   使其成为多模型。原版有很多全局变量。我将它们全部删除，多模型很容易适应。
*   扩展错误消息。单击消息并获取帮助。
*   很多图表和图表。所有可单击以向下钻取。
*   模拟。随着时间的推移更改参数，看看当前配置有多长时间就足够了。

我们真的把它弄干净了，它最终得到了丰厚的回报。这么大的学习经历。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-27T06:43:48.950

为一家处理合法发票的公司重新编写了一个系统——原始系统是一个 VB 怪物，不知道好的 OO 原则——所有东西都混在一起了。HTML 执行 SQL，而 SQL 编写 HTML。其中很大一部分是一个自定义规则引擎，它使用 XML 之类的东西作为规则。

两个团队进行了重写，耗时约 9 个月。一个团队负责 Web 前端和后端工作流程，而另一个团队（我所在的团队）重新编写了规则引擎。新系统是用 C# 编写的，并且是先测试完成的。完成后向系统添加新规则非常简单，而且都是可测试的。在此过程中，我们将公司从 VSS 转换为 SVN，实施持续集成，自动化部署，并教其他开发人员如何进行 TDD 和其他 Scrum/XP 实践。

通过该项目管理期望是至关重要的。拥有精通软件的客户非常有帮助。

将大规模（端到端）测试与全面的单元和集成测试相结合，帮助了很多人。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-27T06:57:52.973

将用 PHP 编写的 vBulletin 转换为 C#/Asp.NET。我对这两种语言都非常熟悉，但 PHP 无疑是构建该软件的赢家。后面最大的痛苦是需要做一个与 PHP 的 eval() 等效的 C# 来调用模板。

这是我尝试转换的第一个挑战。我了解到我需要更多的 C# 经验，并且有时从头开始编写它只是更简单的方法。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-27T09:34:01.803

我使用同事开发的工作流引擎将一个完全用 Perl 编写的动态构建过程转换为 C#/.Net 解决方案（它仍处于测试阶段 - 所以我必须进行一些改进）。这让我有机会将故障安全和故障转移功能添加到构建过程中。

在您询问之前 - 不 - 无法使用 microsoft 工作流基础，因为您无法在其运行时动态更改流程。

我学到的是：

*   讨厌 Perl 开发者
*   使用 wf 引擎进行流程优化
*   故障安全和故障转移策略
*   一些 C# 调整 ;)

最后，它涵盖了来自 3 200 个 LoC Perl 文件的大约 5k - 6k（包括 wf 引擎）的 LoC 来源。但这很有趣——而且最终要好得多；）

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-27T20:14:37.800

将用 Fortran 77（尽管是在 90 年代编写的）编写的模拟移植到 C/Java，因为原来的模拟只适用于小型数据集。在多次解释为什么在程序开始时将整个数据表移动到内存中无法扩展之后，我学会了喜欢大 O 表示法。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-11-25T07:05:08.230

[将 B-2 隐形轰炸机任务软件从 JOVIAL 迁移到 C。100](http://www.semanticdesigns.com/Products/Services/NorthropGrummanB2.html) % 全自动转换。严重地！

主要教训：*使用可配置的自动转换工具是一个巨大的胜利*。

请参阅[DMS 软件再造工具包](http://www.semanticdesigns.com/Products/DMS/DMSToolkit.html)。

# wcf - 如何使用 WCF 要求有效的用户名 + 密码（没有传输安全性）

> ID：592353
> 
> 赞同：0
> 
> 时间：2009-02-26T20:44:17.130
> 
> 标签：wcf

与[这个问题](https://stackoverflow.com/questions/379526/wcf-username-without-certificate)类似，我需要能够在没有传输安全性的情况下要求用户名 + 密码。但在我的情况下，实际的 IIS 服务器没有 SSL，但它前面的代理有。

这就是 WCF 存在问题的地方——因为托管它的盒子在没有 SSL 的情况下不允许这种类型的安全性。简而言之 - 我是否需要为此编写自己的绑定，或者我是否错过了针对这种情况的某种解决方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T20:51:40.670

是的，如果您需要传递用户名/密码，WCF 将需要加密通信。

我认为唯一的方法是创建一个用于安全通信的证书（消息级别的安全性）。您可以使用 makecert 轻松完成此操作，如下所示：

```
makecert.exe -sr LocalMachine -ss My -a sha1 -n CN=localhostCA -sky exchange -pe 
```

您可能需要使用 Windows HTTP 服务证书配置工具为 IIS 用户授予对该证书的访问权限。然后，运行以下命令（假设“ASPNET”是适当的 IIS 用户）：

```
winhttpcertcfg -g -c LOCAL_MACHINE\My -s localhostCA -a ASPNET 
```

将“localhostCA”替换为您的证书名称。

# refactoring - 你做过哪些失败的软件转换/重写？

> ID：592354
> 
> 赞同：3
> 
> 时间：2009-02-26T20:44:54.553
> 
> 标签：refactoring, code-migration

您参与了哪些失败的转换/重写？过程中涉及哪些语言和框架？有问题的软件有多大？最后，您从参与该过程中学到的最重要的一两件事是什么。

这与这个[问题有关](https://stackoverflow.com/questions/592350/what-successful-conversion-rewrite-of-sofware-have-you-done)。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T20:55:53.997

我最喜欢的一个项目是在 Sun OS 3 上开发服务器应用程序的固定价格项目，最终需要在运行某些（当时）当前版本的 Unix 的旧 Data General 机器上运行。

现在，我们提前知道将 C 代码移植到 Data General 会很痛苦，因为它有 9 位字节/36 位字，但没有意识到……缺少……Unix 实现。

从移植任务开始大约 5 小时后，明智的执行决定是简单地为客户购买一个闪亮的新 Sun 盒子。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-05T16:09:19.213

我最近有一个很大程度上失败了，因为我无法彻底说服管理层从长远来看重写应用程序比保持原样维护它更便宜。如果我早点阅读技术债务，它可能会成功。Jeff 关于该主题的最新文章对我来说已经晚了大约 8 个月！

总而言之，该应用程序大约有 75K 行 C# 代码，但它是维护的噩梦（内部应用程序）。少数神类，其余的就是我所说的木偶类（仅按名称的类，神类为他们所做的一切“拉线”）。几乎没有任何东西是用户可配置的，因此开发人员负责一切。

事后看来，成功的最大障碍是应用程序本身。保持它运行是我们三个人的全职工作。我认为我们能做的最好的事情就是继续重构。“版本 2”应用程序有一些真正好的概念，我们应该继续尝试将它们集成而不是重新开始......如果我们这样做了，我们可以在稳定原始应用程序后构建大型组件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T16:13:51.857

我曾经尝试将我用 DarkBasic 编写的游戏移植到 C。

我遇到的问题是，DarkBasic 是一种有限的语言（例如，没有通过引用传递的参数）当我移植它时我试图做一个直接移植...... IE，我试图不为我的语言适当地重构它正在使用...

结果大乱了……

我可能已经让它工作了，但我在大约 2 天后停止了，因为我意识到它需要的不仅仅是翻译才能转移到 C ......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-05T16:14:05.410

我以前用 C 和 Allegro 编写了一个 Pacman 克隆，我试图重写它以在 Dreamcast 上运行。

那是一些可怕的代码。我无法真正从代码库中挽救多少，并放弃了这个想法。

我了解到，不管我当时怎么想，我当时都是一个非常糟糕的程序员，在过去的几年里我学到了很多东西。这也让我意识到，几年后，我应该学到足够多的东西来回顾我今天写的代码并思考同样的事情。基本上，我应该一直努力变得更好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-05T16:22:31.630

我曾经被要求将一个驱动 DEC-System10 上的照片打字机的程序转换为 IBM 4381。查看代码，我发现原始开发人员无缘无故地在以下不同的地方编写了程序的各个位语言：

*   DEC FORTRAN
*   阿尔戈尔 68
*   BCPL
*   宏 10

这很好地证明了 DEC 对多语言编程的支持，但这是我唯一一次不得不对用户说“不可以”。

# iphone - Objective-C 内存问题（iPhone）

> ID：592355
> 
> 赞同：2
> 
> 时间：2009-02-26T20:45:02.760
> 
> 标签：iphone, objective-c, memory-management

我对在为 iPhone 模拟器（或设备）编译的 Xcode 项目中看到的以下行为感到有些困惑：

```
NSString *test = [[NSString alloc] initWithCString:"foo"];

NSLog(@"test retain count = %d", [test retainCount]); // prints 1

[test release];

NSLog(@"test retain count = %d", [test retainCount]); // also prints 1 instead of 0 
```

但是，任何进一步尝试访问“test”都会导致 Xcode 环境崩溃，无论是另一个`[test retainCount]`NSLog 语句还是其他（即使只是检查 test 是否等于 nil）。

想法？在一个简单的基于视图的测试项目中编译...代码存在于项目的 applicationDidFinishLaunching 方法中。

澄清——我知道在实践中不要这样做。这只是一个测试，看看为什么在某些调试情况下，保留计数 1 并不能真正反映对象的真实状态。感谢您的回复。这只是一个测试存根，以了解为什么在某些情况下我会看到某些行为。我真正想做的是追踪一个非常小的内存泄漏（0.06MB），每当我销毁/重新创建自定义视图时，它就会一直被创建。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T20:58:55.817

保留计数是一种调试辅助工具，可能会根据 Cocoa 在幕后所做的事情产生误导。对于数据永久可用且从未真正删除的字符串文字尤其如此。

集中精力确保您的代码遵循[Cocoa 内存管理规则](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html)关于对象所有权。如有必要，使用 Instruments 检查实际的内存泄漏。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-26T21:02:25.823

你在它被释放并且可能被释放之后调用`retainCount`，`test` *所以*结果肯定是不可靠的，更不用说你不应该向释放的对象发送任何消息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T20:59:04.113

不要依赖保留计数...框架可能会自行保留内容。

相反，依赖于 Objective-C 的内存管理规则。如果你分配、初始化或新的东西，你拥有它并负责释放它。如果你没有，你就不是。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T20:59:43.457

不要依赖保留计数；相反，请确保您正在平衡保留和释放。以下是一些关于 Cocoa (Touch) 内存管理的链接：http: [//iamleeg.blogspot.com/2008/12/cocoa-memory-management.html](http://iamleeg.blogspot.com/2008/12/cocoa-memory-management.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T21:06:03.427

当您发送该字符串时`release`，该字符串将被释放——它没有其他所有者保留它。向它发送更多消息（包括`retainCount`）是一个错误，并且不会返回任何有意义的信息。

正如其他人指出的那样，不要依赖保留计数特别有用。它们是您可以查看的图片的一部分，但它们通常具有误导性。例如，自动释放不会显示在保留计数中，有时对象会出于缓存目的而额外保留，等等。但是，在这种特殊情况下，您根本没有将消息发送到有效对象，所以您很幸运能得到答案而不是崩溃。

如果您对此不清楚，您应该阅读[Apple 的内存管理指南。](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html)对于 Cocoa 编程来说，它并不太复杂而且绝对必要。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T21:18:57.123

改进上面显示的代码的一个技巧是使用“设置为零”约定。

例如：

NSString *test = [[NSString alloc] initWithCString:"foo"];

NSLog(@"测试保留计数 = %d", [测试保留计数]); // 打印 1

[测试发布]；测试=无；// 设置为零，因为我已经释放了指针，我不应该再使用它。

NSLog(@"测试保留计数 = %d, 测试 foobarpro = %d", [测试保留计数], [测试 foobarPro]); // 现在将打印 0 和 0 - 因为对 nil 对象的任何 Objective-c 调用都返回 0（并且不会崩溃）

通过在发布后将指针设置为零，您可以在未来稍微证明您的代码：稍后出现并编辑下面 10 行代码的人可能会意外使用“测试”而可能没有不良影响（或明显的崩溃）。我什至在 dealloc 调用中设置了指向 nil 的指针，因为在销毁时使用非 nil 的“坏”指针时会发生一些最困难的调试任务。

您还可以使用僵尸进行调试，以查找使用无效测试等指针的情况。

——汤姆

# inversion-of-control - 提供者模式是 IOC 的实现吗？

> ID：592356
> 
> 赞同：3
> 
> 时间：2009-02-26T20:45:11.950
> 
> 标签：inversion-of-control, design-patterns

提供者模式是 IOC 的实现吗？如果不是，为什么不呢？

（阅读马丁福勒关于国际奥委会的文章）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-09-20T05:23:44.667

在我看来，是的，提供者模式是一种控制反转的形式。

我的理由是什么？

IoC 的核心是一个非常通用的概念，以至于 Martin Fowler 谈到从命令行读取用户输入是[IoC 的一种形式](http://martinfowler.com/articles/injection.html#InversionOfControl)。

对于提供者模型，当提供者框架决定在调用给定方法时将使用哪个提供者时，就会发生反转。例如，当您调用 Membership.GetUser 时，您的代码会将使用哪个 Membership 提供者的控制权委托给提供者框架。

正如 Fowler 所说，“控制反转是框架的共同特征”，如果您考虑一下，许多模式都与 IoC 相关（例如策略模式）。我什至会说，即使是多态也是 IoC 的一种形式（我很乐意听到反驳的观点）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T20:55:50.957

[Spring](http://static.springframework.org/spring/docs/2.5.x/reference/index.html)使用[BeanFactory](http://static.springframework.org/spring/docs/2.5.x/api/index.html)及其具体实现，其中最重要的是 ApplicationContext。不知道[Guice](http://code.google.com/p/google-guice/)是做什么的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-13T10:59:37.680

我认为即使是这样，您也不一定要使用它“代替” IOC，否则您将错过并拥有混乱的代码库。IOC 容器通常可以在更强大且更易于维护的代码中进行配置，而提供者模型必须在 Web.Config 中进行配置。

现在我正在使用 IOC 容器，实际上我正在考虑放弃提供者模型，因为它看起来有点矫枉过正。

在我的博客文章中阅读更多内容 - 希望该博客也会得到一些好的评论： [http ://healthedev.blogspot.com/2011/12/making-custom-built-applications.html](http://healthedev.blogspot.com/2011/12/making-custom-built-applications.html)

# database - Windows Vista 上的 MSDataShape

> ID：592359
> 
> 赞同：2
> 
> 时间：2009-02-26T20:45:44.223
> 
> 标签：database, ms-access, vba, windows-vista

我有一个访问数据库的连接，该数据库实现了在 Windows XP 上完美运行的 MSDataShape，现在当我尝试在 Windows Vista 上运行它时，它给我一个错误。

vista上的错误：

> 错误 # -2147467259 [Microsoft][ODBC Driver Manager] 未找到数据源名称且未指定默认驱动程序

相同的代码在干净的 xp 安装中完美运行。

有什么大秘密？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T22:30:45.487

我在 Vista 和 Access 2000 上对此进行了测试，它对我有用。我有最新的 Jet 版本，它应该与 Vista 一起安装。

```
Private Sub Form_Open(Cancel As Integer)
    Set cn = New ADODB.Connection
    With cn
        .Provider = "MSDataShape"
        .CursorLocation = adUseClient
        .ConnectionString = "DATA PROVIDER=Microsoft.Jet.OLEDB.4.0;" _
         & "DATA SOURCE=c:\docs\ltd.mdb"
        .Open
    End With

    Set rs = New ADODB.Recordset

    With rs
        .Source = "SELECT * From Table1"
        .ActiveConnection = cn
        .CursorType = adOpenKeyset
        .LockType = adLockOptimistic
        .Open
    End With

    Set Me.Recordset = rs
    Me.UniqueTable = "Table1"

End Sub 
```

参考资料： http: [//support.microsoft.com/kb/227053/EN-US/](http://support.microsoft.com/kb/227053/EN-US/) [http://support.microsoft.com/kb/239114/en-us](http://support.microsoft.com/kb/239114/en-us)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T02:30:38.640

有几件事要检查：

*   您正在使用 ODBC，您确定创建了与您在 XP 机器上使用的完全相同的 ODBC 数据源吗？

*   如果您使用的是 64 位操作系统，则需要创建一个[32 位 ODBC](http://support.microsoft.com/kb/942976)数据源，64 位 ODBC 数据源对 32 位应用程序 Access 是不可见的。

*   确保您安装了正确的 Jet 数据库驱动程序。如果您使用 Access 2007，这些将是[Access 数据库引擎组件](http://www.microsoft.com/downloads/details.aspx?FamilyID=7554f536-8c28-4598-9b72-ef94e038c891&DisplayLang=en)。

# asp.net - 登录会员.NET

> ID：592364
> 
> 赞同：2
> 
> 时间：2009-02-26T20:46:51.197
> 
> 标签：asp.net, authentication, web-config, authorization, membership

嗨，我想知道在 .net 中到达网站时强制用户登录的最佳方式是什么。我已经设置了会员功能，我想知道什么是最好的方法来确保无论用户到达哪个地址，他们必须首先获得身份验证，然后才能进入他们请求的页面。任何资源都会很棒，谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-26T20:48:05.840

`Web.config`在应用程序根目录中更改为：

```
<authentication mode="forms">
   <forms loginUrl="Login.aspx" defaultUrl="/" />
</authentication>
<authorization>
   <deny users="?" />
   <allow users="*" />
</authorization> 
```

*旁注*：显然，ASP.NET 只能保护传递给 ASP.NET 引擎的请求。默认情况下，它不能对 IIS 经典模式下的静态资源强制执行安全性。在这种情况下，为了控制对静态资源的访问，它们应该显式映射到 IIS 配置中的 ASP.NET ISAPI DLL。

此处有关授权的更多信息：[ASP.NET 授权](http://msdn.microsoft.com/en-us/library/wce3kxhd.aspx)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-26T20:50:09.567

[表单身份验证解释](http://msdn.microsoft.com/en-us/library/aa480476.aspx)

这是来自 web.config 的示例

```
<forms loginUrl="Login.aspx"
       protection="All"
       timeout="30"
       name=".ASPXAUTH" 
       path="/"
       requireSSL="false"
       slidingExpiration="true"
       defaultUrl="default.aspx"
       cookieless="UseDeviceProfile"
       enableCrossAppRedirects="false" /> 
```

# wpf - 在显示 ContextMenu 之前右键单击选择 TreeView 节点

> ID：592373
> 
> 赞同：104
> 
> 时间：2009-02-26T20:49:13.500
> 
> 标签：wpf, treeview, contextmenu

我想在显示 ContextMenu 之前右键单击选择一个 WPF TreeView 节点。

对于 WinForms，我可以使用类似[Find node clicked under context menu](https://stackoverflow.com/questions/2527/c-treeview-context-menus)的代码，有哪些 WPF 替代方案？

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-02-27T13:06:18.923

根据填充树的方式，[发送者和 e.Source 值可能会有所不同](https://stackoverflow.com/questions/593194/why-e-source-depends-on-treeview-populating-method)。

一种可能的解决方案是使用 e.OriginalSource 并使用 VisualTreeHelper 查找 TreeViewItem：

```
private void OnPreviewMouseRightButtonDown(object sender, MouseButtonEventArgs e)
{
    TreeViewItem treeViewItem = VisualUpwardSearch(e.OriginalSource as DependencyObject);

    if (treeViewItem != null)
    {
        treeViewItem.Focus();
        e.Handled = true;
    }
}

static TreeViewItem VisualUpwardSearch(DependencyObject source)
{
    while (source != null && !(source is TreeViewItem))
        source = VisualTreeHelper.GetParent(source);

    return source as TreeViewItem;
} 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2013-01-15T22:40:17.263

如果您想要一个仅 XAML 的解决方案，您可以使用 Blend Interactivity。

假设`TreeView`数据绑定到视图模型的分层集合，该集合具有一个`Boolean`属性`IsSelected`和一个`String`属性`Name`以及一个名为的子项集合`Children`。

```
<TreeView ItemsSource="{Binding Items}">
  <TreeView.ItemContainerStyle>
    <Style TargetType="TreeViewItem">
      <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
    </Style>
  </TreeView.ItemContainerStyle>
  <TreeView.ItemTemplate>
    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
      <TextBlock Text="{Binding Name}">
        <i:Interaction.Triggers>
          <i:EventTrigger EventName="PreviewMouseRightButtonDown">
            <ei:ChangePropertyAction PropertyName="IsSelected" Value="true" TargetObject="{Binding}"/>
          </i:EventTrigger>
        </i:Interaction.Triggers>
      </TextBlock>
    </HierarchicalDataTemplate>
  </TreeView.ItemTemplate>
</TreeView> 
```

有两个有趣的部分：

1.  该`TreeViewItem.IsSelected`属性绑定到`IsSelected`视图模型上的属性。将视图模型上的属性设置`IsSelected`为 true 将选择树中的相应节点。

2.  当`PreviewMouseRightButtonDown`在节点的可视部分（在此示例中为 a `TextBlock`）触发时`IsSelected`，视图模型上的属性设置为 true。回到 1\. 你可以看到在树中被点击的对应节点变成了被选中的节点。

在项目中获得 Blend Interactivity 的一种方法是使用 NuGet 包[Unofficial.Blend.Interactivity](http://nuget.org/packages/Unofficial.Blend.Interactivity)。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-10-13T09:59:57.443

使用“item.Focus();” 使用“item.IsSelected = true;”似乎不能 100% 工作 做。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-02-26T21:18:57.483

在 XAML 中，在 XAML 中添加 PreviewMouseRightButtonDown 处理程序：

```
 <TreeView.ItemContainerStyle>
        <Style TargetType="{x:Type TreeViewItem}">
            <!-- We have to select the item which is right-clicked on -->
            <EventSetter Event="TreeViewItem.PreviewMouseRightButtonDown" Handler="TreeViewItem_PreviewMouseRightButtonDown"/>
        </Style>
    </TreeView.ItemContainerStyle> 
```

然后像这样处理事件：

```
 private void TreeViewItem_PreviewMouseRightButtonDown( object sender, MouseEventArgs e )
    {
        TreeViewItem item = sender as TreeViewItem;
        if ( item != null )
        {
            item.Focus( );
            e.Handled = true;
        }
    } 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2012-09-12T19:42:06.273

使用来自 alex2k8 的原始想法，正确处理来自 Wieser Software Ltd 的非视觉对象、来自 Stefan 的 XAML、来自 Erlend 的 IsSelected，以及我对真正使静态方法通用的贡献：

XAML：

```
<TreeView.ItemContainerStyle> 
    <Style TargetType="{x:Type TreeViewItem}"> 
        <!-- We have to select the item which is right-clicked on --> 
        <EventSetter Event="TreeViewItem.PreviewMouseRightButtonDown"
                     Handler="TreeViewItem_PreviewMouseRightButtonDown"/> 
    </Style> 
</TreeView.ItemContainerStyle> 
```

后面的 C# 代码：

```
void TreeViewItem_PreviewMouseRightButtonDown(object sender, MouseButtonEventArgs e)
{
    TreeViewItem treeViewItem = 
              VisualUpwardSearch<TreeViewItem>(e.OriginalSource as DependencyObject);

    if(treeViewItem != null)
    {
        treeViewItem.IsSelected = true;
        e.Handled = true;
    }
}

static T VisualUpwardSearch<T>(DependencyObject source) where T : DependencyObject
{
    DependencyObject returnVal = source;

    while(returnVal != null && !(returnVal is T))
    {
        DependencyObject tempReturnVal = null;
        if(returnVal is Visual || returnVal is Visual3D)
        {
            tempReturnVal = VisualTreeHelper.GetParent(returnVal);
        }
        if(tempReturnVal == null)
        {
            returnVal = LogicalTreeHelper.GetParent(returnVal);
        }
        else returnVal = tempReturnVal;
    }

    return returnVal as T;
} 
```

编辑：以前的代码在这种情况下总是可以正常工作，但在另一种情况下，当 LogicalTreeHelper 返回值时 VisualTreeHelper.GetParent 返回 null，因此修复了该问题。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2011-04-08T17:17:20.193

[几乎正确](https://stackoverflow.com/questions/592373/select-treeview-node-on-right-click-before-displaying-contextmenu/594662#594662)，但您需要注意树中的非视觉对象（例如 a `Run`）。

```
static DependencyObject VisualUpwardSearch<T>(DependencyObject source) 
{
    while (source != null && source.GetType() != typeof(T))
    {
        if (source is Visual || source is Visual3D)
        {
            source = VisualTreeHelper.GetParent(source);
        }
        else
        {
            source = LogicalTreeHelper.GetParent(source);
        }
    }
    return source; 
} 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2011-10-07T09:22:53.927

我认为注册一个类处理程序应该可以解决问题。只需在 app.xaml.cs 代码文件中的 TreeViewItem 的 PreviewMouseRightButtonDownEvent 上注册一个路由事件处理程序，如下所示：

```
/// <summary>
/// Interaction logic for App.xaml
/// </summary>
public partial class App : Application
{
    protected override void OnStartup(StartupEventArgs e)
    {
        EventManager.RegisterClassHandler(typeof(TreeViewItem), TreeViewItem.PreviewMouseRightButtonDownEvent, new RoutedEventHandler(TreeViewItem_PreviewMouseRightButtonDownEvent));

        base.OnStartup(e);
    }

    private void TreeViewItem_PreviewMouseRightButtonDownEvent(object sender, RoutedEventArgs e)
    {
        (sender as TreeViewItem).IsSelected = true;
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-03-22T09:14:31.773

使用 MVVM 解决它的另一种方法是右键单击视图模型的绑定命令。在那里您可以指定其他逻辑以及`source.IsSelected = true`. 这仅使用`xmlns:i="http://schemas.microsoft.com/expression/2010/intera‌​ctivity"`from `System.Windows.Interactivity`。

用于查看的 XAML：

```
<TreeView ItemsSource="{Binding Items}">
  <TreeView.ItemContainerStyle>
    <Style TargetType="TreeViewItem">
      <Setter Property="IsSelected" Value="{Binding IsSelected, Mode=TwoWay}"/>
    </Style>
  </TreeView.ItemContainerStyle>
  <TreeView.ItemTemplate>
    <HierarchicalDataTemplate ItemsSource="{Binding Children}">
      <TextBlock Text="{Binding Name}">
        <i:Interaction.Triggers>
          <i:EventTrigger EventName="PreviewMouseRightButtonDown">
            <i:InvokeCommandAction Command="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type Window}}, Path=DataContext.TreeViewItemRigthClickCommand}" CommandParameter="{Binding}" />
          </i:EventTrigger>
        </i:Interaction.Triggers>
      </TextBlock>
    </HierarchicalDataTemplate>
  </TreeView.ItemTemplate>
</TreeView> 
```

查看型号：

```
 public ICommand TreeViewItemRigthClickCommand
    {
        get
        {
            if (_treeViewItemRigthClickCommand == null)
            {
                _treeViewItemRigthClickCommand = new RelayCommand<object>(TreeViewItemRigthClick);
            }
            return _treeViewItemRigthClickCommand;
        }
    }
    private RelayCommand<object> _treeViewItemRigthClickCommand;

    private void TreeViewItemRigthClick(object sourceItem)
    {
        if (sourceItem is Item)
        {
            (sourceItem as Item).IsSelected = true;
        }
    } 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-09-27T14:03:59.257

我在使用 HierarchicalDataTemplate 方法选择子项时遇到问题。如果我选择了一个节点的子节点，它会以某种方式选择该子节点的根父节点。我发现 MouseRightButtonDown 事件会在孩子所在的每个级别都被调用。例如，如果你有一棵这样的树：

项目 1
   - 子项 1 - 子项 2       -子项 1       -子项
   2

如果我选择了 Subitem2，该事件将触发 3 次，并且将选择项目 1。我用布尔值和异步调用解决了这个问题。

```
private bool isFirstTime = false;
    protected void TaskTreeView_MouseRightButtonDown(object sender, MouseButtonEventArgs e)
    {
        var item = sender as TreeViewItem;
        if (item != null && isFirstTime == false)
        {
            item.Focus();
            isFirstTime = true;
            ResetRightClickAsync();
        }
    }

    private async void ResetRightClickAsync()
    {
        isFirstTime = await SetFirstTimeToFalse();
    }

    private async Task<bool> SetFirstTimeToFalse()
    {
        return await Task.Factory.StartNew(() => { Thread.Sleep(3000); return false; });
    } 
```

感觉有点笨拙，但基本上我在第一次通过时将布尔值设置为 true，并在几秒钟内将其重置在另一个线程上（在本例中为 3）。这意味着它将跳过它试图向上移动的下一个路径，从而使您选择正确的节点。到目前为止它似乎有效:-)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-04-27T14:26:21.140

您可以使用鼠标按下事件来选择它。这将在上下文菜单启动之前触发选择。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-11-07T14:57:21.210

如果您想留在 MVVM 模式中，您可以执行以下操作：

看法：

```
<TreeView x:Name="trvName" ItemsSource="{Binding RootElementListView}" Tag="{Binding ClickedTreeElement, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
    <TreeView.ItemTemplate>
        <HierarchicalDataTemplate DataType="{x:Type models:YourTreeElementClass}" ItemsSource="{Binding Path=Subreports}">
            <TextBlock Text="{Binding YourTreeElementDisplayProperty}" PreviewMouseRightButtonDown="TreeView_PreviewMouseRightButtonDown"/>
        </HierarchicalDataTemplate>
    </TreeView.ItemTemplate>
</TreeView> 
```

代码背后：

```
private void TreeView_PreviewMouseRightButtonDown(object sender, MouseButtonEventArgs e)
{
    if (sender is TextBlock tb && tb.DataContext is YourTreeElementClass te)
    {
        trvName.Tag = te;
    }
} 
```

视图模型：

```
private YourTreeElementClass _clickedTreeElement;

public YourTreeElementClass ClickedTreeElement
{
    get => _clickedTreeElement;
    set => SetProperty(ref _clickedTreeElement, value);
} 
```

现在，您可以对 ClickedTreeElement 属性更改做出反应，也可以使用在内部与 ClickedTreeElement 配合使用的命令。

扩展视图：

```
<UserControl ...
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity">
    <TreeView x:Name="trvName" ItemsSource="{Binding RootElementListView}" Tag="{Binding ClickedTreeElement, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
        <i:Interaction.Triggers>
            <i:EventTrigger EventName="MouseRightButtonUp">
                <i:InvokeCommandAction Command="{Binding HandleRightClickCommand}"/>
            </i:EventTrigger>
        </i:Interaction.Triggers>
        <TreeView.ItemTemplate>
            <HierarchicalDataTemplate DataType="{x:Type models:YourTreeElementClass}" ItemsSource="{Binding Path=Subreports}">
                <TextBlock Text="{Binding YourTreeElementDisplayProperty}" PreviewMouseRightButtonDown="TreeView_PreviewMouseRightButtonDown"/>
            </HierarchicalDataTemplate>
        </TreeView.ItemTemplate>
    </TreeView>
</UserControl> 
```

# jquery - jQuery ajax 表单和 Zend_Form 文件上传

> ID：592377
> 
> 赞同：-2
> 
> 时间：2009-02-26T20:49:53.967
> 
> 标签：jquery, file, zend-framework, upload

如果我从 jQuery 提交我的 ajax 表单，然后执行

```
print_r($_FILES); 
```

我得到一个上传的文件列表，但如果我做这样的事情

```
$add_form->sound_file->isUploaded(); 
```

或者

```
$params = $this->_getAllParams();
print_r($params); 
```

我没有在 zend 参数中获取我的文件，也没有上传它！？

也许问题出在他的上下文 beng ajax 上？！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-03T12:53:20.557

在检查文件之前，您似乎没有验证表单。尝试发布整个代码或致电

```
$add_form->isValid($_POST); 
```

在检查文件之前。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T04:03:15.520

上传的文件位于 $_FILES[]，而不是 $_POST[]

# jquery - 与 jQuery 中的 eval() 等价但更惯用的东西是什么？

> ID：592392
> 
> 赞同：3
> 
> 时间：2009-02-26T20:52:21.277
> 
> 标签：jquery

`eval('('+responseText+')')`在 jQuery中进行此调用的等价物是什么？我也明白这`eval`不是那么安全，所以我在 jQuery 中寻找更安全、更惯用的东西。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T21:00:10.650

您实际上是在寻找执行 Javascript 代码（这在某种程度上总是不安全的），还是在尝试将[JSON](http://json.org)从字符串解析为对象？

如果是前者， eval() 仍然是你最好的选择。

如果是后者，jQuery 将作为 AJAX 请求的一部分[为您完成，或者您可以使用专用的](http://docs.jquery.com/Ajax/jQuery.getJSON)[JSON 插件](http://code.google.com/p/jquery-json/)在字符串和对象之间进行转换，而无需执行任意代码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-12-29T09:30:31.907

a) 加载和执行 JS 代码：

```
$.getScript( url, [ success(data, textStatus) ] ) 
```

见[http://api.jquery.com/jQuery.getScript/](http://api.jquery.com/jQuery.getScript/)

b) 解析 JSON：

```
$.parseJSON( json ) 
```

见[http://api.jquery.com/jQuery.parseJSON/](http://api.jquery.com/jQuery.parseJSON/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-02-24T00:32:44.800

我不认为没有浏览器差异是真的。我今天刚碰到一个。如果你对一个调用不存在对象的方法的字符串求值，Firefox 会返回 undefined 并且 IE6 会抛出 TypeError。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T20:55:06.293

按照设计，jQuery 旨在改进浏览器的实现。由于不同浏览器的实现方式`eval`没有问题，jQuery 没有解决它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-05T07:33:32.297

`$.globalEval()`?

[http://api.jquery.com/jQuery.globalEval/](http://api.jquery.com/jQuery.globalEval/)

文档说它的行为与 完全不同`eval()`，但如果你想通过 jQuery传递你的*评估，它是最接近的匹配。*

# javascript - javascript中自执行函数的目的是什么？

> ID：592396
> 
> 赞同：491
> 
> 时间：2009-02-26T20:53:52.317
> 
> 标签：javascript, closures, iife, self-executing-function

在 javascript 中，你什么时候想使用这个：

```
(function(){
    //Bunch of code...
})(); 
```

对此：

```
//Bunch of code... 
```

* * *

## 回答 #1

> 赞同：461
> 
> 时间：2009-02-26T20:57:17.333

这都是关于变量范围的。默认情况下，自执行函数中声明的变量仅可用于自执行函数中的代码。这允许编写代码而不用关心变量在其他 JavaScript 代码块中是如何命名的。

例如，正如[Alexander](https://stackoverflow.com/users/10608/alexander-bird)在评论中提到的：

```
(function() {
  var foo = 3;
  console.log(foo);
})();

console.log(foo);
```

这将首先记录，然后在下一个因为未定义`3`而引发错误。`console.log``foo`

* * *

## 回答 #2

> 赞同：117
> 
> 时间：2015-05-09T08:13:30.930

简单化。看起来很正常，几乎令人欣慰：

```
var userName = "Sean";

console.log(name());

function name() {
  return userName;
} 
```

但是，如果我在我的页面中包含一个非常方便的 javascript 库，它将高级字符转换为它们的基本级别表示怎么办？

等等……什么？

我的意思是，如果有人输入带有某种重音的字符，但我的程序中只需要“英文”字符 AZ？嗯...西班牙文'ñ' 和法文'é' 字符可以翻译成'n' 和'e' 的基本字符。

因此，某个好人编写了一个全面的字符转换器，我可以将其包含在我的站点中……我将其包含在内。

一个问题：它有一个函数，叫做“名称”，与我的函数相同。

这就是所谓的碰撞。我们在同一个*作用域中*声明了两个同名的函数。我们想避免这种情况。

所以我们需要以某种方式定义我们的代码范围。

在 javascript 中限定代码范围的唯一方法是将其包装在一个函数中：

```
function main() {
  // We are now in our own sound-proofed room and the 
  // character-converter library's name() function can exist at the 
  // same time as ours. 

  var userName = "Sean";

  console.log(name());

  function name() {
    return userName;
  }
} 
```

这可能会解决我们的问题。现在所有内容都已包含在内，只能从我们的开括号和闭括号内访问。

我们在函数中有一个函数……看起来很奇怪，但完全合法。

只有一个问题。我们的代码不起作用。我们的`userName`变量永远不会回显到控制台！

我们可以通过在我们现有的代码块之后添加对我们函数的调用来解决这个问题......

```
function main() {
  // We are now in our own sound-proofed room and the 
  // character-converter libarary's name() function can exist at the 
  // same time as ours. 

  var userName = "Sean";

  console.log(name());

  function name() {
    return userName;
  }
}

main(); 
```

还是以前！

```
main();

function main() {
  // We are now in our own sound-proofed room and the 
  // character-converter libarary's name() function can exist at the 
  // same time as ours. 

  var userName = "Sean";

  console.log(name());

  function name() {
    return userName;
  }
} 
```

第二个问题：尚未使用名称“main”的可能性有多大？……非常非常苗条。

我们需要更多的范围界定。还有一些方法可以自动执行我们的 main() 函数。

现在我们来谈谈自动执行功能（或自执行、自运行等）。

```
((){})(); 
```

语法很笨拙。但是，它有效。

当您将函数定义包装在括号中并包含参数列表（另一个集合或括号！）时，它充当函数*调用*。

所以让我们再看看我们的代码，使用一些自执行的语法：

```
(function main() {
  var userName = "Sean";

    console.log(name());

    function name() {
      return userName;
    }
  }
)(); 
```

因此，在您阅读的大多数教程中，您现在会被“匿名自动执行”或类似的术语轰炸。

经过多年的专业发展，我*强烈*建议您命名为调试目的*编写的每个函数。*

当出现问题时（并且会出现问题），您将在浏览器中检查回溯。当堆栈跟踪中的条目具有名称时，*总是*更容易缩小代码问题的范围！

非常啰嗦，我希望它有帮助！

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2010-05-19T15:39:56.703

> 自调用（也称为自动调用）是指函数在其定义后立即执行。这是一个核心模式，是许多其他 JavaScript 开发模式的基础。

我是它的忠实粉丝:)，因为：

*   它将代码保持在最低限度
*   它强制将行为与表示分离
*   它提供了一个防止命名冲突的闭包

非常大——（为什么要说它好？）

*   它是关于一次定义和执行一个函数。
*   您可以让该自执行函数返回一个值并将该函数作为参数传递给另一个函数。
*   它有利于封装。
*   它也适用于块范围。
*   是的，您可以将所有 .js 文件包含在一个自执行函数中，并且可以防止全局命名空间污染。;)

更多[在这里](http://mahtonu.wordpress.com/2010/05/19/self-executing-functions-in-javascript/)。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-02-26T20:56:26.447

命名空间。JavaScript 的作用域是函数级的。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2012-04-13T05:42:48.253

我不敢相信没有一个答案提到隐含的全局变量。

该`(function(){})()`构造不能防止隐含的全局变量，这对我来说是更大的问题，请参阅[http://yuiblog.com/blog/2006/06/01/global-domination/](http://yuiblog.com/blog/2006/06/01/global-domination/)

基本上，功能块确保您定义的所有相关“全局变量”都限制在您的程序中，它不会保护您免受定义隐式全局变量的影响。[JSHint](http://www.jshint.com)等可以提供有关如何防御这种行为的建议。

更简洁的`var App = {}`语法提供了类似的保护级别，并且在“公共”页面上时可以包装在功能块中。（请参阅[Ember.js](http://emberjs.com)或[SproutCore](http://sproutcore.com)了解使用此构造的库的真实示例）

就`private`属性而言，除非您正在创建公共框架或库，否则它们有点被高估了，但如果您需要实现它们，[Douglas Crockford](http://www.crockford.com/javascript/private.html)有一些好主意。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2017-12-05T12:26:08.773

我已经阅读了所有答案，**这里缺少一些非常重要的东西**，我会亲吻。有两个主要原因，为什么我需要自执行匿名函数，或者更好地说“**立即调用函数表达式 (IIFE)** ”：

1.  更好的命名空间管理（避免命名空间污染 -> JS 模块）
2.  闭包（模拟私有类成员，从 OOP 中得知）

第一个已经解释得很好。对于第二个，请研究以下示例：

```
var MyClosureObject = (function (){
  var MyName = 'Michael Jackson RIP';
  return {
    getMyName: function () { return MyName;},
    setMyName: function (name) { MyName = name}
  }
}()); 
```

**注意 1：**我们不是为 分配一个函数`MyClosureObject`，而是**调用该函数的结果**。请注意`()`最后一行。

**注意2：**关于Javascript中的函数，您还需要了解的是，内部函数可以**访问函数的参数和变量**，它们是在内部定义的。

让我们尝试一些实验：

我可以`MyName`使用`getMyName`它并且它有效：

```
 console.log(MyClosureObject.getMyName()); 
 // Michael Jackson RIP 
```

以下巧妙的方法行不通：

```
console.log(MyClosureObject.MyName); 
// undefined 
```

但我可以设置另一个名称并获得预期的结果：

```
MyClosureObject.setMyName('George Michael RIP');
console.log(MyClosureObject.getMyName()); 
// George Michael RIP 
```

**编辑：**在上面的示例中，`MyClosureObject`设计为不带`new`前缀使用，因此按照惯例，它不应大写。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-02-26T20:57:57.987

范围隔离，也许。这样函数声明中的变量就不会污染外部命名空间。

当然，在一半的 JS 实现中，他们无论如何都会这样做。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-02-26T21:03:54.510

是否有参数并且“一堆代码”返回一个函数？

```
var a = function(x) { return function() { document.write(x); } }(something); 
```

关闭。的值`something`被分配给 的函数使用`a`。`something`可能有一些不同的值（for循环），并且每次 a 都有一个新功能。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2015-11-19T20:55:52.013

这是一个自调用匿名函数如何有用的可靠示例。

```
for( var i = 0; i < 10; i++ ) {
  setTimeout(function(){
    console.log(i)
  })
} 
```

输出：`10, 10, 10, 10, 10...`

```
for( var i = 0; i < 10; i++ ) {
  (function(num){
    setTimeout(function(){
      console.log(num)
    })
  })(i)
} 
```

输出：`0, 1, 2, 3, 4...`

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-26T20:58:04.897

一个区别是您在函数中声明的变量是本地的，因此当您退出函数时它们会消失，并且它们不会与其他或相同代码中的其他变量冲突。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2018-04-24T10:14:21.773

自执行函数用于管理变量的范围。

变量的范围是定义它的程序区域。

全局变量具有全局范围；它在您的 JavaScript 代码中随处定义，并且可以从脚本中的任何位置访问，甚至在您的函数中。另一方面，在函数中声明的变量仅在函数体内定义。它们是局部变量，具有局部作用域并且只能在该函数内访问。函数参数也算作局部变量，并且仅在函数体中定义。

如下所示，您可以访问函数内部的全局变量变量，还请注意，在函数体中，局部变量优先于同名的全局变量。

```
var globalvar = "globalvar"; // this var can be accessed anywhere within the script

function scope() {
    alert(globalvar);
    var localvar = "localvar"; //can only be accessed within the function scope
}

scope(); 
```

所以基本上一个自执行函数允许编写代码而不用关心变量在其他javascript代码块中是如何命名的。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2019-12-20T03:43:16.780

简短的回答是： **防止对全球（或更高）范围的污染。**

IIFE（立即调用函数表达式）是将**脚本编写为插件、附加组件、用户脚本或任何期望与其他人的脚本一起使用的脚本**的最佳实践。这可确保您定义的任何变量都不会对其他脚本产生不良影响。

这是编写 IIFE 表达式的另一种方式。我个人更喜欢以下这种方法：

```
void function() {
  console.log('boo!');
  // expected output: "boo!"
}(); 
```

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/void](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/void)

从上面的例子中很明显，IIFE 也会影响效率和性能，因为预期只运行一次的函数**将被执行一次，然后永远转储到 void 中**。这意味着函数或方法声明不会保留在内存中。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2020-03-11T12:51:59.343

首先你必须访问[MDN IIFE](https://developer.mozilla.org/en-US/docs/Glossary/IIFE)，现在关于这个的一些要点

*   这是**立即调用的函数表达式**。因此，当您的 javascript 文件从 HTML 调用时，此函数会立即调用。
*   这可以防止访问 IIFE 惯用语中的变量以及污染全局范围。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-26T20:57:34.570

由于 Javascript 中的函数是一等对象，通过以这种方式定义它，它有效地定义了一个类似于 C++ 或 C# 的“类”。

该函数可以定义局部变量，并在其中包含函数。内部函数（实际上是实例方法）将可以访问局部变量（实际上是实例变量），但它们将与脚本的其余部分隔离。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-10-20T13:02:41.513

**javascript中的自调用函数：**

自调用表达式被自动调用（启动），而不被调用。自调用表达式在创建后立即被调用。这主要用于避免命名冲突以及实现封装。在此函数之外无法访问变量或声明的对象。为了避免最小化（filename.min）的问题，请始终使用自执行函数。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2017-03-31T10:14:51.887

```
(function(){
    var foo = {
        name: 'bob'
    };
    console.log(foo.name); // bob
})();
console.log(foo.name); // Reference error 
```

实际上，上述函数将被视为没有名称的函数表达式。

用右括号和左括号包装函数的主要目的是避免污染全局空间。

函数表达式内的变量和函数变为私有（即）它们在函数外不可用。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2020-04-06T01:50:09.033

鉴于您的简单问题：“在 javascript 中，您什么时候想使用这个：...”

我喜欢@ken_browning 和@sean_holding 的答案，但这是我没有看到的另一个用例：

```
let red_tree = new Node(10);

(async function () {
    for (let i = 0; i < 1000; i++) {
        await red_tree.insert(i);
    }
})();

console.log('----->red_tree.printInOrder():', red_tree.printInOrder()); 
```

其中 Node.insert 是一些异步操作。

在我的函数声明中，我不能在没有 async 关键字的情况下调用 await，并且我不需要命名函数供以后使用，但需要等待该插入调用，或者我需要一些其他更丰富的功能（谁知道？） .

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-12-18T03:26:53.843

看起来这个问题已经准备好了，但我还是会发布我的意见。

我知道我什么时候喜欢使用自执行函数。

```
var myObject = {
    childObject: new function(){
        // bunch of code
    },
    objVar1: <value>,
    objVar2: <value>
} 
```

该函数允许我使用一些额外的代码来定义 childObjects 的属性和属性以获得更简洁的代码，例如设置常用变量或执行数学方程；哦！或错误检查。而不是局限于...的嵌套对象实例化语法

```
object: {
    childObject: {
        childObject: {<value>, <value>, <value>}
    }, 
    objVar1: <value>,
    objVar2: <value>
} 
```

一般来说，编码有很多晦涩难懂的方式来做很多相同的事情，这让你想知道，“为什么要麻烦？” 但是，新情况不断出现，您不能再仅依赖基本/核心原则。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2021-07-28T14:10:17.547

**您可以使用此函数返回值：**

```
var Test = (function (){

        const alternative = function(){ return 'Error Get Function '},
        methods = {
            GetName: alternative,
            GetAge:alternative
            }

// If the condition is not met, the default text will be returned
// replace to  55 < 44
if( 55 > 44){

// Function one
methods.GetName = function (name) {

        return name;

};

// Function Two

methods.GetAge = function (age) {

        return age;

};

}

    return methods;

    }());

    // Call
   console.log( Test.GetName("Yehia") );

    console.log( Test.GetAge(66) );
```

* * *

## 回答 #20

> 赞同：-4
> 
> 时间：2009-02-26T20:57:09.267

IIRC 它允许您创建私有属性和方法。

# java - 使用 Kerberos 身份验证从 Java 应用程序访问 SharePoint 网站

> ID：592403
> 
> 赞同：5
> 
> 时间：2009-02-26T20:55:31.113
> 
> 标签：java, authentication, sharepoint, kerberos

我正在尝试从 Java 应用程序访问[SharePoint网站。](http://en.wikipedia.org/wiki/Microsoft_SharePoint)SharePoint 服务器首选 Kerberos 身份验证。您能否提供一个仅实现 Kerberos 身份验证的示例？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-27T03:22:27.360

So just to help you broaden your search for answers a bit, there's nothing SharePoint-specific about the Kerberos authentication used here. In fact SharePoint doesn't really have it's own authentication mechanisms (at least assuming we're talking about WSS 3/MOSS here). It just relies on the underlying ASP.NET/IIS authentication capabilities.

Sooo, if you're running your Java ausing a modern JDK, you'll probably have an easy time. See the [docs on HTTP authentication mechanisms](http://java.sun.com/javase/6/docs/technotes/guides/net/http-auth.html). There's some nice code snippets in there. One of which I'll reproduce for reference here. Really though, check out the link.

```
import java.io.BufferedReader;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.net.Authenticator;
import java.net.PasswordAuthentication;
import java.net.URL;

public class RunHttpSpnego {

    static final String kuser = "username"; // your account name
    static final String kpass = "password"; // your password for the account

    static class MyAuthenticator extends Authenticator {
        public PasswordAuthentication getPasswordAuthentication() {
            // I haven't checked getRequestingScheme() here, since for NTLM
            // and Negotiate, the usrname and password are all the same.
            System.err.println("Feeding username and password for " + getRequestingScheme());
            return (new PasswordAuthentication(kuser, kpass.toCharArray()));
        }
    }

    public static void main(String[] args) throws Exception {
        Authenticator.setDefault(new MyAuthenticator());
        URL url = new URL(args[0]);
        InputStream ins = url.openConnection().getInputStream();
        BufferedReader reader = new BufferedReader(new InputStreamReader(ins));
        String str;
        while((str = reader.readLine()) != null)
            System.out.println(str);
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-11-16T18:38:07.267

这是开源[SPNEGO](http://en.wikipedia.org/wiki/SPNEGO) [HTTP Servlet 过滤器库](http://spnego.sourceforge.net/)[的 Java 文档中的一个示例](http://spnego.sourceforge.net/api/net/sourceforge/spnego/SpnegoHttpURLConnection.html)。

该库有一个客户端，可以连接到启用了集成 Windows 身份验证的 Web 服务器。

该项目还包含有关如何为 Kerberos/SPNEGO 身份验证设置环境的示例。

```
 public static void main(final String[] args) throws Exception {
     System.setProperty("java.security.krb5.conf", "krb5.conf");
     System.setProperty("sun.security.krb5.debug", "true");
     System.setProperty("java.security.auth.login.config", "login.conf");

     SpnegoHttpURLConnection spnego = null;

     try {
         spnego = new SpnegoHttpURLConnection("spnego-client", "dfelix", "myp@s5");
         spnego.connect(new URL("http://medusa:8080/index.jsp"));

         System.out.println(spnego.getResponseCode());

     } finally {
         if (null != spnego) {
             spnego.disconnect();
         }
     }
 } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T21:59:27.807

对于 Kerberos 设置，我认识 3 个人，他们之间了解有关 Kerb 的所有信息：Spence Harbar、Bob Fox 和 Tom Wisnowski。

Spence 还在酝酿使用 Kerberos 向导来设置 Curb 和导出设置脚本。

在这里查看他的博客： [http ://www.harbar.net/](http://www.harbar.net/)

Tom Wiznowski 已经发出了一份白皮书。 [http://my/sites/tomwis/Shared%20Documents/Configuring%20Kerberos%20for%20SharePoint.docx](http://my/sites/tomwis/Shared%20Documents/Configuring%20Kerberos%20for%20SharePoint.docx)

乔尔奥尔森在这里得到了一篇好文章： [http ://www.sharepointjoel.com/Lists/Posts/Post.aspx?ID=2](http://www.sharepointjoel.com/Lists/Posts/Post.aspx?ID=2)

但是当上面说的时候，SharePoint 只在公司已经使用它的时候推荐 Curb。您不应仅仅因为 SharePoint 而在公司网络上安装 Kerberos。Kerberos 的设置很复杂，尽管它通常被认为比 NTLM 更快，但只有当您的站点上的同时用户数达到一定限制时才会如此。对于低流量站点，Kerberos 通过网络发送的大量令牌实际上使其比 NTLM 慢。

当然有些功能只能与 Kerberos 一起使用（rss 提要、excel 服务中的多维数据集、由于双跳而在自定义代码中对 Web 服务调用的身份验证）但是当我说 NTLM 会很好地运行你的苔藓也。

说到上面的内容，您能否指定您尝试从您的 Java 应用程序中实现什么样的集成？

您只是想调用 SharePoint 的 Web 服务层吗？

安德斯拉斯克

# python - PyQt4：数据绑定？

> ID：592404
> 
> 赞同：3
> 
> 时间：2009-02-26T20:55:38.257
> 
> 标签：python, data-binding, qt4, pyqt4

从 .NET 世界转向 Python 和 PyQt4。想知道是否有人熟悉任何可以让我将数据绑定到 Qt 小部件的功能？例如（使用 sqlalchemy 处理数据）：

```
gems = session.query(Gem).all()
list = QListWidget()
list.datasource = gems 
```

这样的事情可能吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T22:40:32.483

虽然不是直接替换，但您可能会发现查看 QDataWidgetMapper 类很有用：

[http://pyqt.sourceforge.net/Docs/PyQt4/qdatawidgetmapper.html](http://pyqt.sourceforge.net/Docs/PyQt4/qdatawidgetmapper.html)

如果您不害怕阅读 C++ 代码，那么这个示例也可能会有所帮助：

[https://doc.qt.io/qt-4.8/qt-sql-sqlwidgetmapper-example.html](https://doc.qt.io/qt-4.8/qt-sql-sqlwidgetmapper-example.html)

请注意，映射器在 Qt 的模型/视图框架内运行。在这个例子中，模型恰好是一个 SQL 数据库模型。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T21:03:53.247

一种选择是有一个从查询返回列表（或元组）对象的函数，然后使用它来更新 QListWidget。请记住，QListWidget 存储 QListStrings。您的更新函数可能如下所示：

```
def updateQListWidget(qlistwidget, values):
        """ Updates a QListWidget object with a list of values
        ARGS:
            qlistwidget  - QListWidget object
            values       - list of values to add to list widget
        """
        qlistwidget.clear()
        qlist = QtCore.QStringList()
        for v in values:
            s = QtCore.QString(v)
            qlist.append(s)
        qlistwidget.addItems(qlist) 
```

# javascript - Javascript：错误“需要对象”。我无法破译。你可以吗？

> ID：592420
> 
> 赞同：2
> 
> 时间：2009-02-26T20:59:27.373
> 
> 标签：javascript, debugging, flir

我在我的一个网站中使用了一个名为“Facelift 1.2”的 javascript，虽然该脚本在 Safari 3、4b 和 Opera、OmniWeb 和 Firefox 中有效，但它不适用于任何 IE 版本。但即使在工作浏览器中，我也会收到以下错误，我无法破译。

也许在适当的时候——在 Javascript 方面有更多经验——我将能够做到，但现在我想我会问你们中的一些人，在 SO。

以下是我在 IETester 测试 Internet Explorer 6,7 和 8 页面时出现的错误弹出窗口： [![IE 错误弹出](https://i.stack.imgur.com/GVlu8.png)](https://i.stack.imgur.com/GVlu8.png)

以下来自 Firefox 3.0.6 中的 Firebug 控制台： [![Firebug 控制台日志](https://i.stack.imgur.com/Qof6U.png)](https://i.stack.imgur.com/Qof6U.png)

该网站是：[http](http://www.457cc.co.nz/index.php) ://www.457cc.co.nz/index.php如果它可以帮助您看到实际提到的问题。

我还查找了第 620 行对应的是： *“第 76 行”是：*

```
this.isCraptastic = (typeof document.body.style.maxHeight=='undefined'); 
```

这是这段代码的一部分（取自 flir.js）：

```
// either (options Object, fstyle FLIRStyle Object) or (fstyle FLIRStyle Object)
,init: function(options, fstyle) { // or options for flir style
    if(this.isFStyle(options)) { // (fstyle FLIRStyle Object)
        this.defaultStyle = options;
    }else { // [options Object, fstyle FLIRStyle Object]
        if(typeof options != 'undefined')
            this.loadOptions(options);

        if(typeof fstyle == 'undefined') {
            this.defaultStyle = new FLIRStyle();
        }else {
            if(this.isFStyle(fstyle))
                this.defaultStyle = fstyle;
            else
                this.defaultStyle = new FLIRStyle(fstyle);
        }
    }

    this.calcDPI();

    if(this.options.findEmbededFonts)
        this.discoverEmbededFonts();

    this.isIE = (navigator.userAgent.toLowerCase().indexOf('msie')>-1 && navigator.userAgent.toLowerCase().indexOf('opera')<0);
    this.isCraptastic = (typeof document.body.style.maxHeight=='undefined');

    if(this.isIE) {
        this.flirIERepObj = [];
        this.flirIEHovEls = [];
        this.flirIEHovStyles = [];    
    }
} 
```

整个脚本也可以在我的服务器上找到：[http ://www.457cc.co.nz/facelift-1.2/flir.js](http://www.457cc.co.nz/facelift-1.2/flir.js)

我只是不知道从哪里开始寻找错误，特别是因为它只影响 IE 但在其余部分有效。也许你们有一个想法。我很想听听他们的意见。

谢谢阅读。詹尼斯

PS：这是 Opera 的错误控制台报告的内容：

```
JavaScript - http://www.457cc.co.nz/index.php
Inline script thread
Error:
name: TypeError
message: Statement on line 620: Cannot convert undefined or null to Object
Backtrace:
  Line 620 of linked script http://www.457cc.co.nz/facelift-1.2/flir.js
                    document.body.appendChild(test);
  Line 70 of linked script http://www.457cc.co.nz/facelift-1.2/flir.js
            this.calcDPI();
  Line 2 of inline#1 script in http://www.457cc.co.nz/index.php
            FLIR.init();
stacktrace: n/a; see 'opera:config#UserPrefs|Exceptions Have Stacktrace' 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-26T21:20:45.233

我同意 tvanfosson - 您收到该错误的原因很可能是因为您在`init()`页面加载完成之前调用，因此`document.body`尚未定义。

在您链接的页面中，您应该将以下代码移动到页面底部（就在结束 html 标记之前：

```
<script type="text/javascript">
    FLIR.init({ path: 'http://www.457cc.co.nz/facelift-1.2/' });
    FLIR.auto();
</script> 
```

更好的是，您应该将初始化附加到文档的`ready`事件中。如果你这样做，甚至不需要将你的 javascript 移动到文件的底部。使用 jquery：

```
$(document).ready( function(){
    FLIR.init({ path: 'http://www.457cc.co.nz/facelift-1.2/' });
    FLIR.auto();
}); 
```

[更多关于 jquery 的 document.ready 事件 »](http://docs.jquery.com/Tutorials:Introducing_%24%28document%29.ready%28%29)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T21:11:05.613

**编辑**答案左侧的上下文。请参阅@Triptych 的（已接受）答案以获得正确的解决方案。

我的建议是将包含的 javascript 移到标记的末尾。我认为正在发生的事情是代码在 DOM 完全加载之前执行，因此当您尝试在确定 maxHeight 样式属性时引用它时 document.body 为空。将包含的 javascript 移到标记的末尾应该足以保证至少加载文档的主体并避免此特定错误。

```
 ... rest of html....

    <script type='text/javascript'
            src='http://www.457cc.co.nz/facelift/flir.js'>
    </script>
 </body>
 </html> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T22:06:40.663

安装 .net Framework v2 并解决问题。

# jquery - jWysiwyg 扩展

> ID：592433
> 
> 赞同：0
> 
> 时间：2009-02-26T21:01:06.963
> 
> 标签：jquery, wysiwyg

我试图找到一种方法来扩展 jWysiwyg。我需要一个函数来在编辑器中插入这段代码：

```
<a rel="shadowbox" href="images/photo_big.jpg" class="option" >
  <img src="images/photo_small.jpg" id="rightcontentImg" alt="photo" />
</a> 
```

所以不仅是图像，还有链接。我知道我可以使用这样的东西来插入图像：

```
$('#cont').wysiwyg('insertImage', 
      'http://www.google.com/images/nav_logo4.png', 
     { 'class' : 'myClass', 'className' : 'myClass' }); 
```

但它非常基本，我不需要更多，只是第一个解决方案，插入原始 html 也很好，甚至是首选。

有没有人有这方面的经验？！

很多！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-10T17:56:59.333

我刚刚做了这样的事情；

```
var cont = $('#cont');
cont.wysiwyg('setContent', cont.val() +
  '<a rel="shadowbox" href="images/photo_big.jpg" class="option" >
    <img src="images/photo_small.jpg" id="rightcontentImg" alt="photo" />
  </a>'
); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T21:07:24.220

我想你想要...

```
 $('#cont').Append($('<a rel="shadowbox" (etc) </a>')).wysiwyg(.... 
```

# ruby-on-rails - Rails: rake db:migrate *very* 在 Oracle 上很慢

> ID：592444
> 
> 赞同：4
> 
> 时间：2009-02-26T21:06:45.437
> 
> 标签：ruby-on-rails, ruby, oracle, rake, dbmigrate

我正在使用带有`oracleenhanced`适配器的 rails 为遗留应用程序创建新接口。

数据库迁移成功，但在 rake 完成之前需要非常长的时间。数据库更改发生得非常快（1 或 2 秒），但`db/schema.db`转储需要一个多小时才能完成。（请参阅下面的示例迁移。）

这是一个相对较大的模式（大约 150 个表），但我确信转储每个表描述不应该花这么长时间。

`schema.db`有没有办法通过只取最后一个并将迁移中指定的更改应用于它来加快速度？或者我可以完全跳过这个模式转储吗？

我知道这`schema.db`用于每次从头开始创建测试数据库，但是在这种情况下，表触发器中有很大一部分数据库逻辑`schema.rb`无论如何都不包含在其中，因此 rake 测试对我们没有任何好处案子。（这是一个完全不同的问题，我需要在其他时候解决。）

```
dgs@dgs-laptop:~/rails/voyager$ time rake db:migrate
（在 /home/dgs/rails/voyager 中）
== 20090227012452 AddModuleActionAndControllerNames：迁移 ================
-- add_column(:modules, :action_name, :text)
   -> 0.9619s
   -> 0 行
-- add_column(:modules, :controller_name, :text)
   -> 0.1680 秒
   -> 0 行
== 20090227012452 AddModuleActionAndControllerNames：迁移（1.1304s）=======

真正的 87m12.961s
用户 0m12.949s
系统 0m2.128s

```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T21:08:55.627

将所有迁移应用到数据库后，rake db:migrate 调用 db:schema:dump 任务从当前数据库模式生成 schema.rb 文件。

db:schema:dump 调用适配器的“tables”方法获取所有表的列表，然后为每个表调用“indexes”方法和“columns”方法。您可以在 activerecord-oracle_enhanced-adapter gem 的 oracle_enhanced_adapter.rb 文件中找到这些方法中使用的 SQL SELECT 语句。基本上，它确实从 ALL% 或 USER% 数据字典表中选择以查找所有信息。

最初，当我将原始 Oracle 适配器与具有许多不同模式的数据库一起使用时，我遇到了问题（因为性能可能会受到数据库中表的总数的影响 - 而不仅仅是在您的模式中），因此我在 Oracle 增强版中做了一些优化适配器。最好找出在您的情况下哪些方法很慢（我怀疑它可能是为每个表执行的“索引”或“列”方法）。

调试此问题的一种方法是将一些调试消息放入 oracle_enhanced_adapter.rb 文件中，以便您可以确定哪些方法调用需要这么长时间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T00:52:08.030

经过一番深入研究后，问题基本解决了`oracle_enhanced_adapter.rb`。

问题归结为本地模式中的表太多（许多`EBA_%, EVT_%, EMP_%, SMP_%`表是在某个时候同时创建的），存档表包含在转储中，并且从数据字典中选择需要 14 秒才能执行。

为了提高速度，我做了三件事：

1.  删除了所有不需要的表（500 个中的大约 250 个）
2.  从模式转储中排除的存档表
3.  缓存了长时间运行的查询结果

这将剩余 350 个表的迁移/模式转储时间从大约 90 分钟缩短到大约 15 秒。足够快。

我的代码如下（为了获得灵感，不要复制和粘贴——这段代码对我的数据库来说是相当具体的，但你应该能够理解）。您需要手动创建临时表。我需要大约 2 或 3 分钟才能完成 - 每次迁移生成仍然太长，而且它还是相当静态的 =)

```
module ActiveRecord
  module ConnectionAdapters
    class OracleEnhancedAdapter
      def tables(name = nil)
        select_all("select lower(table_name) from all_tables where owner = sys_context('userenv','session_user')  and table_name not like 'A!_%' escape '!' ").inject([]) do | tabs, t |
          tabs << t.to_a.first.last
        end
      end

      # TODO think of some way to automatically create the rails_temp_index table 
      #
      #   Table created by: 
      #   create table rails_temp_index_table as 
      #   SELECT lower(i.index_name) as index_name, i.uniqueness, 
      #          lower(c.column_name) as column_name, i.table_name
      #    FROM all_indexes i, user_ind_columns c
      #    WHERE  c.index_name = i.index_name 
      #       AND i.owner = sys_context('userenv','session_user')
      #       AND NOT exists  (SELECT uc.index_name FROM user_constraints uc 
      #              WHERE uc.constraint_type = 'P' and uc.index_name = i.index_name);

        def indexes(table_name, name = nil) #:nodoc:

              result = select_all(<<-SQL, name)
                SELECT index_name, uniqueness, column_name
                  FROM rails_temp_index_table
                 WHERE table_name = '#{table_name.to_s.upcase}'
                  ORDER BY index_name
              SQL

              current_index = nil
              indexes = []

            result.each do |row|
                if current_index != row['index_name']
                  indexes << IndexDefinition.new(table_name, row['index_name'], row['uniqueness'] == "UNIQUE", [])
                  current_index = row['index_name']
                end

                indexes.last.columns << row['column_name']
              end

              indexes
            end
end 
```

# iphone - 在代码或数据库中传播删除？

> ID：592445
> 
> 赞同：2
> 
> 时间：2009-02-26T21:07:08.353
> 
> 标签：iphone, cocoa, database-design, sqlite, triggers

我正在开发一个具有一些数据关系的 iPhone 应用程序（例如，作者 -> 书籍）。当用户从应用程序中删除作者对象时，我有一些 SQLite 触发器在删除时运行，以从数据库中删除具有与作者主键匹配的外键的任何书籍。

我还使用触发器在创建新项目时插入一些数据。

我不禁感到这可能是糟糕的设计，或者会导致一些我没有想到的问题。也就是说，当数据库具有内置的处理能力时，我是否应该依靠我的应用程序中的代码来处理像这样传播删除？

你说什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T21:11:48.530

真的。尽可能使用数据库的内置功能。至少尝试这样开始，只有在事情*真正*需要时才妥协。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T21:18:55.597

我会利用数据库的特性来确保关系完整性，尤其是在更新/删除方面。在某些情况下，我可能会使用触发器来插入一些额外的数据（想到审计），尽管我倾向于避免这种情况并从我的应用程序中插入所有数据。但是，如果您正在执行多个插入，请确保将其全部包装在一个事务中，以免最终出现可能导致关系完整性丢失的部分插入。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T21:22:00.237

我喜欢使用数据库内置功能的想法（我不熟悉它的工作原理）.. 但是如果我一年后回到代码中，我会担心，我会记得它是如何工作的吗？（鉴于代码不在我面前）。

我想如果你添加很多评论来提醒自己它现在是如何工作的，如果将来出现任何问题，至少你不需要在需要进行一些调试时重新学习数据库功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T00:16:22.317

你比我先一步：我最近了解了如何使用触发器来做这些事情，我很想自己使用它们。

根据此处的其他答案，这似乎是一个哲学选择。使用触发器**或**代码可能会很好，但最好保持一致。因此，不要使用触发器在一个表上进行级联删除，然后使用 C 代码对另一个表进行级联删除。

由于您标记了问题 iphone，我认为最重要的区别是 C 代码与触发器的相对性能。您可能必须同时编写代码并进行实验以确定差异（如果有）。

我想到的另一件事是，在我在 thedailywtf.com 上阅读的所有恐怖故事中，其中大约一半似乎涉及数据库触发器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T11:38:51.957

不幸的是，SQLite 不支持删除级联等。来自 SQLite 文档：

[http://www.sqlite.org/omited.html](http://www.sqlite.org/omitted.html)

FOREIGN KEY 约束被解析但不被强制执行。但是，可以使用触发器来实现等效的约束实施。SQLite 源代码树包含用于读取 SQLite 数据库、分析外键约束并自动生成适当触发器的 C 程序的源代码和文档。

对触发器有一些支持，但还不完整。缺少的子功能包括 FOR EACH STATEMENT 触发器（目前所有触发器都必须是 FOR EACH ROW）、表上的 INSTEAD OF 触发器（目前 INSTEAD OF 触发器只允许在视图上）和递归触发器 - 触发自身的触发器。

因此，使用 SQLite 对删除级联等进行编码的唯一方法需要触发器。亲切的问候，

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-26T21:09:35.230

代码进入您的应用程序。

触发器是代码。该功能在您的应用程序中。不在数据库中。

我认为数据库应该用于数据，而不是处理。我认为应用程序应该用于处理，而不是数据。

数据库处理功能只是搅浑水。

# c++ - 如何在 C++ 中设置文件权限（跨平台）？

> ID：592448
> 
> 赞同：23
> 
> 时间：2009-02-26T21:07:52.190
> 
> 标签：c++, windows, unix

我正在使用 C++`ofstream`写出一个文件。我想将权限设置为只能由用户访问：700。在 unix 中；我想我可以发出 a`system("chmod 700 file.txt");`但我也需要这段代码在 Windows 上工作。我可以使用一些 Windows api；但是最好的 C++ 跨平台方法是什么？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-02-26T23:50:17.433

具有讽刺意味的是，我今天早些时候也遇到了同样的需求。

就我而言，答案归结为我在 Windows 上需要什么级别的权限粒度，而不是在 Linux 上。就我而言，我只关心 Linux 上的用户、组和其他权限。在Windows 上，DOS 剩余的基本Read/Write All 权限对我来说已经足够了，即我不需要在Windows 上处理ACL。

一般来说，Windows 有两种权限模型：基本的 DOS 模型和较新的访问控制模型。在 DOS 模型下，有一种权限：写权限。所有文件都可以读取，所以没有办法关闭读取权限（因为它不存在）。也没有执行权限的概念。如果一个文件可以被读取（答案是肯定的）并且它是二进制的，那么它可以被执行；否则不能。

基本的 DOS 模型对于大多数 Windows 环境来说已经足够了，即系统由单个用户在可以被认为相对安全的物理位置使用的环境。访问控制模型要复杂几个数量级。

访问控制模型使用访问控制列表 (ACL) 来授予权限。特权只能由具有必要特权的进程授予。此模型不仅允许通过读取、写入和执行权限控制用户、组和其他，而且还允许通过网络和 Windows 域之间控制文件。（你也可以在带有 PAM 的 Unix 系统上得到这种程度的疯狂。）

*注意：访问控制模型仅适用于 NTFS 分区，如果您使用的是 FAT 分区，您就是 SOL。*

使用 ACL 是一件让人头疼的事情。这不是一项简单的工作，它不仅需要您学习 ACL，还需要学习安全描述符、访问令牌以及许多其他高级 Windows 安全概念。

对我来说幸运的是，就我目前的需求而言，我不需要访问控制模型提供的真正安全性。只要我真的在 Linux 上设置权限，我基本上可以假装在 Windows 上设置权限。

Windows 支持他们所谓的“符合 ISO C++ 标准”的 chmod(2) 版本。此 API 称为 _chmod，它类似于 chmod(2)，但更受限制且类型或名称不兼容（当然）。Windows 也有一个已弃用的 chmod，因此您不能简单地将 chmod 添加到 Windows 并在 Linux 上直接使用 chmod(2)。

我写了以下内容：

```
#include <sys/stat.h>
#include <sys/types.h>

#ifdef _WIN32
#   include <io.h>

typedef int mode_t;

/// @Note If STRICT_UGO_PERMISSIONS is not defined, then setting Read for any
///       of User, Group, or Other will set Read for User and setting Write
///       will set Write for User.  Otherwise, Read and Write for Group and
///       Other are ignored.
///
/// @Note For the POSIX modes that do not have a Windows equivalent, the modes
///       defined here use the POSIX values left shifted 16 bits.

static const mode_t S_ISUID      = 0x08000000;           ///< does nothing
static const mode_t S_ISGID      = 0x04000000;           ///< does nothing
static const mode_t S_ISVTX      = 0x02000000;           ///< does nothing
static const mode_t S_IRUSR      = mode_t(_S_IREAD);     ///< read by user
static const mode_t S_IWUSR      = mode_t(_S_IWRITE);    ///< write by user
static const mode_t S_IXUSR      = 0x00400000;           ///< does nothing
#   ifndef STRICT_UGO_PERMISSIONS
static const mode_t S_IRGRP      = mode_t(_S_IREAD);     ///< read by *USER*
static const mode_t S_IWGRP      = mode_t(_S_IWRITE);    ///< write by *USER*
static const mode_t S_IXGRP      = 0x00080000;           ///< does nothing
static const mode_t S_IROTH      = mode_t(_S_IREAD);     ///< read by *USER*
static const mode_t S_IWOTH      = mode_t(_S_IWRITE);    ///< write by *USER*
static const mode_t S_IXOTH      = 0x00010000;           ///< does nothing
#   else
static const mode_t S_IRGRP      = 0x00200000;           ///< does nothing
static const mode_t S_IWGRP      = 0x00100000;           ///< does nothing
static const mode_t S_IXGRP      = 0x00080000;           ///< does nothing
static const mode_t S_IROTH      = 0x00040000;           ///< does nothing
static const mode_t S_IWOTH      = 0x00020000;           ///< does nothing
static const mode_t S_IXOTH      = 0x00010000;           ///< does nothing
#   endif
static const mode_t MS_MODE_MASK = 0x0000ffff;           ///< low word

static inline int my_chmod(const char * path, mode_t mode)
{
    int result = _chmod(path, (mode & MS_MODE_MASK));

    if (result != 0)
    {
        result = errno;
    }

    return (result);
}
#else
static inline int my_chmod(const char * path, mode_t mode)
{
    int result = chmod(path, mode);

    if (result != 0)
    {
        result = errno;
    }

    return (result);
}
#endif 
```

请务必记住，我的解决方案仅提供 DOS 类型的安全性。这也称为无安全性，但它是大多数应用程序在 Windows 上为您提供的安全性。

另外，在我的解决方案下，如果您没有定义 STRICT_UGO_PERMISSIONS，当您授予组或其他权限（或为此删除它）时，您实际上是在更改所有者。如果您不想这样做，但您仍然不需要完整的 Windows ACL 权限，只需定义 STRICT_UGO_PERMISSIONS。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-26T21:19:35.453

没有跨平台的方法可以做到这一点。Windows 不支持 Unix 样式的文件权限。为了做你想做的事，你必须考虑为该文件创建一个访问控制列表，这将允许你明确定义用户和组的访问权限。

另一种方法可能是在其安全设置已设置为排除除用户之外的所有人的目录中创建文件。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2017-10-19T16:44:36.123

使用 C++17 及其[`std::filesystem`](http://en.cppreference.com/w/cpp/filesystem).

```
#include <exception>
//#include <filesystem>
#include <experimental/filesystem> // Use this for most compilers as of yet.

//namespace fs = std::filesystem;
namespace fs = std::experimental::filesystem; // Use this for most compilers as of yet.

int main()
{
    fs::path myFile = "path/to/file.ext";
    try {
        fs::permissions(myFile, fs::perms::owner_all); // Uses fs::perm_options::replace.
    }
    catch (std::exception& e) {
        // Handle exception or use another overload of fs::permissions() 
        // with std::error_code.
    }           
} 
```

见和。[`std::filesystem::permissions`](http://en.cppreference.com/w/cpp/filesystem/permissions)_[`std::filesystem::perms`](http://en.cppreference.com/w/cpp/filesystem/perms)[`std::filesystem::perm_options`](http://en.cppreference.com/w/cpp/filesystem/perm_options)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-26T21:23:32.980

召唤是一头奇怪的`system()`野兽。很多个月前，我被 Mac 上的 NOP system() 实现所困扰。它的实现定义意味着标准没有定义实现（平台/编译器）应该做什么。不幸的是，这也是在您的功能范围之外做某事的唯一标准方法（在您的情况下 - 更改权限）。

**更新：**提议的黑客攻击：

*   在您的系统上创建一个具有适当权限的非空文件。

*   使用 Boost Filesystem`copy_file`将此文件复制到所需的输出。

    > `void copy_file(const path& frompath, const path& topath)`：将frompath引用的文件的内容和属性复制到topath引用的文件中。该例程期望目标文件不存在；如果目标文件存在，则会引发异常。因此，这不等同于 UNIX 中系统指定的 cp 命令。还期望 frompath 变量将引用正确的常规文件。考虑这个例子：frompath 指向一个符号链接 /tmp/file1，它又指向一个文件 /tmp/file2；例如，topath 是 /tmp/file3。在这种情况下，copy_file 将失败。这是此 API 与 cp 命令相比的另一个区别。

*   现在，用实际内容覆盖输出。

但是，这只是我在午夜后很久才想到的一个技巧。加一点盐，试试这个：）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-26T21:20:57.230

不知道它是否会起作用，但您可以考虑使用`chmod.exe`Cygwin 附带的可执行文件。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-26T21:20:58.727

在 C++ 中没有标准的方法可以做到这一点，但对于这个特殊要求，您可能应该只编写一个自定义包装器，使用 #ifdef _WIN32。Qt 在它的[QFile](http://doc.trolltech.com/4.5/qfile.html#Permission-enum)类中有一个权限包装器，但这当然意味着取决于 Qt ...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-11-25T18:22:08.077

我刚刚找到了几种从 Windows 命令行轻松执行*chmod 700的方法。*我将发布另一个问题，寻求帮助，提出一个等效的 win32 安全描述符结构以供使用（如果我在接下来的几个小时内无法弄清楚）。

Windows 2000 和 XP（杂乱——它似乎总是提示）：

```
echo Y|cacls *onlyme.txt* /g %username%:F 
```

Windows 2003+：

```
icacls *onlyme.txt* /inheritance:r /grant %username%:r 
```

**编辑：**

如果您有能力使用 ATL，本文将介绍它（我没有可用的 Visual Studio）： http: [//www.codeproject.com/KB/winsdk/accessctrl2.aspx](http://www.codeproject.com/KB/winsdk/accessctrl2.aspx)

实际上，它说示例代码也包括非 ATL 示例代码——它应该有适合你（和我！）

**要记住的重要一点是仅在 win32 上为所有者获取 r/w/x，您只需擦除文件中的所有安全描述符并为自己添加一个并完全控制。**

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-26T21:21:20.113

你不能以跨平台的方式做到这一点。在 Linux 中，您应该使用函数[`chmod(2)`](http://linux.die.net/man/2/chmod)而不是使用`system(2)`来生成新的 shell。在 Windows 上，您必须使用各种[授权功能](http://msdn.microsoft.com/en-us/library/aa375742(VS.85).aspx)来创建具有适当权限的 ACL（访问控制列表）。

# coldfusion - ColdFusion Verity 搜索被可搜索字段中的“&”弄糊涂了

> ID：592451
> 
> 赞同：2
> 
> 时间：2009-02-26T21:08:16.073
> 
> 标签：coldfusion, field, verity

我尝试寻找解决此问题的示例，但没有运气。希望有人能指出我正确的方向！

我有一个 Verity 收藏。记录的描述字段有一个标题，例如“Flowers & Candy Scented Candle”

当我在搜索中输入“鲜花和糖果”时，它没有返回任何结果。

如果我只输入单词 Flowers 或 Candy，它会找到结果。

我正在重构一些旧代码，它们通过一个有趣且有趣的 sql 查询来完成此操作，而无需使用 Verity 搜索引擎。

是否有快速解决此问题或让 Verity 搜索正常运行的方法？

我考虑在报价中自动包含这些条款，但这可能会限制结果。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T13:25:09.563

[cflib.org](http://cflib.org)是您的朋友。

[http://www.cflib.org/udf/verityClean](http://www.cflib.org/udf/verityClean)

# sql-server-2005 - 如何将结果从 exec 中传递到 oracle db 上的查询？

> ID：592456
> 
> 赞同：0
> 
> 时间：2009-02-26T21:09:30.627
> 
> 标签：sql-server-2005

我对 Oracle db 有以下调用：

```
DECLARE @myCount int;
DECLARE @sql NVARCHAR;
SET @sql = N'SELECT COUNT(*) FROM owner.myTable';
EXEC (@sql) AT oracleServer
-- how to get result count to @myCount? 
```

其中 oracleServer 是 Oracle 的链接服务器。如何将计数结果传递给变量@myCount？我试过了：

```
EXEC (@sql, @myCount output) AT oracleServer; 
```

它不工作。我必须错过一些东西或不同的方式来获得输出结果？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T16:09:05.207

您的 select 语句需要如下所示：

```
SELECT @myCount = COUNT(*) FROM owner.myTable 
```

# wcf - WCF InstanceContextMode.Multiple 问题

> ID：592458
> 
> 赞同：4
> 
> 时间：2009-02-26T21:09:48.240
> 
> 标签：wcf, concurrency

所以我在 WinForms 应用程序中托管 WCF 服务。我有以下

```
[ServiceBehavior(ConcurrencyMode = ConcurrencyMode.Multiple, 
         InstanceContextMode = InstanceContextMode.PerCall)]
public class Test : ITest
{
    public string TestIt(string input)
    {
        Thread.Sleep(5000);
        return "test";
    }
} 
```

我正在使用命名管道，并且有另一个应用程序的两个实例充当上述 WCF 服务的客户端（在 WinForms 应用程序中运行）。我认为基于 Multiple 的 ConcurrencyMode 设置，当 Client1 调用测试服务时，Client2 不必等到第一次调用完成。但是，当 Client1 调用 TestIt 时，Client2 会阻塞，直到来自 Client1 的调用完成！？！？！不应该每次都根据上面的设置创建一个新实例吗？

此外，保持承载 WCF 服务的 WinForms 应用程序响应的最佳方法是在单独的线程上运行 WCF 服务吗？

注意：在 Test 类上设置 [CallbackBehavior(UseSynchronizationContext = false)] 并不能缓解问题。该服务仍然一次只响应一个请求。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-26T21:18:23.477

听起来你想设置这个

[http://msdn.microsoft.com/en-us/library/system.servicemodel.servicebehaviorattribute.usesynchronizationcontext.aspx](http://msdn.microsoft.com/en-us/library/system.servicemodel.servicebehaviorattribute.usesynchronizationcontext.aspx)

为假。默认情况下，如果在 service.Open() 发生时存在同步上下文，WCF 将拾取并使用它。但是如果你不想要那个功能，这个标志就是如何关闭它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-27T02:03:38.767

在深入研究这一点之后，我能够使其正常工作的唯一方法是在 WinForms 应用程序中的单独线程上启动 ServiceHost。如果您不这样做，则设置 ConcurrencyMode 和 InstanceContextMode 属性不会执行任何操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-31T22:48:31.993

我有同样的问题。

我的实现 Callback 的类还包含 wcf 客户端的方法，所以当我从远程服务调用某个方法并且服务正在调用 Callback 方法时，我正在创建一个死锁。

```
[CallbackBehavior(UseSynchronizationContext = false, ConcurrencyMode = ConcurrencyMode.Multiple)]
public class AppContext : ICustomerOrderCallback
{
    //WCF Proxy client
    private CustomerOrderClient _client = null;

    public AppContext()
    {
        InstanceContext context = new InstanceContext(this); 
        _client = new CustomerOrderClient(context);
        _client.Subscribe();  //Remote method for subscribing callback
    }

    public void SendMessage(string message)
    {
        //Calling Remote method 
        _client.SendMessage(message);
    }

    //....code

    //callback method
    public void OnMessageReceived(string message)
    {
        //.....code
    }
} 
```

所以我为回调创建了一个单独的类，向它添加了属性 CallBehavior，一切正常。

```
public class AppContext
{
    private CustomerOrderClient _client = null;

    private MyCallbackClass _myCallback = null;
    public AppContext()
    {
        _myCallback = new MyCallbackClass();
        InstanceContext context = new InstanceContext(_myCallback); 
        _client = new CustomerOrderClient(context);
        _client.Subscribe();
    }

    public void SendMessage(string message)
    {
        _client.SendMessage(message);
    }
}

[CallbackBehavior(UseSynchronizationContext = false, ConcurrencyMode = ConcurrencyMode.Multiple)]
public class MyCallbackClass : ICustomerOrderCallback
{
    public void OnMessageReceived(string message)
    {
        //.....code
    }
} 
```

# objective-c - 自定义 RunLoop 模式

> ID：592474
> 
> 赞同：0
> 
> 时间：2009-02-26T21:17:13.557
> 
> 标签：objective-c

我在这里做错了什么？我错过了什么？

```
- (void)scheduleTimer
{
    NSTimer *timer = [NSTimer timerWithTimeInterval:0.15
                                             target:self
                                           selector:@selector(wtf:)
                                           userInfo:nil
                                            repeats:NO];

    // This works fine
//  [[NSRunLoop currentRunLoop] addTimer:timer
//                               forMode:NSDefaultRunLoopMode];

    // This doesn't work at all - how come?
    [[NSRunLoop currentRunLoop] addTimer:timer
                                 forMode:@"MyCustomRunLoopMode"];   
}
- (void)wtf:(NSTimer *)aTimer
{
    NSLog(@"wtf");
} 
```

NSRunLoop 的文档似乎表明可以创建自定义运行循环模式。我错过了什么吗？

（这是在 Mac OS X 中标准 GUI 应用程序的主线程上）

* * *

更新：请注意，我提到这是在标准应用程序的主线程上。因此，我自己没有运行 runloop。这一切都由 NSApplication 处理。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T21:24:36.033

您是否正在为该模式运行运行循环？如果 runloop 永远不会在那种模式下运行，那么仅仅添加一个计时器就不会做任何事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T21:26:51.053

莫非 currentRunLoop 只能在普通模式下运行？

您还应该尝试： - (BOOL)runMode:(NSString *)mode beforeDate:(NSDate *)limitDate

并通过以下方式检查： - (NSString *)currentMode

——汤姆

# sql - 为什么这个查询要进行全表扫描？

> ID：592476
> 
> 赞同：4
> 
> 时间：2009-02-26T21:17:30.980
> 
> 标签：sql, oracle, query-optimization

查询：

```
SELECT tbl1.*
   FROM tbl1 
JOIN tbl2
     ON (tbl1.t1_pk  = tbl2.t2_fk_t1_pk
AND tbl2.t2_strt_dt <= sysdate
AND tbl2.t2_end_dt  >= sysdate)
JOIN tbl3 on (tbl3.t3_pk = tbl2.t2_fk_t3_pk
AND tbl3.t3_lkup_1 = 2577304
AND tbl3.t3_lkup_2 = 1220833)
where tbl2.t2_lkup_1   = 1020000002981587; 
```

事实：

*   甲骨文快捷版
*   tbl1.t1_pk 是主键。
*   tbl2.t2_fk_t1_pk 是该 t1_pk 列上的外键。
*   tbl2.t2_lkup_1 已编入索引。
*   tbl3.t3_pk 是主键。
*   tbl2.t2_fk_t3_pk 是该 t3_pk 列上的外键。

对 tbl1 中 11,000 行和 tbl2 中 3500 行的数据库解释计划表明它正在对 tbl1 进行全表扫描。在我看来，如果它可以在 tbl1 上进行索引查询，它应该会更快。

对 tbl1 中 11,000 行和 tbl2 中 3500 行的数据库解释计划表明它正在对 tbl1 进行全表扫描。在我看来，如果它可以在 tbl1 上进行索引查询，它应该会更快。

更新：我尝试了你们中的一些人建议的提示，但解释成本变得更糟了！现在我真的很困惑。

进一步更新：我终于可以访问生产数据库的副本，“解释计划”使用索引和成本低得多的查询显示它。我猜想拥有更多数据（tbl1 中超过 100,000 行，tbl2 中超过 50,000 行）是它决定索引值得的原因。感谢所有帮助过的人。我仍然认为 Oracle 性能调优是一门魔法，但我很高兴你们中的一些人理解它。

进一步更新：我应前雇主的要求更新了这个问题。他们不喜欢他们的表名出现在谷歌查询中。我应该知道的更好。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T21:27:03.987

简单的答案：因为优化器希望找到比实际找到的更多的行。

检查统计数据，它们是最新的吗？检查解释计划中的预期基数是否与实际结果相符？如果不修复与该步骤相关的统计信息。

连接列的直方图可能会有所帮助。Oracle 将使用这些来估计连接产生的基数。

当然，您始终可以通过提示强制使用索引

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T21:37:02.277

查看优化器的行数估计值会很有用，这些估计值不在您发布的 SQL Developer 输出中。

我注意到它正在执行的两个索引查找是 RANGE SCAN 而不是 UNIQUE SCAN。因此，它对返回多少行的估计可能很容易相距甚远（统计数据是否是最新的）。

我的猜测是它对 TBL2 的 TABLE ACCESS 的最终行数的估计相当高，因此它认为它会在 TBL1 中找到大量匹​​配项，因此决定进行全扫描/散列连接而不是嵌套循环/索引扫描。

为了获得一些真正的乐趣，您可以在启用事件 10053 的情况下运行查询，并获得显示优化器执行的计算的跟踪。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T03:01:39.283

Oracle 尝试返回所需 I/O 最少的结果集（通常，这是有道理的，因为 I/O 很慢）。索引至少需要 2 个 I/O 调用。一个到索引，一个到表。通常更多，取决于索引的大小和表的大小以及返回的记录数，它们在数据文件中的位置，...

这就是统计数据的来源。假设您的查询估计返回 10 条记录。优化器可能会计算出使用索引将需要 10 次 I/O 调用。假设您的表，根据它的统计信息，驻留在数据文件中的 6 个块中。Oracle 执行完整扫描（6 I/O）然后读取索引、读取表、读取然后索引下一个匹配键、读取表等会更快。

所以在你的情况下，桌子可能真的很小。统计数据可能已关闭。

我使用以下内容收集统计数据并根据我的确切需求对其进行自定义：

```
begin

 DBMS_STATS.GATHER_TABLE_STATS(ownname
=> '&owner' ,tabname => '&table_name', estimate_percent => dbms_stats.AUTO_SAMPLE_SIZE,granularity
=> 'ALL', cascade  => TRUE); 

 -- DBMS_STATS.GATHER_TABLE_STATS(ownname
=> '&owner' ,tabname => '&table_name',partname => '&partion_name',granularity => 'PARTITION', estimate_percent => dbms_stats.AUTO_SAMPLE_SIZE, cascade 
=> TRUE);

 -- DBMS_STATS.GATHER_TABLE_STATS(ownname
=> '&owner' ,tabname => '&table_name',partname => '&partion_name',granularity => 'PARTITION', estimate_percent => dbms_stats.AUTO_SAMPLE_SIZE, cascade 
=> TRUE,method_opt  => 'for all indexed columns size 254');

end; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T21:21:08.757

您只能通过查看 SQL 优化器/执行器创建的查询计划来判断。它将至少部分基于无法仅从定义中预测的索引统计信息（因此可以随时间变化）。

适用于 SQL Server 2005/2008 的 SQL Management Studio，适用于早期版本的查询分析器。

（不记得 Oracle 的正确工具名称。）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-26T21:34:41.003

尝试添加索引提示。

```
SELECT /*+ index(tbl1 tbl1_index_name) */ ..... 
```

有时 Oracle 只是不知道要使用哪个索引。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T22:07:51.733

显然这个查询给出了相同的计划：

```
SELECT tbl1.*   
FROM tbl1 
JOIN tbl2 ON (tbl1.t1_pk  = tbl2.t2_fk_t1_pk)
JOIN tbl3 on (tbl3.t3_pk = tbl2.t2_fk_t3_pk)
where tbl2.t2_lkup_1   = 1020000002981587
AND tbl2.t2_strt_dt <= sysdate
AND tbl2.t2_end_dt  >= sysdate
AND tbl3.t3_lkup_1 = 2577304
AND tbl3.t3_lkup_2 = 1220833; 
```

如果将此查询重写为：

```
SELECT tbl1.*    
FROM  tbl1 
,     tbl2
,     tbl3  
where tbl2.t2_lkup_1   = 1020000002981587 
AND   tbl1.t1_pk  = tbl2.t2_fk_t1_pk 
AND   tbl3.t3_pk = tbl2.t2_fk_t3_pk 
AND   tbl2.t2_strt_dt <= sysdate 
AND   tbl2.t2_end_dt  >= sysdate 
AND   tbl3.t3_lkup_1 = 2577304 
AND   tbl3.t3_lkup_2 = 1220833; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-27T04:31:53.543

看起来 tbl1 表的索引没有被拾取。确保您有 t2_lkup_1 列的索引，并且它不应该是多列，否则该索引不适用。

（除了马特的评论）从您的查询中，我相信您正在加入，因为您想过滤掉不执行 JOIN 的记录，如果来自 . 见[杰夫阿特伍德评论](https://blog.codinghorror.com/a-visual-explanation-of-sql-joins/)

试试这个，它使用exist函数和join（在oracle上真的很快）

```
选择 *
  从tbl1
 其中 tbl2.t2_lkup_1 = 1020000002981587 和
       存在（
         选择 *
           从tbl2，tbl3
          其中 tbl2.t2_fk_t1_pk = tbl1.t1_pk 和
                tbl2.t2_fk_t3_pk = tbl3.t3_pk 和
                tbl2.t2_strt_dt 和 tbl2.t2_end_dt 之间的 sysdate 和
                tbl3.t3_lkup_1 = 2577304 和
                tbl3.t3_lkup_2 = 1220833);

```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-05-21T12:49:40.447

根据您的预期结果大小，您可以使用一些会话参数来玩转：

```
SHOW PARAMETER optimizer_index_cost_adj;
[...]
ALTER SESSION SET optimizer_index_cost_adj = 10;

SHOW PARAMETER OPTIMIZER_MODE;
[...]
ALTER SESSION SET OPTIMIZER_MODE=FIRST_ROWS_100; 
```

并且不要忘记检查真实的执行时间，有时计划不是真实的世界；）

# mysql - 在 MySQL 的一个字段中拥有多个 FK 是个好主意吗？

> ID：592477
> 
> 赞同：0
> 
> 时间：2009-02-26T21:17:34.773
> 
> 标签：mysql, database-design

我正在建立一个数据库，我有兴趣拥有一个类似 facebook 的朋友系统。我最初的计划是有一张这样的桌子：

```
uid  friends
4    30,23,12,33
30   54,92,108 
```

所有这些数字都是带有用户信息的表格的 FK。有人告诉我这是不可取的，实际上是不可能的，因为 MySQL 只会处理 FK 的井，如果它们是唯一放置在单元格中的井。所以也许是这样的？

```
uid(PK) friend
4        30
4        23
4        12
30       54
30       92
30       108 
```

等等。这不会给我留下大量的行吗？（几万？）第一种技术在时间和效率方面不值得吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T21:19:41.757

10 的数千行是花生，即使对于 Mysql 也是如此。没有其他方法可以模拟多对多关系。您将在这些 id 上拥有索引，它们的性能比子字符串比较好几个数量级。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T21:22:50.440

我会说第二种方式确实是“正确”的方式——并且最终在几乎所有方面都优于你提到的第一种方式。是的，它会给你留下大量的行。

如果被索引，它应该仍然非常快 - 直到某个点（可能是数十万或几百万行）。除此之外，您还需要开始研究分区或其他更高级的技术。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T21:25:04.660

不值得时间和效率？如果您使用第二种方法，您将获得更高的效率。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-06-30T10:37:16.553

有关为什么这不好的更理论上的解释，请阅读[http://en.wikipedia.org/wiki/First_normal_form](http://en.wikipedia.org/wiki/First_normal_form)

# sql - SQL 查询 + 输出中的默认字段

> ID：592487
> 
> 赞同：1
> 
> 时间：2009-02-26T21:19:50.337
> 
> 标签：sql

我想从表中选择一些行。

除了从查询结果中返回的普通列之外，我还需要在结果集中附加一些额外的字段。

我正在将表格导出到 csv 文件中。输出文件将包含一些额外的字段以及从查询返回的普通列值。

例如，表格有 A、B 和 C 列，其中有 ABC
11 Bob S
12 Gary J
13 Andy K

现在我的输出文件应该有

11，鲍勃，S，“DDD”，1
12，加里，J，“DDD”，2
13，安迪，K，“DDD”，3

（一种方法是首先从 test_table 中选择 A、B、C，然后通过手动附加 2 个字段来操作文件）

有什么方法可以让我在查询本身中获得额外的 2 个值作为硬编码值？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T21:36:30.343

如果使用 SQL Server 2005+，使用 ROWNUMBER 函数应该没问题。

```
SELECT A, B, C, 'DDD' AS D,
ROW_NUMBER() OVER (ORDER BY A) AS E
FROM Table 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T21:31:38.857

使用可以使用子查询来获取增量值。这依赖于 A 列中的 order by 和唯一值。

```
SELECT
    A,
    B,
    C,
    'DDD' [D],
    (SELECT COUNT(*) FROM test_table test_table2 WHERE test_table2.A <= test_table.A) [E]
FROM
    test_table
ORDER BY
    A 
```

这是在盲目地回答您的问题...我感觉您的问题还有更多内容，以及实际实现最终目标的更好方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T21:23:50.110

```
SELECT A, B, C, 'DDD' as "D", 1 as "E"
FROM myTable
WHERE ... 
```

1、2、3 是硬编码的，还是需要增加值？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T21:24:54.787

是的，事实上这很容易。它会是这样的： SELECT field1, field2, 'Default' AS field3, 'Default2' AS field4 FROM `table`WHERE ...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T21:32:23.660

您可以使用带有伪列 rownum 或 row_num 的 oracle 获取递增字段

我总是忘记。但这对于其他数据库会有所不同。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T21:35:40.393

```
SELECT  A,
        B,
        C,
        'DDD' AS D,
        ROW_NUMBER() OVER (ORDER BY A) AS 'E'
FROM    myTable 
```

也在这里寻找答案[sql-query-that-numerates-the-returned-result](https://stackoverflow.com/questions/510769/sql-query-that-numerates-the-returned-result)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-26T21:37:49.607

我猜测最后一个字段是行计数器，您没有指定数据库，但是对于 Oracle，这应该可以工作：

从 ex 中选择 A、B、C、'DDD'、rownum；

# java - 获取 javax.xml.stream.XMLStreamReader 读取的字节数

> ID：592494
> 
> 赞同：1
> 
> 时间：2009-02-26T21:21:16.107
> 
> 标签：java, xml, stream

有什么方法可以获取 XMLStreamReader 读取的字节数，我使用的是 java.io.FileReader，它被传递到创建 xml 阅读器的工厂。我怀疑使用 XMLStreamReader 是否可行，但任何解决方法都很棒。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T21:25:58.527

一种流行的方法是创建一个`ByteCountingReader(Reader r);`，我想我不必比这更具体:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T22:15:49.250

假设你正在做这样的事情：

```
final XMLInputFactory inputFactory;
final XMLStreamReader reader;
final InputStream     stream;

inputFactory = XMLInputFactory.newInstance();
stream       = new FileInputStream(file);
reader       = inputFactory.createXMLStreamReader(stream); 
```

你会做这样的事情：

```
final XMLInputFactory     inputFactory;
final XMLStreamReader     reader;
final InputStream         stream;
final CountingInputStream countingStream;

inputFactory   = XMLInputFactory.newInstance();
stream         = new FileInputStream(file);
countingStream = new CountingStream(stream);
reader         = inputFactory.createXMLStreamReader(countingStream); 
```

其中 CoutingInputStream 是一个您需要编写/查找的类，它跟踪从底层 InputStream 对象读取的字节数。

# java - 手动生成 Faces Context

> ID：592496
> 
> 赞同：5
> 
> 时间：2009-02-26T21:21:35.637
> 
> 标签：java, jsf, servlets, icefaces

我有两个正在尝试集成的系统。一种基于原始 servlet，新的一种基于带有 IceFaces 的 JSF。我正在尝试促进跨系统登录。这个想法是我在旧系统中有一个按钮，可以将适当的信息发布到新站点并登录。

好吧，理想情况下，我只想在新站点上使用一个普通的旧 servlet 来促进它。转到新站点的 Servlet，做它需要做的事情，然后转发到仪表板上。

我们的安全性是通过托管 bean 处理的。但是，当您到达 Servlet 时，还没有面孔上下文。那么，我将如何创建一个新的面孔上下文？

我有一个备份计划，因为我总是可以链接到一个虚拟的 .iface 页面，该页面将为我创建 FacesContext，然后创建一个支持 bean，它在实例化时会做一些事情，然后转发到主页。但这感觉很像黑客。

任何帮助，将不胜感激！

**编辑：**我选择了备用方式。基本上，我发布到这样的页面：

```
<f:view>
   <ice:outputText value="#{EntryPoint}"/>
</f:view 
```

支持豆看起来像这样......

```
public EntryPoint() {
      try {
         HttpServletRequest request = (HttpServletRequest) FacesContext.getCurrentInstance().getExternalContext().getRequest();
         HttpServletResponse response = (HttpServletResponse) FacesContext.getCurrentInstance().getExternalContext().getResponse(); 
         String loginID = request.getParameter("loginID");
         //Do some code to load the user/permissions
         response.sendRedirect(
            //The appropriate page
         );
      } catch (IOException ex) {
         logger.error(null, ex);
      } catch (SQLException ex) {
         logger.error(null, ex);
      }
   } 
```

这仍然感觉像一个黑客，但我不知道如何解决这个问题。理想情况下，我会发布到 servlet，获取 loginID，构建用户并将其直接放入托管 bean。但是，此时 FacesContext 并不存在。

还有其他想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T22:55:30.123

在这种情况下，我不确定您所说的“站点”是什么意思。

几点注意事项：

*   托管 bean 在定义它们的 Web 应用程序 (WAR) 之外永远不可用。
*   FacesContext 对象实例最终由[FacesServlet.service](http://java.sun.com/javaee/5/docs/api/javax/faces/webapp/FacesServlet.html#service(javax.servlet.ServletRequest,%20javax.servlet.ServletResponse))创建和处理，因此请求应该通过这个 servlet。在其他情况下尝试创建上下文可能会导致未定义的行为。

* * *

考虑到这一点，您可以创建一个这样的请求序列：

```
FacesServlet (mapping: /faces/*)
 -> /faces/jsfPage.jsp (a JSP with JSF controls)
    -> DispatchBean (calls ExternalContext.dispatch("/AnotherServlet")
       -> AnotherServlet 
```

jsfPage.jsp 包含：

```
<f:view>
    <h:outputText value="#{dispatchBean.dispatch}" />
</f:view> 
```

“dispatch”属性解析为 bean 方法“getDispatch”：

```
public String getDispatch() {
    FacesContext context = FacesContext.getCurrentInstance();
    try {
        context.getExternalContext().dispatch("/FacesClientServlet");
    } catch (IOException e) {
        throw new FacesException(e);
    }
    return null;
} 
```

哪个调度到这个 servlet：

```
public class FacesClientServlet extends javax.servlet.http.HttpServlet
        implements javax.servlet.Servlet {

    static final long serialVersionUID = 1L;

    @Override
    protected void doGet(HttpServletRequest request,
            HttpServletResponse response) throws ServletException, IOException {

        FacesContext context = FacesContext.getCurrentInstance();
        ELContext elContext = context.getELContext();
        ExpressionFactory expressionFactory = context.getApplication()
                .getExpressionFactory();
        ValueExpression expression = expressionFactory.createValueExpression(
                elContext, "#{myBean.text}", Object.class);
        Object value = expression.getValue(elContext);

        ResponseWriter writer = context.getResponseWriter();
        writer.write("" + value);

    }

} 
```

它从托管 bean“myBean”发出值：

```
public class MyBean {

    private final String text = "Hello, World!";

    public String getText() {
        return text;
    }

} 
```

这一切都非常令人费解，我不会愿意做任何事情。

* * *

另一种可能会带来其后果的替代方法是创建自己的上下文，如下所示：

```
public class ContextServlet extends javax.servlet.http.HttpServlet implements
        javax.servlet.Servlet {
    static final long serialVersionUID = 1L;

    private FacesContextFactory facesContextFactory;
    private Lifecycle lifecycle;

    @Override
    public void init(ServletConfig config) throws ServletException {
        super.init(config);

        LifecycleFactory lifecycleFactory = (LifecycleFactory) FactoryFinder
                .getFactory(FactoryFinder.LIFECYCLE_FACTORY);
        facesContextFactory = (FacesContextFactory) FactoryFinder
                .getFactory(FactoryFinder.FACES_CONTEXT_FACTORY);
        lifecycle = lifecycleFactory
                .getLifecycle(LifecycleFactory.DEFAULT_LIFECYCLE);
    }

    @Override
    protected void doGet(HttpServletRequest request,
            HttpServletResponse response) throws ServletException, IOException {

        FacesContext context = facesContextFactory.getFacesContext(
                getServletContext(), request, response, lifecycle);
        try {
            ELContext elContext = context.getELContext();
            ExpressionFactory expressionFactory = context.getApplication()
                    .getExpressionFactory();
            ValueExpression expression = expressionFactory
                    .createValueExpression(elContext, "#{myBean.text}",
                            Object.class);
            Object value = expression.getValue(elContext);

            PrintWriter pw = response.getWriter();
            try {
                pw.write("" + value);
            } finally {
                pw.close();
            }
        } finally {
            context.release();
        }
    }

} 
```

同样，如果可能的话，我会避免这种方法。

# assembly - 如何在 x86 上为我的语言最好地传递全局偏移表 (GOT)？

> ID：592497
> 
> 赞同：2
> 
> 时间：2009-02-26T21:21:37.977
> 
> 标签：assembly, x86, elf

我正在为我的语言编写一个小程序加载器，因为我放弃了理解 ELF 格式（在这样做的同时，我最终可能会更好地理解它）。我将文件映射到内存中，然后无尾礼服欢欣鼓舞。

我不想通过对其进行任何更改来阻碍程序的共享。因此，我最终做了与 C 和 elf 相同的操作：全局偏移表。

问题是：我怎样才能通过我的程序的 GOT？

首先想到的是在寄存器或堆栈参数中提供它。在寄存器中它会很棒，但是 x86 被它的寄存器数量所阻碍。这可能意味着我将失去 ebx 或 ebp 或类似的东西。在一个合理的架构中，这将是一个公平的权衡。在 x86 中感觉有点失败。

共享库的反汇编显示 gcc 正在将其作为 IP 相对寻址。如果我这样做，那将是：

```
 call 0
here:
    pop eax
    ; do something with [eax + (got - here) + index*4] 
```

虽然，这在一定程度上感觉很复杂。我不喜欢这样做。

还有什么想法，有人吗？

**编辑：**当使用多个库处理此问题时，我意识到：每个应用程序将有多个 GOT，并且某些 GOT 的使用取决于我所在的代码块。因此将 GOT 保存在单独的寄存器中需要一些我不知道的其他技巧。我想知道他们在将 GOT 保存在寄存器中时如何解决这个问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T21:37:50.730

您可以使用其中一个段寄存器（或其基址）作为二进制映像的基址。所以你会参考你的全球数据，例如。作为 FS:xxx。

这些寄存器是所谓的分段内存模型的残余。基本上，段是具有指定基数（和限制）的线性地址空间的“窗口”，如果您使用它们进行寻址（例如，如果地址是 0010:00000001），则结果地址是（选择器为 0010 的段的基址） )+00000001。段的基数（以及其他参数）存储在描述符表中（还有更多），这是内存中的一个特殊区域。这些只能在内核模式下修改，linux中有系统调用可以做到这一点（[`modify_ldt`](http://linux.die.net/man/2/modify_ldt)，[`arch_prctl`](http://techpubs.sgi.com/library/tpl/cgi-bin/getdoc.cgi?coll=linux&db=man&fname=/usr/share/catman/man2/arch_prctl.2.html)）。在 64 位模式下，情况稍微复杂一些。

如需参考，请参阅[AMD64 架构手册](http://www.amd.com/us-en/Processors/DevelopWithAMD/0,,30_2252_869_875%5E7044,00.html)，尤其是第 2 卷：系统编程。

# c# - 如何查看实体框架的待定更改？

> ID：592504
> 
> 赞同：48
> 
> 时间：2009-02-26T21:22:54.213
> 
> 标签：c#, .net, entity-framework

我正在使用 ADO.NET Entity Framework 创建一个应用程序。

我可以在调试时逐行执行我的代码，并观察 SQL Server Profiler 执行的每个查询，但我无法弄清楚所有这些 SQL 命令的来源！

有时，当我执行时`SaveChanges()`，实体框架会执行意想不到的、奇怪的 INSERTS。他们有时会破坏应用程序。我不知道我在做什么来引起他们。

如何监控排队等待`SaveChanges()`呼叫的未决更改？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2014-08-11T10:07:49.147

由于 Entity Framework 5.0`DbContext`有一个包含所有未决更改的[`ChangeTracker`属性。](http://msdn.microsoft.com/en-us/library/Gg696736(v=vs.103).aspx)与您类似，`ObjectStateManager`您可以获得各种状态的实体，如下所示：

```
myDbContext.ChangeTracker.Entries().Where(e => e.State == EntityState.Added);
myDbContext.ChangeTracker.Entries().Where(e => e.State == EntityState.Deleted);
myDbContext.ChangeTracker.Entries().Where(e => e.State == EntityState.Modified); 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-02-26T23:04:04.347

Take a look at

```
myObjectContext.ObjectStateManager.GetObjectStateEntries(EntityState.Added) 
```

[here](http://msdn.microsoft.com/en-us/library/bb738497.aspx "MSDN").

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-10-22T11:03:36.557

要监视在状态管理器中添加或删除实体时的事件，可以使用[ObjectStateManagerChanged](http://msdn.microsoft.com/en-us/library/system.data.objects.objectstatemanager.objectstatemanagerchanged.aspx)事件：

```
var ctx = new ModelContainer();

// ...

ctx.ObjectStateManager.ObjectStateManagerChanged += (sender, e) =>
{
   Trace.WriteLine(string.Format("{0}, {1}", e.Action, e.Element));
}; 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2017-07-01T19:10:52.727

**Entity Framework 6**有一个方法，非常有用。

```
dbContext.ChangeTracker.HasChanges() 
```

例子：

```
if (dbContext.ChangeTracker.HasChanges())
{
    db.SaveChanges();
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-10-09T13:40:37.197

当我尝试查看`ObjectStateManager`其他答案中提到的内容时，它没有出现在我的调试器中。在 Visual Studio 2017 中调试时，我发现将以下代码段添加到手表（它在引用 ObjectStateManager 属性之前转换 dbContext 对象）很有帮助。

`((System.Data.Entity.Infrastructure.IObjectContextAdapter)this.db).ObjectContext.ObjectStateManager`

监视完成后，您可以逐行调试，观察哪些操作添加到列出未决更改的各种属性中。

# asp.net - WCF 服务如何返回大量数据？

> ID：592505
> 
> 赞同：1
> 
> 时间：2009-02-26T21:23:06.287
> 
> 标签：asp.net, wcf

我正在开发一个将数据传递给自定义客户端应用程序的网络应用程序。

当数据超过某个“小”大小时，我会遇到异常。由于最终用户可能会使用越来越大的数据大小，因此我将 WCF 函数的返回值切换为数据集的 ID。

接下来，我将客户端转换为使用 ID 从一些简单的 ASPX 页面中检索数据。这工作正常，但意味着界面不一致。

1.  *编辑：我不确定我是如何错过返回 Stream 的，但我做到了。* 有人对 WCF 上的流有问题吗？

2.  除了断开连接之外，通过 HTTP 流从 ASPX 页面读取文件是否存在任何问题？

我假设我缺少 WCF 的功能（如 oob 数据）。但是，C#/.NET 在线帮助要么很差，要么安装在我的机器上严重损坏。

谢谢。

**[编辑]**顺便说一句，在我的情况下，“大量数据”是用户输入驱动的，但至少需要 20MiB。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-09T17:59:56.230

请参阅[大数据和流式传输](http://msdn.microsoft.com/en-us/library/ms733742.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-09T17:51:40.340

您看到的异常是什么？由于超出了阅读器配额，您不能阅读 XML 吗？

如果是这样，我想我知道什么可以解决它。请参阅下面的示例 wsHttpBinding。您的异常应该可以帮助您确定需要修复的参数。您可以为阅读器设置 maxReceivedMessageSize 和配额。如果这不起作用，请告诉我，请提供更多数据。

```
<wsHttpBinding>
    <binding name="bindingName" closeTimeout="00:01:00" openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00" bypassProxyOnLocal="false" maxBufferPoolSize="524288" maxReceivedMessageSize="65536">
      <readerQuotas maxDepth="32" maxStringContentLength="3145728" maxArrayLength="16384" maxBytesPerRead="4096" maxNameTableCharCount="16384" />
    </binding>
</wsHttpBinding> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T10:39:20.407

你可以去这个地址[http://weblogs.asp.net/cibrax/archive/2008/06/10/streaming-large-content-with-wcf-and-deferred-execution.aspx](http://weblogs.asp.net/cibrax/archive/2008/06/10/streaming-large-content-with-wcf-and-deferred-execution.aspx)，我不适合给你的铅，但这也是一个想法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-13T21:37:08.207

据我了解@Eugene 提到的[大数据和流媒体](http://msdn.microsoft.com/en-us/library/ms733742.aspx)文章，必须为所有通信切换传输模式，这意味着它会关闭一些完整性检查。

因此，我最终使用了一个半定制的 HTTP 客户端类，其中：

*   **下载**使用 ASPX 页面返回数据并将其流式传输到客户端应用程序的磁盘文件，
*   **上载**将文件发送到生成 GUID 的 ASPX 页面，并将文件保存到服务器的磁盘，该 GUID 作为其名称的一部分。然后，它调用 WCF 方法来传递带有 GUID 的其他参数，而不是文件数据。

它并不漂亮，但它有效。不幸的是，IIS 或客户端应用程序崩溃可能会将临时文件留在服务器硬盘驱动器上，但它们已本地化并且可以在创建服务时进行清理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-15T21:53:16.520

在客户端和服务器端设置 maxItemsInObjectGraph 对我有用。

（不要忘记客户端。） [http://social.msdn.microsoft.com/Forums/en/wcf/thread/0af69654-2d89-44f3-857a-583b57844ca5](http://social.msdn.microsoft.com/Forums/en/wcf/thread/0af69654-2d89-44f3-857a-583b57844ca5)

# c# - Asp.NET MVC 模型绑定 - 使用绑定参数属性为简单类型分配前缀

> ID：592508
> 
> 赞同：4
> 
> 时间：2009-02-26T21:24:24.100
> 
> 标签：c#, .net, asp.net, asp.net-mvc, model-binding

我有一个带有控制器操作的 .net mvc 应用程序，它接受用户注册帖子。我有以下 UI 字段：电子邮件地址、名字、姓氏、密码和确认密码。其中一些字段不属于模型对象（即确认密码不属于用户模型，只有密码）。我的注册表单与登录表单位于同一视图中。所以我必须在同一个视图上独立表单，每个回帖返回不同的操作。

我想我可以为表单元素分配前缀，以分隔注册和登录之间的类似字段。我遇到的问题是关于验证，如果发生错误，则重新加载视图，显示验证消息，但电子邮件（存在于登录和注册中）等字段都将使用先前输入的地址填充。此外，我在登录和注册字段上方都有一个验证摘要。当注册过程中发生错误时，两个验证摘要都填充了错误消息。我认为为字段（register.fieldname 和 login.fieldname）分配前缀可能有助于解决这些问题。

因此，当注册操作处理帖子时，它不再查找注册表单字段的值，而是返回 null。以下是用于此操作的方法签名...

关于这里发生的事情的任何输入都会很棒。

谢谢杰里米

```
 public ActionResult Register([Bind(Prefix = "Register")] string emailAddress, [Bind(Prefix = "Register")] string firstName, [Bind(Prefix = "Register")] string LastName, [Bind(Prefix = "Register")] string password, [Bind(Prefix = "Register")] string confirmPassword) 
```

以下来自我的ui，它代表注册表....

```
<h2>Create a New Account</h2>
  <p>
      Use the form below to create a new account. 
  </p>
  <p>
      Passwords are required to be a minimum of <%=Html.Encode(ViewData["PasswordLength"])%> characters in length.
  </p>
  <%= Html.ValidationSummary() %>

  <% using (Html.BeginForm("register", "account")) { %>
    <div>
      <fieldset>
        <legend>Account Information</legend>

        <table>
          <tr>
            <td><label for="EmailAddress">Email Address:</label></td>
            <td>
              <%= Html.TextBox("Register.EmailAddress") %>
              <%= Html.ValidationMessage("Register.EmailAddress")%>
            </td>
          </tr>
          <tr>
            <td><label for="FirstName">First Name</label></td>
            <td>
              <%= Html.TextBox("Register.FirstName")%>
              <%= Html.ValidationMessage("Register.FirstName")%>
            </td>
          </tr>   
          <tr>
            <td><label for="LastName">Last Name</label></td>
            <td>
              <%= Html.TextBox("Register.LastName")%>
              <%= Html.ValidationMessage("Register.LastName")%>
            </td>
          </tr>           
          <tr>
            <td><label for="password">Password:</label></td>
            <td>
              <%= Html.Password("Register.password")%>
              <%= Html.ValidationMessage("Register.password")%>
            </td>
          </tr>
          <tr>
            <td><label for="confirmPassword">Confirm password:</label></td>
            <td>
              <%= Html.Password("Register.confirmPassword")%>
              <%= Html.ValidationMessage("Register.confirmPassword")%>
            </td>
          </tr>
          <tr>
            <td colspan="2" class="alignright">
              <input type="submit" value="Register" />
            </td>
          </tr>
        </table>
      </fieldset>
    </div>
  <% } %>
</div> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-11T17:32:56.363

我认为为了使用带前缀的 [Bind]，您需要使用复杂类型。您将相同的前缀与每个参数相关联，这不适用于 MVC 框架执行此操作的方式。

您可以创建一个类型来处理表单帖子：

```
public class RegistrationForm {
 string EmailAddress {get;set;}
 string FirstName {get;set;}
 string LastName {get;set;}
 string Password {get;set;} 
 string ConfirmPassword {get;set;}
} 
```

然后您可以将您的签名更改为：

```
public ActionResult Register(RegistrationForm register) {
...
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-08-16T09:40:41.967

似乎对于像 int 和 string 这样的简单类型，Bind Prefix 会覆盖参数的模型名称。以您的操作方法为例，DefaultModelBinder 将为所有参数查找名称“Register”。

为了解决这个问题并且不需要复杂类型，您需要指定完全限定名称，因为 Mvc 会将其呈现到 HTML 标记中。

将此应用于您的操作方法，它应该如下所示：

```
public ActionResult Register([Bind(Prefix = "Register.EmailAddress")] string emailAddress, [Bind(Prefix = "Register.FirstName")] string firstName, [Bind(Prefix = "Register.LastName")] string LastName, [Bind(Prefix = "Register.Password")] string password, [Bind(Prefix = "Register.onfirmPassword")] string confirmPassword) 
```

# java - 我如何解释这个 JVM 错误？

> ID：592520
> 
> 赞同：4
> 
> 时间：2009-02-26T21:28:04.153
> 
> 标签：java, debugging, java-native-interface, core, hs-err

我有一个使用一些本机代码的 Java 应用程序，但它有问题。我想找出问题出*在哪里*，但我不确定如何读取 hs_err_pid 转储文件：

```
Native frames: (J=compiled Java code, j=interpreted, Vv=VM code, C=native code)
V  [libjvm.so+0x256cbc]
V  [libjvm.so+0x25df69]
V  [libjvm.so+0x25dbac]
V  [libjvm.so+0x25e8c8]
V  [libjvm.so+0x25e49f]
V  [libjvm.so+0x16fa3e]
j  br.com.cip.spb.single.SPBRequestApplicationController.processJob(Lcom/planet/core360/docgen/ProcessingEnvironment;Lcom/planet/core360/dsmv2/processing/ApplicationDataJob;)V+158
j  com.planet.core360.cgen.CgenProcessor.processJob(Ljava/lang/String;Lcom/planet/core360/docgen/ProcessingEnvironment;Lcom/planet/core360/dsmv2/processing/ApplicationDataJob;)V+108
j  com.planet.core360.cgen.CgenProcessor.processJob(Ljava/lang/String;Lcom/planet/core360/docgen/ProcessingEnvironment;Lcom/planet/core360/dsmv2/processing/ScheduledJob;)V+7
v  ~StubRoutines::call_stub
V  [libjvm.so+0x17af0c]
V  [libjvm.so+0x28b9d8]
V  [libjvm.so+0x17ad3f]
V  [libjvm.so+0x1a58a3]
V  [libjvm.so+0x18bc24]
C  [cgen+0xa6d6]
C  [cgen+0xae1e]  cgen_process_job+0x336
C  [cgen+0x10442]
C  [cgen+0x7714]
C  [cgen+0x38216]
C  [cgen+0x3a29d]
C  [cgen+0x37e3c]
C  [cgen+0x7558]
C  [libc.so.6+0x166e5]  __libc_start_main+0xe5 
```

基本上，“j”帧指向什么？是`V+158`指类中的字节码偏移量吗？我怎样才能从这个追溯到游戏中的源代码行？

实际上，我很想有一个了解这些垃圾场的一般指南。那也太棒了。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-26T21:38:22.210

有关一般指南，请查看这两个链接[Fatal Error Log Troubleshooting](http://www.oracle.com/technetwork/java/javase/felog-138657.html) and [Crash Course on JVM Crash Analysis](https://community.oracle.com/blogs/kohsuke/2009/02/19/crash-course-jvm-crash-analysis)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-13T13:07:33.877

我也很困惑，“V+158”是什么意思？但是解释很简单，“V”是方法返回类型，是方法描述的一部分。（描述由包名、类名、方法名、方法采用的参数类型和返回类型组成）“V”代表“void”。

+158 就是所谓的“字节码索引”——你是对的。

# sql - Sql 分组

> ID：592522
> 
> 赞同：0
> 
> 时间：2009-02-26T21:28:41.703
> 
> 标签：sql, tsql, grouping, sum

[替代文字 http://agricam.net/test.gif](http://agricam.net/test.gif)

在营销人员编号更改为标题“营销人员总计”后，我需要在 SQL 中动态添加一行，该标题应仅添加“总计”列。例如，在Marketer 22 行的最后一行之后，应该有“Marketer Total”，然后在 Total 列下应该是 1804。在 Marketer 500 的最后一行之后应该出现同样的情况。

请参阅[http://agricam.net/test.gif上的图片](http://agricam.net/test.gif)

当前查询：

从 SomeTable 中选择 Marketer、SubMarketer、Grade、Total、Convert(varchar,Date,101)[Date] where Date >= '2/25/2009' and Date < '2/26/2009' and Marketer in ('22' ,'500') 按 SubMarketer,Grade,Marketer, Date 分组, 按Marketer 的总订单

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T21:33:17.560

请参阅 [使用 ROLLUP 在 SQL 中聚合数据](http://www.odetocode.com/Articles/85.aspx)

执行：

```
DECLARE @SOMETABLE TABLE (SUBMARKETER INT, GRADE CHAR, MARKETER INT, 
  DATE DATETIME, TOTAL INT)
INSERT INTO @SOMETABLE
SELECT 1415, 'A', 22, '02/25/2009', 26 UNION
SELECT 1415, 'B', 22, '02/25/2009', 93 UNION
SELECT 1415, 'C', 22, '02/25/2009', 1175 UNION
SELECT 1415, 'D', 22, '02/25/2009', 510 UNION
SELECT 1169, 'B', 500, '02/25/2009', 1 UNION
SELECT 1169, 'C', 500, '02/25/2009', 3 UNION
SELECT 1393, 'C', 500, '02/25/2009', 2 UNION
SELECT 2, 'B', 500, '02/25/2009', 5 UNION
SELECT 2, 'C', 500, '02/25/2009', 111 UNION
SELECT 2, 'D', 500, '02/25/2009', 18 

SELECT 
  CASE WHEN SUBMARKETER IS NULL THEN 'Marketer Total' 
    ELSE CONVERT(VARCHAR, MARKETER) END MARKETER, 
    SUBMARKETER, GRADE, TOTAL, DATE 
  FROM (
    SELECT MARKETER, SUBMARKETER, GRADE, SUM(TOTAL) AS TOTAL, 
    CONVERT(VARCHAR,DATE,101)[DATE] 
    FROM @SOMETABLE 
    WHERE DATE >= '2/25/2009' AND DATE < '2/26/2009' 
     AND MARKETER IN ('22','500') 
    GROUP BY MARKETER, SUBMARKETER, GRADE, DATE WITH ROLLUP
)M 
WHERE M.MARKETER IS NOT NULL 
AND NOT (SUBMARKETER IS NOT NULL AND DATE IS NULL) 
```

**注意**：如果 MARKETER、SUBMARKETER 和 DATE 列不为空，这将正常工作。如果表中这些字段的值为NULL，那么过滤掉无用的分组将成为一个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T21:40:15.577

Coldice 的答案是正确的。除非您有令人信服的理由将聚合数据存储在表中，否则查询引擎足够强大，可以为您执行此操作。你能解释一下为什么你需要表格中的这一行吗？是为了展示目的吗？您可以使用 ROLLUP 函数将聚合结果放入查询中，也可以运行单独的查询来显示总数：

```
SELECT marketer, SUM(total) FROM TablenameHere GROUP BY marketer 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T22:31:44.593

我相信你也可以使用[COMPUTE](http://msdn.microsoft.com/en-us/library/ms181708.aspx) SUM

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-26T21:33:19.587

在插入记录时计算总数的表上创建一个触发器。这样，您可以在数据库中有移动的任何时候验证您是否拥有最新的总数。

# security - 除了代理之外，如何绕过 IP 定位器？

> ID：592523
> 
> 赞同：2
> 
> 时间：2009-02-26T21:28:45.527
> 
> 标签：security, ip-address, geography

我需要简要介绍一下基于 IP 地址将内容限制在特定国家/地区背后的弱点。

除了使用位于另一个国家的代理服务器之外，你能想出另一种方法来绕过这样的系统吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T21:35:32.623

基本上，任何使用中介的解决方案都是代理。时期。

所有“匿名冲浪”网站都是代理，即使他们使用自己的软件。

您可以使用 SSH 和隧道，但实际上，它也是一个代理，只是一个隧道代理。与 VPN 相同。

唯一不需要代理的是源地址欺骗，它只适用于单向攻击，因为没有返回数据能够到达您那里。

此外，请考虑地理定位并非 100% 准确。我在加拿大的 IP 地址显示为美国地址，我的美国地址显示为加拿大。我敢肯定这在世界其他地方更常见。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T21:32:33.817

您可以购买阻止您广播 IP 地址的软件。我确定它有效，我看到它在各地的横幅广告中做广告:)

更严肃地说，绕过它的一种方法是使用缓存服务器（谷歌缓存，回程机器）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T21:39:53.267

我不认为你可以。您正在与之交谈的机器必须知道将其回复发送到哪里；那是你的IP地址。隐藏它的唯一方法是让它回复传递给你的不是你的人 - 即。代理。

[Tor](http://www.torproject.org/)通常是实现匿名的好方法，尽管它不适合规避您正在谈论的系统类型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T21:39:54.127

由于您的 IP 地址位于通过网络的每个 IP 数据包中，并且您需要获取响应，因此您无法阻止服务器检测到您的真实 IP 地址（除了在其间放置代理） .

您可能感兴趣的一些链接：

[瑞典和挪威之间关于监控的冲突](http://www.economist.com/agenda/displaystory.cfm?story_id=11778941)（瑞典无法可靠地识别挪威 IP 流量并将其排除在监控之外）

[Herdict.com](http://herdict.com)（我们建立的，我很高兴报告）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-26T21:40:40.020

这取决于您检查 IP 的 IP 堆栈级别，但在更高级别上，您甚至不需要代理服务器来显示不同的 IP 地址。例如，如果您要检查的是 TCP 标头，则可以修改它。

这是一个讨论欺骗的链接：[http ://www.securityfocus.com/infocus/1674](http://www.securityfocus.com/infocus/1674)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T21:40:10.570

如果服务使用基于 Web 的 Geo IP 查找，那么成功的[MITM](http://en.wikipedia.org/wiki/Man_in_the_middle_attack)攻击可能会诱使服务认为 IP 地址是有效的。当然，这涉及更多，但绝对可行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-27T09:36:41.767

不要忘记 VPN（当然还有 NAT）。我想这也可以归类为代理。它还需要在另一个国家使用合适的机器。

# c# - 如何创建一个在其他控件之上工作的透明控件？

> ID：592538
> 
> 赞同：19
> 
> 时间：2009-02-26T21:33:19.103
> 
> 标签：c#, winforms, transparent-control

我有一个控件（派生自 System.Windows.Forms.Control），它在某些区域需要是透明的。我已经通过使用 SetStyle() 实现了这一点：

```
public TransparentControl()
{
    SetStyle(ControlStyles.SupportsTransparentBackColor, true);
    this.BackColor = Color.Transparent.
} 
```

现在，如果窗体和透明控件之间没有控件，这将起作用。但是，如果在透明控件下方碰巧有另一个控件（这是这里的用例），它就不起作用。中间控件不是绘制的，但下面的表格确实显示出来了。我可以通过覆盖 CreateParams 并像这样设置 WS_EX_TRANSPARENT 标志来获得所需的效果：

```
protected override CreateParams CreateParams
{
    get
    {
        CreateParams cp = base.CreateParams;
        cp.ExStyle |= 0x20; // WS_EX_TRANSPARENT
        return cp;
    }
} 
```

这里的问题是它*确实*减慢了控件的绘制速度。该控件已经是双缓冲的，因此无事可做。性能影响是如此糟糕，以至于无法接受。有没有其他人遇到过这个问题？我能找到的所有资源都建议使用方法#1，但同样，这在我的情况下不起作用。

编辑：我应该注意我确实有一个解决方法。子（透明）控件可以简单地将自己绘制到父图形对象上，但它真的很丑陋，我根本不喜欢这个解决方案（尽管它可能是我所拥有的全部）。

EDIT2：因此，根据我得到的关于透明度如何在 .NET 中工作的建议，我在包含透明控件的用户控件中实现了 IContainer 接口。我创建了一个实现 ISite 的类，我将我的子控件添加到 UserControl 的 Components 集合中，Container 属性在调试器中正确排列，但我仍然没有得到透明效果。有没有人有任何想法？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2012-05-19T07:55:48.740

这只是我做的一个简单的事情。我发现的唯一问题是当更新相交控件时它不会更新。

它通过将位于当前控件后面/与当前控件相交的控件绘制到位图，然后将该位图绘制到当前控件来工作。

```
protected override void OnPaint(PaintEventArgs e)
{
    if (Parent != null)
    {
        Bitmap behind = new Bitmap(Parent.Width, Parent.Height);
        foreach (Control c in Parent.Controls)
            if (c.Bounds.IntersectsWith(this.Bounds) & c != this)
                c.DrawToBitmap(behind, c.Bounds);
        e.Graphics.DrawImage(behind, -Left, -Top);
        behind.Dispose();
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-26T22:10:19.920

DotNet 中的透明控件是通过让透明控件的**容器**自己在透明控件的窗口中绘制，然后让透明控件自己绘制来实现的。这个过程没有考虑重叠控制的可能性。因此，您将需要使用某种解决方法来使其正常工作。

在某些情况下，我在复杂的嵌套方面取得了成功，但这主要只适用于位图的快速和肮脏的分层，并且它不能解决部分重叠控件的任何问题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2012-09-11T19:51:06.463

我发现下面的修改使事情变得更快：

```
if((this.BackColor == Color.Transparent) && (Parent != null)) {
    Bitmap behind = new Bitmap(Parent.Width, Parent.Height);
    foreach(Control c in Parent.Controls) {
        if(c != this && c.Bounds.IntersectsWith(this.Bounds)) {
            c.DrawToBitmap(behind, c.Bounds);
        }
    }
    e.Graphics.DrawImage(behind, -Left, -Top);
    behind.Dispose();
} 
```

我也认为使用`this.Width`/`this.Height`而不是`Parent.Width`/`Parent.Height`会更快，但我没有时间去修改它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-05-17T09:32:56.507

在控制下绘制兄弟姐妹是可能的，但它很难看。下面的代码对我来说效果很好，它扩展了[Ed S中链接中给出的代码。回答](https://stackoverflow.com/a/593282/520044)。

可能的陷阱：

*   `DrawToBitmap`是在 .net 2.0 中引入的，所以不要指望它适用于比这更早的任何东西。但即便如此，通过将 WM_PRINT 发送到同级控件也可以实现这样的事情；AFAIK 这就是 DrawToBitmap 在内部所做的。
*   如果您的控件在您的控制下使用，它也可能会出现问题，`WS_EX_TRANSPARENT`因为根据[msdn](http://msdn.microsoft.com/en-us/library/ff700543.aspx#WS_EX_TRANSPARENT)的说法，窗口样式会影响绘画顺序。我没有任何使用这种风格的控件，所以我不知道。
*   我在 VS2010 上运行 XP SP3，因此这种方法在 Vista 或 W7 上可能会出现其他问题。

这是代码：

```
if (Parent != null)
{
    float
        tx = -Left,
        ty = -Top;

    // make adjustments to tx and ty here if your control
    // has a non-client area, borders or similar

    e.Graphics.TranslateTransform(tx, ty);

    using (PaintEventArgs pea = new PaintEventArgs(e.Graphics,e.ClipRectangle))
    {
        InvokePaintBackground(Parent, pea);
        InvokePaint(Parent, pea);
    }

    e.Graphics.TranslateTransform(-tx, -ty);

    // loop through children of parent which are under ourselves
    int start = Parent.Controls.GetChildIndex(this);
    Rectangle rect = new Rectangle(Left, Top, Width, Height);
    for (int i = Parent.Controls.Count - 1; i > start; i--)
    {
        Control c = Parent.Controls[i];

        // skip ...
        // ... invisible controls
        // ... or controls that have zero width/height (Autosize Labels without content!)
        // ... or controls that don't intersect with ourselves
        if (!c.Visible || c.Width == 0 || c.Height == 0 || !rect.IntersectsWith(new Rectangle(c.Left, c.Top, c.Width, c.Height)))
            continue;

        using (Bitmap b = new Bitmap(c.Width, c.Height, e.Graphics))
        {
            c.DrawToBitmap(b, new Rectangle(0, 0, c.Width, c.Height));

            tx = c.Left - Left;
            ty = c.Top - Top;

            // make adjustments to tx and ty here if your control
            // has a non-client area, borders or similar

            e.Graphics.TranslateTransform(tx, ty);
            e.Graphics.DrawImageUnscaled(b, new Point(0, 0));
            e.Graphics.TranslateTransform(-tx, -ty);
        }
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-27T02:05:48.480

我决定手动在我的子控件下简单地绘制父级。 [这是一篇好文章。](http://componentfactory.blogspot.com/2005/06/net2-transparent-controls.html)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-26T22:23:24.647

一些建议（为 VB 代码道歉）。

尽量避免绘制背景：

```
Protected Overrides Sub WndProc(ByRef m As System.Windows.Forms.Message)
    If m.Msg = &H14 Then
        Return
    End If
    MyBase.WndProc(m)
End Sub

Protected Overrides Sub OnPaintBackground(ByVal pevent As System.Windows.Forms.PaintEventArgs)
    Return
End Sub 
```

不要调用控件的基本绘制方法：

```
Protected Overrides Sub OnPaint(ByVal e As System.Windows.Forms.PaintEventArgs)
    'MyBase.OnPaint(e) - comment out - do not call
End Sub 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2013-08-08T23:47:51.050

这可以解决问题，至少它对我有用：

```
protected override void OnPaintBackground(PaintEventArgs e)
{
    //base.OnPaintBackground(e);
    this.CreateGraphics().DrawRectangle(new Pen(Color.Transparent, 1), new Rectangle(0, 0, this.Size.Width, this.Size.Height));
} 
```

# sql-server - 如何增加数据库文件？

> ID：592540
> 
> 赞同：1
> 
> 时间：2009-02-26T21:33:45.763
> 
> 标签：sql-server, database, tsql

我正在尝试使用以下代码来扩展数据库。但是我收到以下错误。我如何检查大小（3600MB）并在必要时增加它？

```
USING MyDatabase

ALTER DATABASE MyDatabase
MODIFY FILE (NAME =  MyDatabase_data, SIZE = 3600MB) 
```

错误：修改文件失败。指定大小小于或等于当前大小。

更新：由于交通繁忙，我没有使用 Auto Grow。由于我在这里的设置（长篇无关的故事），我需要使用代码进行更改。但是，如果此代码多次运行，我会收到上述错误。在再次尝试更改之前，我需要先检查尺寸。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T22:28:49.437

DB的大小将显示为

```
USE MyDatabase
EXEC sp_spaceused 
```

查看 sp_spaceused 的代码（我碰巧在查看 SQL 2000 服务器，但对于 SQL2005 / SQL2008 来说相同/相似）

```
USE master
EXEC sp_helptext 'sp_spaceused' 
```

相关代码是：

```
declare @dbsize dec(15,0)
declare @logsize dec(15)
declare @bytesperpage   dec(15,0)
declare @pagesperMB     dec(15,0)

    select @dbsize = sum(convert(dec(15),size))
        from dbo.sysfiles
        where (status & 64 = 0)

    select @logsize = sum(convert(dec(15),size))
        from dbo.sysfiles
        where (status & 64 <> 0)

    select @bytesperpage = low
        from master.dbo.spt_values
        where number = 1
            and type = 'E'
    select @pagesperMB = 1048576 / @bytesperpage

    select  database_name = db_name(),
        database_size =
            ltrim(str((@dbsize + @logsize) / @pagesperMB,15,2) + ' MB') 
```

因此，您可以将大小保存到变量并再次比较您尝试设置的大小：

```
DECLARE @database_size bigint
SELECT  @database_size = (@dbsize + @logsize) / @pagesperMB
IF @database_size < 3600
BEGIN
    PRINT 'Expanding MyDatabase ...'
    ALTER DATABASE MyDatabase
    MODIFY FILE (NAME =  MyDatabase_data, SIZE = 3600MB)
    PRINT 'Expanding MyDatabase DONE'
END
ELSE
BEGIN
    PRINT 'No expansion of MyDatabase required'
END 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T21:40:56.277

数据库将自动增长。如果您（无论如何是 MS SQL Server）右键单击数据库，属性。您可以将其设置为按百分比增长，例如 10%，或按固定大小增长，例如 100Mb。

您不需要自己维护数据库大小。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T21:46:11.553

MS SQL 分配的空间比它需要的多。因此，您实际使用的数据库大小通常远小于分配的大小。

MS SQL 分配的空间比它需要的更多，因为分配更多数据非常昂贵，并且定期执行而不是每次写入数据库时​​更有效。

如果您想更改一次分配多少空间，您可以使用**FILEGROWTH**参数来设置您希望在数据库上增长的文件类型。

一个值：

*   0 表示不允许增长
*   [X]MB 或 [X]GB 表示当您的数据库达到当前大小时增长那么多
*   [X]% 表示当你的数据库达到当前大小时增长那个百分比

.

```
ALTER DATABASE [databasename] MODIFY FILE ( NAME = N'databasename', FILEGROWTH = 1GB ) 
```

要释放额外分配的空间，您可以执行 DBCC SHRINKDATABASE

要获得数据库的实际大小，您可以执行以下操作：

```
SELECT size FROM sys.database_files WHERE name = 'databasename' 
```

要获取数据库日志的实际大小，您可以执行以下操作：

```
SELECT size FROM sys.database_files WHERE name = 'databasename_log' 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T21:47:14.093

要获取服务器上所有数据库文件的大小（和其他信息）（显然您可以过滤它）：

```
select * from sys.database_files 
```

# c# - 捕获资源字典中按钮的单击事件

> ID：592545
> 
> 赞同：0
> 
> 时间：2009-02-26T21:35:02.873
> 
> 标签：c#, wpf, xaml, wpf-controls

我正在尝试`Click`为 a 中的按钮捕获事件，`ResourceDictionary`但出现错误：

```
'WpfApplication1.MyResourceDictionary' does not contain a definition for 'GetTemplateChild' and no extension method 'GetTemplateChild' accepting a first argument of type 'WpfApplication1.MyResourceDictionary' could be found (are you missing a using directive or an assembly reference?) 
```

MyResourceDictionay.xaml.cs 如下所示：

```
namespace WindowsApplication1
{
  partial class MyResourceDictionary
  {
    public virtual void OnApplyTemplate()
    {
     Button myButton = this.GetTemplateChild("Crap") as Button;
    }
  }
} 
```

MyResourceDictionay.xaml 如下所示：

```
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
     x:Class="WindowsApplication1.MyResourceDictionary" 
     x:ClassModifier="public">

  <ControlTemplate x:Key="ExpandablePropertyEditorTemplate">
    <Button x:Name="Crap"  Foreground="White" Background="White">
      <Image Source="Controls\check.png"/>
    </Button>
  </ControlTemplate>
</ResourceDictionary> 
```

有什么帮助吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-09T15:02:40.947

如果您尝试在资源字典中进行搜索，您应该使用函数 FindName(string)，而不是 GetTemplateChild(string)。

即使您在当前控件的模板中搜索子控件，也应该使用 Template.FindName(string, Fr​​ameworkElement templatedParent) 而不是 GetTemplateChild(string)。

如果这没有帮助，请扩展您的描述。

如果您有代码隐藏文件，通常您可以在 XAML 中添加处理程序并将其附加到隐藏代码（即使控件在字典中，您也可以经常这样做）。

我希望这有帮助。

# ruby-on-rails - 为我的 Rails 应用程序创建自定义配置选项的最佳方式？

> ID：592554
> 
> 赞同：133
> 
> 时间：2009-02-26T21:37:11.247
> 
> 标签：ruby-on-rails, ruby, configuration, environment

我需要为我的 Rails 应用程序创建一个配置选项。对于所有环境，它可以是相同的。我发现如果我设置它`environment.rb`，它在我的视图中可用，这正是我想要的......

```
environment.rb

AUDIOCAST_URI_FORMAT = http://blablalba/blabbitybla/yadda 
```

效果很好。

不过，我有点不安。这是一个好方法吗？有没有更时髦的方法？

* * *

## 回答 #1

> 赞同：195
> 
> 时间：2009-02-26T21:47:38.600

对于不需要存储在数据库表中的一般应用程序配置，我喜欢在**config**目录中创建一个`config.yml`文件。对于您的示例，它可能如下所示：

 **```
defaults: &defaults
  audiocast_uri_format: http://blablalba/blabbitybla/yadda

development:
  <<: *defaults

test:
  <<: *defaults

production:
  <<: *defaults 
```

**此配置文件从config/initializers**中的自定义初始化程序加载：

```
# Rails 2
APP_CONFIG = YAML.load_file("#{RAILS_ROOT}/config/config.yml")[RAILS_ENV]

# Rails 3+
APP_CONFIG = YAML.load_file(Rails.root.join('config/config.yml'))[Rails.env] 
```

If you're using Rails 3, ensure you don't accidentally add a leading slash to your relative config path.

You can then retrieve the value using:

```
uri_format = APP_CONFIG['audiocast_uri_format'] 
```

See [this Railscast](http://railscasts.com/episodes/85) for full details.

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2011-01-18T13:18:46.223

Rails 3 version of initialiser code is as follows (RAILS_ROOT & RAILS_ENV are deprecated)

`APP_CONFIG = YAML.load_file(Rails.root.join('config', 'config.yml'))[Rails.env]`

Also, Ruby 1.9.3 uses Psych which makes merge keys case sensitive so you'll need to change your config file to take that into account, e.g.

```
defaults: &DEFAULTS
  audiocast_uri_format: http://blablalba/blabbitybla/yadda

development:
  <<: *DEFAULTS

test:
  <<: *DEFAULTS

production:
  <<: *DEFAULTS 
```

* * *

## 回答 #3

> 赞同：56
> 
> 时间：2016-07-16T13:59:55.217

**Rails >= 4.2**

Just create a `YAML` file into `config/` directory, for example: `config/neo4j.yml`.

Content of `neo4j.yml` can be somthing like below(For simplicity, I used default for all environments):

```
default: &default
  host: localhost
  port: 7474
  username: neo4j
  password: root

development:
  <<: *default

test:
  <<: *default

production:
  <<: *default 
```

in `config/application.rb`:

```
module MyApp
  class Application < Rails::Application
    config.neo4j = config_for(:neo4j)
  end
end 
```

Now, your custom config is accessible like below:

```
Rails.configuration.neo4j['host'] #=>localhost
Rails.configuration.neo4j['port'] #=>7474 
```

* * *

**More info**

Rails official API document describes `config_for` method as:

> Convenience for loading config/foo.yml for the current Rails env.

* * *

**If you do not want to use a `yaml` file**

As Rails official guide says:

> You can configure your own code through the Rails configuration object with custom configuration under the `config.x` property.

**Example**

```
config.x.payment_processing.schedule = :daily
config.x.payment_processing.retries  = 3
config.x.super_debugger = true 
```

> These configuration points are then available through the configuration object:

```
Rails.configuration.x.payment_processing.schedule # => :daily
Rails.configuration.x.payment_processing.retries  # => 3
Rails.configuration.x.super_debugger              # => true
Rails.configuration.x.super_debugger.not_set      # => nil 
```

* * *

[**Official Reference for `config_for` method**](http://api.rubyonrails.org/classes/Rails/Application.html#method-i-config_for) | [**Official Rails Guide**](http://guides.rubyonrails.org/v4.2/configuring.html#custom-configuration)

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2013-02-09T13:27:41.057

**Step 1:** Create config/initializers/appconfig.rb

```
require 'ostruct'
require 'yaml'

all_config = YAML.load_file("#{Rails.root}/config/config.yml") || {}
env_config = all_config[Rails.env] || {}
AppConfig = OpenStruct.new(env_config) 
```

**Step 2:** Create config/config.yml

```
common: &common
  facebook:
    key: 'asdjhasxas'
    secret : 'xyz'
  twitter:
    key: 'asdjhasxas'
    secret : 'abx'

development:
  <<: *common

test:
  <<: *common

production:
  <<: *common 
```

**Step 3:** Get constants anywhere in the code

```
facebook_key = AppConfig.facebook['key']
twitter_key  = AppConfig.twitter['key'] 
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2015-01-29T22:23:09.217

I just wanted to update this for the latest cool stuff in Rails 4.2 and 5, you can now do this inside any of your `config/**/*.rb` files:

```
config.x.whatever = 42 
```

(and that's a literal `x` in there, ie. the `config.x.` literally must be that, and then you can add whatever you want after the `x`)

...and this will be available in your app as:

```
Rails.configuration.x.whatever 
```

See more here: [http://guides.rubyonrails.org/configuring.html#custom-configuration](http://guides.rubyonrails.org/configuring.html#custom-configuration)

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-11-14T06:29:56.577

Just some extra info on this topic:

```
APP_CONFIG = YAML.load_file(Rails.root.join('config', 'config.yml'))[Rails.env].with_indifferent_access 
```

".with_indifferent_access" allows you to access the values in the hash using a string key or with an equivalent symbol key.

eg.
`APP_CONFIG['audiocast_uri_format'] => 'http://blablalba/blabbitybla/yadda'` `APP_CONFIG[:audiocast_uri_format] => 'http://blablalba/blabbitybla/yadda'`

Purely a convenience thing, but I prefer to have my keys represented as symbols.

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-08-11T16:11:17.040

I use something similar to John for Rails 3.0/3.1, but I have erb parse the file first:

```
APP_CONFIG = YAML.load(ERB.new(File.new(File.expand_path('../config.yml', __FILE__)).read).result)[Rails.env] 
```

This allows me to use ERB in my config if I need to, like reading heroku's redistogo url:

```
production:
  <<: *default
  redis:                  <%= ENV['REDISTOGO_URL'] %> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-03-20T19:14:40.750

`Rails 4`

To create a custom configuration yaml and load it (and make available to your app) similar to how `database_configuration`.

Create your `*.yml`, in my case I needed a redis configuration file.

`config/redis.yml`

```
default: &default
  host: localhost
  port: 6379

development:
  <<: *default

test:
  <<: *default

production:
  <<: *default
  host: <%= ENV['ELASTICACHE_HOST'] %>
  port: <%= ENV['ELASTICACHE_PORT'] %> 
```

Then load the configuration

`config/application.rb`

```
module MyApp
  class Application < Rails::Application

    ## http://guides.rubyonrails.org/configuring.html#initialization-events
    config.before_initialize do
      Rails.configuration.redis_configuration = YAML.load_file("#{Rails.root}/config/redis.yml")
    end

  end
end 
```

Access the values:

`Rails.configuration.redis_configuration[Rails.env]` similar to how you can have access to your `database.yml` by `Rails.configuration.database_configuration[Rails.env]`

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-01-02T17:18:13.450

Building on Omer Aslam's elegant solution, I decided to convert the keys into symbols. The only change is:

```
all_config = YAML.load_file("#{Rails.root}/config/config.yml").with_indifferent_access || {} 
```

This allows you to then reference values by symbols as keys, e.g.

```
AppConfig[:twitter][:key] 
```

This seems neater to my eyes.

(Posted as an answer as my reputation isn't high enough to comment on Omer's reply)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-03T22:58:47.467

I like [simpleconfig](http://github.com/lukeredpath/simpleconfig/tree/master). It allows you to have per environment configuration.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-11-08T21:16:19.077

see my response to [Where is the best place to store application parameters : database, file, code...?](https://stackoverflow.com/questions/566333/where-is-the-best-place-to-store-application-parameters-database-file-code/1697933#1697933)

A variation to what you had in that it's a simple reference to another file. It sees that environment.rb isn't constantly updated and doesn't have a heap of app specific stuff in it. Though not a specific answer to your question of 'is it the Rails way?', perhaps there'll be some discussion there about that.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-09-20T04:33:10.150

I prefer accessing settings through the global application stack. I avoid excess global variables in local scope.

**config/initializers/myconfig.rb**

```
MyAppName::Application.define_singleton_method("myconfig") {YAML.load_file("#{Rails.root}/config/myconfig.yml") || {}} 
```

And access it with.

```
MyAppName::Application.myconfig["yamlstuff"] 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-03-18T17:51:11.747

# My way to load Settings before Rails initialize

Allows you to use settings in Rails initialization and configure settings per environment

```
# config/application.rb
Bundler.require(*Rails.groups)

mode = ENV['RAILS_ENV'] || 'development'
file = File.dirname(__FILE__).concat('/settings.yml')
Settings = YAML.load_file(file).fetch(mode)
Settings.define_singleton_method(:method_missing) {|name| self.fetch(name.to_s, nil)} 
```

You could get settings in two ways: **Settings['email']** or **Settings.email**

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-04-07T07:15:48.120

My best way to custom config, with raise message when setting.yml is missing.

gets loaded from a custom initializer in config/initializers/custom_config.rb

```
setting_config = File.join(Rails.root,'config','setting.yml')
raise "#{setting_config} is missing!" unless File.exists? setting_config
config = YAML.load_file(setting_config)[Rails.env].symbolize_keys

@APP_ID = config[:app_id]
@APP_SECRET = config[:app_secret] 
```

Create a YAML in config/setting.yml

```
development:
  app_id: 433387212345678
  app_secret: f43df96fc4f65904083b679412345678

test:
  app_id: 148166412121212
  app_secret: 7409bda8139554d11173a32222121212

production:
  app_id: 148166412121212
  app_secret: 7409bda8139554d11173a32222121212 
```

# iis - 在 IIS7 中跨 2 个子域共享单个应用程序

> ID：592560
> 
> 赞同：0
> 
> 时间：2009-02-26T21:38:25.860
> 
> 标签：iis, configuration, iis-7

我有一个当前部署的应用程序（例如 www.example.com ）。但是，现在我们有一个“安全”子域，它将接收所有需要加密的请求（例如 secure.example.com）。位于 www.example.com 的站点当前映射到 C:\inetpub\example.com\wwwroot\，我已将 secure.example.com 映射到 C:\inetpub\example.com\wwwroot\secure。

但是，由于在 IIS 管理器中将 secure.example.com 设置为新网站，当访问安全站点时，它会显示错误，因为没有与该网站关联的 web.config；但是，这是我想要的方式，因为我希望它成为父目录中应用程序的一部分。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T21:44:35.393

我认为您真正要做的只是右键单击 example.com 的网站并编辑绑定。在那里，您可以将主机名添加到该站点。

确保为 SSL 端口 443 添加它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T21:42:51.543

将两个 IIS 虚拟目录/网站映射到同一目录，并检查它们是否都使用相同的 IIS 应用程序名称。

（没有试过这个，但不记得看到任何说它不起作用的东西。）

# javascript - 可以在没有画布或 AJAX 的情况下通过 JavaScript 旋转图像吗？

> ID：592575
> 
> 赞同：2
> 
> 时间：2009-02-26T21:42:38.473
> 
> 标签：javascript, image-rotation

我见过一些 JavaScript 图像旋转器，它们使用 HTML5 画布元素或对服务器端脚本的 AJAX 调用，但是否可以不使用这些方法来做到这一点？Internet Explorer 不支持画布（我知道 excanvas，但如果可能的话我想不支持），我不确定 AJAX 是否足够流畅。如果有办法，是否有任何开源脚本、示例或资源可以指点我？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T21:52:33.160

唉，CSS 不支持以任何方式、形状或形式旋转图像（除非您计算[CSS 变换](http://webkit.org/blog/130/css-transforms/)，它仅受 Safari 4 和 Firefox 3.1 支持）。

最好的办法是使用[Raphael](http://raphaeljs.com)的 image() 和 rotate()，它们应该支持所有半现代浏览器（使用 SVG）和大多数版本的 IE（使用 VML）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T21:54:59.533

此 jQuery 插件适用于主要浏览器，包括 IE：[http](http://wilq32.googlepages.com/wilq32.rollimage222) ://wilq32.googlepages.com/wilq32.rollimage222 。它使用了 excanvas，但至少它允许您评估该方法是否足以满足您的目的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2018-09-11T05:07:43.150

是的，通过 CSS 转换：

```
 var degree=180;
 document.getElementById('image_name').style.transform='rotate('+degree+'deg)'; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T21:53:12.643

谷歌是你的朋友： [http ://www.walterzorn.com/rotate_img/rotate_img.htm](http://www.walterzorn.com/rotate_img/rotate_img.htm)

但是这种技术的缺点（如前所述）是它通过插入大量 DIVS 来使用 hack，因此它可能会降低浏览器的速度。谨慎使用。像这样的问题是为什么首先创建画布标签的原因。

# c - 快速的服务器端图像生成库？

> ID：592579
> 
> 赞同：1
> 
> 时间：2009-02-26T21:43:28.440
> 
> 标签：c, linux, image, haxe, neko

对于一个网络项目，我需要能够非常快速地生成 jpg 和动画 gif 图像。作为服务器平台，我将使用 Linux 和[`NekoVM`](http://nekovm.org/)（通过 apache 后面`mod_tora`）。由于没有用于图像生成的库，[`Haxe`](http://haxe.org)我`neko`即将编写一个自己的库。

`Neko`本身是`c`用`c`. 目前我们正在使用 arround [`libGD`](http://www.libgd.org)，它提供了我们需要的所有功能（调整大小、采样、复制图像、添加文本、另存为 jpeg 或动画 gif），当然还有很多我们不需要的东西。

目前这很好用，但似乎有点慢。是否有另一个流行的开放库，我可以尝试将其用于我的目的（而且可能更快）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T22:11:48.900

你试过[Magick++](http://www.imagemagick.org/Magick++/)和/或[MagickCore](http://www.imagemagick.org/api/MagickCore/index.html)吗？

下一个最好的选择是在 pprof 下运行 NekoVM 以确定 libGD 中哪些函数成本最高，并尝试通过更改调用代码来避免或优化对这些函数的使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T00:12:24.900

有[imlib2](http://docs.enlightenment.org/api/imlib2/html/)，我怀疑它是否支持动画 gif。

# language-agnostic - 解析和格式化搜索结果

> ID：592581
> 
> 赞同：3
> 
> 时间：2009-02-26T21:43:50.700
> 
> 标签：language-agnostic, parsing, formatting, search-engine, code-golf

> **搜索：**
> 
> 脚本+语言 Web+页面应用程序
> 
> **结果：**
> 
> ...**脚本语言**最初...产生动态**网页**。它具有...图形**应用程序**...目的**脚本语言**是...d 创建**网页**作为输出...

假设我想要一个值来表示允许在匹配项的任一侧填充的字符数量，另一个值表示结果中将显示多少匹配项（即，我只想查看前 5 个匹配项，而已）。

*你*会怎么做呢？

这与语言无关，但我将在 PHP 环境中实现该解决方案，因此请将答案限制在不需要特定语言或框架的选项上。

**这是我的思考过程：**从搜索词创建一个数组。确定哪个搜索词具有关于它在文章正文中的位置的最低索引。将正文的那部分收集到另一个变量中，然后从文章正文中删除该部分。返回到第 1 步。您甚至可以为每个单词添加一个计数器，当计数器达到 3 左右时跳过它。

**重要的：**

解决方案必须以非线性方式匹配所有搜索项。意思是，如果术语一存在于术语二之后，则它应该在术语二之后找到。同样，它也应该在第 3 学期之后找到。如果恰好在它们之前存在，则应在术语 1 和 2 之前找到术语 3。

该解决方案应允许我声明“每个术语最多允许三个匹配项，然后终止摘要。”

**额外学分：**

获取填充变量以可选地填充单词，而不是字符。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-09T17:31:46.347

我的思考过程：

1.  创建一个支持非唯一名称/值对的结果数组（PHP 在其标准`array`对象中支持这一点）
2.  循环遍历每个搜索词并在搜索文本中找到其字符起始位置
3.  将一个项目添加到结果数组中，以存储它刚刚找到的这个字符位置，并以实际搜索词作为键
4.  找到所有搜索词后，按值升序对数组进行排序（搜索词的字符位置）
5.  现在，搜索结果将按照在搜索文本中找到的顺序排列
6.  遍历结果数组并使用指定的单词填充来获取搜索词每一侧的单词，同时还跟踪单独的名称/值对中的单词计数

伪代码，或者我最好的尝试：

```
function string GetSearchExcerpt(searchText, searchTerms, wordPadding = 0, searchLimit = 3)
{
  results = new array()
  startIndex = 0
  foreach (searchTerm in searchTerms) 
  {
    charIndex = searchText.FindByIndex(searchTerms, startIndex) // finds 1st position of searchTerm starting at startIndex
    results.Add(searchTerm, charIndex)
    startIndex = charIndex + 1
  }
  results = results.SortByValue()
  lastSearchTerm = ""
  searchTermCount = new array()
  outputText = ""
  foreach (searchTerm => charIndex in results)
  {
    searchTermCount[searchTerm]++
    if (searchTermCount[searchTerm] <= searchLimit)
    {
      // WordPadding is a simple function that moves left or right a given number of words starting at a specified character index and returns those words
      outputText += "..." + WordPadding(-wordPadding, charIndex) + "<strong>" + searchTerm + "</strong>" + WordPadding(wordPadding, charIndex)
    }
  }

  return outputText
} 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-09T17:31:02.040

就我个人而言，我会将搜索词转换为正则表达式，然后使用 Regex Find-Replace 将匹配项包装在强标签中以进行格式化。

RegEx 路线很可能是您的最佳选择。因此，在您的示例中，您最终将获得三个单独的 RegEx 值。

由于您想要一个不依赖于语言的解决方案，因此我不会将实际表达式放在这里，因为确切的语法因语言而异。

# compiler-construction - 什么是“Lambda 提升”？

> ID：592584
> 
> 赞同：40
> 
> 时间：2009-02-26T21:44:42.553
> 
> 标签：compiler-construction, functional-programming

我在浏览 Erlang 编译器源代码时遇到了这个问题。

我真的不明白。（去图；）），考虑到我在 5 分钟前才意识到有这样的事情）。

请原谅我在没有首先尝试了解它存在的原因的情况下先提出来。

有一篇关于它的[维基百科文章](http://en.wikipedia.org/wiki/Lambda_lifting)，但它非常神秘。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-02-26T21:49:29.487

Lambda 提升用于将闭包转换为纯函数。通过向函数传递额外的参数，可以减少其自由变量的数量。当您将 lambda 提升到越来越高的范围时，您添加参数以适应在该范围内声明的局部变量（否则将是自由变量）。一旦 lambda 没有自由变量，它就是一个纯粹的“顶级”函数。

当然，如果您知道所有 lambda 的调用站点，则只能这样做；换句话说，只有当 lambda 没有转义时。

编译器优化器的好处是可以消除闭包（函数环境）。这可能使得在寄存器中传递参数而不是堆栈（或堆）将它们分配为自由变量成为可能。

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2009-02-26T21:57:09.140

Lambda 提升是一种将 lambda 提升到更高级别（主要是顶层）的技术。

Doug Currie 描述了您为什么要这样做。

以下是一些示例代码（在 JavaScript 中），说明如何手动执行此操作：

```
function addFive(nr)
{
  var x = 5;
  function addX(y)
  {
    return x + y;
  }

  return addX(nr);
} 
```

现在，如果您不希望`addX`在定义中使用此函数，则`addFive`可以将其“提升”到顶层，如下所示：

```
function addX(y)
{
  return x + y;
}

function addFive(nr)
{
  var x = 5;

  return addX(nr);
} 
```

但是，这不起作用，因为该变量在函数`x`的上下文中不再可用。`addX`解决这个问题的方法是在函数中添加一个额外的形参：

```
function addX(y, x)
{
  return x + y;
}

function addFive(nr)
{
  var x = 5;

  return addX(nr, x);
} 
```

* * *

**加法：**这是一个非常人为的 lambda `escaping' 示例。您将无法像我描述的那样轻松地进行 lambda 提升。

```
function getAddFiveFunc()
{
  var x = 5;
  function addX(y)
  {
    return x + y;
  }

  return addX;
} 
```

现在，如果有人调用该`getAddFiveFunc`函数，他们将返回一个函数。该功能可以在各种地方使用，现在，如果您确实想解除该`addX`功能，则必须更新所有这些调用站点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T04:08:47.700

警告：我的回答实际上描述了与 lambda 提升不同的捕获变量。误读了问题（需要睡觉）。但是我花了一点时间写这篇文章，所以我不愿意删除它。将其作为社区 WIKI 保留。

Lambda 提升，通常称为闭包，是一种允许从嵌套的 lambda 表达式中无缝访问范围内变量的方法。

如果不选择特定的语言，很难深入了解闭包的细节。在任何语言中，lambda 提升的副作用之一是它倾向于将变量的生命周期从局部的、短命的范围延长到更长的范围。这通常以将变量从堆栈传输到编译器内的堆的形式发生。这是一个非常特定于语言的操作，因此会根据语言产生非常不同的实现。

我将专注于 C#，因为这可能是堆栈溢出读者最常用的语言。让我们从下面的代码开始。

```
public Func<int> GetAFunction() {
  var x = 42;
  Func<int> lambda1 = () => x;
  Func<int> lambda2 = () => 42;
  ...
  return lambda1;
} 
```

在这个例子中，我们创建了 2 个 lambda 表达式。在这两种情况下，它都被分配给 Func 类型的委托实例。.Net 中的所有代表都需要一个真正的函数在某个地方支持它们。因此，在底层，C# 中的所有 lambda 表达式/匿名函数都被转换为方法定义。

为 lambda2 生成一个函数非常简单。它是一个孤立的函数，只返回一个常量值。

```
public static int RealLambda2() { 
  return 42;
} 
```

生成 lambda1 相当困难。文字定义如下所示

```
public static int RealLambda1() {
  return x;
} 
```

这显然不会编译，因为 x 不可访问。为了完成这项工作，C# 编译器必须**将变量 x 提升**到闭包中。然后它可以返回一个指向闭包内函数的指针以满足委托表达式

```
class Closure1 {
  int x;
  public int RealLambda1() {
    return x;
  }
} 
```

这是一个非常简单的例子，但希望能详细说明提升的艺术。不幸的是，魔鬼在细节中，并且在场景中变得更加复杂。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T21:51:08.950

lambda lift 基本上消除了变量并将它们放入纯函数中，简化了执行。

# php - 提高 cURL 性能（PHP 库）

> ID：592594
> 
> 赞同：0
> 
> 时间：2009-02-26T21:47:43.327
> 
> 标签：php, curl, performance

这是我正在做的事情的简要概述，实际上非常简单：

*   出去从数据库表中获取记录。
*   遍历所有这些记录，并为包含 URL 的每一列输出（使用 cURL）并确保 URL 仍然有效。
*   对于每条记录，都会使用当前时间戳更新一列，该时间戳指示上次检查的时间以及发生其他一些数据库处理的时间。

无论如何，这一切都很好，很好，并且完全符合它的预期。问题是我认为就我如何使用 cURL 验证 URL 而言，性能可以*大大*提高。

这是我的代码的简短（过于简化）摘录，演示了如何使用 cURL：

```
$ch = curl_init();
while($dbo = pg_fetch_object($dbres))
{
   // for each iteration set url to db record url
   curl_setopt($ch, CURLOPT_URL, $dbo->url);
   curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
   curl_exec($ch); // perform a cURL session
   $ihttp_code = intval(curl_getinfo($ch, CURLINFO_HTTP_CODE));
   // do checks on $ihttp_code and update db
}
// do other stuff here
curl_close($ch); 
```

正如您所看到的，我一直在重复使用相同的 cURL 句柄，但即使我去掉所有处理（数据库或其他），脚本仍然需要非常长的时间才能运行。更改任何 cURL 选项是否有助于提高性能？调整超时值/等？任何输入将不胜感激。

谢谢，

*   尼古拉斯

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-26T22:29:05.287

将 CURLOPT_NOBODY 设置为 1（请参阅[curl 文档](http://curl.haxx.se/libcurl/c/curl_easy_setopt.html#CURLOPTNOBODY)）告诉 curl 不要询问响应的正文。这将联系 Web 服务器并发出 HEAD 请求。响应代码会告诉您 URL 是否有效，并且不会将大量数据传回。

如果这仍然太慢，那么通过运行 N 个线程（或进程），每个线程（或进程）都执行 1/N 的工作，您可能会看到巨大的改进。瓶颈可能不在您的代码中，而在远程服务器的响应时间中。如果它们响应缓慢，那么您的循环将运行缓慢。

# wcf - WCF 服务 - 运行时看不到接口上的 ServiceContract

> ID：592604
> 
> 赞同：15
> 
> 时间：2009-02-26T21:50:19.967
> 
> 标签：wcf, binding, interface, service, servicehost

我是 WCF 的新手，并试图让我的第一个服务运行。我很接近但坚持这个问题。

在我的接口定义文件中，我有这个：

```
[ServiceContract(Namespace="http://mysite.com/wcfservices/2009/02")]       
    public interface IInventoryService
    {
        [OperationContract]
        string GetInventoryName(int InventoryID);
    } 
```

然后我有继承它的类文件（用于服务）：

```
 public class InventoryService : IInventoryService
    {
        // This method is exposed to the wcf service
        public string GetInventoryName(int InventoryID)
        {
            return "White Paper";
        } 
```

最后，在我的主机项目中，我有这个：

```
 ServiceHost host = new ServiceHost(typeof(Inventory.InventoryService));
    host.AddServiceEndpoint(typeof(Inventory.InventoryService), new NetTcpBinding(),
        "net.tcp://localhost:9000/GetInventory");
    host.Open(); 
```

一切都编译得很好，当主机去添加服务端点时，它会爆炸：“合同类型 Inventory.InventoryService 没有使用 ServiceContractAttribute 属性。为了定义有效的合同，指定的类型（合同接口或服务）类）必须使用 ServiceContractAttribute 进行属性化。”

我知道我在这里遗漏了一些简单的东西。我将接口明确标记为服务合同，并且在 Host 项目中有对该项目的引用。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-26T21:54:07.523

```
ServiceHost host = new ServiceHost(typeof(Inventory.InventoryService));
host.AddServiceEndpoint(typeof(Inventory.InventoryService), new NetTcpBinding(),
    "net.tcp://localhost:9000/GetInventory");
host.Open(); 
```

如果您的 ServiceContract 属性位于 Interface 而不是具体类上，请尝试以下操作：

```
ServiceHost host = new ServiceHost(typeof(Inventory.InventoryService));
host.AddServiceEndpoint(typeof(Inventory.IInventoryService), new NetTcpBinding(),
    "net.tcp://localhost:9000/GetInventory");
host.Open(); 
```

# ruby-on-rails - 使用 ActiveRecord 在派生类中查找方法 - 单表继承

> ID：592605
> 
> 赞同：0
> 
> 时间：2009-02-26T21:50:24.570
> 
> 标签：ruby-on-rails, activerecord

我有一个派生自 ActiveRecord::Base 的类。该类有一个子类，在数据库中通过类型 id 列进行区分。如何确保派生类中所有继承的活动记录函数都将 type_id 列附加到派生类执行的任何查询的条件散列中？是否有任何类型的“之前”函数可以重写以将条件注入派生类的进程？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-26T22:13:53.310

如果您的列被称为“类型”，ActiveRecord 会自动为您执行此操作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T08:41:21.663

您所做的称为单表继承 (STI)。这就是 Radar 所说的关于您的专栏被称为 type 的原因。

# javascript - Firebug 是否有内置功能可以禁用站点/页面的所有 javascript？

> ID：592607
> 
> 赞同：13
> 
> 时间：2009-02-26T21:50:40.387
> 
> 标签：javascript, firebug

Firebug 是否有内置功能可以禁用站点/页面的所有 javascript？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-26T21:52:22.847

从来没听说过。但是您可以使用[Web 开发人员工具栏](https://addons.mozilla.org/en-US/firefox/addon/60)或[noscript](https://addons.mozilla.org/en-US/firefox/addon/722)插件来执行此操作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-04-29T18:18:46.210

在 Firefox 4 中，您可以在选项对话框的内容选项卡中禁用 javascript。

只需取消选中“启用 Javascript”即可。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-26T21:56:27.847

我会看看noscript。此外，萤火虫的人（我认为是约翰巴顿的名字）非常敏感，因此如果您想要一个功能，请将其发布在 google 组或错误/增强跟踪器上。我不认为它目前有这个功能，但看看 1.4 分支（目前在 Alpha 中），它可能（不知道）包含这样的东西。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T21:53:02.237

[您可以使用Web Developer Toolkit](https://addons.mozilla.org/en-US/firefox/addon/60)的 Firefox 插件

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2011-04-09T16:38:59.127

如果您想专门使用 Firebug（而不是 noscript），Firebug 有一个名为 Code Stepper 的内置调试器，非常适合您尝试完成的工作。

这是一篇文章，解释了如何利用调试功能来控制 JavaScript 的流程。

[http://fixunix.com/mozilla/407230-how-write-simple-debugger-code-stepper-will-just-allownormal-steps-without-other-fancy-features.html](http://fixunix.com/mozilla/407230-how-write-simple-debugger-code-stepper-will-just-allownormal-steps-without-other-fancy-features.html)

# asp.net - 如何将'System.Xml.Linq.XElement'类型的属性值设置为TextBox.Text？

> ID：592611
> 
> 赞同：0
> 
> 时间：2009-02-26T21:51:13.413
> 
> 标签：asp.net, xml, linq

我有一个 Linq 对象，它有一个类型为“System.Xml.Linq.XElement”的字段。当绑定到 Gridview 时，此 XML 会正确显示为文本。但是，当我尝试编辑该行并更新 Linq 对象时，出现错误：

无法将参数“CustomData”的值从“System.String”转换为“System.Xml.Linq.XElement”。

启用将 XML 文档编辑为文本并通过行更新将其返回而不会出现此错误的最简单方法是什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T11:22:34.573

就像是：

```
MyTextBox.Text = MyXElement.Value 
```

??

马克

# asp.net - 如何：在 ASP.NET 自定义服务器控件中使用 AJAX

> ID：592614
> 
> 赞同：4
> 
> 时间：2009-02-26T21:51:51.727
> 
> 标签：asp.net, ajax, custom-server-controls

有谁知道一个很好的教程，它演示了在自定义 ASP.NET 服务器控件中使用现有的 AJAX 控件扩展器？

我不想构建“自定义 AJAX 服务器控件”。我想构建一个使用现有 AJAX 控件扩展器的自定义服务器控件。

我想将一个 asp:TextBox、asp:ImageButton、asp:CustomValidator（与来自嵌入式资源的客户端 javascript）和一个 ajax:CalendarExtender 组合到一个自定义服务器控件中。或者这已经被创建了？

任何帮助将不胜感激。谢谢。

更新：基本上，我想创建一个具有 ajax:CalendarExtender 作为子控件的 CompositeControl。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-08T15:31:18.827

听起来您所追求的是复合控件。它们与用户控件几乎完全一样，只是而不是使用 ascx 文件来创建您以编程方式创建的控件。与使用用户控件相比，这样做的最大优势是您最终可以将一些东西放入程序集中并在不同的项目中使用。

复合控件可以从 Control 或 WebControl 继承。我个人通常发现 Control 更适合继承，因为我通常不需要从 WebControl 获得的大量额外内容，例如样式属性，因为我通常只通过单个 CssClass 属性进行样式设置。

您还需要确保您的类实现了 INamingContainer 接口。如果控件在同一个父容器中多次使用，这将确保每个子控件将自动获得唯一的名称。

创建复合控件时最重要的事情是重写 Control 的 CreateChildControls 方法。实际创建控件的所有逻辑都应该放在这里。该框架将自动确保在页面生命周期中的正确时间调用它。

这是一个小例子：

```
public class MyCompositeControl : Control, INamingContainer
{
    protected override void CreateChildControls()
    {
        Controls.Clear();

        var textbox = new TextBox();
        textbox.ID = "TextBox1";
        Controls.Add(textbox);
        if (!Page.IsPostBack || !IsTrackingViewState)
        {
            // make sure you set the properties after
            // you add it to the parent or the viewstate
            // won't save properly
            textbox.MaxLength = 30;
        }

        var button = new Button();
        button.ID = "Button1";
        Controls.Add(button);
        if (!Page.IsPostBack || !IsTrackingViewState)
        {
            button.Text = "Save";
        }
    }
} 
```

我不认为 ASP.NET AJAX 应该这么复杂。我唯一能想到的是，您需要确保在将添加复合控件的任何页面上创建一个 ScriptManager。

在 MSDN 网站上有一个[完整的例子](http://msdn.microsoft.com/en-us/library/aa719734(VS.71).aspx)。[这个博客](http://weblogs.asp.net/asmith/archive/2004/03/10/87494.aspx)上有另一个很好的例子。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T22:16:03.790

您想要的是构建一个用户控件，而不是最有可能的自定义控件。用户控件是复合控件，而自定义控件是从头开始构建的控件，也可以从基本控件派生。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-06T00:21:11.997

我建议你在 MSDN 上搜索。在过去的一两年里，我在他们的杂志上看到了几篇关于该主题的好文章，这些文章相当透彻。但是我没有指向它们的链接，而且我懒得用谷歌搜索你。:\

# bash - 如何从 Bash 脚本中检查程序是否存在？

> ID：592620
> 
> 赞同：2695
> 
> 时间：2009-02-26T21:52:49.460
> 
> 标签：bash

我将如何验证程序是否存在，以返回错误并退出或继续执行脚本的方式？

看起来应该很容易，但它一直困扰着我。

* * *

## 回答 #1

> 赞同：3821
> 
> 时间：2009-03-24T12:45:20.057

## 回答

POSIX 兼容：

```
command -v <the_command> 
```

示例使用：

```
if ! command -v <the_command> &> /dev/null
then
    echo "<the_command> could not be found"
    exit
fi 
```

对于 Bash 特定环境：

```
hash <the_command> # For regular commands. Or...
type <the_command> # To check built-ins and keywords 
```

## 解释

避免`which`。它不仅是您启动的一个外部进程，它只做很少的事情（`hash`意味着`type`像`command`.系统到系统。

为什么关心？

*   许多操作系统都有一个**甚至没有设置退出状态**，这意味着它`which`甚至不会在那里工作并且**总是**会报告它存在，即使它不存在（请注意，一些 POSIX shell 似乎也这样做）。**`if which foo`**`foo``hash`****
*****   许多操作系统会`which`做一些自定义和邪恶的事情，例如更改输出甚至挂钩到包管理器。****

 ****所以，不要使用`which`. 而是使用其中之一：

```
$ command -v foo >/dev/null 2>&1 || { echo >&2 "I require foo but it's not installed.  Aborting."; exit 1; }
$ type foo >/dev/null 2>&1 || { echo >&2 "I require foo but it's not installed.  Aborting."; exit 1; }
$ hash foo 2>/dev/null || { echo >&2 "I require foo but it's not installed.  Aborting."; exit 1; } 
```

（小旁注：有些人会建议`2>&-`相同`2>/dev/null`但更短 -*这是不正确的*。 `2>&-`关闭 FD 2 会导致程序在尝试写入 stderr 时**出错**，这与成功写入并丢弃输出非常不同（而且很危险！））

如果您的哈希爆炸是`/bin/sh`那么您应该关心 POSIX 所说的内容。`type`and`hash`的退出代码没有被 POSIX 很好地定义，并且`hash`当命令不存在时可以看到成功退出（还没有看到这个`type`）。 `command`的退出状态由 POSIX 明确定义，因此使用起来可能是最安全的。

但是，如果您的脚本使用`bash`，POSIX 规则就不再重要了，并且两者都可以`type`完全`hash`安全地使用。`type`现在有一个`-P`只搜索`PATH`并且`hash`具有命令的位置将被散列的副作用（以便下次使用它时更快地查找），这通常是一件好事，因为您可能会检查它的存在以便实际使用它.

`gdate`作为一个简单的例子，这是一个如果存在则运行的函数，否则`date`：

```
gnudate() {
    if hash gdate 2>/dev/null; then
        gdate "$@"
    else
        date "$@"
    fi
} 
```

# 具有完整功能集的替代方案

您可以使用[scripts-common](https://gitlab.com/bertrand-benoit/scripts-common)来满足您的需求。

要检查是否安装了某些东西，您可以执行以下操作：

```
checkBin <the_command> || errorMessage "This tool requires <the_command>. Install it please, and then run this tool again." 
```

* * *

## 回答 #2

> 赞同：709
> 
> 时间：2014-11-05T14:33:50.873

以下是检查命令是否存在`$PATH` *并且*是否可执行的可移植方法：

```
[ -x "$(command -v foo)" ] 
```

例子：

```
if ! [ -x "$(command -v git)" ]; then
  echo 'Error: git is not installed.' >&2
  exit 1
fi 
```

需要执行可执行检查，因为如果在`$PATH`.

另请注意，如果在前面存在与可执行文件同名的不可执行文件，则`$PATH`dash 返回前者，即使后者会被执行。这是一个错误，违反了 POSIX 标准。[[错误报告](https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=874264)] [[标准](http://pubs.opengroup.org/onlinepubs/009696899/utilities/command.html)]

此外，如果您要查找的命令已被定义为别名，这将失败。

* * *

## 回答 #3

> 赞同：223
> 
> 时间：2011-01-24T18:16:07.663

我同意 lhunath 不鼓励使用，他的解决方案*对 Bash 用户*`which`完全有效。但是，为了更便携，应改为使用：*`command -v`*

 *```
$ command -v foo >/dev/null 2>&1 || { echo "I require foo but it's not installed.  Aborting." >&2; exit 1; } 
```

命令`command`符合 POSIX。有关其规范，请参见此处：*[命令 - 执行一个简单的命令](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/command.html)*

注意：`type`是 POSIX 兼容的，但`type -P`不是。

* * *

## 回答 #4

> 赞同：98
> 
> 时间：2009-02-26T22:01:52.967

这取决于您是否想知道它是否存在于`$PATH`变量中的某个目录中，或者您是否知道它的绝对位置。如果您想知道它是否在`$PATH`变量中，请使用

```
if which programname >/dev/null; then
    echo exists
else
    echo does not exist
fi 
```

否则使用

```
if [ -x /path/to/programname ]; then
    echo exists
else
    echo does not exist
fi 
```

第一个示例中的重定向`/dev/null/`抑制了`which`程序的输出。

* * *

## 回答 #5

> 赞同：98
> 
> 时间：2010-10-14T09:24:40.680

我在我的 .bashrc 中定义了一个函数，使这更容易。

```
command_exists () {
    type "$1" &> /dev/null ;
} 
```

这是一个如何使用它的例子（来自我的`.bash_profile`。）

```
if command_exists mvim ; then
    export VISUAL="mvim --nofork"
fi 
```

* * *

## 回答 #6

> 赞同：43
> 
> 时间：2015-12-07T21:17:24.093

扩展@lhunath 和@GregV 的答案，下面是那些想要轻松地将检查放入`if`语句中的人的代码：

```
exists()
{
  command -v "$1" >/dev/null 2>&1
} 
```

以下是如何使用它：

```
if exists bash; then
  echo 'Bash exists!'
else
  echo 'Your system does not have Bash'
fi 
```

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2009-02-26T21:57:18.233

尝试使用：

```
test -x filename 
```

或者

```
[ -x filename ] 
```

从[条件表达式](http://www.gnu.org/software/bash/manual/html_node/Bash-Conditional-Expressions.html)下的 Bash 手册页：

> ```
>  -x file
>           True if file exists and is executable. 
> ```

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2011-06-24T17:01:08.450

[正如@lhunath 建议](https://stackoverflow.com/questions/592620/check-if-a-program-exists-from-a-bash-script/677212#677212)`hash`的那样，在 Bash 脚本中使用：

```
hash foo &> /dev/null
if [ $? -eq 1 ]; then
    echo >&2 "foo not found."
fi 
```

此脚本运行`hash`，然后检查最新命令的退出代码（存储在 中的值`$?`）是否等于`1`。如果`hash`未找到`foo`，则退出代码为`1`。如果`foo`存在，退出代码将为`0`.

`&> /dev/null`重定向[标准错误](https://en.wikipedia.org/wiki/Standard_streams#Standard_error_(stderr))和[标准输出](https://en.wikipedia.org/wiki/Standard_streams#Standard_output_.28stdout.29)，`hash`使其不会出现在屏幕上并将`echo >&2`消息写入标准错误。

* * *

## 回答 #9

> 赞同：13
> 
> 时间：2018-06-25T16:53:46.527

`-v`如果为要测试的 POSIX_BUILTINS 选项设置了命令，则命令可以正常工作`<command>`，但如果没有，它可能会失败。（它已经为我工作了多年，但我最近遇到了一个它不起作用的地方。）

我发现以下内容更防故障：

```
test -x "$(which <command>)" 
```

因为它测试三件事：路径、存在和执行权限。

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2018-06-19T12:02:30.930

这里有很多选择，但我很惊讶没有快速的单线。这是我在脚本开始时使用的：

```
[[ "$(command -v mvn)" ]] || { echo "mvn is not installed" 1>&2 ; exit 1; }
[[ "$(command -v java)" ]] || { echo "java is not installed" 1>&2 ; exit 1; } 
```

这是基于此处选择的答案和另一个来源。

* * *

## 回答 #11

> 赞同：10
> 
> 时间：2013-07-08T15:14:30.027

如果您检查程序是否存在，您可能会在以后运行它。为什么不首先尝试运行它？

```
if foo --version >/dev/null 2>&1; then
    echo Found
else
    echo Not found
fi 
```

与仅查看 PATH 目录和文件权限相比，检查程序是否运行更可靠。

另外，您可以从您的程序中获得一些有用的结果，例如它的版本。

当然，缺点是有些程序启动起来很繁重，有些程序没有`--version`立即（并成功）退出的选项。

* * *

## 回答 #12

> 赞同：9
> 
> 时间：2014-03-23T10:09:29.267

**检查多个依赖项并将状态通知最终用户**

```
for cmd in latex pandoc; do
  printf '%-10s' "$cmd"
  if hash "$cmd" 2>/dev/null; then
    echo OK
  else
    echo missing
  fi
done 
```

样本输出：

```
latex     OK
pandoc    missing 
```

将 调整`10`为最大命令长度。它不是自动的，因为我没有看到非详细的 POSIX 方法： *[如何在 Bash 中对齐空格分隔表的列？](https://stackoverflow.com/questions/6602732/realign-columns-of-file-in-bash)*

**检查是否`apt`安装了某些软件包，`dpkg -s`否则安装它们**。

请参阅：*[检查是否安装了 apt-get 包，如果不在 Linux 上则安装它](https://stackoverflow.com/questions/1298066/check-if-an-apt-get-package-is-installed-and-then-install-it-if-its-not-on-linu/54239534#54239534)*

之前在：*[如何从 Bash 脚本中检查程序是否存在？](https://stackoverflow.com/questions/592620/how-can-i-check-if-a-program-exists-from-a-bash-script/2075386#2075386)*

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2009-07-11T18:38:17.467

我从来没有得到以前的答案来处理我可以访问的盒子。一方面，`type`已经安装（做什么[`more`](https://en.wikipedia.org/wiki/More_(command))）。所以需要内置指令。这个命令对我有用：

```
if [ `builtin type -p vim` ]; then echo "TRUE"; else echo "FALSE"; fi 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2014-07-21T00:13:17.400

**`hash foo 2>/dev/null`**：适用于 Z shell (Zsh)、Bash、[Dash](https://en.wikipedia.org/wiki/Almquist_shell#dash:_Ubuntu,_Debian_and_POSIX_compliance_of_Linux_distributions)和[ash](https://en.wikipedia.org/wiki/Almquist_shell)。

`type -p foo`：它似乎适用于 Z shell、Bash 和 ash（[BusyBox](https://en.wikipedia.org/wiki/BusyBox)），但不适用于 Dash（它解释`-p`为参数）。

`command -v foo`: 适用于 Z shell、Bash、Dash，但不适用于 ash (BusyBox) ( `-ash: command: not found`)。

另请注意，这`builtin`不适用于 ash 和 Dash。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2009-03-24T11:23:20.193

如果可以，请使用 Bash 内置函数：

```
which programname 
```

...

```
type -P programname 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2020-06-15T20:43:00.663

它可能更简单，只是：

```
#!/usr/bin/env bash                                                                
set -x                                                                             

# if local program 'foo' returns 1 (doesn't exist) then...                                                                               
if ! type -P foo; then                                                             
    echo 'crap, no foo'                                                            
else                                                                               
    echo 'sweet, we have foo!'                                                    
fi 
```

更改`foo`为`vi`以使其他条件触发。

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2009-02-26T21:56:53.850

该`which`命令可能很有用。[男人](http://unixhelp.ed.ac.uk/CGI/man-cgi?which)

如果找到可执行文件，则返回 0，如果未找到或无法执行，则返回 1：

```
NAME

       which - locate a command

SYNOPSIS

       which [-a] filename ...

DESCRIPTION

       which returns the pathnames of the files which would
       be executed in the current environment, had its
       arguments been given as commands in a strictly
       POSIX-conformant shell. It does this by searching
       the PATH for executable files matching the names
       of the arguments.

OPTIONS

       -a     print all matching pathnames of each argument

EXIT STATUS

       0      if all specified commands are 
              found and executable

       1      if one or more specified commands is nonexistent
              or not executable

       2      if an invalid option is specified 
```

好处`which`是它可以确定可执行文件在`which`运行的环境中是否可用 - 它节省了一些问题......

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2010-01-15T23:16:17.113

对于那些感兴趣的人，如果您希望检测已安装的库，则以前的答案中的任何方法都不起作用。我想你要么在物理上检查路径（可能是头文件等），要么像这样（如果你在基于 Debian 的发行版上）：

```
dpkg --status libdb-dev | grep -q not-installed

if [ $? -eq 0 ]; then
    apt-get install libdb-dev
fi 
```

从上面可以看出，查询中的“0”答案表示未安装软件包。这是“grep”的功能——“0”表示找到匹配项，“1”表示未找到匹配项。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2020-06-04T09:15:00.410

我想回答同样的问题，但要在 Makefile 中运行。

```
install:
    @if [[ ! -x "$(shell command -v ghead)" ]]; then \
        echo 'ghead does not exist. Please install it.'; \
        exit -1; \
    fi 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2018-11-27T16:03:15.127

这将根据位置告诉程序是否存在：

```
 if [ -x /usr/bin/yum ]; then
        echo "This is Centos"
    fi 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2016-03-10T02:31:54.350

我会说由于悬挂`alias`es，没有任何便携式和 100% 可靠的方式。例如：

```
alias john='ls --color'
alias paul='george -F'
alias george='ls -h'
alias ringo=/ 
```

当然，只有最后一个是有问题的（没有冒犯林戈！）。`alias`但从的角度来看，它们都是有效的 es `command -v`。

为了拒绝类似的悬空`ringo`，我们必须解析 shell 内置`alias`命令的输出并递归到它们中（`command -v`并不优于`alias`这里。）没有任何可移植的解决方案，甚至是 Bash-具体解决方法比较繁琐。

请注意，这样的解决方案将无条件拒绝`alias ls='ls -F'`：

```
test() { command -v $1 | grep -qv alias } 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2021-04-22T18:03:39.183

**`zsh`only**，但对脚本非常有用`zsh`（例如在编写完成脚本时）：

该模块提供对内部哈希表`zsh/parameter`等的访问权限。`commands`来自`man zshmodules`：

```
THE ZSH/PARAMETER MODULE
       The zsh/parameter module gives access to some of the internal hash  ta‐
       bles used by the shell by defining some special parameters.

[...]

       commands
              This  array gives access to the command hash table. The keys are
              the names of external commands, the values are the pathnames  of
              the  files  that would be executed when the command would be in‐
              voked. Setting a key in this array defines a new entry  in  this
              table  in the same way as with the hash builtin. Unsetting a key
              as in `unset "commands[foo]"' removes the entry  for  the  given
              key from the command hash table. 
```

虽然它是一个可加载的模块，但它似乎是默认加载的，只要`zsh`不与`--emulate`.

例子：

```
martin@martin ~ % echo $commands[zsh]
/usr/bin/zsh 
```

要快速检查某个命令是否可用，只需检查该键是否存在于哈希中：

```
if (( ${+commands[zsh]} ))
then
  echo "zsh is available"
fi 
```

请注意，哈希将包含文件`$PATH`夹中的任何文件，无论它们是否可执行。可以肯定的是，您必须为此打个`stat`电话：

```
if (( ${+commands[zsh]} )) && [[ -x $commands[zsh] ]]
then
  echo "zsh is available"
fi 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2015-08-26T09:23:12.603

如果你们这些人/女孩不能在这里得到答案中的东西并且正在将头发从背后拉出来，请尝试使用运行相同的命令`bash -c`。看看这个梦魇谵妄。这是运行 $(sub-command) 时真正发生的情况：

第一的。它可以给你完全不同的输出。

```
$ command -v ls
alias ls='ls --color=auto'
$ bash -c "command -v ls"
/bin/ls 
```

第二。它根本不会给你任何输出。

```
$ command -v nvm
nvm
$ bash -c "command -v nvm"
$ bash -c "nvm --help"
bash: nvm: command not found 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2011-04-08T15:30:28.750

我必须检查是否安装了 Git 作为部署[CI](https://en.wikipedia.org/wiki/Continuous_integration)服务器的一部分。我最终的 Bash 脚本如下（Ubuntu 服务器）：

```
if ! builtin type -p git &>/dev/null; then
  sudo apt-get -y install git-core
fi 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2011-06-01T17:49:22.987

为了模仿 Bash `type -P cmd`，我们可以使用符合 POSIX 的`env -i type cmd 1>/dev/null 2>&1`.

```
man env
# "The option '-i' causes env to completely ignore the environment it inherits."
# In other words, there are no aliases or functions to be looked up by the type command.

ls() { echo 'Hello, world!'; }

ls
type ls
env -i type ls

cmd=ls
cmd=lsx
env -i type $cmd 1>/dev/null 2>&1 || { echo "$cmd not found"; exit 1; } 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2011-12-14T12:41:26.693

hash-variant 有一个缺陷：例如，在命令行中，您可以输入

```
one_folder/process 
```

执行流程。为此， one_folder 的父文件夹必须在*$PATH*中。但是当你尝试散列这个命令时，它总是会成功：

```
hash one_folder/process; echo $? # will always output '0' 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2013-11-06T19:06:48.937

我第二次使用“命令-v”。比如像这样：

```
md=$(command -v mkdirhier) ; alias md=${md:=mkdir}  # bash

emacs="$(command -v emacs) -nw" || emacs=nano
alias e=$emacs
[[ -z $(command -v jed) ]] && alias jed=$emacs 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2014-11-20T16:55:05.083

如果没有任何可用的外部命令（[这里](https://stackoverflow.com/questions/592620/how-can-i-check-if-a-program-exists-from-a-bash-script/6205510#6205510)`type`认为是理所当然的），我们可以使用符合 POSIX的：`env -i sh -c 'type cmd 1>/dev/null 2>&1'`

```
# Portable version of Bash's type -P cmd (without output on stdout)
typep() {
   command -p env -i PATH="$PATH" sh -c '
      export LC_ALL=C LANG=C
      cmd="$1"
      cmd="`type "$cmd" 2>/dev/null || { echo "error: command $cmd not found; exiting ..." 1>&2; exit 1; }`"
      [ $? != 0 ] && exit 1
      case "$cmd" in
        *\ /*) exit 0;;
            *) printf "%s\n" "error: $cmd" 1>&2; exit 1;;
      esac
   ' _ "$1" || exit 1
}

# Get your standard $PATH value
#PATH="$(command -p getconf PATH)"
typep ls
typep builtin
typep ls-temp 
```

至少在[Mac OS X v10.6.8](https://en.wikipedia.org/wiki/Mac_OS_X_Snow_Leopard) (Snow Leopard) 上使用 Bash 4.2.24(2)`command -v ls`不匹配移动的`/bin/ls-temp`.

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2015-03-27T14:26:27.203

我的[Debian](https://duckduckgo.com/html/?q=Wikipedia%20exitting)服务器设置：

当多个包包含相同的名称时，我遇到了问题。

例如`apache2`. 所以这是我的解决方案：

```
function _apt_install() {
    apt-get install -y $1 > /dev/null
}

function _apt_install_norecommends() {
    apt-get install -y --no-install-recommends $1 > /dev/null
}
function _apt_available() {
    if [ `apt-cache search $1 | grep -o "$1" | uniq | wc -l` = "1" ]; then
        echo "Package is available : $1"
        PACKAGE_INSTALL="1"
    else
        echo "Package $1 is NOT available for install"
        echo  "We can not continue without this package..."
        echo  "Exitting now.."
        exit 0
    fi
}
function _package_install {
    _apt_available $1
    if [ "${PACKAGE_INSTALL}" = "1" ]; then
        if [ "$(dpkg-query -l $1 | tail -n1 | cut -c1-2)" = "ii" ]; then
             echo  "package is already_installed: $1"
        else
            echo  "installing package : $1, please wait.."
            _apt_install $1
            sleep 0.5
        fi
    fi
}

function _package_install_no_recommends {
    _apt_available $1
    if [ "${PACKAGE_INSTALL}" = "1" ]; then
        if [ "$(dpkg-query -l $1 | tail -n1 | cut -c1-2)" = "ii" ]; then
             echo  "package is already_installed: $1"
        else
            echo  "installing package : $1, please wait.."
            _apt_install_norecommends $1
            sleep 0.5
        fi
    fi
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2016-06-18T23:19:53.020

如果您想检查一个程序是否存在**并且真的是一个程序，而不是 Bash 内置命令**`command`，那么`type`和`hash`不适合测试，因为它们都返回 0 退出状态的内置命令。

例如，**时间**程序提供了比**时间**内置命令更多的功能。要检查程序是否存在，我建议使用`which`以下示例：

```
# First check if the time program exists
timeProg=`which time`
if [ "$timeProg" = "" ]
then
  echo "The time program does not exist on this system."
  exit 1
fi

# Invoke the time program
$timeProg --quiet -o result.txt -f "%S %U + p" du -sk ~
echo "Total CPU time: `dc -f result.txt` seconds"
rm result.txt 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2021-10-13T10:50:36.320

```
#!/bin/bash
a=${apt-cache show program}
if [[ $a == 0 ]]
then
echo "the program doesn't exist"
else
echo "the program exists"
fi 
```

#program 不是字面的，你可以把它改成你要检查的程序的名字

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2022-03-05T16:17:49.403

只需输入：

哪条蟒蛇

（python在这里只是一个例子）

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2017-09-06T00:42:27.347

脚本

```
#!/bin/bash

# Commands found in the hash table are checked for existence before being
# executed and non-existence forces a normal PATH search.
shopt -s checkhash

function exists() {
 local mycomm=$1; shift || return 1

 hash $mycomm 2>/dev/null || \
 printf "\xe2\x9c\x98 [ABRT]: $mycomm: command does not exist\n"; return 1;
}
readonly -f exists

exists notacmd
exists bash
hash
bash -c 'printf "Fin.\n"' 
```

结果

```
✘ [ABRT]: notacmd: command does not exist
hits    command
   0    /usr/bin/bash
Fin. 
```

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2019-10-25T17:26:24.847

假设您已经在[遵循安全的 shell 做法](https://sipb.mit.edu/doc/safe-shell/)：

```
set -eu -o pipefail
shopt -s failglob

./dummy --version 2>&1 >/dev/null 
```

这假设命令可以以它（几乎）什么都不做的方式被调用，比如报告它的版本或显示帮助。

如果`dummy`找不到该命令，Bash 将退出并出现以下错误...

```
./my-script: line 8: dummy: command not found 
```

这比其他`command -v`（和类似的）答案更有用且更简洁，因为错误消息是自动生成的，并且还包含相关的行号。

* * *

## 回答 #35

> 赞同：-1
> 
> 时间：2020-10-14T20:10:26.123

迟到的答案，但这就是我最终要做的。

我只是检查我执行的命令是否返回错误代码。如果返回 0，则表示程序已安装。此外，您可以使用它来检查脚本的输出。以这个脚本为例。

**foo.sh**

```
#!/bin/bash
echo "hello world"
exit 1 # throw some error code 
```

例子：

```
# outputs something bad... and exits
bash foo.sh $? -eq 0 || echo "something bad happened. not installed" ; exit 1

# does NOT outputs nothing nor exits because dotnet is installed on my machine
dotnet --version $? -eq 0 || echo "something bad happened. not installed" ; exit 1 
```

基本上所有这些都是检查命令运行的退出代码。**即使命令退出代码不是 0，这个问题上最被接受的答案也会返回 true。**

* * *

## 回答 #36

> 赞同：-2
> 
> 时间：2012-02-18T07:54:44.030

```
checkexists() {
    while [ -n "$1" ]; do
        [ -n "$(which "$1")" ] || echo "$1": command not found
        shift
    done
} 
```

* * *

## 回答 #37

> 赞同：-2
> 
> 时间：2015-09-22T00:41:46.033

我使用它，因为它非常简单：

```
if [ $(LANG=C type example 2>/dev/null | wc -l) = 1 ]; then 
    echo exists; 
else 
    echo "not exists"; 
fi 
```

或者

```
if [ $(LANG=C type example 2>/dev/null | wc -l) = 1 ]; then
    echo exists
else
    echo "not exists"
fi 
```

它使用 shell 内置程序和程序的回显状态到标准输出，而不使用标准错误。另一方面，如果找不到命令，它只会将状态回显到标准错误。

* * *

## 回答 #38

> 赞同：-2
> 
> 时间：2017-04-16T01:21:00.413

```
GIT=/usr/bin/git                     # STORE THE RELATIVE PATH
# GIT=$(which git)                   # USE THIS COMMAND TO SEARCH FOR THE RELATIVE PATH

if [[ ! -e $GIT ]]; then             # CHECK IF THE FILE EXISTS
    echo "PROGRAM DOES NOT EXIST."
    exit 1                           # EXIT THE PROGRAM IF IT DOES NOT
fi

# DO SOMETHING ...

exit 0                               # EXIT THE PROGRAM IF IT DOES 
```

* * *

## 回答 #39

> 赞同：-3
> 
> 时间：2010-01-20T13:43:17.257

我无法让其中一个解决方案起作用，但在稍微编辑后我想出了这个。这对我有用：

```
dpkg --get-selections | grep -q linux-headers-$(uname -r)

if [ $? -eq 1 ]; then
        apt-get install linux-headers-$(uname -r)
fi 
```

* * *

## 回答 #40

> 赞同：-4
> 
> 时间：2018-08-10T08:30:41.450

我会尝试使用例如`--version`or调用程序`--help`并[检查命令是成功还是失败](https://unix.stackexchange.com/questions/22726/how-to-conditionally-do-something-if-a-command-succeeded-or-failed)

与 一起使用[`set -e`](https://stackoverflow.com/questions/19622198/what-does-set-e-mean-in-a-bash-script)，如果找不到程序，脚本将退出，您将收到一条有意义的错误消息：

```
#!/bin/bash
set -e
git --version >> /dev/null 
```

# sas - 在 Base SAS 中生成不在表格布局中的报告

> ID：592622
> 
> 赞同：0
> 
> 时间：2009-02-26T21:53:10.973
> 
> 标签：sas

我正在编写 Base SAS 8.1(OpenVMS) 中的报告。我需要它每次观察有 1 页...类似于下面。我找不到任何显示如何使用`PROC PRINT`or执行此操作的内容`PROC REPORT`。除了声明之外，还有什么方法可以做到这一点`PUT`？不幸的是，升级或添加模块不是一种选择。任何帮助表示赞赏。

标题文本观察 ID 1

第 1 行文本 ---------------- 变量 1

第 2 行文本 ---------------- 变量 2

第 3 行文本 ---------------- 变量 3

- 分页符 -

标题文本观察 ID 2

第 1 行文本 ---------------- 变量 1

第 2 行文本 ---------------- 变量 2

第 3 行文本 ---------------- 变量 3

- 分页符 -

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-27T20:18:38.570

如果您通过观察数转置数据集，则`proc report`可以毫无问题地处理它。hth。

```
/* test data -- each obs is identified by obsId */
data class;
  set sashelp.class;
  obsId = _n_;
run;

/* transpose the data */
proc transpose 
  data=class 
  out=report(rename=(_name_=var col1=value));
  var _all_;
  by obsId;
run;

/* change the varaible name into "Line 1 text ..." */
data report;
  drop line cLine dashes;
  length var cLine $30;
  dashes = repeat("-", 20-1);
  /* usual DoW */
  do line = 1 by 1 until (last.obsId);
    set report;
    by obsId;
    cLine = put(line, best.-l);
    var = "Line "||trim(cline)||" text "||dashes;
    output;
  end;
run;

/* print out one obs per page */
options nocenter;
proc report data=report nowd;
  column obsId var value;
  define obsId / " " group noprint;
  define var / " " display left;
  define value / " " display left;
  break after obsId / page;
  compute before obsId;
    id = put(obsId, best.-l);
    len = length(id);
    line @2 "Header Text Observation Id " iD $varying. len;
    line " ";
  endcomp;
run;

/* on lst, in part. 
Header Text Observation Id 1

 Line 1 text ------------------  Alfred
 Line 2 text ------------------  M
 Line 3 text ------------------            14
 Line 4 text ------------------            69
 Line 5 text ------------------         112.5
 Line 6 text ------------------             1

(new page)
Header Text Observation Id 2

 Line 1 text ------------------  Alice
 Line 2 text ------------------  F
 Line 3 text ------------------            13
 Line 4 text ------------------          56.5
 Line 5 text ------------------            84
 Line 6 text ------------------             2

(new page)
...
*/ 
```

# c# - 归一化后的 NHibernate 映射

> ID：592624
> 
> 赞同：0
> 
> 时间：2009-02-26T21:53:21.677
> 
> 标签：c#, nhibernate, fluent-nhibernate, nhibernate-mapping

请帮助我——我是 NHibernate 的新手，我似乎找不到我要找的东西。

我在数据库中有两个表：`Fund`和`FundBalance`. A`Fund`可以有很多`FundBalances`，而 a`FundBalance`只有一个`Fund`。

在 C# 中，只有`FundBalance`类。表中的列与`Fund`表中的列连接`FundBalance`需要映射到`FundBalance`类的属性上。

例如，`Fund`表包含`FundName`属性，`FundBalance`表包含`AvailableBalance`属性。这两个表是join的，join的结果需要映射到类的`FundName`and`AvailableBalance`属性上`FundBalance`。

问题：我如何用 NHibernate 做到这一点？奖励：如何使用 FluentNHibernate 指定映射？

我想到的一种解决方案是在数据库中创建一个视图，但如果映射可以完全使用 NHibernate 完成，我会更喜欢它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-06T21:25:42.377

正如我在评论中所问的那样；这个 FundBalance 类到底长什么样？里面有什么？你能`<join table>`对 NHibernate 映射中的元素做些什么吗？

例如： [http ://ayende.com/Blog/archive/2007/04/24/Multi-Table-Entities-in-NHibernate.aspx](http://ayende.com/Blog/archive/2007/04/24/Multi-Table-Entities-in-NHibernate.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-09T15:15:41.587

您不需要使用视图来解决您的问题。当您在 FundBalance 表上进行映射时，您只需要具体说明联接。如果我的理解很好，你想让你的 FundBalance 类更完整，并从 Fund Table 中获得一些属性。

试试这个：

```
<class name="FundBalance" table="FundBalance" lazy="true">
        <id name="Id" column="FundBalanceId" unsaved-value="0">
            <generator class="native"/>
        </id>

        <property name="FundBalance" not-null="true" length="80"/>

        <join table="Fund">
            <key column="FundId"/>
            <property name="FundName"/>
        </join>
</class> 
```

对于您的 FundBalance 实体类，代码将是：

```
public class FundBalance
{   
        private long _Id;
        public virtual long Id
        {
            get { return _Id; }
            set { _Id = value; }
        }

        private decimal _FundBalance;
        public virtual decimal FundBalance
        {
            get { return _FundBalance; }
            set { _FundBalance= value; }
        }

        private string _FundName;
        public virtual string FundName
        {
            get { return _FundName; }
            set { _FundName= value; }
        }
} 
```

如果您需要更多示例和解释为一个实体映射多个表的问题，请尝试以下链接：

[https://svn.sourceforge.net/svnroot/nhibernate/trunk/nhibernate/src/NHibernate.Test/Join/](https://svn.sourceforge.net/svnroot/nhibernate/trunk/nhibernate/src/NHibernate.Test/Join/) [http://ayende.com/Blog/archive/2007/04/24/Multi-Table-Entities-在-NHibernate.aspx](http://ayende.com/Blog/archive/2007/04/24/Multi-Table-Entities-in-NHibernate.aspx)

我给你 HBM 映射文件，对于流利的 nhibernate，我不知道你是否可以使用关键字 JOIN 但基本上这是同样的问题。

希望这可以帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T22:03:58.233

你没有基金课的原因是什么？我会重新考虑这是否真的明智。

但是如果你想留在那条路线上，子选择属性可能会有所帮助（对不起，我从 Hibernate 文档而不是 NHibernate 得到这个，但我希望它们足够相似： [http ://www.hibernate.org/hib_docs/core/reference /en/html_single/#mapping-declaration-class](http://www.hibernate.org/hib_docs/core/reference/en/html_single/#mapping-declaration-class) )

我认为这应该适用于选择、更新和删除。但是我不知道 insert 应该如何工作（独立于 Hibernate）谁应该负责决定您是否需要新的 Fund 记录，或者当您没有在对象模型中正确表示 Fund 表时更新一个（哪个？） .

如果您的数据库支持，另一种方法是（正如您自己提到的）在数据库中创建一个视图并使用“而不是触发器”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T15:42:20.670

如果您只需要两个表的公共类，为什么不使用外观模式？映射 Fund 和 FundBalance 通常，创建一个（未映射的）新类作为两个实体的接口。简单，不涉及任何“魔法”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-06T21:18:09.167

如果你只需要阅读，而不需要在基金中写，你可以使用一个公式。例如：

这样您就可以正常使用 FundBalances，但不能使用 Funds

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-05T15:04:47.997

这应该使用 Hibernates 对继承的支持来完成。Hibernate 可以用几种不同的方式对相关类的族进行建模，但一种是基类的表，另一种是每个子类的表，以保存它们的附加属性。在加载时，所有列都会自动加载到指定的子类中 - 所以创建一个只有一个类的假继承结构，它应该完全按照你的描述做。

# asp.net - 带有 ASP.NET 复选框触发器的 asp:UpdatePanel

> ID：592638
> 
> 赞同：5
> 
> 时间：2009-02-26T21:58:18.917
> 
> 标签：asp.net, ajax, asynchronous, checkbox, updatepanel

当我将 ASP.NET 复选框控件设置为 asp.net 更新面板的异步回发触发器时，EventName 属性是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-26T22:04:55.767

我相信它是 CheckedChanged。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-26T22:03:15.600

您所要做的就是将 AutoPostback 设置为 true，如果您的 CheckBox 在 UpdatePanel 内，您应该不会有任何问题

```
<asp:CheckBox runat="server" ID="chk_Name" AutoPostBack="true" OnCheckedChanged="chk_Name_OnCheckedChanged"></asp:CheckBox> 
```

然后在**OnCheckedChanged**函数中你可以做任何你需要做的事情

```
protected void chk_Name_OnCheckedChanged(object sender, EventArgs e) 
{
     // Do stuff here
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T22:01:42.513

OnCheckedChanged 是事件名称。您可以通过双击 UI 中的复选框来自动生成方法，并根据复选框名称生成最有可能是的方法：

```
protected void CheckBox1_OnCheckedChanged(object sender, EventArgs e) {} 
```

# wpf - WPF ComboBox 不更新源

> ID：592655
> 
> 赞同：16
> 
> 时间：2009-02-26T22:03:39.780
> 
> 标签：wpf, data-binding, combobox, wpftoolkit

我正在尝试使 WPF 组合框正常工作（在 WPFToolkit Datagrid 内），但我无法正确对齐所有部分。我正在使用 Linq to Entities，并将整个数据上下文设置为 Linq 查询的结果：

```
 private void LoadDonationGrid()
{
    donationGrid.ItemsSource = from donations in entities.Donation
                   .Include("Family")
                   .Include("PledgeYear")
                   .Include("DonationPurpose")
               from donationPurposes in entities.DonationPurpose
               select new { donations, donationPurposes };
} 
```

我的代码隐藏中还有一个页面属性，它为组合框提供 ItemsSource：

```
 private IEnumerable donationPurposeList;
public IEnumerable DonationPurposeList
{
    get
    {
        if (donationPurposeList == null)
        {
            donationPurposeList = from dp in entities.DonationPurpose
                                  select dp;
        }
        return donationPurposeList.ToList();
    }
} 
```

组合框的 XAML 如下所示：

```
<tk:DataGridTemplateColumn Header="Purpose">
    <tk:DataGridTemplateColumn.CellTemplate>
        <DataTemplate>
            <TextBlock Text="{Binding Path=donations.DonationPurpose.Description, Mode=TwoWay}" />
        </DataTemplate>
    </tk:DataGridTemplateColumn.CellTemplate>
    <tk:DataGridTemplateColumn.CellEditingTemplate>
        <DataTemplate>
            <ComboBox Name="cboDonationPurpose"
                SelectedValue="{Binding Path=donations.DonationPurposeID, Mode=TwoWay}"
                ItemsSource="{Binding RelativeSource={RelativeSource AncestorType={x:Type Page},Mode=FindAncestor},Path=DonationPurposeList}"                                 
                DisplayMemberPath="Description"
                SelectedValuePath="DonationPurposeID"
                      />
        </DataTemplate>
    </tk:DataGridTemplateColumn.CellEditingTemplate>
</tk:DataGridTemplateColumn> 
```

一切似乎都正常工作，即适当的值显示在 ComboBox 中，直到焦点离开 ComboBox 的位置。此时，显示的值将恢复为原始值，而不是新选择的值。我尝试使用 SelectedItem 而不是 SelectedValue，但最终选择的值未显示在 ComboBox 中。我有点迷惑：似乎这点应该起作用。

2009 年 3 月 2 日编辑：我仍然对此感到困惑。我应该注意，在我的数据网格中，任何简单的数据列（例如，“DataGridTextColumn”）都会按照您的预期更新基础数据源。但是对我的任何模板列（“DataGridTemplateColumn”）或 ComboBox 列（“DataGridComboBoxColumn”）的任何更新都不起作用：基础数据源永远不会更新。当然其他人已经尝试使用 WPF.Toolkit 数据网格并让这个场景工作 - 但我已经查看了那里的所有示例代码，并且我基本上按照它所说的去做（在我的约束范围内）解决方案），所以我在摸索为什么这不起作用。

有什么想法吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2011-02-18T01:17:58.060

我有一个类似的问题（我花了几天的时间沮丧），我发现更改绑定以`UpdateSourceTrigger`修复它。我不知道为什么，但对我来说，直到我做出这个改变，数据源才被更新。`SelectedValue``PropertyChanged`

```
<ComboBox 
    ItemsSource="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={x:Type UpdateTypesManager:MainWindow}}, Path=CardinalityTypes}" 
    DisplayMemberPath="CardinalityType"
    SelectedValue="{Binding CardinalityTypeId, UpdateSourceTrigger=PropertyChanged}"
    SelectedValuePath="Id" /> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-20T05:39:34.357

我能够得到这个工作。但我的设置有点不同。

1.  我创建了一个 ViewModel 作为与 View 的合同。
2.  我绑定到 ComboBox.SelectedItem 属性而不是 ComboBox.SelectedValue 属性

由于我不知道您的数据源是什么，所以我自己编写了一个来模拟基本问题：在 WPF DataGrid 中正确绑定组合框。

这是我的视图模型的组成：

```
public class RootViewModel
{
    public List<State> USStates { get; set; }
    public List<Customer> Customers { get; set; }

    public ViewModel()
    {
        Customers = new List<Customer>();
        Customers.Add(new Customer() { FirstName = "John", LastName = "Smith", State = new State() { ShortName = "IL" } });
        Customers.Add(new Customer() { FirstName = "John", LastName = "Doe", State = new State() { ShortName = "OH" } });
        Customers.Add(new Customer() { FirstName = "Sally", LastName = "Smith", State = new State() { ShortName = "IN" } });

        USStates = new List<State>();
        USStates.Add(new State() { ShortName = "OH" });
        USStates.Add(new State() { ShortName = "IL" });
        USStates.Add(new State() { ShortName = "IN" });
    }
}

public class Customer
{
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public State State { get; set; }
}

public class State
{
    public string ShortName { get; set; }

    public State() 
    {
        ShortName = string.Empty;
    }

    public override bool Equals(object obj)
    {
        if (obj is State)
        {
            State otherState = obj as State;
            return ShortName.Equals(otherState.ShortName);
        }
        else
        {
            return false;
        }
    }
} 
```

在开始之前，我将 Window 的 DataContext 设置为我正确构造的 RootViewModel 的一个实例。

```
<tk:DataGrid ItemsSource="{Binding Customers}" AutoGenerateColumns="False">
            <tk:DataGrid.Columns>
                <tk:DataGridTemplateColumn Header="State">
                    <tk:DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding Path=State.ShortName, Mode=TwoWay}" />
                        </DataTemplate>
                    </tk:DataGridTemplateColumn.CellTemplate>
                    <tk:DataGridTemplateColumn.CellEditingTemplate>
                        <DataTemplate>
                            <ComboBox 
                                x:Name="cboDonationPurpose" 
                                SelectedItem="{Binding Path=State, Mode=TwoWay}" 
                                ItemsSource="{Binding RelativeSource={RelativeSource AncestorType={x:Type Window},Mode=FindAncestor}, Path=DataContext.USStates}" 
                                DisplayMemberPath="ShortName" 
                                SelectedValuePath="ShortName" />
                        </DataTemplate>
                    </tk:DataGridTemplateColumn.CellEditingTemplate>
                </tk:DataGridTemplateColumn>
            </tk:DataGrid.Columns>
        </tk:DataGrid> 
```

为了使 SelectedItem 正确绑定，我需要确保我已经覆盖了我的实体上的 Equals 方法，因为在后台，WPF 正在使用此方法来确定谁是 SelectedItem。我认为这从根本上是您从一开始就导致您尝试绑定到 SelectedValue 而不是 SelectedItem 的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-12T09:08:44.553

您需要添加

```
IsSynchronizedWithCurrentItem = "True" 
```

在您的 Xaml 中。

就这么简单...

# javascript - jquery MultiSelect 在更改时提交表单

> ID：592657
> 
> 赞同：0
> 
> 时间：2009-02-26T22:04:20.637
> 
> 标签：javascript, jquery, javascript-events

我正在使用优秀的[jQuery MultiSelect](http://abeautifulsite.net/notebook/62)插件。

我遇到的问题是我想在值发生更改时提交表单。让这个工作遇到各种各样的麻烦，有没有人知道如何实现这一目标？

如果有任何可以很好地处理这个问题，也可以使用其他 jQuery 插件/脚本。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T23:27:01.590

您可以尝试修补 jQueryMultiSelect (未经测试)

行：34 --

```
multiSelect: function(o, callback ) { 
```

线：34 ++

```
multiSelect: function(o, callback, postback) { 
```

第 221 行：++

```
if( postback ) postback($(this)); 
```

完整的代码

```
if(jQuery) (function($){

    $.extend($.fn, {
        multiSelect: function(o, callback, postback) {
            // Default options
            if( !o ) var o = {};
            if( o.selectAll == undefined ) o.selectAll = true;
            if( o.selectAllText == undefined ) o.selectAllText = "Select All";
            if( o.noneSelected == undefined ) o.noneSelected = 'Select options';
            if( o.oneOrMoreSelected == undefined ) o.oneOrMoreSelected = '% selected';

            // Initialize each multiSelect
            $(this).each( function() {
                var select = $(this);
                var html = '<input type="text" readonly="readonly" class="multiSelect" value="" style="cursor: default;" />';
                html += '<div class="multiSelectOptions" style="position: absolute; z-index: 99999; display: none;">';
                if( o.selectAll ) html += '<label class="selectAll"><input type="checkbox" class="selectAll" />' + o.selectAllText + '</label>';
                $(select).find('OPTION').each( function() {
                    if( $(this).val() != '' ) {
                        html += '<label><input type="checkbox" name="' + $(select).attr('name') + '" value="' + $(this).val() + '"';
                        if( $(this).attr('selected') ) html += ' checked="checked"';
                        html += ' />' + $(this).html() + '</label>';
                    }
                });
                html += '</div>';
                $(select).after(html);

                // Events
                $(select).next('.multiSelect').mouseover( function() {
                    $(this).addClass('hover');
                }).mouseout( function() {
                    $(this).removeClass('hover');
                }).click( function() {
                    // Show/hide on click
                    if( $(this).hasClass('active') ) {
                        $(this).multiSelectOptionsHide();
                    } else {
                        $(this).multiSelectOptionsShow();
                    }
                    return false;
                }).focus( function() {
                    // So it can be styled with CSS
                    $(this).addClass('focus');
                }).blur( function() {
                    // So it can be styled with CSS
                    $(this).removeClass('focus');
                });

                // Determine if Select All should be checked initially
                if( o.selectAll ) {
                    var sa = true;
                    $(select).next('.multiSelect').next('.multiSelectOptions').find('INPUT:checkbox').not('.selectAll').each( function() {
                        if( !$(this).attr('checked') ) sa = false;
                    });
                    if( sa ) $(select).next('.multiSelect').next('.multiSelectOptions').find('INPUT.selectAll').attr('checked', true).parent().addClass('checked');
                }

                // Handle Select All
                $(select).next('.multiSelect').next('.multiSelectOptions').find('INPUT.selectAll').click( function() {
                    if( $(this).attr('checked') == true ) $(this).parent().parent().find('INPUT:checkbox').attr('checked', true).parent().addClass('checked'); else $(this).parent().parent().find('INPUT:checkbox').attr('checked', false).parent().removeClass('checked');
                });

                // Handle checkboxes
                $(select).next('.multiSelect').next('.multiSelectOptions').find('INPUT:checkbox').click( function() {
                    $(this).parent().parent().multiSelectUpdateSelected(o);
                    $(this).parent().parent().find('LABEL').removeClass('checked').find('INPUT:checked').parent().addClass('checked');
                    $(this).parent().parent().prev('.multiSelect').focus();
                    if( !$(this).attr('checked') ) $(this).parent().parent().find('INPUT:checkbox.selectAll').attr('checked', false).parent().removeClass('checked');
                    if( callback ) callback($(this));
                });

                // Initial display
                $(select).next('.multiSelect').next('.multiSelectOptions').each( function() {
                    $(this).multiSelectUpdateSelected(o);
                    $(this).find('INPUT:checked').parent().addClass('checked');
                });

                // Handle hovers
                $(select).next('.multiSelect').next('.multiSelectOptions').find('LABEL').mouseover( function() {
                    $(this).parent().find('LABEL').removeClass('hover');
                    $(this).addClass('hover');
                }).mouseout( function() {
                    $(this).parent().find('LABEL').removeClass('hover');
                });

                // Keyboard
                $(select).next('.multiSelect').keydown( function(e) {
                    // Is dropdown visible?
                    if( $(this).next('.multiSelectOptions').is(':visible') ) {
                        // Dropdown is visible
                        // Tab
                        if( e.keyCode == 9 ) {
                            $(this).addClass('focus').trigger('click'); // esc, left, right - hide
                            $(this).focus().next(':input').focus();
                            return true;
                        }

                        // ESC, Left, Right
                        if( e.keyCode == 27 || e.keyCode == 37 || e.keyCode == 39 ) {
                            // Hide dropdown
                            $(this).addClass('focus').trigger('click');
                        }
                        // Down
                        if( e.keyCode == 40 ) {
                            if( !$(this).next('.multiSelectOptions').find('LABEL').hasClass('hover') ) {
                                // Default to first item
                                $(this).next('.multiSelectOptions').find('LABEL:first').addClass('hover');
                            } else {
                                // Move down, cycle to top if on bottom
                                $(this).next('.multiSelectOptions').find('LABEL.hover').removeClass('hover').next('LABEL').addClass('hover');
                                if( !$(this).next('.multiSelectOptions').find('LABEL').hasClass('hover') ) {
                                    $(this).next('.multiSelectOptions').find('LABEL:first').addClass('hover');
                                }
                            }
                            return false;
                        }
                        // Up
                        if( e.keyCode == 38 ) {
                            if( !$(this).next('.multiSelectOptions').find('LABEL').hasClass('hover') ) {
                                // Default to first item
                                $(this).next('.multiSelectOptions').find('LABEL:first').addClass('hover');
                            } else {
                                // Move up, cycle to bottom if on top
                                $(this).next('.multiSelectOptions').find('LABEL.hover').removeClass('hover').prev('LABEL').addClass('hover');
                                if( !$(this).next('.multiSelectOptions').find('LABEL').hasClass('hover') ) {
                                    $(this).next('.multiSelectOptions').find('LABEL:last').addClass('hover');
                                }
                            }
                            return false;
                        }
                        // Enter, Space
                        if( e.keyCode == 13 || e.keyCode == 32 ) {
                            // Select All
                            if( $(this).next('.multiSelectOptions').find('LABEL.hover INPUT:checkbox').hasClass('selectAll') ) {
                                if( $(this).next('.multiSelectOptions').find('LABEL.hover INPUT:checkbox').attr('checked') ) {
                                    // Uncheck all
                                    $(this).next('.multiSelectOptions').find('INPUT:checkbox').attr('checked', false).parent().removeClass('checked');
                                } else {
                                    // Check all
                                    $(this).next('.multiSelectOptions').find('INPUT:checkbox').attr('checked', true).parent().addClass('checked');
                                }
                                $(this).next('.multiSelectOptions').multiSelectUpdateSelected(o);
                                if( callback ) callback($(this));
                                return false;
                            }
                            // Other checkboxes
                            if( $(this).next('.multiSelectOptions').find('LABEL.hover INPUT:checkbox').attr('checked') ) {
                                // Uncheck
                                $(this).next('.multiSelectOptions').find('LABEL.hover INPUT:checkbox').attr('checked', false);
                                $(this).next('.multiSelectOptions').multiSelectUpdateSelected(o);
                                $(this).next('.multiSelectOptions').find('LABEL').removeClass('checked').find('INPUT:checked').parent().addClass('checked');
                                // Select all status can't be checked at this point
                                $(this).next('.multiSelectOptions').find('INPUT:checkbox.selectAll').attr('checked', false).parent().removeClass('checked');
                                if( callback ) callback($(this));
                            } else {
                                // Check
                                $(this).next('.multiSelectOptions').find('LABEL.hover INPUT:checkbox').attr('checked', true);
                                $(this).next('.multiSelectOptions').multiSelectUpdateSelected(o);
                                $(this).next('.multiSelectOptions').find('LABEL').removeClass('checked').find('INPUT:checked').parent().addClass('checked');
                                if( callback ) callback($(this));
                            }
                        }
                        return false;
                    } else {
                        // Dropdown is not visible
                        if( e.keyCode == 38 || e.keyCode == 40 || e.keyCode == 13 || e.keyCode == 32 ) { // down, enter, space - show
                            // Show dropdown
                            $(this).removeClass('focus').trigger('click');
                            $(this).next('.multiSelectOptions').find('LABEL:first').addClass('hover');
                            return false;
                        }
                        //  Tab key
                        if( e.keyCode == 9 ) {
                            // Shift focus to next INPUT element on page
                            $(this).focus().next(':input').focus();
                            return true;
                        }
                    }
                    // Prevent enter key from submitting form
                    if( e.keyCode == 13 ) return false;
                });

                // Eliminate the original form element
                $(select).remove();
            });

        },

        // Hide the dropdown
        multiSelectOptionsHide: function() {
            $(this).removeClass('active').next('.multiSelectOptions').hide();
            if( postback ) postback($(this));
        },

        // Show the dropdown
        multiSelectOptionsShow: function() {
            // Hide any open option boxes
            $('.multiSelect').multiSelectOptionsHide();
            $(this).next('.multiSelectOptions').find('LABEL').removeClass('hover');
            $(this).addClass('active').next('.multiSelectOptions').show();

            // Position it
            var offset = $(this).offset();
            $(this).next('.multiSelectOptions').css({ top:  offset.top + $(this).outerHeight() + 'px' });
            $(this).next('.multiSelectOptions').css({ left: offset.left + 'px' });

            // Disappear on hover out
            multiSelectCurrent = $(this);
            var timer = '';
            $(this).next('.multiSelectOptions').hover( function() {
                clearTimeout(timer);
            }, function() {
                timer = setTimeout('$(multiSelectCurrent).multiSelectOptionsHide(); $(multiSelectCurrent).unbind("hover");', 250);
            });

        },

        // Update the textbox with the total number of selected items
        multiSelectUpdateSelected: function(o) {
            var i = 0, s = '';
            $(this).find('INPUT:checkbox:checked').not('.selectAll').each( function() {
                i++;
            })
            if( i == 0 ) {
                $(this).prev('INPUT.multiSelect').val( o.noneSelected );
            } else {
                if( o.oneOrMoreSelected == '*' ) {
                    var display = '';
                    $(this).find('INPUT:checkbox:checked').each( function() {
                        if( $(this).parent().text() != o.selectAllText ) display = display + $(this).parent().text() + ', ';
                    });
                    display = display.substr(0, display.length - 2);
                    $(this).prev('INPUT.multiSelect').val( display );
                } else {
                    $(this).prev('INPUT.multiSelect').val( o.oneOrMoreSelected.replace('%', i) );
                }
            }
        }

    });

})(jQuery); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-02-18T20:33:16.097

K，如果因为您试图获取 ASP.NET 回发的值而遇到问题，您可以试试这个。这有点骇人听闻，但在`renderOption`函数中更改了一行：

```
var html = '<label><input type="checkbox" name="' + id + '[]" value="' + option.value + '"'; 
```

到：

```
var html = '<label><input type="checkbox" name="' + id.replace(/_/g,"$") + '" value="' + option.value + '"'; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T22:14:47.567

您是否尝试将其直接附加到多选回调？

```
$(document).ready( function() {
    $("#control_id").multiSelect(options, function() {
        $('#myFormId').submit();
    });
}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-09T11:18:20.020

首先，我确实将所选项目保存在隐藏字段中，回发后我以逗号分隔格式分配了这些选中的项目。我写了一个`document.ready()`类似下面的函数来检查下拉列表中选择的值：

```
var Quali = document.getElementById('<%=hdCommaList.ClientID%>').value; 
var qualiList = Quali.split(',');
for (var dx = 0; dx < qualiList.length; dx++) {
    if (!(qualiList[dx] == '')) {
        $('input[type="checkbox"][value="' + qualiList[dx] + '"]').attr('checked', true).trigger('click').attr('checked', true);
    }
} 
```

# java - 部署 .jar 文件：为什么我无法加载图标文件？

> ID：592663
> 
> 赞同：5
> 
> 时间：2009-02-26T22:06:13.050
> 
> 标签：java, deployment, resources, jar

我正在导出一个包含两个目录的简单 java 项目；src 和图标。Icons 是一个包含三个 .png 文件的目录。

我正在使用 File -> Export 导出到可执行的 .jar 文件。导出工作正常，.jar 文件包含 Icon 目录。但是在部署项目时，我无法获得 .png 文件的正确路径。在开发过程中，我使用以下路径：

> 图标/图片.png

只要我在 Eclipse IDE 中运行，它就可以工作。如何获得图标的正确路径？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T22:26:28.820

您的代码正在 .jar 文件之外寻找图像。请尝试使用URL[构造函数](http://java.sun.com/javase/6/docs/api/javax/swing/ImageIcon.html#ImageIcon(java.net.URL))。`ImageIcon`

```
Icon icon = new ImageIcon(getClass().getResource("Icons/picture.png")); 
```

见[`Class.getResource()`](http://java.sun.com/javase/6/docs/api/java/lang/Class.html#getResource(java.lang.String))。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-26T23:36:02.647

mmyers 是正确的，但请注意，这`getClass().getResource()`将加载*相对于定义类的包的*资源。我怀疑您的图标被打包在 jar 文件的根目录中，而不是相对于类本身。要从类路径的根目录获取资源，请尝试： `getClass().getClassLoader().getResourceAsStream("Icons/picture.png")`

# wpf - WPF：删除样式列表框中焦点项目周围的虚线边框

> ID：592665
> 
> 赞同：88
> 
> 时间：2009-02-26T22:06:39.647
> 
> 标签：wpf, xaml, listbox, focus, border

我有一个带有自定义 controlIemplate 的水平列表框。选中的项目在获得焦点时会出现一个虚线框。有谁知道如何摆脱它？

* * *

## 回答 #1

> 赞同：172
> 
> 时间：2009-02-27T04:40:32.010

您需要将每个 ListBoxItem 的 FocusVisualStyle 设置为 null。步骤如下

1) 为 ListBox 创建 ItemContainerStyle

```
<Style x:Key="ListBoxItemStyle1" TargetType="{x:Type ListBoxItem}"> 
   <Setter Property="FocusVisualStyle" Value="{x:Null}"/> .... 
```

2）将该样式设置为列表框

```
<ListBox ItemContainerStyle="{DynamicResource ListBoxItemStyle1}" 
```

# c# - Obout Grid 过滤带有由模板填充的文本的列

> ID：592668
> 
> 赞同：1
> 
> 时间：2009-02-26T22:07:37.227
> 
> 标签：c#, .net, grid, obout

我正在尝试过滤已绑定到模板的[Obout 网格中的列。](http://obout.com/grid/)

**背景**

该`DataField`列只是一个表的外键 ID，该`History`表包含某个对象的基本状态（例如名称、资产标签、序列号、附加信息等）如果用户要更改某个状态对象（例如附加信息）的新记录将被添加到`History`表中，并且该新记录是上述外键引用的内容。

在对列进行数据绑定期间，我将最近的历史状态与之前的状态进行比较，并返回对已更改内容的英文描述（例如“此设备的附加信息字段已被修改”），以便可以显示作为每一行中的文本。

**问题**

网格本身似乎只过滤作为原始数据绑定一部分的客户端上的数据（在这种情况下，只是历史记录的外键 ID）。我可以按这个数字进行过滤，尽管它实际上并没有显示在列视图中，因为它已被英文描述取代。

**网格标记**

```
<cc1:Grid ID="grdHistory" runat="server" AutoGenerateColumns="False" DataSourceID="dsHistory" AllowFiltering="true">
    <Columns>
        <!-- other columns snipped -->
        <cc1:Column DataField="DeviceHistoryID" HeaderText="Event description"  Width="450" Wrap="true"
            Index="3">
            <TemplateSettings  TemplateId="tplEventDescription" />
        </cc1:Column>
    </Columns>
    <Templates>
        <cc1:GridTemplate ID="tplEventDescription" runat="server">
            <Template>
                 <%# FormatEventDescription(Container.DataItem) %>
            </Template>
        </cc1:GridTemplate>
    </Templates>
</cc1:Grid> 
```

`FormatEventDescription(Hashtable Records)`是返回我希望过滤的对象状态更改的英文版本的函数。

**问题**

有没有办法按栏目中的英文描述过滤？在这一点上，任何见解（设计缺陷等）都是受欢迎的。我已经尝试过筛选他们的所有文档，甚至尝试就这个问题联系他们的支持，但尚未收到回复。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-09T20:39:17.487

我对 Obout 的 3rd Party 控件了解不多，但似乎是 .net GridView 控件的子类。所以你可能会再次问这个问题，而是在 Obout 所在的地方使用 gridview，因为显然没有多少人使用那个特定的控件。

在简要扫描网格的事件之后，我认为您可以尝试使用该`RowDataBound`事件进行必要的转换。

您也可以使用 的`Selected`事件`datasource`来转换数据。

If you are able to transform the data to it's final readable state earlier, you may be able to filter it earlier in the chain of events that occur.

# c# - 用属性覆盖属性

> ID：592671
> 
> 赞同：10
> 
> 时间：2009-02-26T22:08:12.733
> 
> 标签：c#, .net, serialization, properties, attributes

我正在尝试找到一种方法来更改属性的序列化行为。

假设我有这样的情况：

```
[Serializable]
public class Record
{
   public DateTime LastUpdated {get; set; }

   // other useful properties ...
}

public class EmployeeRecord : Record
{
   public string EmployeeName {get; set; }

   // other useful properties ...
} 
```

现在我想序列化 EmployeeRecord。我不希望 Record 类中的 LastUpdated 属性被序列化。（不过，我确实希望在序列化 Record 时序列化 LastUpdated）。

首先，我尝试使用*new*关键字隐藏 LastUpdated 属性，然后添加 XmlIgnore 属性：

```
public class EmployeeRecord : Record
{
   public string EmployeeName {get; set; }

   [XmlIgnore]
   public new DateTime LastUpdated {get; set; }
   // other useful properties ...
} 
```

但这没有用。然后我尝试使基础 LastUpdated 虚拟并覆盖它，保留属性：

```
[Serializable]
public class Record
{
   public virtual DateTime LastUpdated {get; set; }

   // other useful properties ...
}

public class EmployeeRecord : Record
{
   public string EmployeeName {get; set; }

   [XmlIgnore]
   public override DateTime LastUpdated {get; set; }
   // other useful properties ...
} 
```

这也不起作用。在这两次尝试中，LastUpdated 都忽略了 XmlIgnore 属性并愉快地进行了序列化业务。

有没有办法让我想做的事情发生？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-27T00:17:32.703

首先，[Serializable] attr 与 XmlSerializer 无关。那是一条红鲱鱼。[Serializable] 对 System.Runtime.Serialization 有意义，而 XmlSerializer 存在于 System.Xml.Serialization 中。如果你用 [Serializable] 装饰你的类，用 [XmlIgnore] 装饰你的成员，那么你可能会混淆你自己或你的代码的其他读者。

.NET 中的 XmlSerialization 非常灵活。根据序列化的完成方式，直接由您或间接由 Web 服务运行时进行 - 您有不同的方式来控制事物。

一种选择是使用*propertyName* Specified 模式来打开或关闭 XML 序列化中的属性。假设您有以下代码：

```
public class TypeA
{ 
  public DateTime LastModified;
  [XmlIgnore]
  public bool LastModifiedSpecified;
} 
```

然后，如果 LastModifiedSpecified 在实例中为 false，则不会为该实例序列化 LastModified 字段。在您的类型的构造函数中，您可以将 LastModifiedSpecified 设置为在基类型中始终为 true，在派生类型中始终为 false。实际的布尔值 - LastModifiedSpecified - 永远不会被序列化，因为它被标记为 XmlIgnore。

这个小技巧记录[在这里](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlserializer.aspx)。

您的另一个选择是使用 XmlAttributeOverrides，这是一种动态提供 XML 序列化属性集（如 XmlElementAttribute、XmlIgnoreAttribute、XmlRootAttribute 等）的方法 - 在运行时动态地将这些属性提供给序列化程序。XmlSerializer 不会检查类型本身的这些属性，而是遍历提供给其构造函数的覆盖属性列表。

```
 var overrides = new XmlAttributeOverrides();
    // ....fill the overrides here....
    // create a new instance of the serializer specifying overrides
    var s1 = new XmlSerializer(typeof(Foo), overrides);
    // serialize as normal, here. 
```

[此处](http://cheeso.members.winisp.net/srcview.aspx?dir=xml-serialization&file=Overrides.cs)更详细地说明了这一点。

在您的情况下，您将提供 XmlIgnoreAttribute 作为替代，但仅在序列化派生类型时。（或其他）这仅在您直接实例化 XmlSerializer 时才有效 - 当序列化由运行时隐式完成时它将不起作用，就像 Web 服务一样。

干杯!

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-27T00:23:22.627

我能想到的最好的...

```
[Serializable]
public class Record
{
   public DateTime LastUpdated {get; set; }
   public virtual bool ShouldSerializeLastUpdated() {return true;}
   // other useful properties ...
}

public class EmployeeRecord : Record
{
   public string EmployeeName {get; set; }
   public override bool ShouldSerializeLastUpdated() {return false;}
   // other useful properties ...
} 
```

基本上，有一些`XmlSerializer`尊重的模式；`public bool ShouldSerialize*()`, 和（注意你也应该用...`public bool *Specified {get;set;}`标记）。`*Specified``[XmlIgnore]`

不是很优雅，我承认；但`XmlSerializer`只查看公共成员，因此您甚至无法隐藏它们（缺少`[EditorBrowsable(EditorBrowsableState.Never), Browsable(false)]`）。

# c# - 您如何处理多个环境的多个 web.config 文件？

> ID：592672
> 
> 赞同：30
> 
> 时间：2009-02-26T22:08:21.670
> 
> 标签：c#, asp.net, web-applications

我目前处理这个问题的方式是拥有多个配置文件，例如：

```
web.config
web.Prod.config
web.QA.config
web.Dev.config 
```

当项目部署到不同的环境时，我只需使用正确的设置重命名相应的文件。

有人对如何更好地处理这个问题有建议吗？

编辑：以下是每个配置中更改的一些内容：

*   WCF 客户端端点 URL 和安全性
*   自定义数据库配置
*   会话连接字符串
*   log4net 设置

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-26T22:22:01.467

Scott Gu 曾经有[一篇](http://weblogs.asp.net/scottgu/archive/2007/09/21/tip-trick-automating-dev-qa-staging-and-production-web-config-settings-with-vs-2005.aspx)关于这个的文章。他提出的解决方案是使用 Pre-build 事件根据选择的构建配置将正确的配置复制到适当的位置。

我还注意到这里已经有一个类似的[问题](https://stackoverflow.com/questions/305447/using-different-web-config-in-development-and-production-environment)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-11-14T20:13:45.927

转换似乎对此非常有帮助。您可以用不同的规则替换某些部分。

[http://msdn.microsoft.com/en-us/library/dd465318(v=vs.100).aspx](http://msdn.microsoft.com/en-us/library/dd465318(v=vs.100).aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-26T22:15:29.767

我们一直这样做的方式是覆盖 AppSettings 部分：

```
<appSettings file="../AppSettingsOverride.config">
    <add key="key" value="override" />    
    ...
</appSettings> 
```

这仅适用于 appSettings 部分，因此仅在一定程度上有用。我会对更强大的解决方案非常感兴趣。

在下面编辑

刚刚看了这个： [http ://channel9.msdn.com/shows/10-4/10-4-Episode-10-Making-Web-Deployment-Easier/](http://channel9.msdn.com/shows/10-4/10-4-Episode-10-Making-Web-Deployment-Easier/)

VS2010 具有看起来非常棒的配置转换，应该使多个配置变得轻而易举。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T22:15:37.003

在 Visual Studio 中，我创建 xcopy 构建事件并将所有配置文件存储在 /config 文件夹中。如果在构建配置之后命名文件，则所有配置只需要一个事件：即用 /config/web.$(Configuration).config 覆盖 web.config

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-26T22:37:46.687

我最喜欢的解决方法是使用`configSource`属性。`<connectionStrings>`诚然，我只在一个元素（

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-26T22:41:03.870

我还使用 web.DEV.config、web.TEST.config、web.PROD.config 等。

如果您的项目不复杂，我发现这种方式是最简单、最简单、最直接的方式。我不喜欢让事情变得比必要的更复杂。

但是，我使用过 NAnt，我认为它适用于此。您可以为不同的环境设置构建。NAnt 需要一些阅读来学习如何使用它，但它非常灵活。

[http://aspnet.4guysfromrolla.com/articles/120104-1.aspx](http://aspnet.4guysfromrolla.com/articles/120104-1.aspx)

[http://nant.sourceforge.net/](http://nant.sourceforge.net/)

我将它与 CruiseControl.net 和 NUnit 一起使用，通过单元测试验证执行自动日常构建，并认为它们可以很好地协同工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-26T22:12:46.183

这实际上取决于导致您使用不同 web.config 文件的环境之间的差异。您能否提供更多信息，说明为什么每个环境当前需要不同的环境？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-26T22:18:39.133

我们有一些解决方法（并非所有这些都使用 web.config 完成，但想法相同）

1.  我们在打包部署中包含多个配置文件。在安装期间，我们指定要安装的环境。
2.  将所有环境特定设置迁移到该环境的数据库服务器。WebServer 在请求服务器名称时提供其环境
3.  提供多个设置（每个环境 1 个）并使用代码请求不同的设置。
4.  2 和 3 的组合（根据环境覆盖部分设置 - 例如应用服务器名称）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-26T22:23:32.163

通过大多数不同的版本管理软件（subversion、git 等），您可以忽略特定文件。

因此，在颠覆中，我有：

configure.template.php - 此文件是版本化的，包含模板化配置数据，例如空 DSN 的 configure.php - 此文件被忽略，因此不会跟踪对它的更改。

在颠覆中，这样做的方法是：

svn pe svn：忽略。它会打开你的编辑器，然后你输入 configure.php

保存、退出、签入您的更改，一切顺利。

# matlab - MATLAB：从“命令行”确定依赖项，不包括内置依赖项

> ID：592680
> 
> 赞同：3
> 
> 时间：2009-02-26T22:10:57.093
> 
> 标签：matlab, dependencies, code-analysis

有没有办法确定 .m 文件的所有依赖关系以及它使用脚本中的命令（命令行）调用的文件的任何依赖关系？

之前有一个这样的问题，真的很好，因为它建议使用该`depfun`功能。但问题在于它正在输出它所依赖的[MATLAB相关文件。](http://en.wikipedia.org/wiki/MATLAB)

示例：testing.m

```
disp('TESTING!!'); 
```

depfun('testing') 的输出

```
'C:\testing.m'
'C:\MATLAB\R2008a\toolbox\matlab\datatypes\@opaque\char.m'
'C:\MATLAB\R2008a\toolbox\matlab\datatypes\@opaque\double.m'
'C:\MATLAB\R2008a\toolbox\matlab\datatypes\@opaque\toChar.m'
'C:\MATLAB\R2008a\toolbox\matlab\elfun\log10.m'
'C:\MATLAB\R2008a\toolbox\matlab\elmat\ans.m' 
```

等等

名单有点长。

这里的重点是我希望有一些类似的功能或标志可以删除这些不需要的依赖项。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T22:58:31.613

[当我编写一个简单的函数来为 m 文件创建目录](http://www.mathworks.com/matlabcentral/fileexchange/20164)时，我发现以下几个链接很有帮助：

*   讨论未记录函数[MLINTMEX的线程](http://www.mathworks.co.uk/matlabcentral/newsreader/view_thread/145245)
*   Urs Schwarz 在 MathWorks 文件交换上的[FDEP](http://www.mathworks.com/matlabcentral/fileexchange/17291)
*   [FARG](http://www.mathworks.com/matlabcentral/fileexchange/15924) by Urs Schwarz 在 MathWorks 文件交换上

编辑：由于这个问题激起了我的好奇心，我开始尝试一些可能接近它的方法。查找对非工具箱 .m 和 .mex 文件的依赖关系相对简单（我在 MATLAB 版本 7.1.0.246 中执行此操作）：

```
fcnName = 'myfile.m';
fcnList = depfun(fcnName,'-quiet');
listIndex = strmatch('C:\Program Files\MATLAB71\toolbox',fcnList);
fcnList = fcnList(setdiff(1:numel(fcnList),listIndex)); 
```

在这里，我只是使用[DEPFUN](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/depfun.html)来获取依赖项，然后我删除了所有以“C:\Program Files\MATLAB71\toolbox”开头的文件，MATLAB 工具箱位于我的机器上。请注意，这假设您没有将任何自己的代码放在这些 MATLAB 目录中（无论如何您都不应该这样做）。

为了获得对 .mat 和 .txt 文件的依赖，我采用了另一种方法。对于从上述代码中获得的每个文件，您可以将文件的文本加载到 MATLAB 中并使用正则表达式对其进行解析，以查找以“.mat”或“.txt”结尾的字符串：

```
fid = fopen(fcnName,'rt');
fcnText = fscanf(fid,'%c');
fclose(fid);
expr = '[^\'']\''([^\''\n\r]+(?:\w\.(?:mat|txt)){1})\''[^\'']';
dataFiles = regexp(fcnText,expr,'tokens');
dataFiles = unique([dataFiles{:}]).'; 
```

我使用的正则表达式有一些限制：

*   如果你有一个像'help.txt'这样的字符串出现在一个注释中（比如一个函数的帮助注释块），它仍然会被正则表达式检测到。我尝试使用环视运算符解决此问题，但运行时间太长。

*   如果您从变量构建字符串（例如“fileString = [someString '.mat']”），则正则表达式不会检测到它。

*   返回的文件名字符串将是相对路径字符串。换句话说，如果函数中有字符串 'help.txt' 或 'C:\temp\junk.mat'，正则表达式匹配将返回 'help.txt' 或 'C:\temp\junk.mat '，正如它们在函数中出现的那样。要查找完整路径，您可以对每个数据文件使用[WHICH](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/which.html)函数（假设文件位于 MATLAB 路径的某个位置）。

希望你觉得这些有用！=)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T22:47:57.147

试试TMW [FileExchange](http://www.mathworks.com/matlabcentral/fileexchange/7434)的 DepSubFun。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T16:15:01.667

感谢您到目前为止的回复。

我不认为这些都是我想要完成的。

我希望已经有一些东西可以确定在主 m 文件中调用的本地函数，将它们添加到列表中，然后继续查看每个函数，直到没有剩余。似乎这些解决方案中的任何一个都没有这样做

我想出了一个我将尝试实施的计划。这可能有点蛮力，设计可能会随着我的工作而改变，但这里是概念。

在这个初始设计中有很多假设，但由于它主要是针对我和其他一些人的，所以我认为这对我的一般解决方案来说不是一个大问题。

要查找的文件类型：.m .mat .mex* .txt（将根据需要更新）

确定 matlabpath 并清除*工具箱*路径（这是假设您的工作目录不称为工具箱或您没有添加到其他工具箱的任何特殊 m 文件的地方）

希望只留下您使用的目录并且可以从中调用函数。（还假设您没有硬编码某种类型的 [run 'C:\random\myscript.m']

蛮力部分：查找您感兴趣的文件类型，并列出您的工作目录（pwd）中的文件类型和剩余的 matlab 路径

删除与工作目录中匹配的文件名。

遍历搜索每个文件名的主 m 文件，如果找到，将其添加到依赖文件数组中。从原始列表中删除依赖文件。使用“新”原始列表搜索依赖文件列表，重复直到没有文件或根本没有匹配。

到目前为止，这只是我的概念，我也会搜索更多。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-04T03:41:14.997

我今天终于运行了这个脚本，它是一个基于 Windows matlab 的脚本，因为它调用了 '!findstr "something" file.txt'。（我更喜欢 grep 但不知道 matlab 等价物。

我要问我的老板是否允许我将其发布在 matlab 文件交换上以与他人分享，所以希望我能很快用链接更新它。

gnovice：我没有足够的代表来评论 gnovice 对我在编写代码之前写的描述的评论。

但基本上要确定它的作用是获取所有文件的文件名（分为文件类型类别），剥离完整路径名和扩展名，使用上面提到的 !findstr 命令在您正在构建的 .m 文件中搜索它依赖并将其输出到 temp.txt 文件（这是因为我无法找到一种方法来在命令的输出上获得 1 或 0 或 isempty 返回）

这是我个人搜索以确定是否使用每个文件的细分：

.m : 'filename ' 或 'filename(' % 涵盖了 'filename (' case .mex* : 与上面相同 .mat : 与上面相同，但将更改为某种负载和 'filename.mat ' 明天可能会处理这个 .txt ：只需搜索 'filename.txt'

使用这种方法，您最终可能会得到一些额外的文本文件或 .m 文件，但这里的关键是您至少*应该拥有所需的所有文件。*

它还递归地在所有依赖文件上调用自身，以便它们的依赖关系也被考虑在内。

-迟迟

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-28T19:48:07.230

我很久以前写过代码来为八度音程做这个。我主要使用它来为graphviz生成.dot文件来可视化依赖关系，但我也在makefile中使用它来在编译代码时包装依赖关系。不幸的是，它是 perl 代码，但您可以通过 shell 调用它来从脚本运行它。它是完全递归的。

要运行它，您必须将 OCT_BASE 更改为指向代码的根目录。（对不起，它不是 matlab 的路径变量感知）。那么我可能会将它作为 perl octavedepgrapher.pl -l 运行

```
 #! /bin/sh
exec perl -x -S $0 ${1+"$@"} # -*-perl-*-
#!perl
#
# octavedepgrapher.pl
# find the dependancy graph of octave file(s). prints a 
# dot file suitable for graphviz
# Author: steven e. pav
# Created: 2006.07.16
# SVN: $Id$
#
# * Thu Aug 30 2007 Steven Pav 
# - expanding to recognize matlabs pragma of %#function funcname
# version 0.3   2007.04.17
#  add raw output mode.
# version 0.2   2007.03.05
#  add media selection
# version 0.1   2006.08.24
#  fixed multiple functions within file.
#  added multiple edgeout capability.
#  adding clusters for files.
# version 0.0   2006.07.16
#  created.
#
#
########################################################################

########################################
# change only this
########################################

#@OCT_BASE = qw(/home/spav/sys/octave/m/ ./ $ENV{OCTAVE});
@OCT_BASE = qw(/home/spav/sys/octave/m/ ./);

########################################################################

$VERSION = "octavedepgrapher    version 0.02   2006.08.23\n";

########################################################################

use Getopt::Long;
$Getopt::Long::ignorecase = 0;
$Getopt::Long::order = $PERMUTE;

%OPT_MEANINGS = (
                 'H' => 'show Help.',
                 'l' => 'list the dependencies to standard out. do not make a dot file.',
                 'p' => 'give full path names.',
                 'm' => 'multi-edge. one for each function call.',
                 'g' => 'map connections from functions to global variables.',
                 'G' => 'map connections between functions which share global variables.',
                 'C' => 'do not cluster files.',
                 'D' => 'Debug.',
                 'd=s' => 'dependency mode for makefiles.  sets -p and -l, and but outputs in makefile suitable format. the string is the extension (with dot) to substitute for .m',
                 'r=s' => 'aspect ratio (can be fill, auto, compact (default))',
                 'B=s' => 'base directory. if given, all directories are assumed relative to this one.',
                 'L=s' => 'colon separated list of base directories of libraries (_overrides_ OCT_BASE). should probably include ./',
                 'l=s' => 'colon separated list of base directories of libraries (in addition to OCT_BASE).',
                 'X=s' => 'colon separated list of base directories to exclude in the search.',
                 'M=s' => 'media selection',
                 );

$OPTS = join('',(map { substr($_,0,1); } keys(%OPT_MEANINGS)));

&GetOptions(keys %OPT_MEANINGS);

$opt_H && &die_usage;                                       #done
$opt_L && (@OCT_BASE = split(/\s*:\s*/,$opt_L));
$opt_l && (push(@OCT_BASE,split(/\s*:\s*/,$opt_l)));
$opt_X && (@OCT_BASE = @{&rm_dirs(\@OCT_BASE,$opt_X)});

if (not $opt_M)
{ $size="25,20";
} else {
    ($opt_M =~ m/^legal/i) and $size = '8.5,14';
    ($opt_M =~ m/^letter/i) and $size = '8.5,11';

    ($opt_M =~ m/^A0$/i) and $size = '33.1,46.8';
    ($opt_M =~ m/^A1$/i) and $size = '23.4,33.1';
    ($opt_M =~ m/^A2$/i) and $size = '16.5,23.4';
    ($opt_M =~ m/^A3$/i) and $size = '11.7,16.5';
    ($opt_M =~ m/^A4$/i) and $size = '8.3,11.7';
    ($opt_M =~ m/^A4dj$/i) and $size = '8.3,11.7';
    ($opt_M =~ m/^A5$/i) and $size = '5.8,8.3';
}

#if (not $opt_r) { $ratio = 'fill'; } else { $ratio = $opt_r; }
$ratio = $opt_r || 'fill';

if ($opt_d)
{
    $opt_l = $opt_p = 1;
}

#make sure it has a tailing slash.
if ($opt_B)
{
    ($opt_B !~ m{/$}) && ($opt_B .= q[/]);
}

########################################################################

$| = 1;
if (! @ARGV)
{
    &die_usage;
} else
{
    %mfhash  = &map_name_to_filename(@ARGV);
}

if ($opt_d)
{
    @myargv     = @ARGV;
    print join(' ',map { s/\.m/$opt_d/e;$_; } @ARGV),qq[ : ];
}

if ($opt_l) {
    %bdhash = &find_base_libs(@OCT_BASE);
    $alldepref  = &find_all_deps(\%mfhash,\%bdhash,0);
    print join(' ',@{$alldepref}),qq[\n];
} else {
    &print_head();
    %bdhash = &find_base_libs(@OCT_BASE);
    &find_all_deps(\%mfhash,\%bdhash,1);
    &print_tail();
}

$opt_X && (@OCT_BASE = @{&rm_dirs(\@OCT_BASE,$opt_X)});
########################################################################
sub
    rm_dirs
    #remove directories from OCT_BASE
{
    my $ob_ref = shift(@_);
    my $oX = shift(@_);
    my @excludeus = split(/\s*:\s*/,$oX);

    #FIX!

}

########################################################################
sub
    make_relative
    #just for the sake of opt_B#FOLDUP
{
    my $fullname = shift(@_);
    if ($opt_B)
    {
        $fullname =~ s{\Q$opt_B\E}{};
    }
    return $fullname;
}#UNFOLD
########################################################################
sub
    map_name_to_filename#FOLDUP
{
    my $mfile;
    my %mfiles;
    my $mfstub;
    while ($mfile = shift(@_))
    { 
        $mfstub = $mfile;
        $mfstub =~ s/^\s*(.*\/)?([^\/]+)\.m\s*$/$2/;
        $mfiles{$mfstub} = $mfile;
    }
    return %mfiles;
}#UNFOLD

########################################################################
sub
    find_base_libs#FOLDUP
{
    my $based;
    my %bdhash;
    my ($mfile,$mfstub);
    my @mfiles;
    while ($based = shift(@_))
    { 
#           print "|$based|\n";
        @mfiles = split(/\n/,qx(cd $based && find . -name '*.m'));
        while ($mfile = shift(@mfiles))
        {
            $mfstub = $mfile;
            $mfstub =~ s/.+\/([^\/]+)\.m/$1/;
            $mfile  =~ s/^\s*\.\//$based/;
            $bdhash{$mfstub} = $mfile;
            #print STDERR "|$mfstub| -> |$mfile| |$based|\n";
        }
    }
    return %bdhash;
}#UNFOLD

########################################################################
#returns array of all the dependencies as filename strings.
sub
    find_all_deps#FOLDUP
{
    my $mfhashref = shift(@_);
    my $bdhashref = shift(@_);
    my $doprint     = shift(@_);            #if 0, do not print anything out.
    my @mfhashlist = %{$mfhashref};
    my %bdhash = %{$bdhashref};
    my $output = [];
    my %globals;
    my $gname;
    my %doneok;
    my ($mfname,$mfloc);
    my ($aline,$acommand,$copyline);
    my %eegraph;                            #store as node::node in this hash set.
                              #prevents edges from being written multiple times?
    my %dangling = {};              #any command which has yet to be found.
                              #store vals a list of things which want to point in.
    my $pointsin;
    my $foundnewfunc;
    my $foundFuncPragma;            #for looking for %  #function fname stuff
    #my @myDependencies;       #every function that I call;

    my $edgestr = '';

    while ($mfname = shift(@mfhashlist))#FOLDUP
    {
        $mfloc  = shift(@mfhashlist);
        $mf_alias = ($opt_p)? &make_relative($mfloc) : $mfname;     #full names or not

        #prevent node -> self edges.
        $eegraph{qq(${mfname}::${mfname})} = 1;

        if ((! $opt_C) && $doprint)
        {
            print qq(subgraph cluster_$mfname {\n);
            print qq(rank=min\n);
            print qq(ordering=out\n);
        }
        #node
        $doprint && 
            print qq{$mfname [label="$mf_alias" shape=plaintext fontsize=44]\n};
        push (@{$output},$mf_alias);

        $doneok{$mfname} = 1;

        #open a file#FOLDUP
        open (FH,"$mfloc") || die "no open $mfloc, $!";

         while (! eof(FH))
         {
             $aline = ;
             chomp($aline);
             $foundFuncPragma       = 0;

             if ($aline =~ /^[^%]*end\s*%?\s*function/) { $mfname = ''; }

             if ($mfname)       #inside a function
             {
                 if ($opt_g || $opt_G)          #look for globals#FOLDUP
                 {
                        if ($aline =~ /global/)
                        {
                            $copyline       = $aline;
                            while ($copyline =~ s/(global\s+)([^;\s]+)(\s*;)/$1$3/)
                            {
                                $gname  = $2;
                                if (exists $globals{$gname})
                                {
                                    push(@{$globals{$gname}},$mfname);
                                } else {
                                    $globals{$gname}    = [$mfname];
                                }
                            }
                        }
                 }#UNFOLD

                    #look for #function pragma
                 $foundFuncPragma = ($aline =~ s/%\s*#function\s+(.+)$//);
                 if ($foundFuncPragma)
                 { 
                        $opt_D && (print STDERR "found a function pragma! |$1|\n");
                        #what a bummer that we can't just use this: the
                        #problem is that we don't really know when a function
                        #ends in .m code, b/c endfunction is not required. bummer.
                        #push (@myDependencies,split(/\s+/,$1));
                        #
                        #that is, what we would really like to do is just push onto a list
                        #every time we saw a command, then puke at the end of the function,
                        #but we do not know really when a function ends in matlab. oops.
                        foreach $acommand (split(/\s+/,$1))
                        {
                            $opt_D && (print STDERR "found a command! |$acommand|\n");
                            #push (@myDependencies,$acommand);

                            if (exists($bdhash{$acommand}))
                            {
                                $opt_D && (print STDERR "exists in bdhash (prolly means is a file to itself)\n");
                                if (! $eegraph{qq(${mfname}::${acommand})})
                                {
                                    if ($opt_C) { $doprint && print "$mfname -> $acommand\n";
                                    } else { $edgestr .= "$mfname -> $acommand\n"; }

                                    if (! $opt_m) { $eegraph{qq(${mfname}::${acommand})} = 1; }
                                } 

                                if (! $doneok{$acommand})
                                {
                                    $doneok{$acommand} = 1;
                                    push(@mfhashlist,$acommand,$bdhash{$acommand});
                                }
                            } else
                            {
                                if (exists($dangling{$acommand}))
                                { push(@{$dangling{$acommand}},$mfname);
                                } else { $dangling{$acommand} = [$mfname]; }
                            }
                        }
                 }

                 while ($aline =~ /([a-zA-Z0-9_]+)\s*\(/)#FOLDUP
                 {
                    $aline =~ s/([a-zA-Z0-9_]+)\s*\(//;
                    $acommand = $1;

                    $opt_D && (print STDERR "found a command! |$acommand|\n");
                    #push (@myDependencies,$acommand);

                    if (exists($bdhash{$acommand}))
                    {
                        $opt_D && (print STDERR "exists in bdhash (prolly means is a file to itself)\n");
                        if (! $eegraph{qq(${mfname}::${acommand})})
                        {
                            if ($opt_C) { $doprint && print "$mfname -> $acommand\n";
                            } else { $edgestr .= "$mfname -> $acommand\n"; }

                            if (! $opt_m) { $eegraph{qq(${mfname}::${acommand})} = 1; }
                        } 

                        if (! $doneok{$acommand})
                        {
                            $doneok{$acommand} = 1;
                            push(@mfhashlist,$acommand,$bdhash{$acommand});
                        }
                    } else
                    {
                        if (exists($dangling{$acommand}))
                        { push(@{$dangling{$acommand}},$mfname);
                        } else { $dangling{$acommand} = [$mfname]; }
                    }
                 }#UNFOLD
             } else             #not yet inside a function.
             {
                 $foundnewfunc = 0;
                 if ($aline =~ /^[^%]*function\s+[^=]*=\s*([a-zA-Z0-9_]+)\s*(\(|;|%|$)/)
                 {
                     $mfname = $1;$foundnewfunc = 1;
                 } elsif ($aline =~ /^[^%]*function\s+([a-zA-Z0-9_]+)\s*(\(|;|%|$)/)
                 {
                     $mfname = $1;$foundnewfunc = 1;
                 } 

                 if ($foundnewfunc)
                 {
                     #@myDependencies = ();
                    $opt_D && (print STDERR "now looking at function |$mfname|\n");
                     $eegraph{qq(${mfname}::${mfname})} = 1;
                     #subnode
                     $doprint && print "$mfname [shape=box]\n";

                     $doneok{$mfname} = 1;
                     $bdhash{$mfname} = 1;              #innocent enough since doneok is set too.

                     if (exists($dangling{$mfname}))
                     {
                         while ($pointsin = shift(@{$dangling{$mfname}}))
                         {
                                $doprint && print "$pointsin -> $mfname\n";
                         }
                     }
                 }
             }
         }
        close FH;#UNFOLD
        if (! $opt_C)
        {
            $doprint && print qq(}\n);
            $doprint && print $edgestr;
            $edgestr = '';
        }
    }#UNFOLD

    if ($doprint)
    {
        if ($opt_g)
        {
            foreach $key (keys(%globals))
            {
                print qq{$key [style=dotted label="$key" color=red shape=plaintext fontsize=44]\n};
                foreach $f (@{$globals{$key}})
                {
                    print qq{$f -> $key [color=red]\n};
                }
            }
        } elsif ($opt_G)
        {
            foreach $key (keys(%globals))
            {
                while (defined($g = shift(@{$globals{$key}})))
                {
#                   foreach $f (@{$globals{$key}}) { print qq{$g -- $f [color=red]\n}; }
                    foreach $f (@{$globals{$key}}) { print qq{$g -> $f [style=dotted label="$key" fontsize=30 fontcolor=red color=red]\n}; }
                }
            }
        }
    }

    return $output;
}#UNFOLD

########################################################################

sub
    print_head#FOLDUP
{
    if (! $opt_m)
    {
        print qq[strict ];
    }
#   if ($opt_G) { print qq[octavedep {\n]; } else { print qq[digraph octavedep {\n]; }
    print qq[digraph octavedep {\n];
    print qq[nslimit=15.0\n];
    print qq[mclimit=1.0\n];
    print qq[ratio="$ratio"\n];
    print qq[size="$size"\n];
}#UNFOLD

sub
    print_tail#FOLDUP
{
    print "}\n";
}#UNFOLD

########################################################################
sub 
    die_usage#FOLDUP
{
#   print STDERR "usage: perl $0 [-$OPTS] [-$VALOPTS val] octfiles\n\n";
    print STDERR "usage: perl $0 [-$OPTS] octfiles\n\n";

    if ($opt_H) 
    {
        %OPT_MEANINGS = 
            map {($a=$_)=~s/(.)+?[=:!]?[ifs]?/$1/;$a=>$OPT_MEANINGS{$_};}    
            keys %OPT_MEANINGS;
        @OPTS = split(//,$OPTS);
        while ($OP = shift(@OPTS)) {
            print STDERR "      $OP   $OPT_MEANINGS{$OP}\n";
        }
        print STDERR "\n";
    } 

    exit;
}#UNFOLD
########################################################################
__END__ 
```

为我工作...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T22:58:52.690

另一种方法是排除不需要的文件夹： localdep = depfunresult(cellfun(@isempty,regexp(a,'toolbox'))); 您可以在那里使用任何正则表达式模式。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-26T20:39:36.000

尽管 depfun 没有提供“ignore-builtins”选项，但它确实为我们提供了一个“-toponly”选项，我们可以在我们自己的递归函数中使用它，它确实排除了内置函数并运行得更快。以下是我的解决方案：

```
function new_file_list = fastdepfun(paths)
% new_file_list = fastdepfun(paths)
% paths = same input as you use with depfun

[file_list] = depfun(paths,'-toponly','-quiet');

% Remove builtins (implement this part however you like)
mroot = matlabroot;
file_list = file_list(~strncmp(file_list,mroot,length(mroot)));

% Remove files already inspected (otherwise we get stuck in an infinite loop)
new_file_list = setdiff(file_list,paths);

if ~isempty(new_file_list)
    new_file_list = fastdepfun(new_file_list);
end
new_file_list = unique([file_list; new_file_list]); 
```

# .net - 在运行时动态加载程序集依赖项的问题

> ID：592681
> 
> 赞同：4
> 
> 时间：2009-02-26T22:11:13.473
> 
> 标签：.net, reflection, assembly-resolution

让我试着解释我的问题。我目前正在尝试开发一个用 .Net 编写的小型“插件框架”（主要用于试验）。所以这个想法是有一个主应用程序，可以通过在主应用程序的特定文件夹“插件”中部署 dll 来添加“插件”。一切正常，插件已正确实例化，但是现在我遇到了问题。我现在已经部署了一个插件“X”，它使用了额外的第 3 方插件，所以现在我遇到的问题是在运行时找不到“X”所需的这些额外的第 3 方插件。因此，我现在的想法是添加一个额外的目录“依赖项”，我还部署了所有需要的插件。

所以我的第一个问题：如何将程序集加载到应用程序域中（假设我知道它们的路径）它们可以被我的应用程序使用？

我试图通过做类似的事情来解决这个问题：

```
AppDomain.CurrentDomain.AssemblyResolve += new ResolveEventHandler(CurrentDomain_AssemblyResolve);

System.Reflection.Assembly CurrentDomain_AssemblyResolve(object sender, ResolveEventArgs args)
{
    //find the path to the assembly and then load and return it by
    //return Assembly.Load("pathToDependencies/failedAssembly.dll");
} 
```

问题是这个事件处理程序现在被激活，在 args 变量中有“Presentation.Zune.dll”（我正在使用 WPF 应用程序）。似乎该程序集加载失败，但实际问题是另一个 dll。

有人可以建议我更好的方法来解决我的问题吗？我希望我能够充分解释我的情况，否则只是要求进一步澄清。

谢谢，朱里

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-26T22:27:15.603

您可以设置运行时的探测路径，以便它可以找到程序集。在您的应用程序配置文件中设置[探测](http://msdn.microsoft.com/en-us/library/823z9h8w.aspx)元素。

```
<configuration>
  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <probing privatePath="plugins;dependencies"/>
    </assemblyBinding>
  </runtime>
</configuration> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T22:21:15.290

[该`AssemblyResolve`事件在框架尝试加载程序集但失败时发生。](http://msdn.microsoft.com/en-us/library/system.appdomain.assemblyresolve.aspx)

这意味着如果它`Presentation.Zune.dll`在 args 中为您提供，则框架无法找到该程序集，这是您拦截它并执行其他操作的机会，例如从框架可能不知道的目录中加载它 -例如，您的 plugins\dependencies 文件夹...

在我的脑海中，我会尝试这样的事情：

```
Assembly CurrentDomain_AssemblyResolve(object sender, ResolveEventArgs args)
{
    if( File.Exists(".\\Plugins\\"+args.Name) )  // it's a plugin
        return Assembly.Load(".\\Plugins\\"+args.Name);
    else if( File.Exists(".\\Plugins\\Dependencies\\"+args.Name) )  // it's a dependency OF a plugin
        return Assembly.Load(".\\Plugins\\Dependencies\\"+args.Name);
    else
        throw new Exception();
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-14T20:26:33.157

顺便说一句：如果您缓存已经在字典中解析的程序集，则可以大大加快加载程序集的速度。如果 A 依赖于 B，C 和 B 依赖于 C 并且你加载 A，AssemblyResolve 将为 C 调用两次，并且只加载一次程序集更快:)

（我不确定是否总是多次调用 AssemblyResolve，但我在调试项目一次时注意到了它。缓存程序集并没有什么坏处......）

# javascript - 样式为切换按钮的 HTML 单选按钮

> ID：592684
> 
> 赞同：2
> 
> 时间：2009-02-26T22:12:36.670
> 
> 标签：javascript, html, controls

我希望将选项显示为可点击的按钮，而不是让典型的磁盘带有右侧的标签。选定的选项应该看起来被推入或压入。

我想在 HTML 中执行此操作，但一个示例是 Audacity 程序中的左上角按钮，您可以在其中选择光标/工具模式。

最好的方法是什么？

[![替代文字](https://i.stack.imgur.com/ELh9n.jpg)](https://i.stack.imgur.com/ELh9n.jpg)
[（来源：[freemusicsoftware.info](http://freemusicsoftware.info/screenshots/audacity-linux-small.jpg)）]

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T22:20:17.773

有许多 JavaScript 插件可以做到这一点：

*   [原型演示](http://codetalks.org/source/widgets/checkbox/checkbox1.html)

只需将他们正在使用的图像替换为您的图像，您就可以开始使用了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T22:17:50.027

可能最好的方法是创建一个真正的单选按钮，然后使用 javascript 根据单选按钮上的状态控制元素的呈现。如果选择了单选按钮，则渲染背景-a，否则渲染背景-b（或使用精灵）。通过自定义元素的单击事件控制单选按钮的状态。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T22:21:34.853

使用[这个 jQuery UI 插件](http://www.protofunc.com/scripts/jquery/checkbox-radiobutton/)，您可以自定义单选按钮和/或复选框，使其看起来像您想要的那样。

# javascript - 如何使用 WPF WebBrowser 覆盖网页上的 btnSubmit_onclick javascript 函数？

> ID：592688
> 
> 赞同：0
> 
> 时间：2009-02-26T22:13:44.933
> 
> 标签：javascript, wpf, browser, mshtml, overwrite

我正在使用与`WebBrowser`WinForms 版本不同的 WPF 控件，并且来自这个优秀网站的许多建议在 WPF 中根本不起作用。

如何覆盖`btnSubmit_onclick()`网页上的 javascript 函数？

这个函数会生成一个我想绕过的确认对话框（比如“你确定吗？”）。基本上我想注入一个新功能`btnSubmit_onclick()`来替换现有的功能，我可以省略烦人的确认对话框。我可以访问 MSHTML 和所有页面对象，但很难在页面标题处注入脚本。到目前为止，我有：

```
mshtml.IHTMLDocument2 doc = (mshtml.IHTMLDocument2)webBrowser.Document;
mshtml.IHTMLElementCollection heads = doc.all.tags("head") as mshtml.IHTMLElementCollection;
mshtml.IHTMLElement head = heads.item(null, 0) as mshtml.IHTMLElement;
mshtml.IHTMLElement se = doc.createElement("script") as mshtml.IHTMLElement;
se.innerHTML = "function btnSubmit_onclick() { alert('here we are'); }"; 
```

但是现在我需要在其他脚本之前将这个新的脚本元素注入到头对象中，我希望它会在`btnSubmit_onclick()`下游覆盖现有的函数。

我没有成功尝试 head.injectAdjusentHTML，即使我使用 DEFER 属性，它也拒绝将任何脚本注入到标题中。

我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-06-17T21:06:41.910

我认为您需要将它添加到头部的末尾，而不是在其他之前注入它。我相信 javascript 是一种最后一胜的交易。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-25T23:37:32.717

我没有测试过，只是一个猜测：试试这个：

```
// For this code to work: add the Microsoft.mshtml .NET reference
mshtml.IHTMLDocument2 doc = WebBrowser1.Document as mshtml.IHTMLDocument2;
doc.parentWindow.execScript("document.body.onsubmit=new function(){ alert('here we are'); };"); 
```

# asp.net - 有人可以帮助我解决导致按钮禁用的 AJAX 竞争条件吗？

> ID：592691
> 
> 赞同：0
> 
> 时间：2009-02-26T22:14:21.673
> 
> 标签：asp.net, ajax

我有一个 AJAX 问题。我认为 ASP.NET 页面上有一些按钮在回发时被禁用并重新启用，这需要出于其他原因完成。更新面板中有 2 个下拉菜单将使用 AJAX。第一个下拉菜单更新第二个。`onblur`第一个下拉列表中有一个客户端调用 ，如果下拉列表中的某些内容发生更改，则会调用对事件处理程序`__doPostBack`的服务器调用。`onselectedindexchanged`问题是如果客户端`onblur`事件发生得太快，似乎回发发生得太快并且按钮保持禁用状态。

例如，如果用户快速浏览下拉列表，就会发生这种情况。我读过如果服务器响应有点慢并且部分渲染搞砸了，这是一个 AJAX 问题。

有人对此有解决方案吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T06:02:29.317

一个通用的解决方案是使用带有控件的计数器；仅当 <= 0 时递减和禁用，如果 > 0 时递增和启用。:) ++/-- 运算符可能不能保证是原子的，但它们“足够好”。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T18:23:03.247

也许您可以在等待 AJAX 方法完成并在 onselectedindexchanged 事件方法中运行代码之前使用标记的布尔变量。这样，如果 AJAX 方法没有完成，onselectedindexchanged 事件方法就不会做任何事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-27T18:04:01.220

很难说没有一些代码可以看，但是……记住 AJAX 的第一个字母代表什么：异步。您无法保证您的回调方法何时真正执行。或者，如果你打了两个电话（A 然后 B），你可能会得到一个响应 A 然后 B ......但下一次是 B 然后 A。

# math - 反向透视投影

> ID：592699
> 
> 赞同：4
> 
> 时间：2009-02-26T22:16:55.067
> 
> 标签：math, opengl, 3d, picking, reverseprojection

我正在使用

```
worldview_inverse * (projection_inverse * vector) 
```

将屏幕空间坐标转换为世界空间坐标。我以为

```
(x,y,1,1) 
```

将转换为远平面上的一个点，而

```
(x,y,-1,1) 
```

转换为近平面上的一个点，并连接线我可以查询与线相交的视锥体中的所有对象。转换后，我将结果点除以它们各自的 .w 分量。这适用于远平面，但近平面上的点不知何故被转换为世界空间原点。

我认为这与我输入逆投影的 1 的 w 分量有关，因为通常它在投影之前是 1，而不是之后，我正在做逆投影。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T22:22:22.433

我知道这只是一种解决方法，但是您可以仅使用远点和观察位置来推断近平面点。

```
near_point = view_position
           + (far_point - view_position) * (near_distance / far_distance) 
```

至于你真正的问题。首先，别忘了除以 W！此外，根据您的投影矩阵，您是否尝试过 (x,y,0,1) 而不是 z=-1。

```
near_point = worldview_inverse * (projection_inverse * vector)
near_point /= near_point.W 
```

# ruby-on-rails - 在 Rails 中存储缓存文件的目录？

> ID：592700
> 
> 赞同：1
> 
> 时间：2009-02-26T22:17:13.007
> 
> 标签：ruby-on-rails, ruby

我正在我的 Rails 应用程序中生成一些大文件。幸运的是，它们只需要生成一次。我想将这些文件保存到磁盘，这样我就不必再次生成它们了。

我的 Rails 应用程序中的哪个目录最适合放置应用程序生成的文件？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T22:22:36.020

如果文件的安全性不是问题，您可以将它们放在`public`（例如，`public/assets`）的子目录中，在您的部署脚本中，该子目录被符号链接到其中的目录，`shared/public`以便在重新部署文件时保留。

如果安全是一个问题，则解决方案类似，但您不希望该目录可通过 Web 访问。相反，您将使用控制器来控制访问并使用`send_file`.

# colors - wxPython wxListCtrl 选中的行颜色

> ID：592703
> 
> 赞同：4
> 
> 时间：2009-02-26T22:17:43.503
> 
> 标签：colors, wxpython, row, selected, listctrl

我想让某些行选择颜色为红色而不是标准颜色（Windows 上的蓝色），以便我可以指示状态。任何人都知道这在 wxPython 中是否可行？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-27T21:59:59.077

在您从 wx.ListCtrl 派生的类中，查看覆盖

```
def OnGetItemAttr(self, item):
    return self.normalAttr[item % 2]
# 
```

使用以下方法提前初始化项目属性：

```
 self.normalAttr = []
    self.normalAttr.append(wx.ListItemAttr())
    grayAttr = wx.ListItemAttr()
    grayAttr.SetBackgroundColour(lightGray)
    self.normalAttr.append(grayAttr) 
```

所以在这种情况下，我在默认和浅灰色属性之间交替使用背景颜色。

该函数在每行绘制时调用，因此您可以使用它来指示各种状态。如果选择行应该是一个简单的情况。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-28T05:14:40.123

为了做您想做的事，即选择某些项目时，有不同的选择颜色，您需要陷入Win32。幸运的是，在 python 中做到这一点并不难。但是，它确实使您的代码平台依赖。我今天在一个小程序中试了一下。如果流派不是“摇滚”，我将选择设为橙色。这是一些屏幕截图。

选择的岩石项目 [![替代文字](https://i.stack.imgur.com/Ng6xY.jpg)](https://i.stack.imgur.com/Ng6xY.jpg)

选择的混合项目。请注意，RnB 和 Blues 是用橙色 [替代文本 http://img258.imageshack.us/img258/1307/soshot2.jpg选择的](http://img258.imageshack.us/img258/1307/soshot2.jpg)

这是代码。起初它看起来很吓人，但如果你知道任何 win32，它还不错。我使用[pywin32](http://sourceforge.net/projects/pywin32/)包和 std ctypes 库。我必须定义一些 SDK 常量，因为它们在 win32con 模块中不可用。

```
import sys
import wx
import wx.lib.mixins.listctrl  as  listmix

import win32api
import win32gui
import win32con
import win32gui_struct
import commctrl
import ctypes
from ctypes.wintypes import BOOL, HWND, RECT, UINT, DWORD, HDC, DWORD, LPARAM, COLORREF

LVM_FIRST = 0x1000
LVM_GETSUBITEMRECT=(LVM_FIRST + 56)
LVIR_BOUNDS             =0
LVIR_ICON               =1
LVIR_LABEL              =2
LVIR_SELECTBOUNDS       =3
DEFAULT_GUI_FONT    =17

#LPNMHDR
class NMHDR(ctypes.Structure):
    pass
INT = ctypes.c_int
NMHDR._fields_ = [('hwndFrom', HWND), ('idFrom', UINT), ('code', INT)]
LPNMHDR = ctypes.POINTER(NMHDR)

#LPNMCUSTOMDRAW
class NMCUSTOMDRAW(ctypes.Structure):
    pass
NMCUSTOMDRAW._fields_ = [('hdr', NMHDR), ('dwDrawStage', DWORD), ('hdc', ctypes.c_int), 
                         ('rc', RECT), ('dwItemSpec', DWORD), ('uItemState', UINT),
                         ('lItemlParam', LPARAM)]
LPNMCUSTOMDRAW = ctypes.POINTER(NMCUSTOMDRAW)

#LPNMLVCUSTOMDRAW
class NMLVCUSTOMDRAW(ctypes.Structure):
    pass
NMLVCUSTOMDRAW._fields_ = [('nmcd', NMCUSTOMDRAW), 
                           ('clrText', COLORREF),
                           ('clrTextBk', COLORREF),
                           ('iSubItem', ctypes.c_int),
                           ('dwItemType', DWORD),
                           ('clrFace', COLORREF),
                           ('iIconEffect', ctypes.c_int),
                           ('iIconPhase', ctypes.c_int),
                           ('iPartId', ctypes.c_int),
                           ('iStateId', ctypes.c_int),                           
                           ('rcText', RECT),
                           ('uAlign', UINT)
                           ]
LPNMLVCUSTOMDRAW = ctypes.POINTER(NMLVCUSTOMDRAW)

musicdata = {
1 : ("Bad English", "The Price Of Love", "Rock"),
2 : ("DNA featuring Suzanne Vega", "Tom's Diner", "Rock"),
3 : ("George Michael", "Praying For Time", "Rock"),
4 : ("Gloria Estefan", "Here We Are", "Rock"),
5 : ("Linda Ronstadt", "Don't Know Much", "Rock"),
6 : ("Michael Bolton", "How Am I Supposed To Live Without You", "Blues"),
7 : ("Paul Young", "Oh Girl", "Rock"),
8 : ("Paula Abdul", "Opposites Attract", "Rock"),
9 : ("Richard Marx", "Should've Known Better", "Rock"),
10 : ("Bobby Brown", "My Prerogative", "RnB"),
}

class MyListCtrl(wx.ListCtrl, listmix.ListCtrlAutoWidthMixin):
    def __init__(self, parent, ID, pos=wx.DefaultPosition,
                 size=wx.DefaultSize, style=0):
        wx.ListCtrl.__init__(self, parent, ID, pos, size, style)
        listmix.ListCtrlAutoWidthMixin.__init__(self)

    def ShouldCustomDraw(self, row):
        if self.IsSelected(row):
            listitem = self.GetItem(row, 2)
            genre = listitem.GetText()

            return genre != "Rock"

    def CustomDraw(self, lpcd):        
        if lpcd.contents.nmcd.dwDrawStage == commctrl.CDDS_PREPAINT:
            return (True, commctrl.CDRF_NOTIFYITEMDRAW)

        if lpcd.contents.nmcd.dwDrawStage == commctrl.CDDS_ITEMPREPAINT:                
            if self.ShouldCustomDraw(lpcd.contents.nmcd.dwItemSpec):
                #do custom drawing for non Rock selected rows
                #paint the selection background
                color = win32api.RGB(255, 127, 0) #orange
                brush = win32gui.CreateSolidBrush(color)   
                r = lpcd.contents.nmcd.rc
                win32gui.FillRect(int(lpcd.contents.nmcd.hdc),  (r.left+4, r.top, r.right, r.bottom), brush)                
                win32gui.DeleteObject(brush)
                return (True, commctrl.CDRF_NOTIFYSUBITEMDRAW)                    

        if lpcd.contents.nmcd.dwDrawStage == commctrl.CDDS_ITEMPREPAINT|commctrl.CDDS_SUBITEM:                
            row = lpcd.contents.nmcd.dwItemSpec
            col = lpcd.contents.iSubItem
            item = self.GetItem(row, col)
            text = item.GetText()
            #paint the text
            rc = RECT()
            rc.top = col
            if col > 0:
                rc.left = LVIR_BOUNDS
            else:
                rc.left = LVIR_LABEL
            success = win32api.SendMessage(self.Handle, LVM_GETSUBITEMRECT, row, ctypes.addressof(rc))
            if col > 0:
                rc.left += 5
            else:
                rc.left += 2
            rc.top += 2

            if success:                
                oldColor = win32gui.SetTextColor(lpcd.contents.nmcd.hdc, win32gui.GetSysColor(win32con.COLOR_HIGHLIGHTTEXT))                
                win32gui.DrawText(lpcd.contents.nmcd.hdc, text, len(text), (rc.left, rc.top, rc.right, rc.bottom), win32con.DT_LEFT|win32con.DT_VCENTER)
                win32gui.SetTextColor(lpcd.contents.nmcd.hdc, oldColor)                                

            return (True, commctrl.CDRF_SKIPDEFAULT)

        # don't need custom drawing
        return (True, commctrl.CDRF_DODEFAULT)

class MyFrame(wx.Frame):
    def __init__(self, *args, **kwds):
        wx.Frame.__init__(self, *args, **kwds)
        self._sizer = wx.BoxSizer(wx.VERTICAL)
        tID = wx.NewId()
        self._ctl = MyListCtrl(self, tID,
                                 style=wx.LC_REPORT 
                                 #| wx.BORDER_SUNKEN
                                 | wx.BORDER_NONE
                                 | wx.LC_EDIT_LABELS
                                 | wx.LC_SORT_ASCENDING
                                 #| wx.LC_NO_HEADER
                                 #| wx.LC_VRULES
                                 #| wx.LC_HRULES
                                 #| wx.LC_SINGLE_SEL
                                 )
        self._sizer.Add(self._ctl, 1, wx.EXPAND, 3)
        self.PopulateList()

        self.oldWndProc = win32gui.SetWindowLong(self.GetHandle(), win32con.GWL_WNDPROC, self.MyWndProc)

    def MyWndProc(self, hWnd, msg, wParam, lParam):

        if msg == win32con.WM_NOTIFY:
            hwndFrom, idFrom, code = win32gui_struct.UnpackWMNOTIFY(lParam)
            if code == commctrl.NM_CUSTOMDRAW and hwndFrom == self._ctl.Handle:                
                lpcd = ctypes.cast(lParam, LPNMLVCUSTOMDRAW)
                retProc, retCode = self._ctl.CustomDraw(lpcd)

                if retProc:
                    return retCode

        # Restore the old WndProc.  Notice the use of wxin32api
        # instead of win32gui here.  This is to avoid an error due to
        # not passing a callable object.
        if msg == win32con.WM_DESTROY:
            win32api.SetWindowLong(self.GetHandle(),
                              win32con.GWL_WNDPROC,
                              self.oldWndProc)

        # Pass all messages (in this case, yours may be different) on
        # to the original WndProc
        return win32gui.CallWindowProc(self.oldWndProc,
                                  hWnd, msg, wParam, lParam)

    def PopulateList(self):
        self._ctl.InsertColumn(0, "Artist")
        self._ctl.InsertColumn(1, "Title")
        self._ctl.InsertColumn(2, "Genre")

        items = musicdata.items()

        for key, data in items:            
            index = self._ctl.InsertStringItem(sys.maxint, data[0])
            self._ctl.SetStringItem(index, 1, data[1])
            self._ctl.SetStringItem(index, 2, data[2])
            self._ctl.SetItemData(index, key)

        self._ctl.SetColumnWidth(0, wx.LIST_AUTOSIZE)
        self._ctl.SetColumnWidth(1, wx.LIST_AUTOSIZE)
        self._ctl.SetColumnWidth(2, 100)

        self.currentItem = 0

class MyApp(wx.App):
    def OnInit(self):
        frame = MyFrame(None, -1, 'wxListCtrl StackOverflow')
        frame.Show()
        self.SetTopWindow(frame)
        return 1

if __name__ == "__main__":
    app = MyApp(0)
    app.MainLoop() 
```

# c# - 在位枚举上覆盖 int

> ID：592710
> 
> 赞同：0
> 
> 时间：2009-02-26T22:19:58.040
> 
> 标签：c#, .net, enums

我看到了一些看起来像这样的 .NET 2.0 代码：

```
 public enum abc : int
 {
  value1 = 1,
  value2 = 2,
  value3 = 4
 } 
```

ETC...

现在我知道标志枚举可用于位值（如上，对吗？）所以你可以这样做 | “或”＆等，但不使用它的原因是什么？覆盖int有什么意义？

如果我设计一个枚举来选择多个值，我会使用 flags 属性而不覆盖任何东西（我不明白）。上面的方法是什么？

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-26T22:24:24.533

它不是“覆盖” `int`，它指示枚举基于什么类型。默认情况下`int`，这实际上并没有实现任何目标，但在某些情况下，您可能希望基于枚举`long`来存储更多标志，或者`byte`如果周围有很多枚举实例并且它只有几个，则可以节省空间值，但是框架设计指南中的建议是使用`int`，除非您有充分的理由不使用。

如果这是一个标志枚举，那么它应该用 标记`[Flags]`，这似乎是这里的意图，所以省略看起来像是一个错误。即使没有标记，您仍然可以使用按位运算符组合值`[Flags]`，但是从内存中我认为您会收到编译器警告（或者它可能是 FxCop 警告，或者可能是 ReSharper 警告......）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-26T22:23:36.953

":int" 指定使用什么作为枚举值的基础类型；此处可以使用除 char 以外的任何整数类型。默认值为 int，因此在这种情况下它是多余的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-26T22:25:03.097

FlagsAttribute 只告诉用户这个枚举中的字段可以组合；它实际上并没有将枚举的字段设置为“可标记”值。这个，你必须自己做，就像你已经做的一样。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T22:24:25.127

我没有看到任何好处。程序员可能缺乏经验。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T22:25:18.713

如果您询问选择特定值的场景，我不知道一个很好的例子，但我可以想象类似

```
enum Color = {
  Red = 0xFF0000,
  Green = 0x00FF00,
  Blue = 0x0000FF } 
```

也许有用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T22:25:41.350

将非标志枚举上的值设置为使用 1-hot 编码只是为了使用 1-hot 编码并没有任何意义。我想如果您认为将来可能将其设为 Flags 枚举，这可能是有道理的。否则，这些值不应被覆盖或根据其含义分配一个值（例如，Color.Red = 0xFF0000）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-26T23:57:07.883

关于指定底层类型的“：int”，如果我看到了，我会环顾四周，看看他们是否以这种方式删除所有枚举。如果是这样，他们可能只是学会了以这种方式编写枚举（或者他们可能是一个超显式编码器）。但是，如果仅以这种方式声明此枚举，则程序员可能正试图说明某些事情（可能最好用注释来说明），这很重要，因为它具有底层的“int”类型。也许它正在某处被二进制序列化或反序列化。

至于 [Flags] 属性，就 C# 而言，您可以在任何枚举上使用位运算符，而不仅仅是使用 [Flags] 声明的那些。从您上面的示例中，没有任何 [Flags]，以下内容是完全合法的：

abc myAbcValue = value1 | 值2；

[Flags] 的主要区别在于 Enum 的 ToString() 和 Parse() 方法。如果没有 [Flags]，myAbvValue.ToString() 将返回“3”，但如果使用 [Flags]，它将返回“value1, value2”。同样，使用 [Flags]，

abc yourAbcValue = (abc)Enum.Parse( typeof(abc), "value1, value2") ;

将 yourAbcValue 的基础值设置为 3。

请注意， Enum() 的 IsDefined() 方法不允许使用 [Flags] 枚举的多个值，因此：

Enum.IsDefined(typeof(abc), "value1, value2")

无论使用 [Flags]，都返回 false。

另请注意，[Flags] 为任何反射访问提供信息，其他语言可能会将标记枚举的限制与普通枚举不同。

# .net - 如何在 VS 2008 Windows 窗体中使用多个重合面板控件

> ID：592722
> 
> 赞同：2
> 
> 时间：2009-02-26T22:22:29.827
> 
> 标签：.net, visual-studio, winforms

在 VS 2008 中，我试图设计一个类似于一组属性页但使用 TreeView 而不是 TabControl 来选择页面的 Windows 窗体。这种设计的一个例子是 VS 2008 本身的选项对话框。我想这样做有两个原因： 1\. 我更喜欢外观和感觉；2\. 我想让用户能够将子节点添加到 TreeView。

我正在使用多个面板控件来包含每个“属性页”的控件。这些面板都将在表格上重合，即相互重叠。当我这样做时，我发现 VS UI 设计器不是很友好；我可以很容易地选择每个面板，但面板内的所有控件同时可见，导致混乱。使用 TabControl 会容易得多，因为您可以选择一个选项卡并只看到您放置在该选项卡上的控件。

有没有一种不同的方法可以让我更轻松，还是我必须使用 TabControl？TIA

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T23:18:16.573

为了获得类似于`TabControl`每个选项卡为您提供用于放置控件的不同设计器画布的行为，您需要[为您的控件编写一个设计器，](http://msdn.microsoft.com/en-us/library/h51z5c0x.aspx)以在表单设计器中提供选项卡交互。但是，如果您想避免这种情况，您可以采用我们在类似情况下使用的方法，让每个标签页都有自己的`UserControl`，然后将它们作为标签添加到主标签控件的构造函数中。

这允许您单独设计每个选项卡，避免您当前面临的重叠问题。

# c++ - C++ 中带有“this”的智能指针

> ID：592728
> 
> 赞同：2
> 
> 时间：2009-02-26T22:23:14.613
> 
> 标签：c++, this, smart-pointers

我一直致力于用引用计数指针替换原始指针，这些指针仅公开底层指针的 const 版本。我的目标是减少内存使用（以及不必要地构造和破坏复杂对象所花费的时间），而不会让自己陷入任何代码都可以访问它不拥有的内存的情况。我知道引用计数的循环引用问题，但我的代码不应该造成这种情况。

要求 const-ness 是可行的，因为我使用的系统中类通常不公开非 const 成员，而不是更改对象，您必须在其上调用一个方法，该方法返回由更改产生的新对象。这可能是一种设计模式，但我不知道它的名称。

当我有一个方法返回指向其类型对象的指针时，我的问题就出现了，有时它本身就是。以前它看起来像这样：

```
Foo * Foo::GetAfterModification( const Modification & mod ) const
{
  if( ChangesAnything( mod ) )
  {
    Foo * asdf = new Foo;
    asdf.DoModification( mod );
    return asdf;
  }
  else
    return this;
} 
```

我看不到让它返回智能指针的好方法。天真的方法类似于`return CRcPtr< Foo >( this )`，但这会破坏所有权语义，因为我返回的内容以及以前拥有该对象的人现在都认为他们拥有所有权但彼此不了解。唯一安全的做法是`return CRcPtr< Foo >( new Foo( *this ) )`，但这违背了我限制不必要的内存使用的意图。

有没有办法在不分配任何额外内存的情况下安全地返回智能指针？我的怀疑是没有。如果有，如果对象已在堆栈上分配，它将如何工作？ [这个问题](https://stackoverflow.com/questions/142391/getting-a-boostsharedptr-for-this)似乎相关，但并不相同，因为他可以让他的函数将原始指针作为参数，并且因为他使用的是 boost 库。

作为参考，我的自制智能指针实现如下。我相信它可能会更强大，但它比依赖于任何地方都可用的 boost 或 tr1 更便携，并且在这个问题之前它对我来说效果很好。

```
template <class T>
class CRcPtr
{
public:
  explicit CRcPtr( T * p_pBaldPtr )
  {
    m_pInternal = p_pBaldPtr;
    m_iCount = new unsigned short( 1 );
  }

  CRcPtr( const CRcPtr & p_Other )
  { Acquire( p_Other ); }

  template <class U>
  explicit CRcPtr( const CRcPtr< U > & p_It )
  {
    m_pInternal = dynamic_cast< T * >( p_It.m_pInternal );
    if( m_pInternal )
    {
      m_iCount = p_It.m_iCount;
      (*m_iCount)++;
    }
    else
      m_iCount = new unsigned short( 1 );
  }

  ~CRcPtr()
  { Release(); }

  CRcPtr & operator=( const CRcPtr & p_Other )
  {
    Release();
    Acquire( p_Other );
  }

  const T & operator*() const
  { return *m_pInternal; }

  const T * operator->() const
  { return m_pInternal; }

  const T * get() const
  { return m_pInternal; }

private:
  void Release()
  {
    (*m_iCount)--;
    if( *m_iCount == 0 )
    {
      delete m_pInternal;
      delete m_iCount;
      m_pInternal = 0;
      m_iCount = 0;
    }
  }

  void Acquire( const CRcPtr & p_Other )
  {
    m_pInternal = p_Other.m_pInternal;
    m_iCount = p_Other.m_iCount;
    (*m_iCount)++;
  }

  template <class U>
  friend class CRcPtr;

  T * m_pInternal;
  unsigned short * m_iCount;
};

template <class U, class T>
CRcPtr< U > ref_cast( const CRcPtr< T > & p_It )
{ return CRcPtr< U >( p_It ); } 
```

编辑：感谢您的回复。我希望避免使用 boost 或 tr1，但我认识到不使用经过良好测试的库通常是不明智的。我相当确定我所实现的与 std::auto_ptr*不*相似，而是与 tr1::shared_ptr 相似，只是它只公开了内部指针的 const 版本并且缺少正式版本中的一些功能。我真的很想避免像 Gian Paolo 提出的那种侵入式方案。我知道我的实现不是线程安全的，但这是一个单线程应用程序。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T22:31:45.437

查看 Boost [shared pointers](http://www.boost.org/doc/libs/1_38_0/libs/smart_ptr/shared_ptr.htm)的源代码。如果您从 派生一个类`enable_shared_from_this<T>`，则可以调用`shared_from_this()`成员函数来执行此类操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T23:41:47.483

就语义而言，不变性的伟大之处在于您可以在对象、线程之间安全地共享数据，而不必担心人们会改变您所依赖的值。只要您的引用计数方案是正确的，您就不必担心所有权（我没有阅读您的，但无论如何都要使用 Boost）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T23:49:06.063

正如 Ferruccio 所逃避的那样，您需要某种形式的*共享*指针。即，可以在多个对象之间共享（安全！）。完成这项工作的一种方法是从实现实际引用计数的类派生所有对象（至少那些旨在与共享指针一起使用的对象）。这样，实际的指针本身就携带了当前计数，并且您可以在任意数量的不同对象之间共享指针。

您目前拥有的与 std::auto_ptr 非常相似，并且您在所有权方面遇到了同样的问题。谷歌它，你应该找到一些有用的信息。

请注意，共享指针还有其他复杂性：特别是在多线程环境中，您的引用计数必须是原子的，并且必须处理自分配以避免增加内部计数，从而永远不会破坏对象。

谷歌再次成为你的朋友。只需查找有关 C++ 中共享指针的信息，您就会发现大量信息。

# bash - 有没有很好的在线教程来学习中高级 Bash 可编程完成？

> ID：592733
> 
> 赞同：4
> 
> 时间：2009-02-26T22:23:58.390
> 
> 标签：bash, programmable-completion

我目前的可编程完成技能水平非常基础——大约在“ `complete -d cd`”。我想显着增加我的完成知识（和使用）以提高我的 CLI 生产力，但我很难找到一个有很多实质内容的在线资源。我能够通过 Google 挖掘的绝大多数内容都归结为“按 [tab] 两次”或“ `apt-get bash_completion`”……剩下的少数网站只是提供用于特定程序的大型、复杂的完成脚本（例如`svn`）。

我可以去哪里了解更多信息？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T23:57:17.353

做一些谷歌搜索，我能找到的最好的例子是这篇文章：[bash 完成简介](http://www.debian-administration.org/articles/316)

我还可以找到存档的[邮件列表](http://www.mail-archive.com/bash-completion-devel@lists.alioth.debian.org/info.html)，如果您有具体问题，可以在其中寻求帮助。

如果我发现更多内容，我将编辑此答案以将其添加。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T23:55:48.590

这可能行不通，但是您是否尝试过联系完成脚本的维护者？询问他们会推荐哪些资源。

# c# - .Net 中的方法重载成本

> ID：592743
> 
> 赞同：3
> 
> 时间：2009-02-26T22:26:09.193
> 
> 标签：c#, .net, methods, overloading

.Net 中的重载方法是否会产生成本？

因此，如果我有 3 种方法，例如：

```
Calculate (int)
Calculate (float)
Calculate (double) 
```

并且这些方法在运行时根据传递给Calculate方法的内容“动态”调用，这种重载解决方案的成本是多少？

或者，我可以有一个计算并在方法主体中产生差异，但我认为这需要方法在每次调用时评估类型。

有没有更好的方法/设计来解决这个问题而可能没有开销？或者更好的是，处理此类案件的最佳做法是什么？我想有相同的类/方法名，但不同的行为。

编辑：谢谢大家。如果它有任何不同，那就只做一件事。我想知道你有一个用于这些方法的 DLL 和一个用 C# 编写的程序，它允许用户将这些方法添加为 UI 项（无需指定类型）。所以用户添加UI项Calculate(5)，然后Calculate(12.5)等，C#app执行这个，还会没有开销吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-26T22:32:29.927

就运行时而言，这些是**不同的方法**。和写法一样：

```
CalculateInt(int)
CalculateFloat(float) 
```

关于性能问题，除了**非常**特殊的情况，您可以放心地忽略方法调用开销。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-26T22:33:33.670

这个问题是关于方法重载，而不是多态性。据我所知，方法重载不会受到惩罚，因为编译器会根据传递给它的参数类型确定在编译时调用哪个方法。

多态性仅在您使用派生类型代替基类时发挥作用。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-26T22:32:35.293

首先，除非您的分析器告诉您存在性能问题，否则您不应该为了假设的性能提升而牺牲良好的设计。

要回答您的问题，方法调用的解决方案不是动态的。它是在编译时确定的，因此在这方面没有成本。唯一的成本是潜在的隐式类型转换以适应参数类型。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-26T22:33:54.777

方法重载（即方法表槽）不是在运行时动态解析的，而是在编译时静态解析的，因此重载方法的成本为零。

我假设您正在考虑`virtual`实际实现可能被派生类型覆盖的方法，并且根据具体类型选择实际方法。但这与重载无关，因为虚拟方法占用相同的方法表槽。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-26T22:44:14.457

运行时没有“成本”，因为编译器决定在编译时调用哪个方法。生成的 IL 专门调用采用适当参数的方法。

以这个为例”

```
public class Calculator
{
    public void Calculate(int value)
    {
        //Do Something
    }
    public void Calculate(decimal value)
    {
        //Do Something
    }
    public void Calculate(double value)
    {
        //Do Something
    }
}

static void Main(string[] args)
{
    int i = 0;
    Calculator calculator = new Calculator();
    calculator.Calculate(i);
} 
```

在 IL 中进行以下调用以计算变量“i”：

```
L_000b: callvirt instance void ConsoleApplication1.Calculator::Calculate(int32) 
```

请注意，它指定方法是 int32 类型，它与从 Main 方法传入的变量类型相同。

因此，如果完全有成本，那只是在编译时。不用担心。

正如[JaredPar](https://stackoverflow.com/users/23283/jaredpar)在下面指出的：

> 你的问题存在误解。C# 中的重载方法不会在运行时动态调用。所有方法调用都在编译时静态绑定。因此，在运行时没有“搜索”方法，它在编译时预先确定了将调用哪个重载。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-26T22:30:03.617

根据类型在 IL 中产生 3 种不同的方法。唯一的成本是您从一种类型转换为另一种类型，但除非您有大量工作要做，否则该成本不会很大。因此，您可以坚持使用 Calculate(double) 并从那里进行投射。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-27T04:46:22.463

你的问题存在误解。C# 中的重载方法不会在运行时动态调用。所有方法调用都在编译时静态绑定。因此，在运行时没有“搜索”方法，它在编译时预先确定了将调用哪个重载。

注意：这在 C# 4.0 和动态版本中有所改变。对于动态对象，可能会在运行时根据对象的类型选择重载。但是，C# 3.0 及更低版本并非如此。

# c++ - Visual Studio 2008 中的 C++“使用”声明

> ID：592744
> 
> 赞同：1
> 
> 时间：2009-02-26T22:26:11.627
> 
> 标签：c++, using-declaration

我正在尝试使用 google protobuf，他们有以下示例：

```
using google::protobuf;

protobuf::RpcChannel* channel;
protobuf::RpcController* controller;
SearchService* service;
SearchRequest request;
SearchResponse response;

void DoSearch() {
  // You provide classes MyRpcChannel and MyRpcController, which implement
  // the abstract interfaces protobuf::RpcChannel and protobuf::RpcController.
  channel = new MyRpcChannel("somehost.example.com:1234");
  controller = new MyRpcController;

  // The protocol compiler generates the SearchService class based on the
  // definition given above.
  service = new SearchService::Stub(channel);

  // Set up the request.
  request.set_query("protocol buffers");

  // Execute the RPC.
  service->Search(controller, request, response, protobuf::NewCallback(&Done));
}

void Done() {
  delete service;
  delete channel;
  delete controller;
} 
```

当我尝试在 Visual Studio Express 2008 中实现此代码时遇到的错误是：

> 错误 C2873：“google::protobuf”：符号不能在 using 声明中使用

编辑：当我执行“使用命名空间 google::protobuf;”时 在函数内部它不再给我错误。我感到困惑的是，它不像 Google 的示例（以及 Stroustrup 在“C++ 编程语言”中的示例）似乎表明的那样工作。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T22:27:54.667

`google::protobuf`大概是一个`namespace`。在这种情况下，您需要这样做。

```
using namespace google::protobuf; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T05:21:58.260

直接来自[文档](http://msdn.microsoft.com/en-us/library/sd8050b6(VS.80).aspx)：

```
Visual C++ Concepts: Building a C/C++ Program
Compiler Error C2873
Error Message
'symbol' : symbol cannot be used in a using-declaration
A using directive is missing a namespace keyword. This causes the compiler to misinterpret the code as a using declaration rather than a using directive. 
```

[有关差异的更多信息。](http://msdn.microsoft.com/en-us/library/aewtdfs3(VS.80).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-02-18T07:29:09.453

(1) 根据微软的说法，C2873 是指；

'symbol' : 符号不能在 using 声明中使用 using 指令缺少命名空间关键字。这会导致编译器将代码误解为 using 声明而不是 using 指令。

(2) 当我有 C2873 和 C2039 时（我试图在 Visual Studio 2010 中合并 CEF3 和 Cinder），不知何故我通过更改 Properties->Configuration Properties->C/C++->Code Generation 绕过了这两个错误；

启用最小重建：是（/Gm），启用 C++ 异常：是（/EHsc），启用函数级链接：空

# python - 如何在 python 中打印变量名？

> ID：592746
> 
> 赞同：112
> 
> 时间：2009-02-26T22:26:37.167
> 
> 标签：python, dictionary, variables, introspection

假设我有一个名为`choice`它的变量等于 2。我将如何访问该变量的名称？相当于

```
In [53]: namestr(choice)
Out[53]: 'choice' 
```

用于制作字典。有一个很好的方法可以做到这一点，我只是想念它。

编辑：

这样做的原因是这样的。我正在运行一些数据分析的东西，我用多个参数调用程序，我想在运行时调整或不调整。我从格式为的 .config 文件中读取了上次运行中使用的参数

```
filename
no_sig_resonance.dat

mass_peak
700

choice
1,2,3 
```

当提示输入值时，会显示先前使用的值，并且空字符串输入将使用先前使用的值。

我的问题出现是因为在编写这些值已被扫描到的字典时。如果需要一个参数，我运行`get_param`它访问文件并找到参数。

我想我会通过阅读 . `config`归档一次并从中生成字典。我最初避免这样做是出于……我不再记得的原因。完美的情况来更新我的代码！

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2009-02-26T23:05:16.963

如果你坚持，这里有一些可怕的基于检查的解决方案。

```
import inspect, re

def varname(p):
  for line in inspect.getframeinfo(inspect.currentframe().f_back)[3]:
    m = re.search(r'\bvarname\s*\(\s*([A-Za-z_][A-Za-z0-9_]*)\s*\)', line)
    if m:
      return m.group(1)

if __name__ == '__main__':
  spam = 42
  print varname(spam) 
```

我希望它会激发您重新评估您遇到的问题并寻找另一种方法。

* * *

## 回答 #2

> 赞同：88
> 
> 时间：2009-02-26T23:14:46.130

### 要回答您的原始问题：

```
def namestr(obj, namespace):
    return [name for name in namespace if namespace[name] is obj] 
```

例子：

```
>>> a = 'some var'
>>> namestr(a, globals())
['a'] 
```

正如[@rbright 已经指出的那样，](https://stackoverflow.com/questions/592746/how-can-you-print-a-variable-name-in-python/592809#592809)无论您做什么，都可能有更好的方法来做到这一点。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-26T22:52:50.550

如果你试图这样做，这意味着你做错了什么。考虑使用 a`dict`代替。

```
def show_val(vals, name):
    print "Name:", name, "val:", vals[name]

vals = {'a': 1, 'b': 2}
show_val(vals, 'b') 
```

输出：

```
Name: b val: 2 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-26T22:31:25.780

你不能，因为 Python 中没有变量，只有名称。

例如：

```
> a = [1,2,3]
> b = a
> a is b
True 
```

这两个中的哪一个现在是正确的变量？`a`和之间没有区别`b`。

以前也有[类似的问题](https://stackoverflow.com/questions/544919/python-can-i-print-original-var-name)。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-26T22:49:37.173

我建议您描述您面临的问题，而不是询问具体解决方案的详细信息；我想你会得到更好的答案。我这么说是因为几乎可以肯定有更好的方法来做你想做的任何事情。通常不需要以这种方式访问​​变量名来解决任何语言的问题。

也就是说，您所有的变量名称都已经在字典中，可以通过内置函数[locals](http://docs.python.org/library/functions.html#locals)和[globals](http://docs.python.org/library/functions.html#globals)访问这些字典。为您正在检查的范围使用正确的范围。

检查这些字典的少数常见习语之一是简单的字符串插值：

```
>>> first = 'John'
>>> last = 'Doe'
>>> print '%(first)s %(last)s' % globals()
John Doe 
```

这类东西往往比替代方案更具可读性，即使它需要按名称检查变量。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-26T22:45:40.037

通过急切的评估，变量在您查看它们时基本上都会变成它们的值（解释一下）。也就是说，Python 确实有内置的[命名空间](http://docs.python.org/tutorial/classes.html#python-scopes-and-name-spaces)。例如，locals() 将返回一个字典，将函数的变量名称映射到它们的值，而 globals() 对模块执行相同的操作。因此：

```
for name, value in globals().items():
    if value is unknown_variable:
        ... do something with name 
```

请注意，您无需导入任何内容即可访问 locals() 和 globals()。

此外，如果一个值有多个别名，则遍历命名空间只会找到第一个。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-26T23:01:26.490

像这样的东西对你有用吗？

```
>>> def namestr(**kwargs):
...     for k,v in kwargs.items():
...       print "%s = %s" % (k, repr(v))
...
>>> namestr(a=1, b=2)
a = 1
b = 2 
```

在你的例子中：

```
>>> choice = {'key': 24; 'data': None}
>>> namestr(choice=choice)
choice = {'data': None, 'key': 24}
>>> printvars(**globals())
__builtins__ = <module '__builtin__' (built-in)>
__name__ = '__main__'
__doc__ = None
namestr = <function namestr at 0xb7d8ec34>
choice = {'data': None, 'key': 24} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-26T23:39:04.917

对于如何读取配置参数的修订问题，我强烈建议您节省一些时间和精力并使用[ConfigParser](http://docs.python.org/library/configparser.html)或（我的首选工具）[ConfigObj](http://www.voidspace.org.uk/python/configobj.html)。

它们可以做你需要的一切，它们易于使用，而且已经有人担心如何让它们正常工作了！

# c# - 任何人都可以推荐用于报告目的的矢量图形引擎吗？

> ID：592747
> 
> 赞同：1
> 
> 时间：2009-02-26T22:26:51.237
> 
> 标签：c#, .net, vector, reporting

需要开发一个 .NET 解决方案，以图形方式表示分段的座位，在体育场布局视图中绘制，并作为报告输出......座位将有不同的颜色显示销售状态......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T23:01:45.333

确实，乍一看可能很吓人，但.NET Framework 中的[2D 绘图](http://msdn.microsoft.com/en-us/library/system.drawing.aspx)实际上很容易使用。

这是一个小例子，它绘制了几个带有抗锯齿边距的彩色圆圈：

```
using System.Drawing;

...

Font font = new Font(FontFamily.GenericMonospace, 8);
Image reportImage = new Bitmap(270, 45);
using (Graphics graphics = Graphics.FromImage(reportImage))
{
    graphics.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.AntiAlias;

    graphics.FillRectangle(Brushes.White, 
        new Rectangle(new Point(0, 0), reportImage.Size));

    for (int i = 0; i != 6; i++)
    {
        Rectangle r = new Rectangle(20 + i * 40, 15, 25, 15);
        graphics.FillEllipse(
            i % 2 == 0 ? Brushes.DarkOrange : Brushes.DarkKhaki, r);
        graphics.DrawEllipse(Pens.Black, r);

        r.Offset(2, 0);

        graphics.DrawString(i.ToString(), font, Brushes.Black, r);
    }
}
reportImage.Save("C:\\test.bmp"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T22:37:46.797

看起来很简单，常规的旧 GDI+ 可能会成功。

您当然必须设置一个 GUI，其中每个体育场的座位计划都可以通过点击“映射”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T23:20:38.893

[Cairo](http://cairographics.org/)看起来是一个很棒的工具。自己还没有测试过……还没有。但是看起来很称职，支持一堆输出*格式*

# http - 使用 GET 查询参数发布到 URI？

> ID：592755
> 
> 赞同：1
> 
> 时间：2009-02-26T22:29:49.543
> 
> 标签：http, parameters

前几天我偶然发现了一些代码，它使用了 URI 中指定的查询参数，同时又是一个 HTTP POST。

我只是想知道，这些字段的解释是供应商特定的吗？RFC 是否对此有任何具体说明？如果两者都存在一个参数，那么哪一个胜出？

为了更好地说明，查询看起来像这样：

> POST /posts/?user=bob HTTP/1.1
> 
> user=bill&title=测试&content=测试+内容

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T22:32:51.580

这是完全合法的。许多框架都支持它，例如 Servlet API 甚至指定参数的优先级（顺序），因为它们出现在 getParameters(String) 中，它将首先提供查询参数。例如这也是合法的，不是参数名称相同。

```
POST /path?param1=value HTTP/1.1
Host: localhost

param1=value&param2=value 
```

根据 HTTP/1.1 RFC，这也是有效的，请查看[RFC 2616](http://www.ietf.org/rfc/rfc2616.txt)。

它不应该是特定于供应商的，大多数综合框架都会支持它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T22:32:57.243

没有王牌。GET 和 POST 值作为单独的集合传递。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T22:57:46.590

我偶尔会这样做。通常我会将实际的更新字段放在发布数据中，查询数据用于格式化响应

# c# - 如何在 Winform DataGridView 中创建不同的单元格格式

> ID：592757
> 
> 赞同：4
> 
> 时间：2009-02-26T22:30:45.393
> 
> 标签：c#, winforms, datagridview

我有一个绑定到 DataTable 的 DataGridView。
DataTable 是一个全数字值。
要求 DataGridView 中的每 n 行都包含文本，而不是数值（以便在视觉上为用户分隔部分）。

我很高兴在绑定后将此文本数据放入 DataTable 或 DataGridView 中，但我看不到将文本数据放入其中的任何一种方法，因为两者的列格式都需要数字数据 - 我得到一个“不能将字符串放入十进制”错误。

任何想法如何更改 DataTable 或 DataGridView 中特定行或单元格的格式？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-02T22:37:01.770

您可以为 DataGridView 的`CellFormatting`事件提供处理程序，例如：

```
public partial class Form1 : Form
{
    DataGridViewCellStyle _myStyle = new DataGridViewCellStyle();

    public Form1()
    {
        InitializeComponent();

        _myStyle.BackColor = Color.Pink;
        // We could also provide a custom format string here 
        // with the _myStyle.Format property
    }

    private void dataGridView1_CellFormatting(object sender, 
        DataGridViewCellFormattingEventArgs e)
    {
        // Every five rows I want my custom format instead of the default
        if (e.RowIndex % 5 == 0)
        {
            e.CellStyle = _myStyle;
            e.FormattingApplied = true;
        }
    }

    //...
} 
```

有关创建自己的样式的帮助，请参阅`DataGridView.CellFormatting Event`联机帮助中的主题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T22:38:19.057

我已经将[Janus GridEx](http://www.janusys.com/janus/library/CustomPages/gridexnet.htm)用于这种类型的非标准行为。（部分是因为它的功能远不止这些，比如分组和求和、卡片视图等。）网站上有一些很好的演示。

（不是推销；我只是在使用他们的组件时获得了很好的体验。）

[![分组和汇总网格数据的屏幕截图](https://i.stack.imgur.com/1fwEw.jpg)](https://i.stack.imgur.com/1fwEw.jpg)
[（来源：[janusys.com](http://www.janusys.com/janus/library/CustomPages/images/Hierarchical1.jpg)）]

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-27T09:54:18.807

这能解决你的问题吗？

```
// Set the data source.
dataGridView1.DataSource = dataTable1;

// Create a new text box column.
DataGridViewColumn c1 = new DataGridViewTextBoxColumn();
const string C1_COL_NAME = "Custom1";
c1.Name = C1_COL_NAME;

// Insert the new column where needed.
dataGridView1.Columns.Insert(1, c1);

// Text can then be placed in the rows of the new column.
dataGridView1.Rows[0].Cells[C1_COL_NAME].Value = "Some text..."; 
```

原始数据表绑定应该仍然存在。

# c++ - boost中的数字范围迭代器？

> ID：592763
> 
> 赞同：14
> 
> 时间：2009-02-26T22:31:58.400
> 
> 标签：c++, stl, boost, iterator, range

我知道 boost 中的范围迭代器，至于[这个参考](http://www.boost.org/doc/libs/1_37_0/libs/range/doc/boost_range.html)，似乎应该有一种简单的方法来做我想做的事，但这对我来说并不明显。

假设我想表示一个数字范围，从 0 到 100（包括或不包括），比如`range(0,100)`. 我想做类似的事情：

```
for_each(range<int>(0,100).begin(), range<int>(0,100).end(), do_something); 
```

`do_something`函子在哪里。这个迭代器不应该有一个底层向量或类似的东西的开销，而只是提供一个整数序列。这可能与boost中的范围实现有关吗？使用普通的标准 STL 迭代器可能吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-26T23:32:47.677

[boost::counting_iterator](http://www.boost.org/doc/libs/1_38_0/libs/iterator/doc/counting_iterator.html)

```
#include <boost/iterator/counting_iterator.hpp>

std::for_each( boost::counting_iterator<int>(0),
               boost::counting_iterator<int>(100),
               do_something ); 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2015-01-22T22:11:04.493

如果您从 C++11 的角度来添加其他答案 - 如果您更愿意使用现代 for-each 循环，您可以使用 boostcounting_range 更干净地做到这[一点](http://www.boost.org/doc/libs/1_57_0/libs/range/doc/html/range/reference/ranges/counting_range.html)：

```
#include <boost/range/counting_range.hpp>

for(auto const &i : boost::counting_range(0, 10)) {
  std::cout << i;
} 
```

输出：

> 0123456789

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-26T23:34:34.677

是的，有可能。似乎 boost::range 没有开箱即用的支持，但你可以

*   use [`boost::counting_iterator`](http://www.boost.org/doc/libs/1_38_0/libs/iterator/doc/counting_iterator.html)，这正是你想要的
*   实现一个类似数字的对象，该对象`operator*()`将返回一个数字，并将其用作迭代器`range`

# apache-flex - 如何将 Flex 连接到 HTTP

> ID：592767
> 
> 赞同：0
> 
> 时间：2009-02-26T22:32:36.527
> 
> 标签：apache-flex, flex3

我在 Flex Builder 3 中创建了一个项目，但我认为它没有连接到我分配的 HTTP。它是一个博客应用程序，通过 PHP 页面连接到数据库。当我在 HTML 页面上查看应用程序时，文本字段不可编辑——您无法输入它们。这让我相信我错误地分配了 HTTP。这可能是问题吗？我该如何解决？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-27T18:06:00.823

*   你能在你的 DataGrid 中显示任何数据吗？

*   如果你在你的 HTTPService 中设置一个断点，你`getData`能抓住它吗？换句话说，它被调用了吗？或者，有问题吗？像这样添加一个故障处理程序：

    结果="getPHPData(事件)" 故障="getFault(事件)"

    并定义`getFault()`.

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-27T04:13:07.160

下面是我正在使用的一些 mxml 代码。我没有收到任何关于无法连接到数据库的错误，所以我认为 PHP 没有任何问题。

```
<?xml version="1.0" encoding="utf-8"?>
 <mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute"   width="535" height="345">
<mx:Script>
<![CDATA[
 import mx.events.DataGridEvent;
 import mx.controls.TextInput;
 import mx.rpc.events.ResultEvent;
 import mx.collections.ArrayCollection;
 import com.adobe.serialization.json.JSON;

 [Bindable]
 private var dataArray:ArrayCollection;

 private function initDataGrid():void
 {
   dataArray = new ArrayCollection();
   getData.send();
 }

 private function getPHPData(event:ResultEvent):void
 {
   var rawArray:Array;
   var rawData:String = String(event.result);
   rawArray = JSON.decode(rawData) as Array;
   dataArray = new ArrayCollection(rawArray);
 }

 private function sendPHPData():void
 {
   var objSend:Object = new Object();
   var dataString:String = JSON.encode(dataArray.toArray());
   dataString = escape(dataString);
   objSend.setTutorials = "true";
   objSend.jsonSendData = dataString;
   sendData.send(objSend);
 }

 private function updatedPHPDataResult(event:ResultEvent):void
 {
   lblStatus.text = String(event.result);
 }

 private function checkRating(event:DataGridEvent):void
 {
   var txtIn:TextInput = TextInput(event.currentTarget.itemEditorInstance);
   var curValue:Number = Number(txtIn.text);
   if(isNaN(curValue) || curValue < 0 || curValue > 10)
   {
     event.preventDefault();
     lblStatus.text = "Please enter a number rating between 0 and 10";
   }
  }
]]>
</mx:Script>
<mx:HTTPService id="getData" url="/keishalexie/imd465/forum.php"
 useProxy="false" method="GET" resultFormat="text"
 result="getPHPData(event)">
 <mx:request xmlns="">
  <getTutorials>"true"</getTutorials>
 </mx:request>
 </mx:HTTPService>
 <mx:HTTPService id="sendData" url="/keishalexie/imd465/forum.php"
 useProxy="false" method="GET" resultFormat="text"
 result="updatedPHPDataResult(event)">
</mx:HTTPService>
<mx:Binding source="dgData.dataProvider as ArrayCollection"
 destination="dataArray"/>
 <mx:Panel x="0" y="0" width="535" height="345" layout="absolute"
 title="Forum">
 <mx:DataGrid id="dgData" x="10" y="10" width="495" height="241"
   dataProvider="{dataArray}" creationComplete="{initDataGrid()}"
   editable="true" itemEditEnd="{checkRating(event)}">
  <mx:columns>
    <mx:DataGridColumn headerText="Name" dataField="name" editable="false"/>
    <mx:DataGridColumn headerText="Author" dataField="author" width="115"
       editable="false"/>
    <mx:DataGridColumn headerText="Rating" dataField="rating" width="50"
       editable="true" />
  </mx:columns>
 </mx:DataGrid>
 <mx:Button x="10" y="259" label="UpdateDatabase" id="butUpdate"
   click="{sendPHPData()}"/>
 <mx:Label x="140" y="261" id="lblStatus"/>
</mx:Panel>
</mx:Application> 
```

# ios - Objective-C：修复方法中的内存管理

> ID：592768
> 
> 赞同：5
> 
> 时间：2009-02-26T22:32:46.200
> 
> 标签：ios, objective-c, iphone, cocoa, cocoa-touch

我几乎理解了 Objective-C 中的简单引用计数/内存管理，但是我在使用以下代码时遇到了困难。我正在发布 mutableDict（在下面的代码中注释），它在我的代码中造成了有害行为。如果我让内存泄漏，它会按预期工作，但这显然不是这里的答案。;-) 你们中的任何一个更有经验的人会不会善意地指出我正确的方向，因为我可以重新编写任何这种方法来更好地处理我的内存占用？主要是我如何管理 NSMutableDictionary *mutableDict，因为这是这里的罪魁祸首。我想了解这个问题，而不仅仅是复制/粘贴代码——所以一些评论/反馈是理想的。谢谢大家。

```
- (NSArray *)createArrayWithDictionaries:(NSString *)xmlDocument 
                               withXPath:(NSString *)XPathStr {

    NSError *theError = nil;
    NSMutableArray *mutableArray = [[[NSMutableArray alloc] init] autorelease];
    //NSMutableDictionary *mutableDict = [[NSMutableDictionary alloc] init];
    CXMLDocument *theXMLDocument = [[[CXMLDocument alloc] initWithXMLString:xmlDocument options:0 error:&theError] retain]; 
    NSArray *nodes = [theXMLDocument nodesForXPath:XPathStr error:&theError];
    int i, j, cnt = [nodes count];
    for(i=0; i < cnt; i++) {
        CXMLElement *xmlElement = [nodes objectAtIndex:i];
        if(nil != xmlElement) {
            NSArray *attributes = [NSArray array];
            attributes = [xmlElement attributes];
            int attrCnt = [attributes count];
            NSMutableDictionary *mutableDict = [[NSMutableDictionary alloc] init];
            for(j = 0; j < attrCnt; j++) {
                if([[[attributes objectAtIndex:j] name] isKindOfClass:[NSString class]]) 
                    [mutableDict setValue:[[attributes objectAtIndex:j] stringValue] forKey:[[attributes objectAtIndex:j] name]];
                else 
                    continue;
            }
            if(nil != mutableDict) {
                [mutableArray addObject:mutableDict];
            }
            [mutableDict release];  // This is causing bad things to happen.
        }
    }

    return (NSArray *)mutableArray;
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T23:18:50.817

这是您的代码的等效重写：

```
- (NSArray *)attributeDictionaries:(NSString *)xmlDocument withXPath:(NSString *)XPathStr {
    NSError *theError = nil;
    NSMutableArray *dictionaries = [NSMutableArray array];
    CXMLDocument *theXMLDocument = [[CXMLDocument alloc] initWithXMLString:xmlDocument options:0 error:&theError]; 
    NSArray *nodes = [theXMLDocument nodesForXPath:XPathStr error:&theError];

    for (CXMLElement *xmlElement in nodes) {
        NSArray *attributes = [xmlElement attributes];
        NSMutableDictionary *attributeDictionary = [NSMutableDictionary dictionary];
        for (CXMLNode *attribute in attributes) {
            [attributeDictionary setObject:[attribute stringValue] forKey:[attribute name]];
        }

        [dictionaries addObject:attributeDictionary];
    }

    [theXMLDocument release];
    return attributeDictionaries;
} 
```

请注意，我只对`theXMLDocument`. 那是因为数组和字典超出了这个方法的范围。`array`和`dictionary`类方法创建`NSArray`和`NSMutableDictionary`对象的自动释放实例。如果调用者没有明确地保留它们，它们将在应用程序事件循环的下一轮自动释放。

*   我还删除了永远不会执行的代码。该`CXMLNode` `name`方法表示它返回一个字符串，因此该测试将始终为真。
*   如果`mutableDict`是`nil`，你有更大的问题。抛出异常比静默失败要好，所以我也取消了那个测试。
*   我还使用了相对较新的`for`枚举语法，它消除了您的计数器变量。
*   我重命名了一些变量和方法，使其更像 Cocoa 风格。Cocoa 与大多数语言的不同之处在于，使用诸如“create”之类的动词通常被认为是不正确的，除非您特别想让调用者负责释放您返回的任何对象。
*   你什么都没做`theError`。您应该检查它并报告错误，或者`nil`如果您不打算检查它，请通过。让应用程序构建一个您不会使用的错误对象是没有意义的。

我希望这可以帮助您指出正确的方向。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T22:49:01.963

好吧，释放 mutableDict 真的不应该引起任何问题，因为它上面的行（将 mutableDict 添加到 mutableArray）将自动保留它。虽然我不确定您的代码到底出了什么问题（您没有具体说明“坏事”是什么意思），但我会建议一些一般性的事情：

1.  不要立即自动释放 mutableArray。让它成为一个常规的 alloc/init 语句，并在您返回它时自动释放它（“return [mutableArray autorelease];”）。

2.  theXMLDocument 正在泄漏，请务必在返回之前释放它。此外，您不需要像现在一样保留它。alloc/init 通过将对象保留计数从 1 开始来完成这项工作，再次保留它只是确保它永远泄漏。在返回之前摆脱保留并释放它，它不会泄漏。

3.  只是一个提示：确保在其他地方使用此方法时保留它的返回值 - 结果已自动释放，因为不保证在您需要它时会出现，除非您在某处明确保留/释放它。

否则，此代码**应该可以**工作。如果仍然没有，我会尝试的另一件事可能是执行 [mutableArray addObject:[mutableDict copy]] 以确保 mutableDict 在发布时不会给您带来任何问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-09-08T21:48:58.907

在“*从方法返回对象*”主题下的[“内存管理编程指南”](http://developer.apple.com/library/mac/#documentation/cocoa/Conceptual/MemoryMgmt/Articles/mmPractical.html)中（向下滚动一点），有一些简单的示例说明如何从具有正确内存管理的方法中返回对象。

 *# asp.net - 注入用户控件取决于单选按钮选择（ASP.NET MVC）

> ID：592779
> 
> 赞同：0
> 
> 时间：2009-02-26T22:34:51.623
> 
> 标签：asp.net, asp.net-mvc, ajax, user-controls

我有这个创建事件表单（asp.net mvc），我必须根据用户的选择更改表单的某些部分。当用户单击单选按钮时，应该使用 Ajax 在表单中注入不同的用户控件（ascx 文件）。有什么建议吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T08:10:35.500

如果您使用 jQuery，您可以轻松地使用 ascx 或部分 html 更新您的表单。以下[链接](https://stackoverflow.com/questions/286728/get-value-from-dropdownlist-en-use-value-in-urlhelper-closed)可以进一步帮助您

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T22:40:39.643

将按钮包装在通过 AJAX (Ajax.BeginForm...) 提交的表单中。让点击事件提交表单。使用 Ajax.BeginForm，您可以指定要使用内容更新的容器（AjaxOptions 中的 UpdateTargetId）。将表单提交给控制器，然后根据提交的表单参数（按钮值）返回 PartialViewResult。

如果您可以让链接触发功能，那就更容易了。只需使用 Ajax.ActionLink 并指定获取正确内容所需的路由值。当然，您可以将链接样式设置为按钮，甚至单选按钮，尽管这可能需要一些图形。

# sql - SQL Server 2008 Web 版不能做什么？

> ID：592791
> 
> 赞同：32
> 
> 时间：2009-02-26T22:42:06.770
> 
> 标签：sql, sql-server

您在 SQL Server 2008 标准版中可以做哪些在 SQL Server 2008 Web 版中不能做的事情？

我看过微软的功能列表，但我想从一个非常实用的角度来看，我会遇到什么限制。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-26T22:49:58.093

你也见过这个矩阵吗？

[http://msdn.microsoft.com/en-us/library/cc645993.aspx](http://msdn.microsoft.com/en-us/library/cc645993.aspx)

据我所知，Web 排除了许多更高级的功能，尤其是那些与开发和数据挖掘相关的功能，但没有什么能阻止您将它用于非企业网站的数据源。它似乎介于 Express 版本和 Standard 版本之间。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-26T22:50:05.503

最大的限制之一是它不能成为 SQL 复制的发布者。如果您想在它们之间拥有多个数据库和复制数据，那么您至少需要一台 SQL 服务器是标准或企业来充当发布者。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T22:46:37.663

[http://www.microsoft.com/sqlserver/2008/en/us/editions-compare.aspx](http://www.microsoft.com/sqlserver/2008/en/us/editions-compare.aspx)

编辑：对不起，你可能已经看过上面的内容了。

# sql - 在哪里可以找到关于 SQL 锁定和事务策略的好介绍

> ID：592799
> 
> 赞同：3
> 
> 时间：2009-02-26T22:45:44.670
> 
> 标签：sql, sql-server, transactions, locking

我使用锁和事务有点像第一次尝试编写多线程 c++ 服务器的 VBA excel 程序员......

我曾尝试向我的同事征求意见，但尽管我们在设计复杂数据库、编写快速高效的查询、在需要时使用索引和约束等方面都非常出色（或者我们认为），但没有一个我们对这个主题有很好的了解。

我找到的所有在线资源要么是语法参考，要么是解释事务以“begin tran”开始并以提交或回滚结束的虚拟教程。

我也浏览过，但没有成功。

我正在寻找的是一个简单的现实世界问题列表，以及解决它们的正确方法。

例子 ：

假设我有一个包含一个活动位列的表，并且我不想同时有两个活动行。当然，很多进程可以尝试同时插入数据。

*   我应该锁定整张桌子吗？
*   或者可能使用数据约束，以便插入第二个“活动”行将失败？
*   还是使用具有可重复读取隔离级别的事务？
*   或者也许写：

    update tbFoo set Active=0 insert into tbFoo (foo, Active) select 'foo',1 where not exists (select * from tbFoo where Active=1)

请不要评论/回答这个具体问题和我的愚蠢建议。我只是想指出我没有线索的事实:)

**我在哪里可以找到一些关于简单但相关的锁定情况的好的演练？**如果它有所作为，我使用的是 SQL Server 2008

我也很想知道其他人在这个话题上是否有同样的感受。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T23:10:43.893

You need to get deep into the product specific documentation to understand this.

It is product specific, and what works in one data does not work in another. That said, for most cases careful choice of isolation level will be sufficient, it is only when you start to really push things that more use of query hints will be needed.

For SQL Server, "Inside SQL Server 2000" (MSPress) is where I got enough detail to know most of the time I do not need that level of detail (and also working with people with decades of Oracle specialisation).

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-27T13:36:20.723

[查斯·博伊德的问答](http://blogs.msdn.com/chadboyd/archive/2007/05/29/so-you-think-you-know-sql-concurrency-and-locking.aspx)

[卡伦德莱尼文章](http://www.sqlknowhow.com/events/insidesql2.aspx?Referrer=SimonsBlog&med=Post20080929)

当然，[好的老 BOL](http://msdn.microsoft.com/en-us/library/ms190615.aspx)

对于 SQL 2008，您可能可以使用[MERGE](http://msdn.microsoft.com/en-us/library/bb510625.aspx)在一个 transaction.safe 语句中实现更新和插入。我还没有使用它，所以我会执行以下操作之一： - 事后检查的触发器（所以它在同一个事务中） - MERGE 的 TABLOCKX 锁定

不过，在这种情况下，[请检查这个线程](https://stackoverflow.com/questions/574549/575132)（当然还有[我的答案](https://stackoverflow.com/questions/574549/575132#575132):)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-08T15:32:52.360

如果你真的需要了解锁和事务在 SQL Server 中的工作原理，我认为最好的选择是了解 SQL Server 引擎内部的工作原理。

我发现“深入了解 Microsoft® SQL Server® 2008：T-SQL 编程”一书是最全面的指南。

“处理事务、并发和错误处理”部分应该可以帮助您解决您遇到的具体问题。

然而，我发现我从本书的所有部分中都学到了一些小知识，所有这些都让我在处理 SQL Server 时的生活变得轻松了一些。

我知道现在买一本纸质书似乎有点怀旧，但这是我推荐的书，因为我发现很难在网上获得全面的指南！

# javascript - AJAX 内部 HTML。更改链接。可能是“或”问题

> ID：592803
> 
> 赞同：0
> 
> 时间：2009-02-26T22:47:35.227
> 
> 标签：javascript, html, ajax

我想要的是一个超链接更多，单击时运行一些javascript函数，并且还更改为超链接Less。继承人我有哪些不起作用。它可以很好地运行 ajaxpage 函数，但不能运行 moreToLess。我认为这是我在 javascript 中使用“和”。

```
<script type="text/javascript">
function moreToLess(){
document.getElementById('tagLinks').innerHTML = '<a href=# OnClick="ajaxpage('/TagCloud?id=EDI_0009&count=20', 'tagcloud');lessToMore()" >Less</a>';
}
function lessToMore(){
document.getElementById('tagLinks').innerHTML = '<a href=# OnClick="ajaxpage('/TagCloud?id=EDI_0009&count=50', 'tagcloud');moreToLess()" >More</a>';
}
</script>
<span id=tagLinks ><a href=# OnClick="ajaxpage('/TagCloud?id=EDI_0009&count=50', 'tagcloud');moreToLess()" >More</a></span> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-26T22:49:11.493

是的，只需在 javascript 中的双引号内转义单引号 .. ala \'

```
<script type="text/javascript">
    function moreToLess(){
        document.getElementById('tagLinks').innerHTML = '<a href=# OnClick="ajaxpage(\'/TagCloud?id=EDI_0009&count=20\', \'tagcloud\');lessToMore()" >Less</a>';
    }
    function lessToMore(){
        document.getElementById('tagLinks').innerHTML = '<a href=# OnClick="ajaxpage(\'/TagCloud?id=EDI_0009&count=50\', \'tagcloud\');moreToLess()" >More</a>';
    }
</script>
<span id=tagLinks ><a href=# OnClick="ajaxpage('/TagCloud?id=EDI_0009&count=50', 'tagcloud');moreToLess()" >More</a></span> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T22:49:35.783

您必须转义`'`引号内的字符：

```
'<a href=# OnClick="ajaxpage(\'/TagCloud?id=EDI_0009&count=20\', \'tagcloud\');lessToMore()" >Less</a>' 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-26T22:50:18.950

我不确定是否还有其他问题，但我认为您需要转义其他单引号中的单引号：

```
document.getElementById('tagLinks').innerHTML = '<a href=# OnClick="ajaxpage(\'/TagCloud?id=EDI_0009&count=20\', \'tagcloud\');lessToMore()" >Less</a>\'; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-26T22:50:42.397

确实是引用问题，可以用\字符转义'字符

```
<script type="text/javascript">
function moreToLess(){
document.getElementById('tagLinks').innerHTML = '<a href=# OnClick="ajaxpage(\'/TagCloud?id=EDI_0009&count=20\', \'tagcloud\');lessToMore()" >Less</a>';
}
function lessToMore(){
document.getElementById('tagLinks').innerHTML = '<a href=# OnClick="ajaxpage(\'/TagCloud?id=EDI_0009&count=50\', \'tagcloud\');moreToLess()" >More</a>';
}
</script>
<span id=tagLinks ><a href=# OnClick="ajaxpage('/TagCloud?id=EDI_0009&count=50', 'tagcloud');moreToLess() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T23:31:56.820

这种混乱就是为什么 innerHTML 并不总是成功的原因。您已经将 JavaScript 嵌入在 HTML 中，嵌入在 JavaScript 字符串文字中嵌入更多 HTML，难怪您会感到困惑。

这是一个基于通过 DOM 方法切换链接的更简单的版本。

```
<a id="tagLinks" href="/TagCloud?id=EDI_0009&amp;count=50">more...</a>

<script type="text/javascript">
    var ismore= false;
    document.getElementById('tagLinks').onclick= function() {
        ajaxpage(this.href);
        ismore= !ismore;
        this.href= '/TagCloud?id=EDI_0009&count='+(ismore? 20 : 50);
        this.firstChild.data= ismore? 'less...' : 'more...';
        return false;
    };
</script> 
```

# javascript - 真的没有办法在IE（<8）中暴露一个html元素的原型吗？

> ID：592815
> 
> 赞同：7
> 
> 时间：2009-02-26T22:51:20.757
> 
> 标签：javascript, internet-explorer, dom, prototype-programming

我制作了一个模式来使用它们的原型创建和扩展 html 元素。这在非 ie 浏览器中就像一个魅力。示例代码可以找到[@jsbin](http://jsbin.com/eveto)（见页面源码）

这种模式的优点应该是速度（方法在元素原型链中，所以它们被引用一次）。你猜对了：IE不行。在 IE < 8 中，html 元素的原型是隐藏的/不可访问的，因此对于您创建的每个元素，您必须再次引用非标准方法（如果您大量使用该模式，则会留下很多指针）。我在网上搜索了解决方案，但只找到了复杂的解决方法。真的*没有*办法在 IE 中访问 HTML 元素原型吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-26T22:59:37.820

不，也不能保证你可以在 JavaScript 中摆弄 DOM 对象的原型。DOM 对象不是 ECMAScript 规范的一部分；在任何浏览器中，它们可能根本不是（传统上说不是）原生 JavaScript 对象。

这就是框架倾向于拥有自己的“容器”包装类的原因。

即使它们是本机 JS 对象，您也不能依赖 't.el.constructor'。'constructor' 不是标准属性，在 IE 中不可用，甚至在 Mozilla 中也不会像您认为的那样做。避免。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-26T22:55:37.593

是的，真的没有办法做到这一点。

IE 元素是基于 COM 对象，实际上不允许将任意成员添加到它们的接口中（在 COM 中，接口是一种契约，不应更改）。这些接口的实现不能通过 Javascript 扩展，元素根本不是原型。

IE 添加了一个特殊接口，旨在与 Javascript 一起使用，以允许将新成员添加到特定实例，但您不能将新成员添加到“类”，因为没有原型可以摆弄。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-11-16T13:53:33.440

以下内容是从文章[HTMLElement doesnt work in IE 中](http://social.msdn.microsoft.com/Forums/pl-PL/iewebdevelopment/thread/40d2534e-9054-4de0-bca8-b52c7bbc1eef)剪切和粘贴的。示例在 IE 和 Firefox 中完美运行。

```
<html>
<head>
    <script type="text/javascript" src="DOMElement.js"></script>
    <script type="text/javascript">

        var DOMElement =
        {
            extend: function(name,fn)
            {
                if(!document.all)
                    eval("HTMLElement.prototype." + name + " = fn");
                else
                {
                    //
                    //  IE doesn't allow access to HTMLElement
                    //  so we need to override
                    //  *document.createElement
                    //  *document.getElementById
                    //  *document.getElementsByTagName
                    //

                    //take a copy of
                    //document.createElement
                    var _createElement = document.createElement;

                    //override document.createElement
                    document.createElement = function(tag)
                    {
                        var _elem = _createElement(tag);
                        eval("_elem." + name + " = fn");
                        return _elem;
                    }

                    //take copy of
                    //document.getElementById
                    var _getElementById = document.getElementById;

                    //override document.getElementById
                    document.getElementById = function(id)
                    {
                        var _elem = _getElementById(id);
                        eval("_elem." + name + " = fn");
                        return _elem;
                    }

                    //take copy of
                    //document.getElementsByTagName
                    var _getElementsByTagName = document.getElementsByTagName;

                    //override document.getElementsByTagName
                    document.getElementsByTagName = function(tag)
                    {
                        var _arr = _getElementsByTagName(tag);
                        for(var _elem=0;_elem<_arr.length;_elem++)
                            eval("_arr[_elem]." + name + " = fn");
                        return _arr;
                    }
                }
            }
        };

        DOMElement.extend("foo",function(){alert('bar')});
        DOMElement.extend("about","DOMElement v0.1")
        DOMElement.extend("contents",function(){return this.innerHTML})
        var elem = document.createElement("div");
        elem.foo();

        onload = function()
        {
            var elem2 = document.getElementById("myDiv");
            alert(elem2.about);

            var divs = document.getElementsByTagName("div");
            for(var i=0;i<divs.length;i++)
                alert(divs[i].contents())
        }

    </script>
</head>
<body>

    <div id="myDiv">hi</div>
    <div id="div2">there</div>

</body>
</html> 
```

试试看

# .net - 如何将我的 Web 应用程序与另一个 IM 系统的 Skype、Gtalk 集成？

> ID：592821
> 
> 赞同：3
> 
> 时间：2009-02-26T22:55:24.693
> 
> 标签：.net, web-applications, email, skype, google-talk

我希望能够使用他们选择的 IM 系统向我的用户发送提醒，就像[Remember The Milk](http://www.rememberthemilk.com/)在发送通知时所做的那样。

我怎样才能做到这一点？

附加信息：我在 ASP.Net、SQL Server 2008 和 Windows 2008 中开发

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T23:25:06.620

Just as an FYI, the GTalk servers also require Transport Level Security (TLS) so make sure to look for that in any library you are considering for your XMPP communications.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T23:05:43.187

These may be overkill for your problem but these servers implement the Jabber (Gtalk etc) protocol and have add-ins which support sending messages over all the major IM networks.

[http://www.process-one.net/en/ejabberd/](http://www.process-one.net/en/ejabberd/)

[http://www.igniterealtime.org/projects/openfire/](http://www.igniterealtime.org/projects/openfire/)

[http://jabberd.org/](http://jabberd.org/)

You might be able to integrate one of them into your solution to solve your IM needs.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T23:08:01.933

gtalk is Jabber. Look for Jabber bots, there are some that will work in your environment. For example [one in Python](http://thpinfo.com/2007/python-jabberbot/).

Skype requires instance of Skype running on your servers, and your application talking to it [via API](https://developer.skype.com/Docs/ApiDoc/Skype_API_on_Linux).

Each of the systems require its own approach. Thus your mileage can vary.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-26T23:42:29.790

如上所述，您可以使用自己的 jabber 服务器在该服务器上创建一个帐户，然后为您希望支持的每个 IM 协议添加一个网关。这样，您使用 jabber api 在一个帐户（您的本地 jabber 帐户）上发送消息，然后服务器将通过网关传递到各种协议。

另一种方法是使用[libpurple](http://developer.pidgin.im/wiki/WhatIsLibpurple)。这是用于支持 pidgin 和 adium 中的多协议支持的库。这种方式的设置更少，但学习曲线可能更高。

# c# - C# 帮助使用 StreamReader 读取外来字符

> ID：592824
> 
> 赞同：63
> 
> 时间：2009-02-26T22:55:58.920
> 
> 标签：c#, encoding

我正在使用下面的代码来读取一个包含外来字符的文本文件，该文件是 ANSI 编码的，在记事本中看起来很好。下面的代码不起作用，当文件值被读取并显示在数据网格中时，字符显示为正方形，其他地方是否还有其他问题？

```
StreamReader reader = new StreamReader(inputFilePath, System.Text.Encoding.ANSI);
using (reader = File.OpenText(inputFilePath)) 
```

谢谢

**更新 1**：我已尝试在`System.Text.Encoding`. 并且都无法正确显示文件。

**更新 2**：我已将文件编码（重新保存文件）更改为 unicode 并使用`System.Text.Encoding.Unicode`，它工作得很好。那么为什么记事本能正确读取呢？为什么不`System.Text.Encoding.Unicode`读取 ANSI 文件？

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2009-02-26T23:25:54.603

您也可以尝试使用当前系统的 ANSI 代码页的默认编码。

```
StreamReader reader = new StreamReader(inputFilePath, Encoding.Default, true) 
```

当您尝试对原始文件使用记事本“另存为”菜单时，请查看编码组合框。它会告诉您文件使用了猜测的记事本编码。

此外，如果它是 ANSI 文件，则 detectEncodingFromByteOrderMarks 参数可能不会有太大帮助。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2013-02-07T18:05:43.623

我有同样的问题，我的解决方案很简单：而不是

```
Encoding.ASCII 
```

采用

```
Encoding.GetEncoding("iso-8859-1") 
```

答案在[这里](https://stackoverflow.com/questions/2595442/using-net-how-to-convert-iso8859-1-encoded-text-files-that-contain-latin-1-acce)找到了。

编辑：更多解决方案。这可能更准确：

```
Encoding.GetEncoding(1252); 
```

此外，在某些情况下，如果您的操作系统默认编码与文件编码匹配，这也适用于您：

```
Encoding.Default; 
```

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2009-02-26T22:57:50.990

是的，它可能与文件的实际编码有关，可能是 unicode。尝试 UTF-8，因为这是最常见的 unicode 编码形式。否则，如果文件 ASCII 标准 ASCII 编码应该工作。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-26T23:29:17.577

使用 Encoding.Unicode 不会像 JPEG 解码器无法理解 GIF 文件一样准确地解码 ANSI 文件。

*如果 ANSI 文件真的是*ANSI ，我很惊讶它`Encoding.Default`不适用于 ANSI 文件——如果你确切地知道记事本使用的是*哪个*代码页，你可以使用.**[`Encoding.GetEncoding(int)`](http://msdn.microsoft.com/en-us/library/wzsz3bk3.aspx)**

 **一般来说，我建议尽可能使用 UTF-8。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-02-26T22:59:18.210

尝试不同的编码，例如 Encoding.UTF8。您也可以尝试让 StreamReader 自己找到编码：

```
 StreamReader reader = new StreamReader(inputFilePath, System.Text.Encoding.UTF8, true) 
```

编辑：刚刚看到你的更新。尝试让 StreamReader 进行猜测。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-06-12T13:42:59.230

对于瑞典语 Å Ä Ö，上述工作的唯一解决方案是：

```
Encoding.GetEncoding("iso-8859-1") 
```

希望这会节省一些时间。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-04-17T07:24:06.283

File.OpenText() 始终隐式使用 UTF-8 StreamReader。改为创建您自己的 StreamReader 实例并指定所需的编码。像

```
using (StreamReader reader =  new StreamReader(@"C:\test.txt", Encoding.Default)
 {
 // ...
 } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-01-16T14:31:26.090

我解决了阅读葡萄牙语字符、更改记事本++上的源文件的问题。

![在此处输入图像描述](https://i.stack.imgur.com/r9vuy.png)

**C＃**

```
 var url = System.Web.HttpContext.Current.Server.MapPath(@"~/Content/data.json");
    string s = string.Empty;
    using (System.IO.StreamReader sr = new System.IO.StreamReader(url, System.Text.Encoding.UTF8,true))
    {
          s = sr.ReadToEnd();
    } 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-06-24T14:12:34.097

我还在阅读一个包含法语和德语的导出文件。我使用了 Encoding.GetEncoding("iso-8859-1")，它确实没有任何挑战。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-11-29T08:04:16.163

对于阿拉伯语，我使用了`Encoding.GetEncoding(1256)`. 它运行良好。

# hibernate - JPA：请帮助理解“join fetch”

> ID：592825
> 
> 赞同：13
> 
> 时间：2009-02-26T22:57:04.970
> 
> 标签：hibernate, orm, jpa

我有以下实体结构：业务 --> 活动 --> 促销，其中一个企业可以有许多活动，一个活动可以有很多促销。两个一对多关系都被声明为 LAZY。在我的代码中的一个地方，我需要急切地从企业中获取这两个集合，所以我这样做：

```
 Query query = entityManager.createQuery("select b from Business b " +
            "left join fetch b.campaigns c " +
            "left join fetch c.promotions where b.id=:id");
query.setParameter("id", b.getId());
business = (Business) query.getResultList().get(0); 
```

但是，查询返回一个包含 4 个业务对象的结果列表，所有 4 个对象都引用同一个业务实例。在我的数据库中，该业务有 3 个广告系列，并且所有 3 个广告系列都有 3 个促销活动。

我有两个问题：

1.  起初，我使用 List 来包含多个方面的关系，但是当程序运行时，我得到“org.hibernate.HibernateException：不能同时获取多个包”异常。然后我用谷歌搜索了这个异常，看起来我必须使用 Set，而不是 List。所以我将集合更改为 Set 并且它起作用了。有人能告诉我为什么 List 在这种情况下不起作用吗？

2.  我期望查询返回一个结果，因为它查询的是主键 id，因此应该只返回一个结果。但事实证明，它在 List 中返回 4 个实例。这是一个问题吗？或者这是预期的行为？

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-26T23:26:13.887

生成的 sql 看起来像：

```
select * from Business b 
left outer join campaigns c on c.business_id = b.id
left join promotions  p on p.campaign_id = c.id
where b.id=:id 
```

在内部，Hibernate 将只有一个业务实例，但重复项将保留在结果集中。这是预期的行为。您需要的行为可以通过使用 DISTINCT 子句或使用 LinkedHashSet 过滤结果来实现：

```
Collection result = new LinkedHashSet(query.getResultList()); 
```

这将只返回唯一的结果，保留插入顺序。

每当您尝试以有序的方式急切地获取多个集合（并且可能是重复的项目）时，就会发生“org.hibernate.HibernateException：无法同时获取多个包”。如果您考虑生成的 SQL，这确实有点道理。Hibernate 无法知道重复对象是由连接引起的还是由子表中的实际重复数据引起的。看看[这个](http://www.jroller.com/eyallupu/entry/hibernate_exception_simultaneously_fetch_multiple)以获得很好的解释。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T23:45:27.117

1.  由于笛卡尔积，List 可能有多余的元素，而人们并没有意识到这一点，所以 hibernate 的家伙开始抛出这个错误，迫使人们使用 Set 而不是 List 来避免这个问题。来源[1](http://forum.hibernate.org/viewtopic.php?p=2310316&)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T23:21:58.233

1.  我假设如果你使用一个列表，休眠假设顺序很重要，它会从返回的行中推断出元素的顺序，但是如果你加入另一个表，休眠将多次获取每个活动，这会混淆休眠。同样，我只是假设这个

2.  这是预期行为使用 RootEntityResultTransformer 获取单个根实体：[http ://www.hibernate.org/hib_docs/v3/api/org/hibernate/transform/RootEntityResultTransformer.html](http://www.hibernate.org/hib_docs/v3/api/org/hibernate/transform/RootEntityResultTransformer.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-04T18:39:20.630

另一种替代使用 Set 的解决方法是使用两个查询来获取数据：- 第一个用于加载活动及其相关的业务促销活动。然后使用 fetch 加载业务及其活动

```
 Query query1 = entityManager.createQuery("select c from Business b join b.campaigns c left join fetch c.promotions where b.id=:id");
    query1.setParameter("id", b.getId());
    query1.getResultList();

    Query query2 = entityManager.createQuery("select b from Business b left join fetch       b.campaigns where b.id=:id");
    query2.setParameter("id", b.getId());
    business = (Business) query2.getResultList().get(0); 
```

# javascript - Wtf IE7 - 使用 setTimeout 的 AJAX 调用

> ID：592830
> 
> 赞同：0
> 
> 时间：2009-02-26T22:57:59.320
> 
> 标签：javascript, jquery, ajax, internet-explorer

我已经在 Firefox、Opera 和 Seamonkey 上对此进行了测试。它工作正常。谈到 Internet Explorer 7。它可以工作，但在一定程度上。我每隔几秒钟就对 PHP 脚本进行一次 AJAX 调用。在 IE7 中，它会进行第一次 AJAX 调用并检索数据，但它不会再这样做了。即使我在 else 块中有一个 setTimeout 函数。**为什么？**:(

```
startTime = setTimeout('getStatus()', 5000); 

}//function convertNow 
```

函数 getStatus() {

```
 $.ajax({
    type: "GET",
    url: "fileReader.php",
    data: 'textFile=' + fileNameTxt,
    success: function(respomse){
    textFileResponse = respomse.split(" ");
    $("#done").html("Downloading & Converting Video...<b style='font-size:17px;color:green;'>" + textFileResponse[0] + "</b><br /><b>" + properFileName + '</b>');
    }
    });//ajax

    if(textFileResponse[0]=='100.0%'){

    }
    else{       
    continueTime = setTimeout('getStatus();', 3000); 
        alert('call end');
    } 
```

}

如果有任何挫败感来自这个问题，我们深表歉意。在过去的三个小时里，我一直像无头鸡一样到处乱跑。

感谢您的任何帮助。

## 编辑 2

我已经添加了完整的功能。setTimeout 似乎工作正常。它一定是 AJAX 调用，我只是检查返回的内容。更陌生！它不断从 AJAX 请求返回相同的值，并且没有得到任何更新的值！我认为答案 2 可能有问题。这可能是由于缓存造成的，但是您如何克服呢？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T23:08:35.177

您是否通过 HTTP GET 而不是 HTTP POST 请求 ajax 调用？IE 倾向于使用 ajax 调用的缓存结果，除非您使用 POST 而不是 GET。

编辑：既然你已经更新了你的问题，我可以看到你确实在使用 GET 动词。将其更改为 POST，我敢打赌您的问题将得到解决。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T23:05:42.390

对此完全不确定，但您是否错过了`;`？

从：

```
setTimeout('getStatus()', 3000); 
```

到：

```
setTimeout('getStatus();', 3000); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-09T14:12:42.863

您仍然可以使用 GET 请求并简单地添加

```
cache: false 
```

到 $.ajax 请求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T23:34:22.430

我注意到 textFileResponse 在 AJAX 调用的成功处理程序的函数声明中设置，但在进行 AJAX 调用后立即作为数组引用。也许在 IE 7 中，成功处理程序在数组引用之前尚未完成，这会引发 java 脚本错误，因此 setTimeout 将永远不会运行。

# test-data - 有哪些好的在线数据集资源？

> ID：592839
> 
> 赞同：4
> 
> 时间：2009-02-26T23:00:44.603
> 
> 标签：test-data

前段时间，我遇到了一个在线站点，其唯一目的是收集各种数据集、位置数据、地区人口普查数据或社区成员有兴趣维护的任何数据集。

我的问题是，你知道我正在考虑的网站吗，或者你能推荐任何其他提供类似服务的网站吗？

我会建议[GeoNames](http://www.geonames.org/)，它是 zip/postal、lat/long 和许多其他地理信息的重要来源。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T23:16:56.500

Take a look at these websites:

*   [IBM Many Eyes](http://manyeyes.alphaworks.ibm.com/manyeyes/)
*   [Swivel](http://www.swivel.com/)
*   [Data 360](http://www.data360.org/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-27T00:54:19.243

以下是我书签中的一些其他内容：

[DatabaseAnswers.org](http://www.databaseanswers.org/data_models/index.htm)

[迪斯科](http://www.discogs.com/)

[游离碱](http://www.freebase.com/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-28T18:03:48.897

刚刚向我展示的另一个是[sig.ma](http://sig.ma/)，一个用于检索本体的搜索工具。如果您正在构建 web 2.0 服务，这将是一个很好的引导工具。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-07-12T16:06:29.840

我经常使用 Common Data Hub：http:
[//www.commondatahub.com/home](http://www.commondatahub.com/home)

特别是对于标准化数据表。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-11-20T14:12:00.643

Buzzdata： [http](http://buzzdata.com/) ://buzzdata.com/对我来说似乎是发布和共享大型数据集的好方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-12T22:00:08.423

体育怎么样：棒球档案有关于1871 年 *所有棒球的统计数据...* [http://baseball1.com/statistics](http://baseball1.com/statistics) - 如果您想训练一些统计数据，这是一个很好的日期来源。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-07-12T16:04:39.910

最全面的音乐数据集是 MusicBrainz [http://musicbrainz.org/](http://musicbrainz.org/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-27T00:19:28.097

[搜索](http://search.msn.com/results.aspx?q=amazon+public+data+sets&FORM=QBHP)

编辑：我的意思不是一般的搜索，我的意思是说：亚马逊正在托管一些选定的公共领域数据集供所有人使用。你可以通过搜索找出他们有哪些可用的数据集。

# xml - 使用 SQLite API 从基于 C 的 CGI 应用程序生成 XML 的最佳方法是什么？

> ID：592842
> 
> 赞同：0
> 
> 时间：2009-02-26T23:01:56.003
> 
> 标签：xml, sqlite, cgi

第一次从 W3C 教程中学习 XML 的基础知识。大多数 XML 文件是如何生成的？服务器端应用程序是否通常会在每次有新数据时打印一个完整的 XML 文件以进行解析？

我有一个 CGI 应用程序，它包含 SQLite API。对 XML 文件进行某种处理`printf`（使用数据库中的数据）以便对其进行解析的最佳方法是什么？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-26T23:06:28.410

大多数 XML 文档都是通过 API 创建的。

通常这是在内存中创建的，然后进一步处理（例如通过 XSLT）成其他形式，或通过网络链接发送。

您可以使用字符串连接来构建 XML，但您必须小心字符编码和结构。通常，除了最简单的文档外，XML API 会更容易。（尽管有些 API 比其他 API 更容易）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T23:06:30.890

可以以任何方式生成 XML，这是它的优点之一。

通常可以吐出 XML，尽管它的可读性不是很强。如果您直接编写 XML，请使用一些实用程序类或库（周围有很多）可以帮助您创建格式良好的 XML（例如，它将跟踪当前深度、当前打开的元素是什么等）

许多 API（也适用于 OOP 语言）还允许您直接操作表示 XML 文档的 DOM 树，然后强制将其输出为 XML。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T23:07:47.037

如何做到这一点取决于您。假设你有这个结构

```
<logfile>
     <logentry>...</logentry>
     ...
</logfile> 
```

您可以通过查找它们包含的标签将日志条目附加到开始或结束。

# vim - 当文件变为只读时，Vim 会忘记它的历史

> ID：592843
> 
> 赞同：2
> 
> 时间：2009-02-26T23:02:09.280
> 
> 标签：vim, undo

在我使用 vi 将文件提交到 Perforce 后，它将变为只读的。

如果我在 vim 中打开这个文件，那么当它变为 readonline 时，我会丢失我的撤消重做历史，甚至不会被询问。

当您在编辑时文件变为只读时，VI 中是否有保留撤消重做历史记录的选项？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T16:35:01.743

这是一个 Vim 错误。每当您`:edit filename`隐式或显式地表明 Vim 正在清零该文件的所有撤消历史记录时，因为（我猜）它认为它是新打开的文件。在 perforce 提交之后，你的文件有点“在外面改变了”，Vim 应该问你“重新加载文件？” 除非您设置“自动读取”。

检查 vimrc 中的“设置自动读取”选项。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T10:46:05.017

也许您可以尝试使用 modelines 使其可读：

```
#vim : set noreadonly: 
```

我写了 # 但当然你必须用适当的符号替换它才能发表评论。

# c# - 在应用程序的某些部分需要完全并行的情况下，F# 是否优于 C#？

> ID：592856
> 
> 赞同：7
> 
> 时间：2009-02-26T23:07:24.197
> 
> 标签：c#, .net, f#, parallel-processing

在应用程序的某些部分需要完全并行的情况下，F# 是否优于 C#？

我的主要语言是 C#，我正在编写一个应用程序，其中构建在应用程序 (C#) 之上的核心功能必须并且计划非常并行。

我在 F# 中实现这些类更好吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T23:09:58.950

我会看看[Microsoft](http://msdn.microsoft.com/en-us/concurrency/default.aspx)正在开发的 Parallel Extensions 。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-27T03:52:30.703

如果您只需要并行处理数据集，ParallelFX 非常方便。他们将在 C# 中手动执行此操作会很痛苦。

但是，如果代码有很多异步代码，那么 F# 的 async monad 会比在 C# 中实现的要容易得多。如果您正在查看大量 BeginXXX/EndXXX 或可怕的 XXXAsync/XXXCompletedEvent 代码，那么 F# 将是一个重大胜利。

否则，您将获得 F# 优于 C# 的一般收益。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-28T14:44:58.833

有两种方法可以使事情并行化，它们都在 F# 中工作得很好。

*   正如 Josh 已经提到的，有一个 Parallel Extensions 库。这使得并行处理某些数据结构变得非常容易，尤其是您经常在 F# 中使用的不可变数据结构。因此，将并行扩展与 F# 相结合是正确的方法。这将在我[即将出版的真实世界的 F# 书籍](http://manning.com/petricek)中讨论，但我正在提供[源代码](http://www.functional-programming.net/sources.aspx)。这在第 14 章中有介绍，并且它的源代码应该很快就会提供。

*   对于某些问题，您可以使用消息传递并发，这是共享内存的一种有吸引力的替代方案。[您可以在Don Syme 书中的免费章节](http://download.microsoft.com/download/b/b/6/bb666ebe-e643-496f-b290-03527d157b47/Expert.F.Sharp_Ch13_8504Syme.pdf)中找到一些相关信息。我的书中也将介绍它（第 13 章和第 16 章）。

*   通过将消息传递并发与异步工作流相结合，您可以获得编写无法使用并行扩展轻松并行化的程序的绝佳方式（即它们需要共享一些信息并还使用异步非阻塞操作（例如从互联网下载） ))

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-02T18:32:44.057

根据 Luca Bolognese 的演示，易于实现并行是 F# 的强项之一。在大约 53 分钟的时候，它变得相当令人印象深刻。希望这个对你有帮助。 [http://channel9.msdn.com/pdc2008/TL11/](http://channel9.msdn.com/pdc2008/TL11/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-04-10T11:17:43.873

总体而言，F# 与 C# 相比具有许多优势，并且这些优势在并行编程的上下文中发挥着同等作用，但 F# 编程语言并没有使它更适合并行编程。

特别是，有一个神话，即避免副作用和纯粹的功能是并行性的灵丹妙药，但这是无稽之谈。您可以让纯功能程序更轻松地燃烧更多内核，但在多核上获得具有竞争力的绝对性能和加速是一个未解决的问题。

As others have already said, you will almost certainly want to use the Task Parallel Library that is now part of .NET 4\. Note that the Visual F# 2010 standard library includes several functions that use the TPL, such as `Array.Parallel.map`.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-26T23:10:47.217

F# 基本上没有副作用，所以是的，但您不想在其中实现 UI。另一方面，下一个版本的 C# 将通过 LINQ 内置大量并行功能。

您还必须权衡您的培训要求以及 F# 还不是 RTM 并且要到今年年底才会出现的事实。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-26T23:13:24.230

F# 使某些方法更好（例如本机消息支持），但如果您最小化（或更好，消除）可变状态，您可以在 C# 中做到这一点。

正如其他答案中所指出的，.NET 库很快就会通过并行扩展以这种方式得到很大的提升。但是，如果您开始使用锁，这些将同样缺乏可伸缩性。

# javascript - Javascript“变量变量”：如何根据另一个变量分配变量？

> ID：592862
> 
> 赞同：4
> 
> 时间：2009-02-26T23:08:48.000
> 
> 标签：javascript, variables

我在 Javascript 中有一组全局计数器变量：

```
var counter_0 = 0;
var counter_1 = 0;
var counter_2 = 0; 
```

ETC

然后我有一个 Javascript 函数，它接受映射到这些全局计数器的“索引”数字。在这个函数内部，我需要使用传递给函数的“索引”值来读取和写入这些全局计数器。

我希望它如何工作的示例，但当然根本不起作用：

```
function process(index) {
    // do some processing

    // if 'index' == 0, then this would be incrementing the counter_0 global variable
    ++counter_+index; 

    if (counter_+index == 13)
    {
        // do other stuff
    }
} 
```

我希望我想要完成的事情很清楚。如果不是，我会尝试澄清。谢谢。

编辑澄清：

我不是要增加计数器的名称，而是增加计数器包含的值。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-26T23:13:04.073

对我来说看起来像一个数组，还是我错过了什么？

```
var counters = [0,0,0];

function process(index) {
   ++counters[index]; 
      /* or ++counters[index]+index, not sure what you want to do */
   if (counters[index] === 13) { 
      /* do stuff */ 
   }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-26T23:30:46.840

```
function process(index) {
    // do some processing
    var counter;
    eval('counter = ++counter_'+index);
    if (counter == 13)
    {
        // do other stuff
    }
} 
```

确保索引确实是一个整数，否则可能会出现混乱。

**编辑**：其他人指出，如果可以的话，你应该使用数组。但是，如果您坚持使用命名的全局变量，那么上述方法将起作用。

**编辑**：bobince 指出您可以使用 window 对象按名称访问全局变量，因此以下内容值得称赞：

```
function process(index) {
    // do some processing
    var counter = ++window['counter_' + index];
    if (counter == 13)
    {
        // do other stuff
    }
} 
```

其他答案说“不要使用`eval()`”，但不是为什么。这是[MDC](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Functions/eval)的解释：

> **不要使用评估！**
> 
> eval() is a dangerous function, which executes the code it's passed with the privileges of the caller. If you run eval() with a string that could be affected by a malicious party, you may end up running malicious code on the user's machine with the permissions of your webpage / extension.
> 
> There are safe alternatives to eval() for common use-cases.

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-26T23:13:09.800

javascript 函数将`eval()`允许您完成此操作。然而，它通常是不受欢迎的。您的问题没有明确排除数组。数组肯定更适合您描述的模式。

# ruby - RSpec 和 Open-URI 如何模拟引发 SocketError/TimeoutError

> ID：592863
> 
> 赞同：5
> 
> 时间：2009-02-26T23:09:02.227
> 
> 标签：ruby, rspec, raise, open-uri

我希望能够指定当 Open-Uri open() 调用超时或引发异常（例如 SocketError）时，我正在按预期处理事情，但是我遇到了麻烦。

这是我的规范（针对 SocketError）：

```
@obj.should_receive(:open).with("some_url").and_raise(SocketError) 
```

以及我使用 open-uri 的对象部分：

```
begin
  resp = open(url)
  resp = resp.read
rescue SocketError
  something = true
end 
```

然而，在这种情况下，规范失败并出现`nil.read`错误。

这是本周我第二次遇到这个问题，上一次我试图在`open()`用 a包装时模拟 TimeoutError `timeout() {}`，那次我放弃了，只是通过打开课程而导致实际超时发生。我显然*可以*通过尝试调用无效的 URL 来引发 SocketError，但我确信有一种正确的方法可以使用 RSpec 来模拟它。

**更新：**我显然没有在深夜想清楚，错误实际上是当我在 SocketError 之后重新尝试 URL 时，and_raise(SocketError) 部分工作正常。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T02:05:23.550

根据您提供的信息，您提供的行应该可以工作：我制作了一个只有描述的功能的小型测试类和规范（见下文），并且事情的表现符合预期。如果您可以提供更多上下文可能会有所帮助 - 例如，规范中的完整“it”块可能会暴露一些其他问题。

如前所述，以下规范通过了，我相信它捕获了您试图验证的逻辑：

```
require 'rubygems'
require 'spec'

class Foo
  attr_accessor :socket_error

  def get(url)
    @socket_error = false
    begin
      resp = open(url)
      resp = resp.read
    rescue SocketError
      @socket_error = true
    end
  end
end

describe Foo do
  before do
    @foo = Foo.new
  end

  it "should handle socket errors" do
    @foo.should_receive(:open).with("http://www.google.com").and_raise(SocketError)
    @foo.get("http://www.google.com")
    @foo.socket_error.should be_true
  end
end 
```

# c# - 如何在具有值类型约束的泛型声明类型之间进行复制

> ID：592864
> 
> 赞同：1
> 
> 时间：2009-02-26T23:09:04.160
> 
> 标签：c#, .net, generics, casting, generic-constraints

我有一个在值类型之间复制值的通用方法。即使使用结构约束，以下方法也会产生设计时错误。知道如何在值之间复制或转换吗？

```
private Ttgt MyMethod<Tsrc,Ttgt>(Tsrc SourceObject) 
    where Tsrc : struct
    where Ttgt : struct
{
    //Error:cannot implictly convert type 'Tsrc' to 'Ttgt'
    Ttgt returnObject = SourceObject; 

    //Error:Cannot convert type 'Tsrc' to 'Ttgt'
    Ttgt returnObject = (Ttgt)SourceObject; 

    return returnObject;
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-26T23:37:24.343

鉴于有一个已注册的类型转换器，用于您尝试在一些反射魔法之间转换的类型可以做到这一点：

```
private Ttgt MyMethod<Tsrc,Ttgt>(Tsrc sourceObject) 
    where Tsrc:struct where  Ttgt:struct    
{    
    Type targetType = typeof(Ttgt);
    TypeConverter tc = TypeDescriptor.GetConverter(targetType);
    Ttgt returnObject = (Ttgt)tc.ConvertTo(sourceObject, targetType);
    return returnObject;    
} 
```

但是开箱即用它的用途非常有限，因为例如 bool 和 int 之间没有转换器。你想解决什么问题？

我还发现了另一个[问题](https://stackoverflow.com/questions/452120/how-do-i-make-a-universal-type-conversion-method)，其中包含一些疯狂的转换代码。

编辑：您的评论清楚地表明您正在尝试在域对象和某种视图/合同模型之间执行对象到对象的映射。你看过[AutoMapper](http://www.codeplex.com/AutoMapper)吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T23:16:18.420

> //错误：无法将类型“Tsrc”转换为“Ttgt”

除非有可访问的转换运算符，否则您不能在任意类型之间进行转换。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T23:16:39.557

两者被定义为不同的类型。即使它们都是结构，它们也不是相同的类型。

将 souce 和 target 定义为相同的类型：

```
private T MyMethod<T>(T source, T target)
{ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T04:43:39.117

这是“设计”。您正在尝试在两个不相关的值类型之间进行转换。这永远不会成功，因此它被标记为错误。

这对于所有值类型都是正确的，因为它们是隐式密封的。为了使 TSrc -> Ttgt 之间的转换成功，这两种类型之间必须存在类层次关系。这不可能是因为所有值类型都是密封的，因此无法从另一个派生。

这可能成功的唯一方法是在类型之间有一个自定义转换运算符。情况可能是这样。但是在处理泛型类型时，不会处理自定义转换运算符。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-03T21:37:46.183

[Convert](http://msdn.microsoft.com/en-us/library/system.convert.aspx)类就是为了这个目的而存在的。

```
private Ttgt MyMethod<Tsrc, Ttgt>(Tsrc SourceObject)
    where Tsrc : struct
    where Ttgt : struct
{
    return (Ttgt) Convert.ChangeType(SourceObject, typeof(Ttgt));
} 
```

另请注意，您*可以*这样做：

```
 return (Ttgt) (object) SourceObject; 
```

# programming-languages - 一种新兴的编程语言真的需要实用的库吗？

> ID：592865
> 
> 赞同：6
> 
> 时间：2009-02-26T23:09:18.403
> 
> 标签：programming-languages

使用一个或其他的因子，Arc 或其他任何东西作为例子（注意：因子是一个坏例子，因为它有大量的实用库）。假设您正在考虑使用编程语言。拥有大量实用库重要吗？如果您的语言设计得很好，那么创建“字符串”库或“日期”库将很容易。甚至可能是一个 Web 框架？

我提到这一点，因为当一种语言出现时，似乎有人提出了“实用库”。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-26T23:12:58.257

这绝对很重要——十分之九，我会选择一种语言，它有良好的、支持良好的库来帮助完成我想做的事情。

这并不是说我不喜欢编写自己的库（恰恰相反），但是对于一个快速、准确的结果很重要的生产项目，无论想象如何，这都不是一个实际的选择。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-26T23:25:49.940

Java 和 .Net 用框架中的大量类或其他高质量库（通常也是免费和开源的）中的大量类宠坏了人们。Ruby 和 Python 也是如此。如果没有这样的库，就很难采用新语言，因为必须重新实现所需的每一个功能，您的工作效率将受到严重影响。

除非它是一种突破性的语言，它引入了一些激进的东西，比如有意编程（我告诉计算机我想要它做什么，它会推断出正确的代码来做它）......为什么，你有一个？:-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-26T23:12:56.320

实用的库很重要。我没有为编写框架而获得报酬，我获得报酬是为了为企业增加价值。如果我告诉客户我必须向他们收费以编写字符串数据类型，我可能会失去工作/合同。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-26T23:13:17.740

只需查看此处有关 SO 的大多数问题，即可了解工具对人们的重要性。

也就是说，如果您找到一种非常适合您的任务的新语言，并且您有时间和意愿编写自己的工具，那么一定要投入其中。毕竟，这是新语言*获得*优秀库的一种方式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-26T23:40:26.207

大型库使语言的使用效率更高。不支持解析 XML、加密、Web 框架、UI 框架等的非常棒的语言需要更多时间来生成工作代码。出于学习目的，没有大型库的语言是可以的，但出于实际目的，使用这种语言会花费时间和金钱。想象一下，如果每次您想要加载图像时，您都必须编写代码来解析 .jpg 标头。如果您必须手动编写 XML 解析器而不是将其加载到预先构建的解析器中会怎样。您可能会搞砸并花费大量时间进行调试。如果项目的目标是创建一个新工具，那么编写支持代码并不能很好地利用您的时间。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-26T23:42:21.477

我认为 Python 受欢迎的主要原因是其庞大的标准库。Java 和 PHP 也是如此。事实上，我可能会说库的选择比语言本身更重要。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-26T23:46:07.317

如果您的首要任务是用尽可能少的时间和精力创建成品，那么是的，拥有可用的库很重要。（如果您的目标是有趣，或者为了学习而学习，那么编写自己的库可能是一种很好的体验。）

一个好的库已经足够成熟，以至于很多人都使用过它并清除了大部分错误。不管你的编程语言有多好，或者从头开始编写一个库有多容易。随着时间的推移对代码进行测试是无可替代的。

许多库编写起来既不有趣也不有趣，再次重新实现它们不会以任何方式彻底改变世界。对于日期库或字符串库，您只能做这么多。它要么起作用，要么不起作用。许多库只是标准或某些事实上的标准行为的实现，而有人只需要努力完成必要的工作以使其正确。你自己做的越少越好。

在我看来，任何可以利用现有库的全新语言都遥遥领先。例如 Clojure，虽然是一种非常新的语言，但也可以访问 Java 的所有库。这可以说是它目前表现如此出色的一个重要原因。努力在新事物上，而不是重新发明轮子。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-27T02:00:04.657

你觉得字符串库好写吗？去看看 Unicode、UTF-8、UTF-16、遗留代码页、字节顺序问题等等。

您认为日期/时间库易于编写吗？去看看闰秒，周编号方案等等。

为您考虑到这些事情，实施一次并正确实施，比您想象的节省更多时间和麻烦。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-27T01:45:28.780

这是一个诱人的想法，如果你是 Paul Graham 或 Chuck Moore，它肯定会奏效。

如果您的域非常有限，并且您不会收到超出该域的要求，它可能会起作用，就像客户要求“从 Excel 导入”功能一样简单。另一方面，Paul Graham 使用 Lisp 编写了一个网店系统，这是一个非常广泛的需求领域；我很想知道他是如何处理诸如 PDF 导出之类的事情的，他是否会在暑假从麻省理工学院向某个实习生提供 PDF 规范和 Lisp 手册，或者他会去 C 库？

如果您的领域是由逻辑或持久的自然原理驱动的，例如天文学模拟，它可能会起作用。如果它们是人类的需求，它们将充满矛盾和特殊情况（顺便说一下，字符串和日期库属于该类别），并且没有抽象或语言功能可以完全解决这个问题，您将拥有无论您是用 Haskell 还是 PHP 编写，都可以在特殊情况下苦苦挣扎。

它可能适用于优化非常重要的地方（编辑：并且你足够聪明，可以自己优化它） - 你有一个精简的系统，你知道堆栈的每一层，因为你自己实现了一个特定的目标心里。

我将整个想法与研究生联系起来：他们在编程技能和一般聪明方面处于前 1%；他们在一个非常狭窄的领域工作；他们可能没有最好的设备，所以他们试图精简并深入优化；他们没有工作程序员的学习与完成工作的困境。

# visual-studio - Maintainability Index

> ID：592866
> 
> 赞同：13
> 
> 时间：2009-02-26T23:09:27.140
> 
> 标签：visual-studio, maintainability, code-complexity

I have come across the recommended values for a Maintainability Index (MI) as follows:

*   **85 and more**: good maintainability
*   **65-85**: moderate maintainability
*   **65 and below**: difficult to maintain with really bad pieces of code (big, uncommented, unstructured) the MI value can be even negative

Are these values are dependent on technology? For example, is a value of 70 good for Mainframes but difficult to maintain for Java?

Can use same yardstick independent of technologies?

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-12-07T11:17:34.953

这是关于可维护性指标值含义[的解释。](https://blogs.msdn.microsoft.com/zainnab/2011/05/26/code-metrics-maintainability-index/)

不久这是

```
MI = 171 - 5.2*ln(Halstead Volume) - 0.23*(Cyclomatic Complexity) - 16.2*ln(Lines of Code) 
```

在 0 到 100 之间缩放。

很容易看出，该指标可用于任何程序语言。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-09-11T16:47:42.607

65 和 85 阈值来自于 1992/1994 年介绍可维护性指数的[原始论文。](http://www.ecs.csun.edu/~rlingard/comp589/ColemanPaper.pdf)

Visual Studio 略微调整了指标（乘以 100/171）以使其适合 1-100 的比例。Visual Studio 使用[10 和 20 作为阈值](http://blogs.msdn.com/b/codeanalysis/archive/2007/11/20/maintainability-index-range-and-meaning.aspx)。

一般来说，我不会太认真地对待这个指标及其阈值：另请参阅我的博客文章“[在使用可维护性指数之前三思](http://avandeursen.com/2014/08/29/think-twice-before-using-the-maintainability-index/)”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-04-12T19:58:24.090

可维护性指数是一个经验公式。它是基于观察和适应构建的模型。如果您搜索更多细节，会发现必须针对特定语言对方程式进行校准。SEI 的版本针对 Pascal 和 C 进行了校准，并使用了一堆程序，平均 50KLOC，由 Hewlett-Packard 维护。

Visual Studio 版本的校准与 SEI 版本相同，但被修改为将域限制为 0 到 100。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-10T15:12:54.107

我认为您无法对开发人员维护一段代码的难易程度给出一个数字。

不同的人会根据经验、文化、阅读理解等来查看相同的代码并以自己的方式解释它。

话虽如此，不同技术的指标**肯定会有所不同。**您正在查看完全不同的语法、约定、术语等。您如何量化低级大型机代码和高级语言（如 Java 或 C#）之间的难度差异？

我认为指标对一件事有好处，而且只有一件事：指导方针。就代码质量而言，我认为它们不应该用于描述代码库以外的任何事情。它们不应该被用作难度或“grok-ability”的决定因素。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T03:31:07.213

It depends how the "Maintainability Index" is calculated. This doesn't seem to me like something which would work across languages simply because languages are so different.

It might seem reasonable to do a simple compare of "number of lines per function", but what happens when you try and compare C code which is full of pointers, or C++ code full of templates, or C# with LINQ queries, or Java with generics?
All of those things affect maintainability but can't be measured in any meaningful cross-language way, so how can you ever compare numbers between 2 languages?

# javascript - 用于新选项卡 (CTRL+T)、新窗口 (CTRL+N) 的 javascript？

> ID：592867
> 
> 赞同：7
> 
> 时间：2009-02-26T23:09:46.423
> 
> 标签：javascript, flash

当flash有键盘焦点时，`CTRL`+ `T`（新标签）和`CTRL`+ `N`（新窗口）被flash截取。

有没有办法将这些事件传递给浏览器以便它们工作（打开新选项卡，打开新浏览器）或者这些操作是否有 javascript 命令？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-27T00:02:22.410

这是 Flash 和浏览器长期存在的问题。（我的意思是**很久**- 看看这个Mozilla 浏览器上存在[8 年历史的错误](https://bugzilla.mozilla.org/show_bug.cgi?id=78414)。）问题是 Flash 拦截所有输入事件，而不是浏览器。它在自己的环境中被沙盒化，并且不会将事件传递回浏览器。

从概念上讲，这不一定是坏事。当 Flash 想要监听`ctrl`+`n`事件时会发生什么？浏览器是否应该因为 Flash 已经使用该热键而将注意力从 Flash 上移开？对于 Flash 开发人员来说，这将是一个真正的痛苦，这是肯定的。

我已经为特定浏览器看到了有关如何解决此问题的建议，但没有包罗万象的解决方案。例如，[这个解决方案](http://www.ibm.com/developerworks/opensource/library/os-78414-firefox-flash/index.html)在 bug 中被引用，但它显然不会按照你想要的方式工作（因为用户必须跳过很多圈才能让它工作）。

所以……不，暂时。如果这个问题可以解决，那就太好了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T23:40:40.700

最接近的方法是让 ActionScript 触发 Javascript 以打开一个空白窗口到一个空白 URL

```
// We abstract it in a function here in case we want to
// change it later
function openBlankWindow()
{
   window.open( '' );
} 
```

对于大多数人来说，这将启动一个新窗口或一个新选项卡（取决于他们的浏览器偏好），但由于它是由网页启动的，因此可能会受到弹出窗口阻止程序的影响。

没有办法真正要求浏览器专门执行您所询问的两个任务之一。如果网页具有执行此操作的权限/特权，我将成为安全/烦恼的噩梦。

# c# - Is it possible for a function to only be called from within another function?

> ID：592873
> 
> 赞同：1
> 
> 时间：2009-02-26T23:11:06.327
> 
> 标签：c#, function

In C# is it possible to create a function that can only be called from within another function?

e.g., can you do something like this?

```
private void a()
{

b();
c();
...do something else

private void b()
{
  ..do something but can only be called from a()
}

private void c()
{
  ..do something but can only be called from a()
}

} 
```

The reason I want to do this is that function `b()` and `c()` split some implentation details of `a()` and they are just cleaner and easier to read in their own scope. However, these functions are of no use to the class as `a()` does some handling after they are called which must take place.

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-26T23:13:35.540

Use an anonymous nested function maybe?

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-26T23:41:28.017

我不会担心采取明确的步骤来确保`b()`并且`c()`只被`a()`.

*担心你在一个类上公开的公共*方法是有道理的，因为你正在为外部世界提供一个接口，可能是那些无权访问你的类的源代码的人（或者至少不要不想担心你的类的实现细节）。

*但是，在*您的班级中，您应该出于任何原因随意使用任何您想要的私有方法。代码重用是创建新私有方法的原因之一，但创建多个较小的、一次性使用的方法来分解较大的方法也是一个完全有效（和常见）的原因。

除此之外，对于您的代码的未来维护者，一个简单的注释，例如：

```
//this method should only be called by a()
private void b()
{
    ...
} 
```

将比这里介绍的大多数其他解决方案更容易理解。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-26T23:16:46.827

Using a delegate you can do:

```
public voidMyFunction()
{

   Func<string> myFunction=(s)=>Console.WriteLine(s);

   foreach(string str in myStringList)
   {
      myFunction(str);
   }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-26T23:13:49.797

The short answer is no; however, you can create an anonymous delegate or lambda expression as your internal b() method.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-26T23:36:54.343

您可以使用 StackFrame 类在运行时检查谁是函数的调用者：

```
public class MyClass
{
    public static void A()
    {
       B();
    }

    public static void B()
    {
        var stackTrace = new StackTrace();

        if (stackTrace.FrameCount < 1 || stackTrace.GetFrame(1).GetMethod() != typeof(MyClass).GetMethod("A"))
              throw new InvalidOperationException("Not called from A()");
    }
} 
```

但那是

1) 仅在运行时

2) 慢

3）一个非常肮脏的黑客

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-26T23:27:50.327

好吧，您可以使用反射并获取调用方法名称，如果它不是 A 则抛出异常。

[http://www.csharp-examples.net/reflection-calling-method-name/](http://www.csharp-examples.net/reflection-calling-method-name/)

但是，如果 b 和 c 是私有的，则无论如何只能从该类中调用它们，并且如果您是唯一编写该类的人，那么我看不到问题所在。所以在我看来，这不是一个编码问题，而是一个政策问题。

我只是在方法标题/注释中记录意图。

[类似问题在这里 - 注意答案的评论](https://stackoverflow.com/questions/394850/how-i-can-get-calling-method-in-c)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-26T23:12:55.137

Not exactly but you could implement both within their own class. Mark b() as private.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-26T23:17:28.197

To gain the effect of only a() calling b(), either do as Andrew noted already, by putting a() and b() in a class and marking b() appropriately. If you're working inside of an assembly that you control totally, you could use `internal` instead of `private` if a() and b() will be in different classes, but in the same assembly. Then user code cannot call it (from outside of your assembly, that is, from their application program) and you can control via policy the writing of your assembly.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-26T23:24:41.910

You can also create something like this:

```
internal abstract class SecretFunctionWrapper
{
    private void MySecretFunction()
    {
        ...
    }

    protected void FunctionWhichCalls()
    {
        ...
        MySecretFunction();
    }
}

public MyRealClass : SecretFunctionWrapper
{
    ...
} 
```

This will work only for one function. You can also try nested private class like this:

```
public class A
{
    private static class Wrapped
    {
        private static void A()
        {
            secred code
        }

        public static void B()
        {
            A();
        }
    }

    public void UsingA()
    {
        Wrapped.B();
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-26T23:30:39.837

我不知道，但也许按合同编写代码可能会有所帮助，但这不是本机支持的

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-27T00:57:22.013

在这种情况下可能更容易使用#region

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-02-26T23:14:06.007

You could use the `internal` keyword and put both those functions inside the same class, while leaving other other functions in a different class: [http://msdn.microsoft.com/en-us/library/7c5ka91b.aspx](http://msdn.microsoft.com/en-us/library/7c5ka91b.aspx)

# iis - IIS 上的客户端证书 - 不确定我是否明白 - 请体验一下？

> ID：592890
> 
> 赞同：2
> 
> 时间：2009-02-26T23:14:39.000
> 
> 标签：iis, asp-classic, certificate, digital-certificate

寻找一些关于使用客户端证书来改进现有应用程序的访问控制的建议。

我们公司有一个现有的 Intranet 应用程序（经典的 ASP/IIS），我们将其授权给其他人。到目前为止，它托管在每个使用它的组织中，安全性包括“如果您能够访问 Intranet，您就能够访问应用程序”。

我现在正在寻找一种在外部托管此应用程序的方法，以便其他不想自己托管它的组织可以使用它（每个新客户端都有自己的安装）。

新组织中的所有用户都将拥有一个客户端证书，所以我想做的是在 IIS 中使用“需要客户端证书”的东西。它允许您说“如果 Organisation=BigClientX 则假装他们是本地用户”。

我更喜欢的是“如果 Organisation=BigClientX 则让他们访问 virtualdirectoryZ 中的资源，否则忽略它们”。

如果这是最好的方法，我会很乐意购买一个插件（也许是一个 ISAPI 过滤器？），它会为我做这件事。**欢迎任何建议/战争故事**。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-28T06:48:39.853

我做过类似的事情...

从您组织的域控制器内部生成证书。将它们导出为 PFX 格式以供分发，以及 CER 格式供您在 IIS 中导入。

为您的 DC 分发 PFX 格式导出和 CA 证书，以便您的客户机器将“信任”您的 CA。

现在在应用程序属性 IIS 中，转到目录安全选项卡，然后在“安全通信”下单击“编辑”。在那里，单击“接受客户端证书”，“启用客户端证书映射”，然后单击“编辑”。

在 1 对 1 选项卡下，单击“添加”并导入 CER 文件。输入您要将此证书映射到的帐户。

至于“让他们访问资源”，我建议通过他们映射的用户帐户来执行此操作 - 也就是说，您可以通过 NTFS 权限或通过识别安全性的代码提供基于该帐户的资源访问权限登录用户的上下文。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-03T21:24:48.300

您可能想要这样做。客户端证书实际上是用于第二个身份验证因素，但不是主要来源。换一种说法，您仍然需要为您的应用程序配置基本或表单身份验证。

公钥/私钥背后的技术坚如磐石。但是，您需要一个非常成熟的 IT 组织来处理证书生命周期管理。如果你没有这个，你会遇到无数的失败场景，因为证书已过期，没有复制到新计算机等。

在您的应用程序面向 Internet 的场景中（在您的“托管”场景中）尤其如此 - 您几乎无法控制向用户颁发证书。

# django - In a django site I want to let users create other users that are tied to their accounts

> ID：592892
> 
> 赞同：0
> 
> 时间：2009-02-26T23:14:47.860
> 
> 标签：django, django-models, django-admin

I want to let a logged-in and registered user create extra user accounts that he will be the admin of. These accounts will be special "subordinate" accounts that are tied to the user creating them. He should be able to add/modify/delete these accounts kind of like the theory of how a Google apps administrator manages the accounts for his company (you are a regular user, but also create/destroy other users.)

The subordinate accounts cannot create/modify/delete accounts (except change their own password and normal user behavior.) I'm using the django auth model for all of these accounts. What is a good way to access the auth methods to add/modify/delete accounts from my own custom built webpages without using any admin code?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-27T04:04:39.613

首先，您需要[扩展您的 User 模型](http://docs.djangoproject.com/en/dev/topics/auth/#storing-additional-information-about-users)。然后：添加一个表示用户类别的字段 - “下属”或“管理员”。添加一个通过外键引用“admin”用户的字段，以便您可以按用户的“admin”对用户进行分组。如果用户类别为“admin”，则创建检查用户类别并允许创建、编辑、删除“下属”用户帐户的视图。

# vb.net - 从 VB6 迁移到 .NET，TreeNode.FirstSibling 是否有等效功能？

> ID：592893
> 
> 赞同：5
> 
> 时间：2009-02-26T23:15:18.063
> 
> 标签：vb.net, vb6, treeview, vb6-migration

我正在迁移的桌面应用程序大量使用 TreeView 控件，以及对 的许多调用`TreeNode.FirstSibling`，例如

```
'UPGRADE_ISSUE: MSComctlLib.Node property tvTreeView.SelectedItem.FirstSibling was not upgraded.
If tvTreeView.SelectedNode.FirstSibling.Index = 1 Then
...
End If 
```

是否有等效的功能可以使用？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-26T23:18:46.183

有兄弟姐妹就必须有父母，所以你可以这样做

```
myTreeNode.Parent.FirstNode 
```

或者你可以做

```
myTreeNode.Parent.Nodes[0] 
```

**编辑：**对于最后一个兄弟姐妹：

```
myTreeNode.Parent.LastNode 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T23:18:01.253

我可能是错的，但不是“FirstChild”或FirstParent。或者，NextNode，它应该遍历兄弟姐妹。

# java - Java AWT - 使用 J2ME 和 J9 时的 BufferedImage 问题

> ID：592907
> 
> 赞同：0
> 
> 时间：2009-02-26T23:20:33.713
> 
> 标签：java, exception, awt

我正在尝试在 AWT 中使用 BufferedImage 类。我在 IBM 的 J9 虚拟机上使用 J2ME。

当我尝试调用 BufferedImge.getRastor() 方法时，出现以下异常：

```
Exception in thread "main" java.lang.NoSuchMethodError: java/awt/image/BufferedImage.getRastor()Ljava/awt/image/WritableRaster; 
```

现在，根据我对 JVM 的了解，该错误基本上告诉我 BufferedImage 类没有一个名为 getRastor() 的方法，它返回一个 WritableRaster 对象，但是该方法记录在 API 中，它来自版本 1.4.2 所以应该与 J2ME 兼容。

我不知道这里发生了什么，你能帮忙吗？

干杯，

皮特

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-26T23:43:23.610

我不认为这是你的答案......但既然你引用了你的例外，我假设你剪切并粘贴了它，我会尽力提供帮助。

是不是方法：

```
getRaster 
```

不是

```
getRastor 
```

?

*（对不起，如果这不是它让你感到困扰的......）*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T00:03:15.950

由于不受支持，您将无法在 J2ME 中使用 AWT 中的任何内容。

这是因为 J2ME 没有 AWT。AWT 旨在用于具有不同用户模型和功能的桌面应用程序 (Java SE)。

您可以在[此处查看 J2ME 文档](http://java.sun.com/javame/reference/apis.jsp)

J2ME 对 GUI 使用不同的方法，您可以使用高级抽象 API (FORMS) 和低级 API (CANVAS)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-05T23:31:57.030

接受的答案不正确（截至 2009 年 8 月 5 日）。您可以使用哪些 API 取决于您部署的配置和配置文件组合。但是，您*确实*需要参考 J2ME 文档以了解确切支持哪些 1.4 类和成员。

将 CDC 1.0 与 Personal Profile 1.1 一起使用，您将获得 Java SE 1.4 的精简版。Personal Profile 1.0 是 Java SE 1.3 的精简版。两者都有*相当*完整的 AWT 实现（但没有 Swing）。

我们实际上在手持/PDA 设备上使用 J9 的 CDC/PP 相当成功。

# svn - 权衡颠覆的设置因素

> ID：592909
> 
> 赞同：2
> 
> 时间：2009-02-26T23:21:29.030
> 
> 标签：svn, installation, repository

我有许多不同的项目，大约 5 个，还有一些不同的开发人员，大约 15 个，有些项目处于颠覆状态，有些则没有。所有的开发人员都在使用 TortoiseSVN 开发基于 Windows 的机器，项目的代码是经典的 asp 和 asp.net 的混搭。什么是最好的，在最响应、最有用和易于管理的方式中，让所有项目都处于颠覆之下，并为所有开发人员提供经过身份验证的访问权限，包括读写权限？

需要考虑的一些事情是通过 svnserve 或 apache 提供服务，这意味着存在速度问题、易于管理访问/用户和密码，以及需要打开额外的防火墙端口（如果 svnserve）

还要考虑的是在一个存储库中拥有多个项目与每个存储库一个项目的好处/坏处。修订差异不是什么大问题，但是如果多个项目位于一个存储库中，则获取日志的时间可能会过长，但是，这是否会被更轻松的用户管理所抵消？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-26T23:47:02.590

• 我建议为您的所有项目使用一个存储库。它使为您的开发人员设置访问权限变得更加容易。另外，您只需备份一个存储库。不仅如此，它还使您能够轻松地在项目之间复制文件（并维护这些文件的历史记录）。这可能不会经常发生，但是当它发生时它会很好。创建新项目就像“svn mkdir”一样简单。

使用单个存储库并不会真正损失太多。您仍然可以根据需要配置每个项目的访问权限。

您的 svn 目录结构可能如下所示：

```
projects/
    proj1/
        trunk/
        branches/
        tags/
    proj2/
        trunk/
        branches/
        tags/
    ... 
```

• 您的项目有多大？在 HTTPS 上使用 svn 效果很好，尤其是在您的网络连接速度很快的情况下。HTTPS 也是一个相当普遍的访问系统。除非您经常检查数百或数千个文件（或者除非您试图对具有数千个修订版的文件进行责备），否则速度差异对您来说可能不值得。在我们公司，我们使用 svnserve 并使用 kerberos 票证进行身份验证，但这很难设置。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T23:49:32.537

我会推荐

1.  **Apache**，而不是 svnserve——它足够快，对防火墙和代理友好，并且用户管理员在任何一种情况下都是相同的工作。我还发现能够使用浏览器浏览我的存储库非常有用。

2.  只有**一个存储库**，每个项目都有一个包含主干/分支/标签的文件夹。这比我一开始想的要灵活得多，而且在很多情况下你不需要trunk/branches/tags的子目录。管理单个存储库更容易，并且您拥有版本控制，因此您无需担心用户会搞乱其他人的项目或任何事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T23:39:03.653

如果你们都在相对较快的线路上，通过 Apache 2 和 SSL 运行 SVN 是一个不错的选择。没有防火墙麻烦，并且可以通过多种方法完成用户身份验证。

我在另一个大陆有一个托管的 SVN 帐户，因为 SSL 不是那么快但可以接受，因为它是我们正在谈论的源代码，没有太多的数据传输正在进行。如果你有更近的服务器，我相信性能会相当不错。

多个存储库：我会说配置问题比可能的性能问题更糟糕。通过只保留一个存储库，您可以最大限度地减少配置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T23:28:39.717

我能想到的只有两种安全方式：通过 SSH 隧道使用 svn，或者使用 svn 通过 Web 服务器通过启用 SSL 的 HTTP 拉/推。

我会将每个项目保存在自己的存储库中，使用每个项目的标准主干/分支/标签格式作为存储库布局。这是一个更简洁的布局，因为每个事物都有自己的容器，如果其中一个 Subversion 数据库损坏或卡住，它不会影响所有项目的所有工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-27T00:25:53.773

**多个项目与单个项目：**

如果代码很常见并且文件会移动，请使用一个存储库。如果代码是孤立的，请使用许多。请记住：

1.  单个存储库使文件移动和目录重命名变得容易和可控
2.  存储库中的更改会影响该存储库中所有位置的修订号
3.  开发者物理目录结构可以不同于svn结构

**验证**

使用 apache，如果将 apache 配置为始终进行身份验证，则不需要 SSL。

```
<Location /svn/test>
    DAV svn
    SVNPath /svn/test
    <LimitExcept GET PROPFIND OPTIONS REPORT>
       AuthType Basic
       AuthName "Authorization Realm"
       AuthUserFile /svn/passwd
       Require valid-user
    </LimitExcept>
</Location> 
```

您可以使用这些规则在结帐时要求输入密码。而您的密码位于该文件 /svn/passwd 中。

**和...**

也使用trac。它与 subversion 很好地集成，并为开发人员提供了一个远离 subversion 的界面来查看他们的文件/变更集等。

# python - 使用 selectorgadget.com 解析 HTML 文件

> ID：592910
> 
> 赞同：3
> 
> 时间：2009-02-26T23:21:39.280
> 
> 标签：python, css, screen-scraping, beautifulsoup, html-content-extraction

我如何使用漂亮的汤和[选择器](http://selectorgadget.com)小工具来抓取网站。例如，我有一个网站 - [（一个新蛋产品）](http://www.newegg.com/Product/Product.aspx?Item=N82E16819115017)，我希望我的脚本返回该产品的所有规格（点击规格），我的意思是 - 英特尔、台式机、......、2.4GHz , 1066Mhz, ...... , 3 年有限。

使用 selectorgadget 后，我​​得到了字符串- .desc

我该如何使用它？

谢谢 ：）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T23:40:38.830

检查页面，我可以看到规范放置在 ID 为 pcraSpecs 的 div 中：

```
<div id="pcraSpecs">
  <script type="text/javascript">...</script>
  <TABLE cellpadding="0" cellspacing="0" class="specification">
    <TR>
      <TD colspan="2" class="title">Model</TD>
    </TR>
    <TR>
      <TD class="name">Brand</TD>
      <TD class="desc"><script type="text/javascript">document.write(neg_specification_newline('Intel'));</script></TD>
    </TR>
    <TR>
      <TD class="name">Processors Type</TD>
      <TD class="desc"><script type="text/javascript">document.write(neg_specification_newline('Desktop'));</script></TD>    
    </TR>
    ...
  </TABLE>
</div> 
```

desc 是表格单元格的类。

您要做的是提取此表的内容。

`soup.find(id="pcraSpecs").findAll("td")`应该让你开始。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-27T02:58:36.230

您是否尝试过使用 Feedity - [http://feedity.com](http://feedity.com)从任何网页创建自定义 RSS 提要。

# wpf - WPF：列表框，使所选项目居中

> ID：592911
> 
> 赞同：4
> 
> 时间：2009-02-26T23:21:41.650
> 
> 标签：wpf, listbox, scroll, selecteditem

是否可以始终将所选项目保留在列表框的中间？如果用户选择了一个项目，我想滚动以使新选择的项目位于中间。

我想它希望“边缘案例”（第一个和最后几个项目）成为可能，但这没关系。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-21T08:22:27.367

David Anson 在他的博客上发布了一些可能对您有所帮助的文章：[第 1](http://blogs.msdn.com/delay/archive/2009/03/30/don-t-let-the-gotchas-getcha-adding-the-scrollintoviewcentered-method-to-wpf-s-listbox.aspx)部分和[第 2 部分](http://blogs.msdn.com/delay/archive/2009/04/19/fewer-gotchas-to-getcha-enhancing-the-scrollintoviewcentered-method-for-wpf-s-listbox.aspx)。他给出了一个扩展方法，可以将一个项目集中在一个列表框中。您也许可以在此基础上再接再厉。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-27T00:52:26.783

可以使用几行自定义代码。这是对[示例实现](http://blogs.jp.infragistics.com/blogs/ctaylor/archive/2008/06/17/carousel-listbox-selection.aspx)的讨论。您可能需要稍微调整一下以考虑偶数个项目，仅插入奇数个，但总体思路是相同的。

# html - 如何让元素具有不同的背景颜色但背景图像随处可见（又名水印）？

> ID：592922
> 
> 赞同：1
> 
> 时间：2009-02-26T23:25:16.260
> 
> 标签：html, css, watermark

我想创建一个带有水印的 html 页面。我在身体上设置了背景图像。但是，我有一些元素不允许背景图像渗出。他们定义了自己的背景颜色（但不是背景图像），覆盖了正文中的颜色。这让我很惊讶。他们没有覆盖图像，只是颜色。

在具有不同背景颜色的元素的页面上具有可见水印似乎是合理的。

如何使用标准 html/css 获得我想要的效果？

这是一些显示问题的示例代码。请注意遮挡我的水印图像的白色块。

```
<html>
<head>
<style type="text/css">

.everything
{ 
    background: url(/images/shield-25.png) blue no-repeat center;
}
table, div{ width: 100% }

#table2 { background-color: white }
#div2 { background-color: white }
</style>
</head>
<body class="everything">

  <table id="table1"><tr><td>Top</td></tr></table>
  <!-- This table put a big white line over my watermark image. -->
  <table id="table2"><tr><td>Middle</td></tr></table>
  <table id="table3"><tr><td>Bottom</td></tr></table>

  <div id="div1"><tr><td>Top</td></tr></div>
  <!-- Thought maybe it was a table thing but nope, divs do it too. -->
  <div id="div2"><tr><td>Middle</td></tr></div>
  <div id="div3"><tr><td>Bottom</td></tr></div>

</body>
</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-26T23:34:14.087

不幸的是，这是预期的行为。`background-image`并且`background-color`是属性的子`background`属性。由于您在`#table2`and上定义了背景`#div2`，因此您无法再“透过”它们看到页面背景。

CSS3 允许您使用`rgba()`表达式设置背景的不透明度，但 IE 不支持此功能（[Firefox 3 和 Safari/Webkit](http://css-tricks.com/examples/RGBaSupport/)支持）。要在 IE 中获得类似 rgba() 的效果，可以使用`filter:`如下规则：

```
#table2 {
    filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#ffffff80,endColorstr=#ffffff80); /* IE proprietary */
    background-color: rgba(255, 255, 255, 0.5); /* CSS3 standard */
} 
```

请注意`startColorstr`和`endColorstr`参数如何具有第四个 alpha 值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T23:33:15.930

如果没有一些巧妙的 HTML/CSS hack，就无法完成您想做的事情。如果您设置元素的背景颜色，则不会允许其下方的图像“渗透”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T23:44:36.463

您可以在此处查看设置 CSS 不透明度：[http ://www.quirksmode.org/css/opacity.html](http://www.quirksmode.org/css/opacity.html)

但是，我相信（未经测试）这也适用于元素内的任何文本，因此您可能需要第二个类将表内文本的不透明度设置回 1 等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T23:33:37.830

您正在为 body 元素设置背景图像。div 和 table 不透明，它们位于 body 元素的前面，这就是它们覆盖水印的原因。

如果您想将水印单独应用于每个元素，您应该执行以下操作：

```
#table1, #table2, #table3, #div1, #div2, #div3 { 
    background: url(/images/shield-25.png) blue no-repeat center;
} 
```

或许

```
table, div { 
    background: url(/images/shield-25.png) blue no-repeat center;
} 
```

# python - 为什么 Python 没有静态变量？

> ID：592931
> 
> 赞同：47
> 
> 时间：2009-02-26T23:28:09.013
> 
> 标签：python

有一个[问题询问如何在 python 中模拟静态变量](https://stackoverflow.com/questions/460586/simulating-a-local-static-variable-in-python)。

此外，在网上可以找到许多不同的解决方案来创建静态变量。（虽然我还没有看到我喜欢的。）

为什么 Python 不支持方法中的静态变量？这被认为是不符合 Python 的还是与 Python 的语法有关？

**编辑：**

我专门询问了设计决策的*原因*，但我没有提供任何代码示例，因为我想避免解释来模拟静态变量。

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-02-27T00:04:02.343

这个省略背后的想法是静态变量只在两种情况下有用：当你真的应该使用类时，以及当你真的应该使用生成器时。

如果你想将状态信息附加到一个函数，你需要的是一个类。也许是一个简单的类，但仍然是一个类：

```
def foo(bar):
    static my_bar # doesn't work

    if not my_bar:
        my_bar = bar

    do_stuff(my_bar)

foo(bar)
foo()

# -- becomes ->

class Foo(object):
    def __init__(self, bar):
        self.bar = bar

    def __call__(self):
        do_stuff(self.bar)

foo = Foo(bar)
foo()
foo() 
```

如果您希望函数的行为在每次调用时都发生变化，那么您需要一个生成器：

```
def foo(bar):
    static my_bar # doesn't work

    if not my_bar:
        my_bar = bar

    my_bar = my_bar * 3 % 5

    return my_bar

foo(bar)
foo()

# -- becomes ->

def foogen(bar):
    my_bar = bar

    while True:
        my_bar = my_bar * 3 % 5
        yield my_bar

foo = foogen(bar)
foo.next()
foo.next() 
```

当然，静态变量*对于*不希望为小任务处理大结构的麻烦的快速而肮脏的脚本很有用。但是在那里，你真的不需要任何东西`global`——它可能看起来很笨拙，但对于小的一次性脚本来说没关系：

```
def foo():
    global bar
    do_stuff(bar)

foo()
foo() 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-27T01:41:57.150

类的一种替代方法是函数属性：

```
def foo(arg):
    if not hasattr(foo, 'cache'):
        foo.cache = get_data_dict()
    return foo.cache[arg] 
```

虽然一个类可能更干净，但在我看来，这种技术很有用而且更好，然后是一个全局的。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-08T04:39:27.600

在 Python 3 中，我会使用闭包：

```
def makefoo():
    x = 0
    def foo():
        nonlocal x
        x += 1
        return x
    return foo

foo = makefoo()

print(foo())
print(foo()) 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-26T23:35:18.623

我认为局部静态变量的大多数用途是模拟生成器，也就是说，有一些函数执行过程的一些迭代，返回结果，但为后续调用保持状态。Python 使用该`yield`命令非常优雅地处理了这个问题，因此似乎不需要静态变量。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-26T23:37:37.213

这是一个设计选择。

我假设 Guido 认为你并不经常需要它们，而且你从来没有*真正*需要它们：你总是可以只使用一个全局变量并告诉每个人不要让他们油腻的爪子离开你的变量 ;-)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-27T00:54:15.313

出于缓存或[记忆](http://code.activestate.com/recipes/52201/)目的，装饰器可以用作优雅且通用的解决方案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-27T00:28:54.203

答案与为什么没有人使用静态方法（即使它们存在）几乎相同。您有一个模块级命名空间，其用途与类的用途大致相同。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-27T04:04:02.143

一个不明智的选择：

您还可以使用函数默认值的定义时间评估的副作用：

```
def func(initial=0, my_static=[])
  if not my_static:
    my_static.append(initial)

   my_static[0] += 1
  return my_static[0]

print func(0), func(0), func(0) 
```

它*真的*很丑，很容易被颠覆，但是很有效。使用`global`会比这更干净，imo。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-02-27T13:34:45.330

从您的一条评论中：“我想用它们来缓存从磁盘加载的东西。如果我可以将它们分配给函数，我认为它会减少实例的混乱”

然后使用缓存类作为其他类的类或实例属性。这样，您可以使用完整的类功能集，而不会弄乱其他东西。此外，您还可以获得一个可重复使用的工具。

这表明在 SO 上，陈述问题而不是要求特定的低级解决方案（例如，缺少语言功能）总是值得的。这样，而不是关于模拟“静态”（在我看来，古代语言中已弃用的功能）的无休止辩论，有人可以更快地为您的问题提供一个很好的答案。

# asp.net - 下载文件

> ID：592933
> 
> 赞同：0
> 
> 时间：2009-02-26T23:28:51.383
> 
> 标签：asp.net, file, download

我正在使用 asp.net/C#。我有一个指向远程服务器上的文件夹的 url。在该文件夹中是所有 .jpg 的图像。我不知道文件的名称，只是它们都是.jpgs。如何使用 asp.net/C# 将所有 .jpg 图像下载到本地硬盘驱动器上的文件夹中。

只是为了澄清。我正在从远程服务器中提取文件，并将它们保存到我的本地机器上。我得到了一个网址，并告诉我每晚我需要下载 .jpg 图像文件的文件。这就是我被告知的全部内容。我不知道如何仅通过文件夹的 url 获取远程服务器上的文件列表。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T23:40:13.557

如果它是一个 Web URL，则您必须依赖 Web 服务器为您提供某种文件列表。列表的*格式*几乎可以是任何形式。

这么说吧：使用浏览器或其他任何东西，作为人类，您将如何找出所有文件名？

只是为了澄清一下，您是否在具有文件的服务器上编写代码？如果是这样，您可以使用[`Directory.GetFiles`](http://msdn.microsoft.com/en-us/library/system.io.directory.getfiles.aspx). 你希望用户在本地做什么？

如果你能让你的问题更清楚一点，那真的很有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T23:41:45.177

这是一些可以使用的概念代码

```
DirectoryInfo di = new DirectoryInfo("M:\MappedDrive");
 FileInfo[] rgFiles = di.GetFiles("*.aspx");
 foreach(FileInfo fi in rgFiles)
 {
  Response.Write("<br><a href=" + fi.Name + ">" + fi.Name + "</a>");       
 } 
```

# c# - C# 是否（或将）包含用于副作用验证的功能？

> ID：592934
> 
> 赞同：71
> 
> 时间：2009-02-26T23:28:53.007
> 
> 标签：c#, .net, f#, parallel-processing, immutability

我知道 C# 得到了很多并行编程支持，但是 AFAIK 仍然没有用于副作用验证的构造，对吗？

我认为既然 C# 已经布局，那就更棘手了。但是有计划把它放进去吗？还是 F# 是唯一具有副作用验证构造的 .NET 语言？

* * *

## 回答 #1

> 赞同：173
> 
> 时间：2009-02-26T23:41:33.523

语言不是 C#，但框架可能是 .NET。

.NET 4 中引入的 Contracts 库 + 静态分析工具可能会引入这些：

微软现在在 .NET 3.5 框架中使用 [Immutable] 和 [Pure]。

例如，请参阅 System.Core.dll 中 .NET 3.5 中的 [Microsoft.Contracts.Immutable] 和 [Microsoft.Contracts.Pure]。不幸的是，它们是内部的。但是，Microsoft.Contracts.* 主要源于 Spec# 研究，并且 Spec# 已被合并到将成为 .NET 4.0 一部分的 Contracts API 中。

我们将看看这是什么结果。我尚未检查预发布的 .NET 4.0 位是否包含任何 API，例如 Contracts API 中的 [Pure] 或 [Immutable]。如果他们这样做，我想静态分析工具将是执行规则的工具，而不是编译器。

**编辑**我刚刚从本周[最新的 MS 代码合同预发布版本中](http://research.microsoft.com/en-us/projects/contracts/)加载了 Microsoft.Contracts.dll 。好消息：库中存在 [Pure] 和 [Mutability(Mutability.Immutable)] 属性，这表明它们将在 .NET 4.0 中。呜呼！

**编辑 2**现在 .NET 4 已经发布，我查找了这些类型。[[Pure]](https://msdn.microsoft.com/en-us/library/system.diagnostics.contracts.pureattribute%28v=vs.110%29.aspx)仍然存在于 System.Diagnostics.Contracts 命名空间中。它不适用于一般用途，而是与 Contract API 的前置条件和后置条件检查一起使用。它不是编译器强制执行[的，代码合同检查器工具也没有强制执行纯度](https://softwareengineering.stackexchange.com/a/246579)。[可变性] 消失了。有趣的是，微软在 .NET 3.5 中使用 Mutability 和 Pure 属性（在 System.Core.dll 的内部 BigInteger 类中），.NET 4 已将 BigInteger 移动到 System.Numerics 中，并剥离了 [Pure] 和 [Mutability]该类型的属性。**底线：.NET 4 似乎对副作用验证没有任何作用。**

**编辑 3**最近（2011 年末）预览的 Microsoft Rosyln 编译器即服务工具——据信计划在 Visual Studio 2015 中用于 RTM——看起来他们将能够支持这样的东西；你可以为编译器编写扩展来检查纯度和不变性，如果用这些属性装饰的东西不遵守规则，就会发出编译器警告。即便如此，我们正在寻找几年的时间来支持这一点。

**编辑 4**既然 Rosyln 于 2015 年夏天就在这里，那么为纯/不变性构建编译器扩展的能力确实存在。但是，这对现有的框架代码和第 3 方库代码都没有任何作用。但即将到来的是[针对不可变类型的 C# 7 提案](https://github.com/dotnet/roslyn/issues/159)。这将由编译器强制执行，并将在 C# 中引入一个新的**不可变**关键字，并在 .NET 框架中引入一个 [Immutable] 属性。用法：

```
// Edit #4: This is a proposed design for C# 7 immutable as of June 2015.
// Compiler will implicitly mark all fields as readonly.
// Compiler will enforce all fields must be immutable types.
public immutable class Person
{
    public Person(string firstName, string lastName, DateTimeOffset birthDay)
    {
        FirstName = firstName; // Properties can be assigned only in the constructor.
        LastName = lastName;
        BirthDay = birthDay; 
    }

    public string FirstName { get; } // String is [Immutable], so OK to have as a readonly property
    public string LastName { get; }
    public DateTime BirthDay { get; } // Date is [Immutable] too.
} 
```

**编辑 5**现在是 2016 年 11 月，似乎不可变类型已从 C# 7 中删除。C# 8 总是有希望的。:-)

**编辑 6**现在是 2017 年 11 月。C# 8 即将全面亮相，虽然我们不会有纯函数，但我们会有[只读的 structs](https://docs.microsoft.com/en-us/dotnet/csharp/reference-semantics-with-value-types)。这使得结构不可变，从而允许进行多种编译器优化。

**编辑 7**现在是 2020 年 7 月，C# 9 将支持[记录](https://devblogs.microsoft.com/dotnet/welcome-to-c-9-0/)，它们是完全不可变的类型。此外，记录将具有`With`用于从现有记录创建新记录以表示新状态的表达式。

**编辑 8**现在是 2021 年 11 月，C# 10 已发布，支持`With`结构和结构的表达式`record`。这些也有助于创建不可变类型。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-26T23:33:54.820

不仅没有任何副作用验证 - 甚至没有验证类型是不可变的，这是沿着 IMO 同一路线的一个较小的步骤。

我不相信在 C# 4.0 中会有任何事情发生（尽管我很容易出错）。我真的*希望*不变性对 C# 5.0 产生影响；当然，Eric Lippert 已经写了很多关于它的博客，MS 的人们一直在考虑并行性。

抱歉，这不是更令人鼓舞的画面。

编辑：[Judah 的回答](https://stackoverflow.com/questions/592934/pure-functions-in-c/592990#592990)要好得多……框架支持对您来说是否足够好？:)（如果代码合同的某些方面还没有为 .NET 4.0 做好准备，我不会完全感到惊讶 - 如果他们将初始版本保持在*相对*较小的范围内并在以后对其进行提升。）

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-02-28T14:52:04.447

原则上，验证某些东西是否不可变以及代码是否缺少副作用很容易。类/数据结构的所有字段必须是只读的，并且它们的类型必须是另一个不可变对象。我们还需要一种将委托标记为“纯”（无副作用）的方法，但这可能都是可能的。

然而，问题是这通常过于严格。在 F# 中，您通常会以无副作用且不可变的风格编写代码，但在本地使用一些突变通常是有益的。这不会破坏整体的纯度（在某种意义上），并使编写代码更容易。但是，自动验证这一点很困难（这意味着这是一个有趣的理论问题......）

例如，以“纯”方式处理数组是非常好的。您可以使用**Array.map 之**类的方法，将某些函数应用于所有元素并返回一个*新*数组，而无需修改原始数组。该函数会在返回（新创建的）数组之前对其进行变异，但该数组不会在其他任何地方发生变异，因此这原则上是*pure*，但很难验证（这在 F# 中是非常有用的编程模式）。

所以，我认为可以做很多事情，但简单地禁止所有副作用可能不像看起来那么好。合约的好处是它们也可能在这种情况下使用。

# java - 为什么我不能在导入的模块中使用我的 Jython 类？

> ID：592937
> 
> 赞同：1
> 
> 时间：2009-02-26T23:29:16.827
> 
> 标签：java, import, module, jython, pydev

我有几个 Jython 模块位于同一目录中。其中之一定义了以下类：

```
from java.lang import Runnable
class MyTask(Runnable):
    def __init__(self, params):
        Runnable.__init__(self)
        self._params = params

    def run(self):
        # do stuff
        print "Done doing stuff" 
```

我可以在它自己的模块中实例化和运行这个类。但是，当我将该模块导入另一个 Jython 模块并尝试实例化 MyTask() 时，我收到以下错误：

Runnable.__init__(self) AttributeError: 类 Runnable 没有属性 '__init__'

我在这里做错了什么？为什么此代码在定义我的类的模块中有效，但在我将该类导入另一个模块时无效？（我用“import modulename”而不是“from modulename import MyTask”来导入它）

**编辑**：对于那些认为问题在于 Runnable 是一个接口，因此没有构造函数的人：我知道这一点，但它并没有完全解释这种情况。问题的关键是我**可以**在定义它的模块中实例化这个类，但我**不能**将它导入另一个模块并在那里实例化它。IE，

在 mytask_module 中：

```
# this works
if __name__ == '__main__':
    task = MyTask() # works!
    thread = Thread(task) 
    thread.start() 
```

在 other_module 中：

```
# this throws AttributeError
if __name__ == '__main__':
    import mytask_module
    task = mytask_module.MyTask() # raises AttributeError
    thread = Thread(task) 
    thread.start() 
```

现在你看到混乱了吗？如果问题纯粹是您所描述的，那么前一个示例也应该引发 AttributeError，但事实并非如此。它运行得很好。

**编辑#2**：显然这在独立脚本中有效，但在我的 Eclipse/Pydev 环境中无效。所以真正的问题是为什么 Pydev 不让我这样做。如果这对他们自己的 Pydev/Eclipse 环境中的任何人都有效，请告诉我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T15:03:22.637

`__init__`是 jython(python) 类的构造函数

jython 中还没有“inferface”。“实现”通过继承来模拟。

如果基类是 java 中的接口，则不存在构造函数（no `__init__`），您会得到：

```
AttributeError：类 Runnable 没有属性“__init__”

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T23:33:30.873

Runnable 是一个接口......所以它没有构造函数。我猜对 __init__ 的调用是调用构造函数。

# iphone - 调试 UITextField 的技巧

> ID：592940
> 
> 赞同：2
> 
> 时间：2009-02-26T23:29:43.473
> 
> 标签：iphone, cocoa, cocoa-touch, uitextfield

我正在调试一些代码，发现很难查看和跟踪 iPhone 键盘输入到 UITextField 中的值（以及来自 UIDatePicker 的值。）

我希望 Arguments>self>textField>_text 反映输入到 textField 中的值，但事实并非如此。它显示的是不同的价值（例如，0.00 美元而不是 1.25 美元）。当我通过 NSLog(@"textField.text:%@", textField.text); 写出值时 它显示正确的 1.25 美元价值。是什么赋予了？

我想知道这是否可能与 UITextField 仍然是第一响应者这一事实有关，而我正在调试的这段代码位于在所述 UITextField 中输入数据后立即按下的“保存”按钮中？！？如果是这样，问题仍然存在，该数据存储在哪里以及如何调试它？在类似情况下使用 UIDatePicker 来修改 UITextField 的值时，我遇到了类似的问题。

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T00:13:39.840

您要问的本质上是；

> 如何在调试器中查看私有类数据并让它反映我的期望？

答案基本上是你不能。_text 字段可能会在以后更新，或者根本不使用。

如果您确实想要一种方法来调试 UITextField 中输入的内容，您可以考虑使用委托中的 textField:shouldChangeCharactersInRange 来打印输入的字符。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-28T18:25:52.953

调试器不理解点表示法 (textField.text)。但请记住，属性只是方法调用的简写——所以调用 [textfield text] 会做同样的事情。因此，如果您想在调试器中查看文本字段值，只需键入：

```
po [textField text] 
```

# oop - 确定构造函数、初始化和重置方法的任务的最佳实践是什么

> ID：592943
> 
> 赞同：2
> 
> 时间：2009-02-26T23:30:41.613
> 
> 标签：oop, constructor, initialization, reset

尽管我正在使用 Java 进行设计，但这是一个通用的 OOP 问题。我不是试图解决一个特定的问题，只是想通过一些设计原则。
根据我的经验，我已经养成了将对象设置分为三个阶段的习惯。

目标是尽量减少：额外的工作、混淆的代码和削弱的可扩展性。

**建造**

1.  创建有效对象所需的最少操作，通过存在测试
2.  仅“一次”实例化和初始化，永远不会被覆盖，非变量对象在对象的生命周期内不会改变/变化
3.  初始化最终成员
4.  本质上是一个运行时存根

**初始化**

1.  使对象有用
2.  实例化和初始化可公开访问的成员
3.  实例化和初始化作为变量值的私有成员
4.  对象现在应该通过外部测试而不会产生异常（假设代码是正确的）

**重置**

1.  不实例化任何东西
2.  为所有变量公共/私有成员分配默认值
3.  将对象返回到精确状态

玩具示例：

```
public class TestObject {
   private int priv_a;
   private final int priv_b;
   private static int priv_c;
   private static final int priv_d = 4;

   private Integer priv_aI;
   private final Integer priv_bI;
   private static Integer priv_cI;
   private static final Integer priv_dI = 4;  

   public int pub_a;
   public final int pub_b;
   public static int pub_c;
   public static final int pub_d = 4;

   public Integer pub_aI;
   public final Integer pub_bI;
   public static Integer pub_cI;
   public static final Integer pub_dI = 4;   

   TestObject(){
        priv_b = 2;
        priv_bI = new Integer(2);
        pub_b = 2;
        pub_bI = new Integer(2);
   }

   public void init() {
       priv_a = 1;
       priv_c = 3;
       priv_aI = new Integer(1);
       priv_cI = new Integer(3);

       pub_a = 1;
       pub_c = 3;
       pub_aI = new Integer(1);
       pub_cI = new Integer(3);
   }

   public void reset() {
       priv_a = 1;
       priv_c = 3;
       priv_aI = 1;
       priv_cI = 3;

       pub_a = 1;
       pub_c = 3;
       pub_aI = 1;
       pub_cI = 3;
   }  
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-29T11:01:13.843

我会以一种不需要“init”方法的方式设计我的类。我认为一个类的所有方法，尤其是公共方法，都应该保证对象在成功完成后始终处于“有效”状态，并且不需要调用其他方法。

构造函数也是如此。创建对象时，应将其视为已初始化并准备好使用（这就是构造函数的用途，并且有许多技巧可以实现此目的）。否则，您可以安全使用它的唯一方法是检查对象是否已在所有其他公共方法的开头进行了初始化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-05T17:02:51.337

我来自 C++ 背景，其中规则与 Java 有点不同，但我认为这些两阶段初始化原则适用于一般情况。

**建造**

1.  施工时能做的事，*就**应该*在施工时做。
2.  在调用`init()`.
3.  所有成员变量都需要一个值，即使它通常是无效的哨兵值（例如，将指针设置为空）。我认为默认情况下Java会将所有变量初始化为零，因此如果这是一个有效数字，您需要选择其他内容。

**初始化**

1.  初始化那些依赖于其他对象存在的成员变量。基本上，做你在施工时不能做的事情。
2.  确保您的对象现在处于完整的、可以使用的状态。如果不是，请考虑抛出异常。

**重置**

1.  当您想要调用这样的函数时，请仔细考虑系统将处于什么状态。从头开始创建一个新对象可能会更好，即使该操作看起来很昂贵。分析您的代码以了解这是否是一个问题。
2.  假设您通过了第 1 项，请考虑编写一个方法来处理`reset()`您和您的构造函数都需要做的事情。这简化了维护并避免了代码重复。
3.  将您的对象返回到它在之后的相同状态`init()`。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T23:57:57.057

不能说我曾经使用过这种确切的模式，但我使用过类似的东西来减少代码重复。例如，当您有一个对象可以通过构造函数创建或通过工厂方法从另一个对象（如 DTO）创建时。在这种情况下，我通常会有一个内部初始化程序来填充两者都使用的对象的属性。不能说我曾经使用过“重置”方法，如果它所做的只是复制创建新对象的过程，我也看不到真正需要这种方法。

最近，我转向只使用默认构造函数并使用属性设置器来初始化对象。新的 C# 语法允许以“类似构造函数”的格式轻松执行此操作，这使得它非常易于使用，我发现支持参数化构造函数的需求正在消失。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-31T13:57:12.663

是否有理由`init()`并且`reset()`需要有所不同？在这个简单的例子中很难看出为什么“不实例化任何东西”规则很重要。

除此之外，我认为对象一旦被构造出来就应该是有用的。如果有一个原因——一些循环依赖或继承问题——一个对象*必须*在构造后“初始化”，我会将构造函数和初始化隐藏在静态工厂方法后面。（并且可能将初始化代码移动到一个单独的配置器对象以进行良好的测量。）

否则，您指望调用者总是调用构造函数和`init()`，这是一种非标准模式。我们这里有一些旧的、太有用的、无法丢弃的代码可以做到这一点；这是一个抽象对话框类，发生的情况是，每次有人扩展它时，他们都会忘记调用`constructUI()`，然后他们浪费了 15 分钟想知道为什么他们的新对话框是空的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-25T16:03:55.553

有趣的。如果您有一个需要执行 IO 操作的对象，我特别发现这种构造很有用。我不希望任何东西在它们的构造函数中直接或间接地执行 IO 操作。它使该对象成为使用的噩梦。

# html - IE 和其他的不同输出

> ID：592946
> 
> 赞同：1
> 
> 时间：2009-02-26T23:31:30.207
> 
> 标签：html, css

由于某种原因，此类在 IE 中输出正常，但在 Firefox 中，单词和行（ | ）未居中：

```
.horz_list li {
    display: inline; 
    background-color: #CEE3F8;  
    border-right-style:thin; 
    padding-right: 4px; 
    padding-left: 4px;  
} 
```

这是输出的页面：

```
<div id="top_nav">
  <ul class="horz_list">
    <li><a href="<?php echo APP_DIR.'index.php?action=newest'; ?>">Nuevas</a></li>
    <li><a href="<?php echo APP_DIR.'index.php?action=comments&param=new'; ?>">Comentarios</a></li>
    <li class="last"><a href="<?php echo APP_DIR.'index.php?action=submit'; ?>">Enviar</a></li>
  </ul> <!-- ul.horz_list -->
</div> <!-- top_nav --> 
```

如果有人知道这是为什么，谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T23:36:41.380

尝试更改 li 的属性

```
.horz_list li{
    display: block; /* block level */
    float: left;  /* float them inline to the left */
    overflow: hidden; /* this will force the div to stretch to it's contained element */
    background-color: #CEE3F8;  
    border-right-style:thin; 
    padding-right: 4px; 
    padding-left: 4px;  
} 
```

...或者如果你想要[Ben 所描述](https://stackoverflow.com/questions/592946/different-output-for-ie-and-the-rest/593004#593004)的，整个块居中，使用

```
.horz_list {
   margin: 0 auto;

} 
```

确保它包含的块有一个宽度，即使它是 100%。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T23:44:49.223

如果您试图让列表项水平居中，则在 IE 与其他浏览器中的实现方式不同。尝试设置`margin-left:auto;margin-right;auto`您的`<ul>`：

```
.horz_list {
    margin-left: auto;
    margin-right: auto;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-26T23:45:11.000

Firefox 中额外间距的原因可能是，如果您将 LI 设置为 display:inline，则 HTML 代码中的换行符会创建一个额外的空间（就像您键入“lorem(newline)ipsum”时，单词可能会出现在页面中的一侧，它们之间有一个空格）。

例如，尝试将 <LI> 标签像这样 <li>....</li><li>.... 粘贴在一起，我认为这将删除不需要的空格。

如果您不喜欢将所有内容放在一行中，alex 的建议可行，但由于浮动元素，您可能必须在结束 UL 之后添加 <div style="clear:both"></div>。

# powershell - 如何在 PowerShell 之上构建应用程序？

> ID：592948
> 
> 赞同：6
> 
> 时间：2009-02-26T23:32:22.920
> 
> 标签：powershell

微软似乎在大力推动他们的服务器应用程序（即 SQL Server 2008、Exchange Server 等）都具有某种类型的 PowerShell 集成。这种逻辑是有意义的，因为人们可以选择从 GUI 或 CLI 管理应用程序。

因此，如果要跟随这一趋势并想要构建一个具有 PowerShell 接口的应用程序，甚至要如何开始？

社区里有没有人做过这种事情？如果是这样，什么似乎是最好的方法？

**更新**：

UI 需要有一定的外观/感觉。因此，PowerGUI 不适合这种情况。但是，我使用过 PowerGUI 并且同意它可以帮助弥合差距。

部分困惑实际上在于是否*需要***托管**PowerShell才能在其之上构建应用程序。根据我的发现，它不是（即 Cmdlet 的）。但是，我还没有看到有人在答案中真正讨论过这个问题。

 ** * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-26T23:47:19.827

从这里开始：[编写 Windows PowerShell 主机应用程序](http://msdn.microsoft.com/en-us/library/ee706563.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-26T23:44:06.650

Exchange 2007 管理控制台直接托管 PS，并通过显示无处不在的“这是你刚刚要求我做的 PowerShell”UI 模型来显示每个 UI 操作。SQL Server 2005 和 8 管理控制台演示了将 UI 中的所有内容显示为脚本的概念，以作为测试脚本能力的一种方式（但 SQL Server 中几乎没有 PowerShell 支持）（Exchange 和 SQL Server 的支持类型之间的区别是为了响应 Shaw 的评论，谢谢）

[PowerScripting 播客](http://Powerscripting.net)有一些关于此类主题的采访。还[获取脚本播客](http://get-scripting.blogspot.com/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-29T03:41:18.167

几年前，我参加了Microsoft 的[PowerShell / MMC 3.0 Devlab ，该实验室教授了如何做这件事。](http://blogs.msdn.com/powershell/archive/2007/03/05/windows-powershell-microsoft-management-console-mmc-isv-workshop.aspx)基本思想是通过 PSSnapin 中的一系列 PowerShell cmdlet 为您的应用程序创建“管理功能”。面向 CLI 的人员可以直接在您的 cmdlet 上加载 snapin 和派对。对于面向 GUI，您构建一个托管 PowerShell 运行空间的 MMC 管理单元，该运行空间响应 GUI 操作，执行适当的 PowerShell cmdlet 以调整正在管理的应用程序。对于奖励积分，您可以显示 MMC GUI 将执行哪些 PowerShell 代码，以便可以将代码复制并粘贴到脚本中。网上有很多例子[展示了如何托管 PowerShell 运行空间](http://msdn.microsoft.com/en-us/library/ms569311(VS.85).aspx)在您的（或 MMC）进程中并在该运行空间中执行 PowerShell 脚本并获取结果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-08-29T00:21:41.673

这是一个有趣的想法！

我从来没有想过它，我不知道我是否认为这是一个好主意，但可以做一些有创意的事情。

例如，假设您有一些典型的管理软件。真的不在乎什么，具体来说。在经典的应用程序开发场景中，我通常会尝试生成`Command`对象列表（实现某种 的东西`ICommand`），然后我的 UI 将绑定到这些对象。

现在假设您要为每个命令创建一个 cmdlet。UI 或多或少会作为 cmdlet 套件中核心逻辑的友好界面存在。

是的，好的，这里没有什么新鲜事。人们已经这样做了很长时间，围绕命令行工具构建 GUI。我认为关键的区别在于您将改为从应用程序本身的概念构建单独的命令行工具。哎呀，对于应用程序和 cmdlet 来说，引用一些共享的命令库而不是让 GUI 位于 cmdlet 本身之上可能更有意义。

Errr - 对漫不经心的反应感到抱歉。这个答案几乎完全是意识流。:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-28T22:27:21.703

您可以尝试使用原始表单从脚本构建完整的应用程序，或者您需要使用 snappin cmdlet 构建您的应用程序（前一个是 sql、exchange 等使用的），但在此处链接到 primail 表单

[http://www.primaltools.com/products/info.asp?p=PrimalForms](http://www.primaltools.com/products/info.asp?p=PrimalForms)

# c - C语言中的XML API？

> ID：592954
> 
> 赞同：4
> 
> 时间：2009-02-26T23:33:37.347
> 
> 标签：c, xml, api

它们都这么复杂吗？： http: [//msdn.microsoft.com/en-us/library/ms766497 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms766497(VS.85).aspx)

只需要一些基本的东西就可以在 C 中生成 XML。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-27T07:59:15.823

我喜欢[libxml](http://xmlsoft.org/)。这是一个使用示例：

```
#include <libxml/parser.h>

int
main(void)
{

  xmlNodePtr root, node;
  xmlDocPtr doc;
  xmlChar *xmlbuff;
  int buffersize;

  /* Create the document. */
  doc = xmlNewDoc(BAD_CAST "1.0");
  root = xmlNewNode(NULL, BAD_CAST "root");

  /* Create some nodes */
  node = xmlNewChild(root, NULL, BAD_CAST "node", NULL);
  node = xmlNewChild(node, NULL, BAD_CAST "inside", NULL);
  node = xmlNewChild(root, NULL, BAD_CAST "othernode", NULL);

  /* Put content in a node: note there are special characters so 
     encoding is necessary! */
  xmlNodeSetContent(node, 
                xmlEncodeSpecialChars(doc, BAD_CAST "text con&tent and <tag>"));

  xmlDocSetRootElement(doc, root);

  /* Dump the document to a buffer and print it for demonstration purposes. */
  xmlDocDumpFormatMemory(doc, &xmlbuff, &buffersize, 1);
  printf((char *) xmlbuff);

} 
```

使用 'gcc -Wall -I/usr/include/libxml2 -c create-xml.c && gcc -lxml2 -o create-xml create-xml.o' 编译，该程序将显示：

```
% ./create-xml   
<?xml version="1.0"?>
<root>
  <node>
    <inside/>
  </node>
  <othernode>text con&amp;tent and &lt;tag&gt;</othernode>
</root> 
```

对于一个真实的例子，请参阅[我](http://www.bortzmeyer.org/files/traceroute-nanog-xml.c)的[RFC 5388](http://www.ietf.org/rfcs/rfc5388.txt)实现。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-26T23:49:19.290

[众所周知， Xerces](http://xerces.apache.org/xerces-c/index.html)很容易，试一试

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-26T23:51:52.827

[MiniXML](http://www.minixml.org/)可能是您正在寻找的东西，如果您需要一些简单、容易和 C 的东西：

> [Mini-XML：轻量级 XML 库](http://www.minixml.org/)
> 
> Mini-XML 是一个小型 XML 库，您可以使用它在应用程序中读取和写入 XML 和类似 XML 的数据文件，而无需大型非标准库。Mini-XML 只需要一个 ANSI C 兼容的编译器（GCC 可以工作，就像大多数供应商的 ANSI C 编译器一样）和一个“make”程序。

但是，其中有很多[复杂](http://www.google.com/search?q=xml%20c%20library)性和需求不等。MiniXML 的优点在于它只需要一个简单的 Ansi C 编译器即可。其中很多都需要其他库或特定的编译器。

-亚当

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T00:16:01.257

在 C 中制作 XML 的最简单方法是 Tim Bray 提供的高质量和免费的 genx：[http ://www.tbray.org/ongoing/When/200x/2004/02/20/GenxStatus](http://www.tbray.org/ongoing/When/200x/2004/02/20/GenxStatus)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-27T02:41:49.970

*   [Gnome的 XML C 解析器](http://xmlsoft.org/ "libxml2")是用于 XML 的扩展 C API。
*   [XML 安全库](http://www.aleksey.com/xmlsec/ "xmlsec")是一个很好的基于 libxml2 的 C 库。

# java - “大师偏好”课程是个好主意吗？

> ID：592960
> 
> 赞同：8
> 
> 时间：2009-02-26T23:34:35.957
> 
> 标签：java, design-patterns

我有一个管理大型软件项目的用户偏好的课程。项目中可能需要从持久存储中设置或检索用户首选项的任何类都需要调用此类的静态方法。这种集中式管理允许以编程方式完全擦除首选项 - 如果每个首选项都在接近其使用代码的地方处理，并且散布在整个项目中，这将是不可能的。

在此过程中，我遇到了中心化设计的另一个含义。该软件有一个公共 API。该 API 可以在 jar 中自行提供。该 API 中的类可能引用 pref 管理类。因此，首选项管理器必须进入 API jar。

每个首选项可能有一个默认值。在软件启动时，可能会计算该默认值。该算法取决于偏好，因此倾向于驻留在使用代码附近。因此，如果首选项管理器需要提供默认值，它会调用相关类。

但是现在，pref manager 已经变成了一个“章鱼类”，将各种不应该存在的类吸入 API jar 中。如果没有，那么使用 API jar 的程序会很快遇到 ClassDef 异常。如果是这样，那么 API jar 现在就膨胀了，因为这些其他类中的每一个都可能引用其他类。

一般来说，其他 Java 程序员是否使用集中式类来管理他们的偏好？

将静态首选项管理类作为公共 API 的一部分分发是否有意义？

该首选项管理器是否应该负责确定默认值的代码？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-26T23:43:20.630

恕我直言，我认为您的第一个问题的答案是“是”和“否”。

首选项通常作为集中类处理，因为该类是项目中许多类的“接收器”。尝试更接近调用代码意味着如果相同的偏好稍后在其他地方有用，那么您就有麻烦了。以我的经验，试图将偏好设置“太接近”也会导致处理非常不一致。

话虽如此，通常最好使用多个偏好类或“偏好集”，每个偏好类或“偏好集”都支持一个模块或子模块。如果您查看架构的主要组件，您会经常发现这些首选项集可以在逻辑上进行分区。这减少了每个偏好类中的混乱。更重要的是，它将允许您将来将程序拆分为多个 jar。现在，“默认值”计算器可以放置在模块中，但仍位于足够全局的区域中。

我还建议不要将首选项直接设置为静态方法，而是使用类似 getInstance() 的操作来获取首选项管理的共享实例，然后对其进行操作。根据您的语义，您可能希望锁定该对象一段时间（例如，当用户在 UI 中编辑首选项时），如果您有一个实际对象，这会更容易。

对于您的其他问题，我会说您的公共 API 应该有一种让用户更改偏好的方法，但前提是您可以足够好地记录这些更改的结果可能是什么。

如果您使用单个 API 函数来获取“参考管理器”，则可以让用户有可能提供自己的“默认值计算器”。偏好管理器会先询问此计算器，然后再使用您默认提供的计算器。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-26T23:51:49.847

你不能以一种非常通用的方式处理偏好吗？然后，您只需使用首选项管理器来处理持久性。因此，从一个类中，您只需对首选项管理器 PreferenceManager.setPreference(key, value) 说，它并不关心它在数据语义方面保存了什么。

还是我过于简化了？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-27T00:07:51.370

我不是 Java 开发人员，但就整个“章鱼类”而言，您能否不仅为 jar 提供一个接口，并在运行时连接接口和 prefs 管理器之间的调用，使用应用程序配置文件来确定要实例化的首选项管理器？

类似于 .NET 提供程序模式？

这样您就可以将您的 jar 与首选项管理器分离。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T00:03:52.423

您可能想查看 Cocoa 的`NSUserDefaults`课程以获取灵感。它通过具有多层首选项（称为域）来处理您描述的问题。当您查找键的值时，例如“PrintUsingAllCaps”，它首先检查用户本地域中的值。如果在那里找不到，它可以检查系统范围的域，或者网络级的域，等等。

它检查的绝对最后一个地方称为“注册域”，这基本上是硬编码默认值应该去的地方。因此，在我的代码中的任何时候，我都可以将首选项写入注册域，并且`NSUserDefaults`只有在用户没有覆盖它的情况下才会提供该值。

因此，在您的情况下，您可以为类提供一种方法，以便在键访问（可能）用户定义的值之前为其设置默认值。首选项类不必知道它所服务的类的任何信息。

正如其他人建议的那样，如果您需要更复杂的东西，您可以设置`DefaultValueProvider`回调对象而不是直接值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T17:32:29.040

我删除了我的第一个答案，因为我误解了作者的要求。

要真正解决实际问题——感觉就像您希望将偏好（以及默认值的计算）与使用它们的代码一起放置是有道理的。

您能否通过为每个遵循该区域模式的区域使用首选项容器类来满足这两个要求，但让它注册到“全局”首选项对象集合？

您的全局集合可以执行诸如迭代每组首选项并将其重置为默认值之类的操作，但您的首选项本身仍将在本地定义和维护，因此它不会蔓延到代码的其他部分。

我能看到的唯一问题是，如果您允许首选项对象在实例化时自行注册，您将冒着尝试“重置为默认值”的风险，其中一些首选项尚未实例化。

我想这可以通过让主“首选项”类实例化所有其他类来解决，然后任何一段代码都可以通过静态吸气剂从中央部分检索它的本地首选项对象。

这似乎很像一些记录器的工作方式。有一个维护日志级别、输出流等的中央机制，但是每个类都有自己的“日志”方法实例并记录到它。

我希望这更符合目标。哦，我也同意接受的答案，永远不要将所有方法都公开为静态，始终使用吸气剂——有一天你会很高兴你做到了。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-05T15:52:20.557

JSR-10 ( `java.util.prefs.*`) API 使用带有`Class<?>`参数的工厂方法来创建`Preferences`实例。这样，API 可以将属于同一包的不同类的首选项存储在单个文件中。

# sql - 重置自增列

> ID：592966
> 
> 赞同：5
> 
> 时间：2009-02-26T23:36:13.410
> 
> 标签：sql, auto-increment

我最近将项目添加到 ID 并且表格在传输过程中搞砸了，所以我从表格中删除了项目。在重新输入数据而不是从 1 开始的 ID 后，它现在从 332 开始。我想让表格从 1 开始而不是 332。我已经从数据中删除了数据，所以很清楚。如何将 ID 重置为一个。感谢和抱歉，如果这个在某个地方我不知道如何搜索这个。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-26T23:39:25.477

在 SQL Server 中：

```
DBCC CHECKIDENT (myTable, RESEED, 0) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-26T23:38:49.957

`truncate table yourtable`--将重新播种

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-26T23:38:53.327

假设 MSSQL：

```
DBCC CHECKIDENT('MyTable', RESEED, 0) -- One less than next ID to allocate 
```

如果您也想删除数据，您可以使用

```
TRUNCATE TABLE MyTable 
```

但是您不能在由外键引用的表上使用 TRUNCATE TABLE，或者如果该表是索引视图的一部分，并且与 DELETE *MyTable*不同，表上的任何触发器都不会被激活。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T23:39:31.483

将起始标识值设置为 1

```
DBCC CHECKIDENT (tableName, RESEED, 1) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-26T23:39:34.213

如果您使用的是 MS Access，请删除并重新创建表

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-26T23:40:58.860

你需要截断表格

但是这样做它是空的，并且根本没有附加外键

# iphone - 为什么 sqlite 只插入一列？

> ID：592981
> 
> 赞同：1
> 
> 时间：2009-02-26T23:39:43.120
> 
> 标签：iphone, sqlite

我只得到插入数据库的第二个值。dataHold.Id 有一个值，aTextField 也是如此。但是，当我查看数据库时，没有插入 Id。下面的sqlite是否正确？

```
const char *sql = "insert into Userdata (Id, Name) Values(?, ?)";
    sqlite3_stmt *selectstmt;
    if(sqlite3_prepare_v2(database, sql, -1, &selectstmt, NULL) == SQLITE_OK) {
      sqlite3_bind_int(selectstmt, dataHold.Id, 1);
      sqlite3_bind_text(selectstmt, 2, [aTextField.text UTF8String], -1, SQLITE_TRANSIENT);
      sqlite3_step(selectstmt); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-26T23:42:40.227

如果这

```
sqlite3_bind_int(selectstmt, dataHold.Id, 1); 
```

是

```
sqlite3_bind_int(selectstmt, 1, dataHold.Id); 
```

?

# sql - 如何在单个 GROUP BY DAY(date_field) SQL 查询中包含空行？

> ID：592983
> 
> 赞同：6
> 
> 时间：2009-02-26T23:39:53.790
> 
> 标签：sql, sql-server, date, group-by

我正在使用 MS SQL Server，但欢迎来自其他数据库的比较解决方案。

这是我查询的基本形式。它从“incidentsm1”表中返回每天的呼叫次数：

```
SELECT 
  COUNT(*) AS "Calls",
  MAX(open_time),
  open_day
FROM 
  (
SELECT
 incident_id,
 opened_by,
 open_time - (9.0/24) AS open_time,
 DATEPART(dd, (open_time-(9.0/24))) AS open_day
   FROM incidentsm1 
   WHERE 
 DATEDIFF(DAY, open_time-(9.0/24), GETDATE())< 7

  ) inc1
GROUP BY open_day 
```

此数据用于绘制条形图，但如果一周中的某一天没有调用，则没有结果行，因此没有条形图，用户会说，“为什么图表只有六天？从周六跳到周一？”

不知何故，我需要每天用一个空白行或类似的东西来 UNION ALL，但我想不通。

我受限于我可以使用一条 SQL 语句执行的操作，并且我具有只读访问权限，因此我无法创建临时表或任何东西。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-27T03:28:27.500

这样的事情怎么样？

```
SELECT 
  COUNT(incident_id) AS "Calls",
  MAX(open_time),
  days.open_day
FROM
(
  select datepart(dd,dateadd(day,-6,getdate())) as open_day union
  select datepart(dd,dateadd(day,-5,getdate())) as open_day union
  select datepart(dd,dateadd(day,-4,getdate())) as open_day union
  select datepart(dd,dateadd(day,-3,getdate())) as open_day union
  select datepart(dd,dateadd(day,-2,getdate())) as open_day union
  select datepart(dd,dateadd(day,-1,getdate())) as open_day union
  select datepart(dd,dateadd(day, 0,getdate())) as open_day 
) days
left join 
(
 SELECT
   incident_id,
   opened_by,
   open_time - (9.0/24) AS open_time,
   DATEPART(dd, (open_time-(9.0/24))) AS open_day
 FROM incidentsm1 
 WHERE DATEDIFF(DAY, open_time-(9.0/24), GETDATE()) < 7
) inc1 ON days.open_day = incidents.open_day
GROUP BY days.open_day 
```

我只在简化的表模式上对其进行了测试，但我认为它应该可以工作。您可能需要修补 dateadd 的东西..

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T23:44:31.970

您可以创建一个包含您需要的日期的表变量，然后添加`RIGHT JOIN`到它上面吗？例如，

```
DECLARE @dateTable TABLE ([date] SMALLDATETIME)

INSERT INTO @dateTable
VALUES('26 FEB 2009')
INSERT INTO @dateTable
VALUES('27 FEB 2009')
-- etc

SELECT 
  COUNT(*) AS "Calls",
  MAX(open_time),
  open_day
FROM 
  (
SELECT
 incident_id,
 opened_by,
 open_time - (9.0/24) AS open_time,
 DATEPART(dd, (open_time-(9.0/24))) AS open_day
   FROM incidentsm1
   RIGHT JOIN @dateTable dates
   ON incidentsm1.open_day = dates.date
   WHERE 
 DATEDIFF(DAY, open_time-(9.0/24), GETDATE())< 7

  ) inc1
GROUP BY open_day 
```

然而，更理想的情况是有一个带有日期的表格对象

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-26T23:48:43.317

我建议使用[日期表](http://www.sqlservercentral.com/articles/Date+Manipulation/65195/)。使用现有的日期表，您可以对日期表执行 RIGHT OUTER JOIN 以输入您丢失的日期。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-27T01:36:09.830

您可以创建日期集作为查询的一部分吗？类似于以下内容：

```
SELECT COUNT(*) AS Calls, ...
    FROM incidentsm1 RIGHT OUTER JOIN
         (SELECT date_values
            FROM TABLE(('27 Feb 2009'), ('28 Feb 2009'), ('1 Mar 2009'),
                       ('2 Mar 2009'), ('3 Mar 2009'), ('4 Mar 2009'),
                       ('5 Mar 2009')) AS date_list
         )
         ON ... 
```

这是受到 Informix 和 DB2 表示法的一种混合的启发，并且几乎可以保证两者在语法上都是不正确的。基本上，您的 DBMS 中有没有一种方法可以即时创建文字表。一种可能性 - 丑陋但几乎不可行 - 将执行从“双重”或某些表表达式中选择的日期文字的 7 路 UNION，以保证一行（在 Informix 术语中，`SELECT MDY(2,28,2009) FROM "informix".systables WHERE tabid = 1 UNION ...`）。**************