# StackOverflow 问答 000463000-000463999

# sms - SMS 应用程序在美国是否需要短代码？

> ID：463007
> 
> 赞同：2
> 
> 时间：2009-01-20T20:40:14.920
> 
> 标签：sms

简单的问题：我正在研究美国的 SMS 网关 我们以前在欧洲实施过，但我无法确定在美国订阅自动出站 SMS 流量是否需要租用“短代码”，或者这只是变化由 SMS 网关提供商提供。我的预感是它是必需的，虽然价格昂贵，但我需要先确认，然后才能将其呈现给我的经理。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T22:10:57.153

它因运营商而异。一些运营商允许您将电子邮件网关用于生产级应用程序；有些不会。

更重要的是，与电子邮件网关相比，实际使用短代码和本机 SMS 后，您的头痛将大大减少，后者往往具有相当不同的延迟、可用性和功能行为。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T20:48:09.193

我之前曾在一家从事 SMS 工作的公司工作，我认为需要一个短代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T22:21:31.797

如果我正确理解您的问题，美国的大多数 SMS 网关提供商不需要用于出站 SMS 的特殊短代码。我现在在没有自己的简码的情况下在应用程序中使用 SMS。

他们确实需要它来**接收入站**短信。还有其他选择，因为您可以使用[Textmarks 之](http://www.textmarks.com)类的服务。

# ssis - 用于导入多个表的 SSIS 模板

> ID：463014
> 
> 赞同：2
> 
> 时间：2009-01-20T20:42:25.383
> 
> 标签：ssis

作为一个 SSIS 新手，我试图找出传输多个表的最佳方法。我正在尝试将多个表从一个数据库导入到另一个。我可以为每个表编写多个并行数据流，但是，我想聪明一点。

对于每个表，如果我要概括，

1.  我需要将行从一个表传输到另一个数据库中的表
2.  我需要计算传输的行数
3.  必须记录每个表的数据传输的开始和结束时间
4.  记录任何错误

我试图不使用存储过程，因为我希望人们不必深入研究数据库来获取这种转换的规则。理想情况下，我希望使用可以直观地看到和理解的组件在 SSIS 级别完成此操作。

人们以前使用过的任何最佳实践吗？

理想情况下，我想做类似的事情

foreach（要传输的表列表中的表） transfer（表名）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-20T20:51:16.347

要制作通用表处理程序，您必须以编程方式构造数据流。AFAIK SSIS 没有自动内省工具。脚本任务将允许您执行此操作，并且您可以从源中获取表元数据。但是，您必须以编程方式构建数据流，这意味着要摆弄 API。

尽管我没有开发该组件，但我已经在完成此操作的产品上工作过，因此我无法就如何做到这一点提供智慧的话。但是，您可以[在网络上](http://www.codeplex.com/SQLSrvIntegrationSrv/)找到解释如何操作的资源。

[您可以通过查询系统数据字典](http://msdn.microsoft.com/en-us/library/ms345522.aspx)找到表结构和列类型。 请参阅[此贴文](https://stackoverflow.com/questions/454986/is-there-a-quick-way-to-report-database-metadata-in-sql-server-2005#454995)以获取一些描述如何实现的资源链接，包括指向[代码示例的链接。](https://stackoverflow.com/questions/181909/tool-for-scripting-table-data#181942)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T21:03:36.307

您的目标数据库如何处理这些信息？它只是阅读它吗？也许最好通过复制表来为您服务。

您可以创建一个配置表，其中包含要移动的表的列表，然后使用 for 循环重复执行某些操作....但是该怎么做。

[http://blogs.conchango.com/jamiethomson/archive/2005/02/28/SSIS_3A00_-Dynamic-modification-of-SSIS-packages.aspx](http://blogs.conchango.com/jamiethomson/archive/2005/02/28/SSIS_3A00_-Dynamic-modification-of-SSIS-packages.aspx)

在要点下方，他指出不能修改 SSIS 以在运行时更改元数据。并使其易于维护......你走错了方向。

我会保持简单并使用向导，然后使用日志记录/通知等进行自定义。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-02-12T23:41:52.893

也许您可以在 ssis 脚本中调用存储过程。这是一个示例，说明如何使用 sp [http://blog.sqlauthority.com/2012/10/31/sql-server-copy-data-from-one-table-to-another-table- sql-in-60-seconds-031-video/](http://blog.sqlauthority.com/2012/10/31/sql-server-copy-data-from-one-table-to-another-table-sql-in-sixty-seconds-031-video/)

# html - 为什么将子元素设置为“width:80%”时会缩小？

> ID：463018
> 
> 赞同：1
> 
> 时间：2009-01-20T20:43:58.267
> 
> 标签：html, css, html-table

*我有一个表格，当我将嵌套元素的样式设置为width:80%*时，其中一个左列会缩小。该列缩小并截断输入元素的右边缘。您可以通过从输入元素中删除样式来了解我在说什么。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
</head>
<body>
    <table width="100%" border="1">
        <tr>
            <td>
                <input type="text" style="width: 80%;" />
            </td>
            <td>
                Lots of text to make the right cell expand.
                Lots of text to make the right cell expand.
                Lots of text to make the right cell expand.
                Lots of text to make the right cell expand.
                Lots of text to make the right cell expand.
                Lots of text to make the right cell expand.
                Lots of text to make the right cell expand.
                Lots of text to make the right cell expand.
                Lots of text to make the right cell expand.
            </td>
        </tr>
    </table>
</body>
</html> 
```

我有一种感觉，这是因为列的大小是基于子级的，但是通过根据父级调整元素的大小，我创建了一个“catch 22”。

有人可以告诉我发生了什么，以及我如何保持相同的列宽，并将我的元素调整到其宽度的 80%？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-20T20:48:40.910

您遇到的问题是因为您将`<input>`' 的宽度设置为没有宽度的单元格的百分比。因此，单元格变得更小以弥补另一个单元格上的文本，一旦完成，输入将获得剩余内容的 80%。

您的选择：
1) 设置`<input>`字段的宽度（以像素为单位）。
2) 以像素/百分比为单位设置宽度`<td>`。

**解决您的评论：**当您删除样式时，它变大的原因是因为它会回到浏览器的默认`<input>`元素大小，该大小大于单元格中剩余内容的 80%。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T20:49:15.977

你可以给第一列一个明确的宽度：

```
<table width="100%" border="1">
    <tr>
            <td width="20%">
                    <input type="text" style="width: 80%;" />
            </td> 
```

# c# - 实体框架 - 处理分离的实体问题

> ID：463019
> 
> 赞同：7
> 
> 时间：2009-01-20T20:44:04.117
> 
> 标签：c#, entity-framework

好的，所以在这个例子中，我有一个名为 Template 的父实体。模板总是有一个类型。该类型是很可能已经存在的 FK。创建新模板并向其添加类型时出现问题。添加类型并添加模板后，您会收到错误消息。您收到的错误取决于方法。有谁知道如何处理这种情况？

```
public static void AddTemplate(Template template)
    {
        using (TheEntities context = new TheEntities())
        {
            //if (template.TemplateType.EntityKey != null)
            //{
            //    context.Attach(template.TemplateType);
            //}

            context.AddToTemplates(template);
            context.SaveChanges();

            context.RemoveTracking(template);
        }
    } 
```

我已经尝试过尝试附加现有密钥而不是。底部对 RemoveTracking 的调用只是对模板和任何可能已加载的子实体调用分离的扩展。

这是单元测试。

```
[TestMethod]
    public void CanAddAndDeleteATemplate()
    {
        Template template = new Template();
        template.Name = "Test";
        template.Description = "Test";

        TemplateType type = TemplateManager.FindTemplateTypeByName("Round");

        if (type == null)
        {
            type = new TemplateType();
            type.Name = "Round";
        }

        template.TemplateType = type;

        TemplateManager.AddTemplate(template);

        template = TemplateManager.FindTemplateByID(template.TemplateID);

        Assert.IsNotNull(template);

        TemplateManager.DeleteTemplate(template);

        template = TemplateManager.FindTemplateByID(template.TemplateID);

        Assert.IsNull(template);
    } 
```

假设尚不存在“圆形”模板类型，则单元测试可以完美运行。我开始怀疑这种东西在独立的环境中是否可行。

更新

好的，我将 AddTemplate 的代码更改为此，现在它可以工作了..

```
public static void AddTemplate(Template template)
    {
        using (TheEntities context = new TheEntities())
        {
            if (template.TemplateType.EntityKey != null)
            {
                TemplateType type = template.TemplateType;
                template.TemplateType = null;
                context.AttachTo("TemplateTypes", type);
                template.TemplateType = type;
            }

            context.AddToTemplates(template);
            context.SaveChanges();

            context.RemoveTracking(template);
        }
    } 
```

因此，对于由客户端添加到新父级的所有现有子实体，当它们准备好被持久化时，必须对它们进行此类工作。有没有更清洁的方法来做到这一点？也许更通用的东西？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-21T18:21:20.253

将代码更改为此允许对象状态管理器跟踪更改并允许添加模板。

```
public static void AddTemplate(Template template)
    {
        using (TheEntities context = new TheEntities())
        {
            if (template.TemplateType.EntityKey != null)
            {
                TemplateType type = template.TemplateType;
                template.TemplateType = null;
                context.AttachTo("TemplateTypes", type);
                template.TemplateType = type;
            }

            context.AddToTemplates(template);
            context.SaveChanges();

            context.RemoveTracking(template);
        }
    } 
```

# c++ - 如何获取和设置编辑框的“只读”属性？

> ID：463020
> 
> 赞同：8
> 
> 时间：2009-01-20T20:44:06.423
> 
> 标签：c++, visual-c++, mfc, visual-c++-6

如何获取和设置编辑框的“只读”属性？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-20T21:10:10.617

CEdit 类有一个可以在运行时调用的 SetReadOnly 方法。MSDN 上的详细信息：http: [//msdn.microsoft.com/en-gb/library/aa279328 (VS.60).aspx](http://msdn.microsoft.com/en-gb/library/aa279328(VS.60).aspx)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-25T12:49:27.877

```
GetDlgItem(blah)->SendMessage(EM_SETREADONLY ,1 ,0); 
```

这会将其设置为只读。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T20:59:33.943

从设计窗口：右击编辑框，选择属性。它是样式选项卡上的最后一个选项。

# c# - 在 try/finally 外部或内部初始化一次性资源

> ID：463029
> 
> 赞同：5
> 
> 时间：2009-01-20T20:47:00.990
> 
> 标签：c#, java, coding-style, resources

我见过两种获取和处置资源的方式。任何一个：

```
Resource resource = getResource();
try { /* do something with resource */ }
finally { resource.close(); } 
```

或者：

```
Resource resource = null;
try { resource = getResource(); /* do something with resource */ }
finally { if (resource != null) resource.close(); } 
```

我想知道哪种风格更可取。第一个避免了这种`if`情况，而第二个（我想）在分配之后但进入`try`块之前处理线程中止的情况。这些风格彼此之间还有哪些其他优点和缺点？我应该优先使用哪一个？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-20T20:58:38.563

在 C# 中，只需使用 using 语句：

```
using (Resource resource = GetResource())
{
    /* Do something */
} 
```

这是清理资源的惯用方式，并且依赖于实现`IDisposable`接口的相关资源。（Java 现在有一个类似的 try-with-resources 语句，用于资源实现`AutoCloseable`。）

在分配和进入 try 块之间，Java 中不会发生线程中止的风险——中止仅在睡眠和等待期间发生。编辑：我实际上在规范中找不到这个，这有点令人担忧。唔。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-20T20:59:51.417

第一个更可取

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-20T20:57:53.683

如果*getResource()*抛出异常，则*资源*将为 null，*getResource()*在异常情况下不返回任何内容。因此，只要*getResource()*可以抛出异常，请始终在调用*resource.close()*之前检查 null 。我觉得组织这段代码的最好方法是将所有内容都放在 try 块中；明确*getResource()*抛出异常。

# installation - 在添加/删除程序中隐藏卸载程序？

> ID：463030
> 
> 赞同：5
> 
> 时间：2009-01-20T20:47:09.727
> 
> 标签：installation, windows-installer, uninstallation

我正在使用 Visual Studio 2005 创建 Windows 安装程序项目。

是否有一个选项可以使我的项目在添加/删除程序中没有卸载选项？

我的一位客户要求我这样做。**原因**如下：因为安装程序是现有程序的补丁程序。卸载后，程序不再工作，因为补丁文件被卸载。与其想办法恢复被替换的文件（我们无法用这个安装程序做到这一点），我们想知道是否可以禁用卸载。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-20T23:37:24.967

您只需要使用[Orca](http://www.microsoft.com/DownLoads/details.aspx?familyid=6A35AC14-2626-4846-BB51-DDCE49D6FFB6&displaylang=en)在安装程序的属性表中设置 ARPSYSTEMCOMPONENT=1 （据我所知，不能直接在 Visual Studio 中完成）

这通常在程序安装依赖项并且您不希望用户手动卸载依赖项时使用，他们需要使用您提供的特定卸载脚本或其他东西。

就个人而言，我会将补丁编写为补丁并防止补丁被卸载。

此外，我建议您阅读一份[The Definitive Guide to Windows Installer](https://rads.stackoverflow.com/amzn/click/com/1590592972)的副本，它将为您提供一些关于如何、为什么以及在何处使用此类技巧的解释。以及让您对 Windows 安装程序基础知识有一个非常好的理解，并帮助您从长远来看设计一个更好的安装程序。[本书中的所有示例都使用 Visual Studio + Windows Installer SDK 中](http://www.microsoft.com/DownLoads/details.aspx?familyid=6A35AC14-2626-4846-BB51-DDCE49D6FFB6&displaylang=en)的免费工具。

**编辑：**用户仍然可以完全控制通过 MSIEXEC 卸载，通过您提供的自定义卸载快捷方式，所有这些都是隐藏添加/删除程序 (ARP) 中的条目

**Edit2：**示例 VBS 添加属性（如果您想作为自动构建过程的一部分这样做）

```
Dim installer, database, view

Set installer = CreateObject("WindowsInstaller.Installer")
Set database = installer.OpenDatabase ("test.msi", 1)

Set view = database.OpenView ("INSERT INTO Property(Property.Property, Property.Value) VALUES('ARPSYSTEMCOMPONENT', '1')")
view.Execute

Set database = Nothing
Set installer = Nothing 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-20T21:00:37.827

可能有，但老实说，这是一个可怕的、可怕的想法。告诉用户他们可以使用机器做什么和不能做什么不是您的电话。

如果用户不应该有这样做的能力，那么这通常由管理员决定，并且用户无权根据他们的帐户类型卸载任何东西，这又不是你应该影响的事情在。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-20T21:03:39.100

你不知道他的“用户”是谁。这可能根本不适用于最终用户软件。我们编写了很多安装在 NOC 中的定制软件；它不会将任何卸载信息放入添加/删除中。（我们使用的是 Nullsoft 的 NSIS，而不是 Visual Studio 安装程序，顺便说一句......）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-11T20:07:57.973

说“这总是一个可怕的想法”之类的话太愚蠢了。在现代软件中有很多情况下，卸载依赖项可以真正彻底地f---手头的机器。

开源软件的理想只对那些想要破坏他们的机器的人有用。

# python - “Python 中的文本处理”中的 Schwartzian 排序示例

> ID：463032
> 
> 赞同：1
> 
> 时间：2009-01-20T20:47:26.700
> 
> 标签：python

我正在浏览“Python 中的文本处理”并尝试了有关 Schwartzian 排序的[示例。](http://gnosis.cx/TPiP/038.code)

我对同样包含空行的示例数据使用了以下结构。我按第五列对这些数据进行了排序：
383230 -49 -78 1 **100034** '06 text' 9562 'text' 720 'text' 867
335067 -152 -18 3 **100030** 'text' 2400 'text' 2342 'text' 696
136592 21 230 3 **100035** '03\. 文本' 10368 '文本' 1838 '文本' 977

用于 Schwartzian 排序的代码：

```
for n in range(len(lines)):       # Create the transform
    lst = string.split(lines[n])
    if len(lst) >= 4:             # Tuple w/ sort info first
        lines[n] = (lst[4], lines[n])
    else:                         # Short lines to end
        lines[n] = (['\377'], lines[n])

lines.sort()    # Native sort

for n in range(len(lines)):       # Restore original lines
    lines[n] = lines[n][1]

open('tmp.schwartzian','w').writelines(lines) 
```

我不明白作者如何使用此代码将短行或空行放在文件末尾。行在 if-else 结构之后排序，从而将空行提升到文件顶部。短线当然可以使用示例中实现的自定义排序（fourth_word 函数）。

这现在困扰着我，所以有什么想法吗？如果我对此是正确的，那么您将如何确保短行实际上保留在文件末尾？

**编辑：**我注意到 '\377' 周围的方括号。这搞砸了 sort() 所以我删除了那些括号并​​输出开始工作。

```
else:                         # Short lines to end
    lines[n] = (['\377'], lines[n])
print type(lines[n][0])
>>> (type 'list') 
```

我接受了 nosklo 的回答，以很好地澄清 '\377' 的含义以及他改进的算法。也非常感谢其他答案！

如果好奇的话，我使用了 2 MB 的样本文件，使用自定义排序需要 0.95 秒，使用 Schwartzian 排序需要 0.09 秒，同时创建相同的输出文件。有用！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T10:53:14.637

`key`与问题没有直接关系，但请注意，在最近的 python 版本中（我认为是 2.3 或 2.4 版本），可以使用to 的参数自动执行 transform 和`sort()`untransform `sorted()`。例如：

```
def key_func(line):
    lst = string.split(line)
    if len(lst) >= 4:             
        return lst[4]
    else:                        
        return '\377'

lines.sort(key=key_func) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T20:58:59.220

我不知道问题是什么，所以我将尝试以一般方式澄清事情。

该算法通过获取第 4 个字段并将其放在行的前面来对行进行排序。然后内置`sort()`将使用该字段进行排序。后来恢复了原来的线路。

空行或少于 5 个字段的行`else`属于此结构的一部分：

```
if len(lst) >= 4:             # Tuple w/ sort info first
    lines[n] = (lst[4], lines[n])
else:                         # Short lines to end
    lines[n] = (['\377'], lines[n]) 
```

它将 a 添加`['\377']`到要排序的列表的第一个字段中。该算法这样做是希望 '\377'（ascii 表中的最后一个字符）将*大于*在第 5 个字段中找到的任何字符串。因此，在进行排序时，原始行应该放在底部。

我希望能澄清这个问题。如果没有，也许您应该明确指出您想知道什么。

相同算法的更好的通用版本：

```
sort_by_field(list_of_str, field_number, separator=' ', defaultvalue='\xFF')
    # decorates each value:
    for i, line in enumerate(list_of_str)):
        fields = line.split(separator)
        try:
             # places original line as second item:
            list_of_str[i] = (fields[field_number], line)
        except IndexError:
            list_of_str[i] = (defaultvalue, line)
    list_of_str.sort() # sorts list, in place
    # undecorates values:
    for i, group in enumerate(list_of_str))
        list_of_str[i] = group[1] # the second item is original line 
```

您提供的算法与此算法等效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T20:59:29.530

空行不会通过测试

```
if len(lst) >= 4: 
```

因此它将 ['\377'] 作为其排序键，而不是数据的第 5 列，即`lst[4]`(`lst[0]`是第一列)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T21:07:02.290

*好吧，它几乎*会在最后对短线进行排序，但并非总是如此。

实际上，“幼稚”和 schwartzian 版本都存在缺陷（以不同的方式）。Nosklo 和 wbg 已经解释了算法，如果您尝试自己在 schwartzian 版本中查找错误，您可能会了解更多信息，因此我现在只给您一个提示：

> 在第四列中包含特定文本的长行将比短行排序晚。

如果您需要更多帮助，请添加评论。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-07T01:36:14.700

尽管使用 Schwartzian 变换对于 Python 来说已经过时了，但值得一提的是，您可以以这种方式编写代码，以避免出现 line[4] 的行从`\377`被排序到错误的位置开始的可能性

```
for n in range(len(lines)):
    lst = lines[n].split()
    if len(lst)>4:
        lines[n] = ((0, lst[4]), lines[n])
    else:
        lines[n] = ((1,), lines[n]) 
```

由于元组是按元素进行比较的，因此以 开头的元组`1`将`always`被排序到底部。

另请注意，测试应该`len(list)>4`代替`>=`

当使用现代等效的 AKA`key=`函数时，同样的逻辑适用

```
def key_func(line):
        lst = line.split()
        if len(lst)>4:
            return 0, lst[4]
        else:
            return 1,

lines.sort(key=key_func) 
```

# cocoa-touch - 使用 UISlider 改变音量

> ID：463034
> 
> 赞同：7
> 
> 时间：2009-01-20T20:47:42.860
> 
> 标签：cocoa-touch

在应用程序中使用 UISlider 更改 iPhone 音量的最佳方法是什么？

* * *

我试过使用那个比尔（[使用 UISlider 来改变音量](https://stackoverflow.com/questions/463034/iphone-sdk-uislider-to-change-volume#463970)）

但是使用以下代码屏幕上什么也没有出现：

```
MPVolumeView *volumeView = [[[MPVolumeView alloc] initWithFrame:
                                CGRectMake(0, 0, 215, 22)] autorelease];
volumeView.center = CGPointMake(150,375);
[volumeView sizeToFit];
[self.view addSubview:volumeView]; 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-06-18T20:23:23.843

我刚刚找到了一个非常简单的方法。无需编码，只需将其放在您的 XIB 中。

1.  打开要放置滑块的 XIB
2.  将 UIView 添加到您的视图
3.  将类标识从 UIView 更改为 MPVolumeView
4.  更改背景颜色以清除

瞧！

PS：在装有 iPhone OS 3.0 的设备上进行了测试。正如 lostInTransit 之前所说，它不适用于模拟器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T16:16:49.630

[使用 UISlider 改变音量](https://stackoverflow.com/questions/463034/iphone-sdk-uislider-to-change-volume#465649)

^ 我尝试了 lostintransit，但这并没有改变**铃声音量**。它出现在 iphone 屏幕上，但没有任何改变。即使使用提供的演示项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-04T19:45:44.743

我正在使用相同的技术，但是我注意到以下行为：

在 iPod touch G2 上：MPVolumeView 滑块工作并从应用程序启动时完全响应摇杆开关。

在 iPhone Gen 1 和 3G 上：MPVolumeView 滑块在通过 AudioQueue API 进行媒体播放之前不会开始更改音量，并且会在调用 AudioSessionSetActive(false) 时停止更改音量。更奇怪的是：如果您在播放期间使用 AudioQueue API 时按下 iPhone 上的摇杆开关，那么 MPVolumeView 滑块将在应用程序的剩余生命周期内工作。

[此代码](http://blog.stormyprods.com/2008/09/proper-usage-of-mpvolumeview-class.html)使所有内容保持同步，并有助于确保摇杆开关和滑块保持同步，但它并不能消除我在 iPhone 上使用 MPVolumeView 时遇到的问题。

我在这里的所有经验都是在带有 iPhone 3.0 SDK 的 iPhone OS 3.0 下进行的。

我希望这有助于缩小您的问题范围。

我的下一个策略是开始使用 kAudioSessionProperty_AudioRoute 并尝试 kAudioSessionProperty_AudioCategory 的替代值，看看会发生什么。

旁注：感谢使用 IB 技术创建和管理 MPVolumeView 的所有人。我使用代码来创建和放置它，但我一直忘记可以在 IB 中设置 UIView 类型的技术。

旁注 2：在使用 MPVolumeView 时，我发现如果将音频类别设置为 kAudioSessionCategory_MediaPlayback 以外的任何内容，则当 iPhone 设置为静音模式时，MPVolumeView 将显示文本“iPhone ...”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T02:58:56.590

使用 MPVolumeView 显示允许用户修改系统音量的滑块。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T15:01:56.317

如果您希望能够更改 iPhone 的音量，MPVolumeView 是唯一的选择。试试这个链接上的例子。

[http://www.stormyprods.com/blogger/2008/09/proper-usage-of-mpvolumeview-class.html](http://www.stormyprods.com/blogger/2008/09/proper-usage-of-mpvolumeview-class.html)

# .net - Spring.NET 如何使用私有设置器？

> ID：463045
> 
> 赞同：3
> 
> 时间：2009-01-20T20:49:40.843
> 
> 标签：.net, spring.net

在对 Spring.NET 中的集合尝试[这个问题时](https://stackoverflow.com/questions/206746/is-fxcops-collectionpropertiesshouldbereadonly-rule-incompatible-with-the-spring)，我发现 Spring 可以使用私有 setter 注入依赖项。我有两个问题：

1.  这在任何地方都有记录吗？
2.  是否推荐使用私人二传手？

[文档](http://springframework.net/docs/1.1.2/reference/html/objects.html#objects-setter-injection)说：

> 基于 Setter 的 DI 是通过在对象上调用 setter 方法来实现的......

诚然，它没有明确说明*公共*setter 方法，但这是我一直假设的。我在 .NET 3.5 上使用 1.0.2 版。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-20T21:34:20.940

大学教师，

不，这没有记录在 asfaik - 主要是因为我们不推荐它。该功能用于在处理遗留/第 3 方库时支持罕见的极端情况。

您应该只使用您也可以在单元测试中调用的公共设置器！

hth，埃里希

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T21:41:58.930

Spring 的 Java 版本使用反射，它可以获取那些私有设置器。这很好，因为您不会为了满足 Spring 的要求而强迫某人更改不可变对象。

就个人而言，我更喜欢尽可能使用构造函数注入。

# mysql - SQL 选择组的第 n 个成员

> ID：463054
> 
> 赞同：27
> 
> 时间：2009-01-20T20:52:28.733
> 
> 标签：mysql, group-by

如果我有一个像这样的 USER 表

```
class | age
--------------
1       20    
3       56
2       11
1       12
2       20 
```

然后我可以通过以下方式轻松获得每个班级中最年轻的用户

```
select class, min(age)
from   user
group by class; 
```

同样，通过将 min 替换为 max，我可以获得最旧的。但是我怎样才能得到**每个班级中第 10 个最年轻（或最年长）的**呢？顺便说一句，我使用的是 MySql v.5.0。

干杯，

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-20T21:05:49.393

```
SELECT a.class,
(
    SELECT b.age 
    FROM users b 
    WHERE b.class = a.class
    ORDER BY age 
    LIMIT 1,1
) as age
FROM users a
GROUP BY a.class 
```

将获得每个班级第二年轻的。如果你想要第 10 个最小的，你会这样做`LIMIT 9,1`，如果你想要第 10 个最大的，你会这样做`ORDER BY age DESC`。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2013-05-14T09:58:09.120

这里`N`介绍`Nth`记录`oldest`

```
SELECT *
FROM users k
WHERE N = (SELECT
             COUNT( DISTINCT age)
           FROM users u
           WHERE k.age >= u.age
               AND k.class = u.class
           GROUP BY u.class) 
```

它给出了`Nth`记录`youngest`

```
SELECT *
FROM users k
WHERE N = (SELECT
             COUNT(DISTINCT age)
           FROM users u
           WHERE k.age <= u.age
               AND k.class = u.class
           GROUP BY u.class) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-20T21:27:54.450

唯一的 sql 独立方式（即使你没有子查询 mysql <5）

```
 select  u1.class, u1.age, count(*)  from      user u1 join user u2 
 on u1.class = u2.class and u1.age >= u2.age
 group by u1.class, u1.age
 having count(*) = [number] 
```

让你成为每个班级中年龄最大的 [number] 个

```
 select  u1.class, u1.age, count(*)  from      user u1 join user u2 
 on u1.class = u2.class and u1.age <= u2.age
 group by u1.class, u1.age
 having count(*) = [number] 
```

让你成为每个班级最年轻的 [number]

如果两个人的年龄相同，则可能无法正常工作，因为两者都会被退回。如果您只想返回其中一个，您将需要一个唯一键并且查询更加复杂。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T01:35:22.017

任何在其上加入表格的答案都将创建一个平方律......

```
- a JOIN b ON a.class = b.class AND a.age >= b.age  
- on average the >= condition will be true for half the class  

- 6 people in a class  
->6*6/2 = 18

- 10 people in a class
->10*10/2 = 50

-> very rapid growth 
```

随着表大小的增长，性能将迅速下降。如果你把东西保持得很小并且它们不会增长太多，这是一个问题吗？你的电话在那里...

另一种方法涉及更多代码，但线性增长......

*   首先，将所有记录插入到一​​个新表中，其中包含一个 IDENTITY 字段，按 Class 然后 Age 排序
*   现在，对于每个类，找到 MIN(id)
*   现在，对于每个班级，检查 is = MIN(id) + 8 的记录（对于第 9 个最老的）

有很多方法可以完成最后两个步骤。我个人会用...

```
SELECT
    [USER_WITH_IDS].id,
    [USER_WITH_IDS].class,
    [USER_WITH_IDS].age
FROM
    [USER_WITH_IDS]
WHERE
    [USER_WITH_IDS].id = (
                          SELECT
                              MIN([min].ID) + 8
                          FROM
                              [USER_WITH_IDS] AS [min]
                          WHERE
                              [min].class = [USER_WITH_IDS].class
                         ) 
```

这给出的是...

*   一次创建新 ID
*   一次通过即可获得每个班级的 MIN(id)
*   一张通行证，获取您需要的记录

*   并且根据优化器的好坏，使用索引（类然后 id）将允许它将最后 2 次传递合并为 1 次传递。

2 或 3 次通过，无论桌子或班级人数有多大。线性，而不是平方律...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-04-09T17:39:00.463

另一种方法是将 SQL 查询放在一个 for 循环中，每次将新的最小值添加到一个不断增长的元组中，然后使用 WHERE ... NOT IN 子句将其过滤掉。我不确定这个速度，但对我来说，它对于一个非常大的数据集（> 180,000 条记录）工作得非常快。很抱歉混合使用 SQL 和 Python，我对两者都是新手。我知道可能有一种方法可以在 SQL 中执行循环，但我不知道。

```
 idx = tuple()
        for i in range(n):

            qry = '''SELECT class, min(age)
                     FROM user
                     WHERE age NOT IN {}
                     GROUP BY class'''.format(idx)

            cur.execute(qry)
            data = cur.fetchall()
            d = pd.DataFrame(data)

            idx = idx + tuple(d['min(age)']) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-20T20:59:35.630

在 SQL Server 中这很容易：

> ```
> select 
>   *
> from(
>    select 
>       *,
>       row_number() over(order by age asc) as eldest
>    from class order by age asc) a
> where a.eldest = 10 
> ```

按照这种模式，对于 MySQL，我想你想看看这个：[http ://www.xaprb.com/blog/2006/12/02/how-to-number-rows-in-mysql/](http://www.xaprb.com/blog/2006/12/02/how-to-number-rows-in-mysql/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-20T21:22:45.630

```
 SELECT 
     userid,  
     class,  
     age,  
     (    SELECT COUNT(1) FROM user  
          WHERE class = c.class  AND age > u.age  
     ) AS oldercount  
FROM user AS u  
WHERE oldercount = 9
GROUP BY class 
```

或者

```
 SELECT userid,  
         class,  
         age  
  FROM user AS u    
  WHERE (SELECT COUNT(1) FROM class WHERE class = c.class AND age > u.age) = 9  
GROUP BY class 
```

# javascript - 自定义弹出窗口中的第三方内容

> ID：463067
> 
> 赞同：0
> 
> 时间：2009-01-20T20:56:12.797
> 
> 标签：javascript, popup

以[http://youtube.com](http://youtube.com)、[http://justin.tv](http://justin.tv)、[http://ustream.tv](http://ustream.tv)为例，是否可以做到以下几点：

*   在弹出窗口中打开第三方页面
*   分析元素的高度和宽度
*   调整窗口内容的大小并将窗口内容偏移到元素的大小

当特定站点禁用嵌入时，这将特别有用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T19:09:12.597

虽然您无法将弹出窗口的大小调整为特定内容的大小（出于上述 levik 的原因），但您可以直接滚动到特定元素，前提是第三方站点已使用 ID 装饰了元素（或附近的祖先/兄弟姐妹）。我经常将 jQuery 的[nyroModal](http://nyromodal.nyrodev.com/)插件用于页内弹出窗口（通常比完整的浏览器弹出窗口更用户友好）。NyroModal 支持使用以下链接滚动到一个元素（比如一个 id 为“mainVideo”的 Flash 视频）：

[http://example.com/thirdparty.html#mainVideo](http://example.com/thirdparty.html#mainVideo)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T21:37:42.027

不允许您的脚本检查或操作来自与运行它的页面不同的主机的文档的 DOM 内容。

这意味着除非您的脚本从 youtube.com 域运行，否则您将无法检查或操作那里的页面。

# php - 您如何构建您的网站？

> ID：463072
> 
> 赞同：1
> 
> 时间：2009-01-20T20:56:49.753
> 
> 标签：php, structure

我是 php 新手。有一些关于如何构建的问题。我将所有内容都包含在 index.php 中。前任：

```
ob_start..
html...
功能等。

if ($_GET['page'] == "forum") include('forum.php');
elseif ($_GET['page'] == "profile") include('profile.php');
否则错误...等

/html...

```

我这样做是因为我不喜欢在所有页面的顶部包含一个包含我需要的信息的页面。我有比这 2 更好的方法吗？你如何构建你的页面？

原谅我的英语，但我想你明白；）

雷米

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T20:59:03.603

退房[`this question`](https://stackoverflow.com/questions/115629/simplest-php-routing-framework)。接受的答案对最流行的路由选项有很好的了解。就个人而言，我使用类似的`Front Controller`方式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T21:26:41.330

我做了一些类似于你正在做的事情，但编码更优雅一点：

```
switch ($_GET['page']( {
    case 'forum':
    case 'profile':
    case 'home':
        include($_GET['page'].'.php');
        break;
    default:
        include('error.php');
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T21:02:48.930

有关开发站点架构、编码风格和所有其他 PHP 的常见良好实践的示例，我建议您查看 PHP 的常见框架之一。请注意，即使您不想使用它，它也可以向您展示代码的良好实践，并且注释可以提供很多信息。

我个人建议 Zend 框架。

# .net - 将 Windows 窗体应用程序作为服务运行？

> ID：463073
> 
> 赞同：6
> 
> 时间：2009-01-20T20:57:00.347
> 
> 标签：.net, winforms, windows-services

我有一个我编写的 Windows 窗体应用程序，它对收件箱和数据库进行一些监视。客户告诉我，它需要在每次服务器重新启动时运行。让客户改变要求让我感到羞耻。

我在想......有没有办法让 Windows 窗体应用程序作为服务运行，以便它自动启动？

**澄清**

我想尽量不用再写代码……如果可能的话！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-20T21:06:37.113

（此答案已过时，因为链接的文章已于 2012 年删除。但是，StackOverflow 不允许删除已接受的答案。因此，请不要反对此答案，因为我已通知您它已过时。）

替代链接： [https ://web.archive.org/web/20111221041348/http://www.codeproject.com/kb/system/xyntservice.aspx](https://web.archive.org/web/20111221041348/http://www.codeproject.com/kb/system/xyntservice.aspx)

C++ 源代码（或使用文章中的浏览代码选项卡）：[https ://web.archive.org/web/20111228050501/http://www.codeproject.com/KB/system/xyntservice.aspx](https://web.archive.org/web/20111228050501/http://www.codeproject.com/KB/system/xyntservice.aspx)

> 不幸的是，Zip 文件源代码下载在替代链接中不起作用。

## 从 NT 服务启动 Windows 程序

查看这篇文章：[http ://www.codeproject.com/script/Articles/ArticleVersion.aspx?aid=719&av=49654](http://www.codeproject.com/script/Articles/ArticleVersion.aspx?aid=719&av=49654)

这是一篇非常老的文章，但它已经工作了 8 年，并且作者继续保持更新。

它会做你想做的事。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-20T21:57:44.827

如果您确定应用程序可以在无人看管的情况下安全运行（我的意思是它***永远不会***抛出像消息框这样的模态 UI 元素）并且它在关闭之前不需要任何交互，它将简单地终止，然后运行它作为计划任务，触发器设置为系统启动。

如果它可以在无人看管的情况下运行，但可能需要手动关闭并重新启动，或者它不能在关闭时终止，则按照 EnocNRoll 的建议使用[XYNTService](https://stackoverflow.com/questions/463073/run-windows-forms-application-as-service#463117)。这是一个可怕的黑客，但它会为你想要的。

但到目前为止，最好的解决方案是将程序的功能与用户界面分开并编写适当的服务。对于生产服务器，我不允许其他任何事情。如果不容易分开，那么无论如何您都应该考虑一些设计问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T21:26:51.987

您可以将 winforms 应用程序作为服务运行，但您将无法看到它——它将显示在所谓的虚拟桌面上，而无法在您的显示器上查看。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-24T06:52:18.440

您可能还需要考虑[AlwaysUp](http://www.coretechnologies.com/products/AlwaysUp/)，这是一个商业应用程序，可以将任何应用程序作为 Windows 服务运行。它类似于 XYNTService（EnocNRoll 提到的），但具有更多功能并得到完全支持。

祝你好运！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-20T20:58:57.847

甚至考虑这一点的唯一方法是确保应用程序没有 UI 元素，因为您必须在非 Vista 机器上跳圈才能使这项工作，而在 Vista 上，您无法与桌面。

相反，您最好将功能重构为一组共享库，然后创建一个使用这些库的服务，并将其安装在客户端。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-20T21:06:23.180

如果您的表单应用程序中有一个很好的解耦功能，那么使用它的安装程序创建一个服务类，然后在服务的 OnStart 方法中启动您的处理器类应该很简单：

```
 protected override void OnStart(string[] args)
    {
                    Processor processor = new Processor();
        Thread workerThread = new Thread(processor.OnStart);
        workerThread.IsBackground = true;

        try
        {
            workerThread.Start();
        }
        catch
        {
                      //...
        }
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-20T21:06:28.050

您可以使用[InstallUtil](http://msdn.microsoft.com/en-us/library/sd8zc8ha(VS.80).aspx)将您的应用程序安装为服务，但您需要确保它不依赖于 GUI，并且我建议您更改应用程序的启动，这样它就不会尝试创建任何表单。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-20T21:06:23.947

找到[这篇](http://support.microsoft.com/kb/137890)名为**How To Create a User-Defined Service 的**文章。

# assembly - 帮助理解 RedCode

> ID：463097
> 
> 赞同：2
> 
> 时间：2009-01-20T21:02:00.727
> 
> 标签：assembly, corewars, redcode

我正在尝试学习 redcode，因为制作机器人看起来很有趣。

## 介绍

对于那些不知道什么是 redcode 的人，这里有一个简短的解释。它是一种类似 ASM 的语言，但更加简单和精简。它用于编写需要关闭虚拟内存中其他程序的小程序。（请参阅此处了解更多信息：http: [//vyznev.net/corewar/guide.html](http://vyznev.net/corewar/guide.html)）

这是一段代码：

```
;redcode
;name Mice
;author Chip Wendell
;strategy paper (replicator)
;history Winner of the 1986 ICWS tournament
Top dat #0, #0
Start   mov #12,    Top
Loop    mov @Top,   <Target
    djn Loop,   Top
    spl @Target,0
Spacer  equ 653
    add #Spacer,Target
    jmz Start,  Top
Target  dat #0, #833
    end Start 
```

## 问题

基本策略是将自身复制到另一个地方，然后分叉该过程。我不明白的是这个规则：

```
Loop    mov @Top,   <Target 
```

我理解这条线的意思。它说，将目标的 B-Field 移动到顶点 B-Field 所在的线，并减小目标 B-Field 的值。

当第一次执行循环时，第一行将是：

```
Top dat #0, #12 
```

据我所知，带有 Loop 的行的意思是：将指令向前移动 12 行（用 dat #0、#0 填充）到第 833 行。

但是当执行这段代码时，这行代码放在了第 839 行。

有人了解真正发生的事情吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-20T21:54:28.153

好的，这需要阅读大量内容，但这是您的答案：

正如您正确猜测的那样，第一条指令使 Top 变为 DAT #0、#12。很简单，但下一条指令更棘手。首先，它减少 Target 的 B 值（使其变为 832）。*然后，它将 Top 处的指令复制到相对于 Target*前方 832 行的位置。这是关键：间接寻址模式意味着目标是相对于偏移量读取的 B 值。现在看编译后的代码，前面有行号：

```
0000 Top    DAT.F  #0        #0       
0001 Start  MOV.AB #12       $-1      
0002 Loop   MOV.I  @-2       <5       
0003        DJN.B  $-1       $-3      
0004        SPL.B  @3        $0       
0005        ADD.AB #653      $2       
0006        JMZ.B  $-5       $-6      
0007 Target DAT.F  #0        #833 
```

如您所见，Target 在第 7 行，因此相对于 Target 前方的 832 行是第 839 行。

希望能为您解决问题。

# time - Lua - 当前时间（以毫秒为单位）

> ID：463101
> 
> 赞同：80
> 
> 时间：2009-01-20T21:03:34.187
> 
> 标签：time, lua

有没有一种常用的方法可以以毫秒或毫秒为单位获取当前时间？

有`os.time()`，但它只提供完整的秒数。

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-01-22T20:07:18.633

我使用 LuaSocket 来获得更高的精度。

```
require "socket"
print("Milliseconds: " .. socket.gettime()*1000) 
```

这当然会增加一个依赖项，但可以很好地供个人使用（例如在基准测试脚本中）。

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2010-03-19T16:46:49.957

如果要进行基准测试，可以使用 os.clock 如文档所示：

```
local x = os.clock()
local s = 0
for i=1,100000 do s = s + i end
print(string.format("elapsed time: %.2f\n", os.clock() - x)) 
```

* * *

## 回答 #3

> 赞同：36
> 
> 时间：2009-01-20T21:09:10.010

在标准 C lua 中，没有。您将不得不等待几秒钟，除非您愿意自己修改 lua 解释器以让 os.time 使用您想要的分辨率。但是，如果您正在编写代码供其他人自行运行，而不是像您可以完全控制环境的 Web 应用程序那样，这可能是不可接受的。

编辑：另一种选择是用 C 语言编写自己的小 DLL，该 DLL 使用新函数扩展 lua，该函数将为您提供所需的值，并要求将 dll 与您的代码一起分发给将要使用它的任何人。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2017-03-22T12:54:50.710

# 以毫秒为单位获取当前时间。

## ~~os.time()~~

```
os.time()
return sec // only 
```

## posix.clock_gettime(clk)

[https://luaposix.github.io/luaposix/modules/posix.time.html#clock_gettime](https://luaposix.github.io/luaposix/modules/posix.time.html#clock_gettime)

```
require'posix'.clock_gettime(0)
return sec, nsec 
```

linux/time.h //`man clock_gettime`

```
/*
 * The IDs of the various system clocks (for POSIX.1b interval timers):
 */
#define CLOCK_REALTIME                  0
#define CLOCK_MONOTONIC                 1
#define CLOCK_PROCESS_CPUTIME_ID        2
#define CLOCK_THREAD_CPUTIME_ID         3
#define CLOCK_MONOTONIC_RAW             4
#define CLOCK_REALTIME_COARSE           5
#define CLOCK_MONOTONIC_COARSE          6 
```

## socket.gettime()

[http://w3.impa.br/~diego/software/luasocket/socket.html#gettime](http://w3.impa.br/~diego/software/luasocket/socket.html#gettime)

```
require'socket'.gettime()
return sec.xxx 
```

正如`waqas`所说

* * *

## 比较和测试

get_millisecond.lua

```
local posix=require'posix'
local socket=require'socket'

for i=1,3 do
    print( os.time() )
    print( posix.clock_gettime(0) )
    print( socket.gettime() )
    print''
    posix.nanosleep(0, 1) -- sec, nsec
end 
```

输出

```
lua get_millisecond.lua
1490186718
1490186718      268570540
1490186718.2686

1490186718
1490186718      268662191
1490186718.2687

1490186718
1490186718      268782765
1490186718.2688 
```

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2012-04-16T02:59:59.540

我为 Windows 上的 lua 做了一个合适的解决方案。我基本上按照 Kevlar 的建议做了，但使用的是共享库而不是 DLL。这已使用 cygwin 进行了测试。

我编写了一些与 lua 兼容的 C 代码，将其编译为共享库（通过 cygwin 中的 gcc 的.so 文件），然后使用 package.cpath 将其加载到 lua 中并要求“”。为方便起见，编写了一个适配器脚本。以下是所有来源：

首先是 C 代码，HighResTimer.c

```
////////////////////////////////////////////////////////////////
//HighResTimer.c by Cody Duncan
//
//compile with:  gcc -o Timer.so -shared HighResTimer.c -llua5.1
//compiled in cygwin after installing lua (cant remember if I 
//   installed via setup or if I downloaded and compiled lua, 
//   probably the former)
////////////////////////////////////////////////////////////////
#include <windows.h>

typedef unsigned __int64 u64;
double mNanoSecondsPerCount;

#include "lua.h"
#include "lualib.h"
#include "lauxlib.h"

int prevInit = 0;
int currInit = 0;
u64 prevTime = 0;
u64 currTime = 0;
u64 FrequencyCountPerSec;

LARGE_INTEGER frequencyTemp;
static int readHiResTimerFrequency(lua_State *L)
{
    QueryPerformanceFrequency(&frequencyTemp);
    FrequencyCountPerSec = frequencyTemp.QuadPart;
    lua_pushnumber(L, frequencyTemp.QuadPart);
    return 1;
}

LARGE_INTEGER timerTemp;
static int storeTime(lua_State *L)
{
    QueryPerformanceCounter(&timerTemp);

    if(!prevInit)
    {
        prevInit = 1;
        prevTime = timerTemp.QuadPart;
    }
    else if (!currInit)
    {
        currInit = 1;
        currTime = timerTemp.QuadPart;
    }
    else
    {
        prevTime = currTime;
        currTime = timerTemp.QuadPart;
    }

    lua_pushnumber(L, timerTemp.QuadPart);
    return 1;
}

static int getNanoElapsed(lua_State *L)
{
    double mNanoSecondsPerCount = 1000000000/(double)FrequencyCountPerSec;
    double elapsedNano = (currTime - prevTime)*mNanoSecondsPerCount;
    lua_pushnumber(L, elapsedNano);
    return 1;
}

int luaopen_HighResolutionTimer (lua_State *L) {

    static const luaL_reg mylib [] = 
    {
        {"readHiResTimerFrequency", readHiResTimerFrequency},
        {"storeTime", storeTime},
        {"getNanoElapsed", getNanoElapsed},
        {NULL, NULL}  /* sentinel */
    };

    luaL_register(L,"timer",mylib);

    return 1;
} 
```

## --

## --

现在让我们在 lua 脚本 HighResTimer.lua 中加载它。

注意：我将 HighResTimer.c 编译为共享库 Timer.so

```
#!/bin/lua
------------------------------------
---HighResTimer.lua by Cody Duncan
---Wraps the High Resolution Timer Functions in
---   Timer.so
------------------------------------

package.cpath = "./Timer.so"     --assuming Timer.so is in the same directory
require "HighResolutionTimer"    --load up the module
timer.readHiResTimerFrequency(); --stores the tickFrequency

--call this before code that is being measured for execution time
function start()
    timer.storeTime();
end

--call this after code that is being measured for execution time
function stop()
    timer.storeTime();
end

--once the prior two functions have been called, call this to get the 
--time elapsed between them in nanoseconds
function getNanosElapsed()
    return timer.getNanoElapsed();
end 
```

## --

## --

最后，利用计时器 TimerTest.lua 。

```
#!/bin/lua
------------------------------------
---TimerTest.lua by Cody Duncan
---
---HighResTimer.lua and Timer.so must 
---   be in the same directory as 
---   this script.
------------------------------------

require './HighResTimer' 

start();
for i = 0, 3000000 do io.write("") end --do essentially nothing 3million times.
stop();

--divide nanoseconds by 1 million to get milliseconds
executionTime = getNanosElapsed()/1000000; 
io.write("execution time: ", executionTime, "ms\n"); 
```

注意：任何评论都是在将源代码粘贴到帖子编辑器之后编写的，所以从技术上讲，这是未经测试的，但希望这些评论不会混淆任何东西。如果确实如此，我一定会回来并提供修复。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2015-06-18T11:19:03.760

如果您将 lua 与 nginx/openresty 一起使用，则可以使用[ngx.now()](http://wiki.nginx.org/HttpLuaModule#ngx.now "ngx.now()")它返回毫秒精度的浮点数

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-05-09T17:05:25.730

[如果您使用的是 OpenResty，那么它通过使用其ngx.now()](https://github.com/openresty/lua-nginx-module#ngxnow)函数提供了内置的毫秒时间精度。虽然如果你想要细粒度的毫秒精度，那么你可能需要先调用 ngx.update_time() 。或者，如果你想更进一步......

如果您使用的是启用了[luajit](http://luajit.org/)的环境，例如 OpenResty，那么您还可以使用[ffi](http://luajit.org/ext_ffi.html)访问基于 C 的时间函数，`gettimeofday()`例如：（注意：仅当您重复运行它时才需要`pcall`检查是否存在，例如通过in OpenResty - 没有它你会遇到错误，例如）`struct timeval``content_by_lua_file``attempt to redefine 'timeval'`

```
if pcall(ffi.typeof, "struct timeval") then
        -- check if already defined.
else
        -- undefined! let's define it!
        ffi.cdef[[
           typedef struct timeval {
                long tv_sec;
                long tv_usec;
           } timeval;

        int gettimeofday(struct timeval* t, void* tzp);
]]
end
local gettimeofday_struct = ffi.new("struct timeval")
local function gettimeofday()
        ffi.C.gettimeofday(gettimeofday_struct, nil)
        return tonumber(gettimeofday_struct.tv_sec) * 1000000 + tonumber(gettimeofday_struct.tv_usec)
end 
```

然后`gettimeofday()`可以从 lua 调用新的 lua 函数，以提供**微秒**级精度的时钟时间。

[实际上，可以使用clock_gettime()](https://linux.die.net/man/3/clock_gettime)采取类似的方法来获得*纳秒级*精度。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-20T21:15:30.683

凯夫拉是正确的。

自定义 DLL 的替代方案是[Lua Alien](http://alien.luaforge.net/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-03-15T23:25:21.987

在 openresty 中有一个函数[ngx.req.start_time](https://github.com/openresty/lua-nginx-module#ngxreqstart_time)。

从文档：

> 返回一个浮点数，表示当前请求创建时的时间戳（包括毫秒作为小数部分）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-15T14:01:34.100

您可以使用 C 函数 gettimeofday ： [http ://www.opengroup.org/onlinepubs/000095399/functions/gettimeofday.html](http://www.opengroup.org/onlinepubs/000095399/functions/gettimeofday.html)

这里 C 库 'ul_time'，函数 sec_usec 驻留在 'time' 全局表中并返回秒，u 秒。将 DLL 复制到 Lua 文件夹，使用 require 'ul_time' 打开它。

[http://depositfiles.com/files/3g2fx7dij](http://depositfiles.com/files/3g2fx7dij)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-02-27T19:20:46.153

如果您的环境是 Windows 并且您可以访问系统命令，则可以通过以下方式获得精确到厘秒的时间[`io.popen(command)`](https://www.lua.org/manual/5.1/manual.html#pdf-io.popen)：

```
local handle = io.popen("echo %time%")
local result = handle:read("*a")
handle:close() 
```

结果将保存`hh:mm:ss.cc`格式字符串：（带有尾随换行符）

```
"19:56:53.90\n" 
```

请注意，它位于本地时区，因此您可能只想提取`.cc`部分并将其与`os.time()`.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-05-21T07:51:31.193

如果您在一个具有 GNU 兼容实现的系统上`date`，您可以执行，这里有一个以毫秒为单位获取 Epoch 时间的单行代码：

```
local function gethammertime()
  return tonumber(assert(assert(io.popen'date +%s%3N'):read'a'))
end 
```

请注意，`assert`调用对于确保读取或打开的任何失败`date`将分别传播错误是必要的。另请注意，这依赖于垃圾收集（或终结器，在 Lua 5.4 中）来关闭进程句柄：如果使用 5.4 之前的 Lua 版本并且担心资源耗尽，您可能希望将其扩展到三行，如[Klesun 的 Windows -基于答案](https://stackoverflow.com/a/66402619/34799)并明确关闭句柄。

# algorithm - 就地基数排序

> ID：463105
> 
> 赞同：205
> 
> 时间：2009-01-20T21:04:06.667
> 
> 标签：algorithm, language-agnostic, sorting, radix-sort, in-place

这是一篇长文。请多多包涵。归结起来，问题是：**是否有可行的就地基数排序算法**？

* * *

## 初步的

我有大量*固定长度的小*字符串，它们只使用我想要排序的字母“A”、“C”、“G”和“T”（是的，你猜对了：[DNA ）。](https://en.wikipedia.org/wiki/DNA)

目前，我使用which 在[STL](https://en.wikipedia.org/wiki/Standard_Template_Library)的所有常见实现中`std::sort`使用[introsort](https://en.wikipedia.org/wiki/Introsort)。这工作得很好。但是，我相信[基数排序](https://en.wikipedia.org/wiki/Radix_sort)非常适合我的问题集，并且在实践中应该工作**得**更好。

 **## 细节

我已经用一个非常幼稚的实现测试了这个假设，并且对于相对较小的输入（大约 10,000 个）这是正确的（嗯，至少快两倍以上）。但是，当问题规模变大（*N* > 5,000,000）时，运行时间会大大降低。

原因很明显：基数排序需要复制整个数据（实际上在我的幼稚实现中不止一次）。这意味着我已将 ~ 4 GiB 放入我的主内存中，这显然会影响性能。即使没有，我也负担不起使用这么多内存，因为问题的大小实际上变得更大了。

## 用例

理想情况下，该算法应适用于 2 到 100 之间的任何字符串长度，适用于 DNA 和 DNA5（允许额外的通配符“N”），甚至是具有[IUPAC](https://en.wikipedia.org/wiki/International_Union_of_Pure_and_Applied_Chemistry) [歧义码](https://en.wikipedia.org/wiki/Nucleic_acid_notation)的 DNA （产生 16 个不同的值）。但是，我意识到无法涵盖所有​​这些情况，因此我对获得的任何速度改进感到满意。代码可以动态决定分派到哪个算法。

## 研究

不幸的是，[关于基数排序的维基百科文章](https://en.wikipedia.org/wiki/Radix_sort)毫无用处。关于就地变体的部分完全是垃圾。[NIST-DADS 关于基数排序的部分几乎](http://xlinux.nist.gov/dads/HTML/radixsort.html)不存在。有一篇听起来很有前途的论文叫做[Efficient Adaptive In-Place Radix Sorting](https://www.mii.vu.lt/informatica/pdf/INFO562.pdf)，它描述了算法“MSL”。不幸的是，这篇论文也令人失望。

特别是有以下几点。

首先，该算法包含几个错误并且有很多无法解释的地方。特别是，它没有详细说明递归调用（我只是假设它增加或减少了一些指针来计算当前的移位和掩码值）。此外，它使用函数`dest_group`并且`dest_address`没有给出定义。我看不到如何有效地实现这些（也就是说，在 O(1) 中；至少`dest_address`不是微不足道的）。

最后但同样重要的是，该算法通过将数组索引与输入数组中的元素交换来实现就地性。这显然只适用于数值数组。我需要在字符串上使用它。当然，我可以只是搞砸强类型并继续假设内存将允许我存储不属于它的索引。但这只有在我可以将字符串压缩到 32 位内存（假设为 32 位整数）时才有效。那只有 16 个字符（让我们暂时忽略 16 > log(5,000,000)）。

其中一位作者的另一篇论文根本没有给出准确的描述，但它给出了 MSL 的运行时间是亚线性的，这完全是错误的。

**回顾一下**：是否有希望找到一个有效的参考实现，或者至少是一个很好的伪代码/描述一个适用于 DNA 字符串的就地基数排序？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-01-20T21:19:25.870

好吧，这是 DNA 的 MSD 基数排序的简单实现。它是用 D 编写的，因为这是我使用最多的语言，因此最不可能犯愚蠢的错误，但它可以很容易地翻译成其他语言。它是就地的，但需要`2 * seq.length`通过数组。

```
void radixSort(string[] seqs, size_t base = 0) {
    if(seqs.length == 0)
        return;

    size_t TPos = seqs.length, APos = 0;
    size_t i = 0;
    while(i < TPos) {
        if(seqs[i][base] == 'A') {
             swap(seqs[i], seqs[APos++]);
             i++;
        }
        else if(seqs[i][base] == 'T') {
            swap(seqs[i], seqs[--TPos]);
        } else i++;
    }

    i = APos;
    size_t CPos = APos;
    while(i < TPos) {
        if(seqs[i][base] == 'C') {
            swap(seqs[i], seqs[CPos++]);
        }
        i++;
    }
    if(base < seqs[0].length - 1) {
        radixSort(seqs[0..APos], base + 1);
        radixSort(seqs[APos..CPos], base + 1);
        radixSort(seqs[CPos..TPos], base + 1);
        radixSort(seqs[TPos..seqs.length], base + 1);
   }
} 
```

显然，这是特定于 DNA 的，而不是通用的，但它应该很快。

# 编辑：

我很好奇这段代码是否真的有效，所以我在等待我自己的生物信息学代码运行的同时对其进行了测试/调试。现在上面的版本实际上已经过测试并且可以工作。对于每个 5 个碱基的 1000 万个序列，它比优化的 introsort 快大约 3 倍。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-01-20T21:36:30.173

我从未见过就地基数排序，并且从基数排序的性质来看，只要临时数组适合内存，我怀疑它是否比异地排序快得多。

**原因：**

排序对输入数组进行线性读取，但所有写入几乎都是随机的。从某个 N 向上，这归结为每次写入的缓存未命中。这种缓存未命中会减慢您的算法。无论是否到位都不会改变这种效果。

我知道这不会直接回答您的问题，但是如果排序是一个瓶颈，您可能希望**将近排序**算法作为**预处理步骤**来查看（软堆上的 wiki 页面可能会让您入门）。

这可以提供非常好的缓存局部性提升。教科书异地基数排序将表现更好。写入仍然几乎是随机的，但至少它们将聚集在相同的内存块周围，从而提高缓存命中率。

我不知道它在实践中是否可行。

顺便说一句：如果您只处理 DNA 字符串：您可以将一个 char 压缩成两位并将您的数据打包很多。这将比简单的表示减少四倍的内存需求。寻址变得更加复杂，但是无论如何，CPU 的 ALU 在所有缓存未命中期间都需要花费大量时间。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-01-20T22:48:02.010

您当然可以通过以位编码序列来降低内存要求。您正在查看排列，因此，对于长度为 2，“ACGT”是 16 个状态或 4 位。对于长度 3，即 64 个状态，可以用 6 位编码。所以它看起来像序列中每个字母的 2 位，或者像你说的 16 个字符大约 32 位。

如果有办法减少有效“单词”的数量，则可以进一步压缩。

因此，对于长度为 3 的序列，可以创建 64 个桶，大小可能为 uint32 或 uint64。将它们初始化为零。遍历您非常非常大的 3 个字符序列列表，并按上述方式对它们进行编码。将此用作下标，并增加该存储桶。
重复此操作，直到处理完所有序列。

接下来，重新生成您的列表。

按顺序遍历 64 个存储桶，对于在该存储桶中找到的计数，生成该存储桶表示的序列的多个实例。
当所有的桶都被迭代后，你就有了你的排序数组。

一个 4 的序列，加上 2 位，所以会有 256 个桶。一个 5 的序列，加上 2 位，所以会有 1024 个桶。

在某些时候，桶的数量会接近你的极限。如果您从文件中读取序列，而不是将它们保存在内存中，则可以为存储桶提供更多内存。

我认为这比在原地进行排序要快，因为桶很可能适合您的工作集。

这是一个显示该技术的hack

```
#include <iostream>
#include <iomanip>

#include <math.h>

using namespace std;

const int width = 3;
const int bucketCount = exp(width * log(4)) + 1;
      int *bucket = NULL;

const char charMap[4] = {'A', 'C', 'G', 'T'};

void setup
(
    void
)
{
    bucket = new int[bucketCount];
    memset(bucket, '\0', bucketCount * sizeof(bucket[0]));
}

void teardown
(
    void
)
{
    delete[] bucket;
}

void show
(
    int encoded
)
{
    int z;
    int y;
    int j;
    for (z = width - 1; z >= 0; z--)
    {
        int n = 1;
        for (y = 0; y < z; y++)
            n *= 4;

        j = encoded % n;
        encoded -= j;
        encoded /= n;
        cout << charMap[encoded];
        encoded = j;
    }

    cout << endl;
}

int main(void)
{
    // Sort this sequence
    const char *testSequence = "CAGCCCAAAGGGTTTAGACTTGGTGCGCAGCAGTTAAGATTGTTT";

    size_t testSequenceLength = strlen(testSequence);

    setup();

    // load the sequences into the buckets
    size_t z;
    for (z = 0; z < testSequenceLength; z += width)
    {
        int encoding = 0;

        size_t y;
        for (y = 0; y < width; y++)
        {
            encoding *= 4;

            switch (*(testSequence + z + y))
            {
                case 'A' : encoding += 0; break;
                case 'C' : encoding += 1; break;
                case 'G' : encoding += 2; break;
                case 'T' : encoding += 3; break;
                default  : abort();
            };
        }

        bucket[encoding]++;
    }

    /* show the sorted sequences */ 
    for (z = 0; z < bucketCount; z++)
    {
        while (bucket[z] > 0)
        {
            show(z);
            bucket[z]--;
        }
    }

    teardown();

    return 0;
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-20T21:24:34.970

如果您的数据集如此之大，那么我认为基于磁盘的缓冲区方法是最好的：

```
sort(List<string> elements, int prefix)
    if (elements.Count < THRESHOLD)
         return InMemoryRadixSort(elements, prefix)
    else
         return DiskBackedRadixSort(elements, prefix)

DiskBackedRadixSort(elements, prefix)
    DiskBackedBuffer<string>[] buckets
    foreach (element in elements)
        buckets[element.MSB(prefix)].Add(element);

    List<string> ret
    foreach (bucket in buckets)
        ret.Add(sort(bucket, prefix + 1))

    return ret 
```

我还会尝试分组到更多的桶中，例如，如果你的字符串是：

```
GATTACA 
```

第一个 MSB 调用将返回 GATT 的存储桶（总共 256 个存储桶），这样您就可以减少基于磁盘的缓冲区的分支。这可能会或可能不会提高性能，因此请尝试一下。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-20T22:00:44.570

我将冒险出去并建议您切换到堆/堆[排序](http://en.wikipedia.org/wiki/Heapsort)实现。这个建议带有一些假设：

1.  您控制数据的读取
2.  一旦你“开始”排序，你就可以对排序的数据做一些有意义的事情。

heap/heap-sort 的美妙之处在于您可以在读取数据的同时构建堆，并且可以在构建堆的那一刻开始获得结果。

让我们退后一步。如果你很幸运可以异步读取数据（即你可以发布某种读取请求并在某些数据准备好时收到通知），然后你可以在等待的同时构建一个堆下一块数据进入 - 甚至来自磁盘。通常，这种方法可以将一半排序的大部分成本隐藏在获取数据所花费的时间之后。

读取数据后，第一个元素已经可用。根据您发送数据的位置，这可能很棒。如果您将它发送到另一个异步阅读器，或一些并行的“事件”模型或 UI，您可以随时发送块和块。

也就是说 - 如果您无法控制数据的读取方式，并且它是同步读取的，并且在完全写出之前您对排序的数据没有用处 - 忽略所有这些。:(

请参阅维基百科文章：

*   *[堆排序](http://en.wikipedia.org/wiki/Heapsort)*
*   *[二进制堆](http://en.wikipedia.org/wiki/Binary_heap)*

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-08-05T07:07:06.063

“[没有多余空间的基数排序](http://portal.acm.org/citation.cfm?id=1778601)”是一篇解决您的问题的论文。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-07-15T00:37:54.477

性能方面，您可能希望查看更通用的字符串比较排序算法。

目前你最终会触及每根弦的每一个元素，但你可以做得更好！

特别是，[突发排序](http://en.wikipedia.org/wiki/Burstsort)非常适合这种情况。作为奖励，由于 Burstsort 基于尝试，它对于 DNA/RNA 中使用的小字母大小非常有效，因为您不需要在尝试实施。这些尝试也可能对您的类似后缀数组的最终目标有用。

[在http://sourceforge.net/projects/burstsort/](http://sourceforge.net/projects/burstsort/)的源代码伪造上提供了一个不错的通用突发排序实现- 但它不是就地的。

[出于比较目的， http:](http://www.cs.mu.oz.au/~rsinha/papers/SinhaRingZobel-2006.pdf) //www.cs.mu.oz.au/~rsinha/papers/SinhaRingZobel-2006.pdf 中介绍的 C-burstsort 实现对某些典型工作负载的基准测试比快速排序和基数排序快 4-5 倍。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-01-23T18:17:44.187

你会想看看Drs[的大规模基因组序列处理](https://rads.stackoverflow.com/amzn/click/com/1860946356)。笠原和森下。

由四个核苷酸字母 A、C、G 和 T 组成的字符串可以专门编码为整数，以便*更快地*处理。基数排序是本书讨论的众多算法之一。您应该能够调整这个问题的公认答案，并看到性能大幅提升。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-21T05:05:16.630

您可以尝试使用[trie](http://en.wikipedia.org/wiki/Trie)。对数据进行排序只是简单地遍历数据集并插入它；该结构是自然排序的，您可以将其视为类似于 B-Tree（除了不进行比较，您*总是*使用指针间接寻址）。

缓存行为将有利于所有内部节点，因此您可能不会对此进行改进；但是您也可以调整 trie 的分支因子（确保每个节点都适合单个缓存行，分配类似于堆的 trie 节点，作为表示级别顺序遍历的连续数组）。由于尝试也是数字结构（长度为 k 的元素的 O(k) 插入/查找/删除），因此您应该具有与基数排序相比具有竞争力的性能。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-24T22:11:30.693

我会对字符串的压缩位表示进行[burstsort 。](http://en.wikipedia.org/wiki/Burstsort)据称 Burstsort 比基数排序具有更好的局部性，使用突发尝试代替经典尝试来降低额外空间使用。原纸有尺寸。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-01-23T23:50:35.627

看起来你已经解决了这个问题，但为了记录，似乎可行的就地基数排序的一个版本是“美国国旗排序”。它在这里描述：[工程基数排序](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.22.6990)。一般的想法是对每个字符进行 2 次传递 - 首先计算每个字符有多少，因此您可以将输入数组细分为 bin。然后再次检查，将每个元素交换到正确的 bin 中。现在递归地在下一个字符位置对每个 bin 进行排序。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-06-14T10:25:39.277

Radix-Sort 没有缓存意识，也不是大集合最快的排序算法。你可以看看：

*   [ti7q 排序](http://www.mindspring.com/~pfilandr/C/e_driver/)。ti7qsort 是最快的整数排序（可用于固定大小的小字符串）。
*   [内联 QSORT](http://www.corpit.ru/mjt/qsort.html)
*   [字符串排序](http://code.google.com/p/string-sorting/)

您还可以使用压缩并将 DNA 的每个字母编码为 2 位，然后再存储到排序数组中。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-20T22:45:21.907

首先，考虑问题的编码。摆脱字符串，用二进制表示替换它们。使用第一个字节表示长度+编码。或者，在四字节边界处使用固定长度表示。然后基数排序变得容易得多。对于基数排序，最重要的是不要在内循环的热点处进行异常处理。

好的，我对 4-nary 问题想得更多。你想要一个像[朱迪树](http://en.wikipedia.org/wiki/Judy_array)这样的解决方案。下一个解决方案可以处理变长字符串；对于固定长度，只需删除长度位，这实际上使它更容易。

分配 16 个指针的块。可以重复使用指针的最低有效位，因为您的块将始终对齐。您可能需要一个特殊的存储分配器（将大存储分成更小的块）。有许多不同类型的块：

*   使用 7 个长度位的可变长度字符串进行编码。当它们填满时，您将它们替换为：
*   位置编码接下来的两个字符，您有 16 个指向下一个块的指针，以：
*   字符串最后三个字符的位图编码。

对于每种类型的块，您需要在 LSB 中存储不同的信息。由于您有可变长度的字符串，因此您也需要存储字符串结尾，并且最后一种块只能用于最长的字符串。随着您对结构的深入了解，应将 7 个长度位替换为更少。

这为您提供了一个相当快速且内存效率很高的排序字符串存储。它的行为有点像[trie](http://en.wikipedia.org/wiki/Trie)。要使其正常工作，请确保构建足够的单元测试。您想要覆盖所有块转换。您只想从第二种块开始。

为了获得更高的性能，您可能需要添加不同的块类型和更大的块。如果块的大小始终相同且足够大，则指针可以使用更少的位。对于 16 个指针的块大小，您在 32 位地址空间中已经有了一个空闲字节。查看 Judy 树文档以了解有趣的块类型。基本上，您为空间（和运行时）权衡添加代码和工程时间

您可能希望从前四个字符的 256 宽直接基数开始。这提供了一个不错的空间/时间权衡。在这个实现中，与简单的 trie 相比，您获得的内存开销要少得多；它大约小三倍（我没有测量过）。如果常数足够低，O(n) 就没有问题，正如您在与 O(n log n) 快速排序比较时注意到的那样。

你对处理双打感兴趣吗？对于短序列，将会有。调整块以处理计数很棘手，但它可以非常节省空间。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-01-21T11:40:03.013

dsimcha 的 MSB 基数排序看起来不错，但 Nils 更接近问题的核心，因为它观察到缓存局部性是在大型问题中杀死你的原因。

我建议一个非常简单的方法：

1.  凭经验估计基数排序有效的最大尺寸`m`。
2.  一次读取`m`元素块，对它们进行基数排序，然后将它们写出（如果您有足够的内存，则写入内存缓冲区，否则写入文件），直到您耗尽输入。
3.  **对生成的排序块进行**合并排序。****

 **Mergesort 是我所知道的对缓存最友好的排序算法：“从数组 A 或 B 中读取下一项，然后将一项写入输出缓冲区。” 它在*磁带驱动器*上高效运行。它确实需要`2n`空间来对`n`项目进行排序，但我敢打赌，您将看到大大改进的缓存位置将使这一点变得不重要——如果您使用的是非就地基数排序，那么无论如何您都需要额外的空间。

最后请注意，合并排序可以在没有递归的情况下实现，实际上这样做可以清楚地了解真正的线性内存访问模式。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2020-09-06T10:48:04.980

虽然接受的答案完美地回答了问题的描述，但我已经到了这个地方，徒劳地寻找一种将内联数组划分为 N 部分的算法。我自己写了一篇，就写到这里吧。

警告：这不是一种稳定的分区算法，因此对于多级分区，必须重新分区每个结果分区而不是整个数组。优点是它是内联的。

它有助于解决所提出的问题的方式是，您可以根据字符串的字母重复内联分区，然后在分区足够小时使用您选择的算法对分区进行排序。

```
 function partitionInPlace(input, partitionFunction, numPartitions, startIndex=0, endIndex=-1) {
    if (endIndex===-1) endIndex=input.length;
    const starts = Array.from({ length: numPartitions + 1 }, () => 0);
    for (let i = startIndex; i < endIndex; i++) {
      const val = input[i];
      const partByte = partitionFunction(val);
      starts[partByte]++;
    }
    let prev = startIndex;
    for (let i = 0; i < numPartitions; i++) {
      const p = prev;
      prev += starts[i];
      starts[i] = p;
    }
    const indexes = [...starts];
    starts[numPartitions] = prev;

    let bucket = 0;
    while (bucket < numPartitions) {
      const start = starts[bucket];
      const end = starts[bucket + 1];
      if (end - start < 1) {
        bucket++;
        continue;
      }
      let index = indexes[bucket];
      if (index === end) {
        bucket++;
        continue;
      }

      let val = input[index];
      let destBucket = partitionFunction(val);
      if (destBucket === bucket) {
        indexes[bucket] = index + 1;
        continue;
      }

      let dest;
      do {
        dest = indexes[destBucket] - 1;
        let destVal;
        let destValBucket = destBucket;
        while (destValBucket === destBucket) {
          dest++;
          destVal = input[dest];
          destValBucket = partitionFunction(destVal);
        }

        input[dest] = val;
        indexes[destBucket] = dest + 1;

        val = destVal;
        destBucket = destValBucket;
      } while (dest !== index)
    }
    return starts;
  } 
```

# sql-server - 如何通过 t-sql 获取所有用户数据库的列表？

> ID：463118
> 
> 赞同：15
> 
> 时间：2009-01-20T21:06:42.183
> 
> 标签：sql-server

我想从 mssql 服务器实例中获取所有用户数据库的列表。最好的方法是什么？

我知道我可以从 sys.databases 中进行选择，但除了硬编码要排除的名称列表之外，我看不到任何过滤系统数据库的方法。

我需要脚本在 2000/2005 和 2008 年工作。

如果我上面列出的方法是唯一的方法，我应该排除哪些名称列表？我不知道 2005 年或 2008 年是否在我的脑海中添加了任何新的系统数据库。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2015-02-18T17:46:13.523

今天再次对此进行调查，并决定分析 Management Studio 为填充对象资源管理器详细信息所做的工作。

![对象资源管理器 > 系统数据库](https://i.stack.imgur.com/wT2KJ.png)

事实证明，微软实施的解决方案非常简单，归结为以下几点：

```
SELECT *
FROM   master.sys.databases
WHERE  Cast(CASE WHEN name IN ('master', 'model', 'msdb', 'tempdb') THEN 1 ELSE is_distributor END As bit) = 0 
```

请注意，这是使用**SSMS 2008R2** (10.50.4033.0) 执行的。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-10-13T20:19:51.073

第一个查询将返回一个表，其中包含有关实例上所有数据库的数据：

```
Select * 
From sys.databases 
```

`WHERE`从该表中，您会注意到您可以使用该子句缩小要查找的数据范围。例如，以下查询将基本上返回相同的结果表（您最有可能寻找的那个）：

```
Select * 
From sys.databases 
Where database_id > 5

Select * 
From sys.databases 
Where len(owner_sid)>1 
```

这些查询将在 SQL Server 2008 和 2012 中工作。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2014-07-20T01:29:36.783

在 SQL Server 2008 R2 Express 上，看起来我无法可靠地使用上述任何方法。INFORMATION_SCHEMA.SCHEMATA 仅向我显示当前数据库中的信息，db_id (database_id) #5 是我的第一个用户数据库，我的一个镜像数据库（在 SQL Server 2008 R2 标准上运行）上的两个用户数据库上的 owner_sid 显示 owner_sid = 1 代表我最近创建的两个数据库。（上面 PablolnNZ 的评论是正确的：我没有为这两个数据库设置明确的所有者，所以它仍然显示为拥有 'sa' 的所有者。）

我能够使用的唯一可靠方法如下：

```
SELECT name FROM sys.databases
WHERE name NOT IN ('master', 'model', 'tempdb', 'msdb', 'Resource') 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-20T21:50:36.087

这在 2005 年有效，不能 100% 确定其他版本，但我认为它会成功。这有点小技巧，但可能会为您提供所需的东西：

```
 select * from sys.databases where len(owner_sid)>1 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-20T21:19:32.813

硬编码听起来很讨厌。对于几个 SQL 版本，系统数据库的名称和数量相当一致。但是，如果这太不愉快，您可以将它们半硬编码到一个表中，然后将其插入到您的查询中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-20T21:18:09.413

不知道你是否可以随手。请注意——在 2k 上，您必须使用 master.dbo.sysdatabases 而不是 master.sys.databases（2k 中不存在）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-06-05T13:02:34.533

从 SQL Server 2008 开始，您可以访问一个名为[sys.databases](https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-databases-transact-sql?view=sql-server-2017)的视图，当它与[sys.server_principals](https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-server-principals-transact-sql?view=sql-server-2017)结合时可以消除**sa**拥有的数据库，您可以（通常）安全地识别出“系统数据库”。因此，允许您过滤掉这些项目。

```
select
  d.name
  ,d.database_id
from
  sys.databases d
join
  sys.server_principals p
  on p.sid = d.owner_sid
where
  p.name <> 'sa'; 
```

# sql-server - 这是一个高效的 sql server 查询吗？

> ID：463122
> 
> 赞同：3
> 
> 时间：2009-01-20T21:08:05.393
> 
> 标签：sql-server, performance, tsql

如果我以这种格式编写存储过程，sql server 会有效地执行此操作，还是应该在服务器端（.net）上完成 sql“编织”？

注意：这只是我的查询的粗略概念，还有更多的 'if' 子句来构建我使用 'exec' 执行的查询

```
declare @sql nvarchar(4000)
declare @order nvarchar(4000)

set @sql = 'select id, name'
set @sql = @sql + ' ....' 

if(@sortOrder)
    set @order = 'order by name desc'

exec @sql + @order 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-20T21:13:25.570

为什么不按顺序使用 case 语句，而不是构建 SQL 字符串？

例如（假设一个在具有 FirstName 和 LastName 字段的表上按名字和/或姓氏排序）

```
order by
  case 
  when @sortExpression = 'lastname asc' then CAST(LastName as sql_variant)
  when @sortExpression = 'firstname asc' then CAST(FirstName as sql_variant)
  end asc,
  case
  when @sortExpression = 'lastname desc' then CAST(LastName as sql_variant)
  when @sortExpression = 'firstname desc' then CAST(FirstName as sql_variant)
  end desc 
```

此外，如果您的 order by 子句每次通过动态 SQL 都不同，则查询计划将永远不会被重用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-20T21:45:23.337

最清晰、最简单、最简单、最可优化的方法是为每个选项提供完整的 SQL 语句。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T21:26:15.997

我看到了两种更好的方法来做到这一点。我将在存储过程中使用实际的 SQL 语句，而不是使用动态 SQL 查询，由您想要订购的东西来区分：

```
select
  t.* 
from 
  table as t 
order by
  case @val
    when 1 then column1
    when 2 then column2
  end 
```

如果您发现 order by 过于动态并且必须构建，或者这样做更容易，那么我将创建一个返回集合的表值函数，然后针对它创建一个动态 sql 语句：

```
select
  t.*
from
  xfn_Function(@arg1, @arg2) as t
order by
  t.col1, t.col2 
```

当然，t.col1、t.col2 等是在您将整个内容发送到服务器之前动态生成的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T03:19:38.477

最有效的是从数据库中获取您想要的任何数据，然后在您的应用程序中处理排序。更改顺序不会改变数据量。如果用户更改了排序顺序，为什么还要再次访问数据库？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-26T21:25:57.687

To specifically answer your question, there will be no performance difference at all between a dynamic SQL statement which is formed in your .Net layer, and exactly the same SQL string which is formed inside a proc.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-20T21:11:25.793

您有充分的理由将其作为动态 SQL 执行吗？

我已经完成了您之前在 SQL Server 中所做的工作，并且工作正常；它可能比将完全形成的 SQL 传递给只是盲目地运行它的 proc 更安全（取决于使用情况）。

如果您使用的是 SQL 2k5 或 2k8，则可以使用 nvarchar(max) 处理更长的字符串。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-17T10:22:29.130

动态查询性能几乎等同于服务器端编织。如果您找不到任何其他方法来避免动态查询，请将其嵌套在服务器端。

如果您没有很多“ifs”，以下也适用

```
if(@sortorder = 'name') select id, name from tbl order by name asc
if(@sortorder = 'id') select id, name from tbl order by id asc 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-20T21:12:27.210

是的。

它在“exec”命令中编译。这之间的速度差异应该是最小的，并且在 .NET 端进行所有操作。

在某些时候，它会将 SQL 编译为一些内部代码。它可以在 .NET 推动它时发生，也可以在之后发生。

* * *

## 回答 #9

> 赞同：-5
> 
> 时间：2009-01-20T21:21:18.690

我将按照 ie 的顺序构建查询的其余部分。

```
@sql = 'SELECT id, name FROM myTable ORDER BY ' + @order 
```

...并将列名和方向传递给proc。这种方式更安全，因为不能将太多内容传递给 order by 子句来造成任何伤害。

要回答你的问题，是的，它是有效的。

# regex - 使用由定义标记分隔的正则表达式进行多次匹配

> ID：463132
> 
> 赞同：0
> 
> 时间：2009-01-20T21:11:31.643
> 
> 标签：regex

我有一个文本，我需要以定义的模式获取内容。*MARK1*和*MARK2*之间的内容以及*MARK2*之后的内容。但是，这些标记可以重复，我需要记录它们所有的出现。在下面的示例中：

```
text: "textA textB _MARK1_ textC _MARK2_ textD _MARK1_ textE textF _MARK2_ textG textH textI"

array(0): _MARK1_ textC _MARK2_ textD 
array(1): textC
array(2): textD
array(3): _MARK1_ textE textF _MARK2_ textG textH textI 
array(4): textE textF
array(5): textG textH textI 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T21:36:29.143

那将是：

```
/(_MARK1_(.*?)_MARK2_((?:(?!_MARK1_).)*))/g 
```

至少，它适用于您的测试用例的 RegEx Coach。
当然，您需要在每个匹配项上进行迭代。
请注意，它可能不适用于所有风格的正则表达式：例如，JavaScript 没有前瞻断言。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T21:18:28.867

我认为你不能用一个表达式来实现这一点。您可能需要将其分解为一个初始表达式，然后是一个循环，以针对第一个匹配的每次迭代执行第二个表达式匹配。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T21:21:26.753

我错过了什么或者这就是你要找的东西吗？

```
/(_MARK1_ (.*?) _MARK2 (.*?))*/ 
```

我对您希望如何处理空格做了一些任意假设，我意识到这些假设可能只是为了使您的示例案例更具可读性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T21:44:17.007

我不确定您是否真的需要阵列中的分隔标记。除非您有特定的规范，否则该部分似乎是多余的。此解决方案假定您并不真正需要它。既然你没有指定语言，那么 Perl 呢？

```
use Data::Dumper;
my $text = 'textA textB _MARK1_ textC _MARK2_ textD _MARK1_ textE textF _MARK2_ textG textH textI';
my @results = $text =~ m/(?<=_MARK1_|_MARK2_)(.*?)(?=_MARK1_|_MARK2_|$)/g;
print Data::Dumper::Dumper @results; 
```

但是，没有理由尝试使用正则表达式的一般情况。请改用解析器。

# javascript - 使用 javascript 键入时缩小项目列表

> ID：463143
> 
> 赞同：8
> 
> 时间：2009-01-20T21:15:11.293
> 
> 标签：javascript, jquery, forms, plugins, autocomplete

我正在尝试找到一个插件或一种可靠的方法来缩小用户类型的项目列表。

本质上，会有一个始终可见的列表，其中包含供用户滚动浏览的产品名称。底部是一个表格，您可以在其中输入产品名称。当您键入时，列表会缩小。

我一直在尝试找到一种方法来调整像 jQuery UI 的自动完成这样的东西以这种方式工作，但是遇到了一些麻烦。

有人以前创造过这样的东西或有任何想法吗？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-20T21:32:11.303

这是一个可行的方法的快速示例：

HTML：

```
<ul id="products">
    <li>Apple</li>
    <li>Banana</li>
    <li>Mango</li>
</ul>
<input id="filter" /> 
```

jQuery：

```
var $products = $('#products li');
$('#filter').keyup(function() {
    var re = new RegExp($(this).val(), "i"); // "i" means it's case-insensitive
    $products.show().filter(function() {
        return !re.test($(this).text());
    }).hide();
}); 
```

这是一种简单的方法，可能需要进行一些调整，但它接近您的需要。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-21T15:02:11.467

快速搜索插件怎么样[？](https://github.com/riklomas/quicksearch "快速搜索")

# php - 当 cURL 数据 > 1024 时 PHP HTTP POST 失败

> ID：463144
> 
> 赞同：12
> 
> 时间：2009-01-20T21:15:23.070
> 
> 标签：php, http, post, curl

**注：解决方案在最后**

如果我尝试执行超过 1024 个字符的 HTTP POST，它会失败。为什么？这是一个最小的例子：

收件人.php：

```
<?php
if (strlen(file_get_contents('php://input')) > 1000
    || strlen($HTTP_RAW_POST_DATA) > 1000) {
 echo "This was a triumph.";
}
?> 
```

发件人.php：

```
<?php
function try_to_post($char_count) {
 $url = 'http://gpx3quaa.joyent.us/test/recipient.php';
 $post_data = str_repeat('x', $char_count);
 $c = curl_init();
 curl_setopt_array($c,
                    array(  CURLOPT_URL => $url,
                            CURLOPT_HEADER => false,
                            CURLOPT_CONNECTTIMEOUT => 999,
                            CURLOPT_RETURNTRANSFER => true,
                            CURLOPT_POST => 1,
                            CURLOPT_POSTFIELDS => $post_data
                    )
 );
 $result = curl_exec($c);
 echo "{$result}\n";
 curl_close($c);
}

for ($i=1020;$i<1030;$i++) {
 echo "Trying {$i} - ";
 try_to_post($i);
}
?> 
```

输出：

```
Trying 1020 - This was a triumph.
Trying 1021 - This was a triumph.
Trying 1022 - This was a triumph.
Trying 1023 - This was a triumph.
Trying 1024 - This was a triumph.
Trying 1025 - 
Trying 1026 - 
Trying 1027 - 
Trying 1028 - 
Trying 1029 - 
```

配置：

```
PHP Version 5.2.6
libcurl/7.18.0 OpenSSL/0.9.8g zlib/1.2.3 libidn/1.8
lighttpd-1.4.19 
```

**解决方案**

为 cURL 添加以下选项：

```
curl_setopt($ch,CURLOPT_HTTPHEADER,array("Expect:")); 
```

原因似乎是任何超过 1024 个字符的 POST 都会导致发送“Expect: 100-continue”HTTP 标头，而 Lighttpd 1.4.* 不支持它。我找到了一张票：[http ://redmine.lighttpd.net/issues/show/1017](http://redmine.lighttpd.net/issues/show/1017)

他们说它适用于1.5。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-20T21:48:55.687

您可以通过设置显式请求标头来说服 PHP 的 curl 后端停止执行 100-continue-thing：

```
curl_setopt($ch, CURLOPT_HTTPHEADER, array('Expect:')); 
```

这样，您可以发布请求，无论您想要多长时间，并且 curl 不会执行双阶段发布。

大约两年前，我在[博客上写过这个。](http://www.gnegg.ch/2007/02/the-return-of-except-100-continue/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-20T21:27:19.707

## 最初的想法...

[curl_setopt](http://php.net/curl_setopt)的手册页说 CURLOPT_POSTFIELDS

> “要在 HTTP“POST”操作中发布的完整数据。要发布文件，请在文件名前面加上 @ 并使用完整路径。这可以作为 urlencoded 字符串传递，例如 'para1=val1¶2=val2&...'或以字段名称为键，字段数据为值的数组。”

可能是您的值被视为已被 urlencoded 处理，因此看起来像一个没有价值的大长名称。某处决定截断该名称。

也许你可以把它改成类似

```
$post_data = "data=".str_repeat('x', $char_count); 
```

事实证明这太容易了，而且问题更深一些。那么，如何调试呢？

## 准确找出 CURL 发送到服务器的内容

另一种调试策略可能是制定一个 curl 命令行来实现相同的目标，并让它在生成 HTTP 请求时输出它们的详细信息。

## 手动测试服务器

您可以通过手动执行请求来消除等式中的服务器，例如远程登录到服务器上的端口 80 并向其发送 >1024 个字符的请求

```
POST /test/recipient.php HTTP/1.0
Host: gpx3quaa.joyent.us
Content-Length:1028

xxxxx(I put 1028 chars here, no point copying them all here!) 
```

我收到了这个回复

```
HTTP/1.0 200 OK
Connection: close
Content-type: text/html; charset=UTF-8
Content-Length: 19
Date: Tue, 20 Jan 2009 21:35:16 GMT
Server: lighttpd/1.4.19

This was a triumph.Connection closed by foreign host. 
```

所以至少你现在知道这一切都在客户端，可能是某个 CURL 选项或配置设置:(

## 最终答案！

这个问题引起了我的兴趣，所以我挖得更深

如果您使用`CURLOPT_VERBOSE=>true`，您会看到 CURL 在较大的帖子上发送一个额外的标题：`Expect: 100-Continue`. 您的 lighttpd 服务器似乎不喜欢这样。

`CURLOPT_HTTP_VERSION=>CURL_HTTP_VERSION_1_0`您可以通过在 curl_setopt 选项数组中强制 CURL 使用 HTTP/1.0 来阻止 CURL 执行此操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-05T17:18:43.390

我在使用 SSL v3 的 IIS 服务器上遇到了类似的问题。

当 CURLOPT_POSTFIELDS 长于 1024 时，我不断收到以下 cURL 错误：

```
52 - SSL read: error:1408F10B:SSL routines:SSL3_GET_RECORD:wrong version number, errno 0 
```

添加 CURLOPT_HTTPHEADER : "Expect:" 为我解决了这个问题。

非常感谢这个话题！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-04T14:45:50.287

检查您是否启用了 Suhosin 补丁。默认情况下，它会在一定数量的索引后切断 POST 数据。您可以在 Suhosin 配置中绕过它。

# asp.net - ASP.net：你能从 GridView 的编辑按钮调用 ModalPopupExtender 吗？

> ID：463146
> 
> 赞同：0
> 
> 时间：2009-01-20T21:15:45.597
> 
> 标签：asp.net, ajax

`GridView`您可以从控件的自动生成的编辑按钮调用模式弹出窗口吗？有人可以提供有关如何执行此操作的链接吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-20T21:33:20.193

Matt Berseth 有几篇文章涵盖了这个主题：

[马特的博客](http://mattberseth.com/blog/modalpopupextender/)

# c# - 三元运算符是如何工作的？

> ID：463155
> 
> 赞同：8
> 
> 时间：2009-01-20T21:18:14.780
> 
> 标签：c#, java, c, ternary-operator

请演示三元运算符如何与常规 if/else 块一起使用。例子：

```
Boolean isValueBig = value > 100 ? true : false; 
```

* * *

**完全重复：** [如何使用三元运算符？](https://stackoverflow.com/questions/392932/how-do-i-use-the-ternary-operator)

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-20T21:19:50.270

```
Boolean isValueBig = ( value > 100  ) ? true : false;

Boolean isValueBig;

if(  value > 100 ) { 
      isValueBig = true;
} else { 
     isValueBig = false;
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-20T21:25:44.640

三元运算和 if/else 的区别在于，三元表达式是一个求值的语句，而 if/else 不是。

要使用您的示例，从使用三元表达式更改为 if/else 您可以使用以下语句：

```
Boolean isValueBig = null;
if(value > 100)
{ 
    isValueBig = true 
}
else
{
    isValueBig = false;
} 
```

但是，在这种情况下，您的陈述等同于：

```
Boolean isValueBig = (value > 100); 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-20T21:21:27.643

当我刚接触 C++ 时，我发现它有助于阅读这个结构，如下所示：

```
Boolean isValueBig = if condition ? then x else: y; 
```

（请注意，这不是有效的代码。这只是我训练自己在脑海中阅读的内容。）

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-20T21:20:53.823

```
Boolean isValueBig;

if (value > 100)
{
   isValueBig = true;
}
else 
{
   isValueBig = false;
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-20T21:40:38.807

我从来都不是三元运算符的粉丝，因为我认为它很难阅读。碰巧的是，Jon Skeet 和他的书，*C# in Depth*终于击中了这只老狗的头，让它沉入水中。Jon 说，我解释一下，把它当作一个问题。

> 值 > 100？
> 
> “是”：“不是”

现在盲人可以看见了。

希望这可以帮助您使其成为第二天性。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-01-20T21:19:56.820

```
Boolean isValueBig;

if(value > 100) { isValueBig = true; } else { isValueBig = false; } 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-20T21:30:04.570

[正如?: Operator MSDN page](http://msdn.microsoft.com/en-us/library/ty67wk28(VS.80).aspx)所引用的，“条件运算符 (?:) 根据布尔表达式的值返回两个值之一。”

因此，您可以使用三元运算符返回的不仅仅是布尔值：

```
 string result = (value > 100 ) ? "value is big" : "value is small"; 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-20T21:19:47.647

**PHP 示例**

```
<?php

  // Example usage for: Ternary Operator
  $action = (empty($_POST['action'])) ? 'default' : $_POST['action'];

  // The above is identical to this if/else statement
  if (empty($_POST['action'])) {
    $action = 'default';
  } else {
    $action = $_POST['action'];
  }

?> 
```

> “表达式*(expr1) ? (expr2) : (expr3)*如果*expr1*计算为**TRUE**则计算为*expr2*，如果*expr1*计算为**FALSE则为***expr3*。”

 *******[关于比较运算符的 PHP 文档](http://us.php.net/manual/da/language.operators.comparison.php)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-21T19:03:24.083

不好的例子，因为你可以很容易地写

```
Boolean isValueBig = value > 100 ? true : false; 
```

作为：

```
bool isValueBig = value > 100 
```

除此之外，其他人都已经回答过了。我只是不建议使用三元运算符来设置布尔值，因为您正在评估的已经是一个布尔值。

我意识到这只是一个例子，但值得指出。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-01-21T19:07:49.957

确保不要在 Java 的真/假部分中混合类型。它产生奇怪的结果:-(

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-21T20:02:38.503

其他人已经回答了这个问题，但是关于三元的用法，你应该真正了解一件事，我的意思是永远不要这样做。

让我们假设您有一段代码应该为某个值的每个可能变化返回一个不同的对象，为了简单起见，假设一个介于 1 和 5 之间的整数。您的代码如下所示：

```
if(i==1) {
    return new ObjectOne();
} else if(i==2) {
    return new ObjectTwo();
} else if(i==3) {
    return new ObjectThree();
} else if(i==4) {
    return new ObjectFour();
} else if(i==5) {
    return new ObjectFive();
} else {
    return new DefaultObject();
} 
```

这很容易理解，但有点沉重。因为*三元只是另一种编写 if..else 语句的方式*，可以重构为

```
return (i==1) ? new ObjectOne() :
       (i==2) ? new ObjectTwo() :
       (i==3) ? new ObjectThree() :
       (i==4) ? new ObjectFour() :
       (i==5) ? new ObjectFive() : new DefaultObject(); 
```

它被称为**嵌套三元**。它是邪恶的，既然你知道它，请永远不要使用它。它可能看起来像上面的例子一样有它的用途，但很可能在现实生活中你需要在它失去可读性的地方使用它（想想用可变数量的参数等来改变配置）。

奖励部门：永远不要在 if() 中设置属性值，看看这个：`if(bool=true!=false) { .. }`

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-16T15:35:27.063

引用自 MSDN（在上一篇文章中提到）

字符串结果 =（值 > 100）？"价值大" : "价值小";

可以读作：

值是否大于 100？如果是，则字符串结果为“值大”，如果否，则字符串结果为“值小”。

# c# - 在不了解服务器配置的情况下发送电子邮件的 C# 代码？

> ID：463176
> 
> 赞同：9
> 
> 时间：2009-01-20T21:24:10.430
> 
> 标签：c#, email, configuration, smtp

有没有办法在 C# 代码中发送电子邮件而不必知道服务器上的 SMTP 服务器配置等，或者设置任何这些东西？

我正在开发的代码将部署到实时服务器，但我对配置一无所知，所以我无法预测 SMTP 服务器将是什么。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-20T21:28:53.697

将此添加到您的 web.config（[此处为 MSDN 参考](http://msdn.microsoft.com/en-us/library/ms164240.aspx)）：

```
<system.net>
    <mailSettings>
        <smtp deliveryMethod="Network" from="jdoe@example.com">
            <network host="localhost" port="25" />
        </smtp>
    </mailSettings>
</system.net> 
```

在不指定配置设置的情况下使用 SmtpClient 将使用 web.config 中的值：

```
MailMessage msg = new MailMessage(...);
// build message contents
SmtpClient client = new SmtpClient();
client.Send(msg); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-20T21:35:21.297

不久前我回答了一个类似的问题。你可以[在这里查看](https://stackoverflow.com/questions/357543/good-way-to-test-email-functionality#358157)。使用[papercut](http://papercut.codeplex.com/)，您可以在不知道或使用实际生产 smtp 服务器的情况下测试您的应用程序。

然后在测试期间，您可以将主机设置为在 app/web 配置中运行剪纸的本地机器。因此，一旦投入生产，就可以对其进行更改。

Papercut 将向您显示已发送的电子邮件以及内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T21:28:26.477

最好的答案是，如果您在直播之前一无所知，您可以将所有设置移至 web.config 中吗？这将允许配置直到最后一分钟。下面是一些转储到 web.config 文件中的代码。我会质疑为什么您无权访问此信息

```
<system.net>
    <mailSettings>
      <smtp from="you@yourdomain.com">
        <network host="SMTP SERVER ADDRESS" port="25"
         userName="USERNAME" password="PASSWORD">
      </smtp>
    </mailSettings>
  </system.net> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T21:28:33.963

如果您的 SMTP 配置正确，请执行以下操作：

```
MailMessage mail = new MailMessage(); 

mail.To = "To"; 
mail.From = "From"; 
mail.Subject = "Subject";     
mail.Body = "Body"; 

SmtpMail.SmtpServer = "localhost"; 
SmtpMail.Send(mail); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-20T21:42:01.957

作为替代方案：如果您不想依赖服务器配置并以编程方式进行操作，您可以随时执行以下操作：

```
MailMessage mail = new MailMessage() {
    To = "someone@somewhere",
    From = "someone@somewhere",
    Subject = "My Subject",
    Body = "My message"
};

SmtpClient client = new SmtpClient("SMTP Server Address");
    // Naturally you change the "SMTP Server Address" to the
    // actual SMTP server address
client.Send(mail); 
```

但我建议您将其粘贴在 web.config 文件中（也可以通过 ASP.NET Web 配置工具进行配置）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-08-07T09:49:10.247

从谷歌试试这个

[http://mailsystem.codeplex.com/](http://mailsystem.codeplex.com/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-02-21T01:26:33.887

是的，您可以使用 SMTP4Dev 之类的工具来“发送”电子邮件，而根本不需要 SMTP 服务器。我经常使用它进行测试，以确保我实际上不会错误地向真实用户发送电子邮件。

更多信息@ [http://netdevtools.com/how-to-test-smtp-emails-without-a-mail-server-no-smtp-configuration-required-in-asp-net-c/](http://netdevtools.com/how-to-test-smtp-emails-without-a-mail-server-no-smtp-configuration-required-in-asp-net-c/)

# c# - 您可以在 .NET 中异步更改母版页的 ContentPlaceHolder 的内容页吗？

> ID：463177
> 
> 赞同：2
> 
> 时间：2009-01-20T21:24:26.857
> 
> 标签：c#, .net, ajax, master-pages, postback

从我已经读过的内容来看，这似乎是不可能的，但我想看看是否有人在他们的袖子里有一个秘密的把戏，或者至少是一个明确的“不”。

假设母版页实际上只是供内容页使用的控件，而不是内容页的“母版”。如果我想从一个内容页面转到另一个具有相同母版页的内容页面，我会说

```
Response.Redirect("PageB.aspx"); 
```

但这会立即导致回发，闪烁页面，这是糟糕的 pre-ajax 做事方式。

在这个当前项目中，我试图看看我是否可以弄清楚如何在母版页上单击按钮时异步更改母版页中 ContentPlaceHolder 的当前内容页。

这可能吗，如果可以，怎么办？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T21:30:50.637

我不知道您是否可以在页面之间（.aspx），但绝对可以使用 UserControls 来完成。

每个 ASP.Net 页面都有自己的 URL，因此您要做的是从一个 URL 转到另一个 URL，而无需任何回发，这不是它应该如何工作的。

* * *

**使用用户控件 (.ascx)：**

创建一个使用 MasterPage 的页面并在内容中使用类似的内容

```
<ajax:UpdatePanel ...>

    <ContentTemplate>

        <asp:PlaceHolder ...>

    </ContentTemplate>

</ajax:UpdatePanel> 
```

搜索 UpdatePanel 并调整其设置以执行您想要的操作，然后了解如何在占位符中交换用户控件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-02T17:56:43.800

**不**，您不能，因为母版页实际上是呈现在特定 aspx 页面上的控件，而不是实际包含 aspx 页面，因为它看似以编程方式和设计视图显示。

**更多信息：**

但是，您可以使用各种其他控件来模拟此效果。asp:MultiView 控件就是一个例子，每个“页面”可以在单个视图中制作并放置在更新面板中，从而允许异步切换。或者，您可以在单独的用户控件中定义每个页面并将其放在更新面板中，根据需要异步切换这些控件上的可见属性。

确实有很多不同的方法可以实现类似于更改母版页内容占位符的效果。

# flash - 如何使用 flash actionscript 2 更改文本颜色？

> ID：463189
> 
> 赞同：5
> 
> 时间：2009-01-20T21:27:19.287
> 
> 标签：flash, actionscript, text, colors

如何使用 flash actionscript 2 更改文本颜色？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-20T21:37:00.157

myTextField.textColor = 0x634634

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T01:12:13.570

myTextField.textColor = 0x634634

这行得通，而且是最简单的，为什么还要为额外的废话而烦恼呢？

# winapi - 如何巧妙地通知用户他的输入已收到

> ID：463192
> 
> 赞同：3
> 
> 时间：2009-01-20T21:27:59.083
> 
> 标签：winapi, notifications

我正在编写一个在特定应用程序中加载时自动注入的 DLL。因为我想在处理程序的同时运行程序，并且我的用户可能希望在特定情况下（例如寻找错误）加载没有它的程序，所以有时我想阻止加载 DLL。目前，我通过在加载时检查 VK_LCONTROL、VK_LSHIFT 和 VK_LMENU 的 GetKeyState 来执行此操作，如果全部关闭，我会默默地卸载自己。但是，加载程序并查看是否加载了 DLL 可能需要几秒钟，所以我想在我们卸载时通知用户。我考虑过 MessageBox，但这太具有破坏性了。我已经尝试过 MessageBeep，但这似乎对我的设置没有任何作用。目前我正在使用一个简单的双哔声（哔声，睡眠，哔声）来指示卸载，但这对我的同事来说可能会变得相当烦人。我还考虑了一个系统托盘图标，但这会引入大量代码和潜在的错误，而我的目标是尽量减少通知，以免引入任何微妙的错误。

其他人会知道一种微妙的方式（最好是视觉方式）来通知用户他们的输入已被成功接收吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-20T21:47:35.190

鉴于您的目标范围有限，这实际上可能是适当使用[任务栏通知气球提示](http://social.msdn.microsoft.com/Forums/en-US/vclanguage/thread/15cbdc8d-fde3-44ab-bbbc-e50cb2071674/)。

编辑：添加了乔在他同意的答案中发布的链接。谢谢，乔！:)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-20T21:35:12.437

如果您的应用底部有一个状态栏，您可以在其中放置一些消息文本...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T21:43:04.183

您是否考虑过会自行关闭的定时消息框？

[http://www.codeguru.com/cpp/misc/misc/messageboxhandling/article.php/c203](http://www.codeguru.com/cpp/misc/misc/messageboxhandling/article.php/c203)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T21:46:29.967

更改窗口标题，然后再将其更改回来。然后，即使用户同时将 Alt-Tabbed 切换到其他程序，您也可以看到更改，而不会从用户那里窃取焦点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-20T21:52:07.363

同意 Greg D.

看这里：[http ://social.msdn.microsoft.com/Forums/en-US/vclanguage/thread/15cbdc8d-fde3-44ab-bbbc-e50cb2071674/](http://social.msdn.microsoft.com/Forums/en-US/vclanguage/thread/15cbdc8d-fde3-44ab-bbbc-e50cb2071674/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-20T21:42:38.927

您可以打开一个带有短消息的窗口并在 0.5 秒左右后再次自动关闭它。它不需要用户交互，所以我认为它不会造成很大的破坏。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-08-23T21:51:17.020

两个想法：

1.  扭转局面。*加载 DLL时*有视觉指示，如果没有指示符，则让您知道 DLL 已被卸载。也许是标题栏中的后缀。这样一来，您就可以随时进行判断，而不仅仅是在启动期间。

2.  [FlashWindowEx](http://msdn.microsoft.com/en-us/library/ms679347(v=VS.85).aspx)。

# java - 使用 Java 服务时出现 WCF 客户端错误

> ID：463194
> 
> 赞同：4
> 
> 时间：2009-01-20T21:28:16.133
> 
> 标签：java, wcf

我目前正在开发一个需要使用 Java Web 服务的项目。如果我使用旧的 web 服务 (asmx) 连接到服务，它工作正常。但是，如果我尝试对 WCF 客户端执行相同的操作，则会收到以下错误：

内容类型 text/xml；响应消息的 charset=utf-8 与绑定的内容类型不匹配 (application/soap+xml; charset=utf-8)。如果使用自定义编码器，请确保正确实现 IsContentTypeSupported 方法。

我的非常简单，如下所示：

```
//classic web service
OldSkoolService.HelloService serviceCall = new esb_wsdlsample.OldSkoolService.HelloService();
Console.WriteLine(serviceCall.SoapVersion);
Console.WriteLine(serviceCall.sayHello("something"));

HelloServiceClient prototypeClient = new HelloServiceClient();
var serviceChannel = prototypeClient.ChannelFactory;

Console.WriteLine(serviceChannel.Endpoint.Binding.MessageVersion);
Console.WriteLine(prototypeClient.sayHello("somethinge")); //<-- Error occurs here 
```

绑定/端点配置文件也很简单：

```
<bindings>
  <customBinding>
    <binding name="Soap12Binding">
      <textMessageEncoding messageVersion="Soap12"/>
      <httpTransport />              
    </binding>
  </customBinding>        
</bindings>
<client>
    <endpoint address="http://10.10.6.51:7001/esb/HelloService" behaviorConfiguration=""
        binding="customBinding" bindingConfiguration="Soap12Binding" contract="Prototype.ESB.HelloService"
        name="HelloServicePort" />          
</client> 
```

作为旁注，我正在尝试使用soap 1.2，因为我需要能够从服务中捕获异常。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T08:21:29.263

根据您的错误消息，它只是意味着您的服务器响应消息是 SOAP 1.1，而您期望 SOAP 1.2。

您必须在客户端上更改为 SOAP 1.1（使用 BasicHttpBinding，至少进行测试并查看它是否以这种方式工作）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T21:54:13.380

虽然 SOAP 1.2 规范没有*要求*，但建议（即**应该**）SOAP 消息使用 application/soap+xml 的内容类型。

您应该在服务器端更改它。如果不是，那么我认为您将不得不摆弄配置文件中的 textMessageEncoding 绑定元素以使其接受 text/xml 内容类型。

# javascript - 如何在 DOM 中“刷新”元素？

> ID：463197
> 
> 赞同：2
> 
> 时间：2009-01-20T21:28:38.863
> 
> 标签：javascript, dom

我有一个空的 DIV 元素，我在其中使用函数 createElement("img") 附加图像并使用 appendChild 附加它们。所以现在我有了充满图像的 DIV 元素。

我想使用一个按钮来清理这个 DIV 并同时在其中添加新图像。谢谢你的帮助

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-20T21:34:53.000

你只是在寻找方法吗`replaceChild? Or you could remove all child elements before adding new images:`

```
// assuming yor div is in variable divelement
while (divelement.firstChild)
  divelement.removeChild(divelement.firstChild); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-20T21:31:23.897

你说的干净是什么意思？如果你只想清空它，你可以这样做

```
document.getElementById('mydiv').innerHTML = ''; 
```

然后添加您想要的任何新图像。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-20T21:39:30.870

虽然在循环中设置 innerHTML 和调用 removeChild() 都会清除 DIV 中的内容，但由于当今浏览器的性质，innerHTML 方法将会快得多。

# c# - 有人有所有 Visual Studio C# 编译指示名称的列表吗？

> ID：463201
> 
> 赞同：1
> 
> 时间：2009-01-20T21:29:13.993
> 
> 标签：c#, language-features, annotations, pragma

在 C++ 中，有一个 #pragma 可以输出到构建日志。Visual Studio 2005 C# 是否存在？而且，有谁知道在哪里可以找到所有#pragma 名称的实际列表？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-20T21:35:53.573

根据[文档](http://msdn.microsoft.com/en-us/library/x74w198a.aspx)，编译器必须支持编译指示，目前只支持两个：校验和和警告。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-20T21:38:01.963

[msdn 上的此链接](http://msdn.microsoft.com/en-us/library/ed8yd1ha.aspx)列出了所有 C# 预处理器指令，并详细介绍了它们的使用方式。

```
#if
#else 
#elif 
#endif 
#define 
#undef 
#warning 
#error 
#line 
#region 
#endregion 
#pragma 
#pragma warning 
#pragma checksum 
```

只有`warning`和`checksum`是 C# 编译器支持`#pragma`的指令。

# .net - VB.NET 中的“阴影”与“覆盖”

> ID：463209
> 
> 赞同：65
> 
> 时间：2009-01-20T21:32:06.657
> 
> 标签：.net, vb.net, oop, overriding, shadows

[Shadows](http://msdn.microsoft.com/en-us/library/1h3wytf6.aspx)和[Overrides](http://msdn.microsoft.com/en-us/library/k777kzw1.aspx)这两个关键字的意义是什么？他们做什么以及在哪种情况下更可取？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-02-04T17:44:01.103

**Overrides**是更正常的限定符。如果子类以这种方式重新定义基类函数，那么无论如何引用子对象（使用基类或子类引用），调用的都是子函数。

另一方面，如果子类函数**隐藏**基类函数，则通过基类引用访问的子对象将使用该基类函数，尽管它是子对象。
仅当使用匹配的子引用访问子对象时才使用子函数定义。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2010-12-08T18:09:24.107

阴影可能不会像您认为的那样做。

考虑以下类：

```
Public MustInherit Class A 
    Public Function fX() As Integer
        Return 0
    End Function
End Class

Public Class B
    Inherits A 
    Public Shadows Function fX() As Integer
        Return 1
    End Function 
End Class 
```

现在我使用它们：

```
Dim oA As A
Dim oB As New B
oA = oB 
```

您可能认为 oA 和 oB 是一样的吧？

没有。

oA.fx = 0 而oB.fx = 1

恕我直言，这是非常危险的行为，文档中几乎没有提到。

如果您使用了覆盖，它们将是相同的。

因此，虽然阴影有合法用途，但很可能你所做的一切都不是其中之一，应该避免。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-20T22:32:04.740

覆盖 - 为方法扩展或创建替代功能。

示例：添加或扩展窗口的 Paint 事件的功能。

```
 Protected Overrides Sub OnPaint(ByVal e As System.Windows.Forms.PaintEventArgs)
        MyBase.OnPaint(e) ' retain the base class functionality
        'add code for extended functionality here
    End Sub 
```

Shadows - 重新定义继承的方法并强制使用该类型实例化的所有类。换句话说，该方法没有重载而是重新定义，并且基类方法不可用，从而强制使用类中声明的函数。Shadows 保留或保留方法的定义，以便在修改基类方法时不会破坏它。

示例：强制所有“B”类使用其奇怪的 Add 定义，这样如果 A 类的 Add 方法被修改，则不会影响 B 的 add。（隐藏所有基类“Add”方法。将无法从 B 的实例调用 A.Add(x, y, z)。）

```
 Public Class A
        Public Function Add(ByVal x As Integer, ByVal y As Integer) As Integer
            Return x + y
        End Function
        Public Function Add(ByVal x As Integer, ByVal y As Integer, ByVal z As Integer) As Integer
            Return x + y + z
        End Function
    End Class
    Public Class B
        Inherits A
        Public Shadows Function Add(ByVal x As Integer, ByVal y As Integer) As Integer
            Return x - y
        End Function
    End Class 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2014-04-22T14:50:17.550

有时，一个小例子确实有助于从技术上理解差异。

```
Sub Main()

    Dim o As New ChildClass

    Console.WriteLine(o.GetValOverride()) ' Prints 2
    Console.WriteLine(o.GetValShadow()) ' Prints 2
    Console.WriteLine(CType(o, ParentClass).GetValOverride()) ' Prints 2
    Console.WriteLine(CType(o, ParentClass).GetValShadow()) ' Prints 1
    Console.ReadLine()

End Sub

Class ParentClass

    Public Overridable Function GetValOverride() As String
        Return "1"
    End Function

    Public Function GetValShadow() As String
        Return "1"
    End Function

End Class

Class ChildClass
    Inherits ParentClass

    Public Overrides Function GetValOverride() As String
        Return "2"
    End Function

    Public Shadows Function GetValShadow() As String
        Return "2"
    End Function

End Class 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-09-24T14:49:49.947

遮蔽的一个例子：假设您想在第三方组件中使用一个函数，但该函数是受保护的。您可以通过简单的继承绕过此约束并公开一个基本上调用其基函数的阴影函数：

```
Public Class Base

    Protected Sub Configure()
        ....
    End Sub

End Class

Public Class Inherited
    Inherits Base

    Public Shadows Sub Configure()
        MyBase.Configure()
    End Sub

End Class 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-12-20T19:13:15.223

“shadows”关键字本质上是说“如果访问此对象的人知道它属于这种类型或其后代之一，则使用此成员；否则使用基成员。” 最简单的例子可能是基类 ThingFactory，它包括一个返回 Thing 的“MakeNew”方法和一个派生自 ThingFactory 的类 CarFactory，其“MakeNew”方法总是返回一个派生类型 Car 的 Thing。如果例程知道它持有的 ThingFactory 恰好是 CarFactory，那么它将使用影子 CarFactory.MakeNew（如果存在），它可以将返回类型指定为 Car。如果一个例程不知道它的 ThingFactory 实际上是一个 CarFactory，

顺便说一句，阴影的另一个很好的用途是防止派生类访问将不再起作用的受保护方法。除了分配一个新成员之外，没有办法简单地从派生类中隐藏一个成员，但是可以通过声明一个具有该名称的新受保护空类来防止派生类对受保护成员执行任何操作。例如，如果在一个对象上调用 MemberwiseClone 会破坏它，可以声明：

```
  受保护的阴影类 MemberwiseClone
  结束类

```

请注意，这并不违反诸如 Liskov 替换原则之类的 OOP 原则，因为这仅适用于可能使用派生类代替基类对象的情况。如果 Foo 和 Bar 继承自 Boz，则接受 Boz 参数的方法可以合法地传递到 Foo 或 Bar 中。另一方面，Foo 类型的对象会知道它的基类对象是 Boz 类型。它永远不会是其他任何东西（例如，它保证不是酒吧）。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-09-29T20:27:12.690

我认为人们在这里确实有两种情况，两者都是合法的。您真的可以将它们分解为基类设计者和多年后实现无法修改基类的子类的开发人员。所以，是的，如果你有这种奢侈，最好的办法就是超越。这是干净的OOD方法。

另一方面，您可能有类似上面给出的示例，在该等式的另一端，您必须实现一个子类，并且您无法更改您需要覆盖的方法未标记为可覆盖的事实。举个例子

```
Public Shadows Function Focus() As Boolean
    txtSearch.Focus()
    Return MyBase.Focus()
End Function 
```

在这种情况下，我从 Winform 控件类继承了我的类，不幸的是它没有被标记为可覆盖。在这一点上，我面临着只是让代码“纯粹”或让它更容易理解。此控件的客户端只是想调用 control.Focus() 并且可能不在乎。我可以将这个方法命名为 FocusSearchText() 或 Focus2 等，但我相信上面的方法对于客户端代码来说要简单得多。确实，如果客户端随后将此控件转换为基类并调用 Focus，我的代码将不会执行。但那是相当遥远的。

最后，它归结为一个判断电话，一个你必须做出的决定。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-12-03T05:54:26.380

这是最近的 MSDN 链接： [Differences between shadowing and overriding](http://msdn.microsoft.com/en-us/library/ms172785%28VS.100%29.aspx "阴影和覆盖之间的区别")

*阴影可防止后续基类修改引入您已在派生类中定义的成员。通常在以下情况下使用阴影：*

** 您预计您的基类可能会被修改以使用与您的名称相同的名称来定义一个元素。*

** 您希望自由更改元素类型或调用顺序。*

（我还没有调查范围和类型的使用情况）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-07-06T10:19:54.803

那么这里是代码的答案。

```
Module Module1

    Sub Main()
        Dim object1 As Parent = New Child()
        Console.WriteLine("object1, reference type Parent and object type Child")
        object1.TryMe1()
        object1.TryMe2()
        object1.TryMe3()

        Console.WriteLine("")
        Console.WriteLine("")
        Console.WriteLine("object2, reference type Child and object type Child")
        Dim object2 As Child = New Child()

        object2.TryMe1()
        object2.TryMe2()
        object2.TryMe3()

        Console.ReadLine()
    End Sub

End Module

Public Class Parent

    Public Sub TryMe1()
        Console.WriteLine("Testing Shadow: Parent.WriteMe1")
    End Sub

    Public Overridable Sub TryMe2()
        Console.WriteLine("Testing override: Parent.WriteMe2")
    End Sub

    Public Sub TryMe3()
        Console.WriteLine("Testing Shadow without explicitly writing shadow modifier: Parent.WriteMe3")
    End Sub
End Class

Public Class Child
    Inherits Parent

    Public Shadows Sub TryMe1()
        Console.WriteLine("Testing Shadow: Child.WriteMe1")
    End Sub

    Public Overrides Sub TryMe2()
        Console.WriteLine("Testing override: Child.WriteMe2")
    End Sub

    Public Sub TryMe3()
    Console.WriteLine("Testing Shadow without explicitly writing shadow modifier: Child.WriteMe3")
    End Sub
End Class

'Output:
'object1, reference type Parent and object type Child
'Testing Shadow: Parent.WriteMe1
'Testing override: Child.WriteMe2
'Testing Shadow without explicitly writing shadow modifier: Parent.WriteMe3

'object2, reference type Child and object type Child
'Testing Shadow: Child.WriteMe1
'Testing override: Child.WriteMe2
'Testing Shadow without explicitly writing shadow modifier: Child.WriteMe3 
```

您可以复制粘贴并自己尝试。如您所见，阴影是默认行为，Visual Studio 会在您进行阴影时发出警告，而无需您显式编写阴影修饰符。

注意：对我来说，我从未使用过对子对象的基类引用。对于这种情况，我总是使用接口。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-10-04T17:24:15.603

Shadow 允许您执行某些无法通过覆盖完成的事情。

在我自己的情况下：我有几个具有通用功能的表类；但是对于他们来说，藏品本身是不同的类型。

```
Public Class GenericTable
Protected Friend Overridable Property Contents As System.Collections.Generic.List(Of GenericItem)
    ... do stuff ...
End Class 
```

然后我有具体的实例：

```
Public Class WidgetTable
Inherits GenericTable
Protected Friend Shadows Property Contents As System.Collections.Generic.List(Of Widget)
    ... stuff is inhereted ...
End Class 
```

我无法覆盖，因为类型已更改。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-01-26T10:05:05.873

我发现了另一个不同之处。看到这个：

```
Sub Main()
    Dim X As New Derived
    Dim Y As Base = New Derived
    Console.WriteLine("X:" & X.Test())
    Console.WriteLine("Y:" & Y.Test())
    Console.WriteLine("X:" & CType(X, Base).Test)
    Console.WriteLine("X:" & X.Func())
    Console.WriteLine("Y:" & Y.Func())
    Console.WriteLine("X:" & CType(X, Base).Func)
    Console.ReadKey()
End Sub
Public Class Base
    Public Overridable Function Func() As String
        Return "Standard"
    End Function
    Function Test() As String
        Return Me.Func()
    End Function
End Class
Public Class Derived
    Inherits Base
    Public $$$ Function Func() As String
        Return "Passed By Class1" & " - " & MyBase.Func
    End Function
End Class 
```

如果您使用 Overrides（其中有 $$$），如果实例的定义是 Derived，并且如果定义是基类但实例是 Derived 类型，则无法在 Base 类上使用 Func。

如果您使用 Shadows，您可以看到 Func 进入派生类的唯一方法是将实例定义为 Derived，并且不传递给基类的方法（X.Test 返回标准）。我认为这是主要的：如果我使用阴影，该方法不会在基方法中重载基方法。

这就是 Overloads 的 OOP 方法。如果我派生一个类并且在任何情况下我都不希望调用一个方法，我必须使用重载。对于我的对象的实例，没有办法返回“标准”（我认为除了使用反射）。我认为智能感知会造成一些混乱。如果我突出显示 Y.Func，则会将 Func 突出显示为基类，但将 Func 执行为派生类。

使用 Shadows，新方法只能直接访问。比如Overloads，但是隐藏了基类的重载（我认为是编译前返回的错误，因为可以使用强制转换调用它，比如使用重载隐式完成）。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-10-14T11:55:53.997

如果您正在围绕现有控件编写包装器，那么阴影可能非常有用。

例如在组合框周围。通过遮蔽`AutoCompleteSource`你可以防止它被设置为你的特殊类型的组合框的非法值，即使它被投射到一个普通的组合框。`mybase.AutoCompleteSource = value`或者在使用阴影属性之前进行一些预处理。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-06-20T08:47:31.620

阴影的使用很少见，但确实如此。此外，您不能覆盖共享（静态）方法。因此，如果您想“覆盖”它，您必须隐藏共享方法。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2020-07-31T12:26:58.167

VB 使用比 C# 更高级的 OOP 概念，要在 C# 的派生类中使用覆盖，您必须将方法标记为“虚拟”，Shadow 允许您在没有这个的情况下进行重载。

阅读有关此[https://docs.microsoft.com/en-us/dotnet/visual-basic/programming-guide/language-features/declared-elements/differences-between-shadowing-and-overriding的 MS 文档](https://docs.microsoft.com/en-us/dotnet/visual-basic/programming-guide/language-features/declared-elements/differences-between-shadowing-and-overriding)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-20T22:16:28.313

我同意吉姆的观点。我也从未找到过 Shadows 的合法用途。通常，如果我看到它，我认为代码的子部分需要重构一下。

我想它在那里是为了让您可以从您无法控制源代码的程序集中隐藏一个方法。在这种情况下，重构父类是不可能的。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-02-04T17:17:10.750

我想使用`System.Web.HttpContext.Current.Response`而不是`Response.redirect`，并且需要方便地编写为`Response.redirect`. 我定义了一个只读属性，命名`Response`为隐藏基类中的原始属性。我不能使用覆盖，因为这个属性是不可覆盖的。很方便：）

* * *

## 回答 #17

> 赞同：-14
> 
> 时间：2009-01-20T21:58:34.263

我不认为Shadows 真的是一个OOP 概念。Overrides 表示您正在为祖先类中声明的方法/属性等提供新的或附加的功能。阴影确实欺骗编译器认为父方法/属性等甚至不存在。

我对影子没有用处。坚持覆盖。VB 多年来提供的这些有用的小“功能”总是在某些时候让您感到悲伤。

# python - BeautifulSoup 3.1.0.1 和 Python 2.5.2 的 UnicodeEncodeError

> ID：463215
> 
> 赞同：5
> 
> 时间：2009-01-20T21:33:25.280
> 
> 标签：python, encoding, screen-scraping, beautifulsoup

使用 BeautifulSoup 3.1.0.1 和 Python 2.5.2，并尝试解析法语网页。但是，一旦我调用 findAll，我就会收到以下错误：

*UnicodeEncodeError：“ascii”编解码器无法在位置 1146 编码字符 u'\xe9'：序数不在范围内（128）*

以下是我目前正在运行的代码：

```
import urllib2
from BeautifulSoup import BeautifulSoup
page = urllib2.urlopen("http://fr.encarta.msn.com/encyclopedia_761561798/Paris.html")
soup = BeautifulSoup(page, fromEncoding="latin1")
r = soup.findAll("table")
print r 
```

有人知道为什么吗？

谢谢！

**更新**：根据要求，以下是完整的追溯

```
Traceback (most recent call last):
  File "[...]\test.py", line 6, in <module>
    print r
UnicodeEncodeError: 'ascii' codec can't encode characters in position 1146-1147: ordinal not in range(128) 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-20T22:24:20.747

这是另一个想法。您的终端无法显示来自 Python 的 unicode 字符串。解释器首先尝试将其转换为 ASCII。您应该在打印之前对其进行显式编码。我不知道`soup.findAll()`. 但它可能是这样的：

```
for t in  soup.findAll("table"):
    print t.encode('latin1') 
```

如果`t`真的是一个字符串。也许它只是另一个对象，您必须从中构建要显示的数据。

# c# - 如何从未引用的程序集中获取类型？

> ID：463228
> 
> 赞同：3
> 
> 时间：2009-01-20T21:36:50.577
> 
> 标签：c#, .net, reflection, assemblies

**当类型存在于未引用的程序集中时，**GetType() 返回 null 。**例如，当以下调用“localType”时始终为空（即使使用类的完整命名空间名称）：**

 **```
Type localType = Type.GetType("NamespaceX.ProjectX.ClassX"); 
```

我看不出 Type.GetType 不能从未引用的程序集中检索类型的任何原因，所以

## 如何检索未引用程序集的类型？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-20T22:18:09.963

用于[`LoadFrom`](http://msdn.microsoft.com/en-us/library/1009fa28.aspx)从其位置加载未引用的程序集。然后调用[`GetType`](http://msdn.microsoft.com/en-us/library/y0cd10tb.aspx)。

```
Assembly assembly = Assembly.LoadFrom("c:\ProjectX\bin\release\ProjectX.dll");
Type type = assembly.GetType("NamespaceX.ProjectX.ClassX"); 
```

如果要加载的程序集位于要从中加载的程序集的私有路径中（如“c:\ProjectY\bin\release\ProjectX.dll”），则可以使用[`Load`](http://msdn.microsoft.com/en-us/library/ky3942xh.aspx).

```
Assembly assembly = Assembly.Load("ProjectX.dll");
Type type = assembly.GetType("NamespaceX.ProjectX.ClassX"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T22:01:17.313

来自[MSDN](http://msdn.microsoft.com/en-us/library/w3f99sx1.aspx)文档

> 如果请求的类型是非公共的，并且调用者没有 ReflectionPermission 来反映当前程序集之外的非公共对象，则此方法返回 null。

它还表示如果程序集不是从磁盘加载，将返回 null。

您可以尝试的一种解决方法是加载程序集，然后直接在程序集上使用 GetType 方法。诚然，从文档中可以看出，如果问题在于加载程序集，它应该引发异常。

# compare - 您如何有效地多次比较 15000 个文件？

> ID：463229
> 
> 赞同：1
> 
> 时间：2009-01-20T21:36:50.750
> 
> 标签：compare

我正在比较两个几乎相同的文件夹，其中包括应该忽略的隐藏 .svn 文件夹，并且我想不断快速比较这些文件夹，因为一些文件被修补以比较差异，而无需再次检查未更改的匹配文件。

编辑：因为有这么多的选择，我对一个明显利用先前比较知识的解决方案感兴趣，因为在进行重复比较时，任何其他解决方案都不是真正可行的。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-20T21:40:56.293

如果你愿意花一点钱，Beyond Compare 是一个非常强大的 diffing 工具，可以进行基于文件夹的 diffing。

[超越比较](http://www.scootersoftware.com/)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-20T21:39:47.967

我个人使用[WinMerge](http://winmerge.org/)并发现它非常有用。它具有排除 svn 文件的过滤器。在 linux 下我更喜欢[Meld](http://meld.sourceforge.net/)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-20T21:43:38.443

一种选择是使用`rsync`. 就像是：

```
rsync -n -r -v -C dir_a dir_b 
```

该`-n`选项会进行试运行，因此不会修改任何文件。 `-r`进行递归比较。可以选择使用 开启详细模式`-v`。（您可以使用`-i`来逐项列出更改而不是`-v`。）忽略通常被忽略的文件，例如`.svn/`使用`-C`。

`diff`当我阅读手册页时，这应该比简单的要快`rsync`：

> Rsync 使用“快速检查”算法（默认情况下）查找需要传输的文件，该算法查找大小或上次修改时间已更改的文件。当快速检查指示文件的数据不需要更新时，直接在目标文件上进行其他保留属性的任何更改（根据选项的要求）。

由于“快速检查”算法不直接查看文件内容，它可能会被愚弄。在这种情况下，`-c`可能需要执行校验和的选项。它很可能比普通的要快`diff`。

此外，如果您计划在某个时候同步目录，这也是该工作的好工具。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-20T21:41:39.180

并非万无一失，但您可以比较时间戳。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-20T21:42:32.330

使用总指挥官！所有很酷的开发人员都使用它:)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-20T21:46:45.487

If you are on linux or some variant, you should be able to do:

prompt$ diff -r dir1 dir2 --exclude=.svn

The -r forces recursive lookups. There are a bunch of switches to ignore stuff like whitespace etc.

# c# - 如何使用 LinqToSQL 查询层次结构？

> ID：463233
> 
> 赞同：2
> 
> 时间：2009-01-20T21:37:28.017
> 
> 标签：c#, linq-to-sql, hierarchy

我有一个层次结构，我想用 LinqToSql 查询：

国家 -> 地区 -> 城市 -> 邮政编码

每个实体都包含对其父级的引用（例如 Region.Country）和其子级的集合（例如 Region.Cities）。

我想急切地加载每个实体的父级以及国家和地区，但延迟加载城市和邮政编码。

更复杂的是，每个实体在被投影到模型之前都被本地化。所以 Country.Name 会根据语言而变化。

这是我到目前为止的一些片段：

```
public IQueryable<Country> ListCountries()
{
  return ProjectCountry(dataContext.GetTable<ec_Country>());
}

private IQueryable<Country> ProjectCountry(IQueryable<ec_Country> query)
{
  var result = from country in query
  join localized in dataContext.GetTable<ec_CountryLocalization>() on country.CountryID equals localized.CountryID
  let regions = GetRegions(country.CountryID)
  where localized.StatusID == 4 && localized.WebSiteID == this.webSiteID
  select new Country(country.CountryID) {
    CreatedDate = country.CreatedDate,
    IsDeleted = country.IsDeleted,
    IsoCode = country.IsoCode,
    Name = country.Name,
    Regions = new LazyList<Region>(regions),
    Text = localized.Text,
    Title = localized.Title,
    UrlKey = country.UrlKey
  };

  return result;
}

private IQueryable<Region> GetRegions(Int32 countryID)
{
  var query = from r in dataContext.GetTable<ec_Region>()
  where r.CountryID == countryID
  orderby r.Name
  select r;

  return ProjectRegion(query);
}

private IQueryable<Region> ProjectRegion(IQueryable<ec_Region> query)
{
  var result = from region in query
  join localized in dataContext.GetTable<ec_RegionLocalization>() on region.RegionID equals localized.RegionID
  join country in ListCountries() on region.CountryID equals country.CountryID
  let cities = GetCities(region.RegionID)
  select new Region(region.RegionID) {
    Cities = new LazyList<City>(cities),
    Country = country,
    CountryID = region.CountryID,
    CreatedDate = region.CreatedDate,
    IsDeleted = region.IsDeleted,
    IsoCode = region.IsoCode,
    Name = region.Name,
    Text = localized.Text,
    Title = localized.Title,
    UrlKey = region.UrlKey
  };

  return result;
} 
```

... ETC。

```
[TestMethod]
public void DataProvider_Correctly_Projects_Country_Spike()
{
  // Act
  Country country = dataProvider.GetCountry(1);

  // Assert
  Assert.IsNotNull(country);
  Assert.IsFalse(String.IsNullOrEmpty(country.Description));
  Assert.IsTrue(country.Regions.Count > 0);
} 
```

测试失败：

System.NotSupportedException：方法 'System.Linq.IQueryable`1[Beeline.EducationCompass.Model.Region] GetRegions(Int32)' 不支持对 SQL 的转换。

你会建议我怎么做？如果层次结构的每个级别都在同一个表中而不是单独的表中，会更简单（或可能）吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T18:33:49.637

您将要使用 linq 设计器来设置对象之间的关系。通过创建属性，这使您无需在加入后加入后编写加入。

*   一个国家和它的地区之间
*   一个地区和它的城市之间
*   一个国家和它的本地化之间
*   区域及其本地化之间

您将要使用[ToList](http://msdn.microsoft.com/en-us/library/bb342261.aspx)来分隔那些您打算转换为 SQL 的操作，以及您打算在本地代码中完成的那些操作。如果您不这样做，您将继续看到那些“无法将您的方法转换为 SQL”的异常。

在某些情况下，您还需要使用[DataLoadOptions急切地加载这些属性。](http://msdn.microsoft.com/en-us/library/system.data.linq.dataloadoptions.aspx)这是我的尝试。

```
DataLoadOptions dlo = new DataLoadOptions();
//bring in the Regions for each Country
dlo.LoadWith<ec_Country>(c => c.Regions);
//bring in the localizations
dlo.AssociateWith<ec_Country>(c => c.Localizations
  .Where(loc => loc.StatusID == 4 && loc.WebSiteID == this.webSiteID)
);
dlo.AssociateWith<ec_Region>(r => r.Localizations);

//set up the dataloadoptions to eagerly load the above.
dataContext.DataLoadOptions = dlo;

//Pull countries and all eagerly loaded data into memory.
List<ec_Country> queryResult = query.ToList();

//further map these data types to business types
List<Country> result = queryResult
  .Select(c => ToCountry(c))
  .ToList(); 
```

* * *

```
public Country ToCountry(ec_Country c)
{
  return new Country()
  {
    Name = c.Name,
    Text = c.Localizations.Single().Text,
    Regions = c.Regions().Select(r => ToRegion(r)).ToList()
  }
}

public Region ToRegion(ec_Region r)
{
  return new Region()
  {
    Name = r.Name,
    Text = r.Localizations.Single().Text,
    Cities = r.Cities.Select(city => ToCity(city)).ToLazyList();
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T00:31:47.823

那是一段粘性代码，如果其他人有相关技能，我不会回答这个问题，但既然你没有回应......

我可以告诉你错误信息的含义。这意味着函数 GetRegions 不能被 linq to sql 提供程序转换为 sql。一些内置函数可以，因为提供者理解它们，这里有一个[列表](http://msdn.microsoft.com/en-us/library/bb882657.aspx)。否则，您可以提供翻译，请参见[此处](http://msdn.microsoft.com/en-us/library/bb386973.aspx)。

在您的情况下，您需要“内联”此查询的逻辑，该逻辑不会跨越函数调用的边界，因为您正在处理表达式树，sql server 无法回调您的 GetRegions 方法。

至于具体的做法，你得去试一试，我现在没时间答应你。（除非别人有时间和技能？）

祝你好运。

# ruby-on-rails - 监控 Mongrel 队列长度

> ID：463235
> 
> 赞同：0
> 
> 时间：2009-01-20T21:37:47.783
> 
> 标签：ruby-on-rails, monitoring, mongrel

我有一个 Apache + Haproxy + Mongrel 集群设置。当我的 Mongrel 队列长度太长时，我想收到警报。

如何获取当前的 Mongrel 队列长度并使其可用于 Monit 和 Nagios 等警报工具？

我知道 Haproxy 有关于 Mongrel 队列的信息，因为它智能地向集群中最不忙的 Mongrel 发送请求。我想知道它是如何发现的？当这种情况到来时，我需要一个类似的机制来生成警报和/或重新启动杂种。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T14:07:37.800

将此添加到您的 haproxy 配置中

```
 stats uri /haproxy/hastats 
```

然后使用 lynx 获取如下统计信息：（假设 haproxy 在端口 10000 上运行 - 调整以适应）

```
 lynx --dump http://my-server:10000/haproxy/hastats 
```

每个 haproxy 配置文件中的每个服务器条目都会有一行，告诉您它是向上还是向下，它的队列有多长，如下所示：

```
 Server                 Queue             Sessions                    Errors
  Name    Weight Status Act. Bck. Curr. Max. Curr. Max. Limit  Cumul.   Conn. Resp. Sec. Check Down
primary     1      UP    Y    -      0    0    68  386     - 134385861   207   699    0  7028  150
secondary    1      UP    Y    -      0    0    71  248     - 134464984   216   551    0  7129   98 
```

现在您只需要一个脚本来获取当前队列（第 6 列）并将其输入 nagios，然后您就离开了！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T18:56:26.790

New Relic 的 RPM 产品 (www.newrelic.com) 维护有关 Mongrel 队列长度的信息。他们有一个 API，您可以使用它来获得关于队列长度的近乎实时的反馈并相应地调整负载平衡。

您可以在以下网址获取有关 API 的更多信息：[https ://newrelic.tenderapp.com/faqs/docs/data-api](https://newrelic.tenderapp.com/faqs/docs/data-api)

希望这能提供一些帮助。

# windows-services - 在安装 Windows 服务之前卸载

> ID：463237
> 
> 赞同：0
> 
> 时间：2009-01-20T21:38:02.667
> 
> 标签：windows-services, installation

我正在阅读有关如何创建将 Windows 服务安装到服务器的 .exe 的信息。

假设我已经安装了 Windows 服务并且我想执行更新。安装程序有没有办法卸载（停止服务，删除它，卸载它）当前正在运行的服务，然后安装更新版本？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-20T21:50:47.977

不要那么激烈——如果可能的话，只需停止服务，替换您需要的文件，然后（可选）重新启动服务。

如果从 SCM 中删除服务，您将丢失用户完成的任何安装后配置——自定义登录凭据、指示服务崩溃时执行操作的设置等。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T21:48:17.620

您不需要创建 exe 来执行此操作，“sc”命令可以为您在 Windows 上卸载、更新和安装服务。看：

*   [使用 SC.EXE 开发 Windows NT 服务](http://msdn.microsoft.com/en-us/library/ms810435.aspx)
*   [如何使用 Sc.exe 创建 Windows 服务](http://support.microsoft.com/kb/251192)

如果您仍然真的想通过创建自己的可执行文件来做到这一点，您当然可以，如果您可以让我们知道您在代码示例中使用的语言可以提供。

# java - 将信息从 java 传递到 c++ 的最佳方式是什么？

> ID：463240
> 
> 赞同：19
> 
> 时间：2009-01-20T21:38:45.877
> 
> 标签：java, c++, sockets, cross-platform

我有一个 java 应用程序，我需要将一些信息传递给 C++ 程序。有人建议我使用一些简单的套接字编程来做到这一点。这是最好的方法吗？如果不是，有什么替代方案？如果是这样，我应该如何学习套接字编程？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-20T21:46:20.137

你有几个选择：

*   将文件从 Java 传递到 C++。这可能是最简单的。它很容易测试，并且两端都不需要任何 3rd 方库。
*   如上所述使用套接字。在 C++ 中，如果您需要跨平台解决方案，[ACE](http://www.cs.wustl.edu/~schmidt/ACE-overview.html)或[boost](http://www.boost.org/doc/libs/1_37_0/doc/html/boost_asio.html)之类的库将为您省去一些心痛
*   使用[JNI](http://en.wikipedia.org/wiki/Java_Native_Interface)从 Java 调用 C++，反之亦然。这可能是最困难的，但也是最高效的。

对于学习套接字，谷歌搜索[“java socket tutorial”](http://java.sun.com/docs/books/tutorial/networking/sockets/)或[“c​​++ socket tutorial”](http://www.google.com/search?hl=en&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&hs=uhO&q=c%2B%2B+sockets+tutorial&btnG=Search)会给你很多信息。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-20T23:05:19.510

一个简单的方法是使用标准输入和输出：

```
class MyTest {
    public static void main(String... args) {
        System.out.println("carpet");
    }
} // Java

#include <iostream>
#include <string>
int main() {
    string input;
    std::getline(std::cin, input);
    std::cout << "from java: " << input << std::endl; // output: carpet
} // C++

# start by piping java's output to c++'s input
$ java MyTest | ./my_receive 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-21T00:15:36.187

尽管已经接受了答案，但这里的一个关键问题是两种语言之间的语义不匹配：假设您正在进行某种流连接，您如何有效地交换数据？

我可能推荐的一种解决方案是 Google Protocol Buffers。它不能解决 subprocess/JNI/socket 问题，但它的作用是让您以一种非常有效的方式通过流协议传输复杂的对象结构。

请记住：JNI 很复杂，特别是对于复杂的对象引用，但它很有效。最重要的是正确地通过有效的上下文切换传递数据。GPB+JNI/Sub-Process Socket 允许单个上下文切换来拉取数据，并结合双方的高效编解码器支持。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-20T21:44:29.500

您可以使用 Java 本机接口 (JNI)。JNI 允许您从 Java 应用程序调用 C 库。请注意，JNI 调用是 C 而不是 C++ 调用，因此您必须在 C++ 函数（外部“C”）上指定 C 调用约定。

JNI 以难做而著称。这并不容易，但肯定是可行的。我建议不要使用套接字。使用套接字听起来很简单，但对我来说，这无异于打开一罐讨厌的蠕虫......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-20T23:21:04.470

Dave 提到的选项是一些最常见的方法。

作为 JNI 解决方案的扩展，如果您想要在 Java 和 C++ 之间共享一些原始数据，您还可以查看直接 ByteBuffers（Java 1.4 及更高版本）。直接字节缓冲区允许您在 C++ 或 Java 端分配一定大小的缓冲区，然后轻松地从两种语言访问缓冲区；在 Java 中，这是通过 ByteBuffer 对象上的方法完成的，而在 C++ 中，您可以获得指向数据的指针。如果您有大量信息要交换并且您不想将其全部作为 JNI 方法中的参数传递，那么 ByteBuffers 会很方便。

套接字方法*可能是*矫枉过正，但我​​不确定你具体想做什么。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-20T21:50:14.700

需要更多信息（但这是一个好问题）。

这两个独立的程序是否同时运行？

如果不是，并且 Java 程序需要调用 C++ 库，那么 JNI 答案是一个很好的解决方案，但它不会真正跨进程工作。

在进程的情况下，您确实需要找到一种跨进程通信的方法......一个简单的解决方案（可能不是最好的，但我不知道您的确切情况）将是编写一个二进制文件阅读和阅读......只是不要忘记提防比赛条件！套接字也可以工作，但如果您的程序进行大量通信，则可能会占用 CPU 电源。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-20T23:34:13.740

此外，如果您没有忘记这一点，请在尝试 JNI 路线时使用 SWIG 来帮助您。[http://www.swig.org/](http://www.swig.org/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-20T23:40:15.447

还有[SOAP](http://en.wikipedia.org/wiki/SOAP_(protocol))的选项，但假设您只是在同一台机器上拥有两个进程，这可能是矫枉过正。为了完整起见，我仍然提到它。

# excel - 为什么这个文件总是保存为 FALSE.xls？

> ID：463258
> 
> 赞同：1
> 
> 时间：2009-01-20T21:42:44.963
> 
> 标签：excel, vba

我编写了一个基于 .xlt 文件创建 .xls 文件的 VB 脚本。然后它从 .xls 文件中调用一个宏，该文件用数据库中的信息填充它。在最后一步中，脚本将 .xls 文件保存在磁盘上。

我以前用 VB 和 Excel 2003 做过这个。现在我升级到 Excel 2007，在它保存文件之前，会弹出一个窗口告诉我：

“以下功能无法保存在无宏工作簿中：

*   VB项目

...一些 yada yada 关于是和否选项的作用。

以及对话框中的是和否按钮。” 我希望脚本在对话框中自动选择并执行“是”。但我不知道如何做到这一点。我也发布了我编写的脚本。

如果您对此有更好的方法，请分享。谢谢你，史蒂夫

```
Sub Main()
    Dim xl_app

        Set xl_app = CreateObject("Excel.Application")
        xl_app.Workbooks.Open("E:\Work\Send Mail\Clienti.xls")

        'Run the macro

    xl_app.Run( "ImportData(""Data Source=SFA;Initial Catalog=Campofrio; 
            Integrated Security=SSPI;Connect Timeout=3000"", -1, 47)")

xl_app.ActiveWorkbook.SaveAs FileName="E:\Work\Send   
                Mail\Clients.xls",FileFormat=xlNormal

xl_app.Quit
    Set xl_app = Nothing
End Sub 
```

现在 cod 可以工作了，但不是将文件保存在指定位置，而是将其保存在 FALSE.xls 下的 My Documents 文件夹中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T00:30:23.707

合并发帖人提出的两个重复问题的回答：

# 1

[在 Excel 中保存文件时防止出现 False.xls](http://www.excelforum.com/excel-programming/501828-preventing-false-xls-when-automating-saveas.html)

# 2

您在 .SaveAs 中使用了命名参数错误。写出命名参数时，您必须以格式执行

```
FileName:="e:\myfile.xls" 
```

注意等号之前的冒号。

如果你只写 Filename="myfile.xls" 那么它是一个布尔比较，将返回 false。这就是为什么它将文件保存为 false.xls 的原因。

我认为真的很有趣的错误。;)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T22:33:52.990

你真的需要用包含的宏来保存它吗？如果没有，请使用：ActiveWorkbook.SaveAs Filename:="E:\Work\Send Mail\Clients.xls", FileFormat:=xlNormal

编辑：关键是使用的扩展名应该与指定的 FileFormat 匹配。以上适用于我（排除宏），以下适用于我（包括宏）。两者都没有任何弹出窗口，并且都位于正确的目录中（正如另一张海报提到的那样，如果您指定 FileName，则必须有 :=；否则，请使用下面的表格。

ActiveWorkbook.SaveAs "c:\temp\wordmacros\mybook.xlsm", xlOpenXMLWorkbookMacroEnabled

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T18:43:16.153

我不确定这是否是问题所在，但您不应该只保存为 .xlsm 而不是 .xls，这样您就可以在 Office 2007 中保存启用宏的工作簿吗？您可以检查宏正在哪个版本上运行，如果它是 Excel 2007，则另存为 .xlsm、.xls 否则...

# iis - 经典 ASP/IIS6：如何搜索服务器的 mime 映射？

> ID：463268
> 
> 赞同：2
> 
> 时间：2009-01-20T21:46:14.270
> 
> 标签：iis, asp-classic, mime, mime-types

[这与此](https://stackoverflow.com/questions/174888/asp-net-iis6-how-to-search-the-servers-mime-map)问题相同，但我正在寻找一个经典的 ASP 解决方案。

我有第三方控件来提供安全下载，但它希望您提供 response.contenttype 值。我正在尝试让浏览器提示以下内容：

Response.AddHeader "Content-Disposition", "attachment;filename=""" & strFileName & """"

但是 Safari 不喜欢任何建议的内容类型（对文件名做了奇怪的事情——比如在末尾添加“.exe”）。

*   应用程序/x-ms 下载
*   应用程序/强制下载

所以我要么想查询 IIS 以获得正确的内容类型，要么找到一个通用的内容类型，让浏览器以某种可靠的方式找出它。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-20T21:58:18.287

通常，站点使用的 mimemap 存储在服务器级别，您可能会在尝试读取它时遇到权限问题。它需要一些讨厌的 ADSI 代码。

您是否尝试过将标准`application/octet-stream`作为 mime 类型？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-11T19:38:47.233

[从阅读服务器 mimemap](http://bytes.com/topic/asp-classic/answers/459838-reading-server-mimemap)：

```
Public Function GetMimeType(ByVal Extension)
   Dim oMimeMap
   Dim vntMimeType
   Dim avntMap()

   Set oMimeMap = GetObject("IIS://LocalHost/MimeMap")

   If Left(Extension, 1) <> "." Then Extension = "." & Extension

    avntMap() = oMimeMap.MimeMap

    For Each vntMimeType In avntMap
        If vntMimeType.Extension = Extension Then
            GetMimeType = vntMimeType.MimeType
            Exit For
        End If
    Next

    If GetMimeType = "" Then GetMimeType = "application/octet-stream"
End Function 
```

**注意：**调用代码`GetObject`必须是 WWW Service Master 属性中的 Operator。

# .net - 使用 Icon.ExtractAssociatedIcon 和 ImageList 获得完整质量的 16 x 16 图标

> ID：463273
> 
> 赞同：8
> 
> 时间：2009-01-20T21:47:07.217
> 
> 标签：.net, image, icons

按照[这个问题](https://stackoverflow.com/questions/462270/get-file-icon-used-by-shell)的指示，我运行了一些代码来从文件中提取图标并在设置为详细信息模式的 ListView 中显示它们。我希望图标以 16 x 16 显示，但是当我将 ImageList 大小设置为该图标时，出现的图标看起来很奇怪（不知道如何描述它 - 请参阅随附的屏幕截图）。

我已经尝试将大小更改为 32 x 32 并且效果很好，但肯定有办法获得高质量的 16 x 16 图标，不是吗？

[http://img165.imageshack.us/img165/4446/badqualityiconscc4.png](http://img165.imageshack.us/img165/4446/badqualityiconscc4.png)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-20T21:56:49.787

您必须使用 2 个图像列表，一个用于小图像，一个用于大图像，以获得我认为的最佳结果。（listview有两个属性，LargeImageList和SmallImageList）

编辑（发现我尝试时有效的新信息）：

这个版本是使用插值来获得更小的拇指，应该会更好。

```
 Dim BigIcon As Icon = Nothing
    BigIcon = Icon.ExtractAssociatedIcon("c:\zebra.zip")
    Dim largeimages As New ImageList
    Dim smallimages As New ImageList

    largeimages.Images.Add("1", BigIcon)

    'Fix a smaller version with interpolation
    Dim bm As New Bitmap(BigIcon.ToBitmap)
    Dim thumb As New Bitmap(16, 16)
    Dim g As Graphics = Graphics.FromImage(thumb)
    g.InterpolationMode = Drawing2D.InterpolationMode.HighQualityBicubic
    g.DrawImage(bm, New Rectangle(0, 0, 16, 16), New Rectangle(0, 0, bm.Width, bm.Height), GraphicsUnit.Pixel)
    g.Dispose()
    bm.Dispose()
    smallimages.Images.Add("1", thumb)
    ListView1.SmallImageList = smallimages
    ListView1.LargeImageList = largeimages
    thumb.Dispose()
    ListView1.Items.Add("Test", "Test", "1") 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-04-19T15:25:15.530

通过此[代码项目文章](http://www.codeproject.com/KB/dotnet/System_File_Association.aspx)和[PInvoke.net 上的 ExtractIconEx 演示，](http://www.pinvoke.net/default.aspx/shell32/ExtractIconEx.html)您可以编写以下内容：

```
FileAssociationInfo info = new FileAssociationInfo(".docx");

ProgramAssociationInfo pai = new ProgramAssociationInfo(info.ProgID);
ProgramIcon ico = pai.DefaultIcon;
Icon icoLarge = Martin.Hyldahl.Examples.ExtractIconEx.ExtractIconExample.ExtractIconFromExe(ico.Path, ico.Index, false); 
```

您必须将 ExtractIconFromExe 的签名更改为

```
public static Icon ExtractIconFromExe(string file, int nIconIndex, bool large) 
```

并将代码更改为几行

```
if (large)
   readIconCount = ExtractIconEx(file, nIconIndex, hIconEx, hDummy, 1);
else
   readIconCount = ExtractIconEx(file, nIconIndex, hDummy, hIconEx, 1); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-05-22T19:11:16.133

默认 Imagelist ColorDepth 属性设置为 Depth8Bit，**设置为 Depth32Bit**。

# svn - 你有一个聪明的技巧来解决 svn:externals 在 bzr-svn 中不受支持

> ID：463275
> 
> 赞同：1
> 
> 时间：2009-01-20T21:48:14.610
> 
> 标签：svn, version-control, bazaar, svn-externals, bzr-svn

我正在使用 bzr 访问 Subversion 存储库。这很好，但是存储库使用了很多 svn:externals 属性来从相关项目中引入代码。

[Bzr-svn 还不支持 svn:externals](http://bazaar-vcs.org/BzrForeignBranches/Subversion#limitations)。

有没有解决这个限制的好方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-03-22T17:52:04.133

今天另一个选项可用：[bzr-externals 插件](https://launchpad.net/bzr-externals)。核实！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-12T20:34:49.230

我正在模拟 bzr 中的 svn:externals。它与 bzr-svn 无关，而是尝试提供通用解决方案。项目仍处于 alpha 阶段，但今天很多东西都在工作。您可以查看该项目及其文档。 [https://launchpad.net/bzr-scmproj](https://launchpad.net/bzr-scmproj)

此插件本身不支持 svn:externals，但您可以将所需的值带到项目配置中。如果您的 svn:externals 不经常更改，它将对您很好。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-08T18:16:34.607

FWIW，外部可能会在几个月内得到支持，当 Bazaar 本身的嵌套树支持登陆时。

# unit-testing - 什么是“存根”？

> ID：463278
> 
> 赞同：138
> 
> 时间：2009-01-20T21:49:48.693
> 
> 标签：unit-testing, testing, tdd, stub

所以，继续我的新年决心以更多地参与 TDD，我现在开始更多地使用[Rhino Mocks](http://ayende.com/projects/rhino-mocks.aspx)工作。

我热衷于做的一件事是确保我真正了解我正在进入的内容，所以我想检查我对到目前为止所看到的内容的理解（我认为将它作为资源放在这里会很好）。

## 什么是“存根”？

* * *

## 回答 #1

> 赞同：136
> 
> 时间：2009-01-20T21:57:21.923

Martin Fowler 写了一篇关于这个主题[的优秀文章。](http://martinfowler.com/articles/mocksArentStubs.html)从那篇文章：

> Meszaros 使用术语 Test Double 作为通用术语，用于代替真实对象用于测试目的的任何类型的假装对象。这个名字来源于电影中特技替身的概念。（他的目标之一是避免使用任何已经被广泛使用的名称。）Meszaros 然后定义了四种特殊类型的双精度：
> 
> *   虚拟对象被传递但从未实际使用过。通常它们仅用于填充参数列表。
> *   假对象实际上有工作实现，但通常采取一些捷径，这使得它们不适合生产（内存数据库就是一个很好的例子）。
> *   存根为测试期间拨打的电话提供预设答案，通常根本不响应任何超出测试程序的内容。存根还可以记录有关呼叫的信息，例如记住它“发送”的消息的电子邮件网关存根，或者可能只记录它“发送”的消息的数量。
> *   模拟就是我们在这里讨论的内容：预先编程的对象具有期望，这些期望形成了它们期望接收的调用的规范。

用我自己的话来说：模拟对象“期望”调用它们的某些方法，如果不满足它们的期望，通常会导致单元测试失败。存根对象提供预设响应（并且可以由帮助程序库自动生成），但通常**不会**直接导致单元测试失败。它们通常仅用于让您正在测试的对象获得完成其工作所需的数据。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-01-20T21:51:11.843

“存根”是提供某种数据/响应的接口的实现。例如：

*   一个数据集
*   用户列表
*   一个 XML 文件

通常这将由另一个服务（可能是 Web 服务、另一个应用程序、数据库）提供，但为了提高代码的**可测试性**，结果是“伪造的”。

这样做的一个主要好处是它允许在单元测试中根据预期的数据进行断言。如果由于数据错误而出现错误，则可以轻松添加测试，创建新存根（复制数据错误）并生成代码以纠正错误。

*存根*与*Mocks*的不同之处在于它们用于表示和测试对象的**状态**，而 Mock 则测试其**交互**。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-03-08T14:43:19.897

我相信“存根”来自 STARTUpBlock。它用于指代自动生成的代码部分，以帮助您（开发人员）入门。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2018-04-22T16:03:50.860

**我最近遇到了这个问题，并认识到Stub**和**Driver**之间的这种比较非常清晰且有帮助：

基本上，存根和驱动程序是除了声明自己和它们接受的参数之外实际上不做任何事情的例程。然后，其余代码可以获取这些参数并将它们用作输入。

```
+---------+-------------------+------- ------------------------------------+
| | 存根 | 司机 |
+---------+-------------------+------- ------------------------------------+
| 类型 | 伪代码 | 伪代码 |
+---------+-------------------+------- ------------------------------------+
| 用于 | 自上而下的集成 | 自下而上的整合 |
+---------+-------------------+------- ------------------------------------+
| 目的 | 允许测试鞋面 | 允许测试下限|
| | 代码的级别，当 | 代码的级别，当 |
| | 较低级别的代码是 | 代码的上层是 |
| | 尚未开发。| 尚未开发。|
+---------+-------------------+------- ------------------------------------+
| 示例 | A 和 B 是组件。| A 和 B 是组件。|
| | A ---> B | A ---> B |
| | | |
| | A已开发。| A 仍需开发。
| | B仍需开发。| B 已开发。|
| | 因此，使用 stub | 因此，使用驱动程序 |
| | 代替B模仿它。| 代替A模仿它|
| | | |
| | A ---> 存根 | 司机---> B |
+---------+-------------------+------- ------------------------------------+

```

从[存根和驱动程序之间的区别](http://www.differencebetween.info/difference-between-stub-and-driver)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2018-01-13T03:43:50.370

“存根”或“存根方法”被设计为入门代码或尚未开发的代码的临时替代品。它是由 IDE 生成的内置代码。存根方法实际上是用于测试特定类的方法的方法。它用于在您的实际开发方法中为局部变量输入一些值并检查输出是否正确。找出代码中的错误很重要。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-01-28T20:42:58.287

经过一些研究并基于我在编码人员生活中遇到的存根文件，我会说存根文件只是一个包含文件的全部或部分实现的文件。它可以帮助开发人员开始编码。

# java - 设计流程

> ID：463282
> 
> 赞同：0
> 
> 时间：2009-01-20T21:51:00.767
> 
> 标签：java

## 我挑战你 ：）

我有一个已经有人实施的流程。我将尝试描述这些要求，我希望我能获得一些关于“最佳方式”的意见。

* * *

是给金融机构的。

我有一个路由框架，可以让我接收文件并向其他系统发送请求。我有一个可以随意使用的数据库，但只有我和我的软件可以访问这个数据库。

**事实**

*   通过路由框架，我收到一个文件。
*   该文件中的每一行都遵循固定长度的格式，带有一个人的标识和一个数量（+许多其他东西）。
*   该文件 99% 的时间都在 100MB 以下（每行大约 800 字节，即 2,2mb = 2600 行）
*   一年一次，我们有 1-3 GB 的数据。
*   在“应用服务器”上运行
*   我可以随心所欲地分叉子流程。（在合理范围内）
*   运行超过两天时，我无法确保一致性。子进程可能会死掉，与数据库/框架的连接可能会丢失，文件可能会移动
*   我无法通过框架发送可靠的消息。通话是同步的，所以我必须等待答复。
    *   发送这些 getPerson 请求有可能/很可能会在发送 LOTS 时使我的“进程”崩溃。
*   我们正在使用java。

**要求**

*   我必须返回一个包含所有数据的文件 + 我必须为某些行添加更多信息。（大约 25-50% 的行数：至少 25.000）
*   我只能通过框架向另一个系统发出 getPerson 请求才能获得此信息。每人一份。需要 200 到 400 毫秒。
*   它必须能够在两天内完成

**很高兴有**

*   检查点。如果我要运行很长时间，我肯定希望能够在不从顶部开始的情况下重新启动该过程。...

你会怎么设计这个？ *稍后我将添加当前的“hack”和我的简要想法*

**========== 当前解决方案 =================**

它在 BEA/Oracle Weblogic Integration 上运行，不是出于选择，而是出于定义

当接收到文件时，每一行都被读入数据库

```
id、行、状态、批处理文件名
```

和状态“需要处理”

当所有行都在数据库中时，行由 mod 4 分隔，并且每四分之一行启动一个进程，并且需要它的每一行都由 getPerson 调用丰富，状态设置为“已处理”。（当前批次为 38.0000）。

当所有 4 行的所有 4 行都已被处理时，一个写入器进程首先从该数据库中选择 100 行，将它们写入文件并将它们的状态更新为“已写入”。当一切都完成后，新文件被交还给路由框架，并且一封“我完成了”的电子邮件被发送给操作人员。

这 4 个处理进程可能/将会失败，因此可以通过 http 访问 WLI 上的 servlet 重新启动它们。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-20T23:22:57.290

Simplify as much as possible.

The batches (trying to process them as units, and their various sizes) appear to be discardable in terms of the simplest process. It sounds like the rows are atomic, not the batches.

Feed all the lines as separate atomic transactions through an asynchronous FIFO message queue, with a good mechanism for detecting (and appropriately logging and routing failures). Then you can deal with the problems strictly on an exception basis. (A queue table in your database can probably work.)

Maintain batch identity only with a column in the message record, and summarize batches by that means however you need, whenever you need.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T22:41:21.180

当您收到文件时，对其进行解析并将信息放入数据库中。

制作一张表，每行有一条记录，需要 getPerson 请求。

让一个或多个线程从该表中获取记录，执行请求并将完成的记录放回表中。

处理完所有记录后，生成完整文件并返回。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T23:03:18.203

如果文件的处理需要 2 天，那么我将从实现某种恢复功能开始。将大文件拆分成较小的文件，并一一处理。如果由于某种原因应该中断整个处理，那么您将不必重新开始。

通过将较大的文件拆分为较小的文件，您还可以使用更多的服务器来处理文件。

您还可以使用一些大规模加载器（例如 Oracles SQL 加载器）将大量数据从文件中取出到表中，再次添加一列来标记该行是否已被处理，这样您就可以从上次中断的地方继续如果进程应该崩溃。

The return value could be many small files which at the end would be combined into large single file. If the database approach is chosen you could also save the results in a table which could then be extracted to a csv file.

# c# - 如何查询 xml 文件并将结果保存在另一个 xml 文件中

> ID：463285
> 
> 赞同：0
> 
> 时间：2009-01-20T21:51:20.220
> 
> 标签：c#, linq, linq-to-xml

我刚开始学习 Linq to XML 的可能性，最近发现我可以像数据库一样查询 xml（我现在对它非常着迷）。

我的问题是如何查询 xml 文件并将结果保存在另一个 xml 文件中？：

```
 string url = "employees.xml";

 XElement employees= XElement.Load(url);

 if (employees.Element("employee") != null)

 {

     var query = from f in employees.Element("employee").Elements("item").Take(10)

                 select new { Name = f.Element("name").Value, Surname= f.Element("surname").Value };

     foreach (var feed in query)

     {

        //here... I like to write the result in a different xml file, I tried the 
        //common 
        doc.save("xmlout.xml");

     }

 } 
```

非常感谢你的帮助，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T21:55:17.107

好吧，您可以通过创建一个 XDocument/XElement 实例然后用查询结果填充它（通过将查询传递给 XDocument/XElement 的构造函数）然后保存它来做到这一点。

但是，您可能需要考虑改用 XSLT 转换，因为这正是您在此处尝试执行的操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T22:12:44.560

[这篇](http://www.hookedonlinq.com/LINQtoXML5MinuteOverview.ashx)文章应该可以帮助您解决您的问题。顺便说一句，如果您作为 XElement 新建然后填充，您可以使用 save 方法，而不是使用匿名类型。

# postgresql - 如何从 PostgreSQL 数据库中删除表 * 或 * 视图？

> ID：463292
> 
> 赞同：5
> 
> 时间：2009-01-20T21:52:54.007
> 
> 标签：postgresql, plpgsql

我在 PostgreSQL 数据库中有一个表或视图的名称，需要在单个 pgSQL 命令中删除。我怎么买得起？

我能够选择表单系统表来找出是否有任何具有这样名称但卡在程序部分的表：

```
SELECT count(*) FROM pg_tables where tablename='user_statistics'; 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-20T21:59:09.177

```
DROP TABLE user_statistics;

DROP VIEW user_statistics; 
```

完整的语法：

[删除表](http://www.postgresql.org/docs/7.4/interactive/sql-droptable.html)

[下拉视图](http://www.postgresql.org/docs/8.1/static/sql-dropview.html)

如果你想要一个完整的功能，我尝试了这样的事情：

```
CREATE OR REPLACE FUNCTION delete_table_or_view(objectName varchar) RETURNS integer AS $$
DECLARE
    isTable integer;
    isView integer;
BEGIN
    SELECT INTO isTable count(*) FROM pg_tables where tablename=objectName;
    SELECT INTO isView count(*) FROM pg_views where viewname=objectName;

    IF isTable = 1 THEN
        execute 'DROP TABLE ' || objectName;
        RETURN 1;
    END IF;

    IF isView = 1 THEN
        execute 'DROP VIEW ' || objectName;
        RETURN 2;
    END IF;

    RETURN 0;

END;
$$ LANGUAGE plpgsql; 
```

* * *

## 回答 #2

> 赞同：-4
> 
> 时间：2009-08-13T06:32:59.020

考虑使用*DROP TABLE IF EXISTS*和*DROP VIEW IF EXISTS*。这样，如果失败，您将不会收到错误消息，只是通知。

# java - Java - Ibatis - mySQL 与基于角色的动态查询

> ID：463295
> 
> 赞同：1
> 
> 时间：2009-01-20T21:53:35.677
> 
> 标签：java, ibatis, dynamic-sql

我在前端使用带有 Flex/Flash 的 Java - Ibatis 和 mySQL。我有一个要求是能够根据用户角色动态地将 creterias 和表添加到查询中。这是一个例子

相同的对象调用相同的 SQL 但基于角色的不同结果

角色 1：完全访问员工

```
SELECT * 
  FROM Employee A 
```

作用 2：对员工的访问受限

```
SELECT * 
 FROM Employee A
    , SECURE_LIST B
WHERE B.EmployeeID = A.EmployeeID
  AND B.ROLE_ID = 'ROLE' 
```

我可以使用动态 SQL

```
 SELECT * 
     FROM Employee A
<isNotEmpty property="ROLE" >
        , SECURE_LIST B
    WHERE B.EmployeeID = A.EmployeeID
      AND B.ROLE_ID = #ROLE#
</isNotEmpty> 
```

其他想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T16:36:50.637

```
SELECT *      
FROM Employee A
<isNotEmpty property="ROLE" >
   inner join SECURE_LIST B on B.EmployeeID = A.EmployeeID
</isNotEmpty>
<dynamic prepend="WHERE">
      <isNotEmpty property="ROLE" prepend="AND">
           B.ROLE_ID = #ROLE#
      </isNotEmpty>
</dynamic> 
```

比创建 DAO 简单一点，但仍为您提供添加其他联接或其他 where 子句元素的灵活性，而不必在每个参数映射中包含角色

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T22:19:57.167

在查询中使用角色的问题是，您必须将其作为查询的参数提供给可能的每个查询。当您需要为查询提供参数时会发生什么？您还需要为这些参数类/映射添加角色。一切都有些混乱。

我会退后一步，定义你的 DAO：

```
public interface MyDAO {
  List<Employee> getEmployees();
  ...
} 
```

然后创建两个实现：

```
public class MyDAOSuper implements MyDAO {
  public List<Employee> getEmployees() {
    // call a query using your first SQL
  }
}

public class MyDAOLimited implements MyDAO {
  public List<Employee> getEmployees() {
    // limited version
  }
} 
```

这种方法的一个优点是，如果某些方法不应该由特定角色使用，您可以选择抛出一些安全违规异常。

现在，如何将它插入到应用程序的其余部分中，我没有足够的细节来评论。您可能正在使用 BlazeDS，在这种情况下，我建议使用[Spring 与 BlazeDS 的集成](http://www.springsource.org/spring-flex)，这将打开依赖注入作为选项。

或者，您可以使用简单的工厂方法（基于角色）来获得正确的 DAO。

毫无疑问，根据您的配置，还有其他方法可以插入它。我认为上面的内容比你提出的要干净得多。

# c# - 如何制作一个只接受数字的文本框？

> ID：463299
> 
> 赞同：642
> 
> 时间：2009-01-20T21:55:01.070
> 
> 标签：c#, .net, winforms, textbox

我有一个带有文本框控件的 Windows 窗体应用程序，我只想接受整数值。在过去，我通过重载 KeyPress 事件并仅删除不符合规范的字符来完成这种验证。我查看了 MaskedTextBox 控件，但我想要一个更通用的解决方案，它可以使用正则表达式，或者取决于其他控件的值。

理想情况下，这会表现为按下非数字字符将不会产生任何结果或立即向用户提供有关无效字符的反馈。

* * *

## 回答 #1

> 赞同：884
> 
> 时间：2009-01-20T22:04:05.717

两种选择：

1.  改用 a [`NumericUpDown`](http://msdn.microsoft.com/en-us/library/system.windows.forms.numericupdown(v=vs.110).aspx)。NumericUpDown 为您进行过滤，这很好。当然，它还使您的用户能够点击键盘上的向上和向下箭头来增加和减少当前值。

2.  处理适当的键盘事件以防止除数字输入之外的任何内容。我在标准 TextBox 上使用这两个事件处理程序取得了成功：

    ```
    private void textBox1_KeyPress(object sender, KeyPressEventArgs e)
    {
        if (!char.IsControl(e.KeyChar) && !char.IsDigit(e.KeyChar) &&
            (e.KeyChar != '.'))
        {
                e.Handled = true;
        }

        // only allow one decimal point
        if ((e.KeyChar == '.') && ((sender as TextBox).Text.IndexOf('.') > -1))
        {
            e.Handled = true;
        }
    } 
    ```

如果您的 TextBox 不应该允许小数位，您可以删除检查`'.'`（以及随后对多个 的检查）。`'.'`您还可以检查`'-'`您的 TextBox 是否应允许负值。

如果要限制用户的位数，请使用：`textBox1.MaxLength = 2; // this will allow the user to enter only 2 digits`

* * *

## 回答 #2

> 赞同：171
> 
> 时间：2009-01-20T22:24:54.897

仅仅因为在一行中做事总是更有趣……

```
 private void textBox1_KeyPress(object sender, KeyPressEventArgs e)
    {
        e.Handled = !char.IsDigit(e.KeyChar) && !char.IsControl(e.KeyChar);
    } 
```

注意：这不会阻止用户复制/粘贴到此文本框中。这不是清理数据的万无一失的方法。

* * *

## 回答 #3

> 赞同：58
> 
> 时间：2009-01-20T22:02:12.680

我从上下文和您使用的标签假设您正在编写一个 .NET C# 应用程序。在这种情况下，您可以订阅文本更改事件，并验证每个击键。

```
private void textBox1_TextChanged(object sender, EventArgs e)
{
    if (System.Text.RegularExpressions.Regex.IsMatch(textBox1.Text, "[^0-9]"))
    {
        MessageBox.Show("Please enter only numbers.");
        textBox1.Text = textBox1.Text.Remove(textBox1.Text.Length - 1);
    }
} 
```

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2012-09-11T16:23:46.593

这是一个简单的独立 Winforms 自定义控件，源自标准 TextBox，它只允许 System.Int32 输入（它可以很容易地适应其他类型，例如 System.Int64 等）。它支持复制/粘贴操作和负数：

```
public class Int32TextBox : TextBox
{
    protected override void OnKeyPress(KeyPressEventArgs e)
    {
        base.OnKeyPress(e);

        NumberFormatInfo fi = CultureInfo.CurrentCulture.NumberFormat;

        string c = e.KeyChar.ToString();
        if (char.IsDigit(c, 0))
            return;

        if ((SelectionStart == 0) && (c.Equals(fi.NegativeSign)))
            return;

        // copy/paste
        if ((((int)e.KeyChar == 22) || ((int)e.KeyChar == 3))
            && ((ModifierKeys & Keys.Control) == Keys.Control))
            return;

        if (e.KeyChar == '\b')
            return;

        e.Handled = true;
    }

    protected override void WndProc(ref System.Windows.Forms.Message m)
    {
        const int WM_PASTE = 0x0302;
        if (m.Msg == WM_PASTE)
        {
            string text = Clipboard.GetText();
            if (string.IsNullOrEmpty(text))
                return;

            if ((text.IndexOf('+') >= 0) && (SelectionStart != 0))
                return;

            int i;
            if (!int.TryParse(text, out i)) // change this for other integer types
                return;

            if ((i < 0) && (SelectionStart != 0))
                return;
        }
        base.WndProc(ref m);
    } 
```

**2017 年更新**：我的第一个答案有一些问题：

*   您可以键入比给定类型的整数更长的内容（例如 2147483648 大于 Int32.MaxValue）；
*   更一般地说，没有真正验证输入的*结果*；
*   它只处理 int32，您必须为每种类型（Int64 等）编写特定的 TextBox 派生控件

所以我想出了另一个更通用的版本，它仍然支持复制/粘贴、+ 和 - 符号等。

```
public class ValidatingTextBox : TextBox
{
    private string _validText;
    private int _selectionStart;
    private int _selectionEnd;
    private bool _dontProcessMessages;

    public event EventHandler<TextValidatingEventArgs> TextValidating;

    protected virtual void OnTextValidating(object sender, TextValidatingEventArgs e) => TextValidating?.Invoke(sender, e);

    protected override void WndProc(ref Message m)
    {
        base.WndProc(ref m);
        if (_dontProcessMessages)
            return;

        const int WM_KEYDOWN = 0x100;
        const int WM_ENTERIDLE = 0x121;
        const int VK_DELETE = 0x2e;

        bool delete = m.Msg == WM_KEYDOWN && (int)m.WParam == VK_DELETE;
        if ((m.Msg == WM_KEYDOWN && !delete) || m.Msg == WM_ENTERIDLE)
        {
            DontProcessMessage(() =>
            {
                _validText = Text;
                _selectionStart = SelectionStart;
                _selectionEnd = SelectionLength;
            });
        }

        const int WM_CHAR = 0x102;
        const int WM_PASTE = 0x302;
        if (m.Msg == WM_CHAR || m.Msg == WM_PASTE || delete)
        {
            string newText = null;
            DontProcessMessage(() =>
            {
                newText = Text;
            });

            var e = new TextValidatingEventArgs(newText);
            OnTextValidating(this, e);
            if (e.Cancel)
            {
                DontProcessMessage(() =>
                {
                    Text = _validText;
                    SelectionStart = _selectionStart;
                    SelectionLength = _selectionEnd;
                });
            }
        }
    }

    private void DontProcessMessage(Action action)
    {
        _dontProcessMessages = true;
        try
        {
            action();
        }
        finally
        {
            _dontProcessMessages = false;
        }
    }
}

public class TextValidatingEventArgs : CancelEventArgs
{
    public TextValidatingEventArgs(string newText) => NewText = newText;
    public string NewText { get; }
} 
```

对于 Int32，您可以从它派生，如下所示：

```
public class Int32TextBox : ValidatingTextBox
{
    protected override void OnTextValidating(object sender, TextValidatingEventArgs e)
    {
        e.Cancel = !int.TryParse(e.NewText, out int i);
    }
} 
```

或没有派生，使用新的 TextValidating 事件，如下所示：

```
var vtb = new ValidatingTextBox();
...
vtb.TextValidating += (sender, e) => e.Cancel = !int.TryParse(e.NewText, out int i); 
```

但好的是它适用于任何字符串和任何验证例程。

* * *

## 回答 #5

> 赞同：25
> 
> 时间：2013-07-27T00:40:10.707

这正是 Validated/Validating 事件的设计目的。

这是有关该主题的 MSDN 文章：http: [//msdn.microsoft.com/en-us/library/system.windows.forms.control.validating.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.validating.aspx)

TL;DR 版本：检查 Validating 事件中的 .Text 属性，并`e.Cancel=True`在数据无效时设置。

当您设置 e.Cancel=True 时，用户不能离开该字段，但您需要向他们提供某种反馈，表明有问题。我将框的背景颜色更改为浅红色以表示存在问题。确保在调用 Validating 时将其设置回`SystemColors.Window`具有良好值的状态。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2009-01-20T22:01:14.647

试试[MaskedTextBox](http://msdn.microsoft.com/en-us/library/system.windows.forms.maskedtextbox.aspx)。它采用简单的掩码格式，因此您可以将输入限制为数字或日期等。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2012-03-31T19:55:12.650

您可以使用该`TextChanged`事件

```
private void textBox_BiggerThan_TextChanged(object sender, EventArgs e)
{
    long a;
    if (! long.TryParse(textBox_BiggerThan.Text, out a))
    {
        // If not int clear textbox text or Undo() last operation
        textBox_LessThan.Clear();
    }
} 
```

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2012-08-08T20:06:38.820

这可能很有用。它允许“真实”数值，包括正确的小数点和前面的加号或减号。从相关的 KeyPress 事件中调用它。

```
 private bool IsOKForDecimalTextBox(char theCharacter, TextBox theTextBox)
    {
        // Only allow control characters, digits, plus and minus signs.
        // Only allow ONE plus sign.
        // Only allow ONE minus sign.
        // Only allow the plus or minus sign as the FIRST character.
        // Only allow ONE decimal point.
        // Do NOT allow decimal point or digits BEFORE any plus or minus sign.

        if (
            !char.IsControl(theCharacter)
            && !char.IsDigit(theCharacter)
            && (theCharacter != '.')
            && (theCharacter != '-')
            && (theCharacter != '+')
        )
        {
            // Then it is NOT a character we want allowed in the text box.
            return false;
        }

        // Only allow one decimal point.
        if (theCharacter == '.'
            && theTextBox.Text.IndexOf('.') > -1)
        {
            // Then there is already a decimal point in the text box.
            return false;
        }

        // Only allow one minus sign.
        if (theCharacter == '-'
            && theTextBox.Text.IndexOf('-') > -1)
        {
            // Then there is already a minus sign in the text box.
            return false;
        }

        // Only allow one plus sign.
        if (theCharacter == '+'
            && theTextBox.Text.IndexOf('+') > -1)
        {
            // Then there is already a plus sign in the text box.
            return false;
        }

        // Only allow one plus sign OR minus sign, but not both.
        if (
            (
                (theCharacter == '-')
                || (theCharacter == '+')
            )
            && 
            (
                (theTextBox.Text.IndexOf('-') > -1)
                ||
                (theTextBox.Text.IndexOf('+') > -1)
            )
            )
        {
            // Then the user is trying to enter a plus or minus sign and
            // there is ALREADY a plus or minus sign in the text box.
            return false;
        }

        // Only allow a minus or plus sign at the first character position.
        if (
            (
                (theCharacter == '-')
                || (theCharacter == '+')
            )
            && theTextBox.SelectionStart != 0
            )
        {
            // Then the user is trying to enter a minus or plus sign at some position 
            // OTHER than the first character position in the text box.
            return false;
        }

        // Only allow digits and decimal point AFTER any existing plus or minus sign
        if  (
                (
                    // Is digit or decimal point
                    char.IsDigit(theCharacter)
                    ||
                    (theCharacter == '.')
                )
                &&
                (
                    // A plus or minus sign EXISTS
                    (theTextBox.Text.IndexOf('-') > -1)
                    ||
                    (theTextBox.Text.IndexOf('+') > -1)
                )
                &&
                    // Attempting to put the character at the beginning of the field.
                    theTextBox.SelectionStart == 0
            )
        {
            // Then the user is trying to enter a digit or decimal point in front of a minus or plus sign.
            return false;
        }

        // Otherwise the character is perfectly fine for a decimal value and the character
        // may indeed be placed at the current insertion position.
        return true;
    } 
```

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2015-02-24T17:18:01.357

我一直在研究一组组件来完成 WinForms 中缺少的东西，这里是：[高级表单](https://bitbucket.org/bruce965/advanced-forms)

特别是这是 Regex TextBox 的类

```
/// <summary>Represents a Windows text box control that only allows input that matches a regular expression.</summary>
public class RegexTextBox : TextBox
{
    [NonSerialized]
    string lastText;

    /// <summary>A regular expression governing the input allowed in this text field.</summary>
    [Browsable(false), EditorBrowsable(EditorBrowsableState.Never)]
    [DesignerSerializationVisibility(DesignerSerializationVisibility.Hidden)]
    public virtual Regex Regex { get; set; }

    /// <summary>A regular expression governing the input allowed in this text field.</summary>
    [DefaultValue(null)]
    [Category("Behavior")]
    [Description("Sets the regular expression governing the input allowed for this control.")]
    public virtual string RegexString {
        get {
            return Regex == null ? string.Empty : Regex.ToString();
        }
        set {
            if (string.IsNullOrEmpty(value))
                Regex = null;
            else
                Regex = new Regex(value);
        }
    }

    protected override void OnTextChanged(EventArgs e) {
        if (Regex != null && !Regex.IsMatch(Text)) {
            int pos = SelectionStart - Text.Length + (lastText ?? string.Empty).Length;
            Text = lastText;
            SelectionStart = Math.Max(0, pos);
        }

        lastText = Text;

        base.OnTextChanged(e);
    }
} 
```

只需添加类似的东西`myNumbericTextBox.RegexString = "^(\\d+|)$";`就足够了。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2017-11-27T21:44:48.073

只需使用`NumericUpDown`控件并将那些难看的向上向下按钮的可见性设置为`false`.

```
numericUpDown1.Controls[0].Visible = false; 
```

`NumericUpDown`实际上是包含一个“旋转框”（向上向下按钮）、一个文本框和一些代码的控件集合，用于验证和将它们组合在一起。

标记：

```
YourNumericUpDown.Controls[0].visible = false 
```

将隐藏按钮，同时保持底层代码处于活动状态。

虽然不是一个明显的解决方案，但它既简单又有效。`.Controls[1]`如果您想这样做，则会隐藏文本框部分。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2014-12-23T10:33:18.980

只需在文本框中使用此代码：

```
private void textBox1_TextChanged(object sender, EventArgs e)
{

    double parsedValue;

    if (!double.TryParse(textBox1.Text, out parsedValue))
    {
        textBox1.Text = "";
    }
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-01-20T22:18:13.893

[我在CodePlex](http://www.codeplex.com/WinFormNumberBox)上为此做了一些事情。

它通过拦截 TextChanged 事件来工作。如果结果是一个好的数字，它将被存储。如果出现问题，将恢复最后的良好值。源代码有点太大，无法在此处发布，但[这里是](http://www.codeplex.com/WinFormNumberBox/SourceControl/changeset/view/18543#282049)处理此逻辑核心的类的链接。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2016-05-10T21:30:47.673

在我们定义了文本框的网页中，我们可以添加一个`onkeypress`仅接受数字的事件。它不会显示任何消息，但会防止您输入错误。它对我有用，用户只能输入数字。

```
<asp:TextBox runat="server" ID="txtFrom"
     onkeypress="if(isNaN(String.fromCharCode(event.keyCode))) return false;"> 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2017-12-01T20:25:02.030

整数和浮点数都需要接受，包括负数。

```
private void textBox1_KeyPress(object sender, KeyPressEventArgs e)
{
    // Text
    string text = ((Control) sender).Text;

    // Is Negative Number?
    if (e.KeyChar == '-' && text.Length == 0)
    {
        e.Handled = false;
        return;
    }

    // Is Float Number?
    if (e.KeyChar == '.' && text.Length > 0 && !text.Contains("."))
    {
        e.Handled = false;
        return;
    }

    // Is Digit?
    e.Handled = (!char.IsDigit(e.KeyChar) && !char.IsControl(e.KeyChar));
} 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2018-03-12T16:35:57.357

这是我的方法：

1.  使用 linq（易于修改过滤器）
2.  复制/粘贴验证码
3.  按下禁止字符时保持插入符号位置
4.  接受左零
5.  和任何尺寸的数字

    ```
    private void numeroCuenta_TextChanged(object sender, EventArgs e)
    {
        string org = numeroCuenta.Text;
        string formated = string.Concat(org.Where(c => (c >= '0' && c <= '9')));
        if (formated != org)
        {
            int s = numeroCuenta.SelectionStart;
            if (s > 0 && formated.Length > s && org[s - 1] != formated[s - 1]) s--;
            numeroCuenta.Text = formated;
            numeroCuenta.SelectionStart = s;
        }
    } 
    ```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-01-20T21:59:29.173

您可以使用[TextChanged](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.textchanged.aspx) / Keypress 事件，使用正则表达式过滤数字并采取一些措施。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-01-20T22:04:11.520

看看[WinForm 中的输入处理](https://stackoverflow.com/questions/294611/input-handling-in-winform)

我已经发布了我的解决方案，它在文本框中使用 ProcessCmdKey 和 OnKeyPress 事件。评论向您展示了如何使用正则表达式来验证按键并适当地阻止/允许。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2012-09-16T23:57:22.940

我会在 KeyDown 事件中处理它。

```
void TextBox_KeyDown(object sender, KeyEventArgs e)
        {
            char c = Convert.ToChar(e.PlatformKeyCode);
            if (!char.IsDigit(c))
            {
                e.Handled = true;
            }
        } 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2013-10-16T09:06:41.300

```
private void txt3_KeyPress(object sender, KeyPressEventArgs e)
{
    for (int h = 58; h <= 127; h++)
    {
        if (e.KeyChar == h)             //58 to 127 is alphabets tat will be         blocked
        {
            e.Handled = true;
        }
    }
    for(int k=32;k<=47;k++)
    {
        if (e.KeyChar == k)              //32 to 47 are special characters tat will 
        {                                  be blocked
            e.Handled = true;
        }
    }
} 
```

试试这个很简单

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2014-01-05T14:12:05.980

嗨，您可以在文本框的 textchanged 事件中执行类似的操作。

这是一个演示

```
 private void textBox1_TextChanged(object sender, EventArgs e)
    {
        string actualdata = string.Empty;
        char[] entereddata = textBox1.Text.ToCharArray();
        foreach (char aChar in entereddata.AsEnumerable())
        {
            if (Char.IsDigit(aChar))
            {
                actualdata = actualdata + aChar;
                // MessageBox.Show(aChar.ToString());
            }
            else
            {
                MessageBox.Show(aChar + " is not numeric");
                actualdata.Replace(aChar, ' ');
                actualdata.Trim();
            }
        }
        textBox1.Text = actualdata;
    } 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2014-07-23T22:59:26.643

似乎这个问题的许多当前答案都是手动解析输入文本。如果您正在寻找特定的内置数​​字类型（例如`int`or `double`），为什么不将工作委托给该类型的`TryParse`方法呢？例如：

```
public class IntTextBox : TextBox
{
    string PreviousText = "";
    int BackingResult;

    public IntTextBox()
    {
        TextChanged += IntTextBox_TextChanged;
    }

    public bool HasResult { get; private set; }

    public int Result
    {
        get
        {
            return HasResult ? BackingResult : default(int);
        }
    }

    void IntTextBox_TextChanged(object sender, EventArgs e)
    {
        HasResult = int.TryParse(Text, out BackingResult);

        if (HasResult || string.IsNullOrEmpty(Text))
        {
            // Commit
            PreviousText = Text;
        }
        else
        {
            // Revert
            var changeOffset = Text.Length - PreviousText.Length;
            var previousSelectionStart =
                Math.Max(0, SelectionStart - changeOffset);

            Text = PreviousText;
            SelectionStart = previousSelectionStart;
        }
    }
} 
```

如果您想要更通用但仍与 Visual Studio 的设计器兼容的东西：

```
public class ParsableTextBox : TextBox
{
    TryParser BackingTryParse;
    string PreviousText = "";
    object BackingResult;

    public ParsableTextBox()
        : this(null)
    {
    }

    public ParsableTextBox(TryParser tryParse)
    {
        TryParse = tryParse;

        TextChanged += ParsableTextBox_TextChanged;
    }

    public delegate bool TryParser(string text, out object result);

    public TryParser TryParse
    {
        set
        {
            Enabled = !(ReadOnly = value == null);

            BackingTryParse = value;
        }
    }

    public bool HasResult { get; private set; }

    public object Result
    {
        get
        {
            return GetResult<object>();
        }
    }

    public T GetResult<T>()
    {
        return HasResult ? (T)BackingResult : default(T);
    }

    void ParsableTextBox_TextChanged(object sender, EventArgs e)
    {
        if (BackingTryParse != null)
        {
            HasResult = BackingTryParse(Text, out BackingResult);
        }

        if (HasResult || string.IsNullOrEmpty(Text))
        {
            // Commit
            PreviousText = Text;
        }
        else
        {
            // Revert
            var changeOffset = Text.Length - PreviousText.Length;
            var previousSelectionStart =
                Math.Max(0, SelectionStart - changeOffset);

            Text = PreviousText;
            SelectionStart = previousSelectionStart;
        }
    }
} 
```

最后，如果您想要一些完全通用的东西并且不关心 Designer 支持：

```
public class ParsableTextBox<T> : TextBox
{
    TryParser BackingTryParse;
    string PreviousText;
    T BackingResult;

    public ParsableTextBox()
        : this(null)
    {
    }

    public ParsableTextBox(TryParser tryParse)
    {
        TryParse = tryParse;

        TextChanged += ParsableTextBox_TextChanged;
    }

    public delegate bool TryParser(string text, out T result);

    public TryParser TryParse
    {
        set
        {
            Enabled = !(ReadOnly = value == null);

            BackingTryParse = value;
        }
    }

    public bool HasResult { get; private set; }

    public T Result
    {
        get
        {
            return HasResult ? BackingResult : default(T);
        }
    }

    void ParsableTextBox_TextChanged(object sender, EventArgs e)
    {
        if (BackingTryParse != null)
        {
            HasResult = BackingTryParse(Text, out BackingResult);
        }

        if (HasResult || string.IsNullOrEmpty(Text))
        {
            // Commit
            PreviousText = Text;
        }
        else
        {
            // Revert
            var changeOffset = Text.Length - PreviousText.Length;
            var previousSelectionStart =
                Math.Max(0, SelectionStart - changeOffset);

            Text = PreviousText;
            SelectionStart = previousSelectionStart;
        }
    }
} 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2018-06-18T21:19:45.847

使用[Fabio Iotti 的回答](https://stackoverflow.com/a/28702150)中描述的方法，我创建了一个更通用的解决方案：

```
public abstract class ValidatedTextBox : TextBox {
    private string m_lastText = string.Empty;
    protected abstract bool IsValid(string text);
    protected sealed override void OnTextChanged(EventArgs e) {
        if (!IsValid(Text)) {
            var pos = SelectionStart - Text.Length + m_lastText.Length;
            Text = m_lastText;
            SelectionStart = Math.Max(0, pos);
        }
        m_lastText = Text;
        base.OnTextChanged(e);
    }
} 
```

“ValidatedTextBox”，其中包含所有重要的验证行为。剩下要做的就是从此类继承并使用所需的任何验证逻辑覆盖“IsValid”方法。例如，使用这个类，可以创建“RegexedTextBox”，它只接受匹配特定正则表达式的字符串：

```
public abstract class RegexedTextBox : ValidatedTextBox {
    private readonly Regex m_regex;
    protected RegexedTextBox(string regExpString) {
        m_regex = new Regex(regExpString);
    }
    protected override bool IsValid(string text) {
        return m_regex.IsMatch(Text);
    }
} 
```

之后，继承“RegexedTextBox”类，我们可以轻松创建“PositiveNumberTextBox”和“PositiveFloatingPointNumberTextBox”控件：

```
public sealed class PositiveNumberTextBox : RegexedTextBox {
    public PositiveNumberTextBox() : base(@"^\d*$") { }
}

public sealed class PositiveFloatingPointNumberTextBox : RegexedTextBox {
    public PositiveFloatingPointNumberTextBox()
        : base(@"^(\d+\" + CultureInfo.CurrentCulture.NumberFormat.NumberDecimalSeparator + @")?\d*$") { }
} 
```

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2021-06-06T09:54:13.043

这是使用 .NET 5/Core 实现此目的的一种简便快捷的方法

```
private void textBox1_KeyDown(object sender, KeyEventArgs e) {
  if (e.KeyData != Keys.Back)
    e.SuppressKeyPress = !int.TryParse(Convert.ToString((char) e.KeyData), out int _);
} 
```

编辑：添加了对退格键的支持

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2011-10-31T02:00:43.503

很抱歉唤醒死者，但我想有人可能会发现这对将来的参考很有用。

这是我的处理方式。它处理浮点数，但可以很容易地修改为整数。

基本上你只能按**0** - **9**和**.**

之前只能有一个**0** **。**

忽略所有其他字符并保持光标位置。

```
 private bool _myTextBoxChanging = false;

    private void myTextBox_TextChanged(object sender, EventArgs e)
    {
        validateText(myTextBox);
    }

    private void validateText(TextBox box)
    {
        // stop multiple changes;
        if (_myTextBoxChanging)
            return;
        _myTextBoxChanging = true;

        string text = box.Text;
        if (text == "")
            return;
        string validText = "";
        bool hasPeriod = false;
        int pos = box.SelectionStart;
        for (int i = 0; i < text.Length; i++ )
        {
            bool badChar = false;
            char s = text[i];
            if (s == '.')
            {
                if (hasPeriod)
                    badChar = true;
                else
                    hasPeriod = true;
            }
            else if (s < '0' || s > '9')
                badChar = true;

            if (!badChar)
                validText += s;
            else
            {
                if (i <= pos)
                    pos--;
            }
        }

        // trim starting 00s
        while (validText.Length >= 2 && validText[0] == '0')
        {
            if (validText[1] != '.')
            {
                validText = validText.Substring(1);
                if (pos < 2)
                    pos--;
            }
            else
                break;
        }

        if (pos > validText.Length)
            pos = validText.Length;
        box.Text = validText;
        box.SelectionStart = pos;
        _myTextBoxChanging = false;
    } 
```

这是一个快速修改的 int 版本：

```
 private void validateText(TextBox box)
    {
        // stop multiple changes;
        if (_myTextBoxChanging)
            return;
        _myTextBoxChanging = true;

        string text = box.Text;
        if (text == "")
            return;
        string validText = "";
        int pos = box.SelectionStart;
        for (int i = 0; i < text.Length; i++ )
        {
            char s = text[i];
            if (s < '0' || s > '9')
            {
                if (i <= pos)
                    pos--;
            }
            else
                validText += s;
        }

        // trim starting 00s 
        while (validText.Length >= 2 && validText.StartsWith("00")) 
        { 
            validText = validText.Substring(1); 
            if (pos < 2) 
                pos--; 
        } 

        if (pos > validText.Length)
            pos = validText.Length;
        box.Text = validText;
        box.SelectionStart = pos;
        _myTextBoxChanging = false;
    } 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2013-09-17T13:50:04.893

这个适用于复制和粘贴，拖放，按键，防止溢出并且非常简单

```
public partial class IntegerBox : TextBox 
{
    public IntegerBox()
    {
        InitializeComponent();
        this.Text = 0.ToString();
    }

    protected override void OnPaint(PaintEventArgs pe)
    {
        base.OnPaint(pe);
    }

    private String originalValue = 0.ToString();

    private void Integerbox_KeyPress(object sender, KeyPressEventArgs e)
    {
        originalValue = this.Text;
    }

    private void Integerbox_TextChanged(object sender, EventArgs e)
    {
        try
        {
            if(String.IsNullOrWhiteSpace(this.Text))
            {
                this.Text = 0.ToString();
            }
            this.Text = Convert.ToInt64(this.Text.Trim()).ToString();
        }
        catch (System.OverflowException)
        {
            MessageBox.Show("Value entered is to large max value: " + Int64.MaxValue.ToString(), "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
            this.Text = originalValue;
        }
        catch (System.FormatException)
        {                
            this.Text = originalValue;
        }
        catch (System.Exception ex)
        {
            this.Text = originalValue;
            MessageBox.Show(ex.Message, "Error", MessageBoxButtons.OK , MessageBoxIcon.Error);
        }
    }       
} 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2015-10-08T20:15:22.570

我也在寻找仅检查文本框中数字的最佳方法，而按键的问题是它不支持通过右键单击或剪贴板进行复制粘贴，因此提出了此代码，该代码验证光标何时离开文本字段并检查空字段。（新人改编版）

```
private void txtFirstValue_MouseLeave(object sender, EventArgs e)
{
    int num;
    bool isNum = int.TryParse(txtFirstValue.Text.Trim(), out num);

    if (!isNum && txtFirstValue.Text != String.Empty)
    {
        MessageBox.Show("The First Value You Entered Is Not a Number, Please Try Again", "Invalid Value Detected", MessageBoxButtons.OK, MessageBoxIcon.Error);
        txtFirstValue.Clear();
    }
} 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2016-06-30T06:26:23.307

不要忘记用户可以将无效文本粘贴到`TextBox`.

如果你想限制它，请按照以下代码：

```
private void ultraTextEditor1_TextChanged(object sender, EventArgs e)
{
    string append="";
    foreach (char c in ultraTextEditor1.Text)
    {
        if ((!Char.IsNumber(c)) && (c != Convert.ToChar(Keys.Back)))
        {

        }
        else
        {
            append += c;
        }
    }

    ultraTextEditor1.Text = append;
} 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2020-09-09T12:07:45.737

这里有30多个答案，很多答案很有帮助。但我想为**System.Windows.Forms.TextBox**和**System.Windows.Controls.TextBox**分享一个通用表单。

**System.Windows.Controls.TextBox**中没有可用的***KeyPress***事件。这个答案适用于那些想要为**System.Windows.Forms.TextBox**和**System.Windows.Controls.TextBox**实现相同逻辑的人。

 ******这是*NumberTextBox*代码。使用注释行代替**System.Windows.Controls.TextBox**的前一行。

```
public class NumberTextBox : System.Windows.Forms.TextBox
//public class NumberTextBox : System.Windows.Controls.TextBox
{
    private double _maxValue;
    private double _minValue;
    private bool _flag;
    private string _previousValue;

    public NumberTextBox()
    {
        this.TextAlign = HorizontalAlignment.Right;
        //TextAlignment = TextAlignment.Right;
        KeyDown += TextBox_KeyDown;
        TextChanged += TextBox_TextChanged;
        _minValue = double.MinValue;
        _maxValue = double.MaxValue;
    }

    private void TextBox_KeyDown(object sender, KeyEventArgs e)
    {
        _previousValue = this.Text;
        _flag = this.SelectedText.Length > 0;
    }

    private void TextBox_TextChanged(object sender, EventArgs e)
    //private void TextBox_TextChanged(object sender, TextChangedEventArgs e)
    {
        var text = this.Text;
        if (text.Length < 1) return;
        var cursorPosition = SelectionStart == 0 ? SelectionStart : SelectionStart - 1;
        var insertedChar = text[cursorPosition];
        if (IsInvalidInput(insertedChar, cursorPosition, text))
        {
            HandleText(text, cursorPosition);
        }
        ValidateRange(text, cursorPosition);
    }

    private bool IsInvalidInput(char insertedChar, int cursorPosition, string text)
    {
        return !char.IsDigit(insertedChar) && insertedChar != '.' && insertedChar != '-' ||
               insertedChar == '-' && cursorPosition != 0 ||
               text.Count(x => x == '.') > 1 ||
               text.Count(x => x == '-') > 1;
    }

    private void HandleText(string text, int cursorPosition)
    {
        this.Text = _flag ? _previousValue : text.Remove(cursorPosition, 1);
        this.SelectionStart = cursorPosition;
        this.SelectionLength = 0;
    }

    private void ValidateRange(string text, int cursorPosition)
    {
        try
        {
            if (text == "." || _minValue < 0 && text == "-") return;
            var doubleValue = Convert.ToDouble(text);
            if (doubleValue > _maxValue || doubleValue < _minValue)
            {
                HandleText(text, cursorPosition);
            }
        }
        catch (Exception)
        {
            HandleText(text, cursorPosition);
        }
    }

    protected void SetProperties(double minValue = double.MinValue, double maxValue = double.MaxValue)
    {
        _minValue = minValue;
        _maxValue = maxValue;
    }       

} 
```

*PositiveNumberTextBox*代码：

```
public class PositiveNumberTextBox : NumberTextBox
{
    public PositiveNumberTextBox()
    {
        SetProperties(0);
    }
} 
```

*分数文本框*代码：

```
public class FractionNumberTextBox : NumberTextBox
{
    public FractionNumberTextBox()
    {
        SetProperties(0, 0.999999);
    }
} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2011-11-20T05:14:25.350

```
int Number;
bool isNumber;
isNumber = int32.TryPase(textbox1.text, out Number);

if (!isNumber)
{ 
    (code if not an integer);
}
else
{
    (code if an integer);
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2012-08-09T02:07:23.283

3 解决方案

1)

```
//Add to the textbox's KeyPress event
//using Regex for number only textBox

private void txtBox_KeyPress(object sender, KeyPressEventArgs e)
{
if (!System.Text.RegularExpressions.Regex.IsMatch(e.KeyChar.ToString(), "\\d+"))
e.Handled = true;
} 
```

2）msdn的另一个解决方案

```
// Boolean flag used to determine when a character other than a number is entered.
private bool nonNumberEntered = false;
// Handle the KeyDown event to determine the type of character entered into the     control.
private void textBox1_KeyDown(object sender, KeyEventArgs e)
{
// Initialize the flag to false.
nonNumberEntered = false;
// Determine whether the keystroke is a number from the top of the keyboard.
if (e.KeyCode < Keys.D0 || e.KeyCode > Keys.D9)
{
    // Determine whether the keystroke is a number from the keypad.
    if (e.KeyCode < Keys.NumPad0 || e.KeyCode > Keys.NumPad9)
    {
        // Determine whether the keystroke is a backspace.
        if (e.KeyCode != Keys.Back)
        {
            // A non-numerical keystroke was pressed.
            // Set the flag to true and evaluate in KeyPress event.
            nonNumberEntered = true;
        }
    }
} 
```

}

```
private void textBox1_KeyPress(object sender, KeyPressEventArgs e)
{
    if (nonNumberEntered == true)
    {
       MessageBox.Show("Please enter number only..."); 
       e.Handled = true;
    }
} 
```

来源 [http://msdn.microsoft.com/en-us/library/system.windows.forms.control.keypress(v=VS.90).aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.keypress(v=VS.90).aspx)

3) 使用 MaskedTextBox：http: [//msdn.microsoft.com/en-us/library/system.windows.forms.maskedtextbox.aspx](http://msdn.microsoft.com/en-us/library/system.windows.forms.maskedtextbox.aspx)

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2013-08-25T11:49:10.197

在按钮单击中，您可以通过 for 循环检查文本框的文本：

```
char[] c = txtGetCustomerId.Text.ToCharArray();
bool IsDigi = true;

for (int i = 0; i < c.Length; i++)
     {
       if (c[i] < '0' || c[i] > '9')
      { IsDigi = false; }
     }
 if (IsDigi)
    { 
     // do something
    } 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2013-09-24T21:01:58.683

更简单的答案：

```
_textBox.TextChanged += delegate(System.Object o, System.EventArgs e)
{
    TextBox _tbox = o as TextBox;
    _tbox.Text = new string(_tbox.Text.Where(c => (char.IsDigit(c)) || (c == '.')).ToArray());
}; 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2014-04-09T13:50:19.980

**FAIL-SAFE**和简单的“递归”方法，可用于多个文本框。

它阻止了错误的键盘键入的字符以及粘贴的值等。它只接受整数，**最大数字长度是字符串类型的最大长度**（它是 int，真的很长！）

```
public void Check_If_Int_On_TextChanged(object sender, EventArgs e)
{
   // This method checks that each inputed character is a number. Any non-numeric
   // characters are removed from the text

   TextBox textbox = (TextBox)sender;

   // If the text is empty, return
   if (textbox.Text.Length == 0) { return; }

   // Check the new Text value if it's only numbers
   byte parsedValue;
   if (!byte.TryParse(textbox.Text[(textbox.Text.Length - 1)].ToString(), out parsedValue))
   {
      // Remove the last character as it wasn't a number
      textbox.Text = textbox.Text.Remove((textbox.Text.Length - 1));

      // Move the cursor to the end of text
      textbox.SelectionStart = textbox.Text.Length;
    }
 } 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2015-07-04T17:42:52.313

我喜欢简洁的代码

```
 private void xmm_textbox_KeyPress(object sender, KeyPressEventArgs e) {
        double x;
        e.Handled = !double.TryParse(((TextBox)sender).Text, out x);
    } 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2016-07-28T03:31:09.703

```
Here is a simple solution that works for me.

public static bool numResult;
    public static bool checkTextisNumber(string numberVal)
    {
        try
        {
            if (numberVal.Equals("."))
            {
                numResult = true;
            }
            else if (numberVal.Equals(""))
            {
                numResult = true;
            }
            else
            {
                decimal number3 = 0;
                bool canConvert = decimal.TryParse(numberVal, out number3);
                if (canConvert == true)
                {
                    numResult = true;
                }
                else
                    numResult = false;
            }

        }
        catch (System.Exception ex)
        {
            numResult = false;
        }
        return numResult;
    }
    string correctNum;
    private void tBox_NumTester_TextChanged(object sender, TextChangedEventArgs e)
    {

        if(checkTextisNumber(tBox_NumTester.Text))
        {
            correctNum = tBox_NumTester.Text;
        }
        else
        {
            tBox_NumTester.Text = correctNum;
        }

    } 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2018-02-22T06:35:57.617

我为各种验证创建了一个**可重用的文本框扩展类，并考虑分享它。**

您需要做的就是引发一个**TextChange 事件**，然后调用 Validate 方法。它看起来像这样：

```
private void tbxAmount_TextChanged(object sender, EventArgs e)
{ 
    tbxAmount.Validate(TextValidator.ValidationType.Amount);
} 
```

这是扩展类：

```
public static class TextValidator
{
    public enum ValidationType
    {
        Amount,
        Integer
    }

    /// <summary>
    /// Validate a textbox on text change.
    /// </summary>
    /// <param name="tbx"></param>
    /// <param name="validationType"></param>
    public static void Validate(this TextBox tbx, ValidationType validationType)
    {
        PerformValidation(tbx, validationType);
        tbx.Select(tbx.Text.Length, 0);
    }

    private static void PerformValidation(this TextBox tbx, ValidationType validationType)
    {
        char[] enteredString = tbx.Text.ToCharArray();
        switch (validationType)
        {
            case ValidationType.Amount:
                tbx.Text = AmountValidation(enteredString);
                break;

            case ValidationType.Integer:
                tbx.Text = IntegerValidation(enteredString);
                break;

            default:
                break;
        }

        tbx.SelectionStart = tbx.Text.Length;
    }

    private static string AmountValidation(char[] enteredString)
    {
        string actualString = string.Empty;
        int count = 0;
        foreach (char c in enteredString.AsEnumerable())
        {
            if (count >= 1 && c == '.')
            { actualString.Replace(c, ' '); actualString.Trim(); }
            else
            {
                if (Char.IsDigit(c))
                {
                    actualString = actualString + c;
                }

                if (c == '.')
                {
                    actualString = actualString + c; count++;
                }

                else
                {
                    actualString.Replace(c, ' ');
                    actualString.Trim();
                }
            }
        }
        return actualString;
    }

    private static string IntegerValidation(char[] enteredString)
    {
        string actualString = string.Empty;
        foreach (char c in enteredString.AsEnumerable())
        {
            if (Char.IsDigit(c))
            {
                actualString = actualString + c;
            }
            else
            {
                actualString.Replace(c, ' ');
                actualString.Trim();
            }
        }
        return actualString;
    }
} 
```

[你可以在这里找到完整的代码](https://gist.github.com/zaagan/e1a87ec3d411ba39f0d7d1e7e52660f8#file-textbox-validator)

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2020-03-02T19:55:33.040

您可以通过这个简单的代码简单地防止添加非数字字符

```
 if (long.TryParse(TextBox.Text,out long isparsable))
        {
          // your code to handle numbers
        }
        else
        {
            TextBox.Text="Only Numbers Allowed";
            TextBox.Focus();
            TextBox.SelectAll();
        } 
```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2020-07-09T15:48:42.960

使用正则表达式验证器：

```
<asp:TextBox ID="TextBoxNum" runat="server"></asp:TextBox><br />
<asp:RegularExpressionValidator ID="RegularExpressionValidator1"
                        ControlToValidate="TextBoxNum" runat="server"
                        ErrorMessage="Only numbers allowed"
                        ValidationExpression="\d+">
</asp:RegularExpressionValidator> 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2020-09-13T14:51:42.670

最简单粗暴的方法是使用组合框而不是带有 ReadOnly 的文本框。但当然，如果您希望用户使用一组体面且合理的整数，而不是试图触及无穷大，它当然有用。

* * *

## 回答 #40

> 赞同：-1
> 
> 时间：2019-09-05T16:15:02.990

WPF 的工作解决方案和一个简单的`TextChangedEventArgs`.

```
private void TextBox_TextChanged(object sender, TextChangedEventArgs e)
{
    var TextBox = (sender as TextBox);

    // if not a numeric value, remove news characters
    if (Regex.IsMatch(TextBox.Text, "[^0-9]"))
    {
        foreach (TextChange Change in e.Changes)
        {
            TextBox.Text = TextBox.Text.Remove(Change.Offset, Change.AddedLength);

            TextBox.CaretIndex = Change.Offset;
        }
    }
} 
```

# .net - 来自扩展方法的 ArgumentNullException 或 NullReferenceException？

> ID：463302
> 
> 赞同：43
> 
> 时间：2009-01-20T21:56:43.300
> 
> 标签：.net, exception, extension-methods

当在空实例上调用扩展方法时（扩展方法不允许），您认为最好的异常类型是什么？由于扩展方法只不过是静态方法，您可以争辩说它应该是 ArgumentNullException，但另一方面，它们像实例方法一样使用，因此使用 NullReferenceException 可能更自然。让我们看下面的例子：

```
public static string ToInvariantString(this IFormattable value, string format)
{
    return value.ToString(format, CultureInfo.InvariantCulture);
} 
```

这样，如果 value 参数为 null，则会抛出 NullReferenceException。

另一个例子是：

```
public static string ToInvariantString(this IFormattable value, string format)
{
    if (value == null) throw new ArgumentNullException("value");
    return value.ToString(format, CultureInfo.InvariantCulture);
} 
```

**编辑：** 在您指出的一些答案中，可以像静态方法一样调用扩展方法，在这种情况下，空引用异常是错误的，这是一个很好的观点，实际上是我的担忧之一，不知道为什么我忘了首先在问题中提到这一点。

也有人指出，抛出 NullReferenceException 是错误的，没错，就是这样。这就是我不扔它的原因，我只是让它发生（让 CLR 扔它），而不是保护方法。

我认为我赞成 ArgumentNullException （这是我迄今为止使用的），但我仍然认为至少有反对 NullReferenceException 的空间，因为它在大多数将要使用该方法的地方看起来更自然。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-20T22:06:46.320

通常，包括异常在内，您应该将扩展方法视为普通的静态方法。在这种情况下，您应该抛出 ArgumentNullException。

由于几个原因，在这里抛出 NullReferenceException 是一个坏主意

*   空引用实际上并没有发生，所以看到一个是违反直觉的
*   抛出 NullReferenceException 并导致 NullReferenceException 发生会产生明显不同的异常（查看差异的一种方法是错误代码）。CLR 引发的许多异常都是如此。

请参阅[何时可以捕获 StackOverflowException](https://docs.microsoft.com/en-us/archive/blogs/jaredpar/when-can-you-catch-a-stackoverflowexception)（我在此主题上发表的一篇文章）。

*   像调用常规方法一样调用扩展方法是完全合法的。在那种情况下，我当然不会排除 NullReferenceException，而是 ArgumentNullException。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-01-20T22:52:40.270

除了所有其他答案（很好）之外，我认为值得看看微软为了一致性所做的事情......据我所知，Enumerable 中的扩展方法都会抛出 ArgumentNullException 。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-20T22:01:24.413

由于可以在 C# 2.0 中使用扩展方法，并且可以像调用静态方法一样调用它们（您不必将它们用作扩展方法），因此您应该使用 ArgumentNullException。

仅仅因为它们*看起来*像类型上的方法并不意味着它们是，或者总是被称为一个。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-20T21:59:03.230

从用户的角度来看，该方法看起来和行为都像一个实例方法，所以如果我是他们，我希望看到 NullReferenceException。

也就是说，我建议在代码中明确地抛出一个或另一个，而不是像第一个示例中那样“发生”抛出一个。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-20T22:01:01.043

参数空异常。*不需要*像调用实例方法一样调用扩展方法。您可以像调用普通方法一样调用它们。在这种情况下，NullReferenceException 将是完全不正确的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-02-28T14:03:40.930

更令人困惑的是，微软两者都做，投掷`ArgumentNullExceptions`和`NullReferenceExceptions`.

这个引发隐含`NullReferenceException`的示例来自 Roslyn (src\Workspaces\CSharp\Portable\Extensions\StringExtensions.cs)：

```
internal static class StringExtensions
{
    public static string EscapeIdentifier(
        this string identifier,
        bool isQueryContext = false)
    {
        var nullIndex = identifier.IndexOf('\0');
        if (nullIndex >= 0)
        {
            identifier = identifier.Substring(0, nullIndex);
        }

        var needsEscaping = SyntaxFacts.GetKeywordKind(identifier) != SyntaxKind.None;

        // Check if we need to escape this contextual keyword
        needsEscaping = needsEscaping || (isQueryContext && SyntaxFacts.IsQueryContextualKeyword(SyntaxFacts.GetContextualKeywordKind(identifier)));

        return needsEscaping ? "@" + identifier : identifier;
    } 
```

这个`ArgumentNullException`从 .NET Framework (System.Core/System/Linq/Enumerable.cs) 抛出的扩展方法：

```
public static IEnumerable<TResult> Select<TSource, TResult>(this IEnumerable<TSource> source, Func<TSource, TResult> selector) {
            if (source == null) throw Error.ArgumentNull("source");
            if (selector == null) throw Error.ArgumentNull("selector");
            if (source is Iterator<TSource>) return ((Iterator<TSource>)source).Select(selector);
            if (source is TSource[]) return new WhereSelectArrayIterator<TSource, TResult>((TSource[])source, null, selector);
            if (source is List<TSource>) return new WhereSelectListIterator<TSource, TResult>((List<TSource>)source, null, selector);
            return new WhereSelectEnumerableIterator<TSource, TResult>(source, null, selector);

   } 
```

正如上面评论中提到的，我建议将扩展方法完全实现为实例方法，因此`NullReferenceException`如果`this`-parameter 为，则抛出 a `null`。如果有人不恰当地调用我的扩展方法，他们可以自由地这样做，但也必须期待不恰当的行为（a`NullReferenceException`而不是 an `ArgumentNullException`）。但是，如果他们按预期调用该方法，他们也应该得到预期的行为：完全一致的体验。

```
//Instance method
string foo = null;
foo.Trim(); 
```

和

```
//Extension method
string foo = null;
foo.Right(10); 
```

它们看起来相似，行为也应该相似，程序员甚至不需要知道它是实例还是扩展方法。

# .net - 在 C# dll 中缓存数据的最佳方法是什么？

> ID：463312
> 
> 赞同：7
> 
> 时间：2009-01-20T21:58:58.350
> 
> 标签：.net, file, dll, caching, dependencies

我编写了一个可以以多种方式使用的 DLL（由 ASP.NET 网站、WinForms 等引用）。它需要从几个分隔文件中加载其数据，这些文件将在半定期的基础上自动更新。出于性能原因，我将数据加载到静态对象（通用列表）中，并且只想在数据更改时返回文件。（数据量不会占用不合理的内存量，但每次访问时从文件中读取确实需要很长时间）。我试过使用 FileSystemWatcher，但事实证明这是不可靠的——它会定期错过文件更新。由于我不能指望在网站内运行的 DLL，因此 ASP.NET CacheDependency 选项似乎不合适。有没有人找到解决这种事情的好方法？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-28T04:37:52.697

ASP.NET 缓存和关联的 CacheDependency 不依赖于 ASP.NET、IIS 或 Web 服务器。您可以自由地将它用于这种确切的情况。与企业库缓存应用程序块相比，它需要的工作量要少得多，并且使用和记录得更广泛。

一些额外的参考： [http ://aspalliance.com/1705_A_New_Approach_to_HttpRuntimeCache_Management.all](http://aspalliance.com/1705_A_New_Approach_to_HttpRuntimeCache_Management.all)

如果要在 DLL 中使用 ASP.NET 缓存逻辑，只需将其包装并引用它，如下所示：

```
using System.Web.Caching;
...
var cache = HttpRuntime.Cache;
cache.Insert("foo", foo); 
```

此代码以及您希望添加到其中的任何 FileSystemDependency 将在您的库中同样有效，无论它是否在 Web、winform、控制台或服务上下文中运行。

如果您想确保使用与 Web 相同的缓存，您也可以这样做，但它是可选的：

```
HttpContext context = HttpContext.Current;
            if(context != null)
            {
                _cache = context.Cache;
            }
            else
            {
                _cache = HttpRuntime.Cache;
            } 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-20T22:03:51.257

您是否查看过[Enterprise Library Caching 应用程序块](http://msdn.microsoft.com/en-us/library/cc309502.aspx)？它允许对许多不同的事件进行缓存失效，包括文件更改 (AFAIK)，并且不需要 ASP.NET（然而，与它很好地集成）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-20T22:05:27.040

您可以将上次从文件加载的日期保存为同一目录中的另一个文件，或者保存在类中的静态日期时间中。我认为最后一个解决方案可能不是你想要的，因为你不能指望你的类被加载。我还会考虑保存和比较文件的 MD5 哈希，以查看它何时更改。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-20T23:16:07.117

我对这个问题的解决方案是定期重新加载数据文件：例如每小时一次。这取决于您的程序拥有准确的最新数据的重要性。

也许需要一种混合方法。使用 FileSystemWatcher，但也要保存最后一个文件的日期/时间（如上所述），并定期检查文件上的当前日期/时间。如果它们不同，则重新加载文件。如果保持数据最新很重要，那将是我的首选解决方案。

您还可以构建一种在需要重新加载数据时通知程序的方式。

# .net - 如何动态刷新 .NET 数据绑定转发器控件

> ID：463317
> 
> 赞同：8
> 
> 时间：2009-01-20T22:00:09.703
> 
> 标签：.net, data-binding, refresh, repeater, databound

我有一个指向列表的`.NET repeater`控件。`data-bound`作为中继器的一部分`Item Collection`，我有一个“删除按钮”，可以有效地删除这个当前的列表元素。

这有效，在代码隐藏中我可以成功地从*Repeater*`datasource`中删除一个项目。

 *我的问题是**：**当我重置更新`datasource`并`MyRepeater.DataBind()`再次调用时，*Repeater*界面不会刷新并删除项目。

我正在寻找基于更新的列表实质上重绘或刷新*中继器的事件。*感谢您提供任何指示或示例。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-20T22:20:05.250

您需要在数据源上调用“DataBind”方法，*然后*在 Repeater 控件上调用“DataBind”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T22:07:29.907

您是否正在提供刷新的数据源？

如果您在代码隐藏中设置数据源，则需要使用刷新的数据对其进行设置，然后调用 DataBind 方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-12-26T19:13:48.310

我在Repeater Control 和DataTable 源中遇到了类似的情况。

DataTable 中没有 Refresh 方法，但在初始页面加载时调用 DataTable.EnableDynamicData(typeof(DataTable)) 解决了问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T22:16:37.550

强制数据绑定通常在**PreRender**事件中完成自动数据绑定的地方完成。

通常，如果您在单击事件中进行了删除，则中继器应自行刷新，因为在 preRender 中自动刷新，页面上的控件是 DataBind()。这是微软的文档所说的：

> PreRender ：在此事件发生之前，每个设置了 DataSourceID 属性的数据绑定控件都会调用其 DataBind 方法。

[来源](http://msdn.microsoft.com/en-us/library/ms178472.aspx)

所以可能你影响了 Youritem.DataSource = List，但 MS 建议做 YourItem.DataSourceID = List.ID，或类似的东西。

希望能帮助到你

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T16:32:07.350

我遇到了类似的情况......一个绑定到 xmlDataSource 的转发器，都在 UpdatePanel 内。我想让用户一次输入一个名称，然后单击“添加”按钮以更新转发器中的列表。

我在转发器和 xmlDataSource 上将“EnableViewState”设置为 False，并将 xmlDataSource 上的“EnableCaching”也设置为 False。我设置了xmlDataSource的Data属性，xmlDataSource调用DataBind，设置repeater的DataSourceID属性，repeater调用DataBind。也许那是矫枉过正……但它奏效了。也许这会有所帮助。

更新：我发现通过在转发器控件上将 EnableViewState 设置为 False，我的 ItemCommand 事件不会触发。但我认为您只需将数据源的 EnableViewState/EnableCaching 设置为 False...我已将中继器的 EnableViewState 设置返回为 True，现在一切正常。

# linux - 是否可以通过 LKM 添加系统调用？

> ID：463332
> 
> 赞同：10
> 
> 时间：2009-01-20T22:03:40.400
> 
> 标签：linux, kernel-module

我想通过 LKM 添加一个新的系统调用，但我不知道该怎么做。也就是说，我知道如果我想添加一个全新的系统调用，我可以查看 sys_call_table 并找到一个`sys_ni_syscall`并替换它，但我很好奇是否可以实际**添加**到`sys_call_table`. 我意识到这可能是**不可能**的，因为它是一个固定大小的数组，但我想知道是否有任何其他聪明的方法来添加系统调用而不覆盖未使用的系统调用号。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T06:03:54.797

这是一个示例
[linux 系统调用](http://www.ibm.com/developerworks/library/l-system-calls/)

编辑：
上面的示例显示了如何实现系统调用，就从可加载模块实现系统调用而言；AFAIK，这是不可能的，除非您在哪里覆盖现有的，因为数组的大小是#define。

请记住，至少如果您希望能够实际使用新的系统调用，还需要更改用户空间。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T05:04:51.873

检查 Linux 文档项目网站以获取“Linux 内核模块编程指南”（[http://www.tldp.org/LDP/lkmpg/2.6/html/index.html](http://www.tldp.org/LDP/lkmpg/2.6/html/index.html)）。具体来说，在此处查找系统调用：[http](http://www.tldp.org/LDP/lkmpg/2.6/html/x978.html) ://www.tldp.org/LDP/lkmpg/2.6/html/x978.html 。至少，这应该给你一个开始。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-11-12T20:33:11.687

这是一个老问题，但我还是想提出我的解决方案。实现“类系统调用”环境的最简单方法是依赖假设备。特别是，您可以创建一个实际上不驱动任何东西的新设备驱动程序。然而，在其上书写可能会导致已安装的模块执行所需的操作。此外，如果您想提供多种服务，您可以将它们映射到`ioctl`操作。

# javascript - 多个锚链接引用可在 JavaScript 中使用的单个值的最佳方式

> ID：463333
> 
> 赞同：0
> 
> 时间：2009-01-20T22:03:47.200
> 
> 标签：javascript, mootools, metadata

我在页面上有任意数量的锚链接，需要在点击时执行相同的 JavaScript 代码块，并且该代码需要与一个值相关联。每页都有几个。我通常使用隐藏输入以一对一的关系存储值，但是将放置在整个页面中的多个链接与值相关联的最佳方法是什么？

例如，考虑一组按 ID 引用产品的链接，并且都显示该产品的相同动态层。现在可能有一组产品的多组链接。我如何绘制这些关联？我正在使用 Mootools 并按类绑定事件，所以我不想要一堆传递参数的内联事件函数调用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T22:23:17.707

如果您已经在使用 Mootools，一个很好的方法是使用元素的[数据存储](http://mootools.net/docs/Element/Element#Element:store)。

```
window.addEvent('domready', function() {
  $$('a.classname').each(function(el) {
    el.store('productID', /*get this however you want*/);

    el.addEvent('click', function(e) {
      var productID = el.retrieve('productID');
    }
  }
} 
```

这是获取 productID 的一种方法（假设您可以控制 URL 格式）：

```
<a href='ViewProduct.php?ProductID=7#pid:7'>link</a>

//in your js (above)
var pid = el.get('href').split('#')[1].split(':')[1];
el.store('productID', pid); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T22:18:52.847

你想在你的 html 代码中设置值吗？否则，您可以将值动态添加到 dom 节点本身。

如果您想在 html 中设置它们，如果您不关心标准合规性，请使用自定义属性。如果您确实关心，请将值编码为类名或使用`lang`-attribute 并在您的数据前加上“x-”，以便您保持符合 RFC 1766。

# sql - 在 TSQL 中对 SELECT DISTINCT 使用 ORDER BY

> ID：463341
> 
> 赞同：6
> 
> 时间：2009-01-20T22:06:52.030
> 
> 标签：sql, sql-server, tsql

我正在尝试检索按日期排序的日期字符串列表，如下所示...

```
SELECT DISTINCT CONVERT(Varchar(10), GeneratedDate, 101) AS GeneratedDate
FROM dbo.ProviderProcessGeneratedDate
ORDER BY GeneratedDate 
```

这按我将日期转换为的 varchar 排序。

例如...
02/01/2008
02/15/2008
02/21/2007
02/23/2007
02/29/2008

我已经使用内联查询解决了这个问题......

```
SELECT CONVERT(Varchar(10), a.GeneratedDate, 101) AS GeneratedDate
FROM (SELECT DISTINCT Convert(DATETIME,CONVERT(Varchar(10), GeneratedDate, 101)) AS GeneratedDate
      FROM dbo.ProviderProcessGeneratedDate) a
ORDER BY a.GeneratedDate DESC 
```

为了得到我真正想要的...
01/11/2008
01/04/2008
12/28/2007
12/21/2007

有没有更简单的方法？做这么简单的事情似乎需要做很多工作。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T00:42:02.823

您的第一个查询给出的顺序与您想要的不同的原因是......
- 您使用字段“GeneratedDate”来创建您的字符串
- 然后您将该结果字段别名为“GeneratedDate”
- 然后您按“GeneratedDate”排序而不指定表格
- 因此结果字段用于排序

其他答案中提到了简单的修复...

```
ORDER BY ProviderProcessGeneratedDate.GenerateDate 
```

通过指定表格没有混淆，你会得到你想要的结果。

[在旁边]

作为一项规则，我总是在我的字段前加上 [table]。以避免任何歧义。特别是因为我经常稍后回来并添加一个连接，从而强制使用 ned 作为表格名称。

另外，我给表名起了别名。不是像 [a] 这样的东西，而是像 [Dates] 这样有意义的东西。这缩短了查询，但也允许我更改正在使用的表，而无需在查询的其他部分更改对它的其他引用。

[旁白结束]

**编辑：**

我以谦卑自己的方式留下了我之前的答案。我真的应该得到一个家庭 sql 服务器，这样我就可以在发布我的答案之前尝试我的答案...... ***道歉*

正如评论所述，如果它不在 SELECT DISTINCT 中，您可能不会在 ORDER BY 中指定某些内容。

因此，我会尝试使用 GROUP BY ...

```
SELECT
    Convert(DATETIME,CONVERT(Varchar(10), GeneratedDate, 101))
FROM
    ProviderProcessGeneratedDate
GROUP BY
    GeneratedDate
ORDER BY
    GeneratedDate 
```

这假设 GeneratedDate 是 1:1 与您的 CONVERT 公式。例如，如果您的 GeneratedDate 字段中有 TIME，但 CONVERT 中的日期格式没有；您需要从 GeneratedDate 字段中删除时间...

```
SELECT
    Convert(DATETIME,CONVERT(Varchar(10), DATEADD(DAY, DATEDIFF(DAY, 0, GeneratedDate), 0), 101))
FROM
    ProviderProcessGeneratedDate
GROUP BY
    DATEADD(DAY, DATEDIFF(DAY, 0, GeneratedDate), 0)
ORDER BY
    DATEADD(DAY, DATEDIFF(DAY, 0, GeneratedDate), 0) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T22:12:27.603

```
 SELECT DISTINCT Convert(DATETIME,CONVERT(Varchar(10), GeneratedDate, 101)) 
                     AS GeneratedDate,
        A.GeneratedDate OrderByDate       
  FROM dbo.ProviderProcessGeneratedDate A
  Order By A.GeneratedDate Desc 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T22:14:55.570

只是添加到上面的答案...

您可以在 tsql 之外转换回字符串。只需返回 datetime 类型并在代码（显示层）中转换为您想要的日期格式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T05:41:05.297

如果您使用的是 SQL 2005 或 2008，也可以使用 CTE。

您的代码如下所示：

```
WITH Dates(GeneratedDate) AS
(
SELECT DISTINCT CONVERT(Varchar(10), GeneratedDate, 101) AS GeneratedDate
FROM dbo.ProviderProcessGeneratedDate
)

SELECT GeneratedDate FROM Dates ORDER BY GeneratedDate 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-20T22:12:41.910

我认为你可以使用：

```
ORDER BY dbo.ProviderProcessGeneratedDate.GeneratedDate 
```

强制它使用原始表中的值，而不是新修改的值？您甚至可以为 FROM 子句添加别名：

```
FROM dbo.ProviderProcessGeneratedDate ppgd 
```

这样您就可以在我的第一条语句中使用“ppgd”别名而不是整个表名。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-20T22:13:06.370

也许您只需要使用另一个字段别名，以便它使用日期而不是格式化字符串？IE

```
SELECT DISTINCT CONVERT(Varchar(10), GeneratedDate, 101) AS GeneratedDateString
FROM dbo.ProviderProcessGeneratedDate
ORDER BY GeneratedDate 
```

尽管在大多数情况下，您确实应该将日期保留为日期，并在可能的最后一刻在 UI 中进行任何所需的格式化。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-20T22:15:31.683

修改原始语句的 ORDER BY 以使用可排序的日期字符串：

```
SELECT DISTINCT CONVERT(Varchar(10), GeneratedDate, 101) AS GeneratedDate
FROM dbo.ProviderProcessGeneratedDate
ORDER BY CONVERT(Varchar(10), GeneratedDate, 112) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-21T06:36:09.927

使用`GROUP BY`代替`DISTINCT`：

```
SELECT 
    CONVERT(Varchar(10), GeneratedDate, 101) AS GeneratedDate
FROM 
    dbo.ProviderProcessGeneratedDate AS BaseDates
GROUP BY 
    BaseDates.GeneratedDate, 
    CONVERT(Varchar(10), GeneratedDate, 101)
ORDER BY 
    BaseDates.GeneratedDate 
```

# java - JPA 急切未加入

> ID：463349
> 
> 赞同：121
> 
> 时间：2009-01-20T22:11:33.283
> 
> 标签：java, hibernate, jpa, join

JPA 的 fetch 策略究竟控制什么？我无法发现急切和懒惰之间的任何区别。在这两种情况下，JPA/Hibernate 都不会自动加入多对一关系。

示例：人员只有一个地址。一个地址可以属于很多人。JPA 带注释的实体类如下所示：

```
@Entity
public class Person {
    @Id
    public Integer id;

    public String name;

    @ManyToOne(fetch=FetchType.LAZY or EAGER)
    public Address address;
}

@Entity
public class Address {
    @Id
    public Integer id;

    public String name;
} 
```

如果我使用 JPA 查询：

```
select p from Person p where ... 
```

JPA/Hibernate 生成一个 SQL 查询以从 Person 表中进行选择，然后为**每个**人生成一个不同的地址查询：

```
select ... from Person where ...
select ... from Address where id=1
select ... from Address where id=2
select ... from Address where id=3 
```

这对于大型结果集非常不利。如果有 1000 人，它会生成 1001 个查询（1 个来自 Person，1000 个来自 Address）。我知道这一点是因为我正在查看 MySQL 的查询日志。我的理解是，将地址的获取类型设置为 eager 会导致 JPA/Hibernate 自动使用连接进行查询。但是，无论获取类型如何，它仍然会为关系生成不同的查询。

只有当我明确告诉它加入时，它才会真正加入：

```
select p, a from Person p left join p.address a where ... 
```

我在这里错过了什么吗？我现在必须手动编写每个查询的代码，以便它离开多对一关系。我在 MySQL 中使用 Hibernate 的 JPA 实现。

**编辑：**它似乎不影响 JPA 查询（参见 Hibernate FAQ [here](http://www.hibernate.org/117.html#A13)和[here](http://www.hibernate.org/118.html#A23)） 。`FetchType`所以就我而言，我已经明确告诉它加入。

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2012-06-18T04:48:10.150

JPA 没有提供任何关于映射注释以选择获取策略的规范。通常，可以通过以下任何一种方式获取相关实体

*   SELECT => 一次查询根实体 + 一次查询相关映射实体/每个根实体的集合 = (n+1) 次查询
*   SUBSELECT => 一个查询根实体 + 第二个查询相关映射实体/在第一个查询中检索到的所有根实体的集合 = 2 个查询
*   JOIN => 一个查询来获取根实体及其所有映射实体/集合 = 1 个查询

所以`SELECT`和`JOIN`是两个极端`SUBSELECT`，介于两者之间。可以根据她/他的领域模型选择合适的策略。

默认情况下`SELECT`，JPA/EclipseLink 和 Hibernate 都使用。这可以通过使用覆盖：

```
@Fetch(FetchMode.JOIN) 
@Fetch(FetchMode.SUBSELECT) 
```

在休眠中。它还允许`SELECT`显式设置模式，使用`@Fetch(FetchMode.SELECT)`可以通过使用批量大小来调整的模式，例如`@BatchSize(size=10)`.

EclipseLink 中对应的注解有：

```
@JoinFetch
@BatchFetch 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-05-08T09:30:21.010

“MXC”是对的。`fetchType`只指定**何时**应该解决关系。

要通过使用外连接来优化急切加载，您必须添加

```
@Fetch(FetchMode.JOIN) 
```

到你的领域。这是一个特定于休眠的注释。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2009-02-02T19:50:59.023

fetchType 属性控制在获取主实体时是否立即获取带注释的字段。它不一定规定如何构造 fetch 语句，实际的 sql 实现取决于您使用的提供程序 toplink/hibernate 等。

如果设置`fetchType=EAGER`这意味着注释字段与实体中的其他字段同时填充其值。因此，如果您打开实体管理器检索您的人员对象，然后关闭实体管理器，随后执行 person.address 将不会导致引发延迟加载异常。

如果您设置`fetchType=LAZY`该字段仅在访问时填充。如果您已经关闭了实体管理器，那么如果您执行 person.address 将引发延迟加载异常。要加载字段，您需要使用 em.merge() 将实体放回 entitymangers 上下文，然后进行字段访问，然后关闭 entitymanager。

在构建包含客户订单集合的客户类时，您可能需要延迟加载。如果您在想要获取客户列表时检索了客户的每个订单，那么当您只查找客户姓名和联系方式时，这可能是一项昂贵的数据库操作。最好将数据库访问权限留到以后。

对于问题的第二部分 - 如何让休眠以生成优化的 SQL？

Hibernate 应该允许您提供有关如何构造最有效查询的提示，但我怀疑您的表构造有问题。表中是否建立了关系？Hibernate 可能已经决定一个简单的查询将比一个连接更快，尤其是在缺少索引等的情况下。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2011-03-10T15:10:58.897

尝试：

```
select p from Person p left join FETCH p.address a where... 
```

它对我来说与 JPA2/EclipseLink 类似，但似乎这个功能也存在于[JPA1](http://openjpa.apache.org/builds/1.2.0/apache-openjpa-1.2.0/docs/manual/jpa_langref.html#jpa_langref_fetch_joins)中：

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-08-20T12:18:38.587

如果您使用 EclipseLink 而不是 Hibernate，您可以通过“查询提示”优化您的查询。请参阅 Eclipse Wiki 中的这篇文章：[EclipseLink/Examples/JPA/QueryOptimization](http://wiki.eclipse.org/EclipseLink/Examples/JPA/QueryOptimization)。

有一章是关于“联读”的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2014-06-02T19:12:56.607

加入你可以做很多事情（使用eclipselink）

*   在 jpql 你可以做左连接提取

*   在命名查询中，您可以指定查询提示

*   在 TypedQuery 你可以说类似

    `query.setHint("eclipselink.join-fetch", "e.projects.milestones");`

*   还有批量获取提示

    `query.setHint("eclipselink.batch", "e.address");`

看

[http://java-persistence-performance.blogspot.com/2010/08/batch-fetching-optimizing-object-graph.html](http://java-persistence-performance.blogspot.com/2010/08/batch-fetching-optimizing-object-graph.html)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-12T11:04:32.747

除了 Person 类有一个嵌入的键类之外，我确实遇到了这个问题。我自己的解决方案是将它们加入查询并**删除**

`@Fetch(FetchMode.JOIN)`

我的嵌入式 id 类：

```
@Embeddable
public class MessageRecipientId implements Serializable {

    @ManyToOne(targetEntity = Message.class, fetch = FetchType.LAZY)
    @JoinColumn(name="messageId")
    private Message message;
    private String governmentId;

    public MessageRecipientId() {
    }

    public Message getMessage() {
        return message;
    }

    public void setMessage(Message message) {
        this.message = message;
    }

    public String getGovernmentId() {
        return governmentId;
    }

    public void setGovernmentId(String governmentId) {
        this.governmentId = governmentId;
    }

    public MessageRecipientId(Message message, GovernmentId governmentId) {
        this.message = message;
        this.governmentId = governmentId.getValue();
    }

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-20T22:24:56.423

我想到两件事。

首先，你确定你的地址是ManyToOne吗？这意味着多个人将拥有相同的地址。如果它是为其中之一编辑的，它将为所有它们进行编辑。这是你的意图吗？99% 的时间地址是“私人的”（从某种意义上说，它们只属于一个人）。

其次，您是否对 Person 实体有任何其他急切的关系？如果我没记错的话，Hibernate 只能处理一个实体上的一个急切关系，但这可能是过时的信息。

我这么说是因为您对这应该如何工作的理解从我现在的位置来看基本上是正确的。

# vbscript - 如何在 VB 脚本的对话框中自动回答是？

> ID：463359
> 
> 赞同：2
> 
> 时间：2009-01-20T22:14:07.630
> 
> 标签：vbscript

如何在 VB 脚本的对话框中自动回答是？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-20T22:26:03.270

SendKeys 可能会做你想做的事：http:
[//msdn.microsoft.com/en-us/library/8c6yea83 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/8c6yea83(VS.85).aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T22:21:05.667

最好的方法是改用[AutoIt](http://www.autoitscript.com/autoit3/)（或类似的东西）。VBScript 不提供本机执行此操作的方法。

# javascript - Javascript关闭警报框

> ID：463368
> 
> 赞同：41
> 
> 时间：2009-01-20T22:18:45.860
> 
> 标签：javascript, dialog, alert, dom-events

我希望能够在一段时间后或在特定事件（即`onkeypress`）后使用 Javascript 自动关闭警报框。根据我的研究，使用内置功能似乎不可能`alert()`。有没有办法覆盖它并控制它打开的对话框？

另外，我不希望将隐藏的 div 显示为警报的覆盖。我需要一个实际的对话框。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-20T23:43:30.243

如前所述，您真的不能这样做。您可以使用 UI 框架在窗口内创建一个模式对话框，或者您可以有一个弹出窗口，其中包含一个在超时后自动关闭的脚本......每个都有一个负面的方面。如果窗口被最小化，浏览器内的模态窗口将不会创建任何通知，并且现代浏览器和弹出窗口阻止程序可能会阻止程序化（基于计时器）弹出窗口。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2017-07-17T20:13:36.967

[看来您可以通过Notification](https://developer.mozilla.org/en-US/docs/Web/API/Notifications_API/Using_the_Notifications_API) API完成一些类似的事情。您无法控制它保持可见的时间（可能是某种操作系统偏好——除非您指定 requireInteraction 为真，否则它会永远保持或直到关闭或关闭它），并且它要求用户单击“允许通知”（不幸的是）首先，但这里是：

如果您希望它在 1 秒后关闭（所有操作系统至少保持打开 1 秒）：

```
var notification = new Notification("Hi there!", {body: "some text"});
setTimeout(function() {notification.close()}, 1000); 
```

如果您想显示比“默认”更长的时间，您可以绑定到 onclose 回调并显示另一个我想的重复通知来替换它。

[参考：受此](https://stackoverflow.com/a/19651500/32453)答案的启发，尽管该答案在现代 Chrome 中不再适用，但 Notification API 可以。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-01-20T22:23:30.547

无法控制对话框，如果您可以控制对话框，则可以编写突兀的 javascript 代码。（除了调试之外，对任何事情都使用警报不是一个好主意）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-20T22:27:43.970

> 我希望能够在一定时间后或在特定事件（即 onkeypress）后使用 javascript 自动关闭警报框

旁注：如果您有警报（“数据”），您将无法让代码在后台运行（AFAIK）...。对话框是一个模态窗口，所以你也不能失去焦点。所以你不会有任何按键或计时器运行......

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2017-09-01T09:39:48.387

尝试启动盒插件。

```
var alert = bootbox.alert('Massage')
alert.show();
setTimeout(function(){alert.modal('hide'); }, 4000); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-20T22:23:19.110

我想您可以打开一个弹出窗口并将*其*称为对话框。我不确定细节，但我很确定您可以通过编程方式关闭您从 javascript 打开的窗口。这样就够了吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-20T22:36:54.763

这里唯一真正的选择是使用某种带有模式选项的自定义小部件。查看 jQuery UI 以获得具有这些功能的对话框示例。几乎每个你能提到的 JS 框架中都存在类似的东西。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-01-20T22:24:28.657

如果您在 JS 中以编程方式执行此操作，则就像重新发明轮子一样。我推荐使用一个名为[jGrowl的](http://cool-javascripts.com/effects/jgrowl-to-show-unobtrusive-messages.html)[jQuery插件](http://jquery.com/)

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2019-11-06T18:23:24.903

你实际上可以做到这一点，你基本上可以听这个弹出窗口发生，然后在它“弹出”之前确认它是真的，

```
if(window.alert){
  return true
} 
```

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2012-02-27T06:07:26.483

您可以使用标签并设置其淡入和淡出时间，例如最初隐藏并在点击时显示。$('#div_Message').fadeIn(500).delay(1000).fadeOut(1500);

* * *

## 回答 #11

> 赞同：-5
> 
> 时间：2017-07-20T17:15:44.330

```
window.setTimeout('alert("Message goes here");window.close();', 5000); 
```

# sql - 如何将 DRY 原则应用于枢轴月份的 SQL 语句

> ID：463377
> 
> 赞同：0
> 
> 时间：2009-01-20T22:23:12.527
> 
> 标签：sql, sql-server, tsql, dry, pivot

我想知道其他人如何处理这种情况......以及如何将不要重复自己（DRY）原则应用于这种情况。

我发现自己经常 PIVOTing 或在 T-SQL 中编写 CASE 语句以将 Months 呈现为列。我通常有一些字段，其中包括 (1) 日期字段和 (2) 值字段。当我通过 ASPX 页面或 Reporting Services 将其呈现给用户时，我需要拥有最后最右边的 14 列才能具有这种模式：

[年],[一月],[二月],[三月],[四月],[五月],[六月],[七月],[八月],[九月],[十月],[十一月],[十二月] ]，[全部的]

其中 year 是 int 形式的年份，每个其他字段是该月的总和值字段（[Total] 除外，它是年份的总值字段）。

我想找到一种可重复使用的方法来处理这个问题。对所有建议开放 (T-SQL / ANSI SQL)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-20T23:26:15.537

这并不完全是您要寻找的，但我已经做了很多重复的工作`UNPIVOT`，通常，我会使用某种标准化命名和大量使用 CTE 来编写代码：

```
WITH P AS (
    SELECT Some Data
            ,[234] -- These are stats
            ,[235]
    FROM Whatever
     )
,FINAL_UNPIVOTED AS (
    SELECT Some Data
            ,[STAT]
    FROM P
    UNPIVOT (
        STAT FOR BASE IN ([234], [235]) 
    ) AS unpvt
    WHERE STAT <> 0
)
SELECT Some Data
              ,CONVERT(int, FINAL_UNPIVOTED.[BASE]) AS [BASE]
              ,FINAL_UNPIVOTED.[STAT]
FROM FINAL_UNPIVOTED 
```

您可以通过检查表或视图并使用如下代码生成代码：

```
DECLARE @sql_unpivot AS varchar(MAX)
SELECT @sql_unpivot = COALESCE(@sql_unpivot + ',', '') + COLUMN_NAME
FROM INFORMATION_SCHEMA.TABLES
WHERE TABLE_NAME = 'whatever' 
```

并将代码模板化：

```
SET @template = '
    WITH P AS (
        SELECT Some Data
                ,{@sql_unpivot}
                  FROM Whatever
         )
    ,FINAL_UNPIVOTED AS (
        SELECT Some Data
                ,[STAT]
        FROM P
        UNPIVOT (
            STAT FOR BASE IN ({@sql_unpivot}) 
        ) AS unpvt
        WHERE STAT <> 0
    )
    SELECT Some Data
                  ,CONVERT(int, FINAL_UNPIVOTED.[BASE]) AS [BASE]
                  ,FINAL_UNPIVOTED.[STAT]
    FROM FINAL_UNPIVOTED
'
SET @sql = REPLACE(@template, '{@sql_unpivot}', @sql_unpivot) 
```

等等

当然，可以动态运行此代码或创建和 SP，您可以换出临时创建的视图或表，以便为内联的内容获取元数据。

请参阅有关表值函数和 OUTER APPLY 技术的评论。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T22:28:38.507

已经很晚了，我可能在这里遗漏了一些明显的东西，但是每个月都有一行的 Months 表可以帮助你做到这一点吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T16:56:13.607

```
/* I leave year and month separate so you can use "real" Months or Fiscal Months */

CREATE FUNCTION [dbo].[fn_MonthValueColumns] 
(   
    @year int,
    @month int, 
    @measure int 
)
RETURNS TABLE 
AS
RETURN 
(
    SELECT @year as [Year],
        CASE WHEN @month = 1 THEN @measure ELSE 0 END AS [Jan], 
        CASE WHEN @month = 2 THEN @measure ELSE 0 END AS [Feb], 
        CASE WHEN @month = 3 THEN @measure ELSE 0 END AS [Mar], 
        CASE WHEN @month = 4 THEN @measure ELSE 0 END AS [Apr], 
        CASE WHEN @month = 5 THEN @measure ELSE 0 END AS [May], 
        CASE WHEN @month = 6 THEN @measure ELSE 0 END AS [Jun], 
        CASE WHEN @month = 7 THEN @measure ELSE 0 END AS [Jul], 
        CASE WHEN @month = 8 THEN @measure ELSE 0 END AS [Aug], 
        CASE WHEN @month = 9 THEN @measure ELSE 0 END AS [Sep], 
        CASE WHEN @month = 10 THEN @measure ELSE 0 END AS [Oct], 
        CASE WHEN @month = 11 THEN @measure ELSE 0 END AS [Nov], 
        CASE WHEN @month = 12 THEN @measure ELSE 0 END AS [Dec], 
        @measure AS [Total]
)

  /* 
   use a group by after your own CROSS APPLY to roll-up SUMs for the last 13 fields. 

   this function and a CROSS APPLY against 100000 records ran in 3 seconds.
   for what I am doing, I can live with that performance.
  */ 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T12:41:42.747

使用视图怎么样？

如果您总是使用同一张表/一组表，则视图可能有意义。警告：当使用大表的一小部分时，请注意这样的视图。视图可能会阻止优化器完成它的工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-07T15:04:14.263

正如[@Justice](https://stackoverflow.com/users/12349/justice)在评论中提到的那样，DRY 通常指的是可重用代码，这在您的 SQL 客户端语言中比在 SQL 中更容易。如果您愿意接受该选项（诚然，您可能不会），请考虑使用像[MyBatis](http://mybatis.org/)这样的数据映射器。提取到对象可能对您的追求有点过头了，但是创建 SQL 片段并在不同的查询中重用它们的能力听起来就像您追求的那样。

# javascript - 我正在使用两个 onready() 处理程序创建然后隐藏一个 jquery 时间条目，它会导致 IE7 和 Firefox 中的严重错误

> ID：463383
> 
> 赞同：2
> 
> 时间：2009-01-20T22:24:23.103
> 
> 标签：javascript, jquery, django

我在 onready() 处理程序中创建一个 jquery 时间条目，并将其隐藏在 jquery 的另一个 onready() 处理程序中。（在两个不同的 onread() 处理程序中调用代码的原因是时间条目是通过可重用的 Django 小部件渲染器创建的，并通过本地屏幕应用程序逻辑隐藏。）

如果您尝试在隐藏的输入字段上创建 jquery 时间条目，则 jquery 时间条目会出现严重错误。以下代码将在 IE7 和 Firefox 上导致致命错误。如果我在创建条目后隐藏（）条目一切正常，但我无法控制我的两个 onready() 处理程序的顺序（这是由于无法解决的框架问题。）这是一个错误在时间条目中，还是在浏览器中未定义的行为？有没有一种优雅的方法来解决这个问题，而无需特定的黑客来解决这个问题？

```
<html>
<head>
<script type="text/javascript" src="jquery_ui/jquery-1.3.js"></script>
<script type="text/javascript" src="jquery_ui/ui.core.js"></script>
<script type="text/javascript" src="jquery_time_entry/jquery.timeentry.js"></script>
<script type="text/javascript">
$(document).ready(function(){
 $('#id_testTimePicker').hide();
});
$(document).ready(function(){
    var id = "#id_testTimePicker";
    $(id).timeEntry({spinnerImage: '%sjquery_time_entry/timeEntry.png'
    , timeSteps: [1, 5, 1]});
    $(id).timeEntry('setTime', new Date());
});
</script>
</head>
<body>
<input id="id_testTimePicker"></input>
</body>
</html> 
```

更新：在上面的代码中，实际上只有“setTime”命令会导致浏览器错误。如果我将其更改为 $(id).setVal(str) ，其中 str 为小部件设置了正确的时间格式，那么一切正常。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T22:45:47.583

在第二个准备好的处理程序中，在调用 timeEntry 之前包含对“.show()”的调用，然后在之后再次调用“.hide()”。

也就是说，timeEntry 会关心它是否可见似乎很奇怪。这真的不重要，所以我猜这是timeEntry中的一个错误。

编辑：如果您不知道在第二个处理程序中是否应该隐藏它，只需使用 "$(id).is(':hidden')" 事先查询元素的状态并做出相应的行为。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T22:33:49.463

不能这样做吗？

```
$(document).ready(function(){
    var id = "#id_testTimePicker";
    $(id).timeEntry({spinnerImage: '%sjquery_time_entry/timeEntry.png'
    , timeSteps: [1, 5, 1]});
    $(id).timeEntry('setTime', new Date());
    $(id).hide();
}); 
```

# java - 如何在 Java 富客户端（LGPL、Apache、MIT 许可证）中显示 VNC 查看器？

> ID：463397
> 
> 赞同：1
> 
> 时间：2009-01-20T22:28:59.363
> 
> 标签：java, open-source

我正在寻找一种在厚/丰富的 java 客户端中显示 VNC 查看器的方法（具体来说，我正在使用 SWT，但如果我可以将它放入 AWT/Swing，我可以专门集成它。）这不是applet，而是一个真实的、活的、厚实的 java 客户端。

[TightVNC](http://www.tightvnc.com/download.html)可能就足够了；但是，它的 GPL 许可证对我的需求来说太严格了。

有人知道在限制较少的许可下可用的 Java VNC 库吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T23:05:01.033

迄今为止对选项的快速调查（在撰写本文时我还没有找到令人满意的答案）：

*   **[vncjlgpl](http://sourceforge.net/projects/vncjlgpl)** - 仅限服务器。也许我可以利用这里获得的知识来推出我自己的，这将使它成为一个衍生作品，可以是 LGPL 的。
*   **[TightVNC](http://www.tightvnc.com)** - 提供基于 Java 的查看器。我还没有查看源代码，但我假设它可以适当地重复使用。然而; 它的 GPL 许可证防止在我的伪商业产品中重复使用。
*   **[RealVNC](http://www.realvnc.com/support/javavncviewer.html)** - 提供作为 VNC 查看器的 Java 应用程序。商业产品。没有可用的来源。.jar 的公开安装（可通过 webstart 启动）在[此处](http://danielwebb.us/software/vnc/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-11T02:54:03.397

我不知道您是否还需要一些东西，但我发现 MetaVNC（在 sourceforge 上）Java 查看器使用起来非常简单。上一个模组是在 2007 年，所以看起来它没有得到维护，但它可能会给你基本的功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T03:19:07.610

[http://sourceforge.net/projects/vncjlgpl](http://sourceforge.net/projects/vncjlgpl)，可能吗？

编辑：没关系，那只是一个服务器。当我点击错误的链接时，我分心了。

# c# - 将事件分配给 Repeater 控件内的自定义控件

> ID：463398
> 
> 赞同：2
> 
> 时间：2009-01-20T22:29:13.343
> 
> 标签：c#, asp.net

我有一个Repeater 控件，它在它的某些单元格中包含一个包含DropDownList 的UserControl。在Repeater 控件的ItemDataBound 事件上，我将一个事件分配给DropDownList，如下所示：

```
protected void MyRepeater_ItemDataBound(object sender, RepeaterItemEventArgs e)  
{  
...  
MyControl myControl = (MyControl)e.Item.FindControl("MyControl01");  
myControl.DataSource = myObject;  
myControl.DataBind();  
myControl.DropDownList.SelectedItemChange += MyMethod_SelectedIndexChanged;  
myControl.DropDownList.AutoPostBack = true;  
....  
}  

protected void MyMethod_SelectedIndexChanged(object sender, EventArgs e)  
{  
//Do something.  
} 
```

该事件永远不会触发。请我需要帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-20T23:44:48.150

您的事件没有在 PostBack 中引发，因为您的事件处理程序尚未附加（它仅在您的转发器数据绑定时在页面生命周期的迭代期间附加）。

如果您在标记中以声明方式附加您的事件处理程序，例如：

```
<asp:Repeater ID="Repeater1" runat="server">
     <ItemTemplate>
         <asp:DropDownList ID="DropDownList1" runat="server" OnSelectedIndexChanged="DropDownList1_SelectedIndexChanged" />
    </ItemTemplate>
</asp:Repeater> 
```

然后您的事件处理程序将在 PostBacks 期间被调用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T23:55:24.977

您可以尝试以下两件事，看看是否有帮助：

1.  尝试在每个页面请求上绑定您的 MyRepeater，而不仅仅是在 !IsPostBack 时。
2.  在 OnInit 中绑定 MyRepeater。

对于 1) 如果您的动态创建的控件是在第一次加载页面时创建的，然后在回发发生时再次创建，ASP.NET 将注意到引发的事件匹配并触发该事件。

对于 2) 设计者总是在 OnInit 中放置事件附件，尽管它在 OnLoad 中也应该可以正常工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T00:25:28.817

首先确保您的数据绑定不会重置您的下拉菜单。

这是将嵌套在中继器 ItemTemplate 中的控件的代码

```
<%@ Control Language="C#" AutoEventWireup="true" CodeBehind="ListBoxContainer.ascx.cs" Inherits="OAAF.Common.ListBoxContainer" %>

<asp:ListBox ID="lstFromControl" runat="server" Rows="1" DataTextField="Text" DataValueField="Id" OnSelectedIndexChanged="LstFromControl_SelectedIndexChanged" AutoPostBack="true" /> 
```

将嵌套在中继器 ItemTemplate 中的控件背后的代码

```
public partial class ListBoxContainer : System.Web.UI.UserControl
{
    //declare the event using EventHandler<T>
    public event EventHandler<EventArgs> ListBox_SelectedIndexChanged;

    protected void Page_Load(object sender, EventArgs e)
    {
    }

    protected void LstFromControl_SelectedIndexChanged(object sender, EventArgs e)
    {
        //fire event: the check for null sees if the delegate is subscribed to
        if (ListBox_SelectedIndexChanged != null)
        {
            ListBox_SelectedIndexChanged(sender, e);
        }
    }
} 
```

请注意，上述控件在内部使用列表框更改事件，然后触发它自己的事件：ListBox_SelectedIndexChanged。您也可以在此处创建自定义事件参数，但这使用标准 EventArgs。

您的具有控制权的中继器可能看起来像这样

```
<asp:Repeater ID="rptTest" runat="server">
<ItemTemplate>
    <br />
    <ctrl:wucListBox ID="listBoxControl" runat="server" OnListBox_SelectedIndexChanged="ListBoxControl_SelectedIndexChanged" />
</ItemTemplate>    
</asp:Repeater> 
```

例如，在转发器所在的页面顶部注册控件

```
<%@ Register Src="~/Common/ListBoxContainer.ascx" TagName="wucListBox" TagPrefix="ctrl" %> 
```

它处理事件 ListBox_SelectedIndexChanged，处理此事件的方法位于转发器所在页面的代码后面。

```
 protected void ListBoxControl_SelectedIndexChanged(object sender, EventArgs e)
    {
        //some code
    } 
```

# erlang - 如何重命名运行 mnesia 数据库的节点

> ID：463400
> 
> 赞同：14
> 
> 时间：2009-01-20T22:30:20.110
> 
> 标签：erlang, mnesia

我在 machine1 上创建了一个 Mnesia 数据库/模式。该节点被命名为 mypl@machine1。然后我将所有文件移动到 machine2，因为 machine1 发生故障。只要代码以“mypl@machine1”的名称运行，一切都运行良好。显然这有点令人困惑，因为它现在在 machine2 上运行。

如果我使用节点名称“mypl@machine2”启动 Erlang，Mnesia 数据库将显示为空。

如何将 Mnesia 数据库中的节点从 machine1 重命名为 machine2？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-21T13:04:39.033

我不认为这可以在单个节点上在线完成（任何人？），但除了运行两个节点和添加表副本之外，还可以通过备份/恢复来完成。在[Mnesia 用户指南](http://erlang.org/doc/apps/mnesia/part_frame.html)第 6.9.1 节中，您会发现一些代码使用 mnesia:traverse_backup 来更改 mnesia 备份文件中模式表（如下所示）中的节点名称。您可能应该使用的模块名称是`mnesia_backup`.

使用此代码，您需要：

```
%% On mypl@machine1
mnesia:backup("/path/to/mnesia.backup").
change_node_name(mnesia_backup, mypl@machine1, mypl@machine2,
                 "/path/to/mnesia.backup", "/path/to/new.mnesia.backup").
%% On mypl@machine2
mnesia:restore("/path/to/new.mnesia.backup", []). 
```

我不确定您是否需要先在`mypl@machine2`.

用户指南中的更改节点名称代码：

```
change_node_name(Mod, From, To, Source, Target) ->
    Switch =
        fun(Node) when Node == From -> To;
           (Node) when Node == To -> throw({error, already_exists});
           (Node) -> Node
        end,
    Convert =
        fun({schema, db_nodes, Nodes}, Acc) ->
                {[{schema, db_nodes, lists:map(Switch,Nodes)}], Acc};
           ({schema, version, Version}, Acc) ->
                {[{schema, version, Version}], Acc};
           ({schema, cookie, Cookie}, Acc) ->
                {[{schema, cookie, Cookie}], Acc};
           ({schema, Tab, CreateList}, Acc) ->
                Keys = [ram_copies, disc_copies, disc_only_copies],
                OptSwitch =
                    fun({Key, Val}) ->
                            case lists:member(Key, Keys) of
                                true -> {Key, lists:map(Switch, Val)};
                                false-> {Key, Val}
                            end
                    end,
                {[{schema, Tab, lists:map(OptSwitch, CreateList)}], Acc};
           (Other, Acc) ->
                {[Other], Acc}
        end,
    mnesia:traverse_backup(Source, Mod, Target, Mod, Convert, switched). 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T08:42:07.193

解决方法是迁移。只需启动 mnesia 集群并将所有表和架构迁移到其他节点。比从原来的删除和忘记。

# sql - SQL Join 没有返回我所期望的

> ID：463406
> 
> 赞同：2
> 
> 时间：2009-01-20T22:32:34.943
> 
> 标签：sql, sql-server, tsql

我有一个临时表，我正在按以下格式创建查询。其中包含几年内每个 CustomerID、Year 和 Month 的记录。

## #T

客户 | 客户ID | 年份 | 月

前任。

```
Foo | 12345 | 2008 | 12  
Foo | 12345 | 2008 | 11  
Bar | 11224 | 2007 | 7 
```

当我将此临时表加入以下格式的另一个表时，我得到的结果比我预期的要多得多。

## 事件

事件ID | 客户ID | 开业日期

前任。

```
1100 | 12345 | '2008-12-11 10:15:43'
1100 | 12345 | '2008-12-11 11:25:17' 
```

我正在尝试获取事件计数的结果集以及像这样的客户、年份和月份。

```
SELECT COUNT(EventID), Customer, Year, Month
FROM [Event] 
JOIN #T ON [Event].CustomerID = #T.CustomerID
WHERE [Event].DateOpened BETWEEN '2008-12-01' AND '2008-12-31'
GROUP BY Customer, Year, Month
ORDER BY Year, Month 
```

我得到了每年和每月的记录，而不仅仅是 2008 年 12 月。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-20T23:04:57.670

您在事件表上指定了日期，但没有在联接上指定日期——因此它将临时表中的所有记录与匹配的客户 ID 联接起来。

试试这个：

```
SELECT COUNT(e.EventID), T.Customer, T.Year, T.Month
FROM [Event] e
INNER JOIN #T T ON (
  T.CustomerID = e.CustomerID and 
  T.Year = year(e.DateOpened) and 
  T.Month = month(e.DateOpened) 
  ) 
WHERE T.Year = 2008 
  and T.Month = 12 
GROUP BY T.Customer, T.Year, T.Month
ORDER BY T.Year, T.Month 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-20T23:10:05.850

也许你的意思是：

```
SELECT COUNT(EventID)
    ,Customer
    ,Year
    ,Month
FROM [Event] 
INNER JOIN #T
    ON [Event].CustomerID = #T.CustomerID
    AND YEAR([Event].DateOpened) = #T.YEAR
    AND MONTH([Event].DateOpened) = #T.MONTH
WHERE [Event].DateOpened >= '2008-12-01'
    AND [Event].DateOpened < '2009-01-01'
GROUP BY Customer
    ,Year
    ,Month
ORDER BY Year
    ,Month 
```

请注意，我已经修复了您代码中的另一个潜在错误：您`BETWEEN`将排除日期时间，例如`'2008-12-31 10:15:43'` 您可以使用此或类似技术。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T23:02:00.157

问题是`#T`CustomerID = 12345 中有两行。这些行中的每一行都与`Event`. 如果您只想要 12 月的 CustomerID，那么您也需要过滤`#T`：

```
SELECT COUNT(EventID), Customer, Year, Month
    FROM [Event] 
    JOIN #T ON [Event].CustomerID = #T.CustomerID
    WHERE [Event].DateOpened BETWEEN '2008-12-01' AND '2008-12-31'
      AND #T.Year = 2008
      AND #T.Month = 12
    GROUP BY Customer, Year, Month
    ORDER BY Year, Month 
```

如果您有其他期望，最好澄清您的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T23:19:35.050

如果您只想要客户名称，那么 #T 似乎有多余的信息。

您可以使用子查询来解决它

```
SELECT COUNT(EventID), (select TOP 1 #T.Customer from #T Where #T.CustomerID = [Event].CustomerID ), Year, Month
FROM [Event] 
WHERE [Event].DateOpened BETWEEN '2008-12-01' AND '2008-12-31'
GROUP BY CustomerID, Year, Month
ORDER BY Year, Month 
```

# php - 用于从 Yahoo、GMail、Hotmail 检索邮件的 PHP API

> ID：463410
> 
> 赞同：1
> 
> 时间：2009-01-20T22:34:03.643
> 
> 标签：php, email, gmail, yahoo, hotmail

有一些 API 可用于从主要的电子邮件提供商那里获取地址簿/联系人列表。

我想知道这样的 API 是否存在用于抓取收到的电子邮件/消息？

谢谢大家

## 编辑

我确信我自己可以做到这一点。但是，如果有人已经这样做了，我不想“重新发明”轮子。可能比我更好，因为我只是一个菜鸟：P

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-20T22:48:06.550

我认为所有这些服务都提供 POP/IMAP 协议，您可以使用 PHP 的功能访问：http: [//php.net/book.imap](http://php.net/book.imap)

# language-agnostic - little-endian 系统使用哪些转换将数据转换为网络顺序？

> ID：463416
> 
> 赞同：7
> 
> 时间：2009-01-20T22:35:55.543
> 
> 标签：language-agnostic, alignment, byte, endianness

将 little-endian 系统中的数据转换为网络字节顺序所需的底层转换是什么？对于 2 字节和 4 字节数据，有众所周知的函数（如 htons、ntohl 等）来封装更改，对于 1 字节数据的字符串（如果有的话）会发生什么？

此外，Wikipedia 暗示 little-endian 是 big-endian 的镜像，但如果这是真的，为什么我们需要对 2 字节和 4 字节数据进行特定处理？

文章“论圣战和和平恳求”似乎暗示有许多不同风格的 little-endian——这是一篇古老的文章——这仍然适用吗？像 Java 类文件开头那样的字节顺序标记是否仍然需要？

最后，网络字节顺序是否需要 4 字节对齐？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-20T22:44:58.367

假设您在一个`b`字节数组中有 ASCII 文本“BigE”。

```
b[0] == 'B'
b[1] == 'i'
b[2] == 'g'
b[3] == 'E' 
```

这也是字符串的网络顺序。

如果将其视为 32 位整数，则为

```
'B' + ('i' << 8) + ('g' << 16) + ('E' << 24) 
```

在一个小端平台和

```
'E' + ('g' << 8) + ('i' << 16) + ('B' << 24) 
```

在大端平台上。

如果您分别转换每个 16 位作品，您将不会得到这些

```
'i' + ('B' << 8) + ('E' << 16) + ('g' << 24) 
```

这就是为什么`ntohl`并且`ntohs`都是必需的。

换句话说，`ntohs`交换 16 位短字节内的字节，并`ntohl`颠倒其 32 位字的四个字节的顺序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T22:45:58.287

2 和 4 字节数据的特定处理函数利用了处理器指令对特定数据大小进行操作这一事实。运行 1 字节反转函数四次肯定比使用更宽的指令一次对所有四个字节执行相同（尽管规模增加）操作效率低。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T22:46:13.777

1 字节数据不需要字节序之间的任何转换（这是 UTF-8 优于 UTF-16 和 UTF-32 字符串编码的优势）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-20T22:56:31.120

> 网络字节顺序是否需要 4 字节对齐？

通过网络传输的字节不需要特定的对齐方式。您的处理器可能需要在内存中进行某种对齐，但解决差异取决于您。x86 家族通常不会提出这样的要求。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-20T23:08:24.760

基本思想是所有多字节类型都必须颠倒它们的字节顺序。四字节整数将交换字节 0 和 3，交换字节 1 和 2。一个两字节整数将交换字节 0 和 1。一个字节的字符不会被交换。

这有两个**非常重要**的含义，非实践者和新手并不总是意识到：

1.  (ASCII) 不接触字符串。
2.  没有可能*的*盲算法来字节交换通用“数据”。您必须知道所有数据的类型，并按照其类型所需的方式交换每个项目。

# .net - 删除单个消息 MSMQ

> ID：463418
> 
> 赞同：5
> 
> 时间：2009-01-20T22:38:24.230
> 
> 标签：.net, vb.net, msmq

是否可以从 MSMQ 消息队列中删除单个消息？我有一个 Queue 对象，一个我通过偷看得到的消息（对象）和消息的 ID，我可以看到删除（或清除）整个队列的方法，但我看不到删除的方法消息是自己的，我已经尝试在通过偷看找到消息后接收消息，但我收到“光标无效”的错误

感激地收到任何帮助

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-20T23:01:44.820

你想用`MessageQueue.ReceiveById`吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-20T22:45:22.890

你可以试试[QueueExplorer](http://www.cogin.com/mq/index.php)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T23:05:46.123

使用其中一种接收功能。取决于您的语言/技术（c、com、.net）。

对于 .net，它将是 MessageQueue.ReceiveById 方法。或者任何你认为合适的。根据您要删除的消息（第一个，最后一个，使用 cursor 或 id ）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-11-12T14:59:20.917

```
 // Language C#
    // Delete Message Button click handler.
    public void DeleteOneMessage()
    {
        // I created winforms application and added a reference to "System.Messaging"
        // Added one edit box name = queueNameTextBox
        // On Form_Load set queueNameTextBox.Text = @"private$\myQueueName"
        // Connect to the queue on the local computer.
        MessageQueue myQueue = new MessageQueue(queueNameTextBox.Text);

        // Set the formatter to indicate body contains an Order.
        myQueue.Formatter = new BinaryMessageFormatter();

        try
        {
            // Receive and format the message.
            object myMessage = myQueue.Receive();
            MessageBox.Show("One message removed from the queue.");
        }
        catch (MessageQueueException mqe)
        {
            MessageBox.Show(mqe.Message);
        }
        catch (InvalidOperationException e)
        {
            MessageBox.Show(e.Message);
        }
        catch(Exception ex)
        {
            MessageBox.Show(ex.Message);
        }
    } 
```

# .net - 方法、接口、反射和困难的 OOP 设计

> ID：463419
> 
> 赞同：0
> 
> 时间：2009-01-20T22:38:27.503
> 
> 标签：.net, oop, reflection, interface

我不太确定如何解释这个（这就是标题有点奇怪的原因），但我会试一试。基本上我正在做一些面向对象的设计，我想代表各种不同类型的对象，每个对象都可以有各种可以执行的动作。一个示例可能会有所帮助：诸如可以具有删除、重命名和打开操作的文件和可以具有运行、关闭、卸载和移动到其他监视器操作的应用程序之类的东西。

我的第一个想法是使用接口（IAction）并让我所有用于不同类型对象的类都实现该接口，但这不起作用，因为每个对象都有不同的方法，接口不会知道这一点。

然后出现的问题是，如果它们都有不同的方法，这些方法实际上会被调用——因为在运行时不可能知道哪些对象有哪些方法。这是另一个问题——我希望每个对象都能够生成它所拥有的方法的列表，然后让我调用它们中的任何一个。

这需要通过反射来完成吗？我很确定它不能用标准接口来完成——但我对所有这些 OOP 设计有点陌生，所以我不完全确定。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-20T22:45:57.613

Robin - 我假设您这样做的目的是为您的用户提供这些对象的“通用”接口。[我在早期的项目中做了类似的事情，并在我之前发布的答案](https://stackoverflow.com/questions/408853/efficient-user-interfaces#409036)中记录了我最终得到的 UI 。

要回答您的具体问题，您应该在这里小心一点，因为您可能正在进入[建筑宇航员](http://www.joelonsoftware.com/items/2008/05/01.html)领域（不是一件好事）。如果您的每个对象的界面不是自然重叠的，那么通过奇怪的诡计强迫它们共享一个概念界面只会让您的用户感到困惑。您*可以*通过实现对非常广泛的概念类别调用“足够接近”函数的接口来解决这个问题（例如，文件和应用程序都是“打开的”，但结果各不相同）。您还可以在需要显示可用选项的位置使用反射来发现有关对象的更多信息。因此，您*可以*做到。问题是，你*应该*这样做吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-20T22:48:03.680

```
public interface IDiscoverableAction {
    string Name { get; }
    void Execute();
}

public interface IHasDiscoverableActions {
   IEnumerable<IDiscoverableAction> DiscoverActions();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-20T22:51:16.137

我同意马克的警告，要认真思考为什么需要这样做。调用直到运行时才知道其身份的方法/动作只是让我觉得是个坏主意。

但如果你必须这样做，这里有另一个想法：使用返回函数指针列表或其他东西`IAction`的方法来制作你的接口。`getActions()`如果您的语言中没有任何等效的函数指针，请`getActions()`返回一个字符串列表`callAction(string)`并向 IAction 接口添加一个方法，每个类都实现该方法以根据参数调用适当的方法。它可能比使用内置反射机制快一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-23T22:28:37.727

也许你有这个错误的方式。对象是否应该实际执行这些操作？

拿档案。让 FileSystem 对象实现删除操作不是更自然吗？

在任何情况下，您都可以通过引入几层间接来构建一个真正动态的系统。

假设您根据可删除对象将 DeleteAction 实现为 UnaryOperation。

将 DeleteAction 添加到 ActionRepository 会将其注册为可用于可删除对象。

如果您想避免将 File 静态绑定到可删除，您可以引入一个 AdaptorRepositor，您可以在其中添加一个 File2Deletable 适配器。

ActionRepository.listActions(Object o) 将为您提供所有可直接用于文件或文件的任何可用适配器的所有操作的列表。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-23T21:38:43.537

我想象的是您希望构建一种执行上下文或引擎，并且引擎正在使用的这些对象需要一般地传递​​到引擎中。一旦引擎控制了对象，引擎就需要弄清楚如何处理对象......

假设这是正确的，您可以使用继承从基类继承，例如 FrameworkObject，或者您可以实现公共接口，例如 IFrameworkObject。您可以选择将该接口用作多态“标记”接口。这在当时的 ActiveX 组件编程中是必需的。我更喜欢标记接口，因为从框架重构生命周期的角度来看，类继承并不是一件微不足道的事情，并且由于添加了一些（但不是全部）功能，它可能会由于基类膨胀而倾向于创建混乱的代码，派生类需要。

一旦你有了一个通用机制，即通过每个类上的接口实现类型容器，你可以使用反射或简单的“is”运算符（在 C# 中）来确定一个特定对象是否实现了一个特定的接口例如，与文件实体或应用程序实体有关。

在通过接口识别确定执行上下文之后（不要自欺欺人，您将能够在方法粒度级别执行此操作），下一个决定是是否尝试使用反射和硬编码逻辑来执行各种方法。如果你想让它变得非常通用，你可以依靠存储在文件或数据库中的元数据来驱动逻辑。例如，执行引擎可以在启动时加载支持的接口，然后使用反射来询问任何实现 IFrameworkObject 接口的对象。

我想得越多，我就越觉得您的需求表明您正在实现一种脚本语言，而这部分需求是通过词法分析来标记命令。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T02:10:36.623

通过反射执行方法的问题是你真的不知道*你*在执行什么。你可以反思并发现你有一个 move 方法，但那个 move 方法是做什么的？如果该方法有参数，您也可以发现这些参数，但是从参数名称中您是否会有某种 AI 来确定每个参数名称的含义？

如果您无法在这些对象之间找到足够的共性以使它们可以共享一个接口，那么它们实际上就没有任何关系，也不应该被迫这样做。

也许在某些情况下，不相关的类可能有一两个共同点。在这种情况下，您可能会尝试定义一个接口来识别它。例如：ISupportsDelete。在这种细粒度级别处理事物是您能够以任何类型的通用方式处理此类不相关对象的唯一方法。

# concurrency - 列中唯一数据的正确模式是什么？

> ID：463421
> 
> 赞同：0
> 
> 时间：2009-01-20T22:39:21.980
> 
> 标签：concurrency, unique

我有一个具有以下架构的表 [File]

```
CREATE TABLE [dbo].[File]
(
    [FileID] [int] IDENTITY(1,1) NOT NULL,
    [Name] [varchar](256) NOT NULL,
 CONSTRAINT [PK_File] PRIMARY KEY CLUSTERED 
(
    [FileID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY] 
```

这个想法是 FileID 用作表的键，而 Name 是代表文件的完全限定路径。

我一直在尝试做的是创建一个存储过程，它将检查名称是否已被使用，如果是，则使用该记录，否则创建一个新记录。

但是，当我使用许多线程同时执行存储过程对代码进行压力测试时，我得到了不同的错误。

此版本的代码将创建死锁并在客户端上引发死锁异常。

```
CREATE PROCEDURE [dbo].[File_Create]
    @Name varchar(256)
AS
    SET TRANSACTION ISOLATION LEVEL SERIALIZABLE
    BEGIN TRANSACTION xact_File_Create
    SET XACT_ABORT ON

    SET NOCOUNT ON 
    DECLARE @FileID int
    SELECT @FileID = [FileID] FROM [dbo].[File] WHERE [Name] = @Name
    IF @@ROWCOUNT=0
    BEGIN
        INSERT INTO [dbo].[File]([Name])
        VALUES (@Name)
        SELECT @FileID = [FileID] FROM [dbo].[File] WHERE [Name] = @Name
    END

    SELECT * FROM [dbo].[File]
    WHERE [FileID] = @FileID

    COMMIT TRANSACTION xact_File_Create
GO 
```

这个版本的代码我最终在 Name 列中获得了具有相同数据的行。

```
CREATE PROCEDURE [dbo].[File_Create]
    @Name varchar(256)
AS
    BEGIN TRANSACTION xact_File_Create

    SET NOCOUNT ON 
    DECLARE @FileID int
    SELECT @FileID = [FileID] FROM [dbo].[File] WHERE [Name] = @Name
    IF @@ROWCOUNT=0
    BEGIN
        INSERT INTO [dbo].[File]([Name])
        VALUES (@Name)
        SELECT @FileID = [FileID] FROM [dbo].[File] WHERE [Name] = @Name
    END

    SELECT * FROM [dbo].[File]
    WHERE [FileID] = @FileID

    COMMIT TRANSACTION xact_File_Create
GO 
```

我想知道执行此类操作的正确方法是什么？一般来说，这是我想使用的模式，其中列数据在单列或多列中是唯一的，并且另一列用作键。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T22:45:29.567

首先，在 Name 列上创建一个唯一索引。然后从您的客户端代码中首先检查名称是否存在，方法是选择 FileID 并将名称放在 where 子句中 - 如果存在，请使用 FileID。如果没有，请插入一个新的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T22:53:03.060

*如果您在 Name 字段上进行大量搜索，您可能希望它被索引（作为唯一的，如果这是主要*搜索字段，甚至可能是聚集的）。由于您不使用第一次选择中的@FileID，我只需从 Name = @Name 的文件中选择 count(*) 并查看它是否大于零（这将阻止 SQL 保留表上的任何锁）搜索阶段，因为没有选择任何列）。

您在 SERIALIZABLE 级别上是正确的，因为您的操作将影响后续查询的成功或失败，并且名称存在。没有该集合的版本导致重复的原因是两个选择同时运行并且发现没有记录，因此两者都继续进行插入（这会创建重复）。

与先前版本的死锁很可能是由于缺少索引导致搜索过程需要很长时间。当您在 SERIALIZABLE 事务中加载服务器时，其他一切都必须等待操作完成。索引*应该*使操作快速，但只有测试会表明它是否足够快。请注意，您可以通过重新提交来响应失败的事务：在现实世界的情况下，希望负载将是瞬态的。

编辑：通过使您的表被索引，但不使用 SERIALIZABLE，您最终会遇到三种情况：

*   找到名称，捕获并使用 ID。*常见的*
*   未找到名称，按预期插入。*常见的*
*   未找到名称，插入失败，因为在第一个精确匹配的毫秒内发布了另一个完全匹配。*很稀少*

我希望最后一种情况是真正的例外，因此使用异常来捕获这种非常罕见的情况比使用 SERIALIZABLE 更可取，这会产生严重的性能后果。

如果您确实期望在相同的*新*名称中彼此在几毫秒内发布帖子是很常见的，那么将 SERIALIZABLE 事务与索引结合使用。在一般情况下它会更慢，但在找到这些帖子时会更快。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T22:44:31.923

使用 Exists 函数可能会清理一些东西。

```
if (Exists(select * from table_name where column_name = @param)
begin
  //use existing file name
end
else
  //use new file name 
```

# visual-studio-2008 - 后代 UserControl 如何拦截由其基类触发的事件？

> ID：463424
> 
> 赞同：3
> 
> 时间：2009-01-20T22:41:13.083
> 
> 标签：visual-studio-2008, inheritance, user-controls

我有一个基本的用户控件（BaseControl.cs），上面有一个确定和取消按钮。单击按钮时，会触发一个事件。通常，其他 UserControl 对象从 BaseControl 继承。最后，后代 UserControl 对象被放置在 WinForm 上，在那里它们挂钩到单击确定/取消按钮的事件。

我的问题是：在后代控件中，我想拦截事件（运行一些验证）。如何挂钩（或拦截）这些事件？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-20T22:45:19.800

实现事件的标准模式是使用虚拟的“OnXxx”方法，如下所示：

```
public event EventHandler OkClick;
protected virtual void OnOkClick(EventArgs e)
{
    if (OkClick != null) OkClick(this, e);
} 
```

现在，每当您的基本控件想要触发“OkClick”事件时，它只需调用：

```
OnOkClick(EventArgs.Empty); 
```

这意味着您的基本控件的后代可以像这样覆盖 OnOkClick：

```
protected override void OnOkClick(EventArgs e)
{
    // do some stuff before the event is fired
    base.OnOkClick(e);
    // do some stuff after the event is fired
} 
```

请注意，框架设计指南实际上声明您应该以这样一种方式实现“OnXxx”方法，即即使后代类忘记调用基方法，也会触发事件。我真的不知道这样做的好方法，而且我相信大多数人都忽略了这个指南。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T22:43:57.807

您通常会创建一个`protected virtual Validate()`在 BaseControl 的事件处理程序中调用的方法。然后在 DescendantControl 中使用`override`该`Validate()`方法。

[这是有关Inheritance](http://support.microsoft.com/kb/307205)的一些文档。

# automation - 在 .Net 表单中运行 PowerpointViewer.exe

> ID：463434
> 
> 赞同：1
> 
> 时间：2009-01-20T22:44:26.713
> 
> 标签：automation, powerpoint, viewer

我有：

1 表格 1 面板

我这样做没有问题：运行 notepad.exe 并让它在面板内运行，没有问题。但是，运行 2003 或 2007 查看器时，我可以启动它但不在表单内。（下面的示例代码）

```
 //DLL Import
    using System.Runtime.InteropServices;

    [DllImport("user32.dll")]
    static extern IntPtr SetParent(IntPtr hWndChild, IntPtr hWndNewParent);

  string ppviewer = @"C:\Program Files\Microsoft Office\Office12\PPTVIEW.EXE";

        System.Diagnostics.ProcessStartInfo startinfo = new System.Diagnostics.ProcessStartInfo(ppviewer);
        startinfo.Arguments = @"D:\Test.pps /s";

        System.Diagnostics.Process pptprocess = System.Diagnostics.Process.Start(startinfo);

        pptprocess.WaitForInputIdle();

        SetParent(pptprocess.MainWindowHandle, this.panel1.Handle); 
```

我对 PPTViewer.exe 进行了同样的尝试，但我无法让 Powerpoint 幻灯片在表单内运行。它启动查看器，但在表单之外。

不确定我是否必须在这里做一些特别的事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-23T19:34:06.783

回答我自己的问题可以获得积分吗？

基本上，我使用 SPY++ 来查看查看器正在打开一个子窗口。子窗口是我想强制进入我的应用程序的窗口，所以我使用以下 API 调用来获取子窗口的句柄。

[DllImport("user32.dll")] 静态外部 IntPtr SetParent(IntPtr hWndChild, IntPtr hWndNewParent);

```
 [DllImport("user32.dll")]
    [return: MarshalAs(UnmanagedType.Bool)]
    public static extern bool EnumChildWindows(IntPtr window, EnumWindowProc callback, IntPtr i); 
```

对于 PPT 2003 或更低版本的文件，这工作正常（只能查看第一张幻灯片），但对于 PPT 2007，它仍然在我的表单之外打开。速度非常快，但是......

最后，我们决定不播放原生格式的 PPT，因为微软没有制作轻量级的 .net 控件来播放 PPT。我们也不想在后台启动 PPT，使用该方法启动 PPT 文件需要几秒钟，这是不可接受的性能。

所以，我们将 PPT 转换为 Flash 并使用 Flash active X 控件（速度超快）播放原始 PPT 内容。

这似乎是最好的解决方案。

# asp.net - 确定 PostBack 中没有绑定数据的原因

> ID：463453
> 
> 赞同：1
> 
> 时间：2009-01-20T22:50:13.377
> 
> 标签：asp.net, data-binding, .net-2.0, postback

我有一个 ASP.NET GridView，它已被扩展以提供“行单击”功能。我将数据绑定到 1 到 10 条记录，并将其显示给用户。

我遇到的错误是控件在回发时不会有任何与之关联的数据。

只有当我在页面的其余部分完成加载之前单击一行并且可以重新产生问题时，我才观察到这种行为，但我不知道它*为什么*会发生。

任何建议都非常感谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-20T22:54:41.403

当您在页面有机会完成加载之前触发 ASP.NET 回发时，您将遇到很多困难。回发事件的工作原理是通过 javascript 将值插入页面上的隐藏输入并提交主表单。问题是如果你提前触发回发，你不能保证所有的控件和隐藏的输入是否已经完全渲染。

# php - 可以在 PHP 重定向中发布数据吗？

> ID：463458
> 
> 赞同：5
> 
> 时间：2009-01-20T22:52:08.537
> 
> 标签：php

好吧，现在我有一个页面（page2.php），在顶部它会进行一些验证检查，如果出现问题，它会反弹回 page1.php。问题是 page1.php 是由帖子加载的，这意味着它是表单的最终结果。这意味着我原来在 page1.php 上的所有帖子数据都丢失了。

所以这是我的代码：

```
if ($validation_fails)
{
    header('Location:page1.php');
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-20T22:54:20.327

您可以使用[`cURL`](http://us2.php.net/curl)或重新构建数据以在顶部进行验证，`page1.php`如果没有失败，请使用`page2.php`. 如果您正在执行某种多步骤表单，则可以将所有数据保存在会话中，并在会话中有匹配数据时填充字段。不过，不确定这是否适用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-20T23:40:02.980

你可以重构逻辑。验证应该发生在 page1.php 上，如果失败，则不会发生重定向。如果成功，您将被重定向。

如果您担心安全（人们只是去 page2），您可以设置一个在 page2 上检查并在 page1 上设置的会话变量。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-20T23:13:11.850

你不能只通过`include`或`require`而不是重定向到它来包含验证脚本吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T00:15:08.200

在 page2.php 上，如果验证失败，您可以将帖子的内容存储到 $_SESSION 变量中。

在 page1.php 上，您只需将存储在会话中的数据的正确转义/编码版本作为表单的一部分包含在内。您还可以使用它来更新表单，以便用户清楚地知道哪个部分未通过验证。

# java - 我需要一个用于 java 的快速密钥替换算法

> ID：463460
> 
> 赞同：2
> 
> 时间：2009-01-20T22:52:39.537
> 
> 标签：java, algorithm, optimization, string

给定一个带有替换键的字符串，如何使用**Java**最有效地用运行时值替换这些键？我需要经常、快速且在相当长的字符串上执行此操作（例如，平均 1-2kb）。键的形式是我的选择，因为我在这里也提供了模板。

这是一个示例（请不要因为它是 XML 而被挂断；如果可能的话，我想这样做，比使用 XSL 或 DOM 操作更便宜）。我想用来自 bean 属性、真实属性和其他一些来源`@[^@]*?@`的属性值替换其中的所有模式。`Property`这里的关键是*快*。有任何想法吗？

```
<?xml version="1.0" encoding="utf-8"?>

<envelope version="2.3">

  <delivery_instructions>

    <delivery_channel>
      <channel_type>@CHANNEL_TYPE@</channel_type>
    </delivery_channel>

    <delivery_envelope>
      <chan_delivery_envelope>
    <queue_name>@ADDRESS@</queue_name>
      </chan_delivery_envelope>
    </delivery_envelope>

  </delivery_instructions>

  <composition_instructions>
    <mime_part content_type="application/xml">
      <content><external_uri>@URI@</external_uri></content>
    </mime_part>
  </composition_instructions>

</envelope> 
```

天真的实现是使用`String.replaceAll()`，但我不禁认为这不太理想。如果我可以避免添加新的第三方依赖项，那就更好了。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-20T22:59:39.070

[Matcher](http://java.sun.com/javase/6/docs/api/java/util/regex/Matcher.html)中的 appendReplacement 方法看起来可能很有用，尽管我不能保证它的速度。

以下是 Javadoc 中的示例代码：

```
Pattern p = Pattern.compile("cat");
Matcher m = p.matcher("one cat two cats in the yard");
StringBuffer sb = new StringBuffer();
while (m.find()) {
    m.appendReplacement(sb, "dog");
}
m.appendTail(sb);
System.out.println(sb.toString()); 
```

**编辑：**如果这很复杂，您可能可以相当容易地实现自己的状态机。尽管专门的实现可能会更快，但您几乎正在做 appendReplacement 已经在做的事情。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-21T02:46:37.723

现在开始自己编写还为时过早。我将从幼稚的替换解决方案开始，并实际对其进行基准测试。然后我会尝试第三方模板解决方案。然后我会尝试自定义流版本。

在你得到一些硬数字之前，你怎么能确定它值得努力优化呢？

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-21T00:14:18.840

~~Java 是否具有调用函数的正则表达式 replace() 形式？~~

~~我被 Javascript [String.replace()](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Global_Objects/String/Replace)方法宠坏了。（就此而言，您可以运行 Rhino 并使用 Javascript，但不知何故，即使 Javascript 编译器/解释器效率很高，我认为这不会像纯 Java 调用那样快）~~

编辑：没关系，@mmyers 可能有最好的答案。

无端卑躬屈膝：（因为我想看看我自己能不能做到：）

```
Pattern p = Pattern.compile("@([^@]*?)@");
Matcher m = p.matcher(s);
StringBuffer sb = new StringBuffer();
while (m.find()) 
{
    m.appendReplacement(sb,substitutionTable.lookupKey(m.group(1)));
}
m.appendTail(sb);
// replace "substitutionTable.lookupKey" with your routine 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-20T23:12:19.933

你真的想写一些自定义的东西，这样你就可以避免多次处理字符串。我不能强调这一点 - 因为我看到的大多数其他解决方案看起来都忽略了这个问题。

可选择将文本转换为流。逐个字符地读取它，将每个字符转发到输出字符串/流，直到您看到@，然后读取到下一个@，将密钥替换为输出：重复直到流结束。

我知道这对我来说是老生常谈——但它可能是最好的。

我假设您对“@”有一些合理的假设，而不仅仅是“显示”与输入中的令牌键无关。:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T09:37:33.680

> 请不要挂断它是 XML；如果可能的话，我想这样做，比使用 XSL 或 DOM 操作便宜

如果您不同时处理插入的字符串以进行字符转义，则流程下游的任何内容都将挂起。这并不是说如果你有充分的理由就不能自己做，而是意味着你要么必须确保你的模式都在文本节点中，而且你还要正确地转义替换文本。

@Foo@ 相对于标准 &Foo; 有什么优势？Java 附带的 XML 库中是否已经内置了语法？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-21T09:54:49.980

如果您不改变范式，文本处理将始终受到限制。我不知道您的域有多灵活，所以不确定这是否适用，但这里有：

尝试创建一个索引到您的文本替换所在的位置 - 如果模板不经常更改，这尤其好，因为它成为模板“编译”的一部分，成为可以接受替换所需值的二进制对象，并将整个字符串作为字节数组删除。该对象可以被缓存/保存，并且下次重新替换为新值以再次使用。即，您节省了每次解析文档的时间。（实现留给读者练习=D）

但是，在着手编写自定义模板引擎之前，请使用分析器检查这是否真的是您所说的瓶颈。问题实际上可能出在其他地方。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-08-24T14:29:16.400

正如其他人所说，appendReplacement() 和 appendTail() 是您需要的工具，但您需要注意一些事情。如果替换字符串包含任何美元符号，该方法将尝试将它们解释为捕获组引用。如果有任何反斜杠（用于逃避美元唱），它要么吃掉它们，要么抛出异常。

如果您的替换字符串是动态生成的，您可能事先不知道它是否包含任何美元符号或反斜杠。为了防止出现问题，您可以将替换直接附加到 StringBuffer，如下所示：

```
Pattern p = Pattern.compile("@([^@]*?)@");
Matcher m = p.matcher(s);
StringBuffer sb = new StringBuffer();
while (m.find()) 
{
    m.appendReplacement("");
    sb.append(substitutionTable.lookupKey(m.group(1)));
}
m.appendTail(sb); 
```

您仍然必须每次都调用 appendReplacement()，因为这是让您与匹配位置保持同步的原因。但是这个技巧避免了很多无意义的处理，这可以给你一个显着的性能提升作为奖励。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-11-09T15:06:17.223

这就是我使用的，来自 apache commons 项目 [http://commons.apache.org/lang/api/org/apache/commons/lang/text/StrSubstitutor.html](http://commons.apache.org/lang/api/org/apache/commons/lang/text/StrSubstitutor.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-20T23:06:43.173

我还有一个基于非正则表达式的替换库，可[在此处](http://www.clapper.org/software/java/util/javadocs/util/api/org/clapper/util/text/UnixShellVariableSubstituter.html)获得。我没有测试它的速度，它不直接支持你的例子中的语法。但是很容易扩展以支持该语法；例如，参见[此类](http://www.clapper.org/software/java/util/javadocs/util/api/org/clapper/util/text/WindowsCmdVariableSubstituter.html)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-21T12:20:51.620

看看专门研究这个的库，例如[Apache Velocity](http://velocity.apache.org/)。如果不出意外，您可以打赌他们对这部分逻辑的实现速度很快。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-21T18:49:29.540

我不太确定接受的答案是否比 String.replaceAll(String,String) 快。这里供您比较的是 String.replaceAll 的实现和幕后使用的 Matcher.replaceAll。看起来与 OP 正在寻找的非常相似，我猜它可能比这个简单的解决方案更优化。

```
public String replaceAll(String s, String s1)
    {
        return Pattern.compile(s).matcher(this).replaceAll(s1);
    }

public String replaceAll(String s)
    {
        reset();
        boolean flag = find();
        if(flag)
        {
            StringBuffer stringbuffer = new StringBuffer();
            boolean flag1;
            do
            {
                appendReplacement(stringbuffer, s);
                flag1 = find();
            } while(flag1);
            appendTail(stringbuffer);
            return stringbuffer.toString();
        } else
        {
            return text.toString();
        }
    } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-08-23T07:25:50.097

...... Chii是对的。如果这是一个必须运行多次的模板，那么速度很重要，请找到您的替换标记的索引，以便能够直接访问它们，而不必每次都从头开始。将“编译”抽象为具有良好属性的对象，它们只需要在更改模板后进行更新。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-07-01T08:26:23.753

Rythm 是一个 java 模板引擎，现在发布了一个名为**[String 插值模式](http://www.playframework.org/modules/rythm-1.0.0-20120630/string_interpolation)**的新功能，它允许您执行以下操作：

```
String result = Rythm.render("Hello @who!", "world"); 
```

上面的案例表明您可以按位置将参数传递给模板。Rythm 还允许您按名称传递参数：

```
Map<String, Object> args = new HashMap<String, Object>();
args.put("title", "Mr.");
args.put("name", "John");
String result = Rythm.render("Hello @title @name", args); 
```

由于您的模板内容相对较长，您可以将它们放入文件中，然后`Rythm.render`使用相同的 API 调用：

```
Map<String, Object> args = new HashMap<String, Object>();
// ... prepare the args
String result = Rythm.render("path/to/my/template.xml", args); 
```

注意 Rythm 将你的模板编译成 java 字节码，它相当快，大约比它快 2 倍`String.format`

链接：

*   检查[全功能演示](http://play-rythm-demo.appspot.com/)
*   阅读[节奏的简要介绍](http://software-lgl.blogspot.com.au/2012/03/rythm-easy-to-use-high-performance-java.html)
*   下载[最新的包](https://github.com/greenlaw110/rythm/downloads)或
*   [叉它](https://github.com/greenlaw110/rythm)

# lisp - Common Lisp 中的动态和词法变量

> ID：463463
> 
> 赞同：47
> 
> 时间：2009-01-20T22:53:23.277
> 
> 标签：lisp, common-lisp, lexical-scope

我正在阅读 Peter Seibel 的《实用通用 Lisp》一书。

在第 6 章，“变量”部分，“词法变量和闭包”和“动态，又名特殊，变量”。 [http://www.gigamonkeys.com/book/variables.html](http://www.gigamonkeys.com/book/variables.html)

我的问题是，这两个部分中的示例都显示了 (let ...) 如何影响全局变量，并且并没有真正说明动态变量和词法变量之间的区别。

我了解闭包是如何工作的，但在这个例子中我真的不明白 let 有什么特别之处：

```
(defvar *x* 10)

(defun foo ()
  (format t "Before assignment~18tX: ~d~%" *x*)
  (setf *x* (+ 1 *x*))
  (format t "After assignment~18tX: ~d~%" *x*))

(defun bar ()
  (foo)
  (let ((*x* 20)) (foo))
  (foo))

CL-USER> (foo)
Before assignment X: 10
After assignment  X: 11
NIL

CL-USER> (bar)
Before assignment X: 11
After assignment  X: 12
Before assignment X: 20
After assignment  X: 21
Before assignment X: 12
After assignment  X: 13
NIL 
```

我觉得这里没有什么特别的。*bar*中的外部*foo*递增全局*x*，而被*let* in *bar*包围的foo*递增*阴影*x*。有什么大不了的？我不明白这应该如何解释词法变量和动态变量之间的区别。然而这本书仍然是这样的：

 ***> 那么这是如何工作的呢？LET 怎么知道当它绑定*x*时它应该创建一个动态绑定而不是正常的词法绑定？它知道是因为名称已被声明为特殊的。12 使用 DEFVAR 和 DEFPARAMETER 定义的每个变量的名称都会自动声明为全局特殊的。

如果*let*使用**“普通词法绑定”**绑定*x*会发生什么？总而言之，动态绑定和词法绑定有什么区别？这个例子对于动态绑定有什么特别之处？

 *** * *

## 回答 #1

> 赞同：59
> 
> 时间：2010-03-05T10:40:07.157

**这是怎么回事？**

你说：*感觉这里没什么特别的。外部`foo`in`bar`递增 global `x`，并由in递增 shadowed`foo`包围。有什么大不了的？`let``bar``x`*

这里发生的*特殊*情况是`LET` **可以**影响`*x*`. 使用词法变量是不可能的。

该代码`*x*`通过. *_*`DEFVAR`

现在`FOO`的值`*x*`是动态查找的。`FOO`将采用当前*动态绑定*，`*x*`或者，如果没有，则采用符号的符号值`*x*`。例如，可以使用 引入新的*动态绑定*`LET`。

另一方面，词法变量必须存在于词法环境中的某个地方。`LET`, `LAMBDA`,`DEFUN`和其他人可以引入这样的词法变量。`x`请参阅此处以三种不同方式引入的词法变量：

```
(let ((x 3))
  (* (sin x) (cos x)))

(lambda (x)
  (* (sin x) (cos x)))

(defun baz (x)
  (* (sin x) (cos x))) 
```

如果我们的代码是：

```
(defvar x 0)

(let ((x 3))
  (* (sin x) (cos x)))

(lambda (x)
  (* (sin x) (cos x)))

(defun baz (x)
  (* (sin x) (cos x))) 
```

然后在上述所有三种情况下`X`都是*特殊*`DEFVAR`的，因为声明`X`是*特殊*的 - 全局适用于所有级别。因此，约定将*特殊*变量声明为`*X*`. 因此，只有周围有星星的变量是*特殊*的——**按照惯例**。这是一个有用的约定。

在您的代码中，您有：

```
(defun bar ()
  (foo)
  (let ((*x* 20))
    (foo))
  (foo)) 
```

由于已在您的代码中通过上述方式声明为特殊，因此该构造引入`*x*`了*一个*新的*动态绑定*。然后被调用。由于在内部使用动态*绑定*，它查找当前的并发现它是动态绑定的。`DEFVAR``LET`*`*x*``FOO``FOO``*x*`*`*x*``20`**

 **在当前动态绑定中可以找到*特殊*变量的值。

**本地特殊声明**

还有本地`special`声明：

```
(defun foo-s ()
  (declare (special *x*))
  (+ *x* 1)) 
```

如果变量已由a或声明为*特殊*变量，则可以省略局部声明。`DEFVAR``DEFPARAMETER``special`

词法变量直接引用变量绑定：

```
(defun foo-l (x)
  (+ x 1)) 
```

**让我们在实践中看看：**

```
(let ((f (let ((x 10))
           (lambda ()
             (setq x (+ x 1))))))
  (print (funcall f))    ; form 1
  (let ((x 20))          ; form 2
    (print (funcall f)))) 
```

这里所有的变量都是词法的。在*表格 2*中，`LET`不会影响`X`我们的函数`f`。它不能。该函数使用由`LET ((X 10)`. `X`用*形式 2*中的另一个词法绑定来包围调用对我们的函数没有影响。

让我们尝试*特殊*变量：

```
(let ((f (let ((x 10))
           (declare (special x))
           (lambda ()
             (setq x (+ x 1))))))
  (print (funcall f))    ; form 1
  (let ((x 20))          ; form 2
    (declare (special x))
    (print (funcall f)))) 
```

现在怎么办？那样有用吗？

它不是！

第*一种形式*调用该函数，它试图查找的动态值，`X`但没有。*我们在表单 1*中得到一个错误：`X`未绑定，因为没有动态绑定生效。

*形式 2*会起作用，因为`LET`with`special`声明引入了`X`.

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-21T01:32:35.750

当变量是**词法作用域**时，系统会查找**定义**函数的位置以查找自由变量的值。当变量是**动态作用域时，系统会查找****调用**函数的位置以查找自由变量的值。Common Lisp 中的变量默认都是词法的；**但是，可以使用defvar**或**defparameter**在顶层定义动态范围的变量。

**一个更简单的例子**

*词法作用域（使用 setq）：*

```
(setq x 3)

(defun foo () x)

(let ((x 4)) (foo)) ; returns 3 
```

*动态范围（使用 defvar）：*

```
(defvar x 3)

(defun foo () x)

(let ((x 4)) (foo)) ; returns 4 
```

let 如何知道一个变量是词法的还是动态的？**它没有。**另一方面，当 foo 去查找 X 的值时，它最初会找到在顶层定义的词法值。然后它检查变量是否应该是动态的。如果是，则 foo 查找调用环境，在这种情况下，调用环境使用 let 将 X 的值掩盖为 4。

*（注意：这是一个过度简化，但它有助于可视化不同范围规则之间的差异）*

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-12T21:24:17.830

也许这个例子会有所帮助。

```
;; the lexical version

(let ((x 10)) 
  (defun lex-foo ()
    (format t "Before assignment~18tX: ~d~%" x)
    (setf x (+ 1 x))
    (format t "After assignment~18tX: ~d~%" x)))

(defun lex-bar ()
  (lex-foo)
  (let ((x 20)) ;; does not do anything
    (lex-foo))
  (lex-foo))

;; CL-USER> (lex-bar)
;; Before assignment X: 10
;; After assignment  X: 11
;; Before assignment X: 11
;; After assignment  X: 12
;; Before assignment X: 12
;; After assignment  X: 13

;; the dynamic version

(defvar *x* 10)
(defun dyn-foo ()
  (format t "Before assignment~18tX: ~d~%" *x*)
  (setf *x* (+ 1 *x*))
  (format t "After assignment~18tX: ~d~%" *x*))

(defun dyn-bar()
  (dyn-foo)
  (let ((*x* 20))
    (dyn-foo))
  (dyn-foo))

;; CL-USER> (dyn-bar)
;; Before assignment X: 10
;; After assignment  X: 11
;; Before assignment X: 20
;; After assignment  X: 21
;; Before assignment X: 11
;; After assignment  X: 12

;; the special version

(defun special-foo ()
  (declare (special *y*))
  (format t "Before assignment~18tX: ~d~%" *y*)
  (setf *y* (+ 1 *y*))
  (format t "After assignment~18tX: ~d~%" *y*))

(defun special-bar ()
  (let ((*y* 10))
    (declare (special *y*))
    (special-foo)
    (let ((*y* 20))
      (declare (special *y*))
      (special-foo))
    (special-foo)))

;; CL-USER> (special-bar)
;; Before assignment X: 10
;; After assignment  X: 11
;; Before assignment X: 20
;; After assignment  X: 21
;; Before assignment X: 11
;; After assignment  X: 12 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-13T12:43:46.437

你也可以告诉你的 Lisp 动态绑定局部变量：

```
(let ((dyn 5))
  (declare (special dyn))
  ... ;; DYN has dynamic scope for the duration of the body
  ) 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-09-22T06:30:34.897

从 PCL 重写示例。

```
;;; Common Lisp is lexically scoped by default.

λ (setq x 10)
=> 10

λ (defun foo ()
    (setf x (1+ x)))
=> FOO

λ (foo)
=> 11

λ (let ((x 20))
    (foo))
=> 12

λ (proclaim '(special x))
=> NIL

λ (let ((x 20))
    (foo))
=> 21 
```

[On Lisp](http://www.paulgraham.com/onlisptext.html)的另一个很好的解释，第 2.5 章范围：

Common Lisp 是一个词法作用域的 Lisp。Scheme是最古老的具有词法范围的方言；在 Scheme 之前，动态范围被认为是 Lisp 的定义特性之一。

词法作用域和动态作用域之间的区别归结为实现如何处理自由变量。如果符号已被建立为变量，则符号在表达式中被绑定，无论是通过作为参数出现，还是通过变量绑定运算符（如 let 和 do）。不受约束的符号被称为是自由的。在这个例子中，作用域开始发挥作用：

```
(let ((y 7)) 
  (defun scope-test (x)
  (list x y))) 
```

在 defun 表达式中，x 是有界的，y 是自由的。自由变量很有趣，因为它们的值应该是什么并不明显。绑定变量的值没有不确定性——当调用 scope-test 时，x 的值应该是作为参数传递的任何值。但是 y 的值应该是多少？这是方言的范围规则回答的问题。

在动态作用域的 Lisp 中，为了在执行作用域测试时找到自由变量的值，我们回顾调用它的函数链。当我们找到绑定了 y 的环境时，y 的绑定将是 scope-test 中使用的绑定。如果我们没有找到，我们就取 y 的全局值。因此，在动态范围的 Lisp 中，y 将具有它在调用表达式中的值：

```
> (let ((y 5)) (scope-test 3))
    (3 5) 
```

对于动态范围，在定义范围测试时 y 绑定到 7 没有任何意义。重要的是调用 scope-test 时 y 的值为 5。

在词法范围的 Lisp 中，我们不是回顾调用函数链，而是回顾定义函数时的包含环境。在一个词法范围的 Lisp 中，我们的示例将捕获 y 的绑定，其中定义了 scope-test。所以这就是在 Common Lisp 中会发生的事情：

```
> (let ((y 5)) (scope-test 3))
    (3 7) 
```

这里调用时将 y 绑定到 5 对返回值没有影响。

尽管您仍然可以通过将变量声明为特殊来获得动态范围，但词法范围是 Common Lisp 中的默认设置。总的来说，Lisp 社区似乎对动态作用域的消逝没有什么遗憾。一方面，它曾经导致可怕的难以捉摸的错误。但是词法作用域不仅仅是一种避免错误的方法。正如下一节将展示的，它还使一些新的编程技术成为可能。

# java - 如何在 J2ME 中解析 URL

> ID：463482
> 
> 赞同：4
> 
> 时间：2009-01-20T23:00:32.797
> 
> 标签：java, url, parsing, java-me

我正在尝试使用 J2ME 从 URL 中提取查询的名称-值对，但这并不容易。J2ME 没有 java.net.URL 类，String 也没有 split 方法。

有没有办法使用 J2ME 从 URL 中提取名称-值对？任何开源实现也将受到欢迎。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T16:11:07.240

我喜欢[kchau](https://stackoverflow.com/users/22371/kchau)的回答，但我只是将数据结构从两个数组更改为一个哈希表。如果 URL 参数的数量未知，这也会有所帮助。

```
 String url = "http://www.so.com?name1=value1&name2=value2&name3=value3";

    Hashtable values = new Hashtable();

    int s = url.indexOf("?");  
    int e = 0;

    while (s != -1) {
        e = url.indexOf("=", s);              
        String name = url.substring(s + 1, e);
        s = e + 1;                            
        e = url.indexOf("&", s);              

        if (e < 0) {
            values.put(name, url.substring(s, url.length()));
        } else {        
            values.put(name, url.substring(s, e));
        }

        s = e;
    }

    for (Enumeration num = values.keys(); num.hasMoreElements();) {
            String key = (String)num.nextElement();
            System.out.println(key + "  " + values.get(key));
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-01T20:04:47.630

由于 Java JDK 是开源的，您还可以从主 JDK 中借用 java URL 类并将其添加到您的项目中。这将允许您使用 Java SE 中的相同实现：

[http://www.docjar.com/html/api/java/net/URL.java.html](http://www.docjar.com/html/api/java/net/URL.java.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T02:12:13.110

这是我的尝试，与大卫的回答有些相似。

```
 String url = "http://www.stackoverflow.com?name1=value1&name2=value2&name3=value3";

    String[] names  = new String[10];
    String[] values = new String[10];

    int s = url.indexOf("?");  // Get start index of first name
    int e = 0, idx = 0;

    while (s != -1) {
        e = url.indexOf("=", s);              // Get end index of name string
        names[idx] = url.substring(s+1, e);
        s = e + 1;                            // Get start index of value string
        e = url.indexOf("&", s);              // Get index of next pair

        if (e < 0)  // Last pair
            values[idx] = url.substring(s, url.length());
        else        // o.w. keep storing
            values[idx] = url.substring(s, e);

        s = e;
        idx++;
    }

    for(int x = 0; x < 10; x++)
        System.out.println(names[x] +" = "+ values[x]); 
```

测试了它，我认为它有效。希望对你有帮助，祝你好运。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T00:14:01.197

在我的脑海中，它会变成这样（警告：未经测试）：

```
String url = ...;
int s = url.indexOf("?") + 1;
while (s > 0) {
    int e = url.indexOf("=", s);
    String name = url.substring(s, e), value;
    s = e + 1;
    e = url.indexOf("&", s);
    if (e < 0)
        value = url.substring(s, e);
    else
        value = url.substring(s, e);
    // process name, value
    s = e;
} 
```

查询字符串在技术上可以用分号而不是和号分隔，例如`name1=value1;name2=value2;...`，尽管我在实践中从未见过它。如果这对您来说是一个问题，我相信您可以修复它的代码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T16:42:49.593

有没有 java.net.URL 的 J2ME 实现？它是[连接设备配置](http://java.sun.com/javame/reference/apis/jsr218/java/net/URL.html)、[基础配置文件](http://java.sun.com/javame/reference/apis/jsr219/java/net/URL.html)、[个人基本配置文件](http://java.sun.com/javame/reference/apis/jsr217/java/net/URL.html)和[个人配置文件](http://java.sun.com/javame/reference/apis/jsr216/java/net/URL.html)的一部分......

编辑：记录在案，这些是 CDC 1.1.2 链接，但根据[JSR36](http://jcp.org/aboutJava/communityprocess/mrel/jsr036/)，CDC 1.0 也有一个 java.net.URL 类。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-17T14:45:24.407

另外，请注意，url 参数是 URL 编码的，所以你可能需要先解码它们（如何做是另一个问题）

我以这种方式获取参数：

```
 public String getUrlParam(String url, String param)
{
    int startIndex = url.indexOf(""+param+"=");
    if (startIndex == -1)
        return null;
    int length = (""+param+"=").length();
    int endIndex = url.indexOf("&", startIndex+length);
    if (endIndex == -1)
        endIndex = url.length();
    return URLDecode(url.substring(startIndex+length, endIndex));
} 

```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-01-20T23:09:38.033

URL 编码器/解码器非常简单且易于编写。您还可以在 Internet 上查找任何开源 HTML 到 WML 转码器代码并对其进行修改。应该不会太难。

# windows-vista - 如何在 Vista 中获取 Application Data 文件夹/Word 模板文件夹？

> ID：463487
> 
> 赞同：2
> 
> 时间：2009-01-20T23:03:18.780
> 
> 标签：windows-vista, wix, windows-installer

使用 WiX (Windows Installer XML) 我创建了一个 MSI 安装程序，它将 Word 模板安装到用户应用程序数据文件夹中，例如在 Windows XP 上

```
C:\Documents and Settings\<user>\Application Data\Microsoft\Templates 
```

我正在从注册表中检索此文件夹的路径：

```
<Property Id="APPDIR" Secure="yes">
    <RegistrySearch Id="RegSearch_AppData" 
        Type="directory" 
        Key="Software\Microsoft\Windows\CurrentVersion\Explorer\Shell Folders"    
        Name="AppData" 
        Root="HKCU" />
</Property>

<CustomAction Id="ActionWordTemplateFolderAssign" 
              Property="TEMPLATEFOLDER" 
              Value="[APPDIR]Microsoft\Templates" /> 

<InstallExecuteSequence>
    <Custom Action="ActionWordTemplateFolderAssign" Sequence="1" />
</InstallExecuteSequence> 
```

**但是，某些在 Windows Vista**上安装 MSI 文件的用户会收到错误，因为**APPDIR**属性为**空**。

APPDIR 不是检索应用程序数据文件夹的正确方法吗？还是我必须考虑在 Vista 上的另一处房产？

编辑：这只是检索 Word 模板文件夹的 WiX 代码的简短版本。首先，我实际上是在检查用户是否具有由策略或 HKCU\Software\Microsoft\Office\12.0\Common\General\UserTemplates 下定义的自定义模板文件夹。但是，如果这些都没有设置，则回退是使用上面代码检索到的 %APPDATA%\Microsoft\Templates 下的默认位置。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-20T23:20:34.563

您应该改用[[AppDataFolder]](http://msdn.microsoft.com/en-us/library/aa367565(VS.85).aspx)。[我在Windows 安装程序属性参考](http://msdn.microsoft.com/en-us/library/aa370905(VS.85).aspx)中找不到任何关于“appdir”的信息。

**问题编辑**后编辑：您从中获取 appdir 值的[shell 文件夹键（很棒的博文顺便说一句）是一种非常古老且已弃用的获取系统文件夹的方法。](http://blogs.msdn.com/oldnewthing/archive/2003/11/03/55532.aspx)它只是为了向后兼容，你不应该依赖它。特别是如果你住在 Raymond Chen 附近。

**编辑2**：由于真正的问题是“我如何找到用户的单词模板文件夹”......单词模板文件夹并不总是

```
[AppDataFolder]\Microsoft\Templates 
```

这是因为可以在**工具-选项-文件位置-用户模板**下配置模板文件夹。具有讽刺意味的是，如果我们想检测到这一点，我们又回到了搜索注册表：

```
 <Property Id="USERTEMPLATES">
     <RegistrySearch Id="SearchUserTemplates"
             Root="HKCU"
             Key="Software\Microsoft\Office\11.0\Common\General"
                 Name="UserTemplates"
             Type="raw" />
  </Property> 
```

但是，此注册表值通常不存在，并且您不能在此处指定包含 [AppDataFolder] 的默认值（我尝试过）。

相反，我会尝试定义两个组件，一个安装到 USERTEMPLATES，另一个安装到 [AppData]\Microsoft\Templates。然后，您可以使用 Condition 元素来测试 USERTEMPLATES 是否存在，并只安装正确的元素。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T00:38:44.970

一些附加信息：

包含特殊文件夹的 MSI 属性参考：

[http://msdn.microsoft.com/en-us/library/aa370905(VS.85).aspx#system_folder_properties](http://msdn.microsoft.com/en-us/library/aa370905(VS.85).aspx#system_folder_properties)

以及相关博客文章的链接：

[.NET 中的 Environment.SpecialFolder.ApplicationData 的 WiX 等价物是什么？](https://stackoverflow.com/questions/199173/what-is-the-wix-equivilent-of-environment-specialfolder-applicationdata-from-net)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T01:54:32.367

Divo - 针对您对本地化 Vista 安装的评论，问题可能不是本地化 Vista（除非我读错了），而是本地化 Office。

`Microsoft\Templates`例如，可能会成为`Microsoft\Vorlagen` 德国办事处。这真是让人头疼，因为我还没有找到可靠的文档来源，说明哪些文件夹名称已在 Office 中本地化，哪些没有。

我的特殊问题是将宏安装到`[AppDataFolder]Microsft\Word\`**`STARTUP`**-仅针对某些语言进行了本地化。#$%# 最后我们只是让客户手动移动模板，我们的大多数市场都没有问题，但我们注意到意大利和土耳其办事处以及其他几个似乎表现出这种相当烦人的行为。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T06:23:32.497

在 Vista 上，有一个名为 TemplateFolder 的新标准文件夹可用。我*认为*这就是你想要的。要在 WiX 中使用它，只需执行以下操作：

```
<DirectoryRef Id="TARGETDIR">
   <Directory Id="TemplateFolder" Name="Templates"/>
</DirectoryRef> 
```

然后，您可以在任何需要的地方引用 TemplateFolder 目录。

# javascript - 奇怪的 IE 7 javascript 问题

> ID：463488
> 
> 赞同：4
> 
> 时间：2009-01-20T23:04:53.300
> 
> 标签：javascript, internet-explorer-7, stomp, orbited

我有这个 javascript 代码在 firefox、chrome 和 safari 中工作

```
for (idx in all_auction_ids){
    alert(all_auction_ids[idx]);
}; 
```

对于上述情况，`all_auction_ids`我得到的第一个值不是在 中获取值，而是看起来像 for 循环的函数类型的文本！

但是如果我运行下面的代码，它工作正常。

```
for (idx=0;idx<all_auction_ids.length;idx=idx+1){
    alert(all_auction_ids[idx]);
}; 
```

编辑：更新

我做了一些调试，发现添加 Orbited 和 stomp.js 可能正在对数组做一些事情！

现在我正在使用 Tracker1 的建议 jquery 的 $.each。

更多信息： [http ://groups.google.com/group/orbited-users/browse_thread/thread/7fd658cfb166e9fa](http://groups.google.com/group/orbited-users/browse_thread/thread/7fd658cfb166e9fa)

有问题的数组 [http://bayimg.com/fAnhaAaBb](http://bayimg.com/fAnhaAaBb)

阵列没有问题 [http://bayimg.com/FaNhEAabb](http://bayimg.com/FaNhEAabb)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-20T23:16:58.723

JavaScript 的 for/in 构造传统上用于迭代对象成员名称，而不是数组索引。更具前瞻性的浏览器添加了隐藏属性等功能，以帮助像 Array 这样的案例以您期望的方式枚举，但 IE 仍然采用老式方式，并在您使用 for 时为您提供像“toString”方法这样的对象成员/in 在一个数组上。

indexed-for 仍然是规范的 JavaScript 数组循环。（尽管您可能的意思是 'for ( **var** idx=...'，而 'idx++' 更常见。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-20T23:50:43.350

值得注意的是，prototype.js 等一些库扩展了 Array，因此它们具有超出内部索引的附加属性。这打破了 x in y 表示法，正如其他提到的那样，IE 将迭代属性。对于 i=0...i++ 是首选。

另外值得注意的是 jQuery、prototype 和其他提供了我实际上更喜欢的 .each(fn) 表示法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T23:37:15.437

我同意@bibince 的观点，您可能应该使用 " `for(var i = 0...`" 语法，但没有理由认为您选择的语法不应该工作，除非您在创建`all_auction_ids`. 你是如何初始化你的数组的？

JavaScript 中的数组只是具有特殊自动递增功能的对象，但实际上它们与匿名对象并没有太大区别。在 Firebug 中试试这个：

```
var a = ['a','b','c'];
a.d = 'd';
for(var i in a) console.log(i, a[i]); 
```

或将其粘贴到 IE 的地址栏中，然后按 Enter：

```
javascript:var a = ['a']; a.d = 'd'; for(var i in a) alert(a[i]); alert(a.length); 
```

**编辑：**

我怀疑这是你的问题，但如果你使用，你有同样的问题：

```
var all_auction_ids = []; 
```

而不是

```
var all_auction_ids = new Array(); 
```

如果这没有帮助，那么您能否发布更多代码，让我们更好地了解您的填充方式`all_auction_ids`？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T17:06:24.500

[YUI 博客上的这个主题](http://yuiblog.com/blog/2006/09/26/for-in-intrigue/)与您的问题密切相关。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-04T15:29:21.010

我最近在为复选框列表创建“全选/全部清除”按钮时遇到了类似的问题。在 Firefox 和 Chrome 中它们可以正常工作，但在 IE7/8 中它们不能。我没有使用任何框架或外部库，所有的 JavaScript 都是我自己的，它是相当简单的东西，而且没有太多。我使用 getElementsByTagName 构建输入元素数组，然后循环：

```
var allClearInputs = document.getElementsByTagName("input");
for(ac=0;ac<allClearInputs.length;ac=ac+1){
    if(allClearInputs[ac].id){
        var thisNameArr = allClearInputs[ac].id.split("-");
        var thisName = thisNameArr[0];
        if(thisName == checkName){
            if((actionType == 'all' && allClearInputs[ac].checked == false) || (actionType == 'clear' && allClearInputs[ac].checked == true)){
                allClearInputs[ac].click();
            }
        }
    }
} 
```

完美配合：for(ac=0;ac<allClearInputs.length;ac=ac+1){
惨遭失败：for(var ac in allClearInputs)

# c - C中的套接字编程

> ID：463493
> 
> 赞同：4
> 
> 时间：2009-01-20T23:07:51.423
> 
> 标签：c, sockets, network-programming

好的，所以我正在尝试使一些 UDP 代码正常工作，而在使用 C 进行网络编程时，我几乎不熟悉。我正在使用[此处的示例文件](http://beej.us/guide/bgnet/examples/listener.c)

基本上我只是在给定端口上监听传入的 UDP 数据包，然后我想以同样的方式发回一些数据。下面是相关部分。

此时套接字已设置并绑定到选择的端口并等待传入​​的数据包：

```
printf("GSProxy: waiting to recvfrom...\n");

addr_len = (socklen_t) sizeof their_addr;
if ((numbytes = recvfrom(sockfd, buf, MAXBUFLEN-1 , 0,
    (struct sockaddr *)&their_addr, &addr_len)) == -1) { // argument 6 gives a warning but is correct int
    perror("recvfrom");
    exit(1);
}

printf("GSProxy: got packet from %s\n", 
inet_ntop(their_addr.ss_family, 
    get_in_addr((struct sockaddr *)&their_addr), s, sizeof s));
printf("GSProxy: packet is %d bytes long\n", numbytes);
buf[numbytes] = '\0';
printf("GSProxy: packet contains \"%s\"\n", buf);

char retmsg[] = "Hello!";
if ((numbytes = sendto(sockfd, retmsg, 7, 0, 
    (struct sockaddr *) &their_addr, &addr_len)) == -1) {
    perror("GSPProxy: sendto");
    exit(1);
}

printf("GSProxy: Sent %i bytes.\n", numbytes); 
```

我只想发送“你好！” 字符串直接返回给发送者。

这失败并出现错误“ `GSPProxy: sendto: File name too long`”。据我所知，这是 [ENAMETOOLONG] 错误代码。

但是... ** 是什么意思？什么文件？什么是太长了？

是我不能重用套接字来发回数据，还是我刚刚犯了另一个新手错误？

最好的祝福，

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-20T23:17:58.797

您不应该将套接字结构长度的地址传递给`sendto()`- 它需要实际长度（即`"addr_len"`，不是`"&addr_len"`）。

将长度*地址*传递给的原因`recvfrom()`是，如果实际地址恰好更短，则该函数会更改它。

换句话说，替换：

```
if ((numbytes = sendto (sockfd, retmsg, 7, 0,
    (struct sockaddr *) &their_addr, &addr_len)) == -1) { 
```

和：

```
if ((numbytes = sendto (sockfd, retmsg, 7, 0,
    (struct sockaddr *) &their_addr, addr_len)) == -1) { 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T23:18:39.500

呃，至少你在sendto中传递的'&addr_len'可能不应该通过地址传递：即：应该只是addr_len。

# nhibernate - 如何在 FluentNHibernate 中创建复合 UNIQUE 约束？

> ID：463499
> 
> 赞同：25
> 
> 时间：2009-01-20T23:09:59.937
> 
> 标签：nhibernate, fluent-nhibernate, nhibernate-mapping

我知道我可以`Map(x => x.GroupName).WithUniqueConstraint()`为一个单一的财产。

但是如何在 fluent nHibernate 中创建复合唯一约束（其中唯一约束对两列的组合进行操作）？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-01-26T19:09:12.033

在我使用的最新版本中，就是`UniqueKey("KeyName")`这样做的。

```
Map(x => x.Something).UniqueKey("KeyName");
Map(x => x.SomeOtherThing).UniqueKey("KeyName"); 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-26T18:58:51.727

`SetAttribute`在您的映射文件中使用，如下所示：

```
Map(x => x.Something).SetAttribute("unique-key", "someKey");
Map(x => x.SomeOtherThing).SetAttribute("unique-key", "someKey"); 
```

# debugging - Watson 博士在挂起的进程上崩溃转储

> ID：463501
> 
> 赞同：2
> 
> 时间：2009-01-20T23:10:43.727
> 
> 标签：debugging

如果我在挂起的进程上获取 Dr Watson 故障转储而不是 ADPlus 挂起转储，会有什么不同吗？

谢谢你苏里亚

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T06:45:36.320

我用 adplus -hang 和 drwtsn32 创建了一个完整的转储，并使用 dumpchk 来比较两者。两者都是完整转储，但使用的标志不同（在 XP sp3 上）

德沃森：

```
0002 MiniDumpWithFullMemory
0004 MiniDumpWithHandleData 
```

挂起模式 ADPlus：

```
0002 MiniDumpWithFullMemory
0004 MiniDumpWithHandleData
0020 MiniDumpWithUnloadedModules
0800 MiniDumpWithFullMemoryInfo
1000 MiniDumpWithThreadInfo 
```

因此，除非您需要来自转储的那种额外信息 - 配置 DrWatson 为您提供完整的内存转储与使用 adplus 一样好。有关这些标志的更多信息，请访问[debugInfo.com](http://www.debuginfo.com/articles/effminidumps.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T00:00:30.380

只有当进程实际崩溃时，Watson 博士才会生成崩溃转储。如果进程只是挂起而没有崩溃，则永远不会调用 Dr. Watson。ADPlus 旨在能够在进程仍在运行时捕获有关挂起的信息。

Microsoft 提供了一些[关于 ADPlus](http://support.microsoft.com/kb/286350)的信息，这些信息可能有助于解释这些工具之间的差异。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-25T04:17:50.923

如果您有兴趣了解 Windows 如何检测 apphangs，我们在 Windows 错误报告博客上添加了一些帖子：

[让有挂起第 1 部分 4](http://blogs.msdn.com/wer/archive/2009/03/19/let-there-be-hangs-part-1-not-responding.aspx) [让有挂起第 2 部分 4](http://blogs.msdn.com/wer/archive/2009/03/19/let-there-be-hangs-part-2-wer-history-101.aspx) [让有挂起第 3 部分 4](http://blogs.msdn.com/wer/archive/2009/03/19/let-there-be-hangs-part-3-the-hungapp-module.aspx) [让有挂起第 4 部分 4](http://blogs.msdn.com/wer/archive/2009/03/19/let-there-be-hangs-part-4-better-bucketing-in-windows-vista.aspx)

需要注意的重要一点是，通过 Microsoft 的 Windows 错误报告发送此信息时，会与软件开发人员交流以尝试解决这些问题。如果您发送错误报告，您将帮助解决 PC 上出现的问题！

我是 Microsoft 的 Windows 错误报告团队的项目经理。

# .net - 对升级后的 Web 应用程序中的“系统”未定义消息进行故障排除

> ID：463503
> 
> 赞同：0
> 
> 时间：2009-01-20T23:12:41.007
> 
> 标签：.net, asp.net, asp.net-2.0, asp.net-3.5

我有一个最初是在 .Net 1.1 Framework 上编写的 Web 应用程序。从那以后，我尝试将其升级到 .Net 3.5 Framework。我现在在我的页面上抛出了这个 javascript 错误，我一生都无法弄清楚为什么。

我已经将应用程序定位为 .Net 3.5 框架，甚至在 web.config 文件中删除并重新添加。关于如何解决此问题的任何想法？

**更新 2009 年 1 月 20 日下午 6:44**

我验证了我的 httpHandlers，每个[@Zhaph Ben Duguid](https://stackoverflow.com/users/33051/zhaph-ben-duguid)部分看起来不错......创建了一个新的 WebForm1.aspx 页面，添加了一个脚本管理器，但仍然出现相同的错误。

**解析度**

这是一个抛出错误的旧组件艺术 javascript 库。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-20T23:34:54.007

我倾向于在 Firefox 中使用 FireBug - 它允许您查看每个动态 .js 文件的内容 - 您可能会发现其中一个正在产生 404 或 500 内部服务器错误。

在不知道您使用的是哪个 AJAX 框架的情况下，我真的帮不上什么忙，但我会看一下 web.config 中声明的 httpHandlers，您可能应该会看到一些条目，例如：

```
 <httpHandlers>
        <remove verb="*" path="*.asmx" />
        <add verb="*" path="*.asmx" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
        <add verb="*" path="*_AppService.axd" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
        <add verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" validate="false" />
        <add verb="*" path="*.mvc" validate="false" type="System.Web.Mvc.MvcHttpHandler, System.Web.Mvc, Version=1.0.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" />
    </httpHandlers> 
```

这些是针对标准 .NET 3.5 脚本库的，您的可能会有所不同。

但是看看那里，并确保引用的库可用 - 将此部分与原始 1.1 web.config 中的同一部分进行比较 - 这应该会让你走上正轨。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T23:18:08.640

我猜想缺少 javascript 库 - 检查您的访问日志以查看生成 404 的请求。

# jquery - 如何使用 jQuery 获取文本框的值？

> ID：463506
> 
> 赞同：498
> 
> 时间：2009-01-20T23:13:30.960
> 
> 标签：jquery

我可以得到这样的元素，`$("#txtEmail")`但我不确定如何获得实际值。

* * *

## 回答 #1

> 赞同：782
> 
> 时间：2009-01-20T23:17:29.767

有一个`.val()`方法：

如果您有一个 id 的输入，`txtEmail`则可以使用以下代码访问文本框的值：

```
$("#txtEmail").val() 
```

您还可以使用该`val(string)`方法设置该值：

```
$("#txtEmail").val("something") 
```

* * *

## 回答 #2

> 赞同：75
> 
> 时间：2009-01-20T23:16:59.797

使用 .val() 方法。

另外，我认为您打算将其`$("#txtEmail")`用作您可能没有`$("txtEmail")`的类型的返回元素。`<txtEmail>`

请参阅此处[的 jQuery 文档](http://api.jquery.com/category/selectors/)。

还有[jQuery val() 方法](http://api.jquery.com/val/)。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2012-03-08T22:59:20.313

**可能重复：**

只是附加信息，我花了很长时间才找到。如果您使用字段名称而不是 id 来识别表单字段，该怎么办。你这样做：

对于单选按钮：

```
 var inp= $('input:radio[name=PatientPreviouslyReceivedDrug]:checked').val(); 
```

对于文本框：

```
 var txt=$('input:text[name=DrugDurationLength]').val(); 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-01-21T13:12:44.433

注意到您关于使用它进行电子邮件验证并需要插件的评论，验证插件可能会帮助您，它位于[http://bassistance.de/jquery-plugins/jquery-plugin-validation/](http://bassistance.de/jquery-plugins/jquery-plugin-validation/)，它带有一封电子邮件规则为好。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-07-03T12:32:02.193

有一种`.val();`方法可以使用。

所以在你的情况下你会想要使用`$("#txtEmail").val();`. 另外，请确保将 id 属性添加到您的 html 代码中！

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-11-19T09:36:12.253

使用该`.val()`方法获取您需要的元素的实际值。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2015-08-26T08:08:14.037

您可以通过其 ID 或通过其类名称访问 Texbox 控件的值。

这是示例代码：

```
<input type="text" id="txtEmail" class="textbox" value="1">

$(document).ready(function(){
   alert($("#txtEmail").val());
   alert($(".textbox").val());//Not recommended 
}); 
```

使用类名获取任何文本框控件值可能会返回其他值或错误值，因为也可以为任何其他控件定义相同的类名。因此，可以通过其 id 获取特定文本框的值。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-10-15T09:11:28.103

通过使用

```
$("#txtEmail").val() 
```

你得到元素的实际值

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2020-07-13T17:40:15.367

根据 Jquery 文档

`The .val() method is primarily used to get the values of form elements such as input, select and textarea. When called on an empty collection, it returns undefined.`

为了在 id 为 txtEmail 的文本框中检索值存储，您可以使用

```
$("#txtEmail").val() 
```

# version-control - 什么是持续集成？

> ID：463511
> 
> 赞同：47
> 
> 时间：2009-01-20T23:16:33.043
> 
> 标签：version-control, configuration, continuous-integration

什么是持续集成，它有什么好处？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-01-20T23:24:20.673

[这](http://martinfowler.com/articles/continuousIntegration.html)是迄今为止我读过的最好的解释。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-20T23:32:30.703

在最简单的情况下，它只是一种机制，只要签入某个版本控制系统（CVS 等），就会重新构建您的项目。这可以扩展到包括运行测试，一直到生成 CD 映像、将其安装在 VM 中、安装产品并在其上运行完整测试。

它有一个简单的优点，即在代码更改尽早破坏系统时突出显示。它不仅可以检测代码中的中断，还可以突出显示中断的原因。这种心理效应对于鼓励在入住前进行良好的测试非常有效！

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-20T23:18:47.283

这是确保您的软件开发过程的所有方面都排成一列以允许每天创建产品的工作版本的做法。它最出名的是极限编程的一部分。

这涉及到构建自动化、自动化测试、日常签入、使用源代码存储库等领域。但最终目标是帮助整个项目按照核心敏捷原则运行，以便您尽早并经常交付。这反过来又可以帮助您利用来自用户等的反馈。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-20T23:43:46.873

+1 链接到 Fowler 的页面。

就个人而言，我只是觉得知道什么时候没有编译是“很好的”，因为我们在单一构建方面的做法很糟糕（是的，我们在生产构建上开发；我们很棒）。在我离开之前，我们还没有进入集成测试阶段。

然而，过了一段时间，它确实减少了大规模编码更改的数量（与猖獗的“签入并祈祷我的更改不会冲突”相比）。最终，大多数开发人员开始频繁地进行小改动，只是为了从 CC.Net 托盘图标中获得确认。

总的来说，我很欣慰地知道我们可以在必要时立即发送构建。如果我们只集成了一些烟雾测试，我认为压力水平会大大降低。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2017-02-13T22:06:04.633

只是为了刷新。在这一点上，持续集成 (CI) 和持续交付 (CD) 之间存在巨大差异。虽然上面的大多数帖子都描述了 CD，但我将尝试展示 CI 如何扩展现在的 CD 定义。拥有构建包和自动部署新版本应用程序所需的所有工具是 CD 的关键部分。添加到测试自动化（基于三级验证：一般健康检查、详细统计和历史条目）和适当的治理，您正在创建一个非常好的 CI。正是因为有了这样一个扩展的定义，才能构建非凡的云工具。想想 muleESB 或 esbeetle.com。尽管只有第二个同时支持 ESB 和 ETL 组件，但对于它们两者来说，CI 都是自然而然的事情。

我希望它是有帮助的。

# project-management - 如何告诉项目经理“不”进行范围蔓延

> ID：463512
> 
> 赞同：13
> 
> 时间：2009-01-20T23:16:45.087
> 
> 标签：project-management, scope, requirements, scope-creep

尽管项目经理可能每个人都有自己的个性和管理风格，但似乎他们中的许多人都对在可能的情况下（无论是否有人在看）**潜入“范围蔓延”充满了有害的爱。**虽然他们通常是善意的（祝福他们的心），**但您发现对项目经理说“不”的最佳方式是什么？**

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-01-20T23:22:05.437

首先让我说，如果项目经理“潜入范围蔓延”，那么他就是一个非常糟糕的项目经理。

话虽如此……对项目经理说不不是你的工作。你的工作是确保他知道并理解他正在做的改变的成本和风险。如果 PM 坚持改变范围并且不调整项目中的任何其他内容，那就换一份工作（因为项目和/或公司注定要失败）。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-01-20T23:35:04.597

一个好的经验法则是总是回答，“好的。我们应该放弃什么才能在截止日期前完成？” 和/或“好的。如果我们将截止日期移到 X，我们可以添加它。”

每个更改都会影响完成时间。没有零时间任务。迫使项目经理意识到每次进行更改时质量、截止日期或功能列表都会受到影响，这将大大有助于让他们正确思考范围蔓延。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-20T23:20:20.103

通过对范围内的内容进行良好的成本核算和功能设计，将其带回给他们并询问他们是否要推迟日期或削减其他功能。如果是后者，哪些功能不再重要但尚未启动？

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-01-20T23:22:03.050

最简单的方法是坚定地告诉他们，如果您包含附加功能，**它将**影响发布日期。归根结底，他们的工作是按时交付产品，因此他们的底线是“我们能否在不破坏时间表的情况下适应它”。如果答案是否定的，那么任何值得他们薪水的项目经理都应该坚定地站在开发一边，同意这是不可接受的范围蔓延。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-20T23:31:54.183

**说实话**

说明发货日期、质量和功能之间存在紧密的依赖关系。告诉他们，如果他们想满足发货日期，如果添加新功能，质量将受到影响。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-20T23:29:24.330

很有可能，虽然您认为您的项目经理“非常喜欢在可能的情况下潜入“范围蔓延”中”，但他的观点可能不同。确保你理解他的观点可能更有成效。

这当然是除了传达您自己的观点之外，即范围蔓延的后果。您可能需要在开发计划中明确标识额外工作，估计额外工作需要多长时间，并解释这意味着延迟或放弃某些其他功能。

这仅在您的估计有任何好处时才有效。如果您在书本之外进行额外的工作，这将不起作用，因此所花费的额外时间是不可见的。否则，您可能会因为其他原因赶上最后期限，例如更努力地工作或提高效率，而您的项目经理只会记住范围蔓延不会影响“最后一次”的交付日期。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-20T23:32:17.863

通过说服他理解你是如何试图帮助他保住他的工作（即你告诉他真相）。我想他比你有更多的风险。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-20T23:36:08.777

如果您想在您的组织中取得成功，您将希望成为一名团队合作者，并应努力展示您的承诺。有时，这意味着要花一些额外的时间来为产品提供一个很棒的新建议。

但是，通过严格限制对您的合理期望，您更有可能赢得尊重。做到这一点的一种方法是帮助经理了解他们不会通过参与范围蔓延来*改进*产品，但从长远来看，他们更有可能*损害产品。*

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-28T01:20:57.850

客户是否要求潜入项目中的部分？它们是要交付的贵重物品吗？

如果 PM 将内容偷偷带入范围并且不让它们可见，那么 PM 肯定存在问题。这是一个严重的问题，我会直接和公开地向他们提出。

然而，范围蔓延（在我的书中）是完全可以接受的，如果它继续满足业务需求的话。当然，您有截止日期，但是在截止日期前灵活交付有什么问题？这是可见性至关重要的地方。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-21T10:35:08.383

过去对我来说效果很好的东西：

我认为如果您的项目经理想要潜入功能，他们没有准确的项目计划。保留您自己的任务列表，估计每项任务需要多长时间，按优先级排序 - 它不需要详细说明，只是一个文本文档或电子表格。如果您的项目经理希望您添加新功能，请发送一份您的列表副本，并询问您应该按照优先顺序将其插入到哪里。

如果项目经理试图协商降低您的时间估算，那么只需说“我会尽力而为，但我不能保证任何事情”。

# html - 使用 CSS 以字体大小表示的表格单元格高度

> ID：463515
> 
> 赞同：2
> 
> 时间：2009-01-20T23:17:24.290
> 
> 标签：html, css, calendar

我有一张桌子（特别是日历）。当任何日期都没有写入任何内容时，我想让日历看起来不难看，所以我希望单元格的最小大小等于字体高度的四倍。（也就是说，如果我有一个没有任何内容的日历行，以及一个包含四行文本的日历行，我希望它们的大小相同）。

到处说用`em`。但是，我尝试使用`4em`我的`12pt`字体，但离我很近：

```
td.day {
    padding: 2px;
    font-size: 12pt;
    width: 14.3%;
    height: 4em;
    vertical-align: top;
} 
```

我精确地计算了像素，以及我正在使用的特定字体的 12pt 字体，

```
font-family: verdana, arial, "sans-serif"; 
```

有一个`height`。`22px`这不是很灵活，但是......有没有更好的方法来做到这一点？

再想一想，我确信该`em`单位正确地告诉我字体的高度。它只是没有考虑行间距或填充或其他任何类型的东西。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-20T23:40:29.923

你必须考虑你的线高乘数。对于您的 td 元素，如果您选择 12pt 的字体大小，则还必须指定行高。例如，如果您想要 18px 的行高和 12pt 的字体大小：

```
td.day {
    font-size: 12pt;
    line-height: 1.5;
} 
```

请确保不要使用像 em 或 px 这样的单位来指定行高，因为它是字体大小的乘数。你的 line-height 现在是 18px，或者如果你想使用 ems，1.5em。现在，如果你想指定四行的高度，你会使用 6em。

# c++ - XDrawString 在 Solaris 上不起作用

> ID：463526
> 
> 赞同：1
> 
> 时间：2009-01-20T23:20:59.807
> 
> 标签：c++, solaris, xlib

我`XDrawString`在 Solaris 10 和 SunOS 2.6 上使用。我正在将所有内容绘制到像素图，然后输出最终的像素图。该方法适用于旧版本，但在较新版本上它似乎不起作用，不显示任何文本。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-21T17:52:29.167

hhafez 可能是对的，我们需要更多信息。但是跨环境可能与您何时以及如何调用 XFlush() 或 XSynchronize() 有关，请参阅以下手册页： [http](http://www.xfree86.org/current/XSynchronize.3.html) ://www.xfree86.org/current/XSynchronize.3.html 。

# javascript - 使用 JavaScript 通过类型而不是名称来操作 HTML 输入（复选框）元素

> ID：463535
> 
> 赞同：12
> 
> 时间：2009-01-20T23:26:10.717
> 
> 标签：javascript, html

我正在实现一个带有一些复选框输入元素的 HTML 表单，并且我想要一个 Select All 或 DeSelect All 按钮。但是，*我不想依赖*输入元素的名称（如[本示例](http://www.plus2net.com/javascript_tutorial/checkbox-checkall.php)），而是依赖**类型**，因为我有多个具有不同名称的复选框组。有没有办法通过依赖类型而不是名称来使用 JavaScript 检查和取消选中表单中的所有复选框输入元素？

编辑：我们依赖 YUI 库，所以如果提供解决方案，我可以访问 YUI。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-20T23:43:39.557

这应该这样做：

```
<script>
function checkUncheck(form, setTo) {
    var c = document.getElementById(form).getElementsByTagName('input');
    for (var i = 0; i < c.length; i++) {
        if (c[i].type == 'checkbox') {
            c[i].checked = setTo;
        }
    }
}
</script>

<form id='myForm'>
<input type='checkbox' name='test' value='1'><br>
<input type='checkbox' name='test' value='1'><br>
<input type='checkbox' name='test' value='1'><br>
<input type='checkbox' name='test' value='1'><br>
<input type='checkbox' name='test' value='1'><br>
<input type='button' onclick="checkUncheck('myForm', true);" value='Check'>
<input type='button' onclick="checkUncheck('myForm', false);" value='Uncheck'>
</form> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-20T23:36:23.440

遍历 form.elements 集合并检查 .type == "checkbox"。

```
var button = getSelectAllButtonInFormSomeHow();
/*all formelements have a reference to the form. And the form has an elements-collection.*/
var elements = button.form.elements;

for(var i = 0; i < elements.length;i++) {
    var input = elements[i];
    if (input.tagName == "input" && input.type == "checkbox") input.checked = true;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T23:42:46.253

```
function findCheckBoxes(el, check) {
        for(var i=0;el.childNodes[i];i++)
        {
            var child = el.childNodes[i];
            if (child.type=="checkbox")
            {
                child.checked = check;
            }
            if (child.childNodes.length > 0)
                this.findCheckBoxes(child, check);
        }
    } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-20T23:48:55.523

每个输入元素都有一个属性，类型，对于复选框，它是“复选框”，所以你可以尝试这样的事情：

```
for (var i = 0; i < document.myForm.elements.length; i++) {
    if (document.myForm.elements[i].type == "checkbox") {
        document.myForm.elements[i].checked = true;
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-20T23:33:22.277

如果 jQuery 是一个选项，你可以很容易地做到这一点。

请参阅有关[jQuery 选择器](http://docs.jquery.com/API/1.1.2/DOM/Traversing/Selectors#Using_CSS_and_XPath_Together)的文档。（本节中的最后一个示例显示了如何使用单选按钮执行此操作，但只需将其替换为复选框。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-20T23:57:05.740

为所有必需的复选框元素分配一个类是一个选项吗？如果是，那么我会这样做（假设“class_name”是所有相关复选框元素中存在的 css 类的名称）：

```
function selectCheckBoxes(bChecked) {
   var aCheckBoxes = YAHOO.util.Dom.getElementsByClassName('class_name', 'input');
   for (var i = 0; i < aCheckBoxes.length; i++) {
      aCheckBoxes[i].checked = bChecked;
   }
} 
```

如果您想远离类，但可以通过 ID（或任何其他方法，我将在示例中使用 ID）获取父元素，则可以这样做：

```
function selectCheckBoxes(bChecked) {
   var oParent = document.getElementById('parentsID');
   var aElements = oParent.getElementsByTagName('input');
   for (var i = 0; i < aElements.length; i++) {
      if (aElements[i].type == 'checkbox') {
         aElements[i].checked = bChecked;
      }
   }
} 
```

但是，我会坚持使用“类”方法。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2011-07-09T08:24:27.740

```
<html>
<head>
<script>
function selectCheckBox()
{   
     if(document.getElementById('id11').checked==true)
     {
        document.frm.id2.checked=true
        document.frm.id3.checked=true
        document.frm.id4.checked=true
     }
     if(document.getElementById('id11').checked==false)
     {
        document.frm.id2.checked=false
        document.frm.id3.checked=false
        document.frm.id4.checked=false
     }
}
function selectCheckBox1()
{
     if(document.getElementById('id12').checked==false)
     {
        document.frm.id1.checked=false
     }  
}
function selectCheckBox2()
{
     if(document.getElementById('id13').checked==false)
     {
        document.frm.id1.checked=false
     }  
}
function selectCheckBox3()
{
     if(document.getElementById('id14').checked==false)
     {
        document.frm.id1.checked=false
     }  
}
</script>

</head>
<body>
<form name="frm">
All   :<input type="checkbox" id="id11" name="id1" value="1" onClick="selectCheckBox()"><br>
A.    :<input type="checkbox" id="id12" name="id2" value="2" onClick="selectCheckBox1()"><br>
B.    :<input type="checkbox" id="id13" name="id3" value="3" onClick="selectCheckBox2()"><br>
C.    :<input type="checkbox" id="id14" name="id4" value="4" onClick="selectCheckBox3()"><br>
</form>
</body>
</html> 
```

# vim - vi的自动格式化？

> ID：463539
> 
> 赞同：7
> 
> 时间：2009-01-20T23:27:30.587
> 
> 标签：vim, vi, code-formatting

vi 是否存在允许我定义每种语言首选项的自动格式化工具？

**编辑：**我不是在寻找语法高亮。我正在寻找可以将格式化规则应用于我的代码的东西。（如支撑定位、操作员周围的空间等）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-20T23:30:57.290

好吧，Vim 已经涵盖了很多语言，并且很容易根据语言进行定制。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-21T00:38:59.697

[Vim 对特定](http://vimdoc.sourceforge.net/htmldoc/filetype.html)于文件类型的自定义有大量支持。你可能会在那里找到你要找的东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-21T01:40:45.280

您可以`~/.vim/ftplugin/`为每种文件类型添加一个文件。例如，设置`~/.vim/ftplugin/c.vim`为

```
set tabstop=2 shiftwidth=2 
```

这会将 C 文件的缩进设置为两个空格。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-21T00:44:13.867

你可以使用vim。如果您使用的是 GNU/Linux，请查看 /etc/vim/vimrc 以了解全局默认值。您可能想要的一些东西是“syntax on”、“filetype indent on”和“set showmatch”。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-12-03T20:22:09.607

有一个 vim 插件可以在 vim 中对您的代码进行格式化。它叫做 vim-autoformat，你可以在这里下载它：

[https://github.com/vim-autoformat/vim-autoformat](https://github.com/vim-autoformat/vim-autoformat)

它将外部代码格式化程序集成到 vim 中。例如，如果要格式化 C、C++、C# 或 Java 代码，可以安装程序**astyle**，vim 会自动将其设置为格式化程序。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-21T00:22:01.743

正如 Darrin 所说，“逃离 vi 荒地”，转而拥抱一条真正的 vim 路径！您想要的语言偏好（假设它们不适合 SNOBOL 或 Simula）将感谢您！

**编辑：**实际上扩展语法突出显示以覆盖 SNOBOL 或 Simula 并不难！（-：

# java - GlassFish v3 Prelude - 管理问题

> ID：463543
> 
> 赞同：4
> 
> 时间：2009-01-20T23:30:34.357
> 
> 标签：java, jakarta-ee, glassfish

今天晚上我一直在玩 GlassFish v3 prelude。我不确定的几件事是安全性如何工作。

它像梦一样安装，所以我做的第一件事是删除匿名帐户并使用“mysecretpassword”设置一个“admin”帐户，并在管理领域为该用户指定 asadmin 组。

此时，**停止域**命令从控制台（和/或开始菜单快捷方式）停止工作。很公平，但是 stop-domain 命令接受一个 --user 参数，但随后需要提供一个我不知道它在哪里的 --passwordfile 路径。

经过一番谷歌搜索后，我偶然发现了**asaadmin login -p 4848**它在我的文档中创建了一个密码文件，然后停止域开始工作！

所以问题：

1）是否可以让停止域提示输入用户/密码？

2）拥有一个带有（散列）密码的文件的整个业务对我来说听起来并不好 - 他们为什么这样做，它是否可转让，是否可以禁用，如果可以，我该如何停止域？

3) 安全领域是如何工作的——它们是什么，它们有何不同？

4) GF v3 上最好的资源（书籍、网站等）是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T00:23:50.473

Glassfish 依赖于一个“主密码”文件，该文件用于控制对核心管理命令（尤其是 asadmin）的访问。

此主密码用于加密 GF 系统和配置中的各种位。默认情况下，它存储在文件 $domain-dir/master-password 中。

如果该文件存在，那么 asadmin 将不会提示输入密码来进行更改。如果它不存在，那么它会提示您。如果您更改了密码，系统将自动重新创建此文件。

请注意，这不是基于角色的东西，它只是整个系统的密码。

所以，这就是核心密码。

接下来是实际的管理员密码。

创建域时，它会要求您输入管理员名称和密码。此信息存储在 ~/.asadminpass 文件中。

因此，在本地安装的简单情况下，您可以在没有密码或用户信息的情况下使用 asadmin。

如果您删除该文件，系统将提示您输入用户名和密码。

管理员密码在应用服务器的“admin-realm”中进行管理。

领域是一种 Java EE 构造，用于表示身份验证和授权存储。

领域提供用户名、密码和角色信息。

默认情况下，GF 使用文件领域作为其安全信息。开箱即用，您有一个“admin-realm”，适用于管理控制台的用户。还有一个空的“文件”领域供应用程序使用。开箱即用，Glassfish 还支持 LDAP 领域和 JDBC 领域，其中凭据分别存储在 LDAP 和 RDBMS 中。

Glassfish 网站和论坛是目前可用的最佳资源。这段时间有点混乱，因为 v3 仍在开发中（v3 Prelude 就是这样，今年晚些时候最终版本的前奏），但与 v2 仍有很多重叠。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-08-11T09:18:56.283

* * *

GlassFish v3 Prelude 域启动失败

首先考虑停止在系统中运行的任何一个服务器-考试：-假设您使用 glassfish 服务器和 netbeansIDE 都在您的系统上工作，所以当您想要编译您的应用程序时，您可以停止您的 glassfish 服务器然后编译并运行您在 netbeans IDE 中的应用程序正在运行

# .net - 将 Backus–Naur 形式语法转换为 .Net 正则表达式

> ID：463557
> 
> 赞同：5
> 
> 时间：2009-01-20T23:35:31.353
> 
> 标签：.net, regex, bnf

有什么方法可以将以下 Backus-Naur 形式 (BNF) 语法转换为 .Net 正则表达式？（我并没有坚持 BNF，但我认为这可能是解释我正在尝试做的事情的最佳方式）。

```
<field> ::= "<<" <fieldname> <options> ">>"

<options> ::= "" | "(" <option> ")"

<option> ::= "" | 
             <option> <non-paren> | 
             <option> <escaped-character>

<escaped-character> ::= "\\" | "\)"

<non-paren> ::= any character but paren

<fieldname> ::= any string that doesn't contain "(" or ">>" 
```

我很接近，但我不知道如何处理转义`\`和`)`. 这将捕获命名组中的`fieldname`and ：`option`

```
<<(?<fieldname>.\*?)(\((?<option>.*?)\))?>> 
```

* * *

**编辑**

事实证明，我对 BNF 语法的理解比我想象的要生疏。

我试图得到的是括号是特殊字符。在“选项”部分中，它们必须用斜杠转义。（并且斜线也必须被转义）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-21T00:02:35.947

BNF 用于描述正则表达式通常无法描述的上下文无关语言。上下文无关语言和正则表达式的区别在于，上下文无关语言可以同时在双方进行递归。一个典型的例子是平衡括号问题。

```
paren = paren paren
      | '(' paren ')'  <-- there are characters on both sides of the recursion
      | '' 
```

在您的情况下，您不使用任何双面递归，因此它简化为常规语言。

```
fieldname = /(?:>?[^(>])+/    //No double >, but single ones are ok.
option = /(?:[^()\\]|\\.)*/   //No parens, unless preceeded by \

pattern = /<<(?<fieldname>   )(?:\((?<option>   )\))?>>/ 
```

把它放在一起：

```
pattern = /<<(?<fieldname>(?:>?[^(>])+)(?:\((?<option>(?:[^()\\]|\\.)*)\))?>>/ 
```

一些边境案例：

```
<<f>oo(bar>>)>> --> ('f>oo', 'bar>>')
<<foo(bar\))>>  --> ('foo', 'bar\)')
<<foo(bar\\)>>  --> ('foo', 'bar\\')
<<foo\(bar)>>   --> ('foo\', 'bar') 
```

* * *

**编辑：**

如果您希望必须在`<<`and中转义任何额外的括号字符（和反斜杠） `>>`，您可以执行以下操作：

```
fieldname = /(?:<?[^()\\<]|<?\\[()\\])+/
options = /(?:[^()\\]|\\[()\\])*/
pattern = /<<(?<fieldname>   )(?:\((?<option>   )\))?>>/

/<<(?<fieldname>(?:<?[^()\\]|<?\\[()\\])+)(?:\((?<option>(?:[^()\\]|\\[()\\])*)\))?>>/ 
```

更新：

```
<<f>oo(bar>>)>> --> ('f>oo', 'bar>>')
<<foo(bar\))>>  --> ('foo', 'bar\)')
<<foo(bar\\)>>  --> ('foo', 'bar\\')
<<foo\(bar)>>   --> doesn't match
<<foo\((bar)>>  --> ('foo\(', 'bar') 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T00:54:51.630

正则表达式表示正则语言。上下文无关文法生成上下文无关语言。前一种语言集是后者的子集，在一般情况下，您不能将上下文无关语言表示为正则表达式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T23:57:45.037

我一直在思考一个答案，有点希望有人能跳到我身上，这样我就可以停下来了。:)

BNF 的递归性质通常是一个很好的开放指标，如果你的问题很好地映射到 BNF，它就不能很好地映射到 RegExp。

我不得不承认，我什至不确定我是否能弄清楚你的 BNF。例如：x ::= << Boo (abc321) >>

建议您的“选项”对是 c3、b2 和 a1。这假设 char 是一个有效的“选项”——您没有为不是空字符串的选项定义任何有效的终端值。真的是这个意图吗？

假设你不想递归......处理转义和其他一切......你可能会更好地编写代码。这看起来比其他任何事情都更容易遍历字符串和处理。你想要什么的感觉表明你不需要任何前瞻或回顾逻辑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T00:12:52.573

我想我设法让它工作......

```
<<(?<fieldname>[^\(]+)(?<options>\((?<option>(\\\\|\\\)|[^\\\)])*)\))?>> 
```

我能想到的技巧是选项部分：

```
option =    (\\\\|\\\)||[^\\\)] 
```

转换为：双斜杠、斜杠括号或非斜杠括号字符。

然后将其包含 0 次或更多次，并将其放入名为“option”的组中：

```
((?<option>(\\\\|\\\)|[^\\\)])*) 
```

我还将字段名更改为一个或多个非开放括号：

```
fieldname =     [^\(]+ 
```

把这些放在一起，我想出了解决方案。

# c# - 用于 WCF RESTful 服务的 Java 和其他客户端

> ID：463562
> 
> 赞同：2
> 
> 时间：2009-01-20T23:37:13.003
> 
> 标签：c#, java, .net, wcf, rest

我想公开一些数据服务端点供内部应用程序使用，并且正在讨论 WCF REST 作为一种可能的解决方案。作为客户，我对其他语言/平台有哪些选择？请记住，我需要为 Java、Python 和 .Net 客户端提供服务。

本质上，我希望能够为多个客户端演示单点组织数据访问，并感觉 REST 工具包，尤其是 JSON 可以很好地工作。能够使用单个数据访问层处理多个客户端将是一件非常好的事情。

我觉得 WCF + REST 可能是服务器端解决此问题的最佳解决方案，但想展示其他语言对服务的作用。作为真正出售该选项以供组织内我的开发人员组之外使用的一个点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T00:04:57.050

WCF 服务的 SOAP、JSON、POX（普通旧 XML）共存端点将解决您的问题。

在“SOAP、JSON、POX（普通旧 XML）共存”上搜索关键字后查看第一个结果（我的博客）

它还包含一个示例项目。

# testing - 应该测试什么

> ID：463565
> 
> 赞同：1
> 
> 时间：2009-01-20T23:37:56.090
> 
> 标签：testing, rspec, cucumber, bdd

如果客户有要求 - 产品名称的长度不应超过 50 个字符，如果正在使用的框架已经具有经过良好测试的验证框架（例如 Rails），这是否表明应该为此编写故事/规范。

更一般地说，是否应该测试特定项目的每个验证区域的细节（即在上面的示例中 validates_length_of 将是该区域，50 个字符的长度将定义细节）？

这就引出了一个问题，即应该测试应用程序的哪些区域，以及如何区分这些区域？在这方面有最佳实践吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-20T23:52:34.860

阅读[实用的单元测试摘要卡](http://media.pragprog.com/titles/utj/StandaloneSummary.pdf)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-20T23:43:55.330

应该测试什么？好问题。在我看来，每个规范（在产品需求文档中）都应该进行测试。

每个需求都应该至少在积极（快乐的一天）场景和消极测试（当事情出错时）中进行测试。然后，您应该设计测试用例以包括边界条件（0 个字符、49、50、51、256、1000 个字符等）和明显的错误条件（包括非法字符）。

因此，每个需求都应该有许多测试用例来涵盖功能和错误检查。

# robots.txt - Googlebot 不尊重 Robots.txt

> ID：463569
> 
> 赞同：6
> 
> 时间：2009-01-20T23:40:18.473
> 
> 标签：robots.txt, googlebot

出于某种原因，当我查看 Google 网站管理员工具的“分析 robots.txt”以查看我们的 robots.txt 文件阻止了哪些网址时，这不是我所期望的。这是我们文件开头的片段：

```
Sitemap: http://[omitted]/sitemap_index.xml

User-agent: Mediapartners-Google
Disallow: /scripts

User-agent: *
Disallow: /scripts
# list of articles given by the Content group
Disallow: http://[omitted]/Living/books/book-review-not-stupid.aspx
Disallow: http://[omitted]/Living/books/book-review-running-through-roadblocks-inspirational-stories-of-twenty-courageous-athletic-warriors.aspx
Disallow: http://[omitted]/Living/sportsandrecreation/book-review-running-through-roadblocks-inspirational-stories-of-twenty-courageous-athletic-warriors.aspx 
```

对于 Googlebot 和 Mediapartners-Google，scripts 文件夹中的任何内容都会被正确阻止。我可以看到这两个机器人看到了正确的指令，因为 Googlebot 说脚本从第 7 行被阻止，而 Mediapartners-Google 从第 4 行被阻止。但是我从第二个用户下的不允许的 url 中输入的任何其他 url -agent 指令未被阻止！

我想知道我的评论或使用绝对网址是否把事情搞砸了......

任何见解都值得赞赏。谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-21T00:01:18.647

它们被忽略的原因是您在`robots.txt`文件中具有用于`Disallow`条目的完全限定 URL，而[规范](http://www.robotstxt.org/robotstxt.html)不允许它。（您应该只指定相对路径，或使用 / 指定绝对路径）。尝试以下操作：

```
Sitemap: /sitemap_index.xml

User-agent: Mediapartners-Google
Disallow: /scripts

User-agent: *
Disallow: /scripts
# list of articles given by the Content group
Disallow: /Living/books/book-review-not-stupid.aspx
Disallow: /Living/books/book-review-running-through-roadblocks-inspirational-stories-of-twenty-courageous-athletic-warriors.aspx
Disallow: /Living/sportsandrecreation/book-review-running-through-roadblocks-inspirational-stories-of-twenty-courageous-athletic-warriors.aspx 
```

至于缓存，谷歌平均每 24 小时尝试获取 robots.txt 文件的副本。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T00:01:04.420

这是绝对网址。robots.txt 应该只包含相对 URI；域是根据访问 robots.txt 的域推断出来的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-20T23:44:37.027

它已经存在至少一周了，谷歌说它最后一次下载是在 3 小时前，所以我确定它是最近的。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-20T23:42:47.453

您最近是否对 robots.txt 文件进行了此更改？根据我的经验，谷歌*似乎* 将这些东西缓存了很长时间。

# javascript - jQuery - 内联编辑表格行

> ID：463572
> 
> 赞同：14
> 
> 时间：2009-01-20T23:40:38.987
> 
> 标签：javascript, jquery, html-table, rows, inline-editing

我有一个包含任意列和行的表。这个事实无关紧要，但实际上，我要做的就是开发一个函数，它将一行（或多行）转换为一系列包含表中数据的文本输入（如果单元格中没有数据，则为空）。

我找不到任何明确这样做的人的例子，所以我想知道这里的人认为什么是找到解决方案的最佳方法。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-20T23:47:27.443

遍历行中的表格单元格，并用文本输入替换内容：

```
function editRow(row) {
    $('td',row).each(function() {
         $(this).html('<input type="text" value="' + $(this).html() + '" />');
    });
} 
```

您显然需要将相关的行/行传递给函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-08T20:19:33.523

使用[http://code.google.com/p/jquery-inline-editor/](http://code.google.com/p/jquery-inline-editor/)，它完全符合您的需要

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-28T14:14:24.800

就像伊兰说的。

但是，您也可以查看 contenteditable 和 designMode 等属性，尽管我不确定这些属性的支持程度。

将内容替换为文本输入后，您可以使用 jquery 插件[toggleEdit](http://staticvoid.info/toggleEdit)来管理在预览模式和编辑模式之间切换它们。

# sql-server - 本地主机上的链接服务器和 SQL Server 2005

> ID：463573
> 
> 赞同：1
> 
> 时间：2009-01-20T23:42:21.290
> 
> 标签：sql-server

是否可以在本地主机上使用自己的架构运行 SQL Server 2005，然后使用来自另一个远程服务器的数据？

这可以通过链接服务器实现吗？

我试图在 localhost 上设置一个适当的沙箱。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-20T23:46:21.533

链接的服务器应该适用于您正在尝试做的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T02:17:01.777

您是否希望连接到多个远程服务器以获取数据？

如果是，我认为链接服务器选项是一个不错的方法。我说好的，因为您可能会更好地在其中一台远程服务器上创建沙箱，然后从中创建链接服务器。在台式机/笔记本电脑上设置 SQL Server 似乎是一种浪费。但是，如果空间/权限是一个问题，您可能别无选择。

如果它只有一台服务器，为什么不在其上创建沙箱并使用 SQL Management Studio 连接并在其中工作。尽管在不安装完整 SQL 服务器的情况下设置管理工作室是一条奇怪的路径，但您可以做到。这样您就不必实际登录到远程服务器（由于多种原因，这是个坏主意）。

如果您确实设置了链接服务器，那么我遇到的一些障碍可能会有所帮助：

*   如果 SQL 服务器是实例化设置，则在写出时使用括号，例如 [SERVERNAME/INSTANCE]

*   从链接服务器中提取表或视图时使用别名，因为在命名约定中只能有 4 个部分，因此，[servername/instance].database.dbo.table.field 是 5 个部分并且会引发错误。

# database - 数据集更新过滤器位置

> ID：463583
> 
> 赞同：2
> 
> 时间：2009-01-20T23:44:56.137
> 
> 标签：database, delphi, delphi-7

这一直困扰着我，什么是执行以下操作的最佳方法......

使用简单的一对多数据库，当您在表单上有 2 个表/网格并且第二个被第一个过滤时。

放置过滤器代码的最佳位置在哪里，
即：

```
procedure TForm1.tblCustormersAfterScroll(DataSet: TDataSet);
begin
  if tblCustormersCustormerID.AsString <> '' then
   begin
     tblCustormersThings.Filter := 'CustormerID = ' + tblCustormersCustormerID.AsString;
     tblCustormersThings.Filtered := true;
   end;
end; 
```

AfterScroll 似乎大部分时间都在工作，但不会因某些事件而被解雇，例如发布后。通常我会有一个程序来更新过滤器并将它放在似乎需要的地方。

但我想知道是否有更好的方法，这似乎只是德尔福应该知道的东西......

我不认为这很重要，但我正在使用 Delphi7 和 NexusDB1

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T00:01:29.070

您应该在“多”端设置**MasterSource**和主字段属性。

它被称为 Master - Detail 关系，您应该查看 NexusDB 帮助以了解在表之间创建这种关系的方法。

如果您的表支持索引，那么您可以在**CustomerID**上创建索引并使用**SetRange()**方法。

您设置过滤器的方式是最慢的。

# perl - 如何使用 CPAN.pm 下载其他 Perl 模块？

> ID：463592
> 
> 赞同：4
> 
> 时间：2009-01-20T23:53:26.573
> 
> 标签：perl, cpan

我是面向对象编程的新手，CPAN.pm 上的 perldoc 页面让我很困惑。如果它们不存在，我的程序需要下载几个模块。这基本上只是：

```
CPAN::Shell->install("Module::Name::Here"); 
```

还是还有更多？那是下载软件包，解压缩并安装它，还是只是其中的一两个步骤？如果不是全部三个，我该怎么做另一个（或两个）？如果包已经存在，我希望它确保它不会尝试重新安装任何东西 - 这是函数的默认行为还是没有？

我如何判断 Perl 是否无法连接到 CPAN 来获取软件包？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-21T02:32:44.600

没有其他人提到它，但您必须先加载 CPAN 配置：

```
use CPAN;

CPAN::HandleConfig->load;
CPAN::Shell::setup_output;
CPAN::Index->reload;

# now do your stuff 
```

您还可以查看 CPAN.pm 附带的 cpan(1) 脚本，以了解许多正在运行的程序员界面。我还为最新一期的[The Perl Review](http://www.theperlreview.com)写了一篇文章，展示了 CPAN.pm 的程序员接口示例。

但是，您可能不需要执行任何这些操作。为什么您的程序会自行下载模块？您是否正在尝试创建具有依赖关系的发行版？有更好的方法来处理这个问题，因此您不必重复其他工具中已经完成的工作。例如，请参阅我的文章[Creating Perl Application Distributions](http://www.ddj.com/web-development/184415995)。你把你的程序当作一个模块来对待，并从所有很酷的模块工具中受益，这样你就不必重新发明一些东西。

如果您告诉我们更多有关您实际尝试解决的问题的信息，我们可能还会有其他好的答案。：） 祝你好运，

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-21T02:14:44.323

*CPAN.pm 上的 perldoc 页面把我搞糊涂了。*

是的，CPAN API 的文档仍然有点缺乏。它并不是真正为其他人编程使用而设计的。[如果您可以使用CPANPLUS](https://metacpan.org/module/CPANPLUS#API-REFERENCE)，您可能会有更好的运气。

*如果它们不存在，我的程序需要下载几个模块。这基本上只是：CPAN::Shell->install("Module::Name::Here");*

是的，这就是最简单的事情。事实上，当你输入“cpan Module::Name::Here”时，'cpan' 命令行程序所做的几乎都是如此。但是，您需要提前配置 CPAN.pm。

*那会下载软件包，解压缩并安装它吗？*

是的，三个都行。

*如果包已经存在，我希望它确保它不会尝试重新安装任何东西 - 这是函数的默认行为还是没有？*

是的，如果模块是最新的，默认行为是不安装任何东西。您实际上可以使用“uptodate()”方法检查自己，如下所示：

```
my $mod = CPAN::Shell->expand("Module", "Module::Name::Here");
$mod->install unless $mod->uptodate; 
```

*我如何判断 Perl 是否无法连接到 CPAN 来获取软件包？*

这很难以易于解释的方式以编程方式完成。您要么需要查看输出，要么只需检查 $mod->uptodate 之后；

```
my $mod = CPAN::Shell->expand("Module", "Module::Name::Here");
if ( ! $mod->uptodate ) {
    $mod->install;
    die "Problems installing" unless $mod->uptodate;
} 
```

祝你好运！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-20T23:58:25.033

基本上使用CPAN如下：

```
perl -MCPAN -e shell 
```

如果这是您第一次运行它，它会询问您几个问题并将结果保存在配置文件中。

然后安装 PGP::Sign 只需输入：

```
install PGP::Sign 
```

你已经准备好了。

至于你最后一个问题，别着急，它会告诉你能不能连接。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T00:04:50.623

我在过去（相对遥远的过去——比如 5 年前）尝试使用 CPAN 模块以编程方式做事，但没有取得太大成功，所以我停止了尝试。当然，这意味着从那时起事情可能已经发生了变化。但是，此处有关[CPAN](http://perldoc.perl.org/index-modules-C.html)的文档应该会有所帮助。看起来很有前途的[CPAN::API::HOWTO](http://perldoc.perl.org/CPAN/API/HOWTO.html)只有两个配方，它们都与您的问题无关。您还可以调查 CPANPLUS 是否更好——我以交互方式使用它的频率比使用 CPAN 的频率高得多。两者都是令人难以置信的模块。

因此，正如@Keltia 建议的那样，我以交互方式执行 CPAN (CPANPLUS)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T02:11:50.163

如您所知，我们大多数人仅在交互模式下使用 CPAN.pm，但是，您走在正确的轨道上。

我暂时可以指出的事情：

*   是的，调用 CPAN::Shell->install() 将下载、编译、测试和安装一个包。它也应该递归地对包具有的任何依赖项执行相同的操作。
*   默认行为是不安装任何已经安装的东西（除非有更新的版本可用）。
*   我不确定错误处理是如何工作的——我会调查一下，然后报告。
*   不过，它可能会提示您的用户。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-01-21T00:08:44.093

凯尔蒂亚说得对。我要补充一点，他的第一条指令是在命令提示符下完成的，通常是 root，但不一定如此。第二个命令是在 CPAN 提示符下完成的。您也可以在命令行上完成所有操作，但我通常不会。

如果您使用的是 Windows，最好的选择是使用 PPM，但它的存储库大多数时候都过时了，令人讨厌。

# unit-testing - 在 LARGE 项目上启动 UnitTesting

> ID：463593
> 
> 赞同：20
> 
> 时间：2009-01-20T23:54:39.317
> 
> 标签：unit-testing, refactoring, legacy-code

任何人都可以推荐一些关于如何解决开始对大型现有代码库进行单元测试的问题的最佳实践吗？我目前面临的问题包括：

*   庞大的代码库
*   零现有单元测试
*   类之间的高耦合
*   复杂的 OM（我在这里无能为力 - 这是一个复杂的业务领域）
*   缺乏编写 UnitTests/TDD 的经验
*   数据库依赖
*   外部源依赖项（Web 服务、WCF 服务、NetBIOS 等）

显然，我知道我应该从重构代码开始，以减少耦合，并提高可测试性。然而，如果没有 UnitTests（鸡和蛋，有人知道吗？），进行这样的重构是有风险的。

顺便说一句，您是否建议在域类或层类（日志记录、实用程序等）上开始重构和编写测试？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-21T07:15:08.787

首先，我赞同 Jeffrey Frederick 给出的“有效地使用遗留代码”的建议。

正如您在问题中所述，您无法更改代码，因为您目前没有可用于检测回归的单元测试，并且您无法添加单元测试，因为您的代码库不可单元测试。在这种情况下，您可以创建[**特性测试**](http://en.wikipedia.org/wiki/Characterization_Test)：端到端的自动测试，可以帮助您检测软件外部行为的变化。一旦这些到位，您就可以开始慢慢修改代码。

然而，测试你庞大的代码库是一项巨大的工作，风险很高，而且你可能会烧毁这样做的团队，因为他们必须在测试覆盖率方面付出巨大的努力，但回报却很低。对整个代码库进行测试是一项永无止境的工作。

相反，**从代码库中开发新的能力**，这样它就不会妨碍你。新代码经过全面测试后，将其集成到代码库中。

每次修复代码库中的问题时，也要尝试创建单元测试。第一次会很困难，但是一旦您准备好设置一些单元测试环境，它就会变得更容易。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-21T00:05:20.370

> 缺乏编写 UnitTests/TDD 的经验

我认为这是最重要的。

标准建议是首先开始为所有新代码编写单元测试，以便在尝试对现有代码进行单元测试之前学习如何进行单元测试。我认为这是理论上的好建议，但在实践中很难遵循，因为大多数新工作都是对现有系统的修改。

我认为你会得到一位“球员教练”的帮助，他可以与你的团队一起开展项目并在应用它们的过程中教授技能。

而且我认为我在法律上有义务告诉您获得 Michael Feather 的[《有效处理遗留代码》](https://rads.stackoverflow.com/amzn/click/com/0131177052)。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-21T07:24:03.670

书中有很好的建议[管理它！](http://www.pragprog.com/titles/jrpm/manage-it)通过约翰娜罗斯曼。

我还可以推荐以下内容：

1.  对新创建的源代码片段使用单元测试
2.  为错误创建单元测试
3.  为应用程序中风险最高的部分创建单元测试
4.  为应用程序中最有价值的部分创建单元测试。
5.  如果耦合度太高，请创建更多模块或集成测试**但自动化**的测试。

一个单一的单元测试将无济于事。但它需要开始。之后将在应用程序中风险最高的部分进行少量单元测试，这将有助于防止这些部分中的错误。当你达到这一点时，大多数开发人员会意识到单元测试是多么有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T07:59:16.467

你自己不会把这件事做好。需要很多说服力。所以我想给你这个线程，其中提供了大量信息和良好论证的提示：[你如何说服其他人编写单元测试？](https://stackoverflow.com/questions/416231/how-do-you-persuade-others-to-write-unit-tests)

只有整个团队才能创建如此庞大的单元测试。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T00:06:37.937

总的。我也不得不处理这个。我认为，最好的办法是大量依赖一开始可能不想使用的令人讨厌的工具（如 NUnitAsp），以测试现有代码。然后你可以开始重构，而这些工具可以防止你的代码库从你手下分崩离析。

然后，当你重构时，在你正在创建的新的、可测试的部分上编写更多的逻辑单元测试，并逐渐淘汰原始测试。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T08:21:21.540

祝你好运...由于您几乎没有编写单元测试的经验，我建议您首先尝试至少获得一些经验。否则，您很可能会放弃 TDD/单元测试，并且可能会在您尝试进行单元测试的系统中引入新的错误。获得经验的最好方法是找一个有经验的人来帮助你。

# c# - 在运行时轮询 C# 应用程序的内存使用情况？

> ID：463595
> 
> 赞同：19
> 
> 时间：2009-01-20T23:55:46.333
> 
> 标签：c#, runtime, memory-management

我有一个应用程序，在运行时需要轮询自己的内存使用情况。如果它可以列出每个实例化对象的内存使用情况，那将是理想的。我知道这可以通过 WMI 实现，但我希望有一些不依赖 WMI 的东西。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-21T00:28:16.783

您可能会发现有用的两个功能是：

```
 GC.GetTotalMemory();
  Process.PagedMemorySize64(); 
```

我的经验是 GC.GetTotalMemory() 不是非常可靠。它通常报告的内存使用量远小于实际内存使用量。我看到它报告说，当我的程序在 16 GB 的机器上用完内存时，我只使用了 8 GB。

我还没有测试过 Process.PagedMemorySize64，尽管它看起来很有希望。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-04-27T07:51:58.980

```
Process proc = Process.GetCurrentProcess();
Logger.Info(proc.PeakWorkingSet64/1024 + "kb"); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T00:00:09.947

您可以监听 perfmon 计数器，这将为您提供大量数据（GC 活动/物理内存使用/托管堆等。）

如果您需要更深入，您可能必须为自己附加一个调试器，这真的非常棘手，因为您必须生成一个新进程并与之通信，并遍历您的内存。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-21T00:04:17.130

您可以从 Process 类 System.Diagnostics 获得有关您的流程的一些粗略粒度。 [http://msdn.microsoft.com/en-us/library/system.diagnostics.process.aspx](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.aspx)。

没有任何“每个对象”的东西，但至少可以收集一些有关您的进程的内存信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-12-17T18:03:11.910

也许

```
Windows::System::Diagnostics::ProcessDiagnosticInfo::GetForCurrentProcess(); 
```

# xml - i:nil="true" 是什么意思？

> ID：463597
> 
> 赞同：64
> 
> 时间：2009-01-20T23:56:49.280
> 
> 标签：xml, null, xml-nil

我有一个 xml，它有带有 i:nil="true" 的节点。这意味着什么？

例如：

```
<FirstName i:nil="true" /> 
```

这是否意味着不同于：

```
<FirstName /> 
```

如果是这样，有什么区别？

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2009-01-21T00:00:53.687

这意味着 FirstName 为空

```
<FirstName i:nil="true" /> 
```

这意味着 FirstName = ""

```
<FirstName /> 
```

对 FirstName 所做的假设是字符串类型。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-21T11:55:50.670

也许`i:nil`实际上意味着`xsi:nil`，这意味着`FirstName`元素是空的，即没有**任何**内容——甚至没有`""`。它指的是`nillable`XML Schema 中的属性。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-21T00:00:34.687

nil 是一个属性，在`i`命名空间中定义。对于此 FirstName 节点，该属性的值为`true`。

与此类似，只是名称和值不同：

```
<form name="test">... 
```

这里，`form`是节点的名称，类似于`FirstName`您的代码，并且`name`是一个值为“test”的属性，类似于您`nil`的值为“true”的属性。

这意味着什么取决于读取 xml 文档的应用程序。

如果我冒昧地猜测一下，我会说这看起来像是定义某种模式的 xml 文档的一部分，并且 FirstName 字段可以有 NULL 或`nil`值，表示为空或未知。

# asp.net-mvc - 如何将多个模型分配给单个视图？

> ID：463602
> 
> 赞同：1
> 
> 时间：2009-01-20T23:57:53.180
> 
> 标签：asp.net-mvc

我有一个城市列表和一个国家列表，我想在视图 (aspx) 文件中包含这两个列表。我正在尝试这样的事情，但它不起作用：

命名空间 World.Controllers { public class WorldController : Controller { public ActionResult Index() {

```
 List<Country> countryList = new List<Country>();
        List<City> cityList = new List<City>();

        this.ViewData["CountryList"] = countryList;
        this.ViewData["CityList"] = cityList;

        this.ViewData["Title"] = "World Contest!";
        return this.View();
    }
} 
```

}

```
<table>
<% foreach (Country country in this.ViewData.Model as IEnumerable) { %>
    <tr>
        <td><%= country.Code %></td>
    </tr>
<% } %>
</table> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T00:25:17.197

您需要按名称获取已设置的视图数据。IE

```
<table>
<% foreach (Country country in (List<Country>)this.ViewData["CountryList"]) { %>
        <tr>
                <td><%= country.Code %></td>
        </tr>
<% } %>
</table> 
```

但这并不理想，因为它不是强类型的。我的建议是创建一个特定于您的视图的模型。

```
public class WorldModel
{
    public List<Country> Countries { get; set; }
    public List<City> Cities { get; set; }
} 
```

然后创建强类型为 WorldModel 视图的视图。然后在你的行动中：

```
List<Country> countryList = new List<Country>();
List<City> cityList = new List<City>();
WorldModel modelObj = new WorldModel();
modelObj.Cities = cityList;
modelObj.Countries = countryList;

this.ViewData["Title"] = "World Contest!";
return this.View(modelObj); 
```

只需确保您的视图是强类型的：

```
public partial class Index : ViewPage<WorldModel> 
```

你可以这样做：

```
<table>
<% foreach (Country country in ViewData.Model.Countries) { %>
        <tr>
                <td><%= country.Code %></td>
        </tr>
<% } %>
</table> 
```

# python - 如何在 Python 中对变量进行类型检查？

> ID：463604
> 
> 赞同：40
> 
> 时间：2009-01-20T23:58:45.330
> 
> 标签：python, typing, dynamic-typing

我有一个 Python 函数，它接受一个数字参数，该参数**必须**是一个整数才能正确运行。在 Python 中验证这一点的首选方法是什么？

我的第一反应是做这样的事情：

```
def isInteger(n):
    return int(n) == n 
```

但我不禁认为这是 1) 昂贵 2) 丑陋和 3) 受制于机器 epsilon 的温柔怜悯。

Python 是否提供任何类型检查变量的本机方法？或者这是否被认为违反了语言的动态类型设计？

编辑：因为很多人都问过 - 有问题的应用程序使用 IPv4 前缀，从平面文本文件中获取数据。如果任何输入被解析为浮点数，则该记录应被视为格式错误并被忽略。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-01-21T00:06:11.430

```
isinstance(n, int) 
```

如果您需要知道它是否绝对是实际的 int 而不是 int 的子类（通常您不需要这样做）：

```
type(n) is int 
```

这：

```
return int(n) == n 
```

这不是一个好主意，因为交叉类型比较可能是真的 - 特别是`int(3.0)==3.0`

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-01-21T02:50:17.217

是的，正如埃文所说，不要输入检查。只需尝试使用该值：

```
def myintfunction(value):
   """ Please pass an integer """
   return 2 + value 
```

那没有类型检查。好多了！让我们看看当我尝试它时会发生什么：

```
>>> myintfunction(5)
7 
```

这行得通，因为它是一个整数。嗯。让我们尝试一些文本。

```
>>> myintfunction('text')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<stdin>", line 3, in myintfunction
TypeError: unsupported operand type(s) for +: 'int' and 'str' 
```

它显示了一个错误，TypeError，无论如何它都应该这样做。如果来电者想抓住它，这是可能的。

如果你进行类型检查，你会怎么做？显示错误对吗？因此，您不必进行类型检查，因为错误已经自动显示。

另外，由于您没有进行类型检查，因此您的函数可以与其他类型一起使用：

浮动：

```
>>> print myintfunction(2.2)
4.2 
```

复数：

```
>>> print myintfunction(5j)
(2+5j) 
```

小数点：

```
>>> import decimal
>>> myintfunction(decimal.Decimal('15'))
Decimal("17") 
```

甚至可以添加数字的完全任意对象！

```
>>> class MyAdderClass(object):
...     def __radd__(self, value):
...             print 'got some value: ', value
...             return 25
... 
>>> m = MyAdderClass()
>>> print myintfunction(m)
got some value:  2
25 
```

所以你显然通过类型检查一无所获。并且损失很多。

* * *

# 更新：

由于您已经编辑了问题，现在很明显您的应用程序调用了一些仅对 int 有意义的上游例程。

既然如此，我仍然认为您应该将**收到**的参数传递给上游函数。上游函数将正确处理它，例如，如果需要，会引发错误。我非常**怀疑，**如果你传递一个浮点数，你处理 IP 的函数会表现得很奇怪。如果您可以给我们图书馆的名称，我们可以为您检查。

但是......如果上游函数会表现不正确并在你传递一个浮点数时杀死一些孩子（我仍然非常怀疑它），那么只需调用`int()`它：

```
def myintfunction(value):
   """ Please pass an integer """
   return upstreamfunction(int(value)) 
```

您仍然没有进行类型检查，因此您获得了不进行类型检查的最大好处。

* * *

如果即使在这之后，您真的想进行类型检查，尽管它会降低您的应用程序的可读性和性能而绝对没有任何好处，请使用 an`assert`来执行此操作。

```
assert isinstance(...)
assert type() is xxxx 
```

这样我们就可以关闭s 并通过调用它来从程序`assert`中删除这个`<sarcasm>`*特性*`</sarcasm>`

```
python -OO program.py 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2016-06-29T07:00:10.663

Python 现在支持通过[typing 模块](https://docs.python.org/3/library/typing.html)和[mypy](http://mypy-lang.org/)[逐步键入](https://en.wikipedia.org/wiki/Gradual_typing)。该模块是 Python 3.5 的 stdlib 的一部分，如果您需要 Python 2 或以前版本的 Python 3 的反向移植，可以[从 PyPi](https://pypi.python.org/pypi/typing)下载该模块。您可以通过从命令行运行来安装。`typing``mypy``pip install mypy`

简而言之，如果您想验证某个函数是否接收 int、float 并返回一个字符串，您可以像这样注释您的函数：

```
def foo(param1: int, param2: float) -> str:
    return "testing {0} {1}".format(param1, param2) 
```

如果您的文件名为`test.py`，则可以在安装 mypy 后通过`mypy test.py`从命令行运行进行类型检查。

如果您使用的是不支持函数注释的旧版 Python，则可以使用类型注释来实现相同的效果：

```
def foo(param1, param2):
    # type: (int, float) -> str
    return "testing {0} {1}".format(param1, param2) 
```

`mypy test.py`您对 Python 3 文件和`mypy --py2 test.py`Python 2 文件使用相同的命令。

Python 解释器在运行时会完全忽略类型注释，因此它们会产生最小甚至没有开销——通常的工作流程是处理您的代码并定期运行 mypy 以捕获错误和错误。某些 IDE（例如 PyCharm）会理解类型提示，并可以在您直接编辑时提醒您代码中的问题和类型不匹配。

如果出于某种原因，您需要在运行时检查类型（也许您需要验证大量输入？），您应该遵循其他答案中列出的建议——例如 use `isinstance`、`issubclass`等。还有一些库，例如[强制](https://github.com/RussBaz/enforce)在运行时尝试执行类型检查（尊重您的类型注释），尽管我不确定它们在撰写本文时的生产准备情况。

有关更多信息和详细信息，请参阅[mypy 网站](http://mypy-lang.org/)、[mypy 常见问题解答](http://mypy.readthedocs.io/en/latest/faq.html)和[PEP 484](https://www.python.org/dev/peps/pep-0484/)。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-21T00:08:19.383

```
if type(n) is int 
```

这会检查是否`n`是 Python int，并且*只是*一个 int。它不接受`int`.

然而，类型检查不适合“Python 方式”。您最好将`n`其用作 int，如果它引发异常，则捕获它并对其采取行动。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T01:32:11.350

不要键入检查。鸭子打字的全部意义在于你不应该这样做。例如，如果有人做了这样的事情怎么办：

```
class MyInt(int):
    # ... extra stuff ... 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-25T16:34:53.117

使用 Python 进行编程并像使用其他语言一样执行类型检查确实就像选择螺丝刀来敲钉子一样。使用 Python 的异常处理功能更加优雅。

从交互式命令行中，您可以运行如下语句：

```
int('sometext') 
```

这将产生一个错误 - ipython 告诉我：

```
<type 'exceptions.ValueError'>: invalid literal for int() with base 10: 'sometext' 
```

现在您可以编写一些代码，例如：

```
try:
   int(myvar) + 50
except ValueError:
   print "Not a number" 
```

可以对其进行定制以执行所需的任何操作并捕获预期的任何错误。它看起来有点复杂，但符合 Python 的语法和习惯用法，并且代码可读性很强（一旦你习惯了说 Python）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-24T11:14:35.247

我很想这样做：

```
def check_and_convert(x):
    x = int(x)
    assert 0 <= x <= 255, "must be between 0 and 255 (inclusive)"
    return x

class IPv4(object):
    """IPv4 CIDR prefixes is A.B.C.D/E where A-D are 
       integers in the range 0-255, and E is an int 
       in the range 0-32."""

    def __init__(self, a, b, c, d, e=0):
        self.a = check_and_convert(a)
        self.b = check_and_convert(a)
        self.c = check_and_convert(a)
        self.d = check_and_convert(a)
        assert 0 <= x <= 32, "must be between 0 and 32 (inclusive)"
        self.e = int(e) 
```

这样，当你使用它时，任何东西都可以传入，但你只存储一个有效的整数。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-11-24T11:53:15.307

怎么样：

```
def ip(string):
    subs = string.split('.')
    if len(subs) != 4:
        raise ValueError("incorrect input")
    out = tuple(int(v) for v in subs if 0 <= int(v) <= 255)
    if len(out) != 4:
        raise ValueError("incorrect input")
    return out 
```

当然有标准的 isinstance(3, int) 函数......

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2020-05-24T13:48:02.243

对于那些希望使用 assert() 函数执行此操作的人。以下是如何在代码中有效地进行变量类型检查，而无需定义任何额外的函数。如果出现 assert() 错误，这将阻止您的代码运行。

```
assert(type(X) == int(0)) 
```

如果没有引发错误，代码将继续工作。除此之外，`unittest`模块对于这类事情来说是一个非常有用的工具。

# ms-access - MS-Access 添加其他链接表

> ID：463607
> 
> 赞同：2
> 
> 时间：2009-01-20T23:59:41.523
> 
> 标签：ms-access, sql-server-migration-assi, linked-tables

我有一个 MS-Access 数据库，它使用“Microsoft SQL Server Migration Assistant 2008 for Access”（又名 SSMA）转换为使用 SQL 表并创建了链接表（因此 MS-Access 界面仍然有效，但链接到 SQL 表） .

修改这些表没有问题（在 SQL 中修改，使用 MS-Access 中的链接表管理器，更新表）。但是我没有在 SQL 中添加新表，也找不到将该表添加到链接表集中的方法。

我已经尝试过外部数据 - > ODBC 数据库，但它希望我制作一个 FileDSN，并且由于 SSMA 工具不需要我不想让某些表以一种方式链接而其他文件喜欢另一种方式（确实有人知道 SSMA 如何链接表格吗？）。

所以我的基本问题是：在不使用 DSN 的情况下，如何将额外的 SQL Server 表作为链接表添加到 MS-Access？

# java - 作为 Java 开发人员，C 还是 C++？

> ID：463618
> 
> 赞同：10
> 
> 时间：2009-01-21T00:02:05.010
> 
> 标签：java, c++, c, java-native-interface

在过去的 5 年里，我一直在专业地编写 Java。最近，我不得不深入研究 JNI 来调用一些特定于 Windows 的函数。

这段经历凸显了我对 C（或 C++）语言的糟糕掌握。我对 C 的唯一介绍是我 11 年前在高中读过的一本简短的“傻瓜”书。

我知道这两种语言在那个时间框架内都有进步，尤其是 C++ 和标准库。

我适合学习 C 或 C++ 吗？哪些书最好？

人们对 Windows 编程也有任何建议吗？我可以很好地阅读 MSDN 以找出某些 API 调用，但我感觉我错过了关于“大局”的东西。

谢谢

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-01-21T00:31:32.580

好问题。从表面上看，推荐 C++ 是显而易见的，因为“它像 Java 一样面向对象”。唯一的问题是，这不是真的。C++ 允许 OOP，是的，但它只是 C++ 支持的几种范式之一。将 C++ 视为 OOP 语言（尤其是将其视为 Java）只会导致挫败感。

问题是 Java 和 C++ 实际上并没有太多共同点。Java 程序员通常认为 Java 是受 C++ 启发的，但只有当 C++ 指的是 C++ 的最早版本时才成立，这可能更恰当地称为“C with classes”。从那时起，C++ 完全转变为自己的语言，拥有自己的做事方式。从那时起，它的变化可能远远超过 Java。那时的 Java 程序员仍然能够理解今天的 Java 代码。对于 C++ 而言并非如此。所以我认为 C 实际上比“现代 C++”更接近 Java。如果您使用 Java 并剥离 GC 和类的概念以及其他一些抽象，那么您将得到 C。要到达 C++，

 *此外，C++ 是一种非常复杂的语言，学习它需要很长时间。如果你学得不好，你会一次又一次地在自己的脚上开枪。

最后，这取决于您的目标。C++ 是一种比 C 更现代的语言，一旦你学会了它，它就非常具有表现力和强大的功能，而且令人惊讶的是，它甚至可以非常优雅和简洁。但是学习曲线很糟糕。因此，从长远来看，对于本机编程，我会推荐 C++ 而不是 C。

但是，如果您的目标主要是与 Win32 API（或其他本机 API）进行交互，则不需要 C++。Win32 和大多数其他 API 是用 C 而不是 C++ 编写的，无论如何您很可能不需要非常复杂的代码来在它和 Java 之间进行接口。

关于学习Win32，你是对的，你需要的所有细节都在MSDN上。如果你想要大局观，[Petzold](http://www.charlespetzold.com/pw5/)就是关于这个主题*的*书。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-21T00:15:33.363

我想这取决于你的目标。

如果你想更接近机器，那么 C.

如果您想补充您对 C 之上的类 OO Java 层的了解，那么 C++。

Accelerated C++ ( [sanitized Amazon link](https://rads.stackoverflow.com/amzn/click/com/020170353X) ) 是一本很棒的书，可以从 C++ 的角度学习 C++，而不仅仅是附加其他位的 C，

而且 K'n'R C（经过[消毒的亚马逊链接](https://rads.stackoverflow.com/amzn/click/com/0131103628)）仍然是学习 C 恕我直言的方法！

BTW For C++ 跟随 Scott Meyers 在 Effective C++ 书籍中的智慧！还有他的 Effective STL 书。

高温高压

干杯，

抢

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-21T00:52:39.090

学习足够多的 C++ 以将其用作“更好的 C”。您不必尝试将所有这些都映射到您对 Java 的理解上。您所需要的只是能够将 C++ 对象用作抽象数据类型、new 和 delete 等。如果 STL 顺其自然，那就更好了。

真正的问题是：为什么您认为 JNI 是绝对必要的？Windows 调用将破坏保持应用程序可移植性的任何想法。我坐在一个必须深入研究使用 JNI 的 Java 应用程序的人旁边。它会随机关闭带有 SEG FAULT 的服务器。他的假设是堆填满，对调用 malloc 的例程进行 JNI 调用以在堆上分配空间。它不可用，例程不检查返回的指针是否为空，将其释放，然后服务器关闭。他仍在尝试在本地重现错误，因为在 GC 启动之前调用 JJNI 方法需要精确的时间。

100% 确定他们是必需的？只是问问而已....

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-21T00:15:19.447

如果您对Java有很好的了解，我建议您从C开始，如果您直接从C++开始，它与Java之间存在很多差异，您可能会不喜欢它。

如果您认真学习这两种语言，我会推荐 Bjarne Stroustrup 的“The C++ Programming Language”和 Dennis Ritchie 的“The C Programming Language”。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-21T00:08:19.663

我认为**C++ 比 C 更容易让您精通**。

如果您一直在使用 Java，那么您将很难摆脱类、异常、引用形式、动态绑定等便利，当然还有体面的库。

但是，**您应该首先学习 C**以确保您真正了解引擎盖下的内容，并体验指针及其使用以及“没有防护装备”工作的感觉。

一旦掌握了这一点，就可以了解 C++ 中的继承机制以及它与 Java 的不同之处（例如，多重继承）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-21T00:14:28.077

这真的取决于你的长处和短处。如果你真的喜欢设计模式，那么我建议使用 C++，但如果你只需要在 JNI 中实现几个简单的方法，那么我会推荐 C。在 C++ 之前学习 C 应该可以让你更好地理解内存管理，而无需担心 C++ 的一些复杂性（构造函数调用顺序、析构函数以及 C++ 和 Java 之间的其他差异）。

我建议 Kernighan 和 Ritchie 的“The C Programming Language”作为学习 C 的权威手册。[http://www.amazon.com/Programming-Language-Dennis-M-Richie/dp/0876925964](https://rads.stackoverflow.com/amzn/click/com/0876925964)

如果您使用的是 *nix 系统，则手册页中有大量文档可用于不同的功能。例如，

> bash$ 人 malloc

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-21T01:08:49.947

如果你想要一个优秀的 C 资源，Dennis Ritchie 的“The C Programming Language”是一本好书。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-21T00:58:29.500

如果您打算继续编写 JNI 代码，那么我肯定会推荐 C++。

特别是，JNI 接口要求您获取（并随后释放）对 Java 对象的引用。使用 C++ 自动变量，您可以使用“RAII”（资源分配即初始化）技术获取这些引用，这使得内存管理更加简单。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-21T01:00:10.603

> 100% 确定他们是必需的？只是问问而已....

不幸的是，是的。

谢谢大家的回答。

为了回答一些后续问题，我不是在寻找 C 或 C++ 的职业转变。我只想学习基础知识，这样当我确实需要写点点滴滴时，我不会觉得自己在盲目飞行。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-21T01:06:57.347

> 特别是，JNI 接口要求您获取（并随后释放）对 Java 对象的引用。使用 C++ 自动变量，您可以使用“RAII”（资源分配即初始化）技术获取这些引用，这使得内存管理更加简单。

谢谢，这很有帮助。引起我越来越多关注的领域之一是手动管理与 JNI 对象相关的内存

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-21T01:48:22.753

如果您在这里的“主要目标”是进行 Windows 编程，我会推荐 C# 而不是 C 或 C++。但是我相信地球上和低轨道上的每个程序员都应该知道 C。不知道 C++ 是可以接受的，尽管你可能不会被邀请参加一些聚会:) 但是 C 是一种仪式，在应用程序之间（高-级）程序员和库（低级）程序员。

# sql - 性能调优 SQL - 如何？

> ID：463639
> 
> 赞同：9
> 
> 时间：2009-01-21T00:08:52.160
> 
> 标签：sql, performance

**一种性能如何调整 SQL 查询？**

*   可以使用哪些技巧/工具/概念来改变 SQL 查询的性能？
*   如何量化收益？
*   需要注意什么？

**可以使用哪些技巧/工具/概念来改变 SQL 查询的性能？**

*   使用索引？它们在实践中是如何工作的？
*   规范化与非规范化数据？性能与设计/维护的权衡是什么？
*   预处理中间表？使用触发器或批处理作业创建？
*   重组查询以使用临时表、子查询等？
*   将复杂查询分成多个并合并结果？
*   还要别的吗？

**如何量化绩效？**

*   阅读？
*   CPU时间？
*   不同版本一起运行时的“% Query Cost”？
*   还要别的吗？

**需要注意什么？**

*   是时候制定执行计划了吗？（存储过程与内联查询）
*   存储过程被迫重新编译
*   对小数据集进行测试（查询是线性扩展还是平方定律等？）
*   先前运行的结果被缓存
*   优化“正常情况”，但损害“最坏情况”
*   什么是“参数嗅探”？
*   还要别的吗？

*版主注意：* 这是一个很大的问题，我应该把它分成多个问题吗？

*回复者注意：* 因为这是一个巨大的问题，请参考其他问题/答案/文章，而不是写冗长的解释。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-21T00:12:00.967

我真的很喜欢《Professional SQL Server 2005 Performance Tuning》这本书来回答这个问题。这是 Wiley/Wrox，不，我不是作家，呵呵。但它解释了你在这里要求的很多东西，以及硬件问题。

但是，是的，这个问题的方式，远远超出了可以在像这样的评论框中回答的范围。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-21T00:15:52.177

编写 sargable 查询是需要做的事情之一，如果您不编写 sargable 查询，那么优化器将无法利用索引。这是一个示例，[只有在数据库中，您才能通过更改几行代码来获得 1000% + 改进，](http://blogs.lessthandot.com/index.php/DataMgmt/DataDesign/only-in-a-database-can-you-get-1000-impr)此查询从超过 24 小时缩短到 36 秒

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T00:26:18.300

当然你也需要知道这3个join的区别

循环连接、哈希连接、合并连接

见这里：http: [//msdn.microsoft.com/en-us/library/ms173815.aspx](http://msdn.microsoft.com/en-us/library/ms173815.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-08-12T19:44:56.023

这里需要遵循一些基本步骤：

1.  首先定义业务需求
2.  `SELECT`字段而不是使用`SELECT *`
3.  避免`SELECT DISTINCT`
4.  `INNER JOIN`使用(not `WHERE`)创建连接
5.  使用`WHERE`而不是`HAVING`定义过滤器
6.  正确的索引

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-03-04T08:06:13.133

以下是我们可以遵循的一些基本步骤来提高性能：

1.  如果仍然需要时间索引查询中存在的列，请检查 pk 和 fk 中涉及的表的索引。
2.  每次操作后都会修改所有索引，因此请不要索引每一列
3.  在批量插入之前删除索引，然后重新创建索引。
4.  谨慎选择
5.  使用 if exists 而不是 count
6.  在指责 dba 之前先检查网络连接

# c# - 将秒转换为（小时：分钟：秒：毫秒）时间的最佳方法是什么？

> ID：463642
> 
> 赞同：333
> 
> 时间：2009-01-21T00:10:42.950
> 
> 标签：c#, datetime

将秒转换为（小时：分钟：秒：毫秒）时间的最佳方法是什么？

假设我有 80 秒，.NET 中是否有任何专门的类/技术可以让我将这 80 秒转换为 (00h:00m:00s:00ms) 格式，例如 DateTime 或其他格式？

* * *

## 回答 #1

> 赞同：642
> 
> 时间：2009-01-21T00:19:40.390

对于**.Net <= 4.0**使用 TimeSpan 类。

```
TimeSpan t = TimeSpan.FromSeconds( secs );

string answer = string.Format("{0:D2}h:{1:D2}m:{2:D2}s:{3:D3}ms", 
                t.Hours, 
                t.Minutes, 
                t.Seconds, 
                t.Milliseconds); 
```

（如 Inder Kumar Rathore 所述）对于**.NET > 4.0**，您可以使用

```
TimeSpan time = TimeSpan.FromSeconds(seconds);

//here backslash is must to tell that colon is
//not the part of format, it just a character that we want in output
string str = time .ToString(@"hh\:mm\:ss\:fff"); 
```

（来自 Nick Molyneux）确保秒数小于`TimeSpan.MaxValue.TotalSeconds`以避免异常。

* * *

## 回答 #2

> 赞同：81
> 
> 时间：2013-07-23T05:53:03.093

对于**.NET > 4.0**，您可以使用

```
TimeSpan time = TimeSpan.FromSeconds(seconds);

//here backslash is must to tell that colon is
//not the part of format, it just a character that we want in output
string str = time .ToString(@"hh\:mm\:ss\:fff"); 
```

或者如果你想要日期时间格式，那么你也可以这样做

```
TimeSpan time = TimeSpan.FromSeconds(seconds);
DateTime dateTime = DateTime.Today.Add(time);
string displayTime = dateTime.ToString("hh:mm:tt"); 
```

有关更多信息，您可以查看[自定义时间跨度格式字符串](http://msdn.microsoft.com/en-us/library/ee372287.aspx)

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-01-21T00:20:06.987

如果你知道你有几秒钟，你可以通过调用 TimeSpan.FromSeconds 创建一个 TimeSpan 值：

```
 TimeSpan ts = TimeSpan.FromSeconds(80); 
```

然后，您可以获得天数、小时数、分钟数或秒数。或者使用 ToString 重载之一以您喜欢的任何方式输出它。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2017-01-23T05:04:38.957

我做了一些基准测试，看看什么是最快的方法，这些是我的结果和结论。我将每种方法运行了 1000 万次，并添加了一条带有每次运行平均时间的注释。

如果您的输入毫秒数**不限于一天**（您的结果可能是 143:59:59.999），这些是选项，从快到慢：

```
// 0.86 ms
static string Method1(int millisecs)
{
    int hours = millisecs / 3600000;
    int mins = (millisecs % 3600000) / 60000;
    // Make sure you use the appropriate decimal separator
    return string.Format("{0:D2}:{1:D2}:{2:D2}.{3:D3}", hours, mins, millisecs % 60000 / 1000, millisecs % 1000);
}

// 0.89 ms
static string Method2(int millisecs)
{
    double s = millisecs % 60000 / 1000.0;
    millisecs /= 60000;
    int mins = millisecs % 60;
    int hours = millisecs / 60;
    return string.Format("{0:D2}:{1:D2}:{2:00.000}", hours, mins, s);
}

// 0.95 ms
static string Method3(int millisecs)
{
    TimeSpan t = TimeSpan.FromMilliseconds(millisecs);
    // Make sure you use the appropriate decimal separator
    return string.Format("{0:D2}:{1:D2}:{2:D2}.{3:D3}",
        (int)t.TotalHours,
        t.Minutes,
        t.Seconds,
        t.Milliseconds);
} 
```

如果您的输入毫秒数**限制为一天**（您的结果将永远不会大于 23:59:59.999），这些是选项，从快到慢：

```
// 0.58 ms
static string Method5(int millisecs)
{
    // Fastest way to create a DateTime at midnight
    // Make sure you use the appropriate decimal separator
    return DateTime.FromBinary(599266080000000000).AddMilliseconds(millisecs).ToString("HH:mm:ss.fff");
}

// 0.59 ms
static string Method4(int millisecs)
{
    // Make sure you use the appropriate decimal separator
    return TimeSpan.FromMilliseconds(millisecs).ToString(@"hh\:mm\:ss\.fff");
}

// 0.93 ms
static string Method6(int millisecs)
{
    TimeSpan t = TimeSpan.FromMilliseconds(millisecs);
    // Make sure you use the appropriate decimal separator
    return string.Format("{0:D2}:{1:D2}:{2:D2}.{3:D3}",
        t.Hours,
        t.Minutes,
        t.Seconds,
        t.Milliseconds);
} 
```

如果您的输入**只是 seconds**，这些方法会稍微快一些。同样，如果您输入的秒数**不限于一天**（您的结果可能是 143:59:59）：

```
// 0.63 ms
static string Method1(int secs)
{
    int hours = secs / 3600;
    int mins = (secs % 3600) / 60;
    secs = secs % 60;
    return string.Format("{0:D2}:{1:D2}:{2:D2}", hours, mins, secs);
}

// 0.64 ms
static string Method2(int secs)
{
    int s = secs % 60;
    secs /= 60;
    int mins = secs % 60;
    int hours = secs / 60;
    return string.Format("{0:D2}:{1:D2}:{2:D2}", hours, mins, s);
}

// 0.70 ms
static string Method3(int secs)
{
    TimeSpan t = TimeSpan.FromSeconds(secs);
    return string.Format("{0:D2}:{1:D2}:{2:D2}",
        (int)t.TotalHours,
        t.Minutes,
        t.Seconds);
} 
```

如果您的输入秒数**限制为一天**（您的结果永远不会大于 23:59:59）：

```
// 0.33 ms
static string Method5(int secs)
{
    // Fastest way to create a DateTime at midnight
    return DateTime.FromBinary(599266080000000000).AddSeconds(secs).ToString("HH:mm:ss");
}

// 0.34 ms
static string Method4(int secs)
{
    return TimeSpan.FromSeconds(secs).ToString(@"hh\:mm\:ss");
}

// 0.70 ms
static string Method6(int secs)
{
    TimeSpan t = TimeSpan.FromSeconds(secs);
    return string.Format("{0:D2}:{1:D2}:{2:D2}",
        t.Hours,
        t.Minutes,
        t.Seconds);
} 
```

作为最后的评论，让我补充一点，我注意到`string.Format`如果你使用`D2`而不是`00`.

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-01-21T00:21:18.873

```
TimeSpan.FromSeconds(80); 
```

[http://msdn.microsoft.com/en-us/library/system.timespan.fromseconds.aspx](http://msdn.microsoft.com/en-us/library/system.timespan.fromseconds.aspx)

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-01-21T00:24:07.777

TimeSpan 构造函数允许您以秒为单位传递。只需声明一个 TimeSpan 秒数类型的变量。前任：

```
TimeSpan span = new TimeSpan(0, 0, 500);
span.ToString(); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-21T00:22:15.643

在 VB.NET 中，但在 C# 中是一样的：

```
Dim x As New TimeSpan(0, 0, 80)
debug.print(x.ToString())
' Will print 00:01:20 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-21T00:24:38.303

我建议您为此使用该`TimeSpan`课程。

```
public static void Main(string[] args)
{
    TimeSpan t = TimeSpan.FromSeconds(80);
    Console.WriteLine(t.ToString());

    t = TimeSpan.FromSeconds(868693412);
    Console.WriteLine(t.ToString());
} 
```

输出：

```
00:01:20
10054.07:43:32 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2018-01-24T19:10:22.193

对于**.NET < 4.0**（例如：**Unity**），您可以编写扩展方法以具有`TimeSpan.ToString(string format)`类似**.NET > 4.0的行为**

```
public static class TimeSpanExtensions
{
    public static string ToString(this TimeSpan time, string format)
    {
        DateTime dateTime = DateTime.Today.Add(time);
        return dateTime.ToString(format);
    }
} 
```

您可以从代码中的任何位置使用它，例如：

```
var time = TimeSpan.FromSeconds(timeElapsed);

string formattedDate = time.ToString("hh:mm:ss:fff"); 
```

这样，您可以`TimeSpan`通过简单地从代码的任何位置调用 ToString 来格式化任何对象。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-12-07T15:59:01.017

如果我们有 DateTime.AddSeconds() ，为什么人们需要 TimeSpan**和DateTime？**

```
var dt = new DateTime(2015, 1, 1).AddSeconds(totalSeconds); 
```

日期是任意的。totalSeconds 可以大于 59 并且是双精度数。然后你可以使用 DateTime.ToString() 来格式化你的时间：

```
dt.ToString("H:mm:ss"); 
```

如果 totalSeconds < 0 或 > 59，这不起作用：

```
new DateTime(2015, 1, 1, 0, 0, totalSeconds) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-09-03T07:29:22.543

获得总秒数

```
var i = TimeSpan.FromTicks(startDate.Ticks).TotalSeconds; 
```

并从秒中获取日期时间

```
var thatDateTime = new DateTime().AddSeconds(i) 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-01-16T20:57:11.547

这将以 hh:mm:ss 格式返回

```
 public static string ConvertTime(long secs)
    {
        TimeSpan ts = TimeSpan.FromSeconds(secs);
        string displayTime = $"{ts.Hours}:{ts.Minutes}:{ts.Seconds}";
        return displayTime;
    } 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2015-08-31T03:30:47.833

```
private string ConvertTime(double miliSeconds)
{
    var timeSpan = TimeSpan.FromMilliseconds(totalMiliSeconds);
    // Converts the total miliseconds to the human readable time format
    return timeSpan.ToString(@"hh\:mm\:ss\:fff");
} 
```

//测试

```
 [TestCase(1002, "00:00:01:002")]
    [TestCase(700011, "00:11:40:011")]
    [TestCase(113879834, "07:37:59:834")]
    public void ConvertTime_ResturnsCorrectString(double totalMiliSeconds, string expectedMessage)
    {
        // Arrange
        var obj = new Class();;

        // Act
        var resultMessage = obj.ConvertTime(totalMiliSeconds);

        // Assert
        Assert.AreEqual(expectedMessage, resultMessage);
    } 
```

# python - Python - 从子文件夹进行绝对导入

> ID：463643
> 
> 赞同：13
> 
> 时间：2009-01-21T00:10:47.427
> 
> 标签：python, python-import

基本上我和这个人问了同样的问题：[如何在 Python 中进行相对导入？](https://stackoverflow.com/questions/72852/how-to-do-relative-imports-in-python)

但是没有人给他一个正确的答案。鉴于您在一个子文件夹中，并且您想进入一个目录，然后进入另一个子文件夹，按照他们的建议做是行不通的（正如 OP 在他对他们的回答的评论中指出的那样）。

我知道您可以使用 sys.path 来做到这一点，但我更喜欢更简洁的方法。

例子：

```
App
__init__.py
Package_A
--__init__.py
--Module_A.py
Package_B
--__init__.py
--Module_B.py 
```

如何将 Module_A 导入 Module_B？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-21T02:15:30.967

```
main.py
setup.py
app/ ->
    __init__.py
    package_a/ ->
       __init__.py
       module_a.py
    package_b/ ->
       __init__.py
       module_b.py 
```

1.  你跑`python main.py`。
2.  `main.py`做：`import app.package_a.module_a`
3.  `module_a.py`做`import app.package_b.module_b`

或者 2 或 3 可以使用：`from app.package_a import module_a`

只要您`app`在 PYTHONPATH 中，它就会起作用。`main.py`那时可能在任何地方。

因此，您编写一个`setup.py`将整个应用程序包和子包复制（安装）到目标系统的 python 文件夹和`main.py`目标系统的脚本文件夹。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T00:27:19.923

如果我[阅读](http://www.python.org/dev/peps/pep-0328/) [正确](http://docs.python.org/whatsnew/2.5.html)，在 Python 2.5 或更高版本中：

```
from ..Module_B import Module_B 
```

我以为我精通 Python，但我不知道这在 2.5 版中是可能的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T00:42:43.790

如果您随后将 Module_B 导入到 App，您将

Module_B.py：导入模块A

App.py（它还导入了现在默认位于 Pythonpath 中的 ModuleA）

```
import Module_B.Module_B 
```

另一种选择是将 __init__.py （Module_A/App 文件夹中的那个）更新为：

```
import os
import sys
sys.path.extend('%s../' % os.getcwd())
import ModuleA 
```

另一种选择是将您的文件夹添加到 PYTHONPATH 环境变量中。

# c# - ASP.NET MVC & JQuery 动态表单内容

> ID：463644
> 
> 赞同：6
> 
> 时间：2009-01-21T00:10:58.583
> 
> 标签：c#, jquery, asp.net-mvc

我想使用 JQuery 将字段动态添加到 ASP.NET MVC 表单。

例子：

```
<script language="javascript" type="text/javascript">
    var widgets;

    $(document).ready(function() {
        widgets = 0;
        AddWidget();
    });

    function AddWidget() {
        $('#widgets').append("<li><input type='text' name='widget" + widgets + "'/></li>");
        widgets++;
    }
</script>

<ul id="widgets">
</ul> 
```

这可行，但我打算手动迭代控制器中的表单值：

```
[AcceptVerbs("Post")]
public ActionResult AddWidget(FormCollection form)
{
    foreach (string s in form)
    {
        string t = form[s];
    }

    return RedirectToAction("ActionName");
} 
```

但是当我将用户发送回控制器中的 Get Action 时，我想到了，我必须使用输入的值设置 FormData，然后使用 <% 脚本迭代地添加小部件。

在当前版本中执行此操作的最佳方法是什么（我相信 5 个）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-16T20:36:03.483

我的解决方案可能是这样的（伪代码）：

```
<script language="javascript" type="text/javascript">
    var widgets;

    $(document).ready(function() {
        widgets = 0;
        <% for each value in ViewData("WidgetValues") %>
             AddWidget(<%= value %>);
        <% next %>
    });

    function AddWidget( value ) {
        $('#widgets').append("<li><input type='text' name='widget" + widgets + 
                             "'>" + value + "</input></li>");
        widgets++;
    }
</script>

<ul id="widgets">
</ul> 
```

在控制器中：

```
[AcceptVerbs("Post")]
public ActionResult AddWidget(FormCollection form)
{
    dim collValues as new Collection;
    foreach (string s in form)
    {
        string t = form[s];
        collValues.add( t )
    }
    ViewData("WidgetValues") = collValues;
    return RedirectToAction("ActionName");
} 
```

您可以稍后制定详细信息
（抱歉将 VB 与 C# 混合，我是 VB 人）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-30T06:30:28.980

我可能错过了这里的重点，但是，您是否需要通过表单操作将数据实际发布回控制器？为什么不使用 jquery 进行 ajax 调用以将数据发布到控制器……或者更好的是 Web 服务？异步发送数据，无需使用发送的数据值重建视图。

如果这些值被使用并且不再使用，这很好用，但是，如果您计划持久化数据并通过视图显示它，您的模型应该真正支持数据结构。也许`Dictionary<string, string>`在模型上。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T09:32:52.317

我不是 ASP.net 开发人员，但我从 PHP 知道您可以使用数组作为输入字段的名称

前任：

```
<input type="text" name="widgets[]" />
<input type="text" name="widgets[]" /> 
```

然后，您可以遍历 post 变量小部件，就好像它是一个值数组一样。

不要乱用动态命名的变量等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-15T22:44:58.393

据我了解，问题是在小部件中保留发布的值。我认为您可以在视图渲染期间渲染那些您不会在服务器上填充的最宽的内容。

# functional-programming - 二郎：干得好

> ID：463646
> 
> 赞同：3
> 
> 时间：2009-01-21T00:12:08.783
> 
> 标签：functional-programming, erlang, coding-style

我做了一些函数式编程，并且有一些在线参考资料，所以我发现基本的 Erlang 编程非常容易。

但是由于我做的程序/面向对象编程比函数式编程多得多，我希望我的 Erlang 代码不是很好的样式或效率。

任何人都可以推荐任何涵盖良好、高效、风格良好的函数式编程的资源吗？

谢谢你！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-21T00:24:34.373

一定要尝试阅读 erlang 书籍： http:
[//www.pragprog.com/titles/jaerlang/programming-erlang](http://www.pragprog.com/titles/jaerlang/programming-erlang)

这本书的第一部分可在线免费获得，当您刚刚学习语言时，它会成为一个很好的伴侣：http:
[//erlang.org/download/erlang-book-part1.pdf](http://erlang.org/download/erlang-book-part1.pdf)

如果您正在寻找更高级的东西，或者想学习有关语言/OTP 的提示和技巧，那么我会推荐“实践中的 Erlang”截屏视频：http:
[//www.pragprog.com/screencasts/v-kserl/erlang-实践中](http://www.pragprog.com/screencasts/v-kserl/erlang-in-practice)
虽然它们是 40 美元，但它们是高质量的截屏视频，我相信物有所值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T08:30:11.320

如果您将架构和设计视为编程策略，将编码风格视为战术，那么好的资源是：

*   **策略**-[在存在软件错误的情况下建立可靠的系统](http://www.sics.se/~joe/thesis/armstrong_thesis_2003.pdf)
*   **战术**-[编程规则和约定](http://www.erlang.se/doc/programming_rules.shtml)

我认为主要规则是：

*   制作简短易读的函数
*   保持参数、元组成员、记录参数和其他的数量较少（少于 5 个） - 构建数据
*   do 和 undo 在同一功能中思考 - 制作安全功能 - 避免别人开枪
*   KISS - 保持简单和愚蠢（愚蠢并不意味着愚蠢，但不要过于聪明）

# certificate - MakeCert - 是否可以更改密钥大小？

> ID：463657
> 
> 赞同：12
> 
> 时间：2009-01-21T00:15:32.677
> 
> 标签：certificate, size, key, makecert

当我使用 MakeCert.exe 生成证书时，我想将密钥大小从 1024 更改为 2048。

这可能吗？还是我需要设置证书颁发机构 (CA)？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-21T01:06:16.113

[这里](http://www.mazecomputer.com/sxs/help/shared.htm)使用以下语法：

```
makecert -pe -ss MY -$ individual -n "CN=your name here" -len 2048 -r 
```

抱歉，我无法测试它，因为我没有 Makecert。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T00:26:10.797

[可以在 MSDN 找到 Makecert 选项的描述](http://msdn.microsoft.com/en-us/library/bfsktky3(VS.80).aspx)，但我没有看到用于设置密钥长度的明确选项。

# c# - Microsoft.ServiceModel.Web 是否仅在 GAC 中有效？

> ID：463659
> 
> 赞同：0
> 
> 时间：2009-01-21T00:15:35.610
> 
> 标签：c#, wcf, rest, service

我只用一个 GetData 创建了我的第一个 WCF [RESTful](http://en.wikipedia.org/wiki/Representational_State_Transfer#RESTful_web_services)服务，**它在 localhost 中完美运行**，但是当我将它添加到托管环境时，我得到：

```
Server Error in '/' Application.
Compilation Error
Description: An error occurred during the compilation of a resource required to service this request. Please review the following specific error details and modify your source code appropriately.

Compiler Error Message: CS0234: The type or namespace name 'ServiceModel' does not exist in the namespace 'Microsoft' (are you missing an assembly reference?) 
```

这是否意味着我需要将 DLL 文件放在[GAC](http://en.wikipedia.org/wiki/Global_Assembly_Cache)中才能完成这项工作？它不应该在我的服务的 BIN 文件夹中工作吗？

这是我的服务文件夹的样子：

```
Service.svc
Service.svc.cs
web.config
BIN
  Microsoft.ServiceModel.Web.dll
  Microsoft.ServiceModel.Web.pdb
  MyService.dll
  MyService.pdb
PROPERTIES
  AssemblyInfo.cs 
```

我该怎么做才能完成这项工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-01-20T08:38:48.283

当我第一次尝试直接在 IIS 7.5 中创建一个虚拟目录时，我遇到了同样的问题，然后将我的 RESTful Web 服务发布到这个文件夹。

我的解决方案是使用 Visual Studio 2008（项目属性/Web 选项卡/“使用 IIS 服务器”）选择文件夹，然后在同一选项卡上的“创建虚拟目录”按钮创建虚拟目录。然后一切正常。

# javascript - 如何消除渲染后的“闪烁”？

> ID：463670
> 
> 赞同：17
> 
> 时间：2009-01-21T00:20:15.990
> 
> 标签：javascript, jquery, html, ajax, dom

我已尽我最大的努力在使用 Javascript/Ajax 技术时成为一个纯粹主义者，确保所有 Ajax-y 行为都是对基本功能的增强，而当 Javascript 被禁用时，该站点也可以完全正常运行。但是，这会导致一些问题。

在某些情况下，只有在浏览器中启用了 Javascript 时，DOM 节点才应该可见。在其他情况下，它应该只在禁用时可见。以表单上的提交按钮为例，该按钮有一个带有自动提交的 onchange 处理程序的下拉列表（使用 JQuery 的表单插件）：

```
<form method="post" action=".">
    <label for="id_state">State:</label>
    <select name="state" id="id_state" onchange="$(this.form).ajaxSubmit(ajax_submit_handler);">
        <option value="AL">Alabama</option>
        <option value="AK">Alaska</option>
    </select>
    <input class="with_js_disabled" type="submit" value="OK" />
</form> 
```

和Javascript：

```
<script type="text/javascript">
    $(document).ready(function()
    {
        $(".with_js_disabled").hide();
    });
</script> 
```

启用 Javascript 时，不需要提交按钮（由于 onchange 处理程序）。但是，JQuery 的 $(document).ready 函数（以及更直接的 document.onload）仅在页面完全加载并呈现后才被调用 - 因此，最初显示提交按钮，并且在 Javascript 运行时发生“闪烁”执行并且节点的显示设置为“无”。

我已经接受这是做生意的成本，但还没有找到解决办法。但是有没有一种我不知道的技术可以最大限度地减少影响，甚至完全消除它？

**编辑：**

下面`<noscript>`许多人提到的解决方案似乎很有希望，但在 Safari 上对我不起作用。然而 Prestaul 的第二个建议效果很好：

```
<body>
    <script type="text/javascript">
        document.body.className += ' has_js';
    </script>
    <!-- the rest of your page -->
</body> 
```

然后可以使用直接的 CSS 对其进行样式设置：

```
body .js_enabled_only { display: none; }
body .js_disabled_only { display: block; }
body.has_js .js_enabled_only { display: block; }
body.has_js .js_disabled_only { display: none; } 
```

第二行仅供参考，可以（并且应该）删除以避免您的元素不应该显示的情况：块。同样，对于其他显示样式，您可能需要在第三行进行不同的变体。但是这个解决方案很好，很干净，IMO，在我的测试中完全消除了闪烁效果。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-21T01:24:05.220

如何结合其中一些解决方案：

```
<style type="text/javascript">
    .only-without-script {
        display: none;
    }
</style>
<noscript>
    <style type="text/javascript">
        .only-with-script {
            display: none;
        }
        .only-without-script {
            display: block;
        }
    </style>
</noscript> 
```

或者我更喜欢在正文中添加一个类（将您的`<script>`标签放在正文的顶部，不要使用 .ready 事件）：

```
<head>
    <style type="text/javascript">
        body.has-script .something-not-ajaxy {
            display: none;
        }

        input.ajaxy-submit {
            display: none;
        }
        body.has-script input.ajaxy-submit {
            display: inline;
        }
    </style>
</head>
<body>
    <script type="text/javascript">
        document.body.className += ' has-script';
    </script>
    <!-- the rest of your page -->
</body> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-21T01:08:31.710

对于与您相同的情况，我通常将提交按钮放在[`<noscript>`](http://www.w3.org/TR/REC-html40/interact/scripts.html#h-18.3.1)标签周围。没有人建议它，所以我不确定围绕这些部分是否被认为是不好的做法，但它是我使用的，它对我有用。

如果您只想在启用 Javascript 时显示一个节点，您可以在头部执行以下操作：

```
<noscript>
    <style type="text/css">
    .js-enabled { display: none; }
    </style>
</noscript> 
```

然后给任何纯 Javascript 元素一个`js-enabled`.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T01:03:11.940

就像大卫说的那样，你可以添加一个 Javascript，它添加一个样式表来隐藏所有“不必要的”html 元素：

```
<head>
  ...
  <script type="text/javascript" language="javascript">
    document.write('<style type="text/css"> .disabled-if-javascript { display: none; } </style>');
  </script>
</head>
... 
```

如果启用了 Javascript，它会在加载正文之前将“disabled-if-javascript”类的所有元素设置为隐藏。如果启用了 javascript，只需将此类添加到需要隐藏的所有元素。您可能还需要一个相反的类 enabled-if-javascript 来显示某些将对非 javascript 隐藏的元素。也许您需要在`!important`您的样式定义中添加“”，以覆盖现有的（非javascript）规则。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T00:29:05.720

我可以想到两种方法：

1 - 预先检测是否启用了 Javascript 并将该信息保存在 cookie/会话中。这可以在首页完成，并且应该消除大多数闪烁。

2 - 使用[livequery 插件](http://docs.jquery.com/Plugins/livequery)，它会在元素添加到 DOM 时检测它们。您可以在 Javascript 完成加载时立即运行它，这应该在文档之前（它在头部）。

```
$('.with_js_disabled').livequery(function() {
     $(this).hide();
}); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T00:31:15.640

只是一个想法：我不确定这是否可行，但您可以尝试在文档头部放置一些 Javascript 来编写一个隐藏按钮的 CSS 样式元素。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-18T20:03:52.873

一个简单的尝试：`<script>jQuery.ready();</script>`在关闭 body 标签之前添加。

这将强制所有绑定到 'ready' 事件触发。如果您在文档末尾触发它们，则 DOM 已加载并准备就绪，即使“本机”onDomContentLoaded 事件尚未触发。

当我想消除闪烁时，这通常对我有用，尤其是在 IE/win 中，因为 IE 在 jQuery 的“就绪”事件中有它自己的 domready 模拟器。

# c# - 如何将复选框列添加到 MasterPage 中的网格视图？（或者，如何将 LiteralControl 转换为 Checkbox）

> ID：463676
> 
> 赞同：1
> 
> 时间：2009-01-21T00:22:36.687
> 
> 标签：c#, asp.net, gridview

我有一个gridview，我使用模板字段添加了一个复选框列（我希望用户能够选中/取消选中该框。我希望能够填充复选框，但是当我尝试将该列转换为复选框时在 RowDataBound 事件上，它出错了。由于 Masterpage，我也无法执行 FindControl（我认为）

任何帮助，将不胜感激！

RowDataBound：

if (e.Row.RowType == DataControlRowType.DataRow) {

```
 var RowData = (ResponderResultViewClass)e.Row.DataItem;

  // This control never gets found (due to the Masterpage I think)
  CheckBox chkBox = (CheckBox)e.Row.FindControl("chkCertified");

  // This throws an error saying "Can't convert LiteralControl to Checkbox
  CheckBox cb = (CheckBox)e.Row.Cells[4].Controls[0]; 
```

这是aspx代码：

```
<asp:BoundField DataField="AnswerID" ControlStyle-Width="0" />
<asp:BoundField DataField="QuestionText" HeaderText="Question" />
<asp:BoundField DataField="AnswerText" HeaderText="Answer" ItemStyle-HorizontalAlign="Center" />
<asp:BoundField DataField="QualifyingGroupName" HeaderText="Qualifying Group" />
<asp:TemplateField HeaderText="Cert">
    <ItemStyle HorizontalAlign="Center" />
        <ItemTemplate>
            <asp:CheckBox ID="chkCertified" runat="server" />
    </ItemTemplate>
</asp:TemplateField> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T00:29:23.257

Controls[0] 不是复选框。ASP.NET 会在其中粘贴一些 HTML 内容作为 LiteralControl，您需要查看哪个索引是您的复选框或坚持使用 FindControl。

如果您只是尝试将真/假绑定到复选框，则可以在模板列中这样做：

```
<asp:TemplateField HeaderText="Cert">
    <ItemStyle HorizontalAlign="Center" />
    <ItemTemplate>
        <asp:CheckBox ID="chkCertified" runat="server" Checked='<%# Eval("IsChecked") %>' />
    </ItemTemplate>
</asp:TemplateField> 
```

其中 IsChecked 是绑定对象的属性。

# sql - ALTER TABLE 不锁定表？

> ID：463677
> 
> 赞同：113
> 
> 时间：2009-01-21T00:22:42.147
> 
> 标签：sql, mysql, ddl, alter-table

在 MySQL 中执行 ALTER TABLE 语句时，整个表在语句执行期间被读锁定（允许并发读取，但禁止并发写入）。如果它是一个大表，则 INSERT 或 UPDATE 语句可能会被阻塞很长时间。有没有办法进行“热更改”，例如添加一列以使表在整个过程中仍可更新？

大多数情况下，我对 MySQL 的解决方案感兴趣，但如果 MySQL 做不到，我会对其他 RDBMS 感兴趣。

澄清一下，我的目的只是为了避免在需要额外表列的新功能被推送到生产环境时出现停机。任何数据库模式*都会*随着时间而改变，这是不争的事实。我不明白为什么我们应该接受这些变化必然会导致停机。那只是虚弱。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-01-21T01:07:38.250

唯一的其他选择是手动执行许多 RDBMS 系统无论如何都会执行的操作...
- 创建一个新表

然后，您可以一次将旧表的内容复制到一个块上。同时始终对源表上的任何 INSERT/UPDATE/DELETE 保持谨慎。（可以通过触发器管理。虽然这会导致减速，但它不是锁定......）

完成后，更改源表的名称，然后更改新表的名称。最好在交易中。

完成后，重新编译使用该表的任何存储过程等。执行计划可能不再有效。

**编辑：**

一些评论认为这个限制有点差。所以我想我应该对它提出一个新的观点来说明它为什么会这样......

*   添加新字段就像在每一行上更改一个字段。
*   字段锁会比行锁更难，更不用说表锁了。

*   你实际上是在改变磁盘上的物理结构，每条记录都在移动。
*   这真的就像整个表上的更新，但影响更大......

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2012-10-10T19:23:37.780

Percona 制作了一个名为[pt-online-schema-change](https://www.percona.com/doc/percona-toolkit/2.1/pt-online-schema-change.html)的工具，可以做到这一点。

它实质上是复制表并修改新表。为了使新表与原始表保持同步，它使用触发器进行更新。这允许在后台准备新表时访问原始表。

这类似于上面 Dems 建议的方法，但这是以自动化方式进行的。

他们的一些工具有一个学习曲线，即连接到数据库，但是一旦你掌握了它，它们就是很好的工具。

前任：

```
pt-online-schema-change --alter "ADD COLUMN c1 INT" D=db,t=numbers_are_friends 
```

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2016-06-18T18:45:50.280

这个问题来自 2009 年。现在 MySQL 提供了一个解决方案：

**在线 DDL（数据定义语言）**

> 在 DDL（主要是 ALTER TABLE）操作期间提高 InnoDB 表的性能、并发性和可用性的功能。有关详细信息，请参阅第 14.11 节，“InnoDB 和在线 DDL”。
> 
> 细节因操作类型而异。在某些情况下，可以在 ALTER TABLE 正在进行时同时修改表。该操作可能无需执行表复制或使用特别优化的表复制类型即可执行。空间使用由 innodb_online_alter_log_max_size 配置选项控制。

它允许您在 DDL 操作期间调整性能和并发性之间的平衡，通过选择是否完全阻止对表的访问（LOCK=EXCLUSIVE 子句）、允许查询但不允许 DML（LOCK=SHARED 子句）或允许完整查询和 DML访问表（LOCK=NONE 子句）。当您省略 LOCK 子句或指定 LOCK=DEFAULT 时，MySQL 根据操作类型允许尽可能多的并发。

尽可能就地执行更改，而不是创建表的新副本，避免临时增加磁盘空间使用量和与复制表和重建二级索引相关的 I/O 开销。

有关更多信息，请参阅[MySQL 5.6 参考手册 -> InnoDB 和 Online DDL](https://dev.mysql.com/doc/refman/5.6/en/innodb-online-ddl.html)。

MariaDB 中似乎也提供了在线 DDL

> 或者，您可以使用 ALTER ONLINE TABLE 来确保您的 ALTER TABLE 不会阻塞并发操作（不带锁）。它相当于 LOCK=NONE。

[MariaDB KB 关于 ALTER TABLE](https://mariadb.com/kb/en/mariadb/alter-table/)

* * *

## 回答 #4

> 赞同：17
> 
> 时间：2011-03-16T03:37:48.640

请参阅 Facebook 的在线架构更改工具。

[http://www.facebook.com/notes/mysql-at-facebook/online-schema-change-for-mysql/430801045932](http://www.facebook.com/notes/mysql-at-facebook/online-schema-change-for-mysql/430801045932)

不适合胆小的人；但它会完成这项工作。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2011-07-01T01:25:38.113

如果可以的话，我推荐 Postgres。使用 postgres，以下过程基本上没有停机时间：

*   [ALTER TABLE ADD COLUMN（如果该列可以为 NULL）](http://www.postgresql.org/docs/current/static/sql-altertable.html#AEN57290 "关于 ALTER TABLE 的信息")
*   更改表删除列
*   [CREATE INDEX（必须同时使用 CREATE INDEX）](http://www.postgresql.org/docs/9.0/static/sql-createindex.html#SQL-CREATEINDEX-CONCURRENTLY)
*   删除索引

另一个很棒的特性是大多数 DDL 语句都是事务性的，因此您可以在 SQL 事务中进行整个迁移，如果出现问题，整个事情都会回滚。

我之前写过[这篇](http://corner.squareup.com/2011/06/postgresql-data-is-important.html "PostgreSQL 优于 MySQL 的优点")文章，也许它可以对其他优点有更多的了解。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-01-21T05:52:58.547

由于您询问了其他数据库，因此这里有一些有关 Oracle 的信息。

向 Oracle 表添加 NULL 列是一项非常快速的操作，因为它只更新数据字典。这会在很短的时间内在表上保持排他锁。但是，它将使任何依赖的存储过程、视图、触发器等无效。这些将自动重新编译。

如有必要，您可以从那里使用 ONLINE 子句创建索引。同样，只有非常短的数据字典锁。它将读取整个表以查找要索引的内容，但在执行此操作时不会阻止任何人。

如果您需要添加外键，您可以这样做并让 Oracle 相信您数据是正确的。否则它需要读取整个表并验证所有可能很慢的值（首先创建索引）。

如果您需要将默认值或计算值放入新列的每一行，则需要运行大量更新或可能填充新数据的小实用程序。这可能会很慢，尤其是当行变得更大并且不再适合它们的块时。在此过程中可以管理锁定。由于您的应用程序的旧版本仍在运行，它不知道此列，您可能需要一个偷偷摸摸的触发器或指定一个默认值。

从那里，您可以在应用程序服务器上切换到新版本的代码，它会继续运行。放下你偷偷摸摸的扳机。

或者，您可以使用 DBMS_REDEFINITION，它是一个旨在执行此类操作的黑盒。

所有这些都非常麻烦测试等等，以至于每当我们发布主要版本时，我们都会在周日早上中断。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2010-05-16T03:24:49.350

如果您在进行应用程序更新时无法承受数据库的停机时间，您应该考虑维护一个双节点集群以实现高可用性。通过简单的复制设置，您可以像您建议的那样进行几乎完全在线的结​​构更改：

*   等待所有更改在被动从站上复制
*   将被动从站更改为主动主站
*   对老主子做结构上的改变
*   将更改从新主服务器复制回旧主服务器
*   再次进行主交换和新的应用程序部署

这并不总是那么容易，但它确实有效，通常停机时间为 0！第二个节点不必只是被动节点，它可以用于测试、统计或作为后备节点。如果没有基础架构复制，可以在单台机器内设置（带有两个 MySQL 实例）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-01-21T00:25:45.493

没有。如果您使用的是 MyISAM 表，据我所知，它们只做表锁——没有记录锁，它们只是试图通过简单来保持一切超快。（其他 MySQL 表的操作方式不同。）在任何情况下，您都可以将表复制到另一个表，更改它，然后切换它们，更新差异。

这是一个如此巨大的改变，我怀疑任何 DBMS 都会支持它。首先能够使用表中的数据来执行此操作被认为是一种好处。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-08-13T22:43:37.750

临时解决...

其他解决方案可能是，添加另一个具有原始表主键的表以及新列。

将主键填充到新表中并为新表中的新列填充值，并修改查询以加入此表以进行选择操作，您还需要单独插入、更新此列值。

当您能够获得停机时间时，您可以更改原始表、修改 DML 查询并删除之前创建的新表

否则，您可以使用 percona 的集群方法、复制、pt-online-schema 工具

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-10-25T08:44:13.790

你一定要试试`pt-online-schema-change`。我一直在使用这个工具在具有多个从属服务器的 AWS RDS 上进行迁移，它对我来说效果很好。我写了一篇详细的博客文章，介绍如何做这可能对你有帮助。

博客： http: [//mrafayaleem.com/2016/02/08/live-mysql-schema-changes-with-percona/](http://mrafayaleem.com/2016/02/08/live-mysql-schema-changes-with-percona/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-21T10:04:31.300

使用 Innodb 插件，仅添加或删除二级索引的 ALTER TABLE 语句可以“快速”完成，即无需重建表。

然而，一般来说，在 MySQL 中，任何 ALTER TABLE 都涉及重建整个表，这可能需要很长时间（即，如果表中包含有用的数据量）。

您确实需要设计您的应用程序，以便不需要定期执行 ALTER TABLE 语句；您当然不希望在应用程序的正常运行期间完成任何 ALTER TABLE ，除非您准备等待或正在更改小表。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-22T20:25:19.550

一般来说，答案将是“否”。您正在更改可能需要大量更新的表结构”，我绝对同意这一点。如果您希望经常这样做，那么我将提供“虚拟”列的替代方案 - 使用`VIEW`s用于数据的表的数量`SELECT`。IIRC，更改视图的定义相对轻量级，并且在编译查询计划时完成通过视图的间接性。代价是您必须将列添加到新表并制作`JOIN`在列中查看。

当然，这仅在您可以使用外键执行级联删除之类的情况下才有效。另一个好处是您可以创建一个包含数据组合的新表，并将视图指向它，而不会干扰客户端的使用。

只是一个想法。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-22T20:33:21.937

我会推荐以下两种方法之一：

1.  设计您的数据库表时要考虑到潜在的变化。例如，我使用过内容管理系统，它会定期更改内容中的数据字段。与其构建物理数据库结构来匹配最初的 CMS 字段要求，不如构建一个灵活的结构要好得多。在这种情况下，使用 blob 文本字段（例如 varchar(max)）来保存灵活的 XML 数据。这使得结构变化非常不频繁。结构变更可能代价高昂，因此这里的成本也有好处。

2.  有系统维护时间。系统在更改期间（每月等）脱机，并且更改安排在一天中流量最少的时间（例如凌晨 3 点到 5 点）。这些更改是在生产推出之前进行的，因此您将有一个很好的停机时间固定窗口估计。

2a。拥有冗余的服务器，这样当系统宕机时，整个站点不会宕机。这将允许您以交错的方式“滚动”更新，而不会关闭整个站点。

选项 2 和 2a 可能不可行；它们往往仅适用于较大的站点/操作。然而，它们是有效的选项，我个人使用了这里提供的所有选项。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-07-11T02:03:33.670

如果有人仍在阅读本文或碰巧来到这里，这就是使用像 mongodb 这样的 NoSQL 数据库系统的一大好处。我在处理更改表以在具有数百万行和高写入的大表上添加附加功能或索引的列时遇到了同样的问题。它最终会锁定很长时间，因此在 LIVE 数据库上执行此操作会使我们的用户感到沮丧。在小桌子上，您可以摆脱它。

我讨厌我们必须“设计我们的表格以避免改变它们”的事实。我只是认为这在当今的网站世界中行不通。您无法预测人们将如何使用您的软件，这就是您根据用户反馈快速更改内容的原因。使用 mongodb，您可以随意添加“列”而无需停机。您甚至没有真正添加它们，您只需插入带有新列的数据，它就会自动完成。

值得一试：www.mongodb.com

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-01-29T21:38:10.163

Postgres 和 MySQL 在这方面的区别在于 Postgres 不会重新创建表，而是修改数据字典，这与 Oracle 类似。因此，操作速度很快，但仍然需要在很短的时间内分配一个独占 DDL 表锁，正如其他人所说的那样。

在 MySQL 中，该操作将在阻塞事务的同时将数据复制到新表，这在 v. 5.6 之前一直是 MySQL DBA 的主要痛苦。

好消息是，自从 MySQL 5.6 发布以来，限制已经[大部分解除](http://dev.mysql.com/doc/refman/5.6/en/innodb-create-index-overview.html "大部分被解除")，您现在可以享受 MYSQL DB 的真正力量。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2016-02-08T10:49:35.150

正如 SeanDowney 所提到的，`pt-online-schema-change`是执行您在此处的问题中描述的最佳工具之一。我最近在一个实时数据库上做了很多架构更改，并且进展顺利。您可以在我的博客文章中阅读更多信息：http: [//mrafayaleem.com/2016/02/08/live-mysql-schema-changes-with-percona/](http://mrafayaleem.com/2016/02/08/live-mysql-schema-changes-with-percona/)。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-01-21T05:05:28.003

如果您可以预测它们的类型（并使它们可以为空），那么虚拟列是一个好主意。检查您的存储引擎如何处理空值。

如果您在电话中或在机场顺便提及餐桌名称，MyISAM 会锁定所有内容。它只是这样做...

话虽如此，锁并不是什么大不了的事。只要您不尝试为每一行添加新列的默认值，而是让它为空，并且您的存储引擎足够聪明，不会去写它，您应该可以使用仅保持足够长的时间来更新元数据。如果您确实尝试编写一个新值，那么您就完蛋了。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-11-28T02:20:07.657

TokuDB 可以“热”添加/删除列和添加索引，该表在整个过程中是完全可用的。可通过 www.tokutek.com 获得

* * *

## 回答 #19

> 赞同：-7
> 
> 时间：2009-01-21T00:26:46.397

并不真地。

毕竟，您正在更改表的底层结构，这是一些对底层系统非常重要的信息。您还（可能）在磁盘上移动大部分数据。

如果您打算经常这样做，最好用“虚拟”列填充表格以供将来使用。

# c# - 循环遍历数组而不抛出异常

> ID：463689
> 
> 赞同：2
> 
> 时间：2009-01-21T00:26:23.807
> 
> 标签：c#, arrays, loops

假设我有一个值数组：

```
string[] text = new string[] { "val1", "val2", "val3", "val4", "val5" }; 
```

然后我有一个基本循环：

```
for (int i = 0; i <= 30; i++)
{
    Console.WriteLine(i + " = " + text[i])
} 
```

显然，这会导致越界异常，所以我想要做的是当计数器到达数组的上限时，然后返回开始。

所以

```
0 = val1    
1 = val2    
2 = val3    
3 = val4    
4 = val5    
5 = val1    
6 = val2    
7 = val3    
etc.. 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-01-21T00:29:12.320

您可以使用模数运算符：

```
Console.WriteLine(i + " = " + text[i % 5]) 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-21T00:34:53.340

取数组长度的模数：

```
for (int i = 0; i < 30; ++i)
{
    Console.WriteLine(i + " = " + text[i % text.Length]);
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-21T00:29:46.517

尝试

```
for(int i=0;i<=30;i++)
{
    Console.WriteLine(i + " = " + string[i % 5])
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-21T00:40:48.617

不应该是：

```
Console.WriteLine(i + " = " + text[i % text.length]) 
```

?

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-21T00:58:50.123

作为一个稍微不太具体的解决方案......

```
class Program
{
    static void Main(string[] args)
    {
        string[] text = new string[] { "val1", "val2", "val3", "val4", "val5" };

        int count = 0;
        foreach (string t in text.ContinuousLoopTo(30))
        {
            Console.WriteLine(count.ToString() + " = " + t);
            count++;
        }

        Console.ReadLine();
    }
}

public static class Extensions
{
    public static IEnumerable<T> ContinuousLoopTo<T>(this IList<T> list, int number)
    {
        int loops = number / list.Count;

        int i = 0;

        while (i < loops)
        {
            i++;

            foreach (T item in list)
            {
                yield return item;
            }
        }

        for (int j = 0; j < number % list.Count; j++)
        {
            yield return list[j];
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-21T00:29:55.970

什么？就像永远？

```
bool run = true;
int i = 0;
string[] text = new string[] {"val1", "val2", "val3", "val4", "val5"};
while(run)
{
   Console.WriteLine(i + " = " + text[i])
   i++;
   if(i>=text.Length) i=0;
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-21T00:31:37.993

写行应该是：

```
Console.WriteLine(i + " = " + text[i%5]); 
```

# wpf - 可以伪造 WPF 鼠标悬停吗？

> ID：463705
> 
> 赞同：9
> 
> 时间：2009-01-21T00:33:06.853
> 
> 标签：wpf, events, simulation, mouseover

我有一个带有文本框的数据模板和一个带有一些样式的按钮。当焦点位于旁边的文本框上时，我想让按钮显示鼠标悬停状态。这可能吗？

我想它会涉及到这样的事情。我可以通过使用 FindVisualChild 和 FindName 来获取文本框。然后我可以在文本框上设置 GotFocus 事件来做一些事情。

```
_myTextBox.GotFocus += new RoutedEventHandler(TB_GotFocus); 
```

在 TB_GotFocus 中我被卡住了。我可以获得想要显示鼠标悬停状态的按钮，但我不知道要发送什么事件给它。不允许 MouseEnterEvent。

```
void TB_GotFocus(object sender, RoutedEventArgs e)
  {
     ContentPresenter myContentPresenter = FindVisualChild<ContentPresenter>(this.DataTemplateInstance);
     DataTemplate template = myContentPresenter.ContentTemplate;

     Button _button= template.FindName("TemplateButton", myContentPresenter) as Button;
     _button.RaiseEvent(new RoutedEventArgs(Button.MouseEnterEvent));

  } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T09:33:16.903

我认为不可能伪造事件，但您可以强制按钮呈现自身*，就好像*它有 MouseOver。

```
private void tb_GotFocus(object sender, RoutedEventArgs e)
{
    // ButtonChrome is the first child of button
    DependencyObject chrome = VisualTreeHelper.GetChild(button, 0);
    chrome.SetValue(Microsoft.Windows.Themes.ButtonChrome.RenderMouseOverProperty, true);
}

private void tb_LostFocus(object sender, RoutedEventArgs e)
{
    // ButtonChrome is the first child of button
    DependencyObject chrome = VisualTreeHelper.GetChild(button, 0);
    chrome.ClearValue(Microsoft.Windows.Themes.ButtonChrome.RenderMouseOverProperty);
} 
```

您需要参考 PresentationFramework.Aero.dlll 才能使其正常工作，然后它将仅适用于 Aero 主题的 Vista。

如果您希望它适用于其他主题，您应该为您想要支持的每个主题制作自定义控件模板。

有关提示，请参阅[http://blogs.msdn.com/llobo/archive/2006/07/12/663653.aspx](http://blogs.msdn.com/llobo/archive/2006/07/12/663653.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-26T15:21:15.003

作为对 jesperll 评论的跟进，我认为您可以通过将样式动态设置为您想要的样式/为空来为每个主题制作自定义模板。

这是我的窗口，定义了样式（但未设置任何内容）。

```
<Window x:Class="WpfApplication.Window1"
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
xmlns:local="clr-namespace:WpfApplication"
Title="Window1" Height="300" Width="300">

<Window.Resources>
    <Style TargetType="{x:Type Button}" x:Key="MouseOverStyle">
        <Setter Property="Background">
            <Setter.Value>Green</Setter.Value>
        </Setter>
    </Style>
</Window.Resources>

<Grid Height="30">
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="3*"/>
        <ColumnDefinition Width="*"/>
    </Grid.ColumnDefinitions>
    <TextBox x:Name="MyTextBox" Grid.Column="0" Text="Some Text" Margin="2" GotFocus="TextBox_GotFocus" LostFocus="MyTextBox_LostFocus"/>
    <Button x:Name="MyButton" Grid.Column="1" Content="Button" Margin="2" MouseEnter="Button_MouseEnter" MouseLeave="Button_MouseLeave" />
</Grid> 
```

您可以在 .cs 文件中使用事件，而不是通过模板中的触发器设置样式，如下所示：

...

```
 public partial class Window1 : Window
{
    Style mouseOverStyle;
    public Window1()
    {
        InitializeComponent();
        mouseOverStyle = (Style)FindResource("MouseOverStyle");
    }
    private void TextBox_GotFocus(object sender, RoutedEventArgs e) { MyButton.Style = mouseOverStyle; }
    private void MyTextBox_LostFocus(object sender, RoutedEventArgs e) { MyButton.Style = null; }
    private void Button_MouseEnter(object sender, MouseEventArgs e) { ((Button)sender).Style = mouseOverStyle; }
    private void Button_MouseLeave(object sender, MouseEventArgs e) { ((Button)sender).Style = null; }
} 
```

您在构造函数中获得对样式的引用，然后动态设置/取消设置它。这样，您可以定义您希望您的样式在 Xaml 中的样子，并且您不必依赖任何新的依赖项。

# mocking - Rhino Mocks 上的 mock 和 stub 有什么区别？

> ID：463707
> 
> 赞同：149
> 
> 时间：2009-01-21T00:33:19.440
> 
> 标签：mocking, rhino-mocks

我玩得还不够多，通常使用模拟，但我想知道这两者之间有什么区别以及何时在 Rhino Mocks 上使用其中一个。

更新：

[我还用Ayende 的话](http://ayende.com/Wiki/Rhino+Mocks+3.5.ashx#Thedifferencebetweenstubsandmocks "阿扬德的话")找到了我的问题的答案：

**存根和模拟之间的区别**

您可以在本文中获得这些术语的实际定义：[模拟不是存根](http://martinfowler.com/articles/mocksArentStubs.html)。我想从 Rhino Mocks 的角度关注不同之处。

模拟是我们可以设置期望的对象，它将验证预期的动作确实发生了。存根是您用来传递给被测代码的对象。您可以对其设置期望，因此它会以某些方式起作用，但这些期望永远不会得到验证。存根的属性会自动表现得像普通属性一样，您不能对它们设置期望。

如果您想验证被测代码的行为，您将使用具有适当期望的模拟，并进行验证。如果您只想传递一个可能需要以某种方式执行的值，但不是此测试的重点，您将使用存根。

重要提示：存根永远不会导致测试失败。

* * *

## 回答 #1

> 赞同：150
> 
> 时间：2009-01-21T01:12:18.193

按照[这个](http://web.archive.org/web/20101221112808/http://nermins.net/post/2008/08/22/RhinoMocks-35-AAA-Model.aspx)

> ... 简而言之，Mock 和 Stub 对象之间存在差异，RhinoMocks 认识到允许我们编写更好地说明其目的的测试。
> 
> 模拟对象用于定义期望，即：在这种情况下，我希望使用这样和这样的参数调用方法 A()。模拟记录并验证这种期望。
> 
> 另一方面，存根有不同的目的：它们不记录或验证期望，而是允许我们“替换”“假”对象的行为、状态以利用测试场景......

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2017-01-05T11:16:17.770

一般来说，单元测试调用函数和方法，然后检查是否发生了预期的行为。这些函数和方法可能需要参数。我们使用存根和模拟来满足这些参数。我们有时也可以模拟全局对象。

## 存根

Stub 是一个很小的假对象，您的测试可以将其用作参数以使函数调用正常工作。这让我们可以验证被测函数的行为。它不允许我们验证任何副作用，因为存根没有实现。

## 模拟

Mock 是一个带有实现的存根。如果我们的被测函数与我们的模拟对象交互，我们可以验证模拟是否已按预期进行交互。

例如，假设我们有一个模拟 User 对象，并且我们想要验证 session.login 方法是否有效，我们可能想要检查 user.lastLoggedIn 是否已设置。我们可以创建一个实现此方法的模拟用户。当我们调用 session.login 时，我们可以断言 user.lastLoggedIn 具有我们预期的状态。

## 总结一下

模拟是带有实现的存根，它可以让我们测试副作用。

## 这种差异仍然重要吗？

就像明喻和隐喻之间的区别一样，存根和模拟之间的区别是微妙的和历史的，也许更多地与测试世界中不同的社区和哲学有关，而不是任何主要的技术差异。

它们代表了稍微不同的测试方法。模拟可以像存根一样编写。存根通常可以扩展为模拟。

## 你应该使用哪个？

您可能会发现您开始创建存根，然后您可能会发现您需要为某些对象创建完整的模拟。您可能想随时模拟所有内容，或者您​​可能只想在需要的地方模拟。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-11-07T19:58:18.767

Mock 和 stub 之间的区别：使用 stub，您可以修复单元测试的输入：因此您的单元测试不会对 stub 进行断言，而 Stub 通过重写某些方法的实现来修复假对象的行为。使用 Mock，您可以修复单元测试的输出：因此您的单元测试通过检查模拟对象中的内部交互来对您的模拟对象产生期望。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2014-09-18T08:22:49.603

在 Moq 框架的情况下 - 设置方法是存根，而验证方法是模拟

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-07-07T19:38:56.797

我还注意到的一件事是，当我使用 MockRepository.GenerateMock 时，我需要明确设置对特定方法调用的期望以拦截该调用。使用存根，它似乎会自动拦截任何方法，只要它是虚拟的。

# c++ - windows mobile应用程序的无线调试

> ID：463708
> 
> 赞同：0
> 
> 时间：2009-01-21T00:33:31.767
> 
> 标签：c++, windows-mobile, windows-vista, wireless

我正在尝试使用 wifi 连接调试 Windows 移动应用程序，在具有 Visual Studio 2008 的 Vista 上遵循此指令[http://blogs.msdn.com/vsdteam/archive/2005/04/28/413304.aspx](http://blogs.msdn.com/vsdteam/archive/2005/04/28/413304.aspx)。

它在 XP SP2 上完美运行，但在 Vista 上却不行。你知道这是否可能吗？还是 Vista 的另一个缺陷？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T03:36:19.183

它应该可以正常工作。我经常从 Studio '08 on Vista 调试到 CE 5.0 设备。我使用相同的大致步骤大纲（尽管我确实使用了自动化该过程的工具）。

# python - Django 缺少一些字符串的翻译。知道为什么吗？

> ID：463714
> 
> 赞同：9
> 
> 时间：2009-01-21T00:38:19.103
> 
> 标签：python, django, internationalization, translation

我有一个中等规模的 Django 项目（如果有任何区别，可以在 AppEngine 上运行），并且所有字符串都像它们应该的那样存在于 .po 文件中。

我看到某些字符串无法翻译的奇怪行为。当我运行 make_messages 时，它们会出现在 .po 文件中，并且正确的文件位置标记了我的 {% trans %} 标签所在的位置。与两侧的其他字符串相比，翻译已经到位并且看起来正确。但是当我显示有问题的页面时，大约 1/4 的字符串根本不翻译。

深入研究生成的相关 .mo 文件，我看不到 msgid 或 msgstr 。

有没有人见过类似的东西？知道会发生什么吗？

*   反式标签看起来正确
*   .po 文件看起来正确
*   compile_messages 期间没有错误

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-21T00:54:59.663

啊。姜戈，你杀了我。

这是发生的事情：

[http://blog.e-shell.org/124](http://blog.e-shell.org/124)

出于某种只有 Django 知道的原因，它决定用注释“#fuzzy”来装饰我的一些翻译。它似乎已经选择了随机标记的那些。

无论如何，#fuzzy 的意思是：“不要翻译这个，即使这是翻译：”

我会把它留在这里，以防将来有其他可怜的灵魂遇到它。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-01-21T02:31:43.757

模糊标记由 makemessages 添加到 .po 文件中。当您有一个新字符串（没有翻译）时，它会查找相似的字符串，并将它们作为翻译包含在内，并带有模糊标记。这意味着，这是一个粗略的匹配，所以不要将它显示给用户，但这对于人工翻译来说可能是一个好的开始。

这不是 Django 行为，它来自 gettext 工具。

# c# - 带有终结器但没有 IDisposable 的单例

> ID：463716
> 
> 赞同：16
> 
> 时间：2009-01-21T00:38:56.700
> 
> 标签：c#, .net, singleton, idisposable

这是我从“CLR via C#”、“Effective C#”和其他资源中对 IDisposable 和终结器的理解：

*   IDisposable 用于确定性地清理托管和非托管资源。
*   负责非托管资源（例如文件句柄）的类应实现 IDisposable 并提供终结器以确保即使客户端代码未在实例上调用 Dispose() 也能清理它们。
*   只负责托管资源的类不应该实现终结器。
*   如果你有一个终结器，那么你必须实现 IDisposable（这允许客户端代码做正确的事情并调用 Dispose()，而终结器可以防止在他们忘记时泄漏资源）。

虽然我理解并同意上述所有内容，但在一种情况下，我认为打破这些规则是有意义的：一个负责非托管资源的单例类（例如提供对特定文件的单点访问） ）。

我认为在单例上使用 Dispose() 方法总是错误的，因为单例实例应该在应用程序的整个生命周期内都存在，如果有任何客户端代码调用 Dispose() 那么你就被塞满了。但是，您需要一个终结器，以便在卸载应用程序时终结器可以清理非托管资源。

因此，在我看来，拥有一个带有不实现 IDisposable 的终结器的单例类似乎是一件合理的事情，但这种类型的设计与我所理解的最佳实践背道而驰。

这是一个合理的方法吗？如果不是，为什么不呢？有什么更好的选择？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T00:49:07.757

我首先要提到面向对象的设计模式及其后果并不总是影响每个语言决策，即使在面向对象的语言中也是如此。您当然可以找到用一种语言（Smalltalk）而不是另一种语言（C++）更容易实现的经典设计模式。

话虽如此，我不确定我是否同意单例实例只应在应用程序结束时处理的前提。我读过的[Singleton](http://www.dofactory.com/Patterns/PatternSingleton.aspx)（或[Design Patterns: Elements of reusable Object-Oriented Software](https://rads.stackoverflow.com/amzn/click/com/0201633612)）的设计模式描述中没有提到这是该模式的属性。单例应该确保在任何时刻只存在一个类的实例；这并不意味着只要应用程序存在，它就必须存在。

我有一种感觉，在实践中，在应用程序的大部分生命周期中确实存在许多单例。但是，考虑使用 TCP 连接与服务器进行通信的应用程序，但也可以以断开模式存在。连接后，您可能需要一个单例来维护连接信息和连接状态。断开连接后，您可能希望保留相同的单例 - 或者您可以处理该单例。虽然有些人可能认为保留单例更有意义（我什至可能是其中之一），但设计模式本身并没有阻止您处理它 - 如果重新建立连接，则可以实例化单例再次，因为在那个时刻不存在它的实例。

换句话说，您可以创建单例具有 IDisposable 的逻辑场景。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-21T12:59:39.047

如果非托管资源仅在应用程序退出时释放，您甚至无需担心终结器，因为进程卸载无论如何都应该为您处理这个问题。

如果您有多个应用程序域并且您想要处理一个应用程序域卸载，这是一个可能的问题，但可能是您不需要关心的一个问题。

我赞同那些说这种设计可能不是正确的做法（并且会使其更难修复，因为随后您发现您确实需要两个实例）在您的入口点创建对象（或延迟加载包装器对象）并将其通过代码传递到需要的地方，明确谁负责将其提供给谁，然后您可以自由更改决定只使用一个对其余代码几乎没有影响的决定（它使用它得到的给定）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-21T00:49:31.313

只要您的终结器不调用任何其他托管对象的方法（例如 Dispose），您就应该没问题。请记住，最终确定顺序不是确定性的。也就是说，如果您的单例对象 Foo 包含对需要处理的对象 Bar 的引用，则您无法可靠地编写：

```
~Foo()
{
    Bar.Dispose();
} 
```

垃圾收集器可能已经收集了 Bar。

冒着陷入一堆OO goo（即开始战争）的风险，使用单例的一种替代方法是使用静态类。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-21T01:07:29.497

虽然它可能会让您对代码审查感到不满和 FxCop 警告，但在没有 IDisposable 的情况下实现终结器并没有本质上的错误。但是，对单例执行此操作并不是捕获进程或 AppDomain 拆除的可靠方法。

冒着提供主观设计建议的风险：如果对象确实是无状态的，则将其设为静态类。如果它是有状态的，请质疑它为什么是单例：您正在创建一个可变的全局变量。如果您试图捕获应用程序关闭，请在主循环退出时处理它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T13:47:32.990

除了单例对任何特定情况的适用性，

我认为 Disposing of Singleton 没有任何问题。结合惰性实例化，它只是意味着如果您暂时不需要它，则释放资源，然后根据需要重新获取它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-09-27T23:06:32.977

如果你想创建一个带有终结器的单例，你可能应该将它的静态引用设为 WeakReference。这将需要一些额外的工作来确保访问器中的线程安全，但是它将允许在没有人使用它时对单例进行垃圾收集（如果有人随后调用 GetInstance() 方法，他们将得到一个新实例）。如果使用静态强引用，即使没有其他对它的引用，它也会使单例实例保持活动状态。

# silverlight - 在 silverlight xap 文件中嵌入资源（png、jpg、mp3、wmv 等）并从 xaml 引用

> ID：463721
> 
> 赞同：3
> 
> 时间：2009-01-21T00:40:33.157
> 
> 标签：silverlight, xaml, embed, embedded-resource

基本上我希望能够在我的 xaml 中做这样的事情：

```
<Image Source="Resources/logout.png" /> 
```

并让它在我的 xap 文件中找到 Resources/logout.png 作为文件，而无需返回 Web 服务器。我还希望能够即时重建我的 xap 文件，因此将其作为资源放在 dll 中是不可接受的。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T01:12:41.140

将图像添加到项目中，但将*构建操作*设置为内容并将*复制到输出目录*设置为不复制。

对于根目录中的文件，我使用了这种格式。

```
<Image Source="/logout.png" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T01:15:15.707

我建议不要这样做，因为它会使您的初始 XAP 下载花费更长的时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-08-05T22:53:37.073

要播放嵌入在程序集 DLL 中的声音（这与嵌入在 XAP 中不同 - 实际上它是两级嵌套，因为 DLL 在 XAP 中并被加载到内存中）请参阅[http://www.dotnetspider.com/教程/Silverlight-Tutorial-326.aspx](http://www.dotnetspider.com/tutorials/Silverlight-Tutorial-326.aspx)

# linux - 在 Linux 2.6.21 (glibc 2.3.5) 上执行 ARP 和反向 ARP

> ID：463722
> 
> 赞同：3
> 
> 时间：2009-01-21T00:40:46.353
> 
> 标签：linux, ip-address, mac-address, arp

我需要在任意 IP 网络上存储对第三方设备的持久引用，其中设备的 IP 地址可能是静态的或由 DHCP 随机分配。我不控制网络上的设备，也不能依赖 DNS 和其他现有的或与设备一起工作的 ad-hoc 网络协议。

因此，我被指示使用硬件地址和 ARP 进行调查。这会起作用，但我不想重复代码。内核必须管理一个 ARP 表。在 Windows 上，您可以使用[GetIpNetTable](http://msdn.microsoft.com/en-us/library/aa365956(VS.85).aspx)等访问它。

我希望有一个 API 可以回答这两个问题：

*   如何从 IP 转换为 MAC 地址？(ARP)
*   如何从 MAC 转换为 IP 地址？(InARP)

如果没有，那么我可能不得不手动进行更多操作：

*   如何读取内核的 ARP 表？
*   如果我自己确定了映射，如何添加条目？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T00:50:51.450

/proc/net/arp

ķ

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T00:51:29.030

ARP 表往往是相当本地的和短暂的。如果检查协议，通常仅当给定 IP 地址在本地子网中时才提供真正的 MAC 地址。否则，数据包被转发到本地路由器，然后由本地路由器负责转发。

如果您`arp -g`在 Windows 上执行“”或`arp -a`在 UNIX 上执行“”，您会看到该表，但由于上述原因，我认为这对您没有任何好处。该命令和

这确实是 DNS 的用途，但正如您所说，它可能不是您的选择。

您可能必须在应用程序级别编写自己的“ARP​​”数据库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T05:55:34.783

至于 ARP：
您可以使用 system("/usr/bin/arp -option_of_choice"); 并解析输出，但这是一个丑陋的黑客。——不是我的推荐。

查看 /usr/include/linux/sockios.h —— SIOCGARP、SIOCDARP 和 SIOCSARP 详细信息。这些是您可以执行以管理 linux 上的 ARP 表的 ioctl。当然，您必须在套接字 fd 上执行这些 ioctl。以下是一些示例： [SIOCGARP 示例](http://www.koders.com/default.aspx?s=SIOCGARP&btn=&la=&li=)
我相信您也可以找到许多其他语言的示例。正如我假设你正在使用 C.

至于 RARP：
引用 linux rarp 手册页：“该程序已过时。从 2.3 版开始，Linux 内核不再包含 RARP 支持。有关替代 RARP 守护程序，请 参见[ftp://ftp.dementia.org/](ftp://ftp.demen-) pub/net-tools"
所以你必须在目标系统上安装 rarpd。

# asp.net - Mono 对 ASP.NET 有什么真正的限制吗？

> ID：463726
> 
> 赞同：6
> 
> 时间：2009-01-21T00:42:20.623
> 
> 标签：asp.net, linux, mono

我是一名初级开发人员，正在完成我在大学的最后一年。我主要是面向 asp.net 的，甚至有一份用这种语言编码的兼职工作。我对转换到 linux 很感兴趣，并且由于不支持 Visual Studio，所以我在 Mono 中编写我的代码。

我应该注意 Mono 中的任何显着限制（关于 ASP.NET）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-21T00:46:49.430

根据 Mono 网站：

> Mono 的 ASP.Net 没有实现以下功能：
> 
> *   预编译网站
> *   Web 部件 API。

此外，除非另有说明，否则大多数（如果不是全部）第 3 方 ASP.Net 控件与 Mono 不兼容。例如，ComponentArt 控件在 Mono 中不可用。然而，没有理由认为这不会随着 Mono 的普及而改变。ComponentArts 已经提到他们正在考虑在未来增加支持。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-21T01:33:20.227

我会说你失去的最大的东西是 IIS。ASP.net 和 IIS 的联系非常紧密。ASP.net 的许多优点都来自 IIS 中托管功能的利用。我能说出的最大的一个是如果页面在缓存中，HTTP.sys 在内核模式下直接响应请求的能力。这意味着打开的套接字会立即响应，并且可以允许对您的网络服务器进行更多数量级的访问。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T01:23:01.073

它有点极端，但Mono[不支持Microsoft 的](http://www.mono-project.com/WSE)[Web 服务增强功能](http://en.wikipedia.org/wiki/Web_Services_Enhancements)。我试图让一些 WSE 服务在 Mono 上运行时遇到了这个问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-11-17T09:44:09.377

关于 Web 服务，有两个非常好的开源替代方案：[ServiceStack.Net](http://www.servicestack.net/)（使用它）和[NANCY](http://nancyfx.org/)。

恕我直言，这些领域比构建在 WCF 之上的服务更容易实现、使用和维护。

# c# - 在 Visual Studio 中组合多个配置文件

> ID：463733
> 
> 赞同：9
> 
> 时间：2009-01-21T00:49:30.983
> 
> 标签：c#, visual-studio-2008, configuration, app-config, configuration-files

我在 Visual Studio 2008 中有一个包含多个 C# 项目的解决方案。每个项目都有自己的配置文件（App.config 和 Settings.settings）。这在架构上是有意义的，因为每个模块都是自治的，并且用于许多不同的解决方案。

我的问题是，当我编译解决方案时，仅包含启动项目（或包含可执行文件的项目）的配置文件。对于其他模块，配置设置被编译到 DLL 中。所以我的问题是，在 Visual Studio 中是否有任何方法可以组合多个配置文件，或者链接它们以便可以在运行时更改 DLL 的设置？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T00:57:54.383

我不确定这是否是您正在寻找的东西，或者它是否会有所帮助，但只是作为进入探索区域的线索，请注意您可以链接两个配置文件。例如，我将连接字符串放在一个单独的文件中，因此 Web.config 中的 connectionStrings 行显示为：

```
<connectionStrings configSource="WebCS.config"/> 
```

然后，在单独的文件中，我有：

```
<connectionStrings>
    <add name="BSDIConnString" 
         connectionString="Data Source=XXX;Initial Catalog=XXX;User ID=XXX;Password=XXX" 
         providerName="System.Data.SqlClient"/>
</connectionStrings> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T03:25:15.693

好的好人，你需要知道的关于 VS 配置文件的一切：

[http://geekswithblogs.net/akraus1/articles/64871.aspx](http://geekswithblogs.net/akraus1/articles/64871.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T00:56:43.310

我不相信有。但[以防万一你不知道](https://stackoverflow.com/questions/435261/asp-net-solution-with-class-library-project)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T22:26:43.520

经过更多挖掘，我发现这个非常有用的帖子

[http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/2710647c-6414-42c4-90b7-fd7603f55ae0/](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/2710647c-6414-42c4-90b7-fd7603f55ae0/)

以防万一有人遇到同样的问题，以上似乎是解决它的最实用的方法。虽然请注意，使用此解决方案创建安装包可能会变得乏味：

[http://bytes.com/groups/net-c/498720-app-config-dll-not-getting-added-setup-project](http://bytes.com/groups/net-c/498720-app-config-dll-not-getting-added-setup-project)

# svn - 是否可以在保留历史记录的同时将单个文件从一个 SVN 存储库迁移到另一个存储库？

> ID：463746
> 
> 赞同：5
> 
> 时间：2009-01-21T00:56:48.210
> 
> 标签：svn

我在我的个人 SVN 存储库中启动了一个小应用程序。它获得了足够的兴趣，值得将开发转移到共享组存储库。可以将包含其历史记录的应用程序（仅单个文件）迁移到组存储库吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T01:47:01.977

查看“svnadmin 转储”、“svnadmin 加载”和“svndumpfilter”

[http://svnbook.red-bean.com/nightly/en/svn.reposadmin.maint.html#svn.reposadmin.maint.migrate](http://svnbook.red-bean.com/nightly/en/svn.reposadmin.maint.html#svn.reposadmin.maint.migrate)

使用要移动的文件转储存储库，使用 svndumpfilter 仅过滤掉该文件的路径，然后将过滤后的转储加载到共享存储库中。

# asp.net - 负载平衡的 ASP.NET 应用程序的文件存储的最佳解决方案是什么？

> ID：463757
> 
> 赞同：10
> 
> 时间：2009-01-21T01:01:08.357
> 
> 标签：asp.net, sql-server, file, infrastructure

我们有一个 ASP.NET 文件传递​​应用程序（内部用户上传，外部用户下载），我想知道分发文件的最佳方法是什么，这样我们就不会出现单点故障，只需将应用程序的文件存储在一个服务器。我们将应用程序的负载分布在多个前端 Web 服务器上，这意味着对于文件存储，我们不能简单地将文件本地存储在 Web 服务器上。

我们当前的设置让我们指向主数据库/文件服务器上的共享。我们一整天都在将主服务器上共享的内容复制到故障转移中。此场景可确保我们拥有一台具有相当最新数据的辅助计算机，但我们希望能够从主计算机故障转移到故障转移并再次返回，而不会丢失数据或前端应用程序中出现错误。现在这是一个相当手动的过程。

可能的解决方案包括：

*   机械复制。很简单，但它不容易让您在没有多个作业一直运行的情况下再次进行故障转移（来回复制数据）
*   将文件存储在 SQL Server 2005 中的 BLOB 中。我认为这可能是一个性能问题，尤其是对于大文件。
*   [在 SQL Server 2008 中](http://blogs.technet.com/dataplatforminsider/archive/2008/04/14/sql-server-2008-makes-it-easy-to-manage-blobs-and-files.aspx)使用FILESTREAM 类型。我们镜像我们的数据库，所以这看起来很有希望。有人对此有经验吗？
*   [微软的分布式文件系统](http://technet.microsoft.com/en-us/library/cc738688.aspx)。由于我们只有 2 台服务器要管理，因此从我所读到的内容看来有点矫枉过正。

那么您通常如何解决这个问题，最好的解决方案是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T05:51:46.273

考虑一个像[AWS S3](http://aws.amazon.com/s3/)这样的云解决方案。它为您所用、可扩展且具有高可用性而付费。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T02:12:58.740

您需要一个带有 RAID 的 SAN。他们为正常运行时间制造这些机器。

这真的是一个IT问题......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T02:17:26.690

当有多种不同的应用程序类型通过中央数据库共享信息时，将文件内容直接存储到数据库中通常是一个好主意。但您的系统设计中似乎只有一种类型——Web 应用程序。如果只是需要访问文件的 Web 服务器，而没有其他应用程序与数据库交互，则存储在文件系统而不是数据库中通常仍然是一种更好的方法。当然，这实际上取决于系统的复杂要求。

如果您不认为 DFS 是一种可行的方法，您可能希望考虑[文件服务器层的故障转移集群](http://technet.microsoft.com/en-us/magazine/2008.07.failover.aspx)，从而您的文件存储在外部共享存储中（不是昂贵的 SAN，我认为这对于您的情况来说是多余的，因为 DFS已经超出您的范围）在主动和被动文件服务器之间连接。如果主动文件服务器出现故障，被动文件服务器可能会接管并继续读取/写入共享存储。对于这种情况（根据文章），Windows 2008 群集磁盘驱动程序已比 Windows 2003 进行了改进，这表明需要支持 SCSI-3 (PR) 命令的存储解决方案。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T15:48:30.343

DFS 可能是最简单的设置解决方案，尽管根据您的网络的可靠性，它有时可能会变得不同步，这需要您断开链接并重新同步，说实话这很痛苦。

鉴于上述情况，我倾向于使用 SQL Server 存储解决方案，因为这会降低而不是增加系统的复杂性。

先做一些测试，看看性能是否会成为问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T01:10:27.883

我同意[Omar Al Zabir](http://msmvps.com/blogs/omar/archive/2008/12/10/99-99-available-asp-net-and-sql-server-saas-production-architecture.aspx)关于高可用性网站的观点：

> 做：使用存储区域网络 (SAN)
> 
> 原因：性能、可扩展性、可靠性和可扩展性。SAN 是终极存储解决方案。SAN 是一个巨大的盒子，里面运行着数百个磁盘。它有许多磁盘控制器、许多数据通道、许多高速缓存。您在 RAID 配置方面拥有最大的灵活性，可以在 RAID 中添加任意数量的磁盘，在多个 RAID 配置中共享磁盘等等。与放置在服务器中的常规控制器相比，SAN 具有更快的磁盘控制器、更多的并行处理能力和更多的磁盘缓存。因此，当您在本地磁盘上使用 SAN 时，您可以获得更好的磁盘吞吐量。您可以在应用程序运行和使用音量时即时增加和减少音量。SAN 可以自动镜像磁盘，并且在磁盘发生故障时，

[完整的文章](http://www.codeproject.com/KB/aspnet/ProdArch.aspx)在 CodeProject。

因为我个人现在没有 SAN 的预算，所以我依赖您帖子中的选项 1（ROBOCOPY）。但是我保存的文件不是唯一的，如果它们因某种原因死亡，可以自动重新创建，因此在我的情况下绝对容错是必要的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T02:02:42.710

我想这取决于您将看到的下载量类型。我成功地将文件存储在 SQL Server 2005 Image 列中。我们没有看到对这些文件的大量需求，因此在我们的特定情况下，性能真的不是什么大问题。

将文件存储在数据库中的好处之一是它使灾难恢复变得轻而易举。管理文件权限也变得更加容易，因为我们可以在数据库上管理它。

Windows Server 有一个我不推荐的文件复制服务。我们已经使用了一段时间，它引起了很多头痛。

# indexing - Office iFilter 和嵌入式文档

> ID：463762
> 
> 赞同：-1
> 
> 时间：2009-01-21T01:04:53.903
> 
> 标签：indexing, filter

office iFilter (offfilt.dll) 是否支持从嵌入文档（即 Excel 电子表格或 Word 中的 PowerPoint）中提取内容？如果没有，你知道其他 iFilter 是否有吗？

谢谢，凯莎

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-01-26T20:29:58.147

确保在初始化时将搜索链接标志应用于 IFilter。

IFILTER_INIT iflags = IFILTER_INIT.SEARCH_LINKS;

# mysql - MySQL 中的 UNIQUE 索引是否区分大小写？

> ID：463764
> 
> 赞同：53
> 
> 时间：2009-01-21T01:06:41.450
> 
> 标签：mysql, indexing, key, unique, case-sensitive

索引*（索引）*是否在 MySQL 中定义为 UNIQUE 区分大小写？

* * *

## 回答 #1

> 赞同：88
> 
> 时间：2009-01-21T01:13:04.620

这取决于字段的[排序规则](https://dev.mysql.com/doc/refman/8.0/en/charset.html)- 如果是`ci`（不区分大小写）或`cs`（区分大小写）。唯一索引将相应地应用。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2013-06-28T16:19:05.737

您可以使用此语法使列区分大小写。唯一索引也将区分大小写。

> ALTER TABLE tbl_name MODIFY
> col_name column_definition
> [CHARACTER SET charset_name]
> [COLLATE collat​​ion_name]

例子：

```
ALTER TABLE `tablename` MODIFY
`column` VARCHAR(100) 
CHARACTER SET utf8
COLLATE utf8_bin; 
```

**注意：** utf8_bin 通过字符串中每个字符的二进制值来比较字符串。

在 Msql 5.5.X 上测试

# ruby-on-rails - Ruby on Rails 的最佳论坛资源是什么？

> ID：463767
> 
> 赞同：0
> 
> 时间：2009-01-21T01:07:09.920
> 
> 标签：ruby-on-rails, ruby

过去，我使用 RailsForum.com 作为资源，但最近我遇到了太多垃圾邮件，而没有足够有用的帖子。当然只是我的观点。

那么，你们 Rails 开发人员使用什么作为平台的论坛资源？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T01:49:15.700

使用堆栈溢出。我已经停止使用我曾经需要的所有电子邮件列表和论坛。这个网站已经达到了临界质量，所以除非你处理一些非常晦涩的技术，否则我发现我在这里比其他任何地方都能更快地得到答案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T01:21:21.483

官方的[Ruby On Rails Talk](http://groups.google.com/group/rubyonrails-talk)邮件列表是讨论的好地方。我也倾向于带着我的问题去`#rubyonrails`irc.freenode.net 上的 irc 频道。那里往往有很多乐于助人的人。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T07:46:22.797

我从来没有遇到过 railsforum.com 的问题，但我倾向于使用谷歌关键字来解决我遇到的任何问题。有很多在线 Rails 文档，这个系统往往会产生不错的结果。

此外，当您遇到问题时，请考虑浏览 Rails api。我发现那里有更多我知道的数据，而且当我经常这样做时，我的许多问题甚至在它们发展之前就已经解决了。

# windows - 为开源桌面应用程序加密磁盘上的密码

> ID：463768
> 
> 赞同：3
> 
> 时间：2009-01-21T01:07:19.263
> 
> 标签：windows, security, encryption, passwords, password-storage

是否可以在本地系统 (Windows XP) 上存储只能由应用程序本身访问的密码？

我本能的回答是“不”。即使使用了某种散列或加密，我认为只要源代码可用，那么确定的搜索者总是可以使用它来检索密码。

我正在从事一个个人开源爱好项目，我想在该项目中为用户提供将密码存储在磁盘上的选项，这样他们就不需要在每次使用该软件时都输入密码。可以存储的密码的一个示例是用于在其网络的代理服务器上进行身份验证的密码。

这里有一些关于 Stack Overflow 的相关问题，最合适的解决方案听起来像是使用像 DPAPI 这样的操作系统服务。

只要密码可以在没有任何用户输入的情况下由软件检索，并且源代码是开源的，那么基本前提是否正确？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T01:13:34.243

您可以在此处阅读有关 Pidgin 开发人员的看法：[纯文本密码](http://developer.pidgin.im/wiki/PlainTextPasswords)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T01:15:32.943

如果无需任何用户输入即可通过软件检索密码，则密码将始终可由（适当的技术上和故意倾向的）路人检索。开源或封闭源代码只会影响所涉及的工作量。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T01:15:45.800

在 UserData 模式下使用 DPAPI 将只允许您计算机上的帐户访问加密数据。

它会根据您的登录凭据生成一个主密钥，并将其用于加密。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T01:16:40.710

当然，您可以编写一个程序来安全地存储密码。

使用 AES，您可以让您的程序生成一个 AES 密钥，并将该密钥存储在操作系统的保护区中。在 WinXP 中，这是注册表，使用 DPAPI 加密。因此，访问密钥的唯一方法是对机器进行物理访问。

您需要确保在生成 AES 密钥时以加密安全的方式进行。仅使用 RAND 不起作用，也不会生成随机字符串。

开源与安全性关系不大（在我看来）。鉴于逆向工程源代码工具的复杂程度，即使你有一个封闭源代码解决方案，决心窥探你的代码的人也可以这样做。

最好花些精力确保在使用所选加密方案时遵循最佳实践指南。我认为让更大的社区公开查看您的代码实际上会使您的代码更安全。随着更多的观众浏览您的代码，可能会更快地发现漏洞和威胁。

# windows - Windows 上的 Clojure IDE？

> ID：463776
> 
> 赞同：44
> 
> 时间：2009-01-21T01:10:14.860
> 
> 标签：windows, ide, clojure

您如何在 Windows 系统上使用 Clojure 进行开发？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-21T09:19:44.607

我个人使用 emacs 是因为我觉得没有其他 IDE 适合 sexpression 语言。Swank/slime/emacs/clojure 就是这样一个强大的 repl 设置，我觉得没有别的合适的了。如果您希望轻松设置（假设您尚未设置 emacs），请查看 clojurebox

[https://github.com/devinus/clojure-box](https://github.com/devinus/clojure-box)

预配置为在运行安装程序后仅在 Windows 上工作。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-01-21T01:34:55.480

[在网站上，您开始](http://clojure.org/getting_started)阅读的第一件事就是列出您当前的所有选项。有一个[netbeans 插件](http://enclojure.org/)，[emacs 模式](http://groups.google.com/group/clojure/msg/4a920f3b1d5d9234)和[vim 语法](http://repo.or.cz/w/clojure-patches.git?a=blob_plain;f=vim/clojure.vim;hb=HEAD)高亮。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-01-22T13:25:18.277

这里还有一个eclipse插件：[http ://code.google.com/p/counteritarian/](http://code.google.com/p/counterclockwise/)

**编辑：**根据 js 的评论更改链接

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-02-18T11:36:57.650

[Enclojure](http://Enclojure.org)（在 Netbeans 中）现已发布并且在 Windows 上运行良好。

[VimClojure](http://kotka.de/projects/clojure/vimclojure.html)是一个很好的轻量级解决方案。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-01-30T07:24:19.780

我不。我正在等待 Enclojure 的发布，它是修复一些 Windows 问题的 netbeans 插件。

更新：我现在做，Enclojure ROCKS！:D

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2012-09-10T16:47:43.403

另一个正在开发的有趣 IDE 是通过 Kickstarter.com 资助的项目，Light Table IDE： [http ://app.kodowa.com/playground](http://app.kodowa.com/playground)

IDE 深受[Bret Victor](http://worrydream.com/)在 CUSEC 2012 上提出的概念的启发：[Inventing on Principle](http://vimeo.com/36579366)

Chris Granger 深受 Bret 的想法的启发，因此他迅速[为新的 Clojure](http://www.chris-granger.com/2012/04/12/light-table---a-new-ide-concept/) IDE 进行了概念验证，他称之为 Light Table。该项目[通过 Kickstarter 获得了 30 万美元的资金](http://www.kickstarter.com/projects/306316578/light-table)，并且可以通过项目游乐场获得 IDE 的早期版本。如果您的系统上安装了 Java 和 Chrome，安装就像一次下载并单击一样简单。

IDE 处于非常早期的阶段，但具有一些非常独特的功能，尤其是右侧面板中代码的“实时”视图。检查在 Chrome 中运行的 Light Table 的屏幕截图：

![在 Windows 上的 Chrome 浏览器中运行的 Light Table IDE](https://i.stack.imgur.com/gqY4a.png)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-06-21T17:00:26.160

过去两个月我一直在试验 Clojure，在我的学习过程中我使用了几个应用程序。

所以，我做了一个包，希望把它分享给所有想学习 Clojure 的人。现有的 Clojure Box 有什么问题？好吧……什么都没有；但是如果你和我一样，想避免在像 emacs 这样的新 ide（对我来说）中学习新编程语言的复杂性，你可能会发现这个包很有用。

您有一个自定义版本的 scite，一个名为 WinCommand 的应用程序，可以更舒适地使用 Clojure repl 和 JSwat 来调试您的代码。

请记住，WinCommand 是使用 .Net 框架（VS 2008）开发的，但它是在 4 到 5 年前开发的，我的编程技能不是最好的，所以如果你找到可以修复的东西，你可以建议我。

试一试，让我知道您对此有何看法！

啊……jejeje……嗯……如果你想下载它，你可以在这里找到： [http ://sites.google.com/site/dariomac/Home/projects](http://sites.google.com/site/dariomac/Home/projects)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-05-03T23:40:00.417

Jetbrains 最近发布了“La Clojure”，这是一个 Clojure 插件，用于他们已经非常出色（但商业化）的 Java IDE IntelliJ IDEA。安装 IDEA 后，您可以从插件管理器安装插件，或从[插件网站下载。](http://plugins.intellij.net/plugin/?id=4050)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-04-12T22:03:40.993

我尝试使用[VimClojure](http://www.vim.org/scripts/script.php?script_id=2501)，但发现它没有吸引力。我是一个 Vim 人，但我必须在尝试之前编译我的编辑器的想法绝对不是我想要的。作者说他不再关心 Windows 支持这一事实增加了我使用它的欲望。最重要的是，文档很差。

我被[ClojureBox](http://clojure.bighugh.com/)所吸引，它是一个易于使用的安装程序中的 Clojure 和 Emacs。也许是时候再给 Emacs 一个机会了。它出现在 REPL 中。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-07-10T12:19:57.023

[Clooj](https://github.com/arthuredelstein/clooj/)很适合学习。可能不是用于实际开发的实用 IDE（为此我会使用 Emacs），但它是无需复杂设置即可开始的完美方式。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-04-21T07:22:13.097

如果有人像我一样不熟悉clojure。Intellij + Cursive 似乎对新手非常友好。链接：[https ://cursive-ide.com/](https://cursive-ide.com/)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-03-13T15:41:54.010

我使用 Lighttable 开发 Clojure 应用程序。它非常棒！我会推荐。

# delphi - Delphi，可以仅将表单模式化为特定的父表单吗？

> ID：463778
> 
> 赞同：11
> 
> 时间：2009-01-21T01:10:29.477
> 
> 标签：delphi, forms, modal-dialog

我有一个应用程序，其中有一个主背景表单，用户只能从那里维护系统不同部分的非模态表单。非模态表单会覆盖 CreateParams 方法，因此每个表单都会在开始任务栏中显示一个按钮：

```
procedure TfmMaterialsPlanning.CreateParams(var Params: TCreateParams);
begin
   inherited;
   //create a new window on the task bar when this form is created
   Params.ExStyle := Params.ExStyle or WS_EX_APPWINDOW;
end; 
```

实际上，用户可以打开一个维护“Apples”的非模态表单，另一个维护“Oranges”的非模态表单，并使用开始菜单栏在两者之间轻松切换。

但是，如果他们从“Apples”表单打开一个模态表单，例如设置选项、偏好等，那么他们在关闭该模态表单之前不能使用“Oranges”表单。

是否可以仅将模态表单模态到父表单？那么如果他们打开苹果的选项表，他们就不能使用苹果的维护表，但仍然可以使用橙子的维护表？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T08:06:07.000

如果您查看 TCustomForm.ShowModal() 的源代码，您将看到 VCL 不使用 Windows API 调用来显示模态对话框，而是在模态表单显示时禁用应用程序中的所有其他表单显示。您当然可以尝试同样的方法，只需 Show() 表单模式对话框，然后禁用父级，然后在表单模式对话框关闭后重新启用它。需要有一个中心位置来跟踪表单模式对话框、需要重新启用的表单等。但是，即使在应用程序之间来回切换、最小化应用程序等时，您也应该彻底测试代码是否确实按照您的意愿执行。

话虽如此 - 我认为这根本不是一个好主意。它打破了 Windows 用户对应用程序行为所做的所有假设。与 Mac OS X 不同，Windows 中应用程序模式对话框和表单模式对话框之间没有区别，您应该坚持与您正在编程的平台一致的行为。

很可能有更好的方式来构建你的 UI。查看“Windows 用户体验交互指南”中[对话框的相关页面。](http://msdn.microsoft.com/en-us/library/aa511268.aspx)最好尽可能避免模态对话框，链接的指南显示了许多用例的更好选择。如果您限制使用模态对话框，也许您不再需要表单模态对话框。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-09-15T15:56:12.287

这篇文章有一个很好的技巧来满足您的需求：http: [//blogs.teamb.com/deepakshenoy/2006/08/21/26864](http://blogs.teamb.com/deepakshenoy/2006/08/21/26864)

摘要是在模态窗口禁用它时重新启用您想要的非模态窗口。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T09:09:45.360

顺便说一句（尽管这将是大量工作），解决这个问题的另一种方法是 Google 的 chrome 的方式，其中每个“选项卡”都是一个单独的进程，但在用户看来是一个单独的集成应用程序。

即使这种方法可以实现您想要的，我也必须同意上面的评论，即这会打破用户对模态行为的假设和期望。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T03:10:22.463

您不能通过阻止“Apples”表单在其子表单打开时接受焦点来达到相同的效果吗？

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-01-21T08:02:31.937

如果您在自己的线程中创建每个非模态表单，这是可能的。然后每个模态表单将阻塞它所属的线程。

编辑：这应该是可能的，即使 vcl 不是线程安全的。请看一下[Alexeys 对](http://www.aldyn.ru/demos/0003/4.html) 如何做到这一点的解释：

> 因此，如果您有一组应该存在于单独线程中的表单，则将它们放入一个 dll 中，在没有包的情况下编译并使用！它会工作并且是线程安全的。

# deployment - 在敏捷环境中部署

> ID：463781
> 
> 赞同：0
> 
> 时间：2009-01-21T01:12:05.480
> 
> 标签：deployment, vb6, agile

过去，我的开发团队主要针对现有应用程序进行瀑布式开发，并且部署仅在发布结束时才真正完成，这通常会导致 TEST、UAT、PROD 版本通常仅包含两份中的三到五个版本月周期。

一个版本是一个 MSI 安装程序，通过组策略部署。

我们现在已经转向更敏捷的方法，要求每天至少发布一次测试，有时甚至更频繁。

该应用程序是一个 VB6 应用程序，MSI 为我们处理 COM 注册，用户在他们的机器上没有提升的权限。

**有没有人有更好的快速部署解决方案？**

我们考虑了 MSI 的批处理/脚本安装，或者对每个文件进行 COM 注册，两者都使用[CPAU](http://www.joeware.net/freetools/tools/cpau/)来提升权限，以及 ClickOnce。这些都没有经过测试。

编辑：感谢您的建议。澄清一下，我的痛点是 MSI 构建/部署过程需要很长时间，可能需要长达两个小时才能将新构建放到测试人员的桌面上。测试人员在他们的机器上没有管理员权限（也不会得到它们），所以我正在寻找更好的解决方案。

我玩过 ClickOnce，使用启动应用程序并将所有 OCX/DLL vb6 程序集作为独立依赖项的 dot net 包装器，但这在启动时查找所有程序集或消息时遇到问题。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-30T16:55:13.323

CruiseControl 和 Nant 可能是您构建具有灵活输出的最佳选择。但是快速部署？

我担心的是您以错误的方式查看每日构建。日报不需要广泛部署。事实上，QA 和开发是唯一应该关心日常构建的人。即使那样，开发人员也不应该不同步；）。

客户团队应该只在迭代结束时接收构建。在那里你向他们展示你所做的事情，他们提供反馈，你从那里继续前进。每天给他们构建可能会导致恶性颠簸，从而降低您的速度。

话虽如此，一个好的部署包可能对 QA 有好处。但同样，这取决于它们与您的开发迭代的同步程度。无论对错，我的经验是，QA 是一次迭代，对上一次迭代的可交付成果进行回溯测试。从这个角度来看，他们也应该使用最后一个“稳定”版本进行测试。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-03T05:34:46.253

这是您可以在虚拟机中执行的操作吗？您可以安全地授予测试人员对虚拟化系统的管理权限，并且大多数虚拟化软件都有某种形式的版本控制，因此如果出现问题，您可以回滚到“良好”状态。我发现它对测试非常有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T01:16:37.013

我建议 ClickOnce 带有在执行时更新的选项。这样，只有使用该软件的人才能接收和安装更新。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T18:17:42.257

您可以尝试无注册表的 COM。请参阅[另一个问题](https://stackoverflow.com/questions/270523/vb6-xcopy-deployment)。ActiveX EXE 仍然需要注册。

编辑：澄清一下，使用无注册表 COM 意味着您提到的 OCX/DLL 组件不需要注册。他们也不使用任何 OCX/DLL 组件。您只需将整个应用程序目录复制到测试人员的机器上，它就会立即运行。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-05T08:59:05.857

如果我正确理解您的问题，您需要管理员权限才能安装您的产品。我看到三个选项：

1) 不要安装到测试人员的桌面上。获取一些可以安全地授予他们管理员权限的划痕测试机器（如 dmo 建议的那样，VMWare 可能会有所帮助）。这可能意味着给他们一个测试域和他们自己的组策略来编辑。

2）构建一个不需要安装MSI的变体，可以直接执行。显然，您的测试人员不会使用此变体测试部署和安装过程，但他们可以执行产品功能的其他测试。我不知道您的产品是否可以做到这一点；这肯定会奏效。

3）服用你的敏捷药物：“[更喜欢]响应变化而不是遵循计划”。也就是说，如果拒绝授予测试人员管理员权限会干扰他们有效地完成工作的能力，那么请挑战组织授予他们管理员权限。（根据经验，这将意味着转移到＃1，但这可能是证明这一点的最佳方式）。如果期望他们测试产品，他们怎么可能不被允许以与客户相同的方式安装它？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-06T00:20:51.470

如果 MSI 部署使敏捷测试失去了速度，那么您应该减少测试 MSI 部署的频率。

尽可能使用 XCOPY 部署，对 COM 组件使用 .local。这可能是第三方组件的问题。由于第三方组件相当稳定，您应该能够为这些组件构建自定义 MSI，安装一次即可完成。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-30T06:23:06.970

您应该尝试可以手动运行的自动构建/部署过程或脚本。试试 Teamcity 或 CruiseControl。祝你好运！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-01T22:17:58.117

我不确定你的痛点是什么。

*   您特别提到了 VB6 COM 对象的注册。安装程序有时会因此而失败吗？
*   是不是安装程序可以工作，但人们不知道安装新版本，所以他们经常报告旧版本的错误？

如果是前者，那么我怀疑问题在于 VB6 在重建解决方案时很可能会使用 GUID 玩水果篮周转。尝试在 MIDL 中重新创建您的公共接口并让您的 VB6 类实现这些接口。

如果是后者，那就试试微软的[短信](http://www.microsoft.com/SMServer/default.mspx)产品。不，这与手机无关。如果所有用户不在同一个域中，那么您将不得不在您的产品中构建“自动更新”功能。这是我听说过但从未使用过的[第三方产品。](http://www.powerprogrammer.co.uk/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-06T00:29:30.377

我正在为我的所有构建使用**SetupBuilder** ( [http://setupbuilder.com/products_setupbuilder_pro.htm](http://setupbuilder.com/products_setupbuilder_pro.htm) )。非常可扩展。优秀的支持。

不确定它是否完全符合您的需求，但论坛上的此类帖子“在 XP 上以受限帐户用户（非管理员）身份安装”（[http://www.lindersoft.com/forums/showthread.php? t=11891&highlight=admin+rights](http://www.lindersoft.com/forums/showthread.php?t=11891&highlight=admin+rights)），让我觉得可能是这样。

# html - 使用 CSS 在上方放置单选按钮标签

> ID：463785
> 
> 赞同：7
> 
> 时间：2009-01-21T01:13:20.453
> 
> 标签：html, css, radio-button

我需要能够将单选按钮的标签放置在选项上方，而不是左侧或右侧。有没有办法使用 CSS 来产生这种效果？

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-22T17:50:41.063

我想我知道你在找什么，但如果我错过了标记，请纠正我。我假设您希望单选按钮在其标签下方居中。`<br>`如果您可以将s 添加到标记中，这会容易得多。

```
label {
  float: left;
  padding: 0 1em;
  text-align: center;
}
```

```
<label for="myChoice1">Choice 1<br />
  <input type="radio" id="myChoice1" name="myChoice" value="1" />
</label>

<label for="myChoice2">Choice ABC<br />
  <input type="radio" id="myChoice2" name="myChoice" value="ABC" />
</label>

<label for="myChoice3">Choice qwerty<br />
  <input type="radio" id="myChoice3" name="myChoice" value="qwerty" />
</label>

<label for="myChoice4">Choice--final<br />
  <input type="radio" id="myChoice4" name="myChoice" value="final" />
</label>
```

...然后使用您自己的清除方法移动到下一行。

（在这里使用 s 中的`for`属性`<label>`有点多余，但不会有什么坏处。）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-21T01:17:21.553

而不是以下内容：

```
<label>Label <input type="radio" id="val" name="val" value="hello"></label> 
```

您可以使用它并分别设置两者的样式：

```
<label for="val">Label</label>
<input type="radio" id="val" name="val" value="hello"> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-22T14:01:04.787

如果没有确切地看到您要使用的布局，我无法更具体，但如果您只想获得单选按钮上方的标签，请在单选按钮上使用 display:block 。（显然，这只是作为示例内联）

```
<label>Label <input style="display:block;" type="radio" id="val" name="val" value="hello" /></label> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T01:14:55.207

所以我知道这不是您正在寻找的答案，但是看到这种类型的布局我会感到困惑。这不是标准的，它会让我失望。只是我的 0.02 美元。

# javascript - 在 JavaScript 中为 Unicode 值调用 Asc() 和 Chr() 的简单方法是什么？

> ID：463786
> 
> 赞同：49
> 
> 时间：2009-01-21T01:13:23.010
> 
> 标签：javascript, unicode

我对 Javascript 不是很熟悉，并且正在寻找返回字符的 UNICODE 值的函数，并在给定 UNICODE 值的情况下返回等效的字符串。我敢肯定有一些简单的东西，但我没有看到。

例子：

*   ASC("A") = 65
*   CHR（65）=“A”
*   ASC("ਔ") = 2580
*   CHR(2580) = "ਔ"

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-01-21T01:25:17.607

看一下：

```
String.fromCharCode(64) 
```

和

```
String.charCodeAt(0) 
```

第一个必须在 String**类**（字面意思`String.fromCharCode...`）上调用，并将返回“@”（表示 64）。第二个应该在 String**实例**（例如，`"@@@".charCodeAt...`）上运行并返回第一个字符的 Unicode 代码（'0' 是字符串中的一个位置，您可以通过将其更改为另一个来获取字符串中其他字符的代码数字）。

脚本片段：

```
document.write("Unicode for character ਔ is: " + "ਔ".charCodeAt(0) + "<br />");
document.write("Character 2580 is " + String.fromCharCode(2580) + "<br />"); 
```

给出：

```
字符 ਔ 的 Unicode 为：2580
字符 2580 是ਔ

```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-02-02T14:46:31.230

由于[JavaScript 在内部使用 UCS-2](http://mathiasbynens.be/notes/javascript-encoding)，`String.fromCharCode(codePoint)`因此不适用于补充 Unicode 字符。例如，如果`codePoint`是`119558`( `0x1D306`, 表示`''`字符)。

如果要基于非 BMP Unicode 码位创建字符串，可以使用[Punycode.js](http://mths.be/punycode)的实用函数在 UCS-2 字符串和 UTF-16 码位之间进行转换：

```
// `String.fromCharCode` replacement that doesn’t make you enter the surrogate halves separately
punycode.ucs2.encode([0x1d306]); // ''
punycode.ucs2.encode([119558]); // ''
punycode.ucs2.encode([97, 98, 99]); // 'abc' 
```

如果要获取字符串中每个字符的 Unicode 代码点，则需要将 UCS-2 字符串转换为 UTF-16 代码点数组（其中每个代理对形成一个代码点）。您可以为此使用[Punycode.js](http://mths.be/punycode)的实用程序函数：

```
punycode.ucs2.decode('abc'); // [97, 98, 99]
punycode.ucs2.decode(''); // [119558] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-10-11T09:43:45.840

此处生成字母数组的示例：

```
const arr = [];
for(var i = 0; i< 20; i++) {
    arr.push( String.fromCharCode('A'.charCodeAt(0) + i) )
} 
```

# sql-server - 在 subversion 中安装 sql 脚本后如何管理运行？

> ID：463790
> 
> 赞同：1
> 
> 时间：2009-01-21T01:14:24.583
> 
> 标签：sql-server, svn

我在一家公司工作，该公司每年都会发布多个生产版本，并且在构建每个版本的过程中，我们收集了 1 次 sql 安装脚本的集合，例如表创建和数据端口。

目前的工作方式是，在发布到生产环境之后，我们进行分支、标记，然后从 subversion 中删除所有 1 次脚本。

这似乎完成了工作，但对我来说，这似乎从来都不是解决问题的正确方法。

你能想象每次发布都删除所有源代码，然后为生产编写补丁吗？

我看到的缺点是，如果您想引用旧脚本，则必须从 subversion 签出标签或分支。

我们的 SVN Repo 目前看起来像这样

svnrepo/mywebsite/src svnrepo/mywebsite/database/storedprocs svnrepo/mywebsite/database/installscripts

我在想一种更准确的方法来模拟我们想要在 SVN 中做的事情如下。

使用 svn:externals 属性指向最新版本。然后在每次发布后将其指向最新版本。

svnrepo/mywebsite/trunk/src/svnrepo/mywebsite/trunk/src/database/installscripts/ -> svnrepo/mywebsite/trunk/database/Release_3

svnrepo/mywebsite/trunk/database/Release_1 svnrepo/mywebsite/trunk/database/Release_2 svnrepo/mywebsite/trunk/database/Release_3

使用此模型，我们不再 svn 删除任何 sql 脚本，并使数据库开发人员能够检查 svnrepo/mywebsite/trunk/database/ 并轻松查看所有已发生的数据库开发。

对我的想法、当前结构或管理这种情况的最佳方法有任何评论吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T10:18:17.933

在 subversion 中同步数据库更改和代码更改很难

如果您可以选择从头开始构建数据库，您可以将整个 DDL 与代码一起放入存储库中，那么您无需担心哪些更改会随哪个版本发布。

看看你的情况，我认为你不需要使用外部设备（它们会导致头痛）。您也不需要删除所有内容。签出分支并不难（或者您可以只使用存储库浏览器）。

您甚至可以在发布时将旧的数据库版本放入一个单独的标签中，这样它们就都在一个地方，数据库人员可以检查出来。如果您每年发布一次，这并不难。

[这个问题也可能有帮助](https://stackoverflow.com/questions/173/how-do-i-version-my-ms-sql-database-in-svn)

# regex - 是否有一个很好的基于浏览器的沙箱来练习正则表达式？

> ID：463796
> 
> 赞同：24
> 
> 时间：2009-01-21T01:15:42.850
> 
> 标签：regex, sandbox

我正在寻找基于浏览器的正则表达式沙箱的建议，以练习一些概念证明表达式。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-21T01:19:55.727

我已经使用了几次[http://www.rubular.com/ ，似乎可以完成这项工作。](http://www.rubular.com/)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-21T01:26:17.743

我喜欢[RegExpal.com](http://regexpal.com)。祝你好运。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-21T01:35:02.717

这个也不错：[RegExr](http://gskinner.com/RegExr/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T07:14:53.140

哪种口味？目前使用的大多数主要编程语言、编辑器和 IDE、grep 和 findstr 等命令行工具以及许多其他地方都包含正则表达式支持。这些工具/语言/应用程序中的每一个都有自己的正则表达式风格，没有两种风格是完全一样的。

对于特定编程语言的正则表达式风格，我只是在谷歌搜索“<language> regex tester”；似乎总是至少有一个在线测试仪可用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-04T10:10:25.727

我自己编写了带有匹配和替换功能的正则表达式 (REGEX) 在线测试沙箱，因为我找不到具有替换功能的沙箱。它在 DOT NET (.NET) 引擎下运行。非常适合测试正则表达式模式，但也适合快速和肮脏地重新格式化文本文件和字符串。

[http://regex.cyberpine.com](http://regex.cyberpine.com)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T16:34:41.450

对于几种不同语言、平台和开源应用程序的在线沙箱，请参阅这个类似的 SO[问题](https://stackoverflow.com/questions/204831/how-can-i-try-a-new-language-or-framework-without-installing-it)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-21T01:26:51.347

尝试[NRegEx](http://www.nregex.com/nregex/default.aspx)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-21T02:20:35.263

[http://demo.1060research.com/ep+name@app_regular_expression_cookbook](http://demo.1060research.com/ep+name@app_regular_expression_cookbook)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-04T10:15:10.407

这对于基于 .net 的东西来说相当方便：

[http://regexlib.com/](http://regexlib.com/)

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2012-03-21T07:33:08.603

[http://rgx-extract-replace.appspot.com/](http://rgx-extract-replace.appspot.com/)提供提取和替换功能。

1.  它提取并在列中列出匹配模式的组。
2.  可选地，它可以替换输入文本中的模式。它的工作方式与 Java regex api 相同。

* * *

## 回答 #11

> 赞同：-3
> 
> 时间：2009-07-13T20:52:40.277

我当然有偏见，因为我写了它。但是有一个很好的 .NET 正则表达式，称为[Regex Hero](http://regexhero.net/)。

# entity-framework - 实体框架：如果值没有变化，则取消属性更改

> ID：463799
> 
> 赞同：5
> 
> 时间：2009-01-21T01:16:08.247
> 
> 标签：entity-framework

在实体对象上设置属性时，它会将值保存到数据库中，即使该值与以前完全相同。有没有办法防止这种情况发生？

例子：

如果我加载一个电影对象并且标题是“A”，如果我再次将标题设置为“A”并且 SaveChanges() 我希望我不会在 SqlProfiler 中看到 UPDATE 语句，但我是。有没有办法阻止这一切？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-21T13:31:54.423

是的，你可以改变这个。但是，在实体框架的当前版本中，这样做并非易事。将来会变得更容易。

您看到此行为的原因是实体模型的默认代码生成。这是一个有代表性的例子：

```
public global::System.Guid Id
{
    get
    {
        return this._Id;
    }
    set
    {
        // always!
        this.OnIdChanging(value);
        this.ReportPropertyChanging("Id");
        this._Id = global::System.Data.Objects.DataClasses
                               .StructuralObject.SetValidValue(value);
        this.ReportPropertyChanged("Id");
        this.OnIdChanged();
    }
}
private global::System.Guid _Id;
partial void OnIdChanging(global::System.Guid value);
partial void OnIdChanged(); 
```

此默认代码生成是合理的，因为实体框架不知道您打算如何使用这些值的语义。属性中的类型可能具有可比性，也可能不具有可比性，即使它们是可比的，框架也无法知道您打算如何在所有情况下使用引用相等与值相等。对于像十进制这样的某些值类型，这很清楚，但在一般意义上它并不明显。

另一方面，您知道您的代码，并且可以对其进行一些自定义。麻烦的是这是生成的代码，所以不能直接进去编辑。您需要接管代码生成，或者使其变得不必要。那么让我们来看看这三个选项。

## 接管代码生成

此处的基本方法是创建一个 T4 模板，该模板执行后面的代码，并从 Entity Framework 生成默认代码。[这是一个例子。](http://blogs.rev-net.com/ddewinter/2008/04/26/entity-framework-stored-procedure-generation/ "实体框架存储过程生成")这种方法的一个优点是[实体框架将在下一个版本中迁移到 T4 代](http://weblogs.asp.net/vga/archive/2008/10/29/entity-framework-to-adopt-t4-for-code-generation-in-v2.aspx)，因此您的模板可能在未来的版本中运行良好。

## 消除代码生成

第二种方法是完全消除热电联产，并[通过 IPOCO 手动进行变更跟踪支持](http://www.sitechno.com/Blog/IntroducingEntityFrameworkContribEasyIPocoImplementationV01.aspx)。使用这种方法，您无需更改代码的生成方式，根本无需进行任何代码生成，而是通过实现多个接口为实体框架提供更改跟踪支持。有关更多详细信息，请参阅链接的帖子。

## 等待

另一种选择是暂时使用实体框架，并等到下一个版本获得您想要的行为。[实体框架的下一个版本将默认使用 T4](http://blogs.msdn.com/efdesign/archive/2009/01/22/customizing-entity-classes-with-t4.aspx "http://blogs.msdn.com/efdesign/archive/2009/01/22/customizing-entity-classes-with-t4.aspx")，因此自定义代码生成将非常容易。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-21T01:32:33.580

根据[MSDN](http://msdn.microsoft.com/en-us/library/bb738695.aspx)：

> 每当调用属性设置器时，对象的状态就会从未更改更改为已修改。即使设置的值与当前值相同，也会发生这种情况。调用 AcceptAllChanges 方法后，状态返回到 Unchanged。默认情况下，在 SaveChanges 操作期间调用 AcceptAllChanges。

看起来您需要在更新之前检查 Entity 对象的属性值以防止 UPDATE 语句。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T01:37:57.610

在一般级别上，如果您的实体正在实现 INotifyPropertyChanged，则您不希望在值相同的情况下触发 PropertyChanged 事件。所以每个属性看起来像这样：-

```
 public decimal Value
    {
        get
        {
            return _value;
        }
        set
        {
            if (_value != value)
            {
                _value = value;
                if (_propertyChanged != null) _propertyChanged(this, new PropertyChangedEventArgs("Value"));
            }
        }

    } 
```

希望这与实体框架有关。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-11T20:21:26.997

您可以做的一件事就是使用部分类文件自己包装属性，然后使用您的属性而不是第一个：

```
public sealed partial class MyEFType {
   public string MyWrappedProperty {
      get {
         return MyProperty;
      }
      set {
         if (value == MyProperty)
            return;
         MyProperty = value;
      }
   }
} 
```

*对每个*属性都执行此操作不是很实用，但如果您需要检测特定属性实际上已更改而不仅仅是被写入，则可以使用类似的方法。

# javascript - jQuery $(document).ready() 在 IE6 中失败

> ID：463800
> 
> 赞同：10
> 
> 时间：2009-01-21T01:16:33.660
> 
> 标签：javascript, jquery, internet-explorer-6

我有以下代码：

```
// Creates a timer to check for elements popping into the dom            
timer = setInterval(function ()
{          
    for (p in pixelTypes)
    {                             
        checkElems(pixelTypes[p]);
    }                            
}, 10);

// Add Document finished callback.
$(document).ready(function ()
{         
    // Document is loaded, so stop trying to find new pixels
    clearInterval(timer); 
}); 
```

在 Firefox 中，它运行良好，但在 IE6 中，我在 $(document).ready 行上收到“Object Expected”错误。

我不知道是什么导致 IE6 无法识别它，此时 jquery 已完全加载。

这是一个已知的问题？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2010-02-25T14:42:25.083

给感兴趣的人提几点建议：

`$(document).ready(function() {...});`和`$(function() {...});`意思完全一样。后者是前者的简写。

如果您为大型网站开发，使用多个 Javascript 库，或者您开发旨在与其他人的工作兼容的插件，您不能相信美元符号 ($) 与 jQuery 对象相关联。为了安全起见，请使用以下符号：

```
(function($) { [your code here] })(jQuery); 
```

这会将 jQuery 传递给一个自执行函数，并将 $ 与该函数内的 jQuery 对象相关联。那么 $ 在你的函数之外代表什么并不重要。

回到您的问题，您是否检查过在收到错误时是否分配了计时器变量？我相信浏览器会将`$(document).ready(function() {...});`所有内容视为一行，因此，如果您有某种调试器告诉您这是有问题的行，则可能是计时器变量...

最后一件事：在 Javascript 中，将大括号放在新行上是不正确的。由于 Javascripts 分号插入，这可能会导致非常糟糕的错误。有关更多信息，请阅读 Douglas Crockford 的 Javascript：好的部分：

[http://www.amazon.com/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742/ref=sr_1_1?ie=UTF8&s=books&qid=1267108736&sr=1-1](https://rads.stackoverflow.com/amzn/click/com/0596517742)

无论如何，真的希望我没有让任何人生气。希望你能解决问题！

编辑：我不确定这是否是 robertz 完全限定的意思，但据我所知，当一个 URL 完全限定时，它意味着没有任何部分丢失，即。它是一个以 http:// 或 https:// （或其他协议）开头的绝对 URL。如果我错了，请纠正我！

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-11-19T23:06:43.090

我过去也遇到过同样的问题。这是一个零星的问题，并且很可怕，并且可以重现。

我找到的解决方案是替换`$(document).ready(function() {...});`它`jQuery(function() {...})`，它就像一个魅力！

移动`$(document).ready(function() {...});`到底部不适用于我的用例。

[这篇文章](http://ryanpricemedia.com/2008/03/19/jquery-broken-in-internet-explorer-put-your-documentready-at-the-bottom/)中的评论非常有帮助（我第一次读到关于这样做的地方）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-07-22T03:06:20.210

如果有人有同样的问题，你应该看看当你调用你的 javascripts 时是否有 `type="application/javascript"`，我将其删除并已更正，我认为这是 IE 和类型 Thing 的问题

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T01:21:23.387

你确定 jQuery 已经加载了吗？尝试使用以下警报进行调试：

```
alert(typeof $); 
```

您也可以尝试不同的语法：

```
$(function() {
     clearInterval(timer); 
}); 
```

* * *

好的，所以从您的评论来看，上述内容没有帮助。根据我的经验，“预期对象”错误似乎是由于语法错误而发生的。那是你得到的确切代码吗？如果没有，你能发一下吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-09-29T06:29:23.933

确保您的脚本类型是**text/javascript**

```
<script type='text/javascript' 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-05-24T12:55:52.083

DateTime 选择器在我的本地 XP 测试中工作得很好，但是一旦部署在服务器上，它就会失败“预期对象”。经过 2 天的坚持，这就是我解决问题的方法，在 Javascript 的路径周围添加 Url.Content！

```
<script src="<%= Url.Content("~/Scripts/jquery-1.4.1.min.js") %>" type="text/javascript"></script>

<script src="<%= Url.Content("~/Scripts/ui/minified/jquery.ui.core.min.js") %>" type="text/javascript"></script>  
<script src="<%= Url.Content("~/Scripts/ui/minified/jquery.ui.datepicker.min.js") %>" type="text/javascript"></script> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-18T23:09:30.800

我在我的机器上遇到了这个问题，因为能够找到一个快速修复。这是我所做的：

1.用nickf的建议“alert(typeof $)”调试我的javascript并得到“未定义”的警报消息

2.然后我完全限定了我的 jQuery 脚本资源。

3.重新加载我的页面并收到“功能”警报消息

顺便说一句，我在 XP 上使用 IIS 5.1。我的网站配置为使用“通配符映射”来利用 asp.net mvc 框架。我认为此配置导致链接断开。

有关如何在旧版本的 IIS 上设置 MVC 的更多信息，请查看 Phil Haack 的帖子： [http://haacked.com/archive/2008/11/26/asp.net-mvc-on-iis-6-walkthrough。 aspx](http://haacked.com/archive/2008/11/26/asp.net-mvc-on-iis-6-walkthrough.aspx)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-11-15T16:02:06.307

我有同样的问题，脚本错误通知我对象未定义。我尝试了此处列出的所有建议，但均无济于事。我唯一没有考虑的是安全性，我忘记了我的表单身份验证，结果我忘记了拒绝访问 jQuery 库的脚本文件夹的授权！！！

希望这可以帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-11-23T15:04:09.750

$(document).ready() tells you when the dom is ready, but not all assets are necessarily done coming in.

If you want to make sure all the assets are actually done loading, use **$(window).load()** instead. The most common use for this is to make sure that images are done loading, but it may work for your script problem as well.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-02-25T14:13:48.650

如果它在您的正文元素内的脚本元素中，（即）..

原因可能是您使用脚本标签传递的属性。如果是：

```
<script type="text/javascript">...</script> 
```

IE6 会报错。你应该使用

```
<script language="javascript">...</script> 
```

然后错误消失。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-21T01:19:44.667

我不认为你真的应该像现在这样轮询元素。

一旦浏览器加载到足以让您能够操作页面，文档就绪事件就会调用，因此您应该只在`$(document).ready()`块中进行 DOM 处理。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-21T08:02:18.380

您可以尝试检查文档是否“就绪”的旧 skool 方法...将脚本放在结束 </body> 标记之前 - 我相信它与 jQuery 的“就绪”事件具有相同的效果 - 实际上，它可能这样做更快。

* * *

根据我的经验，IE6 中的“预期对象”错误是由于语法错误而出现的——如果你还没有将脚本放在[JSlint](http://jslint.com/)中，这是值得的……

# netbeans - 可以在 NetBeans 中查看方法/函数文档吗？

> ID：463806
> 
> 赞同：2
> 
> 时间：2009-01-21T01:19:13.263
> 
> 标签：netbeans, ide, documentation

具有 Python 支持的 NetBeans 6.5 在自动完成时在弹出窗口中为函数/方法提供了文档字符串文档，但是还有另一种查看文档字符串的方法吗？

也许通过将鼠标悬停在函数/方法名称上或单击某处来实现？

我似乎能做的最好的事情是右键菜单中的“转到源代码”。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-23T21:17:45.590

我收到了来自 Sun 的 Tor Norbye 的以下答复：

> 按住 ctrl 键（或 Mac 上的 Cmd）然后悬停。
> 
> 此外，Ctrl-Shift-Space（例如代码完成+ shift）将显示-just-完成文档（这意味着它不仅查看插入符号的前缀，还查看整个标识符和左侧类型（如果可以）解决它，计算一个特定的匹配而不是多个）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-14T08:09:10.517

您也可以在 Mac 上使用此键盘快捷键。Shift + Meta + 反斜杠

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-07-14T22:43:02.343

您可能指的**`Show Documentation Popup`**是**Netbeans中的函数**

尝试

**`Ctrl`+ `Shift`+`SPACE`**或

**`Ctrl`+ `Shift`+`BACK_SLASH`**

相关：[如何在 NetBeans 中查看有关鼠标悬停的 Javadoc 文档？](https://stackoverflow.com/questions/6517266/how-to-see-javadoc-documentation-on-mouse-hover-in-netbeans)

# winapi - 以编程方式阻止 Windows 屏幕保护程序启动

> ID：463813
> 
> 赞同：30
> 
> 时间：2009-01-21T01:21:25.023
> 
> 标签：winapi, windows-vista, windows-xp, screensaver

有没有推荐的方法来阻止 Windows 屏幕保护程序启动？我找到的最接近的是[这篇文章](http://www.codeproject.com/KB/cs/ScreenSaverControl.aspx)，但我真正想做的只是告诉 Windows 计算机没有空闲，而不是使用当前设置的屏幕保护程序值。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-11-04T18:38:54.237

为了测试，我将屏幕保护程序设置为 1 分钟并要求输入密码。

我尝试在 VB .Net 中捕获 SC_SCREENSAVE 并返回 -1。如评论所述，它在没有屏幕保护程序密码时有效，但如果屏幕保护程序密码处于活动状态则**失败。**（我在 Windows XP 中尝试过）。我还将它放入一个定时器的滴答事件中，每 1000 毫秒：

```
Static dir As Integer = 4
Cursor.Position = Cursor.Position + New Size(dir, dir)
dir = -dir 
```

它不起作用。光标来回晃动，1 分钟后屏幕保护程序会闪烁一小段时间，然后关闭。屏幕保护程序只打开片刻，时间不足以要求输入密码。但是，闪光灯还是丑陋的。

*然后*我尝试使用 user32.dll 的 SetCursorPos 和 GetCursorPos。你可以在 pinvoke 上查看它们。结果与上述相同。

*然后*我偷看了这个问题其他地方提到的“JiggleMouse”的代码。JiggleMouse 使用 SendInput。 **发送输入有效！** 屏幕保护程序没有闪烁。我在每 50 秒触发一次的 Timer 内调用 SendInput（仅小于 60 秒的最小屏幕保护程序超时）。将鼠标移动 0,0 的增量就足够了，没有真正的移动。这*确实*有效。放入 Tick 事件的代码：

```
Dim i(0) As INPUT
i(0).dwType = INPUT.InputType.INPUT_MOUSE
i(0).mkhi = New MOUSEKEYBDHARDWAREINPUT
i(0).mkhi.mi = New MOUSEINPUT
i(0).mkhi.mi.dx = 0
i(0).mkhi.mi.dy = 0
i(0).mkhi.mi.mouseData = 0
i(0).mkhi.mi.dwFlags = MOUSEINPUT.MouseEventFlags.MOUSEEVENTF_MOVE
i(0).mkhi.mi.time = 0
i(0).mkhi.mi.dwExtraInfo = IntPtr.Zero
SendInput(1, i(0), Marshal.SizeOf(i(0))) 
```

这来自 pinvoke.com：

```
Public Declare Function SendInput Lib "user32" (ByVal nInputs As Integer, ByRef pInputs As INPUT, ByVal cbSize As Integer) As Integer

Public Structure INPUT
    Enum InputType As Integer
        INPUT_MOUSE = 0
        INPUT_KEYBOARD = 1
        INPUT_HARDWARE = 2
    End Enum

    Dim dwType As InputType
    Dim mkhi As MOUSEKEYBDHARDWAREINPUT
End Structure

Public Structure MOUSEINPUT
    Enum MouseEventFlags As Integer
        MOUSEEVENTF_MOVE = &H1
        MOUSEEVENTF_LEFTDOWN = &H2
        MOUSEEVENTF_LEFTUP = &H4
        MOUSEEVENTF_RIGHTDOWN = &H8
        MOUSEEVENTF_RIGHTUP = &H10
        MOUSEEVENTF_MIDDLEDOWN = &H20
        MOUSEEVENTF_MIDDLEUP = &H40
        MOUSEEVENTF_XDOWN = &H80
        MOUSEEVENTF_XUP = &H100
        MOUSEEVENTF_WHEEL = &H800
        MOUSEEVENTF_VIRTUALDESK = &H4000
        MOUSEEVENTF_ABSOLUTE = &H8000
    End Enum

    Dim dx As Integer
    Dim dy As Integer
    Dim mouseData As Integer
    Dim dwFlags As MouseEventFlags
    Dim time As Integer
    Dim dwExtraInfo As IntPtr
End Structure

Public Structure KEYBDINPUT
    Public wVk As Short
    Public wScan As Short
    Public dwFlags As Integer
    Public time As Integer
    Public dwExtraInfo As IntPtr
End Structure

Public Structure HARDWAREINPUT
    Public uMsg As Integer
    Public wParamL As Short
    Public wParamH As Short
End Structure

Const KEYEVENTF_EXTENDEDKEY As UInt32 = &H1
Const KEYEVENTF_KEYUP As UInt32 = &H2
Const KEYEVENTF_UNICODE As UInt32 = &H4
Const KEYEVENTF_SCANCODE As UInt32 = &H8
Const XBUTTON1 As UInt32 = &H1
Const XBUTTON2 As UInt32 = &H2

<StructLayout(LayoutKind.Explicit)> Public Structure MOUSEKEYBDHARDWAREINPUT
    <FieldOffset(0)> Public mi As MOUSEINPUT
    <FieldOffset(0)> Public ki As KEYBDINPUT
    <FieldOffset(0)> Public hi As HARDWAREINPUT
End Structure 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-23T12:50:36.630

Subtle. The official way to tell Windows that the system is not idle is SetThreadExecutionState. This resets the idle timer, (or turns it off, if you pass `ES_CONTINUOUS` ). However, even though SetThreadExecutionState resets the idle timer, *it does not stop the screensaver!*

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-10-12T18:50:18.310

[系统参数信息](http://msdn.microsoft.com/en-us/library/ms724947(VS.85).aspx)

具体来说，`SPI_SETSCREENSAVEACTIVE`参数。

这不起作用吗？我很惊讶我没有在这里看到它。请注意，SetThreadExecutionState 根本不会影响屏幕保护程序，只会影响显示器的休眠。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-09-17T16:37:28.793

我使用[Mouse Jiggler](http://mousejiggler.codeplex.com/)来重置空闲状态。这绕过了一个组策略，该策略往往会在不合时宜的时候启动我的屏幕保护程序（并锁定机器）：当我阅读长文档、研究复杂的代码块或说话/听/不经常打字时会议。

由于鼠标每秒对角跳跃 1px 可能会有点烦人，我打算使用[AutoHotKey](http://www.autohotkey.com/)编写一个基本相同的脚本，但仅在配置的键盘/鼠标空闲超时之后，并且可能使用 Shift 键（或滚动锁定）而不是鼠标移动。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2011-08-15T17:32:16.517

来自[MSDN](http://msdn.microsoft.com/en-us/library/cc144066%28v=vs.85%29.aspx)：

> 如果存在以下任何一种情况，Windows 不会启动屏幕保护程序：
> 
> *   活动应用程序不是基于 Windows 的应用程序。
> *   存在 CBT 窗口。
> *   活动应用程序接收到 wParam 参数设置为 SC_SCREENSAVE 值的 WM_SYSCOMMAND 消息，但它不会将消息传递给 DefWindowProc 函数。

不过有一个警告：

> Windows Vista 和更高版本：如果通过策略启用密码保护，则无论应用程序如何处理 SC_SCREENSAVE 通知，都会启动屏幕保护程序。

即使您将 SetThreadExecutionState 与 ES_CONTINUOUS 一起使用，这似乎也适用。

因此，如果不是出于警告，您的选择将是：

1.  SetThreadExecutionState 与 ES_CONTINUOUS （如其他答案中所述）。
2.  建立一个基于计算机的培训窗口（需要挂钩）。
3.  不要让带有 SC_SCREENSAVE 的 WM_SYSCOMMAND 传递到 DefWindowProc。（假设您仅在您的应用程序是活动应用程序时才关心。）
4.  安装一个[模拟鼠标抖动的加密狗](http://www.wiebetech.com/products/MouseJiggler.php)。

最后一个选项很好，因为它甚至可以使用密码保护策略。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2017-06-21T16:17:02.277

在 Windows 7+ 中，将电源管理 API`PowerSetRequest()`与`PowerRequestDisplayRequired`

[https://msdn.microsoft.com/en-us/library/windows/desktop/dd405534(v=vs.85).aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/dd405534(v=vs.85).aspx)

在以前的 Windows 版本中，拦截 WM_SYSCOMMAND - SC_SCREENSAVE 消息，如 Eddie Parker 的回答中所述。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-01-14T04:36:26.990

Can't believe no one has pointed out the easy and obvious solution:

```
#include <windows.h>

void main()
{
   while(1){
      INPUT input;
      input.type = INPUT_MOUSE;
      input.mi.dx = 1;
      input.mi.dy = 1;
      input.mi.mouseData = 0;
      input.mi.dwFlags = MOUSEEVENTF_MOVE;
      input.mi.time = 0;
      input.mi.dwExtraInfo = 0;
      SendInput( 1, &input, sizeof(input) );
      sleep(60000);
   }
} 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-21T01:37:45.677

[这篇博文](http://community.devpinoy.org/blogs/rolvin/archive/2006/12/07/sc-screensave-i-ll-smoke-don-t-bother.aspx)详细介绍了您需要在 C++ 中执行的操作。

来自网站的实际代码片段：

```
LRESULT CALLBACK WndProc(HWND hWnd, UINT uMsg, WPARAM wParam, LPARAM lParam)
{
  switch (uMsg)                  
  {
    case WM_SYSCOMMAND:
    {
      switch (wParam)
      {
        case SC_SCREENSAVE:  
          return 0;
        case SC_MONITORPOWER:
          return 0;      
      }
      break;      
    }

    case WM_CLOSE:                
    {
      PostQuitMessage(0);            
      return 0;        
    }
  }
  return DefWindowProc(hWnd,uMsg,wParam,lParam); 
```

}

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2020-05-02T16:48:30.697

正如[Adrian McCarthy](https://stackoverflow.com/users/1386054/adrian-mccarthy)从[MSDN](https://docs.microsoft.com/en-us/windows/win32/lwef/screen-saver-library?redirectedfrom=MSDN)中提到的那样：

> 如果通过策略启用密码保护，则无论应用程序如何处理 SC_SCREENSAVE 通知，都会启动屏幕保护程序。

因此，使用 UINT SC_SCREENSAVE 从 WM_SYSCOMMAND 捕获事件并通过返回 0 或创建假鼠标移动（**"mouse_event(MOUSEEVENTF_MOVE, 0, 1, 0, 0)"**）将其丢弃，如果用户启用了受密码保护的屏幕，将无法正常工作保护选项。

使用[SetThreadExecutionState](https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-setthreadexecutionstate) winAPI 告诉操作系统线程正在使用中，即使用户没有与计算机交互。这些将防止出现屏幕保护程序并阻止机器自动挂起。

**有一系列标志来指定当前线程的新状态：**

*   ES_AWAYMODE_REQUIRED (0x00000040) ：启用离开模式。
*   ES_DISPLAY_REQUIRED (0x00000002) ：通过重置显示空闲计时器强制显示打开。
*   ES_SYSTEM_REQUIRED (0x00000001) ：通过重置系统空闲计时器来强制系统处于工作状态。
*   ES_CONTINUOUS (0x80000000) ：通知系统正在设置的状态应该保持有效，直到下一次使用 ES_CONTINUOUS 的调用和其他状态标志之一被清除。

> 因为它是一个winAPI，你可以直接在win32或mfc应用程序中调用它

```
//To stop/start screen saver and monitor power off event
void SetKeepScreenOn(BOOL isKeepScreenOn)
{
   if (isKeepScreenOn == TRUE)
   {
       SetThreadExecutionState(ES_CONTINUOUS | ES_SYSTEM_REQUIRED | ES_DISPLAY_REQUIRED /*| ES_AWAYMODE_REQUIRED*/);        
   }
   else
   {
       SetThreadExecutionState(ES_CONTINUOUS);      
   }
} 
```

**如果有人想在 C# 中使用这个，必须[PInvoke](https://en.wikipedia.org/wiki/Platform_Invocation_Services)这个：**

```
[DllImport("kernel32.dll", CharSet = CharSet.Auto,SetLastError = true)]
static extern EXECUTION_STATE SetThreadExecutionState(EXECUTION_STATE esFlags); 
```

**用户定义的类型：**

```
[FlagsAttribute]
public enum EXECUTION_STATE :uint
{
   ES_AWAYMODE_REQUIRED = 0x00000040,
   ES_CONTINUOUS = 0x80000000,
   ES_DISPLAY_REQUIRED = 0x00000002,
   ES_SYSTEM_REQUIRED = 0x00000001
} 
```

**[下面](http://pinvoke.net/default.aspx/kernel32.SetThreadExecutionState)是调用过程：**

```
void SetKeepScreenOn(bool isKeepScreenOn)
{
    if (isKeepScreenOn == true)
    {
         //You can combine several flags and specify multiple behaviors with a single call
         SetThreadExecutionState(EXECUTION_STATE.ES_CONTINUOUS | EXECUTION_STATE.ES_SYSTEM_REQUIRED | EXECUTION_STATE.ES_DISPLAY_REQUIRED /*| EXECUTION_STATE.ES_AWAYMODE_REQUIRED*/);        
    }
    else
    {
         //To reset or allow those event again you have to call this API with only ES_CONTINUOUS
         SetThreadExecutionState(EXECUTION_STATE.ES_CONTINUOUS);      
    }
 } 
```

根据[MSDN](https://docs.microsoft.com/en-us/windows/win32/power/system-sleep-criteria?redirectedfrom=MSDN) ，此 API 也可以安全使用。

> 系统维护调用 SetThreadExecutionState 的应用程序的计数。系统跟踪调用 SetThreadExecutionState 的每个线程并相应地调整计数器。如果此计数器达到零并且没有任何用户输入，则系统进入睡眠状态。

如果应用程序在重置标志之前崩溃，系统将调整并自动重置。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2012-04-17T23:09:46.317

您可以使用[SystemParametersInfo](http://msdn.microsoft.com/en-us/library/windows/desktop/ms724947.aspx) 获取`SCREENSAVETIMEOUT`，然后立即将超时设置回相同的值。只要您想阻止屏幕保护程序继续，请定期在计时器上执行此操作。

这具有在不实际更改系统设置的情况下重置当前倒数计时器的效果。

正如其他答案所提到的，您可能还想打电话`SetThreadExecutionState`来影响权力。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-08-12T10:19:31.147

只需重置超时计数器

SystemParametersInfo(SPI_SETSCREENSAVEACTIVE, 1, nil, SPIF_SENDWININICHANGE);

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2019-08-09T05:17:56.763

来自[JD Design Freeware](http://www.jddesign.co.uk/products/freeware/freeware_programs.htm) - [Flipss.exe（下载 12kb）](http://www.jddesign.co.uk/products/freeware/flipss.zip)是一个命令行实用程序，它将为您设置 SPI_SETSCREENSAVEACTIVE。

```
"FlipSS.exe -h" to see the current state.
"FlipSS.exe /on" to set the screensaver on.
"FlipSS.exe /off" to set the screensaver off. 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-08-09T05:26:54.283

AutoHotkey 可以在脚本中使用 1-liner DllCall 设置 SystemParametersInfo(SPI_SETSCREENSAVEACTIVE)，以便使用 .ahk 脚本轻松完成此操作。

禁用屏幕保护程序的 AutoHotkey 代码：

```
DllCall("SystemParametersInfo", Int, 17, Int, 0, UInt, NULL, Int, 2) 
```

启用屏幕保护程序的 AutoHotkey 代码：

```
DllCall("SystemParametersInfo", Int, 17, Int, 1, UInt, NULL, Int, 2) 
```

参考论坛主题：

F13Key -[使用 SystemParametersInfo 切换屏幕保护程序](https://www.autohotkey.com/boards/viewtopic.php?t=12462)
SKAN -[如何临时禁用屏幕保护程序](https://autohotkey.com/board/topic/80589-how-to-disable-screen-saver-temporarily/)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-11-04T19:53:12.823

我意识到这是一个旧线程，但我第一次遇到这个问题（工作机器完全锁定，至于更改超短睡眠时间、屏幕保护程序等 - 我什至无法更改我的桌面背景）。我环顾四周寻找解决方案，有些看似过于复杂，有些......不是那么多。

我的一些同事正在使用咖啡因。但这肯定是某种间谍软件等，因为如果没有开放的互联网连接，它就会拒绝运行。

所以我找到了这个（并稍微修改了它），这正是 Caffeine 所做的（除了 Caffeine 每 59 秒做一次），没有所有......充其量，英国媒体报道。

在 PowerShell 中，执行以下 2 个命令行：

```
 $WShell = New-Object -Com "Wscript.Shell"
 while(1) {$WShell.SendKeys("{F15}"); sleep 200} 
```

或者，如果您愿意，也可以将其设为单线：

```
while(1) {(New-Object -Com "Wscript.Shell").SendKeys("{F15}"); sleep 200} 
```

（后者似乎会泄漏内存，但似乎根本不会）

一旦您运行其中任何一个，您的屏幕将不会锁定，直到您执行 ctrl-c 或关闭 Powershell 窗口（似乎仅在后一个版本中， ctrl-c 可能不会发生，直到睡眠间隔过去）。

请注意，至少在我见过的任何键盘上都没有 F15 键（但它是合法的 Windows 击键），因此没有副作用。现在，如果你的 IT 部门。非常偏执，他们可能会标记 F15 击键（我是超级偏执，*但*他们几个月都没有注意到任何事情）。如果是这样，请改用滚动锁定之类的东西。

这两个 100% 在我的 win10 机器上工作。简单就是好！

# string - Quickie - 在 AnsiString (C++) 中用 ''（两个撇号）替换所有出现的 '（撇号）

> ID：463816
> 
> 赞同：5
> 
> 时间：2009-01-21T01:23:17.047
> 
> 标签：string, replace, c++builder

我想你可以猜到我遇到的问题。我将文件名插入到 C++ Builder 中的 sql 数据库中。有些文件的名称中有撇号。这会破坏 sql 插入查询。解决此问题的常用方法是将您希望成为字段值一部分的撇号加倍。

例如，如果我想将 'george's' 添加到字段 'owner'，则 sql 查询将是“插入表（所有者）值（'george''s'）”

我对那一点没意见。我只需要将单撇号替换为双撇号。AnsiString 似乎没有内置函数。有没有一种简单的方法可以做到这一点而不必包含一个全新的头文件？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-21T01:32:21.070

其实我自己也有答案...

```
item = StringReplace( item, "'", "''", TReplaceFlags() <<rfReplaceAll ); 
```

（所以 AnsiString 毕竟有一个内置的替换功能）

编辑：添加了代码标签，以便我们可以区分不同的引号

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T01:32:13.410

我没有使用过 AnsiString，但基本上我会执行以下操作：

*   反向查找字符串中的单引号
*   查看当前单引号索引的左右
*   如果那里没有单引号，请在当前索引后插入单引号
*   继续循环，直到达到索引 0。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T01:33:41.193

执行此操作的常用方法是使用准备好的语句，而不是生成自己的 sql。查找[SQL Injection](http://en.wikipedia.org/wiki/SQL_injection)的原因之一是它不好。基本上，如果在您的应用程序中的任何地方，您忘记将任何 sql 语句中的引号加倍，并且攻击者可以以某种方式将值提交到该 sql 语句中，那么您的数据库就会被黑客入侵。（有关可能发生的事情的幽默示例，请参阅[此 xkcd 漫画](http://xkcd.com/327/)。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T03:31:11.237

在 C++ Builder 中，您正在寻找`AnsiQuotedStr`函数，在`SysUtils`. 它的倒数是`AnsiExtractQuotedStr`。它们不是`AnsiString`类型本身的方法，因为它们不需要深入了解类型的内部结构。

不过，更重要的是，您应该使用*参数化查询*。如果您用于数据库访问的组件不支持这些组件，则获取不同的数据库库。不乏数据库选择，因此您可以对功能挑剔，参数化查询应该靠近列表的顶部。

请注意，尽管有名称，但在 Delphi 和 C++ Builder 2009 中，这些`AnsiX`函数接受`UnicodeString`参数，而不是。`AnsiString`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T07:55:16.337

如果你这样替换它会发生什么

```
item = StringReplace( item, "'", "\'", TReplaceFlags() ); 
```

# python - 在 Python 中使用 DPAPI？

> ID：463832
> 
> 赞同：22
> 
> 时间：2009-01-21T01:30:50.510
> 
> 标签：python, windows, security, encryption, dpapi

有没有办法在带有 Python 的 Windows XP 上使用 DPAPI（数据保护应用程序编程接口）？

如果有一个可以做到的，我宁愿使用现有的模块。不幸的是，我无法找到使用 Google 或 Stack Overflow 的方法。

**编辑：**我采用了“dF”指向的示例代码并将其调整为一个独立的库，该库可以简单地用于在用户模式下使用 DPAPI 进行加密和解密。只需调用返回加密字符串的 dpapi.cryptData(text_to_encrypt) 或返回纯文本的反向 decryptData(encrypted_data_string)。这是图书馆：

```
# DPAPI access library
# This file uses code originally created by Crusher Joe:
# http://article.gmane.org/gmane.comp.python.ctypes/420
#

from ctypes import *
from ctypes.wintypes import DWORD

LocalFree = windll.kernel32.LocalFree
memcpy = cdll.msvcrt.memcpy
CryptProtectData = windll.crypt32.CryptProtectData
CryptUnprotectData = windll.crypt32.CryptUnprotectData
CRYPTPROTECT_UI_FORBIDDEN = 0x01
extraEntropy = "cl;ad13 \0al;323kjd #(adl;k$#ajsd"

class DATA_BLOB(Structure):
    _fields_ = [("cbData", DWORD), ("pbData", POINTER(c_char))]

def getData(blobOut):
    cbData = int(blobOut.cbData)
    pbData = blobOut.pbData
    buffer = c_buffer(cbData)
    memcpy(buffer, pbData, cbData)
    LocalFree(pbData);
    return buffer.raw

def Win32CryptProtectData(plainText, entropy):
    bufferIn = c_buffer(plainText, len(plainText))
    blobIn = DATA_BLOB(len(plainText), bufferIn)
    bufferEntropy = c_buffer(entropy, len(entropy))
    blobEntropy = DATA_BLOB(len(entropy), bufferEntropy)
    blobOut = DATA_BLOB()

    if CryptProtectData(byref(blobIn), u"python_data", byref(blobEntropy),
                       None, None, CRYPTPROTECT_UI_FORBIDDEN, byref(blobOut)):
        return getData(blobOut)
    else:
        return ""

def Win32CryptUnprotectData(cipherText, entropy):
    bufferIn = c_buffer(cipherText, len(cipherText))
    blobIn = DATA_BLOB(len(cipherText), bufferIn)
    bufferEntropy = c_buffer(entropy, len(entropy))
    blobEntropy = DATA_BLOB(len(entropy), bufferEntropy)
    blobOut = DATA_BLOB()
    if CryptUnprotectData(byref(blobIn), None, byref(blobEntropy), None, None,
                              CRYPTPROTECT_UI_FORBIDDEN, byref(blobOut)):
        return getData(blobOut)
    else:
        return ""

def cryptData(text):
    return Win32CryptProtectData(text, extraEntropy)

def decryptData(cipher_text):
    return Win32CryptUnprotectData(cipher_text, extraEntropy) 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-21T01:37:54.677

我一直在使用`CryptProtectData`并`CryptUnprotectData`通过 ctypes，代码来自

[http://article.gmane.org/gmane.comp.python.ctypes/420](http://article.gmane.org/gmane.comp.python.ctypes/420)

它一直运作良好。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-10-13T19:20:07.503

此外，pywin32 在 win32crypt 模块中实现了 CryptProtectData 和 CryptUnprotectData。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T01:34:50.270

最简单的方法是使用[Iron Python](http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython)。

# asp.net - GridView 的替代品，它可以排序、分页并且便宜还是免费？

> ID：463847
> 
> 赞同：0
> 
> 时间：2009-01-21T01:36:28.330
> 
> 标签：asp.net, gridview

我已经被 SqlDataSource 宠坏了，但是我处于无法使用它的场景中。是否有替代 GridView 来实现任意数据源的排序和分页？我试图避免为每个网格编写 1000 行自定义分页和排序。在办公室我使用 Telerik 的网格，但对于我的爱好项目，花那么多钱是不可能的。

编辑：对于像我这样的懒惰程序员来说，如果我连接网格和数据源，它应该会自动分页和排序。因此，我正在寻找能够实现无代码分页和排序的数据源 + 网格的组合。

到目前为止，我知道的唯一示例是 Telerik 的网格（成本 $，在网格中实现排序和分页）和 SqlDataSource + GridView（在 DataSource 中实现排序和分页，但需要 MS-SQL 可用）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-22T09:22:11.933

我不确定您是否要求替代 the`GridView`或`SqlDataSource`....

但是您始终可以使用 an`ObjectDataSource`并将其连接到任何可绑定的对象、集合或数据集

[http://msdn.microsoft.com/en-us/library/aa479347.aspx](http://msdn.microsoft.com/en-us/library/aa479347.aspx)

我们从不使用 a `SqlDataSource`，我们使用包装器从数据层调用 SQL，或者使用 ODS 中的集合。

# c# - ilmerge 是否优化输出？

> ID：463855
> 
> 赞同：1
> 
> 时间：2009-01-21T01:38:41.993
> 
> 标签：c#, visual-studio, ilmerge

我有许多使用 Microsoft 的 ILMERGE.EXE 工具合并的 DLL。所有 DLL 都未选中“优化我的代码”。

尝试在 Web 应用程序中调试代码时，模块屏幕（在 Visual Studio 中）显示 dll 已优化。在尝试调试应用程序的某些部分时，这显然会导致问题。

有没有一种方法可以使用不优化代码的 ILMERGE 构建 DLL？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2013-11-20T11:14:32.237

将 -Attribute添加`/copyattrs`到 ILMERGE 命令行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T02:14:22.560

ILMerge 有一个合并 PDB 的选项，如果您使用它，您将能够通过您的代码进行调试。

请参阅Scott Hanselman 博客上的[这篇博文和讨论](http://www.hanselman.com/blog/MixingLanguagesInASingleAssemblyInVisualStudioSeamlesslyWithILMergeAndMSBuild.aspx)

另请参阅[ILMerge Gui](http://ilmerge-gui.devv.com/)以获取具有此集成的 UI

# sql - 有只使用 ANSI SQL 进行分页的方法吗？

> ID：463859
> 
> 赞同：11
> 
> 时间：2009-01-21T01:42:29.130
> 
> 标签：sql, ansi-sql

我知道：

*   火鸟：`FIRST`和`SKIP`；
*   mysql: `LIMIT`;
*   SQL 服务器：`ROW_NUMBER()`；

有人知道执行结果分页的 SQL ANSI 方式吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-21T14:58:13.703

请参阅此页面上**的限制 - 带偏移部分：**[http://troels.arvin.dk/db/rdbms/](http://troels.arvin.dk/db/rdbms/)

顺便说一句，Firebird 从 2.0 版开始也支持 ROWS 子句

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2018-09-11T16:08:08.713

现在有一个标准，不一定是 ANSI 标准（人们给出了很多答案，我认为这是不那么冗长的一个）

```
SELECT * FROM t1 
WHERE ID > :lastId
ORDER BY ID
FETCH FIRST 3 ROWS ONLY 
```

但并非所有数据库都支持它，下面列出了所有支持的数据库

*   MariaDB：从 5.1 开始支持（通常使用限制/偏移）
*   MySQL：从 3.19.3 开始支持（通常使用限制/偏移）
*   PostgreSQL：从 PostgreSQL 8.4 开始支持（通常使用限制/偏移）
*   SQLite：从 2.1.0 版开始支持
*   Db2 LUW：自版本 7 起受支持
*   Oracle：从 12c 版开始支持（使用带有 row_num 函数的子选择）
*   Microsoft SQL Server：自 2012 年起受支持（传统上使用 top-N）

您当然可以使用偏移样式，尽管您可能会遇到[性能问题](http://allyouneedisbackend.com/blog/2017/09/24/the-sql-i-love-part-1-scanning-large-table/)

```
SELECT * FROM t1
ORDER BY ID
OFFSET 0 ROWS
FETCH FIRST 3 ROWS ONLY 
```

它有不同的支持

*   MariaDB：从 5.1 开始支持
*   MySQL：从 4.0.6 开始支持
*   PostgreSQL：自 PostgreSQL 6.5 起支持
*   SQLite：从 2.1.0 版开始支持
*   Db2 LUW：自版本 11.1 起受支持
*   Oracle：自版本 12c 起受支持
*   Microsoft SQL Server：自 2012 年起受支持

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T02:26:53.567

没有官方方式，没有。*

通常，您会希望在数据库访问层中有一个抽象函数来处理它；提示您使用的是 MySQL 或 PostgreSQL，它可以在查询中添加“LIMIT”子句，或者在 Oracle 的子查询上添加 rownum 等等。如果它不知道它可以做任何这些，则退回到获取批次并仅返回完整列表的一部分。

*: eta: 现在有，在 ANSI SQL:2003 中。但它不是全球支持的，它经常表现不佳，而且有点痛苦，因为您必须将您的 ORDER 移动/复制到语句中的新位置，这使得自动换行变得更加困难：

```
SELECT * FROM (
    SELECT thiscol, thatcol, ROW_NUMBER() OVER (ORDER BY mtime DESC, id) AS rownumber
)
WHERE rownumber BETWEEN 10 AND 20 -- care, 1-based index
ORDER BY rownumber; 
```

SQL:2008（以及它的起源地 DB2）中还有“FETCH FIRST n ROWS ONLY”后缀。但是就像 SQL Server 中的 TOP 前缀和 Informix 中类似的语法一样，您无法指定起点，因此您仍然必须获取并丢弃一些行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T01:51:07.990

将您的结果插入存储表中，按照您希望的显示方式进行排序，但使用新的 IDENTITY 列。

现在从该表中选择您感兴趣的 ID 范围。

（完成后一定要清理桌子）

或者在客户端上做，因为与演示有关的任何事情通常都不应该在 SQL Server 上做（在我看来）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-06-03T12:35:02.533

```
ANSI Sql example:
offset=41, fetchsize=10

SELECT TOP(10) *
FROM table1
WHERE table1.ID NOT IN (SELECT TOP(40) table1.ID FROM table1) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-05-14T11:41:28.207

对于分页，我们需要一个`RowNo`列来过滤它 - 它应该在一个字段上`id`- 有两个变量，如`@PageNo`和`@PageRows`。所以我使用这个查询：

```
SELECT *
FROM (
    SELECT *, (SELECT COUNT(1)
               FROM aTable ti
               WHERE ti.id < t.id) As RowNo
    FROM aTable t) tr
WHERE
    tr.RowNo >= (@PageNo - 1) * @PageRows + 1 
 AND
    tr.RowNo <= @PageNo * @PageRows 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-10-23T17:24:36.800

我知道我对这个问题非常非常晚，但它仍然是这个问题的最佳结果之一。

然而，这个问题缺少的一个回答是，我相信“正确”的 ANSI SQL 分页方法，至少如果你想要最大的可移植性，是根本不使用`LIMIT`/ `OFFSET`/`FIRST`等，而是做类似的事情：

```
SELECT *
FROM MyTable
WHERE ColumnA > ?
ORDER BY ColumnA ASC 
```

where`?`是使用支持它们的库的参数（例如`PDO`在 PHP 中）。

这里的想法很简单，当获取第一页时，我们传递一个匹配每个可能行的参数，例如，如果`ColumnA`是文本，我们将传递一个空字符串 ( `''`)。然后我们读入尽可能多的结果，然后发布其余的。这可能意味着在后台获取了一些额外的行，但我们这里的优先级是兼容性。

为了获取下一页，我们`ColumnA`从结果中的最后一行获取 的值，并将其作为参数传入，这样我们只会获取出现在它之后的值。要在另一个方向运行相同的查询，只需交换`>`for`<`和`ASC`for `DESC`。

这种方法有一些重要的注意事项：

1.  由于我们使用条件，您的 DBMS 可以自由地使用索引来优化请求，这实际上可以比一些“适当的”分页方法更快，因为您消除行而不是超越它们。
2.  这种形式的分页比基于行号的方法更紧密地锚定。使用行号偏移时，如果您向表中偏移，但添加的新行排序早于当前页面，则会导致结果移动到后面的页面。例如，如果您当前页面的最后一行是`mango`，但是自从获取它之后，为`apple`and添加了行`carrot`，那么`mango`现在也可能出现在下一页上，因为它已按排序顺序移动。通过使用这种情况是`ColumnA > 'mango'`不可能发生的。`DATETIME`这在您按 a 进行排序且频繁更新的情况下非常有用。
3.  这个技巧可以在两个方向上起作用，通过在向后（翻转`>`到`<`和`ASC`到）时颠倒提到的排序顺序并从每页结果的第一行而不是最后一行`DESC`传递值。`ColumnA`请注意，如果将值添加到您的表中，则可能意味着您的第一页可能会更短，但这是一个相当小的问题。
4.  为确保您在最后一页（或第一页），您应该获取`N + 1`行，其中`N`是您想要每页的行数，这样您可以检测是否还有更多行要获取。
5.  如果您有一个只有唯一值的列，则此方法效果最佳，但仍然可以在更复杂的情况下使用，只要您可以扩展您的`ORDER BY`子句（和`WHERE`条件）以包含足够多的列以使每一行都是唯一的。

所以它不是没有一些问题，但它是迄今为止最兼容的方法，因为每个 SQL 数据库都会支持它。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-08-29T01:08:17.767

顺便说一句，Troels，PostgreSQL 支持限制/偏移

# opengl - 高级图形

> ID：463860
> 
> 赞同：0
> 
> 时间：2009-01-21T01:42:51.033
> 
> 标签：opengl, java-3d, vrml

我在大学里做过很多 VRML+Java 的工作并且很喜欢它，但我觉得这并不是一个真正有市场的技能。有没有人使用过像开放发明家、硬币等这样的高级图形 API，这些 API 实际使用到一定程度，使得在 API 上投入大量时间不仅仅是为了爱好？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-21T03:18:02.543

以下是一些需要这种图形编程技能的行业：

*   娱乐——梦工厂、皮克斯
*   工程 - 公司进入计算流体力学/动力学（CFM、CDM）
*   游戏 - EA 游戏等

还与公司核对“照片逼真渲染”。

所以是的，这些技能肯定会让你找到一份不错的工作。如果您查看这些公司的“职业”或“工作”部分，您应该对开发哪个特定 api 有一个很好的了解。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-12T13:11:20.737

我来自科学可视化背景，多年来一直使用 Open Inventor。去年我开始了自己的事业，我的第一份咨询工作是在一家大型矿业公司构建一个基于 Open Inventor 的 3D 可视化系统（使用 Mercury 的 .Net 绑定）。

虽然 3D 可视化可能有些专业，但对这些技能的需求不断增长——许多行业正在“走向 3D”。随之而来的是机会，因此您绝对可以以 3D 可视化为生。我会鼓励你在这里稍微跟随你的心；如果你喜欢 3D 图形，那就提高技能，让它成为你职业生涯的一部分。

在我看来，您应该专注于所需的数学知识，在该领域建立深入的知识，并在选择 OpenGL、DirectX、Open Inventor、Java 3D 或其他一些场景图等技术方面有一些经验。您还可以编写自己的场景图来培养您的技能。

很好地了解当前的硬件功能和硬件趋势至关重要。

# sql - 学习 ANSI SQL 的最佳资源是什么？

> ID：463868
> 
> 赞同：5
> 
> 时间：2009-01-21T01:48:25.810
> 
> 标签：sql, sql-server, specifications, ansi-sql

我不是指“基本 SQL”，而是强烈的规范以及规范之间的差异以及出色数据库（如 SQL Server、Oracle 等）之间的实现。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T03:54:24.903

[![](https://i.stack.imgur.com/yYGdf.jpg)](https://i.stack.imgur.com/yYGdf.jpg)
[（来源：[amazon.com](http://images-eu.amazon.com/images/P/0596004818.01.jpg)）]

* * *

[O'Reilly and Associates的 SQL 概括](https://shop.oreilly.com/product/9780596518851.do)。它涵盖了所有 5 种主要 SQL 方言、它们之间的差异，并对列出的每个功能/特性进行了说明。（ANSI SQL99、Oracle、MySql、Postgres 和 SQL Server）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T02:29:13.047

了解差异的第一种方法是在各种数据库中工作。

SQL Server、Oracle 和 MySql 都提供免费（快速）版本。此外，如果您想更进一步，您可以花大约 50 美元获得 SQL Server 的开发人员版本。

甲骨文： [http ://www.oracle.com/technology/products/database/xe/index.html](http://www.oracle.com/technology/products/database/xe/index.html)

SQL 服务器 [http://www.microsoft.com/express/sql/default.aspx](http://www.microsoft.com/express/sql/default.aspx)

MySQL [http://dev.mysql.com/downloads/](http://dev.mysql.com/downloads/)

简单的事情要做：

*   创建数据库
*   创建表
*   执行简单的插入/更新/删除 (CRUD) 操作
*   做内/外连接。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T03:49:38.327

[http://sqlzoo.net/](http://sqlzoo.net/)

[PostgreSQL](http://www.postgresql.org/)世界上更先进的开源和更[符合 ANSI SQL 的](http://www.postgresql.org/about/advantages)数据库

各种 RDBMS ANSI SQL 一致性：[http ://troels.arvin.dk/db/rdbms/](http://troels.arvin.dk/db/rdbms/)

# haskell - 何时在 Haskell 中利用类型推断？

> ID：463870
> 
> 赞同：15
> 
> 时间：2009-01-21T01:50:14.043
> 
> 标签：haskell, coding-style, type-inference

我很好奇有经验的 Haskell 程序员在实践中真正使用类型推断的频率。我经常看到它被称赞为优于某些其他语言所需的始终显式声明的优势，但出于某种原因（也许只是因为我是新手），几乎一直“感觉”编写类型签名是正确的。 .而且我敢肯定在某些情况下它确实是必需的。

一些有经验的 Haskellers（Haskellites？Haskellizers？）可以提供一些输入吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-21T03:34:42.367

即使您编写类型签名，这仍然是一个优势，因为编译器会在您的函数中捕获类型错误。我通常也编写类型签名，但在您实际定义新符号但不觉得需要指定类型签名的地方，如`where`or子句中省略它们。`let`

愚蠢的例子，用一种奇怪的方式计算数字的平方：

```
squares :: [Int]
squares = sums 0 odds
  where
    odds = filter odd [1..]
    sums s (a:as) = s : sums (s+a) as

square :: Int -> Int
square n = squares !! n 
```

`odds`如果编译器不会自动推断它们，并且`sums`是需要类型签名的函数。

此外，如果您像往常一样使用泛型函数，则类型推断可以确保您真正以有效的方式将所有这些泛型函数组合在一起。如果你在上面的例子中说

```
squares :: [a]
squares = ... 
```

编译器可以推断出这种方式无效，因为使用的函数之一（`odd`标准库中的函数）需要`a`在类型 class`Integral`中。在其他语言中，您通常只能在以后才认识到这一点。

如果在 C++ 中将其编写为模板，则在非整数类型上使用该函数时会出现编译器错误，但在定义模板时不会。这可能会让人非常困惑，因为您并不能立即清楚您哪里出错了，您可能需要查看一长串错误消息才能找到问题的真正根源。在 python 之类的东西中，您会在运行时在某个意外点收到错误，因为某些东西没有预期的成员函数。在更松散类型的语言中，您可能不会收到任何错误，而只会收到意想不到的结果。

在 Haskell 中，编译器可以确保可以使用其签名中指定的所有类型调用该函数，即使它是对满足某些约束的所有类型（也称为类型类）有效的通用函数。这使得以通用方式编程和使用通用库变得容易，而在其他语言中很难做到这一点。即使您指定了泛型类型签名，编译器中仍然会进行大量类型推断，以找出每次调用中使用的特定类型以及该类型是否满足函数的所有要求。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-21T07:50:38.170

我总是为顶级函数和值编写类型签名，但不为“where”、“let”或“do”子句中的内容编写类型签名。

首先，顶级函数一般都是导出的，而 Haddock 需要一个类型声明来生成文档。

其次，当你犯了错误时，如果编译器有可用的类型信息，那么编译器错误就更容易解码。事实上，有时在一个复杂的“where”子句中我会得到一个难以理解的类型错误，所以我添加了临时类型声明来查找问题，有点像 printf 调试的类型级等价物。

所以为了回答最初的问题，我经常使用类型推断，但不是 100% 的时间。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-22T05:04:28.550

你有很好的直觉。因为它们由编译器检查，所以顶级值的类型签名提供了宝贵的文档。

像其他人一样，我几乎总是为顶级函数添加类型签名，而几乎从不为任何其他声明添加类型签名。

另一个非常重要的地方类型推断是在交互式循环中（例如，使用 GHCi）。当我设计和调试一些花哨的新高阶函数或类似函数时，这种技术最有用。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-24T23:57:47.670

当您遇到类型检查错误时，尽管 Haskell 编译器确实提供了有关错误的信息，但这些信息可能很难解码。为了更容易，您可以注释掉函数的类型签名，然后查看编译器对该类型的推断，并查看它与您的预期类型有何不同。

另一个用途是当您在顶级函数中构建“内部函数”但您不确定如何构建内部函数甚至它的类型应该是什么时。您可以做的是将内部函数作为参数传递给顶级函数，然后向 ghci 询问类型级函数的类型。这将包括内部函数的类型。然后，您可以使用像 Hoogle 这样的工具来查看该函数是否已存在于库中。

# visual-studio-2010 - Visual Studio 2010 CTP 对于日常使用是否稳定？

> ID：463871
> 
> 赞同：2
> 
> 时间：2009-01-21T01:50:32.187
> 
> 标签：visual-studio-2010

我知道它仍在 CTP 中，但 Visual Studio 2010 是否足够稳定以供日常使用？是否有任何需要注意的问题，例如与 VS2008 不向后兼容的 .sln 转换？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T01:56:36.653

我可以说 Team Editions - Architect 和 Test - 绝对**不是**。这并不是说它们看起来不太好 - 但在[Mickey Goussett](http://teamsystemrocks.com/)给出的一个非常好的演示中，它们多次崩溃或遇到一些重大问题（特别是在测试再现功能和架构图方面）。

玩它，但我不建议将它用于生产代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T01:56:14.470

不确定，但我的印象是它很快就会到期（比如本月）。

# .net - 如何从 .NET 应用程序接入 MYOB？

> ID：463874
> 
> 赞同：2
> 
> 时间：2009-01-21T01:52:32.900
> 
> 标签：.net, integration, myob

我有兴趣了解如何将 .NET 应用程序（甚至是在任何平台上运行的任何应用程序，甚至可能是 Java 或 PHP）与 MYOB 接口。已经有一个使用 MYOB 的系统，但企业主希望他们的不同分支机构能够相互交互。我真的很想从熟悉这个问题的人那里知道解决这个问题的可能方法。非常感谢 ：）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T02:52:37.680

[这里](http://myob.com/servlet/Satellite?cid=1131944311941&pagename=MYOB%2FPage%2FPersonalisedContentPageWithNav&site=en_AU&c=Page)有一个 ODBC 驱动程序。然而，它可能有一些限制。MYOB 和 QuickBooks 都使提取所有数据变得困难——它们试图锁定你。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T03:05:17.577

大约一个月前，我参加了一个 MYOB 研讨会，MYOB 今年即将推出一个用于 .net 和 SQLServer 的 API，以及一个新的开发人员/合作伙伴计划，因为他们正在对他们的软件进行重大重写。

不过还是要等下个版本。。。

目前，ODBC 驱动程序是执行此操作的方法。

# logging - 在 xen 中记录 xm 控制台输出？

> ID：463878
> 
> 赞同：4
> 
> 时间：2009-01-21T01:55:02.070
> 
> 标签：logging, console, xen

有没有办法可以将 xm 控制台的输出记录到某个文件中？

我可以在域配置文件中设置一些在我发出 xm create 时自动为我执行此操作的内容吗？

我试过：

```
xm console | tee domU-console.log 
```

... ，但这不适合我的情况。我想在后台异步记录输出。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-27T02:59:21.937

你可以试试*xenconsoled*

> xenconsoled --log=guest --log-dir=/var/log/xen/guest/

如果您使用 XENCONSOLED_LOG_GUESTS=yes 设置 /etc/sysconfig/xend，Redhat 还会将访客控制台输出保存到 /var/log/xen/console。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T17:57:27.290

如果可行，那么您应该能够：

```
nohup xm console | tee domU-console.log & 
```

我根本不知道是否`xm console`使用 stderr 但如果您也想确保获得输出，请执行以下操作：

```
nohup xm console 2>&1 tee domU-console.log & 
```

`tee`如果您打算注销，请删除。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-06-13T06:00:49.593

程序 1：访问单访客虚拟机的控制台

1：打开 XenCenter，转到要访问的 VM 的常规选项卡，然后检查 UUID

2：打开XenServer文本控制台，运行list_domains命令，在输出中找到VM UUID

3：运行以下命令访问来宾虚拟机控制台：

/usr/lib/xen/bin/xenconsole <域ID>

程序 2：将新创建的 Linux VM 的输出记录到文本文件

要收集并保存 XenServer 主机上运行的所有 VM 的输出，请完成以下过程：

1：在 XenServer 主机上运行以下命令：

xenstore-write /local/logconsole/@ /tmp/console.%d.log

2：重新启动要从中收集控制台输出的 VM。

3：验证文件 /tmp/console..log 是否存在。此文件应包含 VM 控制台输出。要查找域 ID，请参阅程序 1：访问单访客虚拟机的控制台。

4：运行以下命令停止记录控制台输出：

xenstore-rm /local/logconsole/@

[https://support.citrix.com/article/CTX137216](https://support.citrix.com/article/CTX137216)

# postgresql - PostgreSQL 可用性和合并

> ID：463886
> 
> 赞同：3
> 
> 时间：2009-01-21T02:01:55.690
> 
> 标签：postgresql, replication, high-availability

是否有可以优雅地处理脑裂情况的 PostgreSQL HA 解决方案。详细地说，我正在开发的系统预计将在多个区域运行，用户靠近那里的服务器，并且已知区域之间的连接是有问题的。我希望用户能够在降级状态下继续使用系统（无需从断开连接的区域进行更新），并在他们重新上线后进行合理的合并。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T05:21:01.950

如果您准备好忍受时间延迟，那么应该有一些日志传送解决方案，您可以通过计划的作业实施这些解决方案。基本上，您将事务日志的片段发送到备份服务器。以下是一些具有更好描述的链接：

*   [http://developer.postgresql.org/pgdocs/postgres/warm-standby.html](http://developer.postgresql.org/pgdocs/postgres/warm-standby.html)
*   [http://developer.postgresql.org/~wieck/slony1/adminguide-1.1.rc1/logshipping.html](http://developer.postgresql.org/~wieck/slony1/adminguide-1.1.rc1/logshipping.html)
*   [http://www.network-theory.co.uk/docs/postgresql/vol3/RecordbasedLogShipping.html](http://www.network-theory.co.uk/docs/postgresql/vol3/RecordbasedLogShipping.html)

请注意，Slony-I 的完整实现可能很笨重（至少几年前我发现它是这样的，它可能已经有了很大的改进）。

# c# - 如何在 web.config 中引用 DLL？

> ID：463889
> 
> 赞同：5
> 
> 时间：2009-01-21T02:06:35.337
> 
> 标签：c#, asp.net, wcf, rest, service

我在 BIN 文件夹中有一个 DLL，我需要在 web.config 中引用它，否则我会收到那个烦人的错误：

> 说明：在编译服务此请求所需的资源期间发生错误。请查看以下特定错误详细信息并适当修改您的源代码。
> 
> 编译器错误消息：CS0234：命名空间“Microsoft”中不存在类型或命名空间名称“ServiceModel”（您是否缺少程序集引用？）

此 DLL 不在 GAC 中，因此我无法使用

```
<assemblies><add ... 
```

所以我的猜测是我需要使用 configSections

```
<configSections>
  <section name="Microsoft.System.Web" 
           type="Microsoft.System.Web,
                 Version=3.0.0.0, Culture=neutral,
                 PublicKeyToken=10633fbfa3fade6e "/>
</configSections> 
```

正确的代码应该是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-21T04:43:03.073

除非您使用的程序集是强命名的，否则您只需将其放在 bin 目录中即可。

您提到的 configSection 不是用于添加对程序集的引用。这是在 web.config 中定义配置部分。因此，您可以通过向 configsSections 添加一个节标记来添加一个名为 exampleSection 的配置节。这将允许您稍后在 web.config 中创建一个名为“exampleSection”的配置部分。

在 configSections 节定义中存在程序集引用的原因是每个配置节都特定于为其提供配置数据的程序集。configSection 可能特定于网站程序集本身（在这种情况下，这是您要指定的程序集），也可能是站点使用的其他程序集。创建 configSection 使您能够将相关设置分组在一个部分中，而不是将它们混合在 appsettings 中的所有应用程序范围内。

如果您提供有关您遇到问题的更多信息，也许我们可以提供帮助。什么是组件以及它是如何使用的？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T02:16:08.220

有趣的是，我发现如果 dll 及其所有依赖项都在 bin 目录中，即使不在 .SLN 文件或 web.config 中也可以使用它。

# c# - 使用泛型时转换为抽象类或接口

> ID：463894
> 
> 赞同：2
> 
> 时间：2009-01-21T02:09:32.897
> 
> 标签：c#, reflection, casting, abstract-class, generics

我有这个方法 Verify_X，它在数据绑定期间为列表框选定值调用。问题是强类型数据源。我想使用抽象类 BaseDataSource 或接口来调用支持的方法：Parameters[] 和 Select()，而不是使用如下所示的最具体的实现。

这样一种方法可以用于我拥有的所有不同类型的数据源，而不是为每个数据源使用一种方法。它们都以相同的方式继承。

这是继承/实现的链

```
public class DseDataSource : ProviderDataSource<SCCS.BLL.Dse, DseKey>

public abstract class ProviderDataSource<Entity, EntityKey> : BaseDataSource<Entity, EntityKey>, ILinkedDataSource, IListDataSource
    where Entity : SCCS.BLL.IEntityId<EntityKey>, new()
    where EntityKey : SCCS.BLL.IEntityKey, new()

public abstract class BaseDataSource<Entity, EntityKey> : DataSourceControl, IListDataSource, IDataSourceEvents
    where Entity : new()
    where EntityKey : new() 
```

BaseDataSource 具有我需要的方法和属性。DseDataSource 的实现方式如下：

```
public class DseDataSource : ProviderDataSource<SCCS.BLL.Dse, DseKey> 
```

我知道可以编辑 DseDataSource 类，添加一个接口来访问 Parameters[] 和 Select()，然后针对它进行编程，这允许我想要的，但这需要编辑 NetTiers 库，我很想知道这是否可以做到，因为它看起来很困难。

```
 public static string Verify_DSE(string valueToBind, DseDataSource dataSource)
    {
        if (ListContainsValue(dataSource.GetEntityList(), valueToBind)) return valueToBind;
        CustomParameter p = dataSource.Parameters["WhereClause"] as CustomParameter;
        if (p != null)
        {
            p.Value = "IsActive=true OR Id=" + valueToBind;
            dataSource.Select();
            return valueToBind;
        }
        return string.Empty;
    }

    private static bool ListContainsValue(IEnumerable list, string value)
    {
        if (value.Length == 0) return true;

        foreach (object o in list)
        {
            IEntity entity = o as IEntity;
            if (entity != null)
            {
                if (entity.Id.ToString() == value)
                    return true;
            }
        }
        return false;
    } 
```

最终结果将是如下代码：

```
public static string Verify(string valueToBind, object dataSource)
{
//what is the correct way to convert from object
BaseDataSource baseInstance = dataSource as BaseDataSource;

if baseInstance != null)
{
    if (ListContainsValue(baseInstance.GetEntityList(), valueToBind)) return valueToBind;
    CustomParameter p = baseInstance.Parameters["WhereClause"] as CustomParameter;
    if (p != null)
    {
        p.Value = "IsActive=true OR Id=" + valueToBind;
        baseInstance.Select();
        return valueToBind;
    }
}

return string.Empty;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T04:58:19.157

如果您无法更改类定义或使用某种扩展方法，则可以使用反射。这是我使用有关您的代码的假设处理的示例：

```
 public static string Verify(string valueToBind, object dataSource)
    {
        ////what is the correct way to convert from object
        //BaseDataSource baseInstance = dataSource as BaseDataSource;
        Type type = dataSource.GetType();
        MethodInfo select = type.GetMethod("Select");
        PropertyInfo parameters = type.GetProperty("Parameters");
        PropertyInfo parameterGetter = null;
        object parametersInstance = null;
        if (parameters != null)
        {
            parametersInstance = parameters.GetValue(dataSource, null);
            type = parametersInstance.GetType();
            parameterGetter = type.GetProperty("Item");
        }

        //if baseInstance != null)
        if (select != null && parameters != null && parameterGetter != null)
        {
                if (ListContainsValue(baseInstance.GetEntityList(), valueToBind)) return valueToBind;
                CustomParameter p = parameterGetter.GetValue(parametersInstance, new object[] {"WhereClause" }) as CustomParameter;

                if (p != null)
                {
                        p.Value = "IsActive=true OR Id=" + valueToBind;
                        select.Invoke(dataSource, null);
                        return valueToBind;
                }
        }

        return string.Empty;
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T06:57:09.400

谢谢约翰，你真的让我走上了正确的道路。我最终得到以下代码：

```
 public string Verify(string valueToBind, object dataSource)
    {
        IListDataSource listDataSource = dataSource as IListDataSource;
        if (listDataSource != null)
        {
            if (ListContainsValue(listDataSource.GetEntityList(), valueToBind)) return valueToBind;
        }

        Type type = dataSource.GetType();
        MethodInfo select = type.GetMethod("Select", new Type[0]);
        PropertyInfo parameterCollectionInfo = type.GetProperty("Parameters");
        ParameterCollection pc = parameterCollectionInfo.GetValue(dataSource, null) as ParameterCollection;

        if (pc != null)
        {
            CustomParameter p = pc["WhereClause"] as CustomParameter;
            if (p != null)
            {
                p.Value = "IsActive=true OR Id=" + valueToBind;
                select.Invoke(dataSource, null);
                return valueToBind;
            }
        }

        return string.Empty;
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T02:25:47.547

因为代码不能“按原样”使用，所以很难讨论实际问题......你可以将示例简化为不依赖于外部库/类的东西吗？

我可以确认：是`DseDataSource`从 NetTiers 生成的吗？在这种情况下，NetTiers 会生成“部分”类吗？如果是这样，您可以在第二个类文件中添加接口实现：

```
namespace YourNamespace {
    partial class DseDataSource : IYourInterface {
        // implement interface
    }
} 
```

这为`DseDataSource`类添加了功能，而无需您编辑生成的代码。

# java - 在 web 应用程序中使用 java（桌面）代码库

> ID：463911
> 
> 赞同：1
> 
> 时间：2009-01-21T02:18:55.377
> 
> 标签：java, web-frameworks

我有一个相当大的（80k loc）java 桌面应用程序，它与数据库通信。我们现在正在考虑通过 Web 应用程序公开数据库的某些部分，使用现有的代码库，最好不必修改它。

我在数据访问、业务逻辑和表示层之间有很好的分离，但我们没有使用企业 Java bean 或类似的东西（如果这很重要的话）。

最好的前进方式是什么？哪个 java web 框架最适合这个问题？学习曲线并不是很重要，因为我还没有在网络上做过任何 Java 开发......

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-21T02:38:16.537

确实，这取决于您已经拥有什么，以及您当前桌面应用程序的设计有多好。如果不修改它，你可能无法使用任何现有代码，或者可能是最小的现有代码，如果它的设计糟糕，并且一切都是紧密耦合的。

假设您拥有一个设计良好的系统，那么一切都可以很好地解耦。您可以查看**Stripes**为网络制作演示文稿，并使用您现有的数据访问和业务代码。我祝你一切顺利。

很少有**其他值得**研究的好东西是**Grail 上的 Groovy**和**Wicket**。

我**不推荐**像**Seam**和**Spring**这样的东西，它们更像是一个容器和复杂的大型框架，它们几乎可以为您提供一切，解决几乎所有问题。正如您提到的，您已经拥有一个完整的系统，您只需要制作一个 Web 界面即可将其发布到 Web 上，IMO 不推荐这些。

**JSF**是一个**很好的框架**，但据少数人说，它可能会让**你发疯**并且**学习曲线很长。**

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T05:28:50.577

我推荐的两个框架是[Grails](http://grails.org/)和[Struts 2](http://struts.apache.org/2.1.2/index.html)。

Grails 附带了一大堆在后台配置的东西，包括 Hibernate 和 Spring。它使生成动态页面发送到浏览器变得非常容易。您可能需要做的是设置调用 Grails 服务的控制器，这些服务引用您现有的代码，因为您可能不希望 Grails 管理您的数据库交互。Grails 的缺点不在于它是用 Groovy 编写的，这对于 Java 程序员来说很容易学习，而在于 IDE 对 Groovy 的支持仍在成熟中。不过，如果您想要快速提高生产力，这仍然是一条失败的道路。

Struts 2 提供了一个干净的命令模式框架实现，它与前端的 JSP（或速度或 FreeMarker 模板）对话。要使用它，您将配置操作以调用现有代码。您可能需要根据您的需要调查将 Spring 添加到组合中。

还有其他选择，但这是我取得了一些成功的两个。

# bash - 您将如何在 bash 中表示 EOF？

> ID：463913
> 
> 赞同：22
> 
> 时间：2009-01-21T02:20:24.407
> 
> 标签：bash

我正在尝试做类似的事情

```
read -d EOF stdin

for word in $stdin; do stuff; done 
```

我想将'EOF'替换为文件结尾字符的实际表示。

**编辑：**感谢您的回答，这确实是我想要做的。当我看到`stdin=$(cat)`lol的时候，我真的有一个捂脸的时刻

只是为了好玩，尽管您将如何匹配诸如 Cd（或 Cv Mv 等）之类的东西，基本上只是一个与 Control、Alt、Shift 组合的字符，以及 bash 中的任何内容？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-21T02:42:24.547

真的没有文件结尾字符。当您按下 Ctrl-d 或类似字符时，终端驱动程序会通过返回无效值向读取应用程序发出信号，表明已到达文件末尾。当您到达文件末尾时，操作系统也会这样做。这是通过使用整数而不是字节来完成的（因此您的范围类似于 -2^16 .. 2^16，而不仅仅是 0..255）并返回超出范围的值 - 通常是`-1`. 但是没有可以代表的字符`eof`，因为它的全部目的是**不是**一个字符。如果您想从标准输入读取所有内容，直到文件末尾，请尝试

```
stdin=$(cat)
for word in $stdin; do stuff; done 
```

然而，这会将整个标准输入读入变量。您可以只使用数组为一行分配内存，并将`read`一行的读取字放入该数组中：

```
while read -r -a array; do 
    for word in "${array[@]}"; do 
        stuff;
    done
done 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-04-02T01:15:29.753

要查找控制字符是什么，请运行

```
$ cat | od -b
^D
0000000 004 012
0000002 
```

我`^V``^D`在发出命令后输入，然后输入`RET`另一个`^D`（未引用），结果是 EOF 是八进制 004。

将该结果与`read(1)`：

```
$ read -d "$(echo -e '\004')" stdin
foo
bar quuz^Hx
^D
$ echo "$stdin"
foo
bar quux
$ for word in $stdin; do echo $word; done
foo
bar
quux 
```

是的，我`^H`在上面输入了退格键，看看是否`read(1)`做对了。确实如此。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-21T02:42:11.430

两件事情...

EOF 字符由 Cd 表示（或 Cv Cd，如果您想键入它），但要执行您正在尝试的操作，最好这样做：

```
while read line; do stuff "${line}"; done 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-29T11:42:34.597

litb & Daniel are right, I will just answer your "Just for kick" question: Bash (as any command line unix program in general) only see characters as bytes. So you cannot match Alt-v, you will match whatever bytes are sent to you from the UI (pseudo-tty) that interpret these keypresses from the users. It can even be unix signals, not even bytes. It will depend on the terminal program used, the user settings and all kind of things so I would advise you not try to match them.

But if you know that your terminal sends C-v as the byte number 22 (0x16), you can use things like:

```
if test "$char" = '^V'; then... 
```

by entering a real ^V char under your editor (C-q C-v under emacs, C-v C-v under an xterm , ...), not the two chars ^ and V

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-05-18T17:48:26.350

我自己的终端驱动程序，当 getc 返回 EOT 时，fclose 的标准输出并重新打开。这样，当读取器的 getc 检测到一个空的写入队列并返回 EOF（非字符值）以表示它已关闭时，诸如“cat”之类的用户子例程可以移动参数并最终退出。因此将 EOF 呈现为流条件或文件标记，在“char”范围内没有值。

# wpf - WPF 中的多列树视图

> ID：463915
> 
> 赞同：15
> 
> 时间：2009-01-21T02:20:55.590
> 
> 标签：wpf, treeview, wpf-controls

任何人都知道我在哪里可以获得像 WPF 中的多列树视图这样的控件？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-06-13T10:56:40.993

[SharpDevelop](http://www.icsharpcode.net/OpenSource/SD/)有`ListView`一个名为的子类[`SharpTreeView`](https://github.com/icsharpcode/ILSpy/blob/master/SharpTreeView/SharpTreeView.cs)，它可以满足您的需求。

您可以在 SharpDevelop 的“Watch”窗口中看到此控件的实时示例：

![SharpTreeView 示例](https://i.stack.imgur.com/A43d6.png)

监视窗口中使用的 XAML（如 5.1.0 测试版中）：

```
<tv:SharpGridView x:Key="variableGridView" AllowsColumnReorder="False">
    <GridView.Columns>
        <GridViewColumn Header="{core:Localize MainWindow.Windows.Debug.LocalVariables.NameColumn}" Width="200">
            <GridViewColumn.CellTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Horizontal">
                        <tv:SharpTreeNodeView />
                        <local:AutoCompleteTextBox x:Name="name" Margin="-6 0 0 0"  MinWidth="100" Text="{Binding Node.Name}" IsEditable="{Binding Node.CanSetName}">
                            <local:AutoCompleteTextBox.ContextMenu>
                                <MultiBinding Converter="{StaticResource menuBuilder}">
                                    <Binding Path="Node.ContextMenuAddInTreeEntry" />
                                    <Binding Path="Node" />
                                </MultiBinding>
                            </local:AutoCompleteTextBox.ContextMenu>
                        </local:AutoCompleteTextBox>
                    </StackPanel>
                </DataTemplate>
            </GridViewColumn.CellTemplate>
        </GridViewColumn>
        <GridViewColumn Header="{core:Localize MainWindow.Windows.Debug.LocalVariables.ValueColumn}" Width="200">
            <GridViewColumn.CellTemplate>
                <DataTemplate>
                    <local:AutoCompleteTextBox
                        MinWidth="100"
                        Text="{Binding Node.Value}"
                        IsEditable="{Binding Node.CanSetValue}">
                        <local:AutoCompleteTextBox.ContextMenu>
                            <MultiBinding Converter="{StaticResource menuBuilder}">
                                <Binding Path="Node.ContextMenuAddInTreeEntry" />
                                <Binding Path="Node" />
                            </MultiBinding>
                        </local:AutoCompleteTextBox.ContextMenu>
                    </local:AutoCompleteTextBox>
                </DataTemplate>
            </GridViewColumn.CellTemplate>
        </GridViewColumn>
        <GridViewColumn Header="{core:Localize MainWindow.Windows.Debug.LocalVariables.TypeColumn}" Width="200">
            <GridViewColumn.CellTemplate>
                <DataTemplate>
                    <local:AutoCompleteTextBox MinWidth="100" Text="{Binding Node.Type}" IsEditable="False">
                        <local:AutoCompleteTextBox.ContextMenu>
                            <MultiBinding Converter="{StaticResource menuBuilder}">
                                <Binding Path="Node.ContextMenuAddInTreeEntry" />
                                <Binding Path="Node" />
                            </MultiBinding>
                        </local:AutoCompleteTextBox.ContextMenu>
                    </local:AutoCompleteTextBox>
                </DataTemplate>
            </GridViewColumn.CellTemplate>
        </GridViewColumn>
    </GridView.Columns>
</tv:SharpGridView> 
```

资源设置为 SharpTreeView 控件的 View 属性。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-21T02:31:04.290

我已经根据[这里](http://blogs.msdn.com/atc_avalon_team/archive/2006/03/01/541206.aspx)的旧博客文章实现了这一点。但如果我没记错的话，我必须做一些手工工作才能让事情正常工作。特别是滚动条。

但这应该给你一个好的开始。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-03-14T13:55:56.670

如果您不需要列标题，这很容易。您可以只提供一个项目容器模板，在右侧添加固定宽度的网格列，并将其绑定到项目的相关数据。

TreeView 的默认项目容器具有定义为的网格（带有一些添加的注释）：

```
 <Grid>
        <Grid.ColumnDefinitions>
            <!--Expander--><ColumnDefinition MinWidth="19" Width="Auto"/>
            <!--Item--><ColumnDefinition Width="Auto"/>
            <!--Overflow--><ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <!--Current Item--><RowDefinition Height="Auto"/>
            <!--Sub-items--><RowDefinition/>
        </Grid.RowDefinitions>
        <ToggleButton x:Name="Expander" ClickMode="Press" IsChecked="{Binding IsExpanded, RelativeSource={RelativeSource TemplatedParent}}" Style="{StaticResource ExpandCollapseToggleStyle}"/>
        <Border x:Name="Bd" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" Grid.Column="1" Padding="{TemplateBinding Padding}" SnapsToDevicePixels="true">
            <ContentPresenter x:Name="PART_Header" ContentSource="Header" HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
        </Border>
        <ItemsPresenter x:Name="ItemsHost" Grid.ColumnSpan="2" Grid.Column="1" Grid.Row="1"/>
    </Grid> 
```

因此，只需将此网格扩展到右侧包含可预测宽度的列，您将拥有列。

*   为新列添加列定义，使其自动调整大小
*   更新“ItemsHost”的列跨度以跨越添加的列
*   向该列添加一个可预测宽度的控件：

受影响的部分：

```
<Grid>
...
   <ColumnDefinition Width="Auto"/>
...
   <ItemsPresenter ... Grid.ColumnSpan="3" ... />
...
   <Border Grid.Column="3"><!--Add column data here--></Border>
...
</Grid> 
```

如果添加的边框对于所有行的宽度相同，您将拥有一个感觉就像带有列的树视图的视图。这显然不能很好地扩展，但如果只需要一个快速而肮脏的解决方案，您应该能够在几分钟内完成此操作，而无需添加外部控件/库的依赖项。

我们的需求迅速增长，我们在树外添加了一个带有列标签的网格，并将那里的列宽度数据绑定到这些“列”的宽度[实际上是使用自动调整大小的列的相关列中的跨越控件的宽度] *。*它有效，这就是我要为它辩护的全部内容。

如果您不介意（或不希望）选择框（“Bd”边框）延伸到所有列，也可以在生成的项目模板而不是项目容器中完成此方法。

# jquery - 使用 JQuery 将 HTML 作为选定标记的最后一个子项插入

> ID：463924
> 
> 赞同：3
> 
> 时间：2009-01-21T02:27:07.217
> 
> 标签：jquery

我是 JQuery 的新手。我正在阅读 JQuery，但只到第 39 页，需要一些快速帮助！

请注意：我正在简化我的实际要求，所以我所要求的可能听起来很奇怪，但我只是想了解 JQuery 表达式的关键，而不是我的情况（与动画插件有关）。

我有我的 HTML 代码（已生成，我不想更改）：

```
<div class="favorite">
   <div>
          <a href='http://www.stackoverflow.com'>Stackoverflow</a>
   </div>
</div> 
```

现在我要做的是在当前内容之后的 A 标记内插入文本“（最喜欢的）”。或者换句话说，作为`<a>`.

```
<div class="favorite">
   <div>
          <a href='http://www.stackoverflow.com'>Stackoverflow (favorite)</a>
   </div>
</div> 
```

到目前为止我最好的是：

```
$('<span> (favorite)</span>').insertAfter('.favorite div a'); 
```

当然，这最终会将（最喜欢的）文本放在 A 链接之外，并且不会加下划线（我想要的）。

我需要以某种方式说 .parent().lastChild() 但我不太确定该怎么做。

注意：我必须输入`<span>`，否则它不会将其视为“可插入”文本。我敢肯定也有办法解决这个问题，但这是次要问题。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-21T02:32:22.027

该[`append`](http://docs.jquery.com/Manipulation/append)方法在匹配元素的末尾插入节点。[`Prepend`](http://docs.jquery.com/Manipulation/prepend)在开头插入节点。

例子：

```
$('div.favorite div a').append('<span> (favorite)</span>'); 
```

该`span`元素不是必需的 - 你可以这样做：

```
$('div.favorite div a').append(' (favorite)'); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T05:52:04.570

你也可以这样做：

```
$("div.favorite div a").text($("div.favorite div a").text() + " (favorite)"); 
```

# javascript - 如何抑制我未开发的网站的 javascript 错误？

> ID：463933
> 
> 赞同：3
> 
> 时间：2009-01-21T02:33:08.310
> 
> 标签：javascript, debugging, internet-explorer

我喜欢在我的浏览器中启用 javascript 调试，因此当我开发自己的代码时，我可以立即看到我何时出错。

当然，这意味着我在 apple.com、microsoft.com、stackoverflow.com、cnn.com、facebook.com 上看到了错误。有时看到主要站点运行了多少糟糕的代码，这很有趣，但有时它真的很烦人。

多年来我一直想知道如何改变这一点，但从来没有真正解决过。今天特别烦人，我真的很想知道任何解决方案。

我唯一的解决方案是：使用不同的浏览器进行日常浏览。

我希望有一些快速简便的插件，有人可以将我引导到我可以根据我所在的域打开和关闭它的位置。

**编辑：**我一般使用 IE7 进行日常浏览

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-21T02:37:31.330

Firebug 允许您启用/禁用不同域的调试。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-21T04:08:26.730

IE7 中的脚本调试由注册表项控制。（一个插件可能会切换它。我只是不知道。）

所以，我处理这个问题的方法是编写一个注册表脚本来打开或关闭它。然后，我将这些脚本的链接放在我的 Windows 快速启动栏上，并将它们的图标更改为更合适。然后，我只需单击其中一个链接即可打开或关闭 IE 脚本调试。

**关掉：**

```
REGEDIT4

[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main]
"Disable Script Debugger"="yes"
"DisableScriptDebuggerIE"="yes" 
```

**打开：**

```
REGEDIT4

[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main]
"Disable Script Debugger"="no"
"DisableScriptDebuggerIE"="no" 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-21T02:50:56.153

Firefox 允许您使用不同的配置文件。每个配置文件都可以有单独的首选项、主题和插件。以这种方式在 Windows 上启动 firefox：firefox.exe -ProfileManager 来创建或管理配置文件。

但是，我使用 Firefox 和 Webkit 进行 Web 调试，使用 Safari 进行常规 Web 浏览。Firefox 更适合 Web 开发，我更喜欢 Safari。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-21T03:10:14.960

我为 Internet Explorer 保留那些烦人的弹出窗口，你是对的。令人惊讶的是，很少有开发人员会费心在 IE 中测试他们的代码。作为一名网络开发人员，这是你的职责，对吧？看看它如何仍然占大多数网站流量的 60%。

无论如何，在回答您的问题时，我只是切换到 Chrome 进行日常浏览，并且仅使用 IE 进行测试和开发。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-21T03:48:17.957

你有两个选择。

*   更改并使用允许您进行站点特定配置的浏览器（查看带有 Firebug 的 Firefox），或*   使用不同的浏览器进行开发和日常使用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T09:19:01.550

[CompanionJS](http://www.my-debugbar.com/wiki/CompanionJS/HomePage)不允许您在域的基础上切换调试，但会使错误消息对于随意浏览不那么突兀，并且总体上使脚本调试更加用户友好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-23T04:33:02.443

除非您首先打开 javascript 调试器窗口，否则 Chrome 不会打扰您

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-06-07T00:57:03.100

如果你想测试和调试 JavaScript，Firefox 和 Firebug 在功能和易用性方面是无与伦比的。Chrome 没有 Firebug 强大，不管别人怎么说。

# ruby-on-rails - Rails 的 Reddit 样式的嵌套/线程/缩进注释？

> ID：463936
> 
> 赞同：15
> 
> 时间：2009-01-21T02:34:15.407
> 
> 标签：ruby-on-rails, reddit, threaded-comments, acts-as-tree

我想知道是否有人已经在 Rails 中构建了一个用于线程注释的系统（因为没有更好的术语），或者我是否需要自己构建它。

如果不清楚，我指的是像 Reddit 这样的评论系统，它会自动缩进回复，使它们看起来像树的树枝（最好像 Reddit 那样进行投票）。

如果有人能指出我这样做的代码，将不胜感激。

或者也许有一个包含此功能的开源项目。

到目前为止，我还没有在 Rails 中找到一个。

另外，最好在 Rails 论坛上问这个问题，如果是这样，是哪一个？（我是 Rails 新手）

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-01-21T03:10:28.377

使用[`acts_as_tree`](http://wiki.rubyonrails.org/rails/pages/ActsAsTree)插件应该可以很容易地实现。使用安装它

`ruby script/plugin install acts_as_tree`

`app/models/comment.rb`

```
class Comment < ActiveRecord::Base
  acts_as_tree :order => 'created_at'
end 
```

`db/migrate/20090121025349_create_comments.rb`

```
class CreateComments < ActiveRecord::Migration
  def self.up
    create_table :comments do |t|
      t.references :parent
      t.string :title
      t.text :content
      ...
      t.timestamps
    end
  end

  def self.down
    drop_table :comments
  end
end 
```

`app/views/comments/_comment.html.erb`

```
<div id="comment_<%= comment.id %>">
  <h1><%= comment.title %></h1>
  <%= comment.content %>
  <%= render :partial => 'comments/comment', :collection => comments.children %>
</div> 
```

`app/views/comments/show.html.erb`

```
<div id="comments">
  <%= render :partial => 'comments/comment', :object => Comment.find(params[:id]) %>
</div> 
```

魔术发生在`show.html.erb`它调用时`<%= render :partial => 'comments/comment', :object => Comment.find(params[:id]) %>`，这将导致部分递归地呈现所有子评论。如果您想限制深度，可以在部分或模型中进行。

**编辑：**
这将使您在 HTML 中为每个深度保留所有具有相同间距的注释。如果您想生成易于阅读的 HTML，只需使用`render(...).gsub(/^/, "\t")`它即可递归地生成良好缩进的 HTML。

我将它结合到我自己的方法中`app/helpers/application_helper.rb`

```
def indented_render(num, *args)
  render(*args).gsub(/^/, "\t" * num)
end 
```

所以现在你可以打电话`<%= indented_render 1, :partial => 'comments/comment', ... %>`

**编辑：**
修复`</h1>`了示例中缺少的结束标签。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-19T05:23:36.400

Hector 和 Samuel 给出的 ActsAsTree 文档的链接似乎已损坏。您可以在以下位置获取文档

```

http://web.archive.org/web/20061011101510/http://wiki.rubyonrails.org/rails/pages/ActsAsTree

```

（我使用了一个 pre 标签，因为链接由于某种原因一直显示错误）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-19T00:19:17.820

有一个 has_threaded_comments gem，从未使用过它，但它看起来正是这样做的： [https ://github.com/aarongough/has_threaded_comments](https://github.com/aarongough/has_threaded_comments)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T02:57:47.653

你`acts_as_tree`在你的模型上试过插件吗？这是一个官方的 ActiveRecord 组件。

[http://wiki.rubyonrails.org/rails/pages/ActsAsTree](http://wiki.rubyonrails.org/rails/pages/ActsAsTree)

# .net - 从子用户控件获取父用户控件中的属性值

> ID：463938
> 
> 赞同：4
> 
> 时间：2009-01-21T02:38:00.173
> 
> 标签：.net, user-controls

我有一个在 ParentUserControl 中加载的 ChildUserControl。主机页面加载 ParentUserControl。

我需要从 ChildUserControl 访问 ParentUserControl 中的属性。

谢谢你的时间

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-21T02:45:11.000

平台/语言等不清楚，所以这个答案必然是模糊的......但是，一般来说，子控件无法（直接）访问父控件的属性，因为许多不同类型的父控件可能托管儿童控制。孩子不应该被硬编码为单亲，否则它也可能是父母的**一部分**。

通常，您可能想尝试简单地删除该要求 - 这听起来像是一个奇怪的设计。但是，一些框架支持这样的东西*——*例如，WPF 中的依赖属性。

基于界面的设计（针对父母）是一种方法，但这不是很干净。对于 .NET，事件等是孩子与父母交流的另一种常见方式 - 孩子公开不同父母可以以不同方式消费的事件。

除此之外，您正在测试/强制转换父级（针对类或接口）以访问父级的详细信息 - 例如：

```
ParentControlType parent = this.Parent as ParentControlType;
if(parent != null) {
    // access properties etc of "parent"
} 
```

（也可以在这里使用接口；无论哪种方式仍然有点hacky......）

就个人而言，我宁愿让父母控制，而不是使用孩子的这种类型的演员。父级在子级上设置属性，并监听事件（而不是子级在父级上设置属性）：

```
// in the parent
child.SomeProperty = 132;
child.SomePropertyChangd += delegate {
    // do something at the parent
}; 
```

这样，孩子就不会了解或关心父母。它所知道的只是它具有属性（等），并且可以通知其他人有趣的变化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-21T02:58:09.213

可以通过 ((ParentType)Me.Parent) 从子控件访问父控件。不建议这样做。没有办法知道该控件不会在另一个页面/控件上使用。编译器不会捕捉到这一点，这种转换会在运行时导致异常。

处理此问题的最佳方法是让父级提供子控件所需的任何信息（在控件上创建公共属性或方法）。这甚至可能意味着父控件向子控件提供自身的强类型引用（可能通过接口）。这样，编译器可以确保您不会遇到子控件假定父控件类型错误的情况。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T02:50:07.653

抱歉不清楚。平台是 .NET，语言是 C#。

我有一个托管多个子控件的单亲。这是在 C# 中实现视觉继承的一种方式，因为有许多 UI 控件在子级之间共享。

通过界面设计，您是否建议父母和孩子（人）都实现一个共同的界面？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T02:53:28.737

你可以像这样使用反射：

```
public static T GetData<T>(this Control c, string propertyName, T defaultValue){
  Type t = obj.GetType();
  var prop = t.GetProperties().FirstOrDefault(p => p.Name == propertyName);
  if(prop == null) return defaultValue;
  else {
    object val = prop.GetValue(obj, null);
    if(val == null) return defaultValue;
    else return (T)val;
  }
} 
```

扩展“控制”的简单扩展方法，但您可以轻松地将它放在任何东西上（我在`object`传递匿名类时使用它，这本身就是个坏主意！）

用法将是：

```
string someData = this.Parent.GetData("someProperty", string.Empty); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-21T03:04:03.507

您可以使用`this.Parent`子控件的属性，但如果您正在寻找更合适的 OO 解决方案，则不会。让孩子知道关于父母的任何事情最终会以某种方式绑定他们并限制重用。在大多数情况下，这只是理论上的兴趣，如果您正在寻找一些快速的一次性网站，您可以根据需要违反它。但更合适的方法是使用基于事件的通信。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-21T14:17:05.300

感谢您的回复。

我会考虑反射。但是，我听说它有性能瓶颈。

吉姆——你说：

~~

处理此问题的最佳方法是让父级提供子控件所需的任何信息（在控件上创建公共属性或方法）。这甚至可能意味着父控件向子控件提供自身的强类型引用（可能通过接口）。这样，编译器可以确保您不会遇到子控件假定父控件类型错误的情况。

~~

在我的情况下，父母和孩子（ren）都实现了相同的接口。这是糟糕的设计吗？如果我在接口中添加父引用的属性，考虑到父引用也实现相同的接口，它会起作用吗？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-02T16:08:57.740

如果您有 2 个嵌套用户控件 (UC)：

UC1.ascx
      |— UC2.ascx

在 UC1.ascx 中，您定义了一个公共函数或属性来满足您的需要：
   fnUC1(param)

在 UC2.ascx 中，您可以通过以下代码访问此功能：

**CType(Parent.Parent,UC1).fnUC1(param)**

如果您的 UC2 控件位于另一个容器（如中继器）中，您也必须从该容器中退出，因此代码将是：

**CType(Parent.Parent.Parent,UC1).fnUC1(param)**

我承认它不是“最先进的”......但它适用于总是一起工作的嵌套控件，比如父（UC1）/子（UC2）数据显示。

希望这会有所帮助。

皮埃尔。

# perl - 如何修改我的 cygwin 环境以使用 Strawberry Perl 而不是打包的 Perl 发行版？

> ID：463947
> 
> 赞同：13
> 
> 时间：2009-01-21T02:45:38.100
> 
> 标签：perl, cygwin, environment-variables, strawberry-perl

我目前使用[Strawberry Perl](http://www.strawberryperl.com)作为我的主要 Perl 发行版。但是，我有一些通过 cygwin 进行 Perl 调用的应用程序。这些通常会失败，因为它们正在调用与 cygwin 一起打包的 Perl 版本，并且只查看 cygwin 的 lib 文件夹。如何修改我的 cygwin 环境以调用 Strawberry Perl（并使用 C:/strawberry/perl/lib 目录）？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-21T06:18:56.623

如果您使用安装程序从 cygwin 中删除 Perl，它将默认使用 Strawberry Perl。

如果您无法从 cygwin 中删除 Perl，您可以从 Strawberry 创建指向 Perl 可执行文件的符号链接。

在 cygwin shell 中，使用以下命令集：

```
$ mv /usr/bin/perl /usr/bin/perl-cygwin
$ ln -s /cygdrive/c/strawberry/perl/bin/perl.exe /usr/bin/perl 
```

这是假设您使用了默认的 Strawberry Perl 安装程序。`perl.exe`如果您将其安装在其他地方，请相应地更新您的位置。

通过检查 Perl 版本来确保链接正常工作：

```
$ perl -v 
```

应该说**This is perl, (version) 为 MSWin32-x86-multi-thread**（或类似）构建，而*不是* **为 cygwin-thread-multi-64int 构建**。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T23:06:32.207

您可以更改 PATH 以将 Strawberry 目录放在首位。Strawberry 试图通过将其目录放在 PATH 的末尾来变得更好。但是，如果您从 .zip 文件安装，它根本不会更改 PATH。

您可以移动 /usr/bin/perl，但这是一个坏主意，因为当 cygwin 尝试更新它认为是它的 perl 时它会中断。我这周刚刚发生了这种情况，并且曾经在我的 Mac 上发生过这种情况，直到我停止使用系统设置并完全独立地安装了我自己的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-22T14:34:39.643

我可以补充的一件好事是，如果您将正确的 perl 放在路径中的第一位，它应该可以处理您可能已经安装的特定于站点的 CPAN 模块，并且草莓 perl 在 CMD shell 中运行。

“which perl”是你的朋友。

如果遇到问题，可以设置 PERL5LIB 环境变量，但这不是必需的。

我仍然将 DOS 样式的文件路径作为参数传递给 perl 脚本，即“d:\data\myfile.txt”，而不是“/cygdrive/d/data/myfile.txt”。奇怪的是，这种混合路径表示法有效：

bash> /cygdrive/d/scripts/myscript.pl d:\data\myfile.txt

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-03-20T16:48:13.777

其中许多都是很好的解决方案，但我宁愿选择一个不需要多次修改的简单解决方案。

您需要做的就是在 .bashrc 文件中添加/修改一行。

```
# Prepend strawberry perl to cygwin's path
export PATH=/cygdrive/C/Tools/Perl/perl/bin:$PATH 
```

从你的 shell 中获取 .bashrc 文件，（或启动一个新的 shell）并运行你的程序。

```
source ~/.bashrc
perl script.pl 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-05T17:37:53.403

这可能不是首选解决方案，但您应该能够修改 #! 线：

```
#!/cygdrive/c/strawberry/perl/bin/perl5.10.0 
```

我总是提到 perl 的显式位置和安装，而不是依赖于 /usr/bin 中的内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T15:50:20.253

我有两个脚本，用于将 Perl 脚本的第一行修改为路径中第一个 Perl：[rightperl](http://www.win.tue.nl/~rp/bin/rightperl)硬编码到我的 $PATH *now*中的第一个 Perl ，[envperl](http://www.win.tue.nl/~rp/bin/envperl) 会将行更改为 #!/usr/bin /env perl 因此仅在调用脚本时才选择要使用的 Perl。在 Cygwin 下工作得非常好（通常来自 Unix shell）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-04-29T15:58:43.257

如果您不想弄乱任何路径或做任何永久性的事情，那么有一个简单的**TEMPORARY hack**。在 Cygwin sh 提示符下键入“where perl”。它将按执行顺序列出它在 PATH 中看到的所有 Perl.exe。更改在您要使用的 perl 之前列出的您不想被看到的名称。但是请记住在完成后将它们改回来，否则您可能会遇到一些问题。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-01-21T05:57:26.167

我附近没有我的 cygwin 机器，所以我无法对此进行测试，但也许您可以使用脚本将 perl 命令放在前端：转到 cygwin 下的 /bin 并将 perl.exe 移动到其他类似 perl- org.exe，然后设置一个 shell 脚本，用相同的参数执行你的其他 perl。

# java - Java中的字符串转换

> ID：463950
> 
> 赞同：6
> 
> 时间：2009-01-21T02:48:02.227
> 
> 标签：java, string

我有一个采用 String 参数的方法。在某些情况下，我想将 int 值传递给该方法。为了调用该方法，我想将 int 转换为 String。为此，我正在执行以下操作：

```
 aMethod(""+100); 
```

另一种选择是：

```
 aMethod(String.valueOf(100)); 
```

两者都是正确的。不知道哪个合适？哪个提供更好的性能？

大多数情况下，这发生在 GWT 中。在 GWT 中用于设置面板和小部件的大小，我想这样做。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-21T02:54:08.737

在字符串上使用`+`会创建多个字符串实例，因此使用`valueOf`的性能可能会更高一些。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-21T10:40:21.713

由于您主要在 GWT 中使用它，所以我会使用 ""+ 方法，因为它看起来最整洁，而且无论如何它最终都会转换为 javascript，因为没有 StringBuilder 之类的东西。

请不要伤害我 Skeet Fanboys ;)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-21T03:04:45.970

通常你会使用 Integer.toString(int) 或 String.valueOf(int)。它们都返回相同的东西，并且可能具有相同的实现。Integer.toString(int) 虽然一目了然，IMO 更容易阅读。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-21T04:12:30.873

我假设这是：

```
aMethod(""+100); 
```

编译器变成了这个：

```
aMethod(new StringBuilder("").append(String.valueOf(100)).toString()); 
```

所以直接调用 String.valueOf 的选项可能是更好的选择。你总是可以编译它们并比较字节码来确定。

# python - 来自 Linux 上的命令队列的并行处理（bash、python、ruby ......随便）

> ID：463963
> 
> 赞同：45
> 
> 时间：2009-01-21T02:54:45.710
> 
> 标签：python, ruby, bash, shell, parallel-processing

我有一个包含 200 个命令的列表/队列，我需要在 Linux 服务器上的 shell 中运行这些命令。

我只想一次最多运行 10 个进程（从队列中）。有些过程需要几秒钟才能完成，而其他过程则需要更长的时间。

当一个进程完成时，我希望下一个命令从队列中“弹出”并执行。

有没有人有代码来解决这个问题？

**进一步阐述：**

在某种队列中，有 200 件工作需要完成。我希望一次最多进行 10 件工作。当一个线程完成一项工作时，它应该向队列询问下一项工作。如果队列中没有更多的工作，线程应该死掉。当所有线程都死掉时，这意味着所有工作都已完成。

我试图解决的实际问题是使用`imapsync`将 200 个邮箱从旧邮件服务器同步到新邮件服务器。有些用户的邮箱很大，需要很长时间才能同步，有些用户的邮箱很小，同步速度很快。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-01-21T03:53:00.787

在shell 上，`xargs`可用于队列并行命令处理。例如，总是有 3 个并行睡眠，每个睡眠 1 秒，总共执行 10 个睡眠

```
echo {1..10} | xargs -d ' ' -n1 -P3 sh -c 'sleep 1s' _ 
```

它总共会睡4秒钟。如果您有一个名称列表，并且想将名称传递给执行的命令，请再次并行执行 3 个命令，执行

```
cat names | xargs -n1 -P3 process_name 
```

将执行命令`process_name alice`，`process_name bob`依此类推。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-01-21T03:58:50.900

我想你可以使用 make 和 make -j xx 命令来做到这一点。

也许像这样的makefile

```
all : usera userb userc....

usera:
       imapsync usera
userb:
       imapsync userb
.... 
```

make -j 10 -f 生成文件

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2010-01-27T17:00:56.533

[并行](https://savannah.nongnu.org/projects/parallel/)正是为此目的而设计的。

```
cat userlist | parallel imapsync 
```

[与其他解决方案相比， Parallel](https://savannah.nongnu.org/projects/parallel/)的优点之一是它确保输出不会混合。并行`traceroute`工作[很好](https://savannah.nongnu.org/projects/parallel/)，例如：

```
(echo foss.org.my; echo www.debian.org; echo www.freenetproject.org) | parallel traceroute 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-03-10T00:31:35.383

对于这种工作，PPSS 编写：并行处理 shell 脚本。谷歌这个名字，你会找到它，我不会链接垃圾邮件。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-01-21T03:31:22.437

GNU make（也许还有其他实现）有 -j 参数，它控制一次将运行多少个作业。当一个工作完成后，make 会开始另一个工作。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-21T03:34:12.930

好吧，如果它们在很大程度上彼此独立，我会考虑：

```
Initialize an array of jobs pending (queue, ...) - 200 entries
Initialize an array of jobs running - empty

while (jobs still pending and queue of jobs running still has space)
    take a job off the pending queue
    launch it in background
    if (queue of jobs running is full)
        wait for a job to finish
        remove from jobs running queue
while (queue of jobs is not empty)
    wait for job to finish
    remove from jobs running queue 
```

请注意，主循环中的尾部测试意味着如果“作业运行队列”在 while 循环迭代时有空间 - 防止循环过早终止。我认为逻辑是合理的。

我可以很容易地看到如何在 C 中做到这一点——在 Perl 中也不会那么难（因此在其他脚本语言中也不是太难——Python、Ruby、Tcl 等）。我完全不确定我是否想在 shell 中执行此操作 - shell 中的`wait`命令等待所有子进程终止，而不是等待某个子进程终止。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-21T02:59:40.830

如果你打算使用 Python，我推荐使用[Twisted](http://twistedmatrix.com/trac/)。

特别[是 Twisted Runner](http://twistedmatrix.com/trac/wiki/TwistedRunner)。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-21T03:59:01.007

在python中，您可以尝试：

```
import Queue, os, threading

# synchronised queue
queue = Queue.Queue(0)    # 0 means no maximum size

# do stuff to initialise queue with strings
# representing os commands
queue.put('sleep 10')
queue.put('echo Sleeping..')
# etc
# or use python to generate commands, e.g.
# for username in ['joe', 'bob', 'fred']:
#    queue.put('imapsync %s' % username)

def go():
  while True:
    try:
      # False here means no blocking: raise exception if queue empty
      command = queue.get(False)
      # Run command.  python also has subprocess module which is more
      # featureful but I am not very familiar with it.
      # os.system is easy :-)
      os.system(command)
    except Queue.Empty:
      return

for i in range(10):   # change this to run more/fewer threads
  threading.Thread(target=go).start() 
```

未经测试...

（当然，python 本身是单线程的。不过，在等待 IO 方面，您仍然应该受益于多线程。）

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-08-29T22:30:14.210

[https://savannah.gnu.org/projects/parallel（gnu](https://savannah.gnu.org/projects/parallel)并行）和 pssh 可能会有所帮助。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-21T04:10:43.420

Python 的[多处理模块](http://docs.python.org/dev/library/multiprocessing.html)似乎很适合您的问题。它是一个支持进程线程的高级包。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-09-13T16:36:09.040

zsh 中的简单函数，使用 /tmp 中的锁定文件在不超过 4 个子 shell 中并行化作业。

唯一重要的部分是第一个测试中的 glob 标志：

*   `#q`: 在测试中启用文件名通配符
*   `[4]`: 只返回第四个结果
*   `N`：忽略空结果的错误

将其转换为 posix 应该很容易，尽管它会更冗长一些。

不要忘记使用`\"`.

```
#!/bin/zsh

setopt extendedglob

para() {
    lock=/tmp/para_$$_$((paracnt++))
    # sleep as long as the 4th lock file exists
    until [[ -z /tmp/para_$$_*(#q[4]N) ]] { sleep 0.1 }
    # Launch the job in a subshell
    ( touch $lock ; eval $* ; rm $lock ) &
    # Wait for subshell start and lock creation
    until [[ -f $lock ]] { sleep 0.001 }
}

para "print A0; sleep 1; print Z0"
para "print A1; sleep 2; print Z1"
para "print A2; sleep 3; print Z2"
para "print A3; sleep 4; print Z3"
para "print A4; sleep 3; print Z4"
para "print A5; sleep 2; print Z5"

# wait for all subshells to terminate
wait 
```

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2009-01-21T03:08:43.060

您能否详细说明*并行*的含义？听起来您需要在队列中实现某种锁定，这样您的条目就不会被选择两次，等等，并且命令只运行一次。

大多数队列系统作弊——他们只是写一个巨大的待办事项列表，然后选择例如十个项目，处理它们，然后选择接下来的十个项目。没有并行化。

如果您提供更多详细信息，我相信我们可以为您提供帮助。

# java - 如何将文本文件从 jar 复制到 jar 外部的文件中？

> ID：463972
> 
> 赞同：4
> 
> 时间：2009-01-21T03:01:30.983
> 
> 标签：java, file, jar, io

假设我的 jar 包“com.test.io”中有一个名为 test.txt 的文件。

我将如何编写一个检索此文本文件然后将内容复制到文件系统上的新文件的类？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-21T03:08:20.410

假设说 jar 在你的类路径上：

```
URL url = getClassLoader().getResource("com/test/io/test.txt");
FileOutputStream output = new FileOutputStream("test.txt");
InputStream input = url.openStream();
byte [] buffer = new byte[4096];
int bytesRead = input.read(buffer);
while (bytesRead != -1) {
    output.write(buffer, 0, bytesRead);
    bytesRead = input.read(buffer);
}
output.close();
input.close(); 
```

# vba - 使用 VB6 从 .xls 文件中提取/显示宏 (VBA)（无需打开 Excel）

> ID：463973
> 
> 赞同：3
> 
> 时间：2009-01-21T03:03:20.513
> 
> 标签：vba, vb6, extract

我知道可以使用 Excel 宏来执行此操作，请参阅：[Programmatically extract macro (VBA) code from Word 2007 docs](https://stackoverflow.com/questions/49724/programmatically-extract-macro-vba-code-from-word-2007-docs)，但我在这里想要做的是使用 VB6 来制作一个执行相同操作的应用程序。

我在如何指向 Excel 工作簿（`thisworkbook.VBproject`在上面的示例中使用）时遇到问题。

是否可以从 hd 中选择任何 .xls 文件，例如`c:\try.xls`，提取/显示其宏？请指教！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T08:49:40.907

设置对 Microsoft Excel 12.0 对象库（或所需的任何版本）的引用并使用工作簿的 VBProject.VBComponents 集合，例如

```
Sub ExportCode()
  Dim app As Excel.Application
  Set app = New Excel.Application

  Dim wb As Excel.Workbook
  Set wb = Excel.Application.Workbooks.Open("C:\Book2.xls")

  Dim strExt As String

  Dim VBComp As Object
  For Each VBComp In wb.VBProject.VBComponents
    Select Case VBComp.Type
      Case 2  ' Class module
        strExt = ".cls"
      Case 3  ' Form
        strExt = ".frm"
      Case 1  ' Standard module
        strExt = ".bas"
      Case 100  ' Document?
        strExt = ".cls"
      Case Else
        Stop  ' What else is there?
        strExt = ".cls"
    End Select

    VBComp.Export "C:\" & VBComp.Name & strExt
  Next
  wb.Close False
  app.Quit

End Sub 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T23:03:09.540

以下行：

```
Set wb = Excel.Application.Workbooks.Open("C:\Book2.xls") 
```

应该

```
Set wb = app.Workbooks.Open("C:\Book2.xls") 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-05T15:45:16.620

[VbaDiff](http://www.technicana.com/products/vbadiff.html)可以直接从 Excel 文件中读取 Excel 宏，完全按照您描述的方式。如果您需要编程访问，可以使用带有 API 的企业版。你可以用这个做一些非常有趣的事情，就像在[这些例子](http://www.technicana.com/enterprise-version/api-examples.html)中一样。

完全披露——我制造了这个产品。我不断遇到与 Dean 遇到的类似问题，并决定是时候一劳永逸地解决它了！

# visual-studio-2008 - 动态链接托管 C++ 类库中的非托管 dll

> ID：463998
> 
> 赞同：-1
> 
> 时间：2009-01-21T03:20:02.180
> 
> 标签：visual-studio-2008, managed-c++

我通过试验 n 错误弄清楚了如何将非托管静态库链接到托管 C++ dll，但我不知道如何动态包含 DLL。有谁知道如何在 Visual Studio 2008 中执行此操作？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-21T04:19:19.157

调用非托管“LoadLibrary”不起作用？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-30T03:18:17.013

我正在尝试将 CAIR 链接到我的托管程序集。CAIR 依赖于 pthreads，这是一个用于访问任何操作系统的 posix 函数的静态或动态库。

这对我来说没有意义，但解决方案是将 pthreads.lib 文件包含到托管 C++ 程序集中，并将 pthreads.dll 动态链接到托管库以及所有消费者项目中。

如果我将 lib 静态编译到我的托管程序集中，我的印象是不需要 dll。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-30T03:23:33.277

嗯，我不确定为什么会发生这种情况的确切细节，但我使用了一个名为 OpenCV 的库，我必须同时静态链接 lib 文件和动态链接 dll 文件。所以我觉得这样是很正常的。我认为部分原因是，如果库供应商更新了库，他们只需分发一个新的 dll 文件，您的代码就会自动使用它——您不必每次库都重新编译他们的整个程序。更新。****************************