# StackOverflow 问答 000845000-000845999

# python - Django中的“x天前”模板过滤器？

> ID：845009
> 
> 赞同：13
> 
> 时间：2009-05-10T09:35:55.757
> 
> 标签：python, django

我正在寻找将日期时间实例转换为“x 天”或“x 年 y 月”格式的过滤器（如 SO）。建议？我是否忽略了一些非常明显的东西？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-05-10T09:43:02.823

看看[timesince](https://docs.djangoproject.com/en/dev/ref/templates/builtins/#timesince)模板过滤器。它是内置的。

以下返回现在和`comment_date`（例如`'8 hours'`）之间的人性化差异：

```
{{ comment_date|timesince }} 
```

`question_date`以下返回和之间的人性化差异`comment_date`：

```
{{ comment_date|timesince:question_date }} 
```

# javascript - jQuery-ui tabs 字符编码问题

> ID：845015
> 
> 赞同：0
> 
> 时间：2009-05-10T09:44:40.277
> 
> 标签：javascript, jquery, jquery-ui, character-encoding

设置 tabTemplate 选项时，瑞典语字符会被替换。

例如在 href 中使用“ö”：

```
var $tabs = $("#tabs").tabs('option', 'tabTemplate', '<li><a href="#ö">#{label}</a></li>'); 
```

变成：

```
<li><a href="#%C3%B6">ö</a></li> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-10T18:57:04.720

URL 中尚不支持 Unicode。它们必须被编码。但是在散列之后没有经过 URL 编码的字符串不会自动将滚动条移动到您认为应该的位置。您将需要 JavaScript 来找到您要查找的元素并将其滚动到视图中。

用于`unescape`获取字符。然后使用 jQuery 查找元素，就像您已经习惯的那样。获取实际的 DOM 元素（使用 jQuery 的`get`函数），然后调用`scrollIntoView`它。

# java - 从 java 代码中轻松使用 windows 静态库（最好使用 JNA）

> ID：845016
> 
> 赞同：3
> 
> 时间：2009-05-10T09:45:16.903
> 
> 标签：java, java-native-interface, shared-libraries, native, jna

我必须使用`*.lib`java 代码中的一些静态 Windows 库（），我可以编写 C++ JNI 包装器，但我宁愿不这样做（没有 C++ 经验）。

使用它的最简单（最少的开发工作量）方式是什么，性能并不重要，因为该代码只会获取一些数据，很可能会在 JAVA 端进行处理。

很可能我会使用[JNA](https://github.com/twall/jna/)，但 AFAIK 它需要动态库，而我有静态库。

我还[问](https://stackoverflow.com/questions/845183/)了关于将静态库转换为动态库的问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T11:53:53.233

您始终可以创建一个直接调用静态库的 DLL（动态库）项目，然后您可以将 JNA 与新创建的 DLL 一起使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T21:54:28.970

对于它的价值，我前一段时间有一个这样的项目。自动生成 JNI 包装器非常容易。我想我们有大约 350 个函数导出要包装。我们花了大约 3 个小时来编写一个脚本来自动生成包装器（对不起，手边没有脚本，否则我会发布它）。

我们自己几乎没有编写 C++ 代码——但它确实需要了解 JNI 的工作原理……这实际上是一个很好的学习机会/项目——如果你有时间，不要害怕 JNI——你会惊讶于如何你了解了很多关于 JVM 是如何工作的...

如果你真的走这条路，我建议你保持你的包装函数真的非常轻量级——实际上根本没有处理它们。只需将必要的参数从 JNI 值转换为本地参数（这主要用于字符串），调用您的本地函数，然后将结果转换回来。

如果您有一个函数传入一个字符串指针并希望该字符串在指针中返回，请使用 Java 端的大小为 1 的字符串数组，并使用本机调用的结果填充它。

或者，如果您时间紧迫，请将您的 .lib 编译为 .dll 并使用 JNA :-)

# php - 如何在 PHP 中获得有用的错误消息？

> ID：845021
> 
> 赞同：627
> 
> 时间：2009-05-10T09:48:12.687
> 
> 标签：php, debugging, error-handling

我经常会尝试运行一个 PHP 脚本，然后返回一个空白屏幕。没有错误信息；只是一个空的屏幕。原因可能是一个简单的语法错误（错误的括号，缺少分号），或者一个失败的函数调用，或者完全是其他的东西。

很难弄清楚出了什么问题。我最终注释掉了代码，到处输入“echo”语句，等等，试图缩小问题的范围。但肯定有更好的方法，对吧？

有没有办法让 PHP 产生有用的错误消息，就像 Java 一样？

* * *

## 回答 #1

> 赞同：521
> 
> 时间：2009-05-10T09:52:35.640

对于语法错误，您需要在 php.ini 中启用错误显示。默认情况下，这些是关闭的，因为您不希望“客户”看到错误消息。[查看](http://php.net/manual/en/errorfunc.configuration.php#ini.error-reporting)PHP 文档中的此页面以获取有关 2 个指令的信息：`error_reporting`和`display_errors`. `display_errors`可能是您要更改的那个。如果无法修改 php.ini，还可以在 .htaccess 文件中添加以下行：

```
php_flag  display_errors        on
php_value error_reporting       2039 
```

您可能需要考虑为您的 PHP 版本使用 E_ALL 的值（如 Gumbo 所述）`error_reporting`来获取所有错误。[更多信息](http://docs.php.net/manual/en/errorfunc.constants.php)

其他 3 项： (1) 您可以检查错误日志文件，因为它将包含所有错误（除非日志记录已被禁用）。(2) 添加以下 2 行将帮助您调试不是语法错误的错误：

```
error_reporting(-1);
ini_set('display_errors', 'On'); 
```

(3) 另一种选择是使用在您键入时检查错误的编辑器，例如[PhpEd](http://www.nusphere.com/products/phped.htm)。PhpEd 还带有一个调试器，可以提供更详细的信息。（PhpEd 调试器与 xdebug 非常相似，并且直接集成到编辑器中，因此您可以使用 1 个程序来完成所有操作。）

卡特曼的[链接](http://www.ibm.com/developerworks/library/os-debug/)也很好：[http ://www.ibm.com/developerworks/library/os-debug/](http://www.ibm.com/developerworks/library/os-debug/)

* * *

## 回答 #2

> 赞同：465
> 
> 时间：2011-07-04T19:46:13.107

以下启用所有错误：

```
ini_set('display_startup_errors', 1);
ini_set('display_errors', 1);
error_reporting(-1); 
```

另请参阅以下链接

*   [http://php.net/manual/en/errorfunc.configuration.php#ini.display-errors](http://php.net/manual/en/errorfunc.configuration.php#ini.display-errors)
*   [http://php.net/manual/en/errorfunc.configuration.php#ini.display-startup-errors](http://php.net/manual/en/errorfunc.configuration.php#ini.display-startup-errors)
*   [http://php.net/manual/en/function.error-reporting.php](http://php.net/manual/en/function.error-reporting.php)

* * *

## 回答 #3

> 赞同：179
> 
> 时间：2013-08-13T11:59:35.587

以下代码应显示所有错误：

```
<?php

// ----------------------------------------------------------------------------------------------------
// - Display Errors
// ----------------------------------------------------------------------------------------------------
ini_set('display_errors', 'On');
ini_set('html_errors', 0);

// ----------------------------------------------------------------------------------------------------
// - Error Reporting
// ----------------------------------------------------------------------------------------------------
error_reporting(-1);

// ----------------------------------------------------------------------------------------------------
// - Shutdown Handler
// ----------------------------------------------------------------------------------------------------
function ShutdownHandler()
{
    if(@is_array($error = @error_get_last()))
    {
        return(@call_user_func_array('ErrorHandler', $error));
    };

    return(TRUE);
};

register_shutdown_function('ShutdownHandler');

// ----------------------------------------------------------------------------------------------------
// - Error Handler
// ----------------------------------------------------------------------------------------------------
function ErrorHandler($type, $message, $file, $line)
{
    $_ERRORS = Array(
        0x0001 => 'E_ERROR',
        0x0002 => 'E_WARNING',
        0x0004 => 'E_PARSE',
        0x0008 => 'E_NOTICE',
        0x0010 => 'E_CORE_ERROR',
        0x0020 => 'E_CORE_WARNING',
        0x0040 => 'E_COMPILE_ERROR',
        0x0080 => 'E_COMPILE_WARNING',
        0x0100 => 'E_USER_ERROR',
        0x0200 => 'E_USER_WARNING',
        0x0400 => 'E_USER_NOTICE',
        0x0800 => 'E_STRICT',
        0x1000 => 'E_RECOVERABLE_ERROR',
        0x2000 => 'E_DEPRECATED',
        0x4000 => 'E_USER_DEPRECATED'
    );

    if(!@is_string($name = @array_search($type, @array_flip($_ERRORS))))
    {
        $name = 'E_UNKNOWN';
    };

    return(print(@sprintf("%s Error in file \xBB%s\xAB at line %d: %s\n", $name, @basename($file), $line, $message)));
};

$old_error_handler = set_error_handler("ErrorHandler");

// other php code

?> 
```

使用此代码生成空白页的唯一方法是在关闭处理程序中出现错误时。我从我自己的 cms 复制并粘贴了它，没有测试它，但我确信它可以工作。

* * *

## 回答 #4

> 赞同：61
> 
> 时间：2009-05-10T09:54:31.907

您可以在要调试的文件中包含以下行：

```
error_reporting(E_ALL);
ini_set('display_errors', '1'); 
```

这会覆盖 php.ini 中的默认设置，这只会让 PHP 将错误报告到日志中。

* * *

## 回答 #5

> 赞同：61
> 
> 时间：2009-09-25T04:22:54.190

错误和警告通常出现在`....\logs\php_error.log`或`....\logs\apache_error.log`取决于您的 php.ini 设置。

有用的错误也经常被定向到浏览器，但由于它们不是有效的 html，它们不会显示出来。

所以`"tail -f`“你的日志文件，当你得到一个空白屏幕时，使用 IE 的“视图”->“源”菜单选项来查看原始输出。

* * *

## 回答 #6

> 赞同：58
> 
> 时间：2014-02-02T20:47:47.290

## PHP 配置

[php.ini](https://stackoverflow.com/questions/8684609/dude-wheres-my-php-ini)中的 2 个条目指示错误的输出：

1.  **[`display_errors`](http://il1.php.net/manual/en/errorfunc.configuration.php#ini.display-errors)**
2.  **[`error_reporting`](http://il1.php.net/manual/en/errorfunc.configuration.php#ini.error-reporting)**

在**生产**中，`display_errors`通常设置为`Off`（这是一件好事，因为生产站点中的错误显示通常是不可取的！）。

但是，在**development**中，它应该设置为`On`，以便显示错误。**检查**！

`error_reporting`（从 PHP 5.3 开始）默认设置为`E_ALL & ~E_NOTICE & ~E_STRICT & ~E_DEPRECATED`（意思是显示除通知、严格标准和弃用通知外的所有内容）。如有疑问，请将其设置`E_ALL`为显示**所有**错误。**检查**！

## 哇哇！没有检查！我无法更改我的 php.ini！

真可惜。通常共享主机不允许更改其 php.ini 文件，因此该选项不可用。但不要害怕！我们还有[其他选择](https://www.php.net/manual/en/configuration.file.per-user.php)！

## 运行时配置

在所需的脚本中，我们可以在运行时更改 php.ini 条目！意思是，它会在脚本运行时运行！甜的！

```
**[error_reporting](http://il1.php.net/manual/en/function.error-reporting.php)**(E_ALL);
**[ini_set](http://php.net/ini_set)**("display_errors", "On");
```

这两行将与上面更改 php.ini 条目的效果相同！惊人的！

## 我仍然收到空白页/500 错误！

这意味着脚本甚至还没有运行！当您有语法错误时，通常会发生这种情况！

由于语法错误，脚本甚至无法运行。**它在编译时**失败，这意味着它将使用 php.ini 中的值，如果您没有更改，可能不允许显示错误。

## 错误日志

此外，PHP 默认记录错误。在共享主机中，它可能位于专用文件夹中或与有问题的脚本位于同一文件夹中。

如果您有权访问 php.ini，则可以在**[`error_log`](http://il1.php.net/manual/en/errorfunc.configuration.php#ini.error-log)**条目下找到它。

* * *

## 回答 #7

> 赞同：32
> 
> 时间：2009-09-25T07:48:09.253

我总是在 php 脚本的最顶部使用这种语法。

```
ini_set('error_reporting', E_ALL);
ini_set('display_errors', 'On');  //On or Off 
```

* * *

## 回答 #8

> 赞同：30
> 
> 时间：2009-05-10T09:59:30.443

有一个非常有用的扩展名为“ [xdebug](http://www.xdebug.org/) ”，它也会让你的报告变得更好。

* * *

## 回答 #9

> 赞同：27
> 
> 时间：2013-01-24T15:06:56.573

对于快速的动手故障排除，我通常建议在这里：

```
error_reporting(~0); ini_set('display_errors', 1); 
```

放在正在排除故障的脚本的开头。这并不完美，完美的变体是您还启用了它，`php.ini`并且您在 PHP 中记录错误以捕获语法和启动错误。

此处列出的设置显示所有错误、通知和警告，包括严格的，无论 PHP 版本。

接下来要考虑的事情：

*   安装[Xdebug](http://xdebug.org/)并使用您的 IDE 启用远程调试。

另见：

*   [错误报告（PHP 的正确方法。）](http://www.phptherightway.com/#error_reporting)
*   [预定义常量^(*文档*)](http://www.php.net/errorfunc.constants.php)
*   [`error_reporting()`^(*文档*)](http://php.net/function.error-reporting.php)
*   [`display_errors`^(*文档*)](http://php.net/display_errors)

* * *

## 回答 #10

> 赞同：27
> 
> 时间：2016-01-05T18:59:52.987

可以注册一个钩子以使最后一个错误或警告可见。

```
function shutdown(){
  var_dump(error_get_last());
}

register_shutdown_function('shutdown'); 
```

将此代码添加到 index.php 的开头将帮助您调试问题。

* * *

## 回答 #11

> 赞同：17
> 
> 时间：2011-07-04T19:49:30.323

如果你超级酷，你可以试试：

```
$test_server = $_SERVER['SERVER_NAME'] == "127.0.0.1" || $_SERVER['SERVER_NAME'] == "localhost" || substr($_SERVER['SERVER_NAME'],0,3) == "192";

ini_set('display_errors',$test_server);
error_reporting(E_ALL|E_STRICT); 
```

这只会在您在本地运行时显示错误。它还为您提供了 test_server 变量，以便在其他适当的地方使用。

在脚本运行之前发生的任何错误都不会被捕获，但对于我犯的 99% 的错误，这不是问题。

* * *

## 回答 #12

> 赞同：17
> 
> 时间：2013-05-06T14:14:25.753

在页面顶部选择一个参数

```
error_reporting(E_ERROR | E_WARNING | E_PARSE); 
```

* * *

## 回答 #13

> 赞同：17
> 
> 时间：2015-11-12T06:24:01.927

# 这是加载与运行时配置的问题

**重要的是要认识到在编译**或**解析**步骤期间会发生语法错误或解析错误，这意味着 PHP 甚至在有机会执行您的任何代码之前就会放弃。因此，如果您`display_errors`在运行时修改 PHP 的配置（这包括从`ini_set`在代码中使用到使用运行时配置文件 .htaccess 的任何内容），那么只有默认**加载的配置设置**在起作用。

# 如何在开发中始终避免 WSOD

为了避免 WSOD，您需要确保**加载的配置文件**已`display_errors`打开并`error_reporting`设置为`-1`（*这是等效的 E_ALL，因为它确保所有位都打开，无论您运行的是哪个版本的 PHP*）。不要硬编码 E_ALL 的常量值，因为该值会在不同版本的 PHP 之间发生变化。

加载的配置是您加载的`php.ini`文件或您的`apache.conf`或`httpd.conf`或虚拟主机文件。这些文件仅在启动阶段读取一次（例如，当您第一次启动 apache httpd 或 php-fpm 时）并且仅被运行时配置更改覆盖。确保在您加载的配置文件`display_errors = 1`中`error_reporting = -1`确保您永远不会看到*WSOD*，无论在运行时更改之前发生的语法或解析错误（如`ini_set('display_errors', 1);`或`error_reporting(E_ALL);`可能发生）。

# 如何找到您的 (php.ini) 加载的配置文件

要找到您加载的配置文件，只需使用以下代码创建一个新的 PHP 文件...

```
<?php
phpinfo(); 
```

然后将浏览器指向那里并查看**Loaded Configuration File**和**Additional .ini files parsed**，它们通常位于您的顶部，`phpinfo()`并将包含所有已加载配置文件的绝对路径。

如果您看到`(none)`的不是文件，则意味着您在**Configuration File (php.ini) Path**中没有 php.ini 。因此，您可以[从此处下载与 PHP 捆绑在一起的库存 php.ini](https://raw.githubusercontent.com/php/php-src/master/php.ini-development)，并将其作为 php.ini 复制到您的配置文件路径，然后确保您的 php 用户具有足够的权限来读取该文件。您需要重新启动 httpd 或 php-fpm 才能加载它。记住，这是与 PHP 源捆绑在一起的*开发php.ini 文件。*所以请不要在生产中使用它！

* * *

# 只是不要在生产中这样做

这确实是在开发中避免 WSOD 的最佳方法。如果您加载配置文件，任何建议您将PHP 脚本`ini_set('display_errors', 1);`或`error_reporting(E_ALL);`放在 PHP 脚本顶部或使用 .htaccess 的任何人都不会帮助您在发生语法或解析错误时避免 WSOD（就像您的情况一样）已`display_errors`关闭。

许多人（以及 PHP 的库存安装）将使用`display_errors`默认关闭的生产 ini 文件，这通常会导致您在这里遇到同样的挫败感。因为 PHP 在启动时已经将其关闭，然后遇到语法或解析错误，并且没有输出任何内容。您希望您`ini_set('display_errors',1);`在 PHP 脚本的顶部应该避免这种情况，但如果 PHP 无法解析您的代码也没关系，因为它永远不会到达运行时。

* * *

## 回答 #14

> 赞同：16
> 
> 时间：2009-09-25T08:09:07.830

我不知道它是否会有所帮助，但这是我用于 php 项目的标准配置文件的一部分。即使在我自己的服务器上，我也不会过多地依赖 apache 配置。

我从来没有遇到过消失的错误问题，所以也许这里的一些东西会给你一个想法。

**编辑显示APPLICATON_LIVE**

```
/*
APPLICATION_LIVE will be used in process to tell if we are in a development or production environment.  It's generally set as early as possible (often the first code to run), before any config, url routing, etc.
*/

if ( preg_match( "%^(www.)?livedomain.com$%", $_SERVER["HTTP_HOST"]) ) {
    define('APPLICATION_LIVE', true);
} elseif ( preg_match( "%^(www.)?devdomain.net$%", $_SERVER["HTTP_HOST"]) ) {
    define('APPLICATION_LIVE', false);
} else {
    die("INVALID HOST REQUEST (".$_SERVER["HTTP_HOST"].")");
    // Log or take other appropriate action.
}

/*
--------------------------------------------------------------------
DEFAULT ERROR HANDLING
--------------------------------------------------------------------
Default error logging.  Some of these may be changed later based on APPLICATION_LIVE.
*/
error_reporting(E_ALL & ~E_STRICT);
ini_set ( "display_errors", "0");
ini_set ( "display_startup_errors", "0");
ini_set ( "log_errors", 1);
ini_set ( "log_errors_max_len", 0);
ini_set ( "error_log", APPLICATION_ROOT."logs/php_error_log.txt");
ini_set ( "display_errors", "0");
ini_set ( "display_startup_errors", "0");

if ( ! APPLICATION_LIVE ) {
    // A few changes to error handling for development.
    // We will want errors to be visible during development.
    ini_set ( "display_errors", "1");
    ini_set ( "display_startup_errors", "1");
    ini_set ( "html_errors", "1");
    ini_set ( "docref_root", "http://www.php.net/");
    ini_set ( "error_prepend_string", "<div style='color:red; font-family:verdana; border:1px solid red; padding:5px;'>");
    ini_set ( "error_append_string", "</div>");
} 
```

* * *

## 回答 #15

> 赞同：16
> 
> 时间：2011-07-04T19:54:31.223

要坚持这一点并使其舒适，您可以编辑您的 php.ini 文件。它通常存储在`/etc/php.ini`or中`/etc/php/php.ini`，但更多 local`php.ini`可能会覆盖它，具体取决于您的托管服务提供商的设置指南。检查顶部的`phpinfo()`文件，以确保最后加载哪个文件。`Loaded Configuration File`

在该文件中搜索 display_errors。应该只有 3 个实例，其中 2 个被注释。

将未注释的行更改为：

```
display_errors = stdout 
```

* * *

## 回答 #16

> 赞同：16
> 
> 时间：2017-12-04T20:54:29.313

```
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL); 
```

* * *

## 回答 #17

> 赞同：15
> 
> 时间：2014-08-19T15:36:37.590

```
error_reporting(E_ALL | E_STRICT);
ini_set('display_errors', 1);
ini_set('html_errors', 1); 
```

此外，您可以使用[xdebug](https://xdebug.org)获得更详细的信息。

* * *

## 回答 #18

> 赞同：15
> 
> 时间：2015-07-15T22:38:32.783

我推荐[Nette Tracy](https://tracy.nette.org/en/)以更好地可视化 PHP 中的错误和异常：

![内特·特蕾西截图](https://i.stack.imgur.com/B1gSC.png)

* * *

## 回答 #19

> 赞同：10
> 
> 时间：2009-05-10T09:54:53.357

```
error_reporting(E_ALL | E_STRICT); 
```

并在 php.ini 中开启显示错误

* * *

## 回答 #20

> 赞同：9
> 
> 时间：2009-05-10T09:54:10.643

您可以在 PHP中注册自己的[错误处理程序。](http://de.php.net/manual/en/function.set-error-handler.php)例如，将所有错误转储到文件可能会在这些晦涩难懂的情况下对您有所帮助。请注意，无论您当前的[error_reporting](http://de.php.net/manual/en/function.error-reporting.php)设置为什么，都会调用您的函数。非常基本的例子：

```
function dump_error_to_file($errno, $errstr) {
    file_put_contents('/tmp/php-errors', date('Y-m-d H:i:s - ') . $errstr, FILE_APPEND);
}
set_error_handler('dump_error_to_file'); 
```

* * *

## 回答 #21

> 赞同：8
> 
> 时间：2014-06-10T13:37:38.073

从 PHP 中获取有用错误所需的两条关键线是：

```
ini_set('display_errors',1);
 error_reporting(E_ALL); 
```

正如其他贡献者所指出的，出于安全原因，这些默认情况下是关闭的。作为一个有用的提示 - 当您设置站点时，可以方便地为不同的环境进行切换，以便这些错误在您的本地和开发环境中默认为 ON。这可以通过以下代码来实现（最好在您的 index.php 或配置文件中，因此从一开始就处于活动状态）：

```
switch($_SERVER['SERVER_NAME'])
{
    // local
    case 'yourdomain.dev':
    // dev
    case 'dev.yourdomain.com':
        ini_set('display_errors',1);
        error_reporting(E_ALL);
    break;
    //live
    case 'yourdomain.com':
        //...
    break;
} 
```

* * *

## 回答 #22

> 赞同：6
> 
> 时间：2011-01-16T20:59:56.787

打开你的 php.ini，确保它设置为：

```
display_errors = On 
```

重新启动您的服务器。

* * *

## 回答 #23

> 赞同：6
> 
> 时间：2014-06-18T01:03:15.627

您可能还想尝试 PHPStorm 作为您的代码编辑器。当您在编辑器中键入时，它会发现许多 PHP 和其他语法错误。

* * *

## 回答 #24

> 赞同：6
> 
> 时间：2014-11-10T11:23:56.930

如果您是 ubuntu 用户，请转到您的终端并运行此命令

```
sudo tail -50f /var/log/apache2/error.log 
```

它将显示最近的 50 个错误。apache2有一个错误文件`error.log`，它记录所有错误。

* * *

## 回答 #25

> 赞同：5
> 
> 时间：2009-05-10T12:09:01.733

要打开完整的错误报告，请将其添加到您的脚本中：

```
error_reporting(E_ALL); 
```

这会导致出现最小的警告。而且，以防万一：

```
ini_set('display_errors', '1'); 
```

将强制显示错误。这应该在生产服务器中关闭，但不是在您开发时。

* * *

## 回答 #26

> 赞同：5
> 
> 时间：2014-02-01T06:24:06.980

“错误”是开发人员了解错误并解决错误以使系统完美运行的最有用的东西。

PHP 提供了一些更好的方法来了解开发人员为什么以及他们的代码出现错误的位置，因此通过了解这些错误，开发人员可以在许多方面改进他们的代码。

在脚本顶部编写以下两行以获取所有错误消息的最佳方法：

```
error_reporting(E_ALL);
ini_set("display_errors", 1); 
```

在 IDE中使用调试器工具（如[xdebug ）的另一种方法。](http://xdebug.org)

* * *

## 回答 #27

> 赞同：4
> 
> 时间：2009-05-10T09:58:55.017

您可以启用完整的错误报告（包括通知和严格的消息）。有些人觉得这太冗长了，但值得一试。在您的 php.ini 中设置`error_reporting`为。`E_ALL | E_STRICT`

```
error_reporting = E_ALL | E_STRICT 
```

`E_STRICT`将通知您有关已弃用的功能，并为您提供有关执行某些任务的最佳方法的建议。

如果您不想要通知，但发现其他消息类型有帮助，请尝试排除通知：

```
error_reporting = (E_ALL | E_STRICT) & ~E_NOTICE 
```

还要确保`display_errors`在 php.ini 中启用。如果您的 PHP 版本早于 5.2.4，请将其设置为`On`：

```
display_errors = "On" 
```

如果您的版本是 5.2.4 或更高版本，请使用：

```
display_errors = "stderr" 
```

* * *

## 回答 #28

> 赞同：4
> 
> 时间：2009-05-10T18:16:21.477

除了 error_reporting 和 display_errors ini 设置之外，您还可以从 Web 服务器的日志文件中获取语法错误。当我开发 PHP 时，我将开发系统的 Web 服务器日志加载到我的编辑器中。每当我测试一个页面并得到一个空白屏幕时，日志文件就会过时，我的编辑器会询问我是否要重新加载它。当我这样做时，我跳到底部并且存在语法错误。例如：

```
[Sun Apr 19 19:09:11 2009] [error] [client 127.0.0.1] PHP Parse error:  syntax error, unexpected T_ENCAPSED_AND_WHITESPACE, expecting T_STRING or T_VARIABLE or T_NUM_STRING in D:\\webroot\\test\\test.php on line 9 
```

* * *

## 回答 #29

> 赞同：3
> 
> 时间：2017-07-05T09:04:05.357

对于那些使用 nginx 并且即使使用`<?php echo 123;`. 就我而言，我在 nginx 配置文件中没有 PHP 所需的选项：

```
fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name; 
```

这个选项不在 fastcgi_params 文件中，所以 PHP 没有工作并且日志中没有任何错误。

* * *

## 回答 #30

> 赞同：3
> 
> 时间：2018-09-14T03:31:55.647

除了这里所有精彩的答案，我想特别提及 MySQLi 和 PDO 库。

为了...

1.  总是看到与数据库相关的错误，并且
2.  避免检查方法的返回类型以查看是否有问题

最好的选择是将库配置为[抛出异常](https://secure.php.net/manual/language.exceptions.php)。

### MySQLi

在脚本顶部附近添加它

```
mysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT); 
```

最好在使用`new mysqli()`或之前放置`mysqli_connect()`。

### PDO

将`PDO::ATTR_ERRMODE`属性设置为`PDO::ERRMODE_EXCEPTION`您的连接实例。您可以在构造函数中执行此操作

```
$pdo = new PDO('driver:host=localhost;...', 'username', 'password', [
    PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION
]); 
```

或创建后

```
$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION); 
```

* * *

## 回答 #31

> 赞同：3
> 
> 时间：2019-05-17T12:00:21.000

> 这个答案是冗余部门为您带来的。

1.  **`ini_set()`/php.ini/.htaccess/.user.ini**

    `display_errors`现在`error_reporting`已经充分覆盖了这些设置。但只是回顾一下何时使用哪个选项：

    *   [`ini_set()`](http://php.net/ini_set)并[`error_reporting()`](http://php.net/error_reporting)仅适用于运行时错误。
    *   [`php.ini`](http://php.net/php.ini)应该主要针对开发设置进行编辑。（Webserver 和 CLI 版本通常有不同的 php.ini）
    *   [`.htaccess`](https://www.php.net/manual/en/configuration.changes.php)标志仅适用于过时的设置（寻找新的主机！管理良好的服务器更便宜。）
    *   [`.user.ini`](https://www.php.net/manual/en/configuration.file.per-user.php)是用于现代设置的部分 php.ini (FCGI/FPM)

    作为运行时错误的粗略替代方法，您可以经常使用：

    ```
    set_error_handler("var_dump");   // ignores error_reporting and `@` suppression 
    ```

2.  [`error_get_last()`](http://php.net/error_get_last)

    当 error_display 被禁用时，可用于检索最后一次运行时通知/警告/错误。

3.  [`$php_errormsg`](https://www.php.net/manual/en/reserved.variables.phperrormsg.php)

    是一个超局部变量，它还包含最后一个 PHP 运行时消息。

4.  **`isset()`走开！**

    我知道这会让很多人不高兴，但**不**[`isset`](http://php.net/isset)应该[`empty`](http://php.net/empty)被新手使用。您可以在验证代码正常工作***后***添加通知抑制。但以前从来没有。

     ***我们最近收到的很多“某事不起作用”的问题都是由于以下拼写错误造成的：

    ```
    if(isset($_POST['sumbit']))
    #                  ↑↑ 
    ```

    如果您的代码中到处都是`isset`/ `empty`/ ，您将不会收到任何有用的通知`array_keys_exists`。有时[使用更明智`@`](https://stackoverflow.com/a/4261242)，因此通知和警告至少会出现在日志中。*** 
****   [`assert_options(ASSERT_ACTIVE|ASSERT_WARNING);`](https://www.php.net/manual/en/function.assert-options.php)

    获取`assert()`部分的警告。（相当少见，但更熟练的代码可能包含一些。）

    PHP7 也需要[`zend.assertions=1`](https://www.php.net/manual/en/ini.core.php#ini.zend.assertions)在 php.ini 中。

    *   [`declare(strict_types=1);`](https://www.php.net/manual/en/functions.arguments.php#functions.arguments.type-declaration.strict)

    将 PHP 转换为严格类型的语言并不能修复很多逻辑错误，但它绝对是用于调试目的的一种选择。

    *   **PDO / MySQLi**

    @Phil 已经提到了[PDO/MySQLi 错误报告](https://stackoverflow.com/a/52324601)选项。当然，其他数据库 API 也存在类似的选项。

    *   [`json_last_error()`](http://php.net/json_last_error)+[`json_last_error_msg`](http://php.net/json_last_error_msg)

    用于 JSON 解析。

    *   [`preg_last_error()`](http://php.net/preg_last_error)

    对于正则表达式。

    *   [CURLOPT_VERBOSE](https://stackoverflow.com/questions/3757071/php-debugging-curl)

    要调试 curl 请求，您至少需要 CURLOPT_VERBOSE。

    *   [`shell/exec()`](https://stackoverflow.com/questions/12199353/how-can-i-debug-exec-problems)

    同样，shell 命令执行本身也不会产生错误。您总是需要`2>&1`并查看 $errno。*** 

 **** * *

## 回答 #32

> 赞同：2
> 
> 时间：2009-09-25T04:31:35.373

尝试在您的实际 php 文件中设置错误报告级别。或者，正如其他人所建议的那样，检查您的服务器设置——它可能是 php.ini 中的某些内容，或者与您的主机有关的某些限制。不要只依赖 .htaccess。此外，在进行故障排除时， print_r 任何您可能认为可疑的变量。

* * *

## 回答 #33

> 赞同：2
> 
> 时间：2009-09-25T04:45:28.790

您确定 PHP 实际上是`display_errors`从 .htaccess 中获取“”设置吗？检查`phpinfo()`函数的输出以确保。

此外，您应该检查以确保您没有使用' `@`'，如果您使用了'@include ...'或'@some_function(...)'，它可能会消除你的错误，在堆栈跟踪的某个地方.

* * *

## 回答 #34

> 赞同：2
> 
> 时间：2019-12-06T09:23:35.563

**PHP 错误处理**

有时您的应用程序不会按预期运行，从而导致错误。有许多可能导致错误的原因，例如：

Web 服务器可能磁盘空间不足 用户可能在表单字段中输入了无效值 您尝试访问的文件或数据库记录可能不存在 应用程序可能无权写入磁盘上的文件 A应用程序需要访问的服务可能暂时不可用 这些类型的错误称为运行时错误，因为它们发生在脚本运行时。它们与脚本运行前需要修复的语法错误不同。

专业的应用程序必须有能力优雅地处理此类运行时错误。通常这意味着更清楚、更准确地告知用户问题。

**了解错误级别**

通常，当出现阻止脚本正常运行的问题时，PHP 引擎会触发错误。每个错误都由一个整数值和一个相关的常数表示。下表列出了一些常见的错误级别：

[![在此处输入图像描述](https://i.stack.imgur.com/X4vgz.jpg)](https://i.stack.imgur.com/X4vgz.jpg)

PHP 引擎在遇到脚本问题时会触发错误，但您也可以自己触发错误以生成对用户更友好的错误消息。通过这种方式，您可以使您的应用程序更加复杂。以下部分描述了一些用于处理 PHP 中的错误的常用方法：

> 使用 die() 函数的基本错误处理

```
<?php // Try to open a non-existent file
     $file = fopen("sample.txt", "r");
?> 
```

如果该文件不存在，您可能会收到如下错误： **警告：fopen(sample.txt) [function.fopen]：无法打开流：C:\wamp\www\project\test 中没有这样的文件或目录。第 2 行的 php**

如果我们遵循一些简单的步骤，我们可以防止用户收到这样的错误消息：

```
<?php
if(file_exists("sample.txt")){
    $file = fopen("sample.txt", "r");
} else{
    die("Error: The file you are trying to access doesn't exist.");
}
?> 
```

现在，如果您运行上述脚本，您将收到如下错误消息：**错误：您尝试访问的文件不存在。**

正如您所看到的，通过在尝试访问文件之前执行一个简单的检查文件是否存在，我们可以生成对用户更有意义的错误消息。

上面使用的 die() 函数只是显示自定义错误消息并在未找到“sample.txt”文件时终止当前脚本。

> 创建自定义错误处理程序

您可以创建自己的错误处理函数来处理 PHP 引擎生成的运行时错误。自定义错误处理程序为您提供更大的灵活性并更好地控制错误，它可以检查错误并决定如何处理错误，它可能会向用户显示消息，将错误记录在文件或数据库中或通过 e 发送-mail，尝试解决问题并继续，退出脚本的执行或完全忽略错误。

自定义错误处理函数必须能够处理至少两个参数（errno 和 errstr），但是它可以选择接受额外的三个参数（errfile、errline 和 errcontext），如下所述：

[![在此处输入图像描述](https://i.stack.imgur.com/VvXUl.png)](https://i.stack.imgur.com/VvXUl.png)

这是一个简单的自定义错误处理函数的示例。每当发生错误时，都会触发该处理程序 customError()，无论多么微不足道。然后它将错误的详细信息输出到浏览器并停止脚本的执行。

```
<?php
// Error handler function
function customError($errno, $errstr){
    echo "<b>Error:</b> [$errno] $errstr";
}
?> 
```

您需要告诉 PHP 使用您的自定义错误处理函数——只需调用内置的 set_error_handler() 函数，传入函数的名称。

```
<?php
// Error handler function
function customError($errno, $errstr){
    echo "<b>Error:</b> [$errno] $errstr";
}

// Set error handler
set_error_handler("customError");

// Trigger error
echo($test);
?> 
```

> 错误记录

**在文本文件中记录错误消息**

您还可以将错误的详细信息记录到日志文件中，如下所示：

```
<?php
function calcDivision($dividend, $divisor){
    if($divisor == 0){
        trigger_error("calcDivision(): The divisor cannot be zero", E_USER_WARNING);
        return false;
    } else{
        return($dividend / $divisor);
    }
}
function customError($errno, $errstr, $errfile, $errline, $errcontext){
    $message = date("Y-m-d H:i:s - ");
    $message .= "Error: [" . $errno ."], " . "$errstr in $errfile on line $errline, ";
    $message .= "Variables:" . print_r($errcontext, true) . "\r\n";

    error_log($message, 3, "logs/app_errors.log");
    die("There was a problem, please try again.");
}
set_error_handler("customError");
echo calcDivision(10, 0);
echo "This will never be printed.";
?> 
```

> 触发错误

尽管 PHP 引擎在遇到脚本问题时会触发错误，但您也可以自己触发错误。这有助于使您的应用程序更加健壮，因为它可以在潜在问题变成严重错误之前对其进行标记。

要从脚本中触发错误，请调用 trigger_error() 函数，并传入您要生成的错误消息：

```
trigger_error("There was a problem."); 
```

考虑以下计算两个数字相除的函数。

```
<?php
function calcDivision($dividend, $divisor){
    return($dividend / $divisor);
}

// Calling the function
echo calcDivision(10, 0);
?> 
```

如果将零 (0) 值作为 $divisor 参数传递，PHP 引擎生成的错误将如下所示：**警告：第 3 行 C:\wamp\www\project\test.php 中除以零**

这条消息看起来信息量不大。考虑以下使用 trigger_error() 函数生成错误的示例。

```
<?php
function calcDivision($dividend, $divisor){
    if($divisor == 0){
        trigger_error("The divisor cannot be zero", E_USER_WARNING);
        return false;
    } else{
        return($dividend / $divisor);
    }
}

// Calling the function
echo calcDivision(10, 0);
?> 
```

现在脚本生成此错误消息：**警告：第 4 行 C:\wamp\www\project\error.php 中的除数不能为零**

如您所见，与前一个示例相比，第二个示例生成的错误消息更清楚地解释了问题。

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2009-09-25T11:07:03.183

在您的代码中使用`@inexistent_function_call();`将导致解释器安静地死亡并中止脚本解析。您应该检查无效函数并尽量不要使用错误抑制运算符（@ char）

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2016-08-09T12:21:27.833

您还可以像这样在终端（命令行）中运行该文件：`php -f filename.php`.

这会运行您的代码并为您提供相同的输出，以防您在`error.log`. 它提到了错误和行号。

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2009-09-25T07:04:03.160

一些应用程序自己处理这些指令，通过调用这样的东西：

```
error_reporting(E_ALL & ~E_DEPRECATED); or error_reporting(0); 
```

从而覆盖您的 .htaccess 设置。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2013-06-15T11:55:04.463

打开错误报告是正确的解决方案，但是它似乎在打开它的程序中不起作用，而仅在随后包含的程序中起作用。

因此，我总是创建一个文件/程序（我通常称之为“genwrap.php”），它与这里的流行解决方案具有基本相同的代码（即打开错误报告），然后它还包括我真正想要的页面称呼。

实现此调试有 2 个步骤；

**一**- 创建 genwrap.php 并将此代码放入其中：

```
<?php
error_reporting(-1);
ini_set('display_errors', 'On');

include($_REQUEST['page']);
?> 
```

**二**- 通过 genwrap.php 将链接更改为要调试的程序/页面，

例如：改变：

```
$.ajax('dir/pgm.php?param=val').done(function(data) { /* ... */ 
```

到

```
$.ajax('dir/genwrap.php?page=pgm.php&param=val').done(function(data) { /* ... */ 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2015-03-07T18:16:51.713

除了上面非常多的优秀答案之外，您还可以在您的项目中实现以下两个功能。他们将在应用程序/脚本退出之前捕获每个非语法错误。在这些功能中，您可以进行回溯并记录或向公众呈现令人愉快的“站点正在维护”消息。

致命错误：

```
register_shutdown_function 
```

[http://php.net/manual/en/function.register-shutdown-function.php](http://php.net/manual/en/function.register-shutdown-function.php)

错误：

```
set_error_handler 
```

[http://php.net/manual/en/function.set-error-handler.php](http://php.net/manual/en/function.set-error-handler.php)

回溯：

```
debug_backtrace 
```

[http://php.net/manual/en/function.debug-backtrace.php](http://php.net/manual/en/function.debug-backtrace.php)

* * *

## 回答 #40

> 赞同：0
> 
> 时间：2021-01-03T08:19:13.623

我像这样解决了我的整个 500 问题：

A.检查php.ini参数

1.  php.ini >> error_reporting = E_ALL | E_STRICT
2.  php.ini >> display_errors = On
3.  php.ini >> display_startup_errors = 关闭

B. 更新 IIS 管理器参数

1.  IIS 管理器 >> 错误页面 >> 500 >> 编辑功能设置 >> 详细错误

*在这一步中，您会收到 500 个这样的错误，并且没有加载 html。*

[![在此处输入图像描述](https://i.stack.imgur.com/kMmwC.png)](https://i.stack.imgur.com/kMmwC.png)

2.  IIS 管理器 >> FastCGI 设置 >> php-cgi.exe >> 标准错误模式 >> IgnoreAndReurn200

*在这一步中，您可以看到包含这样的 php 错误的 html 页面。* [![在此处输入图像描述](https://i.stack.imgur.com/fYGYE.png)](https://i.stack.imgur.com/fYGYE.png)

并做了 ：）

* * *

## 回答 #41

> 赞同：-1
> 
> 时间：2009-09-25T07:02:27.427

如果错误出现在 PHP 代码中，您可以在代码中使用 error_reporting() 函数来设置全部报告。

但是，这并不能处理 PHP 崩溃时的情况。有关这方面的信息仅在服务器日志中可用。也许您无权访问这些，但我合作过的许多托管服务提供商都有一些方法可以让您访问它。例如，我最喜欢的方法是在 .php 所在的当前目录中创建 error_log 文件。尝试在那里搜索或联系您的托管服务提供商。

* * *

## 回答 #42

> 赞同：-2
> 
> 时间：2013-05-10T22:01:23.107

`fastcgi_params`当或`fastcgi.conf`配置文件未正确包含在服务器配置中时，我也看到过此类错误。所以对我来说修复是一个愚蠢的：

`include /etc/nginx/fastcgi_params;`

我花了一个*小时*才发现...

# wpf - 绑定到设置中定义的值

> ID：845030
> 
> 赞同：82
> 
> 时间：2009-05-10T09:55:29.487
> 
> 标签：wpf, binding, appsettings

在 WPF 中，我可以对设置中定义的值使用绑定吗？如果可以，请提供样品。

* * *

## 回答 #1

> 赞同：141
> 
> 时间：2009-05-10T09:57:18.203

首先，您需要添加一个自定义 XML 命名空间，该命名空间将设计定义设置的命名空间：

```
xmlns:properties="clr-namespace:TestSettings.Properties" 
```

然后，在您的 XAML 文件中，使用以下语法访问默认设置实例：

```
{x:Static properties:Settings.Default} 
```

所以这是最终的结果代码：

```
<ListBox x:Name="lb"
         ItemsSource="{Binding Source={x:Static properties:Settings.Default},
                               Path=Names}" /> 
```

来源：[WPF - 如何将控件绑定到设置中定义的属性？](http://weblogs.asp.net/thomaslebrun/archive/2009/03/26/wpf-how-to-bind-a-control-to-a-property-defined-in-the-settings.aspx)

* * *

*注意：正如@Daniel 和@nabulke 所指出的，不要忘记将设置文件的**访问修饰符**`Public`设置为和**范围**设置为`User`*

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-05-10T23:19:01.250

上面的解决方案确实有效，但我发现它非常冗长......您可以使用自定义标记扩展，可以像这样使用：

```
<ListBox x:Name="lb" ItemsSource="{my:SettingBinding Names}" /> 
```

这是此扩展的代码：

```
public class SettingBindingExtension : Binding
{
    public SettingBindingExtension()
    {
        Initialize();
    }

    public SettingBindingExtension(string path)
        :base(path)
    {
        Initialize();
    }

    private void Initialize()
    {
        this.Source = WpfApplication1.Properties.Settings.Default;
        this.Mode = BindingMode.TwoWay;
    }
} 
```

更多细节在这里：[http ://www.thomaslevesque.com/2008/11/18/wpf-binding-to-application-settings-using-a-markup-extension/](http://www.thomaslevesque.com/2008/11/18/wpf-binding-to-application-settings-using-a-markup-extension/)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2016-02-24T15:51:57.467

@CSharper 的答案不适用于我用 VB.NET 编码的 WPF 应用程序（不是 C#，显然不像 99.999% 的其他 WPF 应用程序），因为我得到一个持续的编译器错误，抱怨`Settings`在命名空间中找不到`MyApp.Properties`，这不会去即使在重建之后也消失了。

经过大量在线搜索后，对我有用的是使用`local`我的应用程序主窗口 XAML 文件中默认创建的 XAML 命名空间：

```
<Window
    <!-- Snip -->
    xmlns:local="clr-namespace:MyApp"
    <!-- Snip -->
><!-- Snip --></Window> 
```

...并使用以下内容通过它绑定到我的设置（`MyBooleanSetting`我在类型和范围 User 的项目属性中定义的设置在哪里`Boolean`，使用默认的 Friend 访问修饰符）：

```
<CheckBox IsChecked="{Binding Source={x:Static local:MySettings.Default}, Path=MyBooleanSetting, Mode=TwoWay}"
          Content="This is a bound CheckBox."/> 
```

为确保实际保存设置，请务必调用

```
MySettings.Default.Save() 
```

...在您的代码隐藏中的某个地方（例如在`Me.Closing`您的文件的事件中`MainWindow.xaml.vb`）。

*（归功于此[Visual Studio 论坛帖子](https://social.msdn.microsoft.com/Forums/vstudio/en-US/ce03cf6b-cca0-472c-b130-04a9772b7535/binding-control-properties-to-application-settings?forum=wpf)的灵感；请参阅 Muhammad Siddiqi 的回复。）*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-01-13T19:26:32.043

这是我绑定用户设置的方式：

`propdp`通过键入然后 tab 两次来生成依赖变量。

```
 public UserSettings userSettings
    {
        get { return (UserSettings)GetValue(userSettingsProperty); }
        set { SetValue(userSettingsProperty, value); }
    }
    public static readonly DependencyProperty userSettingsProperty =
        DependencyProperty.Register("userSettings", typeof(UserSettings), typeof(MainWindow), new PropertyMetadata(UserSettings.Default)); 
```

现在，您可以通过以下方式绑定`userSettings`：

```
Value="{Binding userSettings.SomeUserSettingHere, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
```

并确保在更改用户设置或退出时保存用户设置：

```
UserSettings.Default.Save(); 
```

# php - 如何将 PHPUnit 集成到自定义框架

> ID：845032
> 
> 赞同：2
> 
> 时间：2009-05-10T09:56:56.363
> 
> 标签：php, frameworks, phpunit

我想将 PHPUnit 集成到我的框架中。我的意思是，在运行测试之前，我必须在开始时进行一些初始化，比如设置自动加载。

我想使用 cli 测试运行器，如果我理解正确，我必须创建一个类，它有一个静态函数 suite()，它返回 PHPUnit_Framework_TestSuite 的实例，并向该套件添加测试，如上所述[http://www.phpunit.de/manual/current/en/textui.h​​tml](http://www.phpunit.de/manual/current/en/textui.html)。

到目前为止，我想出了：

```
class MyTestFW {
    public static function suite() {
        // Do framework initialization here

        $suite = new PHPUnit_Framework_TestSuite();
        $suite->addTest(new SimpleTest());

        // Add more tests

        return $suite;
    }
} 
```

SimpleTest 是一个非常基本的测试类，它扩展了 PHPUnit_Framework_TestCase。当我运行“phpunit MyTestFW”时，我总是得到：

```
PHPUnit 3.3.16 by Sebastian Bergmann.

E

Time: 0 seconds

There was 1 error:

1) (SimpleTest)
RuntimeException: PHPUnit_Framework_TestCase::$name must not be NULL. 
```

有人可以帮帮我吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T10:06:35.747

`PHPUnit_Framework_TestCase::$name`在 TestCase 构造函数中设置，所以你可以试试这个：

```
$suite->addTest(new SimpleTest('simpletest')); 
```

**编辑1：**

我不知道你的代码，所以我不知道这是否有帮助。
我通常看到的是这个（作为上面的替代，而不是添加）：

```
$suite->addTestSuite('SimpleTest'); 
```

**编辑2：**

[phpunit 文档：第 7 章 - 组织测试](http://www.phpunit.de/manual/current/en/organizing-tests.html#organizing-tests.filesystem)

# python - 如何在 Python 中廉价地获取大文件的行数？

> ID：845058
> 
> 赞同：1202
> 
> 时间：2009-05-10T10:22:05.677
> 
> 标签：python, text-files, line-count

我需要在 python 中获取一个大文件（数十万行）的行数。记忆和时间方面最有效的方法是什么？

目前我这样做：

```
def file_len(fname):
    with open(fname) as f:
        for i, l in enumerate(f):
            pass
    return i + 1 
```

有可能做得更好吗？

* * *

## 回答 #1

> 赞同：741
> 
> 时间：2009-06-19T19:07:06.063

一行，可能相当快：

```
num_lines = sum(1 for line in open('myfile.txt')) 
```

* * *

## 回答 #2

> 赞同：422
> 
> 时间：2009-05-10T10:37:42.677

你没有比这更好的了。

毕竟，任何解决方案都必须读取整个文件，弄清楚`\n`你有多少，然后返回结果。

你有没有更好的方法来做到这一点而无需阅读整个文件？不确定...最好的解决方案将始终是 I/O-bound，你能做的最好的就是确保你不使用不必要的内存，但看起来你已经涵盖了。

* * *

## 回答 #3

> 赞同：221
> 
> 时间：2009-05-12T02:49:04.590

我相信内存映射文件将是最快的解决方案。我尝试了四个函数：OP（`opcount`）发布的函数；对文件中的行进行简单的迭代 ( `simplecount`)；带有内存映射文件 (mmap) ( `mapcount`) 的 readline；以及 Mykola Kharechko ( `bufcount`) 提供的缓冲读取解决方案。

我将每个函数运行了五次，并计算了一个 120 万行文本文件的平均运行时间。

Windows XP、Python 2.5、2GB RAM、2 GHz AMD 处理器

这是我的结果：

```
mapcount : 0.465599966049
simplecount : 0.756399965286
bufcount : 0.546800041199
opcount : 0.718600034714 
```

**编辑**：Python 2.6 的数字：

```
mapcount : 0.471799945831
simplecount : 0.634400033951
bufcount : 0.468800067902
opcount : 0.602999973297 
```

所以缓冲区读取策略似乎是 Windows/Python 2.6 最快的

这是代码：

```
from __future__ import with_statement
import time
import mmap
import random
from collections import defaultdict

def mapcount(filename):
    f = open(filename, "r+")
    buf = mmap.mmap(f.fileno(), 0)
    lines = 0
    readline = buf.readline
    while readline():
        lines += 1
    return lines

def simplecount(filename):
    lines = 0
    for line in open(filename):
        lines += 1
    return lines

def bufcount(filename):
    f = open(filename)                  
    lines = 0
    buf_size = 1024 * 1024
    read_f = f.read # loop optimization

    buf = read_f(buf_size)
    while buf:
        lines += buf.count('\n')
        buf = read_f(buf_size)

    return lines

def opcount(fname):
    with open(fname) as f:
        for i, l in enumerate(f):
            pass
    return i + 1

counts = defaultdict(list)

for i in range(5):
    for func in [mapcount, simplecount, bufcount, opcount]:
        start_time = time.time()
        assert func("big_file.txt") == 1209138
        counts[func].append(time.time() - start_time)

for key, vals in counts.items():
    print key.__name__, ":", sum(vals) / float(len(vals)) 
```

* * *

## 回答 #4

> 赞同：184
> 
> 时间：2014-12-17T04:32:25.760

我不得不在一个类似的问题上发布这个，直到我的声誉得分上升一点（感谢撞到我的人！）。

所有这些解决方案都忽略了一种使该程序运行得更快的方法，即使用无缓冲（原始）接口、使用字节数组和进行自己的缓冲。（这只适用于 Python 3。在 Python 2 中，默认情况下可能使用也可能不使用原始接口，但在 Python 3 中，您将默认使用 Unicode。）

使用计时工具的修改版本，我相信以下代码比提供的任何解决方案都更快（并且稍微更像 Python）：

```
def rawcount(filename):
    f = open(filename, 'rb')
    lines = 0
    buf_size = 1024 * 1024
    read_f = f.raw.read

    buf = read_f(buf_size)
    while buf:
        lines += buf.count(b'\n')
        buf = read_f(buf_size)

    return lines 
```

使用单独的生成器函数，这运行得更快：

```
def _make_gen(reader):
    b = reader(1024 * 1024)
    while b:
        yield b
        b = reader(1024*1024)

def rawgencount(filename):
    f = open(filename, 'rb')
    f_gen = _make_gen(f.raw.read)
    return sum( buf.count(b'\n') for buf in f_gen ) 
```

这可以通过使用 itertools 内联的生成器表达式完全完成，但看起来很奇怪：

```
from itertools import (takewhile,repeat)

def rawincount(filename):
    f = open(filename, 'rb')
    bufgen = takewhile(lambda x: x, (f.raw.read(1024*1024) for _ in repeat(None)))
    return sum( buf.count(b'\n') for buf in bufgen ) 
```

以下是我的时间安排：

```
function      average, s  min, s   ratio
rawincount        0.0043  0.0041   1.00
rawgencount       0.0044  0.0042   1.01
rawcount          0.0048  0.0045   1.09
bufcount          0.008   0.0068   1.64
wccount           0.01    0.0097   2.35
itercount         0.014   0.014    3.41
opcount           0.02    0.02     4.83
kylecount         0.021   0.021    5.05
simplecount       0.022   0.022    5.25
mapcount          0.037   0.031    7.46 
```

* * *

## 回答 #5

> 赞同：103
> 
> 时间：2009-05-10T10:28:29.610

你可以执行一个子进程并运行`wc -l filename`

```
import subprocess

def file_len(fname):
    p = subprocess.Popen(['wc', '-l', fname], stdout=subprocess.PIPE, 
                                              stderr=subprocess.PIPE)
    result, err = p.communicate()
    if p.returncode != 0:
        raise IOError(err)
    return int(result.strip().split()[0]) 
```

* * *

## 回答 #6

> 赞同：46
> 
> 时间：2011-07-26T06:51:01.980

这是一个 python 程序，用于使用多处理库在机器/内核之间分配行数。我的测试使用 8 核 windows 64 服务器将 2000 万行文件的计数从 26 秒提高到 7 秒。注意：不使用内存映射会使事情变得更慢。

```
import multiprocessing, sys, time, os, mmap
import logging, logging.handlers

def init_logger(pid):
    console_format = 'P{0} %(levelname)s %(message)s'.format(pid)
    logger = logging.getLogger()  # New logger at root level
    logger.setLevel( logging.INFO )
    logger.handlers.append( logging.StreamHandler() )
    logger.handlers[0].setFormatter( logging.Formatter( console_format, '%d/%m/%y %H:%M:%S' ) )

def getFileLineCount( queues, pid, processes, file1 ):
    init_logger(pid)
    logging.info( 'start' )

    physical_file = open(file1, "r")
    #  mmap.mmap(fileno, length[, tagname[, access[, offset]]]

    m1 = mmap.mmap( physical_file.fileno(), 0, access=mmap.ACCESS_READ )

    #work out file size to divide up line counting

    fSize = os.stat(file1).st_size
    chunk = (fSize / processes) + 1

    lines = 0

    #get where I start and stop
    _seedStart = chunk * (pid)
    _seekEnd = chunk * (pid+1)
    seekStart = int(_seedStart)
    seekEnd = int(_seekEnd)

    if seekEnd < int(_seekEnd + 1):
        seekEnd += 1

    if _seedStart < int(seekStart + 1):
        seekStart += 1

    if seekEnd > fSize:
        seekEnd = fSize

    #find where to start
    if pid > 0:
        m1.seek( seekStart )
        #read next line
        l1 = m1.readline()  # need to use readline with memory mapped files
        seekStart = m1.tell()

    #tell previous rank my seek start to make their seek end

    if pid > 0:
        queues[pid-1].put( seekStart )
    if pid < processes-1:
        seekEnd = queues[pid].get()

    m1.seek( seekStart )
    l1 = m1.readline()

    while len(l1) > 0:
        lines += 1
        l1 = m1.readline()
        if m1.tell() > seekEnd or len(l1) == 0:
            break

    logging.info( 'done' )
    # add up the results
    if pid == 0:
        for p in range(1,processes):
            lines += queues[0].get()
        queues[0].put(lines) # the total lines counted
    else:
        queues[0].put(lines)

    m1.close()
    physical_file.close()

if __name__ == '__main__':
    init_logger( 'main' )
    if len(sys.argv) > 1:
        file_name = sys.argv[1]
    else:
        logging.fatal( 'parameters required: file-name [processes]' )
        exit()

    t = time.time()
    processes = multiprocessing.cpu_count()
    if len(sys.argv) > 2:
        processes = int(sys.argv[2])
    queues=[] # a queue for each process
    for pid in range(processes):
        queues.append( multiprocessing.Queue() )
    jobs=[]
    prev_pipe = 0
    for pid in range(processes):
        p = multiprocessing.Process( target = getFileLineCount, args=(queues, pid, processes, file_name,) )
        p.start()
        jobs.append(p)

    jobs[0].join() #wait for counting to finish
    lines = queues[0].get()

    logging.info( 'finished {} Lines:{}'.format( time.time() - t, lines ) ) 
```

* * *

## 回答 #7

> 赞同：31
> 
> 时间：2017-04-03T07:48:20.070

[与此答案](https://stackoverflow.com/a/845069/1397061)类似的单行 bash 解决方案，使用现代`subprocess.check_output`功能：

```
def line_count(filename):
    return int(subprocess.check_output(['wc', '-l', filename]).split()[0]) 
```

* * *

## 回答 #8

> 赞同：28
> 
> 时间：2021-07-14T22:19:54.840

在进行[perfplot](https://github.com/nschloe/perfplot)分析后，必须推荐缓冲读取解决方案

```
def buf_count_newlines_gen(fname):
    def _make_gen(reader):
        while True:
            b = reader(2 ** 16)
            if not b: break
            yield b

    with open(fname, "rb") as f:
        count = sum(buf.count(b"\n") for buf in _make_gen(f.raw.read))
    return count 
```

它快速且节省内存。大多数其他解决方案的速度要慢约 20 倍。

[![在此处输入图像描述](https://i.stack.imgur.com/sdUM3.png)](https://i.stack.imgur.com/sdUM3.png)

* * *

重现情节的代码：

```
import mmap
import subprocess
from functools import partial

import perfplot

def setup(n):
    fname = "t.txt"
    with open(fname, "w") as f:
        for i in range(n):
            f.write(str(i) + "\n")
    return fname

def for_enumerate(fname):
    i = 0
    with open(fname) as f:
        for i, _ in enumerate(f):
            pass
    return i + 1

def sum1(fname):
    return sum(1 for _ in open(fname))

def mmap_count(fname):
    with open(fname, "r+") as f:
        buf = mmap.mmap(f.fileno(), 0)

    lines = 0
    while buf.readline():
        lines += 1
    return lines

def for_open(fname):
    lines = 0
    for _ in open(fname):
        lines += 1
    return lines

def buf_count_newlines(fname):
    lines = 0
    buf_size = 2 ** 16
    with open(fname) as f:
        buf = f.read(buf_size)
        while buf:
            lines += buf.count("\n")
            buf = f.read(buf_size)
    return lines

def buf_count_newlines_gen(fname):
    def _make_gen(reader):
        b = reader(2 ** 16)
        while b:
            yield b
            b = reader(2 ** 16)

    with open(fname, "rb") as f:
        count = sum(buf.count(b"\n") for buf in _make_gen(f.raw.read))
    return count

def wc_l(fname):
    return int(subprocess.check_output(["wc", "-l", fname]).split()[0])

def sum_partial(fname):
    with open(fname) as f:
        count = sum(x.count("\n") for x in iter(partial(f.read, 2 ** 16), ""))
    return count

def read_count(fname):
    return open(fname).read().count("\n")

b = perfplot.bench(
    setup=setup,
    kernels=[
        for_enumerate,
        sum1,
        mmap_count,
        for_open,
        wc_l,
        buf_count_newlines,
        buf_count_newlines_gen,
        sum_partial,
        read_count,
    ],
    n_range=[2 ** k for k in range(27)],
    xlabel="num lines",
)
b.save("out.png")
b.show() 
```

* * *

## 回答 #9

> 赞同：18
> 
> 时间：2013-10-08T12:46:12.630

我会使用 Python 的文件对象方法`readlines`，如下：

```
with open(input_file) as foo:
    lines = len(foo.readlines()) 
```

这将打开文件，在文件中创建行列表，计算列表的长度，将其保存到变量并再次关闭文件。

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2016-12-09T20:34:47.467

这是我使用纯 python 发现的最快的东西。您可以通过设置缓冲区来使用所需的任何内存量，尽管 2**16 在我的计算机上似乎是一个最佳位置。

```
from functools import partial

buffer=2**16
with open(myfile) as f:
        print sum(x.count('\n') for x in iter(partial(f.read,buffer), '')) 
```

我在这里找到了答案[为什么在 C++ 中从标准输入读取行比 Python 慢得多？](https://stackoverflow.com/questions/9371238/why-is-reading-lines-from-stdin-much-slower-in-c-than-python)并稍微调整了一下。这是一本很好的读物，可以理解如何快速计算行数，但`wc -l`仍然比其他任何东西快 75%。

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2009-05-10T10:33:41.173

```
def file_len(full_path):
  """ Count number of lines in a file."""
  f = open(full_path)
  nr_of_lines = sum(1 for line in f)
  f.close()
  return nr_of_lines 
```

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2017-01-06T08:29:12.090

一线解决方案：

```
import os
os.system("wc -l  filename") 
```

我的片段：

```
>>> os.system('wc -l *.txt')

0 bar.txt
1000 command.txt
3 test_file.txt
1003 total 
```

* * *

## 回答 #13

> 赞同：11
> 
> 时间：2017-07-26T18:13:47.253

这是我使用的，看起来很干净：

```
import subprocess

def count_file_lines(file_path):
    """
    Counts the number of lines in a file using wc utility.
    :param file_path: path to file
    :return: int, no of lines
    """
    num = subprocess.check_output(['wc', '-l', file_path])
    num = num.split(' ')
    return int(num[0]) 
```

更新：这比使用纯 python 略快，但以内存使用为代价。子进程在执行您的命令时将派生一个与父进程具有相同内存占用的新进程。

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2014-10-15T05:22:12.937

[凯尔的回答](https://stackoverflow.com/a/1019572/2698552)

```
num_lines = sum(1 for line in open('my_file.txt')) 
```

可能是最好的，替代方法是

```
num_lines =  len(open('my_file.txt').read().splitlines()) 
```

这是两者的性能比较

```
In [20]: timeit sum(1 for line in open('Charts.ipynb'))
100000 loops, best of 3: 9.79 µs per loop

In [21]: timeit len(open('Charts.ipynb').read().splitlines())
100000 loops, best of 3: 12 µs per loop 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2013-02-25T19:31:53.873

这个版本我得到了一个小的（4-8%）改进，它重用了一个常量缓冲区，所以它应该避免任何内存或 GC 开销：

```
lines = 0
buffer = bytearray(2048)
with open(filename) as f:
  while f.readinto(buffer) > 0:
      lines += buffer.count('\n') 
```

您可以使用缓冲区大小，也许会看到一些改进。

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2009-05-10T11:29:12.350

至于我，这个变体将是最快的：

```
#!/usr/bin/env python

def main():
    f = open('filename')                  
    lines = 0
    buf_size = 1024 * 1024
    read_f = f.read # loop optimization

    buf = read_f(buf_size)
    while buf:
        lines += buf.count('\n')
        buf = read_f(buf_size)

    print lines

if __name__ == '__main__':
    main() 
```

原因：缓冲比逐行读取快，`string.count`也非常快

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2010-05-05T11:48:21.900

为了完成上述方法，我尝试了 fileinput 模块的变体：

```
import fileinput as fi   
def filecount(fname):
        for line in fi.input(fname):
            pass
        return fi.lineno() 
```

并将一个 60 百万行的文件传递给上述所有方法：

```
mapcount : 6.1331050396
simplecount : 4.588793993
opcount : 4.42918205261
filecount : 43.2780818939
bufcount : 0.170812129974 
```

令我有点惊讶的是，fileinput 是如此糟糕，并且比所有其他方法都差得多......

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2011-11-25T14:55:52.607

我已经像这样修改了缓冲区案例：

```
def CountLines(filename):
    f = open(filename)
    try:
        lines = 1
        buf_size = 1024 * 1024
        read_f = f.read # loop optimization
        buf = read_f(buf_size)

        # Empty file
        if not buf:
            return 0

        while buf:
            lines += buf.count('\n')
            buf = read_f(buf_size)

        return lines
    finally:
        f.close() 
```

现在也计算空文件和最后一行（不带 \n）。

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2015-02-23T18:38:13.633

这段代码更短更清晰。这可能是最好的方法：

```
num_lines = open('yourfile.ext').read().count('\n') 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2014-08-28T09:09:45.287

如果想在 Linux 中用 Python 廉价地获取行数，我推荐这种方法：

```
import os
print os.popen("wc -l file_path").readline().split()[0] 
```

file_path 既可以是抽象文件路径，也可以是相对路径。希望这可能会有所帮助。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2018-09-17T10:27:25.337

简单方法：

1)

```
>>> f = len(open("myfile.txt").readlines())
>>> f

430 
```

```
>>> f = open("myfile.txt").read().count('\n')
>>> f
430
>>> 
```

```
num_lines = len(list(open('myfile.txt'))) 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2020-11-09T19:12:57.913

已经有很多答案了，但不幸的是，它们中的大多数只是一个几乎无法优化问题的小经济体......

我参与了几个项目，其中行数是软件的核心功能，并且尽可能快地处理大量文件至关重要。

行数的主要瓶颈是 I/O 访问，因为您需要读取每一行以检测行返回字符，所以根本没有办法。第二个潜在瓶颈是内存管理：一次加载越多，处理速度越快，但与第一个瓶颈相比，这个瓶颈可以忽略不计。

因此，除了诸如禁用 gc 收集和其他微观管理技巧之类的微小优化之外，有 3 种主要方法可以减少行计数函数的处理时间：

1.  **硬件解决方案：**主要且最明显的方式是非编程方式：购买速度非常快的 SSD/闪存硬盘。到目前为止，这是您获得最大速度提升的方法。

2.  **数据准备解决方案：**如果您生成或可以修改您处理的文件的生成方式，或者如果您可以对它们进行预处理，则首先将行返回转换为 unix 样式（`\n`），因为这将比 Windows 节省 1 个字符或MacOS 样式（节省不多，但很容易获得），其次，最重要的是，您可以编写固定长度的行。如果您需要可变长度，您可以随时填充较小的行。这样，您可以立即从总文件大小中计算行数，访问速度要快得多。通常，问题的最佳解决方案是对其进行预处理，以使其更适合您的最终目的。

3.  **并行化+硬件方案：**如果您可以购买多个硬盘（如果可能的话，还可以购买 SSD 闪存盘），那么您甚至可以通过利用并行化，通过在磁盘之间以平衡的方式（最简单的是按总大小平衡）存储文件来超越一个磁盘的速度，然后从所有这些磁盘中并行读取。然后，您可以期望获得与您拥有的磁盘数量成比例的乘数提升。如果购买多个磁盘不是您的选择，那么并行化可能无济于事（除非您的磁盘像某些专业级磁盘一样具有多个读取头，但即使这样，磁盘的内部高速缓存和 PCB 电路也可能成为瓶颈并阻止您完全并行使用所有磁头，而且您必须为这个硬盘设计一个特定的代码 将使用，因为您需要知道确切的集群映射，以便将文件存储在不同头下的集群上，以便之后可以用不同的头读取它们）。确实，众所周知，顺序读取几乎总是比随机读取快，并且在单个磁盘上的并行化将具有比顺序读取更类似于随机读取的性能（例如，您可以使用 CrystalDiskMark 在这两个方面测试您的硬盘驱动器速度） .

如果这些都不是一个选项，那么您只能依靠微观管理技巧将您的行计数功能的速度提高几个百分点，但不要指望任何真正重要的东西。相反，您可以预计，与您将看到的速度改进回报相比，您花在调整上的时间将不成比例。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2009-05-10T11:35:26.983

打开文件的结果是一个迭代器，它可以转换成一个序列，它有一个长度：

```
with open(filename) as f:
   return len(list(f)) 
```

这比您的显式循环更简洁，并且避免了`enumerate`.

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2009-05-10T18:20:28.523

那这个呢

```
def file_len(fname):
  counts = itertools.count()
  with open(fname) as f: 
    for _ in f: counts.next()
  return counts.next() 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2011-03-11T21:09:52.690

`count = max(enumerate(open(filename)))[0]`

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2011-07-19T15:55:39.633

这个怎么样？

```
import fileinput
import sys

counter=0
for line in fileinput.input([sys.argv[1]]):
    counter+=1

fileinput.close()
print counter 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2013-10-03T00:55:36.040

这个单线怎么样：

```
file_length = len(open('myfile.txt','r').read().split('\n')) 
```

使用此方法在 3900 行文件上计时需要 0.003 秒

```
def c():
  import time
  s = time.time()
  file_length = len(open('myfile.txt','r').read().split('\n'))
  print time.time() - s 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2014-03-21T06:10:30.660

```
print open('file.txt', 'r').read().count("\n") + 1 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2014-06-02T21:45:10.887

```
def line_count(path):
    count = 0
    with open(path) as lines:
        for count, l in enumerate(lines, start=1):
            pass
    return count 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2017-12-17T14:50:35.250

```
def count_text_file_lines(path):
    with open(path, 'rt') as file:
        line_count = sum(1 for _line in file)
    return line_count 
```

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2019-11-18T12:47:28.510

大文件的替代方法是使用[`xreadlines():`](https://python-reference.readthedocs.io/en/latest/docs/file/xreadlines.html)

```
count = 0
for line in open(thefilepath).xreadlines(  ): count += 1 
```

对于 Python 3，请参阅：Python 3[中的 xreadlines() 替代品是什么？](https://stackoverflow.com/questions/3541274/what-substitutes-xreadlines-in-python-3)

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2020-08-14T17:52:10.857

这是对其他一些答案的元评论。

*   行读取和缓冲`\n`计数技术不会为每个文件返回相同的答案，因为某些文本文件在最后一行的末尾没有换行符。您可以通过检查最后一个非空缓冲区的最后一个字节并在不是时添加 1 来解决此问题`b'\n'`。

*   在 Python 3 中，以文本模式和二进制模式打开文件会产生不同的结果，因为默认情况下，文本模式将 CR、LF 和 CRLF 识别为行尾（将它们全部转换为`'\n'`），而在二进制模式下，只有 LF 和 CRLF 会算了算了`b'\n'`。无论您是按行阅读还是进入固定大小的缓冲区，这都适用。经典的 Mac OS 使用 CR 作为行尾；我不知道这些文件现在有多常见。

*   缓冲区读取方法使用与文件大小无关的有限 RAM，而行读取方法可以在最坏的情况下一次将整个文件读入 RAM（特别是如果文件使用 CR 行结尾）。在最坏的情况下，它可能使用比文件大小更多的 RAM，因为动态调整行缓冲区大小以及（如果您以文本模式打开）Unicode 解码和存储的开销。

*   您可以通过预先分配一个字节数组并使用`readinto`而不是`read`. 现有答案之一（投票很少）这样做，但它有问题（它重复计算了一些字节）。

*   顶部缓冲区读取答案使用大缓冲区 (1 MiB)。由于操作系统预读，使用较小的缓冲区实际上可以更快。如果您一次读取 32K 或 64K，操作系统可能会在您请求之前将下一个 32K/64K 读取到缓存中，并且每次访问内核几乎都会立即返回。如果您一次读取 1 MiB，则操作系统不太可能推测性地读取整个兆字节。它可能预读的数量较少，但您仍将花费大量时间坐在内核中等待磁盘返回其余数据。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2009-05-10T18:36:20.650

为什么不读取前 100 行和后 100 行并估计平均行长度，然后将总文件大小除以这些数字？如果您不需要确切的值，这可能会起作用。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2014-11-02T03:58:48.893

您可以通过`os.path`以下方式使用该模块：

```
import os
import subprocess
Number_lines = int( (subprocess.Popen( 'wc -l {0}'.format( Filename ), shell=True, stdout=subprocess.PIPE).stdout).readlines()[0].split()[0] ) 
```

，其中`Filename`是文件的绝对路径。

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2018-01-18T22:29:03.297

如果文件可以放入内存，那么

```
with open(fname) as f:
    count = len(f.read().split(b'\n')) - 1 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2018-07-30T20:10:22.777

创建一个名为的可执行脚本文件`count.py`：

```
#!/usr/bin/python

import sys
count = 0
for line in sys.stdin:
    count+=1 
```

然后将文件的内容通过管道传输到 python 脚本中：`cat huge.txt | ./count.py`. Pipe 也适用于[Powershell](https://docs.microsoft.com/en-us/powershell/scripting/getting-started/fundamental/understanding-the-windows-powershell-pipeline?view=powershell-5.1)，因此您最终将计算行数。

对我来说，在 Linux 上它比简单的解决方案快 30%：

```
count=1
with open('huge.txt') as f:
    count+=1 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2020-06-23T10:53:00.317

## 使用 Numba

我们可以使用 Numba 来 JIT（及时）将我们的函数编译为机器码。def numbacountparallel(fname) 的运行速度比问题中的 def file_len(fname) 快 2.8 倍。

### 笔记：

在运行基准测试之前，操作系统已经将文件缓存到内存中，因为我在我的 PC 上没有看到太多的磁盘活动。第一次读取文件时，时间会慢很多，使得使用 Numba 的时间优势变得微不足道。

第一次调用该函数时，JIT 编译需要额外的时间。

如果我们做的不仅仅是计算行数，这将很有用。

Cython 是另一种选择。

[http://numba.pydata.org/](http://numba.pydata.org/)

### 结论

由于计数行将受 IO 限制，请使用问题中的 def file_len(fname) ，除非您想做的不仅仅是计数行。

```
import timeit

from numba import jit, prange
import numpy as np

from itertools import (takewhile,repeat)

FILE = '../data/us_confirmed.csv' # 40.6MB, 371755 line file
CR = ord('\n')

# Copied from the question above. Used as a benchmark
def file_len(fname):
    with open(fname) as f:
        for i, l in enumerate(f):
            pass
    return i + 1

# Copied from another answer. Used as a benchmark
def rawincount(filename):
    f = open(filename, 'rb')
    bufgen = takewhile(lambda x: x, (f.read(1024*1024*10) for _ in repeat(None)))
    return sum( buf.count(b'\n') for buf in bufgen )

# Single thread
@jit(nopython=True)
def numbacountsingle_chunk(bs):

    c = 0
    for i in range(len(bs)):
        if bs[i] == CR:
            c += 1

    return c

def numbacountsingle(filename):
    f = open(filename, "rb")
    total = 0
    while True:
        chunk = f.read(1024*1024*10)
        lines = numbacountsingle_chunk(chunk)
        total += lines
        if not chunk:
            break

    return total

# Multi thread
@jit(nopython=True, parallel=True)
def numbacountparallel_chunk(bs):

    c = 0
    for i in prange(len(bs)):
        if bs[i] == CR:
            c += 1

    return c

def numbacountparallel(filename):
    f = open(filename, "rb")
    total = 0
    while True:
        chunk = f.read(1024*1024*10)
        lines = numbacountparallel_chunk(np.frombuffer(chunk, dtype=np.uint8))
        total += lines
        if not chunk:
            break

    return total

print('numbacountparallel')
print(numbacountparallel(FILE)) # This allows Numba to compile and cache the function without adding to the time.
print(timeit.Timer(lambda: numbacountparallel(FILE)).timeit(number=100))

print('\nnumbacountsingle')
print(numbacountsingle(FILE))
print(timeit.Timer(lambda: numbacountsingle(FILE)).timeit(number=100))

print('\nfile_len')
print(file_len(FILE))
print(timeit.Timer(lambda: rawincount(FILE)).timeit(number=100))

print('\nrawincount')
print(rawincount(FILE))
print(timeit.Timer(lambda: rawincount(FILE)).timeit(number=100)) 
```

100 次调用每个函数的时间（以秒为单位）

```
numbacountparallel
371755
2.8007332000000003

numbacountsingle
371755
3.1508585999999994

file_len
371755
6.7945494

rawincount
371755
6.815438 
```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2021-08-11T03:08:56.780

我会使用的最简单和最短的方法是：

```
f = open("my_file.txt", "r")
len(f.readlines()) 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2021-08-23T04:58:52.470

我发现你可以。

```
f = open("data.txt")
linecout = len(f.readlines()) 
```

会给你一个答案

* * *

## 回答 #40

> 赞同：-1
> 
> 时间：2013-09-05T14:08:16.617

相似地：

```
lines = 0
with open(path) as f:
    for line in f:
        lines += 1 
```

* * *

## 回答 #41

> 赞同：-1
> 
> 时间：2015-01-27T07:08:00.337

另一种可能：

```
import subprocess

def num_lines_in_file(fpath):
    return int(subprocess.check_output('wc -l %s' % fpath, shell=True).strip().split()[0]) 
```

* * *

## 回答 #42

> 赞同：-1
> 
> 时间：2018-08-09T20:55:35.267

如果文件中的所有行长度相同（并且仅包含 ASCII 字符）*，则可以非常便宜地执行以下操作：

```
fileSize     = os.path.getsize( pathToFile )  # file size in bytes
bytesPerLine = someInteger                    # don't forget to account for the newline character
numLines     = fileSize // bytesPerLine 
```

***我怀疑如果使用像é**这样的unicode 字符，将需要更多的努力来确定一行中的字节数。

* * *

## 回答 #43

> 赞同：-2
> 
> 时间：2010-06-25T15:17:32.480

那这个呢？

```
import sys
sys.stdin=open('fname','r')
data=sys.stdin.readlines()
print "counted",len(data),"lines" 
```

* * *

## 回答 #44

> 赞同：-2
> 
> 时间：2010-12-05T16:45:54.443

为什么以下不起作用？

```
import sys

# input comes from STDIN
file = sys.stdin
data = file.readlines()

# get total number of lines in file
lines = len(data)

print lines 
```

在这种情况下， len 函数使用输入行作为确定长度的方法。

# c# - 如何动态创建表达式 > 谓词？

> ID：845059
> 
> 赞同：30
> 
> 时间：2009-05-10T10:22:54.583
> 
> 标签：c#, linq, lambda, expression-trees

我将如何使用表达式树来动态创建一个看起来像...的谓词

```
(p.Length== 5) && (p.SomeOtherProperty == "hello") 
```

这样我就可以像这样将谓词粘贴到 lambda 表达式中...

```
q.Where(myDynamicExpression)... 
```

我只需要指出正确的方向。

**更新：**对不起，我遗漏了我希望谓词具有上述多个条件的事实。对困惑感到抱歉。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-05-10T10:33:38.427

**原来的**

像这样：

```
 var param = Expression.Parameter(typeof(string), "p");
    var len = Expression.PropertyOrField(param, "Length");
    var body = Expression.Equal(
        len, Expression.Constant(5));

    var lambda = Expression.Lambda<Func<string, bool>>(
        body, param); 
```

* * *

**更新**

回复`(p.Length== 5) && (p.SomeOtherProperty == "hello")`：

```
var param = Expression.Parameter(typeof(SomeType), "p");
var body = Expression.AndAlso(
       Expression.Equal(
            Expression.PropertyOrField(param, "Length"),
            Expression.Constant(5)
       ),
       Expression.Equal(
            Expression.PropertyOrField(param, "SomeOtherProperty"),
            Expression.Constant("hello")
       ));
var lambda = Expression.Lambda<Func<SomeType, bool>>(body, param); 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-05-24T00:32:32.610

使用谓词构建器。

[http://www.albahari.com/nutshell/predicatebuilder.aspx](http://www.albahari.com/nutshell/predicatebuilder.aspx)

它很容易！

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-05-10T11:50:07.710

要将多个谓词与`&&`运算符组合在一起，您可以一次将它们连接在一起。

因此，如果您有一个名为 的 Expression 对象列表`predicates`，请执行以下操作：

```
Expression combined = predicates.Aggregate((l, r) => Expression.AndAlso(l, r)); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-09-03T12:41:44.380

将 Lambda 表达式相互关联：另一种方法是使用以下代码。它比我建议中的 Schotime 答案更灵活，并且可以完美运行。无需外部掘金

框架 4.0

```
 // Usage first.Compose(second, Expression.And)
    public static Expression<T> Compose<T>(this Expression<T> First, Expression<T> Second, Func<Expression, Expression, Expression> Merge)
    {
        // build parameter map (from parameters of second to parameters of first)
        Dictionary<ParameterExpression,ParameterExpression> map = First.Parameters.Select((f, i) => new { f, s = Second.Parameters[i] }).ToDictionary(p => p.s, p => p.f);

        // replace parameters in the second lambda expression with parameters from the first
        Expression secondBody = ParameterRebinder.ReplaceParameters(map, Second.Body);

        // apply composition of lambda expression bodies to parameters from the first expression 
        return Expression.Lambda<T>(Merge(First.Body, secondBody), First.Parameters);
    }

    public static Expression<Func<T, bool>> And<T>(this Expression<Func<T, bool>> First, Expression<Func<T, bool>> Second)
    {
        return First.Compose(Second, Expression.And);
    }

    public static Expression<Func<T, bool>> Or<T>(this Expression<Func<T, bool>> First, Expression<Func<T, bool>> second)
    {
        return First.Compose(second, Expression.Or);
    }

public class ParameterRebinder : ExpressionVisitor
{
    private readonly Dictionary<ParameterExpression, ParameterExpression> map;

    public ParameterRebinder(Dictionary<ParameterExpression, ParameterExpression> map)
    {
        this.map = map ?? new Dictionary<ParameterExpression, ParameterExpression>();
    }

    public static Expression ReplaceParameters(Dictionary<ParameterExpression, ParameterExpression> map, Expression exp)
    {
        return new ParameterRebinder(map).Visit(exp);
    }

    protected override Expression VisitParameter(ParameterExpression p)
    {
        ParameterExpression replacement;
        if (map.TryGetValue(p, out replacement))
        {
            p = replacement;
        }
        return base.VisitParameter(p);
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-11-05T16:55:28.813

**[我有一个名为Exrelsior](https://github.com/alexmurari/Exprelsior)**的开源项目，它提供了非常简单的方法来创建动态谓词：

根据您的示例：

```
var exp1 = ExpressionBuilder.CreateBinary<YourClass>("MyProperty.Length", 5, ExpressionOperator.Equals);

var exp2 = ExpressionBuilder.CreateBinary<YourClass>("SomeOtherProperty", "hello", ExpressionOperator.Equals);

var fullExp = exp1.And(exp2);

// Use it normally...
q.Where(fullExp) 
```

它甚至支持全文谓词生成，因此您可以从 HTTP GET 方法接收任何动态查询，例如：

```
var exp1 = ExpressionBuilder.CreateBinaryFromQuery<YourClass>("eq('MyProperty.Length', '5')");

var exp2 = ExpressionBuilder.CreateBinaryFromQuery<YourClass>("eq('SomeOtherProperty', 'hello')");

var fullExp = exp1.And(exp2);

// Use it normally...
q.Where(fullExp) 
```

它支持更多的数据类型和运算符。

链接：[https ://github.com/alexmurari/Exprelsior](https://github.com/alexmurari/Exprelsior)

# perl - Perl 中的“我的”和“我们的”有什么区别？

> ID：845060
> 
> 赞同：198
> 
> 时间：2009-05-10T10:24:53.970
> 
> 标签：perl, scope

我知道`my`Perl 中有什么。它定义了一个仅存在于定义它的块范围内的变量。做什么`our`？

与有何`our`不同？`my`

* * *

## 回答 #1

> 赞同：229
> 
> 时间：2009-05-20T02:22:23.093

有什么***`our`***不同，***`my`***有什么作用*`our`*？

总之：

自 Perl 5 以来可用，***`my`***是一种声明非包变量的方法，即：

*   私人的
*   新的
*   非全局的
*   与任何包分开，使变量*不能*以`$package_name::variable`.

另一方面，***`our`***变量是包变量，因此自动：

*   *全局*变量
*   绝对*不是私人的*
*   不一定是新的
*   *可以*在具有限定名称空间的包（或词法范围）之外访问，如`$package_name::variable`.

声明变量***`our`***允许您预先声明变量以便在*`use strict`*不出现拼写警告或编译时错误的情况下使用它们。从 Perl 5.6 开始，它已经取代了 obsolete *`use vars`*，它只是文件范围的，而不是词法范围的***`our`***。

例如，`$x`内部变量的正式限定名`package main`是`$main::x`. 当脚本使用or时，声明***`our $x`***允许您在声明`$x`范围内使用裸变量而不会受到惩罚（即，不会产生错误）。范围可能是一个、两个或多个包，或者一个小块。*`use strict`**`use strict "vars"`*

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2009-05-10T14:00:55.497

Cartman 和 Olafur 的 PerlMonks 和 PerlDoc 链接是一个很好的参考 - 下面是我的总结：

`my``{}`如果不在`{}`s中，则变量在由同一文件定义的单个块内或在同一文件内的词法范围内。它们不能从定义在同一词法范围/块之外的包/子例程中访问。

`our`变量在包/文件中的范围内，并且可以从任何代码`use`或`require`该包/文件访问 - 通过在包之间添加适当的命名空间来解决名称冲突。

只是为了完善它，`local`变量是“动态”作用域的，与`my`变量的不同之处在于它们也可以从同一块内调用的子例程中访问。

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2009-06-13T16:11:51.967

一个例子：

```
use strict;

for (1 .. 2){
    # Both variables are lexically scoped to the block.
    our ($o);  # Belongs to 'main' package.
    my  ($m);  # Does not belong to a package.

    # The variables differ with respect to newness.
    $o ++;
    $m ++;
    print __PACKAGE__, " >> o=$o m=$m\n";  # $m is always 1.

    # The package has changed, but we still have direct,
    # unqualified access to both variables, because the
    # lexical scope has not changed.
    package Fubb;
    print __PACKAGE__, " >> o=$o m=$m\n";
}

# The our() and my() variables differ with respect to privacy.
# We can still access the variable declared with our(), provided
# that we fully qualify its name, but the variable declared
# with my() is unavailable.
print __PACKAGE__, " >> main::o=$main::o\n";  # 2
print __PACKAGE__, " >> main::m=$main::m\n";  # Undefined.

# Attempts to access the variables directly won't compile.
# print __PACKAGE__, " >> o=$o\n";
# print __PACKAGE__, " >> m=$m\n";

# Variables declared with use vars() are like those declared
# with our(): belong to a package; not private; and not new.
# However, their scoping is package-based rather than lexical.
for (1 .. 9){
    use vars qw($uv);
    $uv ++;
}

# Even though we are outside the lexical scope where the
# use vars() variable was declared, we have direct access
# because the package has not changed.
print __PACKAGE__, " >> uv=$uv\n";

# And we can access it from another package.
package Bubb;
print __PACKAGE__, " >> main::uv=$main::uv\n"; 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-05-10T16:37:42.667

[Coping with Scopeping](http://perl.plover.com/FAQs/Namespaces.html)是对 Perl 范围规则的一个很好的概述。它已经足够老了，`our`没有在正文中讨论。**最后的注释**部分对此进行了处理。

这篇文章讨论了包变量和动态作用域，以及它与词法变量和词法作用域的区别。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-05-10T10:27:50.780

`my`用于局部变量，而`our`用于全局变量。

更多阅读*[Perl 中的变量作用域：基础知识](http://www.perlmonks.org/?node_id=66677)*。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-11-07T15:31:02.270

我曾经在 Perl 中遇到过一些关于词法声明的陷阱，这让我很困惑，这些陷阱也与这个问题有关，所以我只是在这里添加我的总结：

**1.定义还是声明？**

```
local $var = 42;
print "var: $var\n"; 
```

输出是`var: 42`。但是我们无法判断`local $var = 42;`是定义还是声明。但是这个怎么样：

```
use strict;
use warnings;

local $var = 42;
print "var: $var\n"; 
```

第二个程序会抛出错误：

```
Global symbol "$var" requires explicit package name. 
```

`$var`没有定义，这意味着`local $var;`只是一个声明！在使用`local`声明变量之前，请确保之前已将其定义为全局变量。

但为什么这不会失败？

```
use strict;
use warnings;

local $a = 42;
print "var: $a\n"; 
```

输出是：`var: 42`。

这是因为`$a`以及`$b`是 Perl 中预定义的全局变量。还记得[排序](http://perldoc.perl.org/functions/sort.html)功能吗？

**2\. 词汇还是全局？**

在开始使用 Perl 之前，我是一名 C 程序员，所以词法变量和全局变量的概念对我来说似乎很简单：它只对应于 C 中的自动变量和外部变量。但有一些小的区别：

在 C 中，外部变量是在任何功能块之外定义的变量。另一方面，自动变量是在功能块内定义的变量。像这样：

```
int global;

int main(void) {
    int local;
} 
```

在 Perl 中，事情很微妙：

```
sub main {
    $var = 42;
}

&main;

print "var: $var\n"; 
```

输出是`var: 42`。`$var`是一个全局变量，即使它是在功能块中定义的！实际上，在 Perl 中，默认情况下任何变量都被声明为全局变量。

教训是总是`use strict; use warnings;`在 Perl 程序的开头添加，这将迫使程序员显式声明词法变量，这样我们就不会被一些理所当然的错误搞砸。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-05-10T10:25:42.657

[perldoc](http://perldoc.perl.org/functions/our.html)对我们有很好的定义。

> 与 my 不同的是，它既为变量分配存储空间，又将简单名称与该存储空间相关联以在当前范围内使用，我们将简单名称与当前包中的包变量相关联，以在当前范围内使用。换句话说，our 具有与 my 相同的作用域规则，但不一定会创建变量。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-12-02T15:03:03.120

这只是与问题有点相关，但我刚刚发现了一个（对我而言）晦涩难懂的 perl 语法，您可以将其与“我们的”（包）变量一起使用，而您不能将其与“我的”（本地）一起使用变量。

```
#!/usr/bin/perl

our $foo = "BAR";

print $foo . "\n";
${"foo"} = "BAZ";
print $foo . "\n"; 
```

输出：

```
BAR
BAZ 
```

如果您将“我们的”更改为“我的”，这将不起作用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-09-05T12:09:38.160

```
print "package is: " . __PACKAGE__ . "\n";
our $test = 1;
print "trying to print global var from main package: $test\n";

package Changed;

{
        my $test = 10;
        my $test1 = 11;
        print "trying to print local vars from a closed block: $test, $test1\n";
}

&Check_global;

sub Check_global {
        print "trying to print global var from a function: $test\n";
}
print "package is: " . __PACKAGE__ . "\n";
print "trying to print global var outside the func and from \"Changed\" package:     $test\n";
print "trying to print local var outside the block $test1\n"; 
```

将输出：

```
package is: main
trying to print global var from main package: 1
trying to print local vars from a closed block: 10, 11
trying to print global var from a function: 1
package is: Changed
trying to print global var outside the func and from "Changed" package: 1
trying to print local var outside the block 
```

如果在尝试运行脚本时使用“use strict”会失败：

```
Global symbol "$test1" requires explicit package name at ./check_global.pl line 24.
Execution of ./check_global.pl aborted due to compilation errors. 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-11-05T11:08:47.070

只需尝试使用以下程序：

```
#!/usr/local/bin/perl
use feature ':5.10';
#use warnings;
package a;
{
my $b = 100;
our $a = 10;

print "$a \n";
print "$b \n";
}

package b;

#my $b = 200;
#our $a = 20 ;

print "in package b value of  my b $a::b \n";
print "in package b value of our a  $a::a \n"; 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2016-01-27T04:57:43.307

让我们想想解释器实际上是什么：它是一段代码，将值存储在内存中，并让它解释的程序中的指令通过它们的名称访问这些值，这些名称在这些指令中指定。因此，解释器的主要工作是制定规则，即我们应该如何使用这些指令中的名称来访问解释器存储的值。

在遇到“my”时，解释器创建一个词法变量：一个命名值，解释器只能在执行块时访问，并且只能从该句法块中访问。在遇到“我们的”时，解释器为包变量创建一个词法别名：它将一个名称绑定到包的值上，从那时起解释器应该将其作为词法变量的名称进行处理，直到块完成同名变量。

效果是您可以假装您正在使用词法变量并绕过对包变量的完全限定的“使用严格”规则。由于解释器在第一次使用时会自动创建包变量，因此使用“我们的”的副作用也可能是解释器也会创建一个包变量。在这种情况下，创建了两件事：一个包变量，解释器可以从任何地方访问它，前提是它按照“use strict”的要求正确指定（前面加上它的包名称和两个冒号），*以及*它的词法别名。

资料来源：

*   [http://perldoc.perl.org/functions/our.html](http://perldoc.perl.org/functions/our.html)
*   [http://perldoc.perl.org/perlsub.html#Private-Variables-via-my()](http://perldoc.perl.org/perlsub.html#Private-Variables-via-my())

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2013-05-16T08:02:24.187

```
#!/usr/bin/perl -l

use strict;

# if string below commented out, prints 'lol' , if the string enabled, prints 'eeeeeeeee'
#my $lol = 'eeeeeeeeeee' ;
# no errors or warnings at any case, despite of 'strict'

our $lol = eval {$lol} || 'lol' ;

print $lol; 
```

# maven-2 - m2eclipse 索引来自 Maven 存储库的 3rd-party jars

> ID：845065
> 
> 赞同：2
> 
> 时间：2009-05-10T10:27:21.517
> 
> 标签：maven-2, indexing, eclipse-plugin, repository, jar

我正在使用 Nexus 存储库。并使用安装了 m2eclipse 插件的 Eclipse 3.4。有时我需要上传不在中央存储库中的罐子（如 Sun 罐子）。所以我将它们上传到 Nexus 的“第 3 方”部分下。问题是当尝试将这些 jars 添加为依赖项时，eclipse 不会索引它们，因此它们不会作为选项提供。

有任何想法吗，

谢谢，罗南。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T21:07:47.633

我在我的项目中使用 Nexus 使用第三方 jars，我可以通过执行以下操作使用 m2eclipse 插件查看它们：

> 右键单击项目 --> Maven --> 更新依赖项

此外，可能需要注意的是，我也在 my`pom.xml`中定义了以下内容（不是在 中`settings.xml`）。

```
<repositories>
    <repository>
        <releases>
            <enabled>true</enabled>
            <updatePolicy>always</updatePolicy>
            <checksumPolicy>warn</checksumPolicy>
        </releases>
        <snapshots>
            <enabled>false</enabled>
        </snapshots>
        <id>public</id>
        <name>Maven 2 Repository (Releases)</name>
        <url>http://your.domain.com/nexus/content/groups/public</url>
        <layout>default</layout>
    </repository>
    <repository>
        <snapshots>
            <enabled>true</enabled>
            <updatePolicy>always</updatePolicy>
            <checksumPolicy>warn</checksumPolicy>
        </snapshots>
        <releases>
            <enabled>false</enabled>
        </releases>
        <id>public-snapshots</id>
        <name>Maven 2 Repository (Snapshots)</name>
        <url>http://your.domain.com/nexus/content/groups/public-snapshots</url>
        <layout>default</layout>
    </repository>
</repositories>

<pluginRepositories>
    <pluginRepository>
        <releases>
            <enabled>true</enabled>
            <updatePolicy>always</updatePolicy>
            <checksumPolicy>warn</checksumPolicy>
        </releases>
        <snapshots>
            <enabled>false</enabled>
        </snapshots>
        <id>public</id>
        <name>Maven 2 Repository (Releases)</name>
        <url>http://your.domain.com/nexus/content/groups/public</url>
        <layout>default</layout>
    </pluginRepository>
    <pluginRepository>
        <snapshots>
            <enabled>true</enabled>
            <updatePolicy>always</updatePolicy>
            <checksumPolicy>warn</checksumPolicy>
        </snapshots>
        <releases>
            <enabled>false</enabled>
        </releases>
        <id>public-snapshots</id>
        <name>Maven 2 Repository (Snapshots)</name>
        <url>http://your.domain.com/nexus/content/groups/public-snapshots</url>
        <layout>default</layout>
    </pluginRepository>
</pluginRepositories> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-25T02:51:23.747

settings.xml 更简单：

```
 <mirror>  
  <id>public</id>  
  <url>http://yourserver/nexus-webapp-1.5.0/content/groups/public/</url> 
  <mirrorOf>*</mirrorOf>  
</mirror> 
```

# python - VIM：使用 python 2.5 和 vim 7.2

> ID：845068
> 
> 赞同：1
> 
> 时间：2009-05-10T10:27:57.957
> 
> 标签：python, vim

如何使用 Python2.5 with 在 vi​​m 中编写脚本？我正在使用 vim 7.2 并拥有 Python 2.5。Vim 7.2 似乎与 Python 2.4 链接我必须从源代码编译吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T10:30:19.450

[这](http://www.gooli.org/blog/gvim-72-with-python-2526-support-windows-binaries/)是一个指向支持 Python 2.5/2.6 的 VIM 7.2 构建的链接。

# python - 使用 MemoryDC 时的问题

> ID：845071
> 
> 赞同：1
> 
> 时间：2009-05-10T10:30:26.250
> 
> 标签：python, graphics, wxpython

为什么我的代码将线条打印为灰色而不是黑色？

```
import wx

class MyFrame(wx.Frame):
    def __init__(self,*args,**kwargs):
        wx.Frame.__init__(self,*args,**kwargs)
        self.panel=wx.Panel(self,-1,size=(1000,1000))
        self.Bind(wx.EVT_PAINT, self.on_paint)
        self.Bind(wx.EVT_SIZE, self.on_size)

        self.bitmap=wx.EmptyBitmapRGBA(1000,1000,255,255,255,255)

        dc=wx.MemoryDC()
        dc.SelectObject(self.bitmap)
        dc.SetPen(wx.Pen(wx.NamedColor("black"),10,wx.SOLID))
        dc.DrawCircle(0,0,30)
        dc.DrawLine(40,40,70,70)
        dc.Destroy()

        self.Show()

    def on_size(self,e=None):
        self.Refresh()

    def on_paint(self,e=None):
        dc=wx.PaintDC(self.panel)
        dc.DrawBitmap(self.bitmap,0,0)
        dc.Destroy()

if __name__=="__main__":
    app=wx.PySimpleApp()
    my_frame=MyFrame(parent=None,id=-1)
    app.MainLoop() 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T22:20:01.527

除了已经指出的框架/面板油漆问题之外，颜色问题是由于 32 位图的 Alpha 通道造成的。

我记得有 read to use`wx.GCDC`而不是`wx.DC`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T04:15:50.813

好的，我使用较新版本的 wx(2.8.9.2) 进行了测试

现在我想知道为什么它甚至对你有用。您正在尝试绘制 Panel 但覆盖 Frame 的绘制事件

而是这样做

```
self.panel.Bind(wx.EVT_PAINT, self.on_paint) 
```

一切都会好起来的

# javascript - 为什么这段代码这么慢？

> ID：845073
> 
> 赞同：2
> 
> 时间：2009-05-10T10:32:57.243
> 
> 标签：javascript, performance

```
jsc.tools.road.correctType = function() {
    for(row = jsc.data.selection.startX - 1; row <= jsc.data.selection.endX + 1; row++) {
        for(col = jsc.data.selection.startY - 1; col <= jsc.data.selection.endY + 1; col++) {
            if(jsc.data.cells[row-1][col].type != "road" && jsc.data.cells[row+1][col].type != "road" && jsc.data.cells[row][col].type == "road") {
                jsc.ui.addClassToCell("horz", row, col);
            }
            else {
                jsc.ui.removeClassFromCell("horz", row, col);
            }
            if(jsc.data.cells[row][col-1].type != "road" && jsc.data.cells[row][col+1].type != "road" && jsc.data.cells[row][col].type == "road") {
                jsc.ui.addClassToCell("vert", row, col);
            }
            else {
                jsc.ui.removeClassFromCell("vert", row, col);
            }
        }
    }
};

// Elsewhere
jsc.ui.addClassToCell = function(class, x, y) {
    $("#" + x + "-" + y).addClass(class);
};
jsc.ui.removeClassFromCell = function(class, x, y) {
    $("#" + x + "-" + y).removeClass(class);
}; 
```

上面的代码运行得很慢。我不知道为什么。它使用 jQuery 1.3.2。有什么办法可以稍微优化一下吗？

编辑：代码是我作为个人项目制作的 javascript 游戏的一部分。它基本上是模拟城市的克隆。这段代码检查道路每个部分的相邻单元格，并将类别（以及背景图像）更改为正确的类别，以使道路图像正确排列，例如水平、垂直和交叉点（无类别）道路图像。

编辑 2：提供一些上下文的更多细节。

jsc.data.cells 是一个 200 x 200 的数组。每个数组元素都是一个具有如下属性的对象（默认显示）： {type: null, Developed: false, powered: false, watered: false, hasTransport: false, fortune: 0, quality: 0} 。

它的对应物在 UI 中，它基本上是一个巨大的表格。（再次为 200 x 200）。每个单元格在整个程序中都添加了许多 CSS 类来更改背景图像（例如，.road 将其更改为道路，.com.develop 使其成为发达的商业区）。每个表格单元格都有一个 #xy 形式的 id，这是 jsc.ui.addClassToCell 和 jsc.ui.removeClassFromCell 编辑的内容。

编辑 3：修复了以数字开头的 ID。现在尝试一些优化。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-10T11:06:48.863

使用 O() 表示法的简短估计：

```
for(row) ... O(N)
for(col) ... O(N)
$().addClass/removeClass ... O(N^2) 
```

$() 甚至在嵌套的 for 中被调用了两次。

所以你最终得到 O(N^4)

您可以通过在 jsc.data.cells[row][col] 的 as 属性中缓存计算的类来优化这一点，例如

```
jsc.data.cells[row][col].horz = 1; // don't set class "horz" if not present
jsc.data.cells[row][col].vert = 1; 
```

并在 HTML 表格中创建单元格时使用缓存数据，而不是为每个单元格调用 $()。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T10:54:50.717

我只能给出一些提示，但不知道它们是否有很大帮助。无法测试您的代码。

1-st：在本地函数范围内声明变量。我的意思是您声明为全局的 row 和 col 变量（缺少 var 语句）。访问全局变量（AFAIK）比访问局部范围变量需要更长的时间（AFAIK）。

```
var row = jsc.data.selection.startX-1;

var col = jsc.data.selection.startY-1; 
```

2-nd：缓存对公共对象的引用。在这里，您可以存储 jsc.data 和/或 jsc.data.selection 和 jsc.data.cells 的引用。IIRC，对对象属性的访问是线性的。

```
jsc.tools.road.correctType = function() {
   var data = jsc.data, selection = data.selection, cells = jsc.data.cells, ui.jsc.ui;

   for(var row = selection.startX - 1, endX = selection.endX + 1, endY = selection.endY + 1; row <= endX; ++row) {
      for(var col = selection.startY - 1; col <= endY; ++col) {
         if(cells[row-1][col].type != "road" && cells[row+1][col].type != "road" && cells[row][col].type == "road") {
            ui.addClassToCell("horz", row, col);
         } else {
            ui.removeClassFromCell("horz", row, col);
         }
         if(cells[row][col-1].type != "road" && cells[row][col+1].type != "road" && cells[row][col].type == "road") {
            ui.addClassToCell("vert", row, col);
         } else {
            ui.removeClassFromCell("vert", row, col);
         }
      }
   }
}; 
```

我还将 endY 变量的声明移到了外循环，因此不会在每次访问内循环时计算它。

- 编辑

希望您知道，ID 属性值[不能以数字开头](http://www.w3.org/TR/html401/types.html#type-id)，例如您所拥有的。#2-3

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T11:02:57.653

根据您选择的大小，您可能会进行大量条件检查和 DOM 编辑。

通过注释掉 addClassToCell 和 removeClassFromCell 的内容并比较运行时间，您可以了解是条件检查还是 dom 编辑花费的时间最多，从而哪一个是优化的最佳候选者。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-10T11:06:37.693

通常你可以显着优化这样的循环；

```
for( var x = 0; x < someMethod(); x++ ) {
  //... do stuff
} 
```

通过用这样的东西交换它们

```
var x = someMethod();
while( x-- ) {
  //...do stuff
} 
```

尽管它在语义上略有不同，但只要您不依赖循环中的顺序（顺序相反），它通常工作得很好

即使您无法更改顺序，您也可以通过将 someMethod 调用移出实际循环来显着改进代码，因为在许多 JS 实现中，每次迭代都会调用一次......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-10T15:34:18.337

使用[memoizer](http://unscriptable.com/index.php/2009/05/01/a-better-javascript-memoizer/)或本地缓存来存储您已经创建的 jQuery 对象。这将减少`$`函数的调用次数。

```
var cache = {}, selector;
for (/* … */) {
    selector = "#" + x + "-" + y;
    if (!cache[selector]) {
        cache[selector] = $(selector);
    }
    // cache[selector] refers to the same object as $("#" + x + "-" + y)
} 
```

# objective-c - 为什么 Clang 抱怨我所有的自动释放对象？

> ID：845080
> 
> 赞同：3
> 
> 时间：2009-05-10T10:36:28.497
> 
> 标签：objective-c, memory-leaks, clang

我有以下功能：

```
- (NSString *)urlEncodedValue {
NSString *result = (NSString *)CFURLCreateStringByAddingPercentEscapes(
                   kCFAllocatorDefault, 
                   (CFStringRef)self, 
                   NULL, 
                   CFSTR("?=&+/\r\n"), 
                   kCFStringEncodingUTF8
);

return [result autorelease];

} 
```

为什么 Clang 会给我以下投诉？

*   1 调用函数“CFURLCreateStringByAddingPercentEscapes”返回一个核心基础对象，保留计数为 +1（拥有引用）
*   2 对象发送 -autorelease 消息
*   3 对象作为拥有引用返回给调用者（单个保留计数转移给调用者）
*   4 对象过度自动释放：对象已发送 -autorelease 但对象的保留计数为零（本地可见）

据我所知，这符合 Apple 关于内存管理和对象所有权的准则。我必须明确释放对象吗？这个错误在我的项目中出现了 19 次，都是在类似的情况下出现的。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-14T06:20:43.790

我已经找到了我自己问题的答案，如果其他人偶然发现了这个问题，请在此处发布。我正在使用 checker-0.198，checker-0.204 报告没有这样的问题。似乎是暂时的倒退。

# .net - 如何增加系统的用户数量？

> ID：845086
> 
> 赞同：0
> 
> 时间：2009-05-10T10:41:33.383
> 
> 标签：.net, sql-server, wcf, client-server

我有一个客户端/服务器应用程序，它依赖于 MS SQL 数据库进行后端存储，服务器应用程序是一个 WCF TCP 服务，它通过从数据库信息集中进行选择来处理客户端请求。

该服务配置为 PerSession 并支持 500 个会话。在客户端，用户可以打开不同的视图，每个视图都有一个我的服务对象（代理对象），所以每个视图都是一个会话；每个视图都有一个线程计时器，每秒使用代理对象从服务器请求数据。

该应用程序对于具有 8 个视图的少量用户运行良好，但是当我增加数量时，SqlConnection.Open 中发生超时异常，因为连接池中没有可用的连接。

每个视图都有会话/对象，因为 WCF 服务不是线程安全的；它依赖于使用 SqlDataReaders 和 SqlAdapters 的单线程数据库访问层。

有没有办法增加数据库连接的数量？好像800是最高的！！从您的角度来看，我怎样才能增加用户数量？

我是否应该更改 DB 层并使其成为多线程并使 WCF 服务单一？我认为这是设计中的瓶颈（您能推荐一篇关于 ADO.net 中的多线程的文章）

PS：

我可以用内存数据库或任何更快的存储替换数据库吗？

根据答案：

我更改了后端服务以关闭每个方法调用的连接，但我面临同样的问题，因为用户数量增加了延迟增加（超过一秒），这是否意味着我必须更改数据库解决方案？什么是替代解决方案？

之后：

我尝试了两种解决方案

1.  每个方法调用打开和关闭 sql 连接
2.  增加连接字符串中连接池的大小

但是，如果我增加用户数量，两者都会给我带来延迟，同时我监控 sql porfiler 中的查询，似乎每个查询不会超过 20 毫秒。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-10T11:00:15.383

不要为每个会话保持打开数据库连接，而是在每个客户端调用结束时关闭它，以便将连接返回到连接池。（连接在池中时不会完全关闭，因此重用时重新连接很快。）

这样，每个会话将仅在真正需要时才使用连接。您应该看到特定数量的会话所需的连接数量急剧减少，并且您的应用程序应该能够处理更多的会话。

此外，由于会话不保留连接，因此您对会话数量没有绝对限制。如果会话需要连接时没有可用的连接，它将重试一段时间，直到有可用的连接。只有当服务器真正超载（即请求进来的速度比服务器处理它们的速度快）时，你才会得到超时错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T10:47:10.750

最好的免费在线多线程书籍之一是 Joe Albahari 的[Threading in C#](http://www.albahari.com/threading/)

Jon Skeet 的[.NET 中的多线程：介绍和建议](http://www.yoda.arachsys.com/csharp/threads/)也很棒

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T13:17:15.353

积极关闭连接。仔细检查所有实现 IDisposible 的 ADO.NET 组件的包装，使用块或 try/finally 块调用 IDisposable 和 .Close 连接、命令、数据读取器等。

800 个打开的连接是连接泄漏，除非你有像 VISA 或谷歌这样的同时交易数量的人。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T18:01:53.280

我必须同意早期的海报，你应该考虑关闭连接。同时，您可以在连接字符串中指定连接池大小：Max Pool Size

```
data source=RemoteHostName;initial catalog=myDb;password=sa;user id=sa;
Max pool size = 200; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T07:49:50.337

找到一篇关于 SQL Server Connection Pooling (ADO.NET) 的文章，您可能会觉得它很有用。

[SQL Server 连接池 (ADO.NET)](http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-23T07:53:26.537

经过一组实验后，我通过一组更改将我的系统的用户数量增加了 800%

1.  最大化连接池大小
2.  为客户端创建单个代理对象并串行而不是并行发送他的请求
3.  优化 sql 查询并在服务端使用一些缓存

# ruby - 如何在 Ruby 中创建自定义的 IO 子类？

> ID：845087
> 
> 赞同：10
> 
> 时间：2009-05-10T10:41:44.540
> 
> 标签：ruby

我如何创建自己的类来替代 IO，以便例如重定向/捕获某些接受类似 IO 参数的代码的输入/输出？IO 本身似乎与 OS 文件描述符耦合，而我所知道的唯一一个模仿它而不对其进行子类化的类是 StringIO，它似乎只是重新实现了整个接口。

我认为该语言会提供一种直接的方式来做到这一点，但我找不到关于这个主题的任何信息。有没有像 Enumerable 那样在几个原语之上实现接口的 mixin？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-10T11:15:40.043

我怀疑我遗漏了一些东西，但假设情况并非如此......

为什么子类化不是一种选择？你不能只覆盖需要表现不同的 IO 部分吗？

```
class MyIO < IO
  # your modified methods go here. e.g.
  def some_io_method(args)
    do_some_preprocessing
    super(args)
    do_some_post_processing
  end
end 
```

如果你不能替换你的自制子类，那么修改 IO 本身（“猴子补丁”）怎么样：

```
class IO
  alias_method :original_some_io_method, :some_io_method
  def some_io_method(args)
    do_some_preprocessing
    original_some_io_method(args)
    do_some_post_processing
  end
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-13T12:33:31.053

我已成功使用以下技巧使 StringIO 成为“真正的”IO：

```
 # make mechanize believe our address xml actually is an IO so it will be uploaded as a file:
    address_io = StringIO.new(address_xml)
    class << address_io
      alias is_a_old is_a?
      def is_a?(stuff)
        stuff == IO || is_a_old(stuff)
      end
      def path
        'address.xml'
      end
    end 
```

# c# - 如何在 C 中初始化多维字符数组？

> ID：845089
> 
> 赞同：4
> 
> 时间：2009-05-10T10:46:31.547
> 
> 标签：c#, c, arrays, multidimensional-array

我正在尝试将一些代码从 C# 转换为 C，以便可以将其刻录到微控制器上。

有人可以告诉我如何将 C# 中的二维字符串数组转换为 C 中的东西吗？

我的 C# 代码如下所示：

```
string[,] DirectionPosition = {{"00", "10", "", "01", ""},
                                        {"01", "11", "", "02", "00"},
                                        {"02", "12", "", "03", "01"},
                                        {"03", "13", "", "04", "02"},
                                        {"04", "14", "", "", "03"},
                                        {"10", "20", "00", "11", ""},
                                        {"11", "21", "01", "12", "10"},
                                        {"12", "22", "02", "13", "11"},
                                        .
                                        .
                                        .
                                        .
                                        {"44", "", "34", "", "43"},}; 
```

此外，我将如何访问这些元素？在 C# 中，如果我想要第三行中的第二个元素，它只是 DirectionPosition[2,1] 但是当 C 中没有字符串更不用说二维字符串数组时，它的等价物是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-10T10:57:27.760

最简单的方法是使用 char 指针，如下所示：

```
char *DirectionPosition[9][5] = {
    {"00", "10", "",   "01", ""  },
    {"01", "11", "",   "02", "00"},
    {"02", "12", "",   "03", "01"},
    {"03", "13", "",   "04", "02"},
    {"04", "14", "",   "",   "03"},
    {"10", "20", "00", "11", ""  },
    {"11", "21", "01", "12", "10"},
    {"12", "22", "02", "13", "11"},
    {"44", "",   "34", "",   "43"}
}; 
```

第一行中的元素“10”被引用为`DirectionPosition[0][1]`（从零开始，第一个索引是行，第二个是列）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-10T10:53:42.107

```
char DirectionPosition[][ 5 ][ 3 ] = {{"00", "10", "", "01", ""},
                                    {"01", "11", "", "02", "00"},
                                    {"02", "12", "", "03", "01"},
                                    {"03", "13", "", "04", "02"},
                                    {"04", "14", "", "", "03"},
                                    {"10", "20", "00", "11", ""},
                                    {"11", "21", "01", "12", "10"},
                                    {"12", "22", "02", "13", "11"},
                                    .
                                    .
                                    .
                                    .
                                    {"44", "", "34", "", "43"},}; 
```

C 没有内置的字符串类，您必须使用字符数组。您也可以使用指向 char 的指针。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T10:59:11.110

我建议确定字符串的最大长度和每行的最大字符串数并告诉编译器，例如：

```
typedef char string[3];
typedef string s5[5];

    s5 DirectionPosition[] = {{"00", "10", "", "01", ""}, {"01", "11", "", "02", "00"}, {"02", "12", "", "03", "01"}, {"03", "13", "", "04", "02"}, {"04", "14", "", "", "03"}, {"10", "20", "00", "11", ""}, {"11", "21", "01", "12", "10"}, {"12", "22", "02", "13", "11"}, {"44", "", "34", "", "43"},}; 
```

现在，DirectionPosition[2][1] &c 将允许您访问矩阵中的特定字符串。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T11:35:58.807

没有所有额外的括号，有一种稍微简单的方法：

```
#include <stdio.h>

int main(int argc, char **argv) {

char DirectionPosition[][ 5 ][ 3 ] = {"00", "10", "", "01", "",
                                    "01", "11", "", "02", "00",
                                    "02", "12", "", "03", "01",
                                    "03", "13", "", "04", "02",
                                    "04", "14", "", "", "03",
                                    "10", "20", "00", "11", "",
                                    "11", "21", "01", "12", "10",
                                    "12", "22", "02", "13", "11",
                                    "44", "", "34", "", "43"};

    printf("dp[1][1] == %s\n", DirectionPosition[1][1]);
    printf("dp[1][2] == %s\n", DirectionPosition[1][2]);
    printf("dp[1][3] == %s\n", DirectionPosition[1][3]);

    return;
} 
```

# asp.net - 焦点不在javascript中

> ID：845090
> 
> 赞同：0
> 
> 时间：2009-05-10T10:46:49.940
> 
> 标签：asp.net, javascript

我有一个按钮`aspx`。在其中`onclientclick`我调用了一个用`JScript.js`. 以下是我的javascript：

```
function ChangeBG()
{
   alert("hi");
} 
```

我在按钮单击中调用了上述函数。我在javascript中放了断点。但是onclicking按钮，警报来了，但控制不会断点。这可能是什么原因？我在 Internet 浏览器中运行。我可以做些什么改变来把焦点带到断点。有人可以帮忙吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T12:06:13.510

在`alert("hi");`放 stmt之前`debugger;`

```
ChangeBG() 
{
  debugger; 
  alert("hi"); 
} 
```

当您处于调试模式时，您的控件将进行调试。当 javascript 在单独的 js 文件中时会出现此问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T11:42:59.160

也这样做以在您的 IE 浏览器中启用调试转到

**工具-->Internet 选项-->高级**

取消选中 -*禁用脚本调试 (Internet Explorer)*

# javascript - 构建垂直编辑器有多困难/耗时？

> ID：845092
> 
> 赞同：0
> 
> 时间：2009-05-10T10:49:00.653
> 
> 标签：javascript, editor

这个编辑器是水平的[http://tinymce.moxiecode.com/examples/simple.php](http://tinymce.moxiecode.com/examples/simple.php) 我似乎只能找到水平的编辑器，有人遇到过垂直的编辑器吗？有什么例子吗？建造需要多长时间？

我的意思是工具栏是水平的，而我想使用垂直的？（我不是指语言）我听说这很难做到

我相信这是他们遇到的问题： [http ://tinymce.moxiecode.com/punbb/viewtopic.php?id=13834](http://tinymce.moxiecode.com/punbb/viewtopic.php?id=13834)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T11:36:48.667

如果它只是工具栏，您可以尝试通过 css 移动它（即使用 tinymce）。我只是忽略了 html 代码，我在那里看到了一个简单的表格结构。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T12:10:58.343

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T11:38:43.653

这只是一个文本区域小部件：

```
<textarea wrap=true rows=10 cols=5>xxx</textarea> 
```

这将创建一个“垂直”入口区域。

使用 css overflow:hidden 也将完全删除滚动条。

# c# - XSL 转换 XML->XML 仅输出文本？

> ID：845104
> 
> 赞同：1
> 
> 时间：2009-05-10T11:00:43.387
> 
> 标签：c#, xml, xaml, xslt

您好我有以下 XAML 代码，它是 XamlWriter.Save() 的输出：

```
<StackPanel Name="itemStack" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:mm="clr-namespace:MindManager;assembly=MindManager">
  <mm:Item Width="Auto" Height="Auto">
    <Border BorderThickness="10,10,10,10" Name="border1" Height="Auto">
      <DockPanel>
        <DockPanel LastChildFill="True" Name="dockPanel1" Height="33" DockPanel.Dock="Top">
          <Button Name="deleteItemButton" Width="26" Height="21.638" FlowDirection="LeftToRight" DockPanel.Dock="Right" Grid.IsSharedSizeScope="False">x</Button>
          <TextBox Name="tagsTextBox" Height="19">1</TextBox>
        </DockPanel>
        <TextBox TextWrapping="Wrap" MinLines="5" AcceptsReturn="True" AcceptsTab="True" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Disabled" AutoWordSelection="True" Name="contentTextBox" Width="Auto" MinWidth="600" Height="Auto" MinHeight="80">2</TextBox>
      </DockPanel>
    </Border>
  </mm:Item>
  <mm:Item Width="Auto" Height="Auto">
    <Border BorderThickness="10,10,10,10" Name="border1" Height="Auto">
      <DockPanel>
        <DockPanel LastChildFill="True" Name="dockPanel1" Height="33" DockPanel.Dock="Top">
          <Button Name="deleteItemButton" Width="26" Height="21.638" FlowDirection="LeftToRight" DockPanel.Dock="Right" Grid.IsSharedSizeScope="False">x</Button>
          <TextBox Name="tagsTextBox" Height="19">3</TextBox>
        </DockPanel>
        <TextBox TextWrapping="Wrap" MinLines="5" AcceptsReturn="True" AcceptsTab="True" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Disabled" AutoWordSelection="True" Name="contentTextBox" Width="Auto" MinWidth="600" Height="Auto" MinHeight="80">4</TextBox>
      </DockPanel>
    </Border>
  </mm:Item>
</StackPanel> 
```

我想使用以下 XSL 将其转换为更简单的 XML：

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:msxsl="urn:schemas-microsoft-com:xslt" exclude-result-prefixes="msxsl" xmlns:mm="clr-namespace:MindManager;assembly=MindManager">  
  <xsl:output method="xml" indent="yes"/>
    <xsl:template match="/StackPanel">
      <mindcontainer>
        <xsl:for-each select="mm:Item">
          <minditem>
            <xsl:value-of select="/tagsTextBox"/>
            <xsl:value-of select="/contentTextBox"/>
          </minditem>
        </xsl:for-each>
      </mindcontainer>
    </xsl:template>
</xsl:stylesheet> 
```

我希望输出具有以下格式：

```
<mindcontainer>
 <minditem>
   content of tagsTextBox
   content of contentTextBox
 </minditem>
 <minditem>
   content of tagsTextBox
   content of contentTextBox
 </minditem>
</mindcontainer> 
```

但问题是我从中得到的只是：

```
 x
  1

2

  x
  3

4 
```

可以看到只有文本，没有文本，过滤器也不起作用，x是我不想输出的关闭按钮的标签。

这是我用来执行转换的代码：

```
 XmlWriterSettings settings = new XmlWriterSettings();
    settings.Indent=true;

    StringBuilder sb = new StringBuilder();
    using (XmlWriter wr = XmlWriter.Create(sb, settings))
    {
        XamlWriter.Save(scrollViewer1.Content, wr);
    }

    settings.ConformanceLevel = ConformanceLevel.Auto;
    using (XmlReader rd = XmlReader.Create(new StringReader(sb.ToString())))
    {
        XslCompiledTransform trans = new XslCompiledTransform();
        trans.Load("output.xsl");

        trans.Transform(rd, XmlWriter.Create("mindstore.xms", settings));
    } 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T11:24:21.410

在 XPath/XSLT 1.0 中，要选择（或匹配）名称空间中的元素，您*必须*声明名称空间前缀并在表达式（或模式）中使用该前缀。不要被`<StackPanel>`其他元素在输入 XML 中不使用前缀的事实所迷惑。它使用默认命名空间，由该默认命名空间声明确定：

```
xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
```

所以你需要在你的样式表中有一个相应的声明（就像你对“mm”命名空间所做的那样），除了你需要选择一个命名空间前缀来使用。任何前缀都可以（就像您实际上不必使用“mm”）。

```
<xsl:stylesheet version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  ...> 
```

然后，在您的样式表中，您需要更新您的表达式和模式以使用您选择的前缀（`x`在我上面的示例中为“”）：

```
<xsl:template match="/x:StackPanel"> 
```

您看到输出的原因是您的模板规则从未被调用（因为名称不匹配）。相反，会调用每个 XPath 节点类型的内置模板规则。对于根节点和元素节点，它只是继续处理子节点。对于文本节点，就是复制它们。因此，您看到的行为与任何空样式表（没有模板规则）的行为相同：输入文档中所有文本节点的转储。

必须在每个表达式或模式中为每个名称测试添加前缀可能会很痛苦。这就是为什么 XSLT 2.0 引入了一个名为 的特性`xpath-default-namespace`，它使 XPath 表达式和 XSLT 模式可以使用默认名称空间，就像 XML 中的元素一样。在这种情况下，您所要做的就是添加一行：

```
<xsl:stylesheet version="2.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xpath-default-namespace="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  ...> 
```

但这只是在您使用 XSLT 2.0 处理器的情况下。（例如，MSXML 不支持 XSLT 2.0。）

在我离开您之前，我在您的样式表中看到了更多问题（毫无疑问，您接下来会发现）：

```
 <xsl:value-of select="/tagsTextBox"/>
        <xsl:value-of select="/contentTextBox"/> 
```

以“”开头的表达式`/`意味着“从文档/根节点开始”。所以这些表达式分别寻找一个`<tagsTextBox>`文档元素和一个`<contentTextBox>`文档元素。根据我在您的示例输入文档中看到的内容，我认为您要写的是：

```
 <xsl:value-of select=".//x:TextBox[@Name = 'tagsTextBox']"/>
        <xsl:value-of select=".//x:TextBox[@Name = 'contentTextBox']"/> 
```

希望这可以帮助！让我知道是否需要进一步解释。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T11:26:46.350

您的问题至少在 XSLT 中：

1.  您需要将匹配的表达式放在正确的名称空间中，因为它们要匹配。例如

    ```
    ... xml:xaml='http://schemas.microsoft.com/winfx/2006/xaml/presentation'
    <xsl:template match='/xaml:StackPanel'>... 
    ```

2.  `value-of`表达式 (match`/tagsTextBox`和`/contentText`) Box 似乎打算在 StackPanel 中匹配，但是：

    *   也缺乏命名空间资格
    *   匹配文档根的直接子节点，而不是当前内容节点的后代节点。您可能需要：

        ```
        <xsl:value-of select='descendent::xaml:TextBox'/> 
        ```

并且可能更多。

# javascript - 如何使用 JavaScript 验证货币价值？

> ID：845105
> 
> 赞同：1
> 
> 时间：2009-05-10T11:00:44.510
> 
> 标签：javascript

我在页面中有一些输入字段，我想验证它们是否包含货币值，例如 100 美元或欧元。

有人有想法或例子吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-10T11:09:20.667

这里的问题有三个：

1.  有[很多货币符号](http://www.xe.com/symbols.php)；
2.  货币具有相同的符号（例如，$ 表示澳元或美元）；和
3.  书写数字的区域差异（例如，英语中的 3,000.00 是德语中的 3,000,00）。

我的建议？只需取数字并忘记货币符号。但是，如果检测货币是重点，那么要么单独选择它，要么您需要至少实现上述货币列表的一个子集以及区域设置差异。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T11:05:58.380

正则表达式可以为您验证：

```
/[\$£¥]\d+(\.\d\d)?/ 
```

（但也有欧元标志）

我给出的这个不是最可靠的方法。你可以改变你的喜好。另一种方法是尝试这样的事情：

```
var myString = "$55.32",
    currency = parseFloat(myString.replace(/^[^\d\.]*/, ''))
    valid = !isNaN(currency)
; 
```

它从一开始就去掉任何非数字或`.`字符，然后将其解析为浮点数。

# .net - LINQ to XML - 它是如何工作的？

> ID：845106
> 
> 赞同：11
> 
> 时间：2009-05-10T11:01:53.587
> 
> 标签：.net, xml, linq, linq-to-xml

我的问题本质上是一个简单的问题，尽管我在这里寻找尽可能深入的答案：*[LINQ to XML](http://msdn.microsoft.com/en-us/library/bb387098.aspx)**如何在幕后工作？*

现在，我在各种应用程序中使用 LINQ to XML 有相当多的经验，所以它的接口对我来说并不奇怪，但我对内部如何操作一无所知。现在，我对 LINQ 提供程序的工作方式（本质上是实现和利用访问者模式）有了一些[`IQueryable`](http://msdn.microsoft.com/en-us/library/system.linq.iqueryable.aspx)了解[`IQueryProvider`](http://msdn.microsoft.com/en-us/library/system.linq.iqueryprovider.aspx)。然而，我还没有发现任何关于 LINQ to XML 的 LINQ 提供程序的信息——即使使用 Reflector 也没有让我有所收获，尽管我可能错过了显而易见的事情。最有趣的是，我无法在程序集/命名空间中找到任何 LINQ 提供程序（的实现`IQueryProvider`）的证据。`System.Xml.Linq`

通过观察 LINQ to XML 模型，我发现它是一种相当独特的 LINQ 形式，因为 LINQ 查询和相关的语法似乎并不是该技术的整体，它似乎更多地基于可查询的 DOM模型提供了很多有用的扩展方法。所以真的，我首先想知道的是，LINQ to XML 是否甚至有标准意义上的查询提供程序（例如 LINQ to SQL 有），或者它本质上是一个带有扩展方法的框架，您可以在其之上使用 LINQ to Objects 以方便使用。此外，我也很好奇从 XML 代码到 DOM 层次结构的解析/转换是如何完成的`XDocument`——qutie`XmlDocument`在这个意义上与旧的相似吗？`XmlReader`它是否在幕后使用或这样的方式在加载时解析和解释文档？

这是一个非常开放的问题，因此任何关于 LINQ to XML 如何在幕后运行的信息都将受到欢迎。我在这里的主要目的是建立一个关于如何设计这种特定 LINQ 技术的图景，以便我随后可以尝试自己模拟它以获得与 XML 结构相似的格式。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-10T11:20:31.870

LINQ to XML 实际上只是 LINQ-to-Objects，它适用于表示 XML 的对象。因此，当您编写 LINQ 查询以从 XDocument 中检索节点时（例如），您实际上只是在调用返回 IEnumerable<T> 的扩展方法，并调用为 IEnumerable<T> 定义的标准查询运算符。

因此，可以说 LINQ-to-XML 主要由 XElement 系列的 XML 表示类和为这些类提供的许多扩展方法组成，以使查询更容易。

这也在[这里](http://www.alexthissen.nl/blogs/main/archive/2008/03/21/an-explanation-of-linq-query-providers.aspx)解释。

# asp.net - 安装 Oracle 和环回适配器后无法访问 localhost/iis

> ID：845108
> 
> 赞同：0
> 
> 时间：2009-05-10T11:04:17.777
> 
> 标签：asp.net, visual-studio, iis, localhost, loopback

最近我安装了 Oracle 和所需的 Microsoft Loopback Adaptor，效果很好。但是，这似乎以某种方式搞砸了 IIS（或至少它与 Visual Studio 的交互）。我无法再连接到 localhost 或 127.0.0.1，我什至无法在 Visual Studio 2008 中打开 Web 项目（以前可以正常工作），出现错误“本地 IIS URL [http://localhost/MyProject](http://localhost/MyProject)为 Web 项目指定 MyProject 尚未配置。要打开此项目，需要配置虚拟目录。您要现在创建此目录吗？我点击是，然后它给出了一个错误，它“在当前机器上找不到服务器[http://localhost ”。](http://localhost)

IIS 正在运行，我可以连接到默认的 IIS 网站和 localhost:1122 上的 inetput/wwwroot 的其他内容。

我试图禁用环回适配器并注释掉我需要添加到主机以使 Oracle 工作的行，虽然这阻止了 Oracle 工作，但它对 IIS/localhost 没有帮助。

编辑：事实证明，这是通过从备份中恢复项目来解决的，所以它一定是项目本身的某种问题。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-10T11:11:58.630

我猜这是环回适配器的问题。您可能必须正确恢复连接设置。从控制面板->网络连接中检查环回适配器是否正确禁用以及连接设置是否正确。编辑：在设置中进行所有必要的更改后，最好重新启动系统。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T11:22:48.560

您可以将本地 IIS 配置为侦听不同的端口。右键单击默认网站，选项卡网站，然后高级。例如添加 1234 作为 TCP 端口。

然后你可以像[http://localhost:1234/YourProject一样连接](http://localhost:1234/YourProject)

您可以从文件系统在 Visual Studio 中打开网站，并在 Project -> Property Pages -> Start Options -> Use custom server 中指定新 URL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T12:06:38.737

好的，我终于设法通过删除项目并从备份中恢复来完成这项工作。我猜项目配置以某种方式搞砸了，导致我得到错误，而不是 IIS 本身存在问题。很抱歉误报。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-19T19:34:28.547

我今天在 Windows XP 和 IIS 5 上发生了类似的事情。不管它是什么。问题是我安装的一个工具在默认网站下创建了一些没有应用程序名称的虚拟目录。

解决方案是打开 IIS 管理单元，右键单击并选择有问题的虚拟目录的属性，然后在弹出的属性对话框的“虚拟目录”选项卡下组成一个“应用程序名称”。只要默认网站下没有具有空白应用程序名称的虚拟目录，我将其命名为什么并不重要。

# python - 在 python 中模拟传值行为

> ID：845110
> 
> 赞同：72
> 
> 时间：2009-05-10T11:05:50.173
> 
> 标签：python, pass-by-value

我想模拟 python 中的按值传递行为。换句话说，我想绝对确保我编写的函数不会修改用户提供的数据。

一种可能的方法是使用深拷贝：

```
from copy import deepcopy
def f(data):
    data = deepcopy(data)
    #do stuff 
```

是否有更有效或更*pythonic*的方式来实现这个目标，对传递的对象做出尽可能少的假设（例如 .clone() 方法）

**编辑**

我知道从技术上讲，python 中的所有内容都是按值传递的。我对*模拟*这种行为很感兴趣，即确保我不会弄乱传递给函数的数据。我想最通用的方法是使用自己的克隆机制或使用 deepcopy 克隆有问题的对象。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-05-10T17:16:08.470

没有pythonic方式可以做到这一点。

Python 提供了很少的工具来*强制执行*诸如私有或只读数据之类的事情。pythonic 的哲学是“我们都是同意的成年人”：在这种情况下，这意味着“函数不应更改数据”是规范的一部分，但未在代码中强制执行。

* * *

如果你想复制数据，你能得到的最接近的就是你的解决方案。但是`copy.deepcopy`，除了效率低下，还有一些注意事项[，例如](http://docs.python.org/library/copy.html)：

> 因为深拷贝复制了它可能复制过多的所有内容，例如，即使在副本之间也应该共享的管理数据结构。
> 
> [...]
> 
> 此模块不复制模块、方法、堆栈跟踪、堆栈帧、文件、套接字、窗口、数组或任何类似类型等类型。

所以我只推荐它，如果你知道你正在处理内置的 Python 类型或你自己的对象（你可以通过定义`__copy__`/`__deepcopy__`特殊方法来自定义复制行为，不需要定义你自己的`clone()`方法）。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-05-10T11:57:47.867

您可以制作一个装饰器并将克隆行为放入其中。

```
>>> def passbyval(func):
def new(*args):
    cargs = [deepcopy(arg) for arg in args]
    return func(*cargs)
return new

>>> @passbyval
def myfunc(a):
    print a

>>> myfunc(20)
20 
```

这不是最健壮的方式，并且不处理键值参数或类方法（缺少 self 参数），但您明白了。

请注意，以下语句是相等的：

```
@somedecorator
def func1(): pass
# ... same as ...
def func2(): pass
func2 = somedecorator(func2) 
```

您甚至可以让装饰器采用某种功能来进行克隆，从而允许装饰器的用户决定克隆策略。在这种情况下，装饰器可能最好作为一个`__call__`重写的类来实现。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2012-03-18T22:32:10.410

只有几个内置类型可以用作引用，`list`例如 .

所以，对我来说，在这个例子中，对列表进行传值的pythonic方法是：

```
list1 = [0,1,2,3,4]
list2 = list1[:] 
```

`list1[:]`创建 list1 的新实例，您可以将其分配给新变量。

也许您可以编写一个可以接收一个参数的函数，然后检查它的类型，并根据该结果执行一个内置操作，该操作可以返回传递的参数的一个新实例。

正如我之前所说，只有少数内置类型，它们的行为类似于引用，本示例中的列表。

无论如何...希望它有所帮助。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-07-04T12:30:47.993

通常在将数据传递给外部 API 时，您可以通过将数据作为不可变对象传递来确保数据的完整性，例如将数据包装到元组中。如果这是您试图通过代码阻止的，则无法修改。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-10T11:16:43.767

我想不出任何其他*pythonic*选项。但就我个人而言，我更喜欢更*面向对象*的方式。

```
class TheData(object):
  def clone(self):  """return the cloned"""

def f(data):
  #do stuff

def caller():
  d = TheData()
  f(d.clone()) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-01-23T11:25:36.847

继*user695800 的*回答之后，使用 [:] 运算符按值传递可能的列表

```
def listCopy(l):
    l[1] = 5
    for i in l:
        print i 
```

用

```
In [12]: list1 = [1,2,3,4]

In [13]: listCopy(list1[:])
1
5
3
4

list1
Out[14]: [1, 2, 3, 4] 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-07-04T21:11:20.150

虽然我确信没有真正的 Pythonic 方法可以做到这一点，但我希望该`pickle`模块会为您提供您将任何业务视为价值的所有内容的副本。

```
import pickle

def f(data):
    data = pickle.loads(pickle.dumps((data)))
    #do stuff 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-12-30T15:22:23.660

许多人使用标准库[副本](https://docs.python.org/3/library/copy.html)。我更喜欢在我的课程中定义`__copy__`或。`__deepcopy__`中的方法`copy`可能存在一些问题。

1.  浅拷贝将保留对原始对象的引用，而不是创建新对象。
2.  deepcopy 会递归运行，有时可能会导致死循环。如果没有足够的注意力，内存可能会爆炸。

为避免这些失控行为，请通过覆盖`__copy__`和`__deepcopy__`. 亚历[克斯的回答](https://stackoverflow.com/a/1500887/7672954)举了一个很好的例子。

# python - 在 Python 中添加简洁的向量？

> ID：845112
> 
> 赞同：48
> 
> 时间：2009-05-10T11:05:59.223
> 
> 标签：python

我经常做 Python 列表的向量加法。

示例：我有两个这样的列表：

```
a = [0.0, 1.0, 2.0]
b = [3.0, 4.0, 5.0] 
```

我现在想将 b 添加到 a 以获得结果`a = [3.0, 5.0, 7.0]`。

通常我最终会这样做：

```
a[0] += b[0]
a[1] += b[1]
a[2] += b[2] 
```

有没有一些有效的、标准的方法来减少打字？

更新：可以假设列表的长度为 3 并且包含浮点数。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-05-10T11:21:09.093

如果您需要高效的向量算术，请尝试[Numpy](http://numpy.scipy.org/)。

```
>>> import numpy
>>> a=numpy.array([0,1,2])
>>> b=numpy.array([3,4,5])
>>> a+b
array([3, 5, 7])
>>> 
```

或者（感谢 Andrew Jaffe），

```
>>> a += b
>>> a
array([3, 5, 7])
>>> 
```

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2009-05-10T22:54:47.560

我认为您不会找到比问题中提出的 3 个总和更快的解决方案。numpy 的优势在更大的向量中是显而易见的，如果您需要其他运算符也是如此。numpy 对矩阵特别有用，巫婆对 python 列表很有用。

不过，还有另一种方法：D

```
In [1]: a = [1,2,3]

In [2]: b = [2,3,4]

In [3]: map(sum, zip(a,b))
Out[3]: [3, 5, 7] 
```

**编辑**：您还可以使用来自 itertools 的 izip，它是 zip 的生成器版本

```
In [5]: from itertools import izip

In [6]: map(sum, izip(a,b))
Out[6]: [3, 5, 7] 
```

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2009-05-10T13:15:23.803

虽然 Numeric 非常出色，如果您真的想创建一个新列表，列表理解解决方案也可以，但我很惊讶没有人建议“一种明显的方法”——一个简单的`for`循环！最好的：

```
for i, bi in enumerate(b): a[i] += bi 
```

也可以，有点：

```
for i in xrange(len(a)): a[i] += b[i] 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-05-10T17:58:53.830

如果你认为 Numpy 太过分了，这应该真的很快，因为这段代码在纯 C 中运行（`map()`并且`__add__()`都直接用 C 实现）：

```
a = [1.0,2.0,3.0]
b = [4.0,5.0,6.0]

c = map(float.__add__, a, b) 
```

或者，如果您不知道列表中的类型：

```
import operator
c = map(operator.add, a, b) 
```

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-05-10T11:09:52.753

这个怎么样：

```
a = [x+y for x,y in zip(a,b)] 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-05-10T11:21:22.510

或者，如果您愿意使用外部库（和固定长度的数组），请使用[numpy](http://numpy.scipy.org/)，它具有“+=”和用于就地操作的相关操作。

```
import numpy as np
a = np.array([0, 1, 2])
b = np.array([3, 4, 5])
a += b 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-05-10T11:11:33.407

[a[x] + b[x] for x in range(0,len(a))]

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2015-09-02T16:41:23.353

对于拥有列表列表的一般情况，您可以执行以下操作：

```
In [2]: import numpy as np

In [3]: a = np.array([[1, 1, 1], [2, 2, 2], [3, 3, 3],[4, 5, 6]])

In [4]: [sum(a[:,i]) for i in xrange(len(a[0]))]
Out[4]: [10, 11, 12] 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-06-05T20:52:01.650

如果您追求简洁，请尝试...

```
vectors = [[0.0, 1.0, 2.0],[3.0, 4.0, 5.0]]
[sum(col) for col in zip(*vectors)] 
```

虽然我不能为这个表现说话。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-04-30T23:50:00.293

```
list(map(lambda x:x[0]+x[1], zip(a,b))) 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-08-09T22:01:32.763

```
a = map(lambda x, y: x + y, a, b) 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-10T17:43:01.190

理解列表的改进（减少内存消耗）

导入 itertools a = [x+y for x,y in itertools.izip(a,b)]

实际上，如果您不确定 a 是否会被消耗，那么我什至会使用生成器表达式：

(x+y for x,y in itertools.izip(a,b))

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-10T11:07:15.227

您可以创建一个函数来获取数组的大小，遍历它并创建一个返回数组并返回它。

# asp.net - ASP.NET 哪个控件可以包装 JS 块并且可以提取，所以我可以将它呈现回标题

> ID：845117
> 
> 赞同：0
> 
> 时间：2009-05-10T11:07:36.660
> 
> 标签：asp.net, webforms

作为标题，基本上我在页面内放置了一个用户控件，然后将该页面放置在母版页内。我想提取一段 javascript 并将其放回页眉。当我尝试将代码包装在任何块控件（例如 div runat 服务器）中并访问 divID.InnerText 然后 ASP.NET 崩溃了

```
Cannot get inner content of startup_script because the contents are not literal. 
```

我不想在cs文件中提取JS，那是非常丑陋的方法（各种转义，人们甚至不会注意到你写了JS，除非他们钻你的CS文件），我能做什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T11:56:35.050

您可以将 javascript 存储在单独的文件中，然后使用 Page.RegisterClientScriptBlock() 将其添加到页面

将您想要的 javascript 添加到 .js 文件中，并将 .js 文件添加到您的项目中。更改 .js 文件的属性，使其成为嵌入式资源。

然后在您的 UserControl（可能是 Page_Load）中的某处使用这样的代码从文件中提取代码并将其放入页面中：

```
string javaScript = "";
// the javascript is in a separate file which is an 'embedded resource' of the dll
using (StreamReader reader = 
    new StreamReader((typeof(ThisClass).Assembly.GetManifestResourceStream(typeof(ThisClass), "NameOfJavaScriptFile.js"))))
{
    javaScript = String.Format("<script language='javascript' type='text/javascript' >\r\n{0}\r\n</script>", reader.ReadToEnd());
}
Page.RegisterClientScriptBlock("MyScriptBlock", javaScript); 
```

请注意，RegisterClientScriptBlock() 会将脚本放在页面顶部附近，但显然不在页面标题中。

（在评论后编辑了关于标题的部分）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T11:14:44.147

```
<%@ Page Language="C#"%>
<script runat=server>
    protected override void OnLoad(EventArgs e)
    {
        string scriptText = someID.InnerHtml;
        //if you really want it in the header...
        //Page.Header.Controls.Add( new LiteralControl(String.Format( "<scr" + "ipt language=\"javascript\">{0}</scri" + "pt>\\n", scriptText )));

        //doesnt add to header and requires form runat=server
        Page.ClientScript.RegisterStartupScript(this.GetType(), "SomeScript", scriptText, true);

        base.OnLoad(e);
    }
</script>
<head runat=server></head>
<form runat=server>
<div id="someID" runat=server>alert('hi');</div>
</form> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T00:13:14.140

好的，我可能以一种可怕的、可怕的方式做到了这一点，但我想从用户控件向最近的项目中的 head 元素添加一个脚本。该脚本不需要来自我的服务器的任何数据，但我只希望它在特定页面上，因此我将脚本放在 .js 文件中，并将其添加到头部，如下所示：

```
HtmlGenericControl script = new HtmlGenericControl("script"); // Creates a new script-element
script.Attributes.Add("type","text/javascript");
script.Attributes.Add("src","src/to/js-file.js");
Page.Master.FindControl("head").Controls.Add(script); // Finds the element with ID "head" on the pages master page. 
```

不完全确定代码是否像我认为的那样工作，因为我为该项目编写的代码在另一台机器上，但你明白了，对吧？

编辑：在谷歌搜索您的错误消息后，我认为这可能是您问题的解决方案：

```
using System.IO;

StringWriter sw = new StringWriter();
HtmlTextWriter htw = new HtmlTextWriter(sw);
yourDivID.RenderControl(h);
String str = sw.GetStringBuilder().ToString(); 
```

如果把这两个例子结合起来，你应该可以得到你想要的结果。我没有对此进行测试，但它在我的脑海中有效。

# windows - 将 Windows shell 扩展限制为文件夹/驱动器

> ID：845126
> 
> 赞同：1
> 
> 时间：2009-05-10T11:14:01.327
> 
> 标签：windows, windows-shell, shell-extensions

我正在开发一个 shell 扩展，它应该显示存储在虚拟驱动器上的文件（主要是 .jpgs）的扩展属性（将其视为外部硬盘驱动器）。

是否可以以仅启动特定文件夹/驱动器（在我的情况下为外部硬盘驱动器）的文件并将其他文件夹中 jpgs 的处理留给 Windows 默认 shell 扩展的方式注册 shell 扩展？

问候，

塞巴斯蒂安

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-09-14T19:30:14.950

本文列出了注册 shell 扩展的方法：http: [//msdn.microsoft.com/en-us/library/cc144096](http://msdn.microsoft.com/en-us/library/cc144096(VS.85).aspx) (VS.85).aspx 。

您应该能够在外部硬盘驱动器上创建一个系统文件夹，其中包含指向您的扩展的 desktop.ini 文件。

或者，在扩展程序本身中，您可以检查路径，如果它不在您指定的位置，则不执行额外的逻辑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2022-02-09T02:44:26.023

将您的应用信息放在：HKEY_CLASSES_ROOT\Directory\shell\

# c - 在 C 中更改文件中的一个字节

> ID：845127
> 
> 赞同：6
> 
> 时间：2009-05-10T11:14:39.577
> 
> 标签：c

我有一个打开并准备好的文件流。

如何访问和更改流中的单个字节，以便更改反映在文件上？

有什么建议么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-10T11:20:53.150

```
#include "stdio.h"

int main(void)
{
    FILE* f = fopen("so-data.dat", "r+b"); // Error checking omitted
    fseek(f, 5, SEEK_SET);
    fwrite("x", 1, 1, f);
    fclose(f);
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-10T11:17:57.167

```
FILE* fileHandle = fopen("filename", "r+b"); // r+ if you need char mode
fseek(fileHandle, position_of_byte, SEEK_SET);
fwrite("R" /* the value to replace with */, 1, 1, fileHandle); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-10T11:25:59.270

```
#include <stdio.h> /* standard header, use the angle brackets */

int main(void)
{
    char somechar = 'x'; /* one-byte data */
    FILE* fp = fopen("so-data.txt", "r+");
    if (fp) {
      fseek(fp, 5, SEEK_SET);
      fwrite(&somechar, 1, 1, fp);
      fclose(fp);
    }
    return 0; /* if you are on non-C99 systems */
} 
```

# ant - 捕获 Ant 输出

> ID：845137
> 
> 赞同：7
> 
> 时间：2009-05-10T11:21:00.187
> 
> 标签：ant, sunspot

谁能向我建议从 Ant 命令捕获输出的最佳方法？

我正在为太阳斑设备编写一些路由测试。该命令本身返回网络统计信息。我正在尝试编写一些东西，将所有这些结果转储到更可视化的应用程序中。

我在 Windows Vista 上。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-02-07T13:00:55.763

您可以简单地使用 ant [recorder 任务](http://ant.apache.org/manual/Tasks/recorder.html)：

`<record name="build.log"> </record>`

这具有将输出同时写入屏幕和日志文件的优点，而在执行输出重定向或使用选项`ant debug > build.log` 调用 ant时情况并非如此。`-logfile`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T11:33:49.313

使用`-logfile <file>`选项将输出写入文件。就像@jespere 所说，您可以通过实现自己的记录器或侦听器来获得更多控制权。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-10T11:28:53.940

只需使用“-verbose”标志并使用“>”为命令行输出指定一个文件？

例如：

```
ant -verbose > output.txt 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T11:27:32.883

您可以定义一个自定义 Ant[记录器](http://ant.apache.org/manual/listeners.html)，它将接收所有 Ant 输出。有了它，你可以对输出做任何你想做的事情。

# visual-studio - 什么是 Visual Studio 2008 Shell（集成模式）？

> ID：845152
> 
> 赞同：9
> 
> 时间：2009-05-10T11:32:31.530
> 
> 标签：visual-studio, visual-studio-2008, shell

我是 Visual Studio 2008 Shell（集成模式）的新手，我只想知道它的功能是什么？（我没有从网上找到很多清楚的东西。）

从[http://msdn.microsoft.com/en-us/vstudio/bb510103.aspx](http://msdn.microsoft.com/en-us/vstudio/bb510103.aspx) 看起来它是一些允许工具与 VSTS IDE 集成的接口/框架。我的问题是是否有任何 Microsoft VSTS 工具（如数据库设计器和 VSTS 中的其他工具）依赖于 VSTS Shell？我问这个问题是因为它与 SQL Server 2008 冲突，我想确保如果我卸载 VSTS Shell，它不会影响任何东西。

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-10T11:41:53.880

使用 VS 2008 Shell 的 SQL Server 2008 Management Studio。（这就是它看起来和感觉就像 Visual Studio 的原因）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T11:42:53.373

Visual Studio Shell 是一种可扩展机制，用于使用 Visual Studio 核心平台提供您自己的工具。它有两种模式。在“隔离模式”下，它将始终设置一个单独的 Visual Studio 实例来托管您的工具。在“集成模式”下，它只会在没有可用的 VS 实例的情况下安装新的 VS 实例。如果一个已经存在，它将与之集成。我认为删除它不会对 VS 安装造成任何问题。它似乎足够聪明来处理它（但是它可能会破坏第三方工具）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T11:44:55.340

shell 版本意味着应用程序可以合并到 shell 中并独立使用。隔离模式意味着这个版本只执行一项任务，是一个完整的独立应用程序。

参见：[VS2k8 外壳](http://msdn.microsoft.com/en-us/vsx2008/products/bb933751.aspx)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-02-17T00:24:19.727

[这里](http://msdn.microsoft.com/en-us/library/bb685612%28v=VS.90%29.aspx)有一个明确定义的区别

# java - 在 python 中将 java System.currentTimeMillis() 转换为日期

> ID：845153
> 
> 赞同：8
> 
> 时间：2009-05-10T11:33:43.603
> 
> 标签：java, python, date, formatting, timestamp

我有从 1970 年开始以毫秒为单位的时间戳。我想将其转换为 python 中人类可读的日期。如果涉及到这一点，我可能不会失去一些精确度。

我该怎么做？

以下给出**ValueError: timestamp out of range for platform time_t** on Linux 32bit

```
#!/usr/bin/env python
from datetime import date
print date.fromtimestamp(1241711346274) 
```

谢谢你，马克西姆。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-10T11:40:38.080

Python 需要秒，所以先将它除以 1000.0：

```
>>> print date.fromtimestamp(1241711346274/1000.0)
2009-05-07 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T13:07:12.740

您可以保留精度，因为在 Python 中时间戳是一个浮点数。这是一个例子：

```
import datetime

java_timestamp = 1241959948938
seconds = java_timestamp / 1000
sub_seconds  = (java_timestamp % 1000.0) / 1000.0
date = datetime.datetime.fromtimestamp(seconds + sub_seconds) 
```

你显然可以让它比这更紧凑，但上面的代码适合在 REPL 中一次一行地输入，所以看看它做了什么。例如：

```
Python 2.5.2 (r252:60911, Feb 22 2008, 07:57:53) 
[GCC 4.0.1 (Apple Computer, Inc. build 5363)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> java_timestamp = 1241959948938
>>> import datetime
>>> seconds = java_timestamp / 1000
>>> seconds
1241959948L
>>> sub_seconds  = (java_timestamp % 1000.0) / 1000.0
>>> sub_seconds
0.93799999999999994
>>> date = datetime.datetime.fromtimestamp(seconds + sub_seconds)
>>> date
datetime.datetime(2009, 5, 10, 8, 52, 28, 938000)
>>> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T11:40:00.373

以毫秒为单位将时间戳除以 1000 变为以秒为单位。

```
date.fromtimestamp(1241711346274/1000) 
```

# java - 如何避免在 try 语句中设置变量

> ID：845155
> 
> 赞同：0
> 
> 时间：2009-05-10T11:35:21.477
> 
> 标签：java, scope, try-catch

我的问题是我必须在 try 语句中设置一个变量，否则会出现编译错误。

稍后我需要使用该变量，但它现在超出了范围，或者我相信。我在 try 语句之外初始化变量并将其设置为 null，我认为它可能可以在外部访问，但我仍然得到一个`NullPointerException`.

代码在下面，为了便于阅读，去掉了很多代码——我知道这是不好的代码，但我是 Servlets 的新手，只是想看到它运行时所有移动部件都在做它们应该做的事情。

我创建了另一个调用 createDocs(...) 并传入所需参数的类，它工作正常。所以这让我很好奇为什么当我打电话时`rs.getString("name")`我得到了`NullPointerException`，因为这正是我在其他类中所做的（为了方便而从 main 方法运行）并且它按预期工作。

有问题的变量是 ResultSet 变量“rs” -

```
public class AgReportServlet extends HttpServlet {

    private static final long serialVersionUID = 1L;

    public AgReportServlet() {
        super();
    }

    public void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        ResultSet rs = null;
        try {
            rs = docs.getDocs(con, start, end, zone, locality);
        } catch (SQLException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        } catch (InstantiationException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        } catch (IllegalAccessException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        } catch (ClassNotFoundException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }

        response.setContentType("text/xml");
        PrintWriter out = response.getWriter();
        out.println("<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n" +
                out.println(
                        "<table border=\"0\" cellspacing=\"0\" cellpadding=\"6\">\n");

        // I have a resultset object need to iterate through it to display the file names

        try {
            while (rs.next()) { // page through the result set

                out.println(
                        "  <tr>\n" +
                                "    <td>: " + rs.getString("name") + "</td>\n" +
                                "  </tr>\n"
                );
            }
        } catch (SQLException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }
        out.println(
                "</table></body>\n" +
                        "</html>"
        );

        out.flush();
        out.close();
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-10T11:39:18.580

你的问题是，如果这个陈述：

```
rs = docs.getDocs(con, start, end, zone, locality); 
```

抛出异常然后 rs 的值仍然是`null`. 所以我要做的是将循环移动到同一个 try-catch 块内。或者，您可以在尝试使用它之前检查它是否仍然为空。

不过，在 try-catch 块之外将值设置为 null 并不是坏代码。如果您希望 rs 变量在 try 块之外（并且包括在其中一个 catch 子句中），这就是您必须做的。您的 rs while 循环可能应该在同一个 try 块内。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T11:44:26.680

您声明 rs 变量和第一个 try/catch 块的方式是可以的。

只是在第一次 try/catch 之后，您需要记住，如果第一次 try/catch 中出现错误，rs*仍然为 null。*因此，请确保在尝试访问之前测试 rs 是否为 null。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T11:43:42.447

你为什么不简单地添加一个

```
if(rs != null) 
```

前

```
while(rs.next()) 
```

这应该有帮助（据我了解）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T12:01:48.487

感谢大家的帮助。首先，您帮助我确定必须抛出某种异常。当我查看 Tomcat 控制台时，我可以看到这是 MySQL 连接器的一个类不基金错误。我已经将它包含在我的项目中，但没有包含在项目本身中 - 我只是在我的 lib 目录中懒惰地引用它，所以最终异常导致了问题，但是使用你的建议，比如 if(rs != null) 帮助我得到到根本原因。

最初我认为这与变量超出范围有关。显然不是这样。

# c - uchar 的模拟内存数组中的 int

> ID：845156
> 
> 赞同：0
> 
> 时间：2009-05-10T11:35:26.187
> 
> 标签：c, casting, malloc

在 C 语言中，在 Unix 环境（Plan9）中，我有一个数组作为内存。

```
uchar mem[32*1024]; 
```

我需要该数组包含不同的字段，例如一个 int（整数）来指示可用内存的大小。所以，我试过这个：

```
uchar* memp=mem;
*memp=(int)250; //An example of size I want to assign. 
```

我知道 int 的大小是 4，所以我必须强制使用强制转换或类似的东西，在这种情况下，mem 的前四个插槽的内容有数字 250，它是大端。

但问题是当我尝试做我解释过的事情时它不起作用。我想类型转换有误。我希望问你，我怎么能强制 mem[0] 到 mem[3] 具有指示的大小，表示为 int 而不是 uchar？

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T11:38:01.050

像这样：

```
*((int*) memp) = 250; 
```

那就是说“即使`memp`是一个指向字符的指针，我希望你把它当作一个指向整数的指针，并将这个整数放在它指向的地方。”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T11:45:57.613

您是否考虑过使用联合，例如：

```
union mem_with_size {
  int   size;
  uchar mem[32*1024];
}; 
```

那你就不用担心选角了。（当然，您仍然需要担心字节顺序，但这是另一个问题。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T12:02:36.323

正如其他人指出的那样，您需要强制转换为指向 int 的指针。您还需要确保考虑到指针的对齐：在许多体系结构中，int 需要从可被 sizeof(int) 整除的内存位置开始，如果您尝试访问未对齐的 int，您会得到一个信号总线。在其他架构上，它可以工作，但速度很慢。在其他人身上，它的工作速度很快。

一种可移植的方式可能是：

```
int x = 250;
memcpy(mem + offset, &x, sizeof(x)); 
```

不过，使用联合可能会使这更容易，所以 +1 给 JamieH。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T11:39:38.097

将指针投射到`int`，而不是`unsigned char`再次！

```
int * memp = (int *)mem;
* memp = 250; //An example of size I want to assign. 
```

# jfreechart - 鼠标悬停在 jfreechart 中的图表线

> ID：845161
> 
> 赞同：0
> 
> 时间：2009-05-10T11:37:10.693
> 
> 标签：jfreechart

我想知道是否有一种方法可以检测鼠标何时在图形线上方并能够从与该点对应的数据集中访问数据。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-29T17:28:37.670

获取此数据取决于您在何处使用图表。在 swing 应用程序中，使用显示图表的面板中的鼠标侦听器。

在使用图像的网页上，您将无法访问数据（因为它只是一个图像），但 JFreeChart 将为您生成一个图像映射，它可以在悬停时调用 java 脚本。

在最近的一个项目中，我做了类似的事情：

```
 ChartRenderingInfo info = new ChartRenderingInfo(new StandardEntityCollection());  
  String pngLocation = Servlet.saveChartAsPNG(chart, 200, 200, info, request.getPortletSession());
            StringWriter sw = new StringWriter();
            ChartUtilities.writeImageMap(new PrintWriter(sw), pngLocation, info, false); 
```

这`chart`是一个 JFreeChart，带有适合您要执行的操作的标志（工具提示、网址、标签）

# iphone - if 语句上的 Obj-C 语法错误...为什么？

> ID：845177
> 
> 赞同：2
> 
> 时间：2009-05-10T11:46:20.440
> 
> 标签：iphone, objective-c

Objective C 和 Cocoa 的真正新手。

我有这个'if语句'

```
if (cardCount = 2)
   UIImage *image = [UIImage imageNamed: @"Card 2.png"]; 
```

这给了我“错误：'*' 标记之前的语法错误”

为什么？UIImage 行本身可以正常工作。

我很感激能指出我做错了什么。

谢谢保罗

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-10T11:49:09.357

首先，条件应该读取`cardCount == 2`，但这不是导致该错误的原因。问题是，变量声明和初始化在语言语法中不算作*语句。*这是一个宣言。您不能将声明作为,等**的主体**（顺便说一下，块被认为是一个语句，它可能包含声明，所以这是另一回事）。毕竟，它没有用，因为它会立即超出范围，所以它是不允许的。`if``while`

```
UIImage *image;
if (cardCount == 2)
   image = [UIImage imageNamed: @"Card 2.png"]; 
```

如果您只需要 if 语句中的该变量（我怀疑这是您想要的）：

```
if (cardCount == 2) {
   UIImage* image = [UIImage imageNamed: @"Card 2.png"];
   // code to use `image`
} 
```

# java - 将静态 windows 库转换为 dll

> ID：845183
> 
> 赞同：12
> 
> 时间：2009-05-10T11:50:23.563
> 
> 标签：java, c, windows, java-interop

我有一个包含一堆静态`*lib`文件的库，我希望从中访问它们`JNA`（一个允许从 JAVA 代码动态调用 `dll's 的 Java 库），那么有没有办法神奇地将静态库更改为 dll？

代码是使用 Visual Studio 编译的（希望是相关的），我也有适当的头文件。

我无权访问源代码，我也想只使用免费（如啤酒）工具来完成它。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-10T12:10:11.037

我不知道任何会自动执行此操作的工具，但该过程是创建一个 DLL 项目并将您的库添加到项目中。对于头文件中的每个函数：

```
int SomeLibFunc( int x, int y ); 
```

您需要在 DLL 中创建和导出您自己的函数；

```
int MyFunc( int x, int y ) {
   return SomLibFunc( x, y );
} 
```

这个过程是相当机械的，您可以使用 perl 之类的东西敲出一个脚本来创建 DLL 源文件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T12:04:14.383

假设您无权访问源代码，您可以简单地创建一个包装 DLL，将您需要的函数导出并委托给静态库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-09-06T09:22:31.857

我按照匿名者的建议做了，我做了一个自动转换器（有人建议在声明之前放置 _ddlspec(export) 并用这个头文件编译 dll 就可以了——好吧它没有——也许我做错了什么——我很普通老 Java 程序员 ;)):

它基本上解析头文件并转：

```
 SADENTRY SadLoadedMidFiles( HMEM, USHORT usMaxMidFiles, VOID * ); 
```

到：

```
 __declspec(dllexport) SADENTRY DLL_WRAPPER_SadLoadedMidFiles(HMEM param0, 
            USHORT usMaxMidFiles, VOID* param2){
      return SadLoadedMidFiles(param0, usMaxMidFiles, param2);
  } 
```

这是代码（很可能是它的 Regexp 滥用，但它有效），gui 部分取决于 MigLayout：

```
 package cx.ath.jbzdak.diesIrae.util.wrappergen;

    import net.miginfocom.swing.MigLayout;

    import javax.swing.*;
    import static java.awt.GraphicsEnvironment.getLocalGraphicsEnvironment;
    import java.awt.*;
    import java.awt.event.ActionEvent;
    import java.awt.event.ActionListener;
    import java.io.*;
    import java.nio.charset.Charset;
    import java.util.ArrayList;
    import java.util.Collections;
    import java.util.List;
    import java.util.regex.Matcher;
    import java.util.regex.Pattern;

    /**
     * Displays a window. In this window you have to specify two things:
     * <p/>
     * 1\. Name of header file that you want to process.
     * <p/>
     * 2\. Name of output files extension will be added automatically. We will override any existing files.
     *
     * <p/>
     * Dependencies: MigLayout
     * <p/>
     * Actual wrapper generation is done inside WrapperGen class.
     * <p/>
     * KNOWN ISSUES:
     * <p/>
     * 1\. Ignores preprocessor so may extract finction names that are inside <code>#if false</code>.
     * <p/>
     * 2\. Ignores comments
     * <p/>
     * 3\. May fail to parse werid parameter syntax. . .
     *
     * Created by IntelliJ IDEA.
     * User: Jacek Bzdak 
     */
    public class WrapperGenerator {

        public static final Charset charset = Charset.forName("UTF-8");

        WrapperGen generator = new WrapperGen();

        // GUI CODE:

        File origHeader, targetHeader, targetCpp;

        JTextField newHeaderFileName;

        JFrame wrapperGeneratorFrame;
        {
            wrapperGeneratorFrame = new JFrame();
            wrapperGeneratorFrame.setTitle("Zamknij mnie!"); //Wrapper generator
            wrapperGeneratorFrame.setLayout( new MigLayout("wrap 2, fillx", "[fill,min!]"));
            wrapperGeneratorFrame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
            ActionListener buttonListener = new ActionListener() {
                JFileChooser fileChooser = new JFileChooser();
                {
                    fileChooser.setFileFilter(new javax.swing.filechooser.FileFilter() {
                        @Override
                        public boolean accept(File f) {
                            return f.isDirectory() || f.getName().matches(".*\\.h(?:pp)?");
                        }
                        @Override
                        public String getDescription() {
                            return "Header files";
                        }
                    });
                    fileChooser.setCurrentDirectory(new File("C:\\Documents and Settings\\jb\\My Documents\\Visual Studio 2008\\Projects\\dll\\dll"));
                }
                public void actionPerformed(ActionEvent e) {
                    if(JFileChooser.APPROVE_OPTION == fileChooser.showOpenDialog(wrapperGeneratorFrame)){
                        origHeader = fileChooser.getSelectedFile();
                    }
                }
            };
            wrapperGeneratorFrame.add(new JLabel("Original header file"));
            JButton jButton = new JButton("Select header file");
            jButton.addActionListener(buttonListener);
            wrapperGeneratorFrame.add(jButton);
            wrapperGeneratorFrame.add(new JLabel("Result files prefix"));
            newHeaderFileName = new JTextField("dll_wrapper");
            wrapperGeneratorFrame.add(newHeaderFileName);
            ActionListener doListener = new ActionListener() {
                public void actionPerformed(ActionEvent e) {
                    targetHeader = new File(origHeader.getParentFile(), newHeaderFileName.getText() + ".h");
                    targetCpp = new File(origHeader.getParentFile(), newHeaderFileName.getText() + ".cpp");
                    try {
                        targetHeader.createNewFile();
                        targetCpp.createNewFile();
                        generator.reader = new InputStreamReader(new FileInputStream(origHeader),charset);
                        generator.cppWriter = new OutputStreamWriter(new FileOutputStream(targetCpp), charset);
                        generator.heaerWriter = new OutputStreamWriter(new FileOutputStream(targetHeader), charset);
                        generator.parseReader();
                    } catch (IOException e1) {
                        e1.printStackTrace();
                        JOptionPane.showMessageDialog(wrapperGeneratorFrame, "ERROR:" + e1.getMessage(), "Error", JOptionPane.ERROR_MESSAGE);
                        return;
                    }
                }
            };
            JButton go = new JButton("go");
            go.addActionListener(doListener);
            wrapperGeneratorFrame.add(go, "skip 1");
        }

        public static void main(String []args){
           SwingUtilities.invokeLater(new Runnable() {
               public void run() {
                   WrapperGenerator wgen = new WrapperGenerator();
                   JFrame f = wgen.wrapperGeneratorFrame;
                   wgen.wrapperGeneratorFrame.pack();
                   Point p = getLocalGraphicsEnvironment().getCenterPoint();
                   wgen.wrapperGeneratorFrame.setLocation(p.x-f.getWidth()/2, p.y-f.getHeight()/2);
                   wgen.wrapperGeneratorFrame.setVisible(true);
               }
           });
        }
    }

    /**
     * Does the code parsing and generation
     */
    class WrapperGen{

        /**
         * Method is basically syntax like this: <code>(anything apart from some special chars like #;) functionName(anything)</code>;
         * Method declarations may span many lines.
         */
        private static final Pattern METHOD_PATTERN =
                                 //1          //2              //params
                Pattern.compile("([^#;{}]*\\s+\\w[\\w0-9_]+)\\(([^\\)]*)\\);", Pattern.MULTILINE);
        //1 - specifiers - including stuff like __dllspec(export)...
        //2 - function name
        //3 param list

        /**
         * Generated functions will have name prefixet with #RESULT_PREFIX
         */
        private static final String RESULT_PREFIX = "DLL_WRAPPER_";

        /**
         * Specifiers of result will be prefixed with #RESULT_SPECIFIER
         */
        private static final String RESULT_SPECIFIER =  "__declspec(dllexport) ";

        Reader reader;

        Writer heaerWriter;

        Writer cppWriter;

        public void parseReader() throws IOException {
            StringWriter writer = new StringWriter();
            int read;
            while((read = reader.read())!=-1){
                writer.write(read);
            }
            reader.close();
            heaerWriter.append("#pragma once\n\n\n");
            heaerWriter.append("#include \"stdafx.h\"\n\n\n"); //Standard Visual C++ import file.
            cppWriter.append("#include \"stdafx.h\"\n\n\n");
            Matcher m = METHOD_PATTERN.matcher(writer.getBuffer());
            while(m.find()){
                System.out.println(m.group());
                handleMatch(m);
            }
            cppWriter.close();
            heaerWriter.close();
        }

        public void handleMatch(Matcher m) throws IOException {
            Method meth = new Method(m);
            outputHeader(meth);
            outputCPP(meth);
        }

        private void outputDeclaration(Method m, Writer writer) throws IOException {
            //writer.append(RESULT_SPECIFIER);
            writer.append(m.specifiers);
            writer.append(" ");
            writer.append(RESULT_PREFIX);
            writer.append(m.name);
            writer.append("(");
            for (int ii = 0; ii < m.params.size(); ii++) {
                Parameter p =  m.params.get(ii);
                writer.append(p.specifiers);
                writer.append(" ");
                writer.append(p.name);
                if(ii!=m.params.size()-1){
                    writer.append(", ");
                }
            }
            writer.append(")");
        }

        public void outputHeader(Method m) throws IOException {

            outputDeclaration(m, heaerWriter);
            heaerWriter.append(";\n\n");
        }

        public void outputCPP(Method m) throws IOException {
            cppWriter.append(RESULT_SPECIFIER);
            outputDeclaration(m, cppWriter);
            cppWriter.append("{\n\t");
            if (!m.specifiers.contains("void") || m.specifiers.matches(".*void\\s*\\*.*")) {
                cppWriter.append("return ");
            }
            cppWriter.append(m.name);
            cppWriter.append("(");
            for (int ii = 0; ii < m.params.size(); ii++) {
                Parameter p =  m.params.get(ii);
                cppWriter.append(p.name);
                if(ii!=m.params.size()-1){
                    cppWriter.append(", ");
                }
            }
            cppWriter.append(");\n");
            cppWriter.append("}\n\n");
        }

    }

    class Method{
        private static final Pattern NAME_REGEXP =
                                     //1      //2
                Pattern.compile("\\s*(.*)\\s+(\\w[\\w0-9]+)\\s*", Pattern.MULTILINE);
        //1 - all specifiers - including __declspec(dllexport) and such ;)
        //2 - function name

        public final List<Parameter> params;

        public final String name;

        public final String specifiers;

        public Method(Matcher m) {
            params = Collections.unmodifiableList(Parameter.parseParamList(m.group(2)));
            Matcher nameMather = NAME_REGEXP.matcher(m.group(1));
            System.out.println("ALL: " + m.group()); 
            System.out.println("G1: " + m.group(1));
            if(!nameMather.matches()){
                throw new IllegalArgumentException("for string "  + m.group(1));
            }
    //        nameMather.find();
            specifiers = nameMather.group(1);
            name = nameMather.group(2);
        }
    }

    class Parameter{

        static final Pattern PARAMETER_PATTERN =
                                      //1           //2
                Pattern.compile("\\s*(?:(.*)\\s+)?([\\w\\*&]+[\\w0-9]*[\\*&]?)\\s*");
        //1 - Most probably parameter type and specifiers, but may also be empty - in which case name is empty, and specifiers are in 2
        //2 - Most probably parameter type, sometimes prefixed with ** or &* ;), also
        // 'char *' will be parsed as grup(1) == char, group(2) = *.

        /**
         * Used to check if group that represenrs parameter name is in fact param specifier like '*'.
          */
        static final Pattern STAR_PATTERN =
                Pattern.compile("\\s*([\\*&]?)+\\s*");

        /**
         * If
         */
        static final Pattern NAME_PATTERN =
                Pattern.compile("\\s*([\\*&]+)?(\\w[\\w0-9]*)\\s*");

        public final String name;
        public final String specifiers;

         public Parameter(String param, int idx) {
            System.out.println(param);
            Matcher m = PARAMETER_PATTERN.matcher(param);
            String name = null;
            String specifiers = null;
            if(!m.matches()){
                throw new IllegalStateException(param);
            }
            name = m.group(2);
            specifiers = m.group(1);
            if(specifiers==null || specifiers.isEmpty()){ //Case that parameter has no name like 'int', or 'int**'
                specifiers = name;
                name = null;
            }else if(STAR_PATTERN.matcher(name).matches()){ //Case that parameter has no name like 'int *'
                specifiers += name;
                name = null;
            }else if(NAME_PATTERN.matcher(name).matches()){ //Checks if name contains part of type like '**ptrData', and extracts '**'
                Matcher m2 = NAME_PATTERN.matcher(name);
                m2.matches();
                if(m2.group(1)!=null){
                    specifiers += m2.group(1);
                    name = m2.group(2);
                }

            }
            if(name==null){
                name = "param" + idx;
            }
            this.specifiers = specifiers;
            this.name = name;
        }

        public static List<Parameter> parseParamList(String paramList){
            List<Parameter> result = new ArrayList<Parameter>();
            String[] params = paramList.split(",");
            int idx = 0;
            for(String param : params){
                Parameter p = new Parameter(param, idx++);
                result.add(p);
            }
            if(result.size()==1){
                Parameter p = result.get(0);
                if(p.specifiers.matches("\\s*void\\s*")){
                    return Collections.emptyList();
                }
            }
            return result;
        }
    } 
```

# arrays - 我可以返回 json 格式的“数字，数字”数组吗？

> ID：845185
> 
> 赞同：1
> 
> 时间：2009-05-10T11:53:53.200
> 
> 标签：arrays, json

我的服务器上有一个纬度/经度对象列表。

例如。

```
public class LatitudeLongitude
{
    public float Latitude;
    public float Longitude;
} 
```

简单的。

现在，我可以以 json 格式返回这些集合的集合吗？但是……我不想列出键，只列出值。

这意味着正常结果将类似于...

```
{ { lat: 111, long : 222 }, { lat: 333, long : 444 } }   .. 
```

但我希望...

```
{ {111, 222}, {333, 444} ..... }
{ {obj1.Lat, obj1.Long}, {obj2.Lat, obj2.Long} ... etc. ... } 
```

这可能吗？我的意思是，我可以轻松地在服务器端制作该字符串。但这是正确的 JSON 输出格式吗？

有人可以确认，等等。

干杯:)

PS。我几乎不知道任何 Json，所以请不要犹豫，纠正我上面那些糟糕的例子。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-10T11:55:56.353

使用 JSON 数组：

```
[ [111, 222], [333, 444], ... ] 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-10T12:16:33.917

Ayman 的提议不是很正确的 JSON 语法。作为一个对象 {..} 总是由具有名称的字段组成。因此，我们将再次拥有具有 2 个“数组”类型字段的对象，这些字段没有名称 -> 对象的 json 无效。

[在www.json.org](http://json.org)上有一个很好的描述 json 字符串的样子。查看此描述，您会看到没有名称字符串的字段不允许对象，因此此 {111,222} 不是 json 中的有效对象，但这是有效的 [111,222] 数组。这不是一个有效的对象 {[111,222]} 但这是 {array1 : [111,222]}。

我猜你真正想要的很可能是一个像这样的数组数组，没有封装为一个对象。

[[111,222]，[333,444]]。

这种方法可以让您选择将任意多的纬度/经度数组添加到封闭数组中，同时无论外部数组的大小如何，您都可以使用 javascript 循环处理内部数组。

希望有帮助。

欢呼迈克尔

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T11:58:27.903

如果您需要使用 JSON 中的键访问它，则需要指定它（或使用 JS 在客户端将数组转换为对象）。否则，数组应该可以工作：

```
var json = [ [123, 456], [234, 567] ];
var convertedJson = [];
for (i = 0; i < json.length; ++i) {
    var thisObj = new Object();
    thisObj.latitude = json[i][0];
    thisObj.longitude = json[i][1];
    convertedJson[i] = thisObj;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-17T16:06:13.047

> 但这是正确的 JSON 输出格式吗？

您可以在 jslint.com 上粘贴 JSON 以验证您的 JSON

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-10T11:56:51.650

ASP.NET MVC JSON 序列化程序应将 a 转换`IList<LatitudeLongitude>`为如下内容：

```
[{"Latitude":111,"Longitude":222},{"Latitude":333,"Longitude":444} .. ] 
```

我相信在 ASP.NET MVC 下的 JSON 序列化器只是一个热连线的 .NET core Javascript 序列化器。

我认为 .NET 不可能使用序列化程序。可能需要手动渲染字符串。

# architecture - 如何绘制应用架构图

> ID：845199
> 
> 赞同：3
> 
> 时间：2009-05-10T12:01:42.217
> 
> 标签：architecture, uml, soa, diagram, visio

我想知道你们用什么来绘制你的应用程序/服务架构图？

我想制作代表整个应用程序不同层的图表，并且对于某些部分更深入（类级别）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-10T13:15:39.607

[视觉](http://visiotoolbox.com/en-us/Buynow.aspx?utm_source=google&utm_medium=cpc&utm_term=Visio&utm_content=textads&utm_campaign=Search_Visio_US&gclid=CKLJpLnqsZoCFSbxDAodyBv-bQ)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-10T12:04:35.777

[企业架构师](http://www.sparxsystems.com.au/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-10T12:07:45.127

我使用[dia](http://live.gnome.org/Dia)来完成我为学校/工作所做的几个小型（300 多个班级）项目。

它足够通用，因此您可以在其中绘制任何内容，甚至可以生成代码。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-10T12:37:14.763

有[很多 UML 工具](http://en.wikipedia.org/wiki/List_of_UML_tools)可以用来绘制[UML 图](http://en.wikipedia.org/wiki/Unified_Modeling_Language)。其中一些还可以生成骨架代码等，但如果您不想这样做，则不必为此烦恼。

这里有几个开源 uml 工具：
[StarUML](http://staruml.sourceforge.net/en/) (windows)
[UMLet](http://www.umlet.com/) (runs in java on windows, linux, mac)

编辑：对于您正在谈论的排序图 - 应用程序/服务架构 - 您可以绘制 UML[部署图](http://en.wikipedia.org/wiki/Deployment_diagram)

edit2：对于非 UML 图表，听起来[Dia](http://live.gnome.org/Dia)是 Visio 的一个很好的开源替代品

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-10-15T18:53:33.987

您使用的是什么具体方法？Lucidchart 非常适合 UML 模式。无需插件或下载。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-10T12:47:03.253

我使用 dia 来完成这项任务

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-10T13:07:41.523

它不是真正制作 uml 图，而是更“通用图”的整个应用程序架构（它更像是多个应用程序的服务组合）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-14T19:40:21.480

我使用[inkscape](http://www.inkscape.org/)来可视化课堂交互和架构。它是一个通用的 SVG 编辑器，因此与 Dia 或 Visio（我都使用过）相比，您可以自由地在图表中更具创意和表现力。

学习曲线很平缓，它提供了我构建图表和流程图所需的一切，一旦你掌握了它，你的武器库中就有了一个非常强大的图形编辑器。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-03T07:42:38.603

那里有许多不同的建模工具，我刚刚发现了 ArgoUML [ [http://argouml.tigris.org]](http://argouml.tigris.org])，您可能想查看它。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-01-12T12:50:46.157

您还可以使用免费的[ARIS Express](http://www.ariscommunity.com/aris-express)。例如，您可以使用系统景观模型来描述您的应用程序架构。另一个有趣的图表可能是 IT 基础架构模型，您可以在其中描述应用程序的部署。或者您使用业务流程概述应用程序的主要工作流程。ARIS Express 还具有数据模型。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-02T03:33:10.837

我们使用 Dabbleboard。这对远程团队成员来说非常棒。只需给他们一个网址，它就会即时更新。这是我们的一张图表的链接

[http://dabbleboard.com/draw?b=135471&i=7&c=7b1781adc4a54887d5d414378575b890e38469de](http://dabbleboard.com/draw?b=135471&i=7&c=7b1781adc4a54887d5d414378575b890e38469de)

# iphone - NSURLConnection 不启动

> ID：845201
> 
> 赞同：0
> 
> 时间：2009-05-10T12:02:04.777
> 
> 标签：iphone, cocoa, cocoa-touch, networking, nsurlconnection

我正在尝试创建一个非常简单的应用程序，它连接到一个 URL 并获取该 URL 的内容，在本例中是一个简单的 xml 文档。我的问题是请求似乎永远不会被发送。

我创建了一个从主文件运行的新项目（基础工具）。我已将 NSURLConnection 的委托设置为 self 并实现了必要的委托方法。问题是这些方法永远不会被调用。如果我将 URL 更改为一些虚假的 URL（如下例所示），这并不重要。在我看来，应用程序在没有发送或等待响应的情况下完成启动。难道是我的应用程序为请求创建了一个线程，然后在不等待响应的情况下完成？我知道该类正在运行，因为我从委托方法中获得了诸如“已创建连接”之类的 NSLOG 语句，但没有 NSLOG 语句。

我错过了什么？

```
#import "NetworkController.h"
@implementation NetworkController

- (id)init
{
    if(self = [super init])
    {

    }   
    return self;
}
- (void)dealloc
{
    NSLog(@"Calling dealloc");
    [super dealloc];
}
- (void) performConnection
{
    NSMutableData *receivedData;
    NSURL *url = [NSURL URLWithString:[NSString stringWithFormat:
                                       @"http://www.test.php?some variables"]];

    NSMutableURLRequest *connectionRequest = [NSMutableURLRequest requestWithURL:url
                                                       cachePolicy:NSURLRequestReloadIgnoringCacheData timeoutInterval:60.0];
    [url release];
    NSURLConnection *theConnection=[[NSURLConnection alloc] initWithRequest:connectionRequest delegate:self startImmediately:YES];

    if (!theConnection)
    {
        NSLog(@"Failed to submit request");
    }
    if(theConnection)
    {
        receivedData=[[NSMutableData data] retain];
        NSLog(@"Created connection.");

        NSLog(@"--------- Request submitted ---------");
        NSLog(@"receivedData: %@", receivedData);
    }

    [connectionRequest release];
}

#pragma mark NetworkController Delegate
- (void)connection:(NSURLConnection *)connection didReceiveResponse:(NSURLResponse *)response
{
    NSLog(@"Received response: %@", response);
    NSLog(@"Received response, connection retain count is %d",[connection retainCount]);
}

#pragma mark NetworkController Delegate
- (void)connection:(NSURLConnection *)connection didReceiveData:(NSData *)data {
    NSLog(@"Connection received data, retain count: %d", [connection retainCount]);
}

#pragma mark NetworkController Delegate
- (void)connectionDidFinishLoading:(NSURLConnection *)connection{
    NSLog(@"finished connection retain count:  %d", [connection retainCount]);}

#pragma mark NetworkController Delegate
- (void)connection:(NSURLConnection *)connection didFailWithError:(NSError *)error {
    NSLog(@"Error receiving response: %@", error);
    [connection release];
}

@end

#import <Foundation/Foundation.h>
#import "NetworkController.h"

int main (int argc, const char * argv[]) {
    NSAutoreleasePool * pool = [[NSAutoreleasePool alloc] init];

    NetworkController *n = [[NetworkController alloc] init];
    n.performConnection;
    [n release];

    // insert code here...
    NSLog(@"Hello, World!");
    [pool drain];
    return 0;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T13:52:03.310

首先，消息语法是：

```
[n performConnection]; 
```

您所拥有的是属性访问语法。而且由于该方法的类型为返回`void`，因此即使在该级别上，我也不能保证它可以工作。

无论如何，主要问题是您正在使用异步 NSURLConnection API（好）但期望同步行为（坏）。所有的 NSURLConnection 方法立即返回，然后在后台工作，想法是在事情发生时将委托消息发送到您的网络控制器 - 但是在您完成所有设置后，您会立即释放网络控制器（反过来泄漏连接，因为您`release`在你的方法中没有`dealloc`），然后退出。

您需要在释放网络控制器之前运行运行循环，以给连接时间以发送请求、读取响应并向网络控制器发送一些委托消息。你还需要`cancel`和`release`网络控制器的`dealloc`方法连接。

此外，您需要将该 NSMutableData 变量设置为实例变量，因为您需要能够从委托方法中访问它。不要忘记在您的`dealloc`方法中也释放它（并将`release`其设置为`nil`指示连接结束的两个委托方法）。

# java - 我可以将 java 与 XULRunner GUI 框架一起使用吗？

> ID：845202
> 
> 赞同：2
> 
> 时间：2009-05-10T12:02:13.623
> 
> 标签：java, xul, xulrunner

我知道我可以编写 c++ 后端并使用 xul(runner) 作为前端，但是我可以使用 java 作为后端并仍然使用 xul 作为前端（执行 java 代码）吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-12T11:36:03.967

使用 XULRunner，您可以直接从您的 javascript 代码中使用 java 类。所以简单地试试这个：

```
var str = new java.lang.String('Test string');
alert(str); 
```

由于 java 插件的 LiveConnect 功能，此行为自动可用。

如果要加载现有的 java 库，则必须使用类加载器，有关更多详细信息，请参阅我的博客：

[从 XUL 应用程序调用 java](http://stanislavvitvitskiy.blogspot.com/2009/04/calling-java-from-xul-applications.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-11T06:44:55.110

您总是可以制作一个使用例如的java后端。java 后端和 XULrunner 前端之间的 RPC 调用。Zimbra 桌面就是这样的例子。

这是一个小概述： [http ://www.zimbrablog.com/blog/archives/2009/04/zimbra-desktop-no-light-no-air.html](http://www.zimbrablog.com/blog/archives/2009/04/zimbra-desktop-no-light-no-air.html)

更多信息在这里： [http ://www.zimbra.com/products/desktop.html](http://www.zimbra.com/products/desktop.html)

[它可以免费下载并且源代码可用： http](http://wiki.zimbra.com/index.php?title=Building_Zimbra_using_Perforce#Building_Zimbra_Desktop) ://wiki.zimbra.com/index.php?title=Building_Zimbra_using_Perforce#Building_Zimbra_Desktop

# java - 读取 Java 变量

> ID：845209
> 
> 赞同：0
> 
> 时间：2009-05-10T12:05:52.977
> 
> 标签：java, memory, applet

我正在尝试从我的 C# 程序的进程中读取 Java 小程序中的变量。除了读取内存地址之外，还有什么方法可以从 Java 小程序中获取变量值？这个 java 小程序将在浏览器中运行。如果无法从 C# 执行此操作，是否可以从不同的 Java 小程序执行此操作？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T12:56:12.537

是的，这是可以做到的。

C#表单可以有可以承载webbrowser组件，可以触发JScript，可以调用Java applet公共方法。

前段时间，我做了一个简单的网页，其中包含一个绘制“热”色地图的小程序。输入是用 JScript 注入的，并且可以用 AJAX 或任何其他可以在 HTML DOM 上触发 JScript 的应用程序来检索。

HTML的来源是：

```
<HTML><HEAD></HEAD><BODY> 
<SCRIPT> 
function call() {
    var inputData = "-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2"
        + ";-2,-2,-2,-2,-2,-2,-2,-2,-2,0,1647,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2"
        + ";-2,-2,-2,-2,-2,-2,-2,-2,-2,89,0,-1,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2"
        + ";-2,-2,-2,-2,-2,-2,-2,0,0,615,366,0,1198,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2"
        + ";-2,-2,-2,-2,-2,-2,0,2179,1262,764,200,0,0,609,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2"
        + ";-2,-2,-2,-2,-2,0,0,3401,1940,0,210,0,-1,-1,162,0,0,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2"
        + ";-2,-2,-2,-2,-2,-2,0,-1,966,0,86,0,0,0,0,-1,-1,0,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2"
        + ";-2,-2,-2,-2,-2,-2,-2,0,0,0,0,0,0,0,-1,250,53,-1,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2"
        + ";-2,-2,-2,-2,-1,1977,1413,128,0,0,0,0,0,0,-1,1413,2447,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2"
        + ";-2,-2,-2,0,-1,0,0,0,0,0,0,0,-1,317,0,-1,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2"
        + ";-2,-2,-2,0,0,0,0,0,0,0,0,0,0,3246,2190,0,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2"
        + ";-2,51,0,-1,0,0,0,-1,0,-1,0,-1,-1,1523,-2,-2,-2,-1,0,0,-2,-2,0,0,-2,-2,-2,-2,-2"
        + ";-2,0,0,0,0,0,0,0,0,0,0,1692,2028,2850,-2,0,-1,0,0,0,0,0,0,0,-1,-2,-2,-2,-2"
        + ";-2,0,0,0,0,0,-1,0,0,0,-1,1292,-2,-2,-2,0,0,-1,-1,0,0,0,0,0,-1,0,-2,-2,-2"
        + ";-2,0,-1,0,0,-1,0,0,-1,0,1028,1247,7675,9244,7940,0,-1,0,0,-1,0,0,0,0,0,0,0,-2,-2"
        + ";-2,-1,0,0,0,0,0,0,0,0,844,1114,2860,6631,4249,0,0,-1,-1,0,0,0,0,0,0,0,0,-2,-2"
        + ";-2,-2,0,0,0,-1,0,-1,0,0,0,-1,1958,2379,-1,0,0,0,0,0,0,0,0,-1,0,0,0,-2,-2"
        + ";-2,-2,-2,0,470,0,-2,-2,-2,0,0,0,-1,0,0,0,0,0,-1,0,-1,0,0,3574,2706,2195,-1,-2,-2"
        + ";-2,-2,-2,-2,-2,-2,-2,-2,-2,0,0,0,-1,-1,0,0,0,0,0,0,0,0,165,-1,-1,1282,867,0,-2"
        + ";-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,0,0,0,0,0,0,-1,0,0,0,0,34,504,3098,2708,2324,-1,0,-2"
        + ";-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,0,0,-1,0,0,0,0,0,0,0,0,0,721,-1,3854,2783,-1,0,-2"
        + ";-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,0,0,0,0,0,-1,0,0,0,-1,0,34,191,2455,4126,0,0,-2"
        + ";-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,0,0,0,0,0,0,0,0,3982,2656,0,0,-1,0,0,-2,-2"
        + ";-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,0,-1,0,0,2194,0,0,0,0,-2,-2,-2,-2"
        + ";-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,0,0,-1,0,0,-2,-2,-2,-2,-2,-2,-2"
        + ";-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2,-2";
    document.Necrodrip.update(inputData);
}
</SCRIPT> 
<FORM> 
<APPLET CODE="kuningriik.pdApplet.class"  
        NAME="Necrodrip" 
        width="1200" height="600"> 
</APPLET><br/> 
<INPUT type="button" value="Loo kaart" 
   onClick = "call()"> 
</FORM> 
</BODY></HTML> 
```

您可以在此处查看页面：[链接](http://www.hot.ee/ocjel/K/aaa.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T13:04:40.597

如果您可以更改小程序的代码，您可以让它托管一个 RMI 服务器，这是[本练习](http://java.sun.com/developer/onlineTraining/rmi/exercises/RMICallback/index.html)的主题。不过，我不是该主题的专家-我认为它可能会受到各种安全限制。

如果您*不能*更改小程序，但*可以*更改显示小程序的 HTML 页面，则有两种方法可以从小程序访问信息。

第一种方法是像@Margus 建议的那样使用Javascript 编写小程序脚本（小程序对象的所有公共方法都通过小程序的DOM 对象公开）。

另一种方法是在页面中放置一个自己的applet，并使用它[`getAppletContext()`](http://java.sun.com/javase/6/docs/api/java/applet/Applet.html#getAppletContext())来获取对另一个applet 的引用。这样做的主要好处是您可以通过反射从第三方小程序访问非公开信息，并将其发布到 RMI 服务器（如上）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T12:30:25.013

这根本不可能。

**根据定义，进程不共享内存**或任何其他资源。这是在操作系统级别强制执行的，您对此无能为力。

如果这是可能的，您只能想象这可能是什么安全/稳定性问题。

如果您确实需要进程间通信，请查看您的语言中的套接字编程。请注意，这将需要同时更改客户端（您的 Java 小程序）和服务器（C# 进程）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T12:30:35.017

如果您安装了 JDK 并且正在运行更高版本的 JVM，则可以从正在运行的 Java 进程（包括在浏览器中）访问信息。看看这些[JDK 工具](http://java.sun.com/javase/6/docs/technotes/tools/index.html#troubleshoot)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-10T15:27:24.537

这是调试器一直在做的事情，所以很明显这是可能的。在最近的 Sun Java 版本中，您可以在进程启动后相对轻松地附加 JVM 工具接口 (JVMTI)。但是，这并不一定很容易。

如果您控制小程序源（或者即使您不控制），通过网络连接共享数据可能更容易。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-05-10T12:13:19.873

不。您尝试做的事情是不可能通过 Java Applet 或任何其他语言、进程来完成的。

# php - 获取远程文件的最后修改日期

> ID：845220
> 
> 赞同：35
> 
> 时间：2009-05-10T12:12:10.427
> 
> 标签：php, jquery, curl

我想通过 curl 获取远程文件的最后修改日期。有谁知道这是怎么做到的吗？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-05-10T12:21:07.590

您可能可以使用以下方法执行此类操作[`curl_getinfo()`](http://php.net/manual/en/function.curl-getinfo.php)：

```
<?php
$curl = curl_init('http://www.example.com/filename.txt');

//don't fetch the actual page, you only want headers
curl_setopt($curl, CURLOPT_NOBODY, true);

//stop it from outputting stuff to stdout
curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);

// attempt to retrieve the modification date
curl_setopt($curl, CURLOPT_FILETIME, true);

$result = curl_exec($curl);

if ($result === false) {
    die (curl_error($curl)); 
}

$timestamp = curl_getinfo($curl, CURLINFO_FILETIME);
if ($timestamp != -1) { //otherwise unknown
    echo date("Y-m-d H:i:s", $timestamp); //etc
} 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2012-10-12T12:45:23.570

在 PHP 中，您可以使用本机函数`get_headers()`：

```
<?php
$h = get_headers($url, 1);

$dt = NULL;
if (!($h || strstr($h[0], '200') === FALSE)) {
    $dt = new \DateTime($h['Last-Modified']);//php 5.3
} 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-05-10T12:20:05.587

来自[php的文章](http://ar.php.net/filemtime)：

```
<?php
// outputs e.g.  somefile.txt was last modified: December 29 2002 22:16:23.

$filename = 'somefile.txt';
if (file_exists($filename)) {
    echo "$filename was last modified: " . date ("F d Y H:i:s.", filemtime($filename));
}
?> 
```

filemtime() 是这里的关键。但我不确定您是否可以获得**远程**文件的最后修改日期，因为服务器应该将它发送给您......也许在 HTTP 标头中？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-11-21T23:09:23.760

有时标题带有不同的大写小写，这应该有帮助：

```
function remoteFileData($f) {
    $h = get_headers($f, 1);
    if (stristr($h[0], '200')) {
        foreach($h as $k=>$v) {
            if(strtolower(trim($k))=="last-modified") return $v;
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-10T12:42:57.157

您可以使用 激活接收回复的标题`curl_setopt($handle, CURLOPT_HEADER, true)`。您还可以打开 CURLOPT_NOBODY 以仅接收标头，然后将结果分解为 \r\n 并解释单个标头。标题`Last-Modified`是您感兴趣的标题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-03-22T12:31:52.593

通过编辑 h4kuna 的答案，我创建了这个：

```
$fileURL='http://www.yahoo.com';
$headers = get_headers($fileURL, 1);
$date = "Error";
//echo "<pre>"; print_r($headers); echo "</pre>";
if ( $headers && (strpos($headers[0],'200') !== FALSE) ) {
    $time=strtotime($headers['Last-Modified']);
    $date=date("d-m-Y H:i:s", $time);
}
echo 'file: <a href="'.$fileURL.'" target="_blank">'.$fileURL.'</a> (Last-Modified: '.$date.')<br>'; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-10T12:21:11.630

像这样的工作，来自[网络开发者论坛](http://www.webdeveloper.com/forum/showthread.php?t=81776)

```
<? $last_modified = filemtime("content.php"); print("Last Updated - ");
print(date("m/d/y", $last_modified)); ?

// OR

$last_modified = filemtime(__FILE__); 
```

该链接提供了一些有用的网站，您可以使用它们

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-01-28T15:26:50.613

必须解决类似的问题，但对我来说每天下载一次就足够了，所以我只比较了本地（下载）缓存文件的修改日期。远程文件没有 Last-Modified 标头。

```
$xml = 'test.xml';
if (is_file($xml) || date('d', filemtime($xml)) != date('d')) {
    $xml = file_get_contents(REMOTE_URL);
} 
```

# version-control - 是否有可以忽略大型机序列号的现代免费 D?VCS？

> ID：845222
> 
> 赞同：3
> 
> 时间：2009-05-10T12:12:44.393
> 
> 标签：version-control, dvcs, mainframe

我正在考虑将大量 IBM 汇编语言程序套件从基于“文件名包括版本号”的 vcs 迁移到现代 vcs，这将使我能够分支和合并。

这些文件有 80 列记录，最后 8 列是几乎没有意义的序列号。

由于许多我不想浪费空间的原因，我需要 vcs 忽略（但希望以某种明确定义的方式保留）序列号列，并仅基于前 72 列的内容。

有任何想法吗？

* * *

只是为了澄清“忽略但保留”：我接受它有点模糊，因为我还没有完全收集我的想法。

这将是这样的：

> “合并/打补丁时，如果一侧有序列号，则输出它们；如果多于一侧有序列号，则使用文件中存在的序列号 (1|2|3)”

* * *

为什么要保留序列号？首先，它们确实*是*序列号。其次，我想将这些东西重新集成到大型机上，其中序列号可能非常重要。（知道“SMP/E”是什么意思的人会明白。不知道的人，高兴，但颤抖......）

* * *

我刚刚意识到我没有接受答案。艰难的选择，但@Noldorin 最接近我要去的地方。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T13:07:11.023

在 Mercurial 中，您可以轻松地忽略 .asm 文件的第 73 列 - 只需将以下行添加到您的 .hgrc 中：

```
[encode]
*.asm: cut -b -72 
```

（或者如果您也想支持 Windows 系统，则采用稍微复杂的方法；-)。但是，这不符合您的“忽略但保留”规范的“保留”部分（正如尼尔的评论指出的那样，这本身就有些问题）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T12:21:26.437

我相信任何现代版本控制系统（[Subversion](http://subversion.tigris.org/)和[Bazaar](http://bazaar-vcs.org/)是我通常推荐的，分别是[集中式和分布式](http://en.wikipedia.org/wiki/Distributed_revision_control)的）都可以利用外部差异/合并工具。不幸的是，我认为您必须自己编写此自定义合并工具（至少我从未听说过您需要的工具），尽管我想这不应该是一项艰巨的任务。[话虽如此，您可能对这个 StackOverflow 问题](https://stackoverflow.com/questions/218053/tools-for-svn-merging)和[这个](https://stackoverflow.com/questions/50371/better-merge-tool-for-subversion)问题中给出的建议有一些运气. 抱歉，我无法提供更多信息，说明您特别想研究哪些内容，但值得浏览一下，以防它们中的任何一个确实满足您的要求。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T14:37:01.130

我认为“保留”的含义是这里的关键。当您说序列号“几乎没有意义”时，“几乎”是否包括序列以外的任何内容？在 Dreamtime 中，我们曾经在那里编写过一种程序流程图（您可以在 Brooks 的神话人物月的第一版中找到一个示例），但幸运的是这种做法已经消失了。

如果序列号列的唯一含义是作为有序的数字序列。我很想使用@Alex 的方法——你可以在任何现代 VC 工具中预处理来自脚本的文件——来剪切序列号，然后当你提取文件时，使用类似的工具再次对记录重新排序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-22T21:56:01.173

（披露：我代表此答案中描述的工具供应商）。

您想要的是一个 diff 工具，该工具可以理解第 72-80 列中的内容是“空白”，而不管您是否用字符填充了它。

[Semantic Designs COBOL Smart Differencer](http://www.semanticdesigns.com/Products/SmartDifferencer/COBOLSmartDifferencer.html)有一个 IBM Enterprise COBOL 变体，可以很好地理解这一点 。

SD 为各种语言制作 Smart Differencers，而 IBM Assembler 是未来的目标。如果您有兴趣，请离线联系 SD 以讨论 IBM Assembler 的 Smart Differencer。

# c# - NHibernate 2.0：什么是正确的 EntityMode：POCO、Map 或 Xml

> ID：845225
> 
> 赞同：1
> 
> 时间：2009-05-10T12:14:42.830
> 
> 标签：c#, nhibernate

我在 NHibernate 2.0 中使用了一些 NHibernate 1.2 代码，这给了我一个问题：

```
return (TId) entityMeta.GetIdentifier(entity); 
```

它要求我添加 EntityMode：POCO、Map 或 Xml

```
return (TId) entityMeta.GetIdentifier(entity, EntityMode.Map); 
```

但是哪种模式是正确的使用模式？

* * *

这是整个方法：

```
public TId GetId<TId>(TEntity entity)
{
    ISessionFactory sessionFactory = NHibernateSessionManager.Instance.GetSessionFactoryFor(assembly);

    if (sessionFactory == null)
    {
        sessionFactory = NHibernateSessionManager.Instance.GetSessionFactoryFor(GetNHibernateConfig());
    }

    IClassMetadata entityMeta = sessionFactory.GetClassMetadata(typeof(TEntity));

    return (TId) entityMeta.GetIdentifier(entity, EntityMode.Map);
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T18:06:35.253

您需要使用 EntityMode.POCO，更多信息可在此[博客上找到](http://nhibernate.info/blog/2008/10/16/less-than-gof-is-hbm.html)

# css - Django 模板：在 Threes 中分组项目

> ID：845227
> 
> 赞同：5
> 
> 时间：2009-05-10T12:15:29.137
> 
> 标签：css, django, templates

我对 Django 有一个奇怪的问题。我有一组对象，我像往常一样在模板中循环遍历。但是，我需要将这些项目分成三组。页面布局如下：

绘画 1 - 绘画 2 - 绘画 3

说明 1
说明 2
说明 3

绘画 4 - 绘画 - 5 绘画 6

说明 4
说明 5
说明 6

等等等等

我无法弄清楚真正做到这一点的最佳 Django 标签集。似乎有些棘手。{% cycle %} 语句没有多大帮助。

当然，除非我做一些 java 脚本黑客攻击，让 Django 离开这个？必须以某种方式说“将所有描述 div 一个接一个”或类似的说法。不确定如何最好地使用此排序。有什么想法吗？干杯。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2011-09-10T19:42:16.263

您可以为此使用一个简单的过滤器：

```
import itertools

from django import template

register = template.Library()

@register.filter
def chunks(value, chunk_length):
    """
    Breaks a list up into a list of lists of size <chunk_length>
    """
    clen = int(chunk_length)
    i = iter(value)
    while True:
        chunk = list(itertools.islice(i, clen))
        if chunk:
            yield chunk
        else:
            break 
```

然后在您的模板中：

```
{% for chunk in paintings|chunks:3 %}
  <div class="row">
    {% for painting in chunk %}
      <div>{{ painting }}</div>
    {% endfor %}
  </div>
{% endfor %} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-10T17:03:50.997

每当您发现自己在模板中尝试复杂的代码时，这通常是一个很好的迹象，表明应该将其移到其他地方。已经提出了一种替代解决方案，即将代码移动到您的视图函数中。

另一种解决方案是通过新的模板标签公开功能。您选择此解决方案而不是视图解决方案的原因之一是，您将能够轻松地为使用不同视图提供的页面重用代码。

```
class GroupPaintingsNode(template.Node):
    def __init__(self, num, varname):
        self.num, self.varname = int(num), varname

    def render(self, context):
        paintings = Painting.objects.all # do your fetching/filtering here.. 
        l = [[] for i in range(len(paintings))]
        i = 0
        while i < len(paintings):
            l[i].append([p.title for p in paintings[i:i+self.num]])
            l[i].append([p.desc for p in paintings[i:i+self.num]])
            i += self.num
        context[self.varname] = l
        return ''

def group_paintings(parser, token):
    tokens = token.contents.split()
    if len(tokens) != 4:
        raise template.TemplateSyntaxError, "'%s' tag requires three arguments" % tokens[0]
    if tokens[2] != 'as':
        raise template.TemplateSyntaxError, "Second argument to '%s' tag must be 'as'" % tokens[0]
    return GroupPaintingsNode(tokens[1], tokens[3])
group_paintings = register.tag(group_paintings) 
```

在模板代码中，您可以像这样使用它：

```
{% group_paintings 3 as paintings %}
{% for p in paintings %}
    {% for title in p.0 %} {{ title }} {% endfor %}<br>
    {% for desc in p.1 %} {{ desc }} {% endfor %}
{% endfor %} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-10T12:27:31.757

这些线周围的东西怎么样：

```
{% for p in paintingss %}
    <div class="painting">whatever</div>
    {% if forloop.counter|divisibleby:"3" %}
        <br>
    {% endif %}
{% endfor %} 
```

这对你有好处吗？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-10T15:33:09.943

我绝对赞成在您的视图中创建结构并以正确的形式将其传递给您的模板。

如果您发现自己在模板逻辑上苦苦挣扎，那么这表明您应该在您的视图中做更多的工作。（这也告诉我，我的很多视图逻辑需要被推回到我的模型中......）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-10T12:50:58.340

Yuval 在正确的行上，但看起来好像您想要循环浏览绘画列表两次：一次显示名称（每行三个），一次用于描述。这一点在模板语言中并不容易实现。

我建议看看你是否可以用一些 CSS 做点什么。应该可以为名称和/或描述 div 分配一个类，以便所有名称都向左浮动，并且描述显示为下方的块。不过，仍然很棘手。

或者，您可以在视图中预处理列表，以便将名称和描述分成三组。你想最终得到这个结构：

```
[
    [name1, name2, name3],
    [description1, description2, description3],
    [name4, name5, name6],
    [description4, description5, description6],
    ...
] 
```

所以你可以尝试这样做：

```
painting_list = []
counter = 0
while counter < len(paintings):
    painting_list.append([p.name for p in paintings[counter:counter+3])
    painting_list.append([p.description for p in paintings[counter:counter+3])
    counter += 3 
```

然后在您的模板中：

```
{% for group in painting_list %}
    <div class="names">{% for name in group.0 %}{{ name }} {% endfor %}</div>

    <ul class="descriptions">
        {% for description in group.1 %}
        <li>{{ description }}</li>
        {% endfor %}
    </ul>
{% endfor %} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-10T17:55:10.810

```
{% for painting in painting_list %}
    <div class="painting">{{ painting }}</div>
    {% if forloop.counter|divisibleby:"3" %}
        <br>
        {{ description_list.forloop.counter0-2 }}
        {{ description_list.forloop.counter0-1 }}
        {{ description_list.forloop.counter0 }}
    {% endif %}
{% endfor %} 
```

只是让您知道此代码不起作用，但是您想要这样的东西。

也许您可以想出自己的模板标签来访问对象列表中的第 n 个对象。

# c# - 将 Web 应用程序与 SharePoint 集成有哪些好的资源？

> ID：845228
> 
> 赞同：0
> 
> 时间：2009-05-10T12:16:17.927
> 
> 标签：c#, asp.net, sharepoint, integration

我需要了解将 ASP.Net C# Web 应用程序与 SharePoint 集成的各种方法。从最松耦合（只需从 SharePoint 中提取一些内容）到完全双向同步、版本控制、工作流等。

有哪些链接或书籍可以让我快速了解最佳选择和方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T12:40:14.570

不太确定这是否对您有帮助，但是“[部署 Windows SharePoint Services 3.0 技术](http://go.microsoft.com/fwlink/?LinkID=115666)”免费电子书可能会帮助您。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T19:00:56.320

冒着明显的风险，微软实际上已经尝试使 SharePoint 3 的文档比过去的版本好得多。

*   TechNet：[Windows SharePoint Services 3.0](http://technet.microsoft.com/en-us/library/cc288070.aspx)
*   MSDN：[Windows SharePoint Services 开发人员中心](http://msdn.microsoft.com/en-us/sharepoint/default.aspx)
*   MSDN：[Windows SharePoint Services 3.0 SDK](http://msdn.microsoft.com/en-us/library/ms441339.aspx)
*   MSDN：[Windows SharePoint Services 3.0](http://msdn.microsoft.com/en-us/library/bb931737.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T23:45:05.233

如需一本好书，请查看 Wrox 的 Professional SharePoint 2007 Development。 [http://www.amazon.com/Professional-SharePoint-2007-Development-Programmer/dp/0470117567/ref=sr_1_1?ie=UTF8&s=books&qid=1241998957&sr=8-1](https://rads.stackoverflow.com/amzn/click/com/0470117567)

最好的方法实际上取决于要求，但当前技术有许多选择。

# java - Java负整数到十六进制并返回失败

> ID：845230
> 
> 赞同：8
> 
> 时间：2009-05-10T12:17:26.013
> 
> 标签：java, parsing, decimal, hex, signed

```
public class Main3 {
    public static void main(String[] args) {
        Integer min = Integer.MIN_VALUE;
        String minHex = Integer.toHexString(Integer.MIN_VALUE);

        System.out.println(min + " " + minHex);
        System.out.println(Integer.parseInt(minHex, 16));
    }
} 
```

给

```
-2147483648 80000000
Exception in thread "main" java.lang.NumberFormatException: For input string: "80000000"
    at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)
    at java.lang.Integer.parseInt(Integer.java:459)
    at Main3.main(Main3.java:7) 
```

这是怎么回事？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-10T14:05:08.620

这是一直困扰我的事情。如果使用十六进制文字初始化 int，则可以使用最大范围内的正值`0xFFFFFF`；任何大于`0x7FFFFF`实际上都是负值。这对于位掩码和其他操作非常方便，您只关心位的*位置*，而不是它们的含义。

但是，如果您使用 Integer.parseInt() 将字符串转换为整数，则任何大于该值的都`"0x7FFFFFFF"`将被视为错误。他们这样做可能有一个很好的理由，但这仍然令人沮丧。

最简单的解决方法是改用 Long.parseLong()，然后将结果转换为 int。

```
int n = (int)Long.parseLong(s, 16); 
```

当然，只有当您确定数字将在范围内时，您才应该这样做`Integer.MIN_VALUE..Integer.MAX_VALUE`。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-10T12:54:28.007

据记录，`Integer.toHexString`将整数的字符串表示形式返回为无符号值 - 而`Integer.parseInt`采用带符号的 int。如果你使用`Integer.toString(value, 16)`它，你会得到你想要的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2014-12-06T14:13:09.883

根据文档，[`toHexString`](http://docs.oracle.com/javase/7/docs/api/java/lang/Integer.html#toHexString%28int%29)返回*“整数参数的字符串表示形式，以16 为基数的**无符号整数。”***

所以正确的反向操作可能[`Integer.parseUnsignedInt`](https://docs.oracle.com/javase/8/docs/api/java/lang/Integer.html#parseUnsignedInt-java.lang.String-int-)是作为 Java 8 的一部分引入的：

```
public class Main3 {
    public static void main(String[] args) {
        Integer min = Integer.MIN_VALUE;
        String minHex = Integer.toHexString(Integer.MIN_VALUE);

        System.out.println(min + " " + minHex);
        System.out.println(Integer.parseUnsignedInt(minHex, 16));
    } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-10T13:58:19.070

尝试这个：

```
public class Main3 {
    public static void main(String[] args) {
        Integer min = Integer.MIN_VALUE;
        String minHex = Integer.toHexString(Integer.MIN_VALUE);

        System.out.println(min + " " + minHex);
        System.out.println(Integer.parseInt( "-" + minHex, 16));
    } 
```

}

得到这个：

```
-2147483648 80000000
-2147483648 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-10T12:20:12.703

您需要[包含一个负](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Integer.html#parseInt%28java.lang.String,%20int%29)号。

我现在无权对此进行测试，但我敢打赌，如果您尝试使用此值：

```
Integer min = Integer.MIN_VALUE + 1; 
```

它不会爆炸，但会在您运行时给您一个正数（而不是负数）`ParseInt(min,16)`。

一串位*实际上*没有足够的信息来确定此上下文中的符号，因此您需要提供它。（考虑使用 . 的情况`min = "F"`。那是 +/-F 吗？如果您将其转换为位并看到 1111，*并且*您知道它是一个字节，您可能会得出结论它是负数，但这是很多 ifs。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-11-27T11:25:55.780

这似乎对我有用：

```
public class Main3 {
public static void main(String[] args) {
    Integer min = Integer.MIN_VALUE;
    String minHex = Integer.toHexString(Integer.MIN_VALUE);

    System.out.println(min + " " + minHex);
    System.out.println((int)Long.parseLong(minHex, 16));
}
} 
```

整数被解析为处理如此大的正数的“有符号长整数”，然后通过将其转换为“int”来找到符号。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2022-01-27T19:56:29.180

`Integer.parseInt()`接受一个有符号整数作为输入。这意味着输入必须在“7FFFFFFF”和“-80000000”之间。注意“80000000”之前的负号。你想要的是`Integer.parseInt("-80000000", 16)`. 如果使用不带减号的 80000000，Java 会将其解释为正数并抛出异常，因为 int 的最大正整数为 0x7FFFFFFF。

# java - 使用 Java 解析包含转义字符的字符串

> ID：845233
> 
> 赞同：5
> 
> 时间：2009-05-10T12:20:55.733
> 
> 标签：java, regex

我想知道是否有人可以帮助我弄清楚如何解析具有以下格式的字符串：

```
;field1-field2-fieldN;field1-field2-fieldN; 
```

每条记录由';'分隔 并且记录中的每个字段都由“-”分隔。复杂之处在于各个字段可能包含转义的分隔符，例如“\;” 或者 ”-”。这导致我下面的简单解析代码失败。所以我想做的是想出匹配分隔符但不匹配转义分隔符的正则表达式。我的正则表达式知识不是那么好，但我希望必须有一种结合“（[^\;]）”和“（[;]）”的方法来获得我需要的东西。

```
public static List<ParsedRecord> parse(String data) {
    List<ParsedRecord> parsedRecords = new List<ParsedRecord>();
    String[] records = data.split(";");
    for (String record : records) {
        String[] fields = data.split("-");
        parsedRecords.add(new parsedRecord(fields));
    }
    return parsedRecords;
} 
```

首先十分感谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-10T12:25:40.890

您可能最好在同一通道中进行取消转义和拆分。我知道将两个单独的功能分开感觉是错误的，但它避免了一些尴尬的极端情况（例如，想象“foo\;bar”，其中 ; 跟随反斜杠但仍然是分隔符）。

这是一些非常简单的代码来进行解析 - 它假定任何反斜杠基本上意味着“将下一个字符视为普通输入”，仅此而已。

```
import java.util.*;

public class Test
{
    public static void main(String[] args)
    {
        List<String> parsed = parse(args[0]);
        for (String x : parsed)
        {
            System.out.println(x);
        }
    }

    public static List<String> parse(String text)
    {
        List<String> ret = new ArrayList<String>();
        StringBuilder current = new StringBuilder();
        boolean escaping = false;

        for (int i=0; i < text.length(); i++)
        {
            char c = text.charAt(i);
            if (escaping)
            {
                current.append(c);
                escaping = false;
            }
            else
            {
                if (c == '\\')
                {
                    escaping = true;
                }
                else if (c == ';')
                {
                    ret.add(current.toString());
                    current = new StringBuilder();
                }
                else
                {
                    current.append(c);
                }
            }
        }
        if (escaping)
        {
            throw new IllegalArgumentException("Ended in escape sequence");
        }
        ret.add(current.toString());
        return ret;
    }
} 
```

（请注意，这不会将每条记录拆分为多个字段，但您只需要更改您对 ';' 所做的事情，并对 '-' 做出反应 - 原理是相同的。）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-10T13:02:05.487

您也许可以像这样改进与 split 一起使用的正则表达式：

```
split("[^\\];") 
```

分裂任何“;” 但如果在此之前有一个“\”，则不是。破折号也是如此：

```
split("[^\\]-") 
```

# c# - c# HwndSourceHook with Windows.Forms

> ID：845240
> 
> 赞同：2
> 
> 时间：2009-05-10T12:25:43.463
> 
> 标签：c#, hwnd

我找到了这段代码：

> ```
>  protected override void OnSourceInitialized(EventArgs e)
>     {
>         base.OnSourceInitialized(e);
>         HwndSource hwndSource = PresentationSource.FromVisual(this) as HwndSource;
> 
>         if (hwndSource != null)
>         {
>             installedHandle = hwndSource.Handle;
>             viewerHandle = SetClipboardViewer(installedHandle);
>             hwndSource.AddHook(new HwndSourceHook(this.hwndSourceHook));
>         }
>     } 
> ```

启动 hwndSourceHook（捕获剪贴板）。但是此代码仅适用于“Window”，但不适用于“Windows.Form”。

我怎样才能让我的表单的 hwndSource 添加 hwndSourceHook？

（而不是覆盖我应该使用我认为的 Form_Load 函数......）

**编辑：谢谢，但表单没有 AddHook 函数来添加我的 hwndSourceHook**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-10T13:16:06.300

如果您使用的是 WinForms，那么它只是 myForm.Handle

HwndSource 用于 WPF。

所以你可以这样做：

```
viewerHandle = SetClipboardViewer(myForm.Handle); 
```

编辑：AddHook 也是一种 WPF 方法。

您需要使用：

```
Application.AddMessageFilter(...); 
```

或者，在您的 Form 类中覆盖 WndProc 方法：

```
protected override void WndProc(ref Message m) {...} 
```

AddMessageFilter 可以捕获应用程序中任何窗口的消息，而 WndProc 将只接收给定窗口的消息。

# javascript - 阻止原型中的 Ajax 对象吞下异常的最方便的方法是什么？

> ID：845241
> 
> 赞同：1
> 
> 时间：2009-05-10T12:26:10.877
> 
> 标签：javascript, ajax, exception, prototypejs

考虑这段代码：

```
new Ajax.Request('?service=example', {
    parameters : {tags : 'exceptions'},
    onSuccess : this.dataReceived.bind(this)
}); 
```

如果在 Ajax 对象调用 dataReceived 函数时发生异常，它会被一些异常处理代码吞下，然后整个过程静默终止。从来没有向浏览器抛出异常，调试起来有点乏味（出于可以理解的原因）。有什么直接的方法可以防止这种情况发生吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T13:16:10.450

我认为您可以`onException`在请求选项中包含一个回调处理程序：

```
new Ajax.Request('?service=example', {
  parameters : {tags : 'exceptions'},
  onSuccess : this.dataReceived.bind(this),
  onException : function(request, ex) { // react somehow }
}); 
```

要在全局级别上执行此操作，可以使用[`Ajax.Responders`对象](http://www.prototypejs.org/api/ajax/responders)注册回调处理程序：

```
Ajax.Responders.register({
  onException: function(request, ex) {
    // react somehow
  }
}); 
```

第一个参数将是`Ajax.Request`触发回调的对象。

[PS/FYI：原型源](http://www.prototypejs.org/assets/2009/3/27/prototype.js)代码中的此代码隐藏了您的异常：

```
dispatchException: function(exception) {
  (this.options.onException || Prototype.emptyFunction)(this, exception);
  Ajax.Responders.dispatch('onException', this, exception);
} 
```

下面介绍如何正确实现 onException 回调。

```
Ajax.Responders.register({ 
        onException: function(request, exception) { 
                (function() { throw exception; }).defer(); 
        } 
}); 
```

如此处所述：[https ://stackoverflow.com/a/2606239/147349](https://stackoverflow.com/a/2606239/147349)

# svn - 有没有办法在 Windows 资源管理器中查看 SVN 修订号？

> ID：845242
> 
> 赞同：3
> 
> 时间：2009-05-10T12:26:59.320
> 
> 标签：svn, windows-explorer

有没有办法可以在 Windows 资源管理器的详细信息视图中添加一列，显示每个文件的颠覆修订号？

我在 Vista 上，正在使用 TortoiseSVN。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-10T13:05:23.390

不在 Vista 中；请参阅TortoiseSVN 的[Vista 问题页面：](http://tortoisesvn.net/vistaproblems)

> Vista 中的 Windows 资源管理器发生了相当大的变化，其中一个变化是放弃了额外的列，但引入了一个新的“属性系统”。由于属性系统是基于文件类型的，我们不能再为 Subversion 信息添加一列:(

在 XP 中是可行的；参见[TortoiseSVN 文档](http://tortoisesvn.net/docs/release/TortoiseSVN_en/tsvn-dug-wcstatus.html#id442566)：

> 只需右键单击列的标题之一，`More...` 从显示的上下文菜单中选择。将出现一个对话框，您可以在其中指定列及其顺序，该对话框显示在“详细视图”中。向下滚动直到出现以 SVN 开头的条目。检查您想要显示的内容，然后按 OK 关闭对话框。这些列将附加到当前显示的列的右侧。您可以通过拖放对它们重新排序，或调整它们的大小，使它们符合您的需要。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-10T12:36:02.340

在 XP 之前（包括），如果您安装了 TortoiseSVN（记得重新启动），您可以在资源管理器的详细视图中找到“SVN 修订版”。启用它，然后它应该可以工作。

在 Vista 之后，您不能这样做。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-09-28T17:23:01.793

尽管我自己没有尝试过，但现在似乎有一个解决方案。

[探索者²](http://www.zabkat.com/blog/07Feb10-column-handlers-revived.htm)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T12:30:11.473

在 subversion 目录中打开 windows explorer 并右键单击列标题 从菜单中选择 More.. 然后从对话框中选择所需的 SVN 属性。

# objective-c - 您如何使状态项的标题成为图像而不是文本？

> ID：845248
> 
> 赞同：1
> 
> 时间：2009-05-10T12:30:47.137
> 
> 标签：objective-c, cocoa

我为我的应用程序创建了一个状态项（菜单栏项），但目前它的标题是文本，我该如何让它显示图像？

这是设置标题的代码部分。我需要更改该代码以使其显示图像？

```
[item setTitle:@"MenuItem"]; 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-10T12:34:05.203

您使用[setImage:](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSStatusItem_Class/Reference/Reference.html#//apple_ref/occ/instm/NSStatusItem/setImage:)方法，为它提供`NSImage`要在菜单栏上显示的内容。

另请注意，您可以`NSStatusItem`显示图像*和*文本，例如使用电池指示器。

这是一个将图像设置为名为的文件的小示例`OtherImage.jpg`：

```
NSImage *statusItemImage = [NSImage imageNamed:@"OtherImage"];
if( !statusItemImage ) {
  NSLog(@"ERROR: Could not load the image for 'OtherImage.png'");
} else {
  [item setImage:statusItemImage];
} 
```

确保文件 OtherImage.png 实际添加到您的 Xcode 项目并复制到应用程序的`Resources`目录中。如果您的图像未加载，则意味着该文件未正确命名，不是真正的图像，或者实际上不在应用程序包中。

# php - 基于邮政编码的搜索

> ID：845251
> 
> 赞同：2
> 
> 时间：2009-05-10T12:32:51.250
> 
> 标签：php, sql, zipcode

我想使用美国城市和州或邮政编码进行地理搜索，并将查看相应的结果。在搜索中我们不得不提到半径距离。例如：我想在加利福尼亚周围 25 英里范围内进行搜索。

我应该怎么做？有没有包含美国城市、州、邮编、纬度、经度信息的数据库？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-10T12:51:13.503

[地名](http://www.geonames.org/)

> GeoNames 地理数据库涵盖所有国家，包含超过 800 万个地名，可供免费下载。

还有一个网络服务。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T13:13:43.800

将邮政编码数据转换为经度和纬度后，这里有一些用于处理坐标的资源。

[将英里转换为经度和纬度](http://www.johndcook.com/blog/2009/04/27/converting-miles-to-degrees-longitude-or-latitude/)

[从经度和纬度计算距离](http://www.johndcook.com/lat_long_details.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T12:48:36.803

有关基于邮政编码的地理位置，请参阅[http://code.google.com/p/zip-code/](http://code.google.com/p/zip-code/)例如。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-07-21T04:11:18.747

啊！人们为什么要为这些东西收费？甚至 USPS 也不会免费为您提供当前的邮政编码数据库，并且上述链接中的数据库已经多年没有更新，这可能会让用户陷入困境。这是免费的公共数据！

因此，我通过使用较旧的 zip 数据集创建了一个数据库，并将其连接到 Google 的地理编码 API 以使其保持最新状态。到 2011 年 7 月为止，这一项都已完成。

以 MySql、CSV 或 Excel格式下载[免费的邮政编码数据集。](http://www.lustforge.com/2011/07/20/really-free-zipcode-database-download/)

# geometry - 具有闭合多边形和岛屿的折线偏移

> ID：845254
> 
> 赞同：2
> 
> 时间：2009-05-10T12:34:35.253
> 
> 标签：geometry, 3d, coordinate-systems

我有一组未排序的线段，彼此之间没有任何绑定。每条线用 2 个点 (x,y) 描述。我可以搜索具有相同点的线，这意味着它们应该连接起来。

每条线都有一个粗细属性。我需要将每条路径偏移这个厚度，并创建 4 个点来描述最终的多边形（每条线）。

[截图 1](https://sites.google.com/site/dusanmaliarik/screenshot1.png)

现在我需要改进它以正确处理角落（连接）。但不知道该怎么做。

期望的结果：[截图 2](https://sites.google.com/site/dusanmaliarik/screenshot2.png)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-10T16:10:33.183

有关使用多边形骨架偏移多边形的一种方法，请参见[此处](http://www.cgal.org/Manual/3.2/doc_html/cgal_manual/Straight_skeleton_2/Chapter_main.html)（这是您在此处尝试执行的操作）。

# sql - 在 MySQL 语句中匹配 ID 集的“更好”方法

> ID：845255
> 
> 赞同：0
> 
> 时间：2009-05-10T12:34:36.080
> 
> 标签：sql, mysql

我目前正在运行一些 SQL，它使用 IN 表达式来匹配多个 ID。但是，理想情况下，我希望能够将某些 ID 与其他 ID 匹配，因此它们必须一起出现才能返回结果。这是一个例子：

编辑：我匹配的 ID 是多对多关系的一部分。结构是这样的：

文章文章关键词关键词

一篇文章可以有多个通过 ArticleKeywords 表链接到它的关键词。我目前正在使用 IN 表达式将任何关键字 ID 与记录匹配。但是，我想将某些记录与一小组关键字进行匹配，即一个关键字必须与另一个关键字一起出现才能匹配记录。

当前： ... AND id IN ('25', '566', '156', '166', '7345')

更具体： ... AND ((id = '25' AND id = '566') OR (id = '156' AND id = '166') OR (id = '7345'))

尽管第二个选项可能有效，但我认为它可能不会非常精通性能。有没有另一种方法可以做到这一点，或者我应该以另一种方式去做？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T13:26:11.720

根据评论编辑。假设您正在搜索以下文章：

*   有一个名为“a1”的关键字
*   或者，将两个关键字命名为“b1”和“b2”
*   或者，使用关键字“c1”、“c2”或“c3”

您可以像这样查询：

```
select a.id
from Articles a 
inner join ArticleKeywords ak on ak.articleid = a.id
inner join Keywords k on k.id = ak.keywordid
group by a.id
having 
    sum(case when k.name in ('a1') then 1 else 0 end) = 1
    or sum(case when k.name in ('b1','b2') then 1 else 0 end) = 2 
    or sum(case when k.name in ('c1','c2,'c3') then 1 else 0 end) > 0 
```

根据 SquareCog 的评论，您可以使用早期的 WHERE 子句大大提高性能。该子句将分组仅限于相关关键字。在上面的查询中，在 HAVING 之前添加 WHERE：

```
...
inner join Keywords k on k.id = ak.keywordid
where k.name in ('a1','b1','b2','c1','c2','c3')
group by a.id
... 
```

您可以检索文章的其他详细信息，例如：

```
select *
from Articles
where id in (
    ...query from above here...
) 
```

假设您有一个包含要搜索的组的表，定​​义如下：

```
groupid - keywordid
1 - 1
1 - 2
2 - 3 
```

这意味着文章必须匹配（（关键字 1 和关键字 2）或关键字 3）。然后你可以这样查询：

```
select ak.articleid
from ArticleKeywords ak
inner join Search s on ak.keywordid = s.keywordid
group by s.searchgroup, ak.articleid
having count(*) = (
    select count(*) from #Search s2 where s2.Searchgroup = s.SearchGroup
) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T12:40:53.513

那么你的第二个选择永远不会奏效......

```
((id = '25' AND id = '566') --For this to return the column `id` would have to = both 25 & 566 which it obviously can't
OR 
(id = '156' AND id = '166') --For this to return the column `id` would have to = both 156 & 166 which it obviously can't
OR 
(id = '7345')) 
```

您到底想达到什么目的...“将某些 ID 与其他 ID 匹配，因此它们必须一起出现”是什么意思？您是指在连续的行上吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T16:33:47.977

Andomar 给出的答案使用and[是](https://stackoverflow.com/questions/845255/better-method-for-matching-id-sets-in-mysql-statement/845331#845331)`GROUP BY`解决`HAVING`此类问题的常用方法，但它的性能不是很好。这`GROUP BY`通常会导致临时表。

回到你的例子：

> ...AND ((id = '25' AND id = '566') OR (id = '156' AND id = '166') OR (id = '7345'))

这永远不可能是真的。子句中的条件一次`WHERE`适用于*一行*。该`id`列在给定行上永远不能有两个值。我从概念上理解您打算测试什么，但这不是 SQL 的工作方式。

当您需要编写涉及多行上出现的值的条件时，另一种解决方案是使用**self-join**。

```
SELECT *
FROM ArticleKeywords k1
 LEFT OUTER JOIN ArticleKeywords k2 ON (k1.article_id = k2.article_id)
WHERE k1.keyword_id = '7345'
 OR (k1.keyword_id = '25' AND k2.keyword_id = '566')
 OR (k1.keyword_id = '156' AND k2.keyword_id = '166'); 
```

大多数人会称其为`k1`“`k2`表别名”。但是，如果您将这些别名视为指向表中的各个行，那么如何使用自联接编写条件就会变得更加清晰。

当然，如果您需要测试一小组三个值而不是两个值，则需要进行另一个自联接。

该解决方案可能无法有效地使用索引，但不会产生该`GROUP BY`解决方案所做的临时表。尝试这两种解决方案，用于[`EXPLAIN`](http://dev.mysql.com/doc/refman/5.1/en/explain.html)分析它们，然后测量它们的性能以进行比较。

# c# - ArcMap 和 BackgroundWorkerThread

> ID：845256
> 
> 赞同：0
> 
> 时间：2009-05-10T12:35:21.527
> 
> 标签：c#, multithreading, com, arcgis

我在这里读到我应该在 ArcMap 中工作时坚持使用 STA 线程。我使用的是普通`BackgroudnWorker`的，我的代码运行得很慢。我正在尝试更改它，以便工作人员在内部创建一个 STA 线程并让它在“重”的东西上运行。

我现在的问题是，在第二个线程完成工作后，我所有的 com 对象都被释放了。我检查了我是否有某种 marshal.RelaseComObject 或 Shutdown 调用，但我不认为是这种情况。难道是我只是因为检索那些 com 对象的线程已经运行完毕，对象正在被自动释放？

这是我的代码示例：

```
 private void bckgrndWrkrController_DoWork(object sender, DoWorkEventArgs e)
    {
        BackgroundWorker worker = sender as BackgroundWorker;
        if (worker != null)
        {
            controller.BackgroundWorker = worker;
            Thread thread = new Thread(STAProcessSelection);
            thread.SetApartmentState(ApartmentState.STA);
            thread.Start(e.Argument);
            thread.Join();
            e.Result = processingResult;
            e.Cancel = worker.CancellationPending;
        }
    }

    private void STAProcessSelection(object argument)
    {
        ISelection selection = argument as ISelection;
        if (selection != null)
        {
            processingResult = controller.ProcessSelection(selection);
        }
    }

    private void bckgrndWrkrController_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)
    {
        if (e.Error != null)
        {
            MessageBox.Show(e.Error.Message, "Error", MessageBoxButtons.OK, MessageBoxIcon.Error);
        }
        else if (e.Result is bool)
        {
            // Making sure the thread was not cancelled after we got the result
            processingResult = (bool)e.Result && !worker.CancellationPending;
            if (processingResult)
            {
                // Set the datasource of the grid
                bindingSource.DataSource = controller.List;
            }
        }

        // and inform the command we are done
        OnDoneProcessing(EventArgs.Empty);
    } 
```

在第 22 行，在 ProcessSelection 调用之后，controller.List[0] 包含一个有效的 com 对象。在第 11 行，在 thread.Join 调用之后，controller.List[0] 元素已经包含一个已发布的 com 对象。我在这里做错了什么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-01T06:10:18.560

我读过单线程公寓（STA）里面只允许有一个线程（我不认为这很明显......）。因此，即使我的主线程是 STA，并且我创建了另一个 STA 线程，它们也位于不同的隔间。
当我的第二个线程完成他的工作并且上帝处置时，该公寓内调用 COM 对象的代码无法执行（没有线程可以编组调用。甚至可能不再有 COM 对象了？）

无论如何，我仍然不知道如何在 ArcMAP 中有效地使用 BackgroundWorker。但我认为这解释了为什么这次尝试失败了。

# c# - NHibernate 2.0：IDictionary 的 Cfg.Configuration.SetProperties 问题

> ID：845258
> 
> 赞同：0
> 
> 时间：2009-05-10T12:35:43.447
> 
> 标签：c#, nhibernate, configuration, idictionary

我有一个问题：

```
NHibernate.Cfg.Configuration.SetProperties() 
```

不接受 IDictionary：NHibernateConfigHandler

我收到以下消息：

错误 30 'NHibernate.Cfg.Configuration.SetProperties(System.Collections.Generic.IDictionary)' 的最佳重载方法匹配有一些无效参数

和

错误 31 参数“1”：无法从“System.Collections.IDictionary”转换为“System.Collections.Generic.IDictionary”

请指教？

* * *

整个方法：

```
/// <param name="config">NHibernate configuration</param>
public ISessionFactory GetSessionFactoryFor(NHibernateConfigHandler config)
{
if (config == null)
    throw new ArgumentNullException("config may not be null nor empty");

ISessionFactory sessionFactory = GetSessionFactoryFor(config.MappingAssembly);

//  Failed to find a cached SessionFactory so make a new one.
if (sessionFactory == null)
{
    NHibernate.Cfg.Configuration cfg = new NHibernate.Cfg.Configuration();

    cfg.SetProperties(config.Properties); //THIS LINE

    cfg.AddAssembly(config.MappingAssembly);

    //  Now that we have our Configuration object, create a new SessionFactory
    sessionFactory = cfg.BuildSessionFactory();

    if (sessionFactory == null)
    {
        throw new InvalidOperationException("cfg.BuildSessionFactory() returned null.");
    }

    HttpRuntime.Cache.Add(config.MappingAssembly, sessionFactory, null, DateTime.Now.AddDays(7),
        TimeSpan.Zero, CacheItemPriority.High, null);
}

return sessionFactory; 
```

}

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T14:29:16.313

SetProperties 的签名是

```
public NHibernate.Cfg.Configuration SetProperties(System.Collections.Generic.IDictionary<string,string> newProperties)
    Member of NHibernate.Cfg.Configuration 
```

Setproperties 采用IDictionary 类型的参数，即通用字典。而你试图传入 IDictionary。这就是错误的原因。

您可以将 NHibernateConfigHandler 中的属性类型更改为 System.Collections.Generic.IDictionary。或创建 System.Collections.Generic.IDictionary 并从 System.Collections.IDictionary 复制所有值。

使用通用字典（在 System.Collections.Generic 上）而不是 IDictionary（在 System.Collections 上）总是很有效。

# .net - 在 .NET 中构建 DSL 的工具

> ID：845265
> 
> 赞同：2
> 
> 时间：2009-05-10T12:40:59.520
> 
> 标签：.net, parsing, dsl, dsl-tools

我越来越喜欢开发 DSL。我使用 fslex 和 fsyacc 开发了一个带有 F# 的小程序，但错误消息不准确（我也找不到生成更好的方法，似乎没有关于如何处理错误案例的文档）以及事实他们不会充分解析 UNICODE 字符串对我来说是不可接受的。长话短说，我正在寻找可以让开发 DSL 变得非常简单的工具（Visual Studio 工具与我所追求的完全不同），我对解析/AST 生成部分最感兴趣。我看过 ANTLR 并且混合代码和语法定义元语言对我来说看起来很糟糕，所以请不要提及它或在答案中遇到类似问题的解决方案。还有，我在那里见过' s 一些名为 Boo 的语言的东西，但我现在真的对搞乱另一种语言（特别是如果它几乎没有支持的话）不感兴趣，所以这也不适合。任何其他建议都值得赞赏，只要它有良好的文档记录，可以在 .NET 中正常工作，最后但并非最不重要的是不涉及使用动态类型语言或使用 DLR。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T21:33:00.377

您想开始与奥斯陆合作。它包括定义 DSL 的工具和定义 DSL 上的语法的工具。语法可以发出 AST 或其他任何东西。

它可以从 DSL 生成的一种输出是对应的 SQL Server 模式。因此，DSL 的实例可以存储在 SQL Server Express（或更高版本）中。

Oslo 是 Microsoft 拥有的更大愿景的一部分，但您可以忽略这一点，直接从“DSL”部分开始。

我建议您开始并积极让 Microsoft 知道您喜欢和不喜欢它的哪些方面。不管你是否知道，你现在已经引起了他们的注意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T16:26:57.780

您可能仍想查看 Boo 的源代码以了解它们是如何工作的。他们还使用 ANTLR 来生成解析器。您不需要将任何代码与 ANTLR 语法混合在一起——只要它是 LL(*) 语言，它就可以作为完全描述性的有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T16:18:05.703

也许你可以试试[奥斯陆](http://www.microsoft.com/NET/Oslo.aspx)。我个人还没有使用它，但是这些例子看起来很有趣。

> “Oslo”包括： 帮助人们以丰富和可视化的方式定义模型并与之交互的工具 帮助人们创建和使用文本域特定语言和数据模型的语言 使模型可用于工具和平台的关系存储库成分

[这](http://www.hanselman.com/blog/MixGettingMyHeadAroundOsloMAndMGrammar.aspx)是一个一般概述！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-10-26T16:33:52.123

Irony - 位于[Irony@CodePlex](http://irony.codeplex.com/)对您来说可能是一个很好的解决方案 - 您可以利用 .NET 语言的内置功能构建您的语法，而不是尝试单独构建[BNF](http://en.wikipedia.org/wiki/Backus%E2%80%93Naur_Form)语法文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-11T14:30:10.593

用几乎简单的英语创建 DSL 的最简单方法： [为 Java 或 C# 创建自己的 DSL（第 4 部分）：添加语义层](http://reboltutorial.com/blog/create-your-own-dsl-for-java-or-c-part-4-adding-a-semantic-layer/)

# c# - Windows Media Player (11+) C# 插件

> ID：845266
> 
> 赞同：2
> 
> 时间：2009-05-10T12:41:06.430
> 
> 标签：c#, wmp

是否可以在 C# 中创建 WMP11+（当然，版本越多越好，但我现在只针对 Vista 以后的版本）插件？我发现的所有资源都显示它适用于 C++，但不适用于 C#。

我正在尝试创建一个与 Last.FM/'Now Playing' 插件（即“背景”类插件）的行与 WMP 交互的插件，因为它位于后台并执行操作，而不是想要访问 WMP 数据的通用应用程序。Windows SDK 中的 WMP Managed 示例仅显示了从单独的应用程序与 WMP 库/“控件”交互的示例。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-16T10:22:03.200

可能不是您要查找的内容，但您可以查看该项目的代码： [http ://wmppluginsnet.codeplex.com/](http://wmppluginsnet.codeplex.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T12:01:01.023

您链接到的同一位作者[Ianier Munoz](http://www.chronotron.com)也发表了一篇关于编写 Windows Media Player 插件的[C# 文章](http://www.microsoft.com/belux/msdn/fr/community/columns/munoz/extendwmp_part1.mspx)（已[损坏的旧链接）。](http://www.microsoft.com/belux/msdn/nl/community/columns/munoz/wmpphaser.mspx)您可能可以从中使用一些东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T13:53:46.010

我对 WMP 的插件架构不是很熟悉，但只要该机制是基于 COM 的，那么是的，您可以编写 C# 插件。COM 是一种公开 API 的语言中立方法。在 C# 和大多数其他 .Net 语言中，可以创建 COM 组件并因此插入 COM 架构。

随之而来的是一些问题。在 2.0SP1 之前，只能在一个进程中创建单个版本的 CLR。插件架构的效果是第一个 .Net 插件将为进程设置 CLR 版本。因此，例如，如果您的插件是基于 1.0 的并且它首先加载没有问题。但是任何想要在 2.0 CLR 中运行的后续插件都不走运。

您可以发布一些指向您正在谈论的示例的链接吗？

# c# - 强制调整 ListView 内的 GridView 列的大小

> ID：845269
> 
> 赞同：17
> 
> 时间：2009-05-10T12:45:09.957
> 
> 标签：c#, .net, wpf, listview

我有一个`ListView`带有`GridView`. 当列的内容发生变化时，我想调整`GridView`列的大小。

我有几个不同的数据集，但是当我从一个更改到另一个时，每列的大小都适合以前的数据。我想动态更新。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-06-17T15:07:38.247

最后，关于这个的一些结果。我找到了一种方法来执行与最初和双击列标题上的抓手时相同的自动调整大小。

```
public void AutoSizeColumns()
{
    GridView gv = listView1.View as GridView;
    if (gv != null)
    {
        foreach (var c in gv.Columns)
        {
            // Code below was found in GridViewColumnHeader.OnGripperDoubleClicked() event handler (using Reflector)
            // i.e. it is the same code that is executed when the gripper is double clicked
            if (double.IsNaN(c.Width))
            {
                c.Width = c.ActualWidth;
            }
            c.Width = double.NaN;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-11-12T10:25:33.230

基于 Oskars 的回答，这是一种在内容更改时自动调整列大小的混合行为。

```
 /// <summary>
 /// A <see cref="Behavior{T}"/> implementation which will automatically resize the automatic columns of a <see cref="ListView">ListViews</see> <see cref="GridView"/> to the new content.
 /// </summary>
 public class GridViewColumnResizeBehaviour : Behavior<ListView>
 {
      /// <summary>
      /// Listens for when the <see cref="ItemsControl.Items"/> collection changes.
      /// </summary>
      protected override void OnAttached()
      {
          base.OnAttached();

          var listView = AssociatedObject;
          if (listView == null)
              return;

          AddHandler(listView.Items);
      }

      private void AddHandler(INotifyCollectionChanged sourceCollection)
      {
          Contract.Requires(sourceCollection != null);

          sourceCollection.CollectionChanged += OnListViewItemsCollectionChanged;
      }

      private void RemoveHandler(INotifyCollectionChanged sourceCollection)
      {
          Contract.Requires(sourceCollection != null);

          sourceCollection.CollectionChanged -= OnListViewItemsCollectionChanged;
      }

      private void OnListViewItemsCollectionChanged(object sender, NotifyCollectionChangedEventArgs notifyCollectionChangedEventArgs)
      {
          var listView = AssociatedObject;
          if (listView == null)
              return;

          var gridView = listView.View as GridView;
          if (gridView == null)
              return;

          // If the column is automatically sized, change the column width to re-apply automatic width
          foreach (var column in gridView.Columns.Where(column => Double.IsNaN(column.Width)))
          {
               Contract.Assume(column != null);
               column.Width = column.ActualWidth;
               column.Width = Double.NaN;
          }
      }

      /// <summary>
      /// Stops listening for when the <see cref="ItemsControl.Items"/> collection changes.
      /// </summary>
      protected override void OnDetaching()
      {
          var listView = AssociatedObject;
          if (listView != null)
              RemoveHandler(listView.Items);

          base.OnDetaching();
      }
 } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-29T14:32:43.793

有没有办法绑定到`ActualWidth`列的？就像是 ：

```
<GridViewColumn x:Name="column1" Width="{Binding ElementName=column1, Path=ActualWidth}" /> 
```

我已经尝试过了，它似乎只在第一次工作。没有绑定错误。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-06-15T22:09:17.953

如果你像我一样年纪大了并且更喜欢 VB.NET，那么这里是 Oskars 代码：

```
Public Sub AutoSizeColumns()
    Dim gv As GridView = TryCast(Me.listview1.View, GridView)
    If gv IsNot Nothing Then
        For Each c As GridViewColumn In gv.Columns
            If Double.IsNaN(c.Width) Then
                c.Width = c.ActualWidth
            End If
            c.Width = Double.NaN
        Next
    End If
End Sub 
```

这在 WPF 中效果很好，终于有人解决了这个问题。谢谢奥斯卡。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-10T12:57:59.780

您可以以像素为单位测量最长的字符串，然后相应地调整列宽：

```
Graphics graphics = this.CreateGraphics();
SizeF textSize = graphics.MeasureString("How long am I?", this.Font); 
```

如果您创建一个算法，将每列的大小设置为这些长度的比率，您应该会得到一个很好的结果。

# sql-server-2005 - sql 2005 和 2008 之间的已知和“未知”不兼容性？

> ID：845271
> 
> 赞同：1
> 
> 时间：2009-05-10T12:46:21.693
> 
> 标签：sql-server-2005, sql-server-2008, migration, compatibility

像往常一样，我们希望将我们的应用程序迁移到最新的 sql 版本不会有任何问题......

但...

但...

但...

好吧，只是为了做好准备，有人偶然发现了一些令人讨厌的不兼容问题吗？

（例如，我记得从 2000 年迁移到 2005 年之后，我们不得不连接到 sql 6.5 服务器的一个链接服务器停止工作）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T12:59:40.487

[msdn](http://msdn.microsoft.com/en-us/library/ms143729.aspx)已弃用功能列表非常全面。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-07-08T15:52:17.967

MSDN 文章 SQL Server 2008 的[向后兼容性](http://msdn.microsoft.com/en-us/library/cc280407.aspx)涵盖了所有主要组件。

# python - 如何以统一的差异格式打印两个多行字符串的比较？

> ID：845276
> 
> 赞同：20
> 
> 时间：2009-05-10T12:51:12.660
> 
> 标签：python, diff, unified-diff

你知道有什么图书馆可以帮助你做到这一点吗？

我会编写一个函数，以统一的差异格式打印两个多行字符串之间的差异。像这样的东西：

```
def print_differences(string1, string2):
    """
    Prints the comparison of string1 to string2 as unified diff format.
    """
    ??? 
```

一个使用示例如下：

```
string1="""
Usage: trash-empty [days]

Purge trashed files.

Options:
  --version   show program's version number and exit
  -h, --help  show this help message and exit
"""

string2="""
Usage: trash-empty [days]

Empty the trash can.

Options:
  --version   show program's version number and exit
  -h, --help  show this help message and exit

Report bugs to http://code.google.com/p/trash-cli/issues
"""

print_differences(string1, string2) 
```

这应该打印出类似的内容：

```
--- string1 
+++ string2 
@@ -1,6 +1,6 @@
 Usage: trash-empty [days]

-Purge trashed files.
+Empty the trash can.

 Options:
   --version   show program's version number and exit 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-05-10T14:25:22.553

我就是这样解决的：

```
def _unidiff_output(expected, actual):
    """
    Helper function. Returns a string containing the unified diff of two multiline strings.
    """

    import difflib
    expected=expected.splitlines(1)
    actual=actual.splitlines(1)

    diff=difflib.unified_diff(expected, actual)

    return ''.join(diff) 
```

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-05-10T12:54:51.893

你看过内置的 python 模块[difflib](http://docs.python.org/library/difflib.html)吗？看看这个[例子](http://docs.python.org/library/difflib.html#differ-example)

# iphone - 用颜色覆盖 UIImage？

> ID：845278
> 
> 赞同：17
> 
> 时间：2009-05-10T12:52:41.917
> 
> 标签：iphone, uiimage

我试图在一些当前的 UIImage（它们是白色的）上添加一个黑色叠加层。我一直在尝试使用以下代码：

```
[[UIColor blackColor] set];
[image drawAtPoint:CGPointMake(0, 0) blendMode:kCGBlendModeOverlay alpha:1.0]; 
```

但它不起作用，我很确定 set 不应该在那里。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2014-05-08T12:00:05.820

因此，将所有答案总结为一个，这里的插入式方法可以完美地适用于`iOS 6`各种`iOS 11`图像和图标：

```
+ (UIImage *)filledImageFrom:(UIImage *)source withColor:(UIColor *)color{

    // begin a new image context, to draw our colored image onto with the right scale
    UIGraphicsBeginImageContextWithOptions(source.size, NO, [UIScreen mainScreen].scale);

    // get a reference to that context we created
    CGContextRef context = UIGraphicsGetCurrentContext();

    // set the fill color
    [color setFill];

    // translate/flip the graphics context (for transforming from CG* coords to UI* coords
    CGContextTranslateCTM(context, 0, source.size.height);
    CGContextScaleCTM(context, 1.0, -1.0);

    CGContextSetBlendMode(context, kCGBlendModeColorBurn);
    CGRect rect = CGRectMake(0, 0, source.size.width, source.size.height);
    CGContextDrawImage(context, rect, source.CGImage);

    CGContextSetBlendMode(context, kCGBlendModeSourceIn);
    CGContextAddRect(context, rect);
    CGContextDrawPath(context,kCGPathFill);

    // generate a new UIImage from the graphics context we drew onto
    UIImage *coloredImg = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    //return the color-burned image
    return coloredImg;
} 
```

**更新：** Swift 3 版本

```
func filledImage(source: UIImage, fillColor: UIColor) -> UIImage {

    UIGraphicsBeginImageContextWithOptions(source.size, false, UIScreen.main.scale)

    let context = UIGraphicsGetCurrentContext()
    fillColor.setFill()

    context!.translateBy(x: 0, y: source.size.height)
    context!.scaleBy(x: 1.0, y: -1.0)

    context!.setBlendMode(CGBlendMode.colorBurn)
    let rect = CGRect(x: 0, y: 0, width: source.size.width, height: source.size.height)
    context!.draw(source.cgImage!, in: rect)

    context!.setBlendMode(CGBlendMode.sourceIn)
    context!.addRect(rect)
    context!.drawPath(using: CGPathDrawingMode.fill)

    let coloredImg : UIImage = UIGraphicsGetImageFromCurrentImageContext()!
    UIGraphicsEndImageContext()

    return coloredImg
} 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-05-11T03:37:33.933

您需要将上下文剪辑到图像蒙版，然后用纯色填充：

```
- (void)drawRect:(CGRect)rect
{
    CGRect bounds = [self bounds];
    [[UIColor blackColor] set];
    CGContextRef context = UIGraphicsGetCurrentContext();
    CGContextClipToMask(context, bounds, [myImage CGImage]);
    CGContextFillRect(context, bounds);
} 
```

注意：`myImage`应该是一个包含`UIImage`. 我不确定它是从 alpha 通道中获取蒙版还是从强度中获取蒙版，所以两者都试试。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-09-27T17:40:28.850

我刚刚写了一个教程来帮助解决这个问题。我的方法为您提供了 UIImage 的副本，其中包含您想要的颜色更改。rpetrich 的方法很棒，但要求您创建一个子类。我的方法只是几行代码，可以在任何你需要的地方放置。[http://coffeeshopped.com/2010/09/iphone-how-to-dynamically-color-a-uiimage](http://coffeeshopped.com/2010/09/iphone-how-to-dynamically-color-a-uiimage)

```
NSString *name = @"badge.png";
UIImage *img = [UIImage imageNamed:name];

// begin a new image context, to draw our colored image onto
UIGraphicsBeginImageContext(img.size);

// get a reference to that context we created
CGContextRef context = UIGraphicsGetCurrentContext();

// set the fill color
[color setFill];

// translate/flip the graphics context (for transforming from CG* coords to UI* coords
CGContextTranslateCTM(context, 0, img.size.height);
CGContextScaleCTM(context, 1.0, -1.0);

// set the blend mode to color burn, and the original image
CGContextSetBlendMode(context, kCGBlendModeColorBurn);
CGRect rect = CGRectMake(0, 0, img.size.width, img.size.height);
CGContextDrawImage(context, rect, img.CGImage);

// set a mask that matches the shape of the image, then draw (color burn) a colored rectangle
CGContextClipToMask(context, rect, img.CGImage);
CGContextAddRect(context, rect);
CGContextDrawPath(context,kCGPathFill);

// generate a new UIImage from the graphics context we drew onto
UIImage *coloredImg = UIGraphicsGetImageFromCurrentImageContext();
UIGraphicsEndImageContext();

//return the color-burned image
return coloredImg; 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-05-16T13:57:06.713

看看这个方法

```
 + (UIImage *)imageWithColor:(UIColor *)color andSize:(CGSize)size;
    {
      UIImage *img = nil;

      CGRect rect = CGRectMake(0, 0, size.width, size.height);
      UIGraphicsBeginImageContext(rect.size);
      CGContextRef context = UIGraphicsGetCurrentContext();
      CGContextSetFillColorWithColor(context,
                                     color.CGColor);
      CGContextFillRect(context, rect);
      img = UIGraphicsGetImageFromCurrentImageContext();

      UIGraphicsEndImageContext();

      return img;
    } 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2014-07-05T20:42:40.250

从 iOS 7 开始，有一个更简单的解决方案：

```
UIImage* im = [UIImage imageNamed:@"blah"];
im = [im imageWithRenderingMode:UIImageRenderingModeAlwaysTemplate];
[[UIColor blackColor] setFill];
[im drawInRect:rect]; 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-07-21T23:26:34.673

除了 rpetrich 的解决方案（顺便说一句很棒 - 帮助我极好），您还可以将 CGContextClipToMask 行替换为：

```
 CGContextSetBlendMode(context, kCGBlendModeSourceIn); //this is the main bit! 
```

正是 SourceIn blendmode 完成了通过 GetCurrentContext 中的任何内容来掩盖颜色的工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-12-05T02:55:36.810

以下是使用**Swift 3.0**和使用 UIImage 扩展的方法。超级简单。

```
public extension UIImage {
    func filledImage(fillColor: UIColor) -> UIImage {
        UIGraphicsBeginImageContextWithOptions(self.size, false, UIScreen.main.scale)

        let context = UIGraphicsGetCurrentContext()!
        fillColor.setFill()

        context.translateBy(x: 0, y: self.size.height)
        context.scaleBy(x: 1.0, y: -1.0)

        context.setBlendMode(CGBlendMode.colorBurn)

        let rect = CGRect(x: 0, y: 0, width: self.size.width, height: self.size.height)
        context.draw(self.cgImage!, in: rect)

        context.setBlendMode(CGBlendMode.sourceIn)
        context.addRect(rect)
        context.drawPath(using: CGPathDrawingMode.fill)

        let coloredImg : UIImage = UIGraphicsGetImageFromCurrentImageContext()!
        UIGraphicsEndImageContext()

        return coloredImg
    }
} 
```

然后运行它只需执行以下操作：

```
let image = UIImage(named: "image_name").filledImage(fillColor: UIColor.red) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-03-22T22:41:04.743

您可以通过以下方式在**Swift 4.x**中以编程方式执行此操作：

```
imageView.image = UIImage(named: "imageName")?.withRenderingMode(.alwaysTemplate)
imageView.tintColor = .purple 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-05-10T13:21:57.703

`-set`用于设置不包括 blits 的后续绘图操作的颜色。我建议作为第一个电话，`UIView`在您的上方显示另一个（空）`UIImageView`并设置其背景颜色：

```
myView.backgroundColor = [UIColor colorWithWhite:0.0 alpha:0.5]; 
```

显然你应该使用你想要的白色和阿尔法值。

# wpf - 如何在 WPF 中将字符串绑定为双精度值？

> ID：845281
> 
> 赞同：2
> 
> 时间：2009-05-10T12:54:01.250
> 
> 标签：wpf, binding

我想设置一个绑定。问题是目标是字符串类型，但源是双精度类型。在下面的代码中，VersionNumber 是 double 类型。当我运行它时，文本块是空的，没有抛出任何异常。如何设置此绑定？

```
<Style TargetType="{x:Type MyControl}">
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type MyControl}">
                <TextBlock Text="{TemplateBinding Property=VersionNumber}" />
            </ControlTemplate>
        </Setter.Value>
    </Setter>        
</Style> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-10T12:57:21.667

你需要一个转换器：

```
namespace Jahedsoft
{
    [ValueConversion(typeof(object), typeof(string))]
    public class StringConverter : IValueConverter
    {
        public object Convert(object value, Type targetType, object parameter, CultureInfo culture)
        {
            return value == null ? null : value.ToString();
        }

        public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
        {
            throw new NotImplementedException();
        }
    }
} 
```

现在你可以像这样使用它：

```
<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:j="clr-namespace:Jahedsoft">

    <j:StringConverter x:Key="StringConverter" />
</ResourceDictionary>

...

<Style TargetType="{x:Type MyControl}">
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type MyControl}">
                <TextBlock Text="{TemplateBinding Property=VersionNumber, Converter={StaticResource StringConverter}}" />
            </ControlTemplate>
        </Setter.Value>
    </Setter>        
</Style> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-08-30T12:47:09.460

示例中存在细微差别。

如果您直接在 Window 或其他控件中使用 Texblock，则将 double 绑定到 Text 属性可以正常工作，因为它默认返回 ToString() 方法，但是如果您尝试在 ControlTemplate 中使用它，这将不起作用。

然后你需要一个转换器，就像帖子中建议的那样。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-10T13:17:11.187

您不需要 ValueConverter。Double to String 目标工作得很好。通常，Binding 将调用 ToString() 作为最后的手段。

这是一个例子：

```
<Window x:Class="WpfApplication1.Window1"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        x:Name="w1">
        <TextBlock Text="{Binding Path=Version, ElementName=w1}" />
</Window>
using System;
using System.Windows;
namespace WpfApplication1
{
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
        }
        public double Version { get { return 2.221; } }
    }
} 
```

问题可能是您的 Binding 源不是您认为的那样。作为规则，WPF 中的绑定失败不会引发异常。然而，他们确实记录了他们的失败。请参阅[如何调试 WPF 绑定？](https://web.archive.org/web/20120120010534/http://www.beacosta.com/blog/?p=52)

# vim - Vim 中的悬挂运算符

> ID：845286
> 
> 赞同：3
> 
> 时间：2009-05-10T12:55:11.643
> 
> 标签：vim

在 Vim 中使用制表符缩进时，有没有办法让运算符挂起？例如，如果我有代码：

```
class some_class
{
<tab>some_class();
<tab>~some_class();
}; 
```

我希望它看起来像这样：

```
class some_class
{
        some_class();
       ~some_class();
}; 
```

问题是关于空白的**外观**，而不是它的组成。所以，缩写和缩进规则是行不通的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T14:05:52.533

我想他是在问如果`~`vim 可以检测到它是一个运算符，是否将向后移动一个空格，从而将 ~ 挂在`some_class()`.

据我所知，答案是可能的，但并不容易。插入模式的缩写总是不完整的，更复杂的解决方案……更复杂。

除非你真的需要这种行为，否则我认为这不值得付出努力。

编辑：

我想我明白你在说什么。在这种情况下，我可以合理肯定地说，您的要求是不可能的。您无法更改 vim 如何显示由制表符缩进的文本，并且恰好以您希望挂在左边距的运算符开头。那根本行不通。Vim 设置为按原样显示文本，您无法在不更改源代码的情况下将其更改为适合印刷风格，我怀疑您是否愿意这样做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T13:53:16.523

我不确定我是否理解“悬挂运算符”的概念，但您似乎想用空格替换制表符。

您可以设置 expandtab 和 tabstop 选项：

```
:set expandtab
:set tabstop=8 
```

这会将您键入的任何新制表符扩展为 8 个空格。

要将选项卡扩展应用于文件中的现有选项卡，请使用 retab 命令：

```
:retab 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T14:23:06.093

似乎您必须为此编写自己的缩进文件，其中的示例位于`$VIMRUNTIME/indent`. 但就像 sykora 所说，这可能不值得付出努力。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T14:39:33.813

我认为您想要的称为“自动缩进”。请参阅：帮助 ai

```
'autoindent' 'ai'   boolean (default off)
            local to buffer
    Copy indent from current line when starting a new line (typing <CR>
    in Insert mode or when using the "o" or "O" command).  If you do not
    type anything on the new line except <BS> or CTRL-D and then type
    <Esc>, CTRL-O or <CR>, the indent is deleted again.  Moving the cursor
    to another line has the same effect, unless the 'I' flag is included
    in 'cpoptions'.
    When autoindent is on, formatting (with the "gq" command or when you
    reach 'textwidth' in Insert mode) uses the indentation of the first
    line.
    When 'smartindent' or 'cindent' is on the indent is changed in
    a different way.
    The 'autoindent' option is reset when the 'paste' option is set.
    {small difference from Vi: After the indent is deleted when typing
    <Esc> or <CR>, the cursor position when moving up or down is after the
    deleted indent; Vi puts the cursor somewhere in the deleted indent}. 
```

# ruby-on-rails - 未初始化的常量错误，同时使用 JSON 和 Facebook 与 rails 连接

> ID：845297
> 
> 赞同：0
> 
> 时间：2009-05-10T13:01:49.510
> 
> 标签：ruby-on-rails, json

我在这里学习教程 [http://applicake.com/posts/54-integrating-facebook-connect-with-rails-applications](http://applicake.com/posts/54-integrating-facebook-connect-with-rails-applications)

设置 facebook 连接。它几乎可以工作，除了最后一步:-(尽管安装了 JSON 插件，但我收到了 JSON 错误。

我做了 gem install json

我该如何解决这个问题？

视图中的错误：未初始化的常量 SessionsController::JSON

控制台上的错误：NameError（未初始化的常量 SessionsController::JSON）：

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-10T13:09:56.427

只是为了确保您需要 JSON 插件，对吗？

```
require 'json/add/rails' 
```

# jquery - 使用 jquery 的单个事件的多个控件

> ID：845305
> 
> 赞同：2
> 
> 时间：2009-05-10T13:07:56.720
> 
> 标签：jquery

我试图在这里减少一些代码。我将解释如何

我有多个按钮控件。我正在使用每个点击事件

```
$("#B1").click(function() {
                var v1 = "abc";
            });

 $("#B2").click(function() {
                var v1 = "efg";
            });

 $("#B3").click(function() {
                var v1 = "xyz";
            }); 
```

我想删除这 3 次点击事件并编写一个单击事件。如果点击来自

B1 那么 v1 应该是“abc”；B2 那么 v1 应该是“efg”；B3 那么 v1 应该是“xyz”

如何以最好的方式编写代码

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-10T13:15:20.497

将值存储在“哈希”中，然后通过 id 从处理程序中引用它们。

```
var vals = { "B1": "abc", "B2" : "efg", "B3" : "xyz" };

$('[id^="B"]').click( function() {
     var v1 = vals[this.id];
     ...      
}); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-10T16:30:55.500

您还可以使用`data`链接的属性，然后在点击事件中获取它。

```
$('#B1').data('myKey', 'abc');
$('#B2').data('myKey', 'efg');
$('#B3').data('myKey', 'xyz');
$('.buttons').click(function() {
   var v1 = $(this).data('myKey');
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T15:06:08.690

如果您有一个更通用的名称列表，您可以使用“每个”，它只是循环通过您的数组。

```
var vals = { "B1": "abc", "B2" : "efg", "B3" : "xyz" };

jQuery.each(vals, function(i, val) {
    $("#" + i).click(function(){
        var v1 = val;
    });
}); 
```

正如 tvanfosson 提到的，有很多方法可以做到这一点。您可能不想折射点击事件。您更有可能需要将 click 事件内部的代码重构为更通用的函数。制作您自己的函数，该函数接受 ID 和 val 并对它们进行操作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-02T06:38:37.300

您可以在控件中添加`data`属性。`data-customAttr="true"`然后像这样处理事件，

```
$('[data-customAttr^="true"]').click( function() {
 var v1 = vals[this.id];
}); 
```

使用`data-`属性是标准的，所有这些属性都可以通过 jquery 的`.data()`函数来访问。

# php - CSS & Javascript 汇总文件

> ID：845308
> 
> 赞同：1
> 
> 时间：2009-05-10T13:11:35.650
> 
> 标签：php, javascript, css, zend-framework, rollup

如果您使用他们的 CDN，Yahoo 用户界面库会提供汇总支持。我正在使用 Zend Framework 1.8.0 并且想知道他最好的方法来复制它，以便我们所有的 css 或 javascript 文件都可以汇总到一个标签中 - 因此是一个 http 请求。

我正在使用带有 .htaccess 文件的标准 MVC 组件，该文件通过 index.php 重写所有内容，除非文件或文件夹物理存在或映射到服务器上。

我想让最终的汇总文件缓存客户端（如果客户端支持它）以提高效率并进一步减少 http 请求。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T13:45:01.463

希望我正确理解了您的问题。

这里有几个工作 - 一个是将请求变量中的几个文件的内容连接到一个响应中，然后另一个是缓存过程的管理。

第一个应该相当简单，获取路径列表并将内容添加到内存中的文件中，第二个可以通过这个[伟大的助手](http://www.noginn.com/2009/03/08/sending-files-with-the-zend-framework/)轻松管理，它允许您轻松设置修改/过期标头以允许客户端缓存

# c# - 在没有 Session ViewState 或其他的情况下传输数据（在 List generic 中）。如何？

> ID：845312
> 
> 赞同：0
> 
> 时间：2009-05-10T13:14:20.133
> 
> 标签：c#, .net, asp.net

我有 3 个数组 X、Y、风险。我添加了一个通用列表（listtraining）。如果我单击按钮运行我的代码。但我不想使用 Session 来传输数据。在winforms中我不需要会话。梅利斯特会在他的记忆中收集数据吗？

```
 public partial class _Default : System.Web.UI.Page
    {
        double[] X;
        double[] Y;
        string[] Risk;
        List<KNNAlgorithms.TrainigSet> listtraining;
        protected void Page_Load(object sender, EventArgs e)
        {
            listtraining = new List<KNNAlgorithms.TrainigSet>();
            if (!IsPostBack)
            {

                X = new double[] { 0.08, 0.07, 0.20, 1.00, 0.05, 0.20, 0.17, 0.15, 0.50, 0.10 };
                Y = new double[] { 0.20, 0.07, 0.09, 0.20, 0.06, 0.25, 0.07, 0.55, 0.08, 0.06 };
                Risk = new string[] { "erkek", "erkek", "erkek", "kadın", "erkek", "erkek", "erkek", "kadın", "erkek", "kadın" };

                for (int i = 0; i < X.Length; i++)
                {
                    KNNAlgorithms.TrainigSet tr = new KNNAlgorithms.TrainigSet();

                    tr.X = X[i];
                    tr.Y = Y[i];
                    tr.Risk = Risk[i];
                    listtraining.Add(tr);
                }
                Session.Add("listtraining", listtraining);
                for (int i = 0; i < listtraining.Count; i++)
                {
                    ListBox1.Items.Add(listtraining[i].X.ToString());
                    ListBox2.Items.Add(listtraining[i].Y.ToString());
                    ListBox3.Items.Add(listtraining[i].Risk.ToString());
                }
            }
        }

        protected void btnHesapla_Click(object sender, EventArgs e)
        {
            List<KNNAlgorithms.TrainigSet> listtraining = new List<KNNAlgorithms.TrainigSet>();

            KNNAlgorithms.KNNModel knn = new KNNAlgorithms.KNNModel();
            double x = double.Parse(txtX.Text);
            double y = double.Parse(txtY.Text);
            int k = int.Parse(txtKValue.Text);
            listtraining = (List < KNNAlgorithms.TrainigSet > )Session["listtraining"];
            lblResult.Text = "Üretilen Sonuç:  " + knn.CalculatedDistancesArray(listtraining, x, y, "kadın", "erkek", k);
        }
    }
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T13:28:04.513

列表数据需要在某些地方持久化，您在网络上的选项是会话、视图状态、缓存。存储在任何这些介质中的数据实际上都存储在服务器的内存中。

另一种选择是将数据序列化为 XML 或纯文本 [可能适合您] 并将其作为文件存储在服务器上。这通常不是一个好方法，但是因为您最终会在文件服务器上获得大量文件。

另一种选择是将数据序列化，将其存储在表单上的隐藏输入元素中，然后将其从页面传递到您需要的页面。这对整体编码和处理会有些麻烦。

我仍然会推荐作为会话变量的最佳选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T13:26:59.833

在 ASP.Net 中，回发期间在页面上存储数据可以使用会话变量、视图状态或隐藏字段来完成。

在页面之间传输数据的唯一方法是使用会话对象、查询字符串或 POST 变量。这意味着您需要在会话中传递它或在每次页面加载时重新加载列表。

因此，您的问题的答案是否定的，一旦加载页面，列表将不会存储在内存中。如果需要，我建议您在每次回发时重新加载列表，或者如果您不想使用会话变量，也可以将其存储在视图状态中。但是请记住，使用视图状态会增加返回页面的大小。

# ruby-on-rails - Rails 错误“NoMethodError” - 我的第一个 ruby 应用程序

> ID：845315
> 
> 赞同：4
> 
> 时间：2009-05-10T13:15:24.693
> 
> 标签：ruby-on-rails, ruby

我对 Rails 完全陌生，所以答案可能很简单。开始：

我的页面正在生成此错误

```
任务中的 NoMethodError#new
显示第 3 行引发的 app/views/tasks/new.erb：

未定义的方法 `tasks_path' 用于#

```

这是视图：

```
<% form_for(@task) do |f| %>
    <%= f.error_messages %>

    <%= f.label :description %>:
    <%= f.text_field :description %><br />

    <%= f.label :priority %>:
    <%= collection_select(:news, :priority_id, Priority.find(:all), :id, :description) %><br />

    <%= f.submit "Add Task" %>

<% end %> 
```

控制器：

```
class TasksController < ApplicationController
    def index
        @all_tasks = Task.find(:all, :order => :id)
    end

    def new
        @task = Task.new
    end ...(more) 
```

和模型：

我看不出有什么问题，但就像我说的，到目前为止我一无所知。谢谢！

```
class Task < ActiveRecord::Base
    validates_presence_of :description

    belongs_to :priority
    has_and_belongs_to_many :staff
    has_and_belongs_to_many :catagory

end 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-10T13:27:08.197

你有

```
map.resources :tasks 
```

在您的路线中？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T13:31:19.027

感谢您的回答。

正如预测的那样，简单的问题。

```
<% form_for(@task) do |f| %> 
```

应该：

```
<% form_for(:task) do |f| %> 
```

有趣的是，您总是在发布问题后立即找到问题的答案！再次感谢。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-11T10:25:59.490

关于这段代码：

```
@all_tasks = Task.find(:all, :order => :id) 
```

您不需要按 id 指定 order，因为这是默认行为。所以这应该足够了。

```
@all_tasks = Task.find(:all) 
```

而这可以进一步浓缩为以下

```
@all_tasks = Task.find.all 
```

此外，rails 约定是将实例变量命名为 @tasks

```
@tasks = Task.find.all 
```

享受 Rails 的乐趣。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-01T09:06:56.250

`.html.erb`请在查看中检查您的文件名。它不仅应具有扩展名`.erb`...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-10T13:29:13.923

您是否使用脚手架生成器生成了这个示例？因为如果不是，可能是您忘记在 routes.rb 中定义资源 url 映射：

```
--- a/config/routes.rb
+++ b/config/routes.rb
@@ -1,4 +1,6 @@
 ActionController::Routing::Routes.draw do |map|
+  map.resources :tasks
+ 
```

添加路由后不要忘记重启webrick！

# objective-c - Objective-C 的正则表达式解决方案

> ID：845317
> 
> 赞同：10
> 
> 时间：2009-05-10T13:16:03.947
> 
> 标签：objective-c, regex, cocoa, cocoa-touch

在 Objective-C中使用**正则表达式**的最佳方法是什么？

**似乎有一些提供正则表达式**支持的开源项目，任何人都可以推荐一个吗？

我还看了看`NSPredicate`，任何人都可以建议任何**正则表达式**示例吗？

背景：我想使用正则表达式主要用于验证、IP、电子邮件地址、内部 ID 等

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-10T15:24:36.130

```
NSPredicate *predicate;
predicate = [NSPredicate predicateWithFormat:@"SELF MATCHES '.*@.*\..*'"];
BOOL result = [predicate evaluateWithObject:@"mail@domain.com"]; 
```

根据[谓词指南](http://developer.apple.com/documentation/Cocoa/Conceptual/Predicates/Articles/pSyntax.html#//apple_ref/doc/uid/TP40001795-215868)：

> **匹配**
> 根据 ICU v3，左侧表达式使用正则表达式样式比较等于右侧表达式（有关更多详细信息，请参阅 ICU[正则表达式](http://icu.sourceforge.net/userguide/regexp.html)用户指南）。

甚至可以在指南中找到[Apple 编写的示例。](http://developer.apple.com/documentation/Cocoa/Conceptual/Predicates/Articles/pUsing.html#//apple_ref/doc/uid/TP40001794)

代替`SELF`你也可以使用[key path](http://developer.apple.com/documentation/Cocoa/Conceptual/KeyValueCoding/)。（可能[还有其他一些文字](http://developer.apple.com/documentation/Cocoa/Conceptual/Predicates/Articles/pSyntax.html#//apple_ref/doc/uid/TP40001795-215930)。）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-23T13:49:29.167

请在[http://cocoawithlove.com阅读](http://cocoawithlove.com)[全文](http://cocoawithlove.com/2009/06/verifying-that-string-is-email-address.html)。

> 在 Cocoa 中，NSPredicate 的工作方式与 SQL 的“WHERE”子句非常相似。NSPredicate 被带到 iPhone 的主要原因是 NSPredicate 在 Core Data 中的作用与 SQL 中的“WHERE”子句相同——允许持久存储获取满足特定条件的对象。

```
// given an NSDictionary created used the above method named "row"...
NSPredicate *johnSmithPredicate =
    [NSPredicate predicateWithFormat:@"firstname = 'John' AND lastname = 'Smith'"];
BOOL rowMatchesPredicate = [johnSmithPredicate evaluateWithObject:row]; 
```

**验证电子邮件地址**

> NSPredicate (NSLikePredicateOperatorType) 中的“LIKE”比较运算符通常用作测试 NSString 是否匹配正则表达式的便捷方法。与具有更多选项和替换能力的完整库相比，它的优势在于它已经在 Cocoa 中——没有库、没有链接、没有麻烦。

你可以做一个简单的测试：

```
NSPredicate *regExPredicate =
    [NSPredicate predicateWithFormat:@"SELF MATCHES %@", regularExpressionString];
BOOL myStringMatchesRegEx = [regExPredicate evaluateWithObject:myString]; 
```

> 剩下的唯一问题是：什么是正则表达式，可用于验证 NSString 是否包含语法上有效的电子邮件地址？

```
NSString *emailRegEx =
    @"(?:[a-z0-9!#$%\\&'*+/=?\\^_`{|}~-]+(?:\\.[a-z0-9!#$%\\&'*+/=?\\^_`{|}"
    @"~-]+)*|\"(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21\\x23-\\x5b\\x5d-\\"
    @"x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])*\")@(?:(?:[a-z0-9](?:[a-"
    @"z0-9-]*[a-z0-9])?\\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?|\\[(?:(?:25[0-5"
    @"]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-"
    @"9][0-9]?|[a-z0-9-]*[a-z0-9]:(?:[\\x01-\\x08\\x0b\\x0c\\x0e-\\x1f\\x21"
    @"-\\x5a\\x53-\\x7f]|\\\\[\\x01-\\x09\\x0b\\x0c\\x0e-\\x7f])+)\\])"; 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-10T15:10:12.430

*   桌面：像[Vile 先生](https://stackoverflow.com/questions/845317/regex-solution-for-objective-c/845325#845325)提到的[RegExKit 。](http://regexkit.sourceforge.net/#Latest)
*   iPhone：[RegExKitLite](http://regexkit.sourceforge.net/#RegexKitLite)效果很好。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-05-17T11:52:14.313

尝试从 iOS 4.0 开始提供的官方 NSRegualExpression：

[http://developer.apple.com/library/ios/#documentation/Foundation/Reference/NSRegularExpression_Class/Reference/Reference.html](http://developer.apple.com/library/ios/#documentation/Foundation/Reference/NSRegularExpression_Class/Reference/Reference.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-10T15:23:23.900

试试 CSRegex：[http ://www.cocoadev.com/index.pl?CSRegex](http://www.cocoadev.com/index.pl?CSRegex)

它是一个快速简单的正则表达式类，可以轻松放入任何 Cocoa 项目中。它只包含两个文件，没有外部依赖。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-10T13:18:39.083

试试这个：[http ://regexkit.sourceforge.net/](http://regexkit.sourceforge.net/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-10T19:26:19.867

另一种选择是 Google Toolbox for Mac 中的 libregex 包装器： [http ://code.google.com/p/google-toolbox-for-mac/source/browse/trunk/Foundation/GTMRegex.h](http://code.google.com/p/google-toolbox-for-mac/source/browse/trunk/Foundation/GTMRegex.h)

# sql-server - 加入具有不同排序规则问题的列

> ID：845321
> 
> 赞同：3
> 
> 时间：2009-05-10T13:17:12.090
> 
> 标签：sql-server, collation

我正在使用 SQL Server 2005。我有两个表，它们使用不同的排序规则。不允许连接具有不同排序规则的表中的列，例如以下 SQL 是不允许的，

```
select table1column1 + table2column2 from ... 
```

我的问题是，为什么从数据库引擎设计的角度来看，不允许连接来自不同排序规则的两列？我不知道为什么排序规则会影响结果，结果只是连接字符串 - 应该足够简单并且不依赖于排序规则......

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-04-20T06:08:23.920

可以说`Table1Column1`有`SQL_Latin1_General_CP1_CI_AS`和`Table2Column2`有`Latin1_General_CI_AS`。然后你可以这样做：

```
SELECT Table1Column1 + Table2Column2 COLLATE SQL_Latin1_General_CP1_CI_AS 
```

希望这能解决你的问题:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T14:02:13.970

好的，

我认为答案很简单，设计一个使用 unicode 的系统比 ascii 字符集要困难得多。你要担心的不仅仅是字母；如果你有阿拉伯语和法语，那么当他们以不同的方向阅读时，你如何做字符串 a + 字符串 b（我认为不兼容假名）？

您必须在排序规则中添加一项新工作-强制-我的理解是强制力应该处理不同排序规则中字符串的兼容性。即它应该允许数据库引擎通过具有这样的规则使得Latin1_CI_AS 在某些情况下应该真正与Latin1_CI_AI 兼容。

如果您有 SQL 99 Spec 的副本；阅读排序规则的强制性，它定义了如何在排序规则之间操作字符串。MS 曾尝试在[MSDN](http://msdn.microsoft.com/en-us/library/bb330962.aspx)上对其进行定义，但我不确定它们与标准相比是否已经走得足够远；也许sql2010会更好……就我对这个主题的阅读而言；它也仍然符合 SQL03 标准——我猜是为了前向可计算性。SQL 99的[谷歌书籍条目](http://books.google.com/books?id=q7sJwvqhDG4C&pg=PA707&lpg=PA707&dq=collation+coercibility+sql+99&source=bl&ots=4gfH6J6R3s&sig=al49I9HofwrGYwavDDiHUWKVIiM&hl=en&ei=J9wGSr39DsWNjAfbyrCVCw&sa=X&oi=book_result&ct=result&resnum=1)没有关于强制力的页面，我找不到比 MSDN 解释更好的东西。

# c# - 使用从源代码编译程序集来评估 C# 中的数学方程

> ID：845323
> 
> 赞同：2
> 
> 时间：2009-05-10T13:17:28.487
> 
> 标签：c#, .net, math, parsing, equation

我正在考虑通过在运行时从源代码编译来解析简单的数学方程。我听说在使用这种方法之前我应该​​注意一些安全注意事项，但我找不到任何关于此的信息。

谢谢

C# .net 2.0，winforms

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-10T13:25:14.743

这种方法的问题是用户可以输入他们想要的*任何*代码（除非您对其进行清理）。他们可以输入代码来擦除您的所有文件。如果它在服务器上运行，**请不** 要这样做。此外，即使在台式机上，运行编译器来评估方程也非常慢。[使用ANTLR](http://www.antlr.org/)之类的工具为您的方程制作语法，并将解析器嵌入到您的程序中。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T22:48:53.280

前段时间我偶然发现了一个聪明的方法：利用 JScript 的*eval*函数。您可以创建一个简单的 JScript 类：

```
 class JsMath
  {
    static function Eval(MathExpression : String) : double
    {
      return eval(MathExpression);
    };
  } 
```

像这样编译它：

> jsc /目标：库 JsMath.js

现在您可以只引用 JsMath 库并使用 JsMath.Eval 方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T13:47:53.073

编译是一种相对安全的操作。似乎只有在编译器中存在可利用的缓冲区溢出时才会成为问题。不过，运行生成的代码肯定存在安全风险。除非您仔细清理输入，否则您可能会在服务器应用程序中打开一个相当大的安全漏洞。

我很好奇你为什么采用这种方法。简单的数学方程具有相当严格的语法并且很容易解析。我确信有一些免费的库可用，如果不编写自己的库也不是一项艰巨的任务。这可能比使用编译器来验证数学表达式的语法要快得多。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-11T00:29:16.797

如果 C#“方程式”可以保存并在用户之间交换，那么肯定存在安全风险。用户可以将恶意代码放入等式中，并让它在其他用户的机器上做坏事。或者用户可能会被简单地欺骗输入恶意“方程式”（想想这里的旧[alt+F4 恶作剧](http://everything2.com/title/Alt%2520F4)）。

幸运的是，您可以在 .NET 沙箱中[安全地托管不受信任的代码](http://msdn.microsoft.com/en-us/magazine/cc163701.aspx)。一般的想法是您创建一个单独的 AppDomain（使用[AppDomain.CreateDomain](http://msdn.microsoft.com/en-us/library/ms130766.aspx)方法），它只有最小的权限，然后在那里加载和运行用户代码。

无论如何，将动态生成的程序集加载到单独的 AppDomain 中是一个好主意，因为它允许您再次[卸载](http://msdn.microsoft.com/en-us/library/system.appdomain.unload.aspx)它们。

# algorithm - 文本打包算法

> ID：845324
> 
> 赞同：9
> 
> 时间：2009-05-10T13:17:54.073
> 
> 标签：algorithm, text, packing

我敢打赌之前有人已经解决了这个问题，但我的搜索结果是空的。

我想将单词列表打包到缓冲区中，跟踪每个单词的起始位置和长度。诀窍是我想通过消除冗余来有效地打包缓冲区。

示例：娃娃屋

这些可以简单地打包到缓冲区中`dollhouse`，记住`doll`从位置 0 开始是四个字母，在 0`dollhouse`是九个字母，`house`在 3 是五个字母。

到目前为止，我想出的是：

1.  将单词从最长到最短排序：（娃娃屋、房子、娃娃）
2.  扫描缓冲区以查看字符串是否已作为子字符串存在，如果存在，请记下位置。
3.  如果它尚不存在，请将其添加到缓冲区的末尾。

由于长词通常包含较短的词，因此效果很好，但应该可以做得更好。例如，如果我扩展单词列表以包含 ragdoll，那么我的算法会`dollhouseragdoll`比`ragdollhouse`.

这是一个预处理步骤，所以我并不十分担心速度。O(n^2) 很好。另一方面，我的实际列表有数万个单词，所以 O(n!) 可能是不可能的。

作为旁注，此存储方案用于 TrueType 字体的“名称”表中的数据，参见。[http://www.microsoft.com/typography/otspec/name.htm](http://www.microsoft.com/typography/otspec/name.htm)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-05-10T14:54:06.247

这是**最短超字符串问题**：找到包含一组给定字符串作为子字符串的最短字符串。根据[这篇 IEEE 论文](http://ieeexplore.ieee.org/stamp/stamp.jsp?arnumber=00782108)（不幸的是，您可能无法访问），完全解决这个问题是**NP-complete**。然而，启发式解决方案是可用的。

作为第一步，您应该找到所有属于其他字符串的子字符串的字符串并将它们删除（当然，您仍然需要以某种方式记录它们相对于包含字符串的位置）。[使用广义后缀树](http://en.wikipedia.org/wiki/Generalised_suffix_tree)可以有效地找到这些完全包含的字符串。

然后，通过重复合并具有最长重叠的两个字符串，可以保证产生一个长度不小于最小可能长度的 4 倍的解。正如 Zifre 对[Konrad Rudolph 的回答](https://stackoverflow.com/questions/845324/text-packing-algorithm/845339#845339)所建议的那样，使用两棵基数树应该可以快速找到重叠大小。或者，您也许能够以某种方式使用广义后缀树。

很抱歉，我无法为您找到一个像样的链接——似乎没有维基百科页面，或者关于这个特定问题的任何可公开访问的信息。[此处](http://www.cs.sunysb.edu/~algorith/files/shortest-common-superstring.shtml)简要提及，但未提供建议的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T15:45:40.137

细化步骤 3。

*   查看当前列表，查看列表中是否有任何单词以当前单词的后缀开头。（例如，您可能希望使后缀长于某个长度 - 长于 1）。
*   如果是，则将该单词的不同前缀添加为现有单词的前缀，并适当调整所有现有引用（慢！）
*   如果否，则将单词添加到列表末尾，如当前步骤 3 所示。

这将为您提供“ragdollhouse”作为示例中的存储数据。目前尚不清楚它是否总是能以最佳方式工作（例如，如果您在单词列表中还有 'barbiedoll' 和 'dollar'）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T13:28:00.677

我认为您可以使用[Radix Tree](http://en.wikipedia.org/wiki/Radix_tree)。由于指向叶子和父节点的指针，它会花费一些内存，但很容易匹配字符串（O（k）（其中 k 是最长的字符串大小）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T13:31:58.513

我的第一个想法是：使用数据结构来确定字符串的常见前缀和后缀。然后根据这些前缀和后缀对单词进行排序。这将导致您想要的`ragdollhouse`.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-10T13:48:07.660

看起来类似于[背包问题](http://en.wikipedia.org/wiki/Knapsack_problem)，它是 NP 完全的，因此没有“确定性”算法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-10T14:05:11.647

我在大学里做过一个实验室，我们的任务是实施一个简单的压缩程序。

我们所做的是按顺序将这些技术应用于文本：

*   BWT（[Burrows-Wheeler 变换](http://en.wikipedia.org/wiki/Burrows-Wheeler_transform)）：帮助将字母重新排序为相同字母的序列（提示*有数学替换来获取字母而不是实际进行旋转）
*   MTF（[移至前面变换](http://en.wikipedia.org/wiki/Move-to-front_transform)）：将字母序列重写为动态列表的索引序列。
*   [霍夫曼编码](http://en.wikipedia.org/wiki/Huffman%5Fcoding)：熵编码的一种形式，它构造一个可变长度的代码表，其中较短的代码被赋予经常遇到的符号，而较长的代码被赋予不经常遇到的符号

在这里，我找到了[作业页面](http://myweb.msoe.edu/taylor/cs3851f06/lab3.htm)。

要取回原始文本，您执行 (1) Huffman 解码，(2) 逆 MTF，然后 (3) 逆 BWT。Interwebs 上有很多关于这一切的好资源。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-10T15:10:25.720

我不会再重新发明这个轮子了。压缩算法已经投入了大量的人力，为什么不采用一种已经可用的算法呢？

这里有几个不错的选择：

*   [gzip](http://www.gzip.org/)用于快速压缩/解压缩速度
*   [bzip2](http://www.bzip.org/)压缩有点苦，但解压速度要慢得多
*   [LZMA](http://www.7-zip.org/sdk.html)用于非常高的压缩比和快速解压缩（比 bzip2 快但比 gzip 慢）
*   [lzop](http://www.lzop.org/)用于非常快速的压缩/解压缩

如果你使用 Java，[gzip 已经集成](http://java.sun.com/j2se/1.4.2/docs/api/java/util/zip/package-summary.html)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-10T15:23:01.483

目前还不清楚你想做什么。

您是否想要一种数据结构，可以让您以有记忆力的方式存储字符串，同时让搜索等操作在合理的时间内成为可能？

你只想要一个压缩的单词数组吗？

在第一种情况下，您可以选择 patricia trie 或 String B-Tree。

对于第二种情况，您可以采用一些索引压缩技术，例如：

如果你有类似的东西：

```
aaa 
aaab
aasd
abaco
abad 
```

你可以这样压缩：

```
0aaa
3b
2sd
1baco
2ad 
```

该数字是前面字符串的最大公共前缀的长度。例如，您可以调整该架构。计划在 K 个单词之后“重新启动”公共前缀，以便快速重建

# objective-c - 重用 NSString 变量 - 它会导致内存泄漏吗？

> ID：845338
> 
> 赞同：0
> 
> 时间：2009-05-10T13:31:48.403
> 
> 标签：objective-c, memory-management, nsstring, pointers

来自 .NET 背景，我习惯于重用字符串变量进行存储，那么下面的代码是否可能导致内存泄漏？该代码针对 iphone/itouch，因此没有自动 GC。

```
-(NSString*) stringExample
{
    NSString *result = @"example";
    result = [result stringByAppendingString:@" test"]; // where does "example" go?

    return result;
} 
```

让我感到困惑的是 NSStrings 是不可变的，但是您可以毫无问题地重用“不可变”变量。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-10T13:55:29.347

它肯定*会*导致内存泄漏。您必须小心重用，因为您必须对底层 NSString 对象的实际实现有很多了解才能决定您是否“安全”。所以，如果你不使用垃圾收集，为了安全起见，你不应该像以前那样重用变量。

例如，这是完全安全的：

```
NSString *result = @"example";
result = [result stringByAppendingString:@" test"]; 
```

因为初始字符串实际上是一个 Objective-C 字符串常量。但是，这会导致内存泄漏：

```
NSString *result = [[NSString alloc] initWithUTF8String:argv[0]];
result = [result stringByAppendingString:@" something more"]; 
```

但是，这将是安全的，因为您从一开始就没有拥有结果：

```
NSString *result = [NSString stringWithUTF8String:argv[0]];
result = [result stringByAppendingString:@" something more"]; 
```

所以基本上，如果您不拥有该对象或者您打开了垃圾收集，那么它是安全的。但是，如果您拥有原始对象并执行此操作，则会泄漏内存。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T14:37:22.927

附和 Jason 的回答：如果您不调用`retain`, `init`,或使用其中一种方法`copy`，则您不*拥有*该对象。`mutableCopy``initWithSomething`

 *所以在你的代码中，`@"example"`是一个存储在编译代码中的字符串常量，所以没有什么可以释放的。而且，由于您返回的是 a`stringWithString`您不拥有该对象，并且可以假设它将在将来的某个时候自动释放。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-09T05:02:07.553

“它肯定会导致内存泄漏。你必须小心重用，因为你必须对底层 NSString 对象的实际实现有很多了解才能决定你是否“安全”。所以，如果你不使用垃圾收集，为了安全起见，你不应该以你拥有的方式重用变量。”

但是.Net的家伙从来没有使用过会导致内存泄漏的非法语句！上面的语句绝对是合法的，并且会返回字符串@"example test"。

# windows - Windows Media 编码器安装问题

> ID：845340
> 
> 赞同：2
> 
> 时间：2009-05-10T13:32:57.673
> 
> 标签：windows, sdk, media, encoder

我有一个用 C# 编写并依赖于 Windows Media Encoder 9 系列 SDK 的程序。为了让我的程序在其他目标机器上运行，我必须在目标机器上安装整个 Windows Media Encoder。

我的问题是，我想减少在目标机器上安装整个 Windows Media Encoder 的开销，有没有办法在目标机器上复制/注册一些 DLL 来减少整个 Windows Media Encoder 的安装开销？

编辑：我有一个新想法并征求意见，是否可以创建一个安装应用程序来一起安装 Windows Media Encoder 和我的应用程序 - 例如在一个安装向导中？

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T13:38:48.460

您可以尝试减少对[WMF](http://msdn.microsoft.com/en-us/library/aa384477.aspx)的依赖。不过，我最近看到的许多计算机都安装了 WME。

# .net - 远程创建网络共享

> ID：845344
> 
> 赞同：2
> 
> 时间：2009-05-10T13:36:06.647
> 
> 标签：.net, security, networking

我试图弄清楚如何完成以下任务：

1.  使用 .NET 在远程计算机上创建网络共享
2.  目标计算机位于同一网络上。
3.  目标计算机的管理员用户名和密码是已知的。

你的意见？你将如何实现这一目标？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T15:01:49.987

从代码执行 Windows 管理任务的最佳和最简单的方法是通过[WMI](http://msdn.microsoft.com/en-us/library/aa394582(VS.85).aspx)。几乎任何事情都可以通过 WMI 在本地或远程的 Windows 机器上完成。

为了管理 Windows 共享文件夹，您需要与[`Win32_Share`](http://msdn.microsoft.com/en-us/library/aa394435(VS.85).aspx)WMI 类进行交互。

如何使用 WMI 创建共享文件夹的示例：

```
 ManagementPath path = new ManagementPath("Win32_Share");
    path.Server = ".";              // Change this to your server

    object[] parameters = new object[] {
        "C:\\TestShare",            // Path to shared folder
        "Test Share",               // Share name
        0x0,                        // Share type (disk drive)
        5,                          // Maximum amount of concurrent users
        null,                       // Password (optional)
        null                        // Security level (optional)
    };

    ManagementClass share = new ManagementClass(path);
    object result = share.InvokeMethod("Create", parameters); 
```

您需要添加对`System.Management`程序集的引用才能访问 WMI 类。当然，您还需要访问远程机器。

查看[WMI 参考](http://msdn.microsoft.com/en-us/library/aa394572(VS.85).aspx)以获取更多详细信息。具体查看[Win32_Share 类](http://msdn.microsoft.com/en-us/library/aa394435(VS.85).aspx)参考，了解所有参数和返回码的含义。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T14:10:37.403

[http://www.google.ca/search?hl=en&q=create+share+net](http://www.google.ca/search?hl=en&q=create+share+net)建议您将使用 PInvoke 来调用`NetShareAdd`API。

我想知道是否可以调用`NET SHARE`命令行命令，但是看着`NET HELP SHARE`我不知道如何使用它在远程计算机上创建共享。

# ruby - Ruby 的压缩库？

> ID：845348
> 
> 赞同：5
> 
> 时间：2009-05-10T13:39:19.273
> 
> 标签：ruby, compression

是否有任何可用于 Ruby 的开源压缩/解压缩库？有人实施过LZW吗？

或者，是否有任何使用压缩组件的开源库，可以想象将其提取出来供独立使用？

编辑-感谢您的回答！我应该提到我必须压缩的是只驻留在数据库中的长字符串（我不会压缩文件）。此外，如果任何库都可以做到这一点，那么在 JavaScript 中为客户端 comp/decomp 提供等效的实现，这将是理想的，因为这将适用于 Web 应用程序。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-10T13:43:16.703

[您可以在ruby​​ stdlib](http://www.ruby-doc.org/stdlib/)下找到所有已发布的 ruby​​ 库的列表。

我会使用 zlib 库，它是开放的，到处都在使用，你会发现几乎所有语言的库！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-10T13:44:34.100

[http://rubyzip.sourceforge.net/](http://rubyzip.sourceforge.net/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-03-06T18:24:59.560

如果您更关心大小而不是速度，或者您想确保其他语言的绑定以实现兼容性，那么 zlib 很好。对于在线传输，速度和 CPU 利用率通常更为重要。

一些集成了更快压缩库的 ruby​​ 库是：Google 的[Snappy](https://github.com/miyucy/snappy)、[QuickLZ](https://bitbucket.org/winebarrel/quicklz-ruby/overview)和[LZO](https://bitbucket.org/winebarrel/lzo-ruby/src)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-09-29T21:42:46.627

您可以尝试[ruby​​-lzws](https://github.com/andrew-aladev/ruby-lzws)，[lzws](https://github.com/andrew-aladev/lzws)库的绑定。它与 UNIX 压缩兼容。

```
gem install ruby-lzws

require "lzws"

data = LZWS::String.compress "TOBEORNOTTOBEORTOBEORNOT"
puts LZWS::String.decompress(data) 
```

> TOBEORNOTTOBOROBEORNOT

# php - 共享主机上的 PHP 性能

> ID：845349
> 
> 赞同：2
> 
> 时间：2009-05-10T13:39:58.010
> 
> 标签：php, performance, shared-hosting

我有 php 脚本，它使用 php exec 函数调用另一个脚本。被调用的脚本执行批处理工作，即更新交易状态，通知客户（将电子邮件放入单独运行的邮件队列）。因此，由于一个非常大的表（500000 行），这将需要 20-30 分钟，现在我在我的桌面 windows 机器下运行它，php 使用高达 50% 的 CPU，mysql 20% 的 CPU。这是正常的做法吗？如果我将此脚本放在共享主机中怎么办？我会遇到麻烦吗？它不会破坏共享主机规则吗？用户可以随时启动批处理过程（通常每月一次或更频繁）。

对此有什么建议吗？

谢谢阅读。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-10T13:53:27.693

几乎可以肯定，但这取决于共享主机可用的 CPU 功率（老实说，可能与您的桌面一样多），在这种情况下，您会看到自己在短时间内启动。共享主机往往是堆栈高度的事务，您可以在其中托管 100 多个站点。

你可以选择一个虚拟主机，在那里他们会给你自由做任何你喜欢的事情，但是你可能会发现你被限制的 CPU 能力是有限的，可能对你来说太有限了。虚拟主机倾向于将主机拆分为几个虚拟客人，有时少至 4 个，但更常见的是（尤其是对于更便宜的计划）一直到 64 个。

然后，您的第三个选择是购买一个完全专用的服务器，您自己拥有一个完整的服务器，并且可以随心所欲地使用它。如果您想要大量服务器硬件（因为它使用大量非常昂贵的电力）或大量带宽，这些往往会很昂贵。

显然，这 3 个选项会增加成本，在虚拟主机领域，您确实得到了您所支付的费用。

您可能想找到一个虚拟主机论坛并在那里四处询问 - 请务必指定 CPU 要求以及可能需要多长时间。如果您同意他们的时间（不干扰备份，或者如果他们的资源时间较短，如网站往往在世界各地的每个时区都可以访问）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T13:50:12.387

通常共享主机不喜欢你占用他们宝贵的 CPU 能力，所以我不建议你在其中做任何非常密集的事情。如果您正在寻找执行批处理作业，您应该考虑投资一台专用服务器，一般来说它也很有用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T14:23:22.367

我正在使用 Facebook 应用程序（php，350,000 个通知）做类似的事情。我的托管公司确实收到了 1 个关于 CPU 使用情况的“警报”，但该“警报”来自销售，提供与我合作进行升级。

我将批处理脚本更改为一次使用更少的 CPU，主要是通过产生更少的同时进程 (10) 并在几个位置放置一个 sleep(10) 命令。sleep 命令是为了让 CPU 回落到“正常”水平，所以会出现 CPU 峰值，而不是持续使用。

在共享主机上，预计会出现 CPU 峰值。但是持续的高 CPU 级别会向托管公司发出警报（如果它们有任何好处）。您希望避免在 50% 或任何长时间运行任何高级别 CPU。

如果脚本是否需要额外的几分钟并不重要，请在您的代码中放置一些等待状态（睡眠）。这对同一台机器上的其他用户也是公平的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T13:47:55.460

运行共享主机的服务器通常比普通的家用计算机快得多，因此它可能不会像在本地计算机上运行那样长。我认为如果您每天发送 500,000 封电子邮件，警钟就会开始响起，但如果您有一个合理的主机在短时间内使用那么多 CPU，这应该不是什么大问题。

你总是可以先和他们谈谈，我相信他们会解决的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-10-14T02:29:34.900

简而言之，在共享服务器上占用资源是不合适的。

基本上，如果您为其他进程腾出足够的时间，那并不是一件坏事。但是，像您正在讨论的那样增加 CPU 是一件坏事，并且对系统的其他用户不利。你应该在你的主循环中有一个 yield 机制（`usleep(100)`例如），并使用`nice`像 19 这样的大数字运行命令。

此外，听起来您正在批处理脚本中进行单独的插入/更新/等调用。使用 mysql，尽可能进行批量插入是一种更好的做法（与单个插入相比非常快）。但是，取决于您如何执行此操作，这可能是 RAM 与 CPU 时间的权衡（例如，如果您将所有插入值存储在一个字符串中，直到它们准备好使用单个插入语句插入，那么这可能会增加最多很多 RAM）。如果 RAM 有问题，您始终可以构建一个临时 SQL 文件，然后在该过程结束时导入整个文件。

批量插入看起来像（对于具有两个 varchar 列的表）：

```
INSERT INTO `mytable` VALUES ('Field 1-Row 1', 'Field 2-Row 1'), ('Field 1-Row 2', 'Field 2-Row 2'); 
```

这将在一小部分时间内一次插入两行。

但是话又说回来，根据您描述为脚本的目的，您可能一开始就没有做很多插入。但是也许您仍然可以将所有（或许多）数据库更新/插入/删除构建到最后调用的最终脚本中？

此外，如果您确定可以在导入时保持外键的正确顺序，关闭外键检查也可以显着提高速度。

所有其他可能的建议将基于您的代码和数据库架构的特定优化（优化循环、查找、索引等）。

我在这里**强烈暗示**的是，您可以在共享主机中执行类似的操作而不会占用资源，但是您的数据库结构、SQL 语句和算法（循环等）必须高度优化。如果你这样做，一个额外的好处是你的过程也将很快完成。有一个常见的误解是 php + mysql = 慢/cpu hog，但 99% 的时间它是编程或数据库设计问题。他们应该能够轻松处理那么多记录。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-12T05:28:40.103

我建议使用[Amazon EC2](http://aws.amazon.com/ec2/)或[Mosso 的云服务器](http://www.mosso.com/cloudservers.jsp)（由 Rackspace 拥有）之类的服务。这些虚拟服务器具有合理的小时费率和出色的 API。您无需最低每月承诺即可获得专用服务器的强大功能。例如，您可以使用 EC2 配置虚拟服务器，然后让您的常规 Web 服务器运行每周/每月的 cron 作业以启动该 EC2 实例，运行您的作业，然后关闭 EC2 实例。

# php - PHP 语言（单元）测试

> ID：845350
> 
> 赞同：3
> 
> 时间：2009-05-10T13:40:37.403
> 
> 标签：php, unit-testing, testing, virtual-machine, implementation

目前，我正在（只是为了好玩）研究一种将`PHP`代码分解为低级源代码的编译器`VM`。

由于类型系统和许多`PHP`-features 不是那么合乎逻辑，我需要大量测试脚本来验证我的代码在`PHP`.

`PHP`我开始使用-sources中的测试来测试所有内容（[此处](http://cvs.php.net/viewvc.cgi/php-src/tests/ "这里")）。但是很多测试不仅是特定于语言的，它们还包含来自网络服务器处理的一些功能（POST 数据等）。是否有任何其他测试可以`PHP`作为语言进行测试？如果脚本本身是用`PHP`.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T11:35:42.263

如果您正在验证您的语义在 PHP 的 Zend 实现中的行为，那么我建议您构建一个自动化工具来从 PHP 本身的 BNF 生成语法。这样，您将拥有大量表达大部分语义的 .php 文件。确保在生成的文件中包含大量跟踪代码。

然后通过 Zend 实现和您的实现运行它，以确保您获得相同的验证。使用一些损坏的代码生成来确保你也能抓住它。只有当你知道你的实现是正确的（有怪癖）时，你才能继续前进。

[http://llvm.org/devmtg/2008-08/Lopes_PHP-JIT-InTwoDays.pdf](http://llvm.org/devmtg/2008-08/Lopes_PHP-JIT-InTwoDays.pdf)可能会有所帮助。研究为 LLVM 构建 PHP JIT 的人。可能会提供一些关于他们如何针对现有实现测试语言语法和语义的有效性的信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T14:38:08.120

我可能误解了你，但这可能是你要找的东西？
[http://www.simpletest.org/](http://www.simpletest.org/)

根据描述，他们将其设计为类似于 JUnit，但用于 php。

# assembly - 编程语言编译器首先转换为汇编还是直接转换为机器代码？

> ID：845355
> 
> 赞同：56
> 
> 时间：2009-05-10T13:45:12.633
> 
> 标签：assembly, gcc, compilation, compiler-construction

我主要对流行且广泛使用的编译器感兴趣，例如 gcc。但是，如果使用不同的编译器做不同的事情，我也想知道这一点。

以 gcc 为例，它是直接将 C 编写的短程序编译成*机器码*，还是先将其翻译成人类可读的汇编，然后才使用（内置？）汇编程序将汇编程序翻译成二进制，*机器码*——对 CPU 的一系列指令？

使用汇编代码创建二进制可执行文件是一项非常昂贵的操作吗？或者这是一件相对简单快捷的事情？

（假设我们只处理 x86 系列处理器，并且所有程序都是为 Linux 编写的。）

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-05-10T13:51:38.970

gcc 实际上会生成汇编程序并使用**as**汇编程序对其进行汇编。并非所有编译器都这样做 - MS 编译器直接生成目标代码，尽管您可以让它们生成汇编器输出。将汇编程序转换为目标代码是一个非常简单的过程，至少与编译相比是这样。

一些编译器生成其他高级语言代码作为其输出 - 例如，**cfront**，第一个 C++ 编译器生成 C 作为其输出，然后由 C 编译器编译。

请注意，直接编译或汇编都不会实际生成可执行文件。这是由**链接器**完成的，它获取编译/汇编生成的各种目标代码文件，解析它们包含的所有名称并生成最终的可执行二进制文件。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-05-10T20:09:33.557

包括 gcc 在内的几乎所有编译器都生成汇编代码，因为它更容易生成和调试编译器。主要的例外通常是即时编译器或交互式编译器，它们的作者不希望性能开销或分叉整个进程来运行汇编器的麻烦。一些有趣的例子包括

*   [新泽西州的标准 ML](http://www.smlnj.org)，它以交互方式运行并即时编译每个表达式。

*   [tinycc 编译器](http://bellard.org/tcc/)的设计速度足以在 100 毫秒内编译、加载和运行 C 脚本，因此不需要调用汇编器和链接器的开销。

这些案例的共同点是对“即时”响应的渴望。汇编器和链接器非常快，但对于交互式响应来说还不够好。然而。

还有一大类语言，例如 Smalltalk、Java 和[Lua](http://www.lua.org)，它们编译为字节码，而不是汇编代码，但它们的实现稍后可能将该字节码直接转换为机器代码，而无需使用汇编程序。

（脚注：在 1990 年代初期，Mary Fernandez 和我编写了[New Jersey Machine Code Toolkit](http://www.cs.tufts.edu/~nr/pubs/tk-usenix-abstract.html)，该工具包的[代码](http://www.cs.tufts.edu/~nr/toolkit/)是在线的，它生成 C 库，编译器编写者可以使用这些库绕过标准汇编器和链接器。Mary 用它大约翻了一番生成时她优化链接器的速度`a.out`。如果你不写入磁盘，加速会更大......）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-10T14:01:51.393

根据[《逆向工程软件简介》 （Mike Perry 和 Nasko Oskov 撰写）的](http://althing.cs.dartmouth.edu/local/www.acm.uiuc.edu/sigmil/RevEng/)[第 2 章](http://althing.cs.dartmouth.edu/local/www.acm.uiuc.edu/sigmil/RevEng/ch02.html)，gcc 和 cl.exe（MSVC++ 的后端编译器）都有**-S**开关，可用于输出每个编译器生成的程序集。

 **您还可以在详细模式 ( `gcc -v`) 下运行 gcc 以获取它执行的命令列表，以查看它在幕后所做的事情。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-05-10T14:40:09.383

GCC 编译为汇编程序。其他一些编译器没有。例如，LLVM-GCC 编译为 LLVM-assembly 或 LLVM-bytecode，然后编译为机器码。几乎所有编译器都有某种内部表示，LLVM-GCC 使用 LLVM，而 IIRC，GCC 使用称为 GIMPLE 的东西。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-05-10T13:50:52.230

通常，编译器将源代码解析为抽象语法树（AST），然后解析为某种中间语言。只有这样，通常经过一些优化后，它们才会发出目标语言。

关于 gcc，它可以编译成各种各样的目标。我不知道对于 x86，它是否首先编译为程序集，但我确实让您对编译器有所了解——您也要求这样做。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-01-29T19:02:35.987

没有一个答案阐明了一个事实，即汇编器是二进制代码和机器相关符号代码之间的第一层抽象。编译器是 MACHINE DEPENDENT SYMBOLIC CODE 和 MACHINE INDEPENDENT SYMBOLIC CODE 之间的第二层抽象。

如果编译器直接将代码转换为二进制代码，根据定义，它将被称为汇编程序而不是编译器。

更恰当的说法是编译器使用中间代码，它可能是也可能不是汇编语言，例如 Java 使用字节代码作为中间代码，而字节代码是 Java 虚拟机 (JVM) 的汇编程序。

编辑：您可能想知道为什么汇编程序总是产生与机器相关的代码以及为什么编译器能够产生与机器无关的代码。答案很简单。汇编器是机器代码的直接映射，因此它产生的汇编语言总是依赖于机器的。相反，我们可以为不同的机器编写多个版本的编译器。因此，要独立于机器运行我们的代码，我们必须在为该机器编写的编译器版本上编译相同的代码。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-10T14:35:12.550

您可能有兴趣收听这个播客：[GCC 的内部结构](http://www.se-radio.net/2007/07/episode-61-internals-of-gcc/)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-10T14:38:27.793

在大多数[多遍编译器](http://en.wikipedia.org/wiki/Multi-pass_compiler)中，汇编语言是在代码生成步骤中生成的。这允许您编写一次词法分析器、语法和语义阶段，然后使用单个汇编器后端生成可执行代码。这在交叉编译器中被大量使用，例如为一系列不同 cpu 生成的 C 编译器。

几乎每个编译器都有这种形式，无论是隐式还是显式步骤。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-12-27T01:25:23.063

编译有很多阶段。抽象地说，有前端读取源代码，将其分解为标记，最后分解为解析树。

后端负责首先生成一个顺序代码，如三地址代码，例如：

代码：

```
x = y + z + w 
```

进入：

```
reg1 = y + z
x = reg1 + w 
```

然后对其进行优化，将其翻译成汇编，最后翻译成机器语言。所有步骤都经过仔细分层，以便在需要时可以更换其中一个

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-10T13:51:25.243

Visual C++ 有一个输出汇编代码的[开关](http://msdn.microsoft.com/en-us/library/367y26c6(VS.80).aspx)，所以我认为它在输出机器代码之前会生成汇编代码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-10T15:25:48.127

Java 编译器编译成 java 字节码（二进制格式），然后使用虚拟机 (jvm) 运行它。

虽然这可能看起来很慢 - 它可以更快，因为 JVM 可以利用以后的 CPU 指令和新的优化。C++ 编译器不会这样做——你必须在编译时定位指令集。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-02-26T06:46:07.550

虽然不是所有编译器都将源代码转换为中间级代码，但在几个编译器中存在将源代码转换为机器级代码的桥梁

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-10-15T11:32:11.260

上面的一些答案让我感到困惑，因为在某些答案中 GCC（GNU Compiler Collection）被称为单个工具，但它是一套工具，如 GNU Assembler（也称为 GAS）、链接器、编译器和调试器，它们一起用于生成一个可执行文件。是的，GCC 不会直接将 C 源文件转换为机器代码。

它分 4 个步骤完成：

1.  预处理 - 删除注释和扩展宏（C）.etc

2.  编译 - 汇编源代码（由编译器完成）

3.  组装 - 组装成机器代码（由汇编器完成）

4.  链接 - 默认情况下将标准函数动态链接到共享库（由链接器完成）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-01-04T00:04:23.113

列表文件是编译器生成的文本文件，其中包含编译器生成的汇编语言代码。大多数编译器都支持在编译过程中生成列表文件。对于某些编译器，例如 GCC，这是编译过程的标准部分，因为编译器不直接生成目标文件，而是生成汇编语言文件，然后由汇编器处理。在这样的编译器中，请求一个列表文件仅仅意味着编译器在汇编器完成它之后不能删除它。在其他编译器（例如 Microsoft 或 Intel 编译器）中，列表文件是必须通过命令行启用的可选功能。

# testing - 跨多个 DBMS 供应商进行测试

> ID：845360
> 
> 赞同：1
> 
> 时间：2009-05-10T13:49:10.327
> 
> 标签：testing, rdbms, database

接受这个查询：

```
 SELECT *
    FROM MyTable
   WHERE MyColumn = 'SomeValue'
ORDER BY SomeFakeQualifier.MyColumn DESC 
```

在这种情况下，似乎 SqlServer 只是忽略了限定符。如果你添加一个`JOIN`，那么它会考虑它。

这真的不是问题，除非您想让您的查询在 DBMS 供应商中可行。例如，Oracle 会理所当然地抱怨限定符无效。

*是的，我们使用 ORM 消除了很多这种情况，但我们仍然需要 JDBC 来执行某些操作（这是我们产品的本质及其对动态查询的支持）。事实上，正是**因为如此**，才出现了这个问题——有人将 JPA 命名查询复制到了 JDBC 提供的查询中，但留下了对象名而不是表名。*

所以我想问题是：还有其他人遇到过这个吗？如果是这样，测试代码以确保它可以在“主要三个”DBMS（SqlServer、Oracle、DB2）上工作的最佳方法是什么？我们有一个 QA 团队，但似乎应该有更好的方法来对这些特质进行单元测试。

*请注意，我们总是尝试强制编写 ANSI SQL 以避免出现问题，但有些事情，比如前面提到的问题，可能会漏掉*

我希望这是有道理的。如有必要，我可以提供更多上下文。

TIA

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T14:06:16.653

您的解决方案实际上是结合[持续集成](http://www.martinfowler.com/articles/continuousIntegration.html)对您的查询进行单元测试。您有 JDBC 代码形式的查询。编写单元测试以连接到您的相关数据库并以这样的方式运行查询很容易，即使您不关心结果，您至少可以看到它们是否执行，这是您正在谈论的标准.

可以说，您可以扩展它来测量性能和/或结果，但我发现这类测试非常脆弱，并且随着不可避免地发生更多变化，往往会非常非常快地崩溃。

# ruby-on-rails - 在 Rails 中使用 JSON 创建嵌套对象

> ID：845366
> 
> 赞同：32
> 
> 时间：2009-05-10T13:51:58.097
> 
> 标签：ruby-on-rails, ruby, json

如何将 JSON 传递给 RAILS 应用程序，以便它在 has_many 关系中创建嵌套的子对象？

这是我到目前为止所拥有的：

两个模型对象。

```
class Commute < ActiveRecord::Base
  has_many :locations
  accepts_nested_attributes_for :locations, :allow_destroy => true
end

class Location < ActiveRecord::Base
  belongs_to :commute
end 
```

通过 Commute，我设置了一个标准控制器。我希望能够使用 JSON 在单个 REST 调用中创建一个 Commute 对象以及几个子 Location 对象。我一直在尝试这样的事情：

```
curl -H "Content-Type:application/json" -H "Accept:application/json" 
-d "{\"commute\":{\"minutes\":0, 
\"startTime\":\"Wed May 06 22:14:12 EDT 2009\", 
\"locations\":[{\"latitude\":\"40.4220061\",
\"longitude\":\"40.4220061\"}]}}"  http://localhost:3000/commutes 
```

或者更具可读性，JSON 是：

```
{
    "commute": {
        "minutes": 0,
        "startTime": "Wed May 06 22:14:12 EDT 2009",
        "locations": [
            {
                "latitude": "40.4220061",
                "longitude": "40.4220061"
            }
        ]
    }
} 
```

当我执行它时，我得到这个输出：

```
Processing CommutesController#create (for 127.0.0.1 at 2009-05-10 09:48:04) [POST]
  Parameters: {"commute"=>{"minutes"=>0, "locations"=>[{"latitude"=>"40.4220061", "longitude"=>"40.4220061"}], "startTime"=>"Wed May 06 22:14:12 EDT 2009"}}

ActiveRecord::AssociationTypeMismatch (Location(#19300550) expected, got HashWithIndifferentAccess(#2654720)):
  app/controllers/commutes_controller.rb:46:in `new'
  app/controllers/commutes_controller.rb:46:in `create' 
```

看起来位置 JSON 数组正在被读取，但没有被解释为 Location 对象。

我可以轻松更改客户端或服务器，因此解决方案可以来自任何一方。

那么，RAILS 是否让我可以轻松做到这一点？或者我是否需要在我的 Commute 对象中添加一些对此的支持？也许添加一个 from_json 方法？

谢谢你的帮助。

* * *

正如我一直在解决这个问题，一种可行的解决方案是修改我的控制器。但这似乎不是“rails”的做法，所以如果有更好的方法，请告诉我。

```
def create
    locations = params[:commute].delete("locations");
    @commute = Commute.new(params[:commute])

    result = @commute.save

    if locations 
      locations.each do |location|
        @commute.locations.create(location)
      end
    end

    respond_to do |format|
      if result
        flash[:notice] = 'Commute was successfully created.'
        format.html { redirect_to(@commute) }
        format.xml  { render :xml => @commute, :status => :created, :location => @commute }
      else
        format.html { render :action => "new" }
        format.xml  { render :xml => @commute.errors, :status => :unprocessable_entity }
      end
    end
  end 
```

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-05-12T23:58:56.437

想通了，locations 对象应该被称为 locations_attributes 以匹配 Rails 嵌套对象创建命名方案。之后，它可以与默认的 Rails 控制器完美配合。

```
{
    "commute": {
        "minutes": 0,
        "startTime": "Wed May 06 22:14:12 EDT 2009",
        "locations_attributes": [
            {
                "latitude": "40.4220061",
                "longitude": "40.4220061"
            }
        ]
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2017-01-01T21:42:20.940

如果您不能轻松更改正在使用的 json，则可以`new`在模型上实现。我正在使用以下内容将 json 调整为预期的形状，在我的情况下，这涉及删除“id”键和一些在我的本地模型中不存在的键。我`application_record.rb`在每个模型中都实现了这一点和特殊情况。

```
 def self.new(properties = {})
  super properties.select { |attr, _val| 
    (['id'] + attribute_types.keys).include?(attr.to_s) 
} 
```

# html - 页面底部有空白区域？

> ID：845368
> 
> 赞同：0
> 
> 时间：2009-05-10T13:52:35.947
> 
> 标签：html, css, layout

在我当前的简单项目[Copybin](http://dflog.net/copybin2/)中，页面底部有一些空间，我似乎无法将其删除。有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-10T13:55:19.363

您的页面上有以下 CSS：

```
body {
    padding:0;
    margin:0;
    background-color:#eef8ff;
    min-width:950px;
    min-height:975px;
} 
```

删除你的 min-height:975px;。这将允许您的页面扩展到所需的任何高度。我测量了你的页面，它的高度正好是 975 像素。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-12T17:16:12.697

尝试将所有内容包装在 div 标签中，然后将其高度设置为 Web 模板的高度并将溢出隐藏。

```
<body>
<div style="height:800px; overflow:hidden;">
    <!-- rest of your code -->
</div>
</body> 
```

# c# - 将 html 拆分为单词

> ID：845375
> 
> 赞同：1
> 
> 时间：2009-05-10T13:55:58.647
> 
> 标签：c#, html, split

假设我有以下字符串：

```
Hellotoevryone<img height="115" width="150" alt="" src="/Content/Edt/image/b4976875-8dfb-444c-8b32-cc b47b2d81e0.jpg" />Iamsogladtoseeall. 
```

这个字符串代表一个不被空格分隔的字符序列，在这个字符串中还插入了一个html图像。现在我想将字符串分成 words ，每个长度为 10 个字符，所以 aoutput 应该是：

```
1)Hellotoevr
2)yone<img height="115" width="150" alt="" src="/Content/Edt/image/b4976875-8dfb-444c-8b32-cc b47b2d81e0.jpg" />Iamsog
3)ladtoseeal
4)l. 
```

所以想法是将任何 html 标记内容保持为 0 长度字符。

我写过这样的方法，但它没有考虑到html标签：

```
public static string EnsureWordLength(this string target, int length)
{
    string[] words = target.Split(' ');
    for (int i = 0; i < words.Length; i++)
        if (words[i].Length > length)
        {
            var possible = true;
            var ord = 1;
            do
            {
                var lengthTmp = length*ord+ord-1;
                if (lengthTmp < words[i].Length) words[i] = words[i].Insert(lengthTmp, " ");
                else possible = false;
                ord++;
            } while (possible); 

        }

    return string.Join(" ", words);
} 
```

我希望看到一个执行我所描述的拆分的代码。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T17:49:52.753

这是一个符合您要求的正则表达式解决方案。请记住，如果您决定稍微改变您的要求，这可能不会起作用，这忠实于[这里众所周知的报价](https://stackoverflow.com/questions/58640/great-programming-quotes/58646#58646)。

```
using System.Text.RegularExpressions;

string[] samples = {
    @"Hellotoevryone<img height=""115"" width=""150"" alt="""" src=""/Content/Edt/image/b4976875-8dfb-444c-8b32-cc b47b2d81e0.jpg"" />Iamsogladtoseeall.",
    "Testing123Hello.World",
    @"Test<a href=""http://stackoverflow.com"">StackOverflow</a>",
    @"Blah<a href=""http://stackoverflow.com"">StackOverflow</a>Blah<a href=""http://serverfault.com"">ServerFault</a>",
    @"Test<a href=""http://serverfault.com"">Server Fault</a>", // has a space, not matched
    "Stack Overflow" // has a space, not matched
};

// use these 2 lines if you don't want to use regex comments
//string pattern = @"^((?:\S(?:\<[^>]+\>)?){1,10})+$";
//Regex rx = new Regex(pattern);

// regex comments spanning multiple lines requires use of RegexOptions.IgnorePatternWhitespace
string pattern = @"^(               # match line/string start, begin group
                    (?:\S           # match (but don't capture) non-whitespace chars
                    (?:\<[^>]+\>)?  # optionally match (doesn't capture) an html <...> tag
                                    # to match img tags only change to (?:\<img[^>]+\>)?
                    ){1,10}         # match upto 10 chars (tags don't count per your example)
                    )+$             # match at least once, and match end of line/string
                    ";
Regex rx = new Regex(pattern, RegexOptions.IgnorePatternWhitespace);

foreach (string sample in samples)
{
    if (rx.IsMatch(sample))
    {
        foreach (Match m in rx.Matches(sample))
        {
            // using group index 1, group 0 is the entire match which I'm not interested in
            foreach (Capture c in m.Groups[1].Captures)
            {
                Console.WriteLine("Capture: {0} -- ({1})", c.Value, c.Value.Length);
            }
        }
    }
    else
    {
        Console.WriteLine("Not a match: {0}", sample);
    }

    Console.WriteLine();
} 
```

使用上面的示例，这是输出（括号中的数字 = 字符串长度）：

```
Capture: Hellotoevr -- (10)
Capture: yone<img height="115" width="150" alt="" src="/Content/Edt/image/b49768
75-8dfb-444c-8b32-cc b47b2d81e0.jpg" />Iamsog -- (116)
Capture: ladtoseeal -- (10)
Capture: l. -- (2)

Capture: Testing123 -- (10)
Capture: Hello.Worl -- (10)
Capture: d -- (1)

Capture: Test<a href="http://stackoverflow.com">StackO -- (45)
Capture: verflow</a> -- (11)

Capture: Blah<a href="http://stackoverflow.com">StackO -- (45)
Capture: verflow</a>Bla -- (14)
Capture: h<a href="http://serverfault.com">ServerFau -- (43)
Capture: lt</a> -- (6)

Not a match: Test<a href="http://serverfault.com">Server Fault</a>

Not a match: Stack Overflow 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T17:20:21.910

以下代码将处理您提供的情况，但会因更复杂的情况而中断。此外，由于您没有指定它应如何处理带有内部文本或 HTML 的长格式标签，它会将所有标签视为短格式标签（运行代码以了解我的意思）。

使用此输入：

```
Hellotoevryone<img height="115" width="150" alt="" src="/Content/Edt/image/b4976875-8dfb-444c-8b32-cc b47b2d81e0.jpg" />Iamsogladtoseeall。
Hellotoevryone<img src="/Content/Edt/image/b4976875-8dfb-444c-8b32-cc b47b2d81e0.jpg" />Iamsoglad<img src="baz.jpeg" />toseeall。
你好<span class="foo">toevryone</span>Iamso<em>很高兴</em>toseeallTheQuickBrown<img src="bar.jpeg" />FoxJumpsOverTheLazyDog。
您好<span class="foo">toevryone</span>Iamso<em>很高兴</em>toseeall。
Loremipsumdolorsitamet，consecteturadipiscingelit.Nullamacnibhelit，quisvolutpatnunc.Donecultrices，ipsumquisaccumsanconvallis，tortortortorgravidaante，etsollicitudinipsumnequeeulorem。

```

与此输入中断（注意不完整的标签）：

```
Hellotoevryone<img height="115" width="150" alt="" src="/Content/Edt/image/b4976875-8dfb-444c-8b32-cc b47b2d81e0.jpg" /Iamsogladtoseeall.

```

```
using System;
using System.Text.RegularExpressions;
using System.IO;
using System.Collections.Generic;

public static class CustomSplit {
  public static void Main(String[] args) {
    if (args.Length > 0 && File.Exists(args[0])) {
      StreamReader sr = new StreamReader(args[0]);
      String[] lines = sr.ReadToEnd().Split(new String[]{Environment.NewLine}, StringSplitOptions.None);

      int counter = 0;
      foreach (String line in lines) {
        Console.WriteLine("########### Line {0} ###########", ++counter);
        Console.WriteLine(line);
        Console.WriteLine(line.EnsureWordLength(10));
      }
    }
  }

}

public static class EnsureWordLengthExtension {
  public static String EnsureWordLength(this String target, int length) {
    List<List<Char>> words = new List<List<Char>>();

    words.Add(new List<Char>());

    for (int i = 0; i < target.Length; i++) {
      words[words.Count - 1].Add(target[i]);

      if (target[i] == '<') {
        do {
          i++;
          words[words.Count - 1].Add(target[i]);
        } while(target[i] != '>');
      }

      if ((new String(words[words.Count - 1].ToArray())).CountCharsWithoutTags() == length) {
        words.Add(new List<Char>());
      }
    }

    String[] result = new String[words.Count];
    for (int j = 0; j < words.Count; j++) {
      result[j] = new String(words[j].ToArray());
    }

    return String.Join(" ", result);
  }

  private static int CountCharsWithoutTags(this String target) {
    return Regex.Replace(target, "<.*?>", "").Length;
  }
} 
```

# c# - 两个日期时间 C# 之间的区别？

> ID：845379
> 
> 赞同：109
> 
> 时间：2009-05-10T13:58:32.813
> 
> 标签：c#, date, datediff

我需要一个可以将以下两个日期之间的差返回为 24 的函数。

```
DateTime a = new DateTime(2008, 01, 02, 06, 30, 00);
DateTime b = new DateTime(2008, 01, 03, 06, 30, 00); 
```

* * *

## 回答 #1

> 赞同：209
> 
> 时间：2009-05-10T14:11:25.110

您可以执行以下操作：

```
TimeSpan duration = b - a; 
```

时间跨度类中有很多内置方法可以满足您的需要，即

```
duration.TotalSeconds
duration.TotalMinutes 
```

更多信息可以在[这里](http://msdn.microsoft.com/en-us/library/system.timespan.aspx)找到。

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-05-10T13:59:33.687

尝试以下

```
double hours = (b-a).TotalHours; 
```

如果您只想要不包括天数差异的小时差，您可以使用以下

```
int hours = (b-a).Hours; 
```

这两个属性的差异主要体现在时差超过 1 天时。Hours 属性只会报告两个日期之间的实际小时差。因此，如果两个日期相差 100 年但同时发生在一天中，则小时数将返回 0。但 TotalHours 将返回两个日期之间发生的总小时数之间的差值（在本例中为 876,000 小时）。

另一个区别是 TotalHours 将返回小数小时。这可能是也可能不是您想要的。如果没有，Math.Round 可以根据您的喜好进行调整。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-10T14:03:36.293

您是否正在寻找：

```
int Difference = (a-b).Hours; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T14:14:55.237

```
int hours = (int)Math.Round((b - a).TotalHours) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-10T14:19:45.453

```
var theDiff24 = (b-a).Hours 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2016-02-25T06:41:24.470

使用此方法将显示黑白与时间的时间差。

```
 private void HoursCalculator()
    {
        var t1 = txtfromtime.Text.Trim();
        var t2 = txttotime.Text.Trim();
        var Fromtime = t1.Substring(6);
        var Totime = t2.Substring(6);
        if (Fromtime == "M")
        {
             Fromtime = t1.Substring(5);
        }
        if (Totime == "M")
        {
            Totime = t2.Substring(5);
        }

        if (Fromtime=="PM" && Totime=="AM" )
        {
            var dt1 = DateTime.Parse("1900-01-01 " + txtfromtime.Text.Trim());
            var dt2 = DateTime.Parse("1900-01-02 " + txttotime.Text.Trim());
            var t = dt1.Subtract(dt2);
            //int temp = Convert.ToInt32(t.Hours);
            //temp = temp / 2;
            lblHours.Text =t.Hours.ToString() + ":" + t.Minutes.ToString();

        }
        else if (Fromtime == "AM" && Totime == "PM")
        {
            var dt1 = DateTime.Parse("1900-01-01 " + txtfromtime.Text.Trim());
            var dt2 = DateTime.Parse("1900-01-01 " + txttotime.Text.Trim());
            TimeSpan t = (dt2.Subtract(dt1));
            lblHours.Text = t.Hours.ToString() + ":" + t.Minutes.ToString();
        }
        else
        {
            var dt1 = DateTime.Parse("1900-01-01 " + txtfromtime.Text.Trim());
            var dt2 = DateTime.Parse("1900-01-01 " + txttotime.Text.Trim());
            TimeSpan t = (dt2.Subtract(dt1));
            lblHours.Text = t.Hours.ToString() + ":" + t.Minutes.ToString();
        }
    } 
```

使用您的字段 ID

**var t1**捕获**4:00AM的值**

检查此代码可能对某人有帮助。

# jquery - 防止在 IE6 中执行 javascript

> ID：845383
> 
> 赞同：0
> 
> 时间：2009-05-10T14:01:45.733
> 
> 标签：jquery, internet-explorer-6, cross-browser

我想阻止我的 javascript 的某些部分在 IE6 中执行，如果这很重要的话，用 jQuery 编写。实现此目的的首选方法是什么？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T14:32:23.800

您可以使用条件注释来定义变量，并检查它是否在执行时设置。

语法是`<!--[if IE 6> <script ... /><![endif]-->`. 评论的内容对所有其他浏览器都是不可见的，所以真的是万无一失。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T18:14:01.980

既然你提到了JQuery，你为什么不使用“ `if ($.browser.msie`）”构造。我认为这个[资源](http://api.jquery.com)对你有用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T14:07:28.387

出于您声明的目的，您绝对应该使用[渐进增强](http://en.wikipedia.org/wiki/Progressive_enhancement)而不是浏览器检测。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T14:08:13.113

您应该只使用浏览器检测脚本并在 IE6 上设置不应执行脚本的条件。这是[浏览器检测](http://www.quirksmode.org/js/detect.html)javascript的链接。

# matlab - matlab中的多个矩阵没有递归

> ID：845389
> 
> 赞同：3
> 
> 时间：2009-05-10T14:03:44.797
> 
> 标签：matlab, matrix

我必须编写一个执行此操作的 Matlab 脚本：

输入是 2 个矩阵，A(mxn) 和 D(mx 1)。输出是一个矩阵 C (mxn)。C 是这样计算的：

```
function c = scanrow(a,d)
[rows columns] = size(d);
for i=1:columns
a(i,:) = a(i,:).*d(i);   
end
c = a;
end 
```

要求不使用递归。我不知道要解决这个问题。很高兴您能提供帮助。谢谢你。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-10T17:16:10.433

正如一个 FYI - bsxfun + 函数句柄是对至少一个矩阵维度匹配一个向量维度的矩阵和向量执行操作的新热点。这避免了显式的 rempat，这可能是缓慢和浪费的：

```
a = 1:5;
b = 魔法（5）；

c = bsxfun(@times,a,b);

```

但要小心 - 这仅在相对较新的 MATLAB 版本中可用。-皮特

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-10T14:56:27.790

如果问题是“将 A 的每一行中的每个元素与 D 的相应行上的相应元素相乘”，那么我建议如下：

```
dd = repmat(d, 1, size(a, 2))
c = a.*dd 
```

例子：

```
>> a = [1 2; 3 4; 5 6];
>> d = [1 2 3]';
>> dd = dd = repmat(d, 1, size(a, 2))
dd = 
     1   1
     2   2
     3   3
>> a.*dd
ans =
     1   2
     6   8
     15  18 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-11T12:08:58.100

（我会回答，尽管这是家庭作业。我认为很多人不明白为什么创建 bsxfun。）

乘法还有其他解决方案。典型的方法是使用 repmat、使用循环或乘以对角矩阵。如果将对角矩阵设为稀疏矩阵，则更好。但是，bsxfun 绝对是正确的解决方案。它是为解决此类问题而编写的。问题是当你做类似的事情时

```
A = magic(3) + 5 
```

MATLAB 知道它必须将 5 加到 magic(3) 的每个元素上。同样，当你这样做

```
A = magic(4).*2 
```

同样，MATLAB 理解乘法将扩展到所有元素。实质上，MATLAB 在加法或乘法中将标量隐式扩展为与其伙伴大小相同的数组，然后执行运算。这是 repmat 求解器明确完成的。

显式标量扩展的问题在于，进行该扩展需要时间和内存。所以 times 和 plus 足够聪明，可以识别出标量扩展是合适的，但实际上并没有执行显式的内存占用操作。当您尝试时，MATLAB 不知道该怎么做

```
A = magic(3).*rand(1,3) 
```

过去，解决方案是使用 repmat。但是，当您使用 repmat 将向量显式扩展为矩阵时，您会占用大量内存来以向量化方式解决问题。是的，向量化在 MATLAB 中用内存换取时间是很常见的，但如果您的内存已经有限，并且您正在处理一个大问题，这可能是一件坏事。在没有必要的情况下，强制 MATLAB（和您的操作系统）移入虚拟内存是一个非常糟糕的主意。（对于一个小问题，任何解决方案都是可以接受的。）

因此，当您尝试将诸如 magic(3) 之类的数组乘以行向量或列向量时，MATLAB 是否应该理解它应该将向量隐式扩展为数组？或者 MATLAB 是否应该假设您犯了一个错误，并将其标记为这样？这个被称为单例维度扩展的问题就是问题所在。（在向量中找到一个单一维度，其中一个维度是 1。）返回错误消息对许多用户来说是一个好主意，因为这通常表明发现了一个错误，一个错误。简单、自动地扩展所有单件维度以适应手头的问题似乎很危险。事实上，有很多关于如何做的讨论。例如，MATLAB 是否应该创建一个首选项，用户可以在其 MATLAB 版本中启用单例维度的扩展？这将是一个糟糕的主意，

此外，如果修改了基本的 MATLAB 运算符以始终扩展所有单例维度，那么 MATLAB 代码将非常不可移植回旧版本。

我们甚至讨论了创建一组全新的 MATLAB 运算符，例如 .* 与 * 并行存在，以便在扩展单例维度的同时执行操作。这也是一个糟糕的主意，并且正确地避免了。

解决方案是创建 BSXFUN（二进制标量扩展函数）以允许在需要时有效地完成此操作。在文件交换中发现了一个 bsxfun，它允许旧版本的用户获得这种行为，因此尽可能地保持可移植性。BSXFUN 允许您对任何一对参数进行操作，在它们之间应用用户提供的函数。所以它允许你做这样的事情：

```
A = rand(5,1);
B = rand(1,3);
C = bsxfun(@plus,A,B); 
```

创建一个 A 和 B 中元素和的 5x3 矩阵。您也可以使用任何函数作为第一个操作数，因此 BSXFUN 非常强大。

最后，另一种看待 BSXFUN 的方式是作为外部产品的变体。因此，MATLAB 中的这个操作是完美定义的：

```
A = rand(5,1);
B = rand(1,3);
C = A*B; 
```

但是，这些操作中的任何一个

```
D = A-B;
E = A^B; 
```

会产生错误。BSXFUN 允许您有效地完成它们，而不会占用内存的单例维度扩展。

```
D = bsxfun(@minus,A,B);
E = bsxfun(@power,A,B); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T14:12:27.357

也许`vectorize()`是你想要的 ->[代码向量化指南](http://www.mathworks.com/support/tech-notes/1100/1109.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-10T14:47:17.167

您确定问题中包含的代码是正确的吗？这似乎是这样做的：

我假设输入**a**和**d**代表您提到的矩阵**A**（大小 m×n）和**D （大小 m×1）。**由于您将**d**定义为始终具有 1 列，因此 for 循环是不必要的，因为它只会循环一次。**单次循环将简单地将a**的第一行中的值乘以**d**中的第一个值。因此，问题中的整段代码可以替换为以下内容：

```
c = a;
c(1,:) = c(1,:).*d(1); 
```

# javascript - javascript获取网页中选定文本的段落

> ID：845390
> 
> 赞同：21
> 
> 时间：2009-05-10T14:04:39.960
> 
> 标签：javascript, window, document, webpage, paragraph

突出显示文本后，我想获取所选文本所在的段落。

```
var select = window._content.document.getSelection(); 
```

请问有什么指点吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-05-10T14:30:54.440

这实际上很难做到，因为您必须考虑六种情况：

1.  选择不在段落内（简单）；
2.  整个选择在一个段落内（简单）；
3.  整个选择跨越一个或多个同级段落（更难）；
4.  选择以不在段落内的元素开始或结束（更难）；
5.  跨越的段落处于不同的级别，例如一个在列表项中，而另外两个是列表的兄弟（更难）；和
6.  以上的一些组合。

所以首先你必须决定你希望解决方案有多完整。我将只介绍 (1) 和 (2) 的最简单情况。

```
function getSelectedParagraphText() {
  if (window.getSelection) {
      selection = window.getSelection();
  } else if (document.selection) {
      selection = document.selection.createRange();
  }
  var parent = selection.anchorNode;
  while (parent != null && parent.localName != "P") {
    parent = parent.parentNode;
  }
  if (parent == null) {
    return "";
  } else {
    return parent.innerText || parent.textContent;
  }
} 
```

**注意：**如果您也在使用标签，请将 textContent 替换为 innerHTML。

**编辑：**放入更好的版本，包括更好的浏览器兼容性。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-10T14:07:50.960

我发现了这个有用的[例子](http://www.codetoad.com/javascript_get_selected_text.asp)。

似乎有些浏览器支持 window.getSelection() 而其他浏览器支持 document.getSelection()。该示例处理所有这些情况。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-10T14:14:22.443

select.anchorNode.parentNode 将返回父节点，在您的情况下

标记，然后您可以获取该节点的文本。

```
var x = window.getSelection() 
var z = x.anchorNode.parentNode
alert(z.innerHTML) 
```

确保您也查看 window.getSelection() ，因为 document.getSelection 在 Firefox 中已贬值。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-03-31T21:50:40.310

```
$.event.props.push('onTextSelect');
$(document).click(function(){
    var str=window.getSelection().anchorNode.data;
    var str=str.substring(window.getSelection().anchorOffset,window.getSelection().focusOffset);
    if(str)
        $(window.getSelection().focusNode.parentNode).trigger({type:'onTextSelect',text:str});
});

$('p').on('onTextSelect',function(e){
    console.log($(this).attr('class'))
    $('p:last').text(e.text);
}); 
```

html

```
<div><p class="p">some text</p></div>
<p></p> 
```

你可以在这里找到小提琴[https://jsfiddle.net/q9nkc0fd/6/](https://jsfiddle.net/q9nkc0fd/6/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-03-28T22:07:37.957

一个新项目从 jsmatita 诞生： [http](http://takenotes.sourceforge.net/) ://takenotes.sourceforge.net/ （它是意大利语）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-07-20T18:05:54.010

我从@Thiago Souza 的上面的答案中复制了代码，并为此目的创建了一个片段，供那些可以提供正确答案的人使用。

```
function getSelectedParagraph(){
  const selection = window.getSelection();
  let parent = selection.anchorNode;

  while (parent != null && parent.nodeName != "P") {
    parent = parent.parentNode;
  };

  console.log(parent);

  return parent;
};

window.onload = getSelectedParagraph();
```

```
<div class='paragraph-container'>
  <p id='paragraph-01'>
    Paragraph 1: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
  </p>
  <p id='paragraph-02'>
    Paragraph 2: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
  </p>
  <p id='paragraph-03'>
    Paragraph 3: Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
  </p>
</div>
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2021-07-20T14:07:55.697

```
function getSelectedParagraph(){

      const selection = window.getSelection();

      let parent = selection.anchorNode;

      while (parent != null && parent.nodeName != "P") {
          parent = parent.parentNode;
      }

      return parent;

    } 
```

# ruby-on-rails - 可以依赖数据库中的自动递增主键吗？

> ID：845402
> 
> 赞同：5
> 
> 时间：2009-05-10T14:08:58.963
> 
> 标签：ruby-on-rails, database, database-design, primary-key, auto-increment

在我目前的 Rails 应用程序中，我通过按“ `created_at`”字段对模型进行排序来解决调度冲突。但是，我意识到，当从允许这样做的表单中插入多个模型时，所有`created_at`时间都是完全相同的！

这更像是一个最佳编程实践的问题：您的应用程序是否可以依赖数据库中的 ID 列来越来越大地递增，`INSERT`以获得它们的创建顺序？换句话说，我可以按 ID 列对从数据库中提取的一组行进行排序，并确保这是基于创建顺序的准确排序吗？这是我的应用程序中的一个好习惯吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T14:21:52.023

生成的标识号将是唯一的。无论您是使用 PostgreSQL 和 Oracle 中的序列，还是使用其他机制（如 MySQL 的自动增量）。

然而，序列通常是批量获取的，例如 20 个数字。因此，使用 PostgreSQL，您无法确定首先插入哪个字段。插入记录的 id 甚至可能存在间隙。

因此，您不应将生成的 id 字段用于此类任务，以免依赖数据库实现细节。

在命令执行期间生成*创建*或*更新*的字段对于稍后按创建时间或更新时间进行排序要好得多。例如：

```
INSERT INTO A (data, created) VALUES (smething, DATE())
UPDATE A SET data=something, updated=DATE() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T14:12:54.783

这取决于您的数据库供应商。

MySQL 我相信绝对会订购自动增量键。SQL Server 我不确定它是否存在，但我相信它确实存在。

您会遇到问题的地方是不支持此功能的数据库，最值得注意的是使用序列的 Oracle，这些序列是粗略但不是绝对有序的。

另一种方法可能是先创建时间，然后再进行 ID。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T14:34:01.333

我相信您的问题的答案是肯定的...如果我在字里行间阅读，我认为您担心系统可能会重新使用序列中“缺失”的 ID 编号，因此如果您使用了 1， 2,3,5,6,7 作为 ID 号，在我知道的所有实现中，下一个 ID 号将始终为 8（或可能更高），但我不知道有任何数据库会尝试找出该记录 ID #4 丢失，因此请尝试重新使用该 ID 号。

虽然我最熟悉 SQL Server，但我不知道为什么任何供应商都尝试按顺序填补空白 - 想想保留未使用 ID 列表的开销，而不是始终跟踪最后一个 I使用的数字，并加 1。

我想说你可以放心地依赖下一个分配的 ID 编号总是高于上一个 - 不仅仅是唯一的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T14:38:46.780

是的，id 将是唯一的，不，您不能也不应该依赖它进行排序 - 它只是为了保证行的唯一性。正如 emktas 所指出的，最好的方法是使用单独的“更新”或“创建”字段来存储此信息。

要设置创建时间，您可以使用这样的默认值

```
CREATE TABLE foo (
  id INTEGER UNSIGNED AUTO_INCREMENT NOT NULL;
  created TIMESTAMP NOT NULL DEFAULT NOW();
  updated TIMESTAMP;
  PRIMARY KEY(id);
) engine=InnoDB; ## whatever :P 
```

现在，这需要处理创建时间。对于更新时间，我建议使用像这样的 AFTER UPDATE 触发器（当然您可以在单独的查询中执行此操作，但在我看来，触发器是一个更好的解决方案 - 更透明）：

```
DELIMITER $$
CREATE TRIGGER foo_a_upd AFTER UPDATE ON foo
FOR EACH ROW BEGIN
  SET NEW.updated = NOW();
END;
$$
DELIMITER ; 
```

那应该这样做。

编辑：不幸的是我。愚蠢的是，我没有指定这是针对 mysql 的，函数名称（即“NOW”）和其他细微之处可能存在一些差异。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-10T15:08:29.310

EJB 回答的一个警告：

如果您不按列指定顺序，SQL 不提供任何顺序保证。例如，如果您删除了一些早期的行，然后插入它们，那么新的行可能最终会与旧的行在数据库中的相同位置（尽管使用新的 ID），这就是它可以用作默认排序的方式。

FWIW，我通常使用 ID 订单作为 created_at 订单的有效版本。它更便宜，因为它不需要向日期时间字段添加索引（它比简单的整数主键索引更大，因此比简单的整数主键索引更慢），保证是不同的，而且我真的不在乎是否有几行大约在同一时间添加，以稍微不同的顺序排序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-10T20:46:54.447

这可能取决于数据库引擎。我会检查你的数据库是如何实现序列的，如果没有记录的问题，那么我会决定依赖 ID。

例如，除非您使用序列缓存参数，否则[Postgresql 序列是可以的。](http://www.postgresql.org/docs/8.3/static/sql-createsequence.html)

其他程序员可能会手动创建或复制来自具有错误 ID 列的不同数据库的记录。但是我会简化问题。不要担心有人会手动破坏数据完整性的低概率情况。你无法防范一切。

我的建议是依靠序列生成的 ID 并推进您的项目。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-11T14:51:52.443

理论上是的，最高的 id 号是最后创建的。请记住，尽管数据库确实有能力暂时关闭自动生成值的插入，手动插入一些记录，然后再将其重新打开。这些插入通常不用于生产系统，但在从另一个系统移动大量数据时偶尔会发生。

# java - 如何在 Mac 上创建一个 JFileChooser 让用户创建目录？

> ID：845403
> 
> 赞同：4
> 
> 时间：2009-05-10T14:09:07.107
> 
> 标签：java, macos, swing, jfilechooser

我有一个安装程序，可让用户选择要安装的目录。MacOS 上的 JFileChooser 实现使用原生对话框（或者至少看起来是原生的）。那太棒了。

唯一的问题是无法从此对话框中创建目录......您只能选择一个预先存在的目录，这很笨重。有没有办法获得这个功能？

我在“仅选择目录”模式下使用 JFileChooser。因此，它与具有该功能的通常 MacOS 文件选择器不同。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-10T14:48:10.413

没错，showOpenDialog 方法不会为您提供创建新文件夹的选项。这是一个可用性问题，因为打开不存在的东西实际上没有意义。如果您使用 showSaveDialog 将有一个按钮“新建文件夹”或类似的按钮。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-31T12:27:21.167

```
public static void main(String[] args) {
    JFrame frame = new JFrame();
    FileDialog d = new FileDialog(frame);
    d.setVisible(true);
} 
```

# python - 当传递一个可以是文件名、URL 或要处理的实际数据的字符串时，规范/惯用语“做我的意思”

> ID：845408
> 
> 赞同：2
> 
> 时间：2009-05-10T14:11:21.087
> 
> 标签：python

公开一个通用“opener”函数的 Python 库并不少见，它接受一个字符串作为其主要参数，该字符串可以表示本地文件名（它将打开和操作）、URL（它将下载和操作） on）或数据（它将对其进行操作）。

这是[Feedparser 的一个示例](http://code.google.com/p/feedparser/source/browse/trunk/feedparser/feedparser.py#2609)。

我的问题是：是否有标准的“正确”方式来做到这一点？或者，实现该功能的模块（可能作为装饰器）？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-10T14:18:51.587

最终，任何实现此行为的模块都将解析字符串。并根据结果行事。例如，在 feedparser 中，他们正在解析 url：

```
if urlparse.urlparse(url_file_stream_or_string)[0] in ('http', 'https', 'ftp'):
    # do something with the url
else:
    # This is a file path
    return open(url_file_stream_or_string) 
```

这是一个很好的装饰器，可以为你做这件事：

```
import urlparse, urllib

def opener(fun):
    def wrapper(url):
        if urlparse.urlparse(url)[0] in ('http', 'https', 'ftp'):
            return fun(urllib.urlopen(url))
        return fun(open(url))
    return wrapper

@opener
def read(stream):
   return stream.read()

read('myfile')
read('http://www.wikipedia.org') 
```

# c++ - 在 C 程序中调用 C++ 共享库...如何管理？

> ID：845414
> 
> 赞同：1
> 
> 时间：2009-05-10T14:13:12.910
> 
> 标签：c++, c

我想为 C++ 框架编写一个包装器。这个框架有点问题，而且在 C++ 中不是很好。所以我希望能够通过仅使用一个共享库从其框架的外部（通过良好的旧 C 文件）调用他们的方法。这听起来像是需要一个包装器来封装所需的框架方法，以便与 C 而不是 C++ 一起使用。

到目前为止一切顺利......这是我已经做过的：

**接口 aldebaran.h** （这是在我的包含文件夹中，应该从框架外部调用超声波方法）：

```
#ifndef _ALDEBARAN_H
#define _ALDEBARAN_H

#ifdef __cplusplus
 extern "C" {
#endif

void subscribe_ultrasound();
void unsubscribe_ultrasound();
float read_ultrasound();

#ifdef __cplusplus
}
#endif

#endif 
```

现在包装器：

**cpp 文件 aldebaran.cpp:**

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#include "aldebaran.h"
#include "alproxy.h"
#include "../../include/aldebaran.h"

/*
 * Ultrasound defines
 */
#define ULTRASOUND_RESERVATION_MAGIC  "magic_foobar"

#define ULTRASOUND_POLL_TIME          250
#define ULTRASOUND_READ_ATTEMPTS      50
#define ULTRASOUND_SLEEP_TIME         20

using namespace std;
using namespace AL;

/*
 * Framework proxies
 */
ALPtr<ALProxy> al_tts;
ALPtr<ALProxy> al_led;
ALPtr<ALProxy> al_motion;
ALPtr<ALProxy> al_mem;
ALPtr<ALProxy> al_us;
ALPtr<ALProxy> al_cam;
ALPtr<ALProxy> al_dcm;

/*
 * Constructor
 */
Aldebaran::Aldebaran(ALPtr<ALBroker> pBroker, std::string pName): ALModule(pBroker, pName)
{
    try {
        al_tts    = this->getParentBroker()->getProxy("ALTextToSpeech");
        al_led    = this->getParentBroker()->getProxy("ALLeds");
        al_motion = this->getParentBroker()->getProxy("ALMotion");

        al_mem    = this->getParentBroker()->getProxy("ALMemory");
        al_us     = this->getParentBroker()->getProxy("ALUltraSound");
        al_cam    = this->getParentBroker()->getProxy("NaoCam");
        al_dcm    = this->getParentBroker()->getProxy("DCM");
    }catch(ALError& err){
        std::cout << "XXX: ERROR: " << err.toString() << std::endl;
        return 1;
    }

    printf("XXX: module aldebaran initiated\n");
    fflush(0);
}

/*
 * Destructor
 */
Aldebaran::~Aldebaran()
{
    printf("XXX: module aldebaran destructed\n");
    fflush(0);
}

/*
 * Subscribe to ultrasound module
 */
void subscribe_ultrasound()
{
    ALValue param;

    param.arrayPush(ULTRASOUND_POLL_TIME);
    al_us->callVoid("subscribe", string(ULTRASOUND_RESERVATION_MAGIC), param);

    printf("XXX: ultrasound subscribed: %s\n", ULTRASOUND_RESERVATION_MAGIC);
    fflush(0);
}

/*
 * Unsubscribe to ultrasound module
 */
void unsubscribe_ultrasound()
{
    al_us->callVoid("unsubscribe", string(ULTRASOUND_RESERVATION_MAGIC));

    printf("XXX: ultrasound unsubscribed: %s\n", ULTRASOUND_RESERVATION_MAGIC);
    fflush(0);
}

/*
 * Read from ultrasound module
 */
float read_ultrasound()
{
    int i;
    float val1, val2;
    float val_sum;
    ALValue distance;

    val_sum = .0f;

    for(i = 0; i < ULTRASOUND_READ_ATTEMPTS; ++i){
        SleepMs(ULTRASOUND_SLEEP_TIME);

        distance = al_mem->call<ALValue>("getData", string("extractors/alultrasound/distances"));
        sscanf(distance.toString(AL::VerbosityMini).c_str(),"[%f, %f, \"object\"]", &val1, &val2);

        val_sum += val1;
    }

    return val_sum / (1.f * ULTRASOUND_READ_ATTEMPTS);
} 
```

**aldebaran.cpp 的定义文件：**

```
#ifndef ALDEBARAN_API_H
#define ALDEBARAN_API_H

#include <string>

#include "al_starter.h"
#include "alptr.h"

using namespace AL;

class Aldebaran : public AL::ALModule
{
    public:
        Aldebaran(ALPtr<ALBroker> pBroker, std::string pName);

        virtual ~Aldebaran();

        std::string version(){ return ALTOOLS_VERSION( ALDEBARAN ); };

        bool innerTest(){ return true; };
};

#endif 
```

所以这应该是我的包装器的一个简单示例，它可以很好地编译为 libaldebaran.so。

**现在我在 C 中的测试程序：**

...现在我想从一个简单的 c 文件中调用接口 aldebaran.h 方法，如下所示：

```
#include <stdio.h>

/*
 * Begin your includes here...
 */

#include "../include/aldebaran.h"

/*
 * End your includes here...
 */

#define TEST_OKAY    1
#define TEST_FAILED  0

#define TEST_NAME "test_libaldebaran"

unsigned int count_all = 0;
unsigned int count_ok  = 0;

const char *__test_print(int x)
{
    count_all++;

    if(x == 1){
        count_ok++;

        return "ok";
    }

    return "failed"; 
}

/*
 * Begin tests here...
 */

int test_subscribe_ultrasound()
{
    subscribe_ultrasound();

    return TEST_OKAY;
}

int test_unsubscribe_ultrasound()
{
    unsubscribe_ultrasound();

    return TEST_OKAY;
}

int test_read_ultrasound()
{
    float i;

    i = read_ultrasound();

    return (i > .0f ? TEST_OKAY : TEST_FAILED);
}

/*
 * Execute tests here...
 */

int main(int argc, char **argv)
{
    printf("running test: %s\n\n", TEST_NAME);

    printf("test_subscribe_ultrasound:    \t %s\n", __test_print(test_subscribe_ultrasound()));
    printf("test_read_ultrasound:         \t %s\n", __test_print(test_read_ultrasound()));
    printf("test_unsubscribe_ultrasound:  \t %s\n", __test_print(test_unsubscribe_ultrasound()));

    printf("test finished: %s has %u / %u tests passed\n\n", TEST_NAME, count_ok, count_all);

    return (count_all - count_ok);
} 
```

我怎样才能设法调用这些方法？我的意思是在我的 C 文件中，我不可能创建这样一个对象实例（生成所有需要的 ALProxies），对吗？

非常感谢您的帮助...谢谢

* * *

到目前为止非常感谢！

正如 xtofl 所说.. 我想让我的界面尽可能简单（最好不要另一个 c++ 对象）：

```
#ifndef _ALDEBARAN_H
#define _ALDEBARAN_H

#ifdef __cplusplus
 extern "C" {
#endif

void subscribe_ultrasound();
void unsubscribe_ultrasound();
float read_ultrasound();

#ifdef __cplusplus
}
#endif

#endif 
```

这里的问题是，如果没有所有代理的实例化，就无法调用像*subscribe_ultrasound()这样的函数......这是我们的先决条件：*

```
...
        al_tts    = this->getParentBroker()->getProxy("ALTextToSpeech");
        al_led    = this->getParentBroker()->getProxy("ALLeds");
        al_motion = this->getParentBroker()->getProxy("ALMotion");

        al_mem    = this->getParentBroker()->getProxy("ALMemory");
        al_us     = this->getParentBroker()->getProxy("ALUltraSound");
        al_cam    = this->getParentBroker()->getProxy("NaoCam");
        al_dcm    = this->getParentBroker()->getProxy("DCM");
... 
```

如果我没有调用上面的代码，所有其他代码都会失败。

在他们的框架内，可以通过如下调用的 python 脚本“自动加载”我的 libaldebaran.so：

```
myModule = ALProxy("Aldebaran",  global_params.strRemoteIP, global_params.nRemotePort ); 
```

然后框架日志说：

```
May 10 15:02:44 Hunter user.notice root: XXX: module aldebaran initiated
May 10 15:02:46 Hunter user.notice root: INFO: Registering module : 'Aldebaran'
May 10 15:02:46 Hunter user.notice root: ______ End of loading libraries ______ 
```

这完全没问题......它调用了我的模块的构造函数（所以所有其他需要的代理也被实例化了）。

但当然这个实例不属于我的 C 程序......

也许有可能将其分享给所有其他进程？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-10T14:45:51.193

您可能希望采取稍微不同的方法。为你的 C 接口考虑这样的事情：

```
#ifdef __cplusplus
extern "C" {
#endif

struct UltrasoundHandle;

UltrasoundHandle* ultrasound_Create();
void ultrasound_Destroy(UltrasoundHandle *self):
void ultrasound_Subscribe(UltrasoundHandle *self);
void ultrasound_Unsubscribe(UltrasoundHandle *self);
float ultrasound_Read(UltrasoundHandle *self);

#ifdef __cplusplus
}
#endif 
```

该`UltrasoundHandle`结构是故意不透明的，因此您可以在实现中将其定义为您想要的任何内容。我所做的另一项修改是添加类似于构造函数和析构函数的显式创建和销毁方法。实现看起来像：

```
extern "C" {

struct UltrasoundHandle {
    UltrasoundHandle() {
        // do per instance initializations here
    }
    ~UltrasoundHandle() {
        // do per instance cleanup here
    }
    void subscribe() {
    }
    void unsubscribe() {
    }
    float read() {
    }
};

static int HandleCounter = 0;

UltrasoundHandle* ultrasound_Create() {
    try {
        if (HandleCounter++ == 1) {
            // perform global initializations here
        }
        return new UltrasoundHandle;
    } catch (...)  {
        // log error
    }
    return NULL;
}

void ultrasound_Destroy(UltrasoundHandle *self) {
    try {
        delete self;
        if (--HandleCounter == 0) {
            // perform global teardown here
        }
    } catch (...) {
        // log error
    }
} 
```

为 C 包装 C++ 接口的关键是通过自由函数公开 OO 概念，其中调用者将对象指针 ( `this`) 显式传递给函数，并以相同的方式显式公开构造函数和析构函数。包装代码几乎可以从那里机械地生成。其他关键点是永远不要让异常向外传播并避开全局对象实例。我不确定后者是否会让您感到悲伤，但我会担心施工/破坏订购问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T14:42:59.040

您说自己要围绕 OO 框架创建一个 C 包装器 API。

这意味着您不需要任何传递包装器 API 的对象（从描述的标头中显示）。似乎所有需要的对象都是在包装 API 后面创建/销毁的，在您的测试程序之外。

第一个似乎是这样。您不需要对象来测试您的包装 API。最后，所有对象都是通过一组固定函数访问的字节（在内存中）。函数是写成成员函数 (C++) 还是普通的 C 函数并不重要，只要它们遵守对象的预期语义即可。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T15:23:06.007

我不清楚你是否知道这一点，但如果你有 C++ 代码动态加载到你的程序中，那么你应该将你的程序与 C++ 编译器链接起来，并使你的主函数也成为 C++ 函数——即使它是微不足道：

```
int main(int argc, char **argv)
{
    return(real_main_in_c(argc, argv));
} 
```

该`real_main_in_c()`函数就是您之前调用的函数`main()`；它只是被重命名了。这确保了用于处理全局和静态变量等初始化的 C++ 机制被加载并运行。C++ 启动代码比 C 启动代码做更多的工作。动态加载 C

这只是答案的一个（小）方面 - 但它是一个重要的实用方面。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T15:52:03.547

让事情尽可能简单 - 但不是更简单。我认为您在这里试图使其过于简单，将其全部包装起来，但使用 c++ 编译器。

因此，如果您使用 c++ 编译器创建包装器，您可以在订阅函数中实例化对象，在取消订阅中释放它们，全部使用静态（或全局）对象。您想简单公开的 3 个函数用“extern C”包装，并且您有一个向任何调用者公开的 C 样式接口，同时仍然封装 C++ 对象。

如果您需要另一个函数来实例化所有代理，请添加一个；或者，如果它们尚不存在，请创建它们，以便始终在第一次调用订阅时创建它们。

现在，如果您需要基于每个实例的代理对象（即，您有 2 个调用者都想订阅，并且每个调用者都需要一个唯一的代理），那么您必须将对象存储在一个集合中（我建议地图），然后您进行的每个调用都必须传入一个“句柄”或“会话ID”，您可以使用该“句柄”或“会话ID”从地图中提取每次调用的对象。

# encoding - hsqldb 表编码

> ID：845418
> 
> 赞同：1
> 
> 时间：2009-05-10T14:16:05.767
> 
> 标签：encoding, utf-8, character-encoding, hsqldb

如何为特定表设置字符编码？例如：

```
创建表评论（
    ID 整数默认生成为 ID（从 0 开始，按 1 递增）不为空，
    TXT LONGVARCHAR,
    主键 (ID)
)

```

默认情况下，它被编码为 ASCII，但我宁愿为这张表使用 UTF-8。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T15:39:21.283

你确定它默认编码为ASCII吗？我对它的阅读是默认情况下它是 UTF-8，尽管我愿意在这里进行更正。

如果是 TEXT 表，您可以指定表的编码

```
SET TABLE mytable SOURCE "myfile;encoding=UTF-8" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-01-02T01:27:18.890

HSQLDB 当然以 Unicode 存储所有数据（必须指定 UTF-8 的 TEXT 表除外）。因此，您不需要为普通表指定字符编码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-28T14:09:40.583

问题是您必须在导入之前转换所有行。
为此，您必须将内容导出到文件并将文件转换为 utf-8。然后使用 utf-8 选项再次导入。

MyPHPadmin 可以使用 utf-8 选项导入它，（记得检查文件中的 CHARSET=latin1 / latin1）。

你可以阅读更多关于手动操作的信息：[http ://en.gentoo-wiki.com/wiki/Convert_latin1_to_UTF-8_in_MySQL](http://en.gentoo-wiki.com/wiki/Convert_latin1_to_UTF-8_in_MySQL)

# wcf - 使用支持流的 basicHttpBinding 保护 WCF 服务

> ID：845423
> 
> 赞同：13
> 
> 时间：2009-05-10T14:18:37.840
> 
> 标签：wcf, wcf-security

我的问题是关于保护对仅对我们公司内部用户公开的 WCF 服务的访问的最佳（又称“最不痛苦”）方法。目标是确保仅通过我们每个用户安装的单个 Windows 窗体应用程序访问该服务。当服务被调用时，我希望服务能够验证它是从允许的应用程序中调用的。

要保护的服务使用支持流的basicHttpBinding，所以我相信我仅限于传输级别的安全性。

以下是我的服务配置文件中的`<bindings>`和部分的简化版本。`<services>`

```
<bindings>
  <basicHttpBinding>
    <binding name="Service1Binding" transferMode="Streamed"/>    
  </basicHttpBinding>
</bindings>

<services>
    <service name="WCFServiceSecurity.Service1" 
        behaviorConfiguration="WCFServiceSecurity.Service1Behavior">
        <endpoint address=""
            binding="basicHttpBinding"
            contract="WCFServiceSecurity.IService1"
            bindingConfiguration="Service1Binding"/>
        <endpoint address="mex" binding="mexHttpBinding" contract="IMetadataExchange"/>
    </service>
</services> 
```

谁能提供一些详细信息，说明我需要采取哪些措施才能在此服务上实施安全性？

*注意：我是 WCF 新手，完全不熟悉安全性，所以如果我没有提供足够的详细信息，请告诉我。*

* * *

### 更新：

正如[marc_s 所建议的](https://stackoverflow.com/questions/845423/securing-wcf-service-using-basichttpbinding-which-supports-streaming/845640#845640)，我想使用某种用户名/密码机制来保护 WCF 服务。这为答案提供了更多方向，但我对*如何*实际执行此操作仍然有些模糊。

因为我的服务需要启用流式传输，所以我必须使用 basicHttpBinding 和传输级安全性（对吗？）；此外，我的服务中包含的方法只能接受 Stream 对象。

考虑到这些限制以及我使用用户名/密码验证的偏好......

*   我应该如何修改我的服务的配置文件以强制提供用户名/密码凭据？
*   我的服务将如何验证提供的凭据？
*   我的客户端应用程序在拨打电话时如何将凭据传递给服务？
*   这是否需要使用 SSL，如果需要，所有客户端机器是否也需要证书？

* * *

### 更新：

在向我的老板解释了我在保护这项服务方面遇到的麻烦之后，我被允许尝试 Windows 身份验证路由。可悲的是，我在使用我的 Streamed 服务 (argh) 实现这种类型的身份验证时没有运气。在进行适当的更改（如此[处](http://msdn.microsoft.com/en-us/library/cc949012.aspx)所述- 唯一的例外是 my `transferMode="Streamed"`）并访问我的服务后，我收到以下错误：

> HTTP 请求流不能与 HTTP 身份验证结合使用。禁用请求流式传输或指定匿名 HTTP 身份验证。

[然后，我在这里](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/f76011d7-29ba-4d27-9dc4-62ae72ca7721)偶然发现了以下引用，它提供了一些说明：

> **您不能进行传输身份验证。与流媒体。**如果必须使用 HTTP 请求流，则必须在没有安全性的情况下运行。
> 
> 安全工作的方式是：
> 
> WCF 客户端向服务器发出 http 请求。
> 
> 服务器回应说，“你没有被授权，给我一个基本/摘要/等凭证。”
> 
> 客户端收到该响应并重新发送带有附加凭据的消息。
> 
> 现在服务器收到消息，验证凭据，然后继续。请求流不是为使用该安全模式而设计的。如果是这样，那将非常慢，因为客户端将发送整个流，从服务器获取未授权的消息，然后它必须重新发送带有凭据的整个流。

所以现在我正在寻找意见，**您将如何保护启用流式传输的 WCF 服务？**如前所述，某种用户名/密码机制将是首选。随意在这个盒子外面思考......

**非常**感谢任何帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-12T16:25:21.387

好吧，在解决这个问题时，我发现了很多围绕安全/流媒体的问题。我最终采用的 hack（呃……嗯……解决方法）是创建一个新的 DataContract 继承 MemoryStream 并用 BaseStream 属性（用于保存我想要流式传输的数据）以及用于的适当属性简单的身份验证。

这是生成的 DataContract：

```
[DataContract]
[KnownType( typeof( MemoryStream ) )] 
public class StreamWithCredentials : MemoryStream
{
    [DataMember]
    public Stream BaseStream { get; set; }

    [DataMember]
    public string Username { get; set; }

    [DataMember]
    public string Password { get; set; }
} 
```

上面的 DataContract 最终成为我的服务方法的输入参数。我的服务采取的第一个操作是根据已知的有效值对提供的凭据进行身份验证，并酌情继续。

现在我确实**知道**这**不是**最安全的选择，但我的指令是避免在这个内部流程中使用 SSL（*[我](http://social.msdn.microsoft.com/Forums/en-US/wcf/thread/f76011d7-29ba-4d27-9dc4-62ae72ca7721)**什至不确定这是否可能 - 如此处所述*）。

话虽如此，这是我能想出的上述问题的最佳解决方案，希望这可以帮助其他遇到此问题的人。

感谢所有回复的人。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T16:49:18.113

你可以做很多事情：

*   为每台允许使用您的服务的机器添加一个证书，并检查该证书。这只允许您排除“未经授权”的机器 - 您不能将其限制为特定的应用程序
*   与上面相同，但包含嵌入在您的 winforms 应用程序中的证书并从那里发送（不要将其存储在机器的证书存储中）
*   要求只有您的特定应用程序知道并可以传输到您的服务的用户名/密码；例如，其他人将无法出示适当的凭据

编辑 2：好的，所以用户名/密码方法似乎失控了`MessageContract`....在标头中包含特定值，然后仅检查服务中标头中是否存在该元素？

像这样的东西：

```
[DataContract]
class YourRequestData
{
 ...
}

[MessageContract]
public class YourRequest
{
  [MessageBodyMember]
  public YourRequestData bodyData { get; set; }

  [MessageHeader]
  public string AppThumbprint { get; set; }
} 
```

然后在您的服务器上的代码中检查该代码的存在和有效性`AppThumbprint`：

```
public Stream RequestStream(YourRequest request)
{
  if(AppThumbprintIsValid(request.AppThumbprint))
  {
     .... begin your streaming
  }
} 
```

这最终可能比用户名/密码安全方案容易得多。

马克

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-05T21:37:54.297

如果您想使用`basicHttpBinding`（用于互操作），您只能在消息级别传递您的凭据。您必须将安全配置设置为`TransportWithMessageCredential`.

为此，您必须创建一个 SSL 通道，因此您需要在服务器端有一个证书，而客户不需要拥有一个。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-01-30T07:52:52.680

如果我错了，请纠正我，但是：

如果您正在为您的 WCf 服务（在 asp.net 上）使用表单身份验证，只需向您的服务添加一个登录方法，在其中创建所需的 cookie（formsAuthentication.Authenticate()）。它会与响应一起自动发送，然后客户端可以调用流 API 而无需额外的参数（要求它是 STREAM），并且您可以在触发返回流之前检查流 API 中的身份。

至于保护对整个 WCF 的访问，我觉得在 .net 应用程序中嵌入证书是一种方法。他们将不得不 ildump 你的应用程序来获取它。

您可以告诉 asp.net/wcf 不要提供 wsdl，或者更准确地说，不要自动生成 wsdl。如果没有 wsdl 访问权限，他们生成代理会变得更加困难......

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-10-04T12:01:38.403

可以将 Windows 身份验证与 Streaming 和 SSL 一起使用，但您必须使用`TransportWithMessageCredential`：

```
<basicHttpBinding>
    <binding name="FileService.FileServiceBinding" maxReceivedMessageSize="2147483647" maxBufferSize="2147483647" transferMode="Streamed">
        <readerQuotas maxDepth="2147483647" maxStringContentLength="2147483647" maxArrayLength="2147483647" maxBytesPerRead="2147483647" maxNameTableCharCount="2147483647" />
        <security mode="TransportWithMessageCredential">
            <transport clientCredentialType="Windows" />
        </security>
    </binding>
</basicHttpBinding> 
```

您需要在代码中设置`proxy.ClientCredentials.UserName.UserName`和`proxy.ClientCredentials.UserName.Password`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-10T17:17:12.553

如果这将是一个驻留在 Intranet 上的应用程序，那么在 Active Directory 中创建一个新组并仅授予该组的成员使用该服务的能力可能是最简单的。

您可以使用以下内容添加身份验证（使用 Windows 凭据）：

```
<basicHttpBinding> 
 <security mode="TransportCredentialOnly"> 
  <transport clientCredentialType="Windows" /> 
 </security> 
</basicHttpBinding> 
```

然后可以通过将接口装饰到您的服务方法来进行授权：

```
<PrincipalPermission(SecurityAction.Demand, Role:="MyAppsUsers")> _ 
Public Function MyMethod() As String Implements IService.MyMethod 
```

这是 WCF 中安全性的一个很好的链接。最后有很多 How To（标题为“How To - Use basicHttpBinding with Windows Authentication and TransportCreditals”的内容可能对您有用）。
[Wcf 安全](http://www.codeplex.com/WCFSecurityGuide/Release/ProjectReleases.aspx?ReleaseId=15892)

[免责声明：我也是 WCF 的新手，之前没有做过这个确切的案例，所以如果这有点不对劲，我深表歉意！]

# perl - 如何检查 Perl 中是否存在二进制依赖项？

> ID：845431
> 
> 赞同：2
> 
> 时间：2009-05-10T14:23:58.760
> 
> 标签：perl, cpan, binaries

在自愿维护一个停滞的 CPAN 包 (GnuPG) 之后，我想改进安装文件，以便`gpg`在找不到二进制文件（GnuPG 是一个包装器）时它们可以优雅地退出。在从其他软件包中寻求灵感之后，我想出了将其添加到 Makefile.PL 中：

```
my @paths = grep { -x "$_/gpg" } split /:/, $ENV{PATH}, $ENV{PGP_PATH};

unless ( scalar @paths ) {
    print <<EOD;
I can't find the gpg binary on your system. If it's not installed in your usual PATH, set $ENV{PGP_PATH} to include where it can be found and try installing again.
EOD

    exit(0);
}

WriteMakefile(
    'NAME'        => 'GnuPG',
    'VERSION_FROM' => 'GnuPG.pm',
    'EXE_FILES'    => [ gpgmailtunl ],
    'LICENSE'      => 'GPL',
    'LIBS'         => [ @paths ],
); 
```

这看起来很正常吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T15:17:54.933

如果您使用的是 Module::Install 或该系列的一部分，则可以使用 do

```
requires_external_bin 'gpg'; 
```

有关详细信息，请参阅[模块::安装::外部](http://p3rl.org/Module::Install::External)。

没有充分的理由重新发明轮子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T19:29:30.720

File::这将是一个跨平台的解决方案。您需要将它捆绑到 inc/ 目录中，或者要求使用 configure_requires 安装它。对于 EU::MM 可以使用

```
 META_MERGE => {
        configure_requires => {
            'File::Which' => 0, 
```

Module::Install 也是一个很好的解决方案，但是每次发布新版本的 Module::Install 并且更改很重要时，您都需要发布新版本的发行版。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T15:01:26.680

为了获得更好的准确性，您应该查看[File::Which](http://search.cpan.org/dist/File-Which/)或至少使用 File::Spec->path()。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T15:31:44.407

一般概念很好 - 如果您需要工作的内容不存在，请不要创建 makefile。CPAN 测试人员有关于在失败时以零状态退出的规则（这让我很恼火，但没关系；我讨厌以成功状态失败！）。

问题：您是否记录了安装时 PGP 的位置，以便如果其他人使用 Perl 模块而没有路径上的位置，该模块仍然可以运行？

对于 DBD::Informix，我有严格的依赖关系，没有它就无法编译模块；因此，Makefile.PL 本身就是一个主要的产品。它还尝试处理超过 15 年的软件版本；这也使它的生活复杂化。如果先决条件（一些 Perl 模块；一些非 Perl 软件）不可用，则不会安装。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-10T14:29:42.833

打印警告不是更有意义吗？安装本身是否需要 gpg？

代码本身对我来说看起来不错。但也许有一个内置的“哪个”功能。:)。

# c# - 如何删除 DataSet 中的列和不同的行以仅查找组名？

> ID：845434
> 
> 赞同：0
> 
> 时间：2009-05-10T14:27:50.837
> 
> 标签：c#, dataset, distinct, dataview

我有 DataSet，它有 3 列。

```
Name    -    insurance comp. name     -     treatmentDate
Ali Boz      SGK                            12.04.09
Ali Boz      SGK                            14.04.09
Ali Boz      SGK                            16.04.09
Ali Boz      SGK                            18.04.09
Veli Aş      AKBANK                         10.04.09
Veli Aş      AKBANK                         11.04.09
Veli Aş      AKBANK                         12.04.09
Veli Aş      AKBANK                         13.04.09
Cuneyt Sel   ING BANK                       01.05.09
Cuneyt Sel   ING BANK                       02.05.09
Cuneyt Sel   ING BANK                       05.05.09
Cuneyt Sel   ING BANK                       19.05.09 
```

我想首先找到唯一的保险补偿。名字

```
SGK
AKBANK
ING BANK 
```

然后我想按名称和日期排序

但是数据集中的所有这些东西（因为我想从数据库中检索所有行）。

你对我有什么建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T14:44:18.947

不确定您到底要问什么，但要检索保险公司名称，您可以简单地执行以下操作：

```
SELECT DISTINCT [insurance comp. name]
FROM [tablename] 
```

如您所述对所有记录进行排序：

```
SELECT *
FROM [tablename]
ORDER BY [insurance comp. name], [name], [treatmentdate] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T14:44:25.030

如果您可以使用 LINQ，这将为您提供保险公司名称：

```
var Names = (from Row in YourDataSet.YourTable
             select Row.InsuranceCompanyName).Distinct(); 
```

如有必要，您还可以根据需要添加`.ToArray()`或。`.ToList()``orderby`

如果不能使用 LINQ 或更改 SQL 调用，那就[更复杂了](http://www.brybot.ca/archives/select-distinct-from-dataset/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T23:06:22.457

使用 DataView.ToTable 非常简单：

```
DataView view = new DataView(table);
DataTable distinctTable = view.ToTable(true, "insurance comp. name"); 
```

# java - 将jsp表格导出为ex cel、word、pdf

> ID：845439
> 
> 赞同：6
> 
> 时间：2009-05-10T14:31:22.053
> 
> 标签：java, jsp, pdf, ms-word, export-to-excel

任何人都可以建议我任何可以用来将表格导出到 excel/pdf/word 的库/jar 文件。

请告诉我是否有可以在 jsp 中创建报告的库。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-10T21:22:27.587

还应该提到的是，您可以简单地通过输出 HTML 表格并将响应类型设置为`application/vnd.ms-excel`. 不需要任何外部库。

像这样的东西：

```
<%@ page language="java" session="true" %>
<%@ taglib uri="/WEB-INF/tld/response.tld" prefix="res" %>
<res:setHeader name="Content-Type">application/vnd.ms-excel</res:setHeader>
<res:setHeader name="Content-Disposition">attachment; filename=excel-test.xls</res:setHeader>

<table>
    <tr>
        <td>foo</td>
        <td>bar</td>
    </tr>
</table> 
```

*注意：*[此](https://stackoverflow.com/questions/845439/exporting-jsp-tables-to-excel-word-pdf/845455#845455)答案旨在[对此](https://stackoverflow.com/questions/845439/exporting-jsp-tables-to-excel-word-pdf/845444#845444)进行补充，因为它仅涵盖其中一种情况（Excel）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T14:39:58.480

我会说[JasperReports——](http://jasperforge.org/plugins/project/project_home.php?group_id=102)它是[开源](http://sourceforge.net/projects/jasperreports)的——是你最好的选择。它允许您对报告进行一次编码，但可以将其导出为您需要的各种格式。它甚至支持直接将 HTML 流式传输到浏览器，因此它确实是一次代码，可在任何地方使用类型的东西。它还可以通过 JasperServer 很好地扩展。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T14:34:34.797

在每种情况下都是不同的。

*   Excel：使用[JExcelAPI](http://jexcelapi.sourceforge.net/)或[Apache POI](http://poi.apache.org/)；
*   PDF：使用[iText](http://www.lowagie.com/iText/)；
*   词：Apache POI 再次。

至于创建报告，我会改用专门的报告工具，特别是 Jasper Reports。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T21:13:23.950

我认为 itext 仍然更适合创建报告，它更直接，我对 Jasper Reports 有一些（不够）经验，而且看起来很笨拙。OTOH itext 对于开发人员来说*非常*易于使用，我们用它完成了相当大的报告，没有任何问题。

您甚至可以从 itext 创建 rtf（Word 可读）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-08-20T19:14:01.670

如果您正在使用 JSP，您可以尝试使用 displaytag 库，它可以让您导出到所有文件（pdf、excel、csv、xml）。如果需要，您还可以自定义它们或覆盖导出器。

看看这个网址[http://displaytag.sourceforge.net/10/export.html](http://displaytag.sourceforge.net/10/export.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-10T15:09:45.083

如果您的电子表格非常简单，那么导出为 CSV 是可以接受的；它快速且易于编码。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-05-21T12:11:27.923

[Docmosis](http://www.docmosis.com)和[JODReports](http://jodreports.sourceforge.net/)可以从服务器端（JSP、servlet、J2EE 等）生成 PDF 和 DOC。Docmosis 在模板中提供格式/布局，因此您可以减少编码工作，甚至可能让非开发人员维护报表的外观和感觉。两者都是免费的。

# wpf - WPF MVVM：命令很简单。如何使用 RoutedEvent 连接 View 和 ViewModel

> ID：845446
> 
> 赞同：16
> 
> 时间：2009-05-10T14:35:52.177
> 
> 标签：wpf, design-patterns, events, mvvm, command

假设我有一个在资源字典中实现为 DataTempate 的视图。我有一个相应的 ViewModel。绑定命令很容易。但是，如果我的视图包含诸如 ListBox 之类的控件，并且我需要基于列表上正在更改的项目发布应用程序范围的事件（使用 Prism 的事件聚合器），该怎么办。

如果 ListBox 支持命令，我可以将其绑定到 ViewModel 中的命令并发布事件。但是 Listbox 不允许这样的选项。我该如何桥接这个？

编辑：很多很好的答案。

看看这个链接 [http://blogs.microsoft.co.il/blogs/tomershamam/archive/2009/04/14/wpf-commands-everywhere.aspx](http://blogs.microsoft.co.il/blogs/tomershamam/archive/2009/04/14/wpf-commands-everywhere.aspx)

谢谢

爱丽儿

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-05-17T12:49:43.037

我没有尝试将命令绑定到项目更改时，而是以另一种方式看待问题。

如果将 ListBox 的选定项绑定到 ViewModel 中的属性，则当该属性发生更改时，您可以发布事件。这样，ViewModel 仍然是事件的来源，它由项目更改触发，这正是您想要的。

```
<ListBox ItemsSource="{Binding Items}" SelectedItem="{Binding SelectedItem}" /> 
```

...

```
public class ViewModel
{
    public IEnumerable<Item> Items { get; set; } 

    private Item selectedItem;
    public Item SelectedItem
    {
        get { return selectedItem; }
        set
        {
            if (selectedItem == value)
                return;
            selectedItem = value;
            // Publish event when the selected item changes
        }
} 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-05-12T15:01:28.687

扩展控件以支持 ICommandSource 并确定应触发命令的操作。

我使用组合框执行此操作，并使用 OnSelectionChanged 作为命令的触发器。首先，我将在 XAML 中展示如何将命令绑定到我称为 CommandComboBox 的扩展 Control ComboBox，然后我将展示 CommandComboBox 的代码，它将对 ICommandSource 的支持添加到 ComboBox。

1) 在 XAML 代码中使用 CommandComboBox：

在您的 XAML 命名空间声明中包括

```
 xmlns:custom="clr-namespace:WpfCommandControlsLibrary;assembly=WpfCommandControlsLibrary"> 
```

使用 CommandComboBox 代替 ComboBox 并将命令绑​​定到它，如下所示： 请注意，在此示例中，我在我的 ViewModel 中定义了一个名为 SetLanguageCommand 的命令，并且我将此 ComboBox 的选定值作为参数传递给命令。

```
 <custom:CommandComboBox 
    x:Name="ux_cbSelectLanguage"
    ItemsSource="{Binding Path = ImagesAndCultures}"
    ItemTemplate="{DynamicResource LanguageComboBoxTemplate}"           
    Command="{Binding Path=SetLanguageCommand, Mode=Default}"
    CommandParameter="{Binding RelativeSource={x:Static RelativeSource.Self}, Path=SelectedValue, Mode=Default}"
    IsSynchronizedWithCurrentItem="True" 
    HorizontalAlignment="Right" 
    VerticalAlignment="Center" 
    Grid.Column="1" Margin="0,0,20,0" Style="{DynamicResource GlassyComboBox}" ScrollViewer.IsDeferredScrollingEnabled="True"
 /> 
```

2) CommandComboBox 的代码

下面包含文件 CommandComboBox.cs 的代码。我将此文件添加到名为 WpfCommandControlsLibrary 的类库中，并使其成为一个单独的项目，因此我可以轻松地将任何扩展命令添加到需要使用它们的任何解决方案中，因此我可以轻松添加其他 WPF 控件并扩展它们以支持 ICommandSource 接口。

```
using System;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;

namespace WpfCommandControlsLibrary
{
   /// <summary>
   /// Follow steps 1a or 1b and then 2 to use this custom control in a XAML file.
   ///
   /// Step 1a) Using this custom control in a XAML file that exists in the current project.
   /// Add this XmlNamespace attribute to the root element of the markup file where it is 
   /// to be used:
   ///
   ///     xmlns:MyNamespace="clr-namespace:WpfCommandControlsLibrary"
   ///
   ///
   /// Step 1b) Using this custom control in a XAML file that exists in a different project.
   /// Add this XmlNamespace attribute to the root element of the markup file where it is 
   /// to be used:
   ///
   ///     xmlns:MyNamespace="clr-namespace:WpfCommandControlsLibrary;assembly=WpfCommandControlsLibrary"
   ///
   /// You will also need to add a project reference from the project where the XAML file lives
   /// to this project and Rebuild to avoid compilation errors:
   ///
   ///     Right click on the target project in the Solution Explorer and
   ///     "Add Reference"->"Projects"->[Select this project]
   ///
   ///
   /// Step 2)
   /// Go ahead and use your control in the XAML file.
   ///
   ///     <MyNamespace:CustomControl1/>
   ///
   /// </summary>

   public class CommandComboBox : ComboBox, ICommandSource
   {
      public CommandComboBox() : base()
      {
      }

  #region Dependency Properties
  // Make Command a dependency property so it can use databinding.
  public static readonly DependencyProperty CommandProperty =
      DependencyProperty.Register(
          "Command",
          typeof(ICommand),
          typeof(CommandComboBox),
          new PropertyMetadata((ICommand)null,
          new PropertyChangedCallback(CommandChanged)));

  public ICommand Command
  {
     get
     {
        return (ICommand)GetValue(CommandProperty);
     }
     set
     {
        SetValue(CommandProperty, value);
     }
  }

  // Make CommandTarget a dependency property so it can use databinding.
  public static readonly DependencyProperty CommandTargetProperty =
      DependencyProperty.Register(
          "CommandTarget",
          typeof(IInputElement),
          typeof(CommandComboBox),
          new PropertyMetadata((IInputElement)null));

  public IInputElement CommandTarget
  {
     get
     {
        return (IInputElement)GetValue(CommandTargetProperty);
     }
     set
     {
        SetValue(CommandTargetProperty, value);
     }
  }

  // Make CommandParameter a dependency property so it can use databinding.
  public static readonly DependencyProperty CommandParameterProperty =
      DependencyProperty.Register(
          "CommandParameter",
          typeof(object),
          typeof(CommandComboBox),
          new PropertyMetadata((object)null));

  public object CommandParameter
  {
     get
     {
        return (object)GetValue(CommandParameterProperty);
     }
     set
     {
        SetValue(CommandParameterProperty, value);
     }
  }

  #endregion

  // Command dependency property change callback.
  private static void CommandChanged(DependencyObject d,
      DependencyPropertyChangedEventArgs e)
  {
     CommandComboBox cb = (CommandComboBox)d;
     cb.HookUpCommand((ICommand)e.OldValue, (ICommand)e.NewValue);
  }

  // Add a new command to the Command Property.
  private void HookUpCommand(ICommand oldCommand, ICommand newCommand)
  {
     // If oldCommand is not null, then we need to remove the handlers.
     if (oldCommand != null)
     {
        RemoveCommand(oldCommand, newCommand);
     }
     AddCommand(oldCommand, newCommand);
  }

  // Remove an old command from the Command Property.
  private void RemoveCommand(ICommand oldCommand, ICommand newCommand)
  {
     EventHandler handler = CanExecuteChanged;
     oldCommand.CanExecuteChanged -= handler;
  }

  // Add the command.
  private void AddCommand(ICommand oldCommand, ICommand newCommand)
  {
     EventHandler handler = new EventHandler(CanExecuteChanged);
     canExecuteChangedHandler = handler;
     if (newCommand != null)
     {
        newCommand.CanExecuteChanged += canExecuteChangedHandler;
     }
  }
  private void CanExecuteChanged(object sender, EventArgs e)
  {

     if (this.Command != null)
     {
        RoutedCommand command = this.Command as RoutedCommand;

        // If a RoutedCommand.
        if (command != null)
        {
           if (command.CanExecute(CommandParameter, CommandTarget))
           {
              this.IsEnabled = true;
           }
           else
           {
              this.IsEnabled = false;
           }
        }
        // If a not RoutedCommand.
        else
        {
           if (Command.CanExecute(CommandParameter))
           {
              this.IsEnabled = true;
           }
           else
           {
              this.IsEnabled = false;
           }
        }
     }
  }

  // If Command is defined, selecting a combo box item will invoke the command;
  // Otherwise, combo box will behave normally.
  protected override void OnSelectionChanged(SelectionChangedEventArgs e)
  {
     base.OnSelectionChanged(e);

     if (this.Command != null)
     {
        RoutedCommand command = Command as RoutedCommand;

        if (command != null)
        {
           command.Execute(CommandParameter, CommandTarget);
        }
        else
        {
           ((ICommand)Command).Execute(CommandParameter);
        }
     }
  }

  // Keep a copy of the handler so it doesn't get garbage collected.
  private static EventHandler canExecuteChangedHandler;

  }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-05-11T13:11:04.063

一种选择是扩展相关控件并添加对您需要的特定命令的支持。例如，我之前[修改过 ListView](http://kentb.blogspot.com/2006/12/listviewitemactivated-event-in-wpf.html)以支持`ItemActivated`事件和相关命令。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-10T15:47:32.397

嗯，没有人回答。所以我放弃了，将字典之外的视图的实现移到了一个普通的用户控件中，我给他注入了一个对 ViewModel 的引用。

现在，当 ListBox 触发 Event 时，它会调用 ViewModel，从那里一切皆有可能。

爱丽儿

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-12T00:00:26.740

此类问题的一个很好的解决方案来自附加属性的使用。Marlon Grech 通过创建[附加命令行为](http://marlongrech.wordpress.com/2008/12/13/attachedcommandbehavior-v2-aka-acb/)将附加属性的使用提升到了一个新的水平。使用这些可以将 ViewModel 中存在的任何命令绑定到视图中存在的任何事件。

这是我在处理 ListBoxes 的类似问题时经常使用的东西，我希望它们在双击时打开、编辑或执行一些操作。

在这个例子中，我使用的是旧版本的附加命令行为，但效果是一样的。我有一种用于我明确键入的 ListBoxItems 的样式。但是，创建一个应用程序或窗口范围的样式将很容易，该样式应用于所有将命令设置在更高级别的 ListBoxItems。然后，只要附加到 CommandBehavior.Event 属性的 ListBoxItem 的事件触发，它就会触发附加的 Command。

```
<!-- acb is the namespace reference to the Attached Command Behaviors -->
<Style x:Key="Local_OpenListItemCommandStyle">
    <Setter Property="acb:CommandBehavior.Event"
            Value="MouseDoubleClick" />
    <Setter Property="acb:CommandBehavior.Command"
            Value="{Binding ElementName=uiMyListBorder, Path=DataContext.OpenListItemCommand}" />
    <Setter Property="acb:CommandBehavior.CommandParameter"
            Value="{Binding}" />
</Style>

<DataTemplate x:Key="MyView">
<Border x:Name="uiMyListBorder">
<ListBox  ItemsSource="{Binding MyItems}"
          ItemContainerStyle="{StaticResource local_OpenListItemCommandStyle}" />
</Border>
</DataTemplate> 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-03-25T15:16:38.180

我一直在编写行为（附加属性）来做到这一点，但在某些情况下我仍然需要它们。

然而，对于通常情况，只需将事件绑定到命令，如果您安装了 Blend SDK 4，您就可以在 Xaml 中执行所有操作。请注意，您必须添加对 System.Windows.Interactivity.dll 的引用，并重新分发此程序集。

*   [适用于 .NET 4 的 Expression Blend SDK](http://www.microsoft.com/en-us/download/details.aspx?id=10801)
*   [Microsoft SDK](http://msdn.microsoft.com/en-us/dd299405.aspx)（供将来参考）

此示例在触发 Grid 的 DragEnter 事件时在 ViewModel 上调用 ICommand DragEnterCommand：

```
<UserControl xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity" >
    <Grid>
        <i:Interaction.Triggers>
            <i:EventTrigger EventName="DragEnter">
                <i:InvokeCommandAction Command="{Binding DragEnterCommand}" CommandParameter="{Binding ...}" />
            </i:EventTrigger>
        </i:Interaction.Triggers>
    </Grid>
</UserControl> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-10T16:21:44.917

尝试使用[Prism 2](http://compositewpf.codeplex.com/)。

它对命令进行了很好的扩展，并打开了许多新的可能性（比如绑定到可视树的命令）。

# c++ - Winsock 不受控制地产生了几个持久的线程

> ID：845447
> 
> 赞同：1
> 
> 时间：2009-05-10T14:36:52.427
> 
> 标签：c++, winsock

我正在设计一个`WSAEventSelect`用于异步操作的网络框架。由于每个线程最多 64 个事件的限制，我为每 64 个套接字生成一个线程，除了一件事外，一切都按预期工作：

在连接和断开连接期间，Winsock 会不断生成线程，这些线程不会消失。

在框架的当前设计下，当只有几个套接字处于活动状态时，应该运行两个线程。正如预期的那样，总共有两个线程在运行。但是，当我连接几个套接字（1-5 个套接字）时，会产生另外 3 个线程，这些线程会一直持续到我关闭应用程序。此外，当我在任何套接字上失去连接时，会产生另外 2 个线程（也会持续到关闭）。总共有 7 个线程，其中 5 个我不知道它们的用途。

如果 Winsock 需要它们进行连接或其他什么然后消失了，那很好。但令我困扰的是，它们一直持续到我关闭我的应用程序。

有没有人可以对此有所了解？可能是避免这些线程或在没有连接处于活动状态时强制它们关闭的解决方案？

（应用程序是用 Win32 和 Winsock 2.2 用 C++ 编写的）

* * *

**来自 Process Explorer 的信息：**

**预期线程：**
MyApp.exe!WinMainCRTStartup
MyApp.exe!Netfw::NetworkThread::ThreadProc

**意外线程：**
ntdll.dll!RtlpUnWaitCriticalSection+0x2dc
mswsock.dll+0x7426
ntdll.dll!RtlGetCurrentPeb+0x155
ntdll.dll!RtlGetCurrentPeb+0x155
ntdll.dll!RtlGetCurrentPeb+0x155

所有意外线程都有调用堆栈，其中调用了诸如`ntkrnlpa.exe!IoSetCompletionRoutineEx+0x46e`这可能意味着它是通知机制的一部分的函数。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T15:29:52.757

下载 sysinternals 工具[进程浏览](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)器。为 windows安装适当的[调试工具](http://www.microsoft.com/whdc/DevTools/Debugging/default.mspx)。在进程资源管理器中，将选项 -> 符号路径设置为：

```
SRV*C:\Websymbols*http://msdl.microsoft.com/download/symbols 
```

其中 C:\Websymbols 只是存储符号缓存的地方（我会为它创建一个新的空目录。）

现在，您可以使用进程资源管理器检查您的程序。双击进程，转到线程选项卡，它将显示线程从哪里开始、它们有多忙以及它们当前的调用堆栈是什么。

这通常可以让您很好地了解线程是什么。如果它们是 Winsock 内部线程，我不会担心它们，即使有数百个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T16:00:16.253

一个方向（只是猜测）：如果这些是 TCP 连接，这些可能是处理内部 TCP 相关计时器的后台线程。我不知道他们为什么每个连接会使用一个线程，但是必须在那里做一些后台工作*。*

# c# - PostgreSQL 和 C# 数据类型

> ID：845458
> 
> 赞同：65
> 
> 时间：2009-05-10T14:41:31.177
> 
> 标签：c#, postgresql, types

我搜索了 PostgreSQL 和 C# 之间的类型转换表，但我找不到任何东西。如果我有时间，我会研究上表的空单元格。但是如果你知道有这些信息的网页，我很适合你的帮助。

```
Postgre Type --->C# Type

bigint --->Int64

bigserial --->

bit [ (n) ] --->Byte[]

bit varying [ (n) ] --->Byte

boolean --->Boolean

box --->

bytea --->Byte[]

character varying [ (n) ] ---> String

character --->String

cidr

circle 

date --->DateTime

double precision --->Double

inet

integer --->Int32

interval [ (p) ] --->TimeSpan

line 

lseg 

macaddr

money

numeric [ (p, s) ] --->Decimal

decimal [ (p, s) ] --->Decimal

path  

point 

polygon 

real --->Single

smallint --->Int16

serial 

text --->String

time [ (p) ] [ without time zone ] --->

time [ (p) ] with time zone --->

timestamp [ (p) ] [ without time zone ] --->

timestamp [ (p) ] with time zone --->

tsquery 

tsvector 

txid_snapshot

uuid --->Guid

xml 
```

* * *

## 回答 #1

> 赞同：120
> 
> 时间：2009-05-10T14:49:42.300

[也许您可以通过Npgsql](http://www.npgsql.org/doc)的文档找到一些东西 ，它是 PostgreSQL 的 .NET 数据提供程序的实现。

[该文档页面](http://www.npgsql.org/doc/types/basic.html)实际上包含您要查找的内容的完整表格。搜索“4\. Current Npgsql Status” - “支持的数据类型”。有一个很好的表，其中包含所有 PostgreSQL 数据类型及其在 .NET 中的对应关系。

```
Postgresql NpgsqlDbType System.DbType Enum .Net 系统类型
---------- ------------ ------ ---------- ------
int8 Bigint Int64 Int64
bool 布尔值 布尔值 布尔值
bytea Bytea 二进制字节[]
日期日期日期日期时间
float8 双 双 双 双
int4 整数 Int32 Int32
钱 钱 十进制 十进制
数字 数字 十进制 十进制
float4 实单单单
int2 Smallint Int16 Int16
文本 文本 字符串 字符串
时间 时间 时间 日期时间
timetz 时间 时间 日期时间
时间戳 时间戳 日期时间 日期时间
timestamptz TimestampTZ DateTime DateTime
间隔间隔对象时间跨度
varchar varchar String 字符串
inet Inet 对象 IP 地址
位 位 布尔 布尔
uuid Uuid Guid Guid
数组数组对象数组

```

# windows - 使用 OpenCOBOL 进行 Windows GUI 编程？

> ID：845461
> 
> 赞同：4
> 
> 时间：2009-05-10T14:43:08.743
> 
> 标签：windows, user-interface, cobol, gnucobol

我对 COBOL 完全陌生，但我想看看在 Windows 上进行 GUI 编程的不同选项。不过，我不太喜欢 Tcl/Tk。是否有一些资源可以像在 C 中开发 GUI 一样在 COBOL 中开发**Windows GUI ？**

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-15T13:36:11.287

我使用了 MicroFocus 2.0 版，它支持使用事件驱动模型创建 Windows GUI 表单。它们现在是 5.1 版。虽然完整版相当昂贵，但这里有一本书是精简版的学习版：

[http://www.murach.com/books/mcb2/microfocus.htm](http://www.murach.com/books/mcb2/microfocus.htm)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T15:04:57.877

查看[http://www.netcobol.com/](http://www.netcobol.com/)

特别是[http://www.netcobol.com/products/windows/cobol.htm](http://www.netcobol.com/products/windows/cobol.htm)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-04T04:54:45.953

对于 OpenCOBOL，Rildo Pragana 有一个嵌入式 Tcl/Tk 层（TinyCOBOL*的作者*，他为 OpenCOBOL 编译和链接的 TC Tcl/Tk 示例，第一次尝试），但如果你不喜欢 Tcl/Tk，他的工具包几乎可以放置Tk 端的所有 GUI，所以：

*   还有一个 GTK+ 层示例

![来自 OpenCOBOL 的 GTK+，包括回调](https://i.stack.imgur.com/xJ0zD.png)

源代码看起来像：

```
 *> Add a text entry field
   CALL "CBL_OC_GTK_ENTRY_NEW"
       returning gtk-textentry
   END-CALL

  *> Connect code to the text entry, passing the entry widget
   SET callback TO ENTRY "CBL_OC_activate"
   CALL "CBL_OC_G_SIGNAL_CONNECT"
       using by value gtk-textentry
           by reference "activate" & x"00"
           by value callback
           by value gtk-textentry
   END-CALL

   ...

  *> window is ready to show
   CALL "CBL_OC_GTK_WIDGET_SHOW"
       using by value gtk-window
   END-CALL

  *> Start up the event loop, control returned when GTK main exits
   CALL "CBL_OC_GTK_MAIN" END-CALL

  *> Something terminated the GTK main loop, sys-close or bye or
   display "ending..." end-display 
```

*   FLTK 工作，*但我还没有发布试用源代码*。
*   GtkHTML 小部件也可以工作。
*   Gambas COBOL GUI 层托管在 Google 代码上
*   ROOT/CINT 可以解释 OpenCOBOL 生成的 C，然后您可以从 WORKING-STORAGE 获取交互式图形。
*   Qt 测试良好，但 C++ 需要更多，*虽然很薄*，包装源，所以 GTK 是目标。

几乎任何可以被 C 包装的东西，都可以被 OpenCOBOL 调用。这包括本机 Microsoft WinAPI。

在处理常见问题解答时，我发现使用 Vala 确实打开了扩展 COBOL 的领域。由于 OpenCOBOL 和 Vala 都生产中间 C，因此混合潜力几乎是无限的，开发人员可以从任一项目的努力中受益。我建议从 COBOL 中查看 Vala 以供使用。

有关工作示例，请参阅 OpenCOBOL FAQ 第 5 节。[来自http://opencobol.add1tocobol.com/#does-opencobol-support-the-gimp-toolkit-gtk](http://opencobol.add1tocobol.com/#does-opencobol-support-the-gimp-toolkit-gtk)中列出的源代码的屏幕截图

# model-view-controller - 在 JSF 中应该在哪里处理生成图像 URL？

> ID：845468
> 
> 赞同：1
> 
> 时间：2009-05-10T14:46:03.893
> 
> 标签：model-view-controller, jsf

对于大学作业，我正在做一个 JSF webapp 来玩扑克。玩家手中的牌通过图像显示。将卡片套装/等级映射到相关图像的 URL 的“最干净”的方式是什么？

我目前倾向于使用 Card#toString 返回的任何内容，或者在支持 bean 中处理它，只是模型或控制器似乎都不是处理这个问题的“正确”位置。

（这个问题有点主观，但话说回来，每个设计问题也是如此。我正在寻找一些我错过的明显解决方案，而不是讨论。）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T19:21:51.900

如果您反对在支持 bean 中生成 URL，则可以使用[EL 函数](http://java.sun.com/javaee/5/docs/tutorial/doc/bnahq.html#bnaiq)进行翻译：

```
<h:graphicImage value="#{fnlib:getImageUrlFor(myBean.cardInstance)}" /> 
```

这样，您的支持 bean 可以直接返回 card 类实例（我假设它是一个*enum*）并且该函数会将其映射到图像 URL。[您可以在此答案](https://stackoverflow.com/questions/827507/reading-contents-of-a-managed-bean-with-reflection-in-a-jsf-application/829093#829093)中找到如何实现该功能的示例。您*可能*需要查看[FacesContext.getCurrentInstance().getExternalContext()](http://java.sun.com/javaee/5/docs/api/javax/faces/context/ExternalContext.html)如果您想构建一个有效的 URL，无论您的 JSP 相对于图像位于哪个目录（我不记得[h:graphicImage](http://java.sun.com/javaee/javaserverfaces/1.2_MR1/docs/tlddocs/h/graphicImage.html)使用了哪些规则）我的头顶）。

# c# - OpenXml 文件格式设计和最佳实践

> ID：845475
> 
> 赞同：1
> 
> 时间：2009-05-10T14:52:23.377
> 
> 标签：c#, .net, file, openxml, opc

伙计们，

我们一直在使用 System.IO.Packaging 中的 OpenXml API 来创建包含一些 Xml/Binary 文件的包文件，因此包的结构如下：

```
Package/
 -/DataFolder1/an xml file.xml
 -/DataFolder2/another xml file.xml
 -/Bin/other binar files 
```

这已用于应用程序的 1.0 版，并且运行良好。

我们正处于 V2 的规划阶段，预计包结构将发生以下变化：

*   包中可能还有其他文件

*   现有文件的 Xml 模式中可能会有一些修改（例如 ... 新节点）

*   现有文件的 Xml 架构可能会发生一些变化（例如......删除节点或更改数据类型）

我将不胜感激任何基于现实生活经验的建议，以解决文件格式和应用程序本身之间的向后/向前可计算性，因此我们可以让应用程序及其文件格式相互独立地发展。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T15:47:39.573

在不进一步了解您的应用程序的情况下，很难为您提供建议。但是，可以通过添加包含版本号的属性来处理自定义 XML 的不同版本，或者 - 如果架构中有重大更改 - 通过更改命名空间以包含新版本号。

如果您想了解 OpenXML 本身如何处理版本控制和可扩展性，我建议您阅读 OpenXML 规范的第 5 部分：

> [Office Open XML - 第 5 部分：标记兼容性和可扩展性](http://www.ecma-international.org/publications/files/ECMA-ST/Office%20Open%20XML%201st%20edition%20Part%205%20(PDF).zip)

# ruby - macruby：使用 ruby 方法作为 AXObserverCallback

> ID：845479
> 
> 赞同：1
> 
> 时间：2009-05-10T14:56:30.083
> 
> 标签：ruby, cocoa

我试图注意一个文本字段的变化，使用`macruby`.

`AXObserverCreate`需要一个`AXObserverCallback`as 参数。 **如何将 ruby​​ 函数作为回调传递？**

我的功能`AX.m`：

```
+ (AXError) addNotificationWithElement: (AXUIElementRef) element
             forEvent:(CFStringRef) event_type
             callback:(AXObserverCallback) acallback; 
```

这就是我要调用此方法的方式：

`rb_main.rb`：

```
def my_callback *args
  p args
end

p AX.addNotificationWithElement ref,
                      forEvent:'AXValueChange',
                      callback: *** What to write here?*** 
```

将什么传递给`addNotificationWithElement`需要`AXObserverCallback`as 回调参数的函数？

供参考：[Apple 文档`AXObserverCallback`](http://developer.apple.com/documentation/Accessibility/Reference/AccessibilityLowlevel/AXUIElement_h/CompositePage.html#//apple_ref/c/tdef/AXObserverCallback)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-09T16:08:19.817

您应该能够传递任何采用 Apple 文档中给出的参数的`Proc`(或)。`lambda`在这种情况下：

```
proc { |observer, element, notification, refcon| ... } 
```

您可以在示例中使用以下内容（即，如果回调是一种方法）：

```
proc { |*args| my_callback *args } 
```

我没有在`AXObserverCallback`需要的情况下对其进行测试，但这似乎是一般模式。

# math - 基于云台的绘画机的数学编程帮助

> ID：845480
> 
> 赞同：3
> 
> 时间：2009-05-10T14:57:06.087
> 
> 标签：math, printing, vectormath

我是一名参与建造各种计算机控制机器的艺术家。我已经开始制作基于万向节的 XY 绘画机的原型，并且意识到所需的数学运算超出了我的能力范围。我是一个足够体面的程序员，但数学不强。3D 数学。

为了了解我需要做什么，查看装备可能会有所帮助：

早期原型：

![http://roypardi.com/gimble/IMG_2803.JPG](https://i.stack.imgur.com/ZAu76.jpg)

![http://roypardi.com/gimble/IMG_2805.JPG](https://i.stack.imgur.com/FfvLr.jpg)

![http://roypardi.com/gimble/IMG_2806.JPG](https://i.stack.imgur.com/B5Dx4.jpg)

[http://roypardi.com/gimble/gimbleSmall.MOV](http://roypardi.com/gimble/gimbleSmall.MOV) （小视频）

[http://roypardi.com/gimble/gimbleLarge.mov](http://roypardi.com/gimble/gimbleLarge.mov) （更大的视频）

两个内圈代表 X/Y 轴，由步进电机控制。我希望能够同时使用光栅图像和矢量数据（gcode）。所以我需要能够在纸上/从我的数据中找到二维空间中的一个点，并让万向节弄清楚它需要处于什么方向才能到达那里（即每个电机步进多少）。

我一直在寻找 2D > 3D 投影、欧拉角等，但我已经超出了我的深度。任何指针、正确方向的推动或代码片段都将受到欢迎。我可以理解大多数编程语言。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T17:00:11.670

您制作的机器非常好，我希望这对您有用，我相信它是正确的。

我看到它的方式是获得一个角度很简单，但另一个角度稍微难以想象，因为我们已经倾斜了它转动的轴。

我将避免使用 tan，因为在编程时可能会导致除以 0，这可能会令人沮丧。Z 也将是原点在纸上方的高度。

YAxis = arcsin( X / sqrt(X² + Z²))

XAxis = arcsin( Y / sqrt(Y² + X² + Z²))

或者我们可以使用

XAxis = arcsin(Y / sqrt(Y² + Z²))

YAxis = arcsin( X / sqrt(X² + Y² + Z²))

另外，如果可行的话，我非常想看这个绘图的视频。

**编辑：** 在考虑之后，我相信只有一种解决方案会起作用，这取决于哪个轴受另一个影响。Y轴在中间还是X轴？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T15:24:03.680

我认为这是一个简单的问题[http://en.wikipedia.org/wiki/Trigonometry](http://en.wikipedia.org/wiki/Trigonometry)

假设从环的中心到纸上最近的点（我将其称为“原点”的“O”点）的距离是距离 X。

取 O 正北的另一点 P，其与 O 的距离为 Y。

要绘制这一点，您需要角度 alpha 使得 tan(alpha)=Y/X，即您可以使用公式“arctan(Y/X)”计算 alpha [arctan 有时也称为 atan]。Arctan 是一个三角函数，我认为您可能会在通用数学库的 API 中找到它的定义。

以上是最简单的情况。

我能想到的唯一另一种情况是点 P 不是正北时。假设它的距离不是正北，而是 Y1 到北，Y2 到东。解决方案是两个角度（两个环各一个角度），其中一个是“arctan(Y1/X)”，另一个是“arctan(Y2/X)”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T18:03:37.847

也许我误解了，但我不相信云台会做你想做的事。云台可以指向任何 3D 方向，但不能移动到 3D 空间中的任意点。如果纸的平面与云台上的笔扫过的体积相交，笔可能会画一个圆圈，但仅此而已。甚至画一个圆圈也不确定，因为在这种情况下，纸也会与万向环扫过的体积相交；试图调整笔的方向会使一个环撞到纸上。

我认为您想要的是[绘图仪](http://images.google.ca/images?hl=en&um=1&sa=1&q=make+%2Bplotter&btnG=Search+Images&aq=f&oq=)，而不是云台。

# sql - 如何使此查询更有效地检测多个帐户并使用 has_many 玩得好？

> ID：845481
> 
> 赞同：1
> 
> 时间：2009-05-10T14:57:21.640
> 
> 标签：sql, mysql, ruby-on-rails, performance

在我的用户模型中，我想搜索一个用户是否有多个帐户（又名“multis”）。

用户有会话；会话被定制为设置

1.  `creator_id`= 登录会话的第一个用户的 ID，以及
2.  `updater_id`= 会话登录的最后一个用户的 ID

（两列都有索引。）

如果我在保存会话时检测到两者不同，我会保存会话以供后代使用（以及此查询），因为这意味着用户以一个身份登录，然后以另一个身份登录 - 也就是他们是一个多. （为了捕捉递归基本情况，`creator_id`然后在当前会话中重置。）

这是执行此操作的代码：

```
class Session < ActiveRecord::SessionStore::Session
  attr_accessor :skip_setters

  before_save :set_ip
  before_save :set_user

    def set_user
      return true if self.skip_setters
      # First user on this session
      self.creator_id ||= self.data[:user_id] 
      # Last user on this session
      self.updater_id = self.data[:user_id] if self.data[:user_id] 
      if self.creator_id and self.updater_id and 
       self.creator_id != self.updater_id
        logger.error "MULTI LOGIN: User #{self.creator.login} and \
          #{self.updater.login} from #{self.ip}"

        # Save a copy for later inspection
        backup = Session.new {|dup_session| 
          dup_session.attributes = self.attributes
          # overwrite the session_id so we don't conflict with the 
          # current one & it can't be used to log in
          dup_session.session_id = ActiveSupport::SecureRandom.hex(16)
          dup_session.skip_setters = true
        }
        backup.save

        # Set this session to be single user again.
        # Updater is what the user looks for;
        # creator is the one that's there to trigger this.
        self.creator_id = self.updater_id
      end
    end

  # etc... e.g. log IP
end 
```

以下查询确实有效。

但是，它很丑陋，效率不高，并且不能很好地与 Rails 的关联方法配合使用。请记住，会话是一个非常大且使用率很高的表，用户几乎一样多。

我想将其更改为 has_many 关联（以便所有关联魔法都起作用）；可能是`:through =>`一个`:multi_sessions`协会。它应该捕捉多重性的两个方向，而不仅仅是像当前的关联那样。

如何改进？

```
class User < ActiveRecord::Base
 has_many :sessions, :foreign_key => 'updater_id'

 # This association is only unidirectional; it won't catch the reverse case
 # (i.e. someone logged in first as this user and then as the other)
 has_many :multi_sessions, :foreign_key => 'updater_id', 
  :conditions => 'sessions.updater_id != sessions.creator_id',
  :class_name => 'Session'
 has_many :multi_users, :through => :multi_sessions,
  :source => 'creator', :class_name => 'User'

 ...

 # This does catch both, but is pretty ugly :(
 def multis
  # Version 1
  User.find_by_sql "SELECT DISTINCT users.* FROM users \
    INNER JOIN sessions \
      ON (sessions.updater_id = #{self.id} XOR sessions.creator_id = {self.id}) AND \
         (sessions.updater_id = users.id XOR sessions.creator_id = users.id) \
    WHERE users.id !=  #{self.id}"
  # Version 2
  User.find(sessions.find(:all, :conditions => 'creator_id != updater_id', 
    :select => 'DISTINCT creator_id, updater_id').map{|x|
      [x.creator_id, x.updater_id]}.flatten.uniq - [self.id])
 end
end 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-02-27T18:44:13.963

我认为您试图解决的会话重用问题是一个奇怪的问题。通过处理日志以检测 sock-puppet 或具有多个帐户的用户，您最好将 IP 映射到唯一登录名。有更可靠和更简单的方法来解决您的问题。

# unit-testing - FluentNhibernate 和 SQLite

> ID：845490
> 
> 赞同：5
> 
> 时间：2009-05-10T15:05:40.343
> 
> 标签：unit-testing, nhibernate, sqlite, fluent-nhibernate, system.data.sqlite

我无法让 SQLite 驱动程序在我的 sessionfactory 中工作。

[我从http://sqlite.phxsoftware.com/](http://sqlite.phxsoftware.com/)下载了 SQLite 1.0.48

我在我的测试项目中添加了对 System.Data.SQLite 的引用。

```
public static IPersistenceConfigurer GetSqlLiteConfigurer()
        {
            try
            {
                return SQLiteConfiguration
                .Standard
                .InMemory();
            }
            catch (Exception ex)
            {
                throw ex;
            }
        } 
```

这就是我生成配置器的方式

问题是当我构建我的 sessionfactory 时，我收到以下错误：

```
NHibernate.HibernateException: The IDbCommand and IDbConnection implementation in the assembly System.Data.SQLite could not be found. Ensure that the assembly System.Data.SQLite is located in the application directory or in the Global Assembly Cache. If the assembly is in the GAC, use <qualifyAssembly/> element in the application configuration file to specify the full name of the assembly.
at NHibernate.Driver.ReflectionBasedDriver..ctor(String driverAssemblyName, String connectionTypeName, String commandTypeName)
at NHibernate.Driver.SQLite20Driver..ctor() 
```

我试图更改 SQLite 版本，但没有解决问题。

我找不到问题所在，我已经为此工作了 2 天。

如果您需要更多信息，请与我们联系。

谢谢您的帮助！

查尔斯

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-06-02T14:48:05.380

当我遇到这个问题时，它是由运行将我的应用程序的处理器属性设置为 anycpu 并在 64 位系统上运行引起的。为了纠正这个问题，我将我的应用程序处理器属性设置为 x86。我不认为 System.Data.SQLite.dll 支持在 x64 进程下运行。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-10T15:11:32.320

我通过获取 FluentNHibernate SVN 存储库中的 System.Data.SQLite.dll 文件解决了我的问题。

这现在工作得很好。

我应该早点检查一下；）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-20T17:57:30.317

检查您是否使用 4.0 作为目标框架。ADO 驱动程序当前 (1.0.66) 仅支持 3.5。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-03T13:08:45.980

我在构建机器上遇到了同样的问题。当我使用 Visual Studio 打开项目时它工作正常，但是当我运行 mstest.exe 时它会因上述错误而失败。当我通过命令行运行时，它在我的本地开发机器上也失败了。进程监视器显示甚至没有尝试通过 mstest.exe 定位文件。

构建机器是 32 位的，我的本地机器是 64 位的。我们使用的程序集来自 Fluent NHibernate 主干。

更新：想通了 - mstest.exe 在从命令行运行时并没有复制所有程序集。我更新了 localtestrun.config 以将它们包含在部署下。不确定为什么行为与 IDE 和命令行测试运行程序不同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-20T14:56:26.700

应该使用 Microsoft 提供的最新 NuGet 包解决此问题。

```
PM> Install-Package SQLitePCL 
```

[https://www.nuget.org/packages/SQLitePCL/3.8.2](https://www.nuget.org/packages/SQLitePCL/3.8.2)

[http://msopentech.com/blog/2014/02/03/new-open-source-portable-class-library-sqlite/](http://msopentech.com/blog/2014/02/03/new-open-source-portable-class-library-sqlite/)

# java - 使用 POI 将表格导出到 excel/word

> ID：845492
> 
> 赞同：0
> 
> 时间：2009-05-10T15:06:43.680
> 
> 标签：java, jsp

我希望代码使用 POI 将表格/报告导出到 Excel 和 Word。我看到了 POI 附带的示例，但无法理解。谁能给我一个小/简单的代码来做同样的事情。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T20:43:44.233

看到你想要使用 POI 的实际代码。这里有一些做一些导出：

```
import java.util.Date;
import java.util.List;
import java.util.ListIterator;
import java.util.StringTokenizer;
import java.io.*;
import org.apache.poi.hssf.usermodel.*;

public class XLSExporter implements Exporter {

    /**
     * Constructor for XLSExporter
     */
    public XLSExporter(){
    }

    public void exportFile( File f, List o ) throws IOException{

        HSSFWorkbook wb = new HSSFWorkbook();
        FileOutputStream fileOut = new FileOutputStream(f);

        HSSFSheet sheet = wb.createSheet();

        ListIterator it = o.listIterator();

        //Construct the headings
        HSSFRow headingsRow  = sheet.createRow((short)0); 

        //Heading format
        HSSFFont headingFont = wb.createFont();
        headingFont.setBoldweight(HSSFFont.BOLDWEIGHT_BOLD);
        HSSFCellStyle headingStyle = wb.createCellStyle();
        headingStyle.setAlignment(HSSFCellStyle.ALIGN_CENTER);
        headingStyle.setFont(headingFont);

        HSSFCell headingA = headingsRow.createCell((short)0);
        headingA.setCellValue("Heading");
        headingA.setCellStyle(headingStyle);

        int i = 1;
        // Iterate over the rows
        while(it.hasNext()){

            //Create the row
            HSSFRow row  = sheet.createRow((short)i); 

            //Write data
            HSSFCell cellRunway = row.createCell((short)0);
            cellRunway.setCellType(HSSFCell.CELL_TYPE_NUMERIC);
            cellRunway.setCellValue("Whateva");             
            cellRunway.setCellStyle(standardStyle);

            i++;
        }

        //Set the column widths where needed
        sheet.setColumnWidth((short)1, (short)4000); 

        wb.write(fileOut); // Write the workbook
        fileOut.close();
    }

} 
```

# c# - 在 C# 中使用 Python 对象

> ID：845502
> 
> 赞同：6
> 
> 时间：2009-05-10T15:11:45.267
> 
> 标签：c#, python, ironpython

有没有一种从 C# 调用 Python 对象的简单方法，即没有任何 COM 混乱？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-10T15:14:10.210

是的，通过托管 IronPython。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-10T15:16:31.723

在当前发布的 C# 版本中，如果不使用某种桥接层，就没有很好的方法来实现这一点。您可以在一定程度上托管 IronPython，但由于 C# 是一种非常静态类型的语言，因此很难利用 IronPython 的动态特性

不过，如果您说的是 IronPython，C# 4.0 将能够与它无缝交互。C# 4.0 引入了一个名为dh dynamic 的新功能，它允许它与在 DLR 上运行的任何语言一起工作。

```
dynamic d = GetSomePythonObject();
d.SomeMethod(); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-10T15:18:32.250

我知道3种方法：

1）使用 Iron Python，你的 Python 项目可以与 C# 编写的项目自由交互。

2) 将您的 Python 函数公开给 COM。如果您需要使用不想或无法转换为 Iron Python 的 Python 库（例如，如果您只有一个 DLL），您会这样做。“COM 混乱”并不是那么糟糕，如果您的Python 代码和 C# 代码在同一台机器上运行。[本教程](http://www.devshed.com/c/a/Python/Windows-Programming-in-Python-Creating-COM-Servers/3/)中的这段代码表明它并不过分难看：

```
class PythonUtilities:
  _public_methods_ = [ 'SplitString' ]
  _reg_progid_ = "PythonDemos.Utilities"
  # NEVER copy the following ID
  # Use "print pythoncom.CreateGuid()" to make a new one.
  _reg_clsid_ = "{41E24E95-D45A-11D2-852C-204C4F4F5020}"

  def SplitString(self, val, item=None):
    import string
    if item != None: item = str(item)
    return string.split(str(val), item)

# Add code so that when this script is run by
# Python.exe, it self-registers.
if __name__=='__main__':
  print "Registering COM server..."
  import win32com.server.register
  win32com.server.register.UseCommandLine(PythonUtilities) 
```

3) 让 C# 和 Python 通过套接字进行通信。如果您有无法转换为 Iron Python 的代码并且需要远程访问它，您会这样做。这需要最多的工作，因为您需要编组和解组参数并从字节或字符串返回值，但当我们需要让 C# 与远程 Python 进程对话时，这是我的一个团队所做的。

# database-design - 大型 Web 应用程序的数据库架构

> ID：845503
> 
> 赞同：7
> 
> 时间：2009-05-10T15:11:53.380
> 
> 标签：database-design, web-applications, saas

许多 SaaS Web 应用程序服务都有基于公司的概念。因此，每家使用该服务的公司都有自己的一组用户、文件和其他数据。Web 应用程序通常如何在数据库端处理这个问题？他们是否为每个公司创建了一个新数据库（包含与该公司相关的数据表）？或者他们是否有某种 company_id 关系来从单个数据库中选择相关数据？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-10T16:43:33.377

几个月前，我们在一个经常被组织使用的产品中遇到了这个问题，而这些组织又为多个客户提供服务。他们来找我们，要求我们修改我们的 SaaS 系统，以便他们可以为他们的每个客户创建完整的、离散的网站（我们构建了一个在线的、特定于域的网站构建工具）。

一个简短的总结：将每个人都放在一个数据库上似乎很明显，但是随着您的深入研究，您会发现它并不总是一成不变的。在进行过程中，您需要牢记一些挑战。几点：

首先，仅将“Company_id”添加到几个表是不够的。事实上，尽管 Sai 评论说为每家公司拥有一个数据库/应用程序是荒谬的，但由于为多个离散客户托管 SaaS 系统的潜在复杂性，这绝对是有道理的。如果您只是*为*几家不同的公司提供服务（例如为他们创建发票），那么 Sai 的评论是完全正确的。但是，如果您要向多个组织提供软件应用程序，则复杂性要高得多，并且可能需要使用离散的数据库。

其次，为多客户端数据库中更复杂的用户查询和报告工作做好准备。例如，在构建我们的用户查询功能时，我们必须绝对确定组织之间不会存在“渗透”，因为其中涉及受 HIPAA 保护的数据。这意味着查询和报告功能需要的工程水平远远超过以前的水平。在我们的例子中，我们的查询功能非常灵活，基本上允许用户动态构建查询（显然，受到一些非常严格的约束 - 我们不接受 SQL！）。因此，我们必须确保每个查询都被自动修改为适当地使用“Company_ID”约束，无论数据的来源或提交查询的工作人员的权限如何。皱纹？我们的“超级用户”分析帐户必须能够在没有这种约束的情况下运行查询......

第三，您可能还没有预料到需要分离多少东西。例如，我在站点中构建了一个非常复杂的“设置”对象，该对象在启动时从数据库中提取设置并将它们维护在“应用程序”对象中（这是一个 .NET 应用程序）。这一切都需要浮动以处理多个组织。

再举一个例子，过去对我们来说是唯一的字段（例如登录名）现在必须作为 Company_ID、LoginID 键的一部分来完成。如果您是从头开始构建，这不是一个好主意，但我们正在改造，所以它是。

无论如何，当我进行构建时，我惊讶地发现要做到这一点需要做多少工作。

第四，我总是使用“元编程”方法构建软件。也就是说，我很少构建一个单一用途的页面，而是经常构建一个高度可定制的框架，以便于最终用户定制和内部代码重用。虽然我预计这将有助于过渡到多组织数据库，但它通常没有！因为这样的编码通常一开始就相当复杂，所以浮动组织通常比我只有一个普通网页更困难。

最后，如果不需要共享数据（例如分析整体使用模式），那么您可能只想坚持使用离散数据库以促进扩展。当您添加新的多组织数据库（第二个离散系统）时，我们的扩展通常涉及突然经历增长激增的*现有客户。*将它们从现有数据库中剥离并转移到新服务器上比仅仅移动到具有现有数据库的新服务器上要困难一些。

有了所有这些警告，您可能会认为我会建议您不要构建能够在单个数据库上处理多个组织的系统。然而，情况并非如此：采用多组织方法确实取得了一些成功！使用分析、跨组织报告、应用程序部署等都得到了显着增强。我只想为您提供我们的经验，希望它能帮助您预测您可能预料到的一些困难。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T15:19:30.423

绝对是company_id。

为每件事创建一个新表——更不用说一个新的数据库了——将是荒谬的（而且确实是许多每日 WTF 帖子的素材）。

这就是使用关系数据库的全部意义——将事物链接在一起。

如果您需要使数据库更大，有很多方法可以做到（主/从、主/多从、双主、水平扩展、只需购买大量 RAM 等）。

FWIW：我的上一个应用有大约 1200 万用户（每天大约 30 万）；它有两个数据库（水平缩放；由以前的人完成。我不同意这个决定，并且会使用奴隶）。

编辑：警告 - 这是假设您仅通过您的应用程序（其 Web 界面或 API）公开访问权限。

如果您确实需要将数据库直接暴露给客户，a) 告诉他们重新考虑，因为这是一个坏主意，并且 b) 那么您可能需要在保留所需防火墙的更易于维护的方面做出艰难的选择。但是，如果你能帮上忙，你就不想去那里。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T15:38:41.673

我最近发现在 SaaS 中有这样的一个名称，当应用程序和数据库在公司之间共享时：

[多租户](http://en.wikipedia.org/wiki/Multitenancy)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T17:56:48.170

在将软件作为服务运行时，在选择数据库策略时总是需要考虑一些事情。每个客户端单独数据库的两个参数是备份和（感觉）安全性。如果您有一个带有谨慎 customer_id 字段的数据库，并且客户 666 搞砸了并希望恢复他昨天的数据，那么您需要做一些工作。

该客户有时也需要每个客户拥有一个数据库，因为数据可能很敏感。他可以理直气壮地争辩说，将数据放在不同的数据库中并设置良好的安全性会更省钱。

-Edoode

# iphone - 带有 4 位数年份的 iphone 短日期

> ID：845504
> 
> 赞同：9
> 
> 时间：2009-05-10T15:12:08.683
> 
> 标签：iphone, nsdate, nsdateformatter

我确定我只是错过了一些东西。但是我已经用谷歌搜索了几天，试图找到如何在显示具有 NSDateFormatterShortStyle 样式的 NSDate 时显示 4 位数的年份。如果您有解决方案，请告诉我。这是我现在使用的代码。

```
[NSDateFormatter setDefaultFormatterBehavior:NSDateFormatterBehavior10_4];
    NSDateFormatter *dateFormatter = [[[NSDateFormatter alloc] init] autorelease ];
    [dateFormatter setDateStyle:NSDateFormatterShortStyle];
    [dateFormatter setTimeStyle:NSDateFormatterNoStyle];

    // add label for birth
    UILabel *birthday = [[UILabel alloc] initWithFrame:CGRectMake(125, 10, 100, 25)];
    birthday.textAlignment = UITextAlignmentRight;
    birthday.tag = kLabelTag;
    birthday.font = [UIFont boldSystemFontOfSize:14];
    birthday.textColor = [UIColor grayColor];
    birthday.text = [dateFormatter stringFromDate:p.Birth]; 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2011-03-18T02:24:12.547

以防有人像我一样在这里绊倒，因为我需要这样一个具有本地化日期格式的 2 位数年份的东西，这是一个非常老的问题，这是我的解决方案：

```
NSLocale*           curLocale = [NSLocale currentLocale];
NSString*           dateFmt   = [NSDateFormatter dateFormatFromTemplate: @"ddMMyyyy"
                                                                options: 0
                                                                 locale: curLocale];
NSDateFormatter*    formatter = [[[NSDateFormatter alloc] init] autorelease];
                    [formatter setDateFormat:dateFmt];
NSString*           retText = [formatter stringFromDate:refDate];

return retText; 
```

也许有人可以在某个时候使用它...

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-10T16:03:50.633

如果您需要四位数年份，请`dateformat:`使用您想要的确切格式设置。缺点是您会丢失自动区域设置格式。

```
NSDateFormatter *dateFormatter = [[[NSDateFormatter alloc] init] autorelease];
[dateFormatter setDateFormat:@"MM/dd/yyyy"];

...

birthday.text = [dateFormatter stringFromDate:p.Birth]; 
```

如果您需要本地化，那么您可以尝试修改短样式的日期格式。

```
NSDateFormatter *dateFormatter = [[[NSDateFormatter alloc] init] autorelease ];
[dateFormatter setDateStyle:NSDateFormatterShortStyle];
[dateFormatter setTimeStyle:NSDateFormatterNoStyle];

if ([[dateFormatter dateFormat] rangeOfString:@"yyyy"].location == NSNotFound) { 
    NSString *fourDigitYearFormat = [[dateFormatter dateFormat] stringByReplacingOccurrencesOfString:@"yy" withString:@"yyyy"]; 
    [dateFormatter setDateFormat:fourDigitYearFormat];             
} 
```

*更新了 Max Macleod 的错误修复*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-03-29T14:58:20.390

这是一个旧线程，但是因为我试图做 Dave 想要做的事情，但因为给出的答案都不是正确的，所以这是解决方案（以防有人想要同样的事情）：

```
NSString *FormatString = [NSDateFormatter dateFormatFromTemplate:@"MM/dd/yyyy HH:mm" options:0 locale:[NSLocale currentLocale]];
NSDateFormatter *formatter = [[NSDateFormatter alloc] init];
[formatter setDateFormat:FormatString];
//Parse date here with the formater (like [formatter stringFromDate:date])
[formatter release]; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T15:55:17.540

> kCFDateFormatterShortStyle 指定一个短样式，通常只有数字，例如“11/23/37”或“3:30pm”。
> 
> 适用于 Mac OS X v10.3 及更高版本。
> 
> 在 CFDateFormatter.h 中声明。

[来源](http://developer.apple.com/DOCUMENTATION/CoreFoundation/Reference/CFDateFormatterRef/Reference/reference.html#//apple_ref/doc/c_ref/kCFDateFormatterShortStyle)

NSDateFormatterShortStyle 似乎没有给你 4 位数的年份。

# wpf - 文本换行扩展列以适合文本

> ID：845505
> 
> 赞同：4
> 
> 时间：2009-05-10T15:13:04.987
> 
> 标签：wpf, word-wrap

我有一个简单定义的网格：

```
<Grid Margin="0,5,0,0">
  <Grid.ColumnDefinitions>
    <ColumnDefinition Width="50"></ColumnDefinition>
    <ColumnDefinition Width="50"></ColumnDefinition>
    <ColumnDefinition Width="48"></ColumnDefinition>
    <ColumnDefinition Width="Auto"></ColumnDefinition>
   </Grid.ColumnDefinitions> 
```

然后我试图绑定一些这样的内容：

```
<TextBlock TextWrapping="Wrap" Grid.Column="3" Text="{Binding Text}"> 
```

像这样设置，文本不会换行。它只是扩展列以适应文本。如果我在最后一列将宽度设置为固定值，则换行将按预期工作。存在的问题是，如果用户加宽窗口，该列将保持固定大小。如何使列随网格宽度动态调整大小，但仍将文本包装在其中？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-08-03T20:39:54.053

的宽度`"*"`将使用 . 在列之间平均分配任何剩余空间`"*"`。如果您有一个带有 的列`Width="*"`，则该列将获得所有剩余空间。如果您有 2 列`Width="*"`，则每列将获得剩余空间的 1/2。

这是[一篇关于网格大小的好文章](http://www.wpftutorial.net/GridLayout.html)，其中包括星形大小。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-07-01T19:50:30.083

我发现有一个令人沮丧的案例可以收支平衡，那`Width="*"`就是当你拥有.[`IsSharedSizeScope`](http://msdn.microsoft.com/en-us/library/system.windows.controls.grid.issharedsizescope%28v=vs.85%29.aspx)`= true`

```
<Border BorderBrush="Red" BorderThickness="1">
    <StackPanel Grid.IsSharedSizeScope="True">

        <Grid HorizontalAlignment="Stretch">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" SharedSizeGroup="G1"/>
                <ColumnDefinition Width="Auto" SharedSizeGroup="G2" />
                <ColumnDefinition Width="*"  SharedSizeGroup="G3" />
            </Grid.ColumnDefinitions>

            <TextBlock Text="Col0" Grid.Column="0" Margin="0,0,5,0"/>
            <TextBlock Text="Col1" Grid.Column="1" Margin="0,0,5,0"/>

            <TextBlock Text="A B C D E F G H I J K L M N O P Q R S T U V W X Y Z" TextWrapping="Wrap" Grid.Column="2"/> 
        </Grid>

    </StackPanel>                   

</Border> 
```

这不会换行，但是如果您更改`Grid.IsSharedScopeSize`为，`false`则可以。

尚未找到解决方案，但这可能是它不起作用的另一个原因。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-04T17:49:37.743

尝试这个：

```
<Grid Margin="0,5,0,0">
  <Grid.ColumnDefinitions>
    <ColumnDefinition Width="50"></ColumnDefinition>
    <ColumnDefinition Width="50"></ColumnDefinition>
    <ColumnDefinition Width="48"></ColumnDefinition>
    <ColumnDefinition Name="ParentColumn" Width="Auto"></ColumnDefinition>
   </Grid.ColumnDefinitions>
   <TextBlock TextWrapping="Wrap" Grid.Column="3" Text="{Binding Text}"
      MaxWidth="{Binding ActualWidth, ElementName=ParentColumn}"> 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-05-10T17:39:31.303

将其宽度设置为“*”

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-10-28T09:59:03.620

仅当您希望根据所述列/行中的内容调整列/行大小时，才应使用 Auto。如果您想“分配剩余空间”，请使用“*”。在您的情况下， TextBlock 需要知道在实际测量之前它有多少空间，以便它可以告诉在哪里包装文本。

# linux - 如何获取与 fd 关联的设备类型

> ID：845510
> 
> 赞同：3
> 
> 时间：2009-05-10T15:15:38.027
> 
> 标签：linux

我从调用者那里得到一个有效的“fd”对象。我如何找出 fd 类型是什么——它是指文件、套接字、设备等吗？根据引用的类型，我需要执行特定的功能，比如如果 fd 与文件相关联，那么我需要进行读取。如果它与套接字相关联，那么我需要获取套接字属性。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-10T15:17:36.183

好吧，至少在理论上，您仍然可以读取套接字、设备和管道，以及.... :-P

如果您想从套接字获取更多数据，例如套接字地址，您只需调用函数即可。对于非套接字它只会失败，由您决定如何处理它。

* * *

如果你*真的*必须知道，`fstat`对你的文件描述符做一个，然后看看它的模式（`st_mode`）：

```
mode_t type;
struct stat fdstat;
/* ... */
if (fstat(fd, &fdstat) == -1)
    /* error out */
type = fdstat.st_mode & S_IFMT;
switch (type) {
case S_IFSOCK:
    /* socket */
case S_IFIFO:
    /* FIFO */
/* other cases */
} 
```

# c# - 是否有任何有价值的 CSLA 替代品？

> ID：845526
> 
> 赞同：13
> 
> 时间：2009-05-10T15:25:30.170
> 
> 标签：c#, .net, frameworks, business-objects, csla

我的公司有兴趣将大型商业应用程序移植到 .NET。我们计划开发桌面版本和 Silverlight 版本。我主要研究了 CSLA 框架（得到了 rocky 的书，已经读到一半了），发现它有点过度设计，数据层方面似乎也没有那么完美。

是否有任何其他框架声称可以做 CSLA 正​​在做的事情？我不是在谈论 ORM 工具（例如 L2S、EF、NHibernate。）我对支持业务规则的框架、简单的 n 层架构、对象是域驱动而不是数据库驱动、业务对象的安全性等感兴趣...

我知道我可以找到可以完成一些所需工作的小型框架（想到企业应用程序块），但我正在寻找一个包含所有内容的框架。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-27T06:44:10.763

我很想听听更多关于您为什么认为 CSLA 过度设计的信息。我发现它的功能非常丰富，但大多数功能只是实现了标准的 .NET 框架接口，所以所有的管道都是免费的，你肯定必须使用它。

您的要求似乎非常适合 CSLA。其他框架（例如 ORM）包含验证/业务规则，但主要问题是您（在大多数情况下）卡在数据模式中。这会导致对象对 UI 开发不友好，并迫使您了解数据库的复杂性。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-10T15:42:55.413

这是一篇[很好的博客文章](http://www.adamalexander.net/adam_on_the_net/2008/07/comparing-net-development-frameworks-castle-project-springnet-enterprise-library-and-csla.html)（[存档版本](http://web.archive.org/web/20100323013618/http://www.adamalexander.net/adam_on_the_net/2008/07/comparing-net-development-frameworks-castle-project-springnet-enterprise-library-and-csla.html)），由“网络上的亚当”提供，讨论和比较以下内容：

*   [城堡项目](http://www.castleproject.org/)
*   [春天.NET](http://www.springframework.net/)
*   [企业图书馆](http://msdn.microsoft.com/en-us/library/ff648951.aspx)
*   [CSLA](http://www.lhotka.net/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T17:56:10.980

如果我是你，我要么选择[Spring.NET](http://springframework.net/)，要么就开始围绕 ASP.NET MVC 和 Fluent NHibernate 构建自己的框架。然后在需要时慢慢添加自己的构建块。在我看来，企业库块很好但很重，并且有很多你可能并不真正需要的东西。

# javascript - 编写一个简单的自定义编辑器需要多快？

> ID：845527
> 
> 赞同：4
> 
> 时间：2009-05-10T15:25:34.570
> 
> 标签：javascript, editor

简单我的意思是，有按钮：

1.  胆大，
2.  斜体，
3.  编号列表
4.  要点清单
5.  左缩进
6.  右缩进
7.  拼写检查（显然由现成的 js 组件支持）

自定义我的意思是：拥有自定义图标 - 所以真的只是自定义设计

无框架，白手起家，轻量级，兼容主流浏览器

这是 webapp 的主要组件之一，所以它必须是超轻量级的，这就是我不想要框架的原因

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-05-10T15:46:58.497

除非您针对的是一种浏览器，否则编辑器是非常复杂的组件，可以跨浏览器工作。除非您想学习，否则没有理由自己做。

使用允许自定义的众多可用之一： [tinymce](http://tinymce.moxiecode.com/)， [fckeditor](http://www.fckeditor.net/)， [wysihat](http://github.com/37signals/wysihat/tree/master)， [其他](http://www.google.com/search?hl=en&client=safari&rls=en-us&num=20&q=javascript+wysiwyg+editor&btnG=Search)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-10T16:10:47.303

不。

去找别的东西（杰森提到的任何东西，或者例如 SO 本身使用的东西，WMD）。交换它的图像。结束。

说真的，您不想编写自己的编辑器，除非您有充分的理由来实现它的*功能*，而不仅仅是它的外观。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-10T18:33:32.730

编写跨平台工作的编辑器可能很困难，但是，您应该在这样做时创建自己的框架，因为它是一个大型项目。

如果您只想要自定义图标，那将取决于您制作它们需要多长时间，但是，获得一些基本功能并不难，如果您知道自己在做什么，可能不到 40 小时的工作。

在 Unix 中编写自己的 shell 曾经是一种仪式，在 javascript 中可能是编写自己的编辑器。:)

棘手的地方是如果我有

```
<b>some text</b><i>more text</i> 
```

我决定从这个文本中删除标签，然后如何修复它会变得很棘手。

如果您只想使用 css，那么当您将 span 标签中的文本分组并修复 css 类，而用户继续进行更改时，这将成为一个更大的问题。

我目前正在处理这个问题，因为我想要一个可以在 XHTML2.0 中工作的编辑器，这不是一个小问题，比在桌面应用程序中要困难得多。

我建议先让它在 Firefox 3 和 Safari 上运行，然后，一旦它运行起来，返回并添加代码以让它在 IE8 上运行，如果你想要 IE7，因为 MS 正在将 IE8 作为一个现在关键更新。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-05-10T15:27:36.657

通读 emacs 教程的前几章，你会发现根本没有像“简单”编辑器这样的东西。但是谷歌会给你很多容易定制的编辑器。

# c# - 使用 Fluent NHibernate 映射时对接口进行编程

> ID：845536
> 
> 赞同：25
> 
> 时间：2009-05-10T15:32:26.670
> 
> 标签：c#, nhibernate, fluent-nhibernate, nhibernate-mapping

我已经被鞭打并开始学习 Fluent NHibernate（没有以前的 NHibernate 经验）。在我的项目中，我正在对接口进行编程以减少耦合等。这意味着几乎“一切”都是指接口而不是具体类型（IMessage 而不是 Message）。这背后的想法是通过模拟依赖项来帮助使其更具可测试性。

但是，当我尝试映射到接口而不是具体类时，（Fluent）NHibernate 不喜欢它。问题很简单 - 根据 Fluent Wiki，定义我的班级的 ID 字段是明智的，例如

```
int Id { get; private set; } 
```

获取典型的自动生成的主键。但是，这仅适用于具体类 - 我无法在接口上指定访问级别，其中必须有同一行

```
int Id { get; set; } 
```

而且我猜这否定了在具体类中将 setter 设为私有（想法是只有 NHibernate 应该将 ID 设置为 DB 分配的）。

现在，我想我只是将 setter 公开，并尽量避免写信给它的诱惑。但是有没有人知道创建正确主键的“正确”、最佳实践方法是什么只有 NHibernate 可以写入而仍然只能对接口进行编程的字段？

**更新**

根据我在以下 mookid 和 James Gregory 的两个答案之后的理解，我很可能走错了路 - 我不应该有理由像现在这样为每个实体提供一个接口。这一切都很好。我想我的问题就变成了——没有理由对任何实体的接口进行 100% 编程吗？如果甚至有一种情况可以证明这是合理的，那么（Fluent）NHibernate 是否可以做到这一点？

我问是因为我不知道，不是批评。感谢您的回复。:)

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-10T17:28:25.363

*我意识到这是一种转移，而不是您问题的答案（尽管我认为 mookid 已经涵盖了这一点）。*

您应该真正评估您的域实体上的接口是否实际上提供了任何有价值的东西；很难找到真正需要这样做的情况。

例如：当他们（几乎）毫无疑问地共享相同的签名时，`IMessage`依赖比依赖更少耦合如何？`Message`您不需要模拟实体，因为它很少有足够的行为需要被模拟。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-05-10T17:14:16.880

您可以调整您的界面以仅包含一个吸气剂：

```
public interface ISomeEntity
{
    int Id { get; }
} 
```

您的具体类仍然可以实现 setter，并且由于您正在对接口进行编程，因此您永远不会“偶然”调用 setter。

如果即使您持有对具体实例的引用也不允许设置 id，您可以避免实现 setter，然后让 NHibernate 访问字段而不是属性 - 没错，NHibernate 可以使用一些漂亮的反射技巧来直接设置您的 id 字段，而不是调用该属性。然后你可以像这样映射 id：

```
Id(e => e.Id).Access.AsCamelCaseField(); 
```

在这种情况下，您的`Id`财产必须由相应的`id`字段支持。还有更多的命名约定，例如，如果您更喜欢下划线作为私有字段前缀。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-07-15T11:27:41.663

我有完全相同的问题。不幸的是，我有使用实体接口的正当理由；实体模型将以不同的方式实现，并为每个客户提供不同的映射。

整个模型需要是只读的，所以接口的样式是：

```
public interface IAccount
{
    long AccountId { get; }
    IHouse House { get; }
}

public interface IHouse
{
    long HouseId { get; }
    HouseStatus Status { get; }
    IList<IAccount> Accounts { get; }
} 
```

然后具体实现使用内部设置器实现这些：

```
public class Account: IAccount
{
    public virtual long AccountId { get; internal set; }
    public virtual IHouse House { get; internal set; }
}

public class House: IHouse
{
    public virtual long HouseId { get; internal set; }
    public virtual HouseStatus Status { get; internal set; }
    public virtual IList<IAccount> Accounts { get; internal set; }
} 
```

我已经沿着映射到具体类的路线走。一切都很好，直到您创建返回接口并需要转换为具体实现的关系。

```
HasMany(x => x.Accounts) 
```

可以变成

```
HasMany<Account>(x => x.Accounts) 
```

但是没有等效的“演员”

```
References(x => x.House) 
```

映射到接口（更简洁的解决方案）会引发上述问题，因为 Id 必须存在于最顶层的类中才能进行设置，并且需要接口上的 setter。

```
public sealed class AccountMap : ClassMap<IAccount>
{
    public PokerPlayerMap()
    {
        Id(x => x.AccountId, "account_id");

        DiscriminateSubClassesOnColumn("Type").SubClass<Account>(s =>  
        {
            References(x => x.House);       
        });
    }
} 
```

目前，我唯一的解决方案是将设置器添加到所有接口 Id 字段。遗憾的是，Id 不能存在于子类中，也不能从接口进行类型转换。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-05-12T19:52:20.427

**更新：**通过 fluent-nhibernate 提供的 fluent 接口不支持使用 union-subclass。您必须使用常规的 hbm 映射文件并添加它。

我也正在尝试使用流利的 NHibernate 来做到这一点。我不认为这应该是映射接口的问题。您想使用继承策略，特别是[table-per-concrete-class strategy](http://docs.jboss.org/hibernate/stable/core/reference/en/html/inheritance.html)。

本质上，您为基类（在本例中为您的接口）创建映射定义，并指定 NHibernate 应如何使用 union-subclass 处理实现者。

因此，例如，这应该允许您进行多态关联：

```
<class name="IAccountManager"
                abstract="true"
                table="IAccountManager">

        <id name="Id">
                <generator class="hilo"/>
        </id>

        <union-subclass
                table="DefaultAccountManager"
                name="DefaultAccountManager">
                <property name="FirstName"/>
        </union-subclass>

        <union-subclass
                table="AnotherAccountManagerImplementation"
                name="AnotherAccountManagerImplementation">
                <property name="FirstName"/>
        </union-subclass>
        ...
</class> 
```

请注意所有具体实施者的 Id 是如何相同的。NHibernate 需要这个。此外，IAccountManager 表实际上并不存在。

您还可以尝试利用 NHibernate 的隐式多态性（记录在 table-per-concrete-class 策略下方） - 但它有很多限制。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-07-20T13:51:27.790

看起来我没有足够的声誉来评论其他人的答案，但因此我将不得不自己做出这个答案。

References 现在有一个通用重载，以允许 theGecko 在他的答案中寻找的演员表。

# database - Oracle 序列

> ID：845539
> 
> 赞同：3
> 
> 时间：2009-05-10T15:34:09.100
> 
> 标签：database, oracle

我正在使用一个序列为我生成一个 id，但我使用我的 Java 应用程序中的那个序列。所以比如说我的最后一个 ID 是 200。

如果我通过使用 201 作为 id 而不是执行 seq.nextval 来添加带有 .sql 的条目。当我的 java 应用程序调用 seq.nextval 时会发生什么？序列是否足够智能以检查最大可用数量，或者它只会返回 201？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T15:37:10.893

它只会返回 201，因为序列不知道这些数字的用途。

注意：如果您指定序列必须缓存某些会话的值，它可能会返回 220（有关更多详细信息，请参阅[Oracle 手册关于 CREATE SEQUENCE](http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/statements_6015.htm#sthref7018)）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T15:39:31.610

序列只是提供了一种“选择”自动递增数字的方法。

你会得到 201 因为他们不检查任何东西，他们只是存储检索到的最后一个值，当你再次查询它时，它将返回序列中的下一个值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T15:43:21.277

它将返回 201。

您还可以使用 JDBC 中的 nextval，然后使用该值进行插入：

```
Statement st = conn.createStatement();
ResultSet rs = st.executeQuery("select seq.nextval from dual");
rs.next();
int yourId = rs.getInt(1);

// then use yourId to do the insert 
```

这样，您可以使用数字插入，并保持序列应有的方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T15:44:08.283

从您的 Java 应用程序的下一次调用中，nextval 返回的内容取决于许多因素：

1.  如果您在集群环境中运行，您接下来要与哪个节点通话。每个节点将预先分配一个序列值池；
2.  您正在与之交谈的节点是否已重新启动。如果发生这种情况，序列值池将趋于“丢失”（意味着跳过）；
3.  序列的步长值；和
4.  交易是否在序列上调用了 nextval。

序列是松散有序的，而不是绝对有序的。

但是 Oracle 不知道你对序列值做了什么，所以如果你在数据库中插入一个 201，序列会很高兴地返回 201，完全忽略插入的值，因为这两者基本上是不相关的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-12T18:48:44.650

将序列生成的值与手动插入混合绝不是一个好主意，因为那样一切都会混淆。

不确定它是否对您的情况有帮助，但请记住，您可以询问序列的当前值（使用 seq.currval 或类似的），以便您可以检查表中是否由于手动插入而已经存在，如有必要, 要求另一个 nextval

# c - 如何在 C 库中使用 opendir 和 readdir 忽略隐藏文件

> ID：845556
> 
> 赞同：5
> 
> 时间：2009-05-10T15:51:28.010
> 
> 标签：c, unix, file-io

这是一些简单的代码：

```
DIR* pd = opendir(xxxx);
struct dirent *cur;
while (cur = readdir(pd)) puts(cur->d_name); 
```

我得到的有点乱：包括点 ( `.`)、点点 ( `..`) 和以 . 结尾的文件名`~`。

我想做与 command 完全相同的事情`ls`。请问我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-05-10T15:57:45.417

这很正常。如果这样做`ls -a`（显示所有文件，`ls -A`将显示除`.`and之外的所有文件`..`），您将看到相同的输出。

`.`是一个指向它所在目录的链接：和 .`foo/bar/.`是一样的`foo/bar`。

`..`是指向其所在目录的父目录的链接：`foo/bar/..`与`foo`.

任何其他以开头`.`的文件都是隐藏文件（按照惯例，它并没有真正被任何东西强制执行；这与 Windows 不同，Windows 有一个真正的、官方的隐藏属性）。以 结尾的`~`文件可能是您的文本编辑器创建的备份文件（同样，这是惯例，这些实际上*可以*是任何东西）。

如果您不想显示这些类型的文件，则必须明确检查并忽略它们。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-10T16:17:24.703

消除隐藏文件：

```
DIR* pd = opendir(xxxx);
struct dirent *cur;
while (cur = readdir(pd)) {
    if (cur->d_name[0] != '.') {
        puts(cur->d_name);
    }
} 
```

消除隐藏文件和以“~”结尾的文件：

```
DIR* pd = opendir(xxxx);
struct dirent *cur;
while (cur = readdir(pd)) {
    if (cur->d_name[0] != '.' && cur->d_name[strlen(cur->d_name)-1] != '~') {
        puts(cur->d_name);
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T16:17:31.083

`if (cur->d_name[0] != '.')`在处理名称之前 粘贴 a 。

UNIX 隐藏文件标准是前导点，它`.`也`..`匹配。

尾随`~`是备份文件的标准。忽略这些需要更多的工作，但数千兆赫的 CPU 可以管理它。使用类似的东西`if (cur->d_name[strlen(cur->d_name)-1] == '~')`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T15:59:01.170

这种行为与实际行为*完全相同*`ls -a`。如果你想过滤，那么你需要事后进行。

# latex - 致盲乳胶纸

> ID：845561
> 
> 赞同：13
> 
> 时间：2009-05-10T15:57:21.797
> 
> 标签：latex, citations

许多期刊要求您提交论文的盲版本。盲版通常会删除：

*   作者名单
*   对作者作品的任何引用

如何在不手动操作的情况下创建手稿的盲版本？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-10T16:10:59.643

您可以使用[extract](http://www.ctan.org/tex-archive/help/Catalogue/entries/extract.html)包为论文生成单独的 LaTeX 源文件，并自动删除作者列表和致谢。我相信[版本](http://www.ctan.org/tex-archive/help/Catalogue/entries/versions.html)包也可以用来做到这一点。

至于使引用蒙蔽，我认为重点是以中立和不公开的方式引用您自己的工作。以下是一些在盲手稿中引用自己作品的正确和错误方法示例：

```
不正确：“正如我在其他地方所争论的那样……”
更正：“正如琼斯（2001 年）所说的......”

不正确：“正如我在 (Jones 2001) 中所说的那样。”
更正：“正如琼斯（2001）所说。”

不正确：“这个论点在我的 (2001) 中得到了充实。”
更正：“Jones (2001) 更详细地阐述了这一论点。”

```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-11T13:38:48.817

在这些情况下经常被忽略的一件事是，您实际上并不需要删除对自己作品的引用，只要您以第三人称引用它们即可。而不是写“如我们之前的论文所示（已删除以供审查）......”，你应该写“如 Smith 等人所示。（Smith, Jones, and Adams, 2008）......”。

这样阅读起来会更好，并为您节省一些麻烦，同时通常满足期刊和会议的提交规则。这样，您所要做的就是删除作者列表，这并不难手动完成。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-20T21:44:20.997

哈德利，你说有必要删除所有对你自己作品的引用。真的是这样吗？在某个职业阶段，没有一组引用很可能会泄露作者的身份！

我会通过建议你忽略那些建议使用主动语态的人来背叛我的老屁状态。将“Hadley (2009) 表明天空是蓝色的”更改为“天空是蓝色的 (Hadley 2009)”是解决“我”（以及“我们”和“我们中的一些人”和“一些我们，以及其他人”）在技术写作中。它还有一个额外的好处：它将注意力集中在手头的事情上，而不是相关的人身上。您希望读者的内在眼睛看到广阔的蔚蓝，而不是您的头像；-)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T16:15:39.120

要删除作者列表，您可以使用 \renewcommand 来“编辑”您的 \maketitle 以避免列出文章的作者。对于作者的引文，您也可以这样做。

例如。

```
\renewcommand{\maketitle}{\title} 
```

# wpf - 通过 DataBinding 在 UserControl 中设置自定义属性

> ID：845564
> 
> 赞同：14
> 
> 时间：2009-05-10T15:58:27.333
> 
> 标签：wpf

假设我有一个非常简单的 UserControl - 出于所有意图和目的 - 只不过是 TextBox：

```
public partial class FooBox : UserControl
{
    public static readonly DependencyProperty FooTextProperty =
        DependencyProperty.Register("FooText", typeof(string), typeof(FooBox));

    public FooBox()
    {
        InitializeComponent();
    }

    public string FooText
    {
        get { return textBlock.Text; }
        set { textBlock.Text = value; }
    }
}

<UserControl x:Class="Namespace.FooBox"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Height="300" Width="300">
    <Grid>
        <TextBlock x:Name="textBlock" />
    </Grid>
</UserControl> 
```

在表格上它被声明为：

```
<local:FooBox FooText="{Binding Name}" /> 
```

表单的 DataContext 设置为具有 Name 属性的对象。但这对我不起作用。我错过了什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-05-10T22:57:17.243

DependencyProperty 中属性声明的“get”和“set”部分实际上并没有被 WPF 的数据绑定系统调用——它们本质上只是为了满足编译器的需要。

相反，将您的属性声明更改为如下所示：

```
public string FooText
{
    get { return (string)GetValue(FooTextProperty); }
    set { SetValue(FooTextProperty, value); }
} 
```

...和您的 XAML 以：

```
<UserControl ...
    x:Name="me">
    <Grid>
        <TextBlock Text="{Binding FooText,ElementName=me}" />
    </Grid>
</UserControl> 
```

现在您的 TextBox.Text 只是直接绑定到“FooText”属性，因此您可以反过来将 FooText 属性绑定到“Name”，就像您当前正在做的那样。

Another way is to bind TextBlock.Text to a RelativeSource binding that finds the FooText property on the first ancestor of type "FooBox", but I've found that this is more complex than just giving the control an internal x:Name and using element binding.

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-11T03:00:44.773

Turns out the real problem is I was expecting the WPF framework to set my public property whereupon my code would respond to the changes and render according to the new value. Not so. What WPF does is call SetValue() directly and completely circumvents the public property. What I had to do was receive property change notifications using DependencyPropertyDescriptor.AddValueChanged and respond to that. It looks something like (inside the ctor):

```
var dpd = DependencyPropertyDescriptor
    .FromProperty(MyDependencyProperty, typeof(MyClass));
dpd.AddValueChanged(this, (sender, args) =>
{
    // Do my updating.
}); 
```

# java - JDIC 的 64 位版本何时可用？

> ID：845570
> 
> 赞同：2
> 
> 时间：2009-05-10T16:00:44.973
> 
> 标签：java, jdic

我的 Java 程序需要大量内存才能运行，32 位版本的 Java 最大为 1.5 GB，我的系统有 4 GB 的 RAM，所以我决定在 64 位版本的 Java 下运行它，但 JDIC不起作用，这会影响我的程序，所以我想知道是否有人知道 64 位 JDIC 何时可用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T18:48:17.167

假设您正在运行 64 位操作系统和 64 位 JVM，您可以尝试最新版本的 Java 6u13，因为我相信对 64 位应用程序的客户端支持有所改进。

注意：我不建议您为 Java 堆使用超过 1/2 到 2/3 的内存。您可能还需要更多的主内存才能看到您可以真正使用的内存量的真正改进。（因为您需要为操作系统、其他程序和 Java 自己的共享内存/库等保留内存）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-08T00:35:59.453

我只使用了 JDIC 中的 Desktop (org.jdesktop.jdic.desktop.Desktop)，现在我可以使用 Java 6 中的 java.awt.Desktop。有一些区别，但基本上它们都具有相同的功能。

# sql - 列出数据库中的所有表

> ID：845571
> 
> 赞同：6
> 
> 时间：2009-05-10T16:02:48.247
> 
> 标签：sql, database

是否有一个 SQL 命令可以列出数据库中的所有表并且独立于提供程序（适用于 MSSQLServer、Oracle、MySQL）？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-05-10T16:08:49.223

最接近的选项是查询`INFORMATION_SCHEMA`表。

```
SELECT *
FROM INFORMATION_SCHEMA.Tables
WHERE table_schema = 'mydatabase'; 
```

它`INFORMATION_SCHEMA`是标准 SQL 的一部分，但并非所有供应商都支持它。据我所知，唯一支持它的 RDBMS 供应商是：

*   [MySQL](http://dev.mysql.com/doc/refman/5.1/en/information-schema.html)
*   [PostgreSQL](http://www.postgresql.org/docs/current/static/information-schema.html)
*   微软 SQL Server [2000](http://msdn.microsoft.com/en-us/library/aa933204.aspx) / [2005](http://msdn.microsoft.com/en-us/library/ms186778(SQL.90).aspx) / [2008](http://msdn.microsoft.com/en-us/library/ms186778.aspx)

某些品牌的数据库，例如 Oracle、IBM DB2、Firebird、Derby 等，具有类似的“目录”视图，为您提供了一个界面，您可以在其中查询系统上的元数据。但是视图的名称、它们包含的列以及它们之间的关系与`INFORMATION_SCHEMA`. 换句话说，类似的信息是可用的，但是您用来获取该信息的查询是不同的。

（脚注：IBM DB2 UDB for System i 中的目录视图与 IBM DB2 UDB for Windows/*NIX 中的目录视图不同——对于 UDB 中的*Universal*来说如此之多！）

其他一些品牌（例如 SQLite）根本不提供任何可查询的元数据接口。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-10T16:03:49.463

不，他们都喜欢以自己的方式做这件事。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T16:22:02.357

如果您可以使用非 SQL 方法*，并且*您有数据库的 ODBC 驱动程序*并且*它实现了 SQLTables 入口点，那么您*可能*会得到您想要的信息！

pjjH

有关 API 的详细信息，请访问：http: [//msdn.microsoft.com/en-us/library/ms711831.aspx](http://msdn.microsoft.com/en-us/library/ms711831.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T16:04:23.660

不，SQL 标准不限制列出表名的位置（如果有的话），因此您必须`SELECT`根据您正在处理的 SQL 引擎执行不同的语句（通常是在特殊命名的表上的语句）。

# perl - 如何在 Perl 中将 log4j 时间戳转换为毫秒？

> ID：845574
> 
> 赞同：2
> 
> 时间：2009-05-10T16:04:22.677
> 
> 标签：perl, log4j, timestamp

我拥有的 log4j 日志包含以下格式的时间戳：

```
2009-05-10 00:48:41,905 
```

我需要使用以下 gawk 函数将 perl 中的它转换为自纪元以来的毫秒数，在本例中为**124189673005 。**我如何在 perl 中做到这一点？

我在 perl 方面几乎没有经验，所以如果有人可以发布一个完整的脚本来做到这一点，我将不胜感激

```
function log4jTimeStampToMillis(log4jts) {
    # log4jts is of the form 2009-03-02 20:04:13,474
    # extract milliseconds that is after the command
    split(log4jts, tsparts, ",");
    millis = tsparts[2];

    # remove - : from tsstr
    tsstr = tsparts[1];
    gsub("[-:]", " ", tsstr);
    seconds = mktime(tsstr);
    print log4jts;
    return seconds * 1000 + millis;
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T23:53:43.127

尽管我几乎总是告诉人们为此使用来自 CPAN 的众多优秀模块之一，但它们中的大多数确实有一个主要缺点 - 速度。如果您要实时解析大量日志文件，这有时可能是个问题。在这些情况下，自己滚动通常可能是更合适的解决方案，但有许多陷阱和细微差别必须加以考虑和妥善处理。因此，更倾向于使用由其他人编写的已知正确、经过验证、可靠的模块。:)

但是，在我考虑上面的建议之前，我查看了您的代码并在脑海中将其转换为 perl ......因此，这里或多或少地将您的 gawk 代码直接转换为 perl。我试图尽可能简单地编写它，以便突出在 perl 中手动处理日期和时间的一些更微妙的部分。

```
# import the mktime function from the (standard) POSIX module
use POSIX qw( mktime );

sub log4jTimeStampToMillis {
    my ($log4jts, $dst) = @_;

    # extract the millisecond field
    my ($tsstr, $millis) = split( ',', $log4jts );

    # extract values to pass to mktime()
    my @mktime_args = reverse split( '[-: ]', $tsstr );

    # munge values for posix compatibility (ugh)
    $mktime_args[3] -= 1;
    $mktime_args[4] -= 1;
    $mktime_args[5] -= 1900;
    # print Dumper \@mktime_args; ## DEBUG

    # convert, make sure to account for daylight savings
    my $seconds = mktime( @mktime_args, 0, 0, $dst );

    # return that time as milliseconds since the epoch
    return $seconds * 1000 + $millis;
} 
```

我的代码和您的代码之间的一个重要区别 - 我的 log4jTimeStampToMillis 子例程采用**两个**参数：

1.  日志时间戳字符串
2.  该时间戳是否使用夏令时（1 为真，0 为假）

当然，您可以只添加代码来检测该时间是否在 DST 中并自动调整，但我试图保持简单。:)

注意：如果取消注释标记为 DEBUG 的行，请确保添加“use Data::Dumper;” 在你的程序中的那一行之前，这样它就可以工作了。

这是一个如何测试该子例程的示例：

```
my $milliseconds = log4jTimeStampToMillis( "2009-05-10 00:48:41,905", 1 );    
my $seconds = int( $milliseconds / 1000 );
my $local = scalar localtime( $seconds );

print "ms:    $milliseconds\n"; # ms:    1241844521905
print "sec:   $seconds\n";      # sec:   1241844521
print "local: $local\n";        # local: Sat May  9 00:48:41 2009 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-11-24T00:38:29.323

您应该利用伟大的[DateTime](http://search.cpan.org/dist/DateTime/lib/DateTime.pm)包，特别是使用[DateTime::Format::Strptime](http://search.cpan.org/~drolsky/DateTime-Format-Strptime-1.5000/lib/DateTime/Format/Strptime.pm)：

```
use DateTime;
use DateTime::Format::Strptime;

sub log4jTimeStampToMillis {
    my $log4jts=shift(@_);

    #see package docs for how the pattern parameter works
    my $formatter= new DateTime::Format::Strptime(pattern => '%Y-%m-%d %T,%3N');
    my $dayObj = $formatter->parse_datetime($log4jts);

    return $dayObj->epoch()*1000+$dayObj->millisecond();
}

print log4jTimeStampToMillis('2009-05-10 10:48:41,905')."\n";
#prints my local version of the TS: 1241952521905 
```

这样可以省去您自己弄清楚 DST 的痛苦（尽管您必须通过`time_zone`参数将服务器的 TZ 传递给 Strptime）。如果它变得相关（我相信它会），它还可以让你免于处理跳跃的一切。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T16:18:57.963

没用过，但你可能想看看[Time::ParseDate](http://search.cpan.org/dist/Time-modules/lib/Time/ParseDate.pm)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-24T00:05:10.350

```
SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss,SSS");
Date time = dateFormat.parse(log4jts);
long millis = time.getTime(); 
```

# c# - 如何在silverlight中的xaml和c#之间共享一个数字常量

> ID：845577
> 
> 赞同：11
> 
> 时间：2009-05-10T16:05:33.597
> 
> 标签：c#, silverlight, xaml, silverlight-2.0

我是 .NET 编程的新手，正在尝试学习 Silverlight 2 / C#。

我需要声明数字常量（或者更好的是只读变量），并在 XAML 和我的 C# 代码隐藏文件中访问它们。

这些值在 XAML 中定义更合适，但如果需要在 C# 中完成定义，这比在几个地方硬编码值要好。

我找到了 WPF XAML 的解决方案，但 Silverlight 显然不支持该语法（而且我发现的解决方案要求定义位于 C# 文件中）。

蒂亚！

**回复迈克尔**

我将此回复添加为对原始问题的评论，因为评论编辑器不允许我添加这么多文本，而且我找不到其他方式来回复您的答案。

谢谢你的回答，迈克尔，但我似乎无法让它工作。

我从“Pro Silverlight 2 in c# 2008”中的一个示例开始。该示例运行良好，但需要我在 XAML 中的两个位置和 C# 中的一个位置硬编码相同的两个值。

我实现了您的解决方案，一切正常，但是当我尝试执行代码时，我在浏览器中出现页面错误。我删除了所有更改，并再次确认一切正常。

然后，我将 xmlns:sys 声明和 sys:Int32 声明添加到我的 App.xaml 文件中。一切再次运行良好，但是当我尝试在 VS2008 中查看 Page.xaml 文件时，出现了一个奇怪的错误：

未声明的前缀 [行：6 位置：30] – Page.xmal，第 1 行，第 1 列

预览页面是空白的。

Page.xaml 的第 6 行第 30 列没有什么有趣的地方，但在 App.xaml 文件中，该位置包含紧接在整数值 8 之前的结束“>”：

```
 <sys:Int32 x:Key="QAPS">8</sys:Int32> 
```

但是，如果我按 F5，则该应用程序在浏览器中运行良好。

我正在运行 VS2008 SP1 和 Mar 09 Silverlight 工具包。

我不明白为什么 App.xaml 应用程序资源部分中的 QAPS 声明会导致，特别是考虑到我在应用程序的任何地方都没有引用它。你知道会发生什么吗？

**对迈克尔的另一个回复**

你是对的，我没有将 xmlns:sys 声明添加到我的 Page.xaml 中，但添加它并没有什么不同——我仍然在 Page 中收到“未声明的前缀 [行：6 位置：30]”错误。 xaml（并且应用程序仍在运行）。由于一切运行正常，我想这一定是 VS2008 中的问题。

更大的问题是当我尝试从 C# 访问 QAPS 时遇到运行时异常，并且我已经弄清楚我做错了什么导致它。问题是我显然在资源存在之前就访问了它。

我已经声明/初始化了一个私有变量来保存类级别的资源值；当我将初始化移至事件处理程序时，问题就消失了。所以我猜想在创建 XAML 资源之前评估 C# 类级别变量。

（顺便说一句，评论的 600 个字符限制是一个真正的痛苦。事实上，我必须编辑我的原始问题才能发表回复）。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-05-11T04:25:44.977

将它们放入您的应用程序或页面资源中：

```
<Application xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
             xmlns:sys="clr-namespace:System;assembly=mscorlib">
    <Application.Resources>
        <sys:Int32 x:Key="QPS">8</sys:Int32>
    </Application.Resources>
</Application> 
```

然后您可以通过如下代码访问它们：

```
if (Application.Current.Resources.Contains("QPS"))
{
    int callsPerSecond = (int) Application.Current.Resources["QPS"];
} 
```

并通过这样的 Xaml

```
<TextBlock Text="{StaticResource QPS}"/> 
```

# javascript - 如何获取选择 HTML 和选择父项？

> ID：845581
> 
> 赞同：3
> 
> 时间：2009-05-10T16:07:56.417
> 
> 标签：javascript, dom

几年前，我在一个网络论坛中添加了[“智能引用” 。](http://www.mrfixitonline.com/viewtopic.php?t=8025)基本上，用户在之前的对话中选择一个部分并单击一个按钮来引用它。脚本获取引用的 HTML 并爬上 DOM 树以找出是谁说的。

我只能为 IE 做，虽然我记得很努力。但是那时没有 stackoverflow.com，Firefox 也没有那么成熟。我猜到现在，在 Firefox 中做这件事也很容易。这是代码的关键部分。

```
range2Copy = frameDoc.selection.createRange(); 
html2Copy = range2Copy.htmlText; 

el = range2Copy.parentElement();

// go up the HTML tree until post row node (id=postrowNNNN)

while (el.nodeName != 'BODY' &&
        !el.id.match(/postrow/)) {

    el = el.parentNode;
} 
```

元素 frameDoc 包含用户选择文本的前一个线程。如果它太没有意义，请在[此处](http://www.mrfixitonline.com/source.php?file=fckeditor/editor/plugins/quote/fckplugin.js)查看整个代码。它是 FCKeditor 的插件。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-10T16:26:59.043

好的，我尝试在 Firefox 中运行您的代码，但没有成功，这是修改后的版本：

```
var selection = window.getSelection(); 
var node = selection.anchorNode;

while (node.nodeName != 'BODY' && !node.id.match(/postrow/)){
    node = node.parentNode;
} 
```

# ios - iPhone仅在第一页隐藏导航栏

> ID：845583
> 
> 赞同：399
> 
> 时间：2009-05-10T16:09:25.260
> 
> 标签：ios, uinavigationcontroller, hide

我有下面的代码隐藏和显示导航栏。它在第一个视图加载时隐藏，然后在调用“孩子”时隐藏。麻烦的是，当他们返回根视图时，我找不到触发它再次隐藏的事件/动作......

我在根页面上有一个手动执行操作的“测试”按钮，但它并不漂亮，我希望它是自动的。

```
-(void)hideBar 
{
    self.navController.navigationBarHidden = YES;
}
-(void)showBar 
{       
    self.navController.navigationBarHidden = NO;
} 
```

* * *

## 回答 #1

> 赞同：1056
> 
> 时间：2010-03-09T01:59:42.917

我发现最好的解决方案是在第**一个视图控制器**中执行以下操作。

**Objective-C**

```
- (void)viewWillAppear:(BOOL)animated {
    [self.navigationController setNavigationBarHidden:YES animated:animated];
    [super viewWillAppear:animated];
}

- (void)viewWillDisappear:(BOOL)animated {
    [self.navigationController setNavigationBarHidden:NO animated:animated];
    [super viewWillDisappear:animated];
} 
```

**迅速**

```
override func viewWillAppear(_ animated: Bool) {
    self.navigationController?.setNavigationBarHidden(true, animated: animated)
    super.viewWillAppear(animated)
}

override func viewWillDisappear(_ animated: Bool) {
    self.navigationController?.setNavigationBarHidden(false, animated: animated)
    super.viewWillDisappear(animated)
} 
```

当您按下堆栈上的下一个时，这将导致导航栏从左侧动画（与下一个视图`UIViewController`一起），并在您按下返回按钮时向左动画（与旧视图一起）`UINavigationBar`.

另请注意，这些不是委托方法，您正在覆盖`UIViewController`这些方法的实现，并且根据文档，您**必须在您的实现中的某处调用超级的实现**。

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2011-06-20T23:11:44.073

我发现的另一种方法是为`NavigationController`：

```
navigationController.delegate = self; 
```

并`setNavigationBarHidden`用于`navigationController:willShowViewController:animated:`

```
- (void)navigationController:(UINavigationController *)navigationController 
      willShowViewController:(UIViewController *)viewController 
                    animated:(BOOL)animated 
{   
    // Hide the nav bar if going home.
    BOOL hide = viewController != homeViewController;
    [navigationController setNavigationBarHidden:hide animated:animated];
} 
```

`ViewController`在一个地方为每个人定制行为的简单方法。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2010-11-20T19:09:11.580

我必须对其他答案进行的一个细微调整是仅在 viewWillDisappear 中取消隐藏该栏，如果它消失的原因是由于导航项目被推到它上面。这是因为视图可能因其他原因而消失。

因此，如果此视图不再是最顶层视图，我只会取消隐藏栏：

```
- (void) viewWillDisappear:(BOOL)animated
{
    if (self.navigationController.topViewController != self)
    {
        [self.navigationController setNavigationBarHidden:NO animated:animated];
    }

    [super viewWillDisappear:animated];
} 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2009-05-10T16:23:58.533

我会将代码放在显示的每个视图的**viewWillAppear**委托中：

像这样你需要隐藏它：

```
- (void)viewWillAppear:(BOOL)animated
{
        [yourObject hideBar];
} 
```

像这样你需要展示它：

```
- (void)viewWillAppear:(BOOL)animated
{
        [yourObject showBar];
} 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2014-10-09T02:05:46.787

当前接受的答案与问题中描述的预期行为不匹配。该问题要求将导航栏隐藏在根视图控制器上，但在其他任何地方都可见，但接受的答案会隐藏特定视图控制器上的导航栏。当第一个视图控制器的另一个实例被压入堆栈时会发生什么？即使我们没有查看根视图控制器，它也会隐藏导航栏。

相反，@Chad M. 的使用[策略](https://stackoverflow.com/a/6418606/2434476)`UINavigationControllerDelegate`是一个很好的策略，这里有一个更完整的解决方案。脚步：

1.  子类`UINavigationController`
2.  `-navigationController:willShowViewController:animated`根据是否显示根视图控制器实现显示或隐藏导航栏的方法
3.  重写初始化方法以将 UINavigationController 子类设置为其自己的委托

此解决方案的完整代码可在[此 Gist](https://gist.github.com/hspinks/d2167ff08341720662bf)中找到。这是`navigationController:willShowViewController:animated`实现：

```
- (void)navigationController:(UINavigationController *)navigationController willShowViewController:(UIViewController *)viewController animated:(BOOL)animated
{
    /* Hide navigation bar if root controller */
    if ([viewController isEqual:[self.viewControllers firstObject]]) {
        [self setNavigationBarHidden:YES animated:animated];
    } else {
        [self setNavigationBarHidden:NO animated:animated];
    }
} 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2015-02-05T15:15:12.157

在斯威夫特 3 中：

```
override func viewWillAppear(_ animated: Bool) {
    navigationController?.navigationBar.isHidden = true
    super.viewWillAppear(animated)
}

override func viewWillDisappear(_ animated: Bool) {
    if (navigationController?.topViewController != self) {
        navigationController?.navigationBar.isHidden = false
    }
    super.viewWillDisappear(animated)
} 
```

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2018-09-26T05:07:24.273

将我的功劳归功于@chad-m 的回答。

这是斯威夫特版本：

1.  创建一个新文件`MyNavigationController.swift`

* * *

```
import UIKit

class MyNavigationController: UINavigationController, UINavigationControllerDelegate {

    override func viewDidLoad() {
        super.viewDidLoad()

        // Do any additional setup after loading the view.
        self.delegate = self
    }

    func navigationController(_ navigationController: UINavigationController, willShow viewController: UIViewController, animated: Bool) {
        if viewController == self.viewControllers.first {
            self.setNavigationBarHidden(true, animated: animated)
        } else {
            self.setNavigationBarHidden(false, animated: animated)
        }
    }

} 
```

2.  将 StoryBoard 中的 UINavigationController 类设置为 MyNavigationController **就是这样！**[![我的导航控制器](https://i.stack.imgur.com/543Uh.jpg)](https://i.stack.imgur.com/543Uh.jpg)

 **chad-m 的答案和我的区别：

1.  从 UINavigationController 继承，所以你不会污染你的 rootViewController。

2.  使用`self.viewControllers.first`而不是`homeViewController`，因此您不会为 1 个 StoryBoard 中的 100 个 UINavigationController 执行此操作 100 次。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2011-12-11T17:14:42.877

经过多次试验，这是我如何让它达到我想要的效果。这就是我正在尝试的。- 我有一个图像视图。我想让图像全屏显示。- 我也有一个带有 tabBar 的导航控制器。所以我也需要隐藏它。- 另外，我的主要要求不仅是隐藏，而且在显示和隐藏时也要具有褪色效果。

这就是我让它工作的方式。

第 1 步 - 我有一张图片，用户点击该图片一次。我捕捉到那个手势并将其推入新的`imageViewController`，它在`imageViewController`，我想要全屏图像。

```
- (void)handleSingleTap:(UIGestureRecognizer *)gestureRecognizer {  
NSLog(@"Single tap");
ImageViewController *imageViewController =
[[ImageViewController alloc] initWithNibName:@"ImageViewController" bundle:nil];

godImageViewController.imgName  = // pass the image.
godImageViewController.hidesBottomBarWhenPushed=YES;// This is important to note. 

[self.navigationController pushViewController:godImageViewController animated:YES];
// If I remove the line below, then I get this error. [CALayer retain]: message sent to deallocated instance . 
// [godImageViewController release];
} 
```

第 2 步 - 以下所有这些步骤都在 ImageViewController 中

步骤 2.1 - 在 ViewDidLoad 中，显示导航栏

```
- (void)viewDidLoad
{
[super viewDidLoad];
// Do any additional setup after loading the view from its nib.
NSLog(@"viewDidLoad");
[[self navigationController] setNavigationBarHidden:NO animated:YES];
} 
```

步骤 2.2 - 在`viewDidAppear`中，设置一个有延迟的计时器任务（我将其设置为 1 秒延迟）。并在延迟后添加淡入淡出效果。我正在使用 alpha 来使用淡入淡出。

```
- (void)viewDidAppear:(BOOL)animated
{
NSLog(@"viewDidAppear");

myTimer = [NSTimer scheduledTimerWithTimeInterval:1.0 target:self     selector:@selector(fadeScreen) userInfo:nil repeats:NO];
}

- (void)fadeScreen
{
[UIView beginAnimations:nil context:nil]; // begins animation block
[UIView setAnimationDuration:1.95];        // sets animation duration
self.navigationController.navigationBar.alpha = 0.0;       // Fades the alpha channel of   this view to "0.0" over the animationDuration of "0.75" seconds
[UIView commitAnimations];   // commits the animation block.  This Block is done.
} 
```

步骤 2.3 - 在 下`viewWillAppear`，向图像添加 singleTap 手势并使导航栏半透明。

```
- (void) viewWillAppear:(BOOL)animated
{

NSLog(@"viewWillAppear");

NSString *path = [[NSBundle mainBundle] pathForResource:self.imgName ofType:@"png"];

UIImage *theImage = [UIImage imageWithContentsOfFile:path];

self.imgView.image = theImage;

// add tap gestures 
UITapGestureRecognizer *singleTap = [[UITapGestureRecognizer alloc] initWithTarget:self action:@selector(handleTap:)];  
[self.imgView addGestureRecognizer:singleTap];  
[singleTap release];  

// to make the image go full screen
self.navigationController.navigationBar.translucent=YES;
}

- (void)handleTap:(UIGestureRecognizer *)gestureRecognizer 
{ 
 NSLog(@"Handle Single tap");
 [self finishedFading];
  // fade again. You can choose to skip this can add a bool, if you want to fade again when user taps again. 
 myTimer = [NSTimer scheduledTimerWithTimeInterval:5.0 target:self  selector:@selector(fadeScreen) userInfo:nil repeats:NO];
 } 
```

第 3 步 - 最后`viewWillDisappear`，确保将所有东西放回原处

```
- (void)viewWillDisappear: (BOOL)animated 
{ 
self.hidesBottomBarWhenPushed = NO; 
self.navigationController.navigationBar.translucent=NO;

if (self.navigationController.topViewController != self)
{
    [self.navigationController setNavigationBarHidden:NO animated:animated];
}

[super viewWillDisappear:animated];
} 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2016-08-02T07:01:40.823

如@fabb在接受的答案中评论的那样，如果有人仍然遇到**快速后退取消错误的问题。**

我设法通过覆盖来解决这个问题`viewDidLayoutSubviews`，除了`viewWillAppear/viewWillDisappear`如下所示：

```
override func viewWillAppear(animated: Bool) {
    super.viewWillAppear(animated)
    self.navigationController?.setNavigationBarHidden(false, animated: animated)
}

override func viewWillDisappear(animated: Bool) {
    super.viewWillDisappear(animated)
    self.navigationController?.setNavigationBarHidden(true, animated: animated)
}

//*** This is required to fix navigation bar forever disappear on fast backswipe bug.
override func viewDidLayoutSubviews() {
    super.viewDidLayoutSubviews()
    self.navigationController?.setNavigationBarHidden(false, animated: false)
} 
```

在我的例子中，我注意到这是因为根视图控制器（隐藏导航）和推送视图控制器（显示导航）**具有不同的状态栏样式**（例如深色和浅色）。当您开始向后滑动以弹出视图控制器的那一刻，将会有额外的状态栏颜色动画。如果您松开手指以取消交互弹出，**而状态栏动画尚未完成**，导航栏将永远消失！

但是，如果两个视图控制器的状态栏样式相同，则不会发生此错误。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-05-11T05:03:52.777

如果您想要将导航栏完全隐藏在控制器中，则更简洁的解决方案是在根控制器中具有以下内容：

```
@implementation MainViewController
- (void)viewDidLoad {
    self.navigationController.navigationBarHidden=YES;
    //...extra code on view load  
} 
```

当您在控制器中推送子视图时，导航栏将保持隐藏状态；如果您只想在子项中显示它，您将添加`it(self.navigationController.navigationBarHidden=NO;)`在`viewWillAppear`回调中显示的代码，以及类似的隐藏它的代码`viewWillDisappear`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-11-30T23:18:02.677

`viewWillAppear:animated:`最简单的实现可能是让每个视图控制器在其方法中指定其导航栏是否隐藏。同样的方法也适用于隐藏/显示工具栏：

```
- (void)viewWillAppear:(BOOL)animated {
    [self.navigationController setToolbarHidden:YES/NO animated:animated];
    [super viewWillAppear:animated];
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-02-23T14:38:34.720

仅在第一页隐藏导航栏也可以通过情节提要实现。在情节提要上，转到*Navigation Controller Scene->Navigation Bar*。*并从属性检查*器中选择“*隐藏*”属性。这将从第一个视图控制器开始隐藏导航栏，直到它对所需的视图控制器可见。

 *导航栏可以在 ViewController 的 ViewWillAppear 回调中重新设置为可见。

```
-(void)viewWillAppear:(BOOL)animated {

    [self.navigationController setNavigationBarHidden:YES animated:animated];
    [super viewWillAppear:animated];                                                  
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-02-20T13:57:54.443

**斯威夫特 4：**

在要隐藏导航栏的视图控制器中。

```
override func viewWillAppear(_ animated: Bool) {
    self.navigationController?.setNavigationBarHidden(true, animated: animated)
    super.viewWillAppear(animated)
}

override func viewWillDisappear(_ animated: Bool) {
    self.navigationController?.setNavigationBarHidden(false, animated: animated)
    super.viewWillDisappear(animated)
} 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2016-08-02T11:31:59.900

通过在您的 ViewController 中实现此代码，您可以获得此效果实际上诀窍是，在启动该控制器时隐藏导航栏

```
- (void)viewWillAppear:(BOOL)animated {
    [self.navigationController setNavigationBarHidden:YES animated:YES];
    [super viewWillAppear:animated];
} 
```

并在用户离开该页面时取消隐藏导航栏，这是 viewWillDisappear

```
- (void)viewWillDisappear:(BOOL)animated {
    [self.navigationController setNavigationBarHidden:NO animated:YES];
    [super viewWillDisappear:animated];
} 
```

# batch-file - 批处理文件没有正确退出循环？

> ID：845585
> 
> 赞同：0
> 
> 时间：2009-05-10T16:10:26.490
> 
> 标签：batch-file

我正在处理一个批处理文件来收集我的两个子网客户端的mac地址但是由于某种原因我的批处理文件没有正确结束第一个循环，所以第二个循环没有被执行，因此脚本的其余部分不是被执行。关于为什么会发生这种情况的任何想法？

```
for /L %%i in (1,1,254) do ping.bat 192.168.232 %%i
for /L %%i in (1,1,254) do ping.bat 192.168.233 %%i
REM Some other stuff goes on here but the second loop never gets executed 
```

非常感谢提前

**编辑：** ping.bat 仅包含以下内容：

```
nbtstat -A %1.%2 
```

通过 NetBIOS 获取 MAC 地址

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T16:36:56.910

启动批处理文件会中止“母亲”批处理文件。虽然她似乎完成了当前的线路；你的第一个 FOR 循环实际上被执行了 254 次。

添加 CALL 语句将解决此问题：

```
for /L %%i in (1,1,254) do call ping.bat 192.168.232 %%i
for /L %%i in (1,1,254) do call ping.bat 192.168.233 %%i
echo Test complete! 
```

在引入 CALL 语句之前，这是通过在命令解释器的新实例中运行子批处理文件来解决的：

```
for /L %%i in (1,1,254) do COMMAND /C ping.bat 192.168.232 %%i 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T16:14:33.990

很可能它正在等待另一端的响应。你没有尝试减少超时吗？我建议你添加一个虚拟计数器来检查它是在等待响应还是挂起.. :-)

# unix - 如何将子目录解压到当前目录？

> ID：845593
> 
> 赞同：59
> 
> 时间：2009-05-10T16:14:43.037
> 
> 标签：unix, command-line, tar

如何将 tarball 中的子目录提取到当前目录中？

例如，来自[wordpress](http://wordpress.org/download/)的压缩包：

```
wordpress/
wordpress/wp-trackback.php
wordpress/wp-config-sample.php
wordpress/wp-settings.php
wordpress/wp-rss2.php
wordpress/readme.html
wordpress/index.php
... 
```

如何将所有内容提取`wordpress/`到当前目录中？换句话说，它不会创建`wordpress`目录。

我试过这个没有运气：

```
tar xvfz latest.tar.gz wordpress -C ./ 
```

我知道我可以正常提取它并将其移回，但我认为必须有一种方法可以一次性完成。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2009-05-10T16:19:31.830

你为什么不正常解压，然后只是：

```
mv wordpress/.* .
mv wordpress/* .
rmdir wordpress 
```

但很可惜，有：

```
tar --strip-components=1 -zxvf wordpress.tgz 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-10T16:30:25.250

令人惊讶的是，我的`tar`（GNU tar v1.16）没有删除初始路径名元素的选项。

但是，似乎更新的版本带有一个`--strip-components=number`参数，它将从路径的开头剥离那么多组件。

如果像我一样，您使用的是较旧的`tar`，并且您确定存档不包含名为 的目录或文件`wordpress/wordpress`，您总是可以从`wordpress`to创建一个符号链接`.`，然后像往常一样提取：

```
ln -s . wordpress
tar xvfz latest.tar.gz wordpress
rm wordpress 
```

# ruby-on-rails - 不确定在哪里（模型或控制器）定义我的 find 方法

> ID：845607
> 
> 赞同：2
> 
> 时间：2009-05-10T16:24:24.570
> 
> 标签：ruby-on-rails, ruby, model, controller

（警告：无知的 Rails 新手！）

在我的相册视图的 show.html.erb 中，我**在相册控制器中调用了一个公共方法**：

```
<% albums_feature = find_albums_with_feature(feature.id) %> 
```

它生成一个*NoMethodError*。

所以我**将该方法复制到我的相册模型**中，并尝试从视图中调用它：

```
<% albums_feature = Album.find_albums_with_feature(feature.id) %> 
```

但这也会得到一个*NoMethodError*。

**我应该在哪里定义这个方法？**

对于它的价值，该方法如下所示：

```
 def find_albums_with_feature(feature_id)
    albums_for_feature = Albums.find_by_sql(  
    ["select al.* from albums al, albums_features alfe
    where al.id = alfe.album_id
    and alfe.feature_id = ?", feature_id])
  end 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-10T16:42:45.327

如果您想拥有可从视图中访问的方法，您有几个选择：

*   把它放在模型中
*   把它放在助手中
*   把它放在控制器中并添加一行“helper_method：find_albums_with_feature”

但我认为你可以做得更好。首先，不要把任何寻找方法放在眼里。将其放入控制器中。其次，您不需要指定自己的查找方法。可能你的模型中有这样的东西：

```
class Album << ActiveRecord::Base
  has_many :albums_features
  has_many :features, :through => :albums_features
end

class AlbumsFeature << ActiveRecord::Base
  belongs_to :album
  belongs_to :feature
end

class Feature << ActiveRecord::Base
  has_many :albums_features
  has_many :albums, :through => :albums_features
end 
```

有了它，您可以找到具有以下特定功能的专辑：

```
@feature = Feature.find(id)
@albums = @feature.albums 
```

或者

```
@albums = Feature.find(id).albums 
```

它应该在您的控制器中。在视图中，您应该只显示结果。

如果您正在寻找有关协会的更多信息，请查看此处： http: [//guides.rubyonrails.org/association_basics.html](http://guides.rubyonrails.org/association_basics.html)。我认为这是了解 Rails 的最佳场所——至少对我来说是这样。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T16:28:20.667

在相册模型中。虽然需要自己在前面：

```
def self.find_albums_with_feature(feature_id) 
```

# python - GAE中的后台进程

> ID：845620
> 
> 赞同：3
> 
> 时间：2009-05-10T16:37:19.563
> 
> 标签：python, django, google-app-engine, backgroundworker

我正在使用 Google App Engine 和 Django 1.0 (app-engine-patch) 开发一个网站

我的程序的主要部分必须在后台运行并更改本地数据并发布到远程 URL

有人可以提出一种有效的方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-06-23T02:39:40.520

查看[任务队列 Python API](http://code.google.com/appengine/docs/python/taskqueue/)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T16:41:32.193

在不使用第三方系统的情况下，我认为目前您唯一的选择是使用[cron 功能](http://code.google.com/appengine/docs/python/config/cron.html)。

您仍然会受到通常的 GAE 脚本执行时间限制的约束，但它不会在页面加载时发生。

有后台处理计划，请参阅[此 App Engine 问题 #6](http://code.google.com/p/googleappengine/issues/detail?id=6)和此[路线图更新](http://googleappengine.blogspot.com/2009/02/roadmap-update.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T17:12:46.507

我支持 dbr 对[http://code.google.com/appengine/docs/python/config/cron.html](http://code.google.com/appengine/docs/python/config/cron.html)的建议（并希望未来有更好的方法，例如承诺的“任务队列”）。

尽管如此，我怀疑如果您确实需要*主要*的（如*CPU 繁重的*）后台处理，GAE 可能不是最适合的环境。您可能需要考虑在其他环境中运行那些繁重的后台任务，并让它们与 GAE 正确通信，例如通过“批量加载/下载”API，请参阅[http://code.google.com/appengine/docs/python/tools /uploadingdata.html](http://code.google.com/appengine/docs/python/tools/uploadingdata.html)（以及下载部分的[http://code.google.com/appengine/docs/python/tools/uploadingdata.html#Downloading_Data_from_App_Engine ）。](http://code.google.com/appengine/docs/python/tools/uploadingdata.html#Downloading_Data_from_App_Engine)

Google 的文档仅描述了命令行 appcfg.py 用于这些目的的用法（我找不到它使用的 API 的适当文档！），但是，如果您确实需要更多地以编程方式使用这些 API，这并不难从 appcfg.py 的来源证明它们。

# objective-c - 在 Objective-C 中加入一个数组

> ID：845622
> 
> 赞同：130
> 
> 时间：2009-05-10T16:38:06.393
> 
> 标签：objective-c, nsmutablearray, nsarray

我正在寻找一种将 NSMutableArray 转换为字符串的方法。有什么可以与这个 Ruby 数组方法相提并论的吗？

```
>> array1 = [1, 2, 3]
>> array1.join(',')
=> "1,2,3" 
```

干杯!

* * *

## 回答 #1

> 赞同：279
> 
> 时间：2009-05-10T16:50:51.060

```
NSArray  *array1 = [NSArray arrayWithObjects:@"1", @"2", @"3", nil];
NSString *joinedString = [array1 componentsJoinedByString:@","]; 
```

[`componentsJoinedByString:`](https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/NSArray.html#//apple_ref/occ/instm/NSArray/componentsJoinedByString:)将通过指定的字符串连接数组中的组件并返回数组的字符串表示形式。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-05-10T16:50:57.487

您正在寻找的方法是`componentsJoinedByString`.

```
NSArray  *a = [NSArray arrayWithObjects:@"1", @"2", @"3", nil];//returns a pointer to NSArray
NSString *b = [a componentsJoinedByString:@","];//returns a pointer to NSString
NSLog(@"%@", b); // Will output 1,2,3 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-10T16:51:46.580

[`NSArray`类参考](https://developer.apple.com/library/mac/#documentation/Cocoa/Reference/Foundation/Classes/NSArray_Class/NSArray.html)：

```
NSArray *pathArray = [NSArray arrayWithObjects:@"here",
    @"be", @"dragons", nil];
NSLog(@"%@",
    [pathArray componentsJoinedByString:@" "]); 
```

# c# - 在 .NET 中加密短字符串的最佳方法是什么？

> ID：845623
> 
> 赞同：8
> 
> 时间：2009-05-10T16:39:56.737
> 
> 标签：c#, .net, security

我的老板希望我对数据传输过程中使用的一些信息进行加密。要加密的单个字符串的长度在 8 到 20 个字符之间。必须使用单个密码来加密和解密，所以我需要一个对称算法。我不想自己动手——我想使用 C# 中内置的 .NET。

那么，哪种算法最好呢？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-10T16:46:43.047

三重？

您可以使用[`System.Security.Cryptography.TripleDESCryptoServiceProvider`](http://msdn.microsoft.com/en-us/library/system.security.cryptography.tripledescryptoserviceprovider.aspx)

用于加密/解密的少量代码......完全符合它在锡上所说的：）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-05-10T16:58:34.327

TripleDES 是一个很好的选择，但您也可以考虑[AesCryptoServiceProvider](http://msdn.microsoft.com/en-us/library/system.security.cryptography.aescryptoserviceprovider.aspx) (AES)，它是一种现代对称密码。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-10T16:58:36.603

.net 安全类：

哈希

```
* MD5
* MD5Cng
* SHA1
* SHA1Managed
* SHA1Cng
* SHA256
* SHA256Managed
* SHA256Cng
* SHA384
* SHA384Managed
* SHA384Cng
* SHA512
* SHA512Managed
* SHA512Cng 
```

对称加密：使用相同的密钥进行加密和解密。

```
* DES
* DESCryptoServiceProvider
* TripleDES
* TripleDESCryptoServiceProvider
* Aes
* AesCryptoServiceProvider
* AesManaged
* RC2
* RC2CryptoServiceProvider
* Rijandel
* RijandelManaged 
```

非对称加密：使用不同的密钥进行加密和解密。

```
* DSA
* DSACryptoServiceProvider
* ECDsa
* ECDsaCng
* ECDiffieHellman
* ECDiffieHellmanCng
* RSA
* RSACryptoServideProvider 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-10T17:00:31.407

这是使用des3加密的加密和解密功能

```
''' <summary>
''' Encrypts a memory string (i.e. variable).
''' </summary>
''' <param name="data">String to be encrypted.</param>
''' <param name="key">Encryption key.</param>
''' <param name="iv">Encryption initialization vector.</param>
''' <returns>Encrypted string.</returns>
Public Shared Function Encrypt(ByVal data As String, ByVal key As String, ByVal iv As String) As String
    Dim bdata As Byte() = Encoding.ASCII.GetBytes(data)
    Dim bkey As Byte() = HexToBytes(key)
    Dim biv As Byte() = HexToBytes(iv)

    Dim stream As MemoryStream = New MemoryStream
    Dim encStream As CryptoStream = New CryptoStream(stream, des3.CreateEncryptor(bkey, biv), CryptoStreamMode.Write)

    encStream.Write(bdata, 0, bdata.Length)
    encStream.FlushFinalBlock()
    encStream.Close()

    Return BytesToHex(stream.ToArray())
End Function

''' <summary>
''' Decrypts a memory string (i.e. variable).
''' </summary>
''' <param name="data">String to be decrypted.</param>
''' <param name="key">Original encryption key.</param>
''' <param name="iv">Original initialization vector.</param>
''' <returns>Decrypted string.</returns>
Public Shared Function Decrypt(ByVal data As String, ByVal key As String, ByVal iv As String) As String
    Dim bdata As Byte() = HexToBytes(data)
    Dim bkey As Byte() = HexToBytes(key)
    Dim biv As Byte() = HexToBytes(iv)

    Dim stream As MemoryStream = New MemoryStream
    Dim encStream As CryptoStream = New CryptoStream(stream, des3.CreateDecryptor(bkey, biv), CryptoStreamMode.Write)

    encStream.Write(bdata, 0, bdata.Length)
    encStream.FlushFinalBlock()
    encStream.Close()

    Return Encoding.ASCII.GetString(stream.ToArray())
End Function 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-10T16:52:49.027

您可以只使用 RSA 加密，因为这些是短字符串，这将使密钥交换更简单。

您可以使用 RSA 加密多少取决于密钥长度。

我是充气城堡 rsa 图书馆的粉丝。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-11T01:18:15.517

DES 在这一点上已经过时了。这是[维基百科](http://en.wikipedia.org/wiki/Data_Encryption_Standard)。如果您要大量更改密钥，它可能就足够了，但如果您依赖密钥一段时间，AES 似乎是一个更好的选择。

当然，这是您需要多少保护的问题。但是 AES 也在那里构建。

我已经将 AES 用于小字符串，并且效果很好。

我读到的关于 TripleDES 的内容是，由于 DES 很容易破解，所以 TripleDES 仍然不是很重要。

# artificial-intelligence - 如何使用 A-star (A*) 找到最“自然”的直达路线

> ID：845626
> 
> 赞同：4
> 
> 时间：2009-05-10T16:42:00.850
> 
> 标签：artificial-intelligence, path-finding, a-star

我已经在 AS3 中实现了 A* 算法，它工作得很好，除了一件事。生成的路径通常不会采用最“自然”或最顺畅的路线到达目标。在我的环境中，对象可以像水平或垂直移动一样便宜地沿对角线移动。这是一个非常简单的例子；起点用 S 标记，终点（或终点）用 F 标记。

```
 | | | | | | | | | |
 |S| | | | | | | | |
x| | | | | | | | | |
x| | | | | | | | | |
x| | | | | | | | | |
x| | | | | | | | | |
x| | | | | | | | | |
 |F| | | | | | | | |
 | | | | | | | | | |
 | | | | | | | | | | 
```

如您所见，在第一轮查找过程中，节点 [0,2]、[1,2]、[2,2] 都将被添加到可能节点列表中，因为它们的得分均为 N。当我试图决定继续使用哪个节点时，我遇到的问题出现在下一点。在上面的示例中，我使用 possibleNodes[0] 来选择下一个节点。如果我将其更改为 possibleNodes[possibleNodes.length-1] 我得到以下路径。

```
 | | | | | | | | | |
 |S| | | | | | | | |
 | |x| | | | | | | |
 | | |x| | | | | | |
 | | | |x| | | | | |
 | | |x| | | | | | |
 | |x| | | | | | | |
 |F| | | | | | | | |
 | | | | | | | | | |
 | | | | | | | | | | 
```

然后使用 possibleNextNodes[Math.round(possibleNextNodes.length / 2)-1]

```
 | | | | | | | | | |
 |S| | | | | | | | |
 |x| | | | | | | | |
x| | | | | | | | | |
x| | | | | | | | | |
x| | | | | | | | | |
x| | | | | | | | | |
 |F| | | | | | | | |
 | | | | | | | | | |
 | | | | | | | | | | 
```

所有这些路径都具有相同的成本，因为它们都包含相同数量的步骤，但在这种情况下，最明智的路径如下......

```
 | | | | | | | | | |
 |S| | | | | | | | |
 |x| | | | | | | | |
 |x| | | | | | | | |
 |x| | | | | | | | |
 |x| | | | | | | | |
 |x| | | | | | | | |
 |F| | | | | | | | |
 | | | | | | | | | |
 | | | | | | | | | | 
```

是否有一种正式接受的方法可以使路径看起来更合理，而不仅仅是在数学上正确？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-10T16:44:21.440

您需要在启发式函数中添加一个 Tie-breaker。这里的问题是有许多路径具有相同的成本。

对于有利于直接路由的简单决胜局，您可以使用叉积。即，如果 S 是开始，E 是结束，并且 X 是算法中的当前位置，您可以计算 SE 和 XE 的叉积，并在启发式中添加惩罚，它离 0 越远（= 直接路线）。

在代码中：

```
 dx1 = current.x - goal.x
 dy1 = current.y - goal.y
 dx2 = start.x - goal.x
 dy2 = start.y - goal.y
 cross = abs(dx1*dy2 - dx2*dy1)
 heuristic += cross*0.001 
```

另请参阅[http://theory.stanford.edu/~amitp/GameProgramming/Heuristics.html#S12](http://theory.stanford.edu/~amitp/GameProgramming/Heuristics.html#S12)，这是一个关于 A* 的优秀教程。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T16:46:48.927

如果您想要看起来自然的路径，您需要确保您的成本对应于笛卡尔坐标系上的长度。这意味着对角移动的成本应该是 sqrt(2) 乘以垂直或水平移动的成本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-27T13:16:40.023

您可以在每个方格的成本计算中添加“控制努力”。演员将尽量不要过度转向或改变方向，因为这会增加路径的成本：

[http://angryee.blogspot.com/2009/03/better-pathfinding.html](http://angryee.blogspot.com/2009/03/better-pathfinding.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T16:51:16.800

如果我没记错的话，这样做的诀窍是在成本函数中添加一个额外的参数（对于相邻节点之间的每一步，或者在您的情况下为正方形），它*会*比正常情况稍微多一些（例如，相对成本更大比`sqrt(2)`对角线移动）。现在，在平滑路径和实际降低路径的最优性（延长它）之间可能有一条细线，但是您将无法以任何方式避免这种情况。您需要发现特定于您自己的应用程序的某种权衡，而这只能通过测试来实现。

我相信在游戏开发网站上有一篇文章详细说明了如何做到这一点，但我目前似乎找不到。无论如何都要玩弄你的成本函数，看看你得到了什么结果——我很确定这是要走的路。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-10T16:47:26.587

什么更“明智”？更直？如果算法要对它做任何事情，你需要正确地量化它。

由于对角线移动与水平/垂直移动一样便宜，因此根据 A* 可用的所有标准，所有路径都是等效的。如果您想要一条更“合理”的路径，您需要告诉算法某些路径比其他路径更可取，有效地将水平/垂直加权为“比对角线更好”。据我所知，这将改变您的环境参数。

# c# - WPF：将元素添加到数据绑定集合（依赖属性）

> ID：845636
> 
> 赞同：1
> 
> 时间：2009-05-10T16:47:16.210
> 
> 标签：c#, wpf, data-binding, xaml, dependency-properties

我有这个`DependencyProperty`包含一个属性为集合（`ShoutBox.Entities`）的实体：

```
public static readonly DependencyProperty ShoutBoxProperty = DependencyProperty.Register("ShoutBox",typeof (ShoutBox),typeof (ShoutBoxViewerControl));

public ShoutBox ShoutBox
{
    get { return (ShoutBox) GetValue(ShoutBoxProperty); }
    set { SetValue(ShoutBoxProperty, value); }
} 
```

`xaml`它像这样被绑定：

```
<ItemsControl ItemsSource="{Binding ShoutBox.Entries}">
.
.
</ItemsControl> 
```

当我第一次绑定它时，它按预期工作，但有时我需要将项目添加到集合中（使用同一控件中的方法），如下所示：

```
public void AddNewEntry(ShoutBoxEntry newEntry)
{
    Dispatcher.Invoke(new Action(() =>{
        ShoutBox.Entries.Add(newEntry); //Adding directly the the Dependency property
    }));
} 
```

问题是当我使用上述方法添加一个新元素时，该项目没有显示在`ItemsControl`.

* * *

我的问题是，**为什么我添加的新元素没有显示在`ItemsControl`**?

* * *

**[编辑]**

`Entries`( *ShoutBox.Entries* ) 是类型`List<ShoutBoxEntry>`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T16:50:44.257

参赛作品的类型是什么？它要么需要 ObservableCollection，要么实现 ICollectionChanged。否则绑定不知道已添加新项目。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T22:58:52.810

更改条目的类型确实应该可以解决问题...如果您想避免显式调用 Dispatcher.Invoke，我编写了一个集合，该集合在创建集合的线程上引发 CollectionChanged 和 PropertyChanged 事件：

```
public class AsyncObservableCollection<T> : ObservableCollection<T>
{
    private SynchronizationContext _synchronizationContext = SynchronizationContext.Current;

    public AsyncObservableCollection()
    {
    }

    public AsyncObservableCollection(IEnumerable<T> list)
        : base(list)
    {
    }

    protected override void OnCollectionChanged(NotifyCollectionChangedEventArgs e)
    {
        if (SynchronizationContext.Current == _synchronizationContext)
        {
            // Execute the CollectionChanged event on the current thread
            RaiseCollectionChanged(e);
        }
        else
        {
            // Post the CollectionChanged event on the creator thread
            _synchronizationContext.Post(RaiseCollectionChanged, e);
        }
    }

    private void RaiseCollectionChanged(object param)
    {
        // We are in the creator thread, call the base implementation directly
        base.OnCollectionChanged((NotifyCollectionChangedEventArgs)param);
    }

    protected override void OnPropertyChanged(PropertyChangedEventArgs e)
    {
        if (SynchronizationContext.Current == _synchronizationContext)
        {
            // Execute the PropertyChanged event on the current thread
            RaisePropertyChanged(e);
        }
        else
        {
            // Post the PropertyChanged event on the creator thread
            _synchronizationContext.Post(RaisePropertyChanged, e);
        }
    }

    private void RaisePropertyChanged(object param)
    {
        // We are in the creator thread, call the base implementation directly
        base.OnPropertyChanged((PropertyChangedEventArgs)param);
    }
} 
```

更多细节可以在这里找到： [http ://www.thomaslevesque.com/2009/04/17/wpf-binding-to-an-asynchronous-collection/](http://www.thomaslevesque.com/2009/04/17/wpf-binding-to-an-asynchronous-collection/)

# wcf - JSON WCF 安全性

> ID：845639
> 
> 赞同：1
> 
> 时间：2009-05-10T16:48:34.213
> 
> 标签：wcf, json

启用 JSON 的 WCF 服务是否安全，因为它们携带人类可读的字符串 任何有关启用 JSON 的 WCF 安全性的文章都会有所帮助。（链接）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T16:50:27.893

启用 JSON 的 WCF 服务是基于 REST 的——这些服务基本上以明文形式传输所有内容，因此为了获得任何防止窥探的保护，您必须使用 SSL 加密来保护传输层。

马克

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T16:56:31.973

WCF 只是一个使通信更简单的框架，它本身并不能保证任何安全。

JSON 只是一种传输数据的好方法，尤其是在发送到网页时，因为它比 xml 更紧凑，并且由于 JSON 是为 javascript 制作的，因此 javascript 可以比 xml 更快地解析 JSON。

如果您有任何敏感信息，您可以加密该特定数据，也可以只使用 SSL 连接，但这会影响性能。

# sql - 查询后如何查找行？

> ID：845641
> 
> 赞同：0
> 
> 时间：2009-05-10T16:49:26.100
> 
> 标签：sql, sql-server

我有一个查询，我需要找到查询返回答案的行号。我没有计数器字段。我该怎么做？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T17:13:40.280

```
SELECT 
  ROW_NUMBER() OVER (<your_id_field_here> ORDER BY <field_here>) as RowNum,
  <the_rest_of_your_fields_here>
FROM
  <my_table> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T17:50:57.353

如果您有主键，则可以在 SQL Server 2005 及更高版本上使用此方法：

```
SELECT 
  ROW_NUMBER() OVER (ORDER BY PrimaryKeyField) as RowNumber,
  Field1,
  Field2
FROM
  YourSourceTable 
```

如果您没有主键，您可能需要做的是使用如下方法将您的表复制到内存表（或临时表，如果它非常大）：

```
DECLARE @NewTable table (
    RowNumber BIGINT IDENTITY(1,1) PRIMARY KEY,
    Field1 varchar(50),
    Field2 varchar(50),
)

INSERT INTO @NewTable
    (Field1, Field2)
SELECT
    Field1,
    Field2
FROM
    YourSourceTable

SELECT
    RowNumber,
    Field1,
    Field2
FROM
    @NewTable 
```

关于这一点的好处是，如果您的源表没有主键，您将能够检测到相同的行。

此外，在这一点上，我建议为您拥有的每个表添加一个主键，如果它们还没有的话。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T04:11:40.850

创建表 t1 (N1 int ,N2 int)

插入 t1 选择 200,300

插入 t1 选择 200,300

插入 t1 选择 300,400

插入 t1 选择 400,400 ..... ......

选择 row_number() over (order by [N1]) RowNumber,* from t1

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T09:22:43.713

> 我有一个查询，我需要找到查询返回答案的行号。我没有任何计数器字段。我怎么做？

如果我正确理解您的问题，则您有某种查询返回一行或几行（答案，答案），并且您希望将行号与*“答案”相关联*

正如您所说，您没有任何计数器字段，因此您需要执行以下操作：

*   决定订购标准
*   添加计数器
*   运行查询

如果您为您的问题提供更多详细信息，这将非常有帮助。如果您确认我正确理解了您的问题，我将添加一个代码示例

# video - 汇编语言入门视频教程？

> ID：845647
> 
> 赞同：4
> 
> 时间：2009-05-10T16:51:08.047
> 
> 标签：video, assembly

我看过很多基于文本的组装教程，但发现很难从中学习。汇编语言有哪些视频教程？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-10T16:59:31.517

昨天在 Reddit 编程部分找到了这个链接，看起来不错：

它有 10 个部分，发布第 1 部分。其余链接在下面的文章中。

[http://securitytube.net/Assembly-Primer-for-Hackers-(Part-1)-System-Organization-video.aspx](http://securitytube.net/Assembly-Primer-for-Hackers-(Part-1)-System-Organization-video.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T17:01:06.897

我在这个查询中发现了很多好东西：

> [**谷歌查询：** *汇编语言教程视频*](http://www.google.com/search?q=assembly+language+tutorial+video&ie=utf-8&oe=utf-8&aq=t&rls=org.mozilla:en-US:official&client=firefox-a)

其中，第一个看起来不错：

> [汇编语言教程（5 个视频）Neil Dickson 的一系列视频教程](http://showmedo.com/videotutorials/series?name=qdrYRTz8Z)

# diff - 有没有办法逐句而不是逐行区分文件？

> ID：845650
> 
> 赞同：10
> 
> 时间：2009-05-10T16:52:45.893
> 
> 标签：diff, word-diff

只是试图让 diff 对某些类型的文档更好地工作。以 LaTeX 为例，我可能有一个很长的段落，严格来说只有一行，但如果只更改了一个句子，我不想看到整个段落。特别是如果我正在运行某种版本控制并且共同作者与我编辑相同的段落（但不是相同的句子）。我不希望这表现为冲突。

这是次要问题。主要问题是我是否可以使用 diff 逐句查看。谢谢。

**编辑**

`wdiff`几乎是完美的。`diff`但是是否有一个合并等价物，就像`diff3`?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-10T17:02:55.723

[`wdiff`](http://www.gnu.org/software/wdiff/)会给你一个逐字的差异而不是逐行。我不知道有任何逐句差异程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T17:39:23.503

在区分文件之前预处理文件。编写一个脚本每行写一个句子，任何逐行差异程序都可以工作。

为了确保我的 CVS 合并是正确的，我在 C 令牌级别上完成了此操作以区分 C 代码。

# java - 从 Java 代码中运行程序

> ID：845654
> 
> 赞同：1
> 
> 时间：2009-05-10T16:54:33.737
> 
> 标签：java, runtime.exec, external-process

用一段 Java 代码调用程序的最简单方法是什么？（我要运行的程序是 aiSee，它可以从命令行或 Windows GUI 运行；我在 Vista 上，但代码也将在 Linux 系统上运行）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-10T16:57:40.707

看看[Process](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Process.html)和[Runtime](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Runtime.html)类。请记住，您要完成的工作可能与平台无关。

这里有一小段代码可能会有所帮助：

```
public class YourClass
{
    public static void main(String args[])
       throws Exception
    {
        Runtime rt = Runtime.getRuntime();
        Process proc = rt.exec("name_of_your_application.exe");
        int exitVal = proc.exitValue();
        System.out.println("Process exitValue: " + exitVal);
    }
} 
```

[SO中的一个](https://stackoverflow.com/questions/506154/runtime-class-in-java)问题讨论了类似的问题。[另一个](https://stackoverflow.com/questions/480433/launch-jvm-process-from-a-java-application-use-runtime-exec)。[还有](https://stackoverflow.com/questions/636367/java-executing-a-java-application-in-a-separate-process)一个。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T16:59:30.953

`Runtime.getRuntime()`您可以使用并调用运行时的方法来获取运行时实例`exec`，并将执行程序的命令作为参数。

例如：

```
Runtime runTime = Runtime.getRuntime ();       
Process proc = rt.exec("iSee.exe"); 
```

您还可以使用从进程中获取 InputStream 来捕获程序的输出。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T16:59:12.187

您将遇到的困难是如何让应用程序知道路径。您可能想要使用 xml 或配置文件，但如果您使用此链接，它应该说明如何运行文件： [http ://www.javacoffeebreak.com/faq/faq0030.html](http://www.javacoffeebreak.com/faq/faq0030.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T17:22:07.463

您可能还需要考虑将某种参数传递给您的程序，以方便查找您要运行的特定程序。

这可能与命令行参数、属性文件或系统属性有关。

# c# - 为什么 C# 编译器会为 GetType() 方法调用发出 callvirt 指令？

> ID：845657
> 
> 赞同：28
> 
> 时间：2009-05-10T16:56:33.440
> 
> 标签：c#, compiler-construction, il, type-safety

我很想知道为什么会这样。请阅读下面的代码示例以及在每个部分下方的注释中发出的相应 IL：

```
using System;

class Program
{
    static void Main()
    {
        Object o = new Object();
        o.GetType();

        // L_0001: newobj instance void [mscorlib]System.Object::.ctor()
        // L_0006: stloc.0 
        // L_0007: ldloc.0 
        // L_0008: callvirt instance class [mscorlib]System.Type [mscorlib]System.Object::GetType()

        new Object().GetType();

        // L_000e: newobj instance void [mscorlib]System.Object::.ctor()
        // L_0013: call instance class [mscorlib]System.Type [mscorlib]System.Object::GetType()
    }
} 
```

为什么编译器`callvirt`为第一部分发出 a 而`call`为第二部分发出 a ？编译器是否有任何理由会`callvirt`为非虚拟方法发出指令？如果在某些情况下编译器会`callvirt`为非虚拟方法发出 a ，这是否会给类型安全带来问题？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-10T17:11:27.553

请参阅Eric Gunnerson 的[这篇](http://blogs.msdn.com/ericgu/archive/2008/07/02/why-does-c-always-use-callvirt.aspx)旧博客文章。

这是帖子的正文：

**为什么 C# 总是使用 callvirt？**

这个问题出现在一个内部 C# 别名上，我认为答案会引起普遍关注。这是假设答案是正确的——已经有一段时间了。

.NET IL 语言同时提供 call 和 callvirt 指令，其中 callvirt 用于调用虚函数。但是，如果您查看 C# 生成的代码，您会发现即使在不涉及虚函数的情况下，它也会生成“callvirt”。为什么这样做？

我回顾了我的语言设计说明，它们非常清楚地表明我们决定在 1999 年 12 月 13 日使用 callvirt。不幸的是，他们没有抓住我们这样做的理由，所以我将不得不从我的记忆中消失。

我们从某个人（可能是使用 C# 的 .NET 小组之一（当时还没有命名为 C#））那里得到了一份报告，他编写了在空指针上调用方法的代码，但他们没有得到一个异常，因为该方法没有访问任何字段（即“this”为空，但方法中没有使用它）。然后那个方法调用了另一个方法，它确实使用了这个点并抛出了一个异常，随之而来的是一些令人头疼的问题。在他们弄清楚之后，他们给我们发了一张关于它的便条。

我们认为能够在空实例上调用方法有点奇怪。Peter Golde 做了一些测试，看看总是使用 callvirt 对性能的影响是什么，它足够小，我们决定做出改变。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-05-10T17:32:20.347

**只是玩安全。**

从技术上讲，C# 编译器并不**总是**使用`callvirt`

对于在值类型上定义的静态方法和方法，它使用`call`. 大多数是通过`callvirt`IL 指令提供的。

两者之间的不同之处在于`call`假设“用于进行调用的对象”不为空。`callvirt`另一方面，检查 not null 并在需要时抛出 NullReferenceException。

*   对于静态方法，对象是类型对象，不能为空。值类型同上。因此`call`用于他们 - 更好的性能。
*   对于其他人，语言设计者决定采用，`callvirt`因此 JIT 编译器验证用于进行调用的对象不为空。即使对于非虚拟实例方法.. 他们重视安全而不是性能。

*另请参阅：Jeff Richter 在这方面做得更好 - 在他通过 C# 2nd Ed 在 CLR 中的“设计类型”一章中*

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-10T20:27:11.623

作为一个（也许-）有趣的旁白......`GetType()`是不寻常的，因为它*不是* `virtual`- 这会导致一些[非常非常奇怪的事情](https://stackoverflow.com/questions/194484/whats-the-strangest-corner-case-youve-seen-in-c-or-net/194671#194671)。

（标记为 wiki，因为它与实际问题有些偏离主题）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-10T17:08:42.580

编译器不知道`o`第一个表达式中的真实类型，但它知道第二个表达式中的真实类型。看起来它一次只查看一个语句。

这很好，因为 C# 在很大程度上依赖于 JIT 进行优化。在这种简单的情况下，两个调用很可能在运行时都成为实例调用。

我不相信`callvirt`曾经为非虚拟方法发出过，但即使是这样，也没有问题，因为该方法永远不会被覆盖（出于显而易见的原因）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-10T17:10:07.510

我会冒险猜测这是因为第一个分配给一个变量，该变量可能包含另一个类型的向下转换实例，该实例可能已经被覆盖`GetType`（即使我们可以看到它没有）；第二个永远不会是`Object`.

# jfreechart - jfreechart中的ohlc图表

> ID：845661
> 
> 赞同：0
> 
> 时间：2009-05-10T16:58:16.573
> 
> 标签：jfreechart

有没有办法检测鼠标何时越过图表中的条形？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T21:05:23.187

看看[ImageMapUtilities](http://www.jfree.org/jfreechart/api/javadoc/org/jfree/chart/imagemap/ImageMapUtilities.html)。我通过在我希望浏览器响应的内容上绘制自定义[XYAnnotations并在注释中指定适当的工具提示/URL 来添加鼠标悬停功能。](http://www.jfree.org/jfreechart/api/javadoc/org/jfree/chart/annotations/AbstractXYAnnotation.html)

（以上对浏览器特别有用）

# iphone - 核心动画还是 OpenGL ES？

> ID：845662
> 
> 赞同：5
> 
> 时间：2009-05-10T16:58:33.577
> 
> 标签：iphone, cocoa-touch, opengl-es, drawing, core-animation

我想做以下事情：

点击屏幕并在点击的点周围绘制 3 个 cricles。使用 Core Animation 或 OpenGL ES 会更好吗？

我从哪里开始？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-10T19:51:40.247

我的经验是这样的：我的应用程序变得越复杂，我就越意识到我应该使用 OpenGL ES 来做我想做的事情。

因此，对于您的情况，如果您所描述的就是全部，那么 Core Graphics 可以解决问题。但是，我猜它不仅仅是三个圆圈。

**在**完全没有 OpenGL 经验的情况下，ES 的学习曲线大约是 20 天。

因此，我的建议是：**几乎所有基于帧到帧图形的应用程序都使用 OpenGL ES**。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T19:20:33.713

如前所述，Core Graphics 框架可能是您想要的。一个好的方法是继承 UIView，然后覆盖这两个方法`drawRect:`和`touchesEnded:withEvent:`.

当 UIView 上的触摸事件结束时，您可以从传递给的事件中获取最后一次触摸的点`touchesEnded:withEvent:`，并将其以某种方式存储在子类 UIView 的实例中。

然后，在您的实现中`drawRect:`，您将获得存储的最后一个接触点，并使用三个调用在其周围绘制三个圆圈`CGContextAddEllipseInRect`，如下所述：[Quartz 2D 编程指南：路径](http://developer.apple.com/iphone/library/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/dq_paths/dq_paths.html)（需要注册为 Apple 开发人员）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-10T19:57:22.857

学习 OpenGL ES 的优势在于，您花在学习上的时间将在未来的 iPhone 应用程序和其他设备上为您服务。

在 OpenGL ES 中，没有内置的方法来绘制圆，因此使用正弦和余弦从线段构建圆。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-10T19:32:49.683

Core Graphics 绝对更简单，更适合 2D。OpenGL ES 是为 3D 设计的，但也可以用于 2D。两者都可以使用，所以如果您已经知道一个，请使用它。应该没那么重要。

我已经了解 OpenGL，所以即使是 2D，我也倾向于使用 OpenGL ES，但如果您以前没有使用过，请使用 Core Graphics。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-10T17:02:27.020

这最好使用 Quartz 2D（也称为 Core Graphics）来完成

请参阅[Apple 的 Quartz 编程指南](http://developer.apple.com/iphone/library/documentation/GraphicsImaging/Conceptual/drawingwithquartz2d/Introduction/Introduction.html)

# javascript - 如何在 YUI 拖放实用程序中取消放置事件？

> ID：845665
> 
> 赞同：0
> 
> 时间：2009-05-10T16:58:53.920
> 
> 标签：javascript, yui, drag-and-drop

我们在一个源和多个目标之间使用拖放实用程序。我们有一个限制，即其中一个目标只能有一个子元素，而另一个目标可以有多个项目。

我已经尝试订阅代理项的 dragDropEvent 并返回 false 以防目标目标有多个子元素，但运气不佳。

```
 var m = new YAHOO.example.DDList("dli" + j, 'documentSelection');
           m.subscribe('dragDropEvent', function(e){                            
                if (e.info == 'ulMasterDocument' && $('#ulMasterDocument').children().length > 1){                  
                    e.event.canceBubble = true;
                    return false;
                }
                return true; 
             }); 
```

这段代码正确吗？还是我需要订阅其他活动？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-04-13T06:49:02.483

YAHOO.util.Event.preventDefault(e); 应该取消事件。

# visual-studio - 折叠所有 Visual Studio 工具箱区域快捷方式

> ID：845676
> 
> 赞同：32
> 
> 时间：2009-05-10T17:03:11.853
> 
> 标签：visual-studio, keyboard-shortcuts, visual-studio-macros

是否有键盘快捷键或宏可以折叠 Visual Studio 工具箱中的所有区域？（如果其中任何一个失败，我将采用允许此操作的插件！）

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-05-15T04:18:49.753

当焦点位于工具箱上时，按`/`折叠全部。

您也可以按`SHIFT`+展开全部`8`

这是 Sarah Ford 的一篇文章，其中包含更多信息：**[Visual Studio Tip #186](http://blogs.msdn.com/saraford/archive/2008/04/03/did-you-know-you-can-use-to-expand-all-and-to-collapse-all-in-the-toolbox-186.aspx)**

**前：**

[![替代文字](https://i.stack.imgur.com/RUb5n.jpg)](https://i.stack.imgur.com/RUb5n.jpg)
[（来源：[msdn.com](http://blogs.msdn.com/blogfiles/saraford/WindowsLiveWriter/Did.YoucanusetoExpandAllandtoCollapseAll_DF23/ToolboxAllExpanded_thumb.jpg)）]

**后：**

[![替代文字](https://i.stack.imgur.com/z4b0C.jpg)](https://i.stack.imgur.com/z4b0C.jpg)
[（来源：[msdn.com](http://blogs.msdn.com/blogfiles/saraford/WindowsLiveWriter/Did.YoucanusetoExpandAllandtoCollapseAll_DF23/ToolboxAllCollapsed_thumb.jpg)）]

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T17:20:25.373

`Shift`+ `Alt`+`Enter`是你的朋友。

另请参阅窗口>自动隐藏全部

# django - 谷歌应用引擎中的选择属性

> ID：845685
> 
> 赞同：0
> 
> 时间：2009-05-10T17:13:21.343
> 
> 标签：django, google-app-engine, choicefield

平台：django 1.0、google app engine、app-engine-patch、python 2.5.4

我正在尝试使用选择属性，因为我一直在 django 网站中使用

```
STATUS_CHOICES = ( (1, _('Yet To Start')), (2, _('Running')), (3, _('Paused')), (4, _('Completed')), (5, _('Cancelled')), (6, _('Error')),)

class Campaign(db.Model):
    name = db.TextProperty()
    status = db.IntegerProperty(choices=STATUS_CHOICES,default=2) 
```

现在，当我移至应用程序引擎时，我看不到这是可行的...

我得到一个

> 错误值错误
> 
> 属性状态为3；必须是 ((1, u'Yet To Start'), (2, u'Running'), (3, u'Paused'), (4, u'Completed'), (5, u'Cancelled') 之一), (6, u'错误'))

我怎么解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T17:20:06.093

[这是一个记录在案的问题](http://code.google.com/p/googleappengine/issues/detail?id=350)，无法解决。简单地说，你在使用 GAE 时不能这样做。

Guido 在关闭上述票证时说以下内容：

> 非常抱歉，但我必须将其关闭为无效。
> 
> db.Property 类的选择参数的 App Engine 定义与 Django 定义不同。请参阅 [http://code.google.com/appengine/docs/datastore/propertyclass.html#Property](http://code.google.com/appengine/docs/datastore/propertyclass.html#Property)
> 
> 我意识到，当您尝试从模型创建表单时，这可能会导致问题，但解决方案是使用自定义小部件覆盖表单字段并将所需选择的列表传递给小部件。（在 Rietveld 中有一个这样的例子，在 codereview/views.py 的类 SettingForm 中。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T19:57:15.853

正如 Paolo 所说，这不是选择参数在 App Engine 模型中的工作方式。不过，完全有可能编写自己的自定义属性，这些属性的行为可以随心所欲。这是一个类似的食谱中的示例：[EnumProperty](http://appengine-cookbook.appspot.com/recipe/enumproperty/)。

# ruby-on-rails - 我应该为 Google Maps API 提供什么 URL，以便它识别为与 Passenger 一起运行的本地 Rails 应用程序创建的密钥？

> ID：845686
> 
> 赞同：2
> 
> 时间：2009-05-10T17:13:38.767
> 
> 标签：ruby-on-rails, google-maps, passenger, phusion

我一直在开发一个基于谷歌地图的 Rails 应用程序，它运行良好，直到我安装了 Phusion 的乘客，现在谷歌地图 API 无法识别我为[http://localhost:3000](http://localhost:3000)生成的 API 密钥。

现在我正在运行 Passenger，我的应用程序的 URL 是[http://mygooglemapsapp.local](http://mygooglemapsapp.local)。我已经使用这个新 URL 生成了一个 Google Maps API 密钥，但我仍然遇到同样的错误。

“Google Maps API 服务器拒绝了您的请求。这可能是因为在此站点上使用的 API 密钥已为其他网站注册。您可以在 %1$s 为该网站生成一个新密钥。”

我应该为 Google Maps API 提供什么 URL，以便它能够识别乘客生成的 URL？

提前致谢。

缺口

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-11T22:03:34.277

根据您的 Apache 配置（我假设这是从`.local`URL 安装的 OS X），您可能能够更改设置，以便通过以下方式运行多个 Rails 应用程序`http://localhost/MY_APP/`

[这里有一些关于为多个目录](http://www.modrails.com/documentation/Users%20guide%20Apache.html#deploying_rails_to_sub_uri)设置 mod_rails 的好例子

请注意在一个 VirtualHost 下部署多个应用程序的示例。如果您可以对此进行配置，那么您只需请求一个 Google Maps API 密钥`http://localhost/`并在开发中尽可能多地重复使用它。

# django - 如何使用 bash shell 找到我的计算机的 IP 地址？

> ID：845694
> 
> 赞同：26
> 
> 时间：2009-05-10T17:16:24.553
> 
> 标签：django, bash, unix, networking, ip-address

时不时地，我需要启动 Django 开发服务器，并让我网络上的其他机器可以查看它，如下所述：

[http://docs.djangoproject.com/en/dev/ref/django-admin/#runserver](http://docs.djangoproject.com/en/dev/ref/django-admin/#runserver)

我的机器的 IP 地址往往会时不时地改变，所以我想有一个小的 shell 别名或用我机器的当前 IP 地址吐出 manage.py 命令的东西，可能是这样的：

```
python manage.py runserver $(COMMAND TO FIND MY MACHINE’S IP ADDRESS GOES HERE):8000 
```

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-05-10T17:24:05.633

```
ifconfig en0 | grep inet | grep -v inet6 
```

上面的输出预计将采用以下形式：

**inet 192.168.111.1 网络掩码 0xffffff00 广播 192.168.111.255**

添加一条 awk 语句来打印第二列以避免使用 cut （awk 是一个非常标准的 unix 工具）：

```
ifconfig en0 | grep inet | grep -v inet6 | awk '{print $2}' 
```

在 IP 的前几个数字始终相同的 LAN 上（将 192.168.111 替换为您自己的数字）时，我使用以下命令获取当前 IP：

```
ifconfig | grep 192.168.111 | awk '{print $2}' 
```

要获取您知道名称的另一台机器的 ip，请尝试（将主机名和 192.168.111 替换为您自己的值）：

```
ping -c 1 hostname | grep 192.168.11 | grep 'bytes from' | awk '{print $4}' | sed 's/://g' 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-05-10T17:19:04.457

您可能已经意识到，但正在运行

```
python manage.py runserver 0.0.0.0:8000 
```

使您的机器对网络上的每个人都可见。

您是否有理由需要指定您的 IP？

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-04-25T12:38:07.360

Thi 应该和我已经看到的其他命令一样工作：

```
ifconfig eth0 | grep inet | awk '{print $2}' | cut -d':' -f2 
```

*   *将 eth0 替换为所需的接口（eth0、eth1、wlan0...）*

I̶̶t̶h̶i̶n̶k̶̶y̶o̶u̶̶c̶a̶n̶̶a̶l̶s̶o̶̶w̶r̶i̶t̶e̶：̶

̶ ̶ ̶ ̶h̶o̶s̶t̶n̶a̶m̶e̶ ̶-̶I̶ ̶|̶ ̶c̶u̶t̶ ̶-d̶'̶ ̶'̶ ̶-̶f̶1̶ ̶

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-12-25T22:23:37.530

最好的解决方案是：

```
ifconfig | sed -n 's/.*inet addr:\([0-9.]\+\)\s.*/\1/p' 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-12-31T20:25:41.027

人们正在使用字符计数从 ip 地址行中提取正确的列，但是使用空格作为分隔符使得这更适合不同长度的 ip 地址......

```
ifconfig en1 | grep inet | grep -v inet6 | cut -d" " -f2 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-04-14T10:33:55.687

这是一种快速而肮脏的方式，适用于 OSX

```
/sbin/ifconfig | grep 'inet ' | grep -v '127.0.0.1' | head -n1 | awk '{print $2}' 
```

基本上获取所有具有 IPV4 地址的接口，跳过 localhost 然后获取第一个接口。

另外，使用 ifconfig 的路径。从 ex 中使用时，我已经看到了许多 shell 脚本制动。cron 因为 PATH 失败。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2016-10-04T19:38:28.753

在 Mac OS X 10.11.6 El Capitan（可能还有旧版本）上，您可以使用

```
ipconfig getifaddr <device> 
```

,等`<device>`在哪里`en0``en1`

[http://osxdaily.com/2010/11/21/find-ip-address-mac/](http://osxdaily.com/2010/11/21/find-ip-address-mac/)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-05-10T17:18:54.113

`ifconfig`可能是你所追求的。不过，您需要运行它`grep`以过滤掉一些噪音。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-11-21T06:17:06.020

以下命令在 RHEL 6.3 上非常适合我：

```
 ifconfig | grep -v '127.0.0.1' | sed -n 's/.*inet addr:\([0-9.]\+\)\s.*/\1/p' 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-04-04T19:42:59.280

这可能不像其他一些解决方案那样优雅，但它适用于 Linux 系统，并且比正则表达式更令人舒服：

```
ifconfig eth0 | grep 'inet addr:' | awk '{print $2}' | awk -F ':' '{print $2}' 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-08-29T10:34:52.020

试试这个（如果你是 Arch 用户）

```
resolveip -s $HOSTNAME 
```

* * *

选择

要获取 IPv4 地址，您可以使用：

```
host $(uname -n) | grep "address" | grep -v "IPv6" | head -n 1 | awk '{print $4}' 
```

为了获得 IPv6 之一：

```
host $(uname -n) | grep "IPv6 address" | head -n 1 | awk '{print $5}' 
```

如果您愿意，可以将 $(uname -n) 替换为 $(hostname)。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-12-12T20:53:20.793

**使用默认接口查找 IP 地址的简单命令。**

```
ip -o route get "8.8.8.8" 2>/dev/null | sed -e 's/^.* src \([^ ]*\) .*$/\1/' 
```

**或者**

```
ip route | grep src | awk -F 'src' '{print $NF; exit}' | awk '{print $1}' 
```

**或者**

```
ip route | sed -n 's/.* src \(.*\) metric .*/\1/p' | uniq 
```

**在所有 Unix 操作系统上测试**

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-10-23T11:46:15.020

这是查找当前IP地址的解决方案：

```
route -n get default|grep interface|awk ‘{ print $2 }’|xargs ipconfig getifaddr 
```

仅在 Mac 上测试。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-02-13T20:09:49.367

这将检查您的默认接口，并使用它来检索您的主 IP。当您有许多接口和大量虚拟 IP 地址时很有帮助：

```
netstat -rn | gawk '/UG/ {print $NF}' | xargs ifconfig | gawk 'match($0,/inet addr:(.*) B/,a) {print a[1]}' 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-07-16T18:12:51.970

回顾：如果您想`copy/paste`使用命令行并只获取网络 IP 地址，这就是在 Mac 上工作的方法（在 WiFi 上）：

```
echo $(ifconfig en0 | grep inet | grep -v inet6 | cut -d" " -f2) 
```

这是将其分配给 bash 脚本变量：

```
LOCAL_IP=$(ifconfig en0 | grep inet | grep -v inet6 | cut -d" " -f2) 
```

这是基于[Valentin Rocher](https://stackoverflow.com/users/104117/valentin-rocher)和[Matt Kropmton的回答](https://stackoverflow.com/users/1124669/matt-crampton)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-09-17T03:30:42.173

仅测试`Archlinux`：

```
ifconfig $(route | awk '{if($1=="default") print $NF}') | awk '{if($1=="inet") print $2}' 
```

获取默认接口`route`，获取接口的IP地址`ifconfig`。

由于命令语法或输出可能会有所不同，因此您可能需要针对系统上的工作进行更改。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-12-09T02:32:42.907

在 Android Shell 上，我尝试过：

```
ifconfig eth0 | grep 'inet addr' | tr -d '^[A-Za-z]+$' | tr -s ':' | cut -d ':' -f 2 
```

# c++ - 用于本地 IPC 的基于内存的数据服务器

> ID：845705
> 
> 赞同：0
> 
> 时间：2009-05-10T17:22:43.470
> 
> 标签：c++, c, windows, data-structures, ipc

我将运行一个应用程序，每次运行时需要大约 200MB 的市场数据。这些天来存储在内存中的数据量很小，所以为了速度，这就是我想要做的。

在一天的会话过程中，我可能会一遍又一遍地运行、重新运行、重写和重新运行等一个或多个应用程序。

所以，问题是如何整天将数据保存在内存中，这样即使应用程序崩溃，我也不必通过打开磁盘上的数据文件并重新加载数据来重新加载数据？

我最初的想法是编写一个数据服务器应用程序，它只会将数据读入共享内存，以便它可以使用。如果我这样做，我想我可以通过调用为 IPC 使用内存映射

创建文件（）

创建文件映射（）

MapViewOfFile()

有更好的 IPC/方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T17:48:22.443

只是内存映射数据文件。除非您的计算机内存不足，否则即使程序退出，文件也会保留在文件缓存中。下次启动时，访问速度会很快。

如果您的内存数据与磁盘数据不同，只需使用两个文件。重新启动时，检查写入内存文件的时间戳和文件修订以与磁盘文件进行比较，这样您的程序就会知道哪个具有最新数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-11T00:09:15.007

如果你有足够的内存并且没有其他东西需要内存，那可能会减少你的启动时间。为了保证对内存的访问，您可能希望在命名共享内存中拥有一个内存映射文件，如此[处](http://msdn.microsoft.com/en-us/library/aa366551(VS.85).aspx)所述。您可以让一个简单的程序创建共享并对其进行管理，这样您就可以保证它保留在内存中。

# c++ - 有没有办法自动使库成为静态或动态的？

> ID：845706
> 
> 赞同：1
> 
> 时间：2009-05-10T17:23:30.580
> 
> 标签：c++, visual-studio, gcc, cross-platform

我知道这可能是一个很长的镜头，但它就是这样。我有几个活动项目，每个项目都有在主项目编译时编译的子项目库。这些库是动态库，但最近出现了一个问题，可能需要这些库（其中大部分在项目之间共享）是静态的而不是动态的。

现在，我很确定有人设计了一个系统，我可以在其中创建一个库，该库可以作为静态编译到项目中，也可以使用简单的预处理器指令之类的东西编译为动态库。如果没有，我会梦想成真。

编辑：

看起来可能是 CMake，但是，除了构建东西之外，我还想从我的代码中减轻 __declspec(dllimport) 和 __declspec(dllexport) - 这样我就可以在静态和动态之间自动切换。尽管使用预处理器宏相当容易，但我想也许人们已经在使用某种形式的系统？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T18:14:59.110

我喜欢使用[CMake](http://cmake.org)来避免这些类型的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T17:36:23.510

如果您希望它是跨平台的，则必须使用 SCons 或 Make 之类的工具，并根据您传入的任何命令变量设置不同的编译器/链接器参数。您必须为每个平台和链接执行此操作-键入您支持的组合。

在 Visual Studio 的配置管理器中（您不仅限于发布和调试），然后您可以拥有 ReleaseStatic 和 ReleaseDynamic 以及您可以梦想的任何其他配置。然后，您只需为每个配置设置正确的编译器和链接器开关。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-05-10T17:43:28.333

下载 cURL 源代码并查看其设置。它可以为 Windows 中的 DLL 或静态对象以及 Unix 中的静态或共享对象构建 libcurl。

# c++ - 是否有返回字符的 ASCII 值的函数？(C++)

> ID：845710
> 
> 赞同：17
> 
> 时间：2009-05-10T17:26:03.870
> 
> 标签：c++, binary, ascii, character, hex

我需要一个返回字符的 ASCII 值的函数，包括空格、制表符、换行符等...

类似地，在十六进制、十进制和二进制数之间进行转换的函数是什么？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-05-10T17:28:14.787

```
char c;
int ascii = (int) c;
s2.data[j]=(char)count; 
```

char**是**整数，不需要转换函数。

也许您正在寻找将整数显示为字符串的函数——使用十六进制、二进制或十进制表示？

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-05-10T17:29:58.713

您不需要函数来获取 ASCII 值——只需通过（隐式）强制转换转换为整数：

```
int x = 'A';  // x = 65
int y = '\t'; // x = 9 
```

要将数字转换为十六进制或十进制，您可以使用该系列的任何成员`printf`：

```
char buffer[32];  // make sure this is big enough!
sprintf(buffer, "%d", 12345);  // decimal: buffer is assigned "12345"
sprintf(buffer, "%x", 12345);  // hex: buffer is assigned "3039" 
```

没有内置函数可以转换为二进制；你必须自己动手。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-10T17:29:57.090

如果要在代码中获取字符的 ASCII 值，只需将字符放在引号中即可

```
char c = 'a'; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-10T17:30:43.317

您可能会将内部表示与输出混淆。要查看一个角色的价值：

```
char c = 'A';
cout << c << " has code " << int(c) << endl; 
```

同样的十六进制值 - 所有数字都是十六进制数字，所以这只是一个输出问题：

```
int n = 42;
cout << n << " in hex is " << hex << n << endl; 
```

输出语句中的“hex”是一个 C++ 操纵器。有用于十六进制和十进制 (dec) 的操纵器，但不幸的是没有用于二进制的操纵器。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-10T17:31:29.303

至于十六进制和二进制 - 这些只是整数的表示。您可能想要的是 printf("%d",n) 和 printf("%x",n) - 第一个打印十进制，第二个打印相同数字的十六进制版本。澄清你正在尝试做的事情 -

# django - 查找 Django 中字段唯一的对象计数

> ID：845717
> 
> 赞同：4
> 
> 时间：2009-05-10T17:29:58.650
> 
> 标签：django

我有一个类似这样的模型：

```
class Input(models.Model):
        details = models.CharField(max_length=1000)
        user = models.ForeignKey(User)

class Case(Input):
    title  = models.CharField(max_length=200)
    views = models.IntegerField()

    class Argument(Input):
        case = models.ForeignKey(Case)
        side = models.BooleanField() 
```

每个案例，用户可以提交许多参数。我想知道有多少用户提交了`side=true`参数。

我的意思是，如果 1 个用户有 10 个参数，而另一个用户有 2 个参数（两者`side=true`），我希望计数为 2，而不是 12。

### 更新：

我在 Case 对象上使用这些方法：

```
 def users_agree(self):
        return self.argument_set.filter(side=True).values('user').distinct()
    def users_disagree(self):
        return self.argument_set.filter(side=False).values('user').distinct() 
```

我的模板代码调用`count()`它们。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-10T18:13:17.957

你能试一下吗：

```
Argument.objects.filter(side=True).values('case__user').distinct().count() 
```

我认为它可以满足您的需求。它发出一个 SQL 查询：

```
SELECT COUNT(DISTINCT "example_input"."user_id") FROM "example_argument" INNER JOIN "example_case" ON ("example_argument"."case_id" = "example_case"."input_ptr_id") INNER JOIN "example_input" ON ("example_case"."input_ptr_id" = "example_input"."id") WHERE "example_argument"."side" = True 
```

编辑：

对于`this_case`，获取所有 argument.side 为 True 的用户：

```
Argument.objects.filter(case__id=this_case.id, side=True).values('user').distinct() 
```

# java - Eclipse IDE 和导入问题

> ID：845724
> 
> 赞同：0
> 
> 时间：2009-05-10T17:32:31.660
> 
> 标签：java, eclipse, jakarta-ee, servlets, tomcat5.5

最近我一直在尝试使用 Eclipse IDE 进行 Java 开发。我主要是java编程的新手。我正在尝试一个 servlet 项目，使用 Tomcat5.5 作为容器。当我在我的类文件中给出声明时，我遇到了问题`import javax.servlet.*`，因为 Eclipse 抱怨它找不到那个特定的包。我在 Windows 环境中工作，并且已经在我的类路径中包含以下内容：

```
.;C:\Program Files\Java\jre1.6.0_07\lib\ext\QTJava.zip;C:\Program Files\Java\jdk1.6.0_13\bin;C:\Program Files\Apache Software Foundation\Tomcat\common\lib\servlet-api.jar;C:\Program Files\Apache Software Foundation\Tomcat\common\lib\jsp-api.jar;C:\Program Files\Apache Software Foundation\Tomcat\common\lib 
```

任何想法，因为可能出了什么问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T19:14:13.130

最后一件事：`CLASSPATH`您发布的那个值看起来很像 Windows 系统环境变量值。您需要知道，包括 Eclipse 和 Tomcat 在内的每个 IDE 和 Java EE 应用服务器都完全忽略了 CLASSPATH 环境值。最好知道如何根据`CLASSPATH`您的情况进行适当的设置。`CLASSPATH`我在我工作的任何机器上都没有环境设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T17:57:10.137

在项目中添加一个 lib 文件夹并放入所需的 jars。然后右键单击每个 jar 并添加到 build-path。

# c++ - 有没有办法在 Emacs 中同时启用 Objective-C 模式和 C++ 模式？

> ID：845725
> 
> 赞同：4
> 
> 时间：2009-05-10T17:33:46.897
> 
> 标签：c++, objective-c, emacs, syntax-highlighting

我正在使用一些 Objective-C++ 代码（`.mm`文件），我很好奇是否有可能让 emacs 为 Objective-C 部分和 C++ 部分使用正确的语法突出显示。 `objc-mode`和`c++-mode`都是主要模式（建立在 之上`cc-mode`），所以它们不能同时使用。

是否有任何次要模式或 elisp hack 可用于同时启用 Objective-C 和 C++ 语法突出显示？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-10T17:46:44.380

我自己没有这样做，但由于所有这些模式都基于 cc-mode，因此您似乎可以获得 objc-mode 样式和 c++-mode 的源代码并将它们组合起来。

另一种可能性是尝试一种它应该更高级的替代 objc 模式，也许最好将 c++ 考虑在内：

[http://www.foldr.org/~michaelw/objective-c/](http://www.foldr.org/~michaelw/objective-c/)

（滚动到最后并查找 obj-c-mode.el）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T18:16:09.280

[这是](http://www.emacswiki.org/emacs/MultipleModes)一个页面，其中包含有关运行多种主要模式的信息。据我所知，它主要用于做网络类型的东西，你可能在一个文档中有几种不同的语言，但它也可能适用于其他人。

# php - Zend Framework：从数据库中检索数据的正确方法

> ID：845726
> 
> 赞同：2
> 
> 时间：2009-05-10T17:34:55.930
> 
> 标签：php, zend-framework

我正在使用 zend 框架开发一个项目，我需要您就从数据库中获取数据的正确方法提出建议。

我正在使用 Zend_Layout 来加载我的模板。然后将适当的视图加载到模板中。

在模板上，应该有一个部分显示来自数据库的数据（例如类别）。由于我使用的是一个模板，因此数据将显示在请求的每个页面上，而与调用的控制器或操作无关。

我知道从模板中获取数据不是一个好习惯，从每个执行的操作中获取数据也不是一个好主意。我不知道正确的做法是使用帮助程序从数据库中获取数据，但这不会违背 MVC 的整个想法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T18:14:44.913

您还没有提到使用**Model**类来获取数据的选项。这就是 MVC 中的“M”。:-)

Model 类是一个具有接口的类，View 可以使用该接口来请求特定的数据片段。在 Model 类中，它可以混合使用 using`Zend_Db_Table`方法，也可以使用自定义 SQL 查询（直接通过`Zend_Db_Adapter`'s`query()`方法执行）。无论做什么都可以获取数据。

关键是模型封装了以视图可以使用的格式提供数据所需的所有逻辑。

也可以看看

*   微软的“[领域驱动设计简介](http://msdn.microsoft.com/en-us/magazine/dd419654.aspx)”。
*   Eric Evans 的“[领域驱动设计](http://books.google.com/books?id=7dlaMs0SECsC)”。

# c# - 如何复制 ref 类型（deepcopy）？

> ID：845730
> 
> 赞同：1
> 
> 时间：2009-05-10T17:39:01.243
> 
> 标签：c#, .net

我在接受 IEnumerable 的集合中有一个构造函数。我想枚举并使用这些项目创建一个新集合，但不引用相同的项目。Items 可以是 value 和 ref 类型：

```
CustomCollection cc = new CustomCollection (IEnumerable<T> items)
{
    foreach (var item in items)
    {
        this.Add(item); // justs adds the reference for ref types.
    }
} 
```

编辑：.NET 集合具有相同的方法，并且不进行深度复制。为什么你想要一个引用与原始元素相同的元素的集合？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T17:50:34.267

如果有问题的类支持序列化，您可以将集合序列化为临时流，然后将它们反序列化回新集合。

一些类支持 ICloneable，但具体做什么由程序员决定。它可能是深拷贝，也可能不是。

当然，并不是所有的类都支持序列化或克隆，所以你想要的不可能对所有类型都做。

您需要设置一些限制才能使其正常工作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T17:54:55.943

如果对象是可序列化的，您可以像这样制作深拷贝：

```
 private object GetCopy(object original)
 {
     if (original == null)
     {
         return null;
     }

     object result;
     using (MemoryStream stream = new MemoryStream())
     {
         BinaryFormatter formatter = new BinaryFormatter();
         formatter.Serialize(stream, original);
         stream.Position = 0;
         result = formatter.Deserialize(stream);
         stream.Close();
     }
     return result;
 } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T17:48:31.117

我认为，如果您的项目支持 IClonable 接口（正确实现接口函数），您将能够调用创建深层副本的 .clone 函数。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T18:27:04.113

进行深拷贝的效果差别很大，这就是 CLR 不会自动提供深拷贝的原因。例如，想象一下，如果您的深拷贝复制了持有操作系统管理资源（如 SQL 连接、套接字、自定义 GDI 画笔等）句柄的对象，会发生什么情况。

你真的需要坚持使用上面建议的方法。如果您认为您相信来源可以正确实现接口，请检查 T 是否为 ICloneable。如果不是（信任源或 T 不可克隆），则检查对象是否标记为 ISerializable 或具有 SerializableAttribute，然后序列化/反序列化为新对象。

如果 T 不可克隆或不可序列化，那么您可能应该抛出异常而不是尝试进行深层复制。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-05-10T17:45:48.890

你不能。并非所有对象都支持类似克隆的方法。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-05-10T17:57:18.047

我不知道语法，因为我没有经常使用它，但是这不能用反射来完成吗？我意识到反射通常会导致性能下降，但您也许可以做一些 switch-case 的事情，如下所示：

（伪代码）

```
if(item.isValueType) {
    newCol.Add(item)
} elseif(item.isRefType && item.SupportsICloneable) {
    newCol.Add(item.clone())
} else {
     doReflectionCopy()
} 
```

您还可以为可序列化检查添加代码并包含 Frederik 的方法。

# iphone - iPhone 检查固件版本

> ID：845733
> 
> 赞同：3
> 
> 时间：2009-05-10T17:40:13.347
> 
> 标签：iphone, objective-c, firmware

大家好

我想为 iPhone 2.2.* 和 3.0 版制作一个应用程序。2.2* 中的某些方法在 3.0 中已弃用。（如 UITableViewCell setText 和 setLabel ）

有什么方法可以检查 iPhone 上使用的是哪个固件版本并设置不同的使用方法

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-05-10T18:08:51.380

您将需要使用预处理器指令进行条件编译，例如 __IPHONE_3_0 并构建两个单独的可执行文件。

例如：

```
#ifdef __IPHONE_3_0
 // 特定于版本 3 的代码
 ＃别的
 // 特定于版本 2 的代码
 ＃结尾

```

如果需要在运行时检测版本，可以使用 [[UIDevice currentDevice] systemVersion]。它返回带有当前 iPhone OS 版本的字符串。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-12T14:37:41.527

正如在另一个引用的线程中提到的，虽然您可以使用预处理器指令从一个代码库生成两个应用程序，但您仍然需要两个应用程序（一个用于 2.x，一个用于 3.x）

编译时指令不能用于做出运行时决定。

另一个线程中有更多细节。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-03-10T07:19:46.633

替代解决方案，只需使用 respondsToSelector 进行检查。例如-

```
CGSize expectedLabelSize;
    if ([subTitle respondsToSelector:@selector(sizeWithAttributes:)])
    {
        expectedLabelSize = [subTitle sizeWithAttributes:@{NSFontAttributeName:subTitleLabel.font}];
    }else{
        expectedLabelSize = [subTitle sizeWithFont:subTitleLabel.font constrainedToSize:subTitleLabel.frame.size lineBreakMode:NSLineBreakByWordWrapping];
    } 
```

# c - 如何编写 vb.net 代码来编译和执行 C 程序？

> ID：845749
> 
> 赞同：0
> 
> 时间：2009-05-10T17:55:08.283
> 
> 标签：c, vb.net

我正在尝试制作一个 vb.net 应用程序，它有 2 个文本框、2 个单选按钮和 2 个按钮（一个名为 compile，另一个名为“run”）。如何将 C/C++ 文件的内容加载到第一个文本框中，然后单击编译按钮，我应该能够在第二个文本框中显示错误或 C/C++ 程序。单击运行时，我应该能够在第二个文本框中显示输出。简而言之，我想将第二个文本框用作终端/控制台。单选按钮是 4 选择语言 C 或 C++。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T18:04:06.723

看看这篇[文章](http://www.devx.com/dotnet/Article/7914)——从 VB.Net 调用外部程序（除非你打算自己编写，否则就是你的 c++ 编译器）的好例子。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T17:59:57.730

你为什么想要？你想做什么。您是否只想从 VB.NET 应用程序执行命令行编译器？

如果是这样，请查看`System.Diagnostics.Process.Start()`允许您执行另一个应用程序的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T18:02:04.293

我不认为编写`C++`编译器`VB.NET`是*绝对初学者*应该做的事情。编写编译器是一个非常高级的领域。

# c# - 标识符应该有正确的后缀 (fxcop)

> ID：845757
> 
> 赞同：3
> 
> 时间：2009-05-10T17:58:40.897
> 
> 标签：c#, .net, fxcop

我正在编写的集合中出现此错误，但 fxcop 警告我在集合后缀。为什么？

没有 .NET 集合可以做到这一点，对吗？即`List<T>`,`LinkedList<T>`等

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-10T18:02:40.907

由于您描述的确切原因，这是我忽略的一条 FxCop 规则。我也觉得在大多数情况下它没有增加任何价值。我通常在所有项目中都将其关闭。

第二个原因是如果你遵循规则，它会产生一些非常奇怪的类名（尤其是与 Tree 结合使用时）

*   AvlTreeCollection
*   不可变的AvlTreeCollection
*   堆集合

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T18:05:13.913

```
System.Collections.ObjectModel.ObservableCollection<T>
System.Collections.Generic.SynchronizedCollection<T>
System.Collections.Generic.SynchronizedKeyedCollection<K, T>
System.Collections.ObjectModel.ReadOnlyCollection<T>
System.Collections.Specialized.NameObjectCollectionBase.KeysCollection
System.Windows.Forms.ListViewGroupCollection
System.Windows.Forms.ListView.ListViewItemCollection 
```

...在其他人中。

# sql - ColdFusion 之外的查询查询

> ID：845762
> 
> 赞同：2
> 
> 时间：2009-05-10T18:01:14.343
> 
> 标签：sql, coldfusion, qoq

我使用 Adob​​e ColdFusion 的体验，即使仍然有些局限，也绝对是快乐和愉快的。

在我能说的关于 ColdFusion 的所有优点中，有一个功能完全让我大吃一惊。`dbtype="query"`它可能在生产中既不是很有效，也不是很有用，但无论如何，我说的是所谓的“查询的查询”功能，或者`cfquery`. 它允许您针对任意数据集运行 SQL 语句，而不仅仅是数据库连接。例如，您可以加入一个刚刚从数据库中检索到的结果集和一个内存结构（当然，要受到某些限制）。它提供了一种快速而简单的方法来对数据进行“后处理”，有时比在循环中遍历数据集更具可读性（也更灵活！）。

但是，ColdFusion 不是一个非常受欢迎的产品，我不打算讨论它为什么会这样。我要问的是，其他语言是否支持这种技术（比如图书馆，或多或少相同）？Python？珀尔？红宝石？php？任何事物？因为，在我看来，这个功能的潜力是巨大的，可能不在生产代码中，但如果你需要快速测试一些东西，它绝对是救命稻草。不用说，据我所知，用于此目的的 SQL ColdFusion 有些有限，但这个想法仍然很棒。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-05-11T00:04:19.023

如果您没有发现任何可以像 ColdFusion 一样处理数据的东西，那么请记住它与其他编程语言配合得很好。您总是可以在 CF 中进行繁重的查询处理，然后只需将处理逻辑包装在远程 CFC 中，并将它们公开为提供 JSON 的 Web 服务。

这将使您在尝试其他一些语言时从您发现的 ColdFusion 的优点中受益。

如果您需要摆脱 CF，请尝试使用 Python 中的 SqlAlchemy，或者像其他海报所说的那样，Rails 和 LINQ 值得一玩。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-10T18:31:37.460

我不能用于 python、ruby、perl、php。然而，.Net 有一个叫做[LINQ](http://msdn.microsoft.com/en-us/netframework/aa904594.aspx)的东西，它本质上是类固醇上的 QoQ。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T18:11:00.380

许多框架使用对象关系映射 (ORM)，它将您的数据库表转换为对象。

例如，使用 Rails 您可以从模型中获取数据，而不是直接与数据库对话。查询或发现以数组对象的形式返回，而这些对象本身又可以被查询。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-11T18:53:15.990

您也可以使用 LINQ 在 .NET 中完成此操作。LINQ 将允许您查询对象和数据库。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-06T03:07:47.903

在对查询的查询进行性能分析时，我对它们的执行时间感到惊讶，在我的测试中，我无法让它们在 10 毫秒内返回，而对实际数据库的简单查询将在 1 毫秒或更短的时间内返回。我的理解（至少在 CF MX 7 中）是，虽然这是一个有用的功能，但它并不是一个高度优化的功能。我发现手动循环查询执行条件逻辑以替换我尝试对查询执行的操作要快得多。

话虽如此，如果初始查询很慢，它比访问数据库要快。只是不要认为它总是比进行更有创意的排序或初始查询更快，因为每个 QofQ 远非瞬时。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-29T02:38:20.163

对于 Java，有三个项目值得一看，每个项目都有自己的优点和缺点，其中一些比其他的更像 SQL。JoSQL [JoSQL](http://josql.sourceforge.net/)、[JXPath](http://commons.apache.org/jxpath/)和[MetaModel](http://eobjects.org/trac/wiki/MetaModel)。

也许有一天我会弄清楚如何直接从 CF 下的 Java 调用 QoQ。;)

* * *

## 回答 #7

> 赞同：-15
> 
> 时间：2009-05-11T00:20:07.577

这种技术（ColdFusion 的查询查询）是目前最糟糕的想法之一。它不仅将业务逻辑保留在数据库中，而且还提取了您在代码中留下的少量业务逻辑，并将其推送到数据库中只是出于恶意。

你需要的是一*门好的语言*，而不是糟糕的技术来弥补不足。

Python 和 Ruby 以及其他不在您列表中的语言（例如 C# 和 Haskell）对编写针对内存中对象的任意且强大的查询具有出色的支持。这实际上是您想要的技术，而不是 ColdFusion 的查询查询。*针对内存中对象编写查询的技术是称为函数*式编程的一般编程风格的一个方面。

# sql - 德比 - 约束

> ID：845766
> 
> 赞同：6
> 
> 时间：2009-05-10T18:03:11.857
> 
> 标签：sql, schema, derby

在 Derby 服务器中，如何使用模式的系统表中的信息来创建 select 语句，以便检索每个表的约束名称？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-10T18:42:09.593

相关手册是[Derby 参考手册](http://db.apache.org/derby/manuals/index.html)。有许多可用版本：10.13 是 2017 年 4 月的最新版本，但 10.3 是 2009 年 5 月的版本。

^(*原始答案*)

```
SELECT c.constraintname, t.tablename
    FROM sysconstraints c, systables t
    WHERE c.tableid = t.tableid; 
```

由于足够新的 Derby 版本要求系统目录表带有前缀`sys.`（10.13 被[kiwicomb123](https://stackoverflow.com/users/2351948/kiwicomb123)在[注释](https://stackoverflow.com/questions/845766/derby-constraints/845844?noredirect=1#comment74188113_845844)中引用），因此您也可以修改查询以使用显式 JOIN 表示法，并使用：

```
SELECT c.constraintname, t.tablename
  FROM sys.sysconstraints c
  JOIN sys.systables t
    ON c.tableid = t.tableid; 
```

您可以添加额外的列——例如，`c.type`获取约束类型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-21T02:30:28.297

```
SELECT sc.schemaname, co.constraintname, t.tablename, cg.descriptor, t2.tablename, cg2.descriptor, f.deleterule, f.updaterule
FROM sys.sysconstraints co
JOIN sys.sysschemas sc ON co.schemaid = sc.schemaid
JOIN sys.systables t ON co.tableid = t.tableid
JOIN sys.sysforeignkeys f ON co.constraintid = f.constraintid
JOIN sys.sysconglomerates cg ON f.conglomerateid = cg.conglomerateid
JOIN sys.sysconstraints co2 ON f.keyconstraintid = co2.constraintid
JOIN sys.systables t2 ON co2.tableid = t2.tableid
JOIN sys.syskeys k ON co2.constraintid = k.constraintid
JOIN sys.sysconglomerates cg2 ON k.conglomerateid = cg2.conglomerateid
WHERE co.type = 'F' 
    and sc.schemaname = current schema 
```

这两个描述符条目包含每个表的列号列表，例如

BTREE(2,1)

其中数字对应于相应表的 syscolumns 表中的列号。

如果有人有一种优雅的方式在这个查询中提取这个，我想知道。我在单独的查询中获取表的所有列的列表，并在解析描述符以获取数字后从中提取名称。

# c++ - 如何检查整数的二进制表示是否是回文？

> ID：845772
> 
> 赞同：8
> 
> 时间：2009-05-10T18:07:05.877
> 
> 标签：c++, c, binary, integer, palindrome

如何检查整数的二进制表示是否是回文？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-06-22T23:55:01.973

希望正确：

```
_Bool is_palindrome(unsigned n)
{
    unsigned m = 0;

    for(unsigned tmp = n; tmp; tmp >>= 1)
        m = (m << 1) | (tmp & 1);

    return m == n;
} 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-05-10T18:15:44.363

由于您尚未指定执行此操作的语言，因此这里有一些 C 代码（不是最有效的实现，但它应该说明这一点）：

```
/* flip n */
unsigned int flip(unsigned int n)
{
    int i, newInt = 0;
    for (i=0; i<WORDSIZE; ++i)
    {
        newInt += (n & 0x0001);
        newInt <<= 1;
        n >>= 1;
    }
    return newInt;
}

bool isPalindrome(int n)
{
    int flipped = flip(n);
    /* shift to remove trailing zeroes */
    while (!(flipped & 0x0001))
        flipped >>= 1;
    return n == flipped;
} 
```

**编辑**为您的 10001 事物修复。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-10T18:19:01.253

创建一个包含一个字符的 256 折线图，它是位反转字符。给定一个 4 字节整数，取第一个字符，在图表上查看，将答案与整数的最后一个字符进行比较。如果它们不同，则不是回文，如果它们与中间字符相同，则重复。如果它们不同，则它不是回文，否则它是。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-10T19:15:07.450

这里有很多不错的解决方案。在我看来，让我添加一个不是最有效但非常易读的：

```
/* Reverses the digits of num assuming the given base. */
uint64_t
reverse_base(uint64_t num, uint8_t base)
{
  uint64_t rev = num % base;

  for (; num /= base; rev = rev * base + num % base);

  return rev;
}

/* Tells whether num is palindrome in the given base. */
bool
is_palindrome_base(uint64_t num, uint8_t base)
{
  /* A palindrome is equal to its reverse. */
  return num == reverse_base(num, base);
}

/* Tells whether num is a binary palindrome. */ 
bool
is_palindrome_bin(uint64_t num) 
{
  /* A binary palindrome is a palindrome in base 2\. */
  return is_palindrome_base(num, 2);
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-11T12:22:08.407

以下应该适用于任何无符号类型。（有符号类型的位操作往往充满问题。）

```
bool test_pal(unsigned n)
{
  unsigned t = 0;

  for(unsigned bit = 1; bit && bit <= n; bit <<= 1)
    t = (t << 1) | !!(n & bit);

  return t == n;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-09-30T22:09:40.343

```
int palidrome (int num) 
{ 
  int rev = 0; 
  num = number; 
  while (num != 0)
  { 
    rev = (rev << 1) | (num & 1); num >> 1; 
  }

  if (rev = number) return 1; else return 0; 
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-01-09T12:56:47.487

在 JAVA 中有一个简单的方法，如果您了解基本的二进制计算，这里是代码：

```
 public static void main(String []args){
        Integer num=73;
        String bin=getBinary(num);
        String revBin=reverse(bin);
        Integer revNum=getInteger(revBin);

        System.out.println("Is Palindrome: "+((num^revNum)==0));

     }

     static String getBinary(int c){
         return Integer.toBinaryString(c);
     }

     static Integer getInteger(String c){
         return Integer.parseInt(c,2);
     }

     static String reverse(String c){
         return new StringBuilder(c).reverse().toString();
     } 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-10T18:24:22.917

我总是有一个与字符串一起使用的回文函数，如果是则返回 true，否则返回 false，例如在 Java 中。我唯一需要做的就是：

```
int number = 245;
String test = Integer.toString(number, 2);
if(isPalindrome(test)){
   ...
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-10T18:43:30.060

我认为最好的方法是从末端开始向内工作，即比较第一位和最后一位、第二位和倒数第二位等，这将有 O(N/2) 其中 N是 int 的大小。如果在任何时候你的对不一样，它就不是回文。

```
bool IsPalindrome(int n) {
    bool palindrome = true;
    size_t len = sizeof(n) * 8;
    for (int i = 0; i < len / 2; i++) {
        bool left_bit = !!(n & (1 << len - i - 1));
        bool right_bit = !!(n & (1 << i));
        if (left_bit != right_bit) {
            palindrome = false; 
            break;
        }
    }
    return palindrome;
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-06-08T07:44:46.300

```
#include <iostream>
#include <math.h>
using namespace std;
int main()
{
    unsigned int n = 134217729;
    unsigned int bits = floor(log(n)/log(2)+1);
    cout<< "Number of bits:" << bits << endl;
    unsigned int i=0;
    bool isPal = true;
    while(i<(bits/2))
    {
        if(((n & (unsigned int)pow(2,bits-i-1)) && (n & (unsigned int)pow(2,i))) 
                                         ||    
        (!(n & (unsigned int)pow(2,bits-i-1)) && !(n & (unsigned int)pow(2,i))))
        {
            i++;
            continue;
        }
        else
        {
            cout<<"Not a palindrome" << endl;
            isPal = false;
            break;
        }
}

    if(isPal)
        cout<<"Number is binary palindrome" << endl;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-22T23:09:41.177

```
 public static bool IsPalindrome(int n) {
        for (int i = 0;  i < 16; i++) {
            if (((n >> i) & 1) != ((n >> (31 - i)) & 1)) {
                return false;
            }
        }
        return true;
    } 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-03-10T14:33:27.250

我知道这个问题已于 2 年前发布，但我有一个更好的解决方案，它不依赖于字长等，

```
int temp = 0;
int i = num;
while (1)
{ // let's say num is the number which has to be checked
    if (i & 0x1)
    {
        temp = temp + 1;
    }
    i = i >> 1;
    if (i) {
        temp = temp << 1;
    }   
    else   
    {
        break;
    }
}   

return temp == num; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-05-14T03:59:58.777

有时报告失败也很好；

通过以某种形式或其他位模式分析，这里有很多关于显而易见的方法的很好的答案。不过，我想知道是否有任何数学解决方案？我们可以利用古数字的性质吗？

所以我玩了一点数学，但答案应该从一开始就很明显。证明所有二进制回文数必须是奇数或零是微不足道的。这大约是我能够做到的。

一项小研究表明没有这种方法用于十进制回文，因此它要么是一个非常困难的问题，要么无法通过正式系统解决。证明后者可能会很有趣......

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-05-10T19:03:41.010

通用版本：

```
#include <iostream>
#include <limits>
using namespace std;

template <class T>
bool ispalindrome(T x) {
    size_t f = 0, l = (CHAR_BIT * sizeof x) - 1;
    // strip leading zeros
    while (!(x & (1 << l))) l--;
    for (; f != l; ++f, --l) {
        bool left = (x & (1 << f)) > 0; 
        bool right = (x & (1 << l)) > 0;
        //cout <<  left << '\n';
        //cout <<  right << '\n';
        if (left != right) break;
    }
    return f != l;
}       

int main() {
    cout << ispalindrome(17) << "\n";
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-05-15T18:26:57.373

```
bool PaLInt (unsigned int i, unsigned int bits)
{
    unsigned int t = i;
    unsigned int x = 0;
    while(i)
    {
        x = x << bits;        
        x = x | (i & ((1<<bits) - 1));
        i = i >> bits;
    }
    return x == t;
} 
```

1.  调用 PalInt(i,1) 获取二进制回文串
2.  为八进制回文调用 PalInt(i,3)
3.  为十六进制回文调用 PalInt(i,4)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-05-17T13:44:47.717

Javascript 解决方案

```
function isPalindrome(num) {
  const binaryNum = num.toString(2);
  console.log(binaryNum)
  for(let i=0, j=binaryNum.length-1; i<=j; i++, j--) {
    if(binaryNum[i]!==binaryNum[j]) return false;
  }
  return true;
}

console.log(isPalindrome(0)) 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-01-02T08:51:21.020

以下解决方案适用于 python：

`def CheckBinPal(b): b=str(bin(b)) if b[2:]==b[:1:-1]: return True else: return False`

其中 b 是整数

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-11-12T07:11:49.407

如果你使用 Clang，你可以使用一些`__builtin`s.

```
bool binaryPalindrome(const uint32_t n) {
  return n == __builtin_bitreverse32(n << __builtin_clz(n));
} 
```

需要注意的一件事`__builtin_clz(0)`是未定义，因此您需要检查零。如果您使用 Clang（下一代 mac）在 ARM 上进行编译，那么这将使用 reverse 和 clz（[编译器资源](https://godbolt.org/z/7GW9rK)管理器）的汇编指令。

```
clz     w8, w0
lsl     w8, w0, w8
rbit    w8, w8
cmp     w8, w0
cset    w0, eq
ret 
```

x86 有 clz （有点）的说明，但没有反转。尽管如此，Clang 仍会发出最快的代码以在目标架构上进行逆向。

# java - JSTL taglib URI 已过时？

> ID：845776
> 
> 赞同：15
> 
> 时间：2009-05-10T18:09:49.990
> 
> 标签：java, jstl

我一直在查看 Spring MVC 教程并从那里复制了这个小的 JSP 代码：

```
<%@ page session="false"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>

<html>
    <head><title>Training, Inc.</title></head>
    <body>
        <h2><c:out value="${message}" /></h2>
    </body>
</html> 
```

为 message 设置了一个字符串，并且 c:out 标签只是按字面意思打印

**${消息}**

在我想起之前遇到的一个问题并将 taglib URI 更改为：

```
<%@ taglib prefix="c" uri="http://java.sun.com/jstl/core" %> 
```

这解决了我的小问题

前段时间我在 XSLT 转换中遇到了类似的问题，但在那种情况下，我不得不从**[http://java.sun.com/jstl/xml](http://java.sun.com/jstl/xml)**更改为**[http://java.sun.com/jsp/jstl/xml](http://java.sun.com/jsp/jstl/xml)**

根据这个[链接](http://faq.javaranch.com/view?JstlTagLibDefinitions)，我的 spring 示例应该像我从 spring 教程中粘贴的那样工作

问题是：你们中的任何人都知道所有这些 taglib URI 混乱记录在哪里吗？为什么在某些情况下我从[http://java.sun.com/jsp/jstl](http://java.sun.com/jsp/jstl)获得了最新版本，而在其他情况下我从 http://java.sun.com/jstl 获得了最新[版本](http://java.sun.com/jstl)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T18:18:47.840

是的，众所周知，标记库的 URI 在 JSTL 版本 1.0 和 1.1 之间发生了变化。如果您碰巧获得使用旧标准的示例并尝试将它们与新的 taglib JAR 一起使用，您将遇到这个问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-01-02T18:11:12.587

如果您仍然遇到此错误，但您正在手工制作您的 pom，那么您可能错过了标准库。例如我错过了

```
 <dependency>
        <groupId>taglibs</groupId>
        <artifactId>standard</artifactId>
        <version>${jstl.version}</version>
    </dependency> 
```

# python - 无法在 Python 中创建可迭代的十进制函数

> ID：845787
> 
> 赞同：0
> 
> 时间：2009-05-10T18:16:02.413
> 
> 标签：python, iteration, sum

我想计算总和

```
1/1 + 1/2 + 1/3 + ... + 1/30 
```

我运行代码失败

```
import decimal
import math
var=decimal.Decimal(1/i)

for i in range(1,31):
   print(sum(var)) 
```

我得到错误

```
'Decimal' object is not iterable 
```

**如何在 Python 中创建可迭代函数？**

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-05-10T18:19:59.380

你想要的是这样的：

```
print(sum(decimal.Decimal(1) / i for i in range(1, 31))) 
```

您的代码不起作用的原因是您尝试迭代*一个* `Decimal`实例（通过使用`sum`）。此外，您的定义`var`无效。你的意图可能是这样的：

```
var = lambda i: decimal.Decimal(str(1.0 / i)) 
```

（注意使用`str`,`Decimal` [不允许](http://docs.python.org/3.0/library/decimal.html)浮点参数）。但即便如此，您的循环也无法正常工作，因为在循环`sum` *内部*的使用本身就存在缺陷。`sum`应该*在*循环创建了您想要求和的所有分数之后使用。所以这将是：

```
print(sum(var(i) for i in range(1,31)))
print(sum(map(var, range(1, 31)))) 
```

为了完整起见，另一种方法如下：

```
one = decimal.Decimal(1)
unitFractions = (one / i for i in itertools.count(1))
print(sum(itertools.islice(unitFractions, 30))) 
```

但是，正如[gs](https://stackoverflow.com/questions/845787/unable-to-make-an-iterable-decimal-function-in-python/845826#845826)所提到的，[分数](http://docs.python.org/library/fractions.html)提供了一种产生分数答案的替代方法：

```
>>> unitFractions = (fractions.Fraction(1, i) for i in itertools.count(1))
>>> print(sum(itertools.islice(unitFractions, 30)))
9304682830147/2329089562800 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-10T18:22:50.967

你写：

```
var=decimal.Decimal(1/i) 
```

这很奇怪，因为当时没有定义“我”。怎么样：

```
one = decimal.Decimal( "1" )
total = decimal.Decimal( "0" )
for i in range( 1, 31 ):
    total += one / decimal.Decimal( "%d" % i ) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T18:31:57.240

你的错误是，这`decimal.Decimal(4)`不是一个函数，而是一个对象。

* * *

顺便说一句：看起来[分数](http://docs.python.org/library/fractions.html)（Python 2.6）模块是您真正需要的。

# javascript - 我需要一些关于 JQuery 中的 Load 函数的帮助

> ID：845790
> 
> 赞同：1
> 
> 时间：2009-05-10T18:16:51.960
> 
> 标签：javascript, jquery, ajax

我目前有带有 class="ajax" 的链接，我想从同一目录中的文件“data.html”中检索 id="test" 的元素，并将该内容放入 id="content" div我的页面：

```
<script>
$(document).ready(function(){
    $("a.ajax").click(function(event){
    $("#content").load("/data #test");
    });
});
</script>
<a class="ajax" href="#">Text</a>
<div id="content"></div> 
```

在外部，但在同一个目录中，我有 data.html：

```
<div id="test">Will this show up?</div> 
```

单击锚点时，Safari 报告“页面加载中断”，并且没有发生任何变化。

我肯定在标题中调用了 JQuery。我可以得到一些关于这个功能的帮助吗？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T18:18:47.823

你有`/data`，但文件是`/data.html`，假设你在根目录下。:)

我刚刚测试了你对这个改变的看法，它对我来说很好。我还建议您使用[Firebug](http://getfirebug.com/)之类的工具，这样您就可以轻松查看 AJAX 请求在做什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T18:22:10.190

```
$.ajax({
    url: "data.html",
    type: "POST",
    success: function (answer) {
        $("main_content").html($(answer).find("div#content_id").html());
    }
}); 
```

我希望它会帮助你。

# sql-server - SQL SERVER 存储过程中的 IF 帮助

> ID：845791
> 
> 赞同：3
> 
> 时间：2009-05-10T18:17:04.097
> 
> 标签：sql-server, tsql, stored-procedures

谁能帮我在sql server的存储过程中构建一个IF。

基本上我有一个简单的存储过程，但我现在需要传入一个新的输入参数，这取决于它是否为真，我传递值 D，如果它为假，我传递值 A。但更改位于子查询的中间。 . 让我解释一下... 这是存储过程。基本上，如果我为 ReturnOldStatus 发送 True 我执行子查询 ItemStatus='D' 如果它是 false 然后我传入 ItemStatus='A'

```
CREATE PROCEDURE [dbo].[MyTempStoredProc]
(
 @IdOffice                                 Int,
 @ReturnOldStatus                           bit
)
AS
BEGIN
   SET NOCOUNT ON;
   SELECT * FROM Offices

   WHERE
      IdOffice = @IdOffice  

      AND (V.OffType NOT IN (
                        SELECT *  FROM MiscOff 
                        WHERE
ItemStatus= 'D') // This needs to be ItemStatus ='A' if FALSE is passed in on the input param 
```

有任何想法吗？？

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-10T18:25:32.803

我会这样解决它：

```
 declare @itemStatus varchar(1);
    if (@inputParam = 'FALSE')
    begin
        set @itemStatus = 'A'
    end
    else
        set @itemStatus = 'D'

   SELECT * FROM Offices
   WHERE
          IdOffice = @IdOffice      
          AND (V.OffType NOT IN (
                   SELECT *  FROM MiscOff 
                   WHERE ItemStatus= @itemStatus) 
              ) 
```

T-Sql 不是我的母语，所以那里可能有错误...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T18:27:12.677

只需使用 T-SQL [if](http://msdn.microsoft.com/en-us/library/ms182717(SQL.90).aspx)语句：

```
IF @ReturnOldStatus = 0
    BEGIN
        --Some statements
    END
ELSE
    BEGIN
        --Some other statements
    END 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T18:25:17.640

我认为这足以解决您的问题。如果没有，请查看 TSQL 中的 DECLARE/SET 语句。

```
CREATE PROCEDURE [dbo].[MyTempStoredProc] 
    (@IdOffice Int, 
     @ReturnOldStatus bit ) 
AS BEGIN 
    SET NOCOUNT ON; 

    SELECT * FROM Offices 
    WHERE IdOffice = @IdOffice  
          AND (V.OffType NOT IN (SELECT * FROM MiscOff 
                                 WHERE (ItemStatus= 'D' AND @ReturnOldStatus = 1)
                                         OR
                                       (ItemStatus= 'A' AND @ReturnOldStatus = 0) 
                                ) 
```

# c# - 在 C# 中捕获键盘笔划

> ID：845792
> 
> 赞同：2
> 
> 时间：2009-05-10T18:17:25.407
> 
> 标签：c#, keyboard, capture, keydown

你好，

我有以下问题 - 以下文本位于富文本框中。

今天的世界[[精彩]]。

如果用户在一个词的前后提供了两个括号，如wonder，括号中的词，在这种情况下，wonder会变成一个链接，（绿色）。

我在获取击键顺序时遇到问题，即。我怎么知道用户输入了 [[ ，所以我可以开始解析它后面的其余文本。

我可以通过处理 KeyDown、事件和列表来获得它，但它看起来一点也不优雅。

请让我知道什么应该是正确的方法。

谢谢， 苏杰

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-10T18:26:34.283

你有两种我能想到的方法。

一个是，正如你所建议的，用一个列表来维护当前状态——这个键是一个括号吗？最后一个键是括号吗？ - 并即时更新。

另一种方法是简单地处理 TextChanged 事件并重新扫描文本以查找 [[text-here]] 模式并根据需要进行更新。

第一个需要更多的簿记，但对于较长的文本会更快。第二种方法更容易，可能可以用一个像样的正则表达式来完成，但随着你的文本变长，它会变慢。如果你知道你有一些上限，比如 256 个字符，那么你可能没问题。但如果你期待小说，可能不是一个好主意。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T19:28:27.833

我会推荐 Google'ing：“richtextbox 语法荧光笔”，有很多人已经这样做了，并且有很多幕后工作让它发挥作用。

我敢说，每一个简单的解决方案都有很大的缺点。正确的方法是使用一些已经执行此“语法突出显示”的控件并将其扩展到您的语法。这也很可能是最简单的方法。

您可以在 Codeplex 中搜索免费的 .net 控件。[关联](http://www.codeplex.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T18:31:54.463

我会尝试处理 KeyDown，并检查右括号而不是“]”。收到后，您可以检查文本框中的最后一个字符是否为第二个 ]，如果存在，只需替换最后几个字符。

这消除了维护状态（即：列表）的需要。输入第二个 ] 后，该块将立即变为链接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T21:56:20.183

（对不起，还没有足够的声誉来添加评论，所以必须添加一个新的答案）。正如 jeffamaphone 所建议的那样，我会处理 TextChanged 事件并每次重新扫描文本 - 但为了保持成本不变，只需扫描当前光标位置之前的几个字符，而不是阅读整个文本。

试图拦截击键并保持内部状态是一种不好的方法 - 您很容易了解发生的事情与您正在监视的控件不同步并导致奇怪的问题。（你如何处理点击？Alt-tab？粘贴？箭头键？其他应用程序抓住焦点？太多特殊情况需要担心......）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-10T18:31:49.113

我认为保留一份清单会相当复杂。如果用户键入一个“[”字符，单击文本中的其他位置，然后再次键入一个“[”字符会怎样。用户随后键入了两个连续的“[”字符，但在文本的完全不同的部分。此外，您可能还希望能够处理从剪贴板插入的文本。

我认为最安全的方法是分析全文并使用 RegEx 或其他一些技术从该上下文中做应该做的事情。

# git - 执行 git-commit 后是否可以执行 git-rebase

> ID：845795
> 
> 赞同：7
> 
> 时间：2009-05-10T18:18:41.083
> 
> 标签：git, git-rebase

我开始从[NASM](http://repo.or.cz/w/nasm.git)源文件重写一些 Perl 程序。我已经对我自己的[工作副本](http://repo.or.cz/w/nasm/perl-rewrite.git)做了一些提交，我想知道我是否应该做而不是做`git pull`，如果我应该做`git rebase`。

我几乎已经决定我应该做一个`git rebase`，但我不知道如何重新设计我的存储库以达到这种效果，或者即使它是可能的。

[![截图-gitk：nasm.crop](https://farm4.static.flickr.com/3634/3518628261_93b498f34b_m.jpg)](http://www.flickr.com/photos/b2gills/3518628261/ "截图-gitk: nasm.crop by b2gills, 在 Flickr")

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-10T20:28:52.917

这是可能的，[Git Magic](http://tinyurl.com/2oq2ur)教程将解释如何做到这一点。但是**如果其他人看到了你的分支，那就是不安全的**。即使没有其他人看到您的分支，我也敦促您重新考虑。

## 为什么要有rebase？为什么不只是拉/合并？

变基的目的是重写历史，以便您的存储库反映您认为软件应该发展的方式，而不是它实际发展的方式。这在什么时候很重要？当您是分布式开发团队的初级成员，并且您没有提交权限时，您所能做的就是将补丁提交给看门人并希望它们被接受。为了最大限度地提高被接受的机会，您希望重写历史记录以使您的补丁尽可能干净和清晰。开发模式听起来很熟悉吗？

Manoj Srivastava[对 rebase-vs-merge 进行了相当周到的分析](http://www.golden-gryphon.com/software/misc/packaging.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T18:31:25.853

我过去使用以下方法取得了成功：

对于这种方法，我添加了以下别名：

```
up = pull --rebase origin 
```

1.  将您的主分支分支到“dev”之类的东西
2.  在开发中工作
3.  当您完成添加和提交更改时
4.  起床大师
5.  切换到主
6.  git 合并开发
7.  git 推送

从远程仓库拉取更改时：

1.  切换到主
2.  起床
3.  切换到开发
4.  起床大师

YMMV

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T20:57:13.290

1.  确保当前提交是合并提交：`git log`
2.  首先，我们将 master 重新设置为上一个提交（合并之前的那个）：`git reset HEAD^`
    *   *HEAD^*表示：'HEAD 引用的提交之前的提交'
3.  现在你可以做一个正常的变基：*git rebase origin/master*

下次我建议做 a`git fetch`然后 rebase 作为第 3 步。

我建议为您当前的 git 存储库创建一个小 tarball，以防变基出错。当您感到更有信心时，您会较少这样做（通常您可以使用 git 修复几乎所有内容，但有时 tarball 更快）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T20:50:12.553

您应该能够通过像这样更改分支来撤消上一次合并：

```
git branch your-changes <reflog of "Reworked test files...">
git branch -f master remotes/origin/master 
```

之后，您可以尝试变基。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-08-26T18:53:53.763

作为 Dustin 回复的后续，它应该是“git config --global branch.master.rebase true”。

# user-interface - 需要建议（GUI、小部件） - 在绘图上实现区域选择

> ID：845799
> 
> 赞同：1
> 
> 时间：2009-05-10T18:19:21.130
> 
> 标签：user-interface, wxpython, wxwidgets, widget

（我是 GUI 编程新手；否则有经验的程序员）

（使用 wxPython；但欢迎提供一般性建议）

我正在寻找有关实施可以在地块上进行区域选择的小部件的建议/方向。来自有经验的用户的任何指点将不胜感激。

需要做的是：

1.  实现一个二维图。
2.  实现一个可调整大小的正方形，可以四处移动以选择绘图上的一个区域。
3.  报告该区域内的绘图点。

我意识到给定正方形的坐标和一个排序的绘图点列表，包含的绘图点很容易计算。我只是不确定用于实现绘图本身和可调整大小的正方形的小部件/图形技术。

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T20:07:31.797

对于第 1 点和第 2 点，您可以尝试 WxMpl ：

[http://agni.phys.iit.edu/~kmcivor/wxmpl/](http://agni.phys.iit.edu/~kmcivor/wxmpl/)

它是 wxPython 中嵌入 matplolib 的一个模块。放大/缩小开箱即用。

# asp.net - aspcompat 性能问题

> ID：845812
> 
> 赞同：0
> 
> 时间：2009-05-10T18:25:43.287
> 
> 标签：asp.net, asp-classic, interop

我在 ASP.NET 中使用 aspcompat 页面属性，因此我调用的 com 组件可以获取 ASP 内部对象（请求、响应、应用程序等）

我很快创建了一个新的测试项目，一个 asp.net 页面和一个 vb6 com 组件。

该页面执行此操作：

```
for (int i = 0; i < 1000; i++)
            Application["string" + i] = i.ToString();
        Debug.WriteLine(string.Format("{0} done adding strings to app",Environment.TickCount));
        var asp = new ASPTest.CompClass();
        asp.SetProcessId(); 
```

基本上我在应用程序对象中添加东西，然后调用 com 组件。

```
Set context = GetObjectContext
If Not context Is Nothing Then
    Set app = context("Application")
    Set ses = context("Session")
    Set resp = context("Response")
    If Not app Is Nothing Then
        OutputDebugString "" & GetTickCount & " writing response"
        resp.Write "I see application from vb <br/>"
        OutputDebugString "" & GetTickCount & " before "
        For i = 100 To 200
            resp.Write GetTickCount & " i = " & app("string" & i) & "<br/>"
        Next
        OutputDebugString "" & GetTickCount & " after "
    End If
Else
    OutputDebugString "No context"
End If 
```

问题是我在应用程序中放入的东西越多，vb 代码就越慢。虽然不是所有的代码，只是当我第一次尝试调用内在对象上的任何方法时，在我的示例中，我的第一个 resp.Write 调用。如果我在应用程序中添加 10000 个项目 resp.Write 需要十秒钟才能完成，60000 => 超时。

似乎当我第一次触摸任何内在对象时，运行时会做一些令人讨厌的事情来使对象对 COM 可用。

你见过这个吗？任何建议都非常感谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-10T18:33:09.000

这几乎可以肯定是线程的问题，可能让 Interop 在每次调用从 VB 组件到上下文中的类时执行线程上下文切换。

我不是这里的专家，所以我可能（可能会）得到纠正，但我相信您需要确保您的 VB 组件也是 STA，就像标有 aspcompat=true 的 ASP.NET 页面设置它一样。如果您将所有组件保留在同一个线程中，则不会有任何上下文切换（这需要非常昂贵的编组）。

# c++ - 我怎样才能返回一个数组？

> ID：845819
> 
> 赞同：2
> 
> 时间：2009-05-10T18:28:28.527
> 
> 标签：c++, arrays, return-value

有没有办法从函数返回数组？更具体地说，我创建了这个函数：

```
char bin[8];

for(int i = 7; i >= 0; i--)
{
    int ascii='a';
    if(2^i-ascii >= 0)
    {
        bin[i]='1';
        ascii=2^i-ascii;
    }
    else
    {
        bin[i]='0';
    }
} 
```

我需要一种方法来返回`bin[]`。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-05-10T18:31:54.853

你不能这样做，但你可以：

*   返回一个动态分配的数组——最好由智能指针拥有，这样调用者就不必关心为它释放内存——你也可以通过这种方式返回类似 std::vector 的东西。
*   通过指针（建议）或非常量引用填充作为参数传递给您的数组/向量。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-10T18:33:07.223

您的数组是分配在堆栈上的局部变量。您应该使用`new []`它在堆上分配它。然后你可以说：`return bin;`。请注意，`delete []`当你完成它时，你必须明确地释放它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-10T18:32:51.107

你真的问错问题了。如果您想在 C++ 中进行字符串处理，请使用 std::string 和/或 std::vector 类，而不是 char 数组。然后您的代码变为：

```
vector <char> func() {
    vector <char> bin(8);
    for( int i = 7; i >= 0; i-- ) {
       int ascii='a';
       if ( 2 ^ i - ascii >= 0 ) {
          bin[i] = '1';
          ascii = 2^i - ascii;
       }
       else {
        bin[i] ='0';
       }
    }
    return bin;
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T18:37:05.033

我认为你最好的选择是使用向量。它可以像数组一样以多种方式运行，并且有几个优点（长度与类型一起存储，自动内存管理）。

```
void Calculate( std::vector<char>& bin) {
  for(int i = 7; i >= 0; i--)
  {
    int ascii='a';
    if(2^i-ascii >= 0)
    {
        bin.push_back('1');
        ascii=2^i-ascii;
    }
    else
    {
        bin.push_back('0');
    }
  }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-10T18:47:05.763

如果要返回数组的副本（可能对小数组有意义）并且数组具有固定大小，则可以将其包含在结构中；

```
struct ArrayWrapper {
   char _bin[8];
};

ArrayWrapper func()
{
    ArrayWrapper x;

    // Do your stuff here using x._bin instead of plain bin

    return x;
} 
```

或者只是使用已经建议的 std::vector 。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-10T19:09:33.683

与@ari 的回答类似，我想说已经有一个提升解决方案，`boost::array`可以解决您的问题：

```
boost::array<char, 8> f() {
    boost::array<char, 8> bin;
    for(int i = 7; i >= 0; i--) {
        int ascii = 'a';
        if(2 ^ i-ascii >= 0) {
            bin[i] = '1';
            ascii = 2 ^ i-ascii;
        } else {
            bin[i] = '0';
        }
    }
}

...
boost::array<char, 8> a(f()); 
```

[[虽然我不确定你想用那个算法做什么，但请注意，我认为你想做`1 << i`（按位移位）而不是`2 ^ i`C *++*中的幂运算。]]

Boost 数组是一个普通数组，只是包装在一个结构中，所以你不会失去任何性能。`std::array`它也将在下一个 C++ 版本中`begin()`作为`size()`. `data()`只需使用最基本的一个：

```
template<typename T, size_t S>
struct array { 
    T t[S];
    T& operator[](ptrdiff_t i) { return t[i]; }
    T const& operator[](ptrdiff_t i) const { return t[i]; }
}; 
```

但像往常一样，使用其他人已经编写的工具，在这种情况下`boost::array`。它还具有聚合的优点（这就是它没有用户声明的构造函数的原因），因此它允许使用大括号括起来的列表进行初始化：

```
boost::array<int, 4> a = {{ 1, 2, 3, 4 }}; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-10T18:33:16.037

您需要在函数中将数组 bin 作为参数传递。 **数组总是按地址传递**，因此您不需要返回任何值。它会自动向您显示主程序中的所有更改

```
void FunctionAbc(char bin[], int size);

void FuncationAbc(bin, size)
{
for(int i = 7; i >= 0; i--)
{
    int ascii='a';
    if(2^i-ascii >= 0)
    {
        bin[i]='1';
        ascii=2^i-ascii;
    }
    else
    {
        bin[i]='0';
    }
}

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-05-10T18:39:27.697

您需要通过引用传递，如下所示：

```
void modifyBin(char (&bin)[8])
{
    /* your function goes here and modifies bin */
}

int main() 
{
    char bin[8];
    modifyBin(bin);
    /* bin has been updated */
    return 0;
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-10T18:43:29.000

我认为其他人都回答了这个问题……使用容器而不是数组。这是`std::string`版本：

```
std::string foo() {
    int ascii = 'a';
    std::string result("00000000");
    for (int i=7; i>=0; --i) {
        if (2^i-ascii >= 0) {
            result[i] = '1';
            ascii = 2^i-ascii;
        }
    }
    return result;
} 
```

我不确定`2^i-ascii`你是否想要。这将被解析为`(2 ^ (i - ascii))`有点奇怪。

# c# - C# - 检测对象引用何时更改

> ID：845834
> 
> 赞同：1
> 
> 时间：2009-05-10T18:34:30.933
> 
> 标签：c#

假设：

```
object x;

void GiveMeARef(ref object obj)
{
   x = obj;
} 
```

所以我希望当 Y 改变时 X 改变这个值。例如：

```
Y = new MyObject;
GiveMeARef(Y); //So x == Y;
Y = new OtherObject; // I want that X continues equals to Y, but it doesn't:\ 
```

如果可能的话，任何人都知道我如何在 C# 中做到这一点？

对不起我糟糕的英语

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T18:38:18.167

这段代码闻起来有更大的问题......但为什么不这样做：

```
var y = new MyObject();
GiveMeARef(ref y);
var z = new MyObject(); 
```

无需重复使用 y。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T18:43:13.010

如果不涉及低级调试技术（例如 Visual Studio 在调试代码时使用的技术），我认为没有直接的方法可以做到这一点。

您正在寻找的是别名，而不是参考，据我所知，CLR 不支持。

您可能可以通过编写`unsafe`代码来做到这一点，但我怀疑这样做可能会产生一些重大的副作用和并发症。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T18:52:48.127

我真的不清楚你想要做什么，但我会使用一个属性：

```
private SomeType y;
public SomeType Y {
   get { return y;}
   set {
       if(y!=value) {
           y = value;
           // run any "things to do when Y changes" code
           OnYChanged();
       }
   }
}
public event EventHandler YChanged;
protected virtual void OnYChanged() {
    EventHandler handler = YChanged;
    if(handler!=null) handler(this, EventArgs.Empty);
} 
```

`obj.Y`现在，您可以通过3 种不同的方式观察更改：

*   在`Y`二传手
*   通过`YChanged`事件
*   通过子类化和覆盖`OnYChanged`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T18:46:59.477

您似乎想`X`成为指向`Y`. C# 不直接支持指针（仅在不安全的代码中），但您可以通过使用闭包/lambda 表达式的小技巧来正确实现这一点。

尝试将此[VB-tip](http://activevb.de/cgi-bin/tippupload/show/346/Verwaltete_Zeiger_fuer_NET)转换为 C# ( `Pointer<T>-Structure`)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-10T18:47:26.810

没有办法（直接）做你正在尝试的事情。

我能想到的最接近的事情是将 Y 封装在其他类中，并让 GiveMeARef() 直接获取类实例而不是 Y。这看起来像：

```
myClass.Y = new MyObject();
GiveMeARef(ref myClass);
myClass.Y = new MyObject(); 
```

然后你仍然可以让内部参考找到 Y - 即使它并不完全相同。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-10T18:50:49.237

最简单的解决方案是使用属性为 Y 赋值，并在 setter 函数中更新 X：

```
private MyObject m_Y = new MyObject();

public MyObject Y
{
     get { return m_Y; }
     set
     {
         m_Y = value;
         X = value;      // Here ...
     }
} 
```

另一个解决方案是创建一个新类 MyObjectWrapper，然后处理它......

另一件事，GiveMeARef(ref object obj) 中没有任何“ref”点。它已经通过引用传递。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-10T19:06:00.710

这也将实现结果，在“新”操作时保持分配，假设在您的示例中您使用许多不同的新闻并希望 X 每次都更新。

```
private static object x;
private static object CreateNew(Type t) {
    object temp;
    temp = System.Activator.CreateInstance(t);
    x = temp;
    return temp;                      
}

static void Main(string[] args) {

    object o = CreateNew(typeof(int));           
    o = CreateNew(typeof(long));

} 
```

在哪里使用反射来创建对象的实例并同时将其分配给 keeper 变量。这在很大程度上取决于问题的性质是什么，哪个是适当的解决方案。

# c# - Asp.Net MVC - 查看 -> 创建 2 个对象

> ID：845835
> 
> 赞同：1
> 
> 时间：2009-05-10T18:35:13.630
> 
> 标签：c#, asp.net-mvc, .net-3.5, views

首先，我对 MVC Asp.Net 意识形态真的很陌生。

我想知道如何在一个视图中创建两个对象（模型）？

因为如果我查看视图标题，它是从一个模型继承的：

\<%@ Page Title="" Language="C#" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage" %>

因此，例如，如果我想在同一个视图（Aspx 页面）中创建一个 MyObjectA 和一个对象 MyObjectB，那么最好的处理方法是什么？

我希望我已经清楚了...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T18:41:54.010

如果你有一个模型对象`Person`，另一个让我们说`Comment`，然后在同一个视图中你想显示一个人的详细信息和添加到那个人的评论，你可能想要创建一个中间对象，有时称为“数据传输对象”或“查看对象'。所以，我创建了一个简单的类：

```
public class PersonDetailDTO
{
    public Person PersonDetail {get; set;}
    public IList<Comment> Comments {get; set;}
} 
```

..现在我可以将我的操作结果作为类型`PersonDetailDTO`而不是说返回`Person`。然后视图也被强类型化`PersonDetailDTO`，使我可以轻松访问 PersonDetail 数据和 Comments 集合。

例如，我将这样的视图对象用于我的部分视图之一：

```
 public class AnnouncementsPartialViewData
        {
            public IList<Announcement> Announcements { get; set; }
            public object MonthlyPlannerRouteVals { get; set; }
            public object PreSchoolRouteVals { get; set; }
            public object ElementaryRouteVals { get; set; }
        } 
```

.. 部分视图标题如下所示：

```
<%@ Control Language="C#" Inherits="System.Web.Mvc.ViewUserControl<KsisOnline.Web.Controllers.HomeController.IndexViewData.AnnouncementsPartialViewData>" %> 
```

..所以我可以轻松地从视图中的该视图类访问键入的数据，如下所示：

```
<% if (Model.Announcements.Count == 0) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-10T18:44:50.027

如果“创建”是指将两个对象从控制器“传递”到视图，则应该创建一个包含这两个对象的新类，并将其从控制器传递到视图：

```
public class MyModel
{
  public MyObjectA ObjectA { get; set; }
  public MyObjectB ObjectB { get; set; }
} 
```

视图定义将如下所示：

```
<%@ Page Title="" Language="C#" MasterPageFile="~/Views/Shared/Site.Master" Inherits="System.Web.Mvc.ViewPage<MyModel>" %> 
```

在控制器中，您将创建像

```
...(in controller action)
return new MyModel { ObjectA = new MyObjectA(), ObjectB = new MyObjectB() }; 
```

从视图中，您将访问对象，例如

```
var myObjectA = Model.ObjectA; 
```

# sql - 如何从两个实时数据库创建和同步合并的仅报告数据库？

> ID：845842
> 
> 赞同：0
> 
> 时间：2009-05-10T18:41:03.620
> 
> 标签：sql, sql-server, sql-server-2000, dynamics-gp

我需要快速实现一个只读数据库，其中包含从两个结构相同的实时数据库中提取的数据。

实时数据库实际上是来自 Dynamics 会计系统的公司数据库，所以我很高兴有任何 Dynamics 特定的建议，但这主要是一个 SQL 问题。这是微软收购 Great Plains 之前相当老的 Dynamics 版本。这是在 SQL Server 2000 上。

我们有访问动态数据的报告和应用程序。这些应用程序旨在查看一个公司数据库。现在我们需要添加另一个。这些报告和应用程序中的大多数都可以看到组合数据。他们并不真正关心订单或发票存在于哪家公司。他们只查看少数表格。

在我看来，最简单的解决方案是创建一个仅包含合并数据的报告数据库。最好，我们需要一种有效的方法来每天多次更新这个数据库。

我是开发人员，不是数据库专家，但这是我的计划：

最初使用与实时数据库相同的表结构创建具有所需表的组合报告数据库。

所有 Dynamics 表似乎都有一个名为 DEX_ROW_ID 的 int 标识列。我不确定它的用途，（它没有被索引）但这似乎是唯一标识行的明显通用方法。在报告数据库上，我会将其更改为正常的 int（不是身份）。我将在所有数据库中的 DEX_ROW_ID 上创建一个唯一索引。

Dynamics 没有时间戳，因此我将在实时数据库中的表中添加时间戳列，并在报告数据库中添加相应的 binary(8) 列。我假设并希望 Dynamics 不会因额外的索引和列而感到不安。

将 int CompanyId 列添加到报告数据库表中，并将其添加到任何唯一索引的末尾。即使没有它，大多数数据自然也是独一无二的。即，两个实时数据库的订单和发票号码等将不同。我们可能需要对应用程序进行一些小的更改，但除了将它们指向新的报告数据库之外，我不希望做太多事情。

假设我的报告数据库称为 Reports，实时数据库是 Live1 和 Live2，时间戳列称为 TS，所有数据库都在同一台服务器上……这是我第一次尝试更新脚本，用于在一个名为 MyTable 的表中复制更改在 Live1 到报告数据库。

```
USE Reports

CREATE TABLE #Changes
(
ReportId int,
LiveId int
)

/* Collect in a temp table the ids or rows which have been deleted or changed
in the live db L.DEX_ROW_ID will be null if the row has been deleted */

INSERT INTO #Changes
SELECT R.DEX_ROW_ID, L.DEX_ROW_ID
FROM MyTable R LEFT OUTER JOIN Live1.dbo.MyTable L ON L.DEX_ROW_ID = R.DEX_ROW_ID
WHERE R.CompanyId = 1 AND L.DEX_ROW_ID IS NULL OR L.TS <> R.TS

/* Delete rows that have been deleted or changed on the live db 
I wonder if using join syntax would run better than the subquery. */
DELETE FROM MyTable
WHERE CompanyId = 1 AND DEX_ROW_ID IN (SELECT ReportId FROM #Changes)

/* Recopy rows that have changed in the live db */
INSERT INTO MyTable
SELECT 1 AS CompanyId, * FROM Live1.dbo.MyTable L
WHERE L.DEX_ROW_ID IN (SELECT ReportId FROM #Changes WHERE LiveId IS NOT NULL)

/* Copy the rows that are new in the live db */
INSERT INTO MyTable
SELECT 1 AS CompanyId, * FROM Live1.dbo.MyTable
WHERE DEX_ROW_ID > (SELECT MAX(DEX_ROW_ID) FROM MyTable WHERE CompanyId = 1) 
```

然后对 Live2 数据库执行相同的操作。对报告中的每个表重复此操作。我知道我应该使用参数@CompanyId 而不是文字，但我不能为实时数据库名称这样做，有些我可能会使用 C# 程序或其他东西动态生成这些名称。

我正在寻找任何关于我在这里所做的事情的建议、建议或批评。我知道它不会是原子的。此脚本运行时，实时数据库上可能会发生一些事情。我认为我们可以忍受这一点。当实时数据库上没有发生任何事情时，我们可能会每晚或每周进行一次完整复制。

我们需要注重性能而不是优雅或完美。一些初始测试有第一个查询，其中最大表的 TS 比较运行时间约为 30 秒，所以我很乐观这会起作用，但我也想知道我是否遗漏了一些明显的东西或没有看到以树为林。

我们真的不想处理报告数据库上的日志文件。我们可以将其设置为简单的恢复模式而忘记日志吗？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T19:28:36.803

我认为这里有几个悬而未决的问题。

1.  您是否需要这些报告接近实时？或者这种报告可以与每日更新一起使用？但是假设您需要最新的数据。

2.  您是否考虑过直接查询数据库并即时合并每个报告的数据？您必须进行大量报告以重复设计、创建和支持实时合并复制数据库的工作。

3.  对于针对生产数据库的任何单个查询，30 秒（恕我直言）是不可接受的。花费这么长时间可能有许多与调优相关的原因，但这至少意味着您将需要认真的专业 SQL Server 优化资源（即人员）。如果这对于报告查询来说是一个问题，那么查询维护一个单独的数据库用于报告并不是一个好兆头。

4.  回想一下，如果您需要整合到单个数据库，那么值得考虑是否应该将其设为 OLAP 数据库而不是镜像。镜像会更快更容易，但从长远来看，OLAP 会更加灵活和强大；从头开始可能会很好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T19:14:28.107

我想做的最后一件事是编写自定义更新脚本。首先尝试这些防弹方法：

1.  希望您的生产数据库已备份。每晚将这些备份还原到报告服务器。您可以使用[RESTORE 命令](http://msdn.microsoft.com/en-us/library/ms186858.aspx)自动恢复，该命令将使用网络服务器上的文件。
2.  使用[SQL Server 复制](http://msdn.microsoft.com/en-us/library/ms151198.aspx)将数据从实时服务器推送到后端。
3.  每晚安排一个 DTS 包以导入整个生产数据库。

这似乎是蛮力。但是，由于您要复制 2000 年的数据库，因此对于当今的硬件而言，蛮力不会成为问题。作为一个额外的优势，这些方法可以由系统管理员而不是开发人员来支持。

方法 1 具有作为备份验证的附加优势。:)

# javascript - IE8 简单警报失败？

> ID：845848
> 
> 赞同：1
> 
> 时间：2009-05-10T18:44:27.797
> 
> 标签：javascript, internet-explorer-8

为什么以下代码在 IE8 中不起作用？

```
<select>
    <option onclick="javascript: alert('test');">5</option> 
```

很奇怪 - IE8 中没有显示警报。我也没有在左下角看到错误图标。当然，它适用于 FF 和 Opera。有任何想法吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-05-10T18:46:12.163

将`onclick`处理程序放在`<option>`元素上似乎......对我来说很奇怪。您可能希望将其切换到更常见`onchange`的事件`<select>`。你仍然可以从那里做任何你想做的事情，这是对选择做任何你想做的事情的“公认”方式。话虽如此，您可能想尝试删除`javascript:`它的一部分。例如，仅当您在链接中执行 Javascript 时才需要这样做`href`。`onclick`处理程序需要*javascript*。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T18:46:40.647

您是否尝试过：

```
onclick="alert('test');" 
```

很确定您不需要 javascript: 前缀。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-10T20:50:39.760

所有版本的 IE (6,7,8) 都不支持选项元素上的**任何**事件处理程序。

这是一个（相当）众所周知的错误，IE 团队表示他们并不急于修复。:-(

再说一遍，Opera、Safari 和 Chrome 都对选项上的事件处理程序提供了有限的支持或不支持。

缺少选项事件：[错误 280](http://webbugtrack.blogspot.com/2007/11/bug-280-lack-of-events-for-options.html)

（相关）选项缺少样式：[错误 281](http://webbugtrack.blogspot.com/2007/11/bug-291-no-styling-options-in-ie.html)

*应该注意的是，“Edge”（想想 Windows 10 上的 IE12）目前显示此问题已在预览版本中得到修复。*

# bash - 如何在 xargs 命令中使用 >？

> ID：845863
> 
> 赞同：182
> 
> 时间：2009-05-10T18:51:37.677
> 
> 标签：bash, redirect, xargs

我想找到一个 bash 命令，它可以让我 grep 目录中的每个文件并将该 grep 的输出写入单独的文件。我的猜测是做这样的事情

```
ls -1 | xargs -I{} "grep ABC '{}' > '{}'.out" 
```

但是，据我所知， xargs 不喜欢双引号。但是，如果我删除双引号，那么该命令会将整个命令的输出重定向到一个名为 '{}'.out 的文件，而不是一系列单独的文件。

有谁知道使用 xargs 的方法吗？我只是以这个 grep 场景为例来说明我的 xargs 问题，因此任何不使用 xargs 的解决方案都不适用于我。

* * *

## 回答 #1

> 赞同：222
> 
> 时间：2009-05-10T19:22:38.640

不要犯这样的错误：

```
sh -c "grep ABC {} > {}.out" 
```

这会在很多情况下中断，包括时髦的文件名，并且无法正确引用。您`{}`必须始终是命令的一个完全独立的参数，以避免代码注入错误。你需要做的是：

```
xargs -I{} sh -c 'grep ABC "$1" > "$1.out"' -- {} 
```

适用于`xargs`以及`find`。

顺便说一句，不要在没有`-0`选项的情况下使用 xargs（除非您不担心破坏数据的非常罕见且受控的一次性交互式使用）。

也不解析`ls`。曾经。使用通配符或`find`代替：[http://mywiki.wooledge.org/ParsingLs](http://mywiki.wooledge.org/ParsingLs)

用于`find`需要递归的所有内容和一个简单的循环，其他所有内容都使用 glob：

```
find /foo -exec sh -c 'grep "$1" > "$1.out"' -- {} \; 
```

或非递归：

```
for file in *; do grep "$file" > "$file.out"; done 
```

注意正确使用引号。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2009-05-10T18:59:23.687

没有的解决方案`xargs`如下：

```
find . -mindepth 1 -maxdepth 1 -type f -exec sh -c "grep ABC '{}' > '{}.out'" \; 
```

...同样可以用 来完成*，* `xargs`结果是：

```
ls -1 | xargs -I {} sh -c "grep ABC '{}' > '{}.out'" 
```

* * *

*编辑：在*[lhunath](https://stackoverflow.com/questions/845863/how-to-use-in-an-xargs-command/845928#845928)备注后添加单引号。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2010-06-10T18:27:28.607

我假设您的示例只是一个示例，您可能需要 > 来处理其他事情。GNU Parallel [http://www.gnu.org/software/parallel/](http://www.gnu.org/software/parallel/)可能是你的救星。只要您的文件名不包含 \n，它就不需要额外的引用：

```
ls | parallel "grep ABC {} > {}.out" 
```

如果您的文件名中包含 \n：

```
find . -print0 | parallel -0 "grep ABC {} > {}.out" 
```

作为额外的奖励，您可以获得并行运行的作业。

观看介绍视频以了解更多信息：http: [//pi.dk/1](http://pi.dk/1)

10秒安装会尝试做完整安装；如果失败，个人安装；如果失败，最小安装：

```
$ (wget -O - pi.dk/3 || lynx -source pi.dk/3 || curl pi.dk/3/ || \
   fetch -o - http://pi.dk/3 ) > install.sh
$ sha1sum install.sh | grep 883c667e01eed62f975ad28b6d50e22a
12345678 883c667e 01eed62f 975ad28b 6d50e22a
$ md5sum install.sh | grep cc21b4c943fd03e93ae1ae49e28573c0
cc21b4c9 43fd03e9 3ae1ae49 e28573c0
$ sha512sum install.sh | grep da012ec113b49a54e705f86d51e784ebced224fdf
79945d9d 250b42a4 2067bb00 99da012e c113b49a 54e705f8 6d51e784 ebced224
fdff3f52 ca588d64 e75f6033 61bd543f d631f592 2f87ceb2 ab034149 6df84a35
$ bash install.sh 
```

如果您需要将其移至未安装 GNU Parallel 的服务器，请尝试`parallel --embed`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2021-12-05T00:08:48.213

实际上，这里的大多数答案都不适用于所有文件名（如果它们包含双引号和单引号），包括 lhunath 和 Stephan202 的答案。

此解决方案适用于带有单引号和双引号的文件名：

```
find . -mindepth 1 -print0 | xargs -0 -I{} sh -c 'grep ABC "$1" > "$1.out"' -- {} 
```

这是一个带有单引号和双引号的文件名的测试：

```
echo ABC > "I'm here.txt"

# lhunath solution (hangs waiting for input)

$ find . -exec sh -c 'grep "$1" > "$1.out"' -- {} \;

# Stephan202 solutions

$ find . -mindepth 1 -maxdepth 1 -type f -exec sh -c "grep ABC '{}' > '{}.out'" \;
grep: ./Im: No such file or directory
grep: here.txt > ./Im here.txt.out: No such file or directory

$ ls -1 | xargs -I {} sh -c "grep ABC '{}' > '{}.out'"
xargs: unterminated quote

# this solution
$ find . -mindepth 1 -print0 | xargs -0 -I{} sh -c 'grep ABC "$1" > "$1.out"' -- {}

$ ls -1
"I'm here.txt"
"I'm here.txt.out" 
```

# c# - 如何从数据行中获取列？

> ID：845872
> 
> 赞同：13
> 
> 时间：2009-05-10T18:57:04.187
> 
> 标签：c#, datatable, datarowcollection

我有一个行集合（DataRow[] 行）。我想将所有行导入另一个 DataTable（DataTable dt）。

但是怎么做？

### 代码

```
DataTable dt;
if (drs.Length>0)
{
    dt = new DataTable();

    foreach (DataRow row in drs)
    {
        dt.Columns.Add(row???????)
    }

    // If it possible, something like that => dt.Columns.AddRange(????????)

    for(int i = 0; i < drs.Length; i++)
    {
        dt.ImportRow(drs[i]);
    }
} 
```

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-05-10T19:01:32.013

假设所有行都具有相同的结构，最简单的选择是克隆旧表，省略数据：

```
DataTable dt = drs[0].Table.Clone(); 
```

或者，类似：

```
foreach(DataColumn col in drs[0].Table.Columns)
{
    dt.Columns.Add(col.ColumnName, col.DataType, col.Expression);
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-05-10T19:13:33.787

如果您的 DataRows 来自其中定义了列的数据表，

```
DataRow[] rows;

DataTable table = new DataTable();
var columns = rows[0].Table.Columns;

table.Columns.AddRange(columns.Cast<DataColumn>().ToArray());

foreach (var row in rows)
{
    table.Rows.Add(row.ItemArray);  
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T19:07:18.023

怎么样

```
DataTable dt = new DataTable;
foreach(DataRow dr in drs)
{
    dt.ImportRow(dr);
} 
```

请注意，这仅适用`drs`于`DataRowCollection`. 分离的行（不在 a`DataRowCollection`中被忽略）。

不要忘记调用 AcceptChanges。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-09-15T22:06:38.167

试试这个：

```
// Assuming you have a DataRow object named row:
foreach(DataColumn col in row.Table.Columns)
{
    // Do whatever you need to with these columns
} 
```

# grails - 从 YUI 富文本编辑器等编辑器处理 WsiWyg 文本的最佳实践是什么？

> ID：845881
> 
> 赞同：0
> 
> 时间：2009-05-10T19:01:39.843
> 
> 标签：grails, yui, ria

我正在寻找有人可以分享有关使用富文本编辑器（例如 YUI 的富文本编辑器）的任何经验。特别是我对如何处理或预防问题感兴趣

1.  跨站脚本
2.  图像或附件处理

您可以提供链接或网络文章的任何类似问题将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-12T07:33:31.963

推荐的方法是使用白名单。我们使用[Antisamy](http://www.owasp.org/index.php/Category:OWASP_AntiSamy_Project)和一些自定义 XPath 表达式。使用 antisamy，您可以定义允许哪些标签和哪些属性。对于属性，您可以定义有效值列表或描述有效值的正则表达式。白名单可以很好地缓解跨站点脚本的问题。

[http://www.owasp.org/](http://www.owasp.org/)有很多关于 Web 应用程序安全性的优秀资源和指南。（因此您可以阅读更多问题，例如跨站点请求伪造、SQL 注入……）

您对图像或附件处理有什么疑问？

# javascript - jQuery 变形类

> ID：845885
> 
> 赞同：2
> 
> 时间：2009-05-10T19:05:56.747
> 
> 标签：javascript, jquery, css

我不确定标题是否是我试图描述的，但我试了一下。

我有两节课

“big_green”和“small_blue”

big_green = 100x100 绿色盒子 small_blue = 50x50 蓝色盒子

我记得曾经有一个 js 库可以让你补间类，我认为它是 mootools。无论如何，jQuery中有什么方法可以动画两个类之间的变化。例子：

```
<div class="big_green"></div> 
```

将其类更改为 small_blue 但过渡是动画的。它遍历 100x100 和 50x50 之间的所有尺寸以及绿色和蓝色之间的所有颜色值。对不起，如果这个问题有点令人困惑，因为我不太擅长解释事情：S

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-10T19:29:57.177

[如果我了解您的问题，这](http://jqueryui.com/demos/toggleClass/)应该正是您正在寻找的。它是 jQuery UI 库的一部分。

# python - 自动生成代码的单元测试：自动还是手动？

> ID：845887
> 
> 赞同：3
> 
> 时间：2009-05-10T19:06:44.033
> 
> 标签：python, unit-testing, code-generation

我知道以前有人问过[类似的问题](https://stackoverflow.com/questions/32899/how-to-generate-dynamic-unit-tests-in-python)，但他们并没有我正在寻找的信息——我不是在问如何生成单元测试的机制，而是问这是否是个好主意。

我用 Python 编写了一个模块，其中包含表示物理常数和测量单位的对象。许多单位是通过在基本单位上添加前缀来形成的 - 例如，从`m`我得到`cm`, `dm`, `mm`, `hm`, `um`, `nm`,`pm`等。对于`s`, `g`, `C`, 等也是如此。当然我已经编写了一个函数来做到这一点，因为最终结果是超过 1000 个单独的单元，手动将它们全部写出来会很痛苦；-) 它的工作原理是这样的（不是实际的代码）：

```
def add_unit(name, value):
    globals()[name] = value
    for pfx, multiplier in prefixes:
        globals()[pfx + name] = multiplier * value

add_unit('m', <definition of a meter>)
add_unit('g', <definition of a gram>)
add_unit('s', <definition of a second>)
# etc. 
```

当我想为这些单元（没有双关语）编写单元测试时，问题就出现了，以确保它们都有正确的值。如果我编写的代码分别为每个单元自动生成一个测试用例，那么单元生成函数中的任何问题都可能会出现在测试生成函数中。但是考虑到替代方案（手动写出所有 1000 多个测试），我是否应该继续编写测试生成函数，非常仔细地检查它并希望它能正常工作？或者我是否应该只测试一系列单位（`m`、`cm`、`dm`、`km`、`nm`、`um`以及所有其他仪表的倍数），足以确保单位生成功能似乎正常工作？或者是其他东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T19:16:39.540

如果您自动生成测试：

*   您可能会发现阅读所有测试（检查它们的正确性）比手动编写它们更快。

*   它们也可能更易于维护（如果您想稍后编辑它们，则更容易编辑）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T19:17:28.150

您正确地识别了自动生成测试用例的弱点。测试的用处来自于采用两条不同的路径（您的代码和您自己的心理推理）来得出应该是相同的答案——如果您两次使用相同的路径，则没有任何东西被测试。

总结：**永远不要编写自动生成的测试**，除非生成测试结果的算法比您正在测试的算法简单得多。（排序算法的测试是自动生成测试的一个例子，因为它很容易验证数字列表是否按排序顺序。另一个很好的例子是[ChrisW](https://stackoverflow.com/questions/845887/unit-tests-for-automatically-generated-code-automatic-or-manual/845907#845907)在注释。在这两种情况下，自动生成都是有意义的，因为验证给定解决方案的正确性比生成正确的解决方案要容易得多。）

**我对您的案例的建议：**手动测试一个小的、有代表性的可能性子集。

[澄清：某些类型的自动化测试是适当且非常有用的，例如[模糊](http://en.wikipedia.org/wiki/Fuzz_testing)测试。我的意思是，为生成的代码自动生成单元测试是没有帮助的。]

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T19:36:04.203

我想说最好的方法是对生成进行单元测试，作为单元测试的一部分，您可能会获取一个生成的样本结果（仅足以测试您认为与其他场景有显着不同的东西）并放入在单元测试下，以确保生成正常工作。除此之外，以自动化方式定义每个场景几乎没有单元测试价值。将一些功能测试组合在一起可能具有功能测试价值，这些测试可以锻炼生成的代码以执行您想到的任何目的，以便为各种潜在单元提供更广泛的覆盖范围。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T21:38:31.273

只编写足够的测试以确保您的代码生成正确（刚好足以驱动命令式代码的设计）。声明式代码很少中断。你应该只测试可以破坏的东西。通过探索性测试可以更好地发现声明性代码中的错误（例如您的案例和例如用户界面布局），因此为它们编写广泛的自动化测试是浪费时间。

# javascript - 网格的第一列是标题？

> ID：845889
> 
> 赞同：2
> 
> 时间：2009-05-10T19:07:19.913
> 
> 标签：javascript, jquery-ui, header, yui

有没有办法（使用 jquery、yui 或其他一些 js 库）显示在第一列中有标题的网格？

也就是说，我会有类似的东西：

```
Name       Geoffrey
EMail      GMan67@..
Username   GJFM 
```

代替：

```
Name      EMail      Username
Geoffrey  GMan67@..  GJFM 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T19:58:21.187

您要创建的内容称为数据透视表。不过，我不知道有任何开箱即用的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-10T20:57:53.413

是的，有办法做到这一点，我花了一个小时来写，但这是一个很好的练习:)

这将就地切换标题和列。它是双向的。即你可以用它来回切换两种风格。

```
// number of columns
columns = $('table.flipme th').size();
// number of rows minus one to exclude the header
rows = $('table.flipme tr').size() - 1;  
$table = $('table.flipme');

// Add rows to the table to equal the number of columns
while (rows < columns){
    $table.append('<tr></tr>');
    rows++
}

// flip in place and mark the old rows and
// columns as a duplicate to be removed
for (i=1; i<=rows; i++){
    $('tr')
    .children(':nth-child(' + i + ')').addClass('delete')
    .clone(true).removeClass('delete')
    .appendTo('tr:eq(' + i + ')');
}
// remove dublicate
$('.delete').remove(); 
```

# php - 正则表达式 - 匹配（仅）具有混合字符的单词

> ID：845890
> 
> 赞同：2
> 
> 时间：2009-05-10T19:08:29.647
> 
> 标签：php, regex, filter, match, profanity

我正在编写我的反垃圾邮件/恶意过滤器，如果可能的话，我需要，

仅匹配（检测）由混合字符组成的单词，例如：fr1&nd$ 而不是朋友

这可能与正则表达式！？

最好的祝福！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-10T19:29:32.637

当然可以使用正则表达式！你不是要求匹配嵌套的括号！:P

但是，是的，这就是正则表达式的用途。一个例子：

```
/\S*[^\w\s]+\S*/ 
```

这将匹配以下所有内容：

```
@ss
as$
a$s
@$s
a$$
@s$
@$$ 
```

它*不会*匹配这个：

```
ass 
```

我相信这是你想要的。这个怎么运作：

`\S*`匹配 0 个或多个非空格字符。`[^\w\s]+`仅匹配符号（它将匹配任何不是单词或空格的字符），并匹配其中的 1 个或多个（因此需要符号字符。）然后`\S*`再匹配 0 个或多个非空格字符（符号和字母）。

如果允许我提出更好的策略，在 Perl 中，您可以将正则表达式存储在变量中。我不知道您是否可以在 PHP 中执行此操作，但如果可以，您可以构建一个变量列表，如下所示：

```
$a = /[aA@]/ # regex that matches all a-like symbols
$b = /[bB]/
$c = /[cC(]/
# etc... 
```

或者：

```
$regex = array( 'a' => /[aA@]/, 'b' => /[bB]/, 'c' => /[cC(]/, ... ); 
```

这样，您可以将所有排列中的“朋友”与：

```
/$f$r$i$e$n$d/ 
```

或者：

```
/$regex['f']$regex['r']$regex['i']$regex['e']$regex['n']$regex['d']/ 
```

诚然，第二个看起来不必要地冗长，但那是你的 PHP。我认为第二个可能是最好的解决方案，因为它将它们全部存储在哈希中，而不是全部作为单独的变量，但我承认它产生的正则表达式有点难看。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T19:19:45.493

您可以构建一些正则表达式，如下所示：

```
\p{L}+[\d\p{S}]+\S* 
```

这将匹配一个或多个字母（`\p{L}+`参见[Unicode 字符首选项](http://docs.php.net/manual/regexp.reference.php#regexp.reference.unicode)）、一个或多个数字或符号 ( `[\d\p{S}]+`) 以及任何后续非空白字符的任何序列`\S*`。

```
$str = 'fr1&nd$ and not friends';
preg_match('/\p{L}+[\d\p{S}]+\S*/', $str, $match);
var_dump($match); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T19:20:11.950

有可能，您不会有非常漂亮的正则表达式规则，但您基本上可以匹配您可以使用正则表达式描述的任何模式。棘手的部分是描述它。

我猜你会有一堆正则表达式规则来检测像这样的坏词：

要检测 fr1&nd$、friends、fr**nd*，您可以使用如下正则表达式：

`/fr[1iI*][&eE]nd[s$Sz]/`

对每个规则执行类似的操作会在括号中找到所有可能字符的变体。获取正则表达式指南以获取更多信息。

（我假设你想要一个坏词过滤器，你可能想要掩盖坏词以及所有可能的排列`friend`）`frie**`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T19:35:46.980

没有彻底测试，但应该这样做：

```
(\w+)*(?<=[^A-Za-z ]) 
```

# ruby-on-rails - 将方法传递给 validates_format_of

> ID：845894
> 
> 赞同：0
> 
> 时间：2009-05-10T19:12:22.680
> 
> 标签：ruby-on-rails

我想做这个：

```
validates_format_of :email, :with => email_regex

def email_regex
  email_name_regex  = '[A-Z0-9_\.%\+\-]+'
  domain_head_regex = '(?:[A-Z0-9\-]+\.)+'
  domain_tld_regex  = '(?:[A-Z]{2,4}|museum|travel)'
  return /\A#{email_name_regex}@#{domain_head_regex}#{domain_tld_regex}\z/i
end 
```

但我收到一条错误消息，说我必须将正则表达式传递给 validates 方法。我确信你可以做这样的事情。我错过了一步吗？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-10T19:14:03.787

只使用一个常数呢？这也将确保正则表达式只编译一次。

```
class ...
  FOO_BAR = /#{baz}.../

  validatess ... :with => FOO_BAR 
```

但是，是的，我不确定为什么你的方式行不通。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T20:09:56.393

您的代码看起来不错。而且我猜您`email_regex`在 validates 方法使用它之前定义了方法。

您必须调试`validates_format_of`得到的内容（修改 RoR 代码以打印 :with 参数类型）。这应该很容易，可以帮助您解决问题。

现在我只能猜测该`email_regex`方法在某处被重新定义并返回正则表达式以外的其他内容。

# licensing - 将许可证放入每个代码文件中？

> ID：845895
> 
> 赞同：102
> 
> 时间：2009-05-10T19:12:50.700
> 
> 标签：licensing

我发现在每个代码文件中都存在不必要的重复，但我在大多数开源项目中都看到了它。我应该这样做，还是只在代码之外包含一个许可证？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2009-05-10T19:15:52.630

请在代码之外单独一个！我不知道其他人，但我讨厌在每个文件的顶部看到同样的东西。

我想我已经读过几次了，只是通过 page_down-ing 阅读它。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-05-10T19:53:11.773

EULA 在这里是错误的术语，因为查看源代码的人通常不是最终用户。

从法律上讲，这也没有什么区别；版权不需要明确声明。

基本上，您所做的只是降低人们*意外*违反您的许可条款的风险。你必须决定这对你有多重要。

我想说最好的折衷办法是在每个源代码文件中放置一个非常短的标头，其中包含指向完整许可证文本的链接（绝对 URL 以及项目中的相对链接）。这样，任何关心许可证的人都知道在哪里可以找到它（理想情况下，愿意支付大量许可证费用的人；您当然希望*这些*人能够与您联系！）

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-05-10T21:17:17.860

不，您不必将许可证放在每个源代码文件中。

如果您仔细观察，大多数 FOSS 应用程序也不会这样做。他们在每个文件的顶部放置一个版权声明，并用一个简短的句子告诉您该文件所依据的许可证以及您在哪里可以找到许可证的全文。他们通常将您指向包含许可证全文的 COPYING 或 LICENSE 文件和/或包含全文的网站（以防 COPYING 文件不再存在）。

就像 Michael Borgwardt 在他的回答中所说的那样，从法律上讲，您不必这样做。但建议您使用您打算分发的源代码，因为人们可以立即看到谁拥有版权以及许可证是什么。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2013-03-11T02:51:36.303

这可能取决于许可证。GPL**区分`preamble`和`license`**。它清楚地指出，（烦人的）**序言必须是代码的一部分**：

> 我可以省略 GPL 的序言，或者如何在你自己的程序中使用它的说明，以节省空间吗？
> 
> > 序言和说明是 GNU GPL 的组成部分，不得省略。事实上，GPL 是受版权保护的，它的许可证只允许逐字复制整个 GPL。（您可以使用法律条款来制作另一个许可证，但它不会是 GNU GPL。）（1）

资料来源：1) [http://www.gnu.org/licenses/gpl-faq.html#GPLOmitPreamble](http://www.gnu.org/licenses/gpl-faq.html#GPLOmitPreamble)

另请参阅[http://softwarefreedom.org/resources/2012/ManagingCopyrightInformation.html](http://softwarefreedom.org/resources/2012/ManagingCopyrightInformation.html)

[ifrOSS](http://www.ifross.org/gpl-version-2)的免费电子书以德语解释和评论 GPL 2。GPL 3还有[一个](http://www.ifross.org/gpl-version-3)

要获得有根据的答案，您应该寻求 sx 上没有的法律建议。如果您无法为您的（开源）项目找到律师，请查看[FSFE 法律网络](https://fsfe.org/activities/ftf/)。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-05-10T19:36:20.677

我认为将其放在每个文件中的理由是合法的。如果每个文件中都有协议，那么在没有接触到许可证的情况下，就不可能有人偶然发现一段代码。

它可能不是一个好的，但所有大男孩都使用它，所以如果只是视觉上的痛苦，我会寻找一个更好的理由不这样做。

如果您使用的是 GPL，这将是一个更大的问题，但如果您使用的是 BSD 或 MIT 等公共领域许可证，我认为您并不真正关心人们如何处理这些代码。我想这取决于您的许可证有多严格。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-05-10T19:57:39.097

伊纳尔，

假设您谈论的是许可，而不是 EULA，您可以将许可放在外面。这几乎总是通过 GPL 等非常长的许可证来完成。将整个 GPL 许可证放在每个文件中是愚蠢的。通常，您只会收到某种类型的通知，说明在哪里可以找到实际许可证。这是完全合法的。然而，对于像 BSD/Apache/MIT/whatever 这样的非常短的许可证，在每个文件中包含许可证会更简单，因为说明在哪里可以找到许可证的通知几乎与许可证本身一样长。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-12T14:24:06.733

这取决于许可证规定的内容。例如，GPL 指示您在每个源文件中放置一个简短的通知，将整个许可证包含在您的源代码分发中的某个位置，并使您的源代码分发可供任何获得二进制分发副本的人使用。

如果您不同意这一点，并且这是您的代码，您可以自由选择更合适的许可证，或创建自己的许可证。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-05-10T19:17:38.413

如果您的代码将被编译，那么您只是分发二进制文件，那么这真的没关系。因为当你创建一个二进制文件时，注释在编译过程发生之前就被删除了。仅重要的是您将分发实际源代码是开源还是闭源。如果您将使用无法编译的脚本语言分发应用程序，这很重要。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-05-11T10:10:58.440

您不需要它来获得许可证，只要明确它涵盖的文件，单个外部文件就可以了。

但是对于**版权**，您应该在每段文字上都有版权声明。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-07-24T03:19:16.980

我所做的是在文件顶部放两行注释，说明我的公司名称、最后修订日期和源文件所具有的许可证名称，然后在文件的最底部是简短版本的执照。

当然，完整的许可证（如果有多个许可证，则全部）总是包含在源文件和发布目录中。

# ipython - 无法让 IPython 读取 shell 变量

> ID：845897
> 
> 赞同：2
> 
> 时间：2009-05-10T19:14:02.507
> 
> 标签：ipython

我在 IPython 中运行命令

```
cd $cs<TAB> 
```

但它不允许我扩展路径。

**如何让 IPython 读取 shell 变量？**

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-05-10T19:31:03.977

如果我正确理解您所说的“shell 变量”是什么意思。如果您的意思是在 shell 中设置的变量（“环境变量”）：您可以使用 os.environ... 读取它们

```
import os
cs = os.environ.get('cs')
runstring = "cd %s" (cs)
... 
```

# django - 如何更改 django 模板中布尔值的打印方式？

> ID：845901
> 
> 赞同：42
> 
> 时间：2009-05-10T19:14:56.373
> 
> 标签：django, django-models, django-templates

我有一些打印 BooleanField 的 django 代码

它呈现为真或假，我可以将标签更改为同意/不同意，还是需要在模板中为此编写逻辑？

* * *

## 回答 #1

> 赞同：99
> 
> 时间：2009-05-10T21:33:05.790

```
{{ bool_var|yesno:"Agree,Disagree" }} 
```

您还可以为 None 情况提供额外的字符串。有关详细信息，请参阅[yesno](http://docs.djangoproject.com/en/stable/ref/templates/builtins/#yesno)的文档。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2020-12-19T15:31:49.110

如果您想拥有更多选项，例如添加 HTML 元素和类，这只是另一种方式

```
{% if var == True %} Yes {% else %} No {% endif %} 
```

您可以将 Yes 和 No 更改为任何 html 元素；图像或跨度元素

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-11-30T12:02:02.833

如果您的模型已定义为

```
class mymodel(models.Model):
    choices=((True, 'Agree'), (False,'Disagree'),(None,"Maybe"))
    attr = models.BooleanField(choices=choices, blank=False, null=True) 
```

您可以使用内置方法来检索与模板中的值关联的“漂亮”字符串

```
{{ object.get_attr_display }} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2022-02-23T18:56:51.067

可以尝试以下任何一种方法并获得一致的结果：

一种。

```
{% if  form.my_bool.value %} 
    {{ "Yes" }} 
{% else %} 
    {{ "No" }} 
{% endif %} 
```

B.

```
{{ form.my_bool.value|yesno }} 
```

C。

```
{{ form.my_bool.value|yesno:"Yes,No" }} 
```

D.

```
{% if form.my_bool.value == True %} Yes {% else %} No {% endif %} 
```

或者简单地说，

```
{{ form.my_bool.value }}    # Here the output will be True or False, as the case may be. 
```

# sql - Django select_related() 使用模型和过滤器进行多连接查询

> ID：845903
> 
> 赞同：1
> 
> 时间：2009-05-10T19:15:33.423
> 
> 标签：sql, mysql, django, django-models, left-join

我有两个模型：工作和位置：

```
class Job(models.Model):
   title = models.CharField(max_length=20)
   company = models.CharField(max_length=20)
   location = ForeignKey('Location')

class Location(models.Model):
   country = models.CharField(max_length=20)
   state = models.CharField(max_length=20)
   city = models.CharField(max_length=20)
   latitude = models.FloatField(blank=True, default=0.0)
   longitude = models.FloatField(blank=True, default=0.0)
   big-city = ForeignKey('Location') 
```

假设：我的数据库中有 US/Calif/San-Fran、US/Calif/San_Jose、US/Calif/Alameda 和 US/Calif/Oakland。我还有经理/Ebay/San-Fran、会计/Amazon/San-Jose、Coop/IBM/Oakland 和主管/Dell/Alameda。

另外： San-Fran 将自己称为 big_city，而 San-Jose、Alameda 和 Oakland 将 San-Fran 作为他们的大城市。

现在，当有人在 San-Fran 搜索所有工作时，我会执行这样的查询。

```
Job.objects.filter(
location__country='US', 
location__state='Calif', 
location__city='San-Fran').selected_related('Location') 
```

但是，我想允许按地区搜索，用户可以在其中搜索 San-Fran 地区的所有工作。这将是 San-Fran、Oakland、Alameda 和 San-Jose 的所有工作吗？

就像“告诉我所有有其位置的工作都被其他位置引用”。

这会被称为双连接吗？

理想情况下，我会使用 lat-lon-radius （稍后的练习），但现在我想知道如何使用双连接来做到这一点。

谢谢。

Vn44ca

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T19:48:35.460

这是一个应该做你想做的查询：

```
Job.objects.filter(location__big_city__city='San-Fran', location__big_city__state='Calif', location__big_city__country='USA') 
```

事实上，Django 在运行此查询时在 Location 表上使用了两次连接：

```
SELECT "example_job"."id", "example_job"."title", "example_job"."company", "example_job"."location_id" FROM "example_job" INNER JOIN "example_location" ON ("example_job"."location_id" = "example_location"."id") INNER JOIN "example_location" T3 ON ("example_location"."big_city_id" = T3."id") WHERE (T3."country" = USA  AND T3."city" = San-Fran  AND T3."state" = Calif 
```

# casting - 编组和铸造。它们有关系吗？

> ID：845911
> 
> 赞同：1
> 
> 时间：2009-05-10T19:17:50.363
> 
> 标签：casting, marshalling

上周一个年轻的学生问我编组和选角是否一样。我的回答肯定是不。编组是序列化，将对象的内存表示转换为字节以便传输到网络的方法，而强制转换与类型转换/强制有关。

后来，重新思考这个问题，我认为编组可以看作是铸造的一种特殊情况。例如，内存表示的转换是在 xml 中，那么可以说您正在“转换”为该 xml 文件的相应 xsd 语法定义的类型。

你怎么看待这件事？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-10T19:25:45.280

强制转换不会修改数据类型。这是一个主要区别。当您编组某些内容时，您正在将数据转换为其他内容。

一个简单的转换只会改变你解释对象的方式，而不是对象内部的内容。

我同意区分应该清楚，否则不熟悉的人可能会感到困惑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-10T19:21:42.103

编组通常与技术边界有关（例如，在托管/非托管的情况下，跨越网络或从一种内存类型到另一种内存类型），而强制转换通常在相同的技术边界内，因此我认为它们绝对是不同的东西。

如果我们对这两种方法使用相同的术语，这将非常令人困惑，这意味着我们需要对它们进行不同的定义，因为它们具有不同的行为。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T19:26:11.207

它们都是“类型转换”，但是，它们是不同类型的类型转换：转换通常在相关对象类型之间进行（例如，从超类向下转换到子类），而编组可能来自例如对象图为纯文本表示。

# c++ - What is the C++ function to raise a number to a power?

> ID：845912
> 
> 赞同：169
> 
> 时间：2009-05-10T19:18:54.853
> 
> 标签：c++, math

How do I raise a number to a power?

```
2^1

2^2

2^3 
```

etc...

* * *

## 回答 #1

> 赞同：165
> 
> 时间：2009-05-10T19:20:35.430

pow() in the cmath library. More info [here](http://en.cppreference.com/w/cpp/numeric/math/pow). Don't forget to put `#include<cmath>` at the top of the file.

* * *

## 回答 #2

> 赞同：105
> 
> 时间：2009-05-10T19:41:43.413

`std::pow` in the `<cmath>` header has these overloads:

```
pow(float, float);
pow(float, int);
pow(double, double); // taken over from C
pow(double, int);
pow(long double, long double);
pow(long double, int); 
```

Now you can't just do

```
pow(2, N) 
```

with N being an int, because it doesn't know which of `float`, `double`, or `long double` version it should take, and you would get an ambiguity error. All three would need a conversion from int to floating point, and all three are equally costly!

Therefore, be sure to have the first argument typed so it matches one of those three perfectly. I usually use `double`

```
pow(2.0, N) 
```

Some lawyer crap from me again. I've often fallen in this pitfall myself, so I'm going to warn you about it.

* * *

## 回答 #3

> 赞同：40
> 
> 时间：2015-05-20T18:33:21.483

In C++ the "^" operator is a bitwise OR. It does not work for raising to a power. The x << n is a left shift of the binary number which is the same as multiplying x by 2 n number of times and that can only be used when raising 2 to a power. The POW function is a math function that will work generically.

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2009-05-10T19:20:50.467

Use the pow(x,y) function: [See Here](http://www.cplusplus.com/reference/clibrary/cmath/pow/)

Just include math.h and you're all set.

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-05-10T19:24:36.267

You should be able to use normal C methods in math.

`#include <cmath>`

`pow(2,3)`

if you're on a unix-like system, `man cmath`

Is that what you're asking?

Sujal

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2009-05-10T19:25:43.067

While `pow( base, exp )` is a great suggestion, be aware that it typically works in floating-point.

This may or may not be what you want: on some systems a simple loop multiplying on an accumulator will be faster for integer types.

And for square specifically, you might as well just multiply the numbers together yourself, floating-point or integer; it's not really a decrease in readability (IMHO) and you avoid the performance overhead of a function call.

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2015-10-08T19:58:10.397

I don't have enough reputation to comment, but if you like working with QT, they have their own version.

```
 #include <QtCore/qmath.h>
    qPow(x, y); // returns x raised to the y power. 
```

Or if you aren't using QT, cmath has basically the same thing.

```
 #include <cmath>
    double x = 5, y = 7; //As an example, 5 ^ 7 = 78125
    pow(x, y); //Should return this: 78125 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2018-08-01T11:22:40.207

if you want to deal with **base_2** only then i recommend using left shift operator ***<<*** instead of **math library**.

sample code :

```
int exp = 16;
for(int base_2 = 1; base_2 < (1 << exp); (base_2 <<= 1)){
std::cout << base_2 << std::endl;
} 
```

sample output :

```
1   2   4   8   16  32  64  128  256  512  1024  2048  4096  8192  16384  32768 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2014-12-02T15:47:51.517

```
#include <iostream>
#include <conio.h>

using namespace std;

double raiseToPow(double ,int) //raiseToPow variable of type double which takes arguments (double, int)

void main()
{
    double x; //initializing the variable x and i 
    int i;
    cout<<"please enter the number"; 
    cin>>x;
    cout<<"plese enter the integer power that you want this number raised to";
    cin>>i;
    cout<<x<<"raise to power"<<i<<"is equal to"<<raiseToPow(x,i);
} 
```

//definition of the function raiseToPower

```
double raiseToPow(double x, int power)
{
    double result;
    int i;
    result =1.0;
    for (i=1, i<=power;i++)
    {
        result = result*x;
    }
    return(result);
} 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-05-10T19:21:07.503

It's pow or powf in `<math.h>`

There is no special infix operator like in Visual Basic or Python

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2018-07-30T07:03:21.480

Many answers have suggested `pow()` or similar alternatives or their own implementations. However, given the examples (`2^1`, `2^2` and `2^3`) in your question, I would guess whether you only need to raise `2` to an integer power. If this is the case, I would suggest you to use `1 << n` for `2^n`.

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-05-10T19:22:18.030

```
pow(2.0,1.0)
pow(2.0,2.0)
pow(2.0,3.0) 
```

Your original question title is misleading. To just *square*, use `2*2`.

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2017-04-09T21:59:18.107

Note that the use of `pow(x,y)` is less efficient than `x*x*x` y times as shown and answered here [https://stackoverflow.com/a/2940800/319728](https://stackoverflow.com/a/2940800/319728).

So if you're going for efficiency use `x*x*x`.

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2019-05-07T12:24:22.300

First add `#include <cmath>` then you can use **`pow`** methode in your code for example :

```
pow(3.5, 3); 
```

Which **3.5** is **base** and ***3*** is ***exp***

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2017-02-28T20:43:00.267

```
int power (int i, int ow) // works only for ow >= 1
{ // but does not require <cmath> library!=)
    if (ow > 1)
    {
         i = i * power (i, ow - 1);
    }
    return i;
}

cout << power(6,7); //you can enter variables here 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2017-10-30T14:37:52.503

I am using the library `cmath` or `math.h` in order to make use of the `pow()` library functions that takes care of the powers

```
#include<iostream>
#include<cmath>

int main()
{
    double number,power, result;
    cout<<"\nEnter the number to raise to power: ";
    cin>>number;
    cout<<"\nEnter the power to raise to: ";
    cin>>power;

    result = pow(number,power);

    cout<<"\n"<< number <<"^"<< power<<" = "<< result;

    return 0;
} 
```

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2019-11-11T20:08:33.180

use pow() function in cmath, tgmath or math.h library.

```
#include <iostream>
#include <cmath>
using namespace std;

int main()
{
int a,b;
cin >> a >> b;
cout << pow(a,b) << endl; // this calculates a^b

return 0;
} 
```

do note that if you give input to power as any data type other than long double then the answer will be promoted to that of double. that is it will take input and give output as double. for long double inputs the return type is long double. for changing the answer to int use, int c=(int)pow(a,b)

But, do keep in mind for some numbers this may result in a number less than the correct answer. so for example you have to calculate 5^2, then the answer can be returned as 24.99999999999 on some compilers. on changing the data type to int the answer will be 24 rather than 25 the correct answer. So, do this

```
int c=(int)(pow(a,b)+0.5) 
```

Now, your answer will be correct. also, for very large numbers data is lost in changing data type double to long long int. for example you write

```
long long int c=(long long int)(pow(a,b)+0.5); 
```

and give input a=3 and b=38 then the result will come out to be 1350851717672992000 while the correct answer is 1350851717672992089, this happens because pow() function return 1.35085e+18 which gets promoted to int as 1350851717672992000\. I suggest writing a custom power function for such scenarios, like:-

```
long long int __pow (long long int a, long long int b)
{
long long int q=1;
for (long long int i=0;i<=b-1;i++)
{
q=q*a;
}

return q;
} 
```

and then calling it whenever you want like,

```
int main()
{
long long int a,b;
cin >> a >> b;

long long int c=__pow(a,b);
cout << c << endl;

return 0;
} 
```

For numbers greater than the range of long long int, either use boost library or strings.

# reusability - 你如何组织你的代码库？

> ID：845920
> 
> 赞同：7
> 
> 时间：2009-05-10T19:21:01.747
> 
> 标签：reusability, organization, package-design

我很想知道人们如何组织他们的代码库，尤其是在可重用组件方面。我在下面用 OO 术语谈论，但我对您如何为其他类型的语言组织库也很感兴趣。

例如：

*   您是所有类库项目的忠实拥护者，还是更喜欢将所有内容保存在一个项目中？
*   您是否重用了预构建的 DLL，或者您是否在当前工作中包含了以前项目中的各个类？如果是单独的课程，您是否在项目之间共享它们以确保所有课程都保持最新，或者您是否允许分支？
*   您的可重用元素有多大？他们的专注度如何？他们是如何集中注意力的？
*   您通过首选实践实现了何种程度的重用？

等等

编辑

我不是在这里寻找具体的指导，我只是对人们的思想和实践感兴趣。我对在不同项目之间重用代码特别感兴趣，而不是在单个项目中重用。（不幸的是，这里使用“项目”具有误导性——我的意思是在为客户开展的实际项目之间重用，而不是 Visual Studio 意义上的项目。）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-10T19:31:58.873

它通常可以通过**部署**注意事项来指导：

您将如何部署（即您将在生产机器上复制什么）？

如果您正在部署的是**打包**的组件（即 dll、jar、war...），那么将“代码库”组织为一组*打包*的文件集合是明智的。
这样，您将直接使用 -- dll、jar、war、... -- 进行开发，这些将部署在生产平台上。
这个想法是：如果它适用于那些打包的文件，它可能仍然可以在生产中工作。

* * *

> 在不同项目之间而不是在单个项目中重用代码。

我认为这种重用在“组件”方法中更容易（就像问题“ [GIT 中的供应商分支”中](https://stackoverflow.com/questions/769786/vendor-branches-in-git/769941#769941)讨论的那样）

超过 40 个当前项目，我们实现了：

*   **通过将任何纯技术方面系统地隔离到独立框架（通常是日志框架、异常框架、KPI - 关键绩效指标 - 框架等）中来进行技术重用**。
    这些技术组件被重用到其他所有项目中。
*   **通过设置清晰的*应用架构来实现***功能重用**，以便将任何功能域（给定业务和功能规范）划分为明确定义的应用程序。例如，这通常会涉及一个总线层，它也是公开任何其他项目重用的服务的绝佳候选者。**

 **总结：
对于大型功能域，单个项目难以管理，一个好的应用架构将导致自然的代码重用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T19:31:55.287

我们遵循以下原则：

*   发布-重用等效原则：重用的粒度就是发布的粒度。
*   通用关闭原则：包中的类应该一起关闭以防止相同类型的更改。
*   通用重用原则：包中的类一起重用。
*   非循环依赖原则：包依赖图中不允许有循环。
*   稳定依赖原则：在稳定的方向上依赖。
*   稳定抽象原则：一个包应该是抽象的，因为它是稳定的。

[您可以在此处](http://www.objectmentor.com/resources/articles/granularity.pdf)和[此处](http://www.objectmentor.com/resources/articles/stability.pdf)找到更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-10T19:31:02.883

这取决于你工作的平台。我是一名（自豪的）Java 开发人员，我们有很好的工具来组织我们的依赖项，例如[Maven](http://maven.apache.org)或[Ivy](http://ant.apache.org/ivy/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T23:05:22.520

无论您决定其他什么，良好的源代码控制对此都至关重要，因为它允许您以任何您喜欢的方式实施您的策略，而不会产生大量不相关的库副本。良好的分支支持是必不可少的。

# python - 通过Python重命名XP中的无效文件名

> ID：845926
> 
> 赞同：4
> 
> 时间：2009-05-10T19:22:09.983
> 
> 标签：python, unicode, windows-xp

我的问题类似于[Python 的 os.path 阻塞希伯来文件名](https://stackoverflow.com/questions/497233/pythons-os-path-choking-on-hebrew-filenames)

但是，我不知道我需要重命名的文件名的原始编码（不像其他帖子他知道它最初是希伯来语）。

我正在为客户端进行数据恢复并将文件复制到我的 XP SP3 机器上，有些文件名带有“？” 替换/表示无效字符。

我尝试对`os.rename`文件使用 Python，因为我知道它支持 unicode，但是，当我告诉 python 重命名文件时，它似乎无法将有效的文件名传递回 Windows API。

IE：

```
>>> os.chdir(r'F:\recovery\My Music')
>>> os.listdir(u'.')
[u'Don?t Be Them.mp3', u'That?s A Soldier.mp3']
>>> blah=os.listdir(u'.')
>>> blah[0]
Don?t Be Them.mp3
>>> os.rename(blah[0],'dont be them.mp3')

Traceback (most recent call last):
  File "<pyshell#6>", line 1, in <module>
    os.rename(blah[0],'dont be them.mp3')
WindowsError: [Error 123] The filename, directory name, or
  volume label syntax is incorrect 
```

我在 Win XP SP3 上使用 Python 2.6，任何编码都是美国/英语的标准 XP 行为。

有没有办法在不知道原始语言的情况下处理这些重命名？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-11T15:21:55.167

**“？”** 不是文件名的有效字符。这就是您的方法失败的原因。您可以尝试使用 DOS 短文件名：

```
import win32api
filelist = win32api.FindFiles(r'F:/recovery/My Music/*.*')

# this will extract "short names" from WIN32_FIND_DATA structure
filelist = [i[9] if i[9] else i[8] for i in filelist]

# EXAMPLE:    
# this should rename all files in 'filelist' to 1.mp3, 2.mp3, 3.mp3, ...
for (number, filename) in enumerate(filelist):
    os.rename(filaname, '%d.mp3' % (number)) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T12:04:20.793

尝试传递一个 unicode 字符串：

```
os.rename(blah[0], u'dont be them.mp3') 
```

# c# - sql查询中的最大参数数

> ID：845931
> 
> 赞同：35
> 
> 时间：2009-05-10T19:24:29.447
> 
> 标签：c#, linq-to-sql

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-05-10T19:40:26.130

限制[是硬编码的](http://msdn.microsoft.com/en-us/library/ms143432.aspx)：

*   每个存储过程的参数 2,100
*   每个用户定义函数的参数 2,100

我之前写了一些代码，将`Contains`查询分成多个批次并组合结果……[更多信息请参见此处](https://stackoverflow.com/questions/567963/linq-expression-to-return-property-value/568771#568771)。

# sql - SQL中的持久临时表？

> ID：845936
> 
> 赞同：5
> 
> 时间：2009-05-10T19:26:18.540
> 
> 标签：sql, sql-server, tempdb

是否有可能在 MS-SQL 中有一个“持久”临时表？我的意思是我目前有一个后台任务，它生成一个全局临时表，它被各种其他任务使用（这就是我将它设为全局的原因）。不幸的是，如果表变得未使用，它会被 SQL 自动删除——这由我的系统优雅地处理，因为它只是将它排队等待再次重建，但理想情况下我希望它每天只构建一次。所以，理想情况下，我可以设置一些超时参数，比如“如果 1 小时内没有任何东西触及这个，那么删除”。

我真的不希望它在我现有的数据库中，因为它会导致与管理数据库（碎片、日志增长等）相关的更多问题，因为它有效地汇总数据，仅在 24 小时内有用，并且占用更多超过 1 GB 的 HD 空间。

最坏的情况是，我的计划是在与 tempdb 相同的驱动器上创建另一个数据库，将其称为 PseudoTempDB 之类的东西，然后自己处理删除。

任何见解将不胜感激！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-11T13:48:49.700

如果您将表创建为 tempdb.dbo.TempTable，它不会被删除，直到：

a - SQL Server 已重新启动

b - 您明确删除它

如果您希望它始终可用，您可以在模型中创建该表，以便在重新启动期间将其复制到 tempdb（但它也将在您之后创建的任何新数据库上创建，因此您必须删除手动）或使用启动存储过程来创建它。但是，没有办法通过重新启动来保留数据。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-05-10T19:47:20.923

我会采用您的计划 B，“在与 tempdb 相同的驱动器上创建另一个数据库，将其称为 PseudoTempDB，然后自己处理删除。”

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-10T20:25:01.267

如何创建一个永久表？说，MyTable。每 24 小时刷新一次数据，如下所示：

1.  创建一个新表 MyTableNew 并填充它
2.  在事务中，删除 MyTable，并使用 rename_object 将 MyTableNew 重命名为 MyTable

这样，您每天都在重新创建表格。

如果您担心日志文件，请将表存储在不同的数据库中并将其设置为恢复模式：简单。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-10T19:31:19.560

我不得不承认对这个问题做了双重考虑：“持久”和“临时”通常不会一起出现！开箱即用的想法怎么样？也许您的后台任务可以定期运行一个简单的查询，以防止 SQL 将表标记为未使用。这样，您就可以直接控制创建和拆除。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2020-07-25T01:03:36.170

在处理现有所有主要 RDBMS 的 20 年经验之后，我只能建议您考虑以下几点：

1.  注意矛盾的概念：“持久”和“临时”是完全相反的。选择一个，并且只选择一个。

2.  您不会对数据库有任何好处，因为手动、半永久性、用户驱动的基础将数据写入临时数据库。用于该目的的普通表空间（即用户）已经存在。临时数据库用于临时的东西。

3.  如果您已经知道这样的表将被永久使用（“每日”是永久的），那么将其创建为用户数据库/模式上的普通表。

4.  每次您删除并重新创建同一个表时，您都会对整个数据库进行分段。并且永远不会给 DB 引擎优化器机会来帮助您进行任何形式的粗略优化。相反，请尝试截断它。您的回滚段将感谢您的小幅缓解，并且当您第二天再次重新填充它时，可能仍会分配磁盘空间。您可以通过单独为该表指定单独的表空间和数据文件来强制执行所需的行为。

5.  最后，也是更重要的一点：不要再为了区区 1 GB 的数据而折磨你和你的数据库引擎了。为了节省 0.02 美分的硬件真实状态，您正在浪费 CPU、I/O 周期、增加延迟、碎片等。谈论穿着燕尾服掉到地板上捡起棕色美分。

# subsonic - 从现有数据库生成 SubSonic 迁移代码？

> ID：845943
> 
> 赞同：2
> 
> 时间：2009-05-10T19:29:01.547
> 
> 标签：subsonic, automation, legacy, migration

在[Rob Conery](http://blog.wekeroad.com/2007/10/03/subsonic-migrate-me/)于 2007 年 10 月撰写的关于 SubSonic Migrations 的帖子中，他在“Left To Do”列表中提到：

> 我希望能够将现有数据库“逆向工程”到迁移文件中

我正在考虑为具有**很多**表的现有数据库引入版本控制，SubSonic 看起来像是适合我的工具，但我不期待手动编写第一个迁移！有谁知道 Rob 或任何人是否有时间编写一个自动执行此操作的工具？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T22:01:27.897

您可以为现有模式的当前状态生成一个脚本，并将您的第一次迁移设置为运行该脚本。

# javascript - JavaScript 中的字符串插值

> ID：845952
> 
> 赞同：13
> 
> 时间：2009-05-10T19:31:13.133
> 
> 标签：javascript, jquery

在 Ruby 中，您可以像这样使用字符串插值：

```
text = "This is visit number #{numVisits} to this website" 
```

这绕过了显式连接的需要。

我正在使用 jQuery，并且有点像这样：

```
$(document).ready(function(){
    $("a.ajax").click(function(event){
        $("#content").load("data.html this.getClass");
    });
}); 
```

我想要的行为是“单击`<a class="ajax" id="schedule"></a>`并且`content` `div`当前页面上的 被替换为`schedule` `div`from `data.html`。如果我手动写入

```
load("data.html #test"); 
```

这可行，但我希望脚本加载带有单击的锚点的 ID 值的 DIV。任何帮助都会膨胀！

示例页面： http: [//www.mariahandalex.info/stack/](http://www.mariahandalex.info/stack/)

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2015-02-05T15:40:30.153

这已经改变了。

截至 2015 年，现在有更好的方法： [https ://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/template_strings](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/template_strings)

将 Ruby 和 PHP 等许多语言已经享受的东西带到 JS 中。

例如，在我的 jQuery 驱动页面中，我使用：

```
 $('#myModalLabel').html(`Show GRAPH of : ${fundCode}-${funcCode}`); 
```

在我更新的 Firefox 和 Chrome 中安全地呈现为：

> 显示图表：AIP001-_sma

**注意 .html( ....** )中字符串参数周围的反引号的使用

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-10T19:42:37.513

您不能将 javascript 代码嵌入到字符串中，但您可以使用 '+' 将字符串连接到对象，如下所示

```
$('#content').load('data.html #' + $(this).getClass()); 
```

关于在字符串中嵌入代码，我认为它没有名称。Groovy 将这些字符串称为“ [Gstring](http://groovy.codehaus.org/Strings+and+GString) ”，而 ruby​​ 将这些字符串称为“[字符串中的表达式替换](http://docs.huihoo.com/ruby/ruby-man-1.4/syntax.html#string)”。我不确定它是否有标准名称。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-10T19:41:03.040

Javascript 不会像 Ruby 或 PHP 那样解析字符串文字来寻找替换标记。您将不得不使用连接。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2016-01-26T05:04:51.777

在 es6 中这是可能的

[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/template_strings](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/template_strings)

```
`string text ${expression} string text` 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-05-10T19:34:29.760

试试这个：

```
$(document).ready(function(){
    $("a.ajax").each(function(){
        var obj = $(this);
        obj.click(function(event){
           alert(obj.attr('id'));
        });
    });
}); 
```

# c++ - C++中关于&运算符的问题

> ID：845957
> 
> 赞同：1
> 
> 时间：2009-05-10T19:34:20.867
> 
> 标签：c++, pointers, wrapper

我正在查看 Wrapper 类的 .h 文件。该类包含一个私有成员：

```
T* dataPtr; 
```

（在`T`.h`template < class T >`文件顶部定义的位置）

该类提供了两种“*重载运算符”方法：

```
T& operator*()
{
   return *dataPtr;
}

const T& operator*() const
{
  return *dataPtr;
} 
```

两者都简单地 return `*dataPtr`，但是`*dataPtr`用简单的英语，符号 "" 实际上返回了什么？它如何与返回类型“ `T&`”匹配？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-10T19:39:12.077

返回类型 T& 表明您正在返回 T 对象实例的引用。dataPtr 是一个指针，您可以使用 *.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T19:40:45.757

dataPtr 是指向某物的指针。

* 运算符取消对指针的引用，因此 *dataPtr 是（或者，您可以说“引用”或“引用”）指针对象，即 dataPtr 指向的东西。

T& 表示“对类型为 T 的对象的引用”（不要与 T* 混淆，后者表示“指向类型为 T 的对象的指针”）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T19:41:29.000

`*DataPtr`是 指向的实际数据`DataPtr`。两个运算符都返回对 的引用`T`。*引用*是一种类型，您应该将其视为它所引用的值的另一个名称。“在引擎盖下”，它类似于指针，但不要这样想。它不能进行指针数学运算，也不能“重新安装”。其中一个运算符 is`const`和用于`const`对象，另一个用于普通对象。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-10T19:41:34.117

包装类似乎就像一个 C++ 指针。

运算符 * 取消引用包装器，该包装器将评估它存储的东西（在 dataPtr 中）。你得到的是对这个内容的引用。例如，您可以将某些内容分配给参考

`*intWrapper = 42;`

有两个运算符，因为有一个常量和一个非常量版本。当你取消引用一个常量包装类时，你不能分配给它（一个常量引用（T&）被返回）

# ruby - 整数方法之间的Ruby区别

> ID：845959
> 
> 赞同：0
> 
> 时间：2009-05-10T19:35:00.070
> 
> 标签：ruby, methods, integer

和有什么区别

```
10.6.to_i 
```

和

```
10.6.to_int 
```

?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-10T19:51:29.590

[这在这里](http://www.rubyfleebie.com/to_i-vs-to_int/)得到了很好的解释：

首先， to_i 或 to_int 都不是为了做一些比另一个更花哨的事情。通常，这两种方法在实现上没有太大区别，它们只是在向外界宣布的内容上有所不同。to_int 方法一般与条件表达式一起使用，应该这样理解：“这个对象在任何时候都可以被认为是一个实整数吗？”</p>

to_i 方法一般用来做实际的转换，应该这样理解：“请给我这个对象最准确的整数表示”</p>

例如，String 是一个实现了 to_i 但没有实现 to_int 的类。这是有道理的，因为字符串本身不能被视为整数。但是，在某些情况下，它可以具有整数形式的表示。如果我们写 x = “123”，我们可以很好地执行 x.to_i 并继续使用生成的 Fixnum 实例。但这只是因为 x 中的字符可以转换为数值。如果我们写：x =“外面的马很有趣”怎么办？没错，一个字符串不能一直被认为是一个整数。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-05-10T19:37:13.513

没有区别。它们是同义词。

# python - OOP：良好的类设计

> ID：845966
> 
> 赞同：15
> 
> 时间：2009-05-10T19:38:22.623
> 
> 标签：python, language-agnostic, oop

我的问题与这个有关：[为类的方法构建依赖关系图的 Python 工具](https://stackoverflow.com/questions/798389/python-tool-that-builds-a-dependency-diagram-for-methods-of-a-class)。

在没有找到任何工具后，我自己编写了一个快速 hack：我使用了编译器模块，我已经将源代码解析为一个抽象源代码树，并且我已经遍历它来收集类方法之间的依赖关系。我的脚本为 graphviz 生成了一个输入文件，该文件用于生成一个看起来像[这样](http://img512.imageshack.us/my.php?image=46854652.png)的依赖关系图。

在这一点上，我被卡住了。我意识到我不知道如何重构该类以使其不那么复杂。我根本不知道我应该瞄准什么。例如，在关系数据库的理论中，有一些简单的规则可用于将数据库变为正常形式。关于良好的类设计（就其方法之间的依赖关系而言）的一些类似理论呢？这个主题是否在某个地方被覆盖，所以我可以研究它？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-05-10T19:47:10.237

我们在设计类时遵循以下原则：

*   [单一职责原则](http://www.google.co.za/url?sa=t&source=web&ct=res&cd=2&url=http%3A%2F%2Fwww.objectmentor.com%2Fresources%2Farticles%2Fsrp.pdf&ei=1C4HSu3uEODJtgfs8uWeBw&usg=AFQjCNHQQ1Aw-2yCciEbERpJn3VdHBCmQw&sig2=Pf7Z4GNwRnAiaar_yCk_dg)：一个类（或方法）应该只有一个改变的理由。
*   [开闭原则](http://www.google.co.za/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fwww.objectmentor.com%2Fresources%2Farticles%2Focp.pdf&ei=9i4HStWBH5XhtgfSltWNBw&usg=AFQjCNGzBuNcaA1IXUx0tijZoTW7rlzcRQ&sig2=K-zyAaPRTp0CG28mtuO9jg)：一个类（或方法）应该对扩展开放，对修改关闭。
*   [Liskov 替换原则](http://www.google.co.za/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fwww.objectmentor.com%2Fresources%2Farticles%2Flsp.pdf&ei=By8HSoDJJd6ptger2uSdBw&usg=AFQjCNFnNI0DmzofjWDQEGILAT-W1L8Mtw&sig2=ozd86zYF9ZMqLfBS2tQJdg)：子类型必须可以替换它们的基本类型。
*   [接口隔离原则](http://www.google.co.za/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fwww.objectmentor.com%2Fresources%2Farticles%2Fisp.pdf&ei=Gy8HSpH-CqK_twfv6OCXBw&usg=AFQjCNHuKx3fPObvzYaQDZ2etcZHYtg57g&sig2=aWFqTuyl_iCAsGk8SnwljQ)：不应强迫客户依赖他们不使用的方法。接口应该属于客户端。
*   [依赖倒置原则](http://www.google.co.za/url?sa=t&source=web&ct=res&cd=1&url=http%3A%2F%2Fwww.objectmentor.com%2Fresources%2Farticles%2Fdip.pdf&ei=Mi8HSsbyLdKJtgemroCfBw&usg=AFQjCNEpBGziZw6APHj0rMG9pp1LJt9FHA&sig2=y4EFfBIw-cC6hocfVEeTJg)：抽象不应该依赖于细节。细节应该取决于抽象。

编辑：设计模式有助于让您的代码符合这些原则。我发现先理解原则然后查看模式并了解模式如何使您的代码符合原则非常有帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-10T19:48:30.563

在课堂设计方面，通常不可能说出“正确”或“错误”。关于这个主题有很多指导方针、模式、推荐等，但归根结底，恕我直言，这与过去项目的经验有关。我的经验是，最好不要太担心，逐步改进你的代码/结构。进行实验，看看一些想法/变化的感觉/外观。当然，向他人学习总是一个好主意。阅读大量代码并分析它，尝试理解:)。

如果您想了解该理论，我可以推荐 Craig Larmanns 的“应用 UML 和模式：面向对象分析与设计和迭代开发简介”[亚马逊](https://rads.stackoverflow.com/amzn/click/com/0131489062)。他涵盖了您问题的几个部分，给出了一些粗略的指导方针，并使用示例应用程序展示了它们。我喜欢这本书。

你能把你的应用上传到某个地方吗？也许在 github 左右，也许你可以寻求一些具体的建议。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-10T19:49:04.930

[设计模式](http://en.wikipedia.org/wiki/Design_pattern_(computer_science))已成为良好类设计的事实标准。通常，每种模式都有其适用的特定用例或场景。如果您可以在代码中识别这一点，则可以使用该模式来创建更有意义的东西，并且通常具有较少的依赖关系。

重构是你用来完成这些彻底改变的工具。一个好的 IDE 将帮助您进行重构。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-10T19:52:05.410

尝试使每个方法都易于单元测试。我发现这总是使我的设计朝着更具可读性/可理解性的方向发展。有许多 OOAD 规则[——SRP、DRY 等。](https://stackoverflow.com/questions/399656/are-there-any-rules-for-oop) 在重构时尽量记住这些规则。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-11T15:34:06.253

我推荐 Martin Fowler 的《重构》一书，其中包含大量将糟糕的设计迭代转换为优秀设计的实际示例。

# asp.net - Gridview 中的 ASP.Net Grid View 滚动总计

> ID：845967
> 
> 赞同：1
> 
> 时间：2009-05-10T19:38:26.553
> 
> 标签：asp.net, vb.net, gridview

我已经看过几个关于如何实现这一目标的教程。

然而，在我看来，他们需要大量关于如何以编程方式引用每个项目的先验知识。

有没有人有一个链接或可以创建一个相对基本的示例来说明如何在 ASP:Gridview 的页脚中实现运行总计？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T20:02:09.213

这就是我使用的：

```
protected void InvoiceGridView_RowDataBound(object sender, GridViewRowEventArgs e)
{
    var invoice = (Invoice) e.Row.DataItem;
    if (e.Row.RowType == DataControlRowType.Header)
    {
        totalAmt = 0;
    }
    else if (e.Row.RowType == DataControlRowType.DataRow)
    {
        totalAmt += invoice.Amount;
    }
    else if (e.Row.RowType == DataControlRowType.Footer)
    {
        var amountTotalLabel = (TextBox) e.Row.FindControl("AmountTotalTextBox");
        amountTotalLabel.Text = totalAmt.ToString("0.00");
    }
} 
```

TotalAmt 是页面上受保护的实例变量。根据您对“程序化知识”的评论，不确定这是否是您要查找的内容。但它有效并且相当简单。`List<Invoice>`在这种情况下，gridview 绑定到 a 。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-04-28T13:17:10.777

我认为我使用的方法非常基本，不需要以编程方式引用 Gridview 中的列，如果这就是你的意思的话。这是一个很好的部分，一旦您编写了后端函数，您可以通过仅编辑 .aspx 文件将总计添加到任何 Gridview。

在您的 GridView 中，使列如下所示：

```
<asp:TemplateField HeaderText="Hours">
    <ItemTemplate><%#DisplayAndAddToTotal(Eval("Hours").ToString(), "Hours")%></ItemTemplate>
    <FooterTemplate><%#GetTotal("Hours")%></FooterTemplate>
</asp:TemplateField> 
```

DisplayAndAddToTotal 的第二个参数可以是您想要的任何字符串，只要您在 GetTotal 中使用相同的字符串即可。我通常只是再次使用字段名称。这是使用的两个函数，DisplayAndAddToTotal 和 GetTotal。他们使用 Hashtable 来存储总数，以便它与您想要添加的任意数量的列一起使用。他们还可以计算布尔字段的“真”数。

```
Protected total As Hashtable = New Hashtable()

Protected Function DisplayAndAddToTotal(itemStr As String, type As String) As Double
    Dim item As Double

    If itemStr = "True" Then
        item = 1

    ElseIf Not Double.TryParse(itemStr, item) Then
        item = 0
    End If

    If total.ContainsKey(type) Then
        total(type) = Double.Parse(total(type).ToString()) + item
    Else
        total(type) = item
    End If

    Return item
End Function

Protected Function GetTotal(type As String) As Double
    Try
        Dim result As Double = Double.Parse(total(type).ToString())
        Return result
    Catch
        Return 0
    End Try
End Function 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-11T04:51:16.073

添加页脚模板并在 RowDataBound 上，有一个全局变量来存储总和，

在 e.Row.RowType = DataControlRowType.DataRow 类型处进行求和，并 @ e.Row.RowType = DataControlRowType.Footer 将值存储在适当的单元格中

欲了解更多信息，请查看@ [MSDN LINK](http://msdn.microsoft.com/en-us/library/ms972833.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-02T22:13:26.190

我就是这样做的。很容易。您只需对包含您的数字的行求和并将其放在页脚中。

```
((Label)GridView.FooterRow.Cells[1].FindControl("your_label")).Text = ds.Tables[0].Compute("sum(Column_name)", "").ToString(); 
```

# python - 如何在 PyObjC 选择器中表示 void 指针？

> ID：845970
> 
> 赞同：3
> 
> 时间：2009-05-10T19:39:38.317
> 
> 标签：python, objective-c, macos, pyobjc, void-pointers

我想为我正在设计的应用程序使用 NSOpenPanel。这是我到目前为止所拥有的：

```
@objc.IBAction
def ShowOpenPanel_(self, sender):
    self.panel = NSOpenPanel.openPanel()
    self.panel.setCanChooseFiles_(False)
    self.panel.setCanChooseDirectories_(True)
    NSLog(u'Starting OpenPanel')
    self.panel.beginForDirectory_file_types_modelessDelegate_didEndSelector_contextInfo_(
        self.defaults.objectForKey_(u'projpath'), 
        objc.nil, 
        objc.nil, 
        self, 
        objc.selector(self.OpenPanelDidEnd_returnCode_contextInfo_, 
            signature='v:@ii'),
        objc.nil)
    NSLog(u'OpenPanel was started.')

def OpenPanelDidEnd_returnCode_contextInfo_(self, panel, returnCode, context):
    NSLog('Panel ended.')
    if (returnCode == NSOKButton):
        NSLog(u'User selected OK')
        path = self.panel.filenames()[0]
        self.defaults.setObject_forKey_(path, u'projpath')
    del self.panel 
```

我关心的主要两行是：

```
 objc.selector(self.OpenPanelDidEnd_returnCode_contextInfo_, 
            signature='v:@ii'),
        objc.nil) #this is the argument that gets passed as the void pointer 
```

第三个参数应该是一个空指针。由于我不打算使用该数据，因此我宁愿将其留空。我尝试过制作签名`'v:@iv'`并尝试使用`objc.NULL`和 python's`None`以及所有这些东西的几乎所有组合。处理这个问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-16T16:50:17.223

我认为您根本不需要使用`objc.selector`；试试这个：

```
@objc.IBAction
def ShowOpenPanel_(self, sender):
    self.panel = NSOpenPanel.openPanel()
    self.panel.setCanChooseFiles_(False)
    self.panel.setCanChooseDirectories_(True)
    NSLog(u'Starting OpenPanel')
    self.panel.beginForDirectory_file_types_modelessDelegate_didEndSelector_contextInfo_(
        self.defaults.objectForKey_(u'projpath'), 
        objc.nil, 
        objc.nil, 
        self, 
        self.OpenPanelDidEnd_returnCode_contextInfo_,
        objc.nil)
    NSLog(u'OpenPanel was started.') 
```

我还发现我需要用以下方式装饰面板结束功能`PyObjCTools.AppHelper.endSheetMethod`：

```
@PyObjCTools.AppHelper.endSheetMethod
def OpenPanelDidEnd_returnCode_contextInfo_(self, panel, returnCode, context):
    NSLog('Panel ended.')
    if (returnCode == NSOKButton):
        NSLog(u'User selected OK')
        path = self.panel.filenames()[0]
        self.defaults.setObject_forKey_(path, u'projpath')
    del self.panel 
```

以下是我将如何写你所拥有的：

```
@objc.IBAction
def showOpenPanel_(self, sender):
    panel = NSOpenPanel.openPanel()
    panel.setCanChooseFiles_(False)
    panel.setCanChooseDirectories_(True)
    NSLog(u'Starting openPanel')
    panel.beginForDirectory_file_types_modelessDelegate_didEndSelector_contextInfo_(
        self.defaults.objectForKey_(u'projpath'),    #forDirectory
        None,    #file
        None,    #types
        self,    #modelessDelegate
        self.openPanelDidEnd_returnCode_contextInfo_,    #didEndSelector
        None)    #contextInfo
    NSLog(u'openPanel started')

@PyObjCTools.AppHelper.endSheetMethod
def openPanelDidEnd_returnCode_contextInfo_(self, panel, returnCode, context):
    NSLog(u'Panel ended')
    if returnCode != NSOKButton:
        return
    NSLog(u'User selected OK')
    path = panel.filenames()[0]
    self.defaults.setObject_forKey_(path, u'projpath') 
```

变化说明：我一直使用`None`而不是`objc.nil`，它还没有搞砸我；我认为您的面板不需要是 的属性，`self`因为您在返回函数中获得了它；objc 约定是将函数的第一个字母小写。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-24T08:16:35.017

打开面板的正确方法是：

```
@objc.IBAction
def showOpenPanel_(self, sender):
    panel = NSOpenPanel.openPanel()
    panel.setCanChooseFiles_(False)
    panel.setCanChooseDirectories_(True)
    NSLog(u'Starting openPanel')
    panel.beginForDirectory_file_types_modelessDelegate_didEndSelector_contextInfo_(
        self.defaults.objectForKey_(u'projpath'),    #forDirectory
        None,    #file
        None,    #types
        self,    #modelessDelegate
        'openPanelDidEnd:returnCode:contextInfo:',    #didEndSelector
        None)    #contextInfo
    NSLog(u'openPanel started') 
```

Dan 的代码也可以，但恕我直言，我的变体更清晰：您不传递实际方法，而是传递应该调用的方法的名称。

# exception - “要解密的数据长度无效。” Rijndael解密期间的异常

> ID：845971
> 
> 赞同：5
> 
> 时间：2009-05-10T19:40:12.387
> 
> 标签：exception, rijndaelmanaged

我得到“要解密的数据长度无效。” 当我尝试解密内存流时出现异常。我是初学者，无法弄清楚什么是错的。怎么了？

```
public bool EncryptStream()
    {

        string password = @"myKey123"; // Your Key Here
        UnicodeEncoding UE = new UnicodeEncoding();
        byte[] key = UE.GetBytes(password);

        s_EncryptedStream = new MemoryStream();
        int NoOfBytes;
        byte[] b_Buffer = new byte[8192];

        s_MemoryStream.Seek(0, SeekOrigin.Begin);

        RijndaelManaged RMCrypto = new RijndaelManaged();

        s_CrytpoStream = new CryptoStream(s_EncryptedStream,
            RMCrypto.CreateEncryptor(key, key),
            CryptoStreamMode.Write);

        while (s_MemoryStream.Length < s_MemoryStream.Position)
        {
            NoOfBytes = s_MemoryStream.Read(b_Buffer, 0, 8192);
            s_CrytpoStream.Write(b_Buffer, 0, NoOfBytes);
        }

        s_MemoryStream.Seek(0, SeekOrigin.Begin);

        while (s_EncryptedStream.Position < s_EncryptedStream.Length)
        {
            NoOfBytes = s_EncryptedStream.Read(b_Buffer, 0, 8192);
            s_MemoryStream.Write(b_Buffer, 0, NoOfBytes);

        }
        s_CrytpoStream.Flush();
        s_CrytpoStream.Close();

        return true;

    }

    public bool DecryptStream()
    {

        string password = @"myKey123"; // Your Key Here

        UnicodeEncoding UE = new UnicodeEncoding();
        byte[] key = UE.GetBytes(password);

        int NoOfBytes;
        byte[] b_Buffer = new byte[8192];

        s_DecryptedStream = new MemoryStream();

        RijndaelManaged RMCrypto = new RijndaelManaged();

        s_CrytpoStream = new CryptoStream(s_MemoryStream,
            RMCrypto.CreateDecryptor(key, key),
            CryptoStreamMode.Read);

        s_MemoryStream.Seek(0, SeekOrigin.Begin);

        while (s_MemoryStream.Length > s_MemoryStream.Position)
        {
            NoOfBytes = s_CrytpoStream.Read(b_Buffer, 0, 8192);
            s_DecryptedStream.Write(b_Buffer, 0, NoOfBytes);
        }

        s_DecryptedStream.Seek(0, SeekOrigin.Begin);
        s_MemoryStream.Seek(0, SeekOrigin.Begin);

        while (s_DecryptedStream.Position < s_DecryptedStream.Length)
        {
            NoOfBytes = s_DecryptedStream.Read(b_Buffer, 0, 8192);
            s_MemoryStream.Write(b_Buffer, 0, NoOfBytes);

        }

        s_CrytpoStream.Flush();
        s_CrytpoStream.Close();

        return true;

    } 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-10T19:57:25.230

首先，这个 while 循环条件永远不会正确：

```
while (s_MemoryStream.Length < s_MemoryStream.Position) 
```

位置怎么可能超出长度？

复制流的常用模式不是使用流的长度，而是重复读取，直到返回的值不是正数。无论如何，当您在此代码中执行此操作两次时，您不妨封装它：

```
public static void CopyStream(Stream input, Stream output)
{
    byte[] buffer = new byte[8192];
    int read;
    while ( (read = input.Read(buffer, 0, buffer.Length)) > 0)
    {
        output.Write(buffer, 0, read);
    }
} 
```

最好使用`using`语句来清理字符串。此外，该`Encoding.Unicode`属性意味着您不必`UnicodeEncoding`自己创建一个新的。另外，我通常发现设置`Position`属性比使用`Seek`. 最后，如果方法总是返回值，那么返回值是没有意义的`true`。因此，您的代码将变为：

```
public void EncryptStream()
{
    string password = @"myKey123"; // Your Key Here
    byte[] key = Encoding.Unicode.GetBytes(password);

    s_EncryptedStream = new MemoryStream();
    s_MemoryStream.Position = 0;

    RijndaelManaged RMCrypto = new RijndaelManaged();

    using (Stream crytpoStream = new CryptoStream(s_EncryptedStream,
        RMCrypto.CreateEncryptor(key, key),
        CryptoStreamMode.Write))
    {
        CopyStream(s_MemoryStream, cryptoStream);
    }

    s_MemoryStream.Position = 0;
    s_EncryptedStream.Position = 0;
    CopyStream(s_EncryptedStream, s_MemoryStream);
}

public void DecryptStream()
{
    string password = @"myKey123"; // Your Key Here
    byte[] key = Encoding.Unicode.GetBytes(password);

    s_DecryptedStream = new MemoryStream();
    s_MemoryStream.Position = 0;

    RijndaelManaged RMCrypto = new RijndaelManaged();

    using (Stream crytpoStream = new CryptoStream(s_MemoryStream,
        RMCrypto.CreateDecryptor(key, key),
        CryptoStreamMode.Read))
    {
        CopyStream(cryptoStream, s_DecryptedStream);
    }

    s_DecryptedStream.Position = 0;
    s_MemoryStream.Position = 0;

    CopyStream(s_DecryptedStream, s_MemoryStream);
} 
```

即使修改了这段代码，感觉这里的非局部变量太多了。我不明白为什么*这些*都应该在实例变量中。使要加密或解密的流成为一个参数（连同密码），并返回一个包含加密/解密数据的内存流，或者只是一个字节数组。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-10T20:30:45.893

您可能需要在读取完输入数据后调用该`FlushFinalBlock`方法。`CryptoStream`（即`crytpoStream.FlushFinalBlock()`在 CopyStream 之后）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T14:37:06.243

我想出了一个解决方案，并已将其发布在我的新博客上

constotech.blogspot.com/2009/05/net-encryption-using-symmetricalgorithm.html

# wcf - WCF/basicHttp 和 NTLM 身份验证

> ID：845973
> 
> 赞同：0
> 
> 时间：2009-05-10T19:40:38.313
> 
> 标签：wcf, performance, authentication, ntlm, basichttpbinding

有谁知道 NTLM 身份验证在 WCF/basicHttp 中究竟是如何工作的？我想知道是否为每个服务方法调用传递了用户凭据，或者是否某种安全令牌用于后续服务方法调用。

我正在使用的确切绑定配置：

```
<bindings>
  <basicHttpBinding>
    <binding name="winAuthBasicHttpBinding">
      <security mode="TransportCredentialOnly">
        <transport clientCredentialType="Ntlm" />
      </security>
    </binding>
  </basicHttpBinding>
</bindings> 
```

我在 MSDN 参考资料中找到了这种类型的配置。但我不确定这是否是一个好主意。另一种方法是提供一种自定义的 GetAuthenticationToken() 方法来为客户端的所有后续请求提供安全令牌。这可以通过企业库 - 安全应用程序块来完成。

更多详细信息：浏览器/Silverlight 客户端正在使用该服务。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-10T20:15:49.957

在这种情况下，每个方法调用都将被验证。

您正在谈论的是所谓的“安全会话”，其中客户端对服务器进行一次身份验证，然后使用公共令牌进行后续交换。然而，该安全会话功能仅适用于 wsHttpBinding - 不适用于 basicHttpBinding。

马克

# javascript - Javascript函数包装失败？

> ID：845993
> 
> 赞同：1
> 
> 时间：2009-05-10T19:53:38.060
> 
> 标签：javascript, jquery

我正在寻找向 jQuery 方法添加功能。

我有代码

```
$('li.s').appendTo('#target'); 
```

有多个匹配的元素`li.s`，我可以看到它是使用 Firebug 正确抓取的。

`append`没有我的包装器，该方法可以正常工作。但是，使用我的包装器（它不应该改变函数的任何内容）：

```
var oldAppend = $.fn.append;

$.fn.append = function(expr) {
    return oldAppend.call(this, expr);
}; 
```

返回正确的 jQuery 对象，但仅将第一个`li.s`对象附加到`#target`，而不是所有对象。为什么是这样？我在哪里失去了调用 to 的其他元素`oldAppend`？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-10T20:19:28.063

我没有深入研究 jQuery 代码来检查这一点，但大多数函数通常应该返回 this.each(fn)：

```
$.fn.append = function(expr) {
    return this.each(function() {
        oldAppend.call($(this), expr);
    });
}; 
```

你会注意到我不得不`this`在内部函数中包装一个 jQuery 对象，因为 append 方法期望它是上下文。我不确定，但您可能会发现您还需要包装外部引用`this`：

```
return $(this).each 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-11T00:09:44.770

问题是您（我）注意到传递*了所有*发送给`append`by的参数`appendTo`。`apply`像这样使用`arguments`：

```
var oldAppend = $.fn.append;

$.fn.append = function() {
    return oldAppend.apply(this, arguments);
}; 
```

（请记住，所有函数都有`arguments`，因此您需要`var args = arguments`在适当的范围内访问这些参数，例如在使用时`$.each`。）***********