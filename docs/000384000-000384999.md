# StackOverflow 问答 000384000-000384999

# c# - 使用 LINQ 如何按“计算字段”进行分组

> ID：384004
> 
> 赞同：6
> 
> 时间：2008-12-21T02:05:39.817
> 
> 标签：c#, .net, linq, .net-3.5, linq-to-entities

我正在使用 LINQ to EF 并具有以下 LINQ 查询：

```
var results = (from x in ctx.Items
               group x by x.Year into decades
               orderby decades.Count() descending
               select new { Decade = decades.Key, DecadeCount = decades.Count() }); 
```

所以这种方式让我到达了我想去的地方，因为我得到了按年份分解的项目和那一年的项目数量。（即 2001 - 10、1975 - 15、2005 - 5、1976 - 1）我真正想做的事情是按十年（即 2000s - 15、1970s - 16）分解它们。

如何在 Linq 语句的 group 子句的“by”部分中有一个“计算字段”。我想我想要的基本上是这样的：

```
var results = (from x in ctx.Items
               group x by (x => x.Year.Value.ToString().Substring(0, 3) + "0s") into decades
               orderby decades.Count() descending
               select new { Decade = decades.Key, DecadeCount = decades.Count() }); 
```

或者更一般的语法，这样我就可以做一些更复杂的评估/计算来做分组。有任何想法吗？

编辑（更新）：

(x => x.Year.Value.ToString().Substring(0, 3) + "0s") - 不起作用 - “LINQ to Entities 无法识别 'System.String ToString()' 方法，而且这个方法不能翻译成商店表达式。”

(x.Year / 10 * 10) - 功能有效（谢谢） - 唯一的“问题”是“s”不在末尾（即 1970 与 1970 年代）

无论如何要在 by 子句中放置一个函数吗？即按 this.ManipulateYear(x.Year) 将 x 分组为几十年...或... x => x.Year.Value.ToString().Substring(0,3) + "0s" ?? 最好有一些技术（例如调用函数或使用 lambda 表达式），这样我就可以涵盖我能想到的任何情况。

再次感谢大家对此的帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-21T23:55:35.070

您可以使用该`let`子句来避免多次计算几十年：

```
from x in ctx.Items
group x by (x.Year / 10 * 10) into decades
let decadeCount = decades.Count()
orderby decadeCount descending
select new { Decade = decades.Key, DecadeCount = decadeCount } 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-21T02:15:41.373

按 x.Year/10 分组怎么样？（没有测试过这个！）

```
var results = (from x in ctx.Items
               group x by (x.Year / 10 * 10) into decades
               orderby decades.Count() descending
               select new { Decade = decades.Key, DecadeCount = decades.Count() }); 
```

EDIT1：将 (x.Year / 10) 更改为 (x.Year / 10 * 10) 以获取例如 1980 而不是 198。

EDIT2：在您的示例中，“将 x 按 x.Year.Value.ToString().Substring(0, 3) + "0s") 分组为几十年”也应该有效。不需要 Lamba 语法。

EDIT3：删除了一个额外的 * 10。谢谢马克！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-11T23:45:16.123

看起来我们无法对实体框架的部分类中定义的计算字段进行分组或选择或类似操作。

计算的字段可用于 LINQ to 对象（因此您可以将所有数据作为对象返回，然后进行分组）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T02:09:51.417

我相信您会将 SelectMany 方法链接到结果的末尾。这将返回 IEnumerable 的 IEnumerable。

# version-control - 有人可以向我解释源（版本控制）控制吗？

> ID：384016
> 
> 赞同：14
> 
> 时间：2008-12-21T02:21:50.033
> 
> 标签：version-control

因为我还在上高中，所以我从未与团队一起参与过专业项目。因此，我从未接触过整个“版本控制”和“源代码控制”的事情。他们是一样的吗？管理代码的程序究竟是如何管理代码的？我听说您必须检查代码（复制现有代码？）并将其重新合并（如果有人更改了您没有更改的代码，而您更改了其他内容并将其合并，会发生什么？当然，他的代码是没有被您的旧版本取代。）最后，这种软件最好/最简单的例子是什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-21T03:03:37.050

> 我听说您必须检查代码（复制现有代码？）并将其重新合并（如果有人更改了您没有更改的代码，而您更改了其他内容并将其合并，会发生什么？当然，他的代码是不会被您的旧版本取代。）

这正是版本控制的原因。如果它所做的只是盲目地覆盖人们的代码，它就不是一个非常有用的工具，不是吗？;)

源代码控制工具维护一个包含整个代码库历史的存储库。每个更改都作为增量签入，*仅保存已更改的内容*。这意味着如果您和我都签出版本 A，然后我编辑文件 B，您编辑文件 C，然后我们都签入，源代码管理软件将比较差异以及不存在冲突的位置（如本例)，只需应用两个更改，如果发生冲突（如果我们都更改了相同的代码行），它会拒绝尝试签入并告诉您文件的哪个版本有冲突更改，并要求您手动合并它们. （通常它还能够突出显示更改，以便您可以直观地看到每个版本中的更改）。所以它永远不会覆盖更改。

它会为您完成的其他任务是：

*   标记特定版本或里程碑，以便您以后可以轻松找到它们（这是我们最终修复恼人错误 #2524 的版本，这是 beta 1，等等
*   将存储库分成两部分，允许可能暂时“不同步”的更改，甚至永远保持独立的产品（想想 PHP 同时维护他们的 PHP4 分支，同时也在开发 PHP5。在某些时候，他们只是简单地分支了他们的代码库，所以当它们一开始是一样的，现在可以将补丁应用到其中一个而不影响另一个）。当然，它也可以尝试将这些分支重新合并在一起（也许你可以为产品中的每个主要功能创建一个分支，这样它们就可以独立开发，而不会受到其余代码逐渐变化的影响，然后当功能完成后，将其分支合并回主存储库）

有两种基本类型的源代码控制工具，集中式的和分布式的。分布式是*大新事物*，而集中式已经存在了几十年。简而言之，集中式版本控制只是意味着有一个主存储库服务器，所有分支和每个分支的更改历史都存储在其中。该服务器负责合并签到和所有这些。因此，每当开发人员签出代码或将其提交到存储库时，这就是他与之同步的服务器。分布式的只是抛弃了这个“主服务器”方面。相反，每次签出代码时，您都会在自己的机器上本地创建一个新的存储库，位于您签出代码的路径。然后，您可以针对此本地存储库工作，它执行所有相同的操作，跟踪更改历史记录，合并更改等等，一旦您准备好，您可以将您的存储库合并到任何其他存储库中。通常，你' 我可能想将它合并到某种“主”存储库中，所有代码都被粘合在一起，但你也可以将它合并到你的合作开发者的本地存储库中，如果他可能需要你一直在研究的那个功能，但它不是但足够稳定，可以进入主仓库。因此，它为您提供了更大的灵活性，并允许您维护本地工作的更改历史记录，而不会冒破坏主存储库的构建的风险（在集中设置中，如果您签入无法编译的内容会发生什么？整个团队都被搞砸了，直到它被修复。如果你 s 还不够稳定，无法进入主仓库。因此，它为您提供了更大的灵活性，并允许您维护本地工作的更改历史记录，而不会冒破坏主存储库的构建的风险（在集中设置中，如果您签入无法编译的内容会发生什么？整个团队都被搞砸了，直到它被修复。如果你 s 还不够稳定，无法进入主仓库。因此，它为您提供了更大的灵活性，并允许您维护本地工作的更改历史记录，而不会冒破坏主存储库的构建的风险（在集中设置中，如果您签入无法编译的内容会发生什么？整个团队都被搞砸了，直到它被修复。如果你*不要*签入，你会失去版本控制的好处，如果你发现你一直在引入新的错误，就会阻止你恢复到以前的版本）

> 最后，这类软件最好/最简单的例子是什么？

嗯，最流行的就是轻松SVN，一个老式的中心化系统，但是设置imo有点痛苦。需要服务器上的特殊软件。我个人非常喜欢[Bazaar](http://bazaar-vcs.org/)，它是分布式的，服务器存储库只需要 FTP 访问，服务器上不需要其他任何东西。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-21T02:33:41.290

Eric Sink 写了一个很好的[Source Control HOWTO](http://www.ericsink.com/scm/source_control.html)。

免责声明：Eric Sink 是 SourceGear 的负责人，该公司开发和销售多种源代码控制相关工具（包括 SourceGear Vault）。然而，[Source Control HOWTO](http://www.ericsink.com/scm/source_control.html)是一个相当中立、平衡的文章。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-21T02:34:28.747

版本控制系统不仅适用于大型团队！从事业余爱好项目的个人开发人员可以从代码版本中获益良多。

大多数版本控制系统都以存储库的概念为中心，*存储库*由系统管理，从不直接触及。当您想要编辑文件时，您可以从存储库中复制它，进行更改，然后将其发回。版本控制系统识别您的新版本和旧版本之间的差异，然后将您的新版本存储在存储库中。但是，万一你搞砸了，旧版本，一直回到开头，总是可以检索的。

大多数版本控制系统足够智能，可以将多个开发人员对同一文件的更改合并，只要这些更改不会影响文件的同一部分。然而，合并冲突可能会发生并引起头痛。

首先，我建议您安装一些简单且免费的软件，例如[Subversion](http://subversion.tigris.org/)，并阅读他们非常详细的[书](http://svnbook.red-bean.com/)，其中包含各种功能的示例和解释，其中大部分功能在其他版本控制系统中的效果相当。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-21T06:04:22.690

所有版本控制系统都基本相同。没有一个比另一个更难使用。和其他`svn commit somefile`一样难`git commit somefile`。它们只是工作方式略有不同。

我开始使用 git 的唯一原因是[github](http://github.com)。在此之前，我在 darcs 上使用 SVN（它有一个非常好的命令行界面）的唯一原因是因为我找到了一个好的、免费的 SVN 服务器。

目前我会推荐git。不是因为它更好，也不是因为其他一些 VCS 更差，而是因为有很多非常好的指南，以及很多非常好的项目使用/基于它。

您可能会发现一些有用的资源：

*   [GitHub](http://github.com/) - 是什么说服我开始使用 git。它有一个非常活跃的社区，并且非常有帮助（例如，当您创建一个新存储库时，它会为您提供将代码推送到其中的命令）。他们也有一个很好的[指南](http://github.com/guides/home)部分。
*   关于使用 GitHub的免费[截屏视频](http://www.pragprog.com/screencasts/v-scgithub/insider-guide-to-github)- 解释了许多网站功能和大部分有用的基础知识
*   [Gitorious](http://gitorious.com/) - 另一个很好的 git 托管站点，用于开源项目（该站点本身也是开源的）。不如我说的 GitHub 好用，但是一个很好的选择。
*   [repo.or.cz](http://repo.or.cz/) - 第一个 git 托管站点。与 GitHub/Gitorious 相比，它看起来很古老，但它可以工作，并且可以托管
*   [PeepCode 的 Git 插曲](http://peepcode.com/products/git)- 9 美元，但受到高度评价。几乎涵盖了您需要知道的所有内容。
*   [GitCasts](http://www.gitcasts.com/) - 一系列优秀的截屏视频。从第一个（“设置、初始化和克隆”）开始，它应该涵盖最有用的东西。
*   [GitMagic](http://www-cs-students.stanford.edu/~blynn/gitmagic/) - 非常有用，尤其是对于稍微高级一点的东西（它回答了我的很多“我如何......”问题，比如如何创建一个空分支）。综合指南（从基本的东西到 git 的内部）
*   [初学者的 Git：权威的实用指南](https://stackoverflow.com/questions/315911/git-for-beginners-the-definitive-practical-guide)- 关于 stackoverflow 的问题 - 还不完全全面，但它已经到了那里..

话虽如此，您选择的版本控制系统无关紧要，真的..

我发现[darcs](http://darcs.net)非常易于使用（既是 CLI，又是了解如何`darcs get`在存储库之间移动“补丁”。[“GettingStarted”darcs.net wiki 页面](http://wiki.darcs.net/DarcsWiki/GettingStarted)是我开始所需的全部内容。我唯一遇到的问题是我不能'找不到任何 darcs 项目的主机...

SVN 易于使用，但它的集中式架构并不真正适合我的使用方式，而且分支（这在 git 中微不足道）之类的事情很困难。几乎每个动作都需要与中央服务器通信，我不想运行本地 SVN 服务器。它也基本上不能离线工作，例如在笔记本电脑上。

我开始学习 SVN，主要得益于[“Subversion 截屏介绍”](http://blog.clickablebliss.com/2006/04/26/introduction-to-subversion-screencast/)。然后，当我发现 github 时，我曾经`git svn`将我的主 SVN 存储库导入 git

简而言之：为一些版本控制系统找到一个好的教程或指南，并对你拥有的所有随机项目和片段进行版本控制。直到你不小心做了一些愚蠢的改变并保存/关闭你的脚本，或者不小心删除了一些东西，这似乎有点毫无意义。我几乎将 VCS 用作“超级撤销”（以及用于计算机之间的代码同步）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-21T02:31:33.743

版本控制和源代码控制是相同的。嗯，大部分。版本控制是源代码控制所做的。它允许您拥有一个文件的多个版本。把它想象成维基百科的修订历史。您可以返回查看已完成的操作、比较更改并回滚到以前的代码。

该程序通常使用一些专有引擎来密切关注这些文件（因为它们只是文本，通常并不难），并且每次重新签入文件时都会跟踪所做的更改。

如果您尝试将已更改的文件合​​并回来，大多数源代码控制系统会向您显示文件的差异，您可以选择手动或自动合并它（取决于您的源代码控制系统的强大程度）。

最简单的例子是将[Subversion 下载到您的 USB 驱动器上](http://dotnet.org.za/trumpi/archive/2006/12/13/Subversion-on-a-stick.aspx)，然后安装[Tortoise SVN](http://tortoisesvn.tigris.org/)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-21T02:29:43.763

以下是您的问题的一些答案：

源代码控制是每个人共享代码的地方。当您想要进行更改时，您“签出”代码并对其进行修改。当您将其签出时，其他人无法对其进行更改（从而阻止您修改旧版本的文件）。完成后，将文件签回源代码管理，创建一个新版本（这是源代码管理的版本控制部分）。在任何时候，您都可以将代码库的本地副本与所有文件的最新版本重新同步，让您保持最新状态。

一些执行此操作的软件使用更改系统。这意味着该文件只有一个副本，每当它被签入时，它都会保存为对该文件的一系列更改。其他系统存储文件的多个副本，并将版本信息附加到文件。

如果您要更改文件的旧版本，然后发现您使用的是旧版本（源代码控制程序应该在您尝试签入代码时通知您），那么您必须将您的更改与较新的版本。一些源代码控制工具带有内置的合并工具。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T04:28:30.327

回答您发布的第二个问题：

SVN 需要一个集中的存储库，而 Git 是分散的，但我认识的大多数使用它的人都依赖 github。Git 也用于 linux 内核源代码的主干，因此它针对非常大的代码库进行了更多优化。此外，Git 似乎对分支合并有更好的处理，然后是 pre-svn 1.5.x 代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-21T05:54:57.453

版本控制不需要是复杂的设置，也不需要只适合在团队环境中工作，它不仅适用于编码项目。任何东西都可以进入版本控制。这只是不想失去*任何东西*的问题。我几乎对我编辑的每个文件进行版本控制，包括我家中的所有内容/以及 etc/ 和其他地方的许多配置文件，并且我对我为工作所做的一切进行版本控制（除了为项目提供的版本控制）。这是我所做的一部分，我认为它应该由文件系统提供。

我建议从简单的开始并使用 RCS 进行练习。尽管 RCS 对团队来说很糟糕，但它对于管理只有一个作者的本地用户文件就很好了。暂时不要担心合并和分支。学会将保存文件视为保存版本。一旦您对 RCS 感到满意并接受了保留更改的好处，您就可以继续学习 SVN 或 Git 或任何其他更健壮且更适合团队环境的*真实系统。*

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-02T08:37:50.487

还可以看看[Streamed Lines 论文](http://www.cmcrossroads.com/bradapp/acme/branching/)，它描述了许多最佳实践和版本控制反模式，我还要参考Michael Burr 提到的[Erik Sinks 文章](http://www.ericsink.com/scm/source_control.html)

# c++ - c++ 与性能指标持续集成

> ID：384036
> 
> 赞同：3
> 
> 时间：2008-12-21T02:57:42.800
> 
> 标签：c++, unit-testing, continuous-integration, automated-tests, cruisecontrol

我想为我的开源 C++ 项目建立一个持续集成和测试框架。所需的功能是：

```
1\. check out the source code
2\. run all the unit and other tests
3\. run performance tests (these measure the software quality - for example how long does it take the system to complete the test)
4\. produce a report based on 3\. and 4\. daily
5\. archive the reports for future reference 
```

为了实现这一点，你会推荐哪个测试框架和什么持续集成过程？现在我倾向于使用 Google 测试框架（我知道[其他问题中](https://stackoverflow.com/questions/13699/choosing-a-c-unit-testing-toolframework)讨论的单元测试框架的一些比较）用于测试和[Cruisecontrol](http://cruisecontrol.sourceforge.net/)用于持续集成。但我不知道 Cruisecontrol 是否允许轻松集成性能指标。

*编辑*：回答 Wilhelmtell，代码应该适用于 Windows 和 Linux。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-06-14T08:50:08.857

我写了一篇文章，可能对你有所帮助。它描述了使用 googletest 和 hudson 对 C++ 代码的持续集成，使用 gcov 作为代码覆盖率指标。 [http://meekrosoft.wordpress.com/2010/06/02/continuous-code-coverage-with-gcc-googletest-and-hudson/](http://meekrosoft.wordpress.com/2010/06/02/continuous-code-coverage-with-gcc-googletest-and-hudson/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T03:38:06.323

你的问题是双重的。正如您自己指出的那样，单元测试库的选择是一个问题。是的，我认为 GoogleTest 很好。我喜欢它，因为它在使用方面感觉很轻。UnitTest++ 更是如此。你选择哪一个并不重要。

我对 CruiseControl 没有任何经验，但看看您的一组要求，我可能会编写一个脚本来完成这项工作。每个要求都可以通过至少一个工具轻松完成，因此只需将工具粘合在一起即可。

除非您的报告需要 HTML、XML、LaTeX 或其他花哨的格式，否则我会使用 Bash。然后你可以只`time`命令，`sed`从 unittest 二进制输出输出等等。不过，如果您真的喜欢 Bash 并且习惯了它，那么无论如何您可能会选择 Bash 来处理更复杂的格式。例如，您可以使用占位符为报告编写 HTML 模板，然后将占位符替换为数据。

如果您的任务更复杂，例如因为您希望脚本也可以在其他平台上运行，那么我可能会使用 Ruby 或 Python。例如，在 Ruby 中，您可以使用[Markaby](http://code.whytheluckystiff.net/markaby/)来输出 HTML。无论哪种方式，Bash、Ruby 或 Python 都非常适合文本处理或一般任务。我认为您可以模拟一个可以立即完成工作的小脚本。

很好的是，如果您使用脚本，那么您还可以将其作为挂钩附加到几乎任何现代版本控制系统。例如，您可能会设置一个 Subversion 或 Git 挂钩，以便脚本将在任何提交时运行。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T13:51:20.143

我今天正在使用 CruiseControl 和 UnitTest++ 来完成这项任务。

UnitTest++ 非常好，虽然我觉得有时会受到它的限制。至少比cppunit好10倍。还没试过google测试框架，下一个项目用吧。

CruiseControl 让我非常失望。邮件列表中有一些错误和问题从未得到回答。许多用于管理程序执行和日志记录的默认“功能”并不令人满意。我们必须编写自己的报告生成、我们自己的标准输出和标准错误捕获、我们自己的状态邮件。除了定期运行测试并将它们收集在中央 Web 服务器中之外，CruiseControl 剩下的东西不多了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-21T14:15:37.613

我们使用了[NAnt](http://nant.sourceforge.net/)、[Cruise Control.NET](http://ccnet.thoughtworks.com)、[bjam](http://www.boost.org/doc/tools/build/doc/html/index.html)和[CppUnit](http://apps.sourceforge.net/mediawiki/cppunit/index.php?title=Main_Page)的组合，它们都运行良好。

然而，直到最近我们才从 Windows 转移到 Windows*和*Linux。目前只有 bjam 和 CppUnit 在两个平台上使用。

我们的 NAnt 脚本移植不会有问题；NAnt 在[mono](http://www.mono-project.com/Main_Page)下运行良好。CC.NET 可能不那么 - 我们还没有走这条路，但没有很多文档可以让它在 mono/Apache 下运行......

我们正在考虑用[Hudson](http://hudson-ci.org/)替换 CC.NET ；这是一个非常有前途的系统。 [巡航控制](http://cruisecontrol.sourceforge.net/)也很不错。

我们还考虑过从 CppUnit 迁移到另一个测试框架，但现在它做得很好。 [GoogleTest](http://code.google.com/p/googletest/)（尤其是新的模拟库）、[UnitTest++](http://unittest-cpp.sourceforge.net/)和[Boost Test](http://www.boost.org/doc/libs/1_37_0/libs/test/doc/html/index.html)都在研究中。

所以我知道这可能不是一个决定性的答案，但希望那里有一些对你有用的东西！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-21T04:08:15.857

我更喜欢带有 cppUnit 的 CruiseControl.Net，但我对 google 测试框架没有任何经验或知识。但是，对于简单且免费的持续集成，您无法击败 CruiseControl.NET，尤其是在它支持的所有测试框架、构建系统和其他广告方面。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-21T22:31:16.007

您可能还想在 CruiseControl[用户邮件列表](http://cruisecontrol.sourceforge.net/contact.html)上问这个问题，看看其他人是否也在做同样的事情。

> 但我不知道 Cruisecontrol 是否允许轻松集成性能指标。

您可以通过两种方式使用 CruiseControl 处理性能指标：

1.  如果您有 xml 数据，您可以将其合并到日志文件中，然后使用一些 .xsl 将其集成到电子邮件和网页中，或者
2.  如果您有一个 html 报告，您可以使用 artifact publisher 使其可以从使用[artifact publisher](http://cruisecontrol.sourceforge.net/main/configxml.html#artifactspublisher)的 Web 界面获取。

我对这个主题有点偏见，因为我从事 CruiseControl 项目，但还有其他几个 CI 工具也可以工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-05T08:37:35.603

我们使用 UnitTest++ 和 Hudson。

我发现 Hudson 非常易于使用且可配置性极强，具有大量插件。

# localization - 用于语言和文化感知软件的术语

> ID：384038
> 
> 赞同：8
> 
> 时间：2008-12-21T02:58:56.200
> 
> 标签：localization, internationalization, terminology, globalization

我一直认为术语“国际化”和“本地化”（以及它们有趣的缩写 i18n 和 l10n）被普遍接受并用于谈论了解语言和文化差异的软件。但我最近阅读了一个关于这些主题的问题，其中提到了所谓的“全球化”，并且也被标记为这样。

因为在我想知道是否真的被其他人使用以及它与我认为已经建立和众所周知的术语相比之前我没有听说过这个术语，所以我去了标签页面并检查了不同的术语：

*   全球化（z|s）化：37 个问题
*   国际i(z|s)ation|i18n：122 个问题
*   locali(z|s)ation|l10n：97 个问题

所以这似乎是一个不常见的术语。我发现它也令人困惑，因为它以某种方式混合了 i18n 和 l10n 这两个术语（至少对我而言，“[全球化](http://en.wikipedia.org/wiki/Globalisation)”让我想到了像[attac](http://en.wikipedia.org/wiki/Association_pour_la_taxation_des_transactions_pour_l%27aide_aux_citoyens)这样的组织:)。据我所知，该术语源自 .net/Microsoft 术语。

所以我的问题是：你使用/喜欢哪些术语，你与这些术语有什么联系？此外，为什么微软选择使用不同的术语，甚至对于不熟悉它的人来说具有完全不同的含义？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-21T03:29:53.750

（用于投票的社区维基）

国际化/本地化
i18n / l10n

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T05:59:59.877

对我来说，所有 3 个都有略微不同的含义：

全球化——正如《纽约时报》的托马斯·弗里德曼所说，这就是“世界的扁平化”。基本上，这个想法是世界变得越来越小，我们之间的联系比以往任何时候都更加紧密。

国际化——这只是指多个国家，这是相当广泛的。

本地化——这进一步深入到个性化，用户所在城市可能获得与另一个城市不同的站点，同时考虑到一个国家内可能存在的细微方言差异。

因此，根据我想强调的含义，每个都有其相关性，尽管值得注意的是一个人正在采取什么观点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T08:24:55.870

AFAIK，对 i18n 和 l10n 的技术解释是 i18n 是使用钩子为特定语言环境获取 l10n 的重构。（所以 i18n 是插入 gettext 并用那些 _() 宏填充代码的过程，而 l10n 是实际的翻译。）

[Wikipedia](http://en.wikipedia.org/wiki/I18n)有来自 DEC 的 i18n 和 l10n，过去是，而 global/g11n 是来自 microsoft+ibm 的新功能。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-31T14:52:42.430

这是微软如何使用这个术语的一个非常详细的解释：[国际博士](http://blogs.msdn.com/drintl/archive/2005/06/07/426289.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-21T03:31:32.453

（用于投票的社区维基）

全球化

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-31T14:48:23.110

i18n：将软件修改为与语言环境无关
l10n：添加对特定语言环境的支持
g11n：i18n + l10n

# c# - 我可以限制通用堆栈的深度吗？

> ID：384042
> 
> 赞同：7
> 
> 时间：2008-12-21T03:03:46.550
> 
> 标签：c#, generics, stack

是否有内置方法来限制 System.Collection.Generics.Stack 的深度？因此，如果您处于最大容量，推送一个新元素会移除堆栈的底部？

我知道我可以通过转换为数组并重建堆栈来做到这一点，但我认为可能已经有一个方法了。

编辑：我写了一个扩展方法：

```
 public static void Trim<T> (this Stack<T> stack, int trimCount) 
    {
        if (stack.Count <= trimCount)
            return;

       stack = new 
            Stack<T>
            (
                stack
                    .ToArray()
                    .Take(trimCount)
            );           
    } 
```

因此，它在修剪时返回一个新堆栈，但功能方式不是不变性=)

这样做的原因是我将应用程序的撤消步骤存储在堆栈中，并且我只想存储有限数量的步骤。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-12-21T04:37:15.270

您正在寻找的东西称为**dropout stack**。AFAIK，BCL 不包含一个，尽管它们实现起来很简单。通常，撤消和重做功能依赖于此类数据结构。

它们基本上是一个数组，当您压入堆栈时，堆栈的“顶部”会在数组周围移动。最终，当堆栈已满时，顶部将回到开头并替换堆栈的“底部”。

谷歌没有提供太多关于它的信息。这是我能找到的最好的：

**（警告 PDF）** [http://courses.cs.vt.edu/~cs2704/spring04/projects/DropOutStack.pdf](http://courses.cs.vt.edu/~cs2704/spring04/projects/DropOutStack.pdf)

这是一些样板代码，可以帮助您入门。我会让你填写其余的（完整性检查、计数、索引器等）

```
class DropOutStack<T>
{
    private T[] items;
    private int top = 0;
    public DropOutStack(int capacity)
    { 
        items = new T[capacity];
    }

    public void Push(T item)
    {
        items[top] = item;
        top = (top + 1) % items.Length;
    }
    public T Pop()
    {
        top = (items.Length + top - 1) % items.Length;
        return items[top];
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-21T04:41:48.083

您实际上正在查看类似于循环列表实现的内容。PIEBALDconsult 在 CodeProject上有一个[LimitedQueue](http://www.codeproject.com/KB/architecture/LimitedQueue.aspx)实现。这与您的要求相似。您只需要像作者所做的那样包装 Stack 而不是 Queue 。另外作者还实现了索引器，如果您需要访问除顶部堆栈以外的任何其他内容（可能显示撤消列表），这很方便。

编辑：作者的实现还会在最后一个（首先，取决于它是队列还是堆栈）被删除时引发一个事件，这样你就可以知道什么时候被扔掉了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T03:36:22.800

我相信您正在寻找一个（可能已修改的）[出队](http://www.exciton.cs.rice.edu/CppResources/STL/stl_containers.htm)- 允许从任一端访问的数据结构。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-21T03:12:59.870

我看不到方法。您可以从 继承`Stack<T>`，但似乎没有任何有用的东西可以覆盖。

简单（如果有点乏味）的方法是`Stack<T>`将`LimitedStack<T>`. 然后实现你想要的方法并传递给一个 internal ，同时在方法和其他任何你需要的地方`Stack<T>`包含你的限制逻辑。`Push`

编写所有这些传递成员是一件痛苦的事，特别是如果您要实现与`Stack<T>`...相同的所有接口，但另一方面，您只需执行一次然后就完成了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-11-20T01:35:45.730

By提供的解决方案`Greg Dean => dropout stack`非常好，但我认为主要问题是关于在堆栈溢出时移除堆栈底部但是提供的解决方案只是在堆栈被填满后替换堆栈的最后一项，所以你不会得到真实的历史，

但是要获得真实的历史记录，一旦列表达到您的特定容量，您需要移动列表，但这是一个扩展操作，

所以我认为最好的解决方案是链表

这是我解决问题的方法

```
 public class HistoryStack<T>
{
    private LinkedList<T> items = new LinkedList<T>();
    public List<T> Items => items.ToList();
    public int Capacity { get;}
    public HistoryStack(int capacity)
    {
        Capacity = capacity;
    }

    public void Push(T item)
    {
        // full
        if (items.Count == Capacity)
        {
            // we should remove first, because some times, if we exceeded the size of the internal array
            // the system will allocate new array.
            items.RemoveFirst();
            items.AddLast(item);
        }
        else
        {
            items.AddLast(new LinkedListNode<T>(item));
        }
    }

    public T Pop()
    {
        if (items.Count == 0)
        {
            return default;
        }
        var ls = items.Last;
        items.RemoveLast();
        return ls == null ? default : ls.Value;
    }
} 
```

测试一下

```
 var hs = new HistoryStack<int>(5);
hs.Push(1);
hs.Push(2);
hs.Push(3);
hs.Push(4);
hs.Push(5);
hs.Push(6);
hs.Push(7);
hs.Push(8);

var ls = hs.Items;
Console.WriteLine(String.Join(",", ls));

Console.WriteLine(hs.Pop());
Console.WriteLine(hs.Pop());

hs.Push(9);

Console.WriteLine(hs.Pop());
Console.WriteLine(hs.Pop());
Console.WriteLine(hs.Pop());
Console.WriteLine(hs.Pop());
Console.WriteLine(hs.Pop()); // empty
Console.WriteLine(hs.Pop()); // empty 
```

结果

```
4,5,6,7,8
8
7
9
6
5
4
0
0 
```

# c# - 手动添加参考

> ID：384050
> 
> 赞同：5
> 
> 时间：2008-12-21T03:17:24.273
> 
> 标签：c#, .net, visual-studio

无论如何，我可以使添加对 C# 项目的引用的过程不那么痛苦吗？

每次我创建一个新的 C# 类库项目。我必须使用 Add Reference 对话框至少 5 次。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-21T03:31:21.907

安装[适用于 Visual Studio 的 PowerCommands](http://code.msdn.microsoft.com/PowerCommands)。然后，您可以简单地在项目之间复制和粘贴一堆引用（以及许多其他有用的命令）。其他一些有用的命令是：

*   折叠项目（我最喜欢的）
*   复制参考和粘贴参考
*   删除和排序使用
*   打开包含文件夹
*   打开命令提示符

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T03:23:10.207

您可以一次选择多个引用以使用 CTRL-Click 添加。您还可以使用“最近”选项卡轻松查找最近添加到其他项目的引用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-24T17:10:09.130

如果您总是将某些引用添加到项目中，则创建一个新项目，添加引用，像往常一样设置项目，然后选择文件 > 导出模板。然后，当您下次要创建新项目时，新创建的模板将列在“我的模板”部分下。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-09T04:50:01.417

您可以安装[Resharper](http://www.jetbrains.com/resharper/)，如果您在代码中提到某些类，则最新版本提高了可用性，但没有对此类的库的引用。在这种情况下，Resharper 将为您提供添加库引用和导入特定命名空间的功能。您需要做的就是单击 CTRL+Enter，然后从下拉菜单中选择“引用库和导入命名空间”。您只需触摸键盘两次，其余的由 Resharper 完成！Resharper 真正让您完全专注于编写好的代码，而不会因琐事而分心。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-04-30T16:45:25.017

另一种方法是使用 Muse VSRefrences。此 VSExtension 支持复制和粘贴引用，还具有最快的“添加 GAC 引用”对话框

![替代文字](https://public.blu.livefilestore.com/y1pOBI4s8W2kMt_KyHgnaC3HplcD3cuf_zFojE5OXo98Bfnkt9wzRvu0Vo7QUkxiyg0Zf3nuztkEiNmq3eHBUjfAQ/Muse.VSReferences.ContextMenu.png)

试一试，如果您还有其他问题，请告诉我

s

# hide - div 标签打开和关闭

> ID：384053
> 
> 赞同：0
> 
> 时间：2008-12-21T03:22:32.657
> 
> 标签：hide, dreamweaver, show, html

对你们来说应该超级简单...div 1 被点击，div 2 出现。我不知道该怎么做是再次单击 div 1 时使 div 2 消失。

```
<img src="/..." width="" height"" onClick="MM_showHideLayers('logo','','show','logoEasterEgg','',show')"> 
```

当再次单击 div 1 中的图像时，我应该在这行代码中添加什么以使 div 'logoEasterEgg' 消失？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T03:37:38.760

你可以做一些类似于用 jQuery回答[这个问题的建议。](https://stackoverflow.com/questions/233936/jquery-swapping-elements)

基本上只有一个 div 类，您可以根据它是否已经存在来添加和删除它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-21T05:12:08.270

除了使用 MM_showHideLayers() 你可以做这样的事情......？

```
function toggleDiv(divId)
{
  var myDiv = document.getElementById(divId);
  if (myDiv) 
  {
    if (myDiv.style.display === 'none') 
    {
      myDiv.style.display = 'block';
    }
    else
    {
      myDiv.style.display = 'none';
    }
  }
}

<img src="/..." width="" height"" onClick="toggleDiv('logoEasterEgg')"> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T03:29:00.710

~~您将需要添加另一个函数调用以在第一次调用后隐藏另一个 div 以显示它。~~

onclick 属性看起来像这样：

MM_showHideLayers('logo','','show','logoEasterEgg','',show'); **隐藏函数（）；**

onclick 属性将允许尽可能多的 javascript，您可以在其中填充尽可能多的函数 - 只是不要忘记您的分号。

**编辑：**

在阅读了一些关于`MM_showHideLayers`我认为您需要更改函数以关闭需要关闭的 div 之后。换句话说，如果您想关闭，请`logo`创建 onclick 属性（注意**hide**）：

MM_showHideLayers('logo','','**隐藏**','logoEasterEgg','',show');

# git - 版本控制系统的 Web 界面

> ID：384073
> 
> 赞同：4
> 
> 时间：2008-12-21T03:52:00.413
> 
> 标签：git, svn, versioning, cvs

是否有一个具有出色 Web 界面的版本控制系统，以便基本上可以通过 Web 浏览器对其进行管理和使用？

该界面需要在提交新代码和查看/下载以前的提交方面发挥作用。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-21T04:41:44.853

[GitHub](http://en.wikipedia.org/wiki/GitHub)有点像前面提到的 Beanstalk，但它是针对 Git 的。我知道它为查看提交（以及分支、标签和合并等）提供了一个很棒的 UI，但我不知道你是否可以从 UI 提交。

从来没有人指责 Git 易于使用（例如，没有 TortoiseGit，尽管我听说它即将推出），所以使用 SVN/BeanStalk 可能会更好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-21T04:24:17.650

我使用由[http://www.beanstalkapp.com/](http://www.beanstalkapp.com/)托管的 Subversion 服务器。Beanstalk 具有用于导航项目源的丰富界面。但是，我不使用它来签入和签出代码，因为它与任何 Web 界面一样，一次提交/更新单个文件。对于大型项目来说，这将是非常笨拙的。

对于提交/更新，我使用 TortoiseSVN，因为它为您提供 (a) 与 BeanStalk 的无缝接口和 (b) 文件资源管理器集成。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-01T14:35:51.950

正如 Mike Miller 所说，我不会查看 Web 界面来作为您选择源代码控制系统的基础。

[ClearCase](https://en.wikipedia.org/wiki/Rational_ClearCase)有一个出色的 GUI，但它的成本很高。

大多数 SCM 系统现在都有由第三方编写的 Web 界面，您可以添加这些界面。用于 CVS 的[WinCVS](http://www.wincvs.org/) 、用于 SVN的[TortoiseSVN](http://tortoisesvn.tigris.org/)和[Trac以及用于 Git](http://trac.edgewall.org/)[的 git-gui](http://trac.edgewall.org/)。

专注于查看底层 SCM 具有哪些功能，并通过在顶部分层 GUI 来获取它。

[VSS](http://en.wikipedia.org/wiki/Microsoft_Visual_SourceSafe) ? 嗯。不确定那个。恕我直言

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-23T20:53:59.040

SVN 和其他有几个开源选项，但是我不会将 Web 界面的存在用作版本控制系统的关键决策点。它们中的大多数都有可用的 Web 界面，但关键功能对于系统本身来说更为核心。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-05-09T20:27:45.943

[MKS](https://en.wikipedia.org/wiki/PTC_Integrity)有一个浏览器界面，但它完全无法使用。它的 UI 很差，并且完全由 JavaScript 管理，因此无法为任何内容添加书签或发送指向任何内容的链接。

此外，它将整个树显示为单个文件列表，其中包含每个项目的完整路径。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T04:01:48.833

我相信[MKS](http://www.mks.com/)有一个浏览器界面。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T04:06:51.117

[SourceSafe](http://en.wikipedia.org/wiki/Microsoft_Visual_SourceSafe)的最新版本有一个 Web 界面。我没有使用它，所以我不能评论它的效果如何。

参考：

*   *[如何：通过 Visual SourceSafe (Internet) 插件设置数据库访问](http://msdn.microsoft.com/en-us/library/ms230206(VS.80).aspx)*
*   *[视觉源安全 2005](http://weblogs.asp.net/israelio/archive/2005/03/17/395048.aspx)*

# python - 如何为 Python 日志记录输出着色？

> ID：384076
> 
> 赞同：431
> 
> 时间：2008-12-21T03:57:45.940
> 
> 标签：python, logging, colors

前段时间，我看到一个带有彩色输出的 Mono 应用程序，大概是因为它的日志系统（因为所有的消息都是标准化的）。

现在，Python 有了这个`logging`模块，它可以让你指定很多选项来自定义输出。所以，我想用 Python 可以实现类似的东西，但我无法在任何地方找到如何做到这一点。

有什么方法可以使 Python`logging`模块以彩色输出？

我想要的（例如）红色的错误，蓝色或黄色的调试消息，等等。

当然，这可能需要兼容的终端（大多数现代终端都是）；`logging`但如果不支持颜色，我可以回退到原始输出。

任何想法如何使用日志记录模块获得彩色输出？

* * *

## 回答 #1

> 赞同：213
> 
> 时间：2008-12-21T05:17:39.337

我已经知道颜色转义了，我不久前在我的 bash 提示符中使用了它们。不管怎么说，还是要谢谢你。
我想要的是将它与日志记录模块集成，经过几次尝试和错误，我最终做到了。
这是我最终的结果：

```
BLACK, RED, GREEN, YELLOW, BLUE, MAGENTA, CYAN, WHITE = range(8)

#The background is set with 40 plus the number of the color, and the foreground with 30

#These are the sequences need to get colored ouput
RESET_SEQ = "\033[0m"
COLOR_SEQ = "\033[1;%dm"
BOLD_SEQ = "\033[1m"

def formatter_message(message, use_color = True):
    if use_color:
        message = message.replace("$RESET", RESET_SEQ).replace("$BOLD", BOLD_SEQ)
    else:
        message = message.replace("$RESET", "").replace("$BOLD", "")
    return message

COLORS = {
    'WARNING': YELLOW,
    'INFO': WHITE,
    'DEBUG': BLUE,
    'CRITICAL': YELLOW,
    'ERROR': RED
}

class ColoredFormatter(logging.Formatter):
    def __init__(self, msg, use_color = True):
        logging.Formatter.__init__(self, msg)
        self.use_color = use_color

    def format(self, record):
        levelname = record.levelname
        if self.use_color and levelname in COLORS:
            levelname_color = COLOR_SEQ % (30 + COLORS[levelname]) + levelname + RESET_SEQ
            record.levelname = levelname_color
        return logging.Formatter.format(self, record) 
```

要使用它，请创建您自己的 Logger：

```
# Custom logger class with multiple destinations
class ColoredLogger(logging.Logger):
    FORMAT = "[$BOLD%(name)-20s$RESET][%(levelname)-18s]  %(message)s ($BOLD%(filename)s$RESET:%(lineno)d)"
    COLOR_FORMAT = formatter_message(FORMAT, True)
    def __init__(self, name):
        logging.Logger.__init__(self, name, logging.DEBUG)                

        color_formatter = ColoredFormatter(self.COLOR_FORMAT)

        console = logging.StreamHandler()
        console.setFormatter(color_formatter)

        self.addHandler(console)
        return

logging.setLoggerClass(ColoredLogger) 
```

以防万一其他人需要它。

如果您使用多个记录器或处理程序，请小心：`ColoredFormatter`正在更改记录对象，该对象将进一步传递给其他处理程序或传播到其他记录器。如果您配置了文件记录器等，您可能不希望在日志文件中有颜色。为了避免这种情况，最好在操作 levelname 属性之前简单地创建一个`record`with的副本`copy.copy()`，或者在返回格式化字符串之前将 levelname 重置为以前的值（在评论中感谢[Michael](https://stackoverflow.com/users/715042/michael)）。

* * *

## 回答 #2

> 赞同：185
> 
> 时间：2013-05-31T00:16:27.920

几年前，我写了一个彩色流处理程序供我自己使用。然后我遇到了这个页面，发现了人们正在复制/粘贴的代码片段集合:-(。我的流处理程序目前仅适用于 UNIX（Linux、Mac OS X），但优点是它[可以在 PyPI](https://pypi.python.org/pypi/coloredlogs)（和[GitHub](https://github.com/xolox/python-coloredlogs) ) 而且它使用起来非常简单。它还具有 Vim 语法模式:-)。将来我可能会将它扩展到在 Windows 上工作。

**要安装软件包：**

```
$ pip install coloredlogs 
```

**要确认它是否有效：**

```
$ coloredlogs --demo 
```

**要开始使用您自己的代码：**

```
$ python
> import coloredlogs, logging
> coloredlogs.install()
> logging.info("It works!")
2014-07-30 21:21:26 peter-macbook root[7471] INFO It works! 
```

上面示例中显示的默认日志格式包含日期、时间、主机名、记录器的名称、PID、日志级别和日志消息。这是它在实践中的样子：

![colouredlogs 输出的屏幕截图](https://i.stack.imgur.com/AgqpA.png)

**注意：使用带有 MinTTY 的 Git Bash 时**

Windows 上的 Git Bash 有一些记录在案的怪癖： [Winpty 和 Git Bash](https://stackoverflow.com/questions/48199794/winpty-and-git-bash)

对于 ANSI 转义码和 ncurses 样式的字符重写和动画，您需要在命令前加上`winpty`.

```
$ winpty coloredlogs --demo
$ winpty python your_colored_logs_script.py 
```

* * *

## 回答 #3

> 赞同：170
> 
> 时间：2019-07-09T01:24:58.043

# 2022 解决方案，无需额外的软件包，Python 3

**定义一个类**

```
import logging

class CustomFormatter(logging.Formatter):

    grey = "\x1b[38;20m"
    yellow = "\x1b[33;20m"
    red = "\x1b[31;20m"
    bold_red = "\x1b[31;1m"
    reset = "\x1b[0m"
    format = "%(asctime)s - %(name)s - %(levelname)s - %(message)s (%(filename)s:%(lineno)d)"

    FORMATS = {
        logging.DEBUG: grey + format + reset,
        logging.INFO: grey + format + reset,
        logging.WARNING: yellow + format + reset,
        logging.ERROR: red + format + reset,
        logging.CRITICAL: bold_red + format + reset
    }

    def format(self, record):
        log_fmt = self.FORMATS.get(record.levelno)
        formatter = logging.Formatter(log_fmt)
        return formatter.format(record) 
```

**实例化记录器**

```
# create logger with 'spam_application'
logger = logging.getLogger("My_app")
logger.setLevel(logging.DEBUG)

# create console handler with a higher log level
ch = logging.StreamHandler()
ch.setLevel(logging.DEBUG)

ch.setFormatter(CustomFormatter())

logger.addHandler(ch) 
```

**并使用！**

```
logger.debug("debug message")
logger.info("info message")
logger.warning("warning message")
logger.error("error message")
logger.critical("critical message") 
```

**结果** [![在此处输入图像描述](https://i.stack.imgur.com/klCcc.png)](https://i.stack.imgur.com/klCcc.png)

**完整的配色方案** [![在此处输入图像描述](https://i.stack.imgur.com/iZU5S.png)](https://i.stack.imgur.com/iZU5S.png)

**对于窗户**

此解决方案适用于 Mac OS、IDE 终端。默认情况下，Windows 命令提示符似乎根本没有颜色。以下是有关如何启用它们的说明，我没有尝试过[https://www.howtogeek.com/322432/how-to-customize-your-command-prompts-color-scheme-with-microsofts-colortool/](https://www.howtogeek.com/322432/how-to-customize-your-command-prompts-color-scheme-with-microsofts-colortool/)

* * *

## 回答 #4

> 赞同：98
> 
> 时间：2014-05-30T23:39:51.057

**更新**：因为这是我长久以来一直想从头开始的痒，所以我继续为像我这样只想用简单方法做事的懒人写了一个库：[zenlog](https://github.com/ManufacturaInd/zenlog)

Colorlog 非常适合这一点。它[在 PyPI 上可用](https://pypi.python.org/pypi/colorlog "PyPI 上的颜色日志")（因此可以通过 安装`pip install colorlog`）并得到[积极维护](https://github.com/borntyping/python-colorlog "颜色日志 GitHub 页面")。

这是一个快速复制和粘贴的片段，用于设置日志记录和打印看起来不错的日志消息：

```
import logging
LOG_LEVEL = logging.DEBUG
LOGFORMAT = "  %(log_color)s%(levelname)-8s%(reset)s | %(log_color)s%(message)s%(reset)s"
from colorlog import ColoredFormatter
logging.root.setLevel(LOG_LEVEL)
formatter = ColoredFormatter(LOGFORMAT)
stream = logging.StreamHandler()
stream.setLevel(LOG_LEVEL)
stream.setFormatter(formatter)
log = logging.getLogger('pythonConfig')
log.setLevel(LOG_LEVEL)
log.addHandler(stream)

log.debug("A quirky message only developers care about")
log.info("Curious users might want to know this")
log.warn("Something is wrong and any user should be informed")
log.error("Serious stuff, this is red for a reason")
log.critical("OH NO everything is on fire") 
```

输出：

![颜色日志输出](https://github.com/ManufacturaInd/python-zenlog/raw/master/colorlogs.png)

* * *

## 回答 #5

> 赞同：79
> 
> 时间：2011-11-03T13:31:53.953

预定义日志级别的快速而肮脏的解决方案，无需定义新类。

```
logging.addLevelName( logging.WARNING, "\033[1;31m%s\033[1;0m" % logging.getLevelName(logging.WARNING))
logging.addLevelName( logging.ERROR, "\033[1;41m%s\033[1;0m" % logging.getLevelName(logging.ERROR)) 
```

* * *

## 回答 #6

> 赞同：79
> 
> 时间：2009-08-26T18:29:35.387

这是一个适用于任何平台的解决方案。如果它不只是告诉我，我会更新它。

工作原理：在支持 ANSI 转义的平台上使用它们（非 Windows），在 Windows 上它确实使用 API 调用来更改控制台颜色。

该脚本确实破解了标准库中的 logging.StreamHandler.emit 方法，为其添加了一个包装器。

**测试着色器.py**

```
# Usage: add Colorer.py near you script and import it.
import logging
import Colorer

logging.warn("a warning")
logging.error("some error")
logging.info("some info") 
```

**着色器.py**

```
#!/usr/bin/env python
# encoding: utf-8
import logging
# now we patch Python code to add color support to logging.StreamHandler
def add_coloring_to_emit_windows(fn):
        # add methods we need to the class
    def _out_handle(self):
        import ctypes
        return ctypes.windll.kernel32.GetStdHandle(self.STD_OUTPUT_HANDLE)
    out_handle = property(_out_handle)

    def _set_color(self, code):
        import ctypes
        # Constants from the Windows API
        self.STD_OUTPUT_HANDLE = -11
        hdl = ctypes.windll.kernel32.GetStdHandle(self.STD_OUTPUT_HANDLE)
        ctypes.windll.kernel32.SetConsoleTextAttribute(hdl, code)

    setattr(logging.StreamHandler, '_set_color', _set_color)

    def new(*args):
        FOREGROUND_BLUE      = 0x0001 # text color contains blue.
        FOREGROUND_GREEN     = 0x0002 # text color contains green.
        FOREGROUND_RED       = 0x0004 # text color contains red.
        FOREGROUND_INTENSITY = 0x0008 # text color is intensified.
        FOREGROUND_WHITE     = FOREGROUND_BLUE|FOREGROUND_GREEN |FOREGROUND_RED
       # winbase.h
        STD_INPUT_HANDLE = -10
        STD_OUTPUT_HANDLE = -11
        STD_ERROR_HANDLE = -12

        # wincon.h
        FOREGROUND_BLACK     = 0x0000
        FOREGROUND_BLUE      = 0x0001
        FOREGROUND_GREEN     = 0x0002
        FOREGROUND_CYAN      = 0x0003
        FOREGROUND_RED       = 0x0004
        FOREGROUND_MAGENTA   = 0x0005
        FOREGROUND_YELLOW    = 0x0006
        FOREGROUND_GREY      = 0x0007
        FOREGROUND_INTENSITY = 0x0008 # foreground color is intensified.

        BACKGROUND_BLACK     = 0x0000
        BACKGROUND_BLUE      = 0x0010
        BACKGROUND_GREEN     = 0x0020
        BACKGROUND_CYAN      = 0x0030
        BACKGROUND_RED       = 0x0040
        BACKGROUND_MAGENTA   = 0x0050
        BACKGROUND_YELLOW    = 0x0060
        BACKGROUND_GREY      = 0x0070
        BACKGROUND_INTENSITY = 0x0080 # background color is intensified.     

        levelno = args[1].levelno
        if(levelno>=50):
            color = BACKGROUND_YELLOW | FOREGROUND_RED | FOREGROUND_INTENSITY | BACKGROUND_INTENSITY 
        elif(levelno>=40):
            color = FOREGROUND_RED | FOREGROUND_INTENSITY
        elif(levelno>=30):
            color = FOREGROUND_YELLOW | FOREGROUND_INTENSITY
        elif(levelno>=20):
            color = FOREGROUND_GREEN
        elif(levelno>=10):
            color = FOREGROUND_MAGENTA
        else:
            color =  FOREGROUND_WHITE
        args[0]._set_color(color)

        ret = fn(*args)
        args[0]._set_color( FOREGROUND_WHITE )
        #print "after"
        return ret
    return new

def add_coloring_to_emit_ansi(fn):
    # add methods we need to the class
    def new(*args):
        levelno = args[1].levelno
        if(levelno>=50):
            color = '\x1b[31m' # red
        elif(levelno>=40):
            color = '\x1b[31m' # red
        elif(levelno>=30):
            color = '\x1b[33m' # yellow
        elif(levelno>=20):
            color = '\x1b[32m' # green 
        elif(levelno>=10):
            color = '\x1b[35m' # pink
        else:
            color = '\x1b[0m' # normal
        args[1].msg = color + args[1].msg +  '\x1b[0m'  # normal
        #print "after"
        return fn(*args)
    return new

import platform
if platform.system()=='Windows':
    # Windows does not support ANSI escapes and we are using API calls to set the console color
    logging.StreamHandler.emit = add_coloring_to_emit_windows(logging.StreamHandler.emit)
else:
    # all non-Windows platforms are supporting ANSI escapes so we use them
    logging.StreamHandler.emit = add_coloring_to_emit_ansi(logging.StreamHandler.emit)
    #log = logging.getLogger()
    #log.addFilter(log_filter())
    #//hdlr = logging.StreamHandler()
    #//hdlr.setFormatter(formatter()) 
```

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2017-09-29T04:56:25.737

好吧，我想我不妨添加我的彩色记录器的变体。

这没什么花哨的，但使用起来非常简单，并且不会更改记录对象，因此如果使用文件处理程序，则可以避免将 ANSI 转义序列记录到日志文件中。它不影响日志消息格式。

如果您已经在使用[日志记录模块的 Formatter](https://docs.python.org/3/library/logging.html#formatter-objects)，那么您只需将您的顾问处理程序 Formatter 替换为 ColoredFormatter 即可。如果您正在记录整个应用程序，您只需为顶级记录器执行此操作。

**彩色日志.py**

```
#!/usr/bin/env python

from copy import copy
from logging import Formatter

MAPPING = {
    'DEBUG'   : 37, # white
    'INFO'    : 36, # cyan
    'WARNING' : 33, # yellow
    'ERROR'   : 31, # red
    'CRITICAL': 41, # white on red bg
}

PREFIX = '\033['
SUFFIX = '\033[0m'

class ColoredFormatter(Formatter):

    def __init__(self, patern):
        Formatter.__init__(self, patern)

    def format(self, record):
        colored_record = copy(record)
        levelname = colored_record.levelname
        seq = MAPPING.get(levelname, 37) # default white
        colored_levelname = ('{0}{1}m{2}{3}') \
            .format(PREFIX, seq, levelname, SUFFIX)
        colored_record.levelname = colored_levelname
        return Formatter.format(self, colored_record) 
```

## 示例用法

**应用程序.py**

```
#!/usr/bin/env python

import logging
from colored_log import ColoredFormatter

# Create top level logger
log = logging.getLogger("main")

# Add console handler using our custom ColoredFormatter
ch = logging.StreamHandler()
ch.setLevel(logging.DEBUG)
cf = ColoredFormatter("[%(name)s][%(levelname)s]  %(message)s (%(filename)s:%(lineno)d)")
ch.setFormatter(cf)
log.addHandler(ch)

# Add file handler
fh = logging.FileHandler('app.log')
fh.setLevel(logging.DEBUG)
ff = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')
fh.setFormatter(ff)
log.addHandler(fh)

# Set log level
log.setLevel(logging.DEBUG)

# Log some stuff
log.debug("app has started")
log.info("Logging to 'app.log' in the script dir")
log.warning("This is my last warning, take heed")
log.error("This is an error")
log.critical("He's dead, Jim")

# Import a sub-module 
import sub_module 
```

**子模块.py**

```
#!/usr/bin/env python

import logging
log = logging.getLogger('main.sub_module')

log.debug("Hello from the sub module") 
```

## 结果

**终端输出**

![终端输出](https://i.stack.imgur.com/OsmlG.png)

**app.log**内容

```
2017-09-29 00:32:23,434 - main - DEBUG - app has started
2017-09-29 00:32:23,434 - main - INFO - Logging to 'app.log' in the script dir
2017-09-29 00:32:23,435 - main - WARNING - This is my last warning, take heed
2017-09-29 00:32:23,435 - main - ERROR - This is an error
2017-09-29 00:32:23,435 - main - CRITICAL - He's dead, Jim
2017-09-29 00:32:23,435 - main.sub_module - DEBUG - Hello from the sub module 
```

当然，您可以根据需要对终端和日志文件输出进行格式化。只有日志级别会被着色。

我希望有人觉得这很有用，而且它不仅仅是太多相同的东西。:)

Python 示例文件可以从这个 GitHub Gist 下载： [https ://gist.github.com/KurtJacobson/48e750701acec40c7161b5a2f79e6bfd](https://gist.github.com/KurtJacobson/48e750701acec40c7161b5a2f79e6bfd)

* * *

## 回答 #8

> 赞同：17
> 
> 时间：2016-06-18T09:05:22.307

您可以导入[colorlog](https://github.com/borntyping/python-colorlog)模块并将其`ColoredFormatter`用于对日志消息进行着色。

## 例子

主模块的样板：

```
import logging
import os
import sys
try:
    import colorlog
except ImportError:
    pass

def setup_logging():
    root = logging.getLogger()
    root.setLevel(logging.DEBUG)
    format      = '%(asctime)s - %(levelname)-8s - %(message)s'
    date_format = '%Y-%m-%d %H:%M:%S'
    if 'colorlog' in sys.modules and os.isatty(2):
        cformat = '%(log_color)s' + format
        f = colorlog.ColoredFormatter(cformat, date_format,
              log_colors = { 'DEBUG'   : 'reset',       'INFO' : 'reset',
                             'WARNING' : 'bold_yellow', 'ERROR': 'bold_red',
                             'CRITICAL': 'bold_red' })
    else:
        f = logging.Formatter(format, date_format)
    ch = logging.StreamHandler()
    ch.setFormatter(f)
    root.addHandler(ch)

setup_logging()
log = logging.getLogger(__name__) 
```

如果安装了 colorlog 模块并且输出实际发送到终端，则该代码仅启用日志消息中的颜色。这避免了在重定向日志输出时将转义序列写入文件。

此外，还设置了更适合深色背景的终端的自定义配色方案。

一些示例记录调用：

```
log.debug   ('Hello Debug')
log.info    ('Hello Info')
log.warn    ('Hello Warn')
log.error   ('Hello Error')
log.critical('Hello Critical') 
```

输出：

[![在此处输入图像描述](https://i.stack.imgur.com/lWWpI.png)](https://i.stack.imgur.com/lWWpI.png)

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2010-03-28T12:49:40.920

我更新了 airmind 支持前景和背景标签的示例。只需在日志格式化字符串中使用颜色变量 $BLACK - $WHITE。要设置背景，只需使用 $BG-BLACK - $BG-WHITE。

```
import logging

BLACK, RED, GREEN, YELLOW, BLUE, MAGENTA, CYAN, WHITE = range(8)

COLORS = {
    'WARNING'  : YELLOW,
    'INFO'     : WHITE,
    'DEBUG'    : BLUE,
    'CRITICAL' : YELLOW,
    'ERROR'    : RED,
    'RED'      : RED,
    'GREEN'    : GREEN,
    'YELLOW'   : YELLOW,
    'BLUE'     : BLUE,
    'MAGENTA'  : MAGENTA,
    'CYAN'     : CYAN,
    'WHITE'    : WHITE,
}

RESET_SEQ = "\033[0m"
COLOR_SEQ = "\033[1;%dm"
BOLD_SEQ  = "\033[1m"

class ColorFormatter(logging.Formatter):

    def __init__(self, *args, **kwargs):
        # can't do super(...) here because Formatter is an old school class
        logging.Formatter.__init__(self, *args, **kwargs)

    def format(self, record):
        levelname = record.levelname
        color     = COLOR_SEQ % (30 + COLORS[levelname])
        message   = logging.Formatter.format(self, record)
        message   = message.replace("$RESET", RESET_SEQ)\
                           .replace("$BOLD",  BOLD_SEQ)\
                           .replace("$COLOR", color)
        for k,v in COLORS.items():
            message = message.replace("$" + k,    COLOR_SEQ % (v+30))\
                             .replace("$BG" + k,  COLOR_SEQ % (v+40))\
                             .replace("$BG-" + k, COLOR_SEQ % (v+40))
        return message + RESET_SEQ

logging.ColorFormatter = ColorFormatter 
```

因此，现在您可以在配置文件中简单地执行以下操作：

```
[formatter_colorFormatter]
class=logging.ColorFormatter
format= $COLOR%(levelname)s $RESET %(asctime)s $BOLD$COLOR%(name)s$RESET %(message)s 
```

* * *

## 回答 #10

> 赞同：12
> 
> 时间：2010-02-05T08:36:51.983

我修改了 Sorin 提供的原始示例并将 StreamHandler 子类化为 ColorizedConsoleHandler。

他们的解决方案的缺点是它修改了消息，因为这是修改实际的日志消息，所以任何其他处理程序也将获得修改后的消息。

在我们的例子中，这导致了带有颜色代码的日志文件，因为我们使用了多个记录器。

下面的类仅适用于支持 ansi 的平台，但将 windows 颜色代码添加到它应该是微不足道的。

```
import copy
import logging

class ColoredConsoleHandler(logging.StreamHandler):
    def emit(self, record):
        # Need to make a actual copy of the record
        # to prevent altering the message for other loggers
        myrecord = copy.copy(record)
        levelno = myrecord.levelno
        if(levelno >= 50):  # CRITICAL / FATAL
            color = '\x1b[31m'  # red
        elif(levelno >= 40):  # ERROR
            color = '\x1b[31m'  # red
        elif(levelno >= 30):  # WARNING
            color = '\x1b[33m'  # yellow
        elif(levelno >= 20):  # INFO
            color = '\x1b[32m'  # green
        elif(levelno >= 10):  # DEBUG
            color = '\x1b[35m'  # pink
        else:  # NOTSET and anything else
            color = '\x1b[0m'  # normal
        myrecord.msg = color + str(myrecord.msg) + '\x1b[0m'  # normal
        logging.StreamHandler.emit(self, myrecord) 
```

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2011-01-14T13:52:14.817

看看下面的解决方案。流处理程序应该是进行着色的东西，然后您可以选择为单词着色，而不仅仅是整行（使用格式化程序）。

[http://plumberjack.blogspot.com/2010/12/colorizing-logging-output-in-terminals.html](http://plumberjack.blogspot.com/2010/12/colorizing-logging-output-in-terminals.html)

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2013-12-20T08:08:40.817

现在有一个发布的 PyPi 模块，用于可定制的彩色日志输出：

[https://pypi.python.org/pypi/rainbow_logging_handler/](https://pypi.python.org/pypi/rainbow_logging_handler/)

和

[https://github.com/laysakura/rainbow_logging_handler](https://github.com/laysakura/rainbow_logging_handler)

*   支持视窗

*   支持 Django

*   可定制的颜色

由于这是作为 Python Egg 分发的，因此对于任何 Python 应用程序都非常容易安装。

* * *

## 回答 #13

> 赞同：9
> 
> 时间：2020-12-13T22:46:45.993

安装 colorlog 包，您可以立即在日志消息中使用颜色：

*   获取一个`logger`实例，就像你通常做的那样。
*   设置日志记录级别。您还可以直接使用来自日志记录模块的`DEBUG` 常量`INFO`。
*   将消息格式化程序`ColoredFormatter`设置为由`colorlog`库提供。

```
import colorlog

logger = colorlog.getLogger()
logger.setLevel(colorlog.colorlog.logging.DEBUG)

handler = colorlog.StreamHandler()
handler.setFormatter(colorlog.ColoredFormatter())
logger.addHandler(handler)

logger.debug("Debug message")
logger.info("Information message")
logger.warning("Warning message")
logger.error("Error message")
logger.critical("Critical message") 
```

输出： [![在此处输入图像描述](https://i.stack.imgur.com/sXE9G.png)](https://i.stack.imgur.com/sXE9G.png)

* * *

### 更新：额外信息

只需更新`ColoredFormatter`：

```
handler.setFormatter(colorlog.ColoredFormatter('%(log_color)s [%(asctime)s] %(levelname)s [%(filename)s.%(funcName)s:%(lineno)d] %(message)s', datefmt='%a, %d %b %Y %H:%M:%S')) 
```

输出： [![在此处输入图像描述](https://i.stack.imgur.com/UMeCl.png)](https://i.stack.imgur.com/UMeCl.png)

* * *

包裹：

```
pip install colorlog 
```

输出：

```
Collecting colorlog
  Downloading colorlog-4.6.2-py2.py3-none-any.whl (10.0 kB)
Installing collected packages: colorlog
Successfully installed colorlog-4.6.2 
```

* * *

## 回答 #14

> 赞同：8
> 
> 时间：2020-05-25T05:59:49.827

除了按级别着色之外，突出显示还使用交替颜色记录消息参数怎么样？我最近为此编写了简单的代码。另一个优点是日志调用是使用 Python 3 大括号样式格式进行的。( `"{}"`)。

在此处查看最新代码和示例：[https ://github.com/davidohana/colargulog](https://github.com/davidohana/colargulog)

**示例记录代码：**

```
root_logger = logging.getLogger()
console_handler = logging.StreamHandler(stream=sys.stdout)
console_format = "%(asctime)s - %(levelname)-8s - %(name)-25s - %(message)s"
colored_formatter = ColorizedArgsFormatter(console_format)
console_handler.setFormatter(colored_formatter)
root_logger.addHandler(console_handler)

logger = logging.getLogger(__name__)
logger.info("Hello World")
logger.info("Request from {} handled in {:.3f} ms", socket.gethostname(), 11)
logger.info("Request from {} handled in {:.3f} ms", "127.0.0.1", 33.1)
logger.info("My favorite drinks are {}, {}, {}, {}", "milk", "wine", "tea", "beer")
logger.debug("this is a {} message", logging.getLevelName(logging.DEBUG))
logger.info("this is a {} message", logging.getLevelName(logging.INFO))
logger.warning("this is a {} message", logging.getLevelName(logging.WARNING))
logger.error("this is a {} message", logging.getLevelName(logging.ERROR))
logger.critical("this is a {} message", logging.getLevelName(logging.CRITICAL))
logger.info("Does old-style formatting also work? %s it is, but no colors (yet)", True) 
```

**输出：**

[![在此处输入图像描述](https://i.stack.imgur.com/0Or6e.png)](https://i.stack.imgur.com/0Or6e.png)

**执行：**

```
"""
colargulog - Python3 Logging with Colored Arguments and new string formatting style

Written by david.ohana@ibm.com
License: Apache-2.0
"""

import logging
import logging.handlers
import re

class ColorCodes:
    grey = "\x1b[38;21m"
    green = "\x1b[1;32m"
    yellow = "\x1b[33;21m"
    red = "\x1b[31;21m"
    bold_red = "\x1b[31;1m"
    blue = "\x1b[1;34m"
    light_blue = "\x1b[1;36m"
    purple = "\x1b[1;35m"
    reset = "\x1b[0m"

class ColorizedArgsFormatter(logging.Formatter):
    arg_colors = [ColorCodes.purple, ColorCodes.light_blue]
    level_fields = ["levelname", "levelno"]
    level_to_color = {
        logging.DEBUG: ColorCodes.grey,
        logging.INFO: ColorCodes.green,
        logging.WARNING: ColorCodes.yellow,
        logging.ERROR: ColorCodes.red,
        logging.CRITICAL: ColorCodes.bold_red,
    }

    def __init__(self, fmt: str):
        super().__init__()
        self.level_to_formatter = {}

        def add_color_format(level: int):
            color = ColorizedArgsFormatter.level_to_color[level]
            _format = fmt
            for fld in ColorizedArgsFormatter.level_fields:
                search = "(%\(" + fld + "\).*?s)"
                _format = re.sub(search, f"{color}\\1{ColorCodes.reset}", _format)
            formatter = logging.Formatter(_format)
            self.level_to_formatter[level] = formatter

        add_color_format(logging.DEBUG)
        add_color_format(logging.INFO)
        add_color_format(logging.WARNING)
        add_color_format(logging.ERROR)
        add_color_format(logging.CRITICAL)

    @staticmethod
    def rewrite_record(record: logging.LogRecord):
        if not BraceFormatStyleFormatter.is_brace_format_style(record):
            return

        msg = record.msg
        msg = msg.replace("{", "_{{")
        msg = msg.replace("}", "_}}")
        placeholder_count = 0
        # add ANSI escape code for next alternating color before each formatting parameter
        # and reset color after it.
        while True:
            if "_{{" not in msg:
                break
            color_index = placeholder_count % len(ColorizedArgsFormatter.arg_colors)
            color = ColorizedArgsFormatter.arg_colors[color_index]
            msg = msg.replace("_{{", color + "{", 1)
            msg = msg.replace("_}}", "}" + ColorCodes.reset, 1)
            placeholder_count += 1

        record.msg = msg.format(*record.args)
        record.args = []

    def format(self, record):
        orig_msg = record.msg
        orig_args = record.args
        formatter = self.level_to_formatter.get(record.levelno)
        self.rewrite_record(record)
        formatted = formatter.format(record)

        # restore log record to original state for other handlers
        record.msg = orig_msg
        record.args = orig_args
        return formatted

class BraceFormatStyleFormatter(logging.Formatter):
    def __init__(self, fmt: str):
        super().__init__()
        self.formatter = logging.Formatter(fmt)

    @staticmethod
    def is_brace_format_style(record: logging.LogRecord):
        if len(record.args) == 0:
            return False

        msg = record.msg
        if '%' in msg:
            return False

        count_of_start_param = msg.count("{")
        count_of_end_param = msg.count("}")

        if count_of_start_param != count_of_end_param:
            return False

        if count_of_start_param != len(record.args):
            return False

        return True

    @staticmethod
    def rewrite_record(record: logging.LogRecord):
        if not BraceFormatStyleFormatter.is_brace_format_style(record):
            return

        record.msg = record.msg.format(*record.args)
        record.args = []

    def format(self, record):
        orig_msg = record.msg
        orig_args = record.args
        self.rewrite_record(record)
        formatted = self.formatter.format(record)

        # restore log record to original state for other handlers
        record.msg = orig_msg
        record.args = orig_args
        return formatted 
```

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2015-08-19T10:45:15.333

为任何终端文本着色的一个简单但非常灵活的工具是' [colout](http://nojhan.github.io/colout/) '。

```
pip install colout
myprocess | colout REGEX_WITH_GROUPS color1,color2... 
```

与正则表达式的第 1 组匹配的“myprocess”输出中的任何文本将用 color1 着色，第 2 组用 color2 着色，等等。

例如：

```
tail -f /var/log/mylogfile | colout '^(\w+ \d+ [\d:]+)|(\w+\.py:\d+ .+\(\)): (.+)$' white,black,cyan bold,bold,normal 
```

即第一个正则表达式组（parens）匹配日志文件中的初始日期，第二组匹配python文件名、行号和函数名，第三组匹配之后出现的日志消息。我还使用“粗体/法线”的并行序列以及颜色序列。这看起来像：

[![带有彩色格式的日志文件](https://i.stack.imgur.com/99ztB.png)](https://i.stack.imgur.com/99ztB.png)

请注意，与我的任何正则表达式不匹配的行或部分行仍会被回显，因此这不像 'grep --color' - 没有任何内容从输出中过滤出来。

显然，这足够灵活，您可以在任何进程中使用它，而不仅仅是尾随日志文件。每当我想给某些东西上色时，我通常都会在运行中创建一个新的正则表达式。出于这个原因，与任何自定义日志文件着色工具相比，我更喜欢 colout，因为我只需要学习一个工具，无论我在着色什么：日志记录、测试输出、在终端中突出显示代码片段的语法等。

它还避免了在日志文件本身中实际转储 ANSI 代码，恕我直言，这是一个坏主意，因为它会破坏诸如在日志文件中查找模式之类的事情，除非您始终记得在 grep 正则表达式中匹配 ANSI 代码。

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2017-11-22T13:22:32.793

有很多回应。但是没有人在谈论装饰器。所以这是我的。

因为它要简单得多。

无需导入任何内容，也无需编写任何子类：

```
#!/usr/bin/env python
# -*- coding: utf-8 -*-

import logging

NO_COLOR = "\33[m"
RED, GREEN, ORANGE, BLUE, PURPLE, LBLUE, GREY = \
    map("\33[%dm".__mod__, range(31, 38))

logging.basicConfig(format="%(message)s", level=logging.DEBUG)
logger = logging.getLogger(__name__)

# the decorator to apply on the logger methods info, warn, ...
def add_color(logger_method, color):
  def wrapper(message, *args, **kwargs):
    return logger_method(
      # the coloring is applied here.
      color+message+NO_COLOR,
      *args, **kwargs
    )
  return wrapper

for level, color in zip((
  "info", "warn", "error", "debug"), (
  GREEN, ORANGE, RED, BLUE
)):
  setattr(logger, level, add_color(getattr(logger, level), color))

# this is displayed in red.
logger.error("Launching %s." % __file__) 
```

这会将错误设置为红色，将调试消息设置为蓝色，等等。就像问题中问的那样。

我们甚至可以调整包装器以使用`color`参数来动态设置消息的颜色`logger.debug("message", color=GREY)`

编辑：所以这是在运行时设置颜色的改编装饰器：

```
def add_color(logger_method, _color):
  def wrapper(message, *args, **kwargs):
    color = kwargs.pop("color", _color)
    if isinstance(color, int):
      color = "\33[%dm" % color
    return logger_method(
      # the coloring is applied here.
      color+message+NO_COLOR,
      *args, **kwargs
    )
  return wrapper

# blah blah, apply the decorator...

# this is displayed in red.
logger.error("Launching %s." % __file__)
# this is displayed in blue
logger.error("Launching %s." % __file__, color=34)
# and this, in grey
logger.error("Launching %s." % __file__, color=GREY) 
```

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2010-04-19T11:01:26.903

airmind 方法的另一个小混音，它将所有东西都放在一个类中：

```
class ColorFormatter(logging.Formatter):
  FORMAT = ("[$BOLD%(name)-20s$RESET][%(levelname)-18s]  "
            "%(message)s "
            "($BOLD%(filename)s$RESET:%(lineno)d)")

  BLACK, RED, GREEN, YELLOW, BLUE, MAGENTA, CYAN, WHITE = range(8)

  RESET_SEQ = "\033[0m"
  COLOR_SEQ = "\033[1;%dm"
  BOLD_SEQ = "\033[1m"

  COLORS = {
    'WARNING': YELLOW,
    'INFO': WHITE,
    'DEBUG': BLUE,
    'CRITICAL': YELLOW,
    'ERROR': RED
  }

  def formatter_msg(self, msg, use_color = True):
    if use_color:
      msg = msg.replace("$RESET", self.RESET_SEQ).replace("$BOLD", self.BOLD_SEQ)
    else:
      msg = msg.replace("$RESET", "").replace("$BOLD", "")
    return msg

  def __init__(self, use_color=True):
    msg = self.formatter_msg(self.FORMAT, use_color)
    logging.Formatter.__init__(self, msg)
    self.use_color = use_color

  def format(self, record):
    levelname = record.levelname
    if self.use_color and levelname in self.COLORS:
      fore_color = 30 + self.COLORS[levelname]
      levelname_color = self.COLOR_SEQ % fore_color + levelname + self.RESET_SEQ
      record.levelname = levelname_color
    return logging.Formatter.format(self, record) 
```

要将格式化程序附加到处理程序，例如：

```
handler.setFormatter(ColorFormatter())
logger.addHandler(handler) 
```

* * *

## 回答 #18

> 赞同：4
> 
> 时间：2015-08-13T14:52:25.247

```
import logging
import sys

colors = {'pink': '\033[95m', 'blue': '\033[94m', 'green': '\033[92m', 'yellow': '\033[93m', 'red': '\033[91m',
      'ENDC': '\033[0m', 'bold': '\033[1m', 'underline': '\033[4m'}

logging.basicConfig(stream=sys.stdout, level=logging.DEBUG)

def str_color(color, data):
    return colors[color] + str(data) + colors['ENDC']

params = {'param1': id1, 'param2': id2}

logging.info('\nParams:' + str_color("blue", str(params)))` 
```

* * *

## 回答 #19

> 赞同：4
> 
> 时间：2021-08-22T03:12:55.600

# 你真的应该尝试**富有**

如果你想要`colors`，`rich`可能是你正在寻找的包。

它易于使用和可定制 + 适用于`cmd`、`windows terminal`等`comemu`和`jupyter notebook`! （我尝试了很多我告诉你的包，只有`rich`' 的颜色在笔记本中有效。）。

`rich`还带有许多其他花哨的功能。查看[https://rich.readthedocs.io/en/latest/](https://rich.readthedocs.io/en/latest/)。

## 安装

```
pip install rich 
```

## 最小的例子：

```
import logging
from rich.logging import RichHandler

FORMAT = "%(message)s"
logging.basicConfig(
    level="NOTSET", format=FORMAT, datefmt="[%X]", handlers=[RichHandler()]
)  # set level=20 or logging.INFO to turn of debug
logger = logging.getLogger("rich")

logger.debug("debug...")
logger.info("info...")
logger.warning("warning...")
logger.error("error...")
logger.fatal("fatal...") 
```

[![在此处输入图像描述](https://i.stack.imgur.com/rn3ZO.png)](https://i.stack.imgur.com/rn3ZO.png)

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2021-08-11T17:24:16.803

# 彩色原木

## 安装

```
pip install coloredlogs 
```

## 用法

##### 最少使用：

```
import logging
import coloredlogs

coloredlogs.install()  # install a handler on the root logger

logging.debug('message with level debug')
logging.info('message with level info')
logging.warning('message with level warning')
logging.error('message with level error')
logging.critical('message with level critical') 
```

结果： [![最少使用](https://i.stack.imgur.com/A1axw.png)](https://i.stack.imgur.com/A1axw.png)

##### 从消息级调试开始：

```
import logging
import coloredlogs

coloredlogs.install(level='DEBUG')  # install a handler on the root logger with level debug

logging.debug('message with level debug')
logging.info('message with level info')
logging.warning('message with level warning')
logging.error('message with level error')
logging.critical('message with level critical') 
```

结果： [![调试级别](https://i.stack.imgur.com/S3AAi.png)](https://i.stack.imgur.com/S3AAi.png)

##### 隐藏库中的消息：

```
import logging
import coloredlogs

logger = logging.getLogger(__name__)  # get a specific logger object
coloredlogs.install(level='DEBUG')  # install a handler on the root logger with level debug
coloredlogs.install(level='DEBUG', logger=logger)  # pass a specific logger object

logging.debug('message with level debug')
logging.info('message with level info')
logging.warning('message with level warning')
logging.error('message with level error')
logging.critical('message with level critical') 
```

结果： [![调试级别](https://i.stack.imgur.com/S3AAi.png)](https://i.stack.imgur.com/S3AAi.png)

##### 格式化日志消息：

```
import logging
import coloredlogs

logger = logging.getLogger(__name__)  # get a specific logger object
coloredlogs.install(level='DEBUG')  # install a handler on the root logger with level debug
coloredlogs.install(level='DEBUG', logger=logger)  # pass a specific logger object
coloredlogs.install(
    level='DEBUG', logger=logger,
    fmt='%(asctime)s.%(msecs)03d %(filename)s:%(lineno)d %(levelname)s %(message)s'
)

logging.debug('message with level debug')
logging.info('message with level info')
logging.warning('message with level warning')
logging.error('message with level error')
logging.critical('message with level critical') 
```

结果： [![格式化日志消息](https://i.stack.imgur.com/0aBWR.png)](https://i.stack.imgur.com/0aBWR.png)

##### 可用的格式属性：

*   `%(asctime)s`- 发出记录调用时作为人类可读字符串的时间
*   `%(created)f`- 发出记录调用时的浮点时间
*   `%(filename)s`- 文件名
*   `%(funcName)s`- 包含日志调用的函数名称
*   `%(hostname)s`- 系统主机名
*   `%(levelname)s`- 文本记录级别
*   `%(levelno)s`- 整数日志记录级别
*   `%(lineno)d`- 发出记录调用的行号
*   `%(message)s`- 传递给记录调用的消息（与 相同`%(msg)s`）
*   `%(module)s`- 发出记录调用的文件名不带扩展名
*   `%(msecs)d`- 发出记录调用时的毫秒部分
*   `%(msg)s`- 传递给记录调用的消息（与 相同`%(message)s`）
*   `%(name)s`- 记录器名称
*   `%(pathname)s`- 包含日志调用的文件的完整路径名
*   `%(process)d`- 进程 ID
*   `%(processName)s`- 进程名称
*   `%(programname)s`- 系统程序名
*   `%(relativeCreated)d`- 发出记录调用时的整数毫秒数，相对于加载记录模块的时间
*   `%(thread)d`- 线程 ID
*   `%(threadName)s`- 线程名称
*   `%(username)s`- 系统用户名

## 资料来源：

[彩色原木包](https://pypi.org/project/coloredlogs/)

[日志库](https://docs.python.org/3/library/logging.html#logrecord-attributes)

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2014-10-03T17:10:01.860

这是我的解决方案：

```
class ColouredFormatter(logging.Formatter):
    RESET = '\x1B[0m'
    RED = '\x1B[31m'
    YELLOW = '\x1B[33m'
    BRGREEN = '\x1B[01;32m'  # grey in solarized for terminals

    def format(self, record, colour=False):
        message = super().format(record)

        if not colour:
            return message

        level_no = record.levelno
        if level_no >= logging.CRITICAL:
            colour = self.RED
        elif level_no >= logging.ERROR:
            colour = self.RED
        elif level_no >= logging.WARNING:
            colour = self.YELLOW
        elif level_no >= logging.INFO:
            colour = self.RESET
        elif level_no >= logging.DEBUG:
            colour = self.BRGREEN
        else:
            colour = self.RESET

        message = colour + message + self.RESET

        return message

class ColouredHandler(logging.StreamHandler):
    def __init__(self, stream=sys.stdout):
        super().__init__(stream)

    def format(self, record, colour=False):
        if not isinstance(self.formatter, ColouredFormatter):
            self.formatter = ColouredFormatter()

        return self.formatter.format(record, colour)

    def emit(self, record):
        stream = self.stream
        try:
            msg = self.format(record, stream.isatty())
            stream.write(msg)
            stream.write(self.terminator)
            self.flush()
        except Exception:
            self.handleError(record)

h = ColouredHandler()
h.formatter = ColouredFormatter('{asctime} {levelname:8} {message}', '%Y-%m-%d %H:%M:%S', '{')
logging.basicConfig(level=logging.DEBUG, handlers=[h]) 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2019-10-06T16:43:20.470

[FriendlyLog](https://github.com/SebiSebi/friendlylog)是另一种选择。它适用于 Linux、Windows 和 MacOS 下的 Python 2 和 3。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2020-04-29T20:03:57.877

这是 airmind 示例的另一个 Python3 变体。我想要一些在其他示例中没有看到的特定功能

*   为终端使用颜色，但不要在文件处理程序中写入不可打印的字符（我为此定义了 2 个格式化程序）
*   能够覆盖特定日志消息的颜色
*   从文件配置记录器（在本例中为 yaml）

注意：我使用了[colorama](https://pypi.org/project/colorama/)，但你可以修改它，所以它不是必需的。此外，对于我的测试，我只是在运行 python 文件，所以我的类在模块中`__main__`你必须更改`(): __main__.ColoredFormatter`为你的模块。

```
pip install colorama pyyaml 
```

日志记录.yaml

```
---
version: 1
disable_existing_loggers: False
formatters:
  simple:
    format: "%(threadName)s - %(name)s - %(levelname)s - %(message)s"
  color:
    format: "%(threadName)s - %(name)s - %(levelname)s - %(message)s"
    (): __main__.ColoredFormatter
    use_color: true

handlers:
  console:
    class: logging.StreamHandler
    level: DEBUG
    formatter: color
    stream: ext://sys.stdout

  info_file_handler:
    class: logging.handlers.RotatingFileHandler
    level: INFO
    formatter: simple
    filename: app.log
    maxBytes: 20971520 
    backupCount: 20
    encoding: utf8

  error_file_handler:
    class: logging.handlers.RotatingFileHandler
    level: ERROR
    formatter: simple
    filename: errors.log
    maxBytes: 10485760 
    backupCount: 20
    encoding: utf8

root:
  level: DEBUG
  handlers: [console, info_file_handler, error_file_handler] 
```

主文件

```
import logging
import logging.config
import os
from logging import Logger

import colorama
import yaml
from colorama import Back, Fore, Style

COLORS = {
    "WARNING": Fore.YELLOW,
    "INFO": Fore.CYAN,
    "DEBUG": Fore.BLUE,
    "CRITICAL": Fore.YELLOW,
    "ERROR": Fore.RED,
}

class ColoredFormatter(logging.Formatter):
    def __init__(self, *, format, use_color):
        logging.Formatter.__init__(self, fmt=format)
        self.use_color = use_color

    def format(self, record):
        msg = super().format(record)
        if self.use_color:
            levelname = record.levelname
            if hasattr(record, "color"):
                return f"{record.color}{msg}{Style.RESET_ALL}"
            if levelname in COLORS:
                return f"{COLORS[levelname]}{msg}{Style.RESET_ALL}"
        return msg

with open("logging.yaml", "rt") as f:
    config = yaml.safe_load(f.read())
    logging.config.dictConfig(config)

logger: Logger = logging.getLogger(__name__)
logger.info("Test INFO", extra={"color": Back.RED})
logger.info("Test INFO", extra={"color": f"{Style.BRIGHT}{Back.RED}"})
logger.info("Test INFO")
logger.debug("Test DEBUG")
logger.warning("Test WARN") 
```

输出：

[![输出](https://i.stack.imgur.com/AsvRt.png)](https://i.stack.imgur.com/AsvRt.png)

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2021-05-08T08:37:06.327

# 表情符号

您可以像其他人在他们的答案中提到的那样使用文本颜色来获得带有背景或前景色的彩色文本。

但是您可以改用**表情符号**！例如，您可以`⚠️`用于警告消息和`错误消息。`

 `或者简单地将这些笔记本用作颜色：

```
print(": error message")
print(": warning message")
print(": ok status message")
print(": action message")
print(": canceled status message")
print(": Or anything you like and want to recognize immediately by color") 
```

### 奖金：

**此方法还可以帮助您直接在源代码中**快速扫描和查找日志。

* * *

### 如何打开表情符号选择器？

[**mac操作系统**：](https://support.apple.com/guide/mac-help/use-emoji-and-symbols-on-mac-mchlp1560/mac) `control` +`command`+`space`

[**窗户**：](https://support.microsoft.com/en-us/windows/windows-10-keyboard-tips-and-tricks-588e0b72-0fff-6d3f-aeee-6e5116097942) `win` +`.`

[**linux** :](https://www.omgubuntu.co.uk/2018/06/use-emoji-linux-ubuntu-apps) `control` +`.`或 `control`+`;`

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2013-05-18T23:34:28.220

刚刚在类似问题上回答了同样的问题：[Python | 更改外壳中的文本颜色](https://stackoverflow.com/questions/2330245/python-change-text-color-in-shell/16630004#16630004)

这个想法是使用[clint](https://github.com/kennethreitz/clint)库。它支持 MAC、Linux 和 Windows shell (CLI)。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2015-04-29T16:03:16.727

虽然其他解决方案看起来不错，但它们存在一些问题。有些会为整条线着色，而有些则不需要，有些则忽略了您可能拥有的任何配置。下面的解决方案只影响消息本身。

**代码**

```
class ColoredFormatter(logging.Formatter):
    def format(self, record):
        if record.levelno == logging.WARNING:
            record.msg = '\033[93m%s\033[0m' % record.msg
        elif record.levelno == logging.ERROR:
            record.msg = '\033[91m%s\033[0m' % record.msg
        return logging.Formatter.format(self, record) 
```

**例子**

```
logger = logging.getLogger('mylogger')
handler = logging.StreamHandler()

log_format = '[%(asctime)s]:%(levelname)-7s:%(message)s'
time_format = '%H:%M:%S'
formatter = ColoredFormatter(log_format, datefmt=time_format)
handler.setFormatter(formatter)
logger.addHandler(handler)

logger.warn('this should be yellow')
logger.error('this should be red') 
```

**输出**

```
[17:01:36]:WARNING:this should be yellow
[17:01:37]:ERROR  :this should be red 
```

如您所见，其他所有内容仍会输出并保持其初始颜色。如果您想更改除消息之外的任何其他内容，您可以简单地将颜色代码传递给`log_format`示例中的内容。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2011-01-12T18:07:31.883

我遇到的问题是正确设置格式化程序：

```
class ColouredFormatter(logging.Formatter):    
    def __init__(self, msg):
        logging.Formatter.__init__(self, msg)
        self._init_colour = _get_colour()

    def close(self):
        # restore the colour information to what it was
        _set_colour(self._init_colour)

    def format(self, record):        
        # Add your own colourer based on the other examples
        _set_colour( LOG_LEVEL_COLOUR[record.levelno] )
        return logging.Formatter.format(self, record)         

def init():
    # Set up the formatter. Needs to be first thing done.
    rootLogger = logging.getLogger()
    hdlr = logging.StreamHandler()
    fmt = ColouredFormatter('%(message)s')
    hdlr.setFormatter(fmt)
    rootLogger.addHandler(hdlr) 
```

然后使用：

```
import coloured_log
import logging

coloured_log.init()
logging.info("info")    
logging.debug("debug")    

coloured_log.close()    # restore colours 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2015-06-04T16:56:59.633

我有两个要添加的提交，其中一个仅对消息着色（ColoredFormatter），其中一个对整行着色（ColorizingStreamHandler）。这些还包括比以前的解决方案更多的 ANSI 颜色代码。

一些内容（经过修改）来自：上面的帖子和[http://plumberjack.blogspot.com/2010/12/colorizing-logging-output-in-terminals.html](http://plumberjack.blogspot.com/2010/12/colorizing-logging-output-in-terminals.html)。

仅对消息着色：

```
class ColoredFormatter(logging.Formatter):
    """Special custom formatter for colorizing log messages!"""

    BLACK = '\033[0;30m'
    RED = '\033[0;31m'
    GREEN = '\033[0;32m'
    BROWN = '\033[0;33m'
    BLUE = '\033[0;34m'
    PURPLE = '\033[0;35m'
    CYAN = '\033[0;36m'
    GREY = '\033[0;37m'

    DARK_GREY = '\033[1;30m'
    LIGHT_RED = '\033[1;31m'
    LIGHT_GREEN = '\033[1;32m'
    YELLOW = '\033[1;33m'
    LIGHT_BLUE = '\033[1;34m'
    LIGHT_PURPLE = '\033[1;35m'
    LIGHT_CYAN = '\033[1;36m'
    WHITE = '\033[1;37m'

    RESET = "\033[0m"

    def __init__(self, *args, **kwargs):
        self._colors = {logging.DEBUG: self.DARK_GREY,
                        logging.INFO: self.RESET,
                        logging.WARNING: self.BROWN,
                        logging.ERROR: self.RED,
                        logging.CRITICAL: self.LIGHT_RED}
        super(ColoredFormatter, self).__init__(*args, **kwargs)

    def format(self, record):
        """Applies the color formats"""
        record.msg = self._colors[record.levelno] + record.msg + self.RESET
        return logging.Formatter.format(self, record)

    def setLevelColor(self, logging_level, escaped_ansi_code):
        self._colors[logging_level] = escaped_ansi_code 
```

为整行着色：

```
class ColorizingStreamHandler(logging.StreamHandler):

    BLACK = '\033[0;30m'
    RED = '\033[0;31m'
    GREEN = '\033[0;32m'
    BROWN = '\033[0;33m'
    BLUE = '\033[0;34m'
    PURPLE = '\033[0;35m'
    CYAN = '\033[0;36m'
    GREY = '\033[0;37m'

    DARK_GREY = '\033[1;30m'
    LIGHT_RED = '\033[1;31m'
    LIGHT_GREEN = '\033[1;32m'
    YELLOW = '\033[1;33m'
    LIGHT_BLUE = '\033[1;34m'
    LIGHT_PURPLE = '\033[1;35m'
    LIGHT_CYAN = '\033[1;36m'
    WHITE = '\033[1;37m'

    RESET = "\033[0m"

    def __init__(self, *args, **kwargs):
        self._colors = {logging.DEBUG: self.DARK_GREY,
                        logging.INFO: self.RESET,
                        logging.WARNING: self.BROWN,
                        logging.ERROR: self.RED,
                        logging.CRITICAL: self.LIGHT_RED}
        super(ColorizingStreamHandler, self).__init__(*args, **kwargs)

    @property
    def is_tty(self):
        isatty = getattr(self.stream, 'isatty', None)
        return isatty and isatty()

    def emit(self, record):
        try:
            message = self.format(record)
            stream = self.stream
            if not self.is_tty:
                stream.write(message)
            else:
                message = self._colors[record.levelno] + message + self.RESET
                stream.write(message)
            stream.write(getattr(self, 'terminator', '\n'))
            self.flush()
        except (KeyboardInterrupt, SystemExit):
            raise
        except:
            self.handleError(record)

    def setLevelColor(self, logging_level, escaped_ansi_code):
        self._colors[logging_level] = escaped_ansi_code 
```

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2020-08-29T15:29:29.940

一个方便的带有 tput 颜色的 bash 脚本

```
# Simple using tput
bold=$(tput bold)
reset=$(tput sgr0)

fblack=$(tput setaf 0)
fred=$(tput setaf 1)
fgreen=$(tput setaf 2)
fyellow=$(tput setaf 3)
fblue=$(tput setaf 4)
fmagenta=$(tput setaf 5)
fcyan=$(tput setaf 6)
fwhite=$(tput setaf 7)
fnotused=$(tput setaf 8)
freset=$(tput setaf 9)

bblack=$(tput setab 0)
bred=$(tput setab 1)
bgreen=$(tput setab 2)
byellow=$(tput setab 3)
bblue=$(tput setab 4)
bmagenta=$(tput setab 5)
bcyan=$(tput setab 6)
bwhite=$(tput setab 7)
bnotused=$(tput setab 8)
breset=$(tput setab 9)

# 0 - Emergency (emerg)       $fred       # something is wrong... go red
# 1 - Alerts (alert)          $fred       # something is wrong... go red
# 2 - Critical (crit)         $fred       # something is wrong... go red
# 3 - Errors (err)            $fred       # something is wrong... go red
# 4 - Warnings (warn)         $fyellow    # yellow yellow dirty logs
# 5 - Notification (notice)   $fwhite     # common stuff
# 6 - Information (info)      $fblue      # sky is blue
# 7 - Debug (debug)           $fgreen     # lot of stuff to read... go green 
```

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2020-01-21T08:13:22.053

以下解决方案仅适用于 python 3，但对我来说它看起来最清楚。

这个想法是使用日志记录工厂将“彩色”属性添加到日志记录对象，而不是在日志格式中使用这些“彩色”属性。

```
import logging
logger = logging.getLogger(__name__)

def configure_logging(level):

    # add 'levelname_c' attribute to log resords
    orig_record_factory = logging.getLogRecordFactory()
    log_colors = {
        logging.DEBUG:     "\033[1;34m",  # blue
        logging.INFO:      "\033[1;32m",  # green
        logging.WARNING:   "\033[1;35m",  # magenta
        logging.ERROR:     "\033[1;31m",  # red
        logging.CRITICAL:  "\033[1;41m",  # red reverted
    }
    def record_factory(*args, **kwargs):
        record = orig_record_factory(*args, **kwargs)
        record.levelname_c = "{}{}{}".format(
            log_colors[record.levelno], record.levelname, "\033[0m")
        return record

    logging.setLogRecordFactory(record_factory)

    # now each log record object would contain 'levelname_c' attribute
    # and you can use this attribute when configuring logging using your favorite
    # method.
    # for demo purposes I configure stderr log right here

    formatter_c = logging.Formatter("[%(asctime)s] %(levelname_c)s:%(name)s:%(message)s")

    stderr_handler = logging.StreamHandler()
    stderr_handler.setLevel(level)
    stderr_handler.setFormatter(formatter_c)

    root_logger = logging.getLogger('')
    root_logger.setLevel(logging.DEBUG)
    root_logger.addHandler(stderr_handler)

def main():
    configure_logging(logging.DEBUG)

    logger.debug("debug message")
    logger.info("info message")
    logger.critical("something unusual happened")

if __name__ == '__main__':
    main() 
```

您可以轻松修改此示例以创建其他彩色属性 (fe message_c)，然后使用这些属性（仅）在您想要的位置获取彩色文本。

（我最近发现的小技巧：我有一个带有彩色调试日志的文件，每当我想临时提高应用程序的日志级别时，我只是`tail -f`在不同终端中的日志文件，并在屏幕上查看调试日志，无需更改任何配置并重新启动应用程序)

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2022-01-21T03:35:27.267

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2018-02-19T14:23:33.917

这是一个包含颜色代码的枚举：

```
class TerminalColour:
    """
    Terminal colour formatting codes
    """
    # https://stackoverflow.com/questions/287871/print-in-terminal-with-colors
    MAGENTA = '\033[95m'
    BLUE = '\033[94m'
    GREEN = '\033[92m'
    YELLOW = '\033[93m'
    RED = '\033[91m'
    GREY = '\033[0m'  # normal
    WHITE = '\033[1m'  # bright white
    UNDERLINE = '\033[4m' 
```

这可以应用于每个日志级别的*名称*。***请注意，这是一个可怕的黑客攻击。***

```
logging.addLevelName(logging.INFO, "{}{}{}".format(TerminalColour.WHITE, logging.getLevelName(logging.INFO), TerminalColour.GREY))
logging.addLevelName(logging.WARNING, "{}{}{}".format(TerminalColour.YELLOW, logging.getLevelName(logging.WARNING), TerminalColour.GREY))
logging.addLevelName(logging.ERROR, "{}{}{}".format(TerminalColour.RED, logging.getLevelName(logging.ERROR), TerminalColour.GREY))
logging.addLevelName(logging.CRITICAL, "{}{}{}".format(TerminalColour.MAGENTA, logging.getLevelName(logging.CRITICAL), .GREY)) 
```

请注意，您的日志格式化程序必须包含日志级别的名称

```
%(levelname) 
```

例如：

```
 LOGGING = {
...
        'verbose': {
            'format': '%(asctime)s %(levelname)s %(name)s:%(lineno)s %(module)s %(process)d %(thread)d %(message)s'
        },
        'simple': {
            'format': '[%(asctime)s] %(levelname)s %(name)s %(message)s'
        }, 
```

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2017-02-28T20:23:12.520

```
import logging

logging.basicConfig(filename="f.log" filemode='w', level=logging.INFO,
                    format = "%(logger_name)s %(color)s  %(message)s %(endColor)s")

class Logger(object):
    __GREEN = "\033[92m"
    __RED = '\033[91m'
    __ENDC = '\033[0m'

    def __init__(self, name):
        self.logger = logging.getLogger(name)
        self.extra={'logger_name': name, 'endColor': self.__ENDC, 'color': self.__GREEN}

    def info(self, msg):
        self.extra['color'] = self.__GREEN
        self.logger.info(msg, extra=self.extra)

    def error(self, msg):
        self.extra['color'] = self.__RED
        self.logger.error(msg, extra=self.extra) 
```

# 用法

`Logger("File Name").info("This shows green text")`

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2022-02-22T03:31:00.437

对于任何有同样需求的人，我推荐我自己的包[TCPrint](https://pypi.org/project/ctprint/)。它基于[Colorama](https://pypi.org/project/colorama/)（提供跨平台兼容性），但不像它使用熟悉`<tags>`的标记文本颜色并包含**用于记录的标签**

## 安装：

```
pip install ctprint 
```

## 染色：

```
from ctprint inport ctp, ctdecode, cterr, ctlog

# print colored text
ctp('<bw> black text on white background /> default formating') 
```

## 错误处理：

```
# print error message
try:
    1/0  # any broken line
except Exception as _ex:
    cterr(_ex) 
```

## 变量记录：

```
var0 = var1 = 0

# print varName-varValue pairs
def example_ctlog():

    var2 = 'string val'
    var3 = {'ctp_string': '<bg_red><red>red text on red background (NO) >'}

    # out of the function, var0=var2 - nothing problems.
    ctlog(var0=var0, var1=var1, var2=var2, var3=var3) 
```

## 和更多：

```
ctp.help() # print help dialog with all supported tags and functions 
```

除了记录功能和颜色标签外，还有用于标记用户输出的快速`<error>`标签`<log>`

如果您需要加快日志记录并提高终端的可读性（vscode/pycharm/cmd/bash 等），而不是自定义样式的命令行界面，或者，您知道该怎么做。[CTPrint](https://pypi.org/project/ctprint/) **是为第一个创建的**

# 运气！

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2015-02-01T18:16:55.297

使用[pyfancy](https://github.com/ilovecode1/pyfancy)。

例子：

```
print(pyfancy.RED + "Hello Red!" + pyfancy.END) 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2021-12-21T15:18:04.930

最简单的解决方案可能是**Colorama。**

将 Colorama 安装到您的计算机上：

```
pip install colorama 
```

然后将其添加到您的 Python 程序中：

```
import colorama
print(Fore.GREEN + "test123") 
```

如果你需要多颜色的东西，使用**YAChalk**。

将 YAChalk 安装到您的计算机上：

```
pip install yachalk 
```

将其添加到您的 Python 程序中：

```
from yachalk import chalk
print(chalk.blue("This is blue and {chalk.red("this is red")}) 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2017-07-29T22:05:58.060

只是另一种解决方案，使用 ZetaSyanthis 的颜色：

```
def config_log(log_level):

    def set_color(level, code):
        level_fmt = "\033[1;" + str(code) + "m%s\033[1;0m" 
        logging.addLevelName( level, level_fmt % logging.getLevelName(level) )

    std_stream = sys.stdout
    isatty = getattr(std_stream, 'isatty', None)
    if isatty and isatty():
        levels = [logging.DEBUG, logging.CRITICAL, logging.WARNING, logging.ERROR]
        for idx, level in enumerate(levels):
            set_color(level, 30 + idx )
        set_color(logging.DEBUG, 0)
    logging.basicConfig(stream=std_stream, level=log_level) 
```

`__main__`从您的函数中调用一次。我有这样的东西：

```
options, arguments = p.parse_args()
log_level = logging.DEBUG if options.verbose else logging.WARNING
config_log(log_level) 
```

它还验证输出是控制台，否则不使用颜色。

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2022-02-11T14:19:06.600

这与@Sergey Pleshakov 的出色答案略有不同，该答案仅将颜色应用于级别并按`basicConfig`预期使用：

```
class CustomFormatter(logging.Formatter):

    white = "\x1b[97;20m"
    grey = "\x1b[38;20m"
    green = "\x1b[32;20m"
    cyan = "\x1b[36;20m"
    yellow = "\x1b[33;20m"
    red = "\x1b[31;20m"
    bold_red = "\x1b[31;1m"
    reset = "\x1b[0m"
    fmt = "%(asctime)s - {}%(levelname)-8s{} - %(name)s.%(funcName)s - %(message)s"

    FORMATS = {
        logging.DEBUG: fmt.format(grey, reset),
        logging.INFO: fmt.format(green, reset),
        logging.WARNING: fmt.format(yellow, reset),
        logging.ERROR: fmt.format(red, reset),
        logging.CRITICAL: fmt.format(bold_red, reset),
    }

    def format(self, record):
        log_fmt = self.FORMATS.get(record.levelno)
        formatter = logging.Formatter(log_fmt, datefmt="%H:%M:%S")
        return formatter.format(record)

handler = logging.StreamHandler()
handler.setFormatter(CustomFormatter())
logging.basicConfig(
    level=logging.DEBUG,
    handlers=[handler]
) 
```

# entity-framework - 实体框架 - 我如何使用实体关联？

> ID：384078
> 
> 赞同：2
> 
> 时间：2008-12-21T04:01:01.893
> 
> 标签：entity-framework, linq-to-entities, entity-relationship, associations

当我的数据库中有具有 PK/FK 关系 (int) 的表时，并且当它们由实体框架设计器建模时，一切看起来都应该如此。我可以编写下面的代码，一切似乎也可以正常工作，但是当我运行代码时，我在 project.Status.StatusName 上收到错误，说对象引用未设置为对象的实例。我想我的印象是，当您填充父实体时，框架填充了关联实体。

```
 Dim db As New MyDbModel.MyDbEntities()

    Dim project As MyDbModel.Project = (From p In db.Project Where p.ProjectID = 1).First

    Response.Write(project.ProjectName)        
    Response.Write(project.Status.StatusName) 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-21T04:41:04.263

尝试使用 Include(RelationshipName)

```
Dim db As New MyDbModel.MyDbEntities()    
Dim project As MyDbModel.Project = (From p In db.Project.Include("Status") Where p.ProjectID = 1).First    
Response.Write(project.ProjectName)            
Response.Write(project.Status.StatusName) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T04:43:05.927

除非您告诉实体框架，否则实体框架不会加载相关实体。为了访问相关实体，您需要明确地 Load() 或使用 Include()。这是一个简短的示例。

[http://blogs.msdn.com/bethmassi/archive/2008/12/10/master-details-with-entity-framework-explicit-load.aspx](http://blogs.msdn.com/bethmassi/archive/2008/12/10/master-details-with-entity-framework-explicit-load.aspx)

# objective-c - 我应该如何将 int 传递给 stringWithFormat？

> ID：384089
> 
> 赞同：68
> 
> 时间：2008-12-21T04:20:48.093
> 
> 标签：objective-c, cocoa-touch

我尝试使用 stringWithFormat 在标签的文本属性上设置数值，但以下代码不起作用。我无法将 int 转换为 NSString。我期待该方法知道如何自动将 int 转换为 NSString。

我需要在这里做什么？

```
- (IBAction) increment: (id) sender
{
    int count = 1;
    label.text = [NSString stringWithFormat:@"%@", count];
} 
```

* * *

## 回答 #1

> 赞同：132
> 
> 时间：2008-12-21T04:23:52.457

做这个：

```
label.text = [NSString stringWithFormat:@"%d", count]; 
```

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2008-12-21T06:59:16.307

请记住，@"%d" 仅适用于 32 位。一旦你开始使用 NSInteger 来实现兼容性，如果你曾经为 64 位平台编译，你应该使用 @"%ld" 作为你的格式说明符。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2008-12-21T07:37:42.160

马克·夏博诺写道：

> 请记住，@"%d" 仅适用于 32 位。一旦你开始使用 NSInteger 来实现兼容性，如果你曾经为 64 位平台编译，你应该使用 @"%ld" 作为你的格式说明符。

有趣，感谢您的提示，我在我`NSInteger`的 s 中使用了 @"%d"！

SDK 文档还建议在这种情况下强制`NSInteger`转换为`long`（以匹配 @"%ld"），例如：

```
NSInteger i = 42;
label.text = [NSString stringWithFormat:@"%ld", (long)i]; 
```

来源：[Cocoa 字符串编程指南 - 字符串格式说明符](http://developer.apple.com/iphone/library/documentation/Cocoa/Conceptual/Strings/Articles/formatSpecifiers.html)（需要 iPhone 开发者注册）

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-12-21T04:30:20.260

您想使用`%d`or`%i`表示整数。`%@`用于对象。

不过，值得注意的是，以下代码将完成相同的任务并且更加清晰。

```
label.intValue = count; 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2008-12-21T07:03:44.677

对于喜剧价值：

```
label.text = [NSString stringWithFormat:@"%@", [NSNumber numberWithInt:count]]; 
```

（虽然如果有一天你正在处理 NSNumber 可能会很有用）

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2014-11-14T03:47:25.270

要保证 32 位和 64 位安全，请使用以下[盒装表达式](http://clang.llvm.org/docs/ObjectiveCLiterals.html#boxed-expressions)之一：

```
 label.text = [NSString stringWithFormat:@"%@", @(count).stringValue]; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-21T10:04:06.327

您发布的片段是否只是一个示例，以显示您正在尝试做什么？

我问的原因是您命名了一个方法`increment`，但您似乎使用它来设置文本标签的值，而不是增加一个值。

如果您尝试做一些更复杂的事情——比如设置一个整数值并让标签显示这个值，您可以考虑使用绑定。例如

您声明一个属性`count`，并且您的`increment`操作将此值设置为任何值，然后在 IB 中，您将标签的文本绑定到`count`. 只要您使用 遵循键值编码 (KVC) `count`，您就不必编写任何代码来更新标签的显示。从设计的角度来看，您的耦合更松散。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-08-07T00:17:28.923

不要忘记`long long int`：

```
long long int id = [obj.id longLongValue];
[NSString stringWithFormat:@"this is my id: %lld", id] 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-01-14T17:17:37.577

```
NSString * formattedname;
NSString * firstname;
NSString * middlename;
NSString * lastname;

firstname = @"My First Name";
middlename = @"My Middle Name";
lastname = @"My Last Name";

formattedname = [NSString stringWithFormat:@"My Full Name: %@ %@ %@", firstname, middlename, lastname];
NSLog(@"\n\nHere is the Formatted Name:\n%@\n\n", formattedname);

/*
Result:
Here is the Formatted Name:
My Full Name: My First Name My Middle Name My Last Name
*/ 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-01-30T11:12:57.860

```
label.text = [NSString stringWithFormat:@"%d", XYZ]; 

//result:   label.text = XYZ
//use %d for int values 
```

# java - Eclipse Java 格式化程序可以单独使用吗

> ID：384101
> 
> 赞同：19
> 
> 时间：2008-12-21T04:41:36.273
> 
> 标签：java, eclipse, formatter

有没有办法在eclipse之外使用eclipse附带的格式化程序？我想使用我使用 eclipse 配置的 formatter.xml 文件格式化一些 java 文件。有没有人有任何代码示例可以让我这样做？我也想单独使用这个，所以使用的特定罐子会很好。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-21T05:16:25.783

显然您可以[从命令行直接调用 Eclipse 的代码格式化程序](https://peterfriese.wordpress.com/2007/05/28/formatting-your-code-using-the-eclipse-code-formatter/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2018-07-30T13:41:51.690

这是有关如何执行此操作的[官方日食文档](https://help.eclipse.org/luna/index.jsp?topic=%2Forg.eclipse.jdt.doc.user%2Ftasks%2Ftasks-231.htm)

### 这些文档的转储：

运行格式化程序应用程序就像从命令行运行 org.eclipse.jdt.core.JavaCodeFormatter 应用程序一样简单：

```
eclipse -vm <path to virtual machine> -application org.eclipse.jdt.core.JavaCodeFormatter [ OPTIONS ] <files> 
```

在 MacOS 上调用时，指向配置文件或源文件的路径可以是相对的，但它们将根据 eclipse.ini 文件的位置计算。这是 Eclipse 启动器在 MacOS 上的限制。在所有其他平台上，相对路径是相对于当前用户目录计算的。

要格式化的 Java 源文件和/或目录。只有以 .java 结尾的文件才会在给定目录中格式化。

-配置

使用指定属性文件中的格式样式。有关详细信息，请参阅为格式化程序应用程序生成配置文件。

-帮助

显示帮助信息。

-安静的

只打印错误信息。

-详细

详细说明格式化工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T04:47:18.167

从来没有尝试过这样的事情，但我记得曾经看到过一个名为：

org.eclipse.jdt.core.formatter.CodeFormatterApplication

也许这是格式化机制的一些独立入口点，尽管我从未尝试或进一步调查过。

# git - 从 CVS 迁移到 Git：$Id$ 等价物？

> ID：384108
> 
> 赞同：128
> 
> 时间：2008-12-21T04:45:46.187
> 
> 标签：git, version-control, cvs, keyword-substitution

我阅读了一堆关于简单源代码控制工具的问题，Git 似乎是一个合理的选择。我已经启动并运行它，到目前为止它运行良好。我喜欢 CVS 的一个方面是版本号的自动递增。

我知道这在分布式存储库中意义不大，但作为开发人员，我想要/需要这样的东西。让我解释一下原因：

我使用 Emacs。我会定期检查并寻找第三方软件包的 Lisp 源文件的新版本。假设我有一个文件 foo.el，根据标题，它是 1.3 版；如果我查看最新版本并看到它是 1.143 或 2.6 或其他什么，我知道我已经远远落后了。

相反，如果我看到几个 40 个字符的散列，我将不知道哪个更晚，或者知道它晚了多少。如果我不得不手动检查 ChangeLogs 以了解我有多过时，我绝对会讨厌它。

作为一名开发人员，我想将这种礼貌，正如我所看到的，扩展到使用我的输出的人（也许我在开玩笑说任何人都是，但让我们暂时搁置一下）。我不想每次都记得自己增加该死的数字，或者时间戳或类似的东西。那是真正的 PITA，我从经验中知道这一点。

那么我有什么选择呢？如果我无法获得 $Id:$ 等价物，我还能如何提供我正在寻找的东西？

我应该提一下，我的期望是最终用户不会安装 Git，即使他们安装了，也不会拥有本地存储库（实际上，我希望不会以这种方式提供它）。

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2008-12-22T04:03:29.063

SHA 只是版本的一种表示（尽管是规范的）。该`git describe`命令提供了其他命令并且做得很好。

例如，当我`git describe`在我的[Java memcached 客户端](http://github.com/dustin/java-memcached-client)源的 master 分支中运行时，我得到这个：

```
2.2-16-gc0cd61a 
```

这说明了两个重要的事情：

1.  自 2.2 以来，这棵树中恰好有 16 次提交
2.  *确切的*源代码树可以显示在任何其他人的克隆上。

例如，假设您将一个`version`文件与源打包在一起（或者甚至重写所有内容以进行分发）以显示该数字。假设打包版本是`2.2-12-g6c4ae7a`（不是发行版，而是有效版本）。

您现在可以确切地看到您落后了多远（4 次提交），*并且*您可以准确地看到哪 4 次提交：

```
# The RHS of the .. can be origin/master or empty, or whatever you want.
% git log --pretty=format:"%h %an %s" 2.2-12-g6c4ae7a..2.2-16-gc0cd61a
c0cd61a Dustin Sallings More tries to get a timeout.
8c489ff Dustin Sallings Made the timeout test run on every protocol on every bui
fb326d5 Dustin Sallings Added a test for bug 35.
fba04e9 Valeri Felberg Support passing an expiration date into CAS operations. 
```

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2011-02-16T22:21:14.560

到目前为止，Git 中已经支持 $Id:$。要为文件*README*启用它，您可以将“README ident”放入*.gitattributes*。支持文件名上的通配符。有关详细信息，请参阅[man gitattributes](http://git-scm.com/docs/gitattributes)。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2012-08-04T09:38:10.240

这不是 OP 的不合理要求。

我的用例是：

1.  我将 Git 用于我自己的个人代码，因此不与他人合作。
2.  我将系统 Bash 脚本保存在那里，`/usr/local/bin`它们准备好后可能会进入。

我使用三台独立的机器，上面有相同的 Git 存储库。`/usr/local/bin`无需手动执行“diff -u <repo version> <version in /usr/local/bin>”即可知道我当前拥有的文件的“版本”会很高兴。

对于那些消极的人，请记住还有其他用例。不是每个人都使用 Git 进行协作，将 Git 存储库中的文件作为他们的“最终”位置。

无论如何，我这样做的方式是在存储库中创建一个属性文件，如下所示：

```
cat .git/info/attributes
# see man gitattributes
*.sh ident
*.pl ident
*.cgi ident 
```

然后将 $Id$ 放在文件中的某个位置（我喜欢把它放在 shebang 之后）。

提交。请注意，这不会像我预期的那样自动进行扩展。您必须重新合作文件，例如，

```
git commit foo.sh
rm foo.sh
git co foo.sh 
```

然后你会看到扩展，例如：

```
$ head foo.sh
#!/bin/sh

# $Id: e184834e6757aac77fd0f71344934b1cd774e6d4 $ 
```

*[如何为 Git 存储库启用 ident 字符串](https://stackoverflow.com/questions/1792838/enable-ident-string-for-git-repos)*？.

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2008-12-21T04:54:49.507

不确定这是否会出现在 Git 中。[引用 Linus 的](http://www.gelato.unsw.edu.au/archives/git/0610/28891.html)话：

> “关键字替换的整个概念完全是愚蠢的。如果您想在将发布树作为 tar-ball 等时使用它，那么在实际内容跟踪之外进行“外部”是微不足道的。”

不过，检查日志非常容易——如果您正在跟踪 foo.el 的稳定分支，您可以看到稳定分支的日志中有哪些新提交不在您的本地副本中。如果要模拟 CVS 的内部版本号，可以比较最后一次提交的时间戳。

编辑：您应该为此编写或使用其他人的脚本，当然，不要手动执行此操作。

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2008-12-21T16:37:14.630

正如我之前写[的](https://stackoverflow.com/questions/343721/bazaar-and-id#343797)：

> 使用 Bazaar 等 DSCM 工具自动生成显示合理版本号的 Id 标签是不可能的，因为每个人的开发线都可能与其他人不同。因此，有人可能会引用文件的“1.41”版本，但该文件的“1.41”版本是不同的。
> 
> 基本上，$Id$ 对 Bazaar、Git 和其他分布式源代码管理工具没有任何意义。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2012-11-12T23:25:24.637

我有同样的问题。我需要一个比哈希字符串更简单的版本，并且可供使用该工具的人使用，而无需连接到存储库。

我使用 Git 预提交钩子完成了它，并更改了我的脚本以能够自动更新自身。

我根据完成的提交数量来确定版本。这是一个轻微的竞争条件，因为两个人可以同时提交并且都认为他们提交的是相同的版本号，但是我们在这个项目上没有很多开发人员。

举个例子，我有一个我签入的 Ruby 脚本，我将这段代码添加到其中 - 这是非常简单的代码，因此如果您要签入不同语言的内容，很容易移植到不同的语言（尽管显然这不会轻易使用不可运行的签入，例如文本文件）。我已经添加：

```
MYVERSION = '1.090'
## Call script to do updateVersion from .git/hooks/pre-commit
def updateVersion
  # We add 1 because the next commit is probably one more - though this is a race
  commits = %x[git log #{$0} | grep '^commit ' | wc -l].to_i + 1
  vers = "1.%0.3d" % commits

  t = File.read($0)
  t.gsub!(/^MYVERSION = '(.*)'$/, "MYVERSION = '#{vers}'")
  bak = $0+'.bak'
  File.open(bak,'w') { |f| f.puts t }
  perm = File.stat($0).mode & 0xfff
  File.rename(bak,$0)
  File.chmod(perm,$0)
  exit
end 
```

然后我在脚本中添加了一个命令行选项（-updateVersion），所以如果我将它称为“工具-updateVersion”，那么它只会为修改“MYVERSION”值的工具调用updateVersion，然后退出（你可以如果您愿意，它还可以更新其他文件（如果它们也被打开）。

设置完成后，我转到 Git 头并在`.git/hooks/pre-commit`.

该脚本只是更改为 Git 目录的头部，并使用`-updateVersion`.

每次我签入 pre-commit 脚本时都会运行它，它使用 -updateVersion 运行我的脚本，然后根据提交的数量更新 MYVERSION 变量。魔法！

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2008-12-21T10:18:25.033

使用 Git 存储库所做的事情是使用该`tag`对象。这可用于使用任何类型的字符串标记提交，并可用于标记版本。您可以使用`git tag`返回所有标签的命令查看存储库中的标签。

签出标签很容易。例如，如果有标签`v1.1`，您可以像这样将该标签签出到分支：

```
git checkout -b v1.1 
```

由于它是顶级对象，您将看到该提交的整个历史记录，并且能够运行差异、进行更改和合并。

不仅如此，标签仍然存在，即使它所在的分支已被删除而没有合并回主线。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-12-21T10:35:42.020

如果 $Keywords$ 对您来说是必不可少的，那么也许您可以尝试使用[Mercurial](http://selenic.com/wiki/Mercurial)？它有一个 hgkeyword 扩展来实现你想要的。Mercurial 作为 DVCS 还是很有趣的。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2018-08-17T10:40:54.433

要将扩展应用于存储库中所有子目录中的所有文件，请将`.gitattributes`文件添加到存储库的顶级目录（即通常放置`.gitignore`文件的位置），其中包含：

```
* ident 
```

要真正看到这一点，您需要先对文件进行有效的签出，例如以任何方式删除或编辑它们。然后使用以下命令恢复它们：

```
git checkout . 
```

你应该看到`$Id$`替换为：

```
$Id: ea701b0bb744c90c620f315e2438bc6b764cdb87 $ 
```

来自`man gitattributes`：

> 识别
> 
> 当为路径设置属性 ident 时，Git 将 blob 对象中的 $Id$ 替换为 $Id:，后跟 40 个字符的十六进制 blob 对象名称，然后是结帐时的美元符号 $。在签入时，工作树文件中任何以 $Id: 开头并以 $ 结尾的字节序列都将替换为 $Id$。

每次提交文件的新版本时，此 ID 都会更改。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-12-21T06:14:06.413

如果我理解正确，本质上，您想知道自上次更新以来给定文件发生了多少次提交。

首先获取远程源中的更改，但不要将它们合并到您的`master`分支中：

```
% git fetch 
```

`master`然后获取您的分支和远程之间给定文件上发生的更改的日志`origin/master`。

```
% git log master..origin/master foo.el 
```

这为您提供了自上次合并`origin/master`到您的`master`.

如果您只想计算更改的数量，请将其通过管道传输到`wc`. 说，像这样：

```
% git rev-list master..origin/master foo.el | wc -l 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-12-21T06:33:20.043

如果您只是希望人们能够了解他们已经过时了多长时间，Git 可以通过几种相当简单的方式告知他们这一点。例如，他们比较他们的主干和你的主干上最后一次提交的日期。他们可以[`git cherry`](https://git-scm.com/docs/git-cherry)用来查看您的主干中发生了多少不存在于他们的主干中的提交。

如果这就是您想要的全部，我会寻找一种没有版本号的方法来提供它。

另外，除非您确定他们想要，否则我不会费心向任何人提供礼貌。:)

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-01-11T10:40:10.293

RCS ID 非常适合单文件项目，但对于其他任何项目，$Id$ 都没有说明该项目（除非您强制虚拟签入到虚拟版本文件）。

仍然有人可能对如何在每个文件级别或提交级别上获取 $Author$、$Date$、$Revision$、$RCSfile$ 等等价物感兴趣（如何将它们放在某些关键字所在的位置是另一回事问题）。我对这些没有答案，但看到更新这些的要求，特别是当文件（现在在 Git 中）来自 RCS 兼容系统 (CVS) 时。

如果源代码与任何 Git 存储库分开分发（我也是这样做的），那么这些关键字可能会很有趣。我的解决方案是这样的：

每个项目都有自己的目录，在项目根目录中我有一个文本文件`.version`，其内容描述当前版本（导出源时将使用的名称）。

在为下一个版本工作时，一个脚本会提取该编号`.version`、一些 Git 版本描述符（`git describe`如`.build`从什么来源以及何时构建的。

我在单独的分支中开发新功能，我做的第一件事是将`n`（用于“下一个”）添加到`.version`字符串（源自同一根的多个分支将使用相同的临时`.version`编号）。在发布之前，我决定合并哪些分支（希望所有分支都具有相同的`.version`）。在提交合并之前，我更新`.version`到下一个数字（主要或次要更新，取决于合并的功能）。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2019-06-10T23:08:31.853

如果您希望 git 提交信息**可以访问**到您的代码中，那么您**必须**执行预构建步骤才能将其获取。在 C/C++ 的 bash 中，它可能看起来像这样：

`prebuild.sh`

```
#!/bin/bash
commit=$(git rev-parse HEAD)
tag=$(git describe --tags --always ${commit})
cat <<EOF >version.c
#include "version.h"
const char* git_tag="${tag}";
const char* git_commit="${commit}";
EOF 
```

`version.h`看起来像：

```
#pragma once
const char* git_tag;
const char* git_commit; 
```

然后，在您的代码`#include "version.h"`和参考中需要它的任何地方`git_tag`或`git_commit`根据需要。

你`Makefile`可能有这样的事情：

```
all: package
version:
  ./prebuild.sh
package: version
  # the normal build stuff for your project 
```

这有以下好处：

*   无论分支、合并樱桃采摘等如何，都可以获得**此**构建的**当前**正确值。

 **这种实现`prepublish.sh`有以下缺点：

*   即使`git_tag`/`git_commit`没有改变，也强制重新编译。
*   它不考虑尚未提交但影响构建的本地修改文件。
    *   用于`git describe --tags --always --dirty`捕获该用例。
*   污染全局命名空间。

`prebuild.sh`可以避免这些问题的鸽友留给读者作为练习。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-08-10T21:17:40.157

我同意那些认为令牌替换属于构建工具而不是版本控制工具的人。

您应该有一些自动发布工具来在标记发布时在源中设置版本 ID。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-04-04T02:00:03.897

标记名称和其他相关信息现在可以直接由 Git`export-subst`通过`gitattributes(5)`. 这当然需要使用`git archive`来创建版本，并且只有在生成的 tar 文件中才能看到替换编辑。

例如在`.gitattributes`文件中放入以下行：

```
* export-subst 
```

然后在源文件中，您可以添加如下一行：

```
#ident  "@(#)PROJECTNAME:FILENAME:$Format:%D:%ci:%cN:%h$" 
```

并且它将在由以下人员创建的版本中扩展为如下所示`git archive v1.2.0.90`：

```
#ident  "@(#)PROJECTNAME:FILENAME:HEAD -> master, tag: v1.2.0.90:2020-04-03 18:40:44 -0700:Greg A. Woods:e48f949" 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-26T18:17:31.687

由于您使用 Emacs，您可能会很幸运 :)

我碰巧遇到了这个问题，而且几天前我偶然发现了[Lively ，这是一个 Emacs 包，它允许在您的文档中包含生动的 Emacs Lisp 片段。](http://groups.google.com/group/gnu.emacs.sources/browse_thread/thread/951b748de9985a8d)老实说，我没有尝试过，但是当我读到这篇文章时，我想到了它。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-02-13T04:57:48.787

我也来自 SCCS、RCS 和 CVS ( `%W% %G% %U%`)。

我也有类似的挑战。我想知道一段代码在运行它的任何系统上的版本。该系统可能连接或可能不连接到任何网络。系统可能安装了也可能没有安装 Git。系统可能安装了也可能没有安装 GitHub 存储库。

对于几种类型的代码（.sh、.go、.yml、.xml 等），我想要相同的解决方案。我希望任何不了解 Git 或 GitHub 的人都能够回答*“你在运行什么版本？”这个问题。*

所以，我写了一些我称之为包装器的 Git 命令。我用它来标记带有版本号和一些信息的文件。它解决了我的挑战。它可能会帮助你。

[https://github.com/BradleyA/markit](https://github.com/BradleyA/markit)

```
git clone https://github.com/BradleyA/markit
cd markit 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2019-12-05T16:35:33.433

为了自己解决这个问题，我创建了一个小的“hack”作为 post-commit 钩子：

```
echo | tee --append *
git checkout * 
```

更详细地记录在[我博客上的这篇文章中](https://public-technical-articles.blogspot.com/2019/12/hooking-git-to-update-blob-id-id-on.html)。

# c++ - 适用于 Windows Mobile 6 SDK 的智能指针

> ID：384110
> 
> 赞同：2
> 
> 时间：2008-12-21T04:48:45.183
> 
> 标签：c++, windows-mobile, windows-ce, smart-pointers

我无法为我的 WinMobile 项目获取 std::tr1::shared_ptr，因为 WinCE 的 STL 由 Microsoft 的另一个团队维护:( aarrgh ...

有人使用过另一个线程安全的引用计数智能指针吗？我实际上正在使用看起来不错的 yasper。

非常感谢你。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T17:41:43.377

我还推荐 boost::shared_ptr。您可以像我为库所做的那样，使用 #define 在 std::tr1::shared_ptr 和 boost::shared_ptr 之间切换，具体取决于编译器的功能。这样，如果/当 CE 团队添加 tr1 支持时，您的代码就不需要修改 [太多]。只是我的2c。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T04:56:21.843

[提升智能指针](http://www.boost.org/doc/libs/1_37_0/libs/smart_ptr/smart_ptr.htm)。特别是[boost::shared_ptr](http://www.boost.org/doc/libs/1_37_0/libs/smart_ptr/shared_ptr.htm)。我很确定您的平台支持它们。这就是 tr1::shared_ptr 的来源。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T16:38:23.707

你看过[STLPort](http://stlport.sourceforge.net/)或[Dinkum TR1 库](http://www.dinkumware.com/tr1.aspx)吗？两者都有一个更完整的 CE 端口。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T05:09:57.107

yasper::ptr 似乎类似于 Boost Smart Pointers，虽然 shared_ptr 当然有更多的功能。

在稀缺的 yasper::ptr 文档中，出现了一个指针分配的示例：

```
 //preferred  
ptr<SomeClass> p1(new SomeClass);

 //less safe  
ptr<SomeClass> p2 = new SomeClass; 
```

为什么第二个 from 会“不那么安全”？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T17:29:41.653

是的，我正在考虑使用 shared_ptr，但是 Visual C++ 2008 在 std::tr1 下没有它用于 WinCE 构建，所以我可以看看那些替代品，谢谢。我对 yasper::ptr 很满意，但我怀疑它是线程安全的。

# iphone - 如何从 CALayer 中删除内容？

> ID：384111
> 
> 赞同：0
> 
> 时间：2008-12-21T04:54:24.330
> 
> 标签：iphone, cocoa-touch

我有`CALayer`一些图像内容。当一个按钮被触摸时，我想从图层中删除内容，我使用以下代码：

```
[m_aCellLayer setContents:nil] 
```

但是`EXC_BAD_ACCESS`在执行上述行时出现异常。你知道为什么吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T05:30:26.800

只是显而易见的东西：当您进行此调用时，m_aCellLayer 是否有效，或者它是否已被释放？您是否在拨打电话之前尝试过 NSLog() ？

# .net - .NET SMTPClient - 待发邮件存储在哪里？

> ID：384119
> 
> 赞同：4
> 
> 时间：2008-12-21T05:11:56.867
> 
> 标签：.net, smtpclient, outgoing-mail

如果我已将一些电子邮件排队等待通过 System.Net.Mail.SMTPClent 发送，我在哪里可以找到这封邮件？对于 Windows SMTP 客户端，它位于 C:\inetpub\mailroot 文件夹中 - .NET 客户端是否有类似的文件夹？

编辑：这是一个例子。如果我关闭 XP 计算机上的传出 SMTP 服务器，然后运行一个发送十多封电子邮件的应用程序，它们会在某个地方排队，因为 .NET SMTPClient.Send 调用成功。几个小时后，我启动了本地 SMTP 服务器，邮件突然飞快地离开了。期间在哪里？同样的行为发生在我的 Vista 桌面上，虽然我没有本地 SMTP 服务器——我可以通过在防火墙上阻止端口 25 来复制该功能，然后邮件在某处排队。在哪里？

这个问题的原因是我想在我拥有的服务器上重新启用 SMTP 服务，但我不知道在此期间排队的是什么，我想确保当我重新时队列是干净的 -启用服务。这样一来，客户就不会突然收到非常非常旧的排队电子邮件。

**编辑**：显然，我不知道我在说什么。当我在 Vista 上执行此操作时：

```
 Dim mm As New System.Net.Mail.MailMessage("me@me.com", "you@you.com", "Testing", "this is a test")

    Dim s As New System.Net.Mail.SmtpClient("localhost")
    s.DeliveryMethod = Mail.SmtpDeliveryMethod.PickupDirectoryFromIis
    s.Send(mm) 
```

我得到一个例外，因为我没有 IIS 拾取文件夹。将其更改为“Mail.SmtpDeliveryMethod.Network”会立即导致异常，因为我没有运行 SMTP 服务器。我将在服务器 2003 上对此进行测试，但我可以发誓这两者在过去都有效。如果需要，我将进行更多测试并修改问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T05:19:34.077

从 SmtpClient 的 MSDN 页面的外观来看，它是可配置的。您可以使用[DeliveryMethod](http://msdn.microsoft.com/en-us/library/system.net.mail.smtpclient.deliverymethod.aspx)属性来决定是否立即发送邮件，是否将其排入 IIS 分拣文件夹（可能是 C:\inetpub\mailroot），或者是否将其放置在您选择的文件夹中（由[PickupDirectoryLocation](http://msdn.microsoft.com/en-us/library/system.net.mail.smtpclient.pickupdirectorylocation.aspx)属性指定）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-30T06:12:13.077

描述有点模糊，但是如果您调用`Send()`并且您的`DeliveryMethod`is`Network`并且调用成功，那么它不再属于 .NET 领域。*某物*已接受它进行投递，它正坐在某物的队列中，当您打开可以与外部世界重新连接的邮件服务器时，它会高兴地跳起来。When `DeliveryMethod`is `Network`，我很确定（至少，从 Reflector 反汇编来看）它直接在网络流上涂鸦，而不是通过一些中间临时文件。如果它无法打开连接并获取该流，那么它会出现异常呕吐。这与我使用这个类的实际经验不谋而合。希望有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-30T04:35:19.433

默认情况下，SMTP 客户端使用网络发送。所以没有电子邮件存储在任何地方。

这是 web.config 的配置部分

```
 <mailSettings>
        <!--
            <smtp
                deliveryMethod = "Network" [Network | SpecifiedPickupDirectory | PickupDirectoryFromIis]
                from = "" [String]
                >
                <network
                    defaultCredentials = "false" [true|false]
                    host = "" [String]
                    password = "" [String]
                    port = "25" [number]
                    userName = "" [String]
                />
                <specifiedPickupDirectory
                    pickupDirectoryLocation = "" [String]
                />
            </smtp>
        -->
        <smtp deliveryMethod="Network">
            <network defaultCredentials="false" port="25" />
        </smtp>
    </mailSettings> 
```

您可以查看代码项目中的[这篇文章](http://www.codeproject.com/KB/IP/smtpclientext.aspx)，该文章展示了如何手动处理 SMTP 客户端创建的文件`DeliveryMethod == SmtpDeliveryMethod.SpecifiedPickupDirectory`。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-30T14:53:03.273

您可以设置指定的取货目录和送货方式以获得更好的控制

```
<system.net>
    <mailSettings>
        <smtp deliveryMethod="SpecifiedPickupDirectory">
            <specifiedPickupDirectory pickupDirectoryLocation="c:\Temp\" />
        </smtp>
    </mailSettings>
</sysetm.net> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-30T04:18:04.990

我习惯使用的 .NET SMTP 客户端不会在任何地方存储邮件。它只是发送。如果它应该通过的出站服务器已关闭，它会立即给出异常。

您已经尝试在 XP 机器上打开和关闭出站服务器。伟大的。现在，尝试查找入站 SMTP 服务。入站和出站 SMTP 服务通过 filedrop 相互通信。

# c - 在 C 中创建模块系统（动态加载）

> ID：384121
> 
> 赞同：43
> 
> 时间：2008-12-21T05:12:12.983
> 
> 标签：c, frameworks, module

如何在运行时加载已编译的 C 代码，然后在其中调用函数？不像简单地调用 exec()。

编辑：加载模块的程序在 C 中。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-12-21T10:53:15.557

dlopen 是要走的路。这里有一些例子：

使用 dlopen 加载插件：

```
#include <dlfcn.h>
...
int
main (const int argc, const char *argv[])
{

  char *plugin_name;
  char file_name[80];
  void *plugin;
  ...
  plugin = dlopen(file_name, RTLD_NOW);
  if (!plugin)
  {
     fatal("Cannot load %s: %s", plugin_name, dlerror ());
  } 
```

编译上述内容：

```
% cc  -ldl -o program program.o 
```

然后，假设插件的这个 API：

```
/* The functions we will find in the plugin */
typedef void (*init_f) ();
init_f init;
typedef int (*query_f) ();
query_f query; 
```

在插件中查找init()的地址：

```
init = dlsym(plugin, "init");
result = dlerror();
if (result)
{
   fatal("Cannot find init in %s: %s", plugin_name, result);
}
init(); 
```

使用另一个函数 query()，它返回一个值：

```
query = dlsym (plugin, "query");
result = dlerror();
if (result)
{
    fatal("Cannot find query in %s: %s", plugin_name, result);
}
printf("Result of plugin %s is %d\n", plugin_name, query ()); 
```

[您可以在线](http://www.bortzmeyer.org/files/dlopen.tar.gz)检索完整的示例。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-12-21T05:23:51.803

在 Linux / UNIX 中，您可以使用 POSIX `dlopen`//函数来动态打开共享库并访问它们提供的符号（包括函数），详细信息请参见[手册页](http://linux.die.net/man/3/dlopen)。`dlsym``dlerror``dlclose`

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-21T14:45:26.337

看到这个问题已经得到回答，但认为对这个主题感兴趣的其他人可能会欣赏一个基于旧插件的应用程序的跨平台示例。该示例适用于 win32 或 linux，并在文件参数中指定的动态加载的 .so 或 .dll 中搜索并调用名为“constructor”的函数。该示例在 c++ 中，但过程应该与 c 相同。

```
//firstly the includes
#if !defined WIN32
   #include <dlfcn.h>
   #include <sys/types.h>
#else
   #include <windows.h>
#endif

//define the plugin's constructor function type named PConst
typedef tcnplugin* (*PConst)(tcnplugin*,tcnplugin*,HANDLE);

//loads a single specified tcnplugin,allmychildren[0] = null plugin
int tcnplugin::loadplugin(char *file) {
    tcnplugin *hpi;
#if defined WIN32               //Load library windows style
    HINSTANCE hplugin=LoadLibrary(file);
    if (hplugin != NULL) {
            PConst pinconstruct = (PConst)GetProcAddress(hplugin,"construct");
#else                                   //Load it nix style
    void * hplugin=dlopen(file,RTLD_NOW);
    if (hplugin != NULL) {
            PConst pinconstruct = (PConst)dlsym(hplugin,"construct");
#endif   
            if (pinconstruct != NULL) { //Try to call constructor function in dynamically loaded file, which returns a pointer to an instance of the plugin's class
                    hpi = pinconstruct(this, this, hstdout);
            } else {
                    piprintf("Cannot find constructor export in plugin!\n");
                    return 0;
            }
    } else {
            piprintf("Cannot open plugin!\n");
#if !defined WIN32
            perror(dlerror());
#endif
            return 0;
    }
    return addchild(hpi); //add pointer to plugin's class to our list of plugins
} 
```

还可能会提到，如果您要调用的函数的模块是用 c++ 编写的，则必须使用 extern "C" 声明该函数，例如：

```
extern "C" pcparport * construct(tcnplugin *tcnptr,tcnplugin *parent) {
    return new pcparport(tcnptr,parent,"PCPARPORT",0,1);
} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2017-09-10T14:02:54.367

### 对于 GNU/Linux 用户

动态加载库是一种机制，我们可以使用它运行我们的程序，并在运行时决定我们要使用/调用什么函数。我认为在某些情况下`static`变量也是可能的。

首先开始看`man 3 dlopen`或[在线看](http://man7.org/linux/man-pages/man3/dlopen.3.html)

所需的头文件是：`dlfcn`并且由于这不是标准的一部分，因此您**应该**使用此库将其链接到您的目标文件：`libdl.(so/a)`因此您需要以下内容：

```
gcc yours.c -ldl 
```

然后你有一个文件名`a.out`，你可以运行它，**但**它不能正常工作，我会解释为什么。

* * *

**一个完整的例子：**

第一个箱子 2 个文件`func1.c`和`func2.c`分别。我们想在运行时调用这些函数。

**函数c**

```
int func1(){
    return 1;
} 
```

**函数2.c**

```
const char* func2(){
    return "upgrading to version 2";
} 
```

现在我们有 2 个函数，让我们制作我们的模块：

```
ALP ❱ gcc -c -fPIC func1.c
ALP ❱ gcc -c -fPIC func2.c
ALP ❱ gcc -o libfunc.so -shared -fPIC func1.o func2.o 
```

询问`-fPIC`=> [PIC](https://en.wikipedia.org/wiki/Position-independent_code)

现在你有了一个`dynamic library`名字：`libfunc.so`

`temp.c`让我们创建想要使用这些功能的主程序 (= )。

**头文件**

```
#include <stdio.h>
#include <stdlib.h>
#include <dlfcn.h> 
```

**和主程序**

```
int main()
{
    // pointer function to func1 and func2
    int         ( *f1ptr )();
    const char* ( *f2ptr )();

    // for pointing to the library
    void* handle = NULL;

    // for saving the error messages
    const char* error_message = NULL;

    // on error dlopen returns NULL
    handle = dlopen( "libfunc.so", RTLD_LAZY );

    // check for error, if it is NULL
    if( !handle )
    {
        fprintf( stderr, "dlopen() %s\n", dlerror() );
        exit( 1 );
    }

    /*
        according to the header file:

        When any of the above functions fails, call this function
        to return a string describing the error.  Each call resets
        the error string so that a following call returns null.

        extern char *dlerror (void) __THROW;
    */

    // So, reset the error string, of course we no need to do it just for sure
    dlerror();

    // point to func1
    f1ptr = (int (*)()) dlsym( handle, "func1" );

    // store the error message to error_message
    // because it is reseted if we use it directly
    error_message = dlerror();
    if( error_message ) //   it means if it is not null
    {
        fprintf( stderr, "dlsym() for func1 %s\n", error_message );
        dlclose( handle );
        exit( 1 );
    }

    // point the func2
    f2ptr = (const char* (*)()) dlsym( handle, "func2" );

    // store the error message to error_message
    // because it is reseted if we use it directly
    error_message = dlerror();
    if( error_message ) //   it means if it is not null
    {
        fprintf( stderr, "dlsym() for func2 %s\n", error_message );
        dlclose( handle );
        exit( 1 );
    }

    printf( "func1: %d\n", ( *f1ptr )() );
    printf( "func2: %s\n", ( *f2ptr )() );

    // unload the library
    dlclose( handle );

    // the main return value
    return 0;
} 
```

现在我们只需要编译这段代码（= `temp.c`），因此尝试：

```
ALP ❱ gcc temp.c -ldl
ALP ❱ ./a.out
libfunc.so: cannot open shared object file: No such file or directory 
```

这没用！**为什么**容易；因为我们的`a.out`程序不知道在哪里可以找到相关的库：`libfunc.so`因此它告诉我们`cannot not open ...`

**如何告诉程序（= `a.out`）找到它的库？**

1.  使用`ld`链接器
2.  使用环境变量`LD_LIBRARY_PATH`
3.  使用标准路径

**第一种方式，借助`ld`**

使用`-Wl,-rpath,`and`pwd`并将路径作为它的参数

```
ALP ❱ gcc temp.c -ldl
ALP ❱ ./a.out
libfunc.so: cannot open shared object file: No such file or directory
ALP ❱ pwd
/home/shu/codeblock/ALP
ALP ❱ gcc temp.c -ldl -Wl,-rpath,/home/shu/codeblock/ALP
ALP ❱ ./a.out
func1: 1
func2: upgrading to version 2 
```

**第二种方式**

```
ALP ❱ gcc temp.c -ldl
ALP ❱ ./a.out
libfunc.so: cannot open shared object file: No such file or direc
ALP ❱ export LD_LIBRARY_PATH=$PWD
ALP ❱ echo $LD_LIBRARY_PATH
/home/shu/codeblock/ALP
ALP ❱ ./a.out
func1: 1
func2: upgrading to version 2
ALP ❱ export LD_LIBRARY_PATH=
ALP ❱ ./a.out
libfunc.so: cannot open shared object file: No such file or 
```

**第三种方式**

您`libfunc.so`在当前路径中有，因此您可以将其复制到库的标准路径中。

```
ALP $ sudo cp libfunc.so /usr/lib
ALP ❱ gcc temp.c -ldl
ALP ❱ ./a.out
func1: 1
func2: upgrading to version 2 
```

您可以从中删除`/usr/lib`并使用它。它是由你决定。

**笔记**

如何找出我们`a.out`知道它的路径？
简单的：

```
ALP ❱ gcc temp.c -ldl -Wl,-rpath,/home/shu/codeblock/ALP
ALP ❱ strings a.out  | grep \/
/lib/ld-linux.so.2
/home/shu/codeblock/ALP 
```

我们如何在[C++](/questions/tagged/c%2b%2b "显示标记为“c++”的问题")中使用它？
只要我知道你不能因为`g++`破坏函数名称而`gcc`你应该使用：`extern "C" int func1();`例如。

有关更多详细信息，请参阅手册页和 Linux 编程书籍。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-22T19:17:11.373

你也可以看看[cpluff](http://www.c-pluff.org)。它是纯 c 上的插件管理库。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-03-04T18:03:10.290

如果您愿意考虑该框架，Qt 提供了 QPluginLoader：[Qt 5 文档](http://doc.qt.io/qt-5/qpluginloader.html)（或者对于旧的 Qt 4.8 文档，请参见[此处](http://qt-project.org/doc/qt-4.8/qpluginloader.html)）

如果您需要/想要更细粒度的控制，Qt 还提供了一种使用 QLibrary 动态加载库的方法：[Qt 5 文档](http://doc.qt.io/qt-5/qlibrary.html)（或旧的 Qt 4.8 文档，请参见[此处](http://qt-project.org/doc/qt-4.8/qlibrary.html)）

更好的是，它们可以跨平台移植。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-21T05:27:40.923

像 Perl 这样的动态语言一直都在这样做。Perl 解释器是用 C 编写的，许多 Perl 模块部分是用 C 编写的。当需要这些模块时，编译后的 C 组件会动态加载。如另一个答案中所述，存储这些模块的机制是 Windows 上的 DLL，以及 UNIX 上的共享库（.so 文件）。我相信在 UNIX 上加载共享库的调用是 dlopen()。从该调用的文档开始，您可能会找到有关如何在 UNIX 上完成此操作的指针。对于 Windows，您需要研究 DLL 并了解如何在运行时动态加载它们。[或者可能通过 Cygwin UNIX 仿真层，这可能允许您在 Windows 上使用与在 UNIX 上相同的调用，但我不建议您这样做，除非您

请注意，这与仅链接共享库不同。如果您提前知道您将调用什么代码，您可以针对共享库进行构建，并且构建将“动态链接”到该库；无需您进行任何特殊处理，仅当您的程序实际调用它们时，库中的例程才会加载到内存中。但是，如果您打算编写能够加载**任意**目标代码的东西，您现在无法在构建时识别代码，而是在运行时等待以某种方式被选中，那么您就不能这样做。为此，您必须使用 dlopen() 及其 Windows 表亲。

您可能会查看 Perl 或其他动态语言执行此操作的方式以查看一些真实示例。负责这种动态加载的 Perl 库是 DynaLoader；我相信它同时具有 Perl 和 C 组件。我敢肯定，像 Python 这样的其他动态语言也有类似的东西，你可能会喜欢看；Parrot，未发布的 Perl 6 的虚拟机，肯定也有这样做的机制（或者将来会这样做）。

就此而言，Java 通过其 JNI（Java 本机接口）接口实现了这一点，因此您可能可以查看 OpenJDK 的源代码以了解 Java 如何在 UNIX 和 Windows 上实现这一点。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-21T05:26:53.717

有一种DIY方法。虽然执行此操作的方法（和可能性）因系统而异，但总体思路是打开一个文件，将文件的内容读入内存，使所述内存可执行，初始化一个指向该内存中有效位置的函数指针，你就在那里。

当然，这是假设它只是可执行代码 - 不太可能。该代码可能也需要将数据加载到 RAM 中，并且可能需要用于全局/静态变量的空间。您可以自己加载这一切，但您需要进入可执行代码并调整其中的所有内存引用。

大多数操作系统都允许动态链接，它可以为您完成所有这些工作。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-31T17:46:08.180

在 Windows 下，我是这样做的：

*   生成代码（在 C 中，因为它很容易找到编译器，并且库要求最低）
*   生成一个作业以将其编译/链接到 DLL
*   用 LoadLibrary 加载它
*   使用 GetProcAddress 获取函数指针

生成/编译/链接步骤通常需要不到一秒钟的时间。

# editor - 文本插入的术语“插入符号”是如何演变的？

> ID：384124
> 
> 赞同：5
> 
> 时间：2008-12-21T05:17:37.637
> 
> 标签：editor, history, caret

文本插入点的术语“插入符号”从何而来？我试图用谷歌搜索它，但这很难找到（甚至我的历史计算机参考书似乎也没有帮助）。

我有理由确定我记得一些使用文字插入符号（即：^）作为文本插入标记的古老 Wang/大型机应用程序，但我一生都记不起一个。

```
This is an example using the caret as an insertion point^ 
```

是的，我知道我可以通过直接谷歌搜索找到插入符号的含义，但我在这里寻找一个真正的词源 - 即：使用带有真实的实时插入符号作为文本插入的文本编辑器系统的人观点。这类东西对我来说很有趣——比如鼠标指针使用术语“bug”的起源。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-21T05:28:43.153

它来自笔和纸文本编辑，其中 ^ 标记用于指示插入的文本。该商标是根据​​其他人指出的拉丁文派生来为其目的命名的。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-21T05:22:16.537

来自[维基百科](http://en.wikipedia.org/wiki/Caret)“这个词来自拉丁文插入符号，“它缺乏”，来自“carēre”，缺乏；” 你用它来标记错别字以显示在哪里插入更正

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T06:27:05.873

> 这个术语来自使用插入符号作为文本插入指示符的旧 Unix 系统

来自：[http://en.wikipedia.org/wiki/Cursor_(computers)](http://en.wikipedia.org/wiki/Cursor_(computers))

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T05:21:40.903

[维基百科](http://en.wikipedia.org/wiki/Caret)说：

> ...来自拉丁文插入符号，“缺少”，来自 'carēre'，缺少；分开；从...中解脱出来

# entity-framework - 实体框架 - 如何在我的扩展类中使用实体关系？

> ID：384138
> 
> 赞同：1
> 
> 时间：2008-12-21T05:29:49.267
> 
> 标签：entity-framework, linq-to-entities, entity-relationship, partial-classes

我正在尝试扩展实体框架创建的部分类，以便我可以更轻松地使用下面代码中的对象（请让我知道是否有更好或更例外的方式来使用实体框架执行此操作）

```
 Public Sub New(ByVal ProjectID As Integer)
        Dim proj As Project = (From p In db.Project.Include("Status") Where p.ProjectID = ProjectID).First
        _ProjectID = proj.ProjectID
        _ProjectName = proj.ProjectName
        Me.Status.StatusID = proj.Status.StatusID  'I get errors here
        Me.Status.StatusName = proj.Status.StatusName  'and here
    End Sub 
```

但当然我得到了“对象引用未设置为对象的实例”这一行：Me.Status.StatusID = proj.Status.StatusID

扩展部分类时如何传递相关的实体值？或者我只是在这里离基地很远，并且有一种更简单的方法来做我想做的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T05:42:19.973

似乎您试图根据构造函数的 id 加载对象

我个人不会使用构造函数来加载对象，您可以使用共享函数或直接在代码中使用 LINQ 来加载对象。

使用类似的东西

```
Public Shared Function GetProjectById(ByVal ProjectId as Integer) as Project
     Dim db As New MyDataContext
     Return (From p In db.Project.Include("Status") Where p.ProjectID = ProjectID).FirstOrDefault
End Function 
```

# wpf - 如何允许插件具有自定义属性？

> ID：384141
> 
> 赞同：0
> 
> 时间：2008-12-21T05:30:31.557
> 
> 标签：wpf

我有 wpf 应用程序，并且我允许实现接口的用户控件插件。

我想允许插件拥有自己的属性，但我想从主机中的菜单访问这些属性。

这将如何构建最好？

属性可以是字符串、双精度等。

马尔科姆

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-21T07:16:11.330

一种简单的解决方案是在自定义属性上使用 Attribute 并通过主机反射获取它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-23T02:55:16.533

或者您可以将菜单传递给插件（将其作为 IPlugin 接口的一部分进行初始化时），它可以填充菜单本身的条目。

# html - 扩展父级 到它孩子的高度

> ID：384145
> 
> 赞同：355
> 
> 时间：2008-12-21T05:39:54.580
> 
> 标签：html, css

我有一个类似于这样的页面结构：

```
<body>
  <div id="parent">
    <div id="childRightCol">
      /*Content*/
    </div>
    <div id="childLeftCol">
      /*Content*/
    </div>
  </div>
</body> 
```

我希望父母在`div`inner`height`增加时扩大。`div``height`

**编辑：**
一个问题是，如果`width`子内容的 扩展超过`width`浏览器窗口的 ，我当前的 CSS 会在 parent 上放置一个水平滚动条`div`。我希望滚动条位于页面级别。目前我的父 div 设置为`overflow: auto;`

你能帮我解决这个问题吗？

* * *

## 回答 #1

> 赞同：593
> 
> 时间：2011-01-02T17:28:50.473

为父母试试这个，它对我有用。

```
overflow:auto; 
```

**更新：**

另一种有效的解决方案：

**家长**：

```
display: table; 
```

**孩子**：

```
display: table-row; 
```

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2018-09-11T09:43:07.923

尽量给`max-content`父母的身高。

```
.parent{
   height: max-content;
} 
```

[https://jsfiddle.net/FreeS/so4L83wu/5/](https://jsfiddle.net/FreeS/so4L83wu/5/)

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2008-12-21T05:47:37.560

添加一个`clear:both`. 假设您的列是浮动的。根据您的身高是如何指定父母的，您可能需要一个溢出：自动；

```
<body>
<div id="parent">
    <div id="childRightCol">
    <div>
    <div id="childLeftCol">
    <div>
    <div id="clear" style="clear:both;"></div>
</div>
</body> 
```

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2013-10-11T09:42:12.587

正如詹斯在评论中所说

> 另一个答案是[如何使 div 不大于其内容？](https://stackoverflow.com/questions/450903/)…它建议设置显示：内联块。这对我很有用。——延斯 6 月 2 日 5:41

这在所有浏览器中对我来说效果更好。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-06-16T19:52:28.107

[对于那些无法从该答案](https://stackoverflow.com/questions/384145/css-expand-parent-div-to-child-height/384170#384170)的说明中弄清楚这一点的人：

尝试将填充**值**设置为**大于****0**，如果子 div 有 margin-top 或 margin-bottom 你可以用填充替换它

例如，如果您有

```
#childRightCol
{
    margin-top: 30px;
}
#childLeftCol
{
    margin-bottom: 20px;
} 
```

最好将其替换为：

```
#parent
{
    padding: 30px 0px 20px 0px;
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-04-26T20:47:18.100

添加

```
clear:both; 
```

到父 div 的 css，或者在父 div 的底部添加一个 div，它确实 clear:both;

这是正确的答案，因为 overflow:auto; 可能适用于简单的网页布局，但会混淆开始使用负边距等元素的元素

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2020-12-08T16:34:55.487

不要设置高度属性，而是使用最小高度。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-21T06:35:43.017

[在这种](http://www.positioniseverything.net/easyclearing.html)情况下，使用诸如自我清除之类的东西`div`是完美的。然后你只需在父级上使用一个类......比如：

```
<div id="parent" class="clearfix"> 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-06-05T15:44:18.607

这是做你想做的吗？

```
.childRightCol, .childLeftCol
{
    display: inline-block;
    width: 50%;
    margin: 0;
    padding: 0;
    vertical-align: top;
} 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2021-05-31T12:40:07.440

在父元素上使用`height: auto`或使用将起作用。`min-height`并且为了避免水平滚动条，可以通过使用`box-sizing: border-box`子元素或`overflow: hidden`父元素来避免由于填充或边框引起的水平滚动条。至于由于 body 宽度引起的水平滚动条，如果你`width: 100vw`使用`width:100%`.

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-12-21T06:08:42.243

您在寻找[2 列 CSS 布局](http://www.456bereastreet.com/lab/developing_with_web_standards/csslayout/2-col/finished.html)吗？

如果是这样，请查看[说明](http://www.456bereastreet.com/lab/developing_with_web_standards/csslayout/2-col/)，开始时非常简单。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-01-30T21:58:17.440

我通过将子 div 作为没有任何定位属性（例如绝对指定）的单列，使父 div 围绕子 div 的内容展开。

例子：

```
#wrap {width:400px;padding:10px 200px 10px 200px;position:relative;margin:0px auto;}
#maincolumn {width:400px;} 
```

基于 maincolumn div 是 #wrap 的最深子 div，这定义了 #wrap div 的深度，并且两侧的 200px 填充创建两个大的空白列，供您随意放置绝对定位的 div。您甚至可以使用 position:absolute 更改顶部和底部的填充以放置页眉 div 和页脚 div。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-03-19T08:13:16.633

如果您在#childRightCol 和#childRightCol 中的内容向左或向右浮动，只需将其添加到css 中：

```
#childRightCol:before { display: table; content: " "; }
#childRightCol:after { display: table; content: " "; clear: both; }
#childLeftCol:before { display: table; content: " "; }
#childLeftCol:after { display: table; content: " "; clear: both; } 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2013-07-13T03:49:16.447

您必须在父容器上应用 clearfix 解决方案。这是一篇很好的文章，解释了修复[链接](http://css-tricks.com/snippets/css/clear-fix/)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-06-07T00:10:48.593

这按照规范的描述运行 - 这里的几个答案是有效的，并且与以下内容一致：

> 如果它有块级子框，则高度是没有通过它折叠边距的最顶层块级子框的上边框边缘与最底部块级子框的下边框边缘之间的距离没有通过它崩溃的边距。但是，如果元素具有非零顶部填充和/或顶部边框，或者是根元素，则内容从最顶部子元素的顶部边距边缘开始。（第一种情况表示元素的顶部和底部边距与最顶部和最底部子项的顶部和底部边距折叠在一起，而在第二种情况下，填充/边框的存在防止顶部边距折叠。）类似地，如果元素具有非零的底部填充和/或底部边框，则内容在最底部子元素的底部边缘结束。

从这里：[https ://www.w3.org/TR/css3-box/#blockwidth](https://www.w3.org/TR/css3-box/#blockwidth)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-03-06T14:11:49.960

下面的代码对我有用。

# css

```
.parent{
    overflow: auto;
} 
```

# html

```
<div class="parent">
    <div class="child1">
    </div>
    <div class="child2">
    </div>
    <div id="clear" style="clear:both;"></div>
</div> 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2019-10-28T08:55:09.467

```
#childRightCol
{
float:right;
}
#childLeftCol
{
float:left;
}
#parent
{
    display:inline;
}
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2020-02-19T12:39:52.453

**我们从哪里开始**

这是一些样板的 HTML 和 CSS。在我们的示例中，我们有一个带有两个浮动子元素的父元素。

```
/* The CSS you're starting with may look similar to this.
 * This doesn't solve our problem yet, but we'll get there shortly.
 */

.containing-div {
  background-color: #d2b48c;
  display: block;
  height: auto;
}

.floating-div {
  float: left;
  width: 50%;
}

.floating-div ul {
  display: inline-block;
  height: auto;
}
```

```
<!-- The HTML you're starting with might look similar to this -->
<div class="containing-div">
  <div class="floating-div">
    <ul>
      <li>List Item One</li>
      <li>List Item Two</li>
      <li>List Item Three</li>
      <li>List Item Four</li>
    </ul>
  </div>
  <div class="floating-div">
    <ul>
      <li>List Item Five</li>
      <li>List Item Six</li>
      <li>List Item Seven</li>
      <li>List Item Eight</li>
    </ul>
  </div>
</div>
```

**解决方案#1：溢出：自动**

一个适用于所有现代浏览器和 Internet Explorer 回到 IE8 的解决方案是添加`overflow: auto`到父元素。这也适用于 IE7，添加了滚动条。

```
/* Our Modified CSS.
 * This is one way we can solve our problem.
 */

.containing-div {
  background-color: #d2b48c;
  display: block;
  height: auto;
  overflow: auto;
  /*This is what we added!*/
}

.floating-div {
  float: left;
  width: 50%;
}

.floating-div ul {
  display: inline-block;
  height: auto;
}
```

**解决方案#2：浮动父容器**

另一个适用于所有现代浏览器并返回到 IE7 的解决方案是浮动父容器。

这可能并不总是实用的，因为浮动您的父 div 可能会影响页面布局的其他部分。

```
/* Modified CSS #2.
 * Floating parent div.
 */

.containing-div {
  background-color: #d2b48c;
  display: block;
  float: left;
  /*Added*/
  height: auto;
  width: 100%;
  /*Added*/
}

.floating-div {
  float: left;
  width: 50%;
}

.floating-div ul {
  display: inline-block;
  height: auto;
}
```

**方法#3：在浮动元素下方添加清除 div**

```
/* 
 * CSS to Solution #3.
 */

.containing-div {
  background-color: #d2b48c;
  display: block;
  height: auto;
}

.floating-div {
  float: left;
  width: 50%;
}

.floating-div ul {
  display: inline-block;
  height: auto;
}

/*Added*/

.clear {
  clear: both;
}
```

```
<!-- Solution 3, Add a clearing div to bottom of parent element -->
<div class="containing-div">
  <div class="floating-div">
    <ul>
      <li>List Item One</li>
      <li>List Item Two</li>
      <li>List Item Three</li>
      <li>List Item Four</li>
    </ul>
  </div>
  <div class="floating-div">
    <ul>
      <li>List Item Five</li>
      <li>List Item Six</li>
      <li>List Item Seven</li>
      <li>List Item Eight</li>
    </ul>
  </div>
  <div class="clear"></div>
</div>
```

**方法#4：向父元素添加 Clearing Div** 这个解决方案对于旧版浏览器和新版浏览器来说都是非常安全的。

```
/* 
 * CSS to Solution #4.
 */

.containing-div {
  background-color: #d2b48c;
  display: block;
  height: auto;
}

.floating-div {
  float: left;
  width: 50%;
}

.floating-div ul {
  display: inline-block;
  height: auto;
}

/*Added*/

.clearfix {
  clear: both;
}

.clearfix:after {
  clear: both;
  content: "";
  display: table;
}
```

```
<!-- Solution 4, make parent element self-clearing -->
<div class="containing-div clearfix">
  <div class="floating-div">
    <ul>
      <li>List Item One</li>
      <li>List Item Two</li>
      <li>List Item Three</li>
      <li>List Item Four</li>
    </ul>
  </div>
  <div class="floating-div">
    <ul>
      <li>List Item Five</li>
      <li>List Item Six</li>
      <li>List Item Seven</li>
      <li>List Item Eight</li>
    </ul>
  </div>
</div>
```

来自[https://www.lockedownseo.com/parent-div-100-height-child-floated-elements/](https://www.lockedownseo.com/parent-div-100-height-child-floated-elements/)

* * *

## 回答 #19

> 赞同：-1
> 
> 时间：2013-03-18T03:34:11.590

我将这个 CSS 用于父级，它可以工作：

```
min-height:350px;
background:url(../images/inner/details_middle.gif) repeat-y 0 0 ;
padding:5px 10px;   
text-align:right;
overflow: hidden;
position: relative;
width: 100%; 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2015-08-27T12:35:39.240

```
#parent{
  background-color:green;
  height:auto;
  width:300px;
  overflow:hidden;
}

#childRightCol{
  color:gray;
  background-color:yellow;
  margin:10px;
  padding:10px;
}
```

```
<div id="parent">
    <div id="childRightCol">
        <p>
          Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque vulputate sit amet neque ac consequat.
        </p>
    </div>
  </div>
```

`overflow:hidden;`你是通过在 css 中使用属性来管理的

# javascript - 不打印 AJAX 的结果

> ID：384157
> 
> 赞同：1
> 
> 时间：2008-12-21T05:58:49.533
> 
> 标签：javascript, jquery, ajax

我正在编写一个将数据发送到 mysql 表的脚本，并且我的一切工作正常，但是调用的成功部分，它没有将我的结果加载到我页面上的结果列中。我的代码如下。

关于我可以做些什么来解决这个问题的任何建议？我猜问题出在我的 AJAX 调用中的“成功：”选项中。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Facebook like ajax post - jQuery - ryancoughlin.com</title>
<link rel="stylesheet" href="css/screen.css" type="text/css" media="screen, projection" />
<link rel="stylesheet" href="css/print.css" type="text/css" media="print" />
<!--[if IE]><link rel="stylesheet" href="css/ie.css" type="text/css" media="screen, projection"><![endif]-->
<script src="js/jquery.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
/* <![CDATA[ */
$(document).ready(function(){

    $('p.validate').hide();

    $.getJSON("readJSON.php",function(data){
        $.each(data.posts, function(i,post){
            content = '<div id="post-'+ post.id +'">\n';
            content += '<h3>' + post.author + '</h3>\n';
            content += '<p class="small quiet">' + post.date_added + '</p>\n';
            content += '<p>' + post.post_content + '</p>';
            content += '<hr/>';
            $("#contents").append(content).fadeIn("slow");      
        });
    });  
    $(".reload").click(function() { 
        $("#posts").empty();
    });

    $("#add_post").submit(function() {
        $('p.validate').empty();
        // we want to store the values from the form input box, then send via ajax below
        var author = $('#author').attr('value');
        var post   = $('#post').attr('value'); 

        if(($('#author').val() == "") && ($('#post').val() == "")){
            $("p.validate").fadeIn().append("Both fields are required.");
            $('#author,#post').fadeIn().addClass("error");
        }else{
            $.ajax({
                type: "POST",
                url: "ajax.php",
                data: "author="+ author + "&post=" + post,
                success: function(result){
                    $('#contents').after( "<div>" +result +"</div>" );
                }
            });

        }
        return false;
    });

});
/* ]]> */
</script>
<style type="text/css">
h3{margin:10px 0;}
p{margin:5px 0;}
#posts{display:none;}
</style>
</head>
<body>
        <div class="container">
                <div class="span-24">
                        <div id="post-container" class="span-9 colborder">
                                <h2>Posts loaded via Ajax:</h2>
                                <div id="contents"></div>   
                        </div>
                        <div id="form" class="span-11">
                            <h2>New Post:</h2>

                            <form name="add_post" id="add_post" action="">
                                <label>Author:</label><br />
                                <input type="text" name="author" id="author" size="15" class="text" /><br />
                                <label>Post:</label><br />
                                <textarea name="post" id="post" rows="5" cols="5" class="text"></textarea><br />
                                <input type="submit" value="Post" id="submit" /><br />
                            </form><br />
                            <p class="validate error"></p>

                        </div>  
                </div>
                <div class="span-24">
                    <a href="#" class="reload">Reload</a>
                </div>
        </div>
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T07:57:19.687

要问自己的问题...

1.  jQuery 甚至会运行你的成功回调吗？
2.  如果是这样，响应数据是否是格式良好的标记？

首先，我将添加一个“调试器”；声明您的成功功能（假设您有 firefox 和 firebug）。这将使您能够闯入脚本控制台并更好地了解正在发生的事情。

The debugger statement will cause the script execution to pause and break into the firebug console. Try the following

```
 success: function(result){
             debugger;
             $('#contents').after( "<div>" +result +"</div>" );
           } 
```

If your script hits this I suspect your response markup is not well formed and jQuery is having issues parsing into the div but you can check all this when your at that breakpoint in firebug.

Another easy thing to check and dismiss in your debugging is

1.  does your web server serve a valid (status 200) response (check the console or net tab in firebug to see this, or use the likes of fiddler if running in ie)

Let me know how you get on.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-21T06:05:08.040

您可能会遇到错误尝试使用错误设置向您的 ajax 调用添加调试语句

```
$.ajax({
                        type: "POST",
                        url: "ajax.php",
                        data: "author="+ author + "&post=" + post,

                        error: function(XMLHttpRequest, textStatus, errorThrown) 
                        { alert(errorThrown); },

                        success: function(result){
                        $('#contents').after( "<div>" +result +"</div>" );
                        }
                }); 
```

# c++ - 无法分配作为指向模板化类的指针的成员

> ID：384159
> 
> 赞同：1
> 
> 时间：2008-12-21T06:00:52.120
> 
> 标签：c++, object, templates, constants

我的问题是，在我的“Widget”类中，我有以下声明：

```
MouseEvent* X; 
```

在成员函数中，我以正常方式用地址初始化指针：

```
X = new MouseEvent; 
```

好的，最后一行使编译器停止在：

> 错误 C2166：左值指定 const 对象

好吧，为了简化事情，MouseEvent 被声明为 typedef：

```
typedef Event__2<void, Widget&, const MouseEventArgs&> MouseEvent; 
```

正如您可能想象的那样，Event__2 是：（显示的基本结构）：

```
template <typename return_type, typename arg1_T, typename arg2_T>
class Event__2
{
     ...
}; 
```

我不知道 Event__2 类从哪里获得 const 限定符。有小费吗 ？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T06:08:19.780

很可能，您正在初始化 X 的成员函数被标记为 const - 类似这样。

```
class Foo
{
   int *Bar;

public:

   void AssignAndDoStuff() const
   {
      Bar = new int; // Can't assign to a const object.
      // other code
   }
} 
```

这里的解决方案是

1.  在单独的非常量方法中分配给 Bar，
2.  将 AssignAndDoStuff 更改为非常量，或
3.  将 Bar 标记为`mutable`。

选择以上之一：

```
class Foo
{
   mutable int *Bar; // 3

public:
   void Assign() // 1
   {
       Bar = new int; 
   }   
   void DoStuff() const
   {
       // Other code
   }

   void AssignAndDoStuff() // 2
   {
      Bar = new int; 
      // other code
   }
} 
```

# asp.net - asp.net mvc：找不到页面

> ID：384184
> 
> 赞同：1
> 
> 时间：2008-12-21T06:21:27.257
> 
> 标签：asp.net, asp.net-mvc

我正在尝试在我的笔记本电脑上设置 MVC 开发环境。我正在使用 IIS 5.1 运行 WinXP Pro

我使用 beta 附带的示例 MVC 应用程序进行了环境设置。我只能到主页。当我尝试打开关于我们页面时。我遇到页面找不到错误。是不是在 Global.asax 中没有设置路由？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-26T21:42:50.560

您可以转到 IIS 站点的属性，选项卡“主目录”，按“配置...”，选择“.aspx”，按“插入...”，键入“c:\windows\microsoft.net\framework\ v2.0.50727\aspnet_isapi.dll”，取消选中复选框并按“确定”。这对我有帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T06:26:27.263

您的问题是 IIS 5/6 不能很好地处理没有扩展的路由，主页正在解决，因为它指向 default.aspx，

简而言之，这样做：

> 如果 *.mvc 扩展名没有注册到主机，它会给出 404 异常。在这种情况下托管 MVC 应用程序的工作方式是通过以下方式修改 global.asax 路由 caluse。
> 
> ```
>  routes.Add(new Route("{controller}.mvc.aspx/{action}", 
>        new MvcRouteHandler()) 
>        { Defaults = new RouteValueDictionary (new{ controller = "YourController"} ) }); 
> ```
> 
> 这样，您的所有控制器请求都将以 *.mvc.aspx 结尾，您的主机可以识别该文件。由于 MVC dll 被复制到您的本地 bin 中，因此无需对其进行特殊设置。

有关许多有用的信息，请参阅此问题：

[ASP.NET MVC 和 IIS 5](https://stackoverflow.com/questions/57712/mvc-net-and-iis-5)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-24T06:25:41.533

网址重写可以帮助您解决问题。我已经实现了允许在任何 IIS 版本上部署 MVC 应用程序的解决方案，即使使用虚拟主机也是如此。 [http://www.codeproject.com/KB/aspnet/iis-aspnet-url-rewriting.aspx](http://www.codeproject.com/KB/aspnet/iis-aspnet-url-rewriting.aspx)

# java - 如何在我的 jsp 中使 Java ResultSet 可用？

> ID：384189
> 
> 赞同：3
> 
> 时间：2008-12-21T06:27:02.207
> 
> 标签：java, jsp, jdbc, jstl

我想将 sql:query 换成一些 Java 代码，该代码构建具有多个参数的复杂查询。当前的sql是一个简单的select。

```
<sql:查询
   变量=“结果”
   数据源="${dSource}"
   sql="从表中选择 * ">
</sql:查询>

```

我如何获取我的 Java ResultSet（即 rs = stmt.executeQuery(sql);）并使结果在我的 JSP 中可用，以便我可以做这个教科书 JSP？

为了更清楚，我想删除上面的查询并将其替换为 Java。

```
<%
  结果集 rs = stmt.executeQuery(sql); // 乱七八糟的代码会在某个Controller中
%>

```

```
<c:forEach var="row" items="${result.rows}">
  <c:out value="${row.name}"/>
</c:forEach>

```

我是在 Java 部分设置会话/页面变量还是有一些 EL 技巧可以用来访问该变量？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-03-11T20:32:51.217

型号（行）：

```
public class Row { 
    private String name;
    // Add/generate constructor(s), getters and setters.
} 
```

道：

```
public List<Row> list() throws SQLException {
    Connection connection = null;
    Statement statement = null;
    ResultSet resultSet = null;
    List<Row> rows = new ArrayList<Row>();

    try {
        connection = database.getConnection();
        statement = connection.createStatement();
        resultSet = statement.executeQuery(SQL_LIST);
        while (resultSet.next()) {
            Row row = new Row();
            row.setName(resultSet.getString("name"));
            // ...
            rows.add(row);
        }
    } finally {
        if (resultSet != null) try { resultSet.close(); } catch (SQLException logOrIgnore) {}
        if (statement != null) try { statement.close(); } catch (SQLException logOrIgnore) {}
        if (connection != null) try { connection.close(); } catch (SQLException logOrIgnore) {}
    }

    return rows;
} 
```

控制器（小服务程序）：

```
protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
    try {
        List<Row> rows = someDAO.list();
        request.setAttribute("rows", rows);
    } catch (SQLException e) {
        request.setAttribute("error", "Retrieving rows failed.");
        e.printStackTrace();
    }
    request.getRequestDispatcher("page.jsp").forward(request, response);
} 
```

查看（page.jsp）：

```
<c:forEach items="${rows}" var="row">
    <c:out value="${row.name}" />
    ...
</c:forEach>
<c:if test="${not empty error}">Error: ${error}</c:if> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-03T18:49:50.287

您从 Java 代码设置会话/请求属性。

但是，我建议*不要*使用 ResultSet，因为它有一些生命周期问题（即需要关闭）。我建议在 Java 代码中获取 ResultSet 对象，对其进行迭代构建，比如 List，关闭 ResultSet 并将 List 传递给 JSP。

如果您使用的是 Spring，JdbcTemplates 提供了接受 SQL 字符串和参数并返回 List> 查询结果的方法，这可能非常方便。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T17:49:34.077

如果您使用的是诸如 spring mvn 或 struts 之类的 Web 框架，那么您将拥有一个在实际 jsp 之前执行的控制器类。这可以有一个方法

```
ResultSet getResult() 
```

此方法将在您的 jsp 中以 ${result} 的形式提供。

如果您不使用这些框架中的任何一个，您仍然可以使用 jsp usebean 并将 javaclass 绑定到变量（查看 usebean 文档）。如果您使用 bean 到 myBean 的变量，您可以使用 ${myBean.result} 访问它

最后，您还可以将结果绑定到“其他地方”的请求参数。在这种情况下，您将其称为 ${param.result}

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-01T02:52:05.630

你没有。

首先，将 SQL 放到 JSP 中，即使是通过标签，也是一种糟糕的设计选择。JSP 页面是模型视图控制器模式中的“视图”。它的工作是展示你的模型，除了展示它之外，实际上并没有对它做任何事情。

在您的控制器类中，执行您的 SQL 并检索可以通过 JSP 显示的实际 Java 对象。然后，在您的 JSP 中显示它们。将 SQL 留给控制器，让 JSP 专注于简单地显示数据。您不仅获得了清晰的关注点分离，而且您的 JSP 也因此变得更加简单，并且如果需要重构 Java 代码比 JSP 代码要容易得多（测试 Java 要简单得多）代码）。

# c++ - C++ 运算符歧义

> ID：384200
> 
> 赞同：3
> 
> 时间：2008-12-21T06:48:14.070
> 
> 标签：c++, opengl, operators, ambiguity, operator-keyword

原谅我，因为我对 C++ 还很陌生，但是我在操作符歧义方面遇到了一些麻烦。对于在我的桌面上编译的代码，我认为它是特定于编译器的。但是，它无法在我的笔记本电脑上编译。我想我知道出了什么问题，但我没有看到一个优雅的解决方法。如果我犯了明显的错误，请告诉我。无论如何，这就是我想要做的：

我制作了自己的矢量类 Vector4，它看起来像这样：

```
class Vector4
{
 private:
   GLfloat vector[4];
 ...
} 
```

然后我有这些导致问题的运算符：

```
operator GLfloat* () { return vector; }

operator const GLfloat* () const { return vector; }

GLfloat& operator [] (const size_t i) { return vector[i]; }

const GLfloat& operator [] (const size_t i) const { return vector[i]; } 
```

我有转换运算符，以便我可以将 Vector4 类的实例传递给 glVertex3fv，并且出于明显的原因我有下标。但是，涉及下标 Vector4 的调用对编译器来说变得模棱两可：

```
enum {x, y, z, w}
Vector4 v(1.0, 2.0, 3.0, 4.0);

glTranslatef(v[x], v[y], v[z]); 
```

以下是候选人：

```
candidate 1: const GLfloat& Vector4:: operator[](size_t) const
candidate 2: operator[](const GLfloat*, int) <built-in> 
```

为什么在 Vector4 上已经定义了下标运算符时，它会首先尝试将我的 Vector4 转换为 GLfloat*？有没有一种不涉及类型转换的简单方法？我只是犯了一个愚蠢的错误吗？感谢您提前提供任何帮助。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-21T07:10:31.683

这在“C++ 模板 - 完整指南”一书中进行了解释。这是因为您的 operator[] 采用 size_t，但您传递了一个不同的类型，该类型首先必须经过隐式转换为 size_t。另一方面，也可以选择转换运算符，然后返回的指针可以是下标。所以有歧义。解决方案是删除转换运算符。如您所见，它们通常应该避免，因为它们只会引入问题。

提供一个`begin`和`end`成员函数，分别返回`vector`和`vector + 4`。然后，`v.begin()`如果您想传递给本机 openGL 函数，则可以使用。

评论中有些混乱。我想我现在会更新这个答案以反映最新的概念。

```
struct Vector4 {
    // some of container requirements
    typedef GLfloat value_type;
    typedef GLfloat& reference;
    typedef GLfloat const& const_reference;

    typedef GLfloat * iterator;
    typedef GLfloat const * const_iterator;

    typedef std::ptrdiff_t difference_type;
    typedef std::size_t size_type;

    static const size_type static_size = 4;

    // returns iterators to the begin and end
    iterator begin() { return vector; }
    iterator end() { return vector + size(); }

    const_iterator begin() const { return vector; }
    const_iterator end() const { return vector + size(); }

    size_type size() const { return static_size; }
    size_type max_size() const { return static_size; }

    void swap(Vector4 & that) {
        std::swap(*this, that);
    }

    // some of sequences
    reference operator[](size_type t) { return vector[t]; }
    const_reference operator[](size_type t) const { return vector[t]; }

    // specific for us. returns a pointer to the begin of our buffer.
    // compatible with std::vector, std::array and std::string of c++1x
    value_type * data() { return vector; }
    value_type const* data() const { return vector; }

    // comparison stuff for containers
    friend bool operator==(Vector4 const&a, Vector4 const&b) {
        return std::equal(a.begin(), a.end(), b.begin());
    }
    friend bool operator!=(Vector4 const&a, Vector4 const&b) { return !(a == b); }
    friend bool operator<(Vector4 const&a, Vector4 const&b) {
        return std::lexicographical_compare(a.begin(), a.end(), b.begin(), b.end());
    }
    friend bool operator> (Vector4 const&a, Vector4 const&b) { return b < a;    }
    friend bool operator<=(Vector4 const&a, Vector4 const&b) { return !(b < a); }
    friend bool operator>=(Vector4 const&a, Vector4 const&b) { return !(a < b); }

private:
    GLfloat vector[4];
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T07:09:49.313

摆脱歧义太难了。它可以很容易地将其解释为直接 [] 访问，或强制转换为浮点*，然后是数组索引。

我的建议是放弃运营商 GLfloat*。让隐式强制转换以这种方式浮动只是在自找麻烦。如果您必须直接访问浮点数，请为 Vector4 创建一个 get()（或您选择的其他名称）方法，该方法返回一个指向下面的原始浮点数的指针。

其他随机建议：与其重新发明自己的矢量类，不如使用[OpenEXR中“IlmBase”包中的优秀矢量类](http://www.openexr.com/downloads.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T07:58:09.747

为什么将“const size_t”传递给 operator[] ？

# web-applications - 如何使用日历在网页上选择日期？

> ID：384214
> 
> 赞同：-1
> 
> 时间：2008-12-21T07:17:45.927
> 
> 标签：web-applications

我有一个包含 startdate 和 enddate 作为用户输入的 html 页面。我需要让用户从日历中选择这些输入，而不是要求用户输入日期。你能建议什么帮助吗？

编辑：

我有一个 HTML 页面：

```
StartDate: yyyy-mm-dd             EndDate: yyyy-mm-dd 
```

目前这两个字段是文本字段。

我想使用日历控件来实现这一点，用户可以从日历中选择任何日期。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T09:14:33.023

我认为一旦你开始需要这种控件，你应该转向使用 javascript 库。

我推荐你 jquery 或 YUI（你有更多：原型、mootools 等......）

具体的日历控件，你可以使用[YUI](http://developer.yahoo.com/yui/)，他们有一个特殊的 js 。下载 YUI 后，您可以在此处找到它：/yui/build/calendar-min.js，并且路径中有一个非常好的示例：/yui/examples/calendar。

创建它的方法是： new YAHOO.widget.Calendar("cal","calendario", { LOCALE_WEEKDAYS:"1char", START_WEEKDAY: 1, mindate:"1/1/2008"});

如果你更喜欢 jquery，你会在这里找到一个日历控件：

[http://ui.jquery.com/repository/tags/latest/demos/functional/#ui.datepicker](http://ui.jquery.com/repository/tags/latest/demos/functional/#ui.datepicker)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T07:26:49.000

看看这个 - [http://www.xaprb.com/blog/2005/09/29/javascript-date-chooser/](http://www.xaprb.com/blog/2005/09/29/javascript-date-chooser/)

顺便说一句，你应该更清楚和具体地问你的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T12:17:03.763

如果你在 ASP.NET 上，你可以使用这个；[http://ra-ajax.org/samples/Ajax-Calendar.aspx](http://ra-ajax.org/samples/Ajax-Calendar.aspx)

我为 Ra-Ajax 工作，顺便说一句...

# css - CSS“透视”背景 - 疯狂的导航菜单问题

> ID：384220
> 
> 赞同：4
> 
> 时间：2008-12-21T07:41:07.380
> 
> 标签：css, menu, navigation, background, transparent

我有一个疯狂的导航菜单，我必须编写代码。这有点艰难。请在此处查看设计的屏幕截图：

[![导航菜单](https://i.stack.imgur.com/l3U7W.png)](https://i.stack.imgur.com/l3U7W.png)

[导航菜单截图](http://i41.tinypic.com/307xfo9.png)

如您所见，“主页”菜单项的背景相当硬朗！我不知道如何让它的背景“透视”，这意味着它穿过黑暗的背景并显示有图案的绿色背景。

你知道如何使用 css 做到这一点吗？

提前致谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T08:08:59.100

您可以使用：

```
background: transparent;
background: inherit; 
```

但是，您需要构建您的 HTML，以便***Home***、***Journal***等链接嵌入到带有背景的框中。

* * *

对于圆角，[看看这个](https://stackoverflow.com/questions/7089/what-is-the-best-way-to-create-rounded-corners-using-css)。

或者，您可以使用具有形状透明度的图像作为背景。

* * *

@Gary [评论]：`inherit`获取它在层次结构中发现的第一个设置。所以如果你有一个中间层，它会取而代之的是它的设置。

您可能会尝试使用：

```
background-image: url('greencheckers'); /* outer */

background-color: black;                /* middle */

background-image: inherit;              /* link */ 
```

理论上，它应该寻找第一个`background-image`设置，然后。但是，我从来没有用过这个，所以不能保证。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T18:15:08.517

你可以做到的一种方法是你通常采取的相反方法。将黑色背景应用于其他元素，在突出显示的选项卡所在的位置留出空隙。一种反向推拉门。

创建两张非常长的黑色图像：一张用于右侧，左侧有一个圆角，另一张用于左侧，右侧有一个角，并将它们放置在当前元素的任一侧。可悲的是，我认为纯 CSS 无法做到这一点，但看起来您已经在使用 JS。

我不确定这有多可行，这只是我的想法，但这可能是一个有趣的方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-22T18:08:28.297

不幸的是，您可以通过使用背景位置进行仔细的“手动”定位来模拟 IE6 不支持的固定背景位置（请参阅 nerdposeur 的回答）。用 0,0 偏移量定位大图像。对选定的选项卡使用相同的图像，但将其向左和向上偏移正好是选项卡左上角的位置。这将确保您想要的两个背景完全匹配。

您似乎有一个固定的菜单，因此这意味着要为您的四个菜单元素一个一个仔细地编写背景 CSS。当然，如果你的菜单是动态的，这种方法就行不通了。[这是我从这个页面](http://nontroppo.org/test/tab2.html)开始快速制作的演示：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <title>CSS Tabbed Navigation</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <style type="text/css">
    body {
        margin: 20px;
        padding: 0px;
        background: #CACCB4;
        font: 16px arial, sans-serif; 
        background-image: url('http://www.graphicsarcade.com/backgrounds/strips/background_3.gif'); 
        }

    pre {text-indent: 30px}

    #tabmenu {
        color: #000;
        border-bottom: 2px solid black;
        margin: 12px 0px 0px 0px;
        padding: 0px;
        z-index: 1;
        padding-left: 10px }

    #tabmenu li {
        display: inline;
        overflow: hidden;
        list-style-type: none; }

    #tabmenu a, a.active {
        color: #DEDECF;
        background: #898B5E;
        font: bold 1em "Trebuchet MS", Arial, sans-serif;
        border: 2px solid black;
        padding: 2px 5px 0px 5px;
        margin: 0px;
        text-decoration: none; }

    #tabmenu a.active {
        background-image: url('http://www.graphicsarcade.com/backgrounds/strips/background_3.gif'); 
        background-position: -125px -18px;
        border-bottom: 3px solid #ABAD85; }

    #content {font: 0.9em/1.3em "bitstream vera sans", verdana, sans-serif;
        text-align: justify;
        background: #ABAD85;
        padding: 20px;
        border: 2px solid black;
        border-top: none;
        z-index: 2; }

    #content a {
        text-decoration: none;
        color: #E8E9BE; }

    #content a:hover { background: #898B5E; }
    </style>
</head>

<body>

<ul id="tabmenu">
    <li><a href="tab1.html">Enormous</a></li>
    <li><a class="active" href="tab2.html">Flared</a></li>
    <li><a href="tab3.html">Nostrils</a></li>
</ul>

<div id="content">
  <p>If one examines subpatriarchialist material theory, one is faced with a choice: either accept the presemioticist paradigm of reality or conclude that the task of the artist is deconstruction, given that reality is equal to art. It could be said that the subject is contextualised into a Batailleist 'powerful communication' that includes language as a totality. Marx uses the term 'precapitalist semiotic theory' to denote the bridge between narrativity and society.</p>
  <p>Any number of desituationisms concerning Sartreist absurdity may be discovered. In a sense, the textual paradigm of consensus states that reality has significance. Baudrillard uses the term 'surrealism' to denote the absurdity, and subsequent rubicon, of substructuralist class. It could be said that la Tournier[4] holds that the works of Pynchon are modernistic. The premise of the textual paradigm of consensus states that the significance of the observer is social comment. However, in Gravity's Rainbow, Pynchon examines textual materialism; in The Crying of Lot 49 he denies subcultural discourse.</p>
    <br />
</div>

</body>
</html> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T15:59:49.023

透明（或半透明）效果的另一种有趣方法是给出两个部分

1) 相同的背景图像，或
2) 相似的背景图像，其中一个用颜色或模糊或其他方式修改

...并**确保它们`background-position`是相同的**。

这在[Eric Meyer 的“复杂螺旋”演示](http://meyerweb.com/eric/css/edge/complexspiral/demo.html)中得到了证明。（这是他制作的[另一个版本](http://meyerweb.com/eric/css/edge/complexspiral/glassy.html)。）

**澄清**：这是在 Meyer 的“Edge”部分中的一个原因 - 它**与 IE6 不兼容**。（*谢谢，鲍里斯。*）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-10-01T10:37:47.313

我建议制作一个 30 x 1（高度 x 宽度）的图像，将其填充为黑色并将其不透明度设置为 35% 左右...另存为 .png（与 < IE7 浏览器不兼容）

将该图像添加到您的菜单背景 CSS 类中，如下所示：

```
#MainMenu {
    display: block;
    height: 30px;
    background; transparent url("menuBG.png") repeat-x;
} 
```

我知道这很有效，因为这是我为我的网站所做的。该网站不完整，但您可以查看屏幕截图：

[http://www.logansarchive.za.net/preview.jpg](http://www.logansarchive.za.net/preview.jpg)

高温高压

# wpf - 刷新 ObjectDataProvider 时视图丢失

> ID：384221
> 
> 赞同：2
> 
> 时间：2008-12-21T07:43:13.473
> 
> 标签：wpf, view, objectdataprovider

我正在根据 Josh Smith 在[http://joshsmithonwpf.wordpress.com/2007/06/12/searching-for-items-in-a-listbox](http://joshsmithonwpf.wordpress.com/2007/06/12/searching-for-items-in-a-listbox)的示例在列表上实现文本框过滤器。基本上，它将视图上的过滤器设置为检查搜索框中文本的委托。我像这样连接过滤器：

```
var pickerView = FindResource("sortedRulesView") as CollectionViewSource;
new TextSearchFilter(pickerView.View, SearchTextBox); 
```

后来，当我刷新 ObjectDataProvider 时，过滤器丢失了。我注意到 pickerView.View 在刷新后具有不同的哈希码。数据刷新时是否重新创建了所有视图？这是否意味着每当我调用 ObjectDataProvider.Refresh() 时都应该重新附加过滤器？有没有更聪明的方法来安装这个不需要保姆的过滤器？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-23T00:24:49.707

你说得对，当 CollectionViewSource.Source 设置时 CollectionViewSource.View 将被替换。

解决方案是使用[CollectionViewSource.Filter](http://msdn.microsoft.com/en-us/library/system.windows.data.collectionviewsource.filter.aspx)事件而不是[CollectionView.Filter](http://msdn.microsoft.com/en-us/library/system.windows.data.collectionview.filter.aspx)属性。当您的视图消失时，这将一直存在。

[您可以通过对 Josh Smith 的TextSearchFilter](http://joshsmithonwpf.wordpress.com/2007/06/12/searching-for-items-in-a-listbox/)类进行最小的更改来做到这一点：

```
public class TextSearchFilter
{
    public TextSearchFilter( 
        CollectionViewSource filteredView, 
        TextBox textBox )
    {
        string filterText = "";

        filteredView.Filter += delegate( object obj, FilterEventArgs e )                
        {
            if( String.IsNullOrEmpty( filterText ) )
                e.Accepted = true;

            string str = e.Item as string;
            if( String.IsNullOrEmpty( str ) )
                e.Accepted = false;

            int index = str.IndexOf(
                filterText,
                0,
                StringComparison.InvariantCultureIgnoreCase );

            e.Accepted = index > -1;
        };          

        textBox.TextChanged += delegate
        {
            filterText = textBox.Text;
            filteredView.View.Refresh();
        };
    }
} 
```

然后您的连接代码变为：

```
var pickerView = FindResource("sortedRulesView") as CollectionViewSource;
new TextSearchFilter(pickerView, SearchTextBox); 
```

# python - 数据库不会使用 MySQL 和 Python 自动更新

> ID：384228
> 
> 赞同：40
> 
> 时间：2008-12-21T07:57:04.133
> 
> 标签：python, mysql, mysql-python

我在更新 MySQL 数据库中的一行时遇到了一些问题。这是我要运行的代码：

```
import MySQLdb

conn=MySQLdb.connect(host="localhost", user="root", passwd="pass", db="dbname")
cursor=conn.cursor()

cursor.execute("UPDATE compinfo SET Co_num=4 WHERE ID=100")
cursor.execute("SELECT Co_num FROM compinfo WHERE ID=100")
results = cursor.fetchall()

for row in results:
    print row[0]

print "Number of rows updated: %d" % cursor.rowcount

cursor.close()
conn.close() 
```

我运行这个程序时得到的输出是：

> 4
> 更新的行数：1

看起来它正在工作，但如果我从 MySQL 命令行界面 (CLI) 查询数据库，我发现它根本没有更新。但是，如果我从 CLI 输入`UPDATE compinfo SET Co_num=4 WHERE ID=100;`数据库，则会按预期更新。

我的问题是什么？我在 Windows 机器上运行 Python 2.5.2 和 MySQL 5.1.30。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-12-21T08:08:32.143

我不确定，但我猜你正在使用 INNODB 表，而你还没有提交。我相信 MySQLdb 会自动启用事务。

打电话`conn.commit()`前打电话`close`。

来自FAQ： [从1.2.0开始，MySQLdb默认禁用自动提交](http://mysql-python.sourceforge.net/FAQ.html#my-data-disappeared-or-won-t-go-away)

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-12-21T13:19:16.930

MySQLdb 默认关闭自动提交功能，一开始可能会让人感到困惑。您的连接存在于它自己的事务中，并且在您提交该事务之前，您将无法看到您从其他连接所做的更改。

您可以`conn.commit()`像其他人指出的那样在更新语句之后执行此操作，也可以通过`conn.autocommit(True)`在创建连接对象后立即设置来完全禁用此功能。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-21T10:11:28.790

您需要手动提交更改或打开自动提交。

SELECT 返回已修改（但未保留）数据的原因是连接仍在同一事务中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-21T10:53:43.573

我发现 Python 的连接器会自动关闭自动提交，而且似乎没有任何方法可以改变这种行为。当然你可以重新打开它，但是然后查看查询日志，它在连接后愚蠢地执行了两个毫无意义的查询以关闭自动提交然后重新打开。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2021-01-21T14:29:18.310

### [连接器/Python 连接参数](https://dev.mysql.com/doc/connector-python/en/connector-python-connectargs.html)

连接数据库时可以直接开启自动提交：

```
import mysql.connector as db
conn = db.connect(host="localhost", user="root", passwd="pass", db="dbname", autocommit=True) 
```

[MySQLConnection.autocommit 属性](https://dev.mysql.com/doc/connector-python/en/connector-python-api-mysqlconnection-autocommit.html)

或单独：

```
import MySQLdb

conn = MySQLdb.connect(host="localhost", user="root", passwd="pass", db="dbname")
cursor = conn.cursor()
conn.get_autocommit()        # will return **False**
conn.autocommit = True
conn.get_autocommit()        # Should return **True** now
cursor = conn.cursor() 
```

显式提交更改是通过

```
conn.commit() 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-08-16T06:52:27.567

我必须`SET autocommit=true`在我的 mysqlWorkbench 应用程序脚本上执行

# html - 好的 'ole Internet Explorer 问题

> ID：384232
> 
> 赞同：0
> 
> 时间：2008-12-21T07:58:52.163
> 
> 标签：html, internet-explorer

我在 Internet Explorer 上遇到了一些小故障。该网站看起来应该在 Firefox 中（[http://i27.photobucket.com/albums/c190/blcArmadillo/FirefoxView.jpg](http://i27.photobucket.com/albums/c190/blcArmadillo/FirefoxView.jpg)）。但是，当我在 Internet Explorer 中加载它时，我的顶部栏的背景似乎应用于整个站点，如您在此屏幕截图中所见：http: [//i27.photobucket.com/albums/c190/blcArmadillo/AfterLoad.jpg](http://i27.photobucket.com/albums/c190/blcArmadillo/AfterLoad.jpg)。奇怪的是，如果我上下滚动页面，离开屏幕视图的页面部分突然有适当的白色背景，如您在此屏幕截图中看到的那样：http: [//i27.photobucket.com/专辑/c190/blcArmadillo/AfterScroll.jpg](http://i27.photobucket.com/albums/c190/blcArmadillo/AfterScroll.jpg)。

该站点暂时位于[http://evergreenwebdesigns.com/playground/dsite/](http://evergreenwebdesigns.com/playground/dsite/)。如果您知道如何解决此故障，请告诉我。谢谢你的帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T08:05:39.700

这是常见的“ [hasLayout](http://www.satzansatz.de/cssd/onhavinglayout.html) ”IE 问题。查看[我为另一个 CSS 问题建议的修复程序](https://stackoverflow.com/questions/367847/what-is-wrong-with-this-simple-css-in-ie#367900)，该问题也应该适用于您的情况。

在您的情况下，尽管您也应该将其应用于 IE7，所以：

```
<style>
 .haslayout {
     * display:inline-block; /* Limit to IE7 and below */
 }
</style> 
```

并将此类应用于有问题的 div

# asp.net - CSS 更改未反映在网站上

> ID：384247
> 
> 赞同：5
> 
> 时间：2008-12-21T08:19:13.887
> 
> 标签：asp.net, css

每当我们对 CSS 进行更改时，通常需要 24 小时才能在我的网站上反映这些更改。我曾尝试清除服务器缓存和浏览器缓存，但也无济于事。有没有其他方法可以在更新后立即反映 CSS 更改？

它发生在所有浏览器中......当我在浏览器中检查它时，我可以使用两个路径访问我的 css 文件，例如：我将我的 css 存储在名为“Cssfolder”的文件夹中，我的 css 名称是 135.css 所以当我访问文件夹路径，**C** ssfolder/135.css & **c** ssfolder/135.css，其中一个路径显示最新的 css，而另一个显示旧的 css。注意“c”在一个路径中是大写，而在其他路径中是小写.

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-21T08:42:59.017

我发现这在我的很多项目中都是一个很常见的问题。我建议两件事...

1.  如果它只是您正在开发的应用程序，您可以在开发过程中使用[CSS Cachebuster](http://www.jasongraphix.com/archive/2007/08/css_cachebuster)。

2.  遵循 Cachebuster 背后的想法，我发现经常将 CSS 文件的时间戳作为 CSS 链接的查询字符串添加将有助于告诉浏览器该文件是不同的......类似于......whatever.css？ 12212009035543

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T09:27:18.880

您可能希望使用监视工具（例如Firefox 的[Live Http Headers](http://livehttpheaders.mozdev.org)）来查看发往和来自服务器的请求和响应。这通常为我解决了很多问题。查看“ *Expire* ”标头和条件请求（例如：“If-modified-since”）。这就是说，看看服务器和客户端的本地时间和时区——它们可能存在显着差异，并且条件 GET 请求“似乎”得到了正确处理，因为未来或以其他方式损坏的时间戳。

您可以强制直接从服务器加载当前 css，并在 url 上附加一个随机唯一值，例如[http://example.com/Cssfolder/135.css?983274928374](http://example.com/Cssfolder/135.css?983274928374)和[http://example.com/cssfolder/134 .css?08973249827](http://example.com/cssfolder/134.css?08973249827)。除非您两次使用相同的随机值，否则这将永远不会被缓存。

通过这种方式，您可以了解在哪里进一步寻找问题的解决方案：在服务器、ISP/代理或您的浏览器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T08:26:22.390

你真的需要看看这是服务器端还是客户端。如果服务器仍在*为*旧 CSS 提供服务，那么显然您在客户端没有机会。

我偶尔会看到必须在浏览器中显示 CSS 的情况，然后下次我访问真实页面时，它会使用新的 CSS。通常只需点击刷新即可。

您是否在任何地方都使用过像 Akamai 这样的网络缓存？

如果您尝试从从未见过旧版本的计算机访问 CSS 页面，它会显示哪个版本？

编辑：更改答案以反映有问题的编辑。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T10:21:04.747

我过去一直在处理这个问题，最后写了一个 httpmodule 来处理它。

这非常简单，它只是在 head 标记中找到所有脚本/css 链接（它们现在需要具有 runat=server）并将程序集版本号附加到链接中，与 Tim K 描述的方式相同。这样，当我的应用程序在生产中更新时，我可以确保我的客户总是获取最新的 css/脚本，并且永远不必再次处理这个问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T09:00:02.430

也许互联网服务提供商缓存，就像在这种[情况下一样](https://stackoverflow.com/questions/382418/why-can-i-see-my-website-even-though-its-down#382419)？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-06-01T18:45:33.873

我对这个问题感到困惑然后有人说Ctrl + F5。为我工作:)

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-12-21T09:01:26.857

当我在开发时，我需要确保我在工作时看到了变化，我将 css 粘贴在页面中，即

```
<style type="text/css">
/* your css */
</style> 
```

或者您可以不断更改 css 文件本身的名称，这在生产环境中不是很有用，但在开发时可能没问题。

我知道它不能解决问题，但是对于开发它是可以的。

# c# - 如果 with 关键字不好（对于 C#），这是一个不错的选择吗？

> ID：384262
> 
> 赞同：2
> 
> 时间：2008-12-21T08:39:22.567
> 
> 标签：c#, syntactic-sugar

```
var insInvoice = new NpgsqlCommand(
    @"INSERT INTO invoice_detail(
    invoice_id,
    invoice_detail_id,
    product_id,
    qty,
    price,
    amount)
    VALUES (
    :_invoice_id,
    :_invoice_detail_id,
    :_product_id,
    :_qty,
    :_price,
    :_qty * :_price)", c);

with(var p = insInvoice.Parameters)
{
    p.Add("_invoice_id", NpgsqlDbType.Uuid, 0, "invoice_id");
    p.Add("_invoice_detail_id", NpgsqlDbType.Uuid, 0, "invoice_detail_id");
    p.Add("_product_id", NpgsqlDbType.Uuid, 0, "product_id");
    p.Add("_qty", NpgsqlDbType.Integer, 0, "qty");
    p.Add("_price", NpgsqlDbType.Numeric, 0, "price");
} 
```

* * *

```
kludge:

for(var p = insInvoice.Parameters; false;)
{       
    p.Add("_invoice_id", NpgsqlDbType.Uuid, 0, "invoice_id");
    p.Add("_invoice_detail_id", NpgsqlDbType.Uuid, 0, "invoice_detail_id");
    p.Add("_product_id", NpgsqlDbType.Uuid, 0, "product_id");
    p.Add("_qty", NpgsqlDbType.Integer, 0, "qty");
    p.Add("_price", NpgsqlDbType.Numeric, 0, "price");      
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-21T10:50:41.380

由于您有一个具有正确形式的“添加”方法，因此您可以对参数使用集合初始化程序：

```
var insInvoice = new NpgsqlCommand(sql)
{
    Parameters = 
    {
        { "_invoice_id", NpgsqlDbType.Uuid, 0, "invoice_id" },
        { "_invoice_detail_id", NpgsqlDbType.Uuid, 0, "invoice_detail_id" },
        { "_qty", NpgsqlDbType.Integer, 0, "qty" },
        { "_price", NpgsqlDbType.Numeric, 0, "price" }
    }
}; 
```

有关对象和集合初始化器的更多信息，您可以免费下载[C# in Depth](http://manning.com/skeet/)的第 8 章。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T09:47:29.293

定义“p”变量的范围有什么意义？

在这种情况下，只需创建一个带有花括号的作用域并一起删除 with 语句，将“p”的变量声明移动到新的作用域中。这样，“p”变量仅在花括号范围内可用。你今天就可以做到这一点，而不需要任何语法糖。不过，我不确定这是否有助于提高可读性，只需将大括号全部移除并仅使用变量即可。

```
//with(var p = insInvoice.Parameters)
{
  var p = insInvoice.Parameters;
  p.Add("_invoice_id", NpgsqlDbType.Uuid, 0, "invoice_id");
  p.Add("_invoice_detail_id", NpgsqlDbType.Uuid, 0, "invoice_detail_id");
  p.Add("_product_id", NpgsqlDbType.Uuid, 0, "product_id");
  p.Add("_qty", NpgsqlDbType.Integer, 0, "qty");
  p.Add("_price", NpgsqlDbType.Numeric, 0, "price");
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T09:00:20.543

我做过类似的事情：

```
var insInvoice = new NpgsqlCommand(...);
insInvoice.Parameters.With(p => {
    p.Add("_invoice_id", NpgsqlDbType.Uuid, 0, "invoice_id");
    ...
}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T11:05:17.623

如果您真的有兴趣通过消除其中的噪音和“仪式”来将代码简化为更具可读性的内容，那么在您的示例中还有更大的鱼可炒。

在这种情况下，使用扩展方法、一些静态只读元数据、参数数组等的组合，您应该能够为该插入语句自动生成 SQL，而不必手动编写代码。为什么任何给定的插入看起来都比这更复杂：

```
db.Insert(Invoices.Table,
      new Value(Invoices.ID, "{something-something}"),
      new Value(Invoices.Quantity, 52),
      /*... and so on*/); 
```

无需手动编写大型 SQL 插入。根据列名称自动选择的参数名称。名称类型和大小信息都绑定在这些静态成员中，`Invoices`因此您不会弄错它们。在调用点彼此相邻指定的名称和值。这一切都可能是你的！

或者，以某种简洁的 XML 结构声明数据库的结构，并编写一个从该 XML 生成两件事的工具：1\. 用于设置数据库的 DDL 和 2\. 每个表及其列的 C# 元数据。现在要扩展 DB 结构，只需编辑 XML 并重新运行该工具，它就可以让您立即轻松地从代码访问模式。

在不知不觉中，您已经拥有了自己的廉价和愉快的 Linq to SQL 预算版本！

（显然这已经偏离了主题，但为什么不在今年圣诞节用一种简单的方式编写插入语句呢？）

# wpf - 如何在 WPF 中实现搜索框的默认文本？

> ID：384264
> 
> 赞同：7
> 
> 时间：2008-12-21T08:41:43.137
> 
> 标签：wpf, search, textbox

我想为 WPF 搜索文本框实现与“[更改搜索框中的默认文本”完全相同的东西。](http://msdn.microsoft.com/en-us/library/aa905322.aspx)该框应在为空时显示一些灰色的“搜索..”文本，然后在输入文本时应正常运行。链接的文章显示了如何在 javascript 中执行此操作。在 WPF 中如何开始这条道路？到目前为止，我最好的想法是在主文本框之上的另一个文本框，只要搜索文本框获得焦点或文本，它就会变得不可见。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2011-04-18T19:11:17.140

此样式将使用背景属性和可视笔刷显示文本。一旦控制获得焦点，文本就会被删除。

```
 <TextBox.Style>
            <Style TargetType="TextBox">
                <Style.Triggers>
                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Text}" Value="">
                        <Setter Property="Background">
                            <Setter.Value>
                                <VisualBrush Stretch="None">
                                    <VisualBrush.Visual>
                                        <TextBlock Text="Enter value" Foreground="Gray"/>
                                    </VisualBrush.Visual>
                                </VisualBrush>
                            </Setter.Value>
                        </Setter>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=Text}" Value="{x:Null}">
                        <Setter Property="Background">
                            <Setter.Value>
                                <VisualBrush Stretch="None">
                                    <VisualBrush.Visual>
                                        <TextBlock Text="Enter value" Foreground="Gray"/>
                                    </VisualBrush.Visual>
                                </VisualBrush>
                            </Setter.Value>
                        </Setter>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=IsFocused}" Value="True">
                        <Setter Property="Background">
                            <Setter.Value>
                                <VisualBrush Stretch="None">
                                </VisualBrush>
                            </Setter.Value>
                        </Setter>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </TextBox.Style> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-21T10:46:54.523

试试 Kevin Moore 的 Bag-o-Tricks 中的 InfoTextBox 示例。您可以从 [http://work.j832.com/2008/01/real-update-to-bag-o-tricks.html下载它](http://work.j832.com/2008/01/real-update-to-bag-o-tricks.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-16T13:48:14.487

对于这些类型的事物，我认为最好的方法是使用视觉画笔设置背景。视觉画笔可让您使用视觉元素绘制背景，将其与基于文本为空的触发器结合起来，就完成了。

空列表框消息的示例在这里，基本上是一样的。 [http://adammills.wordpress.com/2010/08/04/simple-empty-template-for-itemscontrols/](http://adammills.wordpress.com/2010/08/04/simple-empty-template-for-itemscontrols/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T10:45:13.730

与 WPF 中的往常一样，有很多方法可以实现您的目标。

也许最干净的方法是子类化`TextBox`并添加一个名为`HintText`. `HintText`只要为`Text`空 ( ) ，控件的模板就会显示（可能以斜体和灰色`""`）。否则，它将`Text`像常规一样显示`TextBox`.

不涉及编写您自己的控件的另一种方法是重新模板`TextBox`并使用该`Tag`属性来存储提示文本。

另一种选择是编写 a `UserControl`，将 a`TextBox`与a 结合`TextBlock`在同一`Grid`. 将包含提示文本，并且仅在's为空`TextBlock`时才会显示。这可能是最容易实现的，但也是最不灵活的。`TextBox``Text`

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-08T19:46:00.897

我认为 WPF 扩展工具包中包含的 WatermarkTextBox 正是您想要的。

[http://wpftoolkit.codeplex.com/wikipage?title=WatermarkTextBox&referringTitle=Documentation](http://wpftoolkit.codeplex.com/wikipage?title=WatermarkTextBox&referringTitle=Documentation)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T09:53:58.983

您可以在文本框为空时将文本框转换为灰色文本，并使用一个变量告诉您​​该文本为空，这样当您单击“搜索”时，它就不会搜索“搜索...”

或者您可以使用与您所说的类似的内容，但不是上面的文本框，而是下面的文本。如果在顶部你有一个透明背景的文本框，在底部你有一个标签，当顶部文本框为空时，你有一个“搜索”标签，这应该可以解决问题。

# emacs - 如何在 Emacs 中重命名打开的文件？

> ID：384284
> 
> 赞同：264
> 
> 时间：2008-12-21T09:19:41.830
> 
> 标签：emacs

有没有办法在 Emacs 中重命名打开的文件？我在看的时候？类似另存为的东西，但原来的应该消失。

* * *

## 回答 #1

> 赞同：372
> 
> 时间：2008-12-21T16:09:21.847

是的，使用`dired`模式，您可以：

*   `C-x d`打开目录
*   `RET`选择当前文件的目录
*   `C-x C-j`（`dired-jump`到当前文件的名称，在 Dired 中）
*   `R`重命名文件（或`dired-do-rename`）。
*   `q`返回（重命名的）文件缓冲区

重命名相当于一个 shell `mv`，但它也会更新任何打开的缓冲区，并且`mv`不会改变文件系统中文件的访问和修改时间。

* * *

## 回答 #2

> 赞同：128
> 
> 时间：2009-10-10T17:12:22.520

只是为了完整起见，因为有些人可能会访问此页面，以为他们会得到 Emacs 的“另存为”功能的答案，即打开文件的 Cx Cw。

* * *

## 回答 #3

> 赞同：94
> 
> 时间：2008-12-21T11:09:41.247

试试[Steve Yegge 的 .emacs](http://steve.yegge.googlepages.com/my-dot-emacs-file)中的这个函数：

```
;; 来源：http://steve.yegge.googlepages.com/my-dot-emacs-file
(defun rename-file-and-buffer (new-name)
  “将当前缓冲区和它正在访问的文件重命名为 NEW-NAME。”
  （交互式“s新名称：”）
  （让（（名称（缓冲区名称））
        （文件名（缓冲区文件名）））
    （如果（不是文件名）
        （消息“缓冲区 '%s' 没有访问文件！”名称）
      （如果（获取缓冲区新名称）
          （消息“名为 '%s' 的缓冲区已存在！”新名称）
        （预测
          （重命名文件文件名新名称1）
          （重命名缓冲区新名称）
          （设置访问文件名新名称）
          (set-buffer-modified-p nil))))))

```

看看那个页面，那里还有另一个非常有用的相关函数，叫做“move-buffer-file”。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2014-08-08T21:15:34.690

我最喜欢的是 Magnars 中的那个（[emacs 摇滚截屏](http://emacsrocks.com)声名）。

与其他替代方案不同，您不必从头开始输入名称 - 您可以获得当前名称来修改。

```
(defun rename-current-buffer-file ()
  "Renames current buffer and file it is visiting."
  (interactive)
  (let* ((name (buffer-name))
        (filename (buffer-file-name))
        (basename (file-name-nondirectory filename)))
    (if (not (and filename (file-exists-p filename)))
        (error "Buffer '%s' is not visiting a file!" name)
      (let ((new-name (read-file-name "New name: " (file-name-directory filename) basename nil basename)))
        (if (get-buffer new-name)
            (error "A buffer named '%s' already exists!" new-name)
          (rename-file filename new-name 1)
          (rename-buffer new-name)
          (set-visited-file-name new-name)
          (set-buffer-modified-p nil)
          (message "File '%s' successfully renamed to '%s'"
                   name (file-name-nondirectory new-name))))))) 
```

感谢 James Yang 的正确版本。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-12-02T16:23:11.743

这是改编自 stevey 的更强大的版本。

```
;; Originally from stevey, adapted to support moving to a new directory.
(defun rename-file-and-buffer (new-name)
  "Renames both current buffer and file it's visiting to NEW-NAME."
  (interactive
   (progn
     (if (not (buffer-file-name))
         (error "Buffer '%s' is not visiting a file!" (buffer-name)))
     ;; Disable ido auto merge since it too frequently jumps back to the original
     ;; file name if you pause while typing. Reenable with C-z C-z in the prompt.
     (let ((ido-auto-merge-work-directories-length -1))
       (list (read-file-name (format "Rename %s to: " (file-name-nondirectory
                                                       (buffer-file-name))))))))
  (if (equal new-name "")
      (error "Aborted rename"))
  (setq new-name (if (file-directory-p new-name)
                     (expand-file-name (file-name-nondirectory
                                        (buffer-file-name))
                                       new-name)
                   (expand-file-name new-name)))
  ;; Only rename if the file was saved before. Update the
  ;; buffer name and visited file in all cases.
  (if (file-exists-p (buffer-file-name))
      (rename-file (buffer-file-name) new-name 1))
  (let ((was-modified (buffer-modified-p)))
    ;; This also renames the buffer, and works with uniquify
    (set-visited-file-name new-name)
    (if was-modified
        (save-buffer)
      ;; Clear buffer-modified flag caused by set-visited-file-name
      (set-buffer-modified-p nil)))

  (setq default-directory (file-name-directory new-name))

  (message "Renamed to %s." new-name)) 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2013-05-30T14:08:44.573

这是另一个版本，它非常健壮且具有 VC 意识：

```
(defun rename-file-and-buffer ()
  "Rename the current buffer and file it is visiting."
  (interactive)
  (let ((filename (buffer-file-name)))
    (if (not (and filename (file-exists-p filename)))
        (message "Buffer is not visiting a file!")
      (let ((new-name (read-file-name "New name: " filename)))
        (cond
         ((vc-backend filename) (vc-rename-file filename new-name))
         (t
          (rename-file filename new-name t)
          (set-visited-file-name new-name t t))))))) 
```

[你可以在这里](http://emacsredux.com/blog/2013/05/04/rename-file-and-buffer/)阅读更多关于它的信息。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2018-06-04T21:05:48.527

如果您使用的是[Spacemacs](http://spacemacs.org/)，那么您可以免费获得此行为，因为它带有`rename-current-buffer-file`（基于 magnars）的实现，默认绑定到`SPC-f-R`.

[https://github.com/syl20bnr/spacemacs/blob/bd7ef98e4c35fd87538dd2a81356cc83f5fd02f3/layers/%2Bdistributions/spacemacs-base/funcs.el#L294](https://github.com/syl20bnr/spacemacs/blob/bd7ef98e4c35fd87538dd2a81356cc83f5fd02f3/layers/%2Bdistributions/spacemacs-base/funcs.el#L294)

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2017-08-02T13:15:06.190

有一种非常简单的方法，你按下命令**Mx**然后输入**vc-rename-file**，然后你只需要在目录中选择你当前的文件，然后选择新的名称。已更改文件的 buff 将被刷新。

**来源：**[https ://www.gnu.org/software/emacs/manual/html_node/emacs/VC-Delete_002fRename.html](https://www.gnu.org/software/emacs/manual/html_node/emacs/VC-Delete_002fRename.html)

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2016-05-26T09:08:09.270

基于 magnars 版本，我修改如下，修复了 INIT 文件名部分：

```
(defun rename-current-buffer-file ()
  "Renames current buffer and file it is visiting."
  (interactive)
  (let* ((name (buffer-name))
        (filename (buffer-file-name))
        (basename (file-name-nondirectory filename)))
    (if (not (and filename (file-exists-p filename)))
        (error "Buffer '%s' is not visiting a file!" name)
      (let ((new-name (read-file-name "New name: " (file-name-directory filename) basename nil basename)))
        (if (get-buffer new-name)
            (error "A buffer named '%s' already exists!" new-name)
          (rename-file filename new-name 1)
          (rename-buffer new-name)
          (set-visited-file-name new-name)
          (set-buffer-modified-p nil)
          (message "File '%s' successfully renamed to '%s'"
                   name (file-name-nondirectory new-name))))))) 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2020-11-04T11:40:06.440

Emacs 26.3 (2020-04-03) 具有`rename-file`可`M-x rename-file`用于重命名当前文件或任何其他文件的函数。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2021-02-13T15:27:29.730

优秀的`crux` [包](https://github.com/bbatsov/crux)具有`crux-rename-file-and-buffer`（以及许多其他有用的功能）。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2013-05-27T02:49:14.943

它可以通过复制来实现。shift+c 在文件上，emacs 会要求你为包含文件名的路径指定一个名称，所以你只需提供新名称，然后输入...当然，你必须删除前一个。

# javascript - 如何检查 JavaScript 对象是否为 DOM 对象？

> ID：384286
> 
> 赞同：286
> 
> 时间：2008-12-21T09:26:05.047
> 
> 标签：javascript, dom, object

我试图得到：

```
document.createElement('div')  //=> true
{tagName: 'foobar something'}  //=> false 
```

在我自己的脚本中，我以前只是使用它，因为我不需要`tagName`作为属性：

```
if (!object.tagName) throw ...; 
```

因此，对于第二个对象，我提出了以下作为快速解决方案的解决方案——这主要是可行的。;)

问题是，它取决于强制执行只读属性的浏览器，而并非所有浏览器都这样做。

```
function isDOM(obj) {
  var tag = obj.tagName;
  try {
    obj.tagName = '';  // Read-only for DOM, should throw exception
    obj.tagName = tag; // Restore for normal objects
    return false;
  } catch (e) {
    return true;
  }
} 
```

有没有好的替代品？

* * *

## 回答 #1

> 赞同：335
> 
> 时间：2008-12-21T12:10:59.220

这可能很有趣：

```
function isElement(obj) {
  try {
    //Using W3 DOM2 (works for FF, Opera and Chrome)
    return obj instanceof HTMLElement;
  }
  catch(e){
    //Browsers not supporting W3 DOM2 don't have HTMLElement and
    //an exception is thrown and we end up here. Testing some
    //properties that all elements have (works on IE7)
    return (typeof obj==="object") &&
      (obj.nodeType===1) && (typeof obj.style === "object") &&
      (typeof obj.ownerDocument ==="object");
  }
} 
```

它是[DOM 的一部分，Level2](http://www.w3.org/TR/2003/REC-DOM-Level-2-HTML-20030109/html.html)。

**更新 2**：这是我在自己的库中实现它的方式：（之前的代码在 Chrome 中不起作用，因为 Node 和 HTMLElement 是函数而不是预期的对象。此代码在 FF3、IE7、Chrome 1 和 Opera 中进行了测试9）。

```
//Returns true if it is a DOM node
function isNode(o){
  return (
    typeof Node === "object" ? o instanceof Node : 
    o && typeof o === "object" && typeof o.nodeType === "number" && typeof o.nodeName==="string"
  );
}

//Returns true if it is a DOM element    
function isElement(o){
  return (
    typeof HTMLElement === "object" ? o instanceof HTMLElement : //DOM2
    o && typeof o === "object" && o !== null && o.nodeType === 1 && typeof o.nodeName==="string"
);
} 
```

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2016-04-27T15:53:25.460

以下 IE8 兼容、超级简单的代码完美运行。

接受的[答案](https://stackoverflow.com/a/384380/1204556)没有检测到所有类型的 HTML 元素。例如，不支持 SVG 元素。相比之下，这个答案适用于 HTML 和 SVG。

在此处查看实际操作：[https ://jsfiddle.net/eLuhbu6r/](https://jsfiddle.net/eLuhbu6r/)

```
function isElement(element) {
    return element instanceof Element || element instanceof HTMLDocument;  
} 
```

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2016-11-28T17:34:09.733

不需要 hack，你可以问一个元素是否是 DOM [Element](https://developer.mozilla.org/en-US/docs/Web/API/Element)的一个实例：

```
const isDOM = el => el instanceof Element 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-12-22T02:40:17.547

上面和下面的所有解决方案（包括我的解决方案）都存在不正确的可能性，尤其是在 IE 上 - 很有可能（重新）定义一些对象/方法/属性来模拟 DOM 节点，从而使测试无效。

所以通常我使用鸭式测试：我专门针对我使用的东西进行测试。例如，如果我想克隆一个节点，我会像这样测试它：

```
if(typeof node == "object" && "nodeType" in node &&
   node.nodeType === 1 && node.cloneNode){
  // most probably this is a DOM node, we can clone it safely
  clonedNode = node.cloneNode(false);
} 
```

基本上，这是对我计划使用的方法（或属性）的一点完整性检查 + 直接测试。

顺便说一句，上面的测试对所有浏览器上的 DOM 节点都是一个很好的测试。但是，如果您想安全起见，请始终检查方法和属性的存在并验证它们的类型。

**编辑：** IE 使用 ActiveX 对象来表示节点，因此它们的属性不像真正的 JavaScript 对象，例如：

```
console.log(typeof node.cloneNode);              // object
console.log(node.cloneNode instanceof Function); // false 
```

而它应该`true`分别返回“函数”和。测试方法的唯一方法是查看是否已定义。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-12-21T10:15:30.593

您可以尝试将其附加到真实的 DOM 节点...

```
function isDom(obj)
{
    var elm = document.createElement('div');
    try
    {
        elm.appendChild(obj);
    }
    catch (e)
    {
        return false;
    }

    return true;
} 
```

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2017-06-15T11:37:41.730

测试变量是否为 DOM 元素的简单方法（冗长，但更传统的语法:-)

```
function isDomEntity(entity) {
  if(typeof entity  === 'object' && entity.nodeType !== undefined){
     return true;
  }
  else{
     return false;
  }
} 
```

或者正如[HTMLGuy](https://stackoverflow.com/users/1521341/htmlguy)建议的那样（简洁明了的语法）：

```
const isDomEntity = typeof entity === 'object' && entity.nodeType !== undefined 
```

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-12-21T09:52:12.200

这是来自可爱的 JavaScript 库[MooTools](http://en.wikipedia.org/wiki/MooTools)：

```
if (obj.nodeName){
    switch (obj.nodeType){
    case 1: return 'element';
    case 3: return (/\S/).test(obj.nodeValue) ? 'textnode' : 'whitespace';
    }
} 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2014-11-24T19:07:22.507

[Lo-Dash的`_.isElement`](https://lodash.com/docs#isElement)怎么样？

```
$ npm install lodash.iselement 
```

在代码中：

```
var isElement = require("lodash.iselement");
isElement(document.body); 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-03-02T19:00:48.823

**旧线程，但这里是ie8 和 ff3.5**用户的更新可能性：

```
function isHTMLElement(o) {
    return (o.constructor.toString().search(/\object HTML.+Element/) > -1);
} 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2013-12-09T17:14:47.980

[使用此处](https://stackoverflow.com/questions/223991/how-can-i-get-the-window-object-that-an-html-node-belongs-to-using-javascript "如何-我-获得-窗口-对象-那个-一个-html-节点-属于-to")找到的根检测，我们可以确定例如*alert*是否是对象根的成员，那么它很可能是一个窗口：

```
function isInAnyDOM(o) { 
  return (o !== null) && !!(o.ownerDocument && (o.ownerDocument.defaultView || o.ownerDocument.parentWindow).alert); // true|false
} 
```

判断对象是否为当前窗口就更简单了：

```
function isInCurrentDOM(o) { 
  return (o !== null) && !!o.ownerDocument && (window === (o.ownerDocument.defaultView || o.ownerDocument.parentWindow)); // true|false
} 
```

这似乎比打开线程中的 try/catch 解决方案便宜。

唐·P

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-12-22T00:26:12.307

```
var IsPlainObject = function ( obj ) { return obj instanceof Object && ! ( obj instanceof Function || obj.toString( ) !== '[object Object]' || obj.constructor.name !== 'Object' ); },
    IsDOMObject = function ( obj ) { return obj instanceof EventTarget; },
    IsDOMElement = function ( obj ) { return obj instanceof Node; },
    IsListObject = function ( obj ) { return obj instanceof Array || obj instanceof NodeList; }, 
```

// 实际上我更可能不会使用这些内联，但有时最好有这些快捷方式用于设置代码

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-10-21T22:28:48.073

这可能会有所帮助：**[isDOM](http://jherax.github.io/#isdom-object)**

```
//-----------------------------------
// Determines if the @obj parameter is a DOM element
function isDOM (obj) {
    // DOM, Level2
    if ("HTMLElement" in window) {
        return (obj && obj instanceof HTMLElement);
    }
    // Older browsers
    return !!(obj && typeof obj === "object" && obj.nodeType === 1 && obj.nodeName);
} 
```

在上面的代码中，我们使用**双重否定**运算符来获取作为参数传递的对象的布尔值，这样我们确保条件语句中评估的每个表达式都是布尔值，利用**[Short-Circuit Evaluation](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Logical_Operators#Short-Circuit_Evaluation)**，因此函数返回`true`或`false`

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2015-11-04T10:43:58.283

我认为原型设计不是一个很好的解决方案，但也许这是最快的一个：定义这个代码块；

```
Element.prototype.isDomElement = true;
HTMLElement.prototype.isDomElement = true; 
```

比检查你的对象 isDomElement 属性：

```
if(a.isDomElement){} 
```

我希望这有帮助。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2012-08-23T16:43:59.727

您可以查看相关对象或节点是否返回字符串类型。

```
typeof (array).innerHTML === "string" => false
typeof (object).innerHTML === "string" => false
typeof (number).innerHTML === "string" => false
typeof (text).innerHTML === "string" => false

//any DOM element will test as true
typeof (HTML object).innerHTML === "string" => true
typeof (document.createElement('anything')).innerHTML === "string" => true 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2014-12-30T12:22:02.727

对于使用 Angular 的用户：

```
angular.isElement 
```

[https://docs.angularjs.org/api/ng/function/angular.isElement](https://docs.angularjs.org/api/ng/function/angular.isElement)

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2018-12-27T14:22:13.630

根据[mdn](https://developer.mozilla.org/en-US/docs/Web/API/Element)

> `Element`是最通用的基类，所有对象都从该基类`Document`继承。它只有各种元素共有的方法和属性。

我们可以`isElement`通过原型来实现。这是我的建议：

```
/**
 * @description detect if obj is an element
 * @param {*} obj
 * @returns {Boolean}
 * @example
 * see below
 */
function isElement(obj) {
  if (typeof obj !== 'object') {
    return false
  }
  let prototypeStr, prototype
  do {
    prototype = Object.getPrototypeOf(obj)
    // to work in iframe
    prototypeStr = Object.prototype.toString.call(prototype)
    // '[object Document]' is used to detect document
    if (
      prototypeStr === '[object Element]' ||
      prototypeStr === '[object Document]'
    ) {
      return true
    }
    obj = prototype
    // null is the terminal of object
  } while (prototype !== null)
  return false
}
console.log(isElement(document)) // true
console.log(isElement(document.documentElement)) // true
console.log(isElement(document.body)) // true
console.log(isElement(document.getElementsByTagName('svg')[0])) // true or false, decided by whether there is svg element
console.log(isElement(document.getElementsByTagName('svg'))) // false
console.log(isElement(document.createDocumentFragment())) // false
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2008-12-21T09:53:10.763

我认为您需要做的是彻底检查一些始终在 dom 元素中的属性，但它们的组合*很可能*不会在另一个对象中，如下所示：

```
var isDom = function (inp) {
    return inp && inp.tagName && inp.nodeName && inp.ownerDocument && inp.removeAttribute;
}; 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2008-12-21T15:50:19.373

在 Firefox 中，您可以使用`instanceof Node`. 这是在[DOM1](http://www.w3.org/TR/2000/WD-DOM-Level-1-20000929/level-one-core.html#ID-1950641247)`Node`中定义的。

但这在 IE 中并不容易。

1.  “instanceof ActiveXObject”只能判断它是本机对象。
2.  "typeof document.body.appendChild=='object'" 告诉它可能是 DOM 对象，但也可以是其他具有相同功能的东西。

您只能通过使用 DOM 函数确保它是 DOM 元素并捕获任何异常。但是，它可能会产生副作用（例如更改对象内部状态/性能/内存泄漏）

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-01-05T00:34:40.787

也许这是另一种选择？在 Opera 11、FireFox 6、Internet Explorer 8、Safari 5 和 Google Chrome 16 中测试。

```
function isDOMNode(v) {
  if ( v===null ) return false;
  if ( typeof v!=='object' ) return false;
  if ( !('nodeName' in v) ) return false; 

  var nn = v.nodeName;
  try {
    // DOM node property nodeName is readonly.
    // Most browsers throws an error...
    v.nodeName = 'is readonly?';
  } catch (e) {
    // ... indicating v is a DOM node ...
    return true;
  }
  // ...but others silently ignore the attempt to set the nodeName.
  if ( v.nodeName===nn ) return true;
  // Property nodeName set (and reset) - v is not a DOM node.
  v.nodeName = nn;

  return false;
} 
```

函数不会被例如这个所愚弄

```
isDOMNode( {'nodeName':'fake'} ); // returns false 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2013-02-07T00:38:29.567

这就是我想出的：

```
var isHTMLElement = (function () {
    if ("HTMLElement" in window) {
        // Voilà. Quick and easy. And reliable.
        return function (el) {return el instanceof HTMLElement;};
    } else if ((document.createElement("a")).constructor) {
        // We can access an element's constructor. So, this is not IE7
        var ElementConstructors = {}, nodeName;
        return function (el) {
            return el && typeof el.nodeName === "string" &&
                 (el instanceof ((nodeName = el.nodeName.toLowerCase()) in ElementConstructors 
                    ? ElementConstructors[nodeName] 
                    : (ElementConstructors[nodeName] = (document.createElement(nodeName)).constructor)))
        }
    } else {
        // Not that reliable, but we don't seem to have another choice. Probably IE7
        return function (el) {
            return typeof el === "object" && el.nodeType === 1 && typeof el.nodeName === "string";
        }
    }
})(); 
```

为了提高性能，我创建了一个自调用函数，它只测试一次浏览器的功能并相应地分配适当的函数。

第一个测试应该适用于大多数现代浏览器，并且已经在这里讨论过。它只是测试元素是否是`HTMLElement`. 非常简单。

第二个是最有趣的。这是它的核心功能：

```
return el instanceof (document.createElement(el.nodeName)).constructor 
```

它测试 el 是否是它所伪装的构造函数的一个实例。为此，我们需要访问元素的构造函数。这就是我们在 if 语句中测试它的原因。例如 IE7 失败了，因为`(document.createElement("a")).constructor`它`undefined`在 IE7 中。

这种方法的问题在于，`document.createElement`它确实不是最快的功能，如果你用它测试很多元素，它很容易减慢你的应用程序。为了解决这个问题，我决定缓存构造函数。该对象`ElementConstructors`将 nodeNames 作为键，并将其相应的构造函数作为值。如果构造函数已经被缓存，它会从缓存中使用它，否则它会创建元素，缓存其构造函数以供将来访问，然后对其进行测试。

第三个测试是令人不快的回退。它测试 el 是否为`object`，是否有一个`nodeType`属性设置为`1`，一个字符串为`nodeName`。这当然不是很可靠，但绝大多数用户甚至不应该退缩到现在。

这是我想出的最可靠的方法，同时仍然保持尽可能高的性能。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2014-04-28T13:53:00.653

测试是否`obj`继承自[Node](https://developer.mozilla.org/en/docs/Web/API/Node)。

```
if (obj instanceof Node){
    // obj is a DOM Object
} 
```

Node 是HTMLElement 和 Text 继承的基本[接口。](https://developer.mozilla.org/en-US/docs/DOM/DOM_Reference)

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2015-05-30T01:37:34.993

这几乎适用于任何浏览器。（这里没有元素和节点的区别）

```
function dom_element_check(element){
    if (typeof element.nodeType !== 'undefined'){
        return true;
    }
    return false;
} 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2015-12-28T12:41:51.957

将原始 js 对象与 HTMLElement 区分开来

```
function isDOM (x){
     return /HTML/.test( {}.toString.call(x) );
 } 
```

采用：

```
isDOM( {a:1} ) // false
isDOM( document.body ) // true 
```

// 或者

```
Object.defineProperty(Object.prototype, "is",
    {
        value: function (x) {
            return {}.toString.call(this).indexOf(x) >= 0;
        }
    }); 
```

采用：

`o={}; o.is("HTML") // false o=document.body; o.is("HTML") // true`

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2021-07-07T03:55:46.410

这是我的版本。它支持来自 iframe 的元素

```
/**
 * @param {any} value
 * @param {any} view Optional. If the value is from an iframe, provide the iframe content window here.
 * @returns {boolean}
 */
function isHtmlElement(value, view) {
  if (value instanceof HTMLElement) return true
  if (view && value instanceof view.HTMLElement) return true

  return !!(
    value &&
    typeof value === 'object' &&
    value !== null &&
    value.nodeType === 1 &&
    typeof value.nodeName === 'string'
  )
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2013-11-09T14:41:08.573

这是一个使用 jQuery 的技巧

```
var obj = {};
var element = document.getElementById('myId'); // or simply $("#myId")

$(obj).html() == undefined // true
$(element).html() == undefined // false 
```

所以把它放在一个函数中：

```
function isElement(obj){

   return (typeOf obj === 'object' && !($(obj).html() == undefined));

} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2014-08-14T21:35:06.813

不要重蹈覆辙，但对于符合 ES5 的浏览器，为什么不只是：

```
function isDOM(e) {
  return (/HTML(?:.*)Element/).test(Object.prototype.toString.call(e).slice(8, -1));
} 
```

不适用于 TextNodes 并且不确定 Shadow DOM 或 DocumentFragments 等，但适用*于*几乎所有 HTML 标签元素。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2016-05-06T19:56:46.130

一个绝对正确的方法，检查目标是一个**真正的**html元素初级代码：

```
 (function (scope) {
        if (!scope.window) {//May not run in window scope
            return;
        }
        var HTMLElement = window.HTMLElement || window.Element|| function() {};

        var tempDiv = document.createElement("div");
        var isChildOf = function(target, parent) {

            if (!target) {
                return false;
            }
            if (parent == null) {
                parent = document.body;
            }
            if (target === parent) {
                return true;
            }
            var newParent = target.parentNode || target.parentElement;
            if (!newParent) {
                return false;
            }
            return isChildOf(newParent, parent);
        }
        /**
         * The dom helper
         */
        var Dom = {
            /**
             * Detect if target element is child element of parent
             * @param {} target The target html node
             * @param {} parent The the parent to check
             * @returns {} 
             */
            IsChildOf: function (target, parent) {
                return isChildOf(target, parent);
            },
            /**
             * Detect target is html element
             * @param {} target The target to check
             * @returns {} True if target is html node
             */
            IsHtmlElement: function (target) {
                if (!X.Dom.IsHtmlNode(target)) {
                    return false;
                }
                return target.nodeType === 1;
            },
            /**
             * Detect target is html node
             * @param {} target The target to check
             * @returns {} True if target is html node
             */
            IsHtmlNode:function(target) {
                if (target instanceof HTMLElement) {
                    return true;
                }
                if (target != null) {
                    if (isChildOf(target, document.documentElement)) {
                        return true;
                    }
                    try {
                        tempDiv.appendChild(target.cloneNode(false));
                        if (tempDiv.childNodes.length > 0) {
                            tempDiv.innerHTML = "";
                            return true;
                        }
                    } catch (e) {

                    }
                }
                return false;
            }
        };
        X.Dom = Dom;
    })(this); 
```

[![在 IE 5 中测试](https://i.stack.imgur.com/3WdVO.png)](https://i.stack.imgur.com/3WdVO.png)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2016-10-15T18:15:28.177

我有一种特殊的方法可以做到这一点，但答案中尚未提及。

我的解决方案基于四个测试。如果对象通过了所有四个，那么它就是一个元素：

1.  对象不为空。

2.  该对象有一个名为“appendChild”的方法。

3.  “appendChild”方法继承自**Node**类，它不仅仅是一个冒名顶替的方法（用户创建的具有相同名称的属性）。

4.  该对象属于节点类型 1（元素）。**从Node**类继承方法的对象总是 Node，但不一定是 Element。

问：我如何检查给定的财产是否是继承的，而不仅仅是冒名顶替者？

A：判断一个方法是否真正继承自**Node**的一个简单测试是首先验证该属性的类型是否为“对象”或“函数”。接下来，将属性转换为字符串并检查结果是否包含文本“[Native Code]”。如果结果看起来像这样：

```
function appendChild(){
[Native Code]
} 
```

然后该方法已从 Node 对象继承。见[https://davidwalsh.name/detect-native-function](https://davidwalsh.name/detect-native-function)

最后，将所有测试放在一起，解决方案是：

```
function ObjectIsElement(obj) {
    var IsElem = true;
    if (obj == null) {
        IsElem = false;
    } else if (typeof(obj.appendChild) != "object" && typeof(obj.appendChild) != "function") {
        //IE8 and below returns "object" when getting the type of a function, IE9+ returns "function"
        IsElem = false;
    } else if ((obj.appendChild + '').replace(/[\r\n\t\b\f\v\xC2\xA0\x00-\x1F\x7F-\x9F ]/ig, '').search(/\{\[NativeCode]}$/i) == -1) {
        IsElem = false;
    } else if (obj.nodeType != 1) {
        IsElem = false;
    }
    return IsElem;
} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2016-10-18T19:00:49.110

每个**DOMElement.constructor**返回*函数 HTML...Element()*或*[Object HTML...Element]*所以...

```
function isDOM(getElem){
    if(getElem===null||typeof getElem==="undefined") return false;
    var c = getElem.constructor.toString();
    var html = c.search("HTML")!==-1;
    var element = c.search("Element")!==-1;
    return html&&element;
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2017-02-10T10:46:16.090

```
(element instanceof $ && element.get(0) instanceof Element) || element instanceof Element 
```

这将检查它是否是 jQuery 或 JavaScript DOM 元素

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2020-04-12T12:58:26.350

保证您检查的是实际的 HTML 元素，而不仅仅是与 HTML 元素具有相同属性的对象的唯一方法是确定它是否从 Node 继承，因为在 JavaScript 中创建新的 Node() 是不可能的。（除非本机 Node 函数被覆盖，但是你不走运）。所以：

```
function isHTML(obj) {
    return obj instanceof Node;
}

console.log(
  isHTML(test),
  isHTML(ok),
  isHTML(p),
  isHTML(o),
  isHTML({
    constructor: {
      name: "HTML"
    }
  }),
  isHTML({
    __proto__: {
      __proto__: {
        __proto__: {
          __proto__: {
            constructor: {
              constructor: { 
                name: "Function"

              },
              name: "Node"
            }
          }
        }
      }
    }
  }),
)
```

```
<div id=test></div>
<blockquote id="ok"></blockquote>
<p id=p></p>
<br id=o>
<!--think of anything else you want--!>
```

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2012-03-29T10:47:10.757

```
var isElement = function(e){
    try{
        // if e is an element attached to the DOM, we trace its lineage and use native functions to confirm its pedigree
        var a = [e], t, s, l = 0, h = document.getElementsByTagName('HEAD')[0], ht = document.getElementsByTagName('HTML')[0];
        while(l!=document.body&&l!=h&&l.parentNode) l = a[a.push(l.parentNode)-1];
        t = a[a.length-1];
        s = document.createElement('SCRIPT');   // safe to place anywhere and it won't show up
        while(a.length>1){  // assume the top node is an element for now...
            var p = a.pop(),n = a[a.length-1];
            p.insertBefore(s,n);
        }
        if(s.parentNode)s.parentNode.removeChild(s);
        if(t!=document.body&&t!=h&&t!=ht)
            // the top node is not attached to the document, so we don't have to worry about it resetting any dynamic media
            // test the top node
            document.createElement('DIV').appendChild(t).parentNode.removeChild(t);
        return e;
    }
    catch(e){}
    return null;
} 
```

我在 Firefox、Safari、Chrome、Opera 和 IE9 上对此进行了测试。我找不到破解它的方法。
从理论上讲，它通过在它之前插入一个脚本标记来测试提议元素的每个祖先以及元素本身。
如果它的第一个祖先追溯到一个已知元素，例如`<html>`、`<head>`或`<body>`，并且在此过程中没有抛出错误，那么我们就有了一个元素。
如果第一个祖先没有附加到文档，我们创建一个元素并尝试将提议的元素放置在其中，（然后将其从新元素中删除）。
因此，它要么追溯到已知元素，要么成功附加到已知元素，要么失败。
如果它不是元素，则返回元素或 null。

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2013-08-15T06:54:09.900

检测元素是否属于 HTML DOM 的最简单和跨浏览器的方法如下：

```
function inHTMLDom(myelement){
    if(myelement.ownerDocument.documentElement.tagName.toLowerCase()=="html"){
        return true;
    }else{
        return false;
    }
}

inHTMLDom(<your element>); // <your element>:element you are interested in checking. 
```

在 IE6、IE7、IE8、IE9、IE10、FF、Chrome、Safari、Opera 中测试。

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2016-08-28T22:16:27.183

大多数答案使用某种鸭子类型，例如检查对象是否具有`nodeType`属性。但这还不够，因为非节点也可以具有类似节点的属性。

另一种常见的方法是`instanceof`，它可能会产生误报，例如 with `Object.create(Node)`，尽管继承了节点属性，但它不是节点。

此外，上述两种方法都调用内部基本方法，这可能会出现问题，例如，如果测试值是代理。

相反，我推荐的是借用一个节点方法并在我们的对象上调用它。浏览器可能会通过查看代理中不可自定义的内部插槽来检查该值是否为节点，因此即使它们也不会干扰我们的检查。

```
function isNode(value) {
  try {
    Node.prototype.cloneNode.call(value, false);
    return true;
  } catch(err) {
    return false;
  }
} 
```

如果您愿意，也可以使用属性获取器。

```
function isNode(value) {
  try {
    Object.getOwnPropertyDescriptor(Node.prototype,'nodeType').get.call(value);
    return true;
  } catch(err) {
    return false;
  }
}
```

同样，如果你想测试一个值是否是一个元素，你可以使用

```
function isElement(value) {
  try {
    Element.prototype.getAttribute.call(value, '');
    return true;
  } catch(err) {
    return false;
  }
} 
```

```
function isHTMLElement(value) {
  try {
    HTMLElement.prototype.click.call(value);
    return true;
  } catch(err) {
    return false;
  }
} 
```

* * *

## 回答 #35

> 赞同：-1
> 
> 时间：2020-05-15T03:58:52.747

如果你使用 jQuery，试试这个

```
$('<div>').is('*') // true
$({tagName: 'a'}).is('*') // false
$({}).is('*') // false
$([]).is('*') // false
$(0).is('*') // false
$(NaN).is('*') // false 
```

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2021-04-07T11:00:53.263

我使用这个功能：

```
function isHTMLDOMElement(obj) {
  if (Object.prototype.toString.call(obj).slice(-8) === 'Element]') {
    if (Object.prototype.toString.call(obj).slice(0, 12) === '[object HTML') {
      return true;
    }
    return false;
  }
  return false;
}
```

[https://jsfiddle.net/1qazxsw2/wz7e0fvj/9/](https://jsfiddle.net/1qazxsw2/wz7e0fvj/9/)

# python - 代码重构帮助 - 如何重新组织验证

> ID：384291
> 
> 赞同：0
> 
> 时间：2008-12-21T09:40:28.400
> 
> 标签：python, django, optimization, refactoring, web-applications

我们有一个 Web 应用程序，它接受用户输入或数据库查找来对一些物理资源进行一些操作。该设计可以简单地表示为下图：

用户输入 <=> 模型对象 <=> 数据库存储

来自用户输入的请求需要验证，但来自数据库查找命中时不需要验证（因为如果存在记录，则这些属性之前必须已经过验证）。我正在尝试重构代码，以便验证发生在对象构造函数中，而不是旧方式（单独的几个验证例程）

您将如何决定哪种方式更好？（方法 1（旧方法）和 2 的根本区别在于 1 中的验证不是强制性的，并且与对象实例化解耦，但 2 绑定它们并使它们对所有请求都是强制性的）

以下是设计 1 和 2 的两个示例代码片段：

方法一：

```
# For processing single request.
# Steps: 1\. Validate all incoming data. 2\. instantiate the object.
ValidateAttribures(request) # raise Exceptions if failed
resource = Resource(**request) 
```

方法二：

```
# Have to extract out this since it does not have anything to do with
# the object.
# raise Exceptions if some required params missing.
# steps: 1\. Check whether its a batching request. 2\. instantiate the object.
#           (validations are performed inside the constructor)
CheckIfBatchRequest(request) 
resource = Resource(**request) # raise Exceptions when validations failed 
```

在批量请求中：方法 1：

```
# steps: 1\. validate each request and return error to the client if any found.
#        2\. perform the object instantiate and creation process. Exceptions are
#           captured.
#        3\. when all finished, email out any errors.
for request in batch_requests:
    try:    
        ValidateAttribute(request)
    except SomeException, e:
        return ErrorPage(e)
errors = []
for request in batch_requests:
    try:
        CreatResource(Resource(**request), request)
    except CreationError, e:
        errors.append('failed to create with error: %s', e)
email(errors) 
```

方法二：

```
# steps: 1\. validate batch job related data from the request.
#        2\. If success, create objects for each request and do the validations.
#        3\. If exception, return error found, otherwise, 
#           return a list of pairs with (object, request)
#        4\. Do the creation process and email out any errors if encountered.
CheckIfBatchRequest(request)
request_objects = []
for request in batch_requests:
    try:
        resource = Resource(**request)
    except SomeException, e:
        return ErrorPage(e)
    request_objects.append((resource, request))
email(CreateResource(request_objects)) # the CreateResource will also need to be refactored. 
```

我在这里看到的优点和缺点是：

1.  方法一更贴近业务逻辑。当对象来自数据库查找时，没有多余的验证检查。验证例程更易于维护和阅读。
2.  方法 2 使调用者变得简单而干净。即使来自数据库查找，验证也是强制性的。验证的可维护性和可读性较差。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T18:46:17.753

在构造函数中进行验证确实不是“Django 方式”。由于您需要验证的数据来自客户端，因此使用[新表单](http://docs.djangoproject.com/en/dev/topics/forms/)（可能使用[ModelForm](http://docs.djangoproject.com/en/dev/topics/forms/modelforms/#topics-forms-modelforms)）是最惯用的验证方法，因为它将您的所有关注点包装到一个 API 中：它提供了合理的验证默认值（使用轻松定制的能力），加上模型表单将数据输入端（html表单）与数据提交（model.save（））集成在一起。

然而，听起来你有一个遗留项目可能是一团糟。重写所有表单处理以使用新表单可能超出了您的时间范围，至少在最初是这样。所以这是我的想法：

首先，在模型本身中进行一些验证并不是“非 Djangonic”——毕竟 html 表单提交可能不是新数据的唯一来源。您可以覆盖 save() 方法或使用[信号](http://docs.djangoproject.com/en/dev/ref/models/instances/#what-happens-when-you-save)来清除保存时的数据或对无效数据抛出异常。从长远来看，Django 会有模型验证，但还没有；在此期间，您应该将其视为“安全”，以确保您不会将无效数据提交到数据库。换句话说，您仍然需要在提交之前逐个字段验证，以便您知道在无效输入时向用户显示什么错误。

我建议的是这个。为您需要验证的每个项目创建新的表单类，即使您最初没有使用它们。 [Malcolm Tredinnick](http://www.pointy-stick.com/blog/2008/10/15/django-tip-poor-mans-model-validation/)概述了一种使用表单系统中提供的挂钩进行模型验证的技术。阅读它（它真的非常简单和优雅），并连接到你的模型中。一旦你定义了新表单类并开始工作，你会发现这不是很困难——实际上会大大简化你的代码——如果你去掉现有的表单模板和相应的验证，并使用处理你的表单 POST形成框架。有一点学习曲线，但是表单 API 是经过深思熟虑的，你会很感激它会让你的代码变得更加简洁。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-21T20:28:35.597

感谢丹尼尔的回复。特别是对于 newforms API，我一定会花时间深入研究它，看看我是否可以采用它以获得更好的长期利益。但只是为了完成这次迭代的工作（在 EOY 之前满足我的最后期限），我可能仍然必须坚持当前的遗留结构，毕竟，无论哪种方式都会让我得到我想要的，只是这样我想让它尽可能保持理智和清洁，而不会破坏太多。

所以听起来在模型中进行验证并不是一个坏主意，但从另一个意义上说，我在视图中针对请求进行验证的旧方法似乎也接近将它们封装在 newforms API 中的概念（数据验证与模型创建）。你认为保留我的旧设计可以吗？对我来说，用 newforms API 来解决这个问题而不是现在就玩弄它们更有意义......

（好吧，我从我的代码审阅者那里得到了这个重构建议，但我真的不太确定我的旧方法是否违反了任何 mvc 模式或太复杂而无法维护。我认为我的方式更有意义，但我的审阅者认为绑定验证和模型创建一起使更有意义...）

# c# - InternalEquals(object objA, object objB) 的实现在哪里

> ID：384294
> 
> 赞同：5
> 
> 时间：2008-12-21T09:43:53.683
> 
> 标签：c#, .net, equals, class-library

在使用 Reflector 反汇编 .Net 源代码时，我发现了 Object Class 中的 Equals 实现，它指的是

```
bool InternalEquals(object objA, object objB); 
```

这又是指

```
internal static extern bool InternalEquals(object objA, object objB); 
```

我现在很困惑在哪里可以找到这个`InternalEquals(object objA, object objB)`函数的实现，它是如何使用这个函数的，这个函数是在哪个 .Net 程序集中定义的，以及如果每个东西都是从头开始为 .Net 源代码编写的，那么为什么我找不到这个函数的实现。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-21T09:45:01.870

它被声明为`[MethodImpl(MethodImplOptions.InternalCall)]`. 这意味着它是在 CLR 本身中实现的，作为本机过程，而不是 .NET 程序集。

您可以通过查看[Microsoft SSCLI (aka Rotor)](http://www.microsoft.com/downloads/details.aspx?FamilyId=8C09FD61-3F26-4555-AE17-3121B4F51D4D&displaylang=en)来查看类似的 CLR 源代码。

在 SSCLI 2.0 中，它被实现为 (in `sscli20/clr/src/vm/comobject.cpp`)：

```
FCIMPL2(FC_BOOL_RET, ObjectNative::Equals, Object *pThisRef, Object *pCompareRef)
{
    CONTRACTL
    {
        THROWS;
        DISABLED(GC_NOTRIGGER);
        INJECT_FAULT(FCThrow(kOutOfMemoryException););
        MODE_COOPERATIVE;
        SO_TOLERANT;          
    }
    CONTRACTL_END;

    if (pThisRef == pCompareRef)    
        FC_RETURN_BOOL(TRUE);

    // Since we are in FCALL, we must handle NULL specially.
    if (pThisRef == NULL || pCompareRef == NULL)
         FC_RETURN_BOOL(FALSE);

    MethodTable *pThisMT = pThisRef->GetMethodTable();

    // If it's not a value class, don't compare by value
    if (!pThisMT->IsValueClass())
         FC_RETURN_BOOL(FALSE);

    // Make sure they are the same type.
    if (pThisMT != pCompareRef->GetMethodTable())
        FC_RETURN_BOOL(FALSE);

    // Compare the contents (size - vtable - sink block index).
    BOOL ret = memcmp(
        (void *) (pThisRef+1), 
        (void *) (pCompareRef+1), 
        pThisRef->GetMethodTable()->GetBaseSize() - sizeof(Object) - sizeof(int)) == 0;

    FC_GC_POLL_RET();

    FC_RETURN_BOOL(ret);
}
FCIMPLEND 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-08T02:01:10.583

首先，在 sscli20\clr\src\vm\ecall.cpp 中找到函数映射（"InternalEquals" -> ObjectNative::Equals）：

```
FCFuncStart(gObjectFuncs)
    FCIntrinsic("GetType", ObjectNative::GetClass, CORINFO_INTRINSIC_Object_GetType)
    FCFuncElement("InternalGetHashCode", ObjectNative::GetHashCode)
    FCFuncElement("InternalEquals", ObjectNative::Equals)
    FCFuncElement("MemberwiseClone", ObjectNative::Clone)
FCFuncEnd() 
```

接下来，找到一个实现 ObjectNative::Equals（由 Mehrdad Afshari 发布）

# c# - Creating local user account c# and .NET 2.0

> ID：384304
> 
> 赞同：20
> 
> 时间：2008-12-21T09:53:43.087
> 
> 标签：c#, .net, account

How can I create a local user account using .NET 2.0 and c# and also be able to set the "Password never expires" to never.

I have tried using "Net.exe" using Process.Start and passing its parameters but it seems that the "net user" is unable to set the "Password never expires" to never.

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-24T11:52:39.420

This code will create a local account with the password never expires option set:

```
 using System.DirectoryServices;

        DirectoryEntry hostMachineDirectory = new DirectoryEntry("WinNT://localhost");
        DirectoryEntries entries = hostMachineDirectory.Children;
        bool userExists = false;
        foreach (DirectoryEntry each in entries)
        {
            userExists = each.Name.Equals("NewUser",  
            StringComparison.CurrentCultureIgnoreCase);
            if (systemtestUserExists)
                break;
        }

        if (false == userExists)
        {
            DirectoryEntry obUser = entries.Add("NewUser", "User");
            obUser.Properties["FullName"].Add("Local user");
            obUser.Invoke("SetPassword", "abcdefg12345@");
            obUser.Invoke("Put", new object[] {"UserFlags", 0x10000});
            obUser.CommitChanges();
        } 
```

The 0x10000 flag means PasswordNeverExpires.

I spent a long time figuring out how to create a local user account with the password set not to expire. It seems that when you try to use:

```
int val = (int)newUser.Properties["userAccountControl"].Value; 
newUser.Properties["userAccountControl"].Value = val | 0x10000 
```

permissions from active directory come into play. If you have active directory permissions everything works fine. If you don't then getting the userAccountControl property will always result in a null value. Trying to set userAccountControl will result in an exception "The directory property cannot be found in the cache".

However after much hunting around I found another property "UserFlags" that needs to be set using Invoke. You can use this to set the flag on a local account. I've tried this code and it worked on windows server 2008.

Hope this helps

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-12-21T10:02:05.113

Read this excellent CodeProject article

[**Howto: (Almost) Everything In Active Directory via C#**](http://www.codeproject.com/KB/system/everythingInAD.aspx)

There is a section "Create User Account" and "Dealing with User Passwords".

**UPDATE:**

*To adapt the code for local accounts replace the respective lines with these:*

```
DirectoryEntry localMachine = new DirectoryEntry("WinNT://" + 
    Environment.MachineName);
DirectoryEntry newUser = localMachine.Children.Add("localuser", "user"); 
```

*Here starts the original code snippet for domain accounts:*

```
public string CreateUserAccount(string ldapPath, string userName, 
    string userPassword)
{
    string oGUID = string.Empty;
    try
    {          
        string connectionPrefix = "LDAP://" + ldapPath;
        DirectoryEntry dirEntry = new DirectoryEntry(connectionPrefix);
        DirectoryEntry newUser = dirEntry.Children.Add
            ("CN=" + userName, "user");
        newUser.Properties["samAccountName"].Value = userName;

        int val = (int)newUser.Properties["userAccountControl"].Value; 
        newUser.Properties["userAccountControl"].Value = val | 0x10000; 

        newUser.CommitChanges();
        oGUID = newUser.Guid.ToString();

        newUser.Invoke("SetPassword", new object[] { userPassword });
        newUser.CommitChanges();

        dirEntry.Close();
        newUser.Close();
    }
    catch (System.DirectoryServices.DirectoryServicesCOMException E)
    {
        //DoSomethingwith --> E.Message.ToString();    
    }
    return oGUID;
} 
```

> There are some specifics to understand when dealing with user passwords and boundaries around passwords such as forcing a user to change their password on the next logon, denying the user the right to change their own passwords, setting passwords to never expire, to when to expire, and these tasks can be accomplished using UserAccountControl flags that are demonstrated in the proceeding sections.
> 
> Please refer to this great [MSDN article: Managing User Passwords](http://msdn.microsoft.com/en-gb/library/ms180915.aspx) for examples and documentation regarding these features.

```
CONST                          HEX
------------------------------------------
SCRIPT                         0x0001
ACCOUNTDISABLE                 0x0002
HOMEDIR_REQUIRED               0x0008
LOCKOUT                        0x0010
PASSWD_NOTREQD                 0x0020
PASSWD_CANT_CHANGE             0x0040
ENCRYPTED_TEXT_PWD_ALLOWED     0x0080
TEMP_DUPLICATE_ACCOUNT         0x0100
NORMAL_ACCOUNT                 0x0200
INTERDOMAIN_TRUST_ACCOUNT      0x0800
WORKSTATION_TRUST_ACCOUNT      0x1000
SERVER_TRUST_ACCOUNT           0x2000
DONT_EXPIRE_PASSWORD           0x10000
MNS_LOGON_ACCOUNT              0x20000
SMARTCARD_REQUIRED             0x40000
TRUSTED_FOR_DELEGATION         0x80000
NOT_DELEGATED                  0x100000
USE_DES_KEY_ONLY               0x200000
DONT_REQ_PREAUTH               0x400000
PASSWORD_EXPIRED               0x800000
TRUSTED_TO_AUTH_FOR_DELEGATION 0x1000000 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-02-28T03:25:55.140

using System.DirectoryServices;

```
 DirectoryEntry hostMachineDirectory = new DirectoryEntry("WinNT://localhost");
    DirectoryEntries entries = hostMachineDirectory.Children;
    bool userExists = false;
    foreach (DirectoryEntry each in entries)
    {
        userExists = each.Name.Equals("NewUser",  
        StringComparison.CurrentCultureIgnoreCase);
        if (systemtestUserExists)
            break;
    }

    if (false == userExists)
    {
        DirectoryEntry obUser = entries.Add("NewUser", "User");
        obUser.Properties["FullName"].Add("Local user");
        obUser.Invoke("SetPassword", "abcdefg12345@");
        obUser.Invoke("Put", new object[] {"UserFlags", 0x10000});
        obUser.CommitChanges(); 
```

# windows - 如何使用应用程序的清单指定详细信息？

> ID：384306
> 
> 赞同：3
> 
> 时间：2008-12-21T10:00:31.513
> 
> 标签：windows, manifest

我正在通过添加清单来升级非托管 C++ 应用程序以使用 XP/Vista 样式的通用控件。根据 MSDN 关于[应用程序清单](http://msdn.microsoft.com/en-us/library/aa374191.aspx)的页面，您需要在清单中指定名称和版本，以及可选的描述：

```
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
    <assemblyIdentity
        version="1.2.3.4"
        processorArchitecture="*"
        name="CompanyName.ApplicationName"
        type="win32"
    />
    <description>Application's description here</description>
</assembly> 
```

这些细节是如何使用的？有[提到](http://msdn.microsoft.com/en-us/library/aa374234(VS.85).aspx)通过具有相同的主要和次要程序集版本来暗示向后兼容性，但这似乎不适用于应用程序。我也无法在 Windows XP 上的应用程序属性中看到清单指定的名称、版本或描述。

改变这些有什么影响？保持版本最新是否值得？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-21T19:12:37.077

对于在不链接清单的 C++ 应用程序（例如 Visual C++ 6 应用程序）中使用 XP/Vista 主题的常用控件，您可以使用以下模板：

```
<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<assembly xmlns="urn:schemas-microsoft-com:asm.v1" manifestVersion="1.0">
    <assemblyIdentity
        version="1.0.0.0"
        processorArchitecture="X86"
        name="Program Name"
        type="win32"
    />
    <description>Description of Program</description>
    <dependency>
        <dependentAssembly>
            <assemblyIdentity
                type="win32"
                name="Microsoft.Windows.Common-Controls"
                version="6.0.0.0"
                processorArchitecture="X86"
                publicKeyToken="6595b64144ccf1df"
                language="*"
            />
        </dependentAssembly>
    </dependency>
</assembly> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-08-04T15:41:20.837

我想说让他们保持最新是值得的。如果没有其他原因，您不知道未来可能会出现哪些使用它们的工具。我不知道本机应用程序清单中指定的程序集名称、版本等的任何当前用途。要在 XP 上填充属性页，您需要在资源中创建一个 VERSIONINFO 部分。

# performance - 使用数据网格性能进行分页的最佳方法是什么？

> ID：384310
> 
> 赞同：1
> 
> 时间：2008-12-21T10:07:32.777
> 
> 标签：performance, datagrid, data-paging

在具有大量用户的站点上，应该在代码中或使用存储过程来处理分页。如果您使用了缓存，请包括您的成功因素。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T10:12:13.393

就个人而言，我从不在 SQL Server 之外对内容进行分页。我在数据库级别这样做，就好像你有一百万条记录要分页，如果你在应用层检索它并在那里分页，你已经付出了**巨大**的代价。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T11:08:19.333

99.9% 的时间，分页应该在您的数据库服务器上完成。但是，存储过程不需要这样做，事实上，许多存储过程解决方案依赖于游标并且效率很低。理想情况下，使用为您的数据库平台量身定制的单个 SQL 语句来仅检索您需要的记录，而不是更多。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T12:21:32.757

我会在数据库级别进行。谈到 sql server 2005，我会使用新的 ROW_NUMBER() 函数，看看： [Paging SQL Server 2005 Results](https://stackoverflow.com/questions/2840/paging-sql-server-2005-results)

典型的 sql 在哪里：

```
SELECT Row_Number() OVER(ORDER BY UserName) As RowID, UserFirstName, UserLastName
FROM Users
WHERE RowID Between 0 AND 9 
```

在这里[http://aspnet.4guysfromrolla.com/articles/031506-1.aspx](http://aspnet.4guysfromrolla.com/articles/031506-1.aspx)你可以看到它是如何工作的并检查 Scott Mitchell 的一个小基准。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T11:12:47.420

大多数数据库供应商在数据库中提供丰富的分页支持。利用它；-p 请注意，它不必是存储过程来执行此操作（我将搁置不断运行的存储过程与临时命令的辩论）。

顺便说一句，许多框架也会*有效*地为您做到这一点。例如，在 .NET 3.5（使用 LINQ）中，您可以使用`Skip()`和`Take()`执行在 db 中使用的分页。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T10:41:17.547

我认为***这取决于***要分页的记录数。例如，您有 100 条记录要分页，我认为不需要 SQL 分页的东西来执行此操作。我一直在努力记住 KISS 原则和过早优化。

# ruby-on-rails - 覆盖 Rails to_param？

> ID：384316
> 
> 赞同：8
> 
> 时间：2008-12-21T10:20:14.390
> 
> 标签：ruby-on-rails

如何让 to_param 方法始终传递关键字 slug？我很难让它与这条路线一起工作：

map.pike '/auction/:auction_id/item/:id', :controller => 'items', :action => 'show'

早些时候，被覆盖的 to_param 正在为

'项目/1-羊绒围巾'

但失败了`'auction/123/item/1'`

更新：

我不确定语法是否正确[（编辑：它是正确的：它可以工作:-)]，甚至是有效的....但是使用haml，我发现以下代码可以生成所需的链接（'auction /:auction_id/item/:id')

```
- for auction in @auctions.sort{|a, b| a.scheduled_start <=> b.scheduled_start}
  -for item in @items
    - unless auction.current_auction
      ... pike_path(auction.auction_id, item) 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-23T02:41:18.217

我不确定我是否理解你的问题。（这里是凌晨 3 点 41 分）

据我所知，您直接访问`auction_id`方法，而不是使用`pike_path(auction, item)`that'd use `#to_param`。

此外，它可能会失败，`auction/123/item/1`因为您没有更改控制器。

我认为描述如何获得工作的蛞蝓会很有帮助。

从广义上讲，如果您覆盖`#to_param`，ID 将不再有效。这意味着，如果您使用 slugs，每次生成多态 URL（例如，`link_to object, object`）时，它都会传递 to_param 的值。值得注意的是，您还必须更改控制器。

就我个人而言，我认为轻松生成 slug 的最佳方法是使用 techno-weenie 的[permalink_fu](http://github.com/technoweenie/permalink_fu/tree/master)，添加`has_permalink`到您的模型中，然后覆盖`to_param`。例如

```
class Auction < ActiveRecord::Base
  has_permalink :title, :slug
end 
```

假设你有 slug，一个字符串字段，并且想要 slugize 你的标题。

您还需要调整控制器：

```
class AuctionsController < ApplicationController
  def show
    @auction = Auction.find_by_slug(params[:id]) || raise(ActiveRecord::RecordNotFound)

    respond_to do |format|
      format.html # show.html.erb
    end
end 
```

然后，您可以通过以下方式在视图中生成路线：

```
link_to @action, @action 
```

顺便说一句，您不应该对视图中的操作进行排序。最好的方法是使用`named_scope`.

# c# - C# 方法的完全限定名称是什么？

> ID：384318
> 
> 赞同：2
> 
> 时间：2008-12-21T10:26:12.380
> 
> 标签：c#, generics

在任何类中，我如何明确引用我类的某个方法？

例如，此代码有效：

```
class Test : IEnumerable<T> {
    public IEnumerator<T> GetEnumerator() { return null; }
    IEnumerator IEnumerable.GetEnumerator() { return GetEnumerator(); }
} 
```

但是这个没有！

```
class Test : IEnumerable<T> {
    IEnumerator<T> IEnumerable<T>.GetEnumerator() { return null; }
    IEnumerator IEnumerable.GetEnumerator() { return GetEnumerator(); } // error
} 
```

如何引用我的方法的通用版本？在 Java 中，我只需在它前面加上接口名称，但这似乎在 C# 中不起作用。有没有办法做到这一点，除了`((IEnumerable<T>)this).GetEnumerator()`？

**编辑：**我对“为什么”它不以这种方式工作不感兴趣。我只是在寻找一种方法来做到这一点。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T10:28:47.073

如果使用显式接口实现，则需要通过该接口访问方法。

所以不，除了你在文本中提出的建议外，别无他法。

在这种情况下，您通常不会对通用接口使用显式实现。

**编辑**：如果文档警告是您担心的根源，让我给您一个更好的建议：[GhostDoc](http://www.roland-weigelt.de/ghostdoc/)。

如果您安装它并将其绑定到，例如 Shift+Ctrl+D（默认），那么它将尝试理解您的方法的名称并添加必要的文档。这不是好的部分，因为您应该始终自己编辑此部分，但是如果您从基类或接口继承方法和属性，它将自动复制文档。有时您需要对其进行编辑以使其更适合您的类型，但通常您可以保留它。

它还将对典型模式进行特殊检测。

试试吧，我相信你会喜欢的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T10:49:13.910

嗯，你可以投...

```
 IEnumerator<T> IEnumerable<T>.GetEnumerator() { return null; } // TODO
    IEnumerator IEnumerable.GetEnumerator() {
        return ((IEnumerable<T>)this).GetEnumerator();
    } 
```

或者您可以对两者都使用非公共实例方法：

```
 IEnumerator<T> IEnumerable<T>.GetEnumerator() { return GetEnumerator(); }
    IEnumerator IEnumerable.GetEnumerator() { return GetEnumerator(); }
    private IEnumerator<T> GetEnumerator() { return null; } // TODO 
```

不过，就个人而言，我更喜欢看到一个公共的 GetEnumerator()——就像我喜欢一个公共的 Dispose()——它让消费者更容易知道它在那里。我不认为所有的接口实现都应该是公开的（远非如此），但`foreach`它们`using`是如此基础，以至于一点广告也不会造成伤害。

# safari - 输入按钮图像 - 在 Chrome 和 Safari 中不起作用？

> ID：384324
> 
> 赞同：0
> 
> 时间：2008-12-21T10:39:24.383
> 
> 标签：safari, google-chrome, input-button-image

我的 index.html 中有以下代码

```
<li>
<select name="cmbtype" style="display:none" id="cmbtype" onChange="Changetype()">
<option value="0">
<input type="image" src="images/ocean.png" value="Play" onclick="previewplay(); " /> 
</option>
</select> 
</li> 
```

在 Firefox、Opera 和 IE 7 中，我看到了 ocean.png 并且能够单击它。当我这样做时，它会相应地播放它应该播放的 mp3！

当我在 Safari（Windows 和 Mac）以及 Chrome 中加载相同的代码时，没有看到 ocean.png 并且没有可单击的按钮？

我可以添加或做些什么来让这个代码/设计在 Safari 和 Chrome 中工作吗？

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-21T11:06:30.257

为什么你的选择中有输入？

它可能继承了 display: none 因此没有被渲染，我认为这是正确的行为。

也许 IE、firefox 和 opera 发现它的语法不合法，并在 select 之外重写了输入，但 webkit 没有。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T11:22:00.723

这是非法的 HTML 标记，不应该工作。

*   <li> 代表*列表项*，必须在 <ol>（有序列表）或 <ul>（无序列表）内

*   <select> 可以有 <optgroup> 和 <option>

*   <option> 可以有字符但没有元素

在这种情况下，Chrome 和 Safaris 的做法**是正确的做法**。

# css - Google 朋友群 + CSS 样式切换

> ID：384326
> 
> 赞同：0
> 
> 时间：2008-12-21T10:41:07.890
> 
> 标签：css, google-friend-connect, styleswitching

我一直在我的博客 www.whataboutki.com 上玩 CSS 样式切换，还添加了 Google 朋友群。我现在想在用户更改样式时更改 GFC 小部件的颜色。这是 GFC 的脚本... div id="div-1229769625913" 这是否意味着我可以从我的 css 文件中访问它？如果是这样，我将如何去做？

```
<!-- Include the Google Friend Connect javascript library. -->
<script type="text/javascript" src="http://www.google.com/friendconnect/script/friendconnect.js"></script>

<!-- Define the div tag where the gadget will be inserted. -->
<div id="div-1229769625913" style="width:260px;border:1px solid #cccccc;"></div>
<!-- Render the gadget into a div. -->
<script type="text/javascript">
    var skin = {};
    skin['HEIGHT'] = '385';
    skin['BORDER_COLOR'] = '#cccccc';
    skin['ENDCAP_BG_COLOR'] = '#e0ecff';
    skin['ENDCAP_TEXT_COLOR'] = '#333333';
    skin['ENDCAP_LINK_COLOR'] = '#0000cc';
    skin['ALTERNATE_BG_COLOR'] = '#ffffff';
    skin['CONTENT_BG_COLOR'] = '#ffffff';
    skin['CONTENT_LINK_COLOR'] = '#0000cc';
    skin['CONTENT_TEXT_COLOR'] = '#333333';
    skin['CONTENT_SECONDARY_LINK_COLOR'] = '#7777cc';
    skin['CONTENT_SECONDARY_TEXT_COLOR'] = '#666666';
    skin['CONTENT_HEADLINE_COLOR'] = '#333333';
    google.friendconnect.container.setParentUrl('/' /* location of rpc_relay.html and canvas.html */);
    google.friendconnect.container.renderMembersGadget(
     { id: 'div-1229769625913',
       site: '10794935298529647173'},
      skin);
</script> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-04T12:51:31.053

我会先尝试看看`div-1229769625913`页面之间是否有变化。如果没有，那么您可以在 CSS 文件中重新设置样式，否则您将不得不更改`skin`样式切换器（我假设是 JS）中的颜色。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-20T00:33:55.483

页面之间的 div id 保持不变，但是，它会生成一个 iframe，并且 GFC 小工具会显示在该 iframe 中。您的 CSS 样式表无法控制该 iframe 内容的样式，因此完成此操作的唯一方法是使用一些 javascript。

最简单的解决方案是删除该哈希中的所有值，并在呈现小工具之前，根据当前使用的样式表替换任何合适的值。这样您就不必弄乱 iframe 的 DOM，这将是不平凡且不可靠的脆弱，因为 Google 不希望您这样做。

所以你的代码可能看起来像这样：

```
<!-- Include the Google Friend Connect javascript library. -->
<script type="text/javascript" src="http://www.google.com/friendconnect/script/friendconnect.js"></script>

<!-- Define the div tag where the gadget will be inserted. -->
<div id="div-1229769625913" style="width:260px"></div>
<!-- Render the gadget into a div. -->
<script type="text/javascript">
    function currentSkin() {
      // Put some real code that detects what the
      // right color scheme is here.
      return 'VERY_BLUE';
    }

    var skins = {};
    skins['VERY_BLUE'] = {};
    skins['VERY_RED'] = {};
    skins['VERY_BLUE']['HEIGHT'] = '385';
    skins['VERY_BLUE']['BORDER_COLOR'] = '#0000ff';
    skins['VERY_BLUE']['ENDCAP_BG_COLOR'] = '#0000ff';
    skins['VERY_BLUE']['ENDCAP_TEXT_COLOR'] = '#0000ff';
    skins['VERY_BLUE']['ENDCAP_LINK_COLOR'] = '#0000ff';
    skins['VERY_BLUE']['ALTERNATE_BG_COLOR'] = '#0000ff';
    skins['VERY_BLUE']['CONTENT_BG_COLOR'] = '#0000ff';
    skins['VERY_BLUE']['CONTENT_LINK_COLOR'] = '#0000ff';
    skins['VERY_BLUE']['CONTENT_TEXT_COLOR'] = '#0000ff';
    skins['VERY_BLUE']['CONTENT_SECONDARY_LINK_COLOR'] = '#0000ff';
    skins['VERY_BLUE']['CONTENT_SECONDARY_TEXT_COLOR'] = '#0000ff';
    skins['VERY_BLUE']['CONTENT_HEADLINE_COLOR'] = '#0000ff';
    skins['VERY_RED']['HEIGHT'] = '385';
    skins['VERY_RED']['BORDER_COLOR'] = '#ff0000';
    skins['VERY_RED']['ENDCAP_BG_COLOR'] = '#ff0000';
    skins['VERY_RED']['ENDCAP_TEXT_COLOR'] = '#ff0000';
    skins['VERY_RED']['ENDCAP_LINK_COLOR'] = '#ff0000';
    skins['VERY_RED']['ALTERNATE_BG_COLOR'] = '#ff0000';
    skins['VERY_RED']['CONTENT_BG_COLOR'] = '#ff0000';
    skins['VERY_RED']['CONTENT_LINK_COLOR'] = '#ff0000';
    skins['VERY_RED']['CONTENT_TEXT_COLOR'] = '#ff0000';
    skins['VERY_RED']['CONTENT_SECONDARY_LINK_COLOR'] = '#ff0000';
    skins['VERY_RED']['CONTENT_SECONDARY_TEXT_COLOR'] = '#ff0000';
    skins['VERY_RED']['CONTENT_HEADLINE_COLOR'] = '#ff0000';
    google.friendconnect.container.setParentUrl('/' /* location of rpc_relay.html and canvas.html */);
    google.friendconnect.container.renderMembersGadget(
     { id: 'div-1229769625913',
       site: '10794935298529647173'},
      skins[currentSkin()]);
</script> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-21T02:39:01.717

ID 由 GFC 生成。它使用 iFrame 在其 *.gmodule.com 服务器上托管您的小工具代码填充 DIV

理论上你可以在加载后访问和修改他们的 DOM 以改变他们的风格

尝试更改“皮肤”映射中的值以获取样式

例如。皮肤['ALTERNATE_BG_COLOR'] = '#ffffff';

祝你好运！

# unix - 杀死长期运行的失控程序的程序

> ID：384332
> 
> 赞同：2
> 
> 时间：2008-12-21T10:47:28.283
> 
> 标签：unix, sysadmin

我管理 Unix 系统，有时，像 CGI 脚本这样的程序永远运行，有时会占用大量 CPU 时间并浪费资源。

我想要一个程序（通常从 cron 调用），它可以根据以下标准（结合 AND 和 OR）杀死这些失控者：

*   名称（由正则表达式给出）
*   使用的 CPU 时间
*   经过时间（对于在 I/O 上被阻塞的程序）

我真的不知道在这种程序的搜索引擎中输入什么内容。我当然可以自己用 Python 编写它，但我很懒，可能已经存在一个好的程序？

（我没有用语言名称标记我的问题，因为 Perl 或 Ruby 中的程序或其他任何可以工作的程序）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T11:51:27.747

请尝试改用系统级配额强制执行。大多数系统将允许为不同的用户设置每个进程的 CPU 时间限制。

**例子：**

1.  Linux：[`/etc/security/limits.conf`](http://www.ss64.com/bash/limits.conf.html)
2.  自由BSD：[`/etc/login.conf`](http://www.freebsd.org/doc/en/books/handbook/users-limiting.html)

CGI 脚本通常可以在它们自己的用户 ID 下运行，例如[`mod_suid`](http://freshmeat.net/projects/mod_suid/)用于 Apache。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-30T06:00:21.833

这可能更像您正在寻找的东西：

[http://devel.ringlet.net/sysutils/timelimit/](http://devel.ringlet.net/sysutils/timelimit/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T11:31:33.387

大多数类似 watchdig 的程序或库只是试图查看给定进程是否正在运行，所以我想说你最好自己编写，使用提供进程信息的现有库。

# python - 你如何管理你的 Django 应用程序？

> ID：384333
> 
> 赞同：7
> 
> 时间：2008-12-21T10:48:19.140
> 
> 标签：python, django, project, structure

我只是想尝试用 django 构建一个项目。因此，我有一个关于如何管理这样一个项目的（基本）问题。因为我找不到任何关于如何将项目拆分为应用程序的指南。

我们以一种 SO 为例。您会使用哪些应用程序？我想说应该有应用程序“用户”和“问题”。但是，如果也有一个包含静态文章的主题系统呢。也许他们也可以获得选票。那么如何构建应用程序结构呢？一款用于“问题”、“投票”和“主题”的应用，还是一款用于“内容”的应用？

我不知道该怎么做。也许是因为我对 Django 还不太了解，但我也很感兴趣......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-21T14:08:05.897

没有一成不变的规则，但我会说最好在更专业的应用程序方面犯错。理想情况下，应用程序应该只处理一个功能问题：即“标记”或“评论”或“auth/auth”或“帖子”。这种类型的设计还将帮助您重用可用的开源应用程序，而不是重新发明轮子（即 Django 带有[auth](http://docs.djangoproject.com/en/dev/topics/auth/#topics-auth)和[comments](http://docs.djangoproject.com/en/dev/ref/contrib/comments/#ref-contrib-comments-index)应用程序，[django-tagging](http://code.google.com/p/django-tagging/)或[django-taggable](http://code.google.com/p/django-taggable/)几乎肯定可以满足您的需要，等等）。

[通用外键](http://docs.djangoproject.com/en/dev/ref/contrib/contenttypes/#id1)可以帮助您将可能应用于模型的标记或评论等应用程序与其他几个应用程序分离。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-21T12:56:59.613

您应该尝试将项目分离到尽可能多的应用程序中。对于大多数项目，一个应用程序包含的模型不超过 5 个。例如，像 SO 这样的项目将有单独的用户配置文件、问题、标签应用程序（django 中有一个现成的应用程序）等。如果有一个带有静态页面的系统也将是一个单独的应用程序（有现成的应用程序）以此目的）。您还应该尝试使您的应用程序尽可能通用，以便您可以在其他项目中重用它们。关于可重用应用程序有一个很好的[演示](http://www.youtube.com/watch?v=A-S0tqpPga4&feature=PlayList&p=D415FAF806EC47A1&index=14)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-21T14:03:39.290

就像任何一组依赖项一样...尝试找到项目中最有用的独立方面并制作那些独立的应用程序。其他 Django 应用程序将具有更高级别的功能，并重用您已设置的最低级别应用程序的部分。

在我的项目中，我有一个日历应用程序，其模型中有自己的 Event 对象。我还设置了一个拼车数据库，对于出发时间和持续时间，我在 RideShare 表中使用日历的 Event 对象。拼车数据库可识别日历，并“免费”从日历应用程序中获取所有漂亮的 .ics 导出和日历视图。

有一些技巧可以让应用程序可重用，例如命名模板目录：project/app2/templates/app2/index.html。这使您可以从任何其他应用程序中引用 app2/index.html，并获得正确的模板。我选择了一个查看 Django 本身内置的可重用应用程序。Pinax 在大小方面有点像怪物，但它也展示了一个很好的可重用应用程序结构。

如果有疑问，请暂时忘记可重复使用的应用程序。将您所有的消息和民意调查放在一个应用程序中，并通过一个 rev。在此过程中，您会发现哪些步骤是不必要的，并且将来可能会被分解为独立的东西。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-23T02:34:09.417

在决定是否编写应用程序时要问自己一个好问题是“我可以在另一个项目中使用它吗？”。如果您认为可以，请考虑如何使应用程序尽可能独立；如何减少依赖关系，使应用程序不依赖于特定项目的任何特定内容。

您可以这样做的一些方法是：

*   为每个应用程序提供自己的 urls.py
*   允许模型类型作为参数传入，而不是显式声明视图中使用的模型。通用视图使用此原则。
*   通过在 urls.py 中传递某种 template_name 参数，轻松覆盖模板
*   确保您可以对您的对象和视图进行反向 url 查找。这意味着在 urls.py 中命名您的视图并在您的模型上创建 get_absolute_url 方法。
*   在某些情况下，例如标记，GenericForeignKeys 可用于将您应用程序中的模型与任何其他模型相关联，无论它是否具有“回看”它的 ForeignKeys。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T12:07:27.107

我会告诉你我是如何处理这样的问题的：我通常坐在一张纸上，画出方框（功能）和箭头（功能之间的相互依赖关系）。我确信有一些方法或其他东西可以帮助你，但我的方法通常对我有用（当然是 YMMV）。

不过，了解网站应该是什么是基本的。;)

# python - 使用 Python Web GET 数据

> ID：384336
> 
> 赞同：0
> 
> 时间：2008-12-21T10:53:09.910
> 
> 标签：python, form-data

我正在尝试通过 url 将信息传递给 python 页面。我有以下链接文本：

```
"<a href='complete?id=%s'>" % (str(r[0])) 
```

在完整的页面上，我有这个：

```
import cgi
def complete():
    form = cgi.FieldStorage()
    db = MySQLdb.connect(user="", passwd="", db="todo")
    c = db.cursor()
    c.execute("delete from tasks where id =" + str(form["id"]))
    return "<html><center>Task completed! Click <a href='/chris'>here</a> to go back!</center></html>" 
```

问题是当我进入完整页面时，我在“id”上得到一个关键错误。有谁知道如何解决这一问题？

*编辑*
当我运行`cgi.test()`它给我什么

我认为我使用 url 的方式有问题，因为它没有通过。

它基本上是*localhost/chris/complete?id=1*

*/chris/*是一个文件夹，而 complete 是*index.py中的一个函数*

我是否以错误的方式格式化网址？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T11:26:32.167

该错误意味着`form["id"]`未能找到 中的密钥`"id"`。`cgi.FieldStorage()`

要测试被调用 URL 中的键，请使用[cgi.test()](http://docs.python.org/library/cgi.html#cgi.test)：

> cgi.test()
> 
> 强大的测试 CGI 脚本，可用作主程序。写入最少的 HTTP 标头，并将所有提供给脚本的信息格式化为 HTML 格式。

编辑：一个基本的测试脚本（使用带有 Linux 路径的 python cgi 模块）只有 3 行。确保您知道如何在您的系统上运行它，然后从浏览器调用它以检查参数是否在 CGI 端看到。[您可能](http://docs.python.org/library/cgitb.html#module-cgitb)还想使用 `import cgitb; cgitb.enable()`.

```
#!/usr/bin/python
import cgi
cgi.test() 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-24T04:24:29.443

您是否尝试过打印表单的价值以确保您得到了您认为得到的结果？不过，您的代码确实有一点问题……您应该执行 form["id"].value 以从 FieldStorage 获取项目的值。另一种选择是自己做，像这样：

```
import os
import cgi

query_string = os.environ.get("QUERY_STRING", "")
form = cgi.parse_qs(query_string) 
```

这应该会导致这样的结果：

```
{'id': ['123']} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T11:32:46.927

首先，您应该通过以下方式进行字典查找

```
possibly_none = my_dict.get( "key_name" ) 
```

因为这会将 None 分配给变量，如果键不在字典中。然后，您可以使用

```
if key is not None:
    do_stuff 
```

成语（是的，我一般是空检查和防御性编程的粉丝......）。python 文档也提出了这些方面的建议。

在不深入研究代码的情况下，我认为您应该参考

```
form.get( 'id' ).value 
```

为了提取您似乎要求的数据。

# asp.net - 为什么 .NET 去掉一个 如果已经存在具有 runat 服务器属性的表单，则从页面标记？

> ID：384350
> 
> 赞同：5
> 
> 时间：2008-12-21T11:18:29.560
> 
> 标签：asp.net, webforms

它不会删除 2nd form 标记内的所有内容，而只是从页面中隐藏 and 标记

有什么想法和解决方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-21T11:48:01.467

html 中不允许嵌套表单。所以你不能在服务器表单中添加另一个表单。

但是在 ASP.NET 中，在服务器表单之外添加 get-forms 是完全合法的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-23T05:13:46.253

我将嵌套表单移到外面来解决这个问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T11:47:12.873

你不能有嵌套的表单标签。如果您想对标记进行更多控制，或者考虑不使用 asp.net 服务器控件，请移至 asp.net mvc，这样您可以包含多个表单标记，而不必确保控件位于具有 runat 服务器属性的表单标记内，但是那么您无法在后面的代码中获得细粒度的访问权限，而必须开始使用 request.form colelction 来检索回发值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T11:39:51.203

ASP.NET 将所有内容包含在单个表单中的原因是，当回发发生时，整个表单会回发到服务器，您将可以访问页面上的每个元素。

也就是说，您可以`myTextbox.Text = 'Hello';`从 Code-Behind 修改元素 ( ) 的属性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-06-04T16:36:57.457

.NET WebForms 将整个应用程序包装在一个`<form>`标签中，这在向页面添加其他`<form>`标签时可能会导致问题。我的同事找到了嵌套表单问题的解决方法。

```
</form> <!-- This tag closes the WebForms form tag -->
<form action="/form/endpoint/foo">
...
</form> 
```

通过在您的自定义表单上方添加一个单独的结束`</form>`标签：WebForms 将在您的自定义表单开始之前关闭它的包装表单标签，这样您就没有嵌套的表单块。

# overlay - 图表叠加

> ID：384352
> 
> 赞同：3
> 
> 时间：2008-12-21T11:19:54.957
> 
> 标签：overlay, google-visualization

我想知道这是否可以使用 Google Charts API：首先，使用给定的输入数据创建一个条形图。然后在上面叠加一个折线图（或一条线）。

我在这里的用例是显示一个学生在测试中的表现，与其他人群相比，这已经以条形图的形式提供。

**编辑：**挖掘并发现了*标记*。将探索并可能回答我自己的问题:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2013-01-17T07:24:33.173

当前文档中非常明确地介绍了这一点，请参阅[复合图表](https://developers.google.com/chart/image/docs/gallery/compound_charts)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-26T22:10:47.073

是的，标记可能是您正在寻找的。特别是，您可能希望查看一个名为“[财务标记](http://code.google.com/apis/chart/styles.html#financial_markers)”的新功能。最近添加了这个（小广告）[功能](http://groups.google.com/group/google-chart-api/browse_thread/thread/73b57d02c28efaf5)。

# windows-server-2008 - Windows 2008 Web 版中的 Hyper-V 管理器 MMC 管理单元。可能的？

> ID：384364
> 
> 赞同：0
> 
> 时间：2008-12-21T11:44:58.337
> 
> 标签：windows-server-2008, hyper-v, mmc

是否有可能在 Windows 2008 Web 版上运行 Hyper-V 管理器 MMC 管理单元？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T17:04:30.440

太糟糕了。但如果你仔细想想，这很奇怪。MS 已经发布了用于 Vista 的 Hyper-V Manager MMC 管理单元，那么为什么他们不能为 Windows 2008 Web 版发布它呢？这只是一个经理..

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-21T16:27:39.047

不，这违反了网络版 EULA。

# pdf - 如何 wget 一个网站，然后将所有页面导出为一个 pdf？

> ID：384373
> 
> 赞同：0
> 
> 时间：2008-12-21T12:02:41.110
> 
> 标签：pdf

有什么办法可以做到吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-23T17:53:46.813

我做过一次。然而，那是差不多 10 年前的事了，所以我不记得细节了。

我用了：

*   `wget`下载页面
*   `html2ps`将单个页面转换为 PostScript
*   `ps2ps`将各个 PostScript 文件拼接在一起
*   `ps2ps`再次，将 4 页放在 1 上

然后我将 PostScript 文件发送到打印机。由于您想要 PDF，您可以添加一个额外的步骤`ps2pdf`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-21T12:11:50.983

是的，您可以编写一个 AppleScript 来自动化 Safari 进行打印（如果您愿意，还可以进行获取，尽管您可以使用 AppleScript 驱动 wget `do shell script`）。如果您不喜欢使用 AppleScript，则可以使用 Automator；结果几乎是一样的。

顺便说一句，如果您不使用 Mac OS X，那么您提出的问题并不清楚 :-)

# javascript - ie7上灯箱2的javascript问题

> ID：384382
> 
> 赞同：0
> 
> 时间：2008-12-21T12:12:22.807
> 
> 标签：javascript, lightbox, lightbox2

我在 IE7 上遇到 lightbox2 的问题。我已经修改了灯箱，稍微移动了导航 - 在 Firefox 上一切正常，但在 IE7 中存在一个问题：我第一次点击缩略图时，只有一部分背景变暗并且大图像没有显示。如果我再试一次，它会工作，问题只会在完整的页面加载后出现。

页面加载后：
[http ://www.screencast.com/users/timkl/folders/Jing/media/b33c7728-2247-4b8e-8d65-0eca533e9113](http://www.screencast.com/users/timkl/folders/Jing/media/b33c7728-2247-4b8e-8d65-0eca533e9113)

它应该是什么样子：
[http ://www.screencast.com/users/timkl/folders/Jing/media/c65b43d3-6dd8-4524-9afd-ee94d3a5d426](http://www.screencast.com/users/timkl/folders/Jing/media/c65b43d3-6dd8-4524-9afd-ee94d3a5d426)

这是画廊的网址：http: //friedrichjoost.de/temp/index.php?s=
[art_gallery_sub1](http://friedrichjoost.de/temp/index.php?s=art_gallery_sub1)

我是一个绝对的 javascript n00b 并且不知道如何解决这个问题，如果有人可以给我一个提示可能是错误的，我将不胜感激。

此外，非常欢迎任何有关如何在 IE 上调试 javascript 的提示，我使用 Firebug 进行 FF，但我似乎找不到任何在 IE 上也能正常工作的东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T15:45:16.760

使您的 DOCTYPE 与截屏视频中的相同

你有

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"> 
```

尝试

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
```

# c - 如何发出信号 select() 立即返回？

> ID：384391
> 
> 赞同：28
> 
> 时间：2008-12-21T12:23:21.427
> 
> 标签：c, multithreading, select, sockets

我有一个工作线程正在侦听 TCP 套接字以获取传入流量，并缓冲接收到的数据以供主线程访问（我们称之为套接字*A*）。但是，即使没有数据进来，工作线程也必须执行一些常规操作（例如每秒一次）。因此，我使用`select()`超时，这样我就不需要继续轮询。（请注意，调用`receive()`非阻塞套接字然后休眠一秒钟是不好的：传入的数据应该立即可供主线程使用，即使主线程可能并不总是能够立即处理它，因此需要缓冲。）

现在，我还需要能够立即向工作线程发出信号以执行其他操作；从主线程开始，我需要立即让工作线程`select()`返回。目前，我已经解决了这个问题（基本上是从[这里](http://mail.python.org/pipermail/python-list/2002-May/147063.html)和[这里](http://www.developerweb.net/forum/showthread.php?t=5154)采用的方法）：

在程序启动时，工作线程为此目的创建一个额外的数据报 (UDP) 类型的套接字，并将其绑定到某个随机端口（我们称之为套接字*B*）。同样，主线程创建一个用于发送的数据报套接字。在对 的调用中，工作*线程*`select()`现在*在*. 当主线程需要发出信号时，它会发送几个字节到相应的端口 on 。回到工作线程，如果*B*保留在after返回中，则调用 then 并简单地忽略接收到的字节。*`fd_set``sendto()``localhost`*`fd_set``select()``recvfrom()`**

 **这似乎工作得很好，但我不能说我喜欢这个解决方案，主要是因为它需要为*B*绑定一个额外的端口，而且还因为它添加了几个额外的套接字 API 调用，我猜这些调用可能会失败——我不真的很想为每个案例找出适当的行动。

我认为理想情况下，我想调用一些以*A*`select()`作为输入的函数，除了立即返回之外什么都不做。但是，我不知道这样的功能。（我想我可以例如`shutdown()`套接字，但副作用是不能接受的：）

如果这是不可能的，那么第二好的选择是创建一个比真正的 UDP 套接字更笨的*B*，并且实际上不需要分配任何有限的资源（超出合理的内存量）。我猜[Unix 域套接字](http://en.wikipedia.org/wiki/Unix_domain_sockets)可以做到这一点，但是：该解决方案的跨平台性不应该比我目前拥有的少得多，尽管一些适量的`#ifdef`东西是可以的。（我主要针对 Windows 和 Linux ——顺便写一下 C++。）

请不要建议重构以摆脱两个单独的线程。这种设计是必要的，因为主线程可能会被阻塞很长时间（例如，做一些密集的计算——我不能`receive()`从最里面的计算循环开始定期调用），同时，有人需要缓冲传入的数据（并且由于我无法控制的原因，它不能是发件人）。

现在我正在写这篇文章，我意识到肯定有人会简单地回复“ [Boost.Asio](http://www.boost.org/doc/libs/1_37_0/doc/html/boost_asio.html) ”，所以我只是第一次看它......虽然找不到明显的解决方案。请注意，我也不能（轻松）影响套接字*A*的创建方式，但如果需要，我应该能够让其他对象包装它。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-12-21T12:26:38.957

你快到了。使用[“自管”技巧](http://cr.yp.to/docs/selfpipe.html)。打开一个管道，将其添加到您的`select()`read 和 write`fd_set`中，从主线程写入它以解除阻塞工作线程。它可以跨 POSIX 系统移植。

我在一个系统中看到了一种类似的 Windows 技术变体（实际上与上述方法一起使用，用 分隔`#ifdef WIN32`）。可以通过添加一个虚拟（未绑定）数据报套接字`fd_set`然后关闭它来实现解除阻塞。缺点是，当然，您每次都必须重新打开它。

然而，在上述系统中，这两种方法都相当谨慎地使用，并且用于意外事件（例如，信号、终止请求）。首选方法仍然是可变超时时间`select()`，具体取决于为工作线程安排的时间。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-22T07:47:00.627

使用管道而不是套接字更干净一些，因为另一个进程不可能抓住它并将事情搞砸。

使用 UDP 套接字肯定会产生杂散数据包进入和干扰的可能性。

匿名管道将永远不可用于任何其他进程（除非您将其提供给它）。

您也可以使用信号，但在多线程程序中，您需要确保除您想要的线程之外的所有线程都屏蔽了该信号。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-12-24T13:18:38.873

在 unix 上，使用管道会很简单。如果您在 Windows 上并希望继续使用 select 语句来保持您的代码与 unix 兼容，那么创建一个未绑定的 UDP 套接字并关闭它的技巧非常有效且简单。但是你必须使它成为多线程安全的。

我发现使这个多线程安全的唯一方法是在运行 select 语句的同一线程中关闭并重新创建套接字。当然，如果线程在选择上阻塞，这很困难。然后在windows中调用QueueUserAPC。当 windows 在 select 语句中阻塞时，线程可以处理异步过程调用。您可以使用 QueueUserAPC 从不同的线程安排此操作。Windows 中断选择，在同一个线程中执行您的函数，然后继续选择语句。您现在可以在您的 APC 方法中关闭套接字并重新创建它。保证线程安全，您永远不会丢失信号。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-12-24T07:57:38.377

简单来说：一个全局变量保存socket句柄，然后关闭全局socket，`select()`会立即返回：`closesocket(g_socket);`

# c# - 产生关键字附加值？

> ID：384392
> 
> 赞同：7
> 
> 时间：2008-12-21T12:24:06.370
> 
> 标签：c#, iterator, ienumerable, yield

仍然试图找到在实际情况下我会在哪里使用“yield”关键字。

我看到这个主题的主题

[C# 中使用的 yield 关键字是什么？](https://stackoverflow.com/questions/39476/what-is-the-yield-keyword-used-for-in-c)

但在接受的答案中，他们以此为例，有人在 Integers() 周围进行迭代

```
public IEnumerable<int> Integers()
{
yield return 1;
yield return 2;
yield return 4;
yield return 8;
yield return 16;
yield return 16777216;
} 
```

但为什么不直接使用

```
list<int> 
```

而是在这里。似乎更直接..

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-21T12:34:41.933

如果您构建并返回一个 List（假设它有 100 万个元素），那将是一大块内存，而且创建它也需要大量工作。

有时调用者可能只想知道第一个元素是什么。或者他们可能希望在获得它们时将它们写入文件，而不是在内存中构建整个列表然后将其写入文件。

这就是为什么使用收益率回报更有意义的原因。它看起来与构建整个列表并返回它并没有什么不同，但它非常不同，因为在调用者可以查看它的第一项之前，不必在内存中创建整个列表。

当来电者说：

```
foreach (int i in Integers())
{
   // do something with i
} 
```

每次循环需要一个新的 i 时，它都会运行更多 Integers() 中的代码。该函数中的代码在遇到`yield return`语句时“暂停”。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-21T12:38:46.827

Yield 允许您构建生成数据的方法，而无需在返回之前收集所有内容。将其视为一路返回多个值。

这里有几个方法可以说明这一点

```
public IEnumerable<String> LinesFromFile(String fileName)
{
    using (StreamReader reader = new StreamReader(fileName))
    {
        String line;
        while ((line = reader.ReadLine()) != null)
            yield return line;
    }
}

public IEnumerable<String> LinesWithEmails(IEnumerable<String> lines)
{
    foreach (String line in lines)
    {
        if (line.Contains("@"))
            yield return line;
    }
} 
```

这两种方法都不会将文件的全部内容读入内存，但您可以像这样使用它们：

```
foreach (String lineWithEmail in LinesWithEmails(LinesFromFile("test.txt")))
    Console.Out.WriteLine(lineWithEmail); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-21T12:35:46.270

您可以使用它`yield`来构建任何迭代器。这可能是一个懒惰评估的系列（例如，从文件或数据库中读取行，而不是一次读取所有内容，这可能太多而无法保存在内存中），或者可能正在迭代现有数据，例如`List<T>`.

[C# in Depth](http://manning.com/skeet/)有一个免费的第 (6) 章*是关于*迭代器块的。

我最近还写了一篇关于使用智能蛮力算法的[博客。](http://marcgravell.blogspot.com/2008/12/brute-force-but-lazily.html)`yield`

对于惰性文件阅读器的示例：

```
 static IEnumerable<string> ReadLines(string path) {
        using (StreamReader reader = File.OpenText(path)) {
            string line;
            while ((line = reader.ReadLine()) != null) {
                yield return line;
            }
        }
    } 
```

这完全是“懒惰”；*在您开始枚举之前什么都不会*被读取，并且只有一行被保存在内存中。

请注意，LINQ-to-Objects*广泛*使用了迭代器块 ( `yield`)。例如，`Where`扩展本质上是：

```
 static IEnumerable<T> Where<T>(this IEnumerable<T> data, Func<T, bool> predicate) {
        foreach (T item in data) {
            if (predicate(item)) yield return item;
        }
    } 
```

再一次，完全懒惰 - 允许您将多个操作链接在一起，而无需强制将所有内容加载到内存中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-21T12:38:58.137

yield 允许您处理可能无限大小的集合，因为与基于列表的方法不同，整个集合永远不会一次性加载到内存中。例如，所有素数的 IEnumerable<> 可以通过适当的算法来查找素数，而 List 方法的大小总是有限的，因此是不完整的。在此示例中，使用 yield 还允许将下一个元素的处理推迟到需要它为止。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-21T12:43:06.740

对我来说，一个真实的情况是，当我想要处理一个需要一段时间才能更顺利地填充的集合时。

想象一下类似的东西（伪代码）：

```
public IEnumberable<VerboseUserInfo> GetAllUsers()
{
    foreach(UserId in userLookupList)
    {
        VerboseUserInfo info = new VerboseUserInfo();

        info.Load(ActiveDirectory.GetLotsOfUserData(UserId));
        info.Load(WebSerice.GetSomeMoreInfo(UserId));

        yield return info;
    }
} 
```

在我开始处理其中的项目之前，我不必等待一分钟来填充集合。我将能够立即开始，然后在发生时向用户界面报告。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-21T13:15:56.440

您可能并不总是希望使用 yield 而不是返回列表，并且在您的示例中，您使用 yield 来实际返回整数列表。根据您想要一个可变列表还是不可变序列，您可以使用列表或迭代器（或其他一些可变/不可变的集合）。

但是使用产量也有好处。

*   Yield 提供了一种构建惰性求值迭代器的简单方法。（这意味着当调用 MoveNext() 方法时只执行获取序列中下一个元素的代码，然后迭代器返回不再进行计算，直到再次调用该方法）

*   Yield 在幕后构建了一个状态机，通过不必编写通用生成器的状态 => 更简洁/简单的代码，这可以节省您分配的工作量。

*   Yield 自动构建优化和线程安全的迭代器，让您省去如何构建它们的细节。

*   Yield 比第一眼看上去要强大得多，并且可以用于构建简单的迭代器之外的其他用途，观看此视频以了解[Jeffrey Richter 和他的 AsyncEnumerator](http://channel9.msdn.com/posts/Charles/Jeffrey-Richter-and-his-AsyncEnumerator/)以及如何使用 yield 使使用异步模式的编码变得容易。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T12:33:55.290

您可能想要遍历各种集合：

```
public IEnumerable<ICustomer> Customers()
{
        foreach( ICustomer customer in m_maleCustomers )
        {
            yield return customer;
        }

        foreach( ICustomer customer in m_femaleCustomers )
        {
            yield return customer;
        }

        // or add some constraints...
        foreach( ICustomer customer in m_customers )
        {
            if( customer.Age < 16 )
            {
                yield return customer;
            }
        }

        // Or....            
        if( Date.Today == 1 )
        {
            yield return m_superCustomer;
        }

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-21T13:04:04.933

我同意每个人在这里所说的关于惰性评估和内存使用的一切，并想添加另一个场景，我发现使用`yield`关键字的迭代器很有用。我遇到过一些情况，我必须对一些数据进行一系列可能代价高昂的处理，而使用迭代器非常有用。而不是立即处理整个文件，或者滚动我自己的处理管道，我可以简单地使用迭代器，如下所示：

```
IEnumerable<double> GetListFromFile(int idxItem)
{
    // read data from file
    return dataReadFromFile;
}

IEnumerable<double> ConvertUnits(IEnumerable<double> items)
{
    foreach(double item in items)
        yield return convertUnits(item);
}

IEnumerable<double> DoExpensiveProcessing(IEnumerable<double> items)
{
    foreach(double item in items)
        yield return expensiveProcessing(item);
}

IEnumerable<double> GetNextList()
{
    return DoExpensiveProcessing(ConvertUnits(GetListFromFile(curIdx++)));
} 
```

这里的优点是通过保持所有函数的输入和输出`IEnumerable<double>`，我的处理管道是完全可组合的、易于阅读和惰性评估的，因此我只需要进行我真正需要做的处理。这让我可以将几乎所有的处理都放在 GUI 线程中，而不会影响响应能力，因此我不必担心任何线程问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-09-30T09:50:40.393

我想出了这个来克服 .net 必须手动深度复制列表的缺点。

我用这个：

```
static public IEnumerable<SpotPlacement> CloneList(List<SpotPlacement> spotPlacements)
{
    foreach (SpotPlacement sp in spotPlacements)
    {
        yield return (SpotPlacement)sp.Clone();
    }
} 
```

在另一个地方：

```
public object Clone()
{
    OrderItem newOrderItem = new OrderItem();
    ...
    newOrderItem._exactPlacements.AddRange(SpotPlacement.CloneList(_exactPlacements));
    ...
    return newOrderItem;
} 
```

我试图想出一个可以做到这一点的oneliner，但这是不可能的，因为 yield 在匿名方法块中不起作用。

编辑：

更好的是，使用通用列表克隆器：

```
class Utility<T> where T : ICloneable
{
    static public IEnumerable<T> CloneList(List<T> tl)
    {
        foreach (T t in tl)
        {
            yield return (T)t.Clone();
        }
    }
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-02-17T07:14:50.177

`yield`通过即时处理项目来节省内存的方法很好，但实际上它只是语法糖。它已经存在了很长时间。在任何具有函数或接口指针的语言（甚至 C 和汇编）中，您都可以使用回调函数/接口获得相同的效果。

这个花哨的东西：

```
static IEnumerable<string> GetItems()
{
    yield return "apple";
    yield return "orange";
    yield return "pear";
}

foreach(string item in GetItems())
{
    Console.WriteLine(item);
} 
```

基本上相当于老式的：

```
interface ItemProcessor
{
    void ProcessItem(string s);
};

class MyItemProcessor : ItemProcessor
{
    public void ProcessItem(string s)
    {
        Console.WriteLine(s);
    }
};

static void ProcessItems(ItemProcessor processor)
{
    processor.ProcessItem("apple");
    processor.ProcessItem("orange");
    processor.ProcessItem("pear");
}

ProcessItems(new MyItemProcessor()); 
```

# c# - 在 C# 中实现 RSA

> ID：384401
> 
> 赞同：7
> 
> 时间：2008-12-21T12:30:42.940
> 
> 标签：c#, rsa, rsacryptoserviceprovider

我目前正在尝试使用 RSACrytoServiceProveider 类实现一个类来处理我的应用程序实例之间的安全通信。第一个问题：实现单个类来处理发送者/接收者角色是个好主意，还是应该将角色拆分为单独的类？这是我到目前为止所做的：

```
using System;
using System.Text;
using System.Security.Cryptography;

namespace Agnus.Cipher
{
    public class RSA
    {
        private byte[] plaintextBytes;
        private byte[] ciphertextBytes;
        private RSACryptoServiceProvider rSAProviderThis;
        private RSACryptoServiceProvider rSAProviderOther;

        public string PublicKey
        {
            get { return rSAProviderThis.ToXmlString(false); }
        }

        public RSA()
        {
            rSAProviderThis = new RSACryptoServiceProvider { PersistKeyInCsp = true }; 
            plaintextBytes = Encoding.Unicode.GetBytes(PublicKey);
        }

        public void InitializeRSAProviderOther(string parameters)
        {
            rSAProviderOther.FromXmlString(parameters);
        }

        public byte[] Encrypt()
        {
            return rSAProviderThis.Encrypt(plaintextBytes, true);
        }
        public byte[] Decrypt()
        {
            return rSAProviderThis.Decrypt(ciphertextBytes, true);
        }
        public byte[] Sign()
        {
            using (SHA1Managed SHA1 = new SHA1Managed())
            {
                byte[] hash = SHA1.ComputeHash(ciphertextBytes);
                byte[] signature = rSAProviderThis.SignHash(hash, CryptoConfig.MapNameToOID("SHA1"));
                return signature;
            }
        }
        public void Verify()
        {
            throw new NotImplementedException();
        }

    }
} 
```

第二个问题：我如何发送和接收要输入课堂的数据？我是这个领域的绿角，不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T12:44:21.197

我会让 encrypt/sign/decrypt/verify 方法为数据获取参数，而不是为它们设置成员变量。不过，拥有密钥和提供者的成员变量似乎没问题。基本上我希望多次使用相同的密钥，但不是相同的数据。

我还将使其不可变 - 将所有变量设为只读，在构造函数中获取提供程序所需的所有参数，而不是使用单独的初始化方法。

除此之外，可以将功能包装在更简单的 API 中以满足您的需求，是的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T15:16:31.233

我做了一些调整，下面是实现的样子：

```
using System;
using System.Security.Cryptography;

namespace Agnus.Cipher
{
    public class RSA : IDisposable
    {
        private RSACryptoServiceProvider rSAProviderThis;
        private RSACryptoServiceProvider rSAProviderOther = null;

        public string PublicKey
        {
            get { return rSAProviderThis.ToXmlString(false); }
        }

        public RSA()
        {
            rSAProviderThis = new RSACryptoServiceProvider { PersistKeyInCsp = true }; 
        }

        public void InitializeRSAProviderOther(string parameters)
        {
            rSAProviderOther.FromXmlString(parameters);
        }

        public byte[] Encrypt(byte[] plaintextBytes)
        {
                return rSAProviderThis.Encrypt(plaintextBytes, true);
        }
        public string  Decrypt(byte[] ciphertextBytes)
        {
            try
            {
                return Convert.ToBase64String( rSAProviderThis.Decrypt(ciphertextBytes, true));
            }
            catch (CryptographicException ex)
            {
                Console.WriteLine("Unable to decrypt: " + ex.Message + " " + ex.StackTrace);
            }
            finally
            {
                this.Dispose();
            }
            return string.Empty;
        }
        public string SignData(byte[] ciphertextBytes)
        {
            string  signature = GenerateSignature(ciphertextBytes, rSAProviderThis);
            return signature;
        }

        private string GenerateSignature(byte[] ciphertextBytes, RSACryptoServiceProvider provider)
        {
            using (SHA1Managed SHA1 = new SHA1Managed())
            {
                byte[] hash = SHA1.ComputeHash(ciphertextBytes);
                string signature = Convert.ToBase64String(provider.SignHash(hash, CryptoConfig.MapNameToOID("SHA1")));
                return signature;
            }

        }

        public string  VerifySignature(byte[] ciphertextBytes, string parameters, string signatureToVerify)
        {
            InitializeRSAProviderOther(parameters);
            string actualSignature = GenerateSignature(ciphertextBytes, rSAProviderOther);
            if (actualSignature.Equals(signatureToVerify))
            {
                //verification successful
                string decryptedData = this.Decrypt(ciphertextBytes);
                return decryptedData;
                //decryptedData is a symmetric key
            }
            else
            {
                //verification unsuccessful
                //end session
            }
            return string.Empty;
        }

        #region IDisposable Members

        public void Dispose()
        {
            if (rSAProviderOther != null)
            {
                rSAProviderOther.Clear();
            }
            rSAProviderThis.Clear();
            GC.SuppressFinalize(this);
        }
        #endregion
    }
} 
```

你们还没有谈到如何建立通信（我在想套接字）。请赐教。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T13:41:32.627

我不知道这段代码是否对你有帮助，我编写这段代码是为了能够在不同的加密算法中使用私钥/公钥对进行加密和解密，并且没有数据来加密长度问题，事实上 RSA 实现在 . NET 当您尝试管理超过 250 个（或多或少，抱歉我不记得）字节的数据时会受到影响。

我只是剪切和粘贴只需要的方法，我还剪切了 xml 文档，因为不是英文的，如果你觉得这很有用，请告诉我，我可以发布所有源代码。我再说一遍，我没有测试这个剪切和粘贴版本，但是我使用了这个类的完整版本，它并没有那么不同。

顺便说一句：它在 VB 中，但如果你只需要潜伏在它上面，我认为这就足够了；）

```
Namespace Crypto

    Public Class RSACry

        Shared Sub New()
        End Sub

        Public Enum Algorithms
            DES
            TDES
            RC2
            RDAEL
        End Enum

        Public Shared Function Encrypt(ByVal xmlkeystring As String, ByVal typo As Algorithms, ByVal datatoencrypt As String) As String
            Dim rsaer As RSA = Crypto.RSACry.ReadKeyString(xmlkeystring)
            Dim result() As Byte = Crypto.RSACry.EncryptIt(rsaer, typo, datatoencrypt)
            Return System.Convert.ToBase64String(result)
        End Function

        Public Shared Function Decrypt(ByVal xmlkeystring As String, ByVal typo As Algorithms, ByVal datatodecrypt As String) As String
            Dim rsaer As RSA = Crypto.RSACry.ReadKeyString(xmlkeystring)
            Dim result() As Byte = Crypto.RSACry.DecryptIt(rsaer, typo, datatodecrypt)
            Return System.Text.Encoding.UTF8.GetString(result)
        End Function

        Friend Shared Function EncryptIt(ByRef rsaer As RSA, ByVal typo As Algorithms, ByVal datatoencrypt As String) As Byte()
            Dim result() As Byte = Nothing

            Try
                Dim plainbytes() As Byte = System.Text.Encoding.UTF8.GetBytes(datatoencrypt)
                Dim sa As SymmetricAlgorithm = SymmetricAlgorithm.Create(Crypto.RSACry.GetAlgorithmName(typo))
                Dim ct As ICryptoTransform = sa.CreateEncryptor()
                Dim encrypt() As Byte = ct.TransformFinalBlock(plainbytes, 0, plainbytes.Length)
                Dim fmt As RSAPKCS1KeyExchangeFormatter = New RSAPKCS1KeyExchangeFormatter(rsaer)
                Dim keyex() As Byte = fmt.CreateKeyExchange(sa.Key)

                --return the key exchange, the IV (public) and encrypted data 
                result = New Byte(keyex.Length + sa.IV.Length + encrypt.Length) {}
                Buffer.BlockCopy(keyex, 0, result, 0, keyex.Length)
                Buffer.BlockCopy(sa.IV, 0, result, keyex.Length, sa.IV.Length)
                Buffer.BlockCopy(encrypt, 0, result, keyex.Length + sa.IV.Length, encrypt.Length)

            Catch ex As Exception
                Throw New CryptographicException("Unable to crypt: " + ex.Message)
            End Try

            Return result
        End Function

        Friend Shared Function DecryptIt(ByRef rsaer As RSA, ByVal typo As Algorithms, ByVal datatodecrypt As String) As Byte()
            Dim result() As Byte = Nothing

            Try
                Dim encrbytes() As Byte = System.Convert.FromBase64String(datatodecrypt)
                Dim sa As SymmetricAlgorithm = SymmetricAlgorithm.Create(Crypto.RSACry.GetAlgorithmName(typo))
                Dim keyex() As Byte = New Byte((rsaer.KeySize >> 3) - 1) {}
                Buffer.BlockCopy(encrbytes, 0, keyex, 0, keyex.Length)

                Dim def As RSAPKCS1KeyExchangeDeformatter = New RSAPKCS1KeyExchangeDeformatter(rsaer)
                Dim key() As Byte = def.DecryptKeyExchange(keyex)
                Dim iv() As Byte = New Byte((sa.IV.Length - 1)) {}
                Buffer.BlockCopy(encrbytes, keyex.Length, iv, 0, iv.Length)

                Dim ct As ICryptoTransform = sa.CreateDecryptor(key, iv)
                result = ct.TransformFinalBlock(encrbytes, keyex.Length + iv.Length, (encrbytes.Length - 1) - (keyex.Length + iv.Length))
            Catch ex As Exception
                Throw New CryptographicException("Unable to decrypt: " + ex.Message)
            End Try

            Return result
        End Function    

        Friend Shared Function GetAlgorithmName(ByVal typo As Algorithms) As String
            Dim algtype As String = String.Empty

            Select Case typo
                Case Algorithms.DES
                    Return "DES"
                    Exit Select
                Case Algorithms.RC2
                    Return "RC2"
                    Exit Select
                Case Algorithms.RDAEL
                    Return "Rijndael"
                    Exit Select
                Case Algorithms.TDES
                    Return "TripleDES"
                    Exit Select
                Case Else
                    Return "Rijndael"
                    Exit Select
            End Select

            Return algtype
        End Function

        Friend Shared Function ReadKeyString(ByVal xmlkeystring As String) As RSA
            Dim rsaer As RSA = Nothing

            Try
                If (String.IsNullOrEmpty(xmlkeystring)) Then Throw New Exception("Key is not specified")
                rsaer = RSA.Create()
                rsaer.FromXmlString(xmlkeystring)
            Catch ex As Exception
                Throw New CryptographicException("Unable to load key")
            End Try

            Return rsaer
        End Function    

End Namespace 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T14:24:47.907

@gogole：实际上我不使用套接字，此代码以独立方式使用，并带有手动键。然而，一旦你有了你的加密机制，你就完成了一半以上的旅程。

这里缺少两种创建密钥的方法，因为您要求代码是完整的。我希望你觉得这很有帮助

```
Public Shared Sub CreateKeyPair(ByVal filename As String)
    Dim xmlpublic As String = String.Empty
    Dim xmlprivate As String = String.Empty

    CreateKeyPair(xmlpublic, xmlprivate)

    Try
        Dim writer As New StreamWriter(filename + ".prv")
        writer.Write(xmlprivate)
        writer.Flush()
        writer.Close()
    Catch ex As Exception
        Throw New CryptographicException("Unable to write private key file: " + ex.Message)
    End Try

    Try
        Dim writer = New StreamWriter(filename + ".pub")
        writer.Write(xmlpublic)
        writer.Flush()
        writer.Close()
    Catch ex As Exception
        Throw New CryptographicException("Unable to write public key file: " + ex.Message)
    End Try
End Sub

Public Shared Sub CreateKeyPair(ByRef xmlpublic As String, ByRef xmlprivate As String)
    Dim rsa As RSA = Nothing

    Try
        rsa.Create()
    Catch ex As Exception
        Throw New CryptographicException("Unable to initialize keys: " + ex.Message)
    End Try

    Try
        xmlpublic = rsa.ToXmlString(True)
    Catch ex As Exception
        Throw New CryptographicException("Unable to generate public key: " + ex.Message)
    End Try

    Try
        xmlprivate = rsa.ToXmlString(False)
    Catch ex As Exception
        Throw New CryptographicException("Unable to generate private key: " + ex.Message)
    End Try
End Sub 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-02T23:33:57.757

不太了解 vb，但尝试将 @Andrea Celin 转换为 c# 中有用的代码之一

```
namespace Crypto
{
using System;
using System.Security.Cryptography;
class RSACry
{
    public enum Algorithms
    {
        DES,
        TDES,
        RC2,
        RDAEL
    };
    public string Encrypt(string xmlkeystring, Algorithms typo, string datatoencrypt)
    {
        RSA rsaer = RSACry.ReadKeyString(xmlkeystring);
        byte[] result = RSACry.EncryptIt(rsaer, typo, datatoencrypt);
        return System.Convert.ToBase64String(result);
    }

    public string Decrypt(string xmlkeystring,Algorithms typo,string datatodecrypt)
    {
        RSA rsaer = RSACry.ReadKeyString(xmlkeystring);
        byte[] result =RSACry.DecryptIt(rsaer, typo, datatodecrypt);
        return System.Text.Encoding.UTF8.GetString(result);
    }

    public static byte[] EncryptIt(RSA rsaer, Algorithms typo, string datatoencrypt)
    {
        byte[] result = null;
        try
        {
            byte[] plainbytes = System.Text.Encoding.UTF8.GetBytes(datatoencrypt);
            SymmetricAlgorithm sa = SymmetricAlgorithm.Create(RSACry.GetAlgorithmName(typo));
            ICryptoTransform ct = sa.CreateEncryptor();
            byte[] encrypt = ct.TransformFinalBlock(plainbytes, 0, plainbytes.Length);
            RSAPKCS1KeyExchangeFormatter fmt = new RSAPKCS1KeyExchangeFormatter(rsaer);
            byte[] keyex = fmt.CreateKeyExchange(sa.Key);

            //--return the key exchange, the IV (public) and encrypted data 
            result = new byte[keyex.Length + sa.IV.Length + encrypt.Length];
            Buffer.BlockCopy(keyex, 0, result, 0, keyex.Length);
            Buffer.BlockCopy(sa.IV, 0, result, keyex.Length, sa.IV.Length);
            Buffer.BlockCopy(encrypt, 0, result, keyex.Length + sa.IV.Length, encrypt.Length);
        }
        catch (Exception ex)
        {
            throw new CryptographicException("Unable to crypt: " + ex.Message);
        }
        return result;
    }

    public static byte[] DecryptIt(RSA rsaer, Algorithms typo, string datatodecrypt)
    {
        byte[] result = null;

        try
        {
            byte[] encrbytes = System.Convert.FromBase64String(datatodecrypt);
            SymmetricAlgorithm sa = SymmetricAlgorithm.Create(RSACry.GetAlgorithmName(typo));
            byte[] keyex = new byte[(rsaer.KeySize >> 3) - 1];
            Buffer.BlockCopy(encrbytes, 0, keyex, 0, keyex.Length);

            RSAPKCS1KeyExchangeDeformatter def = new RSAPKCS1KeyExchangeDeformatter(rsaer);
            byte[] key = def.DecryptKeyExchange(keyex);
            byte[] iv = new byte[sa.IV.Length - 1];
            Buffer.BlockCopy(encrbytes, keyex.Length, iv, 0, iv.Length);

            ICryptoTransform ct = sa.CreateDecryptor(key, iv);
            result = ct.TransformFinalBlock(encrbytes, keyex.Length + iv.Length, (encrbytes.Length - 1) - (keyex.Length + iv.Length));
        }
        catch (Exception ex)
        {
            throw new CryptographicException("Unable to decrypt: " + ex.Message);
        }

        return result;
    }

    public static string GetAlgorithmName(Algorithms typo)
    {
        string algtype = String.Empty;
        switch(typo)
        {
            case Algorithms.DES:
                algtype = "DES";
                break;
            case Algorithms.RC2:
                algtype = "RC2";
                break;
            case Algorithms.RDAEL:
                algtype = "Rijndael";
                break;
            case Algorithms.TDES:
                algtype = "TripleDES";
                break;
            default:
                algtype = "Rijndael";
                break;
        }
        return algtype;
    }

    public static RSA ReadKeyString(string xmlkeystring)
    {
        RSA rsaer = null;
        try
        {
            if (String.IsNullOrEmpty(xmlkeystring))
            { throw new Exception("Key is not specified"); }
            rsaer = RSA.Create();
            rsaer.FromXmlString(xmlkeystring);
        }
        catch (Exception ex)
        {
            throw new CryptographicException("Unable to load key :"+ex.Message);
        }
        return rsaer;
    }
}
} 
```

# .net - 在 .NET 中显示类层次结构的工具

> ID：384406
> 
> 赞同：12
> 
> 时间：2008-12-21T12:36:13.680
> 
> 标签：.net, class-hierarchy

有没有一种方法/工具可以向我展示在我的项目中实现某个接口的所有类/接口？在 Eclipse (Java) 中，我会使用上下文菜单“Open Type Hierarchy”选项，它会向我显示一个扩展所选类型的（漂亮的）类型树。.NET 中是否有工具可以做同样的事情？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-21T13:23:22.883

我赞同 Marc 对[.NET Reflector](http://www.red-gate.com/products/reflector/)的推荐- 并且想补充一点，[CodePlex](http://www.codeplex.com/reflectoraddins)提供了一系列令人印象深刻的插件。

只是我经常使用的一些加载项：

*   Deblector - 此插件允许从 Reflector 中调试进程。
*   Graph - 此插件绘制程序集依赖图和 IL 图。
*   DependencyStructureMatrix - 允许您创建和浏览依赖结构矩阵。
*   AutoDiagrammer - 此插件绘制类图。
*   CodeModelViewer - 此加载项显示选定项目的基础代码模型对象。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-21T13:15:58.887

Resharper Visual Studio 插件还具有 View Type Hierarchy 功能以及许多其他强大功能。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-21T13:23:33.240

您可以在 Visual Studio中使用[*对象浏览器：*](http://msdn.microsoft.com/en-us/library/exy1facf.aspx)

> 对象浏览器允许您选择和检查可用于项目的符号。您可以从视图菜单中打开对象浏览器，或单击主工具栏上的对象浏览器按钮。
> 
> 在“对象”窗格中，图标标识层次结构，例如 .NET Framework 和 COM 组件、命名空间、类型库、接口、枚举和类。您可以扩展这些结构以显示其成员的有序列表。成员窗格中列出了属性、方法、事件、变量、常量和其他包含的项目。在“对象”窗格或“成员”窗格中选择的项目的详细信息显示在“描述”窗格中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T12:42:32.323

[反射器](http://www.red-gate.com/products/reflector/)会这样做（并且是免费的）。找到接口，然后展开树中的“派生类型”节点。

或者，Visual Studio 中的“类图”项目项应该这样做，但我喜欢 Reflector 的干净特性。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-06-28T10:59:53.783

我发现这个 Resharper 函数很方便只显示类型层次结构。接近 Eclipse 提供的东西（F4 - 打开类型层次结构）选择父类，然后右键单击 VS 编辑器并选择“查找高级用法”并选择“派生类型”复选框（或）按 CTRL + ALT + SHIFT F12 以显示搜索属性窗户

![在此处输入图像描述](https://i.stack.imgur.com/mZ93y.jpg)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-12-08T15:57:36.537

我刚刚发现查看派生类的选项在 C++ 中可用（在类视图中），但在 Visual Studio 2008 中的 C# 中不可用。哇。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-02-07T12:22:28.690

因为我在 2018 年一直在寻找相同的东西：

从 Visual Studio 2015 开始，您可以简单地[从 Marketplace 安装 Type Hierarchy Viewer](https://marketplace.visualstudio.com/items?itemName=munyabe.TypeHierarchyViewer)。这确实不如它的 Eclipse 漂亮，但做得很好并且是免费的。

# lisp - LISP 逐级显示二叉树

> ID：384419
> 
> 赞同：2
> 
> 时间：2008-12-21T12:48:16.243
> 
> 标签：lisp, binary-tree

我有一个看起来像 (A (B (CD)) (E (F))) 的列表，它代表这棵树：

```
 A
    /  \
  B      E
 / \    /
C   D  F 
```

如何将其打印为 (ABECDF) ？

据我所知，这是：

```
((lambda(tree) (loop for ele in tree do (print ele))) my-list) 
```

但它打印：

```
A
(B (C D))
(E (F))
NIL 
```

我对 Common LISP 很陌生，所以可能有一些我应该使用的功能。如果是这样，那么请启发我。

谢谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-21T17:46:22.383

从表面上看您的问题，您希望以“广度优先”顺序打印节点，而不是使用标准的深度优先顺序之一：“按顺序”或“预购”或“后-命令'。

*   顺序：CBDAEF
*   预购：ABCDEF
*   后订单：CDBFEA

*   要求的订单： ABECDF

在你的树结构中，每个元素可以是一个原子，也可以是一个包含一个元素的列表，或者一个包含两个元素的列表。列表的第一个元素始终是原子。

我认为伪代码需要大致如下：

```
Given a list 'remains-of-tree':
    Create empty 'next-level' list
    Foreach item in `remains-of-tree`
        Print the CAR of `remains-of-tree`
        If the CDR of `remains-of-tree` is not empty
             CONS the first item onto 'next-level'
             If there is a second item, CONS that onto `next-level`
    Recurse, passing `next-level` as argument. 
```

我 100% 确定可以清理（这看起来像微不足道的尾递归，除此之外）。但是，我认为它有效。

```
Start: (A (B (C D)) (E (F)))
Level 1:
Print CAR: A
Add (B (C D)) to next-level: ((B (C D)))
Add (E (F)) to next-level: ((B (C D)) (E (F)))
Pass ((B (C D) (E (F))) to level 2:
Level 2:
Item 1 is (B (C D))
Print CAR: B
Push C to next-level: (C)
Push D to next-level: (C D)
Item 2 is (E (F))
Print CAR: E
Push F to next-level: (C D F)
Pass (C D F) to level 3:
Level 3:
Item 1 is C
Print CAR: C
Item 2 is D
Print CAR: D
Item 3 is F
Print CAR: F 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T15:41:40.060

您表示列表的方式似乎不一致。对于您的示例，我想它应该是：`(A ((B (C D)) (E (F))))`. 这样，一个节点始终是一个叶子或一个列表，其中汽车是叶子，而 cadr 是子节点。

由于这个错误，我假设这不是家庭作业。这是一个递归解决方案。

```
(defun by-levels (ts)
  (if (null ts)
      '()
      (append
       (mapcar #'(lambda (x) (if (listp x) (car x) x)) ts)
       (by-levels (mapcan #'(lambda (x) (if (listp x) (cadr x) '())) ts))))) 
```

`by-levels`获取节点列表并收集顶级节点的值，并递归查找下一个子节点以用作下一个节点。

现在，

```
(defun leafs-of-tree-by-levels (tree)
  (by-levels (list tree)))

(leafs-of-tree-by-levels '(a ((b (c d)) (e (f)))))
; (A B E C D F) 
```

我希望这是有道理的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T18:11:52.457

我的 Lisp 有点生疏了，但正如 Jonathan 建议的那样，应该使用广度优先的树行走 - 沿着这些思路

编辑：我想我之前读这个问题有点太快了。你所拥有的基本上是一个函数应用程序的语法树，所以这里是修改后的代码。我从您对问题的描述中假设，如果 C 和 D 是 B 的孩子，那么您打算写 (B (C)(D))

```
; q is a queue of function calls to print
(setq q (list the-original-expression))
; for each function call
(while q
  ; dequeue the first one
  (setq a (car q) q (cdr q))
  ; print the name of the function
  (print (car a))
  ; append its arguments to the queue to be printed
  (setq q (append q)(cdr a))
  ) 
```

这是历史：

```
 q: ( (A (B (C)(D))(E (F))) )
print: A
         q: ( (B (C)(D))(E (F)) )
print: B
         q: ( (E (F))(C)(D) )
print: E
         q: ( (C)(D)(F) )
print: C
         q: ( (D)(F) )
print: D
         q: ( (F) )
print: F
         q: nil 
```

# c++ - C++ 头文件 - 困惑！

> ID：384431
> 
> 赞同：5
> 
> 时间：2008-12-21T13:01:07.653
> 
> 标签：c++, header-files

```
game.h needs:
- packet.h
- socket.h

server.h needs:
- socket.h

socket.h needs:
- game.h 
```

当我尝试将 socket.h 包含到 game.h 中时，问题就出现了，因为 socket.h 已经包含了 game.h。我该如何解决这些问题？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-12-21T13:02:38.120

通常的方式，在你的头文件中使用#ifdef 和#define

里面game.h：

```
#ifndef GAME_H
#define GAME_H

.. rest of your header file here

#endif 
```

这样，内容将被多次读取，但只定义一次。

**编辑**：删除了每个评论标识符开头和结尾的下划线。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-21T13:05:31.483

关键是前向声明。从中获取`game.h`所需的内容`socket.h`（反之亦然），然后在另一个标题中前向声明它，例如`game_forwards.h`. 例如，考虑以下情况：

```
// game_fwd.h

#ifndef GAME_FWD_H
#define GAME_FWD_H

class game;

#endif // ndef GAME_FWD_H

// game.h

#ifndef GAME_H
#define GAME_H

#include "socket.h"

class game {
    socket* m_sck;
};

#endif // ndef GAME_H

// socket.h

#ifndef SOCKET_H
#define SOCKET_H

#include "game_fwd.h"

class socket {
    game* m_game;
};

#endif // ndef SOCKET_H 
```

显然，要使其工作，分离接口和实现很重要。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-21T15:50:28.107

除了技术（前向定义和只读头）之外，您还需要弄清楚为什么您的套接字头需要游戏头中的任何内容，并将您的系统打包成具有单一依赖顺序的模块。套接字类不应该有任何理由需要知道它正在用于什么游戏。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-21T16:02:07.243

为了完整起见，另一种选择是：

```
#pragma once 
```

在文件的顶部。

这样做的好处是不会重复打开文件，节省编译时间。

它的缺点是不标准，因此并非所有编译器都支持它。在 Visual C++ 中可靠地工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-21T13:17:57.480

我想不出任何优雅的方法来解决它 - 你最好的选择是前向定义实际使用的函数。因此，如果 game.h 仅使用 socket.h 中的 connect() 函数，则将这一行添加到 game.h：

```
void connect(); 
```

并删除 socket.h 导入。当然，如果 connect() 的签名发生变化，您还需要记住更新前向定义，因此这种解决方案远非理想。如果可能的话，修改设计以避免循环依赖。

如果 game.h 只需要知道 socket.h 中的一个类，向前定义它是这样的：

```
class Socket; 
```

关于内联函数和成员对象有一些注意事项，请参阅[The C++ FAQ Lite](http://www.parashift.com/c++-faq-lite/misc-technical-issues.html#faq-39.12)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T13:08:24.253

@lassevk，不应该是“头文件将被打开几次，但预处理器只会在第一次读取期间读取#ifndef 和#endif 之间的文件内容一次。之后预处理器将忽略bewteen PP 宏，因为 _GAME_H 已定义。”

# f# - f# byte[] -> 十六进制 -> 字符串转换

> ID：384442
> 
> 赞同：7
> 
> 时间：2008-12-21T13:07:12.617
> 
> 标签：f#

我有字节数组作为输入。我想将该数组转换为包含数组值的十六进制表示的字符串。这是 F# 代码：

```
let ByteToHex bytes = 
    bytes 
    |> Array.map (fun (x : byte) -> String.Format("{0:X2}", x))

let ConcatArray stringArray = String.Join(null, (ByteToHex  stringArray)) 
```

这会产生我需要的结果，但我想让它更紧凑，以便我只有一个功能。我找不到可以在 ByteToHex 末尾连接每个字节的字符串表示的函数。
我尝试了 Array.concat、concat_map，我尝试了列表，但我能得到的最好的结果是数组或字符串列表。

问题：

1.  什么是最简单、最优雅的方法？
2.  F# 中是否有字符串格式化构造，以便我可以从系统程序集中替换 String.Format？

示例输入：[|0x24uy; 0xA1uy; 0x00uy; 0x1Cuy|] 应该产生字符串“24A1001C”

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-21T14:42:55.453

您的示例本质上没有任何问题。如果您想将其简化为单个表达式，请使用 String.contcat 方法。

```
let ByteToHex bytes = 
    bytes 
    |> Array.map (fun (x : byte) -> System.String.Format("{0:X2}", x))
    |> String.concat System.String.Empty 
```

在后台，String.concat 只会调用 String.Join。不过，您的代码可能需要稍作修改，因为根据您的示例您导入 System. 这可能会在 F# String 和 System.String 之间产生名称解析冲突。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2016-03-29T19:08:49.043

如果你想一步步蜕变积累，`fold`就是你的答案。`sprintf`是 F# 字符串格式函数。

```
let ByteToHex (bytes:byte[]) =
    bytes |> Array.fold (fun state x-> state + sprintf "%02X" x) "" 
```

这也可以使用 StringBuilder 来完成

```
open System.Text

let ByteToHex (bytes:byte[]) =
        (StringBuilder(), bytes)
        ||> Array.fold (fun state -> sprintf "%02X" >> state.Append)  
        |> string 
```

产生：

```
[|0x24uy; 0xA1uy; 0x00uy; 0x1Cuy|] |> ByteToHex;;
val it : string = "24A1001C" 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-25T09:30:16.220

这是另一个答案：

```
let hashFormat (h : byte[]) =
  let sb = StringBuilder(h.Length * 2)
  let rec hashFormat' = function
    | _ as currIndex when currIndex = h.Length -> sb.ToString()
    | _ as currIndex ->
      sb.AppendFormat("{0:X2}", h.[currIndex]) |> ignore
      hashFormat' (currIndex + 1)
  hashFormat' 0 
```

这个的好处是它是尾递归的，并且它在字符串构建器中预先分配了将字节数组转换为十六进制字符串所需的确切空间量。

对于上下文，我在这个模块中有它：

```
module EncodingUtils

open System
open System.Text
open System.Security.Cryptography
open Newtonsoft.Json

let private hmacmd5 = new HMACMD5()
let private encoding = System.Text.Encoding.UTF8
let private enc (str : string) = encoding.GetBytes str
let private json o = JsonConvert.SerializeObject o
let md5 a = a |> (json >> enc >> hmacmd5.ComputeHash >> hashFormat) 
```

这意味着我可以传递 md5 任何对象并取回它的 JSON 哈希。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-06-01T16:31:19.773

这是另一个。我正在学习 F#，所以请随时用更惯用的方法来纠正我：

```
let bytesToHexString (bytes : byte[]) : string =
    bytes
    |> Seq.map (fun c -> c.ToString("X2"))
    |> Seq.reduce (+) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-22T15:36:14.720

在我看来很好。只是指出另一个，在我看来，Printf 模块中非常有用的功能，看看`ksprintf`. 它将格式化字符串的结果传递给您选择的函数（在本例中为标识函数）。

```
val ksprintf : (string -> 'd) -> StringFormat<'a,'d> -> 'a  
    sprintf, but call the given 'final' function to generate the result. 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-21T13:14:48.000

老实说，这看起来并不可怕（尽管我也*很少*有 F# 经验）。F# 是否提供了一种简单的迭代方法（foreach）？如果这是 C#，我可能会使用类似（参数在哪里`raw`）`byte[]`：

```
 StringBuilder sb = new StringBuilder();
        foreach (byte b in raw) {
            sb.Append(b.ToString("x2"));
        }
        return sb.ToString() 
```

我想知道这如何转化为 F#...

# security - 最好的程序化安全控制和设计模式是什么？

> ID：384451
> 
> 赞同：6
> 
> 时间：2008-12-21T13:18:14.890
> 
> 标签：security, language-agnostic, design-patterns

有很多安全建议可以告诉程序员*不要*做什么。在您看来，在为良好的安全性进行编码时*应该遵循哪些最佳实践？*

请在下面添加您建议的安全控制/设计模式。建议的格式是一个粗体标题，总结了这个想法，然后是描述和示例，例如：

> **默认拒绝**
> 
> *拒绝所有未明确允许的...*

请投票或评论改进，而不是复制现有答案。还请在他们自己的答案中添加不同的模式和控件，而不是添加带有 3 或 4 个首选控件的答案。

编辑：我将其设为社区 wiki 以鼓励投票。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-22T01:01:37.107

人们列出的所有这些想法（隔离、最低权限、白名单）都是工具。

但是您首先必须知道“安全”对您的应用程序意味着什么。通常它意味着类似

1.  **可用性**：该程序不会因为另一个客户端提交了错误数据而无法为一个客户端提供服务。
2.  **隐私**：程序不会将一个用户的数据泄露给另一个用户
3.  **隔离**：程序不会与用户不希望的数据交互。
4.  **可审查**性：该程序显然可以正常运行 - 计票器的理想属性。
5.  **[可信路径](http://en.wikipedia.org/wiki/Trusted_path)**：用户知道他们正在与哪个实体进行交互。

一旦您知道安全性对您的应用程序意味着什么，您就可以开始围绕它进行设计。

一种没有经常被提及的设计实践是**[Object Capabilities](http://en.wikipedia.org/wiki/Object-capability_model)**。

许多安全系统需要做出授权决定——这段代码是否能够访问该文件或打开该机器的套接字。

访问控制列表是一种方法——指定可以访问的文件。这样的系统虽然需要大量的维护开销。他们为人们获得许可的安全机构工作，他们为部署数据库的公司雇用数据库管理员的数据库工作。但是它们对于安全的最终用户软件来说效果不佳，因为用户通常既没有技能也没有保持列表最新的意愿。

对象能力通过在对象引用上捎带访问决策来解决这个问题——通过使用程序员在精心设计的面向对象系统中已经完成的所有工作来最小化任何单个代码段的权限。请参阅[CapDesk](http://video.google.com/videoplay?docid=-7961423532989255419)以了解其在实践中如何工作的示例。

DARPA 运行了一个名为 DARPA 浏览器项目的安全系统设计实验，该实验发现以这种方式设计的系统——尽管它与其他面向对象的系统具有相同的错误率——但可利用的漏洞率要低得多。由于设计人员使用对象功能遵循 POLA，因此攻击者很难找到利用漏洞破坏系统的方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-21T13:24:01.930

最小特权原则——一个进程应该只持有它实际需要的那些特权，并且应该只在必要的最短时间里持有这些特权。因此，例如，使用`sudo make install`比`su`打开 shell 然后以超级用户身份工作要好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-21T13:25:38.040

**白名单**

*选择您知道自己接受的内容*

（是的，我知道，这与“默认拒绝”非常相似，但我喜欢使用积极的思维方式。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-21T14:30:36.990

**重用经过验证的代码**

使用经过验证的加密算法、加密随机数生成器、哈希函数、身份验证方案、访问控制系统，而不是自己动手。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-21T15:02:45.770

**聘请安全专业人员**

安全是一项专业技能。不要试图自己做。如果您负担不起将安全性外包出去的费用，那么至少请一位专业人士来测试您的实施。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-21T15:04:23.193

**从一开始就设计安全性**

当您将其添加到现有系统时，更容易出现安全错误。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-21T13:29:22.760

在做出安全设计决策之前对威胁进行建模——考虑可能存在哪些威胁，以及它们的可能性有多大。例如，有人窃取您的计算机的可能性更大的是使用笔记本电脑而不是台式机。然后首先担心这些更可能的威胁。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-12-21T13:43:40.267

限制“攻击面”。通过防火墙、有限访问等，尽可能减少您的系统受到的攻击。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-21T13:45:01.357

记住人身安全。如果有人可以拿走你的硬盘，那可能是最有效的攻击方式。

（我记得在一次入侵红队演习中，我们带着一个剪贴板和一个看起来很正式的表格出现了，然后带着整个“安全”系统离开了。）

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-12-21T13:46:49.700

加密≠安全。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-22T00:26:16.710

隔离。代码应该在例如进程之间具有很强的隔离性，以便一个组件中的故障不会轻易危及其他组件。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-21T13:34:32.063

用成本来表达风险和危害。钱。它奇妙地集中精神。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-12-21T13:44:29.080

很好地理解加密构建块的基本假设可能很重要。例如，RC4 之类的流密码非常有用，但可以很容易地用于构建不安全的系统（即 WEP 等）。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-21T13:48:20.443

如果您出于安全考虑对数据进行加密，则企业中风险最高的数据将成为您的密钥。丢失密钥，数据丢失；泄露密钥，您的所有数据都会被泄露。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-12-21T13:33:19.507

利用风险做出安全决策。一旦确定了不同威胁的可能性，然后考虑每种威胁可能造成的危害。根据定义，风险是

**R = P [e] × H**

其中*P [e]*是不良事件的*概率*，*H*是*危害*，或可能来自不良事件的伤害量。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-12-21T13:37:27.223

分开关注。构建您的系统并设计您的代码，以便将安全关键组件保持在一起。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-12-22T13:33:57.150

**KISS（保持简单，愚蠢）**

如果您需要就系统安全的原因提出一个非常复杂且难以理解的论点，那么它可能不安全。

正式的安全设计有时会提到一种称为 TCB（可信计算库）的东西。但即使是非正式的设计也有类似的东西——代码的安全执行部分，你无法避免依赖的部分。这需要很好地封装，并且尽可能简单和小巧。

# c# - 内部方法和数据结构。

> ID：384462
> 
> 赞同：3
> 
> 时间：2008-12-21T13:29:10.733
> 
> 标签：c#, .net, scope, internals

如果我有一个受保护的方法，我可以传入一个数据类型声明为内部的参数吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-21T13:31:22.693

不，除非类型（带有受保护的成员）本身是内部的。内部类型不能成为公共/受保护 API 的一部分，因为消费者无法使用它。

但是，您可以考虑使用公共接口来抽象类型 - 即

```
public interface IFoo {}
internal class Foo : IFoo {}
public class Bar {
    protected void Test(IFoo foo) {}
} 
```

泛型对此也很有用：

```
protected void Test<T>(T foo) where T : IFoo { } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T13:33:14.657

如果包含受保护方法的类在外部可见，则不会。那是因为某些外部类可以从该类派生，并且需要知道参数的类型。

# python - 用于 Python 3.x 的 MySQL-db 库？

> ID：384471
> 
> 赞同：36
> 
> 时间：2008-12-21T13:37:38.843
> 
> 标签：python, mysql, python-3.x

那么，寻找一个与py3k/py3.0/py3000兼容的mysql-db-lib，有什么想法吗？谷歌一无所获。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2011-03-13T09:42:27.160

看来 MySQLdb 几乎是一个死项目。但是，[PyMySQL](https://github.com/PyMySQL/PyMySQL/)是 mysql 客户端的 dbapi 兼容、纯 python 实现，并且支持 python 3。

编辑：还有[MySQL Connector/Python](https://launchpad.net/myconnpy)。同样的想法。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-08-31T17:19:17.403

我也在找它，但什么也没找到，所以我将 MySQL-python-1.2.3 移植到 py3k 你可以在这里阅读 [http://sourceforge.net/p/mysql-python/discussion/70460/thread/61e3a3c9 /](http://sourceforge.net/p/mysql-python/discussion/70460/thread/61e3a3c9/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-08-18T01:17:10.607

目前有一些将 Python 3 与 mysql 结合使用的选项：

[https://pypi.python.org/pypi/mysql-connector-python](https://pypi.python.org/pypi/mysql-connector-python)

*   甲骨文官方支持
*   纯蟒蛇
*   有点慢
*   与 MySQLdb 不兼容

[https://pypi.python.org/pypi/pymysql](https://pypi.python.org/pypi/pymysql)

*   纯蟒蛇
*   比 mysql-connector 更快
*   `MySQLdb`调用后几乎完全兼容`pymysql.install_as_MySQLdb()`

[https://pypi.python.org/pypi/cymysql](https://pypi.python.org/pypi/cymysql)

*   具有可选 C 加速的 pymysql 的分支

[https://pypi.python.org/pypi/mysqlclient](https://pypi.python.org/pypi/mysqlclient)

*   Django 推荐的库。
*   原始 MySQLdb 的友好分支，希望有一天能合并回来
*   最快的实现，因为它是基于 C 的。
*   与 MySQLdb 最兼容，因为它是一个 fork
*   Debian 和 Ubuntu 使用它来提供`python-mysqldb`和`python3-mysqldb`包。

这里的基准：[https ://github.com/methane/mysql-driver-benchmarks](https://github.com/methane/mysql-driver-benchmarks)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-21T14:54:44.210

至于 MySQLdb 的未来计划，你可能想问作者（Andy Dustman）。
他的博客在这里： http: [//mysql-python.blogspot.com/](http://mysql-python.blogspot.com/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-06-17T20:30:52.677

这是 Python 3 的工作存储库：[https ://github.com/davispuh/MySQL-for-Python-3](https://github.com/davispuh/MySQL-for-Python-3)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-19T09:16:10.047

不确定你是否还在寻找，但你可以试试这个：http: [//sourceforge.net/projects/mypysql/](http://sourceforge.net/projects/mypysql/)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-05-28T07:18:35.360

可以下载兼容 Python3 的 mysql-connector-python 模块：

> [http://rpm.pbone.net/index.php3/stat/4/idpl/15667200/dir/rawhide/com/mysql-connector-python3-0.3.2-2.fc16.noarch.rpm.html](http://rpm.pbone.net/index.php3/stat/4/idpl/15667200/dir/rawhide/com/mysql-connector-python3-0.3.2-2.fc16.noarch.rpm.html)

获取“源 RPM”，解压缩并使用它（例如，将它放在您的 PYTHONPATH 中，然后查看示例）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-22T00:02:24.463

目前你可能最好使用 Python 2.x。将所有 Python 包移植到 3.x 还需要一段时间，我预计目前使用 3.x 编写库或应用程序会非常令人沮丧。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-10-15T23:22:43.613

有一个官方的 Python 2/3 库，可从 MySQL 网站下载。Oracle 于 2012 年 9 月 29 日向公众发布了 1.0.7 版。

它是纯 Python 并且适用于 MySQL 4.1+

在此处查看更多详细信息：http: [//dev.mysql.com/doc/connector-python/en/connector-python.html](http://dev.mysql.com/doc/connector-python/en/connector-python.html)

我目前正在将它与 MySQL 5.5 和 Python 3.2 一起使用，到目前为止没有任何问题:)

# c# - 如何查找和删除未使用的类以清理我的代码？

> ID：384481
> 
> 赞同：6
> 
> 时间：2008-12-21T13:50:07.460
> 
> 标签：c#, resharper

有没有一种快速的方法来检测我的应用程序中从未使用过的类？我刚刚接手了一个项目，我正在尝试做一些清理工作。

如果有帮助，我确实有[ReSharper 。](http://www.jetbrains.com/resharper/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T13:57:32.347

我不建议在新项目中删除旧代码。这真是自找麻烦。在最好的情况下，它可能会为您整理好东西，但不太可能对编译器或您的客户有太大帮助。除了最好的情况外，总有一些东西会坏掉。

也就是说，我意识到它并没有真正回答你的问题。为此，我向您指出这个相关问题：

[是否有自定义 FxCop 规则可以检测未使用的 PUBLIC 方法？](https://stackoverflow.com/questions/71518/is-there-a-custom-fxcop-rule-that-will-detect-unused-public-methods)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-21T15:01:17.787

1.  [依赖](http://www.ndepend.com/)
2.  [Resharper 4.5](http://rabdullin.com/journal/2008/12/19/resharper-45-features-and-release-date.html)（4.0 只检测未使用的私有成员）
3.  使用 Mono.Cecil 构建您自己的代码质量单元测试（一些示例可以在这个开源项目的Lokad.Quality[中](http://rabdullin.com/shared-libraries/)*找到*）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-21T15:36:31.973

在执行此操作之前，请仔细检查代码。检查反射的任何使用，因为可以加载类并且可以在运行时动态调用方法，而无需在编译时知道它们是哪些。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T14:01:38.763

这似乎是为 Resharper 的下一个版本提出的功能之一。这还没有帮助，但希望 EAP 指日可待。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T14:39:29.453

请注意这一点 - 您可能会删除您正在处理的代码附近不需要的东西，但您可能会在您不知情的情况下删除其他应用程序可能依赖的接口成员。

# passwords - 密码中允许使用哪些字符的最佳规则是什么？

> ID：384489
> 
> 赞同：22
> 
> 时间：2008-12-21T13:58:00.723
> 
> 标签：passwords, special-characters, password-policy

完全没有考虑它，我只想说我应该允许每个角色。无论如何它都会被散列，我不想限制想要创建强密码的人。

但是，仔细想想，有很多角色我不知道它们会对事物产生什么影响。外来字符、ascii 符号等来命名一对。

我试着用谷歌搜索，但我找不到任何关于人们做什么的明确标准。即使是大多数专业组织似乎也不知道。对于许多网站来说，完全禁止特殊字符似乎是一种常见的做法，这很愚蠢，而不是我想要做的。

无论如何，对于长度、允许的字符等是否有任何标准建议？

我不确定这是否重要，但我将使用带有 C# 的 ASP.NET

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-12-21T14:08:45.270

密码中通常允许使用任何可打印的非空白 ASCII 字符（介于 33 和 126 之间）。许多安全专家（和 SO 评论者）建议使用[密码](http://www.iusmentis.com/security/passphrasefaq/)代替密码，因此您必须允许空格。争论是由于它们的长度，并且由于短语不在字典中，因此密码短语比密码更难破解。（密码也更容易记住，因此合法用户不必将其写在他们显示器上的便签上。）

一些[强密码生成器](https://www.grc.com/passwords.htm)使用哈希，所以我对长度（512 或 1024）设置了一个非常高的限制，只是为了包容。今天的密码生成器通常产生 32-128 个字符的字符串，但谁知道未来几年会使用什么哈希。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-21T14:04:52.720

在有限的设备（手机、控制台等）上输入密码时，非 ASCII 字符肯定会让事情变得更难——但通常并非不可能。可以说，如果用户想要这样做，您应该让他们这样做。做一件合理且一致的事情很容易——例如，在散列之前用 UTF-8 编码。如果某些输入设备将字符作为组合发送（例如 e + 重音而不是“e 重音”），您只会遇到困难 - 但我怀疑这在现实生活中不会发生。（你可以自己分解所有东西，但是对于边缘情况来说这会很麻烦。）

但是，我会将其限制为*可打印*的字符。将标签、表单提要等放入密码中确实*是*在自找麻烦。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-21T14:00:24.790

不是专家，但我讨厌我选择的角色，而不是那些奇怪的角色被拒绝。所以，我想我同意你的直觉。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-21T15:18:39.780

从根本上说，应该允许大多数 unicode 类字符。但是请跳过控制字符（例如，除了空格之外的 0-31）、字节顺序标记（0xfffe 和 oxfeff）。此外，您希望首先规范化表示以摆脱由不同表示引起的问题。尽管您可能会针对似乎难以输入的字符发出警告，但用户会自行防范。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-21T16:00:02.240

简短的回答：允许尽可能多的系统支持它可以支持。现在真的没有理由不使用完整的 unicode 支持来进行文本输入，包括密码。我认为你不需要担心字符问题，只要它们是按字面意思处理的（但我不是这个领域的专家——小心 sql 注入）。

我对那些对密码施加限制的网站很恼火……*任何*形式的限制。我喜欢那些会告诉你密码有多强的网站，并建议你让它变得更强，但强迫用户输入至少 8 个字符，或者同时要求字母和数字等，这简直令人沮丧。

如果您需要最大字段大小（例如用于存储在数据库中），请尝试使其足够大以容纳人们手动输入的任何内容。确实没有太大的密码字段，因为总是有可能使用自动生成的强密码，但 64 到 128 个字符肯定就足够了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-21T16:30:36.903

请记住：当您存储密码时，所有密码都应使用单向算法（如 sha1 的 md5）进行加密。由于这些算法总是产生十六进制数字，因此您无需担心 SQL 注入或类似的事情。

所以，只要你能 md5 或 sha1 一个字符，就应该被接受。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-21T14:24:32.337

如果您正在谈论防止 SQL 注入类型的攻击，那么确保您的代码执行它应该做的事情可能是一个更好的主意，而不是依赖于限制输入以使问题变得更容易。

对于非 ascii 字符，如果您的输入可以正确表示为二进制字符串（而不是*text*），我认为这不是一个更困难的问题，然后将其传递给您的哈希函数或密钥生成器等。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-21T16:58:21.170

为“让用户包括其界面允许他们输入的任何和所有字符”添加另一票。我什至不会禁止制表符或控制字符。您的软件能够接受任意字节串并对其进行散列，因此接受任意字节串作为密码。否则会减少攻击者在蛮力或字典攻击中必须搜索的空间。

（当然，即使你允许一切，99% 的用户仍然会使用他们宠物的名字作为他们的密码......）

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2009-01-27T09:17:16.360

最终，您可能必须在发送给用户的确认电子邮件中打印出清晰的密码。

PS：可能还会考虑电子邮件中的编码问题，如果它不是标准的 ascii（例如日文字符），用户可能不会收到正确格式的电子邮件，或者由于字体而无法在另一个系统上阅读它没有被安装。

所有这些都在“可打印”的 ascii 字符范围内。

# iphone - 为什么 setFrame 会增加 layer 的引用计数？

> ID：384496
> 
> 赞同：0
> 
> 时间：2008-12-21T14:05:58.147
> 
> 标签：iphone, cocoa-touch

执行此代码：

```
mainLyr = [[CALayer layer] retain];
[mainLyr setFrame:CGRectMake(0.0,0.0,23.0,23.0)]; 
```

在调试器中，我发现之后`retain`，引用计数`mainLyr`为2。这是正确的。

但是之后`setFrame`，引用计数增加到 3。为什么？以及如何找出方法是否会增加或减少引用计数（在参考手册中找不到）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T14:10:45.283

正如在 stackoverflow 上多次说过的那样，不要依赖 refcount 进行内存管理。遵循[内存管理规则](http://www.stepwise.com/Articles/Technical/HoldMe.html)，你会做得很好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-21T14:49:20.587

Graham 是正确的，但它增加引用计数的原因是您在这里使用了 Core Animation；图层的帧变化是动画的，并且在动画期间目标对象被保留。在动画持续时间（默认为 0.25 秒，我相信）之后，您的引用计数应该减少 1。

# jquery - 使用 jQuery 操作ThickBox 内容的初始回调

> ID：384500
> 
> 赞同：3
> 
> 时间：2008-12-21T14:09:52.897
> 
> 标签：jquery, thickbox

下面是场景：
ThickBox 从父窗口（按下按钮时）打开，其中包含具有自动完成支持的输入集的 Ajax 内容（基于 div 的表单）。一旦 ThickBox(form) 关闭，输入值应该被传递给父窗口。

问题：
ThickBox 的内容是动态加载的，那么使用 jQuery（类似于 $(ThickBox).ready.. ）使用初始回调来操作 ThickBox 内容的正确方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T15:14:36.793

我的首选是调查其他模态插件选项，例如[jqModal](http://dev.iceburg.net/jquery/jqModal/#how)。这确实公开了您可以使用的 onShow 和 onHide 事件挂钩。

Thickbox 正在显示它的年龄，它不会暴露任何你可以观察到的“显示”事件。如果您一心想要使用厚盒，那么您有几个选择。

一种选择是使用 jQuery 公开的全局 ajax 事件，例如[$.ajaxSuccess 事件](http://docs.jquery.com/Ajax/ajaxSuccess#callback)。当thickbox 成功请求数据显示时，这将触发。但是此时，thickbox 可能尚未将数据添加到模态中，您必须尝试一下。

例如

```
$.ajaxSuccess( function(evt, request, settings){
   //ajax method has completed
}); 
```

请注意，此事件将在您页面中发生的**每个**ajax 事件完成时触发，因此您可能需要一些额外的检查

另一种选择是更改thickbox脚本并添加您自己的回调代码，允许您传入一个函数，该函数将在显示模式时引发。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-03-03T19:07:37.587

您可以使用[LiveQuery](http://plugins.jquery.com/project/livequery)插件。该插件将拦截 DOM 中的更改并自动重新绑定其他读取 DOM 的插件

# c++ - 在 64 位 Windows 上 long 的位大小是多少？

> ID：384502
> 
> 赞同：150
> 
> 时间：2008-12-21T14:10:43.007
> 
> 标签：c++, c, windows, 64-bit, porting

不久前，有人告诉我，`long`在 64 位机器上不是 64 位，我应该始终使用`int`. 这对我来说没有意义。我看过文档（例如 Apple 官方网站上的文档）说`long`在为 64 位 CPU 编译时确实是 64 位。我在 64 位 Windows 上查找了它，发现

> *   Windows：`long`并`int`保持 32 位长度，并且为 64 位整数定义了特殊的新数据类型。

（来自[http://www.intel.com/cd/ids/developer/asmo-na/eng/197664.htm?page=2](http://web.archive.org/web/20080117221414/http://www.intel.com:80/cd/ids/developer/asmo-na/eng/197664.htm?page=2)）

我应该使用什么？如果不在 Windows 上，我是否应该定义类似`uw`, `sw`((un)signed width) 的东西`long`，否则检查目标 CPU 位大小？

* * *

## 回答 #1

> 赞同：277
> 
> 时间：2008-12-21T17:03:11.003

在 Unix 世界中，对于 64 位平台的整数和指针的大小有几种可能的安排。最广泛使用的两个是 ILP64（实际上，只有极少数的例子；Cray 就是这样一个例子）和 LP64（几乎所有其他的例子）。首字母缩写词来自“int，long，指针是 64 位”和“long，指针是 64 位”。

```
Type           ILP64   LP64   LLP64
char              8      8       8
short            16     16      16
int              64     32      32
long             64     64      32
long long        64     64      64
pointer          64     64      64 
```

ILP64 系统被放弃，取而代之的是[LP64](http://www.unix.org/version2/whatsnew/lp64_wp.html)（也就是说，根据 Aspen 小组的建议，几乎所有后来的进入者都使用 LP64；只有具有 64 位操作传统的系统才使用不同的方案）。所有现代 64 位 Unix 系统都使用 LP64。MacOS X 和 Linux 都是现代 64 位系统。

Microsoft 使用不同的方案转换到 64 位：LLP64（'long long，指针是 64 位'）。这意味着 32 位软件可以在不改变的情况下重新编译。它的缺点是与其他人所做的不同，并且还需要修改代码以利用 64 位容量。总是需要修改；它只是一组与 Unix 平台所需的不同的修订。

如果您围绕平台中立的整数类型名称设计软件，可能使用 C99`<inttypes.h>`标头，当平台上可用类型时，该标头提供有符号（列出）和无符号（未列出；前缀为 'u'）：

*   `int8_t`- 8 位整数
*   `int16_t`- 16 位整数
*   `int32_t`- 32 位整数
*   `int64_t`- 64 位整数
*   `uintptr_t`- 大到足以容纳指针的无符号整数
*   `intmax_t`- 平台上最大的整数大小（可能大于`int64_t`）

然后，您可以在重要的地方使用这些类型对您的应用程序进行编码，并对系统类型（可能不同）非常小心。有一种`intptr_t`类型——一个有符号整数类型，用于保存指针；您应该计划不使用它，或者仅将其用作两个`uintptr_t`值相减的结果 ( `ptrdiff_t`)。

但是，正如问题所指出的那样（难以置信），64 位机器上整数数据类型的大小有不同的系统。习惯它; 世界不会改变。

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2012-08-18T23:39:43.343

目前尚不清楚问题是关于 Microsoft C++ 编译器还是 Windows API。但是，没有 [c++] 标签，所以我认为它是关于 Windows API 的。一些答案受到链接腐烂的影响，所以我提供了另一个可能腐烂的链接。

* * *

有关 Windows API 类型（如`INT`等）的信息`LONG`，MSDN 上有一个页面：

[Windows 数据类型](http://msdn.microsoft.com/en-us/library/windows/desktop/aa383751%28v=vs.85%29.aspx)

该信息还可以在各种 Windows 头文件中获得，例如`WinDef.h`. 我在这里列出了一些相关的类型：

```
类型 | 南美 | x86 | x64
----------------------------+------+--------+------ -
字节，布尔值 | 你 | 8 位 | 8位
----------------------------+------+--------+------ -
简短 | 小号 | 16 位 | 16 位
USHORT，字 | 你 | 16 位 | 16 位
----------------------------+------+--------+------ -
INT，长 | 小号 | 32 位 | 32 位
UINT, ULONG, DWORD | 你 | 32 位 | 32 位
----------------------------+------+--------+------ -
INT_PTR、LONG_PTR、LPARAM | 小号 | 32 位 | 64 位
UINT_PTR、ULONG_PTR、WPARAM | 你 | 32 位 | 64 位
----------------------------+------+--------+------ -
龙龙 | 小号 | 64 位 | 64 位
乌龙龙，QWORD | 你 | 64 位 | 64 位

```

“S/U”列表示有符号/无符号。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-21T14:30:41.513

MSDN 上的这篇文章引用了一些类型别名（在 Windows 上可用），它们的宽度更加明确：

[http://msdn.microsoft.com/en-us/library/aa505945.aspx](http://msdn.microsoft.com/en-us/library/aa505945.aspx)

例如，虽然您可以使用 ULONGLONG 来引用 64 位无符号整数值，但您也可以使用 UINT64。（对于 ULONG 和 UINT32 也是如此。）也许这些会更清楚一点？

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-21T16:01:15.373

Microsoft 还为与指针大小相同的整数定义了 UINT_PTR 和 INT_PTR。

这是[Microsoft 特定类型的列表](http://msdn.microsoft.com/en-us/library/ff564619.aspx)- 它是其驱动程序参考的一部分，但我相信它也适用于一般编程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-21T15:01:22.997

为您的编译器/平台了解它的最简单方法：

```
#include <iostream>

int main() {
  std::cout << sizeof(long)*8 << std::endl;
} 
```

乘以 8 是从字节中获取位。

当您需要特定大小时，通常最容易使用一种预定义类型的库。如果不希望这样做，您可以执行 autoconf 软件经常发生的事情，并让配置系统确定所需大小的正确类型。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-01-22T04:58:47.387

Windows 平台上的位大小`long`为 32 位（4 字节）。

您可以使用[`sizeof(long)`](https://godbolt.org/z/vCicB4).

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2008-12-21T14:13:19.317

如果您需要使用特定长度的整数，您可能应该使用一些独立于平台的标头来帮助您。Boost 是一个值得关注的好地方。

# c# - 枚举器实现：使用结构还是类？

> ID：384511
> 
> 赞同：13
> 
> 时间：2008-12-21T14:23:03.557
> 
> 标签：c#, .net, enumeration

我注意到`List<T>`将其枚举器定义为 a `struct`，而`ArrayList`将其枚举器定义为 a `class`。有什么不同？如果我要为我的班级编写一个枚举器，哪个更可取？

**编辑：**使用无法满足我的要求`yield`，因此我正在实现自己的枚举器。也就是说，我想知道是否最好按照`List<T>`struct 的方式实现它。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-21T14:34:42.347

在 C# 中编写枚举器的最简单方法是使用“yield return”模式。例如。

```
public IEnumerator<int> Example() {
  yield return 1;
  yield return 2;
} 
```

此模式将在后台生成所有枚举器代码。这使您无法做出决定。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-21T14:40:38.653

像其他人一样，我会选择一个班级。可变结构很讨厌。（正如 Jared 所建议的，我会使用一个迭代器块。手工编码一个枚举器是很巧妙的。）

有关列表枚举器是导致问题的可变结构的示例，请参[见此线程...](http://web.archive.org/web/20160711111502/http://aspnet-answers.com/microsoft/Csharp/31702392/c-compiler-challenge--see-if-you-can-answer-why.aspx)

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-11-08T16:02:35.250

原因列表使用结构枚举器是为了防止在 foreach 语句中产生垃圾。这是一个很好的理由，特别是如果您正在为 Compact Framework 编程，因为 CF 没有分代 GC，并且 CF 通常用于低性能硬件，它会很快导致性能问题。

另外，我不认为可变结构是一些发布的示例中问题的根源，但是程序员对值类型的工作方式没有很好的理解。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-21T14:25:40.353

使用`yield return`.

至于为什么您可能会在`class`or之间进行选择`struct`，如果您将其设置为 a ，`struct`那么它会在作为接口返回后立即被装箱，因此将其设置为 a`struct`会导致额外的复制发生。看不出这有什么意义！

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-12-21T14:33:01.510

枚举器本质上是一个不断变化的结构，因为它需要更新内部状态才能移动到原始集合中的下一个值。

在我看来，结构应该是不可变的，所以我会使用一个类。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-03-03T16:20:19.583

的任何实现都`IEnumerable<T>`应该返回一个类。出于性能原因，拥有一个返回结构体的方法可能很有用，`GetEnumerator`该结构体提供枚举所需的方法但不实现`IEnumerator<T>`；此方法应不同于`IEnumerable<T>.GetEnumerator`，然后应显式实施。

当使用 C# 或 vb.net 中的 foreach 或“For Each”循环或任何执行枚举的代码将知道枚举数是结构的上下文中枚举类时，使用此方法将提高性能，但避免当枚举器被装箱并按值传递时会发生的陷阱。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-21T14:44:11.270

要扩展@Earwicker：您通常最好*不要*编写枚举器类型，而是使用`yield return`让编译器为您编写它。这是因为如果你自己做，你可能会错过许多重要的细节。

有关如何使用它的更多详细信息，请参阅 SO 问题“ [C# 中使用的 yield 关键字是什么？ ”。](https://stackoverflow.com/questions/39476/what-is-the-yield-keyword-used-for-in-c)

此外， [Raymond Chen](https://web.archive.org/web/20100522223058/http://blogs.msdn.com:80/OldNewThing/)有一系列博客文章（“ C#[中](https://devblogs.microsoft.com/oldnewthing/2008/08/15 "The implementation of iterators in C# and its consequences (Part 4/4)")[迭代​​器的实现及其后果](https://devblogs.microsoft.com/oldnewthing/2008/08/12 "C# 中迭代​​器的实现及其后果（第 1/4 部分）")”：第 1、2、3 和 4 部分）[向](https://devblogs.microsoft.com/oldnewthing/2008/08/13 "The implementation of iterators in C# and its consequences (Part 2/4)")[您](https://devblogs.microsoft.com/oldnewthing/2008/08/12 "C# 中迭代​​器的实现及其后果（第 1/4 部分）")展示[了](https://devblogs.microsoft.com/oldnewthing/2008/08/14 "The implementation of iterators in C# and its consequences (Part 3/4)")如何在没有 的情况下正确实现迭代器，这表明它是多么复杂，以及为什么你应该只使用.`yield return``yield return`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-05-20T10:46:36.103

有几篇[博客](http://www.simple-talk.com/community/blogs/simonc/archive/2010/05/19/91401.aspx) [文章](http://www.simple-talk.com/community/blogs/simonc/archive/2010/05/20/91415.aspx)正好涵盖了这个问题。基本上，枚举器结构是一个非常糟糕的主意......

# c# - 视图和演示者目录结构。

> ID：384523
> 
> 赞同：0
> 
> 时间：2008-12-21T14:35:13.160
> 
> 标签：c#, winforms, model-view-controller

对于一个 winforms 应用程序，您认为视图和演示者以及您的模型的理想目录结构是什么

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T12:05:50.307

命名空间 XXX.Core 或 XXX.BusinessObjects
-> 模型

命名空间 XXX.Views
-> 视图

命名空间 XXX.Controllers
-> 控制器

# asp.net - 还有哪些与 StackOverflow 一样出色的 ASP.NET Web 应用程序？

> ID：384547
> 
> 赞同：2
> 
> 时间：2008-12-21T15:03:38.827
> 
> 标签：asp.net, asp.net-mvc

据我了解，StackOverflow (SO) 是使用 ASP.NET 构建的。令我惊讶的是，它设计得如此之好，实施得如此之好。在不了解 SO 内部的情况下，以下是我的观察和有根据的猜测：

1.  SO 似乎具有高度可扩展性。
2.  SO 中的 URL 很友好。
3.  看起来 SO 不像我见过的大多数 ASP.NET 应用程序那样包含一堆控件。
4.  明智而有效地使用 Ajax 请求、不透明动画等。查看源代码告诉我 SO 正在使用 jQuery。
5.  SO 可以在所有主流浏览器上运行（我用过，这个列表包括 IE、FF、Chrome、Opera）。

编辑： 6.彗星般的功能：当您输入答案时，如果发布了任何其他答案，您会收到通知。如果您选择加载它，当然只完成部分页面刷新并且您的答案保持不变。尚未在任何其他 ASP.NET 应用程序中看到这一点。

所以我的问题：

*   还有哪些与 StackOverflow 一样出色的 ASP.NET Web 应用程序，您喜欢它们的哪些功能？
*   你能分享一些关于 SO 的更多细节，例如 SO 是使用 ASP.NET MVC 还是其他东西构建的？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-21T15:09:25.350

[正如 Jeff Atwood 和他的团队在 Scott Hanselman 组织的播客中](http://www.hanselminutes.com/default.aspx?showID=152)所解释的那样，SO 是使用 ASP.NET MVC 构建的

听播客是值得的。

播客中揭示的关于 SO 的一个令人惊讶的元素是**SO 在单个服务器（IIS 和 SQL Server）上运行**。我对此感到惊讶。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-21T15:59:29.230

ASP.NET Forms 允许开发人员以与 .NET Windows Forms 大致相同的方式构建 UI。

整个想法是，知道如何构建“胖客户端”Windows 窗体的开发人员可以将这些技能转移到 ASP.NET 窗体中。ASP.NET 表单甚至允许开发人员几乎将代码放在同一组控制事件上。开发人员不必具备任何 HTML、HTTP、Javascript 等知识。

不幸的是，这导致频繁生成包含怪物视图状态的大型 POST，从而导致用户体验不佳。这就是给 ASP.NET 一个坏名声的原因。实际上，它的原始 ASP.NET**表单**应该有不好的代表。

ASP.NET MVC，除其他外，拥抱 HTTP 的本质，而不是试图隐藏它。AJAX 和 JQuery 也是 MVC 的特性，它们使整体结果更好。

也就是说，如果没有出色的远见、设计和技能，拥有出色的工具是无用的，SO 团队显然拥有丰富的这些。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T15:06:25.327

SO 是使用 ASP.NET MVC 构建的。Jeff 聘请了优秀的开发人员，拥有良好的愿景，并通过一位真正的设计师来运行他的屏幕。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-21T15:33:42.243

Orkut.com - 谷歌的社交网站使用 ASP.NET

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-21T15:11:25.457

Myspace.com 使用 ASP.net，这从总体上证明了平台的可扩展性。您还可以通过阅读[stackoverflow 博客](http://blog.stackoverflow.com)和收听 stackoverflow 播客来了解有关 stackoverflow 本身的很多信息。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-21T15:31:36.697

您指出的许多事情实际上是由于使用了 ASP.NET MVC。漂亮的 URL 开箱即用，非标准控件，MVC 没有开箱即用的东西，所以你必须重新发明一切:)，最后，如果你想做的话，AJAX 几乎是 ASP.NET MVC 的要求任何聪明的东西。

单独的 ASP.NET MVC 并不能说明 StackOverflow 真正成功的原因，这完全取决于想法、执行以及 Jeff 和 Joel 组合在网络上获得大量追随者这一事实。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T21:49:53.920

您还可以在 SO 上的两个 HanselMinutes 播客中了解很多关于开发、规划（！）等的知识：

*   [StackOverflow 使用 ASP.NET MVC - Jeff Atwood 和他的技术团队](http://www.hanselminutes.com/default.aspx?showID=152)
*   [幕后花絮 - StackOverflow 和 Jeff Atwood - 第 2 部分](http://www.hanselminutes.com/default.aspx?showID=153)

提供多种音频格式，以及转录。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-21T21:53:55.830

ASP.NET 创建的网站仅受开发人员才能的限制。

几乎任何框架都可以这样说。

也就是说，Windows Server/IIS/.NET 是一个高度可扩展的概念，因为我们在 ASP.NET 站点上提供的流量远远超过 SO（再说一次，我们有 32 台服务器）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-20T23:00:40.567

正如此处的答案之一所述，myspace.com 使用 ASP.NET（据我所知，它是用 ColdFusion 编写的，并使用 BlueDragon for .NET）。

另一个网站是很多网站（每天 6000 万次点击）。

如果您想了解更多关于可扩展性的信息，请参阅[http://highscalability.com](http://highscalability.com)

# .net - 用于非游戏相关 3D 图形编程的托管 Direct3D 或 XNA？

> ID：384561
> 
> 赞同：4
> 
> 时间：2008-12-21T15:15:00.177
> 
> 标签：.net, graphics, xna, direct3d, 3d

哪种是进行 .NET 3D 图形编程的首选方法： Direct3D 或 XNA 似乎是当前技术，但哪种技术最适合非游戏相关的编程？

此外，Managed Direct 3D 是否已停产？XNA 似乎并不适合非游戏开发。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T17:54:27.907

是的，太糟糕了，MS 停止了 MDX。我目前正在使用[SlimDX](http://slimdx.mdxinfo.com/)进行非游戏开发。它不是 MDX 的直接替代品，但至少 API 设计与 MDX v1.1 的 API 相比非常直观。我已将 MDX v1.1 + .Net v1.1 用于我们产品的版本 1。至于版本 2，我们正在迁移到 .Net 2.0。MDX v1.1 不适用于 .Net 2.0，而且它还有很多其他固有问题。因此，我们不得不寻找替代方案。

最初 XNA 是我们的最佳选择。然后，因为它针对游戏市场和与 xbox 360 的兼容性，我们发现我们需要编写大量的变通方法/hack 以使其适合我们。更糟糕的是与我们在产品中广泛使用的 DirectShow 的互操作性。MS在现有技术和新技术之间造成了巨大的差距，MDX和DirectShow的最新替代品目前还不足以替代旧的，我们等不起下一个版本。

我不会说 SlimDX 是非游戏开发的最佳选择。但就我而言，确实如此。而且由于它是开源的，我们总是可以对我们认为合适的地方进行更改。当我们使用 SlimxDX + DirectShow.Net 时，存在相当大的故障。当我们使用 MDX 1.1 + DirectShow.Net 时，这些故障不存在。我的猜测是，在内部，MS 进行了相当多的修改以使其正常工作。

无论如何，如果您根本不使用 DirectShow，请考虑[Ogre3D/MOgre3D](http://www.ogre3d.org/)。MOgre3D 是 Ogre3D 的管理包装器，Ogre3D 是一个构建良好的 3D 引擎。这是我们的首选，但我们不能使用它，因为它不能很好地支持 DirectShow。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-24T06:15:59.483

托管 DirectX 并没有被完全抛弃，而是被重写为 XNA。诚然，XNA 的设计考虑了 Xbox 360，但 XNA 与我使用的任何其他 3D 框架一样适用于非游戏 3D 编程。不要忽视 XNA 极其方便的内容导入管道……您可以将模型和着色器放到卡上并轻松渲染。

如上所述，Creators Club 社区非常丰富，您可能会对他们的[Winforms 教程感兴趣。](http://creators.xna.com/en-us/sample/winforms_series1)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T15:18:04.727

如果它与游戏无关，那是什么？如果你回答这个问题，我们可能会给你一个很好的答案，无论如何，取决于应用程序 WPF 可能是一个很好的答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-09T02:41:19.470

这里的简单答案可能是 XNA。也许是 WPF。这取决于。

如果您正在寻找任何类似于远程游戏的东西，XNA 是一个非常好的解决方案，因为它为您提供了一个框架，可以很好地与几乎任何 3d 交互世界的实现相结合。除了处理所有 3d 视觉内容之外，您还可以轻松获得碰撞检测、照明、计时和相机等内容。如果您正在处理的是某种 3d 虚拟空间，那么您所拥有的可能非常接近于游戏，而 XNA 将为您提供除了图形端之外的更多功能。

否则，如果您正在寻找 3d UI 或数据可视化，WPF 可能更符合您的需求。不必要的开销减少了，并且您获得的其他内容（例如命令或数据绑定）无论如何可能对您更有用。据我了解，它将在后端使用硬件加速，并在必要时通过软件处理材质着色器和各种 3d 效果，以便用户获得视觉一致的体验。

如果你有一个不太适合这两​​个阵营的例子，我真的很想听听。对于想要编写有用的图形库的人来说可能是一个很好的机会......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T15:17:24.073

我无论如何都不是专家，但是当我把两者都搞砸时，我发现 XNA 好多了。我只是玩弄我的 Zune 和 PC 游戏。我没有足够的时间来处理 DirectX，我找到了更多关于 XNA 的示例。

你也有一个完整的[社区](http://creators.xna.com)来帮助你。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T07:48:21.403

Xna 是微软的托管 DirectX。不幸的是，他们没有写太多关于将它用于非游戏相关的事情，但它可以做到。

不幸的是，我现在在网上找不到任何好的资源来展示如何做到这一点。

# c# - 确定将代码分解为不同文件夹和命名空间的最佳方式

> ID：384562
> 
> 赞同：1
> 
> 时间：2008-12-21T15:15:02.033
> 
> 标签：c#, directory-structure

我有以下目录：

-UI -BusinessLogic
-DataAccess
-BusinessObjects

如果我有一个类，它是服务器端服务的客户端存根，它改变服务器系统上的状态，那会去哪里。.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T18:46:06.117

此代码属于回收站;-)

说真的，如果你写了它但不知道它的去向，那么要么代码有问题，要么你的分区有问题；我们应该如何获得比您更多的关于您系统的信息？

现在，如果您只想要一些不知情的意见，我们已经得到了 PB：

1.  它进入 UI 是因为您说它是客户端存根
2.  它进入业务逻辑，因为它实现了业务规则的效果
3.  它进入数据访问层，因为它正在访问状态更改服务
4.  它进入业务对象层，因为它会导致服务器上的状态更改

如果您告诉我们存根的实际作用会更有帮助；没有细节很难知道它属于哪里，和/或很容易在真空中争论它“应该”属于哪里

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T15:21:33.127

我认为这是一种数据访问形式，尽管我不清楚您是否需要将它与其他数据访问类放在同一个项目中。请记住，这些层主要是概念性的——帮助您保持设计简洁。将它们分成不同的项目有助于组织，但不是强制性的。如果它是一个实际的存根类，那么数据访问项目可能是它的自然归宿，但如果它只用于 UI 层，那么保留它可能就可以了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T15:53:13.017

我不认为它属于任何一个。您要么需要一个新目录，要么完全需要一个新项目。但是在给出的那些中，我不得不说 BusinessObjects 因为它肯定不会根据您的描述*访问*数据，而只是像本地对象（存根）一样行事。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T15:23:08.710

在 Web 服务存储库中。

# windows - 如何使用 WMI 获取卷 GUID？

> ID：384569
> 
> 赞同：1
> 
> 时间：2008-12-21T15:20:42.427
> 
> 标签：windows, wmi, usb

有没有办法检索以下类型的路径：

\\?\卷{GUID}\

用于 USB 驱动器 使用 WMI？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T20:52:41.820

在 Windows 2003 及更高版本（不是 XP！）中，您可以使用：[Win32_Volume Class](http://msdn.microsoft.com/en-us/library/aa394515(VS.85).aspx)。

我认为没有办法在 xp 及以下版本中使用 wmi 检索 guid。不能确定。

albert 指的是[GetVolumeNameForVolumeMountPoint](http://support.microsoft.com/kb/959573)调用。链接中有一个示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-20T08:29:41.320

您可以从系统注册表中获取此信息。使用 StdRegProv 提供程序通过 WMI 读取系统注册表（本地和远程）是可能的。

# mysql - 笔记本电脑（本地主机）中的 MySQL 速度较慢，生产机器（台式机）中的 MySQL 速度较快

> ID：384573
> 
> 赞同：2
> 
> 时间：2008-12-21T15:25:51.903
> 
> 标签：mysql

当我使用 MySQL Administrator 连接到笔记本电脑（开发机器）中的 MySQL 服务器时，速度太慢是什么原因，但是当我连接到生产机器中的 MySQL 服务器时，速度却更快。日志上的设置是否有明显的性能下降？以前我的笔记本电脑连接速度很慢，我没有遇到任何问题。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-21T15:32:53.743

*   许多公司在笔记本电脑上设置了额外的 AV/防火墙保护，而在台式机上则没有。这可能会让你慢下来。
*   硬盘加密经常出现在公司笔记本电脑上，这会减慢速度
*   您的笔记本电脑的内存可能比台式机少
*   您的笔记本电脑的内存可能比台式机慢
*   您的笔记本电脑的 CPU 可能比台式机慢
*   您的笔记本电脑的硬盘空间可能比台式机少
*   您的笔记本电脑的硬盘驱动器可能比笔记本电脑慢
*   您的笔记本电脑的硬盘驱动器可能严重碎片化
*   您的笔记本电脑上运行的程序可能多于台式机

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-06T15:12:38.187

你在用火狐吗？您可能想尝试编辑`network.dns.disableIPv6`设置。

`about:config`在地址栏中键入并过滤`network.dns.disableIPv6`并双击以设置为 true。

# exception - 如何在 Tomcat 上拦截未捕获的异常？

> ID：384574
> 
> 赞同：6
> 
> 时间：2008-12-21T15:26:10.433
> 
> 标签：exception, tomcat, log4j

我试图找出一种干净的方法来拦截我的应用程序中发生的未捕获异常。

我已将 log4j 配置为记录正常的应用程序流并捕获异常，因此已得到处理。现在，我有一个类，它接收所有错误级别的消息并将它们添加到队列中，以便分批发送电子邮件。

理想情况下，我希望有一种方法可以拦截未捕获的异常，以便我可以将它们传递到同一个“电子邮件批处理”队列，但如果这不可行，我当然愿意接受建议。

我熟悉 JBoss 上的 LogInterceptors，但这个项目使用的是 Tomcat。有什么办法可以解决这个问题吗？Tomcat 是否有 LogInterceptor 等价物？我应该尝试将 Tomcat 日志重定向到自定义附加程序吗？（如果是这样 - 任何提示？）其他一些想法？

我认为现在这*必须*是一个已解决的问题，所以我希望挖掘一些集体智慧。谢谢大家，提前。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-21T15:45:17.247

根据 J2EE 1.4 规范，servlet 中未捕获的异常可能会被转发到部署描述符中定义的错误页面。发生这种情况时，页面实现将接收原始请求和响应对象，并添加一个名为 javax.servlet.error.exception 的请求属性，其中包含异常对象。

也就是说，我实际上并没有使用 Tomcat 完成此操作，并且我处理过的大多数 Web 应用程序都转发到 Web 服务器级别的通用错误页面。

编辑：刚刚在我的本地服务器上尝试过，将以下内容添加到我的 web.xml 之后，它就像宣传的那样工作：

```
<error-page>
    <exception-type>java.lang.Exception</exception-type>
    <location>/dumpRequest.jsp</location>
</error-page> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T15:51:43.817

它不是 Tomcat 特定的，但您可以[在每个线程的基础上设置未捕获的异常处理程序](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Thread.html#setUncaughtExceptionHandler(java.lang.Thread.UncaughtExceptionHandler))。

根据应用程序的设置，您可以将其设置在处理请求的方法的顶部。您可能必须每次都这样做，因为您可能会在每个请求中获得一个线程。

设置它的好地方是某种前端控制器。

# php - 如何无缝混合 ASP.NET 和 PHP Web 应用程序

> ID：384575
> 
> 赞同：0
> 
> 时间：2008-12-21T15:28:06.267
> 
> 标签：php, asp.net, single-sign-on

我有两个网站，一个由 ASP.NET 驱动，另一个由 PHP 驱动。PHP 站点托管在一个相对便宜的主机提供商上（“每月 10 美元的无限带宽和磁盘空间）。PHP 站点还提供 REST URL，这将帮助我通过我的网站获利。

另一个站点（可以说是“主”站点）是一个包含登录机制的 ASP.NET 网站。我的目标是允许用户登录到 ASP.NET 站点，然后重定向到基于 PHP 的域。是否有一个简单可行的解决方案可以做到这一点？

关于这种方法，我有几个问题：

我如何将会话信息和变量从 ASP.NET 应用程序传递到基于 PHP 的应用程序，以促进“单点登录”的光环？

一个“简单”的 cookie 是否能够处理这种情况？还是我需要使用加密的查询字符串？

这些网站上没有“敏感”数据，因此保护用户数据不是首要任务。该网站是“为了好玩”而建造的。

是否有主机允许子域托管在与主域不同的语言平台上？如果我将 www.example.com 托管在 ASP.NET 服务器上，我是否可以将子域 (forum.example.com) 托管在 PHP 服务器上？这可能吗？

非常感谢您对此的任何帮助。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T15:47:46.163

虽然更复杂，但我会采用与 OpenID 规范相同的方法并使用 Diffie-Hellman 交换。这允许没有事先信任的两方在一段时间内建立信任。

[PHP 的信息](http://www.devx.com/webdev/Article/37821/0/page/5)

[VB.NET 的信息](http://www.example-code.com/vbdotnet/dh_key_exchange.asp)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-21T15:37:08.260

如果两个站点都在同一个域上，我会选择 cookie。cookie 优于加密字符串的一个优点是它们会在请求之间自动传递，并且您在构建 url 时不必考虑它们。cookie 的一个缺点是它们可以被用户禁用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T16:51:29.077

将会话存储在数据库中并创建/使用跨平台的会话类型。你可能会自己做。但是您应该知道，像这样在不同语言之间传递会话等可能很危险（安全方面）

# c# - 从数据集中更新数据库的奇怪问题

> ID：384583
> 
> 赞同：1
> 
> 时间：2008-12-21T15:45:02.190
> 
> 标签：c#, sql, database

**操作：**

从数据集中删除 DataGridView 选定的行：

```
FuDataSet.FuRow row = (FuDataSet.FuRow) ((DataRowView)FuBindingSource.Current).Row;
row.Delete(); 
```

要添加我正在做的新行：

```
FuDataSet.FuRow row = FuDataSet.Fus.NewFuRow();
row.Someting = "Some initial Content";
row.SomethingElse = "More Initial Content";
...
FuDataSet.Fus.AddFuRow(row); 
```

在数据集中的当前行中保存用户更改：

```
FuDataSet.FuRow row = (FuDataSet.FuRow) (((DataRowView) FuBindingSource.Current).Row);
row.Someting = someTextBox.text;
... 
```

保存在数据库中：

```
Validate();
FuBindingSource.EndEdit();
FuTableAdapter.Update(FuDataSet.Fus); <-- Exception here 
```

我使用的是标准的DatagridView、Dataset、TableAdapter、BindingSource Scheme VS在定义数据库结构后自动放上去。只涉及一个表，并使用 SQL Server compact 3.5。

现在我的问题是每次执行此操作时都会出现并发异常（DeletedRowInaccessibleException）（从空数据库开始）：创建新行，删除此行，保存在数据库中，新行，保存在数据库中，删除这个行，保存在数据库中 <- 异常

我认为数据库和数据集之间存在一些同步问题。

如果我在每次通过 FuTableAdapter.Fill(FuDataSet.Fus) 保存后重新加载数据库，问题就消失了。然而，这不可能是我认为的意图。

我希望有人可以帮助我并发现设计中的失败或向我解释可能出了什么问题。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T21:54:54.083

您的表是否有一个自动增量标识列作为主键？如果是这样，它可能不会在插入后使用新值更新数据集表，因此当您删除它时，它无法在数据库中找到该行。这可以解释为什么调用 Fill() 方法后它会起作用。

您将需要以某种方式返回插入时的主键，以便数据集表与数据库保持同步。如果您使用存储过程进行插入，则可以使用 out 参数返回主键。如果您在命令中使用 SQL 插入语句，不确定最好的方法是什么，但是您必须从数据库表中取回主键并将其分配给数据库表行。

不确定您是否在保存后执行此操作，但调用 FuDataSet.AcceptChanges() 将帮助数据集在数据库更新后跟踪新更改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T21:22:15.973

您在那里列出的内容是正确的。在数据集表中创建新行时，它会创建自己的 ID。当您保存到数据库时，数据库表也会创建自己的 ID，在大多数情况下，该 ID 与数据集中的 ID 不同。

当您为该表创建表适配器时，您必须提供一个 sql 状态来创建数据集表。在高级选项按钮上，有一个名为“刷新数据表”的复选框。检查是否在插入和更新后添加了一条 sql 语句以检索标识列。

如果复选框被禁用，那么我不确定您还能做什么，除了在每次保存后重新加载数据，这不是最佳选择。

抱歉，我无法提供更多帮助。祝你好运

# c++ - C++ 我坚持用正确的值填充这个 BST

> ID：384587
> 
> 赞同：-2
> 
> 时间：2008-12-21T15:48:56.223
> 
> 标签：c++, token

我创建了一个充满 WordInfo 对象的 BST，这些对象有一个向量来指出其他 WordInfo 对象中的哪个是同义词或反义词。每个单词都由其源文件 dictionary.txt 中的一个整数标识。到目前为止，BST 已经收到了它的单词列表，但我在填写同义词时遇到了麻烦。坦率地说，我很困惑如何让我的对象按照我想要的方式进行交互。

这是我认为问题的核心：

```
 //--function for getting synonyms in a vector
    void pushSynonyms(string synline, BST <WordInfo> wordTree)
      {
           int lineSize = synline.size();

             const char *aux;

             aux=synline.data();

             int index=0;

             int searchedOne= aux[0]; 
             //wanting to find an element in the tree with this ID

             //lacking:  search function

             while (index<=lineSize){
             mySynonyms.push_back (aux[index]); 

             index++;
             }    

      }

#include <iostream>
#include <fstream>
#include <string>

#include <sstream>
#include <stdlib.h>
#include <vector>

#include "MiBST.h"

using namespace std;

class WordInfo {

      public: 

      WordInfo() {
          // nothing to define?       
                 }

      ~WordInfo() {
           //nothing to define?       
                 }

      //--id accesor
      int id () const {return myId;}

      //--input function for filling Words
      void readWords (istream &in)
      {
         in>>myId>>word;     
      }

      //--function for getting synonyms in a vector
    void pushSynonyms(string synline, BST <WordInfo> wordTree)
      {
           int lineSize = synline.size();

             const char *aux;

             aux=synline.data();

             int index=0;

             int searchedOne= aux[0];

             //lacking: define search function

             while (index<=lineSize){
             mySynonyms.push_back (aux[index]); 

             index++;
             }    

      }

      //--function for getting antonyms in a vector
      void pushAntonyms(string synline, BST <WordInfo> wordTree )
      {
           int lineSize = synline.size();

             const char *aux;

             aux=synline.data();

             int index=0;

             // now I need fo find the right words to pair up

             while (index<=lineSize){
             myAntonyms.push_back (aux[index]); 

             index++;
             }    

      }

      //--output function
      void printWords (ostream &out)
      {
         out<<myId<<" "<<word;     
      }

      //--equals operator
      bool operator == (const WordInfo &otherWordInfo) const
      { return myId == otherWordInfo.myId;}

      //--equals operator for String
      bool operator == (const string & aString) const
      {return word ==aString;}

      //--less than operator
      bool operator < (const WordInfo & otherWordInfo)const
      {return myId<otherWordInfo.myId;}

      //--more than operator
      bool operator > (const WordInfo &otherWordInfo) const
      { return myId > otherWordInfo.myId;}

      private:
              vector<int> mySynonyms;
              vector <int> myAntonyms;
              string word;
              int myId;

      };

      //--- Definition of input operator
      istream & operator>>(istream & in, WordInfo & word)
      {

           word.readWords(in);

           //I want to call word.readSyns(in) too, how?
      }

      //---Definition of output operator

      ostream & operator <<(ostream &out, WordInfo &word)
      {
            word.printWords(out);       
      }

      int main() {

          //search each word by id and 
          // define its synonyms

          string wordFile;

          cout<< "enter name of dictionary file: ";
          getline (cin,wordFile);

          ifstream inStream(wordFile.data());

          if(!inStream.is_open())
          {
           cerr<<"cannot open "<<wordFile<<"\n";
           exit(1);                       
          }

          //build the bst of word records
          BST <WordInfo> wordTree; //BST of word records

          WordInfo aword; // a word record

          //--loop that fills tree with words
          while((inStream>> aword && (!(aword=="synonyms"))))
          {
             wordTree.insert(aword);                  
          }

          string line;

          //--loop that takes synonyms
          while((inStream>>line)&& (line!="antonyms")){

                 aword.pushSynonyms(line, wordTree);                    
          }

          //--loop that takes antonyms           
           while(inStream >> line) {

               if (inStream.eof())break; 
           }

           wordTree.graph(cout);

          system("PAUSE");

          return 0;
          } 
```

头文件：

```
#include <iostream>
#include <iomanip>

#ifndef BINARY_SEARCH_TREE
#define BINARY_SEARCH_TREE

template <typename DataType>
class BST
{
 public:
  /***** Function Members *****/
  BST();

  bool empty() const;

  bool search(const DataType & item) const;

  void insert(const DataType & item);

  void remove(const DataType & item);

  void inorder(std::ostream & out) const;

  void graph(std::ostream & out) const;

  private:
  /***** Node class *****/
  class BinNode 
  {
   public:
    DataType data;
    BinNode * left;
    BinNode * right;

    // BinNode constructors
    // Default -- data part is default DataType value; both links are null.
    BinNode()
    : left(0), right(0)
    {}

    // Explicit Value -- data part contains item; both links are null.
    BinNode(DataType item)
    : data(item), left(0), right(0)
    {}

}; //end inner class

typedef BinNode * BinNodePointer; 

  /***** Private Function Members *****/
  void search2(const DataType & item, bool & found,
               BinNodePointer & locptr, BinNodePointer & parent) const;
 /*------------------------------------------------------------------------
   Locate a node containing item and its parent.

   Precondition:  None.
   Postcondition: locptr points to node containing item or is null if 
       not found, and parent points to its parent.#include <iostream>
 ------------------------------------------------------------------------*/

  void inorderAux(std::ostream & out, 
                  BST<DataType>::BinNodePointer subtreePtr) const;
  /*------------------------------------------------------------------------
    Inorder traversal auxiliary function.

    Precondition:  ostream out is open; subtreePtr points to a subtree 
        of this BST.
    Postcondition: Subtree with root pointed to by subtreePtr has been
        output to out.
 ------------------------------------------------------------------------*/

  void graphAux(std::ostream & out, int indent,
                      BST<DataType>::BinNodePointer subtreeRoot) const;
  /*------------------------------------------------------------------------
    Graph auxiliary function.

    Precondition:  ostream out is open; subtreePtr points to a subtree 
        of this BST.
    Postcondition: Graphical representation of subtree with root pointed 
        to by subtreePtr has been output to out, indented indent spaces.
 ------------------------------------------------------------------------*/

 /***** Data Members *****/
  BinNodePointer myRoot; 

}; // end of class template declaration

//--- Definition of constructor
template <typename DataType>
inline BST<DataType>::BST()
: myRoot(0)
{}

//--- Definition of empty()
template <typename DataType>
inline bool BST<DataType>::empty() const
{ return myRoot == 0; }

//--- Definition of search()
template <typename DataType>
bool BST<DataType>::search(const DataType & item) const
{
   typename BST<DataType>::BinNodePointer locptr = myRoot;

   typename BST<DataType>::BinNodePointer parent =0;

/*   BST<DataType>::BinNodePointer locptr = myRoot;
   parent = 0; */ //falta el typename en la declaracion original

   bool found = false;
   while (!found && locptr != 0)
   {
      if (item < locptr->data)       // descend left
        locptr = locptr->left;
      else if (locptr->data < item)  // descend right
        locptr = locptr->right;
      else                           // item found
        found = true;
   }
   return found;
}

//--- Definition of insert()
template <typename DataType>
inline void BST<DataType>::insert(const DataType & item)
{
   typename BST<DataType>::BinNodePointer 
        locptr = myRoot,   // search pointer
        parent = 0;        // pointer to parent of current node
   bool found = false;     // indicates if item already in BST
   while (!found && locptr != 0)
   {
      parent = locptr;
      if (item < locptr->data)       // descend left
         locptr = locptr->left;
      else if (locptr->data < item)  // descend right
         locptr = locptr->right;
      else                           // item found
         found = true;
   }
   if (!found)
   {                                 // construct node containing item

      locptr = new typename BST<DataType>::BinNode(item);  
      if (parent == 0)               // empty tree
         myRoot = locptr;
      else if (item < parent->data )  // insert to left of parent
         parent->left = locptr;
      else                           // insert to right of parent
         parent->right = locptr;
   }
   else
      std::cout << "Item already in the tree\n";
}

//--- Definition of remove()
template <typename DataType>
void BST<DataType>::remove(const DataType & item)
{
   bool found;                      // signals if item is found
   typename BST<DataType>::BinNodePointer 
      x,                            // points to node to be deleted
      parent;                       //    "    " parent of x and xSucc
   search2(item, found, x, parent);

   if (!found)
   {
      std::cout << "Item not in the BST\n";
      return;
   }
   //else
   if (x->left != 0 && x->right != 0)
   {                                // node has 2 children
      // Find x's inorder successor and its parent
      typename BST<DataType>::BinNodePointer xSucc = x->right;
      parent = x;
      while (xSucc->left != 0)       // descend left
      {
         parent = xSucc;
         xSucc = xSucc->left;
      }

     // Move contents of xSucc to x and change x 
     // to point to successor, which will be removed.
     x->data = xSucc->data;
     x = xSucc;
   } // end if node has 2 children

   // Now proceed with case where node has 0 or 2 child
   typename BST<DataType>::BinNodePointer 
      subtree = x->left;             // pointer to a subtree of x
   if (subtree == 0)
      subtree = x->right;
   if (parent == 0)                  // root being removed
      myRoot = subtree;
   else if (parent->left == x)       // left child of parent
      parent->left = subtree; 
   else                              // right child of parent
      parent->right = subtree;
   delete x;
}

//--- Definition of inorder()
template <typename DataType>
inline void BST<DataType>::inorder(std::ostream & out) const
{ 
   inorderAux(out, myRoot); 
}

//--- Definition of graph()
template <typename DataType>
inline void BST<DataType>::graph(std::ostream & out) const
{ graphAux(out, 0, myRoot); }

//--- Definition of search2()
template <typename DataType>
void BST<DataType>::search2(const DataType & item, bool & found,
                            BST<DataType>::BinNodePointer & locptr, 
                            BST<DataType>::BinNodePointer & parent) const
{
   locptr = myRoot;
   parent = 0;
   found = false;
   while (!found && locptr != 0)
   {
      if (item < locptr->data)       // descend left
      {
         parent = locptr;
         locptr = locptr->left;
      }
      else if (locptr->data < item)  // descend right
      {
         parent = locptr;
         locptr = locptr->right;
      }
      else                           // item found
         found = true;
   }
}
//--- Definition of inorderAux()
template <typename DataType>
void BST<DataType>::inorderAux(std::ostream & out, 
                               BST<DataType>::BinNodePointer subtreeRoot) const
{
   if (subtreeRoot != 0)
   {
      inorderAux(out, subtreeRoot->left);    // L operation
      out << subtreeRoot->data << "  ";      // V operation
      inorderAux(out, subtreeRoot->right);   // R operation
   }
}

//--- Definition of graphAux()

template <typename DataType>
void BST<DataType>::graphAux(std::ostream & out, int indent, 
                             BST<DataType>::BinNodePointer subtreeRoot) const
{
  if (subtreeRoot != 0)
    {
      graphAux(out, indent + 8, subtreeRoot->right);
      out << std::setw(indent) << " " << subtreeRoot->data << std::endl;
      graphAux(out, indent + 8, subtreeRoot->left);
    }
}

#endif 
```

字典.txt

```
1 cute
2 hello
3 ugly
4 easy
5 difficult
6 tired
7 beautiful
synonyms
1 7
7 1
antonyms
1 3
3 1 7
4 5
5 4
7 3 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T17:18:29.600

撇开其他人的评论不谈——我承认这个示例中的代码比我愿意看的要多——我认为你遇到的根本问题是你现有的搜索功能是按对象搜索的，而你需要一个按 id 搜索。创建一个以 id 作为参数的新搜索函数并遍历树，将当前 WordInfo 对象的 id 与传入的 id 进行比较。找到具有匹配 id 的对象时，返回它（而不是返回 true/false至于是否被发现）。如果找不到具有匹配 id 的对象，则返回 null。您需要一种将 id (int) 与 WordInfo 对象进行比较的方法。我的 C++ 有点生疏，所以语法可能有点不对劲。

```
//--- Definition of find()
template <typename DataType>
DataType& BST<DataType>::find(const int id ) const
{
   typename BST<DataType>::BinNodePointer locptr = myRoot;

   typename BST<DataType>::BinNodePointer parent =0;

   bool found = false;
   while (!found && locptr != 0)
   {
      if (locptr->data > id)       // descend left
        locptr = locptr->left;
      else if (locptr->data < id)  // descend right
        locptr = locptr->right;
      else                           // item found
        found = true;
   }
   return found ? locptr->data : null;
} 
```

注意：这需要您实现`operator>(const int id)`和`operator<(const int id)`.

# c# - 如何安全有效地缓存 ADO.NET 命令？

> ID：384592
> 
> 赞同：2
> 
> 时间：2008-12-21T15:52:07.230
> 
> 标签：c#, .net, asp.net, vb.net, ado.net

我想使用这种模式：

```
SqlCommand com = new SqlCommand(sql, con);
com.CommandType = CommandType.StoredProcedure;//um
com.CommandTimeout = 120;
//com.Connection = con;  //EDIT: per suggestions below

SqlParameter par;
par = new SqlParameter("@id", SqlDbType.Int);
par.Direction = ParameterDirection.Input;

com.Parameters.Add(par);

HttpContext.Current.Cache["mycommand"] = com; 
```

显然我不想遇到奇怪的问题，比如人 A 从缓存中检索它，更新 param1，人 2 从缓存中获取它并更新 param2，每个用户运行命令时混合了两者。

克隆从缓存中取出的命令可能比从头创建一个新命令更昂贵。

ASP.NET 缓存的线程安全性如何？我是否错过了任何其他潜在的陷阱？尽管存在线程问题，这种技术是否适用于无参数命令？

**澄清：**如果我想隐喻地朝自己的脚开枪，我该如何瞄准？有没有办法锁定对缓存中对象的访问以便序列化访问？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-21T16:10:32.687

很简单：不要。如果您看不出这是错误的，您需要在 ADO.NET 上阅读更多内容。有很多文献解释了正确的方法：只需在需要时创建连接和命令，并确保正确处理它们。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-21T16:04:05.367

缓存本身是线程安全的，但这并不赋予您放置在其中的对象线程安全性。SqlCommand 对象不是线程安全的，因此不是您想要缓存的那种东西。

在这种情况下，最重要的是缓存为您处理的连接，您不应该尝试自己处理。

与其执行相比，命令对象（即使是具有许多参数的对象）的创建仍然是小菜一碟。除非您有相反的证据，否则不要尝试缓存它们。

您项目的最大风险是过早优化。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T17:51:06.243

正如其他人所说，这只是一个坏主意。这是一个坏主意的原因有很多。

最重要的是，如果您处于高负载情况下，为每个用户存储命令将很快填满缓存，并且根据优先级等，将开始导致其他项目从缓存中掉出来，那应该真的还在那里。

使用 ADO.NET，您确实应该在使用命令和连接时创建、使用然后处理它们。性能方面，我从来没有改变过这个系统......而且我还没有真正听说过很多其他的系统。

此外，正如其他人在您的代码示例中提到的那样，实际执行所需的连接无论如何都会丢失。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T17:57:17.383

你为什么要缓存*命令*？创建命令的开销微乎其微——您只需新建几个对象并设置一些属性。我从来没有看到这是一个瓶颈..

您想要缓存命令的*结果*，因为实际*执行*命令是（相对）昂贵的。而且，一般来说，您希望将共享缓存视为只读，这样您就不必担心锁定和同步访问。缓存结果可以实现这一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-12T18:19:46.307

我应该问如何在 ASP.NET 缓存中锁定项目，而不是说出我打算放入缓存中的内容。

```
lock(Cache)
  {
    // do something with cache that otherwise wouldn't be threadsafe
  } 
```

参考： http: [//www.codeguru.com/csharp/.net/net_asp/article.php/c5363](http://www.codeguru.com/csharp/.net/net_asp/article.php/c5363)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-22T19:20:56.093

缓存您的结果，并且仅在 resultcache 为空时创建连接（和命令）：

伪代码：

```
result = getResultFromCache(CacheKey)
if (result == null)
{
     result = getResultFromDB();
     InsertIntoCache(result,cacheKey);
}

return result; 
```

# c# - “参数无效。” 使用保存位图时

> ID：384593
> 
> 赞同：3
> 
> 时间：2008-12-21T15:52:28.977
> 
> 标签：c#, exception, bitmap

我试图以指定的编码质量保存位图 jpg 格式。但是我在调​​用保存方法时遇到异常（“参数无效。”）。

如果我在 bmp.save 中省略了最后两个参数，它可以正常工作。

```
 EncoderParameters eps = new EncoderParameters(1);
        eps.Param[0] = new EncoderParameter(System.Drawing.Imaging.Encoder.Quality, 16);
        ImageCodecInfo ici = GetEncoderInfo("image/jpeg");
        string outfile = outputpath + "\\" + fileaddition + sourcefile.Name;
        bmp.Save(outfile,ici,eps );

        bmp.Dispose();
        image.Dispose();
        return true;
    }
    ImageCodecInfo GetEncoderInfo(string mimeType)
    {
        int j;
        ImageCodecInfo[] encoders;
        encoders = ImageCodecInfo.GetImageEncoders();
        for (j = 0; j < encoders.Length; ++j)
        {
            if (encoders[j].MimeType == mimeType)
                return encoders[j];
        }
        return null;
    }
} 
```

谢谢

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-12-21T16:10:53.230

GDI+ 非常不稳定。您需要使用 16L 作为值或转换为 (long)。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-08-23T08:29:43.463

您应该将质量值转换为 long，如下所示：

```
eps.Param[0] = new EncoderParameter(System.Drawing.Imaging.Encoder.Quality, (long)16); 
```

# c# - 组合框宽度取决于最长的项目

> ID：384596
> 
> 赞同：1
> 
> 时间：2008-12-21T15:55:19.223
> 
> 标签：c#, combobox

我有一个动态生成并填充一些项目的组合框。我想将此控件的宽度设置为最长项目的宽度。如何计算某些文本的显示宽度？

编辑：我正在使用 Windows 窗体，但我也想在 asp.net 中这样做

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T16:00:02.487

依靠。您使用的是 ASP.NET 还是 Windows 窗体或 WPF？您使用的是固定宽度还是比例字体？

如果您使用的是 Windows 窗体，您将需要调用[MeasureString()](http://www.java2s.com/Tutorial/VB/0300__2D-Graphics/Measurestringanddrawstring.htm)以了解您希望文本的宽度。

如果您使用的是 ASP.NET，则可以执行 MeasureString() 之类的操作，但您不知道浏览器上正在呈现什么字体，因此您不能只将其放入脚本中。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T16:00:17.853

请参阅**Graphics.MeasureString**方法。 [http://msdn.microsoft.com/en-us/library/9bt8ty58.aspx](http://msdn.microsoft.com/en-us/library/9bt8ty58.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T16:04:36.300

如果您没有明确设置宽度，浏览器会将其呈现为最长项目的长度（当然，如果问题是关于 Web 表单的）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-04-07T11:11:54.920

使用以下代码将 DropDown 事件添加到您的组合框：

```
private void comboBox_DropDown(object sender, EventArgs e)
        {
            Graphics g = (sender as ComboBox).CreateGraphics();
            float longest = 0;
            for (int i = 0; i < (sender as ComboBox).Items.Count; i++)
            {
                SizeF textLength = g.MeasureString((sender as ComboBox).Items[i].ToString(), (sender as ComboBox).Font);

                if (textLength.Width > longest)
                    longest = textLength.Width;
            }

            if (longest > 0)
                (sender as ComboBox).DropDownWidth = (int)longest;
        } 
```

# c# - 具有公共（单实例）构造函数的单例

> ID：384610
> 
> 赞同：3
> 
> 时间：2008-12-21T16:05:49.763
> 
> 标签：c#, design-patterns

作为一个练习，我正在将我们大型且久经考验的 Delphi 框架的一部分转换为 C#。

这个框架中包括一个通用的单例父类。当然，在 C# 中实现单例是相当容易的（甚至还有 Jon Skeet 的文章，所以我还希望有什么），但我们的 Delphi 单例对模式的看法略有不同：与发布“实例”相反属性/方法，它有一个“假”构造函数，总是返回相同的实例。这种方法的本质特征是*单例类的用户不知道他正在处理单例*：据他们所知，他们只是构造任何旧类并从中请求一些信息。

我想在 C# 中完成同样的事情（作为练习，所以它不必是生产质量的代码，邪恶的黑客很好），但到目前为止我失败了。

任何使简单的`myInstance = new MyClass();`总是返回相同实例的建议都是最受欢迎的！

* * *

## 附加信息

*   我们正在讨论框架提供的单例模式的便捷实现。它不一定是父类，但它也必须帮助开发人员创建他们自己的单例。要求他们手动将所有方法调用重定向到单实例不会让他们欣喜若狂。:-)

*   我对争论这是否是处理单例的正确方法并不真正感兴趣，现在我只对 c#-tweaking 的艺术感兴趣。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-21T16:29:20.090

你会做一个代理（编辑：正如汤姆在下面指出的，正确的设计模式是单态）：

```
public class MyClass {
  MyActualClass _actual;
  public MyClass() {
    _actual = MyActualClass. Instance;
  }
  public DoStuff() {
    _actual.DoStuff();
  }
}

internal class MyActualClass {
  private MyActualClass {
  }
  public DoStuff() {
    ...
  }
  MyActualClass _instance;
  public static Instance {
    get {
       if(_instance == null)
         _instance = new MyActualClass()
       return _instance;
    }
  }
} 
```

……

```
public static void Main() {
  var my1 = new MyClass();
  var my2 = new MyClass();   
} 
```

my1 != my2 但 my1.DoStuff() 调用与 my2.DoStuff() 相同的方法实例 如果您仅对接口进行编程，这将进一步简化。

编辑：平等问题可以通过使 _actual protected internal 和覆盖 MyClass.Equals(object obj) 检查 this._actual == obj._actual 来部分解决

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-21T16:53:52.020

我相信 Monostate 模式会给你你所需要的：

“ *Monostate 为我们提供了我们在 Singleton 中如此珍视的状态的奇异性，但没有随之而来的所有静态头痛。”*

更多信息：http: [//jeremyjarrell.com/archive/2008/04/21/88.aspx](http://jeremyjarrell.com/archive/2008/04/21/88.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T16:29:07.907

据我所知，由于 C# 处理对象实例的方式，这无法真正做到。为了调用构造函数，必须实际创建实例，并且不能只是从构造函数“返回”另一个对象。

我能想到的最好的事情（除了使用工厂方法）是在内部将类视为单例，并创建“虚拟”实例，这些实例在创建时都指向原始实例。因此，例如，在您的构造函数中，您将检查单例是否已初始化，如果没有，则将其初始化，然后您基本上只需将每个实例的方法和属性代理回单例。

在这个实现中，单例甚至不必是同一个类，但如果你想保持事物的包容性，你可以这样做。

**更新：**这种方法的一个缺点是，虽然每个实例都*表现*为单例，但它仍然有自己的对象引用，因此您可能还希望覆盖`Equals()`相等比较。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T16:12:28.610

我不知道你怎么能，因为构造函数不使用 return 语句。您可以克隆到单例的所有相关链接，但它会有局部变量的本地副本，并且非常混乱。

相反，让构造函数检查单例是否已实例化，如果已经实例化，则抛出异常，或向使用旧样式代码的开发人员记录警告。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T16:16:20.647

我认为您可以使用 Remoting 滚动一些东西。

**更新：**

更好的方法是将适当的单例类包装在结构或轻量级类中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T16:31:49.117

将单例创建为静态成员，并使所有方法都访问单个静态实例。

```
class SingletonWrapper {

    private static RealSingleton instance = new RealSingleton();

    public void methodA() {
        instance.methodA();
    }

    public String getA() {
        return instance.getA();
    }

} 
```

（这实际上是 Java 代码，但我认为 C# 足够相似。:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-05T07:16:28.530

如何使用静态函数返回一个使用 new 关键字的对象。

```
static private m_obj my_obj;
static private bool my_new_obj;
static public m_obj create_m_obj()
{
    if (my_new_obj == false)
    {
        my_new_obj = true;
        my_obj = new my_obj();
    }
    return my_obj;
} 
```

如果我没记错的话，那么您可以轻松地完全控制对象的创建。

# database - 您如何编写独立于数据库的应用程序？

> ID：384623
> 
> 赞同：8
> 
> 时间：2008-12-21T16:27:18.377
> 
> 标签：database, database-agnostic, ansi-sql

我的老板要求我只编写 ANSI SQL 以使其独立于数据库。但我了解到这并不容易，因为没有完全兼容 ANSI SQL 的数据库。[SQL 代码很少能在不修改的情况下在数据库系统之间移植。](http://en.wikipedia.org/wiki/SQL)

我看到人们用不同的方式使他们的程序数据库独立。例如：

1.  将 SQL 语句外部化为资源文件。
2.  编写许多提供程序类来支持不同的数据库。
3.  只写简单的 SQL，远离高级函数/连接。

您是否总是编写“任何数据库就绪”的代码？还是仅在需要时才这样做？如果是，你是如何实现的？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-21T16:33:47.240

您可以使用众多对象/关系映射器工具之一，例如 Hibernate/NHibernate、LLBLGen 等。这可以让您在数据库可移植性方面走得更远。无论您做什么，都需要在模型和其余代码之间有一些抽象层。这并不意味着您需要某种依赖注入基础架构，但良好的 OO 设计可以让您走得更远。此外，坚持使用简单的 SQL 并认为可以为您带来可移植性是相当幼稚的。如果您的应用程序是微不足道的并且只使用非常微不足道的查询，那将是正确的。

至于**总是**将应用程序编写为“任何数据库就绪”，我通常使用某种抽象层，因此从一个数据库系统迁移到另一个数据库系统并不难。但是，在许多情况下，这不是必需的，您正在为 Oracle 平台或 SQL Server 或 MySQL 进行开发，因此您不应该为了完全无缝转换的可能性而牺牲您选择的 RDBMS 的好处。然而，如果您构建了一个好的抽象层，即使针对特定的 RDBMS 也不一定很难迁移到不同的 RDBMS。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-21T16:35:41.997

要将数据库引擎与应用程序分离，请使用数据库抽象层（也称为[数据访问层](http://en.wikipedia.org/wiki/Data_access_layer)或 DAL）。你没有提到你使用什么语言，但是所有主要语言都有很好的数据库抽象库。

但是，通过避免特定于数据库的优化，您将错过特定品牌的优势。我通常抽象出可能的东西并使用可用的东西。更改数据库引擎是一项重大决策，并且不会经常发生，最好尽可能使用您可用的工具。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-21T17:08:54.987

告诉你的老板管好自己的事。不，当然不能对老板说这样的话，但请继续关注。

有趣的是这个需求应该支持什么商业价值。一个明显的候选似乎是数据库代码应该准备好在除当前之外的其他数据库引擎上工作。如果是这种情况，那么这就是要求中应说明的内容。

作为一名工程师，您可以从那里找出实现这一目标的不同方法。一个人可能正在编写 ANSI SQL。一种可能是使用数据库抽象层。

此外，您有责任告知您的老板不同替代方案的成本（在性能、开发速度等方面）。

“编写 ANSI SQL”……呸！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T17:19:37.117

只是为了记录。Stackoverflow 上有一个类似的问题：

[**数据库无关应用程序的数据库设计**](https://stackoverflow.com/questions/204025/database-design-for-database-agnostic-applications)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-21T22:13:57.537

100% 符合 ANSI SQL 是一个难以实现的目标，但无论如何也不能保证可移植性。所以这是一个人为的目标。

据推测，您的老板要求这样做是为了方便快捷地切换数据库品牌以用于将来的某些假设目的（实际上可能永远不会发生）。但是他现在正在用这种未来的效率来换取更多的工作，因为使代码与数据库无关变得更加困难。^*

因此，如果您可以根据您的经理*应该*关注的目标来表述问题，例如按时并按预算完成当前的项目阶段，这可能比仅仅告诉他使代码与数据库无关太难更有效.

有一种情况是您需要编写真正与数据库无关的代码，即您正在开发一个需要支持多个品牌数据库的收缩包装应用程序。

无论如何，即使您目前只支持一个品牌，在某些情况下您肯定可以选择使用专有功能编写一些 SQL，但也存在一种更便携的方式来实现相同的结果。您可以将这些视为“唾手可得”的案例，并且可以在将来需要时更轻松地移植代码。但是也不要限制自己，如果它们提供良好的价值，请使用专有解决方案。如果/当您需要进行移植时，可能会在评论中添加注释，这值得审查。

* * *

^*在谈论平台独立性时，我更喜欢“中立”这个词而不是“不可知论”这个词。它避免了宗教色彩。:-)

# .net - 什么时候比较器会让 Sort 抛出 ArgumentException？

> ID：384632
> 
> 赞同：3
> 
> 时间：2008-12-21T16:32:25.793
> 
> 标签：.net, sorting, icomparer

[Sort](http://msdn.microsoft.com/en-us/library/k3e17y47(VS.80).aspx)的文档说，如果“比较器的实现在排序过程中导致错误。例如，比较器在将项目与自身进行比较时可能不会返回 0”，Sort 将抛出 ArgumentException。

除了给出的例子之外，谁能告诉我什么时候会发生这种情况？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T16:43:47.453

排序算法 (QuickSort) 依赖于可预测的 IComparer 实现。在 BCL 中进行了几十层间接之后，您最终会采用这种方法：

```
public void Sort(T[] keys, int index, int length, IComparer<T> comparer)
{
    try
    {
        ...
        ArraySortHelper<T>.QuickSort(keys, index, index + (length - 1), comparer);

    }
    catch (IndexOutOfRangeException)
    {
        ...
        throw new ArgumentException(Environment.GetResourceString("Arg_BogusIComparer", values));
    }
} 
```

进一步了解 QuickSort 实现，您会看到如下代码：

```
 while (comparer.Compare(keys[a], y) < 0)
    {
        a++;
    }
    while (comparer.Compare(y, keys[b]) < 0)
    {
        b--;
    } 
```

基本上，如果 IComparer 错误地执行 Q​​uicksort 调用并抛出一个 IndexOutOfRangeException，它包含在 n ArgumentException 中。

这是另一个坏 IComparer 的例子

```
class Comparer: IComparer<int>
{
    public int Compare(int x, int y)
    {
        return -1;
    }
} 
```

所以我想，简短的回答是，只要您的 IComparer 实现不能始终如一地比较文档中定义的值：

> 比较两个对象并返回一个值，指示一个对象是否小于、等于或大于另一个对象。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-10-11T19:04:33.080

我今天遇到了这个问题，经过调查，我发现有时我的比较器被调用时 x 和 y 是对**同一个对象**的引用，而我的比较器没有返回 0。一旦我修复了这个问题，我就停止了异常。

高温下，

埃里克

# c# - 根据某些标准从集合中选择最大项目

> ID：384633
> 
> 赞同：2
> 
> 时间：2008-12-21T16:32:59.987
> 
> 标签：c#, .net-3.5, extension-methods

我是.net 3.5 的新手。我有一系列物品：

```
IList<Model> models; 
```

在哪里

```
class Model
{
    public string Name
    {
       get;
       private set;
    }
} 
```

我想获得名称长度最长的元素。我试过

```
string maxItem = models.Max<Model>(model => model.Name.Length); 
```

但它当然会返回最大长度（我需要一个`Model`对象）。我知道有一种使用扩展方法的方法，但我不知道如何。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-21T16:44:11.683

不幸的是，没有内置的方法可以做到这一点 - 但编写扩展方法来做到这一点真的很容易。

实际上，这是在[我的第一篇博客文章](http://msmvps.com/blogs/jon_skeet/archive/2005/10/02/a-short-case-study-in-linq-efficiency.aspx)中……请注意，其中一个评论中有更好的实现。如果我有时间，我会把它移到身体里。

编辑：好的，我有一个稍微缩写的版本 - 它只是使用给定的选择器返回最大元素。也无需进行投影 - 如果需要，请在之后进行一次。请注意，您可以删除约束`TValue`并`Comparer<TValue>.Default`改为使用，或者具有允许将比较指定为另一个参数的重载。

```
public static TSource MaxBy<TSource, TValue>(this IEnumerable<TSource> source,
                                             Func<TSource, TValue> selector)
    where TValue : IComparable<TValue>
{
    TValue maxValue = default(TValue);
    TSource maxElement = default(TSource);
    bool gotAny = false;

    foreach (TSource sourceValue in source)
    {
        TValue value = selector(sourceValue);
        if (!gotAny || value.CompareTo(maxValue) > 0)
        {
            maxValue = value;
            maxElement = sourceValue;
            gotAny = true;
        }
    }
    if (!gotAny)
    {
        throw new InvalidOperationException("source is empty");
    }
    return maxElement;
} 
```

示例使用：（注释类型推断）：

```
string maxName = models.MaxBy(model => model.Name.Length).Name; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T17:42:16.633

这是另一种方法。有一个版本`Max`没有标准，并且使用`IComparable`. 因此，我们可以提供一种将任何东西包装在可比较对象中的方法，委托提供比较。

```
public class Comparable<T> : IComparable<Comparable<T>>
{
    private readonly T _value;
    private readonly Func<T, T, int> _compare;

    public Comparable(T v, Func<T, T, int> compare)
    {
        _value = v;
        _compare = compare;
    }

    public T Value { get { return _value; } }

    public int CompareTo(Comparable<T> other)
    {
        return _compare(_value, other._value);
    }
} 
```

然后我们可以说：

```
Model maxModel = models.Select(m => new Comparable<Model>(m, (a, b) => a.Name.Length - b.Name.Length)).Max().Value; 
```

这涉及很多额外的分配，但它在学术上有点有趣（我认为）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T16:50:28.860

这就是我让它工作的方式。也许有更好的方法，我不确定：

```
 decimal de = d.Max(p => p.Name.Length);
    Model a = d.First(p => p.Name.Length == de); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T17:08:31.743

使用扩展方法有什么收获吗？

也许具有简单迭代列表的方法或过程就足够了？

大意是什么

```
暗淡结果为 string = models(0).Name
对于每个 m 作为模型中的模型
  如果 m.Name.length > result.length 那么
    结果 = m.Name
  万一
下一个

```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T19:24:51.390

您可以使用聚合。无需编写新的扩展方法即可完成。

```
models.Aggregate(
                new KeyValuePair<Model, int>(),
                (a, b) => (a.Value < b.Name.Length) ? new KeyValuePair<Model, int>(b, b.Name.Length) : a,
                a => a.Key); 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-12-21T17:10:34.843

另一种方式可能是：

```
var item = (from m in models select m orderby m.Name.Length descending).FirstOrDefault(); 
```

第一个将是长度最长的那个。

# firefox - 从 Firefox 缓存加载图像？

> ID：384634
> 
> 赞同：1
> 
> 时间：2008-12-21T16:33:13.107
> 
> 标签：firefox, caching, greasemonkey

正如标题所示，我正在尝试从 Firefox 缓存中加载图像。我正在运行 Ubuntu，所以我的缓存位置是 /home/me/.mozilla/firefox/xxxxxx.default/Cache

然而，在缓存中（这也在 Mac 上）文件名只是字母和数字的荒谬组合。有没有办法查明某个文件？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T20:06:22.007

您应该查看[CacheViewer Add-on](https://addons.mozilla.org/en-US/firefox/addon/2489)的源代码。
下载文件而不是安装它（右键单击并另存为）然后解压缩它（它只是一个 Zip 文件，即使它具有 .xpi 扩展名），然后在生成的 chrome 文件夹中解压缩 cacheviewer.jar 文件。最后进入内容，然后进入缓存查看器以查找 javascript 和 XUL 文件。

根据我的简短调查，有用的例程在 cacheviewer.js 文件中，但如果您希望有一个简单的 javascript one liner 来访问缓存项目，您可能会感到失望。XUL 文件（只是 XML）有助于确定调用哪些 JS 函数来执行特定任务。我不太确定所有这些如何映射到 Greasemonkey，而不是扩展环境，但希望有足够的代码让你开始。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T18:41:26.610

嗯，这确实是一个内部实现细节。但我建议看看 about:cache?device=disk 和 about:cache-entry?client=HTTP&sb=1&key= [https://stackoverflow.com/Content/img/wmd/blockquote.png](https://stackoverflow.com/Content/img/wmd/blockquote.png)是如何实现的。

此外，[http://www.securityfocus.com/infocus/1832](http://www.securityfocus.com/infocus/1832)也提供了详细信息。请注意，Firefox 不会为所有内容使用单独的文件...

当然，Firefox 可能随时更改格式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-12-10T18:16:40.870

只需为您的`img src=`属性提供完整的 URL。如果图像恰好是可缓存的（例如，服务器发送适当的`Expires:`or`Cache-control:`标头）并且它已经在缓存中，Firefox 将不会访问网络。

HTTP 缓存应该是不可见的。当您生成内容时，您通常不应该担心它。

您可以将[REDbot](http://redbot.org/)指向一个 URL，以查看有关其可缓存性的各种美味信息。

# javascript - 如何在 xml 文档中包含 Javascript？

> ID：384639
> 
> 赞同：22
> 
> 时间：2008-12-21T16:36:58.093
> 
> 标签：javascript, xml

这个任务似乎很简单：如何在 xml-document 中包含一个 Javascript 文件，以便至少 Opera 和 Firefox 可以真正解析它并执行代码？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-09-20T17:30:22.873

添加一个说明 XHTML 命名空间的脚本，它会运行得很好。

```
<xhtml:script xmlns:xhtml="http://www.w3.org/1999/xhtml"
                src="file.js"
                type="application/javascript"/> 
```

另请参阅 [http://www.ibm.com/developerworks/xml/library/x-ffox3/](http://www.ibm.com/developerworks/xml/library/x-ffox3/)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-12-21T16:58:33.447

如果我明白了，您希望 XML 文档在浏览器中查看时运行 javascript？

这不是 XML 标准的一部分，因此不会被支持（我认为这永远不会被支持，因为 XML 不是用于显示，而是用于数据）。如果您在谈论 XHTML，那么这是另一回事。

--

编辑：只是为了澄清我的答案。

XML 从未打算像 HTML 那样成为显示标记，这就是开发 XHTML（符合 XML 标准的 HTML）的原因。浏览器已被设计为以某种方式解释 XHTML，但 XML 只是原始数据。

如果您希望您的 XML 运行诸如 JavaScript 之类的附加功能，您将需要考虑使用 XSLT 将您的 XML 转换为 XHTML，从而利用浏览器的功能。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2013-05-07T18:49:23.560

```
<script xmlns="http://www.w3.org/1999/xhtml"><![CDATA[
alert('Hello');
]]></script> 
```

或者对于外部 javascript：

```
<script xmlns="http://www.w3.org/1999/xhtml" src="external.js"></script> 
```

适用于 Firefox 和 Opera。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-06-05T16:52:44.677

我这样做了：

**XSLT：**

```
<xsl:value-of select="/label[@id='MyScript']/text()" disable-output-escaping="yes"/> 
```

**XML:**

```
<label id="MyScript"><![CDATA[
<script type="text/javascript">
alert("Hello world");
</script>
]]></label> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T21:21:02.030

将 XML 和 Javascript 嵌入到 XHTML 文档中，然后使用动态 HTML 的大量且记录良好的功能。

通过推理，由于某些浏览器实现了 XML 文档的弱且文档不良的 CSS 样式，因此它们必须支持嵌入 XML 中的 Javascript 的执行，就好像有任何连接一样，您会比您更快地启动和运行一些东西在这两个想法之间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-07-12T19:53:44.397

与上述类似，但这可能会出错，因为`<![CDATA[`and`]]>`部分不是有效代码。如果您将其放入 XSL 脚本中，您也可以在这些开始和结束元素之前放置一个 JS 注释标记。

我还使用该`xsl:text`元素来输出该`<![CDATA[`部分。这部分可能有点作弊，但它*会*生成格式良好的 XML。块内的一个例子`xsl:choose`可能是......

```
...
<xsl:when test='name()="script"'>
  <script>
    <xsl:for-each select='@*'><xsl:copy-of select='.' /></xsl:for-each>
    <xsl:text disable-output-escaping='yes'>
// &lt;![CDATA[
  </xsl:text>
  <xsl:copy-of select='./text()' />
  <xsl:text disable-output-escaping='yes'>
//]]&gt;
  </xsl:text>
  </script>
</xsl:when>
... 
```

穿过碎片...

1.  检测一个`<script>`元素。
2.  为输出复制`<script>`标签。
3.  请务必使用快速`xsl:for-each`行在输出中保留标签属性。
4.  输出非转义文本：`// <![CDATA[`. 将该`//`行的其余部分呈现为注释，从而防止 JS 错误。
5.  复制`<script>`标签的文本内容。注意：您必须保留换行符（如上所述或其他方式），以便注释掉的行之前不会与此行位于同一行。显然，如果是这样，它也会注释掉这一行。保留后一个不是必需的，但可以保持两个匹配的 CDATA 标记的美观。
6.  输出非转义文本：`// ]]>`. 这结束了 CDATA 块，并且在读取 JS 时浏览器再次忽略了 CDATA 标记。
7.  `</script>`当然，用标签关闭块。
8.  而且，如果您在一个`xsl:choose`块中使用它，请关闭 then `xsl:when`。

只有步骤 2、3、5 和 7 实际复制了脚本块。剩下的就是忙于让它工作。

转换一个块，例如...

```
...
<script type='javascript'>alert('Hello World!');</script>
... 
```

然后变成，

```
...
<script type='javascript'>
// <![CDATA[
alert('Hello World!');
// ]]>
</script> 
```

XML 和浏览器都有效地保存和读取。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-12-21T16:44:08.483

应该帮助您的函数是 eval() 函数。此函数将评估您作为 Javascript 传递给它的任何字符串。

此外，还可以在 Javascript 中解析 XML。只需谷歌“javascript xml解析器”。

结合这两个想法，你就会上路。

* * *

如果您只是想将 javascript 放入 XML 文件中：

<xml> <js script="1"> 这里是一些javascript；这里有更多的javascript；</js> <js script="2"> 这里更多的是javascript；jere 更是 javascript；</js> </xml>

# web-hosting - 供个人使用的 ISPConfig 替代方案

> ID：384681
> 
> 赞同：-1
> 
> 时间：2008-12-21T17:08:49.307
> 
> 标签：web-hosting

是否有任何外观合适的 ISPConfig 替代软件可以在 lunux 下运行？我不需要经销商管理和类似功能，我只想在我自己的服务器中管理网站和域。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T18:02:21.883

有：

*   [http://isp-control.net/](http://isp-control.net/)
*   [http://www.webmin.com/](http://www.webmin.com/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-09-30T15:12:32.693

我会尝试[IspCP](http://isp-control.net/)，它功能强大、美观且易于使用。

# delphi - 如何使通用对象列表从特定的基类工作？

> ID：384690
> 
> 赞同：2
> 
> 时间：2008-12-21T17:18:57.727
> 
> 标签：delphi, generics, delphi-2009

```
 TMyDataList<T: TBaseDatafile, constructor> = class(TObjectList<TBaseDatafile>)
   public
      constructor Create;
      procedure upload(db: TDataSet);
   end; 
```

我在一篇博文中读到（我不记得现在在哪里），这是为泛型对象声明具有特定基类型的基于泛型的类的方法。编译器会接受它就好了。但是当我尝试使用它时，它决定不合作。

```
type
   TDescendantList = TMyDataList<TDescendantDatafile>; 
```

这给了我一个编译器错误。

[DCC 错误] my_database.pas(1145)：E2010 不兼容的类型：“TDescendantDatafile”和“TBaseDatafile”

问题是， 1145 甚至不是有效的行。有问题的文件在#1142 结束，它所抱怨的类型声明在#20 行。这让我想知道这是否是编译器故障。还是我的语法不太正确？有谁知道使这项工作的方法？

编辑：吉姆指出，当他尝试它时，它编译得很好。更多信息：我在同一单元中声明了基本数据文件类型和通用列表，而 TDescendantDatafile 在第二个单元中，而 TDescendantList 在第三个单元中定义。我已经在 D2009 的编译器中发现并报告了一个错误，其中涉及泛型在多个单元中搞砸了类型。这可能是相关的。谁能证实这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T19:19:55.750

TObjectList<> 的定义是：

```
TObjectList<T: class> = class(TList<T>) 
```

所以你喜欢做这样的事情：

```
TMyDataList<T: TBaseDatafile> = class(TObjectList<T>) 
```

不幸的是，这行不通。幸运的是：

```
TMyDataList<T: class> = class(TObjectList<T>) 
```

有效，但这可能不是您想要的。因为它不会利用类类型。我真的认为这里的类说明符有点奇怪。（TObject 应该避免了这些问题）。但这对你没有帮助。

再说一次，以下工作：

```
 TBaseDataFile = class
  end;

  TDescendantDatafile = class (TBaseDataFile)
  end;

  TMyDataList<T: TBaseDataFile> = class(TObjectList<TBaseDataFile>)
  public
    constructor Create;
  end; 
```

你确定 TDescendantDataFile 继承自 TBaseDataFile 吗？

在过去，（阅读 turbo pascal）有时由于不可见字符而导致行号错误。但我认为这仍然无效。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T20:56:37.647

当*TDescendantDatafile*从*TBaseDataFile*下降时，它在我的机器上工作正常。检查您的类层次结构。

如果我更改*TDescendantDatafile*的祖先，那么我会收到相同的错误消息，它会给出正确的行号。如果你的编译器给你错误的行号然后关闭项目，重新打开它并进行完整的构建。

# c# - ChannelFactory 抛出的 WCF 异常

> ID：384706
> 
> 赞同：2
> 
> 时间：2008-12-21T17:40:40.430
> 
> 标签：c#, wcf, web-services, channelfactory

我正在连接到服务并使用 ChannelFactory 创建的通道。我想知道在调用服务接口的方法时会抛出哪些异常（例如，如果有一个名为 ICalculator 的服务接口并且我正在调用它的 Add(5, 4)）。我无法搜索该主题，因为我真的不知道如何命名问题以及我到底在寻找什么。我将不胜感激与此类信息的任何链接。

我的意思是有关损坏的连接等的异常，而不是服务创建者指定的异常。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T18:28:05.717

你可以得到：

*   如果服务实现抛出未处理的异常，则为 FaultException 或派生类 (FaultException<T>)。

*   如果与服务通信发生错误，则发生 CommunicationException。

可能还有其他的，但这些是您通常会处理的。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-21T17:44:07.537

我怀疑你想抛出的任何类型的异常。为什么只允许某些例外情况？

# .net - 操作方法：复制依赖程序集以防它不在 GAC 中？

> ID：384710
> 
> 赞同：1
> 
> 时间：2008-12-21T17:42:38.663
> 
> 标签：.net, installation, windows-installer, custom-action

我正在使用 VS2008 构建安装包。这是为 Outlook 安装 COM 加载项应用程序的常规安装程序包。它工作正常，到目前为止。不过我需要稍微改进一下...

故事是安装包将所有依赖程序集复制到加载项的安装文件夹中。

例如，COM 加载项依赖于 Microsoft.Office.Interop.Outlook.dll 程序集。所以安装包将它复制到它的文件夹:)

当然，我可以将 Microsoft.Office.Interop.Outlook.dll 依赖项的 Exclude 属性切换为 True，这将防止程序集被复制。但是，我需要实现以下行为：

*   如果 Microsoft.Office.Interop.Outlook.dll 不在 GAC 中，我们只需将其复制到加载项的安装文件夹
*   否则，使用 GAC 中的那个

请建议 ti 可以在 .Net2.0 中完成的方式？一步一步的指南将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T17:47:35.923

只需始终将其复制到文件夹中。如果它已经在 GAC 中，那么无论如何都会首先使用 GAC 的程序集。

换句话说，运行时首先检查 GAC。然后，检查应用程序库等。

[http://msdn.microsoft.com/en-us/library/yx7xezcf(VS.71).aspx](http://msdn.microsoft.com/en-us/library/yx7xezcf(VS.71).aspx)

# visual-c++ - Visual C++ 2005：如何访问 .cpp 文件中的 Win32 表单控件值？

> ID：384721
> 
> 赞同：0
> 
> 时间：2008-12-21T17:51:32.920
> 
> 标签：visual-c++, class, controls

我最近开始在 Visual Studio 2005 中闲逛，并且在 Visual C++ 中闲逛。当我在设计器中双击一个控件时，它会打开 .h 文件，我理解它是用于原型声明的，如果我把所有的胆量都放在里面的函数中，我可以让我的程序工作，但我不喜欢将代码放在 .h 文件中。

但是，当我将内容放入 .cpp 文件时，我似乎根本无法访问这些控件。我得到了很多编译器错误等，我想知道 VC++ 期待什么，因为我更习惯于 GCC/MinGW 环境。

我收到最多的错误是：

`error C2228: left of '.trackBar1/.value/.etc' must have class/struct/union`
`error C2227: left of '->trackBar1/->Value/->etc' must point to class/struct/union/generic type`

我尝试了以下方法来访问控件：

```
Junk::Form1::trackBar1->value
Junk::Form1::trackBar1.value
Junk::Form1->trackBar1
Junk->Form1->trackBar1
this->trackBar1->value //This is legal in the .h file, and how I can get it to work there
trackBar1->value 
```

还有一些只是出于绝望的尝试。我尝试指定相同的命名空间和 .h 文件中存在的所有内容，但我似乎仍然无法访问该控件。

我正在使用带有 Visual C++ CLR Win32 表单应用程序的 Visual Studio 2005。Visual Studio 用于创建控件实例的代码是：

```
this->trackBar1 = (gcnew System::Windows::Forms::TrackBar()); 
```

在 Dev-C++ 或 code::blocks 中，我习惯于将类声明放在 .h 文件中，然后通过执行 class::function 在 .cpp 文件中指定函数，但在 Visual Studio 中，我不能似乎弄清楚为什么我不能做同样的事情，或者我在做什么非常错误和愚蠢。

谢谢你。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-21T18:00:42.777

感谢您澄清问题，这里有一些想法

*   确保 .h 文件包含在相应的 cpp 中，例如，确保如果您已定义

foo.h

```
class
{
...
}; 
```

确保 foo.cpp 包含 foo.h，如下所示：

```
#include "foo.h"

... definitions ... 
```

*   看起来在你的类的上下文中引用 trackBar1 应该是有效的，这是你上面的最后一个例子。如果您超出了类的范围，则需要声明封闭类的实例并引用它的 trackBar 实例。

另外，就像我之前说的：

您需要知道您的“Form1”是否是对象或类或命名空间的值或实例。如果它是一个命名空间/类，而不是使用 :: 来阐明命名空间是合适的。从错误看来，它可能不是命名空间/类/结构。您似乎还试图将其视为指针。是指针吗？它是如何更新的？

我会简化为尝试一个非常简单的 C++ header/cpp 示例。确认这有效。慢慢复制粘贴你的功能，看看它在哪个阶段中断。制作一个 hello world 程序是 VS 2005 并添加您的代码。

当您发现它在哪里损坏并且仍然损坏时，请使用您的简化示例代码集编辑您的问题，我们可以更好地帮助您调试。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-07T05:52:36.917

这可能是因为控件已更改（即双击）。返回控件（在设计视图中）并更改名称。然后改回来。然后重新编译。

干杯!

# c# - 实用/应用应用安全

> ID：384725
> 
> 赞同：0
> 
> 时间：2008-12-21T17:57:14.373
> 
> 标签：c#, .net, security, vfs

好吧，这是我的问题。我正在开发一个最终将是多层的游戏引擎。该引擎允许使用 .Net 语言或 Lua（内置脚本引擎）编写游戏。但是为了安全起见，我想阻止人们查看这些文件，当然也阻止他们编辑它们。我的解决方案是制作一个带有加密标头的虚拟文件系统。这样就很难发现游戏数据文件的内容，如果有人这样做了，他们将无法在没有密钥的情况下对其进行编辑，否则将无效。

当前游戏的另一个问题是它连接到 SQL 数据以获取某些数据，这意味着数据库连接字符串和密码存储在应用程序中。

但是，您如何处理将密码存储在 .Net 应用程序中？我知道它们可以被反编译，并且将密钥存储在可读的配置文件中是没有意义的，那么大多数专业人员是如何做到的呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T18:04:42.830

通常客户端应用程序不直接连接到数据库。而是连接到代表应用程序处理远程调用的服务器。在这种情况下，唯一需要数据库密码的是服务器。

在现代 .Net 世界中，服务器通常使用[WCF构建](http://msdn.microsoft.com/en-us/netframework/aa663324.aspx)

# c# - 用于事件处理程序的 Lambda？

> ID：384737
> 
> 赞同：9
> 
> 时间：2008-12-21T18:05:36.493
> 
> 标签：c#, lambda, event-handling

C# 3 中的 Lambda 语法使得创建单行匿名方法非常方便。它们是对 C# 2 给我们的冗长的匿名委托语法的明确改进。然而，lambda 的便利性带来了在我们不一定需要它们提供的函数式编程语义的地方使用它们的诱惑。

例如，我经常发现我的事件处理程序是（或至少一*开始是*）简单的单行程序，它们设置状态值，或调用另一个函数，或在另一个对象上设置属性等。对于这些，我应该混乱我的类还有另一个简单的函数，还是我应该在我的构造函数中将一个 lambda 填充到事件中？

在这种情况下，lambda 有一些明显的缺点：

*   我不能直接调用我的事件处理程序；它只能由事件触发。当然，对于这些简单的事件处理程序，*我几乎不需要直接调用它们*。
*   我无法从事件中解开我的处理程序。另一方面，*我很少需要解开事件处理程序，所以这不是什么大问题，无论如何*。

出于上述原因，这两件事并不困扰我。而且我*可以*通过将 lambda 存储在成员委托中来解决这两个问题，如果它们确实是问题的话，但这会破坏使用 lambda 来方便和保持类整洁的目的。

不过，还有两件事我认为可能不是那么明显，但可能更成问题。

*   每个 lambda 函数在其包含范围内形成一个*闭包。*这可能意味着在构造函数中较早创建的临时对象的存活时间比它们需要的时间长得多，因为闭包维护了对它们的引用。现在希望编译器足够聪明，可以从闭包中排除 lambda 不使用的对象，但我不确定。有人知道吗？

    再次幸运的是，这并不总是一个问题，因为我不经常在我的构造函数中创建临时对象。不过，我可以想象一个我做过的场景，而且我不能轻易地将它的范围限定在 lambda 之外。

*   可维护性可能会受到影响。重要时刻。如果我将一些事件处理程序定义为函数，而将一些事件处理程序定义为 lambda，我担心这可能会使追踪错误或仅仅理解类变得更加困难。后来，如果我的事件处理程序最终扩展，我要么必须将它们移动到类级函数，要么处理我的构造函数现在包含大量实现我的类功能的代码的事实.

所以我想借鉴其他人的建议和经验，也许是那些有其他语言经验并具有函数式编程特性的人。这种事情有什么既定的最佳实践吗？您是否会避免在事件处理程序中或在 lambda 明显超出其封闭范围的其他情况下使用 lambda？如果不是，您会在多大的阈值下决定使用实函数而不是 lambda？上述任何陷阱有没有严重伤害任何人？有没有我没有想到的陷阱？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T18:19:07.747

我通常有一个专门用于连接事件处理程序的例程。其中，我对实际的处理程序使用匿名委托或 lambda，使它们尽可能短。这些处理程序有两个任务：

1.  解包事件参数。
2.  使用适当的参数调用命名方法。

完成此操作后，我避免使用无法干净地用于其他目的的事件处理程序方法使我的类名称空间混乱，并强迫自己考虑我确实实现的操作方法的需求和目的，通常会产生更清晰的代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T18:16:39.903

> 每个 lambda 函数在其包含范围内形成一个闭包。这可能意味着在构造函数中较早创建的临时对象的存活时间比它们需要的时间长得多，因为闭包维护了对它们的引用。现在希望编译器足够聪明，可以从闭包中排除 lambda 不使用的对象，但我不确定。有人知道吗？

根据我的阅读，C# 编译器要么生成一个匿名方法，要么生成一个匿名内部类，这取决于它是否需要关闭包含范围。

换句话说，如果您不在 lambda 中访问包含范围，它不会生成闭包。

然而，这有点“道听途说”，我希望有更了解 C# 编译器的人参与进来。

话虽如此，旧的 C# 2.0 匿名委托语法也做了同样的事情，而且我几乎总是将匿名委托用于短事件处理程序。

您已经很好地介绍了各种利弊，如果您需要解除事件处理程序的挂钩，请不要使用匿名方法，否则我完全赞成。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T18:33:04.973

基于对编译器的一个小实验，我会说编译器足够聪明，可以创建一个闭包。我所做的是一个简单的构造函数，它有两个不同的 lambda，用于 List.Find() 中的谓词。

第一个 lamdba 使用硬编码值，第二个使用构造函数中的参数。第一个 lambda 被实现为类的私有静态方法。第二个 lambda 被实现为执行关闭的类。

因此，您认为编译器足够聪明的假设是正确的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T18:22:20.843

lambda 的大部分相同特性同样适用于您可以使用它们的其他地方。如果事件处理程序不适合他们，我想不出更好的办法。它是一个单点独立的逻辑单元，位于其单点上。

在许多情况下，该事件旨在获得一些背景信息，结果证明它恰好适合手头的工作。

我认为这是重构意义上的“好气味”之一。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-04-15T11:00:57.147

关于 lambdas，我最近提出的[这个问题在接受的答案中有一些关于对对象寿命的影响的相关事实。](https://stackoverflow.com/questions/23020789/does-passing-a-method-of-one-object-to-another-object-keep-the-first-object-aliv)

我最近了解到的另一件有趣的事情是，C# 编译器在其捕获和保持活动状态的方面将多个闭包理解为与单个闭包相同的作用域。可悲的是，我找不到这个的原始来源。如果我再次偶然发现它，我会补充一点。

就个人而言，我不使用 lambdas 作为事件处理程序，因为我觉得当逻辑从请求流向结果时，可读性优势确实出现了。事件处理程序往往被添加到构造函数或初始化程序中，但在对象生命周期的这一点上很少会调用它。那么为什么我的构造函数读起来就像它现在正在做的事情实际上是在很久以后才发生的呢？

另一方面，我确实使用了一种稍微不同的事件机制，我发现它比 C# 语言功能更可取：用 C# 重写的 iOS 风格的 NotificationCenter，调度表由 Type（派生自 Notification）和动作 < 通知 > 值。这最终允许单行“事件”类型定义，如下所示：

```
public class UserIsUnhappy : Notification { public int unhappiness; } 
```

# ios - Core Graphics 的图形效果库？

> ID：384742
> 
> 赞同：2
> 
> 时间：2008-12-21T18:12:06.090
> 
> 标签：ios, cocoa-touch, open-source, graphic-effects

我已经达到了不能一直拖延编写 iPhone 应用程序的图形部分的程度。

到目前为止，让我无法深入研究的原因是，很难弄清楚如何实现我的想法，即在某些灯上产生“发光”、“闪闪发光”的效果。在 Amiga 场景的日子里，我曾经擅长这些事情。但是今天我一无所知。现在我可以看到有如此多的 iPhone 应用程序具有完全令人惊叹的图形效果。所以。我想知道是否有人知道用于创建这些的可用库？最好是开源的，但如果涉及到，我愿意为此付出一些代价。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T23:42:49.963

最简单的方法可能是在绘图/绘画程序中将所有效果渲染为具有透明度的 PNG，然后在 iPhone 本身上定位/构建/动画它们。这适用于发光、粒子和类似效果。

CGImage 是图像数据的最快渲染源，您可以在单个视图中手动将它们分层（通过自己定位和绘制）或绘制到单独的 UILayers 并使用图层进行动画处理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T18:43:36.137

也许[SDL](http://www.libsdl.org)会有所帮助。

**编辑：**只是为了动机

*   [iPhone SDL 测试](http://www.youtube.com/watch?v=th3__8ozNz0)
*   [iPhone SDL 测试 2](http://www.youtube.com/watch?v=nsaTHM0R2Dw)
*   [iPhone SDL 测试 3](http://www.youtube.com/watch?v=jmT7dhfRjjU)

# c# - 如何快速编写和运行小型 C# 代码

> ID：384743
> 
> 赞同：69
> 
> 时间：2008-12-21T18:12:28.010
> 
> 标签：c#, visual-studio, testing

有时我想测试来自论坛的新代码，或者需要帮助我的朋友解决特定的 C# 问题。问题是我不想每次都在 Visual Studio 中创建新的“项目”，只是为了编写/运行这个小代码。

Java & Eclipse IDE 提供了“剪贴簿”功能，允许执行任意 Java 表达式。C#程序员有哪些选择？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-12-21T18:15:38.720

~~[片段编译器](http://www.sliver.com/dotnet/SnippetCompiler/)非常适合这个。~~

[LINQPad](http://www.linqpad.net/)也适用于测试各种 C#、F# 或 VB 代码，而不仅仅是 LINQ 查询。

* * *

**编辑**

我想是时候提一下 Snippet Compiler 已经五年多没有更新了，因此不再是最佳选择。

但是，我最初低估了 LINQPad。正如 Will Dean 在评论中提到的，LINQPad 非常适合各种代码，而不仅仅是 LINQ 查询。事实上，它已成为我不可或缺的工具。我每天都用它，不仅是为了快速测试出简短的代码片段，而且是为了测试相对复杂的小程序。其先进的输出格式使得快速检查中间和最终结果变得非常容易。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2016-08-01T12:24:18.470

派对有点晚了，但我自己在寻找这个时来到这里。

最适合我的解决方案是在**Visual Studio** 2015 或更高版本中使用`C# Interactive`-window 。您可以通过> >打开它，或者选择一些 c# 代码并在右键单击上下文菜单中单击来访问它。**`View``Other Windows``C# Interactive``Execute in Interactive`**

 **这是有关如何使用它的链接：http: [//dailydotnettips.com/2016/01/12/use-c-interactive-window-for-your-coding-experiment-in-visual-studio-2015/](http://dailydotnettips.com/2016/01/12/use-c-interactive-window-for-your-coding-experiment-in-visual-studio-2015/)

我知道它适用于 VS2015，但我认为它不适用于旧版本。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2014-11-12T01:27:32.887

[.NET Fiddle](https://dotnetfiddle.net/)网站似乎是一个不错的选择。它具有代码完成、代码计时和 NuGet 包集成。

从他们的网站：

> 我们是一群 .NET 开发人员，他们厌倦了启动 Visual Studio、创建新项目并运行它，只是为了测试简单的代码或尝试其他开发人员的示例。
> 
> 这个工具的灵感来自[http://jsfiddle.net](http://jsfiddle.net)，这真是太棒了。

特别是，我建议尝试他们的 MVC 模式。在屏幕左侧选择`Project Type: MVC`。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-12-21T18:17:29.327

这就是我所做的：

*   转到工具->选项->项目和解决方案，并禁用“创建时保存新项目”。

*   启动一个新的 VS，Ctrl-Shift-N 创建一个项目，然后使用它。

*   使用 C# Express 可以让一些东西启动得更快、更简洁，但仍然有足够的能力来完成大多数事情。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-12-21T18:15:11.623

我通常直接从命令行使用 csc

> C:\Users\Greg>csc /o- /debug+ Test.cs

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-01-14T14:30:25.787

您可以在即时窗口中运行很多东西（调试 >> 窗口 >> 即时）

例如，您可以运行以下命令： System.IO.File.WriteAllText(@"c:\temp\blah.txt", "Hi there!");

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-21T18:19:02.847

还要检查[Snippy](http://csharpindepth.com/Downloads.aspx)和反射器的[Snippy 插件](http://jasonhaley.com/blog/archive/2008/11/23/142521.aspx)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-12-22T02:11:13.503

还有基于 Mono 构建的交互式 C# shell：

[http://mono-project.com/CsharpRepl](http://mono-project.com/CsharpRepl)

这类似于其他语言所具有的（例如，irb 和 Ruby）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-05-24T20:34:21.303

查看[介绍 Microsoft “Roslyn” CTP](http://blogs.msdn.com/b/visualstudio/archive/2011/10/19/introducing-the-microsoft-roslyn-ctp.aspx)。

“C# Interactive”窗口非常适合这一点。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2015-02-02T21:36:51.280

在这里很晚，但是如果您还想与他人共享代码，那么[.NET Fiddle](https://dotnetfiddle.net/)是我迄今为止尝试过的最好的。对于离线解决方案，LINQPad 肯定也会有我的投票权，而不仅仅是 LINQ 查询。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-12-21T21:04:45.960

我只是使用我为此目的定义的临时控制台应用程序项目。我剪掉了主程序中的所有内容，然后去城里。如果我决定需要保留我的原型，我会创建一个新项目并复制到它。因为我一直这样做，所以该项目也总是在我最近的项目列表中。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-12-22T01:30:35.300

我使用批处理文件 (csc.bat)：
C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\csc %1 %2 %3 %4 %5 %6 %7 %8 %9

对于 vb.net，我使用这个批处理文件 (vbc.bat)：
C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\vbc %1 %2 %3 %4 %5 %6 %7 /r:system。 windows.forms.dll /r:system.data.dll /r:system.dll

例如：C:>csc testit.cs

每个都将创建一个 .net .exe 文件。但是，此解决方案对于 Windows 窗体应用程序不是很好。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2019-12-27T12:59:12.713

**RoslynPad** - LINQPad 的轻量级开源替代品。

罗斯林帕德，[https: //roslynpad.net/](https://roslynpad.net/)

GitHub：[https ://github.com/aelij/RoslynPad](https://github.com/aelij/RoslynPad)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-12-21T18:16:28.907

这是我从不喜欢视觉工作室的地方。我从 VB6 中错过的一件事（可能是唯一的一件事）是能够创建一个项目，并在不保存它或任何东西的情况下运行它。就你所说的来说很棒。

我通常至少有一个或两个每种类型的废弃项目（控制台、Winforms 和 Web），我只是轮换使用它们。这样，我并不总是创建新项目。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-12-21T18:20:20.410

你可以看看 C# Scripting。

[C# 脚本](http://www.codeproject.com/KB/cs/cs-script_for_cp.aspx)

这是为了让您在不使用 IDE 的情况下构建快速脚本。

高温高压

骨头

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-12-21T20:56:59.020

我始终保持运行 Express Edition 的副本；这可以在不需要正确的文件位置的情况下执行和调试项目（只要您不点击保存）。这份工作适合我吗...

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-03-31T15:36:55.020

试试 SharpDevelop。它不包含所有内容，但适用于快速示例。您可以打开一个解决方案并轻松换出代码来测试其他内容。在项目属性中，您可以通过组合框选择将解决方案从控制台更改为窗口应用程序。您可以轻松地将您的代码从 C# 转换为 Boo、Python、Ruby 或 VB，或者从这些语言中的任何一种语言转换为另一种语言，从您的源代码开始。因此，如果您在网上寻找问题解决方案，但在 VB 中找不到解决方案 - 但在 C# 中找到了解决方案，您也许可以转换它。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2013-09-13T11:01:59.190

有一个在线的网络 C# 编译器和执行器：http: [//www.compileonline.com/compile_csharp_online.php](http://www.compileonline.com/compile_csharp_online.php)

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2014-10-09T17:49:56.143

您可以尝试使用[ScriptCS](http://scriptcs.net/)。它使用 Roslyn 编译器使用 C# 创建脚本语言。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2021-02-19T00:37:54.183

Visual Studio 应该是更好的选择，但它太重了。一些简单的测试，我经常在这里尝试。

> [https://docs.microsoft.com/zh-cn/learn/modules/csharp-write-first/2-exercise-hello-world](https://docs.microsoft.com/zh-cn/learn/modules/csharp-write-first/2-exercise-hello-world)

或使用 linqpad 和 vscode

> [https://www.linqpad.net/](https://www.linqpad.net/)
> [https://code.visualstudio.com/](https://code.visualstudio.com/)

# c# - LINQ-to-SQL + 一对多 + DataBinding 删除

> ID：384755
> 
> 赞同：10
> 
> 时间：2008-12-21T18:19:45.437
> 
> 标签：c#, linq-to-sql, entityset

我使用 LINQ-to-SQL 从具有一对多关系的两个表的数据库中加载数据（一个配方有许多成分）。

我加载一个配方，LINQ 将成分对象检索到一个绑定到列表框的实体集中。

如果我想从食谱中删除一些成分，我会收到“尝试删除食谱和成分之间的关​​系。但是，关系的一个外键 (Ingredient.RecipeID) 不能设置为空。

我通过将“DeleteOnNull="true"' 添加到 DBML 文件中，使用众所周知的解决方案解决了这个问题。但添加此设置仅在我们删除从数据库中检索到的成分对象时才消除问题。

问题在于在代码中创建的成分对象（添加到配方中）并添加到成分的 EntitySet 集合中，然后在调用 SubmitUpdates 之前删除。然后，同样的异常再次发生。这通常发生在一个新的、未保存的食谱上，当用户向其中添加成分时，犯了一个错误并从食谱中删除了一种成分。我将 DeleteOnNull 添加到 DBML 中的两个 'Association Name="Recipe_Ingredient"' 行。

我应该如何删除这些对象？我目前看到的唯一解决方案是，我会将成分加载到不在 DataContext 下的集合中，然后在保存时，从配方中删除所有成分，然后从该缓存中再次添加。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-23T05:21:23.197

```
 try
        {
            // Needed for existing records, but will fail for new records
            yourLINQDataContext.Ingredients.DeleteOnSubmit(ingredient);
        }
        catch (Exception)
        {
            // Swallow
        }

        yourRecipeObject.Ingredients.Remove(ingredient); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-23T05:51:50.297

几天前，当我问“[如何为带有确定/取消按钮的数据绑定 WPF 对话框设计支持数据类型？](https://stackoverflow.com/questions/347226/how-do-i-design-backing-data-types-for-a-databound-wpf-dialog-with-okcancel-but) ”时，您似乎正在寻找我自己正在寻找的东西。

答案是来自 Paul Stovell 的一篇有趣的文章，描述了一个用于 Linq to Sql[的示例 IEditable 适配器。](http://www.paulstovell.com/blog/runtime-ui-binding-behavior-ieditableobject-adapter)这将让您以通用方式创建所需的“应用/取消”语义，而无需通过完整的自定义编写层将自己与底层 ORm 生成的类完全分离。

总的来说，这是一个非常巧妙的技巧，它基本上可以让你回避你现在正在解决的问题。:)

另一方面，我很好奇为什么你的配方与成分的关系是 1:n 而不是 m:n。是为了简单吗？我在很多食谱中都使用大蒜。:)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-05-31T10:34:05.570

```
// Create new entities
Cart c = new Cart();
CartEntry ce = new CartEntry();
ce.Cart = c;

// Delete the entry
c.CartEntries.Remove(ce);
dc.Cartentries.Attach(ce);
dc.CartEntries.DeleteOnSubmit(ce);

// Insert the cart into database
dc.Carts.InsertOnSubmit(c);
dc.SubmitChanges(); 
```

问题解释：实体 c 和 ce 都与数据上下文无关 - 它们没有被跟踪。EntitySet.Remove()（第一个删除行）只删除 c 和 ce 之间的关系。虽然 c 可以在没有关联的购物车条目的情况下存在，但由于外键约束，ce 不能在没有关联的购物车的情况下存在。在向数据库提交更改时，断开连接的 ce 也会被处理，从而导致约束违反和异常。

为了摆脱未跟踪和断开连接的购物车条目，您需要将其附加到您的数据上下文（使其被跟踪），然后将其标记为在提交时删除。您提交更改的那一刻，购物车条目将被正确删除，不会导致异常。

有关该问题的更多详细信息，请查看：http: [//msdn.microsoft.com/en-us/library/bb546187%28v=VS.100%29.aspx](http://msdn.microsoft.com/en-us/library/bb546187%28v=VS.100%29.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-09T11:29:14.500

我遇到了类似的问题，作为一种解决方法，我需要调用 DataContext.GetChanges()，然后一切似乎又开始流行了 :)

另一个问题可能是您绑定到列而不是实体属性，因此引用集合没有更新（已经由其他人声明，但强制执行该事实）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-20T00:42:29.580

我有完全相同的问题。我有一个父/子层次结构，当添加和删除子实体而不保存到数据库时，我收到“尝试删除关系”异常。

我发现只有在保存之前将子对象的对象样式属性设置为另一个 linq-sql 实体时才会出现此问题。例如

**1.这会产生错误**

```
 RetailAccountCustomerCard racc = new RetailAccountCustomerCard();

 Card addedCard = _idc.Cards.Where(c => c.CardId == card.CardId).ToList().First();

 racc.Card = addedCard;

 this.CurrentCustomer.RetailAccountCardsBindingList.Add(racc); 

 // Some code triggered by the user before saving to the db

 CurrentCustomer.RetailAccountCardsBindingList.Remove(racc); 
```

**2.这不会产生错误**

```
 RetailAccountCustomerCard racc = new RetailAccountCustomerCard();

 racc.CardId = card.CardId;  // note that I have set the Id property not the object

 this.CurrentCustomer.RetailAccountCardsBindingList.Add(racc); 

 // Some code triggered by the user before saving to the db

 CurrentCustomer.RetailAccountCardsBindingList.Remove(racc); 
```

奇怪的是，1\. 中出现的错误指定问题与关系有关，它位于 RetailAccountCustomerCard 的 RetailAccountCustomerId 属性上。**它**与我添加的 Card 对象无关。似乎简单地设置新实体的**任何对象属性都会触发问题。**

注意。示例 1 在保存方面工作正常，只有在保存之前删除新实体时才会导致问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-23T02:44:47.990

您需要将保存代码与 GUI 中的事件分离，似乎您有点急于在尘埃落定之前将东西保存到数据库中，并且您正在排队并从数据库中删除从未到达那里的东西首先，如果您能确定用户“提交”他们的更改的时间点，并在那个时候处理 GUI 的全部条件，那将是最好的——这将为您节省一堆意大利面条式代码。

我也很想知道您的实体是否具有自动编号 ID，或者您是否正在使用其他一些 ID 机制。您可能正在向数据库发送 DELETE 以获取尚未提交的成分记录，如果这些记录包含 NULL ID，我认为 linq 可能会变得讨厌。

您是否将文本编写器连接到 DataContext.Log 以查看在您获得异常之前生成了哪些类型的 SQL？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-23T07:04:40.150

谢谢你的回答，我会检查帖子，看看我能做什么。我必须说我很惊讶甚至看到这个问题发生，对我来说似乎很自然可以将记录添加到 LINQ 提供的数据“缓存”，然后决定删除其中一些然后提交。更改跟踪应该能够处理这个问题。我刚从 LINQ 开始，所以我可能在代码的某个地方犯了一个愚蠢的错误（不会是第一个）。

另一方面：你说得对，大蒜可以属于许多食谱（不是我的鸡尾酒食谱想的！）。我实际上是用文章对象/表来建模的。但是对于食谱，您需要数量。因此，在我的模型中，您有一个包含 1:n 成分的食谱，每个成分都有一个数量、一个 1:1 链接到一篇文章（它有一个名称、一个酒精含量和一些数据来建立一个可互换的层次结构）和一个1:1 链接到一个单位（使数量有意义）。所以从某种意义上说，成分表在食谱和文章之间建立了 M:N 关系，同时为每个单独的链接对添加了一些额外的信息。

# python - 如何将 PIL 图像转换为 numpy 数组？

> ID：384759
> 
> 赞同：376
> 
> 时间：2008-12-21T18:21:32.313
> 
> 标签：python, image, numpy, python-imaging-library, numpy-ndarray

好吧，我正在尝试将 PIL 图像对象来回转换为 numpy 数组，这样我就可以进行比 PIL`PixelAccess`对象允许的更快的逐像素转换。我已经想出了如何通过以下方式将像素信息放置在有用的 3D numpy 数组中：

```
pic = Image.open("foo.jpg")
pix = numpy.array(pic.getdata()).reshape(pic.size[0], pic.size[1], 3) 
```

但是在我完成了所有很棒的转换之后，我似乎无法弄清楚如何将它加载回 PIL 对象中。我知道这种**`putdata()`**方法，但似乎无法让它发挥作用。

* * *

## 回答 #1

> 赞同：386
> 
> 时间：2008-12-21T20:46:21.473

你不是说到底是如何`putdata()`不行为。我假设你在做

```
>>> pic.putdata(a)
Traceback (most recent call last):
  File "...blablabla.../PIL/Image.py", line 1185, in putdata
    self.im.putdata(data, scale, offset)
SystemError: new style getargs format but argument is not a tuple 
```

这是因为`putdata`需要一个元组序列，而你给它一个 numpy 数组。这

```
>>> data = list(tuple(pixel) for pixel in pix)
>>> pic.putdata(data) 
```

会工作，但速度很慢。

从 PIL 1.1.6 开始，[在图像和 numpy 数组之间进行转换的“正确”方式](http://effbot.org/zone/pil-changes-116.htm)很简单

```
>>> pix = numpy.array(pic) 
```

尽管结果数组的格式与您的格式不同（在这种情况下为 3-d 数组或行/列/rgb）。

然后，在对数组进行更改后，您应该可以`pic.putdata(pix)`使用`Image.fromarray(pix)`.

* * *

## 回答 #2

> 赞同：275
> 
> 时间：2009-07-08T02:33:17.417

`I`作为数组打开：

```
>>> I = numpy.asarray(PIL.Image.open('test.jpg')) 
```

做一些事情`I`，然后将其转换回图像：

```
>>> im = PIL.Image.fromarray(numpy.uint8(I)) 
```

资料来源：[使用 FFT、Python 过滤 numpy 图像](http://barnesc.blogspot.com/2007/09/filter-numpy-images-with-fft-python.html)

[如果您出于某种原因要明确执行此操作，则在此页面](http://bradmontgomery.blogspot.com/2007/12/computing-correlation-coefficients-in.html)上的 correlation.zip 中有使用 getdata() 的 pil2array() 和 array2pil() 函数。

* * *

## 回答 #3

> 赞同：106
> 
> 时间：2017-06-17T16:41:07.043

我在 Python 3.5 中使用 Pillow 4.1.1（PIL 的继任者）。Pillow 和 numpy 之间的转换很简单。

```
from PIL import Image
import numpy as np
im = Image.open('1.jpg')
im2arr = np.array(im) # im2arr.shape: height x width x channel
arr2im = Image.fromarray(im2arr) 
```

需要注意的一件事是 Pillow-style`im`是 column-major 而 numpy-style`im2arr`是 row-major。但是，该功能`Image.fromarray`已经考虑到了这一点。也就是说，`arr2im.size == im.size`在`arr2im.mode == im.mode`上面的例子中。

在处理转换后的 numpy 数组时，我们应该注意 HxWxC 数据格式，例如进行转换`im2arr = np.rollaxis(im2arr, 2, 0)`或`im2arr = np.transpose(im2arr, (2, 0, 1))`转换为 CxHxW 格式。

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2016-06-07T09:18:59.997

您需要以这种方式将图像转换为 numpy 数组：

```
import numpy
import PIL

img = PIL.Image.open("foo.jpg").convert("L")
imgarr = numpy.array(img) 
```

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2020-05-30T17:07:47.443

转换**`Numpy to PIL`**图像和**`PIL to Numpy`**

```
import numpy as np
from PIL import Image

def pilToNumpy(img):
    return np.array(img)

def NumpyToPil(img):
    return Image.fromarray(img) 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2017-02-03T20:32:16.080

我今天使用的示例：

```
import PIL
import numpy
from PIL import Image

def resize_image(numpy_array_image, new_height):
    # convert nympy array image to PIL.Image
    image = Image.fromarray(numpy.uint8(numpy_array_image))
    old_width = float(image.size[0])
    old_height = float(image.size[1])
    ratio = float( new_height / old_height)
    new_width = int(old_width * ratio)
    image = image.resize((new_width, new_height), PIL.Image.ANTIALIAS)
    # convert PIL.Image into nympy array back again
    return array(image) 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-02-15T07:00:21.403

如果您的图像以 Blob 格式存储（即在数据库中），您可以使用 Billal Begueradj 解释的相同技术将图像从 Blob 转换为字节数组。

就我而言，我需要将图像存储在 db 表的 blob 列中：

```
def select_all_X_values(conn):
    cur = conn.cursor()
    cur.execute("SELECT ImageData from PiecesTable")    
    rows = cur.fetchall()    
    return rows 
```

然后我创建了一个辅助函数来将我的数据集更改为 np.array：

```
X_dataset = select_all_X_values(conn)
imagesList = convertToByteIO(np.array(X_dataset))

def convertToByteIO(imagesArray):
    """
    # Converts an array of images into an array of Bytes
    """
    imagesList = []

    for i in range(len(imagesArray)):  
        img = Image.open(BytesIO(imagesArray[i])).convert("RGB")
        imagesList.insert(i, np.array(img))

    return imagesList 
```

在此之后，我能够在我的神经网络中使用 byteArrays。

```
plt.imshow(imagesList[0]) 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2019-05-25T14:56:25.640

```
def imshow(img):
    img = img / 2 + 0.5     # unnormalize
    npimg = img.numpy()
    plt.imshow(np.transpose(npimg, (1, 2, 0)))
    plt.show() 
```

您可以通过在挤压出特征（非标准化）后将图像解析为 numpy() 函数来将图像转换为 numpy

# .net - Ironpython 是否有替换 pywin32 扩展的库？

> ID：384761
> 
> 赞同：1
> 
> 时间：2008-12-21T18:22:44.103
> 
> 标签：.net, com, ironpython

我有一些使用 pywin32 扩展的旧 python 代码。从 .net 开始，我想将它移植到 Ironpython。

旧的 python 代码使用诸如 pythoncom.com_error、pywintypes.Time 之类的东西，并接口一个实现 IDispatch 接口的 COM 模块。

Ironpython 的 .net 库是否具有与 COM 模块通信所需的一切？具体来说，它有什么东西可以代替 com_error 和 Time 吗？

谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T21:55:54.953

回答我自己的帖子.. :-)

1.  com_error 可以替换为 System.Runtime.InteropServices.COMException
2.  pywintypes.Time 可以替换为 System.DateTime，（IDispatch 接口中的 DATE）

不过，如果有人知道有关 IronPython、COM 互操作性和从 pywin32 迁移到 .net 的任何好的文档，请回复..

# mysql - MySQL中的表是空集

> ID：384762
> 
> 赞同：2
> 
> 时间：2008-12-21T18:23:38.610
> 
> 标签：mysql, database, mysql-workbench

我使用 MySQL Workbench 生成一个数据库，现在我使用以下命令将它插入到命令行客户端：

> mysql> . C:\Documents and Settings\kdegroote\My Documents\School\2008-2009\ICT2\Gegevensbanken\Labo\Hoofdstuk 3 oef 6\pizzasecondtry.sql

由于某种原因，最后一张桌子不会被接受。“无法创建表”是错误消息。

我手动将数据编辑为基本相同，只是没有 Workbench 添加的特殊选项，它就像那样工作。

我一直在研究原版，但我不明白为什么它不会显示表格。所以我想知道这里是否有人可以看看它。也许其他人会看到我忽略的内容。

```
SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL';

CREATE SCHEMA IF NOT EXISTS `PizzaDelivery` DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;
USE `PizzaDelivery`;

CREATE TABLE IF NOT EXISTS `PizzaDelivery`.`Visitors` (
  `visitor_id` INT NOT NULL AUTO_INCREMENT ,
  `name` VARCHAR(45) NOT NULL ,
  `adres` VARCHAR(45) NOT NULL ,
  `telephone` MEDIUMBLOB NOT NULL ,
  `email` VARCHAR(45) NOT NULL ,
  PRIMARY KEY (`visitor_id`))ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS `PizzaDelivery`.`Employees` (
  `employee_id` INT NOT NULL AUTO_INCREMENT ,
  `name` VARCHAR(45) NOT NULL ,
  PRIMARY KEY (`employee_id`))ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS `PizzaDelivery`.`Orders` (
  `order_id` INT NOT NULL AUTO_INCREMENT ,
  `pizza` VARCHAR(45) NOT NULL ,
  `extra` VARCHAR(45) NULL ,
  `kind` VARCHAR(45) NOT NULL ,
  `amount` VARCHAR(45) NOT NULL ,
  `visitor_id` INT NOT NULL ,
  `employee_id` INT NOT NULL ,
  `order_time` TIME NOT NULL ,
  PRIMARY KEY (`order_id`) ,
  INDEX `visitor_id` (`visitor_id` ASC) ,
  INDEX `employee_id` (`employee_id` ASC) ,
  CONSTRAINT `visitor_id`
    FOREIGN KEY (`visitor_id` )
    REFERENCES `PizzaDelivery`.`Visitors` (`visitor_id` )
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `employee_id`
    FOREIGN KEY (`employee_id` )
    REFERENCES `PizzaDelivery`.`Employees` (`employee_id` )
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)ENGINE=InnoDB;

CREATE TABLE IF NOT EXISTS `PizzaDelivery`.`Deliveries` (
  `employee_id` INT NOT NULL ,
  `order_id` INT NOT NULL ,
  `voertuig_id` INT NOT NULL ,
  `deliverytime` TIME NOT NULL ,
  PRIMARY KEY (`employee_id`, `order_id`) ,
  INDEX `employee_id` (`employee_id` ASC) ,
  INDEX `order_id` (`order_id` ASC) ,
  CONSTRAINT `employee_id`
    FOREIGN KEY (`employee_id` )
    REFERENCES `PizzaDelivery`.`Employees` (`employee_id` )
    ON DELETE NO ACTION
    ON UPDATE NO ACTION,
  CONSTRAINT `order_id`
    FOREIGN KEY (`order_id` )
    REFERENCES `PizzaDelivery`.`Orders` (`order_id` )
    ON DELETE NO ACTION
    ON UPDATE NO ACTION)ENGINE=InnoDB;

SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-21T20:07:00.603

您通常可以从 InnoDB 错误中获取更多信息，如下所示：

```
mysql> SHOW ENGINE INNODB STATUS; 
```

输出很长，但在状态输出中我看到了这个：

```
------------------------
LATEST FOREIGN KEY ERROR
------------------------
081221 12:02:36 Error in foreign key constraint creation 
for table `pizzadelivery/deliveries`.
A foreign key constraint of name `pizzadelivery/employee_id`
already exists. 
```

问题是`Deliveries`和`Orders`表都声明了一个名为 的外键约束`employee_id`。

约束名称在给定数据库中的所有表中必须是唯一的。“errno: 121”是一个 InnoDB 错误代码，表示重复键错误。在这种情况下，不满足约束名称的唯一性。

如果您只是更改声明的约束的名称，则可以解决此问题并仍然保留外键约束，例如：

```
CREATE TABLE IF NOT EXISTS `PizzaDelivery`.`Deliveries` (
  . . .
  CONSTRAINT `employee_id2`
    FOREIGN KEY (`employee_id` )
  . . . 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T18:28:14.483

`use PizzaDelivery`在运行 show tables 之前尝试。您在`PizzaDelivery`架构中创建了表，但您可能连接了不同的默认架构。默认模式是 mysql 命令行客户端的参数：

```
$ mysql -h <db-host> -u <username> -p <schema-name> 
```

（注意：-p 表示在未给出参数时提示输入密码，您通常不应该这样做，因为参数会显示在 ps 输出中，并且还会在 shell 历史记录中保存到磁盘。所有命令行参数都是可选的。 )

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T19:02:07.753

问题解决了。

我在这里解决了我的问题，而不是偶然。问题似乎是“交付”表中的约束。

这两个主键同时是外键，如果你想约束它们，就会产生错误。

所以我只是忽略了约束，一切正常。

# api - 与 Google Reader 同步时如何跳过已知条目？

> ID：384771
> 
> 赞同：7
> 
> 时间：2008-12-21T18:30:48.893
> 
> 标签：api, synchronization, google-reader

为了将离线客户端写入 Google Reader 服务，我想知道如何最好地与该服务同步。

似乎还没有官方文档，到目前为止我发现的最好的来源是：[http ://code.google.com/p/pyrfeed/wiki/GoogleReaderAPI](http://code.google.com/p/pyrfeed/wiki/GoogleReaderAPI)

现在考虑一下：使​​用上面的信息，我可以下载所有未读项目，我可以指定要下载的项目数量，并使用 atom-id 我可以检测到我已经下载的重复条目。

我缺少的是一种指定我只想要自上次同步以来的更新的方法。我可以说给我 10 个（参数*n* =10）最新（参数*r* =d）条目。如果我指定参数*r* =o（日期升序），那么我也可以指定参数*ot* =[last time of sync]，但只有这样，当我只想读取一些项目而不是所有项目时，升序没有任何意义项目。

知道如何在不再次下载所有项目并拒绝重复项的情况下解决该问题吗？不是一种非常经济的投票方式。

有人提议我可以指定我只想要未读的条目。但要使该解决方案以 Google Reader 不再提供此条目的方式工作，我需要将它们标记为已读。反过来，这意味着我需要在客户端上保持自己的已读/未读状态，*并且*当用户登录到 Google Reader 的在线版本时，这些条目已经被标记为已读。这对我不起作用。

干杯，马里亚诺

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-21T03:16:05.073

要获取最新条目，请使用标准 from-newest-date-descending 下载，该下载将从最新条目开始。您将在 XML 结果中收到一个“继续”标记，如下所示：

```
<gr:continuation>CArhxxjRmNsC</gr:continuation>` 
```

浏览结果，找出任何新的东西给你。你应该发现要么所有的结果都是新的，要么所有的结果都是新的，然后你已经知道了。

在后一种情况下，你已经完成了，但在前一种情况下，你需要找到比你已经检索到的旧的新东西。通过使用 continuation 来获取从刚刚检索到的集合中的最后一个结果之后开始的结果，方法是在 GET 请求中将其作为`c`参数传递，例如：

```
http://www.google.com/reader/atom/user/-/state/com.google/reading-list?c=CArhxxjRmNsC 
```

以这种方式继续，直到你拥有一切。

该`n`参数是要检索的项目数的计数，可以很好地使用它，您可以随时更改它。如果检查频率是用户设置的，因此可能非常频繁或非常罕见，您可以使用自适应算法来减少网络流量和处理负载。最初请求少量最新条目，比如五个（添加`n=5`到您的 GET 请求的 URL）。如果所有都是新的，在下一个使用延续的请求中，请求更大的数字，比如 20。如果这些仍然是新的，要么提要有很多更新，要么已经有一段时间了，所以继续以 100 人为一组。

* * *

但是，如果我在这里错了，请纠正我，您还想知道，在您下载一个项目后，它的状态是否会由于使用 Google 阅读器界面阅读它的人而从“未读”变为“已读”。

一种方法是：

1.  更新在 google 上已在本地读取的任何项目的状态。
2.  检查并保存提要的未读计数。（您希望在下一步之前执行此操作，以确保在下载最新项目和检查阅读计数之间没有新项目到达。）
3.  下载最新项目。
4.  计算您的阅读次数，并将其与谷歌的进行比较。如果提要的阅读次数比您计算的要高，那么您就知道在 google 上已经阅读了某些内容。
5.  如果在 google 上已经阅读过某些内容，请开始下载已读项目并将它们与您的未读项目数据库进行比较。您会发现一些 google 说已读取的项目，而您的数据库声明未读；更新这些。继续这样做，直到你发现这些项目的数量等于你的阅读次数和谷歌的阅读次数之间的差异，或者直到下载变得不合理。
6.  如果您没有找到所有已阅读的项目，*c'est la vie*；将剩余的数字记录为“未找到的未读”总数，您还需要在下次计算您认为未读的本地数字时将其包括在内。

如果用户订阅了很多不同的博客，他也很可能对它们进行了广泛的标记，所以你可以在每个标签的基础上做这件事，而不是针对整个提要，这应该有助于减少数据量，因为对于用户没有在谷歌阅读器上阅读任何新内容的标签，您无需进行任何转移。

整个方案也可以应用于其他状态，例如已加星标或未加星标。

现在，正如你所说，这

> ...这意味着我需要在客户端上保持自己的已读/未读状态，并且当用户登录到 Google Reader 的在线版本时，这些条目已经被标记为已读。这对我不起作用。

真是的。保持本地已读/未读状态（因为无论如何您都保留了所有项目的数据库）或在谷歌中标记已读项目（API 支持）似乎都非常困难，那么为什么这对您不起作用？

* * *

然而，还有一个障碍：用户可能会在谷歌上将已读的内容标记为未读。这给系统带来了一些麻烦。我的建议是，如果你真的想解决这个问题，假设用户一般只会接触最近的东西，每次下载最新的几百个左右的项目，检查所有的状态他们。（这并不是*那么*糟糕；下载 100 个项目让我从 300KB 的 0.3 秒到 2.5MB 的 2.5 秒，尽管在非常快的宽带连接上。）

同样，如果用户有大量订阅，他也可能有相当多的标签，所以在每个标签的基础上这样做会加快速度。实际上，我建议您不仅要按标签检查，还要分散检查，每分钟检查一个标签，而不是每 20 分钟检查一次。如果您想降低带宽，您还可以对旧项目的状态更改进行这种“大检查”，而不是进行“新内容”检查，可能每隔几个小时检查一次。

这有点占用带宽，主要是因为您需要从 Google 下载全文来查看状态。不幸的是，在我们可用的 API 文档中，我看不到任何解决方法。我唯一真正的建议是尽量减少对非新项目的状态检查。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-15T12:10:47.730

Google API 尚未发布，此时此答案可能会更改。

目前，您必须调用 API 并忽略已下载的项目，正如您所说，这并不是非常有效，因为您每次都将重新下载项目，即使您已经拥有它们。

# iphone - 如何找出 Xcode 调试器（适用于 iPhone）中抛出的异常？

> ID：384775
> 
> 赞同：30
> 
> 时间：2008-12-21T18:31:44.197
> 
> 标签：iphone, xcode, debugging, exception

我正在从 Erica Sadun 的 The iPhone Developer's Cookbook 学习 iPhone 编程。当我在模拟器中按照从第 81 页开始的温度转换示例中的步骤运行我创建的应用程序时，它由于未捕获的异常而终止。（有关我发布到 iPhoneSDK Google Group 的问题，请参阅[http://groups.google.com/group/iphonesdk/browse_frm/thread/6f44a90fdb8da28a?hl=en](http://groups.google.com/group/iphonesdk/browse_frm/thread/6f44a90fdb8da28a?hl=en)。）

从我的 main() 调用 UIApplicationMain() 后抛出异常。如果我查看调试器中的堆栈跟踪，我看到的只是（当然）汇编。我如何找出引发了什么样的异常？

**更新**：
从调试器控制台了解异常的详细信息足以帮助我解决问题。（请参阅[http://groups.google.com/group/iphonesdk/browse_frm/thread/6f44a90fdb8da28a?hl=en](http://groups.google.com/group/iphonesdk/browse_frm/thread/6f44a90fdb8da28a?hl=en)。）我确认我可以在 上设置一个符号断点`objc_exception_throw`，但我没有查看回溯是否来自会有帮助的。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-12-21T18:51:15.327

设置断点`objc_exception_throw`并通过 Debug 而不是 Run 运行您的应用程序

澄清一下，当你得到一个没有断点的异常时，你实际看到的总是相同的堆栈跟踪——它是未捕获的异常处理程序。异常的类型记录到运行控制台，但如果您想查看引发异常的位置的回溯，这就是断点的用途。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-09-29T08:44:39.967

在新的 Xcode（至少从 v4.5 开始）中，您可以通过执行以下操作轻松捕获所有异常：

1.  调出断点导航器（⌘6）
2.  点击左下角的+
3.  添加异常断点

我认为以上内容与`objc_exception_throw`. [http://samwize.com/2012/09/26/xcode-4-dot-5-tips-and-tricks/](http://samwize.com/2012/09/26/xcode-4-dot-5-tips-and-tricks/)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-02-14T14:45:06.307

[http://ijoshsmith.com/2011/11/28/debugging-exceptions-in-xcode-4-2/](http://ijoshsmith.com/2011/11/28/debugging-exceptions-in-xcode-4-2/)

与samewize 的解决方案相同，但也展示了如何在所有项目中默认显示此断点（右键单击断点，将断点移动到，用户）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-02-04T06:45:22.880

正如 Kevin 所回答的，通过在`objc_exception_throw`.

如果您使用的是 Xcode 4.2，您可以通过转到 Breakpoint Navigator > 单击左下角的添加图标 > 添加符号断点 > 输入`objc_exception_throw`符号 > 完成来添加此符号断点。

# c# - 将 XAML 中的可见性绑定到可见性属性

> ID：384776
> 
> 赞同：7
> 
> 时间：2008-12-21T18:32:30.607
> 
> 标签：c#, xaml, binding, visibility

我在 Internet 上看到了很多将布尔值绑定到 XAML 中控件的 Visibility 属性的示例。大多数好的示例都使用 BooleanToVisibiliy 转换器。

我只想将控件上的 Visible 属性设置为绑定到代码隐藏中的 System.Windows.Visibility 属性，但它似乎不想工作。

这是我的 XAML：

```
<Grid x:Name="actions" Visibility="{Binding Path=ActionsVisible, UpdateSourceTrigger=PropertyChanged}" /> 
```

这是该属性的代码：

```
private Visibility _actionsVisible;
public Visibility ActionsVisible
{
   get
   {
      return _actionsVisible;
   }
   set
   {
      _actionsVisible = value;
   }
} 
```

在 Window 的构造函数中，我也有这个调用：

```
base.DataContext = this; 
```

当我更新 ActionsVisible 或 this.actions.Visibility 时，状态不会转移。有什么想法可能会出错吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-21T21:06:12.370

将您的属性更改为 DependencyProperty。这将为您处理更新。

```
 public Visibility ActionsVisible
    {
        get { return (Visibility)GetValue(ActionsVisibleProperty); }
        set { SetValue(ActionsVisibleProperty, value); }
    }

    // Using a DependencyProperty as the backing store for ActionsVisible.  This enables animation, styling, binding, etc...
    public static readonly DependencyProperty ActionsVisibleProperty =
        DependencyProperty.Register("ActionsVisible", typeof(Visibility), typeof(FooForm)); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-21T18:39:21.137

我认为问题在于 WPF 无法知道您的 ActionsVisible 属性已更改，因为您没有通知这一事实。

您的类将需要实现 INotifyPropertyChanged，然后在 ActionsVisible 的 set 方法中，您需要使用 ActionsVisible 作为已更改的属性名称来触发 PropertyChanged 事件。

希望这可以帮助...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-31T12:45:33.837

写：`NotifyPropertyChanged("ActionsVisible")`

# drupal - Drupal 如何为匿名用户查看附加到节点的文档

> ID：384780
> 
> 赞同：0
> 
> 时间：2008-12-21T18:35:45.093
> 
> 标签：drupal

我正在完成一个 Drupal 站点，并在我的一个页面节点上附加了一个 word 文档。我希望匿名的人能够下载它，但他们甚至看不到文档。我以登录用户的身份进行。

有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-21T20:03:58.393

您需要授予匿名用户查看上传文件的权限。我猜你使用了上传模块。权限页面位于 /admin/user/permissions 组“上传模块”下，您正在寻找“查看上传的文件”。

-埃德

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-22T09:22:22.103

假设您只想为匿名用户启用这个特定文件，您可以在不触及权限的情况下执行此操作，这会影响您的整个站点。

假设您将下载配置为“公共”而不是“私人”，最简单的方法是在页面节点中添加指向文档的链接，例如 <a href="/files/myfile.doc">Download myfile.doc </a>

# c# - 如何从资源中获取文件作为流？（。网）

> ID：384789
> 
> 赞同：3
> 
> 时间：2008-12-21T18:45:31.233
> 
> 标签：c#, .net, resources

我在用于验证收到的 xml 消息的资源（xsd 文件）中有几个文件。我使用的资源文件名为**AppResources.resx**，它包含一个名为**clientModels.xsd**的文件。当我尝试使用这样的文件时：AppResources.clientModels，我得到一个包含文件内容的字符串。我想改为流。我不希望使用 assembly.GetManifestResourceStream，因为我对它有过不好的体验（使用这些流使用 SharpZipLib 归档文件由于某种原因不起作用）。还有其他方法吗？我听说过 ResourceManager - 有什么可以帮助我的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T19:00:31.750

也许你能把你得到的字符串输入 System.IO.StringReader 吗？这可能会做你想要的。您可能还想查看 MemoryStream。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-30T21:50:28.920

这是链接中的代码

```
//Namespace reference
using System;
using System.Resources;

#region ReadResourceFile
/// <summary>
/// method for reading a value from a resource file
/// (.resx file)
/// </summary>
/// <param name="file">file to read from</param>
/// <param name="key">key to get the value for</param>
/// <returns>a string value</returns>
public string ReadResourceValue(string file, string key)
{
    //value for our return value
    string resourceValue = string.Empty;
    try
    {
        // specify your resource file name 
        string resourceFile = file;
        // get the path of your file
        string filePath = System.AppDomain.CurrentDomain.BaseDirectory.ToString();
        // create a resource manager for reading from
        //the resx file
        ResourceManager resourceManager = ResourceManager.CreateFileBasedResourceManager(resourceFile, filePath, null);
        // retrieve the value of the specified key
        resourceValue = resourceManager.GetString(key);
    }
    catch (Exception ex)
    {
        Console.WriteLine(ex.Message);
        resourceValue = string.Empty;
    }
    return resourceValue;
}
#endregion 
```

我没有写它来自的代码

[http://www.dreamincode.net/code/snippet1683.htm](http://www.dreamincode.net/code/snippet1683.htm)

高温高压

骨头

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-25T23:30:54.460

我有一个作为资源加载的 zip 文件，直接从命名空间引用它会给我字节，而不是字符串。在资源设计器中右键单击您的文件，然后将文件类型从文本更改为二进制。然后您将获得一个字节数组，您可以将其加载到 MemoryStream 中。

# recursion - foldr 与 foldl（或 foldl'）的含义

> ID：384797
> 
> 赞同：164
> 
> 时间：2008-12-21T18:53:15.197
> 
> 标签：recursion, functional-programming, fold, haskell

首先，我正在阅读的*Real World Haskell*`foldl`说永远不要使用，而是使用`foldl'`. 所以我相信它。

但我不清楚何时使用`foldr`vs. `foldl'`. 虽然我可以看到它们在我面前展示的不同工作方式的结构，但我太愚蠢了，无法理解什么时候“哪个更好”。我想在我看来，使用哪个并不重要，因为它们都产生相同的答案（不是吗？）。事实上，我之前对这种构造的经验来自 Ruby`inject`和 Clojure 的`reduce`，它们似乎没有“左”和“右”版本。（附带问题：他们使用哪个版本？）

任何可以帮助像我这样聪明的人的见解将不胜感激！

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2008-12-21T20:41:41.593

`foldr f x ys`where的递归`ys = [y1,y2,...,yk]`看起来像

```
f y1 (f y2 (... (f yk x) ...)) 
```

而 for 的递归`foldl f x ys`看起来像

```
f (... (f (f x y1) y2) ...) yk 
```

这里的一个重要区别是，如果 的结果`f x y`可以仅使用 的值来计算`x`，则`foldr`不需要检查整个列表。例如

```
foldr (&&) False (repeat False) 
```

返回`False`而

```
foldl (&&) False (repeat False) 
```

永不终止。（注意：`repeat False`创建一个无限列表，其中每个元素都是`False`。）

另一方面，`foldl'`是尾递归和严格的。如果您知道无论如何都必须遍历整个列表（例如，将列表中的数字相加），那么`foldl'`空间（可能还有时间）效率比`foldr`.

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2010-01-30T22:39:59.763

`foldr`看起来像这样：

![右折叠可视化](https://imgur.com/XHakM.png)

`foldl`看起来像这样：

![左折叠可视化](https://imgur.com/oqckX.png)

背景：[折叠](http://www.haskell.org/haskellwiki/Fold)在 Haskell wiki 上

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2008-12-21T19:01:02.013

它们的语义不同，因此您不能只交换`foldl`和`foldr`。一个从左侧折叠元素，另一个从右侧折叠。这样，操作符就会以不同的顺序被应用。这对所有非关联操作都很重要，例如减法。

[Haskell.org](http://haskell.org)有一篇关于这个主题的有趣[文章](http://haskell.org/haskellwiki/Foldr_Foldl_Foldl%27)。

* * *

## 回答 #4

> 赞同：23
> 
> 时间：2008-12-21T19:01:26.710

简而言之，`foldr`当累加器函数在其第二个参数上是惰性的时会更好。在 Haskell wiki 的[Stack Overflow 上](http://www.haskell.org/haskellwiki/Stack_overflow)阅读更多内容（双关语）。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2008-12-28T13:08:08.023

`foldl'`对于 99% 的用途来说，首选的原因是`foldl`它可以在大多数用途中在恒定空间中运行。

取函数`sum = foldl['] (+) 0`。使用时`foldl'`，会立即计算总和，因此应用于`sum`无限列表将永远运行，并且很可能在恒定空间中（如果您使用 s、s、s.s 之类的`Int`东西`Double`，如果数字变得大于)。`Float``Integer``maxBound :: Int`

有了`foldl`，就会建立一个 thunk （就像如何获得答案的配方，可以稍后评估，而不是存储答案）。这些 thunk 会占用大量空间，在这种情况下，评估表达式要比存储 thunk 好得多（导致堆栈溢出……并导致……哦，没关系）

希望有帮助。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2009-05-17T17:21:32.483

顺便说一句，Ruby`inject`和 Clojure`reduce`是`foldl`（或者`foldl1`，取决于您使用的版本）。通常，当一种语言只有一种形式时，它是左折叠，包括 Python 的`reduce`、Perl 的`List::Util::reduce`、C++ 的`accumulate`、C# 的`Aggregate`、Smalltalk 的`inject:into:`、PHP 的`array_reduce`、Mathematica 的`Fold`等。Common Lisp`reduce`默认为左折叠，但也有右折叠的选项。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-05-17T17:44:47.420

正如[Konrad](https://stackoverflow.com/questions/384797/implications-of-foldr-vs-foldl-or-foldl/384802#384802)所指出的，它们的语义是不同的。他们甚至没有相同的类型：

```
ghci> :t foldr
foldr :: (a -> b -> b) -> b -> [a] -> b
ghci> :t foldl
foldl :: (a -> b -> a) -> a -> [b] -> a
ghci> 
```

例如，列表附加运算符 (++) 可以用`foldr`as来实现

```
(++) = flip (foldr (:)) 
```

尽管

```
(++) = flip (foldl (:)) 
```

会给你一个类型错误。

# php - Mac 上的 PDO MySQL 驱动程序

> ID：384809
> 
> 赞同：9
> 
> 时间：2008-12-21T19:06:50.210
> 
> 标签：php, mysql, pdo, driver

我有一台安装了自定义 PHP 5 的 Mac，它是大约一年前构建的。我记得它花了整个星期天，我不得不编译大约 20 次才能把它弄好。我拥有的 MySQL 来自熵并且是预编译的。

现在我需要让 PDO 与 MySQL 驱动程序一起工作并且未安装驱动程序。我尝试了“pecl install pdo_mysql”，但它在找不到一些 mysql 文件的地方死了。有什么想法可以快速解决这个问题吗？

```
checking for mysql_config... not found
configure: error: Cannot find MySQL header files under
ERROR: `/private/tmp/pear/temp/PDO_MYSQL/configure' failed 
```

我会发布您需要的任何路径或消息来帮助我解决此问题。我是否必须重新编译 PHP，或者我可以只编译 pdo_mysql 扩展？

我希望我不会显得懒惰，我只是有很多代码要写，没有太多时间来处理我的 PHP 配置。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-21T20:14:34.237

您将需要手动编译它，而不是通过 PECL。你需要知道你的 MySQL 安装在哪里。我不知道 Entropy 包，但 MySQL 提供的构建（我推荐）安装到`/usr/local/mysql`.

```
$ pecl download pdo_mysql
$ tar xzf PDO_MYSQL-1.0.2.tgz
$ cd PDO_MYSQL-1.0.2
$ phpize
$ ./configure --with-pdo-mysql=/usr/local/mysql
$ make && sudo make install 
```

这应该会让你达到可以配置它的地步。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-03T00:52:29.400

供参考; MySQL PDO 驱动程序包含在 Marc Liyanage 的[entropy.ch的 php 5.2.9 和 5.3 构建中](http://www.entropy.ch/software/macosx/php/)

# .net - 文本数据的最快哈希算法

> ID：384811
> 
> 赞同：15
> 
> 时间：2008-12-21T19:09:36.723
> 
> 标签：.net, performance, hash

我正在尝试选择一种哈希算法来比较最多 20 个不同的文本数据。

哪种哈希更适合这些要求？

*   更少的 CPU 消耗
*   占用空间小（<=32 字节）
*   碰撞不是什么大问题
*   可以从 .NET Framework 2 生成（不应该是第 3 方库）

*我正在使用哈希来减少内存占用和比较性能*

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-21T19:46:09.770

如果冲突不是什么大问题，您可以取每个文件的第一个字母。或者您可以使用文本的长度或带有文本的字符串。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-21T19:27:21.540

Paul Hsieh 有一个不错的、简单的、快速的 32 位[SuperFastHash](http://www.azillionmonkeys.com/qed/hash.html)，它比大多数现有的散列函数执行得更好，更容易理解/实现，并且听起来符合您的标准。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-21T19:20:15.690

[FNV 散列](http://isthe.com/chongo/tech/comp/fnv/)是一种众所周知的快速散列算法。它不是加密安全的，但听起来你不需要安全哈希。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-21T21:26:13.110

一个非常快速的检查是获取文本的长度并将其与它的前 4 个字节进行异或，并将其用作散列。如果这足够好，它会非常快，因为与文件的字节数无关。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T19:12:17.483

**如果您受限于框架中存在的算法**

MD5 是否足够小（16 字节）？

更少的 CPU 消耗和占用空间通常是相互排斥的。

[http://en.wikipedia.org/wiki/Time-space_tradeoff](http://en.wikipedia.org/wiki/Time-space_tradeoff)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T19:29:45.513

查看[在他的博客上发布的系列 Peter Karkowski。](http://smallcode.weblogs.us/2008/01/22/hash-functions-an-empirical-comparison/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T20:35:48.237

哈希需要保存多长时间？`GetHashCode()`很容易访问，给出了一个小的响应（4个字节），应该没问题（重新最小化冲突）超过20个字符串。

但是，`GetHashCode()`不应该将其持久化到数据库中——不过，它可以用于内存比较。请注意，算法可能会在框架之间发生变化（并且在 1.1 和 2.0 之间发生了变化）。

这样做的另一个优点是使用起来很*简单*- 只需使用 a `Dictionary<string,Something>`，它将为您处理所有散列等。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-01-15T22:36:15.180

我对自己有同样的要求，我实现[了 xxHashSharp](https://github.com/noricube/xxHashSharp)。只要确保你使用了合适的库（x32 vs x64）。[它也可以在](http://cyan4973.github.io/xxHash/#other-languages)c# 之外使用

# asp.net - 将 javascript 添加到 ASP.NET 文本框控件的 OnBlur 属性

> ID：384820
> 
> 赞同：11
> 
> 时间：2008-12-21T19:18:37.907
> 
> 标签：asp.net, javascript

有没有办法指定一些 JavaScript 在 ASP.NET 文本框的 OnBlur 事件上执行？在我看来，如果我向 TextBox 对象添加任何事件处理程序，它们只会导致回发到服务器而不是做我想做的事。基本上，我只是希望能够在此 HTML 中呈现文本框：

```
<INPUT type="text" onblur="alert('1234')" /> 
```

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-21T19:36:30.943

也可以去：

```
<asp:TextBox runat="server" onblur="Javascript:alert('1234');" /> 
```

如果您不想在代码隐藏中设置它。

我猜你最终得到回发的原因，一定是因为你已经将文本框上的 AutoPostBack 设置为 true。当客户端 onchange 事件被触发时，这使得文本框回发。将其切换为 false，它将充当正常的输入元素。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-12-21T19:22:16.060

在您的代码隐藏中，添加以下内容：

```
myTextBox.Attributes.Add("onblur","alert('1234');"); 
```

# .net - 从服务器响应后更新 Silverlight Datagrid

> ID：384846
> 
> 赞同：1
> 
> 时间：2008-12-21T19:33:12.183
> 
> 标签：.net, silverlight, datagrid

我在 Silverlight 中有一个数据网格。我想

*   当用户编辑网格中的单元格时要发布到服务器的数据网格（或包含数据网格的用户控件）。

*   使用已编辑单元格中的某个符号（如加载符号）向数据网格发送一个帖子已发送到服务器并且控件正在等待响应的信号。

*   如果更新成功，则使用颜色（在正确的单元格中）向数据网格发出信号。

我发现我可以使用 WebClient 类在对象（~cells）set-property 中调用服务器，但感觉就像我做了一些根本错误的事情，因为：

*   我不知道在对象的 set-property 中哪个 datagrid 触发了 set-property

*   并且由于我不知道我将无法确定将响应发送回哪个数据网格（以及数据网格中的哪个单元格）（即，帖子是成功还是失败）。

我还尝试观察数据网格中的一些事件（BeginningEdit、PreparingCellForEdit、SelectionChanged、CurrentCellChanged），但它们都没有给我正在编辑的单元格的新值。

谁能指出我如何解决这些问题的正确方向？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-27T10:42:06.433

使用数据绑定。绑定 ObservableCollection 类型的集合（其中 T 是您的对象类型），当您从 Web 客户端调用返回时，填充此集合。由于它是可观察的，数据网格将看到新数据。

# saml - 寻找有关第一个 SAML 实施的反馈

> ID：384851
> 
> 赞同：11
> 
> 时间：2008-12-21T19:37:50.100
> 
> 标签：saml

我的任务是设计一个非常简单的 SSO（单点登录）流程。我的雇主已指定它应该在 SAML 中实施。我想在确认 SAML 规范的同时创建尽可能简单的消息。

如果你们中的一些人能查看我的请求和响应消息并告诉我它们是否对我的目的有意义，它们是否包含任何不需要的内容，以及它们是否缺少任何有用的信息，我*将*非常*感激*需要在那里。

此外，我想知道我应该在回复中的哪个位置添加有关该主题的其他信息；特别是主题的电子邮件地址。

交互需要按以下方式工作：

1.  此时用户向服务提供者请求服务，服务提供者对用户一无所知。
2.  服务提供者向身份提供者请求用户身份验证
3.  用户由身份提供者认证/注册
4.  身份提供商向服务提供商响应身份验证成功消息、PLUS 用户的电子邮件地址。

我认为请求应该是这样的：

```
<?xml version="1.0" encoding="UTF-8"?>
<samlp:AuthnRequest xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol" 
ID="abc" 
IssueInstant="1970-01-01T00:00:00.000Z" 
Version="2.0"
AssertionConsumerServiceURL="http://www.IdentityProvider.com/loginPage">
   <saml:Issuer xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion">
    http://www.serviceprovider.com
    </saml:Issuer>
    <saml:Subject>
        <saml:NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:transient">3f7b3dcf-1674-4ecd-92c8-1544f346baf8</saml:NameID>
    </saml:Subject> 
```

以下是我认为应该做出的回应：

```
<?xml version="1.0" encoding="UTF-8"?>
<samlp:Response xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol" Destination="http://www.serviceprovider.com/desitnationURL" ID="123" IssueInstant="2008-11-21T17:13:42.872Z" Version="2.0">
    <samlp:Status>
        <samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success"/>
    </samlp:Status>
    <saml:Assertion xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" Version="2.0">
        <saml:Subject>
            <saml:NameID Format="urn:oasis:names:tc:SAML:2.0:nameid-format:transient">3f7b3dcf-1674-4ecd-92c8-1544f346baf8</saml:NameID>
            <saml:SubjectConfirmation Method="urn:oasis:names:tc:SAML:2.0:profiles:SSO:browser">
                <saml:SubjectConfirmationData InResponseTo="abc"/>
            </saml:SubjectConfirmation>
        </saml:Subject>
        <saml:AuthnStatement AuthnInstant="2008-11-21T17:13:42.899Z">
            <saml:AuthnContext>
                <saml:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport</saml:AuthnContextClassRef>
            </saml:AuthnContext>
        </saml:AuthnStatement>
    </saml:Assertion>
</samlp:Response> 
```

所以，我的问题是：

1.  这是有效的 SAML 交互吗？

2.  可以简化请求或响应 XML 吗？

3.  我应该在回复中的哪个位置填写主题的电子邮件地址？

我真的很感谢你的帮助。非常感谢！

-摩根

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-07T04:45:14.030

您不需要请求中的主题 - 查看规范，我认为它可以很简单：

```
<?xml version="1.0" encoding="UTF-8"?>
<samlp:AuthnRequest xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"
  ID="abc" Version="2.0" IssueInstant="1970-01-01T00:00:00.000Z"
</samlp:AuthnRequest> 
```

省略所有可选元素和属性（Issuer、NameIDPolicy、AssertionConsumerServiceURL 等）意味着您的身份提供者和服务提供者已经预先同意这些，因此不需要在 AuthnRequest 中指定它们。如果您可以控制两端，并且您绝对知道您永远不会添加其他提供商，那么这是一个完全合法的 SAML 请求。它的意思是“通过我们同意的机制对提供此信息的用户进行身份验证”。

查看响应，我认为这是最小的情况：

```
<?xml version="1.0" encoding="UTF-8"?>
<samlp:Response xmlns:samlp="urn:oasis:names:tc:SAML:2.0:protocol"
  ID="123" InResponseTo="abc" IssueInstant="2008-11-21T17:13:42.872Z" 
  Version="2.0">
    <samlp:Status>
        <samlp:StatusCode Value="urn:oasis:names:tc:SAML:2.0:status:Success"/>
    </samlp:Status>
    <saml:Assertion xmlns:saml="urn:oasis:names:tc:SAML:2.0:assertion" Version="2.0">
        <saml:Subject>
            <saml:NameID Format="urn:oasis:names:tc:SAML:1.1:nameid-format:emailAddress">
                user@example.com
            </saml:NameID>
        </saml:Subject>
        <saml:AuthnStatement AuthnInstant="2008-11-21T17:13:42.899Z">
            <saml:AuthnContext>
                <saml:AuthnContextClassRef>
                    urn:oasis:names:tc:SAML:2.0:ac:classes:PasswordProtectedTransport
                </saml:AuthnContextClassRef>
            </saml:AuthnContext>
        </saml:AuthnStatement>
    </saml:Assertion>
</samlp:Response> 
```

您可以将用户的电子邮件地址作为 NameID 发送，而 AuthnStatement 仅包含身份提供者在给定时间通过给定机制对用户进行身份验证的事实。再一次，这被剥离到了骨子里——我们省略了诸如 Destination 和 SubjectConfirmationMethod 之类的属性和元素，因为它们对于用例来说是多余的。

因此，此响应显示“这是 user@example.com；他于 2008 年 11 月 21 日 17:13:42 通过受保护的传输 (SSL/TLS) 使用密码登录”。

您应该查看 SAML 2.0 配置文件规范，了解来回传递这些信息的确切机制。AuthnRequest 通常被压缩、编码并作为 GET 中的 URL 参数传递，而返回 Response 的最简单方法是通过 POST 绑定 - 返回一个 HTML 页面，其目标是服务提供者，并在通过一些 JavaScript 的页面加载时间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-05-13T16:18:42.163

1.  是的，这似乎是一个 SAML 交互

2.  您的身份验证响应现在相当简单。通常你会想在你的断言中添加更多的属性。而且为了安全起见，至少应该签署响应。

3.  它用于在之后设置。在你的情况下你没有它，所以在状态应该没问题之后......

我建议您在[http://www.ssocircle.com](http://www.ssocircle.com)创建一个帐户，并使用一个 HTTP 标头分析器（即经典且出色的 LiveHttpHeaders）和一个 SAML2 调试器（Feide [Rn SAML2 调试器](https://rnd.feide.no/software/saml_2_0_debugger "rnd feide saml2 调试器")谢谢大家！）看看请求/响应流...

希望能帮助到你，

路易斯

ps：如果你想看一个完整的实现SP/IdP：http: [//sourceforge.net/projects/spring-saml/files%2F0.1/](http://sourceforge.net/projects/spring-saml/files%2F0.1/)

# php - 用zlib在PHP中解压缩文件？

> ID：384862
> 
> 赞同：2
> 
> 时间：2008-12-21T19:49:57.063
> 
> 标签：php, zlib, dreamhost

我的网站托管在 Dreamhost 上，他们只安装了 zlib 和 PHP。我无法弄清楚如何使用此扩展中的常用方法解压缩文件，如下所述：http: [//php.net/zlib](http://php.net/zlib)

有谁知道如何在 PHP 上解压缩带有 zlib 扩展名的 .gz 或 .gzip 文件？那会救我的命！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T19:59:20.460

正如[zlib 的 PHP 绑定介绍](http://us.php.net/manual/en/intro.zlib.php)中所写：

> 4.0.4 版为 .gz 文件引入了 fopen 包装器，因此您可以使用特殊的 zlib: URL 来透明地使用普通的 f*() 文件访问函数访问压缩文件，前提是您在文件名或路径前加上 zlib：调用 fopen() 时。[...] 在 PHP 4.3.0 中，zlib: 已更改为 compress.zlib:// 以防止包含 ':' 字符的文件名出现歧义。

只需`fopen`将您的文件放在`compress.zlib://`前面，然后照常使用它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-21T19:53:32.203

[手册](http://us3.php.net/manual/en/zlib.examples.php)给出了一个很好的例子。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T19:54:29.287

GZip 和 Deflate 在[RFC 1952 (GZip)](http://www.faqs.org/rfcs/rfc1952.html)和[RFC 1950 (Deflate)](http://www.faqs.org/rfcs/rfc1950.html)中进行了解释。GZip 只是 Deflate，其中描述了一个标头，因此您可以解析该标头以检测 zLib 流的位置并使用 zLib 例程对其进行解压缩。

# asp.net - 在 JavaScript 中正确引用 ASP.NET 用户控件中的控件

> ID：384867
> 
> 赞同：2
> 
> 时间：2008-12-21T19:54:57.617
> 
> 标签：asp.net, javascript, user-controls

我有一个 ASP.NET 用户控件，其中包含一个文本框控件和一个按钮控件。此用户控件将多次添加到我的网页中。我需要有一段 JavaScript 可以在文本框更改时运行，如果文本框的值无效则禁用该按钮。我的问题是：如何将 JavaScript 放在只能引用同一用户控件中的按钮的文本框中？请记住，有许多 ASP.NET 用户控件，每个控件都有一个按钮和一个文本框，我只希望文本框中的无效值影响一个关联的按钮。谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-21T20:21:27.313

您可以使用控件的 ClientId 属性（它在客户端唯一标识控件）并进行如下操作：

```
<asp:TextBox runat="server" ID="myTextBox" />
<asp:Button runat="server" ID="myButton" Text="click" />

<script language="javascript" type="text/javascript">
    document.getElementById("<%=myTextBox.ClientID %>").onclick = function() {
        document.getElementById("<%=myButton.ClientID %>").disabled = "disabled";
    }
</script> 
```

另请参阅此文档： [ASP.NET Web Pages](http://msdn.microsoft.com/en-us/library/3hc29e2a.aspx)**中的客户端脚本，在客户端脚本中引用服务器控件**部分

 **# c# - 构建一个汇编器

> ID：384871
> 
> 赞同：15
> 
> 时间：2008-12-21T19:59:13.347
> 
> 标签：c#, assembly

我需要为我已经构建的 CPU 架构构建一个汇编器。该架构类似于 MIPS，但这并不重要。

我开始使用 C#，尽管 C++ 会更合适。（C# 对我来说意味着更快的开发时间）。

我唯一的问题是我无法为这个应用程序提供一个好的设计。我正在构建一个 2 遍汇编器。我知道每次通过时我需要做什么。\

我已经实现了第一遍，我意识到如果我必须在同一行上编写汇编代码......不会引发错误。这意味着只有一件事解析技术不佳。

所以万能的程序员，汇编之父们赐教我该怎么做。我只需要支持符号和数据声明。说明有固定大小。

如果您需要更多信息，请告诉我。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-12-21T20:15:59.023

我已经写了三四个简单的汇编程序。在不使用解析器生成器的情况下，我所做的是对我最熟悉的 6502的[SC 汇编器进行建模。](http://stjarnhimlen.se/apple2/)

为此，我使用了一种简单的语法——一行是以下之一：

```
nothing
[label] [instruction] [comment]
[label] [directive] [comment] 
```

标签是一个字母后跟任意数量的字母或数字。

一条指令是 <whitespace><mnemonic> [operands]

指令是 <whitespace>.XX [operands]

注释是一个 * 直到行尾。

操作数取决于指令和指令。

包含的指令 .EQ 等同于定义常量

.OR 设置代码的源地址

.HS 十六进制字节串

.AS ascii 字节字符串 - 除空格外的任何分隔符 - 无论开始它都结束它

.TF 目标文件用于输出

.BS n 保留 n 字节的块存储

当我编写它时，我为每个组件编写了简单的解析器。每当我遇到一个标签时，我都会把它放在一个带有目标地址的表中。每当我遇到一个我不知道的标签时，我都会将该指令标记为不完整，并将未知标签与需要修复的指令的引用一起放置。

在所有源代码行通过后，我查看了“修复”表并尝试在符号表中找到一个条目，如果找到了，我修补了说明。如果不是，那么这是一个错误。

我保留了一张指令名称表和操作数的所有有效寻址模式。当我收到一条指令时，我尝试依次解析每种寻址模式，直到某些东西起作用。

鉴于这种结构，完成整个事情应该需要一天甚至两天的时间。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-21T20:10:43.467

看看 Randy Hyde 著名的“汇编语言的艺术”的作者的这个汇编器开发工具包：

[汇编器开发者工具包](http://www.plantation-productions.com/Webster/RollYourOwn/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T20:10:50.330

两遍汇编程序的第一遍汇编代码并为符号放置占位符（因为在您运行汇编程序之前您不知道所有内容有多大）。第二遍填写地址。如果汇编代码随后需要链接到外部引用，这就是同名链接器的工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-04T13:34:58.970

如果您要编写一个可以正常工作的汇编程序，并生成一个十六进制文件以加载到微控制器上，那么它可以简单易行。我的 ciforth 库的一部分是一个完整的 Pentium 汇编器，用于添加大约 150 行的内联定义。有几十行 8080 的汇编程序。

原理解释[http://home.hccnet.nl/awmvan.der.horst/postitfixup.html](http://home.hccnet.nl/a.w.m.van.der.horst/postitfixup.html)。它相当于将黑板设计模式应用于问题。您首先制定指令，为任何和所有操作数留下孔。然后，当您遇到参数时，您将填补漏洞。
通用工具和指令集之间有严格的区分。

如果您需要的汇编器仅供您自己使用，并且除了可用性之外没有其他要求（不是家庭作业），您可以在[http://home.hccnet.nl/awmvan.der.horst/forthassembler 中有一个示例实现。 .html](http://home.hccnet.nl/a.w.m.van.der.horst/forthassembler.html) _ 如果你不喜欢 Forth，Perl 中也有一个示例实现。如果 Pentium 指令集太多太嚼，那么你仍然必须能够理解原理和通用部分。建议您先查看*asi8080.frt*文件。这是 389 WOC（Words Of Code，而不是 Lines Of Code）。一个熟悉指令集的有经验的 Forther 可以在一个晚上完成一个这样的汇编程序。奔腾是个婊子。

# javascript - Javascript 中的 $$ 是什么意思？

> ID：384873
> 
> 赞同：4
> 
> 时间：2008-12-21T19:59:24.190
> 
> 标签：javascript, prototypejs

我正在查看一些javascript代码，它在一个函数中有这个：

```
$$('.CssClass').each(function(x) { .... } ) 
```

我知道其目的是将匿名函数应用于具有 CssClass 类的每个元素，但我无法处理 $$ 所指的内容......并且无法通过谷歌搜索 $$！

**更新**：感谢您的提示。javascript 来自 iPhone 相似库：[jPint](http://www.journyx.com/jpint/)，其中包括[prototypejs](http://www.prototypejs.com/)库，并将 $$ 定义为：

```
function $$() {
  return Selector.findChildElements(document, $A(arguments));
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-21T20:08:01.067

大概是[这个](http://www.prototypejs.org/api/utility#method-%24%24)原型函数：

```
$$(cssRule...) -> [HTMLElement...] 
```

> 接受任意数量的 CSS 选择器（字符串）并返回与其中任何一个匹配的扩展 DOM 元素的文档顺序数组。

[http://www.prototypejs.org/api/utility#method-$$](http://www.prototypejs.org/api/utility#method-%24%24)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-22T00:05:39.950

$是一个普通的符号字符，因此“$”、“$$”、“$$$”是普通变量。

$ 的含义取决于正在使用的库；在 jQuery 中，$-function 从 css 选择器创建一个 jquery 对象，例如 $("DIV") 是当前文档中所有 DIV 的集合。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-21T20:01:30.910

您是否正在偶然查看诸如 mootools 之类的库？通过访问 DOM，这被用作某些类型对象的简写。例如，他们执行 $('myElement') 之类的操作来访问页面元素。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T20:02:24.730

`$`是 javascript 中的有效函数名。所以有些东西定义了一个函数`$$`，它接受一个字符串来查找某个被调用的类`.CssClass`并返回一个你调用的对象`each`。

我知道 jQuery 定义了一个`$`至少调用的函数来做类似的事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-21T21:06:22.917

您是否有机会查看 MooTools 脚本？ ~~[http://www.consideropen.com/blog/2008/08/30-days-of-mootools-12-tutorials-day-2-selectors/](http://www.consideropen.com/blog/2008/08/30-days-of-mootools-12-tutorials-day-2-selectors/)~~ [（现在归域名抓取者所有）]

“$$ 让您可以快速选择多个元素并将它们放入数组（一种列表类型，可让您以各种方式操作、检索和重新排序列表）。您可以按名称选择元素（例如 div、 a, img) 或 ID，你甚至可以混搭。”

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T23:23:56.507

很可能是处理指定参数的 DOM 访问的简写函数名称，无论是标签名称还是对象 ID。

如上所述，您可能使用 MooTools 或 jQuery。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-05-18T16:59:44.463

**在浏览器的控制台**中，是另一种写法`querySelectorAll()`。只需选择网页上您需要的所有元素并将它们放入一个数组中。

## 实际例子：

选择所有元素并设置调试布局的大纲指南[[来源]](https://gist.github.com/addyosmani/fd3999ea7fce242756b1#gistcomment-2162318)：

```
$$('*').map((A,B)=>A.style.outline=`1px solid hsl(${B*B},99%,50%`) 
```

打印网页上所有图片的图片地址[[来源]](https://dev.to/mrahmadawais/use-instead-of-document-queryselector-all-in-javascript-without-jquery-3ef1)

```
$$('img').forEach(img => console.log(img.src)) 
```

# python - 检查二维数组（如八皇后拼图）

> ID：384874
> 
> 赞同：5
> 
> 时间：2008-12-21T20:00:55.280
> 
> 标签：python, arrays, puzzle

我的问题与八皇后谜题非常相似。

例如，我有一个二维数组（N x N），如下所示：

```
0,0,0,0,1 y
0,0,0,0,0 |
0,0,0,0,0 V
0,0,0,1,0
0,0,0,0,0
x-> 
```

我正在水平、垂直和对角线检查 1 的出现

```
\,0,|,0,/
0,\,|,/,0
-,-,1,-,-
0,/,|,\,0
/,0,|,0,\ 
```

我正在考虑仅将“1”的（x，y）位置存储在列表中

```
[[4,0],[3,3]] 
```

并以数学方式解决它，用另一个 (x1,y1)<->(x2,y2) 检查“1”的每个位置，

如果`x1 == x2`或`y1 == y2` `we have a collision!`如果不检查：

```
x2 == x1 + z;
y2 == y1 + z;
x2 == x1 - z;
y2 == y1 - z; 
```

（？？？）

其中z是+/-`( x1+z in 0..N ) and ( y1+z in 0..N ) .......`

***我的问题是检查对角线碰撞，有更好的方法吗？？？***

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-21T20:10:32.123

一种可能的解决方案：

```
def collision(x1, y1, x2, y2):
    return x1 == x2 or y1 == y2 or abs(x1-x2) == abs(y1-y2) 
```

即如果两个点在同一水平行、同一垂直行或同一对角线（垂直距离==水平距离）上，则会发生碰撞。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T21:06:14.163

您的描述听起来像是一个精确覆盖问题的实例，可以使用 Knuth 调用[Algorithm X](http://en.wikipedia.org/wiki/Algorithm_X)的算法来解决。我已经使用这种技术[在 Javascript 中实现了数独求解器。](http://hewgill.com/sudoku/)你也可以在 Python 中找到实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T20:31:52.610

我认为如果你不从数学上解决它会快得多，而是首先检查所有行是否多次出现 1，然后检查所有列，最后检查所有对角线。

这是一些以简单方式测试对角线的代码。（这是 JavaScript，对不起！）

```
var count = 0;
for (column = -n; column < n; column++) {
    for (row = 0; row < n; row++) {
            // conditions for which there are no valid coordinates.
            if (column + row > 6) {
                break;
            }
            if (column < 0) {
                continue;

            if (field[row][column] == 1) {
                count++;
                if (count == 2)
                    break; // collision
            }
    }
} 
```

这种方法的复杂度为`O(n^2)`，而您建议的方法的复杂度为`O(n^2 + k^2)`（k 是 1 的数量）如果`k`总是很小，这应该没问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-22T04:01:08.943

假设你确实有一个 N 维空间，你可能没有，你可以使用这个碰撞检测器：

```
def collision(t1, t2):
    return len(set([abs(a-b) for a,b in zip(t1, t2)] + [0])) <= 2 
```

向它传递一对你喜欢的元组，如果这两个点位于任何 N 维对角线上，它将返回 true。

# c++ - 如何使警告在视觉工作室中持续存在

> ID：384886
> 
> 赞同：1
> 
> 时间：2008-12-21T20:10:24.213
> 
> 标签：c++, visual-studio, warnings

假设我有文件`a.cpp`，`b.cpp`并且`a.cpp`在`b.cpp`. 我修复了错误`b.cpp`并重新编译——因为 Visual Studio 不必重新编译`a.cpp`，它不会提醒我之前发现的警告。

我想以某种方式让警告持续存在；但是，我**不**希望它把警告视为错误（我希望它仍然编译/运行，即使有警告）。这可能吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T20:32:53.500

您可以进入项目设置并在 C/C++ 选项卡（类别：常规）中将所有警告设置为错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T20:56:24.247

从本质上讲，你不走运。C++ 编译将丢弃所有错误和警告。因为它只重新编译缺少 .OBJ 文件的 .CPP 文件（即上次出现错误和失败的文件），所以您只会看到错误。

你有几个选择。在我的头顶上：

*   编写一个响应构建完成事件的宏。如果它看到任何警告，它可以删除 .OBJ 文件。.CPP 文件将在下次再次编译。不幸的是，这意味着如果不重新编译，您的程序可能无法运行。
*   您可以编写一个以另一种方式工作的宏：在构建开始时，查看是否有任何警告，然后删除 .OBJ 文件。
*   编写一个 VS 插件，在 .CPP 文件再次编译之前记住警告。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T21:07:55.393

正如 Hernan 已经说过的，添加一个自定义构建步骤，该步骤会复制包含构建结果（警告）的中间文件。不确定如何为此命名，但您可以创建一个 bat 文件，该文件被称为自定义构建步骤。

为什么要保存警告超出了我的范围。将它们视为错误，或忽略它们或编译指示/禁用它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T20:14:25.300

重建您的项目或仅重新编译 a.cpp 文件。警告由编译器输出，因此您不会收到当前编译中未包含的文件的警告。

您可以将当前构建输出保存到“输出”窗格并按 Ctrl+S（如果我不记得不好，默认为 output-build.txt。）

在您的项目设置中，我认为构建输出消息可以保存在文件中。检查它并告诉你的结果。

干杯

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-21T21:11:12.877

鉴于您不想重新编译导致警告的文件，您可能有一个选择是编写一个小实用程序，用于过滤编译器的输出以获取警告并将它们作为 //TODO 注释写入 .cpp 文件.

然后 IDE 会将它们放在待办事项列表中。

我不知道有什么开箱即用的方法，但它可能不会太难鞭打。

如果您不希望该实用程序与实际的源文件混在一起（我不确定我是否愿意），您可能希望让它将 //TODO 注释写入一个虚拟的“todo.cpp”文件并拥有它项目中的文件。然后它们会出现在待办事项列表中，由于文件只是注释，它不会影响构建。只需确保该实用程序很聪明，不会将重复项添加到列表中。可以编写一个宏来将您从 todo.cpp 行带到警告的相应实际位置。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T21:43:49.330

我强烈建议在运行时尽可能多地发出警告，当然在你自己编写的所有代码中也是如此。在这里和现在修复警告要容易得多，而不是等到稍后再尝试一次性完成所有警告。

您希望将警告作为错误运行有几个原因：

*   大多数警告实际上表明您的代码存在问题。
*   如果你有很多警告，你不会注意到中间是否出现了新的警告。我经常看到这种情况发生。
*   如果有您认为是虚假的警告，或者由于某种原因您无法立即修复它，您可以将其关闭。使用 /w 选项或合适的#pragma。请注意，您只能将其切换到特定文件，甚至可以在代码中的特定位置切换。如果您在编译时仍然需要通知，但那里有#pragma 消息。
*   如果有代码超出您的控制范围，但您只需将其编译到您的程序中，为该特定模块或源文件切换警告，或者甚至在没有 /WX 的情况下运行它。无论如何，您可能都没有修改代码，因此第 2 点可能不太相关。

我真的看不出任何不使用/WX（或-Werror）运行的正当理由。

# inversion-of-control - SFig 语言语法是否高效且清晰（并且比 Spring-Framework 的 XML DSL 更好）？

> ID：384890
> 
> 赞同：0
> 
> 时间：2008-12-21T20:11:47.207
> 
> 标签：inversion-of-control, antlr, spring, dsl, parsing

**附录编辑：**

> 由于没有经验丰富的 Spring Framework 开发人员的任何反馈，因此尚未接受对此的回答。

我一直在研究用于 Spring-Framework applicationContext.xml 文件的替代 DSL（其中描述了 bean 初始化和依赖关系以加载到 Spring bean 工厂中）。

我的动机是我完全不喜欢 Spring 为此目的使用 XML，也不喜欢迄今为止设计的任何替代方案。出于各种我不会深入讨论的原因，我想继续使用声明性语言，而不是像 Groovy 这样的命令式脚本语言。

所以我抓住了 ANTLR 解析器工具，并一直在设计一个新的 bean factory DSL，我称之为 SFig。这是一个有关此内容的链接：

[SFig™ - Spring-Framework 的替代元数据配置语言](http://dobbscodetalk.com/index.php?option=com_content&task=view&id=922&Itemid=85)

这是源代码存储库站点：

[http://code.google.com/p/sfig/](http://code.google.com/p/sfig/)

我很想知道到目前为止我在语言语法上的表现如何。您认为 SFig 既高效又清晰易懂？（我现在特别关心多行文本字符串）：

```
properties_include "classpath:application.properties";

org.apache.commons.dbcp.BasicDataSource dataSource {
    @scope = singleton;
    @destroy-method = close;
    driverClassName = "${jdbc.driverClassName}";
    url = "${jdbc.url}";
    username = "${jdbc.username}";
    password = "${jdbc.password}";
    defaultAutoCommit = true;
}

org.springframework.orm.ibatis.SqlMapClientFactoryBean sqlMapClient {
    @scope = singleton;
    @init-method = afterPropertiesSet;
    @factory-method = getObject;
    configLocation = "classpath:sqlmap-config.xml";
    dataSource = $dataSource;
}

/* this string will have Java unescape encoding applied */
STRING str = "\tA test\u0020string with \\ escaped character encodings\r\n";

/* this string will remain literal - with escape characters remaining in place */
STRING regexp = @"(\$\{([a-zA-Z][a-zA-Z0-9._]*)\})";

/* multi-line text block - equates to a java.lang.String instance */
TEXT my_multi_line_text = ///
Here is a line of text.
This is yet another. Here is a blank line:

Now picks up again.
///;

/* forward use of 'props' bean */
java.util.HashMap map {
    this( $props );
}

/* equates to a java.util.Propertis instance */
PROPERTIES props {
    "James Ward" = "Adobe Flex evangelist";
    "Stu Stern" = "Gorilla Logic - Flex Monkey test automation";
    Dilbert = "character in popular comic strip of same title";
    "App Title Display" = "Application: ${app.name}";
    "${app.desc}" = "JFig processes text-format Java configuration data";
}

/* equates to a java.util.ArrayList instance */
LIST list {
    this( ["dusty", "moldy", "${app.version}", $str] );
    [234, 9798.76, -98, .05, "numbers", $props, ["red", "green", "blue"]];
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-22T00:55:58.677

我对您引用的 Spring XML 没有太多经验，因此您应该对以下反馈有所了解。

作为第二和第三个警告：

*   提供一段代码将使您*了解*该语言及其语义。很难完全理解您已经做出的一些选择（并且有充分的理由），因此根据这些选择，这里的任何反馈都可能完全矛盾或不可能。
*   语言设计既是一门艺术，也是一门科学，因此在这个阶段，你可能得到的任何反馈都可能是相当主观的。

一个更大的元问题：作为 DSL，您是在尝试配置 Spring，还是作为更通用的框架类？

那里：警告购买者。现在我的主观和不完整的反馈;）

*   我不确定我理解为什么你有**`@`前缀**的原因`scope`and `destroy-method`，但没有`driverClassName`。此外，**xml-case 和 camelCase**的混合在开始时并不完全明显。前缀是`@`类型修饰符，还是语言中的这些关键字？

*   我不完全确定您对块头格式的意图。您有类名，然后是该类的函数；是否打算指定您将为特定功能使用的类？

例如

```
sqlMapClient: org.springframework.orm.ibatis.SqlMapClientFactoryBean {
    # body.
} 
```

甚至：

```
sqlMapClient {
    @class = org.springframework.orm.ibatis.SqlMapClientFactoryBean;
    # is there a sensible (perhaps built-in) default if this is missing?
} 
```

*   我喜欢**变量替换**；我认为这些值将来自系统属性？

*   我喜欢能够指定**字符串文字**（无需转义），尤其是对于您展示的正则表达式。但是，使用多字符引号或引号修饰符似乎有点陌生。我猜你考虑过单引号（shell 和 Perl 对文字字符串使用单引号）。

*   另一方面，我认为**多行`TEXT`**的三个正斜杠是正确的方法，但两个让人想起 C 风格语言中的注释。`"`为此，Python 使用了三元组。一些 shell 习语有一个我不会复制的多行文本约定。

*   我非常喜欢属性和配置位置的外观，使用看起来像**寻址的 URI 概念**。如果这是一个URI，`classpath://file.xml`可能会更清楚。然而，我在这里可能有错误的一端。

*   我也非常喜欢您拥有的列表和映射文字的概念，尽管我不确定在哪里：

    *   `this`进入它（我猜是对Java构造函数的调用）
    *   为什么有些类型是大写的，而另一些不是。我是否认为有一个默认`MAP`类型，如果您愿意，您可以使用更具体的类型？
    *   Dilbert 是不带引号的字符串文字吗？

最后，我会向您指出另一个配置 DSL，尽管可能更多用于系统管理员：[Puppet](http://reductivelabs.com/projects/puppet/)。

走好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T04:18:37.740

我将提供一些关于 Spring 的背景知识以及它的 applicationContext.xml 文件——这将使 SFig 语法中发生的一些事情变得清晰。

applicationContext.xml 文件用于表示将由 Spring bean 工厂管理的 bean 的 bean 初始化。因此，鉴于我在此文件的 SFig 版本中看到的 bean 示例，在 Java 应用程序代码中，可能会请求 bean 工厂创建一个 bean 实例，如下所示：

```
SqlMapClient sqlMapClient = getBean("sqlMapClient"); 
```

bean 工厂负责 bean 所需的任何实例化和初始化 - 甚至到注入依赖项的程度。在这种情况下，SqlMapClient bean 需要一个*dataSource* bean 的实例（在 SFig 示例中也对其进行了描述和引用）。

bean 描述符将以下信息传递给 bean 工厂：

*   bean 的 Java 类名
*   请求或引用它的 bean ID
*   bean 定义元属性（可选）
*   构造函数初始化参数（可选）
*   和/或属性初始化器

'@' 前缀 bean 定义元属性。这些是 bean 工厂用来管理 bean 的属性。例如，@scope = singleton，将通知 bean 工厂创建 bean 的单个实例，缓存它，并在请求时分发对它的引用。可以设置的和 Spring-Framework 定义的一样。

如果要通过构造函数初始化 bean，那么在 SFig 中，它通过一种语法表示，该语法似乎是用括号中的参数调用*this 。*

或者可以通过设置其属性来初始化 bean。分配给但不以“@”为前缀的标识符是 bean 属性。

当引用作为必需依赖项的 bean 时，可以通过在其 bean ID 前加上“$”来引用它。这方面的几个例子出现在 SFig 例子中。

出现在字符串文字中的 ${foo.bar} 样式的变量将被 Java 属性值替换。在这种情况下，属性是通过以下行从文件 application.properties 加载的：

```
properties_include "classpath:application.properties"; 
```

如果在任何包含的属性中都找不到 Java System 属性，则将查找下一个。这是许多 Java 框架中广泛遵循的做法。当前基于 XML 的 applicationContext.xml 文件也有一种允许这种用法的方式。

因为 java.util.Properties 经常用于初始化 bean，所以 SFig 提供了 PROPERTIES 作为一种特殊的方便语法来声明一个 Properties 对象。java.util.List 也是如此，它具有相应的 SFig LIST。此外，值数组可以在方括号 [...] 中声明。

此外，还有用于声明多行文本块的 TEXT。以字符串文字为前缀的“@”表示关闭转义编码——一种从 C# 借用的语言语法。

SFig DSL 的主要设计目标之一是在本质上保持声明性。我故意避免添加任何命令式脚本功能。嵌入在文本配置文件中的编程逻辑的复杂性意味着必须对其进行调试。不想打开代码调试的另一个维度。

# c# - 私有静态和实例变量是否在 C# 中继承，为什么？

> ID：384898
> 
> 赞同：4
> 
> 时间：2008-12-21T20:20:59.310
> 
> 标签：c#, inheritance

我读过基类中的私有变量在技术上由子类继承，但不可访问。

如果这是正确的，为什么我们说它们是继承的，而它们可能只能通过反射来访问？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-21T20:30:01.897

子类化是关于继承*实现*；和字段是一个实现细节。

这些字段确实存在，并且可以通过反射获得。但最终，通过任何 public/protected/etc 成员管理这些字段的状态是基类的工作。

但最终 - 如果基类为 property 声明了一个属性（和字段）`Foo`，那么当您设置该属性时，数据必须去某个地方。子类必须包含基类中的所有字段才能有意义。这对于基于字段的序列化框架（例如`BinaryFormatter`）也很重要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T20:32:56.230

私有字段在某种意义上是继承的，它们在分配时占用堆上的空间。但是，派生类不能直接访问它们。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T20:25:59.690

> 为什么我们说他们是遗传的……

就个人而言，我没有。我认为继承包括您可以在子类中访问的那些东西，而不是那些隐藏的东西。

我可以看到有人说要明确继承包括链上的所有元素，但它让我觉得过于迂腐而且不是特别有用。

# iphone - 将音频从服务器流式传输到 iPhone

> ID：384900
> 
> 赞同：17
> 
> 时间：2008-12-21T20:23:07.043
> 
> 标签：iphone, objective-c, cocoa, audio

我正在寻找将我服务器上的一些音频文件流式传输到我正在编写的 iPhone 客户端应用程序。一些音频文件的大小可能相当大，即使经过压缩也是如此。我的问题是，是否有一个 Cocoa 框架可以帮助我缓冲音频，以便用户可以使用它，而其余部分则通过管道传输？如果没有，谁能指出我正确的方向，以了解更多关于使用 Objective-C/Cocoa 实现这一目标所需的技术？

关于缓冲和压缩来自服务器<->客户端基础设施的音频的权威资源将是理想的。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-21T23:17:45.677

Brad 提到了一篇我写的通过 HTTP 流式传输音频的帖子。就是这个：[流式传输和播放 MP3](http://cocoawithlove.com/2008/09/streaming-and-playing-live-mp3-stream.html)。我并不是要成为链接到他自己的博客的人，但它确实解决了您的问题。

关于解决问题的难易程度，您会注意到我已经对该帖子进行了 4 次更新（比我对其他任何事情所做的都要多），修复了线程错误、内存泄漏和网络缓冲问题。有很多东西要准确无误。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-01-06T21:52:08.850

MPMoviePlayerController 可以播放音频文件。如果您使用内容 url 初始化对象（例如，这可以是服务器上的 Mp3 文件），它将流式传输文件并播放它。

初始化如下所示：

```
NSURL *theURL = [NSURL urlWithString:@"http://yourdomain.com/yourmediafile.mp3"];

MPMoviePlayerController* yourPlayerController = [[MPMoviePlayerController alloc] initWithContentURL:theURL]; 
```

从那里您可以弹出一个播放视图，该视图将显示一个用于浏览内容的滑块，它将作为内容缓冲区填充滑块栏。

```
[yourPlayerController shouldAutorotateToInterfaceOrientation:UIInterfaceOrientationLandscapeRight];
[self presentMoviePlayerViewControllerAnimated:yourPlayerController]; 
```

或者你可以让它播放并创建你自己的 UI：

```
[yourPlayerController.moviePlayer play]; 
```

这种播放方法会在屏幕锁定时切断音频，除非您在 info.plist 文件中告诉应用程序在后台运行。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-21T22:29:08.473

不幸的是，你将有一些工作摆在你面前。去年夏天我不得不为一个 iPhone 项目做这个。您需要的大部分内容都在 AudioToolbox 框架中的音频队列服务中。

使用音频队列服务有点棘手，您必须实现一堆回调来告诉它如何在数据包离开网络后对其进行处理。

有人，我认为是 Matt Gallagar，在博客上有一些示例代码还不错，而且在 Apple 的 Core Audio 邮件列表中有很多东西。

我确实发现我最终不需要中继 NSURL Connection 来完成网络部分，因为我的 didrecievedata 委托方法没有足够频繁地触发。

抱歉，我不能在这里仅添加几行代码作为示例，但是我为此编写的类大约有 400 行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-11-08T15:52:31.763

我现在知道你希望已经解决了你的问题。但只是以防万一。如果您想要一个直接的解决方案，您可以随时获取嵌入的代码或任何其他链接，并从中制作一个 html 文件。像

```
<html>
<body>
<script type="text/javascript">
  var embedBaseUrl = 'http://www.tv.net/';
  var embedChannelId = 13;
  var embedSize = [300,250];
  var embedAutoplay = true;
</script>
<script type="text/javascript"src="http://www.tv.net/assets/js/embed.js"></script>
</body>
</HTML> 
```

视图控制器.h

```
@interface ViewController : UIViewController {

NSString *videoURL;

}

@property (nonatomic, strong) NSString *videoURL;

    (IBAction) tv; 
```

在 ViewController.m

```
@synthesize videoURL;

    (IBAction) tv {

    self.videoURL = @"http://dl.dropbox.com/x/xxxxxxxx/HTML/tv.html";

    VideoViewController *videoViewController = [[VideoViewController alloc] initWithNibName:nil bundle:nil];

    videoViewController.modalTransitionStyle = UIModalTransitionStyleFlipHorizontal; videoViewController.videoURL = self.videoURL;

    [self presentViewController:videoViewController animated:YES completion:nil]; } 
```

然后在 VideoViewController.h

```
IBOutlet UIWebView *videoView;

NSString *videoURL; NSString *videoHTML;

}

@property(nonatomic, retain) IBOutlet UIWebView *videoView; @property(nonatomic, retain) NSString *videoURL; @property(nonatomic, retain) NSString *videoHTML;

    (void) embedTV;

VideoViewController.m

@synthesize videoView, videoURL, videoHTML;

    (id)initWithNibName:(NSString *)nibNameOrNil bundle:(NSBundle *)nibBundleOrNil { self = [super initWithNibName:nibNameOrNil bundle:nibBundleOrNil]; if (self) { // Custom initialization } return self; }

    (void)embedTV {

    videoHTML = [NSString stringWithFormat:@"\ \ \ \ iframe {position:absolute; top:50%%; margin-top:-130px;}\ body {background-color:#000; margin:0;}\ \ \ \ \ \ ", videoURL];

    [videoView loadHTMLString:videoHTML baseURL:nil]; }
        (void)viewDidLoad { [super viewDidLoad]; // Do any additional setup after loading the view from its nib.

    videoView.backgroundColor = [UIColor blackColor]; videoView.opaque = NO;

    [self embedTV]; } 
```

现在在我的示例中，我提到了视频流，但您明白了，您可以流式传输或播放您想要的内容。只需使用`UIWebView`.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-12-21T12:24:40.030

您可以使用 AVFoundation 框架中的**AVPlayer**类从本地文件或远程服务器流式传输音频。AVPlayer 类将通知您准备好播放或需要缓冲更多数据。

但是，如果您想要更多控制权，您绝对应该使用**音频队列**服务。使用音频队列服务有点困难，但是一旦你掌握了它，你就可以按照你想要的方式微调音频播放过程。

# c++ - 使用 EnterCriticalSection 的问题

> ID：384913
> 
> 赞同：7
> 
> 时间：2008-12-21T20:34:47.927
> 
> 标签：c++, winapi, critical-section

我需要处理来自多个线程的数组，因此我使用 CRITICAL SECTION 为其提供对数据的独占访问权限。
这是我的模板：

```
#include "stdafx.h"
#ifndef SHAREDVECTOR_H
#define SHAREDVECTOR_H

#include <vector>
#include <windows.h>

template<class T>
class SharedVector {
    std::vector<T> vect;
    CRITICAL_SECTION cs;
    SharedVector(const SharedVector<T>& rhs) {}
public:
    SharedVector();
    explicit SharedVector(const CRITICAL_SECTION& CS);
    void PushBack(const T& value);
    void PopBack();
    unsigned int size() const;
    T& operator[](int index);
    virtual ~SharedVector();
};

template<class T>
SharedVector<T>::SharedVector() {
    InitializeCriticalSection(&cs);
}

template<class T>
SharedVector<T>::SharedVector(const CRITICAL_SECTION& r): cs(r) {
    InitializeCriticalSection(&cs);
}

template<class T>
void SharedVector<T>::PushBack(const T& value) {
    EnterCriticalSection(&cs);
    vect.push_back(value);
    LeaveCriticalSection(&cs);
}

template<class T>
void SharedVector<T>::PopBack() {
    EnterCriticalSection(&cs);
    vect.pop_back();
    LeaveCriticalSection(&cs);
}

template<class T>
unsigned int SharedVector<T>::size() const {
    EnterCriticalSection(&cs);
    unsigned int result = vect.size();
    LeaveCriticalSection(&cs);
    return result;
}

template<class T>
T& SharedVector<T>::operator[](int index) {
    EnterCriticalSection(&cs);
    T result = vect[index];
    LeaveCriticalSection(&cs);
    return result;
}

template<class T>
SharedVector<T>::~SharedVector() {
    DeleteCriticalSection(&cs);
} 
```

在编译时，我在调用`EnterCriticalSection(&cs)`and时遇到了这样的问题`LeaveCriticalSection(&cs)`：

```
'EnterCriticalSection' : 无法将参数 1 从
'const CRITICAL_SECTION *' 到 'LPCRITICAL_SECTION'

```

我不知道出了什么问题。也许你可以看到。只是因为我一直这样用它，没关系。`windows.h`已经包括了

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-21T20:45:39.620

只需声明`cs`为：

```
mutable CRITICAL_SECTION cs; 
```

否则删除 const 子句`size()`

进入临界区会修改`CRITICAL_SECTION`，离开会再次修改它。由于进入和离开临界区不会使`size()`方法调用在逻辑上非非`const`，我会说让它声明`const`，然后 make `cs` `mutable`。这是为这种情况`mutable`而介绍的。

另外 - 看看[Martin York](https://stackoverflow.com/questions/384913/problems-using-entercriticalsection#385091)和[Joe Mucchiello](https://stackoverflow.com/questions/384913/problems-using-entercriticalsection#385091)的建议 - 尽可能使用 RAII 来处理需要清理的任何类型的资源。这对于关键部分和指针和文件句柄一样有效。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-21T22:27:13.457

上面的代码也不是异常安全的。
不能保证 push_back() pop_back() 不会抛出。如果他们这样做，他们将使您的关键部分永久锁定。您应该创建一个储物柜类，在构造时调用 EnterCriticalSection()，在销毁时调用 LeaveCriticalSection()。

这也使您的方法更易于阅读。（见下文）

```
class CriticalSectionLock
{
    public:
        CriticalSectionLock(CRITICAL_SECTION& cs)
            : criticalSection(cs)
        {
            EnterCriticalSection(&criticalSection);
        }
        ~CriticalSectionLock()
        {
            LeaveCriticalSection(&criticalSection);
        }
    private:
        CRITICAL_SECTION&  criticalSection;
};

// Usage
template
unsigned int SharedVector::size() const
{
    CriticalSectionLock  lock(cs);
    return vect.size();
} 
```

你应该担心的另一件事。确保当您销毁对象时您拥有所有权，并且在销毁期间没有其他人试图取得所有权。希望你的 DestoryCriticalSection() 能解决这个问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-21T22:40:37.187

我更喜欢在您的代码上使用单独的 Acquisition 对象。当 Enter 和 Leave 调用之间发生异常时，如果您的代码很脆弱：

```
class CS_Acquire {
    CRITICAL_SECTION &cs;
public:
    CS_Acquire(CRITICAL_SECTION& _cs) : cs(_cs) { EnterCriticalSection(cs); }
    ~CS_Acquire() { LeaveCriticalSection(cs); }
}; 
```

然后在您的类方法中，您将其编码为：

```
template <typename T>
void SharedVector::PushBack(const T& value) {
   CS_Acquire acquire(&cs);
   vect.push_back(value);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-21T20:43:41.870

`EnterCriticalSection`不接受**const**参数。这是一个编译错误，顺便说一句，不是链接错误......

另外，您确定要将关键部分传递给您的 ctor，然后让 ctor 执行`InitializeCriticalSection`调用吗？如果你想分享你的关键部分，我想你应该先初始化它，然后再分发出去。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-21T21:24:34.300

我看到你已经声明了一个空的复制构造函数：

```
SharedVector(const SharedVector& rhs) {} 
```

我相信你知道，这个函数什么都不做，而且它也没有`cs`初始化。因为您的类包含 a 的实例，所以`CRITICAL_SECTION`您必须确保禁止复制构造函数和赋值运算符调用，除非您要完全实现它们。`private`您可以通过在类的部分中放置以下声明来做到这一点：

```
SharedVector(const SharedVector &);
SharedVector &operator=(const SharedVector &); 
```

这可以防止编译器自动生成这些方法的错误版本，也可以防止您在您编写的其他代码中调用它们（因为这些只是声明，而不是带有`{}`代码块的定义）。

此外，正如[Arnout](https://stackoverflow.com/questions/384913/problems-using-entercriticalsection#384922)所提到的，接受`CRITICAL_SECTION&`参数的构造函数似乎是错误的。您的实现所做的是将传入的临界区复制到`cs`（这与 a 无关`CRITICAL_SECTION`），然后调用`InitializeCriticalSection(&cs)`它覆盖您刚刚所做的副本并创建一个*新*的临界区。对于传入关键部分的调用者来说，这似乎通过有效地忽略传入的任何内容来做错误的事情。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-21T20:49:09.847

所以，访问权限有问题。我将 size() 方法设为非常量，现在可以了。

# routes - 对 example.com/username 和 Routes 的看法

> ID：384916
> 
> 赞同：0
> 
> 时间：2008-12-21T20:38:27.123
> 
> 标签：routes, url-routing, friendly-url

我正在建立一个用户拥有自己“个人资料”的网站。我正在为整洁的 URL 使用路由，我想知道以下优点/缺点是什么：

```
example.com/:username 
```

或者我应该包含一个静态路由来过滤它是一个配置文件页面请求吗？

```
example.com/u/:username
example.com/something-static/:username 
```

哪个最好？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-22T01:42:03.703

如果用户可以指定他们的用户名并以一种重要的方式自定义他们的个人资料页面，那么您将面临启用欺诈/网络钓鱼攻击的风险。

例如，我可以使用用户名“passwordreset”进行注册，然后在我的个人资料页面上放置一个表单（或表单的链接），然后通过访问 example.com 尝试说服人们他们需要重置密码/重设密码。

然后我可以收集密码。

如果 URL 是 example.com/users/passwordreset，则警报用户更有可能变得可疑。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T20:43:19.857

我想你不会想要

```
example.com/:username 
```

因为这会对可用的用户名施加限制，以免与 url 下的其他路径发生冲突。

我会提议

```
profiles.example.com/:username 
```

# c# - 如何规避在匿名方法块中使用 out 参数？

> ID：384918
> 
> 赞同：6
> 
> 时间：2008-12-21T20:40:56.807
> 
> 标签：c#, anonymous-methods, out-parameters

以下方法无法编译。Visual Studio 警告“不得在匿名方法中使用 out 参数”。该`WithReaderLock(Proc action)`方法采用`delegate void Proc()`.

```
public Boolean TryGetValue(TKey key, out TValue value)
{
    Boolean got = false;
    WithReaderLock(delegate
    {
        got = dictionary.TryGetValue(key, out value);
    });
    return got;
} 
```

获得这种行为的最佳方法是什么？（请不要提供关于线程安全字典的建议，这个问题通常是为了解决 out 参数问题）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-21T20:45:51.867

```
public bool TryGetValue(TKey key, out TValue value)
{
    bool got = false;            
    TValue tmp = default(TValue); // for definite assignment
    WithReaderLock(delegate
    {
        got = dictionary.TryGetValue(key, out tmp);
    });
    value = tmp;
    return got;
} 
```

（已编辑 - 小错误）

有关信息，在 .NET 3.5 中，您可能希望使用`Action`委托而不是滚动您自己的委托，因为人们会更多地识别它。即使在 2.0 中，也有很多`void Foo()`代表：`ThreadStart`、`MethodInvoker`等 - 但`Action`最容易遵循；-p

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T20:42:06.757

简单的答案是只复制方法内的逻辑。但是随后我们扩展了 DRY 原则，并且必须在这两种方法中保持行为。

```
public Boolean TryGetValue(TKey key, out TValue value)
{
    internalLock.AcquireReaderLock(Timeout.Infine);
    try
    {
        return dictionary.TryGetValue(key, out value);
    }
    finally
    {
        internalLock.ReleaseReaderLock();
    }
} 
```

# php - SQL 查询：按 ntext 字段分组

> ID：384923
> 
> 赞同：2
> 
> 时间：2008-12-21T20:45:03.693
> 
> 标签：php, sql, sql-server

我有以下查询，它基本上检索了销量最高的 5 本书：

```
 select top 5 count(id_book_orddetails) 'books_sold', bk.*
    from orderdetails_orddetails ord inner join books_book bk
    on ord.id_book_orddetails = bk.id_book
    group by id_book, name_book,author_book,desc_book,id_ctg_book,qty_book,image_book,isdeleted 
    order by 'books_sold' desc 
```

问题是我收到此错误：

> text、ntext 和 image 数据类型不能进行比较或排序，除非使用 IS NULL 或 LIKE 运算符。

在`books_book`表中，该字段`desc_book`的类型为`ntext`，我确信问题来自那里。

这是因为在我将其更改为 之前`desc_book`，`ntext`它是类型`nvarchar`并且运行良好。

我更改此字段的数据类型的原因是因为在 PHP 网站中，当我显示书籍描述（不同的 sp）时，描述被截断为大约 200-255 个字符，因此我将其更改为`ntext`'解决了我的问题'（即，整体`desc_book`终于被展示出来了）。

所以基本上这些是我的问题：

1.  **为什么`desc_book`(nvarchar) 字段在 PHP 页面中显示时会被截断？**
2.  **如何修复 SQL 查询以适应按`ntext`字段分组？**

只是为了记录（我认为这不是很相关），我使用的是*MS SQL Server 2005*

**[更新]**

我尝试并测试了[Bill Karwin](https://stackoverflow.com/questions/384923/sql-query-grouping-by-an-ntext-field#384957)提出的两种解决方案，它们都运行良好。因此，我决定将计数聚合结果分组到一个子查询中……即 Karwin 的后一种解决方案。

所以这是我更新的（完全有效的）声明：

```
SELECT bk.*, bc.books_sold
FROM books_book bk
INNER JOIN (
    SELECT bk2.id_book, COUNT(*) books_sold
    FROM books_book bk2 
    INNER JOIN orderdetails_orddetails ord 
    ON (bk2.id_book = ord.id_book_orddetails)
    GROUP BY bk2.id_book
) bc
ON (bk.id_book = bc.id_book)
ORDER BY books_sold desc; 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-21T21:08:17.500

旧的 PHP“mssql”扩展只支持最大 255 字节的 VARCHAR。这是一个已知的限制，这也是微软一直在开发新的 PHP 扩展来支持现代 SQL Server 版本的原因。

一种解决方法是将该列的存储声明为 NVARCHAR，但是当您从 PHP 查询它时，请使用 CAST 将其转换为 NTEXT。然后可以返回全长。

另一种选择是将列存储为 NTEXT，但仅`book_id`通过将计数放入子查询中进行 GROUP BY：

```
SELECT bk.*, bc.books_sold
FROM books_book bk
  INNER JOIN (SELECT bk2.book_id, COUNT(*) books_sold
      FROM books_book bk2 INNER JOIN orderdetails_orddetails ord 
        ON (bk2.id_book = ord.id_book_orddetails)
      GROUP BY bk2.book_id) bc
    ON (bk.book_id = bc.book_id); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-21T21:04:47.787

首先，不要使用bk.*，使用你实际需要的列的完整列列表。

我无法回答问题 1，但这是对问题 2 的回答：不要选择和分组 on `desc_book`，而是像这样投射它：（`CAST(desc_book AS NVARCHAR(2000)) AS desc_book`或其他适当大小的 nvarchar）。

# linux - SVN (mod_dav) 403 禁止选项请求

> ID：384927
> 
> 赞同：2
> 
> 时间：2008-12-21T20:48:51.297
> 
> 标签：linux, svn, apache, debian

因此，我尝试使用带有 apache2 的 mod_dav 设置颠覆服务器，但是当我尝试连接时，它给了我一个 403 FORBIDDEN 错误。这是我的默认虚拟主机文件

```
名称虚拟主机 *:443
名称虚拟主机 *:80
<虚拟主机 *:80>
    ServerAdmin webmaster@localhost
    服务器名称 hcs-dev

    文档根目录 /var/www
    <目录/>
        选项 FollowSymLinks
        AllowOverride 无
    </目录>
    <目录/var/www/>
        选项索引 FollowSymLinks
        AllowOverride 无
        命令允许，拒绝
        允许所有人
    </目录>

    ScriptAlias /cgi-bin/ /usr/lib/cgi-bin/
    <目录“/usr/lib/cgi-bin”>
        AllowOverride 无
        选项 ExecCGI -MultiViews +SymLinksIfOwnerMatch
        命令允许，拒绝
        允许所有人
    </目录>

    错误日志 /var/log/apache2/error.log

    # 可能的值包括：调试、信息、通知、警告、错误、暴击、
    # 警报，出现。
    日志级别警告

    CustomLog /var/log/apache2/access.log 结合
    服务器签名开启

    别名 /doc/ "/usr/share/doc/"
    <目录“/usr/share/doc/”>
        选项索引 MultiViews FollowSymLinks
        AllowOverride 无
        订单拒绝，允许
        拒绝一切
        允许来自 127.0.0.0/255.0.0.0 ::1/128
    </目录>
    <位置/repos/>
           DAV 开启
           DAV svn

           AuthzSVNAccessFile /svn_authz
           满足任何
           需要有效用户

           SVNParentPath /repos/
           AuthType 摘要
           身份验证名称“stevesvn”
           AuthUserFile /dig-pw
       </位置>
</虚拟主机>
<虚拟主机 *:443>
    SSLEngine 开启
    SSLCertificateFile /etc/apache2/ssl/apache.pem
    错误日志 /var/log/apache2/error.log
    <位置/repos/>
           DAV 开启
           DAV svn

           AuthType 基本
           身份验证名称“stevesvn”
           AuthUserFile /svn-pw.pw
           AuthzSVNAccessFile /svn_authz
           需要有效用户

           SVNParentPath /repos/
       </位置>
</虚拟主机>

```

关于可能导致这种情况的任何想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T14:49:08.810

在您给 Vinko 的后续消息中，您声明错误不是 403，而是 401。很可能是用户输入了错误的密码，或者密码文件本身没有列出，或者密码文件在第一名。请注意，您使用 /dig-pw 作为非 ssl 的密码文件，使用 /svn-pw.pw 作为 ssl 的密码文件。虽然拥有两组不同的密码文件可能没问题，但令人费解的是，将它们存储在硬盘的根目录中。对于 AuthzSVNAccessFile 也是如此。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T21:27:42.950

检查错误日志，对于浏览器上显示的每个错误，日志中都有一个匹配的条目，通常会提供更多信息。

查看[Apache httpd 的 wiki](http://wiki.apache.org/httpd/Logs)以获取更多信息。

# wpf - 如何从 png 图像中获取图标？

> ID：384931
> 
> 赞同：23
> 
> 时间：2008-12-21T20:51:31.400
> 
> 标签：wpf, png, icons

我正在创建一个 WPF 应用程序，所以我主要使用 ImageSource 类来处理图标。但是，系统托盘图标必须是`System.Drawing.Icon`. 是否可以从 png 图像创建这样的对象？

我尝试了以下方法：

```
private static System.Drawing.Icon _pngIcon;
public static System.Drawing.Icon PngIcon
{
    get
    {
        if (_pngIcon == null)
        {  
            //16x16 png image (24 bit or 32bit color)
            System.Drawing.Bitmap icon = global::BookyPresentation.Properties.Resources.star16;
            MemoryStream iconStream = new MemoryStream();
            icon.Save(iconStream, System.Drawing.Imaging.ImageFormat.Png);
            iconStream.Seek(0, SeekOrigin.Begin);
            _pngIcon = new System.Drawing.Icon(iconStream); //Throws exception
        }
        return _pngIcon;
    }
} 
```

Icon 构造函数引发异常并显示以下消息：“参数‘图片’必须是可用作图标的图片。”

我认为这可能与图像颜色的位深度有关，因为我之前遇到了一些问题，但是 32 位和 24 位图像都不起作用。我想做的事有可能吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-21T21:49:02.363

我认为您可以在将图像转换为 .ico 之前尝试这样的操作：

```
 var bitmap = new Bitmap("Untitled.png"); // or get it from resource
    var iconHandle = bitmap.GetHicon();
    var icon = System.Drawing.Icon.FromHandle(iconHandle); 
```

哪里`icon`将包含您需要的图标。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-24T17:08:13.830

还有一个网站 ( [http://www.convertico.com/](http://www.convertico.com/) ) 将 PNG 转换为 ICO。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-21T21:44:24.307

图标是 3 或 4 种图像尺寸的组合：

48 × 48、32 × 32、24 × 24（可选）和 16 × 16 像素。

并且可以/应该还包含三种不同的颜色深度：

*   24 位和 8 位 alpha（32 位）
*   8 位（256 色），1 位透明度
*   4 位（16 色），1 位透明度

所以 .png 内存流不适合图标的构造函数。事实上，如果您阅读有关其他[构造函数重载](http://msdn.microsoft.com/en-us/library/system.drawing.icon.icon.aspx)的注释，您将看到所有“大小”或宽度和高度测量值，以便在文件中找到正确的大小图标。

有关手动创建图标的更多信息，请参阅“[创建 Windows XP 图标](http://msdn.microsoft.com/en-us/library/ms997636.aspx)”

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-21T21:46:37.640

有一个名为[IconLib](http://www.codeproject.com/KB/cs/IconLib.aspx)的 .NET 项目。

```
public void Convert(string pngPath, string icoPath)
{
    MultiIcon mIcon = new MultiIcon();
    SingleIcon sIcon = mIcon.Add("Icon1");
    sIcon.CreateFrom(pngPath, IconOutputFormat.FromWin95);
    mIcon.SelectedIndex = 0;
    mIcon.Save(icoPath, MultiIconFormat.ICO);
} 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-08-12T12:49:29.760

试试这对我有用，

```
window.Icon = BitmapFrame.Create(Application.GetResourceStream(new Uri("YourImage.png",
UriKind.RelativeOrAbsolute)).Stream); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-21T22:04:31.597

您可以将`ImageSource`窗口图标的图标设置为 png 图像，它的工作原理令人惊讶。不过，我还没有为托盘图标验证这一点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-21T21:38:36.563

[您可以尝试一个名为png2ico](http://winterdrache.de/freeware/png2ico/)的小型命令行应用程序。我用它从 png 中创建 Windows 图标。

# visual-studio - Visual Studio 和“任何 CPU”选项的构建

> ID：384935
> 
> 赞同：2
> 
> 时间：2008-12-21T20:55:39.397
> 
> 标签：visual-studio

在最近的一集[.NET Rocks](http://www.dotnetrocks.com/about.aspx)（[第 404 集）](http://www.dotnetrocks.com/default.aspx?showNum=404)中，他们提到如果将平台目标设置为 x86 而不是“任何 CPU”，则可以减少许多 Visual Studio 问题。我做了一些谷歌搜索，找不到任何关于它的信息。

在我的公司，我们混合使用了 32 位 (x86) 和 64 位 (x64) 开发人员机器。在不同机器上的开发人员之间来回切换时，丢失安装在“程序文件（x86）”与“程序文件”下的第三方组件的引用存在一些问题。

切换到目标 x86 机器会使用“程序文件 (x86)”解决此问题吗？

此外，是否有网站或帖子我可以阅读更多关于此的内容（我找不到任何内容！）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-21T22:41:45.877

The underlying switch is `/platform:`. I suggest reading *[/platform (C# Compiler Options)](http://msdn.microsoft.com/en-us/library/zekwfyz4.aspx)* first.

If your third-party components are unmanaged code (or the assembly was built with anything but `/platform:anycpu`), you need to target 32 bit (unless the vendor provides a 64-bit version). It is just easier to target the lowest common denominator so building isn't complicated by creating one configuration for 64 and another for 32 bits.

Check out [an answer to Stack Overflow question *Should .NET 'Any CPU' projects bind to Framework or Framework64 DLLs?*](https://stackoverflow.com/questions/319585/should-net-anycpu-projects-bind-to-framework-or-framework64-dlls#319612) as well.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-02-06T10:20:01.810

[http://blogs.msdn.com](http://blogs.msdn.com)上有很多帖子讨论了 Visual Studio 2010 中的问题和变化。例如，*[AnyCPU Exes 通常比它们的价值更麻烦](http://blogs.msdn.com/b/rmbyers/archive/2009/06/09/anycpu-exes-are-usually-more-trouble-then-they-re-worth.aspx)*。

当然，没有一种方法是完美的。就我个人而言，我认为[WoW64](http://en.wikipedia.org/wiki/WoW64)是微软提供的最糟糕的东西，但它有时确实对我有帮助。

# javascript - Javascript onmouseout 睡觉？

> ID：384939
> 
> 赞同：0
> 
> 时间：2008-12-21T20:57:15.663
> 
> 标签：javascript, onmouseout

在 Javascript 中，我希望我的 onmouseout 事件在生效前休眠/暂停/等待/（不确定此处的正确术语）三秒钟。这是如何实现的？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-21T21:02:33.890

```
function outfunction(event) {
    var that = this; // to be able to use this later.
    window.setTimeout(function() {
        …
    /* you can use 'that' here to refer to the element
       event is also available in this scope */
    }, 3000);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T21:03:00.160

```
var doSomething = function () {
    //Some code will here after 3 seconds of mouseout
};

anElement.onmouseout = function () {
   setTimeout(doSomething, 3000);
}; 
```

上面的代码所做的是在被调用`doSomething`3 秒后执行函数`onmouseout`

# c# - 在 .NET 中创建 ZIP 存档的最佳/最简单方法是什么？

> ID：384955
> 
> 赞同：34
> 
> 时间：2008-12-21T21:07:42.040
> 
> 标签：c#, .net, zip

你认为哪种方法是“最好的”。

*   使用`System.IO.Packaging`命名空间？
*   使用与 Shell 的互操作？
*   .NET 的第三方库？
*   与开源非托管 DLL 互操作？

[我可以针对 Framework 3.5；最好 = 最容易设计、实施和维护。]

我最感兴趣的是为什么你认为选择的方法是最好的。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-12-21T21:11:36.650

我一直使用[SharpZipLib](http://www.icsharpcode.net/OpenSource/SharpZipLib/)

忘了为什么部分：主要是因为它已经存在了很长时间。它有据可查，并且有一个直观的 API。另外，如果您喜欢这种类型的东西，它是开源的。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-21T21:19:10.520

我发现[DotNetZip 库](http://www.codeplex.com/DotNetZip/)是处理 zip 文件的最简单方法。[SharpZipLib](http://www.icsharpcode.net/OpenSource/SharpZipLib/)是一个更加强大和灵活的解决方案。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-01-04T03:47:09.623

[DotNetZip](http://www.codeplex.com/DotNetZip)使用起来非常简单。我喜欢它，因为它是完全托管的——不需要 shell 交互。编程模型比 shell 更简单、更干净。它也比 SharpZipLib 以及 .NET 3.0 中添加的 Packaging 类更简单。它是免费的、小型的、积极维护的。

它比一个海报提供的 J# 选项要好得多 - J# 是一个巨大的运行时和一个巨大的药丸，只能吞下 ZIP 支持。J# 支持也将停止。在 J# 上引入新的依赖关系可能不是一个好主意。

DotNetZip 的示例代码：

```
 try
  {
      using (ZipFile zip = new ZipFile(args[0], System.Console.Out))
      {
          zip.AddDirectory(args[1]); // recurses subdirectories
          zip.Save();
      }
  }
  catch (System.Exception ex1)
  {
      System.Console.Error.WriteLine("exception: " + ex1);
  } 
```

DotNetZip 适用于 .NET v2.0、3.0、3.5 以及 Compact Framework v2.0 和 3.5。它处理 ZIP 文件、Unicode 文件名、注释、密码。它做 ZIP64 以及自解压档案。它很快。尝试一下。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2014-05-09T08:49:32.387

我意识到这是一个老问题，但我只是想我会添加一个更新的答案。如果您使用的是 .NET 4.5，那么您可以使用新的内置[`ZipFile`类](http://msdn.microsoft.com/en-us/library/system.io.compression.zipfile%28v=vs.110%29.aspx)以编程方式轻松地将多个文件保存到一个 zip 文件夹中。

首先，您需要将文件准备到一个新文件夹（`Directory.CreateDirectory`, `File.Move`）中，然后您可以简单地使用[`ZipFile.CreateFromDirectory`方法](http://msdn.microsoft.com/en-us/library/hh485707%28v=vs.110%29.aspx)（改编自链接页面）：

```
string filePathOfNewFolder = @"c:\example\start";
string zipFilePath = @"c:\example\result.zip";

ZipFile.CreateFromDirectory(filePathOfNewFolder, zipFilePath); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-21T21:15:15.270

System.IO.Compression 命名空间下的 GZipStream 和 DeflateStream 类使压缩内容变得非常容易。

更新：评论正确地指出这些类不允许您操作 Zip 文件。但是，J# dll 在 java.util 和 java.io 命名空间中包含所需的功能。有关更多详细信息，请参阅dmihailescu的[代码项目文章，其中详细介绍了它们的使用并提供了示例代码。](http://www.codeproject.com/KB/recipes/cpzipstrip2.aspx)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-22T03:46:32.233

没有人提到[Xceed](http://xceed.com) Zip 组件。我以前用过它，它非常适合创建 zip 文件和压缩数据流。我强烈推荐它，但可能需要权衡许可费。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-21T21:16:36.343

由于您的目标是 Framework 3.5，我会选择`System.IO.Packaging`. 它是专为压缩而设计的库，并附带框架，因此产品甚至不需要额外的 DLL。但是，使用示例很糟糕。

不推荐使用 shell。首先，它只适用于 Windows XP 及更高版本。但即使你不在乎，它的陷阱也很多（我以前做过，但只是因为我真的别无选择）。

如果您的目标不是 3.5，我会使用[`SharpZipLib`](http://www.icsharpcode.net/OpenSource/SharpZipLib/). 这是一个相当不错的库，即使您使用的是 3.5，您也可以考虑使用它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-06-24T10:06:09.373

Ultimate ZIP 是一个高性能且可靠的压缩组件，可让您轻松创建和操作 ZIP、TAR、TGZ、GZ 档案，并在您的 .NET 跨平台中浏览先前创建的档案的内容应用。它完全用 C# 编写，应用了最佳设计模式和低级 .NET 优化，它为您的 .NET 应用程序提供了性能、可靠性和可扩展性。该软件包附带了许多代码片段和 VB.NET 和 C# 中完整记录的示例，说明了如何创建、压缩和解压缩档案。

[.NET 的终极 ZIP 组件](http://www.thedownloadplanet.com/reviews/review-zip-professional-bundle-net-and-mobile/)

# iphone - copyplist 失败，退出代码为 71

> ID：384962
> 
> 赞同：1
> 
> 时间：2008-12-21T21:15:27.250
> 
> 标签：iphone, xcode, build, plist, adhoc

我有一个正在发货的 iPhone 应用程序（*vConqr* - 你应该去买它:-)）。我在几台不同的机器上构建了这个项目，包括一位同事的机器，它运行良好。然而，就在最近，在我的第二台开发机器上，我的构建每次都失败并出现错误：

`/Developer/Library/Xcode/Plug-ins/CoreBuildTasks.xcplugin/Contents/Resources/copyplist Entitlements.plist --outdir /Code/iPhone/VirtualConquest/build/Debug-iphonesimulator/VirtualConquest.app`

`error: can't exec '/Developer/Library/Xcode/Plug-ins/CoreBuildTasks.xcplugin/Contents/Resources/copyplist' (No such file or directory)`

我已经重新安装了 XCode - 两次！（第二次我先删除了/Developer/Library/Xcode下的文件）。我已经删除了我的源代码树并重新检查了源代码控制。错误仍然存​​在。

自从我开始上一个 beta 程序以来，Entitlements.plist 文件已经存在了几个星期。我不能确定，但​​我怀疑我没有在我的第二台开发机器上编译，因为它被添加了。但是，除了我的主要开发机器外，它在我的同事机器上也都可以正常运行，所以我很困惑有什么不同。

我已经用谷歌搜索了这个错误，但是我的 Google-Fu 是假的，或者这不是一个常见的错误——我没有找到相关的命中。

这真的很令人沮丧，尤其是因为我使用我的第二台机器作为浸泡测试/持续集成机器。

有人遇到同样的事情，或者有任何其他建议吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-19T20:54:39.267

我遇到了这个问题，并将其归结为我的 ruby​​ 安装的问题 - 不是真正的问题，但无论如何

通过对我的 ruby​​ 安装的正确位置进行符号链接来解决它

sudo ln -s /opt/local/bin/ruby /usr/bin/ruby

希望这对某人有所帮助，因为它使我发疯了！另外，可能不是您的 ruby​​ 安装此文件只是加载核心库，因此只需运行该文件（如果存在）即可对其进行跟踪

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-14T01:52:56.140

是的，我从自定义 ruby​​ 安装中获得了这个，更通用的修复是：

sudo ln -s `which ruby​​` /usr/bin/ruby

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-11T21:12:01.313

从这里： http: [//fr.ivolo.us/posts/when-rails-devs-go-iphone](http://fr.ivolo.us/posts/when-rails-devs-go-iphone)

在您喜欢的文本编辑器中打开 copyplist，然后更改

```
#!/usr/bin/ruby 
```

到

```
#!/usr/local/bin/bash 
```

我只需要使用 #!/usr/local/bin/ruby 来让它使用我的系统安装的 ruby​​，但我想你也可以输入任何 RVM ruby​​ 路径。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T21:29:51.247

该文件存在于我的机器上。尝试对 Xcode 进行第三次全新的重新安装（在删除整个 /Developer 树之后 - Xcode 安装应该重新添加整个内容）。然后立即检查该文件是否存在，因为它应该存在。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-25T15:47:18.060

这发生在我身上，但它与损坏的语言字符串文件有关。我在其中一个字符串中有一个额外的字符（参见示例）

x"英文字符串" = "国际字符串";

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-29T06:00:55.827

就我而言，问题要简单得多：

我从 SVN 中删除了一些 Localization.strings 文件，也忘记将它们从 Xcode 项目中删除。

我从项目中删除了它们，现在它可以工作了。

# c# - 我可以深度克隆没有标记 ICloneable 或 Serializable 的 ac# 对象吗？

> ID：384969
> 
> 赞同：15
> 
> 时间：2008-12-21T21:22:00.670
> 
> 标签：c#, clone

我有一个不是我自己写的对象，我需要在内存中克隆。对象未标记`ICloneable`或`Serializable`通过接口进行深度克隆或序列化将不起作用。反正有没有深度克隆这个对象？可能是不安全的 win32 API 调用？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-21T21:33:13.703

仅供参考 标记为`ICloneable`的接口不一定是深度复制的。这取决于实施者来实施`ICloneable`，并且不能保证他们会克隆它。

你说对象没有实现`ISerializable`，但它有`Serializable`属性吗？

通过二进制序列化创建深层副本可能是我所知道的最简单的方法之一，因为您可以用 3-5 行代码克隆任何复杂的图形。另一种选择是`XmlSerializer`对象是否可以`XmlSerialized`（您没有为序列化指定任何属性或实现接口，但是如果有一个`IDictionary`接口是您的软管。

除此之外，我真的什么都想不出来。如果所有数据都可以公开访问，您可以进行自己的克隆程序。如果不是，您仍然可以通过使用反射来克隆它来设置私有数据。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-21T21:47:10.260

“深”是棘手的一点。对于浅拷贝，您可以使用反射来复制字段（假设没有一个是只读的，这是一个很大的假设） - 但否则很难让它（自动）工作。

另一种选择是自己提供序列化程序（并序列化为深度克隆）——“序列化代理”。[这是](http://www.codeproject.com/KB/dotnet/Surrogate_Serialization.aspx)一个 VB 示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-21T21:46:01.743

我认为你可以做到这一点的唯一方法是认真思考以分离对象及其所有成员（它们本身可能是具有成员的其他对象等）。这就是框架序列化程序将要做的事情，但它只会对已适当标记的事物执行此操作。

我不确定像 Mono.Cecil 这样的工业级反射库是否有一些有用的东西。

我怀疑您是否提出了一个强大的通用解决方案（例如，静态成员可能难以正确处理），但您可能会在特定情况下使某些东西起作用。

# c# - 尝试将 XML 内容存储到 SQL Server 2005 中失败（编码问题）

> ID：384974
> 
> 赞同：10
> 
> 时间：2008-12-21T21:26:05.590
> 
> 标签：c#, sql, xml, sql-server-2005

伙计们，

我有一个以 ISO-8859-1 编码返回数据的网络服务 - 因为它不是我的，所以我无法更改它:-(

出于审计目的，我想将这些调用生成的 XML 存储到 SQL Server 2005 表中，其中我有一个类型为“XML NULL”的字段。

从我的 C# 代码中，我尝试使用参数化查询将此 XML 内容存储到 XML 字段中，例如

```
SqlCommand _cmd = new SqlCommand("INSERT INTO dbo.AuditTable(XmlField) VALUES(@XmlContents)", _connection);

_cmd.Parameters.Add("@XmlContents", SqlDbType.Xml);
_cmd.Parameters["@XmlContents"].Value = (my XML response);

_cmd.ExecuteNonQuery(); 
```

问题是 - 当我运行这段代码时，我得到一个错误：

> Msg 9402, Level 16, State 1, Line 1
> XML 解析：第 1 行，字符 xy，无法切换编码

?? 我试图弄清楚我可以在哪里以及如何“切换”编码 - 到目前为止还没有运气。这到底是什么意思？我无法在 SQL Server 2005 中使用 ISO-8859-1 编码存储 XML？或者是否有一个技巧来 a) 告诉 SQL Server 2005 只接受这种编码，或者 b) 在存储到 SQL Server 之前自动将 Web 服务响应转换为 UTF 编码？

感谢任何提示，指针，提示！马克

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-22T08:01:08.210

[您需要转换为 utf-16](http://blog.stevehorn.cc/2007/07/sql-2005-xml-column-unable-to-switcth.html)

即使我使用它，我也不是 SQL Server 中的 XML 专家，但我们去年遇到了同样的问题，与发送的 xml 相比，SQL 中声明的字符串数据类型不匹配。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T21:35:45.807

我在谷歌上找到了这个。[http://social.msdn.microsoft.com/forums/en-US/sqlxml/thread/d40ef582-4ffe-4f4b-b6b8-03c6c0ba1a32/](http://social.msdn.microsoft.com/forums/en-US/sqlxml/thread/d40ef582-4ffe-4f4b-b6b8-03c6c0ba1a32/)

我想你可以换行

```
_cmd.Parameters.Add("@XmlContents", SqlDbType.Xml); 
```

和

```
_cmd.Parameters.Add("@XmlContents", System.Data.SqlTypes.SqlXml); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-21T21:43:36.257

您能否将 xml 重写为 unicode（可能是 a `MemoryStream`）并发送？注意：如果您只是*存储*数据，则可以使用`varbinary(max)`（实际上会更快）。这没有编码困难，并且还允许您审核您收到的任何损坏的 xml。

如果您在数据库服务器中以 xml 形式查询数据，那么`xml`显然是要走的路。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-27T12:57:04.453

我发布了一些信息：

[http://mrboratech.blogspot.com/2009/02/how-to-store-xmldocument-mssql-2005-as.html](http://mrboratech.blogspot.com/2009/02/how-to-store-xmldocument-mssql-2005-as.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-07-07T09:12:26.373

*编辑*
我错过了问题的 ISO-8859-1 部分 - 下面的解决方案适用于 UTF8，但显然不能解决 Marc 的问题，因为他无法更改编码。

* * *

这是我使用的解决方案：

*   [将 XML 插入 SQL 数据库](http://www.shrinkrays.net/code-snippets/csharp/inserting-xml-into-a-sql-database-the-correct-way.aspx)

以及上面代码的略微修改版本（我已经使用 SQL 2005 使用 UTF8 文件对其进行了测试）：

```
using System.IO;
using System.Text;
using System.Data;
using System.Data.SqlClient;
using System.Data.SqlTypes;

...
using (SqlConnection connection = new SqlConnection("conn string"))
{
    connection.Open();
    string sql = "INSERT INTO mytable (xmlColumn) VALUES (@xmlData)";
    using (SqlCommand command = new SqlCommand(sql, connection))
    {
        // Swap round if the source file is unicode         
        string xml = File.ReadAllText(@"C:\myxml.xml");
        //string xml = File.ReadAllText(@"C:\myxml.xml", Encoding.Unicode);

        using (MemoryStream stream = new MemoryStream())
        {
            using (StreamWriter writer = new StreamWriter(stream, Encoding.Unicode))
            {
                writer.Write(xml);
                writer.Flush();
                stream.Position = 0;

                SqlParameter parameter = new SqlParameter("@xmlData", SqlDbType.Text);
                parameter.Value = new SqlXml(stream);
                command.Parameters.Add(parameter);
                command.ExecuteNonQuery();
            }
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-01-08T06:54:18.507

即使我在将 xml 内容插入数据库时​​也遇到了类似的问题。对于 ex ，输入是这样的：

```
Insert Into TestData(Xml) Values ('<?xml version="1.0" encoding="UTF-8"?><Test/>') 
```

这种陈述曾经失败，我得到“无法切换..”错误。后来我只是像这样将 N 前缀到 xml 字符串：

```
Insert Into TestData(Xml) Values (N'<?xml version="1.0" encoding="UTF-8"?><Test/>') 
```

在此之后它开始工作！

# javascript - div 通过 iframe 结束

> ID：384981
> 
> 赞同：1
> 
> 时间：2008-12-21T21:30:17.593
> 
> 标签：javascript

我想通过 iframe 在包含活动播放器的视频上放置一个 div

可能吗 ？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T21:43:10.720

如果您正在谈论的视频是 Flash 中的，只要您在 Flash 嵌入代码中设置 wmode=transparent，您就可以使用 css z-index 将 HTML 放置在 Flash 内容之上。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-02T05:00:04.777

其实你可能想使用`wmode="opaque"`

# algorithm - 什么是最好的图像缩小算法（质量方面）？

> ID：384991
> 
> 赞同：87
> 
> 时间：2008-12-21T21:40:56.433
> 
> 标签：algorithm, image, resize

我想找出可用于缩小光栅图片大小的最佳算法。最好我的意思是能给出最好看的结果的那个。我知道双三次，但还有更好的东西吗？例如，我从一些人那里听说，Adobe Lightroom 有某种专有算法，它比我使用的标准双三次产生更好的结果。不幸的是，我想在我的软件中自己使用这个算法，所以 Adob​​e 精心保护的商业机密是行不通的。

**添加：**

我检查了 Paint.NET，令我惊讶的是，在缩小图片尺寸时，超级采样似乎比双三次更好。这让我想知道插值算法是否完全可行。

它还让我想起了我自己“发明”但从未实现过的算法。我想它也有一个名字（因为这个微不足道的东西不可能是我一个人的想法），但我在流行的名字中找不到它。超级采样是最接近的。

这个想法是这样的——对于目标图片中的每个像素，计算它在源图片中的位置。它可能会覆盖一个或多个其他像素。然后可以计算这些像素的面积和颜色。然后，要获得目标像素的颜色，只需计算这些颜色的平均值，将它们的面积添加为“权重”。因此，如果目标像素覆盖黄色源像素的 1/3 和绿色源像素的 1/4，我会得到 (1/3*yellow + 1/4*green)/(1/3+ 1/4)。

这自然是计算密集型的，但它应该尽可能接近理想，不是吗？

这个算法有名字吗？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2011-05-30T02:49:09.513

不幸的是，我找不到原始调查的链接，但是随着好莱坞电影摄影师从胶片转向数字图像，这个问题出现了很多，所以有人（也许是 SMPTE，也许是 ASC）聚集了一群专业的电影摄影师并向他们展示了镜头已经使用一堆不同的算法重新调整。结果是，对于这些观看大型电影的专业人士来说，一致认为**Mitchell**（也称为高质量 Catmull-Rom）最适合放大，而**sinc**最适合缩小。但是 sinc 是一个理论上的滤波器，它会趋于无穷大，因此无法完全实现，所以我不知道“sinc”实际上是什么意思。它可能指的是 sinc 的截断版本。**兰佐斯**是 sinc 的几个实用变体之一，它试图改进只是截断它，并且可能是缩小静止图像的最佳默认选择。但像往常一样，这取决于图像和您想要的内容：例如，缩小线条图以保留线条是一种情况，您可能更喜欢强调保留边缘，而这在缩小花朵照片时会不受欢迎。

[在剑桥的 Color](http://www.cambridgeincolour.com/tutorials/image-resize-for-web.htm)中有一个很好的例子来说明各种算法的结果。

*fxguide*的人们汇总[了很多](http://www.fxguide.com/featured/Keeping_Your_Renders_Clean/)关于缩放算法的信息（以及很多关于合成和其他图像处理的其他内容），值得一看。它们还包括可能对您自己的测试有用的测试图像。

现在 ImageMagick 有一个[关于重采样过滤器的广泛指南，](http://www.imagemagick.org/Usage/filter/)如果你真的想进入它。

具有讽刺意味的是，关于缩小图像存在更多争议，理论上这是可以完美完成的事情，因为你只是丢弃信息，而不是关于放大，你试图添加没有的信息'不存在。但从兰佐斯开始。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2008-12-21T21:48:34.093

[Lanczos 采样](http://en.wikipedia.org/wiki/Lanczos_resampling)比双三次采样要慢，但会产生更高质量的图像。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2010-10-24T04:23:27.867

（双）线性和（双）立方重采样不仅丑陋，而且在缩小小于 1/2 的因子时非常不正确。它们将导致非常糟糕的混叠，类似于您将得到的结果降低 1/2 倍然后使用最近邻下采样。

就我个人而言，我建议对大多数下采样任务进行（区域）平均样本。它非常简单、快速且接近最佳。高斯重采样（选择的半径与因子的倒数成正比，例如，半径 5 用于下采样 1/5）可能会以更多的计算开销提供更好的结果，并且在数学上更合理。

使用高斯重采样的一个可能原因是，与大多数其他算法不同，只要您选择适合重采样因子的半径，它对于上采样和下采样都可以正常工作（不会引入伪影/混叠）。否则，要支持两个方向，您需要两种单独的算法 - 用于下采样的区域平均（对于上采样将降级为最近邻），以及用于上采样的（双）立方（对于下采样将降级为最近邻）。从数学上看高斯重采样的这种良好特性的一种方法是，具有非常大半径的高斯近似于区域平均，而具有非常小的半径的高斯近似于（双）线性插值。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-21T22:20:47.617

不久前我在 Slashdot 上看到一篇关于[Seam Carving](http://www.seamcarving.com/)的文章，可能值得一看。

> 接缝雕刻是由 Shai Avidan 和 Ariel Shamir 开发的图像大小调整算法。该算法不是通过缩放或裁剪来改变图像的尺寸，而是通过智能地从图像中删除（或添加像素）不重要的像素来改变图像的尺寸。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-09-18T17:55:15.603

您描述的算法称为线性插值，是最快的算法之一，但在图像上并不是最好的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-06-08T15:40:40.713

> 这个算法有名字吗？

它在文献中可能被称为“盒子”或“窗口”重采样。实际上，它的计算成本比您想象的要低。

它还可以用于创建中间位图，随后由双三次插值使用，以避免在下采样超过 1/2 时出现混叠。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-03-08T04:01:20.597

如果有人感兴趣，这是我的面积平均缩放算法的 C++ 实现：

```
void area_averaging_image_scale(uint32_t *dst, int dst_width, int dst_height, const uint32_t *src, int src_width, int src_height)
{
    // 1\. Scale horizontally (src -> mid)
    int mid_width  = dst_width,
        mid_height = src_height;
    float src_width_div_by_mid_width = float(src_width) / mid_width;
    float mid_width_div_by_src_width = 1.f / src_width_div_by_mid_width;
    std::vector<uint32_t> mid(mid_width * mid_height);
    for (int y=0; y<mid_height; y++)
        for (int x=0; x<mid_width; x++)
            for (int c=0; c<4; c++) {
                float f = x * src_width_div_by_mid_width;
                int i = int(f);
                float d = ((uint8_t*)&src[i + y*src_width])[c] * (float(i) + 1 - f);
                float end = f + src_width_div_by_mid_width;
                int endi = int(end);
                if (end - float(endi) > 1e-4f) {
                    assert(endi < src_width);
                    d += ((uint8_t*)&src[endi + y*src_width])[c] * (end - float(endi));
                }
                for (i++; i < endi; i++)
                    d += ((uint8_t*)&src[i + y*src_width])[c];
                int r = int(d * mid_width_div_by_src_width + 0.5f);
                assert(r <= 255);
                ((uint8_t*)&mid[x + y*mid_width])[c] = r;
            }

    // 2\. Scale vertically (mid -> dst)
    float mid_height_div_by_dst_height = float(mid_height) / dst_height;
    float dst_height_div_by_mid_height = 1.f / mid_height_div_by_dst_height;
    for (int y=0; y<dst_height; y++)
        for (int x=0; x<dst_width; x++)
            for (int c=0; c<4; c++) {
                float f = y * mid_height_div_by_dst_height;
                int i = int(f);
                float d = ((uint8_t*)&mid[x + i*mid_width])[c] * (float(i) + 1 - f);
                float end = f + mid_height_div_by_dst_height;
                int endi = int(end);
                if (end - float(endi) > 1e-4f) {
                    assert(endi < mid_height);
                    d += ((uint8_t*)&mid[x + endi*mid_width])[c] * (end - float(endi));
                }
                for (i++; i < endi; i++)
                    d += ((uint8_t*)&mid[x + i*mid_width])[c];
                int r = int(d * dst_height_div_by_mid_height + 0.5f);
                assert(r <= 255);
                ((uint8_t*)&dst[x + y*dst_width])[c] = r;
            }
} 
```

# php - PHP和MySQL设计地图搜索网站

> ID：384996
> 
> 赞同：1
> 
> 时间：2008-12-21T21:44:37.753
> 
> 标签：php, sql, mysql, gis

我有一个项目来设计一个网站来搜索数字地图上的邮政编码。有人建议我将 PHP 与 postgreSQL 或 MySQL 一起使用。

我的教授想让我告诉他为什么我选择这个作为地图绘制站点。

问题是...... GIS 站点是否有专业的网络语言？如果我使用 MySQL 或 MSsql 或什至 Access 如果有与其他远程数据库的连接，有什么区别？？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-21T21:50:29.363

可能是我不完全理解你的问题，但是：

MySQL 和 PHP 是不错的选择，但据我所知，选择无关紧要。您可以使用任何数据库以任何语言执行此操作。随便你最舒服。虽然我知道我学习 GIS 的朋友在 Python 中完成了他的大部分项目。

我不确定你在追求什么，我知道大学希望你从头开始做事，但如果我是为一个项目做这件事，听起来扩展谷歌地图可以让你完成 99% 的工作？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-21T23:21:36.310

使用您最熟悉的语言和数据库 + Google Maps 或 Microsoft MapControl。

如果你被问到为什么选择这些技术，你可以说实话——你最喜欢使用它们，这样你的工作效率最高，因为任何语言或数据库都可以。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-05T00:54:57.927

至于数据库中的 LAT/LON 支持，Access 将在空间 SELECT(s) 方面为您提供几乎为零的压缩。PostgreSQL 对此有更成熟的支持，但 MySQL 在过去一年左右的时间里已经迎头赶上，并且在最新版本中有这种工作方法。MySQL 的版本显然比 PostgreSQL 略快，但缺少一些更高级的空间功能，因此它几乎仅限于查找与特定坐标范围匹配的记录。我不能代表 Microsoft 的 SQL 解决方案，但对于大量数据，您将希望坚持使用 PostgreSQL/MySQL 以提高性能——除非您想使用 Oracle，但即便如此，性能差异也可以忽略不计。M$ SQL 在性能方面非常糟糕，Access 永远不会扩展。

理想情况下，您应该评估每个数据库引擎在处理地理空间数据方面具有哪些功能，并根据应用程序的要求选择哪一个执行得最好并且具有最好的特性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-21T23:33:20.640

PHP 和 MySQL 是高度可用的，通常是免费的，学习曲线比大多数语言更简单，并且提供（像许多语言一样）你需要的东西。

我已经使用谷歌地图、位置搜索（基于 LAT/LON 或邮政编码）、交互式地图和 KML 数据完成了几个地图项目。MySQL 和 PHP 功能强大。********`