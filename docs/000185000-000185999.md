# StackOverflow 问答 000185000-000185999

# java - java.beans.Introspector getBeanInfo 不获取任何超接口的属性

> ID：185004
> 
> 赞同：5
> 
> 时间：2008-10-08T21:27:05.683
> 
> 标签：java, reflection, javabeans

我刚刚注意到 java.beans.Introspector getBeanInfo 没有获取任何超级接口的属性。例子：

```
public interface Person {
    String getName();
}
public interface Employee extends Person {
    int getSalary();
} 
```

即使 name 是从 Person 继承的，对 Employee 进行内省也只会产生薪水。

为什么是这样？我宁愿不必使用反射来获取所有吸气剂。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-15T07:38:58.773

Sun bug [java.beans.Introspector does not work for interfaces中介绍了这个问题](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=4275879)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-03-30T08:50:14.200

[正如Phil](https://stackoverflow.com/questions/185004/java-beans-introspector-getbeaninfo-does-not-pickup-any-superinterfaces-properti/867423#867423)所写，Java VM 不支持开箱即用。我也需要这个并实现了一个[帮助类](http://kenai.com/projects/deut/sources/repo/content/trunk/src/diergo/util/BeanHelper.java)作为[Diergo Utils 1.5](http://kenai.com/projects/deut)的一部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T04:47:17.340

尝试使用

```
public static BeanInfo getBeanInfo(Class<?> beanClass, Introspector.USE_ALL_BEANINFO); 
```

看看这是否会产生您正在寻找的结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-12T23:45:26.187

在这种情况下，您应该编写一个自定义 BeanInfo 类。

# svn - 如何对可能无法按顺序完成的并行开发的里程碑进行版本化？

> ID：185014
> 
> 赞同：5
> 
> 时间：2008-10-08T21:30:28.393
> 
> 标签：svn, versioning

我目前正在与其他五个开发人员一起开发一个项目，我们正在使用 subversion 作为我们的修订控制系统。我们已经确定，在我们的软件首次发布之前，我们有 12 个里程碑。我们使用版本号（0.1 到 0.12）和描述性标签标记了里程碑。例如：

*   0.1 - 导航
*   0.2 - 搜索
*   0.3 - 用户管理

但是，每隔几个里程碑就会有一个由之前的里程碑组成的外部版本。因此，我们最终会得到以下内容：

*   0.1 - 导航
*   0.2 - 搜索
*   0.3 - 用户管理
*   0.4 - 阿尔法 1

这些里程碑中的每一个都可以并行开发，但它们也需要并行进行质量检查。我们通过在 subversion 中为每个里程碑创建分支来做到这一点，只需用里程碑的版本号标记。自动化系统独立构建每个里程碑，并使用里程碑编号和构建应用程序的颠覆修订号对应用程序进行版本控制。版本号显示在应用程序的显着位置，因此当 QA 团队查看版本号时，他们可以将其与特定的里程碑联系起来，并知道哪些需要进行 QA，哪些不需要。一旦里程碑通过了 QA，它将被合并到主干中，并且任何正在进行的开发都将使用最新代码进行更新。

但是，有一个假设（正确地），版本号的增加包括所有以前的版本。不幸的是，对于上述方案，这可能不会发生，因为一个里程碑可能在另一个里程碑之前完成。例如，0.3 可能会在 0.1 之前完成。这意味着我们将有一个不包含 0.2 或 0.1 功能的内部 0.3 版本。

这是我的问题。当多个并行版本（内部或其他）可能不按顺序完成时，我如何智能地对软件进行版本控制？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T22:19:44.190

我不认为你可以，因为你有相互冲突的目标——并行开发和连续的里程碑。

要么在 0.1 和 0.2 完成之前推迟发布 0.3 版本，要么必须考虑另一种分配里程碑编号的方法。

也许您可以根据里程碑命名而不是使用 0.1 等，这样可以增加清晰度并消除混淆。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T22:24:12.823

由于内部里程碑没有真正的顺序，我更愿意为外部版本保留次要版本号，给出反映该功能的分支名称，并添加 subversion 修订以标识内部版本。您的外部版本获得了非常干净的 0.1、0.2、0.3 版本，而 0.2.1234 的内部版本可以很容易地在 Subversion 中准确地检查在外部版本 0.2 和此版本之间合并到主干中的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T23:13:31.273

我有点困惑为什么你要用数字来区分分支；根据特性（例如车门、车辆方向盘）命名每个分支，并使用版本号跟踪每个分支的进度（车门 v0.1、0.2 等）。

但是，如果您打算稍后集成，除非您非常非常小心，否则这将是地狱。您可能想考虑管理这可能变得多么疯狂。

# .net - 温莎集装箱和内部属性

> ID：185026
> 
> 赞同：2
> 
> 时间：2008-10-08T21:37:16.413
> 
> 标签：.net, inversion-of-control, castle-windsor

是否有任何解决方案如何初始化标记为“内部”的组件的属性？我应该为 InternalsVisibleTo 属性使用什么程序集名称，否则它不会有帮助？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T21:53:50.310

internal 意味着它们只能被同一程序集中的代码访问。

也就是说，您可以使用反射器将程序集撕回原始代码，将访问修饰符更改为公共，然后将其编译回来。

除非程序集被混淆；在这一点上，你是一种 SOL。

# iis-6 - IIS 6 中的 HTTP 压缩 - 与第三方解决方案

> ID：185028
> 
> 赞同：2
> 
> 时间：2008-10-08T21:37:26.023
> 
> 标签：iis-6, compression, gzip

任何人都曾使用过 httpZip 产品（基于 ISAPI 的 IIS 压缩）。我想知道与 IIS6 中的本机压缩相比这是否值得……这两种方法的优点/缺点/陷阱？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T21:54:33.150

该网站本身会告诉您使用本机 IIS6，除非出于特定原因。如果一家公司告诉您不要使用他们自己的产品，那么他们一定是自己进行了比较，结果并不好。对于一家公司来说，像这样真正关注其用户是令人耳目一新的……如果您需要这些功能，请使用该产品，否则请查看他们的配置产品。

[http://www.port80software.com/products/httpZip/faq#HZonIIS6](http://www.port80software.com/products/httpZip/faq#HZonIIS6)

# opengl - GLUT：有什么方法可以在事件循环中添加“文件可读”挂钩？

> ID：185033
> 
> 赞同：0
> 
> 时间：2008-10-08T21:42:00.130
> 
> 标签：opengl, glut, event-loop

我想打开一个套接字并在 GLUT 事件循环上挂起一个可读事件......关于如何做到这一点的任何想法？可移植的标准 GLUT 代码是最好的，但我也对特定于平台的 hack 持开放态度。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-19T05:23:49.477

GLUT 不能很好地支持这一点。请参阅[GLUT 常见问题解答 #18](http://www.opengl.org/resources/libraries/glut/faq/#Q18)

您可以使用 glutIdleFunc 注册一个空闲函数，并在空闲函数中轮询您的套接字以查看是否有新数据可用。为了避免从套接字读取时发生阻塞，您需要通过调用将套接字设置为非阻塞：

```
#include <unistd.h>
#include <fcntl.h>
...
sockfd = socket(PF_INET, SOCK_STREAM, 0);
fcntl(sockfd, F_SETFL, O_NONBLOCK); 
```

（摘自[Beej 的网络指南](http://beej.us/guide/bgnet/output/html/singlepage/bgnet.html)）

这种方法的缺点是您的应用程序将每秒检查 60 次套接字状态，而不是仅仅等待网络数据进入。

# javascript - 在 JavaScript 中测试 DOM 元素的类型

> ID：185034
> 
> 赞同：101
> 
> 时间：2008-10-08T21:42:18.960
> 
> 标签：javascript, prototypejs

有没有办法在 JavaScript 中测试元素的类型？

答案可能需要也可能不需要原型库，但是以下设置确实使用了该库。

```
function(event) {
  var element = event.element();
  // if the element is an anchor
  ...
  // if the element is a td
  ...
} 
```

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2008-10-08T21:45:43.633

您可以使用`typeof(N)`来获取实际的对象类型，但您要做的是检查标签，而不是 DOM 元素的类型。

在这种情况下，请使用`elem.tagName`or`elem.nodeName`属性。

如果您想获得真正的创意，可以使用标记名字典和匿名闭包来代替开关或 if/else。

* * *

## 回答 #2

> 赞同：73
> 
> 时间：2008-10-08T21:44:33.170

```
if (element.nodeName == "A") {
 ...
} else if (element.nodeName == "TD") {
 ...
} 
```

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2008-10-08T21:58:38.600

也许您也必须检查节点类型：

```
if(element.nodeType == 1){//element of type html-object/tag
  if(element.tagName=="a"){
    //this is an a-element
  }
  if(element.tagName=="div"){
    //this is a div-element
  }
} 
```

编辑：更正了 nodeType-value

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-09T03:16:13.077

roenving 是正确的，但您需要将测试更改为：

```
如果（元素.nodeType == 1）{
//代码
}

```

因为 nodeType 为 3 实际上是一个文本节点，而 nodeType 为 1 是一个 HTML 元素。见[http://www.w3schools.com/Dom/dom_nodetype.asp](http://www.w3schools.com/Dom/dom_nodetype.asp)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-06-25T15:39:33.940

我通常从 toString() 返回值中得到它。它适用于不同访问的 DOM 元素：

```
var a = document.querySelector('a');

var img = document.createElement('img');

document.body.innerHTML += '<div id="newthing"></div>';
var div = document.getElementById('newthing');

Object.prototype.toString.call(a);    // "[object HTMLAnchorElement]"
Object.prototype.toString.call(img);  // "[object HTMLImageElement]"
Object.prototype.toString.call(div);  // "[object HTMLDivElement]" 
```

然后是相关的部分：

```
Object.prototype.toString.call(...).split(' ')[1].slice(0, -1); 
```

它适用于 Chrome、FF、Opera、Edge、IE9+（在较旧的 IE 中它返回“[object Object]”）。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2018-06-21T15:33:53.883

虽然前面的答案完美无缺，但我将添加另一种方式，其中元素也可以使用它们实现的接口进行分类。

有关可用接口，请参阅[W3 组织](https://www.w3.org/2003/01/dom2-javadoc/org/w3c/dom/html2/HTMLElement.html)

```
console.log(document.querySelector("#anchorelem") instanceof HTMLAnchorElement);
console.log(document.querySelector("#divelem") instanceof HTMLDivElement);
console.log(document.querySelector("#buttonelem") instanceof HTMLButtonElement);
console.log(document.querySelector("#inputelem") instanceof HTMLInputElement);
```

```
<a id="anchorelem" href="">Anchor element</a>
<div id="divelem">Div Element</div>
<button id="buttonelem">Button Element</button>
<br><input id="inputelem">
```

接口检查可以通过 2 种方式进行，`elem instanceof HTMLAnchorElement`或者`elem.constructor.name == "HTMLAnchorElement"`，两者都返回`true`

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-01-16T12:18:31.257

# 我有另一种测试方法。

```
Element.prototype.typeof = "element";
var element = document.body; // any dom element
if (element && element.typeof == "element"){
   return true; 
   // this is a dom element
}
else{
  return false; 
  // this isn't a dom element
}
```

# c# - 在弯曲的路径上绘制形状或图像

> ID：185037
> 
> 赞同：4
> 
> 时间：2008-10-08T21:43:22.610
> 
> 标签：c#, .net, graphics, vector-graphics

我正在寻找一个绘图库或代码示例来绘制沿着可能弯曲的路径重复的图像或矢量形状。

我找到了一个可可库，这是我正在寻找的[http://apptree.net/drawkitmain.htm](http://apptree.net/drawkitmain.htm)但对于 .NET。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T22:19:52.287

我会使用[可缩放矢量图形](http://www.w3.org/Graphics/SVG/)（SVG）。这是处理矢量图像的理想选择。你可能想看看 [SvgNet](http://www.jbrowse.com/svgnet/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-30T18:15:50.553

或者以 WPF 的形式使用本机 .Net。使用 DrawingBrush，您可以在您设计的任何矢量路径上投射您喜欢的任何内容。

# .net - 如何解决“%1 不是有效的 Win32 应用程序”？

> ID：185042
> 
> 赞同：12
> 
> 时间：2008-10-08T21:44:56.287
> 
> 标签：.net, asp.net, configuration, 64-bit, win64

**环境：**
Windows Server 2003 R2 Enterprise 64bit, SP2
.NET framework 应该安装（2.0 SP2, 3.0 SP2, 3.5 SP1）

我说“应该”是因为它们被列为已安装在添加/删除程序下。我不确定它是否*正确*安装，因为“ASP.NET”选项卡没有添加到 IIS 中的任何站点。

在 IIS Web 服务扩展部分，我同时拥有“ASP.NET v2.0.50727”（允许）和“ASP.NET v2.0.50727（32 位）”（禁止）。

有问题的站点启用了脚本执行。

**问题：**

我创建了一个超级简单的 ASP.NET/C# 网站：Default.aspx，标签为 id="Label1"，代码隐藏为：`Label1.text = "Hello World";`，我得到的错误是：

> %1 不是有效的 Win32 应用程序。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-08T21:48:50.883

您是否尝试过运行：

```
aspnet_regiis -i 
```

从命令行？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-09-20T01:28:36.027

还要检查您的应用程序池。在 64 位环境下，您可能需要在高级设置中设置“启用 32 位应用程序”。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-02-20T23:34:59.250

I had "%1 is not a valid Win32 application." error message because my PATH environment variable was messed up as well. It included this garbage from a python install:

```
%PYTHON_HOME%;
%PYTHON_HOME%\Scripts; 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-06T09:27:38.713

我有“%1 不是有效的 Win32 应用程序。” 错误消息，因为我的 PATH 环境变量搞砸了。好吧，更具体地说，PATH 本身没有任何问题。相反，我不小心创建了一个名为“C:\Program”的文件，而不是“C:\Program Files\”用于路径查找。意外创建“C:\Program”是在命令行上为 C:\Program Files\test.txt（不带引号）调用 Notepad++ 的结果，所以 Notepad++ 认为我正在尝试编辑一个名为“C: \Program" 并为我创建了文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T03:30:22.020

我在 Windows Server 2008 64 位上使用 IIS7 时遇到了类似的错误。

融合日志在这里没有任何帮助，事实证明，在我的情况下，有一个第三方程序集引用了一个仅 32 位的程序集或本机 dll。（非常精确）

要查找 64 位运行时正在加载哪个程序集：

*   在与您的应用程序池匹配的*w3wp.exe*进程上附加 VS2008 调试器
*   拦截所有异常（菜单调试/异常/检查所有“*公共语言运行时异常*”）。
*   确保您的应用程序已完全重新加载（例如，通过修改 web.config）。
*   *引发System.BadImageFormatException*异常时，请在堆栈跟踪查看器窗口中查找程序集名称。

请记住，放置在 bin 目录中的所有程序集都会被加载，无论它们在应用程序中的实际含义如何。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-04-09T19:51:40.687

I had this problem. I deployed an .EXE to a Windows 2003 that doesn't support .NET 4.5\. I rebuilt the program with .NET 4 and it worked.

# c - 用于 C 的 gvim 和 gdb？

> ID：185043
> 
> 赞同：14
> 
> 时间：2008-10-08T21:45:10.327
> 
> 标签：c, vim, gdb

在 emacs 中有一种方便的方法来启动 gdb（C 调试器）的 gdb 和 gui 选项。

gvim中有类似的选项吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-14T14:08:32.590

有一个名为[cgdb](http://cgdb.sourceforge.net)的项目旨在提供这种确切的行为。虽然它不像 emacs 那样从 vim 启动，但它提供了类似 vim 的键绑定和行为。它的功能包括一个单独的语法高亮源窗口，该窗口与当前执行的指令保持同步。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-08T23:11:37.300

看看[Vim 脚本搜索](http://www.vim.org/scripts/script_search_results.php?keywords=gdb)。我看到至少有 5 个插件可以满足您的需求。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T05:42:35.467

要完成[jkramer](https://stackoverflow.com/users/12523/jkramer)的响应，还有[pyclewn](http://pyclewn.wiki.sourceforge.net/home+)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-05-09T10:31:15.923

征服 GDB 正是您所寻找的。

见[http://www.vim.org/scripts/script.php?script_id=4582](http://www.vim.org/scripts/script.php?script_id=4582)

和[http://www.youtube.com/watch?v=ZcSjaYSoqnc](http://www.youtube.com/watch?v=ZcSjaYSoqnc)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-12T23:12:28.777

也许**Agide**是您正在寻找的东西：[http](http://www.a-a-p.org) ://www.aap.org/ 它是一种像 IDE 一样使用 vim 和 gdb 的开放框架。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-06-02T03:51:28.663

恕我直言，vim 的 gdb 插件都不能可靠地工作，主要是因为 vim 本身不支持 shell 集成。我使用 emacs+vimpulse.el。（vimpulse.el 是一个模拟 vim 的 emacs 包。） emacs+vimpulse.el 的行为与 vim 非常相似，并且 emacs 对 gdb 的支持与其他任何东西一样好。cgdb也很不错，不过我更喜欢emacs+vimpulse，因为不用记住emacs中的快捷键。（Mx gud- 显示所有可能的调试命令，并且每当执行命令时都会提醒快捷键。）此外，emacs 比 cgdb 更可定制。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-01-25T05:40:07.507

如果使用 neovim，请检查我的新 nvim 插件 gdb 前端： [neogdb.vim](https://github.com/huawenyu/neogdb.vim)。

## 特征

*   gdb 命令映射：下一步、步骤、完成、继续等。
*   断点：
    *   自动保存/加载，
    *   填充到本地列表：lopen
    *   侧面颜色标志
    *   三重状态：启用 -> 禁用 -> 删除
    *   切换当前行/切换所有断点
    *   支持条件集
*   回溯：
    *   填充到快速修复：copen

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2008-10-08T23:08:43.310

我不认为有。我使用不同的窗口。

我唯一能想到的是

```
!gdb blah blah blah 
```

但这可能不是您想要的。它往往被用来生成批处理文本，这些文本被插入到您正在编辑的文件中。

希望这可以帮助。

# c++ - C++ 测试框架：寻求推荐

> ID：185050
> 
> 赞同：4
> 
> 时间：2008-10-08T21:47:27.907
> 
> 标签：c++, windows, unit-testing, frameworks

我正在寻找可以在我的 Windows/Visual Studio 机器上使用的“快速而肮脏”的 C++ 测试框架。这只是我在开发，所以它不一定是企业级软件。盯着一列测试框架，我有点懵了……

[http://en.wikipedia.org/wiki/List_of_unit_testing_frameworks#C.2B.2B](http://en.wikipedia.org/wiki/List_of_unit_testing_frameworks#C.2B.2B)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-08T21:51:26.727

我已经使用过[UnitTest++](http://unittest-cpp.sourceforge.net/)和[Boost.Test](http://www.boost.org/doc/libs/1_36_0/libs/test/doc/html/index.html)。它们都易于设置和使用。虽然，如果您还没有使用 Boost 库，我不会使用 Boost.Test。安装所有的 Boost 只是为了获得测试框架有点多。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-08T21:55:30.447

好问题！已经有几个问题可以解决

一些：

*   [C++ 代码的单元测试 - 工具和方法](https://stackoverflow.com/questions/91384/unit-testing-for-c-code-tools-and-methodology)
*   [C++ 单元测试框架](https://stackoverflow.com/questions/87794/c-unit-testing-framework)
*   [单元测试 C 代码](https://stackoverflow.com/questions/65820/unit-testing-c-code)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-09T06:03:04.643

[这是一篇关于 C++ TDD 框架的精彩文章](http://www.gamesfromwithin.com/articles/0412/000061.html)。作为记录，我个人的偏好是 CxxTest，我已经愉快地使用了大约六个月。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-21T21:57:00.163

还可以看看[Google Test](https://github.com/google/googletest/blob/master/googletest/docs/primer.md)，Google 的 C++ 测试框架。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-21T22:06:01.453

我对 Mock 对象使用[UnitTest++](http://unittest-cpp.sourceforge.net/)和[AMOP](http://code.google.com/p/amop/)。

但是现在我会仔细研究一下[GoogleTest](http://code.google.com/p/googletest/)和[GoogleMock](http://code.google.com/p/googlemock/)，因为它们可能会很好地相互补充。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T13:52:39.407

为了得到一个基本的测试套件，我推荐只包含“果糖”。如果您希望您的测试在文本输出需要调用非标准 API（想想游戏机、嵌入式设备等）的平台上运行，它就特别简洁。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-12T22:14:22.267

看看[CUnitWin32](http://code.google.com/p/cunitwin32/)。它包括一个例子。

# silverlight - 如何更改 Expression Blend 中的默认浏览器

> ID：185052
> 
> 赞同：3
> 
> 时间：2008-10-08T21:47:43.007
> 
> 标签：silverlight, expression-blend

我想将 IE 设置为从 Expression Blend 运行 Silver light 应用程序的默认浏览器，但我不想从 Mozilla 更改我的 windows 默认值。Blend中有设置选项来执行此操作吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-09T04:48:59.927

现在没有设置可以做到这一点。它将使用默认配置的浏览器。

# c# - 学习 LINQ：快速排序

> ID：185072
> 
> 赞同：10
> 
> 时间：2008-10-08T21:52:45.727
> 
> 标签：c#, .net, linq

今天下午我冒险开始学习 LINQ，到目前为止，我只是在集合上使用 LINQ。我尝试的第一件事是实现 QSort。

现在——忽略我*可以*只使用 ORDERBY 并且这是一个非常愚蠢的 qsort 实现的事实——我想出的是：

```
public class lqsort
{
    public static List<int> QSLinq(List<int> _items)
    {
        if (_items.Count <= 1)
            return _items;

        int _pivot = _items[0];

        List<int> _less = (from _item in _items where _item < _pivot select _item).ToList();
        List<int> _same = (from _item in _items where _item == _pivot select _item).ToList();
        List<int> _greater = (from _item in _items where _item > _pivot select _item).ToList();

        return (QSLinq(_less).Concat(_same.Concat(QSLinq(_greater)))).ToList();
    }
} 
```

唯一真正让我烦恼的是所有涉及的演员。我可以使用任何 LINQ 技巧吗？还是我只是将 LINQ 用于它不打算用于的事情？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-08T22:20:21.130

只需将参数的类型更改为`IEnumerable`并使用`var`构造而不是您`List<int>`的局部变量。

这将使您的`QSLinq`方法更好，因为它将接受更多类型的参数，例如`int[]`，以及`List<int>`.

查看新方法：

```
 public static IEnumerable<int> QSLinq(IEnumerable<int> _items)
    {
        if (_items.Count() <= 1)
            return _items;

        var _pivot = _items.First();

        var _less = from _item in _items where _item < _pivot select _item;
        var _same = from _item in _items where _item == _pivot select _item;
        var _greater = from _item in _items where _item > _pivot select _item;

        return QSLinq(_less).Concat(QSLinq(_same)).Concat(QSLinq(_greater));
    } 
```

希望这可以帮助。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-09T01:59:53.840

有趣的问题！这并没有优于 OrderBy，但它确实限制了一些重复枚举。

```
 public static IEnumerable<int> QSort2(IEnumerable<int> source)
    {
        if (!source.Any())
            return source;
        int first = source.First();
        return source
            .GroupBy(i => i.CompareTo(first))
            .OrderBy(g => g.Key)
            .SelectMany(g => g.Key == 0 ? g : QSort2(g));
    } 
```

我在开发过程中无意中生成了一个 stackoverflow，因为我在 Key == 0 时进行了 QSorted。

* * *

只是为了好玩，我测试了这些解决方案。我提交了主要的性能测试罪（在调试模式下测试），但我认为这不会影响我们将看到的大 O 效应。这是输入（反向输入是快速排序的*最坏情况*）

```
IEnumerable<int> source = Enumerable.Range(0, 1000).Reverse().ToList(); 
```

*   三重 concat-where 解决方案耗时 71000 毫秒。
*   我的解决方案花了 330 毫秒
*   OrderBy.ToArray 花了 15 毫秒（计时器的分辨率，所以实际时间可能更少）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-08T22:15:23.370

这个怎么样？（如果我理解你不喜欢 .ToList 调用）

```
public static IEnumerable<int> QSLinq(IEnumerable<int> items)
{
    if (items.Count() <= 1)
        return items;

    int pivot = items.First();

    return QSLinq(items.Where(i => i < pivot))
        .Concat(items.Where(i => i == pivot))
        .Concat(QSLinq(items.Where(i => i > pivot)));
} 
```

*基于[Jon 回答](https://stackoverflow.com/questions/185072/learning-linq-quicksort#185139)*的免责声明：**请勿在实际问题中使用此算法。这是非常低效的。**

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-08T22:19:10.133

所有的选角都参与了吗？我没有看到任何铸造。我*所*看到的是对“ToList”的调用非常低效。基本上，LINQ 旨在处理序列，这本质上不允许您以快速排序倾向于的方式在原地（或重复空间）工作。基本上你在这里进行了大量的数据复制:(

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-09T02:53:46.553

这是另一个使用聚合的解决方案。我称之为： *Group and Go Fish*。我的 1000 个反向元素测试需要 170 毫秒。

```
 public static IEnumerable<int> QSort3(IEnumerable<int> source)
    {
        if (!source.Any())
            return source;
        int first = source.First();

        QSort3Helper myHelper = 
          source.GroupBy(i => i.CompareTo(first))
          .Aggregate(new QSort3Helper(), (a, g) =>
              {
                  if (g.Key == 0)
                      a.Same = g;
                  else if (g.Key == -1)
                      a.Less = g;
                  else if (g.Key == 1)
                      a.More = g;
                  return a;
              });
        IEnumerable<int> myResult = Enumerable.Empty<int>();
        if (myHelper.Less != null)
            myResult = myResult.Concat(QSort3(myHelper.Less));
        if (myHelper.Same != null)
            myResult = myResult.Concat(myHelper.Same);
        if (myHelper.More != null)
            myResult = myResult.Concat(QSort3(myHelper.More));

        return myResult;
    }

    public class QSort3Helper
    {
        public IEnumerable<int> Less;
        public IEnumerable<int> Same;
        public IEnumerable<int> More;
    } 
```

为什么这比我使用 OrderBy 的解决方案更快？我想它对最坏的情况更有抵抗力。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-02-23T18:54:13.137

所选答案已损坏，因为它在返回的集合中包含 QSLinq(_same) 而不仅仅是 _same，并导致 StackOverflowException。我将使用固定版本作为控件。如果解决方案可以使用复制，那么速度可以大大提高。使用线程而不是并行实际上会稍微降低复制变体的性能。对非复制变体使用线程会略微提高性能。来自控件的并行和非复制性能差异是疏忽大意的。

[![所有变体](https://i.stack.imgur.com/JpsFE.png)](https://i.stack.imgur.com/JpsFE.png)

[![复制变体](https://i.stack.imgur.com/pTtVa.png)](https://i.stack.imgur.com/pTtVa.png)

最快复制：

```
private static List<int> quickie7(List<int> ites)
{
    if (ites.Count <= 1)
        return ites;
    var piv = ites[0];
    List<int> les = new List<int>();
    List<int> sam = new List<int>();
    List<int> mor = new List<int>();
    Enumerable.Range(0, 3).AsParallel().ForAll(i =>
    {
        switch (i)
        {
            case 0: les = (from _item in ites where _item < piv select _item).ToList(); break;
            case 1: sam = (from _item in ites where _item == piv select _item).ToList(); break;
            case 2: mor = (from _item in ites where _item > piv select _item).ToList(); break;
        }
    });
    var _les = new List<int>();
    var _mor = new List<int>();
    Enumerable.Range(0, 2).AsParallel().ForAll(i =>
    {
        switch (i)
        {
            case 0: _les = quickie7(les); break;
            case 1: _mor = quickie7(mor); break;
        }
    });
    List<int> allofem = new List<int>();
    allofem.AddRange(_les);
    allofem.AddRange(sam);
    allofem.AddRange(_mor);
    return allofem;
} 
```

最快的非复制：

```
public static IEnumerable<int> QSLinq3(IEnumerable<int> _items)
{
    if (_items.Count() <= 1)
        return _items;
    var _pivot = _items.First();
    IEnumerable<int> _less = null;
    IEnumerable<int> _same = null;
    IEnumerable<int> _greater = null;
    ConcurrentBag<ManualResetEvent> finishes = new ConcurrentBag<ManualResetEvent>();
    Enumerable.Range(0, 3).AsParallel().ForAll(i =>
    {
        var fin = new ManualResetEvent(false);
        finishes.Add(fin);
        (new Thread(new ThreadStart(() =>
        {
            if (i == 0)
                _less = from _item in _items where _item < _pivot select _item;
            else if (i == 1)
                _same = from _item in _items where _item == _pivot select _item;
            else if (i == 2)
                _greater = from _item in _items where _item > _pivot select _item;
            fin.Set();
        }))).Start();
    });
    finishes.ToList().ForEach(k => k.WaitOne());
    return QSLinq(_less).Concat(_same).Concat(QSLinq(_greater));
} 
```

# c++ - 使用 SWIG (AIX 5.1) 从 Perl 调用 C++ 库时崩溃

> ID：185073
> 
> 赞同：4
> 
> 时间：2008-10-08T21:53:23.230
> 
> 标签：c++, perl, swig, aix

我试图在 AIX 5.1 机器上从 Perl 调用 C++ 库。我创建了一个非常简单的测试项目来尝试执行此操作。

我的 C++ 共享库 ( `test.cpp`)：

```
#include <stdio.h>
#include <iostream>

void myfunc()
{
    printf("in myfunc()\n");
    std::cout << "in myfunc() also" << std::endl;
} 
```

我的 SWIG 接口文件（`test.i`）：

```
%module test
%{
void myfunc();
%}
void myfunc(); 
```

然后我像这样构建共享对象：

```
swig -c++ -perl test.i
g++ -c test_wrap.cxx -I/usr/opt/perl5/lib/5.6.0/aix/CORE -o test_wrap.o
g++ -c test.cpp -o test.o
ld -G -bI:/usr/opt/perl5/lib/5.6.0/aix/CORE/perl.exp -bnoentry -bexpall -lc_r test.o test_wrap.o -o test.so 
```

此时，我有一个`test.so`应该可以在 perl 中加载的共享对象（通过生成的 SWIG `test.pm`）。我有一个非常简单的 perl 脚本来尝试加载共享对象并调用我正在导出的一个函数（`test.pl`）：

```
#!/usr/bin/perl
use test;
test::myfunc(); 
```

当我运行时`test.pl`，我得到以下输出：

> 在 myfunc()
> 非法指令（核心转储）

如果我注释掉 中的`std::cout`用法`myfunc`，它可以正常工作。似乎在 C++ STL 中使用任何东西都会导致核心转储（我尝试只声明 a `std::vector`and `std::stringstream`，两者都会导致核心转储）。我可以创建一个使用 STL 而没有任何问题的独立 C++ 可执行文件，只有在从 perl 加载时在我的共享对象中调用时，我才会遇到麻烦。

我也尝试过使用 xlc 而不是 gcc，但我得到了相同的结果。我在想我需要传递一些时髦的链接器标志以确保所有链接都正确发生？欢迎任何想法...

编辑：如果我使用`gcc`/链接`xlc`而不是直接调用链接器 ( `ld`)，我会立即遇到分段错误。当 perl 试图简单地加载共享库时，它看起来像崩溃了。像上面那样调用`ld`是最接近工作的方法，但我认为我可能缺少一些库或 C++ 库的特殊 AIX 链接器标志。

Edit2：好的，我已经开始工作了。AIX 在链接方面非常脆弱。我最终想出了以下似乎工作正常的链接命令：

```
ld -G -bI:/usr/opt/perl5/lib/5.6.0/aix/CORE/perl.exp -bnoentry -bexpall -lC -lc -ldl test.o test_wrap.o -o test.so 
```

我链接的库是最相关的。事实证明，提到库的顺序也非常重要（呃）。另请注意，这是针对 AIX 5.1 附带的 Perl 5.6.0 构建的。我已经尝试针对 Perl 5.8.8 构建同样简单的应用程序，但它不起作用。但是，我很确定更理智的链接方法（使用直接`gcc`/`xlc`而不是直接调用`ld`）似乎效果更好。所以这个问题似乎是 Perl 发行版或链接器或其他东西中的错误。

希望这将帮助一些被诅咒不得不使用 AIX 的可怜的灵魂......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-08T22:10:19.950

你不只是将你的 libstdc++ 添加到你的 ld 命令中吗？例如，`-lstdc++`？

复制您的问题后，我在 Linux 上所做的是：

```
gcc -g -lstdc++ -shared test*.o -o test.so 
```

然后问题就消失了。

（试图为 ld 获得正确的库列表是太多的工作，所以我只是告诉 gcc 为我做这件事。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T23:53:53.390

我对 SWIG 一无所知，但您可能还想检查它是否需要使用 cdecl（而不是 pascal、fastcall 或其他一些调用约定）的函数。在工具之间使用错误的工具可能会导致“坏事发生”（据我所知，通常是堆栈损坏）。

# dsl - 构建规范语言表示的一般复杂性是多少？

> ID：185080
> 
> 赞同：0
> 
> 时间：2008-10-08T21:55:30.587
> 
> 标签：dsl, language-theory, canonical-form

拥有语言的规范表示通常很方便（在我的情况下，它们通常是特定领域的语言）；但是，我相信所涉及的语言的表达能力有严格的限制，这些语言决定了是否可以为该语言的任意程序确定和/或创建规范形式。不幸的是，我一直找不到我（模糊地）记得在其中读过的参考资料。

一方面，创建语言的规范表示与许多硬图问题（例如：图同构）具有相当的复杂性似乎是合理的，但另一方面，iirc、gcc、yhc 和 ghc 等编译器使用中间表示生成各种格式的输出（程序集、javascript 等），所以这至少在某些形式下是一个已解决的问题。

何时可以确定/生成给定语言的规范形式？（该语言的表达能力如何，语言表达能力如何影响规范形式的效用？）如果可能，请提供参考或证明。

*编辑：*例如，[正则语言](http://en.wikipedia.org/wiki/Regular_language)（例如：正则表达式的“纯”形式）不能表达[图灵完备语言](http://en.wikipedia.org/wiki/Turing_complete)所能表达的许多相同的东西。换句话说，您不能用常规语言编写 Web 服务器，但可以使用 lambda 演算）。我的问题是关于理论上的可能性，并且确实有与复杂性理论有关的具体答案。如果我有一个 DSL 需要传输到另一个系统，那么在传输它之前生成该代码的规范形式通常是有益的，因为这将解耦两个不同系统使用的独立表示。 *然而*，如果将图灵完备语言翻译成规范形式是 P-Space 完备或 NP-Complete，那么您不应该浪费时间尝试构建规范形式——要么找到另一种方法，要么减少*可以*在多项式时间内规范化的语言复杂性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T20:57:20.550

通过“规范表示”，我假设您的意思如下：如果程序*P*和*Q* 在相同的输入上“做同样的事情”，则它们是*等效的。*“做同样的事情”意味着程序具有相同的输出，并且两个程序在有限时间后停止或都进入无限循环。这种等价关系定义了所有程序集合中的等价类。*程序P*的“规范表示”是属于同一等价类的程序*P' ，并且您要求同一等价类的所有成员具有相同的规范表示。*

对于图灵完备的语言，图灵可计算的规范表示将使您能够解决[停机问题](http://en.wikipedia.org/wiki/Halting_problem)，如下所示：首先编写一个由无限循环组成的程序并找到其规范表示*Q*。然后对于任何输入程序*P*，首先将它机械地转换成一个程序*P* [0]，除了它不产生输出之外，它做同样的事情，然后找到这个程序的规范表示*P* [0] '。如果结果是*Q*，您知道*P* [0]不会停止，因此*P*也不会。否则，*P* [0]停止，P 也*停止*.

要获得更多乐趣，请阅读[Gregory Chaitin](http://en.wikipedia.org/wiki/Gregory_Chaitin)关于他所谓的“优雅”程序的一些作品。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T17:15:40.607

在我看来，编译成汇编语言可以归类为以实用的方式翻译成规范形式。

# linux - 是否可以在进程级别限制 linux 可用的标准流？

> ID：185082
> 
> 赞同：3
> 
> 时间：2008-10-08T21:55:37.373
> 
> 标签：linux, stream, selinux

我希望能够生成一个只能访问 stdin、stdout 和 stderr 的 linux 进程（不多也不少）。我可以在流程级别本身执行此操作吗？我还含蓄地声明（矛盾修饰法）我不希望生成的进程能够更改流的另一端指向的“事物”。

比喻：

*   该进程有一个来自某个地方的输入管道，它无法更改管道的起始位置，因此它无法控制输入的来源。
*   该进程具有输出和错误管道，它无法更改输出管道的另一端指向的位置，因此它无法控制输出的位置。
*   它无法创建任何新管道。

我目前也在看 SElinux。这是否允许我创建一个只能访问这三个流的进程？谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T10:08:36.847

这听起来很像[这篇 LWN 文章中描述](http://lwn.net/Articles/120647/)的内容，它基本上阻止了除读取、写入和退出之外的所有系统调用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-20T00:16:49.387

正如另一个答案中所述，SELinux 确实具有有助于锁定任何进程的各种权限。

内核管理对某些对象的访问（具有相关的权限集），例如文件是对象，目录是对象，unix 数据报套接字是对象等等。

可能最简单的事情就是写一个小策略。幸运的是 SELinux 默认是拒绝的，所以运行你的程序并查看 SELinux 拒绝的日志，只允许你的程序做你想做的事。换句话说，您将避免添加涉及对象类的权限，例如 msg（systemV 消息队列中的消息）、msgq（SystemV 消息队列本身）、sem（信号量）、shm（共享内存）以及可能的其他权限，具体取决于它的功能。

我建议您第一次这样做时启用 SELinux，但要允许（请参阅 setenforce 0）

我还建议使用工具来帮助您建立一些策略，编写基本原始的 M4 可能有点难以承受

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T01:11:52.017

如果你是 root，你可以 chroot 到一个目录，删除权限，这样你就不再有文件系统写访问权限，然后 exec。这将阻止程序创建新文件。但是没有办法阻止程序创建管道和套接字（好吧，SELinux 可能没有套接字），也没有办法阻止程序重新排列和关闭其文件描述符。

好吧，我想您可以`ptrace`用来捕获所有系统调用，并且只允许您批准的系统调用，所以当我说“没有办法”时，我的意思是“没有简单的方法”。这会产生显着的开销，但如果你足够小心，你可以确保它的安全。如果您决定走这条路，那么 UMview[`strace`](http://sourceforge.net/projects/strace/)或[UMview](http://wiki.virtualsquare.org/index.php/UMview)项目可能是很好的起点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T05:14:41.310

SELinux 可以胜任；您可以为某些程序分配使用某些系统调用的权限。通过拒绝对 open、pipe 和其他人的访问，您应该能够完全按照您的描述进行操作。

第二种可能的方法是使用 LD_PRELOAD 功能，并提供您自己的 open、pipe 等。职能。这不是 100% 安全的，因为程序仍然可以更直接地访问系统调用（假设这是一个潜在的敌对程序）

# c# - 我可以从 C# 在远程应用程序域中注入线程吗

> ID：185083
> 
> 赞同：2
> 
> 时间：2008-10-08T21:55:40.727
> 
> 标签：c#, .net, appdomain, code-injection

我想知道是否可以将线程注入到在单独进程中运行的远程应用程序域中。

我的猜测是我可以使用调试接口（ICorDebug）来做到这一点，但我想知道是否还有其他方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-08T22:08:05.913

最近宣布了 Mono 提供的一个新工具来做到这一点。[请参阅有关程序集注入](http://tirania.org/blog/archive/2008/Sep-29.html)的这篇文章。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T20:14:17.517

Mike Stall 有一个关于如何使用 CreateRemoteThread 在托管应用程序中注入远程线程的[有趣示例。](http://blogs.msdn.com/jmstall/archive/2006/09/28/managed-create-remote-thread.aspx)

这个答案仍然不完整，因为我想在远程 appdomain 中运行新代码。我想我可以尝试创建一个为我加载库的新线程，另一个将调用我的新库中的一个位置来完成这项工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T20:18:33.793

还有另一种方法是使用`SetThreadContext`, 并通过更改目标进程的 EIP。但是我不知道你会如何在 C# 中做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-13T07:36:24.620

这可以在[snoop](http://blois.us/Snoop/)中的示例代码中完成。它设置了一个钩子，并使用托管 c++ 告诉 appdomain 加载程序集。真的很感人...

# delphi - Delphi 7 编译错误 - .res 和 .dfm 之间的“重复资源”

> ID：185091
> 
> 赞同：4
> 
> 时间：2008-10-08T21:58:38.490
> 
> 标签：delphi

我遇到了与以下错误非常相似的错误：

[如何修复此 delphi 7 编译错误 - “重复资源”](https://stackoverflow.com/questions/97800/how-can-i-fix-this-delphi-7-compile-error-duplicate-resources)

但是，我得到的错误是：

```
 [Error] WARNING. Duplicate resource(s):
  [Error]   Type 10 (RCDATA), ID TFMMAINTQUOTE:
  [Error]     File P:\[PATH SNIPPED]\Manufacturing.RES resource kept; file FMaintQuote.DFM resource discarded. 
```

Manufacturing.res 是默认资源文件（应用程序称为 Manufacturing.exe），FMainQuote 是其中一种形式。.dfm 文件是纯文本文件，所以我不确定复制了哪些资源，如何找到并修复它？

如果我尝试再次编译项目，它可以正常工作，但 exe 的图标与我在项目选项中使用“加载图标”按钮设置的图标不同。应用程序上的图标是某种我不认识的铃铛图像。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-09T00:12:52.043

尝试寻找额外的 {$R *.res} 或 {$R *.dfm}，您可能从某个地方复制了它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-09T01:53:45.880

Delphi 将您所有的 DFM 文件转换为资源，并将它们命名为类的名称。您可以通过使用资源编辑器并打开任何基于表单的 Delphi 应用程序来验证这一点。

在您的所有单位中搜索 TFMMAINTQUOTE 表单的实例。它最有可能在两个单元中，其中一个未链接到您的项目，但通过引用错误单元的使用子句被拉入（错误的因为它以不同的名称保存但具有相同的表单名称，如果它是您项目的一部分，那么当您首先添加该单元时编译器会抱怨）。

这个问题的简单解决方案是在你的项目中找到 TFMMAINTQUOTE 表单并将该表单重命名为其他名称，但旧的 TFMMAINTQUOTE 仍然会被拉入。

我建议使用一个好的目录 grep 工具，例如[GExperts](http://www.gexperts.org)中的那个来进行搜索。它将为您节省大量时间，并且可以根据需要设置为搜索整个硬盘驱动器。GExperts 的优势在于它是免费的并且直接集成到 Delphi IDE 中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-08T22:04:03.567

尝试将 Manufacturing,res 重命名为 Manufacturing.bak 或其他名称。Delphi 应该重新创建 res 文件。

您当然需要在新文件的 res 文件中重新创建任何引用、字符串等，但无论如何都值得尝试......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-05-30T05:30:38.833

我得到了同样的错误。我认为促成因素是：

1.  没有 *.res 文件
2.  与另一个项目的共同单位
3.  出现错误的项目的表单与另一个项目中的表单同名

解决方法：重命名表单（在项目中有报错信息）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-02-19T15:26:00.787

最近，当我试图将 DBISAM 数据库组件重新安装到调色板时，这种“警告。重复的资源：文件资源保持资源被丢弃”出现在 Delphi 7 中。

```
File D:\DELPHI\DBISAM\db324d6d.res resource kept; file 
  D:\DELPHI\DBISAM\db324d6d.res resource discarded.
Type 14 (ICON GROUP), ID MAINICON: 
```

正如您在上面看到的，当*恰好*出现这种与 RES 相关的 Delphi 错误情况**时，对同一资源有两个相同的通知**，在此处为“D:\DELPHI\DBISAM\db324d6d.res”文件。

我首先认为来自两个供应商包的资源存在冲突，所以我撕下并撕下其他已安装的组件。经过4个小时左右无果而终的挣扎，我终于发现出现了另一个DBISAM DPK包文件的Resource引用：

```
package db324d6d;
{$R *.res}
{$R 'db324d6d.res'}
... 
```

现在我记得 DBIsam 大约一周前抱怨“缺少 .RES 资源文件”。我定期检查，并确保 DPK 文件中存在该行并且 RES 文件在磁​​盘上。那时我可能已经以某种方式将第二行添加到 DPK 文件中，但还构建了包，并且我能够整周使用它。

现在，那条额外的线反击了，并且狠狠地打了它。我只是喜欢周六 4 小时的挣扎。

很快，如何解决它：删除这些资源行中的后者。当它们都指向相同的资源时会出现错误。

所以，只剩下这个：

```
package db324d6d;
{$R *.res}
... 
```

唷，我希望这对其他人有帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-09T22:12:36.540

额外`{$R *.res}`的在 *.dpr 文件中，如下所示：

```
program Test;

uses
  Forms,
  Unit1 in 'Unit1.pas' {Form1},
  Sample in 'Sample.pas',
  Proc in 'Proc.pas';

{$R *.res} //<----delete this if you put them in the Unt1.pas. ok.

begin
  Application.Initialize;
  Application.CreateForm(TForm1, Form1);
  Application.Run;
end. 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-20T08:58:17.703

如果您重命名一个 from 并且在其他 Units 的 Uses 部分中引用了此表单，那么您会收到上述错误。

溶液是上述的混合物。

(1) 将资源文件以.bak 结尾（这样以后会重新创建）。(2) 搜索所有单元并将旧单元/表格名称的引用更改为新的。(3) 重新编译，现在就ok了。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-09-16T10:19:42.500

编辑 RES 文件并从中删除重复的资源。这样您就可以保留原始图标。

# php - 如何在 MVC 中确定我的控制器？

> ID：185094
> 
> 赞同：2
> 
> 时间：2008-10-08T21:59:15.777
> 
> 标签：php, model-view-controller, controller

我对 MVC 相当陌生，来自 php 背景，当我需要登录表单之类的东西时，我通过视图设计并创建页面。我会有一个名为 login 的文件。只有当我需要一个新的登录表单来登录不同类型的用户时，这才很糟糕。说管理员。然后，我必须创建一个名为 login-admin.php 或类似性质的新页面。

最近我开始探索 MVC，尤其是框架，我遇到的最大问题是确定你的控制器到底是如何设计的。我被告知要么为每个视图文件路由使用一个控制器，要么根据您的域对象获取控制器。

我知道我可以有一个用户控制器和很多方法来操作该对象，比如用户/添加、用户/编辑、用户/删除、用户/配置文件。但是在这种情况下，似乎一旦您需要不一定适合“域对象”的视图，就很难决定将它们粘贴在哪里。

那么，在确定您的控制器将是什么时，最佳实践是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T22:09:36.393

我为每个“关注区域”使用一个控制器。这有点随意，通常是一个稍大的类别，基于域模型，包括多个对象。

换句话说，假设在您的域模型中，您将安全作为您关注的领域之一。它可能涉及许多视图和许多域对象，但我会将其设为一个控制器，处理所有与安全相关的操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T22:17:12.417

使用 Ruby on Rails（以及更多其他 MVC Web 框架），控制器通过某种路由配置映射到 URL。

例如， /mysection/view/2 通常映射到`controller = mysection`, `method = view`（`id = 2`在 Rails 中，这是默认映射，在 ./config/routes.rb: 中`map.connect ':controller/:action/:id'`）

当你说你有“一个用户控制器和很多操作该对象的方法说用户/添加、用户/编辑、用户/删除、用户/配置文件”时，我认为你的意思是一个模型 - 所以你会有 UserModel.create (), UserModel.find() 等。然后控制器将使用模型来编辑数据 - 实际的控制器应该只有几行代码调用模型（例如`@myuser = User.find(id)`），以及映射到 URL 的一些方法（比如说`/usercontroller/new`, `/usercontroller/edit`, `/usercontroller/view`）

该描述是相当特定于 Rails 的，但大多数 PHP 框架将非常相似——我知道 CodeIgniter 使用几乎相同的布局。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T22:39:10.250

在创建控制器时，我通常会考虑用户看到了什么，以及什么对用户来说是直观的，因为控制器被映射到 URL。

在您的示例中，如您所说，让所有与用户相关的页面具有 /user/edit、/user/profile 等格式是有意义的。但是，如果我是你，我不会有单独的管理员登录页面，我会使用相同的登录视图，并在其他地方处理管理位。

简而言之，通常我为用户在使用网站时会想到的每个关键概念制作一个控制器。因此，如果网站上的用户可以添加/删除朋友，我会认为这是一个独立的概念（而不是用户概念的一部分）。所以我会有一个朋友控制器，具有朋友/添加、朋友/列表、朋友/删除等功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T22:17:19.250

控制器更像是触发调用的一段代码。在封装良好的代码中，修改模型的方法出现在模型附近（在同一个域对象中）。然而，调用点是分开的（不是同一个域对象的一部分）。

一些框架，如 struts，提供可配置的控制器（使用 xml）。还有一个前端控制器的概念，其中通用控制器充当顶级委托人。我们可以使用这个前端控制器来处理琐碎的映射（不严格处理域）。

# xml - 用 xsl:text 解释换行符？

> ID：185101
> 
> 赞同：13
> 
> 时间：2008-10-08T22:04:36.247
> 
> 标签：xml, xslt, ant, xslt-1.0, whitespace

我有一个 XSL 样式表，其`xsl:text`节点中的内容如下：

```
<xsl:text>
foo
bar
baz
</xsl:text> 
```

样式表本身是一个带有“unix 风格”换行符的文本文件。我在 Windows 和类 unix 平台上调用这个样式表。如果输出符合调用它的平台的约定，那就太好了。

*当我在 Windows 上运行这个样式表时，除了*`xsl:text`节点的内容之外，输出都有回车/换行对。

**`xsl:text`我可以指示 XSLT 处理器将节点内容中的换行符转换为特定于平台的行尾吗？**

更多上下文：我正在从[Apache Ant 1.7.1 XSLT 任务](http://ant.apache.org/manual/Tasks/style.html)中调用样式表，如下所示：

```
<xslt in="in.xml" out="out.xml" style="stylesheet.xsl"/> 
```

样式表标题当前如下所示：

```
<?xml version="1.0"?>
<xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
    xmlns:xalan="http://xml.apache.org/xslt"
    exclude-result-prefixes="xalan">
    <!-- contents elided -->
</xsl:stylesheet> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-09T15:12:08.467

您可以像这样为样式表定义一个参数：

```
<xsl:param name="br">
    <xsl:text>&#10;</xsl:text>
</xsl:param> 
```

并通过在 Ant 脚本中使用嵌套的 param 元素传入适当的行尾字符。当然，此示例中的默认值是 Unix 风格的换行符。我认为要输出值，您必须使用：

```
<xsl:copy-of select="$br"/> 
```

它很冗长，但它有效。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-10T15:50:26.787

如果您从 Ant 调用转换，那么[您可以使用条件任务测试操作系统并测试操作系统系列](http://ant.apache.org/manual/Tasks/condition.html)：

```
 <condition property="linebreak" value="&#xD;&#xa;">
      <os family="windows"/>
  </condition>
  <condition property="linebreak" value="&#xa;">
      <os family="unix"/>
  </condition> 
```

然后将该参数传递给 XSLT 以指示您要使用哪个换行符。

```
 <xslt in="data.xml" out="${out.dir}/out.xml">
   <param name="linebreak" expression="${linebreak}" />
 </xslt> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T22:49:27.280

我不确定如何自动执行正确的换行符（它可能取决于您使用的 xslt 处理器），但您可以在文本节点的内容中强制换行符。\r\n 是 `&#xD; &#xA;`, \n 是`&#xA;`, 例如你会使用：

`<xsl:text>foo&#xD;&#xa;bar&#xD;&#xa;</xsl:text>`得到你正在寻找的输出。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-04-28T21:02:45.073

好吧，我让我的工作（使用撒克逊）结合了上述两个想法：

```
<xsl:param name="br">
        <xsl:text>&#xD;&#xa;</xsl:text>
</xsl:param> 
```

然后在需要的地方使用这些行。

```
<xsl:value-of select="$br" /> 
```

这是我的完整（但纤细）xsl

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <!--<xsl:strip-space elements="*" />-->
  <xsl:output method="text" />
  <!-- <xsl:preserve-space elements="*"/>-->
<xsl:param name="br">
        <xsl:text>&#xD;&#xa;</xsl:text>
</xsl:param>

  <!--  -->
  <xsl:template match="/">

    <xsl:for-each select="//root/Item">

        <xsl:value-of select="@Name" /> <!-- Your xpath will vary of course! -->
        <xsl:value-of select="$br" />

    </xsl:for-each>

</xsl:template> 
```

同样，我在 Windows 7 x64 机器上使用 Saxon %ProgramFiles%\SaxonHE\bin\Transform.exe。

# sql - SQL 日期范围拆分

> ID：185110
> 
> 赞同：7
> 
> 时间：2008-10-08T22:07:54.120
> 
> 标签：sql, date-range

你能告诉我当它们重叠时分割日期范围的SQL吗？

数据（具有日期范围和可能的其他列的示例数据）：

```
 Col1 FromDate ToDate
 1\. 1    1/1/2008 31/12/2010
 2\. 1    1/1/2009 31/12/2012
 3\. 1    1/1/2009 31/12/2014 
```

输出：

```
 Col1  From Date ToDate
1\. 1     1/1/2008 31/12/2008 (from row 1 above)
2\. 1     1/1/2009 31/12/2010 (from rows 1,2 and 3 above)
3\. 1     1/1/2011 31/12/2012 (from rows 2 and 3 above)
4\. 1     1/1/2013 31/12/2014 (from row 3 above) 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-08T23:12:19.903

这应该可以解决问题（MySQL方言，但很容易适应）

最初设定

```
SQL query: SELECT * FROM `test` LIMIT 0, 30 ;
Rows: 3
start       end
2008-01-01  2010-12-31
2009-01-01  2012-12-31
2009-01-01  2014-12-31 
```

询问

```
SELECT 
  `start` , min( `end` )
FROM (
  SELECT t1.start, t2.end
  FROM test t1, test t2
  WHERE t1.start < t2.end
  UNION
  SELECT t1.end + INTERVAL 1 DAY , t2.end
  FROM test t1, test t2
  WHERE t1.end + INTERVAL 1 DAY < t2.end
  UNION
  SELECT t1.start, t2.start - INTERVAL 1 DAY
  FROM test t1, test t2
  WHERE t1.start < t2.start - INTERVAL 1 DAY
) allRanges
GROUP BY `start` 
```

结果

```
start       min( `end` )
2008-01-01  2008-12-31
2009-01-01  2010-12-31
2011-01-01  2012-12-31
2013-01-01  2014-12-31 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T03:44:47.653

Skliwz 的答案适用于 SQL Server：

```
DECLARE @DateTest TABLE 
(
    FromDate datetime,
    ToDate datetime 
)

insert into @DateTest (FromDate, ToDate)
(
select cast('1/1/2008' as datetime), cast('12/31/2010' as datetime)
union
select cast('1/1/2009' as datetime), cast('12/31/2012' as datetime)
union
select cast('1/1/2009' as datetime), cast('12/31/2014' as datetime)
)

SELECT 
  FromDate , min(ToDate)
FROM (
  SELECT t1.FromDate, t2.ToDate
  FROM 
    @DateTest t1, 
    @DateTest t2
  WHERE t1.FromDate < t2.ToDate

  UNION

  SELECT dateadd(DAY, 1, t1.ToDate), t2.ToDate
  FROM 
    @DateTest t1, 
    @DateTest t2
  WHERE dateadd(DAY, 1, t1.ToDate) < t2.ToDate
) allRanges
group by FromDate 
```

# javascript - 去掉 jQuery 中的链接

> ID：185112
> 
> 赞同：5
> 
> 时间：2008-10-08T22:08:46.020
> 
> 标签：javascript, jquery

我有一些像这样的html：

```
<a href="#somthing" id="a1"><img src="something" /></a>
<a href="#somthing" id="a2"><img src="something" /></a> 
```

我需要去掉链接，所以我只剩下几个图像标签。使用 jQuery 执行此操作的最有效方法是什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-08T22:19:19.387

```
$("a > img").parent()   // match all <a><img></a>, select <a> parents
   .each( function()    // for each link
   { 
      $(this).replaceWith(              // replace the <a>
         $(this).children().remove() ); // with its detached children.
   }); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-08T22:20:43.737

这应该这样做：

```
$('a[id^=a]').each(function() { $(this).replaceWith($(this).html()); }); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T22:24:00.920

在普通的 javascript 中，它会是这样的：

```
<script type="text/javascript">
window.onload = function(){
  var l = document.getElementsByTagName("a");
  for(i=0, im=l.length; im>i; i++){
    if(l[i].firstChild.tagName == "img"){
      l[i].parentNode.replaceChild(l[i].firstChild,l[i]);
    }
  }
}
</script> 
```

# perl - 如何在不在@INC 的目录中“使用”Perl 模块？

> ID：185114
> 
> 赞同：61
> 
> 时间：2008-10-08T22:08:54.400
> 
> 标签：perl, module, relative-path

我的脚本的父目录中有一个模块，我想“使用”它。

如果我做

```
use '../Foo.pm'; 
```

我收到语法错误。

我试着做：

```
push @INC, '..';
use EPMS; 
```

和..显然没有出现在@INC

我要疯了！这里有什么问题？

* * *

## 回答 #1

> 赞同：107
> 
> 时间：2008-10-08T22:11:29.073

`use`发生在编译时，所以这会起作用：

```
BEGIN {push @INC, '..'}
use EPMS; 
```

但更好的解决方案是`use lib`，这是编写上述内容的更好方式：

```
use lib '..';
use EPMS; 
```

但是，如果您从不同的目录运行，`FindBin`建议使用：

```
use FindBin;                     # locate this script
use lib "$FindBin::RealBin/..";  # use the parent directory
use EPMS; 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-08T22:21:38.897

您可以通过多种方式修改`@INC`.

*   set `PERL5LIB`，如[perlrun中所述](http://perldoc.perl.org/perlrun.html)

*   使用`-I`命令行上的开关，也记录在[perlrun](http://perldoc.perl.org/perlrun.html)中。您也可以使用 PERL5OPT 自动应用它，但如果您要这样做，只需使用 PERL5LIB。

*   `use lib`在你的程序中，虽然这很脆弱，因为不同机器上的另一个人可能将它放在不同的目录中。

*   手动修改`@INC`，确保在编译时这样做，如果你想使用一个模块。不过这工作量太大了。

*   `require`直接文件名。虽然这是可能的，但它不允许该文件名加载同一目录中的文件。这肯定会在代码审查中引起注意。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-10-08T22:22:43.543

就个人而言，我更喜欢将我的模块（我为自己或我可以控制的系统编写的模块）保存在某个目录中，并将它们放在子目录中。如：

```
/www/modules/MyMods/Foo.pm
/www/modules/MyMods/Bar.pm 
```

然后我在哪里使用它们：

```
use lib qw(/www/modules);
use MyMods::Foo;
use MyMods::Bar; 
```

顺便说一句..在推动方面，我更喜欢粗箭头逗号：

```
push @array => $pushee; 
```

但这只是偏好问题。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-08T22:16:38.690

正如@ehemient 前面提到的，'use lib' 就是答案。另一种选择是使用 require/import 而不是 use。这意味着模块不会在编译时加载，而是在运行时加载。

这将允许您在尝试时修改@INC，或者您可以传递文件的路径而不是模块名称。从“perldoc -f 要求”：

> 如果 EXPR 是一个裸字，则 require 假定扩展名为“.pm”，并为您将文件名中的“::”替换为“/”，以便于加载标准模块。这种形式的模块加载不会改变您的命名空间。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-08T22:11:14.380

您必须`push`在 is 之前处理`use`- 并且`use`提前处理。所以，我相信你需要`BEGIN { push @INC, ".."; }`一个机会。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-20T22:57:23.910

正如“perldoc -f use”所报告的：

> 它完全等同于
> `BEGIN { require Module; import Module LIST; }`
> 除了 Module 必须是一个裸词。

换句话说，“使用”相当于：

*   在编译时运行，
*   将包名转换为文件名，
*   `require`-ing 那个文件名，并且
*   `import`-ing那个包。

因此，您可以在 BEGIN 块中调用 require 和 import，而不是调用 use：

```
BEGIN {
  require '../EPMS.pm';
  EPMS->import();
} 
```

当然，如果您的模块在调用 import 时实际上没有进行任何符号导出或其他初始化，则可以省略该行：

```
BEGIN {
  require '../EPMS.pm';
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-01-01T16:35:30.030

某些 IDE 无法与首选答案“use lib”一起正常工作。我发现 'use lib::relative' 适用于我的 IDE，JetBrains 的 WebStorm。

参见[POD for lib::relative](https://metacpan.org/pod/lib::relative)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2022-01-22T20:42:08.413

它不起作用的原因是因为您要添加的`@INC`内容与命令行中的当前工作目录相关，而不是脚本的目录。

例如，如果您目前在：

```
a/b/ 
```

您正在运行的脚本具有以下 URL：

```
a/b/modules/tests/test1.pl 
```

* * *

```
BEGIN {
    unshift(@INC, "..");    
} 
```

以上将意味着`..`结果是目录`a/`而不是`a/b/modules`.

在再次运行脚本之前，您必须在代码中更改`..`为或在命令行中执行 a。`./modules``cd modules/tests`

# c# - 从嵌套类访问封闭类中的字段的最佳方法是什么？

> ID：185124
> 
> 赞同：70
> 
> 时间：2008-10-08T22:12:49.477
> 
> 标签：c#, .net, inner-classes

假设我在表单中有一个下拉列表，并且我在这个类中有另一个嵌套类。现在从嵌套类访问此下拉列表的最佳方法是什么？

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2008-10-08T22:19:50.447

与 Java 不同，嵌套类不是特殊的“内部类”，因此您需要传递引用。Raymond Chen 有一个例子描述了这里的差异：[C# 嵌套类就像 C++ 嵌套类，而不是 Java 内部类](https://devblogs.microsoft.com/oldnewthing/?p=30273)。

这是一个示例，其中将嵌套类的构造函数传递给外部类的实例以供以后参考。

```
// C#
class OuterClass 
{
    string s;
    // ...
    class InnerClass 
    {
       OuterClass o_;
       public InnerClass(OuterClass o) { o_ = o; }
       public string GetOuterString() { return o_.s; }
    }
    void SomeFunction() {
        InnerClass i = new InnerClass(this);
        i.GetOuterString();
    }

} 
```

注意 InnerClass 可以访问 OuterClass 的“ `s`”，我没有修改 Raymond 的代码（正如我上面链接的那样），所以记住“ `string s;`”是`private`因为没有指定其他访问权限。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2008-10-08T22:21:31.020

嵌套类型不像 Java 中的内部类 - 没有包含类型的固有实例。（它们更像是 Java 中的静态嵌套类。）它们实际上是独立的类，有两个区别：

*   如果包含类型是泛型的，则嵌套类型由包含类型有效地参数化，例如`Outer<int>.Nested`与`Outer<string>.Nested`.
*   嵌套类型可以访问包含类型中的私有成员。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-08T22:21:36.387

与 Java 不同，在 C# 中没有对封闭类实例的隐式引用。

您需要将这样的引用传递给嵌套类。执行此操作的典型方法是通过嵌套类的构造函数。

```
public partial class Form1 : Form
{
    private Nested m_Nested;

    public Form1()
    {
        InitializeComponent();

        m_Nested = new Nested(this);
        m_Nested.Test();
    }

    private class Nested
    {
        private Form1 m_Parent;

        protected Form1 Parent
        {
            get
            {
                return m_Parent;
            }
        }

        public Nested(Form1 parent)
        {
            m_Parent = parent;
        }

        public void Test()
        {
            this.Parent.textBox1.Text = "Testing access to parent Form's control";
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-04-16T11:04:11.320

# 静态成员

由于到目前为止还没有人提到它：*根据您的情况*，如果成员变量也可以是**static**，您可以通过以下方式简单地访问它。

```
class OuterClass
{
    private static int memberVar;

    class NestedClass 
    {
        void SomeFunction() { OuterClass.memberVar = 42; }
    }
} 
```

*旁注：*我有`memberVar`目的地（并且冗余地）标记`private`以说明嵌套类访问其外部类的私有成员的给定能力。

### 注意/请考虑

在*某些情况下*，这可能是获得访问权限的最简单方法/解决方法，但是......

*   静态还意味着，该变量将在所有实例对象之间共享，并且存在所有缺点/后果（线程安全等）

*   静态也意味着，如果您有多个父类的实例并且变量应该为每个实例保存一个单独的值，这显然不起作用

所以在大多数情况下，你可能想采用不同的方法......

# 传递参考

正如大多数人所建议的那样（并且因为它也是最正确的答案），这里是传递对外部类实例的引用的示例。

```
class OuterClass
{
    private int memberVar;
    private NestedClass n;

    OuterClass()   { n = new NestedClass(this); }

    class NestedClass
    {
        private OuterClass parent;

        NestedClass(OuterClass p) { parent = p; }
        SomeFunction() { parent.memberVar = 42; }
    }
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2014-07-28T17:16:45.837

在某些情况下有用的另一种方法是从外部类派生嵌套类。像这样：

```
class Outer()
{
    protected int outerVar;
    class Nested() : Outer
    {
        //can access outerVar here, without the need for a 
        // reference variable (or the associated dot notation).
    }
} 
```

我已经使用了这种技术，特别是在[结构化单元测试](http://haacked.com/archive/2012/01/02/structuring-unit-tests.aspx/)的上下文中。（这可能不适用于 OP 的特定问题，但它通常对嵌套类很有帮助，例如这个“重复”问题：“[我可以访问内部类中的外部类对象](https://stackoverflow.com/questions/2957900/can-i-access-outer-class-objects-in-inner-class)”）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-08T22:23:55.180

您可以将封闭类作为参数传递给嵌套类构造函数，如下所示：

```
private NestedClass _nestedClass;
public ParentClass() 
{
   _nestedClass = new NestedClass(this);
} 
```

嵌套类通常不被推荐并且应该是私有的和/或内部的。在我看来，它们有时很有用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-08T22:28:51.317

如果我错了，请纠正我，您正在尝试处理内部类的外部控制，因此您遇到了这个问题。更好的方法是以事件驱动的方式处理事务。使用观察者模式，在外部控件上注册一个侦听器（您的嵌套/内部类将是侦听器）。让生活更简单。恐怕这不是你所期待的答案！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-09-22T08:05:36.693

将主类作为构造函数参数发送到嵌套（内部）类。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-05-31T05:03:36.760

上面有一个很好的答案，但我喜欢写某事。

c# 嵌套类默认是私有的

**如果您想使用**包含类的私有类，它必须是公共的

 **# c# - 当必须在 C# 中不断重绘控件时，如何避免屏幕闪烁？

> ID：185141
> 
> 赞同：3
> 
> 时间：2008-10-08T22:19:29.010
> 
> 标签：c#, .net, onpaint

我有一个简单的面板，用作绘图表面。这里的目标是在某些情况下围绕子 ListView 绘制一个 4 像素宽的轮廓。当可以将某些东西拖入其中时，我想让轮廓跳动。

我只是在 ListView 周围绘制一个简单的矩形，并在计时器滴答事件中更新矩形的不透明度。更改不透明度时，将重新绘制边框。此时我正在对这幅画进行双重缓冲。我也只允许每 15 次左右重绘一次（计时器间隔为 20 毫秒）。经过这一切，绘图过程仍然有点闪烁。这是不可接受的，所以我需要一些关于如何避免这种情况的指导。

我看不到经常绘制控件的方法。需要有一个从不透明到实体的平滑过渡，然后再返回。当我足够降低滴答间隔（降低到大约 300 -500 毫秒）时，闪烁停止，但刷新率太慢。

我对任何想法持开放态度。也许我接近这个的方式是完全错误的，或者也许你们中的一个人已经创建了一个发光效果并且知道该怎么做。感谢您提前提供任何帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T00:24:58.523

如果有人感兴趣，我偶然发现了一个解决方案。原来，闪烁是由背景的绘画引起的。我使用 SetStyle 告诉控件我将处理所有的绘画。

```
SetStyle(ControlStyles.SupportsTransparentBackColor |
         ControlStyles.Opaque |
         ControlStyles.UserPaint |
         ControlStyles.AllPaintingInWmPaint, true); 
```

然后，我首先在该区域上绘制透明颜色，然后绘制边框。我有点破解，但它就像一个魅力。

编辑：记住还要对图像进行双重缓冲。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-08T22:31:39.860

在表单上设置 DoubleBuffered = true。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T22:27:38.323

我没有一个强有力的答案，但既然你没有，我还是会发布：

首先，我从未使用过 System.Drawing.ImageAnimator 类，但这对您来说是更好的方法吗？

其次，如果失败了，您是否尝试过*不*使用双缓冲？这是一个很长的镜头，但也许您的双缓冲代码实际上使情况变得更糟。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T23:11:49.983

我很抱歉这可能无济于事：WPF 有动画并且至少在理论上可以顺利地做到这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T22:31:25.163

远射，但你试过吗

```
SetStyle(ControlStyles.OptimizedDoubleBuffer, true); 
```

在面板控制上？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T23:10:22.107

您可能还想查看在位图上进行绘图，然后仅显示位图（如果它已更改）。只是我的2c。

# javascript - 为什么这个远程脚本会导致 IE6 挂起？

> ID：185149
> 
> 赞同：-1
> 
> 时间：2008-10-08T22:21:17.963
> 
> 标签：javascript, internet-explorer-6, xss, jsonp

请查看下面列出的 html，让我知道为什么 IE6 在尝试加载远程脚本时冻结（位于“ [http://code.katzenbach.com/Default.aspx](http://code.katzenbach.com/Default.aspx) ”）。该脚本返回 JSONP 并执行标题中列出的“callbackFunction”。当它正确运行时，您会看到一个显示数字 1-500 的弹出警报。这在 FF3 和 IE7 中运行良好。我不明白为什么它在 Internet Explorer 6 中失败 - 处理器被固定并且一切都挂起。

自己运行它，如果您遇到同样的问题，请告诉我。我整天都在盯着这个问题。谢谢你的帮助。

安德鲁

```
<html>
<head>
    <script type="text/javascript">
    function callbackFunction(Result)
    {
        alert(Result) ;
    }
    </script>
    <script type="text/javascript" src="http://code.katzenbach.com/Default.aspx?callback=callbackFunction&test=true&c=500"></script>
</head>
<body>
Here
</body>
</html> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-10T22:26:05.613

我用 Fiddler 和 IE6 看了一下，看不到任何不寻常的东西（除了它冻结浏览器的事实）。

`http://code.katzenbach.com/Default.aspx?callback=callbackFunction&test=true&c=500`确实发出了请求并返回 2909 个字节。

我建议三件事：

1.  从您的 Content-Type: 中删除一个分号：`application/json;; charset=utf-8`或者`charset=utf-8`完全删除两个分号（只是为了测试）
2.  `)`发送完最终的后发送换行符`callbackFunction`
3.  将其更改为，`Content-Type: text/javascript`因为您确实将 Javascript 返回到浏览器，而其他内容类型可能会混淆 IE6（尽管这不太可能）。

我在想 1\. 很有可能。IE6 中可能存在解析错误，导致它在遇到两个分号时进入无限循环。因为否则根本没有任何理由说明您正在做的事情不应该起作用。

尝试不同的 MIME 类型作为测试也可能是值得的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T22:36:50.550

外部脚本的返回是：

```
callbackFunction(["0","1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160","161","162","163","164","165","166","167","168","169","170","171","172","173","174","175","176","177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375","376","377","378","379","380","381","382","383","384","385","386","387","388","389","390","391","392","393","394","395","396","397","398","399","400","401","402","403","404","405","406","407","408","409","410","411","412","413","414","415","416","417","418","419","420","421","422","423","424","425","426","427","428","429","430","431","432","433","434","435","436","437","438","439","440","441","442","443","444","445","446","447","448","449","450","451","452","453","454","455","456","457","458","459","460","461","462","463","464","465","466","467","468","469","470","471","472","473","474","475","476","477","478","479","480","481","482","483","484","485","486","487","488","489","490","491","492","493","494","495","496","497","498","499"]) 
```

为什么要提醒这个？
**你想解决什么问题？**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T22:37:18.973

如果您直接转到脚本 ( [http://code.katzenbach.com/Default.aspx?callback=callbackFunction&test=true&c=500](http://code.katzenbach.com/Default.aspx?callback=callbackFunction&test=true&c=500) )，您将看到文件（未知的 mime 类型）未被处理。这可能是由于您的服务器设置有问题。它似乎不知道如何处理 .aspx 而是尝试流式传输文件。

# java - Seam/JSF 中验证失败的导航

> ID：185180
> 
> 赞同：1
> 
> 时间：2008-10-08T22:32:05.397
> 
> 标签：java, rest, jsf, seam

我已经使用[Seam](http://www.seamframework.org/) (2.0.2.SP1) 玩了几个星期了，我已经掌握了大部分基础知识，但是我还没有想出一个像样的解决方案来解决以下问题。

假设我有一个位于 的表单`/foo.xhtml`，其中包含一个重写规则，以便将类似`/foo.seam?id=<fooId>`的 URL 转换为`/foo/<fooId>`. 表单上有`commandButton`一个 动作`#{fooHome.update}`。我还有一个导航规则，在`/foo.page.xml`成功发布后重定向回一个漂亮的、书签友好的 GET：

```
<navigation from-action="#{fooHome.update}">
    <rule if-outcome="updated">
        <redirect view-id="/foo.xhtml">
            <param name="id" value="#{fooHome.instance.id}"/>
        </redirect>
    </rule>
</navigation> 
```

问题是当发生验证错误时，导航规则被跳过，我最终在`/foo`POST 之后。

**我的问题：有没有办法重定向验证错误，所以我最终得到一个 GET 请求`/foo/<fooId>`而不是 POST to `/foo`？**

我尝试在 中滚动我自己的验证方法`fooHome`，返回“失败”结果，但我真的不希望无效数据通过验证阶段（从而进入当前对话）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-11T23:12:52.713

您通常会在验证失败时重新显示相同的视图，而不是重定向。假设您将 UrlRewrite 用于重写规则，也许您可​​以使用*出站规则*，以便在这种情况下仍显示*/foo/{fooId}* URL。

# c# - 替代静态类库

> ID：185185
> 
> 赞同：3
> 
> 时间：2008-10-08T22:35:21.053
> 
> 标签：c#, class, static

我有大量包含非常通用的静态方法的静态“实用程序”类。例如，我有一个 CollectionUtility 类，它具有有用的方法，例如：

公共静态无效 RemoveDuplicates（ICollection 集合）...等

在 C# 3.0 中，我一直在将这些转换为扩展方法。

现在，我听到一些谈话，在“企业级”应用程序中，通常认为最好的做法是避免使用这些静态类和方法的大型库。我想它可能很难维护。

对于那些为大公司从事大型企业项目的人来说，一个问题 - 你是否维护这样的实用程序类库？你是什​​么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T03:16:22.140

您正在谈论将成为共享库内容的代码。静态方法确实在共享库中占有一席之地。查看 System.Linq.Enumerable

我会遵循以下准则：

*   默认情况下，这些不是静态方法。它们应该只是静态方法，因为它们自然是无状态的（行为仅取决于参数）。如果它们不是自然无状态的，那么您应该创建一个适当的类来管理该状态。
*   用单元测试覆盖这些。如果您不对其他任何内容进行单元测试，请对这些内容进行单元测试。这应该很容易做到。如果这不容易，那是不对的。

如果依赖注入是你喜欢的东西，你仍然可以拥有它。依赖静态方法的代码可以改为调用 Func(T, U) 或引用该静态方法的 Action。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T22:41:53.177

绝对不。随着时间的推移，实用程序模块会变成大量粗糙的代码。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T22:43:57.510

我通常只将配置和常量之类的东西放在单例或静态类中，因为它永远不会改变，也可能是“全局的”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T03:38:25.560

> 我听过一些谈话，在“企业级”应用程序中，通常认为最好的做法是避免使用这些静态类和方法的大型库。我想它可能很难维护。

恕我直言，您应该应用泛型之类的东西来减少实用方法/库的大小，如果您只在一个地方使用实用方法，那么它不属于共享库，但归根结底你仍然可能有很多。

无论如何，这让我感到困惑。如果您没有将它们放在共享库中，您会将它们放在哪里？复制/粘贴到每个项目或类似的东西？

# .net - 如何使发布者策略文件重定向程序集请求

> ID：185187
> 
> 赞同：2
> 
> 时间：2008-10-08T22:36:36.403
> 
> 标签：.net, deployment, gac

我在工作中创建了一个通用库，它安装在我们测试服务器上的 GAC 中。我最近更新了它，我希望我们所有的应用程序都使用这个更新。我创建了一个发布者策略程序集并将其与更新一起安装在 GAC 中，但是当 Web 应用程序加载 Leggett.Common 1.0.0.0 时，它不会重定向到 Leggett.Common 1.1.0.0。

我在网络驱动器上有通用程序集（实际上有五个，但让我们保持简单），我在它旁边创建了发布者策略 xml 文件，然后使用 al.exe 在同一文件夹中创建发布者策略程序集。之后，我将更新的程序集放入 GAC，然后将发布者策略程序集放入 GAC。

公共程序集是“Leggett.Common.dll”，发布者策略文件是“1.1.Leggett.Common.policy”，发布者策略程序集是“policy.1.1.Leggett.Common.dll”。

发布者策略文件的 XML 如下所示：

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
    <runtime>
        <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
            <dependentAssembly>
                <assemblyIdentity name="Leggett.Common"
                                  publicKeyToken="32cd8f1a53a4c744"
                                  culture="neutral" />
                <bindingRedirect oldVersion="1.0.0.0"
                                 newVersion="1.1.0.0"/>
            </dependentAssembly>
        </assemblyBinding>
    </runtime>
</configuration> 
```

我究竟做错了什么？

**澄清**
我正在我的本地开发机器上测试这个，因为开发人员无权访问测试服务器。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T22:57:10.247

好吧……在刺中……

1 - 您是否尝试过使用[程序集绑定日志查看器 (Fuslogvw.exe)](http://msdn.microsoft.com/en-us/library/e74a18c4(VS.80).aspx)查看正在发生的程序集绑定？

您可以在以下位置找到它：

C:\Program Files\Microsoft SDKs\Windows\v6.0A\Bin\FUSLOGVW.exe（安装了VS2008）。

2 - “我有一个网络驱动器上的通用程序集（实际上有五个，但让我们保持简单），” - 两个程序集都驻留在网络驱动器上吗？

**更新：**好的...如果新程序集位于网络驱动器上，则可能存在一些[信任问题](http://blogs.msdn.com/shawnfa/archive/2003/06/20/57023.aspx)。您能否将新程序集部署到服务器上的本地驱动器，然后重新安装到 GAC？

**更新2 ：**我知道..愚蠢的东西....您肯定得到了正确的publicKeyToken和版本号？即新程序集的 AssemblyVersion 属性肯定是 1.1.0.0 并且公钥令牌相同（在 GAC 中）？

您是否尝试过删除文化属性？

**Update3：**嗨，Max....您能粘贴您使用的确切发布者策略文件吗？另外...请记住，如果您要从 1.0 重定向到更高版本的程序集，则发布者策略名称必须使用您从中重定向的程序集的 major.minor 版本命名。因此，在您的情况下，发布者策略应命名为“policy.1.0.Leggett.Common.dll”。我注意到您已将其命名为“policy.1.1.Leggett.Common.dll”，这可能是它无法正常工作的原因。

最后，您必须确保使用 1.0 和 1.1 程序集使用的相同密钥签署发布者策略。

我构建了几个 DLL 并将它们放在 GAC 中，然后在 VS 中使用控制台应用程序进行测试，它确实有效:)

**Update4：**嗨，Max，这是我从未想过的事情。创建发布者策略文件时，是否指定了平台？尝试使用以下方法构建它：

al /link:1.1.Leggett.Common.policy /out:policy.1.0.Leggett.Common.dll /keyfile: /version:1.0.0.0

省略 /platform 开关并明确指定版本号。

干杯
凯夫

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-20T22:52:54.993

您正确识别了程序集，但对于正在阅读的任何其他人，请在没有文件扩展名的*assemblyIdentity*元素中按其根目录引用程序集（例如，“Fubar”而不是“Fubar.dll”）。

微软的[文档](http://msdn.microsoft.com/en-us/library/b0yt6ck0.aspx)忽略了... #$%#!(!@!

# asp.net - CSS 和缺少常量/变量的问题？

> ID：185190
> 
> 赞同：2
> 
> 时间：2008-10-08T22:38:34.573
> 
> 标签：asp.net, .net, css, layout

给定具有对另一台服务器上的图像资源的完全限定引用的样式表，是否有一种通过需要不同基本 URL 的不同环境处理促销的好方法？

> 背景图像：网址（evironmentSpecificURL/resourceName.foo）；

environmentSpecificURL 会因环境而异，我不希望在开发、质量保证、暂存、生产等过程中修改此文件。

我有想法，但对其他人如何处理这个问题很感兴趣——我将发布我的一个想法。

让我强调（基于另一个响应）图像资源不存在于同一台服务器上，这就是将更改的 URL。所以相对路径在这种情况下不起作用。

此外，我试图避免需要修改可能存在多个 URL 实例的 CSS，并将该 URL 集中到一个配置点。

任何帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T22:43:01.663

您引用的资源实际上应该与您的 css 文件处于相对级别，这样它就只是一个“..\resourceName.foo”远离工作。

当然，您还可以查看自动生成站点特定环境区域的构建工具，因此所有属性（如 css 文件、.properties 文件等）都是通过构建工具链接 ANT 或 MSBuild 动态生成的

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T22:45:53.263

在 CSS 样式表中，基本 URL 是样式表的 URL，而不是包含它的文档的 URL。使样式表中的 URL 相对并适当地定位样式表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T22:41:09.887

您可以制作一个可配置的 CSS 预处理器，用 url 替换定义并缓存结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T08:22:43.910

您可以通过使用[<base />](http://www.w3.org/TR/REC-html40/struct/links.html#h-12.4)标记并设置用于解析所有其他相关请求的基本 URL 来实现您所追求的目标。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-08T22:40:59.373

我的想法：

在 Web 应用程序本地开发一个处理程序/etc 以拉入图像并处理配置文件中基本 URL 的更改：

> 背景图像： url (localHandler.ashx(aspx)/resourceName.foo);

localHandler 调用目标资​​源，然后根据内容类型返回资源。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T22:43:07.450

要么跨环境保持一致（我总是喜欢这种方法），要么动态生成 CSS。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-08T22:43:46.950

根据您的构建环境，可能有一种机制来处理资源文件并用所需的值替换变量。

我将 Maven 用于我的 Java 开发，它内置了这个功能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-11-01T17:09:03.380

您可以使用我们的[.Less CSS 预处理器](http://www.dotlesscss.com)在运行时交换变量。

也就是说，你是如何部署的？如果您使用 CI 工具并自动编写部署脚本，那么您可以包含一个构建后步骤来查找替换此基本路径。

# php - PHP 5.x 同步文件访问（无数据库）

> ID：185203
> 
> 赞同：6
> 
> 时间：2008-10-08T22:41:58.793
> 
> 标签：php, file, synchronization, mutex

我最熟悉 Java、C 和 C++，其中有一些方法可以控制在任何给定时间只有一个线程正在访问资源。现在我正在寻找类似的东西，但在 PHP 5.x 中。

用一个例子来阐述我的问题：

我有一个 ASCII 文件，它只存储一个数字，即页面加载计数器的值。在应用程序部署时，该文件将简单地保存一个 0。对于每次访问，该值将增加 1。目标是跟踪页面加载。

当许多用户同时访问包含计数器的页面时，就会出现问题。当线程 A 读取当前值时，假设它是 11，我们称为 B 的另一个线程读取该值，仍然是 11。然后第一个线程 A 增加读取的值并将 12 写入文件并关闭它。然后第二个线程 B 增加读取的值，即 11，获取 12 并将其写入文件。值 12 存储在文件中，而实际上它应该是 13。

在另一种编程语言中，我会使用互斥锁来解决这个问题。我知道作为模块的一部分，有互斥锁、共享内存和其他功能。但我想要一个适用于“大多数服务器”的解决方案。独立于平台。安装在最便宜的网络主机上。这个问题有好的解决方案吗？如果没有，如果**不能选择使用数据库**，您会采取哪种方式？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-08T22:45:21.423

您可以尝试 php 的羊群变体（[http://www.php.net/flock](http://www.php.net/flock)）

我会设想类似的东西（这假设文件 /tmp/counter.txt 已经存在并且在文件中有一个计数器）：

```
<?php

$fp = fopen("/tmp/counter.txt", "r+");

echo "Attempt to lock\n";
if (flock($fp, LOCK_EX)) {
  echo "Locked\n";
  // Read current value of the counter and increment
  $cntr = fread($fp, 80);
  $cntr = intval($cntr) + 1;

  // Pause to prove that race condition doesn't exist
  sleep(5);

  // Write new value to the file
  ftruncate($fp, 0);
  fseek($fp, 0, SEEK_SET);
  fwrite($fp, $cntr);
  flock($fp, LOCK_UN); // release the lock
  fclose($fp);
}

?> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-08T22:51:57.043

PHP 的flock() 函数是要走的路。但是，您必须确保对文件的*所有*访问都受到首先调用flock() 的保护。PHP 不会检查文件是否被锁定，除非您明确调用这样做。

这个概念实际上与互斥锁（保护共享资源等）相同，但它的重要性足以得到特别强调。

# php - 有没有办法确定电子邮件是否到达目的地？

> ID：185204
> 
> 赞同：8
> 
> 时间：2008-10-08T22:42:33.287
> 
> 标签：php, error-handling, email, error-detection

我有一个 PHP 脚本，可以发送需要到达目的地的重要电子邮件。我知道如何检查电子邮件是否发送成功，唯一的问题是知道它是否真的到达了收件人。

有什么建议么？如果没有办法知道，你会如何处理这种情况？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-08T22:55:14.383

如果您制作基于 HTML 的电子邮件，您可以在其中包含图像，其中包含带有收件人唯一信息的 URL。您可以构建您的应用程序，以便这些 URL 在返回所需的图像数据之前触发一些代码以将该特定电子邮件标记为已读。

为了完全有效，图像必须构成电子邮件的关键部分，因此收件人*必须*让他们的电子邮件客户端抓取图像。您还可以使电子邮件的纯文本部分仅包含一个 URL 以检索完整消息，从而再次允许您跟踪收据。

你对这些想法的理解程度取决于你*为什么*需要知道它已被阅读，以及你想在多大程度上用他们无法剪切的电子邮件潜在地惹恼收件人，在移动设备上轻松阅读，收听屏幕阅读器等...

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-08T22:52:05.777

传递状态通知是通常的方式：[http ://www.sendmail.org/~ca/email/dsn.html](http://www.sendmail.org/%7Eca/email/dsn.html)

除非您使用该 microsoft email 并且阅读器没有禁用已读回执，否则您无法判断是否已阅读电子邮件。

编辑：我还没有进展到 HTML 电子邮件，所以我从来没有考虑过阅读通知。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-08T22:46:12.140

没有办法确定。即使远程服务器接受该消息，也不能保证它不会被垃圾邮件过滤器或其他过滤器过滤。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-09T20:37:28.640

所有跟踪链接和网络错误都假定人们实际上打开了电子邮件并启用了远程图像，或者单击了链接。这都是有缺陷的。

为确保是否收到电子邮件但未返回，我将执行以下操作：

1.  添加`Errors-To`标头（设置为例如bounce@domain.com）
2.  添加`Return-Path`标头（设置为例如bounce@domain.com）
3.  拿起邮箱 (bounce@domain.com) 并解析邮件

这使您可以根据邮件内容检查电子邮件何时返回，您可能可以确定哪一封退回/返回。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-08T23:35:54.240

不幸的是，没有 100% 的方法可以确定邮件是否已发送到用户的收件箱。即使服务器接受了消息，它也可能被垃圾邮件过滤器拦截或异步退回。

很多人都提到了网络错误跟踪风格技术。这些对营销人员很有效：他们可以根据样本量做出假设。它们需要 HTML 电子邮件，并且用户在 HTML 中加载图像。这在某些情况下会自动发生，但很多时候人们必须专门单击“下载图像”按钮。

另一种方法是使用[Goodmail](http://goodmail.com/)。他们的部分服务是跟踪哪些消息实际被传递和打开。当然，这需要花钱，而且并非所有邮件提供商都受支持。同样，它主要是一种营销工具。

您还可以在链接中隐藏跟踪脚本。例如，您创建一个如下所示的 URL：

```
http://trackingserver/track/$messageid/http://real.url/goes/here 
```

然后该`track`脚本在数据库中记录一次“点击”并将客户端重定向到`http://real.url/goes/here`. 然后，您需要有一个令人信服的理由来每次单击该 URL。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-11-18T15:20:45.203

为什么你想知道有人读过邮件？

从法律上讲，您可能想出的任何方法都不会在法庭上举行（假设您想确保某人已经阅读了重要文件），因为您无法证明读者是收件人。

安全方面，任何像样的垃圾邮件过滤器都会将您的邮件标记为垃圾邮件并在任何人看到之前将其删除，因为在邮件中添加奇怪的链接或网络错误或图像正是垃圾邮件发送者所做的。如果你想卖东西，这是确保你不会卖东西的万无一失的方法。

更新：如果您需要确保人们已经阅读过某些内容，我建议发送邮件时附上链接或指向他们应该阅读的文档的指针。不要在链接中添加网络错误或个性化 ID。在文件中，告诉他们签署文件并返回一份签署的副本作为他们已阅读文件的证明。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-07-05T10:50:17.370

我猜以上所有内容：HTML 中的图像，如果他们点击某些东西，则跟踪链接。ReturnPath / Goodmail 等第三方服务可以提供帮助。

最好的建议是确保您发送的列表是干净的，IP 地址具有良好的声誉，反向 dns/spf 记录，对活动进行良好的退订和退回处理，对内容进行垃圾邮件检查，并让收件人将您添加到他们的地址书。

这将给你一个更好的交付机会...

Sundeep.//

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-08T23:02:10.267

试试这个：

使用 HTML 编写电子邮件（使用 PHP 并没有那么棘手）。在那封电子邮件中，包含一张图片（可能只是一个漂亮的徽标或其他东西）。这张图片将是一张特殊的图片......它的 src 将是，比如说，`myserver.com/images/logo.gif?recipient@email.com`。需要为每个发送电子邮件的人动态生成此 src。然后，如果收件人打开电子邮件，电子邮件客户端将向您的服务器询问 logo.gif?recipient@email.com

因此，如果您的服务器收到对该图像的请求，您就会知道收件人@email.com 收到了您的消息。

您可以为 URL 末尾的标签创建一种特殊格式，这样它不仅会告诉它是谁，而且会告诉他们正在回复哪封电子邮件。

请记住，这是垃圾邮件发送者用来判断电子邮件地址是否处于活动状态的方法。因此，某些软件可能会询问用户是否认为您是垃圾邮件！此外，一些用户将没有图像支持（或将关闭此支持）。

祝你好运！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-08T23:06:48.680

如果是内部邮件，请发送电子邮件，但不要将邮件内容放入电子邮件中。提供指向网站的链接，但在 url 中提供标识符，以便您可以将页面视图与电子邮件联系起来。

如果它是外部的，你仍然可以这样做，只要另一端的人是合作的。

您还可以在目标邮件系统上设置一个普通帐户并进行检查。如果您通过该帐户收到电子邮件，则系统可能未设置为将其过滤掉。

您还可以要求接收系统的管理员对收到良好的电子邮件进行退回（您知道，将您的确认网页卷曲的脚本），但这需要大量的合作。尽管在那个时候，通过 Web 服务传递消息可能会更容易。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-08T22:46:24.790

如果我没记错的话，只要你发送成功，你就可以放心，它至少已经被接收邮件服务器接受了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-08T22:55:12.590

一个[网络错误](http://en.wikipedia.org/wiki/Web_bug)可能会给你一些类似已读回执的东西，如果这就是你所要求的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-09T04:01:02.940

SMTP 协议是异步的，因此唯一有保证的反馈可以由用户邮件客户端返回。如果投递出现问题，您会将退回的电子邮件退回到信封发件人中定义的地址（邮件标题返回路径）这些退回的时间是不可预测和未定义的。到目前为止，跟踪 HTML 电子邮件正文中的像素是报告用户实际打开电子邮件的最佳方式。

# c# - 如何在 C# 中获取和设置环境变量？

> ID：185208
> 
> 赞同：219
> 
> 时间：2008-10-08T22:43:17.277
> 
> 标签：c#, .net, .net-2.0, environment-variables

如何获取环境变量，如果缺少某些内容，请设置值？

* * *

## 回答 #1

> 赞同：299
> 
> 时间：2008-10-08T22:44:20.753

使用[System.Environment](https://docs.microsoft.com/en-us/dotnet/api/system.environment)类。

方法

```
var value = System.Environment.GetEnvironmentVariable(variable [, Target]) 
```

和

```
System.Environment.SetEnvironmentVariable(variable, value [, Target]) 
```

将为您完成工作。

可选参数`Target`是一个枚举类型`EnvironmentVariableTarget`，它可以是以下之一：`Machine`、`Process`或`User`。如果省略它，则默认目标是**当前进程。**

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2012-03-23T19:11:07.693

我在使用 .NET 控制台应用程序读取 PATH 环境变量时遇到了这个问题，发现使用 System.Environment.GetEnvironmentVariable 会自动扩展环境变量。

我不希望这种情况发生...这意味着路径中的文件夹（例如 '%SystemRoot%\system32'）被重写为 'C:\Windows\system32'。为了获得未扩展的路径，我不得不使用这个：

```
string keyName = @"SYSTEM\CurrentControlSet\Control\Session Manager\Environment\";
string existingPathFolderVariable = (string)Registry.LocalMachine.OpenSubKey(keyName).GetValue("PATH", "", RegistryValueOptions.DoNotExpandEnvironmentNames); 
```

对我来说就像一个魅力。

* * *

## 回答 #3

> 赞同：27
> 
> 时间：2013-06-10T22:34:43.040

***获取和设置***

**得到**

```
string getEnv = Environment.GetEnvironmentVariable("envVar"); 
```

**放**

```
string setEnv = Environment.SetEnvironmentVariable("envvar", varEnv); 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2010-05-04T05:59:48.027

这将适用于作为机器设置的环境变量。对于用户，只需更改为用户即可。

```
String EnvironmentPath = System.Environment
                .GetEnvironmentVariable("Variable_Name", EnvironmentVariableTarget.Machine); 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2012-08-01T13:17:48.283

```
Environment.SetEnvironmentVariable("Variable name", value, EnvironmentVariableTarget.User); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-03-20T16:36:32.713

在 Visual Studio 2019 中——右键单击您的项目，选择“属性”>“设置”，通过为其命名（如 ConnectionString）、类型和值来添加新变量。然后在你的代码中这样读：

```
var sConnectionStr = Properties.Settings.Default.ConnectionString; 
```

根据您的项目类型，这些变量将存储在配置文件（web.config 或 app.config）中。这是它的外观示例：

```
 <applicationSettings>
    <Testing.Properties.Settings>
      <setting name="ConnectionString" serializeAs="String">
        <value>data source=blah-blah;etc-etc</value>
      </setting>
    </Testing.Properties.Settings>
  </applicationSettings> 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-08-25T09:46:48.117

我可以使用以下命令更新环境变量

```
string EnvPath = System.Environment.GetEnvironmentVariable("PATH", EnvironmentVariableTarget.Machine) ?? string.Empty;
if (!string.IsNullOrEmpty(EnvPath) && !EnvPath .EndsWith(";"))
    EnvPath = EnvPath + ';';
EnvPath = EnvPath + @"C:\Test";
Environment.SetEnvironmentVariable("PATH", EnvPath , EnvironmentVariableTarget.Machine); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-01-11T04:04:24.610

如果读取环境变量的目的是覆盖 appsetting.json 或任何其他配置文件中的值，您可以通过[EnvironmentVariablesExtensions](https://docs.microsoft.com/en-us/dotnet/api/microsoft.extensions.configuration.environmentvariablesextensions.addenvironmentvariables?view=dotnet-plat-ext-5.0)将其归档。

```
var builder = new ConfigurationBuilder()
                .AddJsonFile("appSettings.json")
                .AddEnvironmentVariables(prefix: "ABC_")

var config = builder.Build(); 
```

[![在此处输入图像描述](https://i.stack.imgur.com/fz2Lr.png)](https://i.stack.imgur.com/fz2Lr.png)

根据此示例，环境的 Url 是从 appsettings.json 读取的。但是当该`AddEnvironmentVariables(prefix: "ABC_")`行添加到 ConfigurationBuilder 时，值 appsettings.json 将被环境变量值覆盖。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-08-09T07:23:28.273

环境变量也可以放在应用程序`app.config`或`web.config`文件中，名称以百分比 ( `%`) 为界，然后在代码中展开。

*   请注意，当环境变量的值发生更改（或设置新值）时，应关闭并重新打开 Visual Studio。

例如，在`app.config`：

```
<connectionStrings>
    <add name="myConnectionString" connectionString="%DEV_SQL_SERVER_CONNECTION_STRING%" providerName="System.Data.SqlClient" />
</connectionStrings> 
```

然后在代码中：

```
string connectionStringEnv = ConfigurationManager.AppSettings["myConnectionString"];
string connectionString = System.Environment.ExpandEnvironmentVariables(connectionStringEnv); 
```

# c# - 在 C# 中将 CD 翻录为 mp3 - 第三方组件或 api？

> ID：185209
> 
> 赞同：6
> 
> 时间：2008-10-08T22:43:28.930
> 
> 标签：c#, mp3, id3, ripping

我们正在开发一个项目，该项目需要将音轨从 CD 翻录到 MP3（理想情况下，还可以从 CDDB 或类似文件中检索音轨信息）。

更多背景信息：各种音乐唱片公司向我们发送音乐 CD，然后我们通过在线交付系统将其交付给人们。我们正在研究如何将这些 CD 转换为带有完整曲目信息的 MP3 的过程自动化。我们想制作一个简单的桌面应用程序，允许编辑人员设置我们收到的新音乐的信息。为了简化流程，我们希望包括音频的翻录和轨道信息的检索。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-08T23:17:00.517

您可以通过 COM 互操作访问 Windows Media Player 控件库来完成所有这些操作（`IWMPCdromRip`例如，该接口包括 CD 翻录）。它不漂亮，看起来也不是很可控（你给它一个要翻录的曲目列表，告诉它要翻录，它会翻录它们并将它们放入 WMP 库中 - 然后你可以自动化并从中取出曲目) 但它可以端到端工作，包括查询曲目数据和专辑封面。查看[http://msdn.microsoft.com/en-us/library/bb262437(VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb262437(VS.85).aspx)开始。

快速的 Google 还找到了对 CodeProject 文章的引用，其中作者通过与低级 IOCTL API 的互操作创建了一个 CD 翻录库，直接与 CD 驱动器交互。这可能是构建您自己的一个很好的起点 - 可以在[http://www.codeproject.com/KB/cs/csharpipper.aspx](http://www.codeproject.com/KB/cs/csharpripper.aspx)找到。

同一作者使用 LAME 组装了一个 C# 编码器，尽管您可以链接到 LAME.EXE，这可能更简单。请参阅[http://www.codeproject.com/KB/audio-video/MP3Compressor.aspx](http://www.codeproject.com/KB/audio-video/MP3Compressor.aspx)。

查询 CDDB（或者更可能是 FREEDB）不是火箭科学，它是一个简单的 HTTP 接口（尽管奇怪的是我找不到任何 Web 服务）。很容易用`WebRequest`.

你会认为现在有人会为此组合一个简单的 C# 库，但这似乎是一个不常见的请求。也许是时候做一个副业了……

# security - 处理敏感信息的最佳做法是什么？

> ID：185210
> 
> 赞同：4
> 
> 时间：2008-10-08T22:43:31.130
> 
> 标签：security, credit-card

我目前正在为客户创建一个应用程序，该应用程序将允许他们自动向客户的信用卡收费。

我很好奇什么是安全存储和访问信用卡信息的**最佳实践，以及任何其他敏感信息，如社会安全号码、帐号等。**

我**假设**将采用某种类型的加密，但在深入研究之前，我想看看其他人如何处理这些类型的要求。

这并不重要，但我们正在使用 Microsoft SQL Server 为数据库设计软件，并使用 C# 和 ASP.NET。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-08T22:47:36.020

阅读[PCI 要求](http://pcistandard.com/requirements.html)。一切都会在那里。

事实上，你*必须*跟随他们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-08T23:01:31.330

1 - 除非你真的需要，否则不要收集 SSN。除非你是银行或政府，否则你很可能不是。

2 - 除非您确实需要，否则不要收集其他敏感信息

3 - 使用任何适当的控件（数据库的单独机器，防火墙，访问控制等）来处理您真正需要保留的东西。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-08T23:27:01.027

在操作系统和物理安全方面使用激进的标准来保护主机系统，例如[NSA 指南](http://www.nsa.gov/SNAC/)。

将数据库放在与 Web 服务器或其他功能不同的系统上，以防止物理访问和权限升级漏洞。

进行防御性编程以避免 SQL 注入攻击和类似的攻击。

开发时，首先要考虑安全性。之后回来并应用安全性将很困难且容易出错。

尝试将应用程序的各个部分分开......即不要将相同的查看器或控制器用于“公共”访问和“私人”访问。

请注意并遵守有关处理这些数据的所有当地法律......那里有很多。

保留一些[信封](http://articles.latimes.com/2006/may/26/nation/na-vets26)，以便在发生违规事件时通知您的客户。如果您丢失了 2600 万客户的信息，您可能无法获得足够的信封来满足通知他们违规的法定时限。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T22:55:05.583

不要——我的意思是，你真的需要吗？

有一个强大的第三方支付服务市场，他们可以为您接收详细信息，并在付款后简单地向您发送消息。有像 PayPal 这样的替代品，您可以使用 MD5 或 SHA1 保护数据 - 丢弃诸如确切的数字字符串之类的琐事。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-08T23:22:54.657

不同的应用程序需要不同的 PCI 标准合规性。如果您的应用程序只是收集 CC 号码，然后将它们提交给符合 PCI 的第 3 方支付网关，那么您的合规性要求并不算太差 - 只要您不存储卡号或 CVV。

在记录方面，您应该“删除”信用卡号，例如保留前 6 位和后 3 位，但隐藏中间位。根本不记录 CVV。

PCI 标准文档非常详细，但这完全取决于您的应用程序的要求，即您需要什么级别的合规性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T23:51:06.207

[与OWASP](http://www.owasp.org/index.php/Main_Page)威胁密切相关，并准确了解如何在您的应用程序和框架中应对它们。很难相信有多少人采用愚蠢的半解决方案来应对 SQL 注入和跨站点脚本攻击。

# java - 学习java有什么好的方法？

> ID：185211
> 
> 赞同：3
> 
> 时间：2008-10-08T22:43:36.480
> 
> 标签：java, security

我在 C++ 和 Java 方面有一点经验，但我想成为他们的专业人士。另外，当我想开发一个安全的应用程序时，推荐的方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T00:02:49.987

我不知道您在 C++ 方面有多少经验，但是假设您对该语言以及面向对象的概念有很好的掌握，我建议您阅读[Head First Java](https://rads.stackoverflow.com/amzn/click/com/0596007124) - 它非常容易阅读并且会抓住您概述了语言（包括基本的线程和套接字）。

有关使用 Java 语言构建数据结构或实现算法的信息，我推荐使用 Java 中的[数据结构和算法](http://ww0.java4.datastructures.net/)。书籍介绍还可以 - 一些代码在某些页面上被处理，但材料是可靠的。

最后，在我看来， [Java API是一个很好的资源。](http://java.sun.com/j2se/1.5.0/docs/api/)我想不出在那个网站上找不到我想要的东西的时候。就个人而言，我认为如果您通读 Head First，然后从事一些个人项目并将 Java API 放在身边，那么您会很高兴。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T07:41:56.847

不要错过使用类似 Java 的解释语言进行动手测试和使用 Java 库的机会。有时在提示下以交互方式尝试某些东西比编写完整的程序要快得多。

我最喜欢的是：

BeanShell，[http://www.beanshell.org](http://www.beanshell.org) Groovy，[http ://groovy.codehaus.org/](http://groovy.codehaus.org/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T23:51:31.837

java有很多很好的参考资料。一本是免费的在线书籍（如果您愿意，可以购买付费的死树版本），名为[Thinking in Java](http://www.mindview.net/Books/TIJ/)，非常不错。

还有官方的 Sun（Java 创建者）Java 教程，也可以[在线获取](http://java.sun.com/docs/books/tutorial/)

您还可以通过谷歌搜索“java 教程”找到更多资源。

要成为一种语言的“专业人士”，想法是练习和练习。实际上，使用您所看到的技能将巩固您的知识和经验。一种方法是参与一个开源项目。尝试查看 SourceForge、freshmeat 或 codeplex 或类似的地方。

加入哪个开源项目以及如何进行已经在 SO 上回答了无数次，搜索一下，看看你对什么感兴趣。

祝你好运。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T13:30:50.683

为了安全，Down、McDonald 和 Schuh 的软件安全评估艺术就在我键盘的左侧。警告：可能需要两个人才能提起这本书。此外，Seacord 的 C 和 C++ 中的安全编码的领域有点窄，值得一读。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T13:45:21.233

学习 Java（或 blub，或编程语言 x）的问题不在于缺少参考资料或信息——而是要知道将好资料（写得好，挑战水平合适）与劣质资料区分开来。

我发现 Bruce Eckel 的书（Thinking in Java、Thinking in C++）是全面而深入的。它们远远超出了入门级别。此外，它们可在线免费获得。我还推荐 Josh Bloch 的“Effective Java”和 Brian Goetz 的“Java Concurrency in Practice”。

当然，学习的唯一方法是阅读*比您自己的代码更好的代码**，并以编写比您以前编写*的代码更好的代码为目的进行编程。在开始编码之前先考虑一些改进 - 你将如何处理异常？你会花时间研究你要做什么的正确的库函数吗？您正在解决的问题是否有更优雅的解决方案（也许是标准解决方案？）

正如其他人所提到的，OSS 项目提供了大量可供您阅读的代码。选择在代码质量方面具有良好声誉的大型成熟项目 - 取一小部分并阅读它，直到你理解它为止。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T22:47:57.893

我建议你找一所当地的社区大学，在那里学习一个学期。

在编写安全程序之前，您需要精通基础知识。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-08T22:48:58.140

您可以通过编程、参加课程或阅读有关基本 Java 的书籍来学习。我建议将 Java 编程和阅读有关它的书结合起来。

您需要更具体地解决我不确定您在问什么的其他问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-08T22:49:03.723

我会先在 Google 中输入“java 教程”。一旦你掌握了基础知识，你应该寻找更具体到你希望创建的应用程序类型的站点和邮件列表。

[Apache Software Foundation](http://www.apache.org)是一个庞大的操作系统社区，拥有许多可供您使用的 Java 库。

关于安全性...这取决于您的环境以及您要保护的内容。你需要更具体地回答你的问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-09T01:42:41.347

观看斯坦福大学的这些 Java 讲座。整个课程都是免费的，会深入地教你Java。

[http://see.stanford.edu/see/courseinfo.aspx?coll=824a47e1-135f-4508-a5aa-866adcae1111](http://see.stanford.edu/see/courseinfo.aspx?coll=824a47e1-135f-4508-a5aa-866adcae1111)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-10-09T03:29:21.943

我发现拿起一本书并尝试是最好的方法。你真的需要一个目标——想出一个你想做的玩具项目，然后开始做。通过这种方式，您可以从错误中吸取教训，并对语言有所了解。这是假设您对编程基础知识有相当扎实的理解；如果您不这样做，那么您可能想找一位导师 - 联系您当地的计算机俱乐部，他们可能会推荐某人。

如果您想不出一个简单的玩具项目，我总是发现用一种新语言解决项目欧拉问题是一种简单的入门方法 - [http://projecteuler.net/](http://projecteuler.net/)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-09T03:32:10.953

虽然[这个问题](https://stackoverflow.com/questions/175310/how-to-improve-java-knowledge#175368)是想提高Java技能的人问的，但我认为那里发布的答案对于第一次学习Java也有好处。就像我在回答[另一个问题](https://stackoverflow.com/questions/175310/how-to-improve-java-knowledge#175368)时所说的那样，这都是关于[Effective Java](https://rads.stackoverflow.com/amzn/click/com/0321356683)的。

# javascript - jQuery 选项卡 - 获取新选择的索引

> ID：185235
> 
> 赞同：26
> 
> 时间：2008-10-08T22:51:00.710
> 
> 标签：javascript, jquery, jquery-ui, jquery-plugins, jquery-ui-tabs

我以前使用[`jquery-ui tabs`](https://jqueryui.com/tabs/)扩展来通过 加载页面片段`ajax`，并隐藏或显示`div`页面中的隐藏 s。这两种方法都有据可查，我在那里没有遇到任何问题。

然而，现在我想用标签做一些不同的事情。当用户选择一个选项卡时，它应该完全重新加载页面 - 原因是每个选项卡部分的内容渲染起来有点贵，所以我不想一次全部发送并使用普通方法切换“显示：无”以显示它们。

我的计划是拦截选项卡的`select`事件，并通过操作 document.location 让该功能重新加载页面。

如何在`select`处理程序中获取新选择的选项卡索引及其对应的 html LI 对象？

```
$('#edit_tabs').tabs(  {
        selected: 2,     // which tab to start on when page loads
        select: function(e, ui) {
            var t = $(e.target);
            // alert("data is " +  t.data('load.tabs'));  // undef
            // alert("data is " +  ui.data('load.tabs'));  // undef

            // This gives a numeric index...
            alert( "selected is " + t.data('selected.tabs') )
            // ... but it's the index of the PREVIOUSLY selected tab, not the
            // one the user is now choosing.  
            return true;

            // eventual goal is: 
            // ... document.location= extract-url-from(something); return false;
        }
}); 
```

是否有我可以读取的事件或 ui 对象的属性将给出新选择的选项卡或其中的锚标记的索引、ID 或对象？

或者有没有更好的方法来使用标签重新加载整个页面？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-10-08T22:56:52.710

我会看看选项卡的[事件](http://docs.jquery.com/UI/Tabs#Events)。以下内容取自 jQuery 文档：

```
 $('.ui-tabs-nav').bind('tabsselect', function(event, ui) {
     ui.options // options used to intialize this widget
     ui.tab // anchor element of the selected (clicked) tab
     ui.panel // element, that contains the contents of the selected (clicked) tab
     ui.index // zero-based index of the selected (clicked) tab
 }); 
```

看起来 ui.tab 是要走的路。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-01-28T11:04:36.487

在 jQuery UI - v1.9.2

```
ui.newTab.index() 
```

获取活动选项卡的基数 0 索引

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-08-25T08:32:10.047

```
select: function(e, ui){var index=ui.index;} 
```

很适合我。见：[http ://api.jqueryui.com/tabs/#events](http://api.jqueryui.com/tabs/#events)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T23:29:32.537

谢谢，jobscry - 你指出的 'ui.tab' 给了我点击的锚标签，我可以从中提取它的类、id、href 等......我选择使用 id 来编码我的 url。我的最终 tabs() 调用如下所示：

```
$(document).ready(function() {
    $('#edit_tabs').tabs(  {
        selected: [% page.selected_tab ? page.selected_tab : 0 %],
        select: function(e, ui) {
            // ui.tab is an 'a' object
            // it has an id of "link_foo_bar"
            // transform it into http://....something&cmd=foo-bar
            var url = idToTabURL(ui.tab.id);

            document.location = url;
            return false;
        }
    }).show();
}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T10:25:46.970

在我的实现中，它的工作方式如下：

```
$(document).ready(function() {
    $('#edit_tabs').tabs(  {
        selected: [% page.selected_tab ? page.selected_tab : 0 %],
        select: function(e, ui) {
            // ui.tab is an 'a' object
            var url = ui.tab.href;

            document.location = url;
            return false;
        }
    }).show();
}); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-14T07:06:37.913

或者我用于我的网站的另一个选项是这个。它是一个基本的 UL/Div 选项卡导航系统。单击指向带有井号标记的另一个页面的链接时触发正确选项卡的关键是通过您的 UL 过滤与通过浏览器传递的内容相匹配的 #example。它是这样的。

这是示例 HTML：

```
 <div id="tabNav">

  <ul class="tabs">
    <li><a href="#message">Send a message</a></li>
    <li><a href="#shareFile">Share a file</a></li>
    <li><a href="#arrange">Arrange a meetup</a></li>
  </ul>
</div>

<div id="tabCont">

  <div id="message">
    <p>Lorem ipsum dolor sit amet.</p>
  </div>
  <div id="shareFile">
    <p>Sed do eiusmod tempor incididunt.</p>
  </div>
  <div id="arrange">
    <p>Ut enim ad minim veniam</p>
  </div>

</div> 
```

和实现它的Jquery：

```
$(document).ready(function() {
$(function () {
    var tabs = [];
    var tabContainers = [];

    $('ul.tabs a').each(function () {
      // note that this only compares the pathname, not the entire url
      // which actually may be required for a more terse solution.
        if (this.pathname == window.location.pathname) {
            tabs.push(this);
            tabContainers.push($(this.hash).get(0));
        }
    });

    $(tabs).click(function () {
        // hide all tabs
        $(tabContainers).hide().filter(this.hash).show();

        // set up the selected class
        $(tabs).removeClass('active');
        $(this).addClass('active');

        return false;

});

 $(tabs).filter(window.location.hash ? '[hash=' + window.location.hash + ']' : ':first').click();

  });

}); 
```

那应该为你处理它。我知道这不是最干净的代码，但它会让你到达那里。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-09-09T20:41:21.743

我确实找到了两种方法来完成这个要求，因为我很难把代码放在这里，你可以在[http://ektaraval.blogspot.com/2011/09/calling-javascript-when- jquery-ui-tab.html](http://ektaraval.blogspot.com/2011/09/calling-javascript-when-jquery-ui-tab.html)

希望对某人有所帮助..

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-10-10T07:05:32.437

快速查看文档为我们提供了解决方案：

```
$('#edit_tabs').tabs({ selected: 2 }); 
```

上述语句将激活第三个选项卡。

# php - 我如何判断是否有人伪造文件类型？(PHP)

> ID：185236
> 
> 赞同：12
> 
> 时间：2008-10-08T22:51:53.703
> 
> 标签：php, upload, mime-types, file-type

我正在编程允许用户在网络服务器上存储文档和图片，以便以后存储和检索。当用户将文件上传到我的服务器时，PHP 会根据扩展名告诉我它是什么文件类型。但是，我担心用户可以将 zip 文件重命名为 somezipfile.png 并存储它，从而在我的服务器上保留一个 zip 文件。有什么合理的方法可以打开上传的文件并“检查”它是否真的属于上述文件类型？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-08T22:56:09.450

[幻数](http://en.wikipedia.org/wiki/Magic_number_(programming)#Magic_numbers_in_files)。如果您可以读取二进制文件的前几个字节，您就可以知道它是什么类型的文件。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-10-08T23:03:46.207

查看 PHP 的[FileInfo](http://php.net/manual/en/book.fileinfo.php) PECL 扩展，它可以为您执行 MIME 魔术查找。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-08T22:54:30.140

有点。大多数文件类型都保留了一些字节来标记它们，这样您就不必依赖扩展名。网站[http://wotsit.org](http://wotsit.org)是一个很好的资源，可用于查找特定类型的信息。

如果您使用的是 unix 系统，我相信 file 命令不依赖于扩展名，因此如果您不想编写字节检查代码，则可以使用它。

对于 PNG ( [http://www.w3.org/TR/PNG-Rationale.html](http://www.w3.org/TR/PNG-Rationale.html) )

PNG 文件的前 8 个字节始终包含以下值：

（十进制） 137 80 78 71 13 10 26 10

（十六进制） 89 50 4e 47 0d 0a 1a 0a

（ASCII C 表示法）\211 PNG \r \n \032 \n

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-08T22:57:54.067

许多文件类型在文件开头都有“[幻数](http://en.wikipedia.org/wiki/Magic_number_(programming)#Magic_numbers_in_files)”来识别它们，您可以从文件前面读取一些字节并将它们与已知幻数列表进行比较。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-09T02:48:07.173

如果您只处理图像，那么 getimagesize() 应该区分有效图像和假图像。

```
$ php -r 'var_dump(getimagesize("b&n.jpg"));'
array(7) {
  [0]=>
  int(200)
  [1]=>
  int(200)
  [2]=>
  int(2)
  [3]=>
  string(24) "width="200" height="200""
  ["bits"]=>
  int(8)
  ["channels"]=>
  int(3)
  ["mime"]=>
  string(10) "image/jpeg"
}

$ php -r 'var_dump(getimagesize("/etc/passwd"));'
bool(false) 
```

getimagesize 的错误值不是图像。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-08T23:03:32.993

在 unix 系统上，捕获“文件”命令的输出应该提供足够的信息。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-09T00:08:12.193

有关如何在 PHP 中快速执行此操作的确切答案，请查看以下问题：[How do I find the mime-type of a file with php?](https://stackoverflow.com/questions/134833/how-do-i-find-the-mime-type-of-a-file-with-php#134893)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-04T14:38:16.143

作为旁注，我遇到了一个类似的问题，我必须自己进行类型检查。我的应用程序的前端接口是在 Flash 中完成的。这些文件正在通过 flash 传递给 php 脚本。当我尝试使用 php 进行 MIME 类型检查时，返回的类型总是 application/octetstream，因为它来自 flash。

我必须实现一个幻数类型范例。我只是创建了一个 xml 文件，其中包含文件类型以及在文件开头找到的一些定义模式。文件到达服务器后，我对 xml 文件进行了一些模式匹配，然后接受或拒绝了该文件。我也没有注意到任何预期的实际性能下降。

对于可能在前端使用 Flash 并在上传文件后尝试键入检查文件的任何人，这只是一个旁注。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-04T15:12:32.953

除了识别文件类型外，您可能还需要注意嵌入或附加了其他文件的文件。不幸的是，这需要对文件内容进行更深入的分析，而不仅仅是使用“幻数”。

例如， http: [//quantumrook.wordpress.com/2007/06/06/hide-a-rar-file-in-a-jpg-file/](http://quantumrook.wordpress.com/2007/06/06/hide-a-rar-file-in-a-jpg-file/)（这种特殊类型的数据隐藏可以通过加载和将实际图像数据重新保存到新文件中..其他会更困难。）

# asp.net - 在执行 WebRequest 时显示加载文本

> ID：185239
> 
> 赞同：1
> 
> 时间：2008-10-08T22:52:16.107
> 
> 标签：asp.net, httpwebrequest

我的网络表单上有一个按钮。单击此按钮将在 onclick 事件处理程序期间执行 HttpWebRequest。在请求之后，我们将请求中的响应复制到 HttpContext.Current.Response 并将其发送给客户端。

此 Web 请求可能需要一段时间（最多 5 秒，因为它正在生成报告）。在此期间，除了浏览器进度条和旋转的 IE 图标（如果他们使用的是 IE），用户没有任何迹象表明正在发生任何事情。所以在发生这种情况时我需要一个加载指示器。

我尝试使用在按钮的 onclick 事件（使用 OnClientClick）期间触发的 javascript，虽然它有效，但我不知道如何找出 Web 请求何时完成。由于我们只是将响应发送给客户端，因此不会发生完整的回发。

我尝试将按钮包装在 UpdatePanel 中并使用 UpdateProgress，但是当我们将响应发送到 HttpContext.Current.Response 并调用 Response.End() 时，我们在 javascript 中收到错误，因为响应不好形成（我们正在发回一个 Excel 表供用户下载）。

由于我们正在发回一个文件供用户下载，我不想弹出一个单独的窗口，因为在 IE 中他们会得到阻止下载的信息栏。

这里有什么想法吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-25T16:13:54.357

作为 Professional AJAX.NET 库的替代方案，jQuery 提供了一种非常好的方法。

看看[这个](http://www.junasoftware.com/blog/using-jquery-ajax-and-page-methods-with-a-asp.net-webservice.aspx)使用 .NET PageMethod 的例子（如果可能的话）。

您在 jQuery 中定义页面方法调用，您可以在隐藏的 div 中添加 loading... 消息。

说出您想要在成功时返回的回调（即生成 5 秒报告时），然后隐藏加载并处理数据。

[以我的联系页面上](http://treehouseconsulting.co.uk/ContactUs)的 javascript为例（查看源代码）。

1.  我在页面上有一个按钮，添加 jQuery onClick。
2.  当单击显示隐藏的加载 div 时，对采用表单参数的页面方法进行 ajax 调用。
3.  page 方法发送电子邮件等，然后返回到我在那里的 onSuccess javascript 方法中的表单。
4.  onSuccess 隐藏加载 div。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T22:59:13.330

我过去使用的一个简单技巧是重定向到带有动画进度条 (gif) 的中间页面，然后让该页面真正发布数据。（甚至弹出一个带有动画的图层和一条礼貌的消息，要求用户等待一两分钟）

动画 gif 的简单反馈给最终用户创造了应用程序没有停止并且他们会更有耐心的错觉。

另一种方法是将数据交给工作线程并立即返回一条消息，说明报告将通过电子邮件发送或在网站的“报告”部分准备就绪时提供。但是，这种方法缺乏报告完成时即时通知的好处。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-24T09:53:39.020

这是我的解决方案：

1.  下载并查看免费的[Professional AJAX.NET](http://ajax.schwarz-interactive.de/)库示例。
2.  编写一个创建文件并返回文件位置作为参数的 AjaxMethod。
3.  编写您的客户端函数以在第 2 步调用方法。调用此方法时显示指标。
4.  编写一个客户端回调方法来隐藏指标并显示/下载用户请求的文件。
5.  添加您的客户端函数调用您的按钮元素。

当您在服务器端的方法结束时，您的回调将被调用。

希望这可以帮助 ！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T13:47:09.797

我在这里介绍的解决方案旨在展示一种方法，让“正在加载...”框在您进行服务器端处理时出现，并在服务器端处理完成时消失。

我将使用非常基本的 AJAX 机制（在 FF 上测试，但 IE 也应该没问题）来完成此操作，即不使用像 Prototype 或 jQuery 或 Dojo 这样的框架，因为您没有指定您对它们的了解。

为了让您更好地理解其中的技巧，以下只是一个小示例，并不假装是开箱即用的解决方案。我倾向于不肤浅，但我认为一个更清晰的例子可以比很多词更好地解释。

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
  <head>
    <title>First Example</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <style>
            .hidden {
                display: none;
            }
            .loadingInProgress {
                color: #FFFFFF;
                width: 75px;
                background-color: #FF0000;
            }
        </style>
    <script type="text/javascript">
        var httpRequest;
        if (window.XMLHttpRequest) { // Mozilla, Safari, ...
            httpRequest = new XMLHttpRequest();
            httpRequest.overrideMimeType('text/xml');
        } else if (window.ActiveXObject) { // IE
            try {
                httpRequest = new ActiveXObject("Msxml2.XMLHTTP");
            }
            catch (e) {
                try {
                    httpRequest = new ActiveXObject("Microsoft.XMLHTTP");
                }
                catch (e) {}
            }
        }

        if (!httpRequest) {
            alert('Giving up :( Cannot create an XMLHTTP instance');
        }

        httpRequest.onreadystatechange = function(){
            switch (httpRequest.readyState) {
            case 1: // Loading
                document.getElementById('loading').className = "loadingInProgress";
                break;
            case 4: // Complete
                document.getElementById('loading').className = "hidden";
                if (httpRequest.status == 200) {
                    // perfect!
                } else {
                    // there was a problem with the request,
                    // for example the response may be a 404 (Not Found)
                    // or 500 (Internal Server Error) response codes
                }
                break;
            }
        };

        function go() {
            httpRequest.open('GET', document.getElementById('form1').action, true);
            httpRequest.send('');
        }
    </script>

  </head>
  <body>
      <div id="loading" class="hidden">Loading...</div>
      <form id="form1" name="form1" action="doSomething.php">
          <input type="button" value="Click to submit:" onclick="go()" />
      </form>
  </body>
</html> 
```

如您所见，`<div>`其中包含“正在加载...”消息。

原理是显示/隐藏`<div>`取决于`XMLHttpRequest`对象的`readyState`.

我已经使用 的`onreadystatechange`处理程序`XMLHttpRequest`来触发`readyState`更改。

我使用的后端 php 脚本（声明为表单的`action`）只是休眠（5），让“正在加载...”消息出现 5 秒。

```
<?php
sleep(5);
header('Cache-Control: no-cache');
echo "OK";
?> 
```

标`Cache-control: no-cache`头是必需的，因为通常如果您不设置它，浏览器将缓存响应，避免在需要时重新提交请求。

[Mozilla MDC](http://developer.mozilla.com)是“入门”AJAX 文档的一个很好的来源。

整个事情可以由像 Prototype 这样的 Javascript 框架更温和地处理，利用其浏览器安全的方法，为您节省数小时的调试时间。

* * *

*编辑：*

我选择了 php，因为我不了解 ASP.NET 和 ASP，对此感到抱歉。

* * *

# php - 来自 PHP 导入脚本的未初始化字符串偏移错误

> ID：185240
> 
> 赞同：4
> 
> 时间：2008-10-08T22:52:31.363
> 
> 标签：php, apache, web-hosting

作为 CMS 的一部分，我有一个 import-from-excel 脚本，该脚本以前运行时没有问题。

我的共享主机提供商最近升级了他们的基础设施，包括 PHP 从 5.1 到 5.2.6，脚本现在返回“未初始化的字符串偏移量：第 27 行 /path/scriptname.php 中的 -XXX”（XXX 是从512 和 /path/scriptname.php 当然是相关脚本的完整路径）。

它为 excel 文件的每一行返回此错误。第 27 行只是一个函数内部的返回，它是处理导入数据的第一个点：

```
function GetInt4d($data, $pos) {
        return ord($data[$pos]) | (ord($data[$pos+1]) << 8) | (ord($data[$pos+2]) << 16) | (ord($data[$pos+3]) << 24); 
} 
```

它最终以“致命错误：在第 133 行的 /path/scriptname.php 中耗尽的允许内存大小 47185920 字节（试图分配 71 字节）”而崩溃。

Apache 错误日志中没有任何用处。我难住了。有人对至少在哪里看有任何想法吗？即使知道它是否可能是我的脚本中的某些内容或与升级有关的内容也会很有用。我在同一提供商的另一个站点上遇到了另一个问题（升级后）无法将会话写入 tmp 目录（已解决），但我很确定不是这样（？）。

编辑：事实证明，答案与解析器的版本在某种程度上与 PHP 5.2.6 不兼容有关，我认为有问题的解析器是[Spreadsheet Excel Reader](http://sourceforge.net/project/showfiles.php?group_id=99160&package_id=106368)可能对某人有用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T15:14:01.047

在这里解决： [http ://www.phpbuilder.com/board/archive/index.php/t-10328608.html](http://www.phpbuilder.com/board/archive/index.php/t-10328608.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T23:50:45.300

> 未初始化的字符串偏移量：

... 表示这`$data`不是一个数组。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-10T01:04:16.883

感谢您的输入，通过我找到我正在使用的解析库的更新版本，情况已经“自行解决”。我的猜测是这个问题与 php 版本之间的差异有关，尽管我不确定究竟是什么。固定但令人沮丧。

编辑：纯粹为了结束这个问题，我将接受 Till 的回答。再次感谢输入。

# c# - 如何在 VS2008 监视窗口中查看字符串的十六进制值？

> ID：185241
> 
> 赞同：6
> 
> 时间：2008-10-08T22:52:31.987
> 
> 标签：c#, visual-studio-2008, debugging

我在 VS2008 的监视窗口中有一个字符串，想查看每个字符的十六进制表示。如果我右键单击有一个十六进制选项，但这似乎没有做任何事情。有人知道如何将字符串视为一系列十六进制值吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-08T23:10:41.233

将您的字符串添加为监视，然后编辑监视表达式并附加“.ToCharArray()”以将其视为字符数组。当您展开手表时，您会在每个单独的字符旁边看到字符代码。检查“十六进制显示”将显示每个字符的十六进制代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T23:02:40.077

VS 中的默认可视化工具（至少 2005 年）不支持此功能。但是，显然推出自己的可视化工具并不太麻烦：http: [//msdn.microsoft.com/en-us/library/ms379596.aspx](http://msdn.microsoft.com/en-us/library/ms379596.aspx)（这是 2005 年测试版的旧文章，但我没有认为 API 发生了很大变化。）

也许某个地方的某个人甚至写了一篇，但我还没有看到一篇。

# apache-flex - 使用多个模块时优化 Flex

> ID：185252
> 
> 赞同：3
> 
> 时间：2008-10-08T22:55:43.227
> 
> 标签：apache-flex, optimization, module, flash

我有一个 Flex 应用程序，其中加载时间非常重要（消费者网站）。我希望能够在屏幕上显示一些内容，然后根据需要允许加载其他模块。

我面临的问题是所有模块的总和比我将所有组件包含在单个 .swf 文件中要大得多。

原因很明显。例如，Web 服务访问所需的类似乎需要大约 100kb。如果我不在 main.swf 中使用这些类，那么它们将包含在使用它们的每个模块中。因此，如果我有 5 个模块，那就浪费了额外的 500kB。

理论上我想要3个级别

main.swf - 最小可能的布局/样式/字体/框架类型的东西 common.swf - 模块 1 + 模块 2 所需的附加类（例如 Web 服务） module1.swf - 站点中的模块 1 module2.swf - 站点中的模块 2

我不知道这是否可能。

我想知道是否可以为框架的一部分而不是整个框架加载 swz/swf 文件。

我真的需要将我的主要应用程序大小降低到 200Kb。当我添加 Web 服务和基本数据网格功能时，它会增长到 450kb。

任何经验教训将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-24T02:29:29.493

我知道这是不久前的事了，但我想我会发布另一个回复，以防有人仍在寻找答案。

我一直在研究如何优化 Flex 应用程序，经过一番检查后，我决定使用模块。主要是因为他们有很好的优化选项。

您需要的两个 mxmlc 命令是：

```
mxmlc -link-report=MyAppReport.xml MyApp.mxml 
```

和

```
mxmlc -load-externs=MyAppReport.xml MyModule.mxml 
```

我的外部 swf（使用 Flex 框架）现在只有 21k。它已经做了很多（还），但即使它做得越来越多，它也会继续使用主应用程序代码中的资源。

这是我为加快进程而创建的批处理文件（您必须将 mxmlc 放入环境路径变量中才能像这样工作。控制面板->系统->高级->环境变量，编辑路径系统变量，添加您的 mxmlc 的路径（需要重新启动））：

```
cd C:\Projects\MyProject\Develop\Modules
mxmlc -link-report=MyAppReport.xml C:\Projects\MyProject\Develop\Source\Main.mxml
mxmlc -load-externs=MyAppReport.xml MyModule.mxml
move /Y MyModule.swf ..\Runtime\Modules 
```

更多信息在这里： http://livedocs.adobe.com/flex/3/html/help.html?content= [modular_4.html](http://livedocs.adobe.com/flex/3/html/help.html?content=modular_4.html)

希望有帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-11T20:43:58.503

在文件大小方面，Flex 有点像猪。实际上只有一种方法可以缩小应用程序的大小，那就是为框架使用外部 swz。有一篇关于[使用 Flash Player 缓存提高 Flex 应用程序性能](http://www.adobe.com/devnet/flex/articles/flash_player_cache_02.html)的 Adob​​e Devnet 文章，我建议您阅读该文章。

在我从事的一个项目中，我们的预加载模块吸进了我们不想要的类时遇到了问题。我们必须做的是为驻留在其他模块中的类创建接口并以这种方式引用它们。加载模块时，我们只需为 IApplicationModule 分配一个引用，以便调用我们的初始化代码。

还要考虑将您的类放入单独的 SWF 文件中，然后使用 ApplicationDomain 来访问这些类

（这段代码取自[这个论坛帖子](http://flashdevelop.org/community/viewtopic.php?t=3387)，它解释了如何访问从 Flex 中的模块加载的类）

```
 private function loadContent(path:String):void 
{
   var contentLoader:Loader = new Loader();
   contentLoader.contentLoaderInfo.addEventListener(
      Event.COMPLETE,
      loadContent_onComplete);
   contentLoader.load(new URLRequest(path));
}

private function loadContent_onComplete (event:Event):void
{  
   var content:DisplayObject = event.target.content;

   if(content is IFlexModuleFactory) 
   {
      var content_onReady:Function = function (event:Event):void 
      {   
         var factory:IFlexModuleFactory = content as IFlexModuleFactory;
         var info:Object = factory.info();
         var instanceClass:Class = info.currentDomain.getDefinition(
            info.mainClassName) as Class;

         addChild (new instanceClass ());
      }

      content.addEventListener ("ready", content_onReady);

   } 
   else
   {
      addChild (content);  
   }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-30T00:04:31.647

命令行编译器上有一个选项可以排除已经编译到另一个 swf 中的类定义。它是这样工作的：

1.  编译主应用程序（其中包含加载程序）并选择生成报告。
2.  编译模块并选择排除上述报告中的类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T16:35:39.483

您可以查看[ModuleLoader](http://livedocs.adobe.com/flex/3/html/help.html?content=modular_5.html#171081)类，也许您可​​以在前 200kbs 中加载核心内容，然后在需要时加载其余部分。

另外值得牢记的是，您使用的任何 SWC 都是在编译时嵌入的，而任何 SWF 都是在运行时加载的。

# winapi - Win32 进程如何获取其父进程的 pid？

> ID：185254
> 
> 赞同：39
> 
> 时间：2008-10-08T22:56:09.763
> 
> 标签：winapi, process

我目前正在将命令行上的 pid 传递给孩子，但有没有办法在 Win32 API 中做到这一点？或者，如果父母已经去世，有人可以减轻我对我传递的 pid 可能在一段时间后属于另一个进程的恐惧吗？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-02-17T18:58:42.370

以防万一其他人遇到此问题并正在寻找代码示例，我最近必须为我正在处理的 Python 库项目执行此操作。这是我想出的测试/示例代码：

```
#include <stdio.h>
#include <windows.h>
#include <tlhelp32.h>

int main(int argc, char *argv[]) 
{
    int pid = -1;
    HANDLE h = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);
    PROCESSENTRY32 pe = { 0 };
    pe.dwSize = sizeof(PROCESSENTRY32);

    //assume first arg is the PID to get the PPID for, or use own PID
    if (argc > 1) {
        pid = atoi(argv[1]);
    } else {
        pid = GetCurrentProcessId();
    }

    if( Process32First(h, &pe)) {
        do {
            if (pe.th32ProcessID == pid) {
                printf("PID: %i; PPID: %i\n", pid, pe.th32ParentProcessID);
            }
        } while( Process32Next(h, &pe));
    }

    CloseHandle(h);
} 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-06-11T03:07:53.577

更好的方法是调用`DuplicateHandle()`创建进程句柄的可继承副本。然后创建子进程并在命令行上传递句柄值。 `Close`父进程中的重复句柄。当孩子完成后，它也需要`Close`它的副本。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2010-06-29T00:27:33.757

```
ULONG_PTR GetParentProcessId() // By Napalm @ NetCore2K
{
 ULONG_PTR pbi[6];
 ULONG ulSize = 0;
 LONG (WINAPI *NtQueryInformationProcess)(HANDLE ProcessHandle, ULONG ProcessInformationClass,
  PVOID ProcessInformation, ULONG ProcessInformationLength, PULONG ReturnLength); 
 *(FARPROC *)&NtQueryInformationProcess = 
  GetProcAddress(LoadLibraryA("NTDLL.DLL"), "NtQueryInformationProcess");
 if(NtQueryInformationProcess){
  if(NtQueryInformationProcess(GetCurrentProcess(), 0,
    &pbi, sizeof(pbi), &ulSize) >= 0 && ulSize == sizeof(pbi))
     return pbi[5];
 }
 return (ULONG_PTR)-1;
} 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-10-08T23:10:15.883

请注意，如果父进程终止，则 PID 很有可能会被另一个进程重用。这是标准的 Windows 操作。

所以可以肯定的是，一旦你收到父母的 id 并确定它确实是你的父母，你应该打开它的句柄并使用它。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-08T23:09:55.883

> “或者，如果父母已经去世，有人可以减轻我对我传递的 pid 可能在一段时间后属于另一个进程的恐惧吗？”

是的，PID 可以重复使用。与 UNIX 不同，Windows 不维护强大的父子关系树。

# security - 贵公司如何进行“企业”密码管理？

> ID：185262
> 
> 赞同：37
> 
> 时间：2008-10-08T22:59:11.410
> 
> 标签：security, passwords, enterprise

我们在[这里讨论了](https://stackoverflow.com/questions/11362/what-is-your-favorite-password-storage-tool)**个人**密码管理，但是你们如何在公司范围内管理密码？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-17T15:21:33.423

我以为我会在一周的搜索后回来报告...

我已经决定使用[PassPack](https://www.passpack.com/online/) 我已经使用它几天来作为我的个人密码了，而且我是一个忠实的粉丝。

他们使用[主机证明托管](http://en.wikipedia.org/wiki/Host-proof_hosting)模式，因此唯一可以访问您的东西的人就是您，如果您忘记了密码，他们将无法帮助您。

他们有一些用 Adob​​e AIR 和 Google Gears 编写的不错的离线应用程序。

但是，最重要的是，它们符合我的“企业”要求，因为即将发布的版本将支持在受信任的组内 [共享。](http://passpack.wordpress.com/2008/02/11/administer-and-share-passwords-between-accounts/)

另外，我在他们的论坛上了解[了“不必要的”引号的“博客” 。](http://quotation-marks.blogspot.com)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-08T23:08:23.280

我们已经设法规划了我们公司的应用程序，因此它们主要是基于 Web 和开源或内部开发的。这然后允许我们使用 LDAP 连接到活动目录以登录到我们的 Intranet。从那里我们修改了我们使用的各种产品（MediaWiki、Wordpress、SugarCRM 等）的登录，这样如果用户在内联网中通过了身份验证，他们也会自动登录到这些其他产品。

这需要一些时间来设置流程并创建脚本来在有人加入公司时在每个系统中设置所有适当的用户详细信息，但是现在我们遇到了每个人只需要记住一个密码的情况，无需管理密码不断增长的密码列表。

显然，这在许多公司中可能不可行，但现在我们已经设置好了，值得付出努力。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T23:04:02.383

我们使用密码代理：[http ://www.moonsoftware.com/pwagent.asp](http://www.moonsoftware.com/pwagent.asp)

它存储从 PC 管理员登录到网站登录和我们都使用的产品的产品密钥的所有内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T23:21:01.023

我们维护一个内部 Lotus Notes 数据库，该数据库绝对存储从密码到服务器更改记录的所有内容。它又大又笨重，需要很长时间才能加载，而且通常不是很好。

不，这不是明智的做法。:-|

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T01:56:00.197

我们使用 Active Directory 来存储用户凭据，并为桌面和 Web 开发了自定义库

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-10-03T12:14:12.583

我们正在成功使用[KeePass](http://keepass.info/)应用程序。我们为每个项目和/或每个业务领域创建文件。我们在应该有权访问的人之间共享相应 KeePass 文件的密码。

这不是最好的解决方案。我们还在公司范围内安装了 Cyber​​-Ark 软件，但由于一些奇怪的配置规则，它对我们的工作不如以前的解决方案好。这也可能与我们有一个旧版本有关。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-08T23:16:58.740

显然我有偏见，因为我在那里工作，但我们使用的是[Lieberman Software](http://www.liebsoft.com)的 Enterprise Random Password Manager 。是的，我们实际上确实在我们自己的网络中使用了我们自己的工具。它有一些不错的功能，例如带委托的 Web 可访问性、带重试的计划操作、使用帐户（服务、COM+ 应用程序等）传播到其他事物、系统/帐户发现、Linux/Unix 帐户管理等。

我确信销售人员可以给出更好的推销，但我不是。我鼓励你检查一下。:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-08T23:25:32.997

对于与我的工作相关的密码，我将它们`passwords.txt`存储在公司主文件服务器上我的用户存储区域中的一个普通未加密文件中。正常情况下，公司其他人无法读取我的用户存储区的文件，因此暴露风险很小。但是，如果我发生了什么事，那么我所有与公司相关的活动的密码都将被公司内部的其他人轻易获得——只需询问 MIS。

当然，这是一种与我用于个人密码的安全模型截然不同的安全模型。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-08T23:39:32.687

提醒一下：微软有一个产品可以跨不同系统管理凭据/密码/身份：[身份生命周期管理器](http://www.microsoft.com/ilm)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-24T20:52:44.020

Secret Server 是从内部需求（在我们的软件公司内部）发展成为现在在世界各地使用的可行产品的东西。它是基于 Web 的，允许您存储密码，然后与其他用户和组（甚至是 AD 用户和组）安全地共享它们。它还能够主动联系并按自动计划更改密码，甚至处理相关的依赖项，例如服务帐户的 Windows 服务。

[企业密码管理](http://thycotic.com/products_secretserver_overview.html)（30 天免费试用）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-06-09T14:06:28.767

使用**[Apache Directory Server](http://directory.apache.org/)**，这是一个[LDAP](http://en.wikipedia.org/wiki/LDAP)标准实现。

**[您可以使用Apache Directory Studio](http://directory.apache.org/studio/)**管理目录数据库，因此它对用户非常友好（或至少对管理员友好）。

然后，您可以以编程方式将目录挂接到任何需要访问凭证的应用程序，LDAP 客户端库在流行的编程平台上广泛可用，例如 Java、C++、PHP、Ruby 等。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-10-16T15:37:14.580

我的商业朋友建议我查看 Passwork ( [https://passwork.me](https://passwork.me) )。他们在自己的服务器上使用自托管版本，我发现 Passwork 也有 SaaS。所以我和我的同事将我们公司的密码存储在 Passwork 中。

我们之前曾尝试过另一位企业 pw 经理，但无法信任他们。

* * *

## 回答 #13

> 赞同：-7
> 
> 时间：2008-10-16T19:57:11.357

我们查看了具有以下功能的产品：

*   可以使用角色授予对密码的访问权限。
*   处理委托。
*   记录对密码的访问。
*   可以随机化密码。
*   可以在访问密码 X 天后自动重新随机化密码。

不幸的是，当我发布此消息时，我无法理解它的名字......它是“秘密服务器”

# c# - 如何使一个类对整个应用程序全局化？

> ID：185282
> 
> 赞同：5
> 
> 时间：2008-10-08T23:04:53.303
> 
> 标签：c#, .net

我想在我的应用程序的任何地方访问一个类，我该怎么做？

为了更清楚，我在某处有一个使用一些代码的类。我有另一个使用相同代码的类。我不想重复，所以我想通过使用某些东西在两个地方调用相同的代码。在 php 中，我只会在两者中都包含（“abc.php”）......我不想每次我想使用代码时都创建对象。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-08T23:08:58.270

您想从任何地方访问该类或访问该类的实例吗？

您可以将其设为静态类，`public static class MyClass { }`也可以使用[单例模式](http://en.wikipedia.org/wiki/Singleton_pattern)。

对于最简单形式的单例模式，您可以简单地将静态属性添加到返回类的相同实例的类（或其他类），如下所示：

```
public class MyClass
{
     private static MyClass myClass;

     public static MyClass MyClass
     {
          get { return myClass ?? (myClass = new MyClass()); }
     }

     private MyClass()
     {
          //private constructor makes it where this class can only be created by itself
     }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-08T23:06:11.833

C# 中全局类的概念实际上只是引用包含该类的适当程序集的简单问题。一旦您引用了所需的程序集，您可以通过它的完全限定类型名称或通过导入包含该类的命名空间来引用选择的类。（具体实例或对该类的**静态访问）**

或者

你可以有一个**Singleton 类**在任何地方使用它，但有些人不会推荐你以这种方式继续。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T23:16:06.870

您得到的关于使用静态类或单例模式的其他答案是正确的。

但是，请考虑这样做会损害您的测试能力的事实。一般来说，如果可以的话，更喜欢依赖注入而不是全局访问的类。我知道这并不总是可能的（或实际的）。

就在这一点上，您还应该查找[抽象工厂模式](http://en.wikipedia.org/wiki/Abstract_factory_pattern)。它允许您拥有一个众所周知的工厂类，该类可以生成您正在使用的类的实际实例。例如，要拥有一个全局访问的日志类，不要直接创建一个日志类。相反，使用日志工厂为您创建它并将接口返回给日志记录类。这样更容易换入和换出不同的日志记录类。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-08T23:17:32.280

因为你不想每次都创建对象，听起来你在谈论某种实用方法......

我建议您在程序集中使用[静态方法](http://www.google.com/search?hl=en&rlz=1B3GGGL_enUS267US267&q=static+method+C%23&btnG=Search)，您可以在需要时引用它

# c++ - 设计字符串本地化的最佳方法

> ID：185291
> 
> 赞同：22
> 
> 时间：2008-10-08T23:07:30.507
> 
> 标签：c++, windows, mfc, localization

这是一个笼统的问题，欢迎发表意见。我一直在尝试想出一种好方法来设计用于 Windows MFC 应用程序和相关实用程序的字符串资源本地化。我的愿望清单是：

*   必须在代码中保留字符串文字（而不是用宏 #define 资源 ID 替换），以便消息仍然可以内联读取
*   必须允许本地化字符串资源（duh）
*   不得施加额外的运行时环境限制（例如：对 .NET 的依赖等）
*   对现有代码的干扰应该最小（修改越少越好）
*   应该是可调试的
*   应生成可用常用工具编辑的资源文件（即：常用格式）
*   不应使用复制/粘贴注释块来保留代码中的文字字符串或任何其他可能导致去同步的内容
*   允许静态（编译时）检查每个“注释”字符串是否在资源文件中会很好
*   允许跨语言资源字符串池会很好（适用于各种语言的组件，例如：本机 C++ 和 .NET）

除了静态检查之外，我有一种方法可以在某种程度上满足我的所有愿望，但我不得不开发一些自定义代码来实现它（并且它有局限性）。我想知道是否有人以特别好的方式解决了这个问题。

编辑：我目前拥有的解决方案如下所示：

```
ShowMessage( RESTRING( _T("Some string") ) );
ShowMessage( RESTRING( _T("Some string with variable %1"), sNonTranslatedStringVariable ) ); 
```

然后，我有一个自定义实用程序来解析“RESTRING”块中的字符串并将它们放入一个 .resx 文件中以进行本地化，并使用一个单独的 C# COM 对象从本地化资源文件中加载它们并返回。如果 C# 对象不可用（或无法加载），我会回退到代码中的字符串。该宏扩展为一个模板类，该类调用 COM 对象并进行格式化等。

无论如何，我认为添加我现在的参考资料会很有用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-08T23:30:50.007

我们使用英文字符串作为 ID。

如果从国际资源对象（从安装的 I18N dll 加载）查找失败，那么我们默认使用 ID 字符串。

代码如下：

```
doAction(I18N.get("Press OK to continue")); 
```

作为构建过程的一部分，我们有一个 perl 脚本来解析字符串常量的所有源。它构建应用程序中所有字符串的临时文件，然后将它们与每个本地的资源字符串进行比较，以查看它们是否存在。任何缺失的字符串都会向相应的翻译团队发送一封电子邮件。

我们可以为每个本地设置多个 dll。dll 的名称基于 RFC 3066
语言[_territory][.codeset][@modifier]

我们尝试从机器中提取语言环境，并在加载 I18N dll 时尽可能具体，但如果不存在更具体的版本，则回退到不太具体的本地变体。

例子：

在英国：如果本地是**en_GB.UTF-8**
（我松散地使用术语 dll，而不是在特定的 Windows 意义上）。

首先查找**I18N.en_GB.UTF-8** dll。如果此 dll 不存在，则回**退到 I18N.en_GB**。如果这个 dll 不存在回**退到 I18N.en**如果这个 dll 不存在回**退到 I18N.default**

此规则的唯一例外是：简体中文 (zh_CN)，其中备用是美国英语 (en_US)。如果机器不支持简体中文，则不太可能支持全中文。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-24T02:41:19.710

简单的方法是只在代码中使用字符串 ID - 不使用文字字符串。然后，您可以为每种语言生成不同版本的 .rc 文件，并创建仅资源 DLL 或仅创建不同的语言版本。

有几个共享软件 utilstohelp 本地化 rc 文件，这些文件可以处理为具有较长单词的语言调整对话框元素的大小，并警告缺少翻译。

一个更复杂的问题是词序，如果 printf 中有多个数字，对于不同语言的语法，它们的顺序必须不同。codeproject 上有一些扩展的 printf 类，可让您指定诸如 printf("word %1s and %2s",var1,var2) 之类的内容，以便您可以在必要时切换 %1s 和 %2s。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T23:20:14.833

我不太了解这通常在 Windows 上是如何完成的，但是在 Apple 的[Cocoa 框架](http://developer.apple.com/documentation/MacOSX/Conceptual/BPInternational/Articles/StringsFiles.html)中处理本地化字符串的方式非常有效。它们有一个非常基本的文本格式文件，您可以将其发送给翻译器，以及一些用于从文件中检索值的预处理器宏。

在您的代码中，您将看到以您的母语显示的字符串，而不是不透明的 ID。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T02:25:13.070

由于它是开放的意见，这就是我的做法。

我的本地化文本文件是一个简单的制表符分隔的文本文件，可以在 Excel 中加载和编辑。第一列用于定义，右侧的每一列是后续语言，例如：

```
ID              ENGLISH      FRENCH    GERMAN
STRING_YES      YES          OUI       YA
STRING_NO       NO           NON       NEIN 
```

然后在我的makefile 中是一个自定义构建步骤，它生成一个strings.h 文件和一个strings.dat。在我的例子中，它为字符串 ids 构建一个枚举列表，然后为文本构建一个带有偏移量的二进制文件。由于在我的应用程序中，用户可以随时更改语言，我将它们全部保存在内存中，但如果需要，您可以轻松地让预处理器为每种语言生成不同的输出文件。

我喜欢这个设计的一点是，如果缺少任何字符串，那么我会得到一个编译错误，而如果在运行时查找字符串，那么您可能直到稍后才知道代码中很少使用的部分中缺少字符串。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-10T15:13:35.050

您的解决方案与 Unix/Linux " " 解决方案非常相似`gettext`。事实上，您不需要编写提取例程。

我不确定您为什么希望 _RESTRING 宏处理多个参数。我的代码（使用 wxWidgets 对 gettext 的支持）如下所示`MyString.Format(_("Some string with variable %ls"), _("variable"));`：也就是说，String::Format(...) 得到两个单独翻译的参数。事后看来，Boost::Format 会更好，但它也允许`boost::format(_("Some string with variable %1")) % _("variable");`

（为简洁起见，我们使用`_()`宏）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T18:45:24.450

您想要一个我一直想编写但一直没有时间编写的高级实用程序。如果您没有找到这样的工具，您可能想要回退到我的 CMsg() 和 CFMsg() 包装类，它们允许非常轻松地从资源表中提取字符串。（CFMsg 甚至提供了 FormatMessage 单行包装器。是的，如果没有您正在寻找的工具，在注释中保留字符串的副本是一个很好的解决方案。关于注释的去同步，请记住字符串文字是很少改变。

[http://www.codeproject.com/KB/string/stringtable.aspx](http://www.codeproject.com/KB/string/stringtable.aspx)

顺便说一句，本机 Win32 程序和 .NET 程序具有完全不同的资源存储管理。您将很难为两者找到共同的解决方案。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-08T23:16:52.063

在我已本地化为 10 多种语言的一个项目中，我将要本地化的所有内容都放入一个仅资源的 dll 中。在安装时，用户选择了与他们的应用程序一起安装的 dll。

我只需要将英文 dll 交付给本地化团队。他们为我在构建中包含的每种语言返回了一个本地化的 dll。

我知道这并不完美，但它确实有效。

# asp.net - IIS 回收太频繁

> ID：185306
> 
> 赞同：2
> 
> 时间：2008-10-08T23:12:29.387
> 
> 标签：asp.net, iis, windows-server-2003

我们在 W2k3 服务器上运行一个 .NET 1.1 应用程序。应用程序池配置为以 512MB 回收。然而，一周前它开始每 2 分钟循环一次。由于我们运行一个网络场，我们运行 IIS 的匿名用户是一个域帐户。大约一周前，该用户帐户已过期，我们必须重新启用它。这会导致任何问题吗？也许该用户丢失了一些权限，或者被排除在 IIS_WPG 组之外。任何建议将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-08T23:15:32.143

[尝试通过记录 ASP.NET 应用程序关闭事件](http://weblogs.asp.net/scottgu/archive/2005/12/14/433194.aspx)来了解更多信息

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-08T23:15:21.317

查看服务器的事件日志。这可能是答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T02:23:05.663

如果在检查日志和所有标准的“应用程序池运行状况”设置（显而易见）之后，我会寻找可能与您的 web.config 文件混在一起的其他进程（检查它的时间戳），这当然会导致应用程序重新启动。

我曾经在一个客户站点，我们无法弄清楚为什么我们的应用程序不断重新启动（并删除所有会话状态等......）原来这是一个损坏的“自动​​加密所有 Web.Config 文件”小脚本，他们计划每 5 分钟运行一次。问题是它从未正确检测到它已成功加密文件，所以它只是每 5 分钟重写一次......叹息......

# silverlight-2-rc0 - Silverlight 2.0 RC 列表框的拖放排序

> ID：185307
> 
> 赞同：4
> 
> 时间：2008-10-08T23:12:33.740
> 
> 标签：silverlight-2-rc0

我正在尝试提供 ListBox 拖放排序功能，但我碰壁了。当我在 xaml 中指定列表框项目时，它可以工作，但是当我绑定到列表时它不起作用，因为这些项目不再是 listboxitem 类型。

我发现这段代码[http://blog.dobaginski.com/josh/?p=52](http://blog.dobaginski.com/josh/?p=52)允许我获取底层 ListBoxItem 但我无法触发鼠标移动事件。

我已经阅读了其他教程，但无法找到处理 ListBox 的教程。有没有人用 ListBox 做到这一点。

我使用的事件是 SelectedChange、MouseMove 和 LeftMouseButtonUp（我认为这个名字是对的）。我没有使用 LeftMouseButtonDown，因为我无法启动它。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T00:06:06.300

据我所知，使用数据绑定时您无法访问列表框项容器。你可以在 Beta 1 中。

您也不能在样式中设置鼠标事件处理程序，您必须使用数据模板，正如您所知。

您可能必须使用父元素的鼠标移动事件，可能是承载列表框的 UserControl 或主布局控件。

状态变化和动画需要在样式中，所以......你仍然无法获得列表框项目，只是数据模板中的元素。

哦，如果现在进行拖放 HitTest 受到保护，那么这将使 Drop 更难。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-14T20:40:47.917

从今天开始，您可以下载带有一些附加组件的 Silverlight 最终 2.0 版本，查看[Scott 的网络日志](http://weblogs.asp.net/scottgu/archive/2008/10/14/silverlight-2-released.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T11:56:23.043

我一直在尝试在 WPF 中做同样的事情，但只发现了许多错误的实现。

一个人把我带到了 Beatriz Costa 的博客，据我所知，她是那些罕见的天才之一，所以我建议你也读一下……我知道我会的

[Beatriz Costa 的博客](http://www.beacosta.com/blog/?p=53)

# c# - 如果我没有在我的 C# 控制台应用程序中关闭 System.Diagnostics.Process 会发生什么？

> ID：185314
> 
> 赞同：4
> 
> 时间：2008-10-08T23:15:23.220
> 
> 标签：c#, process

我有一个 C# 应用程序，它使用 System.Diagnostics.Process 来运行另一个 exe。我遇到了一些示例代码，其中进程在 try 块中启动并在 finally 块中关闭。我还看到了进程未关闭的示例代码。

当进程没有关闭时会发生什么？

当创建进程的控制台应用关闭时，进程使用的资源是否被回收？

在长时间打开的控制台应用程序中打开大量进程而不关闭其中任何一个进程是不是很糟糕？

干杯!

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-08T23:25:44.057

当另一个进程*退出时，**它*的所有资源都被释放，但除非你调用`Close()`你的`Process`引用，否则你仍然会持有一个进程句柄（它是一个指向有关进程的信息块的指针） 。我怀疑会有很多问题，但**你也可以**。`Process`实现`IDisposable`，因此您可以使用 C# 的`using(...)`语句，它将自动为您调用`Dispose`（因此`Close()`）：

```
using (Process p = Process.Start(...))
{
  ...
} 
```

根据经验：如果某些东西实现了`IDisposable`，你真的*应该*调用`Dispose`/`Close`或使用`using(...)`它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-08T23:19:07.923

它们将继续运行，就像您自己启动它们一样。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-08T23:23:08.290

进程是一个独立的实体。以编程方式创建进程与从桌面启动进程非常相似。

您创建的进程的句柄只是为了方便而返回。例如访问它的输入和输出流或（如您所见）杀死它。

当父进程被杀死时，资源不会被回收。

打开大量进程的唯一不好的情况是，如果您打开的进程太多以至于 CPU 和 RAM 无法处理它！

# dll - 什么是“.dll.a”文件？

> ID：185326
> 
> 赞同：35
> 
> 时间：2008-10-08T23:19:35.613
> 
> 标签：dll, winapi

我正在尝试使用 Windows 应用程序中的开源库，我能找到的唯一预构建版本是一个名为“lib.dll.a”的文件

这是什么格式，我可以把它转换成普通的dll文件吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2012-04-14T06:43:13.403

命名输出文件`libjvm.dll.a`将允许`gcc`将其识别为名为`jvm`. 后缀（按照`.dll.a`惯例）表明它是一个导入库，而不是一个静态库（按照 `libjvm.a`惯例，它会被简单地命名为 ）。

# sql - Oracle 连接（左外、右等：S）

> ID：185327
> 
> 赞同：4
> 
> 时间：2008-10-08T23:19:44.660
> 
> 标签：sql, oracle, join, left-join

我知道 stackoverflow 会帮助我，而不是知道什么是“最喜欢的编程卡通”：P

这是被接受的答案： [Bill Karwin](https://stackoverflow.com/questions/185327/oracle-joins-left-outer-right-etc-s#185439)

感谢大家的帮助（我想给大家投票）

我的查询结果是这样的（这是真实的）

```
SELECT 
    accepted.folio,
    COALESCE( inprog.activityin, accepted.activityin ) as activityin,
    inprog.participantin,
    accepted.completiondate 
FROM performance accepted
    LEFT OUTER JOIN performance inprog 
        ON( accepted.folio = inprog.folio 
            AND inprog.ACTIVITYIN 
            IN ( 4, 435 )                    -- both are ids for inprogress
            AND inprog.PARTICIPANTIN != 1  ) -- Ignore the "bot" participant
    LEFT OUTER JOIN performance closed
        ON( accepted.folio = closed.folio 
            AND closed.ACTIVITYIN IN ( 10,436, 4, 430  ) )  -- all these are closed or cancelled
WHERE accepted.ACTIVITYIN IN ( 3, 429 )      --- both are id for new 
AND accepted.folio IS NOT NULL
AND closed.folio IS NULL; 
```

现在我只需要加入其他表格即可获得人类可读的报告。

* * *

**原帖**

你好。

我挣扎了大约6个小时。现在有一个数据库查询（我的长期克星）

我有一个包含一些字段的数据表，例如：

```
table performance( 
     identifier varchar, 
     activity    number, 
     participant number, 
     closedate   date, 
) 
```

它用于跟踪票证的历史记录

**标识符**：是一个客户 ID，如 ( NAF0000001 )

**活动**：是票的位置（新的、进行中的、拒绝的、关闭的等）

**参与者**：是当时参加票的人的fk

**closedate**：是该活动完成的日期。

**编辑：**我应该说“完成日期”而不是关闭日期。这是活动完成的日期，在工单关闭时不是必需的。

例如，典型的历史可能是这样的：

```
标识符|活动|参与者|关闭
------------------------------------------
NA00000001| 1| 1|2008/10/08 15:00|
------------------------------------------
NA00000001| 2| 2|2008/10/08 15:20|
------------------------------------------
NA00000001| 3| 2|2008/10/08 15:40|
------------------------------------------
NA00000001| 4| 4|2008/10/08 17:05|
------------------------------------------

```

参与者 1=jonh, 2=scott, 3=mike, 4=rob

和活动 1=新，2=进行中，3=等待批准，4=关闭

等等。还有几十个其他不相关的信息。

那么我的问题如下。

我设法创建了一个查询，我可以在其中知道票证何时打开和关闭

是这样的：

```
 select 
     a.identifier,
     a.participant,
     a.closedate as start,
     b.closedate as finish      
from 
    performance a,
    performance b
where
    a.activity = 1 -- new
    and b.activity = 4 -- closed
    and a.identifier = b.identifier 
```

但我不知道哪些票**没有**关闭以及谁在参加。

到目前为止，我有这样的事情：

```
 select 
     a.identifier,
     a.participant,
     a.closedate as start
from 
    performance a        
where
    a.activity = 1 -- new
    and a.identifier not in ( select identifier from performance where activity = 4 ) --closed 
```

那就是给我所有有开始（ new = 1 ）但没有关闭（ closed = 4 ）的人

但这里最大的问题是它打印了打开票的参与者，但我需要参加它的参与者。所以我将“进行中”活动添加到查询中。

```
 select 
     a.identifier,
     a.participant,
     a.closedate as start
from 
    performance a,
    performance b        
where
    a.activity = 1 -- new        
    and a.identifier not in ( select identifier from performance where activity = 4 ) --closed
    and b.identifier = a.identifier
    and b.activity = 2  -- inprogress.. 
```

但并非“新”中的所有行都是“进行中”，并且通过该查询我删除了所有行。

我需要的是显示所有“进行中”的参与者，如果票不是“进行中”，它将显示为空。

类似的东西

```
    标识符|活动|参与者|关闭
------------------------------------------
NA00000002| 1| |2008/10/08 15:00|
------------------------------------------
NA00000003| 1| |2008/10/08 15:20|
------------------------------------------
NA00000004| 1| |2008/10/08 15:40|
------------------------------------------
NA00000005| 2| 4|2008/10/08 15:40|
------------------------------------------
NA00000006| 2| 4|2008/10/08 15:40|

```

在这种情况下

NA002、NA003 和 NA004 处于“新”状态，因此没有显示参与者

尽管

NA005 和 NA006 正在“inprgress (act = 2 )”并且他们正在被 rob (参与者 4 ) 参加

所以我记得有一个东西叫做左外连接或类似的东西，但我从来没有理解过。我想知道的是如何获取“正在进行”和“新”且未关闭的标识符。

可能稍微休息一下会帮助我理清思路。如果有人知道该怎么做，我将不胜感激。

顺便说一句，我试过：

```
 select 
     a.identifier,
     a.participant,
     a.closedate as start
from 
    performance a
    left outer join
    performance b  
    on      
    b.identifier = a.identifier
where
    a.activity = 1 -- new        
    and a.identifier not in ( select identifier from performance where activity = 4 ) --closed
    and b.activity = 2  -- inprogress.. 
```

但是给了我与以前相同的结果（仅删除“新”记录）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T23:40:37.367

通常，编写这些的更好方法是使用 EXISTS。第一个是：

```
select * from performance p1
where not exists 
    ( select * from performance p2 
      where p2.identifier = p1.identifier and p2.activity = 4 ) 
```

通过这种方式，您可以对 performance.identifier 进行键控查找，而不必在`(select identifier from performance where activity=4)`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T00:07:14.427

尝试这样的事情（我还没有测试过）：

```
SELECT p_new.identifier, COALESCE(p_inprog.activity, p_new.activity) AS activity,
  p_inprog.participant, COALESCE(p_inprog.closedate, p_new.closedate) AS closedate
FROM performance p_new
  LEFT OUTER JOIN performance p_inprog 
    ON (p_new.identifier = p_inprog.identifier AND p_inprog.activity = 2)
  LEFT OUTER JOIN performance p_closed 
    ON (p_new.identifier = p_closed.identifier AND p_closed.activity = 4)
WHERE p_new.activity = 1
  AND p_closed.identifier IS NULL; 
```

我认为人们相信外部连接比实际更难。例如：

```
A LEFT OUTER JOIN B ON (...condition...) 
```

这将返回 A 中的所有行，无论 B 中是否有任何匹配的行。如果 B 中没有匹配的行，则在 A 的该行的结果集中将所有列 B.* 视为 NULL。连接条件可以是表达式B 中的行必须满足，否则它不包含在连接中。因此，A 中的更多行将是单独的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T00:00:49.960

我认为应该这样做。

第一部分获取所有新的、未关闭且未进行中的记录。第二部分获取所有进行中的记录。然后我们将它们连接在一起，我们还可以通过在这个查询周围包装一个“SELECT * FROM”来按标识符排序。

```
select 
  a.identifier,
  a.participant,
  a.closedate as start
from 
  performance a
where
  a.activity = 1
  and not exists ( select identifier 
                   from performance b 
                   where b.activity = 4 
                   and b.identifier = a.identifier) 
  and not exists ( select identifier 
                   from performance c 
                   where c.activity = 2 
                   and c.identifier = a.identifier) 
UNION ALL
select 
  a.identifier,
  a.participant,
  a.closedate as start
from 
  performance a
where
  a.activity = 2
  and not exists ( select identifier 
                   from performance b 
                   where b.activity = 4 
                   and b.identifier = a.identifier); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T01:11:00.710

我建议您想要的是最早的记录（大概，但不一定是活动 = 1 的记录）和最近的记录（无论活动编号如何）。如果最近记录的活动为 4，则该工单已关闭。否则，参与者是票的当前持有者。如果可以重新打开票证，则仅匹配 activity = 4 会引入一个潜在的错误。

实际上，根据您的示例，您甚至可能不需要最早的记录。以下情况如何：

```
SELECT
        identifier,
        activity,
        participant,
        closedate
    FROM
        performance a
    WHERE
        (a.identifier, a.closedate) in
            (select b.identifier, max(b.closedate)
                from performance b
                group by b.identifier
            )
; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T13:47:21.273

这个怎么样：

```
SELECT * FROM (
  SELECT identifier,
         MAX(activity) activity,
         MAX(participant) KEEP (DENSE_RANK LAST ORDER BY activity)
    FROM performance
    GROUP BY identifier
)
WHERE activity in (1,2) 
```

内部查询给出了每张票及其对应参与者的最新活动。外部查询将其过滤到活动为“新”或“进行中”的活动。

我喜欢 DENSE_RANK 函数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-08T23:49:06.473

首先，如果您可以让客户同时打开多张票，您可能会遇到设计问题。理想情况下，您应该有一个ticket_id，然后您可以使用ticket_id 而不是标识符来执行Andy 的查询。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-09T00:01:59.863

哪些票没有关闭：

```
select identifier as closed_identifier 
  from performance where identifier not exists
  (select identifier from performance where activity=4) 
```

正在参加的门票：

```
select identifier as inprogress_identifier, participant performance 
  from performance where activity=2 
```

未关闭的门票，其中的参与者正在参加：

```
select * from 
  (select identifier as notclosed_identifier 
    from performance where identifier not exists
    (select identifier from performance where activity=4)) closed 
left join 
  (select identifier as inprogress_identifier, participant performance 
    from performance where activity=2) attended 
on notclosed_identifier=inprogress_identifier 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-09T03:59:41.693

也许您可以使用这种查询作为起点。

```
select x.identifier, 
       max(x.p_1) as new_participant, max(x.c_1) as new_date,
       max(x.p_2) as inprogress_participant, max(x.c_2) as inprogress_date,
       max(x.p_3) as approval_participant, max(x.c_3) as approval_date,
       max(x.p_4) as closing_participant, max(x.c_4) as closing_date
  from (
        select a.identifier, 
               decode (activity, 1, participant, null) as p_1,  decode (activity, 1, closedate, null) as c_1,
               decode (activity, 2, participant, null) as p_2,  decode (activity, 2, closedate, null) as c_2,
               decode (activity, 3, participant, null) as p_3,  decode (activity, 3, closedate, null) as c_3,
               decode (activity, 4, participant, null) as p_4,  decode (activity, 4, closedate, null) as c_4
          from performance a
        ) x
 group by x.identifier 
```

这个想法是将您的表从行序列化到字段，并基于它创建一个视图。您可以基于此视图创建报告。

问候，

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-09T07:51:04.503

只是一个其他人可能会建立的快速想法（未经测试，但我希望这个想法能够实现）：

首先，选择所有尚未结束的活动（由其他人发布）：

```
select id
from performance p1 where identifier not exists
  (select * from performance p2 where activity=4 and p1.id=p2.id) 
```

然后，您可以通过在 select 子句中添加子查询来添加参加活动的人员：

```
select id,
 (select participant 
  from performance p3 
  where p3.activity=3 and p1.id=p2.id)
from performance p1 where identifier not exists
  (select * from performance p2 where activity=4 and p1.id=p2.id) 
```

如果此 id 没有活动 3 记录，则子查询返回 null，这正是我们所需要的。

希望这会有所帮助-如有必要，请扩展。

# c# - 我可以在 XAML（.NET 4 之前）中指定泛型类型吗？

> ID：185349
> 
> 赞同：75
> 
> 时间：2008-10-08T23:28:07.360
> 
> 标签：c#, wpf, xaml, generics

在 XAML 中，我可以声明一个 DataTemplate，以便在显示特定类型时使用该模板。例如，此 DataTemplate 将使用 TextBlock 来显示客户的姓名：

```
<DataTemplate DataType="{x:Type my:Customer}">
    <TextBlock Text="{Binding Name}" />
</DataTemplate> 
```

我想知道是否可以定义一个在显示 IList<Customer> 时将使用的 DataTemplate。因此，如果 ContentControl 的内容是 ObservableCollection<Customer>，它将使用该模板。

是否可以使用 {x:Type} 标记扩展在 XAML 中声明像 IList 这样的泛型类型？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-09T10:39:12.230

不是直接在 XAML 中，但是您可以`DataTemplateSelector`从 XAML 中引用一个来选择正确的模板。

```
public class CustomerTemplateSelector : DataTemplateSelector
{
    public override DataTemplate SelectTemplate(object item,
                                                DependencyObject container)
    {
        DataTemplate template = null;
        if (item != null)
        {
            FrameworkElement element = container as FrameworkElement;
            if (element != null)
            {
                string templateName = item is ObservableCollection<MyCustomer> ?
                    "MyCustomerTemplate" : "YourCustomerTemplate";

                template = element.FindResource(templateName) as DataTemplate;
            } 
        }
        return template;
    }
}

public class MyCustomer
{
    public string CustomerName { get; set; }
}

public class YourCustomer
{
    public string CustomerName { get; set; }
} 
```

资源字典：

```
<ResourceDictionary 
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:WpfApplication1"
    >
    <DataTemplate x:Key="MyCustomerTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="150"/>
            </Grid.RowDefinitions>
            <TextBlock Text="My Customer Template"/>
            <ListBox ItemsSource="{Binding}"
                     DisplayMemberPath="CustomerName"
                     Grid.Row="1"/>
        </Grid>
    </DataTemplate>

    <DataTemplate x:Key="YourCustomerTemplate">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="150"/>
            </Grid.RowDefinitions>
            <TextBlock Text="Your Customer Template"/>
            <ListBox ItemsSource="{Binding}"
                     DisplayMemberPath="CustomerName"
                     Grid.Row="1"/>
        </Grid>
    </DataTemplate>
</ResourceDictionary> 
```

窗口 XAML：

```
<Window 
    x:Class="WpfApplication1.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" 
    Height="300" 
    Width="300"
    xmlns:local="clr-namespace:WpfApplication1"
    >
    <Grid>
        <Grid.Resources>
            <local:CustomerTemplateSelector x:Key="templateSelector"/>
        </Grid.Resources>
        <ContentControl 
            Content="{Binding}" 
            ContentTemplateSelector="{StaticResource templateSelector}" 
            />
    </Grid>
</Window> 
```

后面的窗口代码：

```
public partial class Window1
{
    public Window1()
    {
        InitializeComponent();
        ObservableCollection<MyCustomer> myCustomers
            = new ObservableCollection<MyCustomer>()
        {
            new MyCustomer(){CustomerName="Paul"},
            new MyCustomer(){CustomerName="John"},
            new MyCustomer(){CustomerName="Mary"}
        };

        ObservableCollection<YourCustomer> yourCustomers
            = new ObservableCollection<YourCustomer>()
        {
            new YourCustomer(){CustomerName="Peter"},
            new YourCustomer(){CustomerName="Chris"},
            new YourCustomer(){CustomerName="Jan"}
        };
        //DataContext = myCustomers;
        DataContext = yourCustomers;
    }
} 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-09T01:26:00.490

不是开箱即用，不；但是有一些有进取心的开发人员已经这样做了。

例如，微软的 Mike Hillberg 在[这篇文章](http://blogs.msdn.com/mikehillberg/archive/2006/10/06/LimitedGenericsSupportInXaml.aspx)中使用了它。谷歌当然还有其他的。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2010-10-28T23:09:45.407

您还可以将泛型类包装在指定 T 的派生类中

```
public class StringList : List<String>{} 
```

并使用 XAML 中的 StringList。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-11-04T01:28:37.830

[aelij（ WPF Contrib](http://www.codeplex.com/wpfcontrib)项目的项目协调员）有另一种[方法](http://arbel.net/blog/archive/2008/10/27/activator-2-xaml-and-generics-day.aspx)来做到这一点。

更酷的是（即使它在未来的某个时候关闭）...... XAML 2009（XAML 2006 是当前版本）将在本机上支持这一点。查看此[PDC 2008 会议](http://channel9.msdn.com/pdc2008/TL36/)以获取更多信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-11-11T10:01:42.610

这完全违背了泛型的目的，但是您可以像这样定义一个从泛型派生的类，其唯一目的是能够在 XAML 中使用该类型。

```
public class MyType : List<int> { } 
```

并在 xaml 中使用它，例如

```
<DataTemplate DataType={x:Type myNamespace:MyType}> 
```

# database - 直接在数据库系统中实现功能/代码

> ID：185363
> 
> 赞同：3
> 
> 时间：2008-10-08T23:35:06.363
> 
> 标签：database

如今，RDBMS 软件包提供了超出标准数据存储和检索的大量功能。例如，SQL Server 可以发送电子邮件、公开 Web 服务方法以及执行 CLR 代码以及其他功能。但是，我一直试图将我的数据库服务器的处理量限制为尽可能多地存储和检索数据，原因如下：

*   数据库服务器比 Web 服务器更难扩展
*   在我参与过的许多项目中，DB 服务器比 Web 服务器更忙，因此备用容量更少
*   它可能会使您的数据库服务器受到安全攻击（例如 Web 服务）

我的问题是，您如何决定在您的数据库服务器上与架构中的其他服务器上直接实现多少功能或代码？你对开始新项目的人有什么建议？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T00:40:53.343

我知道 Microsoft SQL Server 和 Oracle 真正推动对所有事情都使用存储过程，这有助于封装关系架构并为通常不那么容易编写 SQL 查询的软件开发人员创建一个更加程序化的接口。

但是，您的应用程序逻辑的一半是用 PL/SQL（或 T-SQL 或其他）编写的，另一半是用您的应用程序语言、Java、PHP 或 C# 等编写的。DBA 通常负责对过程进行编码，并且开发人员负责其他一切。没有人可以看到和访问完整的应用程序逻辑。这往往会减慢项目的开发、测试和未来修订。

此外，软件开发工具往往不适合存储过程。用于调试、源代码控制和测试的工具和最佳实践似乎都落后于应用程序语言的最新技术大约 10 到 15 年。

因此，如果可能的话，我倾向于远离存储过程和触发器。除非在某些情况下，一个放置良好的存储过程可以使复杂的 SQL 操作完全发生在服务器中，而不是来回打乱数据。这对于消除性能瓶颈非常有效。

在另一个方向上也可能走得太远。更喜欢应用程序管理数据而不是元数据，并采用实体-属性-值或多态关联等设计的人会给自己带来麻烦。让数据库管理它。使用参照完整性约束（外键）。使用事务。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-08T23:40:38.800

供应商有一套最佳实践。但是，您对此表示担忧。

几年前，我支持了一个**主要的软件产品**。主要的。

他们说“数据库是关系存储。仅此而已。” 每个用户会议的人都会询问存储过程、触发器和所有这些问题。

他们的建筑师很坚定。一旦您摆脱了普通的 SQL，您就会遇到支持和维护的噩梦。他们将数据库中的对象关系映射到他们的产品中，其他一切都在他们的产品中。

这可以很好地扩展。多个应用程序服务器可以轻松共享单个数据库服务器。

# python - 匹配文件名开头和文件扩展名的正则表达式

> ID：185378
> 
> 赞同：25
> 
> 时间：2008-10-08T23:42:27.737
> 
> 标签：python, sql, regex, sql-like

匹配以“Run”开头且文件扩展名为“.py”的字符串（在本例中为文件名）的正则表达式是什么？

正则表达式应匹配以下任何一项：

```
RunFoo.py
RunBar.py
Run42.py 
```

它不应该匹配：

```
myRunFoo.py
RunBar.py1
Run42.txt 
```

我正在寻找的 SQL 等价物是`... LIKE 'Run%.py' ...`.

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-10-08T23:48:59.517

对于正则表达式，您将使用：

```
re.match(r'Run.*\.py$') 
```

快速解释：

*   . 表示匹配任何字符。
*   * 表示匹配前一个字符的任何重复（因此 .* 表示任何字符序列）
*   \ 是转义显式点的转义
*   $ 表示“字符串的结尾”，所以我们不匹配“Run_foo.py.txt”

但是，对于此任务，您最好使用简单的字符串方法。IE。

```
filename.startswith("Run") and filename.endswith(".py") 
```

注意：如果您想要不区分大小写（即匹配“run.PY”和“Run.py”，请使用正则表达式的 re.I 选项，或转换为特定大小写（例如 filename.lower()）在使用字符串方法之前。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-09T00:01:25.030

警告：

*   jobscry 的答案 ("^Run.?.py$") 不正确（例如，将不匹配 "Run123.py"）。
*   orlandu63 的答案 ("/^Run[\w]*?.py$/") 将不匹配 "RunFoo.Bar.py"。

（我没有足够的声誉来发表评论，抱歉。）

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-09T01:27:29.927

我真的不明白你为什么要使用正则表达式来解决这个“问题”。您只是想找到所有以“运行”开头的 .py 文件。所以这是一个简单的解决方案，它可以工作，而不需要编译一个正在运行的正则表达式：

```
import os
for filename in os.listdir(dirname):
    root, ext = os.path.splitext(filename)
    if root.startswith('Run') and ext == '.py':
        print filename 
```

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-10-08T23:46:24.747

```
/^Run.*\.py$/ 
```

或者，特别是在 python 中：

```
import re
re.match(r"^Run.*\.py$", stringtocheck) 
```

这将匹配“Runfoobar.py”，但不匹配“runfoobar.PY”。要使其不区分大小写，请改用：

```
re.match(r"^Run.*\.py$", stringtocheck, re.I) 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-09T11:57:56.613

您不需要正则表达式，可以使用 glob，它采用通配符，例如 Run*.py

例如，要在当前目录中获取这些文件...

```
import os, glob
files = glob.glob( "".join([ os.getcwd(), "\\Run*.py"]) ) 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-09T01:20:30.330

如果你写一个稍微复杂一点的正则表达式，你可以获得一个额外的功能：提取“Run”和“.py”之间的位：

```
>>> import re
>>> regex = '^Run(?P<name>.*)\.py$'
>>> m = re.match(regex, 'RunFoo.py')
>>> m.group('name')
'Foo' 
```

（额外的一点是括号和它们之间的所有内容，除了 '.*' 这与 Rob Howard 的回答一样）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-08T23:45:57.230

这可能不完全符合文件命名标准，但在这里：

```
/^Run[\w]*?\.py$/ 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-08T23:47:56.633

也许：

```
^Run.*\.py$ 
```

只是快速尝试

# c# - 如何以编程方式在 C# 中使用“使用”关键字？

> ID：185381
> 
> 赞同：7
> 
> 时间：2008-10-08T23:43:51.993
> 
> 标签：c#, process

我有一些 System.Diagnotics.Processes 要运行。我想自动调用它们的 close 方法。显然“使用”关键字为我做了这个。

这是使用 using 关键字的方式吗？

```
foreach(string command in S) // command is something like "c:\a.exe"
{
    try
    {
        using(p = Process.Start(command))
        {
            // I literally put nothing in here.
        }
    }
    catch (Exception e)
    {
        // notify of process failure
    }
} 
```

我想启动多个进程同时运行。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-09T00:12:28.610

```
using(p = Process.Start(command)) 
```

这将编译，因为`Process`类实现了`IDisposable`，但是您实际上想要调用该`Close`方法。
从逻辑上讲，该`Dispose`方法会`Close`为您调用，并且通过使用反射器深入研究 CLR，我们可以看到它实际上为我们执行了此操作。到现在为止还挺好。

再次使用反射器，我查看了该`Close`方法的作用——它释放了底层的本机 win32 进程句柄，并清除了一些成员变量。这（释放外部资源）*正是*IDisposable 模式应该做的。

**但是**我不确定这是否是您想要在这里实现的目标。

释放底层句柄只是对 Windows 说“我不再对跟踪这个其他进程感兴趣”。它实际上不会导致其他进程退出，或导致您的进程等待。

如果要强制它们退出，则需要`p.Kill()`在进程上使用该方法-但是请注意，杀死进程绝不是一个好主意，因为它们无法自行清理，并且可能会留下损坏的文件，并且很快。

如果您想等待他们自行退出，您可以使用`p.WaitForExit()`- 但是这仅在您一次等待一个进程时才有效。如果你想同时等待它们，那就很棘手了。

通常你会使用`WaitHandle.WaitAll`这个，但由于没有办法从 a 中`WaitHandle`取出一个对象`System.Diagnostics.Process`，你不能这样做（说真的，微软在想什么？）。

您可以为每个进程启动一个线程，并在这些线程中调用 `WaitForExit，但这也是错误的方法。

相反，您必须使用 p/invoke 来访问本机 win32`WaitForMultipleObjects`功能。

这是一个示例（我已经测试过，并且确实有效）

```
[System.Runtime.InteropServices.DllImport( "kernel32.dll" )]
static extern uint WaitForMultipleObjects( uint nCount, IntPtr[] lpHandles, bool bWaitAll, uint dwMilliseconds );

static void Main( string[] args )
{
    var procs = new Process[] {
        Process.Start( @"C:\Program Files\ruby\bin\ruby.exe", "-e 'sleep 2'" ),
        Process.Start( @"C:\Program Files\ruby\bin\ruby.exe", "-e 'sleep 3'" ),
        Process.Start( @"C:\Program Files\ruby\bin\ruby.exe", "-e 'sleep 4'" ) };
    // all started asynchronously in the background

    var handles = procs.Select( p => p.Handle ).ToArray();
    WaitForMultipleObjects( (uint)handles.Length, handles, true, uint.MaxValue ); // uint.maxvalue waits forever

} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T01:50:13.750

供参考：*IDisposable*对象的*using*关键字：

 *```
using(Writer writer = new Writer())
{
    writer.Write("Hello");
} 
```

只是编译器语法。它编译成的是：

```
Writer writer = null;
try
{
    writer = new Writer();
    writer.Write("Hello");
}
finally
{
    if( writer != null)
    {
        ((IDisposable)writer).Dispose();
    }
} 
```

`using`更好一点，因为编译器会阻止您在 using 块内重新分配编写器引用。

框架指南第 9.3.1 节 p。256 状态：

> **考虑**提供方法 Close()，除了 Dispose()，如果 close 是该领域的标准术语。

* * *

在您的代码示例中，外部 try-catch 是不必要的（见上文）。

由于 Dispose() 一旦`p`超出范围就会被调用，因此使用可能不会做你想做的事情。这不会关闭进程（已测试）。

进程是独立的，因此除非您将`p.WaitForExit()`它们称为分拆并完全独立于您的程序做自己的事情。

与直觉相反，对于 Process，Close() 仅释放资源但使程序运行。CloseMainWindow() 可以对某些进程起作用，而 Kill() 可以杀死任何进程。CloseMainWindow() 和 Kill() 都可以抛出异常，所以在 finally 块中使用它们时要小心。

最后，这里有一些代码等待进程完成，但在发生异常时不会终止进程。我并不是说它比 Orion Edwards 更好，只是不同而已。

```
List<System.Diagnostics.Process> processList = new List<System.Diagnostics.Process>();

try
{
    foreach (string command in Commands)
    {
        processList.Add(System.Diagnostics.Process.Start(command));
    }

    // loop until all spawned processes Exit normally.
    while (processList.Any())
    {
        System.Threading.Thread.Sleep(1000); // wait and see.
        List<System.Diagnostics.Process> finished = (from o in processList
                                                     where o.HasExited
                                                     select o).ToList();

        processList = processList.Except(finished).ToList();
        foreach (var p in finished)
        {
            // could inspect exit code and exit time.
            // note many properties are unavailable after process exits
            p.Close();
        }
    }
}
catch (Exception ex)
{
    // log the exception
    throw;
}
finally
{
    foreach (var p in processList)
    {
        if (p != null)
        {
            //if (!p.HasExited)
            // processes will still be running
            // but CloseMainWindow() or Kill() can throw exceptions
            p.Dispose();
        }

    }
} 
```

我没有打扰 Kill()'ing 进程，因为代码开始变得更加丑陋。阅读[msdn](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.aspx)文档以获取更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-08T23:58:49.030

```
try
{
   foreach(string command in S) // command is something like "c:\a.exe"
   {
      using(p = Process.Start(command))
      {
        // I literally put nothing in here.
      }

    } 
}
catch (Exception e)
{
    // notify of process failure
} 
```

它起作用的原因是因为当异常发生时，变量 p 超出范围，因此调用 Dispose 方法来关闭进程是这样​​的。此外，我认为您希望为每个命令关闭一个线程，而不是等待可执行文件完成后再继续执行下一个命令。

# c# - C#中静态构造函数/初始化器的顺序

> ID：185384
> 
> 赞同：26
> 
> 时间：2008-10-08T23:44:32.850
> 
> 标签：c#, static, dependencies, internals

在开发 C# 应用程序时，我注意到在几个地方静态初始化器相互依赖，如下所示：

```
static private List<int> a = new List<int>() { 0 };
static private List<int> b = new List<int>() { a[0] }; 
```

没有做任何特别有效的事情。这只是运气吗？C# 是否有解决此问题的规则？

**编辑：（**回复：Panos）在文件中的词法顺序似乎是王道？跨文件呢？

在寻找时，我尝试了这样的循环依赖：

```
static private List<int> a = new List<int>() { b[0] };
static private List<int> b = new List<int>() { a[0] }; 
```

并且程序运行不一样（测试套装全面失败，我没有进一步研究）。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-10-08T23:59:33.113

有关规则，请参阅[C# 规范的第 10.4 节](http://msdn.microsoft.com/en-us/library/aa645757(VS.71).aspx)：

> 当一个类被初始化时，该类中的所有静态字段首先被初始化为其默认值，然后静态字段初始化程序按文本顺序执行。同样，当创建一个类的实例时，该实例中的所有实例字段首先被初始化为其默认值，然后实例字段初始化程序按文本顺序执行。可以在默认值状态下观察具有变量初始值设定项的静态字段。但是，作为风格问题，强烈建议不要这样做。

换句话说，在您的示例中，“b”被初始化为其默认状态（null），因此在“a”的初始化程序中对它的引用是合法的，但会导致 NullReferenceException。

这些规则与 Java 不同（请参阅 [JLS 的第 8.3.2.3 节，](http://java.sun.com/docs/books/jls/third_edition/html/classes.html#287406)了解 Java 关于前向引用的规则，这些规则更具限制性）。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-08T23:54:31.127

它似乎取决于行的顺序。此代码有效：

```
static private List<int> a = new List<int>() { 1 };
static private List<int> b = new List<int>() { a[0] }; 
```

虽然这段代码不起作用（它抛出一个`NullReferenceException`）

```
static private List<int> a = new List<int>() { b[0] };
static private List<int> b = new List<int>() { 1 }; 
```

因此，显然不存在周期性依赖的规则。然而，编译器没有抱怨是很奇怪的......

* * *

编辑 - “跨文件”发生了什么？如果我们声明这两个类：

```
public class A {
    public static List<int> a = new List<int>() { B.b[0] };
}
public class B {
    public static List<int> b = new List<int>() { A.a[0] };
} 
```

并尝试使用以下代码访问它们：

```
try { Console.WriteLine(B.b); } catch (Exception e) { Console.WriteLine(e.InnerException.Message.); }
try { Console.WriteLine(A.a); } catch (Exception e) { Console.WriteLine(e.InnerException.Message); }
try { Console.WriteLine(B.b); } catch (Exception e) { Console.WriteLine(e.InnerException.Message); } 
```

我们得到这个输出：

```
The type initializer for 'A' threw an exception.
Object reference not set to an instance of an object.
The type initializer for 'A' threw an exception. 
```

因此，初始化`B`会导致静态构造函数中的异常，并使用默认值（null）`A`留下字段。`a`由于`a`is `null`，`b`也不能正确初始化。

如果我们没有循环依赖，那么一切正常。

* * *

编辑：以防万一您没有阅读评论，[Jon Skeet](https://stackoverflow.com/users/22656/jon-skeet)提供了一个非常有趣的阅读：[静态构造函数和类型初始化程序之间的区别](http://csharpindepth.com/Articles/General/Beforefieldinit.aspx)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-08T23:59:13.130

就我个人而言，我会摆脱静态初始化程序，因为它不清楚并添加一个静态构造函数来初始化这些变量。

```
static private List<int> a;
static private List<int> b;

static SomeClass()
{
    a = new List<int>() { 0 };
    b = new List<int>() { a[0] };
} 
```

这样您就不必猜测发生了什么，并且您的意图很清楚。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-08T23:58:26.847

是的，你很幸运。C# 似乎按照代码在类中出现的顺序执行代码。

```
static private List<int> a = new List<int>() { 0 };
static private List<int> b = new List<int>() { a[0] }; 
```

会工作，但...

```
static private List<int> b = new List<int>() { a[0] };
static private List<int> a = new List<int>() { 0 }; 
```

将失败。

我建议将所有依赖项放在一个地方，静态构造函数就是这个地方。

```
static MyClass()
{
  a = new List<int>() { 0 };
  b = new List<int>() { a[0] };
} 
```

# python - Python中的MVC模型结构

> ID：185389
> 
> 赞同：3
> 
> 时间：2008-10-08T23:46:30.443
> 
> 标签：python, model-view-controller, model, structure

我在 Python 应用程序的 MVC 模式的模型部分中构建类时遇到问题。无论我如何处理事情，我都会遇到循环导入。这是我所拥有的：

**模型/__init__p.y**

*   应该包含所有模型类名称，以便我可以执行“从模型导入用户”，例如从控制器或单元测试用例

**模型/数据库.py**

*   持有数据库类
*   需要导入所有 Model 类来做 ORM
*   初始化应该在第一个模块导入时执行，即没有额外的初始化调用或实例化（数据库类上的所有方法都是@classmethods）

**模型/用户.py**

*   包含用户模型类
*   需要访问数据库类进行查询
*   应该从所有模型类共有的基类继承以共享功能（数据库持久性方法、参数验证代码等）

我还没有看到使用 MVC 的真实世界 Python 应用程序，所以我的方法可能是非 Pythonic（并且可能是与语言无关的混乱......） - 关于如何解决这个问题的任何建议？

谢谢，西蒙

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-09T02:22:03.623

你的规范有不一致的地方。你说 Database.py 需要导入所有 Model 类来执行 ORM，但是你说 User 类需要访问数据库来执行查询。

将这些视为 API 的层。Database 类为某些物理持久层（例如 DB-API 2.0）提供了一个 API（可能是面向对象的）。模型类，如用户，使用数据库层来加载和保存它们的状态。Database.py 类没有理由导入所有 Model 类，实际上您不希望这样做，因为每次创建新 Model 类时都必须修改 Database.py - 这是一种代码味道.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-08T23:55:10.597

通常，我们将所有内容放在一个文件中。这不是 Java 或 C++。

从单个文件开始，直到您获得更多 Python 经验。除非您的文件非常庞大，否则它将正常工作。

例如，Django 鼓励这种风格，所以复制他们的成功公式。模型的一个模块。每个应用程序的一个模块；每个应用程序导入一个通用模型。

你的数据库和超类的东西可以在你的`__init__.py`文件中，因为它适用于整个包。这可能会减少一些循环性。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T00:28:18.767

我认为你有一个问题需要解决。循环引用通常是由于未能实现关注点分离而导致的。在我看来，数据库和模型模块不应该相互了解太多，而是使用 API。在这种情况下，数据库不应该直接引用任何特定的模型类，而是提供模型类需要运行的功能。反过来，模型应该获得一个数据库引用（注入或请求），它将用于查询和持久化自身。

# asp.net - ASP.NET：从 URL 打开文件

> ID：185391
> 
> 赞同：1
> 
> 时间：2008-10-08T23:47:21.330
> 
> 标签：asp.net, .net, file

在 ASP.NET 中，我有一个想要反序列化的 XML 文件（在我的项目中）。FileStream 对象不允许您通过 URL 打开文件。

打开文件以便我可以反序列化它的最简单方法是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-08T23:55:02.047

如果文件在您的项目中，您只需要获取文件的物理位置。您可以使用 Server.MapPath("/yourfile.txt") 获取物理位置，然后使用文件流打开它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T00:03:21.673

您可以使用[XmlDocument.Load(url)](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.load.aspx)方法，该方法将从 URL 加载 XML 文档

# .net - 客户端使用从 .NET 1.1 升级到 3.5 的 .net Web 服务的问题

> ID：185420
> 
> 赞同：1
> 
> 时间：2008-10-08T23:59:12.570
> 
> 标签：.net, web-services

我正在开发一个最近从 Visual Studio 2003 转换为 Visual Studio 2008 的 Web 应用程序。该应用程序包含一些使用 .NET 1.1 Framework 和 Web Service Enhancements 2.0 编写的 Web 服务。使用 VS 2008 转换向导工具将它们转换为 .NET 3.5 框架。

仍然使用 .NET 1.1 框架编写的客户端应用程序引用了更新的 Web 服务并尝试使用该 Web 服务并收到以下错误：

System.Web.Services.Protocols.SoapException：服务器无法识别 HTTP 标头 SOAPAction 的值：（Web 服务 URI）

引用的 URL 行为设置为静态，并且代理类继承从 System.Web.Services.Protocols.SoapHttpClientProtocol 命名空间更改为 Microsoft.Web.Services2.WebServicesExtension 命名空间

如果您需要更多信息或需要查看一些源代码，请告诉我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T00:25:04.593

如果你用网络浏览器直接去asmx url，然后点击你要调用的方法，他们要的SOAPAction是什么？

接下来，检查 Reference.vb 代码并查看 SoapDocumentMethodAttribute 属性设置为什么。

他们匹配吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T00:17:57.540

Web 服务是否以其他方式工作？您的新更新的 2.0 Web 服务是否可能与 1.1 应用程序存在于同一个应用程序域中？在这种情况下，您需要创建自己的应用程序域。

如果它不是本地的，请尝试使用 Fiddler 查看来回的所有内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-13T19:52:41.040

我假设您正在尝试从 WSE2 (.net 1.1) 客户端调用 WCF (.net 3.5) 服务。

微软表示他们不打算支持 WSE 版本之间的向后兼容性。每个新版本都被视为技术预览，并实施了一组破坏兼容性的新功能。

不过，据说 WCF 与 WSE3 兼容。

所以你有两个选择：

1.  将客户端应用程序移植到 WCF（或至少 WSE3）以使其与服务兼容。
2.  使用与以前基本相同的代码显式使用 WSE2 重新实现服务（即使在 .net 3.5 下也可以工作）。

# javascript - 如何在默认 Web 浏览器中从 HTA 打开链接？

> ID：185423
> 
> 赞同：11
> 
> 时间：2008-10-08T23:59:40.027
> 
> 标签：javascript, browser, hta

我正在开发一个作为 HTA 实现的应用程序。我有一系列链接，我想在系统的默认 Web 浏览器中打开它们。无论默认浏览器如何，使用`<a href="url" target="_blank">`都会在 IE 中打开链接。

有没有办法使用默认浏览器？使用 JavaScript 是一种选择。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-09T01:18:51.317

创建一个 shell 并尝试运行一个 URL。

这适用于我的系统（保存为whatever.hta 并执行它）。单击该按钮可在 Firefox 中打开 Google：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
  <title>HTA Test</title>
  <hta:application applicationname="HTA Test" scroll="yes" singleinstance="yes">
  <script type="text/javascript">
  function openURL()
  {
      var shell = new ActiveXObject("WScript.Shell");
      shell.run("http://www.google.com");
  }
  </script>
</head>
<body>

<input type="button" onclick="openURL()" value="Open Google">

</body>
</html> 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-09T00:52:58.780

不，可悲的是，我相信这是一个特定于浏览器的实现，它将在同一浏览器中打开带有 target="_blank" 的新链接。

如果您想在默认浏览器中打开它，那么您需要与操作系统进行交互，而 JavaScript 无法做到这一点。

# javascript - 如何使用 JSON 创建从对象类型继承的对象？

> ID：185429
> 
> 赞同：13
> 
> 时间：2008-10-09T00:02:10.270
> 
> 标签：javascript, json, inheritance

我知道如何使用 JSON 来创建对象，但似乎没有办法使用 JSON 来创建特定对象类型的对象。

这是一个对象的示例并创建它的一个实例：

```
Person = function() { };
Person.prototype = {
    FirstName: null,
    GetFirstName: function() {
        return this.FirstName;
    }
};

//Create an instance of the Person Object
var me = new Person();
me.FirstName = "Chris";
alert(me.GetFirstName()); //alert the FirstName property 
```

现在，我想使用 JSON 创建一个新的 Person 对象，以便 GetFirstName 函数对其进行处理。

这是我想做的事情（但这段代码不起作用）：

```
var you = new Person() { FirstName: "Mike" };
// OR
var you = new Person{ FirstName: "Mike" }; 
```

反正有没有使用 JSON 来创建一个特定类型的对象？

更新：我的 Person 对象示例只是为了简化问题。事实上，我无法修改需要创建实例的实际对象的构造函数。这些对象是第三方库的一部分。

更新：使用下面的一些建议，我能够找到一种方法来创建一个继承自原始对象的对象，并在其构造函数中接受 JSON。这很整洁！

```
personWrapper = function(obj){
    for(var o in obj){
        this[o] = obj[o];
    }
};
personWrapper.prototype = new Person();

var you = new personWrapper({FirstName: "Chris"});
alert(you.GetFirstName());
alert(you instanceof Person); // returns True - we are successfully inheriting from Person! 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-09T00:06:46.347

我不这么认为。如果我是你，我会在 Person 类上创建一个函数来从 JSON 对象初始化。

```
function Person() {
    this.loadFromJSON = function(json) {
        this.FirstName = json.FirstName;
    };
} 
```

如果您事先不知道 JSON 对象表示的是什么类，则可以在 JSON 中添加一个额外的变量。

```
{ _className : "Person", FirstName : "Mike" } 
```

然后有一个解释它的“构建器”函数。

```
function buildFromJSON(json) {
    var myObj = new json["_className"]();
    myObj.loadFromJSON(json);
    return myObj;
} 
```

* * *

更新：由于您说该类是您无法更改的第三方库的一部分，您可以使用原型扩展该类，或者编写一个仅在外部填充该类的函数。

例如：

```
Person.prototype.loadFromJSON = function(json) {
    // as above...
}; 
```

或者

```
function populateObject(obj, json) {
    for (var i in json) {
        // you might want to put in a check here to test
        // that obj actually has an attribute named i
        obj[i] = json[i];
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-09T00:09:11.037

您可以允许 new Person() 接受一个对象来填充属性作为参数。

```
var you = new Person({ firstName: 'Mike' }); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-09T04:03:51.017

您可以从他们的对象中派生出一个对象。您的构造函数可以接受您想要的对象，但以不受影响的方式调用它们的构造函数：

```
function yourWrapper(obj) {
    theirObject.call(this);
    for (var s in obj) {
        this[s] = obj[s];
    }
}
yourWrapper.prototype = new theirObject(); 
```

或类似的东西 ：）

# html - 为什么 Eclipse 会删除我的文件并将它们放入“本地历史记录”中！

> ID：185442
> 
> 赞同：1
> 
> 时间：2008-10-09T00:08:29.837
> 
> 标签：html, eclipse, templates, flexbuilder

现在有好几次我让 Eclipse 看似随机地为我删除了文件——然后它们出现在“本地历史”选项下。

到底是怎么回事！我绝对不只是错误地删除了一些东西。

最近它删除了我`html-template`非常重要的模板文件！

我有一个 AIR 项目和一个引用`src`AIR 项目内目录的 Web 项目。通常我会在处理另一个项目时关闭一个项目。

仅供参考：目前我的备份解决方案是`Windows Home Server`，如果文件以其他方式而不是历史记录丢失，我必须回家寻找文件。是的，我确实计划纠正这一点！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T15:00:47.600

在本地历史记录下，您可以在修改后找到文件的先前版本。

你不是把这个文件夹设置为编译的输出文件夹吗？然后eclipse可以在构建期间清除文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-12-21T09:23:43.623

我建议尝试使用不同的 IDE，例如 NetBeans，看看文件是否仍在被删除。Eclipse 可能不是问题，因为这些文件即使没有被删除也会在本地历史记录中。

我正在尝试自己解决此类问题，我发现当我查看已使用 GEdit 等其他文本编辑器删除的文件时，它们看起来已损坏。我以前没有注意到日食将它们保留在当地历史中，谢谢。我之前一直在使用 gitHub 进行备份并从中恢复。

如果我发现切换到另一个 IDE 可以修复它，或者任何其他信息，我会更新这篇文章。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T04:35:42.613

我怀疑这是一个外部应用程序正在删除或移动您的文件。Eclipse 的本地历史只是保存文件的副本，以便以后快速恢复。

# erlang - 为什么 MPI 被认为比共享内存更难，而 Erlang 被认为更容易，当它们都是消息传递时？

> ID：185444
> 
> 赞同：33
> 
> 时间：2008-10-09T00:10:25.713
> 
> 标签：erlang, multicore, parallel-processing, mpi

如今，人们对 Erlang 作为一种在多核上编写并行程序的语言很感兴趣。我听说有人争辩说，Erlang 的消息传递模型比主要的共享内存模型（如线程）更容易编程。

相反，在高性能计算社区中，占主导地位的并行编程模型是 MPI，它也实现了消息传递模型。但在 HPC 世界中，这种消息传递模型通常被认为很难编程，人们认为 OpenMP 或 UPC 等共享内存模型更容易编程。

有谁知道为什么在 IT 和 HPC 世界中对消息传递和共享内存的理解存在如此大的差异？是不是因为 Erlang 和 MPI 在实现消息传递方面的一些根本差异，使得 Erlang 风格的消息传递比 MPI 更容易？还是有其他原因？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-11-01T21:13:56.457

我同意所有以前的答案，但我认为一个没有完全清楚的关键点是 MPI 可能被认为很难而 Erlang 容易的一个原因是模型与域的匹配。

Erlang 基于本地内存、异步消息传递和共享状态的概念，通过使用某种形式的所有线程都可以访问的全局数据库来解决。它专为不移动大量数据的应用程序而设计，并且不应该扩展到需要协调的 100k 单独节点。

MPI 基于本地内存和消息传递，旨在解决移动数据是域的关键部分的问题。高性能计算在很大程度上是将数据集用于解决问题，并将其拆分到大量计算资源中。这在消息传递系统中是一项相当艰巨的工作，因为数据必须在考虑平衡的情况下显式分布。从本质上讲，MPI 可以被视为共享内存无法扩展的勉强承认。它的目标是跨 100k 处理器或更多处理器进行高性能计算。

Erlang 并没有试图达到尽可能高的性能，而是将一个自然并行的问题分解成它的自然线程。与 MPI 相比，它的设计考虑了完全不同类型的编程任务。

因此，与 pthread 和其他相当局部的异构线程解决方案相比，Erlang 最好，而不是 MPI，后者真正针对的是非常不同的（并且在某种程度上固有地更难）问题集。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-09T03:20:01.027

Erlang 中的并行*性仍然*很难实现。我的意思是你仍然需要弄清楚如何分解你的问题，但是与 C 或 C++ 中的某些 MPI 库相比，有一些小事情可以缓解这个困难。

首先，由于 Erlang 的消息传递是一流的语言特性，语法糖让它感觉更容易。

此外，Erlang 库都是围绕 Erlang 的消息传递构建的。这种支持结构有助于您进入并行处理领域。看看[OTP 的组件，](http://www.erlang.org/doc/design_principles/part_frame.html)如 gen_server、gen_fsm、gen_event。这些是非常易于使用的结构，可以帮助您的程序变得并行。

我认为更多是可用标准库的稳健性将 erlang 的消息传递与其他 MPI 实现区分开来，而不是语言本身的任何特定功能。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-12-07T15:57:18.887

通常，HPC 中的并发意味着处理大量数据。这种并行性称为[数据并行性](http://en.wikipedia.org/wiki/Data_parallelism)，使用 OpenMP 等共享内存方法确实更容易实现，因为操作系统会处理诸如调度和放置任务之类的事情，如果使用消息传递范式，则必须自己实现.

相比之下，Erlang 旨在应对电话系统中遇到的[任务并行性](http://en.wikipedia.org/wiki/Task_parallelism)，其中必须同时执行不同的代码片段，而通信量有限，并且对容错和恢复有很强的要求。

这个模型类似于大多数人使用 PThreads 的模型。它适合像 Web 服务器这样的应用程序，其中每个请求都可以由不同的线程处理，而 HPC 应用程序对大量数据执行几乎相同的操作，这些数据也必须在工作人员之间交换。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-11-01T20:21:14.253

我认为这与使用 MPI 编程和使用 Erlang 编程时的思维方式有关。例如，MPI 不是语言内置的，而 Erlang 内置了对消息传递的支持。另一个可能的原因是仅发送/接收消息和将解决方案划分为并发执行单元之间的脱节。

使用 Erlang，您被迫在函数式编程框架中思考，其中数据实际上从函数调用到函数调用 - 并且接收是一种主动行为，看起来像该语言中的正常构造。这使您在实际执行的计算与发送/接收消息的行为之间建立了更紧密的联系。

另一方面，使用 MPI，您被迫只考虑实际的消息传递，而不是真正的工作分解。这种思维框架需要在编写解决方案和代码中的消息传递基础架构之间进行一些上下文切换。

讨论可以继续，但普遍的观点是，如果消息传递的结构实际上内置于您正在使用的编程语言和范式中，那么与其他“附加的东西”相比，这通常是表达解决方案的更好方法" 或作为语言的附加组件存在（以库或扩展的形式）。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-12-27T01:13:12.567

> 有谁知道为什么在 IT 和 HPC 世界中对消息传递和共享内存的理解存在如此大的差异？是不是因为 Erlang 和 MPI 在实现消息传递方面的一些根本差异，使得 Erlang 风格的消息传递比 MPI 更容易？还是有其他原因？

原因只是并行性与并发性。Erlang 是为并发编程而生的。HPC 是关于并行编程的。这些是相关但不同的目标。

并发编程由于严重的非确定性控制流而变得非常复杂，并且延迟通常是一个重要目标。Erlang 对不可变数据结构的使用极大地简化了并发编程。

并行编程具有更简单的控制流程，目标都是关于最大总吞吐量而不是延迟。有效的缓存使用在这里更为重要，这使得 Erlang 和不可变数据结构在很大程度上都不合适。在这种情况下，改变共享内存既容易处理，也更好。实际上，缓存一致性为您提供了硬件加速的消息传递。

最后，除了这些技术差异之外，还有一个政治问题。Erlang 的人试图通过假装 Erlang 与多核相关，而实际上并不相关，从而乘风破浪。特别是，他们吹捧了极大的可扩展性，因此也必须考虑绝对性能。Erlang 可以毫不费力地从一个核心的绝对性能差到任意数量的核心的绝对性能差。正如您可以想象的那样，这并没有给 HPC 社区留下深刻印象（但对于许多高度并发的代码来说已经足够了）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-09T00:19:28.097

关于 MPI 与 OpenMP/UPC：MPI 迫使您将问题分成小块并负责移动数据。使用 OpenMP/UPC，“所有数据都在那里”，您只需要取消引用一个指针。MPI的优势是32-512 CPU集群比32-512 CPU单机便宜很多。此外，当您设计算法时，使用 MPI 的费用是前期费用。如果您的系统使用 NUMA（并且所有大型系统都使用），OpenMP/UPC 可以隐藏您将在运行时获得的延迟 - 您的程序将无法扩展，并且需要一段时间才能找出原因。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-06-19T10:39:04.937

这篇文章实际上解释得很好，当我们发送小块数据时，Erlang 是最好的，而 MPI 在更复杂的事情上做得更好。Erlang 模型也很容易理解 :-)

[Erlang 与 MPI - 最终结果和源代码](http://jkndrkn.livejournal.com/205249.html)

# c# - Windows 2003 上托管 c++ dll 的 FileLoadException

> ID：185445
> 
> 赞同：0
> 
> 时间：2008-10-09T00:10:34.810
> 
> 标签：c#, .net, c++

我的公司与 GroupWise 和 Exchange 5.5/2000+ 进行了登录集成。Exchange 5.5/GroupWise 逻辑是使用 wldap32.dll (win32) 完成的，因此登录代码位于托管 c++ 类中。当配置工具（或后端服务）试图在我的 XP 开发盒上加载这个托管 c++ 项目构建的 dll 时，它工作正常。在 QA/Customer Windows 2003 机器上，会引发 FileLoadException。

首先，这曾经工作正常。其次，我已经验证了我的盒子上的相同工作代码在 qa 盒子上失败了。

如何追踪此异常的原因？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-09T01:18:32.707

您最近是否更改了开发环境？特别是您是否安装了服务包或 Visual Studio 的新版本？

您似乎正在链接客户端服务器上不可用的 C++ 运行时。您可以使用 Windows 事件查看器来识别无法加载的 DLL，或者如果这没有显示任何内容，请使用`depends.exe`查看哪些运行时 DLL 是托管代码的依赖项。

微软已经开始使用并行安装来处理“DLL 地狱”，基本上这允许在 Windows 安装上同时安装（并行）多个版本的 DLL，并让应用程序加载正确版本的运行时的 DLL。Visual Studio 的最新版本利用了这项技术，所以我怀疑这是您“突然”不兼容的原因。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-09T00:16:18.730

不是回答我自己的问题，而是支持刚刚使用本段后面的文本更新了错误。我仍然对追踪这种情况的想法感兴趣。

通过在 IMS 上下载并安装适用于 Windows 的 Visual C++ 2008 Redistributable Package 解决：http: [//www.microsoft.com/downloads/details.aspx? FamilyID=a5c84275-3b97-4ab7-a40d-3802b2af5fc2&DisplayLang=en](http://www.microsoft.com/downloads/details.aspx?FamilyID=a5c84275-3b97-4ab7-a40d-3802b2af5fc2&DisplayLang=en)

# c# - 我应该只移动文件还是创建一个移动它的类？

> ID：185447
> 
> 赞同：1
> 
> 时间：2008-10-09T00:11:48.690
> 
> 标签：c#

好的，我得到了这个小程序，它标记了一些音乐文件（如 ID3v2.4 等）。现在我希望用户可以选择移动和/或重命名那些标记的文件，如果他/她愿意的话。

考虑到我试图在这个系统中保持一个相当干净和松散耦合的设计（即使可扩展性在这里并不重要，它只是很有趣），你会调用应用模式`someFileInfoObject.Move(someWhere)`在哪里`someWhere`还是实现一些类是明智的？ - 也许是 MoveFileStrategy、RenameFileStrategy（我知道在某些系统中移动/重命名可以被认为是相同的，但我希望它们单独启用） - 确定目标以及在`Apply(FileInfo file)`调用某个方法时是否应该应用策略.

如果您认为某些策略类可能有用，您对一个好的实现策略有什么建议吗？

如前所述，过度工程在这里并不是一个真正的问题，因为它是一个有趣的项目，主要针对获得一些编程和工程实践。:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-09T00:29:51.650

您可以证明您的文件有几乎无限数量的命令。想想这个类层次结构。

```
Command
    CopyCommand
    RenameCommand
    MoveCommand
    DiffCommand
    CompressCommand 
```

这些并不是真正的策略。它们只是具有简单“执行”方法的普通类。您通过普通的设置器提供选项和参数。然后执行该方法。

这借鉴了 Ant 的可插入任务的设计模式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-09T00:56:08.197

在我的脑海中，以@S.Lott 为基础，让命令本身保持简单和原子，并创建一个命令队列。UI 将命令添加到队列中，程序按顺序执行命令。

此外，您可以保留已执行命令的（备忘录）并提供撤消功能。

# asp.net - 你会认为这是一个单例/单例模式吗？

> ID：185448
> 
> 赞同：3
> 
> 时间：2008-10-09T00:12:02.263
> 
> 标签：asp.net, design-patterns

想象一下，在 Global.asax.cs 文件中，我有一个实例类作为私有字段。让我们这样说：

```
private MyClass _myClass = new MyClass(); 
```

我在 Global 上有一个名为 GetMyClass() 的静态方法，它获取当前的 HttpApplication 并返回该实例。

```
public static MyClass GetMyClass()
{
    return ((Global)HttpContext.Current.ApplicationInstance)._myClass;
} 
```

所以我可以通过调用 Global.GetMyClass() 来获取当前请求 httpapplication 的实例。

请记住，存在不止一个（全局）HttpApplication。每个请求都有一个 HttpApplication 并且它们是池化/共享的，所以从最真实的意义上讲，它不是一个真正的[单例](http://en.wikipedia.org/wiki/Singleton_pattern)。但它确实在一定程度上遵循了这种模式。

因此，正如问题所问的那样，您至少会考虑单例模式吗？

你会说它不应该使用吗？你会阻止它的使用吗？你会说像真正的单身人士一样，这***可能是一种不好的做法。***

您能看到这种类型的使用场景可能出现的任何问题吗？

或者你会说这不是一个真正的单例，所以没关系，而且不是坏习惯。你会推荐它作为一个半准单例，每个请求都需要一个实例吗？如果不是，您会使用/给出什么其他模式/建议？

你有没有用过这样的东西？

我在过去的项目中使用过它，但我不确定这是否是我应该远离的做法。不过，我过去从未遇到过任何问题。

请给我您对此的想法和意见。

我不是在问什么是单例。而且我认为在许多情况下使用不当是一种不好的做法。那是我。然而，这不是我想要讨论的。我正在尝试讨论我给出的这个场景。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-09T00:15:29.777

我不是 .NET 人，所以我不会对此发表评论，除了这部分：

> 你会说它像真正的单身人士一样糟糕吗？

真正的单身人士并不是“坏习惯”。它们被严重过度使用，但那不是一回事。我最近读了一些东西（不记得在哪里，唉），有人指出——“想要或需要”与“可以”。

“我们只需要其中一个”或“我们只需要一个”：不是单例。

“我们只能拥有其中之一”：单身人士

也就是说，如果拥有两个该对象的想法会以可怕而微妙的方式破坏某些东西，是的，使用单例。这比人们想象的要少得多，因此单身人士的激增。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-09T00:17:14.217

不管这是否符合 Singleton 的千篇一律的模式，它仍然会遇到与 Singleton 相同的问题：

*   它是一个静态的、具体的参考，在测试期间不能替代单独的行为或存根/模拟
*   您不能将其子类化并保留此行为，因此很容易规避此示例的单例性质

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-09T00:15:48.823

单例是一个对象，其中，只能有一个。

现在恰好有一个对象不是单例的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-09T02:10:31.947

由于您正在谈论 Web 应用程序，因此您需要非常小心地假设任何具有静态类或这种类型的伪单例，因为正如 David B 所说，它们仅在该线程中共享。如果将 IIS 配置为使用多个工作进程（配置了名称错误的“Web-Garden”模式，但 #worker 进程也可以在 machine.config 中设置），您将遇到麻烦。假设盒子有不止一个处理器，任何试图调整它的性能的人都一定会打开它。

这种事情的一个更好的模式是使用 HttpCache 对象。它本质上已经是线程安全的，但仍然吸引大多数人的是你的对象也需要是线程安全的（因为你可能只会创建实例，然后随着时间的推移读/写它的许多属性）。这是一些骨架代码，可以让您了解我在说什么：

```
public SomeClassType SomeProperty
{
    get
    {
        if (HttpContext.Current.Cache["SomeKey"] == null)
        {
            HttpContext.Current.Cache.Add("SomeKey", new SomeClass(), null,
                              System.Web.Caching.Cache.NoAbsoluteExpiration, TimeSpan.FromDays(1),
                              CacheItemPriority.NotRemovable, null);
        }
        return (SomeClassType) HttpContext.Current.Cache["SomeKey"];
    }
} 
```

现在，如果您认为您可能需要一个 Web 场（多服务器）规模路径，那么上述方法将不起作用，因为应用程序缓存不是跨机器共享的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-09T01:03:13.017

暂时忘记单例。

您有返回应用程序状态的静态方法。你最好小心点。

如果两个线程访问这个共享状态......繁荣。如果您使用网络服务器，您的代码最终将在多线程上下文中运行。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T00:19:34.853

我会说它绝对不是单例。设计模式作为常见编码实践的定义最有用。当你谈论单例时，你谈论的是一个只有一个实例的对象。

正如您自己所指出的，有多个 HttpApplications，因此您的代码不遵循单例的设计并且没有相同的副作用。

例如，可以使用单例来更新货币汇率。如果此人在不知不觉中使用了您的示例，他们将启动七个实例来完成“只有一个对象”应该完成的工作。

# bash - 确保一次只运行一个 shell 脚本实例的快捷方式

> ID：185451
> 
> 赞同：194
> 
> 时间：2008-10-09T00:13:25.910
> 
> 标签：bash, shell, process, lockfile

确保在给定时间只运行一个 shell 脚本实例的快速而简单的方法是什么？

* * *

## 回答 #1

> 赞同：232
> 
> 时间：2008-10-04T08:20:19.143

用于[`flock(1)`](http://linux.die.net/man/1/flock)对文件描述符进行独占范围锁定。这样您甚至可以同步脚本的不同部分。

```
#!/bin/bash

(
  # Wait for lock on /var/lock/.myscript.exclusivelock (fd 200) for 10 seconds
  flock -x -w 10 200 || exit 1

  # Do stuff

) 200>/var/lock/.myscript.exclusivelock 
```

这确保了`(`和之间的代码`)`一次只能由一个进程运行，并且该进程不会等待太长时间才能获得锁。

警告：这个特定的命令是[`util-linux`](http://en.wikipedia.org/wiki/Util-linux). 如果您运行 Linux 以外的操作系统，它可能可用也可能不可用。

* * *

## 回答 #2

> 赞同：166
> 
> 时间：2009-04-08T20:16:28.130

测试“锁定文件”是否存在的简单方法是有缺陷的。

为什么？因为他们不检查文件是否存在并在单个原子操作中创建它。因为这; 有一个竞争条件**将使**您的互斥尝试中断。

相反，您可以使用`mkdir`. `mkdir`如果目录尚不存在，则创建一个目录，如果存在，则设置退出代码。更重要的是，它通过一个原子动作完成所有这些，使其非常适合这种场景。

```
if ! mkdir /tmp/myscript.lock 2>/dev/null; then
    echo "Myscript is already running." >&2
    exit 1
fi 
```

有关所有详细信息，请参阅出色的 BashFAQ：[http ://mywiki.wooledge.org/BashFAQ/045](http://mywiki.wooledge.org/BashFAQ/045)

如果你想处理过时的锁，[fuser(1)](http://linux.die.net/man/1/fuser)就派上用场了。这里唯一的缺点是操作大约需要一秒钟，所以它不是即时的。

这是我曾经写过的一个函数，它使用 fuser 解决了这个问题：

```
#       mutex file
#
# Open a mutual exclusion lock on the file, unless another process already owns one.
#
# If the file is already locked by another process, the operation fails.
# This function defines a lock on a file as having a file descriptor open to the file.
# This function uses FD 9 to open a lock on the file.  To release the lock, close FD 9:
# exec 9>&-
#
mutex() {
    local file=$1 pid pids 

    exec 9>>"$file"
    { pids=$(fuser -f "$file"); } 2>&- 9>&- 
    for pid in $pids; do
        [[ $pid = $$ ]] && continue

        exec 9>&- 
        return 1 # Locked by a pid.
    done 
} 
```

您可以在这样的脚本中使用它：

```
mutex /var/run/myscript.lock || { echo "Already running." >&2; exit 1; } 
```

如果您不关心可移植性（这些解决方案几乎可以在任何 UNIX 机器上运行），Linux 的[fuser(1)](http://linux.die.net/man/1/fuser)提供了一些额外的选项，并且还有[flock(1)](http://linux.die.net/man/1/flock)。

* * *

## 回答 #3

> 赞同：121
> 
> 时间：2008-10-09T00:24:09.850

这是一个使用*锁定文件*并将 PID 回显到其中的实现。*如果在删除pidfile*之前进程被杀死，这可以作为一种保护：

```
LOCKFILE=/tmp/lock.txt
if [ -e ${LOCKFILE} ] && kill -0 `cat ${LOCKFILE}`; then
    echo "already running"
    exit
fi

# make sure the lockfile is removed when we exit and then claim it
trap "rm -f ${LOCKFILE}; exit" INT TERM EXIT
echo $$ > ${LOCKFILE}

# do stuff
sleep 1000

rm -f ${LOCKFILE} 
```

这里的技巧是`kill -0`它不传递任何信号，而只是检查具有给定 PID 的进程是否存在。即使您的进程被杀死（除了），调用也`trap`将确保删除*锁定文件。*`kill -9`

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2008-10-09T00:26:26.320

在flock(2) 系统调用周围有一个包装器，令人难以置信的是，flock(1)。这使得可靠地获得排他锁变得相对容易，而无需担心清理等。[手册页](http://linux.die.net/man/1/flock)上有关于如何在 shell 脚本中使用它的示例。

* * *

## 回答 #5

> 赞同：28
> 
> 时间：2008-11-29T20:46:15.077

为了使锁定可靠，您需要一个原子操作。上述许多提议都不是原子的。建议的 lockfile(1) 实用程序看起来很有希望，正如手册页中提到的那样，它“抗 NFS”。如果您的操作系统不支持 lockfile(1) 并且您的解决方案必须在 NFS 上运行，那么您没有太多选择......

NFSv2 有两个原子操作：

*   符号链接
*   改名

对于 NFSv3，create 调用也是原子的。

在 NFSv2 和 NFSv3 下，目录操作不是原子操作（请参阅 Brent Callaghan 的《NFS Illustrated》一书，ISBN 0-201-32570-5；Brent 是 Sun 的 NFS 资深人士）。

知道了这一点，您可以为文件和目录实现自旋锁（在 shell 中，而不是 PHP 中）：

锁定当前目录：

```
while ! ln -s . lock; do :; done 
```

锁定文件：

```
while ! ln -s ${f} ${f}.lock; do :; done 
```

解锁当前目录（假设正在运行的进程确实获得了锁）：

```
mv lock deleteme && rm deleteme 
```

解锁文件（假设正在运行的进程确实获得了锁）：

```
mv ${f}.lock ${f}.deleteme && rm ${f}.deleteme 
```

删除也不是原子的，因此首先是重命名（这是原子的），然后是删除。

对于 symlink 和 rename 调用，两个文件名必须驻留在同一个文件系统上。我的建议：仅使用简单的文件名（无路径）并将文件和锁定放入同一目录。

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2009-10-13T14:39:25.137

你需要一个原子操作，比如flock，否则最终会失败。

但是如果羊群不可用怎么办。那么有mkdir。这也是一个原子操作。只有一个进程会导致 mkdir 成功，所有其他进程都会失败。

所以代码是：

```
if mkdir /var/lock/.myscript.exclusivelock
then
  # do stuff
  :
  rmdir /var/lock/.myscript.exclusivelock
fi 
```

您需要处理过时的锁，否则在崩溃后您的脚本将永远不会再次运行。

* * *

## 回答 #7

> 赞同：24
> 
> 时间：2011-02-25T01:55:16.937

另一种选择是`noclobber`通过运行来使用 shell 的选项`set -C`。如果文件已经存在，那么`>`将失败。

简单来说：

```
set -C
lockfile="/tmp/locktest.lock"
if echo "$$" > "$lockfile"; then
    echo "Successfully acquired lock"
    # do work
    rm "$lockfile"    # XXX or via trap - see below
else
    echo "Cannot acquire lock - already locked by $(cat "$lockfile")"
fi 
```

这会导致 shell 调用：

```
open(pathname, O_CREAT|O_EXCL) 
```

如果文件已经存在，它会自动创建文件或失败。

* * *

根据对[BashFAQ 045](http://mywiki.wooledge.org/BashFAQ/045)的评论，这可能会失败`ksh88`，但它适用于我的所有外壳：

```
$ strace -e trace=creat,open -f /bin/bash /home/mikel/bin/testopen 2>&1 | grep -F testopen.lock
open("/tmp/testopen.lock", O_WRONLY|O_CREAT|O_EXCL|O_LARGEFILE, 0666) = 3

$ strace -e trace=creat,open -f /bin/zsh /home/mikel/bin/testopen 2>&1 | grep -F testopen.lock
open("/tmp/testopen.lock", O_WRONLY|O_CREAT|O_EXCL|O_NOCTTY|O_LARGEFILE, 0666) = 3

$ strace -e trace=creat,open -f /bin/pdksh /home/mikel/bin/testopen 2>&1 | grep -F testopen.lock
open("/tmp/testopen.lock", O_WRONLY|O_CREAT|O_EXCL|O_TRUNC|O_LARGEFILE, 0666) = 3

$ strace -e trace=creat,open -f /bin/dash /home/mikel/bin/testopen 2>&1 | grep -F testopen.lock
open("/tmp/testopen.lock", O_WRONLY|O_CREAT|O_EXCL|O_LARGEFILE, 0666) = 3 
```

`pdksh`添加标志很有趣`O_TRUNC`，但显然它是多余的：
要么你正在创建一个空文件，要么你什么都不做。

* * *

你如何做`rm`取决于你希望如何处理不干净的出口。

**干净退出时删除**

新的运行会失败，直到导致不干净退出的问题得到解决并且锁定文件被手动删除。

```
# acquire lock
# do work (code here may call exit, etc.)
rm "$lockfile" 
```

**在任何出口处删除**

如果脚本尚未运行，则新运行会成功。

```
trap 'rm "$lockfile"' EXIT 
```

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2016-05-18T14:49:53.050

您可以使用`GNU Parallel`它，因为它在调用时用作互斥锁`sem`。因此，具体而言，您可以使用：

```
sem --id SCRIPTSINGLETON yourScript 
```

如果您也想要超时，请使用：

```
sem --id SCRIPTSINGLETON --semaphoretimeout -10 yourScript 
```

超时<0意味着如果信号量没有在超时内释放，则退出而不运行脚本，超时>0意味着无论如何都运行脚本。

请注意，您应该给它一个名称（使用`--id`），否则它默认为控制终端。

`GNU Parallel`在大多数 Linux/OSX/Unix 平台上安装非常简单——它只是一个 Perl 脚本。

* * *

## 回答 #9

> 赞同：16
> 
> 时间：2011-10-28T21:19:10.140

对于 shell 脚本，我倾向于使用`mkdir`over `flock`，因为它使锁更便携。

无论哪种方式，使用`set -e`是不够的。只有在任何命令失败时才会退出脚本。你的锁仍然会被遗忘。

对于正确的锁清理，你真的应该将你的陷阱设置为这样的伪代码（提升、简化和未经测试，但来自积极使用的脚本）：

```
#=======================================================================
# Predefined Global Variables
#=======================================================================

TMPDIR=/tmp/myapp
[[ ! -d $TMP_DIR ]] \
    && mkdir -p $TMP_DIR \
    && chmod 700 $TMPDIR

LOCK_DIR=$TMP_DIR/lock

#=======================================================================
# Functions
#=======================================================================

function mklock {
    __lockdir="$LOCK_DIR/$(date +%s.%N).$$" # Private Global. Use Epoch.Nano.PID

    # If it can create $LOCK_DIR then no other instance is running
    if $(mkdir $LOCK_DIR)
    then
        mkdir $__lockdir  # create this instance's specific lock in queue
        LOCK_EXISTS=true  # Global
    else
        echo "FATAL: Lock already exists. Another copy is running or manually lock clean up required."
        exit 1001  # Or work out some sleep_while_execution_lock elsewhere
    fi
}

function rmlock {
    [[ ! -d $__lockdir ]] \
        && echo "WARNING: Lock is missing. $__lockdir does not exist" \
        || rmdir $__lockdir
}

#-----------------------------------------------------------------------
# Private Signal Traps Functions {{{2
#
# DANGER: SIGKILL cannot be trapped. So, try not to `kill -9 PID` or 
#         there will be *NO CLEAN UP*. You'll have to manually remove 
#         any locks in place.
#-----------------------------------------------------------------------
function __sig_exit {

    # Place your clean up logic here 

    # Remove the LOCK
    [[ -n $LOCK_EXISTS ]] && rmlock
}

function __sig_int {
    echo "WARNING: SIGINT caught"    
    exit 1002
}

function __sig_quit {
    echo "SIGQUIT caught"
    exit 1003
}

function __sig_term {
    echo "WARNING: SIGTERM caught"    
    exit 1015
}

#=======================================================================
# Main
#=======================================================================

# Set TRAPs
trap __sig_exit EXIT    # SIGEXIT
trap __sig_int INT      # SIGINT
trap __sig_quit QUIT    # SIGQUIT
trap __sig_term TERM    # SIGTERM

mklock

# CODE

exit # No need for cleanup code here being in the __sig_exit trap function 
```

这就是将会发生的事情。所有陷阱都会产生一个退出，因此该功能`__sig_exit`将始终发生（除非 SIGKILL），它会清理您的锁。

注意：我的退出值不低。为什么？各种批处理系统制作或期望数字 0 到 31。将它们设置为其他值，我可以让我的脚本和批处理流对先前的批处理作业或脚本做出相应的反应。

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2013-09-07T06:55:16.330

***真的***很快而且*真的*很脏？脚本顶部的这一行将起作用：

```
[[ $(pgrep -c "`basename \"$0\"`") -gt 1 ]] && exit 
```

当然，只需确保您的脚本名称是唯一的。:)

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2014-08-11T12:56:18.717

这是一种将原子目录锁定与通过 PID 检查陈旧锁定并在陈旧时重新启动相结合的方法。此外，这不依赖于任何 bashisms。

```
#!/bin/dash

SCRIPTNAME=$(basename $0)
LOCKDIR="/var/lock/${SCRIPTNAME}"
PIDFILE="${LOCKDIR}/pid"

if ! mkdir $LOCKDIR 2>/dev/null
then
    # lock failed, but check for stale one by checking if the PID is really existing
    PID=$(cat $PIDFILE)
    if ! kill -0 $PID 2>/dev/null
    then
       echo "Removing stale lock of nonexistent PID ${PID}" >&2
       rm -rf $LOCKDIR
       echo "Restarting myself (${SCRIPTNAME})" >&2
       exec "$0" "$@"
    fi
    echo "$SCRIPTNAME is already running, bailing out" >&2
    exit 1
else
    # lock successfully acquired, save PID
    echo $$ > $PIDFILE
fi

trap "rm -rf ${LOCKDIR}" QUIT INT TERM EXIT

echo hello

sleep 30s

echo bye 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2008-10-09T00:17:00.223

在已知位置创建锁定文件并在脚本启动时检查是否存在？如果有人试图追踪阻止脚本执行的错误实例，将 PID 放入文件中可能会有所帮助。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2013-04-10T08:51:33.143

这个例子在 manflock 中有解释，但它需要一些改进，因为我们应该管理错误和退出代码：

```
 #!/bin/bash
   #set -e this is useful only for very stupid scripts because script fails when anything command exits with status more than 0 !! without possibility for capture exit codes. not all commands exits >0 are failed.

( #start subprocess
  # Wait for lock on /var/lock/.myscript.exclusivelock (fd 200) for 10 seconds
  flock -x -w 10 200
  if [ "$?" != "0" ]; then echo Cannot lock!; exit 1; fi
  echo $$>>/var/lock/.myscript.exclusivelock #for backward lockdir compatibility, notice this command is executed AFTER command bottom  ) 200>/var/lock/.myscript.exclusivelock.
  # Do stuff
  # you can properly manage exit codes with multiple command and process algorithm.
  # I suggest throw this all to external procedure than can properly handle exit X commands

) 200>/var/lock/.myscript.exclusivelock   #exit subprocess

FLOCKEXIT=$?  #save exitcode status
    #do some finish commands

exit $FLOCKEXIT   #return properly exitcode, may be usefull inside external scripts 
```

您可以使用另一种方法，列出我过去使用的流程。但这比上面的方法更复杂。您应该按 ps 列出进程，按名称过滤，附加过滤 grep -v grep 用于删除寄生虫，最后按 grep -c 计算。并与数字比较。它的复杂和不确定

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2017-05-31T23:11:33.853

发布的现有答案要么依赖于 CLI 实用程序`flock`，要么没有正确保护锁定文件。flock 实用程序并非在所有非 Linux 系统（即 FreeBSD）上都可用，并且不能在 NFS 上正常工作。

在我早期的系统管理和系统开发中，有人告诉我创建锁定文件的一种安全且相对便携的方法是使用`mkemp(3)`or创建一个临时文件`mkemp(1)`，将识别信息写入临时文件（即 PID），然后进行硬链接临时文件到锁定文件。如果链接成功，则您已成功获得锁。

在 shell 脚本中使用锁时，我通常将一个`obtain_lock()`函数放在共享配置文件中，然后从脚本中获取它。以下是我的锁定功能的示例：

```
obtain_lock()
{
  LOCK="${1}"
  LOCKDIR="$(dirname "${LOCK}")"
  LOCKFILE="$(basename "${LOCK}")"

  # create temp lock file
  TMPLOCK=$(mktemp -p "${LOCKDIR}" "${LOCKFILE}XXXXXX" 2> /dev/null)
  if test "x${TMPLOCK}" == "x";then
     echo "unable to create temporary file with mktemp" 1>&2
     return 1
  fi
  echo "$$" > "${TMPLOCK}"

  # attempt to obtain lock file
  ln "${TMPLOCK}" "${LOCK}" 2> /dev/null
  if test $? -ne 0;then
     rm -f "${TMPLOCK}"
     echo "unable to obtain lockfile" 1>&2
     if test -f "${LOCK}";then
        echo "current lock information held by: $(cat "${LOCK}")" 1>&2
     fi
     return 2
  fi
  rm -f "${TMPLOCK}"

  return 0;
}; 
```

以下是如何使用锁定功能的示例：

```
#!/bin/sh

. /path/to/locking/profile.sh
PROG_LOCKFILE="/tmp/myprog.lock"

clean_up()
{
  rm -f "${PROG_LOCKFILE}"
}

obtain_lock "${PROG_LOCKFILE}"
if test $? -ne 0;then
   exit 1
fi
trap clean_up SIGHUP SIGINT SIGTERM

# bulk of script

clean_up
exit 0
# end of script 
```

请记住`clean_up`在脚本中的任何退出点调用。

我在 Linux 和 FreeBSD 环境中都使用了上述内容。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-05-23T09:39:06.480

当以 Debian 机器为目标时，我发现该`lockfile-progs`软件包是一个很好的解决方案。`procmail`还附带一个`lockfile`工具。但是，有时我对这些都没有。

这是我的解决方案，它`mkdir`用于原子性和 PID 文件来检测过时的锁。此代码目前在 Cygwin 设置上生产，并且运行良好。

要使用它，只需`exclusive_lock_require`在您需要独占访问某些内容时调用。可选的锁名称参数允许您在不同脚本之间共享锁。如果您需要更复杂的东西，还有两个较低级别的函数 (`exclusive_lock_try`和)。`exclusive_lock_retry`

```
function exclusive_lock_try() # [lockname]
{

    local LOCK_NAME="${1:-`basename $0`}"

    LOCK_DIR="/tmp/.${LOCK_NAME}.lock"
    local LOCK_PID_FILE="${LOCK_DIR}/${LOCK_NAME}.pid"

    if [ -e "$LOCK_DIR" ]
    then
        local LOCK_PID="`cat "$LOCK_PID_FILE" 2> /dev/null`"
        if [ ! -z "$LOCK_PID" ] && kill -0 "$LOCK_PID" 2> /dev/null
        then
            # locked by non-dead process
            echo "\"$LOCK_NAME\" lock currently held by PID $LOCK_PID"
            return 1
        else
            # orphaned lock, take it over
            ( echo $$ > "$LOCK_PID_FILE" ) 2> /dev/null && local LOCK_PID="$$"
        fi
    fi
    if [ "`trap -p EXIT`" != "" ]
    then
        # already have an EXIT trap
        echo "Cannot get lock, already have an EXIT trap"
        return 1
    fi
    if [ "$LOCK_PID" != "$$" ] &&
        ! ( umask 077 && mkdir "$LOCK_DIR" && umask 177 && echo $$ > "$LOCK_PID_FILE" ) 2> /dev/null
    then
        local LOCK_PID="`cat "$LOCK_PID_FILE" 2> /dev/null`"
        # unable to acquire lock, new process got in first
        echo "\"$LOCK_NAME\" lock currently held by PID $LOCK_PID"
        return 1
    fi
    trap "/bin/rm -rf \"$LOCK_DIR\"; exit;" EXIT

    return 0 # got lock

}

function exclusive_lock_retry() # [lockname] [retries] [delay]
{

    local LOCK_NAME="$1"
    local MAX_TRIES="${2:-5}"
    local DELAY="${3:-2}"

    local TRIES=0
    local LOCK_RETVAL

    while [ "$TRIES" -lt "$MAX_TRIES" ]
    do

        if [ "$TRIES" -gt 0 ]
        then
            sleep "$DELAY"
        fi
        local TRIES=$(( $TRIES + 1 ))

        if [ "$TRIES" -lt "$MAX_TRIES" ]
        then
            exclusive_lock_try "$LOCK_NAME" > /dev/null
        else
            exclusive_lock_try "$LOCK_NAME"
        fi
        LOCK_RETVAL="${PIPESTATUS[0]}"

        if [ "$LOCK_RETVAL" -eq 0 ]
        then
            return 0
        fi

    done

    return "$LOCK_RETVAL"

}

function exclusive_lock_require() # [lockname] [retries] [delay]
{
    if ! exclusive_lock_retry "$@"
    then
        exit 1
    fi
} 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2012-05-03T18:16:49.007

如果该线程的其他地方已经描述了羊群的限制对您来说不是问题，那么这应该有效：

```
#!/bin/bash

{
    # exit if we are unable to obtain a lock; this would happen if 
    # the script is already running elsewhere
    # note: -x (exclusive) is the default
    flock -n 100 || exit

    # put commands to run here
    sleep 100
} 100>/tmp/myjob.lock 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2014-08-05T07:31:47.853

在脚本的开头添加这一行

```
[ "${FLOCKER}" != "$0" ] && exec env FLOCKER="$0" flock -en "$0" "$0" "$@" || : 
```

这是来自人群的样板代码。

如果您想要更多日志记录，请使用这个

```
[ "${FLOCKER}" != "$0" ] && { echo "Trying to start build from queue... "; exec bash -c "FLOCKER='$0' flock -E $E_LOCKED -en '$0' '$0' '$@' || if [ \"\$?\" -eq $E_LOCKED ]; then echo 'Locked.'; fi"; } || echo "Lock is free. Completing." 
```

`flock`这使用实用程序设置和检查锁。此代码通过检查 FLOCKER 变量来检测它是否是第一次运行，如果它没有设置为脚本名称，那么它会尝试使用flock 再次递归地启动脚本并初始化 FLOCKER 变量，如果 FLOCKER 设置正确，则在上一次迭代中进行flock成功，可以继续。如果锁很忙，它会失败并显示可配置的退出代码。

它似乎不适用于 Debian 7，但似乎可以使用实验性 util-linux 2.25 软件包再次恢复。它写“flock：...文本文件忙”。可以通过禁用脚本的写入权限来覆盖它。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2008-10-09T13:44:26.243

一些 unix 具有**`lockfile`**与已经提到的非常相似的**`flock`**.

从手册页：

> lockfile 可用于创建一个或多个信号量文件。如果 lock-file 不能创建所有指定的文件（按指定的顺序），它会等待 sleeptime（默认为 8）秒并重试最后一个不成功的文件。您可以指定在返回失败之前要进行的重试次数。如果重试次数为-1（默认值，即-r-1），lockfile 将永远重试。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2013-12-31T19:35:52.993

我使用一种简单的方法来处理陈旧的锁定文件。

请注意，上述一些存储 pid 的解决方案忽略了 pid 可以环绕的事实。所以 - 仅仅检查是否有一个有效的进程与存储的 pid 是不够的，特别是对于长时间运行的脚本。

我使用 noclobber 来确保一次只能打开一个脚本并写入锁定文件。此外，我存储了足够的信息来唯一标识锁定文件中的进程。我定义了一组数据来唯一标识一个进程是 pid,ppid,lstart。

当一个新脚本启动时，如果它无法创建锁定文件，它会验证创建锁定文件的进程是否仍然存在。如果不是，我们假设原始进程死于非正常死亡，并留下一个陈旧的锁文件。然后，新脚本获得锁定文件的所有权，一切都好，世界再一次。

应该在多个平台上使用多个 shell。快速、便携和简单。

```
#!/usr/bin/env sh
# Author: rouble

LOCKFILE=/var/tmp/lockfile #customize this line

trap release INT TERM EXIT

# Creates a lockfile. Sets global variable $ACQUIRED to true on success.
# 
# Returns 0 if it is successfully able to create lockfile.
acquire () {
    set -C #Shell noclobber option. If file exists, > will fail.
    UUID=`ps -eo pid,ppid,lstart $$ | tail -1`
    if (echo "$UUID" > "$LOCKFILE") 2>/dev/null; then
        ACQUIRED="TRUE"
        return 0
    else
        if [ -e $LOCKFILE ]; then 
            # We may be dealing with a stale lock file.
            # Bring out the magnifying glass. 
            CURRENT_UUID_FROM_LOCKFILE=`cat $LOCKFILE`
            CURRENT_PID_FROM_LOCKFILE=`cat $LOCKFILE | cut -f 1 -d " "`
            CURRENT_UUID_FROM_PS=`ps -eo pid,ppid,lstart $CURRENT_PID_FROM_LOCKFILE | tail -1`
            if [ "$CURRENT_UUID_FROM_LOCKFILE" == "$CURRENT_UUID_FROM_PS" ]; then 
                echo "Script already running with following identification: $CURRENT_UUID_FROM_LOCKFILE" >&2
                return 1
            else
                # The process that created this lock file died an ungraceful death. 
                # Take ownership of the lock file.
                echo "The process $CURRENT_UUID_FROM_LOCKFILE is no longer around. Taking ownership of $LOCKFILE"
                release "FORCE"
                if (echo "$UUID" > "$LOCKFILE") 2>/dev/null; then
                    ACQUIRED="TRUE"
                    return 0
                else
                    echo "Cannot write to $LOCKFILE. Error." >&2
                    return 1
                fi
            fi
        else
            echo "Do you have write permissons to $LOCKFILE ?" >&2
            return 1
        fi
    fi
}

# Removes the lock file only if this script created it ($ACQUIRED is set), 
# OR, if we are removing a stale lock file (first parameter is "FORCE") 
release () {
    #Destroy lock file. Take no prisoners.
    if [ "$ACQUIRED" ] || [ "$1" == "FORCE" ]; then
        rm -f $LOCKFILE
    fi
}

# Test code
# int main( int argc, const char* argv[] )
echo "Acquring lock."
acquire
if [ $? -eq 0 ]; then 
    echo "Acquired lock."
    read -p "Press [Enter] key to release lock..."
    release
    echo "Released lock."
else
    echo "Unable to acquire lock."
fi 
```

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2016-10-20T03:59:46.097

我想取消 lockfiles、lockdirs、特殊锁定程序，即使`pidof`在所有 Linux 安装中都找不到它。还希望拥有尽可能简单的代码（或至少尽可能少的行）。最简单`if`的语句，一行：

```
if [[ $(ps axf | awk -v pid=$$ '$1!=pid && $6~/'$(basename $0)'/{print $1}') ]]; then echo "Already running"; exit; fi 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2012-10-15T09:05:18.060

实际上，虽然 bmdhacks 的答案几乎很好，但在第一次检查锁定文件之后和编写它之前，第二个脚本运行的可能性很小。所以他们都将写入锁定文件并且他们都将运行。以下是如何确保它工作：

```
lockfile=/var/lock/myscript.lock

if ( set -o noclobber; echo "$$" > "$lockfile") 2> /dev/null ; then
  trap 'rm -f "$lockfile"; exit $?' INT TERM EXIT
else
  # or you can decide to skip the "else" part if you want
  echo "Another instance is already running!"
fi 
```

如果文件已经存在，该`noclobber`选项将确保重定向命令将失败。所以重定向命令实际上是原子的——你用一个命令编写和检查文件。您不需要在文件末尾删除锁定文件 - 它会被陷阱删除。我希望这对以后会阅读它的人有所帮助。

PS 我没有看到 Mikel 已经正确回答了这个问题，尽管他没有包含 trap 命令以减少在使用 Ctrl-C 停止脚本后留下锁定文件的机会。所以这是完整的解决方案

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2017-11-30T16:31:22.393

一个有羊群（1）但没有子外壳的例子。flock()ed 文件 /tmp/foo 永远不会被删除，但这并不重要，因为它会被flock() 和 un-flock()ed。

```
#!/bin/bash

exec 9<> /tmp/foo
flock -n 9
RET=$?
if [[ $RET -ne 0 ]] ; then
    echo "lock failed, exiting"
    exit
fi

#Now we are inside the "critical section"
echo "inside lock"
sleep 5
exec 9>&- #close fd 9, and release lock

#The part below is outside the critical section (the lock)
echo "lock released"
sleep 5 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2008-10-09T00:20:07.393

PID 和 lockfiles 绝对是最可靠的。当您尝试运行程序时，它可以检查锁定文件，如果它存在，它可以`ps`用来查看进程是否仍在运行。如果不是，则脚本可以启动，将锁定文件中的 PID 更新为自己的。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2011-01-14T08:46:30.480

我发现 bmdhack 的解决方案是最实用的，至少对于我的用例而言。使用flock 和lockfile 依赖于在脚本终止时使用rm 删除lockfile，这不能总是得到保证（例如，kill -9）。

关于 bmdhack 的解决方案，我会改变一件小事：它强调删除锁定文件，但没有说明这对于该信号量的安全工作是不必要的。他对 kill -0 的使用确保了死进程的旧锁文件将被简单地忽略/覆盖。

因此，我的简化解决方案是简单地将以下内容添加到单例的顶部：

```
## Test the lock
LOCKFILE=/tmp/singleton.lock 
if [ -e ${LOCKFILE} ] && kill -0 `cat ${LOCKFILE}`; then
    echo "Script already running. bye!"
    exit 
fi

## Set the lock 
echo $$ > ${LOCKFILE} 
```

当然，这个脚本仍然存在可能同时启动的进程存在竞争风险的缺陷，因为锁测试和设置操作不是一个单一的原子动作。但是 lhunath 提出的使用 mkdir 的解决方案存在一个缺陷，即被终止的脚本可能会留在目录后面，从而阻止其他实例运行。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2015-03-18T13:23:36.563

[semaphoric](https://github.com/timbunce/semaphoric)实用程序使用（`flock`如上所述，例如 presto8）来实现[计数信号量](https://stackoverflow.com/questions/10898022/differnce-between-counting-and-binary-semaphores)。它启用您想要的任何特定数量的并发进程。我们使用它来限制各种队列工作进程的并发级别。

它就像[sem](http://www.gnu.org/software/parallel/sem.html)，但重量*更轻*。（完全披露：我在发现 sem 对我们的需求来说太重并且没有可用的简单计数信号量实用程序之后写了它。）

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2018-04-19T11:42:06.087

已经回答了一百万次，但另一种方式，不需要外部依赖：

```
LOCK_FILE="/var/lock/$(basename "$0").pid"
trap "rm -f ${LOCK_FILE}; exit" INT TERM EXIT
if [[ -f $LOCK_FILE && -d /proc/`cat $LOCK_FILE` ]]; then
   // Process already exists
   exit 1
fi
echo $$ > $LOCK_FILE 
```

每次它将当前 PID ($$) 写入锁定文件并在脚本启动时检查进程是否以最新的 PID 运行。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2019-01-23T06:54:20.550

使用进程的锁更强大，并且还可以处理不优雅的退出。只要进程正在运行，lock_file 就会保持打开状态。一旦进程存在（即使它被杀死），它将被关闭（通过 shell）。我发现这非常有效：

```
lock_file=/tmp/`basename $0`.lock

if fuser $lock_file > /dev/null 2>&1; then
    echo "WARNING: Other instance of $(basename $0) running."
    exit 1
fi
exec 3> $lock_file 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2019-12-26T23:52:20.877

我使用 oneliner @ 脚本的开头：

```
#!/bin/bash

if [[ $(pgrep -afc "$(basename "$0")") -gt "1" ]]; then echo "Another instance of "$0" has already been started!" && exit; fi
.
the_beginning_of_actual_script 
```

很高兴看到内存中存在进程（无论进程的状态如何）；但它对我有用。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-10-04T08:58:29.520

羊群路径是要走的路。想想当脚本突然死掉时会发生什么。在羊群案例中，您只需松开羊群，但这不是问题。另外，请注意一个邪恶的技巧是在脚本本身上采取羊群..但这当然会让您全速前进到权限问题。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2008-10-09T00:19:53.527

又快又脏？

```
#!/bin/sh

if [ -f sometempfile ]
  echo "Already running... will now terminate."
  exit
else
  touch sometempfile
fi

..do what you want here..

rm sometempfile 
```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2014-03-15T17:51:07.410

查看 FLOM（免费锁管理器）[http://sourceforge.net/projects/flom/](http://sourceforge.net/projects/flom/)：您可以使用不需要文件系统中的锁定文件的抽象资源来同步命令和/或脚本。您可以同步在不同系统中运行的命令，而无需像 NFS（网络文件系统）服务器这样的 NAS（网络附加存储）。

使用最简单的用例，序列化“command1”和“command2”可能就像执行一样简单：

```
flom -- command1 
```

和

```
flom -- command2 
```

来自两个不同的 shell 脚本。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2014-05-13T07:56:52.410

结合上面提供的答案，这是一种更优雅，故障安全，快速~~且肮脏的方法。~~

# 用法

1.  包括**sh_lock_functions.sh**
2.  使用**sh_lock_init初始化**
3.  使用**sh_acquire_lock锁定**
4.  **使用sh_check_lock**检查锁
***   使用**sh_remove_lock解锁****

 **# 脚本文件

**sh_lock_functions.sh**

```
#!/bin/bash

function sh_lock_init {
    sh_lock_scriptName=$(basename $0)
    sh_lock_dir="/tmp/${sh_lock_scriptName}.lock" #lock directory
    sh_lock_file="${sh_lock_dir}/lockPid.txt" #lock file
}

function sh_acquire_lock {
    if mkdir $sh_lock_dir 2>/dev/null; then #check for lock
        echo "$sh_lock_scriptName lock acquired successfully.">&2
        touch $sh_lock_file
        echo $$ > $sh_lock_file # set current pid in lockFile
        return 0
    else
        touch $sh_lock_file
        read sh_lock_lastPID < $sh_lock_file
        if [ ! -z "$sh_lock_lastPID" -a -d /proc/$sh_lock_lastPID ]; then # if lastPID is not null and a process with that pid exists
            echo "$sh_lock_scriptName is already running.">&2
            return 1
        else
            echo "$sh_lock_scriptName stopped during execution, reacquiring lock.">&2
            echo $$ > $sh_lock_file # set current pid in lockFile
            return 2
        fi
    fi
    return 0
}

function sh_check_lock {
    [[ ! -f $sh_lock_file ]] && echo "$sh_lock_scriptName lock file removed.">&2 && return 1
    read sh_lock_lastPID < $sh_lock_file
    [[ $sh_lock_lastPID -ne $$ ]] && echo "$sh_lock_scriptName lock file pid has changed.">&2  && return 2
    echo "$sh_lock_scriptName lock still in place.">&2
    return 0
}

function sh_remove_lock {
    rm -r $sh_lock_dir
} 
```

# 使用示例

**sh_lock_usage_example.sh**

```
#!/bin/bash
. /path/to/sh_lock_functions.sh # load sh lock functions

sh_lock_init || exit $?

sh_acquire_lock
lockStatus=$?
[[ $lockStatus -eq 1 ]] && exit $lockStatus
[[ $lockStatus -eq 2 ]] && echo "lock is set, do some resume from crash procedures";

#monitoring example
cnt=0
while sh_check_lock # loop while lock is in place
do
    echo "$sh_scriptName running (pid $$)"
    sleep 1
    let cnt++
    [[ $cnt -gt 5 ]] && break
done

#remove lock when process finished
sh_remove_lock || exit $?

exit 0 
```

# 特征

*   使用文件、目录和进程 ID 的组合来锁定以确保进程尚未运行
*   您可以检测脚本是否在解除锁定之前停止（例如进程终止、关闭、错误等）
*   您可以检查锁定文件，并在锁定丢失时使用它来触发进程关闭
*   详细，输出错误消息以便于调试

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2015-07-29T05:26:13.517

为什么我们不使用类似的东西

```
pgrep -f $cmd || $cmd 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2015-11-30T13:30:01.020

```
if [ 1 -ne $(/bin/fuser "$0" 2>/dev/null | wc -w) ]; then
    exit 1
fi 
```

* * *

## 回答 #35

> 赞同：0
> 
> 时间：2016-03-03T12:23:13.683

我有一个基于文件名的简单解决方案

```
#!/bin/bash

MY_FILENAME=`basename "$BASH_SOURCE"`

MY_PROCESS_COUNT=$(ps a -o pid,cmd | grep $MY_FILENAME | grep -v grep | grep -v $$ | wc -
l)

if [ $MY_PROCESS_COUNT -ne 0  ]; then
  echo found another process
  exit 0
if

# Follows the code to get the job done. 
```

* * *

## 回答 #36

> 赞同：0
> 
> 时间：2016-08-02T10:03:43.307

晚会，使用@Majal 的想法，这是我的脚本，仅启动一个 emacsclient GUI 实例。有了它，我可以设置快捷键打开或跳回同一个emacsclient。我有另一个脚本可以在需要时在终端中调用 emacsclient。这里使用 emacsclient 只是为了展示一个工作示例，可以选择其他的。这种方法对我的小脚本来说既快又好。告诉我哪里脏了:)

```
#!/bin/bash

# if [ $(pgrep -c $(basename $0)) -lt 2 ]; then # this works but requires script name to be unique
if [ $(pidof -x "$0"|wc -w ) -lt 3 ]; then
    echo -e "Starting $(basename $0)"
    emacsclient --alternate-editor="" -c "$@"
else
    echo -e "$0 is running already"
fi 
```

* * *

## 回答 #37

> 赞同：0
> 
> 时间：2018-03-17T15:54:09.400

这一行答案来自与[Ask Ubuntu Q&A](https://askubuntu.com/questions/988032/how-can-i-cause-a-script-to-log-in-a-separate-file-the-number-of-times-it-has-be/1015648#1015648)相关的人：

```
[ "${FLOCKER}" != "$0" ] && exec env FLOCKER="$0" flock -en "$0" "$0" "$@" || :
#     This is useful boilerplate code for shell scripts.  Put it at the top  of
#     the  shell script you want to lock and it'll automatically lock itself on
#     the first run.  If the env var $FLOCKER is not set to  the  shell  script
#     that  is being run, then execute flock and grab an exclusive non-blocking
#     lock (using the script itself as the lock file) before re-execing  itself
#     with  the right arguments.  It also sets the FLOCKER env var to the right
#     value so it doesn't run again. 
```

* * *

## 回答 #38

> 赞同：0
> 
> 时间：2018-05-16T14:31:14.177

我在任何地方都没有发现它，它使用 read，我不知道 read 是否真的是原子的，但到目前为止它对我很有帮助......，它很有趣，因为它只是 bash 内置函数，这是一个进程实现时，您启动 locker 协进程并使用它的 i/o 来管理锁，只需将目标 i/o 从 locker 文件描述符交换到文件系统文件描述符 ( `exec 3<>/file && exec 4</file`)即可在进程间完成相同的操作

```
## gives locks
locker() {
    locked=false
    while read l; do
        case "$l" in
            lock)
                if $locked; then
                    echo false
                else
                    locked=true
                    echo true
                fi
                ;;
            unlock)
                if $locked; then
                    locked=false
                    echo true
                else
                    echo false
                fi
                ;;
            *)
                echo false
                ;;
        esac
    done
}
## locks
lock() {
    local response
    echo lock >&${locker[1]}
    read -ru ${locker[0]} response
    $response && return 0 || return 1
}

## unlocks
unlock() {
    local response
    echo unlock >&${locker[1]}
    read -ru ${locker[0]} response
    $response && return 0 || return 1
} 
```

* * *

## 回答 #39

> 赞同：0
> 
> 时间：2021-12-09T05:22:26.347

我对现有答案有以下问题：

*   一些答案试图清理锁定文件，然后不得不处理由突然崩溃/重启引起的陈旧锁定文件。IMO 是不必要的复杂。让锁定文件保留。
*   一些答案使用脚本文件本身`$0`或`$BASH_SOURCE`用于锁定，通常引用来自`man flock`. 当由于更新或编辑导致下一次运行打开并获得对新脚本文件的锁定而替换脚本时，即使另一个持有已删除文件锁定的实例仍在运行，这也会失败。
*   很少有答案使用固定的文件描述符。这并不理想。我不想依赖这将如何表现，例如打开锁定文件失败但处理不当并尝试锁定从父进程继承的不相关文件描述符。另一个失败案例是为第 3 方二进制文件注入锁定包装器，该二进制文件本身不处理锁定，但固定的文件描述符会干扰文件描述符传递给子进程。
*   我拒绝使用进程查找已经运行的脚本名称的答案。它有几个原因，例如但不限于可靠性/原子性、解析输出以及拥有执行多个相关功能的脚本，其中一些不需要锁定。

这个答案可以：

*   依赖，`flock`因为它让内核提供锁定......提供的锁定文件是原子创建的而不是替换的。
*   假设并依赖存储在本地文件系统上的锁定文件，而不是 NFS。
*   将锁定文件的存在更改为对正在运行的实例没有任何意义。它的作用纯粹是防止两个并发实例创建同名文件并替换另一个副本。锁定文件不会被删除，它会被遗忘并且可以在重新启动后继续存在。锁定是通过`flock`不通过锁定文件存在来指示的。
*   假设 bash shell，如问题所标记。

它不是 oneliner，但没有注释或错误消息，它足够小：

```
#!/bin/bash

LOCKFILE=/var/lock/TODO

set -o noclobber
exec {lockfd}<> "${LOCKFILE}" || exit 1
set +o noclobber # depends on what you need
flock --exclusive --nonblock ${lockfd} || exit 1 
```

但我更喜欢评论和错误信息：

```
#!/bin/bash

# TODO Set a lock file name
LOCKFILE=/var/lock/myprogram.lock

# Set noclobber option to ensure lock file is not REPLACED.
set -o noclobber

# Open lock file for R+W on a new file descriptor
# and assign the new file descriptor to "lockfd" variable.
# This does NOT obtain a lock but ensures the file exists and opens it.
exec {lockfd}<> "${LOCKFILE}" || {
  echo "pid=$$ failed to open LOCKFILE='${LOCKFILE}'" 1>&2
  exit 1
}

# TODO!!!! undo/set the desired noclobber value for the remainder of the script
set +o noclobber

# Lock on the allocated file descriptor or fail
# Adjust flock options e.g. --noblock as needed
flock --exclusive --nonblock ${lockfd} || {
  echo "pid=$$ failed to obtain lock fd='${lockfd}' LOCKFILE='${LOCKFILE}'" 1>&2
  exit 1
}

# DO work here
echo "pid=$$ obtained exclusive lock fd='${lockfd}' LOCKFILE='${LOCKFILE}'"

# Can unlock after critical section and do more work after unlocking
#flock -u ${lockfd};
# if unlocking then might as well close lockfd too
#exec {lockfd}<&- 
```

* * *

## 回答 #40

> 赞同：-1
> 
> 时间：2016-09-22T21:33:55.047

如果您的脚本名称是唯一的，这将起作用：

```
#!/bin/bash
if [ $(pgrep -c $(basename $0)) -gt 1 ]; then 
  echo $(basename $0) is already running
  exit 0
fi 
```

如果脚本名不是唯一的，这适用于大多数 linux 发行版：

```
#!/bin/bash
exec 9>/tmp/my_lock_file
if ! flock -n 9  ; then
   echo "another instance of this script is already running";
   exit 1
fi 
```

*来源： http:* [//mywiki.wooledge.org/BashFAQ/045](http://mywiki.wooledge.org/BashFAQ/045)

* * *

## 回答 #41

> 赞同：-2
> 
> 时间：2014-08-13T13:55:58.587

尝试类似下面的东西，

```
ab=`ps -ef | grep -v grep | grep -wc processname` 
```

然后使用 if 循环将变量与 1 匹配。

# matlab - 在主 m 文件中读取输入 m 文件

> ID：185461
> 
> 赞同：4
> 
> 时间：2008-10-09T00:17:48.460
> 
> 标签：matlab

我希望 MATLAB 告诉我是否有一个输入文件（.m 文件），其中包含一些变量及其编号（即 , `a = 5`, ） `b = 6`，`c = 7`以便我可以在另一个程序中使用该 .m 文件（主 .m 文件）即使用这些变量来计算`S = a + b + c`. 然后如何从主文件中读取输入文件？假设输入文件称为 INP 和主 MAIN。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-09T02:02:45.037

这在 MATLAB 中通常不是很好的做法。在您的示例中，包含输入变量的文件将是一个脚本。和你的主文件一样。正如 ScottieT812 所建议的，当从另一个脚本运行一个脚本时，MATLAB 不会出错，但在某些情况下可能会出现奇怪的错误。（运行时编译有困难，跨脚本变量名冲突）

更好的选择是将输入脚本转换为返回感兴趣变量的函数

```
function [a,b c] = inputs
a = 5;
b = 6;
c = 7; 
```

然后可以在 main.m 脚本中调用这个函数。

```
% main.m
[a,b,c] = inputs;
s = a+b+c; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-09T00:22:18.437

如果您的“输入”文件是 m 文件，只需使用“主”m 文件中的文件名即可。例如，您可能有一个名为 input.m 的文件，如下所示：

```
% File: inputs.m
a = 5;
b = 6;
c = 7; 
```

然后，您可以像这样在文件 main.m 中使用它：

```
% File: main.m
inputs;
S = a + b + c; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-10T17:14:15.497

对于这类东西（以后很容易调整的参数），我几乎总是使用结构：

```
function S = zark
    S.wheels = 24;
    S.mpg = 13.2;
    S.name = 'magic bus';
    S.transfer_fcn = @(x) x+7;
    S.K = [1 2; -2 1]; 
```

然后您可以返回大量数据而无需执行 [a,b,c,d,e,f]=some_function; 之类的操作。

结构的一个好处是您可以动态地处理它们：

```
>> f = 'wheels';
>> S.(f)

ans =

    24 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-10T23:51:49.060

听起来您想要一些脚本使用的全局配置信息。通常，创建函数并将值作为参数传递要好得多，但有时按照您建议的方式做事是有意义的。实现此目的的一种方法是将信息保存在文件中。请参阅 Matlab 文档中的“加载”和“保存”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-21T15:46:53.607

如果数据脚本只是一个脚本，您可以直接从函数或另一个脚本中调用它。不需要额外的命令。例如：

```
%mydata.m
a = 1;
b = 2;

%mymain.m
mydata
whos
mymain 
```

`>>`mymain
名称大小字节类属性

a 1x1 8 双
b 1x1 8 双

这也适用于脚本以外的功能

%foo.m
函数 foo mydata
谁是
`>>`foo

名称大小字节类属性

a 1x1 8 双
b 1x1 8 双

一般来说，最好使用 MAT 或其他数据文件来处理这类事情。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T22:43:03.907

我在尝试为我的工作创建 MATLAB 软件的运行时编译版本时遇到了[KennyMorton](https://stackoverflow.com/questions/185461/reading-input-m-file-in-a-main-m-file#185660)提到的确切问题。该软件广泛使用 m 文件在函数之间传递参数。此外，我们动态创建了这些 m 文件，部署的 MATLAB 版本不能很好地处理这些文件。我们的解决方法是：

*   将参数保存到不带 .m 扩展名的文件中
*   读取和评估文件的内容

因此，按照 OP 示例，在函数中，我们将创建一个包含参数的文本文件 INP。**我们在ctfroot**函数返回的目录中创建这个文件。然后，在 MAIN 中，我们将使用以下内容来检索这些参数：

```
eval(char(textread(fullfile(ctfroot, INP), '%s', 'whitespace', ''); 
```

# iphone - 处理 IB 中横向/纵向差异的最佳方法是什么？

> ID：185463
> 
> 赞同：8
> 
> 时间：2008-10-09T00:19:20.780
> 
> 标签：iphone, cocoa-touch, interface-builder

我有一个支持横向和纵向查看的视图，当您从一个切换到另一个时，控件都会四处移动。我目前正在通过在用户旋转手机时设置每个控件的 .center 来执行此操作。问题是这很乏味，需要大量代码，而且似乎违背了使用 Interface Builder 的初衷。

我的问题是：Interface Builder 中有没有一种方法可以让一个视图支持多种外观（一种用于横向，一种用于纵向）？如果不是，其他人如何使用 IB 做到这一点？您是否设置了 2 个视图？

编辑：只是为了澄清我的横向和纵向视图看起来不同，我不想要直接变换，我实际上在横向模式下以不同方式显示数据

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-30T18:32:57.230

必要时，我将`UIView`对象添加到我隐藏的 IB 视图中。给它一个漂亮的背景颜色，这样你就可以看到它，并将它一直发送到背景。然后在需要设置对象的框架时使用该视图的框架。如果你有很多，你可以考虑使用`UILabel`，这样你就可以在 IB 中给它一个可见的名字。

如果您担心内存问题，只需删除所有这些额外`UIView`的 s`ViewDidLoad`并将它们的帧值存储在 member `CGRect`s 中。这当然只有在您没有任何视图在旋转时自动调整大小或重新定位时才有效，在这种情况下您可能不应该这样做。我这样做是为了出于任何原因调整大小/重新定位，而不仅仅是在屏幕旋转时。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-01T00:56:54.093

在 IB 中，一个视图可以支持多个方向的唯一方法是将组件的自动调整大小掩码设置为缩放和/或锚定到边缘。要为每个方向设计完全不同的布局，您需要分别设计纵向和横向视图（每个在其自己的 XIB 中）并以编程方式在它们之间切换。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-27T04:25:34.953

我不是 100% 确定这是否可能，但是您是否考虑过使用不同的视图控制器来进行横向和纵向？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-25T22:23:01.937

IB 的 Size Inspector（命令 3）中 IBOutlet 对象的 AutoSize 属性为项目的自动拉伸和定位提供了一些非常好的选项。您可以控制 L/R 和 T/B 屏幕位置以及相对宽度和高度。您无法完全控制布局，但大多数基本操作都在那里。

# .net - C# 通过连接字符串检索正确的 DbConnection 对象

> ID：185474
> 
> 赞同：23
> 
> 时间：2008-10-09T00:24:16.030
> 
> 标签：.net, ado.net, connection-string, dbconnection

我有一个连接字符串被传递给一个函数，我需要基于这个字符串创建一个基于 DbConnection 的对象（即 SQLConnection、OracleConnection、OLEDbConnection 等）。

是否有任何内置功能可以做到这一点，或者有任何第三方库可以提供帮助。我们不一定要构建这个连接字符串，所以我们不能依赖写入字符串的格式来确定它的类型，我*宁愿*不必编写可能的连接字符串的所有组合和排列

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-09T01:13:03.357

```
DbConnection GetConnection(string connStr)
{
    string providerName = null;
    var    csb = new DbConnectionStringBuilder { ConnectionString = connStr };

    if (csb.ContainsKey("provider")) 
    {
        providerName = csb["provider"].ToString();
    }          
    else
    {
        var css = ConfigurationManager
            .ConnectionStrings
            .Cast<ConnectionStringSettings>()
            .FirstOrDefault(x => x.ConnectionString == connStr);
        if (css != null) providerName = css.ProviderName;
    }

    if (providerName != null) 
    {
        var providerExists = DbProviderFactories
            .GetFactoryClasses()
            .Rows.Cast<DataRow>()
            .Any(r => r[2].Equals(providerName));
        if (providerExists) 
        {
            var factory = DbProviderFactories.GetFactory(providerName);
            var dbConnection = factory.CreateConnection();

            dbConnection.ConnectionString = connStr;
            return dbConnection;
        }
    }

    return null;
} 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-10-09T00:29:26.470

如果您使用的是框架 2.0 或更高版本，并且可以让它们通过驱动程序类传入第二个字符串，则可以使用 dbProviderFactory 类为您加载驱动程序。

```
DbProviderFactory dbProviderFactory = DbProviderFactories.GetFactory(myDriverClass);
DbConnection dbConnection = dbProviderFactory.CreateConnection();
dbConnection.ConnectionString = myConnectionString; 
```

这是 Factory 类的 MSDN 链接：http: [//msdn.microsoft.com/en-us/library/wda6c36e.aspx](http://msdn.microsoft.com/en-us/library/wda6c36e.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T00:28:22.057

您应该能够解析出 Provider 部分并将其传递给 DbProviderFactories.GetFactory，它将返回 OdbcFactory、OleDbFactory 或 SqlClientFactory，然后让您执行 CreateConnection 等。

我不确定这将如何与 Oracle 一起使用，除非他们提供 OracleDbFactory。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T00:31:00.120

大多数连接字符串（至少在 .NET 2.0 中）也有一个 providerName 属性。所以一个 SQL 连接字符串将有一个提供者名称，如：

```
providerName="System.Data.SqlClient" 
```

因此，您的方法需要同时接受连接字符串和提供者名称，然后您可以使用[damieng 提到的 DbProviderFactory](https://stackoverflow.com/questions/185474/c-retrieving-correct-dbconnection-object-by-connection-string#185481)。

# flash - 确定 swf 是否处于“调试”播放器或模式

> ID：185477
> 
> 赞同：8
> 
> 时间：2008-10-09T00:25:47.930
> 
> 标签：flash, actionscript-3, debugging

有没有办法使用 Flash (CS3+AS3) 来确定发布的 swf 是在调试播放器中运行还是在 Flash 的调试模式下运行？

我知道 Flex 提供了设置不同构建目标（发布/调试）的能力，并且您可以在编译时使用类似样式的代码来包含代码`CONFIG::debug`。`#ifdef`

我在想象类似的东西，`System.isDebug()`但找不到任何东西。我想使用它，因为我的应用程序中有调试功能，我*绝对*不想在生产环境中使用。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-07-07T11:46:37.357

看看这个类[http://blog.another-d-mention.ro/programming/how-to-identify-at-runtime-if-swf-is-in-debug-or-release-mode-build/](http://blog.another-d-mention.ro/programming/how-to-identify-at-runtime-if-swf-is-in-debug-or-release-mode-build/)

此类提供了两条相关（且不同）的信息：

*   SWF 是否使用 -debug 开关构建（已编译调试符号）？
*   Flash 播放器是否是调试播放器（具有显示错误等的能力）？

Capabilities.isDebugger 只回答了第二个问题——运行 Flash 调试播放器的用户。在您的情况下，要在调试构建中对应用程序的部分进行门控，您需要 -debug 构建检查（然后不要将 -debug 构建交付到生产中）。

但是请注意，这两项检查都是运行时检查。在调试代码周围使用条件编译（又名 CONFIG::debug）仍然是一个好主意，因为它将确保可能敏感的调试代码不会在最终 SWF 中交付，从而使其尽可能小且安全。

我在这里复制引用的代码，以防博客链接失效：

```
package org.adm.runtime
{
  import flash.system.Capabilities;

  public class ModeCheck
  {
    /**
     * Returns true if the user is running the app on a Debug Flash Player.
     * Uses the Capabilities class
     **/
    public static function isDebugPlayer() : Boolean
    {
        return Capabilities.isDebugger;
    }

    /**
     * Returns true if the swf is built in debug mode
     **/
    public static function isDebugBuild() : Boolean
    {
        var stackTrace:String = new Error().getStackTrace();
        return (stackTrace && stackTrace.search(/:[0-9]+]$/m) > -1);
    }

    /**
     * Returns true if the swf is built in release mode
     **/
    public static function isReleaseBuild() : Boolean
    {
        return !isDebugBuild();
    }
  }
} 
```

# flash - AIR 缓存框架/库

> ID：185479
> 
> 赞同：1
> 
> 时间：2008-10-09T00:27:46.163
> 
> 标签：flash, actionscript-3, caching, air

任何人都知道一个好的 AIR 内存/磁盘缓存库吗？与 Flash CS3 兼容和免费（如啤酒）的额外积分。

我想缓存http请求的结果：二进制和文本（xml）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T13:13:51.937

[bulk-loader](http://code.google.com/p/bulk-loader/)项目可能有你要找的东西。我自己没有使用过它，但在描述中它说（除其他外）：

*   缓存管理
*   各种资产类型（XML、NetStreams、Swfs、图像、声音、文本文件）

从快速查看代码和 wiki 中的一些示例来看，它看起来具有内存（但不是磁盘）缓存功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-11T17:41:49.870

您可以在此处找到处理内容缓存（文本和二进制）的类：

[http://www.mikechambers.com/blog/2007/03/19/simple-apollo-offline-caching-example/](http://www.mikechambers.com/blog/2007/03/19/simple-apollo-offline-caching-example/)

该链接包括完整代码的链接，以及使用它的示例应用程序。

麦克风

# php - 防止直接访问 PHP 页面

> ID：185483
> 
> 赞同：17
> 
> 时间：2008-10-09T00:29:47.203
> 
> 标签：php, ajax, apache

如何防止我的用户直接访问仅用于 ajax 调用的页面？

在 ajax 调用期间传递密钥似乎是一种解决方案，而没有密钥的访问将不会被处理。但是，制造钥匙也很容易，不是吗？查看源代码的诅咒...

p/s：使用 Apache 作为网络服务器。

编辑：要回答为什么，我的 index.php 中有 jQuery ui-tabs，在这些选项卡中是带有脚本的表单，如果直接访问它们将不起作用。为什么用户会想要这样做，我不知道，我只是想通过防止直接访问没有验证脚本的表单，我会更加用户友好。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-09T00:41:47.757

无法保证他们通过 AJAX 访问它。直接访问和 AJAX 访问都来自客户端，因此很容易被伪造。

你为什么要这样做呢？

如果是因为 PHP 代码不是很安全，那就让 PHP 代码更安全。（例如，如果您的 AJAX 将用户 ID 传递给 PHP 文件，请在 PHP 文件中编写代码以确保该用户 ID 是正确的。）

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-10-09T01:09:30.883

正如其他人所说，可以通过创建正确的标头来模拟 Ajax 请求。如果您想进行基本检查以查看请求是否是 Ajax 请求，您可以使用：

```
 if($_SERVER['HTTP_X_REQUESTED_WITH'] == 'XMLHttpRequest') {
     //Request identified as ajax request
 } 
```

但是，您永远不应该将您的安全性建立在此检查之上。如果您需要，它将消除对页面的直接访问。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-10-09T00:44:29.013

听起来您可能会以错误的方式处理事情。AJAX 调用就像一个标准的页面请求，只是按照惯例，响应不打算显示给用户。

但是，它仍然是客户端请求，因此您必须为客户端能够看到响应感到高兴。以这种方式使用“密钥”混淆访问只会使事情复杂化。

我实际上会说视图源的“诅咒”是通过默默无闻对抗安全的小武器。

那么你想做这件事的原因是什么？

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-09T00:47:01.130

如果浏览器将通过正常请求或 ajax 调用您的页面，那么有人可以手动调用它。就服务器-客户端通信而言，普通请求和 ajax 请求之间确实没有明确的区别。

常见的情况是向服务器传递一个标头，上面写着“这个请求是由 ajax 完成的”。如果您使用 Prototype，它会自动将 http 标头“X-Requested-With”设置为“XMLHttpRequest”以及其他一些标头，包括原型版本。（更多信息请参见[http://www.prototypejs.org/api/ajax/options](http://www.prototypejs.org/api/ajax/options) at "requestHeaders"）

添加：如果您使用另一个 AJAX 库，您可能可以添加自己的标题。这对于了解服务器端的请求类型以及避免在浏览器中请求 ajax 页面的简单情况很有用。它不能保护您的请求不受所有人的影响，因为您不能。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-24T22:38:40.757

COOKIES 不安全...试试 $_SESSION。这几乎是您实际上可以依赖的无法欺骗的跨页面的少数几件事之一。因为，当然，它基本上永远不会离开你的控制。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-02-17T17:26:49.763

谢谢，虽然我用

```
define('IS_AJAX', isset($_SERVER['HTTP_X_REQUESTED_WITH']) && strtolower($_SERVER['HTTP_X_REQUESTED_WITH']) == 'xmlhttprequest');

if(IS_AJAX) {
    //Request identified as ajax request
} 
```

干杯！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-09T00:47:59.210

不确定这一点，但可能会检查引荐来源标头？我认为如果有人手动输入您的 url，它不会有引用标题，而 AJAX 调用有（至少在我刚刚在我的系统上进行的快速测试中）。

但是，这是一种不好的检查方式。由于很多原因，推荐人可能为空白。您是否试图阻止人们将您的网络服务用作公共服务或其他什么？

阅读您的编辑评论后，如果表单将通过 ajax 调用加载，那么您可以检查 window.location 以查看该 url 是否是您的 ajax 表单的 url。如果是，请通过 document.location 转到正确的页面

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-14T23:07:24.123

这对于保护某些东西绝对没有用..但是我认为如果您想说一个生成整个页面的 php 页面（如果 ajax 未请求该页面但只生成您需要返回的部分），这可能会很有用当使用 ajax 时.. 这将允许您使您的网站对 ajax 不友好，所以如果说他们点击一个链接并且它应该加载一个评论框但他们没有 ajax 它仍然会将它们发送到页面然后生成显示评论的整个页面。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-26T08:48:33.497

通过 index.php 传递您的直接请求，通过 ajax.php 传递您的 ajax 请求，然后不要让用户直接浏览到任何其他源文件 - 确保 index.php 和 ajax.php 具有适当的逻辑来包含他们需要的代码.

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-02-03T10:05:17.817

在调用脚本的 javascript 文件中：

```
var url = "http://website.com/ajax.php?say=hello+world";
xmlHttp.open("GET", url, true);
xmlHttp.setRequestHeader('X-Requested-With', 'XMLHttpRequest'); 
```

然后在 php 文件 ajax.php 中：

```
if($_SERVER['HTTP_X_REQUESTED_WITH'] != "XMLHttpRequest") {
    header("Location: http://website.com");
    die();
} 
```

极客仍然可以通过伪造标头来调用 ajax.php 脚本，但我的脚本的其余部分需要会话，因此在未检测到有效会话时执行结束。我需要这个来工作，以便将具有过期混合身份验证会话的人重定向到主站点，以便再次登录，因为他们最终被重定向到 ajax 脚本。

# eclipse - 我应该使用哪个 Eclipse Subversion 插件？

> ID：185486
> 
> 赞同：53
> 
> 时间：2008-10-09T00:30:08.530
> 
> 标签：eclipse, svn, plugins

[Subclipse](http://subclipse.tigris.org/)、[Subversive](http://www.eclipse.org/subversive/)还是[别的什么](http://www.google.com/search?hl=en&safe=off&sa=X&oi=spell&resnum=0&ct=result&cd=1&q=svn+eclipse&spell=1)？

关于这个话题有一些[争论](http://www.google.com/search?source=ig&hl=en&rlz=&q=subclipse+vs+subversive&btnG=Google+Search&meta=)，我们可以在这里得出一些结论吗？

**编辑：** 现在已经有几个月了，我最终决定插件使 Eclipse 的速度变慢了太多，而且每次我从 Eclipse 外部更改文件时使用起来都很麻烦。我放弃了所有插件，只使用了 TortiseSVN。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2008-10-09T02:41:04.507

这取决于。 [Subclipse](http://subclipse.tigris.org/)对将项目签出为 maven 项目具有出色的支持——这是我们使用 Subclipse 的唯一原因。除此之外，我注意到与 SVN 同步的 subclipse 错误。

[Subversive](http://www.eclipse.org/subversive/)在检测新文件以添加到版本控制方面要好得多，并且在合并来自分支的代码甚至与 SVN 同步（更少的错误等）方面也更胜一筹。所以真的，你应该问问自己你想要什么价值。如果你不使用 maven，我肯定会选择 Subversive。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-09T00:37:52.633

我最近从 subclipse 切换到了颠覆性的。在将我们的存储库从 v1.4.x 升级到 1.5 后，我们开始遇到很多关于 subclipse 的问题。

进行同步后，您会看到刚刚接受的更新，如果不进行“hacks”，您将无法获取其他更新

到目前为止，颠覆性还不错。对于很多小文件来说，它甚至比 subclipse 更快。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-09T00:37:29.670

我正在为[Subclipse](http://subclipse.tigris.org/)投票。我个人的运气比[Subversive](http://www.eclipse.org/subversive/)好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-09T00:48:49.567

我个人使用颠覆性的。它具有更好的可用性功能，主要是直观的键盘快捷键等。

不过，我从来没有遇到过问题。这实际上只是个人偏好和使用的结合，如果您使用高级复杂功能，您选择哪个可能很重要，但如果您只是签入、签出和同步，它们都将满足您的需求。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T00:31:55.810

subclipse 功能齐全，我从来没有遇到过问题。

# sql - 根据优先级从不同的表返回值

> ID：185487
> 
> 赞同：1
> 
> 时间：2008-10-09T00:30:30.573
> 
> 标签：sql

假设我有三个表： TableA (key, value) TableB (key, value) TableC (key, value)

我想为所有键返回一个值。如果键存在于 TableC 中，则返回该值，否则，如果键存在于 B 中，则返回该值，否则返回表 A 中的值

到目前为止我想出的最好的是

```
SELECT key,Value
FROM TableA
WHERE key NOT IN (SELECT key FROM TableB)
    AND key NOT IN (SELECT key FROM TableC)
UNION
SELECT key,Value
FROM TableB
WHERE key NOT IN (SELECT key FROM TableC)
UNION
SELECT key,Value
FROM TableC 
```

但这似乎很暴力。有人知道更好的方法吗？

编辑：这是一个更具体的例子。将 TableA 视为标准工作计划，其中键是日期，值是分配的班次。表 B 是覆盖标准工作周的法定假日日历。表 C 是一个例外时间表，用于在有人被要求加入额外班次或不同班次时覆盖其他两个时间表。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-09T03:00:57.570

好的，以您的具体示例为基础，我想出了一个与其他发布的解决方案不同的解决方案（尽管我认为我更喜欢您的解决方案）。这是在 MS SQL Server 2005 上测试的 - 您的 SQL 方言可能需要更改。

首先，一些 DDL 搭台：

```
CREATE TABLE [dbo].[StandardSchedule](
    [scheduledate] [datetime] NOT NULL,
    [shift] [varchar](25) NOT NULL,
 CONSTRAINT [PK_StandardSchedule] PRIMARY KEY CLUSTERED 
( [scheduledate] ASC ));

CREATE TABLE [dbo].[HolidaySchedule](
    [holidaydate] [datetime] NOT NULL,
    [shift] [varchar](25) NOT NULL,
 CONSTRAINT [PK_HolidaySchedule] PRIMARY KEY CLUSTERED 
( [holidaydate] ASC ));

CREATE TABLE [dbo].[ExceptionSchedule](
    [exceptiondate] [datetime] NOT NULL,
    [shift] [varchar](25) NOT NULL,
 CONSTRAINT [PK_ExceptionDate] PRIMARY KEY CLUSTERED 
( [exceptiondate] ASC ));

INSERT INTO ExceptionSchedule VALUES ('2008.01.06', 'ExceptionShift1');
INSERT INTO ExceptionSchedule VALUES ('2008.01.08', 'ExceptionShift2');
INSERT INTO ExceptionSchedule VALUES ('2008.01.10', 'ExceptionShift3');
INSERT INTO HolidaySchedule VALUES ('2008.01.01', 'HolidayShift1');
INSERT INTO HolidaySchedule VALUES ('2008.01.06', 'HolidayShift2');
INSERT INTO HolidaySchedule VALUES ('2008.01.09', 'HolidayShift3');
INSERT INTO StandardSchedule VALUES ('2008.01.01', 'RegularShift1');
INSERT INTO StandardSchedule VALUES ('2008.01.02', 'RegularShift2');
INSERT INTO StandardSchedule VALUES ('2008.01.03', 'RegularShift3');
INSERT INTO StandardSchedule VALUES ('2008.01.04', 'RegularShift4');
INSERT INTO StandardSchedule VALUES ('2008.01.05', 'RegularShift5');
INSERT INTO StandardSchedule VALUES ('2008.01.07', 'RegularShift6');
INSERT INTO StandardSchedule VALUES ('2008.01.09', 'RegularShift7');
INSERT INTO StandardSchedule VALUES ('2008.01.10', 'RegularShift8'); 
```

使用这些表/行作为基础，此 SELECT 语句检索所需的数据：

```
SELECT DISTINCT
    COALESCE(e2.exceptiondate, e.exceptiondate, holidaydate, scheduledate) AS ShiftDate,
    COALESCE(e2.shift, e.shift, h.shift, s.shift) AS Shift
FROM standardschedule s
FULL OUTER JOIN holidayschedule h ON s.scheduledate = h.holidaydate
FULL OUTER JOIN exceptionschedule e ON h.holidaydate = e.exceptiondate
FULL OUTER JOIN exceptionschedule e2 ON s.scheduledate = e2.exceptiondate
ORDER BY shiftdate 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-09T01:07:01.357

这是另一个 SQL 语句：-

```
SELECT
    ALL_KEYS.KEY,
    NVL( TABLEC.VALUE, NVL( TABLEB.VALUE, TABLEA.VALUE)) AS VALUE
FROM
    (SELECT KEY AS KEY FROM TABLEA
     UNION
     SELECT KEY FROM TABLEB
     UNION
     SELECT KEY FROM TABLEC) ALL_KEYS,
     TABLEA,
     TABLEB,
     TABLEC
WHERE
    ALL_KEYS.KEY = TABLEA.KEY(+) AND
    ALL_KEYS.KEY = TABLEB.KEY(+) AND
    ALL_KEYS.KEY = TABLEC.KEY(+); 
```

注意。NVL() 是一个 Oracle 函数。如果第一个参数为NULL，则返回第二个参数，否则返回第一个参数。您没有说您使用的是哪个数据库，但毫无疑问，一切都有等价物。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-09T00:41:09.567

如果您有许多要从中获取数据的表，那么您将不得不从它们中进行选择，没有其他方法可以解决它。

从您的 SQL 中，您似乎可以从包含 tableA 和 tableB 中的键的 tableC 中获得结果，因为您正在对 tableC 上的简单选择的结果进行联合处理（其中没有 where 子句）。在任何其他表中都不存在的一组专有键之后，您在哪里？如果是这样，那么您将需要在 tableB 和 tableC 的选择中为 tableA 的 where 子句执行您所做的操作。

我希望这是有道理的...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-09T00:42:54.790

您的查询看起来不错。

或者，您可以使用下面的查询并在客户端进行过滤。数据库服务器的压力会更小。

```
SELECT key, value, 2 AS priority
FROM TableA
UNION
SELECT key, value, 1 AS priority
FROM TableB
UNION
SELECT key, value, 0 AS priority
FROM TableC
ORDER BY key, priority 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-09T00:52:35.677

下面是我在 SQL Server 中的做法。此解决方案应生成比原始解决方案更少的逻辑 IO。如果表足够大，我会切换到#temp 表以启用并行性。

```
DECLARE @MyTable TABLE
(
  Key int PRIMARY KEY,
  Value int
)

    --Grab from TableC
INSERT INTO @MyTable(Key, Value)
SELECT Key, Value
FROM TableC

    --Grab from TableB
INSERT INTO @MyTable(Key, Value)
SELECT Key, Value
FROM TableB
WHERE Key not in (SELECT Key FROM @MyTable)

    --Grab from TableA  
INSERT INTO @MyTable(Key, Value)
SELECT Key, Value
FROM TableA
WHERE Key not in (SELECT Key FROM @MyTable)
    --Pop the result
SELECT Key, Value
FROM @MyTable 
```

这种技术反映了我将如何处理 C# 中的 3 个列表...通过创建字典。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-09T11:27:07.970

```
SELECT isnull( c.key, isnull( b.key, a.key) ) , 
       isnull( c.value, isnull( b.value, a.value ) ) 
FROM   TableA a 
LEFT JOIN TableB b 
ON        a.key = b.key
LEFT JOIN TableC c 
ON        b.key = c.key 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-09T11:29:08.013

创建所有键的主表，然后将此主表左连接到三个表并调查`COALESCE`命令。

# javascript - 如何在 JavaScript 中连接正则表达式文字？

> ID：185510
> 
> 赞同：169
> 
> 时间：2008-10-09T00:43:12.760
> 
> 标签：javascript, regex, syntax

有可能做这样的事情吗？

```
var pattern = /some regex segment/ + /* comment here */
    /another segment/; 
```

还是我必须使用新`RegExp()`语法并连接字符串？我更喜欢使用文字，因为代码既不言而喻又简洁。

* * *

## 回答 #1

> 赞同：210
> 
> 时间：2008-10-09T00:54:14.067

以下是如何在不使用正则表达式文字语法的情况下创建正则表达式。这使您可以在字符串变为正则表达式对象之前进行任意字符串操作：

```
var segment_part = "some bit of the regexp";
var pattern = new RegExp("some regex segment" + /*comment here */
              segment_part + /* that was defined just now */
              "another segment"); 
```

如果您有两个正则表达式文字，您实际上可以使用以下技术将它们连接起来：

```
var regex1 = /foo/g;
var regex2 = /bar/y;
var flags = (regex1.flags + regex2.flags).split("").sort().join("").replace(/(.)(?=.*\1)/g, "");
var regex3 = new RegExp(expression_one.source + expression_two.source, flags);
// regex3 is now /foobar/gy 
```

它比仅仅让表达式 1 和 2 成为文字字符串而不是文字正则表达式更冗长。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2014-03-20T19:39:40.213

只是随机连接正则表达式**对象**可能会产生一些不利的副作用。请改用[RegExp.source](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/source)：

```
var r1 = /abc/g;
var r2 = /def/;
var r3 = new RegExp(r1.source + r2.source, 
                   (r1.global ? 'g' : '') 
                   + (r1.ignoreCase ? 'i' : '') + 
                   (r1.multiline ? 'm' : ''));
console.log(r3);
var m = 'test that abcdef and abcdef has a match?'.match(r3);
console.log(m);
// m should contain 2 matches
```

这也将使您能够使用标准 RegExp 标志保留以前 RegExp 中的正则表达式标志。

[jsFiddle](http://jsfiddle.net/LZf7H/514/)

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2010-01-14T16:17:32.017

我不太同意“评估”选项。

```
var xxx = /abcd/;
var yyy = /efgh/;
var zzz = new RegExp(eval(xxx)+eval(yyy)); 
```

将给出“//abcd//efgh//”，这不是预期的结果。

使用类似的源

```
var zzz = new RegExp(xxx.source+yyy.source); 
```

将给出“/abcdefgh/”，这是正确的。

逻辑上不需要评估，你知道你的表达。您只需要它的 SOURCE 或它的编写方式，而不是它的值。至于标志，你只需要使用正则表达式的可选参数。

在我的情况下，我确实遇到了 ^ 和 $ 被用于我试图连接在一起的几个表达式的问题！这些表达式是整个程序中使用的语法过滤器。现在我不想用它们中的一些来处理介词的情况。我可能必须“切片”源以删除开始和结束 ^( 和/或 )$ :) 干杯，亚历克斯。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2014-11-28T15:01:53.597

**问题**如果正则表达式包含像 \1 这样的反向匹配组。

```
var r = /(a|b)\1/  // Matches aa, bb but nothing else.
var p = /(c|d)\1/   // Matches cc, dd but nothing else. 
```

那么仅仅污染源是行不通的。事实上，两者的结合是：

```
var rp = /(a|b)\1(c|d)\1/
rp.test("aadd") // Returns false 
```

**解决方案：** 首先我们计算第一个正则表达式中匹配组的数量，然后对于第二个中的每个反向匹配标记，我们将其增加匹配组的数量。

```
function concatenate(r1, r2) {
  var count = function(r, str) {
    return str.match(r).length;
  }
  var numberGroups = /([^\\]|^)(?=\((?!\?:))/g; // Home-made regexp to count groups.
  var offset = count(numberGroups, r1.source);    
  var escapedMatch = /[\\](?:(\d+)|.)/g;        // Home-made regexp for escaped literals, greedy on numbers.
  var r2newSource = r2.source.replace(escapedMatch, function(match, number) { return number?"\\"+(number-0+offset):match; });
  return new RegExp(r1.source+r2newSource,
      (r1.global ? 'g' : '') 
      + (r1.ignoreCase ? 'i' : '')
      + (r1.multiline ? 'm' : ''));
} 
```

测试：

```
var rp = concatenate(r, p) // returns  /(a|b)\1(c|d)\2/
rp.test("aadd") // Returns true 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2017-01-26T09:49:50.247

提供了：

*   你知道你在你的正则表达式中做了什么；
*   你有许多正则表达式片段来形成一个模式，它们将使用相同的标志；
*   你发现将你的小模式块分成一个数组更具可读性；
*   您还希望能够在以后为下一个开发人员或您自己评论每个部分；
*   您更喜欢在视觉上简化您的正则表达式，`/this/g`而不是`new RegExp('this', 'g')`;
*   您可以在一个额外的步骤中组装正则表达式，而不是从一开始就将其组装成一个整体；

那么你可能想这样写：

```
var regexParts =
    [
        /\b(\d+|null)\b/,// Some comments.
        /\b(true|false)\b/,
        /\b(new|getElementsBy(?:Tag|Class|)Name|arguments|getElementById|if|else|do|null|return|case|default|function|typeof|undefined|instanceof|this|document|window|while|for|switch|in|break|continue|length|var|(?:clear|set)(?:Timeout|Interval))(?=\W)/,
        /(\$|jQuery)/,
        /many more patterns/
    ],
    regexString  = regexParts.map(function(x){return x.source}).join('|'),
    regexPattern = new RegExp(regexString, 'g'); 
```

然后，您可以执行以下操作：

```
string.replace(regexPattern, function()
{
    var m = arguments,
        Class = '';

    switch(true)
    {
        // Numbers and 'null'.
        case (Boolean)(m[1]):
            m = m[1];
            Class = 'number';
            break;

        // True or False.
        case (Boolean)(m[2]):
            m = m[2];
            Class = 'bool';
            break;

        // True or False.
        case (Boolean)(m[3]):
            m = m[3];
            Class = 'keyword';
            break;

        // $ or 'jQuery'.
        case (Boolean)(m[4]):
            m = m[4];
            Class = 'dollar';
            break;

        // More cases...
    }

    return '<span class="' + Class + '">' + m + '</span>';
}) 
```

在我的特殊情况下（类似代码镜像的编辑器），执行一个大的正则表达式要容易得多，而不是像以下那样进行大量替换，因为每次我用 html 标签替换来包装表达式时，下一个模式将在不影响 html 标记本身的情况下更难定位（并且没有不幸的是 javascript 不支持的良好*后*视）：

```
.replace(/(\b\d+|null\b)/g, '<span class="number">$1</span>')
.replace(/(\btrue|false\b)/g, '<span class="bool">$1</span>')
.replace(/\b(new|getElementsBy(?:Tag|Class|)Name|arguments|getElementById|if|else|do|null|return|case|default|function|typeof|undefined|instanceof|this|document|window|while|for|switch|in|break|continue|var|(?:clear|set)(?:Timeout|Interval))(?=\W)/g, '<span class="keyword">$1</span>')
.replace(/\$/g, '<span class="dollar">$</span>')
.replace(/([\[\](){}.:;,+\-?=])/g, '<span class="ponctuation">$1</span>') 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-07-25T01:52:52.677

最好尽可能多地使用文字语法。它更短、更易读，并且您不需要转义引号或双重转义反冲。来自“Javascript 模式”，Stoyan Stefanov 2010。

但是使用 New 可能是连接的唯一方法。

我会避免评估。它不安全。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-09-17T19:23:53.470

您可以从文字和 RegExp 类连接正则表达式源：

```
var xxx = new RegExp(/abcd/);
var zzz = new RegExp(xxx.source + /efgh/.source); 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-03-24T23:38:51.697

您可以执行以下操作：

```
function concatRegex(...segments) {
  return new RegExp(segments.join(''));
} 
```

这些段将是作为单独参数传入的字符串（而不是正则表达式文字）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-09T01:00:18.000

不，不支持文字方式。您必须使用正则表达式。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-04-22T21:08:33.397

使用带有 2 个参数的构造函数并避免尾随 '/' 的问题：

```
var re_final = new RegExp("\\" + ".", "g");    // constructor can have 2 params!
console.log("...finally".replace(re_final, "!") + "\n" + re_final + 
    " works as expected...");                  // !!!finally works as expected

                         // meanwhile

re_final = new RegExp("\\" + "." + "g");              // appends final '/'
console.log("... finally".replace(re_final, "!"));    // ...finally
console.log(re_final, "does not work!");              // does not work 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-11-06T14:36:12.657

对我来说更简单的方法是连接来源，例如：

```
a = /\d+/
b = /\w+/
c = new RegExp(a.source + b.source) 
```

c 值将导致：

> /\d+\w+/

* * *

## 回答 #12

> 赞同：-3
> 
> 时间：2009-04-15T15:12:18.587

我更喜欢使用，因为它`eval('your expression')`不会`/`在每一端添加。`/``='new RegExp'`

# sql - SQL中将月份数字转换为月份名称函数

> ID：185520
> 
> 赞同：228
> 
> 时间：2008-10-09T00:50:54.900
> 
> 标签：sql, sql-server, tsql, sql-server-2005

我在 SQL Server 中以 1、2、3、4、...12 的形式存储了几个月。我想将它们显示为一月、二月等。SQL Server 中是否有像 MonthName(1) = 一月这样的函数？如果可能的话，我试图避免使用 CASE 语句。

* * *

## 回答 #1

> 赞同：310
> 
> 时间：2008-10-09T17:48:40.740

我认为这是获得**月份****名称**的最佳方式

 **```
Select DateName( month , DateAdd( month , @MonthNumber , 0 ) - 1 ) 
```

或者

```
Select DateName( month , DateAdd( month , @MonthNumber , -1 ) ) 
```

* * *

## 回答 #2

> 赞同：169
> 
> 时间：2008-10-09T01:03:33.283

有点hacky但应该可以工作：

```
SELECT DATENAME(month, DATEADD(month, @mydate-1, CAST('2008-01-01' AS datetime))) 
```

* * *

## 回答 #3

> 赞同：107
> 
> 时间：2010-06-29T06:36:49.027

```
SELECT DATENAME(month, GETDATE()) AS 'Month Name' 
```

* * *

## 回答 #4

> 赞同：83
> 
> 时间：2011-11-21T20:58:20.927

```
SUBSTRING('JAN FEB MAR APR MAY JUN JUL AUG SEP OCT NOV DEC ', (@intMonth * 4) - 3, 3) 
```

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2013-08-13T09:36:16.797

**使用最佳方式**

```
Select DateName( month , DateAdd( month , @MonthNumber , -1 )) 
```

* * *

## 回答 #6

> 赞同：22
> 
> 时间：2017-01-26T14:40:30.833

这很简单。

```
select DATENAME(month, getdate()) 
```

输出：一月

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2018-03-23T16:48:41.430

从 SQL Server 2012 开始，您可以使用**[FORMAT](https://docs.microsoft.com/en-us/sql/t-sql/functions/format-transact-sql)**和**[DATEFROMPARTS](https://docs.microsoft.com/en-us/sql/t-sql/functions/datefromparts-transact-sql)**来解决此问题。（如果您想要其他文化的月份名称，请更改`en-US`：）

```
select FORMAT(DATEFROMPARTS(1900, @month_num, 1), 'MMMM', 'en-US') 
```

如果你想要一个三个字母的月份：

```
select FORMAT(DATEFROMPARTS(1900, @month_num, 1), 'MMM', 'en-US') 
```

如果你真的想，你可以为此创建一个函数：

```
CREATE FUNCTION fn_month_num_to_name
(
    @month_num tinyint
)
RETURNS varchar(20)
AS
BEGIN
    RETURN FORMAT(DATEFROMPARTS(1900, @month_num, 1), 'MMMM', 'en-US')
END 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2009-03-09T12:27:56.793

您可以使用内置`CONVERT`功能

```
select CONVERT(varchar(3), Date, 100)  as Month from MyTable. 
```

这将显示月份的前 3 个字符（JAN、FEB 等）

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2011-07-15T19:31:21.500

除了原创

`SELECT DATENAME(m, str(2) + '/1/2011')`

你可以这样做

`SELECT DATENAME(m, str([column_name]) + '/1/2011')`

这样您就可以获得表中所有行的名称。其中 [column_name] 表示包含数值 1 到 12 的整数列

2 代表任何整数，通过联系字符串我创建了一个可以提取月份的日期。'/1/2011' 可以是任何日期

如果你想用变量做到这一点

```
DECLARE @integer int;

SET @integer = 6;

SELECT DATENAME(m, str(@integer) + '/1/2011') 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2013-02-26T12:17:14.413

以下对我有用：

```
CAST(GETDATE() AS CHAR(3)) 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-10-09T01:15:31.323

在希伯来语等某些语言环境中，[闰月](http://en.wikipedia.org/wiki/Hebrew_calendar#Leap_months)取决于年份，因此为避免此类语言环境中的错误，您可以考虑以下解决方案：

```
SELECT DATENAME(month, STR(YEAR(GETDATE()), 4) + REPLACE(STR(@month, 2), ' ', '0') + '01') 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2015-02-23T10:09:32.430

**使用此语句将月份数值转换为月份名称。**

```
SELECT CONVERT(CHAR(3), DATENAME(MONTH, GETDATE())) 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2010-11-09T00:36:52.047

您可以使用如下的转换功能

```
CONVERT(VARCHAR(3), DATENAME(MM, GETDATE()), 100) 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2014-07-05T09:55:49.603

当然这会奏效

```
select datename(M,GETDATE()) 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2015-09-29T21:41:26.033

只需从今天的日期中减去当前月份，然后加回您的月份数。然后使用 datename 函数在 1 行中给出全名。

```
print datename(month,dateadd(month,-month(getdate()) + 9,getdate())) 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2012-10-04T09:25:17.583

我认为这足以在您有日期时获得月份名称。

```
SELECT DATENAME(month ,GETDATE()) 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2016-04-28T20:47:48.880

```
SELECT DateName(M, DateAdd(M, @MONTHNUMBER, -1)) 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2017-03-06T12:46:33.723

要将月份编号转换为月份名称，请尝试以下操作

```
declare @month smallint = 1
select DateName(mm,DATEADD(mm,@month - 1,0)) 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2013-05-09T13:45:10.950

```
SELECT DATENAME(MONTH,dateadd(month, -3,getdate())) 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2013-12-14T05:11:01.280

```
select monthname(curdate()); 
```

或者

```
select monthname('2013-12-12'); 
```

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2013-12-14T13:34:01.993

为我工作

```
SELECT MONTHNAME(<fieldname>) AS "Month Name" FROM <tablename> WHERE <condition> 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2011-08-05T22:10:54.047

这个对我有用：

```
@MetricMonthNumber (some number)

SELECT 
(DateName( month , DateAdd( month , @MetricMonthNumber - 1 , '1900-01-01' ) )) AS MetricMonthName
FROM TableName 
```

来自@leoinfo 和@Valentino Vranken 的上述帖子。只是做了一个快速的选择，它的工作原理。

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2012-07-20T07:05:05.890

```
Declare @MonthNumber int
SET @MonthNumber=DatePart(Month,GETDATE())
Select DateName( month , DateAdd( month , @MonthNumber , 0 ) - 1 ) 
```

解释：

1.  第一个 Decalre 变量`MonthNumber`
2.  获取`DatePart`返回月份编号的当前月份
3.  第三次查询返回月份名称

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2017-09-22T06:04:04.350

你可以得到这样的日期。例如：-**用户**表

```
id name created_at
1  abc  2017-09-16
2  xyz  2017-06-10 
```

你可以像这样得到月份名称

```
select year(created_at), monthname(created_at) from users; 
```

输出

```
+-----------+-------------------------------+
| year(created_at) | monthname(created_at)  |
+-----------+-------------------------------+
|      2017        | september              |
|      2017        | june                   | 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2015-06-04T05:55:02.477

使用此语句获取月份名称：

```
DECLARE @date datetime
SET @date='2015/1/4 00:00:00'

SELECT CAST(DATENAME(month,@date )  AS CHAR(3))AS 'Month Name' 
```

这将为您提供简短的月份名称。像这样：一月，二月，三月等。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2015-06-24T15:58:21.090

这是我使用其他人的一些信息来解决问题的解决方案。

```
datename(month,dateadd(month,datepart(month,Help_HelpMain.Ticket_Closed_Date),-1)) as monthname 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2016-12-16T21:58:44.033

SQL Server 中没有系统定义的函数。但是您可以创建自己的用户定义函数 - 标量函数。您可以在对象资源管理器中为您的数据库找到标量函数：Programmability->Functions->Scalar-valued Functions。下面，我使用一个表变量将它们组合在一起。

```
--Create the user-defined function
CREATE FUNCTION getmonth (@num int)
RETURNS varchar(9) --since 'September' is the longest string, length 9
AS
BEGIN

DECLARE @intMonth Table (num int PRIMARY KEY IDENTITY(1,1), month varchar(9))

INSERT INTO @intMonth VALUES ('January'), ('February'), ('March'), ('April'), ('May')
                           , ('June'), ('July'), ('August') ,('September'), ('October')
                           , ('November'), ('December')

RETURN (SELECT I.month
        FROM @intMonth I
        WHERE I.num = @num)
END
GO

--Use the function for various months
SELECT dbo.getmonth(4) AS [Month]
SELECT dbo.getmonth(5) AS [Month]
SELECT dbo.getmonth(6) AS [Month] 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2018-11-16T15:39:07.823

您可以创建这样的函数来生成月份并执行 SELECT dbo.fn_GetMonthFromDate(date_column) as Month FROM table_name

```
 /****** Object:  UserDefinedFunction [dbo].[fn_GetMonthFromDate]    Script Date: 11/16/2018 10:26:33 AM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[fn_GetMonthFromDate] 
(@date datetime)
RETURNS varchar(50)
AS
BEGIN
    DECLARE @monthPart int `SET @monthPart = MONTH(@date)

IF @monthPart = 1
    BEGIN
        RETURN 'January'
    END
ELSE IF @monthPart = 2
    BEGIN
        RETURN 'February'
    END
ELSE IF @monthPart = 3
    BEGIN
        RETURN 'March'
    END
ELSE IF @monthPart = 4
    BEGIN
        RETURN 'April'
    END
ELSE IF @monthPart = 5
    BEGIN
        RETURN 'May'
    END
ELSE IF @monthPart = 6
    BEGIN
        RETURN 'June'
    END
ELSE IF @monthPart = 7
    BEGIN
        RETURN 'July'
    END
ELSE IF @monthPart = 8
    BEGIN
        RETURN 'August'
    END
ELSE IF @monthPart = 9
    BEGIN
        RETURN 'September'
    END
ELSE IF @monthPart = 10
    BEGIN
        RETURN 'October'
    END
ELSE IF @monthPart = 11
    BEGIN
        RETURN 'November'
    END
ELSE IF @monthPart = 12
    BEGIN
        RETURN 'December'
    END
RETURN NULL END` 

            回答 #29

赞同：0

时间：2019-05-21T12:58:48.323

最简单的方法是调用函数`MONTHNAME(your_date)`。**your_date**可以是静态值，也可以是表字段之一的值。

            回答 #30

赞同：-1

时间：2012-07-10T15:56:48.867

```
to_char(to_date(V_MONTH_NUM,'MM'),'MONTH') 
```

`V_MONTH_NUM`月份号在哪里

```
SELECT to_char(to_date(V_MONTH_NUM,'MM'),'MONTH')  from dual; 
```

            回答 #31

赞同：-1

时间：2020-02-14T12:13:37.410

试试这个：`SELECT MONTHNAME(concat('1970-',[Month int val],'-01'))`
例如-`SELECT MONTHNAME(concat('1970-',4,'-01'))`
答案是——四月

            回答 #32

赞同：-1

时间：2021-12-03T10:42:21.367

如果有人试图在 MySQL 中获得同样的东西。请检查以下查询。

```
 SELECT MONTH(STR_TO_DATE('November', '%M')) 
```

通过这个我得到了所需的结果。

            回答 #33

赞同：-2

时间：2011-09-28T12:54:06.450

使用此语句

```
SELECT TO_CHAR(current_date,'dd MONTH yyyy') FROM dual 
```

这会将月份数字转换为月份完整字符串

        asp.net - 在 aspx 中的 <%# %> 标记中可以访问哪些其他对象？

ID：185521

赞同：4

时间：2008-10-09T00:51:10.373

标签：asp.net, data-binding

我在aspx页面中一直遇到类似的代码：

```
<asp:CheckBox Runat="server" ID="myid" Checked='<%# DataBinder.Eval(Container.DataItem, "column").Equals(1) %>'> 
```

我想知道在该 <%# %> 标记内我可以访问哪些其他对象。为什么 DataBinder.Eval() 和 Container.DataItem 在 .CS 代码中的任何地方都不可见？

            回答 #1

赞同：8

时间：2008-10-09T01:37:54.087

在您可以访问的 <%# %> 标记内

1.  在代码隐藏类中可见的任何内容（包括受保护的方法和属性）。
2.  使用 <@import @> 在 aspx 页面上声明的任何内容。
3.  触发 ItemDataBound 事件时作为事件参数传入的任何内容（例如，RepeaterItemEventArgs、DataListItemEventArgs 等）。

*Container*实际上是 RepeaterItemEventArgs.Item、DataListItemEventArgs.Item 等的包装器。因此，您实际上可以在 ItemDataBound 事件中的代码中以*e.Item*的形式访问它（e 通常是事件参数参数名称）。

*DataBinder*也可以使用*System.Web.UI.DataBinder*在后面的代码中访问。

附带说明一下，转换 Container.DataItem 优于使用 Eval。Eval 使用反射，所以那里有开销。在 VB.NET 中，它类似于

```
<%#DirectCast(Container.DataItem, DataRow)("some_column")%> 
```

或 C#

```
<%#((DataRow)Container.DataItem)["some_column"].ToString()%> 
```

            回答 #2

赞同：1

时间：2008-10-09T01:12:58.613

我相信您可以访问页面类范围内的任何内容，尽管表达式的结果被转换为字符串，因此您不能像使用“<%”表达式漏洞那样嵌入条件表达式。

[这](http://www.odetocode.com/Articles/278.aspx)是一篇不错的博客文章，深入介绍了生成的 ASPX 类。

希望这可以帮助。

            回答 #3

赞同：1

时间：2008-10-09T01:31:55.347

<%# 特定于内联 ASPX 数据绑定，就像发布的链接 ckramer 所暗示的那样。

为什么 DataBinder.Eval() 和 Container.DataItem 在 .CS 代码中的任何地方都不可见？

要访问代码隐藏中的绑定项，您需要设置一个[ItemDataBound](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.datagrid.itemdatabound.aspx "项目数据绑定")事件。

            回答 #4

赞同：1

时间：2008-10-09T01:52:46.303

ASP.NET 为[模板](http://msdn.microsoft.com/en-us/library/system.web.ui.templatecontrol.aspx)的每次出现生成一个 TemplateControl 的子类。数据绑定语句是在该类中的方法中使用的表达式。因此，您可以在 TemplateControl 上调用任何公共/受保护的实例方法。查看[任何](http://aspnet.4guysfromrolla.com/articles/092706-1.aspx)使用 XPath 的示例，因为这些示例将使用 XPath 和 XPathSelect 方法；Eval、XPath 和 XPathSelect 都是 TemplateControl 上的实例方法。

[DataBinder](http://msdn.microsoft.com/en-us/library/system.web.ui.databinder.aspx)其实是一个单独的类，Eval是它上面的公共静态方法；它在 System.Web.UI 中。DataBinder.Eval 和plain Eval 没有直接关系，尽管它们明显地做了非常相似的事情。

我相信“容器”实际上是编译数据绑定语句的局部变量或参数。我暂时不记得它的类型了。

            回答 #5

赞同：1

时间：2009-08-17T12:13:23.310

很好的例子  

```
<%#((System.Data.DataRow)Container.DataItem)["ColumnName"].ToString()%> 
```

            回答 #6

赞同：1

时间：2009-08-17T12:25:59.087

using`<%# %>`实际上意味着该块内的代码将在执行`page.DataBind()`方法时执行。因此，您可以访问该特定页面/控件作为受保护/公共访问的任何内容。

        actionscript-3 - Actionscript3 E4X XML 和 CSS：我真的必须使用 CDATA 吗？

ID：185522

赞同：0

时间：2008-10-09T00:51:38.203

标签：actionscript-3, e4x, cdata

在 XML 中使用 CSS 时，例如

```
<span class="IwuvAS3"></span> 
```

在闪存中解析时，如果我不使用 CDATA，如下所示：

```
<![CDATA[<span class="IwuvAS3"></span>]]> 
```

然后解析的数据会为它看到的每个“<”字符下降一行。

将数据解析为单行文本字段时，没有显示任何内容，因为它实际上是在一行中。当我把它包在里面时`CDATA`，效果很好。我玩过`prettyIndent`，据我所知`ignoreWhite`，默认情况下是真的。

有没有一种方法可以在不使用`CDATA`并保持隐含行中断的情况下解析数据？

**编辑 1 (10/10/08)**：谢谢，但我实际上是在寻找函数或方法。转义每个都比使用 CDATA 麻烦得多。我不想使用 CDATA 的唯一原因是我被教导要远离它。如果 ActionScript 具有与 E4X XML 处理相关联的方法，该方法将消除将我的 XML 包装在 CDATA 中的要求，我很想知道它。

**编辑 1（2008 年 10 月 15 日）**：谢谢菲利普！我从来没有想过 Flash 中的 HTML 格式会被视为空格。答案是

```
textField.condenseWhite = true; 
```

<3AS3

            回答 #1

赞同：3

时间：2008-10-12T21:59:54.607

将 TextField 的**condenseWhite**属性设置为 true - 这样只有 < br/> 标记会生成换行符。

            回答 #2

赞同：0

时间：2008-10-09T00:58:02.357

您可以将“<”字符（以及 &、“、>、' 等）转义为实体。

        iphone - 使用界面生成器为 iPhone 应用程序生成视图。？

ID：185523

赞同：-1

时间：2008-10-09T00:51:46.317

标签：iphone, interface-builder

我想使用界面生成器生成一个修复视图，但该视图的大小超过了 iphone 屏幕的大小，我无法最大化屏幕。我想在那个屏幕上显示表格视图。我确实启用了滚动，但没有奏效，

**更新 1：**

实际上我想在单元格内显示缩略图，我想显示 5 个单元格，所以 5 个缩略图，这些图像是静态的。那么，界面构建器或编程哪个更好？

希望这足够清楚。

            回答 #1

赞同：1

时间：2008-10-10T10:52:40.830

你的问题不是很清楚，所以这是我试图在这里回答的问题：

你想要一个有五行的表格视图，每行都有一个小图像。

简短的回答：你*不能*完全在 Interface Builder 中做到这一点。您可以做的是定义您的表格视图，包括“外观”、滚动功能等。然后在同一个 XIB 文件中定义表格单元格（可以包括您的图片、标题和您拥有的内容）。

然后，您必须以编程方式将两者连接在一起。Apple 在 SDK 中提供了大量关于如何执行此操作的示例。

        windows - 构建 MFC 自动化示例（使用 OLE 自动化访问 Excel）。无法编译

ID：185524

赞同：3

时间：2008-10-09T00:52:20.030

标签：windows, excel, ole-automation

我正在尝试构建[http://support.microsoft.com/kb/178749/EN-US/](http://support.microsoft.com/kb/178749/EN-US/)  中描述的示例，以便构建使用自动化以编程方式访问 Excel 的应用程序。我有 Visual C++ 2005/Visual Studio 2005。有些指令不完全匹配（主要是类向导），但总体思路似乎是一样的。

问题：使用“新类”创建包装类后，我没有得到一个 excel.h 文件。所以我不能 #include 该文件，因为它在步骤 13 中指定。我确实在我的 windebug 目录中获得了一个 excel.tlh 和一个 excel.tli，但这似乎不起作用。我尝试了所有订单

```
#include "stdafx.h"
#include "debug/excel.tli"
#include "debug/excel.tlh" 
```

...包括将其中一个文件排除在编译之外，但我仍然会遇到大量编译错误。

以下是上述 #includes 的前 5 个编译错误：

```
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tli(14) : error C2653: 'Adjustments' : is not a class or namespace name
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tli(14) : error C2146: syntax error : missing ';' before identifier 'GetParent'
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tli(14) : error C2433: 'IDispatchPtr' : 'inline' not permitted on data declarations
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tli(14) : error C4430: missing type specifier - int assumed. Note: C++ does not support default-int
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tli(14) : error C4430: missing type specifier - int assumed. Note: C++ does not support default-int
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tli(16) : error C3861: 'get_Parent': identifier not found 
```

以下是其中包括的前 5 个错误：

```
#include "stdafx.h"
#include "debug/excel.tlh"

1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tlh(550) : error C3121: cannot change GUID for class 'IFilter'
1>        c:\program files\microsoft sdks\windows\v6.0\include\comdef.h(483) : see declaration of 'IFilter'
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tlh(1541) : error C2786: 'BOOL (__stdcall *)(HDC,int,int,int,int)' : invalid operand for __uuidof
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tlh(1541) : error C2923: '_com_IIID' : 'Rectangle' is not a valid template type argument for parameter '_Interface'
1>        c:\program files\microsoft sdks\windows\v6.0\include\wingdi.h(3667) : see declaration of 'Rectangle'
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tlh(1541) : error C3203: '_com_IIID' : unspecialized class template can't be used as a template argument for template parameter '_IIID', expected a real type 
```

以下是其中包括的前 5 个错误：

```
#include "stdafx.h"
#include "debug/excel.tli"

1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tli(14) : error C2653: 'Adjustments' : is not a class or namespace name
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tli(14) : error C2146: syntax error : missing ';' before identifier 'GetParent'
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tli(14) : error C2433: 'IDispatchPtr' : 'inline' not permitted on data declarations
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tli(14) : error C4430: missing type specifier - int assumed. Note: C++ does not support default-int
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\excel.tli(14) : error C4430: missing type specifier - int assumed. Note: C++ does not support default-int 
```

提前致谢。

            回答 #1

赞同：1

时间：2008-10-09T05:29:21.420

我不熟悉 ClassWizard 包装器生成器，但看起来它可能已经 #imported 没有命名空间的 Excel COM 类型库，并且您与 SDK 头文件发生冲突。检查`.tlh`文件并确保定义周围有命名空间。如果没有，我会考虑使用#import 以更手动（但更安全）的方式导入它。

直接使用#import 签出；它将在构建目录中生成`.tlh`和`.tli`文件，然后您可以使用目录`CComPtr<>`等。我发现这比使用 CW 包装类要简单得多。无论如何，这是我的建议。

            回答 #2

赞同：0

时间：2008-10-10T23:27:27.113

应尼克的要求，我发布了构建错误输出并跟踪该`vbe6ext.tlh`  文件，直到出现错误：

```
********************* Build output:

1>------ Build started: Project: testole, Configuration: Debug Win32 ------
1>Compiling...
1>testoleDlg.cpp
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\vbe6ext.tlh(463) : error C2061: syntax error : identifier '__missing_type__'
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\testoledlg.cpp(164) : error C2065: '_Application' : undeclared identifier
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\testoledlg.cpp(164) : error C2146: syntax error : missing ';' before identifier 'app'
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\testoledlg.cpp(164) : error C2065: 'app' : undeclared identifier
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\testoledlg.cpp(166) : error C2228: left of '.CreateDispatch' must have class/struct/union
1>        type is ''unknown-type''
1>c:\users\sniles\documents\visual studio 2005\source10\testole\testole\testoledlg.cpp(172) : error C2228: left of '.SetVisible' must have class/struct/union
1>        type is ''unknown-type''
1>Build log was saved at "file://c:\Users\sniles\Documents\Visual Studio 2005\Source10\testole\testole\Debug\BuildLog.htm"
1>testole - 6 error(s), 0 warning(s)
========== Build: 0 succeeded, 1 failed, 0 up-to-date, 0 skipped ==========

*******************  vbe6ext.tlh
// Created by Microsoft (R) C/C++ Compiler Version 14.00.50727.42 (e112bc16).
//
// c:\users\sniles\documents\visual studio 2005\source10\testole\testole\debug\vbe6ext.tlh
//
// C++ source equivalent of Win32 type library C:\Program Files\Common Files\Microsoft Shared\VBA\VBA6\VBE6EXT.OLB
// compiler-generated file created 10/10/08 at 14:03:16 - DO NOT EDIT!

#pragma once
#pragma pack(push, 8)

#include <comdef.h>

namespace VBIDE {

//
// Forward references and typedefs
//

struct __declspec(uuid("0002e157-0000-0000-c000-000000000046"))
/* LIBID */ __VBIDE;
struct __declspec(uuid("0002e158-0000-0000-c000-000000000046"))
/* dual interface */ Application;
enum vbextFileTypes;
struct __declspec(uuid("0002e166-0000-0000-c000-000000000046"))
/* dual interface */ testVBE;
enum vbext_WindowType;
enum vbext_WindowState;
struct __declspec(uuid("0002e16b-0000-0000-c000-000000000046"))
/* dual interface */ Window;
struct __declspec(uuid("0002e16a-0000-0000-c000-000000000046"))
/* dual interface */ _Windows_old;
struct __declspec(uuid("f57b7ed0-d8ab-11d1-85df-00c04f98f42c"))
/* dual interface */ _Windows;
struct /* coclass */ Windows;
struct __declspec(uuid("0002e16c-0000-0000-c000-000000000046"))
/* dual interface */ _LinkedWindows;
struct /* coclass */ LinkedWindows;
struct __declspec(uuid("0002e167-0000-0000-c000-000000000046"))
/* dual interface */ Events;
struct __declspec(uuid("0002e113-0000-0000-c000-000000000046"))
/* interface */ _VBProjectsEvents;
struct __declspec(uuid("0002e103-0000-0000-c000-000000000046"))
/* dispinterface */ _dispVBProjectsEvents;
struct __declspec(uuid("0002e115-0000-0000-c000-000000000046"))
/* interface */ _VBComponentsEvents;
struct __declspec(uuid("0002e116-0000-0000-c000-000000000046"))
/* dispinterface */ _dispVBComponentsEvents;
struct __declspec(uuid("0002e11a-0000-0000-c000-000000000046"))
/* interface */ _ReferencesEvents;
struct __declspec(uuid("0002e118-0000-0000-c000-000000000046"))
/* dispinterface */ _dispReferencesEvents;
struct /* coclass */ ReferencesEvents;
struct __declspec(uuid("0002e130-0000-0000-c000-000000000046"))
/* interface */ _CommandBarControlEvents;
struct __declspec(uuid("0002e131-0000-0000-c000-000000000046"))
/* dispinterface */ _dispCommandBarControlEvents;
struct /* coclass */ CommandBarEvents;
struct __declspec(uuid("0002e159-0000-0000-c000-000000000046"))
/* dual interface */ _ProjectTemplate;
struct /* coclass */ ProjectTemplate;
enum vbext_ProjectType;
enum vbext_ProjectProtection;
enum vbext_VBAMode;
struct __declspec(uuid("0002e160-0000-0000-c000-000000000046"))
/* dual interface */ _VBProject_Old;
struct __declspec(uuid("eee00915-e393-11d1-bb03-00c04fb6c4a6"))
/* dual interface */ _VBProject;
struct /* coclass */ VBProject;
struct __declspec(uuid("0002e165-0000-0000-c000-000000000046"))
/* dual interface */ _VBProjects_Old;
struct __declspec(uuid("eee00919-e393-11d1-bb03-00c04fb6c4a6"))
/* dual interface */ _VBProjects;
struct /* coclass */ VBProjects;
struct __declspec(uuid("be39f3d4-1b13-11d0-887f-00a0c90f2744"))
/* dual interface */ SelectedComponents;
enum vbext_ComponentType;
struct __declspec(uuid("0002e161-0000-0000-c000-000000000046"))
/* dual interface */ _Components;
struct /* coclass */ Components;
struct __declspec(uuid("0002e162-0000-0000-c000-000000000046"))
/* dual interface */ _VBComponents_Old;
struct __declspec(uuid("eee0091c-e393-11d1-bb03-00c04fb6c4a6"))
/* dual interface */ _VBComponents;
struct /* coclass */ VBComponents;
struct __declspec(uuid("0002e163-0000-0000-c000-000000000046"))
/* dual interface */ _Component;
struct /* coclass */ Component;
struct __declspec(uuid("0002e164-0000-0000-c000-000000000046"))
/* dual interface */ _VBComponent_Old;
struct __declspec(uuid("eee00921-e393-11d1-bb03-00c04fb6c4a6"))
/* dual interface */ _VBComponent;
struct /* coclass */ VBComponent;
struct __declspec(uuid("0002e18c-0000-0000-c000-000000000046"))
/* dual interface */ Property;
struct __declspec(uuid("0002e188-0000-0000-c000-000000000046"))
/* dual interface */ _Properties;
struct /* coclass */ Properties;
struct __declspec(uuid("da936b62-ac8b-11d1-b6e5-00a0c90f2744"))
/* dual interface */ _AddIns;
struct /* coclass */ Addins;
struct __declspec(uuid("da936b64-ac8b-11d1-b6e5-00a0c90f2744"))
/* dual interface */ AddIn;
enum vbext_ProcKind;
struct __declspec(uuid("0002e16e-0000-0000-c000-000000000046"))
/* dual interface */ _CodeModule;
struct /* coclass */ CodeModule;
struct __declspec(uuid("0002e172-0000-0000-c000-000000000046"))
/* dual interface */ _CodePanes;
struct /* coclass */ CodePanes;
enum vbext_CodePaneview;
struct __declspec(uuid("0002e176-0000-0000-c000-000000000046"))
/* dual interface */ _CodePane;
struct /* coclass */ CodePane;
struct __declspec(uuid("0002e17a-0000-0000-c000-000000000046"))
/* dual interface */ _References;
enum vbext_RefKind;
struct __declspec(uuid("0002e17e-0000-0000-c000-000000000046"))
/* dual interface */ ignorethis;
struct __declspec(uuid("cdde3804-2064-11cf-867f-00aa005ff34a"))
/* dispinterface */ _dispReferences_Events;
struct /* coclass */ References;

//
// Smart pointer typedef declarations
//

_COM_SMARTPTR_TYPEDEF(Application, __uuidof(Application));
_COM_SMARTPTR_TYPEDEF(_VBProjectsEvents, __uuidof(_VBProjectsEvents));
_COM_SMARTPTR_TYPEDEF(_dispVBProjectsEvents, __uuidof(_dispVBProjectsEvents));
_COM_SMARTPTR_TYPEDEF(_VBComponentsEvents, __uuidof(_VBComponentsEvents));
_COM_SMARTPTR_TYPEDEF(_dispVBComponentsEvents, __uuidof(_dispVBComponentsEvents));
_COM_SMARTPTR_TYPEDEF(_ReferencesEvents, __uuidof(_ReferencesEvents));
_COM_SMARTPTR_TYPEDEF(_dispReferencesEvents, __uuidof(_dispReferencesEvents));
_COM_SMARTPTR_TYPEDEF(_CommandBarControlEvents, __uuidof(_CommandBarControlEvents));
_COM_SMARTPTR_TYPEDEF(_dispCommandBarControlEvents, __uuidof(_dispCommandBarControlEvents));
_COM_SMARTPTR_TYPEDEF(_ProjectTemplate, __uuidof(_ProjectTemplate));
_COM_SMARTPTR_TYPEDEF(Events, __uuidof(Events));
_COM_SMARTPTR_TYPEDEF(_Component, __uuidof(_Component));
_COM_SMARTPTR_TYPEDEF(SelectedComponents, __uuidof(SelectedComponents));
_COM_SMARTPTR_TYPEDEF(_dispReferences_Events, __uuidof(_dispReferences_Events));
_COM_SMARTPTR_TYPEDEF(testVBE, __uuidof(testVBE));
_COM_SMARTPTR_TYPEDEF(Window, __uuidof(Window));
_COM_SMARTPTR_TYPEDEF(_Windows_old, __uuidof(_Windows_old));
_COM_SMARTPTR_TYPEDEF(_LinkedWindows, __uuidof(_LinkedWindows));
_COM_SMARTPTR_TYPEDEF(_VBProject_Old, __uuidof(_VBProject_Old));
_COM_SMARTPTR_TYPEDEF(_VBProject, __uuidof(_VBProject));
_COM_SMARTPTR_TYPEDEF(_VBProjects_Old, __uuidof(_VBProjects_Old));
_COM_SMARTPTR_TYPEDEF(_VBProjects, __uuidof(_VBProjects));
_COM_SMARTPTR_TYPEDEF(_Components, __uuidof(_Components));
_COM_SMARTPTR_TYPEDEF(_VBComponents_Old, __uuidof(_VBComponents_Old));
_COM_SMARTPTR_TYPEDEF(_VBComponents, __uuidof(_VBComponents));
_COM_SMARTPTR_TYPEDEF(_VBComponent_Old, __uuidof(_VBComponent_Old));
_COM_SMARTPTR_TYPEDEF(_VBComponent, __uuidof(_VBComponent));
_COM_SMARTPTR_TYPEDEF(Property, __uuidof(Property));
_COM_SMARTPTR_TYPEDEF(_Properties, __uuidof(_Properties));
_COM_SMARTPTR_TYPEDEF(AddIn, __uuidof(AddIn));
_COM_SMARTPTR_TYPEDEF(_Windows, __uuidof(_Windows));
_COM_SMARTPTR_TYPEDEF(_AddIns, __uuidof(_AddIns));
_COM_SMARTPTR_TYPEDEF(_CodeModule, __uuidof(_CodeModule));
_COM_SMARTPTR_TYPEDEF(_CodePanes, __uuidof(_CodePanes));
_COM_SMARTPTR_TYPEDEF(_CodePane, __uuidof(_CodePane));
_COM_SMARTPTR_TYPEDEF(ignorethis, __uuidof(ignorethis));
_COM_SMARTPTR_TYPEDEF(_References, __uuidof(_References));

//
// Type library items
//

struct __declspec(uuid("0002e158-0000-0000-c000-000000000046"))
Application : IDispatch
{
    //
    // Raw methods provided by interface
    //

      virtual HRESULT __stdcall get_Version (
        /*[out,retval]*/ BSTR * lpbstrReturn ) = 0;
};

enum __declspec(uuid("06a03650-2369-11ce-bfdc-08002b2b8cda"))
vbextFileTypes
{
    vbextFileTypeForm = 0,
    vbextFileTypeModule = 1,
    vbextFileTypeClass = 2,
    vbextFileTypeProject = 3,
    vbextFileTypeExe = 4,
    vbextFileTypeFrx = 5,
    vbextFileTypeRes = 6,
    vbextFileTypeUserControl = 7,
    vbextFileTypePropertyPage = 8,
    vbextFileTypeDocObject = 9,
    vbextFileTypeBinary = 10,
    vbextFileTypeGroupProject = 11,
    vbextFileTypeDesigners = 12
};

enum __declspec(uuid("be39f3db-1b13-11d0-887f-00a0c90f2744"))
vbext_WindowType
{
    vbext_wt_CodeWindow = 0,
    vbext_wt_Designer = 1,
    vbext_wt_Browser = 2,
    vbext_wt_Watch = 3,
    vbext_wt_Locals = 4,
    vbext_wt_Immediate = 5,
    vbext_wt_ProjectWindow = 6,
    vbext_wt_PropertyWindow = 7,
    vbext_wt_Find = 8,
    vbext_wt_FindReplace = 9,
    vbext_wt_Toolbox = 10,
    vbext_wt_LinkedWindowFrame = 11,
    vbext_wt_MainWindow = 12,
    vbext_wt_ToolWindow = 15
};

enum __declspec(uuid("be39f3dc-1b13-11d0-887f-00a0c90f2744"))
vbext_WindowState
{
    vbext_ws_Normal = 0,
    vbext_ws_Minimize = 1,
    vbext_ws_Maximize = 2
};

struct __declspec(uuid("0002e185-0000-0000-c000-000000000046"))
Windows;
    // [ default ] interface _Windows

struct __declspec(uuid("0002e187-0000-0000-c000-000000000046"))
LinkedWindows;
    // [ default ] interface _LinkedWindows

struct __declspec(uuid("0002e113-0000-0000-c000-000000000046"))
_VBProjectsEvents : IUnknown
{};

struct __declspec(uuid("0002e103-0000-0000-c000-000000000046"))
_dispVBProjectsEvents : IDispatch
{};

struct __declspec(uuid("0002e115-0000-0000-c000-000000000046"))
_VBComponentsEvents : IUnknown
{};

struct __declspec(uuid("0002e116-0000-0000-c000-000000000046"))
_dispVBComponentsEvents : IDispatch
{};

struct __declspec(uuid("0002e11a-0000-0000-c000-000000000046"))
_ReferencesEvents : IUnknown
{};

struct __declspec(uuid("0002e118-0000-0000-c000-000000000046"))
_dispReferencesEvents : IDispatch
{};

struct __declspec(uuid("0002e119-0000-0000-c000-000000000046"))
ReferencesEvents;
    // [ default ] interface _ReferencesEvents
    // [ default, source ] dispinterface _dispReferencesEvents

struct __declspec(uuid("0002e130-0000-0000-c000-000000000046"))
_CommandBarControlEvents : IUnknown
{};

struct __declspec(uuid("0002e131-0000-0000-c000-000000000046"))
_dispCommandBarControlEvents : IDispatch
{};

struct __declspec(uuid("0002e132-0000-0000-c000-000000000046"))
CommandBarEvents;
    // [ default ] interface _CommandBarControlEvents
    // [ default, source ] dispinterface _dispCommandBarControlEvents

struct __declspec(uuid("0002e159-0000-0000-c000-000000000046"))
_ProjectTemplate : IDispatch
{
    //
    // Raw methods provided by interface
    //

      virtual HRESULT __stdcall get_Application (
        /*[out,retval]*/ struct Application * * lppaReturn ) = 0;
      virtual HRESULT __stdcall get_Parent (
        /*[out,retval]*/ struct Application * * lppaReturn ) = 0;
};

struct __declspec(uuid("32cdf9e0-1602-11ce-bfdc-08002b2b8cda"))
ProjectTemplate;
    // [ default ] interface _ProjectTemplate

enum __declspec(uuid("ffcf3247-debf-11d1-baff-00c04fb6c4a6"))
vbext_ProjectType
{
    vbext_pt_HostProject = 100,
    vbext_pt_StandAlone = 101
};

enum __declspec(uuid("0002e129-0000-0000-c000-000000000046"))
vbext_ProjectProtection
{
    vbext_pp_none = 0,
    vbext_pp_locked = 1
};

enum __declspec(uuid("be39f3d2-1b13-11d0-887f-00a0c90f2744"))
vbext_VBAMode
{
    vbext_vm_Run = 0,
    vbext_vm_Break = 1,
    vbext_vm_Design = 2
};

struct __declspec(uuid("0002e169-0000-0000-c000-000000000046"))
VBProject;
    // [ default ] interface _VBProject

struct __declspec(uuid("0002e167-0000-0000-c000-000000000046"))
Events : IDispatch
{
    //
    // Raw methods provided by interface
    //

      virtual HRESULT __stdcall get_ReferencesEvents (
        /*[in]*/ struct _VBProject * VBProject,
        /*[out,retval]*/ struct _ReferencesEvents * * prceNew ) = 0;
      virtual HRESULT __stdcall get_CommandBarEvents (
        /*[in]*/ IDispatch * CommandBarControl,
        /*[out,retval]*/ struct _CommandBarControlEvents * * prceNew ) = 0;
};

struct __declspec(uuid("0002e101-0000-0000-c000-000000000046"))
VBProjects;
    // [ default ] interface _VBProjects

enum __declspec(uuid("be39f3d5-1b13-11d0-887f-00a0c90f2744"))
vbext_ComponentType
{
    vbext_ct_StdModule = 1,
    vbext_ct_ClassModule = 2,
    vbext_ct_MSForm = 3,
    vbext_ct_ActiveXDesigner = 11,
    vbext_ct_Document = 100
};

struct __declspec(uuid("be39f3d6-1b13-11d0-887f-00a0c90f2744"))
Components;
    // [ default ] interface _Components

struct __declspec(uuid("be39f3d7-1b13-11d0-887f-00a0c90f2744"))
VBComponents;
    // [ default ] interface _VBComponents

struct __declspec(uuid("0002e163-0000-0000-c000-000000000046"))
_Component : IDispatch
{
    //
    // Raw methods provided by interface
    //

      virtual HRESULT __stdcall get_Application (
        /*[out,retval]*/ struct Application * * lppaReturn ) = 0;
      virtual HRESULT __stdcall get_Parent (
        /*[out,retval]*/ struct _Components * * lppcReturn ) = 0;
      virtual HRESULT __stdcall get_IsDirty (
        /*[out,retval]*/ VARIANT_BOOL * lpfReturn ) = 0;
      virtual HRESULT __stdcall put_IsDirty (
        /*[in]*/ VARIANT_BOOL lpfReturn ) = 0;
      virtual HRESULT __stdcall get_Name (
        /*[out,retval]*/ BSTR * pbstrReturn ) = 0;
      virtual HRESULT __stdcall put_Name (
        /*[in]*/ BSTR pbstrReturn ) = 0;
};

struct __declspec(uuid("be39f3d8-1b13-11d0-887f-00a0c90f2744"))
Component;
    // [ default ] interface _Component

struct __declspec(uuid("be39f3d4-1b13-11d0-887f-00a0c90f2744"))
SelectedComponents : IDispatch
{
    //
    // Raw methods provided by interface
    //

      virtual HRESULT __stdcall Item (
        /*[in]*/ int index,
        /*[out,retval]*/ struct _Component * * lppcReturn ) = 0;
      virtual HRESULT __stdcall get_Application (
        /*[out,retval]*/ struct Application * * lppaReturn ) = 0;
      virtual HRESULT __stdcall get_Parent (
        /*[out,retval]*/ struct _VBProject * * lppptReturn ) = 0;
      virtual HRESULT __stdcall get_Count (
        /*[out,retval]*/ long * lplReturn ) = 0;
      virtual HRESULT __stdcall _NewEnum (
        /*[out,retval]*/ IUnknown * * lppiuReturn ) = 0;
};

struct __declspec(uuid("be39f3da-1b13-11d0-887f-00a0c90f2744"))
VBComponent;
    // [ default ] interface _VBComponent

struct __declspec(uuid("0002e18b-0000-0000-c000-000000000046"))
Properties;
    // [ default ] interface _Properties

struct __declspec(uuid("da936b63-ac8b-11d1-b6e5-00a0c90f2744"))
Addins;
    // [ default ] interface _AddIns

enum vbext_ProcKind
{
    vbext_pk_Proc = 0,
    vbext_pk_Let = 1,
    vbext_pk_Set = 2,
    vbext_pk_Get = 3
};

struct __declspec(uuid("0002e170-0000-0000-c000-000000000046"))
CodeModule;
    // [ default ] interface _CodeModule

struct __declspec(uuid("0002e174-0000-0000-c000-000000000046"))
CodePanes;
    // [ default ] interface _CodePanes

enum vbext_CodePaneview
{
    vbext_cv_ProcedureView = 0,
    vbext_cv_FullModuleView = 1
};

struct __declspec(uuid("0002e178-0000-0000-c000-000000000046"))
CodePane;
    // [ default ] interface _CodePane

enum vbext_RefKind
{
    vbext_rk_TypeLib = 0,
    vbext_rk_Project = 1
};

struct __declspec(uuid("cdde3804-2064-11cf-867f-00aa005ff34a"))
_dispReferences_Events : IDispatch
{};

struct __declspec(uuid("0002e17c-0000-0000-c000-000000000046"))
References;
    // [ default ] interface _References
    // [ default, source ] dispinterface _dispReferences_Events

struct __declspec(uuid("0002e166-0000-0000-c000-000000000046"))
testVBE : Application
{
    //
    // Raw methods provided by interface
    //

      virtual HRESULT __stdcall get_VBProjects (
        /*[out,retval]*/ struct _VBProjects * * lppptReturn ) = 0;
      virtual HRESULT __stdcall get_CommandBars (
        /*[out,retval]*/ __missing_type__ * * ppcbs ) = 0; 
```

            回答 #3

赞同：0

时间：2008-10-09T05:38:18.517

我不知道这是否有帮助，但通常你`#import`是类型库，但你不是`#include`.tli 和 .tlh 文件（`#import`隐式这样做）。

另外，请记住在 MFC 中有两种调用 COM 服务器的方法。

1.  使用`#import`它基本上创建智能 ATL 指针来创建 COM 对象和调用方法。

2.  使用类向导创建`IDispatch`样式类包装器以创建 COM 对象并调用方法。

        java - Java：Solaris 上的 AWT

ID：185531

赞同：-2

时间：2008-10-09T00:55:57.433

标签：java, open-source, graphics, solaris, awt

AWT 是如何为[Solaris](https://www.oracle.com/solaris/solaris11/)实现的？

即：它依赖于哪些本机库（如果有）？

            回答 #1

赞同：2

时间：2008-10-09T13:24:10.057

对于 Sun JRE：老式 MToolkit 使用 Motify。我认为从 1.5 开始，就有了 XToolkit，它只使用 xlib。从记忆中，Solaris 将 MToolkit 作为默认设置的时间比在 Linux 上更长。它可以通过 AWT_TOOLKIT 环境变量进行切换。

        macos - DropBox Mac 客户端如何工作？

ID：185533

赞同：10

时间：2008-10-09T00:57:30.283

标签：macos, filesystems, integration, finder, fsevents

我一直在研究  [DropBox](http://www.getdropbox.com/install?os=mac) Mac 客户端，目前正在研究为不同的服务实现类似的接口。

它们究竟是如何与 finder 这样的？我非常怀疑文件夹中表示的这些对象是每次加载时下载的实际文档？它们必须根据需要动态下载。那么如何在没有实际文件系统对象的情况下在 finder 中显示这些项目呢？

**有谁知道这是如何在 Mac OS X 中实现的？** 

或者任何指向 Apple API 或其他与 finder 具有类似集成的开源项目的指针？

            回答 #1

赞同：31

时间：2008-10-09T15:59:11.133

Dropbox 不是由 MacFUSE 或 WebDAV 提供支持，尽管这些可能是您想要完成的完美解决方案。

如果它是由这些东西驱动的，那么当你没有连接时它就不会工作，因为它们都依赖于服务器来存储实际信息，而 Dropbox 没有。如果我退出 Dropbox（通过菜单项完成）并断开网络连接，我仍然可以使用这些文件。那是因为这些文件实际上存储在我的硬盘上。

这也意味着文件不需要“每次加载时都下载”，因为它们实际上存储在我的机器上。相反，只有增量通过网络发送，Dropbox 应用程序（在后台运行）适当地修补文件。另一方面，Dropbox 应用程序监视 Dropbox 文件夹中的文件，当它们发生变化时，它将适当的增量发送到服务器，服务器将它们传播到任何其他客户端。

这种设置有一些明显的优势：它可以在离线时工作，速度要快一个数量级，并且对其他应用程序是透明的，因为它们只看到磁盘上的文件。但是，我不知道它如何处理合并冲突（一个或多个客户端离线时很容易出现），如果服务器是唯一的副本并且每次编辑都会更改中央副本，这不是问题。

Dropbox 真正闪耀的地方在于他们有一个额外的技巧，可以用当前同步状态标记 Dropbox 文件夹中的项目。但这不是你在这里问的。

至于手头的问题，您绝对应该研究 MacFUSE 和 WebDAV，它们可能是您问题的完美解决方案。但是 Dropbox 的做事方式，后台应用程序更改磁盘上的实际文件，可能是一个更好的权衡。

            回答 #2

赞同：11

时间：2008-10-27T04:43:31.873

Dropbox 很可能使用[FSEvents](http://developer.apple.com/documentation/Darwin/Reference/FSEvents_Ref/FSEvents/index.html)来监视文件系统的变化。这是一个很棒的 AP​​I，甚至可以捆绑在您的应用程序未运行时发生的更改。它与 Spotlight 使用的 API 相同。菜单栏应用程序可能会自己进行实际观察（例如，由于重新启动它可以修复上传被挂起的问题）。

他们不可能使用 MacFUSE，因为这需要安装 MacFUSE 内核扩展才能使 Dropbox 工作，而且由于我绝对没有安装它，我非常怀疑他们是否正在使用它。

            回答 #3

赞同：6

时间：2008-10-09T01:06:27.707

两个建议：

*   [MacFUSE](http://code.google.com/p/macfuse/)
*   [网络视频](http://www.webdav.org/)

前者将允许您编写一个显示为文件系统并执行所有正确操作的应用程序；后者将允许您将所有内容移动到服务器端，并让用户将您的服务挂载为文件共享。

            回答 #4

赞同：3

时间：2010-06-23T13:59:46.403

客户端上的 Dropbox 是用 python 编写的。客户端似乎使用 sqlite3 数据库来索引文件。我想 Dropobox 将文件分成块，以减少带宽使用。顺便说一句，两个人有同一个文件，即使不认识，服务器也可以优化，避免多次传输文件，只在服务器端复制

            回答 #5

赞同：2

时间：2009-02-26T07:56:49.847

对我来说，这感觉就像一个经过大量修改的修订控制系统。它具有所有功能：基于增量更新文件、恢复或恢复文件旧版本的选项。几乎感觉他们正在使用 git（[GitFS](http://www.sfgoth.com/~mitch/linux/gitfs/)？），或者他们设计的一些文件系统。

            回答 #6

赞同：2

时间：2011-08-23T09:05:27.383

你也可以试试[File Conveyor 。](http://fileconveyor.org)它是一个 Python 守护程序，能够立即检测 FS 更改（在 Linux 上`inotify`，在 OS X 上`FSEvents`），处理文件*并将*它们同步到一个或多个目的地。

支持的协议：FTP、SFTP、Amazon S3（也支持 CloudFront）、Rackspace Cloud Files。可以很容易地扩展。用途`django-storages`.

“处理文件”：例如优化图像、转码视频——这最初被设想用于在加速网站的情况下将静态资产发送到 CDN）

        c# - 托管环境中使用的最大堆？(.net/java)

ID：185535

赞同：2

时间：2008-10-09T00:57:45.867

标签：c#, java, .net, memory, memory-management

您个人在 Java 或 .NET 等托管环境中使用的最大堆是多少？你遇到了哪些性能问题，你最终得到的收益是否会随着堆的增大而递减？

            回答 #1

赞同：2

时间：2008-10-09T11:43:00.747

I work on a 64-bit .Net system that typically uses 9-12 GB, and sometimes as much as 20GB. I have not seen any performance problems even while garbage collecting, and I have been looking hard as I was not expecting it to work so well.

An earlier version hung on to some objects for too long resulting in occasional GCs that freed up 3GB+. Even then, there was no noticeable impact on performance. The system is running on a 16-core server with 32GB RAM, which probably helps...

            回答 #2

赞同：1

时间：2008-10-09T01:29:09.457

在 .Net 中，在 Windows 32 位上，在事情开始变得非常糟糕（内存不足异常）之前，您只能真正达到大约 1.4 GB 的内存使用量。这是由于 32 位窗口的限制，该限制将单个进程限制为使用超过 2 GB 的 RAM。您可以在 boot.ini 中添加 /3GB 开关，但这只会让您更进一步。如果你想使用大量内存，你应该认真考虑在 64 位版本的 windows 上运行。

            回答 #3

赞同：1

时间：2008-10-09T02:34:59.650

I currently have a production application with 6 GB of memory. You'll need a 64-bit box as well for the JVM to be able to address that much. 
The garbage collector is really the only thing (that I've found so far) where performance degrades with size, and then only if you manually kick off a System.GC, which forces the JVM to bring everything to a screeching halt as it traverses 6 GB worth of objects. Takes a good 20 seconds, too. The default GC behavior does not do this, BTW, you have to be dumb enough to make it do that. Also worth researching JVM tuning at this size. 

You can also find things like distributed and clustered JVMs, sorry, don't have any good references as I didn't look into this option too closely, although I did find references to larger installations. 

            回答 #4

赞同：0

时间：2008-10-09T01:04:51.407

我不确定你所说的堆是什么意思，但如果你指的是使用的内存，我已经用了很多，2GB+。我有一个进行图像处理的网络应用程序，它需要将 2 个大型扫描文件加载到内存中进行分析。

存在性能问题。Windows 会换出大量内存，然后会产生大量页面错误。一次不需要超过 2 个图像，因为所有请求都获得了这些图像（我一次只允许每个图像集 1 个会话）

例如，为初始查看设置文件大约需要 5 秒。在内存中进行简单的分析和缩放会相当快，大约为 0.1 到 0.5 秒。

我仍然需要进行优化，所以我最终对文件进行了预处理并将其切成更小的部分，并且只使用当时用户需要的部分。

            回答 #5

赞同：0

时间：2008-10-09T01:24:44.690

我在 java 中使用了 2GB 到 5GB 的内存，但通常当我达到 2GB 以上时，我才真正开始考虑内存优化。收益递减可能会有所不同，从因为您有大量内存而在必要时不进行优化，到没有可用于操作系统/磁盘缓存的内存（这可以帮助您的应用程序整体）。

对于 Java，我建议随着时间的推移观察每一代的内存使用情况。您是否创建了很多临时对象或有消耗大量内存的持久对象？知道这些东西后，可以对内存进行很多优化。

        opengl - 在 openGL 中，如何让项目向后拉到前面？

ID：185536

赞同：14

时间：2008-10-09T00:57:58.393

标签：opengl, z-order

默认情况下，对象似乎是从前到后绘制的。我正在绘制一个 2-D UI 对象，并希望从前创建它。例如，我可以先创建一个白色方块，然后在其顶部创建一个稍小的黑色方块，从而创建一个带有白色边框的黑色窗格。  [这篇文章](http://gpwiki.org/index.php/OpenGL:Tutorials:Tutorial_Framework:Ortho_and_Alpha)对此进行了一些讨论，并将此顺序描述为“画家算法”，但最终他们给出的示例只是简单地以相反的顺序渲染对象以获得所需的效果。我想从前到后（第一个对象在后面，后续对象在顶部绘制）渲染可以通过一些转换来实现（gOrtho？）？

我还会提到，我对使用 GLUT 等包装库的解决方案不感兴趣。  

我还发现，使用 Cocoa NSOpenGLView 在 Mac 上的默认行为似乎会向后拉，而在 Windows 中我无法获得这种行为。我正在使用的 Windows 中的设置代码是这样的：

```
glViewport (0, 0, wd, ht);
glMatrixMode(GL_PROJECTION);           
glLoadIdentity();                      
glOrtho (0.0f, wd, ht, 0.0f, -1.0f, 1.0f);
glMatrixMode(GL_MODELVIEW);             
glLoadIdentity(); 
```

            回答 #1

赞同：24

时间：2008-10-10T02:28:34.640

以下调用将关闭深度测试，导致对象按创建的顺序绘制。这实际上会导致对象向后拉到前面。

```
glDepthFunc(GL_NEVER);      // Ignore depth values (Z) to cause drawing bottom to top 
```

确保你不要这样称呼：

```
glEnable (GL_DEPTH_TEST);   // Enables Depth Testing 
```

            回答 #2

赞同：5

时间：2008-10-09T01:40:28.293

对于您的具体问题，没有在 OpenGL 中指定深度排序的标准化方法。默认情况下，某些实现可能会进行从前到后的深度排序，因为它通常更快，但这不能保证（正如您所发现的那样）。

但我真的不明白它会如何在你的场景中帮助你。如果你在一个白色方块前面画一个黑色方块，只要你启用了深度缓冲，黑色方块就应该画在白色方块前面，不管它们的绘制顺序是什么。如果它们实际上是共面的，那么任何一个都不会真正在另一个之前，并且任何深度排序算法都是不可预测的。

您发布链接的教程仅讨论了它，因为当您使用透明度时，深度排序是相关的。但在我看来，这并不是你所追求的。

但是，如果您真的必须这样做，那么您必须自己做。首先将您的白色方块发送到渲染管道，强制渲染，然后发送您的黑色方块。如果你这样做，并禁用深度缓冲，那么方块可以是共面的，你仍然可以保证黑色方块被绘制在白色方块上。

            回答 #3

赞同：2

时间：2008-10-09T01:04:23.780

绘图顺序很难。没有简单的解决方案。画家的算法（按对象相对于相机视野的距离对对象进行排序）是最直接的，但正如您所发现的，它并不能解决所有情况。

我建议将画家的算法和图层结合起来。您为程序中的特定元素构建层。这样你就有了背景层、对象层、特效层和 GUI 层。

对每一层的项目使用画家算法。在某些特殊层（如您的 GUI 层）中，不要使用画家算法进行排序，而是按照您的调用顺序进行排序。你首先调用那个白色方块，所以它首先被绘制。

            回答 #4

赞同：2

时间：2008-10-09T01:08:39.230

将您想要放在后面的物品画在您想要放在前面的物品后面。也就是实际改变z值（假设z垂直于屏幕平面）。您无需进行太多更改即可让项目在彼此面前绘制。如果你只是稍微改变 z 值，你应该不会注意到与他们想要的位置有太大的偏移。您甚至可以非常花哨，并根据更改的 z 位置计算正确的 x,y 位置，以便项目出现在它应该在的位置。

            回答 #5

赞同：1

时间：2008-10-10T02:40:12.963

你的东西将按照你调用 glBegin/glEnd 函数的确切顺序绘制。你可以使用 z-buffer 获得深度缓冲，如果你的 2d 对象有不同的 z 值，你可以得到你想要的效果。您在 Mac 上看到您描述的行为的唯一方法是程序是否手动以从后到前的顺序绘制内容或使用 z 缓冲区来完成此操作。否则，OpenGL 没有您所描述的任何自动功能。

            回答 #6

赞同：0

时间：2008-10-10T02:38:24.120

正如 AlanKley 指出的那样，这样做的方法是禁用深度缓冲区。画家算法实际上是一种 2D 扫描转换技术，用于在没有 z 缓冲区之类的东西时以正确的顺序渲染多边形。但您不会将其应用于 3D 多边形。您通常会转换和投影它们（处理与其他多边形的交点），然后按投影的 z 坐标对生成的 2D 投影多边形列表进行排序，然后以反向 z 顺序绘制它们。

当您不能（或不想）使用 z 缓冲区时，我一直认为画家算法是一种替代隐藏表面移除的技术。

        c# - .NET 日志框架

ID：185542

赞同：24

时间：2008-10-09T01:01:22.227

标签：c#, logging

在 Java 世界中，你有 log4j 和一个相当不错的日志框架，C#/.NET 有类似的东西吗？

            回答 #1

赞同：44

时间：2008-10-09T01:02:35.750

[log4net](http://logging.apache.org/log4net/index.html)将是显而易见的答案。

            回答 #2

赞同：35

时间：2008-10-09T01:21:31.920

[http://www.nlog-project.org/](http://www.nlog-project.org/) - NLog

这是一个非常灵活且可配置的日志记录工具，非常轻量级。您可以将其设置为记录到许多不同的位置（控制台、SQL、文件...等）。非常容易使用。

它甚至被 Rob Connery 在他的 Storefront MVC 项目中使用... [http://blog.wekeroad.com/mvc-storefront/](http://blog.wekeroad.com/mvc-storefront/)

            回答 #3

赞同：9

时间：2008-10-09T07:11:25.163

如果您正在寻找一个简单的非膨胀解决方案（下载大约只有 100K，实际 dll 大约 40K），我已经在多个项目中成功使用了[BitFactory 。](http://www.theobjectguy.com/dotnetlog/)

它体积小、可配置、可靠且免费！

            回答 #4

赞同：8

时间：2008-10-09T02:26:30.103

试用[Enterprise Library Logging Application Block](http://msdn.microsoft.com/en-us/library/cc309506.aspx)

尽管我也使用了这里提到的其他一些 - 它值得研究。

            回答 #5

赞同：6

时间：2008-10-09T01:05:47.757

还有[nLog](http://www.nlog-project.org/)，它非常相似，但更轻量级且配置更少。

            回答 #6

赞同：4

时间：2009-02-08T04:19:49.007

[这里](http://blog.rantingsandravings.com/2009/02/logging-frameworks.html)的评论似乎与 Developer Dude 和 nzpcmad 一致，我也同意。使用 Bit Factory，也称为[The Object Guy 的日志框架](http://www.theobjectguy.com/dotnetlog)。

            回答 #7

赞同：3

时间：2009-08-12T01:42:08.600

正如我在其他一些地方所说的，我同意这里的其他人关于[The Object Guy 的 Logging Framework 的观点](http://www.theobjectguy.com/dotnetlog)。正如 Developer Dude 所说，它并不臃肿——就像其他一些框架一样。它适用于我们所有的生产应用程序 - 并且已经这样做了好几年了。

            回答 #8

赞同：2

时间：2009-01-31T20:49:26.830

毫无疑问，试试：[this](http://www.theobjectguy.com/dotnetlog)。毫无疑问，它是大多数应用程序的最佳选择。这不是英国媒体报道。

            回答 #9

赞同：2

时间：2008-10-09T01:50:03.720

我们一直使用 MS P&P Enterprise Library Logging Application Block。它不是特别酷或优雅，但它非常灵活且设计精良。我认为我们使用它的主要原因是我们使用了 EL 中的许多其他组件，当然它们都依赖于日志记录模块。  [更多信息在这里。](http://msdn.microsoft.com/en-us/library/cc467894.aspx)

            回答 #10

赞同：1

时间：2008-10-09T06:34:14.177

实际上，如果您不需要直接开箱即用的复杂日志记录选项，我建议您编写一个瘦接口来定义您的日志记录需求（例如 log.debug()、log.error() 等）。如果您需要更改后者，或者发现当前实施存在问题，这将为您提供灵活性。

虽然这似乎不是一个很大的收获，但当我们最近将我们的框架移植到 Windows Compact Framework 时，这对我们来说是一个巨大的胜利，并且没有一个日志记录选项起作用。我们能够滑入一个空记录器，这将我们保存在该平台上。当然，评估您的特定项目和需求。

            回答 #11

赞同：1

时间：2008-10-09T01:03:04.377

是的。[日志4网](http://logging.apache.org/log4net/index.html)。

我已经用了一段时间了，它一直是救命稻草！

            回答 #12

赞同：1

时间：2008-10-09T01:09:00.447

NLog 是一个不错的选择。

            回答 #13

赞同：1

时间：2008-10-09T01:27:00.787

我仍然会说 Log4Net 是一个更安全的选择。许多其他开源项目也使用它，如果你曾经包含一个这样做的，那么你只是减少了依赖。

            回答 #14

赞同：1

时间：2008-10-09T01:27:10.847

Windows 事件日志 +[日志解析器](http://www.microsoft.com/technet/scriptcenter/tools/logparser/default.mspx)有什么不能为您做的吗？

            回答 #15

赞同：0

时间：2008-10-09T02:19:43.970

查看 TraceSources 和 TraceListeners。它内置于 .NET 并使用配置文件进行配置。

            回答 #16

赞同：0

时间：2008-10-09T03:25:15.383

大约一年前，James Newton-King 介绍了[log4net 与 Enterprise Library Logging ，我认为它在很大程度上仍然是最新的。](http://james.newtonking.com/archive/2007/06/05/enterprise-library-logging-vs-log4net.aspx)我的经验只与 EL 打交道，而且有起有落。如果您不利用每一个花里胡哨的优势，那么多层应用程序中的配置会很多，所以我可能会在我的下一个项目中尝试 log4net。

        c# - 从 C# 中的登录 ID 中删除域信息

ID：185559

赞同：21

时间：2008-10-09T01:08:15.910

标签：c#, string, indexof

我想从 C# 中的登录 ID 中删除域/计算机信息。所以，我想让“Domain\me”或“Domain\me”都只是“me”。我总是可以检查是否存在任何一个，并将其用作开始子字符串的索引......但我正在寻找更优雅和紧凑的东西。

更糟糕的情况：

```
int startIndex = 0;
int indexOfSlashesSingle = ResourceLoginName.IndexOf("\");
int indexOfSlashesDouble = ResourceLoginName.IndexOf("\\");
if (indexOfSlashesSingle != -1)
    startIndex = indexOfSlashesSingle;
else
    startIndex = indexOfSlashesDouble;
string shortName = ResourceLoginName.Substring(startIndex, ResourceLoginName.Length-1); 
```

            回答 #1

赞同：42

时间：2008-10-09T02:29:56.477

当你只有一把锤子时，一切看起来都像钉子......

使用剃须刀片----

```
using System;
using System.Text.RegularExpressions;
public class MyClass
{
    public static void Main()
    {
        string domainUser = Regex.Replace("domain\\user",".*\\\\(.*)", "$1",RegexOptions.None);
        Console.WriteLine(domainUser);  

    }

} 
```

            回答 #2

赞同：27

时间：2008-10-09T02:52:51.657

您可以滥用 Path 类，因此：

```
string shortName = System.IO.Path.GetFileNameWithoutExtension(ResourceLoginName); 
```

            回答 #3

赞同：7

时间：2011-05-02T15:25:50.120

怎么样：

```
string shortName = ResourceLoginName.Split('\\')[1] 
```

            回答 #4

赞同：6

时间：2015-01-12T19:55:56.717

这适用于两者，但适用于命名组。

```
^(?<domain>.*)\\(?<username>.*)|(?<username>[^\@]*)@(?<domain>.*)?$ 
```

            回答 #5

赞同：3

时间：2008-10-09T01:13:35.150

我总是这样做：

```
 string[] domainuser;
    string Auth_User = Request.ServerVariables["AUTH_USER"].ToString().ToLower(); 
    domainuser = Auth_User.Split('\\'); 
```

现在您可以查看 domainuser.Length 以查看其中有多少部分， domainuser[0] 用于域， domainuser[1] 用于用户名。

            回答 #6

赞同：2

时间：2008-10-09T01:17:34.067

```
 string theString = "domain\\me";
        theString = theString.Split(new char[] { '\\' })[theString.Split(new char[] { '\\' }).Length - 1]; 
```

            回答 #7

赞同：2

时间：2014-08-06T19:34:10.417

这适用于两个有效的域登录：

```
var regex = @"^(.*\\)?([^\@]*)(@.*)?$";
var user = Regex.Replace("domain\\user", regex, "$2", RegexOptions.None);
user = Regex.Replace("user@domain.com", regex, "$2", RegexOptions.None); 
```

            回答 #8

赞同：1

时间：2015-08-12T19:01:02.497

小猪支持 Derek Smalls 的答案……

```
Regex.Replace(User.Identity.Name,@"^(?<domain>.*)\\(?<username>.*)|(?<username>[^\@]*)@(?<domain>.*)?$", "${username}", RegexOptions.None) 
```

为我工作。

        java - 使用 Java 类更新 OpenLDAP

ID：185563

赞同：1

时间：2008-10-09T01:10:15.517

标签：java, ldap

我需要能够使用 Java 类更新 OpenLDAP 上的属性。

我尝试创建一个 LDAP 条目，但它看起来像一个 Java 对象，而不是一个正确的 LDAP 条目。（咕咕咕）

```
导入 javax.naming.Context；
导入 javax.naming.InitialContext；
导入 javax.naming.NamingException；
导入 javax.naming.NameAlreadyBoundException；
导入 javax.naming.directory.*；
导入 java.util.*；

公共类 TestLDAP {
        静态最终长序列版本UID = -1240113639782150930L；

        最终静态字符串 ldapServerName = "localhost:636";
        final static String rootdn = "cn=The Manager,ou=mydept,o=mycompany";
        最终静态字符串 rootpass = "密码";
        final static String rootContext = "ou=mydept,o=mycompany";

        公共静态无效主要（字符串[]参数）{
            System.setProperty("javax.net.ssl.trustStore", "C:\\cacerts");

                属性 env = new Properties();
                env.put("com.sun.jndi.ldap.trace.ber", System.out);
                env.put(Context.INITIAL_CONTEXT_FACTORY,
                         “com.sun.jndi.ldap.LdapCtxFactory”）；
                env.put(Context.SECURITY_PROTOCOL, "ssl");
                env.put(Context.PROVIDER_URL, "ldap://" + ldapServerName + "/" + rootContext );
                env.put(Context.SECURITY_PRINCIPAL, rootdn);
                env.put(Context.SECURITY_CREDENTIALS, rootpass);

                尝试 {
                        // 使用环境获取初始目录上下文
                        DirContext ctx = new InitialDirContext( env );

                        // 添加 LDAP 条目
                        属性 myAttrs = new BasicAttributes(true);
                        属性 oc = new BasicAttribute("objectclass");

                        oc.add("inetOrgPerson");
                        oc.add("组织人员");
                        oc.add("人");
                        oc.add("top");
                        myAttrs.put(oc);
                        myAttrs.put("cn","test996");
                        myAttrs.put("sn","test 996");

                        ctx.bind("cn=test997", myAttrs);
                } 捕捉（NameAlreadyBoundException nabe）{
                        System.err.println("值已经被绑定！");
                } 捕捉（异常 e）{
                        e.printStackTrace();
                }
        }
}

```

请帮忙！

            回答 #1

赞同：4

时间：2008-10-09T08:43:51.340

自从我使用 LDAP 以来已经有一段时间了，但是查看 Javadoc 我认为您使用了错误的方法。尝试类似：

```
ctx.bind("cn=test997", null, myAttrs); 
```

您是否阅读过[LDAP 教程](http://java.sun.com/products/jndi/tutorial/ldap/index.html)？当我不得不做一些 LDAP 工作时，我发现这很有帮助。

        activerecord - 获取 ActiveRecord 中每个组的最小值/最大值

ID：185569

赞同：12

时间：2008-10-09T01:12:42.953

标签：activerecord, group-by, aggregate-functions, minimum

这是一个古老的问题，给定一个具有“类型”、“品种”和“价格”属性的表格，您可以获取每种类型的最低价格的记录。

在 SQL 中，我们可以通过以下方式做到[这一点](http://www.xaprb.com/blog/2006/12/07/how-to-select-the-firstleastmax-row-per-group-in-sql/)：

```
select f.type, f.variety, f.price   
from (  select type, min(price) as minprice from table group by type ) as x  
inner join table as f on f.type = x.type and f.price = x.minprice;` 
```

我们或许可以通过以下方式模仿：

```
minprices = Table.minimum(:price, :group => type)  
result = []
minprices.each_pair do |t, p|  
   result << Table.find(:first, :conditions => ["type = ? and price = ?", t, p])
end 
```

还有比这更好的实现吗？

            回答 #1

赞同：13

时间：2008-10-09T01:55:01.760

```
Table.minimum(:price, :group => :type) 
```

有关更多信息，请参阅[http://api.rubyonrails.org/classes/ActiveRecord/Calculations.html#method-i-minimum](http://api.rubyonrails.org/classes/ActiveRecord/Calculations.html#method-i-minimum)。

            回答 #2

赞同：2

时间：2021-02-25T01:05:42.963

这对我有用。

```
Table.group(:type).minimum(:price) 
```

它返回一个像这样的对象。

```
{
 "type1"=>500.0,
 "type2"=>200.0
} 
```

            回答 #3

赞同：1

时间：2008-10-09T07:06:57.947

您可以使用 # [`find_by_sql`](http://api.rubyonrails.org/classes/ActiveRecord/Base.html#M001302)，但这意味着返回一个模型对象，这可能不是您想要的。

如果你想裸奔金属，你也可以使用 # [`select_values`](http://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/DatabaseStatements.html#M001063)：

```
data = ActiveRecord::Base.connection.select_values("
        SELECT f.type, f.variety, f.price
        FROM (SELECT type, MIN(price) AS minprice FROM table GROUP BY type ) AS x
        INNER JOIN table AS f ON f.type = x.type AND f.price = x.minprice")
puts data.inspect
[["type", "variety", 0.00]] 
```

ActiveRecord 只是一个工具。你在方便的时候使用它。当 SQL 做得更好时，你会使用它。

            回答 #4

赞同：1

时间：2013-02-14T18:45:26.333

我已经为此奋斗了一段时间，目前看来你几乎被困在生成 SQL 上。

但是，我有一些改进可以提供。

正如@François 所建议的那样`find_by_sql`，我使用了ActiveRecord's `to_sql`and`joins`来“指导”我的SQL，而不是 ：

```
subquery_sql = Table.select(["MIN(price) as price", :type]).group(:type).to_sql
joins_sql    = "INNER JOIN (#{subquery_sql}) as S
                ON table.type = S.type
                AND table.price = S.price"

Table.joins(joins_sql).where(<other conditions>).order(<your order>) 
```

如您所见，我仍在使用原始 SQL，但至少它只是在 AR 不提供支持的部分（AFAIK ActiveRecord 根本无法管理`INNER JOIN ... ON ...`）而不是整个事情。

使用`joins`而不是 find_by_sql 使查询可链接 - 您可以添加额外的条件，或对表进行排序，或将所有内容放在范围内。

            回答 #5

赞同：0

时间：2020-04-28T18:31:24.620

虽然这个问题很陈旧，但我今天问了同样的问题。下面是一个解决方案的要点，它可以用最少 (2) 个查询来组合实现目标所需的 SQL。

如果这些天有更好的方法，请lmk！

使用`Security`和`Price`模型，其中证券有许多（历史）价格，您在证券的最新价格之后：

```
module MostRecentBy
  def self.included(klass)
    klass.scope :most_recent_by, ->(group_by_col, max_by_col) {
      from(
        <<~SQL
          (
            SELECT #{table_name}.*
            FROM #{table_name} JOIN (
               SELECT #{group_by_col}, MAX(#{max_by_col}) AS #{max_by_col}
               FROM #{table_name}
               GROUP BY #{group_by_col}
            ) latest
            ON #{table_name}.date = latest.#{max_by_col}
            AND #{table_name}.#{group_by_col} = latest.#{group_by_col}
          ) #{table_name}
        SQL
      )
    }
  end
end

class Price < ActiveRecord::Base
  include MostRecentBy

  belongs_to :security

  scope :most_recent_by_security, -> { most_recent_by(:security_id, :date) }
end

class Security < ActiveRecord::Base
  has_many :prices
  has_one :latest_price, 
    -> { Price.most_recent_by_security },
    class_name: 'Price'
end 
```

现在您可以在控制器代码中调用以下代码：

```
def index
  @resources = Security.all.includes(:latest_price)

  render json: @resources.as_json(include: :latest_price)
end 
```

这导致两个查询：

```
 Security Load (4.4ms)  SELECT "securities".* FROM "securities"
  Price Load (140.3ms)  SELECT "prices".* FROM (
    SELECT prices.*
    FROM prices JOIN (
       SELECT security_id, MAX(date) AS date
       FROM prices
       GROUP BY security_id
    ) latest
    ON prices.date = latest.date
    AND prices.security_id = latest.security_id
  ) prices
  WHERE "prices"."price_type" = $1 AND "prices"."security_id" IN (...) 
```

供参考：[https ://gist.github.com/pmn4/eb58b036cc78fb41a36c56bcd6189d68](https://gist.github.com/pmn4/eb58b036cc78fb41a36c56bcd6189d68)

            回答 #6

赞同：-1

时间：2014-06-10T08:03:18.460

要更新上面 Avdi 的答案：

Table.minimum(:price, :group => :type)

这是更新后的网址：

[http://api.rubyonrails.org/classes/ActiveRecord/Calculations.html#method-i-minimum](http://api.rubyonrails.org/classes/ActiveRecord/Calculations.html#method-i-minimum)

        ruby-on-rails - Rails 模块中的 mattr_accessor 是什么？

ID：185573

赞同：114

时间：2008-10-09T01:15:15.193

标签：ruby-on-rails, ruby, class, module, activesupport

我在 Rails 文档中找不到这个，但似乎**'mattr_accessor'**是普通 Ruby**类中****'attr_accessor' (getter & setter) 的****模块**推论。 **例如。在课堂上

```
class User
  attr_accessor :name

  def set_fullname
    @name = "#{self.first_name} #{self.last_name}"
  end
end 
```

例如。在一个模块中

```
module Authentication
  mattr_accessor :current_user

  def login
    @current_user = session[:user_id] || nil
  end
end 
```

此辅助方法由**ActiveSupport**提供。

* * *

## 回答 #1

> 赞同：189
> 
>             
> 
> 时间：2008-10-09T01:49:21.817

`mattr_accessor`Rails 使用(Module accessor) 和`cattr_accessor`(以及 _ `reader`/`_writer`版本)扩展了 Ruby 。由于 Ruby为*实例*`attr_accessor`生成 getter/setter方法，因此在*类*或*模块*级别提供 getter/setter 方法。因此：*`cattr/mattr_accessor`*

 ***```
module Config
  mattr_accessor :hostname
  mattr_accessor :admin_email
end 
```

简称：

```
module Config
  def self.hostname
    @hostname
  end
  def self.hostname=(hostname)
    @hostname = hostname
  end
  def self.admin_email
    @admin_email
  end
  def self.admin_email=(admin_email)
    @admin_email = admin_email
  end
end 
```

这两个版本都允许您访问模块级变量，如下所示：

```
>> Config.hostname = "example.com"
>> Config.admin_email = "admin@example.com"
>> Config.hostname # => "example.com"
>> Config.admin_email # => "admin@example.com" 
```

* * *

## 回答 #2

> 赞同：40
> 
>             
> 
> 时间：2008-10-09T19:51:35.923

[这是来源`cattr_accessor`](http://github.com/rails/rails/tree/2-1-stable/activesupport/lib/active_support/core_ext/class/attribute_accessors.rb)

和

[这是来源`mattr_accessor`](http://github.com/rails/rails/tree/2-1-stable/activesupport/lib/active_support/core_ext/module/attribute_accessors.rb)

如您所见，它们几乎相同。

至于为什么会有两个不同的版本？有时你想写`cattr_accessor`在一个模块中，所以你可以将它用于配置信息，[比如 Avdi 提到](https://stackoverflow.com/questions/185573/what-is-mattraccessor-in-a-rails-module#185632)的。

但是，`cattr_accessor`在模块中不起作用，因此他们或多或少地将代码复制到模块中。  

此外，有时您可能希望在模块中编写类方法，这样每当任何类包含该模块时，它都会获取该类方法以及所有实例方法。`mattr_accessor`也可以让你这样做。

但是，在第二种情况下，它的行为很奇怪。观察以下代码，特别注意`@@mattr_in_module`位

```
module MyModule
  mattr_accessor :mattr_in_module
end

class MyClass
  include MyModule
  def self.get_mattr; @@mattr_in_module; end # directly access the class variable
end

MyModule.mattr_in_module = 'foo' # set it on the module
=> "foo"

MyClass.get_mattr # get it out of the class
=> "foo"

class SecondClass
  include MyModule
  def self.get_mattr; @@mattr_in_module; end # again directly access the class variable in a different class
end

SecondClass.get_mattr # get it out of the OTHER class
=> "foo" 
```

# powershell - 用于分叉/运行后台进程的 bash 与号 (&) 等效的 Powershell

> ID：185575
> 
>         
> 
> 赞同：199
> 
>         
> 
> 时间：2008-10-09T01:16:33.287
> 
>         
> 
> 标签：powershell

在 bash 中，与号 (&) 可用于在后台运行命令，并在命令完成运行之前将交互控制返回给用户。在 Powershell 中是否有等效的方法？

bash 中的用法示例：

```
 sleep 30 & 
```

* * *

## 回答 #1

> 赞同：157
> 
>             
> 
> 时间：2012-12-05T17:48:33.290

只要命令是可执行文件或具有关联可执行文件的文件，请使用**Start-Process**（可从 v2 获得）：

```
Start-Process -NoNewWindow ping google.com 
```

您还可以将此作为功能添加到您的个人资料中：

```
function bg() {Start-Process -NoNewWindow @args} 
```

然后调用变为：

```
bg ping google.com 
```

在我看来，Start-Job 对于在后台运行进程的简单用例来说是一种过度杀伤：

1.  Start-Job 无权访问您现有的范围（因为它在单独的会话中运行）。您不能执行“Start-Job {notepad $myfile}”

2.  Start-Job 不保留当前目录（因为它在单独的会话中运行）。您不能在 myfile.txt 位于当前目录中的情况下执行“Start-Job {notepad myfile.txt}”。

3.  输出不会自动显示。您需要以作业 ID 作为参数运行 Receive-Job。

注意：关于您的初始示例，“bg sleep 30”将不起作用，因为 sleep 是 Powershell 命令行开关。Start-Process 仅在您实际分叉一个进程时才有效。

* * *

## 回答 #2

> 赞同：41
> 
>             
> 
> 时间：2018-12-22T00:18:40.473

从 PowerShell Core 6.0 开始，您可以`&`在命令结束时进行编写，这相当于**在当前工作目录的后台**运行您的管道。

它不等同`&`于 bash，它只是当前 PowerShell[作业](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_jobs?view=powershell-6)功能的一种更好的语法。它返回一个作业对象，因此您可以使用您将用于作业的所有其他命令。例如`Receive-Job`：

```
C:\utils> ping google.com &

Id     Name            PSJobTypeName   State         HasMoreData     Location             Command
--     ----            -------------   -----         -----------     --------             -------
35     Job35           BackgroundJob   Running       True            localhost            Microsoft.PowerShell.M...

C:\utils> Receive-Job 35

Pinging google.com [172.217.16.14] with 32 bytes of data:
Reply from 172.217.16.14: bytes=32 time=11ms TTL=55
Reply from 172.217.16.14: bytes=32 time=11ms TTL=55
Reply from 172.217.16.14: bytes=32 time=10ms TTL=55
Reply from 172.217.16.14: bytes=32 time=10ms TTL=55

Ping statistics for 172.217.16.14:
    Packets: Sent = 4, Received = 4, Lost = 0 (0% loss),
Approximate round trip times in milli-seconds:
    Minimum = 10ms, Maximum = 11ms, Average = 10ms
C:\utils> 
```

如果你想在后台执行几个语句，你可以结合[`&`调用运算符](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_operators?view=powershell-6#call-operator-)、[`{ }`脚本块](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_script_blocks?view=powershell-6)和这个新的[`&`后台运算符](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_operators?view=powershell-6#background-operator-)，如下所示：

```
& { cd .\SomeDir\; .\SomeLongRunningOperation.bat; cd ..; } & 
```

* * *

以下是来自文档页面的更多信息：

来自[*PowerShell Core 6.0 中的新增功能*](https://docs.microsoft.com/en-us/powershell/scripting/whats-new/what-s-new-in-powershell-core-60?view=powershell-6#support-backgrounding-of-pipelines-with-ampersand--3360)：

> **支持使用＆符号 (&) 对管道进行后台处理 (#3360)**
> 
>   
>   
> 
> 放在`&`管道的末尾会导致管道作为 PowerShell 作业运行。当管道在后台运行时，将返回一个作业对象。一旦管道作为作业运行，所有标准`*-Job`cmdlet 都可用于管理作业。管道中使用的变量（忽略特定于流程的变量）会自动复制到作业中，因此`Copy-Item $foo $bar &`可以正常工作。该作业也在当前目录而不是用户的主目录中运行。有关 PowerShell 作业的详细信息，请参阅[about_Jobs](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_jobs?view=powershell-6)。

来自[*about_operators / & 号背景运算符 &*](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_operators?view=powershell-6#ampersand-background-operator-)：

> **& 后台运算符 &**
> 
>   
>   
> 
> 在 PowerShell 作业中运行管道之前的管道。& 号后台操作符的行为类似于 UNIX“& 号操作符”，后者以后台进程的形式运行之前的命令。& 号后台运算符构建在 PowerShell 作业之上，因此它与`Start-Job`. 以下命令包含 & 后台运算符的基本用法。
> 
> ```
> Get-Process -Name pwsh & 
> ```
> 
>   
>   
> 
> 这在功能上等同于`Start-Job`.
> 
>   
>   
> 
> `Start-Job -ScriptBlock {Get-Process -Name pwsh}`
> 
>   
>   
> 
> 由于它在功能上等同于 using `Start-Job`，因此 & 号背景运算符返回一个`Job`对象，就像`Start-Job does`. 这意味着您可以使用`Receive-Job`，`Remove-Job`就像您曾经`Start-Job`开始工作时一样。
> 
> ```
> $job = Get-Process -Name pwsh &
> Receive-Job $job 
> ```
> 
>   
>   
> 
> 输出
> 
> ```
> NPM(K)    PM(M)      WS(M)     CPU(s)      Id  SI ProcessName
> ------    -----      -----     ------      --  -- -----------
>     0     0.00     221.16      25.90    6988 988 pwsh
>     0     0.00     140.12      29.87   14845 845 pwsh
>     0     0.00      85.51       0.91   19639 988 pwsh
> 
> $job = Get-Process -Name pwsh &
> Remove-Job $job 
> ```
> 
>   
>   
> 
> 有关 PowerShell 作业的详细信息，请参阅[about_Jobs](https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/about/about_jobs?view=powershell-6)。

* * *

## 回答 #3

> 赞同：31
> 
>             
> 
> 时间：2012-07-07T06:19:39.210

似乎传递给的脚本块`Start-Job`未使用与命令相同的当前目录`Start-Job`执行，因此请确保在需要时指定完全限定的路径。

例如：

```
Start-Job { C:\absolute\path\to\command.exe --afileparameter C:\absolute\path\to\file.txt } 
```

* * *

## 回答 #4

> 赞同：23
> 
>             
> 
> 时间：2011-06-23T19:42:38.747

```
ps2> start-job {start-sleep 20} 
```

我还没有弄清楚如何实时获取标准输出，开始工作需要你用 get-job 轮询标准输出

更新：我无法开始工作来轻松地做我想做的事，这基本上是 bash & 运算符。到目前为止，这是我最好的 hack

```
PS> notepad $profile #edit init script -- added these lines
function beep { write-host `a }
function ajp { start powershell {ant java-platform|out-null;beep} } #new window, stderr only, beep when done
function acjp { start powershell {ant clean java-platform|out-null;beep} }
PS> . $profile #re-load profile script
PS> ajp 
```

* * *

## 回答 #5

> 赞同：22
> 
>             
> 
> 时间：2016-11-09T09:13:38.547

您可以使用 PowerShell 作业 cmdlet 来实现您的目标。

PowerShell 中有 6 个与作业相关的 cmdlet。

*   找工作

    *   获取在当前会话中运行的 Windows PowerShell 后台作业

*   接收工作

    *   获取当前会话中 Windows PowerShell 后台作业的结果

*   删除作业

    *   删除 Windows PowerShell 后台作业

*   开始工作

    *   启动 Windows PowerShell 后台作业

*   停工

    *   停止 Windows PowerShell 后台作业

*   等待工作

    *   禁止命令提示符，直到会话中运行的一个或所有 Windows PowerShell 后台作业完成

如果对此感兴趣，您可以下载示例[如何在 PowerShell 中创建后台作业](https://gallery.technet.microsoft.com/How-to-create-background-b2a6a8ee)

* * *

## 回答 #6

> 赞同：6
> 
>             
> 
> 时间：2019-07-10T03:32:02.583

你可以做这样的事情。  

```
$a = start-process -NoNewWindow powershell {timeout 10; 'done'} -PassThru 
```

如果你想等待它：

```
$a | wait-process 
```

奖励 osx 或 linux 版本：

```
$a = start-process pwsh '-c',{start-sleep 5; 'done'} -PassThru 
```

我有示例 pinger 脚本。args 作为数组传递：

```
$1 = start -n powershell pinger,comp001 -pa 
```

* * *

## 回答 #7

> 赞同：4
> 
>             
> 
> 时间：2019-09-05T15:09:19.523

tl;博士

```
Start-Process powershell { sleep 30 } 
```

* * *

## 回答 #8

> 赞同：-1
> 
>             
> 
> 时间：2008-10-09T10:55:04.697

我已经在 PowerShell v1.0 中成功使用了这里描述的解决方案[http://jtruher.spaces.live.com/blog/cns!7143DA6E51A2628D!130.entry 。](http://jtruher.spaces.live.com/blog/cns!7143DA6E51A2628D!130.entry)在 PowerShell v2.0 中肯定会更容易。

# parsing - 动态 (?) 解析器

> ID：185584
> 
>         
> 
> 赞同：7
> 
>         
> 
> 时间：2008-10-09T01:21:10.330
> 
>         
> 
> 标签：parsing, compiler-construction, interpreter, lex

是否存在在运行时生成 AST/解析树的解析器？有点像一个库，可以接受一串 EBNF 语法或类似的东西并吐出一个数据结构？

*   我知道 antlr、jlex 和他们的同类。他们生成可以做到这一点的源代码。（喜欢跳过编译步骤）

*   我知道 Boost::Spirit，它使用一些带有 C++ 语法的黑魔法在执行时生成这样的东西（肯定更接近我想要的，但在 C++ 方面我是个无赖。而且它仍然有点限制，因为你的语法是硬编码的）

*   我不知道 python 或 ruby​​ 中的任何内容，尽管编译器编译器在这种语言中可能非常有效......

现在我知道解析器组合器了。（谢谢，乔纳斯）还有一些图书馆（谢谢 eliben）

顺便说一句，我最近还注意到[Parsing Expression Grammars](http://en.wikipedia.org/wiki/Parsing_expression_grammar)，如果有人实现它听起来很酷（他们说 Perl 6 会有它，但 Perl 回避了我的理解）

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2008-10-14T12:58:52.263

看看我认为可能对你有帮助的[解析器组合器。](http://en.wikipedia.org/wiki/Parser_Combinator)可以使用这种技术在运行时制作解析器。一种流行的解析器组合器是[Parsec](http://legacy.cs.uu.nl/daan/parsec.html)，它使用[Haskell](http://www.haskell.org)作为其宿主语言。从[parsec 文档](http://legacy.cs.uu.nl/daan/download/parsec/parsec.html)中：

> 组合解析器是在与程序其余部分相同的编程语言中编写和使用的。语法形式主义 (Yacc) 和实际使用的编程语言 (C) 之间没有差距
> 
> 解析器是语言中的一流值。它们可以放入列表中，作为参数传递并作为值返回。使用针对特定问题的定制解析器很容易扩展可用的解析器集

如果您使用的是 .NET，请查看[F# 的解析器组合库](http://www.quanttec.com/fparsec/)。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2008-12-02T17:01:19.383

如果 Java 更适合您，可以使用 Haskell Parsec 库的一个端口 - [JParsec](http://jparsec.codehaus.org/)。非常强大，虽然文档不是很好。

您可以强制它执行直接的 lex 然后解析阶段，但您可以使用动态词法分析和动态语法做一些有趣的事情。

扭头的东西。

因为这一切都在 Java 中（您的 Parser 是 POJO），所以您可以重构和执行 TDD，以及您习惯在 Java 中执行的任何操作。这是更传统的 ANTLR/JavaCC/JJTree 方法的主要优势。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2008-10-09T02:02:47.860

Lambda the Ultimate 讨论了一个[允许语法扩展的解析器](http://lambda-the-ultimate.org/node/1718)。

> 我计划编写一个允许语法扩展（某种编译时元编程）的编译器。我不想拥有一个非常强大的系统，所以我考虑过：
> 
> ```
> {syntax: while (condition) do code}
> while (condition, code) => // actual execution 
> ```
> 
>   
>   
> 
> 并用对函数的调用替换与语法匹配的每个模式。但是，我不知道从哪里开始运行词法分析器和解析器，因为通常的工具，如 Flex/Bison 或 ANTLR（我想用 C# 编写编译器）似乎不允许这样做。
> 
>   
>   
> 
> 你能告诉我下一步该去哪里吗？我还读过 Scheme 或 Haskell 可能是更好的语言来完成这项任务。当然，我愿意接受有关实施它们的实际想法的任何建议。

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2008-10-09T06:03:31.990

是的当然 ！

在所有动态语言中，这很容易实现，因为可以在运行时轻松生成和评估代码。我将推荐两种选择：

*   在 Perl 中，使用 Parse::RecDescent。它从字符串中获取语法，您绝对可以要求它在运行时从新字符串生成新的解析器。

*   在 Python 中，考虑 PLY。您可以在运行时轻松生成带有文档字符串的函数并在其上运行 PLY。

我个人推荐使用 Python 选项，尽管如果您了解 Perl 但不了解 Python，它可能无关紧要。

为了完整起见，我必须注意，您也可以使用 Lex 和 Yacc 来完成，但它很麻烦。您必须在运行时从您的语法生成 Lex / Yacc 文件，编译成 C，将其编译成共享库并在运行时加载它。这听起来像科幻小说，但有些工具实际上是为了满足效率和动态性的复杂需求而这样做的。

祝你好运。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T14:00:08.970

[JFlex](http://www.jflex.de)是 JLex Java 扩展，可让您进行运行时编译，但它非常麻烦。

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2008-10-14T14:18:41.463

你要解析什么？在 C 或 C++ 中，您不会在运行时拥有解析器，因此如果没有额外的库，它就无法使用。但对于许多编程语言来说，这是真的。

默认情况下，所有解析器在您实现它们时都是“动态的”。即使在 C.

如果您要解析的语言是您自己的：编写解析器是一门自学的事情。即使使用解析器生成器，它本身也是一项工作。不过在你学会它之后，它会变得非常简单。不过，像缩进语法这样的特殊技巧仍然很棘手，您将需要进行良好而广泛的测试，以查看解析器是否符合您的要求。[我写了一个解析器，所以我知道。](http://freehg.org/u/cheery/fml/)

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2012-08-04T13:02:28.520

[Dropincc.java] [http://pfmiles.github.com/blog/dropincc-dot-java-the-ultimate-tool-to-create-dsls-in-java/](http://pfmiles.github.com/blog/dropincc-dot-java-the-ultimate-tool-to-create-dsls-in-java/) "Dropincc.java 是纯java中的动态解析器​​生成器”。

这使您可以在 java 编程语言中定义语法规则，并且无需学习其他符号。无需使用其他命令行工具。您可以在纯 java 中定义、编译和“评估”您新定义的语言。

查看那里的链接以获取更多信息。

[项目主页] [https://github.com/pfmiles/dropincc.java](https://github.com/pfmiles/dropincc.java)

# java - 了解“找不到符号”错误

> ID：185591
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2008-10-09T01:27:06.917
> 
>         
> 
> 标签：java

这是什么错误？

```
cannot find symbol, symbol: method getstring(java.lang.String) 
Location: class InternalFrameDemo 
if <!windowTitleField.getText().equals(getstring("InternalFrameDemo.frame_label"))) 
```

* * *

## 回答 #1

> 赞同：11
> 
>             
> 
> 时间：2008-10-09T01:32:01.493

Java 区分大小写。因为“getstring”不等于“getString”，编译器认为“getstring”方法在InternalFrameDemo 类中不存在并抛出该错误。

在 Java 中，方法通常会将每个单词的第一个字母在第一个单词之后大写（例如 toString()、toUpperCase() 等），类将使用大写[驼峰式大小写](http://en.wikipedia.org/wiki/CamelCase)（例如 ClassName、String、StringBuilder），常量将是全部大写（例如 MAX_VALUE）

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T01:28:39.817

这意味着 InternalFrameDemo 类没有 getstring() 方法——不应该是带有大写“S”的“getString”吗？

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T01:29:44.633

也许是说 InteranlFrameDemo 中没有一个名为 getstring 的方法，它接受 String 参数。该方法可能应该是 getString("mystring") 吗？

方法名称在 java 中区分大小写，这就是我猜测的原因

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T01:30:39.717

也许 getstring() 应该是 getString()？

基本上是说 InternalFrameDemo 没有 getstring() 方法。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T01:39:13.880

只是因为 Java 区分大小写。尝试使用 getString() 而不是 getstring()。Java 通常使用 Camel 表示法。

# java - 数组的 Java 泛型语法

> ID：185594
> 
>         
> 
> 赞同：16
> 
>         
> 
> 时间：2008-10-09T01:27:33.810
> 
>         
> 
> 标签：java, generics, syntax, types

以下声明指定了什么数据结构？

```
 List<ArrayList>[] myArray; 
```

我认为它应该声明一个数组，其中每个元素都是 a `List`（例如， a`LinkedList`或 an `ArrayList`）并要求每个元素都`List`包含`ArrayList`对象。

我的推理：

```
 List<String> someList;             // A List of String objects
 List<ArrayList> someList;         // A List of ArrayList objects
 List<ArrayList>[] someListArray;  // An array of List of ArrayList objects 
```

在运行了一些测试之后，我确定它接受一个数组，其中每个元素都是一个`LinkedList`对象，并且没有指定 LinkedList 对象包含的内容。

所以`List<ArrayList>`指定了`List`必须包含的内容，但`List<ArrayList>[]`指定了`List`必须如何实现。

我错过了什么吗？

这是我的测试。

```
import java.util.ArrayList;
import java.util.List;
import java.util.LinkedList;

public class Generics1 {

    public static void main(String[] args) {

        List<ArrayList>[] someListArray;

        someListArray = getArrayWhereEachElementIsAnArrayListObject();
        // Why does this satisfy the declaration?
        //someListArray[0] => ArrayList object holding Strings

        someListArray= getArrayWhereEachElementIsAListOfArrayListObjects();
        //someListArray[0] => ArrayList object holding ArrayList objects

    }

    public static List[] getArrayWhereEachElementIsAnArrayListObject() {
        List[] arrayOfLists = new ArrayList[2];
        arrayOfLists[0] = getStringList();
        arrayOfLists[1] = getIntegerList();
        return arrayOfLists;
    }

  public static List[] getArrayWhereEachElementIsAListOfArrayListObjects() {   

        List list1 = new ArrayList();
        list1.add(getArrayList());

        List list2 = new ArrayList();
        list2.add(getArrayList());

        List[] arrayOfListsOfArrayLists = new ArrayList[2];
        arrayOfListsOfArrayLists[0] = list1;
        arrayOfListsOfArrayLists[1] = list2;
        return arrayOfListsOfArrayLists;
    }

    public static List getStringList() {
        List stringList= new ArrayList();
        stringList.add("one");
        stringList.add("two");
        return stringList;
    }

    public static List getIntegerList() {
        List intList= new ArrayList();
        intList.add(new Integer(1));
        intList.add(new Integer(2));
        return intList;
    }

    public static ArrayList getArrayList() {
        ArrayList arrayList = new ArrayList() ;
        return arrayList;
    }
} 
```

* * *

## 回答 #1

> 赞同：17
> 
>             
> 
> 时间：2008-10-09T13:37:26.317

答案是数组只能保存具体类型。并且泛型类没有具体化。也就是说，List<ArrayList> 的运行时“类型”只是 List。泛型在运行时被擦除（谷歌“擦除墙”更多）。  

所以这：       

```
List<ArrayList>[] myArray 
```

真正意思：  

```
List[] myArray 
```

没有类型安全的方法来声明您要声明的内容。通常，在这种情况下，我建议您使用 List 而不是数组。有些人甚至建议既然我们有泛型，就应该将数组视为已弃用的类型。我不能说我愿意走那么远，但是当你被一个数组吸引时，你应该考虑一个集合是否是一个更好的选择。

Naftalin 和 Wadler所著的[Java Generics and Collections](https://rads.stackoverflow.com/amzn/click/com/0596527756)一书对于您可能遇到的有关泛型的问题是一本极好的参考书。或者，当然，[泛型常见问题解答](http://www.angelikalanger.com/GenericsFAQ/JavaGenericsFAQ.html)是您的规范在线参考。

* * *

## 回答 #2

> 赞同：8
> 
>             
> 
> 时间：2008-10-09T01:40:58.793

乔什·布洛赫先生说：

> “更喜欢列表而不是数组，因为数组是协变的，而泛型是不变的”

你也许可以这样做：

```
List<List<ArrayList>> someListArray; 
```

这可能会给性能带来一些影响（我敢打赌甚至不会引起注意），但您会在编译时获得更好的类型安全性。

但我认为问题应该更多地围绕“为什么”你需要这个？

* * *

## 回答 #3

> 赞同：5
> 
>             
> 
> 时间：2008-10-09T01:44:42.013

```
List<ArrayList>[] someListArray; 
```

给你一个：

```
array of ( List of ArrayList ) 
```

但是由于 Java 泛型的限制（错误[6229728](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6229728)），您只能实际创建：

```
array of List 
```

并投射它：

```
List<ArrayList>[] someListArray = (List<ArrayList>[]) new List[5]; 
```

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T01:49:29.600

你说得对：

> 在运行了一些测试之后，我确定声明意味着一个数组，其中每个元素都是一个 ArrayList 对象。

执行此代码

```
List<ArrayList>[] myArray  = new ArrayList[2];

myArray[0] = new ArrayList<String>();
myArray[0].add("test 1");

myArray[1] = new ArrayList<String>();
myArray[1].add("test 2");

print myArray; 
```

产生这个结果：

```
{["test 1"], ["test 2"]} 
```

在我看来，没有理由不这样做：

```
List<ArrayList> myArray  = new ArrayList<ArrayList>(); 
```

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T02:47:19.407

List 是一个能够保存 ArrayList 对象的 List List [] 是一个此类 List 的数组

因此，您所说的是（ArrayList 对象的列表）的数组是正确的。

你能分享你的测试是什么。我自己的测试不一样

```
import java.util.*;

public class TestList {
    public static void main(String ... args) {
        class MySpecialLinkedList extends LinkedList<ArrayList<Integer>> {
            MySpecialLinkedList() {

            }

            public void foo() {

            }

            public Object clone()
            {
                return super.clone();
            }
        }

        List<ArrayList<Integer>> [] someListArray = new MySpecialLinkedList[10];
        for (int i = 0; i < 10; ++i) {
            someListArray[i] = new LinkedList<ArrayList<Integer>>();
            for (int j = 0; j < 20; ++j) {
                someListArray[i].add(new ArrayList<Integer>());
                for (int k = 0; k < 30; ++k) {
                    someListArray[i].get(j).add(j);
                }
            }
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T03:16:23.297

在运行了一些额外的测试之后，我想我有了答案。

List<ArrayList>[] 确实指定了一个数组，其中每个元素都是 ArrayList 对象的列表。

编译如下所示的代码揭示了为什么我的第一个测试允许我使用一个数组，其中每个元素都是一个列表。在填充数组的方法中使用返回类型 List[] 和 List 没有为编译器提供足够的信息来禁止分配。但是编译器确实发出了关于歧义的警告。

从编译器的角度来看，返回 List[] 的方法可能返回 List<ArrayList> （满足声明），也可能不返回。同样，返回 List 的方法可能会也可能不会返回 ArrayList。

这是编译器输出：

javac Generics2.java -Xlint：未选中

```
Generics2.java:12：警告：[unchecked] 未经检查的转换
找到：java.util.List[]
必需：java.util.List<java.util.ArrayList>[]
        someListArray = getArrayWhereEachElementIsALinkedListObject();
                                                                   ^
Generics2.java:16：警告：[未选中] 未选中的转换
找到：java.util.List[]
必需：java.util.List<java.util.ArrayList>[]
        someListArray= getArrayWhereEachElementIsAListOfLinkedListObjects();

```

这是我的测试。

```
导入 java.util.ArrayList；
导入 java.util.List；
导入 java.util.LinkedList；

公共类泛型2 {

    公共静态无效主要（字符串[]参数）{

        List<ArrayList>[] someListArray;

        someListArray = getArrayWhereEachElementIsALinkedListObject();
        // 为什么这满足声明？
        //someListArray[0] => LinkedList 对象持有字符串

        someListArray= getArrayWhereEachElementIsAListOfLinkedListObjects();
        //someListArray[0] => LinkedList 对象持有 LinkedList 对象

    }

    公共静态列表 [] getArrayWhereEachElementIsALinkedListObject() {
        List[] arrayOfLists = new LinkedList[2];
        arrayOfLists[0] = getStringLinkedListAsList();
        arrayOfLists[1] = getIntegerLinkedListAsList();
        返回数组列表；
    }

  公共静态列表 [] getArrayWhereEachElementIsAListOfLinkedListObjects() {

        列表 list1 = new LinkedList();
        list1.add(new LinkedList());

        列表 list2 = new LinkedList();
        list2.add(new LinkedList());

        List[] arrayOfListsOfLinkedLists = new LinkedList[2];
        arrayOfListsOfLinkedLists[0] = list1;
        arrayOfListsOfLinkedLists[1] = list2;
        返回arrayOfListsOfLinkedLists；
    }

    公共静态列表 getStringLinkedListAsList() {
        列表 stringList= new LinkedList();
        stringList.add("one");
        stringList.add("两个");
        返回字符串列表；
    }

    公共静态列表 getIntegerLinkedListAsList() {
        列表 intList=new LinkedList();
        intList.add(新整数(1));
        intList.add(新整数(2));
        返回整数列表；
    }

}

```

# sql - 如何构建数据以实现可搜索性

> ID：185597
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2008-10-09T01:28:43.963
> 
>         
> 
> 标签：sql, mysql, search, full-text-search, search-engine

我正在为音乐播放列表编写一个搜索应用程序。

流派和文件格式因播放列表而异，有时在播放列表中也存在差异。还有一个“同义词”标签的概念（例如，urban 将涵盖 hiphop 和 r&b，但反之则不然）。

以下是搜索词列表和我的预期结果。

福音：应该返回至少包含一首福音歌曲的所有播放列表。包含所有福音歌曲的播放列表将首先显示。urban：应该返回所有的 r&b 和 hiphop。再次将所有城市曲目的播放列表排在第一位。hiphop：应该返回所有 hiphop 但不返回 r&b。flac：应该返回所有包含 flac 文件的播放列表。从纯flac的开始。hiphop flac：应该首先返回 hiphop flac，然后是其他 hiphop 音频 hiphop AND flac：应该只返回 hiphop flac 嘻哈音频：应该返回 hiphop flac、hiphop mp3 等

当我刚刚开始这个项目时，我正在考虑索引所有这些的最佳方法。像 Lucene 这样的全文搜索在这里有用吗？注意我没有任何描述这些播放列表的文本，但我可以生成一些。

我正在考虑将所有这些术语组织为“标签”并将它们存储在多对多的数据库中。

表：播放列表（pk（id），desc）表：标签（pk（id），desc）表：playlist_has_tag（pk（link_id，tag_id））

解决都市==嘻哈|| rnb 的事情，我可能会添加一个 tag_synonyms 表：

表：tag_synonyms ( pk(tag_id, synonym_tag_id) )

然后我有两条记录表明urban包含hiphop和rnb：urban的tag id，hiphop的tag id urban的tag id，rnb的tag id

我觉得虽然使用这种方法查询可能会变得非常复杂。

CouchDB 可以在这里使用吗？我目前正在使用 PostgreSQL。是否有一些软件可以使这种事情变得容易？

我希望将来能够深入研究并支持复杂的搜索词，例如：

（嘻哈或房子）和文件类型：mp3 和艺术品：没有

并且还包含持续时间等内容。

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T01:50:19.427

如果您试图在如何构建数据以进行搜索方面考虑太多，那么您很有可能会错过您本可以在您的应用程序中真正使用的重要搜索。

或者（这是根据经验）您最终会重新发明各种索引技术。

我对 lucene 有一些经验（有 java 和 .net 版本，有一个 C 端口，但我不确定它现在有多活跃）——它可以用存储在任何结构中的数据做惊人的事情。

我喜欢 couch db 的外观，这取决于你想尝试多少新的和强大的东西，或者选择（目前）相当坚固的东西：lucene。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-10-12T20:14:35.787

如果您的用户将成为定义查询的人，那么全文索引将为您提供最佳服务。只需创建一个自定义文本字段来描述您希望可搜索的每个属性，例如“城市文件类型：pdf 福音”并进行搜索。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T13:17:48.200

好吧，就在这里集思广益——

也许使用八进制或二进制将您的“格式”类型存储为位掩码？

[http://www.nitrogen.za.org/viewtutorial.asp?id=17](http://www.nitrogen.za.org/viewtutorial.asp?id=17)

RandB：1 HipHop：2 Gospel：4 Urban：8

现在，这些东西是附加的。您知道，如果某物被标记为 Urban，您不会在标志字段中存储“8”，但您将存储 11...Urban && HipHop && RandB。这只是您必须在某处说明的一点“商业智能”。

然后，您可以使用二进制比较来确定您正在寻找哪些标志。

* * *

## 回答 #4

> 赞同：-1
> 
>             
> 
> 时间：2008-10-09T01:55:15.283

我看不出数据库软件将如何在您的解决方案中发挥作用。

如果我是实现这一点的人，我会首先确保以标准化方式捕获所有相关数据。这将包括类别、艺术作品、歌词等。

这样做的主要优点是您对“复杂”搜索的想法实际上变得非常简单。

# php - 在单行中将数组插入数据库

> ID：185606
> 
>         
> 
> 赞同：8
> 
>         
> 
> 时间：2008-10-09T01:32:31.600
> 
>         
> 
> 标签：php, mysql, database, arrays, internationalization

我想知道这是否可行？将数组插入数据库中的一个字段。

例如，我有一个标题，我希望该标题只有一个 id，但它将在网站上以双语形式使用。

感觉有点没必要让另一个表有它们的全局 ID，然后另一个表的实际标题链接到具有全局 ID 的表。

我只想拥有这样的东西

```
ID      TITLE
1       Array("english title", "nederlandse titel"); 
```

我正在使用 PHP/MSYQL，所以如果可行，请用这些语言解释一下。

哦，是的，我想我可以将其格式化并使用 split 函数再次将其转换为数组。但我想知道我是否可以立即将它存储为一个数组，我认为用户可能会键入具有相同格式的内容（百万分之一）

* * *

## 回答 #1

> 赞同：15
> 
>             
> 
> 时间：2008-10-09T01:43:59.567

这是可行的：

```
$title = serialize($array); 
```

然后解码：

```
$title = unserialize($mysql_data); 
```

但如前所述，它确实首先减少了数据库的好处。我肯定会建议研究多表或多列选项，具体取决于您要支持的语言数量以及该数字将来是否会改变。

**编辑：**[dcousineau](https://stackoverflow.com/users/20265/dcousineau)提到的一个好点（见评论）

> 有时，即使在转义之后，序列化的输出也会将字符放入查询中，从而搞砸事情。您可能希望将您的 serialize() 包装在 base64_encode() 调用中，然后在反序列化之前使用 base64_decode()。

针对这些情况调整代码：

```
$title = base64_encode(serialize($array) );
$title = unserialize(base64_decode($mysql_data) ); 
```

* * *

## 回答 #2

> 赞同：6
> 
>             
> 
> 时间：2008-10-09T01:39:34.147

这里实际上只有两个合理的选择：

**加入另一个表**

优点：无限语言的无限标题

缺点：连接开销在计算上更昂贵，SQL 更新/插入等稍微复杂一些

**多列**

，例如：TITLE_EN、TITLE_NL、TITLE_DE

优点：插入、选择等速度快

缺点：语言数量有限，添加更多是 ALTER TABLE

鉴于我们有两个选择，您通常应该选择第一个。除非您只处理大量无法并行化的事务，或者您绝对可以确保永远不会添加语言，否则模式布局的额外灵活性从长远来看将为您省去麻烦。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T01:50:43.373

数组确实违反了规范化；根据我对国际化数据库的经验，我发现将短语标准化是最好的设计，

我允许您轻松地批量复制行 - 例如“es”到“es-mx”或“en”到“en-US”、“en-GB”和我最喜欢的：“xx-piglatin”。在数组模式中，您要么必须重写每条记录，要么添加复杂的解析，或者使用比数组更复杂的东西，比如 XML。

`LEFT JOIN`使用s 来查找工作中未翻译的短语相对容易，也可`COALESCE`用于返回默认值，因此即使短语未翻译，程序仍然可用。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T19:01:11.187

使用有 3 列的表格！

ID、TITLE_EN、TITLE_NL

没有充分的理由对其进行序列化，真的！

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2021-09-01T21:22:32.620

有 JSON 数据类型，它也将存储“数组”。

[https://dev.mysql.com/doc/refman/8.0/en/json.html](https://dev.mysql.com/doc/refman/8.0/en/json.html)

# asp.net - page Preinit, Init, load

> ID：185609
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2008-10-09T01:35:01.940
> 
>         
> 
> 标签：asp.net

I am having a doubt in page_init, page preinit, load.
I need to know when we use this also where we need to call our objects in different stages of our life cycle.

Please let me know how they will process for each events raised

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2008-10-09T01:53:13.337

Its called the Page lifecycle because at different stages of the page request, different objects are populated with different information.

Here are some good links to read up on:

[http://msdn.microsoft.com/en-us/library/ms178472.aspx](http://msdn.microsoft.com/en-us/library/ms178472.aspx)

[http://www.15seconds.com/issue/020102.htm](http://www.15seconds.com/issue/020102.htm)

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2008-10-09T02:36:10.973

Page events happen first before user control events. So the pages PageInit event fires, then the all user controls PageInit events fire. The pages PageLoad event fires, then all user controls PageLoad events fire. etc...

Sometimes developers will put initialization of private objects in their user controls PageLoad handler. 

A common gotcha then occurs if the pages PageLoad handler calls a user control method which makes use of uninitialized private objects. Since the user controls PageLoad event hasn't fired yet, those objects are still "null" and an exception is throw (Object not set to instance of Object).

I then typically use the PageInit handler to initialize internal objects within a user control. That way they are not "null" when the public methods that use them are called. 

This technique works if you don't call any user control methods from the pages PageInit handler. In my opinion, you shouldn't, though. That is not what handling PageInit in the pages code is for. Use the pages PageLoad handler for user control method calls.

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T12:45:55.360

You will probably find yourself using OnInit and Load. Differences is mostly in viewstate deserialisation event, which happens after OnInit, so you cannot read values from controls in OnInit.
Also, in OnInit you can (must) dynamically add new controls to page.

All other things, like filling grids and reading from form fields (textbox, dropdowns,...) goes in Load event.

# oracle - SharePoint 和企业库 4.0

> ID：185621
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-10-09T01:41:41.257
> 
>         
> 
> 标签：oracle, sharepoint, enterprise-library

是否有人成功地将 Enterprise Library v4.0 与 SharePoint WSS 3.0 集成？我创建了一个非常简单的 .ASPX 页面。它的唯一目的是连接到 Oracle 数据库并在 DropDownList 中显示一些值。但现在，它所做的只是显示 Hello World。我已经添加了必要的参考，一切都编译得很好。当我测试页面时，它显示 Hello World。但是，一旦我添加了 using Microsoft.Practices.EnterprisesLibrary.Data，该页面就不再起作用了。我只是收到标准的未知错误消息。有我可以检查的日志文件吗？

我正在寻找可用于启动和运行的任何步骤或提示。我在我所有的 ASP.NET 应用程序中都使用了这个企业库，它工作得很好。尝试让它在 SharePoint 中工作似乎是天作之合。但是为什么看起来那么难呢？为什么似乎缺乏信息？

无论如何，非常感谢您提供任何人可以提供的任何信息。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T21:54:18.420

我不确定企业库，但要从 SharePoint 获得比超级信息“未知错误”消息更有意义的错误消息，请在 web.config 中修改一些内容：

1.  在`<SharePoint><SafeMode>`设置 CallStack 属性 = "true"

2.  在`<system.web><compilation>`设置调试属性=“真”

3.  在`<system.web><customErrors>`设置模式属性=“关闭”

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-10-10T12:37:51.013

跟进：我正在开发的应用程序有它自己的 web.config 文件。我不确定这是对还是错。我已经阅读了应该在哪里将 WSS web.config 链接到我的应用程序并删除我的应用程序文件夹中的那个。我试过了，当我这样做时，我收到了一条我从未见过的错误消息。  

因此，我将以下内容添加到本地 web.config

```
 <add assembly="Microsoft.Practices.EnterpriseLibrary.Data, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>
    <add assembly="Microsoft.Practices.EnterpriseLibrary.Common, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/> 
```

上面的错误消失了。我的偏好是使用 WSS 的 web.config。我将继续努力，并希望找到一些有用的东西，以便我可以分享。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-10-10T11:22:14.030

确保将 EntLib 程序集添加到 GAC 并将它们添加到应用程序 web.config 的 SafeControls 部分...

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T02:25:33.523

您是否能够调试并查看代码中发生故障的位置？它是否发生在与企业库相关的调用中？如果是这样，我将捕获正在引发的异常并评估它提供的消息；尝试 {} 捕获（异常前）{}。

我在企业库中看到的一件事是，如果未正确配置它，它有时会将消息记录到服务器上的事件日志中。

很抱歉，如果没有有关您的实施的更多技术细节，我无法获得更多信息。我可以向您保证，企业库与 SharePoint 配合得非常好，而且在过去几年中，我在所有 SharePoint 解决方案工作中都使用了企业库。

# c++ - 内联函数中的静态变量

> ID：185624
> 
>         
> 
> 赞同：91
> 
>         
> 
> 时间：2008-10-09T01:43:08.383
> 
>         
> 
> 标签：c++, header, linker, inline-functions

我有一个在头文件中声明和定义的函数。这本身就是一个问题。当该函数未内联时，使用该标题的每个翻译单元都会获得该函数的副本，并且当它们链接在一起时，就会出现重复。我通过使函数内联来“修复”该问题，但恐怕这是一个脆弱的解决方案，因为据我所知，即使您指定了“内联”关键字，编译器也不保证内联。如果这不是真的，请纠正我。

无论如何，真正的问题是，这个函数中的静态变量会发生什么？我最终得到多少份？

* * *

## 回答 #1

> 赞同：118
> 
>             
> 
> 时间：2008-10-09T20:51:02.370

我猜你在这里遗漏了一些东西。

## 静态函数？

声明一个静态函数将使其在其编译单元中“隐藏”。

> 具有命名空间范围 (3.3.6) 的名称如果是
> 
>   
>   
> 
> — 显式声明为静态的变量、函数或函数模板；
> 
>   
>   
> 
> 3.5/3 - C++14 (n3797)
> 
>   
>   
> 
> 当名称具有内部链接时，它所表示的实体可以由同一翻译单元中其他范围的名称引用。
> 
>   
>   
> 
> 3.5/2 - C++14 (n3797)

如果你在头文件中声明这个静态函数，那么包括这个头文件的所有编译单元都将拥有自己的函数副本。

问题是，如果该函数内有静态变量，则包括此头文件的每个编译单元也将有自己的个人版本。

## 内联函数？

将其声明为 inline 使其成为内联的候选对象（现在在 C++ 中这并不意味着很多，因为编译器会内联或不内联，有时会忽略关键字 inline 存在或不存在的事实）：

> 带有 inline 说明符的函数声明（8.3.5、9.3、11.3）声明了一个内联函数。inline 说明符向实现表明，在调用点对函数体进行内联替换优于通常的函数调用机制。在调用点执行此内联替换不需要实现；然而，即使省略了这个内联替换，7.1.2 中定义的内联函数的其他规则仍应得到遵守。
> 
>   
>   
> 
> 7.1.2/2 - C++14 (n3797)

在头文件中，它有一个有趣的副作用：内联函数可以在同一个模块中定义多次，并且链接器将简单地将“它们”合并为一个（如果由于编译器的原因它们没有被内联）。

对于内部声明的静态变量，标准明确规定有一个，而且只有一个：

> 外部内联函数中的静态局部变量始终引用同一个对象。
> 
>   
>   
> 
> 7.1.2/4 - C++98/C++14 (n3797)

（函数默认为外部函数，因此，除非您特别将函数标记为静态，否则这适用于该函数）

这具有“静态”的优点（即可以在标题中定义）而没有缺陷（如果没有内联，它最多存在一次）

## 静态局部变量？

静态局部变量没有链接（它们不能在其范围之外通过名称引用），但具有静态存储期限（即它是全局的，但其构造和销毁遵循特定规则）。

## 静态+内联？

混合内联和静态将产生您所描述的后果（即使函数是内联的，内部的静态变量也不会，并且您将以编译单元的数量结束，包括静态函数的定义）。

## 回答作者的附加问题

> 自从我写了这个问题后，我就使用 Visual Studio 2008 进行了尝试。我尝试打开所有使 VS 符合标准的选项，但我可能错过了一些。这些是结果：
> 
>   
>   
> 
> 当函数只是“内联”时，静态变量只有一份副本。
> 
>   
>   
> 
> 当函数是“静态内联”时，有多少个翻译单元就有多少个副本。
> 
>   
>   
> 
> 现在真正的问题是事情是否应该这样，或者这是否是 Microsoft C++ 编译器的特性。

所以我想你有这样的事情：

```
void doSomething()
{
   static int value ;
} 
```

您必须意识到，函数内部的静态变量，简单地说，一个全局变量，除了函数的作用域外，其他所有变量都隐藏，这意味着只有在函数内部声明的函数才能访问它。

内联函数不会改变任何东西：

```
inline void doSomething()
{
   static int value ;
} 
```

只有一个隐藏的全局变量。编译器将尝试内联代码这一事实不会改变只有一个全局隐藏变量的事实。

现在，如果你的函数被声明为静态的：

```
static void doSomething()
{
   static int value ;
} 
```

然后它对于每个编译单元都是“私有的”，这意味着每个 CPP 文件，包括声明静态函数的头文件，都将拥有它自己的函数私有副本，包括它自己的全局隐藏变量的私有副本，因此变量数量与有包括标题在内的编译单元。

将“内联”添加到内部带有“静态”变量的“静态”函数：

```
inline static void doSomething()
{
   static int value ;
} 
```

就内部的静态变量而言，与不添加此“内联”关键字具有相同的结果。

**所以VC++的行为是正确的，你误会了“内联”和“静态”的真正含义。**

* * *

## 回答 #2

> 赞同：43
> 
>             
> 
> 时间：2008-10-09T02:35:58.853

我相信编译器会创建变量的许多副本，但链接器会选择一个并让所有其他人引用它。当我尝试创建不同版本的内联函数时，我得到了类似的结果。如果该函数实际上没有内联（调试模式），则所有调用都会转到同一个函数，而不管它们是从哪个源文件调用的。

像编译器一样思考一下——不然怎么可能呢？每个编译单元（源文件）相互独立，可以单独编译；因此，每个人都必须创建一个变量的副本，认为它是唯一的一个。链接器能够跨越这些边界并调整变量和函数的引用。

* * *

## 回答 #3

> 赞同：12
> 
>             
> 
> 时间：2009-09-05T22:27:13.483

我发现 Mark Ransom 的回答很有帮助 - 编译器创建了静态变量的许多副本，但链接器选择一个并在所有翻译单元中强制执行它。

在其他地方我发现了这个：

**见 [dcl.fct.spec]/4**

> [..] 具有外部链接的内联函数在所有翻译单元中应具有相同的地址。外部内联函数中的静态局部变量始终引用同一个对象。外部内联函数中的字符串文字是不同翻译单元中的相同对象。

我没有要检查的标准副本，但它与我在 VS Express 2008 中检查程序集的经验相符

* * *

## 回答 #4

> 赞同：7
> 
>             
> 
> 时间：2008-10-09T02:33:24.410

应该是这样的。“static”告诉编译器您希望函数在编译单元中是本地的，因此您希望每个编译单元一份副本，每个函数实例一份静态变量的副本。

"inline" 用来告诉编译器你希望函数被内联；现在，它只是认为“如果有多个代码副本就可以，只要确保它是相同的功能”。所以每个人都共享静态变量。

注意：此答案是针对原始发布者发布给自己的答案而写的。

* * *

## 回答 #5

> 赞同：3
> 
>             
> 
> 时间：2008-10-09T02:19:25.390

自从我写了这个问题后，我就使用 Visual Studio 2008 进行了尝试。我尝试打开所有使 VS 符合标准的选项，但我可能错过了一些。这些是结果：

当函数只是“内联”时，静态变量只有一份副本。

当函数是“静态内联”时，有多少个翻译单元就有多少个副本。

现在真正的问题是事情是否应该是这样，或者这是否是 Microsoft C++ 编译器的特质。

* * *

## 回答 #6

> 赞同：-1
> 
>             
> 
> 时间：2008-10-09T01:51:32.233

内联意味着可执行代码（指令）被内联到调用函数的代码中。无论您是否要求，编译器都可以选择这样做。这对函数中声明的变量（数据）没有影响。

* * *

## 回答 #7

> 赞同：-3
> 
>             
> 
> 时间：2008-10-09T01:47:40.963

我相信您最终会得到每个翻译单元一个。您实际上已经获得了该函数的许多版本（及其声明的静态变量），每个包含标题的翻译单元都有一个版本。

* * *

## 回答 #8

> 赞同：-3
> 
>             
> 
> 时间：2009-08-29T02:34:12.577

静态意味着一个副本分布在整个程序中，而内联意味着它需要在同一个程序中多次使用相同的代码，因此不可能在内联函数中将变量设为静态。

* * *

## 回答 #9

> 赞同：-4
> 
>             
> 
> 时间：2008-10-09T02:15:13.857

除了任何设计问题之外，这一切都可能暗示，因为你已经被它困住了，在这种情况下你应该使用静态而不是内联。这样，每个人都共享相同的变量。（静态功能）

# sql-server - 查询分析器 VS。查询探查器读取、写入和持续时间差异

> ID：185634
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-10-09T01:49:49.757
> 
>         
> 
> 标签：sql-server, sql-server-profiler

我使用的是 MS Sql Server 2000，当我在查询分析器中运行查询时，在打开统计信息的情况下，对于许多查询，统计信息选项卡中报告的数字与查询探查器中显示的值大不相同。当分析器和分析器同时运行时，一些查询在分析器中报告 200 次读取，而分析器报告查询执行 14000 次读取。根据查询性能，在我看来 Profiler 是正确的。但是，为什么两者之间会出现如此大的差异？有没有其他人有同样的事情发生的经验？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T14:37:14.623

这两个实用程序做不同的事情：

*   *SQL Profiler*监视正在发生的事情并报告它。

*   *查询分析器*查看 SQL 代码并确定如何运行它。

查询分析器使用统计数据来确定它要做什么，但结果是一个行动计划，即使显示了统计数据。

SQL Profiler 事后报告所发生的事情——它更准确，但具有追溯性。

如果您发现查询分析器变得非常不准确，请尝试更新您的统计信息。

# database - 写繁重的 Oracle 应用程序的优化？

> ID：185638
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2008-10-09T01:50:37.760
> 
>         
> 
> 标签：database, performance, oracle, database-design

对于主要写入（更新）到 Oracle 数据库的应用程序，可以使用哪些有用的 Oracle 优化？

这里的一般使用模式不是 Web 服务或日志记录，大多数情况下，而是保持系统的复杂状态，因此唯一需要读取的时间是系统启动时，然后更新并创建所有方式。因此，现在读写比率超过 9 比 1，在这种情况下，什么数据库调整可以提高性能？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2008-10-09T01:59:51.390

使用 statspack (9i) 或 AWR (10g+) 监控系统运行状况将是识别瓶颈的最佳方法。

尤其：

*   注意重做等待。重做日志对于维持高写入率至关重要

*   使用绑定变量

*   尽可能使用批量操作。

*   注意索引争用，其中多个进程将记录插入到具有序列派生列上的索引的单个表中

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T14:51:05.763

连同大卫的回答：

*   监控行迁移和行链接活动，并在必要时更改表存储参数

*   检查您的重做日志文件系统：禁用 FS 缓存（即使用 Direct I/O），禁用上次访问时间，将块大小更改为 512B。或者更好的是，迁移到 ASM。

*   阅读索引组织表，看看是否可以在任何地方应用它们。

*   验证是否使用了异步 I/O。

*   对于大 SGA 大小，启用大页面和 LOCK_SGA（特定于平台）

*   尝试不同的 DBWR 设置（例如*fast_start_mttr_target*、*dbwr_processes*）

*   在硬件层面，确保你有一个不错的 RAID-10 控制器并启用了写入缓存！获得大量 15K RPM 硬盘。

最后但并非最不重要的**一点是：在进行任何修改之前定义可重复和现实的性能测试用例。在这种调优中有很多偶然性——每次测试执行一次只做一个改变。**

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T02:00:24.087

我不能推荐[Oracle Enterprise Management Console](http://download.oracle.com/docs/cd/B19306_01/server.102/b14196/em_manage002.htm)（内置于 Oracle）。它会让你确切地知道你做错了什么以及**如何解决它！**

您可能需要考虑摆脱您可能拥有的任何额外索引（索引？）。这可能会导致启动时产生轻微的开销，但将数据添加到索引表可能会大大降低速度。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-10-10T00:27:16.537

根据应用程序和数据的特征，考虑使用 Oracle 外部表进行批量数据加载。让应用程序将数据写入文本文件，然后从外部表上的 SELECT 中使用 INSERT INTO 目标表 = 非常快。

有一些限制，它可能不适合您的情况，但是当您可以使用它时，它会提供巨大的性能。

我用它以每天 40,000 个文件的速度将近乎实时的文本数据文件加载到一个 8 TB（是的，TeraBytes）Oracle 10g 数据库实例中，每个文件最多大约 2 MB。

# c# - Dispose of Image in WPF in Listbox（内存泄漏）

> ID：185648
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2008-10-09T01:55:01.930
> 
>         
> 
> 标签：c#, wpf, memory-management

我有一个列表框，里面有一堆图像（通过数据模板完成）。图像是通过设置项目来源创建的：

```
<Image x:Name="ItemImage" Source="{Binding ImageUrl}"/> 
```

然后使用列表框的 Items.Clear() 方法清除它们。使用列表框的 Items.Add 方法添加新图像。

但是，内存使用量刚刚开始上升和上升。显示的是相同的 300 个左右的小图像，但内存似乎从未被释放。该应用程序开始使用大约 40Megs，并迅速攀升至 700Megs。如何释放所有这些图像正在使用的内存？

**编辑**：我忘了提一件事，图像（每个大小约为 4-5k）正在通过网络加载。缓存是否对此负责？显示 12 张图像会占用大约 10 兆的内存，大约是 100 倍的文件大小。

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2008-10-09T12:08:48.557

除非您在加载图像时做了任何不寻常的事情（例如使用自制的图像加载器或其他东西），否则 GC 应该在不再引用它们时为您清除它们。

您是否在任何地方都保留对数据的引用？请记住，事件和事件处理程序有时会“欺骗”垃圾收集器，使其认为对象仍在使用中：

```
MyObject obj = new MyObject();
obj.TheEvent += new EventHandler(MyHandler);
obj = null;
// Now you might think that obj is set for collection but it 
// (probably - I don't have access to MS' .NET source code) isn't 
// since we're still listening to events from it. 
```

不确定这是否适用于你，但至少我会检查我是否是你。

此外，如果您可以访问分析器，例如 AQTime 或类似的，那么通过它运行您的代码可能会给您一些提示。

如果从磁盘或嵌入到程序集中的资源加载图像，您也可以尝试看看是否有任何不同。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2008-10-09T16:19:07.427

一开始就不要用完所有内存怎么样？

（**注意：**以下段落和代码转载自此[答案](https://stackoverflow.com/questions/181845/in-a-wpf-listbox-with-more-than-1000-image-items-the-zoom-images-become-slow#182827)。）

> 部分问题是它正在加载每个中的完整图像。您必须通过在 上设置或属性，使用`IValueConverter`以缩略图大小打开每个图像。这是我在我的一个项目中使用的一个例子......`DecodePixelWidth``DecodePixelHeight``BitmapImage`

```
class PathToThumbnailConverter : IValueConverter {
    public int DecodeWidth {
        get;
        set;
    }

    public PathToThumbnailConverter() {
        DecodeWidth = 200;
    }

    public object Convert( object value, Type targetType, object parameter, System.Globalization.CultureInfo culture ) {
        var path = value as string;

        if ( !string.IsNullOrEmpty( path ) ) {

            FileInfo info = new FileInfo( path );

            if ( info.Exists && info.Length > 0 ) {
                BitmapImage bi = new BitmapImage();

                bi.BeginInit();
                bi.DecodePixelWidth = DecodeWidth;
                bi.CacheOption = BitmapCacheOption.OnLoad;
                bi.UriSource = new Uri( info.FullName );
                bi.EndInit();

                return bi;
            }
        }

        return null;
    }

    public object ConvertBack( object value, Type targetType, object parameter, System.Globalization.CultureInfo culture ) {
        throw new NotImplementedException();
    }

} 
```

您可能还需要考虑`IsAsync=True`在`Binding`后台线程上调用转换器。

# objective-c - 如何按比例缩放 UIImageView？

> ID：185652
> 
>         
> 
> 赞同：346
> 
>         
> 
> 时间：2008-10-09T01:58:39.350
> 
>         
> 
> 标签：objective-c, cocoa-touch

我有一个 UIImageView ，目标是通过给它一个高度或宽度来按比例缩小它。

```
UIImage *image = [[UIImage alloc] initWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:@"http://farm4.static.flickr.com/3092/2915896504_a88b69c9de.jpg"]]];
UIImageView *imageView = [[UIImageView alloc] initWithImage:image]; 

//Add image view
[self.view addSubview:imageView];   

//set contentMode to scale aspect to fit
imageView.contentMode = UIViewContentModeScaleAspectFit;

//change width of frame
CGRect frame = imageView.frame;
frame.size.width = 100;
imageView.frame = frame; 
```

图像确实调整了大小，但位置不在左上角。缩放图像/图像视图的最佳方法是什么？如何更正位置？

* * *

## 回答 #1

> 赞同：543
> 
>             
> 
> 时间：2010-02-20T00:29:24.490

一旦我找到文档，就可以轻松修复！

```
 imageView.contentMode = .scaleAspectFit 
```

* * *

## 回答 #2

> 赞同：403
> 
>             
> 
> 时间：2013-01-08T17:22:43.290

我看到了一些关于缩放类型的讨论，所以我决定整理[一篇关于一些最流行的内容模式缩放类型](http://jacksonkr.com/content/uiimageview-scaling-explained-visually)的文章。

相关图像在这里：

![在此处输入图像描述](https://i.stack.imgur.com/JHiqw.png)

* * *

## 回答 #3

> 赞同：78
> 
>             
> 
> 时间：2009-02-11T16:44:09.903

我刚试过这个，UIImage不支持_imageScaledToSize。

我最终使用类别向 UIImage 添加了一个方法——这是我在 Apple Dev 论坛上找到的一个建议。

在项目范围内的 .h -

```
@interface UIImage (Extras)
- (UIImage *)imageByScalingProportionallyToSize:(CGSize)targetSize;
@end; 
```

执行：

```
@implementation UIImage (Extras)

- (UIImage *)imageByScalingProportionallyToSize:(CGSize)targetSize {

    UIImage *sourceImage = self;
    UIImage *newImage = nil;

    CGSize imageSize = sourceImage.size;
    CGFloat width = imageSize.width;
    CGFloat height = imageSize.height;

    CGFloat targetWidth = targetSize.width;
    CGFloat targetHeight = targetSize.height;

    CGFloat scaleFactor = 0.0;
    CGFloat scaledWidth = targetWidth;
    CGFloat scaledHeight = targetHeight;

    CGPoint thumbnailPoint = CGPointMake(0.0,0.0);

    if (CGSizeEqualToSize(imageSize, targetSize) == NO) {

        CGFloat widthFactor = targetWidth / width;
        CGFloat heightFactor = targetHeight / height;

        if (widthFactor < heightFactor) 
            scaleFactor = widthFactor;
        else
            scaleFactor = heightFactor;

        scaledWidth  = width * scaleFactor;
        scaledHeight = height * scaleFactor;

        // center the image

        if (widthFactor < heightFactor) {
            thumbnailPoint.y = (targetHeight - scaledHeight) * 0.5; 
        } else if (widthFactor > heightFactor) {
            thumbnailPoint.x = (targetWidth - scaledWidth) * 0.5;
        }
    }

    // this is actually the interesting part:

    UIGraphicsBeginImageContext(targetSize);

    CGRect thumbnailRect = CGRectZero;
    thumbnailRect.origin = thumbnailPoint;
    thumbnailRect.size.width  = scaledWidth;
    thumbnailRect.size.height = scaledHeight;

    [sourceImage drawInRect:thumbnailRect];

    newImage = UIGraphicsGetImageFromCurrentImageContext();
    UIGraphicsEndImageContext();

    if(newImage == nil) NSLog(@"could not scale image");

    return newImage ;
}

@end; 
```

* * *

## 回答 #4

> 赞同：39
> 
>             
> 
> 时间：2012-12-11T07:16:54.993

```
imageView.contentMode = UIViewContentModeScaleAspectFill;
imageView.clipsToBounds = YES; 
```

* * *

## 回答 #5

> 赞同：30
> 
>             
> 
> 时间：2008-10-09T04:10:13.390

您可以尝试使`imageView`尺寸与`image`. 以下代码未经测试。

```
CGSize kMaxImageViewSize = {.width = 100, .height = 100};
CGSize imageSize = image.size;
CGFloat aspectRatio = imageSize.width / imageSize.height;
CGRect frame = imageView.frame;
if (kMaxImageViewSize.width / aspectRatio <= kMaxImageViewSize.height) 
{
    frame.size.width = kMaxImageViewSize.width;
    frame.size.height = frame.size.width / aspectRatio;
} 
else 
{
    frame.size.height = kMaxImageViewSize.height;
    frame.size.width = frame.size.height * aspectRatio;
}
imageView.frame = frame; 
```

* * *

## 回答 #6

> 赞同：13
> 
>             
> 
> 时间：2011-06-15T18:10:36.373

```
UIImage *image = [[UIImage alloc] initWithData:[NSData dataWithContentsOfURL:[NSURL URLWithString:@"http://farm4.static.flickr.com/3092/2915896504_a88b69c9de.jpg"]]];
UIImageView *imageView = [[UIImageView alloc] initWithImage:image]; 

//set contentMode to scale aspect to fit
imageView.contentMode = UIViewContentModeScaleAspectFit;

//change width of frame
//CGRect frame = imageView.frame;
//frame.size.width = 100;
//imageView.frame = frame;

//original lines that deal with frame commented out, yo.
imageView.frame = CGRectMake(10, 20, 60, 60);

...

//Add image view
[myView addSubview:imageView]; 
```

顶部发布的原始代码在 iOS 4.2 中对我来说效果很好。

我发现创建一个 CGRect 并指定所有顶部、左侧、宽度和高度值是在我的情况下调整位置的最简单方法，即在表格单元格内使用 UIImageView。（仍然需要添加代码来释放对象）

* * *

## 回答 #7

> 赞同：13
> 
>             
> 
> 时间：2011-05-25T14:55:59.300

可以通过这种方式调整 UIImage 的大小

```
image = [UIImage imageWithCGImage:[image CGImage] scale:2.0 orientation:UIImageOrientationUp]; 
```

* * *

## 回答 #8

> 赞同：13
> 
>             
> 
> 时间：2015-04-03T03:31:22.850

通过选择 Mode to 设置您的 ImageView`Aspect Fill`并选中该`Clip Subviews`框。

![在此处输入图像描述](https://i.stack.imgur.com/WjMz3.png)

* * *

## 回答 #9

> 赞同：13
> 
>             
> 
> 时间：2016-10-07T16:13:49.187

这对我 Swift 2.x 来说很好用：

```
imageView.contentMode = .ScaleAspectFill
imageView.clipsToBounds = true; 
```

* * *

## 回答 #10

> 赞同：11
> 
>             
> 
> 时间：2016-12-16T09:37:32.547

`UIimageview`按比例设置......

[![在此处输入图像描述](https://i.stack.imgur.com/JEhNI.png)](https://i.stack.imgur.com/JEhNI.png)

* * *

## 回答 #11

> 赞同：7
> 
>             
> 
> 时间：2015-09-17T09:33:38.347

对于斯威夫特：

```
self.imageViews.contentMode = UIViewContentMode.ScaleToFill 
```

* * *

## 回答 #12

> 赞同：5
> 
>             
> 
> 时间：2013-11-20T16:22:12.667

UIImageView+Scale.h：

```
#import <Foundation/Foundation.h>

@interface UIImageView (Scale)

-(void) scaleAspectFit:(CGFloat) scaleFactor;

@end 
```

UIImageView+Scale.m：

```
#import "UIImageView+Scale.h"

@implementation UIImageView (Scale)

-(void) scaleAspectFit:(CGFloat) scaleFactor{

    self.contentScaleFactor = scaleFactor;
    self.transform = CGAffineTransformMakeScale(scaleFactor, scaleFactor);

    CGRect newRect = self.frame;
    newRect.origin.x = 0;
    newRect.origin.y = 0;
    self.frame = newRect;
}

@end 
```

* * *

## 回答 #13

> 赞同：2
> 
>             
> 
> 时间：2017-01-05T01:04:54.673

如果此处提出的解决方案不适合您，并且您的图像资产实际上是 PDF，请注意 XCode 实际上处理 PDF 与图像文件不同。特别是，它似乎无法缩放以正确填充 PDF：它最终被平铺。这让我发疯，直到我发现问题出在 PDF 格式上。转换为JPG，你应该很高兴。

* * *

## 回答 #14

> 赞同：2
> 
>             
> 
> 时间：2016-02-25T08:08:03.343

我使用了以下代码。其中 imageCoverView 是 UIView 包含 UIImageView

```
if (image.size.height<self.imageCoverView.bounds.size.height && image.size.width<self.imageCoverView.bounds.size.width)
{
    [self.profileImageView sizeToFit];
    self.profileImageView.contentMode =UIViewContentModeCenter
}
else
{
    self.profileImageView.contentMode =UIViewContentModeScaleAspectFit;
} 
```

* * *

## 回答 #15

> 赞同：1
> 
>             
> 
> 时间：2016-02-25T08:17:15.513

Usually I use this method for my apps (**Swift 2.x** compatible):

```
// Resize UIImage
func resizeImage(image:UIImage, scaleX:CGFloat,scaleY:CGFloat) ->UIImage {
    let size = CGSizeApplyAffineTransform(image.size, CGAffineTransformMakeScale(scaleX, scaleY))
    let hasAlpha = true
    let scale: CGFloat = 0.0 // Automatically use scale factor of main screen

    UIGraphicsBeginImageContextWithOptions(size, !hasAlpha, scale)
    image.drawInRect(CGRect(origin: CGPointZero, size: size))

    let scaledImage = UIGraphicsGetImageFromCurrentImageContext()
    UIGraphicsEndImageContext()
    return scaledImage
} 
```

* * *

## 回答 #16

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T03:04:24.693

我认为你可以做类似的事情

```
image.center = [[imageView window] center]; 
```

* * *

## 回答 #17

> 赞同：-3
> 
>             
> 
> 时间：2008-10-10T22:17:54.680

这是您可以轻松扩展它的方法。

这适用于模拟器和 iPhone 的 2.x。

```
UIImage *thumbnail = [originalImage _imageScaledToSize:CGSizeMake(40.0, 40.0) interpolationQuality:1]; 
```

# flash - Flash/AS3 中的 RFC 时间戳

> ID：185661
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2008-10-09T02:02:45.347
> 
>         
> 
> 标签：flash, actionscript-3, date

我想知道 Flash/AS3 是否有任何好方法将 AS3 'Date' 对象转换为/从 rfc-850 时间戳格式（如 HTTP 日期和上次修改所使用）。

[这个问题与关于 rfc 3339](https://stackoverflow.com/questions/17017/how-do-i-parse-and-convert-datetimes-to-the-rfc-3339-date-time-format)的问题非常相似，除了它特定于 AS3 和 rfc-850。

RFC-850 就像：`Thu, 09 Oct 2008 01:09:43 GMT`

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2008-10-09T06:05:22.940

好的，这里有几个函数可以`Date`在 Flash 中进行 RFC-802/ 转换。

我了解到该`Date`对象实际上并没有任何时区概念，并假设它位于本地时区。如果您将 RFC-802 日期传递给`Date()`构造函数，它会解析除末尾的“GMT”时区标记之外的所有内容，从而生成正确的时间但可能位于错误的时区。

从解析的 Date 中减去当前时区可以弥补这一点，因此时间戳可以与这些函数进行往返，而不会完全出错。

（如果*有人*在设计课程时包含了一个属性，那不是*很好*吗？）*`timezone``Date`*

 *```
/**
 * Converts an RFC string to a Date object.
 */
function fromRFC802(date:String):Date {
    // Passing in an RFC802 date to the Date constructor causes flash
    // to conveniently ignore the "GMT" timezone at the end, and assumes
    // that it's in the Local timezone.
    // If we additionally convert it back to GMT, then we're sweet.

    var outputDate:Date = new Date(date);
    outputDate = new Date(outputDate.time - outputDate.getTimezoneOffset()*1000*60);
    return outputDate;
}

/** 
 * Converts a Date object to an RFC802-formatted string (GMT/UTC).
 */
function toRFC802 (date:Date):String {
    // example: Thu, 09 Oct 2008 01:09:43 GMT

    // Convert to GMT

    var output:String = "";

    // Day
    switch (date.dayUTC) {
    case 0: output += "Sun"; break;
    case 1: output += "Mon"; break;
    case 2: output += "Tue"; break;
    case 3: output += "Wed"; break;
    case 4: output += "Thu"; break;
    case 5: output += "Fri"; break;
    case 6: output += "Sat"; break;
    }

    output += ", ";

    // Date
    if (date.dateUTC < 10) {
        output += "0"; // leading zero
    }
    output += date.dateUTC + " ";

    // Month
    switch(date.month) {
    case 0: output += "Jan"; break;
    case 1: output += "Feb"; break;
    case 2: output += "Mar"; break;
    case 3: output += "Apr"; break;
    case 4: output += "May"; break;
    case 5: output += "Jun"; break;
    case 6: output += "Jul"; break;
    case 7: output += "Aug"; break;
    case 8: output += "Sep"; break;
    case 9: output += "Oct"; break;
    case 10: output += "Nov"; break;
    case 11: output += "Dec"; break;
    }

    output += " ";

    // Year
    output += date.fullYearUTC + " ";

    // Hours
    if (date.hoursUTC < 10) {
        output += "0"; // leading zero
    }
    output += date.hoursUTC + ":";

    // Minutes
    if (date.minutesUTC < 10) {
        output += "0"; // leading zero
    }
    output += date.minutesUTC + ":";

    // Seconds
    if (date.seconds < 10) {
        output += "0"; // leading zero
    }
    output += date.secondsUTC + " GMT";

    return output;
}

var dateString:String = "Thu, 09 Oct 2008 01:09:43 GMT";

trace("Round trip proof:");

trace(" RFC-802: " + dateString);
trace("Date obj: " + fromRFC802(dateString));
trace(" RFC-802: " + toRFC802(fromRFC802(dateString)));
trace("Date obj: " + fromRFC802(toRFC802(fromRFC802(dateString))));
trace(" RFC-802: " + toRFC802(fromRFC802(toRFC802(fromRFC802(dateString))))); 
```

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T03:40:14.027

as3corelib库具有[DateUtil.toRFC822](http://as3corelib.googlecode.com) () 和 DateUtil.parseRFC822() 方法（等等）。不知道这些是否正是您正在寻找的。

DateUtil 类的具体文档在这里：[http ://as3corelib.googlecode.com/svn/trunk/docs/com/adobe/utils/DateUtil.html](http://as3corelib.googlecode.com/svn/trunk/docs/com/adobe/utils/DateUtil.html)

# asp.net - 模板化 ASP.NET 用户控件

> ID：185664
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-10-09T02:04:42.910
> 
>         
> 
> 标签：asp.net, controls

我正在尝试创建一个用户控件，允许用户进行如下操作：

```
 <uc1:MyControl id="controlThing" runat="server">

    <uc1:BoundColumn id="column1" Column="Name" runat="server" />
    <uc1:CheckBoxBoundColumn id="column2" Column="Selector" runat="server" />
    <uc1:BoundColumn id="column3" Column="Description" runat="server" />

     ...etc 

  </uc1:MyControl> 
```

除了您可以拥有许多任何类型的事实之外，我只允许某些控件。我可以在 XSD 中描绘这一点，但我不完全确定 ASP.NET。

我的 ASP.NET voodoo 现在正在画一个空白......有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T03:44:43.737

PersistenceMode.InnerProperty 是您想要的。这是[MSDN 文档。](http://msdn.microsoft.com/en-us/library/system.web.ui.persistencemode.aspx)  做这样的事情会让你得到你想要的：

```
[PersistenceMode(PersistenceMode.InnerProperty)]
public ListItem Items {
   get; set;
} 
```

然后你就可以像这样使用它：

```
<cc1:MyControl runat="server">
   <Items>
       <asp:ListItem Text="foo" />
   </Items>
</cc1:MyControl> 
```

您也可以创建自己的自定义类以在其中使用。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T02:11:19.293

您是否可以覆盖现有控件，例如 ListView 或 GridView？这是您最简单的选择。

但是要创建自己的自定义模板控件，您需要使用 ITemplate。

我还没有做过，但是一个快速的谷歌返回了这个： http: [//www.developerfusion.com/article/4410/in-depth-aspnet-using-adonet/2/](http://www.developerfusion.com/article/4410/in-depth-aspnet-using-adonet/2/)它看起来不错。

我有一本书“开发 Microsoft ASP.NET 服务器控件和组件”，其中涵盖了它，但我还没有深入阅读它（[http://www.amazon.com/exec/obidos/ASIN/0735615829/nikhilkothari-20](https://rads.stackoverflow.com/amzn/click/com/0735615829) )

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T02:20:23.143

我想我关心的最困难的部分是能够在我的用户控件中模板化任意数量的给定用户控件集。

```
<mycontrol id="control1" runat="server">
    <templateitem id="bleh1" runat="server" />
    <templateitem id="bleh2" runat="server" />
    <templateitem id="bleh3" runat="server" />
     ..etc
</mycontrol> 
```

# iphone - 如何在 iPhone 和另一台计算机之间同步应用程序数据？

> ID：185673
> 
>         
> 
> 赞同：13
> 
>         
> 
> 时间：2008-10-09T02:13:07.837
> 
>         
> 
> 标签：iphone

我正在开发一个 iPhone 应用程序，它允许查看和编辑我想与桌面应用程序保持同步的数据。我在 SDK 中看不到任何直接处理数据同步的内容，也找不到任何可以让我“挂钩”到 iTunes 同步过程的内容。

我可以做一些笨拙的事情，比如将数据隐藏在照片或地址簿条目中，但这似乎是个坏主意。我可以使用 WebDAV 或 HTTP 将数据获取/放入服务器，但这会使应用程序更加复杂。

我想我希望这是 iPhone 应用程序的常见用例（在桌面和 iPhone 之间同步任意应用程序数据），并且 SDK 中会有一组 API 涵盖这一点。也许有，我就是找不到。

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2008-10-10T04:05:32.977

两种流行的方法是：

直接通过 WiFi 与桌面应用程序同步（使用 Bonjour 等来发现 iPhone/桌面应用程序端点，正如其他人在这里所建议的那样）。

另一种选择是与共享文件位置同步 - FTP、MobileMe、WebDAV、另一台服务器上的网络服务等。因此 iPhone 和桌面应用程序将读取/写入共享位置，以便其他人可以看到更新。

正如其他人所说，目前还没有 Apple 提供的方法（使用 iTunes 或其他方式），也没有迹象表明在不久的将来会发生任何类似的事情，除非它与 iPhone 未来对第三方推送更新的支持捆绑在一起。（我真的怀疑会是这样，但你永远不知道。）

* * *

## 回答 #2

> 赞同：5
> 
>             
> 
> 时间：2008-10-10T04:32:54.920

看一下 ：

[http://sourceforge.net/projects/syncdocs/](http://sourceforge.net/projects/syncdocs/)

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2008-10-09T02:19:28.713

我自己没有尝试过，但我认为[Bonjour](http://developer.apple.com/iphone/library/navigation/Topics/NetworkingInternet/index.html)提供了与其他机器上的服务连接的能力，你可能会找到一些答案

* * *

## 回答 #4

> 赞同：3
> 
>             
> 
> 时间：2008-10-09T09:45:29.360

这是一个常见问题，但遗憾的是 SDK 没有解决。

由于 iPhone 支持 Bonjour 服务发布和发现，您可以轻松地在手机上发布服务并在桌面上监听，找到时连接。（或者您可以在桌面上发布服务并从手机连接，无论哪种方式都没有关系。）Bonjour for MacO OS X 上的所有文档都适用于 iPhone OS。

请注意，Bonjour 只是宣传一项服务；一旦找到它，您仍然必须使用套接字来连接和传输数据。

基本上，没有简单的方法可以做到这一点，但是有足够的工具可以使用户的同步体验变得轻松。

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2009-08-16T16:55:26.947

Bonjour 同步的一个例子：
 [http ://cocoa-nut.de/?p=27](http://cocoa-nut.de/?p=27)

* * *

## 回答 #6

> 赞同：2
> 
>             
> 
> 时间：2011-08-30T00:00:00.613

只是为了更新这个答案 - 自提出问题以来，Apple 增加了对将文件同步到 iTunes 的支持（并让用户通过 iTunes 的“应用程序”选项卡访问它们）。

为此，您必须在应用程序的 Info.plist 文件中将 UIFileSharingEnabled 键设置为 YES。然后，您可以使用标准文件 IO API 将文件保存到应用的 Documents 目录。

这里有更多信息：http: [//developer.apple.com/library/ios/#documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/StandardBehaviors/StandardBehaviors.html#//apple_ref/doc/uid/TP40007072-CH4-SW6](http://developer.apple.com/library/ios/#documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/StandardBehaviors/StandardBehaviors.html#//apple_ref/doc/uid/TP40007072-CH4-SW6)

这包括您应该实现的行为（即确保您还支持阅读添加到您的 Documents 目录中的文档 - 尽管我见过很多不这样做的应用程序）。

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T05:24:34.347

我还在开发一个需要共享数据的应用程序，我发现获取信息进出 iPhone 的唯一合理/非黑客方式是通过 NSURLConnection。

（个人观点）我不认为 Apple 会为同步过程提供挂钩。（/个人观点）

# c# - 用户持久性：asp.net 缓存：

> ID：185679
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-10-09T02:17:07.830
> 
>         
> 
> 标签：c#, asp.net, caching, persistence

我第一次使用缓存和持久性。

我有一个处理我所有用户数据的用户对象。从一个页面到另一个页面坚持这个我计划使用一个带有令牌的cookie，然后从缓存中返回用户对象。

实现这一点的最佳方法是什么。在我看来，两个想法/解决方案是：

1）缓存一个字典，其中令牌是键，用户对象是值。从 cookie 中提取令牌并检索用户值。

2) 以token作为缓存id独立缓存每个用户值。

我相信还有很多其他方法可以做到这一点。让我知道以上哪一项是最佳实践，或提出替代方案并解释原因。

谢谢！

（我的大部分经验是在 Windows 开发方面，几乎没有针对 Web 的，所以我试图弄清楚一些事情。）

语言：c#.Net (3.5)

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2008-10-09T02:20:14.063

为什么不直接使用 ASP.NET 中内置的会话存储？

Cookie 最好在用户浏览器中保留一些令牌/标记，以便当浏览器关闭并且用户稍后重新访问您的网站时，您的网站仍然可以检索该令牌/标记并识别用户（或重新水化用户的会话数据） .

# javascript - Javascript 嵌套类

> ID：185680
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2008-10-09T02:18:09.310
> 
>         
> 
> 标签：javascript

如何在 Java Script 中定义嵌套类。

这是我的代码片段：

```
objA = new TestA();

function TestB ()
{
   this.testPrint = function ()
  {
     print ( " Inside testPrint " );
  }
}

function TestA ()
{
   var myObjB = new TestB();
} 
```

现在我正在尝试使用 objA 访问 testPrint

```
objA.myObjB.testPrint(); 
```

但它给出的错误“objA没有属性”

如何使用 objA 处理程序访问 testB 方法？

* * *

## 回答 #1

> 赞同：10
> 
>             
> 
> 时间：2013-06-29T10:37:22.827

如果您希望内部嵌套类的原型定义不能从外部类外部访问，以及更清洁的 OO 实现，请查看此。

```
var BobsGarage = BobsGarage || {}; // namespace

/**
 * BobsGarage.Car
 * @constructor
 * @returns {BobsGarage.Car}
 */
BobsGarage.Car = function() {

    /**
     * Engine
     * @constructor
     * @returns {Engine}
     */
    var Engine = function() {
        // definition of an engine
    };

    Engine.prototype.constructor = Engine;
    Engine.prototype.start = function() {
        console.log('start engine');
    };

    /**
     * Tank
     * @constructor
     * @returns {Tank}
     */
    var Tank = function() {
        // definition of a tank
    };

    Tank.prototype.constructor = Tank;
    Tank.prototype.fill = function() {
        console.log('fill tank');
    };

    this.engine = new Engine();
    this.tank = new Tank();
};

BobsGarage.Car.prototype.constructor = BobsGarage.Car;

/**
 * BobsGarage.Ferrari
 * Derived from BobsGarage.Car
 * @constructor
 * @returns {BobsGarage.Ferrari}
 */
BobsGarage.Ferrari = function() {
    BobsGarage.Car.call(this);
};
BobsGarage.Ferrari.prototype = Object.create(BobsGarage.Car.prototype);
BobsGarage.Ferrari.prototype.constructor = BobsGarage.Ferrari;
BobsGarage.Ferrari.prototype.speedUp = function() {
    console.log('speed up');
};

// Test it on the road

var car = new BobsGarage.Car();
car.tank.fill();
car.engine.start();

var ferrari = new BobsGarage.Ferrari();
ferrari.tank.fill();
ferrari.engine.start();
ferrari.speedUp();

// var engine = new Engine(); // ReferenceError

console.log(ferrari); 
```

通过这种方式，您可以拥有*原型继承*和*嵌套类*，以便`BobsGarage.Car`在其构造函数之外无法访问其中定义的类，`BobsGarage.Car`但派生类可以访问它们的实例，如测试代码所示。

注意：我指的是[MDN](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Introduction_to_Object-Oriented_JavaScript)上定义的 Javascript 中的*Class*概念。

* * *

## 回答 #2

> 赞同：7
> 
>             
> 
> 时间：2008-10-09T02:19:42.380

使用 this.myObjB 而不是 var myObjB

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2008-10-09T02:23:07.023

[对象字面量](https://stackoverflow.com/questions/178904/simple-javascript-question-what-is-this-thing#178916)：

```
var objA = {
    myObjB: {
       testPrint: function(){
          print("Inside test print");
       }
    }
};

objA.myObjB.testPrint(); 
```

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T03:49:16.927

您对 TestA 的定义没有公开任何公共成员。要公开 myObjB，您需要将其公开：

```
function TestA() {
    this.myObjB = new TestB();
}
var objA = new TestA();
var objB = objA.myObjB; 
```

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T02:46:07.083

如果您尝试进行继承，那么您可能需要考虑**原型**关键字。

```
var myObjB = function(){
    this.testPrint = function () {
       print ( " Inside testPrint " );
    }
}

var myObjA = new myObjB();
myObjA.prototype = {
   var1 : "hello world",
   test : function(){
      this.testPrint(this.var1);
   }
} 
```

（我希望这是有道理的）

# c# - DOM 解析

> ID：185681
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-10-09T02:19:20.603
> 
>         
> 
> 标签：c#, asp.net, dom, silverlight-2.0

任何人都知道如何解析 DOM 并确定在 ASP.NET ListView 中选择了哪一行？我可以通过 Silverlight 中的 HtmlElement 与 DOM 进行交互，但我无法找到指示该行被选中的属性。

作为参考，此托管方法适用于 ASP.NET ListBox

```
var elm = HtmlPage.Document.GetElementById(ListBoxId);

foreach (var childElm in elm.Children)
{
    if (!((bool)childElm.GetProperty("Selected")))
    {
       continue;
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-11-02T01:54:29.277

mathieu 提供的建议应该可以正常工作。既然您提到了行，我会说在您的 ListView 中的 tr 元素中添加一个 id，然后您可以使用 jQuery 找到它。

所以，

```
<tr id='selectedRow'>
......
</tr>

$(document).ready(function() {
    $("#selectedRow").click(function() {
        alert('This is the selected row');
    });

}); 
```

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T10:41:40.120

如果您的列表视图具有选定行的特定 css 类，您可以尝试对其进行过滤

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T04:05:36.190

我没有我的开发环境来测试这个，但你能在 ListBoxID 元素上调用 GetProperty('selectedIndex') 吗？然后从中找出选择了哪个孩子并使用 elm.Children 返回该孩子。

**编辑：**今天早上启动了我的开发环境并进行了一些测试。这是一个对我有用的代码片段：

```
HtmlElement elem = HtmlPage.Document.GetElementById("testSelect");
int index = Convert.ToInt32(elem.GetProperty("selectedIndex"));
var options = (from c in elem.Children
              let he = c as HtmlElement
              where he.TagName == "option"
              select he).ToList();

output.Text = (string)options[index].GetProperty("innerText"); 
```

当然，您必须将“textSelect”更改为您的 html 选择元素的名称。需要 linq 查询，因为 Children 属性由 ScriptableObjects 组成，其中只有大约一半是您关心的选项元素。

# c# - 如何使用 zlib.NET 扩充文件？

> ID：185690
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2008-10-09T02:21:46.057
> 
>         
> 
> 标签：c#, .net, compression, zlib

我正在使用[zlib.NET](http://www.componentace.com/zlib_.NET.htm)库来尝试扩充由 zlib 压缩的文件（也许在 Linux 机器上）。这就是我正在做的事情：

```
zlib.ZInputStream zinput =
    new zlib.ZInputStream(File.Open(path, FileMode.Open, FileAccess.Read));

while (stopByte != (data = zinput.ReadByte()))
{
  // check data here
}

zinput.Close(); 
```

数据字节与压缩数据字节匹配，所以我一定做错了什么。

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2008-10-09T02:38:56.287

除了即使面对异常也没有使用“使用”语句来关闭流，这对我来说看起来不错。数据确定是压缩的吗？你能在linux机器上用zlib解压吗？

查看源代码后，它非常可怕 - 例如，调用`int Read(buffer, offset, length)`最终将调用其内部`int Read()`方法`length`时间。鉴于这种不稳定的开始，我不确定我是否会特别信任代码，但我希望它至少能*稍微*工作！您是否尝试过使用[SharpZipLib](http://www.icsharpcode.net/OpenSource/SharpZipLib/Download.aspx)？

* * *

## 回答 #2

> 赞同：7
> 
>             
> 
> 时间：2008-10-09T16:02:18.367

看来我错误地假设所有虚拟方法都被覆盖了，但事实并非如此。我使用的是 zlib.ZInputStream.ReadByte()，它只是继承的 Stream.ReadByte()，它不会做任何膨胀。

我改用 zlib.ZInputStream.Read() ，它的工作原理应该是这样。

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2015-11-22T13:05:38.920

跳过 zlib 标头（前两个字节`78 9C`），然后使用[`DeflateStream`](https://msdn.microsoft.com/en-us/library/system.io.compression.deflatestream.aspx)内置的 .net 对我有用。

```
using(var input = File.OpenRead(...))
using(var output = File.Create(...))
{
    // if there are additional headers before the zlib header, you can skip them:
    // input.Seek(xxx, SeekOrigin.Current);

    if (input.ReadByte() != 0x78 || input.ReadByte() != 0x9C)//zlib header
        throw new Exception("Incorrect zlib header");

    using (var deflateStream = new DeflateStream(decryptedData, CompressionMode.Decompress, true))
    {
        deflateStream.CopyTo(output);
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-01-23T16:35:03.900

下面的代码可以帮助你们。实例化对象并使用函数。

```
public class FileCompressionUtility
{
    public FileCompressionUtility()
    {
    }

    public static void CopyStream(System.IO.Stream input, System.IO.Stream output)
    {
        byte[] buffer = new byte[2000];
        int len;
        while ((len = input.Read(buffer, 0, 2000)) > 0)
        {
            output.Write(buffer, 0, len);
        }
        output.Flush();
    }

    public void compressFile(string inFile, string outFile)
    {
        System.IO.FileStream outFileStream = new System.IO.FileStream(outFile, System.IO.FileMode.Create);
        zlib.ZOutputStream outZStream = new zlib.ZOutputStream(outFileStream, zlib.zlibConst.Z_DEFAULT_COMPRESSION);
        System.IO.FileStream inFileStream = new System.IO.FileStream(inFile, System.IO.FileMode.Open);
        try
        {
            CopyStream(inFileStream, outZStream);
        }
        finally
        {
            outZStream.Close();
            outFileStream.Close();
            inFileStream.Close();
        }
    }

    public void uncompressFile(string inFile, string outFile)
    {
        int data = 0;
        int stopByte = -1;
        System.IO.FileStream outFileStream = new System.IO.FileStream(outFile, System.IO.FileMode.Create);
        zlib.ZInputStream inZStream = new zlib.ZInputStream(System.IO.File.Open(inFile, System.IO.FileMode.Open, System.IO.FileAccess.Read));
        while (stopByte != (data = inZStream.Read()))
        {
            byte _dataByte = (byte)data;
            outFileStream.WriteByte(_dataByte);
        }

        inZStream.Close();
        outFileStream.Close();
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2013-03-12T14:12:58.943

我最近不幸将以前使用 php 的 zlib'd 文档提供给包括 IE7 在内的各种浏览器和平台。一旦我发现文档是 zlib'd 而不是 gzip'd（如当时所想的那样），我在 .NET Framework v4 中以下列方式使用了[SharpZipLib](http://www.icsharpcode.net/opensource/sharpziplib/)（利用[Stream.CopyTo](http://msdn.microsoft.com/en-us/library/dd782932%28v=vs.100%29.aspx)）：

```
public static byte[] DecompressZlib(Stream source)
{
    byte[] result = null;
    using (MemoryStream outStream = new MemoryStream())
    {
        using (InflaterInputStream inf = new InflaterInputStream(source))
        {
            inf.CopyTo(outStream);
        }
        result = outStream.ToArray();
    }
    return result;
} 
```

我想我会把它放在这里，以防有人需要帮助来使用 SharpZipLib 的类。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T04:15:31.820

更仔细地查看示例代码，它将数据从常规 Filestream 复制到 ZOutputStream。减压必须通过该层进行。

```
private void decompressFile(string inFile, string outFile)
{
    System.IO.FileStream outFileStream = new System.IO.FileStream(outFile, System.IO.FileMode.Create);
    zlib.ZOutputStream outZStream = new zlib.ZOutputStream(outFileStream);
    System.IO.FileStream inFileStream = new System.IO.FileStream(inFile, System.IO.FileMode.Open);          
    try
    {
        CopyStream(inFileStream, outZStream);
    }
    finally
    {
        outZStream.Close();
        outFileStream.Close();
        inFileStream.Close();
    }
} 
```

# windows - 没有管理员权限的 Windows 上的 SVN 客户端

> ID：185693
> 
>         
> 
> 赞同：29
> 
>         
> 
> 时间：2008-10-09T02:22:35.760
> 
>         
> 
> 标签：windows, svn, tortoisesvn

我正在尝试在朋友的工作 Windows 笔记本电脑上安装 svn 客户端，但没有取得多大成功。现在似乎每个人都在使用 TortoiseSVN，不幸的是没有管理员权限就无法安装。有什么办法可以解决它或我可以尝试其他客户吗？

我不需要任何花哨的东西——只需要基本的 http/https，但 GUI 比命令行客户端更受欢迎。

谢谢！

* * *

我刚刚验证了前面提到的 SmartSVN 和 RapidSVN 都需要管理员访问 Windows 上的 insatll，就像 TortoiseSVN 一样。

:(

* * *

## 回答 #1

> 赞同：22
> 
>             
> 
> 时间：2011-05-10T09:34:53.570

好的，我终于找到了（我认为）这个问题的正确答案。压缩后的二进制文件可在此处的 win32svn 项目中获得：http: [//sourceforge.net/projects/win32svn/files/](http://sourceforge.net/projects/win32svn/files/)。

在您喜欢的版本的子目录中，只需下载名称为 svn-win32-1.6.16.zip 的文件并解压缩到您的主目录、本地高清或（在我的情况下）usb 记忆棒。

希望这对某人有帮助！我很惊讶地发现我发现的所有链接都指向安装程序，当您没有管理员权限时，您可能无法运行这些安装程序。

编辑：这当然是 CLI 版本；我想这个答案更适合像我这样正在寻找它并提出这个问题的人:)

* * *

## 回答 #2

> 赞同：8
> 
>             
> 
> 时间：2010-05-24T10:17:08.383

[http://portableapps.com/node/6767](http://portableapps.com/node/6767)

RapidSVN 便携式

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2013-11-07T15:43:03.720

这是一个迟到的答案，希望对其他人有所帮助。我的答案是[smartsvn](https://www.smartsvn.com/)，它是一个完美的软件，基础版免费使用。

在他们的全部下载页面，你可以下载一个[便携版](https://www.smartsvn.com/downloads/smartsvn/smartsvn-windows-portable-9_2_3.zip)，jre也包含在这个zip包中，这意味着你甚至可以在没有安装java的情况下运行该软件，因为java默认不包含在最新的windows系统中。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-12-05T08:06:14.780

RapidSVN 无需安装即可正常运行。

不幸的是 - 它只打包为安装程序 exe。

您需要做的是在您拥有管理员权限的某些机器上安装 RapidSVN，然后将 RapidSVN 文件夹从程序文件复制到 USB 驱动器或您要运行它的机器的硬盘驱动器上。然后，您可以从任何机器上运行“RapidSVN.exe”，它运行得非常愉快。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T02:40:53.257

在 Wikipedia 上有一个[巨大的列表](http://en.wikipedia.org/wiki/Comparison_of_Subversion_clients)，应该会给你一些选择，但我相信[SmartSVN 很好](https://www.smartsvn.com/)（没用过，只是看看）

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2015-10-01T04:04:25.950

如果需要一些 gui，最简单的方法之一是仅将 Eclipse 与 svn 插件一起使用。

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2012-05-30T06:21:31.243

+1 使用 RapidSVN，我以前用过它，没有管理员权限

那么我知道你仍然需要下面这个的管理员权限，但是让我提到这一点，因为有人可能会发现它很有用，如果他们想打开/关闭上下文菜单

如何轻松启用或禁用 TortoiseSVN 菜单
[http://www.howtogeek.com/howto/21106/how-to-enable-or-disable-tortoisesvn-menus-easily/](http://www.howtogeek.com/howto/21106/how-to-enable-or-disable-tortoisesvn-menus-easily/)

# algorithm - 在大词序列中找到前K个频繁词的最有效方法

> ID：185697
> 
>         
> 
> 赞同：91
> 
>         
> 
> 时间：2008-10-09T02:24:12.263
> 
>         
> 
> 标签：algorithm, word-frequency

输入：一个正整数 K 和一个大文本。文本实际上可以被视为单词序列。所以我们不必担心如何将其分解为单词序列。

输出：文本中出现频率最高的 K 个单词。

我的想法是这样的。

1.  在遍历整个单词序列时，使用哈希表记录所有单词的频率。在这个阶段，key是“word”，value是“word-frequency”。这需要 O(n) 时间。

2.  对 (word, word-frequency) 对进行排序；关键是“词频”。使用普通排序算法需要 O(n*lg(n)) 时间。

3.  排序后，我们只取前 K 个单词。这需要 O(K) 时间。

总而言之，总时间是O(n+n *lg(n)+K)，因为K肯定小于N，所以实际上是O(n* lg(n))。

我们可以改进这一点。实际上，我们只想要前 K 个单词。其他词的频率与我们无关。所以，我们可以使用“部分堆排序”。对于步骤 2) 和 3)，我们不只是进行排序。相反，我们将其更改为

2') 以“word-frequency”为key，构建一堆(word, word-frequency) pair。构建堆需要 O(n) 时间；

3') 从堆中提取前 K 个单词。每次提取都是 O(lg(n))。因此，总时间为 O(k*lg(n))。

总而言之，这个解决方案花费时间 O(n+k*lg(n))。

这只是我的想法。我还没有找到改进步骤 1) 的方法。

我希望一些信息检索专家可以更多地阐明这个问题。

* * *

## 回答 #1

> 赞同：72
> 
>             
> 
> 时间：2014-03-12T03:51:20.437

这可以在 O(n) 时间内完成

**解决方案1：**

脚步：

1.  计算单词并对其进行散列，最终将形成这样的结构

    ```
    var hash = {
      "I" : 13,
      "like" : 3,
      "meow" : 3,
      "geek" : 3,
      "burger" : 2,
      "cat" : 1,
      "foo" : 100,
      ...
      ... 
    ```

2.  遍历哈希并找到最常用的单词（在本例中为“foo”100），然后创建该大小的数组

3.  然后我们可以再次遍历哈希并将单词出现的次数作为数组索引，如果索引中没有任何内容，则创建一个数组，否则将其附加到数组中。然后我们最终得到一个数组，如：

    ```
     0   1      2            3                  100
    [[ ],[cat],[burger],[like, meow, geek],[]...[foo]] 
    ```

4.  然后只从最后遍历数组，收集k个单词。

**解决方案2：**

脚步：

1.  和上面一样

2.  使用 min heap 并保持 min heap 的大小为 k，并且对于 hash 中的每个单词，我们将单词的出现与 min 进行比较，1）如果它大于 min 值，则删除 min（如果 min 的大小heap 等于 k) 并在最小堆中插入数字。2) 休息简单条件。

3.  遍历完数组后，我们只需将最小堆转换为数组并返回数组即可。

* * *

## 回答 #2

> 赞同：22
> 
>             
> 
> 时间：2008-10-09T07:55:50.017

您不会获得比您描述的解决方案更好的运行时间。你必须做至少 O(n) 的工作来评估所有的词，然后 O(k) 额外的工作来找到前 k 个词。

如果您的问题集*非常*大，您可以使用分布式解决方案，例如 map/reduce。让 n 个 map 工作人员在每个文本的 1/n 处计算频率，并且对于每个单词，将其发送给基于单词哈希计算的 m 个 reducer 工作人员之一。然后减速器将计数相加。对 reducer 的输出进行合并排序将按受欢迎程度为您提供最流行的单词。

* * *

## 回答 #3

> 赞同：14
> 
>             
> 
> 时间：2008-12-26T00:54:53.343

如果我们不关心排名前 K的解决方案，您的解决方案的一个小变化会产生**O(n)算法，如果我们这样做，则会产生****O(n+k*lg(k))**解决方案。我相信这两个界限在一个常数因子内都是最优的。

在我们遍历列表，插入哈希表之后，这里的优化再次出现。我们可以使用[中位数](http://en.wikipedia.org/wiki/Selection_algorithm#Linear_general_selection_algorithm_-_.22Median_of_Medians_algorithm.22)算法来选择列表中第 K 个最大的元素。该算法可证明是 O(n)。

选择第 K 个最小的元素后，我们围绕该元素划分列表，就像在快速排序中一样。这显然也是 O(n)。枢轴“左侧”的任何东西都在我们的 K 个元素组中，所以我们完成了（我们可以简单地扔掉其他所有东西）。

所以这个策略是：

1.  遍历每个单词并将其插入哈希表：O(n)

2.  选择第 K 个最小的元素：O(n)

3.  围绕该元素进行分区：O(n)

如果要对 K 个元素进行排序，只需在 O(k * lg(k)) 时间内使用任何有效的比较排序对它们进行排序，从而产生 O(n+k * lg(k)) 的总运行时间。

O(n) 时间界限在常数因子内是最优的，因为我们必须至少检查每个单词一次。

O(n + k * lg(k)) 时间界限也是最优的，因为没有基于比较的方法可以在小于 k * lg(k) 的时间内对 k 个元素进行排序。

* * *

## 回答 #4

> 赞同：9
> 
>             
> 
> 时间：2008-10-09T02:26:35.267

如果你的“大词表”足够大，你可以简单地抽样并得到估计。否则，我喜欢哈希聚合。

*编辑*：

通过样本，我的意思是选择一些页面子集并计算这些页面中最常见的单词。如果您以合理的方式选择页面并选择具有统计意义的样本，那么您对最常用词的估计应该是合理的。

这种方法只有在您拥有如此多的数据以至于处理所有数据有点愚蠢时才真正合理。如果你只有几兆，你应该能够不费吹灰之力地撕开数据并计算出准确的答案，而不用费心计算估计值。

* * *

## 回答 #5

> 赞同：2
> 
>             
> 
> 时间：2015-01-25T17:35:40.210

您的问题与此相同-http 
  [://www.geeksforgeeks.org/find-the-k-most-frequent-words-from-a-file/](http://www.geeksforgeeks.org/find-the-k-most-frequent-words-from-a-file/)

使用 Trie 和最小堆来高效解决它。

* * *

## 回答 #6

> 赞同：2
> 
>             
> 
> 时间：2008-12-26T00:33:36.193

您的描述中有一个错误：计数需要 O(n) 时间，但排序需要 O(m*lg(m))，其中 m 是**唯一**单词的数量。这通常比单词总数小得多，因此可能应该优化哈希的构建方式。

* * *

## 回答 #7

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T03:22:34.827

您可以通过使用单词的第一个字母进行分区来进一步缩短时间，然后使用下一个字符对最大的多单词集进行分区，直到您有 k 个单单词集。您将使用一种 256 路树，在叶子处包含部分/完整单词的列表。您需要非常小心，不要在各处造成字符串副本。

该算法为 O(m)，其中 m 是字符数。它避免了对 k 的依赖，这对于大 k 非常好 [顺便说一下，您发布的运行时间是错误的，它应该是 O(n*lg(k))，我不确定这是什么米]。

如果你并排运行这两种算法，你会得到我很确定是渐近最优 O(min(m, n*lg(k))) 算法，但我的平均速度应该更快，因为它不涉及散列或排序。

* * *

## 回答 #8

> 赞同：2
> 
>             
> 
> 时间：2015-05-05T22:49:19.987

如果您所追求的是文本中任何实用*k*和任何自然语言的*k*个最常见单词的列表，那么您的算法的复杂性是不相关的。

 *只需从您的文本中**抽取**几百万个单词，在几*秒钟内*使用任何算法对其进行处理，最常见的计数将非常准确。

附带说明一下，虚拟算法的复杂性（1\. 全部计数 2\. 排序计数 3\. 取最好的）是 O(n+m*log(m))，其中 m 是你的不同单词的数量文本。log(m) 远小于 (n/m)，所以它仍然是 O(n)。

**实际上，长步是计数。**

* * *

## 回答 #9

> 赞同：2
> 
>             
> 
> 时间：2016-03-15T04:18:01.450

1.  利用内存高效的数据结构来存储单词

2.  使用 MaxHeap，查找前 K 个频繁词。

这是代码

```
import java.util.ArrayList;
import java.util.Comparator;
import java.util.List;
import java.util.PriorityQueue;

import com.nadeem.app.dsa.adt.Trie;
import com.nadeem.app.dsa.adt.Trie.TrieEntry;
import com.nadeem.app.dsa.adt.impl.TrieImpl;

public class TopKFrequentItems {

private int maxSize;

private Trie trie = new TrieImpl();
private PriorityQueue<TrieEntry> maxHeap;

public TopKFrequentItems(int k) {
    this.maxSize = k;
    this.maxHeap = new PriorityQueue<TrieEntry>(k, maxHeapComparator());
}

private Comparator<TrieEntry> maxHeapComparator() {
    return new Comparator<TrieEntry>() {
        @Override
        public int compare(TrieEntry o1, TrieEntry o2) {
            return o1.frequency - o2.frequency;
        }           
    };
}

public void add(String word) {
    this.trie.insert(word);
}

public List<TopK> getItems() {

    for (TrieEntry trieEntry : this.trie.getAll()) {
        if (this.maxHeap.size() < this.maxSize) {
            this.maxHeap.add(trieEntry);
        } else if (this.maxHeap.peek().frequency < trieEntry.frequency) {
            this.maxHeap.remove();
            this.maxHeap.add(trieEntry);
        }
    }
    List<TopK> result = new ArrayList<TopK>();
    for (TrieEntry entry : this.maxHeap) {
        result.add(new TopK(entry));
    }       
    return result;
}

public static class TopK {
    public String item;
    public int frequency;

    public TopK(String item, int frequency) {
        this.item = item;
        this.frequency = frequency;
    }
    public TopK(TrieEntry entry) {
        this(entry.word, entry.frequency);
    }
    @Override
    public String toString() {
        return String.format("TopK [item=%s, frequency=%s]", item, frequency);
    }
    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + frequency;
        result = prime * result + ((item == null) ? 0 : item.hashCode());
        return result;
    }
    @Override
    public boolean equals(Object obj) {
        if (this == obj)
            return true;
        if (obj == null)
            return false;
        if (getClass() != obj.getClass())
            return false;
        TopK other = (TopK) obj;
        if (frequency != other.frequency)
            return false;
        if (item == null) {
            if (other.item != null)
                return false;
        } else if (!item.equals(other.item))
            return false;
        return true;
    }

} 
```

}

这是单元测试

```
@Test
public void test() {
    TopKFrequentItems stream = new TopKFrequentItems(2);

    stream.add("hell");
    stream.add("hello");
    stream.add("hello");
    stream.add("hello");
    stream.add("hello");
    stream.add("hello");
    stream.add("hero");
    stream.add("hero");
    stream.add("hero");
    stream.add("hello");
    stream.add("hello");
    stream.add("hello");
    stream.add("home");
    stream.add("go");
    stream.add("go");
    assertThat(stream.getItems()).hasSize(2).contains(new TopK("hero", 3), new TopK("hello", 8));
} 
```

有关更多详细信息，请参阅[此测试用例](https://github.com/mnadeem/data-structures-algorithms/blob/master/src/test/java/com/nadeem/app/dsa/algo/stream/TopKFrequentItemsTest.java)

* * *

## 回答 #10

> 赞同：1
> 
>             
> 
> 时间：2017-04-11T03:31:22.757

1.  在遍历整个单词序列时，使用哈希表记录所有单词的频率。在这个阶段，key是“word”，value是“word-frequency”。这需要 O(n) 时间。这与上面解释的每个相同

2.  在将自身插入 hashmap 时，保留大小为 10(k=10) 的 Treeset（特定于 java，每种语言都有实现）以保留前 10 个常用词。直到大小小于 10，继续添加。如果大小等于 10，则如果插入的元素大于最小元素，即第一个元素。如果是，请将其删除并插入新元素

要限制树集的大小，请参阅[此链接](http://www.java2s.com/Code/Java/Collections-Data-Structure/ATreeSetthatensuresitnevergrowsbeyondamaxsize.htm)

* * *

## 回答 #11

> 赞同：0
> 
>             
> 
> 时间：2014-10-09T12:30:29.147

尝试考虑特殊的数据结构来解决此类问题。在这种情况下，特殊类型的树（例如尝试以特定方式存储字符串）非常有效。或者第二种方法来构建自己的解决方案，比如计算单词。我猜这 TB 的数据是英文的，然后我们通常有大约 600,000 个单词，所以可以只存储这些单词并计算哪些字符串会重复 + 这个解决方案需要正则表达式来消除一些特殊字符。第一个解决方案会更快，我很确定。

[http://en.wikipedia.org/wiki/Trie](http://en.wikipedia.org/wiki/Trie)

* * *

## 回答 #12

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T11:44:43.427

假设我们有一个单词序列“ad”“ad”“boy”“big”“bad”“com”“come”“cold”。并且K=2。正如您提到的“使用单词的第一个字母进行分区”，我们得到 ("ad", "ad") ("boy", "big", "bad") ("com" "come" "cold") "然后使用下一个字符划分最大的多词集，直到你有 k 个单词集。” 它将分区（“boy”，“big”，“bad”）（“com”“come”“cold”），错过了第一个分区（“ad”，“ad”），而“ad”实际上是最常用的词。

也许我误解了你的意思。你能详细说明一下你的分区过程吗？

* * *

## 回答 #13

> 赞同：0
> 
>             
> 
> 时间：2015-03-04T13:22:42.367

这是一个有趣的搜索想法，我可以找到与 Top-K 相关的这篇论文[https://icmi.cs.ucsb.edu/research/tech_reports/reports/2005-23.pd](https://icmi.cs.ucsb.edu/research/tech_reports/reports/2005-23.pdf) f

[这里](https://github.com/addthis/stream-lib/blob/master/src/main/java/com/clearspring/analytics/util/TopK.java)也有一个实现。

* * *

## 回答 #14

> 赞同：0
> 
>             
> 
> 时间：2013-10-19T00:26:34.617

我也在为此苦苦挣扎，并受到@aly 的启发。我们可以只维护一个预先排序的单词列表（ ），而不是事后排序，`List<Set<String>>`并且该单词将位于位置 X 的集合中，其中 X 是单词的当前计数。一般来说，它是这样工作的：

1.  对于每个单词，将其存储为它的出现地图的一部分：`Map<String, Integer>`.

2.  然后，根据计数，将其从先前的计数集中删除，并将其添加到新的计数集中。

这样做的缺点是列表可能很大 - 可以通过使用来优化`TreeMap<Integer, Set<String>>`- 但这会增加一些开销。最终我们可以混合使用 HashMap 或我们自己的数据结构。

编码

```
public class WordFrequencyCounter {
    private static final int WORD_SEPARATOR_MAX = 32; // UNICODE 0000-001F: control chars
    Map<String, MutableCounter> counters = new HashMap<String, MutableCounter>();
    List<Set<String>> reverseCounters = new ArrayList<Set<String>>();

    private static class MutableCounter {
        int i = 1;
    }

    public List<String> countMostFrequentWords(String text, int max) {
        int lastPosition = 0;
        int length = text.length();
        for (int i = 0; i < length; i++) {
            char c = text.charAt(i);
            if (c <= WORD_SEPARATOR_MAX) {
                if (i != lastPosition) {
                    String word = text.substring(lastPosition, i);
                    MutableCounter counter = counters.get(word);
                    if (counter == null) {
                        counter = new MutableCounter();
                        counters.put(word, counter);
                    } else {
                        Set<String> strings = reverseCounters.get(counter.i);
                        strings.remove(word);
                        counter.i ++;
                    }
                    addToReverseLookup(counter.i, word);
                }
                lastPosition = i + 1;
            }
        }

        List<String> ret = new ArrayList<String>();
        int count = 0;
        for (int i = reverseCounters.size() - 1; i >= 0; i--) {
            Set<String> strings = reverseCounters.get(i);
            for (String s : strings) {
                ret.add(s);
                System.out.print(s + ":" + i);
                count++;
                if (count == max) break;
            }
            if (count == max) break;
        }
        return ret;
    }

    private void addToReverseLookup(int count, String word) {
        while (count >= reverseCounters.size()) {
            reverseCounters.add(new HashSet<String>());
        }
        Set<String> strings = reverseCounters.get(count);
        strings.add(word);
    }

} 
```

* * *

## 回答 #15

> 赞同：0
> 
>             
> 
> 时间：2013-06-13T03:03:11.550

我相信这个问题可以通过 O(n) 算法来解决。我们可以即时进行分类。换句话说，这种情况下的排序是传统排序问题的一个子问题，因为每次访问哈希表时只有一个计数器加一。最初，列表是排序的，因为所有计数器都为零。当我们不断增加哈希表中的计数器时，我们记下另一个按频率排序的哈希值数组，如下所示。每次我们增加一个计数器时，我们都会检查它在排名数组中的索引，并检查它的计数是否超过了它在列表中的前任。如果是这样，我们交换这两个元素。因此，我们获得了一个最多为 O(n) 的解决方案，其中 n 是原始文本中的单词数。

* * *

## 回答 #16

> 赞同：0
> 
>             
> 
> 时间：2014-02-09T21:28:21.443

我只是找出这个问题的其他解决方案。但我不确定它是否正确。解决方案：

1.  使用哈希表记录所有单词的频率 T(n) = O(n)

2.  选择哈希表的前 k 个元素，并将它们恢复到一个缓冲区（其空间 = k）中。T(n) = O(k)

3.  每次，首先我们需要找到缓冲区的当前最小元素，并将缓冲区的最小元素与哈希表的（n - k）个元素一一进行比较。如果哈希表的元素大于缓冲区的最小元素，则删除当前缓冲区的最小值，并添加哈希表的元素。所以每次我们在缓冲区中找到最小的一个需要T(n) = O(k)，遍历整个哈希表需要T(n) = O(n - k)。所以这个过程的整个时间复杂度是 T(n) = O((nk) * k)。

4.  遍历整个哈希表后，结果就在这个缓冲区中。

5.  整个时间复杂度：T(n) = O(n) + O(k) + O(kn - k^2) = O(kn + n - k^2 + k)。因为，k 通常确实小于 n。所以对于这个解决方案，时间复杂度是**T(n) = O(kn)**。那是线性时间，当 k 非常小时。这样对吗？我真的不确定。

* * *

## 回答 #17

> 赞同：0
> 
>             
> 
> 时间：2015-10-08T12:35:12.490

最简单的代码来获取最常用单词的出现。

```
 function strOccurence(str){
    var arr = str.split(" ");
    var length = arr.length,temp = {},max; 
    while(length--){
    if(temp[arr[length]] == undefined && arr[length].trim().length > 0)
    {
        temp[arr[length]] = 1;
    }
    else if(arr[length].trim().length > 0)
    {
        temp[arr[length]] = temp[arr[length]] + 1;

    }
}
    console.log(temp);
    var max = [];
    for(i in temp)
    {
        max[temp[i]] = i;
    }
    console.log(max[max.length])
   //if you want second highest
   console.log(max[max.length - 2])
} 
```

* * *

## 回答 #18

> 赞同：0
> 
>             
> 
> 时间：2017-09-01T15:51:32.817

```
** 
```

> 上述思想的C++11实现

**

```
class Solution {
public:
vector<int> topKFrequent(vector<int>& nums, int k) {

    unordered_map<int,int> map;
    for(int num : nums){
        map[num]++;
    }

    vector<int> res;
    // we use the priority queue, like the max-heap , we will keep (size-k) smallest elements in the queue
    // pair<first, second>: first is frequency,  second is number 
    priority_queue<pair<int,int>> pq; 
    for(auto it = map.begin(); it != map.end(); it++){
        pq.push(make_pair(it->second, it->first));

        // onece the size bigger than size-k, we will pop the value, which is the top k frequent element value 

        if(pq.size() > (int)map.size() - k){
            res.push_back(pq.top().second);
            pq.pop();
        }
    }
    return res;

} 
```

};

* * *

## 回答 #19

> 赞同：0
> 
>             
> 
> 时间：2016-09-25T19:33:26.230

在这些情况下，我建议使用 Java 内置功能。因为，它们已经过良好的测试和稳定。在这个问题中，我通过使用 HashMap 数据结构来查找单词的重复。然后，我将结果推送到对象数组。我通过 Arrays.sort() 对对象进行排序并打印前 k 个单词及其重复项。

```
import java.io.*;
import java.lang.reflect.Array;
import java.util.*;

public class TopKWordsTextFile {

    static class SortObject implements Comparable<SortObject>{

        private String key;
        private int value;

        public SortObject(String key, int value) {
            super();
            this.key = key;
            this.value = value;
        }

        @Override
        public int compareTo(SortObject o) {
            //descending order
            return o.value - this.value;
        }
    }

    public static void main(String[] args) {
        HashMap<String,Integer> hm = new HashMap<>();
        int k = 1;
        try {
            BufferedReader br = new BufferedReader(new InputStreamReader(new FileInputStream("words.in")));

            String line;
            while ((line = br.readLine()) != null) {
                // process the line.
                //System.out.println(line);
                String[] tokens = line.split(" ");
                for(int i=0; i<tokens.length; i++){
                    if(hm.containsKey(tokens[i])){
                        //If the key already exists
                        Integer prev = hm.get(tokens[i]);
                        hm.put(tokens[i],prev+1);
                    }else{
                        //If the key doesn't exist
                        hm.put(tokens[i],1);
                    }
                }
            }
            //Close the input
            br.close();
            //Print all words with their repetitions. You can use 3 for printing top 3 words.
            k = hm.size();
            // Get a set of the entries
            Set set = hm.entrySet();
            // Get an iterator
            Iterator i = set.iterator();
            int index = 0;
            // Display elements
            SortObject[] objects = new SortObject[hm.size()];
            while(i.hasNext()) {
                Map.Entry e = (Map.Entry)i.next();
                //System.out.print("Key: "+e.getKey() + ": ");
                //System.out.println(" Value: "+e.getValue());
                String tempS = (String) e.getKey();
                int tempI = (int) e.getValue();
                objects[index] = new SortObject(tempS,tempI);
                index++;
            }
            System.out.println();
            //Sort the array
            Arrays.sort(objects);
            //Print top k
            for(int j=0; j<k; j++){
                System.out.println(objects[j].key+":"+objects[j].value);
            }

        } catch (IOException e) {
            e.printStackTrace();
        }
    }

} 
```

欲了解更多信息，请访问[https://github.com/m-vahidalizadeh/foundations/blob/master/src/algorithms/TopKWordsTextFile.java](https://github.com/m-vahidalizadeh/foundations/blob/master/src/algorithms/TopKWordsTextFile.java)。我希望它有所帮助。

# copy - 如何使用 Windows Batch 复制文件？

> ID：185698
> 
>         
> 
> 赞同：5
> 
>         
> 
> 时间：2008-10-09T02:24:21.857
> 
>         
> 
> 标签：copy, batch-file, cmd

我有一个目录，其中包含几个带有文件的子目录。

如何将子目录中的所有文件复制到新位置？

**编辑：**我不想复制目录，只是文件......

由于这仍然在 XP 上，我选择了以下解决方案：

```
 for /D %S IN ("src\*.*") DO  @COPY "%S\" "dest\" 
```

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
>             
> 
> 时间：2008-10-09T03:01:24.433

行。通过您的编辑说您不想要目录结构，我认为您将要使用以下内容：

```
for /F "usebackq" %s IN (`DIR /B /S /A-D SrcDir`) DO @(
    XCOPY %s DestDir\%~nxs
) 
```

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2008-10-09T02:26:29.557

Xcopy 命令在这里应该有所帮助。

```
XCOPY /E SrcDir\*.* DestDir\ 
```

或者，如果您不需要 SrcDir 中的任何文件，只需要子目录，则可以将 XCOPY 与 FOR 命令结合使用：

```
FOR /D %s IN (SrcDir\*) DO @XCOPY /E %s DestDir\%~ns\ 
```

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T02:29:55.823

`robocopy "c:\source" "c:\destination" /E`

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T02:47:10.593

如果我对您的理解正确，那么您有一个很大的目录树，并且您希望其中的所有文件都在一个目录中。如果这是正确的，那么我可以分两行来做：

```
dir /s /b "yourSourceDirectoryTreeHere" > filelist.txt
for /f %f in (filelist.txt) do @copy %f "yourDestinationDirHere" 
```

在批处理文件与命令行中，将 %f 更改为 %%f

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T02:27:50.180

如果您想在另一端保持相同的文件夹结构，听起来就像 XCOPY 一样简单

> xcopy c:\old\*.* d:\new\ /s

如果您也想复制空目录，请使用 /e 而不是 /s。

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T02:48:42.510

```
 for /D %S IN ("src\*.*") DO  @COPY "%S\" "dest\" 
```

# winforms - Winform 缓存

> ID：185706
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-10-09T02:27:03.723
> 
>         
> 
> 标签：winforms, caching

那里有 Winform 缓存库吗？我需要在 Winform 应用程序中传递一些数据集，并且可能会在关闭时持久存储。

我已经通过 Google 使用 System.Web 看到了一些示例。

有什么建议，我在哪里可以获得一些详细信息。我将 VS 2008 用于 2.0。3.0 框架。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T02:33:11.650

从 .NET 2.0 开始，您可以将 System.Web.Caching.Cache 类与非 ASP.NET 应用程序一起使用。不过，这些天微软推荐的方法是使用企业库缓存应用程序块。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-10-20T19:01:55.850

如果您想将数据集持久化到某个临时存储机制，那么 DataSet 确实支持 ToXml() 和 FromXml() 功能（我忘记了确切的方法名称）。

# jsp - IE 切掉 DIV 的左侧

> ID：185709
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-10-09T02:27:14.597
> 
>         
> 
> 标签：jsp, html, menu, slider

在 IE6 中，`#right-content`DIV 的左侧被切断。我一直在玩它，但无法正常显示。

[http://philzit.com/services](http://philzit.com/services)

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2008-10-09T02:36:47.540

原因是 #right-content div 上的 -60px 边距。

您可以尝试添加

```
position:realtive
zoom:1 
```

因为这些经常为我解决这些问题。

# api - 您是否会将下一代火星探测器的控制 API 构建为 RESTful 而不是 RPC？

> ID：185740
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2008-10-09T02:41:22.257
> 
>         
> 
> 标签：api, rest, ipc, rpc, robotics

如果这几乎是一个“讨论”问题，请原谅我，但我真的很感激是/否的答案，并有适当的解释。  

假设你必须为机器人设计和实现一个控制 API，比如下一代火星探测器。您是根据 RESTful 原则构建此 API，还是使用经典的 RPC，例如 XMLRPC？  

我问这个是因为我必须做类似的事情，尽管“机器人”是虚拟机的集合。一位颇有说服力的工程师（一位著名的 REST 倡导者）敦促我让 API 成为 RESTful。我从未使用过 REST 原则，并且我正在努力了解它们如何适合设计低级进程间 API。REST 似乎融入了与可修改的数据存储库交互的主题，通常距离很远。我正在尝试做的事情更像是在密切控制一个机器人。我可以看出人们如何争辩说，抽象地说，机器人只是一个数据存储库——“PUT 左转”、“PUT 行进 100 米”、“获取外部温度”。但这似乎是一个相当做作的模型。我当然不会从缓存或代理中获得任何好处（“你好，喷气推进实验室？这是堪培拉的 Akamai co-lo。我们现在要接管 Rover，好吗？”）

那么，RESTful 架构在这里有用吗？即使交互如此狭窄，它仍然优于 RPC 吗？

* * *

## 回答 #1

> 赞同：7
> 
>             
> 
> 时间：2008-10-09T02:57:13.910

我认为 REST 比传统的 RPC 更有意义。甚至[Micorosft Robotics Studio 运行时应用程序模型也](http://msdn.microsoft.com/en-us/library/bb466255.aspx)使用 REST。

机器人可以由 URI 标识的不同资源组成，包括一个用于每个传感器和执行器的资源或它们的复合抽象。

REST 强调保证某些方法的副作用是什么，并且它还促进了缓存，这两者对于控制和监视远程机器人之类的事情都很有用。并且仅仅因为您可以使用 REST，它**不必**是 HTTP 协议。

不过，像 GET 这样的安全和 IDEMPOTENT 方法对于跟踪机器人的状态和轮询其传感器数据很有用。您可以使用 Last-Modified 标头之类的内容来检索不经常更改的缓存传感器数据（例如，湿度或光照水平）。

对于长距离，您可以使用中继代理进行缓存。

对于移动机器人的命令，将使用类似 POST 的命令，其中每条此类消息都会改变机器人（例如，向右转）。可以返回一个状态代码，指示该命令是立即执行还是排队等待处理。

任何资源的绝对状态都可以使用诸如 PUT 之类的东西来设置，其中多条消息不会改变任何东西，而不仅仅是一条消息（例如，指向北极或将前灯调暗到 10% 亮度）。这允许在消息在途中丢失的情况下进行可靠的消息传递。

也可以通过类似POST 的操作来创建新资源，例如，数据收集例程和一组参数。POST 请求可以返回一个带有新资源 URI 的 CREATED 结果，当不再需要时可以使用该 URI 删除。

一组机器人也可以使用相同的基于 REST 的协议相互交谈，并享受相同的好处。

诚然，对于像一个人控制一个孤立的本地机器人这样简单的事情，REST API 可能是矫枉过正。但是对于多用户和/或不可靠的通信渠道和/或 Web 规模的网络，REST 是需要考虑的。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T03:01:10.753

REST 原则确保您的应用程序可以很好地扩展，并与 Internet 上的中介（代理、缓存等）很好地配合使用。如果您的“虚拟机”网络规模很大，那么 RESTful 架构可能是有利的。如果你正在构建一个小规模的网络，那么 REST 就不会那么引人注目。

# wpf - BitmapSource 是唯一可以在 Image Source 中使用的类型吗？

> ID：185741
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-10-09T02:42:06.173
> 
>         
> 
> 标签：wpf, bitmap, bitmapsource

我们可以使用 Bitmapsource 对象作为 Image 控件的内容，但是如果我只有 Bitmap 对象，是否可以直接使用它，如果我使用以下方法将 Bitmap 转换为 Bitmapsouce：

```
 Bitmap bitmap = imageObjToBeConvert;
        IntPtr HBitmap = bitmap.GetHbitmap();
        result = Imaging.CreateBitmapSourceFromHBitmap
            (HBitmap,
            IntPtr.Zero,
            Int32Rect.Empty,
            BitmapSizeOptions.FromEmptyOptions());
        DeleteObject(HBitmap);
        bitmap.Dispose(); 
```

这需要一些时间。有没有办法直接使用Bitmap？

而且我发现BitmapSource好像不能直接释放，有没有示例方法可以立即释放内存，Bitmapsouce不再使用后。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T03:08:02.923

*   System.Windows.Media.Imaging..::.BitmapFrame

*   System.Windows.Media.Imaging..::.BitmapImage

*   System.Windows.Media.Imaging..::.CachedBitmap

*   System.Windows.Media.Imaging..::.ColorConvertedBitmap

*   System.Windows.Media.Imaging..::.CroppedBitmap

*   System.Windows.Media.Imaging..::.FormatConvertedBitmap

*   System.Windows.Media.Imaging..::.RenderTargetBitmap

*   System.Windows.Media.Imaging..::.TransformedBitmap

*   System.Windows.Media.Imaging..::.WriteableBitmap

所有这些类都继承自 BitMapSource，因此它们中的任何一个都可以在该上下文中使用。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T19:31:13.873

不，您不能`Bitmap`直接使用。这是因为`System.Drawing.Bitmap`它是一个 GDI+ 位图，而像`BitmapImage`in这样的类`System.Windows.Media.Imaging`是 D3D/DirectX。

关于内存使用，您不能直接释放它，但通常在后台会有某种缓存。您可以通过多种方式加载 a`BitmapImage`以使其忽略缓存。

# java - 如何在 Java 中将 int 转换为三个字节？

> ID：185747
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-10-09T02:45:40.020
> 
>         
> 
> 标签：java, bit-manipulation, byte, bit-shift

我正在尝试将一个转换`int`为`bytes`三个代表那个`int`（大端）。

我确信它与按位和位移有关。但我不知道该怎么做。

例如：

```
int myInt;

// some code

byte b1, b2 , b3; // b1 is most significant, then b2 then b3. 
```

*注意，我知道一个 int 是 4 个字节，这三个字节有可能上溢/下溢。

* * *

## 回答 #1

> 赞同：14
> 
>             
> 
> 时间：2008-10-09T02:56:41.337

要获取最低有效字节：

```
b3 = myInt & 0xFF; 
```

第二个最低有效字节：

```
b2 = (myInt >> 8) & 0xFF; 
```

第三个最低有效字节：

```
b1 = (myInt >> 16) & 0xFF; 
```

**解释：**

将值与 0xFF（二进制 11111111）按位与将返回该数字中的最低有效 8 位（位 0 到 7）。将数字向右移动 8 次会将位 8 到 15 放入位位置 0 到 7，因此与 0xFF 进行与运算将返回第二个字节。类似地，将数字向右移动 16 次会将位 16 到 23 放入位位置 0 到 7，因此与 0xFF 进行“与”运算会返回第 3 个字节。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2008-10-09T02:52:47.663

```
byte b1 = (myint >> 16) & 0xff;
byte b2 = (myint >> 8) & 0xff;
byte b3 = myint & 0xff; 
```

我不确定这在 java 中是如何保存的，我不是 java 开发人员

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T02:51:17.573

一个 int 不适合 3 个字节。但是，假设您知道这些特定的：

```
 byte b1 = (myInt & 0xff);
   myInt >>= 8;
   byte b2 = (myInt & 0xff);
   myInt >>= 8;
   byte b3 = (myInt & 0xff); 
```

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2009-10-30T09:13:18.407

在 Java 中

```
int myInt = 1;
byte b1,b2,b3;
b3 = (byte)(myInt & 0xFF);
b2 = (byte)((myInt >> 8) & 0xFF);
b1 = (byte)((myInt >> 16) & 0xFF);
System.out.println(b1+" "+b2+" "+b3); 
```

输出**0 0 1**

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2020-04-15T20:45:11.180

Jeremy 的答案在正整数值的情况下是正确的。如果负值的转换应该是正确的，那么由于二进制补码格式（[https://en.wikipedia.org/wiki/Two%27s_complement](https://en.wikipedia.org/wiki/Two%27s_complement)），它会稍微复杂一些。诀窍是消除有趣位（较低有效位）和“符号”位之间的差距。一种简单的方法是数字相乘。

```
 int myIntMultiplied = myInt * 256;

    byte b1, b2, b3;

    b3 = (byte) ((myIntMultiplied >> 8) & 0xFF);
    b2 = (byte) ((myIntMultiplied >> 16) & 0xFF);
    b1 = (byte) ((myIntMultiplied >> 24) & 0xFF); 
```

这将得到正确的负值补码格式。

PS：您可以通过这种方式检查和比较二进制表示：

```
Integer.toBinaryString(myInt);
Integer.toBinaryString(myIntMultiplied ); 
```

# apache-flex - 访问 flash.net.URLLoader 对象的 HTTP 响应标头？

> ID：185761
> 
>         
> 
> 赞同：17
> 
>         
> 
> 时间：2008-10-09T02:49:42.880
> 
>         
> 
> 标签：apache-flex, flash, actionscript-3, http-headers, urlloader

使用 Flash/Flex 时，有没有办法从 HTTP 结果访问响应标头`URLLoader`？

设置*请求*标头是可能的，就像访问*响应代码*一样，但获取实际响应标头似乎明显缺乏......

具体来说，我想掌握`Last-Modified`响应标头。

* * *

## 回答 #1

> 赞同：14
> 
>             
> 
> 时间：2008-10-09T02:54:09.317

哎呀。在这里回答我自己的问题，但 AIR 引入了[`URLLoader.httpResponseStatus`](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/net/URLLoader.html#event:httpResponseStatus)包含`responseHeaders`属性（加上`responseURL`布朗尼点属性）的事件。

谢天谢地，我的问题是针对 AIR 应用程序的，这样就解决了我的问题。非 AIR flash/flex 应用程序似乎无法访问响应标头仍然有点令人震惊。

# php - 在 PHP 中使用 trigger_error 时如何获取正确的行号？

> ID：185778
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-10-09T02:58:16.873
> 
>         
> 
> 标签：php, error-handling

我正在使用 trigger_error 在自定义类中“抛出”错误。我的问题是 trigger_error 打印出调用 trigger_error 的行号。例如，给定以下代码：

```
01    <?php
02        class Test {
03            function doAction() {
04                $this->doSubAction();
05            }
06            
07            function doSubAction() {
08                if(true)
09                    trigger_error('Custom error', E_USER_WARNING);
10            }
11        }
12        
13        $var = new Test();
14        $var->doAction();
15    ?> 
```

PHP 将打印出以下内容：

> **警告：第****9**行**test.php**中的自定义错误

 **您如何让 PHP 返回调用 doAction() 函数的行（在类外部调用的方法，忽略内部进行的所有调用），如下所示？

> **警告：第****14**行**test.php**中的自定义错误

 ****编辑：**将我的示例修改为更接近我想要实现的目标。

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T03:08:37.960

最好的办法是设置一个显示完整堆栈跟踪的错误处理程序。

设置一个自定义错误处理程序，并在其中调用 debug_print_backtrace()。您会发现这通常很有用，在这种特定情况下也是如此。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2009-07-17T19:59:16.607

好的，对于那些对我的最终解决方案感兴趣的人，我在我们的框架中集成了以下代码，它在我们可以测试的所有情况下返回正确的行号。我们在生产中使用它。

[`ErrorHandler`班级](http://pastebin.com/f12a290d1)

它捕获未捕获的 PHP 异常、PHP 错误和`PEAR::Error`s. 如果代码具有一些特定于框架的功能，您将需要对其进行一些修改，但它们应该不难追踪。享受！

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T03:20:44.800

两种选择，没有一种特别好吃：

*   覆盖在参数中提供 test() `__LINE__`（例如“ `test(__LINE__)`”，并将参数提供给 trigger_error）。设置错误处理程序以打印自定义错误消息。**注意：**这非常丑陋。:-)

*   设置一个错误处理程序，并让它调用并处理 debug_backtrace() 的巨大输出。此功能在调试时很有用......但对于您正在尝试做的事情来说太过分了。请不要将此功能用作系统常规操作的一部分。

简短的回答：太难了，不要尝试。:-|

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T04:19:03.840

我通常也会在那里放一个 trigger_error() 。这可以确保我确切地知道它被调用的位置以及实际错误发生的位置。然后，我在生产时通过电子邮件将所有错误发送给自己。我知道这不是自动的，但至少你可以追踪发生了什么。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2016-02-10T00:45:39.913

我想我会把我的两分钱投入锅中，并讨论我通常使用的东西，无论是按原样还是进行小的定制，我构建的 PHP 库经常被其他开发人员使用。

我将程序执行过程中可能出现的错误分为两类：错误编程导致的错误和由于用户错误或某些外部因素导致的错误。对于前者，我将 trigger_error 与 E_USER_ERROR 结合使用，后者是一个异常，特别是一个包异常，然后由库中的所有其他异常继承。

开发错误的一个例子是在参数中传递一个整数，该参数应该是一个字符串（V7 之前），或者访问一个不存在的类的方法或属性。（您可以在这里发挥您自己的开发人员想象力。）显然，另一个开发人员不会关心错误是在 __get 或 __set 语句或其他一些魔术构造的深处产生的，而是他们会想知道特别是他们的错误在哪里。让我们面对现实吧……开发人员不喜欢费力地回溯。

所以我用来本地化错误消息的方法很简单：

```
function localize_error_msg($msg, $level) {
    $level = (int)$level;
    $backtrace = debug_backtrace(DEBUG_BACKTRACE_IGNORE_ARGS, $level + 1)[$level];
    return $msg . " in " . $backtrace['file'] . " on line " . $backtrace['line'];
} 
```

我传入取决于所使用的构造的回溯级别，通常为 1 或 2，其余的都是不言自明的。

为了防止“in file on line n”的重复序列，我添加了这个错误处理程序：

```
set_error_handler(function($errno, $errstr, $errfile, $errline) {
    if (preg_match('/on line \d+$/', $errstr) === 1)
        die($errstr);
    else return false;
}, E_USER_ERROR | E_USER_WARNING | E_USER_NOTICE); 
```

同样，我喜欢保持简单。有人可能会争辩说，错误消息的本地化应该在处理程序中进行，但是，您必须能够传递深度，现在处理程序内部的深度又增加了 2 层，而且，它在之后变得混乱那。

快乐的足迹！

# objective-c - 修改 NSDate 以表示从今天开始的 1 个月

> ID：185780
> 
>         
> 
> 赞同：16
> 
>         
> 
> 时间：2008-10-09T03:00:30.207
> 
>         
> 
> 标签：objective-c, cocoa, nsdate

我正在向我正在开发的 Cocoa 应用程序添加重复事件。我每天和每周都重复，因为我可以用数学方法定义这些（3600*24*7 = 1 周）。我使用以下代码来修改日期：

```
[NSDate dateWithTimeIntervalSinceNow:(3600*24*7*(weeks))] 
```

我知道自从事件重复以来已经过去了几个月，但我不知道如何制作一个代表未来 1 个月/3 个月/6 个月/9 个月的 NSDate 对象。理想情况下，我希望用户说从 10 月 14 日开始每月重复一次，它将在每个月的 14 号重复一次。

* * *

## 回答 #1

> 赞同：37
> 
>             
> 
> 时间：2008-10-09T06:20:02.847

（几乎和[这个问题](https://stackoverflow.com/questions/181459/is-there-a-better-way-to-find-midnight-tomorrow/181495#181495)一样。）

从[文档](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSCalendarDate_Class/Reference/Reference.html)中：

> 强烈建议不要使用 NSCalendarDate。它还没有被弃用，但它可能会在 Mac OS X v10.5 之后的下一个主要操作系统版本中出现。对于日历计算，您应该使用 NSCalendar、NSDate 和 NSDateComponents 的合适组合，如[Cocoa 的日期和时间编程主题](http://developer.apple.com/documentation/Cocoa/Conceptual/DatesAndTimes/DatesAndTimes.html)中的日历中所述。

遵循该建议：

```
NSDate *today = [NSDate date];

NSCalendar *gregorian = [[NSCalendar alloc] initWithCalendarIdentifier:NSGregorianCalendar];

NSDateComponents *components = [[NSDateComponents alloc] init];
components.month = 1;
NSDate *nextMonth = [gregorian dateByAddingComponents:components toDate:today options:0];
[components release];

NSDateComponents *nextMonthComponents = [gregorian components:NSYearCalendarUnit | NSMonthCalendarUnit fromDate:nextMonth];

NSDateComponents *todayDayComponents = [gregorian components:NSDayCalendarUnit fromDate:today];

nextMonthComponents.day = todayDayComponents.day;
NSDate *nextMonthDay = [gregorian dateFromComponents:nextMonthComponents];

[gregorian release]; 
```

可能会有更直接或更有效的实现，但这应该是准确的，并且应该指向正确的方向。

* * *

## 回答 #2

> 赞同：22
> 
>             
> 
> 时间：2010-04-05T05:01:49.937

使用 NSCalender、NSDateComponents 和 NSDate：

```
NSDateComponents *components = [[[NSDateComponents alloc] init] autorelease];
components.month = 1;
NSDate *oneMonthFromNow = [[NSCalendar currentCalendar] dateByAddingComponents:components toDate:[NSDate date] options:0]; 
```

只需设置不同的属性`components`即可获得不同的时间段（例如 3 个月、6 个月等）。

注意：根据上下文，如果“1 个月”的意思是“公历上的 1 个月” ，您可能想要使用`[[[NSCalendar alloc] initWithCalendarIdentifier:NSGregorianCalendar] autorelease]`而不是。`[NSCalendar currentCalendar]`

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T04:17:22.300

我可能会使用 NSCalendarDate。

获取当前日期的 dayOfMonth、monthOfYear 和 yearOfCommonEra，作为三个数字。

添加所需的月数（1/3/6/9），注意 1）该日期是否存在（例如，非闰年的 4 月 31 日、2 月 29 日），以及 2）年的展期。

使用 NSCalendarDate 的 initWithYear:month:day:hour:minute:second:timeZone 创建新日期：

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2009-02-16T07:31:16.620

**新 SDK 不再支持**NSCalendarDate ，在构建分发时会出现问题。****

 *** * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2012-07-17T06:23:24.193

您可以执行以下操作：

```
NSDate *today = [NSDate date];

NSCalendar *gregorian = [[NSCalendar alloc] initWithCalendarIdentifier:NSGregorianCalendar];

NSDateComponents *components = [[NSDateComponents alloc] init];
components.month = 1;
NSDate *nextMonth = [gregorian dateByAddingComponents:components toDate:today options:0];
[components release];

NSDateComponents *nextMonthComponents = [gregorian components:NSYearCalendarUnit | NSMonthCalendarUnit | NSDayCalendarUnit fromDate:nextMonth];
NSDate *nextMonthDay = [gregorian dateFromComponents:nextMonthComponents];

[gregorian release]; 
```

# algorithm - 查找一系列数字的 LCM

> ID：185781
> 
>         
> 
> 赞同：21
> 
>         
> 
> 时间：2008-10-09T03:00:30.440
> 
>         
> 
> 标签：algorithm, math, lcm

我今天阅读了一篇有趣的 DailyWTF 帖子，[“Out of All The possible Answers...”](http://thedailywtf.com/Articles/Out-of-All-the-Possible-Answers.aspx) ，它让我非常感兴趣，以至于我挖掘了它提交的原始[论坛帖子。](http://forums.thedailywtf.com/forums/t/10030.aspx)这让我开始思考如何解决这个有趣的问题——最初的问题是在[Project Euler](http://projecteuler.net/index.php?section=problems&id=5)上提出的：

> 2520 是可以除以 1 到 10 的每个数字而没有任何余数的最小数字。
> 
>   
>   
> 
> 能被 1 到 20 的所有数整除的最小数是多少？

要将其改造成一个编程问题，**您将如何创建一个可以找到任意数字列表的最小公倍数的函数？**

尽管我对编程很感兴趣，但我在纯数学方面非常糟糕，但经过一些谷歌搜索和一些实验后，我能够解决这个问题。我很好奇 SO 用户可能采取的其他方法。如果您愿意，请在下面发布一些代码，并附上解释。请注意，虽然我确定存在用于以各种语言计算 GCD 和 LCM 的库，但我对比调用库函数更直接地显示逻辑的东西更感兴趣:-)

我最熟悉 Python、C、C++ 和 Perl，但欢迎您使用任何喜欢的语言。为像我这样的其他数学挑战者解释逻辑的奖励积分。

**编辑**：提交后，我确实找到了这个类似的问题[Least common multiple for 3 or more numbers](https://stackoverflow.com/questions/147515)，但它的回答与我已经想出的相同基本代码相同，没有真正的解释，所以我觉得这足以让我保持开放。

* * *

## 回答 #1

> 赞同：20
> 
>             
> 
> 时间：2008-10-13T01:34:34.627

答案根本不需要任何花哨的步法来分解或主要的力量，当然也不需要埃拉托色尼筛法。

相反，您应该通过使用欧几里得算法（不需要分解，实际上速度明显更快）计算 GCD 来计算单对的 LCM：

```
 def lcm(a,b):
    gcd, tmp = a,b
    while tmp != 0:
        gcd,tmp = tmp, gcd % tmp
    return a*b/gcd 
```

然后你可以使用上面的 lcm() 函数找到我减少数组的总 LCM：

```
 reduce(lcm, range(1,21)) 
```

* * *

## 回答 #2

> 赞同：12
> 
>             
> 
> 时间：2008-10-09T04:14:07.313

这个问题很有趣，因为它不需要你找到任意一组数字的 LCM，你得到了一个连续的范围。您可以使用[埃拉托色尼筛法](http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes)的变体来找到答案。

```
def RangeLCM(first, last):
    factors = range(first, last+1)
    for i in range(0, len(factors)):
        if factors[i] != 1:
            n = first + i
            for j in range(2*n, last+1, n):
                factors[j-first] = factors[j-first] / factors[i]
    return reduce(lambda a,b: a*b, factors, 1) 
```

* * *

编辑：最近的一次投票让我重新审视了这个超过 3 年的答案。我的第一个观察是，我今天会用一些不同的方式来写它，`enumerate`例如使用。为了使其与 Python 3 兼容，需要进行一些小的更改。

第二个观察结果是，该算法仅在范围开始为 2 或更少时才有效，因为它不会尝试筛选出范围开始以下的公因子。例如，RangeLCM(10, 12) 返回 1320 而不是正确的 660。

第三个观察结果是，没有人试图将这个答案与任何其他答案进行计时。我的直觉说，随着范围变大，这将比蛮力 LCM 解决方案有所改善。测试证明我的直觉是正确的，至少这一次。

由于该算法不适用于任意范围，因此我重写了它以假设范围从 1 开始。我删除了`reduce`最后的调用，因为生成因子时更容易计算结果。我相信新版本的功能更正确也更容易理解。

```
def RangeLCM2(last):
    factors = list(range(last+1))
    result = 1
    for n in range(last+1):
        if factors[n] > 1:
            result *= factors[n]
            for j in range(2*n, last+1, n):
                factors[j] //= factors[n]
    return result 
```

以下是与原始的一些时间比较以及[Joe Bebel](https://stackoverflow.com/a/196472/5987)`RangeEuclid`在我的测试中提出的解决方案。

```
>>> t=timeit.timeit
>>> t('RangeLCM.RangeLCM(1, 20)', 'import RangeLCM')
17.999292996735676
>>> t('RangeLCM.RangeEuclid(1, 20)', 'import RangeLCM')
11.199833288867922
>>> t('RangeLCM.RangeLCM2(20)', 'import RangeLCM')
14.256165588084514
>>> t('RangeLCM.RangeLCM(1, 100)', 'import RangeLCM')
93.34979585394194
>>> t('RangeLCM.RangeEuclid(1, 100)', 'import RangeLCM')
109.25695507389901
>>> t('RangeLCM.RangeLCM2(100)', 'import RangeLCM')
66.09684505991709 
```

对于问题中给出的 1 到 20 的范围，欧几里德的算法击败了我的旧答案和新答案。对于 1 到 100 的范围，您可以看到基于筛的算法领先，尤其是优化版本。

* * *

## 回答 #3

> 赞同：10
> 
>             
> 
> 时间：2012-05-18T07:34:35.270

有一个快速的解决方案，只要范围是 1 到 N。

关键的观察结果是，如果`n`(< N) 具有素因子分解  ，那么它将对 LCM 贡献与和, ...`p_1^a_1 * p_2^a_2 * ... p_k * a_k`完全相同的因子。而且这些权力中的每一个也在1到N的范围内。因此，我们只需要考虑小于 N 的最高纯素数幂。`p_1^a_1``p_2^a_2``p_k^a_k`

例如对于 20 我们有

```
2^4 = 16 < 20
3^2 = 9  < 20
5^1 = 5  < 20
7
11
13
17
19 
```

将所有这些素数相乘，我们得到所需的结果

```
2*2*2*2*3*3*5*7*11*13*17*19 = 232792560 
```

所以在伪代码中：

```
def lcm_upto(N):
  total = 1;
  foreach p in primes_less_than(N):
    x=1;
    while x*p <= N:
      x=x*p;
    total = total * x
  return total 
```

现在您可以调整内部循环以稍微不同地工作以获得更快的速度，并且您可以预先计算`primes_less_than(N)`函数。

编辑：

由于最近的一次投票，我决定重新审视这个，看看与其他列出的算法的速度比较如何。

针对 Joe Beibers 和 Mark Ransoms 方法的 1-160 范围和 10k 次迭代的时序如下：

乔斯：1.85 秒标记：3.26 秒我的：0.33 秒

这是一个日志对数图，结果最多为 300。

![带有结果的对数图](https://i.stack.imgur.com/CpGUw.png)

我的测试代码可以在这里找到：

```
import timeit

def RangeLCM2(last):
    factors = range(last+1)
    result = 1
    for n in range(last+1):
        if factors[n] > 1:
            result *= factors[n]
            for j in range(2*n, last+1, n):
                factors[j] /= factors[n]
    return result

def lcm(a,b):
    gcd, tmp = a,b
    while tmp != 0:
        gcd,tmp = tmp, gcd % tmp
    return a*b/gcd

def EuclidLCM(last):
    return reduce(lcm,range(1,last+1))

primes = [
 2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 
 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 
 73, 79, 83, 89, 97, 101, 103, 107, 109, 113, 
 127, 131, 137, 139, 149, 151, 157, 163, 167, 173, 
 179, 181, 191, 193, 197, 199, 211, 223, 227, 229, 
 233, 239, 241, 251, 257, 263, 269, 271, 277, 281, 
 283, 293, 307, 311, 313, 317, 331, 337, 347, 349, 
 353, 359, 367, 373, 379, 383, 389, 397, 401, 409, 
 419, 421, 431, 433, 439, 443, 449, 457, 461, 463, 
 467, 479, 487, 491, 499, 503, 509, 521, 523, 541, 
 547, 557, 563, 569, 571, 577, 587, 593, 599, 601, 
 607, 613, 617, 619, 631, 641, 643, 647, 653, 659, 
 661, 673, 677, 683, 691, 701, 709, 719, 727, 733, 
 739, 743, 751, 757, 761, 769, 773, 787, 797, 809, 
 811, 821, 823, 827, 829, 839, 853, 857, 859, 863, 
 877, 881, 883, 887, 907, 911, 919, 929, 937, 941, 
 947, 953, 967, 971, 977, 983, 991, 997 ]

def FastRangeLCM(last):
    total = 1
    for p in primes:
        if p>last:
            break
        x = 1
        while x*p <= last:
            x = x * p
        total = total * x
    return total

print RangeLCM2(20)
print EculidLCM(20)
print FastRangeLCM(20)

print timeit.Timer( 'RangeLCM2(20)', "from __main__ import RangeLCM2").timeit(number=10000)
print timeit.Timer( 'EuclidLCM(20)', "from __main__ import EuclidLCM" ).timeit(number=10000)
print timeit.Timer( 'FastRangeLCM(20)', "from __main__ import FastRangeLCM" ).timeit(number=10000)

print timeit.Timer( 'RangeLCM2(40)', "from __main__ import RangeLCM2").timeit(number=10000)
print timeit.Timer( 'EuclidLCM(40)', "from __main__ import EuclidLCM" ).timeit(number=10000)
print timeit.Timer( 'FastRangeLCM(40)', "from __main__ import FastRangeLCM" ).timeit(number=10000)

print timeit.Timer( 'RangeLCM2(60)', "from __main__ import RangeLCM2").timeit(number=10000)
print timeit.Timer( 'EuclidLCM(60)', "from __main__ import EuclidLCM" ).timeit(number=10000)
print timeit.Timer( 'FastRangeLCM(60)', "from __main__ import FastRangeLCM" ).timeit(number=10000)

print timeit.Timer( 'RangeLCM2(80)', "from __main__ import RangeLCM2").timeit(number=10000)
print timeit.Timer( 'EuclidLCM(80)', "from __main__ import EuclidLCM" ).timeit(number=10000)
print timeit.Timer( 'FastRangeLCM(80)', "from __main__ import FastRangeLCM" ).timeit(number=10000)

print timeit.Timer( 'RangeLCM2(100)', "from __main__ import RangeLCM2").timeit(number=10000)
print timeit.Timer( 'EuclidLCM(100)', "from __main__ import EuclidLCM" ).timeit(number=10000)
print timeit.Timer( 'FastRangeLCM(100)', "from __main__ import FastRangeLCM" ).timeit(number=10000)

print timeit.Timer( 'RangeLCM2(120)', "from __main__ import RangeLCM2").timeit(number=10000)
print timeit.Timer( 'EuclidLCM(120)', "from __main__ import EuclidLCM" ).timeit(number=10000)
print timeit.Timer( 'FastRangeLCM(120)', "from __main__ import FastRangeLCM" ).timeit(number=10000)

print timeit.Timer( 'RangeLCM2(140)', "from __main__ import RangeLCM2").timeit(number=10000)
print timeit.Timer( 'EuclidLCM(140)', "from __main__ import EuclidLCM" ).timeit(number=10000)
print timeit.Timer( 'FastRangeLCM(140)', "from __main__ import FastRangeLCM" ).timeit(number=10000)

print timeit.Timer( 'RangeLCM2(160)', "from __main__ import RangeLCM2").timeit(number=10000)
print timeit.Timer( 'EuclidLCM(160)', "from __main__ import EuclidLCM" ).timeit(number=10000)
print timeit.Timer( 'FastRangeLCM(160)', "from __main__ import FastRangeLCM" ).timeit(number=10000) 
```

* * *

## 回答 #4

> 赞同：5
> 
>             
> 
> 时间：2008-10-13T01:20:36.417

Haskell 中的单线。

```
wideLCM = foldl lcm 1 
```

这是我用于我自己的 Project Euler 问题 5 的内容。

* * *

## 回答 #5

> 赞同：3
> 
>             
> 
> 时间：2012-10-20T20:28:42.323

在哈斯克尔：

```
listLCM xs =  foldr (lcm) 1 xs 
```

您可以传递一个列表，例如：

```
*Main> listLCM [1..10]
2520
*Main> listLCM [1..2518]
266595767785593803705412270464676976610857635334657316692669925537787454299898002207461915073508683963382517039456477669596355816643394386272505301040799324518447104528530927421506143709593427822789725553843015805207718967822166927846212504932185912903133106741373264004097225277236671818323343067283663297403663465952182060840140577104161874701374415384744438137266768019899449317336711720217025025587401208623105738783129308128750455016347481252967252000274360749033444720740958140380022607152873903454009665680092965785710950056851148623283267844109400949097830399398928766093150813869944897207026562740359330773453263501671059198376156051049807365826551680239328345262351788257964260307551699951892369982392731547941790155541082267235224332660060039217194224518623199770191736740074323689475195782613618695976005218868557150389117325747888623795360149879033894667051583457539872594336939497053549704686823966843769912686273810907202177232140876251886218209049469761186661055766628477277347438364188994340512556761831159033404181677107900519850780882430019800537370374545134183233280000 
```

* * *

## 回答 #6

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T03:22:17.510

一个或多个数字的 LCM 是所有数字中所有不同质因数的乘积，每个质数都是该质数出现在数字中的所有幂的最大值的幂，即 LCM。

假设 900 = 2^3 * 3^2 * 5^2，26460 = 2^2 * 3^3 * 5^1 * 7^2。2 的最大幂是 3，3 的最大幂是 3，5 的最大幂是 1，7 的最大幂是 2，任何更高质数的最大幂都是 0。所以 LCM 为：264600 = 2^3 * 3^3 * 5^2 * 7^2。

* * *

## 回答 #7

> 赞同：2
> 
>             
> 
> 时间：2011-04-08T20:20:03.717

```
print "LCM of 4 and 5 = ".LCM(4,5)."\n";

sub LCM {
    my ($a,$b) = @_;    
    my ($af,$bf) = (1,1);   # The factors to apply to a & b

    # Loop and increase until A times its factor equals B times its factor
    while ($a*$af != $b*$bf) {
        if ($a*$af>$b*$bf) {$bf++} else {$af++};
    }
    return $a*$af;
} 
```

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2008-10-11T01:40:46.143

Haskell 中的一种算法。这是我现在认为的算法思维语言。这可能看起来很奇怪、复杂和不吸引人——欢迎来到 Haskell！

```
primes :: (Integral a) => [a]
--implementation of primes is to be left for another day.

primeFactors :: (Integral a) => a -> [a]
primeFactors n = go n primes where
    go n ps@(p : pt) =
        if q < 1 then [] else
        if r == 0 then p : go q ps else
        go n pt
        where (q, r) = quotRem n p

multiFactors :: (Integral a) => a -> [(a, Int)]
multiFactors n = [ (head xs, length xs) | xs <- group $ primeFactors $ n ]

multiProduct :: (Integral a) => [(a, Int)] -> a
multiProduct xs = product $ map (uncurry (^)) $ xs

mergeFactorsPairwise [] bs = bs
mergeFactorsPairwise as [] = as
mergeFactorsPairwise a@((an, am) : _) b@((bn, bm) : _) =
    case compare an bn of
        LT -> (head a) : mergeFactorsPairwise (tail a) b
        GT -> (head b) : mergeFactorsPairwise a (tail b)
        EQ -> (an, max am bm) : mergeFactorsPairwise (tail a) (tail b)

wideLCM :: (Integral a) => [a] -> a
wideLCM nums = multiProduct $ foldl mergeFactorsPairwise [] $ map multiFactors $ nums 
```

* * *

## 回答 #9

> 赞同：0
> 
>             
> 
> 时间：2008-10-11T13:46:03.713

这是我的 Python 尝试：

```
#!/usr/bin/env python

from operator import mul

def factor(n):
    factors = {}
    i = 2 
    while i <= n and n != 1:
        while n % i == 0:
            try:
                factors[i] += 1
            except KeyError:
                factors[i] = 1
            n = n / i
        i += 1
    return factors

base = {}
for i in range(2, 2000):
    for f, n in factor(i).items():
        try:
            base[f] = max(base[f], n)
        except KeyError:
            base[f] = n

print reduce(mul, [f**n for f, n in base.items()], 1) 
```

第一步得到一个数的质因数。第二步建立一个每个因素被看到的最大次数的哈希表，然后将它们全部相乘。

* * *

## 回答 #10

> 赞同：0
> 
>             
> 
> 时间：2015-04-12T11:34:28.730

这可能是迄今为止我见过的最简洁、最短的答案（无论是就代码行而言）。

```
def gcd(a,b): return b and gcd(b, a % b) or a
def lcm(a,b): return a * b / gcd(a,b)

n = 1
for i in xrange(1, 21):
    n = lcm(n, i) 
```

来源：[http ://www.s-anand.net/euler.html](http://www.s-anand.net/euler.html)

* * *

## 回答 #11

> 赞同：0
> 
>             
> 
> 时间：2015-04-21T21:44:23.740

这是我在 JavaScript 中的答案。我首先从素数着手，并开发了一个很好的可重用代码函数来查找素数并查找素数因子，但最终决定这种方法更简单。

我的答案中没有什么独特之处没有在上面发布，它只是在 Javascript 中，我没有具体看到。

```
//least common multipe of a range of numbers
function smallestCommons(arr) {
   arr = arr.sort();
   var scm = 1; 
   for (var i = arr[0]; i<=arr[1]; i+=1) { 
        scm =  scd(scm, i); 
    }
  return scm;
}

//smallest common denominator of two numbers (scd)
function scd (a,b) {
     return a*b/gcd(a,b);
}

//greatest common denominator of two numbers (gcd)
function gcd(a, b) {
    if (b === 0) {  
        return a;
    } else {
       return gcd(b, a%b);
    }
}       

smallestCommons([1,20]); 
```

* * *

## 回答 #12

> 赞同：0
> 
>             
> 
> 时间：2016-09-14T05:25:50.353

这是我的 javascript 解决方案，我希望你觉得它很容易理解：

```
function smallestCommons(arr) {
  var min = Math.min(arr[0], arr[1]);
  var max = Math.max(arr[0], arr[1]);

  var smallestCommon = min * max;

  var doneCalc = 0;

  while (doneCalc === 0) {
    for (var i = min; i <= max; i++) {
      if (smallestCommon % i !== 0) {
        smallestCommon += max;
        doneCalc = 0;
        break;
      }
      else {
        doneCalc = 1;
      }
    }
  }

  return smallestCommon;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
>             
> 
> 时间：2018-08-12T07:17:25.310

这是使用 C 语言的解决方案

```
#include<stdio.h>
    int main(){
    int a,b,lcm=1,small,gcd=1,done=0,i,j,large=1,div=0;
    printf("Enter range\n");
    printf("From:");
    scanf("%d",&a);
    printf("To:");
    scanf("%d",&b);
    int n=b-a+1;
    int num[30];
    for(i=0;i<n;i++){
        num[i]=a+i;
    }
    //Finds LCM
    while(!done){
        for(i=0;i<n;i++){
            if(num[i]==1){
                done=1;continue;
            }
            done=0;
            break;
        }
        if(done){
            continue;
        }
        done=0;
        large=1;
        for(i=0;i<n;i++){
            if(num[i]>large){
                large=num[i];
            }
        }
        div=0;
        for(i=2;i<=large;i++){
            for(j=0;j<n;j++){
                if(num[j]%i==0){
                    num[j]/=i;div=1;
                }
                continue;
            }
            if(div){
                lcm*=i;div=0;break;
            }
        }
    }
    done=0;
    //Finds GCD
    while(!done){
        small=num[0];
        for(i=0;i<n;i++){
            if(num[i]<small){
                small=num[i];
            }
        }
        div=0;
        for(i=2;i<=small;i++){
            for(j=0;j<n;j++){
                if(num[j]%i==0){
                    div=1;continue;
                }
                div=0;break;
            }
            if(div){
                for(j=0;j<n;j++){
                    num[j]/=i;
                }
                gcd*=i;div=0;break;
            }
        }
        if(i==small+1){
            done=1;
        }
    }
    printf("LCM = %d\n",lcm);
    printf("GCD = %d\n",gcd);
    return 0;
} 
```

* * *

## 回答 #14

> 赞同：-1
> 
>             
> 
> 时间：2008-10-09T03:19:16.580

在扩展@Alexander 的评论时，我会指出，如果您可以将数字分解为素数，删除重复项，然后相乘，您就会得到答案。

例如，1-5 的质因数为 2,3,2,2,5。从“4”的因子列表中删除重复的“2”，得到 2,2,3,5。将它们相乘得到 60，这就是你的答案。

上一条评论中提供的 Wolfram 链接[http://mathworld.wolfram.com/LeastCommonMultiple.html](http://mathworld.wolfram.com/LeastCommonMultiple.html)采用更正式的方法，但上面是简短版本。

干杯。

# apache - Apache：缓存 DEFLATE 文件

> ID：185782
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-10-09T03:00:39.503
> 
>         
> 
> 标签：apache, caching, compression, mod-deflate

在每个请求期间让 zlib 压缩网页似乎是多余的。这也是我的文件响应时间的瓶颈。有没有办法缓存 zlib 的文件，以便在每次修改时只压缩一次？还是我应该继续许愿？

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2008-12-02T03:01:30.093

如果您想要一个快速而懒惰的解决方案，只需制作您最常用文件的 gzip 副本并为它们打开[MultiViews](http://httpd.apache.org/docs/2.2/content-negotiation.html)。这仍然需要 CPU 开销来计算要发送的正确文件，但每次都小于 gzip。如果你想更进一步，你可以创建静态类型映射文件。

如果可能的话，你也可以考虑使用 Lighttpd 而不是 Apache。它有一个 mod_compress 可以完全满足您的需求。

* * *

## 回答 #2

> 赞同：2
> 
>             
> 
> 时间：2008-10-10T00:03:29.160

嗯，我认为 mod_cache 会完成这项工作。[http://httpd.apache.org/docs/2.0/mod/mod_cache.html](http://httpd.apache.org/docs/2.0/mod/mod_cache.html)

# debugging - 如何使 Visual Studio 调试器在设置为运行宏并继续的数据断点处停止中断？

> ID：185797
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-10-09T03:10:14.587
> 
>         
> 
> 标签：debugging, visual-studio-2005, macros, breakpoints

我在使用 Visual Studio 2005 时遇到了一个奇怪的问题：我有一个设置为运行宏并继续的数据断点（也就是说，我选择了一个宏并选中了继续执行。）

现在，当数据断点（实际上是跟踪点）中的值发生变化时，我不是静默运行宏，而是首先得到一个消息框，通知我断点已被击中，并且宏仅在我击中 OK 后运行。

我正在调试的代码对时间敏感，因此无法调试。有没有办法禁用弹出的消息框？

回应评论：宏本身可以是空的，或者它可以是 Microsoft 提供的任何示例宏 - 它没有任何区别。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-10-16T04:18:34.997

它也为我做这件事。根据您设置“继续执行”选项的方式，该行为似乎有些不同，所以我怀疑这种行为（尽管很痛苦）可能是设计使然。或者它可能是一个错误，但在任何一种情况下你都可能被卡住。

另一种方法可能是使用 windbg 或其他[Windows 调试工具](http://www.microsoft.com/whdc/devtools/debugging/debugstart.mspx)之一，它们也支持数据断点。它们需要一些时间来适应，并且不像 Visual Studio 调试器那样用户友好，但它们非常强大。“ba”命令创建一个数据断点，您可以对调试器进行编程以在断点被命中时执行特定命令。  [这篇文章](http://www.codeproject.com/KB/debug/windbg_part1.aspx)有一些关于这些调试器的很好的介绍性信息，[最后的问答部分](http://www.codeproject.com/KB/debug/windbg_part1.aspx#_Toc64133688)有一个例子，说明了当一个面包点被击中时如何执行一个动作。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-10-16T03:52:21.757

我的机器上没有 vs.net 2005。

所以，我在这里推测。

执行路线是什么？

它是否试图评估财产？

读取属性时是否设置了条件断点？（即在读取属性时中断？）

尝试删除与当前执行行相关的其他断点并再次添加跟踪点。

# winforms - 如何在 .NET WinForms 应用程序中控制字体 DPI

> ID：185804
> 
>         
> 
> 赞同：38
> 
>         
> 
> 时间：2008-10-09T03:13:30.010
> 
>         
> 
> 标签：winforms, fonts, dpi

我为一家小型企业创建了一个应用程序。办公室中的一些员工无法正确查看表格。原因是他们将 DPI 设置设置为 96dpi 以上。有人知道控制这种情况的方法吗？

对于所有使用过 winforms 应用程序的人来说，如何控制表单布局以使 DPI 不会影响应用程序的外观？

* * *

## 回答 #1

> 赞同：63
> 
>             
> 
> 时间：2008-10-14T17:59:48.707

假设您不尝试尊重用户的 UI 字体选择 (SystemFonts.IconTitleFont)，并且仅将表单硬编码为一种字体大小（例如 Tahoma 8pt、Microsoft Sans Serif 8.25pt），您可以将表单设置`AutoScaleMode`为`ScaleMode.Dpi`.

这将通过调用来缩放窗体和*大部分*子控件的大小，这反过来又在自身和所有子控件上递归调用受保护的方法。将根据新缩放因子的需要增加控件的位置、大小、字体等。`CurrentDpiSetting / 96``Form.Scale()``ScaleControl()``ScaleControl`

> **警告：**并非所有控件都能正确缩放。例如，列表视图的列不会随着字体变大而变宽。为了处理这个问题，您必须根据需要手动执行额外的缩放。我通过覆盖受保护的`ScaleControl()`方法并手动缩放列表视图列来做到这一点：
> 
> ```
> public class MyForm : Form
> {
>    protected override void ScaleControl(SizeF factor, BoundsSpecified specified)
>    {
>       base.ScaleControl(factor, specified);
>       Toolkit.ScaleListViewColumns(listView1, factor);
>    }
> }
> 
> public class Toolkit  
> {
>    /// <summary>
>    /// Scale the columns of a listview by the Width scale factor specified in factor
>    /// </summary>
>    /// <param name="listview"></param>
>    /// <param name="factor"></param>
>    /// <example>/*
>    /// protected override void ScaleControl(SizeF factor, BoundsSpecified specified)
>    /// {
>    ///    base.ScaleControl(factor, specified);
>    ///    
>    ///    //ListView columns are not automatically scaled with the ListView, so we
>    ///    //must do it manually
>    ///    Toolkit.ScaleListViewColumns(lvPermissions, factor);
>    /// }
>    ///</example>
>    public static void ScaleListViewColumns(ListView listview, SizeF factor)
>    {
>       foreach (ColumnHeader column in listview.Columns)
>       {
>           column.Width = (int)Math.Round(column.Width * factor.Width);
>       }
>    }
> } 
> ```

* * *

如果您只是使用控件，这一切都很好。但是，如果您曾经使用任何硬编码的像素大小，则需要通过表单的当前比例因子来缩放像素的宽度和长度。可能具有硬编码像素大小的一些情况示例：

*   绘制一个 25px 高的矩形

*   在表单上的位置 (11,56) 绘制图像

*   将图标拉伸到 48x48

*   使用 Microsoft Sans Serif 8.25pt 绘制文本

*   获取 32x32 格式的图标并将其填充到 PictureBox

如果是这种情况，您需要通过“*当前缩放因子*”来缩放这些硬编码值。遗憾的是没有提供“当前”比例因子，我们需要自己记录。解决方案是假设最初缩放因子为 1.0，并且每次`ScaleControl()`调用时，将运行的缩放因子修改为新因子。

```
public class MyForm : Form
{
   private SizeF currentScaleFactor = new SizeF(1f, 1f);

   protected override void ScaleControl(SizeF factor, BoundsSpecified specified)
   {
      base.ScaleControl(factor, specified);

      //Record the running scale factor used
      this.currentScaleFactor = new SizeF(
         this.currentScaleFactor.Width * factor.Width,
         this.currentScaleFactor.Height * factor.Height);

      Toolkit.ScaleListViewColumns(listView1, factor);
   }
} 
```

最初的比例因子是`1.0`。如果 form 然后按 缩放`1.25`，则缩放因子变为：

```
1.00 * 1.25 = 1.25    //scaling current factor by 125% 
```

如果窗体随后按 缩放`0.95`，则新的缩放因子变为

```
1.25 * 0.95 = 1.1875  //scaling current factor by 95% 
```

使用a `SizeF`（而不是单个浮点值）的原因是缩放量在 x 和 y 方向上可能不同。如果表单设置为`ScaleMode.Font`，则表单将缩放为新的字体大小。字体可以有不同的纵横比（*例如* **Segoe UI**的字体比**Tahoma**高）。这意味着您必须独立缩放 x 和 y 值。

因此，如果您想在 location 放置一个控件`(11,56)`，则必须将定位代码从以下位置更改：

```
Point pt = new Point(11, 56);
control1.Location = pt; 
```

至

```
Point pt = new Point(
      (int)Math.Round(11.0*this.scaleFactor.Width),
      (int)Math.Round(56.0*this.scaleFactor.Height));
control1.Location = pt; 
```

如果您要选择字体大小，这同样适用：

```
Font f = new Font("Segoe UI", 8, GraphicsUnit.Point); 
```

必须变成：

```
Font f = new Font("Segoe UI", 8.0*this.scaleFactor.Width, GraphicsUnit.Point); 
```

将 32x32 图标提取到位图将变为：

```
Image i = new Icon(someIcon, new Size(32, 32)).ToBitmap(); 
```

至

```
Image i = new Icon(someIcon, new Size(
     (int)Math.Round(32.0*this.scaleFactor.Width), 
     (int)Math.Round(32.0*this.scaleFactor.Height))).ToBitmap(); 
```

等等

支持非标准 DPI 显示是[所有开发者都应该缴纳的税](http://blogs.msdn.com/oldnewthing/archive/2004/07/14/182971.aspx)。但没人愿意这样做的事实就是为什么[微软放弃并在 Vista 中增加了图形卡扩展任何不能正确处理高 dpi 的应用程序的能力](http://blogs.msdn.com/greg_schechter/archive/2006/08/07/690704.aspx)。

* * *

## 回答 #2

> 赞同：16
> 
>             
> 
> 时间：2008-10-09T14:56:21.417

通过全局搜索/替换将 AutoScaleMode 设置为随处继承（即所有用户控件），然后在主窗体上将 AutoScaleMode 设置为 Dpi。

我还发现在这种情况下布局容器比锚点效果更好。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2014-11-06T16:39:02.977

我知道这有点激烈，但请考虑在 WPF 中重写您的应用程序。WPF 应用程序在每个 DPI 设置上都具有相同的外观。

# apache-flex - 究竟是什么区分了私有和受保护（在 Flex 中）？

> ID：185825
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-10-09T03:22:46.497
> 
>         
> 
> 标签：apache-flex, oop, scope

在 Flex（和许多其他语言）中，可以将类的函数/方法声明为私有或受保护（或公共）。有什么不同？我的印象是它与子类的关系以及事物如何被继承或如何被调用有关，但我不确定究竟是什么。

* * *

## 回答 #1

> 赞同：11
> 
>             
> 
> 时间：2008-10-09T03:25:17.130

一般来说：

*   私有成员只能由类本身访问。

*   受保护的成员只能由类本身及其后代访问。

*   公共成员可供所有人访问。

因此，随着您从私有到受保护再到公开，可见性会增加。

`private`在 C++ 中，您可以通过在基类名称前加上、`protected`或关键字来控制应如何将成员的可见性继承给后代`public`，这意味着您希望基类成员的可见性最多处于该级别。

```
class A {
private:
    int privA;
protected:
    int protA;
public:
    int pubA;

    // privA can be accessed inside class A
    // protA can be accessed inside class A
    // pubA  can be accessed inside class A
};
// pubA can be accessed by anyone

class B : public A {
    // No change to visibility of members
    // privA can't be accessed inside class B
    // protA can be accessed inside class B
    // pubA  can be accessed inside class B
};
// pubA can be accessed by anyone

class C : protected A {
    // Public members downgraded to protected
    // privA can't be accessed inside class C
    // protA can be accessed inside class C
    // pubA  can be accessed inside class C
};
// None of the members can be accessed outside class C

class D : private A {
    // Public and protected members downgraded to private
    // privA can't be accessed inside class D
    // protA can't be accessed inside class D
    // pubA  can't be accessed inside class D
};
// None of the members can be accessed outside class D 
```

在上述每种情况下，后代类当然能够引入它们自己的私有成员、受保护成员和公共成员。

# .net - .NET 中类加载器的等价物

> ID：185836
> 
>         
> 
> 赞同：44
> 
>         
> 
> 时间：2008-10-09T03:31:03.437
> 
>         
> 
> 标签：.net, compiler-construction, programming-languages, clr, language-features

有谁知道是否可以在.NET 中定义等效于“java 自定义类加载器”的内容？

**提供一点背景：**

我正在开发一种针对 CLR 的新编程语言，称为“Liberty”。该语言的特点之一是它能够定义“类型构造函数”，这是由编译器在编译时执行并生成类型作为输出的方法。它们是泛型的一种概括（该语言中确实有普通的泛型），并允许编写这样的代码（以“Liberty”语法）：

```
var t as tuple<i as int, j as int, k as int>;
t.i = 2;
t.j = 4;
t.k = 5; 
```

“元组”的定义如下：

```
public type tuple(params variables as VariableDeclaration[]) as TypeDeclaration
{
   //...
} 
```

在这个特定的示例中，类型构造函数`tuple`提供了类似于 VB 和 C# 中的匿名类型的东西。

但是，与匿名类型不同，“元组”具有名称并且可以在公共方法签名中使用。

这意味着我需要一种方法，让最终由编译器发出的类型可以跨多个程序集共享。例如，我想要

`tuple<x as int>`在程序集 A 中定义的类型最终与`tuple<x as int>`程序集 B 中定义的类型相同。

当然，这样做的问题是程序集 A 和程序集 B 将在不同的时间编译，这意味着它们最终都会发出自己不兼容的元组类型版本。

我研究了使用某种“类型擦除”来做到这一点，这样我就可以拥有一个包含一堆这样的类型的共享库（这是“Liberty”语法）：

```
class tuple<T>
{
    public Field1 as T;
}

class tuple<T, R>
{
    public Field2 as T;
    public Field2 as R;
} 
```

然后将访问从 i、j 和 k 元组字段重定向到`Field1`、`Field2`和`Field3`.

然而，这并不是一个真正可行的选择。这意味着在编译时`tuple<x as int>`最终`tuple<y as int>`会成为不同的类型，而在运行时它们将被视为相同的类型。这会给诸如平等和类型标识之类的事情带来很多问题。这对我的口味来说太抽象了。

其他可能的选择是使用“状态包对象”。但是，使用状态包会破坏语言中支持“类型构造函数”的全部目的。想法是启用“自定义语言扩展”以在编译时生成新类型，编译器可以使用这些新类型进行静态类型检查。

在 Java 中，这可以使用自定义类加载器来完成。基本上可以发出使用元组类型的代码，而无需在磁盘上实际定义类型。然后可以定义一个自定义的“类加载器”，它将在运行时动态生成元组类型。这将允许在编译器内部进行静态类型检查，并将跨编译边界统一元组类型。

然而不幸的是，CLR 不提供对自定义类加载的支持。CLR 中的所有加载都是在程序集级别完成的。可以为每个“构造类型”定义一个单独的程序集，但这会很快导致性能问题（有许多只有一种类型的程序集会使用太多资源）。

**所以，我想知道的是：**

是否可以在 .NET 中模拟 Java 类加载器之类的东西，我可以在其中发出对不存在类型的引用，然后在需要使用它的代码运行之前在运行时动态生成对该类型的引用？

**笔记：**

*我实际上已经知道这个问题的答案，我在下面提供了答案。然而，我花了大约 3 天的时间进行研究，并进行了大量的 IL 黑客攻击，以便提出解决方案。我认为在这里记录它是一个好主意，以防其他人遇到同样的问题。*

* * *

## 回答 #1

> 赞同：52
> 
>             
> 
> 时间：2008-10-09T03:39:09.350

答案是肯定的，但解决方案有点棘手。

[`System.Reflection.Emit`](http://msdn.microsoft.com/en-us/library/system.reflection.emit.aspx)命名空间定义了允许动态生成程序集的类型。它们还允许增量定义生成的程序集。换句话说，可以向动态程序集添加类型，执行生成的代码，然后再向程序集添加更多类型。

该类[`System.AppDomain`](http://msdn.microsoft.com/en-us/library/system.appdomain.aspx)还定义了一个[AssemblyResolve](http://msdn.microsoft.com/en-us/library/system.appdomain.assemblyresolve.aspx)事件，该事件在框架无法加载程序集时触发。通过为该事件添加处理程序，可以定义一个“运行时”程序集，所有“构造”类型都放置在其中。使用构造类型的编译器生成的代码将引用运行时程序集中的类型。因为运行时程序集实际上并不存在于磁盘上，所以在编译代码第一次尝试访问构造类型时会触发[AssemblyResolve事件。](http://msdn.microsoft.com/en-us/library/system.appdomain.assemblyresolve.aspx)然后，事件的句柄将生成动态程序集并将其返回给 CLR。

不幸的是，要让它发挥作用有一些棘手的问题。第一个问题是确保在编译代码运行之前始终安装事件处理程序。使用控制台应用程序，这很容易。连接事件处理程序的代码可以`Main`在其他代码运行之前添加到方法中。然而，对于类库，没有 main 方法。一个 dll 可以作为用另一种语言编写的应用程序的一部分加载，因此不可能假设总是有一个 main 方法可用于连接事件处理程序代码。

第二个问题是确保在使用任何引用它们的代码之前将引用的类型全部插入到动态程序集中。该类[`System.AppDomain`](http://msdn.microsoft.com/en-us/library/system.appdomain.aspx)还定义了一个[`TypeResolve`](http://msdn.microsoft.com/en-us/library/system.appdomain.typeresolve.aspx)每当 CLR 无法解析动态程序集中的类型时执行的事件。它使事件处理程序有机会在使用它的代码运行之前在动态程序集中定义类型。但是，该事件在这种情况下不起作用。CLR 不会为其他程序集“静态引用”的程序集触发事件，即使引用的程序集是动态定义的。这意味着我们需要一种在已编译程序集中的任何其他代码运行之前运行代码的方法，并让它动态地将所需的类型注入运行时程序集中（如果它们尚未定义）。否则，当 CLR 尝试加载这些类型时，它会注意到动态程序集不包含它们需要的类型，并将引发类型加载异常。

幸运的是，CLR 为这两个问题提供了解决方案：模块初始化程序。模块初始化器相当于“静态类构造器”，除了它初始化整个模块，而不仅仅是单个类。白思卡尔，CLR 将：

1.  在访问模块内的任何类型之前运行模块构造函数。

2.  保证只有那些被模块构造函数直接访问的类型在执行时才会被加载

3.  在构造函数完成之前，不允许模块外部的代码访问它的任何成员。

它对所有程序集执行此操作，包括类库和可执行文件，对于 EXE，将在执行 Main 方法之前运行模块构造函数。

有关构造函数的更多信息，请参阅此[博客文章](http://blogs.msdn.com/junfeng/archive/2005/11/19/494914.aspx)。

无论如何，我的问题的完整解决方案需要几个部分：

1.  以下类定义在“语言运行时 dll”中定义，由编译器生成的所有程序集（这是 C# 代码）引用。

    ```
    using System;
    using System.Collections.Generic;
    using System.Reflection;
    using System.Reflection.Emit;

    namespace SharedLib
    {
        public class Loader
        {
            private Loader(ModuleBuilder dynamicModule)
            {
                m_dynamicModule = dynamicModule;
                m_definedTypes = new HashSet<string>();
            }

            private static readonly Loader m_instance;
            private readonly ModuleBuilder m_dynamicModule;
            private readonly HashSet<string> m_definedTypes;

            static Loader()
            {
                var name = new AssemblyName("$Runtime");
                var assemblyBuilder = AppDomain.CurrentDomain.DefineDynamicAssembly(name, AssemblyBuilderAccess.Run);
                var module = assemblyBuilder.DefineDynamicModule("$Runtime");
                m_instance = new Loader(module);
                AppDomain.CurrentDomain.AssemblyResolve += new ResolveEventHandler(CurrentDomain_AssemblyResolve);
            }

            static Assembly CurrentDomain_AssemblyResolve(object sender, ResolveEventArgs args)
            {
                if (args.Name == Instance.m_dynamicModule.Assembly.FullName)
                {
                    return Instance.m_dynamicModule.Assembly;
                }
                else
                {
                    return null;
                }
            }

            public static Loader Instance
            {
                get
                {
                    return m_instance;
                }
            }

            public bool IsDefined(string name)
            {
                return m_definedTypes.Contains(name);
            }

            public TypeBuilder DefineType(string name)
            {
                //in a real system we would not expose the type builder.
                //instead a AST for the type would be passed in, and we would just create it.
                var type = m_dynamicModule.DefineType(name, TypeAttributes.Public);
                m_definedTypes.Add(name);
                return type;
            }
        }
    } 
    ```

    该类定义了一个单例，它包含对将在其中创建构造类型的动态程序集的引用。它还包含一个“哈希集”，用于存储已经动态生成的类型集，最后定义了一个成员，该成员可以用于定义类型。此示例仅返回一个 System.Reflection.Emit.TypeBuilder 实例，然后可以使用该实例来定义正在生成的类。在实际系统中，该方法可能会采用该类的 AST 表示，并自行生成。

2.  发出以下两个引用的编译程序集（以 ILASM 语法显示）：

    ```
    .assembly extern $Runtime
    {
        .ver 0:0:0:0
    }
    .assembly extern SharedLib
    {
        .ver 1:0:0:0
    } 
    ```

    这里“SharedLib”是语言的预定义运行时库，包括上面定义的“Loader”类，“$Runtime”是构造类型将插入的动态运行时程序集。

3.  用该语言编译的每个程序集中的“模块构造函数”。

    据我所知，没有.NET 语言允许在源代码中定义模块构造函数。C++ /CLI 编译器是我所知道的唯一生成它们的编译器。在 IL 中，它们看起来像这样，直接在模块中定义，而不是在任何类型定义中：

    ```
    .method privatescope specialname rtspecialname static 
            void  .cctor() cil managed
    {
        //generate any constructed types dynamically here...
    } 
    ```

    对我来说，我必须编写自定义 IL 才能使其正常工作，这不是问题。我正在编写一个编译器，所以代码生成不是问题。

    对于使用类型`tuple<i as int, j as int>`和`tuple<x as double, y as double, z as double>`模块构造函数的程序集，需要生成如下类型（此处为 C# 语法）：

    ```
    class Tuple_i_j<T, R>
    {
        public T i;
        public R j;
    }

    class Tuple_x_y_z<T, R, S>
    {
        public T x;
        public R y;
        public S z;
    } 
    ```

    元组类作为通用类型生成以解决可访问性问题。这将允许编译程序集中的代码使用`tuple<x as Foo>`Foo ，其中 Foo 是一些非公共类型。

    执行此操作的模块构造函数的主体（此处仅显示一种类型，并用 C# 语法编写）如下所示：

    ```
    var loader = SharedLib.Loader.Instance;
    lock (loader)
    {
        if (! loader.IsDefined("$Tuple_i_j"))
        {
            //create the type.
            var Tuple_i_j = loader.DefineType("$Tuple_i_j");
            //define the generic parameters <T,R>
           var genericParams = Tuple_i_j.DefineGenericParameters("T", "R");
           var T = genericParams[0];
           var R = genericParams[1];
           //define the field i
           var fieldX = Tuple_i_j.DefineField("i", T, FieldAttributes.Public);
           //define the field j
           var fieldY = Tuple_i_j.DefineField("j", R, FieldAttributes.Public);
           //create the default constructor.
           var constructor= Tuple_i_j.DefineDefaultConstructor(MethodAttributes.Public);

           //"close" the type so that it can be used by executing code.
           Tuple_i_j.CreateType();
        }
    } 
    ```

所以无论如何，这是我能够想出的机制，以在 CLR 中启用大致等效的自定义类加载器。

有谁知道更简单的方法来做到这一点？

* * *

## 回答 #2

> 赞同：-5
> 
>             
> 
> 时间：2008-10-09T03:38:42.563

我认为这是 DLR 应该在 C# 4.0 中提供的类型。有点难以获得信息，但也许我们会在 PDC08 上了解更多信息。虽然急切地等待看到您的 C# 3 解决方案......我猜它使用匿名类型。

# wpf - 如何编写“假”列表框

> ID：185842
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-10-09T03:33:05.507
> 
>         
> 
> 标签：wpf, image, listbox, resize

我使用 ListBox 来显示图像。但是我发现如果列表框包含超过 1000 个图像项，如果我想缩放缩略图真的很慢。我
[在具有超过 1000 个图像项的 WPF 列表框中询问了缩放图像变慢](https://stackoverflow.com/questions/181845/in-a-wpf-listbox-with-more-than-1000-image-items-the-zoom-images-become-slow)
的问题并尝试了很多方法，但是我无法通过简单地更改列表框属性来解决问题。

我可以写一个假的 ListBox 吗？它看起来包含很多图像，但实际上它只包含大约 100 个图像作为它的项目，它可以支持平滑滚动，当 100 个图像超出当前窗口时，它可以在用户不知道的情况下加载另外 100 个图像（没有停顿换页时）。

如何编写这样的自定义列表框？

* * *

## 回答 #1

> 赞同：3
> 
>             
> 
> 时间：2008-10-09T09:42:55.387

[在这里](https://stackoverflow.com/questions/181845/in-a-wpf-listbox-with-more-than-1000-image-items-the-zoom-images-become-slow#186187)阅读我的回复。您需要实现一个 VirtualizingWrapPanel！

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T04:20:55.257

我通过执行以下操作之一解决了类似的问题：

1.  提供一个组合框来过滤列表框。很少有人能有效地在 300 件事情中找到一件事情。

2.  在列表框上提供分页。在下方放置一个标签，上面写着“1 of x”和标准的后退/前进按钮组。

# c++ - 如何在 C++ 中初始化私有静态成员？

> ID：185844
> 
>         
> 
> 赞同：585
> 
>         
> 
> 时间：2008-10-09T03:34:35.193
> 
>         
> 
> 标签：c++, initialization, static-members

在 C++ 中初始化私有静态数据成员的最佳方法是什么？我在我的头文件中尝试了这个，但它给了我奇怪的链接器错误：

```
class foo
{
    private:
        static int i;
};

int foo::i = 0; 
```

我猜这是因为我无法从类外初始化私有成员。那么最好的方法是什么？

* * *

## 回答 #1

> 赞同：618
> 
>             
> 
> 时间：2008-10-09T03:36:11.197

类声明应该在头文件中（如果不共享，则在源文件中）。

文件：foo.h

```
class foo
{
    private:
        static int i;
}; 
```

但是初始化应该在源文件中。

文件：foo.cpp

```
int foo::i = 0; 
```

如果初始化在头文件中，则包含头文件的每个文件都将具有静态成员的定义。因此，在链接阶段，您将收到链接器错误，因为初始化变量的代码将在多个源文件中定义。的初始化`static int i`必须在任何函数之外完成。

**注意：** Matt Curtis：指出如果静态成员变量是 const int 类型（例如`int`, `bool`, `char`），C++ 允许对上述内容进行简化。然后，您可以直接在头文件的类声明中声明和初始化成员变量：

```
class foo
{
    private:
        static int const i = 42;
}; 
```

* * *

## 回答 #2

> 赞同：104
> 
>             
> 
> 时间：2008-10-09T03:41:40.607

对于**变量**：

富.h：

```
class foo
{
private:
    static int i;
}; 
```

foo.cpp：

```
int foo::i = 0; 
```

`foo::i`这是因为您的程序中只能有一个实例。它相当于`extern int i`在头文件和`int i`源文件中。

对于**常量**，您可以将值直接放在类声明中：

```
class foo
{
private:
    static int i;
    const static int a = 42;
}; 
```

* * *

## 回答 #3

> 赞同：72
> 
>             
> 
> 时间：2017-07-12T15:34:05.327

从 C++17 开始，静态成员可以使用**inline**关键字在标头中定义。

[http://en.cppreference.com/w/cpp/language/static](http://en.cppreference.com/w/cpp/language/static)

“静态数据成员可以内联声明。内联静态数据成员可以在类定义中定义，并且可以指定默认成员初始化程序。它不需要类外定义：”

```
struct X
{
    inline static int n = 1;
}; 
```

* * *

## 回答 #4

> 赞同：33
> 
>             
> 
> 时间：2012-12-27T15:37:38.523

对于这个问题的未来观众，我想指出你应该避免[monkey0506 的建议](https://stackoverflow.com/a/8772501/5571184)。

头文件用于声明。

`.cpp`头文件为每个直接或间接使用它们的文件编译一次`#includes`，并且任何函数之外的代码在程序初始化时运行，之前`main()`.

通过将：`foo::i = VALUE;`放入标题中，`foo:i`将为每个文件分配值`VALUE`（无论是什么）`.cpp`，并且这些分配将在运行之前以不确定的顺序（由链接器确定）发生`main()`。

如果我们`#define VALUE`在我们的一个文件中成为不同的数字`.cpp`怎么办？它将编译得很好，在我们运行程序之前，我们无法知道哪个获胜。

永远不要将执行的代码放入标头中，原因与您从不放入`#include`文件相同`.cpp`。

包含警卫（我同意您应该始终使用）保护您免受不同的影响：在编译单个文件时，同一个标头被间接`#include`d 多次`.cpp`

* * *

## 回答 #5

> 赞同：23
> 
>             
> 
> 时间：2008-10-09T05:45:26.177

使用 Microsoft 编译器 [1]，`int`也可以在头文件中定义不类似的静态变量，但在类声明之外，使用 Microsoft 特定的`__declspec(selectany)`.

```
class A
{
    static B b;
}

__declspec(selectany) A::b; 
```

请注意，我并不是说这很好，我只是说可以做到。

[1] 这些天来，支持的编译器比 MSC 多`__declspec(selectany)`——至少 gcc 和 clang。也许更多。

* * *

## 回答 #6

> 赞同：18
> 
>             
> 
> 时间：2008-10-09T03:42:18.873

```
int foo::i = 0; 
```

是初始化变量的正确语法，但它必须放在源文件 (.cpp) 中而不是头文件中。

因为它是一个静态变量，编译器只需要创建它的一个副本。您必须在代码中的某个位置有一行“int foo:i”来告诉编译器将它放在哪里，否则会出现链接错误。如果它在标题中，您将在每个包含标题的文件中获得一个副本，因此从链接器获取多重定义的符号错误。

* * *

## 回答 #7

> 赞同：14
> 
>             
> 
> 时间：2014-11-23T11:43:15.870

如果你想初始化一些复合类型（fe 字符串），你可以这样做：

```
class SomeClass {
  static std::list<string> _list;

  public:
    static const std::list<string>& getList() {
      struct Initializer {
         Initializer() {
           // Here you may want to put mutex
           _list.push_back("FIRST");
           _list.push_back("SECOND");
           ....
         }
      }
      static Initializer ListInitializationGuard;
      return _list;
    }
}; 
```

由于`ListInitializationGuard`是方法内部的静态变量，`SomeClass::getList()`它只会被构造一次，这意味着构造函数被调用一次。这将`initialize _list`根据您需要的值而变化。任何后续调用都`getList`将简单地返回已经初始化的`_list`对象。

当然，您必须`_list`始终通过调用`getList()`方法来访问对象。

* * *

## 回答 #8

> 赞同：13
> 
>             
> 
> 时间：2018-01-19T08:55:37.887

**适用于多个对象的 C++11 静态构造函数模式**

在以下位置提出了一个成语：[https](https://stackoverflow.com/a/27088552/895245) ://stackoverflow.com/a/27088552/895245 ，但这里有一个更简洁的版本，不需要为每个成员创建新方法。

主文件

```
#include <cassert>
#include <vector>

// Normally on the .hpp file.
class MyClass {
public:
    static std::vector<int> v, v2;
    static struct StaticConstructor {
        StaticConstructor() {
            v.push_back(1);
            v.push_back(2);
            v2.push_back(3);
            v2.push_back(4);
        }
    } _staticConstructor;
};

// Normally on the .cpp file.
std::vector<int> MyClass::v;
std::vector<int> MyClass::v2;
// Must come after every static member.
MyClass::StaticConstructor MyClass::_staticConstructor;

int main() {
    assert(MyClass::v[0] == 1);
    assert(MyClass::v[1] == 2);
    assert(MyClass::v2[0] == 3);
    assert(MyClass::v2[1] == 4);
} 
```

[GitHub 上游](https://github.com/cirosantilli/cpp-cheat/blob/45295e6acc4af330f79436b4cbb90f139e00a344/cpp/static_constructor_private.cpp).

编译并运行：

```
g++ -ggdb3 -O0 -std=c++11 -Wall -Wextra -pedantic -o main.out main.cpp
./main.out 
```

另请参阅：[C++ 中的静态构造函数？我需要初始化私有静态对象](https://stackoverflow.com/questions/1197106/static-constructors-in-c-i-need-to-initialize-private-static-objects)

在 Ubuntu 19.04 上测试。

**C++17 内联变量**

提到：[https](https://stackoverflow.com/a/45062055/895245) ://stackoverflow.com/a/45062055/895245但这里有一个多文件可运行示例，使其更加清晰：[内联变量如何工作？](https://stackoverflow.com/questions/38043442/how-do-inline-variables-work/53896763#53896763)

这个很棒的 C++17 特性使我们能够：

*   方便地为每个常量只使用一个内存地址

*   将其存储为`constexpr`：[如何声明 constexpr extern？](https://stackoverflow.com/questions/30208685/how-to-declare-constexpr-extern)

*   从一个标题在一行中执行

主文件

```
#include <cassert>

#include "notmain.hpp"

int main() {
    // Both files see the same memory address.
    assert(&notmain_i == notmain_func());
    assert(notmain_i == 42);
} 
```

不是main.hpp

```
#ifndef NOTMAIN_HPP
#define NOTMAIN_HPP

inline constexpr int notmain_i = 42;

const int* notmain_func();

#endif 
```

非main.cpp

```
#include "notmain.hpp"

const int* notmain_func() {
    return &notmain_i;
} 
```

编译并运行：

```
g++ -c -o notmain.o -std=c++17 -Wall -Wextra -pedantic notmain.cpp
g++ -c -o main.o -std=c++17 -Wall -Wextra -pedantic main.cpp
g++ -o main -std=c++17 -Wall -Wextra -pedantic main.o notmain.o
./main 
```

[GitHub 上游](https://github.com/cirosantilli/cpp-cheat/tree/085c4b22b1b290a6d033a44958d05054e7e303c7/cpp/inline_variable).

* * *

## 回答 #9

> 赞同：9
> 
>             
> 
> 时间：2012-01-07T19:42:54.520

我没有足够的代表在这里将其添加为评论，但是 IMO 无论如何用[#include 防护](http://en.wikipedia.org/wiki/Include_guard)来编写标题是一种很好的风格，正如Paranaix 几小时前所指出的那样，这可以防止多定义错误。除非您已经在使用单独的 CPP 文件，否则没有必要仅使用一个来初始化静态非整数成员。

```
#ifndef FOO_H
#define FOO_H
#include "bar.h"

class foo
{
private:
    static bar i;
};

bar foo::i = VALUE;
#endif 
```

我认为不需要为此使用单独的 CPP 文件。当然，你可以，但没有技术上的理由你必须这样做。

* * *

## 回答 #10

> 赞同：6
> 
>             
> 
> 时间：2013-04-11T21:50:25.020

如果您使用标头保护，您还可以在头文件中包含分配。我已将这种技术用于我创建的 C++ 库。实现相同结果的另一种方法是使用静态方法。例如...

```
class Foo
   {
   public:
     int GetMyStatic() const
     {
       return *MyStatic();
     }

   private:
     static int* MyStatic()
     {
       static int mStatic = 0;
       return &mStatic;
     }
   } 
```

上面的代码具有不需要 CPP/源文件的“奖励”。同样，我用于 C++ 库的方法。

* * *

## 回答 #11

> 赞同：4
> 
>             
> 
> 时间：2013-12-31T14:45:25.823

我遵循卡尔的想法。我喜欢它，现在我也使用它。我改变了一点符号并添加了一些功能

```
#include <stdio.h>

class Foo
{
   public:

     int   GetMyStaticValue () const {  return MyStatic();  }
     int & GetMyStaticVar ()         {  return MyStatic();  }
     static bool isMyStatic (int & num) {  return & num == & MyStatic(); }

   private:

      static int & MyStatic ()
      {
         static int mStatic = 7;
         return mStatic;
      }
};

int main (int, char **)
{
   Foo obj;

   printf ("mystatic value %d\n", obj.GetMyStaticValue());
   obj.GetMyStaticVar () = 3;
   printf ("mystatic value %d\n", obj.GetMyStaticValue());

   int valMyS = obj.GetMyStaticVar ();
   int & iPtr1 = obj.GetMyStaticVar ();
   int & iPtr2 = valMyS;

   printf ("is my static %d %d\n", Foo::isMyStatic(iPtr1), Foo::isMyStatic(iPtr2));
} 
```

这输出

```
mystatic value 7
mystatic value 3
is my static 1 0 
```

* * *

## 回答 #12

> 赞同：4
> 
>             
> 
> 时间：2017-09-10T10:20:32.253

您遇到的链接器问题可能是由以下原因引起的：

*   在头文件中提供类和静态成员定义，

*   在两个或多个源文件中包含此标头。

对于那些从 C++ 开始的人来说，这是一个常见的问题。静态类成员必须在单个翻译单元中初始化，即在单个源文件中。

不幸的是，静态类成员必须在类主体之外进行初始化。这使编写仅标头代码变得复杂，因此，我使用了完全不同的方法。您可以通过静态或非静态类函数提供静态对象，例如：

```
class Foo
{
    // int& getObjectInstance() const {
    static int& getObjectInstance() {
        static int object;
        return object;
    }

    void func() {
        int &object = getValueInstance();
        object += 5;
    }
}; 
```

* * *

## 回答 #13

> 赞同：3
> 
>             
> 
> 时间：2014-01-26T11:21:05.630

也在 privateStatic.cpp 文件中工作：

```
#include <iostream>

using namespace std;

class A
{
private:
  static int v;
};

int A::v = 10; // possible initializing

int main()
{
A a;
//cout << A::v << endl; // no access because of private scope
return 0;
}

// g++ privateStatic.cpp -o privateStatic && ./privateStatic 
```

* * *

## 回答 #14

> 赞同：3
> 
>             
> 
> 时间：2014-05-23T14:28:51.417

`set_default()`方法呢？

```
class foo
{
    public:
        static void set_default(int);
    private:
        static int i;
};

void foo::set_default(int x) {
    i = x;
} 
```

我们只需要使用该`set_default(int x)`方法，我们的`static`变量就会被初始化。

这不会与其他评论意见相左，实际上它遵循在全局范围内初始化变量的相同原则，但是通过使用这种方法，我们使其明确（并且易于理解）而不是定义的变量挂在那里。

* * *

## 回答 #15

> 赞同：2
> 
>             
> 
> 时间：2018-06-13T21:27:06.697

定义常量的一种“老派”方法是将它们替换为`enum`：

```
class foo
{
    private:
        enum {i = 0}; // default type = int
        enum: int64_t {HUGE = 1000000000000}; // may specify another type
}; 
```

这种方式不需要提供定义，并且避免制作常量[lvalue](https://stackoverflow.com/q/3601602/509868)，这可以为您省去一些麻烦，例如当您不小心[使用 ODR](https://stackoverflow.com/q/4209433/509868)时。

* * *

## 回答 #16

> 赞同：2
> 
>             
> 
> 时间：2021-09-22T07:34:35.950

以下是一个简单示例中的所有可能性和错误...

```
#ifndef Foo_h
#define Foo_h

class Foo
{
  static const int a = 42; // OK
  static const int b {7};  // OK
  //static int x = 42; // ISO C++ forbids in-class initialization of non-const static member 'Foo::x'
  //static int y {7};  // ISO C++ forbids in-class initialization of non-const static member 'Foo::x'
  static int x;
  static int y;
  int m = 42;
  int n {7};
};

// Foo::x = 42;  // error: 'int Foo::x' is private
int Foo::x = 42; // OK in Foo.h if included in only one  *.cpp -> *.o file!
int Foo::y {7};  // OK

// int Foo::y {7};  // error: redefinition of 'int Foo::y'
   // ONLY if the compiler can see both declarations at the same time it, 
   // OTHERWISE you get a linker error

#endif // Foo_h 
```

但最好把它放在 Foo.cpp 中。这样您就可以单独编译每个文件并稍后链接它们，否则 Foo:x 将出现在多个目标文件中并导致链接器错误。...

```
// Foo::x = 42;  // error: 'int Foo::x' is private, bad if Foo::X is public!
int Foo::x = 42; // OK in Foo.h if included in only one  *.cpp -> *.o file!
int Foo::y {7};  // OK 
```

* * *

## 回答 #17

> 赞同：1
> 
>             
> 
> 时间：2016-10-01T01:11:21.250

当我第一次遇到这个时，我只是想提一些对我来说有点奇怪的事情。

我需要在模板类中初始化一个私有静态数据成员。

在 .h 或 .hpp 中，初始化模板类的静态数据成员看起来像这样：

```
template<typename T>
Type ClassName<T>::dataMemberName = initialValue; 
```

* * *

## 回答 #18

> 赞同：0
> 
>             
> 
> 时间：2016-09-02T11:50:33.643

这是否符合您的目的？

```
//header file

struct MyStruct {
public:
    const std::unordered_map<std::string, uint32_t> str_to_int{
        { "a", 1 },
        { "b", 2 },
        ...
        { "z", 26 }
    };
    const std::unordered_map<int , std::string> int_to_str{
        { 1, "a" },
        { 2, "b" },
        ...
        { 26, "z" }
    };
    std::string some_string = "justanotherstring";  
    uint32_t some_int = 42;

    static MyStruct & Singleton() {
        static MyStruct instance;
        return instance;
    }
private:
    MyStruct() {};
};

//Usage in cpp file
int main(){
    std::cout<<MyStruct::Singleton().some_string<<std::endl;
    std::cout<<MyStruct::Singleton().some_int<<std::endl;
    return 0;
} 
```

# c++ - 新项目：我无法选择要使用的语言

> ID：185862
> 
>         
> 
> 赞同：6
> 
>         
> 
> 时间：2008-10-09T03:41:29.657
> 
>         
> 
> 标签：c++, perl, wxwidgets, packaging

我正在开始我的第一个独立营利企业。我很难决定使用什么语言。我想用 Perl 编写我的应用程序，但我认为编译起来不够简单。如果我不使用 Perl 编写它，我将使用 C++ 编写它。

该应用程序将具有许多功能，包括[wxwidgets](http://www.wxwidgets.org/)接口、处理 SDL、计时器、一些线程和音频处理。程序本身会有些复杂，但不会很大。

所以我的问题是：

1.  PAR、​​Perl2exe 或等效程序可以编译更多的基本测试用例吗？

2.  除了速度和编译，为什么我应该使用 C++ 而不是 Perl？

* * *

编辑：我的一些项目规范。

*   多平台。我预计 50% 或更多的用户拥有 Mac，其余大部分是 Windows 用户。如果可能的话，我也想支持 Linux，因为它是我的日常操作系统。

*   由于它是多平台，我需要一个统一的 GUI 创建工具。它需要能够使用基本类型，并允许我创建自定义事件处理程序和自定义 GUI 对象。

*   它需要音频处理。阅读和播放 wav 和/或 mp3。此外，我将使用一些自定义算法来确定音频文件的特殊属性；诸如节奏，模式等之类的东西。

*   我想要但不需要 SDL/OpenGL 支持。

其他一切都很平凡。一些不同的类和容器。一些自定义 GUI 控件。

* * *

## 回答 #1

> 赞同：12
> 
>             
> 
> 时间：2008-10-09T07:28:29.870

我既是 C++ 又是 Perl 程序员。C++ 是一门不错的语言，但每当我有选择的时候，我都会选择 Perl，因为开发的速度要快得多。

一些评论：

1.  PAR、​​perlapp 和 perl2exe 不是编译器。他们是包装工。除了 perl 本身，没有 Perl 编译器。如果您想要某种形式的 Perl 代码的字节码形式，您将不得不等待 Parrot 上的 Perl 6。

2.  我已经使用 PAR 打包了一个总共大约 500k SLOC 的应用程序，不包括 perl 本身。它运行良好，运行速度与 perl 本身相同，但启动速度较慢。这是 2005 年。从那时起，如果在打包程序的开发机器上安装 Archive::Unzip::Burst 模块，启动性能会显着提高。我已经成功地将 PAR 用于各种大小从微小到上述 500k 行的应用程序。如果您需要有关 PAR 的帮助，这里有一个活跃且友好的邮件列表。只是帮助我们和您自己不要附和“OMG，没有任何作用，帮助我，kthx！”。人们一直这样做（有时仍然会得到帮助）。:)

3.  Perl 的线程不是很好。检查 POE 之类的东西是否适合您的账单。我是threads.pm 用户，但我不想成为。向辛勤工作的维护者 Jerry D. Hedden 致以适当的歉意。

4.  wxPerl 的状态非常好，并且围绕它有一个社区。自然，由于 wxWidgets 是 C++，所以它总是更新和完整一点。

5.  SDL Perl 是库的直接包装器。（小）文档假设您已经知道它。以我的经验，阅读不同语言的图书馆文档可能有点麻烦。

6.  perl 中的计时器很好：[Time::HiRes](http://search.cpan.org/perldoc?Time::HiRes)

7.  便携性很难。在 C++ 中比在 Perl 中更是如此，但它确实总是归结为纪律和能够在许多平台上进行测试。

8.  对于 Windows 上的 Perl，请务必查看 Strawberry Perl。

* * *

## 回答 #2

> 赞同：11
> 
>             
> 
> 时间：2008-10-09T03:53:29.057

使用 C++。定时器、线程、音频、SDL、wxwidgets，这些都是 Perl 可以做的事情，但并不擅长。此外，PAR 或 perl2exe 是笨拙的分发机制。他们工作，但他们并不理想。同时，C++（我强烈建议您考虑使用[Boost](http://www.boost.org/)）很适合这个角色。

* * *

## 回答 #3

> 赞同：9
> 
>             
> 
> 时间：2008-10-09T04:10:17.820

为什么不使用两者的混合体？这通常是当今许多开发的方式。

我建议使用 Lua/C++ 或 Python/C++ 组合（我不确定 Perl/C++ 组合的效果如何，但这也可能是一个不错的选择）。

就我个人而言，我已经使用 Lua/C++ 组合完成了很多工作，这非常棒。

* * *

## 回答 #4

> 赞同：6
> 
>             
> 
> 时间：2008-10-10T00:33:17.523

使用 Perl 的一个重要原因是元编程。

Perl 足够灵活，可以让您编写代码来编写代码（这就是 Moose 的魔力所在）。您将节省时间并减少需要消除的错误数量。

使用 Perl 的主要原因是 CPAN。

* * *

## 回答 #5

> 赞同：5
> 
>             
> 
> 时间：2008-10-09T04:29:45.957

我已经使用 PAR 为 Windows 打包了大量的 Perl/Tk 程序。这需要一些摆弄，但它奏效了。

如果您在 Perl 方面的经验至少与在 C++ 方面的经验一样多，那么使用 Perl 进行开发应该会更快。但是等效程序的运行时速度会更慢。任何一个都可以满足您的所有其他标准，所以我想说这取决于个人选择。

* * *

## 回答 #6

> 赞同：4
> 
>             
> 
> 时间：2008-10-09T04:30:03.770

亲自？我说不要纠结这个太久。无论哪种方式都有利有弊，但听起来你正危险地接近陷入“分析瘫痪”。如果不出意外，掷硬币或选择你认为最漂亮的名字。

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T15:09:15.697

功能很重要。无论语言如何，代码都会做类似的事情，尤其是在使用相同的库和组件时。除非您通过库和工具包确定了确切的功能，否则请在 Perl 中对其进行原型设计。

有一种观点认为，动态语言的开发将花费更少的时间。在 Perl 和 C++ 中存在类似的问题，即在正确的位置获取下拉菜单，用正确的值填充它，根据用户输入对程序状态进行适当的更改。

如果 Perl 在某些平台上无法完成，请将代码转换为 C++。

可能有一些指针可以帮助这种方法：

1.  这意味着您可能会使用 OO Perl 编写原型。一旦你在一个平台上确定了高级功能——假设你可以在 Perl 中做到这一点——那么 C++ 或多或少是一种优化。

2.  也许您可能会将原型限制为或多或少与 C++ 同源。但我不确定这一点，您可以将 a 分解`map`成一个循环，甚至只是用一个过滤器函数替换它，该过滤器函数用一个测试函数的函数指针调用。

* * *

## 回答 #8

> 赞同：-1
> 
>             
> 
> 时间：2008-10-09T15:22:17.153

用 C++ 编写您的核心功能，然后在相关平台的工具中为您的应用程序编写前端，即 Mac OS X 的 Cocoa、Windows 的 .NET/Delphi/MFC 等。

这是我开发跨平台桌面应用程序的首选方式。当然，我对你想要完成的事情知之甚少，所以它对你来说可能太胖了。

# mysql - Windows 2008 服务器上的 MySQL 5（32 位）

> ID：185878
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-10-09T03:51:28.950
> 
>         
> 
> 标签：mysql, windows-server-2008

如上所述，有人在 Windows 2008 服务器上尝试过吗？如果是，一切进展如何？是否足够稳定以供生产使用？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-11-03T21:13:41.587

我已经成功（默认安装和操作没有问题）完成了以下几次：

将基于 LAMP（ubuntu 等）构建的主要应用程序转移到 WAMP（2008 服务器）。

从同一台 2008 服务器同时运行 SQL Server 和 MySQL 5。

在我的开发笔记本电脑上同时运行 MySQL 5 和 SQL Server 一年多了（都作为不间断服务）。

将所有案例从 5.0 升级到 5.1。

在笔记本电脑上调整查询和数据库配置，并在服务器上实现结果并带来相应的好处。

如果您看到归因于操作系统的打嗝，我会感到非常惊讶。

# c++ - Qt：调试和发布中 moc 输出的区别？

> ID：185883
> 
>         
> 
> 赞同：4
> 
>         
> 
> 时间：2008-10-09T03:53:40.350
> 
>         
> 
> 标签：c++, visual-studio, qt

使用 Qt Visual Studio 集成，添加一个新的 Qt 类会添加两个单独的 moc.exe 生成文件 - 一个用于调试，一个用于发布（一个用于当前存在的任何其他配置）。然而，这两个最终生成的文件似乎是相同的。

另一方面，在添加 UI 类时，生成的 uic.exe 文件没有这种分隔，并且对于所有配置都是同一个文件。

有谁知道为什么每个配置都需要一个单独的 moc 文件？两者什么时候有区别？

* * *

## 回答 #1

> 赞同：8
> 
>             
> 
> 时间：2008-10-09T04:14:19.980

我的猜测是需要单独的调试和发布版本，因为 moc 输出是从用户定义的源代码生成的。因此，如果调试和发布版本之间预处理的类源不同（例如，仅存在于调试版本中的信号），则调试版本和发布版本之间的 moc 输出可能不同。

这不适用于 uic 生成的文件，因为这些文件是从 .ui XML 生成的，在调试和发布配置之间不会有所不同。

* * *

## 回答 #2

> 赞同：7
> 
>             
> 
> 时间：2008-10-09T04:16:33.190

Moc 解析预处理器指令的源代码。因此，如果您有这样的头文件：

```
class Test : public QObject
{
    Q_OBJECT
public:
        Test();             
public slots:

#ifndef DEBUG
        void    Foo();
#endif
}; 
```

然后插槽 Foo 将仅存在于发布版本中，而不存在于调试版本中。根据是否设置了 DEBUG（在这种情况下）符号，Moc 将生成不同的 moc.cpp 文件。

# java - 如何分析 .hprof 文件？

> ID：185893
> 
>         
> 
> 赞同：254
> 
>         
> 
> 时间：2008-10-09T04:04:03.480
> 
>         
> 
> 标签：java, profiling, heap-memory

我有一个使用以下标志运行的生产服务器： - **XX:+HeapDumpOnOutOfMemoryError**

昨晚，当我们的服务器遇到堆错误时，它生成了一个 java-38942.hprof 文件。事实证明，系统的开发人员知道该标志，但无法从中获取任何有用的信息。

有任何想法吗？

* * *

## 回答 #1

> 赞同：239
> 
>             
> 
> 时间：2008-10-09T04:41:31.313

如果您想要一个相当先进的工具来进行一些认真的探索，请查看Eclipse[的 Memory Analyzer 项目](http://www.eclipse.org/mat/)，该项目由 SAP 提供。

您可以做的一些事情对于查找内存泄漏等非常有用 - 包括针对内存中的对象运行一种受限 SQL (OQL) 形式，即

> 从 com.yourcompany.somepackage.User 中选择 toString(firstName)

完全辉煌。

* * *

## 回答 #2

> 赞同：84
> 
>             
> 
> 时间：2008-10-09T04:17:01.393

您可以使用[JHAT](https://docs.oracle.com/javase/8/docs/technotes/tools/unix/jhat.html)，JDK 默认提供的 Java 堆分析工具。它是命令行，但会启动用于检查内存的 Web 服务器/浏览器。不是最用户友好的，但至少它已经安装在你要去的大多数地方。一个非常有用的视图是最底部的“堆直方图”链接。

前任：  `jhat -port 7401 -J-Xmx4G dump.hprof`

`jhat`“这些天”也可以执行 OQL（底部链接“执行 OQL”）

* * *

## 回答 #3

> 赞同：38
> 
>             
> 
> 时间：2008-10-09T16:41:06.120

您还可以使用来自 Netbeans Profiler 或[Visual VM](https://visualvm.github.io/)独立工具的[HeapWalker 。](http://profiler.netbeans.org/docs/help/6.0/heapwalker.html)Visual VM 是 JHAT 的一个很好的替代品，因为它是独立的，但比 JHAT 更容易使用。

您需要 Java 6+ 才能充分使用 Visual VM。

* * *

## 回答 #4

> 赞同：15
> 
>             
> 
> 时间：2008-10-09T08:18:40.267

只需获取[Eclipse Memory Analyzer 即可](http://www.eclipse.org/mat/)。没有比这更好的了，而且它是免费的。

JHAT 仅可用于“玩具应用”

* * *

## 回答 #5

> 赞同：11
> 
>             
> 
> 时间：2010-11-02T10:35:48.283

YourKit Java Profiler 似乎也可以处理它们。

* * *

## 回答 #6

> 赞同：11
> 
>             
> 
> 时间：2020-03-04T08:58:12.567

我个人更喜欢 VisualVM。我喜欢 VisualVM 中的一项功能是堆转储比较。当您进行堆转储分析时，有多种方法可以找出导致崩溃的原因。我发现有用的方法之一是比较健康和不健康的堆转储。

以下是您可以遵循的步骤：

1.  获取 OutOfMemoryError 的堆转储让我们称其为“oome.hprof”。您可以通过 JVM 参数 HeapDumpOnOutOfMemoryError 获取此信息。

2.  重新启动应用程序，让它运行一段时间（分钟/小时），具体取决于您的应用程序。在应用程序仍在运行时获取另一个堆转储。我们称之为“healthy.hprof”。

3.  您可以在 VisualVM 中打开这两个转储并进行堆转储比较。您可以在类或包级别上执行此操作。这通常可以为您指明问题的方向。

链接：[https ://visualvm.github.io](https://visualvm.github.io)

* * *

## 回答 #7

> 赞同：7
> 
>             
> 
> 时间：2018-06-06T11:24:34.800

如果您想对 heapdump 进行自定义分析，那么有：

*   **JVM 堆转储分析库** [https://github.com/aragozin/heaplib/tree/master/hprof-heap](https://github.com/aragozin/heaplib/tree/master/hprof-heap)

这个库速度很快，但您需要用 Java 编写分析代码。

从文档：

*   不在磁盘上创建任何临时文件来处理堆转储

*   可以直接工作 GZ 压缩堆转储

*   堆路径表示法

# visual-studio-2008 - 自动删除 Visual Studio 二进制输出文件夹？

> ID：185896
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-10-09T04:05:14.540
> 
>         
> 
> 标签：visual-studio-2008, svn

我刚刚从大约 30 个 VS 项目中手动删除`bin\`和`obj\`文件夹，让它们为初始 SVN 提交做好准备。是的，我知道，我应该早点做，但这些是我家用 PC 上的个人项目，我今天只在本地安装了 SVN 服务器。

无论如何，在我看来，必须有一些更简单的方法来清理这些文件夹，Visual Studio 中的一个选项，或者一个外部工具，等等……有没有人有任何建议，因为我还有一些解决方案要做?

* * *

## 回答 #1

> 赞同：4
> 
>             
> 
> 时间：2008-10-09T04:09:41.283

您可以使用[svn:ignore](https://stackoverflow.com/questions/85353/best-general-svn-ignore-pattern)来避免提交不必要的文件...

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T04:10:14.090

一旦您将解决方案添加到 Subversion，[VisualSVN就会自动为二进制和用户特定文件夹创建 svn:ignore 规则。](http://visualsvn.com)

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T04:10:31.360

当您对解决方案或项目文件进行“清理”时会发生什么？您可以在将项目文件添加到 SVN 之前进行清理。

您可以尝试的另一件事是将排除规则添加到您的 SVN 存储库。

您甚至可以创建一个新的构建目标（例如，称为“SVN Prep”），它只运行一个通过批处理文件或 Windows 脚本清除文件的构建后任务。

我有时采用的一种方法是使用像[Total Commander](http://ghisler.com)这样的高级文件管理器，只需几个步骤即可手动删除文件。我“分解”所有文件夹以在平面视图 ( `CTRL`- `B`) 中查看所有文件，按扩展名对文件进行排序，然后删除所有构建工件。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T06:24:16.660

可以应用于更多情况的非 SVN 特定选项是使用 WinRar。创建项目结构的 zip，然后菜单选项之一是在“平面文件夹”视图中查看存档。这将删除层次结构并显示所有文件。

这在许多方面都很有用，例如与同事共享文件。您可以按类型对文件进行排序，查找所有 .dll 并删除所有用于减小大小的常用库。或者您可以按日期排序，并删除所有上周未更改的 .cs 文件等。

# c# - 本地化/国际化工具

> ID：185898
> 
>         
> 
> 赞同：2
> 
>         
> 
> 时间：2008-10-09T04:05:36.457
> 
>         
> 
> 标签：c#, asp.net, localization

我希望以最少的努力将本地化添加到网站（asp.net /c#，如果这会产生影响）。我看过像[wiztom multilizer](http://www.wizart.com/en/index.shtml) [这样](http://www.multilizer.com/)的工具，我很好奇其他人使用它们的经验。

您是否成功使用过此类工具，如果是，您会采取哪些不同的做法？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T16:27:21.733

根据我制作本地化应用程序的经验，我可以说对于这个问题确实没有一个简单的、收缩包装的解决方案。您最好的选择是大量阅读该主题（Google 是您的朋友）并找出最适合您的特定情况的解决方案。我认为在本地化方面，您会遇到“最少工作量”部分的问题。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-10-24T18:12:43.280

我使用了以下内容：

1.  炼金催化剂

2.  特拉多斯

3.  全球分析仪

4.  灵格比特

您使用哪个取决于您要执行的操作：

您是否正在寻找一种工具来帮助您单独进行字符串外部化（国际化），或者帮助您管理翻译/本地化工作流程？

应用程序有多大（页数、类数）？

国际化了吗？

您打算在内部进行本地化（翻译）还是外包？

谢谢，迈克

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2011-04-04T17:21:29.700

阅读您的帖子，我认为您正在研究国际化（i18）和本地化（L10n），它们是分开的。i18n 正在重构代码，以便它在不同的语言环境（语言/国家，例如加拿大的法语）中正常运行。i18n 发生在 L10n 之前，因为您想将硬代码字符串移动到资源包中。这是一个软件工程的世界。L10n 通常不是软件工程师做的，更多的是翻译公司做的；然后他们做的是翻译文本等等。为此，他们使用特定的工具：Trados 和 Passolo 可能是您正在寻找的。

如果您谈论代码，它可能不是那么“简单”，因为根据您要处理的目标语言环境，您可能需要处理很多事情。例如，如果你留在法国意大利德国西班牙（1i8n 用语中的 FIGS），你会绕过一堆问题，日本皇历，从左到右语言的 UI 重新设计，甚至文件编码和数据交换等。

您可能必须处理对语言环境敏感的方法（这些方法可能会给您带来特定语言/国家/地区语言环境的麻烦），例如文本排序（字母在所有地方都不相同，因此我们查找单词的顺序也是如此）。您必须在资源文件中移动硬代码用户可见文本（对于 L10n）。您可能必须处理编码问题（例如，ASCII 与 UNICODE，哪个 UTF 等）。

在那个世界里，看看 Lingoport 的 Globalyzer，它会“查看”您的代码，然后直接在源代码中提出潜在问题，因此您可以采取行动；它指导要采取的行动，或对问题进行优先排序等。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2012-07-01T04:14:52.347

我发现 Sisulizer 效果很好。我们将它用于 .net Forms 应用程序，但他们声称它适用于大多数应用程序。

# unix - 符号链接和硬链接有什么区别？

> ID：185899
> 
>         
> 
> 赞同：890
> 
>         
> 
> 时间：2008-10-09T04:05:41.840
> 
>         
> 
> 标签：unix, symlink, hardlink

最近我在一次工作面试中被问到这个问题。老实说，我知道符号链接的行为方式以及如何创建符号链接，但不了解硬链接的使用以及它与符号链接的区别。

* * *

## 回答 #1

> 赞同：900
> 
>             
> 
> 时间：2008-10-09T04:07:48.293

在文件系统之下，文件由 inode 表示。（或者是多个inode？不确定。）

文件系统中的文件基本上是指向 inode 的链接。

那么，硬链接只会创建另一个文件，其中包含指向同一底层 inode 的链接。

当您删除一个文件时，它会删除一个指向底层 inode 的链接。仅当所有指向该 inode 的链接都已删除时，该 inode 才会被删除（或可删除/可覆盖）。

符号链接是指向文件系统中另一个名称的链接。

建立硬链接后，链接将指向 inode。删除、重命名或移动原始文件不会影响硬链接，因为它链接到底层 inode。对 inode 上数据的任何更改都会反映在引用该 inode 的所有文件中。

注意：硬链接仅在同一文件系统内有效。符号链接可以跨越文件系统，因为它们只是另一个文件的名称。

* * *

## 回答 #2

> 赞同：550
> 
>             
> 
> 时间：2009-10-07T13:54:14.120

一些可能有帮助的例子。

创建两个包含数据的文件：

```
$ printf Cat > foo
$ printf Dog > bar 
```

创建一个硬链接和软链接（又名符号链接）：

```
$ ln foo foo-hard
$ ln -s bar bar-soft 
```

通过增加大小以长格式列出目录内容：

```
ls -lrS
lrwxr-xr-x   1 user  staff        3  3 Apr 15:25 bar-soft -> bar
-rw-r--r--   2 user  staff        4  3 Apr 15:25 foo-hard
-rw-r--r--   2 user  staff        4  3 Apr 15:25 foo
-rw-r--r--   1 user  staff        4  3 Apr 15:25 bar 
```

这告诉我们

*   第 1 列：软链接和硬链接的文件模式不同

    *   软链接：`lrwxr-xr-x`

        *   文件类型：`l`= 符号链接

        *   所有者权限：`rwx`= 可读、可写、可执行

        *   组权限：`r-x`=可读，不可写，可执行

        *   其他权限：`r-x`=可读，不可写，可执行

    *   硬链接：`-rw-r--r--`

        *   文件类型：`-`= 常规文件

        *   所有者权限：`rw-`= 可读、可写、不可执行

        *   组权限：`r--`=可读，不可写，不可执行

        *   其他权限：`r--`=可读，不可写，不可执行

*   第二列：硬链接文件的链接数较高

*   第 5 列：软链接的大小更小，因为它是参考而不是副本

*   最后一列：符号链接显示链接到的文件通过`->`

更改 foo 的文件名不会影响 foo-hard：

```
$ mv foo foo-new
$ cat foo-hard
Cat 
```

更改 foo 的内容会反映在 foo-hard 中：

```
$ printf Dog >> foo
$ cat foo-hard
CatDog 
```

像 foo-hard 这样的硬链接指向文件的 inode 和内容。

对于 bar-soft 之类的软链接，情况并非如此：

```
$ mv bar bar-new
$ ls bar-soft
bar-soft
$ cat bar-soft  
cat: bar-soft: No such file or directory 
```

找不到文件的内容，因为软链接指向已更改的名称，而不是内容。

同样，如果`foo`被删除，`foo-hard`仍然保留内容；如果`bar`被删除，`bar-soft`则只是指向不存在文件的链接。

* * *

## 回答 #3

> 赞同：534
> 
>             
> 
> 时间：2015-04-22T01:45:24.817

俗话说，一图胜千言。这是我将其可视化的方式：

![在此处输入图像描述](https://i.stack.imgur.com/ka2ab.jpg)

这是我们如何得到这张照片的：

1.  在文件系统中创建一个`myfile.txt`指向新 inode 的名称（其中包含文件的元数据并指向包含其内容的数据块，即文本“Hello, World!”：

    ```
    $ echo 'Hello, World!' > myfile.txt 
    ```

2.  创建一个指向`my-hard-link`文件的硬链接`myfile.txt`，这意味着“创建一个应该指向同一个 inode 的文件`myfile.txt`”：

    ```
    $ ln myfile.txt my-hard-link 
    ```

3.  创建一个指向`my-soft-link`文件的软链接`myfile.txt`，意思是“创建一个应该指向该文件的文件`myfile.txt`”：

    ```
    $ ln -s myfile.txt my-soft-link 
    ```

看看现在如果`myfile.txt`被删除（或移动）会发生什么：`my-hard-link`仍然指向相同的内容，因此不受影响，而`my-soft-link`现在什么都没有。其他答案讨论了每种方法的优缺点。

* * *

## 回答 #4

> 赞同：76
> 
>             
> 
> 时间：2008-10-09T05:22:59.407

当原始文件被移动时，硬链接很有用。例如，将文件从 /bin 移动到 /usr/bin 或 /usr/local/bin。/bin 中文件的任何符号链接都会因此而被破坏，但是硬链接是直接指向文件 inode 的链接，不会在意。

硬链接可能占用更少的磁盘空间，因为它们只占用一个目录条目，而符号链接需要自己的 inode 来存储它指向的名称。

硬链接也需要更少的时间来解决 - 符号链接可以指向符号链接目录中的其他符号链接。其中一些可能位于 NFS 或其他高延迟文件系统上，因此可能会导致网络流量无法解析。硬链接总是在同一个文件系统上，总是在一次查找中被解析，并且从不涉及网络延迟（如果它是 NFS 文件系统上的硬链接，NFS 服务器会进行解析，并且它对客户端系统）。有时这很重要。不适合我，但我可以想象这可能很重要的高性能系统。

我还认为 mmap(2) 甚至 open(2) 之类的东西使用与硬链接相同的功能来保持文件的 inode 处于活动状态，这样即使文件被 unlink(2)ed，inode 仍然允许进程继续访问，只有在进程关闭后，文件才会真正消失。这允许更安全的临时文件（如果您可以以原子方式打开和取消链接，可能有一个我不记得的 POSIX API，那么您确实有一个安全的临时文件）您可以在其中读/写您的数据，任何人都无法访问它。好吧，在 /proc 让每个人都能够查看文件描述符之前确实如此，但那是另一回事了。

说到这一点，恢复在进程 A 中打开但在文件系统上未链接的文件围绕使用硬链接重新创建 inode 链接，因此当打开文件的进程关闭或消失时文件不会消失。

* * *

## 回答 #5

> 赞同：40
> 
>             
> 
> 时间：2014-05-02T06:55:50.680

***软链接***：

soft 或 symbolic 更像是原始文件的快捷方式....如果您删除原始文件，则快捷方式将失败，如果您只删除快捷方式，则原始文件不会发生任何事情。

**软链接语法**：`ln -s   Pathof_Target_file  link`

**输出 ：** `link -> ./Target_file`

**证明：** `readlink  link` 
同样在输出中`ls  -l  link`你会看到第一个字母**l**表示该文件是一个软链接。`lrwxrwxrwx`

 ****删除链接：** `unlink  link`  

**注意：**如果您愿意，即使将软链接从当前目录移到其他地方，您的软链接也可以工作。确保在创建软链接时提供绝对路径而不是相对路径。即（从 /root/user/Target_file 而不是 ./Target_file 开始）

***硬链接：***

硬链接更多的是镜像副本或同一文件的多个路径。对文件 1 做一些事情，它出现在文件 2 中。删除一个仍然可以保持另一个。

仅当所有（硬）链接或（同一文件）inode 的所有路径都已删除时，inode（或文件）才会被删除。

建立硬链接后，该链接具有原始文件的 inode。删除重命名或移动原始文件不会影响硬链接，因为它链接到底层 inode。对 inode 上数据的任何更改都会反映在引用该 inode 的所有文件中。

**硬链接语法**：`ln   Target_file   link`

**输出：**将使用与 Targetfile 相同的 inode 编号创建一个名为 link 的文件。

**证明：（** `ls -i   link   Target_file`  检查他们的inode）

**删除链接：（** `rm  -f  link`像普通文件一样删除链接）

**注意**：符号链接可以跨越文件系统，因为它们只是另一个文件的名称。而硬链接仅在同一文件系统中有效。

**符号链接有一些硬链接缺失的功能：**

*   硬链接指向文件内容。而软链接指向文件名。

*   而硬链接的大小是内容的大小，而软链接的大小是文件名大小。

*   硬链接共享相同的 inode。软链接没有。

*   硬链接不能跨文件系统。软链接可以。

*   您立即知道符号链接指向的位置，而使用硬链接，您需要探索整个文件系统以找到共享相同 inode 的文件。

    `# find / -inum 517333`

    > ```
    > /home/bobbin/sync.sh
    > /root/synchro 
    > ```

*   硬链接不能指向目录。

**硬链接有两个限制：**

*   目录不能硬链接。Linux 不允许这样做来维护目录的非循环树结构。

*   不能跨文件系统创建硬链接。这两个文件必须在同一个文件系统上，因为不同的文件系统有不同的独立 inode 表（不同文件系统上的两个文件，但具有相同的 inode 号会不同）。

* * *

## 回答 #6

> 赞同：36
> 
>             
> 
> 时间：2014-12-08T20:09:39.747

查看硬链接和符号链接之间区别的一种简单方法是通过一个简单的示例。文件的硬链接将指向文件的存储位置，或该文件的 inode。符号链接将指向实际文件本身。

因此，如果我们有一个名为“a”的文件并创建一个硬链接“b”和一个符号链接“c”，它们都引用文件“a”：

```
echo "111" > a
ln a b
ln -s a c 
```

“a”、“b”和“c”的输出将是：

```
cat a --> 111
cat b --> 111
cat c --> 111 
```

现在让我们删除文件“a”，看看“a”、“b”和“c”的输出会发生什么：

```
rm a
cat a --> No such file or directory
cat b --> 111
cat c --> No such file or directory 
```

所以发生了什么事？

因为文件“c”指向文件“a”本身，如果文件“a”被删除，那么文件“c”将没有可指向的东西，实际上它也被删除了。

但是，文件“b”指向文件“a”的存储位置或 inode。因此，如果文件“a”被删除，那么它将不再指向 inode，但因为文件“b”这样做，inode 将继续存储属于“a”的任何内容，直到不再有硬链接指向它。

* * *

## 回答 #7

> 赞同：31
> 
>             
> 
> 时间：2008-10-09T04:09:05.530

符号链接链接到路径名。这可以在系统文件树中的任何位置，甚至在创建链接时也不必存在。目标路径可以是相对的或绝对的。

硬链接是指向 inode 的附加指针，这意味着它们只能存在于与目标相同的卷上。文件的附加硬链接与用于引用文件的“原始”名称无法区分。

* * *

## 回答 #8

> 赞同：22
> 
>             
> 
> 时间：2008-10-09T04:11:32.763

我会把你指向维基百科：

*   [符号链接](http://en.wikipedia.org/wiki/Symbolic_link)

*   [硬链接](http://en.wikipedia.org/wiki/Hard_link)

几点：

*   与硬链接不同，符号链接可以跨文件系统（大部分时间）。

*   符号链接可以指向目录。

*   硬链接指向一个文件，使您能够使用多个名称引用同一个文件。

*   只要至少有一个链接，数据仍然可用。

* * *

## 回答 #9

> 赞同：9
> 
>             
> 
> 时间：2008-10-09T06:54:24.993

进行增量备份时，硬链接非常有用。例如，请参见[rsnapshot](http://www.rsnapshot.org/)。这个想法是使用硬链接进行复制：

*   将备份编号 n 复制到 n + 1

*   将备份 n - 1 复制到 n

*   ...

*   将备份 0 复制到备份 1

*   使用任何更改的文件更新备份 0。

除了您所做的任何更改之外，新备份不会占用任何额外空间，因为所有增量备份将指向未更改文件的同一组 inode。

* * *

## 回答 #10

> 赞同：8
> 
>             
> 
> 时间：2017-12-13T06:29:18.237

[![硬链接与软链接](https://i.stack.imgur.com/uNXQS.png)](https://i.stack.imgur.com/uNXQS.png)

这张图片可以很容易地解释硬链接与软链接。

* * *

## 回答 #11

> 赞同：6
> 
>             
> 
> 时间：2015-12-24T15:24:05.257

## 来自[MSDN](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365680(v=vs.85).aspx)，

### [符号链接](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365680(v=vs.85).aspx)

> 符号链接是指向另一个文件系统对象的文件系统对象。被指向的对象称为目标。
> 
>   
>   
> 
> 符号链接对用户是透明的；链接显示为普通文件或目录，用户或应用程序可以以完全相同的方式对其进行操作。
> 
>   
>   
> 
> 符号链接旨在帮助迁移和应用程序与 UNIX 操作系统的兼容性。Microsoft 已实现其符号链接，使其功能与 UNIX 链接一样。
> 
>   
>   
> 
> 符号链接可以是绝对链接或相对链接。绝对链接是指定路径名各部分的链接；相对链接是相对于相对链接说明符在指定路径中的位置确定的

**绝对符号链接的示例**

```
X: "C:\alpha\beta\absLink\gamma\file"
Link: "absLink" maps to "\\machineB\share"
Modified Path: "\\machineB\share\gamma\file" 
```

**相对符号链接的示例**

```
X: C:\alpha\beta\link\gamma\file
Link: "link" maps to "..\..\theta"
Modified Path: "C:\alpha\beta\..\..\theta\gamma\file"
Final Path: "C:\theta\gamma\file" 
```

### [硬链接](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365006(v=vs.85).aspx)

> *硬链接*是文件的文件系统表示，多个路径通过该文件引用**同一卷中**的单个文件。

要在 Windows 中创建硬链接，请导航到要创建链接的位置并输入以下命令：

```
mklink /H Link_name target_path 
```

请注意，您可以按任何顺序删除硬链接，而不管它们的创建顺序如何。此外，硬链接无法创建时

*   引用位于不同的本地驱动器中

*   参考包括网络驱动器。换句话说，其中一个参考是网络驱动器

*   要创建的硬链接与目标在同一路径中

### [结](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365006(v=vs.85).aspx)

NTFS 支持另一种称为联结的链接类型。MSDN 定义如下：

> 联结（也称为软链接）与硬链接的不同之处在于它引用的存储对象是单独的目录，并且联结可以链接位于**同一台计算机上不同本地卷上的**目录。否则，结点的操作与硬链接相同。

硬链接部分和连接部分中的粗体部分显示了两者之间的基本区别。

在 windows 中创建连接的命令，导航到要创建链接的位置，然后输入：

```
mklink /J link_name target_path 
```

* * *

## 回答 #12

> 赞同：5
> 
>             
> 
> 时间：2008-10-09T05:05:43.560

我补充尼克的问题：*硬链接*什么时候有用或必要？我想到的唯一应用程序，其中符号链接不能完成这项工作，是在 chroot 环境中提供系统文件的副本。

* * *

## 回答 #13

> 赞同：3
> 
>             
> 
> 时间：2009-11-04T08:55:20.860

还：

1.  硬链接的读取性能优于符号链接（微性能）

2.  符号链接可以被复制、版本控制等。换句话说，它们是一个实际的文件。另一方面，硬链接的级别略低，您会发现与符号链接相比，提供将硬链接作为硬链接而不是普通文件处理的工具的工具较少

* * *

## 回答 #14

> 赞同：3
> 
>             
> 
> 时间：2013-08-05T05:11:19.607

简单来说，硬链接：就是给一个文件添加一个新的名字，也就是说，一个文件可以同时有多个名字，所有名字都是一样的，没有一个首选，硬链接不是复制所有内容文件并制作新文件不是那样，它只是创建一个已知的替代名称..

符号链接（symlink）：是指向另一个文件的文件指针，如果符号链接指向一个现有文件，该文件后来被删除，则符号链接继续指向相同的文件名，即使该名称不再命名任何文件。

* * *

## 回答 #15

> 赞同：3
> 
>             
> 
> 时间：2014-11-28T15:32:19.357

您认为的普通“文件”实际上是两个独立的东西：文件的数据和目录条目。为文件创建硬链接时，实际上是创建了第二个目录条目，它引用了相同的数据。两个目录条目具有完全相同的功能；每一个都可以用来打开文件来读取它。因此，您实际上并没有“一个文件加上一个硬链接”，而是“具有两个目录条目的文件数据”。您认为删除文件实际上会删除目录条目，当数据的最后一个目录条目被删除时，数据本身也会被删除。对于只有一个目录条目的普通文件，删除目录条目会像往常一样删除数据。（打开文件时，操作系统会创建一个指向该文件的临时链接，

例如，创建一个文件 A.txt，一个硬链接 B.txt，并删除 A.txt。创建 A.txt 时，会创建一些数据和目录条目 A.txt。创建硬链接时，会创建另一个目录条目 B.txt，指向完全相同的数据。当您删除 A.txt 时，您仍然拥有所有数据和单个目录条目 B.txt，就好像您首先创建了一个文件 B.txt。

软链接只是一个（几乎）普通文件，只是它不包含数据，而是另一个目录条目的路径。如果您删除软链接引用的文件，则软链接将包含不再指向目录条目的路径；它被打破。如果删除软链接，就像删除任何其他文件一样，它指向的文件不受影响。

* * *

## 回答 #16

> 赞同：2
> 
>             
> 
> 时间：2012-01-16T14:03:17.060

加上上面所有的答案，找到硬链接和软链接文件的区别可以理解如下：

我的当前目录中有一个文件`f6`，还有一个名为`t2`.

名为`f1`和的文件`./t2/f2`是指向`f6`.

文件名为`f7`和`./t2/f8`是`f6`.

要找到软链接和硬链接，我们可以使用：

```
$ find -L . -samefile f6 

> ./f1
> ./f6
> ./f7
> ./t2/f2
> ./t2/f8 
```

要仅查找硬链接，我们可以使用：

```
$ find . -xdev -samefile f6

> ./f6
> ./f7
> ./t2/f8 
```

由于可以在同一个文件系统上创建硬链接，我们可以在同一个文件系统/挂载点中搜索所有不`-L`使用选项（with option）的硬链接。`-xdev`它将不必要的搜索保存到不同的挂载点。

所以搜索硬链接比搜索软链接要快一些（如果我错了或不清楚，请纠正）。

* * *

## 回答 #17

> 赞同：2
> 
>             
> 
> 时间：2016-07-18T06:20:55.620

目录条目是链接结构：

```
struct dentry{
    ino_t ino;
    char  name[256];
} 
```

ino是inode个数，name是文件名，inode结构可能是这样的：</p>

```
struct inode{
      link_t nlink; 
      ...
} 
```

例如，您创建一个文件 /1，目录条目可能如下：

```
struct dentry{
     ino_t ino; /* such as 15 */
     char  name[256]; /* "1" */
} 
```

inode 结构可能像：

```
 struct inode{ /* inode number 15 */
         link_t nlink; /* nlink = 1 */
         ...
    } 
```

然后你创建一个硬链接（可能是/100），目录条目可能像：

```
 struct dentry{
     ino_t ino; /* 15 */
     char  name[256]; /* 100 */
  } 
```

inode 结构可能像：

```
 struct inode{ /* inode numebr 15 */
         link_t nlink; /* nlink = 2 */
         ...
    } 
```

然后你创建一个到文件 1 的符号链接（可能是 /200），目录条目可能像：

```
 struct dentry{
        ino_t ino; /* such as 16 */
        char  name[256]; /* "200" */
  } 
```

inode 结构可能像：

```
 struct inode{ /* inode number 15 */ 
         link_t nlink; /* nlink = 2 */
         ...
    }

   struct inode{ /* inode number 16 */
         link_t nlink; /* nlink = 1 */
         ...
    } /* the data of inode 16 maybe /1 or 1 */ 
```

* * *

## 回答 #18

> 赞同：2
> 
>             
> 
> 时间：2018-05-22T12:17:32.977

我的两分钱使用：

**软**链接可用于缩短长路径名，即：

```
ln -s /long/folder/name/on/long/path/file.txt /short/file.txt 
```

所做的更改`/short/file.txt`将应用​​于原始文件。

**硬**链接可用于移动大文件：

```
$ ls -lh /myapp/dev/
total 10G
-rw-r--r-- 2 root root 10G May 22 12:09 application.bin 
```

`ln /myapp/dev/application.bin /myapp/prd/application.bin`

即时复制到不同的文件夹，并且`/myapp/dev`可以移动或删除原始文件（on），而无需触摸文件`/myapp/prd`

* * *

## 回答 #19

> 赞同：1
> 
>             
> 
> 时间：2014-11-25T06:26:13.567

符号链接以类似于硬链接的方式为文件提供另一个名称。但是即使有剩余的符号链接，也可以删除文件。

* * *

## 回答 #20

> 赞同：0
> 
>             
> 
> 时间：2017-11-06T19:50:19.673

我刚刚找到了一种简单的方法来理解常见场景中的硬链接，即软件安装。

有一天，我下载了一个软件到文件夹`Downloads`进行安装。在我这样做之后`sudo make install`，一些可执行文件被`cp`编辑到本地 bin 文件夹中。在这里，`cp`创建***硬链接***。我对这个软件很满意，但很快意识到`Downloads`从长远来看这不是一个好地方。所以我`mv`将软件文件夹编辑到  `source`目录。好吧，我仍然可以像以前一样运行该软件，而不必担心任何目标链接的事情，就像在 Windows 中一样。这意味着***硬链接***直接查找 inode 和周围的其他文件。

* * *

## 回答 #21

> 赞同：0
> 
>             
> 
> 时间：2018-02-19T16:47:24.220

在这个答案中，当我说一个文件时，我的意思是内存中的位置

保存的所有数据都使用称为 inodes 的数据结构存储在内存中。每个 inode 都有一个 inode 编号。inode 编号用于访问 inode。文件的所有硬链接可能具有不同的名称，但共享相同的 inode 编号。由于所有硬链接都具有相同的 inode 编号（反过来访问相同的 inode），它们都指向相同的物理内存。

符号链接是一种特殊的文件。因为它也是一个文件，所以它会有一个文件名和一个 inode 编号。如上所述，inode 编号访问一个指向数据的 inode。现在，符号链接的特殊之处在于符号链接中的 inode 编号访问指向另一个文件的“路径”的那些 inode。更具体地说，符号链接中的 inode 编号访问指向另一个硬链接的那些 inode。

当我们在 GUI 中移动、复制、删除文件时，我们正在使用文件的硬链接而不是物理内存。当我们删除文件时，我们正在删除文件的硬链接。我们没有清除物理内存。如果文件的所有硬链接都被删除，那么将无法访问存储的数据，尽管它可能仍然存在于内存中

* * *

## 回答 #22

> 赞同：0
> 
>             
> 
> 时间：2021-01-04T03:35:54.510

我刚刚找到了一种简单的方法来理解常见场景中的硬链接，即软件安装。

有一天，我下载了一个软件到文件夹 Downloads 进行安装。在我执行 sudo make install 之后，一些可执行文件被保存到本地 bin 文件夹中。在这里， cp 创建硬链接。我对这个软件很满意，但很快意识到从长远来看，下载并不是一个好地方。所以我将软件文件夹移动到源目录。好吧，我仍然可以像以前一样运行该软件，而不必担心任何目标链接的事情，就像在 Windows 中一样。这意味着硬链接直接查找 inode 和周围的其他文件。

* * *

## 回答 #23

> 赞同：0
> 
>             
> 
> 时间：2021-03-20T11:37:42.543

硬链接是 unix，就像它在 unix 和 linux 中是旧的一样，但是符号链接在 linux 中是新的。

硬链接 inode 与原始文件 inode 相同。但是 symbolik 链接 inode 与原始文件 inode 不同。

以字节为单位的硬链接文件大小与以字节为单位的原始文件大小相同。但是以字节为单位的符号链接文件大小与以字节为单位的原始文件大小不同。符号链接文件大小小于原始文件大小。

硬链接是原始文件的镜像副本。符号链接或软链接就像 Windows 中的快捷方式。

如果您删除原始文件，硬链接将保留其文件，您可以看到硬链接文件内容。在符号链接中，如果删除原始文件，其符号链接将断开，符号链接仍然存在，但无法显示符号链接内容。

符号链接是新的，它有很多功能，但硬链接是旧的，这就是为什么它的功能较少。

让我们使用终端制作一些硬链接和符号链接：echo "why so Serious" > file.txt

硬链接：ln file.txt file_hard

符号链接：ln -s file.txt file_sym

让我们看看 inode 的内容：ls -li

* * *

## 回答 #24

> 赞同：-2
> 
>             
> 
> 时间：2021-07-13T14:02:29.873

解析为内容为[路径名](https://en.wikipedia.org/wiki/Path_(computing))的文件的链接（文件名）为符号链接，否则为硬链接。

目录本质上是一个表，其中条目是文件名（链接）和 inode 编号。链接（硬链接或符号链接）解析为目录中的 inode 编号，然后目录中的 inode 解析为 inode 表中的 inode 记录（有关文件的信息）。inode 记录中的一条信息是文件类型。

从 inode 记录中，文件系统可以访问 inode 所代表的文件的数据，因为文件的地址是构成记录的信息集合的一部分。

如果文件的数据是链接（路径名），则文件是符号链接，否则是硬链接。换句话说，符号链接是一个文件，其数据是路径名（硬链接）。

# c# - 弱引用和事件处理

> ID：185931
> 
>         
> 
> 赞同：33
> 
>         
> 
> 时间：2008-10-09T04:18:30.113
> 
>         
> 
> 标签：c#, .net, design-patterns, weak-references

如果该事件是唯一持有引用的事物并且我们需要对对象进行垃圾收集，那么通过 WeakReference 实现事件处理是否是一种好习惯？  

作为对此的论据：   

人们说，如果您订阅了某些内容，您有责任取消订阅，您应该这样做。

* * *

## 回答 #1

> 赞同：14
> 
>             
> 
> 时间：2008-10-09T15:59:52.223

尽可能养成退订事件的习惯是件好事，但有时没有明显的“清理”方法可以做到这一点。我们最近发布了一篇关于这个主题的[博客文章；](https://faithlife.codes/blog/2008/08/event_subscription_using_weak_references/)它包括使使用 Wea​​kReference 订阅事件变得容易的方法。

* * *

## 回答 #2

> 赞同：12
> 
>             
> 
> 时间：2008-10-09T08:17:29.397

弱委托模式应该存在于 CLR 中。正常事件表现出“在你还活着的时候通知我”语义，而我们经常需要“在我活着的时候通知我”。仅仅在 WeakReference 上有委托是错误的，因为委托也是一个对象，即使接收者还活着并且有传入的引用，委托本身也只会被所述 WeakReference 引用，并且会立即被收集。有关实施示例，请参阅[此旧帖子。](https://docs.microsoft.com/en-us/archive/blogs/greg_schechter/simulating-weak-delegates-in-the-clr)

* * *

## 回答 #3

> 赞同：7
> 
>             
> 
> 时间：2008-10-09T08:24:34.907

弱引用本身，并不能解决问题，因为委托持有引用。在 Prism (www.microsoft.com/compositewpf) 附带的复合应用程序库中，有一个 WeakDelegate 类，您可以从源代码中提取该类。WeakDelegate 基本上使用反射并仅在一段时间内创建一个委托，然后释放它，因此不持有任何指针。在 CAL 中，它由 EventAggregator 类使用，但您可以自由地将其撕掉以供自己使用，因为它在 MS-PL 下。

* * *

## 回答 #4

> 赞同：-2
> 
>             
> 
> 时间：2008-10-09T06:12:59.943

虽然您的建议解决了一组问题（事件引用管理和内存泄漏预防），但它可能会引发一组新问题。

我可以看到的一个问题是，在事件处理过程中，如果源对象被垃圾收集（因为它只被一个弱引用保存），任何访问源对象的代码都会导致空引用异常。您可以争辩说事件处理程序不应该访问源对象，或者它必须具有强引用，但可以争辩说这可能比您首先尝试解决的问题更糟糕。

# php - 如何在 PHP 中创建对象的副本？

> ID：185934
> 
>         
> 
> 赞同：189
> 
>         
> 
> 时间：2008-10-09T04:21:03.523
> 
>         
> 
> 标签：php, copy, clone, shallow-copy

似乎在 PHP 中对象是通过引用传递的。甚至赋值运算符似乎也没有创建对象的副本。

这是一个简单的、人为的证明：

```
<?php

class A {
    public $b;
}

function set_b($obj) { $obj->b = "after"; }

$a = new A();
$a->b = "before";
$c = $a; //i would especially expect this to create a copy.

set_b($a);

print $a->b; //i would expect this to show 'before'
print $c->b; //i would ESPECIALLY expect this to show 'before'

?> 
```

在这两种印刷情况下，我都在“追求”

那么，如何通过值而不是引用将**$a**传递给***set_b() ？***

* * *

## 回答 #1

> 赞同：317
> 
>             
> 
> 时间：2008-10-09T04:24:09.790

在 PHP 5+ 中，对象是通过引用传递的。在 PHP 4 中，它们是按值传递的（这就是它在运行时通过引用传递的原因，这已被弃用）。

您可以使用 PHP5 中的“克隆”运算符来复制对象：

```
$objectB = clone $objectA; 
```

此外，它只是通过引用传递的对象，而不是您在问题中所说的所有内容......

* * *

## 回答 #2

> 赞同：117
> 
>             
> 
> 时间：2008-10-09T05:28:54.947

答案通常在 Java 书籍中找到。

1.  克隆：如果不覆盖克隆方法，则默认行为是浅拷贝。如果您的对象只有原始成员变量，那完全可以。但是在以另一个对象作为成员变量的无类型语言中，这是一个令人头疼的问题。

2.  序列化/反序列化

`$new_object = unserialize(serialize($your_object))`

这取决于对象的复杂性，以高成本实现深度复制。

* * *

## 回答 #3

> 赞同：25
> 
>             
> 
> 时间：2008-10-09T06:53:07.820

根据之前的评论，如果您有另一个对象作为成员变量，请执行以下操作：

```
class MyClass {
  private $someObject;

  public function __construct() {
    $this->someObject = new SomeClass();
  }

  public function __clone() {
    $this->someObject = clone $this->someObject;
  }

} 
```

现在您可以进行克隆：

```
$bar = new MyClass();
$foo = clone $bar; 
```

* * *

## 回答 #4

> 赞同：11
> 
>             
> 
> 时间：2008-10-09T04:23:05.157

根据文档（[http://ca3.php.net/language.oop5.cloning](http://ca3.php.net/language.oop5.cloning)）：

```
$a = clone $b; 
```

* * *

## 回答 #5

> 赞同：4
> 
>             
> 
> 时间：2015-05-06T00:36:36.520

只是为了澄清 PHP 在写入时使用复制，所以基本上所有内容都是参考，直到您修改它，但是对于对象，您需要使用 clone 和 __clone() 魔术方法，就像在接受的答案中一样。

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2013-10-03T20:25:32.220

此代码帮助克隆方法

```
class Foo{

    private $run=10;
    public $foo=array(2,array(2,8));
    public function hoo(){return 5;}

    public function __clone(){

        $this->boo=function(){$this->hoo();};

    }
}
$obj=new Foo;

$news=  clone $obj;
var_dump($news->hoo()); 
```

* * *

## 回答 #7

> 赞同：1
> 
>             
> 
> 时间：2014-01-23T19:29:00.943

我正在做一些测试并得到了这个：

```
class A {
  public $property;
}

function set_property($obj) {
  $obj->property = "after";
  var_dump($obj);
}

$a = new A();
$a->property = "before";

// Creates a new Object from $a. Like "new A();"
$b = new $a;
// Makes a Copy of var $a, not referenced.
$c = clone $a;

set_property($a);
// object(A)#1 (1) { ["property"]=> string(5) "after" }

var_dump($a); // Because function set_property get by reference
// object(A)#1 (1) { ["property"]=> string(5) "after" }
var_dump($b);
// object(A)#2 (1) { ["property"]=> NULL }
var_dump($c);
// object(A)#3 (1) { ["property"]=> string(6) "before" }

// Now creates a new obj A and passes to the function by clone (will copied)
$d = new A();
$d->property = "before";

set_property(clone $d); // A new variable was created from $d, and not made a reference
// object(A)#5 (1) { ["property"]=> string(5) "after" }

var_dump($d);
// object(A)#4 (1) { ["property"]=> string(6) "before" }

?> 
```

* * *

## 回答 #8

> 赞同：1
> 
>             
> 
> 时间：2017-11-03T16:59:36.040

在这个例子中，我们将创建**iPhone**类并通过**克隆从它复制**

```
class iPhone {

public $name;
public $email;

    public function __construct($n, $e) {

       $this->name = $n;
       $this->email = $e;

    }
}

$main = new iPhone('Dark', 'm@m.com');
$copy = clone $main;

// if you want to print both objects, just write this    

echo "<pre>"; print_r($main);  echo "</pre>";
echo "<pre>"; print_r($copy);  echo "</pre>"; 
```

* * *

## 回答 #9

> 赞同：-1
> 
>             
> 
> 时间：2013-08-20T14:00:47.727

如果您想在不同实例中完全复制对象的属性，您可能需要使用此技术：

将其序列化为 JSON，然后将其反序列化回 Object。

# python - 如何删除文件夹的内容？

> ID：185936
> 
>         
> 
> 赞同：662
> 
>         
> 
> 时间：2008-10-09T04:22:33.817
> 
>         
> 
> 标签：python, file

如何在 Python 中删除本地文件夹的内容？

当前项目适用于 Windows，但我也希望看到 *nix。

* * *

## 回答 #1

> 赞同：592
> 
>             
> 
> 时间：2008-10-09T04:27:21.357

```
import os, shutil
folder = '/path/to/folder'
for filename in os.listdir(folder):
    file_path = os.path.join(folder, filename)
    try:
        if os.path.isfile(file_path) or os.path.islink(file_path):
            os.unlink(file_path)
        elif os.path.isdir(file_path):
            shutil.rmtree(file_path)
    except Exception as e:
        print('Failed to delete %s. Reason: %s' % (file_path, e)) 
```

* * *

## 回答 #2

> 赞同：402
> 
>             
> 
> 时间：2011-04-22T15:23:45.107

你可以简单地这样做：

```
import os
import glob

files = glob.glob('/YOUR/PATH/*')
for f in files:
    os.remove(f) 
```

您当然可以在路径中使用其他过滤器，例如：/YOU/PATH/*.txt 用于删除目录中的所有文本文件。

* * *

## 回答 #3

> 赞同：302
> 
>             
> 
> 时间：2008-10-09T07:18:35.990

您可以使用以下方法删除文件夹本身及其所有内容[`shutil.rmtree`](https://docs.python.org/library/shutil.html#shutil.rmtree)：

```
import shutil
shutil.rmtree('/path/to/folder') 
```

> `shutil.**rmtree**(*path*, *ignore_errors=False*, *onerror=None*)`
>   
>   
> 
>   删除整个目录树；*path*必须指向一个目录（但不是指向目录的符号链接）。如果*ignore_errors*为真，删除失败导致的错误将被忽略；*如果为 false 或省略，则通过调用由onerror*指定的处理程序来处理此类错误，或者，如果省略，则引发异常。

* * *

## 回答 #4

> 赞同：105
> 
>             
> 
> 时间：2009-07-02T09:25:56.857

扩展 mhawke 的答案，这就是我已经实现的。它会删除文件夹的所有内容，但不会删除文件夹本身。在 Linux 上使用文件、文件夹和符号链接进行测试，应该也可以在 Windows 上运行。

```
import os
import shutil

for root, dirs, files in os.walk('/path/to/folder'):
    for f in files:
        os.unlink(os.path.join(root, f))
    for d in dirs:
        shutil.rmtree(os.path.join(root, d)) 
```

* * *

## 回答 #5

> 赞同：49
> 
>             
> 
> 时间：2011-07-07T18:25:47.003

使用`rmtree`和重新创建文件夹可能会起作用，但是在删除并立即在网络驱动器上重新创建文件夹时遇到了错误。

使用 walk 的建议解决方案不起作用，因为它用于`rmtree`删除文件夹，然后可能会尝试`os.unlink`在这些文件夹中的文件上使用。这会导致错误。

发布的`glob`解决方案还将尝试删除非空文件夹，从而导致错误。

我建议你使用：

```
folder_path = '/path/to/folder'
for file_object in os.listdir(folder_path):
    file_object_path = os.path.join(folder_path, file_object)
    if os.path.isfile(file_object_path) or os.path.islink(file_object_path):
        os.unlink(file_object_path)
    else:
        shutil.rmtree(file_object_path) 
```

* * *

## 回答 #6

> 赞同：42
> 
>             
> 
> 时间：2019-05-15T14:04:07.273

我很惊讶没有人提到[`pathlib`](https://docs.python.org/3/library/pathlib.html)做这项工作的真棒。

如果您只想删除目录中的文件，则可以是 oneliner

```
from pathlib import Path

[f.unlink() for f in Path("/path/to/folder").glob("*") if f.is_file()] 
```

要递归删除目录，您可以编写如下内容：

```
from pathlib import Path
from shutil import rmtree

for path in Path("/path/to/folder").glob("**/*"):
    if path.is_file():
        path.unlink()
    elif path.is_dir():
        rmtree(path) 
```

* * *

## 回答 #7

> 赞同：25
> 
>             
> 
> 时间：2012-09-21T08:24:58.010

这：

*   删除所有符号链接

    *   死链接

    *   目录链接

    *   文件链接

*   删除子目录

*   不删除父目录

代码：

```
for filename in os.listdir(dirpath):
    filepath = os.path.join(dirpath, filename)
    try:
        shutil.rmtree(filepath)
    except OSError:
        os.remove(filepath) 
```

与许多其他答案一样，这不会尝试调整权限以启用文件/目录的删除。

* * *

## 回答 #8

> 赞同：23
> 
>             
> 
> 时间：2012-12-02T05:51:33.837

在 Python 3.6+ 中使用[os.scandir 和上下文管理器协议：](https://docs.python.org/3/library/os.html#os.scandir.close)

```
import os
import shutil

with os.scandir(target_dir) as entries:
    for entry in entries:
        if entry.is_dir() and not entry.is_symlink():
            shutil.rmtree(entry.path)
        else:
            os.remove(entry.path) 
```

早期版本的 Python：

```
import os
import shutil

# Gather directory contents
contents = [os.path.join(target_dir, i) for i in os.listdir(target_dir)]

# Iterate and remove each item in the appropriate manner
[shutil.rmtree(i) if os.path.isdir(i) and not os.path.islink(i) else os.remove(i) for i in contents] 
```

* * *

## 回答 #9

> 赞同：17
> 
>             
> 
> 时间：2013-11-24T11:22:15.333

作为单行者：

```
import os

# Python 2.7
map( os.unlink, (os.path.join( mydir,f) for f in os.listdir(mydir)) )

# Python 3+
list( map( os.unlink, (os.path.join( mydir,f) for f in os.listdir(mydir)) ) ) 
```

考虑文件和目录的更强大的解决方案是（2.7）：

```
def rm(f):
    if os.path.isdir(f): return os.rmdir(f)
    if os.path.isfile(f): return os.unlink(f)
    raise TypeError, 'must be either file or directory'

map( rm, (os.path.join( mydir,f) for f in os.listdir(mydir)) ) 
```

* * *

## 回答 #10

> 赞同：17
> 
>             
> 
> 时间：2014-07-19T20:21:55.737

*注意：如果有人对我的回答投了反对票，我在这里有话要解释。*

1.  每个人都喜欢简短的“n”简单的答案。然而，有时现实并非如此简单。

2.  回到我的答案。我知道`shutil.rmtree()`可以用来删除目录树。我在自己的项目中多次使用它。但是你必须意识到**目录本身也会被删除`shutil.rmtree()`**。虽然这对某些人来说可能是可以接受的，但它不是**删除文件夹内容的有效答案（没有副作用）**。

3.  我将向您展示副作用的示例。假设您有一个包含**自定义**所有者和模式位的目录，其中有很多内容。然后你用 删除它`shutil.rmtree()`并用 重建它`os.mkdir()`。您将获得一个空目录，其中包含**默认**（继承）所有者和模式位。虽然您可能有权删除内容甚至目录，但您可能无法设置目录上的原始所有者和模式位（例如，您不是超级用户）。

4.  最后，**耐心阅读代码**。它又长又丑（看得见），但被证明是可靠和高效的（在使用中）。

* * *

这是一个冗长而丑陋但可靠且有效的解决方案。

它解决了其他回答者未解决的一些问题：

*   它正确处理符号链接，包括不调用符号链接（如果它链接到目录`shutil.rmtree()`，它将通过测试；甚至包含符号链接目录的结果也是如此）。`os.path.isdir()``os.walk()`

*   它很好地处理只读文件。

这是代码（唯一有用的功能是`clear_dir()`）：

```
import os
import stat
import shutil

# http://stackoverflow.com/questions/1889597/deleting-directory-in-python
def _remove_readonly(fn, path_, excinfo):
    # Handle read-only files and directories
    if fn is os.rmdir:
        os.chmod(path_, stat.S_IWRITE)
        os.rmdir(path_)
    elif fn is os.remove:
        os.lchmod(path_, stat.S_IWRITE)
        os.remove(path_)

def force_remove_file_or_symlink(path_):
    try:
        os.remove(path_)
    except OSError:
        os.lchmod(path_, stat.S_IWRITE)
        os.remove(path_)

# Code from shutil.rmtree()
def is_regular_dir(path_):
    try:
        mode = os.lstat(path_).st_mode
    except os.error:
        mode = 0
    return stat.S_ISDIR(mode)

def clear_dir(path_):
    if is_regular_dir(path_):
        # Given path is a directory, clear its content
        for name in os.listdir(path_):
            fullpath = os.path.join(path_, name)
            if is_regular_dir(fullpath):
                shutil.rmtree(fullpath, onerror=_remove_readonly)
            else:
                force_remove_file_or_symlink(fullpath)
    else:
        # Given path is a file or a symlink.
        # Raise an exception here to avoid accidentally clearing the content
        # of a symbolic linked directory.
        raise OSError("Cannot call clear_dir() on a symbolic link") 
```

* * *

## 回答 #11

> 赞同：14
> 
>             
> 
> 时间：2013-06-17T11:52:24.243

我以前是这样解决问题的：

```
import shutil
import os

shutil.rmtree(dirpath)
os.mkdir(dirpath) 
```

* * *

## 回答 #12

> 赞同：10
> 
>             
> 
> 时间：2019-02-26T15:59:34.473

要删除目录及其子目录中的所有文件，而不删除文件夹本身，只需执行以下操作：

```
import os
mypath = "my_folder" #Enter your path here
for root, dirs, files in os.walk(mypath):
    for file in files:
        os.remove(os.path.join(root, file)) 
```

* * *

## 回答 #13

> 赞同：8
> 
>             
> 
> 时间：2008-10-09T05:52:54.213

你可能会更好地使用`os.walk()`这个。

`os.listdir()`不区分文件和目录，你很快就会在试图取消链接时遇到麻烦。这里有一个很好的使用`os.walk()`递归删除目录[的](http://docs.python.org/library/os.html#os.walk)例子，并提示如何使其适应您的环境。

* * *

## 回答 #14

> 赞同：8
> 
>             
> 
> 时间：2018-06-12T09:06:41.950

如果您使用的是 *nix 系统，为什么不利用 system 命令呢？

```
import os
path = 'folder/to/clean'
os.system('rm -rf %s/*' % path) 
```

* * *

## 回答 #15

> 赞同：7
> 
>             
> 
> 时间：2021-05-12T19:04:36.193

要删除文件夹中的所有文件，我使用：

```
import os
for i in os.listdir():
    os.remove(i) 
```

* * *

## 回答 #16

> 赞同：6
> 
>             
> 
> 时间：2020-01-11T11:34:57.087

我必须从单个父目录中的 3 个单独文件夹中删除文件：

```
directory
   folderA
      file1
   folderB
      file2
   folderC
      file3 
```

这个简单的代码对我有用：（我在 Unix 上）

```
import os
import glob

folders = glob.glob('./path/to/parentdir/*')
for fo in folders:
  file = glob.glob(f'{fo}/*')
  for f in file:
    os.remove(f) 
```

希望这可以帮助。

* * *

## 回答 #17

> 赞同：5
> 
>             
> 
> 时间：2013-05-02T14:24:00.543

我知道这是一个旧线程，但我从 python 的官方站点发现了一些有趣的东西。只是为了分享另一个删除目录中所有内容的想法。因为我在使用 shutil.rmtree() 时遇到了一些授权问题，我不想删除目录并重新创建它。地址原文为[http://docs.python.org/2/library/os.html#os.walk](http://docs.python.org/2/library/os.html#os.walk)。希望可以帮助某人。

```
def emptydir(top):
    if(top == '/' or top == "\\"): return
    else:
        for root, dirs, files in os.walk(top, topdown=False):
            for name in files:
                os.remove(os.path.join(root, name))
            for name in dirs:
                os.rmdir(os.path.join(root, name)) 
```

* * *

## 回答 #18

> 赞同：5
> 
>             
> 
> 时间：2014-05-12T16:33:30.933

另一个解决方案：

```
import sh
sh.rm(sh.glob('/path/to/folder/*')) 
```

* * *

## 回答 #19

> 赞同：4
> 
>             
> 
> 时间：2019-07-26T09:16:07.857

非常直观的做法：

```
import shutil, os

def remove_folder_contents(path):
    shutil.rmtree(path)
    os.makedirs(path)

remove_folder_contents('/path/to/folder') 
```

* * *

## 回答 #20

> 赞同：4
> 
>             
> 
> 时间：2019-11-04T18:59:32.977

好吧，我认为这段代码有效。它不会删除文件夹，您可以使用此代码删除具有特定扩展名的文件。

```
import os
import glob

files = glob.glob(r'path/*')
for items in files:
    os.remove(items) 
```

* * *

## 回答 #21

> 赞同：1
> 
>             
> 
> 时间：2019-02-03T08:23:33.507

使用下面的方法来删除目录的内容，而不是目录本身：

```
import os
import shutil

def remove_contents(path):
    for c in os.listdir(path):
        full_path = os.path.join(path, c)
        if os.path.isfile(full_path):
            os.remove(full_path)
        else:
            shutil.rmtree(full_path) 
```

* * *

## 回答 #22

> 赞同：0
> 
>             
> 
> 时间：2016-12-27T10:55:07.860

回答有限的特定情况：假设您要在维护子文件夹树的同时删除文件，您可以使用递归算法：

```
import os

def recursively_remove_files(f):
    if os.path.isfile(f):
        os.unlink(f)
    elif os.path.isdir(f):
        for fi in os.listdir(f):
            recursively_remove_files(os.path.join(f, fi))

recursively_remove_files(my_directory) 
```

也许有点题外话，但我想很多人会觉得它很有用

* * *

## 回答 #23

> 赞同：0
> 
>             
> 
> 时间：2017-03-21T16:10:39.193

`rmtree` `makedirs`我通过添加以下内容解决了这个问题`time.sleep()`：

```
if os.path.isdir(folder_location):
    shutil.rmtree(folder_location)

time.sleep(.5)

os.makedirs(folder_location, 0o777) 
```

* * *

## 回答 #24

> 赞同：-1
> 
>             
> 
> 时间：2022-02-23T06:41:01.250

最简单的方法是：

```
import os
os.system("del \s \q ") 
```

对，就是那样 ：）

* * *

## 回答 #25

> 赞同：-2
> 
>             
> 
> 时间：2019-07-30T18:40:16.773

删除文件夹中所有文件/删除所有文件的最简单方法

```
import os
files = os.listdir(yourFilePath)
for f in files:
    os.remove(yourFilePath + f) 
```

* * *

## 回答 #26

> 赞同：-4
> 
>             
> 
> 时间：2016-06-20T15:52:45.340

这应该只是使用 OS 模块列出然后删除的技巧！

```
import os
DIR = os.list('Folder')
for i in range(len(DIR)):
    os.remove('Folder'+chr(92)+i) 
```

为我工作，任何问题让我知道！    

# java - Overriding the java equals() method - not working?

> ID：185937
> 
>         
> 
> 赞同：153
> 
>         
> 
> 时间：2008-10-09T04:22:57.543
> 
>         
> 
> 标签：java, equals, overriding

I ran into an interesting (and very frustrating) issue with the `equals()` method today which caused what I thought to be a well tested class to crash and cause a bug that took me a very long time to track down. 

Just for completeness, I wasn't using an IDE or debugger - just good old fashioned text editor and System.out's. Time was very limited and it was a school project.

Anyhow - 

I was developing a basic shopping cart which could contain an *`ArrayList` of `Book` objects*. In order to implement the `addBook()`, `removeBook()`, and `hasBook()` methods of the Cart, I wanted to check if the `Book` already existed in the `Cart`. So off I go -

```
public boolean equals(Book b) {
    ... // More code here - null checks
    if (b.getID() == this.getID()) return true;
    else return false;
} 
```

All works fine in testing. I create 6 objects and fill them with data. Do many adds, removes, has() operations on the `Cart` and everything works fine. I read that you can *either have `equals(TYPE var)` or `equals(Object o) { (CAST) var }`* but assumed that since it was working, it didn't matter too much.

Then I ran into a problem - I needed to create a `Book` object with *only* the `ID` in it from within the Book class. No other data would be entered into it. Basically the following:

```
public boolean hasBook(int i) {
    Book b = new Book(i);
    return hasBook(b);
}

public boolean hasBook(Book b) {
    // .. more code here
    return this.books.contains(b);
} 
```

All of a sudden, the `equals(Book b)` method no longer works. This took a VERY long time to track down without a good debugger and assuming the `Cart` class was properly tested and correct. After swaapping the `equals()` method to the following:

```
public boolean equals(Object o) {
    Book b = (Book) o;
    ... // The rest goes here   
} 
```

Everything began to work again. Is there a reason the method decided not to take the Book parameter even though it clearly ** was ** a `Book` object? The only difference seemed to be it was instantiated from within the same class, and only filled with one data member. I'm very very confused. Please, shed some light?

* * *

## 回答 #1

> 赞同：335
> 
>             
> 
> 时间：2008-10-09T04:27:54.103

In Java, the `equals()` method that is inherited from `Object` is:

```
public boolean equals(Object other); 
```

In other words, the parameter must be of type `Object`. This is called *overriding*; your method `public boolean equals(Book other)` does what is called *overloading* to the `equals()` method.

The `ArrayList` uses overridden `equals()` methods to compare contents (e.g. for its `contains()` and `equals()` methods), **not** overloaded ones. In most of your code, calling the one that didn't properly override `Object`'s equals was fine, but not compatible with `ArrayList`.

So, not overriding the method correctly can cause problems.

I override equals the following everytime:

```
@Override
public boolean equals(Object other){
    if (other == null) return false;
    if (other == this) return true;
    if (!(other instanceof MyClass)) return false;
    MyClass otherMyClass = (MyClass)other;
    ...test other properties here...
} 
```

The use of the `@Override` annotation can help a ton with silly mistakes.

Use it whenever you think you are overriding a super class' or interface's method. That way, if you do it the wrong way, you will get a compile error.

* * *

## 回答 #2

> 赞同：111
> 
>             
> 
> 时间：2011-06-02T16:15:43.400

If you use eclipse just go to the top menu 

> Source --> Generate equals() and
>   hashCode()

* * *

## 回答 #3

> 赞同：11
> 
>             
> 
> 时间：2008-10-09T08:27:54.993

Slightly off-topic to your question, but it's probably worth mentioning anyway:

[Commons Lang](http://commons.apache.org/lang) has got some excellent methods you can use in overriding equals and hashcode. Check out [EqualsBuilder.reflectionEquals(...)](http://commons.apache.org/lang/api-release/org/apache/commons/lang/builder/EqualsBuilder.html#reflectionEquals(java.lang.Object,%20java.lang.Object)) and [HashCodeBuilder.reflectionHashCode(...)](http://commons.apache.org/lang/api-release/org/apache/commons/lang/builder/HashCodeBuilder.html#reflectionHashCode(java.lang.Object)). Saved me plenty of headache in the past - although of course if you just want to do "equals" on ID it may not fit your circumstances.

I also agree that you should use the `@Override` annotation whenever you're overriding equals (or any other method).

* * *

## 回答 #4

> 赞同：5
> 
>             
> 
> 时间：2014-10-17T11:24:19.530

Another fast solution that saves boilerplate code is [Lombok EqualsAndHashCode annotation](http://projectlombok.org/features/EqualsAndHashCode.html). It is easy, elegant and customizable. And **does not depends on the IDE**. For example;

```
import lombok.EqualsAndHashCode;

@EqualsAndHashCode(of={"errorNumber","messageCode"}) // Will only use this fields to generate equals.
public class ErrorMessage{

    private long        errorNumber;
    private int         numberOfParameters;
    private Level       loggingLevel;
    private String      messageCode; 
```

See the [options](http://projectlombok.org/api/lombok/EqualsAndHashCode.html) avaliable to customize which fields to use in the equals. Lombok is avalaible in [maven](http://mvnrepository.com/artifact/org.projectlombok/lombok). Just add it with *provided* scope:

```
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <version>1.14.8</version>
    <scope>provided</scope>
</dependency> 
```

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2015-08-22T05:44:26.493

in Android Studio is
alt + insert ---> equals and hashCode

Example:

```
 @Override
public boolean equals(Object o) {
    if (this == o) return true;
    if (o == null || getClass() != o.getClass()) return false;

    Proveedor proveedor = (Proveedor) o;

    return getId() == proveedor.getId();

}

@Override
public int hashCode() {
    return getId();
} 
```

* * *

## 回答 #6

> 赞同：1
> 
>             
> 
> 时间：2015-09-09T19:38:21.073

Consider:

```
Object obj = new Book();
obj.equals("hi");
// Oh noes! What happens now? Can't call it with a String that isn't a Book... 
```

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2015-01-30T13:42:25.580

the `instanceOf` statement is often used in implementation of equals.

This is a popular pitfall !

The problem is that using `instanceOf` violates the rule of symmetry:

`(object1.equals(object2) == true)` **if and only if** `(object2.equals(object1))`

if the first equals is true, and object2 is an instance of a subclass of
the class where obj1 belongs to, then the second equals will return false!

if the regarded class where ob1 belongs to is declared as final, then this
problem can not arise, but in general, you should test as follows:

`this.getClass() != otherObject.getClass();` if not, return false, otherwise test
the fields to compare for equality!

* * *

## 回答 #8

> 赞同：-1
> 
>             
> 
> 时间：2015-08-24T12:16:49.133

recordId  is property of the  object

```
@Override
    public boolean equals(Object obj) {
        if (this == obj)
            return true;
        if (obj == null)
            return false;
        if (getClass() != obj.getClass())
            return false;
        Nai_record other = (Nai_record) obj;
        if (recordId == null) {
            if (other.recordId != null)
                return false;
        } else if (!recordId.equals(other.recordId))
            return false;
        return true;
    } 
```

# ruby - Ruby：define_method 与 def

> ID：185947
> 
>         
> 
> 赞同：66
> 
>         
> 
> 时间：2008-10-09T04:31:47.310
> 
>         
> 
> 标签：ruby, metaprogramming

作为一个编程练习，我编写了一个 Ruby 片段，它创建一个类，从该类实例化两个对象，对一个对象进行猴子补丁，并依靠 method_missing 对另一个对象进行猴子补丁。

这是交易。这按预期工作：

```
class Monkey

  def chatter
    puts "I am a chattering monkey!"
  end

  def method_missing(m)
    puts "No #{m}, so I'll make one..."
    def screech
      puts "This is the new screech."
    end
  end
end

m1 = Monkey.new
m2 = Monkey.new

m1.chatter
m2.chatter

def m1.screech
  puts "Aaaaaargh!"
end

m1.screech
m2.screech
m2.screech
m1.screech
m2.screech 
```

您会注意到我有一个method_missing 参数。我这样做是因为我希望使用 define_method 来动态创建具有适当名称的缺失方法。但是，它不起作用。事实上，即使使用带有静态名称的 define_method，如下所示：

```
def method_missing(m)
  puts "No #{m}, so I'll make one..."
  define_method(:screech) do
    puts "This is the new screech."
  end
end 
```

以以下结果结束：

```
ArgumentError: wrong number of arguments (2 for 1)

method method_missing   in untitled document at line 9
method method_missing   in untitled document at line 9
at top level    in untitled document at line 26
Program exited. 
```

使错误消息更令人困惑的是，我只有一个论点`method_missing`...

* * *

## 回答 #1

> 赞同：140
> 
>             
> 
> 时间：2008-10-09T04:58:17.037

`define_method`是对象*Class*的（私有）方法。您正在从一个*实例*调用它。没有调用实例方法`define_method`，所以它递归到你的`method_missing`，这次是`:define_method`（缺少的方法的名称）和`:screech`（你传递给的唯一参数`define_method`）。

试试这个（在所有 Monkey 对象上定义新方法）：

```
def method_missing(m)
    puts "No #{m}, so I'll make one..."
    self.class.send(:define_method, :screech) do
      puts "This is the new screech."
    end
end 
```

或者这个（只在它被调用的对象上定义它，使用对象的“特征类”）：

```
def method_missing(m)
    puts "No #{m}, so I'll make one..."
    class << self
      define_method(:screech) do
        puts "This is the new screech."
      end
    end
end 
```

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2008-10-28T02:56:20.513

self.class.define_method(:screech) 不起作用，因为 define_method 是私有方法，你可以这样做

```
class << self
    public :define_method
end
def method_missing(m)
puts "No #{m}, so I'll make one..."
Monkey.define_method(:screech) do
  puts "This is the new screech."
end 
```

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2010-08-27T04:46:01.967

```
def method_missing(m)
    self.class.class_exec do
       define_method(:screech) {puts "This is the new screech."}
    end 
end 
```

尖叫方法将适用于所有 Monkey 对象。

# javascript - 如何通过 JavaScript 检测 Firefox 中安装的 Adob e Acrobat 版本

> ID：185952
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2008-10-09T04:37:22.307
> 
>         
> 
> 标签：javascript, firefox, plugins, version, acrobat

我知道这可以通过创建一个 ActiveX 对象在 IE 中完成，但我如何在 FF 中做到这一点。navigator.plugins['Adobe Acrobat'] 对象让我知道它是否已安装，但它不包含版本号。有任何想法吗？

* * *

## 回答 #1

> 赞同：10
> 
>             
> 
> 时间：2008-10-09T07:53:21.037

`navigator.plugins[n].name`Acrobat 插件的索引应该在哪里`n`有版本号。不幸的是，从 Adob​​e Reader 8 开始，他们将名称改为`"Adobe PDF Plug-In for Firefox and Netscape"`，没有版本信息。因此，如果这是您至少检测到 Reader 8 的名称，但无法区分版本 8 和 9。

此外，请确保您考虑到 Mac 不需要 Acrobat Reader 来呈现 PDF 文件。（我启动我的 Windows 分区只是为了测试它。）

* * *

## 回答 #2

> 赞同：3
> 
>             
> 
> 时间：2010-04-20T16:18:54.510

[http://www.pinlady.net/PluginDetect/AdobeReaderDetect.htm](http://www.pinlady.net/PluginDetect/AdobeReaderDetect.htm)

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T07:59:12.553

应该可以像 swfobject 检测 flash 版本一样执行此操作：

[SWFObject 源代码](http://code.google.com/p/swfobject/source/browse/tags/swfobject_2_1/src/swfobject.js)

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-11-10T04:57:16.987

```
var p = document.getElementById('Pdf1');
//p.GetVersions()
if(p.GetVersions().indexOf("7.0") != -1)
    alert("Acrobat 7 Found") 
```

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2011-05-30T06:59:10.790

此脚本检测所有浏览器中的阅读器 - 甚至检测 Chrome 的 PDF 阅读器...

[Acrobat 检测 Javascript 代码](http://thecodeabode.blogspot.com/2011/01/detect-adobe-reader-plugin.html)

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2014-01-24T06:36:42.397

```
var browser_info = {
    name: null,
    acrobat : null,
    acrobat_ver : null
  };

if(navigator.plugins != null)
  {      
   var acrobat = navigator.plugins['Adobe Acrobat'];
   if(acrobat == null)
   {           
    browser_info.acrobat = null;
    return browser_info;
   }
   browser_info.acrobat = "installed";
   browser_info.acrobat_ver = parseInt(acrobat.version[0]);                   
  }

where navigator is the property of Window 
```

# sql-server - 我可以将共享点安全上下文值传递给报告服务报告参数吗？

> ID：185953
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-10-09T04:37:52.100
> 
>         
> 
> 标签：sql-server, sharepoint, reporting-services

我正在考虑在一个新的报告项目中使用具有共享点集成的报告服务 05 SP2。

在这个项目的报告中，用户只能看到他们拥有的记录。我在想报告上的一个简单的 userId 参数将允许我将报告的结果过滤为仅这些“拥有”记录。

我很好奇：我可以通过某种方式将当前共享点用户的 ID 传递给报告吗？是否可以以用户无法以某种方式更改它的方式完成？如果可能的话，我会怎么做？

* * *

## 回答 #1

> 赞同：2
> 
>             
> 
> 时间：2009-01-18T12:56:16.110

sharepoint UserID = RS 将使用和检测的一个。这由 RS 中的全局 UserID 定义，并从登录令牌中获取。

您可以隐藏参数 (Report) 或仅在数据集级别 (SQL) 指定它。

* * *

## 回答 #2

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T20:06:18.170

您是否尝试过在数据库端获得行级安全性？

然后，您的项目只需要像它一样传递用户凭据，然后您就可以让 SQL Server 安全性处理这个问题？

# events - 如何从 Excel 2007 电子表格向黑莓发送警报？

> ID：185962
> 
>         
> 
> 赞同：0
> 
>         
> 
> 时间：2008-10-09T04:48:54.887
> 
>         
> 
> 标签：events, excel-2007, notifications

我被要求找到一种在 Excel 2007 电子表格上满足某些条件时向黑莓发送警报的方法。警报可以是 SMS（首选）或电子邮件。从 DDE 提要中，单元格值全天都在变化。

人们用来解决这个问题的典型解决方案是什么？

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T05:52:01.407

我对 Excel 或 Office 编程的细节几乎一无所知，但我可以想出几种方法来解决这个问题。我还假设该解决方案可以基于.Net，因为 Excel 可用。

*   挂钩到更新过程以测试更新结束时的条件。

*   如果您想要一个单独的 .net 程序而不是作为服务或计划任务运行，则 Office 互操作。

*   为 Excel 创建加载项。我有 VS2008 Pro，我可以创建一个 Excel 2007 插件项目。

*   在独立程序中为您的条件解析[Open Office XML 。](http://msdn.microsoft.com/en-us/library/bb332058.aspx)这个解决方案不需要.Net，只需要一个 XML 解析器，

满足您的条件后，您可以使用以下链接发送您的短信或电子邮件。

[有哪些技术可用于发送短信？](https://stackoverflow.com/questions/53019/what-kind-of-technologies-are-available-for-sending-text-messages#53067)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T06:21:37.650

另一种可能性是使用[AddEmail](http://www.traysoft.com)。他们的简介说：*电子邮件 ActiveX (COM) 控件 - 使用 SMTP/ESMTP 协议创建和发送带有嵌入图像和附件的 HTML 电子邮件。轻松为您的 Visual Basic 6 (VB6)、ASP、ASP.NET、VB.NET、C++、C#、FoxPro、Access、PowerBuilder 或 Delphi 应用程序添加电子邮件支持。*

我们经常使用它来自动化我们的软件注册系统，把它拼接成一点 Excel VBA 是没有问题的，

```
....
Dim oSmtpMail As New SmtpMail
Dim lRes As Long
lRes = oSmtpMail.SimpleSendScriptable(sRecipient, sRecipient, sSubj, sText, sError)
.... 
```

好的，所以它是电子邮件而不是短信，但这是一个开始。

# ruby-on-rails - Rails：如何更改页面的标题？

> ID：185965
> 
>         
> 
> 赞同：171
> 
>         
> 
> 时间：2008-10-09T04:53:04.927
> 
>         
> 
> 标签：ruby-on-rails, ruby

在不使用插件的情况下为 Rails 应用程序中的页面创建自定义标题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：261
> 
>             
> 
> 时间：2008-10-09T09:19:37.010

在您看来，请执行以下操作：

```
<% content_for :title, "Title for specific page" %>
<!-- or -->
<h1><%= content_for(:title, "Title for specific page") %></h1> 
```

布局文件中包含以下内容：

```
<head>
  <title><%= yield(:title) %></title>
  <!-- Additional header tags here -->
</head>
<body>
  <!-- If all pages contain a headline tag, it's preferable to put that in the layout file too -->
  <h1><%= yield(:title) %></h1>
</body> 
```

也可以将`content_for`and`yield(:title)`语句封装在辅助方法中（正如其他人已经建议的那样）。但是，在这种简单的情况下，我喜欢将必要的代码直接放入特定的视图中，而无需自定义帮助程序。

* * *

## 回答 #2

> 赞同：121
> 
>             
> 
> 时间：2009-09-26T13:56:59.610

这是我喜欢使用的一个简单选项

在您的布局中

```
<head>
  <title><%= @title %></title>
</head> 
```

在页面模板的顶部（第一行）

```
<% @title="Home" %> 
```

由于布局和页面模板的解析方式，@title="Home" 在布局呈现之前被评估。

* * *

## 回答 #3

> 赞同：53
> 
>             
> 
> 时间：2008-10-09T05:07:11.170

最佳实践是使用 content_for。

首先，添加几个辅助方法（即粘贴在 app/helpers/application_helper.rb 中）：

```
def page_title(separator = " – ")
  [content_for(:title), 'My Cool Site'].compact.join(separator)
end

def page_heading(title)
  content_for(:title){ title }
  content_tag(:h1, title)
end 
```

然后在您的布局视图中，您可以简单地使用：

```
<title><%= page_title %></title> 
```

...在视图本身中：

```
<%= page_heading "Awesome" %> 
```

这种方式的优点是允许您将 h1 标签粘贴到标题的位置，并使您的控制器保持美观且没有讨厌的 @title 变量。

* * *

## 回答 #4

> 赞同：21
> 
>             
> 
> 时间：2013-05-19T17:48:38.570

*@opsb*的改进和*@FouZ*的更完整形式：

 *在`application.html.erb`：

```
<title><%= @title || "Default Page Title" %></title> 
```

在视图 erb 文件或其控制器中：

```
<% @title = "Unique Page Title" %> 
```

* * *

## 回答 #5

> 赞同：13
> 
>             
> 
> 时间：2008-10-09T05:01:11.400

查看`content_for`：[http ://railscasts.com/episodes/8](http://railscasts.com/episodes/8)

* * *

## 回答 #6

> 赞同：6
> 
>             
> 
> 时间：2008-10-09T05:06:09.783

如果没有关于您要满足的用例或要求的更多详细信息，我可以想到几种替代方案：

1）在您的一个布局页面中切换标题并使用存储在`application_helper.rb`

```
<title><%= custom_title %></title> 
```

这种方法将为您提供每个布局页面的唯一标题。

2) Railscasts 建议使用部分加载 HEAD 标签之间显示的内容

3) 如果您需要在加载事件后更改标题，请使用 javascript/ajax 调用来操作 DOM。

也许您真的不想更改元素标记的`title`内容。也许您真的需要某种面包屑，以便您的用户始终知道他们在您网站的导航层次结构中的位置。虽然我对 goldberg 插件的操作做得很好，但我确信还有其他方法可以实现相同的功能。

* * *

## 回答 #7

> 赞同：3
> 
>             
> 
> 时间：2010-09-26T03:07:07.687

我使用 nifty_generator 的“nifty_layout”，它提供了一个标题变量，然后我可以在页面上使用：

`<% title "Title of page" %>`

我也可以`<% title "Title of page", false %>`让标题只显示在浏览器标题中，而不是页面本身。

* * *

## 回答 #8

> 赞同：3
> 
>             
> 
> 时间：2020-09-20T11:33:50.227

这种简单的方法设置了默认标题，但也可以让您随时覆盖它。

在`app/views/layouts/application.html.erb`：

```
<title><%= yield(:title) || 'my default title' %></title> 
```

要覆盖该默认值，请将其放置在您喜欢的任何视图中

```
<% content_for :title, "some new title" %> 
```

* * *

## 回答 #9

> 赞同：2
> 
>             
> 
> 时间：2008-10-09T07:12:16.503

您也可以在控制器的 before_filter 中设置它。

```
# foo_controller.rb

class FooController < ApplicationController

  before_filter :set_title

  private

  def set_title
    @page_title = "Foo Page"
  end

end

# application.html.erb

<h1><%= page_title %></h1> 
```

然后，您可以在**set_title**方法中设置条件，为控制器中的不同操作设置不同的标题。很高兴能够在您的控制器中看到所有相关的页面标题。

* * *

## 回答 #10

> 赞同：1
> 
>             
> 
> 时间：2016-07-02T09:21:33.763

使用 content_for 方法和部分页面标题的方法

1\. 部分名称：_page_title.html.erb

```
<%content_for :page_title do %>
 <%=title%>
<%end%> 
```

2\. 标题标签内的 application.html.erb 中的用法

```
 <title><%=yield :page_title %></title> 
```

3\. 在各个 *.html.erb 中的用法，不包括 application.html.erb 只需将其粘贴在任何 .html.erb 中并提供页面标题

```
 e.g : inside index.html.erb

    <%=render '_page_title', title: 'title_of_page'%> 
```

* * *

## 回答 #11

> 赞同：0
> 
>             
> 
> 时间：2011-02-27T09:46:07.153

我用~~这个插件~~我写的这些 Rails 助手：http://web.archive.org/web/20130117090719/http: [//henrik.nyh.se/2007/11/my-rails-title-helpers/](http://web.archive.org/web/20130117090719/http://henrik.nyh.se/2007/11/my-rails-title-helpers/)

* * *

## 回答 #12

> 赞同：0
> 
>             
> 
> 时间：2017-01-25T05:30:14.410

简而言之，我可以这样写

```
<%content_for :page_title do %><%= t :page_title, "Name of Your Page" %> <% end %> 
```

* * *

## 回答 #13

> 赞同：0
> 
>             
> 
> 时间：2018-01-14T00:27:04.090

我喜欢 opsb 的方法，但这种方法也有效。

```
<% provide(:title,"ttttttttttttttttttZ") %>
<html>
  <head><title><%= yield(:title) %></title></head>
   <body></body>
</html> 
```

* * *

## 回答 #14

> 赞同：0
> 
>             
> 
> 时间：2021-10-23T07:52:39.697

我想确保始终为当前页面提供翻译。

这就是我想出的`app/views/layouts/application.html.erb`：

```
 <title>
      <%= translate("#{controller_name}.#{action_name}.site_title", raise: true) %>
    </title> 
```

这将始终为当前视图寻找翻译，如果没有找到则引发错误。

如果你想要一个默认值，你可以这样做：

```
 <title>
      <%= translate("#{controller_name}.#{action_name}.site_title", 
          default: translate(".site_title")) %>
    </title> 
```

* * *

## 回答 #15

> 赞同：-1
> 
>             
> 
> 时间：2013-02-06T03:41:34.717

最好/干净的方法：

```
<title><%= @page_title or 'Page Title' %></title> 
```

* * *

## 回答 #16

> 赞同：-9
> 
>             
> 
> 时间：2008-10-09T18:33:29.137

我想添加我非常简单的变体。

在 ApplicationController 中定义这个方法：

```
 def get_title
    @action_title_name || case controller_name
                            when 'djs'
                              'Djs'
                            when 'photos'
                              'Photos'
                            when 'events'
                              'Various events'
                            when 'static'
                              'Info'
                            when 'club'
                              'My club'
                            when 'news'
                              'News'
                            when 'welcome'
                              'Welcome!'
                            else
                              'Other'
                          end
  end 
```

之后，您可以从布局的标题标签中调用 get_title。您可以通过在您的操作中定义 @action_title_name 变量来为您的页面定义更具体的标题。

# javascript - 如何在jQuery中选择一系列元素

> ID：185966
> 
>         
> 
> 赞同：62
> 
>         
> 
> 时间：2008-10-09T04:53:08.887
> 
>         
> 
> 标签：javascript, jquery

```
<div id="myDiv">
     <a>...</a>
     <a>...</a>
     <a>...</a>
     <a>...</a>
     <a>...</a>
     <a>...</a>
</div> 
```

如果你想`a`在上面的例子中选择第二、第三和第四个标签，你会怎么做？我唯一能想到的是：

```
$("#myDiv a:eq(1), #myDiv a:eq(2), #myDiv a:eq(3)") 
```

但这看起来不是非常有效或漂亮。我想你也可以选择所有的`a`s 然后运行`.each`它们，但是如果有更多`a`的 s 可能会变得非常低效。

* * *

## 回答 #1

> 赞同：125
> 
>             
> 
> 时间：2008-10-09T05:32:46.313

jQuery [slice()](http://docs.jquery.com/Traversing/slice)函数获取第一个和最后一个需要的元素的索引，选择匹配元素的子集。请注意它不包括最后一个元素本身。

在您的特定情况下，您应该使用

```
$("#myDiv a").slice(1, 4) 
```

* * *

## 回答 #2

> 赞同：10
> 
>             
> 
> 时间：2008-10-09T05:06:03.807

使用[.slice()](http://docs.jquery.com/Traversing/slice)函数正是我需要的。

* * *

## 回答 #3

> 赞同：3
> 
>             
> 
> 时间：2008-10-09T05:40:00.540

您应该能够通过提取数组的一部分来做到这一点。这是线

```
$("div[id='myDiv'] > a").slice(1,4).css("background","yellow"); 
```

您感兴趣的。它将影响第 2、第 3 和第 4 个元素。

```
<html>
    <head>
        <script type="text/javascript" src="jquery-1.2.6.pack.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){
                $("a").click(function(event){
                    $("div[id='myDiv'] > a").slice(1,4).css("background","yellow");
                    event.preventDefault();
                });
            });
        </script>
    </head>
    <body>
        <div id="myDiv">
            <a>1</a>
            <a>2</a>
            <a>3</a>
            <a>4</a>
            <a>5</a>
            <a>6</a>
        </div>
        <hr>
        <a href="" >Click here</a>
        <hr>
    </body>
</html> 
```

# database - 通过对数据库进行逆向工程来生成 ER 图

> ID：185967
> 
>         
> 
> 赞同：18
> 
>         
> 
> 时间：2008-10-09T04:53:23.130
> 
>         
> 
> 标签：database, diagram, entity-relationship

*注意：最初这个问题是针对 PostgreSQL 提出的，但是，答案几乎适用于任何具有可以检测外键关联的 JDBC 驱动程序的数据库。* 

* * *

查询 PostgreSQL 数据字典中的外键和表之间的关系非常简单，但是我如何使用这些信息来生成表之间的关系图呢？

关于可以做到这一点的工具有什么建议吗？

**编辑：**我知道 GraphVIZ/DOT*可能*很有用，但是，我不知道如何编写会生成有向图 .DOT 文件的应用程序。

* * *

## 回答 #1

> 赞同：14
> 
>             
> 
> 时间：2008-10-09T05:16:28.000

Dot 是[graphviz](http://www.graphviz.org/)包的一部分，这是一个非常酷/有用的工具。当然，您需要一些东西来为 graphviz 生成点文件。我过去使用过[SchemaSpy](http://schemaspy.sourceforge.net/)一次或两次，只要您在数据库中定义了关系，它就可以很好地工作。

* * *

## 回答 #2

> 赞同：4
> 
>             
> 
> 时间：2008-10-09T05:03:06.170

Microsoft Visio 很容易做到这一点。

* * *

## 回答 #3

> 赞同：2
> 
>             
> 
> 时间：2014-02-01T17:40:23.477

至少对于 Oracle，我运行此查询或要求 DBA 运行它并将结果发送给我。结果可以直接复制到文本文件中，由 Graphviz 的工具进行解释，从而生成数据库图表。

```
SELECT '"' || Source.TABLE_NAME || '" -> "' 
           || Destiny.TABLE_NAME || '";' AS For_GraphViz
FROM dba_constraints Source
JOIN dba_constraints Destiny
ON Source.owner='my_db_owner' AND Destiny.owner='my_db_owner'
AND Source.CONSTRAINT_TYPE='R'
-- theoretically this validation should be redundant
-- AND Destiny.Constraint_type = 'P'
AND Source.R_CONSTRAINT_NAME = Destiny.CONSTRAINT_NAME
ORDER BY Source.TABLE_NAME, Source.CONSTRAINT_TYPE, Source.CONSTRAINT_NAME
    , Source.R_CONSTRAINT_NAME, Source.INDEX_NAME; 
```

可以很容易地为 SQL Server 创建类似的查询，不了解 MySQL、PostgreSQL 等。

* * *

## 回答 #4

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T05:08:18.437

[Dot](http://en.wikipedia.org/wiki/DOT_language)是多平台的，可能很有用。

* * *

## 回答 #5

> 赞同：1
> 
>             
> 
> 时间：2014-05-07T09:12:52.273

[DBVisualizer](http://www.dbvis.com/)也是一个免费且不错的选择。

# arrays - 如何在 Scala 中创建异构数组？

> ID：185972
> 
>         
> 
> 赞同：28
> 
>         
> 
> 时间：2008-10-09T05:00:50.307
> 
>         
> 
> 标签：arrays, scala

在javascript中，我们可以这样做：

```
["a string", 10, {x : 1}, function() {}].push("another value"); 
```

Scala 等价物是什么？

* * *

## 回答 #1

> 赞同：41
> 
>             
> 
> 时间：2008-10-09T17:08:54.143

Scala 中的数组非常同质。这是因为 Scala 是一种静态类型语言。如果你真的需要伪异构特性，你需要使用参数化协变的不可变数据结构（大多数不可变数据结构都是）。  `List`是那里的典型示例，但[`Vector`](http://www.codecommit.com/blog/misc/implementing-persistent-vectors-in-scala/final/Vector.scala)也是一种选择。然后你可以做这样的事情：

```
Vector("a string", 10, Map("x" -> 1), ()=>()) + "another value" 
```

结果将是类型`Vector[Any]`。在静态类型方面不是很有用，但一切都会如期而至。

*顺便提一下，Scala 中数组*的“文字语法”如下：

```
Array(1, 2, 3, 4)     // => Array[Int] containing [1, 2, 3, 4] 
```

**另请参阅**：[有关持久向量的更多信息](http://www.codecommit.com/blog/scala/implementing-persistent-vectors-in-scala/)

* * *

## 回答 #2

> 赞同：18
> 
>             
> 
> 时间：2011-05-23T00:38:30.140

Scala 将选择可以保存所有值的最具体的 Array 元素类型，在这种情况下，它需要最通用的类​​型`Any`，它是所有其他类型的超类型：

```
Array("a string", 10, new { val x = 1 }, () => ()) :+ "another value" 
```

结果数组的类型为`Array[Any]`.

* * *

## 回答 #3

> 赞同：4
> 
>             
> 
> 时间：2008-10-15T17:53:07.583

Scala 可能很快就会获得“异构”列表的能力：
 [Scala 中的 HList](http://jnordenberg.blogspot.com/2008/09/hlist-in-scala-revisited-or-scala.html)

* * *

## 回答 #4

> 赞同：2
> 
>             
> 
> 时间：2012-11-20T07:58:31.297

正如herom 在评论中提到的那样，就个人而言，我可能会使用元组。

```
scala> ("a string", 10, (1), () => {})
res1: (java.lang.String, Int, Int, () => Unit) = (a string,10,1,<function0>) 
```

但是你不能轻易地附加到这样的结构上。

ePharaoh 提到的 HList 是“为此而设计的”，但我自己可能会避开它。它对类型编程很重，因此可能会带来令人惊讶的负载（即在编译时创建很多类）。小心点。上面的 HList（需要 MetaScala 库）将是（因为我不使用 MetaScala，所以没有得到证明）：

```
scala> "a string" :: 10 :: (1) :: () => {} :: HNil 
```

您可以将 etc.（好吧，至少在前面）附加到这样的列表中，它会知道类型。Prepending 会创建一个以旧类型作为尾部的新类型。

然后还有一种方法尚未提及。类（尤其是案例类）在 Scala 上非常简单，您可以将它们设置为单行：

```
scala> case class MyThing( str: String, int: Int, x: Int, f: () => Unit )
defined class MyThing

scala> MyThing( "a string", 10, 1, ()=>{} )
res2: MyThing = MyThing(a string,10,1,<function0>) 
```

当然，这也不会处理追加。

# iis - 在 Windows Vista Home Edition 上配置 IIS

> ID：185983
> 
>         
> 
> 赞同：1
> 
>         
> 
> 时间：2008-10-09T05:09:58.543
> 
>         
> 
> 标签：iis, windows-vista

我的朋友不小心买了一台装有 Windows Vista Home Basic Edition 的笔记本电脑。他想出了如何在上面安装 IIS，但它似乎没有管理控制台或管理工具。他有什么方法可以配置站点或导入 IIS 6 配置文件？

编辑：“Windows Vista 家庭版”->“Windows Vista 家庭基本版”。

* * *

## 回答 #1

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T06:40:59.107

Yu 需要返回 Windows 组件设置并选择安装 Managemnet 控制台。

控制面板>程序->打开和关闭 Windows 功能。

您会在其中看到 Internet 信息服务，然后在下面找到管理控制台。

是的，它们可以安装在 Vista Home 上。安装后，您可以通过打开控制面板-> 管理工具进行设置，您将在那里看到 IIS 管理器。

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-10-10T00:26:11.827

根据[Microsoft Technet](http://technet.microsoft.com/en-us/library/cc753198.aspx)，IIS 管理控制台在 Windows Vista Home Basic 和 Starter Edition 上不可用，但在 Home Premium 及更高版本上可用。当我安装 IIS 时，我可以确认它没有出现在选项列表中。

* * *

## 回答 #3

> 赞同：1
> 
>             
> 
> 时间：2008-10-10T13:57:59.540

这里不完全确定，但在另一台机器上启动 IIS 控制台并告诉它连接到笔记本电脑？普通的管理控制台管理单元都支持远程操作。

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T06:36:53.547

好的，我不确定不是在 Vista 上，但在 XP 上，控制 IIS 的应用程序是`%SystemRoot%\system32\inetsrv\iis.msc`. 也许四处寻找`iis.msc`将是第一步。

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-10-10T00:33:31.547

您应该能够升级到家庭保费。我很确定它可以以相当低的成本获得。我的 Home Basic 笔记本电脑附带一张 CD，其中包含升级到不同版本的 Windows（我升级到 Linux）所需的所有东西。如果你真的想让 IIS 做开发工作，你真的应该升级。或者如果你只想要 .Net，你可以安装 VS.Net Express 并使用开发服务器。

# .net - 您使用哪些开源 .Net 实用程序项目或代码库？

> ID：185987
> 
>         
> 
> 赞同：3
> 
>         
> 
> 时间：2008-10-09T05:16:22.290
> 
>         
> 
> 标签：.net, open-source, utility

我几乎在每个代码项目中都使用 log4net。我想知道还有哪些其他通常有用的代码项目可用？

* * *

## 回答 #1

> 赞同：5
> 
>             
> 
> 时间：2008-10-09T05:26:17.340

*   [Rhino.Mocks](http://ayende.com/projects/rhino-mocks.aspx)

*   [单元](http://nunit.org)

*   [休眠](http://www.hibernate.org/343.html)

*   [春天.NET](http://www.springframework.net/)

*   [城堡](http://www.castleproject.org/)

*   我自己有点不拘一格的[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)

*   [PostSharp](http://www.postsharp.org/)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2008-10-09T05:20:18.537

我喜欢哥本哈根 IT 大学的 C5 集合课程：

[http://www.itu.dk/research/c5/](http://www.itu.dk/research/c5/)

它是我用过的任何类型的设计最精良的库之一。

* * *

## 回答 #3

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T05:29:46.740

我在 .NET 开发中使用过的一些有用的开源工具/项目：

*   [7Zip](http://www.7-zip.org/sdk.html)

*   [HtmlAgilityPack](http://www.codeplex.com/htmlagilitypack)

*   [单核细胞增多症](http://www.mono-project.com/Main_Page)

*   [夏普发展](http://www.icsharpcode.net/OpenSource/SD/)

* * *

## 回答 #4

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T05:35:07.557

*   [城堡活动记录](http://www.castleproject.org/activerecord/index.html)

*   [ICSharpCode.SharpZipLib](http://www.icsharpcode.net/)

* * *

## 回答 #5

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T05:36:17.787

许多已经提到的，加上

*   [SharpZipLib](http://www.icsharpcode.net/OpenSource/SharpZipLib/)

*   [快速 CSV 阅读器](http://www.codeproject.com/KB/database/CsvReader.aspx)

* * *

## 回答 #6

> 赞同：0
> 
>             
> 
> 时间：2008-10-09T06:19:24.643

我倾向于同意 Jon Skeet 的观点，但如果你只能说出一个，我会从 NUnit 开始。

请测试您的代码！

* * *

## 回答 #7

> 赞同：0
> 
>             
> 
> 时间：2009-03-14T22:38:57.997

我维护一个名为 SixPack 的类库

[http://code.google.com/p/sixpack-library/](http://code.google.com/p/sixpack-library/)

* * *

## 回答 #8

> 赞同：0
> 
>             
> 
> 时间：2009-03-14T23:34:08.957

对于 PDF 操作

[iTextSharp](http://itextsharp.sourceforge.net)

# c# - Windows 窗体的 MVP 示例

> ID：185993
> 
>         
> 
> 赞同：39
> 
>         
> 
> 时间：2008-10-09T05:19:53.577
> 
>         
> 
> 标签：c#, .net, winforms, mvp

是否有很好的示例代码或测试项目来解释[Model-view-presenter (MVP) 模式](http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93presenter)。有很多解释链接，但我想有一些很好的示例代码来展示给其他人，而无需重新发明轮子。

* * *

## 回答 #1

> 赞同：24
> 
>             
> 
> 时间：2008-10-09T05:30:40.043

Jeremy Miller 的“构建自己的 CAB”系列非常棒。你会得到很好的 MVP（以及其他一些智能客户端模式，例如 Pub/Sub）。

[http://codebetter.com/blogs/jeremy.miller/archive/2007/07/25/the-build-your-own-cab-series-table-of-contents.aspx](http://codebetter.com/blogs/jeremy.miller/archive/2007/07/25/the-build-your-own-cab-series-table-of-contents.aspx)

* * *

## 回答 #2

> 赞同：1
> 
>             
> 
> 时间：2010-02-13T13:51:07.737

您可能想尝试[Claymore](http://claymore.codeplex.com/)框架。**************** 
```*******