# StackOverflow 问答 000120000-000120999

# linux - 当 Linux 内存不足时，如何获得有关进程的更多信息？

> ID：120000
> 
> 赞同：1
> 
> 时间：2008-09-23T09:12:38.783
> 
> 标签：linux, memory-leaks

我最近遇到了 oom-killer 在一段时间后开始杀死进程的问题。我可以看到内存被消耗了，但是当我到达服务器时，已经不清楚是什么消耗了它。是否有一个很好的非显而易见的地方可以获取有关 oom-killer 的更多信息？例如，激活时有关进程的详细信息、有关已终止进程的详细信息以及选择的原因？

我正在寻找一个特定的地方来查找此信息，收集它的特定工具或一些配置以改进 oom-killer 报告。我不是在寻找有关 oom-killer 的通用信息。/var/messages 默认情况下将仅包含有关空闲/已分配内存的详细报告，但不包含分配给它的特定进程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T09:21:13.973

您可以检查消息日志文件以查看哪个进程被杀死以及一些相关信息。至于原因：

> ...清算的理想候选者是最近启动的非特权进程，它与它的子进程一起使用大量内存，已经很好，并且不执行原始 I/O。类似于 nohup 的并行内核构建（这不是一个糟糕的选择，因为所有结果都保存到磁盘上，并且在“make”终止时丢失的工作很少）。

从[这里](http://linux-mm.org/OOM_Killer)。

您可以定义一些进程对杀手免疫，调整 swappiness 参数以防它太低（这使杀手触发器高兴）并检查[此处列出的内容](http://linux.derkeiler.com/Mailing-Lists/RedHat/2007-08/msg00061.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T09:17:50.407

通常，您应该在 /var/log/messages 中收到一条消息，其中包含与 oom-killer 杀死的进程相关的大量详细信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T09:38:22.637

这不是您问题的确切答案，但`malloc(3)`Linux 上的手册页提供了一些有关如何关闭内存过度使用的信息

```
echo 2 > /proc/sys/vm/overcommit_memory 
```

# excel - 将 Excel 数据表加载到 Oracle 数据库

> ID：120001
> 
> 赞同：7
> 
> 时间：2008-09-23T09:12:53.243
> 
> 标签：excel, database, oracle, nullpointerexception, migrate

我正在寻找一个免费工具来将 Excel 数据表加载到 Oracle 数据库中。我尝试了 Oracle SQL 开发人员，但它一直抛出 NullPointerException。有任何想法吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T09:20:39.357

Excel -> CSV -> 甲骨文

将 Excel 电子表格另存为文件类型“CSV”（逗号分隔值）。

将 .csv 文件传输到 Oracle 服务器。

创建 Oracle 表，使用 SQL`CREATE TABLE`语句定义表的列长度和类型。

使用 sqlload 将 .csv 文件加载到 Oracle 表中。像这样创建一个 sqlload 控制文件：

```
load data
infile theFile.csv
replace
into table theTable
fields terminated by ','
(x,y,z) 
```

调用 sqlload 将 .csv 文件读入新表，为 .csv 文件中的每一行在表中创建一行。这是作为 Unix 命令完成的：

```
% sqlload userid=username/password control=<filename.ctl> log=<filename>.log 
```

**或者**

如果您只想要一个工具，请使用[QuickLoad](http://sourceforge.net/projects/quickload)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T19:58:07.467

执行 Excel -> CSV -> Oracle 的另一种方法是使用外部表，首先在 9i 中引入。外部表让您可以像查询表一样查询平面文件。在幕后 Oracle 仍在使用 SQL*Loader。这里有一个可靠的教程：

[http://www.orafaq.com/node/848](http://www.orafaq.com/node/848)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T10:26:03.817

[Oracle Application Express](http://apex.oracle.com)随 Oracle 免费提供，包括一个“加载电子表格数据”实用程序，位于：

```
Utilities > Data Load/Unload > Load > Load Spreadsheet Data 
```

您需要先将电子表格另存为 CSV 文件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T18:28:52.173

如果这是一次性过程，您可能只想将数据复制并粘贴到 Microsoft 访问表中，并对您通过 odbc 管理器设置的 oracle 表执行追加查询。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-03-27T08:50:58.907

将 excel/csv 加载到 oracle 数据库有不同的方法。我给出以下内容：
1\. 使用 Toad。Toad 提供了非常灵活的选项来上传 Excel。它还提供列映射窗口。通常从工具 -> 导入，您会找到该选项。有关详细信息，我可以提供完整的说明手册。
2\. 首先加载到 Microsoft Access，然后从那里将其传递给 Oracle。
步骤1：访问中有一个名为“外部数据”的选项卡，可以将excel上传到访问数据库。
Step2：创建表后，只需在表上单击写鼠标并选择Export to ODBC DATABASE。它将询问 oracle 数据库连接详细信息。它是免费的。
3\. 使用 Oracle SQL 加载器。这是一个有数据文件，控制文件的服务。您需要编写配置。它用作保持一种模式的文本/任何文件加载。

希望能帮助到你。如果需要，我可以分享更多细节。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2014-04-07T22:14:18.137

正如您提到的那样，您正在寻找一种工具-您可能想查看此 Oracle 特定视频-您可以从任何来源加载数据-

[http://youtu.be/shYiN2pnPbA](http://youtu.be/shYiN2pnPbA)

# hibernate - Spring/Hibernate下的多个会话工厂

> ID：120007
> 
> 赞同：8
> 
> 时间：2008-09-23T09:15:26.203
> 
> 标签：hibernate, spring, sessionfactory

我被要求在同一个实例中支持多个数据库，以支持多租户。每个数据库都有一个相同的模式。用户通过从列表中选择登录到特定数据库，所有后续调用都将转到该数据库，直到他们注销。

我想根据客户端提供的参数在单个 HibernateDaoTemplate 内热交换会话工厂。

我可以在热交换数据源（以及与之相关的所有事务问题）上找到很多东西，但我想热交换会话工厂——为每个工厂保留所有缓存。

最简单的方法是什么？为 DaoTemplate 配置 HotSwappableTarget？谁能指出我如何做到这一点的样本？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T12:29:42.240

如果所有数据库都相同，那么我可以建议使用单个 SessionFactory 并为实际上“租户感知”的 DataSource 和 Cache 提供您自己的实现。（实现这些是相当简单的：只需维护一个租户 id 的映射 -> 真实缓存/真实数据源，然后将所有调用委托给适当的调用）。配置单个 SessionFactory 以使用您的租户感知缓存和数据源。ThreadLocal 可用于使当前请求的租户 ID 可用于任何需要了解它的代码。

我之前成功地使用过这种方法来支持多租户。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-27T21:32:49.693

在我以前工作的地方，我们按照[本指南通过 ThreadLocal 完成了这项工作。](http://blog.springsource.com/2007/01/23/dynamic-datasource-routing/)我们只使用了一个 SessionFactory 并根据用户在登录时可以更改的会话变量交换它的数据源。我不记得确切的细节，但如果你有兴趣，我可以挖掘更多关于我们实现的信息。

尽管如此，我以前工作场所的人现在正在远离这种方法，转向分片数据库。绝对是一个更优雅的解决方案，我建议您看看。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-05T13:12:39.127

从 HibernateDaoSupport 扩展你的 DAO 类，然后调用 setSessionFactory() 方法，进行数据库的热交换

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T12:43:41.007

您还可以查看 Hibernate Shards 项目：

[http://www.hibernate.org/414.html](http://www.hibernate.org/414.html)

...它专注于向 Hibernate Core 添加对水平分区的支持。它尚未涵盖完整的 Hibernate API，但确实支持其中的大部分（这可能足以满足您的需求，也可能不足以满足您的需求）。当然，他们正在努力实现全面覆盖。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-15T06:40:29.650

我还通过 ThreadLocal 尝试了缓存提供程序，困难的部分是在缓存上进行热交换，您必须确保 SessionFactory 没有任何与之关联的活动会话。现在，我认为有一个更好的解决方案：通过使用 Spring 3 java 配置，您可以动态创建您的租户感知 SessionFactory 并让 Spring 为您做缓存管理。

# php - 使用 PHP 和 simplexml 从 XML 中检索 CDATA 内容

> ID：120016
> 
> 赞同：5
> 
> 时间：2008-09-23T09:18:11.843
> 
> 标签：php, xpath, simplexml

我有以下 XML 结构：

```
<?xml version="1.0" ?>
<course xml:lang="nl">
  <body>
    <item id="787900813228567" view="12000" title="0x|Beschrijving" engtitle="0x|Description"><![CDATA[Dit college leert studenten hoe ze een onderzoek kunn$
    <item id="5453116633894965" view="12000" title="0x|Onderwijsvorm" engtitle="0x|Method of instruction"><![CDATA[instructiecollege]]></item>
    <item id="7433550075448316" view="12000" title="0x|Toetsing" engtitle="0x|Examination"><![CDATA[Opdrachten/werkstuk]]></item>
    <item id="015071401858970545" view="12000" title="0x|Literatuur" engtitle="0x|Required reading"><![CDATA[Wayne C. Booth, Gregory G. Colomb, Joseph M. Wi$
    <item id="5960589172957031" view="12000" title="0x|Uitbreiding" engtitle="0x|Expansion"><![CDATA[]]></item>
    <item id="3610066867901779" view="12000" title="0x|Aansluiting" engtitle="0x|Place in study program"><![CDATA[]]></item>
    <item id="19232369892482925" view="12000" title="0x|Toegangseisen" engtitle="0x|Course requirements"><![CDATA[]]></item>
    <item id="3332396346891524" view="12000" title="0x|Doelgroep" engtitle="0x|Target audience"><![CDATA[]]></item>
    <item id="6606851872934866" view="12000" title="0x|Aanmelden bij" engtitle="0x|Enrollment at"><![CDATA[]]></item>
    <item id="1478643580820973" view="12000" title="0x|Informatie bij" engtitle="0x|Information at"><![CDATA[Docent]]></item>
    <item id="9710608434763993" view="12000" title="0x|Rooster" engtitle="0x|Schedule"><![CDATA[1e semester, maandag 15.00-17.00, zaal 1175/030]]></item>
  </body>
</course> 
```

我想从其中一个项目标签中获取数据。要访问此标记，我使用以下 xpath：

```
$description = $xml->xpath("//item[@title='0x|Beschrijving']"); 
```

这确实以以下形式返回一个数组：

```
Array
(
    [0] => SimpleXMLElement Object
        (
            [@attributes] => Array
                (
                    [id] => 787900813228567
                    [view] => 12000
                    [title] => 0x|Beschrijving
                    [engtitle] => 0x|Description
                )
        )
) 
```

但是实际信息（存储在项目标签之间）在哪里？我一定是做错了什么，但我不知道那可能是什么......可能真的很简单......帮助将不胜感激。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-23T09:41:17.293

当您加载 XML 文件时，您需要处理 CDATA.. 此示例有效：

```
<?php
$xml = simplexml_load_file('file.xml', NULL, LIBXML_NOCDATA);
$description = $xml->xpath("//item[@title='0x|Beschrijving']");
var_dump($description);
?> 
```

这是输出：

```
array(1) {
  [0]=>
  object(SimpleXMLElement)#2 (2) {
    ["@attributes"]=>
    array(4) {
      ["id"]=>
      string(15) "787900813228567"
      ["view"]=>
      string(5) "12000"
      ["title"]=>
      string(15) "0x|Beschrijving"
      ["engtitle"]=>
      string(14) "0x|Description"
    }
    [0]=>
    string(41) "Dit college leert studenten hoe ze een on"
  }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T09:40:35.237

我相信它相当于对象上的 __toString() 方法，所以

```
echo $description[0]; 
```

应该显示它，或者你可以投射它；

```
$str = (string) $description[0]; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T09:42:22.987

[查看“SimpleXMLElement”（ http://uk.php.net/manual/en/function.simplexml-element-children.php](http://uk.php.net/manual/en/function.simplexml-element-children.php) ）的 PHP.net 文档，它看起来像是将节点转换为字符串“（字符串)$价值；" 成功了。

如果做不到这一点，该页面上有很多示例应该为您指明正确的方向！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T09:40:56.657

```
$description = $xml->xpath("//item[@title='0x|Beschrijving']");

while(list( , $node) = each($description)) {

echo($node);

} 
```

dreamwerx 的解决方案更好

# web-services - 监控 HTTP、TCP 等 Web 服务流量的工具

> ID：120022
> 
> 赞同：44
> 
> 时间：2008-09-23T09:20:39.450
> 
> 标签：web-services, http, tcp, monitoring

您用来监控网络服务、SOAP、WCF 等来来往往的流量的最佳工具是什么？我见过一些用 Java 制作的工具，但它们似乎有点蹩脚。我想要的是一个作为代理位于中间并进行端口重定向的工具（它应该具有可配置的监听/重定向端口）。是否有任何工具可以在 Windows 上执行此操作？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-23T09:23:23.313

对于 Windows HTTP，您无法击败[Fiddler](http://www.fiddler2.com)。您可以将其用作 Web 服务器上端口转发的[反向代理](http://www.fiddler2.com/Fiddler/help/reverseproxy.asp)。它也不一定需要IE。它可以[使用其他客户端](http://www.fiddler2.com/fiddler/help/hookup.asp)。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-23T09:23:55.387

[Wireshark](http://www.wireshark.org)不做端口重定向，而是嗅探和解释很多协议。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-23T09:49:32.797

如果您使用的是 Windows，您可能会发现[Microsoft Network Monitor很有帮助。](http://www.microsoft.com/downloads/details.aspx?FamilyID=f4db40af-1e08-4a21-a26b-ec2f4dc4190d&DisplayLang=en)

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-23T09:31:55.913

[Wireshark](http://www.wireshark.org/)（或 Tshark）可能是事实上的标准流量检查工具。它不引人注目，并且无需摆弄端口重定向和代理即可工作。但是，它非常通用，因为 (AFAIK) 没有提供任何专门用于监控 Web 服务流量的工具——它都是 tcp/ip 和 http。

您可能已经看过[tcpmon](https://tcpmon.dev.java.net/)，但我不知道有任何其他工具可以做中间的事情。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-23T12:25:45.387

我用@marxidad 提到的反向代理功能尝试了 Fiddler，它似乎工作正常，因为 Fiddler 对我来说是一个熟悉的 UI，并且能够以各种格式（即 Raw、XML、Hex）显示请求/响应，我接受它作为这个问题的答案。不过有一件事。我使用 WCF，但反向代理出现以下异常：

> 由于 EndpointDispatcher 的 AddressFilter 不匹配，接收方无法处理带有 To ' [http://localhost:8000/path/to/service '的消息。](http://localhost:8000/path/to/service)检查发送方和接收方的 EndpointAddresses 是否一致

我已经弄清楚（感谢 Google，erm .. 我的意思是实时搜索：p）这是因为我在服务器和客户端上的端点地址因端口号而异。如果您遇到相同的异常，请参阅以下 MSDN 论坛消息：

[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2302537&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=2302537&SiteID=1)

建议使用以下 MSDN 文章中解释的 clientVia Endpoint Behavior：

[http://msdn.microsoft.com/en-us/magazine/cc163412.aspx](http://msdn.microsoft.com/en-us/magazine/cc163412.aspx)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-23T12:05:18.603

过去几年我一直在使用[查尔斯](http://www.charlesproxy.com/)。对此非常满意。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-12T09:10:53.343

我第二个[Wireshark](http://www.wireshark.org)。它非常强大且用途广泛。而且由于这个工具不仅可以在 Windows 上运行，还可以在 Linux 或 Mac OSX 上运行，所以花时间学习它（实际上很容易）是有意义的。无论您使用什么平台或语言，它都是有意义的。

问候，

Richard Just 程序员 [http://sili.co.nz/blog](http://sili.co.nz/blog)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T09:39:27.110

我发现[WebScarab](http://www.owasp.org/index.php/Category:OWASP_WebScarab_Project)非常强大

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T09:26:58.123

查看[Paros 代理](http://www.parosproxy.org/)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T09:44:15.773

**JMeter 的内置代理**可用于记录所有 HTTP 请求/响应信息。

Firefox“ **Live HTTP headers** ”插件可用于查看发送/接收请求时浏览器端发生的情况。

当您需要拦截和修改请求时，Firefox“**篡改数据”插件可能会很有用。**

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2008-09-23T10:02:33.560

我使用[LogParser](http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en)生成图形并在 IIS 日志中查找元素。

# .net - WPF 是否对所有 Winforms 控件都有等效控件？

> ID：120029
> 
> 赞同：5
> 
> 时间：2008-09-23T09:23:05.950
> 
> 标签：.net, wpf, winforms

刚刚发现这个很难。我想弹出一个 FontDialog 以允许用户选择一种字体.. 那些熟悉的对话框之一..

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T09:24:28.147

**并非所有人都有等价物。**
例如 FontDialog 没有..（抱怨抱怨）。这个页面有完整的内幕。发布因为它可能只是作为一个心理笔记有用。 [http://msdn.microsoft.com/en-us/library/ms750559.aspx](http://msdn.microsoft.com/en-us/library/ms750559.aspx)

***更新：*** Programming WPF 这本书涵盖了这一点。显然，一些对话框没有构成 RTM 总线。将包含在下一次更新中的 FontDialog 可在此处获得。与 ColorPicker 对话框一样。另外你不应该盲目地使用 Win32 对话框，因为 WPF 中的相应类型（例如字体和颜色现在“更大更好”。）

[http://blogs.msdn.com/wpfsdk/archive/2006/10/26/Uncommon-Dialogs--Font-Chooser-and-Color-Picker-Dialogs.aspx](http://blogs.msdn.com/wpfsdk/archive/2006/10/26/Uncommon-Dialogs--Font-Chooser-and-Color-Picker-Dialogs.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T09:30:09.833

[VistaBridge](http://msdn.microsoft.com/en-us/library/ms756482.aspx)示例包含一些 vista 对话框的包装器！

另请查看~~System.Win32~~ Microsoft.Win32提供的包装器

[**更新**]`Microsoft.Win32.FileDialog

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-24T14:20:08.193

使用 WindowsFormsHost 嵌入 Windows 表单会导致很多问题——尤其是在处理渲染\可见性等时。

一些控件已经由其他人实现，可以在 WEB 上找到，例如：

NumericUpDown DateTimePicker SplitButton

当然还有新的 WPFDataGrid

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T09:51:45.990

我知道一个团队在 WPF 应用程序上工作了几年，他们的反馈是，在复杂的控件（高级数据网格、树视图等）方面，WPF 仍然无法与 WinForms 匹敌。不过基本控制还可以。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T11:35:03.013

不幸的是，事实并非如此。但是，您可以使用 Microsoft.Win32 命名空间“借用”某些 Windows 窗体对话框，也可以使用 System.Windows.Forms.WindowsFormHost WPF 元素集成 Windows 窗体控件。此外，您可以通过调用构造函数然后调用它们的 ShowDialog() 方法来直接显示 Windows 窗体对话框。

# c++ - 非静态成员数组初始化的任何解决方法？

> ID：120033
> 
> 赞同：14
> 
> 时间：2008-09-23T09:23:51.283
> 
> 标签：c++

在 C++ 中，无法在初始化列表中初始化数组成员，因此成员对象应该具有默认构造函数，并且它们应该在构造函数中正确初始化。除了不使用数组之外，是否有任何（合理的）解决方法？

[任何可以仅使用初始化列表初始化的东西在我们的应用程序中都比使用构造函数更可取，因为编译器和链接器可以分配和初始化数据，并且每个 CPU 时钟周期都很重要，甚至在`main`. 但是，并非总是可以为每个类都有一个默认构造函数，此外，在构造函数中再次重新初始化数据反而会破坏目的。]

例如，我想要这样的东西（但这个不起作用）：

```
class OtherClass {
private:
    int data;
public:
    OtherClass(int i) : data(i) {}; // No default constructor!
};

class Foo {
private:
    OtherClass inst[3]; // Array size fixed and known ahead of time.
public:
    Foo(...)
        : inst[0](0), inst[1](1), inst[2](2)
        {};
}; 
```

我知道的唯一解决方法是非数组解决方法：

```
class Foo {
private:
    OtherClass inst0;
    OtherClass inst1;
    OtherClass inst2;
    OtherClass *inst[3];
public:
    Foo(...)
        : inst0(0), inst1(1), inst2(2) {
        inst[0]=&inst0;
        inst[1]=&inst1;
        inst[2]=&inst2;
    };
}; 
```

**编辑**：应该强调`OtherClass`没有默认构造函数，并且非常希望链接器能够分配所需的任何内存（`Foo`将创建一个或多个静态实例），使用堆本质上是*verboten*。我已经更新了上面的示例以突出显示第一点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T09:43:00.223

一种可能的解决方法是完全避免编译器调用 OtherClass 构造函数，并使用placement new 自行调用它，以任何您需要的方式对其进行初始化。例子：

```
 class Foo
  {
  private:
    char inst[3*sizeof(OtherClass)]; // Array size fixed. OtherClass has no default ctor.

    // use Inst to access, not inst
    OtherClass &Inst(int i) {return (OtherClass *)inst+i;}
    const OtherClass &Inst(int i) const {return (const OtherClass *)inst+i;}
  public:
    Foo(...)
    {
      new (Inst(0)) OtherClass(...);
      new (Inst(1)) OtherClass(...);
      new (Inst(2)) OtherClass(...);
    }
    ~Foo()
    {
      Inst(0)->~OtherClass();
      Inst(1)->~OtherClass();
      Inst(2)->~OtherClass();
    }
  }; 
```

为了满足 OtherClass 可能的对齐要求，如果在 VisualC++ 中工作，您可能需要使用 __declspec(align(x))，或者使用 char 以外的类型，例如：

```
Type inst[3*(sizeof(OtherClass)+sizeof(Type)-1)/sizeof(Type)]; 
```

... 其中 Type 是 int、double、long long 或任何描述对齐要求的内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T09:43:38.957

OtherClass 中有哪些数据成员？值初始化对于该类是否足够？

如果值初始化足够了，那么你可以在成员初始化列表中对一个数组进行值初始化：

```
class A {
public:
  A ()
  : m_a()  // All elements are value-initialized (which for int means zero'd)
  {
  }

private:
  int m_a[3];
}; 
```

如果您的数组元素类型是类类型，则将调用默认构造函数。

**编辑：**只是为了澄清 Drealmer 的评论。

如果元素类型是非 POD，那么它应该有一个“可访问的默认构造函数”（如上所述）。如果编译器无法调用默认构造函数，则此解决方案将不起作用。

以下示例不适用于此方法：

```
class Elem {
public:
   Elem (int);  // User declared ctor stops generation of implicit default ctor
};

class A {
public:
  A ()
  : m_a ()         // Compile error: No default constructor
  {}

private:
  Elem m_a[10];
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-27T19:40:53.877

我通常用来使类成员“出现”在堆栈上的一种方法（尽管实际上存储在堆上）：

```
类Foo {
私人的：
    int const (&array)[3];
    int const (&InitArray() const)[3] {
        int (*const rval)[3] = new int[1][3];
        (*rval)[0] = 2;
        (*rval)[1] = 3;
        (*rval)[2] = 5;
        返回 *rval;
    }
上市：
    显式 Foo() : 数组(InitArray()) { }
    虚拟 ~Foo() { delete[] &array[0]; }
};
```

对于您班级的客户，数组似乎是“int const [3]”类型。将此代码与放置 new 结合起来，您还可以使用您想要的任何构造函数自行决定真正初始化值。希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T09:53:42.583

默认情况下不初始化数组成员。因此，您可以使用一个静态辅助函数来进行初始化，并将辅助函数的结果存储在一个成员中。

```
#include "stdafx.h"
#include <algorithm>
#include <cassert>

class C {
public: // for the sake of demonstration...
  typedef int t_is[4] ;
  t_is is;
  bool initialized;

  C() : initialized( false )
  {
  }

  C( int deflt )
    : initialized( sf_bInit( is, deflt ) )
  {}

  static bool sf_bInit( t_is& av_is, const int i ){
    std::fill( av_is, av_is + sizeof( av_is )/sizeof( av_is[0] ), i );
    return true;
  }
};

int _tmain(int argc, _TCHAR* argv[])
{

  C c(1), d;

  assert( c.is[0] == 1 );

  return 0;
} 
```

值得注意的是，在下一个标准中，它们将支持数组初始值设定项。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-26T16:37:25.180

使用继承创建代理对象

```
class ProxyOtherClass : public OtherClass {
public:   
  ProxyOtherClass() : OtherClass(0) {}
};

class Foo {
private:
  ProxyOtherClass inst[3]; // Array size fixed and known ahead of time.
public:
  Foo(...) {}
}; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-10-10T08:08:11.547

那么使用指针数组而不是对象数组呢？例如：

```
class Foo {
private:
    OtherClass *inst[3];
public:
    Foo(...) {
        inst[0]=new OtherClass(1);
        inst[1]=new OtherClass(2);
        inst[2]=new OtherClass(3);
    };

    ~Foo() {
       delete [] inst;   
    }

}; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-15T04:39:57.467

您说“任何可以仅使用初始化列表初始化的东西在我们的应用程序中都比使用构造函数更可取，因为编译器和链接器可以分配和初始化数据，并且每个 CPU 时钟周期都很重要”。

所以，不要使用构造函数。也就是说，不要使用传统的“实例”。静态声明一切。当您需要一个新的“实例”时，创建一个新的静态声明，可能在任何类之外。如果必须，请使用带有公共成员的结构。如果必须，请使用 C。

你是在自问自答。构造函数和析构函数仅在具有大量分配和释放的环境中有用。如果目标是静态分配尽可能多的数据，那么破坏有什么好处，那么没有破坏的构造又有什么好处呢？和他们两个一起见鬼去吧。

# formatting - 将文本格式化为数字的 SQLplus 脚本

> ID：120054
> 
> 赞同：0
> 
> 时间：2008-09-23T09:33:56.687
> 
> 标签：formatting, sqlplus, scripting

我正在从表中选择行，但某些列是文本类型，但它们中始终包含数字数据。如何将它们格式化为数字？

例如列数量标题“数量”格式 999,999

但是，由于表中的列是文本，因此忽略了数字格式。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T09:43:00.333

您将需要 TO_NUMBER 查询中的列。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T09:55:42.347

要使用千位分隔符进行渲染，您需要...

```
to_char(to_number(quantity), '999,999') 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T10:00:52.240

谢谢史蒂夫，

我现在可以拥有：

```
列数量标题“数量”格式 999,999
从销售中选择 TO_NUMBER(quantity) 作为数量

```

我得到了一份正确合理的报告。

# sql-server - 通过 isql 一致地发布数据库构建

> ID：120059
> 
> 赞同：0
> 
> 时间：2008-09-23T09:37:10.847
> 
> 标签：sql-server

我正在使用 isql 通过批处理文件将数据库构建发布到 SQL Server 2000。使用批处理文件，以便将多个文件一致地发布到不同的 SQL Server（开发、测试、实时）。

SQL Server 使用 ANSI 代码页 1252（来自 sp_helpsort），但 isql 是使用代码页 437 的 OEM 客户端。这意味着在运行脚本时会转换所有扩展字符（ASCII 代码 > 128），从而导致字符时结果不一致像“£”一样包含在脚本中。[此Microsoft 知识库文章](http://support.microsoft.com/?scid=kb;EN-US;153449)中解释了差异。

可能的解决方案是： -

*   使用 Unicode 保存脚本并使用 osql。
*   使用 SQL Server 客户端网络实用程序（写入注册表项）关闭 AutoAnsiToOem 设置。

这两种选择都依赖于不同的人始终如一地做事。保存文件时所有人都必须选择相同的代码页选项，或者执行构建的所有人都必须为 AutoAnsiToOem 设置相同的选项。

有没有办法在 SQL 脚本或调用它的批处理文件中强制使用代码页，以便始终一致地发布构建，无论文件如何保存或执行者的各种设置释放？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T10:36:54.743

`isql`已过时。它不包含在 SQL Server 2005 或更高版本中，因为它使用同样已过时的 DB-Library 连接。有关原因及其影响，请参阅[将早期版本客户端连接到 SQL Server 2000](http://msdn.microsoft.com/en-us/library/aa174595(SQL.80).aspx)。

`osql`使用 ODBC 连接连接到 SQL Server。为了完整起见，这在 SQL Server 2005 中得到了补充`sqlcmd`，它将 OLE DB 与 SQL Native Client 提供程序一起使用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T12:50:41.690

除了接受的答案之外，我已经针对 SQL Server 2000 数据库使用 sqlcmd 进行了测试，它可以工作。您显然必须从安装了 SQL Server 2005 客户端工具的机器上运行 sqlcmd。

# python - 使用 Python 获取 Wikipedia 文章

> ID：120061
> 
> 赞同：40
> 
> 时间：2008-09-23T09:37:21.983
> 
> 标签：python, urllib2, user-agent, wikipedia, http-status-code-403

我尝试使用 Python 的 urllib 获取 Wikipedia 文章：

```
f = urllib.urlopen("http://en.wikipedia.org/w/index.php?title=Albert_Einstein&printable=yes")           
s = f.read()
f.close() 
```

但是，我得到以下响应，而不是 html 页面：错误 - 维基媒体基金会：

```
Request: GET http://en.wikipedia.org/w/index.php?title=Albert_Einstein&printable=yes, from 192.35.17.11 via knsq1.knams.wikimedia.org (squid/2.6.STABLE21) to ()
Error: ERR_ACCESS_DENIED, errno [No Error] at Tue, 23 Sep 2008 09:09:08 GMT 
```

维基百科似乎阻止了不是来自标准浏览器的请求。

有人知道如何解决这个问题吗？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-23T09:50:39.893

您需要在[python std 库](http://docs.python.org/lib/)中使用替代[urllib的](http://docs.python.org/lib/module-urllib.html)[urllib2](http://docs.python.org/lib/module-urllib2.html)来更改用户代理。

直接从[例子](http://web.archive.org/web/20070202031348/http://docs.python.org/lib/urllib2-examples.html)

```
import urllib2
opener = urllib2.build_opener()
opener.addheaders = [('User-agent', 'Mozilla/5.0')]
infile = opener.open('http://en.wikipedia.org/w/index.php?title=Albert_Einstein&printable=yes')
page = infile.read() 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-09-23T09:49:44.763

它不是针对特定问题的解决方案。但您可能会感兴趣的是使用 mwclient 库 ( [http://botwiki.sno.cc/wiki/Python:Mwclient](http://botwiki.sno.cc/wiki/Python:Mwclient) )。那会容易得多。特别是因为您将直接获取文章内容，从而无需解析 html。

我自己在两个项目中使用过它，效果很好。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-06-11T11:14:20.137

与其试图欺骗 Wikipedia，不如考虑使用他们的[High-Level API](http://www.mediawiki.org/wiki/API)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-11-12T19:16:55.070

如果您尝试访问 Wikipedia 内容（并且不需要有关页面本身的任何特定信息），您应该只使用 'action=raw' 调用 index.php 来获取 wikitext，而不是使用 api，例如在：

'http://en.wikipedia.org/w/index.php? **动作=原始**&title=Main_Page'

或者，如果您想要 HTML 代码，请使用 'action=render'，如下所示：

'http://en.wikipedia.org/w/index.php? **动作=渲染**&title=Main_Page'

您还可以定义一个部分来获取部分内容，例如“section=3”。

然后，您可以使用 urllib2 模块访问它（如所选答案中所建议的那样）。但是，如果您需要有关页面本身的信息（例如修订），您最好使用上面建议的 mwclient。

如果您需要更多信息，请参阅[MediaWiki 的常见问题解答。](http://www.mediawiki.org/wiki/API%3aFAQ#get_the_content_of_a_page_.28wikitext.29.3F)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T09:51:31.560

我用于任何站点的一般解决方案是使用 Firefox 访问该页面，并使用 Firebug 等扩展程序记录 HTTP 请求的所有详细信息，包括任何 cookie。

在您的程序中（在本例中为 Python），您应该尝试发送一个与 Firefox 类似的 HTTP 请求。这通常包括设置 User-Agent、Referer 和 Cookie 字段，但可能还有其他字段。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-09-19T05:37:15.860

[`requests`](http://docs.python-requests.org/en/latest/)太棒了！

以下是获取 html 内容的方法`requests`：

```
import requests
html = requests.get('http://en.wikipedia.org/w/index.php?title=Albert_Einstein&printable=yes').text 
```

完毕！

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T09:41:22.240

尝试将您在请求中发送的用户代理标头更改为： User-Agent: Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.1) Gecko/2008072820 Ubuntu/8.04 (hardy)火狐/3.0.1 (Linux Mint)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T09:48:05.610

您不需要模拟浏览器用户代理；任何用户代理都可以工作，而不是空白的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-11-11T05:56:24.040

请求页面[`?printable=yes`](https://en.wikipedia.org/wiki/Albert_Einstein?printable=yes)为您提供了一个完整的相对干净的 HTML 文档。[`?action=render`](https://en.wikipedia.org/wiki/Albert_Einstein?action=render)只为您提供正文 HTML。请求通过 MediaWiki 操作 API 解析页面[`action=parse`](https://en.wikipedia.org/w/api.php?action=parse&page=Albert%20Einstein&formatversion=2)同样只为您提供正文 HTML，但如果您想要更好的控制，[请参阅 parse API 帮助](https://en.wikipedia.org/w/api.php?action=help&modules=parse)。

如果您只想要页面 HTML 以便可以呈现它，那么使用新的[RESTBase](https://en.wikipedia.org/api/rest_v1/?doc) API 会更快更好，它会返回页面的缓存 HTML 表示。在这种情况下，[https://en.wikipedia.org/api/rest_v1/page/html/Albert_Einstein](https://en.wikipedia.org/api/rest_v1/page/html/Albert_Einstein)。

自 2015 年 11 月起，您不必设置用户代理，但[强烈建议](https://www.mediawiki.org/wiki/API:Etiquette#User-Agent_header)您这样做。此外，几乎所有 Wikimedia wiki[都需要 HTTPS](http://blog.wikimedia.org/2015/06/12/securing-wikimedia-sites-with-https/)，因此请避免 301 重定向并发出 http请求**。**

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-01-25T15:02:18.943

```
import urllib
s = urllib.urlopen('http://en.wikipedia.org/w/index.php?action=raw&title=Albert_Einstein').read() 
```

这似乎对我有用，而无需更改用户代理。没有“action=raw”，它对我不起作用。

# erlang - Mnesia 表复制/共享

> ID：120065
> 
> 赞同：2
> 
> 时间：2008-09-23T09:39:49.543
> 
> 标签：erlang, mnesia

假设我们有 N erlang 节点，运行相同的应用程序。我想与所有 N 个节点共享一个 mnesia 表 T1，我认为这没有问题。但是，我想与节点对共享另一个 mnesia 表 T2。我的意思是 T2 的内容将是相同的，并且仅复制到/仅共享对。换句话说，我想要 T2 表的 N/2 个不同的内容。这对 mnesia 是否可行，而不是为每对不同的节点重命名 T2？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T13:28:55.547

如果使用`mnesia_frag_hash`回调行为，则可以使用 mnesia 的表碎片来执行此操作。这允许您控制密钥的分配，并且可以构造密钥，以便回调能够确定应该使用哪个节点对（以及哪个片段）。

这是否适用于您的特定情况取决于您的访问模式和数据集。很有可能这是一种非常复杂的方法，并且您最好只使用不同的表名来代替。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T11:03:46.957

一张表始终是一张表，无论您与多少个节点共享它。如果您希望成对的节点共享一个表，则必须为每对节点创建一个唯一的表。

不过，您可以对所有这些表使用相同的设置（记录等），因此不应该做太多的工作来完成它。

# directx - 从 Direct3D 纹理和表面进行回读

> ID：120066
> 
> 赞同：15
> 
> 时间：2008-09-23T09:40:10.837
> 
> 标签：directx, textures, gpgpu, geometry-surface

我需要弄清楚如何将数据从 D3D 纹理和表面返回到系统内存。做这些事情的最快方法是什么以及如何做？

此外，如果我只需要一个子区域，如何只读回该部分而不必将整个内容读回系统内存？

简而言之，我正在寻找有关如何将以下内容复制到**系统内存**的简明描述：

1.  **纹理**_
***   **纹理**的**子**集***   一个**表面***   **表面**的**子**集***   一个**D3DUSAGE_RENDERTARGET 纹理***   **D3DUSAGE_RENDERTARGET 纹理**的**子**集******

 ******这是 Direct3D 9，但也将不胜感激有关较新版本的 D3D 的答案。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-23T10:01:40.863

最涉及的部分是从视频内存（“默认池”）中的某个表面读取。这通常是渲染目标。

让我们先来看看简单的部分：

1.  从纹理读取与从该纹理的 0 级表面读取相同。见下文。
2.  对于纹理的子集也是如此。
3.  从非默认内存池（“系统”或“托管”）中的表面读取只是锁定它并读取字节。
4.  对于表面的子集也是如此。只需锁定相关部分并阅读即可。

所以现在我们留下了在显存中的表面（“默认池”）。这将是标记为渲染目标的任何表面/纹理，或您在默认池中创建的任何常规表面/纹理，或后备缓冲区本身。这里的复杂部分是你不能锁定它。

简短的回答是： D3D 设备上的[GetRenderTargetData](http://msdn.microsoft.com/en-us/library/bb174405(VS.85).aspx)方法。

更长的答案（下面是代码的粗略轮廓）：

1.  **rt** = 获取渲染目标表面（这可以是纹理的表面，或者后备缓冲区等）
2.  如果**rt**是多重采样的（GetDesc，检查 D3DSURFACE_DESC.MultiSampleType），那么： a) 创建另一个相同大小、相同格式但*没有*多重采样的渲染目标表面；**b) 将rt**中的 StretchRect 延伸到这个新的表面；c) **rt** = 这个新表面（即在这个新表面上进行）。
3.  **off** = 创建屏幕外平面（CreateOffscreenPlainSurface，D3DPOOL_SYSTEMMEM 池）
4.  设备->GetRenderTargetData( **rt** , **off** )
5.  现在**off**包含渲染目标数据。LockRect()，读取数据，UnlockRect()就可以了。
6.  清理

更长的答案（从我正在处理的代码库中粘贴）如下。这*不会*开箱即用，因为它使用了其他代码库中的一些类、函数、宏和实用程序；但它应该让你开始。我还省略了大部分错误检查（例如，给定的宽度/高度是否超出范围）。我还省略了读取实际像素并可能将它们转换为合适的目标格式的部分（这很容易，但可能会变长，具体取决于您想要支持的格式转换数量）。

```
bool GfxDeviceD3D9::ReadbackImage( /* params */ )
{
    HRESULT hr;
    IDirect3DDevice9* dev = GetD3DDevice();
    SurfacePointer renderTarget;
    hr = dev->GetRenderTarget( 0, &renderTarget );
    if( !renderTarget || FAILED(hr) )
        return false;

    D3DSURFACE_DESC rtDesc;
    renderTarget->GetDesc( &rtDesc );

    SurfacePointer resolvedSurface;
    if( rtDesc.MultiSampleType != D3DMULTISAMPLE_NONE )
    {
        hr = dev->CreateRenderTarget( rtDesc.Width, rtDesc.Height, rtDesc.Format, D3DMULTISAMPLE_NONE, 0, FALSE, &resolvedSurface, NULL );
        if( FAILED(hr) )
            return false;
        hr = dev->StretchRect( renderTarget, NULL, resolvedSurface, NULL, D3DTEXF_NONE );
        if( FAILED(hr) )
            return false;
        renderTarget = resolvedSurface;
    }

    SurfacePointer offscreenSurface;
    hr = dev->CreateOffscreenPlainSurface( rtDesc.Width, rtDesc.Height, rtDesc.Format, D3DPOOL_SYSTEMMEM, &offscreenSurface, NULL );
    if( FAILED(hr) )
        return false;

    hr = dev->GetRenderTargetData( renderTarget, offscreenSurface );
    bool ok = SUCCEEDED(hr);
    if( ok )
    {
        // Here we have data in offscreenSurface.
        D3DLOCKED_RECT lr;
        RECT rect;
        rect.left = 0;
        rect.right = rtDesc.Width;
        rect.top = 0;
        rect.bottom = rtDesc.Height;
        // Lock the surface to read pixels
        hr = offscreenSurface->LockRect( &lr, &rect, D3DLOCK_READONLY );
        if( SUCCEEDED(hr) )
        {
            // Pointer to data is lt.pBits, each row is
            // lr.Pitch bytes apart (often it is the same as width*bpp, but
            // can be larger if driver uses padding)

            // Read the data here!
            offscreenSurface->UnlockRect();
        }
        else
        {
            ok = false;
        }
    }

    return ok;
} 
```

`SurfacePointer`在上面的代码中是一个指向 COM 对象的智能指针（它在赋值或析构函数时释放对象）。大大简化了错误处理。`_comptr_t`这与Visual C++ 中的内容非常相似。

上面的代码读回整个表面。如果您想有效地阅读其中的一部分，那么我相信最快的方法大致是：

1.  创建一个所需大小的默认池表面。
2.  StretchRect 从原始表面的一部分到那个较小的表面。
3.  与较小的一起正常进行。

事实上，这与上面处理多采样表面的代码非常相似。我认为，如果您只想获取多采样表面的一部分，则可以进行多采样解析并在一个 StretchRect 中获取其中的一部分。

**编辑**：删除了实际读取像素和格式转换的代码。与问题没有直接关系，代码很长。

**编辑**：更新以匹配已编辑的问题。

# regex - 如何从某个起始位置找到字符串中第一次出现的模式？

> ID：120071
> 
> 赞同：6
> 
> 时间：2008-09-23T09:41:07.263
> 
> 标签：regex, perl, string, search

我有一个任意长度的字符串，从位置 p0 开始，我需要找到三个 3 字母模式之一的第一次出现。

假设字符串只包含字母。我需要找到从位置 p0 开始并以三元组形式向前跳跃的三元组计数，直到第一次出现“aaa”或“bbb”或“ccc”。

这甚至可能仅使用正则表达式吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-23T09:44:27.223

```
$string=~/^   # from the start of the string
            (?:.{$p0}) # skip (don't capture) "$p0" occurrences of any character
            (?:...)*?  # skip 3 characters at a time,
                       # as few times as possible (non-greedy)
            (aaa|bbb|ccc) # capture aaa or bbb or ccc as $1
         /x; 
```

（假设 p0 从 0 开始）。

当然，在字符串上使用 substr 来跳过可能更有效：

```
substr($string, $p0)=~/^(?:...)*?(aaa|bbb|ccc)/; 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-23T10:19:50.853

Moritz 说这可能比正则表达式更快。哪怕慢一点，早上5点还是比较容易理解的。:)

```
             #0123456789.123456789.123456789。  
我的 $string = "alsdhfaaasccclaaaagalkfgblkgbklfs";  
我的 $pos = 9;  
我的 $length = 3;  
我的 $regex = qr/^(aaa|bbb|ccc)/;

而( $pos < 长度 $string )    
    {  
    print "检查 $pos\n";  

    if( substr( $string, $pos, $length ) =~ /$regex/ )
        {
        print "在 $pos\n 找到 $1";
        最后的;
        }

    $pos += $长度；
    }

```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-23T09:56:28.303

您不能真正使用正则表达式，但您可以执行以下操作：

```
pos $string = $start_from;
$string =~ m/\G         # anchor to previous pos()
            ((?:...)*?) # capture everything up to the match
            (aaa|bbb|ccc)
            /xs  or die "No match"
my $result = length($1) / 3; 
```

但我认为使用 substr() 和 unpack() 拆分为三元组并在 for 循环中遍历三元组会更快一些。

（编辑：它是长度（），而不是长度（）；-）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T18:24:27.427

主要部分是拆分/（...）/。但在此结束时，您将获得您的位置和发生数据。

```
my @expected_triplets = qw<aaa bbb ccc>;
my $data_string      
    = 'fjeidoaaaivtrxxcccfznaaauitbbbfzjasdjfncccftjtjqznnjgjaaajeitjgbbblafjan'
    ;
my $place          = 0;
my @triplets       = grep { length } split /(...)/, $data_string;
my %occurrence_for = map { $_, [] } @expected_triplets;
foreach my $i ( 0..@triplets ) {
    my $triplet = $triplets[$i];
    push( @{$occurrence_for{$triplet}}, $i ) if exists $occurrence_for{$triplet};
} 
```

或者通过正则表达式进行简单计数（它使用实验性 (??{})）

```
my ( $count, %count );
my $data_string      
    = 'fjeidoaaaivtrxxcccfznaaauitbbbfzjasdjfncccftjtjqznnjgjaaajeitjgbbblafjan'
    ;
$data_string =~ m/(aaa|bbb|ccc)(??{ $count++; $count{$^N}++ })/g; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-07T21:16:04.580

如果速度是一个严重的问题，您可以根据 3 个字符串的内容，通过创建一棵树（例如 Aho-Corasick 算法或类似算法）来获得真正的幻想。

每个可能状态的映射都是可能的，例如，如果没有字符串以 'a' 开头，则 state[0]['a'] = 0。

# asp.net - Asp.Net RequireFieldValidator 和 Javascript 所见即所得的问题

> ID：120075
> 
> 赞同：1
> 
> 时间：2008-09-23T09:41:54.000
> 
> 标签：asp.net, javascript, validation, wysiwyg

我正在使用[来自 OpenWebWare 的开源 Javascript WYSIWYG](http://openwebware.com/)和我称之为 WYSIWYG的**TextBox**上的Asp.Net **RequiredFieldValidator 。**一切正常，但我第一次尝试提交表单时，我收到服务器端**RFV****错误消息**“必需”，但如果我第二次提交，它就会通过。

 ******我错过了什么吗？我想进行客户端验证......我怎样才能让文本注册为非空？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T10:34:25.340

我认为这种行为的原因是验证代码比从 WYSIWYG 的值更新底层 TextBox 的代码运行得更早。因此，第一次出现错误时，该字段会更新，而第二次则没有。尝试第二次删除所有内容，我敢打赌您不会收到验证错误（因为此时验证器的值是您第一次实际提交的值）。

解决方案是为您的 WYSIWYG 找到一个 JavaScript API 调用，这将强制更新基础文本框字段并将其称为提交按钮的 onclick（客户端）或任何您使用的任何内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T09:49:43.077

textarea HTML 标签是最令人不快的标签之一，我不能 100% 确定客户端验证器是否会支持它，无论它是否是所见即所得。

我认为您最好使用 CustomValidator 并编写手动检查的 JavaScript。

或者，您可以通过与 FireBug 或 VS 2008 一起使用的 JavaScript 进行调试。

# java - 使用 VetoableChangeListener 停止循环通知

> ID：120082
> 
> 赞同：1
> 
> 时间：2008-09-23T09:42:52.220
> 
> 标签：java, model-view-controller

我对 a 的设计有疑问`VetoableChangeListener`。我实现了`VetoableChangeListener`接口来监听模型类中属性的变化，所以当模型触发时

```
vetoableChange(PropertyChangeEvent evt) throws PropertyVetoException 
```

…我尝试将更改保存在数据库中，这可能会失败（`SQLException`例如，通过）。如果失败，我会抛出一个`PropertyVetoException`来恢复模型中的更改。

该模型在一个`VetoableChangeSupport`（JDK类）中进行委托，当它接收`PropertyVetoException`到它并通知恢复到ALL时`VetoableChangeListener`，使用`oldValue`/`newValue`交换（后来它重新抛出异常），以便事件再次出现在我的类中，我尝试再次保存在数据库中，等等......

我有一个解决方法，即模型在没有人抛出 a 之前不会改变`PropertyVetoException`，所以在`VetoableChangeListener`我首先检查我要保存在数据库中的数据是否不等于模型中的数据，如果它相等我只需忽略更改。

还有其他更好的解决方法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-26T14:45:58.960

您的“解决方法”并不是真正的解决方法，但实际上对我来说听起来像是正确的解决方案：在尝试“更改”持久版本之前确认对象的当前状态实际上发生了变化。这也将更加有效（数据库访问成本很高）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T12:36:47.870

You should check the Vetoable change before you change the model, not after...

ie: if there is a problem, the model is not changed, not revert the model if the change was wrong

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T18:06:04.413

收件人：timyates

这正是我所做的，我接收事件，尝试更新数据库，但它失败了，我抛出异常否决更改，因此模型没有更新，但问题是 VetoableChangeSupport 通知我我自己的否决权，如果我不执行我在问题中解释的解决方法，请进入 bucle

# sql-server - 如何更改 Sql Server 中小数列的精度？

> ID：120083
> 
> 赞同：106
> 
> 时间：2008-09-23T09:42:56.587
> 
> 标签：sql-server

有没有办法改变 Sql Server 中现有十进制列的精度？

* * *

## 回答 #1

> 赞同：190
> 
> 时间：2008-09-23T12:58:38.413

```
ALTER TABLE Testing ALTER COLUMN TestDec decimal(16,1) 
```

只需`decimal(precision, scale)`输入，用您想要的值替换精度和比例。

我没有使用表中的数据对此进行任何测试，但是如果您更改精度，如果新精度较低，您可能会丢失数据。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2014-04-06T14:08:58.847

可能有更好的方法，但您始终可以将该列复制到新列中，删除它并将新列重命名为第一列的名称。

以机智：

```
ALTER TABLE MyTable ADD NewColumnName DECIMAL(16, 2);
GO

UPDATE  MyTable
SET     NewColumnName = OldColumnName;
GO

ALTER TABLE CONTRACTS DROP COLUMN OldColumnName;
GO

EXEC sp_rename
    @objname = 'MyTable.NewColumnName',
    @newname = 'OldColumnName',
    @objtype = 'COLUMN'
GO 
```

这在 SQL Server 2008 R2 上进行了测试，但应该可以在 SQL Server 2000+ 上运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-01-30T10:44:21.833

```
ALTER TABLE (Your_Table_Name) MODIFY (Your_Column_Name) DATA_TYPE(); 
```

对于你的问题：

```
ALTER TABLE (Your_Table_Name) MODIFY (Your_Column_Name) DECIMAL(Precision, Scale); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-08-16T15:47:36.337

在 Oracle 10G 和更高版本中，以下语句将起作用。

`ALTER TABLE <TABLE_NAME> MODIFY <COLUMN_NAME> <DATA_TYPE>`

如果当前数据类型为 NUMBER(5,2)，而您想将其更改为 NUMBER(10,2)，则语句如下

`ALTER TABLE <TABLE_NAME> MODIFY <COLUMN_NAME> NUMBER(10,2)`

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2016-08-01T07:07:49.180

```
ALTER TABLE `tableName` CHANGE  `columnName` DECIMAL(16,1) NOT NULL; 
```

我用这个来改变

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2008-09-23T09:45:16.520

转到企业管理器，设计表，单击您的字段。

做一个小数列

在底部的属性中有一个精度属性

# performance - 通过远程访问单服务器应用程序的性能

> ID：120091
> 
> 赞同：0
> 
> 时间：2008-09-23T09:44:08.520
> 
> 标签：performance, mono

这是我的设置：我为本地客户端机器编写了一个 .NET 应用程序，它实现了一个也可以在网页上使用的功能。为了使这个例子简单，假设客户安装了一个软件，他可以在其中输入一些数据并取回一些数据。

这个想法是创建一个网页，该网页包含一个表单，用户在该表单中输入相同的数据并获得与上述相同的结果。由于公司有可用的网络服务器，最初的想法是创建一个单一的网络服务，但由于未知原因而被驳回。“服务”不应作为 Web 服务运行，而应由 PHP 脚本调用。这目前是通过从 PHP 中通过 shell_exec 调用单声道应用程序来实现的。

所以现在我被我的应用程序的单声道端口卡住了，它工作正常，但执行时间太长。我已经删除了所有不必要的 dll、方法等，但是通过命令行调用应用程序 - 通过命令行参数提交所需的数据 - 大约需要 700 毫秒。我们预计每秒大约 10 次点击，所以这只能在为此任务设置大量服务器时才有效。

我假设 700m 与每次启动应用程序的成本有关，因为如果我只处理一次或五百次请求（我采用原始输入，稍微改变它并做500 次迭代，每次“新”数据。从第二次迭代开始，处理时间下降到每次迭代大约 1ms）

我的下一个想法是将单声道应用程序设置为远程服务器，这样它只需启动一次，然后就可以处理传入的请求。因此，我编写了另一个作为客户端的单声道应用程序。调用客户端，让客户端将数据传递给服务器并检索结果现在需要 344 毫秒。这更好，但仍然比我预期的要慢得多。

[然后，我根据这篇博](http://pubcrawler.org/2003/02/19/net-remoting-with-mono/)文从头开始实施了一个新项目，但遇到了同样的性能问题。

问题是：我是否缺少与可以提高客户端/服务器速度的单项目相关的内容？尽管为此任务创建 Web 服务的想法被驳回了，但 Web 服务在这种情况下会表现得更好（因为我不需要客户端应用程序来调用该服务），尽管据说远程处理比 Web 服务更快？

* * *

我本可以更清楚地说明这一点，但目前还不能实现 web 服务（请不要问为什么，我没有写要求；））

同时我检查了它确实是客户端的启动，这在远程处理场景中花费了大部分时间。

我可以想象从命令行通过管道访问服务器，这非常适合我的场景。我想这将使用套接字来完成？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T20:17:23.583

您可以尝试使用 AOT 来减少启动时间。在 .NET 上，您将使用 ngen 来实现该目的，在 mono 上，只需对应用程序使用的所有程序集执行 mono --aot 即可。

AOT 的代码比 JIT 的代码慢，但具有减少启动时间的优势。

您甚至可以尝试使用 AOT 框架程序集，例如 mscorlib 和 System。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T12:41:52.273

我相信在这种情况下，远程处理并不是一个理想的选择。但是，您在服务器上安装单声道而不是每次都启动它的想法确实很可靠。

您是否考虑过通过 HTTP 使用 SOAP Web 服务？这也将帮助您处理“网页”场景。

即使以我的经验对您来说有点慢，自定义 RESTful 服务实现也比远程处理更容易使用。

# sql-server - 存储过程语法

> ID：120102
> 
> 赞同：1
> 
> 时间：2008-09-23T09:46:30.683
> 
> 标签：sql-server, sql-server-2005, stored-procedures

我的存储过程从 SQL Server 2005 中的 SQL instegartion 包调用如下

执行？= Validation.PopulateFaultsFileDetails ？, 0

虽然我不确定是什么？方法

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T09:50:06.807

这 ？代表一个变量，准确地说是一个参数。首先 ？是存储过程的返回值，第二个是存储过程的第一个参数

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T10:27:51.380

调用此 SQL 语句时，两个问号 (?) 都将被替换。第一个将被一个变量替换，该变量将接收存储过程的返回值。第二个将被一个值替换，该值将传递到存储过程中。使用此语句的代码将如下所示（伪代码）：

```
dim result
SQL = "EXEC ? = Validation.PopulateFaultsFileDetails ? , 0"
SQL.execute(result, 99)    // pass in 99 to the stored proc
debug.print result 
```

这为您提供了 3 个优势：

1.  您可以重复使用具有不同值的同一位 SQL
2.  您可以获取返回值并测试成功/错误
3.  如果您传入的值是一个字符串，它应该为您正确转义，从而降低您的应用程序中 SQL 注入漏洞的风险。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T10:34:14.110

谢谢，我很感激答案。

我能够使用 DECLARE @FaultsFileName varchar DECLARE @FaultsFileID int EXEC @FaultsFileID = Validation.PopulateFaultsFileDetails 'SameMonth Test.txt' , @FaultsFileID SELECT @FaultsFileID 成功执行存储过程

但是，当我在集成包中将输入参数作为“SameMonth Test.txt”传递时，我收到一条错误消息：

参数名称不能是序数类型和命名类型的混合。”。可能的失败原因：查询出现问题、“ResultSet”属性设置不正确、参数设置不正确或连接未正确建立。

# email - 电子邮件通讯服务指南

> ID：120107
> 
> 赞同：5
> 
> 时间：2008-09-23T09:48:46.950
> 
> 标签：email, smtp, email-spam

我正在使用 .NET 和 Windows Server 技术实现**电子邮件通讯发送服务。**是否有全面的指导方针可以帮助**避免电子邮件被垃圾邮件过滤器**和其他机制捕获？

它们应该涵盖（合法）批量邮件发送的所有方面：SMTP 配置、DNS、HTML 内容、图像、内容中的链接等。一个简单的例子：嵌入图像还是从服务器加载图像更好？

如果您能提供一些经验数据来显示所采取的某些措施的效率，那就太好了。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T10:01:44.030

虽然我没有明确的答案，但我认为这是一个非常重要的问题。以下是我所知道的一些花絮

1.  选择一个干净的托管/smtp 服务器。垃圾邮件 SMTP 服务器的 IP 地址通常被其他 ISP 列入黑名单。
2.  向每位订阅者发送一封简单的介绍性电子邮件，要求他们将您的发件人地址添加到他们的安全列表中。
3.  非常谨慎地只发送给那些真正期待它的人。您不希望垃圾邮件过滤器的模式识别器了解您内容的味道。
4.  如果您事先不知道您的 smtp 服务器，最好在您的应用程序中提供配置选项以控制批次大小和批次之间的延迟。一些服务器不喜欢大批量或连续活动。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T10:23:39.283

除非您有非常具体的理由自己托管时事通讯，否则我认为您最好使用第三方服务。那里有很多，有些价格非常便宜。

1.  它将为您节省开发工作（重新发明轮子没有意义）。

2.  他们的系统将处理您需要包含在电子邮件通讯中的所有退订链接内容，以遵守 CAN SPAM 法律或其他规定。

3.  他们处理垃圾邮件报告，如果您有任何重要大小的列表，您将不可避免地收到这些报告。他们会记录谁注册、如何注册以及他们的 IP 地址，并且可以在收到垃圾邮件报告时出示这些记录，以证明他们的服务没有发送垃圾邮件。

4.  您可以使用双重选择加入（或确认选择加入），以获得额外的证据来证明您发送电子邮件的人实际上已注册接收它们。

如果您确实需要自己托管，我建议您在网上搜索“电子邮件可传递性”。已知的帮助包括正确设置 SPF 记录、DomainKeys/DKIM、正确的 DNS 设置（尤其是反向 DNS - 最好只使用在线服务来检查您的 DNS 设置）。您可以通过向 check-auth@verifier.port25.com 发送电子邮件来测试很多这些东西。

最好避免在您的电子邮件中使用垃圾邮件 - 总是有点猜测，但您有些词可能会触发过滤器。

但我猜到目前为止，最重要的事情是从与 ISP 保持良好关系的受信任服务器发送您的电子邮件（即确保 ISP 不认为该服务器正在发送垃圾邮件）。这就是为什么让第三方为您处理所有事情要容易得多的一个重要原因。

# php - 与 PHP 连接时从 MS Access 数据库中检索目录、元数据或架构信息

> ID：120114
> 
> 赞同：0
> 
> 时间：2008-09-23T09:49:53.920
> 
> 标签：php, database, ms-access

我正在使用以下 PHP 代码连接到 MS Access 数据库：

```
$odb_conn = new COM("ADODB.Connection");
$connstr = "DRIVER={Microsoft Access Driver (*.mdb)}; DBQ=". $db_path.";";
$odb_conn->open($connstr); 
```

如何从 mdb 文件中检索数据库目录/元数据？

**找到解决方案**

```
$rs_meta = $odb_conn->OpenSchema(20, array(Null, Null, Null, "TABLE")); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T11:50:30.337

您可以在此处找到有关 ADO 的信息：

*   [http://msdn.microsoft.com/en-us/library/ms675532(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms675532(VS.85).aspx)

*   [http://www.w3schools.com/ado/default.asp](http://www.w3schools.com/ado/default.asp)

连接对象有一个 OpenSchema 方法来获取数据库模式信息。

我不知道如何将 MS Acces DB 与 PHP 一起使用以及您的新 COM() 对象如何工作，但我认为使用 OleDB 连接而不是 ADO 对象会更好：http: [//msdn.microsoft.com/en-我们/图书馆/ms722784(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms722784(VS.85).aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T10:17:04.277

该`MSysObjects`表可用于在 Access 中查询元数据：

```
SELECT NAME
FROM MSysObjects
WHERE Type In (1,4,6) AND Left([Name],4)<>"MSYS" 
```

# c# - 加密库？

> ID：120116
> 
> 赞同：7
> 
> 时间：2008-09-23T09:50:10.347
> 
> 标签：c#, encryption, pki

我的任务是在 C# 中为一个公司项目实现一个 PKI 库，但一直找不到一个好的实现。似乎有多个库，并且指向已删除的 MSDN 库的许多断开的链接。我见过使用 Crypt32.dll 的人，构建自己的库的人，使用 P/Invoke 访问系统证书存储的人，扩展内置库的人，根本不适用于 C# 的示例（例如 Java 示例），和商业图书馆。

我的问题是，对于简单的数据加密/解密，最推荐使用哪个实现/库？

作为我计划使用它的一些背景知识，我只需要使用私钥 (.pfx) 加密消息，并使用公钥 (.cer) 解密。项目的这个级别不需要消息签名和身份验证，尽管将来可能需要。我看到了对加密长度的引用，这让我感到不安。我们需要能够加密任何长度的消息（当然，在合理范围内！）。这是我需要担心的事情吗？如果是这样，有没有办法处理它？

如果可能的话，我宁愿不将公钥/私钥存储在 Windows 证书管理器中，但如果它使实现变得更加简单，那就这样吧。

我意识到 PKI 和加密是一个庞大而复杂的主题，但无论如何我希望有一个相对简单的库......（可以希望，对吗？）

谢谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-23T10:01:11.817

好吧，您没有提到内置类不能满足您的需求，那么[**System.Security.Cryptography.RSACryptoServiceProvider**](https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.rsacryptoserviceprovider)怎么样？

它具有大量合格的非对称加密/解密流的方法。

有几个教程/指南可以带您一路走好：

*   [C# .NET 中的公钥 RSA 加密 - 代码项目](https://www.codeproject.com/Articles/10877/Public-Key-RSA-Encryption-in-C-NET)
*   [.NET 中的 RSA 加密——揭秘！——彼得·A·布罗姆伯格](http://www.eggheadcafe.com/articles/20020630.asp)

通过[Google](https://www.google.se/search?q=.NET+RSACryptoServiceProvider)可以找到更多信息。

**更新**：关于长度限制，如果你只是在两边实现相同的缓冲区算法，加密和解密应该没有任何问题。

**Update2**：是的，我的示例是**RSACryptoProvider** ，但如果您想要公钥/私钥解决方案，您可以使用派生自[**System.Security.Cryptography.AsymmetricAlgorithm的任何类。**](https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.asymmetricalgorithm)或者建立你自己的......或者可能不是:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T10:27:34.797

是的，内置类有什么问题？

如果你不想使用 Windows 证书存储，你可以使用类似这样的东西

```
RSACryptoServiceProvider rscp = new RSACryptoServiceProvider();
rscp.FromXmlString("<RSAKeyValue><Modulus>key data gere</Modulus><Exponent></Exponent></RSAKeyValue>"); 
```

不过，不确定这对于私钥是否是个好主意。

[这里](http://statestreetgang.net/post/2008/05/A-NET-Cryptography-Primer2c-Part-Four.aspx)有一个关于这个主题的很好的教程

# security - 一种以上加密算法的组合

> ID：120131
> 
> 赞同：4
> 
> 时间：2008-09-23T09:54:01.757
> 
> 标签：security, cryptography

我正在考虑以下内容：我有一些数据流，我想尽可能地保护它们——应用一些 IV 的 AES，然后是一些 IV 的 Blowfish，最后再应用一些 AES 是否有意义四？

加密/解密过程将被隐藏（甚至可以防止调试），因此很难猜测使用了哪种加密方法和什么 IV（但是，我知道这个加密链的力量不能依赖关于这个事实，因为每个针对调试的保护在一段时间后都会被破坏）。

我有这方面的计算机能力（数据量不是那么大）所以问题只是它是否值得实施。例如，TripleDES 的工作方式非常相似，使用三个 IV 和加密/解密/加密方案，因此它可能并非完全是胡说八道。另一个问题是，当我对第 1 部分和第 3 部分使用相同的 IV，甚至对所有三个部分使用相同的 IV 时，我会降低多少安全性？

我欢迎有关此主题的任何提示

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-23T09:58:51.323

我不确定这个特定的组合，但是除非已经对特定的组合进行了广泛的研究，否则混合这样的东西通常是一个坏主意。有可能数学变换实际上会相互抵消，最终结果会更容易破解。AES 或 Blowfish 的单遍应该绰绰有余。

更新：从我下面的评论中......</p>

以 TripleDES 为例：想想世界上最好的密码学家花了多少时间和精力来创建这种组合（请注意，DoubleDES 有一个漏洞），尽管有 192 位密钥，但他们能做的最好的事情是 112 位安全性。

更新 2：我必须同意 Diomidis 的观点，即 AES*极*不可能成为您系统中的薄弱环节。系统的几乎所有其他方面都比 AES 更容易受到损害。

更新 3：根据您对流的处理，您可能只想使用[TLS](http://en.wikipedia.org/wiki/Secure_Sockets_Layer)（SSL 的后继者）。我推荐[Practical Cryptography](http://www.schneier.com/book-practical.html)了解更多细节——它在解决您需要解决的许多问题方面做得非常好。除其他事项外，它还讨论了[流密码](http://en.wikipedia.org/wiki/Stream_cipher)，它可能比 AES 更合适，也可能不更合适（因为 AES 是一种[分组密码](http://en.wikipedia.org/wiki/Block_cipher)，并且您特别提到您有一个要加密的数据流）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T10:03:15.307

我认为通过在与第一个非常不同的另一个加密算法之上应用一种加密算法，您没有什么可以放松的。然而，我会警惕在第一轮之上运行第二轮相同的算法，即使你在两者之间运行了另一个。两次运行之间的交互可能会打开一个漏洞。

话虽如此，我认为您在加密部分上苦恼了太多。大多数数据泄露不是通过破坏行业标准加密算法（如 AES）而发生的，而是通过系统中的其他弱点发生的。我建议花更多时间研究密钥管理、未加密数据的处理、算法实施中的弱点（泄露数据或密钥的可能性）以及更广泛的系统问题，例如，你在做什么数据备份。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T10:44:00.153

黑客总是会攻击链中最薄弱的元素。因此，使强元素变得更强大几乎没有什么帮助。使用 128 位密钥长度已经不可能破解 AES 加密。河豚也是如此。选择更大的密钥长度会变得更加困难，但实际上 128 位迄今为止从未被破解（并且可能不会在未来 10 或 20 年内）。所以这种加密可能不是最弱的元素，那么为什么要让它变得更强呢？它已经很强大了。

想想还有什么可能是最弱的元素？四号？实际上，我不会浪费太多时间来选择或隐藏它。最弱的密钥通常是加密密钥。例如，如果您正在加密存储到磁盘的数据，但您的应用程序需要读取这些数据，您的应用程序需要知道 IV 并且它需要知道加密密钥，因此它们都需要**在**二进制文件中。这实际上是最弱的元素。即使您采用 20 种加密方法并将它们链接到您的数据上，所有 20 种的 IV 和加密密钥也需要在二进制文件中，如果黑客可以提取它们，那么您使用 20 种而不是 1 种加密方法这一事实提供了零额外安全。

由于我仍然不知道整个过程是什么（谁加密数据，谁解密数据，数据存储在哪里，如何传输，谁需要知道加密密钥等等），所以很难说最弱的元素到底是什么，但我怀疑 AES 或 Blowfish 加密本身是你最弱的元素。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T09:58:39.903

您试图保护您的数据免受谁的侵害？你的兄弟，你的竞争对手，你的政府，还是外星人？

其中每一个都有不同的级别，您可以在有意义的预算（时间/现金）内认为数据“尽可能安全”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T10:11:57.657

我不会依赖于掩盖您正在使用的算法。这种“默默无闻的安全”不会长期有效。反编译代码是揭示您正在使用的加密货币的一种方式，但通常人们不会长期保留这样的秘密。这就是为什么我们首先拥有私钥/公钥加密。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T10:00:28.293

此外，不要浪费时间混淆算法 - 应用基尔霍夫原理，并记住 AES 就其本身而言，在大量需要“安全”数据的地方使用（并承认使用）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T10:05:36.517

Damien：你说得对，我应该写得更清楚。我说的是竞争对手，它是用于商业用途的。所以有有意义的预算可用，但我不想在不确定我知道为什么这样做的情况下实施它:)

汉克：是的，这也是我害怕的。最支持这个想法的来源是 TripleDES。另一方面，当我使用一种算法加密某些数据，然后应用另一种算法时，如果整个加密的“力量”小于使用独立算法，那将是非常奇怪的。但这并不意味着它不能相等......这就是我要求一些提示的原因，这不是我的知识领域......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T10:10:13.793

Diomidis：这基本上是我的观点，但我的同事试图让我相信它确实“增强”了安全性。我的建议是使用更强的加密密钥，而不是一个接一个的算法，而不需要任何思考或深入了解我在做什么。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T10:14:11.660

@Miro Kropacek - 你的同事正试图通过 Voodoo 来增加安全性。相反，尝试构建一些可以分析缺陷的简单东西——比如只使用 AES。

我猜是他（她？）建议通过调试保护来增强安全性......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T10:32:22.663

如果您使用不同的 IV 和密钥进行多次加密，实际上不会*降低*安全性，但安全性的提升可能远低于您的预期：在 2DES 的示例中，中间相遇攻击意味着它的难度只有两倍，而不是平方难度。

不过，总的来说，如果您需要更高的安全性，坚持使用单一的知名算法并增加密钥长度会更安全。将编写密码系统留给专家（我不认为自己是其中之一）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-24T11:07:31.527

加密两次比加密一次更安全，尽管一开始可能不清楚。

直观地说，使用相同的算法加密两次似乎没有提供额外的保护，因为攻击者可能会找到一个从最终密文一直解密回明文的密钥。... 但这种情况并非如此。

例如，我从明文**A**开始并使用密钥**K1**对其进行加密以获得**B**。然后我用密钥**K2**加密**B**以获得**C**。

 ****直观地说，假设很可能有一个密钥**K3**，我可以用它来加密**A**并直接获取**C** ，这似乎是合理的。如果是这种情况，那么使用暴力破解的攻击者最终会偶然发现**K3**并能够解密**C**，结果是额外的加密步骤没有增加任何安全性。

但是，这种密钥不太可能存在（对于任何现代加密方案）。（当我在这里说“极不可能”时，我的意思是普通人会用“不可能”这个词来表达）。

为什么？
将密钥视为提供从明文到密文的映射的函数。
如果我们的密钥长度都是**KL**位，那么就有 2^KL 这样的映射。**但是，如果我每个使用 2 个KL**
位 的密钥，这会给我 (2^KL)^2 映射。 并非所有这些都可以等同于单阶段加密。

 ***如果使用 2 种不同的算法*，加密两次的另一个优点是，如果在其中一种算法中发现漏洞，另一种算法仍然提供一些安全性。

正如其他人所指出的，暴力破解密钥通常是最后的手段。攻击者通常会尝试在其他某个时间点破坏该过程（例如，使用社会工程来发现密码短语）。

另一种提高安全性的方法是简单地使用更长的密钥和一种加密算法。

...随时纠正我的数学！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-24T15:03:52.720

是的，它可能是有益的，但在大多数情况下可能会矫枉过正。此外，正如汉克所说，某些组合实际上会削弱您的加密。

TrueCrypt 提供了许多组合加密算法，例如 AES-Twofish-Serpent。当然，使用它们时会有性能损失。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-24T17:36:30.357

更改算法并不能提高质量（除非您希望算法被破坏），它仅与密钥/块长度和混淆方面的一些优势有关。多次这样做很有趣，因为即使第一个密钥泄露，生成的数据也无法与随机数据区分开来。有些块大小在给定平台上处理得更好（例如寄存器大小）。

攻击质量加密算法只能通过暴力破解，因此取决于您可以花费的计算能力。这意味着最终您只能增加某人需要解密它的可能平均时间。

如果数据具有*真正的*价值，他们最好不要攻击数据，而是攻击密钥持有者......

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-09-28T14:05:48.293

我同意上面所说的。多个阶段的加密不会给您带来太多收益。如果您使用的是“安全”算法，那么几乎不可能破解。在某些标准流模式下使用 AES。见[http://csrc.nist.gov/groups/ST/toolkit/index.html](http://csrc.nist.gov/groups/ST/toolkit/index.html)对于接受的密码和模式。如果使用得当，该网站上推荐的任何内容都应该足够安全。如果您想更加安全，请使用 AES 256，尽管 128 仍然应该足够了。最大的风险不是针对算法本身的攻击，而是针对密钥管理的攻击或侧信道攻击（取决于应用程序和使用情况，这可能是也可能不是风险）。如果您的应用程序容易受到密钥管理攻击或旁道攻击，那么您应用多少级别的加密实际上并不重要。这就是我要集中精力的地方。

# failover - 故障转移和灾难恢复

> ID：120139
> 
> 赞同：14
> 
> 时间：2008-09-23T09:56:07.057
> 
> 标签：failover, high-availability, disaster-recovery

故障转移和灾难恢复有什么区别？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-23T09:57:57.270

Failover：当一台机器出现故障时，另一台机器（通常在同一位置）接管并恢复服务

灾难恢复：当哥斯拉破坏您的数据中心时，您确实有替代位置来继续提供您的服务和协议/手段让其他位置知道如何继续提供服务

根据每项服务的特定需求，灾难恢复可能只是不同位置保险箱中的备份磁带。换句话说，它只是有一个定义的协议来从灾难中恢复。同样，故障转移可能只是拥有一台备用备份机器，它使您可以前往数据中心，让它接管发生故障的机器，也就是说，有一个关于在机器发生故障时该怎么做的定义协议。

总而言之，故障转移回答了“如果单台机器发生故障我该怎么办？”的问题，灾难恢复回答“如果发生灾难（火灾、洪水、战争、ISP 破产等等）我该怎么办？”

[高可用性部署架构](http://dasunhegoda.com/high-availability-deployment-architecture/1003/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T10:17:37.877

故障转移更多地与**备份过程**相关联。

从终端客户的角度来看，两者的主要区别在于**停机时间**。

*   故障转移预计停机时间较短（最多 1 2 小时）
*   DR 可以有 6 小时到一两天之间的任何时间。

另一个区别是故障转移或 DR 后可用**环境的性质。**

*   故障转移意味着最终客户什么也看不到，可以继续他的活动（开发或生产管理）
*   DR 应该意味着仅备份生产环境。所有开发环境都已关闭或严重降级。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T12:04:37.653

由于灾难（如 9/11）可以**完全**摧毁数据中心，这是否意味着灾难恢复是为该数据中心重建一切的过程？

# ruby-on-rails - Rails 中的用户监控

> ID：120149
> 
> 赞同：9
> 
> 时间：2008-09-23T09:59:49.277
> 
> 标签：ruby-on-rails, ruby, rubygems

我们有一个具有广泛管理部分的应用程序。我们得到了一个对功能感到满意的小触发器（就像您所做的那样），并且正在寻找一些快速简便的方法来监控“谁使用了什么”。

理想情况下，一个简单的 gem 将允许我们在每个用户的基础上跟踪控制器/操作，以构建使用和未使用的功能的图片。

有什么好推荐的。。

谢谢

多姆

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T10:11:23.790

我不知道有一个流行的 gem 或插件。过去，我`before_filter`在 ApplicationController 中实现了这种审计：

从记忆里：

```
class ApplicationController < ActionController::Base
  before_filter :audit_events
  # ...

  protected
  def audit_events
    local_params = params.clone
    controller = local_params.delete(:controller)
    action = local_params.delete(:action)
    Audit.create(
      :user => current_user, 
      :controller => controller, 
      :action => action, 
      :params => local_params
    )
  end
end 
```

当然，这假设您正在使用诸如 restful_authentication 之类的东西来获取当前用户。

编辑：根据您的关联的设置方式，您最好将 Audit.create 位替换为：

```
current_user.audits.create({
  :controller => controller,
  :action => action,
  :params => local_params
}) 
```

通过 ActiveRecord 关联创建范围 == 最佳实践

# design-patterns - 长期 RESTful 交互

> ID：120158
> 
> 赞同：3
> 
> 时间：2008-09-23T10:01:46.793
> 
> 标签：design-patterns, architecture, rest

我们目前正在我的团队中进行讨论，我会对其他观点感兴趣。假设我们有一个 RESTful Web 服务，其作用是通过应用各种分析算法和服务来注释文档。清晰的基本交互：我们有一个资源，即文档集合；客户端向集合发布一个新文档，获取新文档的 URI，然后可以 GET`docURI`以获取文档或 GET`{docURI}/metadata`以查看一般元数据，`{docURI}/ne`对于命名实体等。问题是一些分析可能需要很长时间才能完成。假设客户端在分析完成之前获取元数据 URI，因为它希望能够在 UI 中显示部分或增量结果。将来重复 GET 可能会产生更多结果。

我们讨论过的解决方案包括：

*   保持 HTTP 连接打开直到所有分析完成（这似乎不可扩展）
*   使用 `content-length`and `accept-range` headers 获取增量内容（但我们事先不知道最终内容会持续多长时间）
*   为每个资源提供一个 Atom 提要，以便客户端订阅更新事件而不是简单地获取资源（如果有许多活动文档，似乎过于复杂并且可能资源匮乏）
*   只是让 GET 返回当时可用的任何内容（但它仍然留下客户端知道我们何时完成的问题）*[编辑以删除对幂等性的引用以下评论]*。

对于在 RESTful 架构中处理长期或异步交互的替代方法有什么意见或建议？

伊恩

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T10:16:25.510

我将通过以下方式实现它：

1) 客户端请求元数据
2) 服务器返回实际数据（如果它已经可用）或 NotReady 标记
3) 客户端询问服务器何时数据可用（此步骤可以与上一步合并）
4) 服务器返回时间间隔（可能有执行作业总数的一些启发式等）
5）客户端等待指定的时间段并转到步骤1

这样您就可以尽快向客户提供数据。您可以通过调整第 4 步返回的延迟间隔来调整服务器负载）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T10:18:59.030

> 为每个资源提供一个 Atom 提要，以便客户端订阅更新事件而不是简单地获取资源（如果有许多活动文档，似乎过于复杂并且可能资源匮乏）

你考虑过[SUP](http://code.google.com/p/simpleupdateprotocol/)吗？

如果轮询是一种选择，为什么还要麻烦提要？为什么不让客户轮询资源本身呢？

您能否通过包括完成分析的估计时间来减少不必要的轮询？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T10:42:13.327

使用[HTTP 202 接受](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.2.3)。

此外，请查看[RESTful Web 服务](http://www.crummy.com/writing/RESTful-Web-Services/)- 这是我了解上述内容的地方。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T11:02:23.480

> *   只是忽略幂等性并让 GET 返回当时可用的任何内容（但它仍然留下客户端知道我们何时最终完成的问题）。

随着时间的推移返回不同结果的 GET 真的意味着它不是幂等的吗？[规范](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html)说：

> 方法还可以具有“幂等性”的属性，因为（除了错误或过期问题）N > 0 相同请求的副作用与单个请求相同

也就是说，对 GET 的多次调用可能会返回不同的结果，只要调用本身没有副作用。

在这种情况下，也许您的 REST 方法可以使用条件 GET 和缓存机制来指示何时完成：

*   在分析过程中，`GET {docURI}/metadata`响应可能有：
    *   标题设置为`Expires`未来几秒钟。
    *   没有`ETag`标题。
*   分析完成后，对该资源的响应具有：
    *   没有`Expires`标题。
    *   一个`ETag`。带有 的后续请求`ETag`应该返回`304 Not Modified`。

注意，您可能需要考虑缓存中涉及的其他响应标头，而不仅仅是 Expires。

这种“感觉”就像一个 RESTful 设计——您可以想象一个 Web 浏览器在向该资源发出连续请求时做正确的事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-26T13:38:59.980

You may want to check out [Udi Dahan's](http://www.udidahan.com/2008/07/30/scaling-long-running-web-services/) [nServiceBus](http://www.nservicebus.com/).

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T22:10:28.710

“让 GET 返回当时可用的任何东西”很有意义。除了，当他们进行投票时，你不想继续返回他们已经知道的东西。每次投票时，答案都会变长。

您需要他们在 GET 请求中为您提供他们的“到目前为止我所看到的”。这给了你幂等性。如果他们要求块 1，他们总是得到相同的答案。一旦他们看到了块 1，他们就可以请求块 2。

答案不会变得更大。更多作品可用。“集合级” GET 提供响应的大小。对于每个可用的部分，您都有“详细级别”的 GET。

本质上，这是一种类似于 TCP/IP 确认的算法。当他们确认一块时，您发送下一块。如果有下一篇，否则你发送一个200-nothing new 来报告。

“客户知道我们何时最终完成的问题”是不可估量的。他们不知道，你也无法预测需要多长时间。

您不希望他们“忙于等待”——轮询以查看您是否完成了——这对您的服务器来说是一个相当大的负载。如果他们不耐烦。您可以限制他们的请求。您可以向他们发送“x 秒后返回检查”，其中 x 会逐渐变大。

您甚至可以使用 Unix 风格的调度程序算法，当他们轮询时他们的分数下降，如果他们不轮询 X 秒，他们的分数就会上升。

另一种选择是某种队列，您可以将结果发回给他们。为此，他们必须提供一个 URI，您可以通过 POST 告诉他们您已完成。

或者，他们将 Atom 用于轻量级轮询架构。虽然 Atom 看起来很复杂——它仍然涉及轮询——你提供一个最小的 Atom 答案（“尚未更改”）直到你完成，当你提供（“新结果”）时，他们可以做*真正的*重量级得到。这是全有或全无，而不是上面的增量响应技术。

您还可以将“集合级”GET 视为您在整个流程中的 Atom 状态。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-24T13:05:12.007

一种可能适合也可能不适合您的情况的替代解决方案是添加一个名为“AnnotationRequests”的新端点。将文档（或指向它的链接）发布到 AnnotationRequests 端点，它应该返回一个位置（例如[http://example.org/AnnotationRequest/2042](http://example.org/AnnotationRequest/2042)），这将允许您的客户端轮询进程的状态。当该过程完成时，“AnnotationRequest”表示可以包含到已完成文档的链接。

这样做的一个很好的副作用是您可以在 AnnotationRequests 上执行 GET，以便查看当前正在处理的文档。由您决定要将 AnnotationRequests 保留多长时间。保留完整的历史记录可能很有价值，包括请求的时间、请求的对象和请求的时间，或者可以定期丢弃它们。

# firefox - 在 Firefox 工具栏中保存下拉历史记录

> ID：120170
> 
> 赞同：0
> 
> 时间：2008-09-23T10:06:39.917
> 
> 标签：firefox, xul, toolbar

为了学习，我正在对 Firefox 工具栏进行一些测试，但我找不到有关如何在用户个人资料中存储“搜索”下拉菜单内容的任何信息。

有没有关于如何解决这个问题的教程？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T14:31:27.643

因为要花很多时间才能得到答案，所以我自己去调查了。这就是我现在所拥有的。对我来说并非一切都清楚，但它确实有效。

假设您的 .xul 上有一个像这样的 <textbox> ：

```
<textbox id="search_with_history" /> 
```

您现在必须添加一些其他属性来启用历史记录。

```
<textbox id="search_with_history" type="autocomplete"
    autocompletesearch="form-history"
    autocompletesearchparam="Search-History-Name"
    ontextentered="Search_Change(param);"
    enablehistory="true"
 /> 
```

这为您提供了在该文本框上启用历史记录的最低要求。
出于某种原因，这就是我的无知显示的地方，onTextEntered 事件函数必须有一个名为“param”的参数。我尝试了“事件”，但没有成功。
但仅凭这一点是行不通的。必须添加一些 Javascript 来帮助完成这项工作。

```
// This is the interface to store the history
const HistoryObject = Components.classes["@mozilla.org/satchel/form-history;1"]
    .getService(
        Components.interfaces.nsIFormHistory2 || Components.interfaces.nsIFormHistory
    );
// The above line was broken into 4 for clearness.
// If you encounter problems please use only one line.

// This function is the one called upon the event of pressing <enter>
// on the text box
function Search_Change(event) {
    var terms = document.getElementById('search_with_history').value;
    HistoryObject.addEntry('Search-History-Name', terms);
} 
```

这是让历史继续下去的绝对最低要求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-29T18:58:59.213

Gustavo，我想做同样的事情——我在 Mozilla 支持论坛上找到了[答案](http://support.mozilla.com/tiki-view_forum_thread.php?locale=sk&comments_parentId=193208&forumId=1)。（编辑：我想保存我的搜索历史是出于兴趣，而不是因为我想了解 Firefox 工具栏的工作原理，如你所说。）

基本上，该数据存储在名为 formhistory.sqlite 的 sqlite 数据库文件中（在您的 Firefox 配置文件目录中）。您可以使用 Firefox 扩展 SQLite Manager 来检索和导出数据：[https ://addons.mozilla.org/firefox/addon/5817](https://addons.mozilla.org/firefox/addon/5817)

您可以将其导出为 CSV（逗号分隔值）文件并使用 Excel 或其他软件打开。

如果您对这些数据感兴趣，这还有一个额外的好处，即还可以保存您在网站上的其他表单/字段中输入的数据的历史记录，例如 Google 上的搜索字段等。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-09T20:33:40.957

Gustavo 的解决方案很好，但是*document.getElemenById('search_with_history').value;* 在 getElementById 中缺少一个“t”

# java - 如何在 Lucene 中查询自动完成/建议？

> ID：120180
> 
> 赞同：51
> 
> 时间：2008-09-23T10:12:10.560
> 
> 标签：java, autocomplete, lucene

我正在寻找一种在 Lucene 中进行查询自动完成/建议的方法。我用谷歌搜索了一下，玩了一下，但我看到的所有例子似乎都是在 Solr 中设置过滤器。我们不使用 Solr，也不打算在不久的将来使用 Solr，而且 Solr 显然只是围绕着 Lucene，所以我想一定有办法做到这一点！

我已经研究过使用 EdgeNGramFilter，我意识到我必须在索引字段上运行过滤器并取出标记，然后将它们与输入的查询进行比较......我只是在努力建立联系将两者转换为一些代码，非常感谢您的帮助！

为了清楚我在寻找什么（我意识到我并没有说得太清楚，抱歉） - 我正在寻找一个解决方案，在搜索一个术语时，它会返回一个建议查询的列表。在搜索字段中输入“inter”时，它会返回一个建议查询列表，例如“internet”、“international”等。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-09-23T14:41:51.317

根据@Alexandre Victoor 的回答，我编写了一个基于 contrib 包中的 Lucene Spellchecker 的小类（并使用其中包含的 LuceneDictionary），它完全符合我的要求。

这允许从具有单个字段的单个源索引重新索引，并为术语提供建议。结果按原始索引中与该词条匹配的文档数量排序，因此更流行的词条首先出现。似乎工作得很好:)

```
import java.io.IOException;
import java.io.Reader;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import org.apache.lucene.analysis.Analyzer;
import org.apache.lucene.analysis.ISOLatin1AccentFilter;
import org.apache.lucene.analysis.LowerCaseFilter;
import org.apache.lucene.analysis.StopFilter;
import org.apache.lucene.analysis.TokenStream;
import org.apache.lucene.analysis.ngram.EdgeNGramTokenFilter;
import org.apache.lucene.analysis.ngram.EdgeNGramTokenFilter.Side;
import org.apache.lucene.analysis.standard.StandardFilter;
import org.apache.lucene.analysis.standard.StandardTokenizer;
import org.apache.lucene.document.Document;
import org.apache.lucene.document.Field;
import org.apache.lucene.index.CorruptIndexException;
import org.apache.lucene.index.IndexReader;
import org.apache.lucene.index.IndexWriter;
import org.apache.lucene.index.Term;
import org.apache.lucene.search.IndexSearcher;
import org.apache.lucene.search.Query;
import org.apache.lucene.search.ScoreDoc;
import org.apache.lucene.search.Sort;
import org.apache.lucene.search.TermQuery;
import org.apache.lucene.search.TopDocs;
import org.apache.lucene.search.spell.LuceneDictionary;
import org.apache.lucene.store.Directory;
import org.apache.lucene.store.FSDirectory;

/**
 * Search term auto-completer, works for single terms (so use on the last term
 * of the query).
 * <p>
 * Returns more popular terms first.
 * 
 * @author Mat Mannion, M.Mannion@warwick.ac.uk
 */
public final class Autocompleter {

    private static final String GRAMMED_WORDS_FIELD = "words";

    private static final String SOURCE_WORD_FIELD = "sourceWord";

    private static final String COUNT_FIELD = "count";

    private static final String[] ENGLISH_STOP_WORDS = {
    "a", "an", "and", "are", "as", "at", "be", "but", "by",
    "for", "i", "if", "in", "into", "is",
    "no", "not", "of", "on", "or", "s", "such",
    "t", "that", "the", "their", "then", "there", "these",
    "they", "this", "to", "was", "will", "with"
    };

    private final Directory autoCompleteDirectory;

    private IndexReader autoCompleteReader;

    private IndexSearcher autoCompleteSearcher;

    public Autocompleter(String autoCompleteDir) throws IOException {
        this.autoCompleteDirectory = FSDirectory.getDirectory(autoCompleteDir,
                null);

        reOpenReader();
    }

    public List<String> suggestTermsFor(String term) throws IOException {
        // get the top 5 terms for query
        Query query = new TermQuery(new Term(GRAMMED_WORDS_FIELD, term));
        Sort sort = new Sort(COUNT_FIELD, true);

        TopDocs docs = autoCompleteSearcher.search(query, null, 5, sort);
        List<String> suggestions = new ArrayList<String>();
        for (ScoreDoc doc : docs.scoreDocs) {
            suggestions.add(autoCompleteReader.document(doc.doc).get(
                    SOURCE_WORD_FIELD));
        }

        return suggestions;
    }

    @SuppressWarnings("unchecked")
    public void reIndex(Directory sourceDirectory, String fieldToAutocomplete)
            throws CorruptIndexException, IOException {
        // build a dictionary (from the spell package)
        IndexReader sourceReader = IndexReader.open(sourceDirectory);

        LuceneDictionary dict = new LuceneDictionary(sourceReader,
                fieldToAutocomplete);

        // code from
        // org.apache.lucene.search.spell.SpellChecker.indexDictionary(
        // Dictionary)
        IndexReader.unlock(autoCompleteDirectory);

        // use a custom analyzer so we can do EdgeNGramFiltering
        IndexWriter writer = new IndexWriter(autoCompleteDirectory,
        new Analyzer() {
            public TokenStream tokenStream(String fieldName,
                    Reader reader) {
                TokenStream result = new StandardTokenizer(reader);

                result = new StandardFilter(result);
                result = new LowerCaseFilter(result);
                result = new ISOLatin1AccentFilter(result);
                result = new StopFilter(result,
                    ENGLISH_STOP_WORDS);
                result = new EdgeNGramTokenFilter(
                    result, Side.FRONT,1, 20);

                return result;
            }
        }, true);

        writer.setMergeFactor(300);
        writer.setMaxBufferedDocs(150);

        // go through every word, storing the original word (incl. n-grams) 
        // and the number of times it occurs
        Map<String, Integer> wordsMap = new HashMap<String, Integer>();

        Iterator<String> iter = (Iterator<String>) dict.getWordsIterator();
        while (iter.hasNext()) {
            String word = iter.next();

            int len = word.length();
            if (len < 3) {
                continue; // too short we bail but "too long" is fine...
            }

            if (wordsMap.containsKey(word)) {
                throw new IllegalStateException(
                        "This should never happen in Lucene 2.3.2");
                // wordsMap.put(word, wordsMap.get(word) + 1);
            } else {
                // use the number of documents this word appears in
                wordsMap.put(word, sourceReader.docFreq(new Term(
                        fieldToAutocomplete, word)));
            }
        }

        for (String word : wordsMap.keySet()) {
            // ok index the word
            Document doc = new Document();
            doc.add(new Field(SOURCE_WORD_FIELD, word, Field.Store.YES,
                    Field.Index.UN_TOKENIZED)); // orig term
            doc.add(new Field(GRAMMED_WORDS_FIELD, word, Field.Store.YES,
                    Field.Index.TOKENIZED)); // grammed
            doc.add(new Field(COUNT_FIELD,
                    Integer.toString(wordsMap.get(word)), Field.Store.NO,
                    Field.Index.UN_TOKENIZED)); // count

            writer.addDocument(doc);
        }

        sourceReader.close();

        // close writer
        writer.optimize();
        writer.close();

        // re-open our reader
        reOpenReader();
    }

    private void reOpenReader() throws CorruptIndexException, IOException {
        if (autoCompleteReader == null) {
            autoCompleteReader = IndexReader.open(autoCompleteDirectory);
        } else {
            autoCompleteReader.reopen();
        }

        autoCompleteSearcher = new IndexSearcher(autoCompleteReader);
    }

    public static void main(String[] args) throws Exception {
        Autocompleter autocomplete = new Autocompleter("/index/autocomplete");

        // run this to re-index from the current index, shouldn't need to do
        // this very often
        // autocomplete.reIndex(FSDirectory.getDirectory("/index/live", null),
        // "content");

        String term = "steve";

        System.out.println(autocomplete.suggestTermsFor(term));
        // prints [steve, steven, stevens, stevenson, stevenage]
    }

} 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2012-02-07T20:32:04.840

这是将 Mat 的实现音译为 C# for Lucene.NET，以及使用 jQuery 的自动完成功能连接文本框的片段。

```
<input id="search-input" name="query" placeholder="Search database." type="text" /> 
```

... JQuery 自动完成：

```
// don't navigate away from the field when pressing tab on a selected item
$( "#search-input" ).keydown(function (event) {
    if (event.keyCode === $.ui.keyCode.TAB && $(this).data("autocomplete").menu.active) {
        event.preventDefault();
    }
});

$( "#search-input" ).autocomplete({
    source: '@Url.Action("SuggestTerms")', // <-- ASP.NET MVC Razor syntax
    minLength: 2,
    delay: 500,
    focus: function () {
        // prevent value inserted on focus
        return false;
    },
    select: function (event, ui) {
        var terms = this.value.split(/\s+/);
        terms.pop(); // remove dropdown item
        terms.push(ui.item.value.trim()); // add completed item
        this.value = terms.join(" "); 
        return false;
    },
 }); 
```

...这是 ASP.NET MVC 控制器代码：

```
 //
    // GET: /MyApp/SuggestTerms?term=something
    public JsonResult SuggestTerms(string term)
    {
        if (string.IsNullOrWhiteSpace(term))
            return Json(new string[] {});

        term = term.Split().Last();

        // Fetch suggestions
        string[] suggestions = SearchSvc.SuggestTermsFor(term).ToArray();

        return Json(suggestions, JsonRequestBehavior.AllowGet);
    } 
```

...这是 Mat 在 C# 中的代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using Lucene.Net.Store;
using Lucene.Net.Index;
using Lucene.Net.Search;
using SpellChecker.Net.Search.Spell;
using Lucene.Net.Analysis;
using Lucene.Net.Analysis.Standard;
using Lucene.Net.Analysis.NGram;
using Lucene.Net.Documents;

namespace Cipher.Services
{
    /// <summary>
    /// Search term auto-completer, works for single terms (so use on the last term of the query).
    /// Returns more popular terms first.
    /// <br/>
    /// Author: Mat Mannion, M.Mannion@warwick.ac.uk
    /// <seealso cref="http://stackoverflow.com/questions/120180/how-to-do-query-auto-completion-suggestions-in-lucene"/>
    /// </summary>
    /// 
    public class SearchAutoComplete {

        public int MaxResults { get; set; }

        private class AutoCompleteAnalyzer : Analyzer
        {
            public override TokenStream  TokenStream(string fieldName, System.IO.TextReader reader)
            {
                TokenStream result = new StandardTokenizer(kLuceneVersion, reader);

                result = new StandardFilter(result);
                result = new LowerCaseFilter(result);
                result = new ASCIIFoldingFilter(result);
                result = new StopFilter(false, result, StopFilter.MakeStopSet(kEnglishStopWords));
                result = new EdgeNGramTokenFilter(
                    result, Lucene.Net.Analysis.NGram.EdgeNGramTokenFilter.DEFAULT_SIDE,1, 20);

                return result;
            }
        }

        private static readonly Lucene.Net.Util.Version kLuceneVersion = Lucene.Net.Util.Version.LUCENE_29;

        private static readonly String kGrammedWordsField = "words";

        private static readonly String kSourceWordField = "sourceWord";

        private static readonly String kCountField = "count";

        private static readonly String[] kEnglishStopWords = {
            "a", "an", "and", "are", "as", "at", "be", "but", "by",
            "for", "i", "if", "in", "into", "is",
            "no", "not", "of", "on", "or", "s", "such",
            "t", "that", "the", "their", "then", "there", "these",
            "they", "this", "to", "was", "will", "with"
        };

        private readonly Directory m_directory;

        private IndexReader m_reader;

        private IndexSearcher m_searcher;

        public SearchAutoComplete(string autoCompleteDir) : 
            this(FSDirectory.Open(new System.IO.DirectoryInfo(autoCompleteDir)))
        {
        }

        public SearchAutoComplete(Directory autoCompleteDir, int maxResults = 8) 
        {
            this.m_directory = autoCompleteDir;
            MaxResults = maxResults;

            ReplaceSearcher();
        }

        /// <summary>
        /// Find terms matching the given partial word that appear in the highest number of documents.</summary>
        /// <param name="term">A word or part of a word</param>
        /// <returns>A list of suggested completions</returns>
        public IEnumerable<String> SuggestTermsFor(string term) 
        {
            if (m_searcher == null)
                return new string[] { };

            // get the top terms for query
            Query query = new TermQuery(new Term(kGrammedWordsField, term.ToLower()));
            Sort sort = new Sort(new SortField(kCountField, SortField.INT));

            TopDocs docs = m_searcher.Search(query, null, MaxResults, sort);
            string[] suggestions = docs.ScoreDocs.Select(doc => 
                m_reader.Document(doc.Doc).Get(kSourceWordField)).ToArray();

            return suggestions;
        }

        /// <summary>
        /// Open the index in the given directory and create a new index of word frequency for the 
        /// given index.</summary>
        /// <param name="sourceDirectory">Directory containing the index to count words in.</param>
        /// <param name="fieldToAutocomplete">The field in the index that should be analyzed.</param>
        public void BuildAutoCompleteIndex(Directory sourceDirectory, String fieldToAutocomplete)
        {
            // build a dictionary (from the spell package)
            using (IndexReader sourceReader = IndexReader.Open(sourceDirectory, true))
            {
                LuceneDictionary dict = new LuceneDictionary(sourceReader, fieldToAutocomplete);

                // code from
                // org.apache.lucene.search.spell.SpellChecker.indexDictionary(
                // Dictionary)
                //IndexWriter.Unlock(m_directory);

                // use a custom analyzer so we can do EdgeNGramFiltering
                var analyzer = new AutoCompleteAnalyzer();
                using (var writer = new IndexWriter(m_directory, analyzer, true, IndexWriter.MaxFieldLength.LIMITED))
                {
                    writer.MergeFactor = 300;
                    writer.SetMaxBufferedDocs(150);

                    // go through every word, storing the original word (incl. n-grams) 
                    // and the number of times it occurs
                    foreach (string word in dict)
                    {
                        if (word.Length < 3)
                            continue; // too short we bail but "too long" is fine...

                        // ok index the word
                        // use the number of documents this word appears in
                        int freq = sourceReader.DocFreq(new Term(fieldToAutocomplete, word));
                        var doc = MakeDocument(fieldToAutocomplete, word, freq);

                        writer.AddDocument(doc);
                    }

                    writer.Optimize();
                }

            }

            // re-open our reader
            ReplaceSearcher();
        }

        private static Document MakeDocument(String fieldToAutocomplete, string word, int frequency)
        {
            var doc = new Document();
            doc.Add(new Field(kSourceWordField, word, Field.Store.YES,
                    Field.Index.NOT_ANALYZED)); // orig term
            doc.Add(new Field(kGrammedWordsField, word, Field.Store.YES,
                    Field.Index.ANALYZED)); // grammed
            doc.Add(new Field(kCountField,
                    frequency.ToString(), Field.Store.NO,
                    Field.Index.NOT_ANALYZED)); // count
            return doc;
        }

        private void ReplaceSearcher() 
        {
            if (IndexReader.IndexExists(m_directory))
            {
                if (m_reader == null)
                    m_reader = IndexReader.Open(m_directory, true);
                else
                    m_reader.Reopen();

                m_searcher = new IndexSearcher(m_reader);
            }
            else
            {
                m_searcher = null;
            }
        }

    }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-11-26T06:20:17.627

我的代码基于 lucene 4.2，可以帮到你

```
import java.io.File;
import java.io.IOException;

import org.apache.lucene.analysis.miscellaneous.PerFieldAnalyzerWrapper;
import org.apache.lucene.index.DirectoryReader;
import org.apache.lucene.index.IndexWriterConfig;
import org.apache.lucene.index.IndexWriterConfig.OpenMode;
import org.apache.lucene.search.spell.Dictionary;
import org.apache.lucene.search.spell.LuceneDictionary;
import org.apache.lucene.search.spell.PlainTextDictionary;
import org.apache.lucene.search.spell.SpellChecker;
import org.apache.lucene.store.Directory;
import org.apache.lucene.store.FSDirectory;
import org.apache.lucene.store.IOContext;
import org.apache.lucene.store.RAMDirectory;
import org.apache.lucene.util.Version;
import org.wltea4pinyin.analyzer.lucene.IKAnalyzer4PinYin;

/**
 * 
 * 
 * @author <a href="mailto:liu.gang@renren-inc.com"></a>
 * @version 2013-11-25上午11:13:59
 */
public class LuceneSpellCheckerDemoService {

private static final String INDEX_FILE = "/Users/r/Documents/jar/luke/youtui/index";
private static final String INDEX_FILE_SPELL = "/Users/r/Documents/jar/luke/spell";

private static final String INDEX_FIELD = "app_name_quanpin";

public static void main(String args[]) {

    try {
        //
        PerFieldAnalyzerWrapper wrapper = new PerFieldAnalyzerWrapper(new IKAnalyzer4PinYin(
                true));

        //  read index conf
        IndexWriterConfig conf = new IndexWriterConfig(Version.LUCENE_42, wrapper);
        conf.setOpenMode(OpenMode.CREATE_OR_APPEND);

        // read dictionary
        Directory directory = FSDirectory.open(new File(INDEX_FILE));
        RAMDirectory ramDir = new RAMDirectory(directory, IOContext.READ);
        DirectoryReader indexReader = DirectoryReader.open(ramDir);

        Dictionary dic = new LuceneDictionary(indexReader, INDEX_FIELD);

        SpellChecker sc = new SpellChecker(FSDirectory.open(new File(INDEX_FILE_SPELL)));
        //sc.indexDictionary(new PlainTextDictionary(new File("myfile.txt")), conf, false);
        sc.indexDictionary(dic, conf, true);
        String[] strs = sc.suggestSimilar("zhsiwusdazhanjiangshi", 10);
        for (int i = 0; i < strs.length; i++) {
            System.out.println(strs[i]);
        }
        sc.close();
    } catch (IOException e) {
        e.printStackTrace();
    }
}

} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T11:31:20.463

您可以在“字典”索引上使用**PrefixQuery类。****LuceneDictionary**类也可能会有所帮助。

看看下面链接的这篇文章。它解释了如何实现“您的意思是？”功能。可在现代搜索引擎（如 Google）中使用。您可能不需要文章中描述的那么复杂的东西。但是文章解释了如何使用 Lucene 拼写包。

构建“字典”索引的一种方法是迭代 LuceneDictionary。

希望能帮助到你

[你的意思是：Lucene？（第 1 页）](https://web.archive.org/web/20050811022737/http://today.java.net/pub/a/today/2005/08/09/didyoumean.html)

[你的意思是：Lucene？（第2页）](https://web.archive.org/web/20061103220620/http://today.java.net/pub/a/today/2005/08/09/didyoumean.html%3Fpage%3D2)

[你的意思是：Lucene？（第 3 页）](https://web.archive.org/web/20061103220620/http://today.java.net/pub/a/today/2005/08/09/didyoumean.html%3Fpage%3D3)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-07-11T15:05:11.433

除了上述（非常感谢）帖子回复：c# 转换，如果您使用.NET 3.5，您需要包含 EdgeNGramTokenFilter 的代码 - 或者至少我做了 - 使用 Lucene 2.9.2 - 这个过滤器丢失了据我所知，来自.NET 版本。我不得不去在线查找 2.9.3 中的 .NET 4 版本并移植回来 - 希望这可以让这个过程对某人来说不那么痛苦......

编辑：还请注意 SuggestTermsFor() 函数返回的数组按计数升序排序，您可能希望将其反转以获得列表中最流行的术语

```
using System.IO;
using System.Collections;
using Lucene.Net.Analysis;
using Lucene.Net.Analysis.Tokenattributes;
using Lucene.Net.Util;

namespace Lucene.Net.Analysis.NGram
{

/**
 * Tokenizes the given token into n-grams of given size(s).
 * <p>
 * This {@link TokenFilter} create n-grams from the beginning edge or ending edge of a input token.
 * </p>
 */
public class EdgeNGramTokenFilter : TokenFilter
{
    public static Side DEFAULT_SIDE = Side.FRONT;
    public static int DEFAULT_MAX_GRAM_SIZE = 1;
    public static int DEFAULT_MIN_GRAM_SIZE = 1;

    // Replace this with an enum when the Java 1.5 upgrade is made, the impl will be simplified
    /** Specifies which side of the input the n-gram should be generated from */
    public class Side
    {
        private string label;

        /** Get the n-gram from the front of the input */
        public static Side FRONT = new Side("front");

        /** Get the n-gram from the end of the input */
        public static Side BACK = new Side("back");

        // Private ctor
        private Side(string label) { this.label = label; }

        public string getLabel() { return label; }

        // Get the appropriate Side from a string
        public static Side getSide(string sideName)
        {
            if (FRONT.getLabel().Equals(sideName))
            {
                return FRONT;
            }
            else if (BACK.getLabel().Equals(sideName))
            {
                return BACK;
            }
            return null;
        }
    }

    private int minGram;
    private int maxGram;
    private Side side;
    private char[] curTermBuffer;
    private int curTermLength;
    private int curGramSize;
    private int tokStart;

    private TermAttribute termAtt;
    private OffsetAttribute offsetAtt;

    protected EdgeNGramTokenFilter(TokenStream input) : base(input)
    {
        this.termAtt = (TermAttribute)AddAttribute(typeof(TermAttribute));
        this.offsetAtt = (OffsetAttribute)AddAttribute(typeof(OffsetAttribute));
    }

    /**
     * Creates EdgeNGramTokenFilter that can generate n-grams in the sizes of the given range
     *
     * @param input {@link TokenStream} holding the input to be tokenized
     * @param side the {@link Side} from which to chop off an n-gram
     * @param minGram the smallest n-gram to generate
     * @param maxGram the largest n-gram to generate
     */
    public EdgeNGramTokenFilter(TokenStream input, Side side, int minGram, int maxGram)
        : base(input)
    {

        if (side == null)
        {
            throw new System.ArgumentException("sideLabel must be either front or back");
        }

        if (minGram < 1)
        {
            throw new System.ArgumentException("minGram must be greater than zero");
        }

        if (minGram > maxGram)
        {
            throw new System.ArgumentException("minGram must not be greater than maxGram");
        }

        this.minGram = minGram;
        this.maxGram = maxGram;
        this.side = side;
        this.termAtt = (TermAttribute)AddAttribute(typeof(TermAttribute));
        this.offsetAtt = (OffsetAttribute)AddAttribute(typeof(OffsetAttribute));
    }

    /**
     * Creates EdgeNGramTokenFilter that can generate n-grams in the sizes of the given range
     *
     * @param input {@link TokenStream} holding the input to be tokenized
     * @param sideLabel the name of the {@link Side} from which to chop off an n-gram
     * @param minGram the smallest n-gram to generate
     * @param maxGram the largest n-gram to generate
     */
    public EdgeNGramTokenFilter(TokenStream input, string sideLabel, int minGram, int maxGram)
        : this(input, Side.getSide(sideLabel), minGram, maxGram)
    {

    }

    public override bool IncrementToken()
    {
        while (true)
        {
            if (curTermBuffer == null)
            {
                if (!input.IncrementToken())
                {
                    return false;
                }
                else
                {
                    curTermBuffer = (char[])termAtt.TermBuffer().Clone();
                    curTermLength = termAtt.TermLength();
                    curGramSize = minGram;
                    tokStart = offsetAtt.StartOffset();
                }
            }
            if (curGramSize <= maxGram)
            {
                if (!(curGramSize > curTermLength         // if the remaining input is too short, we can't generate any n-grams
                    || curGramSize > maxGram))
                {       // if we have hit the end of our n-gram size range, quit
                    // grab gramSize chars from front or back
                    int start = side == Side.FRONT ? 0 : curTermLength - curGramSize;
                    int end = start + curGramSize;
                    ClearAttributes();
                    offsetAtt.SetOffset(tokStart + start, tokStart + end);
                    termAtt.SetTermBuffer(curTermBuffer, start, curGramSize);
                    curGramSize++;
                    return true;
                }
            }
            curTermBuffer = null;
        }
    }

    public override  Token Next(Token reusableToken)
    {
        return base.Next(reusableToken);
    }
    public override Token Next()
    {
        return base.Next();
    }
    public override void Reset()
    {
        base.Reset();
        curTermBuffer = null;
    }
}
} 
```

# javascript - XSS 黑名单 - 有人知道合理的黑名单吗？

> ID：120189
> 
> 赞同：2
> 
> 时间：2008-09-23T10:14:11.677
> 
> 标签：javascript, html, security, xss

作为在非常大的代码库中对 XSS 漏洞进行永久修复时减轻主要风险的临时快速修复，我正在寻找一个预先存在的 XSS 预防黑名单，它可以合理地防止 XSS。

最好是一组正则表达式。我知道有很多用于测试和烟雾测试等的备忘单，我正在寻找的是用于阻止攻击的预先调整的正则表达式。

我完全知道最好的方法是[输出转义](https://stackoverflow.com/questions/71328/what-are-the-best-practices-for-avoid-xss-attacks-in-a-php-site#71444)，或者如果您需要用户的一些标记才能使用白名单。但是，随着代码库的大小，我们需要一些快速的东西来减少漏洞的直接影响并提高标准，同时致力于真正的解决方案。

有没有人知道一个好的集合？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T10:19:25.267

我意识到这可能不是您问题的直接答案，但处于类似情况的 ASP.NET 开发人员可能会发现这很有用：

[微软反跨站脚本库 V1.5](http://www.microsoft.com/downloads/details.aspx?FamilyId=EFB9C819-53FF-4F82-BFAF-E11625130C25&displaylang=en)

> 该库与大多数编码库的不同之处在于它使用“包含原则”技术来提供针对 XSS 攻击的保护。这种方法的工作原理是首先定义一组有效或允许的字符，然后对该组之外的任何内容（无效字符或潜在攻击）进行编码。包含方法的原理提供了对XSS攻击的高度保护，适用于对安全性要求较高的Web应用程序。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T10:18:53.240

这是一个：[http](http://ha.ckers.org/xss.html) ://ha.ckers.org/xss.html但我不知道它是否完整。

CAL9000 是另一个列表，您可以在其中找到类似的内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T16:18:24.703

不确定您是否使用 PHP，但如果是，您应该查看[HTMLPurifer](http://htmlpurifier.org/)。使用起来非常简单；`purify()`只需添加对您接受输入或输出的方法的调用。它基于白名单的方法阻止了我测试过的所有 XSS 攻击。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T14:16:53.527

ha.ckers.org/xss.html 上的备忘单并不完整。我的一位同事发现了一两个不在那里。RSnake 确实列出了每个攻击字符串通过的许多正则表达式过滤器。使用一些，您可能会关闭足够的孔。

这将是一个很好的起点。如果不出意外，要知道你需要寻找什么样的东西。

使用它作为开始的地方，并确保您编写的脚本转义了足够的字符，以使您的黑名单遗漏的任何攻击都呈现良性。如果没有浏览器渲染，xss 注入有什么好处？

实际上，在这里大部分情况下都可以逃避足够多的正确角色。将 XSS 注入将每个 < 转换为 a`&lt;`并将 " 转义为`&quot;`.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T10:19:41.023

如果你运行 Apache，你可以使用[mod_security](http://www.modsecurity.org/)来关闭一些漏洞。至少它会为您提供一个工具（[控制台](http://www.modsecurity.org/projects/console/index.html)或普通日志文件）来监控流量并在为时已晚之前做出反应。此外，[gotroot.com](http://gotroot.com/)对 Web 应用程序有一些有趣的规则。

再说一次，我真的不知道你要关闭什么样的洞。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-24T06:06:48.813

你想要的是一个IDS（入侵检测系统）。如果您使用的是 PHP，则有[PHPIDS](http://php-ids.org/)。它由一个优秀的黑客社区维护和测试。他们一直在投入各种各样的东西来改进过滤器，远远超出了 Rsnake 的原始列表。某处还有一个 .NET 端口，不确定它是否仍在维护。

# ruby - 创建和发布您自己的 ruby gem 需要哪些步骤？

> ID：120191
> 
> 赞同：16
> 
> 时间：2008-09-23T10:15:03.780
> 
> 标签：ruby, rubygems

所以你已经创建了一个 ruby​​ 库。

您如何创建和发布您的 ruby​​gem？创建和发布红宝石有哪些常见的陷阱和陷阱？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T18:40:05.237

有几种工具可以帮助您构建自己的 gem。[hoe](http://seattlerb.rubyforge.org/hoe/)和[newgem](http://newgem.rubyforge.org/)是最有名的，并且有很多好的品质。然而，hoe 将自己作为依赖项添加到您的 gem 中，并且 newgem 已成为一个非常大的工具，当我想快速创建和部署 gem 时，我发现它很笨重。

我最喜欢的工具是Tim Pease 的[Mr Bones](http://codeforpeople.rubyforge.org/bones/)。它是轻量级的、功能强大的，并且不会向您的项目添加依赖项。要使用它创建一个项目，您只需`bones <my_project_name>`在命令行上运行，并为您构建一个框架，其中包含一个`lib`代码目录、一个`bin`工具目录和一个测试目录。配置在a`Rakefile`中，简洁明了。这是我几个月前做的一个项目的配置：

```
load 'tasks/setup.rb'

ensure_in_path 'lib'
require 'friend-feed'

task :default => 'test'

PROJ.name = 'friend-feed'
PROJ.authors = 'Clinton R. Nixon'
PROJ.email = 'crnixon@gmail.com'
PROJ.url = 'friend-feed.rubyforge.org'
PROJ.rubyforge_name = 'friend-feed'
PROJ.dependencies = ['json']
PROJ.version = FriendFeed::VERSION
PROJ.exclude = %w(.git pkg) 
```

Mr Bones 具有您所期望的标准功能集：您可以使用它来打包库的 gem 和 tar 文件，以及在 RubyForge 上发布它并在那里部署您的文档。但是，它的杀手级功能是能够将其骨架冻结在您的主目录中。当你运行时`bones --freeze`，一个名为的目录`.mrbones`被复制到你的主目录中。您可以在其中编辑文件，为您的 gem 制作一个按照您的工作方式工作的骨架，从那时起，当您运行骨骼创建新 gem 时，它将使用您的个人 gem 骨架。您可以通过运行解冻骨头先生`bones --unfreeze`，您的骨架将被备份，并且将再次使用默认骨架。

（编者按：几个月前我写了一篇关于此的博客文章，其中大部分内容是从中复制的。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T11:22:09.563

我推荐[github](http://gems.github.com)作为起点，尤其是对于开源项目。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T11:26:46.497

并尝试谷歌搜索......我的第一个搜索结果......

*   [http://www.5dollarwhitebox.org/drupal/creating_a_rubygem_package](http://www.5dollarwhitebox.org/drupal/creating_a_rubygem_package)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-23T11:31:03.630

您可能还想查看 Hoe gem，它可以自动完成 gem 创建过程。

请参阅： http: [//nubyonrails.com/articles/tutorial-publishing-rubygems-with-hoe](http://nubyonrails.com/articles/tutorial-publishing-rubygems-with-hoe)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-27T20:32:43.957

我实际上写了一个关于这个的教程，我是在学习的时候写的。它更专注于我编写的游戏而不是库。此外，它假设您想通过 rake 而不是自己构建 gem：

*   [第 1 部分](http://kuidev.blogspot.com/2008/04/day-89-gemification.html)介绍如何创建 gem。
*   [第 2 部分](http://kuidev.blogspot.com/2008/04/day-90-gemification-2-revenge.html)介绍如何运行 gem 安装的二进制文件并获取资源。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-30T04:30:04.433

hoe 不再像关闭 ruby​​gems 1.2 那样将自身添加为依赖项。它的 rake 任务集中在将 ruby​​gem 部署到 ruby​​forge 上。如果您只是想从 github 提供 gem，我认为有一些新的 hoe-esque rake 任务工具可以提供帮助。

# javascript - 更新 Rails 应用程序的服务器端进度

> ID：120201
> 
> 赞同：4
> 
> 时间：2008-09-23T10:18:34.710
> 
> 标签：javascript, ruby-on-rails, ajax, xmlhttprequest

我想在 Ruby on Rails 应用程序中上传并处理文件。文件上传通常很短，但服务器端处理可能需要一些时间（超过 20 秒），所以我想给用户一些指示 - 比无意义的“处理...”屏幕更好的东西。

我正在尝试在视图中使用以下代码

```
<%= periodically_call_remote(:url => {:action => 'progress_monitor', :controller => 'files'},
                 :frequency => '5',
                 :update => "setProgress('progressBar','5')"
                 ) %> 
```

:update 参数的内容是我想每 5 秒运行一次的 javascript

以下代码在文件控制器中

```
def progress_monitor
  render :text => 'whatever'
end 
```

最终，progress_monitor 方法将以整数形式返回当前进度（完成百分比），并将其传递给“setProgress”JavaScript 代码（将更新屏幕元素）

但是，我正在努力从服务器获得正确的响应，然后将其传递给 JavaScript。

任何人都可以帮忙，还是我以错误的方式接近这个？

对此有一个后续问题，我最初更新了这个问题，但更新与这里的新问题有很大不同，因此需要提出一个新[问题](https://stackoverflow.com/questions/126011/monitoring-a-server-side-process-on-rails-application-using-ajax-xmlhttprequest)。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T10:56:20.360

`periodically_call_remote()`更新一个`div`。它不会调用您的 JavaScript 函数。我不是 JavaScript 专家，但要解决你的问题，你应该自己`xmlhttp`打电话。如果我是你，我会使用原型的 AJAX 请求

[http://www.prototypejs.org/api/ajax/request](http://www.prototypejs.org/api/ajax/request)

并使用 JavaScript 的 settimeout 或 setinterval 进行定期轮询

[http://www.elated.com/articles/javascript-timers-with-settimeout-and-setinterval/](http://www.elated.com/articles/javascript-timers-with-settimeout-and-setinterval/)

希望这会有所帮助因为实际上我也遇到了相同的prb =)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T14:06:47.267

该`:update`选项应该只列出您要更新的 div，而不是您要评估的 Javascript。

Rails 助手对于这种情况仍然非常好，不需要编写太多自定义 JS。如果您希望在返回时执行 JS，一种简单的方法是呈现 RJS 模板。如果你想用纯 HTML 来做，只需渲染一个视图（或部分，或直接从`render`带有进度条 HTML 的方法返回）并将进度条的 div 放在方法的`:update`选项中`periodically_call_remote`。

# linux - Linux/POSIX 中 Windows rand_s 的最佳替代品是什么？

> ID：120206
> 
> 赞同：3
> 
> 时间：2008-09-23T10:19:43.490
> 
> 标签：linux, security, random, cryptography

问题不在于随机性本身（我们有 rand），而在于加密安全的 PRNG。什么可以在 Linux 或理想的 POSIX 上使用？NSS有什么有用的吗？

**澄清**：我知道 /dev/random，但它可能会用完熵池。而且我不确定 /dev/urandom 是否保证在加密上是安全的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T10:26:24.907

使用`/dev/random`（需要用户输入，例如鼠标移动）或`/dev/urandom`. 后者有一个熵池，除非池为空，否则不需要任何用户输入。

您可以像这样从池中读取：

```
char buf[100];
FILE *fp;
if (fp = fopen("/dev/urandom", "r")) {
    fread(&buf, sizeof(char), 100, fp);
    fclose(fp);
} 
```

或类似的东西。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T10:40:00.180

来自[维基百科](http://en.wikipedia.org/wiki/Urandom)（我的斜体）：

/dev/random 的对应物是 /dev/urandom（“解锁”随机源），它重用内部池以产生更多伪随机位。这意味着调用不会阻塞，但输出包含的熵可能比从 /dev/random 中相应读取的少。目的是用作*加密**安全的伪随机数生成器*。这可以用于不太安全的应用程序。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T10:20:26.013

该`/dev/random`设备旨在成为加密安全位的来源。

# virtualization - 虚拟机基准

> ID：120212
> 
> 赞同：2
> 
> 时间：2008-09-23T10:22:07.557
> 
> 标签：virtualization, benchmarking

我目前在 Windows XP SP3 上使用 VMware Server 1.0.7 来测试虚拟机中的软件。

我还尝试过 Microsoft Virtual PC（不记得版本，可能是 2004 或 2007），当时 VMware 的速度要快得多。

我听说过 Parallels 和 VirtualBox，但我没有时间尝试它们。任何人都有一些基准测试它们中的每一个（或其他）有多快？

我在网上搜索了基准，但没有发现任何有用的东西。

我主要在寻找免费软件，但如果它真的比免费软件好，我会为它付费。

此外，如果您正在使用（或知道）一个好的虚拟化软件但没有基准测试，请告诉我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T10:43:50.810

如果您的硬件支持[硬件虚拟化](http://en.wikipedia.org/wiki/X86_virtualization)，例如 AMD 的 AMD-V 或 Intel 的 VT，并且您在计算机和虚拟化软件中启用此功能，您将获得最佳性能。

对于 Microsoft 解决方案，您至少需要 Virtual PC 2007 或 Virtual Server 2005 R2 SP1，或 Windows Server 2008 上的 Hyper-V（我不希望您重建系统只是为了运行 Hyper-V，但我想我' d 提到它）。

主观上我没有注意到 Virtual PC 和 VMware Workstation 的性能有什么区别。我现在使用 VMware，因为它支持 USB 虚拟化，而 Virtual PC 不支持。

您通常还需要在来宾操作系统中安装适当的自定义、虚拟化感知驱动程序，因为标准驱动程序期望与真实硬件通信。在 Virtual PC 和 Server 中，这些被称为 Additions，在 VMware 中它们是 VMware Tools。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T11:59:50.457

根据我对 Parallels 和 VMware（在 PC 上，更广泛地在 Mac 上）的经验，该软件的任何 2 个竞争版本之间的差异通常非常小，并且在下一个版本中经常“反转”。

我从未发现 Parallels 比 VMware 快得多（或慢得多）——这通常是我正在运行的 VM 的状态、主机本身以及我在 VM 中运行的应用程序的情况。如果 VMWare 推出了一个更快的新版本，您可以肯定 Parallels 会在下一个版本中提高其在该领域的性能。

最后我选择了 VMWare Fusion，主要原因是它可以很好地与 PC 上的 VMware Workstation 配合使用。我无法将 Parallels VM 从 Mac 转移到 PC 再返回，这在 VMware 上运行良好。最后，虽然这不是什么大问题，但我很不高兴有时感觉 Parallels 会在没有适当回归测试的情况下发布一个版本 - 你会获得最新版本并发现网络突然莫名其妙地中断，直到他们几天后发布了另一个补丁。我怀疑情况仍然如此，但 VMware 对我来说总是感觉更“可控”和专业。

**我会寻求一种可以在您的 PC 上以稳定方式运行的解决方案，该解决方案与您的其他要求（例如您的同事的平台和您的总体预算）兼容。你可能会浪费你的一生来尝试衡量在任何给定任务中哪个更快！**

另一件事 - 在对性能做出判断之前，值得检查软件随附的文档以及任何论坛等。**例如，根据我的经验，向你的虚拟机扔大量内存（以牺牲主机系统中的免费内存为代价）不会自动使其更快**；最好将 ram 均匀地分开，当然要留意任何推荐的数字。在 VMware 中，这个推荐的数字是一个很好的指南。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-15T22:58:36.077

[Anandtech](http://www.anandtech.com/showdoc.aspx?i=3263&p=1)有一些关于虚拟化的重要信息。尽管它们不是任何基准，但它提供了一个很好的见解，说明为什么进行适当的虚拟化基准如此困难。我不能向您推荐特定的产品，因为它在很大程度上取决于您的要求。

# windows - Windows 2003 标准 IIS 远程管理 - 无法登录

> ID：120226
> 
> 赞同：1
> 
> 时间：2008-09-23T10:26:48.870
> 
> 标签：windows, windows-server-2003

我刚刚安装了 Windows Server 2003 标准版，因此安装了 IIS6（作为标准配置）。我还安装了 Windows 组件，可以从浏览器 ( [https://server:8098/](https://server:8098/) ) 管理 IIS。我遇到的问题是我必须登录到此工具，但服务器管理员 u/name 和 p/word 不允许我登录。

[此工具 ( http://support.microsoft.com/kb/324282](http://support.microsoft.com/kb/324282) )上的 Windows 文档说“提示您输入 Web 服务器上存在的用户名和密码”，但服务器上没有一个标准用户帐户让我进去

谢谢，

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T11:26:16.370

这里有几个想法：

*   查看服务器上的安全日志以获取线索。

*   查看管理站点属性上的“目录安全”选项卡，确保未选中“启用匿名访问”。您将需要使用“集成 Windows 身份验证”或“基本身份验证”。如果您使用基本身份验证，则密码将通过网络 base64 编码发送 - 您将需要使用 SSL 对其进行加密。

*   使用网络工具是否有特定要求？您可以从 Microsoft 下载[适用于 Windows XP 的 Internet Information Services (IIS) 6.0 Manager，](http://www.microsoft.com/DOWNLOADS/details.aspx?familyid=F9C1FB79-C903-4842-9F6C-9DB93643FDB7&displaylang=en)然后从客户端运行它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T10:31:36.767

我现在不太确定，有一段时间没有设置 Win 2003 盒子，但据我记得你必须先激活远程桌面，然后才能使用 RDP 客户端访问服务器。我建议通过 ActiveX RDP 客户端。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T10:54:22.003

服务器是域的一部分吗？它可能默认为域用户名/密码组合，而不是本地用户名/密码。

尝试“server.domain.local\administrator”或“administrator@server.domain.local”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-15T23:19:38.220

这可能不太可能，但您是否尝试使用密码为空的用户名？使用这些帐户时，Windows 会限制远程访问。

如果是这种情况，您可以检查组策略（`gpedit.msc`用于本地计算机，或者如果它在域中，则用于域。）：

```
Computer Configuration
 Windows Settings
  Security Settings
   Local Policies
    Accounts: Limit local account use of blank passwords to console logon only 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-05T06:01:29.930

我会在 IIS 中检查该站点的权限 - 确保您使用的帐户是专门分配权限的组的成员。我了解内置管理员帐户无法正常工作，但站点权限可能已更改，删除了该帐户或组。- 希望这有某种意义

# php - PHP：运行计划作业（cron 作业）

> ID：120228
> 
> 赞同：48
> 
> 时间：2008-09-23T10:27:20.163
> 
> 标签：php, cron, scheduling, scheduled-tasks

我的 webhotel 上有一个网站，我想在上面运行一些计划任务。您会推荐什么方法来实现这一目标？

到目前为止，我的想法是在每个页面的顶部都包含一个脚本，然后让这个脚本检查是否该运行该作业。

这只是我正在考虑的一个简单示例：

```
if ($alreadyDone == 0 && time() > $timeToRunMaintainance) {
   runTask();
   $timeToRunMaintainance = time() + $interval;
} 
```

还有什么我应该考虑的，或者有比这更好的方法吗？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-09-23T10:28:34.357

这就是 cronjobs 的用途。 `man crontab`假设您正在运行 linux 服务器。如果您没有 shell 访问权限或无法设置 cronjobs，则可以使用免费服务在外部服务器上设置 cronjobs 并 ping 您的 URL 之一。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-12-16T14:32:57.867

我现在正在回答这个问题，因为似乎没有人提到这个确切的解决方案。

在我目前正在开发的网站上，我们使用 cPanel 设置了一个 cron 作业，但不是直接运行 PHP 解释器（因为我们使用的是 CodeIgniter 并且我们的代码被映射到控制器函数，这可能不是t 一个好主意）我们正在使用`wget`.

```
wget -q -O cron_job.log http://somehost/controller/method 
```

`-q`这样 wget 就不会产生任何输出（所以你不会一直收到电子邮件）。`-O cron_job.log`会将控制器生成的任何内容保存到日志文件中（每次都被覆盖，因此它不会继续增长）。

我发现这是让 cron 正常工作的最简单方法。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-23T16:36:36.483

如果您有 cPanel 主机，您可以通过 Web 界面添加 cron 作业。转到高级 -> Cron 作业并使用非高级表单设置 cron 频率。你想要这样的命令：

```
/usr/bin/php /path/to/your/php/script.php 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-08-26T11:28:52.413

你看过[ATrigger](http://atrigger.com/)吗？[PHP 库](http://atrigger.com/docs/wiki/14/library-php)也可用于开始创建计划任务而无需任何开销。

免责声明：我在他们的团队中。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-23T10:36:57.147

如果您想知道如何从 cron 实际运行 PHP 脚本，有两种选择：直接调用 PHP 解释器（即“php /foo/myscript.php”），或使用 lynx（lynx [http://mywebsite.php）。 com/myscript.php](http://mywebsite.com/myscript.php)）。您选择哪一个主要取决于您的脚本需要如何配置其环境 - 路径和文件访问权限会有所不同，具体取决于您是通过 shell 还是 Web 浏览器调用它。我建议使用lynx。

一个副作用是每次运行时都会收到一封电子邮件。为了解决这个问题，如果它们成功完成，我让我的 cron PHP 脚本不输出任何内容（并且它必须是任何内容，甚至不是空格），如果它们失败则输出错误消息。然后我使用来自 cron 的一个小型 PHP 脚本调用它们。这样，如果失败，我只会收到一封电子邮件。这与 lynx 方法基本相同，只是我的 shell 脚本发出 HTTP 请求而不是 lynx。

将此脚本称为“docron”或其他名称（记住 chmod +x），然后在您的 crontab 中使用命令：“docron [http://mydomain.com/myscript.php](http://mydomain.com/myscript.php) ”。如果页面返回某些内容，它会将页面的输出作为 HTML 电子邮件通过电子邮件发送给您。

```
#!/usr/bin/php
<?php

$h = @file_get_contents($_SERVER['argv'][1]);

if ($h === false)
{
        $h = "<b>Failed to open file</b>: " . $_SERVER['argv'][1];
}

if ($h != '')
{
        @mail("cron@mydomain.com", $_SERVER['argv']['1'], $h, "From: cron@mydomain.com\nMIME-Version: 1.0\nContent-type: text/html; charset=iso-8859-1");
}

?> 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-11T13:48:12.353

如果您想避免设置 cron 作业等（尽管我建议这是一种更好的方法），那么您提供的解决方案非常好。在许多项目中，我让 PHP 脚本本身进行检查以查看是否该运行更新。

不利的一面（好的，不利的*一面*）是如果在特定时期内没有人使用该应用程序，则脚本将无法运行。

好处是，如果在一段时间内没有人使用该应用程序，则脚本将不会运行。我设置它要做的任务是“更新缓存文件”、“每日备份”等等。如果有人不使用该应用程序，那么您将不需要更新的缓存文件，也不需要任何数据库更改来备份。

我建议对您的方法进行的唯一修改是，您仅在有人成功登录时才运行这些检查。您不需要检查每个页面加载。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2010-06-23T02:28:26.637

Cron 是用于调度问题的通用解决方案。但是当你做大并且日程安排频率很高时，可能会出现可靠性/重叠问题。如果您看到此类问题，请考虑使用[supervise](http://cr.yp.to/daemontools/install.html)或更复杂的[monit](http://mmonit.com/monit/)之类的东西。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-05-26T10:45:31.457

如果你使用 cpanel，你应该像这样添加：

```
/usr/local/bin/php -q /home/yoursite/public_html/yourfile.php 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-03-01T12:05:42.937

如果您不想使用 cronjobs 或任何外部的东西，您使用的方法很好，但是每次加载页面时检查这些方法可能很繁重。

起初，一些 cronjobs 可能会被替换。例如，如果您有一个计数器来记录有多少用户在您的网站上注册，您可以在用户注册时简单地更新此数字，因此您不必为此使用 cronjob 或任何计划任务。

如果你想使用定时任务，我建议你使用你现在正在使用的方法，但稍作修改。如果您的网站一天有足够的点击量，您可以简单地让任务运行（或任务检查功能运行）仅 1% 或 0.01% 的点击量而不是全部，您应该使用的百分比取决于在您拥有的页面点击次数以及您想要运行任务的次数。因此，只需添加一个随机化器即可实现此功能。

您可以简单地使用这样的功能；

```
if(rand (1, 100) <= 1) { // 1, 100 is used to generate a number between 1 and 100\. 1 is for one percent.
    // Run the tasks system
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-06-12T16:03:56.373

我会用 www.guardiano.pm 外包 cronjobs 并每 X 分钟调用一个 url。当您的网址（即 www.yoursite.com/dothis.php）被调用时，您将执行一些代码。如果您不想让网页在您需要时请求页面，您可以只允许在 POST 中请求并发送一些只有您知道的参数，使用 Guardiano.pm

这就是我会做的，因为我在我的宠物项目上这样做。玩得开心！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T16:32:36.587

命令行 PHP + cron 将是我要走的路。这很简单，应该符合要求。它通常与 PHP 一起安装，这是理所当然的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-06-27T22:41:01.637

如果您没有设置 cronjob 的选项，您可以使用 cUrl 调用脚本（作为 wget 的替代 - 相同的功能）。只需在执行 cUrl 功能的本地计算机上执行计划任务。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-08-02T01:17:35.180

如果你想要更抽象的东西，你可以考虑使用 PHP 调度器之类的东西。例如：

*   [https://github.com/lavary/crunz](https://github.com/lavary/crunz)
*   [https://github.com/peppeocchi/php-cron-scheduler](https://github.com/peppeocchi/php-cron-scheduler)

此外，要解析 cron 表达式，您可以使用现有的库，例如[https://github.com/mtdowling/cron-expression](https://github.com/mtdowling/cron-expression)。它提供了许多有用的方法来帮助您找出 cron 作业的信息。

希望有帮助。

# sql-server - SQL Server 2000 的 SQL Profiler 是否有替代方案

> ID：120240
> 
> 赞同：2
> 
> 时间：2008-09-23T10:32:10.557
> 
> 标签：sql-server, sql-server-profiler

我正在尝试优化 SQL Server 2000 数据库上的一些存储过程，当我尝试使用 SQL Profiler 时，我收到一条错误消息“为了对 SQL Server 运行跟踪，您必须是 sysadmin 固定服务器角色的成员。” . 似乎只有 sysadmin 角色的成员才能在服务器上运行跟踪（在 SQL Server 2005 中已修复），而且我无法获得该服务器角色（公司政策）

我现在正在做的是插入当前时间减去程序在代码的各个阶段开始的时间，但我觉得这很乏味

我也在考虑将数据库复制到本地安装的 SQL Server，但存储过程使用来自许多不同数据库的数据，我将花费大量时间在本地复制数据

所以我想知道是否有其他方法来分析 SQL 代码？（第三方工具，不同的做法，别的东西）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T10:35:24.340

在查询分析器中：

```
SET STATISTICS TIME ON

SET STATISTICS IO ON 
```

运行查询并查看消息选项卡。

在我看来，这可能需要相同的权限，但值得一试。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T10:36:22.827

没有探查器，您的手有点束缚。

但是，您可以从使用查询分析器或任何查询工具调整现有查询并检查执行计划开始。通过 QA，您可以使用 Show Execution Plan 选项。从其他工具中，您可以使用

```
SET STATISTICS PROFILE ON / OFF 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-14T18:11:35.673

SQL 2000 上有一个变通方法来混淆 Profiler 连接对话框，以将 sysadmin 连接限制为仅运行跟踪。

[SQL团队](http://www.sqlteam.com/forums/topic.asp?TOPIC_ID=47384)

[博客](http://weblogs.sqlteam.com/tarad/archive/2005/03/21/4271.aspx)

# css - 如何在 SASS 中链接伪选择器

> ID：120244
> 
> 赞同：8
> 
> 时间：2008-09-23T10:34:08.150
> 
> 标签：css, haml, sass

我正在尝试在 SASS 中组合一个选择器，该选择器将对链接的已访问、悬停状态进行操作，但我似乎无法正确标记，有人可以启发我吗？我是这样写的：

```
 &:visited:hover
     attribute: foo 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-08-03T15:30:24.933

```
a
  &:visited:hover
    attribute: foo 
```

如今，这是唯一有效的形式。缩进必须一致（建议使用 2 个空格）并且冒号跟在属性后面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T11:55:14.477

```
a
 &:visited:hover
    :attribute foo 
```

试试看 - 注意标识是两个空格，冒号在属性之前而不是之后。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-03-16T10:27:13.737

非常适合悬停和之前/之后：

```
&:hover {
    color:#FFFFFF;

    &::before {
      color:#FFFFFF;
    }
} 
```

# python - Python中的短整数

> ID：120250
> 
> 赞同：26
> 
> 时间：2008-09-23T10:35:09.880
> 
> 标签：python, memory-management, short

Python 根据底层系统架构自动分配整数。不幸的是，我有一个巨大的数据集，需要完全加载到内存中。

那么，有没有办法强制 Python 只对某些整数使用 2 个字节（相当于 C++ 'short'）？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-23T10:36:44.307

没有。但是您可以在数组中使用短整数：

```
from array import array
a = array("h") # h = signed short, H = unsigned short 
```

只要该值保留在该数组中，它将是一个短整数。

*   [阵列模块](http://docs.python.org/dev/library/array)的文档

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T11:34:37.740

感谢 Armin 指出“数组”模块。我还发现了将 c 风格的结构打包成字符串的“struct”模块：

从文档（[https://docs.python.org/library/struct.html](https://docs.python.org/library/struct.html)）：

```
>>> from struct import *
>>> pack('hhl', 1, 2, 3)
'\x00\x01\x00\x02\x00\x00\x00\x03'
>>> unpack('hhl', '\x00\x01\x00\x02\x00\x00\x00\x03')
(1, 2, 3)
>>> calcsize('hhl')
8 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T11:35:15.227

Armin 对阵列模块的建议可能是最好的。两种可能的选择：

*   您可以自己创建一个扩展模块，以提供您所追求的数据结构。如果它真的只是一些短裤的集合，那么这很容易做到。
*   您可以作弊和操纵位，以便将一个数字存储在 Python int 的下半部分，而将另一个数字存储在上半部分。您将编写一些实用程序函数来在您的数据结构中与这些函数进行转换。丑陋，但它可以工作。

值得一提的是，Python 整数对象不是 4 个字节——还有额外的开销。因此，如果您有大量的短裤，那么您可以通过以某种方式（例如数组模块）使用 C 短裤来为每个号码节省两个以上的字节。

不久前，我不得不在内存中保留大量整数，并且带有整数键和值的字典太大（我有 1GB 可用于数据结构 IIRC）。我改用 IIBTree（来自 ZODB）并设法适应它。（IIBTree 中的整数是真正的 C 整数，而不是 Python 整数，当数字大于 32 位时，我将自动切换到 IOBTree）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2020-02-12T14:43:53.673

您可以将 NumyPy 的 int 用作 np.int8 或 np.int16。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-01-05T21:25:04.373

您还可以将多个任意大小的整数存储在一个大整数中。

例如如下所示，在 64 位 x86 系统上的 python3 中，1024 位占用 164 字节的内存存储。这意味着平均一个字节可以存储大约 6.24 位。如果你使用更大的整数，你可以获得更高的位存储密度。例如，每字节大约 7.50 位，2**20 位宽整数。

显然，您将需要一些包装逻辑来访问存储在较大整数中的各个短数字，这很容易实现。

这种方法的一个问题是您的数据访问会因为使用大整数运算而减慢。

如果您一次访问大量连续存储的整数以最小化对大整数的访问，那么对长整数的较慢访问将不是问题。

我想使用 numpy 会更容易。

```
>>> a = 2**1024
>>> sys.getsizeof(a)
164
>>> 1024/164
6.2439024390243905

>>> a = 2**(2**20)
>>> sys.getsizeof(a)
139836
>>> 2**20 / 139836
7.49861266054521 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-01-06T20:14:01.053

在 python 中使用 bytearray 基本上是一个 C unsigned char 数组，这将是一个比使用大整数更好的解决方案。操作字节数组没有开销，并且与大整数相比，它的存储开销要少得多。使用 bytearrays 可以获得每字节 7.99+ 位的存储密度。

```
>>> import sys
>>> a = bytearray(2**32)
>>> sys.getsizeof(a)
4294967353
>>> 8 * 2**32 / 4294967353
7.999999893829228 
```

# javascript - 检测给定 Javascript 对象是否为 DOM 元素的最佳方法是什么？

> ID：120262
> 
> 赞同：12
> 
> 时间：2008-09-23T10:38:05.020
> 
> 标签：javascript, dom, cross-browser

例如，我正在编写一个旨在接受多种参数类型的函数：

```
var overloaded = function (arg) {
    if (is_dom_element(arg)) {
        // Code for DOM Element argument...
    }
}; 
```

实现**`is_dom_element`**它以跨浏览器、相当准确的方式工作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-23T10:44:25.490

jQuery 检查 nodeType 属性。所以你会有：

```
var overloaded = function (arg) {
    if (arg.nodeType) {
        // Code for DOM Element argument...
    }
}; 
```

尽管这会检测到所有 DOM 对象，而不仅仅是元素。如果你只想要元素，那将是：

```
var overloaded = function (arg) {
    if (arg.nodeType && arg.nodeType == 1) {
        // Code for DOM Element argument...
    }
}; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T10:43:27.783

大概是这个：

```
node instanceof HTMLElement 
```

这应该适用于大多数浏览器。否则你必须鸭式它（例如。`typeof x.nodeType != 'undefined'`）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T11:30:47.093

关于什么

```
obj instanceof HTMLElement 
```

# ruby-on-rails - 存储数据库中引用的常量的最佳方法？

> ID：120266
> 
> 赞同：7
> 
> 时间：2008-09-23T10:39:20.290
> 
> 标签：ruby-on-rails, ruby

在我的数据库中，我有一个模型，该模型具有应从选项列表之一中选择的字段。例如，考虑需要存储测量值的模型，例如 5 英尺或 13 厘米或 12.24 立方米。实现这一点的明显方法是有一个小数字段，然后有一些其他字段来存储测量单位。

那么存储测量单位的最佳方法是什么？我过去使用了几种方法：

1）将各种选项存储在另一个数据库表（和关联模型）中，并将两者与标准外键链接（通常急切加载关联模型）。这似乎有点矫枉过正，因为您正在强制数据库对每个查询执行连接。

2) 将选项存储为常量哈希，加载到初始化器之一中，其中哈希的键存储在度量单位字段中。这样，您可以有效地在 Ruby 中进行连接（这可能会或可能不会提高性能），但是您失去了从“度量单位”方面进行查询的能力。如果您不太可能需要执行诸如“查找所有以厘米为单位的测量值”之类的查询，这将不是问题。

这些对我来说都不是特别优雅..有人可以提出更好的建议吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T11:57:55.187

你见过[constant_cache](http://github.com/vigetlabs/constant_cache/tree/master)吗？它是 1 和 2 的最佳组合 - 查找数据存储在数据库中，但它在查找模型上作为类常量公开，并且仅在应用程序启动时加载，因此您不会经常遭受连接惩罚。以下示例来自自述文件：

移民：

```
create_table :account_statuses do |t|
  t.string :name, :description
end

AccountStatus.create!(:name => 'Active',   :description => 'Active user account')
AccountStatus.create!(:name => 'Pending',  :description => 'Pending user account')
AccountStatus.create!(:name => 'Disabled', :description => 'Disabled user account') 
```

模型：

```
class AccountStatus < ActiveRecord::Base
  caches_constants
end 
```

使用它：

```
Account.new(:username => 'preagan', :status => AccountStatus::PENDING) 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T10:44:42.837

我会选择选项一。UnitOfMeasurement 表有多大？而且，如果使用整数主键，你为什么这么担心速度？

出于设计原因，选项 1 是可行的方法。只需使用整数（甚至 smallint）主键和单元描述字段来声明它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T10:56:23.930

ActiveRecord 是否获得了对自然键的支持？如果有，您可以`name`将表的（或其他）列设置为`UnitOfMeasure`PK，这样 FK 列的值就具有您需要的所有信息，并且您仍然拥有具有一组规范`UnitOfMeasurement`值的完全规范化的数据库。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T11:06:48.417

您是否需要对这些值执行查找？如果没有，您也可以将它们存储为字符串，稍后在读取值的应用程序中解析字符串。虽然您冒着存储不可解析数据的风险，但您可以提高速度并降低数据库复杂性。有时规范化数据库没有帮助。最后 /something/ 在您的系统中需要知道“cm”是长度度量，“m3”是房间度量，并且将“3cm”与“1m3”进行比较无论如何都没有任何意义。因此，您也可以将所有这些知识放入代码中。

假设您无论如何都只会显示该数据，那么规范化在这里有什么好处？

# java - 如何测量距离并根据 Java 中的两个纬度+经度点创建边界框？

> ID：120283
> 
> 赞同：76
> 
> 时间：2008-09-23T10:45:35.987
> 
> 标签：java, geocoding, latitude-longitude

我想找到两个不同点之间的距离。我知道这可以通过大圆距来完成。 [http://www.meridianworlddata.com/Distance-calculation.asp](http://www.meridianworlddata.com/Distance-calculation.asp)

完成后，有了一个点和距离，我想找到那个距离北方和东方那个距离的点，以便在该点周围创建一个框。

* * *

## 回答 #1

> 赞同：154
> 
> 时间：2008-09-23T19:42:23.900

这是[Haversine](http://en.wikipedia.org/wiki/Haversine_formula)公式的Java实现。我在一个项目中使用它来计算纬度/经度之间的英里距离。

```
public static double distFrom(double lat1, double lng1, double lat2, double lng2) {
    double earthRadius = 3958.75; // miles (or 6371.0 kilometers)
    double dLat = Math.toRadians(lat2-lat1);
    double dLng = Math.toRadians(lng2-lng1);
    double sindLat = Math.sin(dLat / 2);
    double sindLng = Math.sin(dLng / 2);
    double a = Math.pow(sindLat, 2) + Math.pow(sindLng, 2)
            * Math.cos(Math.toRadians(lat1)) * Math.cos(Math.toRadians(lat2));
    double c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    double dist = earthRadius * c;

    return dist;
    } 
```

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2010-10-28T23:17:35.683

或者您可以使用[SimpleLatLng](https://github.com/JavadocMD/simplelatlng)。Apache 2.0 在我知道的一个生产系统中获得许可和使用：我的。

短篇故事：

我正在寻找一个简单的地理图书馆，但找不到适合我的需要。谁愿意在每个应用程序中一遍又一遍地编写、测试和调试这些小地理工具？一定有更好的办法！

所以 SimpleLatLng 的诞生是作为一种存储经纬度数据、进行距离计算和创建形状边界的方法。

我知道我已经晚了两年来帮助原始发布者，但我的目标是帮助像我这样在搜索中找到这个问题的人。我希望有人使用它并为这个轻量级实用程序的测试和愿景做出贡献。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2008-09-23T11:16:52.430

我们在使用[OpenMap](http://openmap-java.org/)绘制大量位置数据方面取得了一些成功。有一个[LatLonPoint](http://openmap-java.org/api/com/bbn/openmap/proj/coords/LatLonPoint.html)类具有一些基本功能，包括距离。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2012-03-22T12:43:28.593

要获得更准确的距离（0.5 毫米），您还可以使用 Vincenty 近似值：

```
/**
 * Calculates geodetic distance between two points specified by latitude/longitude using Vincenty inverse formula
 * for ellipsoids
 * 
 * @param lat1
 *            first point latitude in decimal degrees
 * @param lon1
 *            first point longitude in decimal degrees
 * @param lat2
 *            second point latitude in decimal degrees
 * @param lon2
 *            second point longitude in decimal degrees
 * @returns distance in meters between points with 5.10<sup>-4</sup> precision
 * @see <a href="http://www.movable-type.co.uk/scripts/latlong-vincenty.html">Originally posted here</a>
 */
public static double distVincenty(double lat1, double lon1, double lat2, double lon2) {
    double a = 6378137, b = 6356752.314245, f = 1 / 298.257223563; // WGS-84 ellipsoid params
    double L = Math.toRadians(lon2 - lon1);
    double U1 = Math.atan((1 - f) * Math.tan(Math.toRadians(lat1)));
    double U2 = Math.atan((1 - f) * Math.tan(Math.toRadians(lat2)));
    double sinU1 = Math.sin(U1), cosU1 = Math.cos(U1);
    double sinU2 = Math.sin(U2), cosU2 = Math.cos(U2);

    double sinLambda, cosLambda, sinSigma, cosSigma, sigma, sinAlpha, cosSqAlpha, cos2SigmaM;
    double lambda = L, lambdaP, iterLimit = 100;
    do {
        sinLambda = Math.sin(lambda);
        cosLambda = Math.cos(lambda);
        sinSigma = Math.sqrt((cosU2 * sinLambda) * (cosU2 * sinLambda)
                + (cosU1 * sinU2 - sinU1 * cosU2 * cosLambda) * (cosU1 * sinU2 - sinU1 * cosU2 * cosLambda));
        if (sinSigma == 0)
            return 0; // co-incident points
        cosSigma = sinU1 * sinU2 + cosU1 * cosU2 * cosLambda;
        sigma = Math.atan2(sinSigma, cosSigma);
        sinAlpha = cosU1 * cosU2 * sinLambda / sinSigma;
        cosSqAlpha = 1 - sinAlpha * sinAlpha;
        cos2SigmaM = cosSigma - 2 * sinU1 * sinU2 / cosSqAlpha;
        if (Double.isNaN(cos2SigmaM))
            cos2SigmaM = 0; // equatorial line: cosSqAlpha=0 (§6)
        double C = f / 16 * cosSqAlpha * (4 + f * (4 - 3 * cosSqAlpha));
        lambdaP = lambda;
        lambda = L + (1 - C) * f * sinAlpha
                * (sigma + C * sinSigma * (cos2SigmaM + C * cosSigma * (-1 + 2 * cos2SigmaM * cos2SigmaM)));
    } while (Math.abs(lambda - lambdaP) > 1e-12 && --iterLimit > 0);

    if (iterLimit == 0)
        return Double.NaN; // formula failed to converge

    double uSq = cosSqAlpha * (a * a - b * b) / (b * b);
    double A = 1 + uSq / 16384 * (4096 + uSq * (-768 + uSq * (320 - 175 * uSq)));
    double B = uSq / 1024 * (256 + uSq * (-128 + uSq * (74 - 47 * uSq)));
    double deltaSigma = B
            * sinSigma
            * (cos2SigmaM + B
                    / 4
                    * (cosSigma * (-1 + 2 * cos2SigmaM * cos2SigmaM) - B / 6 * cos2SigmaM
                            * (-3 + 4 * sinSigma * sinSigma) * (-3 + 4 * cos2SigmaM * cos2SigmaM)));
    double dist = b * A * (sigma - deltaSigma);

    return dist;
} 
```

此代码自由改编自[http://www.movable-type.co.uk/scripts/latlong-vincenty.html](http://www.movable-type.co.uk/scripts/latlong-vincenty.html)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-08-23T23:20:38.030

更正了Haversine距离公式....

```
public static double HaverSineDistance(double lat1, double lng1, double lat2, double lng2) 
{
    // mHager 08-12-2012
    // http://en.wikipedia.org/wiki/Haversine_formula
    // Implementation

    // convert to radians
    lat1 = Math.toRadians(lat1);
    lng1 = Math.toRadians(lng1);
    lat2 = Math.toRadians(lat2);
    lng2 = Math.toRadians(lng2);

    double dlon = lng2 - lng1;
    double dlat = lat2 - lat1;

    double a = Math.pow((Math.sin(dlat/2)),2) + Math.cos(lat1) * Math.cos(lat2) * Math.pow(Math.sin(dlon/2),2);

    double c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

    return EARTH_RADIUS * c;
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-04-07T13:14:34.193

[http://www.movable-type.co.uk/scripts/latlong.html](http://www.movable-type.co.uk/scripts/latlong.html)

```
public static Double distanceBetweenTwoLocationsInKm(Double latitudeOne, Double longitudeOne, Double latitudeTwo, Double longitudeTwo) {
        if (latitudeOne == null || latitudeTwo == null || longitudeOne == null || longitudeTwo == null) {
            return null;
        }

        Double earthRadius = 6371.0;
        Double diffBetweenLatitudeRadians = Math.toRadians(latitudeTwo - latitudeOne);
        Double diffBetweenLongitudeRadians = Math.toRadians(longitudeTwo - longitudeOne);
        Double latitudeOneInRadians = Math.toRadians(latitudeOne);
        Double latitudeTwoInRadians = Math.toRadians(latitudeTwo);
        Double a = Math.sin(diffBetweenLatitudeRadians / 2) * Math.sin(diffBetweenLatitudeRadians / 2) + Math.cos(latitudeOneInRadians) * Math.cos(latitudeTwoInRadians) * Math.sin(diffBetweenLongitudeRadians / 2)
                * Math.sin(diffBetweenLongitudeRadians / 2);
        Double c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
        return (earthRadius * c);
    } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-12-12T01:27:21.367

您可以使用[Java Geodesy Library for GPS](http://www.gavaghan.org/blog/free-source-code/geodesy-library-vincentys-formula-java/)，它使用考虑了地球表面曲率的文[森蒂公式。](http://en.wikipedia.org/wiki/Vincenty%27s_formulae)

实现是这样的：

```
import org.gavaghan.geodesy.*;
...
GeodeticCalculator geoCalc = new GeodeticCalculator();
Ellipsoid reference = Ellipsoid.WGS84;
GlobalPosition pointA = new GlobalPosition(latitude, longitude, 0.0);
GlobalPosition userPos = new GlobalPosition(userLat, userLon, 0.0);
double distance = geoCalc.calculateGeodeticCurve(reference, userPos, pointA).getEllipsoidalDistance(); 
```

结果距离以米为单位。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-06-20T06:02:38.703

我知道有很多答案，但是在对这个主题做一些研究时，我发现这里的大多数答案都使用了Haversine公式，但Vincenty公式实际上更准确。有一篇文章改编自 Javascript 版本的计算，但它非常笨拙。我找到了一个更好的版本，因为：

1.  它也有一个开放的许可证。
2.  它使用 OOP 原则。
3.  选择要使用的椭球体具有更大的灵活性。
4.  它有更多的方法可以在未来进行不同的计算。
5.  这是有据可查的。

[文森蒂距离计算器](https://lucene.apache.org/core/5_5_2/spatial/org/apache/lucene/spatial/util/GeoDistanceUtils.html)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-07-24T13:53:33.230

此方法将帮助您找到以公里为单位的地理位置之间的距离。

```
private double getDist(double lat1, double lon1, double lat2, double lon2)
{
    int R = 6373; // radius of the earth in kilometres
    double lat1rad = Math.toRadians(lat1);
    double lat2rad = Math.toRadians(lat2);
    double deltaLat = Math.toRadians(lat2-lat1);
    double deltaLon = Math.toRadians(lon2-lon1);

    double a = Math.sin(deltaLat/2) * Math.sin(deltaLat/2) +
            Math.cos(lat1rad) * Math.cos(lat2rad) *
            Math.sin(deltaLon/2) * Math.sin(deltaLon/2);
    double c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));

    double d = R * c;
    return d;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-08-04T10:59:42.987

Kotlin 版本的 Haversine 公式。返回结果以米为单位。[在https://www.vcalc.com/wiki/vCalc/Haversine+-+Distance](https://www.vcalc.com/wiki/vCalc/Haversine+-+Distance)上测试

```
const val EARTH_RADIUS_IN_METERS = 6371007.177356707

fun distance(lat1: Double, lng1: Double, lat2: Double, lng2: Double): Double {
    val latDiff = Math.toRadians(abs(lat2 - lat1))
    val lngDiff = Math.toRadians(abs(lng2 - lng1))
    val a = sin(latDiff / 2) * sin(latDiff / 2) +
        cos(Math.toRadians(lat1)) * cos(Math.toRadians(lat2)) *
        sin(lngDiff / 2) * sin(lngDiff / 2)
    val c = 2 * atan2(sqrt(a), sqrt(1 - a))
    return EARTH_RADIUS_IN_METERS * c
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-09-13T12:43:25.693

我通常将 MATLAB 与[Mapping Toolbox](http://www.mathworks.com/products/mapping/)一起使用，然后使用[MATLAB Builder JA 在我的 Java 中使用代码。](http://www.mathworks.com/discovery/java-math.html)它让我的生活变得简单多了。鉴于大多数学校都有免费的学生访问权限，您可以尝试一下（或获取试用版以完成您的工作）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2018-11-30T14:20:09.597

对于 Android，有一个简单的方法。

```
 public static float getDistanceInMeter(LatLng start, LatLng end) { 
    float[] results = new float[1];
    Location.distanceBetween(start.latitude, start.longitude, end.latitude, end.longitude, results);
    return results[0];

} 
```

;

[https://developer.android.com/reference/android/location/Location#distanceBetween(lat1,lng1,lat2,lng2,output[])](https://developer.android.com/reference/android/location/Location#distanceBetween(double,%20double,%20double,%20double,%20float[]))

# c++ - 什么是 sqlite 的好的 OO C++ 包装器

> ID：120295
> 
> 赞同：66
> 
> 时间：2008-09-23T10:49:21.997
> 
> 标签：c++, database, sqlite

我想为 sqlite 找到一个好的面向对象的 C++（而不是 C）包装器。人们推荐什么？如果您有几个建议，请将它们放在单独的回复中以供投票。另外，请说明您是否对建议的包装器有任何经验，以及您是如何使用它的。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2010-10-12T13:26:34.697

这真的是在邀请反对票，但是这里......

我直接从 C++ 使用 sqlite，并没有看到任何添加 C++ 抽象层的价值。就这样，它非常好（而且效率很高）。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2014-05-14T19:37:53.557

我阅读了这篇文章并尝试了答案中提到的一些库，
但它们对我来说都不够简单（我是一个懒惰的程序员！）。

所以我写了自己的包装器：[sqlite modern cpp](https://github.com/keramer/sqlite_modern_cpp)

```
database db("dbfile.db");
// executes the query and creates a 'user' table if not exists
db << "create table if not exists user ("
      "   age int,"
      "   name text,"
      "   weight real"
      ");";
// inserts a new user and binds the values to '?' marks
db << "insert into user (age,name,weight) values (?,?,?);"
        << 20
        << "bob"
        << 83.0;
// slects from table user on a condition ( age > 18 ) and executes 
// the lambda for every row returned .
db << "select age,name,weight from user where age > ? ;"
   << 18
   >> [&](int age, string name, double weight) {
       cout << age << ' ' << name << ' ' << weight << endl;
   };
// selects the count(*) of table user
int count = 0;
db << "select count(*) from user" >> count; 
```

玩得开心 ！

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-09-23T13:02:06.500

C++ 中数据库的另一个很好的包装器是[SOCI](http://soci.sourceforge.net/)。它不是很 OO，而是更现代的 C++。

它支持 Oracle、PostgreSQL 和 MySQL。[SQLite 后端位于 CVS](http://soci.cvs.sourceforge.net/soci/src/backends/sqlite3/)中。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2011-06-24T13:50:59.270

这是有一段时间没有更新的，但可以在 Mac OS GCC 4.3 上编译和运行。它也是在 MIT 许可下发布的，所以你可以在商业项目中使用它，没有问题。 [http://code.google.com/p/sqlite3pp/](http://code.google.com/p/sqlite3pp/)

用法是增强的并且非常干净：

```
sqlite3pp::database db("test.db");
sqlite3pp::transaction xct(db);
{
    sqlite3pp::command cmd(db, "INSERT INTO contacts (name, phone) VALUES (:user, :phone)");
    cmd.bind(":user", "Mike");
    cmd.bind(":phone", "555-1234");
    cmd.execute();
}
xct.rollback(); 
```

请参阅：[http ://code.google.com/p/sqlite3pp/wiki/UsagePage](http://code.google.com/p/sqlite3pp/wiki/UsagePage)

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-11-09T12:45:40.083

使用 Qt - 它对 SQLite 有很好的绑定，非常适合其整体设计

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2013-04-09T14:34:30.757

我也对我能找到的东西不满意。现在你可以写：

```
class Person {
public:
    Person() {}
    static SqlTable<Person>& table() {
        static SqlTable<Person> tab = SqlTable<Person>::sqlTable("Person",
            SqlColumn<Person>("Firstname",  makeAttr(&Person::firstname)),
            SqlColumn<Person>("Lastname",   makeAttr(&Person::lastname)),
            SqlColumn<Person>("Age",        makeAttr(&Person::age)),
        return tab;
    }
    std::string firstname;
    std::string lastname;
    int age;
};

SqliteDB db("testtable.db");
auto sel(db.select<Person>("Firstname=\"Danny\" and Lastname=\"Zeckzer\""));
std::for_each(sel.first, sel.second, [](const Person& p) {
...
Person me;
db.insert<Person>(me);
...
std::vector<Person> everybody;
db.insert<Person>(everybody.begin(), everybody.end()); 
```

只要您坚持使用 sqlite3 数据类型，您就需要编写 table 方法。因为一切都是模板，所以在 -O 之后没有多少抽象层代码。自然连接需要一个类似于 Person 类的结果类。该实现是一个少于 500 行的单个标题。许可证是 LGPL。[资源](https://github.com/burner/sweet.hpp/blob/master/sweetql.hpp)

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2014-07-24T07:50:17.220

每个人都对使用什么给出了很好的建议：我会告诉你什么仪器**不**使用。

[精简版 SQL](http://sourceforge.net/projects/litesql/)。

我的经历很糟糕。
我只是在研究什么 orm 使用，我正在测试很多。

缺点：

*   没有文件
*   没有解释性自述文件
*   没有先决条件的解释
*   由于很多[错误](http://sourceforge.net/p/litesql/bugs/36/?limit=25)而无法编译（不是真的，在 v0.3.17 中没有修复）

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-10-12T13:19:43.137

我对我能找到的任何东西都不满意，所以我自己写了：[sqlite3cc](http://www.waxworlds.org/edam/software/sqlite3cc)。

这是一个代码示例：

```
sqlite::connection db( filename );

sqlite::command c( db, "UPDATE foo SET bar = ? WHERE name = ?" );
c << 123 << name << sqlite::exec;

sqlite::query q( db, "SELECT foo FROM bar" );
for( sqlite::query::iterator i = q.begin(); i != q.end(); i++ )
    std::cout << i->column< std::string >( 0 ) << "\n"; 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-23T10:56:59.563

我已经使用了这个[http://www.codeproject.com/KB/database/CppSQLite.aspx](http://www.codeproject.com/KB/database/CppSQLite.aspx)但我已经转移到 C#，所以现在可能有更新/更好的

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-12-23T00:12:57.750

[http://www.codeproject.com/KB/database/CppSQLite.aspx](http://www.codeproject.com/KB/database/CppSQLite.aspx)太棒了，它很容易移植，我在半小时左右就让它在 bcb5 (omg) 上运行。它尽可能薄并且易于理解。有大量示例涵盖了您需要了解的几乎所有内容。它使用异常来处理错误——我对其进行了修改以在几分钟内提供返回码。唯一棘手的问题是创建自己的 lib 文件，但没有提供。

```
try
{

    CppSQLite3DB db;

    db.open(asFileName.c_str());

    db.execDML("Update data set hrx = 0");

} // try

catch (...)
{

} // catch 
```

没有比这更简单的了......

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2013-09-15T19:19:16.407

另一个简单的是[NLDatabase](https://github.com/catnapgames/NLDatabase)。免责声明：我是作者。基本用法（老实说，你不会从这个中得到比“基本”更多的东西）看起来像这样：

```
#include "NLDatabase.h"

using namespace std;
using namespace NL::DB;

int main(int argc, const char * argv[]) {

    Database db( "test.sqlite" );

    auto results = db.query("SELECT * FROM test WHERE name <> ?").select("TOM");

    for ( auto const & row : results ) {
        cout << "column[0]=" << row.column_string( 0 ) << endl;
    }
} 
```

只是为了好玩，打开一个数据库，运行一个查询并在一行中获取结果：

```
for ( auto & row : Database( "test.sqlite" ).query( "SELECT * FROM test").select() ) {
    cout << row.column_string( 0 ) << endl;
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2014-05-25T11:44:34.287

由于我们公司的需要，我做了一个。 [https://www.github.com/rubdos/libsqlitepp](https://www.github.com/rubdos/libsqlitepp) 它是 C++11，只有标题。只需将标题放入您的项目中，包含它并链接到 C sqlite 库。

示例也应该在那个 git repo 的某个地方，相当容易使用。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-05-04T19:29:48.077

也许你可以看看

[http://pocoproject.org](http://pocoproject.org/)

或者

[白金 C++ 框架](http://pt-framework.sourceforge.net/)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-04-21T01:56:35.640

[Oracle/OCI/ODBC Template Library](http://otl.sourceforge.net/)

# linux - 在 Linux 中使用 Ctrl-Alt-F6，但无法恢复我的屏幕

> ID：120296
> 
> 赞同：18
> 
> 时间：2008-09-23T10:49:31.453
> 
> 标签：linux, console

这显然是一个愚蠢的问题。我在 Mac 和 Linux 上都在 Eclipse 中编码，但我混淆并使用 Mac 快捷方式来切换窗口选项卡（`Ctrl`- `Cmd`- `F6`），但我在 uni 上使用 Linux 并且屏幕变黑了。我以前做过，但这次我无法回到我的桌面。`Ctrl`- `Alt` `F1`-`F6`给我不同的终端，`F7`给我一个黑屏和`F8`左上角闪烁的下划线。我的会话不应该在某个地方`F1`-`F6`它是否丢失了？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-23T10:54:22.830

`Ctrl`- `Alt`-`F7`也许你的X已经崩溃了？

我只是做了你所做的事情并`F7`为我取回了它，说在我记得 X 崩溃之前我有同样的黑屏

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-23T11:12:27.013

X 可能仍在运行`F7`，您的显示驱动程序（或其他东西）只是行为不端。您可以通过`F7`盲目地打开终端并使用 xset ($ *xset dpms force on* ) 来欺骗它重新启动。或者你可以`ctrl`- `alt`-`backspace`杀死 X 并且 GDM 应该重新启动它。

尝试查看是否可以重复该问题，然后提交错误报告（或让实验室管理员知道它是否不是您的计算机）。它可能与您的发行版的内核配置/补丁有关。我以前在 Ubuntu 上发生过这种情况，但没有任何其他发行版（我使用过很多），这就是为什么我假设它可能是特定于发行版的问题。可能是一些内核补丁的意外后果。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2017-07-11T04:53:29.773

我遇到过同样的问题。我尝试同时点击 ctl+ alt + F1。它奏效了

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-23T11:18:39.493

`ctrl`++ ( `alt`x = 1..6 `Fx`) 组合键通常允许您在控制台上拥有多达 6 个并发终端会话。通常设置为使用 X 窗口，并且因发行版而异。通常它在`Ctrl`++`Alt`上`F7`。

[http://linux.about.com/od/linux101/l/blnewbie5_1.htm](http://linux.about.com/od/linux101/l/blnewbie5_1.htm)

某些 Linux 发行版允许您使用`Ctrl`++`Alt`终止X Windows 会话`Backspace`，此时操作系统将尝试重新启动它。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-23T18:28:28.917

以后，您可以进入终端并输入：

```
init 3 
```

使系统进入文本模式，并且：

```
init 5 
```

使系统返回 X 模式。这样做的好处是一切都应该关闭并干净地重新启动。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2020-04-24T06:18:19.760

```
alt + F1 
```

适用于 ubuntu 18.04。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-03-25T14:10:45.390

对于我的情况。我试着打

> Ctrl+Alt+F2

一起。它在 Fedora 中工作

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T10:52:51.180

尝试`Ctrl`- `Alt`-`F9`和`Ctrl`- `Alt`- `F10`。:-)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-23T11:11:41.227

看起来X崩溃了。要检查，您可以登录其中一个终端（在`Ctrl`+`F1`等）上并检查“X”进程是否仍在运行。

我最近也遇到了同样的情况，后来在 /var/log/Xorg.0.log 中找到了 SIGSEGV 和回溯。诅咒您的图形驱动程序供应商（通常），然后重新启动。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T11:23:33.647

我们在 Red Hat 5 上运行 gnome。其他终端之一中的 ps axu 显示一些进程仍在运行。可能与显示驱动程序有关。做了`ctrl`- `alt`-`backspace`并重新启动它。谢谢您的帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-12-14T15:01:40.160

F8 解决 Linux Mint 17.3 Rosa 中的问题

# c# - 在 C# 的即时窗口中删除变量

> ID：120315
> 
> 赞同：7
> 
> 时间：2008-09-23T10:55:27.333
> 
> 标签：c#

一旦我在 C# (VS2008) 的即时窗口中创建了一个变量，有没有办法删除它，以便我可以创建一个名称相同但类型不同的新变量？除了重新启动程序之外。

原因是要保持直接窗口的命名空间干净，因为一旦变量声明滚出窗口的可见部分，就很难跟踪它们。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T11:42:22.683

我认为不可能按照您的要求进行操作。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T14:18:11.357

您可以制作一个字典来保存您的即时窗口“变量”。然后，您可以在完成后从字典中删除项目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T11:50:08.030

如果你只想保持命名空间干净，你可以使用 object 而不是你为变量声明的类型？但是，不知道有没有办法清除它们！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-25T07:47:19.603

您可以执行类似于以下的操作：

```
public void LolFunction() {
    {
        int main = 0;
        Console.Writeline(main);
    }
    {
        string main = "Roflstring";
        Console.Writeline(main);
    }
} 
```

# php - 如何对 UTF-8 字符串数组进行排序？

> ID：120334
> 
> 赞同：26
> 
> 时间：2008-09-23T11:01:24.527
> 
> 标签：php, arrays, sorting, utf-8

我目前不知道如何在 PHP 中对包含 UTF-8 编码字符串的数组进行排序。该数组来自 LDAP 服务器，因此通过数据库进行排序（没问题）不是解决方案。以下不适用于我的 Windows 开发机器（尽管我认为这至少应该是一个可能的解决方案）：

```
$array=array('Birnen', 'Äpfel', 'Ungetüme', 'Apfel', 'Ungetiere', 'Österreich');
$oldLocal=setlocale(LC_COLLATE, "0");
var_dump(setlocale(LC_COLLATE, 'German_Germany.65001'));
usort($array, 'strcoll');
var_dump(setlocale(LC_COLLATE, $oldLocal));
var_dump($array); 
```

输出是：

```
string(20) "German_Germany.65001"
string(1) "C"
array(6) {
  [0]=>
  string(6) "Birnen"
  [1]=>
  string(9) "Ungetiere"
  [2]=>
  string(6) "Äpfel"
  [3]=>
  string(5) "Apfel"
  [4]=>
  string(9) "Ungetüme"
  [5]=>
  string(11) "Österreich"
} 
```

这完全是胡说八道。使用 1252 作为代码页`setlocale()`给出了另一个输出，但仍然是一个明显错误的输出：

```
string(19) "German_Germany.1252"
string(1) "C"
array(6) {
  [0]=>
  string(11) "Österreich"
  [1]=>
  string(6) "Äpfel"
  [2]=>
  string(5) "Apfel"
  [3]=>
  string(6) "Birnen"
  [4]=>
  string(9) "Ungetüme"
  [5]=>
  string(9) "Ungetiere"
} 
```

有没有办法使用 UTF-8 字符串区域设置对数组进行排序？

*刚刚注意到这似乎是 Windows 上的 PHP 问题，因为与`de_DE.utf8`used as locale 相同的片段在 Linux 机器上工作。尽管如此，这个Windows特定问题的解决方案会很好......*

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2012-03-06T00:30:05.273

```
$a = array( 'Кръстев', 'Делян1', 'делян1', 'Делян2', 'делян3', 'кръстев' );
$col = new \Collator('bg_BG');
$col->asort( $a );
var_dump( $a ); 
```

印刷：

```
array
  2 => string 'делян1' (length=11)
  1 => string 'Делян1' (length=11)
  3 => string 'Делян2' (length=11)
  4 => string 'делян3' (length=11)
  5 => string 'кръстев' (length=14)
  0 => string 'Кръстев' (length=14) 
```

该类`Collator`在[PECL intl extension](http://www.php.net/manual/en/book.intl.php)中定义。它与 PHP 5.3 源一起分发，但在某些构建中可能会被禁用。例如，在 Debian 中，它位于包 php5-intl 中。

`Collator::compare`对 有用`usort`。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-08T09:54:40.097

关于这个问题的更新：

尽管围绕这个问题的讨论表明我们可以用[`strcoll()`](http://de2.php.net/manual/en/function.strcoll.php)and/or发现一个 PHP 错误[`setlocale()`](http://de2.php.net/manual/en/function.setlocale.php)，但显然不是这样。问题是 Windows CRT 实现的限制[`setlocale()`](http://msdn.microsoft.com/en-us/library/x99tb11d.aspx)（PHP`setlocale()`只是 CRT 调用的一个薄包装器）。以下是对[MSDN 页面 "setlocale, _wsetlocale"](http://msdn.microsoft.com/en-us/library/x99tb11d.aspx)的引用：

> 可用语言、国家/地区代码和代码页集包括 Win32 NLS API 支持的所有语言，**但每个字符需要两个以上字节的代码页除外，例如 UTF-7 和 UTF-8。如果您提供像 UTF-7 或 UTF-8 这样的代码页，setlocale 将失败，返回 NULL。**setlocale 支持的语言和国家/地区代码集在语言和国家/地区字符串中列出。

因此，当字符串是多字节编码时，不可能在 Windows 上的 PHP 中使用区域设置感知字符串操作。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-24T07:42:28.867

最终，由于 Huppie 发现的一个明显的 PHP 错误，如果不使用 ΤZΩΤZΙΟΥ 建议的重新编码的字符串（UTF-8 → Windows-1252 或 ISO-8859-1），则无法以简单的方式解决此问题。为了总结这个问题，我创建了以下代码片段，它清楚地证明了问题是使用 65001 Windows-UTF-8-codepage 时的 strcoll() 函数。

```
function traceStrColl($a, $b) {
    $outValue=strcoll($a, $b);
    echo "$a $b $outValue\r\n";
    return $outValue;
}

$locale=(defined('PHP_OS') && stristr(PHP_OS, 'win')) ? 'German_Germany.65001' : 'de_DE.utf8';

$string="ABCDEFGHIJKLMNOPQRSTUVWXYZÄÖÜabcdefghijklmnopqrstuvwxyzäöüß";
$array=array();
for ($i=0; $i<mb_strlen($string, 'UTF-8'); $i++) {
    $array[]=mb_substr($string, $i, 1, 'UTF-8');
}
$oldLocale=setlocale(LC_COLLATE, "0");
var_dump(setlocale(LC_COLLATE, $locale));
usort($array, 'traceStrColl');
setlocale(LC_COLLATE, $oldLocale);
var_dump($array); 
```

结果是：

```
string(20) "German_Germany.65001"
a B 2147483647
[...]
array(59) {
  [0]=>
  string(1) "c"
  [1]=>
  string(1) "B"
  [2]=>
  string(1) "s"
  [3]=>
  string(1) "C"
  [4]=>
  string(1) "k"
  [5]=>
  string(1) "D"
  [6]=>
  string(2) "ä"
  [7]=>
  string(1) "E"
  [8]=>
  string(1) "g"
  [...] 
```

相同的代码片段在 Linux 机器上运行没有任何问题，产生以下输出：

```
string(10) "de_DE.utf8"
a B -1
[...]
array(59) {
  [0]=>
  string(1) "a"
  [1]=>
  string(1) "A"
  [2]=>
  string(2) "ä"
  [3]=>
  string(2) "Ä"
  [4]=>
  string(1) "b"
  [5]=>
  string(1) "B"
  [6]=>
  string(1) "c"
  [7]=>
  string(1) "C"
  [...] 
```

该代码段在使用 Windows-1252 (ISO-8859-1) 编码字符串时也有效（当然 mb_* 编码和语言环境必须随后更改）。

[我在bugs.php.net](http://bugs.php.net)上提交了一个错误报告：[错误 #46165 strcoll() 在 Windows 上不适用于 UTF-8 字符串](http://bugs.php.net/bug.php?id=46165)。如果您遇到同样的问题，您可以在错误报告页面上向 PHP 团队提供反馈（另外两个可能相关的错误已被归类为*伪造*的- 我不认为这个错误是*伪造*的;-)。

感谢大家。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T11:12:10.290

这是一个非常复杂的[问题](http://unicode.org/reports/tr10/)，因为 UTF-8 编码的数据可以包含任何 Unicode 字符（即来自许多 8 位编码的字符，它们在不同的语言环境中的排列方式不同）。

也许如果您将 UTF-8 数据转换为 Unicode（不熟悉 PHP unicode 函数，抱歉），然后将它们规范化为[NFD 或 NFKD](http://en.wikipedia.org/wiki/Unicode_normalization)，然后对代码点进行排序可能会给您一些有意义的排序规则（即“A”在“Ä”之前）。

检查我提供的链接。

编辑：既然您提到您的输入数据是明确的（我假设它们都属于“windows-1252”代码页），那么您应该进行以下转换：UTF-8 → Unicode → Windows-1252，其中 Windows-1252编码数据进行排序选择“CP1252”语言环境。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-09-25T09:46:04.630

我[发现以下帮助函数](https://stackoverflow.com/a/6856938/2199525)将字符串的所有字母转换为 ASCII 字母在这里非常有用。

```
function _all_letters_to_ASCII($string) {
  return strtr(utf8_decode($string), 
    utf8_decode('ŠŒŽšœžŸ¥µÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖØÙÚÛÜÝßàáâãäåæçèéêëìíîïðñòóôõöøùúûüýÿ'),
    'SOZsozYYuAAAAAAACEEEEIIIIDNOOOOOOUUUUYsaaaaaaaceeeeiiiionoooooouuuuyy');
} 
```

之后，一个简单的`array_multisort()`给你你想要的。

```
$array = array('Birnen', 'Äpfel', 'Ungetüme', 'Apfel', 'Ungetiere', 'Österreich');
$reference_array = $array;

foreach ($reference_array as $key => &$value) {
  $value = _all_letters_to_ASCII($value);
}
var_dump($reference_array);

array_multisort($reference_array, $array);
var_dump($array); 
```

当然，您可以使辅助函数适应更高级的需求。但就目前而言，它看起来还不错。

```
array(6) {
  [0]=> string(6) "Birnen"
  [1]=> string(5) "Apfel"
  [2]=> string(8) "Ungetume"
  [3]=> string(5) "Apfel"
  [4]=> string(9) "Ungetiere"
  [5]=> string(10) "Osterreich"
}

array(6) {
  [0]=> string(5) "Apfel"
  [1]=> string(6) "Äpfel"
  [2]=> string(6) "Birnen"
  [3]=> string(11) "Österreich"
  [4]=> string(9) "Ungetiere"
  [5]=> string(9) "Ungetüme"
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T11:21:18.427

将您的示例与代码页 1252 一起在我的 Windows 开发机器上运行得非常好。

```
$array=array('Birnen', 'Äpfel', 'Ungetüme', 'Apfel', 'Ungetiere', 'Österreich');
$oldLocal=setlocale(LC_COLLATE, "0");
var_dump(setlocale(LC_COLLATE, 'German_Germany.1252'));
usort($array, 'strcoll');
var_dump(setlocale(LC_COLLATE, $oldLocal));
var_dump($array); 
```

*……剪……*

这是 PHP 5.2.6 的版本。顺便提一句。

* * *

上面的例子是**错误**的，它使用 ASCII 编码而不是 UTF-8。我确实跟踪了 strcoll() 调用并查看了我发现的内容：

```
function traceStrColl($a, $b) {
    $outValue = strcoll($a, $b);
    echo "$a $b $outValue\r\n";
    return $outValue;
}

$array=array('Birnen', 'Äpfel', 'Ungetüme', 'Apfel', 'Ungetiere', 'Österreich');
setlocale(LC_COLLATE, 'German_Germany.65001');
usort($array, 'traceStrColl');
print_r($array); 
```

给出：

```
Ungetüme Äpfel 2147483647
Ungetüme Birnen 2147483647
Ungetüme Apfel 2147483647
Ungetüme Ungetiere 2147483647
Österreich Ungetüme 2147483647
Äpfel Ungetiere 2147483647
Äpfel Birnen 2147483647
Apfel Äpfel 2147483647
Ungetiere Birnen 2147483647
```

我确实发现了一些被标记为[虚假的](http://bugs.php.net/bug.php?id=28527)[错误](http://bugs.php.net/)报告......不过，我认为最好的办法是提交错误报告......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-10-11T09:58:59.857

我遇到了与德语“元音变音”相同的问题。经过一些研究，这对我有用：

```
$laender =array("Österreich", "Schweiz", "England", "France", "Ägypten");  
$laender = array_map("utf8_decode", $laender);  
setlocale(LC_ALL,"de_DE@euro", "de_DE", "deu_deu");  
sort($laender, SORT_LOCALE_STRING);  
$laender = array_map("utf8_encode", $laender);  
print_r($laender); 
```

结果：

> 数组
> （
> [0] => Ägypten
> [1] => England
> [2] => France
> [3] => Österreich
> [4] => Schweiz
> ）

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-23T14:40:05.080

您的排序规则需要匹配字符集。由于您的数据是 UTF-8 编码的，因此您应该使用 UTF-8 排序规则。它可以在不同的平台上以不同的方式命名，但一个很好的猜测是`de_DE.utf8`.

在 UNIX 系统上，您可以使用以下命令获取当前安装的语言环境列表

```
locale -a 
```

# maven-2 - 如何让 Maven 将内部版本号“标记”到属性文件中

> ID：120335
> 
> 赞同：10
> 
> 时间：2008-09-23T11:01:31.640
> 
> 标签：maven-2

作为 Maven 构建的一部分，我希望能够在属性文件/类中设置构建号（并不重要）（这样我就可以在 UI 中显示它）。有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T11:05:32.613

我们使用了Codehaus 现在提供的[Build Number Plugin 。](http://mojo.codehaus.org/buildnumber-maven-plugin/)它可以生成一个连续的内部版本号或允许您使用时间戳。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T11:05:51.693

[Maven 内部版本号插件](http://technology.amis.nl/blog/?p=2582)应该做你想做的事。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T22:03:30.183

我使用 maven-property-plugin 将 CruiseControl 构建标签存储在属性文件中（构建标签可用作名为“标签”的系统属性）。

关于如何与 Hudson 一起执行此操作[的帖子。](http://weblogs.java.net/blog/johnsmart/archive/2008/03/using_hudson_en.html)

# java - 用于客户端应用程序的性能分析提示 Netbeans

> ID：120351
> 
> 赞同：2
> 
> 时间：2008-09-23T11:06:30.943
> 
> 标签：java, netbeans, profiling

您有任何使用 Netbeans 进行有效分析的技巧吗？

分析器非常好用且功能强大。我用它来查找我的一些 Eclipse RCP 客户端应用程序中的问题。但是，我觉得我可以从中获得更多价值。

通常我将它设置为使用包含过滤器来分析我的所有类（以 xxx.mydomain 开头），或者我使用排除过滤器来删除所有 org.eclipse 类。这有助于降低开销。运行我感兴趣的代码部分后，我拍了一张快照。我分析热点，然后更改代码，重复分析，拍摄另一个快照并再次比较。

关于如何充分利用客户端应用程序的分析器的任何其他建议或技巧？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T11:26:12.957

JavaOne 实验室练习可免费在线获得，您应该可以在那里获得一些好的技巧。

[http://developers.sun.com/learning/javaoneonline/j1labs2008.jsp?track=1&yr=2008](http://developers.sun.com/learning/javaoneonline/j1labs2008.jsp?track=1&yr=2008)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T11:29:53.523

具体来说，Java One Lab 中的这个链接很有趣

[http://developers.sun.com/learning/javaoneonline/j1lab.jsp?lab=LAB-8430&yr=2008&track=1](http://developers.sun.com/learning/javaoneonline/j1lab.jsp?lab=LAB-8430&yr=2008&track=1)

# delphi - Delphi 2009 TurboPower 库转换

> ID：120353
> 
> 赞同：5
> 
> 时间：2008-09-23T11:07:10.037
> 
> 标签：delphi, delphi-2009, turbopower

在接下来的几个月里，我将重振一个广泛使用 Orpheus 和 SysTools 的项目。我使用的开发系统早已不复存在，所以想将库更新到我当前的开发环境。

我的问题：是否有人将 TurboPower 库移植到 Tiburon，或者是否有人将 TurboPower 库移植到 Tiburon，如果是，您是否遇到任何问题；如果答案是没有人，是否值得合作制作一个 Delphi 2009 版本，分担负载。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T11:35:35.443

一些组件正在移植到 Delphi 2009，包括 5 个 TurboPower 库。不过，没有 Orpheus 或 SysTools。

[http://www.songbeamer.com/delphi/](http://www.songbeamer.com/delphi/)

更新：

正如 M Plaut 指出的那样，Orpheus 已被添加到该站点，并且最近在 11 月 13 日进行了更新。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-07T09:24:51.577

Orpheus407AU_3 于 2009 年 9 月 5 日发布在[http://sourceforge.net/projects/tporpheus/](http://sourceforge.net/projects/tporpheus/)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-02T16:25:45.493

截至 10-11-2008，在[http://www.songbeamer.com/delphi/上有一个版本](http://www.songbeamer.com/delphi/)

俄耳甫斯也是。附上以下评论：

*这是基于 CVS 的版本。前两个包编译并经过部分测试。一些 asm 代码仍然需要更新。还需要找到并修复一些错误修复。欢迎投稿（使用顶部的联系表格）。在源中搜索“FIXME”。可能需要特别注意和修正错误的文件：OVCDRPVW.PAS、OVCPF.PAS、OVCEDITU.PAS、OVCVIEWR.PAS、OVCSTR.PAS*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T17:15:25.503

当 turbo power 关门时，我分析了我使用 Orpheus 和 SysTools 的代码。我发现我使用的 SysToosl 函数很少，所以我们编写了自己的函数。（不记得他们是什么）

这很简单，其中一些在较新版本的 Delphi 中，其余的很容易编码。

俄耳甫斯有点困难。我愿意花一些时间带回俄耳甫斯。我们用标准的 Delphi 组件和一些代码替换了它，但我们的应用程序缺乏它曾经拥有的一些酷炫。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T01:24:24.003

我们肯定也会考虑移植这个。我们在当前的应用程序中使用了很多 Orpheus 组件，这将成为 Delphi 2009 的明确障碍。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T11:14:39.440

SourceForge有[Orpheus](http://sourceforge.net/projects/tporpheus/)项目，但最后一个版本是在 2005 年发布的 :( [Systools](http://sourceforge.net/projects/tpsystools/)也可以在那里找到。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-26T14:21:11.000

我必须把一个非常古老的项目带到delphi 2009：一个CNC编辑器。该项目当时没有使用Orheus，但我正在研究它（做了一些测试），并且orpheus文本编辑器仍然是市场上最快的。所以是的，我很感兴趣。我试图在 delphi 9 中编译旧源代码，但它崩溃了。我不是一个好的程序员，但我可以为你做测试。

# asp.net - 如何通过 ASP.NET 创建可编辑的 PDF

> ID：120355
> 
> 赞同：1
> 
> 时间：2008-09-23T11:07:26.573
> 
> 标签：asp.net, pdf

如何使用 ASP.NET 创建可编辑的 PDF。我想从主模板创建一个 Pdf，对其进行编辑（填充一些值（不是来自数据库的输入））并保存。不使用第三者可以吗？

如果有一些示例代码可用，那就太好了

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T11:14:37.680

我在几个项目中使用[PDF4NET ，绝对可以推荐它。](http://www.o2sol.com/pdf4net/products.htm)他们的网站上有[代码示例](http://www.o2sol.com/pdf4net/samples.htm)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-30T05:47:47.753

您可以使用开源[iTextSharp](http://itextsharp.sourceforge.net/)，它是[iText](http://www.lowagie.com/iText/) (java) 的一个端口。 [这](http://itext.ugent.be/library/com/lowagie/examples/forms/FormTextField.java)是一个创建带有文本字段的表单的代码示例（它是 java，但 iTextSharp 界面几乎相同）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-24T19:49:21.837

为此，您可以使用[Aspose.Pdf.Kit 。](http://www.aspose.com/categories/.net-components/aspose.pdf.kit-for-.net/default.aspx)事实上，它可以在 ASP.NET 或 Windows 应用程序中使用。您可以下载试用版。查看相关文档；这可能会有所帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T12:38:49.473

Maybe you can try the [ReportViewer control](http://www.gotreportviewer.com/).

You can create a "report template", assign data to it in runtime (fill in values), render it, and save the result.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-30T06:02:03.213

我喜欢[http://dynamicpdf.com](http://dynamicpdf.com)，他们有一个免费的社区版，允许您以编程方式从头开始创建 PDF。付费产品提供更多功能，并且他们也有设计师。

# java - 在 Java 中不可挽回地破坏数据

> ID：120380
> 
> 赞同：11
> 
> 时间：2008-09-23T11:17:11.730
> 
> 标签：java, security

Java 中是否有删除数据（例如，变量值、对象）并确保无法从内存中恢复的方法？分配`null`给Java中的变量是否会从内存中删除值？有任何想法吗？适用于其他语言的答案也是可以接受的。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-23T11:26:00.973

由于神奇的虚拟内存，几乎不可能以完全不可挽回的方式从内存中删除某些内容。您最好的选择是将值字段清零；然而：

*   这并不意味着对象的旧（未归零）副本不会留在未使用的交换页面上，这可能会在重新启动后持续存在。
*   它也不会阻止某人将调试器附加到您的应用程序并在对象归零之前四处寻找或使虚拟机崩溃并在堆转储中四处寻找。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-23T15:37:12.477

将敏感数据存储在数组中，然后尽快将其“归零”。

RAM 中的任何数据都可以通过虚拟内存系统复制到磁盘。RAM（或核心转储）中的数据也可以通过调试工具进行检查。为了尽量减少发生这种情况的机会，您应该努力做到以下几点

*   保持时间窗口 内存中存在的秘密 尽可能短
*   注意内部缓冲数据的 IO 管道（例如 BufferedInputStream）
*   将秘密的引用保存在堆栈上和堆外
*   不要使用不可变类型，例如 `String`，来保存秘密

Java 中的加密 API 使用这种方法，您创建的任何 API 也应该支持它。例如，[`KeyStore.load`](http://java.sun.com/j2se/1.5.0/docs/api/java/security/KeyStore.html#load(java.io.InputStream,%20char[]))允许调用者清除密码`char[]`，当调用完成时，[基于密码的加密的 KeySpec 也是如此。](http://java.sun.com/j2se/1.5.0/docs/api/javax/crypto/spec/PBEKeySpec.html#clearPassword())

理想情况下，您将使用一个`finally`块将数组归零，如下所示：

```
KeyStore ks = KeyStore.getInstance(KeyStore.getDefaultType());
InputStream is = …
char[] pw = System.console().readPassword();
try {
 ks.load(is, pw);
}
finally {
  Arrays.fill(pw, '\0');
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T11:37:11.913

什么都没有被删除，它只是关于应用程序是否可以访问。一旦无法访问，该空间就会在需要时成为后续使用的候选对象，并且该空间将被覆盖。在直接内存访问的情况下，总是有一些东西可以读取，但它可能是垃圾并且没有意义。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T12:18:11.193

通过将您的 Object 设置为 null 并不意味着您的对象已从内存中删除。如果没有更多对该对象的引用，则虚拟机将该对象标记为已准备好进行垃圾收集。根据您的代码，即使您已将其设置为 null，它仍可能会被引用，在这种情况下它不会被删除。（基本上，如果您希望它被垃圾收集，而不是您有内存泄漏！）

一旦它被标记为准备好收集，您就无法控制垃圾收集器何时将其移除。你可以乱用垃圾收集策略，但我不建议这样做。分析您的应用程序并查看对象及其 id，您可以看到引用它的内容。Java 为 VisualVM 提供 1.6.0_07 及以上版本或者您可以使用 NetBeans

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T12:40:59.610

正如 zacherates 所说，在删除对它的引用之前，将对象的敏感字段清零。请注意，您不能将字符串的内容归零，因此请使用 char 数组并将每个元素归零。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T11:21:11.360

不，除非您对硬件有直接的回答。变量有可能被缓存在某处。敏感数据甚至可以存储在交换中 :) 如果您只关心 RAM，您可以使用垃圾收集器。在高级语言中，通常您无法直接访问内存，因此无法控制这方面。例如，在 .NET 中有一个 SecureString 类，它使用互操作和直接内存访问。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T12:44:52.797

我认为您最好的选择（这并不复杂）是使用 char[] 然后更改数组中的每个位置。关于它可能被复制到内存中的其他评论仍然适用。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T15:10:33.087

原始数据（byte、char、int、double）和它们的数组（byte[]、...）可以通过向其中写入新的随机内容来擦除。

必须通过覆盖其原始属性来清理对象数据；将变量设置为 null 只会使对象可用于 GC，但不会立即死亡。虚拟机转储将包含它们以供任何人查看。

不能以任何方式覆盖字符串等不可变数据。任何修改都只是复制。您应避免将敏感数据保存在此类对象中。

PS如果我们谈论密码，最好使用加密强哈希函数（MD5，SHA1，...），并且永远不要使用明文密码。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-23T15:11:54.520

如果您正在考虑保护密码/密钥管理，您可以编写一些 JNI 代码，使用特定于平台的 API 以安全的方式存储密钥，而不会将数据泄漏到 JVM 管理的内存中。例如，您可以将密钥存储在物理内存中锁定的页面中，并且可以阻止 IO 总线访问内存。

编辑：评论一些以前的答案，JVM 可以重新定位内存中的对象而不擦除它们以前的位置，因此，即使 char[]、bytes、ints 和其他“可擦除”数据类型也不是答案，如果你真的希望确保没有敏感信息存储在 JVM 管理的内存中或交换到硬盘驱动器上。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T12:20:58.860

在当今时代，完全无法挽回几乎是不可能的事情。当您通常删除某些内容时，唯一发生的事情是您记忆中的第一个位置被清空。第一个位置用于包含有关必须为该程序或其他东西保留多长时间的内存的信息。

但是所有其他信息仍然存在，直到被其他人覆盖。

我建议使用 TinyShredder，或者使用 CCleaner 设置为 Gutmann-pass

# eclipse - 如何使用 Eclipse Monkey 保存文件？

> ID：120383
> 
> 赞同：2
> 
> 时间：2008-09-23T11:18:23.707
> 
> 标签：eclipse, scripting, ide

我最近开始使用 Aptana 和 Eclipse Monkey。我现在要做的是创建一个脚本来保存文件然后将其上传到 FTP。

问题是 Eclipse Monkey 的文档记录很差，谷歌只返回了不相关的结果。

我已经上传了文件，但我需要脚本在上传之前保存文件。

```
sync.uploadCurrentEditor(); 
```

你知道 Eclipse Monkey 的任何资源以及方法等吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-08T15:19:26.047

看看这个，它可以解决你的问题：

[http://forums.aptana.com/viewtopic.php?t=5216](http://forums.aptana.com/viewtopic.php?t=5216)

编辑; 更具体; 您需要将以下行添加到顶部的元数据片段中，以便脚本知道引用“编辑器”：

```
* DOM: http://download.eclipse.org/technology/dash/update/org.eclipse.eclipsemonkey.lang.javascript 
```

完成后，您需要在同步之前添加以下行。东西;

```
editors.activeEditor.save(); 
```

就是这样 ：）

# iis - 有哪些非基于 Web 的工具可以查看 IIS 日志？

> ID：120395
> 
> 赞同：1
> 
> 时间：2008-09-23T11:25:08.107
> 
> 标签：iis, logging

我正在寻找非基于 Web 的工具来查看 IIS 日志。我一直在使用[LogParser](http://www.microsoft.com/technet/scriptcenter/tools/logparser/default.mspx)，但我希望有一个接口。它不需要做任何花哨的报告或图表——只需一个带有一些搜索过滤器的列表就足够了。我需要一些可以直接在 Web 服务器上运行的轻量级工具，最好不需要复杂的安装过程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-30T14:22:06.410

[VisualLogParser](http://www.codeplex.com/visuallogparser)将 Log Parser 包装在 GUI 中。我敢肯定还有其他人，但它适合我的账单。Log Parser 的所有 yumminess，具有半体面的界面。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T11:37:54.907

我发现命令行工具通常就足够了。例如，列出所有带有 404 响应的日志条目：

```
findstr "404" logfilename > out.txt 
```

Findstr 支持搜索词中的正则表达式和文件名中的通配符，因此它在处理日志文件时非常灵活。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-30T13:46:23.143

我很好奇为什么您需要比 LogParser 已经提供的命令行界面更多的“界面”？您是否正在为类似 SQL 的语法而苦苦挣扎，或者还有其他什么？

LogParser 会满足您的所有其他要求。它完全震撼*了我的*袜子。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-16T06:12:38.323

没有什么比日志解析器更好的了。但是，您可能想查看 Sawmill & splunk。

# web-applications - 如何为企业网络应用定价？

> ID：120396
> 
> 赞同：4
> 
> 时间：2008-09-23T11:25:13.287
> 
> 标签：web-applications

我正在为一家大型跨国公司针对我们的许可解决方案提出建议。问题是我以前从未组装过这么大的东西，所以我不知道什么是可以接受的。暂时忽略托管或支持（甚至是应用程序的功能），只集中许可——你认为按用户做这件事更常见吗——如果是这样，公司是否会介意价格随着用户数量的增加而波动上船？还是做用户群更正常：1-1000、1000-5000、5000-10000、10000-25000、25000-50000、50000-100k、100k+（可能是最大使用量）。有谁知道关于这种事情的任何好的链接？这里有没有人为 30000 个用户采购了一个复杂的多语言网络应用程序，多少是可以接受的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T11:31:36.373

对于大宗交易，您销售的每件商品通常都会打折，这样您就可以根据它们的数量进行扩展。可能有一个基本价格加上一个随其使用而扩展的每用户许可证是有意义的。另一个经验法则是，当您有大量购买要获得批准时，您的销售周期将相当长，因此在定价时考虑到这一点是个好主意。这是 Joel Spolsky 的一篇非常好的文章：

[http://www.joelonsoftware.com/articles/CamelsandRubberDuckies.html](http://www.joelonsoftware.com/articles/CamelsandRubberDuckies.html)

如果您从未参加过经济课程，那么这将有很大帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T11:30:50.603

我想这将取决于您的情况，这个许可的解决方案是否已经完成，或者它将专门为这家公司创建。如果是第一个，我建议使用以前的报价作为基础。如果要开发它，这将取决于您希望如何收回开发它的资金。您想在多长时间内收回成本等。我想说用户群可能是最常见的解决方案，因为人们可能不想为每个单独的用户重新授权。

# c# - 集成在 ac# 应用程序中的传真条码识别软件

> ID：120402
> 
> 赞同：1
> 
> 时间：2008-09-23T11:26:02.410
> 
> 标签：c#, .net, barcode

我的申请正在准备一份用于通过传真提交文件的封面。[我通过在其上打印Code39](http://en.wikipedia.org/wiki/Code_39)来识别批次。

传入的传真以 tif 文件的形式接收，我的小型 c# 服务正在轮询新传真并调用解码函数。

目前，我使用 Win32 dll 来识别条形码（[QSbar39](http://www.qsbarcode.de/)），但我遇到了一些问题 - 超时、挂起、错误等，这些都很难处理。

我希望有一些免费的 .Net 组件或开源类来集成。

你会采取不同的方法吗？你用什么工具？

非常感谢您的回答！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-15T01:28:35.587

[BarBara](http://sourceforge.net/projects/barbara/)是一个开源的条码识别库。它当然不是完美的，但我已经让它工作得很好（如果我记得它需要一些玩弄才能让它在 VS2008 中编译）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-17T18:08:01.387

我使用了这个 java 库并取得了很好的效果，并且以最小的努力让它在 .Net 中编译。它已经存在了一段时间并且运行良好。EAN 代码有一些小问题，但现在可能已经解决了。

[http://barbecue.sourceforge.net/](http://barbecue.sourceforge.net/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T11:38:41.317

我不确定是否有任何可用的免费或开源软件，但[VintaSoftBarcode.NET 库](http://www.vintasoft.com/vsbarcode-dotnet-index.html)非常便宜，并且在最近的一个项目中为我完成了这项工作。

# c# - 从 Asp.net 中的不同线程访问文件的问题

> ID：120404
> 
> 赞同：0
> 
> 时间：2008-09-23T11:26:12.860
> 
> 标签：c#, asp.net, multithreading, file

我在网站中有一个进程（Asp.net 3.5 使用 Linq-to-Sql 进行数据访问），需要按如下方式工作：

1.  上传文件
2.  记录并保存有关文件的信息到数据库
3.  将文件中的数据导入数据库
4.  重定向到不同的页面

当像这样顺序运行时，一切正常。但是，由于导入的文件可能非常大，我希望第 3 步在与 UI 线程不同的线程上运行。用户应在第 3 步仍在进行中时进入第 4 步，第 4 步的屏幕将定期更新以通知用户何时导入完成。

我正在处理线程如下：

```
public class Import {

  public static void ImportPendingFile() {
    Import i = new Import();
    Thread newThread = new Thread(new ThreadStart(i.ImportFile));
    newThread.Start();
  }

  public void ImportFile() {
    // 1\. Query DB to identify pending file
    // 2\. Open up and parse pending file
    // 3\. Import all data from file into DB
    // 4\. Update db to reflect that import completed successfully
  }
} 
```

在代码隐藏中：

```
protected void butUpload(object sender, EventArgs e) {
  // Save file, prepare for import
  Import.ImportPendingFile();
  Response.Redirect(NewLocation);
} 
```

这样做时，我可以通过调试器确认新线程正在正确启动。但是，每当我这样做时，线程都会在尝试访问文件时中止（后面代码中的第 2 步）。这在主线程中运行时效果很好，所以关于多线程情况的一些事情正在阻止这种情况。我曾认为，由于文件已保存到磁盘（确实如此），因此在不同的线程中打开它应该没有任何问题。有什么想法我出错了，我该如何解决？谢谢！

注意：我正在使用第三方程序集打开文件。使用反射器，我发现以下与它如何打开文件有关的代码：

```
if (File.Exists(fileName)) {
  using (FileStream stream = new FileStream(fileName, FileMode.Open)) {
    // use stream to open file
  }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T11:31:46.903

尝试 Response.Redirect(url, false) ，否则“响应”将在该调用之后结束。

# web-applications - 站点 URL 旁边的图像图标

> ID：120420
> 
> 赞同：19
> 
> 时间：2008-09-23T11:30:14.707
> 
> 标签：web-applications, favicon

我想了解有关在 Web 浏览器上与站点 URL 一起显示的图标的信息。这是一些浏览器特定的功能吗？我们在哪里指定图标来源，即它是否在网页本身的某个标签中？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-09-23T11:31:13.583

这些图标称为[网站图标](http://en.wikipedia.org/wiki/Favicon)

大多数网络浏览器都支持[http://mysite.com/favicon.ico](http://mysite.com/favicon.ico)，但正确的做法是在头部配置文件中包含一个图标元标记。

```
<head profile="http://www.w3.org/2005/10/profile">
<link rel="icon" 
      type="image/png" 
      href="/somewhere/myicon.png" />
[…]
</head> 
```

[来源来自 W3C 本身。](http://www.w3.org/2005/10/howto-favicon)

你最好的选择是使用相同的图标图像。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-23T11:33:41.283

我相信您指的是[Favicon](http://en.wikipedia.org/wiki/Favicon)，它允许网站指定 16x16（或更大）的图像，该图像显示在大多数现代浏览器中 URL 旁边的地址栏中。

一些浏览器只选择 web 文件夹根目录中名为 favicon.ico 的文件，而其他浏览器则要求`<head>`使用以下代码在 HTML 中指定它，

```
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /> 
```

这本来是用 IE 做的，但不符合标准（因为 rel 中有空格），所以现在大多数浏览器都允许你这样做，你可以使用任何标准的图像格式，而不是只是.ico

```
<link rel="icon" href="favicon.png" type="image/png" /> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T11:32:51.737

它被称为网站图标。

你可能想看看这三个问题：

*   [目前在所有支持 Favicon 的浏览器中显示 favicon 的最佳方式是什么？](https://stackoverflow.com/questions/37073/what-is-currently-the-best-way-to-get-a-favicon-to-display-in-all-browsers-that)
*   [为什么我的网站没有图标？](https://stackoverflow.com/questions/6732/why-no-favicon-for-my-web-site)
*   [使用网站图标的首选方式？](https://stackoverflow.com/questions/6642/preferred-way-to-use-favicons)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T11:32:04.097

这些是[网站图标](http://en.wikipedia.org/wiki/Favicon)- 该页面上的更多信息。

基本上， .ico 文件位于网络服务器的根目录中。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T11:53:34.323

我将补充一点，一些网站使用动画 Gif 作为网站图标。根据您的口味，这可以被视为 über 很酷或非常烦人……而且可能并非所有浏览器都支持。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-31T17:50:09.953

获取该信息的最简单方法是通过这个简单的网络应用程序

[链接文本](http://www.getfavicon.org)

您只需输入页面的 url，它就会返回所有图像属性

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-31T18:41:30.363

它们是[网站图标](http://en.wikipedia.org/wiki/Favicon)。浏览器在服务器上查看/查看 favicon.ico

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-05-21T10:26:15.613

这称为 favicon，您可以在 asp.net 应用程序中使用 favicon 查看本教程[链接](http://www.c-sharpcorner.com/uploadfile/afenster/add-a-favicon-to-your-Asp-Net-page/)

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2008-09-23T11:31:09.933

它最初是一个 Windows 图标格式文件，存储在 URL [http://site/favicon.ico](http://site/favicon.ico)下。大多数网站仍然使用 favicon.ico，并且许多浏览器仍然会自动查找那里，无论元标记如何。

# sql - 如何使用嵌入式 SQL 遍历 RPG(LE) 中的一组记录？

> ID：120422
> 
> 赞同：7
> 
> 时间：2008-09-23T11:30:18.407
> 
> 标签：sql, ibm-midrange, db2-400, rpgle

如何使用嵌入式 SQL 遍历 RPG(LE) 中的一组记录？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-23T13:29:34.920

通常我会创建一个游标并获取每条记录。

```
 //***********************************************************************
   // Main - Main Processing Routine
   begsr Main;

     exsr BldSqlStmt;

     if OpenSqlCursor() = SQL_SUCCESS;

       dow FetchNextRow() = SQL_SUCCESS;
         exsr ProcessRow;
       enddo;

       if sqlStt = SQL_NO_MORE_ROWS;
         CloseSqlCursor();
       endif;

     endif;

     CloseSqlCursor();

   endsr;    // Main 
```

我[在我的网站上的帖子中](http://mikewills.me/blog/how-do-i-iterate-over-a-set-of-records-in-rpg-with-embedded-sql/)为这个答案添加了更多细节。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-08-07T23:42:35.687

正如 Mike 所说，遍历游标是最好的解决方案。我会添加以提供更好的性能，您可能希望获取一个数组以分块处理而不是一次处理一条记录。

例子：

```
 EXEC SQL                                                          
  OPEN order_history;                                             

  // Set the length                                                 
  len = %elem(results);                                             

  // Loop through all the results                                   
  dow (SqlState = Sql_Success);                                     
    EXEC SQL                                                        
      FETCH FROM order_history FOR :len ROWS INTO :results;         
    if (SQLER3 <> *zeros);                                                 
      for i = 1 to SQLER3 by 1;        
        // Load the output             
        eval-corr output = results(i); 
        // Do something 
      endfor;                          
    endif;                             
  enddo; 
```

HTH，詹姆斯·R·珀金斯

# architecture - “层”和“层”有什么区别？

> ID：120438
> 
> 赞同：240
> 
> 时间：2008-09-23T11:32:12.770
> 
> 标签：architecture

“层”和“层”有什么区别？

* * *

## 回答 #1

> 赞同：283
> 
> 时间：2008-09-23T11:44:42.880

> 逻辑**层**只是组织代码的一种方式。典型层包括表示层、业务层和数据层——与传统的 3 层模型相同。但是当我们谈论层时，我们只谈论代码的逻辑组织。这绝不意味着这些层可能在不同的计算机上运行，​​或者在单个计算机上的不同进程中运行，甚至在单个计算机上的单个进程中运行。我们所做的只是讨论一种将代码组织成一组由特定功能定义的层的方法。
> 
> 然而，物理**层**仅与代码运行的位置有关。具体来说，层是部署层和运行层的地方。换句话说，层是层的物理部署。

*资料来源：Rockford Lhotka，[所有应用程序都应该是 n 层吗？](https://web.archive.org/web/20200802111420/http://www.lhotka.net:80/weblog/ShouldAllAppsBeNtier.aspx)*

* * *

## 回答 #2

> 赞同：50
> 
> 时间：2008-09-23T11:34:40.907

阅读 Scott Hanselman 关于这个问题的帖子：[关于“三层/多层/层架构/设计”的提醒](http://www.hanselman.com/blog/AReminderOnThreeMultiTierLayerArchitectureDesignBroughtToYouByMyLateNightFrustrations.aspx)：

> 但请记住，在“Scott World”（希望也是您的世界 :)）中，“Tier”是一个部署单元，而“Layer”是代码中职责的逻辑分离。您可能会说您有一个“3 层”系统，但要在一台笔记本电脑上运行它。您可能会说您有一个“3 层”系统，但只有与数据库通信的 ASP.NET 页面。朋友们，精确有力量。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2011-06-03T10:06:03.620

层是指代码的逻辑分离。逻辑层可帮助您更好地组织代码。例如，应用程序可以具有以下层。

1.  表示层或 UI 层
2.  业务层或业务逻辑层
3.  数据访问层或数据层

上述三层驻留在自己的项目中，可能是 3 个项目，甚至更多。当我们编译项目时，我们会得到相应的层 DLL。所以我们现在有 3 个 DLL。

根据我们部署应用程序的方式，我们可能有 1 到 3 层。由于我们现在有 3 个 DLL，如果我们将所有 DLL 部署在同一台机器上，那么我们只有 1 个物理层但有 3 个逻辑层。

如果我们选择将每个 DLL 部署在单独的机器上，那么我们就有 3 层和 3 层。

因此，层是逻辑分离，层是物理分离。我们也可以说层是层的物理部署。

* * *

## 回答 #4

> 赞同：43
> 
> 时间：2015-05-06T10:11:00.347

为什么总是尝试使用复杂的单词？

一层**=****您的代码的一部分**，如果您的应用程序是蛋糕，那么这就是切片。

**层**=**物理机**、服务器。

一个层承载一个或多个层。

* * *

图层示例：

*   表示层 = 通常是与用户界面相关的所有代码
*   数据访问层 = 与您的数据库访问相关的所有代码

等级：

您的代码托管在服务器上 = 您的代码托管在层上。

您的代码托管在 2 台服务器上 = 您的代码托管在 2 层。

例如，一台机器托管网站本身（表示层），另一台更安全的机器托管所有对安全敏感的代码（真正的业务代码 - 业务层、数据库访问层等）。

* * *

实现分层架构有很多好处。这很棘手，并且正确实施分层应用程序需要时间。如果你有一些，看看微软的这篇文章：http: [//msdn.microsoft.com/en-gb/library/ee658109.aspx](http://msdn.microsoft.com/en-gb/library/ee658109.aspx)

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2008-09-23T11:42:09.000

我找到了一个定义，说层是逻辑分离，层是物理分离。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2013-12-19T05:32:06.903

1.  用简单的英语来说，the`Tier`指的是“在结构的一系列行或层次中，每一个都位于另一个之上”，而 the`Layer`指的是“一块、数量或厚度的材料，通常是几种材料中的一种，覆盖一个表面或主体”。

2.  层是一个*物理单元*，代码/流程在其中运行。例如：客户端、应用服务器、数据库服务器；

    层是一个*逻辑单元*，如何组织代码。例如：表示（视图）、控制器、模型、存储库、数据访问。

3.  层表示您的设计的表示、业务、服务和数据功能在不同计算机和系统之间的物理分离。

    层是构成应用程序或服务的软件组件的逻辑分组。它们有助于区分组件执行的不同类型的任务，从而更容易创建支持组件可重用性的设计。每个逻辑层包含许多分立的组件类型，这些组件类型分组为子层，每个子层执行特定类型的任务。

两层模式代表客户端和服务器。

在这种情况下，客户端和服务器可能存在于同一台机器上，也可能位于两台不同的机器上。下图说明了一个常见的 Web 应用程序场景，其中客户端与位于客户端层的 Web 服务器交互。该层包含表示层逻辑和任何所需的业务层逻辑。Web 应用程序与托管数据库层的单独机器进行通信，其中包含数据层逻辑。

![层与层](https://i.stack.imgur.com/rdOW4.png)

**层和层的优点：**

*   分层可帮助您最大限度地提高代码的可维护性，优化应用程序在以不同方式部署时的工作方式，并在必须做出某些技术或设计决策的位置之间提供清晰的划分。

*   将层放置在单独的物理层上可以通过将负载分布到多个服务器来提高性能。它还可以通过将更敏感的组件和层隔离到不同的网络或 Internet 上而不是 Intranet 上来帮助提高安全性。

**1 层应用程序可以是 3 层应用程序。**

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2016-03-13T13:26:38.710

**层** *是应用程序内部的逻辑分离，`related-functional[code]`层之间的通信是显式且松散耦合的。[ `Presentation logic`, `Application logic`, `Data Access logic`]*

**[层](https://en.wikipedia.org/wiki/Multitier_architecture)** *是单个计算机（进程）中**[托管在]上**的物理分离。`layers``Individual servers`*

[![在此处输入图像描述](https://i.stack.imgur.com/GyRS9.png)](https://i.stack.imgur.com/GyRS9.png)

如图所示：

```
1-Tier & 3-Layers « App Logic  with out DB access store data in a files.
2-Tier & 3-Layers « App Logic & DataStorage-box.
2-Tier & 2-Layers « Browser View[php] & DataStorage[procedures]
2-Tier & 1-Layers « Browser View[php] & DataStorage, query sending is common.
3-Tier & n-Layer  « Browser View[php], App Logic[jsp], DataStorage 
```

*n[层](http://searchsoftwarequality.techtarget.com/definition/3-tier-application)优势：*
**更好的安全**
**可扩展性** *：随着组织的发展，您可以使用 DB-Clustering 扩展您的 DB-Tier，而无需触及其他层。*
**可维护性** *：网页设计师可以更改视图代码，而无需触及其他层上的其他层。*
轻松**升级**或增强*[例如：您可以添加额外的应用程序代码、升级存储区域，甚至为单独的设备（如移动设备、平板电脑、PC）添加多个表示层]*

[![在此处输入图像描述](https://i.stack.imgur.com/zPrDL.png)](https://i.stack.imgur.com/zPrDL.png)[来自博客](https://blog.infodiagram.com/2019/05/use-layers-tiers-present-hierarchy-structure-powerpoint.html) 的图表

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2017-07-05T06:10:24.877

[我喜欢Microsoft Application Architecture Guide 2](https://msdn.microsoft.com/en-us/library/ee658109.aspx)中的以下描述

> 层描述了应用程序中功能和组件的逻辑分组；而层描述了功能和组件在单独的服务器、计算机、网络或远程位置上的物理分布。尽管层和层都使用相同的名称集（表示、业务、服务和数据），但请记住，只有层意味着物理分离。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2013-03-11T10:50:12.887

是的，亲爱的朋友们说得对。层是应用程序的逻辑分区，而层是系统层分区的物理分区，取决于层分区。就像应用程序在单机上执行但它遵循 3 层架构一样，因此我们可以说层架构可以存在于层架构中。简单来说 3 层架构可以在单机上实现，那么我们可以说它是 1 层架构。如果我们在单独的机器上实现每一层，那么它被称为 3 层架构。一个层也可能能够运行多个层。在层架构相关的组件中可以轻松地相互通信。
就像我们遵循下面给出的架构一样

1.  表示层
2.  业务逻辑层
3.  数据访问层

客户端可以与“表示层”交互，但出于安全原因，他们将下层的公共组件（如业务逻辑层的公共组件）访问到“业务逻辑层”。
Q * 为什么我们使用层架构？因为如果我们实现层架构，那么我们会提高我们的应用程序效率，比如

==>安全

==>可管理性

==>可扩展性

其他需要，例如在开发应用程序后，我们需要更改 dbms 或修改业务逻辑等。那么这一切都是必要的。

Q * 为什么我们使用分层架构？

因为每一层的物理实现提供了更好的效率，没有层架构我们无法实现层架构。单独的机器来实现单独的层和单独的层是实现一个或多个层，这就是我们使用它的原因。
它用于容错。==>易于维护。

*简单的例子*

就像在密室中开设的银行一样，员工分为以下几类：

1.  看门人
2.  一个要钱的人
3.  负责引入银行计划的人
4.  经理

它们都是系统的相关组件。

如果我们去银行贷款，那么首先一个看门人微笑着开门，然后我们走到一个介绍所有贷款方案的人附近，然后我们去经理舱并通过贷款。之后，最后我们去收银台取款。这些是银行的层架构。

层级呢？银行分行开在一个镇，然后在另一个镇，然后在另一个，但是每个分行的基本要求是什么

1.  看门人
2.  一个要钱的人
3.  负责引入银行计划的人
4.  经理

层和层的概念完全相同。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-09-23T11:37:43.147

我使用层来描述我的解决方案组件中的架构师或技术堆栈。我通常在涉及网络或进程间通信时使用层对这些组件进行逻辑分组。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2019-03-07T11:23:08.187

从技术上讲，Tier 可以是代码运行所需的一种最低环境。

例如，假设可以运行一个 3 层应用程序

1.  3 台没有操作系统的物理机。
2.  1 台物理机和 3 台没有操作系统的虚拟机。

    （那是一个 3 层（硬件）层应用程序）

3.  1 台物理机，3 台虚拟机，3 个不同/相同的操作系统

    （那是一个 3-（操作系统）层应用程序）

4.  1 台物理机，1 台虚拟机，1 个操作系统，3 个 AppServer

    （那是一个 3-（AppServer）层应用程序）

5.  1 个物理机，1 个虚拟机，1 个操作系统，1 个 AppServer，3 个 DBMS

    （那是一个 3-（DBMS）层应用程序）

6.  1 台物理机和 1 个虚拟机，1 个操作系统，1 个 AppServers 和 1 个 DBMS，但 3 个 Excel 工作簿。

    （那是一个 3-（AppServer）层应用程序）

Excel 工作簿是运行 VBA 代码所需的最低环境。

这 3 个工作簿可以放在一台或多台物理计算机上。

我注意到实际上人们在应用描述上下文中说“层”时的意思是“操作系统层”。

也就是说，如果一个应用程序在 3 个独立的操作系统上运行，那么它就是一个 3 层应用程序。

因此，描述应用程序的一种迂腐正确的方式是

“支持 1 到 3 层，在 2 层上运行”应用程序。

:)

* * *

层只是与应用程序的职责功能分离相关的代码类型（例如 Presentation、Data、Security 等）

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2018-08-08T10:00:08.333

当您谈论表示、服务、数据、网络层时，您正在谈论层。当您“单独部署它们”时，您谈论的是层。

层级是关于部署的。这么说吧：我们有一个应用程序，它有一个在 Angular 中创建的前端，它有一个 MongoDB 的后端和一个在前端和后端之间进行交互的中间层。所以，当这个前端应用程序、数据库应用程序和中间层都单独部署时，我们说它是一个三层应用程序。

好处：如果我们将来需要扩展我们的后端，我们只需要独立扩展后端，不需要扩展前端。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-02-12T15:00:39.367

层是概念实体，用于从逻辑角度分离软件系统的功能；当您实施系统时，您使用不同的方法组织这些层；在这种情况下，我们将它们称为层而不是层。

# unit-testing - 要求形式化单元测试的最有说服力的方法是什么？

> ID：120460
> 
> 赞同：9
> 
> 时间：2008-09-23T11:37:27.063
> 
> 标签：unit-testing, software-quality

这当然预设了单元测试是一件好事。我们的项目有一定程度的单元测试，但充其量是不一致的。

您曾经使用过或曾经与您一起使用过的最令人信服的方法是什么让每个人相信形式化的单元测试是一件好事，并且需要它确实符合我们从事的“大型”项目的最佳利益。我不是开发人员，但我从事质量保证工作，并希望提高所交付工作的质量，以确保它可以进行测试。

通过形式化的单元测试，我只是在谈论

*   确定要编写的单元测试
*   识别测试数据（或描述它）
*   编写这些测试
*   跟踪这些测试（并根据需要重新使用）
*   使结果可用

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T11:42:25.100

一个非常有说服力的方法是自己进行形式化的单元测试，无论您的团队/公司做什么。这可能需要您付出一些额外的努力，特别是如果您没有这种练习的经验。

当你可以展示你的代码更好并且你比其他开发人员更有效率时，他们会想知道为什么。然后向他们提供您最喜欢的单元测试方法。

一旦你说服了你的开发人员，一起说服管理层。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T11:52:53.733

我将[Maven](http://maven.apache.org)与[Surefire](http://maven.apache.org/plugins/maven-surefire-plugin/)和[Cobertura](http://mojo.codehaus.org/cobertura-maven-plugin/)插件一起用于我的所有构建。实际的测试用例是使用[JUnit](http://junit.org)、[DbUnit](http://dbunit.org)和[EasyMock](http://easymock.org)创建的。

**识别单元测试** 我尝试遵循测试驱动开发，但老实说，我通常只为少数测试用例执行此操作，然后再回来为边缘和异常用例创建测试。

**识别测试数据** DbUnit 非常适合为您的单元测试加载测试数据。

**编写测试用例** 我使用 JUnit 来创建测试用例。我尝试编写自我记录的测试用例，但会使用 Javadocs 来注释一些不明显的东西。

**跟踪并使结果可用** 我使用 Surefire 插件将单元测试集成到我的 Maven 构建周期中，并使用 Corbertura 插件来测量这些测试实现的覆盖率。我总是生成并发布一个包含 Surefire 和 Cobertura 报告的网站，作为我日常构建的一部分，这样我就可以看到哪些测试失败/通过了。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T11:41:28.753

让我信服的事件是当我们在连续三个版本中成功地对一个错误进行了三次回归时。一旦我意识到我作为一名程序员的工作效率是多么高，当我在客户提交给客户后不再不断地修复琐碎的错误时，我会产生一种温暖的模糊感觉，即同事的代码会按照他们声称的那样做，我就变成了一个皈依者。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T11:59:30.037

早在我在大型机上进行 Cobol 开发的那一天，我们在我工作的几家公司中都虔诚地这样做了，并且由于环境强制执行它，它被接受为你做事的方式。我认为这是那个时代非常典型的方案，也许其中一些原因可能适用于你：-

像大多数大型机环境一样，我们有三个领域，开发、质量保证和生产。程序员在开发中开发并在那里进行单元测试，一旦他们签署并满意，该单元就会迁移到 QA 环境（带有测试和结果文档），在那里由专门的 QA 人员进行系统测试。向 QA 迁移的开发是一夜之间发生的正式步骤。一旦 QA'ed 代码被迁移到生产环境——我们几乎没有错误。

完成并正确进行单元测试的动机是，如果你没有完成并且 QA 人员发现了一个错误，那么很明显你没有完成这项工作。因此，您的声誉取决于您的严谨程度。当然，大多数人最终会遇到偶尔出现的错误，但是那些一直编写可靠的测试代码的编码人员很快就获得了明星声誉，那些编写有错误代码的人也受到了关注。推动力始终是为了提升您的游戏水平，因此所产生的文化是推动第一次交付无错误代码的文化。

提取相关点 -

1.  编码员的声誉与交付无错误的测试代码有关
2.  与将单元测试代码移动到下一个级别相关的大量开销，因此有动力不要重复这一点并在第一时间把它做好。
3.  由不同的人对单元测试执行系统测试——最好是不同的团队。

我相信您的环境会有所不同，但原则可能是可翻译的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T11:47:35.853

教育和/或认证。

为您的团队成员提供测试领域的正式培训——也许通过认证考试（取决于您的团队成员和您自己对认证的态度）。通过这种方式，您将把测试提升到一个更高的水平，您的团队成员将更有可能对测试采取专业的态度。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T11:49:32.617

有时以身作则是最好的方法。我还发现提醒人们某些事情在测试时不会发生。下次有人要求你写东西时，不管怎样，用测试来做。最终，您的同行会嫉妒您可以轻松更改代码并知道它仍然有效。

至于管理，您需要强调当您需要对未测试的代码库 X 进行更改时，由于发生核爆炸而浪费了多少时间。

许多开发人员在没有确保他们在整个系统中保留行为的情况下没有意识到他们重构了多少。对我来说，这是我认为单元测试和 TDD 的最大好处。

1.  软件需求变更
2.  软件更改以适应要求

唯一确定的是变化。更改未测试的代码要求开发人员了解可能的每一种行为副作用。现实情况是，那些认为他们可以读懂每一个排列的编码人员，都是通过痛苦的试错过程来做到这一点的，直到没有明显的中断。此时他们登记入住。

务实的程序员认识到他/她并不完美且无所不知，而测试就像一张安全网，可以让他们快速安全地走重构的钢丝。

至于何时对新代码编写测试，我必须尽可能多地提倡。花时间定义您希望系统产生的*行为，并最初编写测试以表达那些更高级别的构造。*单元测试可以随着思想的结晶而出现。

希望这可以帮助。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T12:30:02.553

**说服**和**要求**之间有很大的区别。

如果你找到一种方法来说服你的同事写它们 - 太好了。但是，如果您创建一些形式化的规则并要求他们编写单元测试，他们会找到克服这个问题的方法。结果，您将获得一堆毫无价值的单元测试：每个可用的类都将进行单元测试，它们将测试 setter 和 getter。

在创建和执行规则之前三思而后行。开发人员擅长克服它们。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T11:40:51.483

提醒您的团队或其他开发人员他们是专业人士，而不是业余爱好者。为我工作！

此外，它是当今的行业标准。如果没有单元测试经验，对于潜在的未来雇主来说，它们作为雇员的吸引力和价值都较低。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T11:41:27.363

第一次你只需要继续写它们并向人们展示它是值得的。我在三个项目中发现这是说服人们的唯一方法。一些不编码的人（例如初级项目经理）将无法看到价值，直到它正视他们的脸。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T11:42:53.353

在我的软件团队中，我们倾向于针对这些问题编写一个小型商业案例并将其提交给管理层，以便有时间创建和跟踪测试。我们解释说，当关键时刻到来并且一切都在线时，测试所花费的时间得到了很好的弥补。我们还设置了一个 Hudson 构建服务器来集中跟踪单元测试。这使开发人员更容易跟踪失败的测试并发现重复出现的问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T12:02:51.493

作为团队负责人，我有责任确保我的程序员对他们工作的所有模块进行单元测试。我想在这一点上，这甚至不是如何说服他们的问题，这是必需的。有时不是，不是在大型项目上，一直都是。单元测试是防止将必须维护的东西投入生产的第一道防线。如果将某些尚未完全单元和系统测试的东西投入生产，那么它会回来咬你。我想我们在这里支持这一点的政策之一是，如果它在生产中发生故障或导致问题，那么负责编码和测试该模块的程序员将是必须解决问题的人，进行清理等等。仅此一项就是一个很好的动力。
另一个是关于骄傲。我在一家大约有 75 名编码员的商店工作，虽然按某些标准来说这很大，但它真的很小，足以让我们所有人都互相认识。它也足够小，我们知道彼此在做什么，当它进入生产时，我们知道任何异常终止、故障等。如果你小心，做单元和系统测试，移动某物的机会在不引起故障的情况下生产量显着增加。将某些东西投入生产并未能实现可能需要一两次时间，但不搞砸会带来巨大的回报。当您搬入一个项目并且它没有搞砸时，在走廊里听到祝贺真是太好了。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-23T12:49:42.800

写一堆，证明单元测试提高了你的生产力和代码的质量。如果没有某种证据，有时人们不会相信这是值得的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-10-15T15:02:01.960

因此，在我提出这个问题两年后，我发现一个出乎意料的答案是，需要迁移到新的 SDLC。五年前，我们建立了第一个正式的 SDLC。它改善了我们的情况，但遗漏了一些重要的事情，例如自动化。我们现在正在建立一个新的 SDLC（在新的管理下），其中一个租户是自动化的。不仅仅是自动化的单元测试，还有自动化的功能测试。

我想教训是我想得太小了。如果你要改变你创建软件的方式，那就“全力以赴”并做出巨大的改变，而不是在你不习惯的情况下提出渐进式的改变。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-04-10T06:01:19.260

您可以从 Google 的一项计划中获得一些灵感。他们的测试团队开始在厕所隔间内放置示例、提示和好处，以提高测试自动化优点的知名度。

[https://testing.googleblog.com/2007/01/introducing-testing-on-toilet.html](https://testing.googleblog.com/2007/01/introducing-testing-on-toilet.html)

# ruby-on-rails - 在 Ruby on Rails 中使用迁移

> ID：120467
> 
> 赞同：2
> 
> 时间：2008-09-23T11:38:50.663
> 
> 标签：ruby-on-rails, ruby

我想确认以下分析是正确的：

我正在 RoR 中构建一个网络应用程序。我为我的 postgres db 设计了一个数据结构（大约 70 个表；这种设计在开发过程中可能需要更改和添加以反映 Rails 的做事方式。例如，我设计了一些用户和角色表 - 但如果使用 Restful 有意义身份验证，我将清理它们并替换为 RA 需要的任何内容。）。

我有一个 shellscript，它调用一系列 .sql 文件来用表和初始数据填充空数据库（例如，城镇预先填充了邮政城镇）以及测试数据（例如，公司得到了一些虚拟公司，所以我有数据可以玩）。

例如：

```
CREATE TABLE towns (
  id         integer PRIMARY KEY DEFAULT nextval ('towns_seq'),
  county_id  integer REFERENCES counties ON DELETE RESTRICT ON UPDATE CASCADE,
  country_id integer REFERENCES countries ON DELETE RESTRICT ON UPDATE CASCADE NOT NULL,
  name       text    NOT NULL UNIQUE
); 
```

命题 0：数据比应用程序更持久，因此我确信我希望在数据库级别强制执行引用完整性以及在我的 RoR 模型中进行验证，尽管缺乏 DRYNESS。

命题 1：如果我用 Migrations 替换脚本和 sql 文件，目前无法告诉我的 Postgres 数据库我当前在迁移代码中的 SQL DDL 文件中设置的外键和其他约束。

命题 2：迁移的吹捧的好处是对模式的更改与 RoR 模型代码一起进行版本控制。但是，如果我将脚本和 .sql 文件保存在 railsapp/db 中，我可以很容易地对它们进行版本控制。

命题 3：鉴于迁移缺乏我想要的功能，并且提供了我可以复制的好处，我没有理由考虑使用它们。所以我应该 --skipmigrations 在脚本/生成模型时。

我的问题：如果命题 0 被接受，命题 1、2、3 是真的还是假的，为什么？

谢谢！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T11:49:18.470

命题 1 至少在两种情况下是错误的 - 您可以使用诸如[foreign_key_migrations](http://github.com/vigetlabs/foreign_key_migrations/tree)之类的插件来执行以下操作：

```
def self.up
  create_table :users do |t|
    t.column :department_id, :integer, :references => :departments
  end
end 
```

这会在您的数据库中创建适当的外键约束。

当然，您可能想要在 DDL 中做其他事情，在这种情况下，第二种情况变得更加引人注目：您不必在迁移中使用 Ruby DSL。请尝试以下`execute`方法：

```
def self.up
  execute 'YOUR SQL HERE'
end 
```

这样，您可以将 SQL 脚本的内容保留在迁移中，获得后者的好处（最突出的`down`方法，您在原始问题中没有解决）并保留您喜欢的较低级别的控制。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T11:47:31.733

命题 1 是错误的：如果只在迁移中使用直接 SQL，您绝对可以使用迁移定义引用完整性，有关更多详细信息，请参阅[这篇文章](http://www.robbyonrails.com/articles/2005/11/11/rails-migrations-and-postgresql-constraints)。

命题 2：被吹捧的迁移兴趣在于能够增量地定义您的数据库模型，同时跟踪每个更改添加的内容，并能够在以后轻松回滚任何此类更改。

您必须小心创建/修改事物的顺序，但您可以做到。

要记住的一件事：rails 更适合以应用程序为中心的设计。在 Rails Way(tm) 中，数据库只能通过应用程序活动记录层访问，并使用 web 服务向外部公开数据

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T11:51:53.797

1：你可能想试试[这个插件](http://www.redhillonrails.org/foreign_key_migrations.html)。虽然我自己没有尝试过，但它似乎能够通过迁移添加外键约束。

2：迁移的真正好处是能够在你的数据库历史中*来回切换。*这对您的 .sql 文件来说并不容易。

3：看看上面提到的插件是否适合你，然后决定：）无论如何，如果你不使用它们，这不是大罪！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-01T04:38:24.417

由于您使用的是 Postgres 并且可能不想安装 foreign_key_migrations 插件，所以当我想同时使用迁移和外键约束时，我会这样做。

我向 ActiveRecord::SchemaStatements 添加了一个名为“add_fk_constraint”的 SchemaStatements 方法。这可以放在一些集中的文件中，但在下面的示例迁移文件中，我只是将它内联。

* * *

```
module ActiveRecord
  module ConnectionAdapters # :nodoc:
    module SchemaStatements
      # Example call:
      # add_fk_constraint 'orders','advertiser_id','advertisers','id'
      # "If you want add/alter a 'orders' record, then its 'advertiser_id' had
      #   better point to an existing 'advertisers' record with corresponsding 'id'"
      def add_fk_constraint(table_name, referencing_col, referenced_table, referenced_col)
        fk_name = "#{table_name}_#{referencing_col}"
        sql = <<-ENDSQL
          ALTER TABLE #{table_name}
            ADD CONSTRAINT #{fk_name}
            FOREIGN KEY (#{referencing_col}) REFERENCES #{referenced_table} (#{referenced_col})
            ON UPDATE NO ACTION ON DELETE CASCADE; 
          CREATE INDEX fki_#{fk_name} ON #{table_name}(#{referencing_col});
        ENDSQL
        execute sql
      end
    end
  end
end

class AdvertisersOrders < ActiveRecord::Migration
  def self.up
    create_table :advertisers do |t|
      t.column :name,               :string,  :null => false
      t.column :net_id,             :integer, :null => false
      t.column :source_service_id,  :integer, :null => false, :default => 1
      t.column :source_id,          :integer, :null => false 
    end

    create_table :orders do |t|
      t.column :name,               :string,  :null => false
      t.column :advertiser_id,      :integer, :null => false
      t.column :source_id,          :integer, :null => false
    end
    add_fk_constraint 'orders','advertiser_id','advertisers','id'
  end

  def self.down
    drop_table :orders
    drop_table :advertisers
  end
end 
```

* * *

我希望这对某人有所帮助。它对我非常有用，因为我需要使用 SQL“COPY”调用加载大量外部提供的数据，但我发现迁移系统非常方便。

# nhibernate - NHibernate nvarchar/ntext 截断问题

> ID：120470
> 
> 赞同：4
> 
> 时间：2008-09-23T11:39:01.223
> 
> 标签：nhibernate, sql-server-ce, truncate, ntext

我正在使用 nhibernate 将应用程序的一些用户设置存储在 SQL Server Compact Edition 表中。

这是映射文件的摘录：

```
<property name="Name" type="string" />
<property name="Value" type="string" /> 
```

名称为常规字符串/nvarchar(50)，值在DB中设置为ntext

我正在尝试将大量 xml 写入“Value”属性。我每次都会遇到异常：

```
@p1 : String truncation: max=4000, len=35287, value='<lots of xml..../>' 
```

我用谷歌搜索了很多，并尝试了许多不同的映射配置：

```
<property name="Name" type="string" />
<property name="Value" type="string" >
  <column name="Value" sql-type="StringClob" />
</property> 
```

这是一个例子。其他配置包括“ntext”而不是“StringClob”。那些不抛出映射异常的配置仍然会抛出字符串截断异常。

这是 SQL CE 的问题（“功能”）吗？是否可以使用 nhibernate 将超过 4000 个字符放入 SQL CE 数据库中？如果是这样，谁能告诉我怎么做？

非常感谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-25T09:04:22.873

好的，非常感谢 Artur 在[这个线程](http://groups.google.com/group/nhusers/browse_thread/thread/4f865f0f516234ca)中，这是解决方案：从 SqlServerCeDriver 继承一个新的，并覆盖 InitializeParamter 方法：

```
using System.Data;
using System.Data.SqlServerCe;
using NHibernate.Driver;
using NHibernate.SqlTypes;

namespace MySqlServerCeDriverNamespace
{
    /// <summary>
    /// Overridden Nhibernate SQL CE Driver,
    /// so that ntext fields are not truncated at 4000 characters
    /// </summary>
    public class MySqlServerCeDriver : SqlServerCeDriver
    {
        protected override void InitializeParameter(
            IDbDataParameter dbParam,
            string name,
            SqlType sqlType)
        {
            base.InitializeParameter(dbParam, name, sqlType);

            if (sqlType is StringClobSqlType)
            {
                var parameter = (SqlCeParameter)dbParam;
                parameter.SqlDbType = SqlDbType.NText;
            }

        }
    }
} 
```

然后，在您的 app.config 中使用此驱动程序而不是 NHibernate 的

```
<nhibernateDriver>MySqlServerCeDriverNamespace.MySqlServerCeDriver , MySqlServerCeDriverNamespace</nhibernateDriver> 
```

我看到了很多其他人们遇到这个问题的帖子，并通过将 sql-type 属性更改为“StringClob”来解决它 - 正如在这个线程中所尝试的那样。

我不确定为什么它对我不起作用，但我怀疑这是因为我使用的是 SQL CE 而不是其他数据库。但是你现在有了！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T12:05:43.657

```
<property name="Value" type="string" />
  <column name="Value" sql-type="StringClob" />
</property> 
```

我假设这是一个小错字，因为您已经关闭了属性标签两次。只是指出这一点，以防万一不是错字。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T12:42:14.240

尝试`<property name="Value" type="string" length="4001" />`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T13:13:49.843

试过：

```
<property name="Value" type="string" length="4001" /> 
```

和

```
<property name="Value" type="string" >
  <column name="Value" sql-type="StringClob" length="5000"/>
</property> 
```

恐怕都不起作用......同样的例外 - 它仍然说最大值是4000。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-18T01:02:45.530

为什么要使用子元素语法？

尝试：

```
<property name='Value' type='StringClob' /> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-07T08:53:39.277

在我当前的 SQL CE 和 NHibernate 部署中，我使用 4001 的长度。然后 NHibernate 将这些内容生成为 NTEXT 而不是 NVARCHAR。

试试看。

与 NHibernate 和 SQL CE 一起使用的另一件事是：

```
<session-factory>
  ...
  <property name="connection.release_mode">on_close</property>
</session-factory> 
```

这至少为我解决了一些其他问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-09-01T13:23:06.217

阅读您的帖子后，此修改使其在我的代码中运行

```
protected override void InitializeParameter(IDbDataParameter dbParam,string name,SqlType sqlType)
    {
        base.InitializeParameter(dbParam, name, sqlType);

        var stringType = sqlType as StringSqlType;
        if (stringType != null && stringType.LengthDefined && stringType.Length > 4000)
        {
            var parameter = (SqlCeParameter)dbParam;
            parameter.SqlDbType = SqlDbType.NText;
        }

    } 
```

# agile - 您如何可视化您的 sprint backlog？

> ID：120474
> 
> 赞同：5
> 
> 时间：2008-09-23T11:40:49.770
> 
> 标签：agile, scrum

大多数 Scrum 团队都有某种白板或其他白板，可以在上面可视化当前 sprint 的故事/任务。

我很好奇人们是如何组织这个董事会的？你使用便利贴吗？它们是彩色编码的吗？你如何对任务进行分组？你如何区分任务的状态？ETC...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T18:29:54.653

我见过小组使用白板，并为每组任务使用不同的颜色。

如果你为你的故事使用笔记卡，你也可以把它们放在那里，并按发布/迭代/任务组划分它们。 [这个概念在这里得到了更好的解释。](http://www.mountaingoatsoftware.com/task_boards)

**更新：** 我还使用电子表格来可视化我的冲刺/迭代，因为我的团队并非都在同一地点。我使用[类似于](http://www.mountaingoatsoftware.com/sprint_backlog)Jim 的回答中提到的表格和图表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-25T03:39:56.023

查看[rallydev.com](http://www.rallydev.com/products/editions/)上的 Rally 工具。

根据您的需要，有一个免费的社区版。在给定的 sprint 中跟踪故事和任务非常容易，包括每个故事和任务的估计、实际情况和状态。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T11:58:24.547

不适合所有人，但对于那些运行 TFS 的人来说，[Scrum For Team System](http://scrumforteamsystem.com/en/default.aspx)提供了出色的 sprint backlog 报告。

如果做不到这一点，我个人使用电子表格维护 sprint 积压工作，如[本文所述。](http://www.mountaingoatsoftware.com/sprint_backlog)通过谷歌文档的方式分享。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-24T16:37:28.440

网络上的某个地方有一篇博客文章，其中包含很多 Scrum 板。很高兴看到其他人是如何做到的。也许有人可以为我们找到它:)

我认为这看起来是一种非常全面的做事方式！

[http://www.xpday.net/Xpday2007/session/AgileInGovernment.html](http://www.xpday.net/Xpday2007/session/AgileInGovernment.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T21:00:50.407

我通常在共享网络文件夹上使用 Excel 工作表：一列用于指定任务的“组”，一列用于指定任务本身。对于已完成的任务，我们只需将行标记为绿色。这样做的主要缺点是共享——我还没有找到一个体面的解决方案，允许多人编辑积压工作。我们有一些方法来处理它（通过将更新限制在一天中的特定时间，然后让团队一起更新它），但这仍然很烦人。

对于任务数量较少的 sprint，我们只需将任务写在白板上，并在任务完成时将其划掉。

# sharepoint - 如何部署通用 SharePoint 库

> ID：120484
> 
> 赞同：3
> 
> 时间：2008-09-23T11:43:18.500
> 
> 标签：sharepoint

我们有一个类库，其中保存了很多我们在进行共享点开发时经常使用的东西。你将如何部署这个？现在我们最好的选择是将它放在一个单独的解决方案中，然后部署它，以便将程序集部署到 GAC。这样，我们确保程序集部署到所有应用程序层并且可用。

还有比这更好的方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T12:13:19.190

当然，GAC 是部署程序集的最简单方法。但是，如果您不想在整个服务器上共享此程序集怎么办。或者如果许可证不允许这样做怎么办。

因此，有两种方法可以部署程序集：

1.  GAC（你已经知道了）

2.  BIN 文件夹。要将程序集部署到站点的 bin 文件夹（例如 C:\Inetpub\wwwroot\wss\VirtualDirectories\80），您需要创建自定义安全策略文件并在 web.config 中更改安全级别。这一点都不容易，而且可能非常令人沮丧，但可能非常值得。

更多信息：http: [//msdn.microsoft.com/en-us/library/cc768621.aspx](http://msdn.microsoft.com/en-us/library/cc768621.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T11:52:59.287

GAC 通常是您的最佳选择。就像确保您部署到所有应用程序一样，它在安全性方面也更容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T11:58:03.177

如果我没记错的话，建议将其放入 GAC 中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T12:11:49.147

另外，请记住您必须添加到 web.config 中的 SafeControls 列表。

[http://grounding.co.za/blogs/brett/archive/2008/05/23/sharepoint-register-an-assembly-as-a-safe-control-in-the-web-config-file.aspx](http://grounding.co.za/blogs/brett/archive/2008/05/23/sharepoint-register-an-assembly-as-a-safe-control-in-the-web-config-file.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T12:53:40.390

我决定将它部署到 GAC，因为该程序集不会构成安全风险，因为它不会从 Web 部件中使用。

我进行了一些研究，建议将其部署到 gac。您可能会争辩说，除了 Web 部件之外的所有东西都应该部署到 GAC。由于 Web 部件会带来潜在的安全风险，因此最好制作自己的 CAS 并将其部署到 sharepoint bin。

干杯。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T12:56:50.053

请注意，如果您决定部署到 BIN 文件夹，则可以通过解决方案清单文件部署自定义安全策略设置，例如新的权限集。

# excel - 从 Web 服务器保存 excel 文件时如何解决 [1] IE 错误？

> ID：120497
> 
> 赞同：4
> 
> 时间：2008-09-23T11:49:56.080
> 
> 标签：excel, download, vba

我注意到 Internet Explorer 会在从 Internet 下载的文件（通常为 [1]）中添加方括号中的数字。这给下载 Excel 电子表格带来了一个大问题，因为方括号不是 Excel 工作表名称中的有效文件名字符。这个问题是 IE 特有的，其他浏览器保持相同的文件名。

因此，例如，如果您有一个在文件打开时自动刷新的数据透视表，您将收到一条错误消息，指出名称“file[1].yourPivotTableName”无效。

这个问题有什么解决办法吗？

编辑：似乎无论**HTTP 指令建议的文件名**是什么，IE 在所有情况下都会添加 [1]，这会导致问题！（因此，在这种情况下，关于文件名的答案没有帮助）

编辑：我尝试了一些 VBA 代码，以便在文件打开时以另一个名称保存文件。但是，它不起作用（与以前相同的错误消息）。你认为有办法用 VBA 解决这个问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T12:15:50.217

我认为当您在 IE 中打开电子表格并且 IE 将其保存到临时文件时会发生这种情况。而且我认为只有当电子表格的文件名中包含多个点时才会发生这种情况。用一个简单的“sample.xls”试试。另一种解决方法是告诉用户将文件保存到桌面然后打开它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T13:29:18.620

它是 Internet Explorer 中的内置功能。

停止使用“打开”，开始在文件下载窗口中使用“保存”，否则 IE 会将“[1]”附加到它放置在某个临时文件夹中的文件的文件名中。

[您可以使用System.IO.FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)构建一些 .NET 应用程序，该应用程序捕获创建下载文件或其他内容的事件并重命名文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-27T19:38:09.853

我已经使用这个很酷的家伙提供的 VBA 让它工作了（深情地想着他）。它重命名文件，然后重新附加枢轴。

[http://php.kennedydatasolutions.com/blog/2008/02/05/internet-explorer-breaks-excel-pivot-tables/](http://php.kennedydatasolutions.com/blog/2008/02/05/internet-explorer-breaks-excel-pivot-tables/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-10-08T07:34:56.113

我通过使用传递 3 个参数的方法解决了这个问题：文件名、文件扩展名（不带 .dot）和 HTTP 请求）；然后对文件名和扩展名进行 UTF-8 编码。示例代码：

```
public static String encoding(String fileName, String extension, HttpServletRequest request)
{
    String user = request.getHeader( "user-agent" );
    boolean isInternetExplorer = ( user.indexOf( "MSIE" ) > -1 );
    String var = "";
    try
    {           
    fileName = URLEncoder.encode( fileName, "UTF-8" );
        fileName = fileName.trim().replaceAll( "\\+", " " );
        extension = URLEncoder.encode( extension, "UTF-8" );
        extension = extension.trim().replaceAll( "\\+", " " );
        if ( isInternetExplorer )
        {
        disposition = "attachment; filename=\"" + fileName+"."+extension+"\"";
        }
        else
        {
        var = "attachment; filename*=UTF-8''" + fileName+"."+extension;
        }            
    }
    catch ( UnsupportedEncodingException ence )
    {
    var = "attachment; filename=\"" + fileName+"."+extension;
        ence.printStackTrace();
    }

    return var;
} 
```

这在我的情况下工作得很好。希望对大家有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T12:08:49.640

实际上，正确的 .NET 代码如下：

```
Response.AppendHeader("content-disposition", "attachment;filename=file.xls");
Response.ContentType = "application/vnd.ms-excel"; 
```

注意：**AppendHeader**，而不是**AddHeader**，我认为它只适用于调试 web 服务器和 IIS7。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T07:37:37.183

以下对我有用：

```
private string EncodeFileName(string fileName)
    {
        fileName = HttpUtility.UrlEncode(fileName, Encoding.UTF8).Replace("+", " ");
        if (HttpContext.Current.Request.UserAgent.ToLower().Contains("msie"))
        {
            var res = new StringBuilder();
            var chArr = fileName.ToCharArray();
            for (var j = 0; j < chArr.Length; j++)
            {
                if (chArr[j] == '.' && j != fileName.LastIndexOf("."))
                    res.Append("%2E");
                else
                    res.Append(chArr[j]);
            }
            fileName = res.ToString();
        }
        return "\"" + fileName + "\"";
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-19T20:33:43.327

您可以确保在枢轴的选项框中关闭自动刷新。现在，即使从服务器打开，pivot 也能完美运行

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-04-28T14:05:49.887

将这四行放入您的代码中：

```
response.reset();
response.setHeader("Expires", "0");
response.setHeader("Cache-Control","must-revalidate,post-check=0, pre-check=0");
response.setHeader("Pragma", "public"); 
```

希望这可以帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-08-23T13:01:35.790

我遇到了同样的问题并想出了（imo）一个不需要任何VBA的更好的解决方案。

如果您将“Content-Disposition”标头设置为“attachment; filename=<...>”而不是“inline; filename=<...>”，则普通浏览器将打开允许保存或打开文件的对话框在标题中定义的文件名，但 Internet Explorer 会以一种奇怪的方式运行。它将打开文件下载对话框，如果您按*保存*，它将建议在标题中定义的文件名，但如果您按*打开*，它将文件保存到临时文件夹并使用与*您的 URN 相同*的名称打开它（没有“命名空间”），例如，如果您的 URI 是[http://server/folder/file.html](http://server/folder/file.html)，那么 IE 会将您的文件保存为*file.html*（没有括号，哇哦！）。这导致我们找到一个解决方案：

编写一个脚本来处理来自[http://server/folder/](http://server/folder/) * 的请求，当您需要提供 XLS 文件时，只需重定向到该脚本（使用您的文件名而不是星号），并将*Content-Disposition*设置为*inline*。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2008-09-23T12:12:20.380

在.NET中，我从经验中发现只有这似乎对我有用：

```
 Response.AddHeader("Content-Disposition", "attachment; filename=excel.xls");
            Response.AddHeader("Content-Type", "application/vnd.ms-excel");
            Response.ContentType = "application/vnd.ms-excel"; 
```

重复闻起来很臭，但到目前为止我还没有深入了解它（也许 Sebs 的帖子解释了这一点）。此外，“content-Disposition”值看起来非常挑剔，使用 a : 而不是 a ; 或省略它和“文件名”之间的空格，它会爆炸！

此外，如果您在 IIS 上启用了压缩，这可能会为您解决问题：

```
Response.ClearHeaders() 
```

# delphi - TQuery中的delphi“无效使用关键字”

> ID：120503
> 
> 赞同：4
> 
> 时间：2008-09-23T11:50:49.260
> 
> 标签：delphi, bde, tquery

我正在尝试使用针对文件 Journal.db 的以下 TQuery 的结果填充 TDBGrid：

```
select * from Journal
where  Journal.where = "RainPump" 
```

我都试过了`Journal."Where"`，`Journal.[Where]`都没有用。

我也尝试过：`select Journal.[Where] as "Location"`结果相同。

Journal.db 是由第三方创建的文件，我无法更改字段名称。

问题是我感兴趣的领域被称为'where'并且可以理解地导致上述错误。如何在不导致 BDE（大概）爆炸的情况下引用此字段？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T13:28:19.823

啊，我又爱上了德尔福……我找到了解决方法。TQuery 组件具有 Filter 属性 :-)
我在查询中省略了“Where=” where 子句，同时仍保留所有其他“和”条件。
我将 Filter 属性设置为“Where = 'RainPump'”。
我将 Filtered 属性设置为 True，生活又恢复了。

我仍然想知道是否有更聪明的方法可以使用这种旧技术来做到这一点，但如果它很愚蠢并且有效，那么它并不愚蠢。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-29T17:47:37.820

恐怕阅读此线程的人会产生 BDE SQL 引擎无法处理查询的印象：

```
select * from Journal where Journal."Where" = "RainPump" 
```

并且会浪费他们的时间不必要地绕着它绕圈子。

事实上，这种结构工作得很好。正如您所期望的那样，“Where”周围的引号使 BDE 不会将其解释为关键字。

我不知道 Baldric 的特殊情况出了什么问题，或者他以什么顺序尝试了什么。他将问题描述为查询 *.db 表，但他的 SQL 错误看起来更像是您在直通模式下遇到的问题。或者，可能他简化了提交代码，从而消除了错误的真正原因。

我的测试使用：BDE v.5.2 (5.2.0.2) Paradox for Windows v. 7 (32b) Delphi 5.0 (5.62)

成功的声明的各种版本：

```
select * from Journal D0 where D0."Where" = "RainPump"
select * from Journal where Journal."Where" = "RainPump"
select * from ":common:Journal" D0 where D0."Where" = "RainPump"
select * from ":common:Journal" where ":common:Journal"."Where" = "RainPump"
select * from :common:Journal where Journal."Where" = "RainPump"
select * from ":common:Journal" D0 where D0."GUMPIK" = 3
select * from ":common:Journal" where ":common:Journal"."GUMPIK" = 3
select * from :common:Journal where Journal."GUMPIK" = 3 
```

看起来正确但因“无效使用关键字”而失败的语句版本：

```
select * from ":common:Journal" where :common:Journal."Where" = "RainPump"
select * from :common:Journal where :common:Journal."Where" = "RainPump"
select * from ":common:Journal" where :common:Journal."GUMPIK" = 3
select * from :common:Journal where :common:Journal."GUMPIK" = 3 
```

-阿尔。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T11:56:42.040

像这样重写它，应该可以工作：

```
select * from Journal where Journal.[where] = "RainPump" 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T12:44:49.897

您可以将结果集插入带有“值”（不指定列名）的新表中，您在新表中给出了自己的列名，然后使用 TQuery 从该表中进行选择，例如：

```
Query1.sql.clear;
query1,sql.add('Insert into newtable values (select * from Journal);');
query1.sql.add('Select * from newtable where newcolumn = "Rainpump";');
query1.open; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T11:56:37.437

```
select * from Journal where Journal."where" = "RainPump" 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T12:21:32.480

我，我会重命名尴尬的专栏。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T15:32:56.327

在 MySQL 中，表/列名可以用 `` （带角度的单引号）括起来。我不确定 BDE 允许什么，但您可以尝试将 [where] 替换为 `where`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-11-06T19:43:26.777

好的，所以在任何 SQL 系统中以键盘命名列都是不好的。您会将列命名为“select”或“count”或“alter”或“table”，或者只是为了取乐它“truncate”或“drop”？我希望不会。

即使你在**这个**例子中建立了工作，你也在为任何追随你的人创造一个雷区。照mj2008所说的去做，把血腥的列重命名。

允许此列名称保留是构建系统并将您列入任何项目经理的便便列表的最糟糕示例。

# sql - 优化在 Oracle 上运行缓慢而在 SQL Server 上快速运行的 SELECT 查询

> ID：120504
> 
> 赞同：12
> 
> 时间：2008-09-23T11:50:55.627
> 
> 标签：sql, sql-server, oracle, optimization

我正在尝试在 Oracle 中运行以下 SQL 语句，它需要很长时间才能运行：

```
SELECT orderID FROM tasks WHERE orderID NOT IN 
(SELECT DISTINCT orderID FROM tasks WHERE
 engineer1 IS NOT NULL AND engineer2 IS NOT NULL) 
```

如果我只运行 IN 子句中的子部分，它在 Oracle 中运行得非常快，即

```
SELECT DISTINCT orderID FROM tasks WHERE
engineer1 IS NOT NULL AND engineer2 IS NOT NULL 
```

为什么整个语句在 Oracle 中需要这么长时间？在 SQL Server 中，整个语句运行得很快。

或者，我应该使用更简单/不同/更好的 SQL 语句吗？

有关该问题的更多详细信息：

*   每个订单由许多任务组成
*   将分配每个订单（其中一个或多个任务将设置engineer1 和engineer2）或者可以取消分配订单（其所有任务的engineer 字段都具有空值）
*   我正在尝试查找所有未分配的 orderID。

以防万一，表中有大约 120k 行，每个订单有 3 个任务，因此大约有 40k 个不同的订单。

对答案的回应：

*   我更喜欢在 SQL Server 和 Oracle 中都可以使用的 SQL 语句。
*   任务仅在 orderID 和 taskID 上有一个索引。
*   我尝试了语句的 NOT EXISTS 版本，但在我取消它之前它运行了 3 多分钟。也许需要一个 JOIN 版本的语句？
*   还有一个带有 orderID 列的“订单”表。但我试图通过不将其包含在原始 SQL 语句中来简化问题。

我猜在原始 SQL 语句中，子查询每次都会为 SQL 语句第一部分中的每一行运行 - 即使它是静态的并且只需要运行一次？

执行

```
ANALYZE TABLE tasks COMPUTE STATISTICS; 
```

使我原来的 SQL 语句执行得更快。

尽管我仍然很好奇为什么我必须这样做，以及是否/何时需要再次运行它？

> 统计信息为 Oracle 的基于成本的优化器提供了确定不同执行计划效率所需的信息：例如，表中的行数、行的平均宽度、每列的最高和最低值、每列不同值的数量，索引的聚类因子等。
> 
> 在一个小型数据库中，您可以设置一个工作来每天晚上收集统计数据，然后不用管它。其实这是10g下的默认值。对于较大的实现，您通常必须权衡执行计划的稳定性与数据变化的方式，这是一个棘手的平衡。
> 
> Oracle 还有一个称为“动态采样”的功能，用于对表进行采样以确定执行时的相关统计信息。它更常用于数据仓库，其中采样的开销超过了长时间运行查询的潜在性能提升。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T13:57:51.500

如果您分析所涉及的表，这种类型的问题通常会消失（因此 Oracle 对数据的分布有更好的了解）

```
ANALYZE TABLE tasks COMPUTE STATISTICS; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T11:55:15.380

“IN” - 子句在 Oracle 中非常慢。事实上，Oracle 中的内部查询优化器不能很好地处理带有“IN”的语句。尝试使用“存在”：

```
SELECT orderID FROM tasks WHERE orderID NOT EXISTS 
    (SELECT DISTINCT orderID FROM tasks WHERE
         engineer1 IS NOT NULL AND engineer2 IS NOT NULL)`print("code sample");` 
```

注意：请检查查询是否构建相同的数据结果。

伊迪丝说：哎呀，查询的格式不是很好，但总体思路是正确的。Oracle 必须为第二个（内部）查询完成全表扫描，构建结果，然后将它们与第一个（外部）查询进行比较，这就是它变慢的原因。尝试

```
SELECT orderID AS oid FROM tasks WHERE NOT EXISTS 
    (SELECT DISTINCT orderID AS oid2 FROM tasks WHERE
         engineer1 IS NOT NULL AND engineer2 IS NOT NULL and oid=oid2) 
```

或类似的东西;-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T12:49:45.627

我会尝试使用连接

```
SELECT 
    t.orderID 
FROM 
    tasks  t
    LEFT JOIN tasks t1
        ON t.orderID =  t1.orderID
        AND t1.engineer1 IS NOT NULL 
        AND t1.engineer2 IS NOT NULL
WHERE
    t1.orderID IS NULL 
```

如果将原始查询指定为：

```
SELECT orderID FROM orders WHERE orderID NOT IN 
(SELECT DISTINCT orderID FROM tasks WHERE
 engineer1 IS NOT NULL AND engineer2 IS NOT NULL) 
```

（假设您有列出所有订单的订单表）

然后可以使用连接将其重写为：

```
SELECT 
    o.orderID 
FROM 
    orders o
    LEFT JOIN tasks t
        ON o.orderID =  t.orderID
        AND t.engineer1 IS NOT NULL 
        AND t.engineer2 IS NOT NULL
WHERE
    t.orderID IS NULL 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T12:17:57.590

一些问题：

*   任务中有多少行？
*   上面定义了哪些索引？
*   最近有分析过表格吗？

编写相同查询的另一种方法是：

```
select orderid from tasks
minus
select orderid from tasks
where engineer1 IS NOT NULL AND engineer2 IS NOT NULL 
```

但是，我宁愿希望查询涉及“订单”表：

```
select orderid from ORDERS
minus
select orderid from tasks
where engineer1 IS NOT NULL AND engineer2 IS NOT NULL 
```

或者

```
select orderid from ORDERS
where orderid not in
( select orderid from tasks
  where engineer1 IS NOT NULL AND engineer2 IS NOT NULL
) 
```

或者

```
select orderid from ORDERS
where not exists
( select null from tasks
  where tasks.orderid = orders.orderid
  and   engineer1 IS NOT NULL OR engineer2 IS NOT NULL
) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T12:29:21.540

我同意 TZQTZIO，我没有收到您的询问。

如果我们假设查询确实有意义，那么您可能想尝试按照某些建议使用 EXISTS 并避免 IN。IN 并不总是坏的，并且有可能表明它实际上比 EXISTS 表现更好。

问题标题不是很有帮助。我可以在一个 Oracle 数据库中设置此查询，使其运行缓慢，并使其在另一个数据库中快速运行。有许多因素决定了数据库如何解析查询、对象统计信息、SYS 模式统计信息和参数，以及服务器性能。Sqlserver vs. Oracle 不是这里的问题。

对于那些对查询调优和性能感兴趣并想了解更多信息的人来说，一些要搜索的谷歌术语是“oak table oracle”和“oracle jonathan lewis”。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T13:30:31.220

我认为有几个人拥有几乎正确的 SQL，但缺少内部和外部查询之间的连接。
试试这个：

```
SELECT t1.orderID 
FROM   tasks t1
WHERE  NOT EXISTS
       (SELECT 1 
        FROM   tasks t2 
        WHERE  t2.orderID   = t1.orderID
        AND    t2.engineer1 IS NOT NULL 
        AND    t2.engineer2 IS NOT NULL) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T15:21:05.013

“虽然我仍然很好奇为什么我必须这样做，以及是否/何时需要再次运行它？”

统计信息为 Oracle 的基于成本的优化器提供了确定不同执行计划效率所需的信息：例如，表中的行数、行的平均宽度、每列的最高和最低值、每列不同值的数量，索引的聚类因子等。

在一个小型数据库中，您可以设置一个工作来每天晚上收集统计数据，然后不用管它。其实这是10g下的默认值。对于较大的实现，您通常必须权衡执行计划的稳定性与数据变化的方式，这是一个棘手的平衡。

Oracle 还有一个称为“动态采样”的功能，用于对表进行采样以确定执行时的相关统计信息。它更常用于数据仓库，其中采样的开销超过了长时间运行查询的潜在性能提升。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T11:59:50.567

你的查询不一样吗

```
SELECT orderID FROM tasks
WHERE engineer1 IS NOT NULL OR engineer2 IS NOT NULL 
```

?

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T12:02:18.563

怎么样 ：

```
SELECT DISTINCT orderID FROM tasks t1 WHERE NOT EXISTS (SELECT * FROM tasks t2 WHERE t2.orderID=t1.orderID AND (engineer1 IS NOT NULL OR engineer2 IS NOT NULL)); 
```

我不是优化专家，但也许您也忽略了 Oracle 数据库中的一些索引。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T12:05:22.457

另一种选择是使用 MINUS（MSSQL 除外）

```
SELECT orderID FROM tasks
MINUS
SELECT DISTINCT orderID FROM tasks WHERE engineer1 IS NOT NULL 
AND engineer2 IS NOT NULL 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T13:20:56.113

如果您决定创建一个 ORDERS 表，我会向它添加一个 ALLOCATED 标志，并创建一个位图索引。这种方法还迫使您修改业务逻辑以保持标志更新，但查询速度会快如闪电。这取决于应用程序的查询有多重要。

关于答案，在这种情况下越简单越好。忘记子查询、连接、不同和分组依据，它们根本不需要！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-23T14:04:03.433

表中有多少行满足“engineer1 IS NOT NULL ANDengineer2 IS NOT NULL”条件？

这（大致）告诉您是否值得尝试使用索引来检索关联的 orderid。

在 Oracle 中编写可以很好地处理未索引案例的查询的另一种方法是：

```
select distinct orderid
from
(
select orderid,
       max(case when engineer1 is null and engineer2 is null then 0 else 1)
          over (partition by orderid)
          as max_null_finder
from   tasks
)
where max_null_finder = 0 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-23T14:08:40.100

Oracle 优化器在处理 MINUS 语句方面做得很好。如果您使用 MINUS 重新编写查询，它可能会运行得非常快：

```
SELECT orderID FROM tasks
MINUS
SELECT DISTINCT orderID FROM tasks WHERE
 engineer1 IS NOT NULL AND engineer2 IS NOT NULL 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-23T14:54:17.713

新花样。

**如果**：

*   COUNT() 函数不计算 NULL 值

**和**

*   您希望所有任务的 orderID 都**没有**将engineer1 或engineer2 设置为值

**那么**这应该做你想要的：

```
SELECT orderID
FROM tasks
GROUP BY orderID
HAVING COUNT(engineer1) = 0 AND COUNT(engineer2) = 0 
```

请测试一下。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-10-12T17:56:08.170

我同意 ΤZΩΤZΙΟΥ 和 wearejimbo 的观点，即您的查询应该是......

```
SELECT DISTINCT orderID FROM Tasks 
WHERE Engineer1 IS NULL OR Engineer2 IS NULL; 
```

我不了解 SQL Server，但此查询将无法利用任何索引，因为空行不在索引中。对此的解决方案是以允许创建仅包含空值行的基于函数的索引的方式重新编写查询。这可以通过 NVL2 完成，但可能无法移植到 SQL Server。

我认为最好的答案不是满足您的标准，而是为每个平台编写最适合该平台的不同声明。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2008-09-23T12:16:07.297

这是一种替代方法，我认为它可以满足您的需求：

```
SELECT orderID
 FROM tasks
 GROUP BY orderID
 HAVING COUNT(engineer1) = 0 OR COUNT(engineer2) = 0 
```

我不确定您是否要在 HAVING 子句中使用“AND”或“OR”。听起来根据业务逻辑，这两个字段要么都被填充，要么都为 NULL；如果可以保证，那么您可以将条件减少到仅检查engineer1。

我认为，您的原始查询会为每个 orderID 提供多行，而我的只会提供一个。我猜这没关系，因为您只获取 orderID。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2008-09-23T12:51:35.323

如果在 Engineer1 和 Engineer2 列上没有索引，那么您将始终在 SQL Server 中生成表扫描，以及在 Oracle 中可能存在的等效项。

如果您只需要具有未分配任务的订单，那么以下内容应该在两个平台上都可以正常工作，但您还应该考虑将索引添加到任务表以提高查询性能。

```
SELECT DISTINCT orderID 
FROM tasks 
WHERE (engineer1 IS NULL OR engineer2 IS NULL) 
```

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2008-09-23T12:13:04.417

Oracle 的子查询“不好”。通常最好使用连接。

这是一篇关于如何使用 join 重写子查询的文章： [http ://www.dba-oracle.com/sql/t_rewrite_subqueries_performance.htm](http://www.dba-oracle.com/sql/t_rewrite_subqueries_performance.htm)

# c++ - 在哪里可以找到适用于全屏模式的 Windows Vista 的免费编译器？

> ID：120533
> 
> 赞同：-3
> 
> 时间：2008-09-23T12:00:22.797
> 
> 标签：c++, c, compiler-construction, windows-vista

我需要知道在哪里可以获得适用于 Windows Vista 的 C 和 C++ 编译器的免费版本。我尝试过的许多版本都不能在全屏模式下工作。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-23T12:01:21.123

请看一下[visual studio 2008 速成版](http://www.microsoft.com/express/)。

它是来自 Microsoft 的免费软件 IDE 和编译器，适用于 C#、VB.Net、C++、SQL 和 Web。

Express 系列是 Microsoft Visual Studio 2008 产品的轻量级版本。

我相信它在 IDE 中具有全屏支持。

请参阅[维基百科页面以进一步阅读](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio_Express)。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-23T12:01:57.127

你试过[MinGW](http://www.mingw.org/)吗？它是一个命令行编译器。我没有 Vista，所以我无法测试它，但它应该可以工作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T12:03:04.940

Visual Studio Express 2008（如果免费）。它缺少一些可能是您需要的特定功能。你可以[在这里查看](http://www.microsoft.com/express/)。

我不确定“不在全屏模式下工作”是什么意思。您能否更明确地说明您尝试过的方法以及它到底是如何奏效的？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T12:03:59.637

有关可能的解决方案，请参阅[此](http://www.trnicely.net/misc/vista.html)内容。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T12:39:56.507

You can try the following to see if they work on Vista.

[http://nuwen.net/mingw.html#download](http://nuwen.net/mingw.html#download) (comes with Boost with all the libs already built)

[http://www.tdragon.net/recentgcc/](http://www.tdragon.net/recentgcc/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T12:07:10.313

我会推荐试用 Microsoft Visual Express 软件包。[http://www.microsoft.com/express/](http://www.microsoft.com/express/)。

我发现它们非常适合尝试，尤其是对于不太关心部署和将产品推向市场的单个开发人员。我不确定它是否适用于 Vista，但我不明白为什么它不起作用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T12:18:48.303

除了前面提到的 MSVS 和 MinGW，您还可以尝试[Eclipse CDT](http://www.eclipse.org/cdt/)和[Code::Blocks](http://www.codeblocks.org/)。虽然 MSVS，尤其是 Visual Assist（需要花钱），是一个非常强大和方便的工具，但其他 IDE 具有与更多操作系统一起工作的优势。是的，它们也很强大，也很方便。

*更新*：没错，这些是 IDE，而不是编译器。对于 MS Windows 下的 C++，它们都使用 MinGW 作为编译器。但据我了解，OP 需要的是 IDE。

# .net - 如何更新不同线程中的组件？.NET CF

> ID：120540
> 
> 赞同：1
> 
> 时间：2008-09-23T12:01:54.710
> 
> 标签：.net, multithreading, graphics, compact-framework

我正在编写一个在 PDA 上显示地图的 .NET Compact Framework 应用程序。

我已经创建了一个临时组件，它可以绘制它自己的整个地图，使用其中的几个组件来组成大图。我这样做是为了避免一步绘制整个地图的延迟。

我现在想做的是在他们自己的线程中绘制这些片段，因此地图看起来会作为一个实体增长，并且（同样，更重要的是）避免冻结用户界面的其余部分。

正确知道地图的每一块都是在其 onPaint 方法中绘制的。我的想法是，以某种方式告诉系统“请在线程中执行此代码”。

就像是：

```
protected override void OnPaint(PaintEventArgs e)
    {
       // <code to be executed in a thread>
       e.Graphics.paintTHis();
       e.Graphics.paintThat();
       whateverItTakesToPaintThisPieceOfTheMap();
       // </code to be executed in a thread>
    } 
```

你知道怎么做吗？还是我的方法完全错误？

谢谢你的时间！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T12:04:23.113

方法是错误的。更新 ui 的代码必须在 ui 线程上运行。如果你从另一个线程更新 ui，你会得到一个异常。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-26T23:48:08.567

如果渲染地图很耗时并且您不想冻结 GUI 线程（使您的应用程序无响应），您可以将屏幕划分为单元格。使用后台线程将单元格渲染为位图，使用 Invoke 告诉 GUI 线程绘制完成的单元格，当调用返回时，让线程继续处理下一个单元格。

您需要直接在控件上绘制（而不是在 Paint() 内部），或者您需要调用一个 invalidateRect 并有一些逻辑来确保您计算的图像与系统希望您绘制的图像相匹配。

这将使您的图像逐渐出现，并且您的 UI 将具有响应性。如果用户进行了某种动作，不需要继续绘制，只需中止线程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T12:09:08.547

为了调用从另一个线程更新 UI 的函数，请使用 Form 的 Invoke 函数。

这是一个很好的参考

[http://weblogs.asp.net/justin_rogers/articles/126345.aspx](http://weblogs.asp.net/justin_rogers/articles/126345.aspx)

编辑：正如评论中指出的那样，如果您希望调用代码不等待 UI 线程，BeginInvoke 会更好。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T14:19:07.237

在后台线程中的内存中绘制地图，然后在准备好时（在 UI 线程中）将该光栅图像渲染到屏幕上。如果可能，使用 BufferedGraphics，否则使用 GDI。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T12:08:25.583

我建议你有某种从底层线程到主 UI 线程的消息传递系统。

这样，主 UI 线程进行所有更改并从底层线程触发。还要确保您可以使用这些消息发送一些数据，以防您想将一些复杂的信息发送回主 UI 线程。

# c# - 为什么附加 VS 调试器后应用程序的行为会有所不同？

> ID：120556
> 
> 赞同：2
> 
> 时间：2008-09-23T12:05:16.997
> 
> 标签：c#, visual-studio, sockets, debugging

我有一个用 C# 编写的桌面应用程序。它正在尝试管理套接字连接并失败。如果将同一应用程序附加到 Visual Studio 调试器，则它是成功的。

怎么调试？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T12:10:03.333

我会说连接调试器的时间问题也会稍微减慢代码速度，这可能意味着没有发生竞争条件。

要调试它，请尝试向您的应用程序添加一些日志记录代码，我个人使用[log4net](http://logging.apache.org/log4net/index.html)

当您在 c# 中编码时，您不应该遇到 malloc 等问题。

如果您正在运行一个网络应用程序，那么 VS 中的 cassini 网络服务器和您要部署到的网络服务器也可能存在差异。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T12:07:02.047

通常，时间问题。是否涉及线程？如果是 C/C++，那么由于内存管理错误的行为方式，可能有很多原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T12:09:54.770

在编译器下运行而不是独立运行时，您可能有默认值不同的变量。如果涉及线程，竞争条件可能是另一个想法。

如果您通过 malloc 或 new 分配 RAM，请确保在使用之前正确初始化内存。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T12:15:34.227

这是一个典型的计时例子。

如果它在调试器中工作，那么这意味着您必须稍微重构您的代码来处理这个问题。

现在，如果您的应用程序是一个服务器套接字，它接收来自客户端的连接并尝试为每个连接生成一个线程，您可能必须考虑使用 select() 来管理一个线程中的连接。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T13:21:40.557

我们实际上遇到了类似的问题。时机是其中的关键部分。以及在代码中加入无操作（主要区别与调试代码）。

使用套接字编程，似乎使用 VisualStudio.Net 进行调试就像进行了额外的 Application.DoEvents() 调用。我们发现，除非我们通过调用 Application.DoEvents() 允许组件呼吸（例如处理自己的事件），否则我们的某些东西会失败（非调试）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-11-20T07:29:23.127

当 Visual Studio 附加到您的应用程序时，CLR 和 JIT 具有细微的运行时差异以启用调试。例如垃圾收集是不同的。

[http://stupiddumbguy.blogspot.com/2008/05/net-garbage-collection-behavior-for.html](http://stupiddumbguy.blogspot.com/2008/05/net-garbage-collection-behavior-for.html)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-20T07:59:31.973

这可能是因为您正在调试器中查看具有副作用的属性。虽然这里的其他答案更有可能......

# embedded - 一个任务如何在多个 vxworks 队列上等待？

> ID：120561
> 
> 赞同：3
> 
> 时间：2008-09-23T12:05:48.070
> 
> 标签：embedded, vxworks

我们有一个 vxWorks 设计，它需要一个任务来处理通过两个消息队列发送的高优先级和低优先级消息。
给定优先级的消息必须按 FIFO 顺序处理。

例如，按照接收顺序处理所有高优先级消息，然后处理低优先级消息。如果没有高优先级消息，则立即处理低优先级消息。

有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-26T21:12:30.950

如果您使用命名管道 (pipeDevCreate()、write()、read()) 而不是消息队列，则可以使用 select() 阻塞，直到任一管道中有消息。

每当 select() 触发时，您都会处理高优先级管道中的所有消息。然后您处理来自低优先级管道的单个消息。然后再次调用 select（循环）。

示例代码片段：

```
 // Initialization: Create high and low priority named pipes
 pipeDrv(); //initialize pipe driver
 int fdHi = pipeDevCreate("/pipe/high",numMsgs,msgSize);
 int fdLo = pipeDevCreate("/pipe/low",numMsgs,msgSize);

 ...

 // Message sending thread: Add messages to pipe
 write(fdHi, buf, sizeof(buf));

 ...

 // Message processing Thread: select loop
 fd_set rdFdSet;

 while(1)
 {
     FD_ZERO(&rdFdSet);
     FD_SET(fdHi, &rdFdSet);
     FD_SET(fdLo, &rdFdSet;

     if (select(FD_SETSIZE, &rdFdSet, NULL, NULL, NULL) != ERROR)
     {
         if (FD_ISSET(fdHi, &rdFdSet))
         {
             // process all high-priority messages
             while(read(fdHi,buf,size) > 0)
             {
                 //process high-priority
             }
         }

         if (FD_ISSET(fdLo, &rdFdSet))
         {
             // process a single low priority message
             if (read(fdLo,buf,size) > 0)
             {
                 // process low priority
             }
         }
     }
 } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T12:51:16.837

在 vxWorks 中，您不能直接在多个队列上等待。但是，您可以使用操作系统事件（来自 eventLib）来实现此结果。这是一个简单的代码片段：

```
 MSG_Q_ID lowQ, hiQ;

void Init() {
// Task Initialization Code.  This should be called from the task that will
// be receiving the messages
...
hiQ = msgQCreate(...);
lowQ = msgQCreate(...);
msgQEvStart(hiQ, VX_EV01);  // Event 1 sent when hiQ receives message
msgQEvStart(loQ, VX_EV02);  // Event 2 sent when loQ receives message
...
}
void RxMessages() {
...
  UINT32 ev;   // Event received

   // Blocks until we receive Event 1 or 2
   eventReceive(VX_EV01 | VX_EV02, EVENT_WAIT_ANY, WAIT_FOREVER, &ev);
   if(ev & VX_EV01) {
      msgQReceive(hiQ, ...);
   }
   if(ev & VX_EV02) {
      msgQReceive(loQ, ...);
   }
} 
```

请注意，您需要修改该代码以确保在收到多条消息时排空所有队列。

使用 semEvStart() 函数也可以将相同的机制应用于二进制信号量。

# .net - Windows 2000 下的 WSE 服务器

> ID：120567
> 
> 赞同：0
> 
> 时间：2008-09-23T12:07:44.040
> 
> 标签：.net, windows-server-2000, wse

我在 Windows 2000 机器上遇到 WSE 问题。在Windows 2000 下SoapReceivers.Add 方法崩溃了。看来windows 2000 操作系统不允许在排除地址上启动监听服务。所以我发现我可以在配置文件中将它设置为“false”

但问题仍然存在。任何有想法的人..？？

问候凯..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-25T19:50:06.423

我隐约记得有一堆不同的 WSE 版本 (1-3) 和服务包。我知道不向后兼容的主要版本和版本 2.0 在服务包之间存在一些内部不兼容。您可能有兼容性问题。确保您已安装应用程序所针对的版本。

如果这不是问题，那么看看这个[讨论线程](http://bytes.com/forum/thread376612.html)。它可能会提供一些线索。祝你好运！

# social-networking - 一个好的模式/解决点嫖娼的社交网络用户问题？

> ID：120578
> 
> 赞同：11
> 
> 时间：2008-09-23T12:11:32.363
> 
> 标签：social-networking

[以Digg](http://en.wikipedia.org/wiki/Digg)或 Stack Overflow 之类的任何社交网站为例，它们以某种方式让用户奖励故事、问题等的积分。

所发生的事情与导致小报兴起的过程非常相似，这些小报只为读者提供头条新闻，不提供内容。

用户通常足够聪明，可以找出最大化他们的积分奖励的策略，无论该策略是否与网站的目标相协调。

我确定以下问题

*   人们会用答案淹没更普遍和更有趣的问题。回答更具体的问题需要实际的领域知识。
*   获得最多分数通常与吸引大多数用户有关。给定一个随机的网络人群，不幸的是，这意味着大多数是通用的、主观的、有争议的和非特定的条目。

作为社交网站的创建者，您有独特的机会将社交行为影响到有利的方向。我认为系统对人们行为的影响远远超过了最初的用户种子。

我对旨在解决此问题的模式/解决方案感兴趣：

*   排名算法
*   专家系统
*   限制/创造社交互动方式
*   提供/隐藏的信息

特别是从 Stack Overflow 的角度来看，如何解决诸如“[你最喜欢的程序员卡通是什么](https://stackoverflow.com/questions/84556/whats-your-favorite-programmer-cartoon)”这样的条目成为最受欢迎的条目（我选择这个是因为它是不良现象的一个很好的例子）。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-23T12:22:50.167

关于任何社会计算设计的最重要的教训是，社区动态问题不能纯粹通过技术手段来解决。

换句话说，无论您实施何种解决方案，如果您的用户获得积分（或拖钓或卷入火焰战争或任何其他破坏）比参与社区更重要，这就是他们将要做的事情。

在设计解决方案时，您“简单地”必须确保为那些不只是为了积分而参与其中的人提供足够的好处（徽章、娱乐、信息、奖励反馈）。然后，如果你很幸运，你会吸引到合适的人。

这可能看起来很陈词滥调，但它是 CSCW 研究最重要的结果之一（Olson 和 Olson，2000 年）：除非用户准备好协作/公平竞争/高效，否则再多的技术都无法解决这个问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T12:32:50.220

This isn't fundamentally different from asking what's the best way to stop people from cash whoring in real life. Looking at it in that context, I suspect the only way to stop this behaviour is to remove the opportunity ie don't use points (or money).

The problem is that if you do that, there's no quantifiable reason to get out of bed.

Points and cash both measure social status and ability to influence others. Ability to sequestre resources is a primary sexual selection criterion, which is why greed is so powerful; it is a direct sublimation of the sex drive.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T12:17:26.497

我发现 Stack Overflow 使用的投票系统非常好。其他人基本上判断你是不是专家。好的答案会浮出水面。

我会偏离惩罚那些没有被投票的人，并且可能对那些一直被投票失败的人设置一些门槛，失去积分。

也就是说，对于热门话题，大多数人不会费心整理碎片以找到原石中的钻石。所以你会失去一些好的答案。

Stack Overflow 似乎也在惩罚那些发布丢失未投票答案的人......我的分数在发布后下降了，因为我有几篇帖子的票数为 0。

**[更新]**

回应评论：我认为如果您想要更具体的答案，您必须深入挖掘并查看特定标签的问题。我想最近的帖子*[你最喜欢的“程序员”漫画是什么？](https://stackoverflow.com/questions/84556/whats-your-favorite-programmer-cartoon)*已经表明，人们会用答案淹没更笼统和更“有趣”的问题，因为它们更像是拖延。回答更具体的问题需要实际的领域知识。

至于为什么我的分数下降，这可能是一个错误。当我发布这个答案时，我的分数从 91 上升到 81，然后又上升到 111。由于我不了解堆栈溢出使用的算法，我认为这就是发生的事情。

它可能只是使我的分数正常化。

**[更新 2]**

我认为社交网络必须自我监管。它们本质上由社区拥有和经营。看看去年在[Digg](http://en.wikipedia.org/wiki/Digg)上发生的[AACS Revolt](http://en.wikipedia.org/wiki/AACS_encryption_key_controversy)就足以证明你无法控制它。

诀窍是要有足够多的用户来修改垃圾并修改好东西。

也许雇佣一些可以全职做这件事的版主，或者甚至只是给几个已经证明自己是好公民的人版主权利，对他们的节制给予额外的重视，大多数人在线生活是为了这种认可，有些人可能愿意免费这样做，因为他们将成为某种社交网络精英的成员。

问题是你如何阻止他们滥用这种权力？正如斯坦李喜欢说的：权力越大，责任越大。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T12:34:39.030

Where there's a lot of people you should always expect the casual jerk or childish individual or attention whore or troll to show up. I don't think there's a method, a scientifically proved strategy, a technology to prevent this from happening. After all programmers are (almost always= people, also, and people tend to be quite diverse in behavior, communication skills, patience to bear the stupid, self-consciousness, sense of opportunity and even common sense. Being an heterogeneous group is something that might probably enrich everyone involved.

There shall be, nonetheless, a system to slow down the annoying people. Downvoting and closing question and answers might work - provided that the vast majority of the participants are well-behaved, responsible adults. If this is not the case... well, then everyone who feels offended would better bail out, because there's no value in attending a community where these tenets are widely disregarded.

The chance is that if the subject around which the community gathered in the beginning is quite selective in itself then a natural selection will occurr in the long term. I mean: if someone is REALLY interested in programming after a while he/she will calm down, ask more intelligent answers, give more ponderate answer, more polite comments...

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T12:59:36.880

避免与特定社交网站目标相冲突的条目是不可能的，因为无法防止娱乐和拖延。但是考虑到任何条目，应该很容易确定天气是否与网站目标相协调。

解决方案可能是奖励发布者，如果他们自我监管/标记他们的条目到正确的类别，并为所有用户提供一种过滤掉他们不想看到的类别的**方法**。

例如，在 Stack Overflow 上出现大多数娱乐帖子是因为人们想要收集积分（假设）。如果这个假设是正确的，那么上述模式的解决方案将是，将他的条目标记为*有趣*的人将获得两倍的点赞数。但是，当他过滤掉*娱乐内容时，对标记为**特定*的条目感兴趣的人不会看到它。

 ** * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T13:02:45.390

这与创业基本相同。

由所有者/首席执行官/创始人聘请的最初版主为整个社区定下了基调。

幸运的是，Jeff 和 Co. 也在缓和，因此我们可以在选择要忽略的故事时查看他们的示例。

不过，我发现这是一个非常困难的问题，因为我也很喜欢这些离题的对话，而且我知道，如果我关闭其中一些主题，个人会遭到强烈反对——我已经经历过，其他版主必须在更大程度上。

但这些在任何社区都是成长的痛苦，并且没有技术解决方案。杰夫等人需要在这里培养文化，以便社区的模因和 DNA 被设置并指向一个好的方向。

但这也不是那么容易，因为在你创建一个社区之前，你不知道它的能力，也不知道它会变成什么。你必须让它自己成长一点，并行使轻微的权威，这样你就不会扼杀一些可能比你最初的愿景更好（实际上不可避免地会）的东西。

换句话说，这里的关键是用社会解决方案来解决社会问题——选择强有力的主持人来定下基调并加以执行。

从技术上讲，没有办法阻止人们玩这个系统，尤其是当反馈回路中有其他人时——他们总是会找到一种方法来让其他玩家做他们想做的事。

-亚当

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-23T12:20:07.023

可能很难有一个完全可行的解决方案。本质上，如果人们获得积分的原因对社区有积极的影响，那么积分嫖娼会随着时间的推移提高社区的质量。降低与获得的点数成比例增长的速度的措施是否可行？

（即前 100 分是“正常的”，接下来的 100 分需要 20% 的时间才能达到，等等）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T13:00:09.767

问题是每个人都想被包括在内。看看有 100 多个答案的问题：谁真的会读最后一个？如果我将自己与此站点上的其他人进行比较，我不是任何方面的专家，但我仍然想回答问题（请参阅我现在正在做的事情）。

我希望有人会为其中一些问题建立一个论坛。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-01T17:46:51.713

对于不太受欢迎的问题的答案，可能会有一个“难度”或“晦涩”的乘数。

人们会指出妓女：渴望得到认可是我们的天性。试图阻止他们需要做很多工作，如果你成功了，那么该网站的许多最大贡献者可能会离开。

你需要让你想要的行为对点妓有吸引力。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T13:32:00.517

也许您应该根据投票：浏览量的比率来计算某些东西的声誉。这可能会阻止民粹主义的流行，并将人们的注意力集中在提供一系列不太受欢迎但仍然有效且相关的问题的答案——这些问题实际上可能会引起某人的兴趣。

我实际上想对帖子进行一些编辑和整理 - 许多帖子可以通过一些编辑工作来改进，填写详细信息或提供指向其他来源的链接。但是，如果没有专门的业力嫖娼练习（关于什么对我来说是离题的帖子），我的代表不太可能达到我有权在我可能的实际专业领域这样做的水平实际上有一些有价值的东西要说。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-25T16:52:02.920

将“点”分成不同的类别。如果[Digg](http://en.wikipedia.org/wiki/Digg)或[Reddit](http://en.wikipedia.org/wiki/Reddit)除了“有趣/无趣”投票之外还有“有趣/蹩脚”投票，则可以筛选出“有趣”投票高于其“有趣”投票的事物。

[Slashdot](https://en.wikipedia.org/wiki/Slashdot)有一个审核系统，可以进行此类区分，您可以对其进行过滤，使“+1，Funny”变为“+0，Funny”。哎呀，你甚至可以让“-1，巨魔”像“+5，巨魔”一样工作（不是你应该，但你可以）。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-10-01T18:01:10.120

> 人们会用答案淹没更普遍和更有趣的问题。回答更具体的问题需要实际的领域知识。

首先，我挑战你关于这是一个问题的断言。更一般的问题将拥有更广泛的受众，并且与更多的人相关。问一个诸如“我如何使用？”之类的问题`OBSCURE_TASK`。确实更具体，可能需要更具体的知识来回答，但可能只对在该工具包中以该语言执行该任务的人有用。当它只对少数人感兴趣时，它应该浮到顶部吗？可以通过搜索找到已回答的晦涩问题。浏览更适合查找一般事物。`LANGUAGE``TOOLKIT`

> 用户通常足够聪明，可以找出策略来最大化他们的积分奖励，无论该策略是否与网站的目标相协调。

是的，这就是让其他人参与这个过程的成本。他们会根据自己的愿望和动机行事。如果你真的想根据它是否“与网站的目标相协调”来实施一个声誉系统，你想要一个独裁，而不是一个社区网站。

# .net - 在没有本地管理员的情况下向 VBA 公开 VSTO 功能

> ID：120579
> 
> 赞同：2
> 
> 时间：2008-09-23T12:11:47.493
> 
> 标签：.net, excel, vsto, officedev

将 Dotnet VSTO Excel 加载项中的某些功能公开到 VBA 的最佳方式是什么，而不要求用户是本地管理员（即没有 COM 注册，[没有 HttpListener](http://www.devnewsgroups.net/group/microsoft.public.dotnet.framework/topic49734.aspx)）？是否可以使用 VBA 中的 Microsoft 消息队列？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T13:06:30.903

如果我可以将您的问题解释为“如何在没有 COM 注册的情况下将 .Net 程序集中的功能公开给 Excel”，那么一个很好的解决方案是使用 Excel 的 XLL 接口。基本上一个部署一个 xll shim 和一个关联的 .Net dll。当加载 xll 时，它反映在 dll 上并将其中的函数公开给 Excel。

可以在此处找到开源实现[http://exceldna.typepad.com/blog/2006/01/introducing_exc.html](http://exceldna.typepad.com/blog/2006/01/introducing_exc.html)

一个商业的、封闭的源代码，但功能更丰富的一个在这里 [http://www.managedxll.com/](http://www.managedxll.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T13:20:34.740

您不能简单地将它们实例化为 COM 对象，因为 VSTO 不会在默认应用程序域中运行。

这就是我的做法，诚然，这有点令人费解。这是使用另存为 XLA 文件的 VSTO 工作簿，它在某些方面比纯 VSTO 加载项更灵活。

*   您需要使用 regasm.exe 生成一个类型库，您的 VBA 代码将引用该类型库。

*   在您的 .NET 对象模型中创建一个根工厂类，它能够实例化您想要在 VBA 中使用的任何类（类似于 Office 对象模型中的“应用程序”类）。

*   然后，您需要找到一种方法将对该工厂类的实例的引用传递给 VBA。一旦 VBA 引用了这个工厂类的一个实例，它就可以调用它的方法来实例化 .NET 对象模型中的任何其他对象。

*   要将实例传递给 VBA，请在 VBA 代码中定义一个宏，如下所示

示例代码：

```
Private m_objMyFactory As Object

Public Sub RegisterFactory(MyFactory As Object)

    On Error GoTo ErrHandler
    Set m_objMyFactory = MyFactory
    Exit Sub
ErrHandler:
    MsgBox "An unexpected error occurred when registering the Factory component: " & Err.Description
    Exit Sub
End Sub 
```

*   现在将代码添加到 VSTO ThisWorkbook_Open 事件处理程序，该处理程序实例化您的工厂对象并调用上述宏，传递对工厂对象的引用。

示例代码：

```
void ThisWorkbook_Open()
{
     try
     {
         ThisApplication.Run("RegisterFactory",
             new MyNamespace.MyFactory(),
             Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
             Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
             Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
             Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
             Type.Missing, Type.Missing, Type.Missing, Type.Missing, Type.Missing,
             Type.Missing, Type.Missing, Type.Missing, Type.Missing);
     }
     catch (Exception ex)
     {
         MessageBox.Show("Load error: " + ex.ToString());
     }
} 
```

要使这项工作稳健地运行，还有一些问题需要考虑 - 如果您有兴趣跟进，请告诉我，我会发布更多详细信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-04T12:13:56.183

您可能对 Excel4Net 感兴趣（它类似于 ExcelDNA 和 ManagedXll，但更易于使用）：

网址： [http ://www.excel4net.com](http://www.excel4net.com)

博客： [http ://excel4net.blogspot.com](http://excel4net.blogspot.com)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-16T15:40:12.167

仅供未来读者参考：您可能还想看看这个问题：

[从 VBA (Excel) 访问 VSTO 应用程序插件类型](https://stackoverflow.com/questions/1474205/accessing-a-vsto-application-addin-types-from-vba-excel)

尤其是那里引用的博客：

[VSTO 加载项、COMAddIns 和 RequestComAddInAutomationService](http://blogs.msdn.com/b/andreww/archive/2007/01/15/vsto-add-ins-comaddins-and-requestcomaddinautomationservice.aspx)

通过重写**RequestComAddInAutomationService()**，您可以通过定义为所有这些功能提供入口点的 Facade 类并将该类公开给 VBA 来公开您想要的任何功能。

# python - PyGame 应用程序中的 SVG 渲染。在 Pygame 2.0 之前，Pygame 不支持 SVG。那你是怎么加载的？

> ID：120584
> 
> 赞同：27
> 
> 时间：2008-09-23T12:13:14.777
> 
> 标签：python, svg, pygame, widget, pygame-surface

在[pyGame](http://www.pygame.org/)应用程序中，我想渲染 SVG 中描述的无分辨率 GUI 小部件。

我可以使用什么工具和/或库来实现这个目标？

（我喜欢[OCEMP GUI](http://ocemp.sourceforge.net/gui.html)工具包，但它的渲染似乎依赖于位图）

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-04T19:23:54.163

这是一个完整的例子，它结合了其他人的提示。它应该从当前目录呈现一个名为 test.svg 的文件。它在 Ubuntu 10.10、python-cairo 1.8.8、python-pygame 1.9.1、python-rsvg 2.30.0 上进行了测试。

```
#!/usr/bin/python

import array
import math

import cairo
import pygame
import rsvg

WIDTH = 512
HEIGHT = 512

data = array.array('c', chr(0) * WIDTH * HEIGHT * 4)
surface = cairo.ImageSurface.create_for_data(
    data, cairo.FORMAT_ARGB32, WIDTH, HEIGHT, WIDTH * 4)

pygame.init()
window = pygame.display.set_mode((WIDTH, HEIGHT))
svg = rsvg.Handle(file="test.svg")
ctx = cairo.Context(surface)
svg.render_cairo(ctx)

screen = pygame.display.get_surface()
image = pygame.image.frombuffer(data.tostring(), (WIDTH, HEIGHT),"ARGB")
screen.blit(image, (0, 0)) 
pygame.display.flip() 

clock = pygame.time.Clock()
while True:
    clock.tick(15)
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            raise SystemExit 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2018-06-27T08:39:54.393

这个问题已经很老了，但是已经过去了 10 年，并且有新的可能性起作用并且不再需要`librsvg`了。nanosvg 库上有[Cython 包装器](https://github.com/ethanhs/pynanosvg)，它可以工作：

```
from svg import Parser, Rasterizer

def load_svg(filename, surface, position, size=None):
    if size is None:
        w = surface.get_width()
        h = surface.get_height()
    else:
        w, h = size
    svg = Parser.parse_file(filename)
    rast = Rasterizer()
    buff = rast.rasterize(svg, w, h)
    image = pygame.image.frombuffer(buff, (w, h), 'ARGB')
    surface.blit(image, position) 
```

我发现 Cairo/rsvg 解决方案太复杂而无法工作，因为安装依赖项非常模糊。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-23T12:52:32.950

您可以使用支持渲染 SVG 的[Cairo](http://www.cairographics.org/)（使用 PyCairo）。PyGame 网页有一个[HOWTO](http://www.pygame.org/wiki/CairoPygame)用于使用 Cairo 渲染到缓冲区，并直接使用 PyGame 使用该缓冲区。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2020-10-29T19:32:25.280

**Pygame 版本 2.0 支持 SVG 文件**。自 2.0.2 版起，SDL Image 支持 SVG（[可缩放矢量图形](https://en.wikipedia.org/wiki/Scalable_Vector_Graphics)）文件（请参阅[SDL_image 2.0](https://www.libsdl.org/projects/SDL_image)）。因此，使用 pygame 版本 2.0.1，可以将 SVG 文件加载到[`pygame.Surface`](https://www.pygame.org/docs/ref/surface.html)对象中[`pygame.image.load()`](http://www.pygame.org/docs/ref/image.html)：

```
surface = pygame.image.load('my.svg') 
```

在 Pygame 2 之前，您必须使用其他库实现[可缩放矢量图形](https://en.wikipedia.org/wiki/Scalable_Vector_Graphics)加载。以下是有关如何执行此操作的一些想法。

* * *

一个非常简单的解决方案是使用[CairoSVG](https://cairosvg.org/)。使用该功能`cairosvg.svg2png`，可以将[矢量图形（SVG）](https://de.wikipedia.org/wiki/Scalable_Vector_Graphics)文件直接转换为[便携式网络图形（PNG）]文件

安装[CairoSVG](https://pypi.org/project/CairoSVG/)。

```
pip install CairoSVG 
```

编写一个将 SVF 文件转换为 PNG ( [`ByteIO`](https://docs.python.org/3/library/io.html)) 并创建[`pygame.Surface`](https://www.pygame.org/docs/ref/surface.html)对象的函数可能如下所示：

```
import cairosvg
import io

def load_svg(filename):
    new_bites = cairosvg.svg2png(url = filename)
    byte_io = io.BytesIO(new_bites)
    return pygame.image.load(byte_io) 
```

另请参阅[加载 SVG](https://github.com/Rabbid76/PyGameExamplesAndAnswers/blob/master/documentation/pygame/pygame_surface_and_image.md#load-svg)

* * *

另一种方法是使用*svglib*。但是，透明背景似乎存在问题。关于这个主题有一个问题[如何使png背景透明？第171](https://github.com/deeplook/svglib/issues/171)章

安装[svglib](https://pypi.org/project/svglib/)。

```
pip install svglib 
```

解析和光栅化 SVG 文件并创建[`pygame.Surface`](https://www.pygame.org/docs/ref/surface.html)对象的函数可能如下所示：

```
from svglib.svglib import svg2rlg
import io

def load_svg(filename):
    drawing = svg2rlg(filename)
    str = drawing.asString("png")
    byte_io = io.BytesIO(str)
    return pygame.image.load(byte_io) 
```

* * *

另一个简单的解决方案是使用*pynanosvg*。此解决方案的缺点是*nanosvg*不再受到积极支持，并且不适用于 Python 3.9。[pynanosvg](https://github.com/ethanhs/pynanosvg)可用于加载和栅格化[矢量图形 (SVG)](https://de.wikipedia.org/wiki/Scalable_Vector_Graphics)文件。安装[Cython](https://cython.org/)和[pynanosvg](https://github.com/ethanhs/pynanosvg)：

```
pip install Cython
pip install pynanosvg 
```

可以[`pygame.Surface`](https://www.pygame.org/docs/ref/surface.html)使用以下函数读取、光栅化并加载 SVG 文件到对象中：

```
from svg import Parser, Rasterizer

def load_svg(filename, scale=None, size=None, clip_from=None, fit_to=None, foramt='RGBA'):
    svg = Parser.parse_file(filename)
    scale = min((fit_to[0] / svg.width, fit_to[1] / svg.height)
                if fit_to else ([scale if scale else 1] * 2))
    width, height = size if size else (svg.width, svg.height)
    surf_size = round(width * scale), round(height * scale)
    buffer = Rasterizer().rasterize(svg, *surf_size, scale, *(clip_from if clip_from else 0, 0))
    return  pygame.image.frombuffer(buffer, surf_size, foramt) 
```

* * *

最小的例子：

[![](https://i.stack.imgur.com/LOMwY.png)](https://i.stack.imgur.com/LOMwY.png)

```
import cairosvg
import pygame
import io

def load_svg(filename):
    new_bites = cairosvg.svg2png(url = filename)
    byte_io = io.BytesIO(new_bites)
    return pygame.image.load(byte_io)

pygame.init()
window = pygame.display.set_mode((300, 300))
clock = pygame.time.Clock()

pygame_surface = load_svg('Ice-001.svg')
size = pygame_surface.get_size()
scale = min(window.get_width() / size[0], window.get_width() / size[1]) * 0.8
pygame_surface = pygame.transform.scale(pygame_surface, (round(size[0] * scale), round(size[1] * scale)))

run = True
while run:
    clock.tick(60)
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            run = False

    window.fill((127, 127, 127))
    window.blit(pygame_surface, pygame_surface.get_rect(center = window.get_rect().center))
    pygame.display.flip()

pygame.quit()
exit() 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-23T15:16:51.373

我意识到这并不能完全回答您的问题，但是有一个名为[Squirtle](http://www.supereffective.org/?p=14)的库将使用 Pyglet 或 PyOpenGL 呈现 SVG 文件。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T15:17:06.193

Cairo 无法开箱即用地渲染 SVG。看来我们必须使用 librsvg。

刚找到这两个页面：

*   [使用 libRSVG、Python 和 c-types 渲染 SVG](http://www.cairographics.org/cookbook/librsvgpython/)
*   [如何在 Python 中使用 librsvg](http://www.cairographics.org/pyrsvg/)

像这样的东西应该可以工作（渲染**test.svg**到**test.png**）：

```
import cairo
import rsvg

WIDTH, HEIGHT  = 256, 256
surface = cairo.ImageSurface(cairo.FORMAT_ARGB32, WIDTH, HEIGHT)

ctx = cairo.Context (surface)

svg = rsvg.Handle(file="test.svg")
svg.render_cairo(ctx)

surface.write_to_png("test.png") 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-30T08:24:24.353

[pygamesvg](http://paul.giannaros.org/sandbox_pygamesvg)似乎做你想做的（虽然我还没有尝试过）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-02-09T21:06:29.380

最后一条评论在我运行它时崩溃了，因为 svg.render_cairo() 期望的是 cairo 上下文而不是 cairo 表面。我创建并测试了以下功能，它似乎在我的系统上运行良好。

```
import array,cairo, pygame,rsvg

def loadsvg(filename,surface,position):
    WIDTH = surface.get_width()
    HEIGHT = surface.get_height()
    data = array.array('c', chr(0) * WIDTH * HEIGHT * 4)
    cairosurface = cairo.ImageSurface.create_for_data(data, cairo.FORMAT_ARGB32, WIDTH, HEIGHT, WIDTH * 4)
    svg = rsvg.Handle(filename)
    svg.render_cairo(cairo.Context(cairosurface))
    image = pygame.image.frombuffer(data.tostring(), (WIDTH, HEIGHT),"ARGB")
    surface.blit(image, position) 

WIDTH = 800
HEIGHT = 600
pygame.init()
window = pygame.display.set_mode((WIDTH, HEIGHT))
screen = pygame.display.get_surface()

loadsvg("test.svg",screen,(0,0))

pygame.display.flip() 

clock = pygame.time.Clock()
while True:
    clock.tick(15)
    event = pygame.event.get()
    for e in event:
        if e.type == 12:
            raise SystemExit 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2014-10-04T00:43:37.263

根据其他答案，这是一个将 SVG 文件读入 pygame 图像的函数 - 包括更正颜色通道顺序和缩放：

```
def pygame_svg( svg_file, scale=1 ):
    svg = rsvg.Handle(file=svg_file)
    width, height= map(svg.get_property, ("width", "height"))
    width*=scale; height*=scale
    data = array.array('c', chr(0) * width * height * 4)
    surface = cairo.ImageSurface.create_for_data( data, cairo.FORMAT_ARGB32, width, height, width*4)
    ctx = cairo.Context(surface)
    ctx.scale(scale, scale)
    svg.render_cairo(ctx)

    #seemingly, cairo and pygame expect channels in a different order...
    #if colors/alpha are funny, mess with the next lines
    import numpy
    data= numpy.fromstring(data, dtype='uint8')
    data.shape= (height, width, 4)
    c= data.copy()
    data[::,::,0]=c[::,::,1]
    data[::,::,1]=c[::,::,0]
    data[::,::,2]=c[::,::,3]
    data[::,::,3]=c[::,::,2]

    image = pygame.image.frombuffer(data.tostring(), (width, height),"ARGB")
    return image 
```

# unix - 将单个 qmail 别名转发到 /dev/null 的最佳方法是什么？

> ID：120587
> 
> 赞同：1
> 
> 时间：2008-09-23T12:14:23.743
> 
> 标签：unix, sysadmin, qmail

我想丢弃由单个 qmail 别名收到的邮件。我不希望出现任何邮件投递错误，并且我希望 qmail 对已投递邮件感到高兴。

我该怎么做，最好不要添加另一个本地电子邮件帐户？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T12:47:33.273

通过使用以下内容创建文件 /var/qmail/aliases/.qmail-blackhole 来创建*别名*：

```
|cat >/dev/null 
```

然后将你想要的任何东西重定向到这个“黑洞”别名（或使用任何你想要的东西来代替“黑洞”）。仅仅使用 /dev/null 是行不通的（`Unable_to_write_/dev/null`）。

但是，这些消息仍将被记录。虽然它更像是一个功能而不是一个错误。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-17T17:46:11.670

创建一个只有评论而没有交付说明的别名，例如：

```
echo "# drop all messages on the floor" > ~alias/.qmail-devnull 
```

当然，用您需要的任何别名替换“devnull”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-24T19:04:32.113

一个元问题：为什么会被降级？它不适合该网站吗？

# sql - 使用 Hibernate 进行不区分大小写的搜索

> ID：120588
> 
> 赞同：50
> 
> 时间：2008-09-23T12:14:35.147
> 
> 标签：sql, hibernate, select, case-sensitive

我正在使用 Hibernate 将我的 Java 应用程序的 ORM 用于 Oracle 数据库（不是数据库供应商很重要，我们可能有一天会切换到另一个数据库），我想根据用户提供的字符串从数据库中检索对象。例如，在搜索人时，如果用户正在寻找住在“弗兰”的人，我希望能够给她在旧金山的人。

SQL 不是我的强项，我更喜欢 Hibernate 的`Criteria`构建代码而不是硬编码字符串。谁能指出我如何在代码中做到这一点的正确方向，如果不可能，硬编码的 SQL 应该是什么样子？

谢谢，

尤瓦尔=8-)

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-09-23T12:26:16.180

对于您描述的简单案例，请查看 Restrictions.ilike()，它执行不区分大小写的搜索。

```
Criteria crit = session.createCriteria(Person.class);
crit.add(Restrictions.ilike('town', '%fran%');
List results = crit.list(); 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2008-11-14T14:00:21.187

```
Criteria crit = session.createCriteria(Person.class);
crit.add(Restrictions.ilike('town', 'fran', MatchMode.ANYWHERE);
List results = crit.list(); 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-22T19:30:46.757

如果您使用 Spring 的 HibernateTemplate 与 Hibernate 交互，那么您将如何对用户的电子邮件地址进行不区分大小写的搜索：

```
getHibernateTemplate().find("from User where upper(email)=?", emailAddr.toUpperCase()); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-23T12:22:00.667

忽略大小写的常用方法是将数据库值和输入值都转换为大写或小写 - 生成的 sql 将具有类似

```
select f.name from f where TO_UPPER(f.name) like '%FRAN%' 
```

在休眠标准中，restrictions.like(...).ignoreCase()

我对 Nhibernate 更熟悉，所以语法可能不是 100% 准确

有关更多信息，请参阅[pro hibernate 3 extract](http://books.google.co.uk/books?id=AM1Od544ei0C&pg=PA136&lpg=PA136&dq=restrictions.like+case+insensitive&source=web&ots=5xx49wOSoS&sig=sgNywi0_xScHaAeRnySueLVU_x0&hl=en&sa=X&oi=book_result&resnum=4&ct=result)和[hibernate docs 15.2。缩小结果集](http://www.hibernate.org/hib_docs/reference/en/html/querycriteria-narrowing.html)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-23T14:36:36.227

您也不必输入“%”通配符。您可以传递[MatchMode](http://docs.jboss.org/hibernate/orm/4.2/javadocs/org/hibernate/criterion/MatchMode.html)（[此处为以前版本的文档](http://www.hibernate.org/hib_docs/v3/api/org/hibernate/criterion/MatchMode.html)）来告诉搜索如何表现。 `START`、`ANYWHERE`、`EXACT`和`END`匹配是选项。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-11-03T17:37:17.107

这也可以使用 org.hibernate.criterion 包中的标准示例来完成。

```
public List findLike(Object entity, MatchMode matchMode) {
    Example example = Example.create(entity);
    example.enableLike(matchMode);
    example.ignoreCase();
    return getSession().createCriteria(entity.getClass()).add(
            example).list();
} 
```

只是我发现完成上述任务的另一种方式。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-09-19T18:59:34.337

由于不推荐使用 Hibernate 5.2 `session.createCriteria`。以下是使用 JPA 2 CriteriaBuilder 的解决方案。它使用`like`和`upper`：

```
 CriteriaBuilder builder = session.getCriteriaBuilder();
    CriteriaQuery<Person> criteria = builder.createQuery(Person.class);
    Root<Person> root = criteria.from(Person.class);

    Expression<String> upper = builder.upper(root.get("town"));
    criteria.where(builder.like(upper, "%FRAN%"));

    session.createQuery(criteria.select(root)).getResultList(); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T12:17:35.500

大多数默认数据库排序规则不区分大小写，但在 SQL Server 世界中，它可以在实例、数据库和列级别进行设置。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T12:18:32.783

您可以查看在 lucene 之上使用 Compass 包装器。

[http://www.compass-project.org/](http://www.compass-project.org/)

通过向您的域对象添加一些注释，您可以实现这种事情。

Compass 为使用 Lucene 提供了一个简单的 API。如果您知道如何使用 ORM，那么您会对 Compass 感到宾至如归，只需简单的保存、删除和查询操作即可。

从网站本身。“在 Lucene 之上构建，Compass 简化了 Lucene 的常见使用模式，例如 google 风格的搜索、索引更新以及更高级的概念，例如缓存和索引分片（子索引）。Compass 还使用内置优化来实现并发提交和合并。”

我过去用过这个，我觉得它很棒。

# asp.net - NHibernate 中的自动更新包

> ID：120596
> 
> 赞同：2
> 
> 时间：2008-09-23T12:16:05.580
> 
> 标签：asp.net, database, nhibernate

我使用 ASP.Net 和 NHibernate 访问 Pgsql 数据库。

对于我们的一些对象，我们使用 NHibernate 包，它映射到我们应用程序中的列表对象。有时，当我们更新与数据库中的列表有关的任何内容时，我们需要通过 NHibernate 刷新对象。

```
<bag name="Objects" inverse="true" lazy="true" generic="true" >
   <key column="object_id" />
   <one-to-many class="Object" />
</bag> 
```

以上是我用于我们的包的代码示例。

我想知道是否有其他人在任何地方遇到过这个问题，以及您如何解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T12:27:47.893

您是否尝试过 NHibernate 级联，例如保存更新？

> 您可以告诉 NHibernate 自动遍历实体的关联，并根据级联选项进行操作。例如，使用 save-update 级联将未保存的实体添加到集合中将导致它与其父对象一起保存，而无需我们方面的任何明确说明。

以下是每个级联选项的含义：

*   **none** - 不做任何级联，让用户处理它们
*   **保存更新**- 当对象被保存/更新时，检查关联并保存/更新任何需要它的对象（包括保存/更新多对多场景中的关联）。
*   **delete** - 当对象被删除时，删除关联中的所有对象。
*   **delete-orphans** - 当对象被删除时，删除关联中的所有对象。除此之外，当一个对象从关联中删除并且不与另一个对象关联（孤立）时，也将其删除。
*   **all** - 当一个对象被保存/更新/删除时，检查关联并保存/更新/删除找到的所有对象。
*   **all-delete-orphans** - 保存/更新/删除对象时，检查关联并保存/更新/删除找到的所有对象。除此之外，当一个对象从关联中删除并且不与另一个对象关联（孤立）时，也将其删除。

更多信息： [NHibernate Cascades：all、all-delete-orphans 和 save-update 之间的区别](http://ayende.com/Blog/archive/2006/12/02/NHibernateCascadesTheDifferentBetweenAllAlldeleteorphansAndSaveupdate.aspx)

# google-visualization - 谷歌图表的动力是什么？

> ID：120601
> 
> 赞同：3
> 
> 时间：2008-09-23T12:17:45.577
> 
> 标签：google-visualization

有没有人知道 Google Charts 的强大功能？我已经使用了一段时间，但不确定 Google 使用什么来构建它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-11-05T16:30:49.443

他们购买了用于制作图表的[Gapminder](http://www.gapminder.org/)库。据我所知，这是一个 Java 库，但他们似乎并不急于将代码作为开源发布。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T12:35:02.557

Everything at google is done in C++, Java, or Python. I'm guessing the internals is probably done in one of the latter two.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T13:57:07.803

Mathplotlib 也是我的猜测——（感谢“davidg”）。

SVG - 我有自己的疑问，因为您不必为了生成静态图像而花费服务器端 SVG 的长度。不需要平移或缩放，因此不确定他们是否使用 SVG

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T12:32:12.157

Just guessing here: they must be using Python with some charting library and then returning the produced files. There are a few tools to do charts in Python. [Matplotlib](http://matplotlib.sourceforge.net/) and [ReportLab](http://www.reportlab.org/downloads.html) come to mind.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T12:25:20.880

我在那里感受到了SVG的触感..

可能是用于生成和使用 SVG 并将图像导出为 PNG 图像的内部引擎。

还有其他想法吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-04T18:40:30.630

可以肯定的是，您可以使用 Java servlet 来完成。

[Eastwood](http://www.jfree.org/eastwood/)是 Google Chart API 的开源实现。（由[JFreeChart](http://www.jfree.org/jfreechart/)提供支持）

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2008-09-23T12:34:01.793

Probably just libraries they have written themselves, it's pretty easy to throw together a chart drawing library, but hard to do it right. So someone hacked together a custom java/C++/python library using already available stuff to be able to update the graphics of his charts easily, and then it extended.

That's the great thing about it, that you can make your own version without much effort, just change the URL and design your own flash animation of the chart. And that the data available in the graphs is easily webscraped..

Just theory, but something like this is perfect small project to do in 20% of your time.

# asp-classic - 经典的 asp 包括

> ID：120607
> 
> 赞同：2
> 
> 时间：2008-09-23T12:19:11.610
> 
> 标签：asp-classic, vbscript, externalizing

我正在尝试将一些 asp 逻辑分离到一个单独的页面中。现在，我正在尝试调用一个简单的函数。

这是我正在使用的简单索引页面

```
<html>
<head>
<title>Calling a webservice from classic ASP</title>
</head>
<body>
<%
If Request.ServerVariables("REQUEST_METHOD") = "POST" Then
 %>
  <!--#include file="aspFunctions.asp"-->
  <%
  doStuff()
End If
%>
<FORM method=POST name="form1" ID="Form1">
ID:
<INPUT type="text" name="corpId" ID="id" value="050893">
<BR><BR>
<INPUT type="submit" value="GO" name="submit1" ID="Submit1" >
</form>
</body>
</html> 
```

这是 aspfunctions.asp

```
sub doStuff()
    Response.Write("In Do Stuff")
end sub 
```

当我点击表单上的提交按钮时，我得到以下子 doStuff() Response.Write("In Do Stuff") end sub

Microsoft VBScript 运行时错误“800a000d”

有谁知道我做错了什么？

任何帮助是极大的赞赏

谢谢 Damien 类型不匹配：'doStuff'

/uat/damien/index.asp，第 15 行

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-23T12:22:15.910

您必须在 <% %> 标记内包含 asp 函数。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T12:24:41.240

`aspfunctions.asp`应该在标签内，以便“执行”asp，例如

aspfunctions.asp 文件：

```
<%
sub doStuff()
    Response.Write("In Do Stuff")
end sub
%> 
```

否则 asp in`aspfunctions.asp`只是被视为纯文本，因此就服务器而言，`doStuff`从未定义过。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-23T13:04:50.050

您在 if 语句中包含另一个文件。这并不意味着它是动态包含的，它不是。它将始终包含在内。

要查看实际情况，请尝试以下示例：

```
<%
If 1=0 Then
'We never get here
%>
    <!--#include file="aspFunctions.asp"-->
<%
    dostuff()
End If
dostuff()
%> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T12:21:18.890

如果我没记错的话，没有返回值的调用不需要括号（未经测试的解决方案）：

```
doStuff 
```

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2012-08-27T09:10:08.583

在两个地方进行更改：

1.  在 aspfunctions.asp 中写“sub doStuff”而不是`sub doStuff()`
2.  调用函数`doStuff`不`doStuff()`

# olap - 如何在 MDX 中将级别的总和显示为其最后一个子级的值

> ID：120616
> 
> 赞同：1
> 
> 时间：2008-09-23T12:21:10.890
> 
> 标签：olap, mdx

我有一个 MDX 查询，它列出了 OLAP 数据库中所有“周”和“日”级别的度量。例如

```
SELECT 
{
    HIERARCHIZE( {[Business Time].[Week].members, [Business Time].[Date].members} )
} 
ON ROWS,
{
    [Measures].[Quantity]
} 
ON COLUMNS 
FROM [Sales] 
```

但是，在显示一周的度量值的地方，我不想显示所有 Day 值的总和，而是想显示一周内最后一天的值。例如

**第 1 周：12** 日 9 月 15 日：10
9 月 16 日：20
9 月 17 日：12
日 9 月 18 日：15
9 月 19 日：8 9 月
20 日：9
日 9 月 21 日：12
**第 2 周：15** 9 月 22 日：12
9 月 23 日：15

如何在 MDX 中实现这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T12:42:33.147

在 MDX 的开头添加一个新的计算度量，仅当它显示在一周级别时才显示最后一天的值，否则保持不变：

```
WITH MEMBER [Measures].[Blah] AS 
'IIF(
   [Business Time].currentMember.level.name = "Week",
   ([Business Time].currentMember.lastChild, [Measures].[Quantity]),
   ([Business Time].currentMember, [Measures].[Quantity])
)' 
```

我预计会有客户提出这个奇怪的要求，并且我预计您会在一个月内接到来自同一办公室的某人的电话，说这份报告中的每周“总计”是错误的！

# logging - 登录 J2ME

> ID：120618
> 
> 赞同：17
> 
> 时间：2008-09-23T12:21:17.440
> 
> 标签：logging, java-me, mobile, mobile-phones

j2me 有哪些日志记录解决方案？

我特别感兴趣的是轻松排除“发布”版本的日志记录，以获得更小的包和内存占用。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-23T13:18:03.607

MicroLog 是肯定的。它是一个用于 Java ME (J2ME) 的小型日志库，例如 Log4j。它支持记录到控制台、文件、RecordStore、Canvas、Form、蓝牙、串行端口（蓝牙、IR、USB）、套接字（包括 SSL）、UDP、Syslog、MMS、SMS、电子邮件或 Amazon S3 .

[http://sourceforge.net/projects/microlog/](http://sourceforge.net/projects/microlog/)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-23T13:42:26.107

如果您使用 Proguard 进行预处理和混淆，那么您可以拥有一个简单的日志记录类。

```
public class Log {
  public static void debug(final String message) {
    //#if !release.build
    System.out.println(message);
    //#endif
  }
} 
```

或者在需要的地方进行记录。现在，如果 release.build 属性设置为 true，此代码将被注释掉，这将导致一个空方法。Proguard 将删除空方法的所有用法 - 实际上发布版本将删除所有调试消息。

编辑：

在库级别考虑它（我正在研究映射 J2ME 库），我可能已经找到了一个更好的解决方案。

```
public class Log {
  private static boolean showDebug;

  public static void debug(final String message) {
    if (showDebug) {
      System.out.println(message);
    }
  }

  public static void setShowDebug(final boolean show) {
    showDebug = show;
  }
} 
```

这样，最终开发人员可以在他/她感兴趣的库中启用日志级别。如果不启用任何内容，则在最终产品混淆中将删除所有日志记录代码。甜的 ：）

/亚努斯西姆

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-03T09:59:11.247

您可以使用 proguard 中的 -assumenosideaffects 来完全删除您的日志记录类：

```
-assumenosideeffects public class logger.Logger {*;} 
```

而不是必须预处理。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-24T12:07:30.007

带有由 Symbian 自身修改的 Sun 虚拟机的 Series60 和 UIQ 手机具有标准输出重定向。

您不仅可以捕获 System.out，而且 Throwable.printStackTrace() 也可以。

在早期的手机上，您需要编写一个与标准库服务器进程挂钩的 C++ 应用程序。Symbian 开发了 Redirector 应用程序，可以将 VM 标准输出捕获到控制台或文件中。

在较新的手机上，引入了“redirect://”GCF 协议，该协议可以将 VM 标准输出读入 Java byte[] 或 String 对象（您可能希望在单独的 MIDlet 中执行此操作），并且 Redirector 应用程序被重写为爪哇。

在 Series60 3rd Edition Feature Pack 2 手机（及更高版本）中使用的最新 J9 VM 上，您可能需要尝试“redirect://test”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T12:48:17.470

我已经在生产应用程序[中将 MIDPLogger](http://www.mobilelandscape.uklinux.net/j2medownload/MIDPLogger.php)使用到了可接受的水平，尽管我发现它在集成到应用程序中而不是作为套件中的另一个 Midlet 等之后有更多用处。我还找到了[MicroLog](http://microlog.sourceforge.net/)，但没有将它用于任何细节。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-14T18:27:33.473

我写了一个字节码优化器，由于类文件的格式，您可以指向类名和函数的 UTF 编码，它允许您使用 MyClass.someFunc() 输出日志（如果您想获取类型，可以处理签名)，它允许您使用**LINE**和**FILE**宏执行类似 C 风格的调试。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-08T14:31:20.730

使用记录器类的条件编译并不能解决完全删除记录语句的问题，因为您通常会记录比简单字符串更多的内容。您将查找变量值，然后将它们组合成字符串，例如：WhateverLog.log("Loaded" + someclass.size() +"foos")。

现在，如果您只省略 WhatLog.log 的主体（如已接受的解决方案中所示），您仍然会留下许多不必要的代码，包括字符串连接（以及因此创建 StringBuffer）。这就是为什么你最好使用像 proguard 这样的字节码后处理工具（已经提到过）。Proguard 的 -assumenosideeffects 将允许其优化器不仅删除日志记录语句，还删除其结果仅由日志记录调用使用的所有代码。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-04-09T06:04:54.373

J2ME 的 LWUIT 框架提供了 Logging 表单，可以在里面记录语句。您可以在您认为可能产生异常的每个地方添加日志。

示例：Log.getInstance().showLog(); 通过添加以上行，您可以跟踪 J2ME 设备中的日志记录。

# eclipse - Eclipse 的深色方案

> ID：120621
> 
> 赞同：424
> 
> 时间：2008-09-23T12:21:44.163
> 
> 标签：eclipse

Eclipse 完全可以主题化吗？我想为它安装一个深色方案，因为我更喜欢深色背景上的白色文本而不是其他方式。

* * *

## 回答 #1

> 赞同：287
> 
> 时间：2011-01-12T02:17:25.253

正如已经发布到一些相关问题的那样，我正在开发一个用于简单、跨编辑器颜色主题管理的插件：

[http://marketplace.eclipse.org/content/eclipse-color-theme](http://marketplace.eclipse.org/content/eclipse-color-theme)

它仍在进行中，但已经支持许多编辑器和一些深色主题。

* * *

## 回答 #2

> 赞同：88
> 
> 时间：2010-07-01T11:06:15.207

我创建了自己的深色配色方案（基于来自[gedit](http://en.wikipedia.org/wiki/Gedit)的 Oblivion ），我认为使用它非常好。

预览和详细信息：[http ://www.rogerdudler.com/?p=362](http://www.rogerdudler.com/?p=362)

我们很高兴地宣布[eclipsecolorthemes.org](http://www.eclipsecolorthemes.org)的测试版，这是一个用于下载、创建和维护 Eclipse 颜色主题/方案的新网站。主题编辑器允许您复制现有主题并通过在特定编辑器上实时预览您的更改来编辑颜色。可下载的主题支持很多编辑器（PHP、Java、SQL、Ant、文本、HTML、CSS 等等）

网站上已经有越来越多的可用主题列表：

*   [曾本](http://www.eclipsecolorthemes.org/?view=theme&id=2)
*   [遗忘](http://www.eclipsecolorthemes.org/?view=theme&id=1)
*   [墨水瓶](http://www.eclipsecolorthemes.org/?view=theme&id=4)
*   [活力墨水](http://www.eclipsecolorthemes.org/?view=theme&id=3)

![eclipsecolorthemes.org 的截图](https://i.stack.imgur.com/Qv9LZ.png)

[您可以在此处](http://www.rogerdudler.com/?p=509)阅读有关此次发布的更多信息。

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2008-09-23T12:24:04.110

这里有一个人发布了他的 Eclipse 偏好，用于像主题一样更改颜色：

[http://blog.codefront.net/2006/09/28/vibrant-ink-textmate-theme-for-eclipse/](http://blog.codefront.net/2006/09/28/vibrant-ink-textmate-theme-for-eclipse/)

![截屏](https://i.stack.imgur.com/JjrCZ.png)

这里有更多关于如何在[Ganymede Eclipse 版本](http://en.wikipedia.org/wiki/Eclipse_%28software%29#Releases)（v. 3.4，2008 年中）中设置颜色：

[http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.platform.doc.user/concepts/accessibility/fontsandcolors.htm](http://help.eclipse.org/ganymede/index.jsp?topic=/org.eclipse.platform.doc.user/concepts/accessibility/fontsandcolors.htm)

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2010-05-06T12:48:20.357

对于 Linux 用户，假设您运行[合成窗口管理器](https://en.wikipedia.org/wiki/Compositing_window_manager)( [Compiz](https://en.wikipedia.org/wiki/Compiz) )，您可以将窗口设为负数。我一直都这样使用 Eclipse，正常（白色）的外观让我大吃一惊。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2011-11-24T13:41:06.670

这些是编码过程中我眼睛喜欢的颜色。爵士乐不包括在主题中。

![LukinaJama3 截图](https://i.stack.imgur.com/JCooX.png)

Eclipse 颜色主题插件文件：[Depositfiles 上的 LukinaJama3.xml](http://goo.gl/2jr3w)

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-02-05T18:57:43.173

这是 Eclipse 颜色主题的最佳位置：

[http://www.eclipsecolorthemes.org/](http://www.eclipsecolorthemes.org/)

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-02-06T17:38:46.243

我不得不说，这是 Eclipse 真正薄弱的一个领域。具体来说，首选项的导入/导出适用于所有首选项。没有办法只导入字体/颜色首选项（就像你可以使用 Visual Studio 一样）而不破坏我的键绑定首选项。

另外，我已经尝试了上面提到的几个首选项文件，它们完全破坏了我的 Eclipse 安装。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-07-15T21:23:46.090

我创建了几个颜色主题，以及一个从某人的颜色偏好中提取新主题的脚本。我目前正在使用一个我还没有在网站上发布的，但我最终应该会得到它。

[http://eclipsecolorthemes.jottit.com](http://eclipsecolorthemes.jottit.com)

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2011-01-19T03:19:37.360

最简单的方法： ~~更改 Windows 显示属性主窗口背景颜色。我转到外观选项卡，更改为银色方案，单击高级，单击“活动窗口”并将颜色 1 更改为浅灰色。所有 Eclipse 视图都软化了。~~

由于[Luna (4.4)](http://help.eclipse.org/luna/index.jsp?topic=%2Forg.eclipse.platform.doc.user%2FwhatsNew%2Fplatform_whatsnew.html)似乎有一个完整`Dark`的

> 窗口 -> 首选项 -> 常规 -> 外观 -> 主题 -> 深色

[![在此处输入图像描述](https://i.stack.imgur.com/ivqDX.png)](https://i.stack.imgur.com/ivqDX.png)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2010-10-28T17:23:15.987

对于快速破解，在使用 Windows 键盘运行 GNOME 的 Linux 上，Windows-Key-M 将反转所有窗口的颜色，而 Windows-Key-N 将反转单个窗口的颜色。在我的书中，这是一个*很棒的功能。*

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-01-27T12:01:59.070

正如我回答“[有没有一种简单、一致的方法来更改 Eclipse 编辑器的配色方案？](https://stackoverflow.com/questions/481035/is-there-a-simple-consistent-way-to-change-the-color-scheme-of-eclipse-editors#482828) ”：

> 我也一直在寻找这个，经过一番研究，找到了一个可行的解决方案。这是基于 Eclipse 的 FDT 编辑器，但我相信您可以将相同的逻辑应用于其他编辑器。
> 
> 我的博文：[如何为 FDT 创建配色方案](http://blog.ansuz.nl/index.php/2009/01/26/howto-create-a-color-scheme-for-fdt/)
> 
> 希望这可以帮助！

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2011-05-02T19:41:13.123

我发现的最佳解决方案是让 Eclipse 处于正常明亮模式，并使用操作系统级别的屏幕逆变器。

在 OS X 上你可以做`Command`+ `Option`+ `Ctrl`+ `8`，反转整个屏幕。

在带有 Compiz 的 Linux 上，它甚至更好，您可以使用`Windows`+`N`来选择性地使窗口变暗（或`Windows`+`M`来完成整个屏幕）。

在 Windows 上，我找到的唯一不错的解决方案是 powerstrip，但它只能免费使用一年......然后它就像 30 美元或其他东西......

然后你可以反转屏幕，根据自己的喜好调整语法级别的颜色，然后你就可以带着冷色调开始比赛了。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-06-08T15:16:22.443

如果您使用 Aptana，那么您可以下载深色主题！我最近一直在寻找一个，发现了 Aptana 一个。以为其他人可能会感兴趣！

查看：[http ://www.nightlion.net/themes/2009/aptana-dark-color-theme/](http://www.nightlion.net/themes/2009/aptana-dark-color-theme/)

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-07-16T21:04:33.433

我终于找到了我一直在寻找的东西，即[PyDev 的黑暗主题](http://www.scimatic.com/node/263)（尽管我仍然觉得 Eclipse 错过了这一点）。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-08-16T11:34:56.330

这是另一个黑暗的 Eclipse 主题：[http](http://blog.prabir.me/post/Dark-Eclipse-Theme.aspx) ://blog.prabir.me/post/Dark-Eclipse-Theme.aspx 。

我有这个主题的 Visual Studio 等价物。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2010-03-12T02:37:31.323

这是[Eclipse 的深色背景配色方案的 rev 0.0.1 尝试](http://docs.google.com/View?id=dd6g79bh_15f2jhs9f8)（和[屏幕截图](http://picasaweb.google.com/lh/photo/o7mWcx9G8TMXoU80S--_uw)）。有任何反馈吗？（这与[我通常用于 Vim 的方式大相径庭](http://docs.google.com/View?id=dd6g79bh_13f4gjx4nt)。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-07-05T05:48:02.183

查看我为 Eclipse PDT 创建的这个[配色方案。](http://github.com/moleculezz/eclipse-zenburn)它基于 slinky 开发的 Vim Zenburn 配色[方案](http://slinky.imukuppi.org/zenburnpage/)

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-08-24T17:53:47.810

有些人发布了适用于 Linux 和 Mac 的选项，如果您可以在全球范围内处理它，那么 Windows（免费）等效项是：

设置 Windows 桌面外观主题窗口背景颜色。您可以保留当前/所需的主题，只需修改窗口的背景颜色。默认情况下，它设置为白色。我将其更改为灰色阴影。我之前尝试过深灰色和黑色，但是你必须全局更改文本字体颜色，这一切都很痛苦。

但是一个简单的灰色阴影作为背景可以在全局范围内使用，只要灰色阴影不是太暗，它就可以与任何颜色的文本字体一起使用。

它不是所有编辑器/IDE 的最佳解决方案，因为我更喜欢黑色，但它是 Windows 上的下一个最佳免费和全局解决方法。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-07-10T13:45:06.523

我玩自定义颜色。我选择了 Turbo Pascal 中我喜欢的黄色文本/蓝色背景。我遇到的问题是它允许您设置编辑器的颜色，但其他视图（如 Package Explorer 或 Navigator）仍保留默认的黑白颜色。我相信您可以通过编程方式进行操作，但是对于我的耐心来说，有很多设置。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2010-08-27T19:30:24.943

作为对这个[评论](https://stackoverflow.com/questions/120621/dark-color-scheme-for-eclipse/2781179#27811791.1.2.)的回应，我为 Compiz 的 Color Filter 插件制作了一个过滤器。

这是我得到的：

如何：

1.  转到 /usr/share/compiz/filters/
2.  创建新文件“负低对比度”（作为根）
3.  将随附的代码插入其中。
4.  转到系统->首选项->CompizConfig ...
5.  进入滤色器插件
6.  启用它并将新创建的过滤器添加到列表 Profeet!!

过滤器代码：

```
!!ARBfp1.0
TEMP temp, neg;

# Dunno what's this... but every other filter starts with this :) ;
TEX temp, fragment.texcoord[0], texture[0], RECT;

# Applying negative filter ;
RCP neg.a, temp.a;
MAD temp.rgb, -neg.a, temp, 1.0;
MUL temp.rgb, temp.a, temp;
MUL temp, fragment.color, temp;

# Lowering contrast and shifting brightness ;
MUL temp.rgb, temp, 0.8;
ADD temp.rgb, temp, 0.25;

MOV result.color, temp;
END 
```

您也可以使用过滤器。也许你会得到更有趣的东西：）随时分享！

# c# - 一个或多个文件与数据库的主文件不匹配（错误 5173）

> ID：120625
> 
> 赞同：0
> 
> 时间：2008-09-23T12:22:42.367
> 
> 标签：c#, sql-server

当我从源代码管理中检出我的数据库时，我得到了这个错误。签入 sql server 数据库可能听起来很奇怪，但这是我所做的，因为这只是一个个人项目。

任何人都知道如何解决这个问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-23T14:53:51.007

这是我的发现。

正如其他海报所提到的，您真的不想将数据库文件签入和签出源代码控制。

但是，如果您绝对需要，并且您已经检查了数据库文件并且遇到了与我遇到的相同的错误，这里有一个解决方法：

首先，分离数据库，然后，删除 ldf 文件，重新附加数据库。

这就是我解决问题的方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T12:26:19.690

您真的不想将数据库文件签入和签出源代码控制 - 在 SQL Server 中，您必须分离文件才能使其正常工作，并且您会遇到各种风险。

如果您绝对必须这样做，您应该进行版本备份。

我建议对创建整个数据库（表、存储过程、视图等）的脚本进行版本控制

您可以尝试创建一个从该数据文件附加的数据库并使用Create [Database](http://msdn.microsoft.com/en-us/library/ms176061.aspx)`ATTACH_REBUILD_LOG`选项，但我不确定它是否会起作用，因为它们可能没有正确分离。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T12:26:43.217

您是否复制了日志文件 (.ldf) 以及“.mdf”文件？您需要两者的匹配集来重新附加数据库

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T12:32:52.467

这听起来像数据文件与数据库的结构文件不匹配。

简而言之，您的数据（即表行）所在的文件（大部分）不是存储数据结构（即表的描述）的文件。至少在“现代”RDBMS 系统中。因此，您检查了您的数据，并且数据库识别出在此之前发生的结构中的一些更改（您更改了表或类似的东西）。

“解决这个问题”的方法是检查数据库依赖的所有文件，但我认为这并不是你真正想要实现的。最好（如上所述）进行备份，然后从中删除/恢复数据库。

# c - 有没有办法在 Windows 上的链接时重新定义 malloc？

> ID：120627
> 
> 赞同：10
> 
> 时间：2008-09-23T12:22:50.900
> 
> 标签：c, windows

我想在链接时替换默认 malloc 以使用自定义 malloc。但是当我尝试在我的程序中重新定义 malloc 时，我收到了这个错误：

```
MSVCRT.lib(MSVCR80.dll) : error LNK2005: _malloc already defined in test.lib(test.obj) 
```

这在任何 Unix 上都可以完美运行，并且可以在具有大多数功能的 Windows 上运行，但不适用于 malloc。我怎样才能做到这一点？不允许覆盖它的 malloc 有什么不同？

我知道我可以用我的自定义 malloc 替换对 malloc 的每个调用，或者使用宏来执行此操作，但我宁愿不修改每个第三方库。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-23T12:29:04.817

关于这有多难，这里有很好的讨论：

[http://benjamin.smedbergs.us/blog/2008-01-10/patching-the-windows-crt/](http://benjamin.smedbergs.us/blog/2008-01-10/patching-the-windows-crt/)

~~显然，您需要修补 CRT~~

编辑：实际上，一位 MS 员工在讨论中给出了该技术。您需要将 malloc 移动到 lib，然后在 CRT 之前将其链接

“他还提到，如果你在 CRT*之前*将你的 malloc 作为一个库链接（即确保打开'忽略默认库'并明确包含 CRT），你会得到你想要的，并且可以毫无问题地重新分发这个库。”

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T12:27:47.597

我认为这取决于您链接文件的顺序。我认为您需要先链接自定义函数，然后再链接导入库。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T12:31:12.660

从 3.0 版开始，Firefox 使用自定义分配器（AFAIR jmalloc）——您可以查看他们是如何做到的。我读到他们有一些问题。你可以查看这篇[博文](http://blog.pavlov.net/2008/01/12/jemalloc-builds/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-11-18T16:14:01.237

在项目 makefile 中定义 malloc=_custom_malloc 怎么样。比添加一个文件，例如：

```
my_memory.c
#undef malloc
#undef calloc
...
void *_custom_malloc(int size) { return jmalloc(size); }
void *_custom_calloc(int size) { return jcalloc(size); }
... 
```

# tags - 标签层次结构和处理

> ID：120628
> 
> 赞同：20
> 
> 时间：2008-09-23T12:23:29.883
> 
> 标签：tags, tagging, hierarchical-clustering

这是一个真正的问题，通常适用于标记项目（是的，这也适用于 StackOverflow，不，这不是关于 StackOverflow 的问题）。

整个标记问题有助于聚集相似的项目，无论它们可能是什么项目（笑话、博客文章、问题等）。但是，存在（通常但不严格）标签的层次结构，这意味着某些标签也*暗示*其他标签。举一个熟悉的例子，“c#”so 标签也暗示“.net”；另一个例子，在笑话数据库中，“金发女郎”标签暗示“嘲讽”标签，类似于“爱尔兰”或“比利时”或“加拿大”等，具体取决于笑话的国家/地区。

如果你有，你是如何在你的项目中处理这个问题的？我将提供一个答案，描述我在两个不同案例中使用的两种不同方法（实际上，相同的机制但在两个不同的环境中实现），但我不仅对类似的机制感兴趣，而且对你对层次结构问题的看法也感兴趣.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T12:43:37.933

这是一个棘手的问题。两个极端是本体（一切都是分层的）和民俗（标签没有分层）。我已经[在 WikiAnswers 上回答了这个问题](http://wiki.answers.com/Q/What_is_the_best_way_to_integrate_Taxonomy_with_Folksonomy_with_respect_to_creating_a_database_of_skills_that_can_be_tagged_but_also_searched_for_by_classified_criteria)，并参考了 Clay Shirky 的“Ontology is Overrated”文章，该文章声称您不应该设置任何层次结构。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T12:52:33.077

实际上我会说它不是一个层次系统，而是一个语义网，标签含义之间存在距离。我的意思是：数学更接近于实验物理学，然后更接近于园艺。

建立这样一个网络的可能性：建立标签对并让人们判断感知距离（使用 1-10 之类的度量，意思是 [同义词，相似，...，反义词]，...），并且在搜索时，搜索一定距离内的所有标签。

如果来自相反方向（[a,b] close -> [b,a,] close），测量是否必须是相等的距离？还是接近意味着 [a,b] 关闭和 [b,c] 关闭 -> [a,b] 关闭？

也许第一个词会默认触发另一个语义场？如果你从“社会工作者”开始，“分析师”就在附近。如果你从“程序员”开始，“分析师”也很近。但是从这些点中的任何一点开始，您可能不会将另一个视为接近（“社会工作者”绝不接近“程序员”）。

因此，您只能在两个方向（以随机顺序）进行判断和判断。

```
[TagRelations]
tagId integer
closeTagId integer
proximity integer 
```

选择相似标签的示例：

```
select closeTagId from TagRelations where tagId = :tagID and proximity < 3 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T12:34:31.480

The mechanism I have implemented was to not use the tags given themselves, but an indirect lookup table (not strictly DBMS terms) which links a tag to many implied tags (obviously, a tag is linked with itself for this to work).

In a python project, the lookup table is a dictionary keyed on tags, with values sets of tags (where tags are plain strings).

In a database project (indifferent which RDBMS engine it was), there were the following tables:

```
[Tags]
tagID integer primary key
tagName text

[TagRelations]
tagID integer # first part of two-field key
tagID_parent integer # second part of key
trlValue float 
```

where the trlValue was a value in the (0, 1] space, used to give a gravity for the each linked tag; a self-to-self tag relation always carries 1.0 in the trlValue, while the rest are algorithmically calculated (it's not important how exactly). Think the example jokes database I gave; a ['blonde', 'derisive', 0.5] record would correlate to a ['pondian', 'derisive', 0.5] and therefore suggest all derisive jokes given another.

# user-interface - 关于 GUI 应用程序中线程数的最佳实践

> ID：120636
> 
> 赞同：4
> 
> 时间：2008-09-23T12:25:25.590
> 
> 标签：user-interface, language-agnostic

过去，我曾与许多专门编写 GUI 应用程序的程序员一起工作。

我得到的印象是，他们几乎普遍地在他们的应用程序中尽量减少了多线程的使用。在某些情况下，他们似乎竭尽全力确保使用单线程。

这很常见吗？这是 gui 应用程序设计的普遍接受的哲学吗？

如果是这样，为什么？

[编辑]

有许多答案说应尽量减少线程使用以降低复杂性。一般来说，降低复杂性是一件好事。

但是，如果您查看对外部事件的响应至关重要的任意数量的应用程序（例如，Web 服务器、任意数量的嵌入式应用程序），您对线程使用的态度似乎是天壤之别。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T12:28:14.490

我认为就 Windows 而言，您仅限于在单个线程上发生的所有 GUI 操作 - 由于 Windows 消息泵的工作方式，为了提高响应性，大多数应用程序至少添加一个额外的工作线程来处理更长运行的任务，否则这些任务会阻塞和使 ui 无响应。

线程从根本上讲是困难的，因此考虑多个线程或多个线程通常会导致大量的调试工作——现在有一句话让我无法理解——“如果你认为你理解线程，那么你真的不"

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-23T12:33:07.897

一般来说，GUI 框架不是线程安全的。对于 Swing（Java 的 GUI API）之类的东西，只有一个线程可以更新 UI（或者可能发生坏事）。只有一个线程处理调度事件。如果你有多个线程更新屏幕，你会得到一些难看的闪烁和不正确的绘图。

然而，这并不意味着应用程序需要是单线程的。在某些情况下，您不希望出现这种情况。如果您单击将 pi 计算为 1000 位的按钮，则您不希望 UI 被锁定并且在接下来的几天内该按钮被按下。这时候像 SwingWorker 这样的东西就派上用场了。它有两个部分，一个在单独的线程中运行的 doInBackground() 和一个在 doInBackground 线程完成后由处理更新 UI 的线程调用的 done()。这允许快速处理事件，或者在后台处理需要很长时间的事件，同时仍然有单个线程更新屏幕。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T12:31:57.557

我见过同样的事情。理想情况下，您应该在后台线程中执行任何将花费超过几百毫秒的操作。任何超过 100 毫秒的分类，人类可能不会注意到差异。

我过去合作过的许多 GUI 程序员都害怕线程，因为它们“很难”。在某些 GUI 框架（例如 Delphi VCL）中，有关于从多个线程使用 VCL 的警告，这往往会吓到一些人（其他人将其视为挑战；））

多线程 GUI 编码的一个有趣示例是 BeOS API。应用程序中的每个窗口都有自己的线程。根据我的经验，这让 BeOS 应用程序感觉更灵敏，但它确实让编程变得更加棘手。幸运的是，由于 BeOS 默认设计为多线程，API 中有很多东西可以让事情比我使用的其他一些操作系统更容易。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T12:30:18.713

大多数 GUI 框架都不是线程安全的，这意味着我必须从创建它们的同一线程访问所有控件。尽管如此，创建工作线程以拥有响应式应用程序仍然是一种很好的做法，但是您需要小心地将 GUI 更新委托给 GUI 线程。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T12:56:20.413

是的。

GUI 应用程序应尽量减少它们使用的线程数，原因如下：

1.  线程编程非常困难和复杂
2.  通常，GUI 应用程序一次最多做两件事：a) 响应用户输入，b) 执行后台任务（例如加载数据）以响应用户操作或预期的用户操作

***因此，一般来说***，使用多线程所增加的复杂性并不能满足应用程序的需要。

当然，规则也有例外。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T12:28:52.663

GUI 通常不使用大量线程，但它们通常会抛出另一个线程来与某些子系统交互，特别是如果这些系统需要一段时间或者是非常共享的资源。

例如，如果您要打印，您通常会想甩掉另一个线程来与打印机池进行交互，因为它可能会很忙一段时间并且没有理由不继续工作。

另一个例子是数据库加载，您正在与 SQL 服务器或类似的东西进行交互，并且由于所涉及的延迟，您可能希望创建另一个线程，以便您的主 UI 处理线程可以继续响应命令。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-23T12:31:19.320

应用程序中的线程越多，（通常）解决方案就越复杂。通过尝试最小化 GUI 中使用的线程数量，潜在问题的区域更少。

另一个问题是 GUI 设计中最大的问题：人。人类因想要同时做多件事而臭名昭著*。*用户习惯于快速连续单击多个按钮/控件，以尝试更快地完成某事。计算机通常无法跟上这一点（这仅由 GUI 通过使用多个线程来跟上的明显能力构成），因此为了最大限度地减少这种影响，GUI 将在单个线程上以先到先服务的方式响应输入。通过这样做，GUI 被迫等待系统资源可用，直到它可以继续运行。因此消除了所有可能出现的令人讨厌的僵局情况。显然，如果程序逻辑和 GUI 在不同的线程上，那么这就会消失。

从个人喜好来看，我更喜欢在一个线程上保持简单，但不会损害 GUI 的响应性。如果一项任务花费的时间太长，那么我会使用不同的线程，否则我会坚持一个。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T12:36:41.820

正如之前的评论所说，GUI 框架（至少在 Windows 上）是单线程的，因此是单线程的。另一个建议（在实践中很难编码）是将线程数限制为机器上可用内核的数量。您的 CPU 一次只能使用一个内核执行一项操作。如果有两个线程，则必须在某个时候发生上下文切换。如果线程太多，计算机有时会花费更多时间在线程之间交换而不是让线程工作。

随着摩尔定律随着内核数量的增加而变化，这将发生变化，并且希望编程框架能够发展以帮助我们更有效地使用线程，具体取决于程序可用的内核数量，例如[TPL](http://msdn.microsoft.com/en-us/magazine/cc163340.aspx)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T12:38:09.913

通常，来自窗口管理器/操作系统的所有窗口消息都将进入一个队列，因此将所有 UI 元素放在一个线程中是很自然的。如果您尝试从创建它的线程以外的线程直接访问 UI 元素，某些框架（例如 .Net）实际上会引发异常。

# javascript - How do you get a spreadsheet to open Excel instead of a browser window?

> ID：120646
> 
> 赞同：10
> 
> 时间：2008-09-23T12:26:33.340
> 
> 标签：javascript, excel, url

If you call javascript window.open and pass a url to a .xls file it open on some machines in the browser window. How can you force it into Excel?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T12:36:40.757

Only the users machine can "force" it into Excel. That said, 99% of the time if you send the correct mime-type and a user has Excel, then it will open in Excel assuming they approve.

And only the server can send the correct mime-type. The document type you pass to a JavaScript window.open call will have no effect on this. In fact, calling window.open will at best just open a superfluous window.

It's best to just link to the document with `<a href="foo.xls">`. And provided your server is sending a mime-type of `application/x-excel` or `application/x-msexcel` this will almost always nudge the browser into opening a new window with the Excel document.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T12:45:34.417

如果它只是一个静态文件，并且您在 Linux 上使用 Apache，请检查名为 /etc/mime.types 的文件，并确保其中包含以下行以将 .xls 文件扩展名与正确的 MIME 类型相关联：

```
application/vnd.ms-excel    xls 
```

我猜该文件的位置可能因系统而异，但它位于运行 RHEL4 的服务器上的 /etc/mime.types 中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T12:36:41.023

AFAIK you can't do this with JavaScript alone. If you have some sort of scripting language on the server's side you can alter the header to force a download.

[Here](http://www.sometricks.com/2006/04/23/download-pdf-jpg-gif-directly-from-the-web-browser)'s a simple tutorial in PHP, but you can easily find one in your favorite language.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T12:38:14.560

You cannot force it into Excel. You can allow the browser to handle it whichever way it is configured to do so, or you can try to force it to download the file and let the user open if from their desktop. To force a download, search for "force download" and your server-side language (PHP, ASP.NET, JSP, etc.)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T12:38:42.313

I don't think you can: you cannot call external programs using Javascript for security reasons. Assuming that the user has Excel installed, you may want to open the new window without the address bar to give the user "the illusion" that the file has been opened with Excel in Internet Explorer.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T12:38:45.620

I wouldn't think this is possible from javascript due to security issues, there would be nothing stopping a rogue webpage from opening dozens of excel/word instances.

Could you not set a hyperlink to the url of the .xls, that way the user would get the usual download prompt to view the file.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T12:40:19.173

1.  Set the http content type to the Excel datatype: application/vnd.ms-excel
2.  You shouldn't need to redirect to a new window, but you will get a popup asking the user to save or open the file.
3.  In relation to (2): I'd worry if a browser could launch an external application and load data into it automatically without user intervention.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T12:41:16.380

This is a setting in each user's browser and not in something that can be set by code. So unfortunately you do not have control of that.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T13:13:01.827

你不能，因为它取决于客户端机器。

例如，在 Windows 上，如果您希望它始终使用 Excel 打开，而不是在浏览器窗口中打开，您必须打开我的电脑、工具、文件夹选项、文件类型，选择 XLS 类型，然后单击高级。有两个复选框：在同一窗口中浏览和就地打开 Web 文档。取消选中两者，关闭浏览器窗口，再次打开并重试。

但是正如我所说：这取决于客户，你不能强迫它。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T17:37:24.233

您可以使用[LaunchinIE](http://www.whirlywiryweb.com/q/launchinie.asp)来做到这一点，这是一个 ActiveX 控件，它使 HTML 页面能够启动客户端计算机上的任何应用程序，而不会出现安全警告。

引自网站：“最后，网页可以毫无怨言地启动 Word、Excel 或任何其他企业应用程序。安全。”

为此，您必须在用户计算机上安装控件，并将允许执行本地应用程序的 URL 添加到 Windows 注册表。

该网站的另一句话是：“为了确保安全，LaunchinIE 需要在客户端进行仔细配置；由于这个限制，它只适合 Intranet 使用。”

我在我们的培训设施中使用 LaunchinIE，因此我可以使用 Internet Explorer 作为菜单，让用户选择机器设置。LaunchinIE 然后调用一个批处理脚本，将机器配置为最好地支持选定的训练。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-15T22:29:29.160

以下是在打开已保存的 Excel 文件时恢复此弹出窗口的步骤。

1.  右键单击windows [START] 按钮并选择Explore 打开Windows Explorer 窗口将打开。
2.  从菜单中选择工具\文件夹选项...<br> • 选择文件类型选项卡并向下滚动文件列表。
    • 左键单击以突出显示XLS Microsoft Excel 工作表文件扩展名，然后单击高级按钮。

3.  在“编辑文件类型”窗口中，取消选中“在同一窗口中浏览”选项。

4.  单击确定按钮接受您的更改。

5.  启动一个新的浏览器会话。下次您在收件箱中打开 Excel 电子表格时，系统会提示您以下窗口。请务必将“打开此类文件之前始终询问”保留为选中状态。单击“打开”按钮现在应该在 Excel 中打开您的文件。

# unit-testing - Assert.Fail() 被认为是不好的做法吗？

> ID：120648
> 
> 赞同：74
> 
> 时间：2008-09-23T12:27:16.990
> 
> 标签：unit-testing, xunit.net

我在做 TDD 时经常使用 Assert.Fail。我通常一次只做一个测试，但是当我对以后想要实现的东西有想法时，我会快速编写一个空测试，其中测试方法的名称表明我想要作为待办事项列表来实现的内容。为了确保我不会忘记我在正文中放了一个 Assert.Fail() 。

在尝试 xUnit.Net 时，我发现他们没有实现 Assert.Fail。当然，您始终可以 Assert.IsTrue(false) 但这也不能传达我的意图。我的印象是 Assert.Fail 不是故意实施的。这被认为是不好的做法吗？如果是，为什么？

* * *

@Martin Meredith 这不正是我所做的。我确实先编写一个测试，然后实现代码以使其工作。通常我会同时考虑几个测试。或者当我在做其他事情时，我会考虑写一个测试。那时我写了一个空的失败测试来记住。到我开始编写测试时，我整齐地先测试。

@Jimmeh 这看起来是个好主意。忽略的测试不会失败，但它们仍会显示在单独的列表中。必须尝试一下。

@Matt Howells 好主意。在这种情况下，NotImplementedException 比 assert.Fail() 更好地传达意图

@Mitch Wheat 这就是我想要的。似乎它被遗漏了以防止它以另一种方式被滥用，我滥用它。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-09-23T12:32:30.690

对于这种情况，我不调用 Assert.Fail，而是执行以下操作（在 C#/NUnit 中）

```
[Test]
public void MyClassDoesSomething()
{
    throw new NotImplementedException();
} 
```

它比 Assert.Fail 更明确。

似乎普遍认为使用比 Assert.Fail() 更明确的断言更为可取。大多数框架都必须包含它，因为它们没有提供更好的选择。例如，NUnit（和其他）提供了一个 ExpectedExceptionAttribute 来测试某些代码是否引发了特定类的异常。但是，为了测试异常的属性是否设置为特定值，不能使用它。相反，您必须求助于 Assert.Fail：

```
[Test]
public void ThrowsExceptionCorrectly()
{
    const string BAD_INPUT = "bad input";
    try
    {
        new MyClass().DoSomething(BAD_INPUT);
        Assert.Fail("No exception was thrown");
    }
    catch (MyCustomException ex)
    {
         Assert.AreEqual(BAD_INPUT, ex.InputString); 
    }
} 
```

xUnit.Net 方法 Assert.Throws 无需 Assert.Fail 方法就使这变得更加整洁。通过不包含 Assert.Fail() 方法，xUnit.Net 鼓励开发人员寻找和使用更明确的替代方案，并在必要时支持创建新断言。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-23T12:32:17.493

它被故意遗漏了。这是 Brad Wilson 关于为什么没有 Assert.Fail() 的回复：

> 事实上，我们并没有忽视这一点。我发现 Assert.Fail 是一个拐杖，这意味着可能缺少一个断言。有时这只是测试的结构方式，有时是因为 Assert 可以使用另一个断言。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2008-09-23T12:41:53.273

我一直使用 Assert.Fail() 来处理您检测到测试应该通过简单值比较之外的逻辑失败的情况。举个例子：

```
try 
{
  // Some code that should throw ExceptionX
  Assert.Fail("ExceptionX should be thrown")
} 
catch ( ExceptionX ex ) 
{
  // test passed
} 
```

因此，框架中缺少 Assert.Fail() 对我来说似乎是一个错误。我建议修补 Assert 类以包含一个 Fail() 方法，然后将补丁提交给框架开发人员，以及添加它的理由。

至于您在工作空间中创建故意失败的测试的做法，以提醒自己在提交之前实施它们，这对我来说似乎是一个很好的做法。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-23T12:30:57.853

我使用 MbUnit 进行单元测试。他们可以选择忽略测试，这些测试在测试套件中显示为橙色（而不是绿色或红色）。也许 xUnit 有类似的东西，这意味着您甚至不必在方法中添加任何断言，因为它会以令人讨厌的不同颜色显示，因此很难错过？

编辑：

在 MbUnit 中是这样的：

```
[Test]
[Ignore]
public void YourTest()
{ } 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-06-26T11:28:12.663

这是我在为要通过设计抛出异常的代码编写测试时使用的模式：

```
[TestMethod]
public void TestForException()
{
    Exception _Exception = null;

    try
    {
        //Code that I expect to throw the exception.
        MyClass _MyClass = null;
        _MyClass.SomeMethod();
        //Code that I expect to throw the exception.
    }
    catch(Exception _ThrownException)
    {   
        _Exception = _ThrownException
    }
    finally
    {
        Assert.IsNotNull(_Exception);
        //Replace NullReferenceException with expected exception.
        Assert.IsInstanceOfType(_Exception, typeof(NullReferenceException));
    }
} 
```

恕我直言，这是比使用 Assert.Fail() 测试异常的更好方法。这样做的原因是，我不仅要测试抛出的异常，还要测试异常类型。我意识到这与 Matt Howells 的答案相似，但恕我直言，使用 finally 块更健壮。

显然，仍然可以包含其他 Assert 方法来测试异常输入字符串等。我将感谢您对我的模式的评论和看法。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-23T12:38:31.657

就我个人而言，只要您最终在实现要通过的代码 *之前开始编写测试，就可以将测试套件用作这样的待办事项列表。*

话虽如此，我自己曾经使用过这种方法，尽管现在我发现这样做会导致我走上一条预先编写太多测试的道路，这以一种奇怪的方式就像根本不编写测试的相反问题：恕我直言，您最终做出有关设计的决定还为时过早。

顺便说一句，在 MSTest 中，标准测试模板在其样本末尾使用 Assert.Inconclusive。

AFAIK xUnit.NET 框架旨在非常轻量级，是的，他们确实故意削减了失败，以鼓励开发人员使用明确的失败条件。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-23T12:45:26.570

大胆猜测：保留 Assert.Fail 旨在阻止您认为编写测试代码的好方法是一大堆意大利面条，导致在坏情况下出现 Assert.Fail。[编辑添加：其他人的答案大致证实了这一点，但引用了]

由于这不是您正在做的事情，因此 xUnit.Net 可能会过度保护。

或者他们只是认为它是如此罕见且如此不正交以至于没有必要。

我更喜欢实现一个名为 ThisCodeHasNotBeenWrittenYet 的函数（实际上更短一些，以便于输入）。无法比这更清楚地传达意图，并且您有一个精确的搜索词。

无论是失败，还是没有实现（引发链接器错误），或者是一个无法编译的宏，都可以根据您当前的偏好进行更改。例如，当你想运行一些*已经*完成的东西时，你想要一个失败。当你坐下来摆脱它们时，你可能想要一个编译错误。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-23T14:01:00.790

使用好的代码，我通常会这样做：

```
void goodCode() {
     // TODO void goodCode()
     throw new NotSupportedOperationException("void goodCode()");
} 
```

使用我通常做的测试代码：

```
@Test
void testSomething() {
     // TODO void test Something
     Assert.assert("Some descriptive text about what to test")
} 
```

如果使用 JUnit，并且不想失败，而是错误，那么我通常会这样做：

```
@Test
void testSomething() {
     // TODO void test Something
     throw new NotSupportedOperationException("Some descriptive text about what to test")
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-08-28T10:49:54.840

当心`Assert.Fail`它的破坏性影响，使开发人员编写愚蠢或损坏的测试。例如：

```
[TestMethod]
public void TestWork()
{
    try {
        Work();
    }
    catch {
        Assert.Fail();
    }
} 
```

这很愚蠢，因为 try-catch 是多余的。如果抛出异常，则测试失败。

还

```
[TestMethod]
public void TestDivide()
{
    try {
        Divide(5,0);
        Assert.Fail();
    } catch { }
} 
```

这被破坏了，无论 Divide 函数的结果如何，测试都将始终通过。同样，当且仅当它抛出异常时，测试才会失败。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-23T12:31:09.883

如果您正在编写一个刚刚失败的测试，然后为它编写代码，然后编写测试。这不是测试驱动开发。

从技术上讲，如果您正确使用测试驱动开发，则不需要 Assert.fail()。

您是否考虑过使用待办事项列表，或将 GTD 方法应用于您的工作？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-23T12:36:58.637

MS Test 有**Assert.Fail()**但它也有**Assert.Inconclusive()**。我认为 Assert.Fail() 最合适的用途是，如果你有一些内联逻辑，放在断言中会很尴尬，尽管我什至想不出任何好的例子。在大多数情况下，如果测试框架支持 Assert.Fail() 以外的东西，那么就使用它。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-25T02:53:56.553

你为什么`Assert.Fail`要说应该抛出异常？那是不必要的。为什么不直接使用`ExpectedException`属性？

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-10-07T12:06:00.853

我认为您应该问问自己（前期）测试应该做什么。

首先，您编写了一个（一组）测试而没有实现。也许，还有下雨天的场景。

所有这些测试都必须失败，才能成为正确的测试：所以你想要实现两件事：1）验证你的实现是正确的；2) 验证您的单元测试是否正确。

现在，如果您进行前期 TDD，您希望执行所有测试，包括 NYI 部分。如果：1) 所有实现的东西都成功了 2) 所有 NYI 的东西都失败了，那么你的总测试运行的结果就通过了

毕竟，如果您的单元测试成功而没有实现，那将是单元测试的省略，不是吗？

您希望收到一封持续集成测试的邮件，检查所有已实现和未实现的代码，并在任何已实现的代码失败或任何未实现的代码成功时发送。两者都是不希望的结果。

只需编写一个 [ignore] 测试就不会完成这项工作。两者都不是，一个断言会停止第一个断言失败，而不是在测试中运行其他测试行。

那么，如何实现呢？我认为它需要一些更高级的测试组织。它需要一些其他机制然后断言来实现这些目标。

我认为您必须拆分测试并创建一些完全运行但必须失败的测试，反之亦然。

想法是将您的测试拆分为多个程序集，使用测试分组（mstest 中的有序测试可能会完成这项工作）。

尽管如此，如果 NYI 部门的所有测试都未通过邮件，那么 CI 构建并不容易和直截了当。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-05-14T17:06:16.237

这是我们的**Assert.Fail()**用例。

我们的单元测试的一个重要目标是它们*不接触数据库*。

有时模拟没有正确发生，或者应用程序代码被修改并且无意中进行了数据库调用。

这在调用堆栈中可能非常深。异常可能会被捕获，因此它不会冒泡，或者因为测试最初是使用数据库运行的，所以调用将起作用。

我们所做的是向单元测试项目添加一个配置值，这样当第一次请求数据库连接时，我们可以调用**Assert.Fail("Database encrypted");**

Assert.Fail() 全局作用，甚至在不同的库中。因此，这可以作为所有单元测试的包罗万象。

如果其中任何一个在单元测试项目中命中数据库，那么它们将失败。

因此，我们很快就失败了。

# python - Python中的目录树列表

> ID：120656
> 
> 赞同：596
> 
> 时间：2008-09-23T12:28:19.920
> 
> 标签：python, file, directory, subdirectory, directory-tree

如何在 Python 中获取给定目录中所有文件（和目录）的列表？

* * *

## 回答 #1

> 赞同：626
> 
> 时间：2008-09-23T12:35:46.097

这是一种遍历目录树中每个文件和目录的方法：

```
import os

for dirname, dirnames, filenames in os.walk('.'):
    # print path to all subdirectories first.
    for subdirname in dirnames:
        print(os.path.join(dirname, subdirname))

    # print path to all filenames.
    for filename in filenames:
        print(os.path.join(dirname, filename))

    # Advanced usage:
    # editing the 'dirnames' list will stop os.walk() from recursing into there.
    if '.git' in dirnames:
        # don't go into any .git directories.
        dirnames.remove('.git') 
```

* * *

## 回答 #2

> 赞同：542
> 
> 时间：2008-09-23T12:32:00.927

您可以使用

```
os.listdir(path) 
```

参考和更多的操作系统功能看这里：

*   Python 2 文档：[https ://docs.python.org/2/library/os.html#os.listdir](https://docs.python.org/2/library/os.html#os.listdir)
*   Python 3 文档：[https ://docs.python.org/3/library/os.html#os.listdir](https://docs.python.org/3/library/os.html#os.listdir)

* * *

## 回答 #3

> 赞同：126
> 
> 时间：2008-09-23T13:23:29.180

这是我经常使用的辅助函数：

```
import os

def listdir_fullpath(d):
    return [os.path.join(d, f) for f in os.listdir(d)] 
```

* * *

## 回答 #4

> 赞同：83
> 
> 时间：2008-09-23T12:34:07.143

```
import os

for filename in os.listdir("C:\\temp"):
    print  filename 
```

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2012-09-24T20:58:14.127

如果您需要通配能力，也有一个模块。例如：

```
import glob
glob.glob('./[0-9].*') 
```

将返回类似：

```
['./1.gif', './2.txt'] 
```

[请参阅此处](http://docs.python.org/library/glob.html)的文档。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2016-07-27T09:47:07.087

对于当前工作目录中的文件而不指定路径

**蟒蛇 2.7：**

```
import os
os.listdir('.') 
```

**Python 3.x：**

```
import os
os.listdir() 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2008-09-23T12:34:34.943

试试这个：

```
import os
for top, dirs, files in os.walk('./'):
    for nm in files:       
        print os.path.join(top, nm) 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2015-05-27T01:45:10.210

递归实现

```
import os

def scan_dir(dir):
    for name in os.listdir(dir):
        path = os.path.join(dir, name)
        if os.path.isfile(path):
            print path
        else:
            scan_dir(path) 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2012-08-01T06:47:52.757

我写了一个长版本，包含我可能需要的所有选项：http: [//sam.nipl.net/code/python/find.py](http://sam.nipl.net/code/python/find.py)

我想它也适合这里：

```
#!/usr/bin/env python

import os
import sys

def ls(dir, hidden=False, relative=True):
    nodes = []
    for nm in os.listdir(dir):
        if not hidden and nm.startswith('.'):
            continue
        if not relative:
            nm = os.path.join(dir, nm)
        nodes.append(nm)
    nodes.sort()
    return nodes

def find(root, files=True, dirs=False, hidden=False, relative=True, topdown=True):
    root = os.path.join(root, '')  # add slash if not there
    for parent, ldirs, lfiles in os.walk(root, topdown=topdown):
        if relative:
            parent = parent[len(root):]
        if dirs and parent:
            yield os.path.join(parent, '')
        if not hidden:
            lfiles   = [nm for nm in lfiles if not nm.startswith('.')]
            ldirs[:] = [nm for nm in ldirs  if not nm.startswith('.')]  # in place
        if files:
            lfiles.sort()
            for nm in lfiles:
                nm = os.path.join(parent, nm)
                yield nm

def test(root):
    print "* directory listing, with hidden files:"
    print ls(root, hidden=True)
    print
    print "* recursive listing, with dirs, but no hidden files:"
    for f in find(root, dirs=True):
        print f
    print

if __name__ == "__main__":
    test(*sys.argv[1:]) 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2018-09-05T08:13:15.947

这是另一种选择。

```
os.scandir(path='.') 
```

它返回一个 os.DirEntry 对象的迭代器，这些对象对应于 path 给定的目录中的条目（以及文件属性信息）。

*例子：*

```
with os.scandir(path) as it:
    for entry in it:
        if not entry.name.startswith('.'):
            print(entry.name) 
```

**使用 scandir() 代替 listdir() 可以显着提高还需要文件类型或文件属性信息的代码的性能**，因为如果操作系统在扫描目录时提供了这些信息，os.DirEntry 对象就会公开这些信息。所有 os.DirEntry 方法都可以执行系统调用，但 is_dir() 和 is_file() 通常只需要对符号链接进行系统调用；os.DirEntry.stat() 在 Unix 上总是需要一个系统调用，但在 Windows 上只需要一个用于符号链接。

[Python 文档](https://docs.python.org/3/library/os.html#os.scandir)

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2018-12-06T02:08:30.700

虽然`os.listdir()`生成文件和目录名称列表很好，但是一旦有了这些名称，您通常希望做更多事情——在 Python3 中，[pathlib](https://docs.python.org/3/library/pathlib.html)使其他杂务变得简单。让我们来看看你是否和我一样喜欢它。

要列出 dir 内容，请构造一个 Path 对象并获取迭代器：

```
In [16]: Path('/etc').iterdir()
Out[16]: <generator object Path.iterdir at 0x110853fc0> 
```

如果我们只想要事物名称的列表：

```
In [17]: [x.name for x in Path('/etc').iterdir()]
Out[17]:
['emond.d',
 'ntp-restrict.conf',
 'periodic', 
```

如果你只想要目录：

```
In [18]: [x.name for x in Path('/etc').iterdir() if x.is_dir()]
Out[18]:
['emond.d',
 'periodic',
 'mach_init.d', 
```

如果您想要该树中所有 conf 文件的名称：

```
In [20]: [x.name for x in Path('/etc').glob('**/*.conf')]
Out[20]:
['ntp-restrict.conf',
 'dnsextd.conf',
 'syslog.conf', 
```

如果您想要树中的 conf 文件列表 >= 1K：

```
In [23]: [x.name for x in Path('/etc').glob('**/*.conf') if x.stat().st_size > 1024]
Out[23]:
['dnsextd.conf',
 'pf.conf',
 'autofs.conf', 
```

解析相对路径变得容易：

```
In [32]: Path('../Operational Metrics.md').resolve()
Out[32]: PosixPath('/Users/starver/code/xxxx/Operational Metrics.md') 
```

使用路径导航非常清晰（尽管出乎意料）：

```
In [10]: p = Path('.')

In [11]: core = p / 'web' / 'core'

In [13]: [x for x in core.iterdir() if x.is_file()]
Out[13]:
[PosixPath('web/core/metrics.py'),
 PosixPath('web/core/services.py'),
 PosixPath('web/core/querysets.py'), 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2018-03-18T16:29:26.160

和我一起工作的那个是本页其他地方萨利赫回答的修改版本。

代码如下：

```
dir = 'given_directory_name'
filenames = [os.path.abspath(os.path.join(dir,i)) for i in os.listdir(dir)] 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-12-30T22:35:24.380

一个很好的衬里，只递归地列出文件。我在 setup.py package_data 指令中使用了它：

```
import os

[os.path.join(x[0],y) for x in os.walk('<some_directory>') for y in x[2]] 
```

我知道这不是问题的答案，但可能会派上用场

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-08-14T10:11:03.130

# 对于 Python 2

```
#!/bin/python2

import os

def scan_dir(path):
    print map(os.path.abspath, os.listdir(pwd)) 
```

# 对于 Python 3

对于过滤器和映射，您需要用 list() 包装它们

```
#!/bin/python3

import os

def scan_dir(path):
    print(list(map(os.path.abspath, os.listdir(pwd)))) 
```

现在的建议是您将 map 和 filter 的使用替换为生成器表达式或列表推导：

```
#!/bin/python

import os

def scan_dir(path):
    print([os.path.abspath(f) for f in os.listdir(path)]) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-11-23T11:38:05.423

```
#import modules
import os

_CURRENT_DIR = '.'

def rec_tree_traverse(curr_dir, indent):
    "recurcive function to traverse the directory"
    #print "[traverse_tree]"

    try :
        dfList = [os.path.join(curr_dir, f_or_d) for f_or_d in os.listdir(curr_dir)]
    except:
        print "wrong path name/directory name"
        return

    for file_or_dir in dfList:

        if os.path.isdir(file_or_dir):
            #print "dir  : ",
            print indent, file_or_dir,"\\"
            rec_tree_traverse(file_or_dir, indent*2)

        if os.path.isfile(file_or_dir):
            #print "file : ",
            print indent, file_or_dir

    #end if for loop
#end of traverse_tree()

def main():

    base_dir = _CURRENT_DIR

    rec_tree_traverse(base_dir," ")

    raw_input("enter any key to exit....")
#end of main()

if __name__ == '__main__':
    main() 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2014-08-19T18:17:06.807

仅供参考添加扩展或 ext 文件导入操作系统的过滤器

```
path = '.'
for dirname, dirnames, filenames in os.walk(path):
    # print path to all filenames with extension py.
    for filename in filenames:
        fname_path = os.path.join(dirname, filename)
        fext = os.path.splitext(fname_path)[1]
        if fext == '.py':
            print fname_path
        else:
            continue 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2016-02-25T13:31:56.903

如果想到我会把它扔进去。简单而肮脏的通配符搜索方式。

```
import re
import os

[a for a in os.listdir(".") if re.search("^.*\.py$",a)] 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2017-07-21T05:15:15.267

下面的代码将列出目录和目录中的文件

```
def print_directory_contents(sPath):
        import os                                       
        for sChild in os.listdir(sPath):                
            sChildPath = os.path.join(sPath,sChild)
            if os.path.isdir(sChildPath):
                print_directory_contents(sChildPath)
            else:
                print(sChildPath) 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-07-21T15:59:20.710

这是一个单行 Pythonic 版本：

```
import os
dir = 'given_directory_name'
filenames = [os.path.join(os.path.dirname(os.path.abspath(__file__)),dir,i) for i in os.listdir(dir)] 
```

此代码列出了给定目录名称中所有文件和目录的完整路径。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-11-09T21:04:19.830

我知道这是一个老问题。如果您在 liunx 机器上，这是我遇到的一种巧妙方法。

```
import subprocess
print(subprocess.check_output(["ls", "/"]).decode("utf8")) 
```

# python - Python子进程问题与＆符号

> ID：120657
> 
> 赞同：5
> 
> 时间：2008-09-23T12:28:39.717
> 
> 标签：python, windows, subprocess, command-line-arguments

我目前有一个 python 脚本的主要问题。该脚本通过处理程序运行任意命令，以将不正确的错误报告转换为正确的错误报告。

我遇到的问题是让脚本在 Windows 上正常工作，其路径中包含与符号的命令。我尝试引用命令，用 ^ 转义 & 符号，但都不起作用。我现在没有主意了。有什么建议么？

从目前的回应中澄清：

1.  我正在使用子流程模块
2.  我将命令行+参数作为列表传递
3.  问题在于命令本身的路径，而不是任何参数
4.  我试过引用命令。它会导致`[Error 123] The filename, directory name, or volume label syntax is incorrect`错误
5.  我没有使用 shell 参数（所以`shell=false`）
6.  万一这很重要，我会抓住一个管道到 stderr 来处理它，但忽略 stdout 和 stdin
7.  它目前仅适用于 Windows，并且在我迄今为止测试过的所有其他情况下都可以正常工作。
8.  失败的命令是：

> p = subprocess.Popen(prog, stderr = subprocess.PIPE, bufsize=-1)

当列表 'prog' 的第一个元素包含任何 & 符号时。引用第一个字符串不起作用。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T12:36:19.823

确保您使用的是列表并且没有 shell 扩展：

```
subprocess.Popen(['command', 'argument1', 'argument2'], shell=False) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T12:36:18.123

一个正确的答案将需要更多的信息。你到底在做什么？它是如何失败的？你在使用 subprocess 模块吗？您是在传递参数列表和 shell=False （或没有 shell 参数），还是实际上在调用 shell？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T12:36:32.630

尝试引用包含 &

```
wget "http://foo.com/?bar=baz&amp;baz=bar" 
```

通常是在 Linux shell 中必须做的事情

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T13:29:31.160

“用 ^ 转义与号”

你确定`^`是 Windows 的转义字符吗？你不应该用`\`吗？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T12:49:55.423

回答我自己的问题：

将参数作为列表传递时引用实际命令无法正常工作（命令是列表的第一项），因此为了解决该问题，我将列表转换为空格分隔的字符串并将其传递给子进程。

仍然欢迎更好的解决方案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-01-04T14:36:14.610

我尝试如下情况：

```
exe = 'C:/Program Files (x86)/VideoLAN/VLC/VLC.exe'
url = 'http://translate.google.com/translate_tts?tl=en&q=hello+world'
subprocess.Popen([exe, url.replace("&","^&")],shell=True) 
```

这确实有效。

# java - “找不到主类。程序将退出”

> ID：120662
> 
> 赞同：18
> 
> 时间：2008-09-23T12:28:54.990
> 
> 标签：java, squirrel-sql

我正在尝试运行 SQuirreL SQL。
我已经下载并安装了它，但是当我尝试运行它时，我收到以下错误消息：

> Java 虚拟机启动器。
> 无法找到主类。
> 程序将会退出。

我明白了这一点，但我不知道如何解决它。有什么帮助吗？

### 更多信息：

*   我在 Windows XP 专业版上。
*   我安装了 java 1.6，其他应用程序运行正常。
*   安装运行正常。
*   我相信我已经正确地遵循了安装说明。
*   为了运行它，我调用了**squirrel-sql.bat**文件。

### 更新

这个问题：[“找不到主类：XX。程序将退出。”](https://stackoverflow.com/questions/1417328/could-not-find-the-main-class) 从 Java 开发人员的角度给出了有关此错误的一些背景信息。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-23T12:39:20.207

您的计算机上是否安装了 Java？是否正确设置了其 bin 目录的路径（换句话说，如果您从命令行键入“java”，您会返回指令列表还是得到类似“java 未被识别为......”的内容？ )?

您可以尝试`squirrel-sql.jar`从命令行（从 squirrel sql 目录）运行，使用：

```
java -jar squirrel-sql.jar 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-23T14:56:37.397

类路径是系统在尝试查找您尝试运行的类时将遵循的路径。在您尝试执行的批处理文件中，它可能有一个变量，如 CLASSPATH=blah;blah;etc 或一个看起来类似于

```
java -classpath "c:\directory\lib\squirrel-sql.jar" com.some.squirrel.package.file 
```

如果您可以找到或添加该类路径设置，请确保它包含指向 squirrel-sql.jar 和它可能依赖的任何其他 jar 文件的路径，以分号分隔（或可能包含在安装）。

基本上，您只需要告诉 java 在哪里可以找到您要执行的类文件。维基百科对类路径有更深入的讨论，可以为您提供更多见解。[http://en.wikipedia.org/wiki/Classpath_(Java)](http://en.wikipedia.org/wiki/Classpath_(Java))

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-26T12:06:36.660

1.  必须设置 JAVA_HOME 变量，指向 prog 文件/java/version???/bin
2.  使用一些文本编辑器打开 squirrel-sql.bat 文件，查看 JAVA_HOME 变量是否与环境变量中的相同
3.  如果不匹配则更改它....然后再次运行 bat 文件

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T12:34:50.200

您是否按照以下说明进行操作：

[http://www.squirrelsql.org/#installation](http://www.squirrelsql.org/#installation)

如果是这样，您是在运行批处理文件还是运行 shell 脚本？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-08-21T16:31:43.260

调整 MB 对 windows 的回答，将摆脱控制台窗口：

```
start javaw -jar squirrel-sql.jar 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-27T09:47:28.637

.bat 文件似乎不起作用。

只需双击：

```
squirrel-sql.jar 
```

或输入：

```
java -jar squirrel-sql.jar 
```

在命令行中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-06-14T09:44:27.437

您可以放置​​ .; 在classpath中的环境变量来克服这个问题。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-06-28T17:21:34.650

我尝试启动 SQUirrel 3.1，但收到一条消息，指出“找不到主类 Files\Rational\ClearQuest\cqjni.jar”我注意到 C:\Program Files\Rational\ClearQuest\cqjni.jar 在我现有的类路径中由 Windows 环境变量 CLASSPATH 定义。

SQUirrel 不需要我现有的类路径，因此我更新了 SQUirrel bat 文件 squirrel-sql.bat。

**REM SET SQUIRREL_CP=%TMP_CP%;%CLASSPATH%**

**SET SQUIRREL_CP=%TMP_CP%**

它不再将我现有的类路径附加到它的类路径并且运行良好。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-04-29T16:37:21.123

当我“升级”到 64 位的 Windows 7 时，我遇到了这个问题。我的 Java JRE 是 64 位 JVM。我的机器上有一个用于浏览器的 32 位 JRE，所以我设置了一个系统变量：

```
JRE32=C:\Program Files\Java\jre7 
```

当我运行时：

```
"%JRE32\bin\java" -version 
```

我得到：

```
java version "1.7.0_51"
Java(TM) SE Runtime Environment (build 1.7.0_51-b13)
Java HotSpot(TM) Client VM (build 24.51-b03, mixed mode, sharing) 
```

这是一个 32 位的 JVM。否则它会说“Java HotSpot(TM) **64-Bit ”。**

我编辑了“squirrel-sql.bat”文件，重新标记第 4 行并添加第 5 行，如下所示：

```
(4) rem set "IZPACK_JAVA=%JAVA_HOME%"
(5) set IZPACK_JAVA=%JRE32% 
```

现在一切正常，又好又漂亮。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-10-24T11:26:12.080

我在使用不同的应用程序（BI Publisher）时遇到了同样的问题，因为我在 64 位版本的 Windows 上安装了该应用程序的 32 位版本。

```
Java Virtual Machine Launcher - could not find the main class 
```

[![在此处输入图像描述](https://i.stack.imgur.com/UOQJv.png)](https://i.stack.imgur.com/UOQJv.png)

我的案例的解决方案是告诉 BI Publisher 在哪里可以找到 x86 版本的 JRE：

[![在此处输入图像描述](https://i.stack.imgur.com/bGU5f.png)](https://i.stack.imgur.com/bGU5f.png)

# svn - Subclipse 1.4.4 可以与 Subversion 1.3.2 一起使用吗

> ID：120669
> 
> 赞同：1
> 
> 时间：2008-09-23T12:30:50.727
> 
> 标签：svn, subclipse

Subclipse 1.4.4 能否与 Subversion 1.3.2 一起安全工作？

我很困惑，因为它的[变更日志](http://subclipse.tigris.org/subclipse_1.4.x/changes.html)说

> 注意：从 Subclipse 1.3.0 开始，Subversion JavaHL 的最低要求是 1.5.0。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T13:36:09.757

Subclipse 需要客户端上的 Subversion 1.5.x。Subversion 1.5.x 客户端可以与任何 1.x 服务器通信，一直到 1.0.0。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T12:43:17.480

您的意思是 Subclipse 1.4.4 是否可以与 1.3.2 的服务器一起使用？如果是这样，可能是的，因为客户端往往比服务器更频繁地更新，因此它们试图向后兼容。不过，如果客户端基于 subversion 1.5，1.3.2 就开始变老了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T14:14:16.327

与服务器兼容是的。但是如果你在本地工作副本上使用它，你的工作副本会更新为新的 1.5 格式，所以如果你还使用命令行 svn 客户端或 tortoise，你也必须升级它们。

# javascript - Javascript 尝试/捕获

> ID：120693
> 
> 赞同：5
> 
> 时间：2008-09-23T12:34:19.547
> 
> 标签：javascript, regex, try-catch

我有一个运行用户生成的正则表达式的函数。但是，如果用户输入了一个不会运行的正则表达式，那么它就会停止并跌倒。我已经尝试将该行包装在 Try/Catch 块中，但是没有任何反应。

如果有帮助，我正在运行 jQuery，但下面的代码没有它，因为我猜它比这更基本一点。

编辑：是的，我知道我没有逃避“[”，这是故意的，也是问题的重点。我正在接受用户输入，我想找到一种方法来捕捉这类问题，而不会让应用程序陷入困境。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
    <title>Regex</title>

    <script type="text/javascript" charset="utf-8">
        var grep = new RegExp('gr[');

        try
        {
            var results = grep.exec('bob went to town');
        }
        catch (e)
        {
            //Do nothing?
        }

        alert('If you can see this then the script kept going');
    </script>
</head>
<body>

</body>
</html> 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-23T12:42:05.300

试试这个新的正则表达式抛出异常

正则表达式

```
 <script type="text/javascript" charset="utf-8">
            var grep;

            try {
                    grep = new RegExp("gr[");
            }
            catch(e) {
                    alert(e);

            }
            try
            {
                    var results = grep.exec('bob went to town');
            }
            catch (e)
            {
                    //Do nothing?
            }

            alert('If you can see this then the script kept going');
    </script> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-23T12:37:39.397

问题在于这一行：

```
var grep = new RegExp('gr['); 
```

'[' 是一个特殊字符，因此需要对其进行转义。此行也未包含在 try...catch 中，因此您仍然会收到错误消息。

**编辑**：您还可以添加一个

```
alert(e.message); 
```

在 catch 子句中查看错误消息。它对 javascript 中的各种错误很有用。

**编辑2**：好的，我需要更仔细地阅读这个问题，但答案仍然存在。在示例代码中，违规行没有包含在 try...catch 块中。我把它放在那里，在 Opera 9.5、FF3 和 IE7 中没有出错。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T12:55:55.983

```
var grep, results;

try {
    grep = new RegExp("gr[");
    results = grep.exec('bob went to town');
}
catch(e) {
    alert(e);
}
alert('If you can see this then the script kept going'); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T15:37:29.777

将 RegExp 初始化放在 try/catch 中会起作用（刚刚在 FireFox 中测试过）

```
 var grep, results;

try
{
    grep = new RegExp("gr["); // your user input here
}
catch(e)
{
    alert("The RegExpr is invalid");
}

// do your stuff with grep and results 

```

逃到这里不是解决办法。由于此代码段的目的是实际测试用户生成的 RegExpr，因此您需要将 [ 作为未封闭的 RegExpr 容器来捕获。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T12:38:15.230

您的 RegExp 不会关闭 [

在我的 FireFox 中，它永远不会从构造函数返回——看起来像是 RegExp 实现中的一个错误，但如果你提供一个有效的表达式，它就可以工作

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T12:54:04.257

一种选择是验证用户生成的表达式。那是; 你知道的转义字符会停止你的脚本。

# scala - Scala REPL 中的递归重载语义 - JVM 语言

> ID：120702
> 
> 赞同：8
> 
> 时间：2008-09-23T12:35:48.840
> 
> 标签：scala, recursion, jvm, jvm-languages

使用 Scala 的命令行 REPL：

```
def foo(x: Int): Unit = {}
def foo(x: String): Unit = {println(foo(2))} 
```

给

```
error: type mismatch;
found: Int(2)
required: String 
```

看来你不能在 REPL 中定义重载的递归方法。我认为这是 Scala REPL 中的一个错误并提交了它，但它几乎立即以“wontfix 关闭：鉴于解释器的语义，我看不出有任何方法可以支持，因为必须编译这两种方法一起。” 他建议将这些方法放在一个封闭的对象中。

是否有 JVM 语言实现或 Scala 专家可以解释原因？例如，如果这些方法相互调用，我可以看到这将是一个问题，但在这种情况下呢？

或者，如果这是一个太大的问题，而您认为我需要更多的先决知识，那么是否有人有任何关于语言实现的书籍或网站的良好链接，尤其是在 JVM 上？（我知道 John Rose 的博客，以及 Programming Language Pragmatics 这本书……但仅此而已。:)

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-23T17:06:52.137

问题是由于解释器通常必须用给定名称*替换*现有元素，而不是重载它们。例如，我经常会尝试一些东西，经常创建一个名为`test`：

```
def test(x: Int) = x + x 
```

稍后，假设我正在运行一个*不同*的实验，我创建了另一个名为 的方法`test`，与第一个方法无关：

```
def test(ls: List[Int]) = (0 /: ls) { _ + _ } 
```

这不是一个完全不现实的场景。事实上，这正是大多数人使用解释器的方式，通常甚至没有意识到。如果解释器任意决定将两个版本都保留`test`在范围内，则可能会导致在使用测试时混淆语义差异。例如，我们可能会调用`test`，不小心传递了一个`Int`而不是`List[Int]`（这不是世界上最不可能发生的事故）：

```
test(1 :: Nil)  // => 1
test(2)         // => 4  (expecting 2) 
```

随着时间的推移，解释器的根范围会变得非常混乱，其中包含各种版本的方法、字段等。我倾向于让我的解释器一次打开几天，但如果允许这样的重载，我们将被迫“经常冲洗”解释器，因为事情变得太混乱了。

这不是 JVM 或 Scala 编译器的限制，而是经过深思熟虑的设计决定。如错误中所述，如果您在根范围以外的范围内，您仍然可以重载。在一个类中包含你的测试方法对我来说似乎是最好的解决方案。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-09-08T04:03:22.987

```
% scala28
Welcome to Scala version 2.8.0.final (Java HotSpot(TM) 64-Bit Server VM, Java 1.6.0_20).
Type in expressions to have them evaluated.
Type :help for more information.

scala> def foo(x: Int): Unit = () ; def foo(x: String): Unit = { println(foo(2)) } 
foo: (x: String)Unit <and> (x: Int)Unit
foo: (x: String)Unit <and> (x: Int)Unit

scala> foo(5)

scala> foo("abc")
() 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T15:15:29.673

如果您复制两行并同时粘贴两行，REPL 将接受。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-30T19:17:07.280

如[extempore's](https://stackoverflow.com/users/89872/extempore) answer所示，有可能超载。[丹尼尔](https://stackoverflow.com/users/9815/daniel-spiewak)关于设计决策的评论是正确的，但是，我认为，不完整且有点误导。没有*禁止*重载（因为它们是可能的），但它们不容易实现。

导致这种情况的设计决策是：

1.  所有以前的定义都必须可用。
2.  只编译新输入的代码，而不是每次都重新编译曾经输入的所有代码。
3.  必须可以重新定义定义（如丹尼尔所述）。
4.  必须可以定义成员，例如 vals 和 defs，而不仅仅是类和对象。

问题是……如何实现所有这些目标？我们如何处理您的示例？

```
def foo(x: Int): Unit = {}
def foo(x: String): Unit = {println(foo(2))} 
```

从第 4 项开始，A `val`or`def`只能在 a `class`, `trait`, `object`or中定义`package object`。因此，REPL 将定义放在对象中，就像这样（*不是实际表示！*）

```
package $line1 { // input line
  object $read { // what was read
    object $iw { // definitions
      def foo(x: Int): Unit = {}
    }
    // val res1 would be here somewhere if this was an expression
  }
} 
```

现在，由于 JVM 的工作方式，一旦定义了其中之一，就无法扩展它们。当然，您可以重新编译所有内容，但我们放弃了它。所以你需要把它放在不同的地方：

```
package $line1 { // input line
  object $read { // what was read
    object $iw { // definitions
      def foo(x: String): Unit = { println(foo(2)) }
    }
  }
} 
```

这解释了为什么您的示例不是重载：它们是在两个不同的地方定义的。如果将它们放在同一行，它们将被一起定义，这会使它们重载，如 extempore 的示例所示。

至于其他设计决策，每个新包导入定义和以前包的“res”，并且导入可以相互影响，这使得“重新定义”东西成为可能。

# asp.net - 使用 ASP.NET 3.5 开始使用 AJAX，我在服务器上需要什么

> ID：120704
> 
> 赞同：4
> 
> 时间：2008-09-23T12:36:09.980
> 
> 标签：asp.net, asp.net-ajax

我的开发机器上有 .net 框架 3.5，并且还在我的代码中使用 AJAX 工具包。为了将此代码发布到我的用户的服务器，我是否需要服务器上的任何东西才能使我的 AJAX 代码正确运行？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T12:40:59.907

您只需要 .NET 框架 3.5。

如果您发布您的项目，使用的 AJAX 工具包也将被复制过来。如果您仅通过文件而不是通过项目引用 AJAX 工具包，请确保在属性窗口中将 dll 设置为“始终复制”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T12:41:17.440

.NET 3.5 需要安装在服务器上。Ajax Control Toolkit 程序集不需要实际加载到服务器上，但至少需要在 Bin 文件夹中，并在 web.config 中引用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T12:44:27.790

当然，您需要在服务器上安装 .NET Framework。如果您使用的是 AJAX Toolkit，您需要将 AjaxControlToolkit.dll 复制到服务器上 Web 应用程序的 bin 文件夹中。

还要确保将 Web 应用程序设置为使用 .NET Framework 2.0。在 IIS 中，转到网站的属性，然后转到 ASP.NET 选项卡并确保 ASP.NET 版本设置为 2.0。

# visual-studio-2005 - 在 Visual Studio 2005 中设置 F#

> ID：120715
> 
> 赞同：5
> 
> 时间：2008-09-23T12:37:17.730
> 
> 标签：visual-studio-2005, f#, functional-programming

在 Visual Studio 2005 中设置 F# 是否有任何体面的教程？我在 VS2008 上找到的所有内容。

即：项目下的“F#项目”等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T12:57:42.597

不幸的是，F# 的 CTP 版本不支持 VS 2005。两种选择：

1.  使用 1.9.4.19，最新的 pre-CTP 版本
2.  下载免费的[VS2008](http://www.microsoft.com/downloads/details.aspx?FamilyId=40646580-97FA-4698-B65F-620D4B4B1ED7&displaylang=en) shell 并使用它（我没有尝试过，但显然它[可以工作](http://fsharpnews.blogspot.com/2007/12/f-in-visual-studio-for-free.html)）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T12:42:09.090

[为 Microsoft Visual Studio 2005 安装 F# 编辑](http://research.microsoft.com/fsharp/manual/install.aspx)

该页面还链接到[Don Syme 的 F# 博客](http://blogs.msdn.com/dsyme/)，其中包含很多关于在 VS 中使用 F# 的有用内容，包括[VS2005 中的 F# intellisense](http://blogs.msdn.com/dsyme/archive/2005/01/29/362865.aspx)演示。

# sql - SQL Server - Partitioned Tables vs. Clustered Index?

> ID：120731
> 
> 赞同：19
> 
> 时间：2008-09-23T12:39:53.417
> 
> 标签：sql, sql-server, database

Let's assume you have one massive table with three columns as shown below:

```
[id] INT NOT NULL,

[date] SMALLDATETIME NOT NULL,

[sales] FLOAT NULL 
```

Also assume you are limited to one physical disk and one filegroup (PRIMARY). You expect this table to hold sales for 10,000,000+ ids, across 100's of dates (easily 1B+ records).

As with many data warehousing scenarios, the data will typically grow sequentially by date (i.e., each time you perform a data load, you will be inserting new dates, and maybe updating some of the more recent dates of data). For analytic purposes, the data will often be queried and aggregated for a random set of ~10,000 ids which will be specified via a join with another table. Often, these queries don't specify date ranges, or specify very wide date ranges, which leads me to my question: What is the best way to index / partition this table?

I have thought about this for a while, but am stuck with conflicting solutions:

**Option #1:** As data will be loaded sequentially by date, define the clustered index (and primary key) as [date], [id]. Also create a "sliding window" partitioning function / scheme on date allowing rapid movement of new data in / out of the table. Potentially create a non-clustered index on id to help with querying.

**Expected Outcome #1:** This setup will be very fast for data loading purposes, but sub-optimal when it comes to analytic reads as, in a worst case scenario (no limiting by dates, unlucky with set of id's queried), 100% of the data pages may be read.

**Option #2:** As the data will be queried for only a small subset of ids at a time, define the clustered index (and primary key) as [id], [date]. Do not bother to create a partitioned table.

**Expected Outcome #2:** Expected huge performance hit when it comes to loading data as we can no longer quickly limit by date. Expected huge performance benefit when it comes to my analytic queries as it will minimize the number of data pages read.

**Option #3:** Clustered (and primary key) as follows: [id], [date]; "sliding window" partition function / scheme on date.

**Expected Outcome #3:** Not sure what to expect. Given that the first column in the clustered index is [id] and thus (it is my understanding) the data is arranged by ID, I would expect good performance from my analytic queries. However, the data is partitioned by date, which is contrary to the definition of the clustered index (but still aligned as date is part of the index). I haven't found much documentation that speaks to this scenario and what, if any, performance benefits I may get from this, which brings me to my final, bonus question:

If I am creating a table on one filegroup on one disk, with a clustered index on one column, is there any benefit (besides partition switching when loading the data) that comes from defining a partition on the same column?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-23T13:11:13.390

这张桌子非常窄。如果真正的表会这么窄，您应该很高兴使用表扫描而不是索引->查找。

我会这样做：

```
CREATE TABLE Narrow
(
  [id] INT NOT NULL,
  [date] SMALLDATETIME NOT NULL,
  [sales] FLOAT NULL,
  PRIMARY KEY(id, date)  --EDIT, just noticed your id is not unique.
)

CREATE INDEX CoveringNarrow ON Narrow(date, id, sales) 
```

这可以处理带有搜索的点查询和针对日期标准和 id 标准进行有限扫描的广泛查询。没有从索引中查找每条记录。是的，我已经将写入时间（和使用的空间）翻了一番，但这很好，imo。

* * *

如果需要特定的数据（并且**通过分析证明了**这种需求！！），我将创建一个针对表的该部分的集群视图。

```
CREATE VIEW Narrow200801
AS
SELECT * FROM Narrow WHERE '2008-01-01' <= [date] AND [date] < '2008-02-01'
--There is some command that I don't have at my finger tips to make this a clustered view. 
```

集群视图可以按名称在查询中使用，或者当 FROM 和 WHERE 子句合适时，优化器将选择使用集群视图。例如，此查询将使用集群视图。请注意，查询中引用了基表。

```
SELECT SUM(sales) FROM Narrow WHERE '2008-01-01' <= [date] AND [date] < '2008-02-01' 
```

由于*索引*使您可以方便地访问特定的列...*集群视图*使您可以方便地访问特定的行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T13:01:23.350

在本地化 I/O 时，聚集索引将为您的查询带来性能优势。日期是一种传统的分区策略，因为许多 D/W 查询按日期查看移动。

分区表的经验法则表明，分区的大小应约为 10m 行。

在不同的分析工作负载上看到聚集索引的性能提升多少有点不寻常。查询优化器将使用一种称为[“索引交集”](http://www.databasejournal.com/features/mssql/article.php/1438821)的技术来选择行，甚至不触及事实表。有关我在另一个问题上所做的帖子，请参阅[此处，该帖子通过一些链接更深入地解释了这一点。](https://stackoverflow.com/questions/110032/star-schema-design#111044)聚集索引可能会或可能不会参与索引交集，因此您可能会发现它在一般查询工作负载上的收益相对较小。

您可能会在加载时发现聚集索引给您带来一些好处的情况，特别是如果您有在 ETL 过程中计算的派生计算（例如[Earned Premium ）。](http://en.wikipedia.org/wiki/Earned_premium)在这种情况下，您可能会获得一些好处。如果您有一个您知道将一直执行的特定查询，那么为此使用聚集索引可能是有意义的。如果您期望这种类型的查询是应用程序完成的绝大多数工作，选项#2 和#3 只会使您受益匪浅。

对于一个灵活的系统，一个简单的日期范围分区，在 ID 上有一个索引（如果分区包含一个范围，那么日期可能会给你带来和任何一样好的性能。你可能会从对索引有限的情况下集群获得一些好处。你可能还可以通过在数据上构建多维数据集并确保为此查询正确设置聚合来获得一些好处。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T13:50:16.727

按日期对表进行分区。几个水平分区将比一个有那么多行的大表性能更高。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T12:57:42.190

如果您在选择语句中使用分区，那么您会获得一些速度。

如果您不使用它，仅使用“标准”选择，那么您将没有任何好处。

关于您最初的问题：我建议您选择 #1，其中包含 id 上的非聚集索引。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T13:03:21.067

我会做以下事情：

*   [Id] 上的非聚集索引
*   [日期] 聚集索引
*   将 [sales] 数据类型转换为数字而不是浮点数

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T22:13:18.220

如果您的插入速度比 3.33 毫秒的日期时间分辨率更快，那么日期列上的聚集索引就不好。如果这样做，您将获得 2 个具有相同值的键，并且您的索引将不得不获得另一个内部唯一性，这将增加其大小。

我会选择你的第二个选项。

# search - How can I enumerate all *.exes and the details about each?

> ID：120733
> 
> 赞同：2
> 
> 时间：2008-09-23T12:40:09.393
> 
> 标签：search, foreach, nsis, exe

Something like:

```
//Get all search data
$search = new search('C:\', '*.exe');
while($item = $search->next())
{
$details = $item->getDetails();
append_details('C:\files.txt', implode_details($details));
} 
```

But in NSIS ([http://nsis.sourceforge.net/](http://nsis.sourceforge.net/))

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-09T14:45:14.607

You could use the FindFirst/FindNext functions to loop through everything in a particular directory.

```
FindFirst $0 $1 "c:\*.exe"
FileLoop:

StrCmp $1 "" DoneFileLoop ;Check for no files
DetailPrint $1 ;Print file name

;Code to output whatever details you wanted to a txt file here

FindNext $0 $1 ;Get the next file from the list
goto FileLoop ;Go back to the top and check for no files

DoneFileLoop: 
```

# ruby-on-rails - 在 Ruby on Rails 中支持 /similar-to-:product 之类的 URL？

> ID：120751
> 
> 赞同：3
> 
> 时间：2008-09-23T12:43:42.147
> 
> 标签：ruby-on-rails, seo, friendly-url

我一直在尝试使用 routes.rb 为我的网站创建一个 URL /similar-to-:product （其中产品是动态的）。问题是 routes.rb 很容易支持 /:product-similar 之类的 URL，但不支持前者，因为它要求 :product 前面有分隔符（'/' 是分隔符，但 '-' 不是）。分隔符列表在 ActionController::Routing::SEPARATORS 中。

我不能添加 '-' 作为分隔符，因为 :product 也可以包含连字符。支持这样的 URL 的最佳方式是什么？

我成功尝试过的一种方法是不使用 routes.rb 并将 URL 解析逻辑放在控制器本身中，但这不是最干净的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T17:34:53.257

我会重构您的 URL，以便它们只是“类似于/产品”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-06T08:34:46.537

实际上，您可以添加`-`为分隔符，然后使用路由通配符。

```
map.similar_product '/similar-to-*product', :controller => 'products', :action => 'similar' 
```

然后，在 ProductsController#similar

```
@product = Product.find_by_slug params[:product].join('-') 
```

尽管重构看起来确实更好，因为使用这种方法，您需要专门处理所有可以包含连字符的 slug。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-25T09:16:07.777

一个简单的解决方案是使用[路由过滤器](http://github.com/svenfuchs/routing-filter)。有关详细信息，请参阅自述文件。

使用路由过滤器，您可以拥有一个 url ，在它进行路由识别之前对其进行`/similar-to-:product`预处理。`/similar-to/:product`您还需要对生成的路径进行后处理，从`/similar-to/:product`到`/similat-to-:product`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T12:58:21.017

我有点困惑，但你可以添加“to-”作为分隔符吗？

# .net - ADO.NET Entity Framework 和标识列

> ID：120755
> 
> 赞同：49
> 
> 时间：2008-09-23T12:44:47.727
> 
> 标签：.net, sql-server, entity-framework, identity

实体框架是否知道标识列？

我正在使用 SQL Server 2005 Express Edition，并且有几个表，其中主键是标识列。当我使用这些表来创建实体模型并将模型与实体数据源结合使用以创建新实体时，我被要求为标识列输入一个值。有没有办法让框架不要求身份列的值？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-12-23T09:46:41.057

我知道这篇文章已经很老了，但这可能有助于下一个到达的人通过谷歌搜索“实体框架”和“身份”来听到。

似乎实体框架确实尊重服务器生成的主键，如果设置了“身份”属性就是这种情况。但是，应用程序端模型仍然需要在方法中提供主键`CreateYourEntityHere`。`SaveChanges()`此处指定的键在调用上下文时被丢弃。

[此处](https://blogs.msdn.microsoft.com/dsimmons/2008/08/10/entity-services-metadata-mapping/#Section_17)的页面提供了有关此的详细信息。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-07-19T03:01:41.357

如果您使用的是 Entity Framework 5，则可以使用以下属性。

```
[DatabaseGenerated(DatabaseGeneratedOption.Identity)] 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-23T16:28:14.413

You should set the identity columns' identity specification so that the (Is Identity) property is set to true. You can do this in your table designer in SSMS. Then you may need to update the entity data model.

Perhaps that what you mean by saying the "Primary key is an identity column," or perhaps you missed this step.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-06-08T16:28:27.420

这是我见过的最好的答案。您必须手动编辑存储层 xml 以`StoreGeneratedPattern="Identity"`在每个类型的主键上`UniqueIdentifier`设置默认值设置为`NewID()`.

[http://web.archive.org/web/20130728225149/http://leedumond.com/blog/using-a-guid-as-an-entitykey-in-entity-framework-4/](http://web.archive.org/web/20130728225149/http://leedumond.com/blog/using-a-guid-as-an-entitykey-in-entity-framework-4/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-23T12:48:40.637

实体框架知道并且可以处理标识列。

您的问题可能不是 EF 本身，而是它生成的表单视图。尝试从插入表单中删除标识列的输入，让我们看看会发生什么。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-25T18:33:13.893

如果在你扯掉头发之前一切都失败了 - 尝试删除你的 EntityModel 并从 SQL Server 重新导入。如果您一直在调整键和关系并依赖“从数据库更新模型”功能，那么在我发现的 RC 版本中它仍然有点错误 - 新的导入可能会有所帮助。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-03-19T15:42:04.837

在 C# 中，您可以执行以下操作以使其知道：

在你的`FooConfiguration.cs : EntityTypeConfiguration<Foo>`：

```
this.Property(x => x.foo).HasDatabaseGeneratedOption(DatabaseGeneratedOption.Identity); 
```

然后要使用它，只需确保将项目插入上下文并`context.SaveChanges()`在使用之前调用`x.foo`以获取更新的自动递增值。否则`x.foo`将只是 0 或 null。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-06T07:09:08.747

由于某种原因，实体框架不能完全理解身份。正确的解决方法是将该列的 Setter 设置为 Private。这将使任何生成的 UI 明白它不应该设置标识值，因为它不可能设置私有字段。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-03-23T14:50:21.780

对我有用的是将 StoreGeneratedPattern 设置为 None，当它是一个 Identity 列时。现在这一切都在一致地工作。这样做的主要问题是，如果你有很多模型，编辑模型是一件非常麻烦的事。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-03-31T17:58:02.597

我不相信。智能感知 ItemCollection 在 SaveChanges 后生成 ID = 0 的单个项目。

```
 Dim ItemCollection = From d In action.Parameter
            Select New STOCK_TYPE With {
                        .Code = d.ParamValue.<Code>.Value,
                        .GeneralUseID = d.ParamValue.<GeneralUse>.Value,
            }

            GtexCtx.STOCK_TYPE.AddObject( ItemCollection.FirstOrDefault)
            GtexCtx.SaveChanges() 
```

不管我做什么。8 小时后，包括删除我的模型、35 次构建和重建、试验和编辑 EDMX 的 XML，现在几乎要删除我的整个 SQL Server 数据库。在第 36 次编译时，这个令人瞠目结舌的解决方案奏效了

```
 Dim abc = ItemCollection.FirstOrDefault
            GtexCtx.STOCK_TYPE.AddObject(abc)
            GtexCtx.SaveChanges() 
```

abc.ID yield 41（我需要的身份）

编辑：这是一个简单的代码，用于循环 AddObject 并仍然获得 ID

```
Dim listOfST As List(Of STOCK_TYPE) = ItemCollection.ToList()
      For Each q As STOCK_TYPE In listOfST 
         GtexCtx.STOCK_TYPE.AddObject(q)
      Next
 GtexCtx.SaveChanges()

...more code for inter-relationship tables 
```

在 SaveChanges 之后尝试 Intellisence listOfST，您会发现更新的 ID。也许有更好的方法，但概念就在那里

# c# - 将文字“@”与字符串变量一起使用

> ID：120763
> 
> 赞同：7
> 
> 时间：2008-09-23T12:45:48.943
> 
> 标签：c#, string

我有一个帮助类从 XML 文件中提取字符串。该字符串是一个文件路径（所以它有反斜杠）。我需要按原样使用该字符串...如何像使用文字命令一样使用它？

而不是这个：

```
string filePath = @"C:\somepath\file.txt"; 
```

我想做这个：

```
string filePath = @helper.getFilePath(); //getFilePath returns a string 
```

这不是我实际使用它的方式；这只是为了让我的意思更清楚一点。有某种 .ToLiteral() 之类的吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-09-23T12:49:22.663

如果您已经拥有价值，我认为您不必担心。@ 运算符用于您指定字符串时（如在您的第一个代码片段中）。

您试图对不起作用的路径字符串做什么？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T12:50:19.603

我不确定我是否理解。在您的示例中：如果`helper.getFilePath()`返回`"c:\somepath\file.txt"`，则不会有问题，因为`@`仅当您明确指定带有“”的字符串时才需要。

当函数*相互交谈时*，您将始终获得文字路径。如果 XML 包含`c:\somepath\file.txt`并且您的函数返回`c:\somepath\file.txt`，则字符串 filePath 也将包含`c:\somepath\file.txt`作为有效路径。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-23T13:02:01.133

@"" 只是让编写字符串文字变得更容易。

[字符串（C# 参考，MSDN）](http://msdn.microsoft.com/en-us/library/362314fe.aspx)

> 逐字字符串文字以 @ 开头，也用双引号括起来。例如：
> 
> > `@"good morning" // a string literal`
> 
> 逐字字符串的优点是不处理转义序列，这使得编写起来很容易，例如，一个完全限定的文件名：
> 
> > `@"c:\Docs\Source\a.txt" // rather than "c:\\Docs\\Source\\a.txt"`

我使用它的一个地方是正则表达式模式：

```
字符串模式 = @"\b[DdFf][0-9]+\b";
```

如果变量中有一个字符串，则不需要用它制作“文字”，因为如果它格式正确，它已经具有正确的内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T12:53:17.630

在 C# 中，@ 符号结合双引号允许您编写转义字符串。例如

```
print(@"c:\mydir\dont\have\to\escape\backslashes\etc"); 
```

如果你不使用它，那么你需要在你的字符串中使用转义字符。

[http://msdn.microsoft.com/en-us/library/aa691090(VS.71).aspx](http://msdn.microsoft.com/en-us/library/aa691090(VS.71).aspx)

您不需要在代码中的其他任何地方指定它。事实上，这样做应该会导致编译器错误。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T12:54:41.870

你把它弄反了。@-operator 用于将文字转换为字符串，同时保留所有时髦的字符。你的路径已经是一个字符串——你根本不需要对它做任何事情。只是失去@。

```
string filePath = helper.getFilePath(); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T13:01:05.567

从帮助程序类返回的字符串不是文字字符串，因此您不需要使用“@”字符来删除反斜杠的行为。

# asp.net - 如何使用 ASP.NET 更改 HTML 页面元素的 CSS 类？

> ID：120766
> 
> 赞同：18
> 
> 时间：2008-09-23T12:46:32.340
> 
> 标签：asp.net, css, dynamic-css

我在 ASP.NET 页面上有几个具有不同 id 的 <li> 元素：

```
<li id="li1" class="class1">
<li id="li2" class="class1">
<li id="li3" class="class1"> 
```

并且可以像这样使用 JavaScript 更改他们的类：

```
li1.className="class2" 
```

但是有没有办法使用 ASP.NET 来改变 <li> 元素类？它可能是这样的：

```
WebControl control = (WebControl)FindControl("li1");
control.CssClass="class2"; 
```

但是 FindControl() 并没有像我预期的那样工作。有什么建议么？

提前致谢！

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-29T14:30:47.747

`runat="server"`在您的 HTML 页面中添加

然后像这样在你的asp.Net页面中使用属性属性

```
li1.Attributes["Class"] = "class1";
li2.Attributes["Class"] = "class2"; 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-23T12:49:39.620

如果您在 <li> 中包含 runat="server"，FindControl 将起作用

```
<li id="li1" runat="server">stuff</li> 
```

否则，您的服务器端代码无法“看到”它。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-23T13:13:09.423

FindControl 方法搜索服务器控件。也就是说，它会查找属性“runat”设置为“server”的控件，如下所示：

```
<li runat="server ... ></li> 
```

因为您的 <li> 标记不是服务器控件，所以 FindControl 找不到它们。您可以将“runat”属性添加到这些控件或使用 ClientScript.RegisterStartupScript 包含一些客户端脚本来操作类，例如

```
System.Text.StringBuilder sb = new System.Text.StringBuilder();
sb.Append("<script language=\"javascript\">");
sb.Append("document.getElementById(\"li1\").className=\"newClass\";")
sb.Append("</script>");
ClientScript.RegisterStartupScript(this.GetType(), "MyScript", sb.ToString()); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2010-01-20T05:58:30.460

这将找到 li 元素并在其上设置一个 CSS 类。

```
using System.Web.UI.HtmlControls;

HtmlGenericControl liItem = (HtmlGenericControl) ctl.FindControl("liItemID");
liItem.Attributes.Add("class", "someCssClass"); 
```

请记住添加`runat="server"`其他人提到的属性。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-23T12:48:48.000

你必须设置 runat="server" 像：

```
<li id="li1" runat="server">stuff</li> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-08-09T08:49:34.027

如果您想应用样式，请尝试以下操作：

```
li1.Style.Add("background-color", "black"); 
```

对于 CSS，您可以尝试以下语法：

```
li1.Attributes.Add("class", "clsItem"); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-07-06T07:37:10.027

Leaf Dev 为此提供了解决方案，但在“ctl”的位置，您需要插入“Master”。

无论如何它对我有用：

```
using System.Web.UI.HtmlControls;

HtmlGenericControl liItem = (HtmlGenericControl) ctl.FindControl("liItemID");
liItem.Attributes.Add("class", "someCssClass"); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-06-06T09:47:32.553

如果你想添加一些样式，你也可以试试这个：

```
li1.Style.add("color","Blue");
li2.Style.add("text-decoration","line-through"); 
```

# c# - 在移动设备中实施谷歌地图

> ID：120775
> 
> 赞同：1
> 
> 时间：2008-09-23T12:49:15.860
> 
> 标签：c#, .net, google-maps, compact-framework

如何使用 .net2.0 在移动应用程序中显示谷歌地图

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-08T14:55:03.883

一种非常简单的方法是使用[Google Maps Static API](http://code.google.com/apis/maps/documentation/staticmaps/)、[HttpWebRequest](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.aspx)和[Image.Save](http://msdn.microsoft.com/en-us/library/9t4syfhh.aspx)来下载地图图像，例如“ [http://maps.google.com/staticmap?zoom=14&size=512x512&mapt](http://maps.google.com/staticmap?zoom=14&size=512x512&mapt) ype=mobile&markers= 40.714728,-73.998672&key=YOUR-GOOGLE-MAPS-API-KEY" 可以显示在[PictureBox](http://msdn.microsoft.com/en-us/library/system.windows.forms.picturebox.aspx)中。

问候，坦伯格

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T05:28:37.630

地图必须来自谷歌吗？我正在编写一个使用 Live Maps 在 Compact Framework 应用程序上显示地图的应用程序。不过，当我编写应用程序时，我使用的是 3.5 框架，所以我不确定这是否符合您的需求。

[http://www.codeproject.com/KB/mobile/WiMoWifiPosition.aspx](http://www.codeproject.com/KB/mobile/WiMoWifiPosition.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-22T18:08:36.300

派对迟到了，但您可能会发现这也很有帮助：

[http://www.koushikdutta.com/2008/07/virtual-earth-and-google-maps-tiled-map.html](http://www.koushikdutta.com/2008/07/virtual-earth-and-google-maps-tiled-map.html)

应该比静态地图 API 给您更多的灵活性（缩放、移动等）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-30T17:12:57.327

有多种控件可用于将 Google 地图集成到 ASP.net 网站中。由于 Windows Mobile 上提供了 Sockets 和 Net 库，您可以使用 Google Maps API 进行集成，但是必须构建您自己的控件来显示地图。API 可以在[这里](http://code.google.com/apis/maps/ "谷歌地图 API")找到。

# winforms - 应用程序控制器应该做什么？

> ID：120781
> 
> 赞同：10
> 
> 时间：2008-09-23T12:49:46.763
> 
> 标签：winforms, design-patterns

我对应用程序控制器应该做什么有点困惑？因为我看到您的 MVP 模式中也存在该功能来决定单击按钮时应显示哪种形式？有没有使用应用程序控制器模式的 Windows 窗体的好例子？

MVC（控制器）和应用程序控制器有区别。我知道 MVC（控制器），我不确定应用程序控制器的职责是什么，以及它如何适合 WinForms 应用程序。Martin Fowler 也称其为 Application Controller 模式，肯定与 MVC(ontroller) 不一样吧？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-28T15:49:22.947

应用程序控制器与 MVC 中使用的控制器有点不同。

Martin Fowler 在[Application Controller](http://martinfowler.com/eaaCatalog/applicationController.html)上的页面。

对于 MVP WinForms 应用程序，这似乎是我认为的问题主题。您*可以*将“我现在显示什么形式”的所有逻辑放入 Presenter，但随着应用程序的增长，您将在 Presenter 之间复制大量代码。

假设您有 2 个视图，它们都有一个“编辑此小部件”按钮，它们都必须具有获取 WidgetEditorPresenter 并显示关联视图的逻辑。如果你有一个 ApplicationController，你把这个逻辑移到 ApplicationController 中，现在你的所有 Presenter 都依赖于 ApplicationController，你可以调用 appController.EditWidget()，它会弹出正确的视图。

应用程序控制器是一个超级控制器，当您从一个屏幕移动到另一个屏幕时，它可以控制整个系统中的应用程序流。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-20T21:44:12.297

我最近写了一篇关于在 C# Winforms 项目中创建和使用 ApplicationController 的文章，以将工作流和演示者直接与表单分离。它可能会有所帮助：

[使用应用程序控制器解耦工作流和表单](http://www.lostechies.com/blogs/derickbailey/archive/2009/04/18/decoupling-workflow-and-forms-with-an-application-controller.aspx)

**编辑：**
Archive.org 目前获得了[这篇文章的可读性更高的副本](https://web.archive.org/web/20100414033935/http://www.lostechies.com/blogs/derickbailey/archive/2009/04/18/decoupling-workflow-and-forms-with-an-application-controller.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T13:02:42.660

就我个人而言，我没有使用 MVP 或 winforms 的经验，但我使用过 MVC。我希望这是您要问的，否则完全忽略我的回答。

MVC 中的 C 不仅仅负责选择要呈现给客户端的下一个视图。它拥有应用程序的大部分业务逻辑，最好**是所有**业务逻辑，包括系统任务的执行（例如记录和对从模型到模型的数据流执行权限）。

它的主要任务自然是为上面的表示层提供服务，并将其与下面的模型层分开，同时在它们之间进行调解。我想您可以将其视为应用程序的大脑。

希望这可以帮助，

尤瓦尔=8-)

# c# - 如何在不可变的泛型 Pair 结构上实现 IEqualityComparer？

> ID：120783
> 
> 赞同：3
> 
> 时间：2008-09-23T12:50:01.490
> 
> 标签：c#, generics, struct

目前我有这个（阅读建议后编辑）：

```
struct Pair<T, K> : IEqualityComparer<Pair<T, K>>
{
    readonly private T _first;
    readonly private K _second;

    public Pair(T first, K second)
    {
        _first = first;
        _second = second;

    }

    public T First { get { return _first; } }
    public K Second { get { return _second; } }

    #region IEqualityComparer<Pair<T,K>> Members

    public bool Equals(Pair<T, K> x, Pair<T, K> y)
    {
        return x.GetHashCode(x) == y.GetHashCode(y);
    }

    public int GetHashCode(Pair<T, K> obj)
    {
        int hashCode = obj.First == null ? 0 : obj._first.GetHashCode();

        hashCode ^= obj.Second == null ? 0 : obj._second.GetHashCode();

        return hashCode;
    }

    #endregion

    public override int GetHashCode()
    {
        return this.GetHashCode(this);
    }

    public override bool Equals(object obj)
    {
        return (obj != null) && 
    (obj is Pair<T, K>) && 
    this.Equals(this, (Pair<T, K>) obj);
    }
} 
```

问题是 First 和 Second 可能不是引用类型（VS 实际上警告我这一点），但代码仍然可以编译。我应该在比较它们之前将它们（第一和第二）转换为对象，还是有更好的方法来做到这一点？

编辑：请注意，我*希望*这个结构支持值和引用类型（换句话说，按类约束不是有效的解决方案）

编辑2：至于我想要实现的目标，我希望它可以在字典中工作。其次，SRP 现在对我来说并不重要，因为这并不是这个问题的真正本质——它总是可以在以后重构。第三，与 default(T) 比较不能代替与 null 比较 - 试试看。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-23T12:56:43.737

您的 IEqualityComparer 实现应该是一个不同的类（并且绝对不是一个结构，因为您想重用引用）。

此外，您的哈希码永远不应被缓存，因为结构的默认 GetHashcode 实现（您不会覆盖）将考虑该成员。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T13:03:05.093

如果您在比较方法中使用哈希码，如果哈希码相同，则应检查“真实值”。

```
bool result = ( x._hashCode == y._hashCode );
if ( result ) { result = ( x._first == y._first && x._second == y._second ); }
// OR?: if ( result ) { result = object.Equals( x._first, y._first ) && object.Equals( x._second, y._second ); }
// OR?: if ( result ) { result = object.ReferenceEquals( x._first, y._first ) && object.Equals( x._second, y._second ); }
return result; 
```

但是比较“_first”和“_second”字段存在一点问题。默认情况下，引用类型使用前相等比较“object.ReferenceEquals”方法，他们可以覆盖它们。因此，正确的解决方案取决于您的比较方法“究竟应该做什么”。应该使用“_first”和“_second”字段的“Equals”方法，还是 object.ReferenceEquals ？或者更复杂的东西？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T15:14:47.803

看起来您需要 IEquatable 代替：

```
internal struct Pair<T, K> : IEquatable<Pair<T, K>>
{
  private readonly T _first;
  private readonly K _second;

  public Pair(T first, K second)
  {
    _first = first;
    _second = second;
  }

  public T First
  {
    get { return _first; }
  }

  public K Second
  {
    get { return _second; }
  }

  public bool Equals(Pair<T, K> obj)
  {
    return Equals(obj._first, _first) && Equals(obj._second, _second);
  }

  public override bool Equals(object obj)
  {
    return obj is Pair<T, K> && Equals((Pair<T, K>) obj);
  }

  public override int GetHashCode()
  {
    unchecked
    {
      return (_first != null ? _first.GetHashCode() * 397 : 0) ^ (_second != null ? _second.GetHashCode() : 0);
    }
  }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T12:57:40.537

关于警告，您可以使用 default(T) 和 default(K) 而不是 null。

我看不到您要实现的目标，但是您不应该使用哈希码来比较相等性-不能保证两个不同的对象不会具有相同的哈希码。此外，即使您的结构是不可变的，成员 _first 和 _second 也不是。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T12:58:33.513

首先，这段代码违反了 SRP 原则。Pair 类用于保存物品，对吧？将相等性比较功能委托给它是不正确的。

接下来让我们看看你的代码：

如果参数之一为空，Equals 方法将失败 - 不好。Equals 使用了 Pair 类的哈希码，但是看一下 GetHashCode 的定义，它只是对成员哈希码的组合——它与项目的相等性无关。我希望 Equals 方法将比较实际数据。不幸的是，我现在太忙了，无法提供正确的实施。但是乍一看，您的代码似乎是错误的。如果您向我们提供您想要实现的目标的描述会更好。我相信 SO 成员将能够给你一些建议。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T12:59:52.467

我可以建议使用 Lambda 表达式作为参数吗？这将允许您指定如何比较内部泛型类型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T13:01:39.090

编译时我没有收到任何警告，但我假设您正在谈论 == null 比较？演员似乎会让这一切变得更干净，是的。

PS。你真的应该为比较器使用一个单独的类。填补两个角色（作为一对和比较对）的这个类非常难看。

# java - Web 服务和 RMI 在纯 Java 环境中的优缺点是什么？

> ID：120791
> 
> 赞同：11
> 
> 时间：2008-09-23T12:52:04.137
> 
> 标签：java, web-services, remoting, rmi

在开发分布式应用程序时，都是由同一家公司用 Java 编写的，您会选择 Web Services 还是 RMI？在性能、松散耦合、易用性等方面的优缺点是什么……？有人会选择WS吗？你能用 RMI 构建一个面向服务的架构吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-23T13:04:56.417

我会试着这样想：

您是否要在彼此之下运行独立的服务，并且这些服务可能会在未来某个时候被非 Java 应用程序访问？然后去网络服务。

您是否只想将应用程序的一部分（注意单数）分布在多个服务器上？然后选择 RMI，您不必离开 Java 世界就能让一切紧密耦合在一起工作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-23T13:24:03.280

我会选择WS。

*   WS/RMI 不太可能成为您的瓶颈。
*   为什么在未来对其他可能的技术关闭大门？
*   如果客户端/服务器上的类版本不同步，RMI 可能会出现问题。

而且...我很可能会选择 REST 服务。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T18:28:57.760

如果你不需要它（与非 Java 互操作），而你可能不需要，RMI 会更好；更少的代码，更少的配置，更少的带宽开销。

如果你害怕你会需要它，一个选择是使用 EJB3；它使用 RMI，非常易于设置和部署，但如果需要，还允许您轻松地将调用转换为 Web 服务。

无论你做什么，都**不要**创造你自己的东西；坚持一个标准。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T13:42:58.383

我的选择是：

标准 java 序列化 - 优点：恕我直言，性能最高，易于实现（我使用 Spring 将本地接口公开为远程接口）；缺点：序列化在不同的 jvm 版本之间不起作用

二进制序列化（例如来自 jetty 的 hessian） - 优点：与 java 序列化的性能相同，并且可以在不同的 jvm 版本之间工作

WS：只有在不同平台 java + .net 之间需要互操作时才需要，否则就太有分量了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T16:57:40.227

RMI 是一种很好的快速开发传输，但我建议不要在生产环境中使用它。序列化兼容性问题会使事情变得尴尬，您必须非常仔细地协调您的部署。

WebServices 是低效的，是的，但只是通过它的硬件。或者，使用普通的、轻量级的 XML-over-HTTP，而不是全脂 SOAP/WSDL。

# java - 如何设置 JVM 使用的代理

> ID：120797
> 
> 赞同：344
> 
> 时间：2008-09-23T12:53:25.913
> 
> 标签：java, proxy, jvm

很多时候，Java 应用程序需要连接到 Internet。最常见的示例发生在读取 XML 文件并需要下载其模式时。

我在代理服务器后面。如何设置我的 JVM 以使用代理？

* * *

## 回答 #1

> 赞同：382
> 
> 时间：2008-09-23T12:54:23.010

从 Java 文档（*不是*javadoc API）：

[http://download.oracle.com/javase/6/docs/technotes/guides/net/proxies.html](http://download.oracle.com/javase/6/docs/technotes/guides/net/proxies.html)

设置 JVM 标志`http.proxyHost`以及`http.proxyPort`在命令行上启动 JVM 时。这通常在 shell 脚本（在 Unix 中）或 bat 文件（在 Windows 中）中完成。这是 Unix shell 脚本的示例：

```
JAVA_FLAGS=-Dhttp.proxyHost=10.0.0.100 -Dhttp.proxyPort=8800
java ${JAVA_FLAGS} ... 
```

在使用 JBoss 或 WebLogic 等容器时，我的解决方案是编辑供应商提供的启动脚本。

许多开发人员都熟悉 Java API (javadocs)，但很多时候文档的其余部分被忽略了。它包含很多有趣的信息：http: [//download.oracle.com/javase/6/docs/technotes/guides/](http://download.oracle.com/javase/6/docs/technotes/guides/)

* * *

**更新：**如果您不想使用代理来解析某些本地/内网主机，请查看@Tomalak 的评论：

> 也不要忘记 http.nonProxyHosts 属性！

```
-Dhttp.nonProxyHosts="localhost|127.0.0.1|10.*.*.*|*.foo.com‌​|etc" 
```

* * *

## 回答 #2

> 赞同：122
> 
> 时间：2012-07-17T17:13:27.123

要使用系统代理设置：

```
java -Djava.net.useSystemProxies=true ... 
```

或以编程方式：

```
System.setProperty("java.net.useSystemProxies", "true"); 
```

来源：[http ://docs.oracle.com/javase/7/docs/api/java/net/doc-files/net-properties.html](http://docs.oracle.com/javase/7/docs/api/java/net/doc-files/net-properties.html)

* * *

## 回答 #3

> 赞同：88
> 
> 时间：2008-09-26T00:50:42.753

以编程方式设置 HTTP/HTTPS 和/或 SOCKS 代理：

```
...

public void setProxy() {
    if (isUseHTTPProxy()) {
        // HTTP/HTTPS Proxy
        System.setProperty("http.proxyHost", getHTTPHost());
        System.setProperty("http.proxyPort", getHTTPPort());
        System.setProperty("https.proxyHost", getHTTPHost());
        System.setProperty("https.proxyPort", getHTTPPort());
        if (isUseHTTPAuth()) {
            String encoded = new String(Base64.encodeBase64((getHTTPUsername() + ":" + getHTTPPassword()).getBytes()));
            con.setRequestProperty("Proxy-Authorization", "Basic " + encoded);
            Authenticator.setDefault(new ProxyAuth(getHTTPUsername(), getHTTPPassword()));
        }
    }
    if (isUseSOCKSProxy()) {
        // SOCKS Proxy
        System.setProperty("socksProxyHost", getSOCKSHost());
        System.setProperty("socksProxyPort", getSOCKSPort());
        if (isUseSOCKSAuth()) {
            System.setProperty("java.net.socks.username", getSOCKSUsername());
            System.setProperty("java.net.socks.password", getSOCKSPassword());
            Authenticator.setDefault(new ProxyAuth(getSOCKSUsername(), getSOCKSPassword()));
        }
    }
}

...

public class ProxyAuth extends Authenticator {
    private PasswordAuthentication auth;

    private ProxyAuth(String user, String password) {
        auth = new PasswordAuthentication(user, password == null ? new char[]{} : password.toCharArray());
    }

    protected PasswordAuthentication getPasswordAuthentication() {
        return auth;
    }
}

... 
```

请记住，HTTP 代理和 SOCKS 代理在网络堆栈中的不同级别运行，因此您可以使用其中一个或两个或两者。

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2008-09-23T12:57:48.257

您可以通过以下方式以编程方式设置这些标志：

```
if (needsProxy()) {
    System.setProperty("http.proxyHost",getProxyHost());
    System.setProperty("http.proxyPort",getProxyPort());
} else {
    System.setProperty("http.proxyHost","");
    System.setProperty("http.proxyPort","");
} 
```

只需从方法`needsProxy()`中返回正确的值`getProxyHost()`，`getProxyPort()`您就可以随时调用此代码片段。

* * *

## 回答 #5

> 赞同：26
> 
> 时间：2015-01-13T09:49:26.803

JVM 使用代理进行 HTTP 调用

```
System.getProperties().put("http.proxyHost", "someProxyURL");
System.getProperties().put("http.proxyPort", "someProxyPort"); 
```

这可能会使用用户设置代理

```
System.setProperty("java.net.useSystemProxies", "true"); 
```

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2017-07-12T14:12:28.360

结合 Sorter 和 javabrett/Leonel 的答案：

```
java -Dhttp.proxyHost=10.10.10.10 -Dhttp.proxyPort=8080 -Dhttp.proxyUser=username -Dhttp.proxyPassword=password -jar myJar.jar 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-09-23T17:48:36.453

您可以将有关代理服务器的一些属性设置为 jvm 参数

-Dhttp.proxyPort=8080、proxyHost等

但是如果您需要通过身份验证代理，则需要像以下示例一样的身份验证器：

**ProxyAuthenticator.java**

```
import java.net.*;
import java.io.*;

public class ProxyAuthenticator extends Authenticator {

    private String userName, password;

    protected PasswordAuthentication getPasswordAuthentication() {
        return new PasswordAuthentication(userName, password.toCharArray());
    }

    public ProxyAuthenticator(String userName, String password) {
        this.userName = userName;
        this.password = password;
    }
} 
```

**Example.java**

```
 import java.net.Authenticator;
    import ProxyAuthenticator;

public class Example {

    public static void main(String[] args) {
        String username = System.getProperty("proxy.authentication.username");
        String password = System.getProperty("proxy.authentication.password");

                if (username != null && !username.equals("")) {
            Authenticator.setDefault(new ProxyAuthenticator(username, password));
        }

                // here your JVM will be authenticated

    }
} 
```

基于此回复： http: [//mail-archives.apache.org/mod_mbox/jakarta-jmeter-user/200208.mbox/%3C494FD350388AD511A9DD00025530F33102F1DC2C@MMSX006%3E](http://mail-archives.apache.org/mod_mbox/jakarta-jmeter-user/200208.mbox/%3C494FD350388AD511A9DD00025530F33102F1DC2C@MMSX006%3E)

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2015-09-10T21:25:27.140

将[`java.net.useSystemProxies`](https://docs.oracle.com/javase/8/docs/api/java/net/doc-files/net-properties.html)属性设置为`true`。例如，您可以通过[JAVA_TOOL_OPTIONS](https://docs.oracle.com/javase/8/docs/technotes/guides/troubleshoot/envvars002.html)环境变量来设置它。例如，在 Ubuntu 中，您可以将以下行添加到`.bashrc`：

> 导出 JAVA_TOOL_OPTIONS+="-Djava.net.useSystemProxies=true"

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2017-01-25T21:47:21.317

下面展示了如何在 Java中从命令行使用**代理用户和代理密码设置代理，这是一种非常常见的情况。**首先，您不应该在代码中保存密码和主机。

使用 -D 在命令行中传递系统属性并使用 System.setProperty("name", "value") 在代码中设置它们是等效的。

**但请注意这一点**

有效的例子：

```
C:\temp>java -Dhttps.proxyHost=host -Dhttps.proxyPort=port -Dhttps.proxyUser=user -Dhttps.proxyPassword="password" -Djavax.net.ssl.trustStore=c:/cacerts -Djavax.net.ssl.trustStorePassword=changeit com.andreas.JavaNetHttpConnection 
```

但以下**不起作用**：

```
C:\temp>java com.andreas.JavaNetHttpConnection -Dhttps.proxyHost=host -Dhttps.proxyPort=port -Dhttps=proxyUser=user -Dhttps.proxyPassword="password" -Djavax.net.ssl.trustStore=c:/cacerts -Djavax.net.ssl.trustStorePassword=changeit 
```

唯一不同的是系统属性的位置！（课前和课后）

如果您的密码中有特殊字符，您可以将其放在引号“@MyPass123%”中，如上例所示。

如果您访问 HTTPS 服务，则必须使用`https.proxyHost`等`https.proxyPort`。

如果访问 HTTP 服务，则必须使用`http.proxyHost`等`http.proxyPort`。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2008-09-23T17:09:09.167

> 读取 XML 文件并需要下载其架构

如果您指望通过 Internet 检索模式或 DTD，那么您正在构建一个缓慢、健谈、脆弱的应用程序。当托管文件的远程服务器发生计划内或计划外停机时会发生什么？您的应用程序中断。那样可以么？

请参阅[http://xml.apache.org/commons/components/resolver/resolver-article.html#s.catalog.files](http://xml.apache.org/commons/components/resolver/resolver-article.html#s.catalog.files)

架构等的 URL 最好被视为唯一标识符。不像请求实际远程访问该文件。在“XML 目录”上做一些谷歌搜索。XML 目录允许您在本地托管此类资源，从而解决缓慢、繁琐和脆弱的问题。

它基本上是远程内容的永久缓存副本。没关系，因为远程内容永远不会改变。如果有更新，它将位于不同的 URL。通过互联网实际检索资源特别愚蠢。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2012-09-06T07:37:07.523

我也在防火墙后面，这对我有用！

```
System.setProperty("http.proxyHost", "proxy host addr");
System.setProperty("http.proxyPort", "808");
Authenticator.setDefault(new Authenticator() {
    protected PasswordAuthentication getPasswordAuthentication() {

        return new PasswordAuthentication("domain\\user","password".toCharArray());
    }
});

URL url = new URL("http://www.google.com/");
URLConnection con = url.openConnection();

BufferedReader in = new BufferedReader(new InputStreamReader(
                    con.getInputStream()));

// Read it ...
String inputLine;
while ((inputLine = in.readLine()) != null)
    System.out.println(inputLine);

in.close(); 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2017-11-30T22:02:05.543

如果您想要“Socks 代理”，请通知“socksProxyHost”和“socksProxyPort”VM 参数。

例如

```
java -DsocksProxyHost=127.0.0.1 -DsocksProxyPort=8080 org.example.Main 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2012-10-21T06:17:29.793

在连接到代理后面的 URL 之前添加它。

```
System.getProperties().put("http.proxyHost", "someProxyURL");
System.getProperties().put("http.proxyPort", "someProxyPort");
System.getProperties().put("http.proxyUser", "someUserName");
System.getProperties().put("http.proxyPassword", "somePassword"); 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2015-10-01T22:34:41.707

这是一个小更新，但从 Java 7 开始，代理连接现在可以通过编程而不是通过系统属性来创建。如果出现以下情况，这可能很有用：

1.  代理需要在程序运行时动态旋转
2.  需要使用多个并行代理
3.  或者只是让你的代码更干净:)

这是 groovy 中的一个人为示例：

```
// proxy configuration read from file resource under "proxyFileName"
String proxyFileName = "proxy.txt"
String proxyPort = "1234"
String url = "http://www.promised.land"
File testProxyFile = new File(proxyFileName)
URLConnection connection

if (!testProxyFile.exists()) {

    logger.debug "proxyFileName doesn't exist.  Bypassing connection via proxy."
    connection = url.toURL().openConnection()

} else {
    String proxyAddress = testProxyFile.text
    connection = url.toURL().openConnection(new Proxy(Proxy.Type.HTTP, new InetSocketAddress(proxyAddress, proxyPort)))
}

try {
    connection.connect()
}
catch (Exception e) {
    logger.error e.printStackTrace()
} 
```

完整参考： [http ://docs.oracle.com/javase/7/docs/technotes/guides/net/proxies.html](http://docs.oracle.com/javase/7/docs/technotes/guides/net/proxies.html)

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2010-03-09T14:18:11.493

最近我发现了允许 JVM 使用浏览器代理设置的方法。您需要做的是添加`${java.home}/lib/deploy.jar`到您的项目并初始化库，如下所示：

```
import com.sun.deploy.net.proxy.DeployProxySelector;
import com.sun.deploy.services.PlatformType;
import com.sun.deploy.services.ServiceManager;

import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;

public abstract class ExtendedProxyManager {

    private static final Log logger = LogFactory.getLog(ExtendedProxyManager.class);

    /**
     * After calling this method, proxy settings can be magically retrieved from default browser settings.
     */
    public static boolean init() {
        logger.debug("Init started");

        // Initialization code was taken from com.sun.deploy.ClientContainer:
        ServiceManager
                .setService(System.getProperty("os.name").toLowerCase().indexOf("windows") != -1 ? PlatformType.STANDALONE_TIGER_WIN32
                        : PlatformType.STANDALONE_TIGER_UNIX);

        try {
            // This will call ProxySelector.setDefault():
            DeployProxySelector.reset();
        } catch (Throwable throwable) {
            logger.error("Unable to initialize extended dynamic browser proxy settings support.", throwable);

            return false;
        }

        return true;
    }
} 
```

之后，代理设置可通过`java.net.ProxySelector`.

这种方法的唯一问题是您需要`deploy.jar`在 bootclasspath 中启动 JVM，例如`java -Xbootclasspath/a:"%JAVA_HOME%\jre\lib\deploy.jar" -jar my.jar`. 如果有人知道如何克服这个限制，请告诉我。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2014-07-03T10:43:23.393

这对我行得通：

```
public void setHttpProxy(boolean isNeedProxy) {
    if (isNeedProxy) {
        System.setProperty("http.proxyHost", getProxyHost());
        System.setProperty("http.proxyPort", getProxyPort());
    } else {
        System.clearProperty("http.proxyHost");
        System.clearProperty("http.proxyPort");
    }
} 
```

P/S：我基于 GHad 的回答。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2012-12-20T07:22:49.040

正如其他答案中指出的那样，如果您需要使用经过身份验证的代理，则没有可靠的方法来纯粹使用命令行变量来做到这一点 - 如果您使用的是其他人的应用程序并且不想弄乱源代码。

[Will Iverson](https://stackoverflow.com/users/311440/will-iverson)在[Using HttpProxy to connect to a host with preemtive authentication](https://stackoverflow.com/questions/5678000/using-httpproxy-to-connect-to-a-host-with-preemtive-authentication)中提出了有用的建议，以使用Proxifier 等代理管理工具（ Mac OS X 和 Windows 为[http://www.proxifier.com/](http://www.proxifier.com/)）来处理这个问题。

例如，使用 Proxifier，您可以将其设置为仅拦截要通过其（经过身份验证的）代理管理和重定向的 java 命令。不过，在这种情况下，您需要将 proxyHost 和 proxyPort 值设置为空白，例如传入`-Dhttp.proxyHost= -Dhttp.proxyPort=`您的 java 命令。

* * *

## 回答 #18

> 赞同：-1
> 
> 时间：2010-02-23T19:46:31.803

如果您在独立的 JVM 中，您可以使用 http.proxy* JVM 变量，但您不应该修改它们的启动脚本和/或在您的应用程序服务器中执行此操作（可能除了 jboss 或 tomcat）。相反，您应该使用 JAVA 代理 API（而不是 System.setProperty）或使用供应商自己的配置选项。WebSphere 和 WebLogic 都有非常明确的方法来设置比 J2SE 强大得多的代理。此外，对于 WebSphere 和 WebLogic，您可能会通过覆盖启动脚本（特别是服务器的互操作进程，因为您可能会告诉他们也使用您的代理...）来破坏您的应用程序服务器。

* * *

## 回答 #19

> 赞同：-5
> 
> 时间：2011-11-03T20:48:10.087

我认为配置[WINHTTP](http://www.deconf.com/en/networking/windows-update-using-proxy/)也可以。

包括 Windows 更新在内的许多程序都存在代理问题。通过设置WINHTTP总会解决这类问题

# windows-xp - 学习 FreeBSD

> ID：120803
> 
> 赞同：3
> 
> 时间：2008-09-23T12:54:28.250
> 
> 标签：windows-xp, freebsd

一个完全新手（其背景主要是 Windows XP）阅读 FreeBSD 手册并获得足够的掌握以从头开始设置服务器所需的平均时间是多少？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T13:03:43.423

这是不可能的。它不仅高度依赖于你是什么样的人，而且还依赖于你到底在做什么以及你如何定义“足够的掌握”。能够让 Apache 运行很简单，只需按照分步教程进行操作，您可以在几个小时内完成。*能够胜任*地运行多用户服务器需要更长的时间，而且手册还远远不够。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-23T12:58:59.283

这取决于您对unix的了解程度，并且从事物的声音来看，您可能没有很多知识。

假设您对 unix 知之甚少，我会说可能需要几天时间才能掌握正在发生的事情，并且可能需要一周的时间才能完成工作。

不过，FreeBSD 手册非常详细，并且确实为您提供了使事情正常工作所需做的一切的良好基础。

我知道这听起来很耗时，但根据我的经验，它们确实是完全不同的操作系统范例。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T13:23:04.297

您可以从[PC BSD](http://www.pcbsd.org/)（一种易于使用的发行版）开始了解 BSD，然后转向更高级的东西，例如设置服务器。

正如其他人所指出的，配置一个服务来做几件事并不难，你只需要遵循一些步骤（任何猴子都可以做），但如果你想要更多，你需要额外的时间。一个称职的系统管理员不仅知道**怎么**做，还知道**为什么**。奶奶可以在 Windows 中整天点击，即使 Windows Server 有用于服务器管理的 GUI，但这并不意味着她可以配置 IIS 或 DHCP 服务。**顺便说一句，如果你能学习一个（Unix）编辑器，最好是vi** ，那将是一件好事，因为它是 BSD 的标准；emacs、joe、pico 也不错，但它们并不那么受欢迎。

至于时间，我大概花了两天时间来配置一个服务器。但我以前有过 Linux 经验，而且服务器没有做任何花哨的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-26T07:31:08.830

看看如果你从未接触过 Unix 平台，你应该学到很多东西，基本上是不同的哲学。FreeBSD 手册和社区简直太棒了，但是像 FBSD 手册这样的参考书包含许多您必须自己开发的信息。

此外，BSD 平台并不是 Unix 家族中最容易从零开始的平台。

学习的好资源：

*   绝对的 BSD 书籍。
*   完整的 BSD 书（这是针对第 5 版的，它也适合学习）。
*   手册页。BSD 手册页比 Linux 手册页好很多。
*   FreeBSD 手册。
*   FreeBSD 论坛：forums.freebsd.org 和 daemonforums。
*   您可以使用的任何 Unix/Linux 资源。许多东西是兼容的（或接近兼容的）。例如，如果你的朋友告诉你“我找到了一个旧的 SGI IRIX / HPUX 或（在此处插入 unix）手册，我将把它扔进 thrashcan”，停止它，看看你能从中学到什么。

请记住，您还有很长的路要走。但你会喜欢的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T13:00:19.577

取决于您的阅读速度:-) 取决于您的需求（我的意思是：什么样的服务器）。曾几何时，我这样做了——在 x86 上安装 FreeBSD——（虽然当时我已经掌握了一些 Linux 知识），我花了 3 个小时，主要是这么多时间，因为我在另一台机器上并行工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T13:04:21.783

取决于您的背景：您是否曾经使用过 power shell 或其他命令行“应用程序”（如批处理；-）。对我来说，从完全 GUI 的操作系统切换到最适合使用 shell 的操作系统（有点像 DOS 提示符）是最大的挑战之一。但是一旦你掌握了窍门，你就会再次好起来的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T13:12:41.950

另一方面是您正在设置的计算机旁边的第二台计算机的可用性。如果您可以在安装过程中进行网络搜索以获取更多信息，则可以节省大量时间。

至于最初的主题，我已经广泛使用 Linux 和 Unix，但经过多年的几次尝试，还没有让 FreeBSD 工作。在我完全安装并配置它以获得漂亮的图形桌面之前，我总是会感到沮丧。（所以个性显然很重要。）但是我已经尝试了大约两年了，现在可能很简单......

请不要认为这是针对 FreeBSD 的火焰......只是一个真实的故事，由于某种原因我似乎无法让它工作。如果它不是一个好的操作系统，我不会尝试这么多次。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-08-16T14:30:53.163

如果您主要来自 Windows 背景，我认为 FreeBSD 将是深入了解 UNIX 的好方法，但您可能还想查看 Ubuntu Linux——特别是 Ubuntu Server。

家里有备用的基于 Pentium 4 的系统？给自己刻录一张 CD，然后去看看。

作为一个 FreeBSD 的粉丝，我必须支持上面的“Absolute FreeBSD”一书的推荐——另一本值得一看的书是[“Building a Server with FreeBSD 7”。](http://nostarch.com/freebsdserver.htm)

我最初选择 FreeBSD 的理由是更好地控制安装的内容——我真的厌倦了安装 RedHat 和/或 SuSE 并且安装了一些我不打算使用的东西作为基本安装的一部分事后不容易删除。我越来越迷恋 BSD 的做事方式，但它并不一定适合所有人。

需要考虑的事情——如果你有硬件，运行 VMWare 或 VirtualBox，并设置一些虚拟机以适应各种发行版，然后再承诺在裸硬件上安装特定的发行版。

# javascript - Array.slice 和 Array().slice 的区别

> ID：120804
> 
> 赞同：27
> 
> 时间：2008-09-23T12:54:41.823
> 
> 标签：javascript, arrays

我正在阅读 John Resig 出色的[高级 javascript 教程](http://ejohn.org/apps/learn/#47)，但我并不完全理解以下调用之间的区别：（请注意，“参数”是一个内置的 javascript 单词，并不完全是一个数组，因此使用 Array.slice 进行黑客攻击而不是简单地调用 arguments.slice)

```
>>> arguments  
[3, 1, 2, 3]  
>>> Array.slice.call( arguments )  
3,1,2,3 0=3 1=1 2=2 3=3  
>>> Array.slice.call( arguments, 1 )  
[]
>>> Array().slice.call( arguments )  
3,1,2,3 0=3 1=1 2=2 3=3  
>>> Array().slice.call( arguments, 1 )  
1,2,3 0=1 1=2 2=3 
```

基本上我的误解归结为 Array.slice 和 Array().slice 之间的区别。这两者之间究竟有什么区别，为什么 Array.slice.call 的行为不符合预期？（这是返回参数列表中除第一个元素之外的所有元素）。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-09-23T14:22:51.487

不完全的。

观察调用 String.substring.call("foo", 1) 和 String().substring.call("foo", 2) 时会发生什么：

```
>>> String.substring.call("foo", 1)
"1"

>>> String().substring.call("foo", 1)
"oo" 
```

Array.slice*既没有*正确引用附加到 Array 原型的 slice 函数，也没有正确引用附加到任何实例化 Array 实例（例如 Array() 或 []）的 slice 函数。

Array.slice 甚至根本不为空的事实是对象（/函数/构造函数）本身的错误实现。 **尝试在 IE 中运行等效代码，您将收到 Array.slice 为 null 的错误**。

这就是 Array.slice 行为不正确的原因（String.substring 也不正确）。

证明（根据 slice() 的定义，以下是人们不应该期待的事情......就像上面的 substring() 一样）：

```
>>> Array.slice.call([1,2], [3,4])
3,4 
```

现在，如果您在实例化对象*或*Array 原型上正确调用 slice()，您将得到您所期望的：

```
>>> Array.prototype.slice.call([4,5], 1)
[5]
>>> Array().slice.call([4,5], 1)
[5] 
```

更多证据...

```
>>> Array.prototype.slice == Array().slice
true
>>> Array.slice == Array().slice
false 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-23T13:39:18.330

Array 只是一个函数，尽管它是一个特殊的函数（用于初始化数组）。Array.slice 是对 Array 原型中 slice() 函数的引用。它只能在数组对象上调用，而不能在构造函数（即数组）本身上调用。Array 似乎表现得特别，因为 Array() 返回一个空数组。这似乎不适用于非内置构造函数（你必须使用新的）。所以

```
Array().slice.call 
```

是相同的

```
[].slice.call 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-11-28T20:22:08.053

由于未提供上下文参数，因此在提供的示例中对 slice.call() 的任何调用如何工作？slice 是否实现了它自己的 call 方法，从而覆盖了 JavaScript 的 call 方法？call 和 apply 方法将对象作为第一个参数，以指定要应用于调用的上下文 (this) 对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T13:51:37.723

我相信*Array*是类型，而*Array()*是构造函数。

在[FireBug](http://getfirebug.com/)中胡闹：

```
>>> Array === Array()
false

>>> Array.constructor
Function()

>>> Array().constructor
Array() 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-23T13:42:46.560

好，

查看[http://www.devguru.com/Technologies/ecmascript/quickref/slice.html](http://www.devguru.com/Technologies/ecmascript/quickref/slice.html)

Array().slice 是数组类中的函数（构造函数），不能作为数据成员使用。如果您不想使用“（）”，则需要在数组上调用它。即 - arguments.slice(1)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-23T13:43:31.673

我的猜测是 Array 是一个原型，而 Array() 是一个实际的数组对象。根据 JavaScript 解释，直接调用内置对象类型的原型方法可能有效，也可能无效。我不相信规范说它必须工作，只是在实例化对象上调用它是有效的。

# resources - 从 MIDP 2.0 midlet 中读取自定义资源

> ID：120836
> 
> 赞同：1
> 
> 时间：2008-09-23T13:01:46.767
> 
> 标签：resources, midp

如何使用 MIDP 2.0 从 .jar 中的 /res 加载自定义（不是图像，也不是声音文件）资源文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T13:33:35.833

我正在使用 MIDP 2.1，但我希望这也在 2.0 中。

Class.getResource(path_to_resource) 应该为您提供文件的 InputStream。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-03T20:37:15.043

```
getResourceAsStream("/res/yourresource"); 
```

# wpf - 如何创建 WPF 圆角容器？

> ID：120851
> 
> 赞同：125
> 
> 时间：2008-09-23T13:04:12.923
> 
> 标签：wpf, rounded-corners

我们正在创建一个 XBAP 应用程序，我们需要在单个页面的不同位置有圆角，并且我们希望有一个 WPF 圆角容器来放置一堆其他元素。有没有人对我们如何最好地实现这一点有一些建议或示例代码？使用样式还是创建自定义控件？

* * *

## 回答 #1

> 赞同：284
> 
> 时间：2008-09-23T13:13:11.043

您不需要自定义控件，只需将容器放在边框元素中：

```
<Border BorderBrush="#FF000000" BorderThickness="1" CornerRadius="8">
   <Grid/>
</Border> 
```

您可以`<Grid/>`用任何布局容器替换...

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2008-10-16T19:36:21.757

我知道这不是最初问题的答案……但您经常想要剪切刚刚创建的圆角边框的内部内容。

Chris Cavanagh 想出了一个[很好的方法](http://chriscavanagh.wordpress.com/2008/10/03/wpf-easy-rounded-corners-for-anything/)来做到这一点。

我已经尝试了几种不同的方法......我认为这个很摇滚。

这是下面的xaml：

```
<Page
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Background="Black"
>
    <!-- Rounded yellow border -->
    <Border
        HorizontalAlignment="Center"
        VerticalAlignment="Center"
        BorderBrush="Yellow"
        BorderThickness="3"
        CornerRadius="10"
        Padding="2"
    >
        <Grid>
            <!-- Rounded mask (stretches to fill Grid) -->
            <Border
                Name="mask"
                Background="White"
                CornerRadius="7"
            />

            <!-- Main content container -->
            <StackPanel>
                <!-- Use a VisualBrush of 'mask' as the opacity mask -->
                <StackPanel.OpacityMask>
                    <VisualBrush Visual="{Binding ElementName=mask}"/>
                </StackPanel.OpacityMask>

                <!-- Any content -->
                <Image Source="http://chriscavanagh.files.wordpress.com/2006/12/chriss-blog-banner.jpg"/>
                <Rectangle
                    Height="50"
                    Fill="Red"/>
                <Rectangle
                    Height="50"
                    Fill="White"/>
                <Rectangle
                    Height="50"
                    Fill="Blue"/>
            </StackPanel>
        </Grid>
    </Border>
</Page> 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2011-08-04T16:56:24.580

我只需要自己做，所以我想我会在这里发布另一个答案。

这是另一种创建圆角边框*并剪裁其内部内容的*方法。这是使用 Clip 属性的直接方法。如果您想避免使用 VisualBrush，那就太好了。

xml:

```
<Border
    Width="200"
    Height="25"
    CornerRadius="11"
    Background="#FF919194"
>
    <Border.Clip>
        <RectangleGeometry
            RadiusX="{Binding CornerRadius.TopLeft, RelativeSource={RelativeSource AncestorType={x:Type Border}}}"
            RadiusY="{Binding RadiusX, RelativeSource={RelativeSource Self}}"
        >
            <RectangleGeometry.Rect>
                <MultiBinding
                    Converter="{StaticResource widthAndHeightToRectConverter}"
                >
                    <Binding
                        Path="ActualWidth"
                        RelativeSource="{RelativeSource AncestorType={x:Type Border}}"
                    />
                    <Binding
                        Path="ActualHeight"
                        RelativeSource="{RelativeSource AncestorType={x:Type Border}}"
                    />
                </MultiBinding>
            </RectangleGeometry.Rect>
        </RectangleGeometry>
    </Border.Clip>

    <Rectangle
        Width="100"
        Height="100"
        Fill="Blue"
        HorizontalAlignment="Left"
        VerticalAlignment="Center"
    />
</Border> 
```

转换器的代码：

```
public class WidthAndHeightToRectConverter : IMultiValueConverter
{
    public object Convert(object[] values, Type targetType, object parameter, CultureInfo culture)
    {
        double width = (double)values[0];
        double height = (double)values[1];
        return new Rect(0, 0, width, height);
    }
    public object[] ConvertBack(object value, Type[] targetTypes, object parameter, System.Globalization.CultureInfo culture)
    {
        throw new NotImplementedException();
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-08-22T18:27:49.557

kobusb 的边界控制解决方案的基于 VB.Net 代码的实现。我用它来填充 Button 控件的 ListBox。Button 控件是从 MEF 扩展中创建的。每个扩展都使用 MEF 的 ExportMetaData 属性作为扩展的描述。扩展是 VisiFire 图表对象。用户按下从按钮列表中选择的按钮来执行所需的图表。

```
 ' Create a ListBox of Buttons, one button for each MEF charting component. 
    For Each c As Lazy(Of ICharts, IDictionary(Of String, Object)) In ext.ChartDescriptions
        Dim brdr As New Border
        brdr.BorderBrush = Brushes.Black
        brdr.BorderThickness = New Thickness(2, 2, 2, 2)
        brdr.CornerRadius = New CornerRadius(8, 8, 8, 8)
        Dim btn As New Button
        AddHandler btn.Click, AddressOf GenericButtonClick
        brdr.Child = btn
        brdr.Background = btn.Background
        btn.Margin = brdr.BorderThickness
        btn.Width = ChartsLBx.ActualWidth - 22
        btn.BorderThickness = New Thickness(0, 0, 0, 0)
        btn.Height = 22
        btn.Content = c.Metadata("Description")
        btn.Tag = c
        btn.ToolTip = "Push button to see " & c.Metadata("Description").ToString & " chart"
        Dim lbi As New ListBoxItem
        lbi.Content = brdr
        ChartsLBx.Items.Add(lbi)
    Next

Public Event Click As RoutedEventHandler

Private Sub GenericButtonClick(sender As Object, e As RoutedEventArgs)
    Dim btn As Button = DirectCast(sender, Button)
    Dim c As Lazy(Of ICharts, IDictionary(Of String, Object)) = DirectCast(btn.Tag, Lazy(Of ICharts, IDictionary(Of String, Object)))
    Dim w As Window = DirectCast(c.Value, Window)
    Dim cc As ICharts = DirectCast(c.Value, ICharts)
    c.Value.CreateChart()
    w.Show()
End Sub

<System.ComponentModel.Composition.Export(GetType(ICharts))> _
<System.ComponentModel.Composition.ExportMetadata("Description", "Data vs. Time")> _
Public Class DataTimeChart
    Implements ICharts

    Public Sub CreateChart() Implements ICharts.CreateChart
    End Sub
End Class

Public Interface ICharts
    Sub CreateChart()
End Interface

Public Class Extensibility
    Public Sub New()
        Dim catalog As New AggregateCatalog()

        catalog.Catalogs.Add(New AssemblyCatalog(GetType(Extensibility).Assembly))

        'Create the CompositionContainer with the parts in the catalog
        ChartContainer = New CompositionContainer(catalog)

        Try
            ChartContainer.ComposeParts(Me)
        Catch ex As Exception
            Console.WriteLine(ex.ToString)
        End Try
    End Sub

    ' must use Lazy otherwise instantiation of Window will hold open app. Otherwise must specify Shutdown Mode of "Shutdown on Main Window".
    <ImportMany()> _
    Public Property ChartDescriptions As IEnumerable(Of Lazy(Of ICharts, IDictionary(Of String, Object)))

End Class 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-05T20:07:51.877

如果您尝试将按钮放在圆角矩形边框中，您应该查看[msdn 的示例](http://msdn.microsoft.com/en-us/library/bb613545.aspx)。我通过谷歌搜索问题的图像（而不是文本）发现了这一点。它们庞大的外部矩形（谢天谢地）很容易移除。

请注意，您必须重新定义按钮的行为（因为您已更改 ControlTemplate）。也就是说，您需要使用 ControlTemplate.Triggers 标记中的触发器标记 (Property="IsPressed" Value="true") 定义单击按钮时的行为。希望这可以节省别人我失去的时间:)

# javascript - 你能阅读来自 flash 的 POST 请求的回复正文吗？

> ID：120854
> 
> 赞同：2
> 
> 时间：2008-09-23T13:04:44.340
> 
> 标签：javascript, flash

我正在尝试将文件发布到服务器，该服务器在正文中回复一些基本状态信息。使用 javascript 一切都很简单，但我想知道是否可以使用 flash 从回复中读取状态信息。这样我就可以使用 flash 提供的多文件选择器并一次发送多个文件。

顺便说一句，它可以与 PUT 一起使用吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T13:14:06.813

**从您的应用程序中获取信息（单向信息流）**

使用 getURL 函数，您可以使用指定方法的表单。

```
getURL (url, window, method) 
```

论据：

*   url 应该是您想要获取数据的脚本的 url。
*   窗口应该是自定义命名窗口，或四个预设之一，“_blank”、“_parent”、“_self”或“_top”
*   方法应该是“GET”或“POST”

使用 POST 方法时，当前影片剪辑时间线变量作为 HTTP POST 请求标头之后的单独数据块发送到脚本（与使用 POST 方法的常规 HTML 表单完全相同）。

您需要在播放器上安装 Flash 6 或更高版本才能使其正常工作。

例子：

```
getURL("http://example.org/myscript.pl", "_top", "POST"); 
```

**从脚本中获取信息（双向信息流）**

如果您想从脚本中将信息返回到 Flash 应用程序，您可以使用带有类似参数的 loadVariables，唯一的区别是第二个参数，它是要加载到的变量的目标。

即将变量加载到主电影时间线。

```
loadVariables ("http://example.org/myscript.pl", "_root", "POST"); 
```

# delphi - 在运行时移除和替换可视化组件

> ID：120858
> 
> 赞同：7
> 
> 时间：2008-09-23T13:05:28.630
> 
> 标签：delphi, vcl

例如，是否可以用在运行时（有条件地）实例化的子类组件替换和释放 TEdit？如果是这样，应该如何以及何时完成？我试图将父级设置为 nil 并在表单构造函数和 AfterConstruction 方法中调用 free() 但在这两种情况下我都遇到了运行时错误。

* * *

更具体地说，我收到了访问冲突错误 (EAccessViolation)。弗朗索瓦似乎是对的，他说在框架构造中释放组件会与表单控件管理混淆。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-23T13:44:11.500

您必须调用 TEdit 父级的 RemoveControl 才能删除控件。使用 InsertControl 添加新控件。

```
var Edit2: TEdit;
begin
  Edit2 := TEdit.Create(self);
  Edit2.Left := Edit1.Left;
  Edit2.Top := Edit2.Top;
  Edit1.Parent.Insertcontrol(Edit2);
  TWinControl(Edit1.parent).RemoveControl(Edit1);
  Edit1.Free;
end; 
```

将 TEdit.Create 替换为您要使用的类，并复制您需要的所有属性，就像我对 Left 和 Top 所做的那样。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-23T18:40:32.957

这个更通用的例程可以与 Form 或 Frame 一起使用（更新为使用新控件的子类）：

```
function ReplaceControlEx(AControl: TControl; const AControlClass: TControlClass; const ANewName: string; const IsFreed : Boolean = True): TControl;
begin
  if AControl = nil then
  begin
    Result := nil;
    Exit;
  end;
  Result := AControlClass.Create(AControl.Owner);
  CloneProperties(AControl, Result);// copy all properties to new control
  // Result.Left := AControl.Left;   // or copy some properties manually...
  // Result.Top := AControl.Top;
  Result.Name := ANewName;
  Result.Parent := AControl.Parent; // needed for the InsertControl & RemoveControl magic
  if IsFreed then
    FreeAndNil(AControl);
end;

function ReplaceControl(AControl: TControl; const ANewName: string; const IsFreed : Boolean = True): TControl;
begin
  if AControl = nil then
    Result := nil
  else
    Result := ReplaceControlEx(AControl, TControlClass(AControl.ClassType), ANewName, IsFreed);
end; 
```

使用此例程将属性传递给新控件

```
procedure CloneProperties(const Source: TControl; const Dest: TControl);
var
  ms: TMemoryStream;
  OldName: string;
begin
  OldName := Source.Name;
  Source.Name := ''; // needed to avoid Name collision
  try
    ms := TMemoryStream.Create;
    try
      ms.WriteComponent(Source);
      ms.Position := 0;
      ms.ReadComponent(Dest);
    finally
      ms.Free;
    end;
  finally
    Source.Name := OldName;
  end;
end; 
```

像这样使用它：

```
procedure TFrame1.AfterConstruction;
var
  I: Integer;
  NewEdit: TMyEdit;
begin
  inherited;
  NewEdit := ReplaceControlEx(Edit1, TMyEdit, 'Edit2') as TMyEdit;
  if Assigned(NewEdit) then
  begin
    NewEdit.Text := 'My Brand New Edit';
    NewEdit.Author := 'Myself';
  end;
  for I:=0 to ControlCount-1 do
  begin
    ShowMessage(Controls[I].Name);
  end;
end; 
```

**注意**：如果您在 Frame 的 AfterConstruction 中执行此操作，请注意托管表单构建尚未完成。
在那里释放控件可能会导致很多问题，因为您正在搞乱表单控件的内务管理。
如果您尝试阅读新的 Edit Caption 以显示在 ShowMessage 中，请查看您会得到什么...
在这种情况下，您会想要使用
...ReplaceControl(Edit1, 'Edit2', **False** )
然后执行
...FreeAndNil （编辑1）
稍后。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T18:17:24.543

您实际上可以使用 RTTI（查看 TypInfo 单元）来克隆所有匹配的属性。前段时间我为此编写了代码，但现在找不到了。我会继续寻找。

# flash - 导出用于 PDF 报告的 Flash 图表和图形 - 自动化

> ID：120862
> 
> 赞同：0
> 
> 时间：2008-09-23T13:06:23.480
> 
> 标签：flash, automation, charts, pdf-generation, graph

我想将漂亮的图表放在可通过 html 和 pdf 获得的报告中。

我宁愿只使用一个 API，并且所有处理都发生在服务器端。

我想在 html 版本的报告中嵌入 Flash 图表。我想在 pdf 版本中嵌入静态图像（最好是基于矢量的格式）。

**实现这一目标的最佳方法是什么？**

我见过一个名为[Swiff Chart Generator](http://www.globfx.com/products/swfchartgen/ "Swiff 图表生成器")的产品，但它的图表交互性很弱。我还看过[amcharts](http://www.amcharts.com/)，它的交互性很强，但在 pdf 输出上很弱。

我可能会使用[princexml](http://www.princexml.com/)来处理整个pdf 生成。Princexml 不呈现嵌入式闪存。它确实渲染嵌入的图像和 SVG。另一种选择是[飞碟](http://code.google.com/p/flying-saucer//)，它功能较少但免费。

[Corda](http://www.corda.com) - 他们制作支持一定程度交互性的绘图和绘图软件。它们支持开箱即用的 SVG、PNG 和 flash 格式。当然，它们非常昂贵。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T16:27:54.617

看看[AlivePDF](http://www.alivepdf.org/)。我相信它可以做你需要的。他们有一个演示，您可以在其中导出和下载刚刚绘制的 swf 的 pdf，非常酷。

或者，这里是同一个人的[Jpeg Exporter](http://www.bytearray.org/?p=90)。

**编辑：**还可以看看[Degrafa](http://www.degrafa.com/)在 Flex 中的图表。非常好，而且底层代码实际上正在被折叠到 Adob​​e 的下一个版本中！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T14:07:33.363

8 年前，我使用[Visual Engineering](http://ve.com)的 java 库做了类似的事情。看起来他们的产品已经改变了，但有人在[网上有他们的旧演示](http://weather.nmsu.edu/java/JavaChartbak/)。

它作为 HTML 输出的小程序效果很好，我编写了一些简单的 java 类来编写一个 .png 以嵌入服务器上的 pdf 文件中。奇怪的是，它都是从 PHP 调用的，但很好地挂在一起。

Java 是一个不错的选择，因为它必须在带有 IE 前端的 Sun 和 Linux 服务器上工作。不幸的是，这不是 Flash，也不是基于矢量的。我会寻找像 swf2jpg 或 swf2png 这样的工具。

但是，如果服务器端闪存没有其他选项，您可能需要考虑使用 Java 小程序/应用程序组合。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-05T09:50:11.097

您可以使用 FusionCharts

它允许您在 HTML 页面中嵌入 Flash 图表，并且可以轻松地将其导出为图像/PDF，您可以将它们嵌入到您的 PDF 报告中。

可能对您有帮助的相同演示：[http ://www.fusioncharts.com/Demos/ExportChart/](http://www.fusioncharts.com/Demos/ExportChart/)

希望这可以帮助：）

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-23T13:37:48.567

您可以使用 ActionScript 直接从 Flash 中获取图表的位图数据。不幸的是，我不相信有办法导出矢量数据。

# file - 如何以自己的文件格式获取文件以拥有自己的动态图标？

> ID：120865
> 
> 赞同：10
> 
> 时间：2008-09-23T13:06:57.783
> 
> 标签：file, icons, opendocument

我们的应用程序具有类似于 OpenDocument 文件格式的文件格式（请参阅[http://en.wikipedia.org/wiki/OpenDocument](http://en.wikipedia.org/wiki/OpenDocument)） - 即使用清单文件、缩略图等进行压缩。

我注意到 OpenOffice 文件在 Windows 和 Linux 中都有一个 Open Office 文件的预览图像作为它们的图标。有什么方法可以为我们的文件实现这一点：即我想要一个基于内部 thumbnail.png 的动态图标？

**编辑 1**哇，感谢所有快速回答。[Thumbnailer](http://library.gnome.org/devel/integration-guide/stable/thumbnailer.html.en)看起来非常适合 GNOME 世界。Windows 我将研究这些链接，谢谢。至于评论问题：以编程方式或通过我们的安装程序。

**编辑 2**哦，忘了 Mac。在 Mac 上怎么样？（对不起 Mac 爱好者！）还有关于 OpenOffice 如何处理他们的 IconHandler 东西的任何链接或信息 - 因为我们的会非常相似？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-23T13:27:22.663

## 视窗

您需要的是一个[图标处理](http://msdn.microsoft.com/en-us/library/bb776857(VS.85).aspx)程序，也称为缩略图处理程序。这是一个编写为[活动 x 控件](http://www.shellplus.com/examples/thumbnail-image-handler-example.html)的示例。

另一个资源是查找[Property Handlers](http://blogs.msdn.com/benkaras/archive/2007/01/21/what-do-property-handlers-accomplish.aspx)，它还应该指向您在 windows 中正确处理动态元数据的最新和最好的方法。

这些是*动态*解决方案 - 如果您只想要一个与所有文件关联的图标，则不需要它们 - 它们仅在您希望 Windows 资源管理器根据文件中的内容显示图标时使用，而不仅仅是扩展名，并且当文件更改 图标会更新以反映更改。它也不必是文件本身的图像，缩略图处理程序可以根据文件内容生成任何图像。

属性处理程序更新其他元数据，例如歌曲或视频长度，因此您可以使用 Windows 资源管理器支持的所有元数据。

关于 MAC 支持，[此页面](http://blogs.adobe.com/indesignchannel/2007/10/thumbnail_icons.html)说：“Mac 和 Windows 操作系统启用此类缩略图的方法不同，而在 Mac OS 的情况下，此支持因版本而异，因此未进行追求[对于 Adob​​e InDesign]。”

## 操作系统

Mac OSX 的图标由[Launch Services Database](http://developer.apple.com/documentation/Carbon/Conceptual/LaunchServicesConcepts/LSCConcepts/chapter_2_section_4.html)确定。但是，它指的是由已注册应用程序处理的所有文件的静态图标文件（它不是基于扩展名 - 每个文件都有附加的元数据，这些元数据决定了它所属的应用程序，尽管当元数据没有时扩展名会给出提示存在，例如从不同的操作系统或文件系统获取文件）

看起来 OSX 中的动态图标功能是由 Finder 提供的，但是搜索并没有在这个方向上提供任何简单的指针。由于Finder随着时间的推移不断变化，我明白为什么这个目标很难达到......

## 侏儒

对于 Gnome，您使用[缩略图](http://library.gnome.org/devel/integration-guide/stable/thumbnailer.html.en)。（感[谢多沃德](https://stackoverflow.com/questions/120865/how-do-i-get-files-in-my-own-file-format-to-have-its-own-dynamic-icon#120887)）

这是您编写的一个非常简单的程序，它有 3 个命令行参数：

*   输入文件名，您使用缩略图描述的文件（或 URI，如果您接受这些文件）
*   输出文件名，您需要在其中写入PNG
*   size，一个数字，以像素为单位，描述您应该生成的最大方形图像大小（128 --> 128x128 或更小）

我希望所有系统都这么简单。另一方面，这不支持动画和其他一些由更难在其他系统上实现的插件提供的功能。

## KDE

我有点不确定，但有一些建议可以帮助您入门。首先是 Konqueror 是文件管理器并显示图标 - 它支持某些内置类型的动态图标，但我不知道这些是硬编码的，还是您可以编写的插件。查看[嵌入式组件教程](http://konqueror.kde.org/componentstutorial/)作为起点。

有一个新的（ish？）功能（或计划中的功能......）称为 Plasma，它与图标和图标功能有很大关系。查看[此公告](http://liquidat.wordpress.com/2007/06/20/kde-4-news-plasma-icons-solid-information-and-taskbar-mockups/)和[此初始实施](http://blog.ruphy.org/?p=11)。

您可能需要深入研究 Konqueror 的源代码，并查看他们是如何对文本文件和其他已经实现的文件执行此操作的。

-亚当

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-11-25T09:15:46.573

# Mac OSX 从 10.5 版开始……</h1>

…有两种方法：

1.  **您的文档采用标准 OSX 捆绑格式并具有静态图像** 这可以通过创建子文件夹 QuickLook 并将 Thumbnail/Preview.png/tiff/jpg 放入其中来完成。

2.  **其他一切都**需要一个 QuickLook 生成器插件，该插件可以存储在 /Library/QuickLook ~/Library/QuickLook 或 YourApp.app/Contents/Library/QuickLook 文件夹中。

该生成器用于动态创建缩略图和 QuickLook 预览。XCode 为此提供了一个模板。该模板生成需要实现的**ANSI C**文件。如果要编写**Object-C**代码，则必须重命名 GenerateThumbnailForURL。**c**和 GeneratePreviewForURL。**c**到 GenerateThumbnailForURL。**m**和 GeneratePreviewForURL。**m**（并仔细阅读 Apple 开发文档；））

* * *

## 简单的基于 zip 容器的演示：

您必须在 GenerateThumbnailForURL.c 中将 Cocoa.framework 和 Foundation.framework 添加到您的项目中（这部分是我的想法 - 所以不能保证它可以开箱即用；））：

```
#include <Cocoa/Cocoa.h>
#include <Foundation/Foundation.h>

OSStatus GenerateThumbnailForURL(void *thisInterface, QLThumbnailRequestRef thumbnail, CFURLRef url, CFStringRef contentTypeUTI, CFDictionaryRef options, CGSize maxSize)
{
  NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];

  /* unzip the thumbnail and put it into an NSData object */
  // Create temporary path and writing handle for extraction
  NSString *tmpPath = [NSTemporaryDirectory() stringByAppendingFormat: [NSString stringWithFormat: @"%.0f.%@" , [NSDate timeIntervalSinceReferenceDate] * 1000.0, @"png"]];
  [[NSFileManager defaultManager] createFileAtPath: tmpPath contents: [NSData alloc] attributes:nil];
  NSFileHandle *writingHandle = [NSFileHandle fileHandleForWritingAtPath: tmpPath];

  // Use task to unzip - create command: /usr/bin/unzip -p <pathToFile> <fileToExtract>
  NSTask *unzipTask = [[NSTask alloc] init];
  [unzipTask setLaunchPath: @"/usr/bin/unzip"];

  // -p -> output to StandardOut, added File to extract, nil to terminate Array
  [unzipTask setArguments: [NSArray arrayWithObjects: @"-p", [(NSURL *) url path], @"Thumbnails/thumbnail.png", nil]];

  // redirect standardOut to writingHandle
  [unzipTask setStandardOutput: writingHandle];

  // Unzip - run task
  [unzipTask launch];
  [unzipTask waitUntilExit];

  // Read Image Data and remove File
  NSData *thumbnailData = [NSData dataWithContentsOfFile: tmpPath];
  [[NSFileManager defaultManager] removeFileAtPath: tmpPath handler:nil];

  if ( thumbnailData == nil || [thumbnailData length] == 0 ) {
     // Nothing Found. Don't care.
     [pool release];
     return noErr;
  }

  // That is the Size our image should have - create a dictionary too
  CGSize size = CGSizeMake(256, 256);
  NSDictionary *properties = [NSDictionary dictionaryWithObjectsAndKeys:
      [NSNumber numberWithInt:size.width],kQLPreviewPropertyWidthKey,
      [NSNumber numberWithInt:size.height],kQLPreviewPropertyHeightKey,
      nil];

  // Get CGContext for Thumbnail
  CGContextRef CGContext = QLThumbnailRequestCreateContext(thumbnail, size, TRUE, (CFDictionaryRef)properties);
  if(CGContext) {
     NSGraphicsContext* context = [NSGraphicsContext graphicsContextWithGraphicsPort:(void *)CGContext flipped:size.width > size.height];
     if(context) {
        //These two lines of code are just good safe programming…
       [NSGraphicsContext saveGraphicsState];
       [NSGraphicsContext setCurrentContext:context];

       NSBitmapImageRep *thumbnailBitmap = [NSBitmapImageRep imageRepWithData:thumbnailData];
       [thumbnailBitmap draw];

       //This line sets the context back to what it was when we're done
       [NSGraphicsContext restoreGraphicsState];
    }

    // When we are done with our drawing code QLThumbnailRequestFlushContext() is called to flush the context
    QLThumbnailRequestFlushContext(thumbnail, CGContext);

    // Release the CGContext
    CFRelease(CGContext);
  }

  [pool release];
  return noErr;
} 
```

* * *

## 信息列表

你也必须修改你的 info.plist 文件——当你打开它时，它有很多预先设置的字段。它们中的大多数都是不言自明的（或者不必更改），但我必须添加以下结构（复制粘贴应该做 - 复制文本，进入 plist 编辑器并粘贴。）：

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<array>
   <dict>
     <key>UTTypeConformsTo</key>
     <array>
       <string>com.pkware.zip-archive</string>
     </array>
     <key>UTTypeDescription</key>
     <string>i-net Crystal-Clear Report File</string>
     <key>UTTypeIconName</key>
     <string>generic</string>
     <key>UTTypeIdentifier</key>
     <string>com.company.product</string>
     <key>UTTypeReferenceURL</key>
     <string>http://your-url.com</string>
     <key>UTTypeTagSpecification</key>
     <dict>
       <key>public.filename-extension</key>
         <array>
           <string>$fileEXT$</string>
         </array>
     </dict>
  </dict>
</array>
</plist> 
```

这将注册您的文件类型 $fileExt$ 并告诉系统您的文件类型是 zipy 格式类型。一个很好的参考，我在这里使用的是[来自 googlecode 的 QuickLook IPA 插件](http://code.google.com/p/quicklook-ipa/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T13:21:20.027

在 Windows 中，您需要实现一个图标处理程序。我在很多个月前就做过这个，只要你了解 COM 的基础知识，这并不难。

请参阅：http: [//msdn.microsoft.com/en-us/library/bb776857 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/bb776857(VS.85).aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T13:12:16.100

对于 Gnome，您使用[缩略图](http://library.gnome.org/devel/integration-guide/stable/thumbnailer.html.en)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T13:11:33.093

据我所知，这取决于操作系统，它将基于文件扩展名。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T13:12:53.433

对于 WINDOWS 试试这个：

[http://www.easydesksoftware.com/news/news12.htm](http://www.easydesksoftware.com/news/news12.htm)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T13:13:19.033

可执行文件将文件内的图标（可能是多个）作为“资源”。

数据文件根据文件关联选择一个图标。

如果您想要每个文件都有一个自定义图标，那就更难了。您要么需要让操作系统误以为它是可执行文件并将图标作为资源嵌入文件中，要么需要深度链接到操作系统以覆盖默认的图标选择例程。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T13:14:25.020

我认为，“自定义自己的”图标在 Windows 中只能有 PE 文件。文件扩展名的所有其他图标都存储在 Windows 注册表中。

有关 PE 文件的规范，您可以查看[Win32 Portable Executable File Format](http://msdn.microsoft.com/en-us/magazine/cc301805.aspx)和[Peering Inside the PE: A Tour of the Win32 Portable Executable File Format](http://msdn.microsoft.com/en-us/magazine/ms809762.aspx)。

它在其他操作系统中如何工作，我不知道：/。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-23T13:19:17.973

我不了解 Linux，但对于 Windows，您可以从这里开始：http: [//msdn.microsoft.com/en-us/library/bb774614.aspx](http://msdn.microsoft.com/en-us/library/bb774614.aspx)

**编辑：**我认为此界面适用于缩略图视图中显示的缩略图，而不是图标。很抱歉浪费您的时间。

# c++ - 调用基类构造函数的规则是什么？

> ID：120876
> 
> 赞同：780
> 
> 时间：2008-09-23T13:09:20.570
> 
> 标签：c++, inheritance, constructor

从派生类调用基类构造函数的 C++ 规则是什么？

例如，我知道在 Java 中，您必须将其作为子类构造函数的第一行（如果您不这样做，则假定隐式调用无参数超级构造函数 - 如果缺少，则会出现编译错误） .

* * *

## 回答 #1

> 赞同：1063
> 
> 时间：2008-09-23T13:18:34.853

如果它们没有参数，则会自动为您调用基类构造函数。如果要调用带参数的超类构造函数，则必须使用子类的构造函数初始化列表。与 Java 不同，C++ 支持多重继承（无论好坏），因此必须通过名称引用基类，而不是“super()”。

```
class SuperClass
{
    public:

        SuperClass(int foo)
        {
            // do something with foo
        }
};

class SubClass : public SuperClass
{
    public:

        SubClass(int foo, int bar)
        : SuperClass(foo)    // Call the superclass constructor in the subclass' initialization list.
        {
            // do something with bar
        }
}; 
```

[此处](http://www.cprogramming.com/tutorial/initialization-lists-c++.html)和[此处](http://www.parashift.com/c++-faq-lite/ctors.html#faq-10.6)有关构造函数初始化列表的更多信息。

* * *

## 回答 #2

> 赞同：265
> 
> 时间：2008-09-23T13:22:43.283

在 C++ 中，所有超类和成员变量的无参数构造函数都会在进入构造函数之前为您调用。如果你想向它们传递参数，有一个单独的语法称为“构造函数链接”，它看起来像这样：

```
class Sub : public Base
{
  Sub(int x, int y)
  : Base(x), member(y)
  {
  }
  Type member;
}; 
```

如果此时运行任何东西抛出，先前已完成构造的基/成员将调用其析构函数，并将异常重新抛出给调用者。如果要在链接期间捕获异常，则必须使用函数 try 块：

```
class Sub : public Base
{
  Sub(int x, int y)
  try : Base(x), member(y)
  {
    // function body goes here
  } catch(const ExceptionType &e) {
    throw kaboom();
  }
  Type member;
}; 
```

在这种形式中，请注意 try 块**是**函数体，而不是在函数体内部；这允许它捕获由隐式或显式成员和基类初始化以及函数体期间引发的异常。但是，如果函数 catch 块没有抛出不同的异常，则运行时将重新抛出原始错误；初始化期间的异常**不容**忽视。

* * *

## 回答 #3

> 赞同：60
> 
> 时间：2008-09-23T13:34:21.557

在 C++ 中有一个构造函数初始化列表的概念，您可以并且应该在其中调用基类的构造函数，并且还应该在其中初始化数据成员。初始化列表在冒号之后的构造函数签名之后，构造函数主体之前。假设我们有一个 A 类：

```
 class A : public B
{
public:
  A(int a, int b, int c);
private:
  int b_, c_;
}; 
```

然后，假设 B 有一个采用 int 的构造函数，A 的构造函数可能如下所示：

```
 A::A(int a, int b, int c) 
  : B(a), b_(b), c_(c) // initialization list
{
  // do something
} 
```

可以看到，在初始化列表中调用了基类的构造函数。顺便说一下，初始化初始化列表中的数据成员比在构造函数的主体内分配 b_ 和 c_ 的值更可取，因为您节省了额外的赋值成本。

请记住，数据成员始终按照它们在类定义中声明的顺序进行初始化，而不管它们在初始化列表中的顺序如何。为避免在数据成员相互依赖时可能出现的奇怪错误，您应始终确保初始化列表和类定义中成员的顺序相同。出于同样的原因，基类构造函数必须是初始化列表中的第一项。如果您完全省略它，则将自动调用基类的默认构造函数。在这种情况下，如果基类没有默认构造函数，则会出现编译器错误。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2014-01-27T22:04:46.883

每个人都提到了通过初始化列表调用构造函数，但没有人说可以从派生成员的构造函数体中显式调用父类的构造函数。请参阅问题 [Calling a constructor from a subclass' constructor body](https://stackoverflow.com/questions/21395395/calling-a-constructor-of-the-base-class-from-a-subclass-constructor-body/21395443?noredirect=1#21395443)， 例如。关键是，如果您在派生类的主体中使用对父类或超类构造函数的显式调用，这实际上只是创建父类的实例，而不是在派生对象上调用父类构造函数. 在派生类的对象上调用父类或超类构造函数的唯一方法是通过初始化列表，而不是在派生类构造函数体中。所以也许它不应该被称为“超类构造函数调用”。我把这个答案放在这里是因为有人可能会感到困惑（就像我一样）。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2008-09-23T13:19:57.940

如果您有一个没有参数的构造函数，它将在派生类构造函数执行之前被调用。

如果要使用参数调用基构造函数，则必须在派生构造函数中显式编写，如下所示：

```
class base
{
  public:
  base (int arg)
  {
  }
};

class derived : public base
{
  public:
  derived () : base (number)
  {
  }
}; 
```

如果不调用 C++ 中的父构造函数，就无法构造派生类。如果它是非 arg C'tor，则会自动发生这种情况，如果您如上所示直接调用派生构造函数，或者您的代码将无法编译，则会发生这种情况。

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2008-09-23T13:21:28.420

将值传递给父构造函数的唯一方法是通过初始化列表。初始化列表是用一个 : 实现的，然后是一个类列表和要传递给该类构造函数的值。

```
Class2::Class2(string id) : Class1(id) {
....
} 
```

还要记住，如果您有一个不带父类参数的构造函数，它将在子构造函数执行之前自动调用。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2014-07-15T18:49:38.850

如果您的基构造函数中有默认参数，则将自动调用基类。

```
using namespace std;

class Base
{
    public:
    Base(int a=1) : _a(a) {}

    protected:
    int _a;
};

class Derived : public Base
{
  public:
  Derived() {}

  void printit() { cout << _a << endl; }
};

int main()
{
   Derived d;
   d.printit();
   return 0;
} 
```

输出为：1

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2008-09-23T13:24:19.613

```
CDerived::CDerived()
: CBase(...), iCount(0)  //this is the initialisation list. You can initialise member variables here too. (e.g. iCount := 0)
    {
    //construct body
    } 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2014-03-12T10:46:04.183

当一个类派生自多个类时，没有人提到构造函数调用的顺序。在派生类时，序列如前所述。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-07-02T14:35:23.917

如果您只是想**将所有构造函数参数传递给基类**（=parent），这是一个最小的示例。

这使用模板将每个带有 1、2 或 3 个参数的构造函数调用转发给父类`std::string`。

**代码**

[现场版](https://techiedelight.com/compiler/?D2g2)

```
#include <iostream>
#include <string>

class ChildString: public std::string
{
    public:
        template<typename... Args>
        ChildString(Args... args): std::string(args...)
        {
            std::cout 
                << "\tConstructor call ChildString(nArgs="
                << sizeof...(Args) << "): " << *this
                << std::endl;
        }

};

int main()
{
    std::cout << "Check out:" << std::endl;
    std::cout << "\thttp://www.cplusplus.com/reference/string/string/string/" << std::endl;
    std::cout << "for available string constructors" << std::endl;

    std::cout << std::endl;
    std::cout << "Initialization:" << std::endl;
    ChildString cs1 ("copy (2)");

    char char_arr[] = "from c-string (4)";
    ChildString cs2 (char_arr);

    std::string str = "substring (3)";
    ChildString cs3 (str, 0, str.length());

    std::cout << std::endl;
    std::cout << "Usage:" << std::endl;
    std::cout << "\tcs1: " << cs1 << std::endl;
    std::cout << "\tcs2: " << cs2 << std::endl;
    std::cout << "\tcs3: " << cs3 << std::endl;

    return 0;
} 
```

**输出**

```
Check out:
    http://www.cplusplus.com/reference/string/string/string/
for available string constructors

Initialization:
    Constructor call ChildString(nArgs=1): copy (2)
    Constructor call ChildString(nArgs=1): from c-string (4)
    Constructor call ChildString(nArgs=3): substring (3)

Usage:
    cs1: copy (2)
    cs2: from c-string (4)
    cs3: substring (3) 
```

**更新：使用可变参数模板**

推广到 n 个参数并简化

```
 template <class C>
        ChildString(C arg): std::string(arg)
        {
            std::cout << "\tConstructor call ChildString(C arg): " << *this << std::endl;
        }
        template <class C1, class C2>
        ChildString(C1 arg1, C2 arg2): std::string(arg1, arg2)
        {
            std::cout << "\tConstructor call ChildString(C1 arg1, C2 arg2, C3 arg3): " << *this << std::endl;
        }
        template <class C1, class C2, class C3>
        ChildString(C1 arg1, C2 arg2, C3 arg3): std::string(arg1, arg2, arg3)
        {
            std::cout << "\tConstructor call ChildString(C1 arg1, C2 arg2, C3 arg3): " << *this << std::endl;
        } 
```

到

```
template<typename... Args>
        ChildString(Args... args): std::string(args...)
        {
            std::cout 
                << "\tConstructor call ChildString(nArgs="
                << sizeof...(Args) << "): " << *this
                << std::endl;
        } 
```

# python - Python成语链接（展平）有限迭代的无限迭代？

> ID：120886
> 
> 赞同：25
> 
> 时间：2008-09-23T13:11:43.887
> 
> 标签：python, iterator

假设我们有一个返回列表（或有限迭代器）的迭代器（无限迭代器），例如由

```
infinite = itertools.cycle([[1,2,3]]) 
```

什么是获得迭代器（显然是无限的）的好 Python 习惯用法，它将从第一个迭代器返回每个元素，然后从第二个迭代器返回每个元素，依此类推。在上面的示例中，它将返回`1,2,3,1,2,3,...`. 迭代器是无限的，所以`itertools.chain(*infinite)`不会工作。

### 有关的

*   [在python中展平一个浅表](https://stackoverflow.com/questions/406121/flattening-a-shallow-list-in-python)

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2008-09-23T13:17:03.033

从 Python 2.6 开始，您可以使用[`itertools.chain.from_iterable`](https://docs.python.org/library/itertools.html#itertools.chain.from_iterable)：

```
itertools.chain.from_iterable(iterables) 
```

您也可以使用嵌套生成器理解来执行此操作：

```
def flatten(iterables):
    return (elem for iterable in iterables for elem in iterable) 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-23T13:14:58.857

使用生成器：

```
(item for it in infinite for item in it) 
```

* 构造解包成一个元组以传递参数，因此无法使用它。

# java - 无根测试

> ID：120889
> 
> 赞同：31
> 
> 时间：2008-09-23T13:12:46.240
> 
> 标签：java, eclipse, junit, eclipse-3.4, ganymede

在 Eclipse（Eclipse 3.4 'Ganymede'）中运行我的所有测试时，“Unrooted Tests”下列出了一项测试。我正在使用 Junit 3.8，这个特定的测试扩展了 TestCase。我看不出这个测试和其他测试有什么区别。我不记得在 Eclipse 3.3 (Europa) 中看到过这种情况。

澄清：

我们还没有迁移到 JUnit 4.0，所以我们没有使用注解。我也用谷歌搜索，似乎大多数人都遇到了 JUnit 4 的问题，但我没有看到任何解决方案。在这一点上，测试在本地和 CruiseControl 中都通过了，所以我并不过分担心，但很好奇。

但是，当我第一次看到这个时，它是在一个失败的测试中，只有在与其他测试一起运行时才会失败。这使我陷入了寻找解决方案来解决我从未找到的“无根”问题的方法。最终，我在另一个没有正确拆除的测试中找到了罪魁祸首。

我同意，这似乎是一个 Eclipse 问题。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-29T17:46:06.103

最后我找到了解决方案。问题是您没有使用注释定义您的测试用例，而是仍在使用“旧方式”。一旦您转换为使用注释，您将能够再次运行一个测试。

这是一个使用注释的基本测试现在应该是什么样子的示例：

```
import static org.junit.Assert.*; // Notice the use of "static" here
import org.junit.Before;
import org.junit.Test;

public class MyTests { // Notice we don't extent TestCases anymore

  @Before
  public void setUp() { // Note: It is not required to call this setUp()
    // ...
  }

  @Test
  public void doSomeTest() { // Note: method need not be called "testXXX"
    // ...
    assertTrue(1 == 1);
  }
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2011-06-13T21:38:44.830

我也收到了“无根测试”错误消息，它神奇地消失了。我相信这是因为我将 Eclipse 与 Maven 项目一起使用。当我向我的 Test 类添加一个新方法并为其提供 @Test 注释时，当我尝试使用“Run as Junit test”菜单选项运行该方法时，它开始收到错误消息；但是，一旦我运行了一个 Maven 构建，无根测试消息就消失了，我相信这是未来问题的解决方案。

运行 maven 构建，因为它将刷新 JUnit 正在使用的类。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-11-12T04:40:37.800

如果您的类在其层次结构中的某处扩展了 TestCase，则必须使用运行配置下的下拉列表中列出的 JUnit 3 测试运行器。使用 JUnit 4 运行程序（我相信是默认运行程序）会导致发生无根测试现象。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-03-06T15:40:27.073

我收到此错误是因为我重命名了我的测试方法，然后尝试通过单击相同的运行配置在 Eclipse 中运行测试 - 指的是现在不存在的旧方法。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-08-22T14:07:31.800

我们通过确保构建了我们的测试项目来解决了这个问题。我们在构建路径中遇到问题，不允许编译我们的测试类。一旦我们解决了构建路径问题，测试编译并且“新”方法能够运行。所以我们可以假设“无根”测试也意味着它们不存在于编译的二进制文件中。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-23T13:42:15.157

我从未见过这种情况——但据我浏览 Google 几分钟可以看出，这似乎是 Eclipse 中的一个错误，而不是您的测试的问题。我假设您在测试中没有 @Test 注释？你能把测试吹走并重新创建它，如果是这样，你会得到同样的错误吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-06-27T06:27:27.990

导致此问题的另一种情况是我盲目地复制/粘贴**需要参数**的方法。IE

```
import org.junit.Test;

public class MyTest {

    @Test
    public void someMethod(String param) {
          // stuff
    }

} 
```

你有几个简单的解决方案：

1.  在具体的测试方法中定义变量

2.  将其作为实例变量添加到测试类

3.  创建一个设置方法并用`@Before`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-04-06T22:46:24.823

我遇到了这个问题，并在测试方法解决它之前放了一个“ **@Test** ”！

像这样：

`@Test public void testOne() { // ... assertTrue(1 == 1); }`

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2014-10-03T16:59:02.467

这是 Unrooted 错误出现的两种情况。

1.  如果你在测试之前错过了注解@Test。

    @测试

    公共无效 foo(){ }

2.  如果它是一个 Gwt 项目并且定义了同一对象的两个模拟。假设有一类 A 类和

    @GwtMock 私人 A 证明；

    @GwtMock 私人 A a; 然后这也将显示 Unrooted 测试错误。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-09-02T03:19:58.367

对我来说，这是由于项目遇到了构建路径问题。我的 Maven 依赖项配置需要更新。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-09-17T15:52:28.827

您可以尝试的另一件事是将您的 JUnit 版本至少升级到 4.12。

我在使用 @RunWith(Parameterized.class) 的扩展类时遇到了这个问题。

过了一会儿，很抱歉我不知道我究竟做了什么导致这个，“无根测试”消息消失了，但测试仍然没有正确运行。应该接受来自@Parameters 方法的参数的构造函数永远不会被调用；执行直接从@BeforeClass 跳转到@AfterClass。

解决该问题的方法是将 JUnit 从它使用的 4.8.1 升级到最新的 (4.12)。所以也许这可以在未来帮助其他人。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-09-29T07:24:30.520

我对 java.lang.NoClassDefFoundError: org/hamcrest/SelfDescribing 有同样的问题

你需要jar hamcrest。同样的问题 14539072: [java.lang.NoClassDefFoundError: org/hamcrest/SelfDescribeing](https://stackoverflow.com/questions/14539072/java-lang-noclassdeffounderror-org-hamcrest-selfdescribing)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-07-30T05:24:15.997

我收到此错误，测试方法名称为“test”

```
@Test 
public void test() {
 // ... assertTrue(1 == 1); 
} 
```

我重命名了方法并且它有效

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-11-11T10:00:58.380

原来是我的构建路径有一些错误......一些罐子丢失了。我重新配置了构建路径，它工作了！

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-01-14T12:13:03.870

`@BeforeClass`对我来说，问题是在or`@AfterClass`方法中引发了异常。这也将导致测试被归类为无根测试。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-07-14T07:12:47.050

我可以通过在单个测试方法的运行配置中从 TestRunner 版本 4.0 转换到 3 来解决这个问题。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-01-14T16:06:10.143

您正在使用 Hamcrest 吗？或其他图书馆来帮助你的测试？**你没有使用**

```
import static org.junit.Assert.*; 
```

检查您是否在测试中使用：

```
import static org.hamcrest.MatcherAssert.assertThat; 
```

或其他断言不是 JUnit 断言。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-10-09T19:51:49.113

不要使用 junit1.4 在您的测试类中扩展 junit.framework.TestCase ，这应该可以解决问题

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2015-05-21T19:12:44.843

我也没有将测试声明为`static`.

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-03-21T13:23:37.063

也许这只是对该方法目标的逻辑混乱。让我们记住：

例如正确的标记测试方法：

```
@Test
@Transactional
@Rollback(true)
public void testInsertCustomer() {  
    (...)
} 
```

- 使用 Eclipse Junit 插件，您可以在方法上使用上下文菜单运行该测试方法（例如，在包资源管理器中扩展类和方法并选择“testInsertCustomer()”方法并从该项目中选择“Run as >> JUnit test”） .

如果您忘记了“@Test”标签，或者只是该方法不是测试，而是用作其他测试的实用程序的（私有或非私有）通用方法（例如“私有 fillCustomerObject()”），那么该方法不会需要“@Test”标签，而且你不能将它作为 JUnit 测试运行！

很容易创建实用程序方法，但后来您忘记了该方法的真正目标，因此如果您尝试将其作为测试运行，JUnit 会喊“Unrooted Tests”。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2018-10-19T15:23:07.897

对我来说，这个问题是由方法中抛出的实时异常造成的`@AfterClass`（查看[这里](http://junit.sourceforge.net/javadoc/org/junit/AfterClass.html)的文档）：

基本上所有的测试方法都成功了，但在课程结束时，这个方法失败了。因此，所有测试似乎都很好，但在我的 Eclipse 上还有一个额外的“无根测试”失败了。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2020-04-20T11:21:56.793

我在一个 Maven 项目中遇到了这些错误。我用 mvn clean install 重建项目。问题解决了

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2020-08-20T19:56:11.767

它实际上告诉我有一个带有注释的测试：@RunWith(MockitoJUnitRunner.class)

# c# - 循环依赖

> ID：120898
> 
> 赞同：6
> 
> 时间：2008-09-23T13:13:33.417
> 
> 标签：c#, asp.net-mvc, dependencies

考虑一个使用 WinForms 的基于 MVC 模式的普通客户订单应用程序。视图部分增长太多（超过 4000 个文件），需要拆分成更小的文件。

* * *

对于这个例子，我们将使用 3 个项目作为视图部分：

*   **Main** - 依赖于其他 2 个项目。用列表实例化表单。
*   **客户**- 有 2 个表格 - 客户列表和客户详细信息。
*   **订单**- 有 2 个表格 - 订单列表和订单详情。

* * *

在客户详细信息表单上，还有该客户的订单列表。该列表是从 OrdersController 接收的，因此获取它没有问题。当用户选择一个订单时，列表将获取它的 guid 并将其作为参考传递给 Order Details 表单。

*这意味着我们需要在客户项目中引用订单项目。* **(1)**

但在订单详细信息表格上也有一个指向下订单的客户的链接。单击后，应打开“客户详细信息”表单。

*这意味着我们需要在订单项目中引用客户项目。* **(2)**

**从 (1) 和 (2) 开始，我们将在 Orders 和 Customers 项目之间建立循环依赖关系。**

* * *

**如何避免这种情况？**某种插件架构？该项目已经开发完成，最好的解决方案将涉及尽可能少的代码更改。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T13:23:01.037

将至少一种类型更改为接口。

例如，有一个 ICustomer 接口和一个实现此接口的 Customer 类型。现在将 ICustomer 添加到 orders 项目，并从 customers 项目中设置对 Orders 项目的引用，以便您可以实现接口。Order 类型现在可以在不知道实际实现的情况下针对 ICustomer 类型工作。

为了获得更好的解决方案:-) 创建一个 ICustomer 和一个 IOrder 接口并将它们添加到第三个库项目中。并从其他两个中引用这个项目，并且只使用接口，从不使用实现。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T13:20:21.527

如果它们紧密耦合，也许它们不应该被拆分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T13:22:13.160

提取接口并将它们放在单独的程序集中。由于您使用的是 MVC 架构，因此应该不难。查看 Microsoft 复合 UI 应用程序块以获取示例和良好实践。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T13:27:30.590

我认为您的主要问题不是您的应用程序的体系结构。您需要了解边界以及如何在它们之间划分功能。像您这样的划分是相当人为的，您尝试根据域对象拆分应用程序。尝试使用用户角色或功能主题来做到这一点，问题可能会消失。

从技术的角度来看，我不明白为什么你的观点应该意识到彼此的存在——这对我来说听起来有点奇怪。您不会拆分数据和业务逻辑，归根结底，GUID 只是您可以使用不同方法轻松传递的刺痛。

# oracle - 如何检查触发器是否无效？

> ID：120900
> 
> 赞同：7
> 
> 时间：2008-09-23T13:14:01.823
> 
> 标签：oracle, triggers

我正在研究具有由一些不起眼的工具自动生成的移动表的数据库。顺便说一句，我们必须通过一些触发器来跟踪表中的信息变化。当然，表结构中的某些更改会破坏某些触发器，例如删除列或更改其类型。

所以，问题是：有没有办法查询 Oracle 元数据以检查某些触发器是否损坏，以便向支持团队发送报告？

user_triggers 给出所有触发器并告诉它们是否启用，但不指示它们是否仍然有效。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-23T13:17:20.457

```
SELECT *
FROM   ALL_OBJECTS
WHERE  OBJECT_NAME = trigger_name
AND    OBJECT_TYPE = 'TRIGGER'
AND    STATUS <> 'VALID' 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T13:22:36.013

查看 SYS.OBJ$，特别是 STATUS 列。

# database - 设计一个“订单”模式，其中有不同的产品定义表

> ID：120907
> 
> 赞同：7
> 
> 时间：2008-09-23T13:16:43.360
> 
> 标签：database, database-design, entity-attribute-value

这是我多年来在多个地方看到的场景。我想知道是否有人遇到过比我更好的解决方案...

我的公司销售的产品数量相对较少，但我们销售的产品是高度专业化的（即，为了选择给定的产品，必须提供大量的详细信息）。问题在于，虽然选择给定产品所需的细节数量相对恒定，但*所需的细节**种类*在产品之间却有很大差异。例如：

产品 X 可能具有识别特征，例如（假设地）

*   '颜色'，
*   '材料'
*   “平均失败时间”

但产品 Y 可能具有特征

*   '厚度'，
*   '直径'
*   '能量源'

创建一个同时使用产品 X 和产品 Y 的订单系统的问题（其中之一）是订单行必须在某些时候引用它“销售”的内容。由于产品 X 和产品 Y 是在两个不同的表中定义的 - 并且使用宽表方案对产品进行非规范化不是一种选择（产品定义非常深） - 很难找到一种明确的方法来定义订单行订单输入、编辑和报告的实用性。

* * *

**我过去尝试过的事情**

*   创建一个名为“产品”的父表，其中包含产品 X 和产品 Y 共有的列，然后使用“产品”作为 OrderLine 表的引用，并在产品 X 的表之间创建一个以“产品”作为主要侧的 FK 关系和产品 Y。这基本上将“产品”表作为 OrderLine 和所有不同产品表（例如产品 X 和 Y）的父级。它适用于订单输入，但会导致订单报告或编辑出现问题，因为“产品”记录必须跟踪它是什么类型的产品，以确定如何将“产品”加入其更详细的子产品、产品 X 或产品Y.**优点**：保留了关键关系。 **缺点**：在订单行/产品级别进行报告、编辑。
*   在订单行级别创建“产品类型”和“产品密钥”列，然后使用一些 CASE 逻辑或视图来确定该行所指的定制产品。这类似于第 (1) 项，但没有通用的“产品”表。我认为它是一个更“快速和肮脏”的解决方案，因为它完全消除了订单行及其产品定义之间的外键。**优点**：快速解决。 **缺点**：同第（1）项，加上丢失RI。
*   通过创建一个通用标题表并使用自定义属性的键/值对（OrderLine [n] <- [1] Product [1] <- [n] ProductAttribute）来同质化产品定义。 **优点**：保留关键关系；产品定义没有歧义。 **缺点**：报告（例如，检索带有属性的产品列表）、属性值的数据类型、性能（获取产品属性、插入或更新产品属性等）

如果其他人尝试了不同的策略并取得了更大的成功，我肯定想听听。

谢谢你。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T18:26:21.743

如果您想保持数据完整性，并且您的产品类型相对较少且很少添加新产品类型，那么您描述的第一个解决方案是最好的。这是我在您的情况下选择的设计。仅当您的报告需要特定于产品的属性时，报告才是复杂的。如果您的报告只需要常见产品表中的属性，那很好。

您描述的第二种解决方案称为“多态关联”，它不好。您的“外键”不是真正的外键，因此您不能使用 DRI 约束来确保数据完整性。OO 多态性在关系模型中没有类似物。

您描述的第三个解决方案涉及将属性名称存储为字符串，是一种称为“实体-属性-值”的设计，您可以看出这是一个痛苦且昂贵的解决方案。无法确保数据完整性，无法使一个属性不为空，无法确保给定产品具有特定的一组属性。无法针对查找表限制一个属性。许多类型的聚合查询在 SQL 中变得不可能执行，因此您必须编写大量应用程序代码来执行报告。仅在必须时使用 EAV 设计，例如，如果您有无限数量的产品类型，每行的属性列表可能不同，并且您的架构必须经常适应新的产品类型，而无需更改代码或架构。

另一种解决方案是“单表继承”。这使用了一个非常宽的表，其中每个产品的每个属性都有一个列。在与给定行上的产品无关的列中保留 NULL。这实际上意味着您不能将属性声明为 NOT NULL（除非它在所有产品的通用组中）。此外，大多数 RDBMS 产品对单个表中的列数或行的总宽度（以字节为单位）都有限制。因此，您可以通过这种方式表示的产品类型数量有限。

存在混合解决方案，例如，您可以通常将通用属性存储在列中，但将产品特定属性存储在实体-属性-值表中。或者，您可以以某种其他结构化方式（如 XML 或 YAML）将产品特定属性存储在 Products 表的 BLOB 列中。但是这些混合解决方案受到影响，因为现在必须以不同的方式获取某些属性

这种情况的最终解决方案是使用语义数据模型，使用 RDF 而不是关系数据库。这与 EAV 有一些共同的特点，但它更加雄心勃勃。所有元数据都以与数据相同的方式存储，因此每个对象都是自描述的，您可以像查询数据一样查询给定产品的属性列表。存在特殊产品，例如[Jena](http://jena.sourceforge.net/)或[Sesame](http://www.openrdf.org/)，它们实现了这种数据模型和一种不同于 SQL 的特殊查询语言。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T13:37:42.903

这可能会让你开始。它需要一些改进

```
Table Product ( id PK, name, price, units_per_package)
Table Product_Attribs (id FK ref Product, AttribName, AttribValue) 
```

这将允许您将属性列表附加到产品。-- 这基本上是你的选择 3

如果你知道最大数量的属性，你可以去

```
Table Product (id PK, name, price, units_per_package, attrName_1, attrValue_1 ...) 
```

这当然会使数据库反规范化，但会使查询更容易。

我更喜欢第一个选项，因为

1.  它支持任意数量的属性。
2.  属性名称可以存储在另一个表中，并强制执行引用完整性，以便那些该死的加拿大人不会在其中粘贴“颜色”并破坏报告。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-23T18:44:05.163

没有你忽视的灵丹妙药。

你有什么有时被称为“不相交的子类”。有两个子类 (ProductX) 和 (ProductY) 的超类 (Product)。对于关系数据库来说，这是一个非常困难的问题。[另一个难题是物料清单。另一个难题是节点和弧的图。]

您确实需要多态性，其中 OrderLine 链接到 Product 的子类，但不知道（或关心）哪个特定子类。

您没有太多的建模选择。你几乎已经确定了每个的坏特性。这几乎是整个选择的世界。

1.  把所有东西都推到超类上。这就是单表方法，您可以使用带有鉴别器（type="X" 和 type="Y"）和一百万列的 Product。Product 的列是 ProductX 和 ProductY 中的列的并集。由于未使用的列，到处都会有空值。

2.  将所有内容下推到子类中。在这种情况下，您需要一个视图，它是 ProductX 和 ProductY 的联合视图。该视图是为创建完整订单而连接的。这就像第一个解决方案，除了它是动态构建的并且没有很好地优化。

3.  将超类实例连接到子类实例。在这种情况下，Product 表是 ProductX 和 ProductY 列的交集。每个产品都有一个对 ProductX 或 ProductY 中的键的引用。

确实没有一个大胆的新方向。在关系数据库的世界观中，这些是选择。

但是，如果您选择改变构建应用软件的方式，您就可以摆脱这个陷阱。如果应用程序是面向对象的，那么您可以使用一流的多态对象来做任何事情。您必须从那种笨拙的关系处理中进行映射；这种情况发生了两次：一次是从数据库中获取内容以创建对象，一次是您将对象持久化回数据库。

优点是您可以简洁准确地描述您的处理。作为对象，具有子类关系。

缺点是您的 SQL 会演变为简单的批量获取、更新和插入。

当 SQL 被隔离到 ORM 层并作为一种微不足道的实现细节进行管理时，这将成为一个优势。Java 程序员使用 iBatis（或 Hibernate 或 TopLink 或 Cocoon），Python 程序员使用 SQLAlchemy 或 SQLObject。ORM 进行数据库获取和保存；您的应用程序直接操作订单、行和产品。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T13:44:56.273

你的产品线有变化吗？
如果是这样，那么为每个产品创建一个表将花费您高昂的成本，而键/值对的想法将为您提供很好的服务。这就是我自然被吸引的那种方向。

我会创建这样的表：

```
Attribute(attribute_id, description, is_listed)    
-- contains values like "colour", "width", "power source", etc. 
-- "is_listed" tells us if we can get a list of valid values: 

AttributeValue(attribute_id, value)
-- lists of valid values for different attributes.  

Product (product_id, description)

ProductAttribute (product_id, attribute_id)  
-- tells us which attributes apply to which products

Order (order_id, etc)

OrderLine (order_id, order_line_id, product_id)

OrderLineProductAttributeValue (order_line_id, attribute_id, value)
-- tells us things like: order line 999 has "colour" of "blue" 
```

将其组合在一起的 SQL 并不是微不足道的，但也不是太复杂……而且大部分将被编写一次并保留（在存储过程或数据访问层中）。

我们对多种类型的实体做类似的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T14:01:54.330

克里斯和 AJ：感谢您的回复。产品线可能会发生变化，但我不会将其称为“易变”。

我不喜欢第三种选择的原因是它以产品属性值的元数据为代价。它本质上是把列变成行，在这个过程中失去了数据库列的大部分优势（数据类型、默认值、约束、外键关系等）

实际上，我曾经参与过一个以这种方式完成产品定义的项目。我们基本上创建了一个完整的产品/产品属性定义系统（数据类型、最小/最大出现次数、默认值、“必需”标志、使用场景等）。该系统最终正常工作，但在开销和性能方面付出了巨大的代价（例如，用于可视化产品的物化视图、用于表示和验证用于产品定义的数据输入 UI 的自定义“智能”组件、用于表示订单行上产品实例的可自定义属性的另一个“智能”组件，blahblahblah）。

再次感谢您的回复！

# excel - LabVIEW拥有Excel参考

> ID：120908
> 
> 赞同：0
> 
> 时间：2008-09-23T13:16:46.310
> 
> 标签：excel, reference, labview

我尝试在LabVIEW中打开和excel参考，然后在一段时间后关闭它。但是LabVIEW一直持有引用并且不会释放它，除非我关闭VI。为什么会这样？反正有没有强制它释放参考？

我正在检查错误是否有任何错误。但它没有抛出任何错误。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-23T13:47:30.777

您是否正在检查关闭文件命令的返回值？我过去曾遇到过 LV 的这个问题，并且发现这是导致此问题的一个可能的根本原因。

查看以下示例文件，看看您是否以同样的方式做事：

labview\examples\file\datalog.llb\Read Datalog File Example.vi

高温高压

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T15:49:17.330

你在 Excel 中做什么？

通常，Labview 将保持参考打开，直到它关闭。但是，这包括对 excel*任何*部分（excel.worksheet、excel.range、excel.workbook 等）的任何引用。您需要明确关闭每个引用。

调试可能很辛苦，但您需要手动浏览整个 excel 处理部分并确保每个引用都已关闭。

# c# - 在 WPF 中为整个应用程序设置皮肤的推荐方法是什么？

> ID：120914
> 
> 赞同：24
> 
> 时间：2008-09-23T13:18:13.387
> 
> 标签：c#, .net, wpf, templates, skinning

我希望我的 WPF 应用程序是可换肤的，通过应用某个 XAML 模板，并且更改是应用程序范围的，即使对于动态控件或甚至不在视觉/逻辑树中的控件也是如此。

我可以用什么来完成这种类型的功能？是否有任何好的资源或教程可以显示如何完成此特定任务？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T13:46:35.100

采取的基本方法是在整个应用程序中使用资源并在运行时动态替换资源。

有关基本方法，请参见[http://www.nablasoft.com/alkampfer/index.php/2008/05/22/simple-skinnable-and-theme-management-in-wpf-user-interface/](http://www.nablasoft.com/alkampfer/index.php/2008/05/22/simple-skinnable-and-theme-management-in-wpf-user-interface/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T13:53:37.610

替换资源会起作用，但我发现“结构蒙皮”更强大！在 CodeProject 上阅读有关它的更多信息...

[http://www.codeproject.com/KB/WPF/podder1.aspx](http://www.codeproject.com/KB/WPF/podder1.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-24T11:24:29.627

我找到了在不使用模板键的情况下将通用模板应用于所有控件的方法。解决方法是使用控件的类型作为 Style 键。

例子：

```
 <Application.Resources>
    <Style x:Key="{x:Type Button}" TargetType="{x:Type Button}">
        <Setter Property="Button.Background" Value="CornflowerBlue"/>
        <Setter Property="Button.Template">
            <Setter.Value>
                <ControlTemplate x:Name="MyTemplate">
                    ...
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</Application.Resources> 
```

这里的 Style 键是 x:Key="{x:Type Button}"，因此该样式将应用于所有 button 类型的控件，而无需控件将 Style 属性声明为静态或动态资源。

# sql-server - 在指定位置使用 T SQL 创建数据库

> ID：120917
> 
> 赞同：17
> 
> 时间：2008-09-23T13:19:16.600
> 
> 标签：sql-server, tsql

如何在指定位置使用 T SQL 脚本创建数据库？假设，我想在`D:\temp\dbFolder`. 这该怎么做？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-09-23T13:22:21.880

创建新数据库时，您指定位置。例如：

```
USE [master]
GO

    CREATE DATABASE [AdventureWorks] ON  PRIMARY 
    ( NAME = N'AdventureWorks_Data', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\Data\AdventureWorks_Data.mdf' , SIZE = 167872KB , MAXSIZE = UNLIMITED, FILEGROWTH = 16384KB )
     LOG ON 
    ( NAME = N'AdventureWorks_Log', FILENAME = N'C:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\Data\AdventureWorks_Log.ldf' , SIZE = 2048KB , MAXSIZE = 2048GB , FILEGROWTH = 16384KB )
    GO 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-23T13:23:05.357

在 SQL Server Books 中，一个明确定义数据库文件名的示例：

```
USE master
GO
CREATE DATABASE Sales
ON 
( NAME = Sales_dat,
   FILENAME = 'c:\program files\microsoft sql server\mssql\data\saledat.mdf',
   SIZE = 10,
   MAXSIZE = 50,
   FILEGROWTH = 5 )
LOG ON
( NAME = 'Sales_log',
   FILENAME = 'c:\program files\microsoft sql server\mssql\data\salelog.ldf',
   SIZE = 5MB,
   MAXSIZE = 25MB,
   FILEGROWTH = 5MB )
GO 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-07-14T18:53:21.217

1.  在文件系统上创建文件夹：D:\temp\dbFolder\
2.  运行脚本：

    ```
    USE master; 
    GO 
    CREATE DATABASE TestDB1  
    ON      ( NAME = Sales_dat, FILENAME = 'D:\temp\dbFolder\TestDB1.mdf') 
    LOG ON  ( NAME = Sales_log, FILENAME = 'D:\temp\dbFolder\TestDB1.ldf'); 
    GO 
    ```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-01-09T12:27:24.803

在 Studio Manager 中使用变量扩展了前面的示例。

创建文件夹和子文件夹。
示例：根文件夹 E:\MSSQL\DATA 子文件夹 E:\MSSQL\DATA\DB 和 E:\MSSQL\DATA\Logs。

```
MKDIR "E:\MSSQL\DATA\DB"
MKDIR "E:\MSSQL\DATA\Logs" 
```

将数据库名称 @DBNAME 变量 @Test_DB' 更改为您的 'DesiredName_DB'

根据上面创建的文件夹，将根文件夹路径 @DataPath 'E:\MSSQL\DATA' 更改为您的。

在 Studio Manager 中运行以下命令

```
DECLARE @DBNAME VARCHAR(MAX)
DECLARE @DataPath AS NVARCHAR(MAX)
DECLARE @sql VARCHAR(MAX)

SET @DBNAME = N'Test_DB'
SET @DataPath = N'E:\MSSQL\DATA'

SELECT @sql = 'USE MASTER'
EXEC (@sql)

SELECT @sql = 'CREATE DATABASE '+ quotename(@DBNAME) + ' 
ON 
PRIMARY
 ( 
 NAME = ''' + @DBNAME + '_DB'', 
 FILENAME = ''' + @DataPath + '\DB\' + @DBNAME + '.mdf'', 
 SIZE = 3136 KB , MAXSIZE = UNLIMITED, 
 FILEGROWTH = 1024 KB
 ) 
LOG ON
 (
 NAME = '''+ @DBNAME + '_Log'', 
 FILENAME = '''+ @DataPath + '\Logs\' + @DBNAME  + '_log.ldf'', 
 SIZE = 832KB , MAXSIZE =  2048 GB , FILEGROWTH = 10 %
 )'

EXEC (@sql) 
```

或上述主题的另一种变体。

```
DECLARE @DBNAME VARCHAR(MAX)
DECLARE @DataFilePath AS NVARCHAR(MAX)
DECLARE @LogFilePath AS NVARCHAR(MAX)
DECLARE @sql VARCHAR(MAX)

SET @DBNAME = N'Test_DB'
SET @DataFilePath = N'E:\MSSQL\DATA\DB\'
SET @LogFilePath = N'E:\MSSQL\DATA\Logs\'

SELECT @sql = 'USE MASTER'
EXEC (@sql)

SELECT @sql = 'CREATE DATABASE '+ quotename(@DBNAME) + ' 
ON 
PRIMARY
 ( 
 NAME = ''' + @DBNAME + '_DB'', 
 FILENAME = ''' + @DataFilePath + @DBNAME + '.mdf'', 
 SIZE = 3136 KB , MAXSIZE = UNLIMITED, 
 FILEGROWTH = 1024 KB
 ) 
LOG ON
 (
 NAME = '''+ @DBNAME + '_Log'', 
 FILENAME = '''+ @LogFilePath+ @DBNAME  + '_log.ldf'', 
 SIZE = 832KB , MAXSIZE =  2048 GB , FILEGROWTH = 10 %
 )'

EXEC (@sql) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-09-06T13:03:28.843

请参阅此链接：[创建数据库（Transact-SQL）](http://technet.microsoft.com/en-us/library/ms176061.aspx)

```
CREATE DATABASE [ADestinyDb] CONTAINMENT = NONE ON  PRIMARY 
( NAME = N'ADestinyDb', 
  FILENAME = N'D:\temp\dbFolder\ADestinyDb.mdf' , 
  SIZE = 3136 KB , MAXSIZE = UNLIMITED, 
  FILEGROWTH = 1024 KB )
LOG ON 
( NAME = N'ADestinyDb_log', 
  FILENAME = N'D:\temp\dbFolder\_log.ldf' , 
  SIZE = 832KB , MAXSIZE =  2048 GB , FILEGROWTH = 10 %) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-02-04T06:20:03.620

在您的文件系统上创建文件夹：D:\temp\dbFolder\ 并运行以下脚本（尝试“sa”登录）

```
 USE master
CREATE DATABASE [faltu] ON  PRIMARY 
( NAME = N'faltu', FILENAME = N'D:\temp\dbFolder\faltu.mdf' , SIZE = 2048KB , FILEGROWTH = 1024KB )
 LOG ON 
( NAME = N'faltu_log', FILENAME = N'D:\temp\dbFolder\faltu_log.ldf' , SIZE = 1024KB , FILEGROWTH = 10%) 
```

# python - 为什么 Python pep-8 强烈建议在制表符上使用空格进行缩进？

> ID：120926
> 
> 赞同：181
> 
> 时间：2008-09-23T13:20:34.910
> 
> 标签：python, indentation, pep8

我在 Stack Overflow 和[PEP 8](http://www.python.org/dev/peps/pep-0008/)上看到，建议仅在 Python 程序中使用空格进行缩进。我能理解一致缩进的必要性，我也感受到了那种痛苦。

首选空间是否存在根本原因？我原以为标签更容易使用。

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2011-02-19T00:56:16.117

好吧，似乎每个人都对空间有强烈的偏见。我只使用标签。我很清楚为什么。

标签实际上是一个很酷的发明，它出现**在**空格之后。它允许您在不推动空间数百万次或使用假制表符（产生空格）的情况下缩进。

我真的不明白为什么每个人都在区分标签的使用。这很像老年人歧视年轻人选择更新更高效的技术并抱怨脉冲拨号适用于**每部电话**，而不仅仅是这些花哨的新手机。“并非每部电话都可以使用音频拨号，这就是它错误的原因”。

您的编辑器无法正确处理选项卡？好吧，找一个**现代**编辑器。可能是该死的时代，我们现在处于 21 世纪，编辑器是高科技复杂软件的时代早已过去。我们现在有大量的编辑器可供选择，所有的编辑器都支持标签。此外，您可以定义制表符应该有多少，这是您不能用空格做的事情。看不到标签？那是什么辩论？好吧，你也看不到空格！

我可以这么大胆地建议找一个更好的编辑器吗？这些高科技产品之一，大约 10 年前已经发布，**显示隐形字符**？（讽刺关闭）

使用空格会导致更多的删除和格式化工作。这就是为什么（以及所有其他知道这一点并同意我的人）在 Python 中使用标签的原因。

混合制表符和空格是一个禁忌，也没有任何争论。那是一团糟，永远无法工作。

* * *

## 回答 #2

> 赞同：132
> 
> 时间：2008-09-23T15:19:27.373

答案就在 PEP 中给出[编辑：这段话已在[2013 年](https://hg.python.org/peps/rev/fb24c80e9afb#l1.75)被编辑]。我引用：

> Python最**流行**的缩进方式是仅使用空格。

您还需要什么其他根本原因？

直截了当地说：还要考虑 PEP 的范围，如第一段所述：

> 本文档给出了包含主要 Python 发行版中标准库的 Python 代码的编码约定。

目的是使*官方 python 发行版中的所有代码*格式一致（我希望我们能同意这普遍是一件好事™）。

由于对于单个程序员来说，空格和制表符之间的决定是 a) 真正的品味问题 b) 很容易通过技术手段（编辑器、转换脚本等）处理，因此有一个明确的方法可以结束所有讨论：选择一个.

圭多是可以选择的人。他甚至不必给出理由，但他仍然参考了经验数据。

对于所有其他目的，您可以将此 PEP 作为建议，也可以忽略它——您的选择，或您的团队或您的团队领导。

但是，如果我可以给你一个建议：不要混合使用 ;-) [编辑：混合制表符和空格不再是一种选择。]

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2009-05-16T17:41:35.227

我个人不同意制表符上的空格。对我来说，制表符是文档布局字符/机制，而空格用于内容或在代码情况下命令之间的描述。

我必须同意 Jim 的评论，即选项卡并不是真正的问题，而是人们以及他们想要如何混合选项卡和空格。

也就是说，为了惯例，我强迫自己使用空格。我重视一致性而不是个人偏好。

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2008-09-23T13:24:26.650

选项卡的问题在于它们是不可见的，人们永远无法就选项卡的宽度达成一致。当你混合制表位和空格，并且你在 Python 以外的地方设置制表位（每 8 个空格使用一个制表位），你会看到代码的布局与 Python 看到的不同。而且因为布局决定了块，你会看到不同的逻辑。它会导致细微的错误。

如果你坚持违反 PEP 8 并使用制表符——或者更糟糕的是，混合制表符和空格——至少总是使用“-tt”参数运行 python，这会导致缩进*不一致*（有时是制表符，有时是相同缩进的空格水平）错误。此外，如果可能，请将您的编辑器设置为以不同方式显示选项卡。但实际上，最好的方法是不要使用制表符，句号。

* * *

## 回答 #5

> 赞同：31
> 
> 时间：2008-09-23T14:45:39.013

空格的原因是制表符是可选的。空格是标点符号中实际的最小公分母。

每个像样的文本编辑器都有一个“用空格替换选项卡”，很多人都使用它。但不总是。

虽然某些文本编辑器可能会用制表符替换一系列空格，但这确实很少见。

**底线**。空格不会出错。标签*可能*会出错。所以不要使用制表符并减少出错的风险。

* * *

## 回答 #6

> 赞同：30
> 
> 时间：2008-09-27T17:32:09.227

当您混合制表符和空格时，会出现缩进的主要问题。显然这并没有告诉你应该选择哪一个，但这是推荐一个的好理由，即使你是通过抛硬币来选择它。

但是，恕我直言，有几个小理由偏爱空格而不是制表符：

*   不同的工具。有时代码会显示在程序员的编辑器之外。例如。发布到新闻组或论坛。在这里，空格通常比制表符做得更好 - 任何地方的空格都会被破坏，制表符也是如此，但反之则不然。

*   程序员对源代码的看法不同。这是非常主观的 - 它要么是标签的主要好处，要么是根据您所在的一方而避免使用它们的理由。从好的方面来说，开发人员可以使用他们喜欢的缩进查看源代码，因此喜欢 2 个空格缩进的开发人员可以与 8 个空格的开发人员在同一个源代码上工作，并且仍然可以按照他们喜欢的方式查看它。不利的一面是，这会产生影响——有些人喜欢 8-space，因为它给出了非常明显的反馈，表明它们嵌套得太深了——他们可能会看到 2-indenter 签入的代码不断地包裹在他们的编辑器中。让每个开发人员都以相同的方式查看代码会导致行长度和其他问题更加一致。

*   继续行缩进。有时您想缩进一行以表明它是从前一行携带的。例如。

    ```
    def foo():
        x = some_function_with_lots_of_args(foo, bar, baz,
                                            xyzzy, blah) 
    ```

    如果使用制表符，则没有办法在不混合空格和制表符的情况下为在编辑器中使用不同制表位的人对齐。这有效地扼杀了上述好处。

显然，这是一个深具宗教色彩的问题，编程困扰着它。最重要的问题是我们应该选择一个——即使那不是你喜欢的那个。有时我认为显着缩进的最大优势是至少我们可以避免大括号放置的激烈冲突。

同样值得一读的是Jamie Zawinski 关于这个问题的[这篇](http://www.jwz.org/doc/tabs-vs-spaces.html)文章。

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2013-08-03T15:49:14.937

请注意，制表符的使用混淆了 PEP 8 的另一个方面：

> 将所有行限制为最多 79 个字符。

假设，您使用的制表符宽度为 2，而我使用的制表符宽度为 8。您编写了所有代码，使最长行达到 79 个字符，然后我开始处理您的文件。现在我有难以阅读的代码，因为（正如 PEP 所述）：

> 大多数工具中的默认包装破坏了代码的视觉结构

如果我们都使用 4 个空格，那总是一样的。任何编辑器可以支持 80 个字符宽度的人都可以轻松阅读代码。*注意：80 个字符的限制本身就是一场圣战，所以我们不要从这里开始。*

任何非 sucky 编辑器都应该可以选择使用空格，就好像它们是制表符一样（插入和删除），所以这真的不应该是一个有效的论点。

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2008-09-27T16:56:59.090

问题的答案是：PEP-8 想要提出建议，并决定由于空格更受欢迎，因此强烈推荐空格而不是制表符。

* * *

PEP-8 注释

PEP-8 说*“每个缩进级别使用 4 个空格。”*
很明显，这是标准建议。

*“对于您不想弄乱的真正旧代码，您可以继续使用 8 空格制表符。”*
很明显，在某些情况下可以使用选项卡。

*“永远不要混合制表符和空格。”*
这是明确禁止混合的——我想我们都同意这一点。Python 可以检测到这一点并且经常窒息。使用 -tt 参数会使这成为一个显式错误。

*'Python 最流行的缩进方式是仅使用空格。第二个最流行的方式是仅使用标签。*
这清楚地表明两者都被使用。只是要非常清楚：您仍然不应该在同一个文件中混合空格和制表符。

*“对于新项目，强烈建议仅使用空格而不是选项卡。”*
这是一个明确的建议，也是一个强有力的建议，但不是禁止制表符。

* * *

我在 PEP-8 中找不到我自己的问题的好答案。我使用标签，这是我在其他语言中使用过的。Python 接受源代码并排他使用选项卡。这对我来说已经足够了。

我想我会尝试使用空间。在我的编辑器中，我将文件类型配置为专门使用空格，因此如果我按下制表符，它会插入 4 个空格。如果我按 Tab 太多次，我必须删除空格！ **啊！** 删除次数是标签的四倍！我的编辑不能告诉我使用 4 个空格作为缩进（尽管 AN 编辑可能能够做到这一点）并且显然坚持一次删除一个空格。

不能告诉 Python 在读取缩进时将制表符视为 n 个空格吗？如果我们可以就每个缩进 4 个空格和每个制表符 4 个空格达成一致，并允许 Python 接受这一点，那么就不会有问题了。
我们应该找到双赢的解决问题的办法。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2012-01-05T18:31:35.190

我一直在我的代码中使用制表符。也就是说，我最近找到了使用空格的理由：在我的诺基亚 N900 互联网平板电脑上进行开发时，我现在有一个没有 Tab 键的键盘。这迫使我要么复制和粘贴标签，要么用空格重新编写我的代码。我在其他手机上也遇到过同样的问题。当然，这不是 Python 的标准用法，但需要牢记。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-23T13:35:42.020

由于python依赖缩进来识别程序结构，因此需要一种清晰的方式来识别标识。这就是选择空格或制表符的原因。

然而，python 也有一种强烈的哲学，即只有一种方法来做事，因此应该有一个官方推荐一种方法来做缩进。

空格和制表符都对编辑器作为缩进处理提出了独特的挑战。选项卡本身的处理在编辑器甚至用户设置中并不统一。由于空间是不可配置的，它们构成了更合乎逻辑的选择，因为它们保证结果在任何地方看起来都相同。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-27T17:50:59.740

[JWZ 说得最好](http://www.jwz.org/doc/tabs-vs-spaces.html)：

> 当 [人们] 阅读代码并完成编写新代码时，他们关心当新范围（或 sexpr 或其他）打开时代码倾向于缩进多少屏幕列......
> 
> ...我的观点是，解决技术问题的最佳方法是强制 ASCII #9 TAB 字符永远不会出现在磁盘文件中：编程您的编辑器以在将行写入磁盘之前将 TAB 扩展为适当数量的空格。 ..
> 
> ...这假设您永远不会在它们实际上很重要的地方使用制表符，例如在字符串或字符常量中，但我从不这样做：当它是一个制表符时，我总是使用 '\t' 代替。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-23T13:30:23.233

我可以说空格优于制表符的最重要优势是，许多程序员和项目为源代码使用一定数量的列，如果有人提交更改并将其制表位设置为 2 个空格，而项目使用 4 个空格作为tabstop 对于其他人的编辑器窗口来说，长行将太长。我同意标签更容易使用，但我认为空间更容易协作，这对于像 Python 这样的大型开源项目很重要。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-23T13:52:25.583

你可以吃你的蛋糕。将您的编辑器设置为自动将选项卡扩展为空格。

（那将是`:set expandtab`在 Vim 中。）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-02-26T00:27:26.250

我的猜测是大多数 linux 文本编辑器在默认情况下使默认值看起来非常大。我想不出任何其他在制表符上使用空格的好理由。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2008-09-23T13:25:57.503

选项卡的普遍问题是它们可以在不同的环境中以不同的方式表示。
在给定的编辑器中，选项卡可能是 8 个空格，也可能是 2 个。
在某些编辑器中，您可以控制这一点，而在其他编辑器中则不能。

选项卡的另一个问题是它们在打印输出中的表示方式。我相信大多数打印机将制表符解释为 8 个空格。

有了空格，毫无疑问。一切都会按照作者的意图排列。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2013-02-25T21:11:22.847

除了已经提到的所有其他原因（一致性、从不混合空格和制表符等），我相信还有一些原因需要注意 4 个空格的约定。这些仅适用于 Python（可能还有其他缩进有意义的语言）。根据个人喜好，其他语言的选项卡可能会更好。

1.  如果编辑器不显示选项卡（这取决于配置，在很多情况下都会发生），另一位作者可能会假设您的代码使用 4 个空格，b/c 几乎所有公开可用的 Python 代码都是如此；如果同一编辑器的制表符宽度恰好为 4，则可能会发生令人讨厌的事情 - 至少，那个可怜的人会因为缩进问题而浪费时间，而这种缩进问题很容易通过遵守约定来避免。所以对我来说，第一个原因是避免一致性的错误。

2.  重新定义制表符或空格哪个更好的问题，应该问制表符的优点是什么；我看过很多赞美标签的帖子，但很少有令人信服的论据；像 emacs、vi(m)、kate 等优秀的编辑器...根据代码的语义进行适当的缩进——即使没有制表符；相同的编辑器可以很容易地配置为取消缩进退格等。

3.  有些人在决定代码的外观/布局时有非常强烈的偏好；其他人重视这种自由的一致性。Python 通过规定缩进用于块等，大大降低了这种自由度。这可能被视为一个错误或一个特性，但它有点与选择 Python 相关。就我个人而言，我喜欢这种一致性——当开始在一个新项目上编码时，至少布局与我习惯的接近，所以它相当容易阅读。几乎总是。

4.  使用空格进行缩进允许有助于理解代码的“布局技巧”；PEP8 中列出了其中的一些示例；例如。

    ```
    foo = long_function_name(var_one, var_two,
                             var_three, var_four)

    # the same for lists
    a_long_list = [1,
                   2,
                   # ...
                   79]

    # or dictionaries
    a_dict = {"a_key": "a_value",
              "another_key": "another_value"} 
    ```

    当然，上面的也可以写成

    ```
    foo = long_function_name(
        var_one, var_two,
        var_three, var_four)

    # the same for lists
    a_long_list = [
        1,
        2,
        # ...
        79]

    # or dictionaries
    a_dict = {
        "a_key": "a_value",
        "another_key": "another_value"} 
    ```

    然而，后者需要更多的代码行，并且有时认为更少的行更好（b / c你在单个屏幕上获得更多）。但是如果你喜欢对齐，空格（最好由一个好的编辑器辅助）在某种意义上给你在 Python 中比制表符更自由。[好吧，我猜有些编辑器允许您使用制表符执行相同的操作；）-但是使用空格，所有编辑器都可以...]

5.  回到其他人提出的相同论点 - PEP 8 规定（好的，强烈推荐）空格。如果来到一个只使用选项卡的项目，当然，你别无选择。但由于 PEP 8 约定的建立，几乎所有 Python 程序员都习惯了这种风格。这使得在大多数程序员接受的风格上找到共识变得非常容易……否则让个人就风格达成一致可能会非常困难。

6.  有助于强制执行风格的工具通常无需额外努力即可了解 PEP 8。这不是一个很好的理由，但让事情开箱即用真是太好了。

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2021-01-14T19:33:53.227

好吧，我会说 PEP 8 中没有这样的“建议”。它被声明为建议，因为它们不会禁止您编写选项卡，但由于代码必须以最标准化的方式编写，因此我们必须使用空格.

也就是说，如果我是编写标准指南的人，我会推荐制表符，因为它们是一种现代且更实用的代码缩进方式。

最后，我要强调的是，我**不鼓励**任何人使用制表符，相反，我是说我们所有人都应该使用[样式指南](https://www.python.org/dev/peps/pep-0008/#id18)中所述的**空格**。

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2011-08-06T06:53:51.157

关于[Jim 和 Thomas Wouters](https://stackoverflow.com/questions/120926/why-does-python-pep-8-strongly-recommend-spaces-over-tabs-for-indentation/120956#120956)在评论中的讨论。

问题是......因为制表符和空格的宽度都可以变化 - 并且由于程序员不能就任一宽度达成一致 - 为什么制表符要承担责任。

我同意吉姆的观点——标签本身并不邪恶。但有个问题...

有了空格，我可以控制***“我自己的代码”*** 在世界上每个编辑器中的外观。如果我使用 4 个空格——那么无论您在哪个编辑器中打开我的代码，它与左边距的距离都是相同的。对于标签，我受制于编辑器的标签宽度设置——即使是我自己的代码。我不喜欢那样。

因此，尽管空格确实不能保证一致性——它们至少让你可以更好地控制你的 OWN 代码在任何地方的外观——这是制表符不能做到的。

我认为这不是程序员编写代码的一致性——而是编辑器显示代码的一致性——空格更容易实现（和强加）。

# c# - SharePoint 错误：“无法导入 Web 部件”

> ID：120928
> 
> 赞同：11
> 
> 时间：2008-09-23T13:20:59.153
> 
> 标签：c#, sharepoint, moss, web-parts, project-server

我有一个自己开发的 Web 部件，如果我手动安装 Web 部件就可以了。

但是，当我按照本网站上的说明打包 Web 部件作为指南时： [http ://www.theartofsharepoint.com/2007/05/how-to-build-solution-pack-wsp.html](http://www.theartofsharepoint.com/2007/05/how-to-build-solution-pack-wsp.html)

我在日志文件中收到此错误：

```
09/23/2008 14:13:03.67  w3wp.exe (0x1B5C)                           0x1534  Windows SharePoint Services     Web Parts                       8l4d    Monitorable Error importing WebPart. Cannot import Project Filter.   
09/23/2008 14:13:03.67  w3wp.exe (0x1B5C)                           0x1534  Windows SharePoint Services     Web Parts                       89ku    High        Failed to add webpart http%253A%252F%252Fuk64p12%252FPWA%252F%255Fcatalogs%252Fwp%252FProjectFilter%252Ewebpart;Project%2520Filter.  Exception Microsoft.SharePoint.WebPartPages.WebPartPageUserException: Cannot import Project Filter.     at Microsoft.SharePoint.WebPartPages.WebPartImporter.CreateWebPart(Boolean clearConnections)     at Microsoft.SharePoint.WebPartPages.WebPartImporter.Import(SPWebPartManager manager, XmlReader reader, Boolean clearConnections, Uri webPartPageUri, SPWeb spWeb)     at Microsoft.SharePoint.WebPartPages.WebPartImporter.Import(SPWebPartManager manager, XmlReader reader, Boolean clearConnections, SPWeb spWeb)     at Microsoft.SharePoint.WebPartPages.WebPartQuickAdd.System.Web.UI.IPostBackEventHandler.RaisePostBackEvent(...  
09/23/2008 14:13:03.67* w3wp.exe (0x1B5C)                           0x1534  Windows SharePoint Services     Web Parts                       89ku    High        ...String eventArgument) 
```

相关的位是：

```
http%253A%252F%252Fuk64p12%252FPWA%252F%255Fcatalogs%252Fwp%252FProjectFilter%252Ewebpart;Project%2520Filter.
Exception Microsoft.SharePoint.WebPartPages.WebPartPageUserException: Cannot import Project Filter.
at Microsoft.SharePoint.WebPartPages.WebPartImporter.CreateWebPart(Boolean clearConnections)
at Microsoft.SharePoint.WebPartPages.WebPartImporter.Import(SPWebPartManager manager, XmlReader reader, Boolean clearConnections, Uri webPartPageUri, SPWeb spWeb)
at Microsoft.SharePoint.WebPartPages.WebPartImporter.Import(SPWebPartManager manager, XmlReader reader, Boolean clearConnections, SPWeb spWeb)
at Microsoft.SharePoint.WebPartPages.WebPartQuickAdd.System.Web.UI.IPostBackEventHandler.RaisePostBackEvent(String eventArgument) 
```

这伴随着一条相当简洁的错误消息：“无法导入 Web 部件”。

我已检查并且我的 .dll 已注册为安全的，它在 GAC 中，该功能已激活，并且 Web 部件出现在 Web 部件库中，所有正确的属性都表明 Web 部件文件已成功读取。

一切似乎都已到位，但我从 SharePoint 中得到了该错误，并且几乎没有解释如何解决它。

任何帮助找到解决方案表示赞赏。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-23T15:49:25.770

弄清楚了。

错误消息来自 .webpart 文件：

```
<?xml version="1.0" encoding="utf-8"?>
<webParts>
  <webPart xmlns="http://schemas.microsoft.com/WebPart/v3">
    <metaData>
      <!--
      The following Guid is used as a reference to the web part class, 
      and it will be automatically replaced with actual type name at deployment time.
      -->
      <type name="7F8C4D34-6311-4f22-87B4-A221FA8735BA" />
      <importErrorMessage>Cannot import Project Filter.</importErrorMessage>
    </metaData>
    <data>
      <properties>
        <property name="Title" type="string">Project Filter</property>
        <property name="Description" type="string">Provides a list of Projects that can be used to Filter other Web Parts.</property>
      </properties>
    </data>
  </webPart>
</webParts> 
```

问题是原始 .webpart 文件是在安装了 Visual Studio Extensions for WSS 的 32 位系统上创建的。

但是，由于我现在使用的是 64 位计算机，因此 VSEWSS 不可用，并且我相信这会导致上述 GUID 未被替换，因为我没有使用这些部署工具。

用完整的类型名称替换 GUID 是可行的。

因此，如果您遇到来自 importErrorMessage 节点的错误消息，请检查 .webpart 文件中的类型节点是否看起来更像这样（不相关的示例）：

```
<type name="TitleWP.TitleWP, TitleWP, Version=1.0.0.0, Culture=neutral, PublicKeyToken=9f4da00116c38ec5" /> 
```

格式为：Class、Namespace、Version、Culture、PublicKey

您可以从与您的 SharePoint 实例关联的 web.config 文件中轻松获取它，因为它将位于安全控件列表中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-07-09T15:41:59.103

我们遇到了同样的问题，发现 WebPartImporter 正在调用我们的 Web 部件的构造函数，并且在构造函数中我们正在执行 SPSecurity.RunWithElevatedPrivileges。

由于某种原因，WebPartImporter 无法处理此问题。所以，我们只是将我们的代码从构造函数中移出到 OnInit（它真正属于的地方），一切都很好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-02-08T00:57:40.130

所有伟大的建议。我的问题既独特又愚蠢：我已将解决方案部署到第一个 Web 应用程序，但没有部署到第二个。然而，SharePoint 仍然允许我在第二个 Web 应用程序的网站集上激活该功能（不知道为什么）。这意味着第二个 Web 应用程序在此 Web.config 文件中没有安全控制条目（我愚蠢地检查了第一个 Web.config）。

因此，请仔细检查您是否正在查看正确的 Web 应用程序/web.config。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T04:48:46.490

现在我得到了类似问题的答案，如下所示：

当我尝试向页面添加新的 wep 部件时，sharepoint 显示一条错误消息，告诉我--无法导入我的 web 部件，此错误消息定义在 .webpart 文件中。

所以我尝试在页面中添加一些其他的web部件，一个奇怪的问题出现，其中一些可以添加，一些不能添加。

在我跟踪我的 web 部件的代码并分析它们之后，我找到了原因：

Web 部件 ProjectInfo（我的 Web 部件名称）的旧代码是：

```
namespace ProjectInfo
....
 public class ProjectInfo:System.Web.UI.WebControls.WebParts.Web.part
 {
        .....
        private SPWeb _spWeb;
        private SPList _spList;
        private string _listName = "ProjectDocs";
        ......
 }
public ProjectInfo()
 {
        .....
            _spWeb = SPContext.Current.Web;
            //It show me a error here when i trace the code
            _spList = _spWeb.Lists[_listName]; 
        .....
 } 
```

现在停下来，我认为这可能是网页初始化顺序问题。AS网页加载Web部件控件，首先运行构造函数ProjectInfo()。实际上，网页还没有完成它的初始化。到......的时候。

所以我做了一个测试。首先，我在页面中放了一个好的网页，没关系。然后，我尝试将 Web 部件放在刚才无法添加的页面中。~~好的！！它正在工作......因为页面已经初始化。完成的。

行！我更正了我的代码：

```
 namespace ProjectInfo
    ....
     public class ProjectInfo:System.Web.UI.WebControls.WebParts.Web.part
     {
            .....
            private SPWeb _spWeb;
            private SPList _spList;
            private string _listName = "ProjectDocs";
            ......
     }
    public ProjectInfo()
     {
            .....
                //Remove code in constructure function.
                //_spWeb = SPContext.Current.Web;
                //It show me a error here when i trace the code
                //_spList = _spWeb.Lists[_listName]; 
            .....
     }

   protected override void CreateChildControls()
        {
         ....
           base.CreateChildControls();

            _spWeb = SPContext.Current.Web;
            _spList = _spWeb.Lists[_listName];
          ....
         } 
```

经过我的测试，错误信息没有再次发生..大声笑~~

希望这个解释会对你有所帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-04T15:50:50.570

我已经多次看到这种异常情况，但没有很好的解决方案。

检查您的程序集、命名空间、类名称是否在任何地方都正确。这让我不止一次挂断电话。

确保您有一个有效的 SafeControls 条目。

确保您的 .webpart 文件有效（如果可以，让 SharePoint 为您创建）

如果您绝对肯定一切都是正确的，那么您将被困在我去过几次的地方。我唯一能想到的是 VS 错误地编译了程序集。我发现的唯一解决方法是创建一个新的 VS 项目并根据需要进行设置，然后将旧 CS 文件的文本复制到新的 CS 文件中……不要复制文件本身……目标就是让一切都新鲜。

这对我有用。祝你好运。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T14:23:01.547

您是否回收了您的工作进程或重置了 IIS？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-19T07:40:54.650

解决了我的。

我收到了这个错误：

```
===========================================================================
Error importing WebPart. Cannot import ........ Web Part.
Failed to add webpart 
Exception Microsoft.SharePoint.WebPartPages.WebPartPageUserException: Cannot import ... Web Part.     at Microsoft.SharePoint.WebPartPages.WebPartImporter.CreateWebPart(Boolean clearConnections)     at Microsoft.SharePoint.WebPartPages.WebPartImporter.Import(SPWebPartManager manager, XmlReader reader, Boolean clearConnections, Uri webPartPageUri, SPWeb spWeb)     at Microsoft.SharePoint.WebPartPages.WebPartImporter.Import(SPWebPartManager manager, XmlReader reader, Boolean clearConnections, SPWeb spWeb)     at Microsoft.SharePoint.WebPartPages.WebPartQuickAdd.System.Web.UI.IPostBackEventHandler.RaisePostBackEvent(String eventArgument)   
=========================================================================== 
```

“无法导入 webpart...”

问题是：不匹配的 GUIDS

检查 webpart 类以及 .xml 和 .webpart 类中的 guid 是否相同。

我正在从其他 webparts 源复制粘贴代码。（Codeplex 上的多个文档上传 Wepart）并忘记修复 guid。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-25T14:23:08.460

当我的 Web 部件引用的 GAC 中的程序集由与我期望的不同的强名称密钥文件签名时，我也遇到了此错误。我在决定更新这些 DLL 时发现了这一点。将其插入 GAC 时，我注意到同一个 DLL 有 2 个条目，但它们具有不同的公钥令牌

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-24T15:29:41.380

当我创建基类 Web 部件然后从它继承派生类时出现此错误。基类很好，但是当我尝试将派生类添加到与原始帖子相同的错误的网页时，派生类失败。就我而言，我必须在类中添加一个**公共**修饰符：

```
public class DerivedWebPart : BaseWebPart 
```

我还在派生类中添加了一个构造函数来调用基类之一 - 尽管我认为你不应该真的需要这个：

```
 public DerivedWebPart() : base()
    {
    } 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-11-08T08:37:31.587

我发现我的第一次没有导入，但是如果我单击“新建”并添加它，它会起作用。

从那里我获取了 XML 的副本并将其保存到我的项目中。之后，Web 部件运行良好。

我只花了几天时间就达到了这一点。浪费了很多时间。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-11-20T21:44:08.943

我遇到了一个与此非常相似的问题，但 Guid 不是问题：我的 webpart 没有将`CLSCompliannt`属性设置为 false。像这样：

```
namespace MyNamespace
{

    [CLSCompliant(false)]
    [Guid("...")]
    public class MyWidget : MyWebPartBaseClass
    {

    }
} 
```

# c# - 我可以将自定义版本字符串添加到 .net DLL 吗？

> ID：120936
> 
> 赞同：5
> 
> 时间：2008-09-23T13:21:56.140
> 
> 标签：c#, .net, visual-studio, version-control

我可以通过手动编辑 .rc 文件将自定义版本字符串添加到 Visual Studio 中的 C++ DLL。例如，如果我添加到 .rc 文件的 VersionInfo 部分

```
VALUE "BuildDate", "2008/09/19 15:42:52" 
```

然后该日期在文件资源管理器中可见，在 DLL 的属性中，在版本选项卡下。

我可以为 C# DLL 做同样的事情吗？不仅针对构建日期，还针对其他版本信息（例如源代码控制信息）

更新：我认为可能有一种方法可以通过嵌入 Windows 资源来做到这一点，所以我[问了如何做到这一点](https://stackoverflow.com/questions/200485)。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-23T16:16:50.277

Expanding on the Khoth's answer, In AssemblyInfo.cs:

You can do:

```
[assembly: CustomResource("Build Date", "12/12/2012")] 
```

Where CustomResource is defined as:

```
[AttributeUsage(AttributeTargets.Assembly)]
public class CustomResourceAttribute : Attribute
{        
    private string the_variable;
    public string Variable  {get { return the_variable; }}

    private string the_value;
    public string Value     {get { return the_value; }}

    public CustomResourceAttribute(string variable, string value)
    {
        this.the_variable = variable;
        this.the_value = value;
    }
} 
```

This solution is nice because it gives you the flexibility you need and it does not cause any compiler warnings.

Unfortunately it is not possible to use a DateTime because the values entered in Attributes must be constants, and a DateTime is not a constant.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T13:24:40.300

在 AssemblyInfo.cs 中，您可以输入：

```
[assembly: System.Reflection.AssemblyInformationalVersion("whatever you want")] 
```

如果它不是像 1.2.3.4 这样的数字，这是一个编译器警告，但我相当确定一切都会正常工作。

# synchronization - 测试和设置是做什么用的？

> ID：120937
> 
> 赞同：12
> 
> 时间：2008-09-23T13:22:00.930
> 
> 标签：synchronization, embedded, mutex, test-and-set

在阅读了 Test-and-Set [Wikipedia entry](http://en.wikipedia.org/wiki/Test-and-set)之后，我仍然有一个问题“Test-and-Set 将用于什么？”

我意识到您可以使用它来实现 Mutex（如维基百科中所述），但它还有什么其他用途？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-23T13:30:33.967

**一个很好的例子是“增量”。**

说两个线程执行`a = a + 1`。Say`a`以 value 开头`100`。如果两个线程同时运行（多核），则两者都将加载`a`为`100`，递增到`101`，然后将其存储回`a`. 错误的！

使用 test-and-set，您说的是“设置`a`为`101`，但前提是它当前具有值`100`。” 在这种情况下，一个线程将通过该测试，但另一个线程将失败。在失败的情况下，线程可以重试整个语句，这次加载`a`为`101`. 成功。

这通常比使用互斥锁更快，因为：

1.  大多数情况下没有竞争条件，因此无需获取某种互斥锁即可进行更新。
2.  即使在冲突期间，一个线程根本不会被阻塞，并且另一个线程只是旋转并重试比将自己挂起以等待某个互斥体更快。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-23T13:26:59.903

您在完成一些工作后想要将数据写入内存时使用它，并确保自您开始以来另一个线程没有覆盖目标。许多无[锁/无互斥算法](https://stackoverflow.com/questions/93073/how-to-implement-thread-safe-reference-counting-in-c)采用这种形式。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-23T13:43:29.333

想象一下，您正在编写一个银行应用程序，并且您的应用程序请求从帐户中提取 10 英镑（是的，我是英国人；））。所以你需要将当前账户余额读入一个局部变量，减去取款，然后将余额写回内存。

但是，如果在读取值和写出值之间发生另一个并发请求怎么办？该请求的结果有可能被第一个完全覆盖，并且帐户余额将不正确。

测试和设置通过检查覆盖的值是否是您认为的值来帮助我们解决该问题。在这种情况下，您可以检查余额是否是您读取的原始值。因为它是原子的，所以它是不可中断的，所以没有人可以在读取和写入之间从你下面拉出地毯。

解决相同问题的另一种方法是锁定内存位置。不幸的是，锁非常难以正确，难以推理，存在可伸缩性问题并且在面对故障时表现不佳，因此它们不是理想（但绝对实用）的解决方案。测试和设置方法构成了一些软件事务存储器的基础，它乐观地允许每个事务同时执行，但如果它们发生冲突则以回滚它们为代价。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T13:26:48.890

基本上，考虑到原子性的巨大重要性，它的用途恰好是互斥锁。就是这样。

测试和设置是一种可以使用其他两条指令执行的操作，非原子指令和更快（在多处理器系统上原子性承担硬件开销），因此通常您不会出于其他原因使用它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T13:33:51.277

当您需要获取共享值、对其执行某些操作并更改该值时使用它，假设另一个线程尚未更改它。

至于实际用途，我最后一次看到它是在并发队列的实现中（可以由多个线程推送/弹出而不需要信号量或互斥锁的队列）。

为什么要使用 TestAndSet 而不是互斥锁？因为它通常比互斥锁需要更少的开销。在互斥体需要操作系统干预的情况下，可以将 TestAndSet 实现为 CPU 上的单个原子指令。在具有 100 个线程的并行环境中运行时，关键代码部分中的单个互斥锁可能会导致严重的瓶颈。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2022-02-12T02:26:05.743

它也可以用来实现自旋锁：

```
void spin_lock(struct spinlock *lock)
{
        while (test_and_set(&lock->locked));
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2022-02-22T09:59:06.537

测试和设置锁 (TLS) 用于实现进入临界区。

```
TLS <destination> <origin> 
```

一般来说，TLS 是一个原子操作，包括两个步骤：

1.  将值从复制`origin`到`destination`
2.  将值设置`origin`为 1

让我们看看我们如何实现一个简单的互斥锁，用于使用 TLS CPU 指令进入临界区。

我们需要一个将用作共享资源的存储单元。让我们称之为`lock`。对我们来说重要的是，我们可以为这个内存单元设置 0 或 1 值。

然后进入临界区将如下所示：

```
enter_critical_section:
    TLS <tmp>, <lock>           ; copy value from <lock> to <tmp> and set <lock> to 1
    CMP <tmp>, #0               ; check if previous <lock> value was 0
    JNE enter_critical_section  ; if previous <lock> value was 1, it means that we didn't enter the critical section, and must try again
    RET                         ; if previous <lock> value was 0, we entered critical section, and can return to the caller 
```

要离开临界区，只需将值设置`lock`回 0：

```
leave_critical_section:
  MOV <lock>, #0  
  RET 
```

附言

例如，在 x86 中有一条[XCHG 指令](https://c9x.me/x86/html/file_module_x86_id_328.html)，它允许与另一个寄存器交换注册表/内存的值。

```
XCHG <destination> <origin> 
```

XCHG指令进入临界区的实现：

```
enter_critical_section:
    MOV <tmp>, #1
    XCHG <tmp>, <lock>
    CMP <tmp>, #0
    JNE enter_critical_section
    RET 
```

# java - Web 应用程序 DAL 中的 JDBC 数据库连接

> ID：120941
> 
> 赞同：1
> 
> 时间：2008-09-23T13:22:22.363
> 
> 标签：java, sql, jdbc

我正在使用相当标准的 Web/服务/数据访问分层设计构建一个用于娱乐/学习的小型网站。

对于数据访问层，处理创建连接对象以调用我的 SQL 存储过程的最佳方法是什么？为什么？请记住，我正在手动编写很多代码（我知道我可以使用 Hibernate 等为我做很多这样的事情）......

1) 我应该创建一个 Connection 的静态实例并通过它运行我的所有查询还是会导致并发问题？

2）我应该为每个数据库调用创建一个连接实例并接受性能开销吗？（如果是这种情况，我将在以后研究连接池）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-23T13:24:04.263

您应该`Connection`每个线程使用一个。不要跨线程共享连接。

**考虑使用[Apache DBCP](http://commons.apache.org/dbcp/)**。这是配置数据库连接并从池中提取它们的免费且标准的方法。这是 Tomcat 等高性能 Web 服务器使用的方法。

此外，如果您使用 DBCP，由于它是一个*池*（读取：缓存），因此频繁创建/关闭连接几乎不会受到影响。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T15:17:33.540

标准方法是设置数据源。所有应用程序服务器都可以通过它们的管理控制台执行此操作。然后可以通过它的 JNDI 名称（例如“jdbc/MyDB”）访问该池。

事实上，数据源应该是一个连接池（通常是）。它缓存连接，在传递给应用程序之前对其进行测试，并执行许多其他重要功能。

在您的代码中，您：

1.  解析 JNDI 名称并将其转换为 DataSource
2.  从数据源获取连接
3.  做你的工作
4.  关闭连接（它回到这里的池）

您可以自己设置池（使用任何免费提供的池实现），但如果您使用的是应用程序服务器，这真的没有任何意义。

PS 由于它是一个 Web 应用程序，因此在请求后确保您已关闭连接的好方法是使用 HttpFilter。您可以在 web.xml 中设置一个。当请求到来时，获取连接，放入ThreadLocal。在请求期间，从 ThreadLocal 获取连接，但永远不要关闭它。请求后，在过滤器中，关闭连接。

# sharepoint - 逃离 SharePoint

> ID：120949
> 
> 赞同：6
> 
> 时间：2008-09-23T13:23:34.547
> 
> 标签：sharepoint

你们有没有人尝试过从共享点运行？我已经与 sharepoint 合作过，足以知道这不是我感兴趣的东西。我的兴趣更多的是 API / 后端 / 分布式开发。作为顾问，你们中的任何人有没有找到摆脱共享点并继续学习其他感兴趣的东西的方法？我目前处于共享点需求量很大的位置，我无法找到一种方法来简单地避开它。有什么建议么 ？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T13:53:29.577

如果我正确地推断出您在一家咨询公司工作，那么请找出您的公司还从事哪些其他类型的工作。比目前为您的公司工作的人更好地了解这些技术，让您自己参与这些项目，即使只是以走廊谈话的方式，并为您的公司正在解决的问题提出更好（更快、更便宜）的解决方案。

你的选择似乎真的是 3 倍

1.  说服你的老板你的才能会更好地用在其他地方
2.  说服你的同事他们希望你加入其他团队
3.  说服您公司的客户，他们特别需要您。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-23T13:27:50.120

学习 Java 或 Ruby。

Microsoft 的“附加”销售模式，他们销售由多种技术组成的解决方案，然后销售下一个解决方案，基础是“你已经投资了 SharePoint，所以你已经具备了适用于这个新位的技能和基础设施“我们拥有的技术”将继续存在……它非常成功。

SharePoint 是面向拥有 MS 商店的企业的云计算……您可以通过不使用 C# 来避免它。如果您正在使用 C#，那么如果有足够的时间，您的应用程序将需要在企业云中运行，您应该通过拥抱它来维护您的职业生涯。

只是我的2p。抱歉，如果这不是您想要的答案。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-04-06T14:49:19.493

我确切地知道你的意思。我认为您不介意像 SharePoint 这样的产品背后的想法，但真的讨厌它的实施方式以及它存在的问题。我知道这是一场噩梦。

作为一名 C# 开发人员，当我听到 SharePoint 一词时，我感到畏缩，SharePoint 就是伏地魔。但不幸的是，它伴随着作为高级 C# / Microsoft 开发人员的工作。

我说很遗憾，因为如果您迟早在公司结构中工作，您最终可能会在您的解决方案中使用 SharePoint。不是因为它好，而是因为正如其他人所说 - MS 使用 SharePoint 作为特洛伊木马来获取和保持业务。

新版 SharePoint (2010) 的问世可能会有一些希望。也许这最终会包括一个更好的编程/实现模型。

否则，要么为较小的公司工作（通常薪水较低，但并非总是如此），要么尽可能降低您作为 MOSS 开发人员的技能。除非您的薪水取决于此，否则切勿积极推销它们。从您的技能矩阵中删除该技能，并拒绝完全专注于 MOSS 的工作。您可以在这里和那里进行一些 MOSS 集成。一个专注于 MOSS 的完整解决方案会让你发疯。

如果一切都失败了，学习其他非 Microsoft 语言，并且在一两年内，SharePoint 将只是一个褪色的记忆。

我认识很多因为 SharePoint 而考虑退出 IT 的开发人员。我想说不要让它成为你职业生涯的终结。

最后，你会抱怨和抱怨，并每周/每天通知经理你为什么要在 SharePoint 中战斗。让他们知道，并不断提醒他们这是一项多么糟糕的技术。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-23T13:35:06.157

当生活给你柠檬。做柠檬水。

说真的，如果您看到 SharePoint 的需求如此之高，那么与野兽合作也许是最好的主意。SharePoint 实际上只是中间件。SharePoint 可以简单地成为您的解决方案的分发点（即，可以通过 Web 内容部分在 SharePoint 上托管诸如 Web 应用程序之类的用户界面）。如果您仔细观察，SharePoint 甚至可以作为文档存储库或小规模数据存储以列表的形式被证明是有用的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-23T13:31:06.477

也许您应该拒绝 SharePoint 合同并接受您感兴趣的合同。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-23T14:05:13.820

根据您所处的市场，您可以简单地告诉您在咨询公司工作的老板，您不再对做 Sharepoint 项目感兴趣，如果他们继续让您参与 Sharepoint 项目，您将被迫寻找其他地方。这将在开发商需求高而供应低于标准的西密歇根附近工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-17T03:29:01.630

另一方面，我刚刚开始使用 SharePoint 来扩展我目前无聊的纯 C# 项目。我开始将它用作分布式和复杂系统的前端：简单的配置和定制、报告、管理、系统控制 - 看起来所有这些都在这个包中可用，它很容易制作，非用户也可以使用技术人员和初学者。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-04-06T19:43:07.353

我个人不想再使用 SharePoint。我一直致力于为它开发一个解决方案，甚至完全负责它的网络集成。我讨厌它。

首先，您必须掌握糟糕的编程模型，然后处理所有部署，这甚至还不是开始。如果您正在为 SharePoint 开发产品，则必须调试软件本身，这本身就是一项壮举。

我对此的解决方案是对此非常坦率。我不介意进行知识转移和帮助他人，但我不想开发/部署 SharePoint 应用程序。

我的老板明白了，我的朋友明白了。

我们最新的笑话来自几个月前有人说“使用 SharePoint 部署应用程序既简单又快速”。笑话？“他是否只是将简单/快速放在与 SharePoint 相同的句子中？”

所以除非你的薪水会因此而降低......淡化你的技能并坦诚面对你的老板。:)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-08-26T22:18:47.790

你看过 Alfresco ( [http://alfresco.com](http://alfresco.com) ) 吗？

它有许多与 SharePoint 相同的用途，但它是通过开源 J2EE 应用程序来实现的。它将利用您现有的协作/内容管理经验，让您接触到一大堆开源技术。

全面披露：我为 Alfresco 工作。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-02-28T13:01:45.917

我已经将这个建议提供给了另一个人...从 SharePoint 运行不会很困难，因为根据它们的结构，技术彼此相似。SharePoint 并不是最糟糕的技术，尽管它在某些方面受到限制……幸运的是，软件领域太广了，不怕找不到任何你感兴趣的东西。

# python - 如何在 python 中规范化 URL

> ID：120951
> 
> 赞同：74
> 
> 时间：2008-09-23T13:23:50.100
> 
> 标签：python, url, normalization, normalize

我想知道我是否在 python 中规范化 URL。

例如，如果我有一个 url 字符串，例如：“ [http://www.example.com/foo](http://www.example.com/foo) goo/bar.html”

我需要一个 python 库，它将额外的空间（或任何其他非规范化字符）转换为正确的 URL。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-09-23T13:33:06.940

看看这个模块：[werkzeug.utils](https://github.com/pallets/werkzeug/blob/master/src/werkzeug/urls.py)。（现在在`werkzeug.urls`）

您要查找的函数称为“url_fix”，其工作原理如下：

```
>>> from werkzeug.urls import url_fix
>>> url_fix(u'http://de.wikipedia.org/wiki/Elf (Begriffsklärung)')
'http://de.wikipedia.org/wiki/Elf%20%28Begriffskl%C3%A4rung%29' 
```

它在 Werkzeug 中实现如下：

```
import urllib
import urlparse

def url_fix(s, charset='utf-8'):
    """Sometimes you get an URL by a user that just isn't a real
    URL because it contains unsafe characters like ' ' and so on.  This
    function can fix some of the problems in a similar way browsers
    handle data entered by the user:

    >>> url_fix(u'http://de.wikipedia.org/wiki/Elf (Begriffsklärung)')
    'http://de.wikipedia.org/wiki/Elf%20%28Begriffskl%C3%A4rung%29'

    :param charset: The target charset for the URL if the url was
                    given as unicode string.
    """
    if isinstance(s, unicode):
        s = s.encode(charset, 'ignore')
    scheme, netloc, path, qs, anchor = urlparse.urlsplit(s)
    path = urllib.quote(path, '/%')
    qs = urllib.quote_plus(qs, ':&=')
    return urlparse.urlunsplit((scheme, netloc, path, qs, anchor)) 
```

* * *

## 回答 #2

> 赞同：58
> 
> 时间：2009-05-10T16:15:40.697

[Python 2.7 中针对该问题的真正修复](http://svn.python.org/view/python/trunk/Lib/urllib.py?r1=71780&r2=71779&pathrev=71780)

正确的解决方案是：

```
 # percent encode url, fixing lame server errors for e.g, like space
 # within url paths.
 fullurl = quote(fullurl, safe="%/:=&?~#+!$,;'@()*[]") 
```

有关更多信息，请参阅[Issue918368：“urllib 不正确服务器返回的 url”](http://bugs.python.org/issue918368)

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-09-23T13:26:16.973

使用`urllib.quote`或`urllib.quote_plus`

从[urllib 文档](http://docs.python.org/lib/module-urllib.html)：

> **报价（字符串[，安全]）**
> 
> 使用“%xx”转义替换字符串中的特殊字符。从不引用字母、数字和字符“_.-”。可选的安全参数指定不应被引用的附加字符——它的默认值为'/'。
> 
> 示例：`quote('/~connolly/')`产量`'/%7econnolly/'`。
> 
> **报价加（字符串[，安全]）**
> 
> 与 quote() 类似，但也根据引用 HTML 表单值的要求，用加号替换空格。原始字符串中的加号将被转义，除非它们包含在安全中。它也没有安全的默认值'/'。

编辑：在整个 URL 上使用 urllib.quote 或 urllib.quote_plus 会破坏它，正如@ΤZΩΤZΙΟΥ 指出的那样：

```
>>> quoted_url = urllib.quote('http://www.example.com/foo goo/bar.html')
>>> quoted_url
'http%3A//www.example.com/foo%20goo/bar.html'
>>> urllib2.urlopen(quoted_url)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "c:\python25\lib\urllib2.py", line 124, in urlopen
    return _opener.open(url, data)
  File "c:\python25\lib\urllib2.py", line 373, in open
    protocol = req.get_type()
  File "c:\python25\lib\urllib2.py", line 244, in get_type
    raise ValueError, "unknown url type: %s" % self.__original
ValueError: unknown url type: http%3A//www.example.com/foo%20goo/bar.html 
```

@ΤZΩΤZΙΟΥ 提供了一个函数，该函数使用[urlparse.urlparse 和 urlparse.urlunparse](http://docs.python.org/lib/module-urlparse.html)来解析 url 并且只对路径进行编码。这可能对您更有用，尽管如果您从已知协议和主机构建 URL 但路径可疑，您可能也可以避免 urlparse 并仅引用 URL 的可疑部分，并连接已知的安全部件。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-06-07T16:35:25.343

因为这个页面是关于这个主题的谷歌搜索的顶级结果，我认为值得一提的是，在使用 Python 进行的 URL 规范化方面所做的一些工作超出了对空格字符进行 urlencoding 的处理。例如，处理默认端口、字符大小写、缺少尾部斜杠等。

在开发 Atom 联合格式时，有一些关于如何将 URL 标准化为规范格式的讨论；这在 Atom/Pie wiki 上的文章[PaceCanonicalIds中有记录。](http://www.intertwingly.net/wiki/pie/PaceCanonicalIds)那篇文章提供了一些很好的测试用例。

我相信这次讨论的一个结果是 Mark Nottingham 的[urlnorm.py](http://www.mnot.net/python/urlnorm.py)库，我在几个项目中使用它并取得了很好的效果。但是，该脚本不适用于此问题中给出的 URL。因此，更好的选择可能是[Sam Ruby 的 urlnorm.py 版本](http://intertwingly.net/blog/2004/08/04/Urlnorm)，它处理该 URL，以及来自 Atom wiki 的所有上述测试用例。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2008-09-23T13:25:01.767

### py3

```
from urllib.parse import urlparse, urlunparse, quote
def myquote(url):
    parts = urlparse(url)
    return urlunparse(parts._replace(path=quote(parts.path)))

>>> myquote('https://www.example.com/~user/with space/index.html?a=1&b=2')
'https://www.example.com/~user/with%20space/index.html?a=1&b=2' 
```

### py2

```
import urlparse, urllib
def myquote(url):
    parts = urlparse.urlparse(url)
    return urlparse.urlunparse(parts[:2] + (urllib.quote(parts[2]),) + parts[3:])

>>> myquote('https://www.example.com/~user/with space/index.html?a=1&b=2')
'https://www.example.com/%7Euser/with%20space/index.html?a=1&b=2' 
```

这仅引用路径组件。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-12-16T03:43:51.860

仅供参考，urlnorm 已移至 github： [http ://gist.github.com/246089](http://gist.github.com/246089)

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2017-03-05T15:12:43.023

适用于 Python 3.5：

```
import urllib.parse

urllib.parse.quote([your_url], "\./_-:") 
```

例子：

```
import urllib.parse

print(urllib.parse.quote("http://www.example.com/foo goo/bar.html", "\./_-:")) 
```

输出将是[http://www.example.com/foo%20goo/bar.html](http://www.example.com/foo%20goo/bar.html)

字体：[https ://docs.python.org/3.5/library/urllib.parse.html?highlight=quote#urllib.parse.quote](https://docs.python.org/3.5/library/urllib.parse.html?highlight=quote#urllib.parse.quote)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-06-13T10:45:33.300

我遇到这样一个问题：只需要引用空格。

`fullurl = quote(fullurl, safe="%/:=&?~#+!$,;'@()*[]")`有帮助，但它太复杂了。

所以我用了一个简单的方法：`url = url.replace(' ', '%20')`，它并不完美，但它是最简单的方法，它适用于这种情况。

# sql - 存储过程；插入慢度

> ID：120952
> 
> 赞同：3
> 
> 时间：2008-09-23T13:23:55.760
> 
> 标签：sql, performance, stored-procedures

我有一个 SP 需要 10 秒运行大约 10 次（每次运行大约一秒）。平台是asp .net，服务器是SQL Server 2005。我已经对表进行了索引（也没有在PK上），这不是问题。一些警告：

*   usp_SaveKeyword 不是问题。我注释掉了整个 SP 并没有什么不同。
*   我将@SearchID 设置为1，时间大大减少，事务平均只需要大约15ms。
*   除了插入到 tblSearches 之外，我注释掉了整个存储过程，奇怪的是它需要更多的时间来执行。

对可能发生的事情有任何想法吗？

```
set ANSI_NULLS ON

go

ALTER PROCEDURE [dbo].[usp_NewSearch]

  @Keyword VARCHAR(50),

  @SessionID UNIQUEIDENTIFIER,

  @time SMALLDATETIME = NULL,

  @CityID INT = NULL

AS

BEGIN

  SET NOCOUNT ON;

  IF @time IS NULL SET @time = GETDATE();

  DECLARE @KeywordID INT;

  EXEC @KeywordID = usp_SaveKeyword @Keyword;

  PRINT 'KeywordID : '

  PRINT @KeywordID

  DECLARE @SearchID BIGINT;     

  SELECT TOP 1 @SearchID = SearchID

    FROM tblSearches 

   WHERE SessionID = @SessionID

     AND KeywordID = @KeywordID;

  IF @SearchID IS NULL BEGIN

        INSERT INTO tblSearches

              (KeywordID, [time], SessionID, CityID)

         VALUES

              (@KeywordID, @time, @SessionID, @CityID)

        SELECT Scope_Identity();

  END

  ELSE BEGIN

        SELECT @SearchID

  END

END 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-23T13:32:03.840

在 SQL Management Studio 中启用“显示估计的执行计划” - 执行计划在哪里显示您花费的时间？它将指导您使用启发式方法来优化查询（或者在这种情况下不是）。通常，“较胖”的行是需要关注的——它们会产生大量的 I/O。

不幸的是，即使您告诉我们表模式，也只有您才能真正看到 SQL 是如何选择优化查询的。最后一件事——你在 tblSearches 上有一个聚集索引吗？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-23T13:44:35.337

你为什么在这个查询中 使用`top 1 @SearchID`而不是`max (SearchID)`或？要求您运行查询并从结果集中检索第一行。如果结果集很大，则在获得最终结果集之前可能会消耗大量资源。`where exists``top`

```
SELECT TOP 1 @SearchID = SearchID    
  FROM tblSearches    
 WHERE SessionID = @SessionID     
   AND KeywordID = @KeywordID; 
```

我没有看到任何明显的原因 - 上述任何一种构造都应该通过非常便宜的索引查找为您提供语义上等效的东西。除非我错过了什么，否则你应该能够做类似的事情

```
select @SearchID = isnull (max (SearchID), -1)
  from tblSearches
 where SessionID = @SessionID
   and KeywordID = @KeywordID 
```

这应该是相当有效的并且（除非我遗漏了什么）在语义上是等效的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-23T13:26:41.700

触发器！

他们确实很阴险。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T13:51:03.310

1.  tblSearches 上的聚集索引是什么？如果聚集索引不在主键上，则数据库可能会花费大量时间重新排序。
2.  你还有多少其他索引？
3.  你有什么触发器吗？
4.  执行计划在哪里指示花费的时间？

# c++ - C++ 在嵌入式系统中的使用

> ID：120957
> 
> 赞同：26
> 
> 时间：2008-09-23T13:24:32.610
> 
> 标签：c++, embedded

在嵌入式系统中应该避免 C++ 的哪些特性？

请按原因对答案进行分类，例如：

*   内存使用情况
*   代码大小
*   速度
*   可移植性

编辑：让我们使用带有 64k ram 的 ARM7TDMI 作为目标来控制答案的范围。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-23T13:32:54.977

**RTTI 和异常处理：**

*   增加代码大小
*   降低性能
*   通常可以被更便宜的机制或更好的软件设计所取代。

**模板：**

*   如果代码大小是一个问题，请小心使用它们。如果您的目标 CPU 没有或只有非常小的指令缓存，它也可能会降低性能。（如果不小心使用，模板往往会使代码膨胀）。Otoh 聪明的元编程也可以减少代码大小。他没有明确的答案。

**虚函数和继承：**

*   这些对我来说很好。我几乎所有的嵌入式代码都是用 C 编写的。这并没有阻止我使用函数指针表来模拟虚函数。它们从未成为性能问题。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-23T15:22:24.760

选择避免某些功能应始终通过对软件行为的定量分析来驱动*，*在*您的*硬件上，使用*您选择的工具链，在**您的*领域需要的约束下。C++ 开发中有很多基于迷信和古代历史而不是硬数据的传统智慧“不要做”。不幸的是，这通常会导致编写大量额外的解决方法代码，以避免使用某些人在某个地方曾经遇到过问题的功能。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-09-23T13:26:39.280

例外可能是要避免什么的最常见答案。大多数实现具有相当大的静态内存成本或运行时内存成本。他们还倾向于使实时保证更加困难。

[在此处](http://www.research.att.com/~bs/JSF-AV-rules.pdf)查找为嵌入式 c++ 编写的编码标准的一个很好的示例。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-24T22:57:25.530

这是早期[嵌入式 C++ 标准的基本](http://www.caravan.net/ec2plus/index.html)[原理的有趣读物](http://www.caravan.net/ec2plus/rationale.html)

请参阅[这篇](http://www.embedded.com/97/feat9712.htm)关于 EC++ 的文章。

Embedded C++ std 是 C++ 的一个真子集，即它没有添加。删除了以下语言功能：

*   多重继承
*   虚拟基类
*   运行时类型信息（typeid）
*   新样式转换（static_cast、dynamic_cast、reinterpret_cast 和 const_cast）
*   可变类型限定符
*   命名空间
*   例外
*   模板

Bjarne Stroustrup在[wiki 页面](http://en.wikipedia.org/wiki/Embedded_C%2B%2B)上指出（关于 EC++ 标准），“据我所知，EC++ 已死（2004 年），如果不是，它应该是。” Stroustrup 继续推荐Prakash 的回答所引用的[文档。](http://www.research.att.com/~bs/JSF-AV-rules.pdf)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-23T15:42:10.780

使用 ARM7 并假设您没有外部 MMU，动态内存分配问题可能更难调试。我会在指南列表中添加“明智地使用 new / delete / free / malloc”。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-24T04:40:00.240

如果您使用的是 ARM7TDMI，请**不惜一切代价****避免[未对齐的内存访问](http://www.arm.com/support/faqdev/1228.html)**。

基本的 ARM7TDMI 内核没有对齐检查，并且在您进行未对齐读取时将返回旋转数据。一些实现具有用于引发异常的附加电路`ABORT`，但如果您没有这些实现之一，则发现由于未对齐访问而导致的错误是非常痛苦的。

例子：

```
const char x[] = "ARM7TDMI";
unsigned int y = *reinterpret_cast<const unsigned int*>(&x[3]);
printf("%c%c%c%c\n", y, y>>8, y>>16, y>>24); 
```

*   在 x86/x64 CPU 上，这会打印“7TDM”。
*   在 SPARC CPU 上，这会以总线错误转储内核。
*   在 ARM7TDMI CPU 上，这可能会打印类似“7ARM”或“ITDM”的内容，假设变量“x”在 32 位边界上对齐（这取决于“x”的位置以及正在使用的编译器选项等）并且您使用的是小端模式。这是未定义的行为，但几乎可以保证不会按照您想要的方式工作。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-24T23:41:11.823

在大多数系统中，您不想使用*new* / *delete*，除非您使用自己的实现覆盖它们，该实现从您自己的托管堆中提取。是的，它会起作用，但你正在处理一个内存受限的系统。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-23T13:33:00.390

我不会说这有一个硬性规定。这在很大程度上取决于您的应用程序。嵌入式系统通常是：

*   他们可用的内存量受到更多限制
*   通常在较慢的硬件上运行
*   倾向于更接近硬件，即以某种方式驱动它，比如摆弄寄存器设置。

就像任何其他开发一样，您应该平衡您提到的所有要点与您给出/派生的要求。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-23T15:13:31.410

关于代码膨胀，我认为罪魁祸首更有可能是*内联*而不是模板。

例如：

```
// foo.h
template <typename T> void foo () { /* some relatively large definition */ }

// b1.cc
#include "foo.h"
void b1 () { foo<int> (); }

// b2.cc
#include "foo.h"
void b2 () { foo<int> (); }

// b3.cc
#include "foo.h"
void b3 () { foo<int> (); } 
```

链接器很可能会将“foo”的所有定义合并到一个翻译单元中。因此，'foo' 的大小与任何其他命名空间函数的大小没有什么不同。

如果您的链接器不这样做，那么您可以使用显式实例化为您执行此操作：

```
// foo.h
template <typename T> void foo ();

// foo.cc
#include "foo.h"
template <typename T> void foo () { /* some relatively large definition */ }
template void foo<int> ();        // Definition of 'foo<int>' only in this TU

// b1.cc
#include "foo.h"
void b1 () { foo<int> (); }

// b2.cc
#include "foo.h"
void b2 () { foo<int> (); }

// b3.cc
#include "foo.h"
void b3 () { foo<int> (); } 
```

现在考虑以下几点：

```
// foo.h
inline void foo () { /* some relatively large definition */ }

// b1.cc
#include "foo.h"
void b1 () { foo (); }

// b2.cc
#include "foo.h"
void b2 () { foo (); }

// b3.cc
#include "foo.h"
void b3 () { foo (); } 
```

如果编译器决定为你内联'foo'，那么你最终会得到3个不同的'foo'副本。看不到模板！

**编辑：** 来自 InSciTek Jeff 的上述评论

对您知道将仅使用的函数使用显式实例化，您还可以确保删除所有未使用的函数（与非模板情况相比，这实际上可以减少代码大小）：

```
// a.h
template <typename T>
class A
{
public:
  void f1(); // will be called 
  void f2(); // will be called 
  void f3(); // is never called
}

// a.cc
#include "a.h"

template <typename T>
void A<T>::f1 () { /* ... */ }

template <typename T>
void A<T>::f2 () { /* ... */ }

template <typename T>
void A<T>::f3 () { /* ... */ }

template void A<int>::f1 ();
template void A<int>::f2 (); 
```

除非您的工具链完全损坏，否则上述代码只会为“f1”和“f2”生成代码。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-24T09:05:05.033

时间函数通常依赖于操作系统（除非你重写它们）。使用您自己的函数（尤其是如果您有 RTC）

只要您有足够的代码空间，模板就可以使用 - 否则不要使用它们

异常也不是很便携

**不**写入缓冲区的printf 函数不可移植（您需要以某种方式连接到文件系统才能使用 printf 写入 FILE*）。只使用 sprintf、snprintf 和 str* 函数（strcat、strlen），当然还有它们的宽字符对应函数（wcslen...）。

如果速度是问题，也许你应该使用你自己的容器而不是 STL（例如 std::map 容器来确保一个键是相等的，用 'less' 运算符进行**2 次（是 2 次）**比较（ a [less b == false && b [小于] a == false mean a == b)。'less' 是 std::map 类接收的唯一比较参数（而且不仅如此）。这可能会导致一些性能损失在关键的例程中。

模板，异常正在增加代码大小（您可以确定这一点）。有时，当代码较大时，甚至性能也会受到影响。

内存分配函数可能也需要重写，因为它们在很多方面都依赖于操作系统（尤其是在处理线程安全内存分配时）。

malloc 使用 _end 变量（通常在链接描述文件中声明）来分配内存，但这在“未知”环境中不是线程安全的。

有时您应该使用[Thumb](http://en.wikipedia.org/wiki/ARM_architecture#Thumb)而不是 Arm 模式。它可以提高性能。

因此，对于 64k 内存，我会说具有一些不错的特性（STL、异常等）的 C++ 可能是矫枉过正。我肯定会选C。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-10-10T08:58:26.397

在使用了 GCC ARM 编译器和 ARM 自己的 SDT 之后，我有以下评论：

*   The ARM SDT produces tighter, faster code but is *very* expensive (>Eur5k per seat!). At my previous job we used this compiler and it was ok.

*   The GCC ARM tools works very well though and it's what I use on my own projects (GBA/DS).

*   Use 'thumb' mode as this reduces code size significantly. On 16 bit bus variants of the ARM (such as the GBA) there is also a speed advantage.

*   64k is seriously small for C++ development. I'd use C & Assembler in that environment.

On such a small platform you'll have to be careful of stack usage. Avoid recursion, large automatic (local) data structures etc. Heap usage will also be an issue (new, malloc etc). C will give you more control of these issues.

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-23T13:41:44.860

如果您正在使用针对嵌入式开发或特定嵌入式系统的开发环境，它应该已经限制了您的一些选项。根据您的目标的资源能力，它将关闭一些上述项目（RTTI、异常等）。这是更容易走的路，而不是记住什么会增加大小或内存需求（尽管，无论如何你应该在心理上了解这一点）。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-23T13:42:47.167

对于嵌入式系统，您主要希望避免具有明确异常运行时成本的事情。一些示例：异常和[RTTI](http://en.wikipedia.org/wiki/RTTI)（包括[dynamic_cast](http://en.wikipedia.org/wiki/Dynamic_cast)和[typeid](http://en.wikipedia.org/wiki/Typeid)）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-23T13:55:54.157

确保您了解嵌入式平台的编译器支持哪些功能，并确保您了解平台的特性。例如，TI 的 CodeComposer 编译器不执行自动模板实例化。因此，如果要使用 STL 的排序，则需要手动实例化五个不同的东西。它也不支持流。

另一个例子是您可能正在使用一个 DSP 芯片，它没有硬件支持浮点运算。这意味着每次使用浮点数或双精度数时，您都需要支付函数调用的成本。

总而言之，了解有关嵌入式平台和编译器的所有信息，然后您就会知道要避免哪些功能。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-09-23T19:18:53.520

ATMega GCC 3.something 让我感到惊讶的一个特殊问题是：当我在我的一个类中添加一个虚拟 ember 函数时，我必须添加一个虚拟析构函数。此时，链接器要求操作符 delete(void *)。我不知道为什么会发生这种情况，并且为该运算符添加一个空定义解决了这个问题。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-24T08:47:17.570

请注意，异常的成本取决于您的代码。在我分析的一个应用程序（ARM968 上的一个相对较小的应用程序）中，异常支持增加了 2% 的执行时间，并且代码大小增加了 9.5 KB。在这个应用程序中，只有在发生严重错误的情况下才会抛出异常——即在实践中从未发生过——这使得执行时间开销非常低。

# asp.net - ASP.NET 使用哪种搜索技术？

> ID：120965
> 
> 赞同：8
> 
> 时间：2008-09-23T13:25:39.313
> 
> 标签：asp.net, search, full-text-search, lucene

在网站上提供搜索工具的首选方法是什么？目前我更喜欢使用[Lucene.net](http://incubator.apache.org/lucene.net/ "Lucene.net")而不是索引服务/SQL Server 全文搜索（因为没有什么可以设置服务器端），但是还有哪些其他方法正在使用呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-23T13:32:16.600

我们同时使用了 Lucene.net、索引服务和 SQL Server 全文。对于具有大型和重型数据库搜索功能的项目，SQL 搜索在性能/资源命中方面具有优势。否则 Lucene 在各方面都要好得多。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-23T14:03:41.593

看看[Solr](http://lucene.apache.org/solr/ "索尔")。它使用 Lucene 进行文本索引，但它是一个完整的 http 服务器，因此您可以通过 http 发布文档并使用 url 进行搜索。最好的部分是它为您提供了开箱即用的多面搜索，如果您自己做这将需要大量工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T13:30:10.597

您可以使用 google，它不会是最快的索引器，但是当您没有预算时，它确实提供了很好的结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T13:31:40.080

dtSearch 是我们经常使用的一个，但我并不是很喜欢它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-23T13:32:15.103

现在很多人都在使用谷歌的自定义搜索。甚至我认识的几家银行都将它用于他们的 Intranet。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-23T13:47:35.610

如果您需要索引您网站的所有页面（不仅仅是 Google 索引的页面），或者如果您想为您的 Intranet 网站创建搜索，[Google Mini](http://www.google.com/enterprise/mini/index.html)非常适合。这将花费您一些钱，但在几个小时内启动并运行它真的很容易。但是，根据您需要索引多少页，它可能会很昂贵。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-11-14T21:02:52.583

我正在使用**dtSearch**，我（有点）喜欢它。对于 .NET，API 并不是世界上最好的，但它可以完成工作，而且速度非常快。而且它很便宜，所以你的老板会喜欢它（约 1,000 美元）。

结果留下了一些不足之处，因为它没有做任何类型的语义相关性排名或任何花哨的事情。不过，它比您从 MS SQL 服务器中获得的任何东西都做得更好。

它有一个网络蜘蛛，可以很容易地在网站上进行快速搜索应用程序。如果需要，您可以使用 API 在数据库中创建挂钩并提供项目级别的安全性 - 但您必须自己完成工作。他们的论坛也有一些不足之处，但也许人们会开始在这里发布 dtSearch 的东西。:)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-02T20:06:24.500

有没有人试过微软搜索服务器快递？

[http://www.microsoft.com/enterprisesearch/serverproducts/searchserverexpress/default.aspx](http://www.microsoft.com/enterprisesearch/serverproducts/searchserverexpress/default.aspx)

我还没有尝试过，但它可能很强大。

从网站上看，它主要面向 sharepoint 用户，但考虑到它的 sdk，我不明白为什么你不能将它用于常规的旧网站搜索

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-10-30T15:40:46.093

我也推荐 SOLR。它易于设置、维护和配置。我发现它稳定且易于扩展。有用于与 solr 接口的 ac# 包。

# sql - 为什么即使不应该执行 T-SQL 块也会给出错误？

> ID：120966
> 
> 赞同：5
> 
> 时间：2008-09-23T13:25:40.623
> 
> 标签：sql, tsql

我正在编写一个（看似）直截了当的 SQL 片段，它在确保列存在后删除一列。
问题：如果该列不存在，IF 子句中的代码*会*抱怨它找不到该列！嗯，*doh*，这就是为什么它在 IF 子句中！
所以我的问题是，为什么一段不应该执行的代码会出错？

这是片段：

```
IF exists (select * from syscolumns
    WHERE id=object_id('Table_MD') and name='timeout')
BEGIN
    ALTER TABLE [dbo].[Table_MD]
        DROP COLUMN timeout
END
GO 
```

...这是错误：

`Error executing SQL script [...]. Invalid column name 'timeout'`

我正在使用 Microsoft SQL Server 2005 Express Edition。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-23T13:28:21.727

```
IF exists (select * from syscolumns
    WHERE id=object_id('Table_MD') and name='timeout')
BEGIN
    DECLARE @SQL nvarchar(1000)
    SET @SQL = N'ALTER TABLE [dbo].[Table_MD] DROP COLUMN timeout'
    EXEC sp_executesql @SQL
END
GO 
```

原因：当 Sql server 编译代码时，他们会检查它是否有使用的对象（如果它们存在）。此检查过程忽略任何“IF”、“WHILE”等结构，并简单地检查代码中所有使用的对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-23T13:26:46.177

它可能永远不会被执行，但它会被 Sql Server 解析为有效性。“解决”这个问题的唯一方法是构造一个动态 sql 块，然后有选择地执行它

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-23T13:42:02.550

这是我如何让它工作的：

在 IF 子句中，我将`ALTER ... DROP ...`命令更改为`exec ('ALTER ... DROP ...')`

似乎 SQL 服务器在解析代码时对代码进行了有效性检查，并发现在某处引用了一个不存在的列（即使该段代码永远不会被执行）。
使用该`exec(ute)`命令将有问题的代码包装在一个字符串中，解析器不会抱怨，并且代码只会在必要时执行。这是修改后的片段：

```
IF exists (select * from syscolumns
    WHERE id=object_id('Table_MD') and name='timeout')
BEGIN
    exec ('ALTER TABLE [dbo].[Table_MD] DROP COLUMN timeout')
END
GO 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-23T14:06:07.453

顺便说一句，Oracle 中存在类似的问题，并且使用“立即执行”子句的类似解决方法。

# php - Is there a PHP security framework that protects phone numbers as well as passwords?

> ID：120977
> 
> 赞同：1
> 
> 时间：2008-09-23T13:27:01.073
> 
> 标签：php, security, sms, spam-prevention

I understand the mantra of "don't roll your own" when it comes to site security frameworks.

For most cases anyway.

I'm going to be collaborating on a site that integrates text-messaging into the system.

I'd like to use an existing, well-tested security framework to protect the users data, but I need it to also protect a users phone number as well.

I wouldn't want to be the one responsible for a list of users cell phone numbers getting jacked and spammed.

What suggestions can the community offer?

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-23T13:46:21.747

Note that techniques applied to passwords aren't applicable here. You can store a password salted and hashed (although the value of doing so can be disputed), but that doesn't work for phone numbers.

If someone jacks your server, they can do anything the server can. This must include recovering the phone number, but doesn't include recovering the password if it's hashed well. So the phone number is just a particular case of protecting confidential data.

If phone nos truly are the only sensitive data in the app, then you could look at walling off the part of the app that sends the texts, and asymmetrically encrypting the phone nos. In a different process (or on a different machine) run an app that has the key to decrypt phone nos. This app's interface would have maybe one function taking an encrypted no and the message to send. Keep this app simple, and test and audit the snot out of it. Either hide it from the outside world, or use authentication to prove the request really came from your main app, or both.

Neither the db nor the main part of the app is capable of decrypting phone nos (so for example you can't search on them), but they can encrypt them for addition to the db.

The general technique is called "Privilege separation", the above is just one example.

Note that phone nos would generally need to be padded with random data before encryption (like salting a hashed password). Otherwise it's possible to answer the question "is the encrypted phone number X?", without knowing the private key. That may not be a problem from the POV of spammers stealing your distribution list, but it is a problem from the POV of claiming that your phone numbers are securely stored, since it means a brute force attack becomes feasible: there are only a few billion phone nos, and it may be possible to narrow that down massively for a given user.

Sorry this doesn't directly answer your question: I don't know whether there's a PHP framework which will help implement privilege separation.

[Edit to add: in fact, it occurs to me that under the heading of 'keep the privileged app simple', you might not want to use a framework at all. It sort of depends whether you think you're more or less likely leave bugs in the small amount of code you really need, than the framework authors are to have left bugs in the much larger (but more widely used) amount of code they've written. But that's a huge over-simplification.]

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-23T13:42:22.300

Since you need to be able to retrieve the phone numbers, the only thing you can really do to protect them (beyond the normal things you would do to protecting your db) is encrypt them. This means that you need to:

*   Make sure the key doesn't leak when you inadvertently leak a database dump.
*   Make sure your system doesn't helpfully decrypt the phone numbers when someone manages to SQL inject your system.

Of course the recommendation of not rolling your own still applies, use AES or some other well respected cipher with a reasonable key length.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-03T19:06:25.017

I’m pleased to announce the release of hole-security system for PHP

This project stands for bring to PHP the kind of security that is provided in Java by Spring Security the formerly Acegi Security System for Spring. It’s designed to be attractive to Spring Security users because the philosophy is the same. It’s an unobtrusive way to add security to a PHP site. The configuration is made using substrate IoC/DI as Spring Security use Spring IoC/DI.

An example configuration ship with the framework and can be used like this:

```
$context = new substrate_Context(
    './path/to/hole-security/hole-security-config.php'
);

$context->execute();

$hole_Security = $context->get('hole_FilterChainProxy' );
$hole_Security->doFilter(); 
```

Just be sure that the bootstrap code of the framework is executed before the bootstrap of the MVC of your choice.

WebSite: [http://code.google.com/p/hole-security/](http://code.google.com/p/hole-security/)

Documentation: For the moment you can use reference documentation of Spring Security where it’s apply. You can get a general idea using the Acegi Security reference documentation because hole-security use the same way of configuration, but keep in mind that it’s based on Spring Security.

License: It’s released under Apache License Version 2.0.

Features: hole-security brings an pluggable security system where you can adopt the security requirement of your environment. Currently there is a very simple security system because it’s on the first release but with the base foundation that it brings you could suggest or request for new features to be added to the project.

**Currently Features:**

1.  In memory dao authentication as a proof of concept, you can switch to your preferred dao or implementation that get’s user data from database or wherever you store it. In futures release an PDO based implementation will be created.

2.  Configured filters for be applied to url patterns. Url path matcher can be plugged to, currently it ship with a ant styles path matcher.

3.  Authorization Manager can be used in your application to decide wherever or not do something, always obtaining the reference from the substrate context.

4.  Shared Security Context accessible from any code of your application if hole_HttpSessionContextIntegrationFilter is applied. You can use this context to save information related to the session without use the session object directly.

5.  You can use a custom login page and customize it according to the hole_AuthenticationProcessingFilter configuration, or customize hole_AuthenticationProcessingFilter according to your custom login page.

6.  The default password encoder is plain text, without encoding. Futures releases will have implementations for MD5, Sha based, Base64 and others related encoding. You can create your own password encoder and get configured.

7.  All the objects are loaded as required, if something like a filter it’s not used for a request would not be loaded. This increase the performance of the application There are others features related that hole-security have.

# c# - 自定义用户控件中的 ASP 嵌套标签

> ID：120997
> 
> 赞同：9
> 
> 时间：2008-09-23T13:30:23.530
> 
> 标签：c#, .net, asp.net, custom-server-controls

我刚刚开始使用 C# 中的自定义用户控件，我想知道是否有任何示例说明如何编写一个接受嵌套标签的示例？

例如，当您创建一个时，`asp:repeater`您可以为`itemtemplate`.

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-23T13:31:57.303

前段时间我写了[一篇关于这个的博客文章。](https://robertwray.co.uk/blog/describing-asp-net-control-properties-declaratively)简而言之，如果您有一个带有以下标记的控件：

```
<Abc:CustomControlUno runat="server" ID="Control1">
    <Children>
        <Abc:Control1Child IntegerProperty="1" />
    </Children>
</Abc:CustomControlUno> 
```

您需要控件中的代码符合以下要求：

```
[ParseChildren(true)]
[PersistChildren(true)]
[ToolboxData("<{0}:CustomControlUno runat=server></{0}:CustomControlUno>")]
public class CustomControlUno : WebControl, INamingContainer
{
    private Control1ChildrenCollection _children;

    [PersistenceMode(PersistenceMode.InnerProperty)]
    [DesignerSerializationVisibility(DesignerSerializationVisibility.Content)]
    public Control1ChildrenCollection Children
    {
        get
        {
            if (_children == null)
            {
                _children = new Control1ChildrenCollection();
            }
            return _children;
        }
    }
}

public class Control1ChildrenCollection : List<Control1Child>
{
}

public class Control1Child
{
    public int IntegerProperty { get; set; }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-07-09T06:54:43.063

我按照 Rob 的博客文章，做了一个稍微不同的控制。该控件是一个有条件的控件，实际上就像一个 if 子句：

```
<wc:PriceInfo runat="server" ID="PriceInfo">
    <IfDiscount>
        You don't have a discount.
    </IfDiscount>
    <IfNotDiscount>
        Lucky you, <b>you have a discount!</b>
    </IfNotDiscount>
</wc:PriceInfo> 
```

然后，在代码中，我`HasDiscount`将控件的属性设置为布尔值，它决定呈现哪个子句。

与 Rob 的解决方案的最大区别在于，控件中的子句确实可以包含任意 HTML/ASPX 代码。

这是控件的代码：

```
using System.ComponentModel;
using System.Web.UI;
using System.Web.UI.WebControls;

namespace WebUtilities
{
    [ToolboxData("<{0}:PriceInfo runat=server></{0}:PriceInfo>")]
    public class PriceInfo : WebControl, INamingContainer
    {
        private readonly Control ifDiscountControl = new Control();
        private readonly Control ifNotDiscountControl = new Control();

        public bool HasDiscount { get; set; }

        [PersistenceMode(PersistenceMode.InnerProperty)]
        [DesignerSerializationVisibility(DesignerSerializationVisibility.Content)]
        public Control IfDiscount
        {
            get { return ifDiscountControl; }
        }

        [PersistenceMode(PersistenceMode.InnerProperty)]
        [DesignerSerializationVisibility(DesignerSerializationVisibility.Content)]
        public Control IfNotDiscount
        {
            get { return ifNotDiscountControl; }
        }

        public override void RenderControl(HtmlTextWriter writer)
        {
            if (HasDiscount)
                ifDiscountControl.RenderControl(writer);
            else
                ifNotDiscountControl.RenderControl(writer);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-06-02T18:13:45.680

[我最终得到了与Rob](https://stackoverflow.com/a/121007/1037948)（在Wayback[存档](http://web.archive.org/web/20120912013710/http://www.robertwray.co.uk/blog/2008/02/describing-aspnet-control-properties-declaratively.html)中）[@gudmundur-h](https://stackoverflow.com/a/1102226/1037948)的答案非常相似的东西，但我曾经在使用`ITemplate`中摆脱了那个烦人的“你不能在 X 标签之间放置内容”。我不完全确定实际需要什么，所以一切都在这里以防万一。

## 部分/用户控件标记：`mycontrol.ascx`

注意重要的位： `plcChild1`和`plcChild2`。

```
<!-- markup, controls, etc -->
<div class="shell">
    <!-- etc -->

    <!-- optional content with default, will map to `ChildContentOne` -->
    <asp:PlaceHolder ID="plcChild1" runat="server">
        Some default content in the first child.
        Will show this unless overwritten.
        Include HTML, controls, whatever.
    </asp:PlaceHolder>

    <!-- etc -->

    <!-- optional content, no default, will map to `ChildContentTwo` -->
    <asp:PlaceHolder ID="plcChild2" runat="server"></asp:PlaceHolder>

</div> 
```

## 部分/用户控制代码隐藏：`mycontrol.ascx.cs`

```
[ParseChildren(true), PersistChildren(true)]
[ToolboxData(false /* don't care about drag-n-drop */)]
public partial class MyControlWithNestedContent: System.Web.UI.UserControl, INamingContainer {
    // expose properties as attributes, etc

    /// <summary>
    /// "attach" template to child controls
    /// </summary>
    /// <param name="template">the exposed markup "property"</param>
    /// <param name="control">the actual rendered control</param>
    protected virtual void attachContent(ITemplate template, Control control) {
        if(null != template) template.InstantiateIn(control);
    }

    [PersistenceMode(PersistenceMode.InnerProperty),
    DesignerSerializationVisibility(DesignerSerializationVisibility.Content)]
    public virtual ITemplate ChildContentOne { get; set; }

    [PersistenceMode(PersistenceMode.InnerProperty), DesignerSerializationVisibility(DesignerSerializationVisibility.Content)]
    public virtual ITemplate ChildContentTwo { get; set; }

    protected override void CreateChildControls() {
        // clear stuff, other setup, etc
        // needed?
        base.CreateChildControls();

        this.EnsureChildControls(); // cuz...we want them?

        // using the templates, set up the appropriate child controls
        attachContent(this.ChildContentOne, this.plcChild1);
        attachContent(this.ChildContentTwo, this.plcChild2);
    }
} 
```

重要位（？）：

*   `ParseChildren`- 所以东西[出现了](http://msdn.microsoft.com/en-us/library/aa310907(v=vs.71).aspx)？
*   `PersistChildren`- 所以动态创建的东西不会被重置？
*   `PersistenceMode(PersistenceMode.InnerProperty)`-- 所以控件被[正确解析](http://msdn.microsoft.com/en-us/library/aa479300.aspx#ccc-templ_topic7)
*   `DesignerSerializationVisibility(DesignerSerializationVisibility.Content)`——同上？

## 控制用途

```
<%@ Register Src="~/App_Controls/MyStuff/mycontrol.ascx" TagPrefix="me" TagName="MyNestedControl" %>

<me:MyNestedControl SomeProperty="foo" SomethingElse="bar" runat="server" ID="meWhatever">
    <%-- omit `ChildContentOne` to use default --%>
    <ChildContentTwo>Stuff at the bottom! (not empty anymore)</ChildContentTwo>
</me:MyNestedControl> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-23T13:34:00.527

我猜你正在寻找这样的东西？[http://msdn.microsoft.com/en-us/library/aa478964.aspx](http://msdn.microsoft.com/en-us/library/aa478964.aspx)

您的标签已被删除或不可见，因此无法真正帮助您。*******************