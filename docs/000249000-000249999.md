# StackOverflow 问答 000249000-000249999

# linq-to-sql - LINQ2SQL 数据库提供程序

> ID：249006
> 
> 赞同：1
> 
> 时间：2008-10-30T01:27:42.720
> 
> 标签：linq-to-sql

我听说 LINQ2SQL 已被编写为支持多个数据库供应商提供程序，但是出于 MS 的内部政治原因，仅支持 SQL Server。

这是对情况的公平总结吗？如果是，是否发布了时间表，说明何时支持其他数据库？

我知道 Matt Warren 在任性的博客上的[BUILDING AN IQUERYABLE PROVIDER](http://blogs.msdn.com/mattwar/archive/2007/07/30/linq-building-an-iqueryable-provider-part-i.aspx)系列，但我不希望现在构建一些稍后会发布的东西（可能比我会做的更好）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T01:40:56.920

检查[ADO.NET 实体框架](http://msdn.microsoft.com/en-us/library/aa697427(VS.80).aspx)（和[Linq to Entities](http://msdn.microsoft.com/en-us/library/bb386964.aspx)），您还可以在此处[查看 Oracle 的示例实体框架提供程序](http://code.msdn.microsoft.com/EFOracleProvider)，[这里](http://code.msdn.microsoft.com/adonetefx/)有更多关于为 EF 创建数据提供程序的示例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-11-05T21:40:10.690

实体框架支持多个数据库提供程序。没有计划公开或实施其他 LINQ to SQL 数据库提供程序。

# curly-braces - 您是否使用花括号进行额外的范围界定？

> ID：249009
> 
> 赞同：43
> 
> 时间：2008-10-30T01:29:42.153
> 
> 标签：curly-braces, scope, c++, java

我的意思是在函数、类、if、while、switch、try-catch 需要时使用它。

[在我看到这个 SO question 之前](https://stackoverflow.com/questions/241088/what-do-curly-braces-by-themselves-mean-in-java)，我不知道它可以这样做。

在上面的链接中，Eli 提到“他们使用它来将代码折叠在不属于通常会折叠的函数、类、循环等的逻辑部分中。”

除了上面提到的还有什么其他用途？

使用花括号来限制变量的范围并仅在需要时扩展范围是一个好主意（在“需要访问”的基础上工作）？还是真的很傻？

如何使用范围，以便您可以在不同的范围内使用相同的变量名，但在相同的更大范围内？或者重复使用相同的变量（如果你想使用相同的变量名）并节省解除分配和分配（我认为一些编译器可以对此进行优化？）是更好的做法吗？还是完全使用不同的变量名更好？

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-10-30T01:35:23.267

如果我正在使用我想在特定时间释放的资源，我会这样做，例如：

```
void myfunction()
{
  {
  // Open serial port
     SerialPort port("COM1", 9600);
     port.doTransfer(data);
  } // Serial port gets closed here.

  for(int i = 0; i < data.size(); i++)
     doProcessData(data[i]);
  etc...
} 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2008-10-30T01:34:55.640

出于几个原因，我不会为此使用花括号。

1.  如果您的特定功能足够大以至于您需要执行各种范围技巧，则可能会将功能分解为更小的子功能。

2.  引入大括号来重用变量名只会导致代码混乱和麻烦。

只是我的 2 美分，但我在其他最佳实践材料中看到了很多这类东西。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2008-10-30T01:40:20.120

**C++**：

有时你需要引入一个额外的大括号级别的范围来重用变量名，当这样做有意义时：

```
switch (x) {
    case 0:
        int i = 0;
        foo(i);
        break;
    case 1:
        int i = 1;
        bar(i);
        break;
} 
```

上面的代码无法编译。你需要做到：

```
switch (x) {
    case 0:
        {
            int i = 0;
            foo(i);
        }
        break;
    case 1:
        {
            int i = 1;
            bar(i);
        }
        break;
} 
```

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2008-10-30T13:25:24.410

我经常使用的最常见的“非标准”作用域使用是使用作用域互斥锁。

```
void MyClass::Somefun()
{
    //do some stuff
    {
        // example imlementation that has a mutex passed into a lock object:
        scopedMutex lockObject(m_mutex); 

        // protected code here

    } // mutex is unlocked here
    // more code here
} 
```

这有很多好处，但最重要的是，即使在受保护的代码中抛出异常，锁也会一直被清除。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-10-30T13:34:25.297

正如其他人所说，最常见的用途是确保析构函数在您需要时运行。它还有助于使特定于平台的代码更加清晰：

```
#if defined( UNIX )
    if( some unix-specific condition )
#endif
    {
        // This code should always run on Windows but 
        // only if the above condition holds on unix
    } 
```

为 Windows 构建的代码看不到 if，只有大括号。这比：

```
#if defined( UNIX )
    if( some unix-specific condition ) {
#endif
        // This code should always run on Windows but 
        // only if the above condition holds on unix
#if defined( UNIX )
    }
#endif 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-30T01:36:04.497

它可以是代码生成器的福音。假设您有一个嵌入式 SQL (ESQL) 编译器；它可能希望将 SQL 语句转换为需要局部变量的代码块。通过使用块，它可以反复重用固定的变量名称，而不必创建具有单独名称的所有变量。当然，这不是太难，但比必要的难。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-10-30T01:56:53.690

正如其他人所说，由于功能强大的 RAII（资源获取是初始化）习语/模式，这在 C++ 中相当普遍。

对于 Java 程序员（也许还有 C#，我不知道）这将是一个陌生的概念，因为基于堆的对象和 GC 会杀死 RAII。恕我直言，能够将对象放入堆栈是 C++ 优于 Java 的最大单一优势，并且使编写良好的 C++ 代码比编​​写良好的 Java 代码更干净。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-10-30T01:36:54.887

我只在需要通过 RAII 释放某些东西时才使用它，即使那样，也只有在应该尽可能早地释放它时（例如释放锁）。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-11-01T20:21:35.267

用 Java 编程我经常想限制方法内的范围，但我从未想过要使用标签。由于我在使用它们作为中断目标时将标签大写，因此使用混合大小写标记的块就像您建议的那样，这正是我在这些场合想要的。

通常代码块太短而无法分解成一个小方法，而且通常是框架方法中的代码（如 startup() 或 shutdown()），实际上最好将代码放在一个方法中。

就我个人而言，我讨厌普通的浮动/悬空大括号（尽管那是因为我们是一家严格的横幅样式缩进店），我讨厌评论标记：

```
// yuk!
some code
{
scoped code
}
more code

// also yuk!
some code
/* do xyz */ {
    scoped code
    }
some more code

// this I like
some code
DoXyz: {
    scoped code
    }
some more code 
```

我们考虑使用“if(true) {”，因为 Java 规范明确指出这些将在编译中被优化（if(false) 的全部内容也将被优化 - 这是一个调试功能），但我讨厌在少数地方我尝试过这个。

所以我认为你的想法很好，一点也不傻。我一直认为我是唯一一个想做这件事的人。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-11-01T04:38:06.170

是的，我使用这种技术是因为 RAII。我也在纯**C**中使用这种技术，因为它使变量更接近。当然，我应该考虑更多地分解功能。

我做的一件可能在风格上引起争议的事情是将左花括号放在声明的行上或在其上放置评论。[我想减少浪费的垂直空间。这是基于 Google C++ Style Guide 推荐的。](http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml#Vertical_Whitespace).

```
/// c++ code
/// references to boost::test
BOOST_TEST_CASE( curly_brace )
{
  // init
  MyClass instance_to_test( "initial", TestCase::STUFF ); {
    instance_to_test.permutate(42u);
    instance_to_test.rotate_left_face();
    instance_to_test.top_gun();
  }
  { // test check
    const uint8_t kEXP_FAP_BOOST = 240u;
    BOOST_CHECK_EQUAL( instance_to_test.get_fap_boost(), kEXP_FAP_BOOST);
  }
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-30T01:51:37.680

我同意阿加茨克的观点。如果您觉得需要对较大的逻辑代码块进行分段以提高可读性，则应考虑重构以清理繁忙和杂乱的成员。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-30T02:38:17.477

它有它的位置，但我不认为这样做以便 $foo在同一函数或其他（逻辑，而不是词法）范围内可以是一个变量，而另一个变量在那里是一个*好*主意*。*尽管编译器可能完全理解这一点，但对于试图阅读代码的人类来说，这似乎太难了。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-09-03T17:27:42.290

我工作的公司有一个静态分析策略，可以将局部变量声明保持在函数的开头附近。很多时候，函数的第一行之后的用法是很多行，所以我无法在屏幕上同时看到声明和第一个引用。我为“规避”该政策所做的是将声明保持在引用附近，但通过使用花括号来提供额外的范围。虽然它增加了缩进，有些人可能会争辩说它使代码更难看。

# iphone - 如何使 UITableViewCellAccessoryDisclosureIndicator 在黑色背景中可见？

> ID：249010
> 
> 赞同：8
> 
> 时间：2008-10-30T01:31:14.243
> 
> 标签：iphone, cocoa-touch, uitableview

cell.accessoryType = UITableViewCellAccessoryDisclosureIndicator;

在这个方法中

```
- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath; 
```

但是我只能在选择该单元格时才能看到它，否则它是不可见的。当背景为白色时它可以完美地工作。我确定我需要设置一个属性，但我不知道我需要更改哪个属性才能使这个东西工作。

提前致谢。

干杯。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-08-08T21:28:53.517

我遇到了同样的问题，只需使用以下匆忙模拟的图形从 UIView 的 imageWithName @"AccDisclosure.png" 创建一个 UIImageView，您可以自由复制：[http ://thinkingman.com/db/downloads /AccDisclosure.png](http://thinkingman.com/db/downloads/AccDisclosure.png)（如果您只是单击该链接，您可能什么也看不到，因为它是具有透明背景的白色图像，但如果您保存它并在深色背景下查看，您将看到 alpha）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-30T02:48:18.843

似乎披露指示符是灰色的高 alpha 图像，因此将其覆盖在黑色背景上使其不可见。如果你想这样做，你需要将你自己的 UIImageView 添加到单元格的 contentView 中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-08T08:17:11.390

以下代码允许我在表格行中设置箭头提示的背景颜色：

```
@property (nonatomic,retain) UILabel *backgroundLabel;

UILabel *label = [[UILabel alloc] initWithFrame:CGRectZero];
label.backgroundColor = [UIColor orangeColor]; 
self.backgroundLabel = label;
[self.contentView addSubview:label];
[label release];

CGRect labelRect = CGRectOffset(contentRect,0, 0);
labelRect.size.height = contentRect.size.height - 1; // show white line
labelRect.size.width = contentRect.size.width + 50; // cover arrow tip background
backgroundLabel.frame = labelRect;    
backgroundLabel.highlightedTextColor = [UIColor whiteColor]; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-24T15:41:38.067

我做了一个解决方案，我以正常方式添加了一个带有 addSubView 的 ImageView，在附件出现的位置有一个不是黑色的图像（在我的情况下，是一个灰色的填充圆圈）。

这样可以看到箭头并且仍然具有深/黑色的表格单元格背景颜色。

也许不是最犹太的解决方案，但它使箭头可见，并且我在没有子类化或编写大量代码的情况下收到附件点击通知。

# multicore - 哪些应用领域受 CPU 限制，并且往往会从多核技术中受益？

> ID：249011
> 
> 赞同：5
> 
> 时间：2008-10-30T01:33:11.803
> 
> 标签：multicore

我听到很多人谈论由于多核处理器和并行性而在编程中即将到来的革命，但我无法摆脱对我们大多数人来说，CPU 周期不是瓶颈的感觉。很长一段时间以来，我几乎所有的程序都以一种或另一种方式（数据库、文件系统、网络、用户交互等）进行了 I/O 绑定。

现在我可以想到一些 CPU 周期是限制因素的领域，例如代码破解、图形、声音、某些形式的模拟（天气、物理等）以及某些形式的数学研究，但它们看起来都相当专门的应用领域。我的总体印象是，大多数程序仍然受 I/O 限制，而且对于我们大多数行业 CPU 来说已经有相当长的一段时间了。

我是不是摇摆不定？今天还有哪些其他应用程序领域受 CPU 限制？它们中的任何一个都包括编​​程人口的很大一部分吗？本质上，我想知道多核 CPU 是否会影响我们中的很多人，如果会，会如何？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T01:41:59.510

视觉效果/渲染。（娱乐业。）
人工智能。（游戏和科学研究。）
生物医学研究。
物理模拟。（游戏和科学研究。）
数据库应用包括SaaS、大多数网页等。

随着个人计算机越来越成为 Web 应用程序的基于浏览器的瘦客户端，这个行业将会扩大，并且需要更多的后端并行处理能力。我可以看到游戏推动个人计算中的并行处理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T01:41:21.477

利用多核的方法之一是使用远程桌面技术。

将桌面应用程序部署到一台大型 Citrix 服务器而不是数十个用户桌面上要容易得多。

# .net - 是否可以在 .NET 中在运行时修改方法体？

> ID：249021
> 
> 赞同：12
> 
> 时间：2008-10-30T01:38:45.163
> 
> 标签：.net, reflection, code-generation, types

我知道（理论上）可以在运行时创建新类型，但是是否可以在运行时修改现有类型的方法体？我的计划（如果我可以让它工作的话）是用自定义属性标记方法，然后在运行时搜索具有该属性的方法，并将我自己的一些代码插入到方法体中。

有什么建议么？

我想如果我不能让这种方法发挥作用，我总是可以使用基类中的虚拟方法（带有属性），结合静态工厂来使用我的运行时生成的方法生成派生的动态类型在儿童班。不过，这用起来不太干净。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-30T02:02:08.127

[PostSharp](http://www.postsharp.org/)是一个后编译器，与您描述的内容类似，使用属性在代码中标记注入点，唯一的区别是它在编译时执行。

但是您也可以在运行时执行此操作，而不是通过更改方法主体，而是使用派生自[ContextBoundObject](http://msdn.microsoft.com/en-us/library/system.contextboundobject.aspx)的类，这是一个 .Net 类，可让您拦截对其进行的所有调用。这是一篇[MSDN 杂志文章](http://msdn.microsoft.com/en-us/magazine/cc301356.aspx)，描述了如何使用 ContextBoundObject 进行 AOP。（检查文章*.Net*部分中的方面）

作为第三种选择，您可以将动态代码生成（Reflection.Emit 或 CodeDom）与属性和虚拟方法结合使用，以动态生成可以插入代码的派生类，但这是最痛苦的方法。

编辑：

还有第四个选项是使用[.Net 非托管分析 API](http://www.blong.com/Conferences/DCon2003/Internals/Profiling.htm#Docs)来拦截方法 JIT-ing 并在 JIT-ing 之前替换方法主体。JustMock (Telerik) 成功地使用这种技术来模拟、静态方法、非虚拟方法甚至密封类。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T01:49:31.287

您无法在运行时修改现有方法，但您可以使用 Code DOM 动态创建一个并执行该方法。或者，您可以将代码串连接在一起，然后在内存中编译并运行它。

我自己完成了后者（我允许在内存中编译和执行的自定义 C# 代码的应用程序，运行时）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T01:52:26.850

如果您希望在调用前或调用后添加方面，请查看 PostSharp：[http ://www.postsharp.org/](http://www.postsharp.org/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T03:51:00.997

之前提出了一个[有点相似的问题](https://stackoverflow.com/questions/247800/override-default-constructor-of-partial-class-with-another-partial-class#247874)（好吧，所以我的解决方案有点相似）。 [PostSharp](http://www.postsharp.org)已经被提及，但[在 CodeProject 上也有这篇非常适用的 LinFu 文章，](http://www.codeproject.com/KB/cs/LinFuPart6.aspx)我在研究这个问题时发现很有趣。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T01:46:49.000

您打算对任意类型执行此操作吗？我想不会因为您要使用属性来装饰方法。

鉴于此，我认为更好的方法是在超类中为您的类型定义抽象方法。超类上的方法可以容纳样板方法代码，并通过抽象方法委托给具体实现，以实现该方法的各个类型的行为。

一般来说，除非您在运行时创建代码文件和编译动态程序集，否则您想要做的事情是无法完成的。您可以使用更多实用的 OO 原则和模式来实现接近相同的结果。

# cocoa - 带有 _NSAutoreleaseNoPool 错误的 NSThread

> ID：249022
> 
> 赞同：12
> 
> 时间：2008-10-30T01:38:54.710
> 
> 标签：cocoa, multithreading, memory-management, memory-leaks

我有一种将文件保存到互联网的方法，它可以工作但速度很慢。然后我想让用户界面更流畅，所以我创建了一个 NSThread 来处理慢任务。

我看到一个错误列表，例如：

```
_NSAutoreleaseNoPool(): Object 0x18a140 of class NSCFString autoreleased with no pool in place - just leaking 
```

没有 NSThread，我调用的方法如下：

```
[self save:self.savedImg]; 
```

我使用以下方法使用 NSThread 调用该方法：

```
NSThread* thread1 = [[NSThread alloc] initWithTarget:self
                                        selector:@selector(save:)
                                              object:self.savedImg];
[thread1 start]; 
```

谢谢。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-30T04:12:00.440

首先，你们都在为保存代码创建一个新线程，然后异步使用 NSUrlConnection。NSUrlConnection 在它自己的实现中也会派生另一个线程并在新创建的线程上给你回电，这通常不是你想要做的事情。我假设您只是想确保您的 UI 在保存时不会阻塞...

NSUrlConnection 也有同步版本，它会阻塞你的线程，如果你想启动自己的线程来做事，最好使用它。签名是

```
+ sendSynchronousRequest:returningResponse:error: 
```

然后，当您收到响应时，您可以回调您的 UI 线程。像下面这样的东西应该可以工作：

```
- (void) beginSaving {
   // This is your UI thread. Call this API from your UI.
   // Below spins of another thread for the selector "save"
   [NSThread detachNewThreadSelector:@selector(save:) toTarget:self withObject:nil];    

}

- (void) save {
   NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];  

   // ... calculate your post request...
   // Initialize your NSUrlResponse and NSError

   NSUrlConnection *conn = [NSUrlConnection sendSyncronousRequest:postRequest:&response error:&error];
   // Above statement blocks until you get the response, but you are in another thread so you 
   // are not blocking UI.   

   // I am assuming you have a delegate with selector saveCommitted to be called back on the
   // UI thread.
   if ( [delegate_ respondsToSelector:@selector(saveCommitted)] ) {
    // Make sure you are calling back your UI on the UI thread as below:
    [delegate_ performSelectorOnMainThread:@selector(saveCommitted) withObject:nil waitUntilDone:NO];
   }

   [pool release];
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-30T02:06:20.257

您主要需要为线程创建一个自动释放池。尝试将您的保存方法更改为：

```
- (void) save:(id)arg {
    NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];

    //Existing code

    [pool drain];
} 
```

你不会认为上面没有调用 NSAutoreleasePool 上的 release。这是一个特例。对于 NSAutoreleasePool 来说，在没有 GC 的情况下运行时，drain 相当于释放，并转换为对收集器的提示，它可能是运行收集的好点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T03:54:40.863

您可能需要创建一个运行循环。我将添加到路易斯的解决方案：

```
BOOL done = NO;

NSAutoreleasePool *pool = [[NSAutoreleasePool alloc] init];
[NSRunLoop currentRunLoop];

// Start the HTTP connection here. When it's completed,
// you could stop the run loop and then the thread will end.

do {
    SInt32 result = CFRunLoopRunInMode(kCFRunLoopDefaultMode, 1, YES);
    if ((result == kCFRunLoopRunStopped) || (result == kCFRunLoopRunFinished)) {
        done = YES;
    }
} while (!done);

[pool release]; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T01:58:58.400

在线程中，您需要在执行任何其他操作之前创建一个新的自动释放池，否则网络操作将出现您所看到的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T04:58:45.353

我认为您没有任何理由为此使用线程。简单地在运行循环上异步执行它应该可以在不阻塞 UI 的情况下工作。

相信运行循环。它*总是*比线程更容易，并且旨在提供相同的结果（永不阻塞的 UI）。

# java - Java IPC：GUI 和命令行

> ID：249027
> 
> 赞同：1
> 
> 时间：2008-10-30T01:40:01.993
> 
> 标签：java, ipc

我想为 Java 应用程序实现一个命令行界面。这不会太难做到，除非我希望命令行程序影响另一个 Java GUI 程序的状态。例如，我可以输入：

```
java CliMain arg1 arg2 
```

另一个正在运行的 GUI 实例将执行适当的操作。

实现这样的事情的最简单方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T01:42:18.480

您可以让 GUI 应用程序侦听 TCP 端口（在`localhost`接口上），然后 CLI 应用程序将连接到它。

一种方法是使用 REST over HTTP。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T01:45:12.577

另一种方法是通过 JMX。它“免费”为您提供了很多东西（在简单的情况下，您只需实现一个 bean 并注册它——非常简单），并且特别适合这项任务。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T02:06:15.340

您可以让 GUI 应用程序（如编辑器）监听

1) 特定类型的剪贴板事件
如果该事件是您感兴趣的类型，则获取剪贴板内容。

2）某个端口
上的服务器套接字侦听服务器套接字。当 CLI 程序启动时，它连接到已知端口的服务器套接字，发送信息并退出。

3) 队列
你可以从 CLI 程序入队和从 GUI 程序出队。

如果你想进一步调查，许多像emacs这样的专业编辑器使用相同的机制。[http://www.emacswiki.org/emacs/EmacsClient](http://www.emacswiki.org/emacs/EmacsClient)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T05:42:37.387

您的应用程序可以通过[RMI](http://java.sun.com/docs/books/tutorial/rmi/index.html)进行控制。该应用程序将实现一个控制接口，在 localhost 上注册其服务，命令行应用程序将获得一个 rmi 代理并调用所需的控制方法......

一开始似乎很难，但当你尝试过之后，你很快就会发现它是多么容易。它还支持通过[SSL](http://java.sun.com/j2se/1.5.0/docs/guide/rmi/socketfactory/SSLInfo.html)加密。因此，如果在线有安全相关数据，您可以保护您的数据交换。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T06:00:39.127

最简单的方法是让 GUI 监听 TCP 端口上的命令。命令行会发送命令，而 GUI 会解释它们。

也许您也可以使用命名管道来做到这一点，但我不确定您将如何在 Java 中实现它。

# .net - .NET 的 SMTP 和 IMAP 服务器库

> ID：249047
> 
> 赞同：19
> 
> 时间：2008-10-30T01:49:52.147
> 
> 标签：.net, smtp, imap

有谁知道 C# 的一个好的 SMTP/IMAP 服务器库？

我只发现了一些长期废弃的项目。

* * *

只有**服务器**端库，请不要再发关于客户端库的帖子。

谢谢， 芬恩

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-30T10:49:56.050

LumiSoft.Net 是来自 LumiSoft 邮件服务器的库，是一个免费的服务器端库。服务器类（例如 IMAP 服务器、POP3 服务器和 SMTP 服务器）在需要服务器应用程序的信息或操作时触发事件，例如“给我虚拟文件夹 XXY 中的消息列表”。

[下载页面](http://www.lumisoft.ee/lsWWW/ENG/Products/Mail_Server/mail_index_eng.aspx?type=download)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-02-16T20:09:20.743

我正在做一个项目，我需要通过本地网络上的 SMTP 接收邮件（旧应用程序正在发送邮件以用于集成目的）。最初，我打算在 IIS 中使用 SMTP 服务器并使用事件接收器，但这似乎有点笨拙。我目前正在评估以下 3 个候选库：

[nDumbster](https://github.com/EdenRidgway/nDumbster)：开源但不是完全实现的服务器。最初用于单元测试。它将邮件解析为对象以便于检查。我不得不修改它以在收到消息时引发事件。

[SmtpServer](http://cainosullivan.com/smtpserver/)：使用 .NET TPL 并实现 STARTTLS 的现代设计。源代码似乎并不容易获得。收到消息时提供一些挂钩，但似乎将消息内容作为 blob 传递给您。（我没有测试这个，因为它需要.net 4.5）

[Rnwood.SmtpServer](http://smtpserver.codeplex.com/)：看起来功能齐全，尽管缺少文档，但源代码可用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T01:53:09.237

我过去使用过[DotNetOpenMail](http://dotnetopenmail.sourceforge.net/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T10:42:05.113

您没有提到您是在寻找免费还是付费/商业。我过去曾使用过 nsoftware 的[IPWorks](http://www.nsoftware.com/)，并取得了巨大的成功。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-10-30T01:51:39.193

对于 SMTP，有`System.Net.Mail`. 对于 IMAP，我不知道。但是，一旦您从服务器获取电子邮件，您就需要对其进行解析。MIME 解析是困难的部分。为此，我使用并推荐`SharpMimeTools`.

# c++ - 易于使用的 C++ SNMP 客户端库？

> ID：249062
> 
> 赞同：33
> 
> 时间：2008-10-30T01:59:06.650
> 
> 标签：c++, snmp

什么是易于使用的 C++ SNMP 客户端库？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-11-23T09:51:35.600

SNMP++ 对 C++ 开发人员来说也是一个不错的开源库。

[http://www.agentpp.com/api/cpp/snmp_pp.html](http://www.agentpp.com/api/cpp/snmp_pp.html)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-30T02:34:48.140

可能最好的选择是[net-snmp](http://www.net-snmp.org/)。请注意，该库具有“C”链接，但可以与 C++ 一起正常工作。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-05-17T14:23:17.543

我发现 Net-SNMP 不支持 v3 类型查询的多线程。因此，如果您正在编写一个轮询多个主机的 SNMP 监控工具，那么您需要考虑到这一点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-12T20:34:40.590

[OpenSNMP](http://sourceforge.net/projects/opensnmp/)包含一个完整的 SNMPv3 多线程实现，它是用 C++ 完成的（包括类等）。不过，它并没有被大量使用和维护。

带有 v3 over TLS/DTLS 的 Net-SNMP 可能是线程安全的，因为它实际上是包含线程问题的 SNMPv3/USM。我认为。

# python - 我需要一个很好的理由来使用 Python

> ID：249064
> 
> 赞同：12
> 
> 时间：2008-10-30T01:59:48.663
> 
> 标签：python

我一直在尝试为在我的工作中使用 Python 提供一个案例。我们基本上使用 C# 和 ASP.NET 进行所有开发。我们 80% 或更多的项目是 Web 应用程序。我们会看一些不错的动态 Web 语言（Ruby、Python 等）似乎很自然，我开始认真研究[IronRuby](http://en.wikipedia.org/wiki/Ironruby)和[IronPython之类的东西。](http://en.wikipedia.org/wiki/Ironpython)

我喜欢 Python。这是一种美丽的、富有表现力的语言。当然，编写代码是一种乐趣。众多的 python 模块和框架使它非常吸引人。问题是，我想不出任何具体的问题，任何**需要**像 Python 这样的语言的具体障碍。ASP.NET 为我们提供了 RAD，它为我们提供了一个功能齐全的框架和所有这些好东西。此外，我们都已经了解 C#，并且有很多 C# 项目，学习一门新语言只是*因为*不太好用。

你们能帮我想想办法最终说服我的老板真正学习 Python 并开始在项目中使用它吗？

编辑：我知道没有问题只需要一种语言，我的意思是，动态语言优于静态语言是否存在任何特定问题。

再次编辑：我还要提一下，我的老板促使我对此进行调查。他花了几个小时研究这些语言，找到一种好的语言，学习它，然后弄清楚我们如何使用它。我已经到了最后一步，我不需要讲课为什么我应该考虑我改变公司所做事情的动机，因为他们这样做是有原因的。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-30T02:12:10.370

“你们能帮我想想办法最终说服我的老板真正学习 Python 并开始在项目中使用它吗？”

没有。

没有什么比成功更成功。使用 Python。成功的。让人嫉妒。

当被问及你为什么成功时，你可以谈谈 Python。不是以前。

明智地选择项目：动态语言具有显着优势的事情。**没有**详细确定要求的事情。诸如数据转换、日志文件抓取和 BAT 文件的超级复杂替换之类的事情。

使用 Python 开始做一些有用的事情，而其他人都站着试图获得足够的业务和领域信息来启动项目以开发复杂的 MVC 设计。

* * *

编辑：一些 Python 的救援故事。

*   [探索性编程](http://www.itmaybeahack.com/homepage/iblog/C551260341/E20081005191603.html)
*   [构建测试用例的工具](http://www.itmaybeahack.com/homepage/iblog/C20071019092637/E20080830091128.html)
*   [这里的中心是什么？](http://www.itmaybeahack.com/homepage/iblog/C465799452/E20080712112540.html)
*   [控制中断报告](http://www.itmaybeahack.com/homepage/iblog/C588245363/E20060206184914.html)
*   [关于 Python 的另一件很酷的事情是……](http://www.itmaybeahack.com/homepage/iblog/C588245363/E20051022112554.html)
*   [赞美连载](http://www.itmaybeahack.com/homepage/iblog/C465799452/E20080603055001.html)

这就是我。

* * *

编辑：“老板提示我进行调查”，“弄清楚我们如何使用它”改变了一切。

“终于说服我的老板真正学习 Python”具有误导性。你不是在逆流而上。请参阅[如何为 Python 制作商业案例以](https://stackoverflow.com/questions/202337/how-do-i-make-the-business-case-for-python)解决“说服我的老板”问题。编辑说你已经过了这个阶段。

动态语言提供了灵活性。利用它。我上面的两组示例是灵活性很重要的两个领域。

*   要求并没有完全确定。使用动态语言，您可以开始使用。返工不会破坏交易。使用 Java（以及 C++ 和 C#），您不愿意处理破坏性的设计更改，因为很难破坏所有内容并使其重新编译和工作。在 Python 中，毁灭性的改变并不昂贵。

*   设计在不断变化，因为您无法挑选组件。你可以很容易地用 Python 编写 Wrappers 和 Facades。它是一种脚本语言。而且，Python 模块非常简单地组成更大的聚合体。

*   编码不断变化，因为需求和设计不断变化。它是脚本化的——不是编译的。您只需更改代码即可开始运行。测试更容易，因为工作周期更短。它不是代码编译构建测试，而是代码测试。

*   测试在不断变化，因为需求不断变化。和上面一样。工作周期更短更快。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-30T02:04:09.980

几乎没有问题**需要**特定的编程语言，但事情并非如此。

让一门新语言进入像你这样的环境的最简单方法是在你自己的时间用新语言开始一个新的工作项目。让它做你需要做的事情，然后在你自己的时间写。自己使用它，其他人可能会注意到它。然后他们说“你能把那个程序发给我吗？” 并且繁荣，他们正在使用你的新语言。

如果你真的想做点什么，我可能会用 Django 写一个网站，因为它的管理界面让所有人大吃一惊。

要记住的要点是，如果您开始使用 python，那是其他人必须学习的另一件事，这是每个潜在员工简历上需要的另一个要点。这可能会变得昂贵，管理层不会喜欢它。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-10-30T02:28:20.820

潜入一种语言通常是通过自动化繁琐的手动任务来完成的（尤其是动态/脚本语言，如 Python/Ruby 等）。对其进行设置，例如部署构建、改组备份或使用 Python 完成的任何操作。

然后漫不经心地了解它是多么容易做，并尝试在周围传播一些热情。

接受度和意识应该会慢慢增长，不知不觉中，管理层正在认真考虑将 Python 用于一个新项目。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-30T02:21:05.217

> 你们能帮我想想办法最终说服我的老板真正学习 Python 并开始在项目中使用它吗？

不幸的是，答案是否定的。正如哈利所说，没有问题**需要**特定的语言。哈雷建议的方法也是一种很好的方法。在你的时间里学习，在你的时间里构建一个有用的应用程序，也许，只是也许，你工作中的某个人会想要使用它，喜欢它，喜欢它，然后想要了解更多关于它的信息。

您可以采取的另一种方法是更好地了解为什么您的公司几乎所有开发都使用 .Net（因此是 Windows Server，可能还有 SQL Server）。一旦你很好地理解了为什么它们不对其他语言开放，那么你就有了一些火力来为“为什么不？”建立一个商业案例。

当您拥有可以完成相同任务的工具时，为什么还要支付许可费用？那里有免费的替代品，比如 Python，可以在免费服务器上运行。

为什么不让您的团队有机会发展他们的专业工具带呢？这是我的观点，但优秀的开发人员是不怕学习新方法来做他们以前做过的事情的开发人员。

但是，最后，我不会让你抱有希望。归根结底，将新的语言/环境引入 IT 商店需要花钱。无论是软件、培训还是员工轮岗，在公司使用单一语言并坚持使用它背后都有商业原因。

我处于您所处的确切场景中。我在 .Net 商店工作，而且这种情况不会很快改变。我靠在“空闲”时间做自己的项目来过日子。我喜欢它，它使一个很好的平衡。

希望这可以帮助。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-30T02:23:40.423

退后一步，看看你的方法。“我知道我想要答案是什么，但我找不到任何证据来支持它。”

尽管 Python 是我目前的首选语言，但恐怕我发现自己站在你老板的一边！对不起。

我认为你应该敞开心扉，从组织的最佳利益出发考虑所有选项，看看你是否对最佳语言得出不同的结论。

语言的选择有很多因素，它有多漂亮是一个相当次要的因素。员工的可用性是关键之一。再培训的成本、库和元工具的可用性、性能等。

一旦你考虑了所有不同的因素（不仅仅是“哦！这会很有趣！”）并做出平衡的评估（而不是预先确定的答案），你可能会发现你的老板更愿意倾听。

ps 秘密使用 Python 编写工作代码的建议，让公司背负着可怕的代码债务，他们没有准备好使用这种语言，这对我来说似乎很不专业。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-30T02:46:42.017

您可能拥有的最佳杠杆是工具和库；正如其他人指出的那样，解决任何特定程序都不*需要语言。*那么让我们看看你可以使用 Python 来利用的东西：

*   谷歌应用引擎
*   科学派
*   pywinauto
*   django

这些都在我的脑海中；找出适用于您的团队和您的公司的内容作为提问者的练习:)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-30T04:16:21.850

好吧，[这里有一个](http://www.paulgraham.com/pypar.html)关于为什么 Python 程序员成为更好的 Java 程序员的观点；这些概念与您的情况大致相同。

从本质上讲，学习一门语言的人是因为他们想表明他们喜欢编程，喜欢学习新事物，并且更有可能跳出框框思考。

> ...如果一家公司选择用相对深奥的语言编写其软件，他们将能够雇用更好的程序员，因为他们只会吸引那些足够关心学习它的人。而对于程序员来说，悖论更加明显：如果你想找到一份好工作，要学习的语言是一种人们不只是为了找到工作而学习的语言。

不仅如此，Python 还强制执行“好看”的代码，您不必执行整个代码/编译例程。使用 IronPython，您可以简单地用 Python 编写代码并按原样使用它；只是另一个 .NET 工具。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-30T04:27:55.337

语言几乎从来都不是成功的关键。优秀的程序员可以在多种语言中取得成功，并且您会发现几乎任何语言的成功项目。您不会发现太多失败，因为这些项目会消失，再也不会被听到。如果您因为没有优秀的程序员而正在寻找一种新语言，那么即使是世界上最好的语言也无济于事。

而且，你还没有提到你正在做的工作。Python 可能是一个不错的选择，因为它具有对您至关重要的得到良好支持和广泛使用的库。另一方面，C# 可能对您想做的事情有更好的支持。上下文之外的工具没有内在价值。您可能喜欢螺丝刀，但这无助于您划船。

如果你想使用 Python 或任何其他语言，仅仅因为你喜欢它，就对自己和周围的人诚实。看起来你已经做出了转换的决定，不知道为什么要转换，现在需要用与你转换的愿望无关的理由来合理化它。如果你有充分的理由，你就不会在这里问了:)

不过，这并不完全是一件坏事。编程是一项人类事业。如果程序员（在任何级别）疯狂地喜欢一种特定的语言，无论原因多么愚蠢，他们可能会产生更多。不过，这不是一个技术解决方案。

祝你好运， ：）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-30T20:24:07.217

Python 在 Java 世界中作为单元测试的 Jython 有一个良好的开端。事实上，很多 Java 人都是这样开始使用它的。它的动态脚本特性使其非常适合单元测试。就在昨天，我希望我可以将它或类似的东西用于我为 VB.Net 项目编写的单元测试。我不得不说，这与 IronRuby 或 IronPython 个别语言无关，而与它们支持的开发风格有关。您可以使用其中任何一种编写静态语言，例如代码，但在您开始动态思考之前，您不会完全获得好处。一旦掌握了这些概念，您将开始慢慢改变编码方式，您的项目将需要更少的类和更少的代码来实现。测试，

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-05-05T18:44:23.427

我很确定（100%）你至少不需要为 MS Windows 使用 Python。

在其他平台的情况下，您可以使用您喜欢的任何语言。

# c# - 如何避免 ASP.NET MVC 中的 HttpRequestValidationException 呈现导致异常的相同视图

> ID：249066
> 
> 赞同：39
> 
> 时间：2008-10-30T02:00:56.757
> 
> 标签：c#, .net, asp.net, asp.net-mvc, vb.net

我只想知道如何在 ASP.NET MVC 中验证（或清理）用户输入，以便无论提交的值如何都不会引发 HttpRequestValidationException。例如，使用文本输入，如果用户输入`<BR/>`，将导致异常并显示黄屏死机。我不想要那个。我想捕获异常并在当前视图中显示用户友好的错误，最好使用加载了相同值的控件。

我找到了这个[http://www.romsteady.net/blog/2007/06/how-to-catch-httprequestvalidationexcep.html](http://www.romsteady.net/blog/2007/06/how-to-catch-httprequestvalidationexcep.html)，但它对我的目的没有用。另外，我找到了这个[http://msdn.microsoft.com/en-us/library/aa973813.aspx](http://msdn.microsoft.com/en-us/library/aa973813.aspx)并试图放入模型活页夹但我无法工作。

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2009-02-16T02:53:34.507

使用最新版本的 ASP.NET MVC（RC，在撰写本文时），您可以在控制器类或操作方法上放置一个属性，例如：

```
[ValidateInput(false)]
public ActionResult create()
{
    // ...method body
} 
```

ValidateInputAttribute 位于 System.Web.Mvc 中。

但正如其他人所说，您必须执行自己的手动输入验证或清理。

使用 MVC 3，您还必须确保它在您的 Web.config 中：`<system.web><httpRuntime requestValidationMode="2.0" /></system.web>`

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2011-02-10T16:36:36.597

在 ASP MVC 3 中，您可以使用`[AllowHtml]`Model/ViewModel 中各个字段/属性的属性来关闭对该字段的验证，这非常好。我会将此属性添加到我的模型中的某些字段，然后使用优秀的[AntiXSS](http://wpl.codeplex.com/)库（也可通过 NuGet 获得）通过调用`Sanitizer.GetSafeHtmlFragment(mymodel.Description)`（其中“Description”属性是我的视图模型上的字符串属性，即已`[AllowHtml]`应用属性）

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-03-04T15:51:02.553

有关如何使用过滤器捕获此（和其他）异常的非常详细的示例，请参见：[http ://code.google.com/p/geochat/source/browse/Source/Web/GeoChat.MvcExtensions/ExceptionHandlerAttribute.cs](http://code.google.com/p/geochat/source/browse/Source/Web/GeoChat.MvcExtensions/ExceptionHandlerAttribute.cs)

这将允许您继续验证，但防止用户看到“黄屏死机”。

这是一个简化（也许过于简化）的版本：

```
[AttributeUsage(AttributeTargets.Method | AttributeTargets.Class, Inherited = true, AllowMultiple = true), AspNetHostingPermission(SecurityAction.LinkDemand, Level = AspNetHostingPermissionLevel.Minimal)]
public class ExceptionHandlerAttribute : FilterAttribute, IExceptionFilter {

private HandleErrorAttribute attribute = new HandleErrorAttribute();

public ExceptionHandlerAttribute() {
  this.ExceptionType = typeof(Exception);
  this.Order = 1;
}

public string View {
  get {
    return attribute.View;
  }
  set {
    attribute.View = value;
  }
}

public Type ExceptionType {
  get {
    return attribute.ExceptionType;
  }
  set {
    attribute.ExceptionType = value;
  }
}

public void OnException(ExceptionContext filterContext) {
  if (this.ExceptionType.IsInstanceOfType(filterContext.Exception)) {
    string controller = (string)filterContext.RouteData.Values["controller"];
    string action = (string)filterContext.RouteData.Values["action"];
    if (controller == null)
      controller = String.Empty;

    if (action == null)
      action = String.Empty;

    HandleErrorInfo model = new HandleErrorInfo(filterContext.Exception, controller, action);
    ViewResult result = new ViewResult();
    result.ViewName = this.View;
    result.MasterName = String.Empty;
    result.ViewData = new ViewDataDictionary<HandleErrorInfo>(model);

    result.TempData = filterContext.Controller.TempData;
    filterContext.Result = result;

    filterContext.ExceptionHandled = true;
    filterContext.HttpContext.Response.Clear();
    filterContext.HttpContext.Response.StatusCode = 500;
  }
} 
```

}

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-01T22:24:07.110

除了在 global.asax Application_Error 中捕获错误，您可以通过为控制器添加一个错误处理程序来捕获它，该控制器显式捕获此错误并使用错误消息和适当的视图数据重定向到视图。

我发现这个有点老了，[关于](http://weblogs.asp.net/fredriknormen/archive/2007/11/22/asp-net-mvc-framework-handling-exception-by-using-an-attribute.aspx)如何使用属性来做到这一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-06-21T09:49:27.240

ValidateInputAttribute 是禁用请求验证的正确方法。视图（aspx）中的声明性方法不起作用，因为控制器负责接收请求（不是视图/aspx）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-31T13:05:41.217

将 ValidateRequest="false" 放在您的 aspx 视图声明中，但要清理用户在您的代码中输入的文本，以避免一些 xss 攻击。

# javascript - 如何动态更改 onClick 处理程序？

> ID：249074
> 
> 赞同：54
> 
> 时间：2008-10-30T02:03:38.640
> 
> 标签：javascript, function

我敢肯定那里有一百万个关于此的帖子，但令人惊讶的是，我很难找到一些东西。

我有一个简单的脚本，我想在其中为`<A>`页面初始化时的链接设置 onClick 处理程序。

当我运行它时，我**立即**得到一个“foo”警报框，我希望只有在单击链接时才会收到警报。

我做错了什么愚蠢的事情？（我试过 click= 和 onClick=）...

```
<script language="javascript">

    function init(){

        document.getElementById("foo").click = new function() { alert('foo'); };
    }

</script>

<body onload="init()">
    <a id="foo" href=#>Click to run foo</a>
</body> 
```

* * *

**编辑：**我将接受的答案更改为 jQuery 答案。' [Már Örlygsson](https://stackoverflow.com/questions/249074/how-to-change-onclick-handler-dynamically/249093#249093) ' 的答案在技术上是对我最初问题的正确答案（`click`应该`onclick`并且`new`应该被删除），但我**强烈反对**任何人直接在他们的代码中使用 'document.getElementById(...) -而是使用[jQuery](http://docs.jquery.com/Tutorials:Getting_Started_with_jQuery) .

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2008-10-30T02:06:55.467

尝试：

```
document.getElementById("foo").onclick = function (){alert('foo');}; 
```

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-10-30T02:10:47.733

使用`.onclick`（全部小写）。像这样：

```
document.getElementById("foo").onclick = function () {
  alert('foo'); // do your stuff
  return false; // <-- to suppress the default link behaviour
}; 
```

实际上，您可能会发现使用一些好的库（我推荐[jQuery](http://www.jquery.com/)有几个原因）让您启动并运行，并编写干净的 javascript 会更好。

跨浏览器（内）兼容性对任何人来说都是一个正确的问题——更不用说刚刚开始的人了。

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2008-10-30T02:10:13.603

jQuery：

```
$('#foo').click(function() { alert('foo'); }); 
```

或者，如果您不希望它遵循链接 href：

```
$('#foo').click(function() { alert('foo'); return false; }); 
```

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-12-23T14:59:20.833

前几天我或多或少地尝试了所有其他解决方案，但在我尝试了这个之前，它们都不适合我：

```
var submitButton = document.getElementById('submitButton');
submitButton.setAttribute('onclick',  'alert("hello");'); 
```

据我所知，它工作得很好。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2011-05-07T12:10:00.740

如果要从当前函数传递变量，另一种方法是，例如：

```
document.getElementById("space1").onclick = new Function("lrgWithInfo('"+myVar+"')"); 
```

如果你不需要从这个函数传递信息，它只是：

```
document.getElementById("space1").onclick = new Function("lrgWithInfo('13')"); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-01-15T08:28:02.650

OMG ...这不仅仅是“jQuery Library”和“getElementById”的问题。

当然，jQuery 帮助我们将跨浏览器问题放在一边，但如果你真的足够了解 JavaScript，使用没有库的传统方式仍然可以很好地工作！！！

@Már Örlygsson 和 @Darryl Hein 都为您提供了很好的替代方法（我想说，它们只是替代方法，而不是 anwsers），前者使用传统方式，后者使用 jQuery 方式。但是你真的知道你的问题的答案吗？你的代码有什么问题？

首先，`.click`是一种jQuery方式。如果您想使用传统方式，请改用 .onclick。或者我建议你只专注于学习使用 jQuery，以防混淆。jQuery 是一个很好的工具，可以在不了解 DOM 的情况下使用。

第二个问题，也是关键问题，`new function(){}`是一种非常糟糕的语法，或者说它是一种错误的语法。

无论您是否想使用 jQuery 或不使用它，您都需要澄清它。

有 3 种基本方式声明函数：

```
function name () {code}

... = function() {code} // known as anonymous function or function literal

... = new Function("code") // Function Object 
```

请注意，javascript**区分大小写**，因此`new function()`不是 javascript 的标准语法。浏览器可能会误解其含义。

因此，您的代码可以使用第二种方式修改为

```
 = function(){alert();} 
```

或使用第三种方式

```
 = new Function("alert();"); 
```

细说一下，第二种方式和第三种方式几乎一样，第二种方式很常见，而第三种方式很少见。您的两个最佳答案都使用第二种方式。

但是，由于“运行时”和“编译时”，第三种方式可以做第二种方式不能做的事情。我只是希望你知道`new Function()`有时会有用。有一天你遇到使用问题`function(){}`，别忘了`new Function()`。

要了解更多信息，建议您阅读 << JavaScript：权威指南，第 6 版>>，O'Reilly。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-10-30T07:37:12.287

我同意使用 jQuery 是最好的选择。你还应该避免使用 body 的 onload 函数，而使用 jQuery 的 ready 函数。至于事件监听器，它们应该是带有一个参数的函数：

```
document.getElementById("foo").onclick = function (event){alert('foo');}; 
```

或在 jQuery 中：

```
$('#foo').click(function(event) { alert('foo'); } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-07T04:41:00.553

这是上面 jQuery 帖子的 YUI 对应项。

```
<script>
  YAHOO.util.Event.onDOMReady(function() {   
    document.getElementById("foo").onclick =  function (){alert('foo');};
  });
</script> 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-16T11:40:43.653

上面的 YUI 示例应该是：

```
<script>
  YAHOO.util.Event.onDOMReady(function() {   
     Dom.get("foo").onclick =  function (){alert('foo');};
  });
</script> 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-04-04T21:38:51.107

我认为您想使用 jQuery 的[.bind](http://api.jquery.com/bind/)和[.unBind](http://api.jquery.com/unbind/)方法。在我的测试中，使用 .click 和 .onclick 更改 click 事件实际上调用了新分配的事件，从而导致了一个永无止境的循环。

例如，如果您正在切换的事件是 hide() 和 unHide()，并且单击一个将单击事件切换到另一个，您将最终进入一个连续循环。更好的方法是这样做：

```
$(element).unbind().bind( 'click' , function(){ alert('!') } ); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-05-24T19:51:45.130

没有人解决正在发生的实际问题，以解释发出警报的原因。

此代码：`document.getElementById("foo").click = new function() { alert('foo'); };`将`#foo`元素的 click 属性分配给一个空对象。这里的匿名函数是用来初始化对象的。我喜欢将这种类型的函数视为构造函数。您将警报放在那里，因此它会被调用，因为该函数会立即被调用。

看到[这个问题](https://stackoverflow.com/questions/2274695/new-function-with-lower-case-f-in-javascript)。

# svn - 在所有项目中共享组件，有没有比 svn:externals 更好的选择？

> ID：249085
> 
> 赞同：14
> 
> 时间：2008-10-30T02:07:33.217
> 
> 标签：svn, svn-externals

我的情况：我有几个组件，它们有时会发生变化，并且在许多不同的项目中共享。每个项目都将它们放在一个名为 /depends 的子文件夹中。依赖项为我们所有的常用组件保存了一堆 svn 外部组件。

svn:externals 给我带来了很多时间和痛苦。

*   在项目根文件夹上显示日志不会显示 svn:external 文件夹的更改（但有趣的是，提交和更新将适用于 svn:externals）
*   分支时， svn:externals 不会分支。
*   由于 svn:externals 上没有分支，任何更改通常都会破坏主干。
*   标签不会冻结它们的外部。这确实违背了标记的目的。

请记住，我有几个项目（假设有 10 个用于本次讨论，每个都使用相同的外部），因此为每个项目保留正常的提交目录将花费我大量的合并时间。

我的情况有更好的选择吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-30T02:48:39.407

我认为部分问题在于共享组件的发布周期不一定与项目的发布周期相匹配。

此处描述的共享组件*有自己的发布周期*。换句话说，每个项目都可以作为一个单独的项目进行管理（或者可能将它们的集合作为一个单独的项目进行管理），并拥有自己的发布/版本号。

请注意，`svn:externals`定义可以包括*特定的修订*。

这允许每个使用共享组件的项目针对该共享组件（或共享组件的集合）的*特定版本/修订进行开发，从而为项目提供一组稳定的依赖项。*对组件的更改不会破坏项目，因为每个项目都在查看组件的特定版本，而这不一定`HEAD`是`trunk`.

虽然这似乎需要更多的前期工作，但我相信从长远来看，这种做法为这种情况提供了更好的变更管理流程。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-30T07:56:28.207

我同意@Ken。

我强烈建议**不要**`svn:externals`在没有特定修订的情况下使用。如果没有修订，就**不可能**重新创建旧的结帐。如果您只在标记时固定您的外部，您将只能重新创建您已标记的内容。如果你想在主干中重新创建一些中间版本，你就靠你自己了。

不分支外部的一个原因是不清楚应该如何做。如果您的项目 A 的外部指向 tags/2.0.0 并且您正在为您的项目创建一个 3.4.x 分支，那么项目 A 的外部应该指向什么？也应该项目A分支吗？如果是这样，是什么版本？

如果项目有不同的发布周期，通常不可能在分支时为外部定义合理的行为。

`svncopy.pl`（如果您还没有（包含在 Subversion 源代码分发中）允许您在标记期间固定外部的脚本，您可能需要查看该脚本。）

我们发现 svn:externals 在用于将您正在积极开发的一组组件放在一起时效果很差。Externals 可以很好地引入移动不大并且没有分支问题的外部组件。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-30T15:59:56.970

我在一个类似的[问题](https://stackoverflow.com/questions/245337/how-can-i-branch-in-svn-and-have-it-branch-my-svnexternal-folders-as-well#248367)上说明了这一点：您应该将`svn:externals`其用作来自不同存储库的**外部引用。**所以`svn:externals`应该指位于不同存储库中的组件、模块、3rd 方工具等。

您不应该**通过**使用`svn:externals`外部指向同一个存储库来模拟“符号链接”行为。

**大多数情况下，您可以通过修改构建结构或使用签出脚本和稀疏签出功能来解决此类问题。**

svn:externals 有很多问题，其中大部分都很难看到、跟踪和修复： [请参见此处的示例](https://stackoverflow.com/questions/223355/i-cannot-commit-changes-after-merge-in-svn)

*   提交不能跨越外部（没有原子提交）
*   分支不会分支它们的外部
*   标签不会“冻结”它们的外部，因此后面的构建可能会导致不同/损坏的构建
*   合并和重新整合合并不适用于外部

如果您使用 externals 指向其他存储库，则大多数时候您不会遇到这些问题。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-11-03T17:59:22.090

您可以尝试使用所谓的供应商分支：

[http://svnbook.red-bean.com/en/1.5/svn-book.html#svn.advanced.vendorbr](http://svnbook.red-bean.com/en/1.5/svn-book.html#svn.advanced.vendorbr)

当您处理第三方库时，这是一个有用的策略，但在像您这样的情况下它也很有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-07-12T18:07:29.983

`svncopy.pl`（在[这个问题](https://stackoverflow.com/questions/1982538/how-to-have-tortoisesvn-always-freeze-svnexternals-for-tags/2011886#2011886)中提到）会将路径中的路径重写`svn:externals`到它们在分支中的新位置。

# .net - 如何从 .NET 中的字符串中删除变音符号（重音符号）？

> ID：249087
> 
> 赞同：489
> 
> 时间：2008-10-30T02:07:46.743
> 
> 标签：.net, string, diacritics

我正在尝试转换一些法语加拿大语的字符串，基本上，我希望能够在保留字母的同时取出字母中的法语重音标记。（例如转换`é`为`e`，所以`crème brûlée`会变成`creme brulee`）

实现这一目标的最佳方法是什么？

* * *

## 回答 #1

> 赞同：597
> 
> 时间：2008-10-30T02:29:01.240

我没有使用过这种方法，但 Michael Kaplan 在他的博客文章（标题令人困惑）中描述了一种这样做的方法，其中谈到了剥离变音符号[：是无间距的，但有些比其他的更无间距）](https://web.archive.org/web/20160319113351/http://www.siao2.com/2007/05/14/2629747.aspx)

```
static string RemoveDiacritics(string text) 
{
    var normalizedString = text.Normalize(NormalizationForm.FormD);
    var stringBuilder = new StringBuilder(capacity: normalizedString.Length);

    for (int i = 0; i < normalizedString.Length; i++)
    {
        char c = normalizedString[i];
        var unicodeCategory = CharUnicodeInfo.GetUnicodeCategory(c);
        if (unicodeCategory != UnicodeCategory.NonSpacingMark)
        {
            stringBuilder.Append(c);
        }
    }

    return stringBuilder
        .ToString()
        .Normalize(NormalizationForm.FormC);
} 
```

请注意，这是他之前的帖子的后续内容：[剥离变音符号....](http://archives.miloush.net/michkap/archive/2005/02/19/376617.html)

该方法使用[String.Normalize](https://msdn.microsoft.com/en-us/library/system.string.normalize.aspx)将输入字符串拆分为组成字形（基本上将“基本”字符与变音符号分开），然后扫描结果并仅保留基本字符。这只是有点复杂，但实际上你正在寻找一个复杂的问题。

当然，如果您将自己限制在法语，您可能会按照@David Dibben 的建议，在[如何删除 C++ std::string 中的重音符号和波浪号中使用简单的基于表格的方法。](https://stackoverflow.com/questions/144761/how-to-remove-accents-and-tilde-in-a-c-stdstring)

* * *

## 回答 #2

> 赞同：204
> 
> 时间：2010-01-18T14:16:44.353

这对我有用...

```
string accentedStr;
byte[] tempBytes;
tempBytes = System.Text.Encoding.GetEncoding("ISO-8859-8").GetBytes(accentedStr);
string asciiStr = System.Text.Encoding.UTF8.GetString(tempBytes); 
```

快&短！

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2015-12-14T16:46:33.917

我需要一些可以转换所有主要 unicode 字符的东西，而投票的答案遗漏了一些，所以我创建了一个 CodeIgniter 的`convert_accented_characters($str)`C# 版本，它很容易定制：

```
using System;
using System.Text;
using System.Collections.Generic;

public static class Strings
{
    static Dictionary<string, string> foreign_characters = new Dictionary<string, string>
    {
        { "äæǽ", "ae" },
        { "öœ", "oe" },
        { "ü", "ue" },
        { "Ä", "Ae" },
        { "Ü", "Ue" },
        { "Ö", "Oe" },
        { "ÀÁÂÃÄÅǺĀĂĄǍΑΆẢẠẦẪẨẬẰẮẴẲẶА", "A" },
        { "àáâãåǻāăąǎªαάảạầấẫẩậằắẵẳặа", "a" },
        { "Б", "B" },
        { "б", "b" },
        { "ÇĆĈĊČ", "C" },
        { "çćĉċč", "c" },
        { "Д", "D" },
        { "д", "d" },
        { "ÐĎĐΔ", "Dj" },
        { "ðďđδ", "dj" },
        { "ÈÉÊËĒĔĖĘĚΕΈẼẺẸỀẾỄỂỆЕЭ", "E" },
        { "èéêëēĕėęěέεẽẻẹềếễểệеэ", "e" },
        { "Ф", "F" },
        { "ф", "f" },
        { "ĜĞĠĢΓГҐ", "G" },
        { "ĝğġģγгґ", "g" },
        { "ĤĦ", "H" },
        { "ĥħ", "h" },
        { "ÌÍÎÏĨĪĬǏĮİΗΉΊΙΪỈỊИЫ", "I" },
        { "ìíîïĩīĭǐįıηήίιϊỉịиыї", "i" },
        { "Ĵ", "J" },
        { "ĵ", "j" },
        { "ĶΚК", "K" },
        { "ķκк", "k" },
        { "ĹĻĽĿŁΛЛ", "L" },
        { "ĺļľŀłλл", "l" },
        { "М", "M" },
        { "м", "m" },
        { "ÑŃŅŇΝН", "N" },
        { "ñńņňŉνн", "n" },
        { "ÒÓÔÕŌŎǑŐƠØǾΟΌΩΏỎỌỒỐỖỔỘỜỚỠỞỢО", "O" },
        { "òóôõōŏǒőơøǿºοόωώỏọồốỗổộờớỡởợо", "o" },
        { "П", "P" },
        { "п", "p" },
        { "ŔŖŘΡР", "R" },
        { "ŕŗřρр", "r" },
        { "ŚŜŞȘŠΣС", "S" },
        { "śŝşșšſσςс", "s" },
        { "ȚŢŤŦτТ", "T" },
        { "țţťŧт", "t" },
        { "ÙÚÛŨŪŬŮŰŲƯǓǕǗǙǛŨỦỤỪỨỮỬỰУ", "U" },
        { "ùúûũūŭůűųưǔǖǘǚǜυύϋủụừứữửựу", "u" },
        { "ÝŸŶΥΎΫỲỸỶỴЙ", "Y" },
        { "ýÿŷỳỹỷỵй", "y" },
        { "В", "V" },
        { "в", "v" },
        { "Ŵ", "W" },
        { "ŵ", "w" },
        { "ŹŻŽΖЗ", "Z" },
        { "źżžζз", "z" },
        { "ÆǼ", "AE" },
        { "ß", "ss" },
        { "Ĳ", "IJ" },
        { "ĳ", "ij" },
        { "Œ", "OE" },
        { "ƒ", "f" },
        { "ξ", "ks" },
        { "π", "p" },
        { "β", "v" },
        { "μ", "m" },
        { "ψ", "ps" },
        { "Ё", "Yo" },
        { "ё", "yo" },
        { "Є", "Ye" },
        { "є", "ye" },
        { "Ї", "Yi" },
        { "Ж", "Zh" },
        { "ж", "zh" },
        { "Х", "Kh" },
        { "х", "kh" },
        { "Ц", "Ts" },
        { "ц", "ts" },
        { "Ч", "Ch" },
        { "ч", "ch" },
        { "Ш", "Sh" },
        { "ш", "sh" },
        { "Щ", "Shch" },
        { "щ", "shch" },
        { "ЪъЬь", "" },
        { "Ю", "Yu" },
        { "ю", "yu" },
        { "Я", "Ya" },
        { "я", "ya" },
    };

    public static char RemoveDiacritics(this char c){
        foreach(KeyValuePair<string, string> entry in foreign_characters)
        {
            if(entry.Key.IndexOf (c) != -1)
            {
                return entry.Value[0];
            }
        }
        return c;
    }

    public static string RemoveDiacritics(this string s) 
    {
        //StringBuilder sb = new StringBuilder ();
        string text = "";

        foreach (char c in s)
        {
            int len = text.Length;

            foreach(KeyValuePair<string, string> entry in foreign_characters)
            {
                if(entry.Key.IndexOf (c) != -1)
                {
                    text += entry.Value;
                    break;
                }
            }

            if (len == text.Length) {
                text += c;  
            }
        }
        return text;
    }
} 
```

**用法**

```
// for strings
"crème brûlée".RemoveDiacritics (); // creme brulee

// for chars
"Ã"[0].RemoveDiacritics (); // A 
```

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2009-04-23T08:32:00.680

如果有人感兴趣，我正在寻找类似的东西并结束写以下内容：

```
public static string NormalizeStringForUrl(string name)
{
    String normalizedString = name.Normalize(NormalizationForm.FormD);
    StringBuilder stringBuilder = new StringBuilder();

    foreach (char c in normalizedString)
    {
        switch (CharUnicodeInfo.GetUnicodeCategory(c))
        {
            case UnicodeCategory.LowercaseLetter:
            case UnicodeCategory.UppercaseLetter:
            case UnicodeCategory.DecimalDigitNumber:
                stringBuilder.Append(c);
                break;
            case UnicodeCategory.SpaceSeparator:
            case UnicodeCategory.ConnectorPunctuation:
            case UnicodeCategory.DashPunctuation:
                stringBuilder.Append('_');
                break;
        }
    }
    string result = stringBuilder.ToString();
    return String.Join("_", result.Split(new char[] { '_' }
        , StringSplitOptions.RemoveEmptyEntries)); // remove duplicate underscores
} 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2012-10-31T10:05:38.013

我经常使用基于我在这里找到的另一个版本的扩展方法（请参阅[Replacing characters in C# (ascii)](https://stackoverflow.com/questions/5459641/replacing-characters-in-c-sharp-ascii/13154805#13154805)）快速解释：

*   规范化以形成 D 将**è**等字符拆分为**e**和非间距**`**
*   从这里，nospacing 字符被删除
*   结果被归一化回形式 C（我不确定这是否必要）

代码：

```
using System.Linq;
using System.Text;
using System.Globalization;

// namespace here
public static class Utility
{
    public static string RemoveDiacritics(this string str)
    {
        if (null == str) return null;
        var chars =
            from c in str.Normalize(NormalizationForm.FormD).ToCharArray()
            let uc = CharUnicodeInfo.GetUnicodeCategory(c)
            where uc != UnicodeCategory.NonSpacingMark
            select c;

        var cleanStr = new string(chars.ToArray()).Normalize(NormalizationForm.FormC);

        return cleanStr;
    }

    // or, alternatively
    public static string RemoveDiacritics2(this string str)
    {
        if (null == str) return null;
        var chars = str
            .Normalize(NormalizationForm.FormD)
            .ToCharArray()
            .Where(c=> CharUnicodeInfo.GetUnicodeCategory(c) != UnicodeCategory.NonSpacingMark)
            .ToArray();

        return new string(chars).Normalize(NormalizationForm.FormC);
    }
} 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2016-08-05T01:46:49.567

**希腊语 (ISO)**的 CodePage可以做到

有关此代码页的信息位于`System.Text.Encoding.GetEncodings()`. 了解：[https ://msdn.microsoft.com/pt-br/library/system.text.encodinginfo.getencoding(v=vs.110).aspx](https://msdn.microsoft.com/pt-br/library/system.text.encodinginfo.getencoding(v=vs.110).aspx)

希腊语 (ISO) 的代码页**为 28597**，名称为**iso-8859-7**。

转到代码... \o/

```
string text = "Você está numa situação lamentável";

string textEncode = System.Web.HttpUtility.UrlEncode(text, Encoding.GetEncoding("iso-8859-7"));
//result: "Voce+esta+numa+situacao+lamentavel"

string textDecode = System.Web.HttpUtility.UrlDecode(textEncode);
//result: "Voce esta numa situacao lamentavel" 
```

所以，写这个函数......

```
public string RemoveAcentuation(string text)
{
    return
        System.Web.HttpUtility.UrlDecode(
            System.Web.HttpUtility.UrlEncode(
                text, Encoding.GetEncoding("iso-8859-7")));
} 
```

注意...`Encoding.GetEncoding("iso-8859-7")`等价于`Encoding.GetEncoding(28597)`因为 first 是名称，其次是 Encoding 的代码页。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2019-06-27T19:33:43.437

TL;DR - [C# 字符串扩展方法](https://gist.github.com/andyraddatz/e6a396fb91856174d4e3f1bf2e10951c)

我认为保留字符串含义的最佳解决方案是将字符转换而不是剥离它们，这在示例中很好地说明`crème brûlée`了`crme brle`vs. `creme brulee`。

我查看了[上面 Alexander 的评论](https://stackoverflow.com/questions/249087/how-do-i-remove-diacritics-accents-from-a-string-in-net#comment86833005_34272324)，发现 Lucene.Net 代码是 Apache 2.0 许可的，所以我将这个类修改为一个简单的字符串扩展方法。你可以像这样使用它：

```
var originalString = "crème brûlée";
var maxLength = originalString.Length; // limit output length as necessary
var foldedString = originalString.FoldToASCII(maxLength); 
// "creme brulee" 
```

该函数太长，无法在 StackOverflow 答案中发布（允许 30k 的约 139k 个字符，哈哈），所以[我做了一个要点并归因于作者](https://gist.github.com/andyraddatz/e6a396fb91856174d4e3f1bf2e10951c)：

```
/*
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * this work for additional information regarding copyright ownership.
 * The ASF licenses this file to You under the Apache License, Version 2.0
 * (the "License"); you may not use this file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/// <summary>
/// This class converts alphabetic, numeric, and symbolic Unicode characters
/// which are not in the first 127 ASCII characters (the "Basic Latin" Unicode
/// block) into their ASCII equivalents, if one exists.
/// <para/>
/// Characters from the following Unicode blocks are converted; however, only
/// those characters with reasonable ASCII alternatives are converted:
/// 
/// <ul>
///   <item><description>C1 Controls and Latin-1 Supplement: <a href="http://www.unicode.org/charts/PDF/U0080.pdf">http://www.unicode.org/charts/PDF/U0080.pdf</a></description></item>
///   <item><description>Latin Extended-A: <a href="http://www.unicode.org/charts/PDF/U0100.pdf">http://www.unicode.org/charts/PDF/U0100.pdf</a></description></item>
///   <item><description>Latin Extended-B: <a href="http://www.unicode.org/charts/PDF/U0180.pdf">http://www.unicode.org/charts/PDF/U0180.pdf</a></description></item>
///   <item><description>Latin Extended Additional: <a href="http://www.unicode.org/charts/PDF/U1E00.pdf">http://www.unicode.org/charts/PDF/U1E00.pdf</a></description></item>
///   <item><description>Latin Extended-C: <a href="http://www.unicode.org/charts/PDF/U2C60.pdf">http://www.unicode.org/charts/PDF/U2C60.pdf</a></description></item>
///   <item><description>Latin Extended-D: <a href="http://www.unicode.org/charts/PDF/UA720.pdf">http://www.unicode.org/charts/PDF/UA720.pdf</a></description></item>
///   <item><description>IPA Extensions: <a href="http://www.unicode.org/charts/PDF/U0250.pdf">http://www.unicode.org/charts/PDF/U0250.pdf</a></description></item>
///   <item><description>Phonetic Extensions: <a href="http://www.unicode.org/charts/PDF/U1D00.pdf">http://www.unicode.org/charts/PDF/U1D00.pdf</a></description></item>
///   <item><description>Phonetic Extensions Supplement: <a href="http://www.unicode.org/charts/PDF/U1D80.pdf">http://www.unicode.org/charts/PDF/U1D80.pdf</a></description></item>
///   <item><description>General Punctuation: <a href="http://www.unicode.org/charts/PDF/U2000.pdf">http://www.unicode.org/charts/PDF/U2000.pdf</a></description></item>
///   <item><description>Superscripts and Subscripts: <a href="http://www.unicode.org/charts/PDF/U2070.pdf">http://www.unicode.org/charts/PDF/U2070.pdf</a></description></item>
///   <item><description>Enclosed Alphanumerics: <a href="http://www.unicode.org/charts/PDF/U2460.pdf">http://www.unicode.org/charts/PDF/U2460.pdf</a></description></item>
///   <item><description>Dingbats: <a href="http://www.unicode.org/charts/PDF/U2700.pdf">http://www.unicode.org/charts/PDF/U2700.pdf</a></description></item>
///   <item><description>Supplemental Punctuation: <a href="http://www.unicode.org/charts/PDF/U2E00.pdf">http://www.unicode.org/charts/PDF/U2E00.pdf</a></description></item>
///   <item><description>Alphabetic Presentation Forms: <a href="http://www.unicode.org/charts/PDF/UFB00.pdf">http://www.unicode.org/charts/PDF/UFB00.pdf</a></description></item>
///   <item><description>Halfwidth and Fullwidth Forms: <a href="http://www.unicode.org/charts/PDF/UFF00.pdf">http://www.unicode.org/charts/PDF/UFF00.pdf</a></description></item>
/// </ul>
/// <para/>
/// See: <a href="http://en.wikipedia.org/wiki/Latin_characters_in_Unicode">http://en.wikipedia.org/wiki/Latin_characters_in_Unicode</a>
/// <para/>
/// For example, '&amp;agrave;' will be replaced by 'a'.
/// </summary>
public static partial class StringExtensions
{
    /// <summary>
    /// Converts characters above ASCII to their ASCII equivalents.  For example,
    /// accents are removed from accented characters. 
    /// </summary>
    /// <param name="input">     The string of characters to fold </param>
    /// <param name="length">    The length of the folded return string </param>
    /// <returns> length of output </returns>
    public static string FoldToASCII(this string input, int? length = null)
    {
        // See https://gist.github.com/andyraddatz/e6a396fb91856174d4e3f1bf2e10951c
    }
} 
```

希望对其他人有所帮助，这是我找到的最强大的解决方案！

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2017-02-06T13:19:11.337

有趣的是，这样的问题可以得到这么多答案，但没有一个符合我的要求:) 周围有这么多语言，AFAIK 不可能实现完整的语言不可知论解决方案，因为其他人提到 FormC 或 FormD 正在给出问题。

由于最初的问题与法语有关，因此最简单的工作答案确实是

```
 public static string ConvertWesternEuropeanToASCII(this string str)
    {
        return Encoding.ASCII.GetString(Encoding.GetEncoding(1251).GetBytes(str));
    } 
```

1251 应替换为输入语言的编码代码。

然而，这仅用一个字符替换一个字符。由于我还使用德语作为输入，因此我进行了手动转换

```
 public static string LatinizeGermanCharacters(this string str)
    {
        StringBuilder sb = new StringBuilder(str.Length);
        foreach (char c in str)
        {
            switch (c)
            {
                case 'ä':
                    sb.Append("ae");
                    break;
                case 'ö':
                    sb.Append("oe");
                    break;
                case 'ü':
                    sb.Append("ue");
                    break;
                case 'Ä':
                    sb.Append("Ae");
                    break;
                case 'Ö':
                    sb.Append("Oe");
                    break;
                case 'Ü':
                    sb.Append("Ue");
                    break;
                case 'ß':
                    sb.Append("ss");
                    break;
                default:
                    sb.Append(c);
                    break;
            }
        }
        return sb.ToString();
    } 
```

它可能无法提供最佳性能，但至少它非常易于阅读和扩展。正则表达式是不行的，比任何字符/字符串的东西都要慢得多。

我还有一个非常简单的删除空间的方法：

```
 public static string RemoveSpace(this string str)
    {
        return str.Replace(" ", string.Empty);
    } 
```

最终，我使用了上述所有 3 个扩展的组合：

```
 public static string LatinizeAndConvertToASCII(this string str, bool keepSpace = false)
    {
        str = str.LatinizeGermanCharacters().ConvertWesternEuropeanToASCII();            
        return keepSpace ? str : str.RemoveSpace();
    } 
```

以及一个成功通过的小单元测试（不是详尽的）。

```
 [TestMethod()]
    public void LatinizeAndConvertToASCIITest()
    {
        string europeanStr = "Bonjour ça va? C'est l'été! Ich möchte ä Ä á à â ê é è ë Ë É ï Ï î í ì ó ò ô ö Ö Ü ü ù ú û Û ý Ý ç Ç ñ Ñ";
        string expected = "Bonjourcava?C'estl'ete!IchmoechteaeAeaaaeeeeEEiIiiiooooeOeUeueuuuUyYcCnN";
        string actual = europeanStr.LatinizeAndConvertToASCII();
        Assert.AreEqual(expected, actual);
    } 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2021-05-17T12:40:09.423

公认的答案是完全正确的，但现在应该更新它以使用[Rune](https://docs.microsoft.com/en-us/dotnet/api/system.text.rune?view=net-5.0)类而不是`CharUnicodeInfo`.NET，因为 C# 和 .NET 更新了最新版本中分析字符串的方式（.NET Core 3.0 中添加了 Rune 类）。

现在推荐使用 .NET 5+ 的以下代码，因为它更适用于非拉丁字符：

```
static string RemoveDiacritics(string text) 
{
    var normalizedString = text.Normalize(NormalizationForm.FormD);
    var stringBuilder = new StringBuilder();

    foreach (var c in normalizedString.EnumerateRunes())
    {
        var unicodeCategory = Rune.GetUnicodeCategory(c);
        if (unicodeCategory != UnicodeCategory.NonSpacingMark)
        {
            stringBuilder.Append(c);
        }
    }

    return stringBuilder.ToString().Normalize(NormalizationForm.FormC);
} 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-07-28T13:21:20.587

这是 VB 版本（适用于希腊语）：

导入 System.Text

进口系统.全球化

```
Public Function RemoveDiacritics(ByVal s As String)
    Dim normalizedString As String
    Dim stringBuilder As New StringBuilder
    normalizedString = s.Normalize(NormalizationForm.FormD)
    Dim i As Integer
    Dim c As Char
    For i = 0 To normalizedString.Length - 1
        c = normalizedString(i)
        If CharUnicodeInfo.GetUnicodeCategory(c) <> UnicodeCategory.NonSpacingMark Then
            stringBuilder.Append(c)
        End If
    Next
    Return stringBuilder.ToString()
End Function 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2013-08-01T18:55:31.563

这就是我在所有 .NET 程序中将变音符号替换为非变音符号的方法

C＃：

```
//Transforms the culture of a letter to its equivalent representation in the 0-127 ascii table, such as the letter 'é' is substituted by an 'e'
public string RemoveDiacritics(string s)
{
    string normalizedString = null;
    StringBuilder stringBuilder = new StringBuilder();
    normalizedString = s.Normalize(NormalizationForm.FormD);
    int i = 0;
    char c = '\0';

    for (i = 0; i <= normalizedString.Length - 1; i++)
    {
        c = normalizedString[i];
        if (CharUnicodeInfo.GetUnicodeCategory(c) != UnicodeCategory.NonSpacingMark)
        {
            stringBuilder.Append(c);
        }
    }

    return stringBuilder.ToString().ToLower();
} 
```

VB.NET：

```
'Transforms the culture of a letter to its equivalent representation in the 0-127 ascii table, such as the letter "é" is substituted by an "e"'
Public Function RemoveDiacritics(ByVal s As String) As String
    Dim normalizedString As String
    Dim stringBuilder As New StringBuilder
    normalizedString = s.Normalize(NormalizationForm.FormD)
    Dim i As Integer
    Dim c As Char

    For i = 0 To normalizedString.Length - 1
        c = normalizedString(i)
        If CharUnicodeInfo.GetUnicodeCategory(c) <> UnicodeCategory.NonSpacingMark Then
            stringBuilder.Append(c)
        End If
    Next
    Return stringBuilder.ToString().ToLower()
End Function 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2017-05-21T21:10:25.160

如果您还没有考虑过，请在此处弹出此库。看起来有各种各样的单元测试。

[https://github.com/thomasgalliker/Diacritics.NET](https://github.com/thomasgalliker/Diacritics.NET)

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-05-03T02:25:24.463

试试[HelperSharp 包](https://github.com/giacomelli/HelperSharp)。

有一个方法RemoveAccents：

```
 public static string RemoveAccents(this string source)
 {
     //8 bit characters 
     byte[] b = Encoding.GetEncoding(1251).GetBytes(source);

     // 7 bit characters
     string t = Encoding.ASCII.GetString(b);
     Regex re = new Regex("[^a-zA-Z0-9]=-_/");
     string c = re.Replace(t, " ");
     return c;
 } 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-12-30T10:25:13.883

您可以使用 MMLib.Extensions nuget 包中的字符串扩展名：

```
using MMLib.RapidPrototyping.Generators;
public void ExtensionsExample()
{
  string target = "aácčeéií";
  Assert.AreEqual("aacceeii", target.RemoveDiacritics());
} 
```

* * *

Nuget 页面：[https](https://www.nuget.org/packages/MMLib.Extensions/) ://www.nuget.org/packages/MMLib.Extensions/ Codeplex 项目站点[https://mmlib.codeplex.com/](https://mmlib.codeplex.com/)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2015-06-22T13:34:46.837

```
Imports System.Text
Imports System.Globalization

 Public Function DECODE(ByVal x As String) As String
        Dim sb As New StringBuilder
        For Each c As Char In x.Normalize(NormalizationForm.FormD).Where(Function(a) CharUnicodeInfo.GetUnicodeCategory(a) <> UnicodeCategory.NonSpacingMark)  
            sb.Append(c)
        Next
        Return sb.ToString()
    End Function 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2015-12-11T17:09:47.823

[这个人怎么说：](https://stackoverflow.com/a/148137/3638471)

`Encoding.ASCII.GetString(Encoding.GetEncoding(1251).GetBytes(text));`

它实际上将`å`其中一个字符（即字符代码`00E5`，*而不是* 看起来相同`0061`的修饰符）拆分为plus 某种修饰符，然后 ASCII 转换删除修饰符，留下唯一的.`030A``a``a`

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2017-02-14T18:54:17.283

我真的很喜欢[azrafe7](https://stackoverflow.com/users/253243/azrafe7)提供的简洁实用的代码。因此，我对其进行了一些更改以将其转换为扩展方法：

```
public static class StringExtensions
{
    public static string RemoveDiacritics(this string text)
    {
        const string SINGLEBYTE_LATIN_ASCII_ENCODING = "ISO-8859-8";

        if (string.IsNullOrEmpty(text))
        {
            return string.Empty;
        }

        return Encoding.ASCII.GetString(
            Encoding.GetEncoding(SINGLEBYTE_LATIN_ASCII_ENCODING).GetBytes(text));
    }
} 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2021-04-21T06:09:41.603

与接受的答案相同，但速度更快，使用`Span`而不是`StringBuilder`.
需要 .NET Core 3.1 或更新的 .NET。

```
static string RemoveDiacritics(string text) 
{
    ReadOnlySpan<char> normalizedString = text.Normalize(NormalizationForm.FormD);
    int i = 0;
    Span<char> span = text.Length < 1000
        ? stackalloc char[text.Length]
        : new char[text.Length];

    foreach (char c in normalizedString)
    {
        if (CharUnicodeInfo.GetUnicodeCategory(c) != UnicodeCategory.NonSpacingMark)
            span[i++] = c;
    }

    return new string(span).Normalize(NormalizationForm.FormC);
} 
```

这也可以扩展为额外的字符替换，例如波兰语Ł。

```
span[i++] = c switch
{
    'Ł' = 'L',
    'ł' => 'l',
    _ => c
}; 
```

一个小提示：堆栈分配`stackalloc`比堆分配要快`new`，它减少了垃圾收集器的工作。`1000`是避免在 Stack 上分配大型结构的阈值，这可能会导致`StackOverflowException`. 虽然 1000 是一个非常安全的值，但在大多数情况下，10000 甚至 100000 也可以工作（100k 在堆栈上分配高达 200kB，而默认堆栈大小为 1 MB），但是 100k 对我来说有点危险。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2020-09-03T17:45:14.720

这段代码对我有用：

```
var updatedText = text.Normalize(NormalizationForm.FormD)
     .Where(c => CharUnicodeInfo.GetUnicodeCategory(c) != UnicodeCategory.NonSpacingMark)
     .ToArray(); 
```

**但是，请不要对名称执行此操作。**这不仅是对名字中带有元音变音/口音的人的侮辱，在某些情况下也可能是危险的错误（见下文）。有替代的写作，而不是仅仅去除口音。

**此外，这完全是错误和危险的**，例如，如果用户必须准确地提供他的姓名在护照上的出现方式。

例如，我的名字写`Zuberbühler`在我护照的机器可读部分，你会发现`Zuberbuehler`。通过删除变音符号，名称将不匹配任何部分。这可能会给用户带来问题。

**您应该在****名称**的输入表单中禁止使用元音变音/重音，这样用户就可以正确地写出他的名字而没有元音变音或重音。

实际示例，如果申请 ESTA 的 Web 服务 ( [https://www.application-esta.co.uk/special-characters-and](https://www.application-esta.co.uk/special-characters-and) ) 将使用上述代码而不是正确转换元音变音，则 ESTA 申请将被拒绝或旅行者在进入美国时会遇到美国边境管制局的问题。

另一个例子是机票。假设您有一个机票预订 Web 应用程序，用户为他的名字提供了一个重音符号，而您的实现只是删除重音符号，然后使用航空公司的 Web 服务来预订机票！您的客户可能不被允许登机，因为姓名与他/她护照的任何部分都不匹配。

* * *

## 回答 #20

> 赞同：-5
> 
> 时间：2019-04-13T21:19:05.707

没有足够的声誉，显然我无法评论亚历山大的优秀链接。- Lucene 似乎是在合理通用情况下工作的唯一解决方案。

对于那些想要一个简单的复制粘贴解决方案的人来说，这里是利用 Lucene 中的代码：

string testbed = "ÁÂÄÅÇÉÍÎÓÖØÚÜÞàáââãäåæçèééêëìíïïðñóôöøúüāăčĐęğıŁłńŌōřŞşšźžşşệủ";

Console.WriteLine(Lucene.latinizeLucene(testbed));

> > 啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊啊

//////////

```
public static class Lucene
{
    // source: https://raw.githubusercontent.com/apache/lucenenet/master/src/Lucene.Net.Analysis.Common/Analysis/Miscellaneous/ASCIIFoldingFilter.cs
    // idea: https://stackoverflow.com/questions/249087/how-do-i-remove-diacritics-accents-from-a-string-in-net (scroll down, search for lucene by Alexander)
    public static string latinizeLucene(string arg)
    {
        char[] argChar = arg.ToCharArray();

        // latinizeLuceneImpl can expand one char up to four chars - e.g. Þ to TH, or æ to ae, or in fact ⑽ to (10)
        char[] resultChar = new String(' ', arg.Length * 4).ToCharArray();

        int outputPos = Lucene.latinizeLuceneImpl(argChar, 0, ref resultChar, 0, arg.Length);

        string ret = new string(resultChar);
        ret = ret.Substring(0, outputPos);

        return ret;
    }

    /// <summary>
    /// Converts characters above ASCII to their ASCII equivalents.  For example,
    /// accents are removed from accented characters. 
    /// <para/>
    /// @lucene.internal
    /// </summary>
    /// <param name="input">     The characters to fold </param>
    /// <param name="inputPos">  Index of the first character to fold </param>
    /// <param name="output">    The result of the folding. Should be of size >= <c>length * 4</c>. </param>
    /// <param name="outputPos"> Index of output where to put the result of the folding </param>
    /// <param name="length">    The number of characters to fold </param>
    /// <returns> length of output </returns>
    private static int latinizeLuceneImpl(char[] input, int inputPos, ref char[] output, int outputPos, int length)
    {
        int end = inputPos + length;
        for (int pos = inputPos; pos < end; ++pos)
        {
            char c = input[pos];

            // Quick test: if it's not in range then just keep current character
            if (c < '\u0080')
            {
                output[outputPos++] = c;
            }
            else
            {
                switch (c)
                {
                    case '\u00C0': // À  [LATIN CAPITAL LETTER A WITH GRAVE]
                    case '\u00C1': // Á  [LATIN CAPITAL LETTER A WITH ACUTE]
                    case '\u00C2': // Â  [LATIN CAPITAL LETTER A WITH CIRCUMFLEX]
                    case '\u00C3': // Ã  [LATIN CAPITAL LETTER A WITH TILDE]
                    case '\u00C4': // Ä  [LATIN CAPITAL LETTER A WITH DIAERESIS]
                    case '\u00C5': // Å  [LATIN CAPITAL LETTER A WITH RING ABOVE]
                    case '\u0100': // Ā  [LATIN CAPITAL LETTER A WITH MACRON]
                    case '\u0102': // Ă  [LATIN CAPITAL LETTER A WITH BREVE]
                    case '\u0104': // Ą  [LATIN CAPITAL LETTER A WITH OGONEK]
                    case '\u018F': // Ə  http://en.wikipedia.org/wiki/Schwa  [LATIN CAPITAL LETTER SCHWA]
                    case '\u01CD': // Ǎ  [LATIN CAPITAL LETTER A WITH CARON]
                    case '\u01DE': // Ǟ  [LATIN CAPITAL LETTER A WITH DIAERESIS AND MACRON]
                    case '\u01E0': // Ǡ  [LATIN CAPITAL LETTER A WITH DOT ABOVE AND MACRON]
                    case '\u01FA': // Ǻ  [LATIN CAPITAL LETTER A WITH RING ABOVE AND ACUTE]
                    case '\u0200': // Ȁ  [LATIN CAPITAL LETTER A WITH DOUBLE GRAVE]
                    case '\u0202': // Ȃ  [LATIN CAPITAL LETTER A WITH INVERTED BREVE]
                    case '\u0226': // Ȧ  [LATIN CAPITAL LETTER A WITH DOT ABOVE]
                    case '\u023A': // Ⱥ  [LATIN CAPITAL LETTER A WITH STROKE]
                    case '\u1D00': // ᴀ  [LATIN LETTER SMALL CAPITAL A]
                    case '\u1E00': // Ḁ  [LATIN CAPITAL LETTER A WITH RING BELOW]
                    case '\u1EA0': // Ạ  [LATIN CAPITAL LETTER A WITH DOT BELOW]
                    case '\u1EA2': // Ả  [LATIN CAPITAL LETTER A WITH HOOK ABOVE]
                    case '\u1EA4': // Ấ  [LATIN CAPITAL LETTER A WITH CIRCUMFLEX AND ACUTE]
                    case '\u1EA6': // Ầ  [LATIN CAPITAL LETTER A WITH CIRCUMFLEX AND GRAVE]
                    case '\u1EA8': // Ẩ  [LATIN CAPITAL LETTER A WITH CIRCUMFLEX AND HOOK ABOVE]
                    case '\u1EAA': // Ẫ  [LATIN CAPITAL LETTER A WITH CIRCUMFLEX AND TILDE]
                    case '\u1EAC': // Ậ  [LATIN CAPITAL LETTER A WITH CIRCUMFLEX AND DOT BELOW]
                    case '\u1EAE': // Ắ  [LATIN CAPITAL LETTER A WITH BREVE AND ACUTE]
                    case '\u1EB0': // Ằ  [LATIN CAPITAL LETTER A WITH BREVE AND GRAVE]
                    case '\u1EB2': // Ẳ  [LATIN CAPITAL LETTER A WITH BREVE AND HOOK ABOVE]
                    case '\u1EB4': // Ẵ  [LATIN CAPITAL LETTER A WITH BREVE AND TILDE]
                    case '\u1EB6': // Ặ  [LATIN CAPITAL LETTER A WITH BREVE AND DOT BELOW]
                    case '\u24B6': // Ⓐ  [CIRCLED LATIN CAPITAL LETTER A]
                    case '\uFF21': // Ａ  [FULLWIDTH LATIN CAPITAL LETTER A]
                        output[outputPos++] = 'A';
                        break;
                    case '\u00E0': // à  [LATIN SMALL LETTER A WITH GRAVE]
                    case '\u00E1': // á  [LATIN SMALL LETTER A WITH ACUTE]
                    case '\u00E2': // â  [LATIN SMALL LETTER A WITH CIRCUMFLEX]
                    case '\u00E3': // ã  [LATIN SMALL LETTER A WITH TILDE]
                    case '\u00E4': // ä  [LATIN SMALL LETTER A WITH DIAERESIS]
                    case '\u00E5': // å  [LATIN SMALL LETTER A WITH RING ABOVE]
                    case '\u0101': // ā  [LATIN SMALL LETTER A WITH MACRON]
                    case '\u0103': // ă  [LATIN SMALL LETTER A WITH BREVE]
                    case '\u0105': // ą  [LATIN SMALL LETTER A WITH OGONEK]
                    case '\u01CE': // ǎ  [LATIN SMALL LETTER A WITH CARON]
                    case '\u01DF': // ǟ  [LATIN SMALL LETTER A WITH DIAERESIS AND MACRON]
                    case '\u01E1': // ǡ  [LATIN SMALL LETTER A WITH DOT ABOVE AND MACRON]
                    case '\u01FB': // ǻ  [LATIN SMALL LETTER A WITH RING ABOVE AND ACUTE]
                    case '\u0201': // ȁ  [LATIN SMALL LETTER A WITH DOUBLE GRAVE]
                    case '\u0203': // ȃ  [LATIN SMALL LETTER A WITH INVERTED BREVE]
                    case '\u0227': // ȧ  [LATIN SMALL LETTER A WITH DOT ABOVE]
                    case '\u0250': // ɐ  [LATIN SMALL LETTER TURNED A]
                    case '\u0259': // ə  [LATIN SMALL LETTER SCHWA]
                    case '\u025A': // ɚ  [LATIN SMALL LETTER SCHWA WITH HOOK]
                    case '\u1D8F': // ᶏ  [LATIN SMALL LETTER A WITH RETROFLEX HOOK]
                    case '\u1D95': // ᶕ  [LATIN SMALL LETTER SCHWA WITH RETROFLEX HOOK]
                    case '\u1E01': // ạ  [LATIN SMALL LETTER A WITH RING BELOW]
                    case '\u1E9A': // ả  [LATIN SMALL LETTER A WITH RIGHT HALF RING]
                    case '\u1EA1': // ạ  [LATIN SMALL LETTER A WITH DOT BELOW]
                    case '\u1EA3': // ả  [LATIN SMALL LETTER A WITH HOOK ABOVE]
                    case '\u1EA5': // ấ  [LATIN SMALL LETTER A WITH CIRCUMFLEX AND ACUTE]
                    case '\u1EA7': // ầ  [LATIN SMALL LETTER A WITH CIRCUMFLEX AND GRAVE]
                    case '\u1EA9': // ẩ  [LATIN SMALL LETTER A WITH CIRCUMFLEX AND HOOK ABOVE]
                    case '\u1EAB': // ẫ  [LATIN SMALL LETTER A WITH CIRCUMFLEX AND TILDE]
                    case '\u1EAD': // ậ  [LATIN SMALL LETTER A WITH CIRCUMFLEX AND DOT BELOW]
                    case '\u1EAF': // ắ  [LATIN SMALL LETTER A WITH BREVE AND ACUTE]
                    case '\u1EB1': // ằ  [LATIN SMALL LETTER A WITH BREVE AND GRAVE]
                    case '\u1EB3': // ẳ  [LATIN SMALL LETTER A WITH BREVE AND HOOK ABOVE]
                    case '\u1EB5': // ẵ  [LATIN SMALL LETTER A WITH BREVE AND TILDE]
                    case '\u1EB7': // ặ  [LATIN SMALL LETTER A WITH BREVE AND DOT BELOW]
                    case '\u2090': // ₐ  [LATIN SUBSCRIPT SMALL LETTER A]
                    case '\u2094': // ₔ  [LATIN SUBSCRIPT SMALL LETTER SCHWA]
                    case '\u24D0': // ⓐ  [CIRCLED LATIN SMALL LETTER A]
                    case '\u2C65': // ⱥ  [LATIN SMALL LETTER A WITH STROKE]
                    case '\u2C6F': // Ɐ  [LATIN CAPITAL LETTER TURNED A]
                    case '\uFF41': // ａ  [FULLWIDTH LATIN SMALL LETTER A]
                        output[outputPos++] = 'a';
                        break;
                    case '\uA732': // Ꜳ  [LATIN CAPITAL LETTER AA]
                        output[outputPos++] = 'A';
                        output[outputPos++] = 'A';
                        break;
                    case '\u00C6': // Æ  [LATIN CAPITAL LETTER AE]
                    case '\u01E2': // Ǣ  [LATIN CAPITAL LETTER AE WITH MACRON]
                    case '\u01FC': // Ǽ  [LATIN CAPITAL LETTER AE WITH ACUTE]
                    case '\u1D01': // ᴁ  [LATIN LETTER SMALL CAPITAL AE]
                        output[outputPos++] = 'A';
                        output[outputPos++] = 'E';
                        break;
                    case '\uA734': // Ꜵ  [LATIN CAPITAL LETTER AO]
                        output[outputPos++] = 'A';
                        output[outputPos++] = 'O';
                        break;
                    case '\uA736': // Ꜷ  [LATIN CAPITAL LETTER AU]
                        output[outputPos++] = 'A';
                        output[outputPos++] = 'U';
                        break;

        // etc. etc. etc.
        // see link above for complete source code
        // 
        // unfortunately, postings are limited, as in
        // "Body is limited to 30000 characters; you entered 136098."

                    [...]

                    case '\u2053': // ⁓  [SWUNG DASH]
                    case '\uFF5E': // ～  [FULLWIDTH TILDE]
                        output[outputPos++] = '~';
                        break;
                    default:
                        output[outputPos++] = c;
                        break;
                }
            }
        }
        return outputPos;
    }
} 
```

# css - IE7 和 CSS 表格单元格属性

> ID：249103
> 
> 赞同：32
> 
> 时间：2008-10-30T02:14:21.003
> 
> 标签：css, cross-browser, internet-explorer-7, css-tables

所以我只是喜欢我的应用程序在 Firefox 中运行良好，然后我在 IE 中打开它，然后......不，请再试一次。

我遇到的问题是我将 CSS 显示属性设置为JavaScript`none`或`table-cell`JavaScript。

我最初使用的是 ，但 Firefox 在没有该属性`display: block`的情况下使它变得很奇怪。`table-cell`

我很乐意这样做，而无需在 JavaScript 中添加 hack 来测试 IE。有什么建议么？

谢谢。

* * *

## 回答 #1

> 赞同：48
> 
> 时间：2011-02-10T22:35:19.077

我已经使用 jQuery 解决了这个问题：

```
$(document).ready(function(){
  if ($.browser.msie && $.browser.version == 7)
  {
    $(".tablecell").wrap("<td />");
    $(".tablerow").wrap("<tr />");
    $(".table").wrapInner("<table />");
  }
}); 
```

上面的脚本假设您有使用样式的 div，例如：

```
<style>
.table     { display: table; }
.tablerow  { display: table-row; }
.tablecell { display: table-cell; }
</style> 
```

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-03-14T14:14:35.933

解决此设置`display`值的好方法`''`：

```
<script type="text/javascript">
<!--
function toggle( elemntId ) {
    if (document.getElementById( elemntId ).style.display != 'none') {
        document.getElementById( elemntId ).style.display = 'none';
    } else {
        document.getElementById( elemntId ).style.display = '';
    }
    return true;
}
//-->
</script> 
```

空值会导致样式恢复为默认值。此解决方案适用于所有主要浏览器。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-08-05T21:26:04.257

我有同样的问题并使用

```
*float: left; 
```

“*”表示仅 IE

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-30T02:24:21.110

好吧，[IE7 没有，`display: table(-cell/-row)`](http://www.quirksmode.org/css/display.html)所以你必须弄清楚其他事情或进行浏览器定位（我同意，这是不好的 hack）。作为一个快速修复（我不知道你想要实现什么，外观方面）你可以尝试`display: inline-block`看看它是什么样子。

也许想办法`display: block`解决“Firefox 渲染它很奇怪”的问题？你能准确描述一下奇怪的渲染是什么意思吗？

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-30T04:00:28.293

你永远不需要 Javascript 来测试 IE，使用[条件注释](http://www.quirksmode.org/css/condcom.html)。

您可能会查看[这些人](http://www.tjkdesign.com/articles/css-layout/no_div_no_float_no_clear_no_hack_no_joke.asp)提出的用于在 IE 中处理类似表格的显示的解决方案。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-08-08T21:07:12.260

使用 inline-block 非常适合这种类型的东西。不，IE 6 和 IE 7 在技术上没有 display: inline-block，但您可以使用以下样式复制该行为：

```
div.show-ib {
    display: inline-block;
    *zoom: 1;
    *display: inline;
} 
```

关键是 'zoom: 1' 切换元素上的 'hasLayout' 属性，这会改变浏览器呈现块级元素的方式。内联块的唯一问题是您的边距不能小于 4px。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-10-30T13:49:01.273

我已经使用 CSS 十多年了，我从来没有使用过 display:table-cell 的机会，而且我使用条件注释的唯一一次是隐藏 IE6 的高级效果。

我怀疑另一种方法会以本质上跨浏览器的方式解决您的问题。您能否打开一个单独的问题来描述您尝试实现的效果，并发布当前在 Firefox 中运行的 HTML 和 CSS？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-09-07T14:36:36.383

一个代码示例，用于用户眼睑的条件评论，请发布

“[if lt IE 8]”仅在浏览器的 IE 低于 IE8 时才有效，因为 IE8 是正确的。使用条件注释 IE7 可以很好地水平排列 DIV... HTML：

```
 <div class="container">
    <!--[if lt IE 8 ]><table><tr><![endif]--> 
    <!--[if lt IE 8 ]><td><![endif]-->
    <div class="link"><a href="en.html">English</a></div>
    <!--[if lt IE 8 ]></td><![endif]-->
    <!--[if lt IE 8 ]><td><![endif]-->
    <div tabindex="0" class="thumb"><img src="pictures\pic.jpg" /></div>
    <!--[if lt IE 8 ]></td><![endif]-->
    <!--[if lt IE 8 ]><td><![endif]-->
    <div class="link"><a href="de.html">Deutsch</a></div>
    <!--[if lt IE 8 ]></td><![endif]-->
    <!--[if lt IE 8 ]></tr></table><![endif]-->
</div> 
```

我的 CSS

```
.link {
 display:table-cell;
 vertical-align:middle;
 }
 div.container {
 margin: 0 auto;
 display:table;
 }
 .thumb {
 display:table-cell;
 float: left;
 text-align: center;
 } 
```

IE 8 和 9 像 FireFox 一样使用 CSS。IE7 现在使用 Table 和 TD & TR 标签看起来是一样的。在某些页面上，IE 8 的工作时间只有 20%，所以我使用了 [if lt IE 9]

这也有助于消除 IE7 无法处理的垂直对齐问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-01-23T17:29:58.373

我尝试了所有方法，发现所有跨浏览器的唯一方法是使用 Javascript / Jquery。这是一个干净的轻量级解决方案： [单击此处](http://www.ddrewdesign.com/blog/jquery-vertical-align-function)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-05-19T19:29:59.277

IE7也不支持`display:inline-block;`。一个明显的黑客攻击是`zoom: 1; *display: inline;`在你的 CSS 之后`display:table-cell;`

# python - Django：任意数量的未命名 urls.py 参数

> ID：249110
> 
> 赞同：20
> 
> 时间：2008-10-30T02:18:32.353
> 
> 标签：python, django, django-urls

我有一个包含大量字段和 20000 多个表行的 Django 模型。为了促进人类可读的 URL 和将大列表分解为任意子列表的能力，我希望有一个如下所示的 URL：

```
/browse/<name1>/<value1>/<name2>/<value2>/ .... etc .... 
```

其中“名称”映射到模型属性，“值”是该属性的搜索条件。每个“名称”都将被视为一个类别，以返回类别匹配的模型实例的子集。

现在，这可以使用 GET 参数来处理，但为了用户和搜索引擎，我更喜欢可读性更高的 URL。这些 URL 子集将嵌入显示此模型的每个页面上，因此制作漂亮的 URL 似乎值得。

理想情况下，每个名称/值对都将作为名为`name1`,`name2`等的参数传递给视图函数。但是，我不相信可以通过正则表达式的匹配文本来定义命名模式。我错了吗？

所以，看来我需要做这样的事情：

```
urlpatterns = patterns('',
    url(r'^browse/(?:([\w]+)/([\w]+)/)+$', 'app.views.view', name="model_browse"),
) 
```

看起来这应该匹配任何两个名称/值对的集合。虽然匹配成功，但它只将最后一个名称/值对作为参数传递给视图函数。我的猜测是每场比赛都会覆盖前一场比赛。在包含 (?:...)+ 的猜测下，我尝试了一个简单的重复模式：

```
urlpatterns = patterns('',
    url(r'^browse/([\w]+/)+$', 'app.views.view', name="model_browse"),
) 
```

...并遇到了同样的问题，但这次`*args`只包括最后一个匹配的模式。

这是 Django 的 url 调度程序和/或 Python 的正则表达式支持的限制吗？似乎这些方法中的任何一种都应该有效。有没有办法在不将 URL 中每个可能的模型属性硬编码为可选 (.*) 模式的情况下实现这一点？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-30T07:52:30.773

您可能考虑的一种可能性是匹配 url 模式部分中的整个可能值字符串，并在您的视图中提取特定部分。举个例子：

```
urlpatterns = patterns('',
    url(r'^browse/(?P<match>.+)/$', 'app.views.view', name='model_browse'),
)

def view(request, match):
    pieces = match.split('/')
    # even indexed pieces are the names, odd are values
    ... 
```

关于我使用的正则表达式没有任何承诺，但我想你明白我的意思。

（编辑以尝试修复正则表达式。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T18:32:46.503

我同意 Adam，但我认为 urls.py 中的模式应该是：

```
... r'^browse/(?P<match>.+)/$' ... 
```

'\w' 只会匹配 'word' 字符，但 '.' 将匹配任何东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T23:31:03.497

阅读问题时，我得到了同样的答案。

我相信 model_browse 视图是对查询参数进行排序并将其用作通用路由器的最佳方式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-15T10:15:03.790

我认为 Adam 的答案比我的解决方案更通用，但如果你想在 url 中使用固定数量的参数，你也可以这样做：

以下示例显示了如何通过输入和的名称以及`store`和来获取某个位置一天的所有销售额。`year``month``day`

**urls.py**：

```
urlpatterns = patterns('',
    url(r'^baseurl/location/(?P<store>.+)/sales/(?P<year>[0-9][0-9][0-9][0-9])-(?P<month>[0-9][0-9])-(?P<day>[0-9][0-9])/$', views.DailySalesAtLocationListAPIView.as_view(), name='daily-sales-at-location'),
) 
```

`(?P<store>.+)`或者，您也可以通过更改为来使用商店的 id `(?P<store>[0-9]+)`。请注意，`location`and`sales`不是关键字，它们只是提高 url 的可读性。

**视图.py**

```
class DailySalesAtLocationListAPIView(generics.ListAPIView):
    def get(self, request, store, year, month, day):
        # here you can start using the values from the url
        print store
        print year
        print month
        print date

        # now start filtering your model 
```

希望它可以帮助任何人！

最好的祝福，

迈克尔

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-02-23T10:37:31.333

我有一个替代解决方案，它与以前的解决方案没有太大不同，但它更精致：

`url(r'^my_app/(((list\/)((\w{1,})\/(\w{1,})\/(\w{1,3})\/){1,10})+)$'`

我使用了[未命名的 url 参数](https://docs.djangoproject.com/en/1.9/topics/http/urls/#example)和重复的正则表达式。为了不得到“不是有效的正则表达式：多次重复”，我在列表的开头放置了一个单词。

我仍在处理接收列表的视图。但我认为我会通过 args 或 kwargs.. 仍然不能准确地说出来。

我的 2 美分

# java - Java 内存消耗，“top”和 HP-Ux

> ID：249132
> 
> 赞同：1
> 
> 时间：2008-10-30T02:36:48.290
> 
> 标签：java, unix, memory, hp-ux

我们提供在 Linux、AIX 和 HP-Ux (PA-RISC) 上运行的 Java 应用程序。我们似乎很难从在其他两种环境中运行良好的应用程序中获得可接受的 HP-Ux 性能水平。执行时间和内存消耗都是如此。

虽然我还没有找到关于“为什么”的权威文章，但我认为使用“top”测量内存消耗是一种粗略的方法，因为共享代码会产生误导性结果。但是，对于 HP-Ux 上的内存消耗已成为问题的客户站点，这就是我们所要做的。这一次，当我们从 Java 1.4 迁移到 Java 1.5（在 HP-Ux 11.23 PA-RISC 上）时，它才成为一个问题。“问题”是指机器停止创建新进程，因为我们已经耗尽了所有 16GB 的物理内存。

通过测量“之前”和“之后”的总“可用内存”，我们试图衡量 Java 应用程序消耗了多少。我编写了一个快速应用程序，将 10,000 个随机 64 位字符串存储在 ArrayList 中，并尝试使用这种方法来测量 Java 1.4 和 Java 1.5 下 Linux 和 HP-Ux 上的消耗。

结果：

惠普 Java 1.4 ~60MB

惠普 Java 1.5 ~150MB

Linux Java 1.4 ~24MB

Linux Java 1.5 ~16MB

谁能解释为什么会出现这些结果？这是“顶部”测量空闲内存的方式的一些特质吗？HP 上的 Java 1.5 真的消耗的内存是 Java 1.4 的 2.5 倍吗？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T04:23:22.617

JVM 可能只是具有不同的默认参数。堆将增长到您配置允许它的大小。Sun VM 上的默认设置是机器内存的一定百分比——也就是说，默认情况下，如果您使用具有更多内存的机器，Java 将使用更多内存。

如果 HP-UX VM 没有对 HP 进行此类调整，我会感到非常惊讶。我建议你摆弄这两个参数 - 找出你可以使用的最小最大堆大小，而不会影响性能或吞吐量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T02:55:12.403

我现在没有 HP 盒子来检验我的假设。但是，如果我是你，我会使用像 JConsole（JDK 附带）或 yourkit 这样的分析器来衡量正在发生的事情。

但是，您似乎是在发现有问题后开始测量的；所以，我并不否认它正在发生——只是指出我在同样情况下会做的事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T04:16:17.873

首先，不清楚您通过“10,000 个随机 64 位字符串”测试测量了什么。你应该启动应用程序，测量它的引导内存占用，然后运行你的测试。Java 1.5 很容易在启动后立即获得更多堆（例如，由于堆管理器设置）。

其次，我们确实在 HP-UX 下运行 1.4、1.5 和 1.6 下的 Java 应用程序，并且它们没有表现出任何特殊的内存要求。不过，我们有安腾硬件。

三、为什么要用top？为什么不直接打印 Runtime.getRuntime().totalMemory()？

第四，通过向 ArrayList 添加值，您会创建内存碎片。ArrayList 必须不时将其内部存储翻倍。根据 GC 设置和 ArrayList.ensureCapacity() 实现，未收集的内存量可能在 1.4 和 1.5 之间有很大差异。

本质上，您没有找出问题的原因，而是运行了一个随机测试，它没有给您任何有用的信息。您应该在应用程序上运行分析器以找出内存泄漏的位置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T14:26:38.687

您可能还想查看您正在尝试解决的问题......我不认为有很多问题会占用 16GB 内存，而这些问题不需要进行一轮好的优化。

您要启动多个虚拟机吗？您是否将大型数据集读入内存，并且没有足够快地丢弃它们？等等等等等等

# asp.net - ASP.NET 应用程序抛出 System.Security.SecurityException

> ID：249134
> 
> 赞同：2
> 
> 时间：2008-10-30T02:37:21.300
> 
> 标签：asp.net, exception

试图部署一个 ASP 应用程序；它工作了一段时间，但在访问页面时开始出现错误：

> ## “/AppNameHere”应用程序中的服务器错误。
> 
> 安全异常描述：应用程序试图执行安全策略不允许的操作。要授予此应用程序所需的权限，请联系您的系统管理员或在配置文件中更改应用程序的信任级别。
> 
> 异常详细信息：System.Security.SecurityException：请求“System.Web.AspNetHostingPermission，System，Version=2.0.0.0，Culture=neutral，PublicKeyToken=b77a5c561934e089”类型的权限失败。

IISreset 并没有改变任何东西，但是重新启动整个系统让它工作了几个小时，然后问题又回来了。应用程序的`.config`设置为完全信任。

这可能是什么原因造成的，如何解决？（或者，如果需要更多信息，我该去哪里寻找）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T16:20:39.297

[在Jason Gaylord 的博客](http://weblogs.asp.net/jgaylord/archive/2007/02/13/system-web-aspnethostingpermission-when-accessing-network-or-intranet-projects-using-visual-studio-2005.aspx)上找到以下内容：

**使用 Visual Studio 2005 访问网络或 Intranet 项目时的 System.Web.AspNetHostingPermission**

我最近重建了我的一台开发机器，并试图访问我在网络共享上的一个项目。我不断收到有关该项目不受信任的项目消息。我记得我必须更改某些内容，但不记得是什么，直到我找到了留在 Outlook 中的旧笔记。

我在 Visual Studio 2005 中收到的消息是：ASP.NET 运行时错误：请求“System.Web.AspNetHostingPermission, System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089”类型的权限失败。

要解决此问题，您必须更改开发计算机的 .net 安全配置，因为您正在通过网络访问项目。如果您在运行时需要此功能，则必须将配置文件中的信任级别更改为完全。但是，由于这只是在开发中，

1.  我可以通过转到开始 > 控制面板 > 管理工具 > Microsoft .NET Framework 2.0 配置来更改本地 PC 的安全性。

2.  完全加载后（有时需要一点时间），在导航树中完全展开我的电脑，然后单击运行时安全策略。

3.  在右侧窗格中，选择调整区域安全性。保留默认选项（对此计算机进行更改）并点击下一步。

4.  选择本地 Intranet 并将信任级别更改为完全信任。然后选择下一步，然后完成。

5.  重新启动 Visual Studio 2005，您应该一切就绪。

**这对我有用......所以希望这对你有用！**

# xml - 格式化 XML 命名空间的准则

> ID：249142
> 
> 赞同：0
> 
> 时间：2008-10-30T02:45:09.210
> 
> 标签：xml, xsd, namespace-organisation

我还没有开发公开面向 Internet 的 Web 服务应用程序。当我开始考虑向广大受众公开模式定义的问题时，我认为应该花一定的时间来正确格式化模式名称空间。

是否有人遇到过指导文档，该文档建议如何为组织的 XML 模式标准化名称空间格式？

诸如使用 FQDN 与路径[http://schemas.organisation.com/](http://schemas.organisation.com/)与[http://organisation.com/schemas](http://organisation.com/schemas)

包含版本路径的样式[http://organisation.com/schemas/submissions/2006](http://organisation.com/schemas/submissions/2006)或[http://organisation.com/schemas/submissions/v1](http://organisation.com/schemas/submissions/v1)

按日期或主题组织[http://organisation.com/schemas/2006/submissions/](http://organisation.com/schemas/2006/submissions/) vs [http://organisation.com/schemas/submissions/2006](http://organisation.com/schemas/submissions/2006)

等等

2010 年 1 月 12 日更新：再次重新审视这个问题时，我觉得它应该只是 wiki，因为如果真的有任何书面论文，就不可能有正确的答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T03:58:25.927

我喜欢使用单独的域，但现在可能没有站点，或者只是 xml 模式，以后可能是文档和模式的组合。您可能不应该在域名或 URL 路径中包含组织结构的任何部分，因为这些会发生变化，因此请尝试从长远角度进行设计。

最后还有一个不可避免的版本问题，日期（yyyy、yyyy-mm、yyyy-mm-dd）或 vN 都可以。您应该考虑是否要为最新版本提供“符号”网址，以及特定版本的具体日期。您可以使用从最新到特定的 HTTP 重定向，以便客户端可以知道您在做什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-12T08:57:01.830

我读过的关于命名空间应该如何成为样式的最接近的内容是这篇文章

[http://www.builderau.com.au/strategy/architecture/soa/Good-schema-management-helps-to-maintain-XML-namespace/0,339028264,320273067,00.htm](http://www.builderau.com.au/strategy/architecture/soa/Good-schema-management-helps-to-maintain-XML-namespace/0,339028264,320273067,00.htm)

但它本身并没有正确地触及实际主题，只是指出了表明正确命名空间为何如此重要的因素。

# user-input - 您是否将地址分解为街道/城市/州/邮编？

> ID：249156
> 
> 赞同：7
> 
> 时间：2008-10-30T02:57:01.090
> 
> 标签：user-input, street-address

我当前的应用程序需要为用户存储地址信息。我目前正在争论是使用惯用的街道地址/城市/州/邮编文本框和下拉菜单，还是采用谷歌的方法，将所有内容放在一条线上。关于以这两种方式存储地址信息的优缺点有什么想法吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-30T03:00:51.737

你应该把它分开。这将使以后的报告变得容易得多。如果您想提取一个州或邮政编码或城市的所有居民，会发生什么？如果您使用所有一个字段，您将被卡住并希望您已将其拆分。

此外，如果您不提示用户输入您需要的所有信息，他们也会忘记输入这些信息。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-30T03:03:43.433

从您帖子上的用户输入标签来看，我假设您指的是用户如何*输入*数据，以及现在您如何将数据*存储*在后端数据库中。

如果您希望能够对信息进行分类和分析（例如，出于报告和统计目的），您的数据库可能仍需要将此信息存储为单独的字段。

在这种情况下，我认为这取决于您是否有信心将寻址信息正确解析到各个字段中。

一种混合选项是允许用户将地址作为单行输入，然后尽最大努力将信息解析到单独的字段中。这类似于 Outlook 管理联系人地址的方式 - 您将所有信息输入到一个备忘录字段中，然后它会为您拆分。然后，如果它解释任何字段错误，您可以更正。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T03:08:56.230

我非常反对只有一个文本字段供用户输入他们的地址。如果您没有特定的字段，您会惊讶于有多少人会遗漏他们的邮政编码或其他一些重要信息。此外，正如其他人所提到的，如果所有数据都已预先解析，则以后报告此信息会变得更加容易。正如其他用户所提到的，Outlook 等程序会解析这些信息，但这只是因为数据的来源通常是电子邮件的签名，而这种格式从来都不是一致的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T03:04:18.390

我倾向于将其拆分，允许对地址的特定部分进行搜索，并且您可以通过了解格式来限制要处理的地址，即仅运送到东海岸地址。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T05:52:58.830

1）你应该拆分它。

2) 我可以建议您在尝试输入国际地址之前阅读[此内容吗？](http://www.uxmatters.com/MT/archives/000295.php)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T06:57:03.883

我同意基比。我什至惊讶地看到人们甚至不阅读该字段的标签，颠倒名字和姓氏，邮政编码和城市等。
不，在针对国际客户的 Web 应用程序中，您无法确定邮政编码是否有效...
某些国家/地区的邮政编码中有字母字符，长度不一，没有州信息等。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-10-13T04:18:58.557

绝对拆分输入。如果您可以提供帮助——并且取决于您的业务需求——在入口点执行地址验证可能是明智之举。这将使您知道您的地址正在干净地进入您的数据库*，并*允许您执行许多其他操作，例如防止欺诈。如果您向客户运送实物商品，拥有经过验证的地址可以帮助降低运输成本，并且可以通过确保在 AVS 验证期间提交正确的邮政编码来帮助降低信用卡商户费用。

为了全面披露，我是 SmartyStreets 的创始人。我们提供[CASS 认证的地址验证](http://www.smartystreets.com/)服务。用户可以将[清理列表](https://www.smartystreets.com/Products/CASS-Certified-Scrubbing/)(CSV/Excel/等) 上传到我们的网站或使用我们的[地址验证 Web 服务 API](http://www.smartystreets.com/Products/LiveAddress-API/)，称为 LiveAddress。

# svn - 如何在没有完整根结帐的情况下在我的工作目录中镜像 SVN 存储库目录结构？

> ID：249158
> 
> 赞同：2
> 
> 时间：2008-10-30T02:58:21.650
> 
> 标签：svn, tortoisesvn, visual-sourcesafe

首先，几个操作参数：

*   使用 Visual Studio 2005/2008 进行 .NET 开发
*   TortoiseSVN 客户端

我只主要使用 Visual Source Safe 和 SourceGear Vault 源代码控制系统。在每一个中，我将存储库的根映射到本地工作目录。例如：

```
$/  -->  C:\source 
```

只要本地目录存在，我就设置好我的“工作副本”（svn）或“工作文件夹”（VSS）。

要处理已经在源代码存储库中的新项目，我需要“获取该项目目录的最新”（VSS）版本。

当我进入存储库中的任何子目录并“获取最新”（即 svn checkout）时，客户端将自动为我创建完整的目录层次结构，将结构镜像到我的本地磁盘上。因此，当我得到最新的

```
$/foo/bar/project1 
```

它是在驱动器上创建的

```
C:\source\foo\bar\project1 
```

在 subversion 中，当我签出一个目录时，我必须指定工作副本目录位置。如果我想正确地镜像我的工作副本目录结构以匹配存储库，我必须手动构建路径中的每个子目录，或者将存储库根目录检出到工作副本根目录，从而获取存储库中的所有内容。

**有没有办法在层次结构中获取存储库目录，以便在没有所有手动干预的情况下在匹配的本地工作副本目录结构中创建它？**

这对于小型存储库不是问题，但在大多数情况下，我不需要很大比例的源存储库。为了不破坏对项目和资源的文件引用，必须维护物理结构。加上 SVN 的磁盘成本是给定文件的所有工作基础副本的实际源大小的两倍。

我目前正在使用乌龟。是否有其他 SVN 客户端可以满足我的需求？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T03:02:01.533

Subversion“签出”操作创建一个*新*的工作副本。你可能想要做的是检查你的整个项目（它会自动创建正确的目录结构，因为它在存储库中），然后使用 Subversion“更新”操作。更新将更新指定目录和子目录中的所有内容。

这可能是由于 VSS 和 Subversion 之间的术语不同。[Subversion Book](http://svnbook.red-bean.com)值得一读，尤其是关于[基本用法](http://svnbook.red-bean.com/en/1.5/svn.tour.html)的章节。

更新：我想我不太了解您的预期用例是什么。听起来您可能需要的 Subversion 1.5 新特性之一就是[稀疏检出](http://subversion.tigris.org/svn_1.5_releasenotes.html#sparse-checkouts)。这使您可以有选择地获取存储库的一部分，而不必获取全部内容。它为您提供管理所需数量的选项非常灵活。

~~由于稀疏结帐相对较新，我认为 SVN 书没有更新以包含有关此功能的信息。~~已更新，见评论。

更新 2：听起来您可以通过使用 --depth=empty 选项将存储库的顶层检出到 c:\source 中来构建所需的内容。然后，对于您想要的每个子目录，根据需要使用 --depth=empty 或 --depth=infinity 更新该子目录。

我相信这一切都源于 Subversion 的设计目标，即能够在您的系统上同时拥有多个独立的源代码树。使用 VSS，$/ 被全局配置为引用特定目录 (c:\source)，因此您只能进行一次检出（每次切换时都不会弄乱全局配置）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T09:23:47.690

简而言之，回答您的粗体印刷问题：**不**，无法在项目位置上方创建所有文件夹

这样做的原因略长：

您正在考虑 VSS 工作流程，其中您有 1 个工作文件夹，在您的本地目录中有一个固定路径。因此，您所能做的就是查看另一个项目，该项目将在您的工作文件夹内的本地 HD 上创建整个目录结构。

在 SVN 中，您有*浮动*工作副本，您可以将存储库中的特定位置检出到您想要的任何位置。您甚至可以将您的工作副本移动到不同的地方！您的工作副本不需要在 HD 上固定位置。

因此，您*无需*在项目上方重新创建文件夹结构。对于您的项目，它也不应该有任何区别。通过使用绝对路径不重要的*浮动*工作副本的 SVN 工作流程，您会更加灵活。

但是，如果您对使用旧的基于 VSS 的工作流程感到更自在，您可以使用`--sparse-checkout`参数签出并手动重新创建结构或编写一个简单的批处理文件来执行此操作。如果您继续使用 SVN 并忘记旧的生锈的 VSS 工作流程，我看不出这样做有什么好处，您肯定会忘记这样做

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T03:43:40.903

1.  首先使用 Repo Browser 浏览您的 Subversion 存储库。
2.  向下导航到您想要的目录；你应该得到一个显示类似[https://subversion:8443/svn/BranchMerge/Branches/TestWeb的 URL](https://subversion:8443/svn/BranchMerge/Branches/TestWeb)
3.  在左侧导航窗格中右键单击该目录，然后选择 Checkout...
4.  从存储库文本框的 URL 复制（到剪贴板）目录路径“BranchMerge/Branches/TestWeb”。
5.  将其粘贴到 Checkout directory 文本框中，以与其现有路径混合并匹配，以便它显示本地驱动器所需的层次结构。"C:\source\BranchMerge/Branches/TestWeb"
6.  当你点击 OK 时，应该会出现一个对话框，要求自动创建那些丢失的目录。
7.  当然同意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-08T14:05:44.247

我似乎找到了一个合适的解决方案来解决我的问题。

**使用 TortoiseSVN，repo 浏览器中的“将项目更新到修订版”操作可用于在本地重建存储库的文件夹结构以获取任意 repo 路径。**

详细步骤如下：

1.  创建一个本地文件夹作为您需要为其维护物理文件夹结构的最高存储库文件夹的工作副本根
2.  对存储库根进行浅层检出（检出，选择***除***“完全递归”以外的任何内容的“检出深度”）
3.  从工作副本文件夹启动 repo 浏览器
4.  找到你想要获取的 repo 路径
5.  右键单击所需的文件夹，选择“将项目更新到修订版”
6.  保留 HEAD 修订和“工作副本”更新深度的默认值，单击确定

这将使用所选 repo 路径的内容更新您的工作副本，包括直到结帐工作副本开始的所有父目录，从而镜像工作副本中存储库的文件夹层次结构。

关于“将项目更新到修订版”上下文菜单选项的注意事项：

*   此选项仅出现在本地工作副本中不存在的存储库路径上
*   看起来将“更新深度”保留为“工作副本”的默认值对于获取所选路径的所有内容是很好的。（而不必显式选择“完全递归”。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T03:05:42.990

但问题的重点是，我不希望仅仅为了在初始结帐时创建目录结构而获取整个存储库。

抱歉，如果我不清楚我是从一个干净、空的工作副本位置开始的。

我已经阅读了 SVN 书的大部分内容。但是，它不包括这类问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T03:21:24.003

[ankhsvn](http://ankhsvn.open.collab.net/)（开源）和[VisualSVN](http://www.visualsvn.com/)（商业）是与 Visual Studio 集成的产品，可能更适合您的开发模型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T15:43:07.253

我一般都理解你们所说的“SVN 是如何工作的”。也许问题不在于我对此不清楚，而是我正在成为更高代码组织问题的受害者。

问题的根源来自项目依赖。我有许多具有许多依赖项的应用程序。由于 .NET 项目的层次结构，依赖项预计位于某些物理位置。所以如果我要开始做这个项目：

```
http://mysvn/svn/foo/bar/project1 
```

该项目将进入

```
C:\source\foo\bar\project1 
```

现在该项目依赖于另一个项目。在 .NET 项目文件中，项目引用是相对“反向引用”的：

```
..\..\..\bar\foo\project2 
```

所以依赖项应该在本地工作副本中

```
C:\source\bar\foo\project2 
```

因此，父目录结构至关重要。

我不能将依赖项目存储为任何特定应用程序/项目的子项目，因为它们在许多项目之间共享。因此，他们住在一个特定项目树之外的自己的位置。因此，我确实需要确保将任何给定项目（及其依赖项）签出到相对于源树根的特定树位置，以确保对项目的引用不会中断或不会中断开发人员之间没有区别。否则，我们每个人都会不断更新引用以使它们工作，从而在源历史记录中产生大量噪音，并在开发人员之间不断中断。此外，构建服务器也不会将它们放在正确的位置。

我还没有找到任何关于使用 SVN 进行 .NET 开发的好信息。.NET 中有大量使用 SVN 或 CVS 的开源项目。然而，我看过的那些似乎总是处于一个相当孤立的结构中，以至于所有不同的项目都属于一个单一的源树位置。这使得获得所需的一切变得微不足道，因为您可以简单地递归地检查一条路径并获得所需的一切。

我很想听听任何使用 SVN 在 .NET 中进行企业开发的人以及跨项目存储位置边界的许多共享项目。

开始感觉在团队中唯一可行的解​​决方案是简单地检查整个存储库以确保结构正确且一致。这对于拥有许多源代码的存储库来说是不幸的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-04T16:03:06.520

好的，首先，你的工作方式最终会导致问题。

您寻找的原则是每个项目都应该有一个独立于任何其他项目的主干/分支/标签结构。签出trunk会自动获取所有代码，包括依赖项，这足以构建您的项目。

你显然不处于那种位置，而转向它需要一些努力。但是，您可以使用一种解决方法来让您随心所欲地使用外部设备。

1.  在 Repo-browser 中，在根目录中创建一个新的树文件夹，可能是“Projects”。
2.  在此 Projects 文件夹中，为您的项目“MyProject”创建一个文件夹。
3.  在这个文件夹上，右键单击它并编辑属性，添加一个名为“svn:externals”的新属性 - 它会在列表中。
4.  使用此属性定义项目所需的树。
5.  签出[http://svnserver/svn/Projects/MyProject](http://svnserver/svn/Projects/MyProject)并检索整个树。
6.  正常工作。

svn:externals 属性的一个例子可能是：

```
http://mysvn/svn/foo/bar/project1 foo/bar/project1
http://mysvn/svn/bar/foo/project2 bar/foo/project2 
```

尽管最好使用红皮书中详述的相对引用。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-10-30T03:19:05.757

不知道你为什么要按照你的要求去做。大多数人只是创建一个工作的本地副本，然后在他们想要的任何目录上工作。这是因为 Subversion 的工作方式。它不会锁定源代码。我通过使用 SourceSafe 开始了源代码控制，所以我对您正在经历的事情有了一点了解。

您可能想要的是使用 svn:externals 属性。这里有几个帖子讨论这个问题。这是其中之一：

[如何使SVN只更新文件而不添加新文件](https://stackoverflow.com/questions/125468/how-to-make-svn-only-update-files-but-not-add-new-ones)

# deployment - 将 App.Config 设置为设置项目中的自定义操作

> ID：249159
> 
> 赞同：14
> 
> 时间：2008-10-30T02:59:13.113
> 
> 标签：deployment, app-config, setup-project

我有一个自定义应用程序，其中包含一个简单的 app.config 指定 SQL Server 名称和数据库，我想在应用程序安装时提示用户应用程序配置项，然后更新 app.config 文件。

我承认我对设置项目完全陌生，并且正在寻找一些指导。谢谢马克·库普斯

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-23T00:11:26.963

我在 64 位机器上链接到的代码 Gulzar 有问题。我发现下面的链接是将值从配置 ui 获取到 app.config 的简单解决方案。

[http://raquila.com/software/configure-app-config-application-settings-during-msi-install/](http://raquila.com/software/configure-app-config-application-settings-during-msi-install/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T03:16:25.107

看看这个 -[具有用于更改设置的自定义操作的安装程序](http://www.eggheadcafe.com/tutorials/aspnet/ec13b205-9a90-496f-9d7b-ccebdf1d3ca1/build-a-custom-action-ins.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-26T05:26:43.387

App.Config 可以更改...但是它存在于类似于 HKEY___LOCAL_MACHINE 的位置，即普通用户具有只读访问权限。

因此，您需要以管理员身份对其进行更改 - 最佳时间是在安装期间，您（应该）使用增强的权限进行安装。

因此，创建一个 Installer 类，在安装项目中使用自定义操作来传递用户的选择（例如“/svr=[SERVER] /db=[DB] /uilevel=[UILEVEL]”），并且在 AfterInstall 事件中，使用以下内容更改 App.Config 文件：

```
Public Shared Property AppConfigSetting(ByVal SettingName As String) As Object
    Get
        Return My.Settings.PropertyValues(SettingName)
    End Get
    Set(ByVal value As Object)
        Dim AppConfigFilename As String = String.Concat(System.Reflection.Assembly.GetExecutingAssembly.Location, ".config")

        If (My.Computer.FileSystem.FileExists(AppConfigFilename)) Then
            Dim AppSettingXPath As String = String.Concat("/configuration/applicationSettings/", My.Application.Info.AssemblyName, ".My.MySettings/setting[@name='", SettingName, "']/value")

            Dim AppConfigXML As New System.Xml.XmlDataDocument
            With AppConfigXML
                .Load(AppConfigFilename)

                Dim DataNode As System.Xml.XmlNode = .SelectSingleNode(AppSettingXPath)

                If (DataNode Is Nothing) Then
                    Throw New Xml.XmlException(String.Format("Application setting not found ({0})!", AppSettingXPath))

                Else
                    DataNode.InnerText = value.ToString
                End If

                .Save(AppConfigFilename)
            End With

        Else
            Throw New IO.FileNotFoundException("App.Config file not found!", AppConfigFilename)
        End If

    End Set
End Property 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-03-22T15:20:03.243

创建用于 Visual Studio 安装项目的自定义对话框：http: [//www.codeproject.com/Articles/18834/Create-custom-dialogs-for-use-in-your-Visual-Studi](http://www.codeproject.com/Articles/18834/Create-custom-dialogs-for-use-in-your-Visual-Studi)

# c# - 为 C# 中的属性格式化 Resharper 支持字段

> ID：249163
> 
> 赞同：2
> 
> 时间：2008-10-30T03:01:23.717
> 
> 标签：c#, resharper

有没有办法控制 Resharper 放置其支持字段的位置？目前它试图将它们放在班级的首位。我希望他们直接在物业上方。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T07:52:27.920

还没有。

# c# - 对于需要引用其他类的类，C# 中的良好设计模式是什么？

> ID：249171
> 
> 赞同：7
> 
> 时间：2008-10-30T03:06:38.917
> 
> 标签：c#, .net, class, reference, class-design

我正在处理 C#.NET 中的业务问题。我有两个类，名为 C 和 W，它们将在不同时间独立实例化。

C 类的对象需要包含对 W 类的 0 ... n 个对象的引用，即一个 C 对象最多可以包含 n W 个对象。

每个 W 对象都需要包含对 C 类的恰好 1 个对象的引用，即一个 W 对象包含在一个 C 对象中。

C 类的对象通常首先被实例化。稍后，它的 W 内容被发现并实例化。稍后，我需要相互交叉引用 C 和 W 对象。

什么是好的设计模式？实际上，我有涉及三个或四个类的案例，但我们可以讨论两个类以保持简单。

我在想一些简单的事情，比如：

```
class C
{
   public List<W> contentsW;

}

class W
{
  public C containerC;

} 
```

这暂时可行，但我可以预见必须编写大量代码来跟踪所有引用及其有效性。我想在路上实现代码，只对容器进行浅刷新，对所有引用的类进行深度刷新。还有其他方法吗？它们的优点是什么？

11/3 编辑：感谢所有人的好答案和好讨论。我最终选择了 jop 的答案，因为这与我想做的最接近，但其他答案也有帮助。再次感谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T03:38:11.193

如果您有 Martin Fowler 的重构书，只需按照“将单向关联更改为双向”重构即可。

如果您没有它，以下是重构后您的类的外观：

```
class C
{
  // Don't to expose this publicly so that 
  // no one can get behind your back and change 
  // anything
  private List<W> contentsW; 

  public void Add(W theW)
  {
    theW.Container = this;
  }

  public void Remove(W theW)
  {
    theW.Container = null;
  }

  #region Only to be used by W
  internal void RemoveW(W theW)
  {
    // do nothing if C does not contain W
    if (!contentsW.Contains(theW))
       return; // or throw an exception if you consider this illegal
    contentsW.Remove(theW);
  }

  internal void AddW(W theW)
  {
    if (!contentW.Contains(theW))
      contentsW.Add(theW);
  }
  #endregion
}

class W
{
  private C containerC;

  public Container Container
  {
    get { return containerC; }
    set 
    { 
      if (containerC != null)
        containerC.RemoveW(this);
      containerC = value; 
      if (containerC != null)
        containerC.AddW(this);
    }
  }
} 
```

请注意，我已将其`List<W>`设为私有。通过枚举器公开 Ws 列表，而不是直接公开列表。

例如 public List GetWs() { return this.ContentW.ToList(); }

上面的代码正确地处理了所有权的转移。假设您有两个 C 实例——C1 和 C2——以及 W 的实例——W1 和 W2。

```
W1.Container = C1;
W2.Container = C2; 
```

在上面的代码中，C1 包含 W1，C2 包含 W2。如果将 W2 重新分配给 C1

```
W2.Container = C1; 
```

然后 C2 将有零个项目，C1 将有两个项目 - W1 和 W2。你可以有一个浮动的W

```
W2.Container = null; 
```

在这种情况下，W2 将从 C1 的列表中删除，并且它没有容器。您还可以使用 C 中的 Add 和 Remove 方法来操作 W 的容器 - 因此 C1.Add(W2) 将自动从其原始容器中删除 W2 并将其添加到新容器中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T03:19:29.343

我通常这样做：

```
class C
{
   private List<W> _contents = new List<W>();
   public IEnumerable<W> Contents
   {
      get { return _contents; }
   }

   public void Add(W item)
   {
      item.C = this;
      _contents.Add(item);
   }
} 
```

因此，您的 Contents 属性是只读的，您只能通过聚合的方法添加项目。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T03:13:25.487

嗯，看起来你几乎明白了，有一个小故障——你必须能够在 C 中控制添加到列表中。

例如，

```
class C
{
    private List<W> _contentsW;

    public List<W> Contents 
    {
        get { return _contentsw; }
    }

    public void AddToContents(W content);
    {
        content.Container = this;
        _contentsW.Add(content);
    }
} 
```

为了检查，你只需要遍历你的列表，我认为：

```
foreach (var w in _contentsW)
{
    if (w.Container != this)
    {
        w.Container = this;
    }
} 
```

不确定这是否是您需要的。

请意识到可能有多个 W 实例具有相同的值但可能具有不同的 C 容器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T03:20:51.103

扩展乔恩斯的答案....

如果 W 不应该让 C 保持活动状态，您可能需要弱引用。

另外...如果您想转让所有权，添加应该更复杂...

```
public void AddToContents(W content);
{  
   if(content.Container!=null) content.Container.RemoveFromContents(content);
    content.Container = this;
    _contentsW.Add(content);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T03:15:58.413

一种选择是实现System.ComponentModel 下的[IContainer](http://msdn.microsoft.com/en-us/library/system.componentmodel.icontainer.aspx)和[IComponent接口。](http://msdn.microsoft.com/en-us/library/system.componentmodel.icomponent.aspx)C 是容器，W 是组件。然后[ComponentCollection](http://msdn.microsoft.com/en-us/library/system.componentmodel.componentcollection.aspx)类将用作 W 实例的存储，而 IComponent.Site 将提供到 C 的反向链接。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T03:37:06.640

这是我使用的模式。

```
public class Parent {
    public string Name { get; set; }
    public IList<Child> Children { get { return ChildrenBidi; } set { ChildrenBidi.Set(value); } }
    private BidiChildList<Child, Parent> ChildrenBidi { get {
        return BidiChildList.Create(this, p => p._Children, c => c._Parent, (c, p) => c._Parent = p);
    } }
    internal IList<Child> _Children = new List<Child>();
}

public class Child {
    public string Name { get; set; }
    public Parent Parent { get { return ParentBidi.Get(); } set { ParentBidi.Set(value); } }
    private BidiParent<Child, Parent> ParentBidi { get {
        return BidiParent.Create(this, p => p._Children, () => _Parent, p => _Parent = p);
    } }
    internal Parent _Parent = null;
} 
```

显然，我有类`BidiParent<C, P>`和`BidiChildList<C, P>`，后者实现了`IList<C>`等。幕后更新是通过内部字段完成的，而使用此域模型的代码的更新是通过公共属性完成的。

# wpf - 我可以控制在 WPF TreeView 中可以选择哪些节点吗？

> ID：249185
> 
> 赞同：6
> 
> 时间：2008-10-30T03:18:02.310
> 
> 标签：wpf, treeview

我在 WPF TreeView 中显示了一个两级层次结构，但我只希望子节点是可选的 - 基本上顶级节点用于分类，但它们本身不应该是可选的。

我能做到这一点吗？

谢谢...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2011-01-21T13:06:43.977

为每种类型的项目定义样式，就像 Bijington 写的那样。对于不可选择的节点，将容器的 Focusable-Property（对于 TreeViews 的 TreeViewItem）设置为 false。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T13:10:06.093

为此，您需要覆盖树视图的样式。理想情况下，您将拥有两种类型的树视图项目，一种用于您的顶级节点（我假设文件夹），另一种仅用于子节点，那么您应该能够定义树中每个项目类型的行为方式。所以为每个项目类型创建一个样式，然后为文件夹节点简单地更改触发器为被选中不做任何事情。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-27T09:05:24.360

我在附加属性中写过，一旦选中它就会取消选择树视图项：

```
public class TreeViewItemHelper
{
    public static bool GetIsSelectable(TreeViewItem obj)
    {
        return (bool)obj.GetValue(IsSelectableProperty);
    }

    public static void SetIsSelectable(TreeViewItem obj, bool value)
    {
        obj.SetValue(IsSelectableProperty, value);
    }

    public static readonly DependencyProperty IsSelectableProperty =
        DependencyProperty.RegisterAttached("IsSelectable", typeof(bool), typeof(TreeViewItemHelper), new UIPropertyMetadata(true, IsSelectablePropertyChangedCallback));

    private static void IsSelectablePropertyChangedCallback(DependencyObject o, DependencyPropertyChangedEventArgs args)
    {
        TreeViewItem i = (TreeViewItem) o;
        i.Selected -= OnSelected;
        if(!GetIsSelectable(i))
        {
            i.Selected += OnSelected;
        }
    }

    private static void OnSelected(object sender, RoutedEventArgs args)
    {
        if(sender==args.Source)
        {
            TreeViewItem i = (TreeViewItem)sender;
            i.IsSelected = false;
        }
    }
} 
```

不幸的是，当您单击不可选择的项目时，您仍然会丢失旧的选择:(

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-10-18T08:34:17.147

您可以通过在样式中使用触发器来仅选择子节点，假设所有子节点都没有子节点，如下所示：

```
<TreeView Name="MyTreeView>
    <TreeView.ItemContainerStyle>
         <Style TargetType="{x:Type TreeViewItem}">
             <Style.Triggers>
                 <Trigger Property="HasItems" Value="true">
                     <Setter Property="Focusable" Value="False" />
                 </Trigger>
             </Style.Triggers>
          </Style>
     </TreeView.ItemContainerStyle>
</TreeView> 
```

在父 TreeViewItems 上将 Focusable 设置为 false 也会阻止它们被选中。

# asp.net - 在 ASP.NET 中实现可编辑的 DropDownList

> ID：249188
> 
> 赞同：8
> 
> 时间：2008-10-30T03:19:46.380
> 
> 标签：asp.net, javascript, user-controls, drop-down-menu

什么是实现 DropDownList 的最优雅的方式，可以在`ASP.NET`不使用 3rd 方组件的情况下进行编辑。

作为最后的手段，我可​​能会尝试使用`TextBox`带有`AutoCompleteExtender`图像的“下拉”列表；或`TextBox`重叠的 HTML Select 与一些 JavaScript 将值从 Select 填充到`TextBox`. 但我真的希望有一个更简洁和可维护的解决方案。

提前致谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-10-20T02:06:39.950

## 页面上的一个控件

您可以按照[~~这个简单的示例，在代码项目~~](http://www.codeproject.com/KB/aspnet/EditableDropdown_aspx.aspx)上使用标准 ASP.NET 文本框和 DropDownList 控件以及一些 JavaScript 的可编辑 DropDownlist。

但是，在我添加了一个引用来获取 TextBox 和 DropDownList 的 ClientID 值之前，该代码对我不起作用：

```
<script language="javascript" type="text/javascript">

function DisplayText()
{
    var textboxId = '<% = txtDisplay.ClientID %>';
    var comboBoxId = '<% = ddSelect.ClientID %>';
    document.getElementById(textboxId).value = document.getElementById(comboBoxId).value;
    document.getElementById(textboxId).focus();
}
</script>    

<asp:TextBox style="width:120px;position:absolute" ID="txtDisplay" runat="server"></asp:TextBox>

<asp:DropDownList ID="ddSelect" style="width:140px" runat="server">    
    <asp:ListItem Value="test1" >test1</asp:ListItem>    
    <asp:ListItem Value="test2">test2</asp:ListItem>    
</asp:DropDownList> 
```

最后，在后面的代码中，就像在原始示例中一样，我在页面加载中添加了以下内容：

```
protected void Page_Load(object sender, EventArgs e)
{
    ddSelect.Attributes.Add("onChange", "DisplayText();");
} 
```

## 页面上的多个控件

我将上述所有代码放在它自己的 ASCX 用户控件中，以使其在我的项目中可重用。但是，只有在给定页面上只需要一个可编辑的 DropDownList 时，上述代码才有效。

如果需要在单个页面上支持多个自定义 DropDownList 控件，则需要将 JavaScript 函数名称设置为唯一，以避免冲突。再次使用 ClientID 执行此操作：

*在 ASCX 文件中：*

```
function DisplayText_<% = ClientID %>(){...} 
```

*在后面的代码中：*

```
/// ...
ddSelect.Attributes.Add("onChange", "DisplayText_" + ClientID + "();");
///.. 
```

这是避免使用第 3 方控件的一种方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2017-03-03T09:01:28.533

您可以尝试使用 JqueryUI 自动完成组合框。
它可以让您输入文本以及从下拉列表中选择您选择的项目。
作为一项额外功能，它允许您使用自动完成功能来获得增强的 UI 体验。

我附上了一个与 bootstrap 3.3.4 结合的演示

```
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head runat="server">
  <title></title>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" rel="stylesheet" />

  <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
  <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
  <link href="https://jqueryui.com/resources/demos/style.css" rel="stylesheet" />
  <style>
    .custom-combobox {
      position: relative;
      display: inline-block;
    }
    .custom-combobox-toggle {
      position: absolute;
      top: 0;
      bottom: 0;
      margin-left: -1px;
      padding: 0;
    }
    .custom-combobox-input {
      margin: 0;
      padding: 5px 10px;
    }
    .ui-state-default,
    .ui-widget-content .ui-state-default,
    .ui-widget-header .ui-state-default {
      border: 1px solid #421D1D;
      background: #ffffff url("images/ui-bg_glass_75_e6e6e6_1x400.png") 50% 50% repeat-x !important;
      font-weight: normal;
      color: #555555;
    }
    /* Corner radius */
    .ui-corner-all,
    .ui-corner-top,
    .ui-corner-left,
    .ui-corner-tl {
      border-top-left-radius: 0px !important;
    }
    .ui-corner-all,
    .ui-corner-top,
    .ui-corner-right,
    .ui-corner-tr {
      border-top-right-radius: 0px !important;
    }
    .ui-corner-all,
    .ui-corner-bottom,
    .ui-corner-left,
    .ui-corner-bl {
      border-bottom-left-radius: 0px !important;
    }
    .ui-corner-all,
    .ui-corner-bottom,
    .ui-corner-right,
    .ui-corner-br {
      border-bottom-right-radius: 0px !important;
    }
  </style>
  <script>
    (function($) {
      $.widget("custom.combobox", {
        _create: function() {
          this.wrapper = $("<span>")
            .addClass("custom-combobox")
            .insertAfter(this.element);

          this.element.hide();
          this._createAutocomplete();
          this._createShowAllButton();
        },

        _createAutocomplete: function() {
          var selected = this.element.children(":selected"),
            value = selected.val() ? selected.text() : "";

          this.input = $("<input>")
            .appendTo(this.wrapper)
            .val(value)
            .attr("title", "")
            .addClass("custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left")
            .autocomplete({
              delay: 0,
              minLength: 0,
              source: $.proxy(this, "_source")
            })
            .tooltip({
              tooltipClass: "ui-state-highlight"
            });

          this._on(this.input, {
            autocompleteselect: function(event, ui) {
              ui.item.option.selected = true;
              this._trigger("select", event, {
                item: ui.item.option
              });
            },

            autocompletechange: "_removeIfInvalid"
          });
        },

        _createShowAllButton: function() {
          var input = this.input,
            wasOpen = false;

          $("<a>")
            .attr("tabIndex", -1)
            .attr("title", "Show All Items")
            .tooltip()
            .appendTo(this.wrapper)
            .button({
              icons: {
                primary: "ui-icon-triangle-1-s"

              },
              text: false
            })
            .removeClass("ui-corner-all")
            .addClass("custom-combobox-toggle ui-corner-right")
            .mousedown(function() {
              wasOpen = input.autocomplete("widget").is(":visible");
            })
            .click(function() {
              input.focus();

              // Close if already visible
              if (wasOpen) {
                return;
              }

              // Pass empty string as value to search for, displaying all results
              input.autocomplete("search", "");
            });
        },

        _source: function(request, response) {
          var matcher = new RegExp($.ui.autocomplete.escapeRegex(request.term), "i");
          response(this.element.children("option").map(function() {
            var text = $(this).text();
            if (this.value && (!request.term || matcher.test(text)))
              return {
                label: text,
                value: text,
                option: this
              };
          }));
        },

        _removeIfInvalid: function(event, ui) {

          // Selected an item, nothing to do
          if (ui.item) {
            return;
          }

          // Search for a match (case-insensitive)
          var value = this.input.val(),
            valueLowerCase = value.toLowerCase(),
            valid = false;
          this.element.children("option").each(function() {
            if ($(this).text().toLowerCase() === valueLowerCase) {
              this.selected = valid = true;
              return false;
            }
          });

          // Found a match, nothing to do
          if (valid) {
            return;
          }

          // Remove invalid value
          this.input
            .val("")
            .attr("title", value + " didn't match any item")
            .tooltip("open");
          this.element.val("");
          this._delay(function() {
            this.input.tooltip("close").attr("title", "");
          }, 2500);
          this.input.autocomplete("instance").term = "";
        },

        _destroy: function() {
          this.wrapper.remove();
          this.element.show();
        }
      });
    })(jQuery);

    $(function() {
      $("#combobox").combobox();
      $("#toggle").click(function() {
        $("#combobox").toggle();
      });
    });
  </script>
</head>

<body>
  <form id="form1" runat="server">
    <div>
      <div class="ui-widget">
        <select id="combobox" class="form-control">
          <option value="">Select your option</option>
          <option value="Apple">Apple</option>
          <option value="Banana">Banana</option>
          <option value="Cherry">Cherry</option>
          <option value="Date">Date</option>
          <option value="Fig">Fig</option>
          <option value="Grape">Grape</option>
          <option value="Kiwi">Kiwi</option>
          <option value="Mango">Mango</option>
          <option value="Orange">Orange</option>
          <option value="Pumpkin">Pumpkin</option>
          <option value="Strawberry">Strawberry</option>
          <option value="Tomato">Tomato</option>
          <option value="Watermelon">Watermelon</option>
        </select>
      </div>

    </div>
  </form>
</body>

</html>
```

我已经在以下所有设置测试环境中测试了此代码：
Chrome 浏览器版本 43.0.2334.0 dev-m（64 位）
Internet Explorer 11
Firefox 36.0.1
Visual Studio 2013 版

希望这可以解决您的问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-10T18:38:41.123

这里的 2 解决方案对我有用。所以对雷来说很糟糕。

您还应该查看[http://ajaxcontroltoolkit.codeplex.com/releases/view/43475](http://ajaxcontroltoolkit.codeplex.com/releases/view/43475)，这是 ajaxcontroltoolkit。

我不相信框架 4 的版本带有组合框组件，它在这里：[http](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/ComboBox/ComboBox.aspx) ://www.asp.net/AJAX/AjaxControlToolkit/Samples/ComboBox/ComboBox.aspx非常酷。特别是如果你这样设置：

```
ajaxToolkit:ComboBox ID=ComboBox1 runat=server AutoPostBack=False 
   DropDownStyle=DropDown  AutoCompleteMode=Suggest  
               CaseSensitive=False ItemInsertLocation="OrdinalText" 
```

# javascript - 如何以编程方式告诉 HTML SELECT 下拉（例如，由于鼠标悬停）？

> ID：249192
> 
> 赞同：127
> 
> 时间：2008-10-30T03:23:30.567
> 
> 标签：javascript, html

如何`select`以编程方式告诉 HTML 下拉（例如，由于鼠标悬停）？

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2012-04-13T06:59:36.813

*这实际上在 HTML + Javascript 中是可能的，尽管在其他地方人们都说它不是，但它后来被弃用并且现在不起作用。*

**但是，这只适用于 Chrome。如果您有兴趣，请阅读更多内容。**

* * *

根据[HTML5 的 W3C 工作草案，第 3.2.5.1.7 节。互动内容](http://www.w3.org/TR/html5/content-models.html#interactive-content)：

> HTML 中的某些元素具有激活行为，这意味着用户可以激活它们。这会触发一系列事件，这些事件取决于激活机制 [...] **，例如使用键盘或语音输入，或通过鼠标点击**。
> 
> 当用户以非单击方式触发具有已定义激活行为的元素时，**交互事件的默认操作必须是**在元素上运行合成单击激活步骤。

`<select>`作为交互式内容，我相信可以以编程方式显示其`<option>`s。玩了几个小时后，我发现使用`document.createEvent()`和`.dispatchEvent()`工作。

也就是说，演示时间。 [**这是一个工作小提琴。**](http://jsfiddle.net/fz2sY/39/)

* * *

HTML：

```
<select id="dropdown">
    <option value="Red">Red</option>
    <option value="Green">Green</option>
    <option value="Blue">Blue</option>
</select>
<br>
<button id="fire" type="button" onclick="runThis()">Show dropdown items</button>​ 
```

Javascript：

```
// <select> element displays its options on mousedown, not click.
showDropdown = function (element) {
    var event;
    event = document.createEvent('MouseEvents');
    event.initMouseEvent('mousedown', true, true, window);
    element.dispatchEvent(event);
};

// This isn't magic.
window.runThis = function () { 
    var dropdown = document.getElementById('dropdown');
    showDropdown(dropdown);
}; 
```

如果有人找到一种方法来做同样的事情但不是在 Chrome 中，[请随时修改这个小提琴](http://jsfiddle.net/fz2sY/39/)。​</p>

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2016-09-22T09:31:15.047

Xavier Ho 的回答是涵盖如何解决目前大多数浏览器中的问题。但是，**最好不要再通过 JavaScript 分派/修改事件**。（就像，`mousedown`在这种情况下）

从 53+ 版本开始，Google Chrome**将不会对不受信任的事件执行默认操作**。例如通过脚本创建或修改的事件，或通过`dispatchEvent`方法调度的事件。此更改是为了与我认为尚未执行该操作的 Firefox 和 IE 保持一致。

出于测试目的，[Fiddle](http://jsfiddle.net/fz2sY/39/)提供了 Xavier 的答案在 chrome 53+ 中不起作用。（我不测试它 FF 和 IE）。

参考链接：

[https://www.chromestatus.com/features/57188](https://www.chromestatus.com/features/5718803933560832) [​​03933560832 https://www.chromestatus.com/features/6461137440735232](https://www.chromestatus.com/features/6461137440735232)

并且 initMouseEvent 也[被弃用了](https://developer.mozilla.org/en-US/docs/Web/API/MouseEvent/initMouseEvent)

* * *

## 回答 #3

> 赞同：37
> 
> 时间：2008-10-30T03:52:11.820

这是我能得到的最接近的，改变元素onmouseover的大小，并恢复大小onmouseout：

```
<select onMouseOut="this.size=1;" onMouseOver="this.size=this.length;">
  <option>1</option>
  <option>2</option>
  <option>3</option>
  <option>4</option>
  <option>5</option>
</select>
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2018-05-16T19:54:52.740

我有同样的问题，我发现解决这个问题的更简单方法是使用 HTML 和 CSS。

首先，让你`<select>`透明（`opacity: 0;`）。然后，将按钮放在`<select>`. 单击按钮将被`<select>`组件捕获。

```
select{
  opacity: 0;
  position: absolute;
}
```

```
<select>
  <option>option 1</option>
  <option>option 2</option>
  <option>option 3</option>
</select>
<button>click</button>
```

* * *

## 回答 #5

> 赞同：17
> 
> 时间：2008-10-30T03:50:00.983

您不能使用 HTML 选择标签来做到这一点，但您可以使用 JavaScript*和*HTML 来做到这一点。有多种现有控件可以执行此操作 - 例如，附加到 SO“有趣/忽略的标签”条目的“建议”列表，或 Gmail 的电子邮件地址查找。

有许多 JavaScript+HTML 控件提供了这种能力——寻找自动完成控件的想法。

请参阅此链接以获取自动完成控件... [http://ajaxcontroltoolkit.codeplex.com/](http://ajaxcontroltoolkit.codeplex.com/)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2016-09-27T07:18:57.240

我认为这在 Chrome 中不再可能。

正如 Asim K T 所述，chrome 53 版似乎禁用了此功能。

> 根据规范 [http://www.w3.org/TR/DOM-Level-3-Events/#trusted-events](http://www.w3.org/TR/DOM-Level-3-Events/#trusted-events)
> 
> 可信事件不应触发默认操作（点击事件除外）。

然而，他们已经在 webview 中启用了它，但我没有对此进行测试。

> 我们发现一些 webview 在其中使用了 fastclick，由于存在损坏的风险，我们将允许 mousedown 选择，即使它们不受信任。

在这个[讨论](https://bugs.chromium.org/p/chromium/issues/detail?id=520520)中，让开发人员以编程方式打开下拉菜单的想法被放弃了。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2014-04-07T08:05:20.063

如果有人还在寻找这个：

```
<select id="dropdown">
    <option value="Red">Red</option>
    <option value="Green">Green</option>
    <option value="Blue">Blue</option>
</select>
<br>
<button id="fire" type="button" >Show dropdown items</button> 
```

Javascript：

```
var is_visible=false; 

$(document).ready(function(){

    $('#fire').click(function (e) { 
    var element = document.getElementById('dropdown');

    if(is_visible){is_visible=false; return;}
    is_visible = true;

    var event;
    event = document.createEvent('MouseEvents');
    event.initMouseEvent('mousedown', true, true, window);
    element.dispatchEvent(event);

    /* can be added for i.e. compatiblity.
      optionsSelect.focus();
       var WshShell = new ActiveXObject("WScript.Shell");
       WshShell.SendKeys("%{DOWN}");
    */
    e.stopPropagation();
    return false;
});

$(document).click(function(){is_visible=false; });
}); 
```

**更新：**

直到这个问题没有完美的解决方案，但你可以尽量避免这种情况。你为什么要这样做。几个月前我想知道一个解决方案来为移动设备制作一个精选插件

[https://github.com/HemantNegi/jquery.sumoselect](https://github.com/HemantNegi/jquery.sumoselect)

最后用一个透明的选择元素屏蔽了自定义 div（或任何其他元素），以便它可以直接与用户交互。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-02-23T16:22:52.683

这是我找到的最好方法。注意它仅适用于 Windows 上的 IE，并且您的 Web 可能需要位于安全区域 - 因为我们访问 shell。诀窍是 ALT-Down Arrow 是打开选择下拉菜单的快捷键。

```
<button id="optionsButton" style="position:absolute;top:10px;left:10px;height:22px;width:100px;z-index:10" onclick="doClick()">OPTIONS</button>
<select id="optionsSelect" style="position:absolute;top:10px;left:10px;height:20px;width:100px;z-index:9">
    <option>ABC</option>
    <option>DEF</option>
    <option>GHI</option>
    <option>JKL</option>
</select>
<script type="text/javascript">
   function doClick() {
       optionsSelect.focus();
       var WshShell = new ActiveXObject("WScript.Shell");
       WshShell.SendKeys("%{DOWN}");
   }
</script> 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-11-11T19:03:51.083

当你想做的时候，不要再想一件事是不可能的，没有什么是不可能的。

使用这个由一个人创建的扩展 JS 函数。

[http://code.google.com/p/expandselect/](http://code.google.com/p/expandselect/)

包括这个 JS 并调用它作为你的选择 id 传递参数，就像这样：

```
ExpandSelect(MySelect) 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-06-18T13:31:15.703

如果有人还在寻找这个，这就是我解决它的方法。

这是一个基于以下事实的解决方案：当尺寸增加时，选择看起来像是被扩展了。我们可以增加尺寸以使其看起来扩大。并减少以使其看起来封闭。通过这种方式，我们可以通过只拥有焦点和模糊侦听器来处理大多数用例。

选择元素需要绝对定位，因为增加尺寸会增加元素的垂直高度。如果您有下面的元素，如果不这样做，它们将被向下推。

我有一个包装器代码，它包装元素并提供打开和关闭方法。

检查这个小提琴的用法：[https ://jsfiddle.net/10ar2ebd/16/](https://jsfiddle.net/10ar2ebd/16/)

```
var SelectionWrapper = function(element, maxSize, selectCb) {

  var preventDefault = function(e) {
    e.preventDefault();
    e.stopPropagation();
  }

  var isOpen = false;

  var open = function() {
    if (!isOpen) {
      element.size = maxSize;
      // Remove prevent default so that user will be able to select the option
      // Check why we prevent it in the first place below
      element.removeEventListener('mousedown', preventDefault);
            // We focus so that we can close on blur.
      element.focus();
      isOpen = true;
    }
  };

  var close = function() {
    if (isOpen) {
      element.size = 1;
      // Prevent default so that the default select box open behaviour is muted.
      element.addEventListener('mousedown', preventDefault);
      isOpen = false;
    }
  };

    // For the reason above
  element.addEventListener('mousedown', preventDefault);

    // So that clicking elsewhere closes the box
  element.addEventListener('blur', close);

    // Toggle when click
  element.addEventListener('click', function(e) {
    if (isOpen) {
      close();
      // Call ballback if present
      if(selectCb) {
                selectCb(element.value);
            }
    } else {
      open();
    }
  });

  return {
    open: open,
      close: close
  };
};

// Usage
var selectionWrapper = SelectionWrapper(document.getElementById("select_element"), 7, function(value) {
  var para = document.createElement("DIV");
  para.textContent = "Selected option: " + value;
  document.getElementById("result").appendChild(para);
});

document.getElementById("trigger").addEventListener('click', function() {
  selectionWrapper.open();
}); 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-10-14T11:15:13.163

这是[https://jsfiddle.net/NickU/ahLy83mk/50/上的解决方案](https://jsfiddle.net/NickU/ahLy83mk/50/)

它使用 size="x" 打开下拉菜单，同时保持下拉菜单和父位置。该代码还使用 CSS 样式在不需要时隐藏右侧滚动区域。我修改了在 stackoverflow 上找到的代码，修复了问题并添加了样式。

HTML：

```
<div>DIV example: <select id="dropdownDiv">
    <option value="Alpha">Alpha</option>
    <option value="Beta">Beta</option>
    <option value="Gamma">Gamma</option>
    </select>
</div>

<table id='tab1'>
<tr><td>Empty Cell</td></tr>
<tr><td> <select id="dropdown1">
    <option value="Red">Red</option>
    <option value="Green">Green</option>
    <option value="Blue">Blue</option>
    </select>
</td>
<tr><td><select id="dropdown2">
<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10">10</option><option value="11">11</option><option value="12">12</option><option value="13">13</option><option value="14">14</option><option value="15">15</option><option value="15">1</option><option value="16">16</option><option value="17">17</option><option value="18">18</option><option value="19">19</option><option value="20">20</option><option value="21">21</option></select>
</td></tr>
<tr><td>Empty Cell</td></tr></table>
<br><button id="fire" type="button" onclick="openDropdown('dropdownDiv', this)" >Show dropdownDiv items</button>
<button id="fire" type="button" onclick="openDropdown('dropdown1', this)" >Show dropdown1 items</button>
<button id="fire" type="button" onclick="openDropdown('dropdown2', this)" >Show dropdown2 items</button> 
```

JavaScript：

```
 var lastClosedElem = null;
  var maxItemsInDropDown = 12;
  function openDropdown(elementId, opener)
  {
     if (lastClosedElem !== null && lastClosedElem === opener)
     {
            lastClosedElem = null;
            return;
     }
     lastClosedElem = opener;

     function down()
      {
          var $this = $(this);

          var td = $this.closest('td,div');
          if (td && td.length > 0)
              td.height(td.height());

          var pos = $this.offset();
          var len = $this.find("option").length;
          if (len > 1 && len < maxItemsInDropDown)
          {
              $this.addClass('no-scroll');
              $this.addClass('noArrow');
          }
          else if (len > maxItemsInDropDown)
          {
              len = maxItemsInDropDown;
          }

          $this.css("position", "absolute");

          var _zIndex = $this.css("zIndex");
          if (!_zIndex)
              _zIndex = 'auto';
          $this.attr("_zIndex", _zIndex);
          $this.css("zIndex", 9999);

          $this.attr("size", len); // open dropdown
          $this.unbind("focus", down);
          $this.focus();
      }

      var up = function()
      {
          var $this = $(this);
          $this.css("position", "static");
          $this.attr("size", "1");
          $this.removeClass('no-scroll');
          $this.removeClass('noArrow');

          var _zIndex = $this.attr("zIndex");
          if (_zIndex)
          {
              $this.css("zIndex", _zIndex);
          }
          $this.unbind("blur", up);
          $this.unbind("click", upClick);
          $this.focus();
      }

      function upClick(e)
      {
          up.call(this);
          lastClosedElem = null;
      }

      $("#" + elementId).focus(down).blur(up).click(upClick).trigger('focus');
  } 
```

CSS：

```
.no-scroll { cursor: pointer;}
.no-scroll::-webkit-scrollbar {display:none;}
.no-scroll::-moz-scrollbar {display:none;}
.no-scroll::-o-scrollbar {display:none;}
.no-scroll::-google-ms-scrollbar {display:none;}
.no-scroll::-khtml-scrollbar {display:none;}

.noArrow {
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
    padding-left: 3px;
    padding-right: 3px;
}

/* Cosmetic styles */
#tab1 tbody tr:nth-child(even) > td, div
{   background: linear-gradient( 180deg, #efefef 1%, #eeeeee 15%, #e2e2e2 85%); 
}

#tab1 tbody tr td
{   padding: 4px; 
}

#tab1
{   border: 1px solid silver; 
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-10-30T03:43:40.433

我可能是错的，但我不相信默认选择框是可能的。你可以用 JS 和 CSS 做一些事情来达到预期的结果，但不是（据我所知）vanilla SELECT。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-04-12T14:19:51.567

这不完全是您所要求的，但我喜欢这个解决方案的简单性。在我想要启动下拉菜单的大多数情况下，这是因为我正在验证用户是否确实做出了选择。我更改了下拉列表的大小并将其聚焦，这很好地突出了他们跳过的内容：

```
$('#cboSomething')[0].size = 3;
$('#cboSomething')[0].focus(); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-12-12T09:31:05.000

通过这个问题和类似问题中提到的一些解决方法可以打开“HTML 选择”。然而，更简洁的方法是向您的项目添加一个选择库，如“select2”或“chosen”。例如，以编程方式打开 select2 就像：

```
$('#target-select').select2('open'); 
```

# webserver - 什么是内存占用最少的最快的网络服务器解决方案？

> ID：249200
> 
> 赞同：25
> 
> 时间：2008-10-30T03:35:22.150
> 
> 标签：webserver

我需要一个网络服务器来提供非常简单的 POST/GET 请求作为 JSON。我不需要 MVC、Rails、Django。我需要占用很少内存的东西，最好是每个请求大约 5K。网络服务器将使用 Facebook Thrift 与 Scribe 等后端服务通信。每个http请求还会访问一个SQLLite数据库，每个用户一个，并且用户的数据不重叠。它将提供静态 html 文件以及 json 网络服务。

我正在考虑以下几点：

*   Njinx 与 PHP，
*   来自 Lua 的开普勒，
*   使用 libevent 或 libev 滚动我自己的，也许是调用 Lua，或者
*   麻糬网。

这些选项中哪个最好，还有哪些其他选项？我可以使用 PHP、python 或 Lua 编写基本脚本，甚至可以编写基本 C。我倾向于某种 Erlang 解决方案。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-30T04:00:40.010

我对 nginx ( [https://nginx.org/](https://nginx.org/) ) 有很好的体验，也就是说，在选择网络服务器时，您应该仔细查看您的要求并做出明智的决定，因为这些东西可能是非常特定于应用程序的。

您会注意到，在这个问题中，很多人推荐 g-wan、Webmachine 等……这些都是您应该查看和基准测试的东西，看看它们是否对您的用例更快。

这是一种鼓励啦啦队的问题，没有“正确答案”。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-11-13T02:00:37.667

作为 Webmachine 的作者之一，我很乐意为您提供帮助。我跟进的一个原因是，即使 Webmachine 中没有与 JSON 相关的代码，您可能会发现知道我们每天都使用它来处理许多不同的 JSON 请求和响应很有用。它简单、可干净地扩展，并且性能相当不错。

如果您只是想要静态交付，那么像 nginx 或 lighttpd 之类的东西将是一个明显的选择。对于静态和动态请求的混合以及内置的良好 Web 行为，您可能会发现 Webmachine 非常适合。

查看[http://code.google.com/p/webmachine/wiki/ExampleResources上的简单示例代码和](http://code.google.com/p/webmachine/wiki/ExampleResources)[http://blog.therestfulway.com/](http://blog.therestfulway.com/)博客上的最新帖子以 获取更多信息。

对我们来说效果很好；如果您有任何问题，请随时给我留言。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-01-19T17:35:12.560

要测量占用空间，请查看可执行文件大小（不要忘记共享库）。

TrustLeap G-WAN（150 KB，无依赖性）提供 Java、C/C++、Objective-C 和 D 脚本。

根据这些基准，它还比 Nginx 或 Lighttpd 使用更少的内存和 CPU 资源，同时运行速度更快：

[http://www.gwan.ch/benchmark](http://www.gwan.ch/benchmark)

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-05-25T18:19:13.207

切诺基网络服务器 www.cherokee-project.com

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-30T03:40:06.743

[Lighttpd](http://www.lighttpd.net/)的足迹非常好，以至于你的大部分内存可能会被你选择使用的任何语言占用（除非你走 C 路线，这真的不推荐）。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-10-30T03:50:13.383

IBM developerWorks 上有一篇文章，其中包含相当广泛的“轻量级”Web 服务器列表：
[轻量级 Web 服务器：http://www.ibm.com/developerworks/web/library/wa-ltwebserv/](https://web.archive.org/web/20130914054933/http://www.ibm.com/developerworks/web/library/wa-ltwebserv/)

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-10-30T05:07:15.507

Mochiweb 是超轻量级的，可以处理非常高的负载。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-07-21T11:47:30.383

最快的嵌入式网络服务器是 Snorkel - 在网站上结帐，他们在我的测试中使用 ab 破坏了 nginx。 [http://sites.google.com/site/snorkelembedded](http://sites.google.com/site/snorkelembedded)

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2011-01-01T18:26:56.040

G-WAN（150 KB，包括 ANSI C 脚本）有一个原生 JSON 解析器，考虑到这些特性，它可能是最快的可用（除了导入/导出文本之外，它还允许您按名称或值搜索条目）。

击败 150 KB 的占用空间（包括服务器 + 脚本引擎）将很困难。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2012-10-03T04:38:09.767

对于 C 或 Lua，Mongoose 是一个选项，[https://github.com/valenok/mongoose](https://github.com/valenok/mongoose)。每个请求使用超过 5k，主要是因为每个连接的数据有一个用于请求的缓冲区 + 预先分配的标头，并且默认情况下最大请求大小设置为 16k。虽然这是可调的，使它小于 5k 没有问题，只需`#define MAX_REQUEST_SIZE 16384`在嵌入 Mongoose 时更改 mongoose.c。就占用空间而言，它在磁盘上编译大约 50k，不包括 Lua（如果您需要它）和 SSL（如果您需要它）。运行时占用空间取决于操作系统。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2011-03-02T05:23:47.263

看看[这个](http://www.metabrew.com/article/a-million-user-comet-application-with-mochiweb-part-1)。我认为这正是您正在寻找的信息。您不需要功能齐全的 Web 服务器，因此使用 Erlang+libevent/libev 应该很好。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-30T04:27:10.127

既然您提到了 Python，您可能想看看[web.py](http://webpy.org/)，这是一种非常简单的方法来侦听端口 80 并将 URL 映射到操作。

如果你想与标准网络服务器配对（即在 Nginx/FastCGI 之后），它也可以通过你最喜欢的 CGI 运行——我将支持 Nginx 的记录，以在静态文件上实现大规模并发。（他们在 Reddit 上将它与 Lighttpd 一起使用。）

[thttpd](http://www.acme.com/software/thttpd/)是我要看的另一个网络服务器，尤其是在内存极其稀缺的情况下，比如在嵌入式系统上。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-02-05T16:34:42.880

如果可以用 C 或 C++ 编写代码，我认为 lighttz 将是最快的并且使用最少的内存。然而，之所以如此，是因为它使用的是 libev，而且它什么都没有，没有 php 支持，没有 html 支持——什么都没有。它提供的只是一个回调函数，您可以在其中处理每个 http 请求。您将不得不解析 http GET/POST 请求并将 html 作为字符串返回。您可以看到它以 nginx、lighttpd、apache 等为基准进行了基准测试，并且排名靠前（[链接](http://www.zenebo.com/word/asynchronous-programming/lighttz-a-simple-and-fast-web-server/)）。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-04-01T17:10:52.927

Nginx 与 Varnish（Facebook 使用的缓存）和 Apache Traffic Server（Yahoo! 使用的缓存）进行比较：

而且，Nginx 背后的人 Igor Sysoev[在他的博客上也不乏评论](http://nbonvin.wordpress.com/2011/03/24/serving-small-static-files-which-server-to-use/#comment-120)。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2010-06-21T10:52:33.130

你可以看看 FAPWS（快速异步 Python WSGI 服务器）。该项目的理念完全符合您的需求。 [http://www.fapws.org](http://www.fapws.org)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-11-27T17:33:12.743

看看 koanlogic.com 网站上的 klone ...针对嵌入式系统，它非常小，而且速度也非常快：http: [//john.freml.in/teepeedee2-vs-klone](http://john.freml.in/teepeedee2-vs-klone)。它可以用 C/C++（超高性能）或通常的 PHP/CGI（性能要低得多）编写脚本，具体取决于技能/品味......

# javascript - 查找所有未被选中的电台组

> ID：249214
> 
> 赞同：8
> 
> 时间：2008-10-30T03:49:28.067
> 
> 标签：javascript, jquery

我正在处理一个基本的测验/调查类型的应用程序，如果用户没有回答所有问题，我想在他们提交之前给他们一个提示。所有问题都是使用单选按钮的多项选择：

```
<div class="question">
    Q1: What is the second letter of the alphabet?
    <div class="choices">
        <input type="radio" name="question_1" value="1" /> A
        <input type="radio" name="question_1" value="2" /> B
        <input type="radio" name="question_1" value="3" /> C
    </div>
</div>
<div class="question">
    Q2: Which out of these is a berry?
    <div class="choices">
        <input type="radio" name="question_2" value="1" /> Apples
        <input type="radio" name="question_2" value="2" /> Bananas
        <input type="radio" name="question_2" value="3" /> Carrots
    </div>
</div>
<div class="question"> ...etc 
```

您如何找到哪些组没有勾选选项？或者至少，如果有任何没有得到回答？

jQuery 是好的，甚至是首选。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-10-30T03:58:03.633

啊，我想通了：

```
$('div.question:not(:has(:radio:checked))') 
```

# .net - 什么是最好的 .NET Micro Framework 开发板，价格低于 300 美元？

> ID：249220
> 
> 赞同：16
> 
> 时间：2008-10-30T03:53:00.633
> 
> 标签：.net, embedded, robotics, .net-micro-framework

我正在寻找用于个人机器人项目的相对便宜的 .NET Micro Framework 开发板。I/O 不需要太多，但我至少需要一个串行端口和一个以太网端口。

我宁愿不必在董事会上花费超过 300 美元，但如果有明显的理由要获得更好的董事会，我会很灵活。

目前我正在研究[SJJ Embedded Micro Solutions 的这款设备](http://www.sjjmicro.com/EDK.html)。有没有人使用过这个设备？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2010-09-09T12:17:24.313

[Netduino](http://www.netduino.com/)看起来很酷。而且只需 30 美元。

还有这个带有以太网的[Plus 版本。](http://www.netduino.com/netduinoplus/specs.htm)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-06-07T01:53:40.720

这是我一直在研究的两个不同的板。这两个都在 100.00 美元左右，是为业余爱好者准备的。这些板都没有板上的以太网，但通过添加外部以太网模块相对容易添加

[MeridianP](http://devicesolutions.net/Products/MeridianP.aspx)
[USBizi](http://www.ghielectronics.com/product/113)
[USBizi TCP/IP 和以太网支持](http://www.microframeworkprojects.com/project/30)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-09-30T17:07:57.260

**[FEZ](https://www.ghielectronics.com/catalog/category/274)**现在有一些仿制药出售，起价 29.00 美元 + 运费。

从带有 Arduino 兼容连接器 + 更多 I/O 的 74 MHz ARM 开发板开始。

*   它具有开源固件并完全支持 .NET 微框架以及用于其他一切的 JTAG 连接器。
*   支持运行时调试（断点、变量检查、步进等）
*   使用 Visual C# 2010 Express Edition 进行开发。
*   支持以太网屏蔽组网。

在同一个站点上，还有一个更复杂的开发板 - FEZ Cobra - 它有一个板载以太网连接器，价格约为 150 美元。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-30T04:00:02.303

我没有使用 SJJ 嵌入式板的经验，但我可能只需要试一试。

我的业余爱好是从事机器人项目，目前正在使用[Lego Mindstorms](https://en.wikipedia.org/wiki/Lego_Mindstorms)和 Microsoft 的 Robotics SDK 进行原型设计。我曾计划换用一个[Arduino](http://www.arduino.cc/)，它使用类似 C 的编程语言，组装后的重量约为 30 美元。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-10-05T11:47:54.217

您应该查看 GHI 系列的板/设备。FEZ Panda 的起价为 24.95 美元，ChipworkX 开发套件的起价为 399 美元

[http://www.ghielectronics.com/catalog](http://www.ghielectronics.com/catalog)

他们也是第一个使用 Gadgeteer HW

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-01-18T04:42:03.290

很快，Microsoft Gadgeteer 将被生产出来。

有关更多信息，请参阅此链接： [http ://research.microsoft.com/en-us/projects/gadgeteer/default.aspx](http://research.microsoft.com/en-us/projects/gadgeteer/default.aspx)

[这](http://channel9.msdn.com/Blogs/Clint/NET-Gadgeteer)是一个 Channel9 视频，向您展示如何使用 VS2010 创建嵌入式应用程序。它将于2011年春季发布...

# c# - 我可以将扩展方法添加到现有的静态类吗？

> ID：249222
> 
> 赞同：599
> 
> 时间：2008-10-30T03:54:04.407
> 
> 标签：c#, static, extension-methods

我是 C# 中扩展方法的粉丝，但在将扩展方法添加到静态类（例如`Console`.

例如，如果我想添加一个扩展`Console`名为 ' `WriteBlueLine`'，这样我就可以去：

```
Console.WriteBlueLine("This text is blue"); 
```

我通过添加一个本地的、公共的静态方法来尝试这个，`Console`作为一个' `this`'参数......但没有骰子！

```
public static class Helpers {
    public static void WriteBlueLine(this Console c, string text)
    {
        Console.ForegroundColor = ConsoleColor.Blue;
        Console.WriteLine(text);
        Console.ResetColor();
    }
} 
```

这没有添加一个 ' `WriteBlueLine`' 方法来`Console`......我做错了吗？还是要求不可能的事？

* * *

## 回答 #1

> 赞同：313
> 
> 时间：2008-11-21T16:44:56.610

不可以。扩展方法需要一个对象的实例变量（值）。但是，您可以在接口周围编写一个静态包装器`ConfigurationManager`。如果您实现包装器，则不需要扩展方法，因为您可以直接添加方法。

```
 public static class ConfigurationManagerWrapper
 {
      public static ConfigurationSection GetSection( string name )
      {
         return ConfigurationManager.GetSection( name );
      }

      .....

      public static ConfigurationSection GetWidgetSection()
      {
          return GetSection( "widgets" );
      }
 } 
```

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2011-03-27T19:20:53.930

你可以在 C# 中为类添加静态扩展吗？不，但你可以这样做：

```
public static class Extensions
{
    public static T Create<T>(this T @this)
        where T : class, new()
    {
        return Utility<T>.Create();
    }
}

public static class Utility<T>
    where T : class, new()
{
    static Utility()
    {
        Create = Expression.Lambda<Func<T>>(Expression.New(typeof(T).GetConstructor(Type.EmptyTypes))).Compile();
    }
    public static Func<T> Create { get; private set; }
} 
```

这是它的工作原理。虽然您不能在技术上编写静态扩展方法，但此代码利用了扩展方法中的漏洞。这个漏洞是你可以在 null 对象上调用扩展方法而不会得到 null 异常（除非你通过 @this 访问任何东西）。

所以这里是你将如何使用它：

```
 var ds1 = (null as DataSet).Create(); // as oppose to DataSet.Create()
    // or
    DataSet ds2 = null;
    ds2 = ds2.Create();

    // using some of the techniques above you could have this:
    (null as Console).WriteBlueLine(...); // as oppose to Console.WriteBlueLine(...) 
```

现在为什么我选择调用默认构造函数作为示例，以及为什么我不在第一个代码片段中返回 new T() 而不做所有的表达式垃圾？那么今天是你的幸运日，因为你得到了 2fer。任何高级 .NET 开发人员都知道，new T() 很慢，因为它会生成对 System.Activator 的调用，该调用在调用之前使用反射来获取默认构造函数。该死的微软！但是我的代码直接调用对象的默认构造函数。

静态扩展会比这更好，但绝望的时候需要绝望的措施。

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2009-01-12T14:44:24.980

这是不可能的。

是的，我认为 MS 在这里犯了一个错误。

他们的决定没有意义，并迫使程序员（如上所述）编写一个毫无意义的包装类。

这是一个很好的例子： Trying to extend static MS Unit testing class Assert: I want 1 more Assert method `AreEqual(x1,x2)`。

做到这一点的唯一方法是指向不同的类或编写一个包含 100 多个不同 Assert 方法的包装器。**为什么！？**

如果决定允许扩展实例，我认为没有逻辑理由不允许静态扩展。一旦可以扩展实例，关于划分库的论点就站不住脚了。

* * *

## 回答 #4

> 赞同：35
> 
> 时间：2017-06-01T15:12:46.133

我在试图找到 OP 的同一个问题的答案时偶然发现了这个线程。我没有找到我想要的答案，但我最终这样做了。

```
public static class Helpers
{
    public static void WriteLine(this ConsoleColor color, string text)
    {
        Console.ForegroundColor = color;
        Console.WriteLine(text);
        Console.ResetColor();
    }
} 
```

我像这样使用它：

```
ConsoleColor.Cyan.WriteLine("voilà"); 
```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2010-01-07T04:11:31.477

也许您可以使用自定义命名空间和相同的类名添加一个静态类：

```
using CLRConsole = System.Console;

namespace ExtensionMethodsDemo
{
    public static class Console
    {
        public static void WriteLine(string value)
        {
            CLRConsole.WriteLine(value);
        }

        public static void WriteBlueLine(string value)
        {
            System.ConsoleColor currentColor = CLRConsole.ForegroundColor;

            CLRConsole.ForegroundColor = System.ConsoleColor.Blue;
            CLRConsole.WriteLine(value);

            CLRConsole.ForegroundColor = currentColor;
        }

        public static System.ConsoleKeyInfo ReadKey(bool intercept)
        {
            return CLRConsole.ReadKey(intercept);
        }
    }
    class Program
    {
        static void Main(string[] args)
        {
            try
            {
                Console.WriteBlueLine("This text is blue");   
            }
            catch (System.Exception ex)
            {
                Console.WriteLine(ex.Message);
                Console.WriteLine(ex.StackTrace);
            }

            Console.WriteLine("Press any key to continue...");
            Console.ReadKey(true);
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2017-09-28T10:02:29.240

从 C#7 开始，不支持此功能。然而，有[关于在 C#8 中集成类似的东西](https://channel9.msdn.com/Blogs/Seth-Juarez/A-Preview-of-C-8-with-Mads-Torgersen)以及[值得支持的建议](https://github.com/dotnet/csharplang/issues/164)的讨论。

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2008-11-21T16:44:39.793

没有。扩展方法定义需要您要扩展的类型的实例。不幸的是；我不确定为什么需要它...

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2008-10-30T04:00:49.090

您不能将*静态*方法添加到类型。您只能将（伪）实例方法添加到类型的实例。

修饰符的重点`this`是告诉 C# 编译器将左侧的实例`.`作为静态/扩展方法的第一个参数传递。

在向类型添加静态方法的情况下，没有实例可以传递给第一个参数。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2012-01-11T19:35:41.130

至于扩展方法，扩展方法本身是静态的；但它们被调用就好像它们是实例方法一样。由于静态类不可实例化，因此您永远不会有该类的实例来调用扩展方法。由于这个原因，编译器不允许为静态类定义扩展方法。

Obnoxious 先生写道：“任何高级 .NET 开发人员都知道，new T() 很慢，因为它会生成对 System.Activator 的调用，该调用使用反射来获取默认构造函数，然后再调用它”。

如果类型在编译时已知，New() 将编译为 IL“newobj”指令。Newobj 采用构造函数进行直接调用。对 System.Activator.CreateInstance() 的调用编译为 IL“调用”指令以调用 System.Activator.CreateInstance()。对泛型类型使用 New() 将导致调用 System.Activator.CreateInstance()。Obnoxious 先生的帖子在这一点上不清楚……而且，令人讨厌。

这段代码：

```
System.Collections.ArrayList _al = new System.Collections.ArrayList();
System.Collections.ArrayList _al2 = (System.Collections.ArrayList)System.Activator.CreateInstance(typeof(System.Collections.ArrayList)); 
```

产生这个 IL：

```
 .locals init ([0] class [mscorlib]System.Collections.ArrayList _al,
           [1] class [mscorlib]System.Collections.ArrayList _al2)
  IL_0001:  newobj     instance void [mscorlib]System.Collections.ArrayList::.ctor()
  IL_0006:  stloc.0
  IL_0007:  ldtoken    [mscorlib]System.Collections.ArrayList
  IL_000c:  call       class [mscorlib]System.Type [mscorlib]System.Type::GetTypeFromHandle(valuetype [mscorlib]System.RuntimeTypeHandle)
  IL_0011:  call       object [mscorlib]System.Activator::CreateInstance(class [mscorlib]System.Type)
  IL_0016:  castclass  [mscorlib]System.Collections.ArrayList
  IL_001b:  stloc.1 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-11-21T16:39:23.440

当我学习扩展方法并且没有成功时，我尝试使用 System.Environment 执行此操作。正如其他人提到的那样，原因是因为扩展方法需要类的实例。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2018-08-12T04:39:56.290

不可能编写扩展方法，但是可以模仿您要求的行为。

```
using FooConsole = System.Console;

public static class Console
{
    public static void WriteBlueLine(string text)
    {
        FooConsole.ForegroundColor = ConsoleColor.Blue;
        FooConsole.WriteLine(text);
        FooConsole.ResetColor();
    }
} 
```

这将允许您在其他类中调用 Console.WriteBlueLine(fooText)。如果其他类想要访问 Console 的其他静态函数，则必须通过它们的命名空间显式引用它们。

如果您想将所有方法都放在一个地方，您可以随时将所有方法添加到替换类中。

所以你会有类似的东西

```
using FooConsole = System.Console;

public static class Console
{
    public static void WriteBlueLine(string text)
    {
        FooConsole.ForegroundColor = ConsoleColor.Blue;
        FooConsole.WriteLine(text);
        FooConsole.ResetColor();
    }
    public static void WriteLine(string text)
    {
        FooConsole.WriteLine(text);
    }
...etc.
} 
```

这将提供您正在寻找的那种行为。

*注意必须通过您放入的命名空间添加控制台。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2014-11-09T17:41:56.237

是的，在有限的意义上。

```
public class DataSet : System.Data.DataSet
{
    public static void SpecialMethod() { }
} 
```

这有效，但控制台不起作用，因为它是静态的。

```
public static class Console
{       
    public static void WriteLine(String x)
    { System.Console.WriteLine(x); }

    public static void WriteBlueLine(String x)
    {
        System.Console.ForegroundColor = ConsoleColor.Blue;
        System.Console.Write(.x);           
    }
} 
```

这是有效的，因为只要它不在同一个命名空间上。问题是您必须为 System.Console 拥有的每个方法编写代理静态方法。这不一定是坏事，因为您可以添加如下内容：

```
 public static void WriteLine(String x)
    { System.Console.WriteLine(x.Replace("Fck","****")); } 
```

或者

```
 public static void WriteLine(String x)
    {
        System.Console.ForegroundColor = ConsoleColor.Blue;
        System.Console.WriteLine(x); 
    } 
```

它的工作方式是将某些东西挂接到标准的 WriteLine 中。它可能是行数或坏词过滤器或其他任何东西。每当您在命名空间中指定 Console 时说 WebProject1 并导入命名空间 System，WebProject1.Console 将选择 System.Console 作为命名空间 WebProject1 中这些类的默认值。因此，只要您从未指定 System.Console.WriteLine，此代码会将所有 Console.WriteLine 调用变为蓝色。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-11-21T11:57:59.897

以下内容被拒绝作为对 tvanfosson 答案的[编辑。](https://stackoverflow.com/review/suggested-edits/1868685)我被要求贡献它作为我自己的答案。我使用了他的建议并完成了`ConfigurationManager`包装器的实现。原则上，我只是填写了`...`tvanfosson 的答案。

> 不可以。扩展方法需要一个对象的实例。但是，您可以围绕 ConfigurationManager 接口编写一个静态包装器。如果您实现包装器，则不需要扩展方法，因为您可以直接添加方法。

```
public static class ConfigurationManagerWrapper
{
    public static NameValueCollection AppSettings
    {
        get { return ConfigurationManager.AppSettings; }
    }

    public static ConnectionStringSettingsCollection ConnectionStrings
    {
        get { return ConfigurationManager.ConnectionStrings; }
    }

    public static object GetSection(string sectionName)
    {
        return ConfigurationManager.GetSection(sectionName);
    }

    public static Configuration OpenExeConfiguration(string exePath)
    {
        return ConfigurationManager.OpenExeConfiguration(exePath);
    }

    public static Configuration OpenMachineConfiguration()
    {
        return ConfigurationManager.OpenMachineConfiguration();
    }

    public static Configuration OpenMappedExeConfiguration(ExeConfigurationFileMap fileMap, ConfigurationUserLevel userLevel)
    {
        return ConfigurationManager.OpenMappedExeConfiguration(fileMap, userLevel);
    }

    public static Configuration OpenMappedMachineConfiguration(ConfigurationFileMap fileMap)
    {
        return ConfigurationManager.OpenMappedMachineConfiguration(fileMap);
    }

    public static void RefreshSection(string sectionName)
    {
        ConfigurationManager.RefreshSection(sectionName);
    }
} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-05-29T08:05:37.307

您可以在 null 上使用强制转换来使其工作。

```
public static class YoutTypeExtensionExample
{
    public static void Example()
    {
        ((YourType)null).ExtensionMethod();
    }
} 
```

扩展：

```
public static class YourTypeExtension
{
    public static void ExtensionMethod(this YourType x) { }
} 
```

你的类型：

```
public class YourType { } 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-11-30T01:57:29.867

用这个

```
public static class ConfigurationManagerWrapper
 {
  public static ConfigurationSection GetSection( string name )
  {
     return ConfigurationManager.GetSection( name );
  }

  .....

  public static ConfigurationSection GetWidgetSection()
  {
      return GetSection( "widgets" );
  }
 } 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2022-01-29T09:18:32.427

虽然 的方法`Console`是静态的，但它的静态方法只是将调用分别重定向到`Write()`和。是一个实例，其类型派生自抽象类。这使得定义扩展方法成为可能：`WriteLine()``Console.Out.Write()``Console.Out.WriteLine()``Out``TextWriter``TextWriter`

```
public static class ConsoleTextWriterExtensions
{
    public static void WriteBlueLine(this TextWriter writer, string text)
    {
        Console.ForegroundColor = ConsoleColor.Blue;
        writer.WriteLine(text);
        Console.ResetColor();
    }

    public static void WriteUppercase(this TextWriter writer, string text)
    {
        writer.Write(text.ToUpper());
    }
} 
```

然后可以像这样调用该方法：

```
Console.Out.WriteBlueLine(); 
```

最好的部分是标准错误流实例的类型`Console.Error`也从中派生`TextWriter`，使得相同的扩展方法也可用于`Console.Error`：

```
Console.Error.WriteBlueLine(); 
```

如果您定义了一个扩展方法，例如`WriteTable()`（用于将表写入控制台），这将非常有用，因为您也可以将它用于错误流或`TextWriter`.

较新版本的 C# 允许它更短，并使用for 将前缀变为红色的`using static`语句：`Console``Console.`

```
using static System.Console;

Out.WriteBlueLine("A blue line");
Error.WriteBlueLine("A blue line"); 
```

* * *

## 回答 #17

> 赞同：-5
> 
> 时间：2010-09-15T14:39:26.063

如果您愿意通过创建静态类的变量并将其分配给 null 来稍微“操纵”它，您可以这样做。但是，此方法不适用于类上的静态调用，因此不确定它有多少用途：

```
Console myConsole = null;
myConsole.WriteBlueLine("my blue line");

public static class Helpers {
    public static void WriteBlueLine(this Console c, string text)
    {
        Console.ForegroundColor = ConsoleColor.Blue;
        Console.WriteLine(text);
        Console.ResetColor();
    }
} 
```

# iphone - 有时不调用加速度计委托方法

> ID：249241
> 
> 赞同：8
> 
> 时间：2008-10-30T04:05:31.077
> 
> 标签：iphone, cocoa-touch, accelerometer

我有一个使用加速度计的应用程序。有时，应用程序将在没有更新加速度计数据的情况下启动。重新启动应用程序，有时问题仍然存在，有时则不会。更奇怪的是，有时我可以尝试 10 次，一切都按预期工作。这是一个错误，还是我缺少的东西。调试，当加速度计未更新时，永远不会调用此代码：

```
- (void)accelerometer:(UIAccelerometer *)accelerometer didAccelerate:(UIAcceleration *)acceleration; 
```

有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-31T04:46:30.463

我终于找到了解决办法。这是一个已知的错误。所以我发现的解决方法是启动一个线程并让这个线程检查加速度计委托是否已被调用，如果有，则退出线程，如果没有，再次设置委托，并重新测试，直到加速度计委托被调用。我对此进行了彻底的测试，它完美无缺。我希望这会在 iPhone OS 的下一次更新中得到解决。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T07:29:49.963

我有着同样的问题。我用 CrashLanding 示例制作的应用程序可能会发生 1/20 次。在我用我的应用程序注意到它之后，我抓住了一个新版本的 Crashlanding，安装了它，最后让它以加速度计失败开始。

我不知道如何解决它。老实说，我讨厌加速度计……至少对于控制游戏来说：-\

此外，当我启动“加速度计”示例项目时，加速度计偶尔会失败。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-31T15:39:06.243

正如其他人所提到的，这是一个已知的错误；我已经用 Apple 记录了这个错误（Bug Reporter 问题 ID 6093028），也许其他人也这样做了。据我所知，所有使用 UIAccelerometer 的应用程序（包括 Apple 的示例应用程序）都会遇到此问题，尽管发生频率各不相同。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-21T14:13:45.590

FWIW，我的应用程序被广泛使用，它使用加速度计，我从来没有遇到过这个问题。

我的用例可能与您的不同：我仅在应用程序启动后才根据用户请求启用它。

# javascript - 可扩展的谷歌地图覆盖

> ID：249247
> 
> 赞同：1
> 
> 时间：2008-10-30T04:09:05.687
> 
> 标签：javascript, google-maps

是否可以将图像叠加层添加到随着用户缩放而缩放的谷歌地图？

我当前的代码是这样工作的：

```
var map = new GMap2(document.getElementById("gMap"));

var customIcon = new GIcon();
customIcon.iconSize = new GSize(100, 100);
customIcon.image = "/images/image.png";

map.addOverlay(new GMarker(new GLatLng(50, 50), { icon:customIcon })); 
```

但是，这会添加一个叠加层，该叠加层在用户放大和缩小时保持相同的大小（它就像侧边栏缩放控件一样充当 UI 元素）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T04:11:54.713

有一个 zoomend 事件，当地图达到新的缩放级别时触发。事件处理程序接收上一个和新的缩放级别作为参数。

[http://code.google.com/apis/maps/documentation/reference.html#Events_GMap](http://code.google.com/apis/maps/documentation/reference.html#Events_GMap)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T08:16:04.440

你可能想看看 [openlayers](http://openlayers.org/)

它是一个非常强大的 Javascript API - 它支持一堆后端，允许您透明地在谷歌地图图块和雅虎地图图块之间切换。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T04:41:54.933

好吧，在尝试自己扩展一点之后，我找到了一个名为[EInserts](http://econym.org.uk/gmap/einsert.htm)的助手，我将对其进行检查。

添加：

Okay EInserts 是有史以来最酷的东西。它甚至有一种方法可以让您拖动图像并将其置于开发模式以便于排列。

# iphone - iPhone 应用程序支持哪些字体？

> ID：249251
> 
> 赞同：29
> 
> 时间：2008-10-30T04:12:02.483
> 
> 标签：iphone, fonts

我在这里找到了 iPhone 支持的字体列表
[http://daringfireball.net/misc/2007/07/iphone-osx-fonts](http://daringfireball.net/misc/2007/07/iphone-osx-fonts)

但我只是想确认一下，我们是否可以在应用程序中使用所有这些字体，或者我们仅限于某些类型的字体。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-10-30T05:44:27.430

只要您知道适当的名称，您应该能够使用这些字体中的任何一种。电话中会调用枚举字体系列和这些系列中的单个字体，但[此站点上](http://iosfonts.com/)提供了完整列表。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-30T12:36:56.833

有一个名为“字体”的免费 iPhone 应用程序将显示所有已安装的字体。（要下载它，[请单击此 iTunes 链接](http://itunes.apple.com/WebObjects/MZStore.woa/wa/viewSoftware?id=285217489&mt=8)。）

但请注意，您个人 iPhone 或模拟器上安装的字体可能与其他设备上安装的字体集不同。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2010-11-16T06:47:10.270

使用以下代码获取系统中的所有字体

// 获取系统上的所有字体

```
NSArray *familyNames = [UIFont familyNames];

for( NSString *familyName in familyNames ){
    printf( "Family: %s \n", [familyName UTF8String] );

    NSArray *fontNames = [UIFont fontNamesForFamilyName:familyName];
    for( NSString *fontName in fontNames ){
        printf( "\tFont: %s \n", [fontName UTF8String] );

    }
} 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-07-11T19:50:38.413

这是一个很好的 iPhone 支持字体列表，以及您需要在代码中使用的“真实”名称：[http](http://www.alexcurylo.com/blog/2008/10/05/snippet-available-uifonts/) ://www.alexcurylo.com/blog/2008/10/05/snippet-available-uifonts/ 。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-14T14:15:04.143

我创建了[iFonts](http://itunes.apple.com/app/ifonts/id392614957)，以便可以将列表通过电子邮件发送给设计师。它一直兼容到 3.0，因此您可以查看不同版本的 iOS 上可用的字体，而不必担心网页是否准确或完整。它一直经过测试，一直到 iOS 7。

# sql - 根据标志通过 SQL 从不同的表中选择

> ID：249253
> 
> 赞同：0
> 
> 时间：2008-10-30T04:12:54.727
> 
> 标签：sql, sql-server, sql-server-2005, tsql

我有一个脚本可以从一个更大的表中提取某些数据，其中一个字段特别是定期更改，例如

```
SELECT CASE @Flag WHEN 1 THEN t.field1 WHEN 2 THEN t.field2 WHEN 3 
       THEN t.field3 END as field,
       ...[A bunch of other fields]
FROM table t 
```

但是，现在的问题是我想对数据进行其他处理。我正在尝试找出最有效的方法。我需要有某种方法让标志通过，所以我知道我正在谈论由正确字段切片的数据。

我正在尝试的一种可能的解决方案（主要是为了看看会发生什么）是将脚本的内容转储到一个表函数中，该函数将标志传递给它，然后对函数的结果使用 SELECT 查询. 我已经设法让它工作了，但它比...慢得多

显而易见的解决方案，也可能是最有效地使用处理器周期：创建一系列缓存表，一个用于三个标志值中的每一个。然而，接下来的问题是找到某种方法从正确的缓存表中提取数据来执行计算。明显的，虽然不正确的反应是这样的

```
SELECT CASE @Flag WHEN 1 THEN table1.field WHEN 2 THEN table2.field WHEN 3 
       THEN table3.field END as field,
       ...[The various calculated fields]
FROM table1, table2, table3 
```

不幸的是，很明显，这会产生大量的交叉连接——这根本不是我想要的结果。

有谁知道如何将交叉连接变成“只看 x 表”？（不使用动态 SQL，这会让事情变得难以处理？）或者替代解决方案，这仍然相当快？

编辑：无论这是否是一个很好的理由，我试图实现的想法是没有三个基本相同的查询，它们仅在表上有所不同 - 然后每当对逻辑进行更改时都必须进行相同的编辑。这就是为什么到目前为止我一直避免“让标志完全分开”的事情......

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T04:56:20.193

我认为您需要`@Flag`完全退出查询，并使用它来决定运行三个单独的 SELECT 语句中的哪一个。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T05:22:48.907

FLAG 的每个值的 UNION ALL 怎么样。

在第一位的 where 子句中包括：

```
AND @flag = 1 
```

尽管关于为不同的标志值运行不同的选择语句的评论对我来说也很有意义。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T05:04:50.753

您似乎将注意力集中在技术上，而不是要解决的问题上。考虑每个案例从主表中选择一个 - 这就是您在这里描述的方式，不是吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-17T04:25:54.683

一个更简单的解决方案，一个同事建议的解决方案：

```
SELECT CASE @Flag WHEN 1 THEN t.field1 WHEN 2 THEN t.field2 WHEN 3 
   THEN t.field3 END as field,
   [A bunch of other fields],
   @Flag as flag
FROM table t 
```

然后根据最后一个字段做出决策。简单得多，我可能一开始就应该想到。

# c# - Visual Studio 2008 与 2005 或 C# 3.0 与 C# 2.0 有哪些新功能？

> ID：249256
> 
> 赞同：3
> 
> 时间：2008-10-30T04:15:48.357
> 
> 标签：c#, visual-studio-2008, visual-studio-2005, .net-2.0, .net-3.0

我正在浏览[C# 的隐藏功能](https://stackoverflow.com/questions/9033/hidden-features-of-c)问题，并认为我会尝试我不熟悉的功能之一。不幸的是，我使用的是 Visual Studio 2005，后来才介绍了相关功能。C# 3.0 (Visual Studio 2008) 与 C# 2.0 (Visual Studio 2005) 中的新功能是否有很好的列表？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T04:46:46.360

这不是一个完整的列表，但这些是我最喜欢的 C# 3.0 的一些新特性：

新的类型初始化器。而不是这样说：

```
Person person = new Person();
person.Name = "John Smith"; 
```

我可以这样说：

```
Person person = new Person() { Name = "John Smith" }; 
```

同样，我可以像这样初始化实现 IEnumerable 的类型，而不是单独添加项目：

```
List<string> list = new List<string> { "foo", "bar" }; 
```

lambda 表达式的新语法也不错。而不是输入这个：

```
people.Where(delegate(person) { return person.Age >= 21;); 
```

我可以输入这个：

```
people.Where(person => person.Age >= 21 ); 
```

您还可以为内置类型编写扩展方法：

```
public static class StringUtilities
{
    public static string Pluralize(this word)
    {
       ...
    }
} 
```

这允许这样的事情：

```
string word = "person";
word.Pluralize(); // Returns "people" 
```

最后。匿名类型。因此，您可以动态创建匿名类，如下所示：

```
var book = new { Title: "...", Cost: "..." }; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T05:53:35.930

我喜欢的几个功能：

*   VS 2008 支持针对各种版本的 .NET 框架，因此您可以针对 2.0、3.0 或 3.5

*   自动属性很好。

例如：

```
public int Id { get; set; } 
```

代替：

```
private int _id;
public int Id {
    get { return _id; }
    set { _id = value; }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T05:55:06.970

多目标支持。您可以从一个 IDE 构建 .NET 2 -> .NET 3.5。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T04:21:45.333

这是 .NET 3.0 上 MS 页面的链接：http: [//msdn.microsoft.com/en-us/library/bb822048.aspx](http://msdn.microsoft.com/en-us/library/bb822048.aspx) ...以及 C# 的 VS 2008：http: [//msdn.microsoft.com /en-us/library/bb383815.aspx](http://msdn.microsoft.com/en-us/library/bb383815.aspx)

我还没有尝试过 VS2008 和 .NET 3.0，但我认为这些链接可能会有所帮助；）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T04:51:16.383

Visual Studio 2008 的未知但强大的功能之一是[T4（文本模板转换工具包）](http://msdn.microsoft.com/en-us/library/bb126445.aspx)。T4 是直接内置于 Visual Studio 2008 中的代码生成器。

查看[Scott Guthrie 的](http://weblogs.asp.net/scottgu/default.aspx)博文[Visual Studio 2008 and .NET 3.5 Released](http://weblogs.asp.net/scottgu/archive/2007/11/19/visual-studio-2008-and-net-3-5-released.aspx)。这篇文章是在 Visual Studio 2008 和 .NET 3.5 发布时编写的。这篇文章包含很多关于 Visual Studio 2008 和 C# 3.0 新功能的链接。

# java - Jython 2.2.1，如何移动文件？shutils.move 不存在！

> ID：249262
> 
> 赞同：0
> 
> 时间：2008-10-30T04:22:08.080
> 
> 标签：java, python, jython, file-handling, shutil

```
'''use Jython'''

import shutil

print dir(shutil) 
```

没有shutil.move，如何使用Jython 移动文件？当我们这样做时，如何使用 Jython 删除文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T04:28:47.113

`os.rename()`移动和`os.unlink()`删除——就像 Python pre- 一样`shutil`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T17:00:21.807

如果您需要跨文件系统移动的支持，请考虑将 CPython 复制`shutil.py`到您的项目中。只要保留许可和归属信息，[Python 许可证就足够灵活（即使对于商业项目）。](http://www.python.org/download/releases/2.4.2/license/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-25T13:58:08.997

```
f1 = File(filename_old)
f1.nameTo(File(filename_new)) 
```

# c# - 将 xml 文档拆分成块

> ID：249266
> 
> 赞同：2
> 
> 时间：2008-10-30T04:23:14.677
> 
> 标签：c#, xml, .net-2.0

我有一个大型 xml 文档，需要一次处理 100 条记录

它是在用 c# 编写的 Windows 服务中完成的。

结构如下：

```
<docket xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="docket.xsd">
    <order>
        <Date>2008-10-13</Date>
        <orderNumber>050758023</orderNumber>
        <ParcelID/>
        <CustomerName>sddsf</CustomerName>
        <DeliveryName>dsfd</DeliveryName>
        <Address1>sdf</Address1>
        <Address2>sdfsdd</Address2>
        <Address3>sdfdsfdf</Address3>
        <Address4>dffddf</Address4>
        <PostCode/>

    </order>
    <order>
        <Date>2008-10-13</Date>
        <orderNumber>050758023</orderNumber>
        <ParcelID/>
        <CustomerName>sddsf</CustomerName>
        <DeliveryName>dsfd</DeliveryName>
        <Address1>sdf</Address1>
        <Address2>sdfsdd</Address2>
        <Address3>sdfdsfdf</Address3>
        <Address4>dffddf</Address4>
        <PostCode/>

    </order>

    .....

    .....

</docket> 
```

一个案卷中可能有数千个订单。

我需要把它切成 100 个元素块

然而，100 个订单中的每一个仍然需要用父“docket”节点包装并具有相同的命名空间等

这可能吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T06:23:16.790

另一个天真的解决方案；这次是 .NET 2.0。它应该让你知道如何去做你想要的。使用 Xpath 表达式而不是 Linq to XML。在我的 devbox 上在一秒钟内将 100 个订单案卷分成 10 个案卷。

```
 public List<XmlDocument> ChunkDocket(XmlDocument docket, int chunkSize)
    {
        List<XmlDocument> newDockets = new List<XmlDocument>();
        //            
        int orderCount = docket.SelectNodes("//docket/order").Count;
        int chunkStart = 0;
        XmlDocument newDocket = null;
        XmlElement root = null;
        XmlNodeList chunk = null;

        while (chunkStart < orderCount)
        {
            newDocket = new XmlDocument();
            root = newDocket.CreateElement("docket");
            newDocket.AppendChild(root);

            chunk = docket.SelectNodes(String.Format("//docket/order[position() > {0} and position() <= {1}]", chunkStart, chunkStart + chunkSize));

            chunkStart += chunkSize;

            XmlNode targetNode = null;
            foreach (XmlNode c in chunk)
            {
                targetNode = newDocket.ImportNode(c, true);
                root.AppendChild(targetNode);
            }

            newDockets.Add(newDocket);
        } 

        return newDockets;
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T04:53:04.007

天真，迭代，但有效[编辑：仅在 .NET 3.5 中]

```
 public List<XDocument> ChunkDocket(XDocument docket, int chunkSize)
    {
        var newDockets = new List<XDocument>();
        var d = new XDocument(docket);
        var orders = d.Root.Elements("order");
        XDocument newDocket = null;

        do
        {
            newDocket = new XDocument(new XElement("docket"));
            var chunk = orders.Take(chunkSize);
            newDocket.Root.Add(chunk);
            chunk.Remove();
            newDockets.Add(newDocket);
        } while (orders.Any());

        return newDockets;
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T06:49:48.827

如果一次处理 100 个订单的原因是出于性能目的，例如打开一个大文件花费太多时间和资源，您可以利用 XmlReader 一次处理一个订单元素，而不会降低性能。

```
XmlReader reader = XmlReader.Create(@"c:\foo\Doket.xml")
while( reader.Read())
{
  if(reader.LocalName == "order")
  {
     // read each child element and its value from the reader.
     // or you can deserialize the order element by using a XmlSerializer and Order class
  }     
} 
```

# sql - 在存储过程中嵌入 html 代码

> ID：249281
> 
> 赞同：4
> 
> 时间：2008-10-30T04:30:59.230
> 
> 标签：sql, html, stored-procedures

我们这里似乎有一些开发人员认为创建输出 HTML 或 Javascript 代码的存储过程是合法的事情。在我看来，这是对关注点分离模型的最终滥用。是不是经常看到人们在做这样的事情？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T04:45:39.793

尤科。有几个问题：

*   无法“剥皮”应用程序 - 转移到全新的演示文稿，如 Flex、桌面表单等。
*   您会阻止图形设计师或 UI 专家在对他们来说富有成效的环境中工作。
*   如果你混合你的 HTML 存储（一些在模板中，一些在数据库中，一些在应用程序代码中），追踪 UI 问题绝对是可怕的。
*   没有 IDE DOM/布局验证
*   如果不运行 db，您将无法预览或制作原型。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T06:53:58.880

如果这样做是随意的，则可能违反了分层的关注点分离原则

另一方面，专门编写用于从数据库信息生成 html 的 sproc 在某些情况下可能非常合法和高效，尤其是。对于高度动态的软编码网站，即网站结构的一部分在数据库中编码，或者数据库本身包含 HTML 片段...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T04:33:18.650

大错特错！不过只是我的看法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T10:23:03.497

终极禁忌。除了安全、低耦合和分层等所有先前的问题之外，当您的公司想要联合内容、将其提供给移动设备（wap 等）、在基于文本的电子邮件或打印等中使用它时会发生什么。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T10:36:09.133

我不认为问题在于关注点分离，因为 sprocs 只是缺乏正确执行此操作的工具。

此外，遇到此代码的任何其他人都会遇到问题，并且很难进行源代码控制、集成和单元测试。

唯一的例外是，如果您的数据库实际上存储了在其他地方编辑的 Javascript 或 HTML，例如作为 CMS 的一部分。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T12:20:41.297

我在一家商店的工作中幸存下来，整个应用程序都发出了所有 HTML，幸好使用了对外部 CSS/JS 的引用。

在项目开始时，Oracle 不支持单独的 Web/应用程序服务器 - 一切都通过 PL/SQL。

有时你只需要使用whatcha got。

话虽如此，我不认为在任何现代数据库或应用程序架构中从存储过程生成视图级工件有任何借口。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T10:08:24.713

是的，不幸的是，我见过很多人这样做。不过你是对的：它是卑鄙的。

通常层分离问题是当两个相邻层混合时 - 您在数据库层中获得业务逻辑，或在业务层中获得表示逻辑。但这完全跳过了一层，将用户端的展示放在离它所属的地方很远的地方！注定是无法维持的恐怖。

如果这些流氓不相信这种理智的请求，你可能会因为安全问题而抓住他们。存储过程中的数据库层功能不太可能知道如何转义文本以输出到 HTML 或 JS-string-literal，从而导致非常可能的脚本注入黑客攻击导致 XSS 攻击。例如，如果用户称自己为“Brian von < script>steal(document.cookie)< /script>”，并且将其粗略地连接到存储过程 HTML 结果中......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-30T04:37:51.807

这是一个经典的新手错误。

如果您必须在 SP 输出中添加标记，您至少应该使用您自己的标准化编码，然后让应用程序将其处理为 HTML/Javascript。

例如

```
"<javascriptpopup>[outputuotputoutput]</javascriptpopup>" 
```

或者

```
"<prettyfont>[outputuotputoutput]</prettyfont>" 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-30T05:11:19.010

不言而喻的违背了“低耦合、高内聚”的原则。

我无法想象他们会如何建议将 CSS 格式应用于这样的野兽。

# python - 没有站点包的 Ubuntu 上的 Virtualenv

> ID：249283
> 
> 赞同：25
> 
> 时间：2008-10-30T04:32:52.830
> 
> 标签：python, ubuntu, pygtk, virtualenv

我最近在用 python 开发时一直在使用 virtualenv。我喜欢使用 --no-site-packages 选项的隔离开发环境的想法，但是在开发 PyGTK 应用程序时这样做可能有点棘手。PyGTK 模块默认安装在 Ubuntu 上，我想让 virtualenv（带有 --no-site-packages）知道位于系统其他位置的特定模块。

最好的方法是什么？还是我应该把它吸干并放弃 --no-site-packages 选项？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-11-03T22:20:07.110

```
$ virtualenv --no-site-packages --python=/usr/bin/python2.6 myvirtualenv
$ cd myvirtualenv
$ source bin/activate
$ cd lib/python2.6/
$ ln -s /usr/lib/pymodules/python2.6/gtk-2.0/ 
$ ln -s /usr/lib/pymodules/python2.6/pygtk.pth 
$ ln -s /usr/lib/pymodules/python2.6/pygtk.py 
$ ln -s /usr/lib/pymodules/python2.6/cairo/
$ python
>>> import pygtk
>>> import gtk 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-30T05:22:13.760

一种方法是使用 sys.path 将路径添加到代码中。

```
import sys

sys.path.append(somepath) 
```

另一种方法是使用站点，除了添加到 sys.path 之外，它还处理 .pth 文件。

```
import site

site.addsitedir(sitedir, known_paths=None) 
```

[https://docs.python.org/library/site.html](https://docs.python.org/library/site.html)

但是您可能不想将此添加到所有相关代码中。

我已经看到有人提到 sitecustomize.py 被用来执行类似的操作，但是经过一些测试后，我无法让它按预期工作。

这里提到了 sitecustomize.py 的自动导入在 2.5 中结束，如果你不在 2.5 上试试。（只需将上述路径添加方法之一添加到文件中，然后将其放入程序运行的目录中）帖子中提到了针对 2.5 及更高版本的用户的解决方法。

[http://code.activestate.com/recipes/552729/](http://code.activestate.com/recipes/552729/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T09:57:08.963

我发现在这种情况下，符号链接，甚至复制特定文件（包、模块、扩展）都非常有效。

它允许程序模拟在目标环境中运行，而不是更改应用程序以适应开发环境。

像 AppEngine 这样的东西也是一样的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-08-26T21:56:56.923

在此处查看 postmkvirtualenv 挂钩脚本：

[https://stackoverflow.com/a/9716100/60247](https://stackoverflow.com/a/9716100/60247)

在这种情况下，他在创建新的 Virtualenv 后使用它来导入 PyQt 和 SIP，但您可以将所需的包添加到 LIBS。

并投票赞成该脚本，因为它太棒了:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-12-14T16:38:33.410

如果你想在 virtualenv 中包含相关系统的 python gtk-2.0 的链接，你可以使用 pip 安装[ruamel.venvgtk](https://pypi.python.org/pypi/ruamel.venvgtk)：

pip install ruamel.venvgtk 你没有导入任何东西，链接是在安装过程中设置的。

如果您使用`tox`，这特别方便，在这种情况下，您只需要包含依赖项（对于 tox）：

```
deps:
    pytest
    ruamel.venvgtk 
```

并且新设置的 python2.7 环境将在运行测试之前包含相关链接。

可以在[此答案中找到有关如何设置链接的更多详细信息](https://stackoverflow.com/a/27471354/1307905)

# internet-explorer - 如何在 IE 插件 (BHO) 中控制工具栏位置

> ID：249293
> 
> 赞同：0
> 
> 时间：2008-10-30T04:41:45.090
> 
> 标签：internet-explorer, plugins, bho, browser

我正在尝试使用“ [Browser Helper Objects](http://msdn.microsoft.com/en-us/library/bb250436.aspx) ”（BHO）开发一个 Internet Explorer 7 插件。目标是拥有一个标准的 IE 工具栏，其中包含一些按钮和一个自定义控件。我想在 .NET 中开发它

我从[这里](http://www.codeproject.com/KB/shell/dotnetbandobjects.aspx)的基线样本开始。这工作正常，但...

*   如何控制工具栏在浏览器中的显示位置？目前它只显示在菜单行上。
*   如何让用户像其他工具栏一样移动它。大多数其他工具栏（内置和插件）都有一个虚线分隔符，您可以在其中抓取和移动它们。

如果有更好的方法来开发这个（比如 FireFox JS 插件），我也想知道。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-25T21:23:54.000

如果您使用提供的链接中的基线工具栏，您可能会发现这篇 [文章](http://www.codeproject.com/KB/cs/Issuewithbandobjects.aspx)很有用。它解决了原始文章中工具栏实现的一些缺点，包括如何移动工具栏（往文章底部看）。

而且，据我所知，没有更好的方法可以在 C#/.NET 中创建 IE 插件，尽管我希望有。

# polymorphism - 类 C 语言中的返回类型多态性

> ID：249296
> 
> 赞同：12
> 
> 时间：2008-10-30T04:44:08.253
> 
> 标签：polymorphism, return-type

为什么我们看不到允许在返回类型中具有多态性的可调用对象的类 C 语言？我可以看到额外的类型推断将如何成为一个障碍，但我们有[很多](http://en.wikipedia.org/wiki/Type_inference)具有成熟类型推断系统的语言（适用于不同级别的“工作”）。

**编辑：**通过返回类型多态性，我的意思是仅在返回类型中重载函数签名。例如，C++ 和 Java 只允许在形式参数的类型中重载，而在返回类型中不允许重载。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-10-30T04:52:44.740

如果“返回类型多态性”是指基于返回值类型的重载，我不确定其他语言，但对于 C++，这是答案（几乎来自马的嘴）：

函数返回类型不会仅仅因为 Stroustrup（我假设来自其他 C++ 架构师的输入）希望重载决策是“上下文无关的”而在重载决议中发挥作用。请参阅“C++ 编程语言，第三版”中的 7.4.1 - “重载和返回类型”。

> 原因是保持单个运算符或函数调用的分辨率与上下文无关。

他们希望它只基于重载的调用方式——而不是结果的使用方式（如果它被使用的话）。事实上，许多函数在调用时不使用结果，或者结果将用作更大表达式的一部分。当他们决定这样做时，我肯定会发挥作用的一个因素是，如果返回类型是解决方案的一部分，则会有许多对重载函数的调用，这些函数需要使用复杂的规则来解决，或者必须让编译器抛出调用不明确的错误。

而且，天知道，C++ 重载解析就目前而言已经足够复杂了……

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T06:50:51.540

我很想在某些语言中看到这个特性，不仅让函数 foo 可以返回一个 double 或一个 int 或一个字符串，而且让 foo 可以返回一个结构或不同类的对象。消除歧义调用将是相当微不足道的 - 如果调用不明确，则需要强制转换来选择所需的返回类型。例子：

```
string s = foo();    //foo returns a string
double x = foo();    //foo returns a double
int i = foo();       //foo returns an integer
float f = (float)(int)foo();    //call the int foo and convert to float 
```

此外

```
Animal a = fooFactory();    //fooFactory returns an Animal
Plant p = fooFactory();     //foofactory returns a Plant 
```

这些情况并不经常出现，但是当他们这样做时，解决方法通常是相当难看的......

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T05:18:52.847

```
double x = (double)foo(); 
```

如果存在可以返回 double、int、float 等的 foo() 版本，则上述内容不明确。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T08:17:52.643

在 C++ 中，您可以在很大程度上使用类来做到这一点。例如，假设我有一个数据类型，它在输入和输出时通常会转换为 ASCII；

```
typedef char* pchar;

class   MyType
{
public:

 operator pchar() { return(ConvertToASCII()); }
 MyType& operator=(char* input) { ConvertFromASCII(input); return(*this); }

 pchar ConvertToASCII();
 void ConvertFromASCII(pchar ASCII);
} 
```

这类东西经常用在 C++ 框架中。例如，看看 MFC CString 类的实现。恕我直言，这是一个非常有用的工具，尽管在某些情况下很危险。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T06:49:29.420

由于类型的自动转换，当返回类型接近时，不知道要调用哪个函数。

# .net - 定制系列 - 仍然值得额外的工作？

> ID：249297
> 
> 赞同：3
> 
> 时间：2008-10-30T04:45:05.817
> 
> 标签：.net, performance, collections, generics

对不起，如果我不了解我的术语，我只有大约 2.4 年的编程经验，主要是在 .NET 方面。

目前，我是大型机商店中的两名 .NET 开发人员之一，另一名开发人员设定了标准，并且是一位出色的编码员，拥有更多经验和 CS 学位（我 100% 自学成才）。

我们为每个应用程序使用自定义集合，最近从 .NET 2.0 开始，我让他使用泛型而不是 ArrayList，而且它们的眼球性能似乎做得很好。我们开发了一个自动化程序，它使用 SQLDMO 连接到数据库，并为我们想要的任何对象创建基本数据层和业务层，此外它还处理逻辑删除等。

当性能是您优化的目标时，您何时可以证明不使用自定义集合并为其编写自定义排序？目前我们使用硬编码排序，因为我们所看到的一切都慢了很多，因为大多数其他选项使用反射或臃肿的数据集/LINQ（与自定义集合相比，它仍然像一年前一样慢吗？）。

有没有其他人严格使用自定义泛型集合而不是走简单的路线？性能牺牲是否像我被引导相信的那样重要？由于我仍处于开发生涯的初级阶段，我想说下一个合乎逻辑的步骤是我自己开始对事物进行基准测试，但我也想获得其他专业人士的意见......那么，如何其他人都这样做吗？是唯一一个真正严格使用自定义集合而不是更快、更容易创建解决方案的人之一吗？

所有意见将不胜感激。

**编辑：**对术语感到抱歉，我知道我会得到一些东西。我所说的自定义集合的意思确实是，使用自定义类，以及一个继承 List(Of T) 并实现 IComparable 来处理排序的自定义集合类。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T07:25:47.473

我也使用泛型列表或字典，但我经常根据泛型创建自己的类。所以我可以定义一个`class CustomerList : List<Customer>`. 这使我可以向类添加自定义功能，并且如果需要，我还可以在以后轻松地将其替换为自定义实现。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T14:10:32.370

当谈到优化和集合时，您应该首先查看算法复杂性。

一个简单的例子是 - 如果您有一个对象列表，并且您不断地在该列表中查找内容，并且它变得非常大，那么您最好使用字典来代替。字典查找具有与列表不同的查找复杂性保证（在 O(log n) 和 O(1) 之间，而不是 O(n) 之间）。

如果您还没有熟悉各种集合类的算法复杂性，那么值得让自己熟悉（如果您完全不熟悉它，[请查看维基百科文章](http://en.wikipedia.org/wiki/Asymptotic_complexity)）

如果您使用的是关联集合，例如 Dictionary，您还应该检查您是否在集合中的对象上使用了 GetHashCode() 的最佳实现

.Net 的问题（警告：到目前为止，我自己只使用了 .Net 2.0）是它们没有很好的集合类范围，并且它们的复杂性保证没有像应有的那样广为人知。

就我个人而言，我使用出色的 PowerCollections 来扩充我的收藏，其中添加了 Sets 和 MultiDictionaries 等。这为您提供了更多可供选择的工具，这意味着您可以多次选择正确的工具。

到目前为止，我还没有遇到过由于内置（或 PowerCollection）集合（旧的、前通用版本除外）性能不佳而不得不编写自定义集合类的情况。我的感觉是，如果在确保您使用了正确的复杂性并进行了分析之后，您发现它们的性能仍然不够高，那么 .Net 可能不是您的应用程序的最佳选择。YMMV。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T06:33:06.100

我建议在早期开发中使用标准的通用集合。如果您以后发现性能瓶颈，您可以使用自己的自定义集合重新设计。用 Code Complete 的作者 Steve McConnell 的话来说，人类在估计性能方面是出了名的差。除非您确定将访问该类及其方法的数量，否则不值得优化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T05:05:39.537

我总是使用通用集合。我可能偶尔会从现有的泛型类派生我自己的集合类以添加我自己的方法和行为，但它仍然是泛型的。如果性能是一个很大的问题，您可能不会使用内置的集合类。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T05:09:42.990

我个人使用现有的标准通用集合，最常见的是列表和字典。如果可能，我会尝试在数据库中进行排序，因为我发现它更容易管理。

我看不出真正需要自定义集合的地方，也不会提供性能改进，并且它对实现不太熟悉。

在 2.0 中引入泛型之前，自定义集合更为常见

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T07:39:59.350

自定义集合在接口中使用时可能具有优势，因为与使用标准集合相比，您可以更好地控制它们的使用方式。不过，请务必始终返回接口而不是具体类。这样，您的用户不必关心集合类的类型，并且您可以在不破坏接口的情况下更改实际类型。

在大多数情况下，使用默认集合之一就可以了。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-30T13:34:04.783

现在使用 .net 3.5 我使用通用集合类（列表、字典），如果我需要将逻辑添加到这些集合中，我使用扩展方法。例如：

```
public static class Extensions
{
   public static Customer GetCustomerByName( this List<Customer> customers )
  {
     …
    return customer;
  }
}

var customers = new List<Customer>();
customers.Add( new Customer());
var customer = customers.GetCustomerByName( “Smith” ); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-05-04T07:38:36.100

我最近收集了一些使用自定义集合可能有价值的情况（和基准）。它与 .NET 没有直接关系，但是，它是一个相当普遍的考虑因素，可能有助于确定哪种集合更适合特定问题。

[数组、字典、集合——性能、功能、可靠性](http://sibirjak.com/osflash/blog/array-dictionary-collections-performance-functionality-reliability/)

# mysql - 来自 Sql 数据库的简单随机样本

> ID：249301
> 
> 赞同：115
> 
> 时间：2008-10-30T04:48:02.847
> 
> 标签：mysql, sql, postgresql, random

如何在 SQL 中获取有效的简单随机样本？有问题的数据库正在运行 MySQL；我的表至少有 200,000 行，我想要一个大约 10,000 的简单随机样本。

“明显”的答案是：

```
SELECT * FROM table ORDER BY RAND() LIMIT 10000 
```

对于大表来说，这太慢了：它调用`RAND()`每一行（已经把它放在 O(n) 处），并对它们进行排序，充其量是 O(n lg n)。有没有办法比 O(n) 更快地做到这一点？

*注意*：正如 Andrew Mao 在评论中指出的那样，如果您在 SQL Server 上使用这种方法，您应该使用 T-SQL 函数`NEWID()`，因为 RAND()[可能为所有行返回相同的值](http://msdn.microsoft.com/en-us/library/ms177610.asp)。

*编辑：5年后*

我在一张更大的桌子上再次遇到了这个问题，最后使用了@ignorant 解决方案的一个版本，有两个调整：

*   将行采样到我想要的样本大小的 2-5 倍，成本低廉`ORDER BY RAND()`
*   在每次插入/更新时将结果保存`RAND()`到索引列。（如果您的数据集不是很频繁更新，您可能需要找到另一种方法来保持此列的新鲜度。）

为了对包含 1000 个项目的表进行抽样，我计算行数并将结果抽样到平均 10,000 行的 freeze_rand 列：

```
SELECT COUNT(*) FROM table; -- Use this to determine rand_low and rand_high

  SELECT *
    FROM table
   WHERE frozen_rand BETWEEN %(rand_low)s AND %(rand_high)s
ORDER BY RAND() LIMIT 1000 
```

（我的实际实现涉及更多工作以确保我不会欠采样，并手动包装 rand_high，但基本思想是“将 N 随机减少到几千。”）

虽然这会做出一些牺牲，但它允许我使用索引扫描对数据库进行采样，直到它再次小到可以`ORDER BY RAND()`再次使用。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2013-01-31T15:43:48.617

我认为最快的解决方案是

```
select * from table where rand() <= .3 
```

这就是为什么我认为这应该完成这项工作。

*   它将为每一行创建一个随机数。数字介于 0 和 1 之间
*   如果生成的数字介于 0 和 0.3 (30%) 之间，它会评估是否显示该行。

这假设 rand() 正在生成均匀分布的数字。这是最快的方法。

我看到有人推荐了该解决方案，但他们在没有证据的情况下被击落......这就是我要说的 -

*   这是 O(n) 但不需要排序，因此它比 O(n lg n) 快
*   mysql 非常有能力为每一行生成随机数。试试这个 -

    从 INFORMATION_SCHEMA.TABLES 限制 10 中选择 rand()；

由于有问题的数据库是 mySQL，因此这是正确的解决方案。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-10-31T03:59:18.233

这里有一个关于这类问题的非常有趣的讨论：[http://www.titov.net/2005/09/21/do-not-use-order-by-rand-or-how-to-get-random-rows-from-table/](http://www.titov.net/2005/09/21/do-not-use-order-by-rand-or-how-to-get-random-rows-from-table/)

我认为绝对没有假设您的 O(n lg n) 解决方案是最好的。虽然实际上使用一个好的优化器或稍微不同的技术，但您列出的查询可能会更好一些，O(m*n) 其中 m 是所需的随机行数，因为它不必对整个大数组进行排序，它可以只搜索最小的 m 次。但是对于您发布的那种数字，无论如何 m 都大于 lg n 。

我们可以尝试三个假设：

1.  表中有一个唯一的索引主键

2.  您要选择的随机行数（m）远小于表中的行数（n）

3.  唯一主键是一个整数，范围从 1 到 n，没有间隙

只有假设 1 和 2，我认为这可以在 O(n) 中完成，尽管您需要将整个索引写入表以匹配假设 3，因此它不一定是一个快速的 O(n)。如果我们可以额外假设表的其他优点，我们可以在 O(m log m) 中完成任务。假设 3 将是一个易于使用的附加属性。使用一个很好的随机数生成器，可以保证在连续生成 m 个数字时没有重复，O(m) 解决方案将是可能的。

给定这三个假设，基本思想是在 1 和 n 之间生成 m 个唯一随机数，然后从表中选择具有这些键的行。我现在没有 mysql 或任何东西在我面前，所以在稍微伪代码中，这看起来像：

```
 create table RandomKeys (RandomKey int)
create table RandomKeysAttempt (RandomKey int)

-- generate m random keys between 1 and n
for i = 1 to m
  insert RandomKeysAttempt select rand()*n + 1

-- eliminate duplicates
insert RandomKeys select distinct RandomKey from RandomKeysAttempt

-- as long as we don't have enough, keep generating new keys,
-- with luck (and m much less than n), this won't be necessary
while count(RandomKeys) < m
  NextAttempt = rand()*n + 1
  if not exists (select * from RandomKeys where RandomKey = NextAttempt)
    insert RandomKeys select NextAttempt

-- get our random rows
select *
from RandomKeys r
join table t ON r.RandomKey = t.UniqueKey 
```

如果您真的关心效率，您可能会考虑使用某种程序语言进行随机密钥生成并将结果插入数据库中，因为除了 SQL 之外的几乎任何东西都可能在所需的循环和随机数生成方面更好.

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2014-09-10T20:29:05.290

# 比 ORDER BY RAND() 更快

我测试了这种方法比 快得多`ORDER BY RAND()`，因此它在**O(n)**时间内运行，并且速度非常快。

来自[http://technet.microsoft.com/en-us/library/ms189108%28v=sql.105%29.aspx](http://technet.microsoft.com/en-us/library/ms189108%28v=sql.105%29.aspx)：

**非 MSSQL 版本**——我没有测试这个

```
SELECT * FROM Sales.SalesOrderDetail
WHERE 0.01 >= RAND() 
```

**MSSQL 版本：**

```
SELECT * FROM Sales.SalesOrderDetail
WHERE 0.01 >= CAST(CHECKSUM(NEWID(), SalesOrderID) & 0x7fffffff AS float) / CAST (0x7fffffff AS int) 
```

这将选择约 1% 的记录。因此，如果您需要选择确切的百分比或记录数，请在一定的安全范围内估计您的百分比，然后使用更昂贵的`ORDER BY RAND()`方法从结果集中随机抽取多余的记录。

# 甚至更快

我能够进一步改进这种方法，因为我有一个众所周知的索引列值范围。

例如，如果您有一个具有均匀分布整数 [0..max] 的索引列，您可以使用它来随机选择 N 个小区间。在您的程序中动态执行此操作，以便为每个查询运行获取不同的集合。此子集选择将为**O(N)**，它可能比您的完整数据集小许多数量级。

在我的测试中，我使用 ORDER BY RAND()将获取 20 个（20 百万）样本记录所需的时间从**3 分钟减少到了****0.0 秒**！

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2014-05-01T00:24:10.280

显然，在某些版本的 SQL 中有一个`TABLESAMPLE`命令，但并非在所有 SQL 实现中（尤其是 Redshift）。

[http://technet.microsoft.com/en-us/library/ms189108(v=sql.105).aspx](http://technet.microsoft.com/en-us/library/ms189108%28v=sql.105%29.aspx)

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2012-05-18T17:11:03.247

只需使用

```
WHERE RAND() < 0.1 
```

获得 10% 的记录或

```
WHERE RAND() < 0.01 
```

获取 1% 的记录等。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2020-10-30T16:20:28.923

在 Microsoft SQL Server、PostgreSQL 和 Oracle（但不是 MySQL 或 SQLite）等某些方言中，您可以执行以下操作

```
select distinct top 10000 customer_id from nielsen.dbo.customer TABLESAMPLE (20000 rows) REPEATABLE (123); 
```

不这样做的原因`(10000 rows)`是`top`逻辑`TABLESAMPLE`给你的行数非常不准确（有时是 75%，有时是 1.25% 的倍数），所以你想要过采样并选择你想要的确切数字。`REPEATABLE (123)`用于提供随机种子。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-09-02T20:40:09.130

我想指出，所有这些解决方案似乎都可以在没有替换的情况下进行采样。从随机排序中选择前 K 行或以随机顺序加入包含唯一键的表将产生一个随机样本，无需替换。

如果您希望您的样本是独立的，则需要更换样本。有关如何以类似于 user12861 的解决方案的方式使用 JOIN 执行此操作的一个示例，请参阅[问题 25451034 。](https://stackoverflow.com/questions/25451034/generating-bootstrapped-samples-in-t-sql)该解决方案是为 T-SQL 编写的，但该概念适用于任何 SQL 数据库。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2020-10-15T08:58:35.990

尝试

```
SELECT TOP 10000 * FROM table ORDER BY NEWID() 
```

这会产生预期的结果，而不会过于复杂吗？

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-09-07T07:53:52.193

从我们可以基于集合检索表的 id（例如计数 5）的观察开始：

```
select *
from table_name
where _id in (4, 1, 2, 5, 3) 
```

我们可以得出这样的结果，如果我们可以生成字符串`"(4, 1, 2, 5, 3)"`，那么我们将有一个比`RAND()`.

例如，在 Java 中：

```
ArrayList<Integer> indices = new ArrayList<Integer>(rowsCount);
for (int i = 0; i < rowsCount; i++) {
    indices.add(i);
}
Collections.shuffle(indices);
String inClause = indices.toString().replace('[', '(').replace(']', ')'); 
```

如果 ids 有间隙，那么初始的 arraylist`indices`是对 ids 的 sql 查询的结果。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-11-22T17:39:40.480

如果您需要确切的`m`行，实际上您将在 SQL 之外生成 ID 子集。大多数方法有时需要选择“第 n 个”条目，而 SQL 表实际上根本不是数组。假设键是连续的以便仅连接 1 和计数之间的随机整数也很难满足 - 例如 MySQL 本身不支持它，并且锁定条件......[棘手](https://dev.mysql.com/doc/refman/5.7/en/innodb-auto-increment-handling.html)。

这是一个`O(max(n, m lg n))`-time, `O(n)`-space 解决方案，假设只是普通的 BTREE 键：

1.  以你喜欢的脚本语言以任意顺序将数据表的键列的所有值提取到数组中`O(n)`
2.  执行[Fisher-Yates shuffle](https://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle#The_modern_algorithm)，交换后停止`m`，并提取子`[0:m-1]`数组`ϴ(m)`
3.  将子数组与原始数据集（例如`SELECT ... WHERE id IN (<subarray>)`） “加入”`O(m lg n)`

任何在 SQL 之外生成随机子集的方法都必须至少具有这种复杂性。连接不能比`O(m lg n)`BTREE 快（因此`O(m)`声明对于大多数引擎来说都是幻想），并且 shuffle 限制在下面`n`并且`m lg n`不会影响渐近行为。

在 Pythonic 伪代码中：

```
ids = sql.query('SELECT id FROM t')
for i in range(m):
  r = int(random() * (len(ids) - i))
  ids[i], ids[i + r] = ids[i + r], ids[i]

results = sql.query('SELECT * FROM t WHERE id IN (%s)' % ', '.join(ids[0:m-1]) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-02-28T19:30:56.777

在 Netezza 中选择 3000 条随机记录：

```
WITH IDS AS (
     SELECT ID
     FROM MYTABLE;
)

SELECT ID FROM IDS ORDER BY mt_random() LIMIT 3000 
```

* * *

## 回答 #12

> 赞同：-4
> 
> 时间：2008-10-30T05:29:34.837

也许你可以做

```
SELECT * FROM table LIMIT 10000 OFFSET FLOOR(RAND() * 190000) 
```

# .net - 来自 UserControl 的 ASP.NET AJAX 页面方法

> ID：249304
> 
> 赞同：12
> 
> 时间：2008-10-30T04:49:32.470
> 
> 标签：.net, asp.net, user-controls

我想将 ASP.NET AJAX 页面方法功能与用户控件一起使用。有没有办法能够在 UserControl 的代码后面而不是 Page 的代码后面指定我的静态 [WebMethod]？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-31T15:32:04.133

你可能做不到。用户控件不具备页面的所有功能，不能直接调用。相反，您应该创建一个 Web 服务 (asmx) 来处理这种情况。如果您愿意，可以将 Web 服务调用路由到用户控件内的静态方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-01-19T14:48:09.853

我一直在寻找一些解决方案来将静态 WebMethods 放置在控件中。为了代替找到解决方案，我不得不自己解决；如果您对能够更自然地执行此操作感兴趣，请随时[查看此处](http://xeno.extendev.org/2010/01/control-methods-for-aspnet-ajax.html)（或直接跳到[源代码](http://controlmethods.codeplex.com/)）。由于解决方案是新鲜的，因此文档很少，但目前我是唯一对此感兴趣的人，所以我没有理由全力以赴。如果你有机会并且有兴趣，请告诉我你的想法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-14T17:56:30.633

TheXenocide 给出的响应似乎有效，但开发人员表示，“ASP.NET AJAX 的控制方法按“原样”提供，没有任何明示或暗示的保证或保证，包括对特定用途适用性、适销性和不侵权。”

如果您正在寻找长期解决方案，我会考虑使用 web 服务方法。要么，要么不使用用户控件。您可以使用 iframe 将一个 aspx 页面嵌套在另一个页面中。

# php - PHP 运算符 <>

> ID：249312
> 
> 赞同：27
> 
> 时间：2008-10-30T04:56:19.540
> 
> 标签：php, comparison, operators

下面的代码有什么作用？PHP 手册中的内容的链接也很好。

```
if ($_SERVER['SERVER_PORT'] <> 443) {
    doSomething();
} 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-10-30T04:59:14.183

等同于 !=, "不等于"

```
false <> true // operator will evaluate expression as true
false != true // operator will evaluate expression as true 
```

这是一些参考：[PHP比较运算符](http://www.php.net/operators.comparison)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-30T04:59:31.810

这是“不等于”（`!=`运算符）的另一种说法。我认为它是“小于或大于”运算符，实际上只是意味着“不等于”。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-30T04:59:16.863

它相当于`!=`：

[http://au.php.net/operators.comparison](http://au.php.net/operators.comparison)

​​​​​​​</p>

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T05:03:15.623

`$_SERVER['SERVER_PORT']`获取 Web 服务器用于服务 HTTP 请求的端口。`$_SERVER['SERVER_PORT'] <> 443`检查端口是否不等于 443（默认 HTTPS 端口），如果不等于，则调用`doSomething()`

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T05:23:02.963

请注意，它的`<>`行为与`!=`where`<`和`>`不是明显的比较运算符（例如`$str1 <> $str2`）一样。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-30T06:01:28.597

尽管 PHP 主要基于 C 风格的语法，但这是来自 BASIC 风格的语法世界的奇怪事物之一。

不用说，我只是使用`!=`它并与之保持一致，因为`<>`它实际上从未使用过。

# vb.net - 您如何看待 VB 10 中的多行 lambda

> ID：249314
> 
> 赞同：11
> 
> 时间：2008-10-30T04:57:38.427
> 
> 标签：vb.net, lambda

我刚刚在 MSDN Channel 9 上观看了一个视频，可以在[这里](http://channel9.msdn.com/posts/Dan/Lucian-Wischik-and-Lisa-Feigenbaum-Whats-new-in-Visual-Basic-10/)找到，关于 Visual Basic 10 中的一些新功能。现在我喜欢大多数新功能，其中一些期待已久（自动属性和集合初始化器） ，引起我注意的是 C# 中的多行 lambda。

在视频中，他使用了一个这样的例子：

```
Dim scores = {10,20,30,40,50}
Dim thread as new Threading.Thread(Sub()
                                   For Each o in scores
                                     console.writeline(o)
                                     Next
                                   End Sub) 
```

现在我喜欢 VB 的冗长，但我只是有点担心编写 sub...end sub inline 可能会有点混乱，当你只需要使用某些东西时，我可以看到在编写 C# 时内联的一些优点像 c => {....} 你可以删掉很多代码。

您在 VB 中对多行 lambda 的了解是什么？

你会发现它们有用吗？在哪里？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-30T07:48:39.473

就个人而言，我认为 VB 的委托和 lambda 语法完全是假的。我的意思是，来吧，`AddressOf`！这在 VB6 中很好。在像 VB.NET 这样的语言中，函数*应该*被视为一等公民（尽管它们确实*不是*，当然）并且从方法组到委托的转换或多或少是透明的，这绝对是不好的。

 *现在引入内联函数非常冗长。我实际上相信 C# 方法`x => f(x)`在 VB 中会表现得很好，因为它准确地显示了它的作用。在目前的状态下，我更喜欢 C# 来进行任何函数式编程工作，这很遗憾，因为我通常更喜欢 VB。

现在，我真的很高兴 VB 终于获得了多行 lambda 和语句 lambda，因为它们有时仍然有用（以 为例`Parallel.For`）。但是语法很混乱。顺便说一句，迭代器也是如此（如果它们应该进入 VB10）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-04T16:51:03.850

根据偏好，我是一名 C# 开发人员，但现在几乎只使用 VB 9 大约一年了。VB 9 让我心碎的第一件事是有限的 lambda。VB 9 中的 Lambda 在以下方面受到限制：

*   只有一种说法。
*   它们必须返回一个值。

所以集合上的 ForEach 方法不适用于 lambda，只有最简单的操作才能工作。所以大多数时候你必须将你的逻辑转移到其他方法并使用 AddressOf。很多时候，这以戏剧性和令人心碎的方式破坏了代码的可读性。

我觉得很多人不会接受，除非他们在完全支持它们的另一种语言（C#、JavaScript 等）中流利地使用匿名方法，而不是他们在 VB 9 中的残缺支持。

他们在 VB 10 中修复了 lambda，我感到非常欣慰。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T06:54:28.380

我可以想到两个我喜欢它的原因！等这个太久了。

**第一的：**

```
 Private Sub SomeMethod()
     Dim SomeVariable as String = "Some text."

     AddHandler SomeButton.Click, Sub()
                                      SomeVariable += " Some more text"
                                      MessageBox.Show(SomeVariable)
                                  End Sub 
```

**第二：**

```
 Private Sub SomeMethodRunningInAnotherThread()
     Me.Dispatcher.Invoke(Normal, Sub()
                                      'Do some other stuff '
                                      SomeTextBox.Text = "Test"
                                  End Sub)
 End Sub 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-10-23T17:53:30.387

同样在这里，我喜欢vb。大多数时候你是在思考而不是真正写代码，所以在我看来冗长的论点是失败的，因为你通常盯着代码或编辑它，想象一下当你阅读它的代码时，你节省了理解代码的时间vb中的冗长？与 c# 相比，更容易，更少的错误和错误。

此外，c# 仍然没有 with 子句，而 vb 甚至在 .net 时代之前就有了。

```
With obj.class.methods

   .property = 1

   .attribute = 2

End with 
```

想象一下这需要设置 10 个东西？在 c# 中，您必须创建对 obj.class.methods 的引用并将其用于速记表达，这是浪费内存且效率低下，因此在这方面 vb 确实使用较少的内存，并且与使用较少的内存不同，您不会因使用较少的内存而受到惩罚C＃ 。

并且“using”关键字参数失败，因为 using 不适用于大多数对象或未实现 idisposable 的对象，这绝对令人讨厌。

然后，想想你必须在 c# 中而不是 vb 中进行的所有显式转换。C#errs 会争辩说这是鼓励更好的编码，但这是无稽之谈，因为任何优秀的开发人员都不需要每天显式转换 500 次来理解如果他不这样做，就会发生隐式转换（就像它在vb)。

大多数 c#errs 都使用它，因为他们来自 ac 背景，这很好，但我发现很多人都是从它开始的，因为它包含字母 c，他们认为它更酷，因为它缺乏 vb 所具有的语言创新，使其成为对开发人员来说更难，这让他们感觉更聪明、更酷，而且比其他人都高 - 哈哈，他们不明白以 0 成本隐藏复杂性是最终目标，这就是 vb 可以为你做的。请注意零成本部分，因为如果它的成本高于零，那将不是一件好事。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T05:05:44.917

VB 中完整的匿名方法支持意味着您可以开始对事物采取更具功能性的风格。如果 Sub() End Sub 需要在不同的行上运行……那很痛苦。我希望他们允许单行匿名方法，只要只有一个声明。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T06:14:02.127

一旦我们获得 ParallelFX 库，您将需要多线。

例如，假设您想让这个循环并行：

```
For i = 0 to 100
  '12 lines of code'
Next 
```

并行版本将是：

```
Parallel.For( 0, 100, sub(i)
  '12 lines of code'
  End Sub ) 
```

它通过将循环的胆量变成一个全新的子来工作。新的 sub 由 N 个线程调用，N 通常是可用内核的数量。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-14T20:21:23.227

没有简单的方法来管理这个：

[将 C# 语句体 lambda 转换为 VB](https://stackoverflow.com/questions/1568526/convert-c-statement-body-lambda-to-vb)

没有多行 lambda。

*叹*

所以，是的，我急于完全释放它。

-亚当

# security - 破解网络时间协议（NTP）相对容易吗？

> ID：249318
> 
> 赞同：3
> 
> 时间：2008-10-30T05:00:05.350
> 
> 标签：security, ntp

我在某处读到 NTP 基于 UDP，并且没有使用 NTP 通信构建的安全性，因此很容易欺骗 NTP 响应。这是真的吗？这不是一个主要的安全问题，因为那里的大多数服务器都依赖 NTP 来同步它们的时钟吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T05:06:54.277

这是一篇[有趣的文章](http://securityvulns.com/advisories/timesync.asp)，讨论了一些安全问题，它可能有点过时，但值得一读。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-07-20T07:52:12.777

是的，这相对容易，并且目前有多种攻击可用。最重要的是，大型企业通过 GPS 同步 NTP 时间，通常位于安全设施内。这最大限度地降低了远程攻击的有效性。因此，漏洞利用和“黑客攻击”对拥有 100 个或更少系统的组织造成更大的损害，因为这些组织中的大多数没有本地时间，并且经常依赖远程服务器。

# c# - 通过 3rd 方应用程序修改 NotifyIcon 的行为

> ID：249319
> 
> 赞同：0
> 
> 时间：2008-10-30T05:01:01.447
> 
> 标签：c#, winapi, notifyicon

我一直很好奇是否可以显示、隐藏或更改另一个应用程序通过 C# 应用程序创建的 NotifyIcon。

有人可以发布一个关于如何做到这一点的例子吗？:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T06:07:37.803

要修改系统托盘中的图标，您可以使用[Shell_NotifyIcon](http://msdn.microsoft.com/en-us/library/bb762159.aspx) Win32 API（[P/Invoke 声明](http://pinvoke.net/default.aspx/shell32/Shell_NotifyIcon.html)）。这些图标与一个窗口句柄和一个 ID 相关联。这意味着要修改或隐藏另一个程序的图标，您需要知道该应用程序用于注册它的窗口和 id。例如，您可以通过枚举该进程的所有窗口并使用每个句柄和 0 到 500 万之间的每个数字进行调用来强制它，但是您成功的机会非常渺茫。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-17T01:51:43.193

您可以挂钩 SystemTray 窗口本身以拦截所有 Shell_NotifyIcon() 请求。然后您将知道为每个图标注册的确切 HWND 和 ID。可以通过任何搜索引擎找到详细信息。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2008-10-30T05:04:38.553

我什么都不知道，除非其他应用程序公开了一些公共方法，或者您尝试使用反射，但我什至不确定您是否可以在正在运行的进程中做到这一点。

# content-management-system - 熟悉 SilverStripe 吗？你的意见/印象是什么？

> ID：249328
> 
> 赞同：13
> 
> 时间：2008-10-30T05:07:03.120
> 
> 标签：content-management-system, silverstripe

我正在尝试选择一个不是门户的好 CMS。我所有的研究都让我相信 SilverStipe 是最好的选择。我想要一些意见/印象。

感谢您的任何想法。

编辑：我决定试一试。在我有一段时间后，我会发布我自己的答案。由于缺乏回应，似乎没有庞大的用户群。（至少谁与 Stack Overflow 社区有交集。）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-03T20:11:14.583

大约一周前（现在是 2008 年 11 月 3 日）我刚刚偶然发现了 Silverstripe / Sapphire，我很惊讶。这似乎是一个被低估的软件。我不是一个可以肯定地说的专业人士，但我相信他们的代码非常可靠、干净和智能。他们刚刚获得了最有前途的开源 CMS 并获奖，这可能是朝着同一方向的暗示。

*   如果将 CMS 与 Joomla 或 Drupal 进行比较，CMS 仍然缺少大量插件和模块，但它们的**代码似乎更高级**。
*   整个 CMS 使用**活动记录模式**方法和**干净的 MVC**设计。如果您创建一个新的页面类型，您可以在页面类中添加新的数据库字段，刷新通过 url 构建的数据库，然后 cms 插入新的表和字段。
*   **例如，与 Joomla 相比，构建模板更容易**，这要归功于 MVC 以及使用称为布局的模板和子模板的两级方法。例如，如果您有一个名为“BlogPage”的页面类型，则“BlogPage”类首先查找“BlogPage”模板，如果没有找到它，它会查找“BlogPage”布局并将其插入到模板中的给定位置.

这只是我在玩了几天之后的第一印象。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-08-12T12:46:07.557

我们公司去年从定制 cms 切换到 SilverStripe (SS)。由于所有建筑物，Active Record 使迁移花费的时间比预期的要长得多。这也使数据共享变得更加困难。因此，如果您有很多像我们这样共享数据的网站，请务必小心。

除此之外...实际上在 SilverStripe 中开发站点/CMS 是一个 OO 梦想成真。无需再编写一些应用程序功能，然后编写一些管理员代码，然后修复它们并进行一项工作而不是另一项工作。我衷心推荐 SS 给正在寻找成熟的活动记录/php 解决方案的开发人员，该解决方案背后确实有一些想法。管理员真的很酷。

奖励：大多数时候我都在尝试做某事，我就像 WTF...我只是搜索或浏览代码，并且已经有一个功能可以完全按照我的意愿去做。

支持：这里没有问题。有一个论坛可以在提出智能问题但尚未回答时得到回答。这只能随着更多人的加入以及 Ingo 的 SS 书被翻译成英文而及时改善。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-11-10T15:16:24.193

到目前为止，我发现它非常有趣。它确实有一些问题，但总的来说它非常灵活。基础知识很容易在几个小时内搞定，但更高级的东西需要几天时间才能真正掌握。但是我是 MVC 的新手，所以我大部分的学习曲线都花在了那里。

绝对值得一看。我建议任何尝试做高级事情的人都非常熟悉 PHP 和 MVC 设计，或者计划熟悉。

网站上有大量的帮助资源：http: [//silverstripe.com/community-overview/](http://silverstripe.com/community-overview/)

我已经使用了教程，但在论坛中可以找到有关更高级内容的最佳帮助。

我仍然有兴趣听听其他人的想法，继续发帖。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-17T05:12:00.510

我使用了其他几个框架，codeigniter、cake、drupal、joomla、一些 CMS，其他没有，而且 Silverstripe 现在有点，它的性能似乎比这些其他框架慢一点。但它确实有一些很酷的部分和功能，可以真正加快实施速度。因此，如果您的网站不是那么大，并且您不关心真正的高性能，这可能是一个不错的选择。但如果性能（速度、大容量等）是要求，我可能会考虑其他的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-06-23T07:13:45.160

在查看了[在线文档](http://doc.silverstripe.org)、[论坛](http://silverstripe.org/forums/)、[API 参考](http://api.silverstripe.org)等之后，我买[了这本书](http://eu.wiley.com/WileyCDA/WileyTitle/productCd-0470681837.html)。我做过的最好的事情 - 我会向任何希望对 SilverStripe 稍微认真一点的人推荐这个行动方案。

话虽如此，该项目还很年轻，在线文档正在重组中。给定时间，我认为它只能改进。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-31T16:25:41.047

我不是，但也许会检查一下。我会对可能感兴趣的 WordPress[提出疑问。](https://stackoverflow.com/questions/250880/is-there-any-cms-better-than-wordpress-or-should-i-write-my-own)作为副作用，我还将查看建议的 python 框架 django。SO中还引用了其他php cms。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-17T11:10:36.633

现在还有一本关于 Silverstripe 的书——至少有德文版，英文版宣布将于 8 月底发行

# python - 在 Python 中将 SVN 路径转换为本地文件系统路径

> ID：249330
> 
> 赞同：0
> 
> 时间：2008-10-30T05:07:18.457
> 
> 标签：python, svn

我正在用 Python 编写一个实用程序，它将 Subversion 中更改的文件附加到电子邮件中，并在 SVN 中的源代码控制下的文件夹子集发生更改时发送它。我正在使用 pysvn 库来访问存储库。

我在本地文件系统上有一份文件副本，我进行了更新以检查自上次运行该实用程序以来文件是否已更改。

我正在将 SVN 中的路径名转换为本地副本上的路径名。

目前我已经写了以下内容来完成这项工作：

```
def formatPaths(self, paths):
    newPaths = list()
    for path in paths:
        path = path[len(self.basePath):]
        path = path.replace("/", "\\")
        newPaths.append(path)
    return newPaths 
```

self.basePath 类似于“/trunk/project1”，我希望只获取文件夹子集的相对路径（即“/trunk/project1”下的文件夹1）。

这是解决这个问题的好方法还是我错过了一些神奇的功能？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T09:23:15.537

继续使用切片运算符，但不要更改循环内的循环变量。为了好玩，请尝试生成器表达式（或保留 listcomp）。

```
baselen = len(self.basePath)
return (path[baselen:].replace("/", "\\") for path in paths) 
```

编辑：`lstrip()' 在这里不相关。从[手册](http://docs.python.org/library/stdtypes.html#string-methods)：

> str.lstrip([字符])
> 
> 返回删除了前导字符的字符串的副本。如果省略 chars 或 None，则删除空白字符。如果给定而不是 None，chars 必须是字符串；字符串中的字符将从调用此方法的字符串的开头剥离。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T06:53:28.867

嗯...这样就可以了：

```
baselen = len(self.basePath)
for path in paths:
    path = path[baselen:].replace("/", "\\")
    newPaths.append(path)
return newPaths 
```

如果你愿意，你可以这样做：

```
baselen = len(self.basePath)
return (path[baselen:].replace("/", "\\") for path in paths) 
```

不在`baselen`每次循环迭代中计算也是一种好习惯。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T10:10:53.583

Your specific solution to the path name copy is reasonable, but your general solution to the entire problem could be improved.

I would `easy_install anyvc`, a library developed for the [PIDA IDE](http://pida.co.uk/) which is a uniform python interface into version control systems, and use it instead:

```
from anyvc import Subversion
vc = Subversion('/trunk')

modified = [f.relpath for f in vc.list() if f.state != 'clean']

for f in modified:
    print f.relpath # the relative path of the file to the source root 
```

Additionally, I would probably attach a diff to an email rather than the actual file. But I guess that's your choice.

# vista64 - 从 Vista x64 连接到 Linux 的远程桌面客户端

> ID：249332
> 
> 赞同：0
> 
> 时间：2008-10-30T05:11:13.487
> 
> 标签：vista64, opensuse

我正在考虑从我的 Vista 64 位开发工作站连接到 openSuse 11.1 Beta 3 虚拟机。我发现 UltraVNC 查看器是实现此目的的唯一选择。是否有任何其他客户端可用于从 Vista 连接到 openSuse/其他 Linux 安装？

注意：带宽不用担心，连接将使用千兆网络。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T05:22:36.630

我不了解 Vista，但我已经成功地在 Windows XP 上使用[X-Ming](http://sourceforge.net/projects/xming)与 Debian 机器对话。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T06:36:31.460

我会加倍 Adam 的建议来使用 XMing。您还可以在 SSH 中启用 X11-Forwarding 并使用 PuTTy 来打开在 SUSE 机器上运行的不同 X 应用程序（如果我没记错的话，这需要某种 X 服务器在 Windows 机器上运行，为此，我一直在使用[Xming](http://www.straightrunning.com/XmingNotes/)。

除此之外，我之前使用过[tightVNC](http://www.tightvnc.com/)将Linux 机器上的X 显示导出到Windows。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T07:02:56.413

我成功地使用了 VNC（带有 UltraVNC）和 XMing 在 Linux 机器上从 Windows 访问 GUI 会话。您可以[在我的博客上找到有关设置 Xming 的详细教程](http://hype-free.blogspot.com/2007/08/setting-up-xming-or-rdp-equivalent-for.html)。如果您出于某种原因需要使用 RDP 协议，也可以尝试[xrdp 。](http://xrdp.sourceforge.net/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T10:13:25.690

我一直很高兴在 Windows 上使用[NoMachine](http://www.nomachine.com) NxClient，在 suse linux 机器上连接到 nxServer。延迟很小，感觉非常快。会话只能暂停，这增加了速度感。

# javascript - 在添加内容时使可滚动元素保持在“底部”

> ID：249346
> 
> 赞同：2
> 
> 时间：2008-10-30T05:23:03.620
> 
> 标签：javascript, html, scroll, prototypejs, scrollbar

我正在为我正在开发的 Web 应用程序构建一个实用程序页面。我有一个元素想用作各种“控制台”。

我通过 Ajax 调用（使用原型）获得控制台条目`Ajax.PeriodicalUpdater`。

我遇到的问题是，当我在“控制台”底部插入新行时，滚动条保持在初始位置（所以我总是看到顶行，除非我手动向下滚动）。

如何让滚动条自动停留在底部？

我在这个项目中为一些需要它的库使用原型，所以如果可能的话，我宁愿坚持使用那个或常规的 javascript。

就像一个注释，我已经尝试过这个：

```
onComplete: function() { 
    $('console').scrollTop = $('console').scrollHeight;
} 
```

它*几乎*可以工作，只是它总是“落后一步”，而且我看不到最近的项目。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T05:27:15.873

```
new Ajax.PeriodicalUpdater(container, url, {
    onComplete: function() {
        (function() {
            container.scrollTop = container.scrollHeight;
        }).defer();
    }
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T05:56:47.717

嘿，我正在构建几乎完全相同的东西（一个 Ajax 控制台），并且我的溢出 div 没有一直到底部有问题。

Stack Overflow 帮我解决了！希望对你也有帮助！

[使用 JavaScript 滚动溢出的 DIV](https://stackoverflow.com/questions/13362/scrolling-overflowed-divs-with-javascript)

编辑：我的问题使用了 jQuery，但问题不在于 JS 框架，而在于您正在使用的 CSS 属性。基本上你需要 get Math.max(div.scrollHeight, div.clientHeight) 因为有些浏览器的这些属性有点问题。

# java - 如何在开源 Java 中禁用数组边界检查？

> ID：249347
> 
> 赞同：2
> 
> 时间：2008-10-30T05:24:27.750
> 
> 标签：java, arrays, open-source

既然 Java 是开源的，我想做的第一件事就是禁用数组边界检查某些代码块，我很确定我不能越界并且性能很重要。

现在，我不是编译器/语法专家，所以任何语法对我来说都足够好：这是我能想到的：

```
pragma_disable_array_bounds_checking_begin
  for(x = xMin; x < xMax; x += xIncr) {
    for(y = yMin; y < yMax; y += yIncr) {
      for(z = zMin; z < zMax; x += zIncr) {
        sample_and_draw(voxel[x][y][z]);
      }
    }
  }
pragma_disable_array_bounds_checking_end 
```

我了解在此更改后，我的本地版本将不再是 Java。但我不太在意，因为我总是可以将重新编译的 VM 与我的应用程序捆绑在一起。

我不知道如何进行这种不平凡的改变，因此提出了这个问题。请注意，我对 JNI 方法不感兴趣。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T05:37:21.063

如果您能判断出数组索引不能超出范围，也许编译器也可以，它们最近在静态数据流和逃逸分析方面令人印象深刻。我会先检查是否正在执行边界检查。javap 可以在这里为您提供帮助。

当然，我假设您遵循 Knuth 的建议，不要过早优化，并且您已经测量了您的应用程序并确定这种差异值得花时间研究。如果是这样，请发布您的结果摘要，因为这对我来说非常有趣。即使我的应用程序不会从这种调整中受益。

# coding-style - 使用 Scheme 代码求解二次方程？

> ID：249348
> 
> 赞同：3
> 
> 时间：2008-10-30T05:24:29.530
> 
> 标签：coding-style, scheme

我编写了这个方案代码来计算二次方程 a *x2 + b* x + c = 0的一个解

```
(define (solve-quadratic-equation a b c) (define disc (sqrt (- (* b b) (* 4.0 a c)))) (/ (+ (- b) disc) (* 2.0 a))) 
```

但是，有人告诉我，这个程序很难理解。为什么？

这个过程的清理版本会是什么样子？请让我知道为什么新程序更容易理解。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T05:30:24.977

嗯，一个原因是它都在一条线上。**你可以使用一种叫做pretty-printing 的**东西使它更具可读性，你可以把它分成多行并使用空格：

```
(define (solve-quadratic-equation a b c)
  (define disc (sqrt (- (* b b)
                        (* 4.0 a c))))
  (/ (+ (- b) disc)
     (* 2.0 a))) 
```

这样你可以更清楚地看到表达式的结构。

这是[SICP](http://mitpress.mit.edu/sicp/full-text/book/book.html)的引述：

> 这种嵌套的深度和 Lisp 解释器可以评估的表达式的整体复杂性没有限制（原则上）。是我们人类对仍然相对简单的表达感到困惑，例如
> 
> ```
> (+ (* 3 (+ (* 2 4) (+ 3 5))) (+ (- 10 7) 6))
> ```
> 
> 解释器很容易将其计算为 57。我们可以通过在表格中编写这样的表达式来帮助自己
> 
> ```
> (+ (* 3
>       (+ (* 2 4)
>          (+ 3 5)))
>    (+ (- 10 7)
>       6))
> ```
> 
> 遵循称为*pretty-printing*的格式约定，其中写入每个长组合，以便操作数垂直对齐。生成的缩进清楚地显示了表达式的结构。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T05:32:25.440

计划不就是开发一种语言来解决问题吗？我承认我不太了解方案，但我会添加一些缩进并添加一个类似这样的正方形定义。

```
 (define (solve-quadratic-equation a b c)
     (define square (x) (* x x) 
     (define disc (sqrt (- (square b) (* 4.0 a c)))) 
                        (/ (+ (- b) disc) (* 2.0 a)))) 
```

# c - 工会声明 C 代码

> ID：249350
> 
> 赞同：0
> 
> 时间：2008-10-30T05:28:48.100
> 
> 标签：c, unions

我在结构中看到了一些联合声明，如下所示。下面给出的示例代码。

我的问题是它是否有助于节省内存（联合用于的典型用途）？我没有看到好处。

```
typedef struct
{
    int x1;
    unsigned int x2;
    ourstruct1 ov1;
    ourstruct1 ov2;
    union
    {
            struct
            {
                mystruct1 v1;
                mystruct2 v2;
                mystruct3 v3;
                int* ctxSC;
                mystruct4 v4;
                Bool v5;
                Long v6;
                Long v7;
                Long v8;
                Long v9;
            }mystr;
    };
}structvar1; 
```

-广告

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T05:33:49.837

这根本不是联合的典型用途。联合是变体类型 - 您可以将许多不同类型的类型放入其中并检索它们。**仅将一种类型放入联合中不会给您带来任何好处**，除了看起来很奇怪的代码。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T18:01:54.400

To add to what [Philippe](https://stackoverflow.com/questions/249350/unions-declaration-c-code#250453) wrote: Microsoft uses this in DirectX to define its `D3DMATRIX` (and the derived structure `D3DXMATRIX) as follows:

```
typedef struct _D3DMATRIX {
    union {
        struct {
            float        _11, _12, _13, _14;
            float        _21, _22, _23, _24;
            float        _31, _32, _33, _34;
            float        _41, _42, _43, _44;

        };
        float m[4][4];
    };
} D3DMATRIX;
```

This allows you to address the matrix elements either by name or by index: both `myMat._12` and `myMat.m[0][1]` refer to the second element in the first row of the matrix `myMat`. It's really just syntactic sugar, since even the most braindead compiler will optimize accesses such as `myMat.m[0][1]` into a constant offset calculation.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T05:32:48.560

唔。好吧，上面的例子对我来说似乎有点奇怪——联合的通常原因是有两个不同的符号路径进入同一个存储（按字节、按字等）。但是，您给出的示例只有一个工会成员。

我唯一能想到的是代码是着眼于未来的扩展——即联盟将在后续版本中拥有更多成员。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-31T05:10:22.350

不，你不能获得好处 unoin 应该包含一些其他成员，但不仅仅是结构。它没有任何问题，但你无法获得内存优化。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T05:35:40.893

在我看来，工会实际上并没有在这里使用。我也从未见过这样的联合内部有一个单独的结构。奇怪的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T14:56:30.200

此代码有效吗？不是因为联合只有一个字段（尽管这看起来很奇怪），而是因为联合是匿名的；你如何告诉编译器你想在内部 struct mystr 中寻址？

```
 structvar1 var1;
 var1.mystr.ctxSC = NULL;  // compile error : structvar1 has no mystr member 
```

并且 GCC 3.4.4 将此报告为无效的 ISO C。

编辑：[Steve Fallows](https://stackoverflow.com/users/18882/steve-fallows)在评论中给了我答案：这是一个专有的 Microsoft 扩展，允许无缝结构聚合：“包含”结构的所有字段都被视为包含结构的一部分。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T06:06:52.843

很难说用于使代码匿名的变量和类型的混淆名称，但是编写它的人是否可能错误地期望 mystr 结构内的字段是联合的？

# css - 在编写我的第一个样式表时，我应该遵循任何 CSS 标准吗？

> ID：249357
> 
> 赞同：15
> 
> 时间：2008-10-30T05:34:42.283
> 
> 标签：css

我目前正在开发我的第一个网站。我不知道从 CSS 页面从哪里开始，或者是否有任何我应该遵循的标准。

我将不胜感激任何链接或第一手建议。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-30T05:59:43.483

初学者经常犯的一个错误：

CSS 也是语义的。尝试表达概念，而不是格式。人为的例子：

### 错误的：

```
div.red
{
    color: red;
} 
```

相对于：

### 好的：

```
div.error
{
    color: red;
} 
```

CSS 应该是您在网站上使用的概念的格式伴侣，因此它们应该反映在其中。这样你会更加灵活。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-30T06:24:39.250

除了其他答案中指出的大量资源之外，这里还有一些技巧来构建您在 CSS 上的工作方式：

请按以下顺序进行工作...

1.  在 HTML 中布置页面的语义结构。确保它在没有任何 CSS 的情况下是正确的。
    *   在 CSS 中创建页面的基本布局 - 列、标题、浮动框。
    *   添加排版 - 字​​体、大小和颜色。
    *   添加图形元素 - 背景图片、徽标等

在您的页面上放置一个指向[W3C CSS 验证器](http://jigsaw.w3.org/css-validator/check/referer)的链接（如果您的网站在 Internet 上可见），并经常点击它。

将所有样式保留在 HTML 之外。

有 IE6/7/8、FF2/3 和 Chrome/Safari 就很好。Opera 也不错。在工作时不断更改您打开页面的浏览器（除非您正在研究特定的浏览器问题:-)）。

添加评论每条规则的作用和原因。保持 CSS 的开发版本签入，完成后，删除注释和空格，并将多个规则压缩为一个以用于生产。

**更新**：正如 Bobby Jack 提到的，我没有提到调试工具。您可以使用[IE Developer Toolbar](http://www.microsoft.com/downloads/details.aspx?FamilyId=E59C3964-672D-4511-BB3E-2D5E1DB91038&displaylang=en)（用于 IE）或[Firebug](http://getfirebug.com/)（用于 FF）或 Chrome 中的集成检查工具来检查哪些规则应用于特定元素，或动态修改元素的样式。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-30T20:47:25.873

抵制过度指定类或 id 名称的冲动。使用上下文或后代选择器。这让您可以轻松地为页面区域定义样式，但省去了必须管理和记住大量名称的理智。例如：

```
<ul id="nav">
   <li class="navItem"><span class="itemText">Nav Item</span></li>
   <li class="navItem"><span class="itemText">Nav Item</span></li>
</ul>

#nav { }
#nav .navItem { }
#nav .itemText { } 
```

这是不必要的复杂，你会发现自己很快就用完了好的语义描述。你最好用类似的东西：

```
<ul id="nav">
  <li><span>Nav Item</span></li>
  <li><span>Nav Item</span></li>
</ul>

#nav {}
#nav li {}
#nav li span {} 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-10-30T19:05:51.837

**通过了解特异性**，您可以省去很多麻烦。当你为某事设置规则时，如果有冲突的规则，**具体性决定了哪条规则获胜**。

一个快速（不完整）的纲要：

元素范围的规则 (like `p {color:green;}`) 将被以下内容取代：
特定于类的规则 (like `p.sidenote {color: blue;}`) 将被以下内容取代：
特定于 id 的规则 (like `p#final {color: red;}`) 将被以下内容取代：
内联声明 (like `<p style="color: orange;">`)，这将被以下因素击败：
一条重要的规则（如`p#final {color: inherit !important;}`）

...所有这些都可以被用户的规则打败。

相互作用可能很复杂，但它们背后有数学规则。有关更完整的处理方法，请参阅 Eric Meyer 的“CSS：权威指南”的第 3 章。

回顾一下：**如果你设置了一个规则并且它似乎没有影响任何东西，那么你可能有一个冲突的规则。**要了解为什么一条规则胜过另一条规则，请了解特异性。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-10-30T06:28:31.490

我的第一个提示是始终只使用外部样式表——尽量避免内联或标题样式。

尽可能使用类和 ID。

我支持[A List Apart的建议](http://www.alistapart.com/)

虽然不是很漂亮，而且有时有点旧，但[WDG 的 HTML Help](http://htmlhelp.com/reference/css/style-html.html)有一些很好的参考。

[Quirksmode.org](http://www.quirksmode.org/css/contents.html)有一个很棒的 CSS 兼容性表。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-30T07:45:31.007

您已经获得了关于您的问题的一组很好的答案，您可能会觉得这很有用。

使用带有 Firebug 扩展的 Firefox。如果您没有 Firefox，我建议您安装它，即使它只是为了这个。Firebug 允许您从页面中选择元素并显示您应用的 css。然后，您可以使用 fire bug 编辑此 css，而无需重新加载任何页面。一旦您对样式感到满意，您就可以轻松地将定义从 firbug 复制到您的 css 编辑器。

至少对我来说，在使用样式时，萤火虫是绝对必要的。

CSS 本身的几个技巧。定义样式时，仅当所讨论的元素是唯一的时才使用 id。这样你的样式就可以重复使用了。使用分层定义，例如。 `#header .navigationElement a{color:red;}`这样`#footer .navigationElement a{color:black;}`您就可以移动您的 html 代码并自动应用正确的样式。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-30T20:08:02.257

好吧，如果这是您的第一个网站并且您正在尝试走 CSS 路线，那么您应该阅读 CSS 布局和 CSS 框模型。了解如何使用块元素进行布局并远离表格进行布局。

我建议的另一件事是，您将 FireFox 用于所有主要开发，并使您的网站正常工作，并在 FF 中查看您希望它的样子。*然后*启动 IE 并修复古怪 IE 的任何问题。如果你这样做，你最终会得到一个更干净的网站和更干净的 CSS。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-10-30T05:36:29.800

不完全是初学者材料，但[A List Apart](http://www.alistapart.com/)是一个关于 CSS 及其复杂性的非常有趣的博客。

我发现 W3 School 的[CSS 页面](http://www.w3schools.com/css/)非常适合参考。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-30T05:38:39.547

这是一个不错的概述：

[http://www.onlinetools.org/articles/cssguides.html](http://www.onlinetools.org/articles/cssguides.html)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-30T18:49:43.523

看看 [CSS Systems 以编写可维护的 CSS ，作者是](http://natbat.net/2008/Sep/28/css-systems/)[ClearLeft](http://clearleft.com/)的 Natalie Downe 。她的演讲中有很多很棒的概念（我建议下载 PDF，因为她的笔记非常详细）。

我认为她的演讲是针对全职 CSS 开发人员而不是初学者，但即使是初学者也可以从中学到很多东西。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-10-30T19:26:55.147

我只需要提到[css Zen Garden](http://www.csszengarden.com/)作为灵感来源。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-10-30T19:28:33.273

如果这是你的第一次，祝你好运！

我不确定作为初学者是否需要大量或详尽的资源。慢慢来，尽你所能保持代码的*可读性*。间距，间距，间距。

使用外部样式表（上面有人说过）和现在听起来的想法一样好，不要继续为网站的不同部分添加新的样式表。这将使您的生活变得更加轻松。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-11-03T00:48:24.573

很多人有一些很好的建议。我想支持codeinthewhole所说的话。

我强烈建议使用[reset.css](http://massiveatom.com/factoider/css/reset.css)样式表：

```
*{margin:0;padding:0}iframe,a img,fieldset,form,table{border:0}h6,h5,h4,h3,h2,h1,caption,th,td{font-size:100%;font-weight:normal}dd,dt,li,dl,ol,ul{list-style:none}legend{color:#000}button,select,textarea,input{font:100% serif}table{border-collapse:collapse}caption,th,td{text-align:left}p, h1{margin:0;padding:0;bording:0} 
```

复制并粘贴或仅保存我链接到的那个。

另外，我早期使用的一个错误是过度使用`<div id="">`aposed to `<div class="">`。一个 id="" 应该只使用一次（永远不会有两个`<div id="content">`），而你可以有数千个 class="" （比如`<div class="box">`）。

此外，拥有多个同名的 id 不是有效的 html

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-10-30T06:16:57.393

[westciv.com](http://www.westciv.com/style_master/academy/css_tutorial/index.html)上的Complete CSS Guide提供了关于 CSS 的详尽信息。这是一个开始潜水的好地方。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-11-01T16:18:54.413

我从 Mc Farland 的 Missing Manual（Oreilly 书）中了解了我需要了解的内容，并通过查看[示例 rails 的应用程序](http://oreilly.com/catalog/9780596527440/index.html)样式表。这很好用，无论你使用什么，谷歌搜索 PHP、ASP.net 的“示例/示例项目/应用程序/存储库”。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-11-02T23:54:33.417

如果您使用重置脚本 - 它会消除不同浏览器之间的一些怪癖。这样做让我的生活更轻松。

我见过一些人发誓只是使用

```
* { padding: 0; margin: 0; } 
```

但是你也可以使用更彻底的实现——比如 YUI 库中的那个...... [http://developer.yahoo.com/yui/reset/](http://developer.yahoo.com/yui/reset/)

在测试您的网站渲染时，browsershots.org 非常有用。

webdev firefox 插件非常棒 - CTRL+SHIFT+E 允许您编辑 css，并即时查看更改。如果您使用 CTRL+F，您还可以将鼠标悬停在一个元素上以找出它是什么。

要添加到其他人提到的网站 - 我发现[http://css-discuss.incutio.com](http://css-discuss.incutio.com)很有用。Freenode #css 也很方便。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2012-03-02T19:29:14.477

我已经建立网站 5 年了，并且通过经常阅读此内容仍然学到了很多：[http ://code.google.com/speed/page-speed/docs/rendering.html](http://code.google.com/speed/page-speed/docs/rendering.html)

还可以查看关于 CSS 的[http://www.zeldman.com](http://www.zeldman.com)博客。这家伙是网络世界的传奇人物。

# winapi - 检测自上次扫描以来文件系统中的更改

> ID：249371
> 
> 赞同：3
> 
> 时间：2008-10-30T05:45:49.517
> 
> 标签：winapi, filesystems

索引文件系统的程序似乎知道自上次索引以来哪些部分发生了变化，并且只重新扫描该部分。如何确定自上次索引以来文件系统/文件的更改位置。不在乎你用什么语言回答，但我在想 c 和 windows。

此类程序的一个示例是 Sequoia View，它会生成硬盘的树状图。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T06:05:53.783

一个相当简单的方法是获取文件系统报告的文件大小、日期（作为整数值）和给定目录中的文件名，并计算一个[校验和](http://en.wikipedia.org/wiki/Checksum)，然后您可以与该目录关联。您仍然需要使用文件系统数据对所有目录执行此计算，但您不必深入（打开文件以检查差异），除非校验和报告了差异。

为了在文件级别跟踪特定更改，您将根据单个文件属性存储校验和，当然还有自上次扫描以来是否存在文件和子目录。

这不一定保证没有发生更改，因为有文件系统实用程序可以更改各种属性，尽管这对于基本扫描来说是一个很好的第一步。

您可能会发现[fswatch](http://sourceforge.net/projects/fswatch)的[源代码](http://sourceforge.net/project/showfiles.php?group_id=156978&package_id=175371)很有帮助。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-21T03:24:21.593

您有 2 个问题需要在这里处理。

第一个是如果您想监视动态更改（在程序运行时进行）。在这种情况下，您需要使用 Windows API ReadDirectoryChangesW。网上有很多关于如何使用它的例子。（注意......有些例子不是很好。这个 API 调用可以并且每次调用都会返回一个以上的事件，您需要仔细阅读接口，了解它的工作原理，并处理返回的所有内容。

第二个问题是如果您有一个文件夹或文件夹列表，并且您想检查其/它们的内容是否已更改 - 通过添加/删除或更改该文件夹中的文件。

在这种情况下，最有效的方法是一次读取文件夹内容一个文件名，并进行累积哈希。不仅如此，您还想获取属性（使用 GetFileAttributesEx 之类的东西），并将这些属性也包含在哈希中。（确保排除文件夹“.”和“..” - 否则结果会产生误导。）

这样做的原因是您希望通过文件的大小、日期等来捕获文件中的更改。但您可能不想包含 LastAccessed 时间。

任何大的散列函数都应该这样做。结果是每个文件夹都有一个大数字（哈希）。

然后，当您再次传递时，您重新计算哈希值并与存储的哈希值进行比较，以了解该文件夹的最后一个已知状态。如果哈希值不匹配，那么您需要详细浏览该文件夹。

实际上，这种方法会（快速地）告诉您，您需要更详细地查看这里的某些内容，而您如何做到这一点取决于您要实现的目标。

这样做的好处是您不会查看文件夹中每个文件的内容，而是查看一些可以为您提供足够指示的元数据。因此，处理速度要快数千倍。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-30T06:11:00.370

如果您使用 .Net 托管语言进行编码，请尝试[FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx "FileSystemWatcher 类 (System.IO)")类。

来自 MSDN：

> 使用 FileSystemWatcher 监视指定目录中的更改。您可以监视指定目录的文件和子目录的变化。您可以创建一个组件来监视本地计算机、网络驱动器或远程计算机上的文件。
> 
> 要监视所有文件中的更改，请将 Filter 属性设置为空字符串 ("") 或使用通配符 (" *.* ")。要查看特定文件，请将 Filter 属性设置为文件名。例如，要监视文件 MyDoc.txt 中的更改，请将 Filter 属性设置为“MyDoc.txt”。您还可以监视特定类型文件的更改。例如，要监视文本文件中的更改，请将 Filter 属性设置为“*.txt”。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-30T11:09:40.300

查看[目录更改通知](http://msdn.microsoft.com/en-us/library/aa365261(VS.85).aspx)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-06T15:35:50.253

在 Linux（以及我想的任何其他类 Unix 操作系统）下，可以为文件/文件夹生成一个哈希值，以表示其在给定时间的状态。稍后，只需重新生成哈希并将其与旧值进行比较。事实证明，这对我正在从事的一些项目非常有效！

详细信息在这里：http: [//vpalos.com/169/recursive-filedirectory-change-detection/](http://vpalos.com/169/recursive-filedirectory-change-detection/)

它基本上对任何更改都很敏感（即使只更改文件的访问时间）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T06:06:55.653

FindFirstChangeNotification

# algorithm - 如何计算重复数字？

> ID：249372
> 
> 赞同：8
> 
> 时间：2008-10-30T05:47:11.370
> 
> 标签：algorithm, language-agnostic, division

给定两个整数`a`和`b`，我将如何计算 的重复小数`a / b`？这可以是任何语言；无论你用什么最容易表达它。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-30T20:17:10.913

`a / b`正如 Mark Ransom 所说，您可以使用在学校学习的长除法算法计算十进制表示。要计算每个连续的数字，请将当前被除数（分子或余数）除以`b`，然后将余数乘以 10（“降低 0”）找到下一个被除数。当一个余数与之前的某个余数相同时，这意味着从那时起的数字也会重复，所以你可以注意这个事实并停止。

请注意此处的优化潜力：除以 b 时得到的余数在 0 到 b-1 的范围内，因此由于您只保留不同的非零余数，因此您不必搜索之前的余数列表即可查看如果某事重复。所以可以使算法每除法步采用固定时间，`O(b)`空间就足够了。只需跟踪每个余数首先出现的数字位置。

（顺便说一句，这个论点也是一个数学证明，即重复部分最多可以是 b-1 位长：例如 1/7=0.(142857) 的重复部分是 6 位，并且 1/17 = 0。 (0588235294117647) 有 16 位的重复部分。实际上，长度总是*除以*b-1。）

这是执行此操作的 Python 代码，它会`O(b)`及时运行。

```
def divide(a, b):
  '''Returns the decimal representation of the fraction a / b in three parts:
  integer part, non-recurring fractional part, and recurring part.'''
  assert b > 0
  integer = a // b
  remainder = a % b
  seen = {remainder: 0}  # Holds position where each remainder was first seen.
  digits = []
  while(True):  # Loop executed at most b times (as remainders must be distinct)
    remainder *= 10
    digits.append(remainder // b)
    remainder = remainder % b
    if remainder in seen:  # Digits have begun to recur.
      where = seen[remainder]
      return (integer, digits[:where], digits[where:])
    else:
      seen[remainder] = len(digits)

# Some examples.
for a, b in [(5,4), (1,6), (17,7), (22,11), (100,17)]:
  (i, f, r) = divide(a, b)
  print "%d/%d = %d.%s(%s)" % (a, b, i, ''.join(map(str, f)),''.join(map(str,r)))
# Output:
# 5/4 = 1.25(0)
# 1/6 = 0.1(6)
# 17/7 = 2.(428571)
# 22/11 = 2.(0)
# 100/17 = 5.(8823529411764705) 
```

您还可以使用大小的数组（Python 中的列表）`b`而不是字典，这会稍微快一些（不是在渐近方面，而是在常数因子方面）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-30T05:54:42.370

你可以用长除法来做到这一点。一次计算一个数字并减去以获得余数，然后将其乘以 10 以获得下一步的分子。当这个新分子与以前的分子之一匹配时，您知道您将从该点开始重复。您只需要保留一堆以前的分子并在每次迭代时搜索它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-03-05T18:00:21.067

我想这就是你要找的..

```
public static String divide(int a,int b,boolean decimalDone,boolean isMultiplied,String result){
           if(a<b){
                a=a*10;

                if(!decimalDone ) {result+=".";decimalDone=true;}
                else if(isMultiplied) result+="0";
                isMultiplied=true;
                divide(a,b,decimalDone,isMultiplied,result);

           }
           else{
               result+=a/b;
               a=a%b;
               isMultiplied=false;
               divide(a,b,decimalDone,isMultiplied,result);
           }

           return result;
    } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-06-23T12:11:48.433

我不是专家，我认为这个解决方案可能效率不高，但至少它很容易做到：

```
#you want to get a/b
from fractions import Fraction:
print float(Fraction(a,b)) 
```

评论很受欢迎

# function - 计算函数的第 n 次重复应用的方案过程？

> ID：249374
> 
> 赞同：1
> 
> 时间：2008-10-30T05:48:27.343
> 
> 标签：function, scheme

有人熟悉这个吗？

> 编写一个过程，将计算 f 和正整数 n 的过程作为输入，并返回计算 f 的第 n 次重复应用的过程。该程序应该能够按如下方式使用：
> 
> ```
> ((repeated square 2) 5)
> 625 
> ```

我知道我为函数组合创建的以下代码将有助于使解决方案更简单，但我不确定从这里去哪里：

```
(define (compose f g) (lambda (x) (f (g x)))) 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T07:27:47.657

好吧，你可能想要这样的东西，对吧？

```
((repeated square 3) 5)
-> (square ((repeated square 2) 5))
-> (square (square ((repeated square 1) 5)))
-> (square (square (square ((repeated square 0) 5))))
-> (square (square (square (identity 5)))) 
```

（不知道`identity`Scheme里有没有预定义，没有的话写起来也方便。）

现在，这不是直接可重现的，因为您不能`repeated`用任意东西神奇地将调用之外的代码封装起来。但是，当使用 重写时，这些缩减步骤是什么样的`compose`？你能在生成的步骤列表中找出一个模式并重现它吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-05T14:30:57.510

```
(define (repeated f n)
  (if (zero? n)
    identity
    (lambda (x) ((repeated f (- n 1)) (f x))))) 
```

或者，如果您坚持使用“撰写”：

```
(define (repeated f n)
  (if (zero? n)
    identity
    (compose (repeated f (- n 1)) f))) 
```

# c# - 以编程方式使用 SelectedItem 设置 DataContext

> ID：249375
> 
> 赞同：4
> 
> 时间：2008-10-30T05:48:28.810
> 
> 标签：c#, wpf, data-binding

如何以编程方式设置指定列表中选定项的 DataContext？

更简单地说，如何在代码中重现这种类型的绑定？

```
<StackPanel>
    <ListBox Name="listBox1" />
    <TextBox Name="textBox1" DataContext="{Binding ElementName=listBox1, Path=SelectedItem}" />
</StackPanel> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T05:52:35.277

您需要为文本框设置一个名称，以便您可以在代码中引用它。然后你应该能够将一个对象分配给 DataContext 属性。您可以像这样以编程方式创建数据绑定：

```
Binding binding = new Binding();
binding.ElementName = "listBox1";
binding.Path = new PropertyPath("SelectedItem");
binding.Mode = BindingMode.OneWay;
txtMyTextBox.SetBinding(TextBox.TextProperty, binding); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T05:58:28.307

哇，有时你只需要把问题拼出来就可以让额外的推动力朝着正确的方向前进，对吧？

这段代码对我有用：

```
Binding b = new Binding();
b.Path = new PropertyPath(ListBox.SelectedItemProperty);
b.Source = listBox1;
textBox1.SetBinding(TextBox.DataContextProperty, b); 
```

# character-encoding - 如何查找数据库使用的字符集

> ID：249376
> 
> 赞同：4
> 
> 时间：2008-10-30T05:50:40.210
> 
> 标签：character-encoding, sap-ase

我可以从 .NET 程序（使用 ODBC）或通过数据库管理工具（用 Java 编写）访问数据库。

如果我从 .NET 程序将“é”字符写入数据库，则它在数据库管理工具中显示为“Õ”（带有波浪号的大写 O）。

如果我从 DB 管理工具向数据库写入一个“é”字符，它在 .NET 程序中显示为“Å”（大写 A，顶部有一个圆圈）。

我并没有试图真正解决问题（即让两个程序显示相同的东西），尽管那会很好。我只是想猜测每个字符集用于解释数据，以便如果我使用 .NET 转储数据并使用该工具重新输入数据，我可以自己进行转换。

那么，2 个字符集的哪个组合会导致上述字符不匹配？

谢谢你的帮助。

**编辑：**使用 Sybase ASE 12.5

**编辑：**基本上问题是：你知道一个字符编码，它的 E9 代码点代表字符'Õ'（大写 O 和波浪号）或'Å'（大写 A，顶部有一个圆圈）？（这假设其中一个使用的是拉丁语 1，因此是 E9，我认为这很可能）

**编辑：**保罗的解决方案做到了。关于字符集的答案是：[hp-roman8](http://www.kostis.net/charsets/hproman8.htm)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T11:25:07.537

如果服务器和客户端使用不同的字符集，Sybase 会自动尝试进行转换。如果您使用关闭自动字符集转换，

```
set char_convert off 
```

你仍然得到相同的“Õ”和“Å”吗？

# python - 在 Leopard 上使用 PIL 和 Libjpeg 的 Python

> ID：249388
> 
> 赞同：3
> 
> 时间：2008-10-30T06:00:14.370
> 
> 标签：python, python-imaging-library, libjpeg, python-install

我在获取 PIL 支持的图片时遇到了问题 - 它向我抛出了这个：

```
IOError: decoder jpeg not available 
```

我从二进制安装了 PIL，没有意识到我需要 libjpeg。

我通过 fink 安装了 libjpeg 和 freetype2。

我尝试使用[http://timhatch.com/](http://timhatch.com/)（页面底部）的说明重新安装 PIL

*   下载 PIL 1.1.6 源码包并安装好开发者工具
*   用这个补丁给 setup.py 打补丁，这样它就可以找到你已经拥有的 Freetype。

    `patch -p0 < leopard_freetype2.diff`

*   sudo apt-get install libjpeg 如果你有 fink （否则，手动构建并调整路径）

但我仍然遇到同样的错误。

我在 Leopard PPC 上。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T06:31:00.363

我最近在需要 PIL 的产品 RHEL 盒子上部署 django 项目时遇到了类似的“jpeg 解码器问题”。我下载了 PIL，并立即运行了“python setup.py install”，并且很高兴一切正常，直到我遇到了问题。解决方法：系统上已经安装了libjpeg，所以我安装了libjpeg-devel。我回到了 PIL 的源代码并运行了“python setup.py build”，最后在输出中显示了 PIL configure 是否能够检测到对 jpeg、gif、freetype 等的支持，它说jpeg 支持还可以。安装 PIL 后，它工作正常。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-10T02:24:39.820

我遇到了同样的问题，这个人的帖子为我提供了解决方案：

rm Imaging-1.1.6 子目录中的 PIL 子目录和 PIL.pth 文件

完整的细节在这里：

[http://blog.tlensing.org/2008/12/04/kill-pil-%E2%80%93-the-python-imaging-library-headache/](http://blog.tlensing.org/2008/12/04/kill-pil-%E2%80%93-the-python-imaging-library-headache/)

这样做之后， selftest.py 工作正常。我还应该注意，我使用的是 jpeg 库的 macports 版本，并且我已经指定 JPEG_ROOT 指向我的 macports 根目录中的包含和 lib 路径

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T06:14:06.357

python 路径是否仍在查看 libjpeg 的旧二进制版本？

如果是，您将需要修改它以指向新位置。

当您编译新版本的 PIL 时，它是否说它找到了 libjpeg？没有它（iirc）它会很高兴地编译，你会看到的第一个麻烦迹象是在包含时间。

您需要在 ./configure 时调整路径。

差异可能不适合您。您应该进行更多测试，然后可能会提交错误。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-25T02:18:15.550

如果您使用 libjpeg 构建，但自检失败，则您可能安装了另一个令人困惑的 PIL。尝试安装它，然后查看 selftest 是否有效。

OP中引用的指令的直接链接也在[这里](http://timhatch.com/ark/2008/08/12/quick-howto-for-pil-on-leopard "Leopard 上 PIL 的快速操作方法")

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-12-26T13:34:05.027

我今天已经坚持这个问题好几个小时了。我的建议是不要一次又一次地反复试验，除非你能在前 15 分钟内解决问题。

有一些工具可以帮助您诊断问题：

1.检查 jpeg lib 架构是否与您的机器架构匹配：

```
file /usr/local/lib/libjpeg.7.dylib 
```

2.检查_imaging.so是否真的链接到你编译的jpeg lib

```
cd ImageSrc

python setup.py build_ext -i

otool -L PIL/_imaging.so 
```

3.尝试导入_imaging.so，看看有什么问题

```
cd PIL

python

import _imaging 
```

4.finally，尝试从python“site-package”目录中删除所有以前安装的PIL*，以确保设置工作正常

```
python setup.py install 
```

对我来说，这是由于我在雪豹上使用了 32 位 python，并通过这种方式安装 jpeg lib 解决了这个问题：

```
./configure CFLAGS="-arch i386" --enable-shared --enable-static 
```

# algorithm - 数组中的二分查找

> ID：249392
> 
> 赞同：16
> 
> 时间：2008-10-30T06:01:43.993
> 
> 标签：algorithm, arrays, language-agnostic, search, binary-search

我将如何仅使用数组来实现二进制搜索？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-30T06:13:30.117

确保您的数组已排序，因为这是二进制搜索的关键。

任何索引/随机访问数据结构都可以进行二进制搜索。所以当你说使用“只是一个数组”时，我会说数组是使用二进制搜索的最基本/常见的数据结构。

您可以递归（最简单）或迭代地执行此操作。二进制搜索的时间复杂度为 O(log N)，这比在 O(N) 处检查每个元素的线性搜索要快得多。以下是[Wikipedia 中的一些示例：二分搜索算法](http://en.wikipedia.org/wiki/Binary_search)：

递归：

```
BinarySearch(A[0..N-1], value, low, high) {  
    if (high < low)  
        return -1 // not found  
    mid = low + ((high - low) / 2) 
    if (A[mid] > value)  
        return BinarySearch(A, value, low, mid-1)  
    else if (A[mid] < value)  
        return BinarySearch(A, value, mid+1, high)  
    else
       return mid // found
    } 
```

迭代：

```
 BinarySearch(A[0..N-1], value) {
   low = 0
   high = N - 1
   while (low <= high) {
       mid = low + ((high - low) / 2)
       if (A[mid] > value)
           high = mid - 1
       else if (A[mid] < value)
           low = mid + 1
       else
           return mid // found
   }
   return -1 // not found
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2018-05-26T17:47:54.260

## Javascript 中的二进制搜索 (ES6)

*（如果有人需要）*

**自下而上：**

```
function binarySearch (arr, val) {
    let start = 0;
    let end = arr.length - 1;
    let mid;

    while (start <= end) {
        mid = Math.floor((start + end) / 2);

        if (arr[mid] === val) {
            return mid;
        }
        if (val < arr[mid]) {
            end = mid - 1;
        } else {
            start = mid + 1;
        }
    }
    return -1;
} 
```

**递归**：

```
function binarySearch(arr, val, start = 0, end = arr.length - 1) {
    const mid = Math.floor((start + end) / 2);

    if (val === arr[mid]) {
        return mid;
    }
    if (start >= end) {
        return -1;
    }
    return val < arr[mid]
        ? binarySearch(arr, val, start, mid - 1)
        : binarySearch(arr, val, mid + 1, end);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-31T21:25:49.630

单对比版快速简洁

```
int bsearch_double(const double a[], int n, double v) {
  int low = 0, mid;
  while (n - low > 1) {
    mid = low + (n - low) / 2;
    if (v < a[mid]) n   = mid;
    else            low = mid;
  }
  return (low < n && a[low] == v) ? low : -1;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-09-26T00:37:09.980

这取决于您是否在数组中重复了一个元素，以及您是否关心多个发现。我在这个实现中有两种方法。其中一个只返回第一个发现，但另一个返回键的所有发现。

```
import java.util.Arrays;

public class BinarySearchExample {

    //Find one occurrence
    public static int indexOf(int[] a, int key) {
        int lo = 0;
        int hi = a.length - 1;
        while (lo <= hi) {
            // Key is in a[lo..hi] or not present.
            int mid = lo + (hi - lo) / 2;
            if      (key < a[mid]) hi = mid - 1;
            else if (key > a[mid]) lo = mid + 1;
            else return mid;
        }
        return -1;
    }

    //Find all occurrence
    public static void PrintIndicesForValue(int[] numbers, int target) {
        if (numbers == null)
            return;

        int low = 0, high = numbers.length - 1;
        // get the start index of target number
        int startIndex = -1;
        while (low <= high) {
            int mid = (high - low) / 2 + low;
            if (numbers[mid] > target) {
                high = mid - 1;
            } else if (numbers[mid] == target) {
                startIndex = mid;
                high = mid - 1;
            } else
                low = mid + 1;
        }

        // get the end index of target number
        int endIndex = -1;
        low = 0;
        high = numbers.length - 1;
        while (low <= high) {
            int mid = (high - low) / 2 + low;
            if (numbers[mid] > target) {
                high = mid - 1;
            } else if (numbers[mid] == target) {
                endIndex = mid;
                low = mid + 1;
            } else
                low = mid + 1;
        }

        if (startIndex != -1 && endIndex != -1){
            System.out.print("All: ");
            for(int i=0; i+startIndex<=endIndex;i++){
                if(i>0)
                    System.out.print(',');
                System.out.print(i+startIndex);
            }
        }
    }

    public static void main(String[] args) {

        // read the integers from a file
        int[] arr = {23,34,12,24,266,1,3,66,78,93,22,24,25,27};
        Boolean[] arrFlag = new Boolean[arr.length];
        Arrays.fill(arrFlag,false);

        // sort the array
        Arrays.sort(arr);

        //Search
        System.out.print("Array: ");
        for(int i=0; i<arr.length; i++)
            if(i != arr.length-1){
                System.out.print(arr[i]+",");
            }else{
                System.out.print(arr[i]);
            }

        System.out.println("\nOnly one: "+indexOf(arr,24));
        PrintIndicesForValue(arr,24);

    }

} 
```

有关更多信息，请访问[https://github.com/m-vahidalizadeh/foundations/blob/master/src/algorithms/BinarySearchExample.java](https://github.com/m-vahidalizadeh/foundations/blob/master/src/algorithms/BinarySearchExample.java)。我希望它有所帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-05-05T11:53:06.793

用 Java 实现了下面的代码，简单快速 /** * 使用递归的二进制搜索 * @author asharda * */ public class BinSearch {

```
 /**
   * Simplistic BInary Search using Recursion
   * @param arr
   * @param low
   * @param high
   * @param num
   * @return int
   */
  public int binSearch(int []arr,int low,int high,int num)
  {
    int mid=low+high/2;
    if(num >arr[high] || num <arr[low])
    {
      return -1;
    }

    while(low<high)
    {
      if(num==arr[mid])
      {
        return mid;

      }
      else  if(num<arr[mid])
      {
       return  binSearch(arr,low,high-1, num);
      }

      else  if(num>arr[mid])
      {
        return binSearch(arr,low+1,high, num);
      }

    }//end of while

    return -1;
  }

  public static void main(String args[])
  {
    int arr[]= {2,4,6,8,10};
    BinSearch s=new BinSearch();
    int n=s.binSearch(arr, 0, arr.length-1, 10);
    String result= n>1?"Number found at "+n:"Number not found";
    System.out.println(result);
  }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-06-27T08:45:37.500

这是python编程语言的简单解决方案：

```
def bin(search, h, l):
    mid = (h+l)//2
    if m[mid] == search:
        return mid
    else:
        if l == h:
            return -1
        elif search > m[mid]:
            l = mid+1
            return bin(search, h, l)
        elif search < m[mid]:
            h = mid-1
            return bin(search, h, l)

m = [1,2,3,4,5,6,7,8]
tot = len(m)
print(bin(10, len(m)-1, 0)) 
```

这是过程：

*   获得中点
*   if mid point == search 返回中点
*   否则，如果更高点和更低点相同，则返回 -1
*   如果搜索值大于中点，则使中点+1 为较低值
*   如果搜索值小于中点，则将中点 1 设为较高值

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-07-09T20:08:27.323

二进制搜索的短循环：

```
function search( nums, target){    
    for(let mid,look,p=[0,,nums.length-1]; p[0]<=p[2]; p[look+1]=mid-look){
        mid = (p[0] + p[2])>>>1
        look = Math.sign(nums[mid]-target)
        if(!look) 
            return mid
    }
    return -1
} 
```

* * *

想法正在取代：

```
if(nums[mid]==target)
    return mid
else if(nums[mid]>target)
    right = mid - 1
else //here must nums[mid]<target
    left  = mid + 1 
```

如果观察前者相等，则更默契（并且可能减少计算量）：

```
switch(dir=Math.sign(nums[mid]-target)){
    case -1: left  = mid - dir;break;
    case  0: return  mid
    case  1: right = mid - dir;break;
} 
```

因此，如果左、中、右变量按顺序排列，我们可以在 C 指针意义上针对所有这些变量分别抛出 &mid[-1,0,1] ：

```
dir=Math.sign(nums[mid]-target)
&mid[dir] = mid - dir 
```

现在我们得到了循环体，所以我们可以构造二分搜索：

```
while(dir && left <= right){
    mid = (left + right)>>>2
    dir=Math.sign(nums[mid]-target)
    &mid[dir] = mid - dir
} 
```

之后我们只是：

```
return [dir,mid] 
```

具有语义的

```
for dir == -1 then nums[mid]<target<nums[mid+1] // if nums[mid+1 ] in start seaching domain
for dir ==  0 then mid is place of target in array 
for dir ==  1 then nums[mid-1]<target<nums[mid] // if nums[mid-1 ] in start seaching domain 
```

所以在一些更人性化的伪代码javascript函数中：

```
 function search( nums, target){
        let dir=!0,[left, mid, right]=[0, , nums.length-1]
        while(dir && left <=right){
            mid = (left + right)>>>1
            dir = Math.sign(nums[mid]-target)
            &mid[dir]=mid - dir
         }
         return [dir, mid]
    } 
```

对于 js sintax，我们需要使用 q={'-1':0,1:nums.length-1} 其中左名称为 q[-1]，mid 为 q[0]，右为 q[1] 或 q对于所有 3 是 q[dir]

或从 0 开始的数组索引相同：

我们可以使用 p=[0,,nums.length-1] 其中 left 是 p[0] 的昵称，mid 是 p[1] 和 right 是 p[2]，这对于所有 3 个都是 p[1+目录]

. :)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-11-18T01:12:28.783

假设数组已排序，这是一个具有 O(log n) 运行时复杂度的 Pythonic 答案：

```
def binary_search(nums: List[int], target: int) -> int:
    n = len(nums) - 1
    left = 0
    right = n

    while left <= right:
        mid = left + (right - left) // 2
        if target == nums[mid]:
            return mid
        elif target < nums[mid]:
            right = mid - 1
        else:
            left = mid + 1

    return -1 
```

# geometry - 比较多边形的相似性

> ID：249411
> 
> 赞同：6
> 
> 时间：2008-10-30T06:28:48.540
> 
> 标签：geometry, polygon

比较两个多边形的相似性的常用方法是什么？顶点是二维的。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T06:31:58.347

您会发现[这里公开了一些方法](http://www.cs.princeton.edu/courses/archive/spr00/cs598b/lectures/polygonsimilarity/polygonsimilarity.pdf)。

*   车削功能
*   图匹配
*   通过变形进行形状签名

它用于[图像检索](https://pdfs.semanticscholar.org/e6c8/1b6b0c05aabb062c9f92cd9fd772955e5cdf.pdf)（第 52 页）等领域，其中说明了转向函数。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T09:37:07.943

类似的东西：[形状相似性](http://www.cs.umu.se/kurser/TDBAfl/VT06/algorithms/BOOK/BOOK5/NODE196.HTM)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T08:25:02.800

我没有读过@VonC 讨论的转向函数，但我怀疑包含段之间斜率差异的向量的相关性会很好。

# c++ - 单线程两个进程

> ID：249415
> 
> 赞同：0
> 
> 时间：2008-10-30T06:31:20.627
> 
> 标签：c++, multithreading, synchronization, process

我有两个 C++ 进程（A 和 B），在 Windows 下执行，一个启动另一个。我想有效地单线程执行它们。例如：

1.  启动过程 A
2.  A创造B
3.  A 暂停
4.  B 执行一些固定的操作
5.  B暂停，A恢复
6.  A 执行一些固定的操作
7.  A暂停，B恢复
8.  （重复 4 - 7）

哪种 Windows 同步和 IPC 服务最适合实现此类行为？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T07:09:32.953

在这种情况下，事件将起作用：

*   A 创建一个事件并启动流程 B
*   A 等待事件发出信号
*   B 还创建一个事件，它是第一项，然后发出 A 的事件信号（该事件具有众所周知的名称，或者可以在 B 启动时将句柄传递给它，或者使用其他机制
*   B 等待它的事件
*   当A从等待它的事件中恢复时，它会做它的工作，通知B的事件并自行等待
*   很快...

只要确保您有错误处理，因此如果另一个进程挂起或意外终止，每个进程都可以恢复并执行任何必要的操作。超时可以处理挂起情况，等待其他进程的句柄（使用 WaitForMultipleObjects() 以及进程和事件句柄）可以确定其他进程是否/何时终止。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T07:03:18.143

将两个事件句柄 (CreateEvent) 传递给进程 B。当进程 a 完成工作时向一个句柄发出信号，在进程 b 完成工作时发出另一个句柄信号。每个进程调用 WaitForSingleObject() 来等待另一个进程完成一组工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T06:52:19.350

对于进程间同步，您可以使用[semaphores](http://en.wikipedia.org/wiki/Semaphores)。这是[文档](http://msdn.microsoft.com/en-us/library/ms686946(VS.85).aspx)。

# language-agnostic - XOR 变量交换如何工作？

> ID：249423
> 
> 赞同：80
> 
> 时间：2008-10-30T06:37:58.320
> 
> 标签：language-agnostic, bit-manipulation, xor

有人可以向我解释一下没有临时变量的两个变量的异或交换是如何工作的吗？

```
void xorSwap (int *x, int *y)
{
    if (x != y) {
        *x ^= *y;
        *y ^= *x;
        *x ^= *y;
    }
} 
```

我了解它的作用，但是有人可以引导我了解它的工作原理吗？

* * *

## 回答 #1

> 赞同：135
> 
> 时间：2008-10-30T06:45:44.777

您可以通过替换来查看它是如何工作的：

```
x1 = x0 xor y0
y2 = x1 xor y0
x2 = x1 xor y2 
```

代替，

```
x1 = x0 xor y0
y2 = (x0 xor y0) xor y0
x2 = (x0 xor y0) xor ((x0 xor y0) xor y0) 
```

因为 xor 是完全结合和可交换的：

```
y2 = x0 xor (y0 xor y0)
x2 = (x0 xor x0) xor (y0 xor y0) xor y0 
```

因为`x xor x == 0`对于任何 x，

```
y2 = x0 xor 0
x2 = 0 xor 0 xor y0 
```

因为`x xor 0 == x`对于任何 x，

```
y2 = x0
x2 = y0 
```

并且交换完成。

* * *

## 回答 #2

> 赞同：98
> 
> 时间：2008-10-30T07:15:39.600

其他人已经解释过了，现在我想解释为什么这是一个好主意，但现在不是。

早在我们拥有简单的单周期或多周期 CPU 的那一天，使用这个技巧来避免代价高昂的内存取消引用或将寄存器溢出到堆栈中会更便宜。但是，我们现在拥有具有大量流水线的 CPU。P4 的流水线在其流水线中有 20 到 31 个（左右）级，其中读取和写入寄存器之间的任何依赖都可能导致整个事情停止。xor 交换在 A 和 B 之间有一些非常重的依赖关系，这些依赖关系实际上根本不重要，但实际上会使管道停滞。停滞的管道会导致代码路径变慢，如果此交换位于您的内部循环中，那么您的移动速度将非常缓慢。

在一般实践中，当您使用临时变量进行交换时，您的编译器可以确定您真正想要做什么，并将其编译为单个 XCHG 指令。使用异或交换使编译器更难猜测您的意图，因此更不可能正确优化它。更不用说代码维护等。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2009-02-09T16:51:38.630

我喜欢用图形而不是数字来思考它。

假设您从 x = 11 和 y = 5 开始二进制（我将使用假设的 4 位机器），这里是 x 和 y

```
 x: |1|0|1|1|   -> 8 + 2 + 1
       y: |0|1|0|1|   -> 4 + 1 
```

现在对我来说，异或是一个反转操作，做两次就是一面镜子：

```
 x^y: |1|1|1|0|
 (x^y)^y: |1|0|1|1|   <- ooh!  Check it out - x came back
 (x^y)^x: |0|1|0|1|   <- ooh!  y came back too! 
```

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2008-10-30T06:50:43.880

这是一个应该更容易理解的一个：

```
int x = 10, y = 7;

y = x + y; //x = 10, y = 17
x = y - x; //x = 7, y = 17
y = y - x; //x = 7, y = 10 
```

*现在，通过理解^*可以被认为是*+* **或** *-*可以更容易地理解 XOR 技巧。就像：

```
x + y - ((x + y) - x) == x 
```

， 所以：

```
x ^ y ^ ((x ^ y) ^ x) == x 
```

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-10-30T06:40:07.583

大多数人会使用临时变量交换两个变量 x 和 y，如下所示：

```
tmp = x
x = y
y = tmp 
```

这是一个巧妙的编程技巧，可以在不需要临时值的情况下交换两个值：

```
x = x xor y
y = x xor y
x = x xor y 
```

[使用 XOR 交换两个变量中](http://betterexplained.com/articles/swap-two-variables-using-xor/)的更多详细信息

> 在第 1 行，我们结合 x 和 y（使用 XOR）来获得这个“混合”，并将其存储回 x。XOR 是保存信息的好方法，因为您可以通过再次执行 XOR 来删除它。
> 
> 在第 2 行。我们将混合与 y 异或，这消除了所有 y 信息，只剩下 x。我们将这个结果保存回 y，所以现在它们已经交换了。
> 
> 在最后一行，x 仍然具有混合值。我们再次与 y （现在与 x 的原始值）进行异或，以从混合中删除所有 x 的痕迹。这给我们留下了y，交换完成！

* * *

> 计算机实际上有一个隐含的“temp”变量，它在将中间结果写回寄存器之前存储它们。例如，如果将 3 添加到寄存器（在机器语言伪代码中）：

```
ADD 3 A // add 3 to register A 
```

> ALU（算术逻辑单元）实际上是执行指令 3+A 的部分。它接受输入 (3,A) 并创建一个结果 (3 + A)，然后 CPU 将其存储回 A 的原始寄存器。因此，在得到最终答案之前，我们将 ALU 用作临时暂存空间。
> 
> 我们认为 ALU 的隐式临时数据是理所当然的，但它始终存在。类似地，ALU 可以在 x = x xor y 的情况下返回 XOR 的中间结果，此时 CPU 将其存储到 x 的原始寄存器中。
> 
> 因为我们不习惯考虑可怜的、被忽视的 ALU，所以 XOR 交换看起来很神奇，因为它没有显式的临时变量。有些机器有一个 1 步交换 XCHG 指令来交换两个寄存器。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2009-02-09T15:25:31.177

它起作用的原因是因为 XOR 不会丢失信息。如果你可以忽略溢出，你可以用普通的加法和减法做同样的事情。例如，如果变量对 A,B 最初包含值 1,2，您可以像这样交换它们：

```
 // A,B  = 1,2
A = A+B // 3,2
B = A-B // 3,1
A = A-B // 2,1 
```

顺便说一句，在单个“指针”中编码 2 路链表有一个老技巧。假设您有一个位于地址 A、B 和 C 的内存块列表。每个块中的第一个字分别是：

```
 // first word of each block is sum of addresses of prior and next block
 0 + &B   // first word of block A
&A + &C   // first word of block B
&B + 0    // first word of block C 
```

如果您可以访问块 A，它会为您提供 B 的地址。要到达 C，您需要 B 中的“指针”并减去 A，依此类推。它也可以向后工作。要沿着列表运行，您需要保留指向两个连续块的指针。当然，您会使用 XOR 代替加法/减法，因此您不必担心溢出。

如果您想玩得开心，可以将其扩展到“链接网络”。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-10-30T08:16:56.933

[@VonC](https://stackoverflow.com/questions/249423/how-does-xor-variable-swapping-work#249427)说得对，这是一个巧妙的数学技巧。想象一下 4 位字，看看这是否有帮助。

```
word1 ^= word2;
word2 ^= word1;
word1 ^= word2;

word1    word2
0101     1111
after 1st xor
1010     1111
after 2nd xor
1010     0101
after 3rd xor
1111     0101 
```

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2009-01-05T11:16:13.320

XOR方法基本上有3个步骤：

a' = a XOR b (1)
b' = a' XOR b (2)
a” = a' XOR b' (3)

要了解***为什么***这样做，首先要注意：

1.  只有当其中一个操作数恰好为 1 且另一个为 0 时，异或才会产生 1；
2.  XOR 是**可交换**的，所以 a XOR b = b XOR a;
3.  XOR 是**关联**的，所以 (a XOR b) XOR c = a XOR (b XOR c)；和
4.  [a XOR a = 0（这从上面1](http://www.necessaryandsufficient.net/2009/01/swapping-integers/)的定义中应该很明显）

在步骤 (1) 之后，a 的二进制表示将仅在 a 和 b 具有相反位的位位置具有 1 位。即 (ak=1, bk=0) 或 (ak=0, bk=1)。现在，当我们在步骤（2）中进行替换时，我们得到：

b' = (a XOR b) XOR b
= a XOR (b XOR b) 因为 XOR 是关联
的 = a XOR 0 因为上面的 [4]
= a 由于 XOR 的定义（参见上面的[1](http://www.necessaryandsufficient.net/2009/01/swapping-integers/)）

现在我们可以代入步骤（3）：

a” = (a XOR b) XOR a
= (b XOR a) XOR a 因为 XOR 是可交换的
= b XOR (a XOR a) 因为 XOR 是关联的
= b XOR 0 因为上面的 [4]
= b 由于定义异或（见上面的[1](http://www.necessaryandsufficient.net/2009/01/swapping-integers/)）

此处提供更多详细信息： [必要和充分](http://www.necessaryandsufficient.net/2009/01/swapping-integers/)

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-02-09T16:32:51.467

作为旁注，几年前我以交换整数的形式独立地重新发明了这个轮子，方法是：

```
a = a + b
b = a - b ( = a + b - b once expanded)
a = a - b ( = a + b - a once expanded). 
```

（上面以一种难以阅读的方式提到了这一点），

完全相同的推理也适用于异或交换：a ^ b ^ b = a 和 a ^ b ^ a = a。由于 xor 是可交换的，x ^ x = 0 和 x ^ 0 = x，这很容易看出，因为

```
= a ^ b ^ b
= a ^ 0
= a 
```

和

```
= a ^ b ^ a 
= a ^ a ^ b 
= 0 ^ b 
= b 
```

希望这可以帮助。这个解释已经给出了......但不是很清楚imo。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2020-04-20T13:38:46.197

我只是想添加一个数学解释，以使答案更完整。在[群论中](https://en.wikipedia.org/wiki/Group_theory)，异或是一个[阿贝尔群](https://en.wikipedia.org/wiki/Abelian_group)，也称为交换群。这意味着它满足五个要求：闭包、关联性、标识元素、逆元素、交换性。

异或交换公式：

```
a = a XOR b
b = a XOR b
a = a XOR b 
```

将公式展开，将 a、b 替换为前面的公式：

```
a = a XOR b
b = a XOR b = (a XOR b) XOR b
a = a XOR b = (a XOR b) XOR (a XOR b) XOR b 
```

交换性意味着“a XOR b”等于“b XOR a”：

```
a = a XOR b
b = a XOR b = (a XOR b) XOR b
a = a XOR b = (a XOR b) XOR (a XOR b) XOR b 
            = (b XOR a) XOR (a XOR b) XOR b 
```

关联性意味着“(a XOR b) XOR c”等于“a XOR (b XOR c)”：

```
a = a XOR b
b = a XOR b = (a XOR b) XOR b 
            = a XOR (b XOR b)
a = a XOR b = (a XOR b) XOR (a XOR b) XOR b 
            = (b XOR a) XOR (a XOR b) XOR b 
            = b XOR (a XOR a) XOR (b XOR b) 
```

XOR 中的逆元素是自身，这意味着任何值与自身 XOR 都为零：

```
a = a XOR b
b = a XOR b = (a XOR b) XOR b 
            = a XOR (b XOR b) 
            = a XOR 0
a = a XOR b = (a XOR b) XOR (a XOR b) XOR b 
            = (b XOR a) XOR (a XOR b) XOR b 
            = b XOR (a XOR a) XOR (b XOR b) 
            = b XOR 0 XOR 0 
```

XOR 中的单位元为零，这意味着任何与零的 XOR 值都保持不变：

```
a = a XOR b
b = a XOR b = (a XOR b) XOR b 
            = a XOR (b XOR b) 
            = a XOR 0 
            = a
a = a XOR b = (a XOR b) XOR (a XOR b) XOR b 
            = (b XOR a) XOR (a XOR b) XOR b 
            = b XOR (a XOR a) XOR (b XOR b) 
            = b XOR 0 XOR 0 
            = b XOR 0
            = b 
```

您可以在[群论](https://en.wikipedia.org/wiki/Group_theory)中获得更多信息。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-01-05T15:37:24.350

其他人已经发布了解释，但我认为如果它带有一个很好的例子会更好地理解。

[异或真值表](https://i.stack.imgur.com/MkNUN.jpg)

如果我们考虑上面的真值表并取值`A = 1100`，`B = 0101`我们可以像这样交换值：

```
A = 1100
B = 0101

A ^= B;     => A = 1100 XOR 0101
(A = 1001)

B ^= A;     => B = 0101 XOR 1001
(B = 1100)

A ^= B;     => A = 1001 XOR 1100
(A = 0101)

A = 0101
B = 1100 
```

# php - 不同支撑形式背后的原因是什么？

> ID：249432
> 
> 赞同：5
> 
> 时间：2008-10-30T06:47:35.307
> 
> 标签：php, coding-style

我正在阅读[Zend Framework 编码标准](http://framework.zend.com/manual/en/coding-standard.coding-style.html)，他们在其中声明类定义后的大括号应该在下一行，即“一个真正的大括号形式”。

```
class MyClass
{
    function....
} 
```

我通常将大括号放在同一行：

```
class OtherClass {
    function ...
} 
```

将大括号放在下一行的原因是什么？或者使用任何其他风格，就此而言？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-10-30T06:52:18.570

将大括号单独放在线上有助于在视觉上将内部与外部分开。这样可以更轻松地快速扫描源代码并将块与周围环境区分开来。

此外，将牙套置于相同的压痕水平使眼睛更容易找到匹配项。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-30T06:49:54.193

个人喜好真的是唯一真正的“理由”。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-30T06:50:39.963

我发现您提到的第一种样式有助于在视觉上从其成员定义中偏移类名。这有助于我在扫描代码时更轻松地找到类声明的顶部。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-30T06:52:48.930

经常提到的原因是：

*   更容易匹配左大括号和右大括号（对于第一个示例）
*   不要浪费另一行（以便您可以在屏幕上放置更多代码行 - 第二个示例）

正如其他人所说：如果您使用 3rd 方代码，请遵循其约定。如果您编写自己的代码，请使用您认为更好的样式。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-10-30T07:39:21.737

我认为个人或团队项目的编码风格和命名约定主要是个人品味的问题（尽管团队采用单一的编码风格和命名约定是明智的）。

就个人而言，我喜欢遵循[​​Allman Style](http://en.wikipedia.org/wiki/Indent_style#Allman_style_.28bsd_in_Emacs.29)约定，因为它可以让我快速了解我的代码和缩进结构。当然，这会在你的代码中花费一些额外的行，但我认为这不符合优势。

关于这个问题的好资源是以下维基百科文章：

> [缩进样式](http://en.wikipedia.org/wiki/Indent_style)
> 
> [编程风格](http://en.wikipedia.org/wiki/Programming_style)
> 
> [命名约定](http://en.wikipedia.org/wiki/Naming_conventions_(programming))

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T06:49:48.670

用户偏好。这真的没什么区别。当我用 PHP 开发时，我使用了第二个选项，但现在使用 C#，我使用了第一个选项。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-10-30T07:00:20.070

关于这个高度主观的话题已经有几个话题了......

有些人对此充满热情，我个人选择了对齐大括号的“可读”选项（我不为我的代码在屏幕上使用的空间付费......所以我对紧凑性不感兴趣）但是当我为项目使用另一种风格，我只使用我贡献的风格。
标签大小，硬与软等相同。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-30T07:31:00.630

真正的原因是在整个代码库中都有统一的代码。两种风格都有其优点，哪种风格“更好”取决于个人喜好以及语言和项目中“传统”使用的风格。

如果规定了一种牙套样式，请使用它，否则使用您到达之前使用的东西。如果您正在开始一个新项目，请使用通常在所选语言中使用的内容。

制表符与空格也是如此。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-09-28T15:14:19.220

您使用哪种支撑样式是否重要？不。在同一个项目或源文件上工作的每个人都使用相同的大括号样式是否重要？不; 这不仅无关紧要，而且如果大括号样式因一个编码器而异，即使在同一个文件中，它也很有用。

“为什么这段代码会这样做？”

“我不知道，是凯文的笔迹，我们去问问他吧。”

# debugging - 调试 Direct3D 模型

> ID：249440
> 
> 赞同：1
> 
> 时间：2008-10-30T06:50:54.567
> 
> 标签：debugging, direct3d

我正在尝试在 Direct3D 中使用`DrawIndexedPrimitives`. 但是，我无法在屏幕上看到它。调试 Direct3D 模型的常用方法是什么？

我尝试了以下方法：

*   关闭背面剔除
*   用来`PrimitiveType.LineStrip`代替`PrimitiveType.TriangleStrip`
*   视图和投影矩阵的几种组合。
*   使用 AutoCAD 将顶点绘制为小球体

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T07:04:52.587

使用 DX SDK 中的 PIX 工具。真是*太棒了*。

可能您会想要使用单帧捕获模式。然后在绘图调用中，PIX 将在顶点处理发生之前、顶点处理发生之后、设备的完整状态、渲染的结果像素等显示模型。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-04T10:20:00.113

*   将背景颜色设为灰色；那么如果它是白色或黑色，你会看到它。
*   检查您的变换矩阵（世界/视图/投影）。使用标准数学函数进行查看和投影，将世界设置为身份。
*   确保设置好视口；很容易忘记这一点，并且在视口中有 0 值。
*   打开 D3D 调试。看看调试喷出；很多人错过了运行时会告诉你出了什么问题。
*   检查您的像素/顶点着色器。使用有效的已知设置；或固定功能。
*   检查渲染状态。如果您遇到深度设置问题，请打开 Z 缓冲、Z 测试、Z 写入等。检查您的彩色书写遮罩是否打开。有很多状态，寻找您更改的可能导致问题的状态。
*   检查您对 DrawIP 的调用 - 您可能会遇到参数问题，例如指定错误的顶点数、面数等。尝试绘制列表中的第一个三角形，而不是其他三角形；在你把它们都画出来之前先弄一个……

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-11-22T20:45:06.577

默认情况下，D3D 中没有灯光，可能一切都是黑色的。如果没有，请尝试打开灯。

# c# - 数据绑定格式到 DateTime 列

> ID：249448
> 
> 赞同：0
> 
> 时间：2008-10-30T06:57:21.713
> 
> 标签：c#, .net, data-binding, datetime

我有一个文本框，其**Text**属性绑定到 DataType 设置为 System.DateTime 的数据集列。
Binding 上的 FormatString 设置为**dd-MM-yyyy**。

当用户输入日期时，它会尝试将其转换为日期，但可能会为看似无效的日期提供一些奇怪的值。

例如：

```
textBox1.Text = "01-02-200"; 
```

应该是无效的日期，但将其格式化为**01-02-0200**。

是否有一种简单的方法可以通过设置有效范围或覆盖绑定/文本框上的事件来捕获这些越界值？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T07:47:56.947

.NET DateTime 在 01/01/0001 到 31/12/9999 23:59:59.9999999 的范围内，因此 01/01/200 被认为是有效的。

您可以验证输入并限制范围：Validating 事件将是进行验证的地方。您需要将字符串解析为 DateTime 并验证其范围。

允许的范围将取决于应用程序。例如，以下代码会将日期时间限制为可以存储在 SQL Server 2005 DATETIME 列（01-01-1753 到 31-12-999）中的值：

```
private void textBox1_Validating(object sender, CancelEventArgs e)
{
    DateTime date;
    if (!DateTime.TryParseExact(textBox1.Text, 
        "dd-MM-yyyy", 
        CultureInfo.CurrentCulture, 
        DateTimeStyles.None, 
        out date))
    {
        MessageBox.Show(textBox1.Text + " is not a valid date");
        textBox1.Focus();
        e.Cancel = true;
        return;
    }
    if ((date < (DateTime) System.Data.SqlTypes.SqlDateTime.MinValue) ||
        (date > (DateTime) System.Data.SqlTypes.SqlDateTime.MaxValue))
    {
        MessageBox.Show(textBox1.Text + " is out of range");
        textBox1.Focus();
        e.Cancel = true;
        return;
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T07:45:07.170

有什么理由不使用日期选择器控件而不是文本框？将解决验证问题，并可能使其成为用户更好的体验。

# c# - 在 c#.net 中的现有数组中添加新项目

> ID：249452
> 
> 赞同：150
> 
> 时间：2008-10-30T07:02:12.453
> 
> 标签：c#, .net

如何在 C#.net 中的现有字符串数组中添加新项目？

我需要保留现有数据。

* * *

## 回答 #1

> 赞同：125
> 
> 时间：2008-10-30T07:04:15.023

如果您需要动态大小的数组，我会使用 List：

```
List<string> ls = new List<string>();
ls.Add("Hello"); 
```

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2008-10-30T07:25:39.940

这可能是一个解决方案；

```
Array.Resize(ref array, newsize);
array[newsize - 1] = "newvalue" 
```

但是对于动态大小的数组，我也更喜欢列表。

* * *

## 回答 #3

> 赞同：55
> 
> 时间：2011-08-19T02:11:56.983

使用 LINQ：

```
arr = (arr ?? Enumerable.Empty<string>()).Concat(new[] { newitem }).ToArray(); 
```

我喜欢使用它，因为它是单行的，并且非常方便嵌入 switch 语句、简单的 if 语句或作为参数传递。

**编辑：**

有些人不喜欢`new[] { newitem }`它，因为它创建了一个小的、单项的临时数组。这是一个`Enumerable.Repeat`不需要创建任何对象的版本（至少表面上没有——.NET 迭代器可能会在表下创建一堆状态机对象）。

```
arr = (arr ?? Enumerable.Empty<string>()).Concat(Enumerable.Repeat(newitem,1)).ToArray(); 
```

如果您确定数组永远不会`null`开始，您可以将其简化为：

```
arr.Concat(Enumerable.Repeat(newitem,1)).ToArray(); 
```

请注意，如果您想将项目添加到有序集合中，`List`可能是您想要的数据结构，而不是数组。

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2016-06-08T07:12:53.127

非常老的问题，但仍然想添加这个。

如果您正在寻找单线，您可以使用下面的代码。它结合了接受可枚举的列表构造函数和“新”（因为提出问题）初始化程序语法。

```
myArray = new List<string>(myArray) { "add this" }.ToArray(); 
```

* * *

## 回答 #5

> 赞同：29
> 
> 时间：2008-10-30T10:53:07.167

**C# 中的数组是不可变的**`string[]`，例如`int[]`. 这意味着您无法调整它们的大小。您需要创建一个全新的阵列。

这是**Array.Resize**的代码：

```
public static void Resize<T>(ref T[] array, int newSize)
{
    if (newSize < 0)
    {
        throw new ArgumentOutOfRangeException("newSize", Environment.GetResourceString("ArgumentOutOfRange_NeedNonNegNum"));
    }
    T[] sourceArray = array;
    if (sourceArray == null)
    {
        array = new T[newSize];
    }
    else if (sourceArray.Length != newSize)
    {
        T[] destinationArray = new T[newSize];
        Copy(sourceArray, 0, destinationArray, 0, (sourceArray.Length > newSize) ? newSize : sourceArray.Length);
        array = destinationArray;
    }
} 
```

如您所见，它创建了一个具有新大小的新数组，复制源数组的内容并设置对新数组的引用。对此的提示是第一个参数的*ref*关键字。

有些列表可以为新项目**动态分配新插槽**。例如*List<T>*。它们包含不可变数组并在需要时调整它们的大小（List<T> 不是链表实现！）。*ArrayList*在没有泛型的情况下是一样的（使用*对象*数组）。

**LinkedList<T>**是一个真正的链表实现。不幸的是，您只能将 LinkListNode<T> 元素添加到列表中，因此您必须将自己的列表元素包装到此节点类型中。我认为它的使用并不常见。

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2011-12-23T14:00:33.793

```
 Array.Resize(ref youur_array_name, your_array_name.Length + 1);
 your_array_name[your_array_name.Length - 1] = "new item"; 
```

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2020-02-24T13:50:02.440

自 .NET Framework 4.7.1 和 .NET Core 1.0 以来，添加了一种新[`Append<TSource>`](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.append)方法。`IEnumerable<TSource>`

以下是如何使用它：

```
var numbers = new [] { "one", "two", "three" };
numbers = numbers.Append("four").ToArray();
Console.WriteLine(string.Join(", ", numbers)); // one, two, three, four 
```

请注意，如果您想在数组的开头添加元素，则可以改用 new[`Prepend<TSource>`](https://docs.microsoft.com/en-us/dotnet/api/system.linq.enumerable.prepend)方法。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2012-06-14T14:29:33.137

您可以通过使用他的基于 LINQ 的逻辑来扩展 @Stephen Chung 提供的答案，以使用泛型类型创建扩展方法。

```
public static class CollectionHelper
{
    public static IEnumerable<T> Add<T>(this IEnumerable<T> sequence, T item)
    {
        return (sequence ?? Enumerable.Empty<T>()).Concat(new[] { item });
    }

    public static T[] AddRangeToArray<T>(this T[] sequence, T[] items)
    {
        return (sequence ?? Enumerable.Empty<T>()).Concat(items).ToArray();
    }

    public static T[] AddToArray<T>(this T[] sequence, T item)
    {
        return Add(sequence, item).ToArray();
    }

} 
```

然后，您可以像这样直接在数组上调用它。

```
 public void AddToArray(string[] options)
    {
        // Add one item
        options = options.AddToArray("New Item");

        // Add a 
        options = options.AddRangeToArray(new string[] { "one", "two", "three" });

        // Do stuff...
    } 
```

诚然， AddRangeToArray() 方法似乎有点矫枉过正，因为您与 Concat() 具有相同的功能，但这样最终代码可以直接“使用”数组，而不是这样：

```
options = options.Concat(new string[] { "one", "two", "three" }).ToArray(); 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2017-09-15T07:47:08.120

所以如果你有一个现有的数组，我的快速修复将是

```
var tempList = originalArray.ToList();
tempList.Add(newitem); 
```

现在只需用新数组替换原始数组

```
originalArray = tempList.ToArray(); 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2014-11-03T09:07:40.157

## 最好保持 Array 不可变和固定大小。

`Add`你可以通过`Extension Method`和模拟`IEnumerable.Concat()`

```
public static class ArrayExtensions
    {
        public static string[] Add(this string[] array, string item)
        {
            return array.Concat(new[] {item}).ToArray();
        }
    } 
```

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2016-05-21T23:41:47.233

如果您出于某种原因经常使用数组而不是列表，则此泛型类型化返回泛型方法`Add`可能会有所帮助

```
 public static T[] Add<T>(T[] array, T item)
    {
        T[] returnarray = new T[array.Length + 1];
        for (int i = 0; i < array.Length; i++)
        {
            returnarray[i] = array[i];
        }
        returnarray[array.Length] = item;
        return returnarray;
    } 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2018-06-09T09:52:23.627

所有提议的答案都与他们所说的要避免的相同，创建一个新数组并在其中添加一个新条目，只是损失了更多开销。LINQ 并不神奇，T 的列表是一个带有缓冲区空间的数组，其中包含一些额外空间，以避免在添加项目时调整内部数组的大小。

所有的抽象都必须解决同样的问题，创建一个没有空槽的数组来保存所有值并返回它们。

如果您需要灵活性，可以创建一个足够大的列表以供您通过，然后执行此操作。否则使用数组并共享该线程安全对象。此外，新的 Span 有助于共享数据，而无需复制列表。

要回答这个问题：

```
Array.Resize(ref myArray, myArray.Length + 1);
data[myArray.Length - 1] = Value; 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2012-05-29T13:02:32.373

使用列表将是您进行内存管理的最佳选择。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2011-04-25T15:57:11.220

```
string str = "string ";
List<string> li_str = new List<string>();
    for (int k = 0; k < 100; i++ )
         li_str.Add(str+k.ToString());
string[] arr_str = li_str.ToArray(); 
```

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2017-03-15T04:02:59.730

使用扩展方法怎么样？例如：

```
public static IEnumerable<TSource> Union<TSource>(this IEnumerable<TSource> source, TSource item)
{
    return source.Union(new TSource[] { item });
} 
```

例如：

```
string[] sourceArray = new []
{
    "foo",
    "bar"
}
string additionalItem = "foobar";
string result = sourceArray.Union(additionalItem); 
```

请注意，这模仿了 Linq 的 Uniion 扩展的这种行为（用于将两个数组组合成一个新数组），并且需要 Linq 库才能运行。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2008-10-30T07:11:03.540

我同意埃德的观点。C# 不像 VB 使用 ReDim Preserve 那样简单。如果没有集合，您将不得不将数组复制到更大的数组中。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-08-19T02:32:41.817

为什么不尝试使用**Stringbuilder**类。它有 .insert 和 .append 等方法。您可以在此处阅读更多信息：http: [//msdn.microsoft.com/en-us/library/2839d5h5 (v=vs.71).aspx](http://msdn.microsoft.com/en-us/library/2839d5h5(v=vs.71).aspx)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2010-05-07T10:54:02.650

```
private static string[] GetMergedArray(string[] originalArray, string[] newArray)
    {
        int startIndexForNewArray = originalArray.Length;
        Array.Resize<string>(ref originalArray, originalArray.Length + newArray.Length);
        newArray.CopyTo(originalArray, startIndexForNewArray);
        return originalArray;
    } 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-12-28T14:49:25.273

不幸的是，使用列表并不适用于所有情况。列表和数组实际上是不同的，不是 100% 可互换的。这将取决于情况是否可以接受。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-04-21T04:09:21.967

由于这个问题对提供的答案不满意，我想添加这个答案:)

```
public class CustomArrayList<T> 
 {  
   private T[] arr;  private int count;  

public int Count  
  {   
    get   
      {    
        return this.count;   
      }  
   }  
 private const int INITIAL_CAPACITY = 4;  

 public CustomArrayList(int capacity = INITIAL_CAPACITY) 
 {  
    this.arr = new T[capacity];   this.count = 0; 
  } 

 public void Add(T item) 
  {  
    GrowIfArrIsFull();  
   this.arr[this.count] = item;  this.count++; 
  }  

public void Insert(int index, T item) 
{  
 if (index > this.count || index < 0)  
    {   
      throw new IndexOutOfRangeException(    "Invalid index: " + index);  
     }  
     GrowIfArrIsFull();  
     Array.Copy(this.arr, index,   this.arr, index + 1, this.count - index);          
    this.arr[index] = item;  this.count++; }  

    private void GrowIfArrIsFull() 
    {  
    if (this.count + 1 > this.arr.Length)  
    {   
      T[] extendedArr = new T[this.arr.Length * 2];  
      Array.Copy(this.arr, extendedArr, this.count);  
      this.arr = extendedArr;  
    } 
  }
 }
} 
```

# html - 防止长字向html视图添加水平滚动

> ID：249460
> 
> 赞同：1
> 
> 时间：2008-10-30T07:07:00.897
> 
> 标签：html, windows-mobile

在 Windows Mobile 上，我以 HTML 格式显示我的输出。这包括许多用户生成的字符串。偶尔会有一个非常大的字符串是没有空格或标点符号的输出的一部分的情况。

不幸的是，Windows Mobile 的 HTML 视图（htmlview.dll，基于 Pocket Internet Explorer）并没有分解这些长词，因此它们适合屏幕。相反，添加了一个水平滚动条，用户必须横向滚动才能看到整个单词。这也会影响现在也沿着这个更大的屏幕宽度分布的其他输出。

是否有可能使 htmlview 表现不同，或强制单词中断？可以使用 CSS。关于强迫：­ 标签总是插入一个“-”字符并且永远不会导致中断， <WBR> 标签根本没有做任何事情，&8203; 输出为 &8203:，空标签如**也无所作为。还应该注意的是，此代码在多种屏幕尺寸上运行，并且由于 HTML 输出的其他部分，我不能 100% 确定我还剩下多少屏幕宽度。**

 **PS：我的应用程序是使用 WM 5.0 SDK 编译的，并且是用 C++/Win32/MFC 编写的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T07:37:25.500

除了 nickf 提到的 shy hypen 之外，您始终可以使用 CSS 通过将框的样式设置为`overflow: hidden`. 好消息：没有滚动条，妈。坏消息：字被删了。不过，对于害羞的炒作，我不会选择实体。相反，直接在文本中使用该字符：其字符代码为 0xAD (Unicode +00AD)。（实体通常通过使用正确的编码来弃用。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T07:27:08.313

我对 Windows Mobile 几乎一无所知，所以我可能会走得更远，但是您可以尝试做的是在整个长词中的特定时间段插入 HTML 实体，作为连字符“提示”。

因为我假设它只有在 WinMo 上运行的 IE，所以您要查找的实体称为“害羞连字符”：`&shy;`它基本上是一个字符，它告诉浏览器“这一点将是一个断词的好地方，只有如果你需要”。如果确实需要将单词分成两行（或更多！）行，则插入连字符，否则它是完全不可见的。

我在[这里](http://gojomo.blogspot.com/2005/03/cross-browser-invisible-word-break-in.html)找到了此信息，其中还包含有关如何在其他浏览器中执行此操作的更多详细信息。

我首先将它们放入您的 HTML 的方法是搜索长度超过 X 个字符（例如 30 个）的单词，然后在这些单词中，在每个 Y 个字符之后（例如 20 个）插入`&shy;`

# sql - SQL：逐月计算

> ID：249461
> 
> 赞同：0
> 
> 时间：2008-10-30T07:07:05.907
> 
> 标签：sql

我想计算两个日期的月差，这将返回一个浮点值。

例子：

date1='4/23/2008' date2='12/31/2008'

那将是7.y个月。我想找到 y 值。有人可以给我用sql代码制作这个的公式吗？tnx..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T07:20:50.450

没有标准的 sql 可以通用地处理这个问题。这取决于您使用的数据库。基本上，您需要将两个日期字符串转换为您的数据库引擎内部使用的日期格式并减去两个日期，减法的结果意味着什么，再次取决于。在 Oracle 中，您将`to_date()`用于转换，减法的结果将是一个浮点数，以天数表示时间。

简而言之，在您的数据库手册中搜索有关日期处理或数据类型的部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T07:40:13.547

因为月份的长度不同，为了简单起见，我假设一个月有 30 天。使用一位数的精度，这不会有太大的区别，但不要尝试根据结果值计算新日期，因为它们不会 100% 准确。

*（我会尝试找到一种更好地格式化它的方法......）*

```
DECLARE @d1 DATETIME
DECLARE @d2 DATETIME

SET @d1 = '2008-04-23'
SET @d2 = '2008-12-31'

SELECT CONVERT(FLOAT, DATEDIFF(mm, @d1, @d2)) + ROUND(CONVERT(FLOAT, DATEDIFF(dd, DATEADD(mm, DATEDIFF(mm, @d1, @d2), @d1), @d2) % 30) / 30, 1) 
```

这产生：

```
8.3 
```

该公式考虑到在 '2008-04-13' 和 '2008-11-05' 之间，`DATEDIFF(mm ...)`返回 7，但实际上它不是中间的七个月，而是更少。在此示例中，它返回：

```
6.7 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T07:21:56.517

Sql Server 的近似结果；

```
select cast(datediff(dd, date1, date2) as float) / 30 
```

# c++ - 什么是浮点/舍入误差的简单示例？

> ID：249467
> 
> 赞同：37
> 
> 时间：2008-10-30T07:12:10.200
> 
> 标签：c++, floating-accuracy

我在使用浮点变量时听说过“错误”。现在我正在尝试解决这个难题，我想我遇到了一些舍入/浮点错误。所以我终于要弄清楚浮点错误的基础知识了。

什么是浮点/舍入错误的简单示例（最好在 C++ 中）？

编辑：例如说我有一个成功概率为 p 的事件。我做了 10 次这个事件（p 不变，所有试验都是独立的）。恰好 2 次成功试验的概率是多少？我将此编码为：

```
double p_2x_success = pow(1-p, (double)8) * pow(p, (double)2) * (double)choose(8, 2); 
```

这是浮点错误的机会吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2011-04-17T15:49:25.687

图片值一千字 - 尝试绘制方程`f(k)`：
![在此处输入图像描述](https://i.stack.imgur.com/bZcxI.gif)
你会得到这样的 XY 图（X 和 Y 是对数刻度）。
![在此处输入图像描述](https://i.stack.imgur.com/UVWuE.png)
如果计算机可以表示 32 位浮点数而没有舍入误差，那么对于每个`k`我们应该得到零。但是由于浮点误差累积，误差随着 k 值的增大而增加。

嗯！

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2008-10-30T10:46:24.137

```
 for(double d = 0; d != 0.3; d += 0.1); // never terminates 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-10-30T07:33:33.123

通常，浮点错误是指无法以 IEEE 浮点表示形式存储的数字。

整数存储时最右边的位为 1，左边的每一位都是 (2,4,8,...) 的两倍。很容易看出，它可以存储最多 2^n 的任何整数，其中 n 是位数。

浮点数的尾数（小数部分）以类似的方式存储，但从左到右移动，每个连续的位是前一个值的一半。（实际上比这要复杂一点，但现在可以了）。

因此，像 0.5 (1/2) 这样的数字很容易存储，但并非每个 <1 的数字都可以通过添加固定数量的 1/2、1/4、1/8、...

一个非常简单的例子是 0.1 或 1/10。这可以通过无限系列来完成（我真的不介意计算），但是每当计算机存储 0.1 时，存储的并不完全是这个数字。

如果您可以访问 Unix 机器，很容易看到这一点：

```
Python 2.5.1 (r251:54863, Apr 15 2008, 22:57:26) 
[GCC 4.0.1 (Apple Inc. build 5465)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> 0.1
0.10000000000000001
>>> 
```

无论您使用哪种语言，您都需要非常小心地使用浮点数和双精度数进行相等测试。

（对于您的示例，0.2 是另一个无法存储在 IEEE 二进制文件中的讨厌数字，但只要您正在测试不等式，而不是等式，例如 p <= 0.2，那么您就可以了。）

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2014-12-17T15:37:32.583

这是一个吸引我的：

```
 round(256.49999) == 256
roundf(256.49999) == 257 
```

doubles 和 floats 具有不同的精度，因此第一个将表示为`256.49999000000003`，第二个表示为 ，`256.5`因此会以不同的方式舍入

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-30T07:52:46.127

C 中的一个简单示例，不久前就引起了我的注意：

```
double d = 0;
sscanf("90.1000", "%lf", &d);
printf("%0.4f", d); 
```

这打印`90.0999`

这是一个将 DMS 中的角度转换为弧度的函数。

为什么它在上述情况下不起作用？

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2020-05-20T15:47:02.050

这是我想到的最简单的，应该适用于多种语言的简单方法是：

```
0.2 + 0.1 
```

以下是一些我想到的 REPL 示例，但应该在任何符合 IEEE754 的语言上返回此结果。

Python

```
>>> 0.2 + 0.1
0.30000000000000004 
```

科特林

```
0.2 + 0.1
res0: kotlin.Double = 0.30000000000000004 
```

斯卡拉

```
scala> 0.2 + 0.1
val res0: Double = 0.30000000000000004 
```

爪哇

```
jshell> 0.2 + 0.1
$1 ==> 0.30000000000000004 
```

红宝石

```
irb(main):001:0> 0.2 + 0.1
=> 0.30000000000000004 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2018-11-06T18:16:02.300

我喜欢 Python 解释器中的这个：

```
Python 2.7.10 (default, Oct  6 2017, 22:29:07) 
[GCC 4.2.1 Compatible Apple LLVM 9.0.0 (clang-900.0.31)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> 0.1+0.2
0.30000000000000004
>>> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2019-08-14T12:58:21.167

超级简单：

```
a = 10000000.1
b = 1/10
print(a - b == 10000000)
print ('a:{0:.20f}\nb:{1:.20f}'.format(a, b)) 
```

打印（取决于平台）类似：

```
False                                                                                                                                 
a:10000000.09999999962747097015                                                                                                       
b:0.10000000000000000555 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-05-10T20:41:45.890

我认为 Ruby 在[其文档](https://ruby-doc.org/stdlib-2.5.1/libdoc/bigdecimal/rdoc/BigDecimal.html)中有一个很好的例子：

```
sum = 0
10_000.times do
  sum = sum + 0.0001
end
print sum #=> 0.9999999999999062 
```

# c - 你什么时候使用 uint_least16_t

> ID：249468
> 
> 赞同：6
> 
> 时间：2008-10-30T07:12:56.627
> 
> 标签：c

我正在查看 stdint.h 并考虑到它具有 uint16_t 和 uint_fast16_t，那么 uint_least16_t 有什么用处，你可能希望其他两个中的一个不能同样好地做到这一点？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-30T07:22:43.253

假设您正在使用以下编译器进行编译：

*   `unsigned char`是 8 位
*   `unsigned short`是 32 位
*   `unsigned int`是 64 位

unsigned int 是“最快的”。在那个平台上：

*   `uint16_t`将*不可*用
*   `uint_least16_t`将是一个 32 位的值
*   `uint_fast16_t`将是一个 64 位的值

有点神秘，但这就是它的用途。

它们的用处是另一回事——我总是看到确切的尺寸变体。这就是人们想要的。我见过的“最少”和“快速”版本几乎从未使用过（可能只是在示例代码中——我真的不确定）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T07:44:41.227

啊，Patrick 发布的链接包括这个“typedef 名称 uint_leastN_t 指定了一个宽度至少为 N 的无符号整数类型，因此没有较小大小的无符号整数类型至少具有指定的宽度。”

所以我目前的理解是：

uint_least16_t 能够容纳 uint16 的最小的东西

uint_fast16_t 能够容纳 uint16 的最快的东西

uint16_t 恰好是一个 uint16，不幸的是，可能并非在所有平台上都可用，在任何可用的平台上 uint_least16_t 都会引用它。因此，如果保证它存在于所有平台上，我们根本不需要 uint_least16_t。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T07:21:10.417

它是 c 标准的一部分。它不需要一个好的用例。:P

请参阅[此](http://www.opengroup.org/onlinepubs/009695399/basedefs/stdint.h.html)页面并查找标题为“最小宽度整数类型”的部分。

# string - JavaME：将字符串转换为驼峰式

> ID：249470
> 
> 赞同：2
> 
> 时间：2008-10-30T07:16:06.840
> 
> 标签：string, java-me, camelcasing

将像“Hello thereeveryone”这样的字符串转换为“helloThereEveryone”的方法的简单实现是什么？在 JavaME 中，对 String 和 StringBuffer 实用程序操作的支持非常有限。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T07:40:36.993

快速的原始实现。我不知道 J2ME 的限制，所以我希望它适合或给出一些想法......

```
String str = "Hello, there, everyone?";

StringBuffer result = new StringBuffer(str.length());
String strl = str.toLowerCase();
boolean bMustCapitalize = false;
for (int i = 0; i < strl.length(); i++)
{
  char c = strl.charAt(i);
  if (c >= 'a' && c <= 'z')
  {
    if (bMustCapitalize)
    {
      result.append(strl.substring(i, i+1).toUpperCase());
      bMustCapitalize = false;
    }
    else
    {
      result.append(c);
    }
  }
  else
  {
    bMustCapitalize = true;
  }
}
System.out.println(result); 
```

您可以将复杂的大写附加替换为：

```
result.append((char) (c - 0x20)); 
```

虽然它可能看起来更hackish。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T07:42:01.873

使用 CDC，您可以：

String.getBytes();//将字符串转换为字节数组 String.indexOf(int ch); //用于定位单词的开头 String.trim();//删除空格

对于小写/大写，您需要添加（减去）32。

使用这些元素，您可以构建自己的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-04-30T23:30:15.783

```
private static String toCamelCase(String s) {
    String result = "";
    String[] tokens = s.split("_"); // or whatever the divider is
    for (int i = 0, L = tokens.length; i<L; i++) {
        String token = tokens[i];
        if (i==0) result = token.toLowerCase();
        else
            result += token.substring(0, 1).toUpperCase() +
                token.substring(1, token.length()).toLowerCase();
    }
    return result;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T07:40:05.167

建议：

可能是如果您可以[在 J2ME 上移植一个正则表达式库](https://stackoverflow.com/questions/121988/how-can-i-add-a-regex-match-to-my-j2me-project)，您可以使用它来去除字符串中的空格...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-10-08T05:03:11.500

试试下面的代码

```
public static String toCamel(String str) {
    String rtn = str;
    rtn = rtn.toLowerCase();
    Matcher m = Pattern.compile("_([a-z]{1})").matcher(rtn);
    StringBuffer sb = new StringBuffer();
    while (m.find()) {
        m.appendReplacement(sb, m.group(1).toUpperCase());
    }
    m.appendTail(sb);
    rtn = sb.toString();
    return rtn;
} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-07-11T13:04:26.737

我建议使用以下简单代码：

```
 String camelCased = "";
    String[] tokens = inputString.split("\\s");
    for (int i = 0; i < tokens.length; i++) {
        String token = tokens[i];
        camelCased = camelCased + token.substring(0, 1).toUpperCase() + token.substring(1, token.length());
    }
    return camelCased; 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2012-05-08T12:05:32.253

我会这样做：

```
private String toCamelCase(String s) {
    StringBuffer sb = new StringBuffer();
    String[] x = s.replaceAll("[^A-Za-z]", " ").replaceAll("\\s+", " ")
            .trim().split(" ");

    for (int i = 0; i < x.length; i++) {
        if (i == 0) {
            x[i] = x[i].toLowerCase();
        } else {
            String r = x[i].substring(1);
            x[i] = String.valueOf(x[i].charAt(0)).toUpperCase() + r;

        }
        sb.append(x[i]);
    }
    return sb.toString();
} 
```

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2012-06-18T18:51:31.430

检查这个

```
import org.apache.commons.lang.WordUtils;

String camel = WordUtils.capitalizeFully('I WANT TO BE A CAMEL', new char[]{' '});

return camel.replaceAll(" ", ""); 
```

# svn - Subversion 挂钩不永久接受证书

> ID：249489
> 
> 赞同：6
> 
> 时间：2008-10-30T07:27:45.287
> 
> 标签：svn, hook, svn-hooks

我希望有人能够回答我的问题。

我设置了 Subversion，由 Apache2+SSL 提供服务，进行 Web 开发。

我想要一个在我的测试服务器上运行 svn update 的提交后挂钩，所以当有人提交时，它会自动更新测试站点。该钩子不起作用，因为证书是自生成的并且不受信任。

我试图永久地接受（p），但事实并非如此。

有任何想法吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-26T18:21:38.220

root 拥有我的 $HOME 中的 .subversion 文件夹，所以我将其删除并再次运行“svn up”。现在一切都很好。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-03-29T12:47:39.277

在 Linux 下：

在这里，我通过将 $HOME/.subversion/auth/svn.ssl.server 中的文件更改为 -rw-r--r-- 来解决问题。显然，如果服务器获得新的或升级的证书，它会写入新文件，但不会为自己添加写权限。使用 -r--r--r-- 权限，svn 程序可以工作，但它不能将“永久接受”标志写入文件.. :)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T08:25:35.967

您没有说明您的测试服务器正在运行什么平台，但如果它是 Windows 机器，那么您需要将证书添加到测试服务器的证书存储中。以下 technet 文章可能会有一些用处：

*   [证书存储：公钥](http://technet.microsoft.com/en-us/library/cc757138.aspx)
*   [高级证书管理分步指南](http://technet.microsoft.com/en-us/library/bb727068.aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T12:00:54.207

可能是 subversion 以不同的用户身份运行，而不是您在被钩子调用时接受证书的用户。尝试找出用户（例如，在提交后挂钩脚本中输入“echo $USER > /tmp/svn-hook-user”）并使用 sudo 以该用户的身份接受证书。

或者，查看有关如何设置配置以便接受自签名证书的 Subversion 书籍：[SSL 证书管理](http://svnbook.red-bean.com/en/1.5/svn.serverconfig.httpd.html#svn.serverconfig.httpd.authn.sslcerts)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-18T18:02:47.353

当您的测试站点在同一台服务器上时，请使用**file:///**签出存储库以避免证书检查。

```
svn co file:///path_to/your/repo 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T17:17:23.163

您是否在脚本中使用 sudo 或其他内容？Sudo 通常会清理环境变量，因此 HOME 不存在。您必须有可写的主目录，subversion 可以在其中存储有关永久接受的证书的信息。所以在脚本的开头自己设置 HOME 变量，它应该可以工作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-08-22T02:38:47.670

在使用 Apache 的 Window Server 上设置它时遇到了同样的问题。提交后挂钩将失败。我不确定 SVN 是否独立，但我使用作为 Windows 服务运行的 VisualSVN 服务器。该服务的默认用户帐户是网络服务 - 所以我只是将帐户更改为我自己的管理员帐户，一切正常。

# design-patterns - 实现协议的最佳方式是什么？

> ID：249493
> 
> 赞同：5
> 
> 时间：2008-10-30T07:29:51.117
> 
> 标签：design-patterns, protocols

假设您正在编写一个必须实现 HTTP 协议的应用程序。协议非常复杂，并且可能允许多个命令，具体取决于它们处于事务的哪个阶段。

例如，看一下 SMTP。如果在接收“rcpt”和“mail”之前发送“data”命令，SMTP 服务器必须抛出错误。

我的问题是：在代码中处理此类协议的最佳方法是什么？有没有与此相关的设计模式？

编辑：这个问题与实现协议背后的理论有关。我知道使用库是实践中最好的方法。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-30T07:32:04.683

**状态机**

在我看来，状态机是建模和处理协议的最简单方法。与接收到的有效命令相关的几个转换将达到一个状态。然后每个状态将只允许某个命令子集。

状态机在编译器构造中用于程序的词法分析。我认为协议实现的问题是这种情况的一个特例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T07:32:44.323

处理此类协议的最佳方法是使用库。几乎地球上使用的每一种计算机语言都有预先存在的、经过良好测试的库来处理 http 和 smtp。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T12:31:24.423

@绒毛@

Zed Shaw（Mongrel 的作者）[同意你](http://www.zedshaw.com/tips/ragel_state_charts.html)的看法；他使用[Ragel](http://www.complang.org/ragel/)。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-10-30T12:39:22.333

我同意 a28，最好的方法是：

*   使用实现协议服务器的库
*   将您的应用程序编写为现有服务器的扩展（例如通过 IIS、Apache API 等的 Web 服务器扩展、Sendmail Milter 等）或
*   修改现有服务器以在应用程序接收请求时对其进行 RPC 调用。

编写您自己的协议实现可能会导致具有互操作性问题的错误实现。

一个有趣的工具是[twisted](http://twistedmatrix.com/trac/)，它是python特有的，但相当聪明，包括许多现有协议（HTTP、SMTP、IRC等）的实现。

# lambda - 我在这个方案评估中做错了什么？

> ID：249499
> 
> 赞同：0
> 
> 时间：2008-10-30T07:34:39.267
> 
> 标签：lambda, scheme, evaluation

评估：

```
((((lambda (x) (lambda (y) (lambda (x) (+ x y)))) 3) 4) 5) 
```

这就是我所做的：

*   评估`((((lambda (x) (lambda (y) (lambda (x) (+ x y)))) 3) 4) 5)`

    *   评估`5 -> 5`
*   评估`(((lambda (x) (lambda (y) (lambda (x) (+ x y)))) 3) 4)`

    *   评估`4 -> 4`
*   评估`((lambda (x) (lambda (y) (lambda (x) (+ x y)))) 3)`

    *   评估`3 -> 3`
*   `(lambda (x) (lambda (y) (lambda (x) (+ x y))))`->`(lambda (x) (lambda (y) (lambda (x) (+ x y))))`

*   适用`(lambda (x) (lambda (y) (lambda (x) (+ x y))))`于`3`

    *   替代`3`->`x`在`(lambda (y) (lambda (x) (+ x y))`

    *   `(lambda (y) (lambda (x) (+ 3 y))`

    *   评估`(lambda (y) (lambda (x) (+ 3 y)) -> (lambda (y) (lambda (x) (+ 3 y))`

    *   `apply (lambda (y) (lambda (x) (+ 3 y))`至`4`

    *   代`4 -> y`入`(lambda (y) (lambda (x) (+ 3 y))`

    *   `(lambda (y) (+ 3 4))`

    *   评估`(lambda (y) (+ 3 4)) -> (lambda (y) (7))`

        *   替代`5`->？

然后我被卡住了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T07:48:19.817

我建议您将其分解为单独的“已定义”程序。

```
(define part1 (lambda (y) (lambda (x) (+ x y)))) ; basically an adder
(define part2 (lambda (x) part1))  ; just return part1, x has no effect 
```

现在打电话`(((part2 3) 4) 5) => 9`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T08:04:28.707

```
-substitute 3 -> x in (lambda (y) (lambda (x) (+ x y))
-(lambda (y) (lambda (x) (+ 3 y)) 
```

首先，这是错误的。您不会替换`3`所有出现的`x`，只替换免费的。`x`您在此处替换的内容受内部 lambda 表达式的约束，因此不是免费的。

`5`其次，将值替换为从未使用过的变量并没有错，因此替换`y`in`(+ 3 4)`很好并且 yield `(+ 3 4)`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T08:05:41.933

你的第一个替换是错误的；`x`in受`(+ x y)`最内层约束`lambda`，而不是最外层约束。这意味着该替换的结果是 just `(lambda (y) (lambda (x) (+ x y)))`。这`3`是“丢失”。（也许您应该查找替换规则并逐步应用它们以更好地掌握它。）

无论如何，要完成，您仍然可以申请`(lambda (y) (7))`（或者`(lambda (y) (+ 4 x))`如果您修复上述问题）`5`来获取`7`（或`(+ 4 5)`评估为`9`）。

# c++ - 在 C++ 中寻找比虚拟继承更好的方法

> ID：249500
> 
> 赞同：4
> 
> 时间：2008-10-30T07:34:39.733
> 
> 标签：c++, inheritance, multiple-inheritance

好的，我在 C++ 中有一个有点复杂的系统。简而言之，我需要向第三方抽象基类添加一个方法。第三方还提供了大量也需要新功能的派生类。

我正在使用一个提供标准 Shape 接口以及一些常见形状的库。

```
class Shape
{
    public:
        Shape(position);
        virtual ~Shape();

        virtual position GetPosition() const;
        virtual void SetPosition(position);

        virtual double GetPerimeter() const = 0;

    private: ...
};

class Square : public Shape
{
    public:
        Square(position, side_length);
    ...
};

class Circle, Rectangle, Hexagon, etc 
```

现在，这是我的问题。我希望 Shape 类也包含一个 GetArea() 函数。所以看起来我应该做一个：

```
class ImprovedShape : public virtual Shape
{
    virtual double GetArea() const = 0;
};

class ImprovedSquare : public Square, public ImprovedShape
{
    ...
} 
```

然后我去做一个继承自ImprovedShape 和Square 的ImprovedSquare。好吧，正如你所看到的，我现在已经创建了可怕的[钻石继承问题](http://en.wikipedia.org/wiki/Diamond_problem)。如果第三方库对其 Square、Circle 等使用[虚拟继承](http://en.wikipedia.org/wiki/Virtual_inheritance)，这将很容易解决。但是，让他们这样做并不是一个合理的选择。

那么，当您需要向库中定义的接口添加一点功能时，您会怎么做？有好的答案吗？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T09:33:33.830

为什么这个类需要从形状派生？

```
class ImprovedShape : public virtual Shape
{
    virtual double GetArea() const = 0;
}; 
```

为什么不只是有

```
class ThingWithArea 
{
    virtual double GetArea() const = 0;
}; 
```

ImprovementSquare 是一个 Shape 并且是一个 ThingWithArea

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T07:44:36.267

我想[外观](http://en.wikipedia.org/wiki/Facade_pattern)模式应该可以解决问题。

将第 3 方接口包装成您自己的接口，并且您的应用程序代码使用包装器接口而不是第 3 方接口。这样，您也可以很好地隔离不受控制的第 3 方界面中的更改。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-30T07:52:35.580

我们在一个项目中遇到了一个非常相似的问题，我们只是通过不从 Shape 派生改进形状来解决它。如果您需要在 ImprovementShape 中使用 Shape 功能，您可以使用 dynamic_cast，因为您知道您的演员将始终有效。其余的就像你的例子一样。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-30T09:48:44.863

也许您应该阅读[正确的继承](http://www.parashift.com/c++-faq-lite/proper-inheritance.html)，并得出结论，ImprovedShape 不需要从 Shape 继承，而是可以将 Shape 用于其绘图功能，类似于第 21.12 点关于 SortedList 如何不必继承的 FAQ 中的讨论from List 即使它想提供相同的功能，它也可以简单地*使用*List。

以类似的方式，ImprovedShape 可以*使用*Shape 来完成它的 Shape 事情。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T09:58:48.197

可能用于装饰器模式？[ [http://en.wikipedia.org/wiki/Decorator_pattern][1]](http://en.wikipedia.org/wiki/Decorator_pattern][1])

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T14:52:12.673

是否可以采用完全不同的方法——使用模板和元编程技术？如果您不限于不使用模板，这可以提供一个优雅的解决方案。只有`ImprovedShape`和`ImprovedSquare`改变：

```
template <typename ShapePolicy>
class ImprovedShape : public ShapePolicy
{
public:
    virtual double GetArea();
    ImprovedShape(void);
    virtual ~ImprovedShape(void);

protected:
    ShapePolicy shape;
    //...
}; 
```

`ImprovedSquare`变成：

```
class ImprovedSquare : public ImprovedShape<Square>
{
public:
    ImprovedSquare(void);
    ~ImprovedSquare(void);

    // ...

}; 
```

您将避免菱形继承，从原始形状（通过策略类）获得继承以及您想要的附加功能。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-11-02T11:21:38.430

Dave Hillier 的方法是正确的。分离`GetArea()`成自己的界面：

```
class ThingWithArea
{
public:
    virtual double GetArea() const = 0;
}; 
```

如果 Shape 的设计者做了正确的事情并把它变成了一个纯接口，并且具体类的公共接口足够强大，你就可以将具体类的实例作为成员。这就是你如何得到`SquareWithArea` (`ImprovedSquare`是一个糟糕的名字) a`Shape`和 a `ThingWithArea`：

```
class SquareWithArea : public Shape, public ThingWithArea
{
public:
    double GetPerimeter() const { return square.GetPerimeter(); }
    double GetArea() const { /* do stuff with square */ }

private:
    Square square;
}; 
```

不幸的是，`Shape`设计者在 中进行了一些实现`Shape`，最终您将携带两个副本`SquareWithArea`，就像您最初提出的钻石一样。

这几乎迫使您进入最紧密耦合，因此也是最不可取的解决方案：

```
class SquareWithArea : public Square, public ThingWithArea
{
}; 
```

如今，从 C++ 中的具体类派生被认为是不好的形式。很难找到一个很好的解释为什么你不应该这样做。通常，人们会引用 Meyers 的《更有效的 C++ 条款 33》，其中指出不可能写出像样`operator=()`的东西。那么，您可能永远不应该为具有值语义的类这样做。另一个陷阱是具体类没有虚拟析构函数（这就是为什么你永远不应该公开从 STL 容器派生的原因）。在这里都不适用。居高临下送你去C++ faq学习继承的发帖人是错的——加`GetArea()`不违反 Liskov 可替代性。我能看到的唯一风险来自在具体类中重写虚函数，当实现者后来更改名称并默默地破坏您的代码时。

综上所述，我认为你可以问心无愧地从 Square 衍生出来。（作为安慰，您不必为 Shape 接口编写所有转发函数）。

现在解决需要两个接口的功能问题。我不喜欢不必要`dynamic_cast`的 s。相反，让函数引用两个接口，并在调用站点为两个接口传递对同一对象的引用：

```
void PrintPerimeterAndArea(const Shape& s, const ThingWithArea& a)
{
    cout << s.GetPerimeter() << endl;
    cout << a.GetArea() << endl;
}

// ...

SquareWithArea swa;
PrintPerimeterAndArea(swa, swa); 
```

所有`PrintPerimeterAndArea()`需要做的工作都是周长和面积的来源。它不关心这些碰巧在同一个对象实例上实现为成员函数。可以想象，该区域可以由它和`Shape`.

这使我们遇到了唯一一种我会考虑传入一个引用并通过另一个引用获得另一个的情况`dynamic_cast`——这两个引用指向同一个对象实例很重要。这是一个非常人为的例子：

```
void hardcopy(const Shape& s, const ThingWithArea& a)
{
    Printer p;
    if (p.HasEnoughInk(a.GetArea()))
    {
        s.print(p);
    }
} 
```

即使那样，我可能更愿意发送两个参考而不是 `dynamic_cast`. 我将依靠一个健全的整体系统设计来消除将两个不同实例的位提供给这样的功能的可能性。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-02T12:47:49.707

另一种关于元编程/mixin 的尝试，这一次有点受特征的影响。它假定计算面积是您要根据暴露的属性添加的东西；你可以做一些保持封装的事情，这是一个目标，而不是模块化。但是你必须为每个子类型编写一个 GetArea，而不是尽可能使用多态的。这是否值得取决于您对封装的承诺程度，以及您的库中是否有可以利用常见行为的基类，例如下面的*RectangularShape*

```
#import <iostream>

using namespace std;

// base types
class Shape {
    public:
        Shape () {}
        virtual ~Shape () { }
        virtual void DoShapyStuff () const = 0;
};

class RectangularShape : public Shape {
    public:
        RectangularShape () { }

        virtual double GetHeight () const = 0 ;
        virtual double GetWidth  () const = 0 ;
};

class Square : public RectangularShape {
    public:
        Square () { }

        virtual void DoShapyStuff () const
        {
            cout << "I\'m a square." << endl;
        }

        virtual double GetHeight () const { return 10.0; }
        virtual double GetWidth  () const { return 10.0; }
};

class Rect : public RectangularShape {
    public:
        Rect () { }

        virtual void DoShapyStuff () const
        {
            cout << "I\'m a rectangle." << endl;
        }

        virtual double GetHeight () const { return 9.0; }
        virtual double GetWidth  () const { return 16.0; }
};

// extension has a cast to Shape rather than extending Shape
class HasArea {
    public:
        virtual double GetArea () const = 0;
        virtual Shape& AsShape () = 0;
        virtual const Shape& AsShape () const = 0;

        operator Shape& ()
        {
            return AsShape();
        }

        operator const Shape& () const
        {
            return AsShape();
        }
};

template<class S> struct AreaOf { };

// you have to have the declaration before the ShapeWithArea 
// template if you want to use polymorphic behaviour, which 
// is a bit clunky
static double GetArea (const RectangularShape& shape)
{
    return shape.GetWidth() * shape.GetHeight();
}

template <class S>
class ShapeWithArea : public S, public HasArea {
    public:
        virtual double GetArea () const
        {
            return ::GetArea(*this);
        }
        virtual Shape& AsShape ()             { return *this; }
        virtual const Shape& AsShape () const { return *this; }
};

// don't have to write two implementations of GetArea
// as we use the GetArea for the super type
typedef ShapeWithArea<Square> ImprovedSquare;
typedef ShapeWithArea<Rect> ImprovedRect;

void Demo (const HasArea& hasArea)
{
    const Shape& shape(hasArea);
    shape.DoShapyStuff();
    cout << "Area = " << hasArea.GetArea() << endl;
}

int main ()
{
    ImprovedSquare square;
    ImprovedRect   rect;

    Demo(square);
    Demo(rect);

    return 0;
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-09-29T16:40:27.410

GetArea() 不必是成员。它可以是模板函数，以便您可以为任何形状调用它。

就像是：

```
template <class ShapeType, class AreaFunctor> 
int GetArea(const ShapeType& shape, AreaFunctor func); 
```

STL [min](http://www.cplusplus.com/reference/algorithm/min/)，[max](http://www.cplusplus.com/reference/algorithm/max/)函数可以被认为是您的案例的类比。给定比较器函数，您可以找到对象数组/向量的最小值和最大值。同样，只要提供计算面积的函数，您就可以得出任何给定形状的面积。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-19T12:21:38.763

正如我所理解的那样，您的问题存在解决方案。使用[addapter-pattern](http://en.wikipedia.org/wiki/Adapter_pattern)。适配器模式用于向**特定类添加功能或交换特定行为**（即方法）。考虑到您绘制的场景：

```
class ShapeWithArea : public Shape
{
 protected:
  Shape* shape_;

 public:
  virtual ~ShapeWithArea();

  virtual position GetPosition() const { return shape_->GetPosition(); }
  virtual void SetPosition(position)   { shape_->SetPosition(); }
  virtual double GetPerimeter() const  { return shape_->GetPerimeter(); }

  ShapeWithArea (Shape* shape) : shape_(shape) {}

  virtual double getArea (void) const = 0;
}; 
```

适配器模式旨在适应类的行为或功能。你可以用它来

*   **通过不转发而是重新实现方法来改变类的行为。**
*   **通过添加方法向类添加行为。**

它如何改变行为？当你为方法提供一个 base 类型的对象时，你也可以提供适配的类。对象将按照您的指示行事，对象上的参与者只关心基类的接口。**您可以将此适配器应用于 Shape 的任何派生项。**

# scheme - 为什么这个 Scheme 平方和函数不起作用？

> ID：249506
> 
> 赞同：1
> 
> 时间：2008-10-30T07:37:49.010
> 
> 标签：scheme

```
(define (square x)
  (display (* x x)))

(define (sum-of-squares a b) 
  (+ (square a) (square b))) 
```

我测试了一下，这个`sum-of-squares`功能不起作用。为什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-30T07:43:17.003

`(display x)`评估为 void（可以被视为无）。这是一个打印出参数但不返回参数的函数调用。相反，您应该定义 square 函数来评估值而不显示，即：

```
(define (square x)
  (* x x)) 
```

# c# - 使用 windows mobile 6.0 获取智能手机/ppc 上的联系信息？

> ID：249507
> 
> 赞同：1
> 
> 时间：2008-10-30T07:38:06.623
> 
> 标签：c#, windows-mobile

在 C# 应用程序中，我想获取手机所有联系人的列表。

我不知道是否已经存在一个开箱即用的类。如果没有，我想知道如何访问这些信息。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T11:17:54.010

您需要使用[POOM](http://msdn.microsoft.com/en-us/library/aa914277.aspx "MSDN 链接")。

# java - 当使用带有 FindBugs 的 Eclipse 时，您能否将错误标记为非错误并将其从错误列表中删除？

> ID：249536
> 
> 赞同：18
> 
> 时间：2008-10-30T08:03:56.023
> 
> 标签：java, eclipse, findbugs

FindBugs 在我的代码中发现了一个潜在的错误。但这不是错误。

是否可以将此事件标记为“不是错误”并将其从错误列表中删除？

我已经非常清楚地记录了为什么每种情况都不是错误。

例如。一个类实现了类似的接口。它有 compareTo 方法。但是，我没有覆盖 equals 方法。

FindBugs 不喜欢这样，因为 JavaDocs 声明建议

```
(x.compareTo(y)==0) == (x.equals(y)) 
```

尽管在我的情况下，上述条件是并且永远都是正确的。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-10-30T08:18:58.913

除了使用过滤器，您还可以使用[SuppressWarnings](http://findbugs.sourceforge.net/api/edu/umd/cs/findbugs/annotations/SuppressWarnings.html "抑制警告")注释。您必须使用 findbugs 包中的注释，这意味着您需要导入或使用它的完全限定名称。这是因为除了来自 JDK 的[SuppressWarnings](http://java.sun.com/javase/6/docs/api/java/lang/SuppressWarnings.html)之外，它还具有保留“类”，这是必需的，因为 findbugs 对已编译的字节码而不是源代码进行操作。

例子：

```
@edu.umd.cs.findbugs.annotations.SuppressWarnings(
    value="EQ_COMPARETO_USE_OBJECT_EQUALS", 
    justification="because I know better") 
```

在一种极端情况下，您可能不应该使用注解：如果您的代码是库代码，最终放在一个 jar 中，那么其他项目可以使用它，**而**您仍在使用 Java5。原因是 JDK 中的一个[错误](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6365854)，如果注释不在类路径中，则会导致 javac 崩溃。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-30T08:09:24.627

可能是通过添加[过滤器](http://findbugs.sourceforge.net/manual/filter.html)作为 findbugs 的参数

> 匹配子句只能匹配错误实例中实际包含的信息

```
<Match>
   <Class name="com.foobar.MyClass" />
   <Method name="myMethod" />
   <Bug pattern="EQ_COMPARETO_USE_OBJECT_EQUALS" />
</Match> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T09:04:37.697

另一方面 - 如果您使用这种自动代码审查工具，根据广为人知的建议突出潜在问题，也许您应该遵守它的建议？想想那些将在你之后维护代码的人。

如果代码在一段时间后发生变化怎么办？

# c# - 如何出示凭据以打开文件？

> ID：249540
> 
> 赞同：8
> 
> 时间：2008-10-30T08:06:22.073
> 
> 标签：c#, .net, security, filesystems

如何指定用户名和密码以便我的程序打开文件进行读取？需要访问文件的程序是从一个对文件所在文件夹没有读取权限的帐户运行的。程序是用 C# 和 .NET 2 编写的，在 XP 下运行，文件位于 Windows Server 2003 机器上。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-30T08:41:05.577

您想模拟一个有权访问该文件的用户。

我建议使用这样的类 - [http://www.codeproject.com/KB/cs/zetaimpersonator.aspx](http://www.codeproject.com/KB/cs/zetaimpersonator.aspx)。它隐藏了所有令人讨厌的模拟实现。

```
using (new Impersonator("myUsername", "myDomainname", "myPassword"))
{
  string fileText = File.ReadAllText("c:\test.txt");
  Console.WriteLine(fileText);
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2016-02-18T21:41:37.513

我用过 Nuget 包[NuGet Gallery | Simple Impersonation Library 1.1.0](https://www.nuget.org/packages/SimpleImpersonation)但还有其他；在模仿中搜索其他人。

使用交互式登录处理文件结构的示例用法：

```
using (Impersonation.LogonUser("{domain}",
                               "{UserName}", 
                               "{Password}", 
                               LogonType.Interactive))
{
     var directory = @"\\MyCorpServer.net\alpha\cars";

     Assert.IsTrue(Directory.Exists(directory));
} 
```

* * *

*詹姆斯在下面的回答是在 Nuget 之前以及他后来在 Nuget 上下载最多的软件包之前。讽刺吧？*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T08:21:43.867

您可以冒充具有必要权限的用户。[MSDN 上](http://msdn.microsoft.com/en-us/library/b80a7e92.aspx)有一篇文章描述了如何执行此操作。

# iis - Windows XP 上的 IIS

> ID：249545
> 
> 赞同：2
> 
> 时间：2008-10-30T08:12:31.857
> 
> 标签：iis, vbscript, windows-xp

是否可以在 IIS 5.1 (Windows XP) 上运行多个网站？

我可以通过 IIS 中的管理员脚本创建多个网站，但一次只能激活一个网站。

是否有针对此限制的解决方法、技巧或脚本？

谢谢，

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T08:17:28.040

据我所知，您一次只能激活一个，但请参阅Jeff 的[此链接](http://www.codinghorror.com/blog/archives/000329.html)以获取有关如何解除 IIS 的更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T14:54:09.543

检查您创建的每个网站的端口号，默认情况下，您将获得端口号 80。但在这里，如果您没有应用程序的主机头，那么您必须创建每个网站，每个网站的每个端口号都不是 80、8080、8081 等并尝试。

# function - Scheme中函数的重复应用？

> ID：249557
> 
> 赞同：2
> 
> 时间：2008-10-30T08:19:51.000
> 
> 标签：function, scheme

> 如果f是一个数值函数，n是一个正整数，那么我们可以形成f的第n次重复应用，它被定义为在x处的值为f(f(...(f(x)))的函数。 ..））。例如，如果 f 是函数 x + 1，则 f 的第 n 次重复应用是函数 x + n。如果 f 是一个数的平方运算，则 f 的第 n 次重复应用是将其参数提高到 2^n 次方的函数。编写一个过程，将计算 f 和正整数 n 的过程作为输入，并返回计算 f 的第 n 次重复应用的过程。您的程序应该能够按如下方式使用：
> 
> ```
> ((repeated square 2) 5)
> 625 
> ```
> 
> 您可以使用它来简化答案：
> 
> ```
>  (define (compose f g) (lambda (x) (f (g x)))) 
> ```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-05T10:59:00.807

```
(define (repeated f n)
  (if (= n 1)
      f
      (compose f (repeated f (- n 1))))) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T08:24:48.837

您是否刚刚删除并重新提出了这个问题？我在这里复制我以前的答案（谢天谢地，我的浏览器已经缓存了它）：

好吧，你可能想要这样的东西，对吧？

```
((repeated square 3) 5)
-> (square ((repeated square 2) 5))
-> (square (square ((repeated square 1) 5)))
-> (square (square (square ((repeated square 0) 5))))
-> (square (square (square (identity 5)))) 
```

（不知道Scheme中是否预定义了identity，如果没有，写起来很容易。）

现在，这不是直接可重现的，因为您无法将代码神奇地包含在对任意内容重复的调用之外。但是，当使用 compose 重写时，这些缩减步骤是什么样的？你能在生成的步骤列表中找出一个模式并重现它吗？

# php - PHP 是否会继续在主要版本发布时进行重大更改？

> ID：249558
> 
> 赞同：0
> 
> 时间：2008-10-30T08:21:41.853
> 
> 标签：php, language-features

所以我从第 4 版开始使用 PHP，并且不得不切换到第 5 版。现在我知道第 6 版即将推出，并且已经重新考虑了很多事情。

这些变化可能是好的，但在未来，有人知道 PHP 的路线图吗？它看起来会变平吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T09:29:41.123

PHP 的历史是，他们不会在没有充分理由的情况下实施重大更改。我一直看到我必须做的工作移植到新的 PHP 版本的好处。因此，我实际上认为开发人员在需要完成时不害怕破坏事情是一件好事。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T08:23:02.680

没有人知道 PHP 路线图，即使是核心开发人员也不知道。

编辑：为了避免误解，我的意见是基于 PHP 邮件列表，开发人员在其中讨论可能的新功能、它们将如何实现以及何时计划。如果你看一下它，你会发现这些信息有多不稳定以及它们多久改变一次。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T12:16:24.160

如果不引入重大更改，发布主要版本的原因是什么？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T09:17:09.183

我在想，这有关系吗？为什么您担心 PHP 7 中会发生什么？它不会影响您现在在 PHP 5 中所做的事情。到目前为止，开发人员一直很擅长维护旧版本的软件，而且这似乎不会改变。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-10-30T09:10:21.587

我真的很害怕这个。我喜欢 php，并且花了很多时间来精通 php。看到开发人员不知道他们到底在做什么，也不知道他们为什么以这种或那种方式实现这个或那个，这令人悲伤和恐惧。我希望将来他们对php有一个清晰的认识。我真的很喜欢 php 5 和它的所有 oop 功能 :) 我正在做一个小框架，只是为了尝试了解更多的 php。希望我在这个小框架上的所有工作都能取得一些成就:)

# svn - Perforce 有什么优势？

> ID：249565
> 
> 赞同：25
> 
> 时间：2008-10-30T08:24:51.990
> 
> 标签：svn, version-control, perforce

Perforce 有什么好处？

我很想了解 Perforce 如何在特定情况下比 Subversion 更好地工作。

如果您有使用 Perforce 和 Subversion 的经验，并且您不相信有任何优势，或者认为 svn 比 Perforce 有优势，我也想知道为什么。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-10-30T09:01:08.390

我与 Perforce 以及 Clearcase、Sourcesafe、RCS、PVCS、CVS 和 Subversion 合作多年。最近我也开始使用 GIT。

根据这次经验，我认为，对于大多数用途，Perforce 是商业环境中最好的版本控制系统。虽然最初不像 Subversion 那样简单，但它具有许多更强大的功能，尤其是在分支和合并方面。“默认锁定”方法通常更适合这种环境。

对于个人资料、小型协作项目、小型初创企业或开源项目，我发现 Subversion 在许多情况下更适合。他们有不同的方法，不同的工作方式。你不能只是把它们按比例排列，然后说哪个是最好的。

那就是说我讨厌 ClearCase。ClearCase 通常是从上面强制下来的（即管理决策）。

对于 Subversion 胜过 Perforce 的许多情况，如今许多人似乎更喜欢 GIT、Bazaar、Mercurial 等分布式系统。从我对 GIT 的了解来看，他们很可能是对的，我相信其他海报也会证明这一点。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-10-30T16:41:08.057

Perforce 的一大卖点是速度。服务器跟踪客户端上文件的状态；因此，诸如“获取仓库的最新状态”之类的操作是微不足道的——服务器已经知道您拥有哪些文件，并且它可以将最少量的信息发送回您。

这个优点也带来了一个缺点，如果你在本地编辑文件而不先检查它们，在本地移动文件而不执行集成，或者在本地删除文件，服务器和客户端可能会不同步。

因为 Perforce 服务器只向客户端发送最少量的数据，所以 Perforce 在慢速链接上表现良好，例如美国的客户端访问伦敦的仓库的情况。话虽如此，Perforce 协议相对“健谈”，因此很容易因拥塞链接而减速。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-07-29T09:26:01.193

我每天在工作中使用 perforce，我不会向任何人推荐它。我敢肯定它可能*是*多年来最好的 SCM，但它的核心模型已经过时了。

Perforce 可能是我用过的*最集中的 SCM 系统。*想象一下，他们为没有在您的磁盘上缓存任何内容而感到自豪。进行同步很烦人，因为在很多情况下，除非您不进行强制同步，否则它什么也不会做 - 并且强制同步确实会将所有内容从服务器复制回您 - 如果您的项目是 10GB，它将复制所有内容.

我以前有使用 SourceSafe、CVS、SVN、Mercurial 和 git 的经验（后两者较少）。

我认为大多数开源 SCM 都是成熟的，您可以选择其中之一。如果你想要集中的东西，就选择 SVN，如果你想要分散的东西，使用 Mercurial（我在 Windows 上使用 git 的经历很糟糕）。

我在 perforce 上遇到的其他一些问题：

*   你提交的不是你得到的：例如，如果你在 Intel Mac 上提交一个 UTF16 文件并从另一个 PPC Mac 同步它，你会得到另一个 UTF16 文件，因为 perforce 很聪明，并且确实将你的文件转换为客户端字节-订购。UTF16-BE - UTF16-LE？！
*   perforce 的脚本编写难度是其他工具的 10 倍。
*   如果您开始使用它并通过脚本将其与您的流程联系起来，您可能会死于它，因为一切都是以 perforce 方式和 perforce 方式完成的:(
*   很容易关闭 p4 服务器的图像：只需在项目的根目录上进行同步。在我工作的地方，这是不允许的，因为它会导致发球失败！有一个监视脚本正在监视 perforce 服务器进程，如果其中一个正在占用 x GB 的 RAM，它会杀死它并向您发送通知。是的，在客户端执行一个简单的命令，可以在 5-10 秒内在服务器上创建一个 3GB 的进程。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-30T08:47:59.103

Perforce 的模型与 svn 有点不同。每个文件始终锁定在您的工作副本中，您必须声明强制您开始编辑它。例如，这样做的好处是您可以随时查看还有谁在处理文件。

总而言之，与其他 SCM 的差异并不是很大。你在很多地方都会遇到 Perforce，因为它曾经是少数（如果不是唯一的）部分体面的 SCM 之一，可以在 Windows 和 Mac 上运行。

如果我没记错的话，您可以在有限数量的客户中免费使用它，这样您就可以毫无痛苦地试用它......

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-10-30T08:27:55.400

就个人而言，我鄙视强制执行。它的用户界面很糟糕，很复杂，而且根本不直观。它是越野车并且经常崩溃。

我以前使用过 SVN（通过 Tortoise SVN），发现它更加简单和友好。

当然所有这些都是从用户的角度来看，可能SCM有不同的角度

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-30T09:19:29.990

您可能会在[使用 Perforce 而不是 Subversion 的好处是什么中找到提示？](https://stackoverflow.com/questions/157429/what-are-the-benefits-of-using-perforce-instead-of-subversion "使用 Perforce 而不是 Subversion 有什么好处？")（只需按照您的 Perforce 标签...）。

我们在工作中使用 Perforce，虽然我对各种 SCM 软件几乎没有经验，但我发现这个做得很好，具有良好的 GUI（在 Windows 上）、良好的命令行支持、许多不错的功能......可能需要一段时间才能完成习惯它的逻辑，但我认为对于大多数 SCM 来说可能都是正确的。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-30T08:47:30.320

Perforce 支持锁定，并且对于某些无法合并的文件类型（二进制资源、思考图像等）似乎需要它。但是，它*不需要*对普通源文件进行锁定，这些源文件可以被多个用户同时打开进行编辑，然后合并回软件仓库。

我发现 Perforce 的系统带有“更改列表”，该组更改为多个文件并将它们视为一个单元，很好。我相信你可以用 SVN 做一些类似的事情，但它并不是那么容易开箱即用。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-30T08:38:21.120

我同意之前的 Yuval - 在 GUI 和命令行模式下使用过 Perforce 和 svn，我更喜欢 svn。然而，我当时工作的公司从它使用的免费 cvs 切换到了 Perforce。它的 GUI 更加华丽。我认为它的提交模型是不同的——它使用锁定，这可能比某些开发人员/经理更可取。在商业环境中，为您的版本控制工具配备支持人员也可能会有所帮助。我听说在一些大公司中，在生产环境中使用开源代码是被禁止的，因为他们希望能够获得对每一行代码的支持。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2014-12-20T05:28:02.373

Perforce 服务器可以**在客户端读取和写入任意文件，从而执行任意代码。**Perforce 配置都是服务器端的，因此服务器可以简单地将客户端计算机的整个硬盘视为存储库，并**对其进行任何操作。**

除非在 SELinux 沙箱中，否则永远不要运行 Perforce。

**记住：Perforce 客户端是服务器的傀儡。**您必须使用操作系统的安全功能来防止它做您不希望它做的事情。**始终将 Perforce 客户端视为敌对。**

# c# - 避免从 C# 代码对 MSSQL Server 进行 SQL 注入的算法？

> ID：249567
> 
> 赞同：11
> 
> 时间：2008-10-30T08:25:25.687
> 
> 标签：c#, .net, sql-server, security

在 C#.net 平台上避免 SQL 注入的最佳方法是什么。

如果有的话，请发布 C# 实现。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-30T08:36:26.787

不需要任何算法——只是不要使用字符串连接来构建 SQL 语句。请改用 SqlCommand.Parameters 集合。这会完成所有必要的值转义（例如替换`'`为`''`）并确保命令是安全的，因为其他人（即微软）已经完成了所有测试。

例如调用存储过程：

```
using (var connection = new SqlConnection("..."))
using (var command = new SqlCommand("MySprocName", connection))
{
    command.CommandType = CommandType.StoredProcedure;
    command.Parameters.AddWithValue("@Param1", param1Value);
    return command.ExecuteReader();
} 
```

这种技术也适用于内联 SQL 语句，例如

```
var sql = "SELECT * FROM MyTable WHERE MyColumn = @Param1";
using (var connection = new SqlConnection("..."))
using (var command = new SqlCommand(sql, connection))
{
    command.Parameters.AddWithValue("@Param1", param1Value);
    return command.ExecuteReader();
} 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-10-30T13:54:04.587

为了安全起见，我们可以做的 10 件大事（没有一件能做到这一切。）

1.  采用“所有数据都是邪恶的”这一概念。所有数据，甚至存储在数据库或我们的文件系统中的数据都是可疑的。不仅仅是来自我们防火墙之外的应用程序的数据输入，如查询字符串、表单字段、cookie 等。任何东西都可以用来破坏系统。

2.  不要依赖 javascript 或 html 字段长度的客户端验证，甚至是使用客户端验证的服务器端 Web API。使用它来提高可用性，但不要依赖它作为唯一的保护。了解 NET 等 API 提供的验证器如何工作。不要认为它们是理所当然的。有一些方法可以绕过它们。

3.  进行正匹配以捕获所有数据。如果数据匹配正则表达式的字符范围，那么没关系。这不允许奇怪的 unicode 字符进入我们的数据库，这些字符可能会意外地在 sql 中划定某些内容或产生其他问题，例如同形 XSS/网络钓鱼攻击。相比之下，负匹配需要所有坏字符的列表，这些坏字符似乎一直在增长。这是一个不好的方法。正向匹配更好。我们拒绝不良数据，不清理或逃避它。

4.  如果可能，请考虑使用“update”、“delete”、“drop”、“select”、“alter”等过滤、标记或捕获字符串数据。考虑到字符串的性质，这可能是不可能的。“1212 Lemondrop Ln”、“Waltersburg, PA”和“Table Rock, NE”是有效的地址字段。每天对所有表数据进行扫描以查找与其中任何一个匹配的字段可能会发现延迟攻击或漏洞。当数据传入时，还可以使用日志记录、IP 禁止、电子邮件警报等。

5.  尽可能使用存储过程和/或参数化查询。避免在 db 客户端代码和 sql 中使用动态 sql。（避免在存储过程中使用带有外部部分的动态代码的 exec 语句！！！）参数化将转义字符串终止符，如撇号、捕获字段长度和类型检查。我们不能总是依赖提供完美参数化的 API，但它们是由比我们大多数人更了解数据库特性的人编写的。

6.  确保没有杂散代码存在于世界可读/可执行的 Web 目录中。如果它不是活动站点的一部分，请将其存档在安全的地方并将其从公众视野中删除。未使用的存储过程也是如此。

7.  及时了解数据库 API。在某些 API 中执行 SQL 语句的某些方式不如其他方式安全。

8.  使用单向加密安全地存储密码。这样，用户名和密码的表转储仍然应该让人们远离。

9.  以所有常用方式强化服务器。例如，在可能的情况下，对数据库表授予最低权限。将 Web 服务器数据库帐户的访问权限严格限制在相关表中。尽可能使用只读。创建多个帐户，在公共流量和内部/受信任流量的访问权限之间产生鸿沟。

10.  优雅地捕捉错误。这适用于所有代码，而不仅仅是使用数据库的代码。然而，Sql 注入攻击确实依赖于错误消息，因此希望尽可能多地向公众隐藏数据库。始终以原始方式编写处理异常或空数据集的代码，以尽可能少地透露我们正在使用的数据库类型、表中的字段或我们正在运行的查询类型。在服务器上记录错误。即使在非数据库代码中，最好对第三方组件、文件夹结构、我们可能正在运行的其他服务等保持沉默。向恶意用户提供尽可能少的信息是让他们毫无头绪的关键。

And #11, always revisit/revise this list. Always be up to date. Be proactive. Make it an upfront priority and requirement, not an after thought.

# linux - 如何在 GNU/Linux 中记录正在使用磁盘的进程或内核活动？

> ID：249570
> 
> 赞同：15
> 
> 时间：2008-10-30T08:25:52.877
> 
> 标签：linux, io, gnu, disk

在特定的 Debian 服务器上，iostat（和类似服务器）报告了异常高的磁盘写入量（以字节为单位）。我无法确定哪个进程正在执行这些写入。

两个有趣的点：

1.  尝试一次关闭一项系统服务，但无济于事。磁盘活动保持相当稳定并且出乎意料地高。

2.  尽管进行了写入，但似乎并没有在磁盘上消耗更多的整体空间。

这两个都让我认为写作可能是内核正在做的事情，但我没有交换，所以我不清楚 Linux 可能会尝试写什么。

可以试试：

[http://www.atcomputing.nl/Tools/atop/](http://www.atcomputing.nl/Tools/atop/)

但想避免修补我的内核。

关于如何追踪这一点的任何想法？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-08T08:03:02.553

iotop 很好（实际上很棒）。

如果您拥有 2.6.20 之前的内核，则无法使用这些工具中的大多数。

相反，您可以尝试以下方法（几乎适用于任何 2.6 内核 IIRC）：

```

须藤-s
dmesg -c
/etc/init.d/klogd 停止
回声 1 > /proc/sys/vm/block_dump
rm /tmp/磁盘日志
观看“dmesg -c >> /tmp/disklog”
   完成收集数据后按 CTRL-C
回声 0 > /proc/sys/vm/block_dump
/etc/init.d/klogd 启动
退出（退出根外壳）

猫/tmp/磁盘日志| awk -F"[() \t]" '/(READ|WRITE|dirtied)/ {activity[$1]++} END {for (x in activity) print x, activity[x]}'| 排序 -nr -k2

```

dmesg -c 行清除您的内核日志。然后关闭记录器，手动（使用 watch）转储到磁盘（内存缓冲区很小，这就是我们需要这样做的原因）。让它运行大约五分钟左右，然后 CTRL-c 监视进程。关闭日志并重新启动 klogd 后，使用最后的一点点 awk 分析结果。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-27T20:17:45.507

如果您使用的是比 2.6.20 更新的内核，那非常容易，因为这是包含 I/O 记帐的 Linux 内核的第一个版本。如果您正在编译自己的内核，请确保包括：

```
CONFIG_TASKSTATS=y
CONFIG_TASK_IO_ACCOUNTING=y 
```

Debian 软件包中的内核已经包含这些标志，因此无需重新编译内核。用于实时访问 I/O 记帐数据的标准实用程序是 iotop(1)。它为您提供由 I/O 调度程序管理的进程的完整列表，并显示每个进程的读取、写入和使用的总 I/O 带宽的统计信息。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T12:39:01.150

您可能想研究**iotop for Linux**。有一些 Solaris 版本随处可见，但例如有一个 Debian 软件包。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-08-03T07:59:08.900

[Brendan Gregg 的 iosnoop](https://github.com/brendangregg/perf-tools/blob/master/iosnoop)脚本可以（启发式地）告诉您当前在最近的内核上使用磁盘（[例如 iosnoop 输出](http://www.brendangregg.com/blog/2014-07-16/iosnoop-for-linux.html)）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T08:42:41.610

您可以使用 UNIX 命令**lsof**（列出打开的文件）。这会打印出任何打开文件的进程、进程 ID、用户。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-21T10:05:09.503

您也可以使用**htop**，启用 IO_RATR 列。Htop 是一个出色的顶部替代品。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T08:28:18.440

您可以尝试使用[SystemTap](http://sourceware.org/systemtap/)，它有很多示例，如果我没记错的话，它显示了如何做这种事情。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-17T00:59:02.473

我最近听说了一个 Filemon 克隆的 Mortadelo，但我自己还没有检查过：

[http://gitorious.org/mortadelo](http://gitorious.org/mortadelo)

# c# - 数据库队列的并行处理

> ID：249573
> 
> 赞同：4
> 
> 时间：2008-10-30T08:28:14.697
> 
> 标签：c#, sql-server-2005, distributed-system

有一个小型系统，其中一个数据库表作为 MSSQL 2005 上的队列。几个应用程序正在写入该表，一个应用程序正在以 FIFO 方式读取和处理。

我必须让它更高级一点，才能创建一个分布式系统，在其中可以运行多个处理应用程序。结果应该是2-10个处理应用程序应该能够运行并且它们在工作期间不应相互干扰。

我的想法是用一行显示一个进程已经在处理它来扩展队列表。处理应用程序将首先使用它的标识符更新表，然后请求更新的记录。

所以是这样的：

```
start transaction
update top(10) queue set processing = 'myid' where processing is null
select * from processing where processing = 'myid'
end transaction 
```

处理后，它将表的处理列设置为其他内容，例如“完成”或其他内容。

我对这种方法有三个问题。

第一：这可以以这种形式工作吗？

第二：如果有效，是否有效？您还有其他想法来创建这样的发行版吗？

第三：在 MSSQL 中，锁定是基于行的，但是在锁定一定数量的行之后，锁定会扩展到整个表。所以第二个应用程序不能访问它，直到第一个应用程序不释放事务。为了不锁定整个表，只创建行锁，选择（top x）可以有多大？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T09:05:27.897

这会起作用，但您可能会发现在多个进程尝试读取/更新相同数据的情况下，您会遇到阻塞或死锁。我为我们的一个系统编写了一个程序来做到这一点，它使用一些有趣的锁定语义来确保这种类型的东西在没有阻塞或死锁的情况下运行，[描述在这里](http://gregbeech.com/blog/retrieving-a-row-exactly-once-with-multiple-polling-processes-in-sql-server)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T08:54:14.910

这种方法对我来说看起来很合理，并且与我过去使用的方法相似——成功。

此外，行/表只会在更新和选择操作发生时被锁定，所以我怀疑行与表问题是否真的是一个主要考虑因素。

除非您的应用程序的处理开销低到可以忽略不计，否则我会保持“最高”值较低 - 可能只有 1。当然这完全取决于您的应用程序的细节。

说了这么多，我不是 DBA，所以也会对任何更多专家的答案感兴趣

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T09:46:02.387

关于您关于锁定的问题。您可以使用锁定提示强制它仅锁定行

```
update mytable with (rowlock) set x=y where a=b 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-25T04:15:57.887

这种方法的最大问题是您增加了对表的“更新”次数。尝试仅使用一个进程（更新 + 删除）和其他进程在表中插入数据，您会发现大约有一百万条记录时，它开始崩溃。

我宁愿有一个数据库消费者，并使用消息队列将处理数据传递给其他消费者。

# windows - shell\command\open 值的语法 - %1 vs %l vs %L

> ID：249577
> 
> 赞同：8
> 
> 时间：2008-10-30T08:30:34.223
> 
> 标签：windows, shellexecute

我在工作中开发的程序之一是读取注册表以弄清楚如何打开从另一个应用程序提供的文件（我们没有使用 ShellExecute，因为我们需要处理 id，我没有仔细查看 ShellExecuteEx足以看到它提供了进程句柄，无论如何现在为时已晚）。它已经工作了，所以这更多是为了我自己的启迪，但是有谁知道为什么有些条目使用 %l 或 %L 而不是 %1？至少对于“%l”，它可能是一个错字，但“%L”似乎不太可能。事实上，媒体播放器在各种音频文件的打开命令中使用“%L”。我很确定它与 %1 的含义相同，只是因为我想不出它可能是什么。

我目前最喜欢的理论是关于 l 和 1 如何容易混淆的笑话。或者它可以代表“位置”，但这会很蹩脚:)

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-10-30T09:15:01.560

在某些旧系统（Win95、WinNT4）上，使用 %1 可能会给出短路径，使用 %L 总是会给出长路径...

# bash - 如何删除超过 X 小时的文件

> ID：249578
> 
> 赞同：228
> 
> 时间：2008-10-30T08:31:20.773
> 
> 标签：bash

我正在编写一个需要删除旧文件的 bash 脚本。

它目前使用：

```
find $LOCATION -name $REQUIRED_FILES -type f -mtime +1 -delete 
```

这将删除超过 1 天的文件。

但是，如果我需要 1 天的更精细的分辨率，比如 6 小时前，该怎么办？有没有一种干净的方法，比如使用 find 和 -mtime？

* * *

## 回答 #1

> 赞同：346
> 
> 时间：2008-10-30T08:39:01.697

你[`find`](http://man7.org/linux/man-pages/man1/find.1.html)有`-mmin`选择吗？这可以让您测试自上次修改以来的分钟数：

```
find $LOCATION -name $REQUIRED_FILES -type f -mmin +360 -delete 
```

或者也许看看用[`tmpwatch`](http://linux.about.com/library/cmd/blcmdl8_tmpwatch.htm)做同样的工作。phjr 也在[`tmpreaper`](http://linux.about.com/cs/linux101/g/tmpreaper.htm)评论中推荐。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2018-02-20T14:36:05.943

这是对我有用的方法（我没有看到它在上面使用）

```
$ find /path/to/the/folder -name '*.*' -mmin +59 -delete > /dev/null 
```

删除所有超过 59 分钟的文件，同时保持文件夹完好无损。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-10-30T08:51:22.013

您可以使用这个技巧：1 小时前创建一个文件，然后使用`-newer file`参数。

（或使用`touch -t`创建这样的文件）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T08:37:26.300

-mmin 是分钟。

尝试查看手册页。

```
man find 
```

更多类型。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-02T11:37:10.040

对于 SunOS 5.10

```
 Example 6 Selecting a File Using 24-hour Mode

 The descriptions of -atime, -ctime, and -mtime use the  ter-
 minology n ``24-hour periods''. For example, a file accessed
 at 23:59 is selected by:

   example% find . -atime -1 -print

 at 00:01 the next day (less than 24 hours  later,  not  more
 than one day ago). The midnight boundary between days has no
 effect on the 24-hour calculation. 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2020-04-16T10:06:50.673

如果一个人`find`没有，`-mmin`并且如果一个人也坚持`find`只接受整数值的a `-mtime`，那么如果认为“旧于”与“不新于”相似，则不一定会丢失所有内容。

如果我们能够创建一个具有我们截止时间的*mtime*`find`的文件，我们可以要求找到“不比”我们的参考文件更新的文件。

创建具有正确时间戳的文件有点复杂，因为没有足够时间戳的系统`find`可能也有一个功能不足的`date`命令，可以执行以下操作： `date +%Y%m%d%H%M%S -d "6 hours ago"`.

幸运的是，其他旧工具可以管理这一点，尽管方式更加笨拙。

要开始寻找删除超过六个小时的文件的方法，我们首先必须找到六个小时前的时间。考虑六个小时是 21600 秒：

```
$ date && perl -e '@d=localtime time()-21600; \
  printf "%4d%02d%02d%02d%02d.%02d\n", $d[5]+1900,$d[4]+1,$d[3],$d[2],$d[1],$d[0]'
> Thu Apr 16 04:50:57 CDT 2020
202004152250.57 
```

由于该`perl`语句产生了我们需要的日期/时间信息，因此使用它来创建一个正好有六个小时的参考文件：

```
$ date && touch -t `perl -e '@d=localtime time()-21600; \
  printf "%4d%02d%02d%02d%02d.%02d\n", \
  $d[5]+1900,$d[4]+1,$d[3],$d[2],$d[1],$d[0]'` ref_file && ls -l ref_file
Thu Apr 16 04:53:54 CDT 2020
-rw-rw-rw-   1 root     sys            0 Apr 15 22:53 ref_file 
```

现在我们有了一个正好六小时前的参考文件，“删除所有超过六小时的文件”的“旧 UNIX”解决方案变成了以下内容：

```
$ find . -type f ! -newer ref_file -a ! -name ref_file -exec rm -f "{}" \; 
```

清理我们的参考文件可能也是一个好主意......

```
$ rm -f ref_file 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-10-31T22:32:58.900

`find $PATH -name $log_prefix"*"$log_ext -mmin +$num_mins -exec rm -f {} \;`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-06-13T13:10:16.777

这是@iconoclast 在他们对另一个答案的[评论中想知道的方式，可以做些什么。](https://stackoverflow.com/questions/249578/how-to-delete-files-older-than-x-hours#comment6865608_249608)

使用 crontab 作为用户或`/etc/crontab`创建文件`/tmp/hour`：

```
# m h dom mon dow user  command
0 * * * * root /usr/bin/touch /tmp/hour > /dev/null 2>&1 
```

然后使用它来运行您的命令：

```
find /tmp/ -daystart -maxdepth 1 -not -newer /tmp/hour -type f -name "for_one_hour_files*" -exec do_something {} \; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2017-06-30T02:25:37.587

如果您的“find”版本中没有“-mmin”，那么“-mtime -0.041667”会非常接近“在过去一小时内”，因此在您的情况下，请使用：

```
-mtime +(X * 0.041667) 
```

所以，如果 X 表示 6 小时，那么：

```
find . -mtime +0.25 -ls 
```

有效，因为 24 小时 * 0.25 = 6 小时

# version-control - 如何将 Fitnesse 页面添加到版本控制？

> ID：249580
> 
> 赞同：36
> 
> 时间：2008-10-30T08:33:28.087
> 
> 标签：version-control, fitnesse, acceptance-testing

推荐的做法是什么？我应该将 Fitnesse 文件夹下的 my 子文件夹添加到版本控制中吗？

*背景：从事单个开发人员 Rails 宠物项目。我在版本控制（Subversion）下有我的 Rails 项目，但是我的 Fitnesse Wiki 页面位于 Fitnesse 程序文件夹下。*

Fitnesse 似乎有自己的版本控制...（我在每个 wiki 页面上都看到编号的 zips）它可靠吗？它在哪里存储修订？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-01-15T10:11:32.533

使用`-d`开关（*这在谷歌搜索中非常低调*）

```
Fitnesse20081201>run -p 8080 -d c:/projects/MyProjectNeedsAcceptanceTests 
```

这将在名为 FitnesseRoot 的指定文件夹中创建一个子文件夹（如果它尚不存在），其中包含运行所需的所有内容。

Fitnesse应该起来了。切换到您的浏览器。继续创建您的页面。

*   您创建的每个 Fitnesse 页面都有一个子文件夹。
*   每个文件夹都有一个`content.txt`（这是 wiki 内容）和一个`properties.xml`（这是该页面的 Fitnesse 属性）。
*   所有子页面都是父页面文件夹下的子文件夹。

目录和文件...您已为首次签入版本控制做好了准备。还设置您的版本控制以忽略某些类型的文件

*   FitnesseRoot/文件
*   FitnesseRoot/错误日志
*   *。压缩

*（.zip 文件是 Fitnesse 跟踪对 wiki 页面的编辑的方式。短期本地版本控制。像 svn、git、cvs 等 VCS 应该为我们解决这个问题。所以我们不需要签入 zip 文件）*

希望这是有道理的。如果不是，我建议您花 15 分钟的时间来听一下来自 UncleBob 本人的以下截屏视频
**来源：** [Robert Martin - Fitnesse 的版本控制和开发环境](http://vimeo.com/2765514)

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-02-24T23:24:24.703

如果您在 Fitnesse 中使用版本控制，则不需要每个版本的 zip 存档。使用 -e 0 选项来防止创建 zip 存档：

java -jar Fitnesse.jar -p 8001 **-e 0**

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T09:03:21.413

FitNesse 将每个页面的旧版本存储在与页面文件相同的目录中的 zip 文件中。zip 文件名标记修订的时间戳。它的工作方式类似于维基百科 - 历史，但不是完整的版本控制。

在我们公司，我们想要一个设置，每当我们检查源的（可能是旧的）修订版时，我们也会检查通过该特定版本的 FitNesse 测试。

因此，我们在版本控制的源代码树中安装了 FitNesse（fitnesse 目录，包括 FitNesse 可执行文件和 FitNesseRoot 目录），在 FitNesseRoot 目录中设置了不导入 *.zip 的规则（因为我们有版本控制来保留历史记录）我们不需要他们）。

这适用于健全的 SCM（我使用 svn w/svn-tortoise）。

当我们迁移到 Microsoft Foundation Server 源代码控制时，我们在 checkout-edit-checkin 工作流程中遇到了很多问题。再说一次，这个工作流程一般来说只是一个坏主意，只应该由疯狂的控制狂使用。

（编辑：回答评论者的问题）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-07-22T04:41:09.800

自 Fitnesse 20090214 版本以来，包括 CM 集成，请参阅用户指南了解详细信息。 [http://fitnesse.org/FitNesse.UserGuide.SourceCodeControl](http://fitnesse.org/FitNesse.UserGuide.SourceCodeControl)

git hub 插件包含在 Fitnesse 发行版中。

[我在http://code.google.com/p/perforcecmsystem/](http://code.google.com/p/perforcecmsystem/)看到了一个 perforce 插件，但我的团队还没有这个设置。

# c++ - 用 C++ 示例解释外观模式？

> ID：249581
> 
> 赞同：21
> 
> 时间：2008-10-30T08:33:55.107
> 
> 标签：c++, design-patterns, facade

我已经检查了[维基百科文章](http://en.wikipedia.org/wiki/Facade_pattern)，它似乎缺少代码示例的 c++ 版本。没有这个，我无法完全理解 Facade 模式，你能帮我用 C++ 解释一下吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-10-30T12:19:51.250

**外观模式：为复杂的子系统或一组接口提供统一的简化接口。它提供了一个更高级别的接口，同时将客户端与复杂的子系统解耦。**

一个帮助你理解的例子..出租车司机。您告诉出租车司机“带我去 PointX”（统一简化的高级界面），然后他开始执行一系列操作（转动钥匙、换档、踩油门等）来执行任务。他抽象出底层子系统（变速箱、发动机等）的复杂性，这样您就不必担心它们。驾驶员还将您与实际使用的车辆分离……您不直接与汽车交互。您可能会给他一个 Merc，但您与 Driver 的界面仍然是 TakeMeTo( X ).. 您不受任何特定型号/制造的汽车的束缚。

在现实世界的示例中，您会发现与第三方组件或库交互的外观。您不希望您的代码依赖于特定的供应商，因此您引入了一个外观接口来解耦。您还将简化此接口，例如，您的外观接口将有一个名为 SendData(string) 的方法，但在内部，实现可能会按特定顺序调用 m 个子包上的 n 个方法来完成任务。这就是维基百科页面上的图表显示的内容。

例如[，将示例](http://www.theperlreview.com/Articles/v0i4/facade.pdf)翻译成 C++ 并保持小

```
sResource = LWCPPSimple::get("http://www.perl.org") 
```

这里虚构的 C++ 中的 WWW 库是一个外观，它统一了问题的协议、网络和解析方面，因此我可以专注于获取资源的主要焦点。get 方法将 HTTP、FTP 和其他各种协议、请求-响应、连接管理等的复杂性（在某些情况下甚至是丑陋的）隐藏/封装/保持在一个位置。此外，如果明天 LWCPPSimple 的创建者找到一个使 get() 速度提高一倍的方法，我免费获得了性能优势。我的客户代码不必更改。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-10-30T12:26:17.197

```
class Engine
{

public:
    void Start() { }

};

class Headlights
{

public:
    void TurnOn() { }

};

//  That's your facade.
class Car
{

private:
    Engine engine;
    Headlights headlights;

public:
    void TurnIgnitionKeyOn()
    {
        headlights.TurnOn();
        engine.Start();
    }

};

int Main(int argc, char *argv[])
{
    //  Consuming facade.
    Car car;
    car.TurnIgnitionKeyOn();

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-30T09:26:06.233

我已经对 C# 示例进行了搜索和替换。这可能对您没有帮助，因为如果您了解 C++，那么您应该能够理解 C#，因为它使用相同的构造和关键字（类、函数、命名空间、公共等）

```
// "Subsystem ClassA" 
#include <iostream>
class SubSystemOne
{
public:
    void MethodOne()
    {
        std::cout << " SubSystemOne Method" << std::endl;
    }
}

// Subsystem ClassB" 

class SubSystemTwo
{
public:
    void MethodTwo()
    {
        std::cout << " SubSystemTwo Method" << std::endl;
    }
}

// Subsystem ClassC" 

class SubSystemThree
{
public:
    void MethodThree()
    {
            std::cout << " SubSystemThree Method" << std::endl;
    }
}

// Subsystem ClassD" 

class SubSystemFour
{
public:
    void MethodFour()
    {
        std::cout << " SubSystemFour Method" << std::endl;
    }
}

// "Facade" 

class Facade
{
    SubSystemOne one;
    SubSystemTwo two;
    SubSystemThree three;
    SubSystemFour four;

public:
    Facade()
    {
    }

    void MethodA()
    {
        std::cout << "\nMethodA() ---- " << std::endl;
        one.MethodOne();
        two.MethodTwo();
        four.MethodFour();
    }
    void MethodB()
    {
        std::cout << "\nMethodB() ---- " << std::endl;
        two.MethodTwo();
        three.MethodThree();
    }
}

int Main()
{
    Facade facade = new Facade();

    facade.MethodA();
    facade.MethodB();

    return 0;
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-10-30T11:40:20.033

从某种意义上说，Facade 只是一个 API，供想要与隐藏的东西交互的客户端使用。

当为用 C++ 实现或比 API 更复杂的东西公开简单的 C API 时，Facade 很有用。或者当库需要经过多次迭代更新并且您希望尽可能少地影响客户端时，在客户端和库之间获得一个固定的障碍。例如，如果基于 C 的库需要在内部更新为 C++ 或其他东西，或者只是换成完全不同的东西，那么 Facade 对客户端来说是一个很好的中间层。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T11:54:01.490

在这个关于设计模式的优秀网站上有外观的[C](http://www.vincehuston.org/dp/facade.html) [++ 示例。](http://www.vincehuston.org/dp/FacadeDemosCpp)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-03-16T19:15:34.670

```
class A {
    private B b; // Class A uses Class B, the "interface"
    public int f() { return b.g(); }
};

class B {
    private C c; // class B uses class C, a "subsystem"
    private ... ...; // other subsystems can be added
    public int g() { c.h(); return c.i(); }
};

class C { // a subsystem
    public void h() { ... }
    public int i() { return x; }
}; 
```

A 类不会直接使用任何方法或直接影响 C 类或 B 类包含的任何其他子系统的状态。这里只显示一个子系统，因为有多少子系统并不重要。

# c# - 高质量图像缩放库

> ID：249587
> 
> 赞同：142
> 
> 时间：2008-10-30T08:37:39.983
> 
> 标签：c#, image, image-processing, image-manipulation, image-scaling

我想以与 Photoshop 一样好的质量水平在 C# 中缩放图像。有没有可用的 C# 图像处理库来做这件事？

* * *

## 回答 #1

> 赞同：234
> 
> 时间：2008-12-09T15:52:09.407

这是一个注释很好的 Image Manipulation 帮助器类，您可以查看和使用它。我将其编写为如何在 C# 中执行某些图像处理任务的示例。您将对采用 System.Drawing.Image、宽度和高度作为参数的**ResizeImage**函数感兴趣。

```
using System;
using System.Collections.Generic;
using System.Drawing;
using System.Drawing.Imaging;

namespace DoctaJonez.Drawing.Imaging
{
    /// <summary>
    /// Provides various image untilities, such as high quality resizing and the ability to save a JPEG.
    /// </summary>
    public static class ImageUtilities
    {    
        /// <summary>
        /// A quick lookup for getting image encoders
        /// </summary>
        private static Dictionary<string, ImageCodecInfo> encoders = null;

        /// <summary>
        /// A lock to prevent concurrency issues loading the encoders.
        /// </summary>
        private static object encodersLock = new object();

        /// <summary>
        /// A quick lookup for getting image encoders
        /// </summary>
        public static Dictionary<string, ImageCodecInfo> Encoders
        {
            //get accessor that creates the dictionary on demand
            get
            {
                //if the quick lookup isn't initialised, initialise it
                if (encoders == null)
                {
                    //protect against concurrency issues
                    lock (encodersLock)
                    {
                        //check again, we might not have been the first person to acquire the lock (see the double checked lock pattern)
                        if (encoders == null)
                        {
                            encoders = new Dictionary<string, ImageCodecInfo>();

                            //get all the codecs
                            foreach (ImageCodecInfo codec in ImageCodecInfo.GetImageEncoders())
                            {
                                //add each codec to the quick lookup
                                encoders.Add(codec.MimeType.ToLower(), codec);
                            }
                        }
                    }
                }

                //return the lookup
                return encoders;
            }
        }

        /// <summary>
        /// Resize the image to the specified width and height.
        /// </summary>
        /// <param name="image">The image to resize.</param>
        /// <param name="width">The width to resize to.</param>
        /// <param name="height">The height to resize to.</param>
        /// <returns>The resized image.</returns>
        public static System.Drawing.Bitmap ResizeImage(System.Drawing.Image image, int width, int height)
        {
            //a holder for the result
            Bitmap result = new Bitmap(width, height);
            //set the resolutions the same to avoid cropping due to resolution differences
            result.SetResolution(image.HorizontalResolution, image.VerticalResolution);

            //use a graphics object to draw the resized image into the bitmap
            using (Graphics graphics = Graphics.FromImage(result))
            {
                //set the resize quality modes to high quality
                graphics.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality;
                graphics.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
                graphics.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighQuality;
                //draw the image into the target bitmap
                graphics.DrawImage(image, 0, 0, result.Width, result.Height);
            }

            //return the resulting bitmap
            return result;
        }

        /// <summary> 
        /// Saves an image as a jpeg image, with the given quality 
        /// </summary> 
        /// <param name="path">Path to which the image would be saved.</param> 
        /// <param name="quality">An integer from 0 to 100, with 100 being the 
        /// highest quality</param> 
        /// <exception cref="ArgumentOutOfRangeException">
        /// An invalid value was entered for image quality.
        /// </exception>
        public static void SaveJpeg(string path, Image image, int quality)
        {
            //ensure the quality is within the correct range
            if ((quality < 0) || (quality > 100))
            {
                //create the error message
                string error = string.Format("Jpeg image quality must be between 0 and 100, with 100 being the highest quality.  A value of {0} was specified.", quality);
                //throw a helpful exception
                throw new ArgumentOutOfRangeException(error);
            }

            //create an encoder parameter for the image quality
            EncoderParameter qualityParam = new EncoderParameter(System.Drawing.Imaging.Encoder.Quality, quality);
            //get the jpeg codec
            ImageCodecInfo jpegCodec = GetEncoderInfo("image/jpeg");

            //create a collection of all parameters that we will pass to the encoder
            EncoderParameters encoderParams = new EncoderParameters(1);
            //set the quality parameter for the codec
            encoderParams.Param[0] = qualityParam;
            //save the image using the codec and the parameters
            image.Save(path, jpegCodec, encoderParams);
        }

        /// <summary> 
        /// Returns the image codec with the given mime type 
        /// </summary> 
        public static ImageCodecInfo GetEncoderInfo(string mimeType)
        {
            //do a case insensitive search for the mime type
            string lookupKey = mimeType.ToLower();

            //the codec to return, default to null
            ImageCodecInfo foundCodec = null;

            //if we have the encoder, get it to return
            if (Encoders.ContainsKey(lookupKey))
            {
                //pull the codec from the lookup
                foundCodec = Encoders[lookupKey];
            }

            return foundCodec;
        } 
    }
} 
```

* * *

# 更新

一些人一直在评论中询问如何使用 ImageUtilities 类的示例，所以你开始吧。

```
//resize the image to the specified height and width
using (var resized = ImageUtilities.ResizeImage(image, 50, 100))
{
    //save the resized image as a jpeg with a quality of 90
    ImageUtilities.SaveJpeg(@"C:\myimage.jpeg", resized, 90);
} 
```

## 笔记

请记住，图像是一次性的，因此您需要将调整大小的结果分配给 using 声明（或者您可以使用 try finally 并确保在 finally 中调用 dispose）。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-10-30T08:47:04.877

在我看来，当您使用 GDI+ 绘制图像时，它的缩放比例非常好。您可以使用它来创建缩放图像。

如果你想用 GDI+ 缩放你的图像，你可以这样做：

```
Bitmap original = ...
Bitmap scaled = new Bitmap(new Size(original.Width * 4, original.Height * 4));
using (Graphics graphics = Graphics.FromImage(scaled)) {
  graphics.DrawImage(original, new Rectangle(0, 0, scaled.Width, scaled.Height));
} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2008-10-30T08:48:11.427

[Imagemagick](http://www.imagemagick.org/)和[GD](http://gd-sharp.sourceforge.net/)等经过测试的库可用于 .NET

您还可以阅读诸如双三次插值之类的内容并编写自己的内容。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-09T15:36:55.087

**CodeProject 文章讨论和分享缩放图像**的源代码：

 ***   [**使用过滤器**的两遍缩放](http://www.codeproject.com/KB/graphics/2_pass_scaling.aspx)
***   [C# 中图像的矩阵转换，使用**.NET GDI+**](http://www.codeproject.com/KB/GDI-plus/matrix_transformation.aspx)*   [**使用GDI+ for .NET**调整照片图像的大小](http://www.codeproject.com/KB/GDI-plus/imageresize.aspx)***   [**使用Haar 变换**的快速二元图像缩放](http://www.codeproject.com/KB/graphics/Dyadic_down_sampling.aspx)****

 ******* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-07-05T12:40:08.887

使用这个库：http: [//imageresizing.net](http://imageresizing.net)

阅读图书馆作者的这篇文章：[20 Image Sizing Pitfalls with .NET](http://nathanaeljones.com/163/20-image-resizing-pitfalls/)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-30T09:51:53.607

尝试 Graphics.InterpolationMode 的不同值。GDI+ 中有几种典型的缩放算法可用。如果其中一个足以满足您的需要，您可以走这条路，而不是依赖外部库。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-12-09T15:45:49.513

您可以尝试[dotImage](http://www.atalasoft.com/products/dotimage/)，这是我公司的产品之一，它包括一个[用于重采样](http://www.atalasoft.com/products/dotimage/docs/Atalasoft.dotImage~Atalasoft.Imaging.ImageProcessing.ResampleCommand_members.html)图像的对象，该对象具有[18 种过滤器类型](http://www.atalasoft.com/products/dotimage/docs/Atalasoft.dotImage~Atalasoft.Imaging.ImageProcessing.ResampleMethod.html)，用于各种质量级别。

典型用法是：

```
// BiCubic is one technique available in PhotoShop
ResampleCommand resampler = new ResampleCommand(newSize, ResampleMethod.BiCubic);
AtalaImage newImage = resampler.Apply(oldImage).Image; 
```

此外，dotImage 包含 140 个奇怪的图像处理命令，其中包括许多类似于 PhotoShop 中的过滤器，如果您正在寻找的话。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-12-27T15:21:29.950

这可能会有所帮助

```
 public Image ResizeImage(Image source, RectangleF destinationBounds)
    {
        RectangleF sourceBounds = new RectangleF(0.0f,0.0f,(float)source.Width, (float)source.Height);
        RectangleF scaleBounds = new RectangleF();

        Image destinationImage = new Bitmap((int)destinationBounds.Width, (int)destinationBounds.Height);
        Graphics graph = Graphics.FromImage(destinationImage);
        graph.InterpolationMode =
            System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;

        // Fill with background color
        graph.FillRectangle(new SolidBrush(System.Drawing.Color.White), destinationBounds);

        float resizeRatio, sourceRatio;
        float scaleWidth, scaleHeight;

        sourceRatio = (float)source.Width / (float)source.Height;

        if (sourceRatio >= 1.0f)
        {
            //landscape
            resizeRatio = destinationBounds.Width / sourceBounds.Width;
            scaleWidth = destinationBounds.Width;
            scaleHeight = sourceBounds.Height * resizeRatio;
            float trimValue = destinationBounds.Height - scaleHeight;
            graph.DrawImage(source, 0, (trimValue / 2), destinationBounds.Width, scaleHeight);
        }
        else
        {
            //portrait
            resizeRatio = destinationBounds.Height/sourceBounds.Height;
            scaleWidth = sourceBounds.Width * resizeRatio;
            scaleHeight = destinationBounds.Height;
            float trimValue = destinationBounds.Width - scaleWidth;
            graph.DrawImage(source, (trimValue / 2), 0, scaleWidth, destinationBounds.Height);
        }

        return destinationImage;

    } 
```

请注意`InterpolationMode.HighQualityBicubic`-> 这通常是性能和结果之间的良好折衷。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-01-11T12:51:42.250

试试这个基本的代码片段：

```
private static Bitmap ResizeBitmap(Bitmap srcbmp, int width, int height )
{
    Bitmap newimage = new Bitmap(width, height);
    using (Graphics g = Graphics.FromImage(newimage))
           g.DrawImage(srcbmp, 0, 0, width, height);
    return newimage;
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-11-20T08:47:11.363

有[一篇关于 Code Project](http://www.codeproject.com/KB/GDI-plus/imageresize.aspx)的文章关于使用 GDI+ for .NET 使用双三次插值来调整照片大小。

在另一个博客上也有关于这个主题的另一篇文章（我认为是 MS 员工），但我在任何地方都找不到链接。:(也许其他人可以找到它？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-08-27T06:35:54.613

这是我发现在 Paint.NET 的图像重采样代码中引用的一篇文章： Paul Bourke 的[各种简单图像处理技术](http://paulbourke.net/texture_colour/imageprocess/)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-05-27T08:47:10.450

如果它是低分辨率 cgi [2D 图像过滤器，你可以试试这个](http://code.google.com/p/2dimagefilter/)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-12-14T23:56:18.697

你可以试试[魔法内核](http://johncostella.webs.com/magic/)。与双三次重采样相比，它在放大时产生的像素化伪影更少，并且在缩小时也能提供非常好的结果。源代码可从网站以 c# 形式获得。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-08-16T20:00:07.310

我对琼斯医生的回答有一些改进。

它适用于想要如何按比例调整图像大小的人。它测试并为我工作。

我添加的类的方法：

```
public static System.Drawing.Bitmap ResizeImage(System.Drawing.Image image, Size size)
{
    return ResizeImage(image, size.Width, size.Height);
}

public static Size GetProportionedSize(Image image, int maxWidth, int maxHeight, bool withProportion)
{
    if (withProportion)
    {
        double sourceWidth = image.Width;
        double sourceHeight = image.Height;

        if (sourceWidth < maxWidth && sourceHeight < maxHeight)
        {
            maxWidth = (int)sourceWidth;
            maxHeight = (int)sourceHeight;
        }
        else
        {
            double aspect = sourceHeight / sourceWidth;

            if (sourceWidth < sourceHeight)
            {
                maxWidth = Convert.ToInt32(Math.Round((maxHeight / aspect), 0));
            }
            else
            {
                maxHeight = Convert.ToInt32(Math.Round((maxWidth * aspect), 0));
            }
        }
    }

    return new Size(maxWidth, maxHeight);
} 
```

根据此代码使用新的可用：

```
using (var resized = ImageUtilities.ResizeImage(image, ImageUtilities.GetProportionedSize(image, 50, 100)))
{
    ImageUtilities.SaveJpeg(@"C:\myimage.jpeg", resized, 90);
} 
```

# deployment - 以编程方式提高用户权限

> ID：249597
> 
> 赞同：2
> 
> 时间：2008-10-30T08:43:55.477
> 
> 标签：deployment, vbscript, windows-xp, installshield

我一直在维护一个安装，但我不是真正的专家。现在我被要求为此提出一个解决方案：

我们的软件始终与计算机一起出售，因为它必须在非常受控的环境中运行。安装程序需要管理权限才能执行。到目前为止，我们有两个不同的用户，一个具有管理权限，另一个没有。我们的客户服务以管理员身份登录，安装软件并重新启动机器，以便用户可以作为普通用户访问。

现在我们希望用户能够自己安装软件，但我们不希望他们以管理员身份访问，因为他们可以修改不应修改的内容。

那么，有没有办法在安装过程中以编程方式提高用户权限，然后再降低它们呢？安装程序是使用 InstallShield 制作的，但我们使用 vbscript 来检查一些先决条件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T09:46:09.580

查看[CPAU](http://www.joeware.net/freetools/tools/cpau/index.htm)。它允许您创建一个以管理员身份运行安装的加密命令。

**编辑**：[这](http://www.commandline.co.uk/sanur/)是一个更全面的类似工具列表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T10:20:28.120

如果你正在寻找一个工具包来做这种事情，那么微软的 MSI 技术已经内置了：安装初始 MSI 文件需要管理员访问权限，附加补丁（我认为是 MSP）由原始 MSI 进行数字签名，并且因此被认为是安全的 - 用户无需管理员提升即可安装它们。

您可以做同样的事情：作为管理安装的一部分，安装一个服务。该服务可以创建一个命名管道——您明确地将用户 ACL 授予该管道——甚至只是一个套接字或监视一个允许用户级代码与服务代码通信的放置文件夹（以 SYSTEM 或配置访问权限运行）。然后，该服务可以使用其 SERVICE 或配置的帐户级别权限来模拟管理员，或代表用户执行其他任务，而无需授予用户任何类型的提升权限 - 即使是暂时的。

# c++ - std::exception::_Raise 和 std::exception::exception 上的 VC++ 链接器错误

> ID：249607
> 
> 赞同：0
> 
> 时间：2008-10-30T08:51:10.483
> 
> 标签：c++, exception, visual-c++, linker, visual-studio-2005

我正在使用 Visual C++ 2005 Express Edition 并收到以下链接器错误：

```
19>mylib1.lib(mylibsource1.obj) : error LNK2019: unresolved external symbol "__declspec(dllimport) public: void __thiscall std::exception::_Raise(void)const " (__imp_?_Raise@exception@std@@QBEXXZ) referenced in function "protected: static void __cdecl std::vector<class mytype,class std::allocator<class mytype> >::_Xlen(void)" (?_Xlen@?$vector@Vmytype@@V?$allocator@Vmytype@@@std@@@std@@KAXXZ)
19>mylib2.lib(mylibsource2.obj) : error LNK2001: unresolved external symbol "__declspec(dllimport) public: void __thiscall std::exception::_Raise(void)const " (__imp_?_Raise@exception@std@@QBEXXZ)
19>mylib1.lib(mylibsource1.obj) : error LNK2019: unresolved external symbol "__declspec(dllimport) public: __thiscall std::exception::exception(char const *,int)" (__imp_??0exception@std@@QAE@PBDH@Z) referenced in function "public: __thiscall std::logic_error::logic_error(class std::basic_string<char,struct std::char_traits<char>,class std::allocator<char> > const &)" (??0logic_error@std@@QAE@ABV?$basic_string@DU?$char_traits@D@std@@V?$allocator@D@2@@1@@Z)
19>mylib2.lib(mylibsource2.obj) : error LNK2001: unresolved external symbol "__declspec(dllimport) public: __thiscall std::exception::exception(char const *,int)" (__imp_??0exception@std@@QAE@PBDH@Z) 
```

我在生成的代码中关闭了异常，并且在包含矢量头文件之前正在使用：

```
#define _HAS_EXCEPTIONS 0 
```

一些谷歌结果出现了一些东西，但没有“啊哈！” 对我有用的解决方案。

编辑：

如前所述，“_HAS_EXCEPTIONS 0”本身并不会关闭异常。它的作用是，至少在向量头文件中，是在异常对象上调用 _Raise，而不是调用 C++“抛出”。就我而言，它无法链接到异常对象的 _Raise 函数，因为我没有包含正确的库。但是，那个库是什么并不明显。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-31T16:15:35.403

添加这一行：

```
#define _STATIC_CPPLIB 
```

在包含矢量标头之前似乎可以解决问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T09:44:59.673

第三个错误明确表示`#define the _HAS_EXCEPTIONS 0`不影响。现在，可能包括（有意义，共享代码可能会减少可执行文件的大小）。这可以解释为什么如果您在*包含*. 这种定义应该在您的项目设置中完成。

请注意，_HAS_EXCEPTIONS 是 Visual Studio 中不受支持的功能。它不会关闭异常。

# wpf - Blend 2 sp1 中的 WPF 视觉状态管理器

> ID：249618
> 
> 赞同：5
> 
> 时间：2008-10-30T09:01:36.190
> 
> 标签：wpf, expression-blend, visualstatemanager

谁能向我解释如何让可视状态管理器与 WPF 应用程序一起工作？它刚刚被添加到新的 wpftoolkit 中。我按照说明安装了它，但即使是示例也没有显示 VSM。在 Silverlight 中它可以工作，但在 WPF 中却不行。如果安装了最新的 Blend 2 并使用 SP1 更新。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T11:14:37.013

rudigrobler，你让我想...应该有一个注册表项...所以我刚刚在 Reflector 中打开了 Blend 并开始搜索...

我找到了位置：

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Expression\Blend 
```

并添加了一个名为 EnableVSM 的 DWORD 键并将其值 1

现在它起作用了！

最简单的启用方法是创建一个新的 .Reg 文件并添加以下内容：

```
[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Expression\Blend]
"EnableVSM"=dword:00000001 
```

现在运行它，你就完成了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-31T07:11:29.547

这也可能有帮助：http: [//blogs.msdn.com/expression/archive/2008/10/30/blend-2-sp1-wpf-toolkit-visual-state-manager-for-wpf.aspx](http://blogs.msdn.com/expression/archive/2008/10/30/blend-2-sp1-wpf-toolkit-visual-state-manager-for-wpf.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T09:14:16.647

在 WPF 中阅读有关 VSM 的这两篇文章：

*   [http://dotnet.org.za/rudi/archive/2008/10/29/silverlight-love-for-wpf.aspx](http://dotnet.org.za/rudi/archive/2008/10/29/silverlight-love-for-wpf.aspx)
*   [http://windowsclient.net/wpf/wpf35/wpf-35sp1-toolkit-visual-state-manager-overview.aspx](http://windowsclient.net/wpf/wpf35/wpf-35sp1-toolkit-visual-state-manager-overview.aspx)

他们是一个注册表设置，需要在 WPF 对混合的支持中为 VSM“打开”...[在这里阅读更多](http://groups.google.com/group/wpf-disciples/browse_thread/thread/a4000df92dedb3f9)

# c# - 如何在 .Net 平台上开始面向切面编程？

> ID：249631
> 
> 赞同：3
> 
> 时间：2008-10-30T09:10:10.510
> 
> 标签：c#, .net, aop

请给我一些关于如何最好地开始将面向方面编程应用于我的 C#.net 应用程序的见解？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T09:43:38.553

PostSharp 的另一个优势是它通过 IL 编织来实现 AOP。事实上，它在编译时/或刚编译后将代码添加到 Il。这会使构建速度变慢，但在运行时应该更快。

其他一些在运行时执行此操作（城堡项目，我认为它是执行 AOP 的 Windsor），这在运行时速度较慢，但​​构建速度较快。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T09:27:26.090

我建议尝试[Spring.NET](http://www.springframework.net/)。它允许您创建“拦截器”类，只需将条目添加到应用程序的配置文件中，就可以将调用包装到业务对象中。

我们已经使用它来进行连接/事务处理、错误记录和身份验证。这将所有这些“方面”排除在业务逻辑代码之外。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T09:31:56.097

[PostSharp](http://postsharp.org)是一种向 C# 代码添加方面的相当简单的方法。

# algorithm - 这个 Scheme 求幂函数的时间复杂度是多少？

> ID：249632
> 
> 赞同：1
> 
> 时间：2008-10-30T09:10:17.887
> 
> 标签：algorithm, math, scheme, time-complexity

时间复杂度是多少？为什么？

```
(define (mult a b)
      (define (internal a accum)
        (if (= a 1) accum
            (internal (- a 1) (+ accum b))))
      (internal a b))

(define (to-the-power-of m n)
  (define (internal x accum)
    (if (= x 0) accum
        (internal (- x 1) (mult accum m))))
  (internal n 1)) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T09:25:37.217

mult 部分的时间复杂度可以这样找到：

要计算 (mult ab)，调用 (internal a accum) 直到 a = 1，所以我们有某种迭代 a 的尾递归（循环）。

因此我们知道 (mult ab) 的时间复杂度是**O(a)**（= 线性时间复杂度）

(to-the-power-of mn) 也有一个 (internal x accum) 定义，它也循环 (直到 x = 0)

所以我们又有**O(x)**（= 线性时间复杂度）

*但是*：我们没有考虑内部函数调用所需的时间......
在内部，我们使用时间复杂度线性的（mult ab）定义，所以我们有以下情况：在第一次迭代中 mult调用时： (mult 1 m) --> O(1)
第二次迭代 这变成： (mult mm) --> O(m)
第三次迭代： (mult m² m) --> O(m*m) 和依此类推很明显，这会增长到 n = 0（或者在内部，这会变成 x = 0）

因此我们可以说时间复杂度将取决于 m 和 n：**O(m^n)**

[编辑：]您还可以查看我之前提出的一个相关问题：[Big O，您如何计算/近似它？](https://stackoverflow.com/questions/3255/big-o-how-do-you-calculateapproximate-it)这可能会给你一个线索，你可以如何更普遍地处理近似值

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T09:23:53.273

假设加法和乘法都算作一次运算，则此函数执行 O(m^n) 次运算。

首先考虑mult函数。它（mult ab）将执行 a-1 加法。因为，渐近增长是相同的，为了数学简单，让我们用 a 来近似它。

现在对于 to-the-power-of 函数，这对 mult 函数执行 n 次调用。这些调用是到 (mult 1 m)，产生 m，然后到 (mult mm)，产生 m^2，然后到 (mult m^2 m)，产生 m^3，依此类推直到 m^n。所以这里执行的操作总数是总和 m^0 + m^1 + ... + m^n。这是 (m^n - 1) / (m-1) 增长为 m^n。

# browser - 当浏览器关闭时，小程序会发生什么？

> ID：249637
> 
> 赞同：5
> 
> 时间：2008-10-30T09:14:21.687
> 
> 标签：browser, applet, jvm

假设我在浏览器的页面中运行了一个小程序。当浏览器被用户关闭时会发生什么？

小程序是否得到通知，以便它可以在其一侧执行某种关闭操作（关闭打开到服务器的连接，清理静态变量，...）？

此外，我假设相同的行为将适用于页面刷新或页面导航（而不是浏览器关闭）。浏览器保持打开状态，但小程序消失了。虽然当您关闭浏览器时，您也会关闭 JVM，所以我现在不确定。

谢谢，JB

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T09:17:54.753

是的，应该在**浏览器卸载对象之前调用****destroy() 方法**。

 ****destroy()**是Java 小程序的四个“**生命周期方法”中的最后一个（其他是****init()**、**start()**和**stop()**）。它们实际上在不同的时间被调用，具体取决于您的**浏览器**和**虚拟机**。如果您想确切知道何时调用每个方法，请在您的小程序中实现每个方法，并 System.out 一些反馈。

理想情况下，destroy() 应该**由 environment 调用**，并且应该只调用一次。如果似乎没有调用destroy()，则可以声明一个公共的finalize() 方法，该方法调用destroy。您也可以尝试在窗口对象卸载时从 javascript 调用destroy()，但同样，请确保您没有不必要地调用destroy()。

```
public void finalize () {
    destroy();
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-18T14:04:07.123

大多数时候会调用destroy，但是在关闭窗口的情况下它没有足够的时间来完成所需的任务。

刷新时有足够的时间，使用 Backword <- 和 Forward -> 导航

# c# - 在 Visual Studio 2008 中更改单元测试项目的输出路径

> ID：249647
> 
> 赞同：2
> 
> 时间：2008-10-30T09:19:52.767
> 
> 标签：c#, visual-studio-2008, unit-testing, .net-2.0

我更改了测试项目的输出路径，因为默认路径不符合我们的项目目录结构。在我这样做之后，Visual Studio 2008 无法运行测试，因为它找不到单元测试项目程序集。

为了让单元测试引擎找到程序集，我还需要进行哪些更改？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T16:08:17.660

至少有三种方法可以解决这个问题

1.  在解决方案中运行任何测试**之前**设置输出路径（如[Paulius Maruška 所建议的](https://stackoverflow.com/questions/249647/changing-output-path-of-the-unit-test-project-in-visual-studio-2008/395998#395998)）。
2.  关闭解决方案，**删除目录*TestResults***（在您的解决方案文件夹下），然后打开解决方案并运行所有测试（测试 -> 运行 -> 全部...）
3.  将您的程序集添加到要在 .testconfig 文件中部署的文件列表中（[由 Ty 建议](https://stackoverflow.com/questions/249647/changing-output-path-of-the-unit-test-project-in-visual-studio-2008/257665#257665)）

可能不推荐解决方案 3，因为解决方案 1 或 2 将在不添加对输出路径的第二个引用的情况下实现相同的效果。

请注意，解决方案 2 将删除您可能拥有的任何测试历史记录。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-03T00:49:27.130

如果您打开 .testrunco​​nfig 文件并转到“部署”选项，则可以将测试程序集添加到要部署的文件列表中。然后，您应该能够运行您的测试。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-28T08:57:42.787

我想通了，我想。

这是我找到的唯一解决方案。将程序集添加到要部署的文件列表中（如 Ty 建议的那样）可行，但感觉有点脏，所以我不想这样做。

Visual Studio 接受更改后的路径，仅当您在运行任何测试之前更改它时。所以，我自己的问题的解决方案是：**您必须创建一个新的测试项目，更改它的构建路径，添加旧测试项目中的所有测试**。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-01T01:42:51.970

关闭您的项目，然后删除隐藏的 .suo 文件和 csproj.user 文件。然后重新打开项目。这解决了它。

# delphi - “应用程序”全局变量无法识别

> ID：249655
> 
> 赞同：5
> 
> 时间：2008-10-30T09:25:54.893
> 
> 标签：delphi, delphi-5

我在 Delphi 5 中从事一个大型项目。今天，在将应用程序的两个分支合并在一起后，数百个单元之一， UnitMain（你猜是主窗体的单元）停止识别应用程序全局。

这是一个相当奇怪的问题——我可以通过在 UnitMain 中定义 Application: TApplication 并从我们的 .dpr 项目文件中将其设置为 Application 来编译程序，但这会导致访问冲突，这并不是什么大问题令人惊讶的是 Application 是它的特别之处。

我希望有人以前遇到过同样的问题，或者对 Delphi VCL 的内部工作有足够的了解来帮助我。

```
unit UnitMain;

interface

uses
  Windows, Messages, SysUtils, Classes, Graphics, Controls, Forms, Dialogs,
  Menus, ComCtrls, StdCtrls, cxButtons, ExtCtrls, IniFiles, ShellAPI,
  LMDControl, LMDBaseControl, LMDBaseGraphicControl, LMDGraphicControl,
  LMDScrollText, cxControls, cxContainer, cxListBox, Psock, NMFtp, db, DBTables,
  FileCtrl, Configs, cxHint, DSetFunc, OleCtrls, DsInformation,
  InterAppComm, ActnList, ADODB, OleServer, CRAXDRT_TLB; 
```

确切的错误是编译器无法识别本单元中的应用程序。例如，对于 Application.ProcessMessages；调用，错误是“需要对象或类类型”。其他单位都没有这个问题。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-30T09:58:17.540

我认为您很可能在范围内有两个称为“应用程序”的符号，而表单单元中的一个不是活动的。确保使用列表中的 Forms 单元位于任何包含名为 Application 的符号的先前单元之后。

但是，您需要提供更多信息。确切的错误消息等。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-30T11:56:38.800

我很高兴看到现在一切正常，但我将添加另一种解决此类问题的方法，特别是如果您不想重新排列您的使用子句，就是将单元名称添加到您想要使用的任何内容的前缀，例如。

```
Forms.Application.ProcessMessages; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T09:35:08.557

文件顶部的uses 子句中有哪些单位？申请来自“表格”单元。

例如。

```
unit MyUnit;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms; 
```

# java - 如何在 Maven 部署阶段将构建的工件复制到远程 Windows 服务器上的目录？

> ID：249657
> 
> 赞同：4
> 
> 时间：2008-10-30T09:26:10.260
> 
> 标签：java, maven-2, build, automated-deploy

有人可以提供工作示例（完整的 Maven 插件配置）如何在部署阶段将构建的 jar 文件复制到特定的服务器吗？

我曾尝试查看 wagon 插件，但它非常无证，我无法设置它。该构建会生成正在部署到 Nexus 的标准 jar，但我还需要通过本地网络 (\someserver\testapp\bin) 自动将 jar 放入测试服务器。

我将不胜感激任何提示。

谢谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-30T12:35:52.763

其实我找到了另一种方式：依赖插件！

```
<plugin>
  <groupId>org.apache.maven.plugins</groupId>
  <artifactId>maven-dependency-plugin</artifactId>
  <executions>
    <execution>
      <id>copy-to-ebs</id>
      <phase>deploy</phase>
      <goals>
          <goal>copy</goal>
      </goals>
      <configuration>
        <artifactItems>
          <artifactItem>
            <groupId>${project.groupId}</groupId>
            <artifactId>${project.artifactId}</artifactId>
            <version>${project.version}</version>
            <type>${project.packaging}</type>
          </artifactItem>
        </artifactItems>
        <outputDirectory>\\someserver\somedirectory</outputDirectory>
        <stripVersion>true</stripVersion>                    
      </configuration>
    </execution>                        
  </executions>
</plugin> 
```

它也需要像 \\resource 这样的 windows 路径。

请注意，\\someserver\somedirectory 仅适用于 Windows 客户端。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T11:46:09.040

我没有工作示例，但[“Maven Assembly Plugin”](http://maven.apache.org/plugins/maven-assembly-plugin/assembly.html)应该可以完成这项工作。您可以将其配置为在部署阶段自动运行。
当您编写自己的程序集描述符时，您可以指定应写入程序集的路径。我认为 maven 不应该关心它是本地路径还是远程路径。

# php - 使用 PHPUnit 测试受保护方法的最佳实践

> ID：249664
> 
> 赞同：324
> 
> 时间：2008-10-30T09:32:41.713
> 
> 标签：php, unit-testing, phpunit

我发现关于[你是否测试私有方法](https://stackoverflow.com/questions/105007/do-you-test-private-method)的讨论内容丰富。

我已经决定，在某些类中，我希望有受保护的方法，但要测试它们。其中一些方法是静态的和简短的。因为大多数公共方法都使用它们，所以我以后可能可以安全地删除测试。但是为了从 TDD 方法开始并避免调试，我真的很想测试它们。

我想到了以下几点：

*   [答案](https://stackoverflow.com/questions/105007/do-you-test-private-method#105021)中建议的[方法对象](http://www.refactoring.com/catalog/replaceMethodWithMethodObject.html)似乎对此有点过分了。
*   从公共方法开始，当更高级别的测试给出代码覆盖率时，将它们保护起来并删除测试。
*   继承具有可测试接口的类，使受保护的方法公开

哪个是最佳实践？还有别的事吗？

看起来，JUnit 自动将受保护的方法更改为公共的，但我没有深入研究它。PHP 不允许通过[反射](http://php.net/language.oop5.reflection)进行此操作。

* * *

## 回答 #1

> 赞同：475
> 
> 时间：2010-05-09T15:53:38.300

如果您将 PHP5 (>= 5.3.2) 与 PHPUnit 一起使用，则可以通过在运行测试之前使用反射将它们设置为公共来测试私有和受保护的方法：

```
protected static function getMethod($name) {
  $class = new ReflectionClass('MyClass');
  $method = $class->getMethod($name);
  $method->setAccessible(true);
  return $method;
}

public function testFoo() {
  $foo = self::getMethod('foo');
  $obj = new MyClass();
  $foo->invokeArgs($obj, array(...));
  ...
} 
```

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2012-01-02T15:06:37.563

[Teastburn](https://stackoverflow.com/questions/249664/best-practices-to-test-protected-methods-with-phpunit/8702347#answer-5671560)有正确的方法。更简单的是直接调用方法并返回答案：

```
class PHPUnitUtil
{
  public static function callMethod($obj, $name, array $args) {
        $class = new \ReflectionClass($obj);
        $method = $class->getMethod($name);
        $method->setAccessible(true);
        return $method->invokeArgs($obj, $args);
    }
} 
```

您可以通过以下方式在测试中简单地调用它：

```
$returnVal = PHPUnitUtil::callMethod(
                $this->object,
                '_nameOfProtectedMethod', 
                array($arg1, $arg2)
             ); 
```

* * *

## 回答 #3

> 赞同：54
> 
> 时间：2008-10-30T10:46:19.207

您似乎已经意识到了，但无论如何我还是要重申一下；如果您需要测试受保护的方法，这是一个不好的迹象。单元测试的目的是测试一个类的接口，保护方法是实现细节。也就是说，在某些情况下它是有意义的。如果使用继承，则可以将超类视为为子类提供接口。所以在这里，您必须测试受保护的方法（但绝不是*私有*方法）。对此的解决方案是创建一个用于测试目的的子类，并使用它来公开方法。例如。：

```
class Foo {
  protected function stuff() {
    // secret stuff, you want to test
  }
}

class SubFoo extends Foo {
  public function exposedStuff() {
    return $this->stuff();
  }
} 
```

请注意，您始终可以用组合替换继承。在测试代​​码时，处理使用这种模式的代码通常要容易得多，因此您可能需要考虑该选项。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2011-04-15T01:37:38.367

我想对[uckelman 的回答](https://stackoverflow.com/questions/249664/best-practices-to-test-protected-methods-with-phpunit/2798203#2798203)中定义的 getMethod() 提出一个轻微的变化。

此版本通过删除硬编码值并稍微简化使用来更改 getMethod()。我建议将它添加到您的 PHPUnitUtil 类中，如下例所示，或者添加到您的 PHPUnit_Framework_TestCase 扩展类中（或者，我想，全局添加到您的 PHPUnitUtil 文件中）。

由于 MyClass 无论如何都会被实例化，并且 ReflectionClass 可以采用字符串或对象......

```
class PHPUnitUtil {
    /**
     * Get a private or protected method for testing/documentation purposes.
     * How to use for MyClass->foo():
     *      $cls = new MyClass();
     *      $foo = PHPUnitUtil::getPrivateMethod($cls, 'foo');
     *      $foo->invoke($cls, $...);
     * @param object $obj The instantiated instance of your class
     * @param string $name The name of your private/protected method
     * @return ReflectionMethod The method you asked for
     */
    public static function getPrivateMethod($obj, $name) {
      $class = new ReflectionClass($obj);
      $method = $class->getMethod($name);
      $method->setAccessible(true);
      return $method;
    }
    // ... some other functions
} 
```

我还创建了一个别名函数 getProtectedMethod() 来明确预期的内容，但这取决于你。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2008-10-31T18:36:25.370

我认为troelskn很接近。我会这样做：

```
class ClassToTest
{
   protected function testThisMethod()
   {
     // Implement stuff here
   }
} 
```

然后，实现这样的事情：

```
class TestClassToTest extends ClassToTest
{
  public function testThisMethod()
  {
    return parent::testThisMethod();
  }
} 
```

然后，您针对 TestClassToTest 运行测试。

应该可以通过解析代码自动生成这样的扩展类。如果 PHPUnit 已经提供了这样的机制，我不会感到惊讶（尽管我没有检查过）。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2010-05-07T18:36:20.610

您确实可以以通用方式使用 __call() 来访问受保护的方法。为了能够测试这个类

```
class Example {
    protected function getMessage() {
        return 'hello';
    }
} 
```

在 ExampleTest.php 中创建一个子类：

```
class ExampleExposed extends Example {
    public function __call($method, array $args = array()) {
        if (!method_exists($this, $method))
            throw new BadMethodCallException("method '$method' does not exist");
        return call_user_func_array(array($this, $method), $args);
    }
} 
```

请注意，__call() 方法不会以任何方式引用该类，因此您可以为每个具有要测试的受保护方法的类复制上述内容，只需更改类声明即可。你也许可以把这个函数放在一个通用的基类中，但我还没有尝试过。

现在，测试用例本身仅在构建要测试的对象的位置不同，在 ExampleExposed 中交换为 Example。

```
class ExampleTest extends PHPUnit_Framework_TestCase {
    function testGetMessage() {
        $fixture = new ExampleExposed();
        self::assertEquals('hello', $fixture->getMessage());
    }
} 
```

我相信 PHP 5.3 允许您使用反射来直接更改方法的可访问性，但我假设您必须为每个方法单独这样做。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-08-26T15:59:45.047

我要把我的帽子扔进戒指这里：

我使用 __call hack 取得了不同程度的成功。我想出的替代方案是使用访问者模式：

1：生成stdClass或自定义类（强制类型）

2：使用所需的方法和参数进行初始化

3：确保您的 SUT 有一个 acceptVisitor 方法，该方法将使用访问类中指定的参数执行该方法

4：将其注入您要测试的类中

5：SUT将操作结果注入访问者

6：将您的测试条件应用于访问者的结果属性

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-09-09T10:32:34.963

我建议遵循“Henrik Paul”的解决方法/想法的解决方法:)

你知道你的类的私有方法的名称。例如，它们就像 _add()、_edit()、_delete() 等。

因此，当您想从单元测试方面对其进行测试时，只需通过为一些*常用*词添加前缀和/或后缀来调用私有方法（例如 _addPhpunit），以便在调用 __call() 方法时（因为方法 _addPhpunit() 不会存在）的所有者类，您只需将必要的代码放入 __call() 方法中以删除前缀/后缀单词/s（Phpunit），然后从那里调用该推导的私有方法。这是魔术方法的另一个很好的用途。

试试看。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-11-29T11:14:15.357

替代方案。以下代码作为示例提供。它的实施可以更广泛。它的实现将帮助您测试私有方法并替换私有属性。

```
 <?php
    class Helper{
        public static function sandbox(\Closure $call,$target,?string $slaveClass=null,...$args)
        {
            $slaveClass=!empty($slaveClass)?$slaveClass:(is_string($target)?$target:get_class($target));
            $target=!is_string($target)?$target:null;
            $call=$call->bindTo($target,$slaveClass);
            return $call(...$args);
        }
    }
    class A{
        private $prop='bay';
        public function get()
        {
            return $this->prop;    
        }

    }
    class B extends A{}
    $b=new B;
    $priv_prop=Helper::sandbox(function(...$args){
        return $this->prop;
    },$b,A::class);

    var_dump($priv_prop);// bay

    Helper::sandbox(function(...$args){
        $this->prop=$args[0];
    },$b,A::class,'hello');
    var_dump($b->get());// hello 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2022-01-30T03:58:40.847

您可以在下面的代码中使用[Closure](https://www.php.net/manual/class.closure.php)

```
<?php

class A
{
    private string $value = 'Kolobol';
    private string $otherPrivateValue = 'I\'m very private, like a some kind of password!';

    public function setValue(string $value): void
    {
        $this->value = $value;
    }

    private function getValue(): string
    {
        return $this->value . ': ' . $this->getVeryPrivate();
    }

    private function getVeryPrivate()
    {
        return $this->otherPrivateValue;
    }
}

$getPrivateProperty = function &(string $propName) {
    return $this->$propName;
};

$getPrivateMethod = function (string $methodName) {
    return Closure::fromCallable([$this, $methodName]);
};

$objA = new A;
$getPrivateProperty = Closure::bind($getPrivateProperty, $objA, $objA);
$getPrivateMethod = Closure::bind($getPrivateMethod, $objA, $objA);
$privateByLink = &$getPrivateProperty('value');
$privateMethod = $getPrivateMethod('getValue');

echo $privateByLink, PHP_EOL; // Kolobok

$objA->setValue('Zmey-Gorynich');
echo $privateByLink, PHP_EOL; // Zmey-Gorynich

$privateByLink = 'Alyonushka';
echo $privateMethod(); // Alyonushka: I'm very private, like a some kind of password! 
```

# sql-server - 在 SQL Server 中展平记录集？

> ID：249667
> 
> 赞同：1
> 
> 时间：2008-10-30T09:33:57.933
> 
> 标签：sql-server, theory, aggregate, varchar

假设您得到如下记录集：

```
| ID  | Foo  | Bar  | Red  |
|-----|------|------|------|
| 1   | 100  | NULL | NULL |
| 1   | NULL | 200  | NULL |
| 1   | NULL | NULL | 300  |
| 2   | 400  | NULL | NULL |
| ... | ...  | ...  | ...  | -- etc. 
```

你想要：

```
| ID  | Foo | Bar | Red |
|-----|-----|-----|-----|
| 1   | 100 | 200 | 300 |
| 2   | 400 | ... | ... |
| ... | ... | ... | ... | -- etc. 
```

你可以使用类似的东西：

```
SELECT
  ID,
  MAX(Foo) AS Foo,
  MAX(Bar) AS Bar,
  MAX(Red) AS Red
FROM foobarred
GROUP BY ID 
```

* * *

现在，当 Foo、Bar 和 Red 是 VARCHAR 时，您如何完成类似的操作？

```
| ID  | Foo      | Bar     | Red     |
|-----|----------|---------|---------|
| 1   | 'Text1'  | NULL    | NULL    |
| 1   | NULL     | 'Text2' | NULL    |
| 1   | NULL     | NULL    | 'Text3' |
| 2   | 'Test4'  | NULL    | NULL    |
| ... | ...      | ...     | ...     | -- etc. 
```

到：

```
| ID  | Foo      | Bar     | Red     |
|-----|----------|---------|---------|
| 1   | 'Text1'  | 'Text2' | 'Text3' |
| 2   | 'Text4'  | ...     | ...     |
| ... | ...      | ...     | ...     | -- etc. 
```

* * *

目前主要使用 SQL Server 2000；但可以访问 2005 服务器。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T09:59:44.467

上面的查询对 VARCHAR 字段和对 INT 字段一样适用。但是，您的查询的问题是，如果您有两行具有相同的 ID，并且这两行在“Foo”列中都有某些内容，那么只会显示具有最高值的行（对于 INT 和 VARCHAR） .

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T10:00:27.380

我目前无法访问 SQL2K 框，但 select max(column) 将在 2005 年适用于 nvarchars。唯一的问题是，如果原始表中每个 id 的每列下都有多个文本值...

```
CREATE TABLE Flatten (
    id int not null,
    foo Nvarchar(10) null,
    bar Nvarchar(10) null,
    red Nvarchar(10) null)

INSERT INTO Flatten (ID, foo, bar, red) VALUES (1, 'Text1', null, null)
INSERT INTO Flatten (ID, foo, bar, red) VALUES (1, null, 'Text2', null)
INSERT INTO Flatten (ID, foo, bar, red) VALUES (1, null, null, 'Text3')
INSERT INTO Flatten (ID, foo, bar, red) VALUES (2, 'Text4', null, null)

SELECT 
    ID, 
    max(foo),
    max(bar),
    max(red)
FROM
Flatten
GROUP BY ID 
```

返回

```
ID          Foo        Bar        Red
----------- ---------- ---------- ----------
1           Text1      Text2      Text3
2           Text4      NULL       NULL 
```

# wpf - 更改列表框中内容演示者的前景色

> ID：249671
> 
> 赞同：24
> 
> 时间：2008-10-30T09:35:52.330
> 
> 标签：wpf, foreground, contentpresenter

我为列表框创建了以下样式，该列表框将在某些文本旁边显示图像：

```
<Style x:Key="ImageListBoxStyle" TargetType="{x:Type ListBox}">
    <Setter Property="SnapsToDevicePixels" Value="true"/>
    <Setter Property="BorderThickness" Value="1"/>
    <Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Auto"/>
    <Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
    <Setter Property="ScrollViewer.CanContentScroll" Value="True"/>
    <Setter Property="ItemContainerStyle">
        <Setter.Value>
            <!-- Simple ListBoxItem - This is used for each Item in a ListBox. The item's content is placed in the ContentPresenter -->
            <Style TargetType="{x:Type ListBoxItem}">
                <Setter Property="SnapsToDevicePixels" Value="true"/>
                <Setter Property="OverridesDefaultStyle" Value="true"/>
                <Setter Property="VerticalContentAlignment" Value="Center"/>
                <Setter Property="Template">
                    <Setter.Value>
                        <ControlTemplate TargetType="{x:Type ListBoxItem}">
                            <Grid SnapsToDevicePixels="true">
                                <Border x:Name="Border">
                                    <Grid Height="40">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Image
                                            x:Name="DisplayImage"
                                            Source="{Binding Path=ThumbnailImage}"
                                            Height="30"
                                            Width="30"
                                            Grid.Column="0"/>

                                        <ContentPresenter
                                            x:Name="DisplayText"
                                            HorizontalAlignment="Stretch"
                                            VerticalAlignment="Center"
                                            Grid.Column="1"/>
                                        <!--<ContentPresenter.Resources>
                                                <Style TargetType="{x:Type TextBlock}">
                                                    <Setter Property="Foreground" Value="Black"/>
                                                </Style>
                                            </ContentPresenter.Resources>-->

                                        <!--Content="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType=ListBox}, Path=DisplayMemberPath, Converter={StaticResource myDisplayMemberConverter}}"-->
                                        <!--<Label
                                            x:Name="Text"
                                            Content="{Binding Path=FullNameAndTitle}"
                                            Foreground="Black"
                                            VerticalAlignment="{TemplateBinding VerticalContentAlignment}"
                                            VerticalContentAlignment="Center"
                                            HorizontalAlignment="Stretch"
                                            Grid.Column="1"
                                            Height="40"/>-->
                                    </Grid>
                                </Border>
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsSelected" Value="true">
                                    <!--<Setter Property="FontWeight" Value="Bold" TargetName="DisplayText"/>-->
                                    <!--<Setter Property="Style" Value="{StaticResource SelectedTextStyle}" TargetName="DisplayText"/>-->
                                    <Setter Property="Background" Value="DarkBlue" TargetName="Border"/>
                                    <Setter Property="Width" Value="40" TargetName="DisplayImage"/>
                                    <Setter Property="Height" Value="40" TargetName="DisplayImage"/>
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style>
        </Setter.Value>
    </Setter>
    <Setter Property="Template">
        <Setter.Value>
            <ControlTemplate TargetType="{x:Type ListBox}">
                <Grid>
                    <Border x:Name="Border" Background="{TemplateBinding Background}" BorderBrush="Black" BorderThickness="{TemplateBinding BorderThickness}">
                        <Grid>
                            <ScrollViewer Margin="1,1,1,1" Focusable="false" Background="{TemplateBinding Background}" SnapsToDevicePixels="True">
                                <StackPanel IsItemsHost="true"/>
                            </ScrollViewer>
                        </Grid>
                    </Border>
                </Grid>
                <ControlTemplate.Triggers>
                    <Trigger Property="IsGrouping" Value="true">
                        <Setter Property="ScrollViewer.CanContentScroll" Value="false"/>
                    </Trigger>
                </ControlTemplate.Triggers>
            </ControlTemplate>
        </Setter.Value>
    </Setter>
</Style> 
```

我必须使用 contentpresenter，因为我正在使用 ListBox 本身的 DisplayMemberPath 过滤显示的内容（文本方式）。

我要做的就是在 ListBox 中选择一个项目时将 FontWeight 设置为 Bold 并将 Foreground 设置为 White。

有没有人遇到过这样的问题？我查看了一些相关问题，但人们已经能够使用 TextBlock 来解决他们的问题，但不幸的是我无法解决。

任何人都可以提供的信息将不胜感激。

干杯

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2011-11-23T19:20:26.057

还有另一种方式。您可以添加您的`ContentPresenter`此属性

```
TextBlock.Foreground="YourColour" 
```

在这种情况下，您还可以在该属性上使用动画。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2008-11-03T13:24:22.470

没关系，我已经设法自己回答了这个问题，我试图修改不包含前景/字体重量定义的 contentpresenter 的前景/字体重量，我只需要这样做：

```
<Setter Property="FontWeight" Value="Bold"/>
<Setter Property="Foreground" Value="White"/> 
```

即删除：

```
TargetName="DisplayText" 
```

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2011-11-27T20:51:15.203

基于[这个相关的答案](https://stackoverflow.com/questions/401600/how-do-i-change-the-fontfamily-on-a-contentpresenter)，我能够通过以下方式解决类似的问题：

```
<Setter TargetName="ctContentPresenter" Property="TextBlock.Foreground" Value="{StaticResource StyleForeColorBrush}" /> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-03-13T07:51:15.983

```
 <Storyboard x:Key="Storyboard1">  
       <ColorAnimationUsingKeyFrames Storyboard.TargetProperty="(TextBlock.Foreground).(SolidColorBrush.Color)" Storyboard.TargetName="myContentPresenter">
        <EasingColorKeyFrame KeyTime="0" Value="Black"/>
        <EasingColorKeyFrame KeyTime="0:0:0.2" Value="White"/>
       </ColorAnimationUsingKeyFrames>        
  </Storyboard> 
```

# sql - 报告服务器：“/Reports”应用程序中的服务器错误

> ID：249678
> 
> 赞同：0
> 
> 时间：2008-10-30T09:42:08.493
> 
> 标签：sql, sql-server, reporting-services

我正在尝试在 windows vista iis7 上设置 SQL 报告服务，但是当我尝试[http://localhost/Reports/Pages/Folder.aspx时一直收到此错误](http://localhost/Reports/Pages/Folder.aspx)

> ## “/Reports”应用程序中的服务器错误。
> 
> 请求在此上下文中不可用 说明：在执行当前 Web 请求期间发生未处理的异常。请查看堆栈跟踪以获取有关错误及其源自代码的位置的更多信息。异常详细信息：System.Web.HttpException：请求在此上下文中不可用源错误：在执行当前 Web 请求期间生成了未处理的异常。可以使用下面的异常堆栈跟踪来识别有关异常起源和位置的信息。堆栈跟踪：[HttpException (0x80004005)：请求在此上下文中不可用]
> System.Web.HttpContext.get_Request() +3465893 Microsoft.ReportingServices.UI.Global.get_ConfigurationManager() +47 Microsoft.ReportingServices.UI.GlobalApp.Application_Start(Object sender, EventArgs e) +32 [HttpException (0x80004005): 请求是在此上下文中不可用]
> System.Web.HttpApplicationFactory.EnsureAppStartCalledForIntegratedMode(HttpContext context, HttpApplication app) +3385130 System.Web.HttpApplication.RegisterEventSubscriptionsWithIIS(IntPtr appContext, HttpContext context, MethodInfo[] handlers) +125
> System.Web.HttpApplication.InitSpecial(HttpApplicationState state, MethodInfo[] handlers, IntPtr appContext, HttpContext context) +182 System.Web.HttpApplicationFactory.GetSpecialApplicationInstance(IntPtr appContext, HttpContext context) +259 System.Web.Hosting.PipelineRuntime.InitializeApplication( IntPtr appContext) +245 [HttpException (0x80004005): Request is not available in this context]
> System.Web.HttpRuntime.FirstRequestInit(HttpContext context) +3465475 System.Web.HttpRuntime.EnsureFirstRequestInit(HttpContext context) +69 System.Web.HttpRuntime .ProcessRequestNotificationPrivate(IIS7WorkerRequest WR, HttpContext 上下文) +675

事件查看器向我展示了这样的内容：

> 3005 发生未处理的异常。2008 年 10 月 30 日下午 12:31:56 2008 年 10 月 30 日上午 9:31:56 d6764b0e70d246a590d9a9e8186ef677
> 2 1 0 /LM/W3SVC/1/ROOT/Reports-8-128698327158150000
> RosettaMgr /Reports c:\Program Files SQL Server\MSSQL.4\Reporting Services\ReportManager\ 4756 w3wp.exe NT AUTHORITY\NETWORK SERVICE HttpException 请求在此上下文中不可用
> [http://localhost/Reports/Pages/Folder.aspx](http://localhost/Reports/Pages/Folder.aspx)
> /Reports/Pages/Folder.aspx ::1 False NT AUTHORITY\NETWORK SERVICE 5 NT AUTHORITY\NETWORK SERVICE False 在 System.Web.HttpApplicationFactory.EnsureAppStartCalledForIntegratedMode(HttpContext context, HttpApplication app) at System.Web.HttpApplication.RegisterEventSubscriptionsWithIIS(IntPtr appContext , HttpContext context, MethodInfo[] handlers) at System.Web.HttpApplication.InitSpecial(HttpApplicationState state, MethodInfo[] handlers, IntPtr appContext, HttpContext context) 在 System.Web.HttpApplicationFactory.GetSpecialApplicationInstance(IntPtr appContext, HttpContext context) 在 System. Web.Hosting.PipelineRuntime.InitializeApplication(IntPtr appContext)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T15:05:44.643

看看[http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3459824&SiteID=1](http://forums.microsoft.com/msdn/ShowPost.aspx?PostID=3459824&SiteID=1) - 看起来有人遇到了同样的问题并且能够解决它。

# c# - 使用 Linq 从 C# 代码中避免在 MSSQL Server 上注入 SQL 的最佳方法？

> ID：249681
> 
> 赞同：3
> 
> 时间：2008-10-30T09:43:37.510
> 
> 标签：c#, .net, sql-server-2005, linq-to-sql

使用 Linq 从 C# 代码中避免在 MSSQL Server 上注入 SQL 的最佳方法是什么？

您应该使用函数来消除安全问题还是由框架处理？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T09:45:18.160

错误，您*不能*使用 LINQ 进行 SQL 注入。在幕后 LINQ to SQL 将值转换为参数化查询。

所以是的，它是由框架处理的。

# jquery - jQuery 不会从 AJAX 查询中解析我的 JSON

> ID：249692
> 
> 赞同：88
> 
> 时间：2008-10-30T09:47:17.470
> 
> 标签：jquery, ajax, json

我在使用 jQuery.ajax() 解析从我的服务器返回的一些 JSON 数据时遇到了困难

要执行我正在使用的 AJAX：

```
$.ajax({
  url: myUrl,
  cache: false,
  dataType: "json",
  success: function(data){
    ...
  },
  error: function(e, xhr){
    ...
  }
}); 
```

如果我返回一个项目数组，那么它工作正常：

```
[ { title: "One", key: "1" }, { title: "Two", key: "2" } ] 
```

调用成功函数并接收正确的对象。

但是，当我尝试返回单个对象时：

```
{ title: "One", key: "1" } 
```

调用错误函数并且 xhr 包含“parsererror”。在将它发送到网络之前，我已经尝试将 JSON 包装在服务器上的括号中，但这没有任何区别。然而，如果我将内容粘贴到 Javascript 中的字符串中，然后使用 eval() 函数，它会完美地评估它。

任何想法我做错了什么？

安东尼

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-10-30T10:29:13.347

您的服务器是否将数据作为 Content-Type 发送`"*/json"`？如果不是，请相应地修改响应标头。例如，发送`"application/json"`就可以了。

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2008-10-30T17:45:49.157

根据[json.org](http://json.org)规范，您的退货无效。名称总是被引用，所以你应该回来

```
{ "title": "One", "key": "1" } 
```

和

```
[ { "title": "One", "key": "1" }, { "title": "Two", "key": "2" } ] 
```

这可能不是您的设置的问题，因为您说其中一个现在可以工作，但是应该修复它以确保正确性，以防您将来需要切换到另一个 JSON 解析器。

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2010-03-25T22:45:12.097

JSON 字符串用**双**引号括起来；单引号不是有效的替代品。

```
{"who": "Hello World"} 
```

是有效的，但这不是...

```
{'who': 'Hello World'} 
```

虽然不是 OP 的问题，但认为对于登陆这里的其他人来说值得注意。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2008-10-30T13:56:24.580

这个问题通常是因为您的请求收到了错误的 mime 类型。在您自己的计算机上进行开发时，有时您无法从“服务器”（即您自己的计算机）接收到正确的 mime 类型。我在开发时通过在浏览器中打开本地存储的文件（例如，url 是“c:/project/test.html”）遇到了这个问题。

尝试使用 beforeSend 属性添加一个覆盖 mime 类型的回调函数。尽管服务器发送了错误的 mime 类型并由您的调用代码接收，这将诱使代码处理 json。下面是一些示例代码。

根据[这个问题](https://stackoverflow.com/questions/477816/what-is-the-correct-json-content-type)，正确的 mime 类型是 application/json ，但我确实知道 application/j-son 在我尝试时有效（现在是几年前）。您可能应该先尝试 application/json 。

```
var jsonMimeType = "application/json;charset=UTF-8";
$.ajax({
 type: "GET",
 url: myURL,
 beforeSend: function(x) {
  if(x && x.overrideMimeType) {
   x.overrideMimeType(jsonMimeType);
  }
 },
 dataType: "json",
 success: function(data){
  // do stuff...
 }
}); 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2010-12-16T21:55:52.180

我有这个问题，我用了一段时间

```
eval('('+data+')') 
```

获取对象中返回的数据。但后来又遇到了其他问题，在括号中出现“缺少 )”错误，并发现 jQuery 有一个专门用于评估 json 结构的字符串的函数：

```
$.parseJSON(data) 
```

应该做的伎俩。这当然是除了让你的 json 字符串以正确的格式之外..

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2012-05-16T22:44:00.377

如果您正在回显 json 响应并且您的标头与 */json 不匹配，那么您可以使用内置的 jQuery.parseJSON api 来解析响应。

```
response = '{"name":"John"}';
var obj = jQuery.parseJSON(response);
alert( obj.name === "John" ); 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-30T14:24:38.003

```
{ title: "One", key: "1" } 
```

不是你想的那样。作为一个表达式，它是一个 Object 字面量，但作为一个语句，它是：

```
{                // new block
    title:       // define a label called 'title' for goto statements
        "One",   // statement: the start of an expression which will be ignored
        key:     // ...er, what? you can't have a goto label in the middle of an expression
                 // ERROR 
```

不幸的是 eval() 没有给你一种方法来指定你是给它一个语句还是一个表达式，它往往会猜错。

通常的解决方案确实是在将*任何内容*发送到 eval() 函数之前将其包装在括号中。你说你已经在服务器上试过了......显然不知何故没有通过。在客户端应该是防水的，无论接收到 XMLHttpRequest 响应：

```
eval('('+responseText+')'); 
```

代替：

```
eval(responseText); 
```

只要响应真的是表达而不是陈述。（例如，它没有多个分号或换行符分隔的子句。）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-07-27T04:59:34.467

您必须在 php 中设置标题内容类型，如下所示：

```
 <?php

 header('Content-type:application/json');

 ?> 
```

观看这些视频以更好地理解......

参考：[http ://www.youtube.com/watch?v=EvFXWqEqh6o](http://www.youtube.com/watch?v=EvFXWqEqh6o)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-12-08T21:05:25.097

如果您使用 jQuery 使用 ASP.NET Web 服务，请确保您的 web.config 中包含以下内容：

```
<webServices>
    <protocols>
        <add name="HttpGet"/>
        <add name="HttpPost"/>
    </protocols>
</webServices> 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2010-01-27T11:52:03.053

我遇到了与此类似的问题，其中 Firefox 3.5 运行良好并解析了我的 JSON 数据，但 Firefox 3.0.6 返回了一个 parseerror。原来是 JSON 开头的空格导致 Firefox 3.0.6 抛出错误。删除空格修复了它

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-11-13T00:14:53.393

“eval()”和“JSON.parse()”技术使用互斥格式。

*   带有“eval()”括号是**必需**的。
*   **禁止**使用“JSON.parse()”括号。

请注意，有“stringify()”函数会产生“eval”格式。对于 ajax，您应该只使用 JSON 格式。

虽然“eval”包含了整个 JavaScript 语言，但 JSON 只使用了该语言的一小部分。在 JavaScript 语言中，“eval”必须识别的结构是[“块语句”（又名“复合语句”）](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/block)；这是一对或花括号“{}”，里面有一些语句。但是花括号也用于对象字面量的语法中。解释因代码出现的上下文而异。有些东西对您来说可能看起来像一个对象字面量，但“eval”会将它视为复合语句。

在 JavaScript 语言中，对象字面量出现在赋值的右侧。

```
var myObj = { ...some..code..here... }; 
```

对象文字不会自行出现。

```
{ ...some..code..here... }   // this looks like a compound statement 
```

回到 2008 年提出的 OP 最初的问题，他询问为什么“eval()”中出现以下错误：

```
{ title: "One", key: "1" } 
```

答案是它看起来像一个复合语句。要将其转换为对象，您必须将其放入无法使用复合语句的上下文中。这是通过在它周围加上括号来完成的

```
( { title: "One", key: "1" } )    // not a compound statment, so must be object literal 
```

OP 还询问为什么类似的声明**确实**成功评估：

```
[ { title: "One", key: "1" }, { title: "Two", key: "2" } ] 
```

同样的答案也适用——花括号是在不可能复合语句的上下文中。这是一个数组上下文，“ `[...]`”，数组可以包含对象，但不能包含语句。

与“eval()”不同，JSON 的功能非常有限。限制是故意的。JSON 的设计者想要一个极简的 JavaScript 子集，只使用可能出现在赋值右侧的语法。因此，如果您有一些可以正确解析为 JSON 的代码...

```
var myVar = JSON.parse("...some...code...here..."); 
```

...这意味着它也将在分配的右侧合法地解析，就像这样..

```
var myVar = ...some..code..here... ; 
```

但这不是对 JSON 的唯一限制。JSON的[BNF 语言规范](http://www.json.org)非常简单。例如，它不允许使用单引号来表示字符串（就像 JavaScript 和 Perl 那样），并且它没有办法将单个字符表示为一个字节（就像 'C' 那样）。不幸的是，它也不允许注释（这在创建配置文件时非常好）。所有这些限制的好处是解析 JSON 速度很快，并且没有提供代码注入的机会（安全威胁）。

由于这些限制，JSON 不能使用括号。因此，JSON 字符串中的括号是非法字符。

始终使用带有 ajax 的 JSON 格式，原因如下：

*   将为 JSON 配置一个典型的 ajax 管道。
*   使用“eval()”将被批评为安全风险。

作为 ajax 管道的示例，考虑一个涉及 Node 服务器和 jQuery 客户端的程序。客户端程序使用具有表单的 jQuery 调用`$.ajax({dataType:'json',...etc.});`。JQuery 创建一个 jqXHR 对象供以后使用，然后打包并发送关联的请求。服务器接受请求，处理它，然后准备响应。服务器程序将调用该方法`res.json(data)`来打包并发送响应。回到客户端，jQuery 接受响应，查询相关的 jqXHR 对象，并处理 JSON 格式的数据。这一切都不需要手动数据转换。响应不涉及在 Node 服务器上对 JSON.stringify() 的显式调用，也没有在客户端对 JSON.parse() 的显式调用；这一切都为你处理。

“eval”的使用与代码注入安全风险有关。您可能认为不可能发生这种情况，但黑客可以非常有创意。此外，“eval”对于 Javascript 优化也是有问题的。

如果您发现自己使用了“stringify()”函数，请注意某些具有该名称的函数将创建与“eval”兼容而不与 JSON 兼容的字符串。例如，在 Node 中，以下为您提供了以“eval”兼容格式创建字符串的函数：

```
var stringify = require('node-stringify'); // generates eval() format 
```

这可能很有用，但除非您有特定需求，否则它可能不是您想要的。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-10-30T14:17:19.937

如果返回数组有效而返回单个对象无效，您也可以尝试将单个对象作为包含该单个对象的数组返回：

```
[ { title: "One", key: "1" } ] 
```

这样，无论数据有效负载如何，您都将返回一致的数据结构、对象数组。

我看到您已尝试将单个对象包装在“括号”中，并通过示例提出此建议，因为当然 JavaScript 对待 [ .. ] 与 ( .. ) 不同

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-11-28T04:48:05.977

如果 jQuery 的错误处理程序被调用并且 XHR 对象包含“解析器错误”，那可能是从服务器返回的解析器错误。

当您在没有参数的情况下调用服务时，您的多重结果场景是否存在，但是当您尝试提供参数来检索单个记录时它会中断？

你从哪个后端返回这个？

例如，在 ASMX 服务上，当参数作为 JSON 对象而不是 JSON 字符串提供给 jQuery 时，通常会出现这种情况。如果你为 jQuery 提供一个实际的 JSON 对象作为它的“data”参数，它会将它序列化成标准的 & 分隔的 k,v 对，而不是作为 JSON 发送。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-11-29T16:01:01.050

我发现在我的一些实现中我必须添加：

```
obj = new Object; obj = (data.obj); 
```

这似乎解决了这个问题。评估与否，它似乎对我来说完全一样。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-01-07T23:34:30.673

jQuery 阻塞某些 JSON 键。我在 PHP 中发送了这个 JSON 片段：

```
echo json_encode((object) array('result' => 'success')); 
```

将“结果”键重命名为其他名称有效。我猜这是某种保留字冲突，可能是 jQuery (1.4.2) 中的错误。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2011-04-04T17:40:16.197

在 ColdFusion 环境中，即使使用格式正确的 JSON，也会导致错误的一件事是在 ColdFusion 管理器中**启用启用请求调试输出（在调试和日志记录 > 调试输出设置下）。**调试信息将与 JSON 数据一起返回，从而使其无效。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2012-04-06T13:22:56.803

也试试这个

```
$.ajax({
    url: url,
    data:datas,
    success:function(datas, textStatus, jqXHR){
    var returnedData = jQuery.parseJSON(datas.substr(datas.indexOf('{')));
})}; 
```

在我的情况下，服务器在“{”之前以未知字符响应

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2014-04-23T14:20:15.377

我得到了 status = parseerror 和 xhr.status = 200。

对我来说，问题是 JSON 响应中的 URL 有 '\' 切换到 '/' 解决了这个问题。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2011-04-29T23:50:45.950

我为此苦苦挣扎，花了几个小时试图弄清楚这一点，直到我使用 firebug 来显示数据对象。

```
var data = eval("(" + data.responseText + ")");
console.log(data.count); 
```

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2014-07-22T10:53:11.630

采用

```
$data = yourarray(); 
json_encode($data) 
```

在服务器端。在客户端使用带有数据类型 JSON 的 ajax，并确保您的文档编码不是带有 BOM 的 UTF-8，它必须是 UTF-8。

# c - 为什么我的编译防护不能防止多个定义包含？

> ID：249701
> 
> 赞同：62
> 
> 时间：2008-10-30T09:52:40.970
> 
> 标签：c, linker, multiple-inclusions

我有一个头文件 xh，它包含在多个 *.c 源文件中。这个头文件定义了一些结构变量。

我在头文件的开头放置了多个包含防止保护：

```
#ifndef X_H
#define X_H
...
..
//header file declarations and definitons.

#endif//X_H 
```

在构建时，我得到与多个定义相关的链接器错误。我明白这个问题。

1.  不会像我一样在头文件顶部设置多重包含防止保护，防止头文件 xh 的多重包含，从而避免 xh 中存在的变量的多个定义？

2.  `#pragma`一次在这个特定的编译器上不起作用，那么解决方案是什么？有人将[这个](https://stackoverflow.com/questions/223771/repeated-multiple-definition-errors-from-including-same-header-in-multiple-cpps#223798)答案发布到了类似的问题上。它似乎对我不起作用。这个解决方案是如何工作的？

* * *

## 回答 #1

> 赞同：82
> 
> 时间：2008-10-30T10:15:11.377

如果链接器在抱怨，这意味着您有定义，而不仅仅是标题中的声明。这是一个错误的例子。

```
#ifndef X_H
#define X_H

int myFunc()
{
  return 42; // Wrong! definition in header.
}

int myVar; // Wrong! definition in header.

#endif 
```

您应该将其拆分为源文件和头文件，如下所示：

标题：

```
#ifndef X_H
#define X_H

extern int myFunc();

extern int myVar; 

#endif 
```

来源：

```
int myFunc()
{
  return 42; 
}

int myVar; 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2012-03-06T00:24:13.870

标头保护仅适用于单个编译单元，即源文件。如果您碰巧多次包含一个头文件，也许是因为`main.c`依次包含的所有头文件都包含，`stdio.h`那么守卫会有所帮助。

如果你有一个包含在and中的函数`f`的定义，那么它就像在创建时复制并粘贴到的定义和对创建执行相同的操作一样。然后链接器会抱怨，尽管您有标头保护，但仍然会发生这种情况。由于这些守卫，当然可以有多个语句。`x.h``main.c``util.c``f``main.c``main.o``util.c``util.o``#include "x.h"``main.c`

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-10-30T10:01:32.527

使用包含防护可以防止一个编译单元包含两次标头。例如，如果头文件 Bh 包含 Ah 并且 B.cpp 包含 Ah 和 Bh，如果您不使用包含守卫，则来自 Ah 的所有内容将在编译 B.cpp 中声明两次。

您的包含警卫防止这种情况发生，到目前为止一切都很好。

但是你在链接时得到了多个定义，即两个编译单元定义了同一个东西，这可能意味着你在你的头文件中有一个真正的定义，对所有变量使用 extern，确保函数是内联的或在 cpp 文件中定义。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2010-07-16T23:05:26.360

如果函数不大，您可以在它们之前使用“内联”，链接器不会抱怨。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T09:56:16.483

使用多重包含保护可防止*编译器*错误，但您会遇到链接器错误。头文件中是否有不使用的数据定义`extern`？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-09-21T13:35:24.830

也许`X_H`已经在其他地方定义了？我刚刚遇到了这个问题，Xlib`X_H`在 /usr/include/X11/Xh中定义

要检查，您可以调用`gcc -dM -E`（如果您使用 gcc），例如在我正在使用的构建系统中调用`CC=gcc CFLAGS="-dM -E" make`. 如果输出文件包含`#define X_H`即使您从文件中删除它（`Y_H`例如使用），那么它已经在您的源代码之外定义。

# linux - 一个进程如何拦截Linux上另一个进程的stdout和stderr？

> ID：249703
> 
> 赞同：44
> 
> 时间：2008-10-30T09:55:50.823
> 
> 标签：linux, stdout

我有一些脚本应该停止运行，但会永远挂着。有什么方法可以让我以一种可读的方式弄清楚他们写给 STDOUT 和 STDERR 的内容吗？

例如，我尝试这样做：

```
$ tail -f /proc/(pid)/fd/1 
```

但这并没有真正起作用。无论如何，这是一个很长的镜头。

还有其他想法吗？

`strace`就其本身而言，看到这一点非常冗长且难以理解。

注意：我*只*对他们的输出感兴趣，对其他任何东西都不感兴趣。我有能力自己弄清楚其他事情；这个问题只专注于在启动它*后访问正在运行的进程的 stdout 和 stderr 。*

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-10-30T11:57:31.310

由于我不允许编辑 Jauco 的答案，因此我将给出对我有用的完整答案（Russell 的页面依赖于未保证的行为，如果您关闭 STDOUT 的文件描述符 1，下一次`creat`调用将打开 FD 1。

所以，像这样运行一个简单的无限脚本：

```
import time

while True:
    print 'test'
    time.sleep(1) 
```

将其保存到 test.py，运行

```
$ python test.py 
```

获取 PID：

```
$ ps auxw | grep test.py 
```

现在，附上`gdb`：

```
$ gdb -p (pid) 
```

并`fd`施展魔法：

```
(gdb) call creat("/tmp/stdout", 0600)
$1 = 3
(gdb) call dup2(3, 1)
$2 = 1 
```

现在您可以`tail /tmp/stdout`看到过去用于 STDOUT 的输出。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-09-11T01:07:09.350

有几个新的实用程序封装了“gdb 方法”并添加了一些额外的功能。我现在使用的那个叫做“reptyr”（“Re-PTY-er”）。除了获取 STDERR/STDOUT 之外，它实际上会更改进程的控制终端（即使它之前没有连接到终端）。

最好的用途是启动一个屏幕会话，并使用它将正在运行的进程重新附加到屏幕内的终端，以便您可以安全地与其分离并稍后再回来。

它打包在流行的发行版上（例如：'apt-get install reptyr'）。

[http://onethingwell.org/post/2924103615/reptyr](http://onethingwell.org/post/2924103615/reptyr)

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-30T19:29:30.260

GDB 方法似乎更好，但您也可以使用 来执行此操作`strace`：

```
$ strace -p <PID> -e write=1 -s 1024 -o file 
```

通过手册页`strace`：

```
 -e write=set
               Perform a full hexadecimal and ASCII dump of all the
               data written to file descriptors listed in the spec-
               ified  set.  For example, to see all output activity
               on file descriptors 3 and 5 use -e write=3,5\.   Note
               that  this is independent from the normal tracing of
               the write(2) system call which is controlled by  the
               option -e trace=write. 
```

这打印出来的东西比你需要的多一些（十六进制部分），但你可以`sed`很容易地打印出来。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-10-30T10:02:12.057

我不确定它是否适合你，但我前段时间读了一个页面，描述了[一种使用 gdb 的方法](http://etbe.coker.com.au/2008/02/27/redirecting-output-from-a-running-process/)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-08-09T21:58:25.620

我使用 strace 并解码了十六进制输出以清除文本：

```
PID=some_process_id
sudo strace -f -e trace=write -e verbose=none -e write=1,2 -q -p $PID -o "| grep '^ |' | cut -c11-60 | sed -e 's/ //g' | xxd -r -p" 
```

我从其他答案中结合了这个命令。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2011-12-30T23:46:50.973

`strace``-ewrite`仅使用（而不是`=1`后缀）输出要少得多。而且它比 IMO 的 GDB 方法简单一些。

我用它来查看现有 MythTV 编码作业的进度（`sudo`因为我不拥有编码过程）：

```
$ ps -aef | grep -i handbrake
mythtv   25089 25085 99 16:01 ?        00:53:43 /usr/bin/HandBrakeCLI -i /var/lib/mythtv/recordings/1061_20111230122900.mpg -o /var/lib/mythtv/recordings/1061_20111230122900.mp4 -e x264 -b 1500 -E faac -B 256 -R 48 -w 720
jward    25293 20229  0 16:30 pts/1    00:00:00 grep --color=auto -i handbr

$ sudo strace -ewrite -p 25089
Process 25089 attached - interrupt to quit
write(1, "\rEncoding: task 1 of 1, 70.75 % "..., 73) = 73
write(1, "\rEncoding: task 1 of 1, 70.76 % "..., 73) = 73
write(1, "\rEncoding: task 1 of 1, 70.77 % "..., 73) = 73
write(1, "\rEncoding: task 1 of 1, 70.78 % "..., 73) = 73^C 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-10-14T14:28:03.343

您可以使用重定向（[https://github.com/jerome-pouiller/reredirect/](https://github.com/jerome-pouiller/reredirect/)）。

类型

```
reredirect -m FILE PID 
```

并且输出（标准和错误）将写入 FILE。

reredirect`README`还解释了如何恢复进程的原始状态，如何重定向到另一个命令或仅重定向 stdout 或 stderr。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-10-30T10:22:58.710

你没有说明你的操作系统，但我会说“Linux”。

查看正在写入 stderr 和 stdout 的内容可能无济于事。如果它有用，您可以在启动脚本之前使用 tee(1) 来获取 stderr 和 stdout 的副本。

您可以使用 ps(1) 来查找 wchan。这会告诉您进程正在等待什么。如果您查看 strace 输出，您可以忽略大部分输出并识别最后一个（阻塞的）系统调用。如果它是对文件句柄的操作，您可以在输出中倒退并识别底层对象（文件、套接字、管道等）。从那里答案可能很清楚。

您还可以向进程发送导致其转储核心的信号，然后使用调试器和核心文件来获取堆栈跟踪。

# user-interface - 在 Selenium 中验证排序

> ID：249704
> 
> 赞同：3
> 
> 时间：2008-10-30T09:55:56.767
> 
> 标签：user-interface, sorting, selenium

有人用 Selenium 测试过排序吗？我想验证以不同方式对表格进行排序（az、za、state、date 等）。任何帮助将不胜感激。

/Göran

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2012-06-20T04:34:02.387

**在用selenium**检查它之前，你必须做一些小事。将表值（排序后出现）存储在 a`string`或`array`中。

现在使用 selenium 执行排序并将新列表捕获为

```
string new_list= selenium.gettable("xpath"); 
```

现在比较两个值并检查它们是否相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-14T06:17:30.577

我在我的[博客](http://functionaltestautomation.blogspot.com/2010/11/testing-sorting-feature-of-application.html)上分享了一个测试应用程序排序功能的策略。您可以使用它来自动化验证应用程序排序功能的测试用例。您可以在应用程序的搜索结果页面、项目列表和报告模块等地方使用它。解释的策略不需要创建测试数据并且是完全可扩展的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-26T20:01:05.743

You could use the WebDriver API from Selenium 2.0 (currently in alpha) to return an array of elements with the `findElements` command before and after the sort. This becomes a bit more difficult however if what you're sorting is paginated.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-17T19:58:05.020

您可以像这样获取字段的值：

```
 //div[@id='sortResult']/div[1]/div  (this'd be row 1 of the search result)
 //div[@id='sortResult']/div[2]/div   ( row 2) 
```

（我在这里对 HTML 结构做了一些假设，但你明白我的意思......）

这些可能是非常脆弱的断言，我建议您将这些 xpath 引用锚定到外部容器元素（而不是文档的根，就像许多“自动”工具所做的那样）。

单击排序时，值会更改。您必须找出应该是什么值。

还要注意浏览器与此类 xpath 的兼容性。他们并不总是；）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-28T14:44:06.283

我处理这个问题的方法是将预期的排序结果定义为一个数组，然后迭代从排序页面返回的结果，以确保它们符合我的期望。

它有点慢，但它确实有效。（实际上，我们通过这种方式设法在多个页面上找到了一些低级排序缺陷......）

# bash - bash 脚本停止时运行命令

> ID：249709
> 
> 赞同：6
> 
> 时间：2008-10-30T09:58:12.517
> 
> 标签：bash, macos

当用户停止脚本（使用 ctrl - c）时，我如何在 bash 脚本中执行命令？

目前，我有这个：

```
afplay file.mp3

while true:
do osascript -e "set volume 10"
end 
```

但是我希望它`killall afplay`在用户完成它时执行，无论它是 command-c 还是其他按键。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-10-30T10:05:44.873

`trap 'killall afplay' EXIT`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T10:06:05.717

使用`trap`.

```
trap "kill $pid" INT TERM EXIT 
```

还要避免`killall`or `pkill`，因为它可能会杀死不相关的进程（例如，来自脚本的另一个实例，甚至是不同的脚本）。取而代之的是，将玩家的 PID 放在一个变量中，然后只杀死那个 PID。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T10:08:36.413

您需要`trap`在 bash 脚本中添加一条语句：

```
trap 'killall afplay' EXIT 
```

但是请注意，如果向 bash 进程发送`KILL`信号 (9)，这将不起作用，因为进程无法拦截该信号。

# database - 阿尔法软件 v 9

> ID：249715
> 
> 赞同：0
> 
> 时间：2008-10-30T09:59:20.910
> 
> 标签：database, alpha

我不是“程序员”，但想使用 Alpha Software Platinum v 9 开发数据库应用程序。该应用程序允许用户通过网站列出分类广告并浏览正在出售的物品等。有没有人有使用 Alpha 软件的经验和他们在他们的网站上说真的那么容易吗？同样，我不是程序员，但信息表明您不必使用他们的软件。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T10:04:36.513

我没有使用过该软件，但我的建议是：

**如果没有丰富的编程经验，请勿尝试您所说的内容**。

迟早你需要对你的应用程序进行故障排除（如果你做到了那一步），你将需要编程技能。

# java - 在 Java 中加速 2D 图像 *不*干扰 JMenus

> ID：249718
> 
> 赞同：2
> 
> 时间：2008-10-30T09:59:54.340
> 
> 标签：java, performance, swing, 2d

已经实现的性能提升器： - 获取 GraphicsConfiguration 的兼容图像以进行绘制 - 在 1.5 中启用 OpenGL 管道：由于严重的伪影而无法实现

到目前为止，我很好，该程序的主要异形瓶颈是绘制具有数千个图块的图像。不幸的是它不规则，否则我可以简单地设置像素并缩放它们。我使用 VolatileImages 和自己的渲染例程来加速图像（忽略重绘并使用计时器自行绘制）。结果令人愉悦并且就足够了，但是：选择一个通常悬停在图像部分上方的 JMenu 会受到严重干扰，因为 JMenu 被透支了。不可接受，布局无法更改。

我尝试了 JOGL 的 GLJPanel，但没有明显的性能提升。那么是否有可能使用 VolatileImages（或其他加速相关的轻量级组件，如 GLCanvas）并且仍然获得正常的 JMenu 显示，如果是，如何？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T11:40:38.130

您可以尝试将弹出窗口设置为非轻量级。我不太确定它是否有效，但它可以，因为弹出窗口是一个本地组件，不会被透支。将弹出窗口设置为重量级：JPopupMenu.setDefaultLightWeightPopupEnabled(false)

更多信息：[混合重型和轻型组件](http://www.oracle.com/technetwork/articles/java/mixing-components-433992.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T11:51:59.747

这是一些示例代码：

```
import javax.swing.*;
import java.awt.*;
import java.awt.event.WindowAdapter;
import java.awt.event.WindowEvent;
import java.awt.image.BufferStrategy;
import java.awt.image.BufferedImage;
import java.awt.image.VolatileImage;
import java.io.File;
import java.io.IOException;
import java.util.Timer;
import java.util.TimerTask;

public final class FastDraw extends JFrame {

    private static final transient double NANO = 1.0e-9;
    private BufferStrategy bs;
    private BufferedImage frontImg;
    private BufferedImage backImg;
    private int PIC_WIDTH,
    PIC_HEIGHT;
    private Timer timer;

    public FastDraw() {
        timer = new Timer(true);
        JMenu menu = new JMenu("Dummy");
        menu.add(new JMenuItem("Display me !"));
        menu.add(new JMenuItem("Display me, too !"));
        JMenuBar menuBar = new JMenuBar();
        menuBar.add(menu);
        setJMenuBar(menuBar);
        setIgnoreRepaint(true);
        setVisible(true);

        addWindowListener(new WindowAdapter() {
            public void windowClosing(WindowEvent evt) {
                super.windowClosing(evt);
                timer.cancel();
                dispose();
                System.exit(0);
            }
        });

        try {
            backImg = javax.imageio.ImageIO.read(new File(<insert a jpg picture here>));
            frontImg = javax.imageio.ImageIO.read(<here, too>));
        }
        catch (IOException e) {
            System.out.println(e.getMessage());
        }

        PIC_WIDTH = backImg.getWidth();
        PIC_HEIGHT = backImg.getHeight();
        setSize(PIC_WIDTH, PIC_HEIGHT);

        createBufferStrategy(1); // Double buffering
        bs = getBufferStrategy();
        timer.schedule(new Drawer(),0,20);

    }

    public static void main(String[] args) {
        new FastDraw();
    }

    private class Drawer extends TimerTask {
        private VolatileImage img;

        public void run() {
            long begin = System.nanoTime();
            Graphics2D  g  = (Graphics2D) bs.getDrawGraphics();
            GraphicsConfiguration gc = g.getDeviceConfiguration();

            if (img == null)
                img = gc.createCompatibleVolatileImage(PIC_WIDTH, PIC_HEIGHT);

            Graphics2D g2 = img.createGraphics();

            do {
                int valStatus = img.validate(gc);

                if (valStatus == VolatileImage.IMAGE_OK)
                    g2.drawImage(backImg,0,0,null);
                else {
                    g.drawImage(frontImg, 0, 0, null);
                }
                // volatile image is ready
                g.drawImage(img,0,50,null);
                bs.show();
            } while (img.contentsLost());
        }
    }
} 
```

Resize the window to make the `JMenuBar` visible. Try to select a menu point. See?

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T10:51:36.967

好吧，我不确定我是否完全理解您的问题，但似乎主要问题是重新绘制显示图像的面板。您是否应该提供在面板上绘制图像的绘图例程？

# algorithm - 递归计算支配树的有效方法？

> ID：249720
> 
> 赞同：16
> 
> 时间：2008-10-30T10:00:52.980
> 
> 标签：algorithm, graph-theory, compiler-theory

我正在使用带有路径压缩的 Lengauer 和 Tarjan 算法来计算具有数百万个节点的图的支配树。该算法非常复杂，我不得不承认我没有花时间完全理解它，我只是在使用它。现在我需要计算根节点的直接子节点的支配树，并可能将图形向下递归到某个深度，重复此操作。即，当我为根节点的子节点计算支配树时，我想假装根节点已从图中删除。

我的问题是，是否有一个有效的解决方案，利用已经在初始支配树中为根节点计算的直接支配信息？换句话说，我不想为每个孩子从头开始，因为整个过程非常耗时。

天真地看起来这一定是可能的，因为在图表的深处会有很多节点，它们的 idms 就在它们上方一点点，并且不受图表顶部的变化的影响。

顺便说一句：支配树的主题由编译器人员“拥有”并且在经典图论书籍中没有提到它，这很奇怪。我使用它的应用程序——我的 FindRoots java 堆分析器——与编译器理论无关。

澄清：我在这里谈论有向图。我指的“根”实际上是可达性最大的节点。我已经更新了上面的文本，用“graph”替换了对“tree”的引用。我倾向于将它们视为树木，因为形状*主要是*树状。该图实际上是 Java 堆中的对象，并且您可以想象它是合理的层次结构。我发现支配树在进行 OOM 泄漏分析时很有用，因为您感兴趣的是“是什么让这个对象保持活力？” 答案最终是它的支配者。支配树可以让你<ahem>看到树林而不是树木。但有时很多垃圾会漂浮到树顶，所以你有一个根，下面有成千上万个孩子。对于这种情况，我想尝试计算以根的每个直接子节点（在原始图中）为根的支配树，然后可能会向下一层等等。（我暂时不担心反向链接的可能性：）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-31T09:07:02.997

[`boost::lengauer_tarjan_dominator_tree_without_dfs`](http://www.boost.org/doc/libs/1_36_0/libs/graph/doc/lengauer_tarjan_dominator.htm)可能有帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T16:11:25.603

从缺乏评论来看，我猜 Stackoverflow 上没有多少人有相关经验可以帮助你。我就是其中的一员，但我不希望这样一个有趣的问题随着沉闷的砰砰声而落空，所以我会试着伸出援助之手。

我的第一个想法是，如果这个图是由其他编译器生成的，是否值得看一下开源编译器，比如 GCC，看看它是如何解决这个问题的？

我的第二个想法是，您问题的主要观点似乎是避免重新计算树根的结果。

我要做的是围绕每个节点创建一个包装器，其中包含节点本身以及与该节点关联的任何预先计算的数据。然后将使用这些包装类递归地从旧树重建一棵新树。当你构建这棵树时，你将从根开始，一直到叶节点。对于每个节点，您将存储迄今为止所有祖先的计算结果。这样，您应该只需要查看父节点和您正在处理的当前节点数据来计算新节点的值。

我希望这会有所帮助！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T20:53:23.600

您能否详细说明您从哪种图表开始？我看不出作为树的图与该图的支配树之间有什么区别。每个节点的父节点都应该是它的 idom，它当然会被树中它上面的所有东西所支配。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T10:27:55.600

我不完全理解你的问题，但在我看来你想要一些增量更新功能。不久前我研究了他们的算法是什么，但在我看来，没有已知的方法可以让大图快速做到这一点（至少从理论的角度来看）。

您可以只搜索“增量更新支配树”来查找一些参考资料。

我猜你知道[Eclipse 内存分析器](http://www.eclipse.org/mat/)确实使用支配树，所以这个主题不再完全由编译器社区“拥有”:)

# c# - 如何将 DateTime 从 JSON 转换为 C#？

> ID：249721
> 
> 赞同：18
> 
> 时间：2008-10-30T10:01:10.563
> 
> 标签：c#, json, serialization, silverlight-2.0

> **可能重复：**
> [如何将 UNIX 时间戳转换为 DateTime，反之亦然？](https://stackoverflow.com/questions/249760/how-to-convert-unix-timestamp-to-datetime-and-vice-versa)

我有以下课程：

```
[DataContractAttribute]
public class TestClass
{
  [DataMemberAttribute]
  public DateTime MyDateTime { get; set; }
} 
```

这是 JSON：

```
{ "MyDateTime":"1221818565" } 
```

JSON 是从 PHP 网络服务返回的。

我需要做的是将该纪元字符串转换为有效的 C# DateTime。这样做的最佳方法是什么？

我可以做这个：

```
[IgnoreDataMemberAttribute]
public DateTime MyDateTime { get; set; }

[DataMemberAttribute(Name = "MyDateTime")]
public Int32 MyDateTimeTicks
{
  get { return this.MyDateTime.Convert(...); }
  set { this.Created = new DateTime(...); }
} 
```

但是这样做的问题是，MyDateTimeTicks 是公共的（将其更改为私有会导致序列化过程中出现异常）

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-10-31T00:58:51.873

完成您发布的内容并将其设为私有似乎对我来说效果很好。

```
[DataContract]
public class TestClass
{

    private static readonly DateTime unixEpoch = new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc);

    [IgnoreDataMember]
    public DateTime MyDateTime { get; set; }

    [DataMember(Name = "MyDateTime")]
    private int MyDateTimeTicks
    {
        get { return (int)(this.MyDateTime - unixEpoch).TotalSeconds; }
        set { this.MyDateTime = unixEpoch.AddSeconds(Convert.ToInt32(value)); }
    }

} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-08-09T16:29:54.193

```
private DateTime ConvertJsonStringToDateTime(string jsonTime)
        {
            if (!string.IsNullOrEmpty(jsonTime) && jsonTime.IndexOf("Date") > -1)
            {
                string milis = jsonTime.Substring(jsonTime.IndexOf("(") + 1);
                string sign = milis.IndexOf("+") > -1 ? "+" : "-";
                string hours = milis.Substring(milis.IndexOf(sign));
                milis = milis.Substring(0, milis.IndexOf(sign));
                hours = hours.Substring(0, hours.IndexOf(")"));
                return new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc).AddMilliseconds(Convert.ToInt64(milis)).AddHours(Convert.ToInt64(hours) / 100);                 
            }

            return DateTime.Now;
        } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-30T21:13:19.830

这就是我想出的。在 C# 中，您似乎需要创建一个新的 DateTime 并将 epoch 值作为“秒”添加到此 DateTime。这是它在代码中的样子：

```
new System.DateTime(1970, 1, 1, 0, 0, 0, 0).AddSeconds(1221818565); 
```

使用 Visual Studio 即时窗口时，我将此操作的结果打印到调试器控制台：

```
{9/19/2008 10:02:45 AM}
    Date: {9/19/2008 12:00:00 AM}
    Day: 19
    DayOfWeek: Friday
    DayOfYear: 263
    Hour: 10
    Kind: Unspecified
    Millisecond: 0
    Minute: 2
    Month: 9
    Second: 45
    Ticks: 633574153650000000
    TimeOfDay: {10:02:45}
    Year: 2008 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-02-17T00:36:49.190

我知道您的问题是针对 PHP 的，但我只想指出 .NET JSON 的“陷阱”：看起来 .NET 以“自纪元以来的毫秒数”（而不是秒数）为单位提供了日期。在这种情况下，AddSeconds 行应该是： `unixEpoch.AddMilliseconds(Int64.Parse(date));`

更多信息：http: [//blogs.msdn.com/b/marcelolr/archive/2008/03/05/system-datetime-ticks-vs-json-date.aspx](http://blogs.msdn.com/b/marcelolr/archive/2008/03/05/system-datetime-ticks-vs-json-date.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T21:27:43.033

你想要的是以下内容：

```
DateTime unixEpoch = new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc);
DateTime dotnetTime = unixEpoch.AddSeconds(Convert.ToDouble(ticks)); 
```

`ticks`PHP 传递给您的值在哪里。

# sharepoint - 如何从 SharePoint 的“网站操作”菜单中删除项目？

> ID：249724
> 
> 赞同：4
> 
> 时间：2008-10-30T10:01:54.883
> 
> 标签：sharepoint, moss

如何自定义站点操作菜单以删除或重命名“标准”菜单项？站点操作菜单项在哪里定义？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T13:13:59.160

站点操作菜单在 12 hive 下的 Template\layouts\editingMenu 中的 Siteaction.xml 中定义。以下链接显示了如何手动删除项目。

[自定义站点操作菜单](http://blog.avanadeadvisor.com/blogs/marcorizzi/archive/2008/07/23/11483.aspx)

我已经使用功能向菜单添加了选项，但从未尝试在代码中隐藏 OTB 选项。我会对你的结果感兴趣。

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-11-03T02:17:47.170

`ConfigMenu="Delete"`通过在 SiteActions.xml 的相关 XML 节点中使用，我能够隐藏我想要隐藏的菜单项。例如

```
 <ConsoleNode ConfigMenu="Delete" ChangedNodeID="wsaCreateSite" /> 
```

ConfigMenu 的有效值记录在[http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.publishing.webcontrols.configmenuoptions.aspx](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.publishing.webcontrols.configmenuoptions.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T22:22:57.727

我使用了一个运行 javascript 的控件来为特定权限级别的用户隐藏整个站点操作菜单。

如果您需要删除特定用户的项目，这种方法可能是一种选择。

然而，这并不是世界上最经典的方法。

# url - 在 Jython 中按长度对 URL 列表进行排序

> ID：249729
> 
> 赞同：0
> 
> 时间：2008-10-30T10:02:52.087
> 
> 标签：url, list, sorting, jython

我正在编写一个 Jython 脚本来对 URL 列表进行排序。

我有一个看起来像这样的列表：

[http://www.domain.com/folder1/folder2/|,1](http://www.domain.com/folder1/folder2/|,1)
[http://www.domain.com/folder1/|,1](http://www.domain.com/folder1/|,1)
[http://www.domain.com/folder1/folder2/folder3/|, 1](http://www.domain.com/folder1/folder2/folder3/|,1)
[http://www.domain.com/folder1/|,1](http://www.domain.com/folder1/|,1)
[http://www.domain.com/folder1/folder2/|,1](http://www.domain.com/folder1/folder2/|,1)
[http://www.domain.com/folder1/folder2/|,1](http://www.domain.com/folder1/folder2/|,1)
[http://www.domain.com/folder1/folder2/folder3/|,1](http://www.domain.com/folder1/folder2/folder3/|,1)

管道和逗号将路径与该路径下的文件数量分开。是否有可能使用 Jython 按长度对 URL 进行排序，所以它最终看起来像下面的列表：

[http://www.domain.com/folder1/|,1](http://www.domain.com/folder1/|,1)
[http://www.domain.com/folder1/|,1](http://www.domain.com/folder1/|,1)
[http://www.domain.com/folder1/folder2/|,1](http://www.domain.com/folder1/folder2/|,1)
[http:// /www.domain.com/folder1/folder2/|,1](http://www.domain.com/folder1/folder2/|,1)
[http://www.domain.com/folder1/folder2/|,1](http://www.domain.com/folder1/folder2/|,1)
[http://www.domain.com/folder1/folder2/folder3/|,1](http://www.domain.com/folder1/folder2/folder3/|,1)
[http://www.domain.com/folder1/folder2/folder3/|,1](http://www.domain.com/folder1/folder2/folder3/|,1)

希望你们明白我的意思，任何帮助将不胜感激。干杯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T10:24:35.883

使用排序函数按长度排序：

```
urls.sort(lambda a, b: cmp(len(a), len(b))) 
```

出于性能考虑，有些人可能更喜欢 decorate-sort-undecorate 模式：

```
urllengths= [(len(url), url) for url in urls]
urllengths.sort()
urls= [url for (l, url) in urllengths] 
```

或作为单行：

```
urls= zip(*sorted((len(url), url) for url in urls))[1] 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T10:33:41.777

在 jython 赶上*python 2.4*之前，您不能将*key*参数用于*list.sort()*：

```
mylist.sort(key=len) 
```

所以，就像在过去的美好时光一样，我们有[decorate-sort-undecorate](http://code.activestate.com/recipes/52234/)成语。为了`mylist`按项目长度排序，我们生成一个`decorated_list`元`(len(item),item)`组，对其进行排序，最后剥离项目：

```
decorated_list = zip(map(len, mylist), mylist)
decorated_list.sort()
sorted_list = [i[1] for i in decorated_list] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T10:08:38.393

对它们进行排序不会解决这个问题吗？

# visual-studio-2008 - 是否可以在 SDK 仿真器中部署和调试 PocketPC 应用程序而不使用 ActiveSync？

> ID：249747
> 
> 赞同：1
> 
> 时间：2008-10-30T10:17:37.707
> 
> 标签：visual-studio-2008, emulation, pocketpc

我目前正在开发一个 PPC 应用程序，我想在不使用 Active Sync 的情况下在 PPC 模拟器“USA Windows mobile 5.0 PC R2 Emulator”中进行测试。在我脑后的某个地方，我认为我已经能够做到这一点：但是当我使用 Visual Studio 启动调试会话时，它无法将应用程序部署到模拟器。我在构建日志中得到的只是：

```
9>------ Deploy started: Project: DLL1, Configuration: Debug Salsa ARMv4 Windows Mobile 5.0 Pocket PC SDK (ARMV4I) ------
9>There are no more files.
9>
10>------ Skipped Deploy: Project: DLL2, Configuration: Debug Salsa ARMv4 Windows Mobile 5.0 Pocket PC SDK (ARMV4I) ------
10>Project not selected to build for this solution configuration 
11>------ Deploy started: Project: DLL3, Configuration: Debug Salsa ARMv4 Windows Mobile 5.0 Pocket PC SDK (ARMV4I) ------
11>There are no more files.
11>

========== Build: 0 succeeded, 0 failed, 7 up-to-date, 5 skipped ==========
========== Deploy: 3 succeeded, 2 failed, 7 skipped ========== 
```

如果我支持它（使用设备模拟器管理器）并让设备通过 ActiveSync 同步，那么 Visual Studio 可以部署和调试。但我想在不通过 ActiveSync 连接的情况下调试一些连接问题。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-23T13:51:01.657

实际的问题是，当我构建项目并尝试部署它时，我有不同的目标设备。最后，VS 会将一个文件部署到 ActiveSync 设备，将一个文件部署到模拟器，依此类推。它没有工作并不令人惊讶。如果我为当前项目更改了目标设备，它不会为其他项目更改它...

因此，如果您在使用 Visual Studio 进行部署并且解决方案中有多个项目时遇到问题，请确保它们都使用相同的目标设备。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T11:02:28.833

从您的构建日志中，您的目标是**ARMv4**处理器。您需要以**Win32（WCE 模拟器）**为目标才能通过模拟器使用和调试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-11-04T15:15:02.810

老实说，我认为在连接时无法测试“无线”应用程序。如果您通过无线连接进行调试，情况也是如此。调试过程会对你的 coms 产生影响。首先，HH 通常比我们希望的更聪明。有线时，他们使用该路径连接到网络。（像水一样）

假设您的 IDE 加强了连接，因此您可以进行调试。那么您并没有真正准确地进行测试。另一方面，假设您的连接带宽受到调试的影响。好吧，这又不准确。

我会在您的应用程序 coms' 中添加一个日志。

通常，我有一个日志文件，该文件在 coms 启动时生成，并在 coms 完成时关闭。这个日志文件不需要太多逻辑，实际上是我准备发布时留在应用程序中的东西。没有什么比让客户在出现问题时向您发送日志文件更好的了。开销非常低，因为它总是重新开始。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T19:29:20.010

默认情况下，它应该在没有 ActiveSync 的情况下工作。我能想到的唯一问题是您已将模拟器传输设置为“TCP 连接传输”，这需要 ActiveSync 连接。

在工具/选项/设备中，选择“USA Windows mobile 5.0 PC R2 Emulator”并选择属性。确保传输设置为“DMA 传输”。

希望有帮助。

# asp.net - 开发多层、高可用性 Web 应用程序时要考虑哪些应用程序设计方面？

> ID：249757
> 
> 赞同：1
> 
> 时间：2008-10-30T10:28:17.403
> 
> 标签：asp.net, sql-server-2005, iis, high-availability

该应用程序计划使用 ASP.NET、.NET Remoting 和 MS SQL Server 构建。表示层、应用层和数据库都需要高可用性。

与 IIS 6.0 相比，IIS 7.0 在高可用性方面有什么优势吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T11:34:25.680

在您要考虑的许多方面中，请确保您有数字。

通过数字，我的意思是您每秒要发送多少个请求？你计划每天有多少用户？他们都将在 1 小时内到达还是全天到达？他们只是在电子商务网站上购买东西，还是一个包含大量图片和视频的社交网络网站？

所有这些问题都对您将如何构建您的网站很重要。如果您使用一个不会崩溃的简单电子商务网站，请确保有 2 台具有负载平衡功能的服务器，并对 IIS 进程进行一些健康监控。对于数据库，一台机器就可以解决问题，特别是如果您有一些 RAID 硬盘驱动器。

但是，如果您访问社交网站……事情会变得异常快。如果用户上传图片，您将需要大量空间，如果他们上传视频，则需要更多空间。您可能希望使用云服务来托管这些图片，而无需支付太多费用。对于视频，您可能希望使用 Youtube 或 Google 视频等嵌入链接。

至于 IIS 7.0 与 IIS 6.0，我认为不会有任何重大变化。两者都非常可靠。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T11:28:03.180

查看[高可扩展性博客](http://highscalability.com/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T11:42:16.537

确保您的设计以水平方式缩放。

也就是说，让您的系统隐藏在负载平衡层后面，而实际上在负载平衡层后面提供服务的服务器。

当您需要增加容量时，您可以构建一个或多个新服务器并将其与现有服务器一起插入。然后，您配置负载平衡层以在分发工作时也考虑新服务器。

# c# - 如何将 Unix 时间戳转换为 DateTime，反之亦然？

> ID：249760
> 
> 赞同：888
> 
> 时间：2008-10-30T10:30:29.927
> 
> 标签：c#, datetime, unix, epoch, data-conversion

有这个示例代码，但它开始谈论毫秒/纳秒问题。

同样的问题在 MSDN 上，*[Seconds since the Unix epoch in C#](https://docs.microsoft.com/archive/blogs/brada/seconds-since-the-unix-epoch-in-c)*。

这是我到目前为止所得到的：

```
public Double CreatedEpoch
{
  get
  {
    DateTime epoch = new DateTime(1970, 1, 1, 0, 0, 0, 0).ToLocalTime();
    TimeSpan span = (this.Created.ToLocalTime() - epoch);
    return span.TotalSeconds;
  }
  set
  {
    DateTime epoch = new DateTime(1970, 1, 1, 0, 0, 0, 0).ToLocalTime();
    this.Created = epoch.AddSeconds(value);
  }
} 
```

* * *

## 回答 #1

> 赞同：1176
> 
> 时间：2008-10-30T14:42:17.483

这是您需要的：

```
public static DateTime UnixTimeStampToDateTime( double unixTimeStamp )
{
    // Unix timestamp is seconds past epoch
    DateTime dateTime = new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc);
    dateTime = dateTime.AddSeconds( unixTimeStamp ).ToLocalTime();
    return dateTime;
} 
```

或者，对于 Java（这是不同的，因为时间戳以毫秒为单位，而不是秒）：

```
public static DateTime JavaTimeStampToDateTime( double javaTimeStamp )
{
    // Java timestamp is milliseconds past epoch
    DateTime dateTime = new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc);
    dateTime = dateTime.AddMilliseconds( javaTimeStamp ).ToLocalTime();
    return dateTime;
} 
```

* * *

## 回答 #2

> 赞同：545
> 
> 时间：2014-10-06T22:17:46.127

最新版本的[.NET (v4.6)](http://www.visualstudio.com/en-us/news/vs2015-preview-vs#Net)添加了对 Unix 时间转换的内置支持。这包括以秒或毫秒表示的往返 Unix 时间。

*   以秒为单位的 Unix 时间到 UTC `DateTimeOffset`：

```
DateTimeOffset dateTimeOffset = DateTimeOffset.FromUnixTimeSeconds(1000); 
```

*   `DateTimeOffset`以秒为单位的 Unix 时间：

```
long unixTimeStampInSeconds = dateTimeOffset.ToUnixTimeSeconds(); 
```

*   以毫秒为单位的 Unix 时间到 UTC `DateTimeOffset`：

```
DateTimeOffset dateTimeOffset = DateTimeOffset.FromUnixTimeMilliseconds(1000000); 
```

*   `DateTimeOffset`以毫秒为单位的 Unix 时间：

```
long unixTimeStampInMilliseconds = dateTimeOffset.ToUnixTimeMilliseconds(); 
```

* * *

注意：这些方法与 UTC 相互转换`DateTimeOffset`。要获得`DateTime`表示，只需使用`DateTimeOffset.UtcDateTime`or`DateTimeOffset.LocalDateTime`属性：

```
DateTime dateTime = dateTimeOffset.UtcDateTime; 
```

* * *

## 回答 #3

> 赞同：223
> 
> 时间：2011-09-29T11:12:52.673

DateTime 到 UNIX 时间戳：

```
public static double DateTimeToUnixTimestamp(DateTime dateTime)
{
    return (TimeZoneInfo.ConvertTimeToUtc(dateTime) - 
           new DateTime(1970, 1, 1, 0, 0, 0, 0, System.DateTimeKind.Utc)).TotalSeconds;
} 
```

* * *

## 回答 #4

> 赞同：48
> 
> 时间：2012-04-13T19:55:35.063

来自[维基百科](https://en.wikipedia.org/wiki/Coordinated_Universal_Time#Daylight_saving_time)：

> UTC 不会随着季节的变化而变化，但如果时区管辖区遵守夏令时（夏令时），当地时间或民用时间可能会发生变化。例如，美国东海岸的当地时间在冬季比 UTC 时间晚 5 小时，但在当地实行夏令时时比 UTC 时间晚 4 小时。

所以这是我的代码：

```
TimeSpan span = (DateTime.UtcNow - new DateTime(1970, 1, 1, 0, 0, 0, 0,DateTimeKind.Utc));
double unixTime = span.TotalSeconds; 
```

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2014-07-23T08:57:13.517

小心，如果您需要高于毫秒的精度！

.NET (v4.6) 方法（例如**FromUnixTimeMilliseconds**）不提供这种精度。

**AddSeconds**和**AddMilliseconds**也切断了双精度的微秒。

这些版本具有高精度：

**Unix -> 日期时间**

```
public static DateTime UnixTimestampToDateTime(double unixTime)
{
    DateTime unixStart = new DateTime(1970, 1, 1, 0, 0, 0, 0, System.DateTimeKind.Utc);
    long unixTimeStampInTicks = (long) (unixTime * TimeSpan.TicksPerSecond);
    return new DateTime(unixStart.Ticks + unixTimeStampInTicks, System.DateTimeKind.Utc);
} 
```

**日期时间 -> Unix**

```
public static double DateTimeToUnixTimestamp(DateTime dateTime)
{
    DateTime unixStart = new DateTime(1970, 1, 1, 0, 0, 0, 0, System.DateTimeKind.Utc);
    long unixTimeStampInTicks = (dateTime.ToUniversalTime() - unixStart).Ticks;
    return (double) unixTimeStampInTicks / TimeSpan.TicksPerSecond;
} 
```

* * *

## 回答 #6

> 赞同：28
> 
> 时间：2020-04-23T06:44:14.000

您可以使用 **DateTimeOffset**。

例如。我有 DateTime 对象

```
var dateTime1 = DateTime.Now; 
```

如果我想将它转换为Unix时间戳，我可以实现如下

```
var unixTimeSeconds = new DateTimeOffset(dateTime1).ToUnixTimeSeconds() 
```

如果要将 unix timeStamp 转换为普通 DateTime，可以使用以下代码：

```
var dateTime2 = DateTimeOffset.FromUnixTimeSeconds(unixTimeSeconds).LocalDateTime; 
```

或者

```
var dateTime2 = DateTimeOffset.FromUnixTimeSeconds(unixTimeSeconds).UtcDateTime; 
```

欲了解更多信息，请访问此链接：

[DateTimeOffset.ToUnixTimeSeconds 方法](https://docs.microsoft.com/en-us/dotnet/api/system.datetimeoffset.tounixtimeseconds?view=netframework-4.8)，
[DateTimeOffset.FromUnixTimeSeconds](https://docs.microsoft.com/en-us/dotnet/api/system.datetimeoffset.fromunixtimeseconds?view=netframework-4.8)

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2015-04-28T01:22:11.000

请参阅[IdentityModel.EpochTimeExtensions](https://github.com/IdentityModel/IdentityModel/blob/master/source/IdentityModel.Shared/EpochTimeExtensions.cs)

```
public static class EpochTimeExtensions
{
    /// <summary>
    /// Converts the given date value to epoch time.
    /// </summary>
    public static long ToEpochTime(this DateTime dateTime)
    {
        var date = dateTime.ToUniversalTime();
        var ticks = date.Ticks - new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc).Ticks;
        var ts = ticks / TimeSpan.TicksPerSecond;
        return ts;
    }

    /// <summary>
    /// Converts the given date value to epoch time.
    /// </summary>
    public static long ToEpochTime(this DateTimeOffset dateTime)
    {
        var date = dateTime.ToUniversalTime();
        var ticks = date.Ticks - new DateTimeOffset(1970, 1, 1, 0, 0, 0, TimeSpan.Zero).Ticks;
        var ts = ticks / TimeSpan.TicksPerSecond;
        return ts;
    }

    /// <summary>
    /// Converts the given epoch time to a <see cref="DateTime"/> with <see cref="DateTimeKind.Utc"/> kind.
    /// </summary>
    public static DateTime ToDateTimeFromEpoch(this long intDate)
    {
        var timeInTicks = intDate * TimeSpan.TicksPerSecond;
        return new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc).AddTicks(timeInTicks);
    }

    /// <summary>
    /// Converts the given epoch time to a UTC <see cref="DateTimeOffset"/>.
    /// </summary>
    public static DateTimeOffset ToDateTimeOffsetFromEpoch(this long intDate)
    {
        var timeInTicks = intDate * TimeSpan.TicksPerSecond;
        return new DateTimeOffset(1970, 1, 1, 0, 0, 0, TimeSpan.Zero).AddTicks(timeInTicks);
    }
} 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2012-10-07T16:14:31.530

为了补充 ScottCher 的回答，我最近发现自己处于令人讨厌的场景中，即在输入数据集中任意混合了秒和毫秒 UNIX 时间戳。以下代码似乎可以很好地处理这个问题：

```
static readonly DateTime UnixEpoch = new DateTime(1970, 1, 1, 0, 0, 0, 0, DateTimeKind.Utc);
static readonly double MaxUnixSeconds = (DateTime.MaxValue - UnixEpoch).TotalSeconds;

public static DateTime UnixTimeStampToDateTime(double unixTimeStamp)
{
   return unixTimeStamp > MaxUnixSeconds
      ? UnixEpoch.AddMilliseconds(unixTimeStamp)
      : UnixEpoch.AddSeconds(unixTimeStamp);
} 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2015-07-23T13:09:16.860

Unix 时间转换是 .NET Framework 4.6 中的新增功能。

您现在可以更轻松地将日期和时间值与 .NET Framework 类型和 Unix 时间相互转换。例如，在 JavaScript 客户端和 .NET 服务器之间转换时间值时，这可能是必需的。[DateTimeOffset 结构](https://docs.microsoft.com/dotnet/api/system.datetimeoffset)中添加了以下 API ：

```
static DateTimeOffset FromUnixTimeSeconds(long seconds)
static DateTimeOffset FromUnixTimeMilliseconds(long milliseconds)
long DateTimeOffset.ToUnixTimeSeconds()
long DateTimeOffset.ToUnixTimeMilliseconds() 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2018-11-11T10:53:22.567

```
var dt = DateTime.Now; 
var unixTime = ((DateTimeOffset)dt).ToUnixTimeSeconds(); 
```

// 1510396991

```
var dt = DateTimeOffset.FromUnixTimeSeconds(1510396991); 
```

// [11.11.2017 10:43:11 +00:00]

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2011-04-12T20:34:51.730

仅通过将转换与 1/1/1970 进行比较，没有本地时间调整，我就找到了正确的答案；

```
DateTime date = new DateTime(2011, 4, 1, 12, 0, 0, 0);
DateTime epoch = new DateTime(1970, 1, 1, 0, 0, 0, 0);
TimeSpan span = (date - epoch);
double unixTime =span.TotalSeconds; 
```

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2019-02-16T11:42:50.270

从 .net 4.6 开始，您可以这样做：

```
var dateTime = DateTimeOffset.FromUnixTimeSeconds(unixDateTime).DateTime; 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2019-09-04T14:37:31.303

编写了一个对我们有用的最简单的扩展。如果有人找...

```
public static class DateTimeExtensions
{
    public static DateTime FromUnixTimeStampToDateTime(this string unixTimeStamp)
    {

        return DateTimeOffset.FromUnixTimeSeconds(long.Parse(unixTimeStamp)).UtcDateTime;
    }
} 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2021-08-05T08:07:58.263

Unix 纪元现在是 DateTime 类的一部分。将毫秒转换为 DateTime 就像

```
DateTime.UnixEpoch.AddMilliseconds(millis) 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2019-09-17T12:38:50.900

```
System.DateTimeOffset.Now.ToUnixTimeSeconds() 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2021-09-18T03:24:43.203

在 C# 8.0 (.NET Core 2.1) 中，它是一个简单的单行：

```
DateTime.UnixEpoch.AddSeconds(unixTimeInSeconds) 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2014-08-12T17:26:21.007

```
DateTime unixEpoch = DateTime.ParseExact("1970-01-01", "yyyy-MM-dd", System.Globalization.CultureInfo.InvariantCulture);
DateTime convertedTime = unixEpoch.AddMilliseconds(unixTimeInMillisconds); 
```

当然，可以做`unixEpoch`一个全局静态的，所以它只需要在你的项目中出现一次，`AddSeconds`如果UNIX时间以秒为单位就可以使用。

走另一条路：

```
double unixTimeInMilliseconds = timeToConvert.Subtract(unixEpoch).TotalMilliseconds; 
```

截断为 Int64 和/或`TotalSeconds`根据需要使用。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-10-30T10:53:34.340

一个 Unix 滴答是 1 秒（如果我没记错的话），一个 .NET 滴答是 100 纳秒。

如果您遇到纳秒问题，您可能想尝试使用 AddTick(10000000 * value)。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2013-12-27T06:55:45.053

我需要在不丢失精度的情况下将包含的timeval[结构](https://docs.microsoft.com/windows/desktop/api/winsock/ns-winsock-timeval)（秒，微秒）转换为，并且在这里没有找到答案，所以我想我可以添加我的：`UNIX time``DateTime`

```
DateTime _epochTime = new DateTime(1970, 1, 1, 0, 0, 0, DateTimeKind.Utc);
private DateTime UnixTimeToDateTime(Timeval unixTime)
{
    return _epochTime.AddTicks(
        unixTime.Seconds * TimeSpan.TicksPerSecond +
        unixTime.Microseconds * TimeSpan.TicksPerMillisecond/1000);
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-06-18T07:36:54.777

```
public static class UnixTime
    {
        private static readonly DateTime Epoch = new DateTime(1970, 1, 1, 0, 0, 0, 0);

        public static DateTime UnixTimeToDateTime(double unixTimeStamp)
        {
            return Epoch.AddSeconds(unixTimeStamp).ToUniversalTime();
        }
    } 
```

你可以调用 UnixTime.UnixTimeToDateTime(double datetime))

* * *

## 回答 #21

> 赞同：-2
> 
> 时间：2015-05-28T23:35:28.217

对于 .NET 4.6 及更高版本：

```
public static class UnixDateTime
{
    public static DateTimeOffset FromUnixTimeSeconds(long seconds)
    {
        if (seconds < -62135596800L || seconds > 253402300799L)
            throw new ArgumentOutOfRangeException("seconds", seconds, "");

        return new DateTimeOffset(seconds * 10000000L + 621355968000000000L, TimeSpan.Zero);
    }

    public static DateTimeOffset FromUnixTimeMilliseconds(long milliseconds)
    {
        if (milliseconds < -62135596800000L || milliseconds > 253402300799999L)
            throw new ArgumentOutOfRangeException("milliseconds", milliseconds, "");

        return new DateTimeOffset(milliseconds * 10000L + 621355968000000000L, TimeSpan.Zero);
    }

    public static long ToUnixTimeSeconds(this DateTimeOffset utcDateTime)
    {
        return utcDateTime.Ticks / 10000000L - 62135596800L;
    }

    public static long ToUnixTimeMilliseconds(this DateTimeOffset utcDateTime)
    {
        return utcDateTime.Ticks / 10000L - 62135596800000L;
    }

    [Test]
    public void UnixSeconds()
    {
        DateTime utcNow = DateTime.UtcNow;
        DateTimeOffset utcNowOffset = new DateTimeOffset(utcNow);

        long unixTimestampInSeconds = utcNowOffset.ToUnixTimeSeconds();

        DateTimeOffset utcNowOffsetTest = UnixDateTime.FromUnixTimeSeconds(unixTimestampInSeconds);

        Assert.AreEqual(utcNowOffset.Year, utcNowOffsetTest.Year);
        Assert.AreEqual(utcNowOffset.Month, utcNowOffsetTest.Month);
        Assert.AreEqual(utcNowOffset.Date, utcNowOffsetTest.Date);
        Assert.AreEqual(utcNowOffset.Hour, utcNowOffsetTest.Hour);
        Assert.AreEqual(utcNowOffset.Minute, utcNowOffsetTest.Minute);
        Assert.AreEqual(utcNowOffset.Second, utcNowOffsetTest.Second);
    }

    [Test]
    public void UnixMilliseconds()
    {
        DateTime utcNow = DateTime.UtcNow;
        DateTimeOffset utcNowOffset = new DateTimeOffset(utcNow);

        long unixTimestampInMilliseconds = utcNowOffset.ToUnixTimeMilliseconds();

        DateTimeOffset utcNowOffsetTest = UnixDateTime.FromUnixTimeMilliseconds(unixTimestampInMilliseconds);

        Assert.AreEqual(utcNowOffset.Year, utcNowOffsetTest.Year);
        Assert.AreEqual(utcNowOffset.Month, utcNowOffsetTest.Month);
        Assert.AreEqual(utcNowOffset.Date, utcNowOffsetTest.Date);
        Assert.AreEqual(utcNowOffset.Hour, utcNowOffsetTest.Hour);
        Assert.AreEqual(utcNowOffset.Minute, utcNowOffsetTest.Minute);
        Assert.AreEqual(utcNowOffset.Second, utcNowOffsetTest.Second);
        Assert.AreEqual(utcNowOffset.Millisecond, utcNowOffsetTest.Millisecond);
    }
} 
```

# asp.net - 如何让我的 Web 服务响应 XML 在 Liquid XML Studio 中进行验证？

> ID：249761
> 
> 赞同：1
> 
> 时间：2008-10-30T10:31:04.807
> 
> 标签：asp.net, xml, web-services, xsd

网络服务代码（ASP.NET 2.0）：

```
[WebMethod]
[return: XmlElement("TestMe")]
public string TestMe(int value)
{
  return value.ToString();
} 
```

将导致此响应：

```
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <soap:Body>
    <TestMeResponse xmlns="http://example.org/WebServiceTest">
      <TestMe>7499</TestMe>
    </TestMeResponse>
  </soap:Body>
</soap:Envelope> 
```

[如果我将它保存为 XML 文件，在Liquid XML Studio](http://www.liquid-technologies.com)中打开它并尝试验证它，我会收到以下错误消息：

```
Could not find schema information for the element 'http://example.org/WebServiceTest:TestMeResponse'.
Could not find schema information for the element 'http://example.org/WebServiceTest:TestMe' 
```

那么如何添加正确的命名空间和/或架构以进行正确验证？

我的 WSDL ...asmx?WSDL 包括 TestMeResponse 和 TestMe 元素的模式定义，但我如何将它放入响应中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-02T01:19:49.947

您不会将架构放入响应中。它在 WSDL 中。您需要从 WSDL 中提取模式（或模式）以供 Liquid XML 看到。

# python - 如何判断一个目录是否在同一个分区

> ID：249775
> 
> 赞同：6
> 
> 时间：2008-10-30T10:45:42.093
> 
> 标签：python, linux, macos, filesystems

假设我有一个输入文件和一个目标目录。如何确定输入文件是否与目标目录位于同一硬盘驱动器（或分区）上？

我想要做的是复制一个文件，如果它在不同的地方，但如果它是相同的则移动它。例如：

```
target_directory = "/Volumes/externalDrive/something/"
input_foldername, input_filename = os.path.split(input_file)
if same_partition(input_foldername, target_directory):
    copy(input_file, target_directory)
else:
    move(input_file, target_directory) 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-30T10:54:11.937

在 C 中，您将使用`stat()`并比较该`st_dev`字段。在python中，`os.stat`应该做同样的事情。

```
import os
def same_partition(f1, f2):
    return os.stat(f1).st_dev == os.stat(f2).st_dev 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-10-30T13:21:02.843

另一种方法是“请求原谅而不是允许”的方法——尝试重命名它，如果失败，抓住适当的`OSError`并尝试复制方法。IE：

```
import errno
try:
    os.rename(source, dest):
except IOError, ex:
    if ex.errno == errno.EXDEV:
        # perform the copy instead. 
```

这样做的好处是它也适用于 Windows，其中所有分区的 st_dev 始终为 0。

请注意，如果您确实想要复制然后删除源文件（即执行移动），而不仅仅是复制，那么 shutil.move 已经可以完成您想要的操作：

```
模块shutil中功能移动的帮助：

移动（src，dst）
    递归地将文件或目录移动到另一个位置。

    如果目标在我们当前的文件系统上，那么只需使用
    改名。否则，将 src 复制到 dst，然后删除 src。

```

# .net - DataGridView 排序和例如 BindingList 在 .NET 中

> ID：249779
> 
> 赞同：12
> 
> 时间：2008-10-30T10:46:58.037
> 
> 标签：.net, winforms, data-binding, sorting, bindinglist

我`BindingList<T>`在我的 Windows 窗体中使用了一个包含“ `IComparable<Contact>`”联系人对象的列表。现在我希望用户能够按网格中显示的任何列进行排序。

MSDN online 上描述了一种方法，它显示了如何实现基于`BindingList<T>`允许排序的自定义集合。但是，是不是有一个排序事件或可以在 DataGridView（或者更好的是，在 BindingSource 上）中捕获的东西来使用自定义代码对基础集合进行排序？

我不太喜欢 MSDN 描述的方式。另一种方法是我可以轻松地将 LINQ 查询应用于集合。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-11-11T16:08:27.910

我用谷歌搜索并自己尝试了一段时间......

到目前为止，.NET 中还没有内置的方法。您必须实现一个基于`BindingList<T>`. [自定义数据绑定，第 2 部分 (MSDN)](http://msdn.microsoft.com/en-us/library/ms993236.aspx)中描述了一种方法。我最终生成了`ApplySortCore`-method 的不同实现，以提供不依赖于项目的实现。

```
protected override void ApplySortCore(PropertyDescriptor property, ListSortDirection direction)
{
    List<T> itemsList = (List<T>)this.Items;
    if(property.PropertyType.GetInterface("IComparable") != null)
    {
        itemsList.Sort(new Comparison<T>(delegate(T x, T y)
        {
            // Compare x to y if x is not null. If x is, but y isn't, we compare y
            // to x and reverse the result. If both are null, they're equal.
            if(property.GetValue(x) != null)
                return ((IComparable)property.GetValue(x)).CompareTo(property.GetValue(y)) * (direction == ListSortDirection.Descending ? -1 : 1);
            else if(property.GetValue(y) != null)
                return ((IComparable)property.GetValue(y)).CompareTo(property.GetValue(x)) * (direction == ListSortDirection.Descending ? 1 : -1);
            else
                return 0;
        }));
    }

    isSorted = true;
    sortProperty = property;
    sortDirection = direction;
} 
```

使用这个，您可以按实现的任何成员进行排序`IComparable`。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-07-24T14:41:52.260

我非常欣赏[Matthias 的](https://stackoverflow.com/a/281324/3834)简单和美观的解决方案。

然而，虽然这为低数据量提供了出色的结果，但在处理大数据量时，由于反射，性能并不是那么好。

我用一组简单的数据对象进行了测试，计算了 100000 个元素。按整数类型属性排序大约需要 1 分钟。我将进一步详细介绍的实现将其更改为~200ms。

基本思想是有利于强类型比较，同时保持 ApplySortCore 方法的通用性。下面将通用比较委托替换为对特定比较器的调用，在派生类中实现：

SortableBindingList<T> 中的新功能：

```
protected abstract Comparison<T> GetComparer(PropertyDescriptor prop); 
```

ApplySortCore 更改为：

```
protected override void ApplySortCore(PropertyDescriptor prop, ListSortDirection direction)
{
    List<T> itemsList = (List<T>)this.Items;
    if (prop.PropertyType.GetInterface("IComparable") != null)
    {
        Comparison<T> comparer = GetComparer(prop);
        itemsList.Sort(comparer);
        if (direction == ListSortDirection.Descending)
        {
            itemsList.Reverse();
        }
    }

    isSortedValue = true;
    sortPropertyValue = prop;
    sortDirectionValue = direction;
} 
```

现在，在派生类中，必须为每个可排序属性实现比较器：

```
class MyBindingList:SortableBindingList<DataObject>
{
        protected override Comparison<DataObject> GetComparer(PropertyDescriptor prop)
        {
            Comparison<DataObject> comparer;
            switch (prop.Name)
            {
                case "MyIntProperty":
                    comparer = new Comparison<DataObject>(delegate(DataObject x, DataObject y)
                        {
                            if (x != null)
                                if (y != null)
                                    return (x.MyIntProperty.CompareTo(y.MyIntProperty));
                                else
                                    return 1;
                            else if (y != null)
                                return -1;
                            else
                                return 0;
                        });
                    break;

                    // Implement comparers for other sortable properties here.
            }
            return comparer;
        }
    }
} 
```

这个变体需要更多的代码，但如果性能是一个问题，我认为值得付出努力。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-02-14T22:20:35.900

我知道所有这些答案在编写时都很好。可能他们仍然是。我正在寻找类似的东西，并找到了将**任何**列表或集合转换为可排序的替代解决方案`BindingList<T>`。

这是重要的片段（完整示例的链接在下面共享）：

```
void Main()
{
    DataGridView dgv = new DataGridView();
    dgv.DataSource = new ObservableCollection<Person>(Person.GetAll()).ToBindingList();
} 
```

[此解决方案使用实体框架](https://entityframework.codeplex.com/SourceControl/latest#src/EntityFramework/ObservableCollectionExtensions.cs)库中可用的扩展方法。因此，在继续之前，请考虑以下事项：

1.  如果您不想使用实体框架，那很好，这个解决方案也没有使用它。我们只是使用他们开发的扩展方法。EntityFramework.dll 的大小为 5 MB。如果它在 PB 时代对您来说太大了，请随时从上面的链接中提取该方法及其依赖项。
2.  如果您正在使用（或想使用）Entity Framework (>=v6.0)，您无需担心。只需安装**Entity Framework** Nuget 包并开始。

我在[这里上传了](http://share.linqpad.net/5qsxxa.linq)[LINQPad](http://www.linqpad.net/)代码示例。

1.  下载示例，使用 LINQPad 打开它并按 F4。
2.  您应该看到 EntityFramework.dll 为红色。从此[位置](https://entityframework.codeplex.com/)下载 dll 。浏览并添加参考。
3.  单击确定。按 F5。

如您所见，您可以通过在 DataGridView 控件上单击它们的列标题对不同数据类型的所有四列进行排序。

那些没有 LINQPad 的人，仍然可以下载查询并用记事本打开它，以查看完整的示例。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-09-10T19:41:52.020

这是一个非常干净的替代方案，在我的情况下工作得很好。我已经设置了与 List.Sort(Comparison) 一起使用的特定比较函数，所以我只是从其他 StackOverflow 示例的一部分中改编了它。

```
class SortableBindingList<T> : BindingList<T>
{
 public SortableBindingList(IList<T> list) : base(list) { }

 public void Sort() { sort(null, null); }
 public void Sort(IComparer<T> p_Comparer) { sort(p_Comparer, null); }
 public void Sort(Comparison<T> p_Comparison) { sort(null, p_Comparison); }

 private void sort(IComparer<T> p_Comparer, Comparison<T> p_Comparison)
 {
  if(typeof(T).GetInterface(typeof(IComparable).Name) != null)
  {
   bool originalValue = this.RaiseListChangedEvents;
   this.RaiseListChangedEvents = false;
   try
   {
    List<T> items = (List<T>)this.Items;
    if(p_Comparison != null) items.Sort(p_Comparison);
    else items.Sort(p_Comparer);
   }
   finally
   {
    this.RaiseListChangedEvents = originalValue;
   }
  }
 }
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-12-05T17:08:04.737

这是一个使用一些新技巧的新实现。

`IList<T>`必须实现的基础类型，`void Sort(Comparison<T>)`或者您必须传入一个委托来为您调用排序函数。（`IList<T>`没有`void Sort(Comparison<T>)`功能）

在静态构造函数期间，该类将通过类型`T`查找所有公共实例化属性，这些属性实现`ICompareable`或`ICompareable<T>`缓存它创建的委托以供以后使用。这是在静态构造函数中完成的，因为我们只需要对每种类型执行一次，`T`并且`Dictionary<TKey,TValue>`在读取时是线程安全的。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Linq.Expressions;
using System.Reflection;

namespace ExampleCode
{
    public class SortableBindingList<T> : BindingList<T>
    {
        private static readonly Dictionary<string, Comparison<T>> PropertyLookup;
        private readonly Action<IList<T>, Comparison<T>> _sortDelegate;

        private bool _isSorted;
        private ListSortDirection _sortDirection;
        private PropertyDescriptor _sortProperty;

        //A Dictionary<TKey, TValue> is thread safe on reads so we only need to make the dictionary once per type.
        static SortableBindingList()
        {
            PropertyLookup = new Dictionary<string, Comparison<T>>();
            foreach (PropertyInfo property in typeof(T).GetProperties(BindingFlags.Public | BindingFlags.Instance))
            {
                Type propertyType = property.PropertyType;
                bool usingNonGenericInterface = false;

                //First check to see if it implments the generic interface.
                Type compareableInterface = propertyType.GetInterfaces()
                    .FirstOrDefault(a => a.Name == "IComparable`1" &&
                                         a.GenericTypeArguments[0] == propertyType);

                //If we did not find a generic interface then use the non-generic interface.
                if (compareableInterface == null)
                {
                    compareableInterface = propertyType.GetInterface("IComparable");
                    usingNonGenericInterface = true;
                }

                if (compareableInterface != null)
                {
                    ParameterExpression x = Expression.Parameter(typeof(T), "x");
                    ParameterExpression y = Expression.Parameter(typeof(T), "y");

                    MemberExpression xProp = Expression.Property(x, property.Name);
                    Expression yProp = Expression.Property(y, property.Name);

                    MethodInfo compareToMethodInfo = compareableInterface.GetMethod("CompareTo");

                    //If we are not using the generic version of the interface we need to 
                    // cast to object or we will fail when using structs.
                    if (usingNonGenericInterface)
                    {
                        yProp = Expression.TypeAs(yProp, typeof(object));
                    }

                    MethodCallExpression call = Expression.Call(xProp, compareToMethodInfo, yProp);

                    Expression<Comparison<T>> lambada = Expression.Lambda<Comparison<T>>(call, x, y);
                    PropertyLookup.Add(property.Name, lambada.Compile());
                }
            }
        }

        public SortableBindingList() : base(new List<T>())
        {
            _sortDelegate = (list, comparison) => ((List<T>)list).Sort(comparison);
        }

        public SortableBindingList(IList<T> list) : base(list)
        {
            MethodInfo sortMethod = list.GetType().GetMethod("Sort", new[] {typeof(Comparison<T>)});
            if (sortMethod == null || sortMethod.ReturnType != typeof(void))
            {
                throw new ArgumentException(
                    "The passed in IList<T> must support a \"void Sort(Comparision<T>)\" call or you must provide one using the other constructor.",
                    "list");
            }

            _sortDelegate = CreateSortDelegate(list, sortMethod);
        }

        public SortableBindingList(IList<T> list, Action<IList<T>, Comparison<T>> sortDelegate)
            : base(list)
        {
            _sortDelegate = sortDelegate;
        }

        protected override bool IsSortedCore
        {
            get { return _isSorted; }
        }

        protected override ListSortDirection SortDirectionCore
        {
            get { return _sortDirection; }
        }

        protected override PropertyDescriptor SortPropertyCore
        {
            get { return _sortProperty; }
        }

        protected override bool SupportsSortingCore
        {
            get { return true; }
        }

        private static Action<IList<T>, Comparison<T>> CreateSortDelegate(IList<T> list, MethodInfo sortMethod)
        {
            ParameterExpression sourceList = Expression.Parameter(typeof(IList<T>));
            ParameterExpression comparer = Expression.Parameter(typeof(Comparison<T>));
            UnaryExpression castList = Expression.TypeAs(sourceList, list.GetType());
            MethodCallExpression call = Expression.Call(castList, sortMethod, comparer);
            Expression<Action<IList<T>, Comparison<T>>> lambada =
                Expression.Lambda<Action<IList<T>, Comparison<T>>>(call,
                    sourceList, comparer);
            Action<IList<T>, Comparison<T>> sortDelegate = lambada.Compile();
            return sortDelegate;
        }

        protected override void ApplySortCore(PropertyDescriptor property, ListSortDirection direction)
        {
            Comparison<T> comparison;

            if (PropertyLookup.TryGetValue(property.Name, out comparison))
            {
                if (direction == ListSortDirection.Descending)
                {
                    _sortDelegate(Items, (x, y) => comparison(y, x));
                }
                else
                {
                    _sortDelegate(Items, comparison);
                }

                _isSorted = true;
                _sortProperty = property;
                _sortDirection = direction;

                OnListChanged(new ListChangedEventArgs(ListChangedType.Reset, property));
            }
        }

        protected override void RemoveSortCore()
        {
            _isSorted = false;
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T11:06:36.313

不适用于自定义对象。在 .Net 2.0 中，我不得不使用 BindingList 进行排序。.Net 3.5 中可能有一些新的东西，但我还没有研究过。现在有了 LINQ 和附带的排序选项，如果现在可能更容易实现的话。

# css - 通过css在其他元素下对齐元素

> ID：249780
> 
> 赞同：1
> 
> 时间：2008-10-30T10:47:33.480
> 
> 标签：css

我有一个非常简单的搜索表单，其中包含以下内容

*   标签（“搜索”）
*   文本框（固定宽度）
*   提交按钮
*   “高级”链接

标签、文本框和提交都在一条水平线上并居中。现在我希望我的高级链接位于提交按钮下。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T10:52:16.777

如果我理解你想要的问题：

```
 Search [xxxxxxxxxxxxxxxx] [Submit]
                                        Advanced 
```

您必须添加更多元素才能做到这一点：

```
<div style="width: 300px; margin: auto; text-align: center;">
    Search [xxxxxxxxxxxxxxx] [Submit]
    <div style="text-align: right">Advanced</div>
</div> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T11:03:15.587

```
<style type="text/css">
    #searchpanel
    {
        width: <displaywidth of controls>px;
        text-align: center;
    }

    #button
    {
        text-align: right;
    }
</style>
<div ="searchpanel">
    <label for="textbox">Search</label><input type="text" id="textbox" />
    <input type="submit" value="Search" />
</div>
<div id="button">
    <a href="#">Advanced</a>
</div> 
```

希望这可以帮助。

# python - OS X：确定给定路径的垃圾箱位置

> ID：249785
> 
> 赞同：1
> 
> 时间：2008-10-30T10:50:32.880
> 
> 标签：python, macos, filesystems

简单地将文件移动到`~/.Trash/`将不起作用，就好像外部驱动器上的文件操作系统一样，它将文件移动到主系统驱动器..

此外，还有其他条件，例如外部驱动器上的文件被移动到`/Volumes/.Trash/501/`（或当前用户的 ID 是什么）

给定文件或文件夹路径，确定垃圾文件夹的正确方法是什么？我想这种语言是无关紧要的，但我打算使用 Python

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T20:07:26.547

或者，如果您使用的是 OS X 10.5，则可以使用 Scripting Bridge 通过 Finder 删除文件。我已经通过 RubyCocoa 在 Ruby 代码中完成了这项[工作](http://osx-trash.rubyforge.org/git?p=osx-trash.git;a=blob;f=bin/trash;h=26911131eacafd659b4d760bda1bd4c99dc2f918;hb=HEAD)。它的要点是：

```
url = NSURL.fileURLWithPath(path)
finder = SBApplication.applicationWithBundleIdentifier("com.apple.Finder")
item = finder.items.objectAtLocation(url)
item.delete 
```

你可以很容易地用 PyObjC 做类似的事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-31T09:03:45.250

基于来自[http://www.cocoadev.com/index.pl?MoveToTrash](http://www.cocoadev.com/index.pl?MoveToTrash)的代码，我想出了以下内容：

```
def get_trash_path(input_file):
    path, file = os.path.split(input_file)
    if path.startswith("/Volumes/"):
        # /Volumes/driveName/.Trashes/<uid>
        s = path.split(os.path.sep)
        # s[2] is drive name ([0] is empty, [1] is Volumes)
        trash_path = os.path.join("/Volumes", s[2], ".Trashes", str(os.getuid()))
        if not os.path.isdir(trash_path):
            raise IOError("Volume appears to be a network drive (%s could not be found)" % (trash_path))
    else:
        trash_path = os.path.join(os.getenv("HOME"), ".Trash")
    return trash_path 
```

相当基本，有一些事情必须单独完成，特别是检查文件名是否已经存在于垃圾箱中（以避免覆盖）和实际移动到垃圾箱，但它似乎涵盖了大多数事情（内部、外部和网络驱动器)

**更新：**我想在 Python 脚本中删除一个文件，所以我在 Python 中重新实现了 Dave Dribin 的解决方案：

```
from AppKit import NSURL
from ScriptingBridge import SBApplication

def trashPath(path):
    """Trashes a path using the Finder, via OS X's Scripting Bridge.
    """
    targetfile = NSURL.fileURLWithPath_(path)
    finder = SBApplication.applicationWithBundleIdentifier_("com.apple.Finder")
    items = finder.items().objectAtLocation_(targetfile)
    items.delete() 
```

用法很简单：

```
trashPath("/tmp/examplefile") 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-07T03:03:07.900

更好的方法是[NSWorkspaceRecycleOperation](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSWorkspace_Class/Reference/Reference.html#//apple_ref/doc/c_ref/NSWorkspaceRecycleOperation)，这是您可以与[-[NSWorkspace performFileOperation:source:destination:files:tag:]](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSWorkspace_Class/Reference/Reference.html#//apple_ref/occ/instm/NSWorkspace/performFileOperation:source:destination:files:tag:)一起使用的操作之一。常量的名字是 Cocoa 的 NeXT 遗产的另一个产物。它的功能是将项目移动到垃圾箱。

由于它是 Cocoa 的一部分，因此它应该对 Python 和 Ruby 都可用。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-02-16T04:56:14.090

在 Python 中，不使用脚本桥，您可以这样做：

```
from AppKit import NSWorkspace, NSWorkspaceRecycleOperation

source = "path holding files"
files = ["file1", "file2"]

ws = NSWorkspace.sharedWorkspace()
ws.performFileOperation_source_destination_files_tag_(NSWorkspaceRecycleOperation, source, "", files, None) 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T10:57:06.907

文件管理器 API 有一对称为 FSMoveObjectToTrashAsync 和 FSPathMoveObjectToTrashSync 的函数。

不确定这是否暴露于 Python。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-06T22:14:55.313

另一个红宝石：

```
Appscript.app('Finder').items[MacTypes::Alias.path(path)].delete 
```

你需要[rb-appscript](http://rubygems.org/gems/rb-appscript) gem，你可以[在这里阅读](http://appscript.sourceforge.net/rb-appscript/index.html)

# database - 如何修复可能的数据库损坏？

> ID：249786
> 
> 赞同：4
> 
> 时间：2008-10-30T10:51:07.857
> 
> 标签：database, ms-access, corruption, database-integrity

我在一个客户那里对他们的访问应用程序做一些快速修复。有一段时间我尝试了访问，但我正在迅速恢复。但是，我发现了一个有趣的问题：

对于某些报告，我收到“记录已删除”错误。我检查了报告，似乎一张桌子有问题。打开该表时，我发现所有列都标记为“#deleted”的记录。所以很明显，这一行似乎是罪魁祸首。但是，当我尝试删除该行时，并没有真正发生任何事情。如果我重新打开表，该行仍然存在。

数据库中是否存在损坏？我怎样才能永久删除此记录？

**编辑：**这是一个 MS2000 版本

**解决方案：**简单的压缩/修复不起作用。我将数据库转换为 2003 文件格式，这成功了。我已经标记了建议压缩/修复的第一个答案，因为它为我指明了正确的方向。谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T11:12:31.667

您是否尝试过内置的 Access 压缩/修复工具？这应该从数据库中刷新已删除的记录。

确切位置因您运行的 Access 版本而异，但在 Access 2003 上，它位于工具 > 数据库实用程序 > 压缩和修复数据库下。一些早期版本的 Access 有两个单独的工具——一个用于压缩，一个用于修复——但它们是从相似的位置访问的。如果它们在客户端的版本上是分开的，则需要同时运行它们。

这应该是一个非破坏性的操作，但最好在 MDB 文件的副本上进行测试（很抱歉说明了这一点）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T12:30:20.293

Access MVP Tony Toews 有一份全面的腐败指南：

[损坏的 Microsoft Access MDB 常见问题解答](http://www.granite.ab.ca/access/corruptmdbs.htm)

*   一些腐败症状
*   确定导致损坏的工作站
*   腐败原因
*   检索您的数据

顺便说一句，[反编译](http://www.granite.ab.ca/Access/decompile.htm)对于整理编码时的奇怪事件和改善启动时间非常有用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T11:32:50.970

你也可以试试这个[命令行实用程序](http://support.microsoft.com/kb/295334)

//安迪

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-10-31T01:27:34.453

压缩和导入不会解决报告的错误的问题，这显然是备忘录字段的损坏指针。您唯一能做的就是删除并重新创建导致问题的记录。而且您需要找到不会让您面临腐败风险的方法来编辑备忘录数据（或消除备忘录字段——您真的需要超过 255 个字符吗？）。这意味着避免在备忘录字段的表单上绑定控件。

相反，使用未绑定的文本框，并在表单的 OnCurrent 事件中，从表单的底层记录源分配当前数据：

```
 Me!txtMyMemo = Me!MyMemo 
```

要保存对未绑定控件的编辑，请使用控件的 AfterUpdate 事件：

```
 Me!MyMemo = Me!txtMyMemo
  Me.Dirty = False        ' save the whole record 
```

为什么备忘录字段容易损坏？因为它们没有存储在与非备注字段相同的数据页中，而是记录的主数据页中的所有内容都是指向其他数据页（或数据页集，如果它是一大块）的指针。数据）存储实际备忘录数据的位置。如果不这样做，带有备忘录的记录将很快超过最大记录长度。

指针相对容易损坏，最常见的是在绑定控件中进行编辑期间的致命问题。使用未绑定控件进行编辑并不能完全消除问题，而是意味着您面临危险的时间非常非常短（即在 AfterUpdate 事件中执行这两行代码所需的时间） .

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T13:05:18.227

除了上面已经发布的选项之外，我还使用了另一种简单的方法：只需创建一个新的 MDB 文件并从损坏的文件中导入所有对象。走这条路时不要忘记获取系统和/或隐藏对象。

# svn - 在 SVN 中共享文件

> ID：249787
> 
> 赞同：6
> 
> 时间：2008-10-30T10:51:35.220
> 
> 标签：svn

我正在从 VSS 迁移到 SVN，但我不确定如何在 SVN 中共享文件。

基本上我们在VSS中有以下结构

```
$MOSS
  - Components
    - ComponentA
      - bin
    - ComponentB
      - bin
  - GAC Mirror 
```

GAC Mirror 保存组件 bin 文件夹中所有 Dll 的共享副本，以便轻松复制到 GAC。

在 VSS 中，您只需将 Dll 从 bin 文件夹拖到 GAC Mirror 文件夹，它就可以正常工作。

我将如何在 SVN 中执行此操作？

提前致谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T11:11:46.473

svn:externals 是你所追求的吗？[http://svnbook.red-bean.com/en/1.0/ch07s03.html](http://svnbook.red-bean.com/en/1.0/ch07s03.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T11:25:39.910

我对此表示赞同。对我来说，“共享”的整个概念（=在结帐时在两个地方出现相同的文件）很奇怪。

我猜每个版本控制系统都有自己隐含的思维方式。我已经尝试过 Perforce，并且一直使用 Subversion。但是，在不改变思维方式的情况下将您的项目带入其中，并且工作流程可能存在缺陷。

svn 上的[书](http://svnbook.red-bean.com/)是一本值得一读的书，可以在进行暴跌之前将一些心态淹没。您可以只选择一些部分，您不必一次阅读所有部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T11:00:57.930

我们遇到了同样的问题。简单的答案是您不能在 SVN 中共享文件 - 最后我们不得不重组我们的目录并使用批处理文件。

例如，对于共享的源代码文件，我们将它们移至包含文件夹，并让所有项目都引用该文件夹。

对于需要复制到多个位置的二进制文件，我们在 SVN 中只存储一次，然后使用批处理文件将它们复制到每台开发人员机器（或构建机器）上的目标位置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-19T09:23:41.553

使用 SVN 1.6+，它也支持文件，参见： [http ://svnbook.red-bean.com/nightly/en/svn-book.html#svn.advanced.externals](http://svnbook.red-bean.com/nightly/en/svn-book.html#svn.advanced.externals)

# regex - 带有转义引号的引用字符串的正则表达式

> ID：249791
> 
> 赞同：148
> 
> 时间：2008-10-30T10:53:02.953
> 
> 标签：regex, escaping, quotes

如何`" It's big \"problem "`使用正则表达式获取子字符串？

```
s = ' function(){  return " It\'s big \"problem  ";  }'; 
```

* * *

## 回答 #1

> 赞同：184
> 
> 时间：2008-10-30T11:59:45.580

```
/"(?:[^"\\]|\\.)*"/ 
```

在 Regex Coach 和 PCRE Workbench 中工作。

JavaScript 中的测试示例：

```
 var s = ' function(){ return " Is big \\"problem\\", \\no? "; }';
    var m = s.match(/"(?:[^"\\]|\\.)*"/);
    if (m != null)
        alert(m);
```

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-06-19T04:34:19.687

这个来自许多 linux 发行版中可用的 nanorc.sample。它用于 C 风格字符串的语法高亮

```
\"(\\.|[^\"])*\" 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2012-05-28T14:12:19.030

正如ePharaoh所提供的，答案是

```
/"([^"\\]*(\\.[^"\\]*)*)"/ 
```

要将上述内容应用于单引号或双引号字符串，请使用

```
/"([^"\\]*(\\.[^"\\]*)*)"|\'([^\'\\]*(\\.[^\'\\]*)*)\'/ 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2015-06-09T16:02:06.293

Most of the solutions provided here use alternative repetition paths i.e. (A|B)*.

You may encounter stack overflows on large inputs since some pattern compiler implements this using recursion.

Java for instance: [http://bugs.java.com/bugdatabase/view_bug.do?bug_id=6337993](http://bugs.java.com/bugdatabase/view_bug.do?bug_id=6337993)

Something like this: `"(?:[^"\\]*(?:\\.)?)*"`, or the one provided by Guy Bedford will reduce the amount of parsing steps avoiding most stack overflows.

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-10-30T10:58:32.710

```
/(["\']).*?(?<!\\)(\\\\)*\1/is 
```

应该使用任何带引号的字符串

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2010-12-15T08:54:58.877

```
"(?:\\"|.)*?" 
```

交替使用`\"`和`.`传递转义引号，而惰性量词`*?`可确保您不会超出引用字符串的末尾。适用于 .NET Framework RE 类

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2015-11-09T20:38:52.257

```
/"(?:[^"\\]++|\\.)*+"/ 
```

直接取自`man perlre`安装了 Perl 5.22.0 的 Linux 系统。作为一种优化，这个正则表达式使用两者的“posessive”形式`+`并`*`防止回溯，因为事先知道没有右引号的字符串在任何情况下都不匹配。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2017-04-24T20:17:43.727

这个在 PCRE 上完美运行，并且不属于 StackOverflow。

```
"(.*?[^\\])??((\\\\)+)?+" 
```

解释：

1.  每个带引号的字符串都以 Char: `"`;
2.  它可以包含任意数量的任意字符：`.*?`{Lazy match}; 以非转义字符结尾`[^\\]`；
3.  语句 (2) 是 Lazy(!) 可选的，因为字符串可以为空 ("")。所以：`(.*?[^\\])??`
4.  最后，每个带引号的字符串都以 Char( `"`) 结尾，但它前面可以有偶数个转义符号对`(\\\\)+`；并且它是 Greedy(!) 可选的：`((\\\\)+)?+`{Greedy matching}，因为字符串可以为空或没有结尾对！

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2018-01-09T09:44:36.263

之前没有提到的一个选项是：

1.  反转字符串。
2.  对反转的字符串执行匹配。
3.  重新反转匹配的字符串。

这具有能够正确匹配转义的打开标签的额外好处。

假设您有以下字符串；`String \"this "should" NOT match\" and "this \"should\" match"` 在这里，不应该和应该`\"this "should" NOT match\"`匹配。`"should"`最重要的是`this \"should\" match`应该匹配`\"should\"`而不应该匹配。

先举个例子。

```
// The input string.
const myString = 'String \\"this "should" NOT match\\" and "this \\"should\\" match"';

// The RegExp.
const regExp = new RegExp(
    // Match close
    '([\'"])(?!(?:[\\\\]{2})*[\\\\](?![\\\\]))' +
    '((?:' +
        // Match escaped close quote
        '(?:\\1(?=(?:[\\\\]{2})*[\\\\](?![\\\\])))|' +
        // Match everything thats not the close quote
        '(?:(?!\\1).)' +
    '){0,})' +
    // Match open
    '(\\1)(?!(?:[\\\\]{2})*[\\\\](?![\\\\]))',
    'g'
);

// Reverse the matched strings.
matches = myString
    // Reverse the string.
    .split('').reverse().join('')
    // '"hctam "\dluohs"\ siht" dna "\hctam TON "dluohs" siht"\ gnirtS'

    // Match the quoted
    .match(regExp)
    // ['"hctam "\dluohs"\ siht"', '"dluohs"']

    // Reverse the matches
    .map(x => x.split('').reverse().join(''))
    // ['"this \"should\" match"', '"should"']

    // Re order the matches
    .reverse();
    // ['"should"', '"this \"should\" match"'] 
```

好的，现在解释正则表达式。这是正则表达式可以很容易地分成三部分。如下：

```
# Part 1
(['"])         # Match a closing quotation mark " or '
(?!            # As long as it's not followed by
  (?:[\\]{2})* # A pair of escape characters
  [\\]         # and a single escape
  (?![\\])     # As long as that's not followed by an escape
)
# Part 2
((?:          # Match inside the quotes
(?:           # Match option 1:
  \1          # Match the closing quote
  (?=         # As long as it's followed by
    (?:\\\\)* # A pair of escape characters
    \\        # 
    (?![\\])  # As long as that's not followed by an escape
  )           # and a single escape
)|            # OR
(?:           # Match option 2:
  (?!\1).     # Any character that isn't the closing quote
)
)*)           # Match the group 0 or more times
# Part 3
(\1)           # Match an open quotation mark that is the same as the closing one
(?!            # As long as it's not followed by
  (?:[\\]{2})* # A pair of escape characters
  [\\]         # and a single escape
  (?![\\])     # As long as that's not followed by an escape
) 
```

这在图像形式上可能更清晰：使用[Jex 的 Regulex生成](https://jex.im/regulex/)

[github 上的图像（JavaScript 正则表达式可视化工具。）](https://user-images.githubusercontent.com/2230835/34616812-3cc9c220-f231-11e7-948b-2429f1551844.png) 对不起，我没有足够高的声誉来包含图像，所以，它现在只是一个链接。

以下是使用此概念的示例函数的要点，该概念更高级：[https ://gist.github.com/scagood/bd99371c072d49a4fee29d193252f5fc#file-matchquotes-js](https://gist.github.com/scagood/bd99371c072d49a4fee29d193252f5fc#file-matchquotes-js)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-08-05T22:37:22.740

这是一个同时使用 " 和 ' 的版本，您可以在开始时轻松添加其他内容。

```
("|')(?:\\\1|[^\1])*?\1
```

它使用反向引用 (\1) 精确匹配第一组中的内容 (" 或 ')。

[http://www.regular-expressions.info/backref.html](http://www.regular-expressions.info/backref.html)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-30T11:18:23.153

必须记住，正则表达式并不是所有字符串的灵丹妙药。有些事情用光标和线性、手动、搜索更简单。[CFL](http://en.wikipedia.org/wiki/Context-free_language)可以很简单地完成这个技巧，但是没有很多 CFL 实现（afaik）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-04-10T21:14:32.603

如果从头开始搜索，也许这可以工作？

```
\"((\\\")|[^\\])*\" 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-12-03T13:36:39.243

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-07-12T06:23:19.527

如果您的 IDE 是 IntelliJ Idea，您可以忘记所有这些令人头疼的问题并将您的正则表达式存储到一个字符串变量中，当您将其复制粘贴到双引号内时，它会自动更改为正则表达式可接受的格式。

Java 中的示例：

```
String s = "\"en_usa\":[^\\,\\}]+"; 
```

现在你可以在你的正则表达式或任何地方使用这个变量。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-03-15T03:49:59.983

我在尝试删除可能会干扰某些文件解析的带引号的字符串时遇到了类似的问题。

我最终得到了一个两步解决方案，它击败了你能想出的任何复杂的正则表达式：

```
 line = line.replace("\\\"","\'"); // Replace escaped quotes with something easier to handle
 line = line.replaceAll("\"([^\"]*)\"","\"x\""); // Simple is beautiful 
```

更容易阅读并且可能更有效。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2014-09-20T22:54:39.573

搞砸了正则[表达式](http://regexpal.com)并最终得到了这个正则表达式：（不要问我它是如何工作的，即使我写了它我也几乎不明白，哈哈）

```
"(([^"\\]?(\\\\)?)|(\\")+)+" 
```

# tsql - 如何在 T-SQL 中舍入一个时间

> ID：249794
> 
> 赞同：18
> 
> 时间：2008-10-30T10:53:58.333
> 
> 标签：tsql, rounding

我正在寻找一个可以接收时间并将其四舍五入到下一个/上一个小时/半小时/季度/分钟的函数。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-10-30T11:12:10.187

试试这个功能

```
CREATE FUNCTION [dbo].[RoundTime] (@Time datetime, @RoundTo float)
RETURNS datetime
AS
BEGIN
   DECLARE @RoundedTime smalldatetime
   DECLARE @Multiplier float

   SET @Multiplier= 24.0/@RoundTo

   SET @RoundedTime= ROUND(CAST(CAST(CONVERT(varchar,@Time,121) AS datetime) AS float) * @Multiplier,0)/@Multiplier

   RETURN @RoundedTime
END

select dbo.roundtime('13:15',0.5) 
```

第一个参数是四舍五入的时间，第二个参数将基于您的列表（0.5-半小时，1-一小时，...）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-07-05T00:53:02.123

非常感谢。我在线使用它来四舍五入到 15 分钟

```
convert(smalldatetime,ROUND(cast(TDatalog.Time as float) * (24/.25),0)/(24/.25)) AS RoundedTime 
```

# ruby-on-rails - 如何在 Rails 中动态设置基于 cookie 的会话的到期时间

> ID：249797
> 
> 赞同：12
> 
> 时间：2008-10-30T10:56:06.490
> 
> 标签：ruby-on-rails

我目前正在为我的 Rails 应用程序使用基于 ActiveRecord 的会话存储，并且我有一个后台进程，它每 30 分钟清除一次非活动会话。

我想切换到 Rails 新的基于 cookie 的会话存储，但是如何将会话的到期时间设置为 30 分钟，而不是默认的“会话结束时”值？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2010-07-28T09:24:49.090

在办公室交谈后，我偶然发现了这个问题。只是为了完整起见，我发现在一段时间不活动后可以使会话过期，并且它内置在 Rails 中。在 config/environment.rb 中，执行以下操作：

```
config.action_controller.session = {
  :key          => 'whatever',
  :secret       => 'nottellingyou',
  :expire_after => 30.minutes
} 
```

查看[lib/action_controller/session/cookie_store.rb#114](http://github.com/rails/rails/blob/2-3-stable/actionpack/lib/action_controller/session/cookie_store.rb#L114)中的（显然未记录的）选项。自从 2008 年 12 月迁移到 Rack 会议以来，它似乎一直存在。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-10-30T17:54:22.480

理想情况下，您希望在 environment.rb 中添加类似这样的内容：

```
session :session_expires => 1.day.from_now 
```

但这不起作用，因为代码仅在 APP 启动时运行一次，因此第二天您的所有会话都将在过去过期的情况下创建。

我通常将其设置`session_expires`为未来的某个时间（6 个月）。然后在我的应用程序控制器上手动设置和检查`session[:expires]`日期，`before_filter`并在该日期过去后重置会话。

这使得在登录时添加“让我为 ___ 保持登录”选项变得非常容易，您只需设置`session[:expires] = Time.now + ___`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-01-27T04:44:05.840

经过大量的痛苦和实验，在 Rails 3.x 中发现，您需要在每个请求的后过滤器中设置自定义会话参数

```
 class ApplicationController < ActionController::Base

      after_filter :short_session

      ...

      def short_session
        request.session_options = request.session_options.dup
        request.session_options[:expire_after] = 1.minute
        request.session_options.freeze
      end 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T11:12:36.300

Rails wiki 上的[会话选项](http://wiki.rubyonrails.org/rails/pages/HowtoChangeSessionOptions)页面暗示这只能通过插件实现：

* * *

## 设置会话cookie过期时间

不幸的是，Rails 无法动态设置会话 cookie 的到期时间。所以建议您使用以下插件，它可以让您完成它： http: [//blog.codahale.com/2006/04/08/dynamic-session-expiration-times-with-rails/](http://blog.codahale.com/2006/04/08/dynamic-session-expiration-times-with-rails/)

* * *

当然要考虑到插件很旧，并且可能不适用于您当前版本的 Rails（我没有查看具体内容）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T19:37:40.727

使用它，它在 rails 2.1.x 中为我工作：

[滑动会话](http://squarewheel.wordpress.com/2007/11/03/session-cookie-expiration-time-in-rails/)

我目前将 cookie 设置为在用户登录后正好 2 周到期，将其设置为 30 分钟很简单。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-30T12:12:40.250

您可以尝试将以下行添加到您的 environment.rb 文件中：

```
session :session_key => 'my_session_key'
session :session_expires => 1.day.from_now 
```

或者，您可以按如下方式设置会话选项：

```
ActionController::Base.session_options[:session_expires] = 1.day.from_now 
```

我没有彻底测试过，所以YMMV。

# java - 在 Java5 和 Java6 之间通过 RMI 进行通信时，我应该预料到会出现问题吗？

> ID：249798
> 
> 赞同：2
> 
> 时间：2008-10-30T10:56:23.913
> 
> 标签：java, rmi

基本上，主题说明了一切：我们有几个组件在 Java 5 上运行，它们通过 RMI 相互通信。如果我们将其中一些迁移到 Java6，我们是否应该预料到会出现任何问题？通过移动，我的意思是编译它们`-source/target 1.6`并在 java6 vm 上运行。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T11:05:52.477

不，你不应该期望有任何问题。但无论如何，请查看[Java 6 中 RMI 的发行说明](http://java.sun.com/javase/6/docs/technotes/guides/rmi/relnotes.html)

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-22T12:03:08.660

我们已经成功地将 Java 5 序列化对象引入 Java 6 对象，因此序列化方面应该没有限制。

您还应该能够毫无问题地在 32 位和 64 位 Java 之间切换。

# multithreading - 在 powershell 中使用 system.thread.threadpool

> ID：249809
> 
> 赞同：2
> 
> 时间：2008-10-30T11:01:54.637
> 
> 标签：multithreading, powershell, threadpool

我在使用线程池的powershell中的一些代码示例之后。我在谷歌的朋友帮不了我。任何例子都会很棒。

唐纳德

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T13:52:37.367

根据我的经验，在 V1 中使用线程池会使会话崩溃。

[这里](http://weblogs.asp.net/adweigert/archive/2008/04/29/powershell-threading-for-powershell-v1-0.aspx)有一篇关于创建线程的博客文章并包含一些代码。

V2 支持后台作业和其他运行空间，但这仍然在 CTP...

# sql - 表格内容的批量翻译

> ID：249818
> 
> 赞同：1
> 
> 时间：2008-10-30T11:08:24.763
> 
> 标签：sql, sql-server, insert, identity, bulk

我目前正在从旧数据库执行迁移操作。我需要执行数百万原始行的迁移，将原始内容分成多个目标父/子行。

由于这不是简单的一对一迁移，并且结果行是基于身份生成密钥的父/子行，执行迁移的最佳机制是什么？

我假设我不能使用批量插入，因为在生成脚本内容时无法确定子行的标识值？我目前能想到的唯一解决方案是明确设置身份，然后为导入有一个预定的起点。

如果其他人有任何意见，我将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T12:06:51.853

这是我的标准方法：

*   创建新的数据模型
*   将数据原封不动地拉入新数据库
*   编写（并运行）一个 SQL 脚本来执行迁移
*   测试
*   （可选）删除带有旧数据的表

使用纯 SQL 迁移数据还有很长的路要走。对于您描述的情况，您可能不需要处理单个 Cursor 即可完成它。

在查询分析器（或 dbms 中的模拟程序）中运行该过程，您将拥有可以将所有内容包装在 Transaction 中的优势，以便在出现任何异常时可以回滚。在你的开发数据库上，一点一点地编写它并在块中对其进行测试。一切正常后，在您的生产数据库上设置脚本松散。

排序。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T11:45:21.710

感谢您的建议，但我更愿意提供程序化解决方案。我目前正在使用 Nant / CruiseControl 来自动化测试，并且需要一些我可以根据当前实时遗留内容即时重新创建的东西。

# sql - 如何避免在 sql 查询中出现多个 CAST？

> ID：249819
> 
> 赞同：2
> 
> 时间：2008-10-30T11:09:01.923
> 
> 标签：sql, tsql

我有以下用于转换数据的 sql 查询，但是否可以将 int 的值保存在某个变量中以避免多次转换？

```
update prospekts set sni_kod = case

when 
    cast(sni_kod as int) >= 1000 and cast(sni_kod as int) <= 1499 
    or cast(sni_kod as int) >= 1600 and cast(sni_kod as int) <= 2439
then '1'
when 
    cast(sni_kod as int) >= 7000 and cast(sni_kod as int) <= 7499 
then 'W'
else
     sni_kod
end 
```

脚本中还有很多 when-case，仅显示第一个。除了简单的文本脚本之外，我不能使用任何东西。

**使用 SQL Server 2000**更新****

 **谢谢

安德斯

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T13:04:27.947

好的...这是我对您的代码的重写...

```
UPDATE prospekts SET sni_kod = 
    CASE
        WHEN ISNUMERIC(@sni_kod)=1 THEN
            CASE 
                WHEN cast(@sni_kod as int) BETWEEN 1000 AND 1499 OR cast(@sni_kod as int) BETWEEN 1600 AND 2439 THEN '1'
                WHEN cast(@sni_kod as int) BETWEEN 7000 AND 7499 THEN 'W'
                ELSE @sni_kod
            END
        ELSE @sni_kod
    END 
```

这样，如果它是一个数值，它只会尝试执行 CAST，因此您不会像其他人在评论中提到的那样获得强制转换异常。

既然你说涉及的语句更多，我猜你有更多的数字范围可以获得不同的值......如果是这种情况，你可能可以使用第二张表（如果可以是临时表，如果，就像您的问题所说，您仅限于 SQL 代码）加入具有最小值、最大值以及您希望基于此显示的内容。当您需要评估非数字值时会变得更加棘手，但这并非不可能。

但是，在没有看到完整声明的情况下，这是我能提供的最好的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T12:33:38.553

这只是一个一次性的脚本吗？如果是这样，并且您只是想节省打字时间，请写为：

```
update prospekts set sni_kod = case
when 
    xxx >= 1000 and xxx <= 1499 
    or xxx >= 1600 and xxx <= 2439
then '1'
when 
    xxx >= 7000 and xxx <= 7499 
then 'W'
else
     sni_kod
end 
```

...然后进行全局搜索并用文本编辑器替换。

或者您可能担心每行投射几次的性能，而一次可能会这样做？但是，如果这个脚本是一次性的，那真的很重要吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T13:03:44.967

在您的问题中，您提到要“避免多次投射”。如果您担心性能问题，请不要担心。SQL 不会多次转换该字段（即使您在脚本中多次使用它）。

例子：

```
SELECT CONVERT(INT, '123'), CONVERT(INT, '123') 
```

T-SQL 只会运行该方法一次（没有性能损失）。

话虽如此，那么您唯一可能担心的其他问题就是键入一堆……如果是这种情况，那么托尼·安德鲁斯（Tony Andrews）提到的“ xxx /查找和替换”评论就足够了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T11:15:57.213

您可以使用子查询或 CTE：

```
With xxx AS (
     i_sni_kod = cast(sni_kod as int)
     ...)
UPDATE prospekts set sni_kod = case 
    when i_sni_kod >= 100 ... 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T11:17:44.183

这在您的 DBMS 中有效吗？

```
update (select prospekts.*, cast(sni_kod as int) sni_kod_int from prospekts)
set sni_kod = case
when 
    sni_kod_int >= 1000 and sni_kod_int <= 1499 
    or sni_kod_int >= 1600 and sni_kod_int <= 2439
then 1
else
     sni_kod
end 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T11:46:30.460

这似乎是您的模型的问题，而不是您的查询。为什么该列不只是一个 int？

这似乎是一个[鞋子或玻璃瓶](http://weblogs.asp.net/alex_papadimoulis/archive/2005/05/25/408925.aspx)的问题。您看到的多重投射问题只是早期不良做法的结果。解决这些问题，您的问题就会消失。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T12:11:43.013

像这样的东西可能有效：

```
update prospekts set sni_kod = 1
from prospekts
    join (select prospekts.primarykey, cast(prospekts.sni_kod as int) as sni_kod_int from prospekts) p2 on prospekts.primarykey = p2.primarykey
WHERE (p2.sni_kod_int >=1000 and p2.sni_kod_int <= 1499)
    or (p2.sni_kod_int >=1600 and p2.sni_kod_int <= 2439) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-30T12:33:31.237

您显示的 UPDATE 语句；我假设它只会运行一次？如果它第二次运行，那么当它找到上一次运行中添加的“W”时，转换为 int 将失败。这里最好的选择是更改 sni_kod 列的数据类型。也许你可以解释一下这个专栏是什么，为什么它需要同时保存 int 和 varchar 数据？最后，SQL server 几乎可以肯定只进行一次强制转换。它非常适合在查询中查找重复的表达式和子查询并且只运行一次。如果您不确定，请查看执行计划。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-30T18:40:45.380

我看到有人发布了一个在 from 子句中加入子查询的解决方案。这是一个在 from 子句中使用 -just- 子查询的解决方案。

```
DECLARE @MyTable TABLE
(
  theKey int identity(1,1) PRIMARY KEY,
  theValue varchar(30)
)
------    
INSERT INTO @MyTable SELECT '1'
INSERT INTO @MyTable SELECT '2'
INSERT INTO @MyTable SELECT '3'
------

UPDATE sub
SET theValue =
  CASE
    WHEN convertedvalue % 2 = 0 THEN 'even'
    ELSE theValue
  END
FROM
(
  SELECT
    CASE
      WHEN Isnumeric(theValue) = 1
      THEN convert(int, theValue)
      ELSE null
    END as convertedValue, *
  FROM @MyTable mt
) as sub
------
SELECT *
FROM @MyTable 
```

# javascript - 使用 javascript 在任务栏中创建气球弹出窗口

> ID：249825
> 
> 赞同：0
> 
> 时间：2008-10-30T11:10:53.760
> 
> 标签：javascript

我需要创建一个函数，该函数将使用 javascript 在任务栏中生成一个气球弹出窗口。

可能吗？执行此操作的最短和最简单的方法是什么？

否则可用的方法是什么..

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T11:19:03.573

你能得到的最接近的方法是将一个固定在浏览器视口的底部。您可以对其进行定制，使其看起来好像是 Windows chrome 的一部分，但这确实会惹恼用户，他们不喜欢试图“愚弄”他们相信对话/弹出窗口/任何来自他们的操作系统的内容。实际上不是。

请参阅：[杰夫·阿特伍德（Jeff Atwood）关于假接口的恐怖](http://www.codinghorror.com/blog/archives/001164.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T11:14:53.330

从浏览器不可能。和一件好事。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T11:16:30.067

嗯..不是吗？

反正不会跨平台。只是不要尝试在浏览器之外做事。Internet explorer 最终可以让你，其他人不行。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T11:18:17.770

您可能会非常接近[jGrowl](http://www.stanlemon.net/projects/jgrowl.html)。但是您必须将位置重置为右下角（默认为右上角）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T11:24:12.830

[Yahoo Widget Engine](http://en.wikipedia.org/wiki/Yahoo!_Widgets)（以前称为 Konfabulator）允许这样做；您将不再使用浏览器，而是使用基于 Web 的轻量级桌面应用程序，这可能正是您想要的。

来自网页的 Anybeast 永远不应该离开它的框架/浏览器。

# c++ - 是否有适用于 Windows 的免费且快速（可能是独立的）C++ 重构工具？

> ID：249827
> 
> 赞同：7
> 
> 时间：2008-10-30T11:12:01.497
> 
> 标签：c++, windows, visual-studio, refactoring

目前我在一个相当大的项目中工作，我被要求重构一些旧代码。大多数重构是将一个大类分成更小的组件和功能。

我已经搜索并看到了与该主题相关的其他一些[问题](https://stackoverflow.com/questions/16167/good-refactoring-support-for-c)，但我对提议的选项不太满意。这些的问题在于

*   这里的每个人都在 Windows 中使用 VS2005，我不太热衷于为同一个项目使用不同的编辑器。
*   反应堆！VS2005 的插件太慢了，无法使用。
*   Reactor!Pro 不是免费的，我不确定它是否会运行得更快。

我只是想知道是否有任何轻量级、独立的基于 GUI 的免费工具不会使我的计算机工作得比跛脚蜗牛慢。它不必进行 150 次重构，只是基础。可能是我要求太高了！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T11:26:47.067

我用过 WholeTomato 的 Visual Assist X，他们有免费试用版，但完整版要 249 美元，“个人许可证”要 99 美元。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-12-12T19:13:48.667

现在有一个免费的 Visual Studio 2013[重构扩展](http://visualstudiogallery.msdn.microsoft.com/164904b2-3b47-417f-9b6b-fdd35757d194?SRC=Home "重构扩展")，由 Microsoft 创建。在我写这篇文章时，它仍处于早期阶段，仅进行 Rename 重构。开发人员说还有更多工作要做（重构 C++ 很*困难*），但这是一个非常好的开始。

这个扩展的发布伴随着第 9 频道的视频：[GoingNative 20：Visual C++ 的“重命名”重构 (??!!)](http://channel9.msdn.com/Shows/C9-GoingNative/GoingNative-20-Rename-Refactoring-for-Visual-C- "GoingNative 20：“重命名”； 重构 Visual C++ (??!!)")

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-12-12T19:23:10.963

[Eclipse CDT](http://www.eclipse.org/cdt/)中的重构工作：

[http://wiki.eclipse.org/images/a/a1/C%2B%2B_Refactoring_-_Now_for_Real.pdf](http://wiki.eclipse.org/images/a/a1/C%2B%2B_Refactoring_-_Now_for_Real.pdf)

# c# - 你如何用 NUnit 测试私有方法？

> ID：249847
> 
> 赞同：111
> 
> 时间：2008-10-30T11:20:26.393
> 
> 标签：c#, unit-testing, testing, nunit

我想知道如何正确使用 NUnit。首先，我创建了一个单独的测试项目，它使用我的主项目作为参考。但在那种情况下，我无法测试私有方法。我的猜测是我需要将我的测试代码包含到我的主代码中？！- 这似乎不是正确的方法。（我不喜欢发送带有测试的代码的想法。）

你如何用 NUnit 测试私有方法？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-10-30T11:23:31.223

通常，单元测试处理类的公共接口，其理论是实现无关紧要，只要从客户的角度来看结果是正确的。

因此，NUnit 没有提供任何测试非公共成员的机制。

* * *

## 回答 #2

> 赞同：67
> 
> 时间：2012-01-27T15:08:41.180

虽然我同意单元测试的重点应该是公共接口，但如果你也测试私有方法，你会对你的代码有更细致的印象。MS 测试框架通过使用 PrivateObject 和 PrivateType 来实现这一点，而 NUnit 则不允许。我做的是：

```
private MethodInfo GetMethod(string methodName)
{
    if (string.IsNullOrWhiteSpace(methodName))
        Assert.Fail("methodName cannot be null or whitespace");

    var method = this.objectUnderTest.GetType()
        .GetMethod(methodName, BindingFlags.NonPublic | BindingFlags.Instance);

    if (method == null)
        Assert.Fail(string.Format("{0} method not found", methodName));

    return method;
} 
```

这种方式意味着您不必为了可测试性而牺牲封装。请记住，如果要测试私有静态方法，则需要修改 BindingFlags。上面的例子只是实例方法。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2008-10-30T11:43:56.893

编写单元测试的一个常见模式是只测试公共方法。

如果你发现你有很多私有方法要测试，通常这表明你应该重构你的代码。

将这些方法公开在它们当前所在的类上是错误的。这将违反您希望该班级拥有的合同。

将它们移到辅助类并在那里公开它们可能是正确的。您的 API 可能不会公开此类。

这种方式测试代码永远不会与您的公共代码混合。

一个类似的问题是测试私人课程，即。您不从程序集中导出的类。在这种情况下，您可以使用属性 InternalsVisibleTo 显式使您的测试代码程序集成为生产代码程序集的朋友。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-10-30T12:02:09.897

可以通过将您的测试程序集声明为您正在测试的目标程序集的友元程序集来测试私有方法。有关详细信息，请参阅下面的链接：

[http://msdn.microsoft.com/en-us/library/0tke9fxk.aspx](http://msdn.microsoft.com/en-us/library/0tke9fxk.aspx)

这很有用，因为它主要将您的测试代码与生产代码分开。我自己从来没有使用过这种方法，因为我从来没有发现需要它。我想您可以使用它来尝试和测试您根本无法在测试环境中复制的极端测试用例，以查看您的代码如何处理它。

尽管如此，您确实不需要测试私有方法。您不仅希望将代码重构为更小的构建块。当您开始重构时，一个可能对您有所帮助的技巧是尝试考虑与您的系统相关的域，并考虑居住在该域中的“真实”对象。您系统中的对象/类应直接与真实对象相关，这将允许您隔离对象应包含的确切行为并限制对象职责。这将意味着您在逻辑上进行重构，而不仅仅是为了使测试特定方法成为可能；您将能够测试对象的行为。

如果您仍然觉得需要进行内部测试，那么您可能还需要考虑在测试中进行模拟，因为您可能希望专注于一段代码。模拟是将对象依赖项注入其中，但注入的对象不是“真实”或生产对象。它们是具有硬编码行为的虚拟对象，以便更容易隔离行为错误。Rhino.Mocks 是一个流行的免费模拟框架，它基本上会为您编写对象。TypeMock.NET（提供社区版的商业产品）是一个更强大的框架，可以模拟 CLR 对象。对于模拟 SqlConnection/SqlCommand 和 Datatable 类非常有用，例如在测试数据库应用程序时。

希望这个答案能给你更多的信息，让你了解一般的单元测试，并帮助你从单元测试中获得更好的结果。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-07-16T19:47:15.530

我赞成拥有测试私有方法的能力。当 xUnit 启动时，它的目的是在编写代码后测试功能。为此目的，测试接口就足够了。

单元测试已经发展为测试驱动的开发。具有测试所有方法的能力对于该应用程序很有用。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2014-09-19T07:59:14.900

这个问题是在它的高级年，但我想我会分享我这样做的方式。

基本上，我的所有单元测试类都在他们正在测试的程序集中在该程序集的“默认”下方的“UnitTest”命名空间中 - 每个测试文件都包含在：

```
#if DEBUG

...test code...

#endif 
```

块，所有这一切意味着a）它没有在发布中分发，b）我可以使用`internal`/`Friend`级别声明而无需跳跃。

与这个问题更相关的另一件事是使用`partial`类，它可用于创建用于测试私有方法的代理，例如测试返回整数值的私有方法之类的东西：

```
public partial class TheClassBeingTested
{
    private int TheMethodToBeTested() { return -1; }
} 
```

在程序集的主要类和测试类中：

```
#if DEBUG

using NUnit.Framework;

public partial class TheClassBeingTested
{
    internal int NUnit_TheMethodToBeTested()
    {
        return TheMethodToBeTested();
    }
}

[TestFixture]
public class ClassTests
{
    [Test]
    public void TestMethod()
    {
        var tc = new TheClassBeingTested();
        Assert.That(tc.NUnit_TheMethodToBeTested(), Is.EqualTo(-1));
    }
}

#endif 
```

显然，您需要确保在开发时不使用此方法，尽管如果您这样做，Release 版本很快就会表明对它的无意调用。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-10-30T11:25:11.610

单元测试的主要目标是测试类的公共方法。那些公共方法将使用那些私有方法。单元测试将测试公开可用的行为。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-05-02T18:13:06.147

抱歉，如果这不能回答问题，但使用反射、#if #endif 语句或使私有方法可见等解决方案并不能解决问题。不让私有方法可见可能有几个原因......例如，如果它是生产代码并且团队正在回顾性地编写单元测试怎么办。

对于我正在处理的项目，只有 MSTest（可悲）似乎有一种方法，使用访问器来对私有方法进行单元测试。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-10-30T11:33:32.187

您不测试私有函数。有一些方法可以使用反射来进入私有方法和属性。但这并不容易，我强烈反对这种做法。

你根本不应该测试任何不公开的东西。

如果您有一些内部方法和属性，您应该考虑将其更改为公共，或者将您的测试与应用程序一起发布（我并不认为这是一个问题）。

如果您的客户能够运行测试套件并看到您交付的代码实际上是“工作”，我不认为这是一个问题（只要您不通过它泄露您的 IP）。我在每个版本中都包含测试报告和代码覆盖率报告。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2016-11-03T08:55:43.237

在单元测试的理论中，只需要测试合约。即只有班级的公共成员。但在实践中，开发人员通常也想测试内部成员 - 这还不错。是的，它与理论背道而驰，但在实践中它有时会很有用。

因此，如果您真的想测试内部成员，可以使用以下方法之一：

1.  公开您的会员。在许多书中，作者建议这种方法很简单
2.  您可以让您成为内部成员并将[InternalVisibleTo](https://msdn.microsoft.com/en-us/library/system.runtime.compilerservices.internalsvisibletoattribute(v=vs.110).aspx)添加到程序集
3.  您可以保护类成员并从您的测试类继承您的测试类。

代码示例（伪代码）：

```
public class SomeClass
{
    protected int SomeMethod() {}
}
[TestFixture]
public class TestClass : SomeClass{

    protected void SomeMethod2() {}
    [Test]
    public void SomeMethodTest() { SomeMethod2(); }
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-05-31T17:59:41.250

您可以使您的方法在内部受到保护，然后 `assembly: InternalsVisibleTo("NAMESPACE")` 用于您的测试命名空间。

因此，不！您无法访问私有方法，但这是一种解决方法。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2020-09-07T10:58:52.683

如果您需要访问类的非静态私有方法，可以试试这个：

```
class Foo 
{
    private int Sum(int num1, int num2)
    {
        return num1 + num2;
    }
} 
```

```
MethodInfo sumPrivate = 
    typeof(Foo).GetMethod("Sum", BindingFlags.NonPublic | BindingFlags.Instance);

int sum = (int)sumPrivate.Invoke(new Foo(), new object[] { 2, 5 });
// 7 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-30T11:55:17.853

我会让私有方法包可见。这样你就可以保持它相当私密，同时仍然能够测试这些方法。我不同意人们说公共接口是唯一应该测试的接口。私有方法中经常有非常关键的代码，仅通过外部接口无法正确测试。

所以它真的归结为如果你更关心正确的代码或信息隐藏。我想说包可见性是一个很好的折衷方案，因为为了访问这些方法，有人必须将他们的类放在你的包中。这真的应该让他们三思而后行，看看这是否真的很聪明。

顺便说一句，我是一个 Java 人，所以包 visiblilty 在 C# 中可能被称为完全不同的东西。可以说，两个类必须在同一个命名空间中才能访问这些方法。

# iphone - -[UITextField isFirstResponder] 返回 false，即使字段当前正在编辑

> ID：249849
> 
> 赞同：7
> 
> 时间：2008-10-30T11:21:32.303
> 
> 标签：iphone, cocoa-touch

在我的视图控制器的`-viewDidLoad`方法中，我称之为`[myTextField becomeFirstResponder];` This works like a charm，打开键盘并且 myTextField 获得焦点。

我有一个带有目标动作的按钮（该动作在同一个控制器中）进行检查`[myTextField isFirstReponder]`- 但它总是返回 false （呃，`NO`用 Cocoa 术语；））。

这不是确定`myTextField`键盘是否可以输入的正确方法吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-10-30T13:44:50.003

如何检查编辑属性的值，即[myTextField isEditing]？

我认为当您点击它时，您的按钮会接管第一响应者的状态。

# c# - 在 VS2008 中运行测试时出现 System.UnauthorizedAccessException

> ID：249851
> 
> 赞同：4
> 
> 时间：2008-10-30T11:23:07.137
> 
> 标签：c#, .net, visual-studio, unit-testing

当我从 VS2008 运行 selenium 测试（编写为 nunit 测试）时，我得到：

> System.UnauthorizedAccessException ：拒绝访问路径 /bin/Debug。

该测试正在尝试读取 App.Config 中的条目。该文件在编译期间被复制到 bin/Debug。

我使用解锁器检查文件句柄，VS2008 具有该文件的句柄。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-12-11T00:32:28.597

我遇到了同样的问题。我解决它的方法是使用管理员权限启动 Visual Studio（右键单击 Visual Studio --> 以管理员身份运行）。然后我重新打开了解决方案并运行了我的测试。这一次他们通过了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T13:07:01.857

您需要更改您的测试配置，以便允许访问该目录。请参阅测试/编辑测试运行配置/部署。

如果您尝试在该目录中读取或写入文件，您可能需要将其复制到运行测试的目录中。同样，测试运行配置对话框的部署选项卡将帮助您。

# windows - 限制在面板上添加控件

> ID：249860
> 
> 赞同：0
> 
> 时间：2008-10-30T11:27:47.627
> 
> 标签：windows, .net-2.0, panel

如何限制在 C# 窗口控件中的面板中添加控件？我必须限制用户在设计时在面板中添加控件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T11:59:06.597

如果您想限制可以添加到面板的控件类型或控件数量，您可以创建自己的面板子类，并在 Controls.Add 方法的重载中检查控件类型或控件计数。

编辑：重载 Controls.Add 方法并不像我想象的那么容易，但是您可以创建一个扩展 Panel 类的新类并重写 OnControlAdded 方法以检查添加的控件类型。像这样的东西应该工作：

```
class MyPanel : Panel
{

    public MyPanel()
    { }

    protected override void OnControlAdded(ControlEventArgs e)
    {
        base.OnControlAdded(e);

        if (!(e.Control is Label))
        {
            MessageBox.Show("control " + e.Control.Name + " is not a label but a " + e.Control.GetType().ToString());
            Controls.Remove(e.Control);
        }

    }

} 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-10-30T11:40:30.033

将 AllowDrop 设置为 false。

# sql - 什么可能导致 ORA-00936 - 缺少以下 sql 的表达式？

> ID：249865
> 
> 赞同：0
> 
> 时间：2008-10-30T11:30:40.833
> 
> 标签：sql, oracle, ora-00936

我们看到以下 SQL 的错误消息 ORA-00936 Missing Expression：

请注意，这只是一个更大的 SQL 的缩减版本，因此将其重写为内部连接或类似的实际上不在此范围内：

这是失败的 SQL：

```
select (select count(*) from gt_roster where ROS_ROSTERPLAN_ID = RPL_ID)
from gt_rosterplan
where RPL_ID = 432065061 
```

我已经尝试过： * 提取最里面的 SQL 并从外部 SQL 中替换 ID 给我数字 12。结果（即仍然是错误）

我还需要看什么？

上面只是表，没有视图，RPL_ID是gt_rosterplan的主键，ROS_ROSTERPLAN_ID是这个列的外键，这里基本没有什么神奇或隐藏信息。

* * *

**编辑：**作为回答，不，您不需要此处的别名，因为列在表中是唯一命名的。

* * *

**已解决：**问题是客户端运行了错误的客户端驱动程序版本 9.2.0.1，并且该版本存在已知问题。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-27T09:04:23.283

问题是客户端运行了错误的客户端驱动程序版本 9.2.0.1，并且该版本存在已知问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T11:49:03.950

这应该可行，假设列名不模棱两可（即使它们会导致不同的错误）。我运行了一个等效的语句并得到了没有错误的结果：

```
SQL> select (select count(*) from emp2 where empdeptno = deptno)
  2  from dept
  3  where deptno=10
  4  /

(SELECTCOUNT(*)FROMEMP2WHEREEMPDEPTNO=DEPTNO)
---------------------------------------------
                                            3 
```

谷歌搜索似乎存在或已经存在导致 ORA-00936 错误的 Oracle 错误 -[例如，请参阅this](http://oracle-error.blogspot.com/2008/04/ora-00936missing-expression.html)。

# c# - 当我在 Silverlight 2 中以编程方式将段添加到路径时，为什么我的路径不显示？

> ID：249866
> 
> 赞同：4
> 
> 时间：2008-10-30T11:30:41.257
> 
> 标签：c#, silverlight

我`Path`在*Silverlight*中创建一个，并在鼠标事件中添加元素。但是，尽管元素存在于内存中，但屏幕不会更新，直到发生其他事情导致屏幕重绘发生。

这是相关代码 - 我正在响应鼠标事件，并且我保留了我正在编辑的路径的类成员。

```
Path path = null;

private void LayoutRoot_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
{
    Point thisPoint = e.GetPosition(LayoutRoot);
    if (path == null)
    {
        CreateNewPath(thisPoint);
        path.LayoutUpdated += new EventHandler(path_LayoutUpdated);
    }
    else
    {
        path.AddLineElement(thisPoint);
    }
}

private void CreateNewPath(Point startPoint)
{
    path = new Path();
    PathGeometry geometry = new PathGeometry();
    path.Data = geometry;
    PathFigureCollection figures = new PathFigureCollection();
    geometry.Figures = figures;
    PathFigure figure = new PathFigure();
    figures.Add(figure);
    figure.StartPoint = startPoint;
    figure.Segments = new PathSegmentCollection();
    path.Stroke = new SolidColorBrush(Colors.Red);
    path.StrokeThickness = 2;
    path.Stretch = Stretch.None;
    LayoutRoot.Children.Add(path);
} 
```

`AddLineElement`是路径类的扩展方法，只是为了简化：

```
public static class PathHelper
{
    public static void AddLineElement(this Path thePath, Point newPoint)
    {
        PathGeometry geometry = thePath.Data as PathGeometry;
        geometry.Figures[0].Segments.Add(new LineSegment { Point = newPoint });
    }
} 
```

这是重现问题所需的最低要求。如果您在完整的 WPF 应用程序中运行此代码，它会按预期工作。鼠标点击添加立即出现的线条元素。然而，在*Silverlight*中，情况就不同了。尽管单步执行代码显示数据正在被添加，但这些点击似乎什么也没做。但是如果你点击几次，然后调整浏览器的大小，例如路径元素就会出现。如果你碰巧在页面上也有一个按钮，然后将鼠标移到上面，就会出现路径。

我已经尝试了所有明显的事情，比如在（和父网格上）调用`InvalidateMeasure`和无济于事。`InvalidateArrange``Path`

我唯一的解决方法是更改​​路径上的属性然后将其更改回来，这似乎足以让渲染引擎绘制新的路径元素。我用`Opacity`. 您必须将其设置为不同的值，否则（我认为）该`PropertyChanged`事件将不会触发。不过，这是一个杂牌。

有没有其他人以这种方式玩过路径？我想如果我同时将其他图形元素放在屏幕上，这不会是一个问题，所以它可能不会影响可能的人，但如果有更正确的方法来做这件事会很高兴.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-12T10:25:41.630

我需要一些非常相似但使用新的 Silverlight VE 地图控件的东西。您上面的代码工作正常，没有任何摆弄其他属性来“强制重绘”。代码在这里供您参考：

```
using System.Windows.Controls;
using System.Windows.Input;
using System.Windows.Media;
using Microsoft.VirtualEarth.MapControl;

namespace MapInfo
{
    public partial class Page : UserControl
    {
        /// <summary>
        /// Sample drawing a polyline on a Virtual Earth map
        /// </summary>
        public Page()
        {
            InitializeComponent();
            VEMap.MouseLeftButtonUp += new MouseButtonEventHandler(VEMap_MouseLeftButtonDown);
            VEMap.MouseLeave += new MouseEventHandler(VEMap_MouseLeave);
        }

        MapPolyline polyline = null;

        /// <summary>
        /// Ends drawing the current polyline
        /// </summary>
        void VEMap_MouseLeave(object sender, MouseEventArgs e)
        {
            polyline = null;
        }
        /// <summary>
        /// Start or add-to a polyline
        /// </summary>
        private void VEMap_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
        {
            Map m = (Map)sender;

            Location l = m.ViewportPointToLocation(e.GetPosition(m));

            if (polyline == null)
            {
                CreateNewPolyline(l);
            }
            else
            {
                polyline.Locations.Add(l);
            }
        }
        /// <summary>
        /// Create a new MapPolyline
        /// </summary>
        /// <param name="startPoint">starting Location</param>
        private void CreateNewPolyline(Location startPoint)
        {
            polyline = new MapPolyline();
            polyline.Stroke = new SolidColorBrush(Colors.Red);
            polyline.StrokeThickness = 2;
            var lc = new LocationCollection();
            lc.Add(startPoint);
            polyline.Locations = lc;
            VEMap.Children.Add(polyline);
        }
    }
} 
```

对您的直接场景没有帮助，但表明其他 Silverlight 东西可以按您的预期工作。可能会帮助别人，我希望...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T16:43:42.467

什么样的元素是你的布局根？我复制了您的代码并使用 Canvas 作为布局根，它在 IE 和 Firefox 中都很好用。

```
<UserControl x:Class="SilverlightTesting.Page"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    Width="400" Height="300">
        <Canvas x:Name="LayoutRoot" Background="White" Width="400" Height="300" MouseLeftButtonDown="LayoutRoot_MouseLeftButtonDown"/>
</UserControl> 
```

我复制了你所有的代码并创建了一个新的 path_LayoutUpdated 方法，它什么都不做。当我点击屏幕时，我会在我点击的点上画出新的线条。

# java - 在同一个对象上同步两次？

> ID：249867
> 
> 赞同：57
> 
> 时间：2008-10-30T11:31:15.887
> 
> 标签：java, multithreading, synchronization, mutex

我想知道如果我在同一个对象上同步两次，在 Java 中是否会出现任何奇怪的行为？

场景如下

```
pulbic class SillyClassName {

    object moo;
    ...
    public void method1(){
        synchronized(moo)
        {
            ....
            method2();
            ....
        }
    }

    public void method2(){
        synchronized(moo)
        {
            doStuff();
        }
    }
} 
```

两种方法都使用对象并在其上同步。第二种方法被第一种方法调用时会因为被锁定而停止吗？

我不这么认为，因为它是同一个线程，但我不确定可能会出现任何其他奇怪的结果。

* * *

## 回答 #1

> 赞同：83
> 
> 时间：2008-10-30T11:45:20.540

# 可重入

同步块使用*可重入*锁，这意味着如果线程已经持有锁，它可以重新获取它而不会出现问题。因此，您的代码将按预期工作。

[请参阅Java 教程](https://docs.oracle.com/javase/tutorial/index.html)页面[Intrinsic Locks and Synchronization](https://docs.oracle.com/javase/tutorial/essential/concurrency/locksync.html)的底部。

自 2015 年 1 月起引用……</p>

> **可重入同步**
> 
> 回想一下，一个线程不能获得另一个线程拥有的锁。但是线程可以获取它已经拥有的锁。允许一个线程多次获取同一个锁可以实现*重入同步*。这描述了一种情况，同步代码直接或间接调用一个也包含同步代码的方法，并且两组代码都使用相同的锁。如果没有可重入同步，同步代码将不得不采取许多额外的预防措施来避免线程导致自身阻塞。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-04-04T20:31:51.360

我认为我们必须为您尝试做的事情使用可重入锁。[这是来自http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/ReentrantLock.html](http://docs.oracle.com/javase/1.5.0/docs/api/java/util/concurrent/locks/ReentrantLock.html)的片段。

> 我们所说的可重入锁是什么意思？简单来说就是有一个与锁相关的获取计数，如果持有锁的线程再次获取它，获取计数就会增加，然后需要释放两次锁才能真正释放锁。这与同步的语义相似；如果一个线程进入一个由该线程已经拥有的监视器保护的同步块，该线程将被允许继续，当线程退出第二个（或后续）同步块时，锁不会被释放，而只会被释放当它退出它进入受该监视器保护的第一个同步块时。

虽然我没有尝试过，但我想如果你想做上面的事情，你必须使用可重入锁。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-11-10T20:26:14.183

Java 似乎完全支持同一线程对一个对象的嵌套锁。这意味着如果一个线程对一个对象有一个外部锁和一个内部锁，而另一个线程试图锁定同一个对象，那么第二个线程将被挂起，直到**两个**锁都被第一个线程释放。

我的测试是在 Java 6 SE 下完成的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-30T11:40:09.863

在 java 中，`synchronized`方法上的关键字基本上与当前对象同步，因此实际上它正在隐式执行您上面建议的操作。

在一种方法中同步一个对象，然后在另一种方法中同步同一个对象，您不会遇到问题，因为正如您所说，当前线程已经持有该对象的锁。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-30T11:41:14.417

没问题。在您的示例中，（一旦您修复代码以消除您将获得的编译警告；）），同步可确保方法 1 和方法 2 中的块不会同时执行。

这就是同步的重点。:)

* * *

编辑：对不起，错过了你的部分问题，但菲尔回答了。总而言之，单个线程不能自己死锁。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T15:46:24.437

不，如果第一种方法调用第二种方法，则不会停止。不会出现奇怪的结果（除了检查锁的轻微开销。这无关紧要。从 Java 6 开始，您在 JVM - [Java SE 6 性能白皮书](https://www.oracle.com/java/technologies/javase/6performance.html)中进行了锁粗化。）

例如，看一下 java.util.Vector 的源代码。在同步方法中有很多对其他同步方法的调用。

# php - 如果有人通过 POST 或 GET 来，我如何判断 php 页面？

> ID：249868
> 
> 赞同：13
> 
> 时间：2008-10-30T11:31:17.167
> 
> 标签：php, http

我想在 php 中有一个页面，该页面通常根据发送给它的 GET 请求显示信息。但是，我希望它也能够处理某些 POST 请求。那么，我如何判断 POST 是否发送了任何数据以便我可以采取行动呢？

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-10-30T11:34:23.370

用于`$_SERVER['REQUEST_METHOD']`确定您的页面是通过 GET 还是 POST 请求访问的。

如果它是通过 post 访问的，则检查任何`$_POST`要处理的变量。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-10-30T11:38:26.433

如果您想通过 POST 和 GET 传递相同的变量，那么您始终可以使用包含来自 POST 和 GET 的参数的 REQUEST。然而，这通常被视为一个安全漏洞，因为这意味着变量更容易被欺骗。

如果您想测试请求是通过 POST 还是 GET 发送的，那么您可以：

```
if($_SERVER['REQUEST_METHOD'] === 'post')
{
    // Do one thing
}
elseif($_SERVER['REQUEST_METHOD'] === 'get')
{
    // Do another thing
} 
```

或者：

```
 if(!empty($_POST))
 {
     // Process POST
 }
 elseif(!empty($_GET))
 {
     // Process GET
 } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-30T11:36:10.260

检查`$_SERVER['REQUEST_METHOD']`。文档在[这里](http://uk3.php.net/manual/en/reserved.variables.server.php)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T14:29:12.377

对于这样的问题，通常是关于环境变量的，我是这样解决的：

*   创建一个只调用 phpinfo(); 的 foo.php
*   获取 foo.php
*   发布到 foo.php
*   比较 phpinfo() 的输出；并就行为是什么提出我的理论
*   根据 php.net 上的文档验证我的理论

这比试图在 php.net 的 doc swamp 中找到答案要容易得多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-31T15:06:35.620

如果有页面，我使用 $_REQUEST 变量

> 它还需要能够处理某些 POST 请求

[http://is.php.net/manual/en/reserved.variables.request.php](http://is.php.net/manual/en/reserved.variables.request.php)

从手册：

默认情况下包含 $_GET、$_POST 和 $_COOKIE 内容的关联数组。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-10-30T11:35:55.240

```
!empty($_POST) 
```

我很确定您可以通过 GET 和 POST 访问页面，所以这将是 IMO 最安全的方式

# c# - 创建 REST 客户端 API

> ID：249874
> 
> 赞同：2
> 
> 时间：2008-10-30T11:34:23.947
> 
> 标签：c#, asp.net-mvc, rest, wadl

我目前正在研究为 RESTfull 应用程序创建客户端 API 的选项。到目前为止，我们已经拥有 WCF 服务来允许所有应用程序连接到业务层，并且我们对它越来越不满意。

我们已经为 Web 准备了大部分基础设施（html 和 json 请求），但我们需要从其他应用程序访问服务（一些将与主要的 Web 应用程序模型库链接，而另一些则不会）。

我一直在[这里](http://searchsoa.techtarget.com/tip/0,289483,sid26_gci1265367,00.html)和[这里](https://wadl.dev.java.net/wadl2java.html)阅读有关 WADL 的信息，这似乎是有益的。我们可以生成 wadl、客户端库并使用它来检查 javascript url。

我想知道其他人使用了什么，什么有效，什么无效。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T14:04:37.073

一个好的 REST 客户端 API 是一组围绕 curl、wget 或您的语言特定 HTTP 库的包装器。您可能还需要一些额外的方法或函数来处理您的应用程序的细节（即专门的 XML/JSON 解析），但这应该是关于它的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T12:09:51.410

在 REST 架构中：

*   资源链接到他们的描述文档，如果他们有，而不是相反。
*   资源并不复杂（不像 RPC），因此通常不需要描述文档。
*   松耦合为王；合同既不必要又有害。
*   资源相互链接，消除了对资源发现服务的大部分需求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-30T23:33:26.350

[iBeans](http://www.mulesoft.org/display/IBEANS/Home)是一个新的开源项目，它试图为此提供解决方案。iBean（集成 Bean）是 RESTful 或其他服务的客户端 API。目前 iBeans 确实需要一个服务器（您可以很容易地将框架放入 Tomcat）并且可以从 Javascript 或 java 应用程序中使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-15T00:12:58.257

试试这个网络应用程序：[FRAPI](http://getfrapi.com/)。相当令人印象深刻

# wix - 为什么需要在带有 UAC 的 Vista 上延迟设置 reg 密钥的 MSI CustomAction？

> ID：249876
> 
> 赞同：5
> 
> 时间：2008-10-30T11:35:32.650
> 
> 标签：wix, windows-installer

我们有一个 CustomAction 来设置一些注册表键 HKEY LOCAL_MACHINE。这不适用于带有 UAC 的 Vista，直到我们将操作“推迟”。安装程序在其他情况下工作。有谁知道为什么？

我们正在使用 WIX 来创建安装程序。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-11-22T22:02:37.297

+1 长矛。换一种说法并提供更多信息

MSI 流程有 2 个步骤

*   **立即**- 您收集首选项的位置（安装目录等） - 不应在此处对机器进行任何更改

然后稍后

*   **延迟**- 在收集所有首选项并实际执行安装后运行。

一些进一步的想法

*   **可能并不总是立即**运行（例如脚本安装），所以不要依赖它。

有 2 种模式可以运行**延迟操作**

*   **[NoImpersonate](http://blogs.msdn.com/rflaming/archive/2006/09/23/768248.aspx)** - 又名 NT Authority\System，对您的计算机拥有完全权限

*   **模仿**- 启动安装的人。

启用 UAC后， **Impersonate**有一个踢球者。即使用户实际上是管理员，[您也将只有标准用户令牌并且没有管理员权限- 因此请尽可能保持](http://technet.microsoft.com/en-us/library/cc709628.aspx)**NoImpersonate**，否则您的自定义操作将无法执行任何操作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-10-30T19:53:39.320

在 InstallExecuteSequence 中遇到您的自定义操作时，它会立即运行；而不是在执行实际安装脚本时。这导致您的自定义操作以用户权限而不是系统的提升权限执行。这一系列博文将详细解释发生了什么，[http://blogs.msdn.com/rflaming/archive/2006/09/23/768146.aspx](http://blogs.msdn.com/rflaming/archive/2006/09/23/768146.aspx)。您不应该有影响机器状态的自定义操作不作为延迟自定义操作运行。

# html - 如果 html 说 如果它说“oneword”，那么我可以写“#oneword”，但是当单词中有空格时我该怎么写？ 问问题 Corey Trager 问问题 2008-10-30T11:35:50.123 40166 次 This question shows research effort; it is useful and clear 24 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. 如果它说“oneword”，那么我可以写“#oneword”，但是当单词中有空格时我该怎么写？ id 不能有多个单词，但 class 可以。 <p class="one two">lalala</p> .one { color: black; } .two { font-weight: bold; } htmlcss 4 7 回答 7 This answer is useful 41 如果它包含空格，则它不是合法的 HTML。你不应该期望这会起作用。这是HTML 4.01规范的相关部分。 [编辑] 正如其他人所指出的，您可以通过为 div 分配一个或多个类名并使用类名进行选择来解决此问题。 于 2008-10-30T11:40:50.673 回答 This answer is useful 32 id 不能有多个单词，但 class 可以。 <p class="one two">lalala</p> .one { color: black; } .two { font-weight: bold; } 于 2008-10-30T11:39:14.687 回答 This answer is useful 13 像这样写 div[id='两个字']{ } 这会将 id 识别为“两个”和“单词”的组合。 于 2014-10-02T17:47:40.480 回答 This answer is useful 8 改成两个字。就像其他人说的那样，您不能使用空格作为 id，但可以使用空格。 #two-words { font-family: arial; } .center { text-align: center; } .bold { font-weight: bold; } <div id="two-words" class="center bold">STUFF HERE</div> 于 2008-10-30T12:17:49.100 回答 This answer is useful 6 您不应该在 ID 元素中使用空格，因为空格通常被接受为选择器组合符。 于 2008-10-30T11:43:42.540 回答 This answer is useful -1 如果你用 Artisteer 之类的 IDE 制作网站，你可以看到一个id="two words"变成类的工作 .two{ } .words{ } 我不知道这是否是一个好习惯，但它确实有效。 于 2012-08-23T16:33:31.393 回答 This answer is useful -1 这是工作， #two\ words { } 不过不要使用它，因为 id 的值不能包含空格（空格、制表符等）。浏览器将包含空格的不合格 ID 视为空格是 ID 的一部分。 在这里阅读更多 于 2021-08-16T14:45:22.680 回答 Related 3 iphone - 如何根据 BOOL 值对其他类隐藏已实现的委托方法？- 目标 c 1 windows - VIM：如何根据缓冲区类型映射命令？ 3 javascript - 使用 .click 另一个 div 后如何使用 .blur 删除 div 1 cakephp - 单页上的多个 TinyMCE 实例在表单提交后给出值 2 wordpress - wp-plugin 或任何用于 wordpress 中特定类别的密码保护的代码 1 javascript - 如何在页面底部构建简单的粘性导航？ 4 spring - 当前请求不是多部分请求 - Spring MVC 1 mysql - 获取 #1111 - 无效使用组函数错误 2 google-cloud-storage - Gsutil cp -z 返回CommandException：可用于压缩的临时空间不足 3 jquery - 使用 Jquery 从具有特定类的列表中删除项目 Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：249878
> 
> 赞同：24
> 
> 时间：
> 
> 标签：html, css

如果它说“oneword”，那么我可以写“#oneword”，但是当单词中有空格时我该怎么写？

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2008-10-30T11:40:50.673

如果它包含空格，则它不是合法的 HTML。你不应该期望这会起作用。这是[HTML 4.01](http://www.w3.org/TR/html401/types.html#type-name)规范的相关部分。

[编辑] 正如其他人所指出的，您可以通过为 div 分配一个或多个类名并使用类名进行选择来解决此问题。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-10-30T11:39:14.687

id 不能有多个单词，但 class 可以。

```
<p class="one two">lalala</p>

.one {
    color: black;
}

.two {
    font-weight: bold;
} 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2014-10-02T17:47:40.480

像这样写

div[id='两个字']{

}

这会将 id 识别为“两个”和“单词”的组合。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-10-30T12:17:49.100

改成两个字。就像其他人说的那样，您不能使用空格作为 id，但可以使用空格。

```
#two-words { font-family: arial; }
.center { text-align: center; }
.bold { font-weight: bold; }

<div id="two-words" class="center bold">STUFF HERE</div> 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-10-30T11:43:42.540

您不应该在 ID 元素中使用空格，因为空格通常被接受为[选择器组合符](http://www.w3.org/TR/CSS21/selector.html#selector-syntax)。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-08-23T16:33:31.393

如果你用 Artisteer 之类的 IDE 制作网站，你可以看到一个`id="two words"`变成类的工作

```
.two{
}

.words{
} 
```

我不知道这是否是一个好习惯，但它确实有效。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2021-08-16T14:45:22.680

这是工作，

```
#two\ words {

} 
```

不过不要使用它，因为 id 的值不能包含空格（空格、制表符等）。浏览器将包含空格的不合格 ID 视为空格是 ID 的一部分。

[在这里](https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/id)阅读更多

# c# - 如何将节点结构从一个xml复制到另一个具有不同命名空间的xml？

> ID：249883
> 
> 赞同：1
> 
> 时间：2008-10-30T11:38:11.850
> 
> 标签：c#, xml

我有两个具有两个不同 XSD 架构和不同名称空间的 XML 文件。它们都具有相同的子结构。现在我需要将该节点（和所有子节点）从一个 XML 文档复制到另一个。

如果命名空间相同，克隆就可以了。有什么好的方法吗？（子结构稍后将更改 - 但将保持相同。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-30T12:49:52.407

基本上，您需要一个 XSL 转换来创建具有相同名称但名称空间不同的新元素。

考虑以下输入 XML：

```
<?xml version="1.0" encoding="UTF-8"?>
<test xmlns="http://tempuri.org/ns_old">
    <child attrib="value">text</child>
</test> 
```

现在你需要一个模板，上面写着“复制你看到的所有东西的结构和名称，但是当你在它的时候声明一个新的命名空间”：

```
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet
  version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:old="http://tempuri.org/ns_old"
>
  <xsl:output method="xml" version="1.0" 
    encoding="UTF-8" indent="yes" omit-xml-declaration="no" 
  />

  <xsl:template match="node()|@*">
    <xsl:copy>
      <xsl:apply-templates select="node()|@*"/>
    </xsl:copy>
  </xsl:template>

  <xsl:template match="old:*">
    <xsl:element name="{local-name()}" namespace="http://tempuri.org/ns_new">
      <xsl:apply-templates select="node()|@*"/>
    </xsl:element>
  </xsl:template>

</xsl:stylesheet> 
```

当您通过它运行上述 XML 时，会产生：

```
<?xml version="1.0" encoding="UTF-8"?>
<test xmlns="http://tempuri.org/ns_new">
  <child attrib="value">text</child>
</test> 
```

您的所有`http://tempuri.org/ns_old`元素都有效地改变了它们的命名空间。当您的输入 XML 同时具有多个名称空间时，XSL 很可能必须进行一些扩展。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T20:32:47.370

不确定这是否适用，但我在 vb.net 中使用两个 xml 文档做了类似的事情：

```
Private Shared Sub CopyElement(ByVal FromE As Xml.XmlElement, ByVal ToE As Xml.XmlElement)
    CopyElement(FromE, ToE, Nothing)
End Sub
Private Shared Sub CopyElement(ByVal FromE As Xml.XmlElement, ByVal ToE As Xml.XmlElement, ByVal overAttr As Xml.XmlAttributeCollection)
    Dim NewE As Xml.XmlElement
    Dim e As Xml.XmlElement
    NewE = ToE.OwnerDocument.CreateElement(FromE.Name)

    CopyAttributes(FromE, NewE)
    If Not overAttr Is Nothing Then
        OverrideAttributes(overAttr, NewE)
    End If
    For Each e In FromE
        CopyElement(e, NewE, overAttr)
    Next
    ToE.AppendChild(NewE)

End Sub
Private Shared Sub CopyAttributes(ByVal FromE As Xml.XmlElement, ByVal ToE As Xml.XmlElement)
    Dim a As Xml.XmlAttribute
    For Each a In FromE.Attributes
        ToE.SetAttribute(a.Name, a.Value)
    Next
End Sub
Private Shared Sub OverrideAttributes(ByVal AC As Xml.XmlAttributeCollection, ByVal E As Xml.XmlElement)
    Dim a As Xml.XmlAttribute
    For Each a In AC
        If Not E.Attributes.ItemOf(a.Name) Is Nothing Then
            E.SetAttribute(a.Name, a.Value)
        End If
    Next
End Sub 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-10T08:07:10.987

遵循 Tomalak 的示例（稍加修正），但使用 SetAttribute + OuterXml + InnerXml 更简单 const string xml_str = @"

```
<?xml 版本='1.0' 编码='UTF-8'?>
<根>
  <测试 xmlns='http://tempuri.org/ns_old'>
    <child attrib='value'>文本</child>
  </测试>
</root>";

```

";

```
public static void RunSnippet() 
```

{

```
 XmlDocument doc = new XmlDocument();
    doc.LoadXml(xml_str);

    XmlElement elem = doc.DocumentElement["test"];
    WL( string.Format("[{0}]", elem ) );
    elem.SetAttribute("xmlns", "http://another.namespace.org/");
    WL( elem.OuterXml );

    XmlDocument another_doc = new XmlDocument();
    another_doc.LoadXml("<root/>");
    another_doc.DocumentElement.InnerXml = elem.OuterXml;
    WL( another_doc.DocumentElement.OuterXml ); 
```

}

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-09T08:45:17.570

如果您希望在匹配某个属性时复制节点的所有子元素。您可以只复制`InnerXML`引用节点并将其设置为等于新节点。

像这样，在下面，我有一个带有*Document Element*或*Root*元素的 XML 块`Tablist`，我需要在`Tablist`with下添加新节点，`Role="Ka"`并且所有子节点都`Ka`应该与 XXX 相同：

```
<Tablist>
    <Designation Role="XXX">
        <!--<Tab name="x" default="x"/>-->
        <!--<Tab name="y" default="y"/>-->
        <Tab name="r" default="r" />
        <Tab name="rd" default="rd" />
        <Tab name="qq" default="qq" />
        <Tab name="ddd" default="ddd" />
      </Designation>
    <Designation Role="YYY">
        <!--<Tab name="a" default="a"/>-->
        <!--<Tab name="b" default="b"/>-->
        <Tab name="c" default="c" />
        <Tab name="dd" default="dd" />
        <Tab name="ee" default="ee" />
        <Tab name="f" default="f" />
      </Designation>
    </Tablist> 
```

所以我只写以下代码：

```
XmlDocument objXmlDocument1 = null;
objXmlDocument1 = new XmlDocument();
objXmlDocument1.Load(
    System.Web.HttpContext.Current.Server.MapPath("") + 
    "\\XMLSchema\\" + 
    "ABC.xml");

XMLNodesList nodes1 = objXmlDocument1.GetElementsByTagName("Designation");
foreach (XmlNode n in nodes1) {
    if (n.Attributes["Role"].Value.Trim().Equals("XXX"){                                
        objnode1 = n;
        break;
    }
}
if (objnode1 != null){
    XmlNodeList innerNodes1 = objnode1.ChildNodes;
    XmlNode newNode1 = objXmlDocument1.CreateElement("Designation");
    XmlAttribute newAtt1 = objXmlDocument1.CreateAttribute("Role");
    newAtt1.Value = "Ka";
    newNode1.Attributes.Append(newAtt1);
    newNode1.InnerXml=objnode1.InnerXml;
    objXmlDocument1.DocumentElement.AppendChild(newNode1);
}
objXmlDocument1.Save(
    System.Web.HttpContext.Current.Server.MapPath("") + 
    "\\XMLSchema\\" + 
    "ABC.xml"); 
```

# sql - 标准 SQL 关键字？

> ID：249891
> 
> 赞同：9
> 
> 时间：2008-10-30T11:40:30.067
> 
> 标签：sql, reference

标准( **ANSI** ) SQL {关键字/保留字/函数}有哪些？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-10-30T11:51:35.457

为 ANSI SQL 标准检查所有[保留字](https://github.com/ronsavage/SQL)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T11:43:24.320

w3schools 可能是一个不错的选择。

更具体地说，您可以参考 RDBMS 手册本身，其中可能会详细说明如何使用每个受支持的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-30T12:05:51.730

[这是](http://www.pacosdrivers.com/asp/reserved/)所有保留 SQL 字的列表，但我也发现这个[SQL 保留字检查器](http://www.petefreitag.com/tools/sql_reserved_words_checker/)工具很有趣..

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T11:43:23.350

这是 Microsoft 参考（用于 T-SQL）：

[http://msdn.microsoft.com/en-us/library/aa238507(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa238507%28SQL.80%29.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-10-30T11:45:48.527

[超链接 BNF 语法](http://savage.net.au/SQL/sql-92.bnf.html)?

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T12:02:33.313

"您不能删除这个已接受的答案",

所以请不要投反对票；）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-30T12:08:02.740

[您可以在此处](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/ap_keywd.htm#i690190)找到 Oracle 10g 保留字。[目录](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/toc.htm)还列出了所有功能。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-30T12:25:27.963

[W3Schools 的 SQL 快速参考](http://www.w3schools.com/sql/sql_quickref.asp)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-30T12:28:27.333

[PostgreSQL 的列表](http://www.postgresql.org/docs/current/static/sql-keywords-appendix.html)（还包含来自 SQL-92、SQL:1999 和 SQL:2003 标准的列表）。

# user-controls - 相当于其他框架中的webcontrols？

> ID：249901
> 
> 赞同：1
> 
> 时间：2008-10-30T11:43:24.663
> 
> 标签：user-controls, frameworks

什么是 ASP.Net 以外的框架中的 Web 控件等价物？

具体来说，我想了解 Java、PHP 和 Ruby on Rails。

这些 Web 开发框架的相对优点/缺点是什么？

我对 ASP.Net 有所了解，并被要求研究开发一个具有可配置控件的应用程序。我知道如何在 ASP.Net 中执行此操作，但它是在 linux 机器上运行的，根据我的经验，运行 ASP.Net 时 Mono 并不成熟/稳定。

**澄清**

基本上，我所说的 webcontrols 是一组可重用的组件，我可以使用各种值进行初始化。

因此，例如，如果我想要一个可重用的组件，它在页面上绘制某种图形。我想列出其中的几个来绘制不同的东西。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-10-30T12:03:45.620

我相信没有。

ASP.NET Web 控件是一个大杂烩，将`<input>`HTML`<submit>`元素组合在一起以利用 ASP.NET Web 窗体页面生命周期。这反过来又促进了 Web 应用程序中类似 Windows 形式的行为。

AFAIK 在其他框架中，他们仍然使用纯 HTML 控制元素和 Javascript 来修改行为。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-30T12:04:24.853

在 Java 世界中，“Apache Wicket”提供了一种实现此目的的方法。UI 是围绕组件的概念构建的。每个网页都是由组件组成的。

它与传统的 JSP 编程不同，与 GUI 小部件开发类似。传统的 jsp 自定义标签也可以作为组件，但不支持从其他自定义标签组成自定义标签。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T12:50:40.423

没有。但是许多高级框架定义了它们的 web ui 小部件类型。

# android - 如何从 Java 程序中找到 Android 中的 DNS 服务器？

> ID：249916
> 
> 赞同：18
> 
> 时间：2008-10-30T11:49:50.373
> 
> 标签：android, dns, java

该`java.net.InetAddress.GetByName(String host)`方法只能返回`A`记录，因此要查找我需要能够使用该`dnsjava`库发送 DNS 查询的其他记录类型。

但是，这通常依赖于能够解析`/etc/resolv.conf`或类似的方法来查找 DNS 服务器地址，而这在 Android 上不起作用。

Android 上的当前 DNS 设置显然只能通过使用`getprop`命令从 shell 中获取。

谁能告诉我如何从 Java 中获取这些设置，而不是通过生成 shell`Runtime.exec()`并解析输出`getprop`？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-06T03:15:52.083

[DNS 协议](http://tools.ietf.org/rfc/rfc882.txt)并没有那么复杂——您不能只使用原始套接字（TCP 或 UDP）进行 DNS 访问吗？在快速浏览了 dnsjava doco 之后，它似乎提供了低级别的 DNS 支持来帮助解决这个问题。

另一个可能的方向是，从 dnsjava 开始，消除对`/etc/resolv.conf`. 我会考虑在您的启动脚本中使用 getprop 来设置 JVM 中的属性，或者`resolv.conf`在您的应用程序目录中创建一个本地化文件，您可以从中读取所需的信息。换句话说，使用 getprop 将信息注入 JVM，而不是在 JVM 运行后尝试将其拉入。当然，创建一个 dnsjava 可以直接使用的文件应该是可行的。

* * *

## 编辑 - android.net

看起来`android.net.ConnectivityManager`会为您提供一系列 NetworkInfo 的 using `getAllNetworkInfo()`. 然后用于`android.net.NetworkUtils.runDhcp()`获取任何给定网络接口的 DhcpInfo - **DhcpInfo****结构**具有该接口的 dns1 和 dns2 的 IP 地址。令人惊讶的是，DNS 是 int，因此仅暗示 IP4。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-22T08:50:29.500

我认为一般情况下是不可能的。对于 WiFi，我发现了这个：

```
WiFiManager wifi = (WifiManager) getSystemService(WIFI_SERVICE); 
DhcpInfo info = wifi.getDhcpInfo(); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-04-18T12:16:44.040

要获取 android 系统的系统属性，可以使用此类 ( [android.os.SystemProperties ) 中的静态方法。](http://omapzoom.org/?p=platform/frameworks/base.git;a=blob;f=core/java/android/os/SystemProperties.java;h=619bf8dba051ef9248d5a3f7cfa8ad4015239be1;hb=HEAD)因为它不是一个开放的 api，所以你不能针对 sdk 编译它。需要解决此问题，例如从 AOSP 复制代码以通过编译。由于本课程供内部使用，因此您需要自担风险。玩得开心。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-09-22T16:11:12.610

我们应该能够找到与我们连接的网络（wifi 或以太网）无关的 dns 地址。这是我的程序。

在您的**AndroidManifest.xml**文件中

```
<uses-permission android:name="android.permission.INTERNET" />
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" /> 
```

**你的代码：**

```
 ConnectivityManager connectivityManager = (ConnectivityManager) getApplicationContext().getSystemService(Service.CONNECTIVITY_SERVICE);

                /* you can print your active network via using below */
                Log.i("myNetworkType: ", connectivityManager.getActiveNetworkInfo().getTypeName());
                WifiManager wifiManager= (WifiManager) getApplicationContext().getSystemService(getApplicationContext().WIFI_SERVICE);

                Log.i("routes ", connectivityManager.getLinkProperties(connectivityManager.getActiveNetwork()).getRoutes().toString());
                Log.i("domains ", connectivityManager.getLinkProperties(connectivityManager.getActiveNetwork()).getDomains().toString());
                Log.i("ip address ", connectivityManager.getLinkProperties(connectivityManager.getActiveNetwork()).getLinkAddresses().toString());
                Log.i("dns address ", connectivityManager.getLinkProperties(connectivityManager.getActiveNetwork()).getDnsServers().toString());

                if(connectivityManager.getActiveNetworkInfo().getType() == ConnectivityManager.TYPE_WIFI) {
                    Log.i("myType ", "wifi");
                    DhcpInfo d =wifiManager.getDhcpInfo();
                    Log.i("info", d.toString()+"");
                }
                else if(connectivityManager.getActiveNetworkInfo().getType() == ConnectivityManager.TYPE_ETHERNET) {
/* there is no EthernetManager class, there is only WifiManager. so, I used this below trick to get my IP range, dns, gateway address etc */

                    Log.i("myType ", "Ethernet");
                    Log.i("routes ", connectivityManager.getLinkProperties(connectivityManager.getActiveNetwork()).getRoutes().toString());
                    Log.i("domains ", connectivityManager.getLinkProperties(connectivityManager.getActiveNetwork()).getDomains().toString());
                    Log.i("ip address ", connectivityManager.getLinkProperties(connectivityManager.getActiveNetwork()).getLinkAddresses().toString());
                    Log.i("dns address ", connectivityManager.getLinkProperties(connectivityManager.getActiveNetwork()).getDnsServers().toString());

                }
                else {

                } 
```

**输出** [![在此处输入图像描述](https://i.stack.imgur.com/ufDnv.png)](https://i.stack.imgur.com/ufDnv.png)

您无法知道您是通过 wifi 连接还是使用`WifiManager`仅`WifiManager`与 wifi 交易的网络连接。你必须使用`ConnectivityManager`. 我再次更新了我合并的代码`WifiManager`并`ConnectivityManager`产生了你想要的结果。

# c# - 将 Eval 从 ASPX 传递到 Javascript 函数作为参数

> ID：249926
> 
> 赞同：20
> 
> 时间：2008-10-30T11:54:18.323
> 
> 标签：c#, asp.net, javascript

```
<a id="lblShowTimings"
     runat="server"
     title='<%# Eval("SHOW_Name") %>'
     onclick='PopulateTicketDiv(<%#Eval("SHOW_ID") %>)'>  <-- this is the problem
  %#Eval("SHOW_Time") %>
</a> 
```

Eval 可以作为参数传递给 javascript 函数吗？如果是这样，语法是什么？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-10-30T12:22:38.513

是的。但是，您想要做的是：

```
onclick='<%# "PopulateTicketDiv(" +Eval("SHOW_ID") + " );" %>' 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2011-05-05T06:48:27.680

当您想将字符串作为参数传递时，上述解决方案会产生问题，您可以使用以下语法来通过：

```
OnClientClick='<%# String.Format("javascript:return displayDeleteWarning(\"{0}\")", Eval("ItemName").ToString()) %>' 
```

无论参数数据类型如何，上面的行都应该工作

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-30T12:30:35.863

尝试

```
<script type="javascript">
     //Pollute the global namespace
     var ticketDivID = <%= SHOW_ID %>
</script>

<a id="lblShowTimings" runat="server" title='<%# Eval("SHOW_Name") %>' onclick='PopulateTicketDiv(ticketDivID)'> <%#Eval("SHOW_Time") %></a> 
```

附带说明一下，因为您有 runat="server" 如果它在网格/中继器中，则可以在 OnRowDataBound 中从后端设置 onclick，如果不是，则在 page_load 上设置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-11-22T04:33:28.693

您可以在 gridview、repeater 或..etc 中使用此语法。

```
<asp:ImageButton  
 ID="Imagebutton1" runat="server"
 ImageUrl="../../common/images/pencil.gif"                
 OnClientClick='<%# String.Format("EditBankAccount(\"{0}\");", Eval("BankAccountID")) %>'
 OnClick="ImgBankAccountsDGEdit_Click"/> 
```

您的 JavaScript 函数将是：

```
 function EditBankAccount(bankaccountid) {
       // Your code goes here
       // return true OR false based on your requirement
    } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-02-14T10:31:28.630

请检查此代码

onclick='<%#Eval("DocumentPath","Chk(\"{0}\")") %>'

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-10-12T11:29:57.803

基本上你需要逃避报价

```
<asp:CheckBox onclick='<%# "ToggleByPassValidationRules(" + "\"" + Eval("Name") + "\"" + ");" %>' ID="chkIsRuleActive" runat="server" Enabled="false" /> 
```

# c# - 重新启动（回收）应用程序池

> ID：249927
> 
> 赞同：72
> 
> 时间：2008-10-30T11:54:24.140
> 
> 标签：c#, .net, asp.net-mvc, iis, application-pool

如何从 C# (.net 2) 重新启动（回收）IIS 应用程序池？

感谢您发布示例代码吗？

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2009-07-04T09:45:24.037

开始了：

```
HttpRuntime.UnloadAppDomain(); 
```

* * *

## 回答 #2

> 赞同：57
> 
> 时间：2008-10-30T12:00:58.637

如果您在**IIS7**上，那么如果它停止，它将执行此操作。我假设您可以调整以重新启动而无需显示。

```
// Gets the application pool collection from the server.
[ModuleServiceMethod(PassThrough = true)]
public ArrayList GetApplicationPoolCollection()
{
    // Use an ArrayList to transfer objects to the client.
    ArrayList arrayOfApplicationBags = new ArrayList();

    ServerManager serverManager = new ServerManager();
    ApplicationPoolCollection applicationPoolCollection = serverManager.ApplicationPools;
    foreach (ApplicationPool applicationPool in applicationPoolCollection)
    {
        PropertyBag applicationPoolBag = new PropertyBag();
        applicationPoolBag[ServerManagerDemoGlobals.ApplicationPoolArray] = applicationPool;
        arrayOfApplicationBags.Add(applicationPoolBag);
        // If the applicationPool is stopped, restart it.
        if (applicationPool.State == ObjectState.Stopped)
        {
            applicationPool.Start();
        }

    }

    // CommitChanges to persist the changes to the ApplicationHost.config.
    serverManager.CommitChanges();
    return arrayOfApplicationBags;
} 
```

如果您使用的是**IIS6**，我不太确定，但您可以尝试获取 web.config 并编辑修改日期或其他内容。对 web.config 进行编辑后，应用程序将重新启动。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-10-30T12:44:10.733

也许这篇文章会有所帮助：

*   [以编程方式回收当前的应用程序池（对于 IIS 6+）](http://web.archive.org/web/20140705173452/http://www.logue.com.ar/blog/2008/02/find-and-recycle-current-application-pool-programmatically-for-iis-6)
*   [在 IIS 6.0 中使用 WMI 回收应用程序池](http://blogs.iis.net/chrisad/archive/2006/08/30/Recycling-Application-Pools-using-WMI-in-IIS-6.0.aspx)
*   [以编程方式回收 IIS 6.0 应用程序池](http://www.codeproject.com/KB/aspnet/AppPoolRecycle.aspx)
*   [以编程方式回收 IIS 应用程序池](http://web.archive.org/web/20130405055048/http://blog.developers.ie/cgreen/archive/2006/10/20/2341.aspx)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-01-30T17:14:05.813

下面的代码适用于 IIS6。未在 IIS7 中测试。

```
using System.DirectoryServices;

...

void Recycle(string appPool)
{
    string appPoolPath = "IIS://localhost/W3SVC/AppPools/" + appPool;

    using (DirectoryEntry appPoolEntry = new DirectoryEntry(appPoolPath))
    {
            appPoolEntry.Invoke("Recycle", null);
            appPoolEntry.Close();
    }
} 
```

您也可以将“回收”更改为“开始”或“停止”。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2015-02-17T01:49:46.707

我的代码采用了稍微不同的方法来回收应用程序池。需要注意的几点与其他人提供的不同：

1) 我使用 using 语句来确保正确处理 ServerManager 对象。

2）我正在等待应用程序池完成启动，然后再停止它，这样我们就不会在尝试停止应用程序时遇到任何问题。同样，我正在等待应用程序池完成停止，然后再尝试启动它。

3）我强制该方法接受实际的服务器名称，而不是回退到本地服务器，因为我认为您可能应该知道您正在针对哪个服务器运行它。

4）我决定启动/停止应用程序而不是回收它，这样我可以确保我们不会意外启动因其他原因停止的应用程序池，并避免尝试回收已经停止的问题应用程序池。

```
public static void RecycleApplicationPool(string serverName, string appPoolName)
{
    if (!string.IsNullOrEmpty(serverName) && !string.IsNullOrEmpty(appPoolName))
    {
        try
        {
            using (ServerManager manager = ServerManager.OpenRemote(serverName))
            {
                ApplicationPool appPool = manager.ApplicationPools.FirstOrDefault(ap => ap.Name == appPoolName);

                //Don't bother trying to recycle if we don't have an app pool
                if (appPool != null)
                {
                    //Get the current state of the app pool
                    bool appPoolRunning = appPool.State == ObjectState.Started || appPool.State == ObjectState.Starting;
                    bool appPoolStopped = appPool.State == ObjectState.Stopped || appPool.State == ObjectState.Stopping;

                    //The app pool is running, so stop it first.
                    if (appPoolRunning)
                    {
                        //Wait for the app to finish before trying to stop
                        while (appPool.State == ObjectState.Starting) { System.Threading.Thread.Sleep(1000); }

                        //Stop the app if it isn't already stopped
                        if (appPool.State != ObjectState.Stopped)
                        {
                            appPool.Stop();
                        }
                        appPoolStopped = true;
                    }

                    //Only try restart the app pool if it was running in the first place, because there may be a reason it was not started.
                    if (appPoolStopped && appPoolRunning)
                    {
                        //Wait for the app to finish before trying to start
                        while (appPool.State == ObjectState.Stopping) { System.Threading.Thread.Sleep(1000); }

                        //Start the app
                        appPool.Start();
                    }
                }
                else
                {
                    throw new Exception(string.Format("An Application Pool does not exist with the name {0}.{1}", serverName, appPoolName));
                }
            }
        }
        catch (Exception ex)
        {
            throw new Exception(string.Format("Unable to restart the application pools for {0}.{1}", serverName, appPoolName), ex.InnerException);
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2018-11-22T12:47:13.167

以下方法经过测试可用于 IIS7 和 IIS8

第 1 步：添加对**Microsoft.Web.Administration.dll**的引用。该文件可以在路径 C:\Windows\System32\inetsrv\ 中找到，或者将其安装为 NuGet 包[https://www.nuget.org/packages/Microsoft.Web.Administration/](https://www.nuget.org/packages/Microsoft.Web.Administration/)

第 2 步：添加以下代码

```
using Microsoft.Web.Administration; 
```

**使用空条件运算符**

```
new ServerManager().ApplicationPools["Your_App_Pool_Name"]?.Recycle(); 
```

***或者***

**使用 if 条件检查 null**

```
var yourAppPool=new ServerManager().ApplicationPools["Your_App_Pool_Name"];
if(yourAppPool!=null)
    yourAppPool.Recycle(); 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-12-02T08:47:54.887

回收在 IIS6 上工作的代码：

```
 /// <summary>
    /// Get a list of available Application Pools
    /// </summary>
    /// <returns></returns>
    public static List<string> HentAppPools() {

        List<string> list = new List<string>();
        DirectoryEntry W3SVC = new DirectoryEntry("IIS://LocalHost/w3svc", "", "");

        foreach (DirectoryEntry Site in W3SVC.Children) {
            if (Site.Name == "AppPools") {
                foreach (DirectoryEntry child in Site.Children) {
                    list.Add(child.Name);
                }
            }
        }
        return list;
    }

    /// <summary>
    /// Recycle an application pool
    /// </summary>
    /// <param name="IIsApplicationPool"></param>
    public static void RecycleAppPool(string IIsApplicationPool) {
        ManagementScope scope = new ManagementScope(@"\\localhost\root\MicrosoftIISv2");
        scope.Connect();
        ManagementObject appPool = new ManagementObject(scope, new ManagementPath("IIsApplicationPool.Name='W3SVC/AppPools/" + IIsApplicationPool + "'"), null);

        appPool.InvokeMethod("Recycle", null, null);
    } 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2013-09-03T06:35:53.440

有时我觉得简单就是最好的。虽然我建议人们以某种​​巧妙的方式调整实际路径，以便在其他环境中以更广泛的方式工作 - 我的解决方案看起来像：

```
ExecuteDosCommand(@"c:\Windows\System32\inetsrv\appcmd recycle apppool " + appPool); 
```

在 C# 中，运行一个 DOS 命令就可以了。上述许多解决方案不适用于各种设置和/或需要打开 Windows 上的功能（取决于设置）。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-12-08T11:04:02.637

这段代码对我有用。只需调用它来重新加载应用程序。

```
System.Web.HttpRuntime.UnloadAppDomain() 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2019-07-17T14:12:29.663

另外一个选项：

```
System.Web.Hosting.HostingEnvironment.InitiateShutdown(); 
```

似乎比`UploadAppDomain`哪个“终止”应用程序更好，而前者等待工作完成。

# windows-services - 由使用本地系统帐户的 Windows 服务启动的可执行文件无法访问网络共享

> ID：249928
> 
> 赞同：7
> 
> 时间：2008-10-30T11:54:47.057
> 
> 标签：windows-services, credentials, network-share

我有一个由 Windows 服务启动的可执行文件，该程序将在客户计算机上运行，​​并且需要连接到远程共享以执行特定任务。此共享由客户通过 UI 指定，因此我们事先不知道这意味着它不能“硬编码”或预先映射的共享。

以前我们要求客户登录他们的机器并在登录时运行可执行文件，但我们一直希望让我们的程序在服务中运行而不需要登录，主要是为了让客户更容易并防止任何意外注销关闭我们的软件。所以这也意味着我们不知道客户机器上存在哪些本地用户帐户，因此我们必须使用本地系统帐户启动服务。

如上所述，我们现在有一个包装服务来启动可执行文件并执行各种任务。在大多数情况下，这似乎工作正常，并且可以正常访问底层网络 - 我们的软件的目的主要涉及捕获数据包等。

但是，当软件尝试连接到 Windows 共享（UNC 名称）时，它无法连接。而如果可执行文件是手动启动的，它连接得很好。

我通常看到的解决此类问题的建议似乎都说使用用户帐户，因为系统帐户无法访问网络共享，但在我们的情况下这是不可能的。我们还有其他方法可以让它工作吗？

**编辑：我忘了提到这个应用程序可以（并且最常见的是）在 Win2K 而不是 XP 上运行，我认为我说本地网络帐户在 XP 之前不可用是正确的？**

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-10-30T11:59:38.250

如果您可以更改 Windows 服务以使其在网络服务帐户下运行，那么您的可执行文件将能够访问网络共享（这是创建网络服务帐户的原因之一）。

本地系统和本地服务帐户没有任何网络凭据，因此无法在网络上进行身份验证。这是设计使然。

**编辑：** IIRC，网络服务帐户是在 Server 2003 中引入的，并添加到 XP 服务包之一。

如果您不能依赖可用的网络服务帐户，那么您可能会考虑创建一个专用域帐户，将帐户的凭据存储在某处，从您的服务内部读取它们，然后在访问网络共享之前登录并模拟该用户。或者，Windows 服务可以直接作为专用帐户运行，在这种情况下，它需要“作为服务登录”权限。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-10-30T11:57:46.007

当您有一个在 NT AUTHORITY\LOCALSYSTEM（这是服务帐户的名称）下运行的服务时，它对网络的其余部分显示为 DOMAINNAME\COMPUTERNAME$（注意 $ 符号）帐户。也就是说，它在 Active Directory 中显示为 COMPUTER 的帐户。只需将您的文件和共享权限授予 DOMAINNAME\COMPUTERNAME$ 就可以了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T12:05:38.063

为什么不能使用其他帐户？Windows 中内置了一个网络服务帐户，专门用于需要网络访问的服务。

无论如何，让服务启动 exe 时要非常小心。

If the write access to the folder with the exe is not disabled, a user can replace that exe with (for example) `cmd.exe`. The next time the service tries to start your exe, voilà: A command shell with system rights!

# php - PHP apache_request_headers() 与现实不符（由 Firebug 确认）：为什么？

> ID：249968
> 
> 赞同：5
> 
> 时间：2008-10-30T12:14:38.017
> 
> 标签：php, ajax, http-headers, firebug

我用 PHP 编写了一个使用 Ajax 请求的 Web 应用程序（使用 YUI.util.Connect.asyncRequest 制作）。

大多数情况下，这工作正常。该请求使用**XMLHttpRequest的****X-Requested-With**值发送。我的 PHP 控制器代码使用 apache_request_headers() 检查传入的请求是否是 Ajax 并且一切正常。

 **但不总是。间歇性地，我遇到了发送 Ajax 请求的情况（Firebug 向我确认请求的标头包含 XMLHttpRequest 的 X-Requested-With），但 apache_request_headers() 没有在其列表中返回该标头。

当我 var_dump apache_request_headers() 时的输出如下（注意缺少 X-

```
'Host' => string 'peterh.labs.example.com' (length=26)
'User-Agent' => string 'Mozilla/5.0 (X11; U; Linux i686; en-GB; rv:1.9.0.3) Gecko/2008101315 Ubuntu/8.10 (intrepid) Firefox/3.0.3' (length=105)
'Accept' => string 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8' (length=63)
'Accept-Language' => string 'en-gb,en;q=0.5' (length=14)
'Accept-Encoding' => string 'gzip,deflate' (length=12)
'Accept-Charset' => string 'ISO-8859-1,utf-8;q=0.7,*;q=0.7' (length=30)
'Keep-Alive' => string '300' (length=3)
'Connection' => string 'keep-alive' (length=10)
'Referer' => string 'http://peterh.labs.example.com/qmail/' (length=40)
'Cookie' => string 'WORKFLOW_SESSION=55f9aff2051746851de453c1f776ad10745354f6' (length=57)
'Pragma' => string 'no-cache' (length=8)
'Cache-Control' => string 'no-cache' (length=8) 
```

但萤火虫告诉我：

```
Request Headers:
Host             peterh.labs.example.com
User-Agent       Mozilla/5.0 (X11; U; Linux i686; en-GB; rv:1.9.0.3) Gecko/2008101315 Ubuntu/8.10 (intrepid) Firefox/3.0.3
Accept           text/html,application/xhtml+xml,application/xml;q=0.9,**;q=0.8
Accept-Language  en-gb,en;q=0.5
Accept-Encoding  gzip,deflate
Accept-Charset   ISO-8859-1,utf-8;q=0.7,*;q=0.7
Keep-Alive       300
Connection       keep-alive
X-Requested-With XMLHttpRequest
Referer          http://peterh.labs.example.com/qmail/
Cookie           WORKFLOW_SESSION=55f9aff2051746851de453c1f776ad10745354f6 
```

在执行相同的代码时，这种不匹配（显然）是间歇性的。但在软件方面，我不相信“间歇性”！帮助！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-30T13:57:22.410

我不确定为什么 apache_request_headers() 和 firebug 不匹配，但是为了读取请求标头，您可以使用 $_SERVER 超级全局

客户端发送的每个标头（无论客户端如何）都将到达 $ *SERVER 数组。该标头的键将带有 HTTP*前缀，所有字母大写和破折号都转换为下划线 (_)

在您的情况下，您可以在以下方面找到您的必要价值：

$_SERVER['HTTP_X_REQUESTED_WITH'] = 'XMLHttpRequest'

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-24T17:19:51.197

对于那些遇到这个问题的人的未来参考，“间歇性”可能是由于重定向发生在服务器端。如果发生 302 重定向，则不会传递 X-Requested-With 标头，即使它是在原始请求中发送的。这可能是问题的最初原因。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T13:54:28.343

仔细检查缺少的标头是否不在 superglobal 中`$_SERVER`。一般来说，如果我真的需要，我不会依赖 apache_*。

附带说明一下，X-Requested-With 标准了吗？我已经阅读了有关添加它的各种库，但我不知道它已成为标准。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-10-30T14:11:10.730

我无法具体回答这种情况，但总的来说，我建议使用（查询）参数来表示 xmlhttp 请求，而不是标头。您永远不知道有什么有趣的安全或代理服务器会自行处理 HTTP 标头，或缓存应该是纯浏览器 HTML 响应的 AJAX 响应（反之亦然）。

# tdd - 为什么 TDD 的“尖峰”被称为“尖峰”？

> ID：249969
> 
> 赞同：48
> 
> 时间：2008-10-30T12:14:47.343
> 
> 标签：tdd, extreme-programming

测试驱动开发人员指的是一种*快速的、探索性的调查，其中涉及对某些东西进行编码以查看它是否有效*，这是一个**尖峰**。

任何想法为什么他们想出了这个词？

**更新：** Kent Beck 的造币在我看来就像是“原版”，尽管在我看来他对这个词的使用没有多大意义。编写一个快速测试是“在项目中增加一个峰值”？

有趣的是，他似乎停止使用这个词，因为它给不同的人带来了不同的含义——见下文以获得证据！

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2008-10-30T13:11:20.210

Ward Cunningham 在[WardsWiki](http://c2.com/cgi/wiki?SpikeSolution)上写道（指 Kent Beck）：

> 我经常问肯特，“我们可以编写的最简单的事情是什么，可以让我们相信我们走在正确的轨道上？” 这种克服手头困难的做法通常会导致我们找到更简单、更有说服力的解决方案。肯特将其称为斯派克。我发现这种做法在维护大型框架时特别有用。

Kent Beck writes in [Guide to Better Smalltalk](http://books.google.dk/books?id=Y7FwNB4GV4EC):

> Sometimes I call this a "spike," because we are driving a spike through the entire design. [...] Because people variously associate "spike" with volleyball, railroads, or dogs, I have begun using "architectural prototype" to describe this implementation.

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-30T12:40:35.593

恕我直言，钉子一词与钉子穿过木板有关。是的..在这里

> “Spike”是一个极限编程术语，意思是“实验”。我们使用这个词是因为我们认为尖峰有一个快速的、几乎是蛮力的实验，目的是只学习一件事。想想用一根大钉子穿过木板。
> -- C# 中的极限编程冒险 - Ron Jeffries

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-10-30T12:24:57.183

我一直认为这是一个登山者的比喻。在你上山的路上，你在山上放了一个钉子。如果钉子粘住了，那么就可以走那条路。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-10-30T12:16:26.000

因为它与众不同，就像图表中的尖峰一样。例如 CPU 使用率飙升。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-30T12:33:35.433

[行话文件](http://www.elsewhere.org/jargon/jargon.html#spike)有以下条目：

**尖峰**v.

1.  通过引入强制特定结果的（有时是临时的）设备来击败选择机制。这个词用于多个行业；电话工程师指的是通过插入一个销钉将继电器保持在关闭或打开状态，铁路工程师指的是钉住一个轨道开关，使其无法移动。在编程环境中，它通常指的是临时更改，通常用于测试目的（与永久更改相反，它被称为硬连线）。

2.  [边界技术语言] 在其他相当恒定的图表中出现可见峰值（例如，线路电压的突然浪涌，电路中逻辑线路上的意外短“高”）。黑客经常使用它来突然增加一些数量，例如系统负载或网络流量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-10-30T12:28:36.660

我相信这是一种工程表达。尖峰是一种临时解决方案，在您制定永久解决方案之前，您会尝试看看它是否有效。铁路工程师谈论*道岔*道钉：将道钉插入道岔，使其无法移动。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-09-01T16:29:26.203

It is called **Spiking** because it slices through all layers of the system. That's what he means when he says **Architectural Prototype**.

# c# - WPF：如何将 GeneralTransform 应用于几何数据并返回新几何？

> ID：249971
> 
> 赞同：14
> 
> 时间：2008-10-30T12:15:46.093
> 
> 标签：c#, .net, wpf, geometry, transform

有一些几何数据和变换如何将变换应用于几何以得到一个新的几何与它的数据转换？

例如：我有一个 Path 对象，它的 Path.Data 设置为 PathGeometry 对象，我想使用变换来变换PathGeometry 对象**的****点**，而不是对将在渲染时使用的 PathGeometry 应用变换.

 **PS我知道Transform类有一个`Point Transform.Transform(Point p)`可以用来变换Point的方法但是......有没有办法一次变换任意几何？

编辑：查看我的回复以获取当前找到的[解决方案](https://stackoverflow.com/questions/249971/wpf-how-to-apply-a-generaltransform-to-a-geometry-data-and-return-the-new-geome#250913)

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-10-30T16:54:02.867

[感谢Todd White](https://stackoverflow.com/questions/249971/wpf-how-to-apply-a-generaltransform-to-a-geometry-data-and-return-the-new-geome#250587)的回答，我找到了一个可以将任意变换应用于路径几何的解决方案：

基本上 Geometry.Combine 用于使用 Union 将所需的几何图形与 Geometry.Empty 组合，并给出所需的变换。生成的几何图形使用给定的变换进行变换。

```
PathGeometry geometryTransformed = Geometry.Combine(Geometry.Empty, geometry, GeometryCombineMode.Union, transform); 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-10-30T15:25:21.187

您可以尝试使用 Geometry.Combine。它在合并期间应用变换。一个问题是，Combine 仅在您的 Geometry 具有区域时才有效，因此单行将不起作用。

这是一个对我有用的示例。

```
PathGeometry geometry = new PathGeometry();
geometry.Figures.Add(new PathFigure(new Point(10, 10), new PathSegment[] { new LineSegment(new Point(10, 20), true), new LineSegment(new Point(20, 20), true) }, true));
ScaleTransform transform = new ScaleTransform(2, 2);
PathGeometry geometryTransformed = Geometry.Combine(geometry, geometry, GeometryCombineMode.Intersect, transform); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-12-19T19:48:47.013

这就是我发现你可以做的就是得到一个完整的所有图形信息的转换几何：

```
var geometry = new PathGeometry();
geometry.Figures.Add(new PathFigure(new Point(10, 10), new PathSegment[] { new LineSegment(new Point(10, 20), true), new LineSegment(new Point(20, 20), true) }, true));
geometry.Transform = new ScaleTransform(2, 2);

var transformedGeometry = new PathGeometry ();
// this copies the transformed figures one by one into the new geometry
transformedGeometry.AddGeometry (geometry); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-09-22T12:52:07.367

我没有使用接受的答案，因为它返回的几何格式与原始格式不同，所以我使用了这个：

```
Geometry inputGeometry = new PathGeometry();
var inputGeometryClone = inputGeometry.Clone(); // we need a clone since in order to
                                                // apply a Transform and geometry might be readonly
inputGeometryClone.Transform = new TranslateTransform(); // applying some transform to it
var result = inputGeometryClone.GetFlattenedPathGeometry(); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2014-12-16T15:19:38.507

基于 Geometry.Combine 的快速解决方案均不适用于由单个 LineElement 构成的路径。所以我用艰难的方式解决了这个问题，就像这样（但我也仅限于 PathGeometry）：

```
public static class GeometryHelper
{
public static PointCollection TransformPoints(PointCollection pc, Transform t)
{
  PointCollection tp = new PointCollection(pc.Count);
  foreach (Point p in pc)
    tp.Add(t.Transform(p));
  return tp;
}
public static PathGeometry TransformedGeometry(PathGeometry g, Transform t)
{
  Matrix m = t.Value;
  double scaleX = Math.Sqrt(m.M11 * m.M11 + m.M21 * m.M21);
  double scaleY = (m.M11 * m.M22 - m.M12 * m.M21) / scaleX;
  PathGeometry ng = g.Clone();
  foreach (PathFigure f in ng.Figures)
  {
    f.StartPoint = t.Transform(f.StartPoint);
    foreach (PathSegment s in f.Segments)
    {
      if (s is LineSegment)
        (s as LineSegment).Point = t.Transform((s as LineSegment).Point);
      else if (s is PolyLineSegment)
        (s as PolyLineSegment).Points = TransformPoints((s as PolyLineSegment).Points, t);
      else if (s is BezierSegment)
      {
        (s as BezierSegment).Point1 = t.Transform((s as BezierSegment).Point1);
        (s as BezierSegment).Point2 = t.Transform((s as BezierSegment).Point2);
        (s as BezierSegment).Point3 = t.Transform((s as BezierSegment).Point3);
      }
      else if (s is PolyBezierSegment)
        (s as PolyBezierSegment).Points = TransformPoints((s as PolyBezierSegment).Points, t);
      else if (s is QuadraticBezierSegment)
      {
        (s as QuadraticBezierSegment).Point1 = t.Transform((s as QuadraticBezierSegment).Point1);
        (s as QuadraticBezierSegment).Point2 = t.Transform((s as QuadraticBezierSegment).Point2);
      }
      else if (s is PolyQuadraticBezierSegment)
        (s as PolyQuadraticBezierSegment).Points = TransformPoints((s as PolyQuadraticBezierSegment).Points, t);
      else if (s is ArcSegment)
      {
        ArcSegment a = s as ArcSegment;
        a.Point = t.Transform(a.Point);
        a.Size = new Size(a.Size.Width * scaleX, a.Size.Height * scaleY); // NEVER TRIED
      }
    }
  }
  return ng;
}
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-30T13:59:17.117

不幸的是，我认为没有方法或属性可以满足您的要求。至少，我一个也找不到。（好问题！）

似乎您必须手动执行此操作（正如您自己建议的那样）......即为 PathGeometry 中的每个点调用**Point Transform.Transform(Point p)** ......在此过程中创建一个新的 PathGeometry 。

可能不是你想要的答案。*（悔恨的笑容）*

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-01T15:05:57.027

我遇到了同样的问题并且也需要线条（不仅是具有面积的几何图形）。

我只使用 PathGeometry，所以这可能不是您正在寻找的通用解决方案，但这对我有用：

```
pathgeometry.Transform = transform;
PathGeometry transformed =  PathGeometry.CreateFromGeometry(pathgeometry); 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-10-30T12:38:59.510

您必须考虑两件事：

1.  几何体继承自 Freezable，如果几何体对象被冻结，则无法就地修改它。
2.  您可以扫描图形和线段的 PathGeometry 列表并转换其中的所有点，但某些类型，如 ArcSegment 包括大小和角度，您无法转换它们。

# c - 在 C 中与 getopt 一起使用时，const char * 和 strdup 是否提供相同的功能？

> ID：249979
> 
> 赞同：2
> 
> 时间：2008-10-30T12:19:18.647
> 
> 标签：c, constants, strdup

在下面的代码片段中，我可以将 char * 替换为 const char * 并删除 strdup() 函数调用并直接获取 getopt() 设置的 optarg 值吗？建议我使用 const char * 来跳过 strdup 函数的使用。提前感谢帮助。

```
/* Code Snippet */
char *dir = NULL; 
char *bld = NULL;
int chr;

while ( ( chr = getopt( argc, argv, "d:a:b:f:" ) ) != -1 ) {

 switch ( chr ) {

  case 'd': //Directory parameter
   dir = strdup( optarg );
   if (dir == NULL) { /*Error*/ }

  case 'b': //Build parameter
   bld = strdup( optarg );
   if (bld == NULL) { /*Error*/ }
  ...other code...
 }
} 
```

我真的不明白这样做的必要性。

编辑：感谢您的回答。这真的很有帮助。我将代码修改为 const char * 并跳过了 strdup 调用。

谢谢，丽菊

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-10-30T12:27:43.807

我从（[http://linux.die.net/man/3/optarg](http://linux.die.net/man/3/optarg)）的理解是 optarg 指向 argv 缓冲区的内容，因此不需要 strdup 。使用 const char* 的建议似乎是一个合理的想法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T23:07:48.320

由于 optarg 被声明为 ' `extern char *optarg;`'，因此您不必使用 ' `const char *`'，但最好不要修改程序的参数。我建议，这将更多地取决于你用你的`dir`和`bld`变量调用的函数是否是常量正确的。如果它们是你的代码，你可以这样做；如果没有，您可能会发现保持变量非 const 更简单。您对 ' `strdup()`' 的调用（这是 POSIX 中的标准，但在 C 中不是 - 如在 ISO/IEC 9899:1999 中）是不必要的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-10-30T23:18:05.227

两者都是很好的建议。您可能不想更改 dir 和 bld，因此将它们声明为 const char * 而不是 char * 在任何情况下都是有用的，因为编译器会检测到更多的编码错误。通过摆脱 strdup，您只是避免了不必要的副本（取决于您之后对 dir 所做的事情），但它会为您的 optarg 创建一个别名。

# c++ - 从 Windows 中的 C++ 应用程序进行 Thrift 调用

> ID：249985
> 
> 赞同：7
> 
> 时间：2008-10-30T12:22:08.140
> 
> 标签：c++, windows, thrift

正如标题所说，我有一个用 C++ 编写的 Windows 应用程序，我需要从中调用远程 Thrift 服务，老实说，我对这个主题有点迷茫。[http://wiki.apache.org/thrift/ThriftInstallationWin32](http://wiki.apache.org/thrift/ThriftInstallationWin32)声明“Thrift C++ 运行时库目前不能在 Windows 上运行”。这是否意味着我运气不好，还是有解决方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-09-17T22:38:06.367

我为自己的应用程序将 Thrift 移植到 Windows/C++。它是开源的，因此其他人可以免费使用它： http: [//peoplesnote.codeplex.com/SourceControl/list/changesets](http://peoplesnote.codeplex.com/SourceControl/list/changesets)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-06T09:30:00.567

它可能不是一个优雅的解决方案，但至少它应该可以工作：

根据 Thrift Wiki，有 C# 绑定，但它们确实应该称为 .NET 绑定：它们没有特定于 C# 的内容。因此，您可以在 C++/CLI dll 库中实现您的通信库，并从非托管代码中引用该 .dll。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-06T10:23:24.903

该页面看起来相当简单。他们告诉你如何制作 Thrift 编译器，但毫不含糊地声明，它的元代码不会在 Windows 下编译。

因此，如果没有让某人弄清楚如何在 Windows 下编译它，那么您就不**走运**了。

老实说，我看不出这有什么大不了的，特别是因为 Cygwin 很好地提供了在 Windows 下编译 UNIX 源代码所需的一切。我只能建议他们必须使用一些相当深奥的 UNIX 功能。

可以从这里采取多种方法：

1/ 既然已经进入Apache Incubator，可能有支持Windows的计划（虽然我没找到）。如果它是真正的开源并且确定了需求，那么很可能有人会开始将运行时移植到 Windows。您可能无法等待。

2/ 为什么世界需要**另一种**RPC 机制，这超出了我的理解。但是您可以使用一种已经存在的 RPC 机制（SUN/ONC）或您自己的 RPC 协议从您的 Windows 机器通信到 UNIX 机器，然后通过 Thrift 转发 RPC。但这是一个杂牌，我不会出于原则而这样做。

除此之外，我没有太多建议，对不起。祝你好运。

# bugzilla - 如何在 Bugzilla 中播种错误编号？

> ID：249987
> 
> 赞同：2
> 
> 时间：2008-10-30T12:23:52.223
> 
> 标签：bugzilla

对于新的 Bugzilla 安装，我们希望将错误编号从 1 开始。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-30T13:13:46.587

根据响应，以下 MySQL 命令将执行此操作：

```
ALTER TABLE bugs AUTO_INCREMENT = 100; 
```

其中 100 是新的种子编号。

这是 Bugzilla[架构](http://www.faqs.org/docs/bugzilla/dbschema.html)的链接。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-30T12:27:20.283

我不确定 Bugzilla 的后端，但如果它使用 SQL 数据库，您应该能够找到控制错误 ID 号的表并将自动增量值设置为其他值。也就是说，如果 Bugzilla 使用自动增量。

但我没有提供更多信息的 Bugzilla 副本。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-10-30T12:55:45.937

我相信这是“错误”表中的自动增量值。

为了强制它以预定义的值开始，

在 MYSQL 中，您需要...

*   关闭此字段的自动增量。
*   插入一条带有设置为您的起点的 bug_id 的记录。
*   重新打开自动增量。

# javascript - 我可以通过 Javascript 获取非标准 CSS 属性的值吗？

> ID：249991
> 
> 赞同：14
> 
> 时间：2008-10-30T12:24:26.840
> 
> 标签：javascript, css

我正在尝试读取自定义（非标准）CSS 属性，设置在样式表（不是内联样式属性）中并获取其值。以这个 CSS 为例：

```
#someElement {
  foo: 'bar';
} 
```

我已经设法通过 IE7 中的 currentStyle 属性获得了它的值：

```
var element = document.getElementById('someElement');
var val = element.currentStyle.foo; 
```

但是 currentStyle 是特定于 MS 的。所以我在 Firefox 3 和 Safari 3 中尝试了 getComputedStyle() ：

```
var val = getComputedStyle(element,null).foo; 
```

...它返回未定义。**有谁知道检索自定义 CSS 属性值的跨浏览器方式？**

*（您可能已经注意到，这不是有效的 CSS。但只要值遵循正确的语法，它就可以工作。更好的属性名称是“-myNameSpace-foo”或其他名称。）*

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2012-07-22T11:35:43.113

现代浏览器只会丢弃任何无效的 CSS。但是，您可以使用 content 属性，因为它仅对 等有效 `:after`。`:before`您可以将 JSON 存储在其中：

```
#someElement {
    content: '{"foo": "bar"}';
} 
```

然后使用这样的代码来检索它：

```
var CSSMetaData = function() {

    function trimQuotes( str ) {
         return str.replace( /^['"]/, "" ).replace( /["']$/, "" );   
    }

    function fixFirefoxEscape( str ) {
        return str.replace( /\\"/g, '"' );
    }

    var forEach = [].forEach,
        div = document.createElement("div"),
        matchesSelector = div.webkitMatchesSelector ||
                          div.mozMatchesSelector ||
                          div.msMatchesSelector ||
                          div.oMatchesSelector ||
                          div.matchesSelector,
        data = {};

    forEach.call( document.styleSheets, function( styleSheet ) {
        forEach.call( styleSheet.cssRules, function( rule ) {
            var content = rule.style.getPropertyValue( "content" ),
                obj;

            if( content ) {
                content = trimQuotes(content);
                try {
                   obj = JSON.parse( content );
                }
                catch(e) {
                    try {

                        obj = JSON.parse( fixFirefoxEscape( content ) );
                    }
                    catch(e2) {
                        return ;
                    }

                }
                data[rule.selectorText] = obj;
            }
        });

    });

    return {

        getDataByElement: function( elem ) {
            var storedData;
            for( var selector in data ) {
                if( matchesSelector.call( elem, selector ) ) {
                    storedData = data[selector];
                    if( storedData ) return storedData;

                }
            }

            return null;
        }
    };

}();
var obj = CSSMetaData.getDataByElement( document.getElementById("someElement"));
console.log( obj.foo ); //bar 
```

请注意，这仅适用于现代浏览器。演示：http: [//jsfiddle.net/xFjZp/3/](http://jsfiddle.net/xFjZp/3/)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-10-30T13:17:07.093

Firefox 不会将它不理解的标签、属性或 CSS 样式从代码转移到 DOM。这是设计使然。Javascript 只能访问 DOM，不能访问代码。所以不，没有办法从浏览器本身不支持的javascript访问属性。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-11-05T15:51:27.197

通过阅读 IE 中的样式表信息，您可以获得这些“虚假”属性，但仅限于我知道的 IE 中。

```
var firstSS = document.styleSheets[0];
var firstSSRule = firstSS.rules[0];
if(typeof(firstSSRule.style.bar) != 'undefined'){
  alert('value of [foo] is: ' + firstSSRule.style.bar);
} else {
  alert('does not have [foo] property');
} 
```

它的代码丑陋，但你明白了。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-13T10:24:47.627

我也有一些在 MSIE 中运行良好的页面，但在样式和样式表中有很多信息。所以我正在考虑解决方法。幸运的是，Firefox 确实允许的一件事是将内联属性放入 DOM。所以这里有一个部分策略：

1.  将 html 文档中的每个内联样式替换为相应的“nStyle”，例如 <span class="cls1" nStyle="color:red; nref:#myid; foo:bar"> ... </span>

2.  页面加载后，对每个元素节点执行以下操作： (a) 将 nStyle 属性的值复制到标签的 cssText 中，同时 (b) 将非标准属性转换为更简单的格式，例如, node.getAttribute('nStyle') 变成对象 {"nref":"#myid", "foo":"bar"}。

3.  编写一个获取样式或 nStyle 的“calculatedStyle”函数，具体取决于可用的内容。

为样式表编写一个粗略的解析器可能会为它们启用类似的策略，但我有一个问题：我如何克服阅读样式表的障碍而不受 Firefox 的审查？

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-01T10:52:18.363

一种方法当然是用 Javascript 编写自己的 CSS 解析器。但我相信这*真的*太过分了。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-07-25T16:59:56.130

也许你可以试试[LESS](http://lesscss.org/)。它是动态样式表语言，您可以创建非标准的 css 属性，以及稍后将编译的命令。

# c# - Windbg help -> 如何在这个调用栈中读取代码？

> ID：249994
> 
> 赞同：8
> 
> 时间：2008-10-30T12:26:06.387
> 
> 标签：c#, debugging, windbg

我有一个我制作的 Windows 服务的转储。例外是我的代码无法移动文件（出于某种原因）。现在，在我的代码中有很多地方可以在文件系统中移动文件。因此，使用 Windbg，我试图查看发生异常的代码。

这是我的 !clrstack 转储..

```
0:016> !clrstack -p
OS Thread Id: 0xdf8 (16)
Child-SP         RetAddr          Call Site
0000000019edea70 0000064278a15e4f System.IO.__Error.WinIOError(Int32, System.String)
PARAMETERS:
    errorCode = <no data>
    maybeFullPath = <no data>

0000000019edead0 0000064280181ce5 System.IO.File.Move(System.String, System.String)
PARAMETERS:
    sourceFileName = <no data>
    destFileName = <no data>

0000000019edeb50 0000064280196532 MyClass.Foo.DoSomeStuffInHere(System.String)
PARAMETERS:
    this = 0x0000000000c30aa8
    filePathAndName = 0x0000000000d1aad0 
```

现在，这有很大帮助...

```
0:016> !do 0x0000000000d1aad0
Name: System.String
MethodTable: 00000642784365e8
EEClass: 000006427803e4f0
Size: 88(0x58) bytes
(C:\WINDOWS\assembly\GAC_64\mscorlib\2.0.0.0__b77a5c561934e089\mscorlib.dll)
String: C:\BlahBlahFolder\FooFolder\4469.jpg
Fields:
-snipped- 
```

所以我找出了无法移动的文件。科尔。但我只想查看调用 File.Move(..) 的 MyClass.Foo.DoSomeStuffInHere(System.String) 方法中的代码。该方法有很多 File.Move .. 所以我可以放 try / catches / debug / trace 信息.. 但我希望通过使用 Windbg 来帮助找到这个问题来提高效率。

有什么想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-31T01:28:59.347

除非应用程序以调试模式部署，否则您无法获得确切的代码行。如果是这样的话，我相信它会在 !clrstack 调用中显示它们。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-21T23:14:41.117

这是一个难题，可能需要跳出仅托管调试的舒适区。

您要做的是将函数**MyClass.Foo.DoSomeStuffInHere**的 IL 映射到该函数的反汇编。我下面的示例是 x86，但是 x64 可以遵循相同的步骤。

这在以下链接的深处被引用。 [调试意外的进程终止](http://msdn.microsoft.com/en-us/library/ms954593.aspx)

白皮书中的示例文本：在托管堆栈中，**Debugging.Unexpected.btnSTA_Click** ... 查看 Debugging.Unexpected.btnSTA_Click 事件中的代码。

```
private void btnSTA_Click(object sender, System.EventArgs e)
{
   DebuggingCOMLib.STAClass staobj =  new DebuggingCOMLib.STAClass();
   staobj.RaiseError(1,5);
   Label1.Text += "STA Call Completed sucessfully";
} 
```

如果源代码不可用，您可以通过将调用堆栈帧的指令指针提供给**!u 命令**来检查程序集。可以从 !clrstack: 输出中检索指令指针。

```
0096f970  03a00e06 [DEFAULT] [hasThis] Void
Debugging.Unexpected.btnSTA_Click(Object,Class System.EventArgs) 
```

要反汇编此函数，请键入**!u 03a00e06**。

```
 0:010> !u 03a00e06 
    Normal JIT generated code
    [DEFAULT] [hasThis] Void Debugging.Unexpected.btnSTA_Click(Object,Class 
    System.EventArgs)
    Begin 03a00de0, size 54
   <snip>
    03a00e18 8b15a89c1702     mov     edx,[02179ca8] ("STA Call Completed 
    sucessfully")
    03a00e1e e83d3590ff       call    03304360 (System.String.Concat)
    <snip>
    03a00e2f 5e               pop     esi
    03a00e30 5f               pop     edi
    03a00e31 c20400           ret     0x4 
```

**好的，现在呢？**
扫描您自己的 !u 输出以查找类似的行

```
call    03304360 (System.IO.File.Move) 
```

此外，您可以运行 !ip2md **03a00e06**来获取 MethodDesc，然后运行**​​!dumpil**来检查 IL 代码，如果这样更容易的话。

您可以在**!u 输出中计算对****System.IO.File.Move**的调用次数，然后在 IL 中倒数相同的数字。然后您可以使用 .NET Reflector 反汇编该方法并将 C# 映射到 IL 并比较结果。

 **很多步骤，但它会让你得到相同的结果:-)

谢谢，亚伦*********************