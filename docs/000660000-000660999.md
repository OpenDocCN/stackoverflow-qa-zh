# StackOverflow 问答 000660000-000660999

# c# - C# - 如何在其末尾剪切字符串以适合 div？

> ID：660000
> 
> 赞同：3
> 
> 时间：2009-03-18T20:38:20.447
> 
> 标签：c#, .net, asp.net, c#-3.0

我正在列出最近的新闻。因此，它将显示如下内容：

```
- Take a look at the new Volks...
- John Doe is looking for a jo...
- Microsoft is launching the n... 
```

所以，上面的列表只显示了新闻的标题，每条新闻的长度限制为 25 个字符。但是，这不是很好......例如，如果你输入 25 M，它会爆炸我的 div。

有人告诉我，有一种方法可以计算字符串的长度并使其自动适合 div。

有谁知道该怎么做？

谢谢！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T20:48:33.340

“文本溢出：省略号”是你想要的，但不是每个人都支持它。 [更多信息在这里...](http://www.blakems.com/archives/000077.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T20:41:27.663

我认为您想为此使用css。

```
word-wrap:break-word; 
```

应该这样做

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T20:41:33.700

防止“爆炸 div”的一种非常简单的方法是使用 css 样式将`overflow`div 设置为滚动或隐藏额外的文本，而不是拉伸以适应它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T20:47:01.860

我想你说的是使用`System.Drawing.Gaphics`类的`MeasureString()`方法。

但是，这需要创建一个与网页字体特征相匹配的 Graphics 对象。 *但是*，您的服务器进程不应该知道任何关于网页样式元素的信息，这应该由 CSS 表处理。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T20:44:15.550

我认为没有一种适用于所有浏览器和字体的简单方法。最好的方法是确保您的布局在有人进入 25*m 时不会中断。

一个有用的做法是拆分超过 X 字母的单词。我的 word-wrap css 在所有浏览器上都不能很好地工作。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T06:30:34.890

这并不是真正的服务器端问题，因为服务器不应该知道人们正在使用什么字体。您可以使用 Ajax 来完成 - 将字体发布到服务器，计算宽度（如 James Curran 所述），然后返回正确的字符串。但是，服务器可能没有安装相同的字体，您必须在服务器端计算填充和边距。

我可以在客户端想到几个选项：

1.  用跨度包裹每一行。跨度会自动扩展到线的宽度。使用 jQuery 或您最喜欢的 javascript，您可以删除字符，直到宽度正常。（您可以进行一种二分搜索，在每个阶段添加省略号并检查宽度）
2.  简单 - 用固定宽度的 div 包裹每一行并设置它`overflow:hidden`，并在 div 之后添加省略号。不过，这会切断字母，当您收到短文本时，它仍会显示省略号。
3.  太容易了——使用固定宽度的字体（它们大多很丑）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-17T14:12:04.007

正如其他人所提到的，您可以使用 来测量胖客户端应用程序中的字符串`System.Drawing.Graphics.MeasureString`，但是由于您提到要将其放入 HTML div 标签中，因此最好让浏览器使用 CSS 处理用户界面。

```
<html>
<head>
    <title>C# - How can I cut a string at its end to fit in a div? </title>
    <style type="text/css">
        .ellipsis li
        {
           display: block; 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 166px;
        }
    </style>
</head>
<body>
    <ul class="ellipsis">
        <li>Take a look at the new Volksxxxxx</li>
        <li>John Doe is looking for a joxxxxx</li>
        <li>Microsoft is launching the nxxxxx</li>
    </ul>
</body>
</html> 
```

我使用了无序列表标签 (UL) 而不是 div，因为您的示例列表以项目符号字符开头。类似的 CSS 将适用于 DIV 标签。尽管所有浏览器都可以剪辑内容，但并非所有浏览器都支持非标准文本溢出：省略号样式。

# sql-server-2008 - 我可以免费获得 sql server 2008 Enterprise 试用版吗？

> ID：660005
> 
> 赞同：1
> 
> 时间：2009-03-18T20:40:15.373
> 
> 标签：sql-server-2008

我可以免费获得 sql server 2008 Enterprise 试用版吗？

具体来说，我想获得探查器（我希望探查器成为我的 MS，而不是那个开源版本）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T21:12:57.400

你当然可以。SQL Server 2008 Enterprise 的 180 天试用版在[这里](http://www.microsoft.com/sqlserver/2008/en/us/trial-software.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T20:44:12.210

您可能不需要 Enterprise；[开发人员](http://www.microsoft.com/sqlserver/2008/en/us/Developer.aspx)应该没问题：

> SQL Server 2008 Developer 包含企业版的所有功能，但仅授权用于开发、测试和演示使用。

它不是免费的，但[49 美元](http://store.microsoft.com/microsoft/SQL-Server-2008-Developer-Edition/product/C5EA00C9?WT.mc_id=productinfocenter)并不是很多。

# winapi - midiOutPrepareHeader 是一个快速调用吗？

> ID：660008
> 
> 赞同：0
> 
> 时间：2009-03-18T20:40:30.053
> 
> 标签：winapi, midi

midiOutPrepareHeader、midiInPrepareHeader 只是设置一些数据字段，还是做一些更耗时的事情？

我正在尝试决定是根据需要构建和销毁 MIDIHDR，还是维护它们的池。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T20:54:57.990

你真的只有两种方法可以告诉（没有 Windows 源代码）：

1）对其进行概要分析。根据您对所需时间的调查结果，设置一个仅调试范围的计时器，当它突然花费的时间超过您认为您的应用程序可以接受的时间时进行记录，或者执行您的池解决方案。虽然文档说一旦你调用准备函数就不要修改缓冲区，而且如果你想重新使用它，你可能必须修改它。如果您提出的解决方案可行，我对文档还不够熟悉，无法说出一种或另一种方式。

2) 逐步检查组件并查看。不要害怕。获取 MSFT[公共符号](http://msdn.microsoft.com/en-us/library/b8ttk8zy.aspx)，看看它是否看起来只是在填写字段，或者它是否正在做一些复杂的事情。

# vb.net - 分配二进制常量

> ID：660014
> 
> 赞同：7
> 
> 时间：2009-03-18T20:42:02.310
> 
> 标签：vb.net, binary, constants

有没有办法将二进制值分配给 VB 变量？所有显而易见的选择都不起作用。我试过前缀 with `&B`，附加 with`b`但似乎没有任何效果。我也没有太多的运气来寻找它。我的应用程序*不需要*这个，但我只是好奇，所以不需要替代解决方案。

[编辑]为了澄清，我一直在寻找（这似乎不可能）是如何将文字二进制数分配给变量，以类似的方式分配十六进制或八进制数。我只是在寻找一种更具视觉吸引力的方式来为标志枚举分配值。

代码：

```
Dim num as Integer = &H100ABC       'Hex'
Dim num2 as Integer = &O123765      'Octal'

Dim myFantasy as Integer = &B1000   'What I would like to be able to do'
Dim myReality as Integer = 2 ^ 3    'What I ended up doing' 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-18T20:49:09.843

在这个之后我可能会刺伤自己：

```
Convert.ToInt32("1100101", 2); 
```

更严肃的一点（注意到您已经更新了问题），对于 flag`enums`您可能想要的是[左移运算符 ( `<<`)](http://msdn.microsoft.com/en-us/library/7haw1dex.aspx)：

```
Dim myReality as Integer          = 1 << 0   // 1
Dim myAlternateReality as Integer = 1 << 1   // 2
Dim myParallelUniverse as Integer = 1 << 2   // 4
... 
```

依此类推，直到 31。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T20:46:58.163

不幸的是，你能做的最好的就是十六进制：

```
Dim x As Long = &H1234ABCD 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T21:35:13.383

我假设您的意思是 John Rasch 提供的答案。您有一个由零和一个组成的字符串，您希望将其转换为某种变量。

```
 Dim b As String = "10101"
    Dim i As Integer = 73
    Dim s As String
    s = Convert.ToString(i, 2) 's contains the binary representation of 73 - 1001001
    i = Convert.ToInt32(b, 2) 'i now =  21 
```

您也可以将这些方法用于 hex(16) 和 octal(8)。

你也可以做这样的事情

```
 Dim i As Integer = 6
    If (i And _bi.t0) = _bi.t0 OrElse (i And _bi.t1) = _bi.t1 Then
      'bit 0 or 1 on
    End If

Enum _bi As Integer
    t0 = CInt(2 ^ 0)
    t1 = CInt(2 ^ 1)
    t2 = CInt(2 ^ 2)
    t3 = CInt(2 ^ 3)
    t4 = CInt(2 ^ 4)
    t5 = CInt(2 ^ 5)
    t6 = CInt(2 ^ 6)
    t7 = CInt(2 ^ 7)
    t8 = CInt(2 ^ 8)
    t9 = CInt(2 ^ 9)
    t10 = CInt(2 ^ 10)
    t11 = CInt(2 ^ 11)
    t12 = CInt(2 ^ 12)
    t13 = CInt(2 ^ 13)
    t14 = CInt(2 ^ 14)
    t15 = CInt(2 ^ 15)
    t16 = CInt(2 ^ 16)
    t17 = CInt(2 ^ 17)
    t18 = CInt(2 ^ 18)
    t19 = CInt(2 ^ 19)
    t20 = CInt(2 ^ 20)
    t21 = CInt(2 ^ 21)
    t22 = CInt(2 ^ 22)
    t23 = CInt(2 ^ 23)
    t24 = CInt(2 ^ 24)
    t25 = CInt(2 ^ 25)
    t26 = CInt(2 ^ 26)
    t27 = CInt(2 ^ 27)
    t28 = CInt(2 ^ 28)
    t29 = CInt(2 ^ 29)
    t30 = CInt(2 ^ 30)
End Enum 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-20T13:58:13.207

或描述性的东西

```
Enum _SerialPortPins As Integer
    RTS = CInt(2 ^ 4)
    CTS = CInt(2 ^ 5)
    DSR = CInt(2 ^ 6)
    DCD = CInt(2 ^ 8)
    DTR = CInt(2 ^ 20)
    RI = CInt(2 ^ 22)
End Enum 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-20T16:26:14.553

使用评论？

```
Dim myFantasy as Integer = 2^3 '00000000-00001000 
```

# c# - 如果当前副本正在使用中，则打开文件的卷影副本

> ID：660019
> 
> 赞同：7
> 
> 时间：2009-03-18T20:43:39.170
> 
> 标签：c#, .net-3.5, shadow-copy

我正在尝试在服务器上备份文件，但其中一些文件正在使用中，无法打开。相反，如果当前副本正在使用中，我想打开他们的卷影副本。我怎样才能做到这一点？

作为参考，我使用的是 C# .net 3.5。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2010-09-07T13:55:01.417

这个问题已经很老了，所以我的回答可能对你没有多大用处，但是作为一个问答网站，也许它仍然可以帮助其他人。

我不能/不想放下整个实现，但过程是这样的：

1.  您通过卷影服务提供商为要读取的文件所在的驱动器创建卷影副本（这在 MSDN 上有很好的记录，还有一个示例客户端可以创建这些卷影副本，很可能对您来说已经足够了)

2.  要么做一个持久的，要么使用“回调”机制（调用你的应用程序）

3.  通过 UNC 路径和 CreateFile 打开所需的文件（UNC 看起来像这样：\\?\GlobalRoot\Devices\HarddiskVolumeShadowCopyXZY\yourpath\yourfile.yourextension）

4.  对文件做任何你想做的事

5.  如果您制作了持久性 VSC，则应在完成后使用示例客户端将其删除

更多信息在这里：[http](http://technet.microsoft.com/en-us/library/cc785914%28WS.10%29.aspx) ://technet.microsoft.com/en-us/library/cc785914%28WS.10%29.aspx 在这里：http : [//msdn.microsoft.com/en-us/library/bb968832% 28VS.85%29.aspx](http://msdn.microsoft.com/en-us/library/bb968832%28VS.85%29.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T21:03:45.877

我实际上不能说，但有以下第 9 频道的视频。

[Windows Vista“时间扭曲”：了解 Vista 的备份和还原技术](http://channel9.msdn.com/posts/Charles/Windows-Vista-quotTime-Warpquot-Understanding-Vistas-Backup-and-Restore-Technologies/)

有一些实现细节和一些关于 API 结构的信息。我相信要记住他们提到了卷影副本是如何映射到文件系统中的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T21:05:38.527

如果您可以控制第一个进程，则可以指定文件句柄共享类型

```
string contents1;
string contents2;
using (FileStream fs1 = new FileStream("test.txt", FileMode.Open, FileAccess.Read, FileShare.ReadWrite))
{
    using (var tr1 = new StreamReader(fs1))
    {
        using (FileStream fs2 = new FileStream("test.txt", FileMode.Open, FileAccess.Read, FileShare.ReadWrite))
        {
            using (var tr2 = new StreamReader(fs2))
            {
                contents2 = tr2.ReadToEnd();
                contents1 = tr1.ReadToEnd();
            }
        }
    }
}

Console.WriteLine(contents1);
Console.WriteLine(contents2); 
```

# c++ - 如何在调整这样的向量大小时避免分段错误

> ID：660020
> 
> 赞同：0
> 
> 时间：2009-03-18T20:43:46.690
> 
> 标签：c++, segmentation-fault

我认为这对你来说是一个简单的问题......我在 C++ 中很新......

所以我有一个这样定义的向量：

`vector<vector<float> > big_vector;`

我读取了一个文件并初始化了这个向量，然后 big_wector 中有大约 200,000 个元素。每个都是一个向量<float>

然后我想修改big_vector中的元素，对于某些元素我需要先调整它们的大小，（例如从0到300）

`big_vector[i].resize(new_size);`

当我运行程序时，首先它运行良好，经过一些修改，在上面的行出现了“分段错误”。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-18T20:49:59.983

首先，您需要调整 big_vector 的大小，以便它有一些要调整大小的向量。

```
int total_vectors = 100;
big_vector.resize(total_vectors);
for(int i = 0; i < total_vectors; ++i)
     big_vector[i].resize(new_size); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T21:07:40.597

为什么需要调整向量的大小？难道简单的 push_back 还不够吗？还是您按索引设置一些值？

如果您按索引设置值，我建议将 std::generate_n 与 std::back_inserter 一起使用

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T20:47:43.980

你有一个向量的向量。

在访问`big_vector[i]`（i 处的浮点向量）之前，您必须设置 big_vector 本身的大小。

# ruby - 使用 ruby ，如何创建 hudson 的 postBuildResult 所需的 hexBinary 数据？

> ID：660038
> 
> 赞同：1
> 
> 时间：2009-03-18T20:48:30.720
> 
> 标签：ruby, hudson

我想通过 ruby​​ 脚本将构建结果提交给 hudson。我能找到的小文档说标签中的数据是“hexBinary”格式。如何获取像“Hello, world”这样的简单红宝石字符串并将其转换为该格式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T00:18:08.657

我不确定哈德森，也不肯定以下是hexBinary。但这是我最好的尝试。

```
"Hello world".unpack("H*")  # => ["48656c6c6f20776f726c64"] 
```

所以只要得到字符串......

```
"Hello world".unpack("H*").first 
```

我对 hexBinary 格式感到困惑，因为我找不到任何明确的例子来说明它到底是什么。

# sql-server - 打开一个表并使用 SQL 2008 的查询设计器

> ID：660047
> 
> 赞同：1
> 
> 时间：2009-03-18T20:50:36.237
> 
> 标签：sql-server

在 SQL Server 2005 和管理我的 Crystal Reporting 中，我曾经打开一个表（小表），然后粘贴到 Crystal 查询中。使用查询设计器，我将使用所有 4 个查询设计器窗口添加-删除表和字段等。

我知道 Open table 已被替换，当我替换 SQL 时我会同意，但它不会显示提供关系或字段矩阵的查询设计器窗口

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T20:28:06.460

上下文菜单上的“打开表”项已被“编辑前 200 行”替换

单击“编辑前 200 行”菜单后，您仍然可以通过查询设计器菜单和工具栏访问所有查询设计器窗口。

# dynamic - 当我从 Clearcase 资源管理器创建视图时，开发和集成视图都被创建为快照

> ID：660049
> 
> 赞同：1
> 
> 时间：2009-03-18T20:51:18.917
> 
> 标签：dynamic, views, clearcase, explorer, snapshot

我根本没有选择将视图选择为快照或动态的选项。我想要的是快照的开发视图和动态的集成视图。为什么没有提示我让我选择快照/动态视图？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T21:33:23.060

可能你有[ClearCase LT](http://www-01.ibm.com/software/awdtools/clearcase/cclt/)，它只提供快照视图？

如[ClearCase mkview 帮助页面](http://publib.boulder.ibm.com/infocenter/cchelp/v7r0m1/index.jsp?topic=/com.ibm.rational.clearcase.cc_ref.doc/topics/ct_mkview.htm)中所述：

> 指定视图类型
> 
> **默认**
> 
> *   ClearCase：动态视图。
> *   ClearCase LT：快照视图

无论如何，您可以尝试通过命令行创建视图`cleartool`：

*   快照：

    ```
     cleartool mkview -snap -tag yourView_snap -stream yourStream@\yourPVob -stg aStorage aViewPath 
    ```

*   动态的：

    ```
     cleartool mkview -tag yourView -stream yourStream@\yourPVob -stg aStorage 
    ```

请注意命名约定（用于快照视图的 yourView_snap）：这*是*一个约定，它应该反映：

*   您的登录
*   流的名称

[其他 SO answer](https://stackoverflow.com/questions/395388/how-to-create-clearcase-views-automatically/395498#395498)中的更多详细信息。

* * *

另请注意，“集成视图”并不总是用于“动态视图”：如果您进行一些涉及某些编译的“集成测试”，则快照视图可能更适合。

# .net - 从查询字符串中获取执行计划

> ID：660053
> 
> 赞同：0
> 
> 时间：2009-03-18T20:53:06.153
> 
> 标签：.net, sql-server-2005

我有一个应用程序，在一个类中有一些 sql 查询，每个查询都在 stringBuilders..

我制作了另一个应用程序来从每个解析代码的字符串生成器中提取查询。

关键是：我需要为每个查询生成一个执行计划。

有没有办法自动执行此操作而无需将查询复制并粘贴到 SQL Management Studio？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T20:55:44.337

查询执行计划很大程度上取决于 SQL Server 中的索引。这决定了特定连接或查找是否需要扫描或搜索。我会说你可以做一个执行计划的一部分，但你永远不会仅仅基于一个查询字符串得到所有的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T21:29:05.940

为什么你需要生成执行计划，你打算用它做什么？

如果您想要做的只是在查询运行时检查它并确定它是否是最佳的，那么“SQL Server Profiler”就是您正在寻找的工具。这将允许您跟踪应用程序发出的查询并检查查询计划，而无需任何剪切和粘贴。

如果你真的想用查询计划数据“做”一些事情而不是仅仅检查它，那么恐怕你可能是从 SQL Server MS 或从探查器剪切和粘贴。

# visual-studio - Visual Studio 单元测试可以在 Vista 上“以管理员身份运行”吗？

> ID：660055
> 
> 赞同：1
> 
> 时间：2009-03-18T20:53:24.950
> 
> 标签：visual-studio, unit-testing, windows-vista

我们有一些与性能计数器一起工作的单元测试（特别是创建新类别），在 XP/2003 上它们工作正常，但在 Vista/7 上它们因 SecurityException（“不允许请求的注册表访问”）而失败。我尝试检查 属性上的“以管理员身份运行”框`VSTestHost.exe`，但这会导致*所有*测试立即失败，并标有错误且没有消息。

是否有人对使用管理权限运行 Visual Studio 单元测试（理想情况下只是*这些测试）有任何建议？*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T22:48:29.900

这是我的解决方案：`devenv.exe`在“属性和兼容性”选项卡下设置为“以管理员身份运行”。瞧！

# c# - .NET Framework 等效于 Python 的 imghdr

> ID：660057
> 
> 赞同：0
> 
> 时间：2009-03-18T20:54:38.893
> 
> 标签：c#, python, .net

Python 的`imghdr`模块确定文件或字节流中包含的图像类型。

`imghdr`.Net Framework 中的python 模块是否有等价物？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T21:16:07.267

就在最近，我需要确定文件中使用的 mime 类型。我不知道这个 Windows API 调用背后的确切逻辑，但我怀疑它进入文件内部以了解它的 mime 类型。希望这会有所帮助

```
using System;
using System.IO;
using System.Runtime.InteropServices;

namespace SomeNamespace
{
    /// <summary>
    /// This will work only on windows
    /// </summary>
    public class MimeTypeFinder
    {
        [DllImport(@"urlmon.dll", CharSet = CharSet.Auto)]
        private extern static UInt32 FindMimeFromData(
            UInt32 pBC,
            [MarshalAs(UnmanagedType.LPStr)] String pwzUrl,
            [MarshalAs(UnmanagedType.LPArray)] byte[] pBuffer,
            UInt32 cbSize,
            [MarshalAs(UnmanagedType.LPStr)]String pwzMimeProposed,
            UInt32 dwMimeFlags,
            out UInt32 ppwzMimeOut,
            UInt32 dwReserverd
        );

        public string GetMimeFromFile(string filename)
        {
            if (!File.Exists(filename))
                throw new FileNotFoundException(filename + " not found");

            var buffer = new byte[256];
            using (var fs = new FileStream(filename, FileMode.Open))
            {
                if (fs.Length >= 256)
                    fs.Read(buffer, 0, 256);
                else
                    fs.Read(buffer, 0, (int)fs.Length);
            }
            try
            {
                UInt32 mimetype;
                FindMimeFromData(0, null, buffer, 256, null, 0, out mimetype, 0);
                var mimeTypePtr = new IntPtr(mimetype);
                var mime = Marshal.PtrToStringUni(mimeTypePtr);
                Marshal.FreeCoTaskMem(mimeTypePtr);
                return mime;
            }
            catch (Exception)
            {
                return "unknown/unknown";
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T21:23:29.450

*如果*您可以信任文件的扩展名，则可以执行 rails 插件[mimetype-fu](http://github.com/mattetti/mimetype-fu)之类的操作。

这个插件有一个 yaml 扩展列表及其已知的 mime 类型。这是相当详尽的。我们找到了一个 .net 的 yaml 解析器，并简单地使用了 mimetype-fu 的 yaml。这使得它既可以快速构建又可以快速执行。

如果您只处理流并且没有文件名，则上述方法可能更适合您。

# python - 如何管理服务器上的 CPU 密集型进程

> ID：660059
> 
> 赞同：7
> 
> 时间：2009-03-18T20:54:54.417
> 
> 标签：python, performance, signal-processing

我需要在 HTTP 请求之间运行一个占用大量 CPU 和内存的 Python 脚本（分析和更改冗长的 WAV 文件）作为我的 Web 服务器（VPS）上的后台进程。

该脚本最多需要 20 秒才能运行，我担心服务器的性能。有没有一种好的方法可以降低进程的优先级，定期将控制权交给操作系统，或者以其他方式保护我的普通服务器的性能？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-18T20:57:42.990

假设它是一个 UNIX 服务器，您可以使用[nice 命令](http://www.builderau.com.au/program/linux/print.htm?TYPE=story&AT=339286637-339028299t-320002022c)来降低它的优先级。这应该够了吧。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-18T21:15:54.600

您可以在基于 linux 的服务器上使用[cpulimit 。](http://cpulimit.sourceforge.net/)即使是已经开始运行的脚本，它也会允许您限制 CPU 使用率（以百分比形式指定限制），并且它的使用非常简单。

它在 Debian 存储库中可用，因此您可以使用 aptitude 轻松安装它：

```
apt-get install cpulimit 
```

典型的使用方法`cpulimit`包括：

```
# To limit CPU usage to 75% of program called foo:
cpulimit -e foo -l 75

# To limit CPU usage to 50% of program with pid = 1582
cpulimit -p 1582 -l 50 
```

# c# - 是否有一个 IDE 可以突出显示结构语法？

> ID：660076
> 
> 赞同：24
> 
> 时间：2009-03-18T20:59:43.237
> 
> 标签：c#, visual-studio, ide, syntax-highlighting

受到[这个](https://stackoverflow.com/questions/659166/write-c-in-a-graphical-scratch-like-way/659203)关于图形编程环境的问题的启发。我不认为 C++ 或 C# 真的有利于这种类型的环境，但也许有一半的东西。

我使用的许多 IDE 将使用语法突出显示来更改关键字、字符串、注释等文本的前景（甚至背景）颜色......

是否有 IDE 可以突出更大的句法结构？这是我正在考虑的一个例子。

[示例代码结构 http://img256.imageshack.us/img256/9441/codestructure.png](http://img256.imageshack.us/img256/9441/codestructure.png)

（请不要评论我糟糕的颜色选择......我不是平面设计师是有原因的。）

虽然它不是图形拖放环境，但突出显示仍然可以提供代码结构的整体视图。就个人而言，在多年的 C++ 学习 C# 之后，我仍然发现自己被以下事实绊倒：在文件的末尾通常有类的结尾和命名空间的结尾，所以函数的结尾是两级的. （在 C++ 代码文件中，函数的结尾通常在缩进的顶层）。我通过在右括号中添加一些小评论来帮助自己：

```
 } // end class 
} // end namespace 
```

但在我看来，一些自动着色会让这完全没有必要。无论如何，这已经完成了吗？如果它是 Visual Studio 的附加组件，则可以加分。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-21T19:34:26.637

我是[Codekana](http://www.codekana.com)的作者。确实，您在上面描述的是该产品的主要目标。顺便说一句，我即将发表一篇关于“制作”和底层技术的文章，非常漂亮。它可能会在下周（09 年 3 月 26 日左右）上市。推荐阅读，如果我自己可以这么说的话。

Codekana 只提供轮廓而不是彩色背景的原因是 VS 的文本渲染可扩展性的限制。我希望在未来的某个时候能够实现一个坚实的背景版本，尽管它肯定需要严重的黑客攻击和“火箭手术”。

我会在上面发表评论，而不是提供另一个答案，但我的声誉不允许发表评论。:(

[更新：感谢投票，现在我可以发表评论了！]

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-18T21:10:05.643

我见过的最接近的东西是[Codekana](http://www.codekana.com/)，虽然没有“背景语法突出显示”，但它为不同的流控制结构着色：

[![](https://i.stack.imgur.com/jWYEk.gif)](https://i.stack.imgur.com/jWYEk.gif)
[（来源：[codekana.com](http://www.codekana.com/img/post-hls.gif)）]

* * *

[![](https://i.stack.imgur.com/GTzxj.gif)](https://i.stack.imgur.com/GTzxj.gif)
[（来源：[codekana.com](http://www.codekana.com/img/nested-hdr.gif)）]

*   红色 for 循环
*   如果块为绿色
*   棕色用于其他块
*   用于开关块的海蓝宝石
*   Olive 用于异常块
*   橙色代表“回归”

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-18T21:24:06.420

[Coderush 进行](http://devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/Visualization.xml)结构突出显示：

[![替代文字](https://i.stack.imgur.com/YzIDz.gif)](https://i.stack.imgur.com/YzIDz.gif)
[（来源：[devexpress.com](http://devexpress.com/Products/Visual_Studio_Add-in/Coding_Assistance/i/StructuralHighlightingInCSharp.gif)）]

您可以使用 DevExpress 编写自己的插件来实现您的原始屏幕截图，这是非常可行的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-08-11T13:33:18.673

当前的 BlueJ 编辑器完全符合您的描述：

![BlueJ 编辑器截图](https://i.imgur.com/4e6fk.png)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T21:09:27.173

Visual Studio IDE 已经这样做了，但使用了不同的可视化 - 您可以通过单击左边距的 +/- 按钮来展开和收缩嵌套块。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T21:14:51.310

一个好主意。就个人而言，我真的不喜欢折叠式编辑器，但这是可以忍受的——不过你希望能够轻松地打开/关闭它。也许有人已经为 vim 和 emacs 之类的超可编程编辑器做到了这一点？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-18T21:15:00.203

我认为 Xcode 3 大致可以满足您的需求，尤其是在[启用](http://www.goodbyehelicopter.com/2008/06/08/xcode-3-turn-on-that-scope-depth-syntax-highlighting/)[**Focus Follows Selection**](http://www.goodbyehelicopter.com/2008/06/08/xcode-3-turn-on-that-scope-depth-syntax-highlighting/)的情况下。当您将鼠标悬停在侧边栏中的各个块上时，它们会突出显示。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-22T09:31:09.853

你应该试试这个插件，没有它你永远不会在视觉工作室工作， [http://www.jetbrains.com/resharper/features/index.html](http://www.jetbrains.com/resharper/features/index.html)

PS：我不隶属于这家公司或产品，但我是一个使用它的瘾君子，没有它我永远无法工作，它为我的编码任务以及代码探索和调试节省了很多时间。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-11-12T10:24:37.543

我正在开发受这个问题启发的 Visual Studio 扩展。你可以在这里看到我到目前为止所拥有的：

[http://lorgonblog.wordpress.com/2010/11/12/the-f-compiler-source-release-making-it-easy-to-write-cool-visual-studio-extensions/](http://lorgonblog.wordpress.com/2010/11/12/the-f-compiler-source-release-making-it-easy-to-write-cool-visual-studio-extensions/)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-09-02T08:35:22.170

还有一个免费的扩展，至少根据它们所属的颜色绘制引导线。例如，`if`绿色指南等：
![示例截图](https://visualstudiogallery.msdn.microsoft.com/203f22f4-3e9f-4dbb-befc-f2606835834e/image/file/18169/11/screenshot.png?Id=18169)

它称为*StructureAdornment*，您可以在 Extension Manager 或[Visual Studio Gallery](http://visualstudiogallery.msdn.microsoft.com/en-us/203f22f4-3e9f-4dbb-befc-f2606835834e)中获取它。

我觉得很方便。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-03-24T15:06:17.997

allmargins 扩展在 Visual Studio 2010 中为我工作

工具-->扩展管理器-->搜索allmargins

# c - C 中的派生类 - 你最喜欢的方法是什么？

> ID：660083
> 
> 赞同：3
> 
> 时间：2009-03-18T21:01:12.640
> 
> 标签：c, oop

根据我在面向对象的 C 编程方面的经验，我见过两种实现派生类的方法。

* * *

**第一种方法**，将父类定义为 .h 文件。然后从这个类派生的每个类都会做：

文件 parent_class.h：

```
int member1;
int member2; 
```

文件testing.c：

```
struct parent_class {
    #include "parent_class.h" // must be first in the struct
}

struct my_derived_class {
    #include "parent_class.h" // must be first in the struct
    int member3;
    int member4;
} 
```

* * *

**第二种方法**，会做：

文件testing.c：

```
struct parent_class {
    int member3;
    int member4;
}

struct my_derived_class {
    struct parent_class; // must be first in the struct
    int member3;
    int member4;
} 
```

* * *

你最喜欢在 C 中做派生类的方法是什么（不一定是我所做的）？为什么？

您更喜欢哪种方法，第一种方法还是第二种方法（或您自己的方法）？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T21:20:56.647

我是使用方法 2 的库的维护者之一。与方法 1 一样有效，但没有任何预处理器技巧。或者它实际上效果更好，因为您可以拥有将基类作为参数的函数，并且您可以强制转换为基本结构，C 保证这适用于第一个成员。

更有趣的问题是，虚函数怎么做？在我们的例子中，结构有指向所有函数的指针，并且初始化设置它们。它稍微简单一些，但比带有指向共享 vtable 的指针的“正确方式”具有更多的空间开销。

无论如何，我更喜欢使用 C++ 而不是将它与普通 C 混为一谈，但是政治......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T21:26:21.673

第一种方法很可怕，它隐藏了重要信息。我永远不会使用它或允许它被使用。即使使用宏会更好：

```
#define BODY int member1; \
             int member2; 

struct base_class
{
   BODY
}; 
```

但是由于其他人指出的原因，方法2要好得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T21:18:51.160

我知道 GNOME 使用第二种方法，并且转换指针也是众所周知的事情。我不记得有任何真正的箍可以跳过这样做。实际上，从 C 内存模型的角度来看，两者之间没有任何语义差异，因为 AFAIK 唯一*可能的*差异是结构填充方面的编译器差异，但由于代码都通过同一个编译器运行，那将是一个有争议的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T07:25:19.923

第二个选项迫使你写很长的名字，比如`myobj.parent.grandparent.attribute`，这很难看。从语法的角度来看，第一个选项更好，但是将 child 转换为 parent 有点冒险 - 我不确定标准是否保证不同的结构对相似的成员具有相同的偏移量。我猜编译器可能会对此类结构使用不同的填充。

还有另一种选择，如果您使用的是 GCC - 匿名结构成员，它是 MS 扩展的一部分，所以我猜它是由一些 MS 编译器发起的，并且仍然可能被 MS 支持。

声明看起来像

```
struct shape {
    double  (*area)(struct shape *);
    const char    *name;
};

struct square {
    struct shape;           // anonymous member - MS extension
    double          side;
};

struct circle {
    struct shape;           // anonymous member - MS extension
    double          radius;
}; 
```

在您的“构造函数”函数中，您需要指定正确的函数来计算面积并享受继承和多态性。您始终需要明确传递的唯一问题`this`- 您不能只调用`shape[i]->area()`.

```
shape[0] = (struct shape *)new_square(5);
shape[1] = (struct shape *)new_circle(5);
shape[2] = (struct shape *)new_square(3);
shape[3] = (struct shape *)new_circle(3);

for (i = 0; i < 4; i++)
    printf("Shape %d (%s), area %f\n", i, shape[i]->name,
            shape[i]->area(shape[i]));    // have to pass explicit 'this' 
```

用 编译`gcc -fms-extensions`。我从未在实际项目中使用过它，但我前段时间对其进行了测试，它确实有效。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T21:04:41.273

我使用的代码使用了第一种方法。

我能想到的使用第一种方法的唯一两个原因是：

1.  为您节省一些周期，因为您将减少一次取消引用
2.  当您将派生类指针转换为父类时，即 (struct parent_class *)ptr_my_derived_class ，您100% 知道预期的结果。

我更喜欢第一种方法，因为您可以毫无顾虑地将派生类指针转换为父类。

你能用第二种方法做同样的事情吗？（看起来你必须跳过一两圈才能得到相同的最终结果）

如果你可以对方法 2 做同样的事情，那么我认为这两种方法都是平等的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-18T21:20:01.347

我之前使用过方法#2，发现它工作得很好：

*   如果它是派生类型中的第一个成员，您可以随时向上转换为基类型
*   而不是一直取消引用以获取基本成员，只需保留两个指针：一个用于基本接口，一个用于派生接口

`free()`在指向基础结构的指针上当然也会释放派生字段，所以这不是问题......

此外，我发现访问基字段是我在多态情况下倾向于做的事情：我只关心那些关心基类型的方法中的字段。派生类型中的字段用于仅对派生类型感兴趣的方法中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-18T21:22:10.623

第二种方式具有继承方法的类型安全的优点。如果你想要一个方法 foo(struct parent_class bar) 并用 foo((struct parentclass) derived_class) 调用它，这将正常工作。C 标准对此进行了定义。因此，我通常更喜欢方法#2。通常，保证将结构转换为其第一个成员将产生一个包含该结构的第一个成员的数据的结构，无论内存是如何布局的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-18T21:25:13.580

在以前的工作中，我们使用预处理器来处理这个问题。我们使用简单的 C++ 样式语法声明类，预处理器生成的 C 头文件基本上等同于第一种方法，但没有#includes。它还做了一些很酷的事情，比如为向上转换和向下转换生成 vtable 和宏。

请注意，这是在我们针对所有目标平台存在好的 C++ 编译器之前的日子。现在，这样做将是愚蠢的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-18T22:17:00.227

> 我更喜欢第一种方法，因为您可以毫无顾虑地将派生类指针转换为父类。

反之亦然。

C 标准保证结构的地址是第一个成员的地址，因此在第二种情况下，将派生的指针强制转换为父结构是安全的，因为派生的第一个成员是父结构，而结构当不是成员时，作为与相同结构相同布局的成员，因此将指向派生的指针转换为父级将始终有效。

对于第二种情况，情况并非如此。具有定义为相同类型的某些成员的两个结构可能在这些成员之间具有不同的填充。

64 位 bigendian 编译器编译是合理的

```
struct A { a uint64_t; b uint32_t; }; 
```

这样 sizeof(A) 是 8 的整数倍并且 b 是 64 位对齐的，但是编译

```
struct B { a uint64_t; b uint32_t; c uint32_t; }; 
```

因此 sizeof(B) 是 8 的整数倍，但 b 仅 32 位对齐，因此不会浪费空间。

# django - 帮助在 Django 中删除 reconds

> ID：660094
> 
> 赞同：1
> 
> 时间：2009-03-18T21:04:54.940
> 
> 标签：django, django-models, django-orm

```
 for u in Users.objects.all():

            for g in u.group.all():
                if g not in Groups.objects.filter(domain__user=u.id):
                   u.group.filter(id=g.id).delete() 
```

如何删除关系表中的条目。在这种情况下，我在组和用户之间有多对多的关系。上述代码中的 delete 语句将组从 Groups 表中删除。我只想从 Users_group 表中删除用户和组之间的关系。我该怎么做呢。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T22:01:55.910

思考这个问题的关键是要意识到 u.group 是一个管理器，就像 Groups.objects 是一个管理器一样（默认情况下前者是后者的子类）。您在 u.group 上调用的大多数操作都会影响整个 Group 表（可能会首先过滤到与 u 相关的对象）。这意味着，假设 g 与 u 有关，

```
u.group.filter(id=g.id).delete() 
```

应该与

```
Groups.objects.filter(id=g.id).delete() 
```

在这两种情况下， .filter() 返回一个查询集（对于 u 完全天真）并且 .delete() 删除所有成员。

好消息是 u.group 应该是一个 ManyRelatedManager，这意味着会有其他可用的方法。对于许多示例，请查看[此处](http://www.djangoproject.com/documentation/models/many_to_many/)。应该适合您的场景的一个：

```
u.group.remove(g) 
```

# asp.net-mvc - ASP.NET MVC - 有没有办法返回 2 PartialViews？

> ID：660096
> 
> 赞同：0
> 
> 时间：2009-03-18T21:05:06.547
> 
> 标签：asp.net-mvc

是否可以在我的 ActionResult 中返回 2 个 PartialViews 而不是一个？

谢谢！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T21:11:23.143

Steve Sanderson 写了一篇关于在 ASP.NET MVC 中使用部分请求的博客，它可能不是您想要的，但他的解决方案允许您在控制器操作中将部分视图附加到 ViewData，然后在视图的帮助下使用一种扩展方法。

它可能会为您提供有关如何解决问题的想法：http: [//blog.codeville.net/2008/10/14/partial-requests-in-aspnet-mvc/](http://blog.codeville.net/2008/10/14/partial-requests-in-aspnet-mvc/)

# java - Java foreach 对原语的迭代顺序是否精确定义？

> ID：660097
> 
> 赞同：25
> 
> 时间：2009-03-18T21:05:06.983
> 
> 标签：java, foreach, iteration

示例代码：

```
int a[] = new int[]{0, 1, 2, 3};
int result = 0;
for (int i : a)
    result += i; 
```

循环是否保证以该顺序遍历`a[0]`, `a[1]`, `a[2]`, `a[3]`？我坚信答案是肯定的，但是[这个页面](http://java.sun.com/j2se/1.5.0/docs/guide/language/foreach.html)似乎并没有明确地说明顺序。

有可靠的参考吗？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-03-18T21:11:56.093

根据[JLS，增强`for`语句](http://java.sun.com/docs/books/jls/third_edition/html/statements.html#259170)，你的 for-loop 相当于

```
int[] array = a;
for (int index = 0; index < a.length; index++) {
    int i = array[index];
    result += i;
} 
```

“其中`array`和是编译器生成的标识符，与增强语句发生时`index`范围内的任何其他标识符（编译器生成或其他）不同。” `for`（在这里稍微解释一下变量名）。

所以是的：订单绝对有保证。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-18T21:14:23.107

请参阅[Java 语言规范第 3 版的第 14.14.2 节](http://java.sun.com/docs/books/jls/third_edition/html/statements.html#24588)。

> 如果 Expression 的类型是 Iterable 的子类型，则令 I 为表达式 Expression.iterator() 的类型。增强的 for 语句等效于以下形式的基本 for 语句：
> 
> ```
> for (I #i = Expression.iterator(); #i.hasNext(); ) {
>         VariableModifiersopt Type Identifier = #i.next();
>    Statement
> } 
> ```
> 
> Where #i is a compiler-generated identifier that is distinct from any other identifiers (compiler-generated or otherwise) that are in scope (§6.3) at the point where the enhanced for statement occurs.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-18T21:15:13.043

It states in the [JLS](http://docs.oracle.com/javase/specs/jls/se7/html/jls-14.html#jls-14.14.2) that:

```
for ( VariableModifiersopt Type Identifier: Expression) Statement 
```

is equivalent to

```
T[] a = Expression;
L1: L2: ... Lm:
for (int i = 0; i < a.length; i++) {
        VariableModifiersopt Type Identifier = a[i];
        Statement
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T21:12:25.950

我在您引用的页面中没有发现任何暗示无序迭代的内容。能发一下具体的报价吗？

无论如何，我发现这段代码：

```
public static void main( String args[] ) {
    double a[] = new double[] { 0, 1, 2, 3 };
    int result = 0;
    for ( double i : a ) {
        result += i;
    } 
```

反编译为旧式循环：

```
 public static void main(String args[])
    {
        double a[] = {
            0.0D, 1.0D, 2D, 3D
        };
        int result = 0;
        double ad[];
        int k = (ad = a).length;
        for(int j = 0; j < k; j++)
        {
            double i = ad[j];
            result = (int)((double)result + i);
        }
    } 
```

当然，这与保证不同，但至少对数组进行无序迭代会非常奇怪，并且似乎违背了明显的常识实现。

# sql - 多少行数据算太多数据行？

> ID：660101
> 
> 赞同：19
> 
> 时间：2009-03-18T21:07:00.520
> 
> 标签：sql, size

是否有一些关于 SQL 表太大的硬性规则？

我们以名称/值对格式存储 SCORM 跟踪数据，每个用户每门课程可能有 4-12 行，由于有数百门课程和数千名用户，这将是一件坏事吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-18T21:11:34.330

神奇的数字是数十亿。在您获得数十亿行数据之前，您根本不会谈论太多数据。

算一算。

每门课程每个用户 4-12 行，......数百个课程和数千个用户？

400,000 到 1,200,000 行。假设每行 1000 个字节。

那是 400Mb 到 1.2Gb 的数据。您可以在 Apple 商店以 299 美元的价格购买 100Gb 驱动器。您可以轻松地将超过 299 美元的可计费时间花在那些不再重要的细节上。

在您获得 1Tb 数据（1,000 Gb）之前，您根本谈不上太多数据。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-18T21:09:38.920

我个人有 5000 万行的生产表，这与我听说的相比很小。您可能需要通过分区来优化您的结构，但是在您在您的环境中测试您的系统之前，您不应该浪费时间这样做。你所描述的是非常小的恕我直言

我应该补充一下，我使用的是 SQL Server 2000 和 2005，每个 DBMS 都有自己的大小限制。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-18T21:11:57.700

100（课程）* 1000（用户）* 10（记录）只有一百万。这是低端，但一个像样的数据库应该可以处理它。

听起来很可疑的是名称/值对。这将限制您正确索引事物的能力，这对于良好的性能至关重要。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-10T05:29:16.923

没有硬性规定，但有一种硬性和快速的方法来获得数字。

编写一个程序，用与实际数据的预期形式大致近似的虚拟数据填充您的表（例如，相似的规律性、字符、模式等）。使用带有虚拟数据的实际查询对其运行性能测试，逐渐增加行数在表中，可能以 1000 或 10000 行为步长。

当查询性能（例如每秒完成的查询）变得不可接受时，您将拥有“太大”的行数。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-18T21:29:52.600

我曾经研究过一个 Web 表单系统，其名称/值对表中有超过 3 亿行。许多表单每次提交的表单超过 300 行。性能实际上并不算太差，但它是一个完整的 PITA 查询！我的 sql 编写能力在这次演出的整个生命周期中肯定有所提高。

但是恕我直言，如果您有任何发言权，请摆脱它以支持标准规范化表。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-18T21:08:59.203

并不真地。这完全取决于您的业务需求，您必须购买支持您估计的行数的产品。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-18T21:19:41.753

不，关于表中可以有多少行并没有真正的硬性规定，这在很大程度上取决于行中有多少数据，以及数据可以被索引的程度。

对您所说的数字进行快速估计会得出数千万行。这当然不是太多，但如果你不小心，它可能会成为一个问题就足够了。

也许表格可以标准化？是否经常出现相同的名称，以便您可以将名称放在单独的表中并使用表中的 id？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-18T21:26:34.247

我不认为这里真的有限制，但是驱动空间。但是请在小的时候添加好的索引，因为当表很大时，添加索引需要更长的时间。另外，如果您有错误的索引，查询会随着它的增长而变慢，并且当确实没有任何问题时人们会抱怨，但是没有索引是很糟糕的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-18T22:41:24.317

我曾在数据库上工作过，我们试图创建包含 2B 行数据的表——这不起作用，我们达到了 500M 并重新设计。使用如此大的表的最大问题之一是删除所需的时间——我经常看到将旧记录存档然后从主表中删除的方法。如果表足够大，在重建索引时删除将运行数小时。

不知道截断在哪里，但直觉表明表格 > 10M 行可能太大了。我们的方法是按日期对数据进行分区，因此我们最终得到了一个包含一周数据的表，另一个是几个月的汇总表，另一个是多年的汇总表——这在 DataWarehousing 中很常见。顺便说一句，这是在 SQL 7.0 上，想知道数据库是否更擅长这种类型的东西？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-12-31T14:10:49.480

你的问题提出的问题多于答案。

*   您使用的是什么数据库引擎？没有这个，很难给你一个好的答案。
*   什么是表结构？根据您的数据类型，您的表在磁盘上的布局方式将取决于此。
*   为什么不为每个用户/课程存储一条记录？当您存储 SCORM 数据时，我假设这意味着您正在存储标准 SCORM 数据，例如完成、成功、尝试、总时间等。无需为此创建多行。

我已经建立了一些存储 SCORM 数据的数据库，而且我从来不需要像你建议的那样使用标签/值系统。

您要记住的一件事不是表中的行数，而是表的大小（以字节为单位）。简单地：

表大小 = 行大小 (avg) * 行数

要问的问题是，“多大的桌子太大了”？

# cocoa - 如何使用 NSDateFormatter 格式化 NSString？

> ID：660119
> 
> 赞同：1
> 
> 时间：2009-03-18T21:11:12.787
> 
> 标签：cocoa

我需要能够将现有的 NSString 格式化为不同的日期格式。NSDateFormatter 有 dateFromString 和 stringFromDate 方法，但没有 stringFromString。是否可以以 NSString 的形式获取我的日期并使用类似于以下内容重新格式化它：

```
 NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];
    [dateFormatter setDateFormat:@"yyyy-MM-dd"];
    strMyDate = [dateFormatter stringFromString(does not exist):strMyDate]; 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-18T21:20:02.967

您需要从字符串创建日期，然后将该日期重新格式化为不同的字符串。

就像是：

```
NSDateFormatter *dateFormatter = [[[NSDateFormatter alloc] init] autorelease];

// get NSDate from old string format
[dateFormatter setDateFormat:@"yyyy-MM-dd"];
NSDate *date = [dateFormatter dateFromString:@"2009-03-18" ];

// get string in new date format
[dateFormatter setDateFormat:@"dd-MM-yyyy"];
NSString *strMyDate= [dateFormatter stringFromDate:date]; 
```

# javascript - 有没有办法在选择元素时更改元素的内容？

> ID：660123
> 
> 赞同：0
> 
> 时间：2009-03-18T21:11:49.773
> 
> 标签：javascript, dom, clipboard

是否可以在选择元素或其中的部分文本时更改元素的内容，然后在取消选择它们时将它们恢复回来？

目的是当它们被复制到剪贴板时，替代值被复制。

html 看起来像这样：

```
<p>Today is the <span class="date" value="18/03/2009">18th of March</span>.</p> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T04:47:01.723

更新：改为使用悬停（根据 Scott E. 评论）

我喜欢 JQUERY，下面是一种方法，虽然不完美，但应该让你开始走上这条路。它不完美的原因是因为如果您将鼠标悬停在跨度的右侧（有趣地），则会出现“颤动”。

请注意，这是功能齐全的，但您应该获得 JQUERY js 的本地版本。此外，在第一次发布后，我发现 I/E 的行为与预期不符。

请参阅[http://docs.jquery.com/Events](http://docs.jquery.com/Events)和[http://docs.jquery.com/Core](http://docs.jquery.com/Core)

```
<html>
  <body>
    <p>Today is the <span class="date"/></p>
  </body>
</html>

<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>
<script type="text/javascript">

  $(document).ready(function(){

    // use data object of <span> element with class 'date'.
    // Do this instead of using "value" attribute in <span>
    // which is not normal part of <span> element
    // instead of putting the value directly in <span> above, I'm assigning it here

    $(".date").data("mydates", { selected : "18/03/2009", normal: "18th of March" } );

    // assign the normal value on startup
    $(".date").html($(".date").data("mydates").normal);

    // first function is executed on mouseover
    // second function is executed on mouseout
    $(".date").hover(
        function() {
            $(".date").html($(".date").data("mydates").selected);
        },
        function() {
            $(".date").html($(".date").data("mydates").normal);
        }
    );

  });
</script> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T08:54:28.180

我想出的解决方案如下。

HTML：

```
<p>Semper mi vitae tellus <span class="date" title="19/03/09" data="19th of March">19th of March</span> quis, augue.</p> 
```

CSS：

```
.date {
    display:inline-block;
    text-align:center;
} 
```

当内容被替换时，这会阻止文本跳来跳去。

Javascript：

```
var travel = function(node, noChildren){
    if (node.firstChild && !noChildren) {
        return node.firstChild;
    }
    if (node.nextSibling) {
        return node.nextSibling;
    }
    return travel(node.parentNode, true);
};

var onMouseDown = function(event){
    var spans = document.getElementsByClassName(revertClass);
    var i = spans.length;
    while (i) {
        i--;
        spans[i].innerHTML = spans[i].getAttribute('data');
        spans[i].className = window.baseClass;
    }

    var selection = window.getSelection();
    if (selection.rangeCount && event.button === 2){
        var n = selection.rangeCount;
        var k = n;
        do {
            var i = k-n;
            var range = selection.getRangeAt(i);

            var element = range.startContainer;
            var endContainer = range.endContainer;
            do {
                if (element.className === window.baseClass){
                    element.style.width = element.offsetWidth;
                    element.innerHTML = element.title;
                    element.className += ' ' + window.revertClass;
                }
                if (element == endContainer){
                    break;
                }
            }
            while (element = travel(element));

            var newRange = document.createRange();
            newRange.setStart(range.startContainer, range.startOffset);
            newRange.setEnd(range.endContainer, range.endOffset);

            selection.removeRange(range);
            selection.addRange(newRange);
        }
        while (--n);
    }
};

var onKeyDown = function(event){
    //Ctrl + C
    if (event.keyCode === 67 && event.ctrlKey){
        event.button = 2;
        onMouseDown(event);
    }
    //Tab to deselect
    else if (event.keyCode === 9){
        onMouseDown(event);
    }
};

window.baseClass = 'date';
window.revertClass = 'date_revert';
window.addEventListener ('mousedown', onMouseDown, false);
window.addEventListener ('keydown', onKeyDown, false); 
```

我故意不使用 jquery，因为我计划在greasemonkey 脚本中使用它并将它加载到每个页面上会减慢速度（我认为？）。我让它通过在 mousedown 触发后绑定 mousemove 来自动更改选择，但它最终变得非常慢，所以我决定最好专注于更改复制内容的目标。

关于非标准属性的使用，我从来没有发现这是一个问题？我正在使用标题，以便人们可以在不复制它和数据的情况下看到替代格式，因为它看起来很合乎逻辑。

# macos - 像 SuperDuper 在 Mac 上克隆 RHEL 或 FreeBSD 机器的工具？

> ID：660131
> 
> 赞同：0
> 
> 时间：2009-03-18T21:13:03.127
> 
> 标签：macos, clone, freebsd, rhel

我维护了几个运行 Mac OS X Server 的机器。它的一大优点是我可以使用 SuperDuper！克隆卷。例如，我可以在应用软件更新之前拍摄整个引导卷的快照，如果出现严重错误，我可以回滚到快照。或者我可以克隆到外部驱动器，然后换入更高功率的硬件。

我还使用 SuperDuper 将我的 MacBook 驱动器克隆到外部驱动器，如果我的内部驱动器出现故障，我可以从外部驱动器启动并继续工作。

我想像这样的工具也必须存在于 Linux 或 FreeBSD 上。如何拍摄在硬件（非虚拟化）上运行的 Linux 机器的快照？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-05-02T03:36:03.963

如果您在 Linux 中使用 LVM，那么您可以通过运行`lvcreate -L15G -s -n mysnapshot /home/user/volume`. HowtoForge 有一个很棒的[LVM 快照](http://www.howtoforge.com/linux_lvm_snapshots)教程。

如果您在 FreeBSD 或 Linux 上使用 ZFS（通过 fuse），那么运行“zfs snapshot tank/test@DATE”很容易。有关更多信息，请参阅[FreeBSD ZFS Wiki](http://wiki.freebsd.org/ZFS)页面。

# c# - 在派生类型上使用类的静态成员？

> ID：660132
> 
> 赞同：73
> 
> 时间：2009-03-18T21:13:32.657
> 
> 标签：c#, static, resharper

使用 Resharper 4.1，我遇到了这个有趣的警告：“通过派生类型访问类型的静态成员”。这是发生这种情况的代码示例：

```
class A {
    public static void SomethingStatic() {
       //[do that thing you do...]
    }
}

class B : A {
}

class SampleUsage {
    public static void Usage() {
        B.SomethingStatic(); // <-- Resharper warning occurs here
    }
} 
```

有人知道通过 B 使用 A 的静态成员时有什么问题（如果有的话）吗？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-03-18T21:23:15.177

一个可能会产生误导的地方是当静态是工厂方法时，例如，`WebRequest`该类有一个工厂方法`Create`，如果通过派生类访问，该工厂方法将允许编写这种类型的代码。

```
var request = (FtpWebRequest)HttpWebRequest.Create("ftp://ftp.example.com"); 
```

这`request`是一种类型`FtpWebRequest`，但令人困惑，因为它看起来像是从`HttpWebRequest`（兄弟类）创建的，即使该`Create`方法实际上是在`WebRequest`（基类）上定义的。以下代码含义相同，但更清晰：

```
var request = (FtpWebRequest)WebRequest.Create("ftp://ftp.example.com"); 
```

最终，通过派生类型访问静态数据不会有什么大问题，但如果不这样做，代码通常会更清晰。

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-03-18T22:05:51.517

`B.SomethingStatic()`做出`SomethingStatic`属于 的成员的语句`B`。这不是真的。 `SomethingStatic`毫无疑问是 的成员`A`。事实上，它的成员`B`（就好像它是 的成员一样`B`）可以无条件地访问它，这是一个方便的问题。在符合条件时可以访问它的事实`B`是，IMO，一个错误。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-03-18T21:17:28.933

通常，这不是警告，只是建议。您正在不必要地创建对某些东西的依赖。

假设您稍后决定 B 不需要继承 A。如果您遵循 Resharper 的建议，则无需修改该行代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T21:18:40.990

是的，我也见过这个，我一直认为它只是在警告我，因为它是不必要的。`A.SomethingStatic();`会做同样的事情。

# filesystems - 如何让 FileSystemWatcher 线程永远运行？

> ID：660135
> 
> 赞同：7
> 
> 时间：2009-03-18T21:14:51.687
> 
> 标签：filesystems, monitoring, infinite-loop, filesystemwatcher

我需要让 FileSystemWatcher 在无限循环中运行以监视文件的更改，但是该文件每隔几天才会更改一次，并且可能每周更改一次。在[FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)的 MSDN 示例中，有一个循环，而用户没有在控制台输入 q：

```
while(Console.Read()!='q'); 
```

我不希望它一直可用，所以它不会被意外杀死——它必须在没有用户干预的情况下无限循环运行。我是否必须将循环更改为

```
while (true); 
```

所以线程不退出？仅此一项并不理想，因为它将与 CPU 挂钩 - 添加**Thread.Sleep**调用将消除 CPU 负载，在这种情况下，可能会长时间休眠，因为文件很少更改。这是最好的方法吗？我应该如何确保该线程保持活动状态，以便 FileSystemWatcher 可以在文件更改时采取行动？这是在 Windows 服务器（使用 .NET 框架 2.0 版）上运行的，因此如有必要，可以将其设为 Windows 服务。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-18T21:37:52.457

如果它在服务器上运行，服务似乎是一个不错的选择。

如果你想要一些更具交互性的东西，我有一个小应用程序，它位于我的系统托盘中，当我们的问题文件夹中发生某些事情时向我显示。它使用 Application.Run() 方法来保持自身运行而不需要循环，即

```
class MainEntryClass
{
    static void Main(string[] args)
    {
        FolderAlerter fa = new FolderAlerter(); 
        Application.Run();
    }
} 
```

然后我在 FolderAlerter 中设置了我的 FileSystemWatcher。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T21:52:32.327

基本上，FileSystemWatcher 使用一些内置钩子来订阅更改，并在发生更改时让操作系统调用您的委托。所以你所要做的就是阻止你的主线程退出，它实际上不需要做任何事情；当你到达那条线时，程序的主要部分已经结束，它已经完成了它需要做的事情。

做你想做的一个简单的方法是对 MSDN 中的示例进行此更改；

```
//while (Console.Read() != 'q') ;
System.Threading.Thread.Sleep(System.Threading.Timeout.Infinite); 
```

这将使您的主线程永远休眠，但仍将允许委托触发并响应目录中的更改。请注意，它将继续运行多个更改（就像 MSDN 示例一样）。

请注意，MSDN 示例中的“while”实际上并没有多大作用。您可以只用“Console.Read()”替换该行，这将使任何键退出应用程序。这只是阻止主线程退出的一条线，以便在事件通知进来时它仍然存在。

但是，使用 Sleep(Timeout.Infinite) 会使您的应用程序处于用户无法轻易停止的状态，除非通过终止应用程序。如果您将其编写为控制台应用程序，为什么不坚持“按 Q 退出”？如果您决定将其编写为服务，则可能没问题，只要您处理关闭/重启事件等。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T21:57:21.130

为此，您可能希望创建[`ManualResetEvent`](http://msdn.microsoft.com/en-us/library/system.threading.manualresetevent.aspx)处于重置状态的 a 并在其上放置主线程`WaitOne()`。要终止，其他一些回调可以简单地`Set()`导致`WaitOne()`返回的事件。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T21:23:21.493

您可以使用 Thread.Sleep 来避免空循环。但是，在系统重新启动等情况下，Windows 服务将自动重新启动。另一种方法，取决于程序/系统的其余部分是如何构建的，是使用 Windows 调度程序在单独的 .exe 文件中运行轮询逻辑。

如果您正在寻找一个健壮/弹性的解决方案，Windows 服务或基于 Windows 调度程序的方法似乎更可取。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T21:27:04.073

Sysinternals（现在归微软所有）有 FileMon，它将为您提供所需的源代码。

从网站引用

> FileMon 的核心是虚拟设备驱动程序 Filevxd.vxd。它是动态加载的，并在初始化时通过 VxD 服务 IFSMGR_InstallFileSystemApiHook 安装文件系统过滤器，以将自身插入到所有文件系统请求的调用链中。

二进制文件和来源可以在这里找到： [http ://technet.microsoft.com/en-us/sysinternals/bb896642.aspx](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)

# vba - 读取和写入 .ini 文件的推荐方式

> ID：660138
> 
> 赞同：12
> 
> 时间：2009-03-18T21:15:16.240
> 
> 标签：vba, ms-access, ini

VBA 中是否有任何方法可以读取和写入 INI 文件？我知道我可以使用；

```
Open "C:\test.ini" For Input As #1 
```

...并解析数据。相反，我想看看哪些工具已经可用。

我知道在 C# 中你可以...

```
 using INI;
 INIFile ini = new INIFile("C:\test.ini"); 
```

VBA是否有等价物？

我在 MS Access 2003 VBA 中尝试这样做。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-19T13:37:14.040

这是我们使用的一些代码片段，它应该可以帮助您了解这个想法。这些例程使用 API 调用。包含两个函数来读取/写入 ini 文件中特定部分的字符串设置。

```
Private Declare Function GetPrivateProfileString Lib "kernel32" Alias "GetPrivateProfileStringA" (ByVal lpApplicationName As String, ByVal lpKeyName As Any, ByVal lpDefault As String, ByVal lpReturnedString As String, ByVal nSize As Long, ByVal lpFileName As String) As Long
Private Declare Function WritePrivateProfileString Lib "kernel32" Alias "WritePrivateProfileStringA" (ByVal lpApplicationName As String, ByVal lpKeyName As Any, ByVal lpString As Any, ByVal lpFileName As String) As Long

Public Function IniFileName() As String
  IniFileName = "c:\[yourpath here]\settings.ini"
End Function

Private Function ReadIniFileString(ByVal Sect As String, ByVal Keyname As String) As String
Dim Worked As Long
Dim RetStr As String * 128
Dim StrSize As Long

  iNoOfCharInIni = 0
  sIniString = ""
  If Sect = "" Or Keyname = "" Then
    MsgBox "Section Or Key To Read Not Specified !!!", vbExclamation, "INI"
  Else
    sProfileString = ""
    RetStr = Space(128)
    StrSize = Len(RetStr)
    Worked = GetPrivateProfileString(Sect, Keyname, "", RetStr, StrSize, IniFileName)
    If Worked Then
      iNoOfCharInIni = Worked
      sIniString = Left$(RetStr, Worked)
    End If
  End If
  ReadIniFileString = sIniString
End Function

Private Function WriteIniFileString(ByVal Sect As String, ByVal Keyname As String, ByVal Wstr As String) As String
Dim Worked As Long

  iNoOfCharInIni = 0
  sIniString = ""
  If Sect = "" Or Keyname = "" Then
    MsgBox "Section Or Key To Write Not Specified !!!", vbExclamation, "INI"
  Else
    Worked = WritePrivateProfileString(Sect, Keyname, Wstr, IniFileName)
    If Worked Then
      iNoOfCharInIni = Worked
      sIniString = Wstr
    End If
    WriteIniFileString = sIniString
  End If
End Function 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T21:27:33.900

这并不令人愉快，但您可以使用 Windows API。[这是一个链接](http://www.vbforums.com/archive/index.php/t-349993.html)，[另一个来自 MS](http://support.microsoft.com/kb/75639)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T21:28:49.233

带有 [TextStream]( [http://msdn.microsoft.com/en-us/library/314cz14s(VS.85).aspx)的](http://msdn.microsoft.com/en-us/library/314cz14s(VS.85).aspx))[FileSystemObject 对象](http://msdn.microsoft.com/en-us/library/z9ty6h50.aspx)是在 VBA 中读写文本文件的通常推荐方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T09:58:11.553

[Karl Peterson 的 kpini 几乎](http://vb.mvps.org/samples/project.asp?id=kpIni)拥有您可能需要的一切：API 声明、Cinifile 类等等。我会从那个开始，然后根据口味改变它，这应该不会花很长时间。

# c# - 你在哪里存储验证逻辑？

> ID：660139
> 
> 赞同：4
> 
> 时间：2009-03-18T21:15:17.473
> 
> 标签：c#, asp.net-mvc, validation

我正在玩[MVC.Validation Toolkit](http://www.codeplex.com/MvcValidatorToolkit/Release/ProjectReleases.aspx?ReleaseId=16935)。目标是在客户端脚本和服务器代码中使用相同的验证规则。

但是，我不断为所有内容制作新的[poco](http://en.wikipedia.org/wiki/Plain_Old_CLR_Object)课程。我有一个来自 linq2entities 的类，然后我有一个从数据层传递到业​​务层，然后传递到控制器的类。我还有另一个视图模型类，仅用于将数据传递给视图。

我找不到绕过最后一堂课的方法，因为我需要在不同的时间使用不同的验证规则。

验证属性在视图模型类上定义。这似乎不是最好的方法。

有人有使用此工具包的经验吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T09:57:17.577

您可能想查看本教程，看看它是否相关 [http://www.asp.net/learn/mvc/tutorial-37-cs.aspx](http://www.asp.net/learn/mvc/tutorial-37-cs.aspx)

要点是 - 您可以使用 mvc 知道的模型类来实现 IDataErrorInfo。

# android - 如何在代码中复制 android:editable="false"？

> ID：660151
> 
> 赞同：46
> 
> 时间：2009-03-18T21:19:52.813
> 
> 标签：android, android-edittext

在布局中，您可以`EditText`通过`android:editable attribute`.

我怎样才能在代码中做到这一点？我需要根据条件使`EditText`小部件可编辑。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2010-12-03T01:41:28.663

```
editText.setFocusable(false);
editText.setClickable(false); 
```

这确保了`EditText`控件不能被选择和聚焦，所以它不能被编辑。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2012-02-14T10:56:48.347

我自己也试过这个，

要禁用编辑文本：

```
.setFocusable(false); 
```

这也将 setFocusableInTouchMode 设置为 false！

要启用编辑文本：

```
setFocusableInTouchMode(true); 
```

这也将 setFocusable 设置为 true；

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2011-06-15T00:58:14.030

最好的方法是使用这行代码：

```
textView.setKeyListener(null); 
```

文档说这种方法：

> 设置与此 TextView 一起使用的键侦听器。这可以为 null 以禁止用户输入。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-05-26T15:50:59.350

我认为[`InputFilter`](http://developer.android.com/reference/android/text/InputFilter.html)拒绝所有更改是一个很好的解决方案：

```
editText.setFilters(new InputFilter[] {
    new InputFilter() {
        public CharSequence filter(CharSequence src, int start,
            int end, Spanned dst, int dstart, int dend) {
            return src.length() < 1 ? dst.subSequence(dstart, dend) : "";
        }
    }
});
```

**编辑：** dlazar 建议（如下）更改`return`以`dst.subSequence(dstart, dend)`克服删除单词的行为。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-04-12T05:14:46.193

```
android:editable="false" 
android:inputType="none" 
```

在您的 xml 或

```
EditText mEdit = (EditText) findViewById(R.id.yourid);
mEdit.setEnabled(false); 
```

或者

```
EditText mEdit = (EditText) findViewById(R.id.yourid);
mEdit.setKeyListener(null); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2013-07-18T12:36:22.880

你可以试试这个：

```
 mEditText.setFocusable(false);
        mEditText.setClickable(false);
        mEditText.setFocusableInTouchMode(false);
        mEditText.setLongClickable(false);
        mEditText.setInputType(InputType.TYPE_NULL); 
```

这将完全禁用 EditText，如果您不希望用户打开编辑文本选项，请禁用长按。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-19T00:43:04.260

我在 EditText 类中没有看到该属性的相关方法。但是，您可以使用其他类似的东西，例如 `android:focus/setFocusable(boolean)`或创建另一个 TextView， `android:editable="false"`用于`setVisiblilty()`在可编辑视图和不可编辑视图之间切换。如果您使用`View.GONE`用户将永远不会知道有两个 EditTexts。

如果您感到雄心勃勃，您可能可以对 EditText 的`onTextChanged`侦听器做一些事情，比如让它与`setText`.

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-03-19T15:03:13.333

你试过[setText(java.lang.CharSequence, android.widget.TextView.BufferType)](http://developer.android.com/reference/android/widget/EditText.html#setText(java.lang.CharSequence,%20android.widget.TextView.BufferType))吗？它被描述为：

> 设置此 TextView 要显示的文本（请参阅 setText(CharSequence)），还设置它是否存储在可样式/可跨缓冲区中**以及是否可编辑**。

（强调我的）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2010-01-21T20:51:51.683

[发布新答案，因为我无法评论约瑟夫的答案。]

输入过滤器工作正常，但它有一个微妙的错误：在选择上键入将删除所有文本。

例如，假设您`"foo"`在`EditText`. 如果您全选（例如，通过双击它）并输入`'a'`，文本将消失。这是因为`InputFilter`将被称为：

```
filter("a", 0, 1, "foo", 0, 3); 
```

在这种情况下，建议的输入过滤器将返回空字符串（因为`src.length() < 1`is `false`），这解释了丢失的文本。

解决方案是简单地`dst.subSequence(dstart, dend)`在过滤器函数中返回。即使对于删除，这也可以正常工作。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-01-08T11:17:03.713

我猜

```
Edittext.setEnabled(false); 
```

通过代码

和

```
android:enabled="false" 
```

[通过 xml。也可以在SO](https://stackoverflow.com/questions/6384004/make-edittext-readonly)上查看这篇文章。

它们应该可以工作，您可以以编程方式再次启用 `Edittext.setEnabled(true);`

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-12-10T23:08:03.463

如果您正在创建 EditView 的新实例，我还想指出一个可以很好地工作的替代解决方案。您可以按照文档的建议覆盖方法 getDefaultEditable() 以返回 false。例如

```
EditText view = new EditText(DiscountCalculator.this) {
    public boolean getDefaultEditable() {
        return false;
    }
}; 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-05-31T17:12:41.083

我为这种情况找到的唯一解决方案是创建 2 个布局。一个是可编辑的，一个是不可编辑的。您可能需要根据各种条件创建 2 个以上的布局。将条件存储在SharedPreferences或其他方式中，重启Activity后根据条件加载相关布局。这是一个例子：

在活动的 onCreate() 中：

```
 configuration = new Configuration(this.getSharedPreferences(Configuration.SHARED_PREFERENCES_FILE_NAME, Context.MODE_PRIVATE));
    manualSettingsMode = configuration.isManualSettingsMode();
    if(manualSettingsMode){
        setContentView(R.layout.editableconfigurationsettings);
    }else {
        setContentView(R.layout.configurationsettings);
    } 
```

活动可以根据条件测试和调用函数重新启动，如下所示：

```
private void setManualEditing(){
    configuration.set_isManualSettingsMode(true);
    this.recreate();
}

private void setAutoEditing(){
    configuration.set_isManualSettingsMode(false);
    this.recreate();
} 
```

希望这可以帮助。确实必须有更好的解决方案，但这就是我一直在做的事情。理想情况下，可以在单个字段上执行此操作，而不必重新加载活动/布局。-鲍比

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2010-12-14T10:38:46.357

我认为达​​到预期效果的正确方法是：

```
mEditView.setText("my text", BufferType.NORMAL); 
```

如果要在可编辑和不可编辑之间切换，可以执行以下操作：

```
// Switch to non-editable
mEditView.setText(mEditView.getText(), BufferType.NORMAL);

// Switch back to editable
mEditView.setText(mEditView.getText(), BufferType.EDITABLE); 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2017-04-12T13:57:28.853

试试这个：

```
 mEditText.setFilters(new InputFilter[]{new InputFilter() {
        @Override
        public CharSequence filter(CharSequence source, int start, int end, Spanned dest, int dstart, int dend) {
            if (XXX) {
                return "";
            } else {
                return null;
            }
        }
    }}); 
```

# ruby-on-rails - 使用 http 基本身份验证和 restful_authentication 插件注销

> ID：660155
> 
> 赞同：9
> 
> 时间：2009-03-18T21:20:26.947
> 
> 标签：ruby-on-rails, authentication, ruby-on-rails-plugins

我在 rails 应用程序中安装了 restful_authentication 插件，它的 sessions_controller 具有这样的销毁方法：

```
def destroy
  self.current_user.forget_me if logged_in?
  cookies.delete :auth_token
  reset_session
  flash[:notice] = "You have been logged out."
  redirect_back_or_default('/')
end 
```

在应用程序控制器中，我有：

```
before_filter :login_required 
```

在 session_controller 我有：

```
skip_before_filter :login_required 
```

我的问题是，当用户使用 http 基本身份验证进行身份验证时，他/她没有注销。会话被破坏，但用户可以毫无问题地导航到受限页面。通过插件进行会话身份验证不会出现此问题。我怎样才能使这种方法摆脱基本的身份验证？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-13T15:41:05.273

在这种情况下，服务器端无法“注销”用户。当用户通过基本认证登录时，浏览器存储认证信息，并在每次请求时通过http头发送认证参数。如果用户使用基本身份验证登录，他/她将不得不关闭他/她的浏览器窗口才能注销。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-07-08T21:00:11.397

我找到了一种非常有趣的方法来克服这个问题，方法是使用会话变量来记住哪个用户已注销。这个想法是即使浏览器仍在发送身份验证数据，我们只是忽略它，因为用户选择注销。每当向浏览器发送新的登录请求时，所有身份验证数据都会被删除，因此用户可以随时重新登录。

```
class ApplicationController < ActionController::Base
  # ...

  before_filter :authenticate

  protected

  def authenticate
    authenticate_with_http_basic do |username, password|
      @current_user = User.find_by_name_and_crypted_password(username, User.digest(password))
      @current_user = nil if @current_user && session[:logged_out] == @current_user.id
      !@current_user.nil?
    end
  end

  def authenticate!
    return if @current_user
    session[:authenticate_uri] = request.request_uri
    redirect_to('/login')
  end
end 
```

然后，在事件控制器上我做：

```
class EventsController < ApplicationController
  before_filter :authenticate!, :only => [ :new, :create, :edit, :update ]
  #...
end 
```

最后我的会话控制器看起来像这样：

```
class SessionController < ApplicationController
  before_filter :authenticate!, :only => [ :create ]

  def create
    if session[:authenticate_uri]
      redirect_to(session[:authenticate_uri])
      session[:authenticate_uri] = nil
    else
      redirect_to(new_event_path)
    end
  end

  def destroy
    session[:logged_out] = @current_user.id
    redirect_to '/'
  end

  protected

  def authenticate!
    authenticate_or_request_with_http_basic("Rankings") do |username, password|
      @current_user = User.find_by_name_and_crypted_password(username, User.digest(password))
      if @current_user && session[:logged_out] == @current_user.id
        @current_user = nil
        session[:logged_out] = nil
      end
      !@current_user.nil?
    end
  end

end 
```

并且不要忘记您的路线！

```
 map.logout 'login', :controller => 'session', :action => 'create'
  map.logout 'logout', :controller => 'session', :action => 'destroy' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-06T21:37:33.833

这仅适用于 IE 6 SP1+：

```
javascript:void(document.execCommand('ClearAuthenticationCache', false)); 
```

[http://msdn.microsoft.com/en-us/library/ms536979(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms536979(VS.85).aspx)

请注意，这将清除用户当前登录的所有站点的缓存（在同一 IE 实例中）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T21:29:32.680

嗯，听起来客户端浏览器只是在缓存 HTTP 基本身份验证凭据并每次都重新发送它们。在这种情况下，您无法控制。您希望受到保护的操作需要使用适当的 before_filter 来保护 restful_authentication 插件，这应该是

```
require_authentication 
```

所以在你的控制器中你会有

```
before_filter :require_authentication 
```

HTTP 身份验证是无状态的——也就是说，服务器不跟踪经过身份验证的“会话”——因此，客户端必须每次都提供它（因此频繁的复选框“存储这些凭据”），因此服务器没有办法清除客户端凭据。这是规范的一部分。请参阅维基百科条目

[http://en.wikipedia.org/wiki/Basic_access_authentication](http://en.wikipedia.org/wiki/Basic_access_authentication)

具体来说，请查看“缺点”部分。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T21:27:07.660

我刚刚更新了 authenticated_sytem 中的 login_from_basic_auth 以读取：

```
 def login_from_basic_auth
      false
#      authenticate_with_http_basic do |login, password|
#        self.current_user = User.authenticate(login, password)
#      end
    end 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-31T14:55:21.833

解决此问题的一种方法是完全禁用“基本 http 身份验证”

但是我们需要在 Ajax 操作期间获得良好的用户体验，因此我们仅对 ajax 操作启用此身份验证

```
def login_from_basic_auth

  return false unless request.xhr?

   authenticate_with_http_basic do |login, password|
     self.current_user = User.authenticate(login, password)
   end
end 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-06-25T13:16:20.117

我知道，派对结束后，但如果你想注销，你可以渲染 401。

所以注销方法可能如下所示：

```
def logout
  render :logout, status: 401
end 
```

你平静的动作可能看起来像这样：

```
def destroy
  self.current_user.forget_me if logged_in?
  cookies.delete :auth_token
  reset_session
  redirect_to '/', status: 401, flash: "You have been logged out."
end 
```

并且浏览器将再次提出http基本身份验证

# c# - 读取大量字符并更新文本框

> ID：660159
> 
> 赞同：2
> 
> 时间：2009-03-18T21:21:11.903
> 
> 标签：c#, .net, winforms, string, character

我正在逐个字符地从流（由进程提供）中读取数据并将其添加到文本框中，以便用户查看。唯一的问题是，这是**SLOW**。用户需要查看提供给程序的数据（几乎没有延迟）。我想要一些类似终端如何处理文本的东西，它可以滚动得如此之快以至于它是模糊的。

我该如何改进呢？

作为参考，我使用的是 C# .net3.5 和 winforms。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T21:43:49.043

文本框的`Text`属性是一个字符串，而字符串是不可变的（也就是说你不能改变一个字符串）。这意味着每次添加一个字符时，您都将创建一个字符串的新副本，并在末尾添加一个字符。

例如，如果您在文本框中有 10000 个字符，您将复制 20kB 的数据以添加下一个字符。一次添加一百个字符意味着复制 2MB 的数据。

如果数据是基于行的，请使用列表而不是文本框，这样您只需在添加字符时更新最后一行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T21:38:31.097

一些代码将有助于找出瓶颈是什么。

也就是说，我会尝试这些方面的东西（我不建议复制/粘贴，因为我无法在这里测试它）：

```
// Stream s...
byte[] buffer = new buffet[bufferSize];
s.BeginRead(b, 0, buffer.Length,
    delegate
        {
            if (textBox1.InvokeRequired)
            {
                textBox1.Invoke(
                    new MethodInvoker(
                        delegate 
                        { 
                            textBox1.Text = Encoding.Unicode.GetString(b); 
                        }));
            }
            else
            {
                textBox1.Text = Encoding.Unicode.GetString(b);
            }
         }, null); 
```

# python - 如何在 Python 中列出目录（非递归）中的所有 tga 文件？

> ID：660160
> 
> 赞同：6
> 
> 时间：2009-03-18T21:21:30.547
> 
> 标签：python

如何在 Python 中列出目录（非递归）中的所有 tga 文件？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-18T21:27:56.303

如果您基于文件扩展名进行操作，则可以执行以下操作：

```
import os
directory = "C:/"
extension = ".tga"
list_of_files = [file for file in os.listdir(directory) if file.lower().endswith(extension)] 
```

显然，如果您可以保证文件的大小写，则可以省略 lower() 。还有优秀的 path.py ( [http://pypi.python.org/pypi/path.py](http://pypi.python.org/pypi/path.py) ) 模块。

如果您不知道文件扩展名，您可以使用 PIL ( [http://www.pythonware.com/products/pil/](http://www.pythonware.com/products/pil/) ) 之类的东西通过解码文件来检测文件类型。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-18T21:25:51.207

```
import glob, os
for filename in glob.glob(os.path.join(yourPath, "*.tga"))
   print(filename) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-04-29T21:38:56.143

以下示例使用`filter`，它提供了一个优雅的解决方案，如下所示：

```
import os
files = filter(lambda x: x.endswith('.tga'), os.listdir(DIR)) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T21:25:29.117

```
 >>> import os
>>> for file in [tga for tga in os.listdir(directory) if tga.endswith(".tga")]:
>>>     print file 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-05-23T11:12:15.037

我的 Targa/Vista 经常有 .vst 和 .tga，有时还有其他扩展名：

```
import os
from glob import glob
import PIL

filenames = []
for filename in glob(os.path.join(dirname, "*.*")):
    try:
        img = PIL.Image(filename)
        if img.format == "TGA":
            filenames.append(filename)
    except IOError: // from PIL if not recognised
        pass 
```

# .net - 如何找出在 .NET Windows 窗体中具有焦点的控件？

> ID：660173
> 
> 赞同：22
> 
> 时间：2009-03-18T21:24:11.163
> 
> 标签：.net, vb.net, winforms, controls, focus

如何找出在[Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)中具有焦点的控件？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-03-18T21:26:05.293

[`Form.ActiveControl`](http://msdn.microsoft.com/en-us/library/system.windows.forms.containercontrol.activecontrol.aspx)可能是你想要的。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2012-03-09T12:52:50.633

请注意，在使用层次结构时，一次调用 ActiveControl 是不够的。想象：

```
Form
    TableLayoutPanel
        FlowLayoutPanel
            TextBox (focused) 
```

`(formInstance).ActiveControl`将返回对 的引用`TableLayoutPanel`，而不是`TextBox`

所以使用这个（完全披露：改编自[这个 C# 答案](https://stackoverflow.com/a/439606/15639)）

```
 Function FindFocussedControl(ByVal ctr As Control) As Control
    Dim container As ContainerControl = TryCast(ctr, ContainerControl)
    Do While (container IsNot Nothing)
      ctr = container.ActiveControl
      container = TryCast(ctr, ContainerControl)
    Loop
    Return ctr
  End Function 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-04-08T19:10:44.090

在 C# 中，我这样做：

```
 if (txtModelPN != this.ActiveControl)
            txtModelPN.BackColor = Color.White; 
```

txtModelPN 是一个文本框，我在 enter 和 mouseEnter 上突出显示，在 Leave、MouseLeave 上取消突出显示。除非它是当前控件，否则我不会将背景设置回白色。

VB等价物是这样的

```
IF txtModelPN <> Me.ActiveControl Then
   txtModelPN.BackColor = Color.White
End If 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2013-08-27T11:40:30.877

您可以使用窗体的 ActiveControl 属性并可以使用该控件。

```
me.ActiveControl 
```

或者

```
Form.ActiveControl 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-01-21T20:25:56.430

您可以使用它通过 Control Name 查找。

```
 If DataGridView1.Name = Me.ActiveControl.Name Then
        TextBox1.Visible = True
    Else
        TextBox1.Visible = False
    End If 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-08-09T19:16:50.913

我使用了以下内容：

```
Private bFocus = False
Private Sub txtUrl_MouseEnter(sender As Object, e As EventArgs) Handles txtUrl.MouseEnter
    If Me.ActiveControl.Name <> txtUrl.Name Then
        bFocus = True
    End If
End Sub

Private Sub txtUrl_MouseUp(sender As Object, e As MouseEventArgs) Handles txtUrl.MouseUp
    If bFocus Then
        bFocus = False
        txtUrl.SelectAll()
    End If
End Sub 
```

我只在 MouseEnter 上设置变量以提高魔力

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-18T21:36:43.473

这些方面的东西：

```
Protected Function GetFocusControl() As Control
    Dim focusControl As Control = Nothing

    ' Use this to get the Focused Control: 
    Dim focusHandle As IntPtr = GetFocus()
    If IntPtr.Zero.Equals(focusHandle) Then          
      focusControl = Control.FromHandle(focusHandle)
    End If

    ' Note that it returns NOTHING if there is not a .NET control with focus 
    Return focusControl
End Function 
```

我认为这段代码来自 windowsclient.net，但已经有一段时间了......

# vb.net - 从 VB.net 中的 GET/POST 请求加载结果

> ID：660174
> 
> 赞同：2
> 
> 时间：2009-03-18T21:24:53.220
> 
> 标签：vb.net, api, post, get

我想开发一个使用在线 API 的程序，带有 GET 和 POST 请求，我想知道如何在程序中发出请求（用户看不到网页），然后将结果下载到程序中我可以解析它们

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T21:29:44.940

你在找[`WebRequest`](http://msdn.microsoft.com/en-us/library/system.net.webrequest.aspx)课。此示例改编自 msdn 文档：

```
Dim request As WebRequest = WebRequest.Create("http://www.example.com/example.html")
' Get the response.
Dim response As HttpWebResponse = CType(request.GetResponse(), HttpWebResponse)
' Get the stream containing content returned by the server.
Dim dataStream As Stream = response.GetResponseStream()
' Open the stream using a StreamReader for easy access.
Dim reader As New StreamReader(dataStream)
' Read the content.
Dim responseFromServer As String = reader.ReadToEnd() 
```

# php - php mcrypt_encrypt 到 C/C++/MFC 等价

> ID：660175
> 
> 赞同：0
> 
> 时间：2009-03-18T21:24:54.330
> 
> 标签：php, c++, mfc, encryption, cryptography

我有一个 PHP 脚本，它为用 c++/MFC 编写的应用程序生成产品密钥。产品密钥是发给用户的电子邮件，用户将其复制并粘贴到我的应用程序中。

```
function EncryptData( $data ) {
$key  = "abcdefghijklmnopqrstuvwxyz";
// This encrypt method is described here 
// http://ca3.php.net/mcrypt
$val     = $data ; 
$ky      = $key ; 
$mode    = MCRYPT_MODE_ECB;   
$enc     = MCRYPT_RIJNDAEL_128;
$val     = str_pad($val, (16*(floor(strlen($val) / 16)+(strlen($val) % 16==0?2:1))), chr(16-(strlen($val) % 16)));
$encript = mcrypt_encrypt($enc, $ky, $val, $mode, mcrypt_create_iv( mcrypt_get_iv_size($enc, $mode), MCRYPT_DEV_URANDOM));
$hex     = bin2hex( $encript ) ;
$ret     = strtoupper( $hex );
return $ret; } 
```

我正在寻找一种在 C++/MFC 中解码上述函数的输出的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T21:54:47.080

[libmcrypt](http://mcrypt.sourceforge.net/)实际上是一个 C 库

# c# - 为什么在 C# 中顺序对于静态初始化很重要？

> ID：660197
> 
> 赞同：8
> 
> 时间：2009-03-18T21:29:06.970
> 
> 标签：c#, language-theory

此代码在 C# 中具有明确定义的不工作行为：

```
class Foo
{
    static List<int> to = new List<int>( from ); // from is still null
    static IEnumerable<int> from = Something();
} 
```

*注意：我不是在问如何修复该代码，因为[我已经知道如何做到这一点](https://stackoverflow.com/questions/185384/order-of-static-constructors-initializers-in-c)*

这样做的理由是什么？C# 已经进行了运行时检查以检测对静态成员的首次访问。为什么不将此扩展到每个成员的事物并让它们按需运行，或者更好地让编译器在编译时找出顺序？

顺便说一句：我认为同样的问题（或几乎相同的问题）也适用于非静态成员。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-18T21:43:11.587

初始化器只是一个语法糖。编译器在编译您的类时将该代码放入 .cctor 中，并按照它们在代码中的排列顺序推送它们。

它不运行任何检查，因为它没有意义。你仍然可以有初始化周期，所以它无论如何都行不通。

如果您有兴趣，我前段时间在博客上写过：

*   [更多关于内联初始化](http://kozmic.pl/archive/2008/03/13/more-on-inline-initialization.aspx)
*   [更多关于内联初始化（答案）](http://kozmic.pl/archive/2008/03/16/more-on-inline-initialization-answer.aspx)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-19T00:23:27.957

由于其他静态类的副作用，我可以根据初始化顺序设想程序员。你和我都知道依赖副作用是不好的做法，但这不一定是非法的。

考虑这样的事情：

```
class Foo
{
    static string header = Bar.GetHeader();
    static string version = Bar.GetVersion();
} 
```

并`Bar.GetVersion`假设`Bar.GetHeader`已被调用。如果编译器可以随意更改初始化顺序，那么程序员将无法保证初始化顺序。

丑陋，理所当然，但完全合法。如果您想象二阶效果（即称为静态方法，它们本身依赖于具有副作用的类），您会发现编译器不可能可靠地重新排列任何东西，就像编译器（通常）不可能重新排列静态构造函数中函数调用的顺序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T21:33:01.720

我认为您需要使用的是静态构造函数。

像这样

```
class Foo
{
    static List<int> to;
    static IEnumerable<int> from;

    static Foo()
    {
        from = Something();
        to = new List<int>(from);
    }
} 
```

至于为什么 C# 不在第一次访问时执行此操作，我只是认为当有其他替代方案可以明确发生的情况时，不需要这种复杂性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T21:34:36.083

C# 执行运行时检查以检测对类的首次访问，但不会重新排序类中的静态初始化。

静态字段从上到下初始化，然后是静态构造函数从上到下初始化。更改字段的顺序或创建静态构造函数并从 tehre 初始化字段。

请参阅C# 规范中的[变量初始化程序或有关初始化程序的](http://msdn.microsoft.com/en-us/library/aa645757(VS.71).aspx)[这篇文章](http://www.yoda.arachsys.com/csharp/beforefieldinit.html)。此外，[C# 中静态构造函数/初始化程序的问题顺序](https://stackoverflow.com/questions/185384/order-of-static-constructors-initializers-in-c)是相关的。

# java - 仅在尚未运行时启动 Java 程序

> ID：660205
> 
> 赞同：17
> 
> 时间：2009-03-18T21:32:23.767
> 
> 标签：java, mutual-exclusion

我需要在我的 Java 应用程序中启动 1-3 个外部程序，这些程序的路径由用户定义。我有几个要求：

1.  如果程序已经在运行，我不希望它执行

2.  我不希望任何程序从我的 Java 应用程序中窃取焦点

3.  我不在乎他们中的任何一个是否无法启动。他们只需要默默地失败。

到目前为止，这是我想出的：

```
ProcessBuilder pb = new ProcessBuilder(userDefinedPath1);
try {
    pb.start();
}
catch (Exception e) {
    // Something went wrong, just ignore
} 
```

然后我用其他两条路径再重复 3 次。这就像我期望的那样开始并且很好地满足了我的第三个要求，但前两个失败了。

做这个的最好方式是什么？

编辑：

1.  我无法控制这些其他应用程序。他们是第三方。此外，它们可以随时由用户手动启动或停止。

2.  我知道可执行文件的*确切*名称（例如“blah.exe”），它们*总是*相同的，但可执行文件的路径不一定是。

3.  批处理文件包装器在这里不可行。

4.  其他应用程序*不是*Java 应用程序，只是普通的旧 Windows 可执行文件。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2017-08-14T19:36:25.020

为了避免潜在的锁定文件/崩溃问题，可以启动服务器并捕获端口冲突。这些服务器在系统关闭时自动停止（即使在崩溃之后）

```
public static ServerSocket ss;

public static void main (String[] args) {

    ss = null;

    try {
        ss = new ServerSocket(1044);
    } catch (IOException e) {
        System.err.println("Application already running!");
        System.exit(-1);
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-18T22:16:09.837

我猜你无法控制其他两个应用程序......如果你这样做了，这不会太糟糕 - 你可以让他们听一个套接字，看看你来的时候套接字是否可用向上。

下一个解决方案实际上可能与语言无关。您可以通过批处理文件包装器管理整个系统。编写一个批处理文件，启动时创建文件，停止时删除文件。Unix 系统经常使用这种技术——他们经常将文件称为锁定文件。

如果只有您的应用程序会启动这些其他应用程序，那么您可以简单地跟踪您是否已启动它，所以我猜这是不可能的，或者您不会问，所以我假设用户可能已经通过其他一些机制启动了这些程序。

如果您无法控制其他应用程序的启动，甚至无法编写批处理文件来启动它们，那么您就无法做您想做的事情（注意，应用程序必须始终使用批处理文件，即使用户手动启动它们）。

我只是最后的努力可能是获取进程状态并解析它，但你必须确切地知道其他应用程序在 PS 中被称为什么，这并不是微不足道的。此外，所有 Java 应用程序在大多数进程状态打印输出中往往具有相同的确切签名，这可能会使其无用。

问题是，如果其中一个程序是在您的应用程序之外启动的，您几乎无法识别该事实，除非您碰巧知道它是确切的进程状态签名，即使那样它也是不稳定的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-08-02T04:31:11.350

## 我提供了两个答案，一个针对 Linux：

如果程序已经在运行，不要运行它，把它放在一个名为 Main.java 的文件中

```
import java.io.File;
import java.io.RandomAccessFile;
import java.nio.channels.FileChannel;
import java.nio.channels.FileLock;

class JustOneLock {
  FileLock lock;
  FileChannel channel;

  public boolean isAppActive() throws Exception{
    File file = new File(System.getProperty("user.home"),
            "FireZeMissiles1111" + ".tmp");
    channel = new RandomAccessFile(file, "rw").getChannel();

    lock = channel.tryLock();
    if (lock == null) {
      return true;
    }
    Runtime.getRuntime().addShutdownHook(new Thread() {
      public void run() {
        try {
          lock.release();
          channel.close();
        } catch (Exception e) {
          e.printStackTrace();
        }
      }
    });
    return false;
  }
}

public class Main {
  public static void main(String[] args)throws Exception {
    JustOneLock u = new JustOneLock();

    if (u.isAppActive()) {
      System.out.println("Already active, stop!");
      System.exit(1);
    }
    else {
      System.out.println("NOT active... Do hard work for 5 seconds.");
      try{Thread.sleep(5000);}catch(Exception e){}
    }
  }
} 
```

编译并运行它。然后打开一个新终端并尝试在另一个正在运行时再次运行它，但它不会。

**Windows的另一个答案**

如果该程序已在当前系统上运行，则该程序将不允许自己运行。这仅适用于 Windows 系统。

```
import java.io.*;
import java.util.prefs.Preferences;

public class JavaApplication3 {

    public static void main(String[] args){
        if(isRunning()){
            System.out.println("Two instances of this program cannot " +
                    "be running at the same time.  Exiting now");
        }
        else{
            onStart();
            epicHeavyWorkGoesHere();
            onFinish();
        }
    }
    public static void epicHeavyWorkGoesHere(){
        try {
            Thread.sleep(5000);
        } catch (InterruptedException ex) {}
    }
    public static void onStart(){
        Preferences prefs = Preferences.systemRoot().node("JavaApplication3");
        prefs.put("RUNNINGPID", getCurrentPID());
    }
    public static void onFinish(){
        Preferences prefs = Preferences.systemRoot().node("JavaApplication3");
        prefs.put("RUNNINGPID", "");
    }
    public static boolean isRunning(){
        Preferences prefs = Preferences.systemRoot().node("JavaApplication3");

        if (prefs.get("RUNNINGPID", null) == null || prefs.get("RUNNINGPID", null).equals(""))
            return false;

        if (isProcessIdRunningOnWindows(Integer.parseInt(prefs.get("RUNNINGPID", null))))
            return true;
        return false;
    }
    public static String getCurrentPID(){
        //This function is designed to get the PID from the windows system, it may
        //not work for Linux or Mac.  You'll have to acquire a suitable getCurrentPID function
        try{
            java.lang.management.RuntimeMXBean runtime = java.lang.management.ManagementFactory.getRuntimeMXBean();
            java.lang.reflect.Field jvm = runtime.getClass().getDeclaredField("jvm");
            jvm.setAccessible(true);
            sun.management.VMManagement mgmt = (sun.management.VMManagement) jvm.get(runtime);
            java.lang.reflect.Method pid_method = mgmt.getClass().getDeclaredMethod("getProcessId");
            pid_method.setAccessible(true);
            return pid_method.invoke(mgmt) + "";
        }
        catch(Exception e){
            throw new RuntimeException("Cannot get the current PID");
        }
    }
    public static boolean isProcessIdRunningOnWindows(int pid){
        //This Function only works for windows, if you want it to work on linux
        //you will have to go find a replacement method that takes the processID
        //as a parameter and spits out a true/false if it is running on the system.
        try {
            Runtime runtime = Runtime.getRuntime();
            String cmds[] = {"cmd", "/c", "tasklist /FI \"PID eq " + pid + "\""};
            Process proc = runtime.exec(cmds);

            InputStream inputstream = proc.getInputStream();
            InputStreamReader inputstreamreader = new InputStreamReader(inputstream);
            BufferedReader bufferedreader = new BufferedReader(inputstreamreader);
            String line;
            while ((line = bufferedreader.readLine()) != null) {
                if (line.contains(" " + pid + " ")){
                    return true;
                }
            }
            return false;
        }
        catch (Exception ex) {
            throw new RuntimeException("Cannot run the tasklist command to query if a pid is running or not");
        }
    }
} 
```

上述代码的策略是保留上次运行的 PID，如果发现该 PID 在系统上运行，则不要启动。如果完成，请重置。

首选项存储在 Windows 注册表中`HKEY_LOCAL_MACHINE\SOFTWARE\JavaSoft\Prefs`

我建议不要使用文件锁定来确保 java 应用程序不会同时运行两次，因为如果程序崩溃或永远挂起并被杀死，那么锁就会处于不一致的状态，甚至可能在重启后仍然存在会导致问题，因为程序如何知道仍在运行的程序与已崩溃并保持锁定文件锁定的程序之间的区别？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2012-02-01T15:24:34.120

这就是我为解决问题所做的，这是使用纯 java 的简单解决方案：

请注意，如果以下代码崩溃一次，它就会处于不一致的状态，并且无法处理挂起或崩溃的程序。

```
public void main(String[] args){
    if(isRunning()){
        JOptionPane.showMessageDialog(this, "2 instances of this program cannot be running at the same time. \n Exiting now");
        System.exit(0);
    }else{
        onStart();
    }
}    

public final void onStart(){
    Preferences prefs;
    prefs = Preferences.userRoot().node(this.getClass().getName());
    prefs.put("RUNNING", "true");
}

public final void onFinish(){
    Preferences prefs;
    prefs = Preferences.userRoot().node(this.getClass().getName());
    prefs.put("RUNNING", "false");
}

public boolean isRunning(){
    Preferences prefs;
    prefs = Preferences.userRoot().node(this.getClass().getName());
    return prefs.get("RUNNING", null) != null ? Boolean.valueOf(prefs.get("RUNNING", null)) : false;
}

private void formWindowClosing(java.awt.event.WindowEvent evt) {
    onFinish();
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T23:31:48.253

如果我在基于 unix 的系统上处理这个问题，我会很想编写一个本机函数来收集进程信息并尝试启动外部应用程序。这与 Java 的精神背道而驰，但是您尝试收集的信息类型和应用程序启动的控制在 JVM 之外。

我对 Windows 编程的了解不足以为您指明正确的方向，但我想您可以使用 .NET 语言或纯 C++ 访问 Windows API 调用，这可以帮助您满足第二个标准。也许您可以更改问题以吸引可以提供帮助的非 Java 开发人员。

* * *

编辑：

查看 Windows API 的[Shell 执行函数](http://msdn.microsoft.com/en-us/library/bb762153(VS.85).aspx)。出现 SW_SHOWNOACTIVATE 选项以允许当前窗口保持活动状态。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-18T23:35:09.413

请参阅[检查程序或进程是否正在运行 (Windows)](http://www.rgagnon.com/javadetails/java-0610.html)

此提示将检测给定程序是否正在运行。好的，由于使用了 vbscript，它并不漂亮，但它很容易实现。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-05-04T22:55:28.890

您可以对所有系统做一件小事，这包括文件锁定功能。

在程序运行时首先，创建一个文件并锁定它。将其命名为 lockfile 之类的名称。生成时间戳并加密。把这个写进去。

在同一程序运行首先，检查是否存在锁定文件。尝试锁定它。忽略此文件被锁定的可能性。读取并检查时间戳。如果时间戳非常小（例如 1 小时前），请尝试运行该程序。您将错误地写回时间戳，因为它已被锁定。在这种情况下，假设有一个程序已经打开。

在程序退出时，删除此锁定文件。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-23T07:43:21.103

在 Windows XP（专业版？）上，您可以启动命令“任务列表”并解析输出以确定进程是否正在运行。您可以使用线程来避免任何焦点问题（我认为）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-07-14T08:29:18.347

您可以使用 jps 来了解正在运行的 java 程序状态。jps 是 javac、java 等 java 工具之一，

# java - 在 Flex 中调用 Java 函数

> ID：660213
> 
> 赞同：1
> 
> 时间：2009-03-18T21:34:33.540
> 
> 标签：java, apache-flex, blazeds, resultevent

现在我正在尝试了解 Flex 如何与 Java 一起工作（Flex -> BlazeDS -> Java）。我尝试按照[本](http://livedocs.adobe.com/blazeds/1/blazeds_devguide/help.html?content=lcoverview_4.html)教程进行操作，一切正常，我只是不明白为什么我们需要以这种方式调用 java 函数：

```
<mx:Script>
    <![CDATA[
        import mx.rpc.events.FaultEvent;
        import mx.rpc.events.ResultEvent;

        // Send the message in response to a Button click.
        private function echo():void {
            var text:String = ti.text;
            remoteObject.echo(text);
        }

        // Handle the recevied message.
        private function resultHandler(event:ResultEvent):void {
            ta.text += "Server responded: "+ event.result + "\n";
        }

        // Handle a message fault.
        private function faultHandler(event:FaultEvent):void {
            ta.text += "Received fault: " + event.fault + "\n";
        }
    ]]>
</mx:Script> 
```

为什么我们需要使用 Event/ResultEvent 来调用 Java 函数。为什么不只是做这样的事情：

```
EchoService.echo("hi") 
```

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T22:11:56.010

它是为了能够处理服务器延迟和其他异常情况。如果您只是调用该方法，您的 UI 将在服务器传输期间冻结。通过回调，UI 可以继续处理事件，直到接收到数据并准备好查看。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T19:11:50.847

如果服务器以某种方式出错，则根据成功或错误拥有两种不同的方法将使您的程序做出不同的反应。

# wcf - 用于 MetaWeblog 的 WCF

> ID：660241
> 
> 赞同：2
> 
> 时间：2009-03-18T21:44:05.233
> 
> 标签：wcf, web-services, api, blogs, metaweblog

我正在尝试找到一个使用 WCF 服务实现 MetaWeblog API 的非常好的示例。我似乎无法清醒头脑并想出一个干净的方法来做到这一点。任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-19T15:26:59.940

这似乎是一个合理的开始，[wfc-for-metaweblog](http://blogs.msdn.com/clemensv/archive/2009/04/03/xml-rpc-with-wcf-updated.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-19T15:20:09.563

不完全与 WCF 相关，但[octalforty Syndication](http://code.google.com/p/octalforty-syndication/)有一个很好的类型安全[IMetaWeblogService](http://code.google.com/p/octalforty-syndication/source/browse/trunk/octalforty.Syndication.Blogging/MetaWeblog/IMetaWeblogService.cs)定义和所有相关对象，您可以将其用作进一步研究的基础。

# ruby-on-rails - 两个 Rails 应用程序共享一个模型文件夹

> ID：660247
> 
> 赞同：22
> 
> 时间：2009-03-18T21:47:59.670
> 
> 标签：ruby-on-rails

我有两个在同一个数据库上运行的 Rails 应用程序，一个运行客户端，一个提供管理界面。

除了少量差异外，这两个应用程序都定义了完全相同的模型。将模型中的绝大多数更改复制到两个应用程序上对我来说很烦人。

两个应用程序使用相同模型信息的一种方法是将模型文件夹从一个应用程序符号链接到另一个应用程序，但由于代码差异很小（例如客户端上的额外验证），我不能这样做。

有没有一种简单的方法可以消除差异，以便将通用代码保留在一个地方？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T20:38:51.717

svn:externals 或 git 子模块绝对是解决这种情况的方法。

当然，您希望能够在两个应用程序中测试它们，因此您也应该分享您的模型测试或规格。但请记住，模型通常依赖于插件，因此您也需要共享您的插件文件夹。而且您可能想要相同的 gems 和相同版本的 Rails，所以最好的选择是共享所有供应商。哦，有时你在 lib 中的代码会修改你的模型，所以你会想要分享它。哦，一定要在环境文件中共享任何自定义配置。

并且您需要设置一个持续集成服务器来在两个应用程序上运行您的测试套件，以防万一您的主应用程序中的模型层更改破坏了您的其他应用程序。

但我的意思是，一旦所有这些都解决了，svn:externals 或 git 子模块绝对是解决这种情况的方法。

**更新** *（几年后）*

Rails 引擎可能是目前在多个应用程序之间可靠地共享模型代码的最佳选择。它们可以被宝石化并包含在`Gemfile`每个应用程序中。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-01-21T20:25:26.980

为什么不以 OOP 方式进行，例如创建一个单独的基类（在单独的目录中），然后在两个项目中从它**继承**，所以差异在于继承的类。

所以你有了

```
class BaseModel < ActiveRecord::Base 
```

在“common”子目录中，然后你有

```
class AdminBaseModel < Common::BaseModel 
```

在管理项目和

```
class UserBaseModel < Common::BaseModel 
```

你可能需要

```
set_table_name "basemodel" 
```

所以 Rails 知道要打开哪个表。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-19T03:44:11.297

我在一个有类似问题的项目上工作，我们使用[svn:externals](http://svnbook.red-bean.com/en/1.0/ch07s03.html)在两个应用程序之间共享模型代码。

基本上，您在一个 svn 项目中拥有模型目录，并在另一个项目中使用外部模型来共享代码。`svn up`您可以在任一项目中编辑代码，当您在另一个项目中运行时，它将被更新。

就 Rails 和您的构建脚本而言，这两个模型目录是完全独立的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-09-15T15:49:14.377

您可以将一个 rails 项目视为 gem，然后您可以通过将模型路径添加到其加载路径来在其他 rails 项目中使用它。

这是一个例子，我想你可以得到它，虽然它是用中文写的。 [http://mvj3.github.com/2011/09/13/multiple_rails_apps_sharing_models_folder/](http://mvj3.github.com/2011/09/13/multiple_rails_apps_sharing_models_folder/)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-01T18:27:13.887

是的，对模型目录进行符号链接，然后为每个实例添加一个环境变量到您的 environment.rb 中。然后，您的模型可以知道哪个实例正在使用它，并包含其他验证或不包含什么。

在 environment.rb 中：

```
APP_INSTANCE = "app1" 
```

在模型.rb

```
validates_length_of :name, :within => 3..100, :if => :is_app_one?

def is_app_one?
    APP_INSTANCE == "app1"
end 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-19T03:32:53.837

只是好奇 - 为什么不拥有一个具有两种模式的应用程序？

我有一个应用程序，它看起来像是十几个不同应用程序之一，品牌不同，功能也不同，具体取决于您进入哪个 URL 以及您的登录身份。我的用户有角色，我向 ActiveRecord::Base 添加了一个方法，该方法为您提供当前用户。因此我可以做类似的事情：

```
MAX_VOLUME = current_user.admin? ? 11 : 10
validates_inclusion_of :volume, :in => 0..MAX_VOLUME # Admins can go to 11! 
```

在视图中，像这样的东西：

```
<%= render :partial => common_tabs %>
<%= render :partial => admin_tabs if @current_user.admin? %> 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-02-02T14:29:05.883

为什么不使用组合而不是继承？

我有一个类似的问题：一个管理应用程序和一个公共应用程序，具有相同的数据库，并且对于一个应用程序或另一个应用程序的某些模型只有一些特定的方法。

我目前正在考虑我可以创建一个包含许多模块的公共位置，我可以在其中放置我的方法。然后，当我需要它们时，我会在每个应用程序中包含我需要的模块（在模型、控制器、帮助器中……）。这个地方可以在 lib 目录中（使用 git 子模块或 svm 外部更新）或在 gem 中（使用 Bundler 或类似工具更新）。

你怎么看待这件事 ？

# ruby-on-rails - Rails 远程表单不发布表单参数

> ID：660258
> 
> 赞同：0
> 
> 时间：2009-03-18T21:55:03.790
> 
> 标签：ruby-on-rails, post, parameters, remote-forms

我的问题涉及以下带有远程表单的部分视图：

```
 <% remote_form_for :phone_number, :url => {:controller => "edit", :action => "add_phone_number" }, :update => "phone_number_div" do |form| %>
    <%= form.text_field :number%>
    <%= form.select :type, PhoneNumber::PHONE_TYPE%>
    <%= submit_tag "Add" %>     
 <% end %> 
```

当`Add`按钮被按下时，`add_phone_number`动作被发送到，但表单值不在 params 变量中。

有谁知道为什么会这样？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T14:08:18.567

如果表单元素是 DOM 中非法位置的子节点（例如在 TR 中（而不是在 TD 中），则大多数浏览器不会在帖子中传递表单值。

我曾经遇到过这个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T23:12:28.643

您可能希望为表单提供某种方法。

```
<% remote_form_for :phone_number, :method => :post, :url => { :controller => "edit", :action => "add_phone_number" }, :update => "phone_number_div" do |form| %> 
```

不要挑剔，但如果您正在使用`remote_for_form`，您希望有一个资源来使用它。因此，您可能希望用您在控制器中实例化的实例变量进行`:phone_number`替换`@phone_number`。这使代码更好一点，也符合 Rails 的约定。

对于像这些[调试器](http://www.sitepoint.com/article/debug-rails-app-ruby-debug/)这样的问题也是你的朋友

# .net - .Net Winforms 判断是否按下了退出按钮

> ID：660259
> 
> 赞同：0
> 
> 时间：2009-03-18T21:55:18.797
> 
> 标签：.net, winforms, validation, controls

我正在使用一些在发生任何事情时捕获验证的控件——包括当用户按下退出按钮时。有没有办法判断退出按钮是否被按下？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-18T22:02:44.613

如果您指的是窗口右上角的关闭按钮，则需要使用 FormClosing 事件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-18T22:10:52.707

为了补充 Ray 所说的内容，您可以检查表单的 FormClosing 事件。

具体来说，查看 FormClosingEventArgs 的 CloseReason 属性。如果用户单击表单右上角的“x”，则此属性的值为 UserClosing。

但是，如果您有自己的关闭表单的关闭按钮，则此属性将具有相同的值，因此您无法判断用户如何关闭表单。

我所做的是在我的表单中添加一个名为 _closeButtonClicked 的 bool 字段，如果单击了我的关闭按钮，则将其设置为 true。在我的 FormClosing 事件中，我检查了 e.CloseReason == UserClosing 和 _closeButtonClicked。

这对我有用，但我想知道是否有更好的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T22:02:56.343

假设退出按钮是指右上角的小“X”按钮；不。也就是说，单击按钮会直接触发 onClose 事件，而无需任何中间按钮按下或可以绑定的事件。进入 OnClose 后，您可以尝试弄清楚您是如何到达那里的，但没有“中间”步骤。我建议只是从关闭事件中调用所有验证；如果验证失败，您可以通过 onClose 事件参数取消关闭，然后从那里开始工作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T22:10:23.377

谢谢大家。找到了一个完全避免这种情况的解决方案。

我试图使用下拉菜单的 Infragistics LimitToList 功能。但是，该功能会阻止所有其他事件触发 - 包括表单关闭！作为一种解决方法，我正在考虑检查在 LimitToList 功能中按下的退出按钮，然后禁用 LimitToList 以允许退出。所以我开始检查 ActiveControl、yada、yada，但遇到了很多问题（如果打开另一个表单会发生什么，等等）

所以我放弃了 LimitToList 功能，并使用标准验证方法编写了我自己的验证事件。为什么有人写一个先于表单关闭的功能，这超出了我的理解！

# django - 多对多关系的 Django 管理表单

> ID：660260
> 
> 赞同：21
> 
> 时间：2009-03-18T21:55:24.567
> 
> 标签：django, django-models, django-admin

我在 2 个表用户和域之间有多对多的关系。我在 Domains 类中定义了这种关系。因此，在管理界面中，当我查看域时，我会看到用户。但是当我查看用户时，我看不到域。我怎样才能做到这一点。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2012-07-06T03:08:22.023

我知道这是一个较旧的线程，但这是谷歌上出现的第一个结果，我认为有必要提供更好的答案。

通过[这个 django 错误报告](https://code.djangoproject.com/ticket/897#comment:28)，我找到了让您的 ManyToManyField 出现在两个模型上的最佳方法：

```
class Test1(models.Model):
    tests2 = models.ManyToManyField('Test2', blank=True)

class Test2(models.Model):
    tests1 = models.ManyToManyField(Test1, through=Test1.tests2.through, blank=True) 
```

我自己测试过，对结果非常满意。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2011-04-11T17:23:16.597

唯一的内置方法是通过 InlineModelAdmin，但您可以使用自定义 ModelForm 和您的 User ModelAdmin 来为此创建字段。请参阅下面的代码以简化设置（假设`users = ManyToManyField(related_name='domains')`）。

```
### yourapp/admin.py ###

from django import forms
from django.contrib import admin
from django.contrib.auth.models import User
from django.utils.translation import ugettext_lazy as _
from django.contrib.admin.widgets import FilteredSelectMultiple

from .models import Domain

class DomainAdmin(admin.ModelAdmin):
    filter_horizonal = ('users',)

class UserAdminForm(forms.ModelForm):
    domains = forms.ModelMultipleChoiceField(
        queryset=Domain.objects.all(), 
        required=False,
        widget=FilteredSelectMultiple(
            verbose_name=_('Domains'),
            is_stacked=False
        )
    )

    class Meta:
        model = User

    def __init__(self, *args, **kwargs):
        super(UserAdminForm, self).__init__(*args, **kwargs)

        if self.instance:
          self.fields['domains'].initial = self.instance.domains.all()

    def save(self, commit=True):
        user = super(UserAdminForm, self).save(commit=False)

        user.domains = self.cleaned_data['domains']

        if commit:
            user.save()
            user.save_m2m()

        return user

class UserAdmin(admin.ModelAdmin):
    form = UserAdminForm

admin.site.register(Domain, DomainAdmin)
admin.site.unregister(User)
admin.site.register(User, UserAdmin) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-19T01:38:31.567

我认为您正在寻找的是[InlineModelAdmin](http://docs.djangoproject.com/en/dev/ref/contrib/admin/#inlinemodeladmin-objects)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-07-10T21:02:02.517

对于仍然遇到此问题的人，可能值得检查<a href="https://github.com/kux/django-admin-extend" rel="nofollow">https://github.com/kux /django-admin-扩展

它提供了一种机制，用于在已经由其他应用程序定义的 ModelAdmins 中注入双向多对多字段。

# c# - 在 C# 中使用 IronRuby 的“未知方法”

> ID：660267
> 
> 赞同：0
> 
> 时间：2009-03-18T21:57:23.097
> 
> 标签：c#, ruby, ironruby

嗨，晚上好，希望有人能提供帮助。

我正在尝试获得某种脚本支持。我有以下代码，它执行一个 ruby​​ 方法并返回结果。但是，它会从 IronRuby 本身返回“未找到方法错误”。

```
var engine = IronRuby.Ruby.CreateEngine();
returnvalue = engine.Operations.InvokeMember(instance, method, arg).ToString(); 
```

我正在运行以下 ruby​​ 代码作为测试：

```
class Plotlight
def get_message(a)
res = "Hello- from Ruby " << a
res
end

def swapcase(a)
res = a.downcase
res
end
end 
```

现在，运行该方法时`get_message("something")`，一切正常。但是，当运行引用标准库的东西时（本例中为swapcase），它将返回错误

```
$exception {"undefined method `downcase' for fooBAR:ClrString"} System.Exception {System.MissingMethodException} 
```

通过运行代码`ir.exe`没有任何问题。

我是否需要参考图书馆，如果需要，我该怎么做？

希望有人能帮忙！非常感谢你。

亲切的问候，
马可

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T22:04:56.527

Ruby 字符串具有与 CLR 字符串不兼容的语义。特别是，它们是可变的。Ruby 字符串和 CLR 字符串之间的互操作尚未完成，因此现在您需要将 CLR System.String 显式转换为 Ruby 字符串对象——无论是在 C# 代码中还是在 Ruby 代码中。

最简单的解决方案是像这样定义 swapcase：

```
def swapcase(a)
  String.new(a).downcase
end 
```

# statistics - 寻找模式和统计分析的最佳语言或程序？

> ID：660272
> 
> 赞同：4
> 
> 时间：2009-03-18T21:58:58.287
> 
> 标签：statistics, design-patterns, finance, stocks

我有一个程序可以从雅虎下载基本的历史股票数据并将其放入 SQLite 数据库。我希望能够执行查询，例如查找移动平均线，并确定股票持续上涨或下跌的最长时期。我可以编写 perl 函数来做到这一点，但这似乎有点矫枉过正，因为 Perl 不是为统计而设计的。哪种语言或程序最适合执行这些类型的任务？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-18T22:05:01.020

看看[R 语言](http://www.r-project.org/)——它是免费的，它旨在进行统计，并且它有一个 ODBC 模块，可以让你访问 SQLite。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T22:02:41.897

[http://www.r-project.org/](http://www.r-project.org/)

R太棒了 需要一些时间来适应它并学会使用它，但它提供的模块和功能的数量使它成为迄今为止最好的免费统计程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T22:12:45.867

如果您想要快速入门或概念验证，R 很好，请尝试[Weka](http://www.cs.waikato.ac.nz/ml/weka/)。它声称它有一个直观的 GUI。尽管从我的经验来看这并不完全正确，但它仍然比进入 R 更快

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T22:01:46.457

我听说 r 对于这些事情来说是一种很好的语言。我没有亲自使用过，所以我不能给你任何好的资源或任何东西。但我想说这值得一提。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T22:07:55.863

您可能需要考虑一种更数学的方法（而不是程序化的），例如使用 Mathematica 或其他一些 CAS。Mathematica 可以加载您的 SQL 表，并且您将能够使用您梦寐以求的所有数学工具执行广泛的分析。当然，Mathematica 有一个您可以使用的严格的函数式语言！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T03:01:05.737

Statistics::Descriptive 或 Math::Business::SMA perlmods 怎么样？如果您已经了解 Perl，那么在 CPAN 上找到所需内容可能比学习 R 更快。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-22T05:08:31.730

这个工具不是免费的，但值得一看： [http ://www.tableausoftware.com/](http://www.tableausoftware.com/)

*我与 Tableau 软件没有任何关联。

# seo - 命名 url 不是 MVC 的 Web 路由最佳实践

> ID：660274
> 
> 赞同：2
> 
> 时间：2009-03-18T21:59:20.067
> 
> 标签：seo, url-routing

正在处理我的站点的路由，并且想知道命名常规页面的好标准是什么？我打算这样命名它们：

```
/Daily-Winners 
```

但我想为线程标题、博客文章等保留 - 多字语法，而不是常规流量页面。

是否有标准或指南使这对 SEO 更具吸引力？

特别是对于首字母缩略词，如 SEO：

```
/SEO/mySeoPage
/Search-Engine-Optimization/mySeoPage 
```

最好使用完整的单词或首字母缩略词？

TIA

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-18T22:14:00.170

一般来说，**一个 URL 对人类的意义越大，它对搜索引擎的意义就越大，它的排名就越高。**例如，比较

```
http://yoursite.com/SEO/tips?id=1 
```

到

```
http://yoursite.com/Search-Engine-Optimization/Tips/1 
```

每个人，包括搜索引擎，都会更喜欢后者。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T22:10:32.783

完整的话是赢家，因为您将获得更多关键字匹配。

关于常规页面与文章 URL，我认为将它们分组不会有任何区别（SEO 明智）。

# sql-server-2005 - 为什么我可以在 IP 更改后使用 sqlcmd 而不是 SSMS 连接到 SQL Server 2005 实例？

> ID：660281
> 
> 赞同：0
> 
> 时间：2009-03-18T22:01:25.520
> 
> 标签：sql-server-2005, replication

我们的主要办公室有几个 SQL Server 实例，一个在我们的托管 Web 服务器上。有一些复制处理 Web 服务器和主要办公室服务器之间的数据交换。

我们今天在总部更换了 ISP。我们做了功课并准备好进行切换（主机文件中的 ips 已更改，等等......）一旦我们切换到新连接，所有复制都完全中断了。我尝试使用 SSMS 连接到我们的主要办公室服务器；没有饼干。我们可以使用来自我们 Web 服务器的服务器名称 ping 和 ftp 到我们的家庭办公室服务器。我看到 1433 和 1434 端口被新的 ISP 封锁了，并通知了相应的人；他们现在应该被解除封锁。SMSS仍然没有骰子。

然后我尝试使用 sqlcmd 进行连接，效果非常好。SMSS 不会连接到服务器，但 sqlcmd 会。为什么是这样？在 ISP 切换之前，一切都像魅力一样。

***例子***

```
ping 家庭服务器
    成功！
ftp 家庭服务器
    成功！
sqlcmd -S homeserver\instance -U user -P pass
    成功！
- 尝试使用 SSMS 进行连接，使用相同的 homeserver\instance 和 user/pass 组合
    提供程序：SQL 网络接口，错误：26 - 定位服务器/指定实例时出错）

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-23T00:05:00.317

SQL 不侦听 TCP 1434，它侦听 UDP 1434。您无法使用 telnet 测试 UDP 端口。让您的 ISP 打开 UDP 1434。

检查服务器上的客户端连接顺序，我会发现命名管道高于 TCP/IP，但 SSMS 出于某种原因没有使用命名管道。

如果您使用命名实例，请确保 SQL Server 在 colo 和办公室之间打开了您使用的任何 TCP 端口。

您可能需要考虑在办公室和 colo 之间设置 VPN，这样您就不必担心两者之间的防火墙。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T22:36:13.830

实例应该是：homeserver\instance（反斜杠而不是正斜杠）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T22:47:53.273

有点猜测，但 SQL 对网络协议有不同的选择，包括共享内存、TCP/IP、命名管道和 VIA。您可以使用 SQL Server 配置管理器为服务器和客户端（在适当的计算机上）设置配置。本机客户端通常会使用命名管道，它通常不会在 WAN 上工作，因为（我认为）它使用广播进行名称解析（并且可能需要打开更多端口）。因此，如果 SSMS 尝试通过命名管道进行连接，它可能无法解析服务器名称，而如果 sqlcmd 使用 TCP/IP，它将能够。

换句话说，我首先要看**的是服务器和客户端上**的 SQL Server 配置管理器。尝试禁用 TCP/IP 以外的所有内容或更改提供程序顺序，以便 TCP/IP 位于顶部。您可以将共享内存留在顶部并根据需要启用，这对于本地计算机连接很方便。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-20T09:42:14.977

您还可以在服务器上启用 SQL 浏览器服务，从而可以实际看到服务器实例的名称。

# c# - 如何在 Ninject 中使用装饰器声明责任链？

> ID：660294
> 
> 赞同：4
> 
> 时间：2009-03-18T22:04:44.140
> 
> 标签：c#, inversion-of-control, ninject, chain-of-responsibility

我想在 Ninject 中使用装饰器声明一个责任链。

有没有人这样做过？

谢谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-11-24T19:23:20.280

在新的 ninject 2.0 语法中，您可以通过以下较新的语法来完成此操作：

```
Bind<IEmailSender>().To<LoggingEmailSender>();
Bind<IEmailSender>().To<SmtpClientEmailSender>().WhenInjectedInto<LoggingEmailSender>(); 
```

我自己遇到了这个问题，发现这是这样做的方法，因为 ForMembersOf 已在 ninject 2.0 中删除

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-25T15:52:21.573

假设我正确理解了这个问题，一种方法是这样的：

```
Bind<IEmailSender>().To<LoggingEmailSender>();
Bind<IEmailSender>().To<SmtpClientEmailSender>().ForMembersOf<LoggingEmailSender>(); 
```

LoggingEmailSender 类将有一个类似的构造函数：

```
LoggingEmailSending(IEmailSender sender) 
```

这应该很容易让你成为一个装饰器——只要记住，如果不使用属性，你就会被限制在一个构造函数中。

# lucene - MultiFieldQueryParser 正在从首字母缩写词中删除点

> ID：660298
> 
> 赞同：0
> 
> 时间：2009-03-18T22:05:18.850
> 
> 标签：lucene, lucene.net

我再次发布这个问题，因为我的查询没有得到回答。

我正在使用 Lucene 开发图书搜索 api。用户可以搜索标题或描述字段包含 CFA 的书。我正在使用 StandardAnalyzer 以及停用词列表。

我正在使用 MultiFieldQueryParser 解析上面的字符串。但是解析后，它会删除字符串中的点。我在这里想念什么？

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-19T07:25:31.687

正如你所提到的，这是[这个问题](https://stackoverflow.com/questions/652956/using-multifieldqueryparser)的骗局。我建议你至少在你的问题中添加一个链接。另外，我会敦促您创建一个用户帐户，因为现在无法查看您的旧问题以获取上下文。

专门处理首`StandardAnalyzer`字母缩略词，并将 CFA（例如）转换为 cfa。这意味着您应该能够进行搜索，只要您确保使用相同的分析器进行索引和查询解析。

我建议您运行一些更基本的测试用例来消除其他因素。尝试使用普通用户`QueryParser`而不是多字段用户。

这是我写的一些代码来玩`StandardAnalyzer`：

```
StringReader testReader = new StringReader("C.F.A. C.F.A word");
StandardAnalyzer analyzer = new StandardAnalyzer();
TokenStream tokenStream = analyzer.tokenStream("title", testReader);
System.out.println(tokenStream.next());
System.out.println(tokenStream.next());
System.out.println(tokenStream.next()); 
```

顺便说一下，这个输出是：

```
(cfa,0,6,type=<ACRONYM>)
(c.f.a,7,12,type=<HOST>)
(word,13,17,type=<ALPHANUM>) 
```

请注意，例如，如果首字母缩略词不以点结尾，则分析器会假定它是 Internet 主机名，因此搜索“CFA”将不会匹配文本中的“CFA”。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T22:21:33.727

（我只熟悉java lucene，但我想在这种情况下没关系。）

分析器的目的是去除妨碍有效全文搜索的字符和格式。例如，如果您编写的文档仅将 lucene 称为“lucene.net”，您可能希望 lucene 也仅返回“lucene”的搜索命中。因此，StandardAnalyzer 会去除点（以及一些其他特殊字符）。

不过不用担心。与 lucene 一样，这可以配置，在这种情况下，通过选择不同的分析器。尝试改用 SimpleAnalyzer 或 KeywordAnalyzer，看看哪个最接近您想要的行为。如果它们都不行，您甚至可以使用分析器接口实现您自己的自定义分析器。其实很简单。

祝你好运。:)

# powershell - 如何有效地在 Powershell 中为大文件添加一行

> ID：660301
> 
> 赞同：6
> 
> 时间：2009-03-18T22:05:48.863
> 
> 标签：powershell

我有一些 CSV 格式的大文件，我想使用`Import-Csv`Powershell 中的命令将它们转换为对象。但是这些文件缺少列标题，需要在我使用`Import-Csv`. 将这些添加到文件中的最快和最有效的方法是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T22:32:18.737

前置大文件不是一个简单或快速的操作。

但是，import-csv 确实有一个“标题”参数，您可以使用它来指定列标题，即：

```
$header = 'Foo', 'Bar', 'Baz'
import-csv .\myfile.csv -header $header 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T13:49:19.097

我确信有一种方法可以在一行中做到这一点，但这会奏效。

假设您有包含以下内容的*Test.csv ：*

```
1,2,3
4,5,6
7,8,9 
```

此 PowerShell 代码将创建一个新文件*NewTest.csv*，其中包含列名并附加 Test.csv 的内容。

```
Add-Content -path .\NewTest.csv -value "Col1,Col2,Col3"
$contents = Get-Content .\Test.csv
Add-Content -path .\NewTest.csv -value $contents 
```

如果您有一个非常大的文件，我无法谈论它的性能，但我不知道有任何其他方法可以做到这一点。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2016-09-22T00:00:34.957

这一个班轮工作得很好。

```
 @("Header Text") + (get-content myFile.txt) | set-content myFile.txt 
```

解释

*   `@("Header Text")`创建一个包含一项的数组。
*   `+ (get-content myFile.txt)`创建一个包含两者内容的新数组。
*   `| set-content myFile.txt`将结果通过管道传递给 set-content 并保存到文件中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-24T15:24:37.827

```
$largeFile = get-content .\largeFile.txt
$header = "Col1,Col2,Col3,Col4"
$headerArray = $header -split ' '
$headerArray + $largeFile | out-file largeFileWithHeader.txt 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T22:53:28.470

将要添加的字符串复制到新文件，然后将其余字符串连接到该新文件。

# c# - 4 点变换图像

> ID：660304
> 
> 赞同：6
> 
> 时间：2009-03-18T22:08:52.867
> 
> 标签：c#, vb.net, image-manipulation, homography

我需要转换位图图像，使其 4 个角点从一个位置移动到另一个位置。

任何可以在 Windows、C#/VB.NET 上运行的代码，甚至有助于如何使用[Paint.NET](http://www.getpaint.net/index.html)或[Photoshop](http://www.adobe.com/products/photoshop/)等可编写脚本的程序都将被接受。Java Advanced Imaging API 听起来很有希望。

我需要它用于屏幕截图操作系统，它可以让您获得这样的效果：

[![替代文字](https://i.stack.imgur.com/DSapn.gif)](https://i.stack.imgur.com/DSapn.gif)
[（来源：[wholetomato.com](http://www.wholetomato.com/images/tour/mondoPerspectiveTrans.gif)）]

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T12:25:43.617

查看[ImageMagick中的](http://www.imagemagick.org/)[透视变形](http://www.imagemagick.org/Usage/distorts/#perspective)示例。它适用于大多数主流平台。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T04:42:33.637

这里的关键词是[*单应性*](http://en.wikipedia.org/wiki/Homography)。Manolis Lourakis 用 C 语言编写了一个 GPL 的单应性实现，可[在此处](http://www.ics.forth.gr/~lourakis/homest/)获得；但是，这将不能很容易地移植，因为它依赖于一些外部库，例如[LAPACK](http://www.netlib.org/lapack/)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T12:17:54.433

免责声明：我在 Atalasoft 工作

如果您愿意商业化，DotImage Photo 可以使用 QuadrilateralWarpCommand 来实现。示例 C# 代码

```
// Load an image.
AtalaImage image = new AtalaImage("test-image.jpg");

// Prepare the warp positions.
Point bottomLeft = new Point(100, image.Height - 80);
Point topLeft = new Point(130, 45);
Point topRight = new Point(image.Width - 60, 140);
Point bottomRight = new Point(image.Width - 20, image.Height);

// Warp the image.
QuadrilateralWarpCommand cmd = new QuadrilateralWarpCommand(bottomLeft,
   topLeft, topRight, bottomRight, InterpolationMode.BiLinear, Color.White);
AtalaImage result = cmd.Apply(image).Image; 
```

[http://www.atalasoft.com/products/dotimage](http://www.atalasoft.com/products/dotimage)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T04:34:03.907

比使用图像处理模拟透视扭曲更容易，您可以使用 OpenGL 或 DirectX (XNA) 来实际执行透视显示。

使用您的图像作为纹理贴图渲染一个简单的四边形。设置你的场景，渲染到一个缓冲区，你就有了你的图像。

**更新**事实证明，XNA 是一个荒谬的库（专门用于制作游戏，没有别的，打哈欠）。托管 DirectX 需要脑叶切开术。OpenGL 易于使用，但缺少图像加载代码。这给我们留下了WPF：

[替代文字 http://praeclarum.org/so/persp.png](http://praeclarum.org/so/persp.png)

可以通过强制 WPF 进入抗锯齿模式来改善图像（为什么哦，为什么微软你这么短视？），并且不使用在所有屏幕截图上强制使用 1 像素黑色边框的 Aero 玻璃（或通过删除 1 像素边界）。

（对不起这段代码的长度，但 WPF 是一个健谈的 API。）

```
public partial class Window1 : Window {
    const float ANGLE = 30;
    const float WIDTH = 8;
    public Window1() {
        InitializeComponent();

        var group = new Model3DGroup();
        group.Children.Add(Create3DImage(@"C:\Users\fak\Pictures\so2.png"));
        group.Children.Add(new AmbientLight(Colors.White));

        ModelVisual3D visual = new ModelVisual3D();
        visual.Content = group;
        viewport.Children.Add(visual);
    }

    private GeometryModel3D Create3DImage(string imgFilename) {
        var image = LoadImage(imgFilename);

        var mesh = new MeshGeometry3D();
        var height = (WIDTH * image.PixelHeight) / image.PixelWidth;
        var w2 = WIDTH / 2.0;
        var h2 = height / 2.0;
        mesh.Positions.Add(new Point3D(-w2, -h2, 0));
        mesh.Positions.Add(new Point3D(w2, -h2, 0));
        mesh.Positions.Add(new Point3D(w2, h2, 0));
        mesh.Positions.Add(new Point3D(-w2, h2, 0));
        mesh.TriangleIndices.Add(0);
        mesh.TriangleIndices.Add(1);
        mesh.TriangleIndices.Add(2);
        mesh.TriangleIndices.Add(0);
        mesh.TriangleIndices.Add(2);
        mesh.TriangleIndices.Add(3);
        mesh.TextureCoordinates.Add(new Point(0, 1)); // 0, 0
        mesh.TextureCoordinates.Add(new Point(1, 1));
        mesh.TextureCoordinates.Add(new Point(1, 0));
        mesh.TextureCoordinates.Add(new Point(0, 0));

        var mat = new DiffuseMaterial(new ImageBrush(image));
        mat.AmbientColor = Colors.White;

        var geometry = new GeometryModel3D();
        geometry.Geometry = mesh;
        geometry.Material = mat;
        geometry.BackMaterial = mat;

        geometry.Transform = new RotateTransform3D(
            new AxisAngleRotation3D(new Vector3D(0,1,0), ANGLE),
            new Point3D(0, 0, 0));

        return geometry;
    }

    public static BitmapSource LoadImage(string filename) {
        return BitmapDecoder.Create(new Uri(filename, UriKind.RelativeOrAbsolute),
            BitmapCreateOptions.None, BitmapCacheOption.Default).Frames[0];
    }
} 
```

以及所需的 XAML：

```
<Window x:Class="Persp.Window1" xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
Title="Perspective Window" Height="480" Width="640">
<Grid>
    <Viewport3D x:Name="viewport">
        <Viewport3D.Resources>
        </Viewport3D.Resources>
        <Viewport3D.Camera>
            <PerspectiveCamera x:Name="cam"
                  FarPlaneDistance="100"
                  LookDirection="0,0,-1"
                  UpDirection="0,1,0"
                  NearPlaneDistance="1"
                  Position="0,0,10"
                  FieldOfView="60" />
        </Viewport3D.Camera>
    </Viewport3D>
</Grid>
</Window> 
```

# xml - NHibernate 映射泛型类

> ID：660307
> 
> 赞同：1
> 
> 时间：2009-03-18T22:10:07.560
> 
> 标签：xml, nhibernate, nhibernate-mapping

如何在 NHibernate 中为泛型类创建映射文件。假设我有一个类 Foo 它在映射文档中的外观如何？类名="mydll.Foo ???? , mydll" ...

我知道如果它是 Foo 它会是： class name="mydll.Foo`1[[mydll.Fee, mydll]], mydll"

会不会是这样的： class name="mydll.Foo`1[[mydll.Fee, mydll],[mydll.Fi, mydll]], mydll" （我试过这个，但没有用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T22:15:29.107

我可能在这里不知所措（3天前刚开始做NHibernate），但是映射一个抽象类是否有意义？你不能实例化一个抽象类，那么，你为什么要把它映射到数据上呢？

我最好的猜测是，您必须将您的子类映射到他们需要的数据，并在您的基类上公开/受保护的设置器，以便也映射这些数据。这将意味着大量的复制粘贴，因为您会以相同的方式为所有（在完美世界中）子类映射您的基类。

[编辑] 发现这个：[NHibernate：一个基类，几个映射](https://stackoverflow.com/questions/281247/nhibernate-one-base-class-several-mappings)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T01:59:16.633

正确的映射是：class name="mydll.Foo`2[[mydll.Fee, mydll],[mydll.Fi, mydll]], mydll"

有两个通用元素，因此将 1 更改为 2。不确定这对类的 name 属性是否有效，但它适用于 collection-type 属性

# vba - 如何使用 VBA 读取二进制文件？

> ID：660312
> 
> 赞同：8
> 
> 时间：2009-03-18T22:11:06.917
> 
> 标签：vba, binary

我有一个由 Compaq Visual Fortran 编写的程序产生的二进制文件。如何读取特定行并将它们保存在 Excel 工作表中？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2018-03-27T21:27:42.590

如果要将整个文件读入一个大数组，可以使用以下代码：

```
Dim byteArr() As Byte
Dim fileInt As Integer: fileInt = FreeFile
Open "C:\path\to\my\file.ext" For Binary Access Read As #fileInt
ReDim byteArr(0 To LOF(fileInt) - 1)
Get #fileInt, , byteArr
Close #fileInt 
```

结果与 Todd Owen 的答案相同，但无需使用外部库即可实现。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-19T02:41:00.200

您必须使用“二进制访问”打开它。

见[http://www.vbforums.com/showthread.php?t=430424](http://www.vbforums.com/showthread.php?t=430424)

```
Sub Temp()
    Dim intFileNum%, bytTemp As Byte, intCellRow%
    intFileNum = FreeFile
    intCellRow = 0
    Open "C:\temp.bin" For Binary Access Read As intFileNum
    Do While Not EOF(intFileNum)
        intCellRow = intCellRow + 1
        Get intFileNum, , bytTemp
        Cells(intCellRow, 1) = bytTemp
    Loop
    Close intFileNum
End Sub 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-12-04T06:56:58.807

另一种方法是使用 ADODB.Stream：

```
With CreateObject("ADODB.Stream")
    .Open
    .Type = 1  ' adTypeBinary
    .LoadFromFile file.Path
    bytes = .Read
    .Close
End With 
```

（抱歉，我实际上不确定它在哪个库中，这就是为什么此示例代码使用 CreateObject 和文字值 1 而不是命名常量 adTypeBinary！）

# wpf - wpf listview/gridview：隐藏重复的内容

> ID：660318
> 
> 赞同：1
> 
> 时间：2009-03-18T22:15:29.230
> 
> 标签：wpf, listview

我是 WPF 新手，不知道如何实现我需要的东西。

我的问题：

我有一个显示 SQL 查询结果的数据绑定 WPF 网格视图。一些列显示了我想隐藏的重复数据。这：

```
occupancy   name       room
---------   ---------  -----
Occupied    Bob        1
Occupied    Ted        2
Available              3
Available              4 
```

应该是这样的：

```
occupancy   name       room
---------   ---------  -----
Occupied    Bob        1
            Ted        2
Available              3
                       4 
```

我的环境：

在 .net 3.5 上使用 C#。我已将列表视图绑定到数据视图集合。我有一个单元格的数据模板来控制格式。

我的初步解决方案：

我想我应该对模板应用触发器并更改属性以使第一行之后的所有行上的文本都为空，其中数据与前一行相同。

当我设置触发器时，我可以在 xaml 中执行这一切，还是需要编写代码来访问前一行？

如果它在 XAML 中，您如何构造绑定字符串以引用它绑定到的数据视图的当前行和上一行中的列？由于没有上一行，它会在第一行窒息吗？

这是我正在使用的模板：

```
<DataTemplate x:Key="Occupancy">
    <TextBlock Name="Occupancy" Text="{Binding Path=Occupancy}" TextAlignment="Left" />
    <DataTemplate.Triggers>
        <DataTrigger Binding="{Binding Path=Occupancy}">
            <DataTrigger.Value>Available</DataTrigger.Value>
            <Setter TargetName="Occupancy" Property="**{previous column's content}**" Value="**{current columns content}**"/>
        </DataTrigger>
    </DataTemplate.Triggers>
</DataTemplate> 
```

也许使用 RelativeSource:PreviousData ??

如果我必须编写代码，是否有人知道可以让我入门的体面教程？

替代解决方案是可以的，但我认为我可以应用于许多列的无代码样式将是最佳解决方案。

谢谢你的时间。

周杰伦

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T23:37:37.020

我对 RelativeSource:PreviousData 有过负面的体验。它在 ListBox 中工作，但在列表视图中，我收到一个错误“找不到上一个元素用作 RelativeSource，因为在生成的上下文中没有父元素。”

我终于放弃并自己枚举了行（想法是用它来打印行号）。

在您的情况下，我会使用带有列表元素的 ModelView，其中的元素将指向您的模型的相应元素和先前元素。因此，如果previous 和current 在相应的属性中具有相同的值，ModelView 的元素将返回null。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T01:15:01.717

我对 WPF ListView 没有太多经验（我倾向于坚持使用更基本的控件/容器），但是您是否考虑过尝试首先使用 LINQ 查询对原始数据进行分组？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T17:19:19.223

之前的数据选项仅适用于 ListView，并且仅当您没有与之关联的 GridView 时。我相信这可能是因为与 ListView 控件挂钩的视图不会创建 ItemsControl 集合。查找先前数据的代码检查 ItemsControl 集合中的先前项。这只是一个猜测。

# com - 在哪里可以找到可以在 Powershell 中创建的所有 COM 对象？

> ID：660319
> 
> 赞同：40
> 
> 时间：2009-03-18T22:15:35.610
> 
> 标签：com, powershell

在 Powershell 中，我可以创建可用于控制 Microsoft Office 应用程序的 COM 对象：

```
$excel = New-Object -com "Excel.Application"
$excel.visible = $true 
```

如何列出可以在 Powershell 中创建的所有可用 COM 对象？

* * *

## 回答 #1

> 赞同：67
> 
> 时间：2009-03-18T22:37:31.613

我发现这个 powershell 单行脚本应该列出所有 COM 对象。

```
gci HKLM:\Software\Classes -ea 0| ? {$_.PSChildName -match '^\w+\.\w+$' -and
(gp "$($_.PSPath)\CLSID" -ea 0)} | ft PSChildName 
```

让我们知道它是否有效！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-19T06:12:34.543

使用 Microsoft 的 OleView.exe。我认为它可能随 Visual Studio 一起提供。如果没有，您可以在[Windows SDK](http://msdn.microsoft.com/en-us/windows/bb980924.aspx)中找到它。下载量很大；您可以下载整个内容，也可以尝试使用 setup.exe 安装程序逐个下载。

进入 OleView 后，在“类型库”下查看。例如 Excel 出现在“Microsoft Exel”下。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-24T21:56:12.683

应该注意的另一个选项是通过 WMI：

```
Get-WMIObject Win32_ClassicCOMClassSetting 
```

# sqlite - 如何使用 sqlite3.exe 命令行工具自动化进程？

> ID：660320
> 
> 赞同：62
> 
> 时间：2009-03-18T22:16:08.170
> 
> 标签：sqlite, scripting, batch-file

我正在尝试将大量数据（550 万行）批量加载到 SQLite 数据库文件中。通过 INSERT 加载似乎太慢了，所以我尝试使用 sqlite3 命令行工具和 .import 命令。

如果我手动输入命令，它会完美运行，但我一生都无法弄清楚如何从脚本（.bat 文件或 python 脚本；我在 Windows 机器上工作）自动化它。

我在命令行发出的命令如下：

```
> sqlite3 database.db
sqlite> CREATE TABLE log_entry ( <snip> );
sqlite> .separator "\t"
sqlite> .import logfile.log log_entry 
```

但我尝试的任何方法都不会让这个从 bat 文件或 python 脚本中工作。

我一直在尝试这样的事情：

```
sqlite3 "database.db" .separator "\t" .import logfile.log log_entry

echo '.separator "\t" .import logfile.log log_entry' | sqlite3 database.db 
```

当然我可以以某种方式做到这一点？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-03-18T22:29:16.063

创建一个文本文件，其中包含要输入到 sqlite 命令行程序的行，如下所示：

```
创建表 log_entry ( );
. 分隔符“\t”
.import logfile.log log_entry
```

然后打电话`sqlite3 database.db < commands.txt`

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2011-12-17T08:55:54.533

[或者，您可以使用heredoc](http://en.wikipedia.org/wiki/Here_document#Unix_Shells) **import.sh**将所有内容放在一个 shell 脚本文件中（从而简化维护）：

```
#!/bin/bash --
sqlite3 -batch $1 <<"EOF"
CREATE TABLE log_entry ( <snip> );
.separator "\t"
.import logfile.log log_entry
EOF 
```

...并运行它：

```
import.sh database.db 
```

它使仅维护一个脚本文件变得更加容易。顺便说一句，如果你需要在 Windows 下运行它，[Power Shell 还具有 heredoc](http://en.wikipedia.org/wiki/Here_document#Windows_PowerShell)

此外，这种方法有助于处理缺少脚本参数支持的问题。您可以使用 bash 变量：

```
#!/bin/bash --

table_name=log_entry

sqlite3 -batch $1 <<EOF
CREATE TABLE ${table_name} ( <snip> );
.separator "\t"
.import logfile.log ${table_name}
EOF 
```

或者甚至做一个这样的把戏：

```
#!/bin/bash --

table_name=$2

sqlite3 -batch $1 <<EOF
CREATE TABLE ${table_name} ( <snip> );
.separator "\t"
.import logfile.log ${table_name}
EOF 
```

...并运行它：`import.sh database.db log_entry`

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-03-18T22:29:53.893

创建一个单独的文本文件，其中包含您通常会在 sqlite3 shell 应用程序中键入的所有命令：

```
CREATE TABLE log_entry ( <snip> );
.separator "\t"
.import /path/to/logfile.log log_entry 
```

将其另存为 impscript.sql。

创建一个使用该脚本调用 sqlite3 shell 的批处理文件：

```
sqlite3.exe yourdatabase.db < /path/to/impscript.sql 
```

调用批处理文件。

附带说明 - 导入时，请*确保将 INSERT 包装在事务中*！这将使您立即获得 10.000% 的加速。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-04-14T19:32:41.050

我最近在将 Firefox 的 cookies.sqlite 转换为文本文件（对于某些下载工具）时遇到了类似的问题，并且偶然发现了这个问题。

我想用一个 shell 行来做到这一点，这将是我应用于上述问题的解决方案：

```
echo -e ".mode tabs\n.import logfile.log log_entry" | sqlite3 database.db 
```

但我还没有测试过那条线。但它适用于我上面提到的 Firefox 问题（顺便说一句，通过 Mac OSX 上的 Bash ）：

```
echo -e ".mode tabs\nselect host, case when host glob '.*' then 'TRUE' else 'FALSE' end, path, case when isSecure then 'TRUE' else 'FALSE' end, expiry, name, value from moz_cookies;" | sqlite3 cookies.sqlite 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2016-11-15T17:00:46.367

```
sqlite3 abc.db ".read scriptname.sql" 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-12-16T22:37:20.390

在这一点上，我不确定我还能添加什么，除了向 nad2000 建议的 bash 脚本添加 unix 环境变量时遇到了一些麻烦。

运行这个：

```
bash dbmake.sh database.db <(sed '1d' $DATA/logfile.log | head -n 1000) 
```

我需要从标准输入导入作为解决方法，我找到了这个解决方案：

```
sqlite3 $1 <<"EOF"
CREATE TABLE log_entry;
EOF
sqlite3 -separator $'\t' $1 ".import $2 log_entry" 
```

通过添加第二个 sqlite3 行，我能够将 Unix 中的 $2 传递到 .import、完整路径和所有内容的文件参数中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-08-25T10:42:20.900

在 Windows 上，这应该可以工作：

```
(echo CREATE TABLE log_entry ( <snip> ); & echo .separator "\t" & echo .import logfile.log log_entry) | sqlite3.exe database.db 
```

我没有测试过这个特定的命令，但是从我自己对解决管道多个命令的问题的追求中，我发现关键是将回显的命令括在括号内。话虽如此，您可能需要调整上述命令以转义其中一些字符。例如：

```
(echo CREATE TABLE log_entry ^( ^<snip^> ^); & echo .separator "\t" & echo .import logfile.log log_entry) | sqlite3.exe database.db 
```

我不确定在这种情况下是否需要转义，但很有可能因为括号可能与封闭的括号冲突，因此“*小于*”和“*大于*”符号通常被解释为输入或输出可能也有冲突。可以在此处找到字符转义的广泛列表：[http ://www.robvanderwoude.com/escapechars.php](http://www.robvanderwoude.com/escapechars.php)

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2011-07-16T10:12:52.920

```
 here trans is table name and trans.csv is a csv file in which i have 1959 rows of data

    $ sqlite3 abc.db ".separator ','"
    $ sqlite3 abc.db ".import 'trans.csv' trans"
    $ sqlite3 abc.db "select count(*) from trans;"
    1959 
```

但它不可能像你写的那样写

# localization - 本地化资产管理

> ID：660324
> 
> 赞同：0
> 
> 时间：2009-03-18T22:17:58.210
> 
> 标签：localization, resources

我们有几个大型产品，我们希望将其与一致的本地化策略集成。

从代码的角度来看，我们已经在做正确的事情——即。资源文件中的字符串。

我正在寻找可以在数据库中组织本地化字符串并在构建过程中生成适当的资源文件（即 .NET 的 .RESX 文件、.js 文件等）的东西。理想情况下，它还可以读取文件（检测已添加/删除的字符串）。

该数据库将允许我们在不同的产品中重复使用翻译，切换到不同的技术，并跟踪每个版本中缺少的翻译。

有没有人找到满足这些要求的好产品？其他人为管理本地化资产做了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-23T21:25:33.340

在这个问题的答案中找到了一些很好的链接：[你知道编辑/翻译资源 (.rc) 文件的好程序吗？](https://stackoverflow.com/questions/51948/do-you-know-of-a-good-program-for-editing-translating-resource-rc-files/77807)

我们现在正在评估一些产品：

*   [http://www.lingobit.com/](http://www.lingobit.com/)
*   [http://www.sisulizer.com/](http://www.sisulizer.com/)
*   [http://www.multilizer.com/](http://www.multilizer.com/)
*   WinTrans - [http://www.schaudin.com/](http://www.schaudin.com/)

它们都没有我们最初寻找的基于数据库的方法，但它们似乎具有核心功能。Lingobit 是早期的最爱，但我们还没有进行太多详细的试验。有人推荐这些产品（或类似产品）吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-25T11:44:21.163

查看[GlobalSight](http://www.globalsight.com/)或 Alchemy 的[催化剂](http://www.alchemysoftware.ie/products/alchemy_catalyst.html)

Catalyst 是一个独立的翻译记忆库和本地化引擎，可以在您的构建过程中使用（并且被许多大型软件公司使用）。GlobalSight 是一个相对较新的开源翻译数据库和工作流工具，看起来很有前途。

# c - 将一个函数传递给 C 中的另一个函数。我做错了什么？

> ID：660325
> 
> 赞同：1
> 
> 时间：2009-03-18T22:18:29.193
> 
> 标签：c

有一些我正在处理的 C 代码，它看起来应该可以工作。当我尝试链接目标文件时，我在 main 的 getLine 函数中收到一条错误消息，指出“未定义对 outputBus 的引用”等等。我已经尝试过在函数名称之前使用和不使用＆符号。编译`gcc -ansi`。我究竟做错了什么？

```
typedef void(*DualOutput)(const int, const int);
typedef void(*TripleOutput)(const int, const int, const double);

void   passenger(node**, node**, itemtype*);
double bus(node**, node**, itemtype*);
int    getLine(itemtype*, DualOutput, DualOutput);
void   getLines(node**, node**, DualOutput, DualOutput, TripleOutput);
void   outputBus(const int, const int);
void   outputPeople(const int, const int);
void   outputTotal(const int, const int, const double);

int main(int argc, char **argv){
  node *head = NULL;
  node *tail = NULL;

  getLines(&head, &tail, outputBus, outputPeople, outputTotal);
  return 0;
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-18T22:22:33.473

这些函数在你的代码中的任何地方都有主体吗？main 函数之前的所有这些行都只是函数*声明*（又名原型）。您实际上必须在某处创建和实现该功能。

函数声明是对编译器的承诺，即该函数将存在于代码稍后的某个位置（或另一个目标文件中），因此它不会抱怨。然后链接器看到你违背了你的承诺并感到不安。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T22:22:45.640

“未定义的引用”是链接器错误，表示链接器找不到方法的实现。如果它是在单独的源文件中定义的，您是否将它们编译并链接在一起？如果它在库中，您是否链接到库（使用 gcc 的 libfoo 的 -lfoo 选项）？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T22:22:53.550

一些“它插入了吗？” 输入问题以帮助您入门：

*   您是否真的在任何地方实现了函数`outputBus()`,`outputPeople()`和`outputTotal()`？

*   如果是这样，该模块是否包含在链接中？

如所写，输出函数已声明但未定义。如果链接中包含的某些目标文件中没有定义，它们确实是未定义的引用。链接器试图告诉您您需要定义这些函数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T22:23:11.863

您已经声明了函数，但没有在任何地方实现它们。这只是声明了一个函数：

```
void   outputBus(const int, const int); 
```

# php - 防止返回按钮显示 POST 确认警报

> ID：660329
> 
> 赞同：39
> 
> 时间：2009-03-18T22:21:15.333
> 
> 标签：php, forms, post, http-headers

我有一个向网页提供一长串参数的应用程序，所以我必须使用 POST 而不是 GET。问题是当页面被显示并且用户点击返回按钮时，Firefox 会显示一个警告：

> 要显示此页面，Firefox 必须发送将重复之前执行的任何操作（例如搜索或订单确认）的信息。

由于应用程序的构建方式使得返回是一种非常常见的操作，这对最终用户来说真的很烦人。

基本上，我想按照这个页面的方式来做：

[http://www.pikanya.net/testcache/](http://www.pikanya.net/testcache/)

输入内容，提交，然后单击返回按钮。没有警告，它只是回去。

谷歌搜索我发现这可能是 Firefox 3 中的一个错误，但即使在他们“修复”它之后，我也想以某种方式获得这种行为。

我想它可以通过一些 HTTP 标头来实现，但究竟是哪一个呢？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-18T23:09:01.067

在这里查看我的网络编程黄金法则：

[停止向数据库中插入数据两次](https://stackoverflow.com/questions/638494/stop-data-inserting-into-a-database-twice/638506#638506)

它说：“永远不要用身体回应 POST 请求。总是做这项工作，然后用 Location: 标头响应以重定向到更新的页面，以便浏览器使用 GET 请求它”</p>

如果浏览器曾经询问用户关于重新发布的问题，那么您的 Web 应用程序就会损坏。用户不应该看到这个问题。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-03-18T22:32:31.593

一种方法是将 POST 重定向到重定向到 GET 的页面 - 请参阅[wikipedia 上的 Post/Redirect/Get](http://en.wikipedia.org/wiki/Post/Redirect/Get)。

假设您的 POST 是 4K 的表单数据。大概您的服务器对这些数据做了一些事情，而不是只显示一次然后将其丢弃，例如将其保存在数据库中。继续这样做，或者如果它是一个巨大的搜索表单，请在数据库中创建一个临时副本，几天后或在使用空间限制时基于 LRU 被清除。现在创建可以使用 GET 访问的数据表示。如果它是临时的，则为其生成一个 ID 并将其用作 URL；如果它是一组永久数据，它可能有一个 ID 或可用于 URL 的东西。在最坏的情况下，使用小 URL 之类的算法可以将大 URL 折叠成更小的 URL。重定向 POST 以获取数据的表示。

* * *

作为历史记录，这项技术[于 1995 年确立实践](https://lists.w3.org/Archives/Public/ietf-http-wg-old/1995JanApr/0195.html)。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-18T22:27:36.767

避免该警告/行为的一种方法是通过 AJAX 进行 POST，然后将用户单独发送到另一个页面（或不发送）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-10-13T20:40:46.620

我一直在使用 Session 变量来帮助解决这种情况。这是我多年来一直使用的方法：

```
//If there's something in the POST, move it to the session and then redirect right back to where we are
if ($_POST) {
    $_SESSION['POST']=$_POST;
    redirect($_SERVER["REQUEST_URI"]);
}

//If there's something in the SESSION POST, move it back to the POST and clear the SESSION POST
if ($_SESSION['POST']) {
    $_POST=$_SESSION['POST'];
    unset($_SESSION['POST']);
} 
```

从技术上讲，您甚至不需要将其放回名为 $_POST 的变量中。但这有助于我跟踪哪些数据来自哪里。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T00:00:24.080

> 我有一个向网页提供一长串参数的应用程序，所以我必须使用 POST 而不是 GET。问题是当页面被显示并且用户点击返回按钮时，Firefox 会显示一个警告：

你的推理是错误的。如果请求没有副作用，则应该是 GET。如果它有副作用，它应该是 POST。选择不应基于您需要传递的参数数量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-11-12T11:40:41.373

作为另一种解决方案，您可能完全停止使用重定向。

您可以一次处理并呈现处理结果，无需`POST`确认警报。您应该只操作浏览器历史记录对象：

```
history.replaceState("", "", "/the/result/page") 
```

查看[完整](https://stackoverflow.com/a/47247434/4632019)或[简短的](https://stackoverflow.com/a/3503206/4632019)答案

# asp.net - 当用户离开站点时，如何强制 ASP.Net 会话到期？

> ID：660335
> 
> 赞同：4
> 
> 时间：2009-03-18T22:23:20.367
> 
> 标签：asp.net, security, forms-authentication

我们有一个场景，我们希望检测用户何时离开我们的站点并立即使他们的 .Net 会话过期。我们正在使用表单身份验证。我们不是在谈论我们已经拥有的会话超时。我们想知道用户何时通过链接、输入地址或关注书签离开了我们的网站。如果他们返回我们的网站，即使是马上，他们也必须重新登录（我知道这不是很好的可用性 - 这是我们客户提出的安全要求）。

我最初的直觉是，这要么是不可能的，要么是任何解决方案都极其不可靠。我们提出的唯一解决方案是：

*   添加一个 JavaScript onBlur 事件处理程序，告诉服务器在用户离开站点时注销会话。
*   用户登录后，检查 HTTP 引荐来源网址以确保用户已从站点内导航。
*   将 AJAX 轮询添加回服务器以保持会话刷新，可能间隔为 10 秒。当未按时收到呼叫时，会话将结束。

onBlur 似乎是最简单但可能最不可靠的方法 - 我不确定它是否会起作用。推荐人方法也存在问题，因为用户可以在网站内输入地址而不点击链接。AJAX 方法似乎可以工作，但它很复杂——我什至不确定如何在后端处理它。我在想可能还有一些情况并不总是有效。

任何想法，将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T22:42:48.557

我已经选择了像你上面描述的心跳类型的场景。Ajax 轮询或 IFRAME。当用户关闭浏览器并经过一定的超时（10 秒？）时，您可以将其注销。

另一种选择是让网站完全在 AJAX 上运行。因此，用户只能访问一个“URL”，并且所有内容都是动态加载的。当然，您以这种方式破坏了各种可用性的东西，但至少您实现了目标。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T22:29:10.633

如果用户关闭他们的浏览器，或者输入不同的 URL（包括选择一个收藏夹），那么您就没有什么可以检测到的了。

对于您网站上的链接，您可以创建通过您的网站转发的链接（即，不是链接到[http://example.com/foo](http://example.com/foo)，而是链接到[http://mysite.com/forwarder?dest=http://example .com/foo](http://mysite.com/forwarder?dest=http://example.com/foo) )。

请注意只转发到您打算转发的网站，否则您可能会因“通用转发”被用于网络钓鱼等而引发安全问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T04:57:43.897

您绝对肯定需要告诉客户这是不可能的。他们对 Web 的工作原理有一个基本的误解。很外交，很明显......该死，这可能是别人的工作......但它需要完成。

你的建议，或者它们的组合，可能在一个简单的概念验证中起作用……但它们只会给你带来支持噩梦，而且不会持续地起作用。更糟糕的是，毫无疑问，您还会造成用户完全无法使用应用程序的情况，因为安全黑客对他们失手了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T05:33:04.297

Javascript 有一个 onUnload 事件，当告诉浏览器离开页面时触发该事件。当您尝试按下后退按钮或在编辑答案时单击链接时，您可以在 StackOverflow 上看到这一点。

您可以使用此事件来触发您的站点的自动注销。

但是，我不确定这是否会处理浏览器被故意关闭或浏览器进程外部终止的情况（我猜它不会在第二种情况下发生）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-18T11:24:06.027

如果您网站内的所有导航都是通过 .NET 回发完成的（没有简单的 html 链接或 javascript open 语句），如果页面加载不是回发，您可以执行自动注销并重定向到登录页面。这不会在退出时结束会话，但它看起来像这样，因为如果手动导航到您的 Web 应用程序，它会强制登录。要为所有页面获取此功能，您可以使用在 Page_Load 中执行此操作的母版页。

```
private void Page_Load(object sender, System.EventArgs e)
{
    if (!IsPostBack)
    {
        System.Web.Security.FormsAuthentication.SignOut();
        System.Web.Security.FormsAuthentication.RedirectToLoginPage();
    }
} 
```

# recursion - 递归与循环

> ID：660337
> 
> 赞同：64
> 
> 时间：2009-03-18T22:24:15.420
> 
> 标签：recursion, loops

我面临一个问题，递归和使用循环似乎都是自然的解决方案。对于这种情况，是否有约定或“首选方法”？（显然它不像下面那么简单）

## 递归

```
Item Search(string desired, Scope scope) {
    foreach(Item item in scope.items)
        if(item.name == desired)
            return item;

    return scope.Parent ? Search(desired, scope.Parent) : null;
} 
```

## 环形

```
Item Search(string desired, Scope scope) {
    for(Scope cur = scope; cur != null; cur = cur.Parent)
        foreach(Item item in cur.items)
            if(item.name == desired)
                return item;

    return null;
} 
```

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-03-18T22:28:56.593

在以下情况下，我赞成递归解决方案：

*   递归的实现比迭代解决方案简单得多，通常是因为它以迭代方法无法实现的方式利用问题的结构方面

*   我可以合理地保证递归的深度不会导致堆栈溢出，假设我们正在谈论一种以这种方式实现递归的语言

条件 1 似乎不是这里的情况。迭代解决方案的复杂程度大致相同，所以我会坚持迭代路线。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-03-18T22:34:00.497

如果性能很重要，那么对两者进行基准测试并在理性的基础上进行选择。如果不是，则根据复杂性进行选择，并考虑可能的堆栈溢出。

**经典书籍The Elements of Programming Style**（Kernighan 和 Plauger 着）中有一条指导原则，算法应该遵循数据结构。也就是说，递归结构通常用递归算法处理得更清楚。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-03-18T22:31:35.777

递归用于以更易于理解的形式表达自然递归的算法。“自然递归”算法是从更小的子问题的答案构建答案的算法，而这些子问题的答案又是从更小的子问题的答案等构建的。例如，计算阶乘。

在非函数式编程语言中，迭代方法几乎总是比递归方法更快、更有效，因此使用递归的原因是清晰，而不是速度。如果递归实现最终*不如*迭代实现清晰，那么一定要避免它。

在这种特殊情况下，我会判断迭代实现更清晰。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2009-03-18T22:26:05.307

如果您使用的是函数式语言（似乎并非如此），请使用递归。如果不是，那么该项目的其他人可能会更好地理解该循环。当然，某些任务（例如递归搜索目录）比其他任务更适合递归。

此外，如果代码不能针对尾端递归进行优化，则循环更安全。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-18T22:27:26.987

使用循环。它更容易阅读和理解（阅读代码总是比编写代码困难得多），而且通常要快得多。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-18T22:59:29.093

可以证明，所有尾递归算法都可以展开成一个循环，反之亦然。一般来说，递归算法的递归实现比循环实现更易于程序员理解，也更容易调试。同样一般来说，循环实现的实际性能会更快，因为循环中的分支/跳转通常比推送和弹出堆栈帧执行得更快。

就个人而言，对于尾递归算法，除了性能最密集的情况外，我更喜欢在所有情况下都坚持递归实现。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2018-03-23T10:42:33.093

好吧，我看到了很多答案，甚至接受了答案，但从来没有看到正确的答案，我在想为什么......

长话短说 ：

***如果您可以通过循环生成相同的单元，请始终避免递归！***

**递归是如何工作的？**

• 堆栈内存中的帧被分配给单个函数调用

• 框架包含对实际方法的引用

• 如果方法有对象，则将对象放入堆内存中，Frame 将包含对堆内存中该对象的引用。

•这些步骤正在为每个单独的方法调用完成！

**风险：**

• StackOverFlow 当堆栈没有内存来放置新的递归方法时。

• OutOfMemory 当堆没有内存来放置递归存储对象时。

**循环如何工作？**

• 之前的所有步骤，除了循环内重复代码的执行，如果已经消耗，则不会消耗任何进一步的数据。

**风险：**

• 当您的条件永远不存在时，单一风险存在于while 循环中......好吧，这不会导致任何崩溃或其他任何事情，如果您天真地这样做，它就不会退出循环`while(true)`:)

**测试：**

在您的软件中执行下一步：

```
private Integer someFunction(){

return someFunction();
} 
```

你会`StackOverFlow`在一秒钟内得到异常，也许`OutOfMemory`也会

做第二个：

```
while(true){

} 
```

该软件将只是冻结，不会发生崩溃：

最后但并非最不重要的 - `for`循环：

总是使用`for`循环，因为这样或那样，这个循环有点迫使你给出循环不会继续的断点，你肯定会非常生气，只是想办法让`for`循环永远不会停止，但我建议你总是为了内存管理和提高软件的生产力，使用循环而不是递归，这是当今的一个大问题。

**参考：**

[基于堆栈的内存分配](https://en.wikipedia.org/wiki/Stack-based_memory_allocation)

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-08-17T10:14:57.960

我更喜欢循环

*   递归容易出错
*   所有代码都保留在一个函数/方法中
*   节省内存和速度

我使用堆栈（LIFO 模式）来使循环工作

在java中，堆栈被Deque接口覆盖

```
// Get all the writable folders under one folder
// java-like pseudocode
void searchWritableDirs(Folder rootFolder){
    List<Folder> response = new List<Folder>(); // Results
    Deque<Folder> folderDeque = new Deque<Folder>(); // Stack with elements to inspect
    folderDeque.add(rootFolder);
    while( ! folderDeque.isEmpty()){
        Folder actual = folder.pop(); // Get last element
        if (actual.isWritable()) response.add(actual); // Add to response
        for(Folder actualSubfolder: actual.getSubFolder()) { 
            // Here we iterate subfolders, with this recursion is not needed
            folderDeque.push(actualSubfolder);
        } 
    } 
    log("Folders " + response.size());
 } 
```

更简单，更紧凑

```
// Get all the writable folders under one folder
// java-like pseudocode
void searchWritableDirs(Folder rootFolder){
    List<Folder> response = new List<Folder>(); // Results
    rec_searchWritableDirs(actualSubFolder,response);
    log("Folders " + response.size());
}

private void rec_searchWritableDirs(Folder actual,List<Folder> response) {
   if (actual.isWritable()) response.add(actual); // Add to response
   for(Folder actualSubfolder: actual.getSubFolder()) {
       // Here we iterate subfolders, recursion is needed
       rec_searchWritableDirs(actualSubFolder,response);
   }                
} 
```

后者的代码更少，但有两个功能，而且更难理解代码，恕我直言。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-18T22:28:19.107

我会说递归版本更好理解，但只有注释：

```
Item Search(string desired, Scope scope) {
    // search local items
    foreach(Item item in scope.items)
        if(item.name == desired)
            return item;

    // also search parent
    return scope.Parent ? Search(desired, scope.Parent) : null;
} 
```

解释这个版本要容易得多。尝试在循环版本上写一个很好的评论，你会看到。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-03-18T22:31:50.877

我发现递归更自然，但是如果您的编译器不进行尾调用优化并且您的树/列表对于堆栈大小来说太深，您可能会被迫使用循环。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-18T23:11:02.047

如果您正在处理的系统具有小堆栈（嵌入式系统），则递归深度将受到限制，因此需要选择基于循环的算法。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-10-28T02:39:04.513

我通常更喜欢使用循环。大多数优秀的 OOP 设计将允许您使用循环而不必使用递归（从而阻止程序将所有那些讨厌的参数和地址推入堆栈）。

它在程序代码中有更多用途，在这种代码中，以递归方式思考似乎更合乎逻辑（由于您无法*轻松*存储状态或元数据（信息？），因此您创建了更多值得考虑的情况它的用途）。

递归适用于对函数进行原型设计和/或编写基础代码，但是在您知道代码有效并且在优化阶段返回到它之后，请尝试用循环替换它。

同样，这都是自以为是的。选择最适合你的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-12-29T00:07:31.550

您还可以以更易读的格式编写循环。C`for(init;while;increment)`有一些可读性缺陷，因为该`increment`命令在开始时被提及，但在循环结束时执行。

此外，***您的两个样品不等价***。递归样本将失败，循环不会，如果您将其称为：`Search(null,null)`。这使循环版本对我来说更好。

以下是修改后的示例（假设 null 为假）

## 递归（固定和尾调用可优化）

```
Item Search(string desired, Scope scope) {

    if (!scope) return null

    foreach(Item item in scope.items)
        if(item.name == desired)
            return item;

    //search parent (recursive)
    return Search(desired, scope.Parent);
} 
```

## 环形

```
Item Search(string desired, Scope scope) {
    // start
    Scope cur = scope;

    while(cur) {
        foreach(Item item in cur.items)
            if(item.name == desired)
                return item;

        //search parent
        cur = cur.Parent;

    } //loop

    return null;
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-18T22:51:09.223

如果您的代码被编译，它可能不会有什么不同。做一些测试，看看使用了多少内存以及运行速度有多快。

* * *

## 回答 #15

> 赞同：-3
> 
> 时间：2016-09-24T16:41:04.887

避免递归。很有可能最终在某个时候必须维护那段代码，如果不使用递归来完成它会更容易。其次，它的执行时间很可能会变慢。

# wcf - svcutil soap fault 命名空间问题

> ID：660338
> 
> 赞同：2
> 
> 时间：2009-03-18T22:24:16.730
> 
> 标签：wcf, wsdl, fault

我正在使用 svcutil 生成客户端 Web 服务代码。我正在使用的 wsdl 合同包含一个肥皂故障。生成代码时，故障似乎被包装在合同中定义的命名空间中。

谁能解释为什么？

我只是在运行 svcutil [文件名]

示例 WSDL：

```
<wsdl:definitions xmlns:soap="http://schemas.xmlsoap.org/wsdl/soap/" xmlns:tm="http://microsoft.com/wsdl/mime/textMatching/" xmlns:soapenc="http://schemas.xmlsoap.org/soap/encoding/" xmlns:mime="http://schemas.xmlsoap.org/wsdl/mime/" xmlns:tns="http://tempuri.org/" xmlns:s="http://www.w3.org/2001/XMLSchema" xmlns:soap12="http://schemas.xmlsoap.org/wsdl/soap12/" xmlns:http="http://schemas.xmlsoap.org/wsdl/http/" xmlns:wsdl="http://schemas.xmlsoap.org/wsdl/" targetNamespace="http://tempuri.org/">
<wsdl:types>
    <s:schema elementFormDefault="qualified" targetNamespace="http://tempuri.org/">
        <s:element name="HelloFault">
            <s:complexType/>
        </s:element>
        <s:element name="HelloWorld">
            <s:complexType/>
        </s:element>
        <s:element name="HelloWorldResponse">
            <s:complexType>
                <s:sequence>
                    <s:element minOccurs="0" maxOccurs="1" name="HelloWorldResult" type="s:string"/>
                </s:sequence>
            </s:complexType>
        </s:element>
    </s:schema>
</wsdl:types>
<wsdl:message name="HelloWorldSoapIn">
    <wsdl:part name="parameters" element="tns:HelloWorld"/>
</wsdl:message>
<wsdl:message name="HelloWorldSoapOut">
    <wsdl:part name="parameters" element="tns:HelloWorldResponse"/>
</wsdl:message>
<wsdl:message name="NewMessage">
    <wsdl:part name="detail" element="tns:HelloFault"/>
</wsdl:message>
<wsdl:portType name="Service1Soap">
    <wsdl:operation name="HelloWorld">
        <wsdl:input message="tns:HelloWorldSoapIn"/>
        <wsdl:output message="tns:HelloWorldSoapOut"/>
        <wsdl:fault name="FaultName" message="tns:NewMessage"/>
    </wsdl:operation>
</wsdl:portType>
<wsdl:binding name="Service1Soap12" type="tns:Service1Soap">
    <soap12:binding transport="http://schemas.xmlsoap.org/soap/http"/>
    <wsdl:operation name="HelloWorld">
        <soap12:operation soapAction="http://tempuri.org/HelloWorld" soapActionRequired="" style="document"/>
        <wsdl:input>
            <soap12:body use="literal"/>
        </wsdl:input>
        <wsdl:output>
            <soap12:body use="literal"/>
        </wsdl:output>
        <wsdl:fault name="FaultName">
            <soap12:fault name="FaultName" use="literal"/>
        </wsdl:fault>
    </wsdl:operation>
</wsdl:binding> 
```

生成：

```
namespace tempuri.org
{

using System.Runtime.Serialization;

[System.Diagnostics.DebuggerStepThroughAttribute()]
[System.CodeDom.Compiler.GeneratedCodeAttribute("System.Runtime.Serialization", "3.0.0.0")]
[System.Runtime.Serialization.DataContractAttribute(Name="HelloFault", Namespace="http://tempuri.org/")]
public partial class HelloFault : object, System.Runtime.Serialization.IExtensibleDataObject
{

    private System.Runtime.Serialization.ExtensionDataObject extensionDataField;

    public System.Runtime.Serialization.ExtensionDataObject ExtensionData
    {
        get
        {
            return this.extensionDataField;
        }
        set
        {
            this.extensionDataField = value;
        }
    }
} 
```

}

但是合同中声明的其他类型声明时没有命名空间？

```
[System.Diagnostics.DebuggerStepThroughAttribute()]
[System.CodeDom.Compiler.GeneratedCodeAttribute("System.ServiceModel", "3.0.0.0")]
[System.ServiceModel.MessageContractAttribute(IsWrapped=false)]
public partial class HelloWorldRequest
{
... 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-03-05T23:49:05.603

您必须在 svcutil 上使用**/UseSerializerForFaults**属性，这将导致 XmlSerializer 用于读取和写入错误（但仅限于那些），而不是默认的 DataContractSerializer（仍将用于其余内容）。

这似乎是一个真正的错误 - 在我的[博客文章](http://dotnetbutchering.blogspot.com/2010/03/add-service-reference-duplicates.html)中有更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T22:29:45.593

我不确定我是否理解问题所在......你能澄清一下吗？

从外观上看，WCF 似乎在做正确的事情……根据您显示的 WSDL 片段中的架构，生成的类在 [DataContract] 属性中具有正确的命名空间 URI。

你期待什么？

**更新：**好的，我明白你在说什么，但在这种特殊情况下，这也不意外。如果您仔细观察，请注意您提到的另一个类 (HelloWorldRequest) 是消息契约，而不是数据契约。消息契约本身没有命名空间，尽管它们可以为围绕消息主体的包装元素指定命名空间（请参阅[WrapperNamespace](http://msdn.microsoft.com/en-us/library/system.servicemodel.messagecontractattribute.wrappernamespace.aspx)属性）。

在您的情况下，消息合同指定它未包装，因此 WrapperNamespace 无论如何都不会适用。

**更新 #2：**关于 CLR 命名空间（而不是 XML 命名空间 URI），SvcUtil 确实为您提供了一种控制它的方法；查看[文档](http://msdn.microsoft.com/en-us/library/aa751905.aspx)中的 /namespace: 参数。

# c# - Button_Click(object sender... 中的“发件人”真的是发件人吗？

> ID：660340
> 
> 赞同：3
> 
> 时间：2009-03-18T22:25:55.180
> 
> 标签：c#, event-driven-design

Ted Faison 在[关于基于事件的软件设计的播客中](http://www.dotnetrocks.com/default.aspx?showNum=355)提到 .NET、C++ 和 Java 事件语句中的“sender”和“self”对象，例如：

```
private void Button_Click(object sender, RoutedEventArgs e) 
```

是用词不当，因为例如在上面的示例中，“发送者”实际上并不是产生事件的对象，而是代理，因为您不希望将应用程序紧密耦合。

我是不是理解错了（因为当我调试它时，“发件人”确实似乎是原始对象）。

或者这些语言中的常见事件模式（例如常见的点击处理程序）是紧密耦合的，但它们*应该*更加解耦，例如在复合应用程序中。

他还提到，例如，您不应该从 EventArgs 继承，因为它会导致类爆炸式增长，每个事件一个，它只传输几个变量。在他看来，很多时候，您可以发送一个字符串。他提到，这种观点与微软模式和实践所建议的相反。

对这些领域有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T22:57:33.483

首先-“发件人”将持有对您单击的按钮的引用。如果您有多个按钮都连接到同一个事件，这就是您如何查看您点击了哪个按钮（如果您没有在事件参数中传递某些内容来阅读此内容）。

此外，我在某种程度上同意编写继承 frmo EventArgs 的新 eventargs 会导致类爆炸——因此请谨慎使用。我喜欢只引发一个 EventArgs.Empty，然后让代码捕获事件显式查询引发数据事件的对象。我的意思是 - 一旦你捕捉到事件，而不是从事件参数中读取数据，而是转到引发事件的对象并读取你感兴趣的属性。这使得阅读你需要的内容变得更容易，但当然 - 您可能会发现自己处于这些属性在引发的事件和您读取属性之间发生变化的情况。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T23:00:26.300

在大多数情况下，`sender` *是*`Button`引发事件的（或其他）。在某些情况下情况*并非*如此 - 例如（可能是懒惰的）直通事件：

```
class Foo {
   private Bar bar;
   public Foo(Bar bar) {
       this.bar = bar;
   }
   public event EventHandler SomeEvent {
       add {bar.SomeEvent += value;}
       remove {bar.SomeEvent -= value;}
   }
   //...
} 
```

在这里，如果我们订阅 foo.SomeEvent，我们实际上会取回由`Bar`实例发起的事件 - 所以`sender` *不会*`foo`。但这可以说是因为我们实施`Foo.SomeEvent`不正确。

老实说，在大多数情况下你不需要检查`sender`；这很有用的主要时间是当许多控件共享一个处理程序时。您通常应该能够假设发件人是您订阅的实例（出于引用相等测试的目的）。

重新`EventArgs`- 标准模式（创建新事件类型时）会*建议*您继承此模式。我不建议偏离这一点。一个次要原因是它允许您使用`EventHandler<T>`，但也有其他差异原因。此外——有时做别人期望的事情就足够了；人们*期望*一个`EventArgs`派生值。

也就是说 - 我之前做过非标准事件（在 MiscUtil 的 Push LINQ 中） - 但这已经是一个非常不寻常的设置，所以它并不觉得不合适。

# spring - 在 Spring 中缓存持久数据（例如代码书）的最佳方式？

> ID：660348
> 
> 赞同：2
> 
> 时间：2009-03-18T22:28:26.907
> 
> 标签：spring, caching, object

我的数据库中有一系列代码书，我使用普通的 JDBC 调用来获取它们并将它们存储在一个集合中。我想在应用程序启动时将它们放在某种缓存中，以便以后节省时间。

我不需要像自动对象失效、TTL 等任何花哨的东西——代码书很少改变，所以我会自己触发更新，并在需要时重新加载整个缓存。

我需要这个的项目使用了 Spring，这是我第一个使用它的项目。在 Spring 中有没有标准/优雅的方法来做到这一点？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T22:32:24.293

查看[Spring-cache](http://sourceforge.net/projects/spring-cache/)。

> 支持 EHCache、OSCache 和内存缓存，但也允许可插入的缓存提供程序。

# java - If-else 替代方案

> ID：660349
> 
> 赞同：2
> 
> 时间：2009-03-18T22:28:32.413
> 
> 标签：java, arrays, if-statement

我有一个我正在编写的程序，它的工作原理是填充一个二维数组来检查获胜条件，它是 noughts 和 crosss，所以二维数组是在单击按钮时填充的，1 代表一个圆圈，2 代表一个交叉，那么 checkWin() 将按照这个原则工作，而不是实际的代码......

```
if (myArray[0][0] == 1 && myArray[0][1] == 1 && myArray[0][2] == 1){
    setBoolWinVal = true;
} else {
    if(myArray[0][0] == 2 && myArray[0][1] == 2 && myArray[0][2] == 2){
    setBoolWinVal = true;
} 
```

您可以立即看到，对于每一个获胜条件，这都会很混乱，有没有办法重写这个获胜检查以缩短一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-18T22:33:40.950

这看起来像家庭作业，所以我不会完全放弃它。但请注意以下几点：

*   当你在一行、一列或沿对角线上拥有三个相同的东西时，你就赢了。

*   不是你需要检查一行中是否有三个零或三个十字，而是一行中是否有*三个相同的东西*。

您可以从编写一个函数开始，该函数确定行、列或对角线是否具有三个相同类型的东西（并且那个东西不是空白单元格）。然后为每一行、每一列和对角线调用一次该函数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T22:43:47.573

这是（未经测试的）代码。这肯定不是生产质量`:)`

请注意其他答案的一些优化：

1.  for循环的使用
2.  我们检查*相同*的玩家价值，而不是特定的玩家价值
3.  对角线获胜必须通过单元格[1][1]

.

```
int find_winner(int[][] arr) {

    // check rows
    for (int i = 0; i < 3; ++i) {
        int player = arr[i][0];
        if (player < 1) continue; // nb: prior version didn't check for empty cells
        if (arr[i][1] == player && arr[i][2] == player) return player;
    }

    // check cols
    for (int i = 0; i < 3; ++i) {
        int player = arr[0][i];
        if (player < 1) continue;
        if (arr[1][i] == player && arr[2][i] == player) return player;
    }

    // check diagonals
    int player = arr[1][1];
    if (player < 1) return -1;

    if ((arr[0][0] == player && arr[2][2] == player) ||
        (arr[2][0] == player && arr[0][2] == player)) return player;

    // no winner found
    return -1;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T22:43:40.567

显而易见的方法是循环遍历行、列或对角线中的 3 个元素并检查它们是否相同。

另一种方法是使用更紧凑的表示 - 例如，一个 int，其中 9 个单元由每个 2 位表示，或者两个短裤，每个玩家一个。然后使用查找表或按位运算来映射状态以输赢。

如果单个位表示一个单元格，并且您有一个填充位，则每个玩家的图块都是 3 个十六进制数字 0-7。

对角线是：

```
cells & 0x421 == 0x421
cells & 0x124 == 0x124 
```

垂直线是：

```
cells & (cells>>4) & (cells>>8) != 0 
```

水平线

```
cells & (cells>>1) & (cells>>2) != 0 
```

使用 64 位模式使用类似的技术来表示国际象棋游戏中可能的移动。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T22:45:19.800

两个有趣的想法：（我假设底层的一维数组，因为它让生活更轻松。）

**第一：**对要测试的位置进行编码。就像您有描述您的字段的一维数组一样：

```
diag[] = { { 0, 1, 2}, {3, 4, 5}, {6, 7, 8},
           { 0, 3, 6}, {1, 4, 7}, {2, 5, 8},
           { 0, 4, 8}, {6, 4, 2}}; 
```

然后遍历 diag: 对于其中的每个元素，测试三个相应的字段（`diag[i]`用作字段数组的索引）。

**第二：**使用位域来表示您的字段。像 java.util.BitSet。然后将解决方案编码为位域，如 {1, 1, 1, 0, 0, 0, 0, 0, 0}, {0, 0, 0, 1, 1, 1, 0, 0, 0} 等。然后你可以测试（循环） if `(field & solution[i] == solution[i])`。对于第二个玩家，只需`!field`在 if 语句中使用。

有趣，不是吗？ps：由你来制作工作的Java代码！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-18T22:36:43.080

家庭作业的气味。

小提示 - 使用 for 循环，它适用于您想要的任何大小。如果您改用递归，则可以加分。

定义：递归 -> 参见递归

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T04:22:46.243

您也可以迭代地解决这个问题：

1.  为每个列、行和对角线的每种类型的标记生成一个数组。初始化为零。
2.  对于网格中的每个条目，如果它有一个标记，则为该标记增加相应的列、行和对角线条目。
3.  如果这些条目中的任何一个等于棋盘的尺寸，则该标记获胜。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-19T04:35:43.233

一个简单而优雅的解决方案 - 您可以通过以下方式将数字 1 到 9 分配给您的电路板：

**8 1 6
3 5 7
4 9 2** 

*这个正方形有一个独特的特点，即每行、每列和每对角线的总和为 15，并且除非* 它们共享一行、列或对角线，否则无法从三个单元格中得到 15 的总和。

对于每个玩家，您保留两个布尔数组：

```
boolean squarePairs[PAIRSMAXSUM+1];
boolean chosenSquares[NUMSQUARES+1]; 
```

其中 PAIRSMAXSUM = 9+8 和 NUMSQUARES = 9

然后，您可以通过调用此函数轻松检查获胜动作：

```
boolean hasWon(int squareIndex) {
    return squarePairs[WINNINGSUM - squareIndex];
} 
```

其中 WINNNINGSUM 为 15。如果该函数返回 false，则通过调用此函数来更新布尔数组：

```
void update(int squareIndex) {
    for (int i = 1; i <= NUMSQUARES; i++) {
        if (chosenSquares[i]) {     {
            squarePairs[i + squareIndex] = true;
        }
    }
    chosenSquares[squareIndex] = true;
} 
```

就那么简单！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-18T22:52:34.367

因此，如果您考虑一下，您正在检查以下条件：

```
www   xxx   xxx  wxx
xxx   www   xxx  xwx
xxx   xxx   www  xxw 
```

ETC

其中 w 是要检查胜利的，而 x 是要忽略的。

(0,0),(0,1),(0,2) 是第一个正确解中“w”的位置。1,0、1,1 和 1,2 是第二个，以此类推。

这在我看来应该是数据而不是代码。诀窍是，如何有效地输入和存储数据。

请注意，此数据开始看起来像您的数组索引。

因此，假设您有一组“解决方案”，其中包含 8 个 x,y 对（每个都表示获胜的解决方案组合）

然后你所要做的就是遍历这个集合，提取三个 x,y 对并测试它们。所以它与你所拥有的类似，但在你有数字的地方使用变量。

```
if(myArray[x0][y0] == 2 && myArray[x1][y1] == 2 && myArray[x2][y2] == 2){
    win(); 
```

当您对其进行迭代时，索引变量将被您的数据的下一行替换。

由于您不想在获胜后报告损失，因此您将不得不稍微调整一下逻辑以确保您的循环停止，但这对于家庭作业式问题可能已经有太多帮助了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-19T01:41:38.673

这听起来确实有点像家庭作业，但我会帮助解决遍历行和列的简单问题，检查它们是否都已满，对角线稍微难一些，我把它留给你。同样，我相信嵌套的 for 循环将是最好的主意：

```
java.util.Arrays;

public yourClass{

public void findAnswer{

int initialVal = 0;

int copy = 0;

int column = 0;

boolean columnVal = true;

boolean rowVal = false;

for (int j = 0; j< myArray.length; j++){ //presuming myArray and myArray[] are same length

boolean firstRun = true;

    for (int i = 0; i <myArray.length; i++){

        initialVal = myArray[i][column];
        if (firstRun == true){
            copy = intialVal; //makes a copy for the first time, to compare
            firstRun = false;
        }
        if (intialVal != copy){
            columnVal = false; //realises this column isnt a full column i.e. 3 1's or 2's in column
            return;
        }else
            columnVal = true;

        }//end nested for loop

    rowVal = findRow(j); 
    if(rowVal = true)
    return;
}

public boolean findRow(int row){

    int[] tempRow1, tempRow2;
    Arrays.fill(tempRow1, 1); 
    Arrays.fill(tempRow2, 2); //fills temp arrays for comparison
    boolean answer = false;
    if (Arrays.equals(myArray[], tempRow1) || Arrays.equals(myArray[], tempRow2) //this tests either, || being logical OR
        answer = true;
    return answer;
}
} 
```

* * *

注意这段代码没有测试，而且很快就编码了，所以看起来不太好，可以细化，我也没有实现对角线。ps 如果是家庭作业，最好在网上查资料，自己动手做，而不是找别人帮你做。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-19T02:11:23.050

1.  将 board 表示为 0..19683（第 3 到第 9）中的 int
2.  预先生成获胜板并确定谁是每个板上的获胜者，也许是手动的
3.  在运行时在您预先计算的地图中查找当前板

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-19T03:46:49.607

对于 n X n 矩阵...

```
//Check all horizontal rows
for(i=0; i<n && !setBoolWinVal; i++) //row
{
    setBoolWinVal = true;
    for(j=0; j<n-1; j++)
    {
        if( myArray[i][j] != myArray[i][j+1] ) //column
        {
            setBoolWinVal = false;
            break;
        }
    }

    if(setBoolWinVal) declareWinner(myArray[i][0]);
}

//Check all vertical columns
if(!setBoolWinVal)
{
    for(i=0; i<n && !setBoolWinVal; i++) //column
    {
        setBoolWinVal = true;
        for(j=0; j<n-1; j++) //row
        {
            if( myArray[j][i] != myArray[j+1][i] ) 
            {
                setBoolWinVal = false;
                break;
            }
        }
    }

    if(setBoolWinVal) declareWinner(myArray[0][i]);
}

//Check forward diagonal
if(!setBoolWinVal)
{
    setBoolWinVal = true;
    for(i=0; i<n-1; i++)
    {
        if( myArray[i][i] != myArray[i+1][i+1])
        {
            setBoolWinVal = false;
            break;
        }
    }

    if(setBoolWinVal) declareWinner(myArray[0][0]);
}

//Check reverse diagonal
if(!setBoolWinVal)
{
    setBoolWinVal = true;
    for(i=0, j=n-1; i<n-1 && j>0; i++, j--)
    {
        if( myArray[i][j] != myArray[i+1][j-1])
        {
            setBoolWinVal = false;
            break;
        }
    }

    if(setBoolWinVal) declareWinner(myArray[0][n-1]);
} 
```

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-03-18T22:39:15.773

如果数组的长度都相同，那么以下内容应该会有所帮助。

```
Arrays.equals(myArray[0], {1,1,1}) 
```

否则，编写一个循环遍历`myArray[0]`.

# ruby-on-rails - 从 Rails 代码创建 ERD 类型图

> ID：660358
> 
> 赞同：22
> 
> 时间：2009-03-18T22:30:27.527
> 
> 标签：ruby-on-rails, ruby, oop, diagram, erd

我开始学习 Ruby on Rails，并查看其他人的代码。有没有办法获取现有的代码库并创建对象关系图或实体关系图（ERD）？

我知道 Visio 可以在给定数据库的情况下做一些事情，但我希望生成类和对象的图表。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2011-03-04T12:41:35.190

**[Rails ERD](http://rails-erd.rubyforge.org/)**也**不错**。它比铁路简单一点，但它仍然是一个**伟大的项目**。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-18T22:40:38.267

您可能想查看[铁路](http://railroad.rubyforge.org/)。它需要您的 Rails 项目并将其可视化。它可以根据您的模型（基于 has_many、has_and_belongs_to_many 等）、控制器（基于继承层次结构）和我从未使用过的状态机图创建图表。

但它非常酷，并且做了它应该做的事情。它可能没有 Visio 的所有天赋，但它是一个非常好的解决方案。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-03-04T12:56:07.353

如果我没记错的话，一些 IDE 有这个特性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-09-04T06:15:10.923

Rails ERD 具有出色的文档和图库： [http ://rails-erd.rubyforge.org/gallery.html](http://rails-erd.rubyforge.org/gallery.html)

# c# - Castle.Windsor 使用拦截器注册所有类型

> ID：660360
> 
> 赞同：2
> 
> 时间：2009-03-18T22:30:58.773
> 
> 标签：c#, castle-windsor, registration, iinterceptor

为什么以下不拦截使用 LogAspect 对 IBusinessService 的调用？

```
container.Register(AllTypes.Of<IBusinessService>()
    .FromAssembly(Assembly.GetExecutingAssembly())
    .ConfigureFor<BusinessService>(
        c => c.Named(typeof(BusinessService).Name)
            .Interceptors(InterceptorReference.ForType<LogAspect>()).Anywhere)); 
```

如果我使用 Component.For 语法注册 IBusinessService 的每个实现，那么它就可以工作。

# ruby-on-rails - Rails 守护进程处于开发模式

> ID：660366
> 
> 赞同：1
> 
> 时间：2009-03-18T22:32:30.813
> 
> 标签：ruby-on-rails, daemon

我有一个带有守护进程的 Rails 应用程序，它检查邮箱是否有任何新电子邮件。我正在为此任务使用[Fetcher插件。](http://github.com/look/fetcher/tree/master)守护程序文件如下所示：

```
#!/usr/bin/env ruby
require File.dirname(__FILE__) + '/../config/environment.rb'

class MailFetcherDaemon < Daemon::Base

  @config = YAML.load_file("#{RAILS_ROOT}/config/mail.yml")
  @config = @config['production'].to_options

  @sleep_time = @config.delete(:sleep_time) || 20
  def self.start
    puts "Starting MailFetcherDaemon"
    # Add your own receiver object below
    @fetcher = Fetcher.create({:receiver => MailProcessor}.merge(@config))
  ... 
```

所以我让它抓取新的电子邮件，解析它们并从解析的数据中创建一个资源。但是当它试图保存资源时会抛出异常。这是因为脚本会自动分配开发环境。所以它使用我的开发数据库配置而不是生产环境（这是我想要的配置）。

我尝试使用以下方式启动脚本：

```
 rails-root$ RAILS_ENV=production; script/mail_fetcher start 
```

但无济于事。似乎当我加载 environment.rb 文件时，它只是默认为开发环境并从 database.yml 加载 development.rb 和开发数据库配置。

想法？建议？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-10-14T02:08:25.587

这在我的应用程序中有效，我看到的唯一区别是没有分号

```
RAILS_ENV=production script/mail_fetcher start 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T22:58:26.320

所以当你说

```
RAILS_ENV=production; script/mail_fetcher start 
```

你的意思是

```
#!/bin/bash
export RAILS_ENV=production
cd /path/to/rails_root
./script/mail_fetcher start 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T01:02:26.880

您可以尝试将其添加到您的脚本中：

```
ENV['RAILS_ENV'] = "production" 
```

或者，将其添加到命令行可能会起作用。

```
#!/bin/bash
cd /path/to/rails_root
./script/mail_fetcher start RAILS_ENV=production 
```

# c# - 长在 64 位机器上

> ID：660372
> 
> 赞同：3
> 
> 时间：2009-03-18T22:34:49.730
> 
> 标签：c#, .net, types

在 64 位机器上是长 128 位吗？

**编辑：**重复问题；看到[x64 上的 sizeof(int) 了吗？](https://stackoverflow.com/questions/651956/sizeofint-on-x64).

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-18T22:36:31.100

在 32 位和 64 位机器上：

*   `long`是 64 位的，它是`System.Int64`.
*   `int`是 32 位的，它是`System.Int32`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T22:36:17.467

不... 64位

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T22:48:27.310

long.MinValue 和 long.MaxValue 是你的朋友

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-18T23:50:43.807

Scott Hanselman 对 .Net 的 32 位与 64 位问题进行了很好的总结。

[你可以在这里](http://www.hanselman.com/blog/BackToBasics32bitAnd64bitConfusionAroundX86AndX64AndTheNETFrameworkAndCLR.aspx)找到帖子。

# asp.net-mvc - 我可以让 ASP.NET MVC Html.RouteLink() 为我的主页返回一个没有 ID 的 url 吗？

> ID：660373
> 
> 赞同：4
> 
> 时间：2009-03-18T22:34:55.253
> 
> 标签：asp.net-mvc, routing, url-routing, html-helper

我的`Global.asax.vb`页面中有一条这样的路线......

```
Shared Sub RegisterRoutes(ByVal routes As RouteCollection)
    routes.IgnoreRoute("{resource}.axd/{*pathInfo}")
    路线.MapRoute(_
        “IdOnly”，_
        “{ID}”， _
        新的 {.controller = "Page", _
                  .action = "详细信息", _
                  .id = "7"} _
    )
结束子

```

那`id`是我的主页。当有人导航到我的时显示：`http://example.com/`

但是，这也有效： `http://example.com/7`

我希望在我的网站上的任何地方都没有指向地址`id`为 7 的链接。但是，该`Html.RouteLink()`函数会生成这些链接。

对于作为主页子级的视图模型......

```
<%=Html.RouteLink(Model.Parent.Title, _
                  "IdOnly", _
                  New With {.id = Model.Parent.Id})%> 
```

…生成以下锚标记：

```
<a href="/7">Home</a> 
```

如何覆盖由我的主页函数`href`生成的？`Html.RouteLink()`

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T20:06:43.847

在主页的“IdOnly”路由之前添加一个新路由：

```
routes.MapRoute( _
    "HomePage", _
    "", _
    New With {.controller = "Page", _
              .action = "Details", _
              .id = "7"} _
) 
```

`RouteLink`将使用路由表中第一个匹配的映射来生成链接。

# clickonce - 如何在卸载 clickonce 应用程序时打开浏览器窗口

> ID：660374
> 
> 赞同：0
> 
> 时间：2009-03-18T22:35:41.320
> 
> 标签：clickonce, uninstallation

我正在通过 clickonce 部署我的应用程序。

我想在卸载应用程序时弹出一个自定义 url。是否可以？

（...并以卸载为由邀请用户使用池）

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-18T22:50:36.573

我认为这是不可能的，因为 ClickOnce 安装/卸载过程是自动处理的。我认为他们没有办法扩展它。

实现此目的的一种略显丑陋的方法是提供您自己的引导式 MSI，并让您的 ClickOnce 部署将其作为先决条件。然后您将安装 2 个应用程序，即您的 prereq MSI 和实际的 ClickOnce 应用程序。

# html - 使用 Firefox 和 ASP.NET MVC 的 DropDownList

> ID：660376
> 
> 赞同：0
> 
> 时间：2009-03-18T22:35:53.770
> 
> 标签：html, asp.net-mvc, firefox

我已经在这个问题上打了一堵砖墙大约一个小时了。我有一个县列表，我构建并添加到我的视图数据（县）中，然后`html.DropDownList('invoice.county', counties)`在我的视图中使用：呈现列表。

它似乎可以正确渲染，但 FF **REFUSES 拒绝**设置所选项目。我尝试将值换成整数（因此它们与显示文本不匹配），但没有奏效。FF 只显示列表中的第一项

```
<select id="invoice_county" name="invoice.county">
   ...
   <option value="Lander">Lander</option>
   <option selected="selected" value="Laramie">Laramie</option>
   <option value="Larimer">Larimer</option>
   ...
</select> 
```

我已将值修剪为所选项目周围的值。

任何人都可以让我对此有所了解吗？？？？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-19T09:51:04.347

Firefox 有一个奇怪的错误/功能，这意味着如果您只是刷新页面，它将选择已选择的选项，而不管所选属性是否在另一个选项上。例如，如果我输入：

```
<select id="invoice_county" name="invoice.county">
   <option value="Lander">Lander</option>
   <option selected="selected" value="Laramie">Laramie</option>
   <option value="Larimer">Larimer</option>
</select> 
```

在 Firefox 中保存并刷新，然后输入：

```
<select id="invoice_county" name="invoice.county">
   <option selected="selected" value="Lander">Lander</option>
   <option value="Laramie">Laramie</option>
   <option value="Larimer">Larimer</option>
</select> 
```

而是在保存后刷新，它将保持选中“Laramie”。要停止这种情况，请尝试 Ctrl-F5 而不是 F5 或刷新。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T09:26:39.150

如果您使用的是 XHTML，则需要一个有效的属性/值对：

```
<option selected="selected" value="x"> 
```

如果您使用的是 HTML，则仅存在该属性就足够了：

```
<option selected value="x"> 
```

[有关 W3C 的更多信息](http://www.w3.org/TR/html4/interact/forms.html#edef-OPTION)。

# error-handling - 对关键任务流程进行防错的步骤

> ID：660397
> 
> 赞同：3
> 
> 时间：2009-03-18T22:46:01.513
> 
> 标签：error-handling, mission-critical

我正在编写一个程序，它将持续处理放置在热文件夹中的文件。

该程序应该有 100% 的正常运行时间，无需管理员干预。换句话说，它不应该因“愚蠢”错误而失败。即有人删除了它应该简单地重新创建它并继续前进的输出目录。

我正在考虑做的是对整个程序进行编码，然后通过查找“错误点”，然后添加代码来处理错误。

我要避免的是添加错误或不必要的错误处理，甚至将错误处理构建到程序的控制流中（即错误处理控制程序的流）。好吧，也许它*可以*在一定程度上控制流程，但这将构成糟糕的设计（主观）。

有哪些“防错”“关键”过程的方法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T22:53:22.760

如果您的流程必须是防错的并且没有管理员干预，那么您*必须*处理所有可能的错误。如果你留下任何停止程序的机会，它*就会*发生（墨菲定律），你不会知道。

即使处理所有可能的错误，我认为您需要一些日志记录，甚至需要带有（邮件？）警报的监视器，以确保您的进程始终运行良好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T23:02:15.203

**最重要的事情是以单元测试的形式记录你的假设。**您应该编写一个违反每个假设的测试，然后证明您的程序成功恢复或采取措施使该状态再次变为真。

使用您的示例，如果有人可以删除关键文件夹，请进行模拟此的测试，然后显示您的程序可以处理这种情况而不会崩溃。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T22:51:58.830

[单元测试。](http://en.wikipedia.org/wiki/Unit_testing)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T23:13:53.473

进行彻底分析的技术是[HAZOP 研究](http://en.wikipedia.org/wiki/Hazop)，其中对于过程的每个部分，您都考虑该过程的关键字。对于加工厂中的化学品，这些可能是“更多”、“更少”、“缺失”、“更热”、“更冷”、“泄漏”、“压力”等等。

将[HAZOP 应用于软件](http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.56.6073)时，您会考虑适合软件中对象的关键字。

例如，对于读取文件，您可能会认为“更多”是缓冲区溢出、“更少”丢失数据、“丢失”不存在、“泄漏”缺少文件句柄等等。

# php - 当存在较新版本的依赖软件时覆盖 yum 依赖检查

> ID：660398
> 
> 赞同：3
> 
> 时间：2009-03-18T22:46:06.117
> 
> 标签：php, dependencies, centos, yum

我在 CentOS 5.1 上使用 yum - 我从源代码手动编译 PHP 5.2.8，但使用 yum 安装了其他软件包。我需要通过 pecl 安装一个 PHP 扩展，它也需要安装 phpize。但是，执行以下操作会产生依赖错误：

> sudo yum install php-devel

错误：缺少依赖项：php-devel 包需要 php = 5.1.6-20.el5_2.1

由于我实际上已经安装了更新版本的 PHP，我如何强制 yum 忽略它？我需要从源代码手动编译 pecl/phpize 吗？诚然，我以前从未遇到过问题，这似乎只是因为编译和 yum 安装的组合。

有什么想法吗？

谢谢，凯尔

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-02-22T15:40:31.423

一般来说：

如果你自己构建它，它会进入`/usr/local`，并且只能被`/usr/local`.

如果你从 RPM/Yum 安装，它会进入`/usr`，并且可以被`/usr`和访问`/usr/local`。

因此，如果您想使用家庭编译的 PHP 安装 PHP 工具，请将它们`/usr/local`也安装到：通常，对于 GNU 类型的软件，它类似于：

```
 ./configure --prefix=/usr/local && make && sudo make install 
```

或者

```
 make prefix=/usr/local all && sudo make prefix=/usr/local install 
```

…尽管*大多数*软件应该默认为，`/usr/local`除非您覆盖其前缀设置。

如果你想“手工构建”基于 RPM 的包，你可以使用

```
 yumdownloader --source WHATEVER-PACKAGE
   rpm -i WHATEVER-PACKAGE.rpm
   rpmbuild -bp ~/rpm/SPECS/WHATEVER-PACKAGE.spec 
```

（您的等效路径`~/rpm`可能会有所不同；`rpmbuild --showrc`会告诉您在哪里）

这会下载`.src.rpm`包，其中包含上游（原作者的）源（通常是 tarball）以及特定于操作系统的补丁；将源安装到`~/rpm`（或您的 rpmbuild 前缀）；然后解压缩源并将补丁应用到`~/rpm/BUILD/WHATEVER-PACKAGE/`

从那里，您可以自己执行配置/制作步骤，带有`/usr/local`前缀

当然，仅从 RPM 安装要容易得多 :-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-23T19:20:21.753

`yum`对您手动编译的 php 版本一无所知。您可以通过使用安装包来绕过 RPM 的依赖关系解析，`rpm --nodeps`并希望它能正常工作。

或者将你自己编译的php版本安装在另一个目录中，这样它就可以和yum的旧版本共存，所以每个人都很高兴（不确定这是否可能，我想这取决于你的应用程序是否使用硬编码的php路径） .

[或者，如果幸运的话， EPEL](http://fedoraproject.org/wiki/EPEL)或[RPMForge](https://rpmrepo.org/RPMforge)等第三方存储库可能有更新的 php 包，因此您不必自己编译。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T23:10:21.580

根据经验，最好在系统中有一个包管理，因此最好将所有内容打包在 RPMS 中并通过 yum 进行管理。从长远来看，它将为您节省大量时间。

如果您绝对想从源代码中手动获得某些东西（fe PHP）编译器，请使用 stow/checkinstall/... 或任何其他解决方案，使您能够对源代码编译的东西进行基本的包管理。

Regerding 您的问题，您可以尝试通过下载所需软件包的 RPM 并执行“rpm -i --force file.rpm”来覆盖依赖性检查，因为 yum 没有任何强制安装选项

# matlab - 难以在 MATLAB UI 中实现保存/加载对象功能

> ID：660399
> 
> 赞同：1
> 
> 时间：2009-03-18T22:46:11.777
> 
> 标签：matlab, matlab-load

我正在尝试在 MATLAB (R2009a) UI 中实现保存/加载功能。我的对象实现了一个为对象生成用户界面的布局函数。我正在尝试实现保存/加载按钮的回调。保存按钮起作用并将对象保存到以后可以加载的 MAT 文件中。

我的问题是实现加载按钮的回调。我似乎无法从 MAT 文件中加载数据并更新新对象的属性。非常感谢任何关于我哪里出错的建议以及关于我如何进行的建议。

重要的代码是我的类定义文件当然我的实际对象实现了更多的属性和方法，但这是我所拥有的框架

```
classdef myObj<handle
   properties
       image % property holds a matlab image matrix
       objCount % number of objects in image
   end

   properties(Transient=true)
       parent
       children
   end

   methods
       function myObj
           % empty constructor
       end

       function load_object(self)
            % ask user for file
            [fileName, pathToFile]=uigetfile('*.mat','Select .mat file');
            tmp = load(fullfile(pathToFile,fileName);
            if isfield(tmp,'obj')
                self = tmp.obj;
            end
       end
       LayoutFcn(self) % UI layout function
   end
end 
```

UI 布局在一个单独的文件*LayoutFcn.m*中定义，基本上看起来像

```
function LayoutFcn(self)
% create figure window and add various UI elements
...
% create load button
self.children(end+1) = uipushtool('Parent',hToolbar, ... % set parent to current toolbar
                   'CData',iconRead('open-document.png'), ... % read icon image from file
                   'Tag','uiLoad', ...
                    'ClickedCallback',@(hObj,event)loadingMyObject(self,hObj,event));

% create save button
self.children(end+1) = uipushtool('Parent',hToolbar, ... % set parent to current toolbar
                   'CData',iconRead('save-document.png'), ... % read icon image from file
                   'Tag','uiSave', ...
                    'ClickedCallback',@(hObj,event)savingMyObject(self,hObj,event));

...
end

function loadingMyObject(self,hObj,event)
     self.load_object; % call load_object method defined above in class definition
end

function savingMyObject(self,hObj,event)
     [fileName,pathName]=uiputfile('.mat','Save object to MAT file');
      obj = self;
      save(fullfile(pahtName,fileName),'obj')
end 
```

**注意：**我使用的是 MATLAB R2009a。

该代码不会引发任何错误。在方法*load_object中调用**LOAD*之后，我编写父对象（由*self*表示）的代码的方式不会得到更新。所以，这有预期的效果：

 **```
>> var = myObj;
>> var.load_object; 
```

但是，如果我 以这种方式使用*LayoutFcn.m中定义的**loadingMyObject*回调

 *```
>> var = myObjl
>> var.LayoutFcn
-> click Load button to call _loadingMyObject_ 
```

不影响*var*属性。也就是说*var*在单击 Load 按钮后仍将具有其默认属性值。

1.  [按照gnovice](https://stackoverflow.com/questions/660399/stumped-trying-to-implement-save-load-object-functionality-in-a-matlab-ui/660791#660791)的建议将加载方法更改为使用*set*会引发以下错误

    > ？？？使用 ==> 从 FujiCalibration 将转换设置为 double 时出错是不可能的。

    即使我为每个属性设置/获取方法；如在

    ```
    method set.image(self,II)
       % ... some data validation code ...
       self.image = II
    end 
    ```

2.  使用循环来设置[Fooz 先生](https://stackoverflow.com/questions/660399/stumped-trying-to-implement-save-load-object-functionality-in-a-matlab-ui/660649#660649)建议的每个字段并不是一个真正的选择，因为我的全班有公共常量，当它们被设置时会抛出错误。

我正在寻找一种解决方案，以避免我不得不单独手动设置每个字段的代码。尽管在这一点上，这似乎是唯一的可能性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T00:35:46.663

不要给自己赋值。所做的只是在方法调用的范围内替换对 self 变量的绑定。它不会调用神奇的复制构造函数来替换调用者中的对象引用。相反，将字段复制到 self. 尝试类似：

```
if isfield(tmp,'obj')
   self.image = tmp.obj.image;
   self.objCount = tmp.obj.objCount;
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T01:47:50.360

我相信[福兹先生](https://stackoverflow.com/questions/660399/stumped-trying-to-implement-save-load-object-functionality-in-a-matlab-ui/660649#660649)是对的。传递给 load_object 的 self 变量是“myObj”类型的对象，但行：

```
self = tmp.obj; 
```

只是用存储在 tmp.obj 中的结构覆盖 self 变量。正在做：

```
self.image = tmp.obj.image; 
```

应该改为为对象 self 的图像属性调用集合运算符。在 MATLAB 文档中有一个[示例类定义](http://www.mathworks.com/access/helpdesk/help/techdoc/matlab_oop/brqy3km-24.html)，其中包含一个名为“set.OfficeNumber”的方法来说明这一点。

此外，您的函数 SavingMyObject 中的以下行可能是不必要的：

```
obj = self; 
```

我认为如果您在类代码中使用名称“obj”代替单词“self”（文档倾向于这样做），这可能最有意义（并使代码更清晰）。“self”在 MATLAB 中似乎不是任何类型的特殊关键字（就像在其他语言中一样）。据我所知，这只是另一个变量。=)

编辑＃1：

如果必须在您的 load_object 方法中单独设置每个属性的前景听起来并不有趣，那么一种解决方法是，如果您的对象有一个 SET 方法，其设计类似于[用于处理图形的 SET 方法](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/set.html)。该 SET 命令可以接受结构输入，其中每个字段名称是属性名称，每个字段值是该属性的新值。然后你会接到一个电话，比如：

```
set(self,tmp.obj); 
```

相当短一些，特别是如果你有很多属性要设置。当然，您随后必须为您的对象*编写*新的 SET 方法，但如果在其他地方也能派上用场，缩短的语法可能值得额外的工作。=)

编辑＃2：

您可以将[Fooz 先生](https://stackoverflow.com/questions/660399/stumped-trying-to-implement-save-load-object-functionality-in-a-matlab-ui/660649#660649)建议的循环与[try/catch](http://www.mathworks.com/access/helpdesk/help/techdoc/ref/try.html)块结合使用：

```
fn = fieldnames(tmp.obj);
for i = 1:numel(fn),
  try
    self.(fn{i}) = tmp.obj.(fn{i});
  catch
    % Throw a warning here, or potentially just do nothing.
  end
end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T19:22:15.730

结合[Fooz 先生](https://stackoverflow.com/questions/660399/stumped-trying-to-implement-save-load-object-functionality-in-a-matlab-ui/660649#660649)和[gnovice 的](https://stackoverflow.com/questions/660399/stumped-trying-to-implement-save-load-object-functionality-in-a-matlab-ui/660791#660791)建议，我添加了一个具有以下定义的 SET 函数

```
function set(self,varargin)
    if isa(varargin{1},'FujiCalibration')
        tmp = varargin{1};
        fns = fieldnames(self);
        for i = 1:length(fns)
            if strcmpi(fns{i}(1:2),'p_')
                self.(fns{i}) = tmp.(fns{i});
            end
        end
        self.calibImage = tmp.calibImage;
    else
        proplist=fields(self);
        for n=1:2:length(varargin)
            tmp = proplist(strcmpi(proplist,varargin{n}));
            value = varargin{n+1};
            switch length(tmp)
                case 0
                    msg = char(strcat('There is no ''', varargin{n}, '''property'));
                    error('FujiCalibration:setPropertyChk',msg)
                case 1
                    tmp = char(tmp);
                    self.(tmp) = value;
            end
        end  
    end
end 
```

然后我按照 gnovice 的建议通过更改修改了*load_object方法*

```
self = tmp.obj 
```

到

```
set(self,tmp.obj). 
```

我需要确保具有我想要保留的值的属性以'p_'为前缀。

感谢 gnovice 和 Fooz 先生的回答。

# unit-testing - 单元测试“SetDefaults()”方法

> ID：660400
> 
> 赞同：2
> 
> 时间：2009-03-18T22:47:12.073
> 
> 标签：unit-testing

我正在学习单元测试。我有一个“域对象”，除了保持状态（即`Employee`没有任何业务逻辑）之外，它并没有多大作用。它有一个方法`SetDefaults()`可以用合理的值填充它的状态。一个简单的方法。

但是当我对这个方法进行单元测试时，我能想到的就是运行该方法，然后检查每个字段是否应该是它应该是的。喜欢（在`C#`）：

```
 [TestMethod()]
    public void SetDefaultsTest()
    {
        Employee target = new Employee();

        employee.SetDefaults();

        Assert.AreEqual(employee.Name, "New Employee");
        Assert.AreEqual(employee.Age, 30);
        // etc.
    } 
```

在我的测试中复制 SetDefaults() 的全部功能感觉不对。我应该不测试这种方法吗？问题是我想要一个测试来确保当新属性被添加到类时，它们也被添加到 SetDefaults() 方法中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T22:55:33.550

琐碎的 getter 和 setter 有时没有为它们编写单元测试。如果这就是 SetDefaults() 所做的一切，那么跳过它可能不会有什么坏处。

但是，您需要考虑测试的一件事是，`employee`调用后实例的所有设置属性都不是 null `SetDefaults()`：

```
var nonNullProperties = new object[] { employee.Name, employee.Age, ... };
foreach (var property in nonNullProperties)
  Assert.IsNotNull(property); 
```

这是有道理的，因为您真的只关心它们*被*设置为某个默认值，而不是它们是*特定*值。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T22:57:25.557

这取决于您从该测试中获得什么价值。不要仅仅为了测试而测试。但是，如果这些默认值对于正确且不可更改很重要，那么请继续。

许多测试涉及决定“嘿，从长远来看，这会让我的工作更轻松吗？” 这些默认值是一直在变化，还是恒定不变？默认值是否非常复杂，或者它们是少数字符串和数字？这些默认设置是否正确对客户来说有多重要？默认值正确对其他开发人员有多重要？

测试可以做一百万件事，但如果它不能为关心它的人增加一些价值，那就不要担心。如果您被要求对所有代码进行 100% 的自动化测试，那么阅读和讨论以下博客中提出的一些想法可能会使您的团队受益：

[http://blog.jayfields.com/2009/02/thoughts-on-developer-testing.html](http://blog.jayfields.com/2009/02/thoughts-on-developer-testing.html) [http://msdn.microsoft.com/en-us/magazine/cc163665.aspx](http://msdn.microsoft.com/en-us/magazine/cc163665.aspx)

否则，如果它没有增加太多价值或不断中断，我会说继续并忽略它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T23:02:23.020

对我来说，这看起来是一个非常合理的单元测试。您正在提供一个简单的测试来检查调用该方法的结果。但是，它对任何新属性都没有帮助，因为现有的测试仍然可以通过。也许您可以使用反射来遍历对象的所有属性并检查它们是否为非空？

也`SetDefaults()`似乎是一个有点奇怪的方法。为什么不`Employee`从这些值开始初始化一个新值呢？这样就不会有另一个编码员创建一个`Employee`并忘记调用的风险`SetDefaults()`。

# mysql - 如何将 MySQL 中的列默认值分配给另一列的值？

> ID：660417
> 
> 赞同：6
> 
> 时间：2009-03-18T22:55:45.093
> 
> 标签：mysql, default, alter

我想在 MySQL 数据库中的表中添加一个新列，该列应该获取同一个表中另一列的值。这可能吗？如果是这样，你怎么做？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T22:59:57.113

从 MySQL 5.0.2 开始，您可以编写一个链接到 a 的存储过程，[`TRIGGER`](http://dev.mysql.com/doc/refman/5.0/en/triggers.html)该过程可以在每次插入一行时检查新列，如果没有为新列提供值，则自动将另一列的值复制到新列中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-01-22T07:21:59.657

您可以使用以下两个命令来完成您的工作。

1.  此命令将用于在您的表中添加新列。记住要复制的数据类型，以便在新列中使用这些数据类型。

    ```
    ALTER TABLE table_name ADD new_column_name VARCHAR(60); 
    ```

2：此命令将数据从旧列名复制到新列名。

```
 UPDATE table_name SET new_column_name = old_column_name; 
```

然后如果要删除上一列，则可以使用以下命令

```
 ALTER TABLE table_name DROP COLUMN old_column_name; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-12-13T06:51:15.860

截至 20101212 mysql 不支持默认 2 个时间戳列，这意味着您不能在同一张表上执行“创建”和“更新”。

如果这是您尝试做的事情，那么使用存储过程的触发器就是要走的路。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-08T01:06:44.663

创建一个视图，您可以两次选择同一列并为其命名，然后应用程序可以使用视图而不是直接使用表。

# c - 如何从套接字读取所有服务器的响应？

> ID：660421
> 
> 赞同：1
> 
> 时间：2009-03-18T22:57:55.807
> 
> 标签：c, sockets

我有一个非常大的问题...我正在使用 C 中的套接字。我向服务器发送一个请求，该服务器向我发送了许多响应。问题是客户端收到第一个响应，然后连接被关闭。我能做些什么？我试过`setsockopt()`... SO_KEEPALIVE 或 SO_LINGER 但我还没有解决问题。你能帮助我吗？非常感谢

* * *

这里更清楚的是代码。在一定时间后或客户端收到第一个响应后，套接字会自动关闭......我不确定。

```
char* demarre_client( client_args * c_args,char* message, /*char* SERVEUR_PORT*/int port){
int socket_client=socket(PF_INET,SOCK_STREAM,0);
memset(&(c_args->adresse_serveur),0,sizeof(c_args->adresse_serveur));
c_args->adresse_serveur.sin_family=AF_INET;
c_args->adresse_serveur.sin_addr.s_addr=inet_addr(SERVEUR_IP);
//int port=APHash(SERVEUR_PORT,strlen(SERVEUR_PORT));
c_args->adresse_serveur.sin_port=htons(port);
int err=0;

if ((err=connect(socket_client, (struct sockaddr *) &(c_args->adresse_serveur), sizeof(c_args->adresse_serveur)))<0)
{
    printf("CONNECT error %d\n", errno);
    exit(-1);
}
if (send(socket_client, message, strlen(message), 0)!=strlen(message))
{
    printf("send error!!\n");
    exit(-2);
}
char* raspFin=(char* )malloc(sizeof(char)*1024);
strcpy(raspFin,"");
int num=-1;
int nn=0;
char* rasp=(char* )malloc(sizeof(char)*1024);
memset (rasp, 0, 1024 * sizeof(char ));
    /* here it reads the first response and after he get out of while */
while ((num=recv(socket_client, rasp,1024,MSG_WAITALL))>0)
{
    printf("recu %s mun=%d\n" , rasp,num);
    strcat(raspFin,rasp);
    strcat(raspFin,"\n");
    rasp=(char* )malloc(sizeof(char)*1024);
    memset (rasp, 0, 1024 * sizeof(char ));

}

if (num<0)
{
    printf("rasp error!!\n");
    exit(-3);
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T07:50:32.203

您确定在第一次通话时没有得到所有回复吗？

TCP/IP 是没有内置流控制的流协议，因此使用单独`send()`调用发送的不同消息可以在一个中接收`recv()`。因为您使用`printf()`，它会打印缓冲区，直到它看到空终止符 - 可能是终止符之外的其他响应？

尝试使用一些流控制，例如发送消息长度前缀或使用一些特殊字符（如 STX/ETX，但请确保您的消息不包含此类字符）。如果您打算使用此软件，则无论如何都需要实施一些流量控制。

现在尝试`printf()`用

```
char *ptr;
for (ptr = buffer; ptr <= buffer + num; ptr += strlen(ptr)+1;)
    printf("%s\n", ptr); 
```

它将打印响应缓冲区中的所有字符串。

而且你不需要`malloc()`在循环内部 - 你会泄漏内存。

顺便说一句`SO_KEEPALIVE`，与`SO_LINGER`这个问题无关。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T09:16:29.267

我的建议是启动[Wireshark 网络分析器](http://www.wireshark.org/)，看看数据包发生了什么。在过滤器集中

```
tcp.srcport == <insert_server_port> || tcp.dstport == <insert_server_port> 
```

您应该看到实际发送到哪些数据以及谁关闭了连接（发送 FIN/RST 数据包）。

# c - 从两个线程在同一个阻塞套接字上调用 recv()

> ID：660422
> 
> 赞同：10
> 
> 时间：2009-03-18T22:58:16.447
> 
> 标签：c, sockets, system, recv

如果我有一个套接字，`s`当前没有可用的数据，它是一个阻塞套接字，并且我`recv`同时从两个线程调用它，会发生什么？其中一个线程会获取数据吗？双方都会得到吗？第二次调用会`recv`返回错误吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-18T23:42:38.600

一个线程会得到它，没有办法告诉它。

这似乎不是一个合理的设计。为什么需要两个线程`recv()`在同一个套接字上调用是有原因的吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T23:23:53.153

套接字实现应该是线程安全的，因此只有一个线程应该在数据可用时获取数据。另一个电话应该只是阻塞。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T23:49:33.733

我找不到这方面的参考，但这是我的理解：

供应商对**线程安全**的保证可能仅意味着多个线程可以各自安全地使用自己**的**套接字；它不保证单个调用的**原子性，也不保证套接字数据在多个线程之间的任何特定分配。**

假设线程 A 在一个套接字上调用 recv()，该套接字以高速率接收 TCP 数据流。如果 recv() 需要是原子调用，那么线程 A 可以阻止所有其他线程执行，因为它需要连续运行以提取所有数据（直到它的缓冲区已满，无论如何）。好的。因此，我不会假设 recv() 不受上下文切换的影响。

相反，假设线程 A 在 TCP 套接字上对 recv() 进行了**阻塞**调用，并且数据进入缓慢。因此，对 recv() 的调用返回时将 errno 设置为 EAGAIN。

在这两种情况下，假设线程 B 在同一个套接字上调用 recv()，而线程 A 仍在接收数据。线程 A 什么时候停止接收数据，以便线程 B 可以开始接收数据？我不知道 Unix 实现会尝试记住线程 A 正在套接字上的操作中间；相反，由应用程序（线程 A 和 B）来协商他们对它的使用。

通常，最好将应用程序设计为只有一个线程会在单个套接字上调用 recv()。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-27T21:34:03.150

从recv的[手册页](http://www.mkssoftware.com/docs/man3/recv.3.asp)

> SOCK_STREAM 套接字上的 recv() 返回与提供的缓冲区大小一样多的可用信息。

假设您使用的是 TCP，因为问题中没有指定它。所以假设你有线程 A 和线程 B 都阻塞在 socket 的 recv() 上。一旦 s 有一些数据要接收，它将解除阻塞其中一个线程，比如说 A，并返回数据。就我们而言，返回的数据将是一些随机大小。线程 A 检查接收到的数据并确定它是否具有完整的“消息”，其中消息是应用程序级别的概念。

线程 A 确定它没有完整的消息，因此它再次调用 recv()。但与此同时，B 已经阻塞在同一个套接字上，并且已经收到了用于线程 A 的其余“消息”。我在这里松散地使用了预期。

现在线程 A 和线程 B 都有一个不完整的消息，并且会根据代码的编写方式将数据作为无效数据丢弃，或者导致奇怪和微妙的错误。

我希望我可以说我从经验中不知道这一点。

因此，虽然 recv() 本身在技术上是线程安全的，但如果您将它用于 TCP，那么让两个线程同时调用它是一个坏主意。

据我所知，使用 UDP 是完全安全的。

我希望这有帮助。

# php - 有没有办法让 FPDF/FPDI 或 Zend_Pdf 支持解析大于 1.4 的 PDF？

> ID：660425
> 
> 赞同：13
> 
> 时间：2009-03-18T22:59:10.267
> 
> 标签：php, zend-framework, fpdf, zend-pdf, fpdi

我正在尝试将现有 PDF（以其他方式创建）添加到使用 FPDI 使用 FPDF 创建的 PDF。它似乎适用于大多数 PDF，但我收到以下错误：

```
FPDF error: Unable to find xref table. 
```

经过一些测试，我发现如果我使用 1.4 或更低版本（Acrobat v5 或更低版本）的 PDF 版本，它似乎可以工作。查看文件似乎是因为 PDF 格式不同。

有解决方法或解决方案吗？我可能有 10 000 多个用户上传的 PDF，其中一些是新的，有些不是。FPDI 只是死掉而不是导致某种错误甚至返回 false 也很烦人

我现在能想到的唯一解决方案是解析 PDF 文件的第一行以确定版本，并且只添加那些可以工作的版本。

**编辑：**

我也在 Zend_Pdf 中进行了尝试，使用 Zend 框架附带的演示文件得到了以下结果：

```
Fatal error: Uncaught exception 'Zend_Pdf_Exception' with message 'Cross-reference streams are not supported yet.' in /Volumes/Documents/temp/ZendFramework-1.7.7/library/Zend/Pdf/Parser.php:331
Stack trace:
#0 /Volumes/Documents/temp/ZendFramework-1.7.7/library/Zend/Pdf/Parser.php(455): Zend_Pdf_Parser->_loadXRefTable('116')
#1 /Volumes/Documents/temp/ZendFramework-1.7.7/library/Zend/Pdf.php(297): Zend_Pdf_Parser->__construct('/Volumes/Docume...', Object(Zend_Pdf_ElementFactory_Proxy), true)
#2 /Volumes/Documents/temp/ZendFramework-1.7.7/library/Zend/Pdf.php(250): Zend_Pdf->__construct('/Volumes/Docume...', NULL, true)
#3 /Volumes/Documents/temp/ZendFramework-1.7.7/demos/Zend/Pdf/demo.php(37): Zend_Pdf::load('/Volumes/Docume...')
#4 {main}
  thrown in /Volumes/Documents/temp/ZendFramework-1.7.7/library/Zend/Pdf/Parser.php on line 331 
```

是否无法解析大于 1.4 的 PDF？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-07-23T23:41:43.310

您可以将 FPDI 与 TCPDF 一起使用，它将生成和读取（使用 FPDI）1.7 版 PDF。

请参阅[PDF 的 TCPDF-PHP 类](http://sourceforge.net/projects/tcpdf/)。

* * *

**编辑**

我最近遇到了在 FPDI 和 TCPDF 中使用各种版本和格式的 PDF 的问题，我可以确认 1.4 以上的 PDF 版本是命中注定的，有趣的是我有很多工作的 1.7 PDF，并且在 1.5 和 1.6 上工作大约 50/50。

我通过使用 GhostScript 将所有不可用的 PDF 文件转换为 v1.4 来解决这个问题，您可以`exec`从命令行中使用它。`ps2pdf14`从 GhostScript`lib`文件夹中使用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-10-01T02:45:59.507

我刚刚发布了一对项目（[TCPDI](https://github.com/pauln/tcpdi) / [tcpdi_parser](https://github.com/pauln/tcpdi_parser)，分别基于 FPDI 和 tcpdf_parser ），它们与 TCPDF 6（和 FPDF_TPL）一起使用以导入高于 v1.4 的 PDF（到目前为止已测试到 1.6，但我会一旦我找到一个 1.7 PFD 来测试它，请确保它与 1.7 一起工作！）不需要任何商业插件。基本的安装和使用说明可以在[TCPDI README](https://github.com/pauln/tcpdi/blob/master/README.md)中找到；请随时尝试并通过 Github 跟踪器报告任何问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-11-27T10:26:39.160

Setasign 提供 PDF 解析器作为 FPDI 的[商业插件](http://www.setasign.de/products/pdf-php-solutions/fpdi-pdf-parser/)。到目前为止，使用新的解析器解析 PDF 文件直到 1.7 版都没有问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-02-13T05:30:20.500

我发现使用商业版的[FPDI PDF-Parser](http://www.setasign.de/products/pdf-php-solutions/fpdi-pdf-parser/)解决了我的问题。我已经使用它一年了，没有任何它无法解析的 PDF（除非 PDF 已损坏或发生其他奇怪的事情）。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2016-02-19T10:39:30.033

对于 symfony，我使用这个库转换 >1.4 [https://packagist.org/packages/xthiago/pdf-version-converter](https://packagist.org/packages/xthiago/pdf-version-converter)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-01-23T00:52:57.193

如果您有 Acrobat PDF writer，您可以操作作业设置以使您正在打印/保存的 PDF 与 PDF 1.4 兼容。由于我需要这个产品的微小原因，花 100 欧元来获得与 1.4 以上版本兼容的商业版本似乎不值得。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2012-04-05T07:54:52.773

我的团队已经删除了部分代码。我们阻止了代码向 pdf 添加水印。这为我们解决了问题。PDF >= 1.5

# sql - Trigger event is fired only once for Microsoft SQL Server 2005 DB if more than one rows updated?

> ID：660432
> 
> 赞同：2
> 
> 时间：2009-03-18T23:00:18.203
> 
> 标签：sql, sql-server, sql-server-2005

I have a table MyTable with a trigger defined like this:

```
ALTER TRIGGER [MyTableInsertDeleteUpdate] 
  ON  [dbo].[MyTable]
 AFTER  INSERT,DELETE,UPDATE
AS 
DECLARE @id int;
BEGIN
   SELECT @id = ins.id FROM inserted ins;
   IF (@id IS NOT NULL)
   BEGIN
      -- insert a new record to audit table
      PRINT 'inserted/updated id: ' + CAST(@id AS VARCHAR);
   END
END 
```

I realize that if more than one rows are updated like this,

```
UPDATE MyTable SET name = 'test rows' WHERE id in (1, 2, 3); 
```

the tigger is called only once and only the firstone in [inserted] is updated. Actually, [inserted] may have more than one rows (3 in this case if id 1, 2,3 exist). In order words, the trigger is not fired on each row. Is that right?

I am using Microsoft SQL Server 2005.

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T23:07:40.120

Yeah the trigger is fired once per statement (not once per row) that makes the changes you are subscripting to. It will even fire if no rows where affected.

[http://msdn.microsoft.com/en-us/library/ms189799(SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms189799(SQL.90).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T09:02:26.477

As Hojou said, your trigger will fire once per statement rather than once per affected row. This is different to databases like Interbase and Firebird, and threw me when I first started using SQL Server.

The whole point of the inserted and deleted 'virtual' tables is because the events are record-SET based, not row-based.

There are any number of tutorials out there that cover writing sql to process the inserted/deleted tables, but watch out for the shovelware ones. I've seen more than a couple of so-called tutorials that have just been copy/pasted from another database platform and won't actually work in SQL Server as they claim to (one of the top hits for 'SQL Server trigger example' in Google gets it completely wrong for UPDATE statements).

[This](http://www.sqlteam.com/article/an-introduction-to-triggers-part-i) is a reasonable introduction to Triggers and the concepts required to make sense of the inserted and deleted tables, with an explanation of why you will be missing events in your own example. The Microsoft docs themselves are reasonably useful once you get past their dull, lifeless structure and writing-style.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T13:27:53.687

To insert records to an audit table from an insert you would do something like this in the trigger:

```
insert auditable (field1, field2, insert_date, insertedBy)
select field1, field2, getdate(), user_Name() from inserted 
```

No fooling around with setting variables just a a plain insert based on a select statment.

Personally I would have a separate trigger for inserts, updates and deletes as you want differnt code for each.

# java - 是什么让热部署成为“难题”？

> ID：660437
> 
> 赞同：46
> 
> 时间：2009-03-18T23:02:29.663
> 
> 标签：java, jvm, hotdeploy

在工作中，我们一直遇到“ [PermGen 内存不足](http://www.jroller.com/agileanswers/entry/preventing_java_s_java_lang)”异常的问题，团队负责人认为这是 JVM 中的错误 - 与代码的热部署有关。他在没有解释很多细节的情况下指出，热部署是一个“难题”，难到连 .NET 都做不到。

我发现很多文章从鸟瞰角度解释热部署，但总是缺乏技术细节。谁能指出我的技术解释，并解释为什么热部署是“一个难题”？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-03-18T23:16:52.517

当一个类被加载时，关于该类的各种静态数据被存储在 PermGen 中。只要存在对此 Class 实例的实时引用，就不能对该类实例进行垃圾回收。

我相信部分问题与 GC 是否应该从 perm gen 中删除旧的 Class 实例有关。通常，每次热部署时，都会将新的类实例添加到 PermGen 内存池中，而现在未使用的旧类实例通常不会被删除。默认情况下，Sun JVM 不会在 PermGen 中运行垃圾收集，但这可以通过可选的“java”命令参数启用。

因此，如果您热部署的次数足够多，您最终将耗尽您的 PermGen 空间。

**如果您的 Web 应用程序在取消部署时没有完全**关闭——例如，如果它让一个线程运行——那么该 Web 应用程序使用的所有 Class 实例都将固定在 PermGen 空间中。您重新部署，现在将所有这些 Class 实例的另一个完整副本加载到 PermGen 中。您取消部署，线程继续运行，将另一组类实例固定在 PermGen 中。您重新部署并加载一整套网络副本......最终您的 PermGen 会填满。

您有时可以通过以下方式解决此问题：

*   向最近的 Sun JVM 提供命令参数以在 PermGen 和类中启用 GC。那是： `-XX:+UseConcMarkSweepGC -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled`
*   使用不使用固定大小的 PermGen 或在加载的类上执行 GC 的不同 JVM

但这**只有**在您的 Web 应用程序完全干净地关闭时才会有所帮助，不会留下对该 Web 应用程序的类加载器加载的任何类的任何类实例的实时引用。

由于类加载器泄漏，即使这样也不一定能解决问题。（在某些情况下还有太多的实习字符串。）

查看以下链接了解更多信息（两个加粗的链接有很好的图表来说明问题的一部分）。

*   **[类加载器泄漏：可怕的“java.lang.OutOfMemoryError: PermGen space”异常](http://frankkieviet.blogspot.com/2006/10/classloader-leaks-dreaded-permgen-space.html)**
*   **[未知的一代：烫发](http://dev.eclipse.org/blogs/memoryanalyzer/2008/05/17/the-unknown-generation-perm/)**
*   [呈现永久一代](http://blogs.oracle.com/jonthecollector/entry/presenting_the_permanent_generation)
*   [Tomcat Wiki：如何处理内存不足错误](http://wiki.apache.org/tomcat/OutOfMemory)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-18T23:37:43.090

一般而言，问题是Java的安全模型实际上试图阻止已经加载的类再次加载。

当然Java从一开始就支持动态类加载，难的是类的重加载。

正在运行的 java 应用程序被注入带有恶意代码的新类被认为是有害的（并且有充分的理由）。例如来自互联网的 java.lang.String 破解实现，它不是创建字符串，而是删除一些调用方法 length() 的随机文件。

因此，他们构思 Java 的方式（因此我认为 .NET CLR，因为它在 JVM 中受到高度“启发”）是为了防止已经加载的类再次加载同一个 VM。

他们提供了一种机制来覆盖这个“特性”。类加载器，但是类加载器的规则是，在尝试加载新类之前，它们应该向“父”类加载器请求许可，如果父类已经加载了该类，则忽略新类。

例如，我使用了从 LDAP 或 RDBMS 加载类的类加载器

当应用服务器成为 Java EE 的主流时，热部署成为 Java 世界的必需品（并且还需要像 spring 这样的微容器来避免这些负担）。

每次编译后重新启动整个应用服务器都会让任何人发疯。

所以应用服务器提供商，提供这个“自定义”类加载器来帮助热部署，并使用配置文件，这种行为，应该在生产中设置时被禁用。但权衡是您必须在开发中使用大量内存。所以这样做的好方法是每 3 到 4 次部署重新启动一次。

其他从一开始就设计为加载其类的语言不会发生这种情况。

例如，在 Ruby 中，您甚至可以将方法添加到正在运行的类中，在运行时覆盖方法，甚至可以将单个方法添加到唯一的特定对象。

这些环境中的权衡当然是内存和速度。

我希望这有帮助。

**编辑**

前段时间我发现这个产品承诺重新加载尽可能简单。当我第一次写这个答案时，我不记得链接了，我记得。

它是[来自 ZeroTurnaround 的 JavaRebel](http://www.zeroturnaround.com/javarebel/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T23:47:34.300

Sun JVM 修复了 PermGen 空间，但最终都被消耗掉了（是的，显然是由于类加载器相关代码中的错误）=> OOM。

如果您可以使用其他供应商的 JVM（例如 Weblogic 的 JVM），它会动态扩展 PermGen 空间，因此您将永远不会获得与 permgen 相关的 OOM。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T00:58:43.927

你用的是哪个版本的java？Sun 1.4.2 早期存在错误，但它已经工作了很长时间。
顺便说一句，你将如何向你的团队负责人传达这个消息？你是领队吗？

# language-agnostic - 完全缺乏计划和分析瘫痪的分界线在哪里？

> ID：660439
> 
> 赞同：6
> 
> 时间：2009-03-18T23:02:41.177
> 
> 标签：language-agnostic, project-planning

在我在编程领域工作的很短的时间里，我看到了两个极端：

*   几乎没有计划的项目，因此成为维护的噩梦。
*   永远处于规划阶段并且不会从那里移动的项目。

似乎后者经常作为对前者的反应而发生。快乐的媒介在哪里？更重要的是，如果一个项目正朝着这些方向之一发展，那么将其朝着上述快乐媒介发展的最佳方式是什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T23:46:31.930

根据我个人的经验，**我发现“决定”是我的瓶颈**。

如果是这种情况，那么：

1.  列出所有设计选项
2.  选择一个选项（如果您无法决定一个选项，请选择几个）
3.  列出最佳选择的风险
4.  对于每一个风险，头脑风暴一个解决方案，然后设计一个结论性的概念证明并编写它。
5.  如果你的概念证明证明它不起作用，那么就放弃那个选项，然后选择另一个。

“概念证明”是证明某事的*最小应用程序。*（我的通常是 1-6 小时）

如果您遇到两个或更多选项相同的情况，请给自己一个时间限制（例如 5 分钟，而不是 2 个月）并做出决定……任何决定，不要回头。

并相信自己能够处理您在设计时没有考虑到的任何问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-18T23:10:20.520

初始计划应大致为 O(log n)，其中 n 是预期的总开发时间。

如果你必须在一周内完成，请在餐巾纸上画一些东西。如果你有一个月的时间，第一天就是初始设计。如果你有一年，花一个星期。

这确实假设您迭代地重新审视计划，并且不要在没有成人监督的情况下在您的代码库中采用所有突击队风格:-)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-18T23:13:59.060

分析麻痹可能有许多症状。我注意到的一个问题是每次会议都会提出相同的问题，但没有达成任何解决方案。如果您可以向可能能够帮助他们承认规划过程停滞不前的人指出这一点。

如果可以，在项目开始时，声明您希望在规划阶段满足一定比例的需求，比如 80-90%。这样就有了一个明确的目标，而你不是在追求完美。您可以稍后重新审视计划和分析，只是不要让它阻碍事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T23:45:50.060

我认为这取决于两个因素：

*   项目**长度**_

    *   这是一个1周的项目吗？
    *   是1年的项目吗？
    *   或者介于两者之间？
*   项目中引入变更的**风险**

    *   它们是否在本质上是架构性的，可能会影响很多原始代码？
    *   或者您只是添加一个新功能？

显然，它是上述两个因素的组合。花 1 个月时间设计一个需要 2 天时间来实现并且对架构几乎没有风险的功能是没有意义的。我在这里描绘了一个长度/风险/设计时间权衡的矩阵。

Code Complete 2 中有一些有趣的建议，我目前正在阅读。我不记得确切的措辞，所以我在这里解释一下，但它说了一些类似的东西：

**您在设计中可能犯的两个最大错误是：**

```
1\. Attemping to design EVERYTHING (you will fail)
2\. Designing NOTHING before implementation 
```

**在这两者之间找到快乐的媒介是成功设计和规划的关键。**

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-20T16:40:05.440

伟大的问题——没有绝对的答案——这就是让经验变得有意义的原因。经验包括：

*   您实际上可以从任何用户/赞助商和该特定组中获得多少详细信息
*   您当前的团队需要多少细节（技术/业务特定技能水平）
*   您的赞助商/用户在开发过程中提供帮助的开放程度（您的团​​队有多敏捷——是否包括赞助商/用户？）
*   你发现差距有多好

一个重要因素是正在开发的系统——“生命”越重要，您需要的细节就越多（心脏监测器与网页相比）。

越复杂、越受成本/时间限制、对生命至关重要，前期工作就越多 - 在工作时您可以详细说明的越少（原型到生产）

# c# - C# XML 序列化 - 前导问号

> ID：660440
> 
> 赞同：9
> 
> 时间：2009-03-18T23:03:43.233
> 
> 标签：c#, xml-serialization

## 问题

[通过利用我在网上找到的](http://www.dotnetjohn.com/articles.aspx?articleid=173)一些示例，我编写了一些 XML 序列化方法。

*   **方法1：**序列化一个Object并返回：（a）类型，（b）xml字符串
*   **方法 2：**取上面的 (a) 和 (b) 并把 Object 还给你。

我注意到**Method1**中的 xml 字符串包含一个前导“？”。**使用Method2**重建对象时，这似乎很好。

但是在应用程序中进行一些测试时，有时我们会领先'???' 反而。这导致**Method2**在尝试重建 Object 时引发异常。在这种情况下，“对象”只是一个简单的 int。

> System.InvalidOperationException 未处理 Message="XML 文档 (1, 1) 中存在错误。" Source="System.Xml" StackTrace：在 System.Xml.Serialization.XmlSerializer.Deserialize(XmlReader xmlReader, String encodingStyle) 的 System.Xml.Serialization.XmlSerializer.Deserialize(XmlReader xmlReader, String encodingStyle) .Serialization.XmlSerializer.Deserialize(Stream stream) 在 XMLSerialization.Program.DeserializeXmlStringToObject(String xmlString, String objectType) 在 C:\Documents and Settings\...Projects\XMLSerialization\Program.cs:line 96 在 XMLSerialization.Program.Main (String[] args) 在 C:\Documents and Settings\...Projects\XMLSerialization\Program.cs:line 49

任何人都能够阐明可能导致这种情况的原因吗？

## 示例代码

这是我在编写代码时编写的迷你测试器的示例代码，它作为 VS 控制台应用程序运行。它会显示 XML 字符串。您还可以取消注释区域以附加额外的前导 '??' 重现异常。

```
 using System;
using System.IO;
using System.Text;
using System.Xml;
using System.Xml.Serialization;

namespace XMLSerialization
{
    class Program
    {
        static void Main(string[] args)
        {
            // deserialize to string
            #region int
            object inObj = 5;
            #endregion

            #region string
            //object inObj = "Testing123";
            #endregion

            #region list
            //List inObj = new List();
            //inObj.Add("0:25");
            //inObj.Add("1:26");
            #endregion

            string[] stringArray = SerializeObjectToXmlString(inObj);

            #region include leading ???
            //int indexOfBracket = stringArray[0].IndexOf('<');
            //stringArray[0] = "??" + stringArray[0];
            #endregion

            #region strip out leading ???
            //int indexOfBracket = stringArray[0].IndexOf('<');
            //string trimmedString = stringArray[0].Substring(indexOfBracket);
            //stringArray[0] = trimmedString;
            #endregion

            Console.WriteLine("Input");
            Console.WriteLine("-----");
            Console.WriteLine("Object Type: " + stringArray[1]);
            Console.WriteLine();
            Console.WriteLine("XML String: " + Environment.NewLine + stringArray[0]);
            Console.WriteLine(String.Empty);

             // serialize back to object
            object outObj = DeserializeXmlStringToObject(stringArray[0], stringArray[1]);

            Console.WriteLine("Output");
            Console.WriteLine("------");

            #region int
            Console.WriteLine("Object: " + (int)outObj);
            #endregion

            #region string
            //Console.WriteLine("Object: " + (string)outObj);
            #endregion

            #region list
            //string[] tempArray;
            //List list = (List)outObj;

            //foreach (string pair in list)
            //{
            //    tempArray = pair.Split(':');
            //    Console.WriteLine(String.Format("Key:{0} Value:{1}", tempArray[0], tempArray[1]));
            //}
            #endregion

            Console.Read();
        }

        private static string[] SerializeObjectToXmlString(object obj)
        {
            XmlTextWriter writer = new XmlTextWriter(new MemoryStream(), Encoding.UTF8);
            writer.Formatting = Formatting.Indented;
            XmlSerializer serializer = new XmlSerializer(obj.GetType());
            serializer.Serialize(writer, obj);

            MemoryStream stream = (MemoryStream)writer.BaseStream;
            string xmlString = UTF8ByteArrayToString(stream.ToArray());

            string objectType = obj.GetType().FullName;

            return new string[]{xmlString, objectType};
        }

        private static object DeserializeXmlStringToObject(string xmlString, string objectType)
        {
            MemoryStream stream = new MemoryStream(StringToUTF8ByteArray(xmlString));
            XmlSerializer serializer = new XmlSerializer(Type.GetType(objectType));

            object obj = serializer.Deserialize(stream);

            return obj;
        }

        private static string UTF8ByteArrayToString(Byte[] characters)
        {
            UTF8Encoding encoding = new UTF8Encoding();
            return encoding.GetString(characters);
        }

        private static byte[] StringToUTF8ByteArray(String pXmlString)
        {
            UTF8Encoding encoding = new UTF8Encoding();
            return encoding.GetBytes(pXmlString);
        } 

    }
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-18T23:30:32.030

当我以前遇到过这个时，它通常与编码有关。当您序列化对象时，我会尝试指定编码。尝试使用以下代码。另外，是否有任何特定原因需要返回`string[]`数组？我已将您的方法更改为使用泛型，因此您不必指定类型。

```
private static string SerializeObjectToXmlString<T>(T obj)
{
    XmlSerializer xmls = new XmlSerializer(typeof(T));
    using (MemoryStream ms = new MemoryStream())
    {
        XmlWriterSettings settings = new XmlWriterSettings();
        settings.Encoding = Encoding.UTF8;
        settings.Indent = true;
        settings.IndentChars = "\t";
        settings.NewLineChars = Environment.NewLine;
        settings.ConformanceLevel = ConformanceLevel.Document;

        using (XmlWriter writer = XmlTextWriter.Create(ms, settings))
        {
            xmls.Serialize(writer, obj);
        }

        string xml = Encoding.UTF8.GetString(ms.ToArray());
        return xml;
    }
}

private static T DeserializeXmlStringToObject <T>(string xmlString)
{
    XmlSerializer xmls = new XmlSerializer(typeof(T));

    using (MemoryStream ms = new MemoryStream(Encoding.UTF8.GetBytes(xmlString)))
    {
        return (T)xmls.Deserialize(ms);
    }
} 
```

如果您仍然有问题，请尝试`Encoding.ASCII`在您看到的任何地方使用您的代码`Encoding.UTF8`，除非您有使用 UTF8 的特定原因。我不确定原因，但我已经看到 UTF8 编码在序列化时的某些情况下会导致这个确切的问题。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T00:04:20.623

这是 BOM 符号。您可以删除它

```
if (xmlString.Length > 0 && xmlString[0] != '<')
{
    xmlString = xmlString.Substring(1, xmlString.Length - 1);
} 
```

或者使用UTF32序列化

```
using (StringWriter writer = new StringWriter(CultureInfo.InvariantCulture))
{
    serializer.Serialize(writer, instance);
    result = writer.ToString();
} 
```

并反序列化

```
object result;
using (StringReader reader = new StringReader(instance))
{
    result = serializer.Deserialize(reader);
} 
```

如果您仅在 .Net 应用程序中使用此代码，使用 UTF32 不会产生问题，因为它是 .Net 中所有内容的默认编码

# c# - PreviewLeftMouseButtonDown 侦听器报告同一事件的不同 MouseButtonEventArgs.Source

> ID：660441
> 
> 赞同：0
> 
> 时间：2009-03-18T23:05:20.703
> 
> 标签：c#, wpf, events, mouse

我在 WPF 中遇到了一些意想不到的行为。这是我的场景：

1.  我在窗口上有一个用户控件。我们称之为“表面”。它上面有一个画布。
2.  我有第二个用户控件。我们称之为“扑克牌”。
3.  我将 PlayingCard UserControl 添加为 Surface 画布的子项。从视觉上看，它在 Surface 顶部显示应有的效果。

这都是一个窗口中“表面”之间的一些拖放操作的设置。我首先将 Surface 类上的所有拖放事件单独连接起来，一切正常。我可以正确检测到鼠标下的 PlayingCard UserControl 并拖动它，使用 Adorner 进行反馈等。

然后我将拖放内容抽象为一个单独的静态类。突然，鼠标点击下检测到的UIElement不再是PlayingCard，而是Surface！

我目前有三个不同的事件处理程序连接到 Surface 的 PreviewLeftMouseButtonDown 事件，另外我正在覆盖 Surface 上的 OnPreviewLeftMouseButtonDown 方法。我希望所有这些方法之间的行为一致来处理这种方法，但我没有得到它。结果如下：

(1) 我有一个名为 Test 的实例化类，它上面有一个连接到 Surface 的 PreviewLeftMouseButtonDown 事件的方法。这发生在 Window 的 main 方法中。它将 Surface 而不是 PlayingCard 检测为 Source。

```
public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();

           TestClass test = new TestClass();
           _leftSurface.PreviewMouseLeftButtonDown += test.Test_PreviewMouseLeftButtonDown; 
```

(2) 我有一个名为 DragDropManager 的静态类，它也连接到 Surface 的事件，也在 Window 主方法中。它还将 Surface 检测为源，而不是 PlayingCard。

```
public Window1()
        {
            InitializeComponent();

           TestClass test = new TestClass();
           _leftSurface.PreviewMouseLeftButtonDown += test.Test_PreviewMouseLeftButtonDown;

            _leftSurface.PreviewMouseMove += DragDropManager.PreviewMouseMove; 
```

(3) 我正在覆盖 Surface 的 OnPreviewLeftMouseButtonDown 事件。它将 Surface 检测为源：

```
 protected override void OnPreviewMouseLeftButtonDown(MouseButtonEventArgs e)
        {
            base.OnPreviewMouseLeftButtonDown(e); 
```

(4) Surface 类有自己的事件处理程序，在 XML 中指定，它正确地检测到 PlayingCard 作为源。

```
<UserControl x:Class="WpfTest.Surface"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Height="300" Width="300">
    <Border Name="_border" BorderThickness="4" BorderBrush="Blue">
        <Canvas Name="_surface" Background="Black" AllowDrop="True"
                ClipToBounds="True"
                PreviewMouseMove="Surface_PreviewMouseMove"
                PreviewMouseLeftButtonDown="Surface_PreviewMouseLeftButtonDown"
                DragOver="Canvas_DragOver" DragLeave="Canvas_DragLeave">

        </Canvas>
    </Border>
</UserControl> 
```

将 PlayingCard 正确检测为 MouseButtonEventArgs.Source 的唯一事件处理程序是通过 XML 分配给 Surface 的事件处理程序。

为什么我会得到两个不同的结果？为什么其他事件处理程序不能正确地将 PlayingCard 报告为源？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T01:37:17.280

试试 e.OriginalSource。

# linux - 从命令行切换 GNOME 终端配置文件

> ID：660442
> 
> 赞同：12
> 
> 时间：2009-03-18T23:07:11.197
> 
> 标签：linux, terminal, profile, gnome

如果我在打开多个选项卡的情况下运行 gnome-terminal，是否可以在 bash 提示符下切换给定选项卡的配置文件，即时生效，并且不更改其他选项卡的配置文件？

我了解如何使用 gconftool 或 gconftool-2 更改配置文件的元素（例如背景），但我不知道如何实际切换特定选项卡或窗口的配置文件。

任何建议表示赞赏。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2014-06-18T17:39:04.700

它并没有特别回答您的问题，但是由于它可能对其他人有所帮助，因此无论如何我都将其留在这里。

如果有办法更改当前配置文件，您可以为每个选项卡设置不同的配置文件。

您可以使用以下方式列出所有现有配置文件：

```
gconftool-2 --all-dirs /apps/gnome-terminal/profiles 
```

您可以使用以下方法获取当前配置文件：

```
gconftool-2 --get /apps/gnome-terminal/global/default_profile 
```

您可以使用以下方法设置新的默认配置文件（`solarized-light`在这种情况下）：

```
gconftool-2 --set --type string /apps/gnome-terminal/global/default_profile solarized-light 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T23:41:17.870

我认为您可以通过 gconf-editor 执行此操作，该编辑器维护 gnome 中所有内容的设置。请参阅 gconf-editor[手册](http://www.gnome.org/~bmsmith/gconf-docs/C/index.html)和[gnome-terminal](http://www.gnome.org/~bmsmith/gconf-docs/C/gnome-terminal.html)部分。

从终端，您可以使用[gconftool-2进行更改](http://linux.die.net/man/1/gconftool-2)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-04-27T03:10:21.447

我正在研究类似的东西，我认为它可以帮助您使用`gnome-terminal --help` 它会向您显示一些命令，您可以使用这些命令打开具有某些配置文件的终端，您需要弄清楚如何在提示符下编写该行以使用选项卡和您想要的配置文件....一旦您弄清楚了困难的部分，您就可以将该行添加到您的 bashrc

运行`nano ~/.bashrc`以打开 bash 配置文件，每次打开终端时都会运行该文件。然后将该行添加到底部保存并关闭。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-10-25T11:07:01.957

尽管问题是关于 GNOME 终端和命令行的，但值得知道的是，MATE 终端（一个 GNOME 终端分支）允许通过简单的键盘快捷键切换配置文件。

# html - 动态内容重叠页脚但保留在内容流中？

> ID：660444
> 
> 赞同：5
> 
> 时间：2009-03-18T23:07:50.650
> 
> 标签：html, css

我的页脚如果很高，所以我想知道是否可以让内容稍微重叠，同时仍保留在内容流中？

我想另一种方法是使页脚高几千像素并将其放置在底部。不过，这不是一个优雅的解决方案，有人有更好的主意吗？

[http://www.digiflipconcepts.com/temporary-images/footer-overlap.jpg http://www.digiflipconcepts.com/temporary-images/footer-overlap.jpg](http://www.digiflipconcepts.com/temporary-images/footer-overlap.jpg)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T23:27:40.400

这似乎是个好主意。如果您需要重叠，则必须完成一些绝对位置。

将页脚绝对设置到页面底部和 z-index:0。然后你的内容 z-index:1 和 padding-bottom: （页脚高度 - 所需的重叠）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-18T23:32:10.123

您可以使用我不久前[在这个问题中找到的](https://stackoverflow.com/questions/42294/how-do-you-get-the-footer-to-stay-at-the-bottom-of-a-web-page)[粘性页脚](http://ryanfait.com/sticky-footer/)

我做了这个在 Firefox 中工作，但我不能让它在 IE 7 上玩得很好。任何人的帮助都会很棒。

**编辑：让它工作**

```
 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>A CSS Sticky Footer with Overlap</title>
<style type="text/css">
body {
    text-align: center;
}

.wrapper {
    margin: 0 auto -142px;
    position: relative;
    text-align: left;
    width: 700px;
}
.header {
    /*Go download the header yourself from http://ryanfait.com/sticky-footer/header.png
    Please don't steal the guy's bandwidth*/
    background: transparent url(header.png) no-repeat scroll 0 0;
    height: 160px;
}
.footer_bg {
    /*Go download the header yourself from http://ryanfait.com/sticky-footer/footer.jpg
    Please don't steal the guy's bandwidth*/
    background: transparent url(footer.jpg) no-repeat scroll 0 0;
    border: 1px solid blue;
    height: 100%;
    margin: 0 auto;
    width: 700px;
}

.footer {
    clear:both;
    border: 1px solid red;
    margin: 0 auto;
    position: relative;
    width: 100%;
}
.footer_bg p {
    bottom: 4px;
    color: #FFFFFF;
    left: 0;
    position: absolute;
    text-align: center;
    width: 100%;
}
* {
    margin: 0;
}
html, body {
    height: 100%;
}
.wrapper {
    height: auto !important;
    min-height: 100%;
}
.push {
    height: 142px;
    position: absolute;
}
.footer {
    height: 142px;
    z-index: -1;
}
#content {
    z-index: 10;
}

</style>
<link rel="stylesheet" type="text/css" media="screen" href="style.css" />
</head>
<body>
<div class="wrapper">
    <div class="header">
        <h1>CSS Sticky Footer</h1>
    </div>
    <div id="content">
        <h2>A CSS sticky footer that just works</h2>
        <p>We've all tried to use a <strong>sticky footer</strong> one time or another, but they never seem to come out right, do they? Well, the days of a hard to understand CSS-based <strong>sticky footer</strong> are thankfully over. In just a few simple CSS classes with minimal extra HTML markup, I've fashioned a <strong>sticky footer</strong> that even beginners can get a handle on. It's been tested in IE 5 and up, Firefox, Safari and Opera.</p>
        <h2>Usage of the CSS</h2>
        <p><q>Great! this is exactly what I'm looking for! Can I use it?</q></p>
        <p>Absolutely. There are no terms, licenses, fees or requirements. Use it as you will. If you find the kindness to link to me on your site, I'd appreciate it, but it's by no means necessary. Have fun, and don't be afraid to ask me any questions or send me your thoughts.</p>
        <p class="download"><a href="layout.css" title="Download the stylesheet">View the CSS</a> or <a href="/resources/footer-stick-to-bottom-of-page/" title="Make a footer stick to the bottom of a page">learn about using it</a></p>
    </div>
    <div class="push"></div>
</div>
<div class="footer">
    <div class="footer_bg">
        <p>Copyright &copy; 2006-2008 <a href="http://ryanfait.com/" title="Las Vegas Web Design">Ryan Fait</a></p>
    </div>
</div>
</body>
</html> 
```

# wcf - 使用 WCF REST 服务对 Windows 帐户以外的东西进行基本身份验证？

> ID：660445
> 
> 赞同：29
> 
> 时间：2009-03-18T23:08:34.517
> 
> 标签：wcf, rest

是否有一种干净的方法来公开需要基本身份验证的 WCF REST 服务，但我们自己处理用户名/密码的实际验证？似乎当您在配置中告诉 WCF 要使用基本身份验证时，它会强制您在 IIS 中打开基本身份验证，而 IIS 只能对窗口帐户进行基本身份验证。

我们发现的唯一黑客是对 WCF 撒谎并告诉它服务没有安全性，然后使用通用 IHttpModule 在 WCF 堆栈之外进行身份验证（它有一个专有配置文件来指示哪些 URL 具有哪些身份验证/授权要求）。

似乎应该有更好的方法。有人有吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-06-20T04:02:11.990

WCF REST Contrib 库启用此功能：

[http://github.com/mikeobrien/WcfRestContrib](http://github.com/mikeobrien/WcfRestContrib)

它还允许您保护单个操作。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-18T23:28:09.430

是客户端上设置的用户名和密码，例如：

```
cc.ClientCredentials.UserName.UserName = ReturnUsername();
cc.ClientCredentials.UserName.Password = ReturnPassword(); 
```

或者它们是否嵌入在 REST 消息的正文中？

如果是前者，您可以使用自定义 UserNamePasswordValidator：http: [//msdn.microsoft.com/en-us/library/aa702565.aspx](http://msdn.microsoft.com/en-us/library/aa702565.aspx)

如果是后者，您可以将服务设置为无安全性，并使用自定义 ServiceAuthorizationManager 来验证消息的内容：http: [//msdn.microsoft.com/en-us/library/ms731774.aspx](http://msdn.microsoft.com/en-us/library/ms731774.aspx)

希望其中之一有所帮助！我会尝试发布示例代码和配置，但我在@home 并且无权访问代码，这都是@work。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-02-05T22:32:13.467

请参阅[RESTful 服务的自定义基本身份验证](http://weblogs.asp.net/cibrax/archive/2009/03/20/custom-basic-authentication-for-restful-services.aspx)。Pablo 的方法使用通过 REST 入门工具包提供的拦截器功能来解决问题。如果您不想依赖 REST 入门工具包，那么您可以创建自己的服务主机并使用提供的拦截器功能。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-19T08:15:32.067

如果您将它托管在 IIS 上，则可以使用自定义 http 模块。您可以将委托人带到 WCF 端以进行代码访问安全性。请参阅[IIS/ASP.NET 中针对非 Windows 帐户的 HTTP 基本身份验证（第 3 部分 - 添加 WCF 支持）](http://www.leastprivilege.com/HTTPBasicAuthenticationAgainstNonWindowsAccountsInIISASPNETPart3AddingWCFSupport.aspx)。另请参阅[.NET 3.5/VS 2008 上 ASP.NET Web 服务的自定义 HTTP 基本身份验证](https://stackoverflow.com/questions/490627/custom-http-basic-authentication-for-asp-net-web-services-on-net-3-5-vs-2008)。

如果您不使用 IIS，您应该能够实现 userNameAuthentication。见[最后！WCF 中通过传输身份验证的用户名](http://www.leastprivilege.com/CommentView.aspx?guid=b0ed39eb-01d9-4711-8d38-92d932e2e8c3)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-06-02T02:55:51.500

是的，绝对有办法。您需要`userNamePasswordValidationMode`为您的服务配置一个自定义值，并将其指向一个具有可检查和验证提供的凭据的重写方法的类。在进行 RESTful 调用时，以适当形式使用基本身份验证时的这些凭据应位于请求标头中。使用此自定义方法，您可以检查凭据，然后向您的服务*验证客户端。*甚至不需要 Windows 帐户或域。

好消息是您可以将安全上下文提升到一个新的级别，并在方法级别提供*细粒度的*授权。您可能有大量客户端能够访问该服务的实例，但并非其中的所有方法（即付费客户端与未付费客户端）。在这种情况下，如果需要，您还可以在方法级别提供*授权。*

以下是我的分步解决方案（嵌入的步骤太多），其中包含所需的配置和拥有*完整*解决方案所需的安全性。问题通常是在没有使用 SSL 证书保护传输的情况下使用基本身份验证，这很**糟糕**。确保遵循所有步骤，您将实现基本身份验证，而无需任何类型的 Windows 帐户或在基于 WCF RESTful 的服务上进行配置。

[RESTful 服务：使用基本身份验证对客户端进行身份验证](http://allen-conway-dotnet.blogspot.com/2012/06/restful-services-authenticating-clients.html)

# wpf - 没有使用 ClickOnce 的“开始”菜单快捷方式

> ID：660449
> 
> 赞同：1
> 
> 时间：2009-03-18T23:09:40.333
> 
> 标签：wpf, deployment, clickonce

我正在通过[ClickOnce发布一个](http://en.wikipedia.org/wiki/ClickOnce)[.NET](http://en.wikipedia.org/wiki/.NET_Framework) 3.5 SP1 [WPF](http://en.wikipedia.org/wiki/Windows_Presentation_Foundation)应用程序。默认情况下，当用户单击发布的链接时，应用程序会被安装，并且菜单和快捷方式会添加到客户端的“开始/所有程序”菜单中。

如何防止创建快捷方式/菜单？（用户只需单击网页上“.application”文件的超链接即可运行该应用程序。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-18T23:16:21.113

对于此行为，请将其设置为仅在线。项目属性 -> 发布 -> “该应用程序仅在线可用”（单选按钮）。

它仍然会对文件等进行相同的本地缓存；主要*是*开始菜单发生了变化（我没有完整的差异列表）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-02-01T00:56:06.983

这也可以通过设置在 .application 文件中进行更改`<deployment install="false"`

# java - Java App Server 中的单例......这是一个多么糟糕的想法？

> ID：660463
> 
> 赞同：11
> 
> 时间：2009-03-18T23:13:59.107
> 
> 标签：java, jakarta-ee, jboss, glassfish, ejb-3.0

我目前正在研究一些在没有考虑应用服务器的情况下开发的旧 Java 代码。它基本上是一堆带有输入接口和输出接口的“黑盒代码”。“黑匣子”类中的所有内容都是包含状态的静态数据结构，这些状态以定时间隔（每 10 秒）通过算法。黑盒是从一个 main 方法启动的。

为了让我自己轻松，我正在考虑将“黑匣子”设为单例。基本上，任何想要访问黑匣子内部逻辑的人都会得到相同的实例。这将允许我使用消息驱动 bean 作为黑盒的输入，并使用某种 JMS Publisher 作为黑盒的输出。

这是多么糟糕的想法？有小费吗？

不过，我主要担心的问题之一是“黑盒”代码中可能存在我不知道的线程。

EJB 中是否存在诸如“应用程序范围的对象”之类的东西？

注意：我使用的是 Glassfish

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-19T14:12:53.860

如果使用简单的单例，**一旦进入集群环境，就会遇到问题**。

在这种情况下，您在多个 JVM 上有多个类加载器，并且您的 sinlgeton 模式**将**中断，因为您将拥有该类的多个实例。

在应用程序服务器（可能在集群环境中）中，单例唯一可接受的用途是单例完全无状态，并且仅用作访问全局数据/功能的便利。

我建议检查您的应用程序服务器供应商针对此问题的解决方案。大多数（如果不是所有）供应商都会为您的需求提供一些解决方案。

特别是对于您说您正在使用的 Glassfish，请查看[**对 Glassfish 的 Singleton EJB 支持**](http://blogs.oracle.com/MaheshKannan/entry/singleton_ejb_support_in_glassfish)。它可能就像添加单个注释一样简单。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T02:22:24.207

我会说创建一个单例实际上是唯一可行的想法。假设这个“黑匣子”内的代码已知使用静态字段，那么创建这个外观的两个实例是绝对不安全的。否则结果是不可预测的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-18T23:35:25.810

这远非一个坏主意，在我看来，它实际上可能是一个相当*不错*的主意。

仅从程序设计的角度来看：如果您的黑匣子在概念上是一个“对象”，具有对其起作用的属性和方法，那么将其变成一个对象，即使只有其中一个实例化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-19T13:42:38.190

它应该可以工作，但是您可能需要处理一些问题。

线程，正如你所提到的。MDB 在 EJB 容器中运行，您无法在其中创建自己的线程，因此存在潜在问题。如果您可以访问实际代码（听起来像您这样做），您可能需要进行一些重构以消除线程或使用“批准的”线程方法。CommonJ TimerManager 可能会在您陈述的情况下工作，因为它会在一定时间间隔内执行某些任务。大多数应用服务器都有可用的实现（包括 WAS 和 Weblogic）。

类加载 - 这取决于您的配置。如果单例是从同一个 EAR 中的 MDB 创建和操作的，那么您会没事的。单独的 EAR 将意味着不同的类加载器和 Singleton 的多个实例。如果没有更多信息，无法评论这是否会成为您的问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-20T20:11:55.213

我错过了一点？您提到“黑盒代码”包含状态。MDB 可能限制为每个目标 1 个实例，但如果没有适当的配置，您最终会得到一些 MDB。所有这些都与您的“黑盒代码”的单个实例一起工作。对我来说，这似乎不是一个好主意，因为一个 bean 将覆盖另一个 bean 之前创建的“黑盒代码”状态。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-23T13:40:57.857

在我看来，更符合您要求的工件是 JBoss MBean。（如果您正在考虑将 JBoss 作为 AS 候选人）。

[标准 MBean 示例](http://www.jboss.org/file-access/default/members/jbossas/freezone/docs/Server_Configuration_Guide/4/html/Writing_JBoss_MBean_Services-A_Standard_MBean_Example.html)

在 JBoss 集群的情况下，MBean 也可以部署为单例。

[使用 JBoss 进行集群](http://www.onjava.com/pub/a/onjava/2003/08/20/jboss_clustering.html)

我希望这对你有用。

拉法。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-19T15:14:26.020

尽快修复代码以消除静态问题。单身人士并不是朝着正确方向迈出的一步——它们只是增加了额外的误导。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-21T04:16:49.447

不要在状态可能改变的地方使用单例。

公开你的黑盒类的全局实例似乎不是要走的路。很多时候，单例看起来会让你的事情变得更轻松，并且在某种程度上他们可以，但它经常会反过来咬你，你最终不得不重组一大块代码。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-21T05:39:46.750

在网络服务器世界中，一个对象的范围可以是请求、会话或应用程序。也许您需要的是一个应用程序范围的对象。

在文档中搜索“应用程序范围对象”或“应用程序生命周期对象”。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-23T13:44:11.250

为什么不为空白框的东西创建一个休息接口并让客户端进行http调用呢？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-08-09T21:13:50.613

IMO，拥有一个满足单例需求的 EJB 容器是个好主意。在 Java EE 6 中，在会话 bean 中放置一个 @Singleton 注释会为您提供一个命名的单例。

# sql - 如何比较两个表并删除匹配的字段（不匹配的记录）

> ID：660464
> 
> 赞同：1
> 
> 时间：2009-03-18T23:15:12.927
> 
> 标签：sql, sql-server, duplicates

场景：需要对 20,000 个人的成员进行抽样调查。调查样本量为 20000 名成员中的 3500 名。所有会员个人都在表 tblMember 中。前一年进行了同样的调查，被调查的成员在 tblSurvey08 中。会员数据可能会在一年中发生变化（例如新的电子邮件地址等），但 MemberID 数据保持不变。

如何从 tblMember 中删除包含 tblSurvey08 的 MemberID/记录，以创建要调查的潜在成员的新表（我们称之为 tblPotentialSurvey09）。同样，单个成员的记录可能与不同的表不匹配，但 MemberID 字段将保持不变。

我对这些东西还很陌生，但我似乎在谷歌搜索解决方案时遇到了问题——我可以使用 EXCEPT 函数，但个人成员的记录从一个表到下一个表不一定相同——只是 MemberID 可能是相同的.

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-18T23:22:34.577

```
SELECT
   * (replace with column list)
FROM
   member m
LEFT JOIN
   tblSurvey08 s08
   ON m.member_id = s08.member_id
WHERE 
   s08.member_id IS NULL 
```

将只为您提供不在 08 调查中的成员。此连接比 NOT IN 构造更有效。新表不是一个好主意，因为您正在复制数据。带有上述查询的视图将是更好的选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T23:22:48.633

如果我不理解您的问题，我提前道歉，但我认为这就是您的要求。您可以使用该`insert into`语句。

```
insert into tblPotentialSurvey09
select your_criteria from tblMember where tblMember.MemberId not in (
    select MemberId from tblSurvey08
) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T23:23:24.060

首先，我不会仅仅为了选择潜在成员而创建一个新表。相反，我会创建一个新的真/假 (1/0) 字段来告诉他们是否符合条件。

但是，如果您仍想将数据复制到新表中，请执行以下操作：

```
INSERT INTO tblSurvey00 (MemberID) 
  SELECT MemberID
  FROM tblMember m
  WHERE NOT EXISTS (SELECT 1 FROM tblSurvey09 s WHERE s.MemberID = m.MemberID) 
```

如果您只想按照我的建议创建一个新字段，类似的查询就可以完成这项工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-18T23:24:51.623

外连接应该做：

```
select m_09.MemberID 
from tblMembers m_09 left outer join 
     tblSurvey08 m_08 on m_09.MemberID = m_08.MemberID 
where 
m_08.MemberID is null 
```

# git - git newbie：删除文件并切换分支后丢失（未添加）文件

> ID：660475
> 
> 赞同：0
> 
> 时间：2009-03-18T23:21:43.470
> 
> 标签：git, file-recovery

我在 git 存储库中犯了一个非常愚蠢的错误，并且丢失了一些我真正需要的文件。

我以为我在将更改提交到当前分支之前将所有新文件添加到了存储库（虽然没有发生）。然后我创建了一个新分支，并使用“移动到垃圾箱”再次从 TextMate 的新分支中删除了这些文件。我用'checkout'命令切换了几次分支。后来，我试图从垃圾箱中恢复这些文件，但没有..

我尝试了几个选项来恢复文件，包括“git fsck --lost-found”，但似乎它们从未在 repo 中注册过。

是否有任何选项可以恢复从硬盘驱动器中删除的未添加/未提交的文件？OSX 是否为此提供某种恢复？

非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T23:38:04.523

您可能不走运，但文件不存在似乎很奇怪。文件似乎在我的垃圾箱中停留了几个星期，除非它对你来说已经很长时间或手动清空它。

您可以尝试的一件事是使用终端在您的主目录中删除 .Trash 并运行 ls -al 如果文件由于某种奇怪的原因被隐藏，这可能会发现文件。

除此之外，您必须联系您所在地区的数据恢复服务，我不确定以这种方式恢复文件的成功几率。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T10:47:58.830

如果您在 Leopard (OS X 10.5) 上运行 Time Machine，那么您有可能文件在备份中。默认情况下，Time Machine 每小时备份一次，因此除非在备份之间创建和删除文件，否则您应该有一些东西。

# c# - 确定绑定到事件的事件处理程序列表

> ID：660480
> 
> 赞同：33
> 
> 时间：2009-03-18T23:24:31.373
> 
> 标签：c#, visual-studio-2008, debugging, events

我有一个不会关闭的 WinForms 表单。在 OnFormClosing 中，e.Cancel 设置为 true。我猜我的应用程序中的某些对象已绑定到 Closing 或 FormClosing 事件，并且正在阻止关闭。为了找出答案，我想确定哪些代表绑定到这些事件之一。

有没有办法确定绑定到事件的处理程序列表？理想情况下，我会通过 Visual Studio 调试器执行此操作，但可以在应用程序中编写代码以在必要时查找处理程序。了解事件就像一个隐藏的私有字段，我已经通过调试器导航到我的表单的“Windows.Forms.Form”祖先的“非公共字段”，但无济于事。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-18T23:29:37.073

简而言之，您不应该这样做 - 而是出于调试目的......

一个事件**通常**由一个私有字段支持——但没有控制；他们使用这种`EventHandlerList`方法。您必须访问表单的受保护`Events`成员，查找映射到（私有）EVENT_FORMCLOSING 对象的对象。

一旦你有了`FormClosingEventHandler`，`GetInvocationList`应该做这项工作。

* * *

```
using System;
using System.ComponentModel;
using System.Reflection;
using System.Windows.Forms;
class MyForm : Form
{
    public MyForm()
    { // assume we don't know this...
        Name = "My Form";
        FormClosing += Foo;
        FormClosing += Bar;
    }

    void Foo(object sender, FormClosingEventArgs e) { }
    void Bar(object sender, FormClosingEventArgs e) { }

    static void Main()
    {
        Form form = new MyForm();
        EventHandlerList events = (EventHandlerList)typeof(Component)
            .GetProperty("Events", BindingFlags.NonPublic | BindingFlags.Instance)
            .GetValue(form, null);
        object key = typeof(Form)
            .GetField("EVENT_FORMCLOSING", BindingFlags.NonPublic | BindingFlags.Static)
            .GetValue(null);

        Delegate handlers = events[key];
        foreach (Delegate handler in handlers.GetInvocationList())
        {
            MethodInfo method = handler.Method;
            string name = handler.Target == null ? "" : handler.Target.ToString();
            if (handler.Target is Control) name = ((Control)handler.Target).Name;
            Console.WriteLine(name + "; " + method.DeclaringType.Name + "." + method.Name);
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-06-26T02:15:34.357

问题可能是表单无法验证。

该`FormClosing`事件由 in 的私有`WmClose`方法引发，该方法`Form`初始化`e.Cancel`为`!Validate(true)`。我没有调查，但在某些情况下，`Validate`将始终返回`false`，导致关闭被取消，无论任何事件处理程序。

要对此进行调查，请启用[.Net 源代码调试](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)，在您的`FormClosing`处理程序中放置一个断点，转到`Form.WmClose`（在调用堆栈上）的源代码，在 的开头放置一个断点`WmClose`，然后再次关闭表单。然后，在调试器中单步执行它，看看为什么`Validate`返回`false`. （或者哪个事件处理程序设置`e.Cancel`为 true）

要解决问题，`e.Cancel`请`false`在您自己的处理程序中设置。

# terminology - 实体的计算机友好名称

> ID：660484
> 
> 赞同：0
> 
> 时间：2009-03-18T23:25:45.443
> 
> 标签：terminology, naming

实体的计算机友好名称的技术术语是什么：例如“Guns N' Roses”变成`guns_n_roses`. 这与转义或清理输入无关，但与美学有关 - 在 url 中看起来不错。

为了澄清，在“问题”表中，您可能有以下字段

```
标题：实体的计算机友好名称
正文：计算机的技术术语是什么......
???: 计算机友好的实体名称

```

有一个技术术语，但我不记得是哪个。这是一个名词，相当短且（嗯）令人难忘。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T00:21:50.643

Wordpress 称之为“[蛞蝓](http://www.dailyblogtips.com/wordpress-post-slug/)”

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T23:27:26.767

**(to) 消毒**。

如：

![替代文字](https://imgs.xkcd.com/comics/exploits_of_a_mom.png)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-18T23:40:46.983

**规范**的表示？
[http://en.wikipedia.org/wiki/Canonicalization](http://en.wikipedia.org/wiki/Canonicalization)

**标准化**名称？
[http://en.wiktionary.org/wiki/normalize](http://en.wiktionary.org/wiki/normalize)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T00:03:54.883

逃跑了？机器可读？煮熟？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T00:19:26.453

可以使用“**别名**”吗？

# c# - 这是什么？模板方法还是什么？

> ID：660487
> 
> 赞同：0
> 
> 时间：2009-03-18T23:27:57.060
> 
> 标签：c#, design-patterns, oop

我有一个类 Request.cs

它有一个抽象方法：

```
public abstract Response CreateResponse(XmlReader reader); 
```

还有一个方法：

```
public Response SendRequest(string requestURI)
{
    ...

    XmlReader reader = XmlReader.Create(responseStream);

    return CreateResponse(reader);
} 
```

`CreateResponse method`是在扩展的子类中实现的`Request`。并且该实现返回响应。

我不明白你怎么能返回一个像这样的抽象方法，但返回的值实际上是在子类的方法的实现中。这是[模板方法模式](http://en.wikipedia.org/wiki/Template_pattern)的一个例子还是只是简单的多态性，或者这个“棘手或过于精明”的代码甚至是混乱的？我试图弄清楚这甚至可以如何完成（这是基本的 OOP 原则或设计模式），这是 OOP 的良好实践还是良好使用？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T23:30:11.097

这是一种非常标准的方法。事实上，它经常被推荐。该`CreateResponse`方法就像一个必须由派生类填充的空白。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T23:35:33.593

是的，这是模板方法。由于 Response 类是抽象的，因此您必须在调用 SendRequest 之前实现 CreateResponse。这样，通用逻辑被封装在基类中，其余逻辑可以根据需要变化（通过创建基类的多个实现）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-18T23:44:22.763

主要原因是当你使用方法时，你永远不知道细节，只是定义了接口和抽象方法。

由于该方法是抽象的，因此它没有细节，因为它们必须由派生类定义。使这成为可能的主要观点是“INs”和“OUTs”永远不会改变，因为方法在基础中是抽象的，因此定义了接口，而不是实现......但是。

可以把它想象成有人出售从 A 点到 B 点的基本机票，但不知道要使用哪家航空公司。他们还不知道您将如何到达那里，但是一旦他们将已售机票的合同移交给航空公司，该航空公司就会弄清楚满足合同条款的细节。买票时，您所关心的只是您知道从 A 到 B 可以花 x 美元。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T17:08:34.583

这就是模板方法，而模板方法其实也不过是简单的多态。这正是典型的 C# / Java 风格的 OO 多态性的目的，并且是该语言的良好用法。

# replace - 试图标准化出口

> ID：660492
> 
> 赞同：0
> 
> 时间：2009-03-18T23:30:48.113
> 
> 标签：replace, sed, standards, vi, tabs

我正在尝试标准化我的导出文件。我需要删除前两个字段之间的所有空格和制表符，并用两个制表符替换它们。我正在使用VI。

所以我想改变

/vol/vol1/home1/xxx -rw=admin:app:admhosts

至

/vol/vol1/home1/xxx -rw=admin:app:admhosts

使空间等于两个 TABS。

我正在使用VI。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-18T23:39:43.507

`:s/[ ^I]\+/^I^I/`为单行或`:%s/[ ^I]\+/^I^I/`整个文件执行。请注意，我`^I`的意思是您按 Ctrl+I

# ruby-on-rails - Rails 和 ActiveRecord：在拥有多个子项上使用 find-or-create 时保存父对象

> ID：660494
> 
> 赞同：0
> 
> 时间：2009-03-18T23:31:20.297
> 
> 标签：ruby-on-rails, activerecord

我正在尝试使用重复自动完成（由[Pat Shaughnessy](http://patshaughnessy.net/repeated_auto_complete)修改）制作一个复杂的表单（如 railscast），用于创建具有许多作者的文章（has-many :through）。只要我愿意在保存文章时始终创建新作者，它就可以正常工作。我怎样才能让我的关联作者记录仅在它们尚不存在时创建，并且只在它们存在时获取连接表更新？

我知道您可以使用 find-or-create 来获取父对象的此结果，但我需要它用于在为文章调用 @article.save 时保存的关联对象。

在文章.rb

```
before_save :remove_blank_authors
after_update :save_authors

def remove_blank_authors
    authors.delete authors.select{ |author| author.fullname.blank?}
  end

def new_author_attributes=(author_attributes)
    author_attributes.each do |attributes|
      authors.build(attributes)
    end
  end

def existing_author_attributes=(author_attributes)
    authors.reject(&:new_record?).each do |author|
      attributes = author_attributes[author.id.to_s]
      if attributes
        author.attributes = attributes
      else
        author.delete(author)
      end
    end
  end

  def save_authors
    authors.each do |author|
      author.save(false)
    end
  end 
```

和作者部分我的观点：

```
<div class="author">
  <% fields_for_author author  do |f| %>

    <%= error_messages_for :author, :object => author %>
    <%= f.label :fullname, "Author Fullname:" %>
    <%= f.text_field_with_auto_complete :author, :fullname, {}, {:method => :get } %>

    <%= link_to_function "remove", "$(this).up('.author').remove()" %>

  <% end %>
</div> 
```

我正在使用 Rails 2.2.2。

问题是我看不到在哪里可以使用查找或创建。在构建作者的属性时 - new_author_attributes - 我没有什么可搜索的 - 我认为这只是预先构建空对象 - 在保存作者的时候，它们已经是新对象。还是我错了？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T09:07:49.427

这取决于您使用的 Rails 版本，但您应该能够：

```
 @article.authors.find_or_create_by_article_id(@author) 
```

或者

```
 @author.articles.find_or_create_by_author_id(@article) 
```

那么Rails“应该”为您填写详细信息......

为了使用`find_or_create`，您需要有一个条件来评估它。该条件（by_author_id 部分）可以更改为 Article 模型中的任何列。

这是 Rails 包含的约定功能之一，我无法找到太多关于它的信息，所以如果这太离谱了，抱歉；）

# php - 在 PHP 中增加日期的最简单方法？

> ID：660501
> 
> 赞同：40
> 
> 时间：2009-03-18T23:34:13.957
> 
> 标签：php, datetime, date, strtotime, date-manipulation

假设我有一个字符串进来，`"2007-02-28"`我能写出的最简单的代码是`"2007-03-01"`什么？现在我只是在使用`strtotime()`，然后添加`24*60*60`，然后使用`date()`，但只是想知道是否有更清洁、更简单或更聪明的方式来做这件事。

* * *

## 回答 #1

> 赞同：86
> 
> 时间：2009-03-18T23:41:39.430

一个干净的方法**是**使用`strtotime()`

```
$date = strtotime("+1 day", strtotime("2007-02-28"));
echo date("Y-m-d", $date); 
```

会给你2007-03-01

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-03-18T23:35:06.467

添加86400更干净更简单。:)

高科技的方法是：

```
$date = new DateTime($input_date);
$date->modify('+1 day');
echo $date->format('Y-m-d'); 
```

但是，如果您在日期上进行一系列转换，而不仅仅是寻找明天，那么这真的是微不足道的。

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-03-18T23:42:48.193

您可以在 strtotime 内进行添加，例如

```
 $today="2007-02-28";
 $nextday=strftime("%Y-%m-%d", strtotime("$today +1 day")); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-19T00:48:58.193

另一种方法是使用函数 mktime()。这是一个非常有用的功能...

```
$date = "2007-02-28";
list($y,$m,$d)=explode('-',$date);
$date2 = Date("Y-m-d", mktime(0,0,0,$m,$d+1,$y)); 
```

但我认为`strtotime()`在那种情况下更好......

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-01-18T15:20:34.873

最简单的方法...

```
echo date('Y-m-d',strtotime("+1 day"));    //from today 
```

或从指定日期...

```
echo date('Y-m-d',strtotime("+1 day", strtotime('2007-02-28'))); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-07-18T21:11:04.050

你好，你可以在下面试试这个，特别是如果你是法国人

```
$date = date('l j F Y');
#increment the date
$date2 = date('l j F Y', strtotime("+7 day")); 
```

要翻译法语，您可以使用 setlocale() 函数或以下函数：

```
function fr_date($date){

    $date = explode(' ', $date);

    $date = str_replace('Monday','Lundi',$date);
    $date = str_replace('Tuesday','Mardi',$date);
    $date = str_replace('Wednesday','Mercredi',$date);
    $date = str_replace('Thursday','Jeudi',$date);
    $date = str_replace('Friday','Vendredi',$date);
    $date = str_replace('Saturday','Samedi',$date);
    $date = str_replace('Sunday','Dimanche',$date);

    $date = str_replace('January','Janvier',$date);
    $date = str_replace('February','Février',$date);
    $date = str_replace('March','Mars',$date);
    $date = str_replace('April','Avril',$date);
    $date = str_replace('May','Mai',$date);
    $date = str_replace('June','Juin',$date);
    $date = str_replace('July','Juillet',$date);
    $date = str_replace('August','Août',$date);
    $date = str_replace('September','Septembre',$date);
    $date = str_replace('October','Octobre',$date);
    $date = str_replace('November','Novembre',$date);
    $date = str_replace('December','Décembre',$date);

    $date = implode(' ',$date);
    return $date;

} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-10-20T01:03:25.307

```
$your_date = strtotime("1month", strtotime(date("Y-m-d")));
 $new_date = date("Y-m-d", $your_date++); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2021-03-18T10:56:32.697

使用`strtotime()`日期格式

```
echo date('Y-m-d', strtotime('2007-02-28' . ' +1 day')); 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2016-09-04T12:24:10.587

```
 $early_start_date = date2sql($_POST['early_leave_date']);

        $date = new DateTime($early_start_date);
        $date->modify('+1 day');

        $date_a = new DateTime($early_start_date . ' ' . $_POST['start_hr'] . ':' . $_POST['start_mm']);
        $date_b = new DateTime($date->format('Y-m-d') . ' ' . $_POST['end_hr'] . ':' . $_POST['end_mm']);

        $interval = date_diff($date_a, $date_b); 
```

# xml - 如何将 XML::Simple 与可能具有一个或多个子元素的 XML 标记一起使用？

> ID：660504
> 
> 赞同：3
> 
> 时间：2009-03-18T23:35:08.977
> 
> 标签：xml, perl

我昨天问了一个问题[如何使用 XML::Simple 检索标签属性？](https://stackoverflow.com/questions/657058/perl-xml-simple-retrieveing-attribute)我用来获取 XML 的链接：

[http://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pubmed&id=19273512](http://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pubmed&id=19273512) (1)

[http://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pubmed&id=19291509](http://eutils.ncbi.nlm.nih.gov/entrez/eutils/esummary.fcgi?db=pubmed&id=19291509) (2)

我取得了很好的进展，并编写了以下代码，循环遍历标签并搜索我需要的标签。我正在“ArticleIds”下寻找“doi”标签

```
 foreach $item_node (@{$dataSummary->{DocSum}->{Item}})
        {
                if($item_node->{Name} eq 'ArticleIds')
                {
                        foreach $item_node1 (@{$item_node->{Item}})
                        {
                                if ($item_node1->{Name} eq 'doi')
                                {
                                    $doi=  $item_node1->{content};  
                                    last;
                                }
                        }
                        last;

                }
        } 
```

此代码基本上搜索 ArticleIds 标签，然后搜索其下的子标签以找到“doi”标签。

我遇到的问题是，当 ArticleIds 下有多个子标签时（如 (2) 所示），一切正常。但是，当 ArticleIds 标签下只有一个子标签时（如（1）所示），就会出现错误，程序就会停止。

我正在使用 Simple Parser 并使用 dumper 我得到了两个结果。这是链接 (1) 转储的一部分

```
{ 'Type' => 'List', 'Item' => { 'Type' => 'String', 'content' => '19273512', 'Name' => 'pubmed' }, 'Name' => 'ArticleIds' } 
```

对于链接 (2)

```
{ 'Type' => 'List', 'Item' => [ { 'Type' => 'String', 'content' => '909564644', 'Name' => 'pii' }, { 'Type' => 'String', 'content' => '10.1080/13506120802676914', 'Name' => 'doi' }, { 'Type' => 'String', 'content' => '19291509', 'Name' => 'pubmed' } ], 'Name' => 'ArticleIds' } 
```

如你看到的。当 ArticleIds 下有多个标签时，它被视为一个数组，因此是方括号。

在这种情况下，有人会提出什么建议？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-18T23:39:27.877

如果文件只有其中一个`Item`元素，则该项目将显示在散列中。如果有多个`Item`元素，那么它将显示为一个数组。`ForceArray`您可以使用该选项强制某些标签始终包含列表。将您希望强制进入数组的所有属性名称的正则表达式传递给它，它会处理其余的。

```
XMLin( 'file.xml', 
       ForceArray => qr{Item}x ); 
```

哦，还要检查您使用的是什么版本的 XML::Simple。我认为早期版本您只能使用 ForceArray 指定值的数组引用，否则它根本不起作用。如果它仅适用于 arrayref，则可以使用以下命令指定它：

```
XMLin( 'file.xml', 
       ForceArray => [ 'Item' ] ); 
```

查看[XML::Simple CPAN 文档](http://search.cpan.org/dist/XML-Simple/lib/XML/Simple.pm)以查看可能对您有所帮助的更多选项。

就版本而言，如果您使用的是随 ActiveState 发行版一起提供的 XML::Simple，那么它很可能已经过时了。尝试抓住一个新的。

您还可以检查它是什么类型，或者使用

```
$item =~ /HASH/  # hash
$item =~ /ARRAY/ # array 
```

或 ref 关键字（如您所见）

```
ref($item) eq 'HASH' 
ref($item) eq 'ARRAY' 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T01:01:43.420

我认为您遇到的问题之一是您介于 XML::Simple 之间，没有给您足够的旋钮和刻度盘，但问题还不够复杂，无法编写更复杂的东西。

在这种情况下，我会使用[XML::Twig 之](http://search.cpan.org/dist/XML-Twig)类的东西。它更多地是事件驱动的，因此它可以遍历您的 XML 并在您需要时为您提供控制。一旦你得到你喜欢的元素，你就可以用它做任何你喜欢的事情。

除了 Twig 之类的东西之外，XPath 之类的各种东西也可以以同样的方式使用。它们被构建为深入研究 XML 以提取其中的一部分，这与 XML::Simple 不同，它只为您提供数据结构。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T03:27:48.280

我在 XML::Simple 上有旧版本所以我决定使用 ref() 函数并编写一些额外的代码行。

感谢帮助

# c++ - 关于模板类中模板函数的小问题

> ID：660517
> 
> 赞同：1
> 
> 时间：2009-03-18T23:40:21.447
> 
> 标签：c++, templates

我试图理解一些 C++ 语法：

```
template<class T>
class Foo 
{
   Foo();

   template<class U>
   Foo(const Foo<U>& other);
};

template<class T>
Foo<T>::Foo() { /*normal init*/ }

template<class T>
template<class U>
Foo<T>::Foo(const Foo<U>& other) { /*odd copy constructed Foo*/ } 
```

所以，我写了这样的代码，它恰好在 windows 和 linux 中编译得很好。我不明白为什么复制构造函数有两个这样定义的模板。基本上，在找到正确的语法之前，我必须过期一些，我想知道为什么那个特定的语法是正确的，而不是像`template<class T, class U>.`

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-18T23:47:47.840

第一个模板（带有参数 T）表示**该类**是带有参数 T 的模板。

第二个模板（带有参数 U）表示模板类的**成员函数**（带有参数 T）是带有参数 U 的模板 - 即构造函数。

实际上，这里有一个模板类，它将生成与用作构造函数参数的类型一样多的复制构造函数。

在复制构造函数的特定情况下，您不应该这样做，而是：

```
template<class T>
class Foo 
{
   Foo();

   Foo(const Foo<T>& other);
};

template<class T>
Foo<T>::Foo() { /*normal init*/ }

template<class T>
Foo<T>::Foo(const Foo<T>& other) { /*odd copy constructed Foo*/ } 
```

因为在您的示例中，它不是复制构造函数，而是将类型 U 作为参数的构造函数：转换构造函数......这很难预测。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T00:14:19.990

对于涉及的每个模板，它必须有单独`template`的子句。在这里，涉及到两个模板，它们都值得拥有它们的（非空）模板子句：

*   类模板`Foo`
*   构造函数模板

考虑这种由于参数`U`所属位置不明确而失败的情况

```
template<typename T>
struct A {
    template<typename U> void f();
};

template<typename T, typename U>
void A<T>::f() { } 
```

现在，参数怎么了`U`？当然编译器可以猜测它可能属于`f`，但猜测不是编译器喜欢的:) 现有规则说，根据模板的嵌套，模板子句以正确的顺序出现。那时一切都清楚了。

即使有人提出了如何将参数与所涉及模板的参数匹配的规则（到目前为止，我认为这样做并没有真正的困难），它也会不一致。因为到目前为止，一个模板子句列出了相应模板接受的所有参数。很像函数参数列表。如果我们将所有内容都放在一个子句中，那么清晰的语义可能会被破坏——更不用说当我们再次将定义放入类时，模板会突然得到自己的子句：

```
// provides arguments for A's parameters, then for f ones 
// when it's called
A<int> a; 
a.f<bool>(); 
```

当我们有单独的模板子句来捕获它们自己的参数时，这会更加自然。因此，上述错误定义的语法是

```
template<typename T> 
 template<typename U>
void A<T>::f() { } 
```

现在，代码的读者也立即看到这是成员模板的定义，而不是（可能意外声明但未使用）的第二个参数`A`。

# sql - 在 SQL 中实现关键字黑名单

> ID：660525
> 
> 赞同：1
> 
> 时间：2009-03-18T23:43:48.910
> 
> 标签：sql, blacklist

我有一个关键字（字符串）列表，我需要在其中识别与关键字黑名单（单独表中的字符串）的任何匹配项

任何关键字/黑名单匹配都将在位字段中标记：Keyword.IsBlacklisted。

有没有一种简单的方法可以在 SQL 中实现这一点？

匹配可能是部分的（即黑名单 = 'sex' 关键字 = 'sex toy'）

**解决方案 - 感谢 Daniel Spiewak**

```
 SELECT Keyword.Keyword FROM Keyword CROSS JOIN BlackList
 WHERE (Keyword.Keyword 
 LIKE { fn CONCAT({ fn CONCAT('%', BlackList.Keyword) }, '%') }) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-18T23:48:04.140

```
SELECT keyword FROM words JOIN blacklist 
               WHERE keyword LIKE CONCAT(CONCAT('%', word), '%') 
```

假设单词在表的`keyword`字段中，并且在字段中包含它的单词。这绝不会是有效的，但我认为从理论的角度来看，这是你能做的最好的事情。`words``blacklist``word`

# apache-flex - 在编辑模式下更改列表项的高度

> ID：660527
> 
> 赞同：0
> 
> 时间：2009-03-18T23:45:03.603
> 
> 标签：apache-flex, actionscript

我有一个列表控件的自定义列表项渲染器和编辑器。我需要编辑器具有比渲染器更大的高度，即行在进入编辑模式时应该扩展（高度）。但是，即使列表的 variableRowHeight 设置为 true，它也不能满足我的要求：高度似乎仅基于渲染器的高度，而不是编辑器的高度。有什么办法可以做我想做的事吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-17T13:17:43.507

您是否尝试过在 editItemRenderer 所在的行上设置每个渲染器的高度。如果我没记错的话，变量行高从第一列单元格获取高度（这可能是错误的？）如果你有 varibleRowHeight 那么当你去编辑一个单元格时，确保行中的所有单元格都是相同的高度，你可能还必须使大小和显示无效。

如果您已经解决了这篇文章，那么您的答案会很有趣，看看您可能采取了哪些不同的方法。

# wpf - 如何在 ListView 中显示行号？

> ID：660528
> 
> 赞同：33
> 
> 时间：2009-03-18T23:45:04.117
> 
> 标签：wpf, listview

显而易见的解决方案是在 ModelView 元素上具有行号属性，但缺点是您必须在添加记录或更改排序顺序时重新生成这些属性。

有没有**优雅**的解决方案？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-03-19T13:39:28.887

我认为你*有*优雅的解决方案，但这有效。

XAML：

```
<ListView Name="listviewNames">
  <ListView.View>
    <GridView>
      <GridView.Columns>
        <GridViewColumn
          Header="Number"
          DisplayMemberBinding="{Binding RelativeSource={RelativeSource FindAncestor, 
                                         AncestorType={x:Type ListViewItem}}, 
                                         Converter={StaticResource IndexConverter}}" />
        <GridViewColumn
          Header="Name"
          DisplayMemberBinding="{Binding Path=Name}" />
      </GridView.Columns>
    </GridView>
  </ListView.View>
</ListView> 
```

值转换器：

```
public class IndexConverter : IValueConverter
{
    public object Convert(object value, Type TargetType, object parameter, CultureInfo culture)
    {
        ListViewItem item = (ListViewItem) value;
        ListView listView = ItemsControl.ItemsControlFromItemContainer(item) as ListView;
        int index = listView.ItemContainerGenerator.IndexFromContainer(item);
        return index.ToString();
    }

    public object ConvertBack(object value, Type targetType, object parameter, CultureInfo culture)
    {
        throw new NotImplementedException();
    }
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-10-30T17:33:31.313

如果您有一个添加、删除或移动项目的动态列表，您仍然可以使用这个非常好的解决方案，只需在源列表中的更改完成后让列表视图的当前视图自行刷新。此代码示例直接在数据源列表“mySourceList”（在我的情况下为 ObservableCollection）中删除当前项，最后将行号更新为正确的值。

```
ICollectionView cv = CollectionViewSource.GetDefaultView(listviewNames.ItemsSource);
if (listviewNames.Items.CurrentItem != null)
{
    mySourceList.RemoveAt(cv.CurrentPosition);
    cv.Refresh();
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-08-02T11:14:21.057

首先，您需要将 设置`AlternationCount`为`items count`+1，例如：

```
<ListView AlternationCount="1000" .... /> 
```

然后`AlternationIndex`将显示真实索引，即使在滚动期间：

```
 <GridViewColumn
       Header="#" Width="30"
       DisplayMemberBinding="{Binding (ItemsControl.AlternationIndex),
       RelativeSource={RelativeSource AncestorType=ListViewItem}}" /> 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-12-24T12:34:39.220

这就像一个魅力，我不知道性能如何，我们仍然可以试一试

创建多值转换器

```
public class NumberingConvertor : IMultiValueConverter
 {
  public object Convert(object[] values, Type targetType, object parameter, System.Globalization.CultureInfo culture)
  {
   if (values != null && values.Any() && values[0] != null && values[1] != null)
   {
    //return (char)(((List<object>)values[1]).IndexOf(values[0]) + 97);
    return ((List<object>)values[1]).IndexOf(values[0]) + 1;
   }
   return "0";
  }

  public object[] ConvertBack(object value, Type[] targetTypes, object parameter, System.Globalization.CultureInfo culture)
  {
   return null;
  }
 }
} 
```

和你这样的 Xaml

```
<ItemsControl ItemsSource="{Binding ListObjType}">
        <ItemsControl.ItemsPanel>
            <ItemsPanelTemplate>
                <StackPanel />
            </ItemsPanelTemplate>
        </ItemsControl.ItemsPanel>
        <ItemsControl.ItemTemplate>
            <DataTemplate>
                <StackPanel Orientation="Horizontal">
                    <Label>
                        <MultiBinding Converter="{StaticResource NumberingConvertor}">
                            <Binding Path="" />
                            <Binding Path="ItemsSource"
                                     RelativeSource="{RelativeSource AncestorType=ItemsControl}" />
                        </MultiBinding>
                    </Label>
                    <TextBlock Text="{Binding }" />
                </StackPanel>
            </DataTemplate>
        </ItemsControl.ItemTemplate>
    </ItemsControl> 
```

想法是将对象和列表都发送给转换器，让转换器决定数量。您可以修改转换器以显示有序列表。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-10-21T16:04:24.880

这是另一种方式，包括有助于您理解其工作原理的代码注释。

```
public class Person
{
    private string name;
    private int age;
    //Public Properties ....
}

public partial class MainWindow : Window
{

    List<Person> personList;
    public MainWindow()
    {
        InitializeComponent();

        personList= new List<Person>();
        personList.Add(new Person() { Name= "Adam", Agen= 25});
        personList.Add(new Person() { Name= "Peter", Agen= 20});

        lstvwPerson.ItemsSource = personList;
//After updates to the list use lstvwPerson.Items.Refresh();
    }
} 
```

XML

```
 <GridViewColumn Header="Number" Width="50" 
                DisplayMemberBinding="{ 
                    Binding RelativeSource= {RelativeSource Mode=FindAncestor, AncestorType={x:Type ListViewItem}},
                   DELETE Path=Content, DELETE
                    Converter={StaticResource IndexConverter}, 
                    ConverterParameter=1
                }"/> 
```

**当我们尝试将给定对象的属性绑定到对象本身的另一个属性[[1]时，](http://www.c-sharpcorner.com/UploadFile/yougerthen/relativesources-in-wpf/) **RelativeSource**用于特定的绑定情况。**

 **使用**Mode=FindAncestor**我们可以遍历层次结构并获取指定的元素，例如 ListViewItem（我们甚至可以抓取 GridViewColumn）。如果您有两个 ListViewItem 元素，您可以使用“AncestorLevel = x”指定您想要的元素。

**Path**：这里我只取 ListViewItem 的内容（这是我的对象“Person”）。

**Converter**由于我想在 Number 列中显示行号而不是对象 Person 我需要创建一个 Converter 类，它可以以某种方式将我的 Person 对象转换为相应的数字行。 *但这是不可能的，我只是想表明 Path 进入了转换器*。删除路径会将 ListViewItem 发送到转换器。

**ConverterParameter**指定要传递给 IValueConverter 类的参数。如果您希望行号从 0、1、100 或其他任何值开始，您可以在此处发送状态。

```
public class IndexConverter : IValueConverter
{
    public object Convert(object value, Type TargetType, object parameter, System.Globalization.CultureInfo culture)
    {
        //Get the ListViewItem from Value remember we deleted Path, so the value is an object of ListViewItem and not Person
        ListViewItem lvi = (ListViewItem)value;
        //Get lvi's container (listview)
        var listView = ItemsControl.ItemsControlFromItemContainer(lvi) as ListView;

        //Find out the position for the Person obj in the ListView
//we can get the Person object from lvi.Content
        // Of course you can do as in the accepted answer instead!
        // I just think this is easier to understand for a beginner.
        int index = listView.Items.IndexOf(lvi.Content);

        //Convert your XML parameter value of 1 to an int.
        int startingIndex = System.Convert.ToInt32(parameter);

        return index + startingIndex;
    }

    public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        throw new NotImplementedException();
    }
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-08-31T09:58:50.187

我找到了即使您需要在集合中移动元素的情况下也可以使用的解决方案。所以实际上我们需要做的是在每次我们的集合被更改时通知虚拟属性“ListNumbersNotify”，并使用那个棘手的 MultiBinding 转换器绑定所有内容。

XAML：

```
 <Window ...
                   x:Name="This">
                   ...
                 <ListView Name="ListViewCurrentModules">
                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <Label>
                                    <MultiBinding Converter="{helpers:NumberingConvertor}">
                                        <Binding Path="" />
                                        <Binding ElementName="ListViewCurrentModules" />
                                        <Binding Path="ListNumbersNotify" ElementName="This" />
                                    </MultiBinding>
                                </Label>
                                <Border>
                                 ...
                                </Border>
                            </StackPanel>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView> 
```

转换器：

```
 public abstract class MultiConvertorBase<T> : MarkupExtension, IMultiValueConverter
where T : class, new()
{
    public abstract object Convert(object[] values, Type targetType, object parameter, CultureInfo culture);

    public virtual object[] ConvertBack(object value, Type[] targetType, object parameter, CultureInfo culture)
    {
        return null;
    }

    public override object ProvideValue(IServiceProvider serviceProvider)
    {
        if (_converter == null)
            _converter = new T();
        return _converter;
    }

    private static T _converter = null;
}

public class NumberingConvertor : MultiConvertorBase<NumberingConvertor>
{
    public override object Convert(object[] values, Type targetType, object parameter, CultureInfo culture)
    {
        return ((ListView)values[1]).Items.IndexOf(values[0]) + 1;
    }
} 
```

后面的代码：

```
 public partial class AddModulesWindow: Window, INotifyPropertyChanged
    {
    ...
    public event PropertyChangedEventHandler PropertyChanged;
    private void OnPropertyChanged(string prop)
    {
        PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(prop));
    }

    public object ListNumbersNotify { get; }

    public AddModulesWindow(ICore core)
    {
        InitializeComponent();

        this.core = core;
        CurrentModuleInfos = new ObservableCollection<ModuleInfo>(core.Modules.Select(m => m?.ModuleInfo));
        CurrentModuleInfos.CollectionChanged += CurrentModuleTypes_CollectionChanged;

        ListViewCurrentModules.ItemsSource = CurrentModuleInfos;
    }

    private void CurrentModuleTypes_CollectionChanged(object sender, System.Collections.Specialized.NotifyCollectionChangedEventArgs e)
    {
        OnPropertyChanged("ListNumbersNotify");
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-02-18T05:06:23.717

这是amaca 对 Allon Guralnek 和 VahidN 发现的问题的[答案的补充。](https://stackoverflow.com/a/662232/4578076)通过在 XAML 中将 ListView.ItemsPanel 设置为 StackPanel 解决了滚动问题：

```
<ListView.ItemsPanel>
    <ItemsPanelTemplate>
        <StackPanel />
    </ItemsPanelTemplate>
</ListView.ItemsPanel> 
```

用简单的 StackPanel替换默认的[VirtualizingStackPanel](https://msdn.microsoft.com/ru-ru/library/system.windows.controls.virtualizingstackpanel(v=vs.110).aspx)会禁用 ListViewItem 内部集合的自动重新生成。所以滚动时索引不会乱七八糟地改变。但是这种替换会降低大型集合的性能。`CollectionViewSource.GetDefaultView(ListView.ItemsSource).Refresh()`此外，当 ItemsSource 集合更改时，可以通过调用来实现动态编号更改。就像[ListView 过滤](http://www.wpf-tutorial.com/listview-control/listview-filtering/)一样。当我尝试通过事件调用添加处理程序时，`INotifyCollectionChanged.CollectionChanged`我的 ListView 输出正在复制最后添加的行（但编号正确）。通过在代码中的每次集合更改后进行刷新调用来解决此问题。糟糕的解决方案，但它对我来说很完美。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-10-20T14:06:55.127

**amaca**答案非常适合静态列表。对于动态：

1.  我们应该使用MultiBinding，第二个绑定用于更改集合；
2.  删除 ItemsControl 后不包含已删除的对象，但 ItemContainerGenerator 包含。动态列表转换器（我将它用于 TabControl TabItem）：

    ```
    public class TabIndexMultiConverter : MultiConverterBase
    {
       public override object Convert(object[] value, Type targetType, object parameter, CultureInfo culture)
       {
          TabItem tabItem = value.First() as TabItem;
          ItemsControl ic = ItemsControl.ItemsControlFromItemContainer(tabItem);
          object context = tabItem?.DataContext;

          int idx = ic == null || context == null // if all objects deleted
                 ? -1
                 : ic.Items.IndexOf(context) + 1;

          return idx.ToString(); // ToString necessary
       }
    } 
    ```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-07-03T09:18:06.090

这是我的小转换器，它在 2017 年与**.NET 4.7.2的****WPF**一起工作得很好，包括完全启用的：**`VirtualizingStackPanel`**

 **```
[ValueConversion(typeof(IList), typeof(int))]
public sealed class ItemIndexConverter : FrameworkContentElement, IValueConverter
{
    public Object Convert(Object data_item, Type t, Object p, CultureInfo _) =>
        ((IList)DataContext).IndexOf(data_item);

    public Object ConvertBack(Object o, Type t, Object p, CultureInfo _) =>
        throw new NotImplementedException();
}; 
```

将 this的实例添加`IValueConverter`到或其他地方。或者，在绑定元素的原位实例化它，就像我在这里展示的那样*。*在任何情况下，您都需要创建一个实例，并且不要忘记将整个源集合绑定到它。在这里，我从 -- 的属性中提取了对源集合的引用，但这会带来一些与访问 XAML 根目录无关的麻烦，因此，如果您有更好、更简单的方法来引用源集合，您应该这样做所以。`Resources``GridViewColumn.CellTemplate`*`Binding``ItemIndexConverter``ItemsSource``ListView`*

 *至于访问**XAML**根上的属性，XAML 中的**根**`ListView`被赋予 name ，并且**XAML 2009**标记扩展用于访问 XAML 根元素。我认为“ElementName”绑定在这里不起作用，因为引用发生在模板上下文中。**`w_root`**`{x:Reference ...}`****

 ****```
<ListView x:Class="myApp.myListView"
    x:Name="w_root"
    xmlns="http://schemas.microsoft.com/netfx/2009/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="clr-namespace:myApp"
    VirtualizingStackPanel.IsVirtualizing="True" 
    VirtualizingStackPanel.VirtualizationMode="Recycling">

    <ListView.View>
       <GridView>
          <GridViewColumn Width="50">
             <GridViewColumn.CellTemplate>
                <DataTemplate>
                   <TextBlock>
                      <TextBlock.Text>
                         <Binding>
                            <Binding.Converter>
                               <local:ItemIndexConverter DataContext="{Binding 
                                    Source={x:Reference w_root},
                                    Path=(ItemsControl.ItemsSource)}" />
                           </Binding.Converter>
                        </Binding>
                     </TextBlock.Text>
                  </TextBlock>
               </DataTemplate>
            </GridViewColumn.CellTemplate>
         </GridViewColumn>
      </GridView>
   </ListView.View>
</ListView> 
```

就是这样！它似乎在处理大量行时工作得很快，而且您可以再次看到，在任意滚动时报告的索引是正确的，并且`VirtualizingStackPanel.IsVirtualizing`确实设置为`True`.

[![在此处输入图像描述](https://i.stack.imgur.com/I97YJ.gif)](https://i.stack.imgur.com/I97YJ.gif)

不确定以下是否真的必要，但请注意**WPF**`xmlns=`的声明已更新以指示**XAML 2009**，以支持上述用法。请注意有*两个*变化；从“2006”切换到“2009”时，“/winfx/”必须更改为“/netfx/”。****`{x:Reference}`****

 ****** * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-09-13T08:56:31.437

通过遵循最佳答案解决方案，我发现在删除/替换列表视图中的项目后索引仍未更新时的问题。为了解决这个问题，有一个不太明确的提示（我建议在小集合中使用它）：在执行项目删除/替换后，您应该`ObservableCollection(INotifyCollectionChanged).CollectionChanged`使用操作调用事件`Reset`。这可以通过扩展现有的来实现`ObservableCollection`，`ItemsSource`或者在不可能的情况下使用反射。

前任。

```
public class ResetableObservableCollection<T> : ObservableCollection<T>
{
        public void NotifyReset()
        {
            OnCollectionChanged(new NotifyCollectionChangedEventArgs(NotifyCollectionChangedAction.Reset));
        }
}

private void ItemsRearranged() 
{
    Items.NotifyReset();
} 
```

# installation - 运行 RemovePreviousVersion 时 MSI 不会安装所有文件

> ID：660531
> 
> 赞同：16
> 
> 时间：2009-03-18T23:45:57.313
> 
> 标签：installation, wix, windows-installer, wix3

我有一个使用 WiX 版本 3 的 MSI 版本。

我们正在部署的产品的所有以前的安装程序都可以在指定的配置下正常工作（即：如果以前的版本存在，请删除，然后安装新版本） - 但是，我们构建的新 MSI 在运行时不会安装所有文件“删除第一个”路径。

如果我们手动删除现有安装，然后运行新版本，则所有文件都已安装 - 当我检查 Orca 中的 MSI 文件时，文件和功能会显示出来并且看起来很好。

我们尝试在打开详细日志和额外日志记录的情况下运行（`/l*vx`），但是我们可以看到文件是否没有被注册和安装。

有什么想法或建议吗？这把我们逼上了绝路。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-14T14:46:08.970

根据默认的自定义操作顺序，Windows Installer 确定在删除任何现有软件版本之前需要安装/覆盖哪些文件。Windows Installer 使用 REINSTALLMODE 属性的值来告诉它如何决定何时覆盖文件。如果 REINSTALLMODE 包含“o”，那么它只会安装版本不同或文件不存在的文件；仅当文件的修改日期 <= 创建日期（即文件未修改）时，才会安装非版本化文件。如果 REINSTALLMODE 包含“a”，它将始终安装文件，而不管附加到现有文件的任何版本或日期信息。

您的场景中发生的情况很可能如下：

1.  Windows Installer 确定要安装哪些文件。它决定不需要安装某些文件（可能是因为它们已经存在并且与 MSI 中的文件具有相同或更新的版本）。
2.  删除了以前版本的软件，包括 Windows Installer 确定不需要安装的文件。
3.  Windows 安装程序为新安装安装文件，但不安装它确定不需要安装的文件。

最终的结果是升级软件后丢失了一堆文件。设置 REINSTALLMODE=amus 而不是 omus 可能会解决您的问题，但您应该确保您知道这将如何影响您的其余安装。如果您不想覆盖任何文件，则需要将这些组件标记为“从不覆盖”。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-19T04:46:08.043

好的，与我所在的其他人交谈帮助我找到了问题的解决方案。

我们添加了属性`REINSTALLMODE`并将其设置为`amus`. 这是什么意思？

默认情况下，该属性设置为`omus`：如果文件丢失或更旧，则重新安装，为机器和用户配置单元重写注册表，重新安装快捷方式。将其更改为`amus`基本上说：重新安装所有文件。

所以，不是 100% 确定原因是什么 - 我怀疑可能有奇怪的锁或其他东西，但设置为`amus`不会产生任何不利影响，所以我们会坚持下去。

感谢您的建议。

（此外，可以在此处找到有关此属性的更多详细信息：[MSDN：REINSTALLMODE 属性](http://msdn.microsoft.com/en-us/library/aa371182(VS.85).aspx "MSDN：重新安装模式属性")

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-19T00:06:13.240

你的`<RemoveExistingProducts After="">`脚步是什么样子的？可能是 removeexisting 在安装之后运行 - 并删除了以前和当前版本中相同的所有文件。

我设置了我的安装程序`<RemoveExistingProducts After="InstallInitialize">`以确保它在其他任何事情之前完成。我不知道它是否正确，但它似乎有效。

```
 <Upgrade Id="$(var.UpgradeCode)">
        <!--Upgrade code found at http://www.nichesoftware.co.nz/blog/200809/upgradable-msi-installations-with-wix -->
        <!-- Detect any newer version of this product-->
        <UpgradeVersion Minimum="$(var.version)" IncludeMinimum="no" OnlyDetect="yes" Language="1033" Property="NEWPRODUCTFOUND" />

        <!-- Detect and remove any older version of this product-->
        <UpgradeVersion Maximum="$(var.version)" IncludeMaximum="yes" OnlyDetect="no" Language="1033" Property="OLDPRODUCTFOUND" />
    </Upgrade>
    <CustomAction Id="PreventDowngrading" Error="Newer version already installed"></CustomAction>
    <InstallExecuteSequence>
        <!-- Prevent Downgrading-->
        <Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
        <RemoveExistingProducts After="InstallInitialize" />
    </InstallExecuteSequence>
    <InstallUISequence>
        <!-- Prevent Downgrading-->
        <Custom Action="PreventDowngrading" After="FindRelatedProducts">NEWPRODUCTFOUND</Custom>
    </InstallUISequence> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2018-08-23T14:01:09.940

我知道这是一个较旧的线程，但我遇到了解决方案未涵盖的类似问题。就我而言，我有一个 DLL，它实际上是比其前身版本低的版本。此 DLL 永远不会出现在升级安装中。跑步

```
msiexec /i myproduct.msi /l*vx install2.log 
```

并检查日志显示该文件从未安装过。它只是没有作为安装的文件之一出现在日志中。MSI 明确包含该文件，最好的证据是修复会放置该文件。此外，使用各种工具分解 MSI 显示文件存在。在干净的机器上直接安装总是有效的。

这没有帮助：

```
msiexec /i myproduct.msi REINSTALL=ALL REINSTALLMODE=amus /l*vx install3.log 
```

我正在使用 Wix 构建 MSI，并且多年来我一直在使用这个脚本。最近我们将脚本设置为完全删除 5.3 版本中的旧目录。这适用于 5.2 -> 5.3 和 5.3 -> 5.4 升级。但在 5.5 版本中，所有 DLL 都使用新版本的 DLL 重新构建。DLL 项目托管在 GitHub 中。此特定 DLL 的构建脚本设置为“10.0.0.{git rev-list --count HEAD}”的程序集版本。该项目已被移动，导致 HEAD 计数从 444 变为 30。

wixscript include 有这个，

```
define ProductGuid = "{nnnnnnnn-nnnn-nnnn-nnnn-nnnnnnnnnnnn}" 
```

所以我们会在每个版本中更新产品 guid（而不是产品升级 guid）。

补救措施是稍微更改此 dll 的构建脚本以将程序集版本设置为“10.0.0”。**1** .{git rev-list --count HEAD}'，大概被视为更高编号的版本。

为什么这有效，我无法解释。

# .net - 从 XSD 架构生成 C# 代码时，如何让数组具有“项目”以外的名称？

> ID：660533
> 
> 赞同：4
> 
> 时间：2009-03-18T23:47:03.113
> 
> 标签：.net, web-services, xsd, attributes, code-generation

我正在开发一个项目，该项目必须连接到一些古老的 web 服务，这些 web 服务将请求和响应的一些分层数据打包到单个分层 XML 字符串中。

我一直在使用 xsd.exe 从示例请求和响应 XML 片段生成 XSD，在必要时对其进行修改以成为可能的最佳定义，并再次使用 xsd.exe 生成 C# 对象。然后，调用 Web 服务的管理器可以将这些强类型请求对象作为参数，将它们序列化为字符串以进行调用，将响应作为字符串返回，将它们反序列化为强类型响应对象并返回它们。

如果我有一个字符串列表，我可以有一个有效的 XSD，它认为它是一个复杂类型的无界 xs:xs:string 元素的选择，然后它将简单地反序列化为一个字符串数组，这很好而且处理简单。烦人的问题是，由于某种原因，似乎没有任何方法可以让它调用字符串数组，而不是“ *Items* ”。无论我将***什么***添加到架构中，我都无法让 xsd.exe 写入任何其他名称。

这是一个示例 XSD 架构：

```
<?xml version="1.0" encoding="utf-8"?>
<xs:schema id="AccountStatusRequest" xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">
    <xs:element name="AccountStatusRequest">
        <xs:complexType>
            <xs:choice minOccurs="0" maxOccurs="unbounded" id="AccountRowIDs">
                <xs:element nillable="true" type="xs:string" id="AccountRowID" name="AccountRowID"/>
            </xs:choice>
        </xs:complexType>
    </xs:element>
</xs:schema> 
```

结果类：

```
public partial class AccountStatusRequest {

    private string[] itemsField;

    [System.Xml.Serialization.XmlElementAttribute("AccountRowID", Form=System.Xml.Schema.XmlSchemaForm.Unqualified, IsNullable=true)]
    public string[] Items {
        get {
            return this.itemsField;
        }
        set {
            this.itemsField = value;
        }
    }
} 
```

我已经尝试将智能感知中的几乎所有 msdata: 属性添加到选择和内部元素中，但没有任何区别。

只是为了争论，我为该 complexType 添加了几个额外的类似选项，以查看是否会强制它为字符串数组使用名称，但它却给了我*Items*、*Items1*、*Items2* ...

我真的不希望它必须是一个只包含一个字符串的自己类型的数组，但我也真的不想将它称为“ *Items* ”，没有xml注释（有谁知道如何添加这些到 xsd？），什么时候它应该有一个更具描述性的名称。而且我绝对不能只是手动更改它，因为每当 web 服务模式更改时所需的工作流就是更改 XSD，然后从它们重新生成类。

这似乎是 xsd.exe 应该支持的另一件事。有什么我想念的吗？我应该以某种方式采取不同的方法吗？或者有没有我可以使用的替代工具，而不是那么蹩脚的？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-02T12:56:00.913

尝试将选项更改为序列，并将最小值/最大值放在 AccountRowID 元素中...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-18T23:57:38.970

我相当确定这是 xsd.exe 的限制；您可以在另一个方向（类 => xml/xsd）获得自定义结果，但这对您没有多大帮助。对不起。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-02T13:54:12.597

编辑：抱歉，我以某种方式错过了先前的答案-它对我有用-这是我使用的架构和结果。我原来的答案也可能是合适的。

```
<?xml version="1.0" encoding="utf-8"?>
<xs:schema id="AccountStatusRequest" xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">
    <xs:element name="AccountStatusRequest" msdata:ColumnName="AccountList">
        <xs:complexType>
            <xs:sequence minOccurs="0" maxOccurs="unbounded" id="AccountRowIDs">
              <xs:element nillable="true" type="xs:string" id="AccountRowID" name="AccountRowID"/>
            </xs:sequence>
        </xs:complexType>
    </xs:element>  
</xs:schema>

public partial class AccountStatusRequest {

    private string[] accountRowIDField;

    /// <remarks/>
    [System.Xml.Serialization.XmlElementAttribute("AccountRowID", Form=System.Xml.Schema.XmlSchemaForm.Unqualified, IsNullable=true)]
    public string[] AccountRowID {
        get {
            return this.accountRowIDField;
        }
        set {
            this.accountRowIDField = value;
        }
    }
} 
```

您好，我稍微更改了架构，用一个由 simpleType 和一个属性包装的列表代替了选择，这产生了所需的输出（一个命名的字符串数组）。但是，我不确定更改后的架构是否适合您正在做的事情？

这是修改后的架构：

```
<?xml version="1.0" encoding="utf-8"?>
<xs:schema id="AccountStatusRequest" xmlns="" xmlns:xs="http://www.w3.org/2001/XMLSchema" xmlns:msdata="urn:schemas-microsoft-com:xml-msdata">
    <xs:element name="AccountStatusRequest" msdata:ColumnName="AccountList">
        <xs:complexType>
          <xs:attribute name="AccountRowIDs">
            <xs:simpleType id="AccountRowID"  >
              <xs:list itemType="xs:string">                
              </xs:list>
            </xs:simpleType>       
          </xs:attribute>
        </xs:complexType>
    </xs:element>  
</xs:schema> 
```

..以及使用 xsd.exe 运行后的输出：

```
[System.CodeDom.Compiler.GeneratedCodeAttribute("xsd", "2.0.50727.3038")]
[System.SerializableAttribute()]
[System.Diagnostics.DebuggerStepThroughAttribute()]
[System.ComponentModel.DesignerCategoryAttribute("code")]
[System.Xml.Serialization.XmlTypeAttribute(AnonymousType=true)]
[System.Xml.Serialization.XmlRootAttribute(Namespace="", IsNullable=false)]
public partial class AccountStatusRequest {

    private string[] accountRowIDsField;

    /// <remarks/>
    [System.Xml.Serialization.XmlAttributeAttribute()]
    public string[] AccountRowIDs {
        get {
            return this.accountRowIDsField;
        }
        set {
            this.accountRowIDsField = value;
        }
    }
} 
```

# pointers - 我们应该在“编程基础”课程中教授指针吗？

> ID：660538
> 
> 赞同：5
> 
> 时间：2009-03-18T23:48:18.760
> 
> 标签：pointers, computer-science

明年秋天，我将教授一门关于编程基础的课程，第一年的计算机科学课程。在这样的课程中教授指针的优点和缺点是什么？（我的立场：应该教他们）。

**编辑：**我对“迎合你的听众”论点的问题是，在大学的头几年，我们（教授）不知道学生是否愿意成为科学家......我们希望我们知道，但我们有在那些将留在学校的人（4 年不是科学家做的）和那些将成为工程师的人之间取得平衡。

**最终决定：**至少是引用，但可能是没有指针运算的指针。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-18T23:50:36.990

至少你应该教授参考资料或一些等效的概念。我认为您可能应该对指针算术、c 数组和字符串等事情放轻松，但间接是计算机科学中一个非常重要的概念，应该向学生介绍它。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-18T23:51:29.657

是的。

指针是其他高级语言中大量概念的基础，我坚信您需要教授一定数量的低级内容，以帮助我们更好地理解为什么我们会为更高级别的东西而烦恼全部。

一旦你了解了内存是如何分配的，以及它是如何用指针寻址和操作的，解释很多其他的结构就会变得更容易。例如，`NullPointerException`在 Java 中解释 a ，甚至在此类语言中解释引用的概念都是小菜一碟，如果你有人懂 C 中的指针（更好的是，如果他们也懂 C++ 中的引用）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-18T23:53:30.947

绝对教他们。理解间接对于编程来说是必不可少的，无论是指针、引用、动态绑定还是其他任何东西。现在显然不要从它们开始，但理解间接至少与理解控制流思想一样重要。

当然，缺点是有些人不会得到它，并且会表现不佳或辍学。如果这是为那些想成为 CS 专业的人开设的课程，那么不要担心，因为你只是在鼓励他们更早地而不是更晚地转换专业。如果它是为对编程感兴趣的人提供的更多或通用的课程，那么可能仍应介绍它们，但不要严厉或沉重地评分。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-18T23:53:52.847

在我作为 CS 学生的第一年，我在秋季参加了 Java 课程，这是一般介绍。教授没有直接教指针，但他确实教了引用的概念，以及为什么你可以修改对象而不是当任何一个在参数中传递的原语时。

在我的第二学期，我参加了该系列的下一门课程，是关于 C 的，这门课非常依赖指针。

对于编程类的介绍，我想说只提到引用，而不是直接提到指针。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-18T23:51:23.603

我认为“编程基础”课程至少应该涉及基本的处理器体系结构和汇编语言，如果是这样，你就不能真正提出不讨论指针的理由。如果您只教授高级（字节码）语言，那么我猜指针会使观众感到困惑。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-18T23:58:14.727

**优点**：对机器使用内存的方式有深入的了解，堆上数据的指针与堆栈上的数据指针之间的区别（和缺陷），按地址传递方法等。

**缺点**：对于尚未了解（或没有足够时间吸收概念）计算机体系结构（包括什么是堆栈、什么是寄存器、调用约定等）的观众来说很复杂。

因此，总而言之，**这在很大程度上取决于您的受众和您将处理的语言**（指针在 LISP 或 Java 的上下文中将毫无意义），以及您愿意深入什么是堆的方向，什么是堆栈，范围如何转换为堆栈（即为什么从不返回指向局部变量的指针）等。

当我教授工程课程的指针时，我最终在一个简单的“hello world”程序上启动了一个调试器，并向学生展示了实际的机器代码、寄存器值和相应的内存转储，以及堆栈操作和参数传递等，但他们已经做好了准备。您的听众是否会接受这样的深入探索，以确保对幕后发生的事情有充分的了解，*您*是否愿意这样做？:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-18T23:54:05.750

我认为你不应该**先**教它。但后来，一旦获得了编程的基本概念。

一个很好的例子是 Stroustrup 的最后一本书：[*编程——使用 C++ 的原则和实践*](http://www.research.att.com/~bs/programming.html)，他在其中教授如何制作解析器、I/O（流）使用和 GUI 使用，甚至在谈论指针之前！

我认为这将是一个很好的教学参考，因为它更自然地理解我们构建想法的方式，而不是我们必须同时处理多少约束（例如内存管理）才能使软件工作。我真的向您推荐这本书，让您对教授编程基础知识有一个全新的视角。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-19T00:19:20.650

这实际上取决于您课程的目标 - 教授编程和教授计算机科学是两个独立的目标，虽然它们不是相互排斥的，但入门课程通常不能同时很好地教授两者。这是一个不同的例子：假设我们想学习如何对列表进行排序。C++ 编程课程将教您使用 std::sort 函数模板的语法，而家庭作业可能是编写几个比较函子。计算机科学课程将向您解释什么是合并排序，算法在伪代码中的样子，以及它的性能/空间特性，而家庭作业将是编写排序函数本身。

因此，如果您正在教授入门编程，那么是的，您应该教您的学生有关指针的知识。

如果您正在教授计算机科学，那么不，没有必要在入门级别上理解指针。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-19T01:38:36.373

任何自称为优秀程序员的人都必须知道指针是如何工作的。成为一名优秀的程序员意味着他们不仅知道一种编程语言，而且他们知道编程语言的一般工作原理，从而使他们能够适应以前从未见过的编程语言。

然而，这并不意味着编程课程的基础知识应该是教学指针。

*   如果您的目标是让这些人全面、全面地熟悉一般的编程语言，那么是的，指针应该是其中的一部分。
*   如果你向他们介绍编程的方式是一开始使用一种编程语言，目的是在后续课程中涵盖其他语言，而指针与该语言无关，那么现在还没有必要谈论指针。

我认为仅以一种语言开始人们，而不是试图同时涵盖每种语言风格，这有很多话要说。

我的第一门编程入门课程使用了 Haskell。直到随后的使用 C 的课程才引入了指针（当我参加这门课程时，我已经是一名优秀的 C 和 C++ 程序员；这些科目是必修的）。

# php - 自动合成声音 - php 或类似的东西 - 声音的 GD 库？

> ID：660542
> 
> 赞同：4
> 
> 时间：2009-03-18T23:50:08.583
> 
> 标签：php, audio, server-side, compositing

我正在寻找一种方法来完成以下任务：用户在闪存中编写了一些鼓循环，并且能够以某种方式下载或保存循环的 mp3。

我认为该模式可以在服务器端进行堆肥。然后将文件的链接发送给用户。

我原以为那里可能有类似 imageGD 或 imageMagick 的声音？

此外，闪存是否可以生成用户可以即时保存的内容？这也可以，但我不知道闪存中有任何此类功能。

我想在处理过程中可以做一些事情，但我对此完全不熟悉。

这种事情怎么可能完成？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-05-09T17:13:35.143

看看[SoX](http://sox.sourceforge.net/)。

SoX 是一个跨平台（Windows、Linux、MacOS X 等）命令行实用程序，可以将各种格式的计算机音频文件转换为其他格式。它还可以对这些声音文件应用各种效果，并且作为额外的奖励，SoX 可以在大多数平台上播放和录制音频文件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T00:06:41.553

如果您可以控制服务器环境，我想您可以使用[ffmpeg](http://ffmpeg.org/ffmpeg-doc.html)来完成这项工作。

在您的 PHP 代码中：

```
exec(escapeshellcmd("/path/to/ffmpeg -i /path/to/audiofile1.mp3 -i /path/to/audiofile2.mp3 -itsoffset 10 -i /path/to/audiofile3.mp3 -itsoffset 20 -acodec mp3 /path/to/outputfile.mp3"),$output,$status); 
```

请注意，-itsoffset 是您希望放置音频文件的偏移量（以秒为单位）。因此，如果您希望对时间进行非常微小的控制，这并不理想，但我不知道您是否需要。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T00:04:41.230

看看这个[MP3 课程](http://www.sourcerally.net/Scripts/20-PHP-MP3-Class)。

我将它用于今天刚刚部署的项目。

它可以读取 MP3，提取其中的一部分，合并文件，除其他外，它不重叠声音。

如果您已经拥有这些声音片段（鼓、吉他等）并且您不需要重叠，那么这似乎就是您正在寻找的。

# version-control - 捕获非标准 Powershell CmdLet 输出以进行流控制

> ID：660545
> 
> 赞同：2
> 
> 时间：2009-03-18T23:50:41.810
> 
> 标签：version-control, tfs, powershell

目前正在尝试使用 MS 发布的“Team Foundation Server Power Tools”包中的 cmdlet 构建脚本。

我正在尝试根据“ **Update-TfsWorkspace** ”cmdlet 的成功或失败来处理命令逻辑，但是我似乎无法从调用中获得返回码，也无法使用 Out-String 捕获输出。我正在使用 Powershell v1。

```
update-tfsworkspace "C:\doesnotexist\" -recurse -version T 
```

产生“无法确定工作区”的消息。这是我试图捕捉的错误。

```
$ret = update-tfsworkspace "C:\doesnotexist\" -recurse -version T 
```

预计会给我一个 $true/$false 指示成功/失败但不起作用。

```
update-tfsworkspace "C:\doesnotexist\" -recurse -version T | Out-Null 
```

预计会阻止 cmdlet 写入消息，但不起作用。

```
trap{echo "fail"}
update-tfsworkspace $workspace_path -recurse -version T 
```

预计会捕获错误并写入“失败”但不起作用。

```
$msg = update-tfsworkspace $workspace_path -recurse -version T | Out-String 
```

预计将使用主机输出填充 $msg 变量，但不起作用。

我在这里完全没有想法。帮助将不胜感激！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T16:30:35.207

有点hacky，但由于我没有TFS来尝试找出其他东西，看看[这](http://keithhill.spaces.live.com/blog/cns!5A8D2641E0963A97!6926.entry)是否有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-22T05:51:18.430

我会说这个 cmdlet 没有正确编写。首先，由于它没有成功，它应该发出一个会导致 $? 返回 false ，您可以检查或捕获它。其次，您不能使用 -ea 0 抑制错误消息。看起来这个管理单元正在使用 Host api 将错误字符串写入主机控制台。那是喷！！目前，您可以按照 EBGreen 的建议进行操作：

$msg = powershell.exe -nologo update-tfsworkspace "C:\doesnotexist\" -recurse -version T 2>&1

当新的 PowerShell 实例启动时，请注意您的配置文件脚本吐出的所有文本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-24T21:26:40.583

您的问题是 cmdlet 正在写入错误（非终止错误），但没有引发异常（终止错误）。您可以通过添加 ErrorAction 参数使其抛出异常：

```
trap{echo "fail"}
update-tfsworkspace $workspace_path -recurse -version T -ErrorAction "Stop" 
```

这将导致 cmdlet 终止所有错误（如果写入错误流则引发异常）。

# .net - 如何在 WPF TextBox 中自动选择焦点上的所有文本？

> ID：660554
> 
> 赞同：251
> 
> 时间：2009-03-18T23:54:50.507
> 
> 标签：.net, wpf, silverlight, textbox

如果我`SelectAll`从`GotFocus`事件处理程序中调用，它不适用于鼠标 - 一旦释放鼠标，选择就会消失。

编辑：人们喜欢 Donnelle 的回答，我将尝试解释为什么我不像接受的答案那样喜欢它。

*   它更复杂，而接受的答案以更简单的方式做同样的事情。
*   接受答案的可用性更好。当您单击文本中间时，当您松开鼠标时，文本会被取消选择，让您可以立即开始编辑，如果您仍想全选，只需再次按下按钮，这一次它不会在释放时取消选择。按照 Donelle 的食谱，如果我单击文本中间，我必须再次单击才能进行编辑。如果我单击文本内的某个位置而不是文本的外部，这很可能意味着我想开始编辑而不是覆盖所有内容。

* * *

## 回答 #1

> 赞同：220
> 
> 时间：2009-03-19T06:18:35.060

我们有它，所以第一次单击全选，再一次单击转到光标（我们的应用程序设计用于带笔的平板电脑）。

你可能会发现它很有用。

```
public class ClickSelectTextBox : TextBox
{
    public ClickSelectTextBox()
    {
        AddHandler(PreviewMouseLeftButtonDownEvent, 
          new MouseButtonEventHandler(SelectivelyIgnoreMouseButton), true);
        AddHandler(GotKeyboardFocusEvent, 
          new RoutedEventHandler(SelectAllText), true);
        AddHandler(MouseDoubleClickEvent, 
          new RoutedEventHandler(SelectAllText), true);
    }

    private static void SelectivelyIgnoreMouseButton(object sender, 
                                                     MouseButtonEventArgs e)
    {
        // Find the TextBox
        DependencyObject parent = e.OriginalSource as UIElement;
        while (parent != null && !(parent is TextBox))
            parent = VisualTreeHelper.GetParent(parent);

        if (parent != null)
        {
            var textBox = (TextBox)parent;
            if (!textBox.IsKeyboardFocusWithin)
            {
                // If the text box is not yet focussed, give it the focus and
                // stop further processing of this click event.
                textBox.Focus();
                e.Handled = true;
            }
        }
    }

    private static void SelectAllText(object sender, RoutedEventArgs e)
    {
        var textBox = e.OriginalSource as TextBox;
        if (textBox != null)
            textBox.SelectAll();
    }
} 
```

* * *

## 回答 #2

> 赞同：174
> 
> 时间：2010-03-31T13:32:16.403

Donnelle 的答案效果最好，但必须派生一个新类来使用它是一种痛苦。

我没有这样做，而是在 App.xaml.cs 中为应用程序中的所有 TextBox 注册处理程序。这使我可以将 Donnelle 的答案与标准 TextBox 控件一起使用。

将以下方法添加到您的 App.xaml.cs：

```
public partial class App : Application
{
    protected override void OnStartup(StartupEventArgs e) 
    {
        // Select the text in a TextBox when it receives focus.
        EventManager.RegisterClassHandler(typeof(TextBox), TextBox.PreviewMouseLeftButtonDownEvent,
            new MouseButtonEventHandler(SelectivelyIgnoreMouseButton));
        EventManager.RegisterClassHandler(typeof(TextBox), TextBox.GotKeyboardFocusEvent, 
            new RoutedEventHandler(SelectAllText));
        EventManager.RegisterClassHandler(typeof(TextBox), TextBox.MouseDoubleClickEvent,
            new RoutedEventHandler(SelectAllText));
        base.OnStartup(e); 
    }

    void SelectivelyIgnoreMouseButton(object sender, MouseButtonEventArgs e)
    {
        // Find the TextBox
        DependencyObject parent = e.OriginalSource as UIElement;
        while (parent != null && !(parent is TextBox))
            parent = VisualTreeHelper.GetParent(parent);

        if (parent != null)
        {
            var textBox = (TextBox)parent;
            if (!textBox.IsKeyboardFocusWithin)
            {
                // If the text box is not yet focused, give it the focus and
                // stop further processing of this click event.
                textBox.Focus();
                e.Handled = true;
            }
        }
    }

    void SelectAllText(object sender, RoutedEventArgs e)
    {
        var textBox = e.OriginalSource as TextBox;
        if (textBox != null)
            textBox.SelectAll();
    }
} 
```

* * *

## 回答 #3

> 赞同：97
> 
> 时间：2010-04-20T10:32:39.500

我选择了[Donnelle 的部分答案](https://stackoverflow.com/a/661224/10927863)（跳过双击），因为我认为这更自然。然而，像 Grokys 一样，我不喜欢创建派生类的需要。但我也不喜欢 Grokys 的`OnStartup`方法。我在“一般但不总是”的基础上需要这个。

我已将其作为附件实现，`DependencyProperty`因此我可以`local:SelectTextOnFocus.Active = "True"`在 xaml 中进行设置。我觉得这种方式最令人愉快。

```
using System.Windows;
using System.Windows.Controls;
using System.Windows.Input;
using System.Windows.Media;

public class SelectTextOnFocus : DependencyObject
{
    public static readonly DependencyProperty ActiveProperty = DependencyProperty.RegisterAttached(
        "Active",
        typeof(bool),
        typeof(SelectTextOnFocus),
        new PropertyMetadata(false, ActivePropertyChanged));

    private static void ActivePropertyChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        if (d is TextBox)
        {
            TextBox textBox = d as TextBox;
            if ((e.NewValue as bool?).GetValueOrDefault(false))
            {
                textBox.GotKeyboardFocus += OnKeyboardFocusSelectText;
                textBox.PreviewMouseLeftButtonDown += OnMouseLeftButtonDown;
            }
            else
            {
                textBox.GotKeyboardFocus -= OnKeyboardFocusSelectText;
                textBox.PreviewMouseLeftButtonDown -= OnMouseLeftButtonDown;
            }
        }
    }

    private static void OnMouseLeftButtonDown(object sender, MouseButtonEventArgs e)
    {
        DependencyObject dependencyObject = GetParentFromVisualTree(e.OriginalSource);

        if (dependencyObject == null)
        {
            return;
        }

        var textBox = (TextBox)dependencyObject;
        if (!textBox.IsKeyboardFocusWithin)
        {
            textBox.Focus();
            e.Handled = true;
        }
    }

    private static DependencyObject GetParentFromVisualTree(object source)
    {
        DependencyObject parent = source as UIElement;
        while (parent != null && !(parent is TextBox))
        {
            parent = VisualTreeHelper.GetParent(parent);
        }

        return parent;
    }

    private static void OnKeyboardFocusSelectText(object sender, KeyboardFocusChangedEventArgs e)
    {
        TextBox textBox = e.OriginalSource as TextBox;
        if (textBox != null)
        {
            textBox.SelectAll();
        }
    }

    [AttachedPropertyBrowsableForChildrenAttribute(IncludeDescendants = false)]
    [AttachedPropertyBrowsableForType(typeof(TextBox))]
    public static bool GetActive(DependencyObject @object)
    {
        return (bool) @object.GetValue(ActiveProperty);
    }

    public static void SetActive(DependencyObject @object, bool value)
    {
        @object.SetValue(ActiveProperty, value);
    }
} 
```

对于我的“一般但不总是”功能，我将此 Attache 属性设置`True`为 (global) `TextBox` `Style`。这种方式“选择文本”总是“开启”，但我可以在每个文本框的基础上禁用它。

* * *

## 回答 #4

> 赞同：83
> 
> 时间：2009-03-19T00:27:32.907

不知道为什么它在`GotFocus`事件中失去了选择。

但一种解决方案是对事件进行`GotKeyboardFocus`选择`GotMouseCapture`。这样它就会一直工作。

- 编辑 -

在此处添加一个示例，向人们展示如何解决上述一些缺点：

```
private void TextBox_GotKeyboardFocus(object sender, KeyboardFocusChangedEventArgs e)
{
    // Fixes issue when clicking cut/copy/paste in context menu
    if (textBox.SelectionLength == 0) 
        textBox.SelectAll();
}

private void TextBox_LostMouseCapture(object sender, MouseEventArgs e)
{
    // If user highlights some text, don't override it
    if (textBox.SelectionLength == 0) 
        textBox.SelectAll();

    // further clicks will not select all
    textBox.LostMouseCapture -= TextBox_LostMouseCapture; 
}

private void TextBox_LostKeyboardFocus(object sender, KeyboardFocusChangedEventArgs e)
{
    // once we've left the TextBox, return the select all behavior
    textBox.LostMouseCapture += TextBox_LostMouseCapture;
} 
```

* * *

## 回答 #5

> 赞同：47
> 
> 时间：2009-08-12T07:07:02.610

为了您的方便，以下是实现答案解决方案的 Blend 行为：

一个用于附加到单个文本框：

```
public class SelectAllTextOnFocusBehavior : Behavior<TextBox>
{
    protected override void OnAttached()
    {
        base.OnAttached();
        AssociatedObject.GotKeyboardFocus += AssociatedObjectGotKeyboardFocus;
        AssociatedObject.GotMouseCapture += AssociatedObjectGotMouseCapture;
        AssociatedObject.PreviewMouseLeftButtonDown += AssociatedObjectPreviewMouseLeftButtonDown;
    }

    protected override void OnDetaching()
    {
        base.OnDetaching();
        AssociatedObject.GotKeyboardFocus -= AssociatedObjectGotKeyboardFocus;
        AssociatedObject.GotMouseCapture -= AssociatedObjectGotMouseCapture;
        AssociatedObject.PreviewMouseLeftButtonDown -= AssociatedObjectPreviewMouseLeftButtonDown;
    }

    private void AssociatedObjectGotKeyboardFocus(object sender,
        System.Windows.Input.KeyboardFocusChangedEventArgs e)
    {
        AssociatedObject.SelectAll();
    }

    private void AssociatedObjectGotMouseCapture(object sender,
        System.Windows.Input.MouseEventArgs e)
    {
        AssociatedObject.SelectAll();   
    }

    private void AssociatedObjectPreviewMouseLeftButtonDown(object sender, MouseButtonEventArgs e)
    {
        if(!AssociatedObject.IsKeyboardFocusWithin)
        {
            AssociatedObject.Focus();
            e.Handled = true;
        }
    }
} 
```

还有一个用于附加到包含多个 TextBox 的容器的根：

```
public class SelectAllTextOnFocusMultiBehavior : Behavior<UIElement>
{
    protected override void OnAttached()
    {
        base.OnAttached();
        AssociatedObject.GotKeyboardFocus += HandleKeyboardFocus;
        AssociatedObject.GotMouseCapture += HandleMouseCapture;
    }

    protected override void OnDetaching()
    {
        base.OnDetaching();
        AssociatedObject.GotKeyboardFocus -= HandleKeyboardFocus;
        AssociatedObject.GotMouseCapture -= HandleMouseCapture;
    }

    private static void HandleKeyboardFocus(object sender,
        System.Windows.Input.KeyboardFocusChangedEventArgs e)
    {
        var txt = e.NewFocus as TextBox;
        if (txt != null)
            txt.SelectAll();
    }

    private static void HandleMouseCapture(object sender,
        System.Windows.Input.MouseEventArgs e)
    {
        var txt = e.OriginalSource as TextBox;
        if (txt != null)
            txt.SelectAll();
    }
} 
```

* * *

## 回答 #6

> 赞同：29
> 
> 时间：2013-07-25T13:19:19.223

我使用附加行为而不是 Sergey 的回答中的表达式行为解决了这个问题。这意味着我不需要`System.Windows.Interactivity`Blend SDK 中的依赖项：

```
public class TextBoxBehavior
{
    public static bool GetSelectAllTextOnFocus(TextBox textBox)
    {
        return (bool)textBox.GetValue(SelectAllTextOnFocusProperty);
    }

    public static void SetSelectAllTextOnFocus(TextBox textBox, bool value)
    {
        textBox.SetValue(SelectAllTextOnFocusProperty, value);
    }

    public static readonly DependencyProperty SelectAllTextOnFocusProperty =
        DependencyProperty.RegisterAttached(
            "SelectAllTextOnFocus",
            typeof (bool),
            typeof (TextBoxBehavior),
            new UIPropertyMetadata(false, OnSelectAllTextOnFocusChanged));

    private static void OnSelectAllTextOnFocusChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        var textBox = d as TextBox;
        if (textBox == null) return;

        if (e.NewValue is bool == false) return;

        if ((bool) e.NewValue)
        {
            textBox.GotFocus += SelectAll;
            textBox.PreviewMouseDown += IgnoreMouseButton;
        }
        else
        {
            textBox.GotFocus -= SelectAll;
            textBox.PreviewMouseDown -= IgnoreMouseButton;
        }
    }

    private static void SelectAll(object sender, RoutedEventArgs e)
    {
        var textBox = e.OriginalSource as TextBox;
        if (textBox == null) return;
        textBox.SelectAll();
    }

    private static void IgnoreMouseButton(object sender, System.Windows.Input.MouseButtonEventArgs e)
    {
        var textBox = sender as TextBox;
        if (textBox == null || (!textBox.IsReadOnly && textBox.IsKeyboardFocusWithin)) return;

        e.Handled = true;
        textBox.Focus();
    }
} 
```

然后，您可以像这样在 XAML 中使用它：

```
<TextBox Text="Some Text" behaviors:TextBoxBehavior.SelectAllTextOnFocus="True"/> 
```

我在[这里](http://www.dutton.me.uk/2013-07-25/how-to-select-all-wpf-textbox-text-on-focus-using-an-attached-behavior/)写了博客。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2013-05-02T00:19:44.537

[这是MSDN](http://social.msdn.microsoft.com/forums/en-US/wpf/thread/564b5731-af8a-49bf-b297-6d179615819f)上一个非常好的非常简单的解决方案：

```
<TextBox
    MouseDoubleClick="SelectAddress"
    GotKeyboardFocus="SelectAddress"
    PreviewMouseLeftButtonDown="SelectivelyIgnoreMouseButton" /> 
```

这是后面的代码：

```
private void SelectAddress(object sender, RoutedEventArgs e)
{
    TextBox tb = (sender as TextBox);
    if (tb != null)
    {
        tb.SelectAll();
    }
}

private void SelectivelyIgnoreMouseButton(object sender,
    MouseButtonEventArgs e)
{
    TextBox tb = (sender as TextBox);
    if (tb != null)
    {
        if (!tb.IsKeyboardFocusWithin)
        {
            e.Handled = true;
            tb.Focus();
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2012-02-24T17:46:36.640

我认为这很好用：

```
private void ValueText_GotFocus(object sender, RoutedEventArgs e)
{
    TextBox tb = (TextBox)e.OriginalSource;
    tb.Dispatcher.BeginInvoke(
        new Action(delegate
            {
                tb.SelectAll();
            }), System.Windows.Threading.DispatcherPriority.Input);
} 
```

如果您想将其实现为扩展方法：

```
public static void SelectAllText(this System.Windows.Controls.TextBox tb)
{
    tb.Dispatcher.BeginInvoke(
        new Action(delegate
        {
            tb.SelectAll();
        }), System.Windows.Threading.DispatcherPriority.Input);
} 
```

在您的`GotFocus`活动中：

```
private void ValueText_GotFocus(object sender, RoutedEventArgs e)
{
    TextBox tb = (TextBox)e.OriginalSource;
    tb.SelectAllText();
} 
```

我发现了上面的解决方案，因为几个月前我正在寻找一种方法来将焦点设置为给定的`UIElement`. 我在某处发现了下面的代码（特此提供信用），它运行良好。即使它与 OP 的问题没有直接关系，我也会发布它，因为它展示了`Dispatcher`与`UIElement`.

```
// Sets focus to uiElement
public static void DelayedFocus(this UIElement uiElement)
{
    uiElement.Dispatcher.BeginInvoke(
    new Action(delegate
    {
        uiElement.Focusable = true;
        uiElement.Focus();
        Keyboard.Focus(uiElement);
    }),
    DispatcherPriority.Render);
} 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2020-05-12T16:47:04.637

以下是使用其他解决方案解决一些问题的尝试：

1.  使用右键单击上下文菜单进行剪切/复制/过去选择所有文本，即使您没有全选。
2.  从右键单击上下文菜单返回时，始终选择所有文本。
3.  使用`Alt`+返回应用程序时`Tab`，始终选择所有文本。
4.  当试图在第一次点击时只选择部分文本时，总是选择全部（例如，与谷歌浏览器地址栏不同）。

我写的代码是可配置的。您可以通过设置三个只读字段来选择全选行为应发生的操作：`SelectOnKeybourdFocus`、`SelectOnMouseLeftClick`、`SelectOnMouseRightClick`。

这个解决方案的缺点是它更复杂并且存储了静态状态。它似乎与`TextBox`控件的默认行为进行了一场丑陋的斗争。尽管如此，它仍然有效，并且所有代码都隐藏在 Attached Property 容器类中。

```
public static class TextBoxExtensions
{
    // Configuration fields to choose on what actions the select all behavior should occur.
    static readonly bool SelectOnKeybourdFocus = true;
    static readonly bool SelectOnMouseLeftClick = true;
    static readonly bool SelectOnMouseRightClick = true;

    // Remembers a right click context menu that is opened 
    static ContextMenu ContextMenu = null;

    // Remembers if the first action on the TextBox is mouse down 
    static bool FirstActionIsMouseDown = false;

    public static readonly DependencyProperty SelectOnFocusProperty =
        DependencyProperty.RegisterAttached("SelectOnFocus", typeof(bool), typeof(TextBoxExtensions), new PropertyMetadata(false, new PropertyChangedCallback(OnSelectOnFocusChanged)));

    [AttachedPropertyBrowsableForChildren(IncludeDescendants = false)]
    [AttachedPropertyBrowsableForType(typeof(TextBox))]
    public static bool GetSelectOnFocus(DependencyObject obj)
    {
        return (bool)obj.GetValue(SelectOnFocusProperty);
    }

    public static void SetSelectOnFocus(DependencyObject obj, bool value)
    {
        obj.SetValue(SelectOnFocusProperty, value);
    }

    private static void OnSelectOnFocusChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        if (!(d is TextBox textBox)) return;

        if (GetSelectOnFocus(textBox))
        {
            // Register events
            textBox.PreviewMouseDown += TextBox_PreviewMouseDown;
            textBox.PreviewMouseUp += TextBox_PreviewMouseUp;
            textBox.GotKeyboardFocus += TextBox_GotKeyboardFocus;
            textBox.LostKeyboardFocus += TextBox_LostKeyboardFocus;
        }
        else
        {
            // Unregister events
            textBox.PreviewMouseDown -= TextBox_PreviewMouseDown;
            textBox.PreviewMouseUp -= TextBox_PreviewMouseUp;
            textBox.GotKeyboardFocus -= TextBox_GotKeyboardFocus;
            textBox.LostKeyboardFocus -= TextBox_LostKeyboardFocus;
        }
    }

    private static void TextBox_PreviewMouseDown(object sender, MouseButtonEventArgs e)
    {
        if (!(sender is TextBox textBox)) return;

        // If mouse clicked and focus was not in text box, remember this is the first click.
        // This will enable to prevent select all when the text box gets the keyboard focus 
        // right after the mouse down event.
        if (!textBox.IsKeyboardFocusWithin)
        {
            FirstActionIsMouseDown = true;
        }
    }

    private static void TextBox_PreviewMouseUp(object sender, MouseButtonEventArgs e)
    {
        if (!(sender is TextBox textBox)) return;

        // Select all only if:
        // 1) SelectOnMouseLeftClick/SelectOnMouseRightClick is true and left/right button was clicked
        // 3) This is the first click
        // 4) No text is selected
        if (((SelectOnMouseLeftClick && e.ChangedButton == MouseButton.Left) || 
            (SelectOnMouseRightClick && e.ChangedButton == MouseButton.Right)) &&
            FirstActionIsMouseDown &&
            string.IsNullOrEmpty(textBox.SelectedText))
        {
            textBox.SelectAll();
        }

        // It is not the first click 
        FirstActionIsMouseDown = false;
    }

    private static void TextBox_GotKeyboardFocus(object sender, KeyboardFocusChangedEventArgs e)
    {
        if (!(sender is TextBox textBox)) return;

        // Select all only if:
        // 1) SelectOnKeybourdFocus is true
        // 2) Focus was not previously out of the application (e.OldFocus != null)
        // 3) The mouse was pressed down for the first after on the text box
        // 4) Focus was not previously in the context menu
        if (SelectOnKeybourdFocus &&
            e.OldFocus != null &&
            !FirstActionIsMouseDown &&
            !IsObjectInObjectTree(e.OldFocus as DependencyObject, ContextMenu))
        {
            textBox.SelectAll();
        }

        // Forget ContextMenu
        ContextMenu = null;
    }

    private static void TextBox_LostKeyboardFocus(object sender, KeyboardFocusChangedEventArgs e)
    {
        if (!(sender is TextBox textBox)) return;

        // Remember ContextMenu (if opened)
        ContextMenu = e.NewFocus as ContextMenu;

        // Forget selection when focus is lost if:
        // 1) Focus is still in the application
        // 2) The context menu was not opened
        if (e.NewFocus != null
            && ContextMenu == null)
        {
            textBox.SelectionLength = 0;
        }
    }

    // Helper function to look if a DependencyObject is contained in the visual tree of another object
    private static bool IsObjectInObjectTree(DependencyObject searchInObject, DependencyObject compireToObject)
    {
        while (searchInObject != null && searchInObject != compireToObject)
        {
            searchInObject = VisualTreeHelper.GetParent(searchInObject);
        }

        return searchInObject != null;
    }
} 
```

要将附加属性附加到 a `TextBox`，您需要做的就是添加`xmlns`附加属性的 xml 命名空间 ( )，然后像这样使用它：

```
<TextBox attachedprop:TextBoxExtensions.SelectOnFocus="True"/> 
```

关于此解决方案的一些说明：

1.  要覆盖鼠标按下事件的默认行为并启用在第一次单击时仅选择部分文本，则在鼠标按下事件时选择所有文本。
2.  我不得不处理在`TextBox`失去焦点后会记住它的选择的事实。我实际上已经覆盖了这种行为。
3.  我必须记住按下鼠标按钮是否是`TextBox`（`FirstActionIsMouseDown`静态字段）上的第一个操作。
4.  我必须记住右键单击打开的上下文菜单（`ContextMenu`静态字段）。

我发现的唯一副作用是何时`SelectOnMouseRightClick`为真。有时，右键单击上下文菜单在打开并右键单击空白时会闪烁，而`TextBox`不是“全选”。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2015-07-13T10:17:54.037

在 App.xaml 文件中：

```
<Application.Resources>
    <Style TargetType="TextBox">
        <EventSetter Event="GotKeyboardFocus" Handler="TextBox_GotKeyboardFocus"/>
    </Style>
</Application.Resources> 
```

在 App.xaml.cs 文件中：

```
private void TextBox_GotKeyboardFocus(Object sender, KeyboardFocusChangedEventArgs e)
{
    ((TextBox)sender).SelectAll();
} 
```

使用此代码，您可以访问`TextBox`应用程序中的所有内容。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2010-07-27T13:29:38.363

我发现这里提供的答案都没有模仿标准的 Windows 文本框。例如，尝试单击文本框最后一个字符和文本框右侧之间的空白区域。这里的大多数解决方案将始终选择整个内容，这使得将文本附加到文本框非常困难。

我在这里提出的答案在这方面表现得更好。这是一种行为（因此它需要[Blend SDK中的](http://www.microsoft.com/downloads/details.aspx?FamilyID=f1ae9a30-4928-411d-970b-e682ab179e17&displaylang=en)*System.Windows.Interactivity*程序集）。它也可以使用附加属性重写。

```
public sealed class SelectAllTextOnFocusBehavior : Behavior<TextBox>
{
    protected override void OnAttached()
    {
        base.OnAttached();
        AssociatedObject.PreviewMouseLeftButtonDown += AssociatedObject_PreviewMouseLeftButtonDown;
    }

    protected override void OnDetaching()
    {
        base.OnDetaching();
        AssociatedObject.PreviewMouseLeftButtonDown -= AssociatedObject_PreviewMouseLeftButtonDown;
    }

    void AssociatedObject_PreviewMouseLeftButtonDown(object sender, MouseButtonEventArgs e)
    {
        // Find the textbox
        DependencyObject parent = e.OriginalSource as UIElement;
        while (parent != null && !(parent is TextBox))
            parent = VisualTreeHelper.GetParent(parent);

        var textBox = parent as TextBox;
        Debug.Assert(textBox != null);

        if (textBox.IsFocused) return;

        textBox.SelectAll();
        Keyboard.Focus(textBox);
        e.Handled = true;
    }
} 
```

这是基于我在[这里](http://www.budnack.net/Lists/Posts/Post.aspx?ID=21)找到的代码。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2013-10-20T23:55:03.413

这个简单的实现非常适合我：

```
void TextBox_GotFocus(object sender, RoutedEventArgs e)
{
    ((TextBox) sender).SelectAll();
}

void TextBox_PreviewMouseDown(object sender, MouseButtonEventArgs e)
{
    var TextBox = (TextBox) sender;
    if (!TextBox.IsKeyboardFocusWithin)
    {
        TextBox.Focus();
        e.Handled = true;
    }
} 
```

要将其应用于 all `TextBox`，请将以下代码放在后面`InitializeComponent();`

```
EventManager.RegisterClassHandler(typeof(TextBox), TextBox.GotFocusEvent, new RoutedEventHandler(TextBox_GotFocus));
EventManager.RegisterClassHandler(typeof(TextBox), TextBox.PreviewMouseDownEvent, new MouseButtonEventHandler(TextBox_PreviewMouseDown)); 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2014-12-12T20:11:54.627

取自[这里](http://madprops.org/blog/wpf-textbox-selectall-on-focus/)：

在 App.xaml.cs 文件中注册全局事件处理程序：

```
protected override void OnStartup(StartupEventArgs e)
{
    EventManager.RegisterClassHandler(typeof(TextBox),TextBox.GotFocusEvent,
    new RoutedEventHandler(TextBox_GotFocus));

    base.OnStartup(e);
} 
```

然后处理程序很简单：

```
private void TextBox_GotFocus(object sender, RoutedEventArgs e)
{
    (sender as TextBox).SelectAll();
} 
```

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2017-02-17T02:32:26.863

我使用了 Nils 的答案，但转换为更灵活。

```
public enum SelectAllMode
{

    /// <summary>
    ///  On first focus, it selects all then leave off textbox and doesn't check again
    /// </summary>
    OnFirstFocusThenLeaveOff = 0,

    /// <summary>
    ///  On first focus, it selects all then never selects
    /// </summary>
    OnFirstFocusThenNever = 1,

    /// <summary>
    /// Selects all on every focus
    /// </summary>
    OnEveryFocus = 2,

    /// <summary>
    /// Never selects text (WPF's default attitude)
    /// </summary>
    Never = 4,
}

public partial class TextBox : DependencyObject
{
    public static readonly DependencyProperty SelectAllModeProperty = DependencyProperty.RegisterAttached(
        "SelectAllMode",
        typeof(SelectAllMode?),
        typeof(TextBox),
        new PropertyMetadata(SelectAllModePropertyChanged));

    private static void SelectAllModePropertyChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
    {
        if (d is System.Windows.Controls.TextBox)
        {
            var textBox = d as System.Windows.Controls.TextBox;

            if (e.NewValue != null)
            {
                textBox.GotKeyboardFocus += OnKeyboardFocusSelectText;
                textBox.PreviewMouseLeftButtonDown += OnMouseLeftButtonDown;
            }
            else
            {
                textBox.GotKeyboardFocus -= OnKeyboardFocusSelectText;
                textBox.PreviewMouseLeftButtonDown -= OnMouseLeftButtonDown;
            }
        }
    }

    private static void OnMouseLeftButtonDown(object sender, MouseButtonEventArgs e)
    {
        DependencyObject dependencyObject = GetParentFromVisualTree(e.OriginalSource);

        if (dependencyObject == null)
            return;

        var textBox = (System.Windows.Controls.TextBox)dependencyObject;
        if (!textBox.IsKeyboardFocusWithin)
        {
            textBox.Focus();
            e.Handled = true;
        }
    }

    private static DependencyObject GetParentFromVisualTree(object source)
    {
        DependencyObject parent = source as UIElement;
        while (parent != null && !(parent is System.Windows.Controls.TextBox))
        {
            parent = VisualTreeHelper.GetParent(parent);
        }

        return parent;
    }

    private static void OnKeyboardFocusSelectText(object sender, KeyboardFocusChangedEventArgs e)
    {
        var textBox = e.OriginalSource as System.Windows.Controls.TextBox;
        if (textBox == null) return;

        var selectAllMode = GetSelectAllMode(textBox);

        if (selectAllMode == SelectAllMode.Never)
        {
            textBox.SelectionStart = 0;
            textBox.SelectionLength = 0;
        }
        else
            textBox.SelectAll();

        if (selectAllMode == SelectAllMode.OnFirstFocusThenNever)
            SetSelectAllMode(textBox, SelectAllMode.Never);
        else if (selectAllMode == SelectAllMode.OnFirstFocusThenLeaveOff)
            SetSelectAllMode(textBox, null);
    }

    [AttachedPropertyBrowsableForChildrenAttribute(IncludeDescendants = false)]
    [AttachedPropertyBrowsableForType(typeof(System.Windows.Controls.TextBox))]
    public static SelectAllMode? GetSelectAllMode(DependencyObject @object)
    {
        return (SelectAllMode)@object.GetValue(SelectAllModeProperty);
    }

    public static void SetSelectAllMode(DependencyObject @object, SelectAllMode? value)
    {
        @object.SetValue(SelectAllModeProperty, value);
    }
} 
```

在 XAML 中，您可以使用以下之一：

```
<!-- On first focus, it selects all then leave off textbox and doesn't check again -->
<TextBox attprop:TextBox.SelectAllMode="OnFirstFocusThenLeaveOff" />

<!-- On first focus, it selects all then never selects -->
<TextBox attprop:TextBox.SelectAllMode="OnFirstFocusThenNever" />

<!-- Selects all on every focus -->
<TextBox attprop:TextBox.SelectAllMode="OnEveryFocus" />

<!-- Never selects text (WPF's default attitude) -->
<TextBox attprop:TextBox.SelectAllMode="Never" /> 
```

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2011-11-29T09:46:31.777

我对此有一个稍微简化的答案（仅包含`PreviewMouseLeftButtonDown`事件），它似乎模仿了浏览器的通常功能：

在 XAML 中，您有`TextBox`发言权：

```
<TextBox Text="http://www.blabla.com" BorderThickness="2" BorderBrush="Green" VerticalAlignment="Center" Height="25"
                 PreviewMouseLeftButtonDown="SelectAll" /> 
```

在代码隐藏中：

```
private void SelectAll(object sender, MouseButtonEventArgs e)
{
    TextBox tb = (sender as TextBox);

    if (tb == null)
    {
        return;
    }

    if (!tb.IsKeyboardFocusWithin)
    {
        tb.SelectAll();
        e.Handled = true;
        tb.Focus();
    }
} 
```

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2018-03-26T21:27:34.157

我意识到这已经很老了，但这是我的解决方案，它基于表达式/微软交互和交互名称空间。

首先，我按照[此链接](https://vspivak.wordpress.com/2011/01/19/using-system-windows-interactivity-behaviors-and-actions-in-wpfsilverlight-styles/)中的说明将交互触发器放入样式中。

然后归结为

```
<Style x:Key="baseTextBox" TargetType="TextBox">
  <Setter Property="gint:InteractivityItems.Template">
    <Setter.Value>
      <gint:InteractivityTemplate>
        <gint:InteractivityItems>
          <gint:InteractivityItems.Triggers>
            <i:EventTrigger EventName="GotKeyboardFocus">
              <ei:CallMethodAction MethodName="SelectAll"/>
            </i:EventTrigger>
            <i:EventTrigger EventName="PreviewMouseLeftButtonDown">
              <ei:CallMethodAction MethodName="TextBox_PreviewMouseLeftButtonDown"
                TargetObject="{Binding ElementName=HostElementName}"/>
            </i:EventTrigger>
          </gint:InteractivityItems.Triggers>
        </gint:InteractivityItems>
      </gint:InteractivityTemplate>
    </Setter.Value>
  </Setter>
</Style> 
```

还有这个

```
public void TextBox_PreviewMouseLeftButtonDown(object sender, MouseButtonEventArgs e)
{
  TextBox tb = e.Source as TextBox;
  if((tb != null) && (tb.IsKeyboardFocusWithin == false))
  {
    tb.Focus();
    e.Handled = true;
  }
} 
```

就我而言，我有一个用户控件，文本框在哪里有代码隐藏。代码隐藏具有处理函数。我在 XAML 中给了我的用户控件一个名称，并且我使用该名称作为元素。这对我来说非常有效。只需将样式应用于`TextBox`您希望在单击`TextBox`.

第一个在事件触发时`CallMethodAction`调用文本框的`SelectAll`方法。`GotKeyboardFocus``TextBox`

我希望这有帮助。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2018-01-22T15:48:28.777

这是@Nasenbaer 发布的[答案](https://stackoverflow.com/a/16178270/3936440)的C# 版本

```
private delegate void TextBoxSelectAllDelegate(object sender);

private void TextBoxSelectAll(object sender)
{
    (sender as System.Windows.Controls.TextBox).SelectAll();
}

private void MyTextBox_GotFocus(object sender, System.Windows.RoutedEventArgs e)
{
    TextBoxSelectAllDelegate d = TextBoxSelectAll;

    this.Dispatcher.BeginInvoke(d,
        System.Windows.Threading.DispatcherPriority.ApplicationIdle, sender);
} 
```

而`MyTextBox_GotFocus`是分配给 的`GotFocus`事件的事件处理程序`MyTextBox`。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-12-21T21:55:40.943

对于那些对 Donnelle/Groky 的方法感兴趣的人，但想要单击最后一个字符的右侧（但仍在 中`TextBox`）以将插入符号放在输入文本的末尾，我想出了这个解决方案：

```
int GetRoundedCharacterIndexFromPoint(TextBox textBox, Point clickedPoint)
{
    int position = textBox.GetCharacterIndexFromPoint(clickedPoint, true);

    // Check if the clicked point is actually closer to the next character
    // or if it exceeds the righmost character in the textbox
    // (in this case return increase the position by 1)
    Rect charLeftEdge = textBox.GetRectFromCharacterIndex(position, false);
    Rect charRightEdge = textBox.GetRectFromCharacterIndex(position, true);
    double charWidth = charRightEdge.X - charLeftEdge.X;
    if (clickedPoint.X + charWidth / 2 > charLeftEdge.X + charWidth) position++;

    return position;
}

void SelectivelyIgnoreMouseButton(object sender, MouseButtonEventArgs e)
{
    // Find the TextBox
    DependencyObject parent = e.OriginalSource as UIElement;
    while (parent != null && !(parent is TextBox))
        parent = VisualTreeHelper.GetParent(parent);

    if (parent != null)
    {
        var textBox = (TextBox)parent;
        if (!textBox.IsKeyboardFocusWithin)
        {
            // If the text box is not yet focused, give it the focus and
            // stop further processing of this click event.
            textBox.Focus();
            e.Handled = true;
        }
        else
        {
            int pos = GetRoundedCharacterIndexFromPoint(textBox, e.GetPosition(textBox));
            textBox.CaretIndex = pos;
        }
    }
}

void SelectAllText(object sender, RoutedEventArgs e)
{
    var textBox = e.OriginalSource as TextBox;
    if (textBox != null)
        textBox.SelectAll();
} 
```

该`GetRoundedCharacterIndexFromPoint`方法取自[这篇](https://stackoverflow.com/questions/4619484/how-do-i-convert-x-y-position-within-a-textbox-to-a-text-index)文章。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-01-28T17:11:07.853

```
#region TextBoxIDCard selection
private bool textBoxIDCardGotFocus = false;
private void TextBoxIDCard_GotFocus(object sender, RoutedEventArgs e)
{
    this.TextBoxIDCard.SelectAll();
}

private void TextBoxIDCard_LostFocus(object sender, RoutedEventArgs e)
{
    textBoxIDCardGotFocus = false;
}

private void TextBoxIDCard_PreviewMouseDown(object sender, MouseButtonEventArgs e)
{
    if (textBoxIDCardGotFocus == false)
    {
        e.Handled = true;
        this.TextBoxIDCard.Focus();
        textBoxIDCardGotFocus = true;
    }
} 
#endregion 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-03-14T00:23:34.147

尝试使用此扩展方法将所需的行为添加到任何 TextBox 控件。我还没有对它进行广泛的测试，但它似乎满足了我的需求。

```
public static class TextBoxExtensions
{
    public static void SetupSelectAllOnGotFocus(this TextBox source)
    {
        source.GotFocus += SelectAll;
        source.PreviewMouseLeftButtonDown += SelectivelyIgnoreMouseButton;
    }

    private static void SelectAll(object sender, RoutedEventArgs e)
    {
        var textBox = e.OriginalSource as TextBox;
        if (textBox != null)
            textBox.SelectAll();
    }

    private static void SelectivelyIgnoreMouseButton(object sender, MouseButtonEventArgs e)
    {
        var textBox = (sender as TextBox);
        if (textBox != null)
        {
            if (!textBox.IsKeyboardFocusWithin)
            {
                e.Handled = true;
                textBox.Focus();
            }
        }
    }
} 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2013-04-23T20:10:34.553

我有同样的问题。在 VB.Net 中，它的工作方式很简单：

**VB** XAML：

```
<TextBox x:Name="txtFilterFrequency" /> 
```

代码隐藏：

```
Private Sub txtFilterText_GotFocus(sender As System.Object, e As System.Windows.RoutedEventArgs) Handles txtFilterText.GotFocus
    Me.Dispatcher.BeginInvoke(Sub()
                                  txtFilterText.SelectAll()
                              End Sub, DispatcherPriority.ApplicationIdle, Nothing)
End Sub 
```

**C#**（感谢 ViRuSTriNiTy）

```
private delegate void TextBoxSelectAllDelegate(object sender);

private void TextBoxSelectAll(object sender)
{
    (sender as System.Windows.Controls.TextBox).SelectAll();
}

private void MyTextBox_GotFocus(object sender, System.Windows.RoutedEventArgs e)
{
    TextBoxSelectAllDelegate d = TextBoxSelectAll;

    this.Dispatcher.BeginInvoke(d,
        System.Windows.Threading.DispatcherPriority.ApplicationIdle, sender);
} 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2017-01-23T19:38:43.970

我搜索了很多解决方案，我找到了几个 selectall 的解决方案但是，问题是当我们在从文本框中选择部分文本后右键单击并进行剪切/复制时，即使我选择了部分文本，它也会选择全部。在这里解决这个问题是解决方案。只需在键盘选择事件中添加以下代码。这对我有用。

```
private static void SelectContentsChanged(DependencyObject d, DependencyPropertyChangedEventArgs e)
{
    if (d is TextBox)
    {
        TextBox textBox = d as TextBox;
        if ((e.NewValue as bool?).GetValueOrDefault(false))
        {
            textBox.GotKeyboardFocus += OnKeyboardFocusSelectText;                 
        }
        else
        {
            textBox.GotKeyboardFocus -= OnKeyboardFocusSelectText;

        }
    }
}

private static void OnKeyboardFocusSelectText(object sender, KeyboardFocusChangedEventArgs e)
{
    if (e.KeyboardDevice.IsKeyDown(Key.Tab))
        ((TextBox)sender).SelectAll();
} 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2017-06-02T00:30:47.513

经过谷歌搜索和测试，我找到了一个适合我的简单解决方案。

您需要将事件处理程序添加到`Loaded`容器窗口的事件中：

```
private void yourwindow_Loaded(object sender, RoutedEventArgs e)
{
    EventManager.RegisterClassHandler(typeof(TextBox),
        TextBox.PreviewMouseLeftButtonDownEvent,
        new RoutedEventHandler(SelectivelyIgnoreMouseButton));
} 
```

`RoutedEventHandler`接下来，您必须为前面代码中引用的处理程序创建处理程序：

```
private void SelectivelyIgnoreMouseButton(object sender, RoutedEventArgs e)
{
    TextBox tb = (sender as TextBox);
    if (tb != null)
    {
        if (!tb.IsKeyboardFocusWithin)
        {
            e.Handled = true;
            tb.Focus();
        }
    }
} 
```

现在，您可以将事件处理程序`SelectAll()`上的命令分别添加到任何控件：`GotFocus``TextBox`

```
private void myTextBox_GotFocus(object sender, RoutedEventArgs e)
{
    (sender as TextBox).SelectAll();
} 
```

您的文字现在被选中！

改编自[Dr. WPF 解决方案，MSDN 论坛](https://social.msdn.microsoft.com/Forums/vstudio/en-US/564b5731-af8a-49bf-b297-6d179615819f/how-to-selectall-in-textbox-when-textbox-gets-focus-by-mouse-click?forum=wpf)

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2017-09-12T05:13:04.160

这是迄今为止最简单的解决方案。

将全局处理程序添加到应用程序 (App.xaml.cs) 并完成。您将只需要几行代码。

```
protected override void OnStartup(StartupEventArgs e)
{
    EventManager.RegisterClassHandler(typeof(TextBox),
        TextBox.GotFocusEvent,
        new RoutedEventHandler(TextBox_GotFocus));

    base.OnStartup(e);
} 
```

因此，请使用 EventManager 类针对一个类型（TextBox）注册一个全局事件处理程序。实际的处理程序非常简单：

```
private void TextBox_GotFocus(object sender, RoutedEventArgs e)
{
    (sender as TextBox).SelectAll();
} 
```

在这里检查：[WPF TextBox SelectAll on Focus](http://madprops.org/blog/wpf-textbox-selectall-on-focus/)

希望能帮助到你。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2011-04-27T23:15:03.277

这似乎对我很有效。它基本上是对一些早期帖子的回顾。我只是将它放入构造函数中的 MainWindow.xaml.cs 文件中。我创建了两个处理程序，一个用于键盘，一个用于鼠标，并将两个事件集中到同一个函数中`HandleGotFocusEvent`，该函数在同一个文件中的构造函数之后定义。

```
public MainWindow()
{
   InitializeComponent();

   EventManager.RegisterClassHandler(typeof(TextBox), 
      UIElement.GotKeyboardFocusEvent,
      new RoutedEventHandler(HandleGotFocusEvent), true);
   EventManager.RegisterClassHandler(typeof(TextBox),
      UIElement.GotMouseCaptureEvent,
      new RoutedEventHandler(HandleGotFocusEvent), true);   
}
private void HandleGotFocusEvent(object sender, RoutedEventArgs e)
{
   if (sender is TextBox)
      (sender as TextBox).SelectAll();
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2012-11-29T11:14:19.457

覆盖 mouseDown 并在双击后全选的简单方法是：

```
public class DoubleClickTextBox: TextBox
{

    public override void EndInit()
    {
        base.EndInit();            
    }

    protected override void OnMouseEnter(System.Windows.Input.MouseEventArgs e)
    {
        base.OnMouseEnter(e);
        this.Cursor = Cursors.Arrow;
    }
    protected override void OnMouseDown(System.Windows.Input.MouseButtonEventArgs e)
    {

    }

    protected override void OnMouseDoubleClick(System.Windows.Input.MouseButtonEventArgs e)
    {
        base.OnMouseDown(e);
        this.SelectAll();
    }
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-01-30T19:57:21.587

尝试将其放入包含文本框的任何控件的构造函数中：

```
Loaded += (sender, e) =>
{
    MoveFocus(new TraversalRequest(FocusNavigationDirection.Next));
    myTextBox.SelectAll();
} 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2020-03-02T02:12:57.763

如果在鼠标抬起期间有一个事件取消选择文本`OnFocus`，我通常只是延迟全选。

```
private void TextBox_GotFocus(object sender, RoutedEventArgs e)
{
    if (TextBox.Text != null)
    {
        _ = Task.Run(() =>
        {
            Dispatcher.Invoke(
                async () => {
                    await Task.Delay(100);
                    TextBox.SelectAll();
                }
            );
        });
    }
} 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2020-09-14T00:27:31.090

最简单和完美的解决方案是在文本框获得焦点后使用计时器选择所有文本 20 毫秒：

`Dim WithEvents Timer As New DispatcherTimer()`

设置间隔： `Timer.Interval = TimeSpan.FromMilliseconds(20)`

响应事件（我在这里继承了 TextBox 控件，所以我覆盖了它的事件：

```
Protected Overrides Sub OnGotFocus(e As RoutedEventArgs)
        Timer.Start()
        MyBase.OnGotFocus(e)
    End Sub

    Private Sub Timer_Tick(sender As Object, e As EventArgs) Handles Timer.Tick
        Timer.Stop()
        Me.SelectAll()
    End Sub 
```

仅此而已！

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2021-03-09T22:41:05.403

我用这个代码

```
 private void txtNav_GotFocus(object sender, RoutedEventArgs e)
            {
                e.Handled = true;
                var c = new DispatcherTimer();
                c.Interval = TimeSpan.FromMilliseconds(100);
                c.Tick += (a1, a2) =>
                {
                    c.IsEnabled = false;
                    txtNav.SelectAll();
                };
                c.IsEnabled = true;

            } 
```

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2010-07-28T09:41:38.607

我已经测试了所有这些，但只有以下结果：

```
protected override void OnStartup(StartupEventArgs e) 
{
    EventManager.RegisterClassHandler(typeof(TextBox), UIElement.PreviewMouseLeftButtonDownEvent,
   new MouseButtonEventHandler(SelectivelyHandleMouseButton), true);
    EventManager.RegisterClassHandler(typeof(TextBox), UIElement.GotKeyboardFocusEvent,
      new RoutedEventHandler(SelectAllText), true);
    EventManager.RegisterClassHandler(typeof(TextBox), UIElement.GotFocusEvent,
      new RoutedEventHandler(GotFocus), true);          
}

private static void SelectivelyHandleMouseButton(object sender, MouseButtonEventArgs e)
{
    var textbox = (sender as TextBox);
    if (textbox != null)
    {
        int hc = textbox.GetHashCode();
        if (hc == LastHashCode)
        {
            if (e.OriginalSource.GetType().Name == "TextBoxView")
            {
                e.Handled = true;
                textbox.Focus();
                LastHashCode = -1;
            }
        }
    }
    if (textbox != null) textbox.Focus();
}

private static void SelectAllText(object sender, RoutedEventArgs e)
{
    var textBox = e.OriginalSource as TextBox;
    if (textBox != null)
        textBox.SelectAll();
}

private static int LastHashCode;
private static void GotFocus(object sender, RoutedEventArgs e)
{
    var textBox = e.OriginalSource as TextBox;
    if (textBox != null)
        LastHashCode = textBox.GetHashCode();
} 
```

* * *

## 回答 #32

> 赞同：-1
> 
> 时间：2014-12-30T19:44:02.020

哇！看完以上所有内容后，我发现自己不知所措和困惑。我接受了我认为我在这篇文章中学到的东西，并尝试了一些完全不同的东西。要在`TexTbox`获得焦点时选择文本，我使用以下命令：

```
private void TextField_GotFocus(object sender, RoutedEventArgs e)
{
    TextBox tb = (sender as Textbox);
    if(tb != null)
    {
        e.Handled = true;
        tb.Focus();
        tb.SelectAll();
    }
} 
```

将 的`GotFocus`属性设置`TexTbox`为此方法。

运行应用程序并单击一次`TexTbox`突出显示`TexTbox`.

如果确实，目标是在用户单击 时选择文本`TexTbox`，这似乎很简单，并且涉及的代码要少得多。只是说...

* * *

## 回答 #33

> 赞同：-1
> 
> 时间：2021-12-25T21:00:55.640

对我来说，在文本框上单击鼠标后效果很好：

```
private void TextBox_GotFocus(object sender, RoutedEventArgs e)
{
    Dispatcher.BeginInvoke(() => ((TextBox)sender).SelectAll());
    e.Handled = true;
} 
```

# macros - 你能在 Emacs Lisp 宏中创建交互式函数吗？

> ID：660555
> 
> 赞同：9
> 
> 时间：2009-03-18T23:55:13.627
> 
> 标签：macros, elisp

我正在尝试在 emacs lisp 中编写一个宏来创建一些“辅助函数”。</p>

最终，我的辅助函数将比我这里的更有用。我意识到可能有更好/更直观的方法来完成同样的事情（请发布），但我的基本问题是为什么这不起作用/我做错了什么：

```
(defmacro deftext (functionname texttoinsert)
  `(defun ,(make-symbol (concatenate 'string "text-" functionname)) ()
     (interactive)
     (insert-string ,texttoinsert)))

(deftext "swallow" "What is the flight speed velocity of a laden swallow?")
(deftext "ni" "What is the flight speed velocity of a laden swallow?") 
```

如果我获取宏扩展的输出并对其进行评估，我将获得我打算通过宏获得的交互式函数，但即使宏运行并且似乎正在评估，我也无法调用`M-x text-ni`or `text-swallow`。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-19T04:11:50.623

这可以满足您的要求：

```
(defmacro deftext (functionname texttoinsert)
  (let ((funsymbol (intern (concat "text-" functionname))))
`(defun ,funsymbol () (interactive) (insert-string ,texttoinsert)))) 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2014-01-28T02:51:19.717

正如已经指出的那样，解决方案是使用`intern`而不是`make-symbol`.

可以创建多个具有相同名称的独立符号，但其中只有一个可以是给定名称的*规范*符号 - 即当您在其他地方引用它时将获得的符号。

`intern`返回给定名称的规范符号。*仅*当该名称的内部符号不存在时，它才会创建一个新符号。这意味着它只会为任何给定名称¹创建一个符号。

`make-symbol`另一方面，每次调用它时都会创建一个新符号。这些是非*驻留*符号——每一个都是完全有效和功能性的符号，但*不是*当您通过名称引用符号时会看到的符号。

看：`C-h``i``g` `(elisp) Creating Symbols` `RET`

因为`defun`返回它设置的符号，所以您可以通过捕获返回值并将其用作函数来观察发生了什么：

```
(defalias 'foo (deftext "ni" "What is the flight speed velocity of a laden swallow?"))
M-x text-ni ;; doesn't work
M-x foo ;; works 
```

或类似地：

```
(call-interactively (deftext "shrubbery" "It is a good shrubbery. I like the laurels particularly.")) 
```

所有这一切的棘手部分 - 以及评估扩展形式的原因是你想要的，但宏没有 - 与lisp 阅读器如何以及*何时*（或者实际上*是否*）翻译名称有关函数转换为符号。

如果我们写一个函数 foo1：

```
(defun foo1 (texttoinsert) (insert-string texttoinsert)) 
```

lisp 阅读器将其作为文本读取，并将其转换为 lisp 对象。我们可以用`read-from-string`它来做同样的事情，我们可以查看生成的 lisp 对象的打印表示：

```
ELISP> (car (read-from-string "(defun foo1 (texttoinsert) (insert-string texttoinsert))"))
(defun foo1
    (texttoinsert)
  (insert-string texttoinsert)) 
```

在该对象中，函数名称是名称为“foo1”的规范符号。但是请注意，我们从中看到的返回值`read-from-string`只是该对象的*打印表示*，而规范符号仅由其名称表示。印刷的表示不能让我们区分内部和非内部符号，因为所有符号都仅由它们的名称表示。

（暂时跳过，这是评估宏的*打印*扩展时问题的根源，因为该打印形式通过 lisp 阅读器传递，并且曾经是非驻留符号的内容变成了驻留符号。）

如果我们然后转到宏：

```
(defmacro deffoo2 ()
  `(defun foo2 (texttoinsert) (insert-string texttoinsert)))

ELISP> (car (read-from-string "(defmacro deffoo2 ()
        `(defun foo2 (texttoinsert) (insert-string texttoinsert)))"))
(defmacro deffoo2 nil
  `(defun foo2
       (texttoinsert)
     (insert-string texttoinsert))) 
```

这一次，读者已经将*宏*定义读入了一个 lisp 对象，并且在该对象中是规范符号`foo2`。我们可以通过直接检查对象来验证这一点：

```
ELISP> (eq 'foo2
           (cadr (cadr (nth 3
            (car (read-from-string "(defmacro deffoo2 ()
             `(defun foo2 () (insert-string texttoinsert)))"))))))
t 
```

所以对于这个宏，它在任何宏调用/扩展发生`foo2` *之前*就已经在处理那个规范符号，因为 lisp 阅读器在阅读宏本身时确定了这一点。与我们之前的简单函数定义（其中函数符号由 lisp 阅读器在定义函数时确定）不同，当调用和扩展宏时，*不会*使用 lisp 阅读器。宏扩展是使用预先存在的 lisp 对象执行的——不需要读取。

在这个例子中，函数符号已经存在于宏中，因为它是我们可以`(foo2)`在代码的其他地方使用的规范符号来调用该函数。（或者，如果我使定义交互，使用`M-x foo2`。）

最后回到问题的原始宏，很明显lisp*阅读器*永远不会遇到它将定义的函数的函数名称符号：

```
ELISP> (car (read-from-string "(defmacro deftext (functionname texttoinsert)
        `(defun ,(make-symbol (concatenate 'string \"text-\" functionname)) ()
           (interactive)
           (insert-string ,texttoinsert)))"))
(defmacro deftext
    (functionname texttoinsert)
  `(defun ,(make-symbol
            (concatenate 'string "text-" functionname))
       nil
     (interactive)
     (insert-string ,texttoinsert))) 
```

相反，由 lisp 阅读器生成的对象包含表达式`,(make-symbol (concatenate 'string "text-" functionname))`; 并且该反引号表达式将在扩展时进行评估，以创建一个新的*uninterned*符号，该符号将成为该扩展创建的对象的一部分。

在我们之前的示例中，生成的对象有一个 car `defun`（interned）和一个 cadr of `foo1`or `foo2`（两者都被 interned）。

在最后一个示例中，对象有一个`defun`(interned) 的 car，但有一个*uninterned*符号的 cadr（名称由`concatenate`表达式产生）。

最后，如果您*打印*该对象，则该非实习函数符号的打印表示将是符号名称，并且通过评估它来*读取*该打印表示将导致定义*规范*符号的函数单元格。

¹其实这个`unintern`函数可以用来unintern一个符号，之后调用`intern`同名自然*会*创建一个新符号；但这对于本次讨论并不重要。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-01-28T00:00:53.157

FWIW，如果您使用`lexical-binding`，则不需要使用宏：

```
(defun deftext (functionname texttoinsert)
  (defalias (intern (concat "text-" functionname))
    (lambda ()
      (interactive)
      (insert-string texttoinsert)))) 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T00:18:43.803

已经好几年了，但我认为您可能缺少`fset`定义函数的方法；如果您也想要编译时间，请参阅[文档。](http://www.gnu.org/software/emacs/elisp/html_node/Eval-During-Compile.html#Eval-During-Compile)

# networking - 可以设置某种自定义家庭 DNS 来重新路由 URL？

> ID：660562
> 
> 赞同：1
> 
> 时间：2009-03-19T00:01:30.147
> 
> 标签：networking, dns

基本上，我现在在家用 PC 上运行的是这些 WAMP in a box 应用程序之一，因此我可以编写 PHP 代码并使用 MySQL 数据库。没关系，但是我运行了很多网站，所以现在我有一个名为 /~WEBSITES/ 的文件夹，我将所有内容都放在了这些[http://localhost/~WEBSITES/domain.com/](http://localhost/~WEBSITES/domain.com/)的 URL 中——我想要的是能够在我的地址栏中键入[http://local.domain.com/](http://local.domain.com/)并让它指向我的本地驱动器，但我不希望每个人都这样，只有我自己。

可能的？

注意：我运行的是 Windows XP

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T00:06:43.877

修改 C:\Windows\system32\drivers\etc\ 中名为“hosts”的文本文件

假设您想将 www.mycustomer.com 指向您的本地主机。加入：

127.0.0.1 www.mycustomer.com

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T00:14:09.837

您需要[在 apache 中设置虚拟主机](http://www.dennisplucinik.com/blog/2007/08/16/setting-up-multiple-virtual-hosts-in-wamp/)（不是 IIS...哎呀），并将其与 HardCode 的答案结合起来。那应该做你需要的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T00:18:21.493

您需要[使用 Apache 设置虚拟主机](http://apptools.com/phptools/virtualhost.php)，并将其与 HardCode 的答案（设置您的主机文件）结合起来。那应该做你需要的。

**作者编辑：** 很棒的文章，这里是关于做什么的快速说明（至少使用最新版本的 apache2triad 作为您的 WAMP 安装程序）

添加到 C:\APACHE_INSTALL_DIRECTORY\conf\httpd.conf：

```
NameVirtualHost 127.0.0.1
<VirtualHost 127.0.0.1>
    DocumentRoot "C:\apache2triad\htdocs"
    ServerName localhost
</VirtualHost>
<VirtualHost 127.0.0.1>
    DocumentRoot "C:\apache2triad\htdocs\~WEBSITES\Domain1.com"
    ServerName local.domain1.com
</VirtualHost>
<VirtualHost 127.0.0.1>
    DocumentRoot "C:\apache2triad\htdocs\~WEBSITES\Domain2.com"
    ServerName local.domain2.com
</VirtualHost> 
```

添加到 C:\Windows\system32\drivers\etc\hosts

```
127.0.0.1   localhost
127.0.0.1   local.domain1.com
127.0.0.1   local.domain2.com 
```

# c# - 如果在覆盖 Equals() 时未能覆盖 GetHashCode()，会出现什么问题？

> ID：660566
> 
> 赞同：18
> 
> 时间：2009-03-19T00:03:18.613
> 
> 标签：c#, .net

> **可能重复：**
> [为什么在重写 Equals 方法时重写 GetHashCode 很重要？](https://stackoverflow.com/questions/371328/why-is-it-important-to-override-gethashcode-when-equals-method-is-overridden)

在 C# 中，如果在覆盖 Equals() 时未能覆盖 GetHashCode()，具体会出现什么问题？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-19T00:08:47.167

最明显的方式是映射结构。

当用作 Dictionary 或 HashTable 的 Key 时，任何这样做的类都会有不可预知的行为。原因是该实现同时使用 GetHashCode 和 Equals 在表中正确查找值。该算法的简短版本如下

1.  将 HashCode 的模数乘以桶的数量，这就是桶的索引
2.  为指定的 Key 和特定存储桶中的每个 Key 调用 .Equals()。
3.  如果有匹配的值，则没有匹配 = 没有值。

未能使 GetHashCode 和 Equals 保持同步将完全破坏该算法（以及许多其他算法）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T00:12:00.510

将哈希/字典结构视为编号桶的集合。如果你总是把东西放在它们的GetHashCode()对应的桶里，那么你只需要搜索一个桶（使用Equals()）来看看有没有东西。如果您正在寻找正确的存储桶，这将有效。

所以规则是：如果 Equals() 说两个对象是 Equal()，它们*必须*有相同的 GetHashCode()。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T00:10:03.620

如果你不覆盖`GetHashCode`，任何比较你的对象的东西都可能出错。

据记载，`GetHashCode`如果两个实例相等，则必须返回相同的值，那么任何希望测试它们是否相等的代码都有权将其`GetHashCode`用作可能相等的组对象的第一遍（因为它知道对象不同的哈希码不能相等）。如果您的`GetHashCode`方法为相同的对象返回不同的值，那么它们可能会在第一遍中进入不同的组，并且永远不会使用它们的`Equals`方法进行比较。

这可能会影响任何集合类型的数据结构，但在基于哈希码的数据结构（如字典和哈希集）中尤其成问题。

简而言之：`GetHashCode`当你覆盖时总是覆盖`Equals`，并确保它们的实现是一致的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T00:10:21.780

任何使用密钥的算法都将无法工作，假设它依赖于哈希密钥的预期行为。

`Equal`应该具有相同哈希键值的两个对象，默认实现不远程保证。

# jquery - 您将如何动态订购 使用 JQuery 列出？

> ID：660572
> 
> 赞同：1
> 
> 时间：2009-03-19T00:05:51.713
> 
> 标签：jquery

如果我有一个下拉列表和一个列表框，有没有办法使用 JQuery 根据下拉列表对列表框进行排序？一个例子会很有帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T00:12:30.977

这会改变下拉的顺序。您必须根据自己的标准设置订单：

```
<select id="the-select">
    <option value="1">First option</option>
    <option value="2">Second option</option>
</select>

<script type="text/javascript">
//<![CDATA[
    $(function (){
        $("#the-select option[value=2]").insertBefore("#the-select option[value=1]");
    });
//]]>
</script> 
```

# php - 谷歌地图不再工作了

> ID：660579
> 
> 赞同：2
> 
> 时间：2009-03-19T00:07:21.957
> 
> 标签：php, google-maps

两天前，我正在做一个涉及谷歌地图的项目。该网站在页面上显示的地图很好。

现在，我回到我的工作站，什么都没有改变，期待谷歌地图不会再出现的事实。代码是相同的，自从我离开后没有人碰过我的机器，我检查了 html，一切都很完美，但仍然无法正常工作...... Javascript 控制台没有给出任何错误，并且代码与备份相同我每次收工都做。2天前还可以，今天不行。

我什至复制了源代码，将其放入 html 文件并尝试过，但结果相同。我在这里不知所措。这是我的代码：

```
<script type="text/javascript">
      //<![CDATA[
      var map;
      var directionsPanel;
      var directions;

      function initialize() {
        if (GBrowserIsCompatible()) {
         map = new GMap2(document.getElementById("map"));
         map.addControl(new GLargeMapControl());
         map.addControl(new GScaleControl());
         map.addControl(new GMapTypeControl());

         //the route description
         directionsPanel = document.getElementById("route");
         directions = new GDirections(map, directionsPanel);
         directions.load({COMMAND});
        }
      }
      //]]>
    </script> 
```

{COMMAND} 是 PHP 模板将解析的东西，我已经检查过了，格式是 100% 正确的，就像我已经说过的那样，现在的代码与备份相同，如果它当时可以工作，它现在应该可以工作.

谷歌是否在一夜之间更新了他们的 API 并且我在这里使用的功能被弃用了？我不知道这里发生了什么...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-25T21:10:24.920

好的，您没有发布所有代码，所以我不得不做出一些假设。

我认为您在加载页面时看到的是带有 Google 徽标、缩放控件和地图类型选择器的灰色框，或者是顶部截断 Google 徽标的大部分白色页面。

如果您看到带有截止 Google 徽标的大部分白色页面，请确保指定应该包含地图的 DIV 的大小。

如果您看到只有控件的灰色框（这是我的猜测），您必须在创建地图时指定一个中心点。像这样：

```
if (GBrowserIsCompatible()) {
     map = new GMap2(document.getElementById("map"));
     map.setCenter(new GLatLng(LAT,LONG), ZOOM);
     ... 
```

我认为这将解决您的问题。我不知道它会如何工作一分钟而不是下一分钟，必须改变一些东西，API 没有（谢天谢地）。此错误不会在 Javascript 错误控制台中添加任何内容。我希望这有帮助！！！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T00:16:06.150

我建议使用像[Charles](http://www.charlesproxy.com/)这样的 HTTP 嗅探代理（收费，免费试用）。我相信 Firefox 可能会有类似的应用程序，但我喜欢 Charles。它显示您的浏览器发出的每个请求，以及从服务器返回的响应。然后你可以仔细查看它，看看是否有什么看起来不正常或有趣的地方，也许会让你更接近解决问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T03:03:42.923

Fiddler 是一个很棒的 HTTP 代理工具，而且它是免费的。它应该可以帮助您确定问题。

[http://www.fiddler2.com/fiddler2/](http://www.fiddler2.com/fiddler2/)

您可能需要考虑锁定您的代码以使用特定版本的 google maps api（例如[http://maps.google.com/maps?file=api&v=2.106&...。](http://maps.google.com/maps?file=api&v=2.106&...)）以避免更新到的任何问题如果它是关键任务，maps API 可能会破坏您的代码。

# java - 更改 BufferedImage 的 alpha 值？

> ID：660580
> 
> 赞同：8
> 
> 时间：2009-03-19T00:07:45.450
> 
> 标签：java, graphics, bufferedimage

如何在 Java 中更改 BufferedImage 的全局 alpha 值？（IE 使图像中 alpha 值为 100 的每个像素的 alpha 值为 80）

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-17T21:28:57.570

@Neil Coffey：谢谢，我也在找这个；但是，您的代码对我来说效果不佳（白色背景变为黑色）。

我编写了这样的代码，并且效果很好：

```
public void setAlpha(byte alpha) {       
    alpha %= 0xff; 
    for (int cx=0;cx<obj_img.getWidth();cx++) {          
        for (int cy=0;cy<obj_img.getHeight();cy++) {
            int color = obj_img.getRGB(cx, cy);

            int mc = (alpha << 24) | 0x00ffffff;
            int newcolor = color & mc;
            obj_img.setRGB(cx, cy, newcolor);            

        }

    }
} 
```

其中 obj_img 是 BufferedImage.TYPE_INT_ARGB。

我用 setAlpha((byte)125); alpha 范围现在是 0-255。

希望有人觉得这很有用。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T00:38:36.860

我不相信有一个简单的命令可以做到这一点。几个选项：

*   复制到另一个指定了[AlphaComposite](http://java.sun.com/javase/6/docs/api/java/awt/AlphaComposite.html)的图像中（缺点：未就地转换）
*   直接操作[光栅](http://java.sun.com/javase/6/docs/api/java/awt/image/WritableRaster.html)（缺点：可能导致[不受管理的图像](http://javagraphics.blogspot.com/2007/04/managed-images.html)）
*   使用过滤器或[BufferedImageOp](http://java.sun.com/javase/6/docs/api/java/awt/image/BufferedImageOp.html)

第一个是最容易实现的，IMO。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-04-11T15:14:54.587

这是一个老问题，所以我不是为了OP而回答，而是为了像我这样后来发现这个问题的人。

## 阿尔法复合材料

正如@Michael 出色的大纲所述，AlphaComposite 操作可以修改 Alpha 通道。但仅在某些方面，对我来说有些难以理解：

![在此处输入图像描述](https://i.stack.imgur.com/VmUtr.png)

是“over”操作如何影响 Alpha 通道[的公式](http://en.wikipedia.org/wiki/Alpha_compositing)。此外，这也会影响 RGB 通道，因此如果您有需要更改的颜色数据，AlphaComposite 不是答案。

## 缓冲图像操作

### 查找操作

BufferedImageOp 有多种变体（请参见[此处的 4.10.6](http://docstore.mik.ua/orelly/java-ent/jfc/ch04_10.htm)）。在更一般的情况下，OP 的任务可以通过[LookupOp](http://docs.oracle.com/javase/1.4.2/docs/api/java/awt/image/LookupOp.html)来满足，这需要构建查找数组。要仅修改 Alpha 通道，请为 RGB 通道提供一个标识数组（其中 table[i] = i 的数组），并为 Alpha 通道提供一个单独的数组。用 填充后一个数组`table[i] = f(i)`，其中`f()`是您想要从旧 alpha 值映射到新值的函数。例如，如果您想“使图像中 alpha 值为 100 的每个像素的 alpha 值为 80”，请设置`table[100] = 80`. （完整范围为 0 到 255。）请参阅[如何增加](https://stackoverflow.com/questions/10088237/how-to-increase-opacity-in-gaussian-blur)代码示例的高斯模糊不透明度。

### 重新缩放操作

但是对于这些情况的一个子集，有一种更简单的方法可以做到这一点，它不需要设置查找表。如果`f()`是一个简单的线性函数，请使用[RescaleOp](http://docs.oracle.com/javase/1.4.2/docs/api/java/awt/image/RescaleOp.html)。例如，如果要设置`newAlpha = oldAlpha - 20`，请使用比例因子为 1 且偏移量为 -20 的 RescaleOp。如果要设置`newAlpha = oldAlpha * 0.8`，请使用 0.8 的 scaleFactor 和 0 的偏移量。在任何一种情况下，您都必须再次为 RGB 通道提供虚拟的 scaleFactors 和偏移量：

```
new RescaleOp({1.0f, 1.0f, 1.0f, /* alpha scaleFactor */ 0.8f},
              {0f, 0f, 0f, /* alpha offset */ -20f}, null) 
```

再次参见[此处的 4.10.6](http://docstore.mik.ua/orelly/java-ent/jfc/ch04_10.htm)中的一些示例，这些示例很好地说明了原理，但并不特定于 Alpha 通道。

[RescaleOp](http://docs.oracle.com/javase/1.4.2/docs/api/java/awt/image/RescaleOp.html)和[LookupOp](http://docs.oracle.com/javase/1.4.2/docs/api/java/awt/image/LookupOp.html)都允许就地修改 BufferedImage。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2014-05-07T08:13:18.820

为了获得更好看的 alpha 变化效果，您可以使用每个像素的相对 alpha 变化（而不是静态设置或线性裁剪）

```
public static void modAlpha(BufferedImage modMe, double modAmount) {
        //
    for (int x = 0; x < modMe.getWidth(); x++) {          
        for (int y = 0; y < modMe.getHeight(); y++) {
                //
            int argb = modMe.getRGB(x, y); //always returns TYPE_INT_ARGB
            int alpha = (argb >> 24) & 0xff;  //isolate alpha

            alpha *= modAmount; //similar distortion to tape saturation (has scrunching effect, eliminates clipping)
            alpha &= 0xff;      //keeps alpha in 0-255 range

            argb &= 0x00ffffff; //remove old alpha info
            argb |= (alpha << 24);  //add new alpha info
            modMe.setRGB(x, y, argb);            
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T00:32:53.957

我 99% 确信声称处理打包到 int 中的“RGB”值的方法实际上处理的是 ARGB。因此，您应该能够执行以下操作：

```
for (all x,y values of image) {
  int argb = img.getRGB(x, y);
  int oldAlpha = (argb >>> 24);
  if (oldAlpha == 100) {
    argb = (80 << 24) | (argb & 0xffffff);
    img.setRGB(x, y, argb);
  }
} 
```

为了速度，您可以使用这些方法来检索像素值块。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-03-18T18:45:33.117

您可能需要先将 BufferedImage 复制到类型为 的图像`BufferedImage.TYPE_INT_ARGB`。如果您的图像类型为`BufferedImage.TYPE_INT_RGB`，则 alpha 组件将无法正确设置。如果您的 BufferedImage 是 type `BufferedImage.TYPE_INT_ARGB`，则下面的代码有效。 `/** * Modifies each pixel of the BufferedImage so that the selected component (R, G, B, or A) * is adjusted by delta. Note: the BufferedImage must be of type BufferedImage.TYPE_INT_ARGB. * @param src BufferedImage of type BufferedImage.TYPE_INT_ARGB. * @param colorIndex 0=red, 1=green, 2=blue, 3= alpha * @param delta amount to change component * @return */ public static BufferedImage adjustAColor(BufferedImage src,int colorIndex, int delta) { int w = src.getWidth(); int h = src.getHeight(); assert(src.getType()==BufferedImage.TYPE_INT_ARGB); for (int y = 0; y < h; y++) for (int x = 0; x < w; x++) { int rgb = src.getRGB(x,y); java.awt.Color color= new java.awt.Color(rgb,true); int red=color.getRed(); int green=color.getGreen(); int blue=color.getBlue(); int alpha=color.getAlpha(); switch (colorIndex) { case 0: red=adjustColor(red,delta); break; case 1: green=adjustColor(green,delta); break; case 2: blue=adjustColor(blue,delta); break; case 3: alpha=adjustColor(alpha,delta); break; default: throw new IllegalStateException(); } java.awt.Color adjustedColor=new java.awt.Color(red,green,blue,alpha); src.setRGB(x,y,adjustedColor.getRGB()); int gottenColorInt=src.getRGB(x,y); java.awt.Color gottenColor=new java.awt.Color(gottenColorInt,true); assert(gottenColor.getRed()== red); assert(gottenColor.getGreen()== green); assert(gottenColor.getBlue()== blue); assert(gottenColor.getAlpha()== alpha); } return src; } private static int adjustColor(int value255, int delta) { value255+= delta; if (value255<0) { value255=0; } else if (value255>255) { value255=255; } return value255; }`

# c# - C# 数组移动项（不是 ArrayList/通用列表）

> ID：660585
> 
> 赞同：3
> 
> 时间：2009-03-19T00:09:40.657
> 
> 标签：c#, arrays

有一个对象，它是一个数组（不是数组列表或泛型），可以容纳一组任何东西......

```
[[One],[Two],[Three],[Four]] 
```

想要将 [Four] 移动到 [Two] 的前面，例如 oldIndex = 3, newIndex = 1 所以结果将是......

```
[[One],[Four][Two],[Three]] 
```

在 .NET 2.0 中执行此操作的最有效方法是什么，例如

```
PropertyInfo oPI = ObjectType.GetProperty("MyArray", BindingFlags.Public | BindingFlags.Instance);
object ObjectToReorder = oPI.GetValue(ParentObject, null);
Array arr = ObjectToReorder as Array;
int oldIndex = 3;
int newIndex = 1;
//Need the re-ordered list still attached to the ParentObject 
```

提前致谢

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-20T21:47:46.247

```
void MoveWithinArray(Array array, int source, int dest)
{
  Object temp = array.GetValue(source);
  Array.Copy(array, dest, array, dest + 1, source - dest);
  array.SetValue(temp, dest);
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T00:13:51.990

试试这个

```
Array someArray = GetTheArray();
object temp = someArray.GetValue(3);
someArray.SetValue(someArray.GetValue(1), 3);
someArray.SetValue(temp, 1); 
```

# asp.net - 如何跟踪 IIS 服务器性能

> ID：660589
> 
> 赞同：17
> 
> 时间：2009-03-19T00:10:36.317
> 
> 标签：asp.net, performance, iis

我有一个反复出现的问题，客户打电话抱怨网站太慢。具体来说，如果他们在短时间内处于非活动状态，然后返回站点，则在用户看到响应之前会有一两分钟的延迟。（在这种情况下，标准浏览器是 Firefox）

我已经启动并运行了 Perfmon，cpu 利用率通常低于 20%（单进程......不要问）。数据库正在嗡嗡作响。我正在拔头发。

那么，在评估 IIS 性能时，您发现哪些指标/工具有用？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-03-19T00:44:31.917

希望这会有所帮助： 加速网站扩展的
[最佳实践](http://developer.yahoo.com/performance/rules.html)
[ASP.NET 应用程序的扩展策略](http://msdn.microsoft.com/en-us/magazine/cc500561.aspx)
[IIS 调优](http://forums.iis.net/p/1148571/1866074.aspx)
[加快网站加载速度的 14 条规则](http://stevesouders.com/hpws/rules.php)
[在 IIS 6.0 中创建网站的最佳实践](http://msmvps.com/blogs/omar/archive/2008/10/04/best-practices-for-creating-websites-in-iis-6-0.aspx)
[斯坦福计算机科学 - 高性能网站](http://cs193h.stevesouders.com/)
[10 条写作技巧-Performance Web Applications](http://msdn.microsoft.com/en-us/magazine/cc163854.aspx)
[编写高性能托管应用程序：入门](http://msdn.microsoft.com/en-us/library/ms973858.aspx)
[健康“生产中”ASP.NET 应用程序的九个技巧](http://blogs.msdn.com/dougste/archive/2006/04/05/568671.aspx)
[快速 C#，第 2 部分：优化内存分配 - 池化和重用对象](http://geekswithblogs.net/robp/archive/2008/08/07/speedy-c-part-2-optimizing-memory-allocations---pooling-and.aspx)
[内存使用审计 .NET 应用程序](http://msdn.microsoft.com/en-us/magazine/dd882521.aspx)
[HTTP 压缩故障排除在 IIS 6.0 中最大化 IIS 性能 -](http://blogs.iis.net/webtopics/archive/2009/02/24/troubleshooting-http-compression-in-iis-6-0.aspx)[优化 IIS 6.0 性能的](http://technet.microsoft.com/en-us/library/cc728451(WS.10).aspx)
[25 个技巧](http://technet.microsoft.com/en-us/library/bb742459.aspx)

[Page Speed - Web 应用程序的开源 Firefox/Firebug 附加](http://code.google.com/speed/page-speed/)
[性能测试指南](http://www.guidanceshare.com/wiki/Performance_Testing_Guidance_for_Web_Applications)
[IIS 7.0 中的 10 大性能改进](http://technet.microsoft.com/en-us/magazine/2008.09.iis.aspx)
[第 6 章优化 IIS 6.0 性能](http://www.microsoft.com/downloads/details.aspx?FamilyID=80A1B6E6-829E-49B7-8C02-333D9C148E69&displaylang=en)
[Windows Server 2003 的性能调整指南 - IIS 6.0 的性能调整](http://www.microsoft.com/windowsserver2003/evaluation/performance/tuning.mspx)
[ASP.NET 性能提示](http://aspalliance.com/1533_ASPNET_Performance_Tips.7)
[IIS 6.0 性能调整 - Peter A. Bromberg 博士](http://www.eggheadcafe.com/articles/20050613.asp)
[提高 .NET 应用程序性能和可扩展性 - 通过 MS](http://www.microsoft.com/downloads/details.aspx?FamilyId=8A2E454D-F30E-4E72-B531-75384A0F1C47&displaylang=en)
[优化和性能调整 IIS 6.0](http://www.informit.com/articles/article.aspx?p=335881)
[使用 Visual Round Trip Analyzer 线程加快网页速度的 12 个步骤](http://msdn.microsoft.com/en-us/magazine/dd188562.aspx)
[：IIS 6 性能调整指南（草案）](http://forums.iis.net/t/1148571.aspx)
[应用程序池 IIS6 和 IIS7 的 CPU 设置](http://www.iis.net/ConfigReference/system.applicationHost/applicationPools/add/cpu)

重大改进提示：在 STA Threads [Scale Net](http://download.microsoft.com/download/a/7/e/a7ea6fd9-2f56-439e-a8de-024c968f26d1/ScaleNet.pdf)
[上运行 ASMX Web 服务](http://msdn.microsoft.com/en-us/magazine/cc163544.aspx)

测量、测量、测量：
对您的站点进行负载测试
[显示慢速](http://www.showslow.com/)
[性能监视器向导](http://www.microsoft.com/download/en/details.aspx?id=24832)
[两分钟练习：XPerf](http://blogs.technet.com/b/askperf/archive/2008/06/27/an-intro-to-xperf.aspx)
[建议观察性能计数器简介 (IIS 6.0)](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/7898b860-462c-4846-a3a8-1179f287ad88.mspx?mfr=true)

看看最好的网站做了什么：
[基准](http://www.gomez.com/benchmarks/)
[TOP 100](http://www.alexa.com/topsites?cc=US&ts_mode=country&lang=none)

更多资源：
[学习论文](http://www.gomez.com/resources/)

我的经验是：
- 在 IIS 中为静态数据启用压缩（GZIP/Deflate）。实施简单，效果极佳。
- 如果 cpu 不是您的问题，请尝试为动态数据启用压缩。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-19T00:28:39.957

对于您的特定情况，您需要增加 IIS 中的空闲超时选项，因为该延迟是由于 ASP.NET 加载二进制文件并启动您的应用程序造成的。默认是 20 分钟，所以如果在 20 分钟内没有人访问该站点，IIS 将关闭该进程，并且下一个请求将需要很长时间才能启动。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-19T00:31:00.123

当有一段时间不活动时，应用程序池可能正在关闭？应用程序池需要一些时间来启动备份。

# ruby-on-rails - Rails 每个请求的哈希？

> ID：660599
> 
> 赞同：18
> 
> 时间：2009-03-19T00:17:14.773
> 
> 标签：ruby-on-rails

有没有办法在 Rails 中缓存每个请求的数据？对于给定的 Rails/mongrel 请求，我有一个半昂贵的操作的结果，我想稍后在该请求中访问几次。是否有可以存储和访问此类数据的哈希？

它需要是相当全局的，并且可以从视图、控制器和库中访问，就像 Rails.cache 和 I18n 一样。

如果需要的话，我可以做一些猴子修补。

*   Memcached 不起作用，因为它将在请求之间共享，这是我不想要的。
*   全局变量同样不起作用，因为不同的请求将共享相同的数据，这不是我想要的。
*   实例变量不起作用，因为我想从不同的类中访问数据。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2013-02-03T14:53:42.157

还有[request_store](https://github.com/steveklabnik/request_store) gem。从文档中：

将此行添加到应用程序的 Gemfile：

```
gem 'request_store' 
```

并使用此代码存储和检索数据（仅限于请求）：

```
# Set
RequestStore.store[:foo] = 0

# Get
RequestStore.store[:foo] 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-08-30T00:04:14.197

尝试[PerRequestCache](http://gist.github.com/177780)。我从 SQL 查询缓存中窃取了设计。

配置它`config/environment.rb`：

```
config.middleware.use PerRequestCache 
```

然后使用它：

```
PerRequestCache.fetch(:foo_cache){ some_expensive_foo } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-04-11T16:42:34.530

最受欢迎的选项之一是使用[`request_store`](https://github.com/steveklabnik/request_store)gem，它允许您从代码的任何部分访问全局存储。它用于`Thread.current`存储您的数据，并负责在每次请求后清理数据。

```
RequestStore[:items] = [] 
```

但请注意，由于它使用`Thread.current`，它在每个请求有多个线程的多线程环境中无法正常工作。

为了规避这个问题，我实现了一个可以在同一请求的线程之间共享的存储。它被称为[`request_store_rails`](https://github.com/ElMassimo/request_store_rails)，它是线程安全的，用法非常相似：

```
RequestLocals[:items] = [] 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T01:12:54.703

你考虑过闪退吗？它使用 Session 但会自动清除。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T03:24:44.307

[记忆](http://ryandaigle.com/articles/2008/7/16/what-s-new-in-edge-rails-memoization)？

根据[this railscast](http://media.railscasts.com/videos/137_memoization.mov)，它是按请求存储的。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-03-19T00:29:01.423

全局变量是邪恶的。弄清楚如何干净地将您想要的数据传递到您想要使用它的地方。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-03-19T02:32:40.423

**应用程序/模型/my_cacher.rb**

```
class MyCacher
  def self.result
    @@result ||= begin
      # do expensive stuff
      # and cache in @@result
    end
  end
end 
```

||= 语法基本上意味着“如果@@result 为nil，则执行以下操作”（即尚未设置为任何内容）。只需确保开始/结束块中的最后一行返回结果即可。

然后在您的视图/模型/任何您需要时引用该函数的内容：

```
MyCacher.result 
```

这将在请求期间缓存昂贵的操作。

# eclipse - 单个 Subversion 存储库能否在 Eclipse 中作为多个项目进行管理？

> ID：660601
> 
> 赞同：4
> 
> 时间：2009-03-19T00:18:15.490
> 
> 标签：eclipse, svn, projects

我有一个 Helpdesk 应用程序，其中包含可以根据用户需要/偏好单独下载和安装的模块。该结构与 Drupal 等许多软件非常相似，可以轻松加载/卸载模块。

我为此帮助台应用程序使用单个 SVN 存储库，并为每个模块创建不同的标签。在我的 Eclipse 上，我将所有内容都作为一个项目。

*   我的问题是，单个 Subversion 存储库能否在 Eclipse 中作为多个项目进行管理？
*   我可以为整个应用程序同时为每个模块创建一个 Eclipse 项目吗？
*   另一个要求是，通过将每个模块拆分为不同的项目将使 Eclipse 构建速度更快。

原因是，我想将每个模块的编程工作委托给另一个人，而不需要暴露所有内容。该人只会看到和处理模块，但会提交到主存储库。

我知道Eclipse每个项目都会有配置文件，会不会有冲突。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T01:03:51.167

我已经很好地将多个 Eclipse 项目存储在一个存储库中。每个项目都存储在存储库根目录下的单独文件夹中。然后，我使用[Subclipse](http://subclipse.tigris.org/)将每个文件夹作为单独的 Eclipse 项目检出。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T00:27:37.353

我不认为你应该嵌套 Eclipse 项目（这样一个主项目包含许多子项目）。

除了主项目之外，您还可以将各个项目分组到 Eclipse 所称的团队项目集（可在导出/导入菜单中找到）。这是一个定义所有项目所在位置的 XML 文件。您也可以将该文件放入 Subversion。

因此，您将拥有所有模块的项目，以及 XML 文件（它本身不是项目），都在 Subversion 中（可能是同一个存储库，可能分布在多个存储库中）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T01:03:32.197

我不相信这是绝对可能的。就个人而言，我会将模块完全拆分到不同的项目中，并且我可能会使用 Eclipse 的插件结构来解决它们与主项目之间的依赖关系。如果您将插件作为 jar 包发布，它们仍然是模块化的。然后，您可以在 Eclipse 中将每个插件控制为单独的项目，在 SVN 中将其控制为单独的文件夹。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-18T16:02:52.287

这完全没有问题！只需在您的 svn 存储库上创建您的主干/标签/分支结构。创建不同的项目，然后将这些项目签入 svn 系统上的 trunc 文件夹。完成的！

# c# - 如何从动态加载的程序集中加载包含嵌套类型的泛型类型？

> ID：660607
> 
> 赞同：3
> 
> 时间：2009-03-19T00:19:44.753
> 
> 标签：c#, .net, generics, assemblies

在使用 Assembly.LoadFrom 加载到当前 AppDomain 的程序集中**，**我有以下代码：

```
[TypeConverter(typeof(EnumConverter<Shapes>))]
public enum Shapes
{
  Triangle,
  Square,
  Circle
} 
```

通用 EnumConverter<T> 在调用 Assembly.GetEntryAssembly() 返回的程序集中定义。当我在运行时读取 TypeConverter 属性时，我得到的类型的全名类似于：

```
MyAssembly.EnumConverter`1[[MyDynamicAssembly.Shapes, MyDynamicAssembly, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null]] 
```

但是，当我在字符串上调用 Type.GetType() 时，它返回 null。我希望能够获得 System.Type 的实例。[另请注意，MyDynamicAssembly 不是由 Reflection.Emit 生成的（在此处](http://msdn.microsoft.com/en-us/library/w3f99sx1.aspx)的 MSDN 文章中指出）。

此代码是在 Visual Studio 2005 上使用 .NET Framework 2.0 生成的。

有没有人找到解决此错误/限制的方法？它在 3.5 中修复了吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T15:30:50.060

在遵循[MSDN 论坛帖子](http://social.msdn.microsoft.com/Forums/en-US/netfxbcl/thread/fec7ea31-5241-4fbd-a9c7-9ae602e172d4/)的引导后，我能够整理出一个通用解决方案，用于从运行时加载的程序集中加载任意泛型类型。我希望这对某些人有所帮助（也许微软会在 .NET 4.0 中加入等价的东西？）

```
public static class TypeHelpers
{
    /// <summary>
    /// Gets the System.Type with the specified name, performing a case-sensitive search.
    /// </summary>
    /// <param name="typeName">The assembly-qualified name of the type to get. See System.Type.AssemblyQualifiedName.</param>
    /// <param name="throwOnError">Whether or not to throw an exception or return null if the type was not found.</param>
    /// <param name="ignoreCase">Whether or not to perform a case-insensitive search.</param>
    /// <returns>The System.Type with the specified name.</returns>
    /// <remarks>
    /// This method can load types from dynamically loaded assemblies as long as the referenced assembly 
    /// has already been loaded into the current AppDomain.
    /// </remarks>
    public static Type GetType(string typeName, bool throwOnError, bool ignoreCase)
    {
        if(string.IsNullOrEmpty(typeName))
            throw new ArgumentNullException("typeName");

        // handle the trivial case
        Type type;
        if((type = Type.GetType(typeName, false, ignoreCase)) != null)
            return type;

        // otherwise, perform the recursive search
        try
        {
            return GetTypeFromRecursive(typeName, ignoreCase);
        }
        catch(Exception e)
        {
            if(throwOnError)
                throw;
        }

        return null;
    }

    #region Private Static Helper Methods

    private static Type GetTypeFromRecursive(string typeName, bool ignoreCase)
    {
        int startIndex = typeName.IndexOf('[');
        int endIndex = typeName.LastIndexOf(']');

        if(startIndex == -1)
        {
            // try to load the non-generic type (e.g. System.Int32)
            return TypeHelpers.GetNonGenericType(typeName, ignoreCase);
        }
        else
        {
            // determine the cardinality of the generic type
            int cardinalityIndex = typeName.IndexOf('`', 0, startIndex);
            string cardinalityString = typeName.Substring(cardinalityIndex + 1, startIndex - cardinalityIndex - 1);
            int cardinality = int.Parse(cardinalityString);

            // get the FullName of the non-generic type (e.g. System.Collections.Generic.List`1)
            string fullName = typeName.Substring(0, startIndex);
            if(typeName.Length - endIndex - 1 > 0)
                fullName += typeName.Substring(endIndex + 1, typeName.Length - endIndex - 1);

            // parse the child type arguments for this generic type (recursive)
            List<Type> list = new List<Type>();
            string typeArguments = typeName.Substring(startIndex + 1, endIndex - startIndex - 1);
            foreach(string item in EachAssemblyQualifiedName(typeArguments, cardinality))
            {
                Type typeArgument = GetTypeFromRecursive(item, ignoreCase);
                list.Add(typeArgument);
            }

            // construct the generic type definition
            return TypeHelpers.GetNonGenericType(fullName, ignoreCase).MakeGenericType(list.ToArray());
        }
    }

    private static IEnumerable<string> EachAssemblyQualifiedName(string s, int count)
    {
        Debug.Assert(count != 0);
        Debug.Assert(string.IsNullOrEmpty(s) == false);
        Debug.Assert(s.Length > 2);

        // e.g. "[System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]"
        // e.g. "[System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089],[System.DateTime, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]"
        // e.g. "[System.Collections.Generic.KeyValuePair`2[[System.Int32, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089],[System.DateTime, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]], mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]"

        int startIndex = 0;
        int bracketCount = 0;

        while(count > 0)
        {
            bracketCount = 0;

            for(int i = startIndex; i < s.Length; i++)
            {
                switch(s[i])
                {
                    case '[':
                        bracketCount++;
                        continue;

                    case ']':
                        if(--bracketCount == 0)
                        {
                            string item = s.Substring(startIndex + 1, i - startIndex - 1);
                            yield return item;
                            startIndex = i + 2;
                        }
                        break;

                    default:
                        continue;
                }
            }

            if(bracketCount != 0)
            {
                const string SR_Malformed = "The brackets are unbalanced in the string, '{0}'.";
                throw new FormatException(string.Format(SR_Malformed, s));
            }

            count--;
        }
    }

    private static Type GetNonGenericType(string typeName, bool ignoreCase)
    {
        // assume the type information is not a dynamically loaded assembly
        Type type = Type.GetType(typeName, false, ignoreCase);
        if(type != null)
            return type;

        // otherwise, search the assemblies in the current AppDomain for the type
        int assemblyFullNameIndex = typeName.IndexOf(',');
        if(assemblyFullNameIndex != -1)
        {
            string assemblyFullName = typeName.Substring(assemblyFullNameIndex + 2, typeName.Length - assemblyFullNameIndex - 2);
            foreach(Assembly assembly in AppDomain.CurrentDomain.GetAssemblies())
            {
                if(assembly.GetName().FullName == assemblyFullName)
                {
                    string fullName = typeName.Substring(0, assemblyFullNameIndex);
                    type = assembly.GetType(fullName, false, ignoreCase);
                    if(type != null)
                        return type;
                }
            }
        }

        // no luck? blow up
        const string SR_TypeNotFound = "The type, '{0}', was not found.";
        throw new ArgumentException(string.Format(SR_TypeNotFound, typeName), "typeName");
    }

    #endregion
} 
```

此代码已使用上述场景和以下 MbUnit 测试进行了测试：

```
[Test]
public void GetType_DictionaryOfStringAndDictionaryOfInt32AndKeyValuePairOfStringAndListOfInt32()
{
    Dictionary<string, Dictionary<int, KeyValuePair<string, List<int>>>> obj = 
    new Dictionary<string, Dictionary<int, KeyValuePair<string, List<int>>>>();

    string typeName = obj.GetType().FullName;
    Type type = TypeHelpers.GetType(typeName, true, false);

    Assert.IsTrue(type.Equals(obj.GetType()));
} 
```

注意：您应该在尝试使用此测试时注释掉琐碎的处理程序，否则将调用 Type.GetType() 而不是实际的解析代码。

# java - Java 的 SQL 解析器库

> ID：660609
> 
> 赞同：144
> 
> 时间：2009-03-19T00:21:14.407
> 
> 标签：java, sql, parsing

是否有用于解析 SQL 语句的开源 Java 库？

如果可能的话，它应该是可定制的或足够灵活的，以便能够解析（或至少忽略）供应商特定的语法（例如 Oracle 表空间定义或 MySQL 的 LIMIT 子句）。

如果没有，严格遵守 SQL 标准也可以。

**更新：**我需要这个做两件事：

*   为非 SQL 数据库提供 SQL 接口（映射到内部 API 调用）
*   在进入实际数据库（例如 Oracle）之前重写 SQL

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-03-19T00:35:57.177

[ANTLR3](http://www.antlr3.org/grammar/list.html)有一个可用的 ANSI SQL 语法。您可以使用它来创建自己的解析器。

ANTLR4 有一个[SQL 语法](https://github.com/antlr/grammars-v4/blob/master/sqlite/SQLite.g4)。

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2009-09-24T20:52:19.037

*   [JSqlParser](http://jsqlparser.sourceforge.net/)
*   [Presto 的解析器](https://github.com/prestosql/presto/tree/master/presto-parser)是使用 ANTLR4 编写的，并且有自己的不可变 AST 类，这些类是从解析器构建的。AST 有一个访客和漂亮的打印机。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-19T00:42:16.413

**解析器**

[如果您需要解析器，则Apache Derby](http://db.apache.org/derby/)的代码库中应该有一个解析器。

**处理特定于供应商的 SQL**

您可能想查看 jdbc Connection 对象上的[.native()](http://java.sun.com/javase/6/docs/api/java/sql/Connection.html#nativeSQL(java.lang.String))方法，您可以将其传递给供应商中立的查询，这些查询将被后处理为供应商特定的查询。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-08-09T08:30:10.213

[Java 的通用 SQL 解析器](http://www.sqlparser.com/sql-parser-java.php)不是开源的，但正是您所关心的。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2010-02-05T21:06:14.220

试试[Zql](http://zql.sourceforge.net/)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-04-18T08:50:34.543

Hibernate 使用 ANTLR 进行 sql 和 hql 解析。

JSqlParser 也是一个不错的选择。虽然它在解析 oracle pl/sql 时存在一些错误（或某些功能未实现）。有关详细信息，请参见其论坛。

因此，如果您要解析 oracle pl/sql，建议使用 ANTLR。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-19T00:38:40.243

你想用解析后的 SQL 做什么？我可以推荐一些 Lex/Yacc 的 Java 实现（[BYACC/J](http://byaccj.sourceforge.net/)，[Java Cup](http://www2.cs.tum.edu/projects/cup/)），您可以使用现有的 SQL 语法。

如果您想对生成的语法分析做一些实际的事情，我可能会建议您查看[Derby](http://db.apache.org/derby/)，这是一个用 Java 编写的开源 SQL 数据库。

# linux - Linux/X11下如何隐藏鼠标指针？

> ID：660613
> 
> 赞同：34
> 
> 时间：2009-03-19T00:25:25.143
> 
> 标签：linux, mouse, x11

X11下如何隐藏鼠标指针？我想使用内置库来执行此操作，而不是使用 SDL (SDL_ShowCursor(0)) 或 glut (glutSetCursor(GLUT_CURSOR_NONE)) 之类的东西。此外，无论指针位置如何，鼠标指针都应该隐藏，而不仅仅是在它自己的窗口中。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-30T11:32:08.750

这是实用程序如何执行此操作的[描述。](http://www.ibiblio.org/pub/X11/contrib/utilities/unclutter-8.README)`unclutter`

> Unclutter 是一个在 X11 会话的后台永久运行的程序。它每隔几秒钟检查一次 X11 指针（光标）的位置，当它发现它没有移动时（并且没有在鼠标上按下任何按钮，并且光标不在根窗口中），它会创建一个小的子窗口光标所在窗口的子窗口。新窗口安装大小为 1x1 但掩码为全 0 的光标，即不可见光标。例如，这允许您查看 xterm 或 xedit 中的所有文本。人为因素人群会同意它应该使事情不那么分散注意力。
> 
> 一旦创建，程序等待指针离开窗口然后销毁它，恢复原来的情况。按钮事件透明地传递到父窗口。它们通常会导致光标重新出现，因为当按钮按下时程序会进行主动抓取，因此指针显然会离开窗口，即使它的 xy 位置没有改变。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2016-09-15T19:27:49.957

Xorg 1.7 及更高版本有一个`-no-cursor`选项。[https://www.x.org/wiki/AdvancedTopicsFAQ/](https://www.x.org/wiki/AdvancedTopicsFAQ/)

`xinit -- -nocursor`或者`startx -- -nocursor`可以工作。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2012-12-18T15:16:25.470

我宁愿使用更简单的方法：

```
unclutter -idle 0 
```

您几乎看不到光标，但它仍然可用。要禁用鼠标：

```
rmmod psmouse 
```

或者在 /etc/ 中的某处永久禁用鼠标模块。请参阅您的分发手册。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2013-05-01T19:50:11.573

## 整洁的替代品

**Unclutter**对我不起作用，因为它不能很好地与硬件加速表面（例如在解码视频时由英特尔的 VA-API 产生的表面）配合使用。所以我找到了一个以不那么迂回的方式隐藏鼠标指针的程序**[hhp](http://hackage.haskell.org/package/xmonad-utils)**，并以最小的依赖关系用 C 重写了它，结果是**[hhpc](https://github.com/Aktau/hhpc)**。我这样做是为了避免需要 haskell 来编译它，因为 hhp 有时会停止隐藏鼠标指针。

**[hhpc](https://github.com/Aktau/hhpc)**，只依赖于`glibc`and`xlib`，所以很容易构建，只要做`make release`. 您可以从[我的存储库](https://github.com/Aktau/hhpc)中获取代码和说明。它非常节省内存和 CPU（因为它几乎什么都不做）。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-03-20T00:16:24.010

我最终使用了 XDefineCursor，就像提到的 ehemient 一样。控制应用程序更改了默认的根窗口光标，其他应用程序（在我的控制下）继承了它。

代码细节如下所示：

```
// Hide the cursor

if (NULL==(display=XOpenDisplay(NULL))) 
{
   printf("Unable to open NULL display\n");
   exit(1);
}
window = DefaultRootWindow(display);

Cursor invisibleCursor;
Pixmap bitmapNoData;
XColor black;
static char noData[] = { 0,0,0,0,0,0,0,0 };
black.red = black.green = black.blue = 0;

bitmapNoData = XCreateBitmapFromData(display, window, noData, 8, 8);
invisibleCursor = XCreatePixmapCursor(display, bitmapNoData, bitmapNoData, 
                                     &black, &black, 0, 0);
XDefineCursor(display,window, invisibleCursor);
XFreeCursor(display, invisibleCursor);
XFreePixmap(display, bitmapNoData); 
```

为了隐藏光标然后在我完成之后

```
// Restore the X left facing cursor
Cursor cursor;
cursor=XCreateFontCursor(display,XC_left_ptr);
XDefineCursor(display, window, cursor);
XFreeCursor(display, cursor); 
```

恢复 X 的左手光标（因为它是根窗口，我不希望它保持不可见。我不确定，但我也可以使用

```
XUndefineCursor(display, window); 
```

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2009-03-19T01:00:37.493

您可以创建和设置不可见的光标主题。[maemo](http://maemo.org/)使用了这个技巧，因为在触摸屏设备上放置光标是毫无意义的。

遗憾的是，在运行时更改全局光标主题的能力在 X11 应用程序和工具包中并不统一。可以更改服务器资源`Xcursor.theme`，没有人会注意到（一般只在启动时查询）；您可以通知似乎只影响 Gtk+ 程序的[xsettings ；](http://standards.freedesktop.org/xsettings-spec/xsettings-spec-0.5.html)KDE 通过根窗口的属性使用某种通信方式；等等

至少为您自己的应用程序更改光标就像[XDefineCursor](http://tronche.com/gui/x/xlib/window/XDefineCursor.html)一样简单，如果您在根窗口上这样做，*一些*应用程序*可能会*随之而来。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2017-02-05T02:47:49.667

使用 xbanish！它“在打字时消除鼠标光标”！开始它

> 外星人 &

享受！

xbanish 的源代码在这里：
[https ://github.com/jcs/xbanish](https://github.com/jcs/xbanish)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2013-06-17T08:04:04.690

要隐藏鼠标光标，请创建一个额外的小文件（我称为 mine `blnk_ptr.xbm`）：

```
#define blnk_ptr_width 1
#define blnk_ptr_height 1
#define blnk_ptr_x_hot 0
#define blnk_ptr_y_hot 0
static unsigned char blnk_ptr_bits[] = {
    0x00 }; 
```

然后，

*   要隐藏鼠标指针光标，

    ```
     $ xsetroot -cursor blnk_ptr.xbm blnk_ptr.xbm 
    ```

*   要再次显示鼠标指针光标，

    ```
     $ xsetroot -cursor_name left_ptr 
    ```

    您可以使用“left_ptr”以外的鼠标指针光标，但这似乎在 *nix 系统中广泛使用。

顺便说一句，我还不知道如何使用 xsetroot 获取系统当前使用的指针的名称。我想我也会[像往常一样]挖掘那个，但我很高兴有人知道如何给我答案（这很好;））

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2013-01-24T03:27:31.527

这是我的解决方案。它将光标放在你看不到的地方（在我的例子中，在左下角）——然后，它会禁用鼠标，所以你不能移动它。

**注意**您可以从 中解析数据`xrandr`，或在登录时将该数据放入环境中，然后使用它；这样，您就不必对其进行硬编码。但是，至于我，我从不改变我的屏幕分辨率，所以 768 就可以了 :)

```
setmouse () {
   DISPLAY=":0" xinput $1 `DISPLAY=":0" xinput | grep Mouse |
           tr -d " " | tr "\t" " " |
           cut -d" " -f2 | cut -d"=" -f2`
}

offmouse () {
   DISPLAY=":0" xdotool mousemove 0 768 # use xrandr to find out
   setmouse disable
}

onmouse () {
   setmouse enable
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2021-06-01T11:02:20.130

源代码，`xtoggle.c`：

```
#include <signal.h>
#include <X11/extensions/Xfixes.h>

Display               *display;
volatile sig_atomic_t breakout = 0;

void toggle_cursor(int x) { breakout = x; }

int main(void) {
    int      hidden = 0;
    struct   sigaction act;
    sigset_t mask;

    if (!(display = XOpenDisplay(NULL))) { return(1); }
    act.sa_handler = toggle_cursor;
    sigaction(SIGUSR1, &act, NULL);
    sigemptyset(&mask);
    while (1) {
        if (hidden) { XFixesShowCursor(display, DefaultRootWindow(display)); } 
        else        { XFixesHideCursor(display, DefaultRootWindow(display)); }
        XFlush(display);
        hidden = !hidden;
        breakout = 0;
        while (!breakout) { sigsuspend(&mask); }
    }
    return(0);
} 
```

*   取决于[Xfixes](https://en.wikipedia.org/wiki/XFixes)。在 Debian/Ubuntu 上，

    ```
    apt install libxfixes-dev 
    ```

*   编译它并在后台执行它，

    ```
    cc xtoggle.c -lX11 -lXfixes -o xtoggle
    ./xtoggle & 
    ```

*   通过向其发送 USR1 信号来切换光标可见性，

    ```
    pkill -USR1 -x xtoggle 
    ```

*   可能有用的练习：使用 XWarpPointer 在隐藏时将不可见的鼠标指针移开。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-11-05T23:57:50.627

有一个名为 Fixes 的 X11 扩展，它有一个可以用来隐藏光标的功能。这个函数的优点是它会向隐藏精灵的 X 服务器发送消息。没有技巧（即像素图中的不可见光标），据我所知，它适用于整个屏幕。

```
#include <X11/extensions/Xfixes.h>

...

    XFixesHideCursor(dpy, window);
    XFlush(dpy); // not required unless you want an immediate effect 
```

来源： [如何在 X11/Xorg 中隐藏鼠标光标](https://stackoverflow.com/questions/52122744/how-to-hide-the-mouse-cursor-in-x11-xorg)

# open-source - 登上开源列车

> ID：660615
> 
> 赞同：12
> 
> 时间：2009-03-19T00:26:51.350
> 
> 标签：open-source, new-operator

我知道如何找到开源项目。我知道如何找到它们。我不知道该怎么做是要求一份要做的事情的清单。我上过的每个开发者邮件列表都充满了真正的开发者。我从来没有看到任何新的程序员在场。大多数开源项目似乎对新程序员一点都不友好。

一个不是非常有经验的程序员的人怎么会要求做一些事情，同时看起来不烦人或麻烦。你对新手程序员的帮助有什么看法？

** 有项目的人是否有适合初学者的空间。我知道中级 C/C++/

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-19T01:30:21.697

简短的回答 - 从成为项目的活跃用户开始。这会让事情变得更容易。

* * *

长答案 -

问题不在于开源项目不需要帮助——大多数人会很乐意得到他们能得到的所有帮助。问题在于，大多数决定提供帮助的人只待了足够长的时间以从开发团队中抽出一些时间，然后“消失”并且再也不会出现。

过去，我在几个开源项目中非常活跃，我们一直都遇到这种情况。让人们想要提供帮助很容易，但很难让他们真正将所需的精力投入到项目中以使其有用。我个人花了很多很多时间来帮助新的潜在开发人员，但几乎总是眼睁睁地看着他们消失。

如果你能证明你是认真的，那么团队的反应会更快——而且通常不仅仅是出现在聊天室、论坛或邮件列表中。

首先，我会从寻找合适的项目开始。找到开源项目很容易，但更难找到适合您的项目。

这是困难的部分，还是容易的部分，取决于你的观点。我建议从您熟悉的项目开始 - 希望您已经使用过。如果您找到了您感兴趣的软件，请在考虑加入开发团队之前尝试使用当前状态的软件。如果您是该软件的用户，那么随着时间的推移，您更有可能对做出贡献感兴趣。

使用该项目将做两件事 -

一，它会让你熟悉他们是如何考虑这个项目的。这通常会让你更容易理解代码的设计，但最重要的是，帮助你理解当前团队的目标。

其次，通常也更容易得到开发人员的注意。如果您有具体问题要问。我个人总是对一个具体的、有针对性的、聪明的问题非常敏感。这有助于与当前的开发团队建立关系。

一旦您熟悉了团队和项目本身，并对其中的内容有所了解，请尝试修复一两个错误。这是一种简单的方式来表明你可以高效和有用，并且会受到很好的欢迎。

到那时，团队可能会更乐于帮助你找到好的、长期的目标和任务。我有几个人更接近我们的项目，我们都非常乐意帮助他们尝试找出如何融入整个团队并融入团队。

这就是我们的目标——从长远来看，你不想只是一个贡献者，你会想成为团队的一员。那是您开始对项目感到拥有所有权的时候，并且当它真正变得有趣的时候。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T00:29:24.277

这取决于您要进入的项目，但通常查看错误跟踪器会有所帮助（很少有开发人员会拒绝对已报告错误的补丁）。如果您运行 Linux，Gnome Love 是一组“易于修复”的错误，对于初学者来说应该是完美的。我的建议是选择一个更小/更简单的项目，因为代码库更容易定位。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T00:38:00.167

我没有参加过特定项目的培训，但我想你必须向开发团队证明自己。

例如，花点时间熟悉代码库。查看错误报告，看看您是否可以追踪一些错误。

一旦您了解了一些事情，您就可以提交错误修复或某些功能的实现。也许写一些文档来帮助新来的人围绕代码库进行思考。基本上，做任何能证明你知道自己在做什么的事情。

# multithreading - 线程最佳实践

> ID：660621
> 
> 赞同：47
> 
> 时间：2009-03-19T00:28:43.357
> 
> 标签：multithreading

我从事的许多项目的线程实现都很差，我是必须追踪这些的傻瓜。是否有公认的最佳方式来处理线程。我的代码总是在等待一个永远不会触发的事件。

我有点像设计模式或其他东西。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-03-19T00:34:56.243

（假设 .NET；类似的事情也适用于其他平台。）

嗯，有*很多*事情要考虑。我建议：

*   不变性非常适合多线程。函数式编程同时工作得很好，部分原因是强调了不变性。
*   在访问可变共享数据时使用锁，包括读取和写入。
*   除非你真的需要，否则不要尝试无锁。锁很昂贵，但很少成为瓶颈。
*   `Monitor.Wait`应该几乎*总是*条件循环的一部分，等待条件变为真，如果不是，则再次等待。
*   尽量避免持有锁的时间超过你需要的时间。
*   如果您需要一次获得两把锁，请彻底记录订单并确保您始终使用相同的订单。
*   记录类型的线程安全性。大多数类型*不需要*是线程安全的，它们只需要不是线程敌对的（即“你可以从多个线程中使用它们，但如果你想共享它们，*你*有责任取出锁）
*   不要从非 UI 线程访问 UI（以记录的线程安全方式除外）。在 Windows 窗体中，使用 Control.Invoke/BeginInvoke

这不是我的想法 - 如果这对你有用，我可能会想更多，但我会停在那里以防万一。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-03-19T00:33:56.323

学习正确编写多线程程序是极其困难和耗时的。

所以第一步是：用根本不使用多线程的实现替换。

然后，当且仅当您发现真正需要它时，小心地将线程放回原处，并且您已经找到了一些非常简单的安全方法。可靠工作的非线程实现远比损坏的线程实现好得多。

当您准备好开始时，支持使用线程安全队列在线程之间传输工作项的设计，并注意确保一次只能由一个线程访问这些工作项。

尽量避免只是`lock`在代码周围喷洒块，希望它会变得线程安全。它不起作用。最终，两个代码路径将以不同的顺序获取相同的锁，一切都会停止（每两周一次，在客户的服务器上）。如果您将线程与触发事件结合起来，并且在触发事件时持有锁，则这种情况尤其可能发生 - 处理程序可能会取出另一个锁，现在您有一对按特定顺序持有的锁。如果在其他情况下以相反的顺序取出它们怎么办？

简而言之，这是一个如此大而困难的主题，我认为在简短的回答中给出一些指示并说“你走吧！”可能会产生误导。- 我敢肯定，这不是许多有学问的人在这里给出答案的意图，但这是许多人从总结建议中得到的印象。

相反，[买这本书](https://rads.stackoverflow.com/amzn/click/com/032143482X)。

[这是来自该站点](http://www.albahari.com/threading/)的措辞非常优美的摘要：

> 多线程也有缺点。最大的问题是它可以导致更复杂的程序。拥有多个线程本身并不会产生复杂性。是线程之间的交互造成了复杂性。这适用于交互是否是有意的，并且可能导致较长的开发周期，以及对间歇性和不可重现的错误的持续敏感性。出于这个原因，在多线程设计中保持这种交互简单——或者根本不使用多线程——是值得的——除非你特别喜欢重写和调试！

[Stroustrup 的完美总结](http://www.daniweb.com/software-development/cpp/interviews/313564)：

> 处理并发的传统方法是让一堆线程在单个地址空间中松散，然后使用锁来尝试处理由此产生的数据竞争和协调问题，这在正确性和可理解性方面可能是最糟糕的。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-03-19T06:01:31.840

（像 Jon Skeet 一样，其中大部分都假设 .NET）

冒着看起来有争议的风险，像这样的评论只会困扰我：

> 学习正确编写多线程程序是极其困难和耗时的。
> 
> 应尽可能避免使用线程...

如果不以某种能力利用线程，几乎不可能编写出做任何重要事情的软件。如果您在 Windows 上，打开任务管理器，启用线程计数列，您可能一方面可以计算使用单个线程的进程数。是的，一个人不应该为了使用线程而简单地使用线程，也不应该漫不经心地做，但坦率地说，我认为这些陈词滥调被使用得太频繁了。

如果我不得不为真正的新手简化多线程编程，我会这样说：

*   在进入它之前，首先要了解类边界与线程边界不同。例如，如果您的类上的回调方法被另一个线程调用（例如，TcpListener.BeginAcceptTcpClient() 方法的 AsyncCallback 委托），请了解该回调*在*该其他线程上执行。所以即使回调发生在同一个对象上，你仍然必须在回调方法中同步访问对象的成员。线程和类是正交的；理解这一点很重要。
*   确定需要在线程之间共享哪些数据。定义共享数据后，尽可能将其合并到一个类中。
*   限制可以写入和读取共享数据的位置。如果你能把它归结为一个写作的地方和一个阅读的地方，你会帮自己一个巨大的忙。这并不总是可能的，但这是一个不错的目标。
*   显然，请确保使用 Monitor 类或 lock 关键字同步对共享数据的访问。
*   如果可能，请使用单个对象来同步您的共享数据，而不管有多少不同的共享字段。这将简化事情。但是，它也可能过度约束事物，在这种情况下，您可能需要每个共享字段的同步对象。在这一点上，使用不可变类变得*非常*方便。
*   如果您有一个线程需要向另一个线程发出信号，我强烈建议您使用 ManualResetEvent 类来执行此操作，而不是使用事件/委托。

总而言之，我想说线程并不难，但它可能很乏味。尽管如此，一个正确线程化的应用程序会响应更快，并且您的用户会非常感激。

编辑：C# 中的 ThreadPool.QueueUserWorkItem()、异步委托、各种 BeginXXX/EndXXX 方法对等没有什么“非常困难”的。如果有的话，这些技术很***重要***更容易以线程方式完成各种任务。如果您有一个 GUI 应用程序执行任何繁重的数据库、套接字或 I/O 交互，那么实际上不可能在不利用幕后线程的情况下使前端响应用户。我上面提到的技术使这成为可能并且使用起来很容易。可以肯定的是，了解这些陷阱很重要。我只是相信，当我们谈论多线程编程是多么“极其困难”或“应该如何避免”线程时，我们对程序员，尤其是年轻程序员，是一种伤害。当事实是线程从未如此简单时，诸如此类的评论过度简化了问题并夸大了神话。使用线程是有正当理由的，像这样的陈词滥调对我来说似乎适得其反。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-19T04:10:09.847

您可能对[CSP](http://en.wikipedia.org/wiki/Communicating_sequential_processes)之类的东西感兴趣，或者对处理并发的其他理论代数之一感兴趣。大多数语言都有 CSP 库，但如果该语言不是为它设计的，则需要一些纪律才能正确使用。但最终，每种并发/线程都归结为一些相当简单的基础知识：避免共享可变数据，并准确了解每个线程在等待另一个线程时何时以及为何必须阻塞。（在 CSP 中，共享数据根本不存在。每个线程（或 CSP 术语中的进程）*仅*允许通过阻塞消息传递通道与他人通信。由于没有共享数据，竞争条件消失了。由于消息传递是阻塞的，因此很容易推断同步，并从字面上证明不会发生死锁。）

另一个更容易改进到现有代码的良好做法是为系统中的每个锁分配优先级或级别，并确保始终遵循以下规则：

*   在 N 级持有锁时，您只能获取较低级别的新锁
*   同一级别的多个锁必须同时获取，作为单个操作，它总是尝试以相同的全局顺序获取所有请求的锁（请注意，任何一致的顺序都可以，但任何尝试获取一个的线程N 级或更多锁，必须按照与任何其他线程在代码中其他任何地方执行的顺序相同的顺序获取它们。）

遵循这些规则意味着根本不可能发生死锁。然后你只需要担心可变的共享数据。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-19T00:52:48.043

非常强调乔恩发布的第一点。您拥有的状态越不可变（即：全局变量是 const 等），您的生活就会越轻松（即：您必须处理的锁越少，推理就越少做关于交错顺序等......）

此外，通常情况下，如果您有需要多个线程才能访问的小对象，有时最好在线程之间复制它，而不是拥有一个共享的、可变的全局，您必须持有一个锁才能读取/变异。这是你的理智和记忆效率之间的权衡。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-19T08:23:19.097

在处理线程时寻找设计模式是最好的开始方法。可惜很多人不尝试，而是尝试自己实现或多或少复杂的多线程结构。

我可能会同意迄今为止发布的所有意见。此外，我建议使用一些现有的更粗粒度的框架，提供构建块而不是简单的设施，如锁或等待/通知操作。对于 Java，它只是简单的内置`java.util.concurrent`包，它为您提供现成的类，您可以轻松组合以实现多线程应用程序。这样做的最大优点是您避免编写低级操作，这会导致难以阅读和容易出错的代码，有利于更清晰的解决方案。

根据我的经验，使用这个包似乎可以在 Java 中解决大多数并发问题。但是，当然，你总是应该小心多线程，无论如何它都是具有挑战性的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-19T01:00:32.063

我想跟进 Jon Skeet 的建议，并提供更多提示：

*   如果您正在编写“服务器”，并且可能具有大量插入并行性，请不要使用 Microsoft 的 SQL Compact。它的锁管理器是愚蠢的。如果您确实使用 SQL Compact，请不要使用可序列化事务（这恰好是 TransactionScope 类的默认设置）。事情很快就会在你身上分崩离析。SQL Compact 不支持临时表，当您尝试在序列化事务中模拟它们时，它会做一些非常愚蠢的事情，例如在 _sysobjects 表的索引页上使用 x 锁。即使您不使用临时表，它也非常渴望锁定升级。如果您需要对多个表进行串行访问，

    然而，当你这样做时，你需要小心（就像 John Skeet 所说的）来创建一个定义良好的锁层次结构。

*   如果您确实创建了自己的锁管理器，请使用`<ThreadStatic>`字段来存储有关您使用的锁的信息，然后在锁管理器内的每个位置添加断言以强制执行您的锁层次结构规则。这将有助于提前根除潜在问题。

*   在 UI 线程中运行的任何代码中，在`!InvokeRequired`（对于 winforms）或`Dispatcher.CheckAccess()`（对于 WPF）上添加断言。您应该类似地将反向断言添加到在后台线程中运行的代码中。这样，查看方法的人只需查看它就知道它的线程要求是什么。断言也将有助于捕获错误。

*   像疯了一样断言，即使在零售版本中也是如此。（这意味着投掷，但你可以让你的投掷看起来像断言）。带有异常“您这样做违反了线程规则”的故障转储以及堆栈跟踪比世界另一端的客户报告“时不时地使用应用程序”更容易调试只是冻结在我身上，或者它吐出狼吞虎咽的东西”。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-19T01:43:52.553

添加其他人已经在这里提出的观点：

* * *

一些开发人员似乎认为“几乎足够”的锁定就足够了。根据我的经验，相反的情况可能是正确的——“几乎足够”的锁定可能比足够的锁定**更糟糕。**

想象一下线程 A 锁定资源 R，使用它，然后解锁它。然后 A 在没有锁的情况下使用资源 R'。

同时，线程 B 尝试访问 R，而 A 将其锁定。线程 B 被阻塞，直到线程 A 解锁 R。*然后 CPU 上下文切换到线程 B，该线程访问 R，然后在其时间片内更新 R'*。该更新使 R' 与 R 不一致，导致 A 尝试访问它时失败。

* * *

在尽可能多的不同硬件和操作系统架构上进行测试。不同的 CPU 类型，不同数量的内核和芯片，Windows/Linux/Unix 等。

* * *

第一个使用多线程程序的开发人员是一个名叫墨菲的人。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-19T06:21:06.177

好吧，到目前为止，每个人都以 Windows / .NET 为中心，所以我将加入一些 Linux / C。

[不惜一切代价避免使用 futexes](http://people.redhat.com/drepper/futex.pdf) (PDF)，除非您真的、真的需要恢复在互斥锁上花费的一些时间。我目前正在使用 Linux futexes 拉我的头发。

我还没有勇气采用[实用的无锁解决方案](http://www.cl.cam.ac.uk/research/srg/netos/lock-free/)，但出于纯粹的挫败感，我正在迅速接近这一点。如果我能找到一个好的、有据可查的、可移植的实现，我可以真正学习和掌握，我可能会完全放弃线程。

我最近遇到了很多代码，它们使用了实际上不应该使用的线程，很明显，当一个（是的，只有一个）fork 可以完成这项工作时，有人只是想表达他们对 POSIX 线程的永恒热爱。

我希望我能给你一些“一直有效”的代码。我可以，但是用作演示（服务器等为每个连接启动线程）会很愚蠢。在更复杂的事件驱动应用程序中，我还没有（几年后）编写任何不遭受几乎不可能重现的神秘并发问题的东西。所以我是第一个承认，在那种应用程序中，线程对我来说有点太多了。它们太诱人了，我最后总是上吊。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-19T22:06:01.250

> 这是可变状态，愚蠢的

这是Brian Goetz从*[Java Concurrency in Practice 中](http://jcip.net)*直接引用的。尽管本书以 Java 为中心，但“第一部分摘要”提供了一些其他有用的提示，这些提示将适用于许多线程编程上下文。以下是同一摘要中的更多内容：

> *   不可变对象自动是线程安全的。
> *   用锁保护每个可变变量。
> *   不同步地从多个线程访问可变变量的程序是损坏的程序。

我建议您获取本书的副本，以便深入处理这个难题。

[![替代文字](https://i.stack.imgur.com/xyzXe.jpg)](https://i.stack.imgur.com/xyzXe.jpg)
[（来源：[umd.edu](http://www.cs.umd.edu/class/fall2008/cmsc433/jcipMed.jpg)）]

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-19T12:18:28.020

您应该使用 ReaderWriterLockSlim，而不是锁定容器。这为您提供了类似锁定的数据库 - 无限数量的读者、一个作者和升级的可能性。

至于设计模式，pub/sub 已经非常成熟，并且很容易在 .NET 中编写（使用 readerwriterlockslim）。在我们的代码中，我们有一个每个人都可以获得的 MessageDispatcher 对象。您订阅它，或者以完全异步的方式发送消息。您只需要锁定已注册的函数和它们使用的任何资源。它使多线程更容易。

# windows - 为什么我的 Perl 单行代码不能在 Windows 上运行？

> ID：660624
> 
> 赞同：14
> 
> 时间：2009-03-19T00:30:11.327
> 
> 标签：windows, perl

在 Windows 命令提示符下，我生成一个目录中所有文件的文本文件：

```
dir c:\logfiles /B > config.txt 
```

输出：

```
0001_832ec657.log
0002_a7c8eafc.log 
```

我需要将“config.txt”文件提供给另一个可执行文件，但在此之前，我需要修改文件以添加可执行文件所需的一些附加信息。所以我使用以下命令：

```
perl -p -i.bak -e 's/log/log,XYZ/g' config.txt 
```

我期望结果是：

```
0001_832ec657.log,XYZ
0002_a7c8eafc.log,XYZ 
```

但是，“config.txt”文件没有被修改。使用“-w”选项，我收到警告消息：

> 在 -e 第 1 行的 void 上下文中无用地使用常量。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-19T01:04:43.800

Windows`cmd.exe`不用`'`作字符串分隔符，仅`"`. 你在做什么相当于：

```
perl -p -i.bak -e "'s/log/log,XYZ/g'" config.txt 
```

`-w`抱怨“你给了我一个字符串，但它什么也没做”也是如此。

解决方案是改用双引号：

```
perl -p -i.bak -e "s/log/log,XYZ/g" config.txt 
```

或者干脆不使用它们，因为此命令中没有将由`cmd.exe`.

### 附录

`cmd.exe``sh`对于习惯了-like shell的人来说，这只是一个非常麻烦的野兽。`perl`以下是有关调用的其他一些常见故障和解决方法。

```
@REM 不起作用：
perl -e“打印”
@REM 有效：
perl -e "打印"
@REM 不起作用：
perl -e "print \"你好，世界！\n\""
@REM 有效：
perl -e "打印 qq(Hello, world!\n)"

```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-20T00:25:50.307

[ephemient](https://stackoverflow.com/users/20713/ephemient)的回答很好地总结了这个问题，但您确实有另一个选择：将您的外壳从更改`cmd.exe`为更好的外壳。如果您是 Unix 类型的人，那么我建议您研究[Cygwin](http://www.cygwin.com/)，它提供了您习惯的那种环境（例如，[Bash](http://en.wikipedia.org/wiki/Bash_%28Unix_shell%29)和 GNU 实用程序）。

如果您是 Windows 类型的人，我建议您查看[PowerShell](http://www.microsoft.com/windowsserver2003/technologies/management/powershell/default.mspx)（née MSH née Monad）。事实上，即使你是 Unix 类型的人，我也建议你研究一下 PowerShell。它与[.NET](http://en.wikipedia.org/wiki/.NET_Framework)集成并具有许多简洁的功能（例如通过管道传递的对象而不是简单的文本行）。如果我被困在 Microsoft 操作系统上，那就是我将使用的 shell。

人们似乎喜欢的其他 Windows 外壳：

*   [优文](http://www.research.att.com/sw/tools/uwin/)
*   [明威](http://www.mingw.org/)
*   [UnixUtils](http://sourceforge.net/projects/unxutils)
*   [适用于 UNIX 的 Microsoft Windows 服务 (SFU)](http://en.wikipedia.org/wiki/Microsoft_Windows_Services_for_UNIX)
*   [MKS 工具包](http://www.mkssoftware.com/products/)

# c# - 这个正则表达式有什么问题？

> ID：660627
> 
> 赞同：0
> 
> 时间：2009-03-19T00:31:13.523
> 
> 标签：c#, regex

这几乎可以肯定是我忽略的非常愚蠢的事情，但我很难过。以下 C# 样式表达式应该匹配电话号码（其中的一个有限子集，但这只是测试......）：

```
^[0-9]{3}-[0-9]{3}-[0-9]{4}$ 
```

搜索字符串如下：

```
978-454-0586\r\nother junk\r\nmore junk\r\nhttp://www.google.com\r\n 
```

该表达式在孤立时与电话号码匹配，但在与其他东西相邻时则不匹配。例如，如果我在接完电话后把所有东西都删掉，那效果就很好。

如何修改表达式以使其与电话号码匹配并且不会挂断其他垃圾邮件？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T00:33:55.357

^ 和 $ 符号分别表示“行首”和“行尾”。如果您想在一行中间匹配，请摆脱它们。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T00:33:34.453

正则表达式中的“$”匹配行尾。如果你删除它，正则表达式应该可以正常工作，但如果你有“Foo978-454-0586”，它就不会工作，因为“^”匹配一行的开头。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-19T00:37:38.563

电话号码总是在自己的线路上吗？如果是这样，请将 RegexOptions.Multiline 添加到您的 Regex 构造函数中。如果没有，regex.match 将字符串的开头和结尾用于 ^ 和 $。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T00:34:17.307

表示字符串的`$`结尾，而不是行的结尾。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T00:34:24.983

问题是“^”和“$”强制它只匹配字符串的开头和字符串的结尾。

删除这两个标签，看看你是怎么走的。

# xml - Android ImageButton - 无法在中心获取图像

> ID：660629
> 
> 赞同：24
> 
> 时间：2009-03-19T00:32:09.607
> 
> 标签：xml, android, layout, imagebutton

我想在 xml 文件中创建一个带有背景图像的 Android ImageButton，并在其顶部有一个较小的图标，就在中心。出于某种原因，如何做到这一点并不明显，文档也无济于事。

```
<ImageButton
android:id="@+id/sound_button"
android:layout_x="430px"
android:layout_y="219px"
android:layout_width="48px"
android:layout_height="48px"
android:scaleType="center"
android:src="@android:drawable/volumeicon"
android:background="@drawable/clearbuttonup"
/> 
```

但是，无论我尝试什么（在布局_高度和布局_宽度上放置“**包装_内容**”而不是**绝对**数字，图标仍保留在按钮的左上角。但是，如果我没有背景图像（即系统默认的白色按钮），图标确实进入中心。当我使用颜色而不是图像作为背景时，该按钮也会进入左上角。

为什么会发生这种情况，以及我将如何实际获得我想要的行为 - 即中间有图标的背景图像？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-19T04:50:55.943

我是个真正的白痴。这就是它在 Ecliplse 插件与 XML 编辑器并排提供的显示中的显示方式。当我实际构建项目并在设备上运行它时，它正确显示了所有内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T00:51:43.693

具有讽刺意味的是，我在 ImageView 上遇到了完全相反的问题——无论我尝试什么，我都无法让它左对齐。在这种情况下，我使用的是`layout_width="fill_parent"`.

在此处查看我的问题：[Android 布局 - ImageView 的对齐问题](https://stackoverflow.com/questions/655994/android-layout-alignment-issue-with-imageview)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-05-31T20:10:44.087

尝试使用按钮并设置背景，它非常有用且简单：D

使文本为空，您可以像图像按钮一样使用它^_^

# c# - 委托控制价值/财产的变化

> ID：660630
> 
> 赞同：0
> 
> 时间：2009-03-19T00:32:30.103
> 
> 标签：c#, delegates

我正在尝试使用 Visual FoxPro (VFP) 做一些我在历史上可以做的事情。通过使用“SETALL()”函数，我可以做一些与当前表单相关的事情...... this.SetAll("someProperty", "toSomeNewValue") 它通过并将值分配给所有控件。通过“_assign”创建我自己的自定义属性和 VFP 内部，将触发这些事件。从那个方法，每个控件都会在表单上处理自己，从启用/禁用/可见性、可编辑、只读、颜色、字体、验证等，基于我在每个单独的控件中放置的内容。

那么，我将如何在 C# 中做类似的事情......例如在表单级别拥有公共属性或方法或委托，例如“FormEditMode”。然后，当我执行 this.FormEditMode = AddMode 之类的操作时，所有控件都将自行触发以分别打开/关闭、启用/禁用，而不是显式调用给定表单上的所有控件。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T02:57:05.700

我会做这样的事情：

```
this.Visible = false;
Controls.ForEach<Control>(c => c.Visible = false); 
```

如果您有 GroupBoxes 或其他具有控件的控件，您可能希望将其放入递归函数中：

```
static void DoForEachControl(Control control, Action<Control> f)
{
  control.Controls.ForEach<Control>(c =>
                                      {
                                        f(c);
                                        DoForEachControl(c, f);
                                      });
} 
```

要获得 ForEach，您需要这样的东西：

```
 public static class Extensions
  {
    public static void ForEach<T>(this IEnumerable source, Action<T> action)
    {
      foreach (var item in source)
      {
        action((T)item);
      }
    }
  } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-08T01:56:54.450

实际上，我通过在表单的 InitialzeComponents() 调用结束时自行注册每个控件以及结合我在研究中阅读的其他解决方案来解决它。

After building my baseline form, textbox, label controls (and others), after the InitializeComponents(), I do a recursive call for each control on the form and register its method to the form's delegate/event. Then, during a call to change the form's Edit Mode, it invokes the delegate call and triggers each individuals controls function. So, I'm getting a better handle on the delegate / event handings, and now the recursive call. This is done ONCE up front, so I don't have to keep recursively checking and calling during a button's click, or some other condition to cycle through controls each time I need to do something.

# c# - 关于 ORM 映射器（如 nhibernate 等）的问题

> ID：660632
> 
> 赞同：0
> 
> 时间：2009-03-19T00:33:09.010
> 
> 标签：c#, .net, orm

很少有关于 ORM 映射器的问题，例如 nhibernate（用于 .net/c# 环境）。

1.  对 sqlserver 数据库运行查询时，它是否在内部使用参数大小？

    参数.Add("@column1", SqlDataType.Int, 4)

2.  他们都在运行时使用反射吗？即手工编码总是快一点？

3.  它支持临时表、表变量吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-20T14:28:19.250

ORM World 是一个功能强大且功能齐全的世界，我认为今天的障碍是人们自己，也就是说，使用 ORM 需要在思考应用程序、架构和模式的方式上做出改变。

回答你的问题：

1.  查询执行取决于更多因素，可以完全自定义引擎/环境以利用各种功能，例如延迟执行、未来查询（在未来时刻执行的查询）、多个查询，最后但同样重要的是，会话管理涉及在这个领域：

    1.  延迟执行基于诸如延迟加载和延迟执行之类的概念，这意味着仅当您执行某些操作时才对数据库执行查询，例如访问 NHibernate Session 的方法，例如**ToList()**，延迟执行的另一个示例是使用 LinqToNhibernate，只有当您访问某些对象时，才会执行查询

    2.  未来的查询就像我在未来执行的查询之前所说的那样，Ayende 说得很好

    3.  多个查询是可以“打包”在一起并一次执行的查询，避免多次往返数据库，这可能是一个非常酷的功能

    4.  会话管理，这是另一个要提到的章节...但是请记住，如果您管理好您的会话，或者更好，让 NHibernate 引擎管理好会话，有时不需要去 DN 获取数据

在所有情况下，像 NHibernate 之类的工具都会为您生成查询，并且参数化查询可以通过参数很好地管理，甚至取决于您选择的底层数据库引擎和随之而来的数据库方言！

1.  很明显，像 NHibernate 这样的框架，大多数时候，在运行时使用反射，但需要提到的是使用了多个反射优化，例如**动态代理**......很明显，有时，或者可能一直直接代码可以更快，但只是在单位中，从大局来看，这可能涉及更多错误和瓶颈

2.  谈论 NHibernate，或者更好的说法是，在谈论临时表和临时数据时，了解您的意思很有用。就目前而言，据我所知，NHibernate 在运行时表的意义上不支持本机临时表, 但这可以做到，因为 NHibernate 允许在运行时创建对象映射，因此可以使用该 api 实现 Temp 数据机制

我希望我提供了一个有用的答案！...哎呀，对不起我的英语不好！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T00:48:20.860

nhiberate 使用一种优化的反射形式，它在启动时创建代理对象，其性能优于普通反射，因为它只会产生一次性成本。您还可以选择禁用此功能，它使休眠以更典型的方式运行，并永久使用反射。

使用以下键设置此功能：

```
<add key="hibernate.use_reflection_optimizer" value="true" /> 
```

Nhibernate 可以与变量表名一起使用。请参阅[此 SO 线程](https://stackoverflow.com/questions/515985/how-to-use-nhibernate-with-variable-or-dynamic-table-names-like-jan08tran-feb08tr)以获得良好的解决方案。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T01:14:20.830

1.  NHibernate 和 SubSonic、LinqToSql、EF，我认为大多数其他的都使用参数化 sql。

2.  大多数 ORM 使用某种反射，有些会在设计时为您生成所有代码和 SQL 查询，因此他们不必使用反射代码它可能工作得更快一些，但它会让您的领域一团糟，您必须使用他们的应用程序来重新生成所有代码。

3.  我几乎可以肯定他们都不支持这一点，但大多数人都有办法使用 SP 和 Views 来做到这一点。

您可以查看 NHibernate Screencast 系列[http://www.summerofnhibernate.com/](http://www.summerofnhibernate.com/)

# javascript - CSS 文本装饰：反向

> ID：660634
> 
> 赞同：5
> 
> 时间：2009-03-19T00:33:25.560
> 
> 标签：javascript, html, css, colors

我很惊讶 CSS 中没有“text-decoration:reverse”，因为使用 JavaScript 似乎很尴尬。IE将元素的前景色和背景色分别设置为父元素的背景色和前景色。

[我在这里](http://www.ruzee.com/blog/2006/07/retrieving-css-styles-via-javascript/)注意到了 JavaScript 技术

肯定没那么复杂吧？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T01:01:24.683

你说什么还原了？您的意思是将背景设置为前景色，反之亦然？（也许这是一个愚蠢的评论，但如果是这样，那不是装饰吗？）

无论如何，您将在这里与 DRY 和 MVC 发生争执：

*   要么你每次想要这样做时声明一个新的 CSS 类。这是多余且痛苦的，但您确实将样式与代码分开。

通常：

```
.mydiv {
   background-color: blue;
   color: red;
   font-family:...;
   (...)
}

.mydiv:hover {
   color: red;
   background-color: blue;
} 
```

*   另一种选择是通过javascript来做到这一点。Proxify 建议使用 jQuery。

    结果可能看起来像那样......（未经测试）

```
$(".invert").map(function (el) {
       var color = el.css("color");
       var bgcolor = el.css("background-color");
       el.css("color", bgcolor).css("background-color",color);
    })
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T01:17:37.513

“反转”文本的背景和前景样式的概念对于浏览器来说并不容易实现。如果允许您在浏览器中使用“文本装饰：反转”，那么背景图像是否也应该反转为文本？这不是今天的浏览器可以绘制的。

现在考虑透明胶片和那些 alpha 值。有许多方面使您的“反向”想法通常无法实施。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T00:42:02.453

好吧，您可以尝试使用 jQuery，这是实现与普通 javascript 相同的更简单的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-25T16:30:26.823

怎么样：

```
var bgColor = "#123456";
var textColor = bgColor.match(/^#([0-8][0-9a-fA-F])+$/g) == null ? "#000000" : "#ffffff"; 
```

因此，它使用白色文本作为深色背景颜色，使用黑色文本颜色作为较浅的背景颜色。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-13T22:34:25.520

虽然没有可用于反转文本的 CSS，但确实存在一个名为 bdo（双向覆盖）的 html 元素和选择器 dir="rtl"，您可以使用它来反转文本。

您可以反转页面中的文本

如果你给它一个类，你可以添加额外的样式元素，例如，你需要查看这个页面的源代码来“阅读”我所做的。（ps你不需要包含`元素，这是为了将代码与本简介的其余部分区分开来......）`

 ``You can reverse the text in your page`

`.reverso { color: #cc3300; font-size: 200%; }`

等等。

我希望这会有所帮助（O：

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2012-07-31T07:43:44.157

结帐 - [http://www.priteshgupta.com/2011/09/flip-or-reverse-text-using-css/](http://www.priteshgupta.com/2011/09/flip-or-reverse-text-using-css/)

# php - 使用 PHP 获取目录的层次结构

> ID：660644
> 
> 赞同：8
> 
> 时间：2009-03-19T00:34:32.220
> 
> 标签：php, file, filesystems, directory

我正在尝试查找指定目录下的所有文件和文件夹

例如我有 /home/user/stuff

我想回来

```
/home/user/stuff/folder1/image1.jpg
/home/user/stuff/folder1/image2.jpg
/home/user/stuff/folder2/subfolder1/image1.jpg
/home/user/stuff/image1.jpg 
```

希望这是有道理的！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-19T01:14:26.523

```
function dir_contents_recursive($dir) {
    // open handler for the directory
    $iter = new DirectoryIterator($dir);

    foreach( $iter as $item ) {
        // make sure you don't try to access the current dir or the parent
        if ($item != '.' && $item != '..') {
            if( $item->isDir() ) {
                // call the function on the folder
                dir_contents_recursive("$dir/$item");
            } else {
                // print files
                echo $dir . "/" .$item->getFilename() . "<br>";
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-19T11:28:07.093

```
foreach (new RecursiveIteratorIterator(new RecursiveDirectoryIterator($dir)) as $f) {
    echo "$f \r\n";   
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-03-28T10:54:21.690

**工作解决方案**（更改为您的文件夹名称）

```
<?php
$path = realpath('yourfolder/subfolder');
## or use like this
## $path = '/home/user/stuff/folder1';

foreach (new RecursiveIteratorIterator(new RecursiveDirectoryIterator($path)) as $filename)
{
        echo "$filename\n";
}
?> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-11-05T16:50:15.313

查找指定目录下的所有文件和文件夹。

```
function getDirRecursive($dir, &$output = []) {
    $scandir = scandir($dir);

    foreach ($scandir as $a => $name) {
        $path = realpath($dir . DIRECTORY_SEPARATOR . $name);
        if (!is_dir($path)) {
            $output[] = $path;
        } else if ($name != "." && $name != "..") {
            getDirRecursive($path, $output);
            $output[] = $path;
        }
    }

    return $output;
}

var_dump(getDirRecursive('/home/user/stuff')); 
```

## 输出（示例）：

```
array (size=4)
  0 => string '/home/user/stuff/folder1/image1.jpg' (length=35)
  1 => string '/home/user/stuff/folder1/image2.jpg' (length=35)
  2 => string '/home/user/stuff/folder2/subfolder1/image1.jpg' (length=46)
  3 => string '/home/user/stuff/image1.jpg' (length=27) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T15:34:17.057

```
$dir = "/home/user/stuff/";
$scan = scandir($dir);

foreach ($scan as $output) {
    echo "$output" . "<br />";
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-12-29T12:40:37.760

```
listAllFiles( '../cooktail/' ); //send directory path to get the all files and floder of root dir

function listAllFiles( $strDir ) {

    $dir = new DirectoryIterator( $strDir );

    foreach( $dir as $fileinfo ) {
        if( $fileinfo == '.' || $fileinfo == '..' ) continue;

        if( $fileinfo->isDir() ) {
            listAllFiles( "$strDir/$fileinfo" );
        }

        echo $fileinfo->getFilename() . "<br/>";
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-03-24T16:33:21.867

除了`RecursiveDirectoryIterator`解决方案，还有[`glob()`](http://php.net/manual/en/function.glob.php)解决方案：

```
// do some extra filtering here, if necessary
function recurse( $item ) {
    return is_dir( $item ) ? array_map( 'recurse', glob( "$item/*" ) ) : $item;
};

// array_walk_recursive: any key that holds an array will not be passed to the function. 
array_walk_recursive( ( recurse( 'home/user/stuff' ) ), function( $item ) { print_r( $item ); } ); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-04-16T14:46:16.480

您可以使用 RecursiveDirectoryIterator 甚至 glob 函数。或者，scandir 函数将完成这项工作。

# android - Android：从服务访问单选按钮值

> ID：660648
> 
> 赞同：4
> 
> 时间：2009-03-19T00:35:27.677
> 
> 标签：android, android-service, android-radiobutton

在我的 Android 应用程序中，一个**服务**在后台运行，它将**GPS 读数记录到数据库**中。用户会看到一个向他们展示**单选按钮**的 Activity 。我还想将他们当前选择的单选按钮记录到数据库中。

如何从服务访问单选按钮对象？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T17:33:27.550

一种简单的方法（假设您的服务与活动在同一进程中运行）是使用共享首选项文件。活动可以在单选按钮更改时写入首选项文件，并且服务可以在首选项上注册侦听器或在写入数据库时​​检查状态。

避免首选项的更复杂的方法是使用 Context.startService() 启动服务（这样即使 Activity 不在身边，它也会保持运行），然后让 Activity 调用 Context.bindService() （启动服务（如果它没有运行）返回一个它可以与之通信的 IBinder 存根。对于这种方法，我建议您查看[Service API Demos](http://developer.android.com/guide/samples/ApiDemos/src/com/example/android/apis/app/index.html)。

# css - IE8 CSS 选择器

> ID：660652
> 
> 赞同：45
> 
> 时间：2009-03-19T00:36:03.887
> 
> 标签：css, internet-explorer, css-hack

仅在 IE 浏览器中定位元素，我将使用

IE6：

```
* html #nav li ul {
    left: -39px !important;
    border: 1px solid red;
} 
```

IE7：

```
*+html #nav li ul  {
    left: -39px! important;
} 
```

有谁知道如何定位IE8？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2010-09-23T17:40:45.157

我不打算讨论是否应该使用这种方法，但这只会让你为 IE8-9 设置特定的 css 属性（注意：它不是一个选择器，所以和你的有点不同问）：

在每个 css 声明后使用 '\0/'，因此：

```
#nav li ul  {
  left: -39px\0/ !important;
} 
```

为了建立另一个答案，您可以这样做以将各种样式分配给 IE6、IE7 和 IE8：

```
#nav li ul  {
   *left: -7px    !important; /* IE 7 (IE6 also uses this, so put it first) */
   _left: -6px    !important; /* IE 6 */
    left: -8px\0/ !important; /* IE 8-9 */
} 
```

来源： [http ://dimox.net/personal-css-hacks-for-ie6-ie7-ie8/](http://dimox.net/personal-css-hacks-for-ie6-ie7-ie8/)

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2009-03-19T00:37:39.467

**2013 更新：IE10+ 不再支持条件注释。**

*原答案：*

*有些人似乎很困惑，因为这没有回答问题的文字，只有精神 - 所以为了澄清：*

没有浏览器选择器之类的东西。有一些黑客可以利用特定浏览器的 CSS 解析器中的错误和/或故障，但依赖这些会导致自己失败。有一种标准的、公认的方法来处理这个问题：

使用[条件注释](http://msdn.microsoft.com/en-us/library/ms537512.aspx)仅针对 IE。

例子：

```
<!--[if gte IE 8]>
<style>
(your style here)
</style>
<![endif]--> 
```

两者里面的所有内容`<!-->`都会被所有非IE浏览器作为注释忽略，低于IE8的IE版本会跳过。只有 IE8 和更高版本会处理它。**2013 更新：** IE10+ 也将忽略它作为评论。

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-04-29T20:15:34.170

看看这些：

```
/* IE8 Standards-Mode Only */
.test { color /*\**/: blue\9 }

/* All IE versions, including IE8 Standards Mode */
.test { color: blue\9 } 
```

（来源：[David Bloom 针对 IE8 标准模式的 CSS hack](http://my.opera.com/dbloom/blog/2009/03/11/css-hack-for-ie8-standards-mode)）

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2011-10-25T08:55:23.857

你可以这样使用。这比

```
<link rel="stylesheet" type="text/css" media="screen" href="css/style.css" />
<!--[if IE 7]><link rel="stylesheet" type="text/css" media="screen" href="css/ie7.css"  /><![endif]-->
<!--[if IE 6]><link rel="stylesheet" type="text/css" media="screen" href="css/ie6.css"  /><![endif]-->
-------------------------------------------------------------

<!--[if lt IE 7 ]> <body class="ie6"> <![endif]-->
  <!--[if IE 7 ]> <body class="ie7"> <![endif]-->
  <!--[if IE 8 ]> <body class="ie8"> <![endif]-->
  <!--[if !IE]>--> <body> <!--<![endif]--> 
```

div.foo { 颜色：继承；} .ie7 div.foo { 颜色：#ff8000; }

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2012-04-30T23:25:27.110

基于 image72 的出色答案，您实际上可以拥有像这样的高级 CSS 选择器：

```
<!--[if lt IE 7]><body class="IE IE7down IE8down IE9down IE10down"><![endif]-->
<!--[if IE 7]><body class="IE IE7 IE7down IE8down IE9down IE10down IE7up"><![endif]-->
<!--[if IE 8]><body class="IE IE8 IE8down IE9down IE10down IE7up IE8up"><![endif]-->
<!--[if IE 9]><body class="IE IE9 IE9down IE10down IE7up IE8up IE9up"><![endif]-->
<!--[if gte IE 10]><body class="IE IE10 IE10down IE7up IE8up IE9up IE10up"><![endif]-->
<!--[if !IE]>--><body class="notIE"><!--<![endif]--> 
```

这样在你的CSS中你可以这样做：

```
.notIE   .foo { color: blue;   } /* Target all browsers except IE */
.IE9up   .foo { color: green;  } /* Taget IE equal or greater than 9 */
.IE8     .foo { color: orange; } /* Taget IE 8 only */
.IE7down .foo { color: red;    } /* Target IE equal or less than 7 */

.IE8 .foo, .IE9 .foo {
    font-size: 1.2em;            /* Target IE8 & IE9 only */
}

.bar { background-color: gray; } /* Applies to all browsers, as usual */

/* Maybe show a message only to IE users? */
.notIE #betterBrowser { display: none;  } /* Any browser except IE */
.IE    #betterBrowser { display: block; } /* All versions of IE */ 
```

这很棒，因为：

*   **它完全符合标准**（没有丑陋/危险的 css hack）
*   无需单独的样式表
*   您可以轻松定位任何版本的 IE 以及复杂的组合

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-10-26T09:23:21.957

仅适用于 IE8 的 CSS 样式：

```
.divLogRight{color:Blue; color:Red\9; *color:Blue;} 
```

只有 IE8 会是红色的。

第一个蓝色：适用于所有浏览器。

红色：仅限 IE6、7、8

第二蓝：仅限 IE6,7

* * *

所以红色 = 仅适用于 IE8。

有关浏览器黑客攻击的完整摘要（包括 Internet Explorer (IE)、Safari、Chrome、iPhone 和 Opera），请访问此链接： http: [//paulirish.com/2009/browser-specific-css-hacks/](http://paulirish.com/2009/browser-specific-css-hacks/)

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2010-04-07T21:47:12.083

这个问题很古老，但是..

在开始的身体标签之后..

```
<!--[if gte IE 8]>
<div id="IE8Body">
<![endif]--> 
```

就在结束正文标签之前..

```
<!--[if gte IE 8]>
</div>
<![endif]--> 
```

CSS..

```
#IE8Body #nav li ul {} 
```

您可以使用条件语句对所有 IE 浏览器执行此操作，或者通过使用浏览器名称 + 版本服务器端将所有内容封装在 div 中来定位所有浏览器

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2010-09-23T18:37:10.217

我有一个解决方案，我只在必要时使用，在我构建了有效的 html 和 css 并在大多数浏览器中工作之后，我偶尔会使用来自 Rafael Lima 的这个惊人的 javascript 进行破解。[http://rafael.adm.br/css_browser_selector/](http://rafael.adm.br/css_browser_selector/)

它使我的 CSS 和 HTML 保持有效和干净，我知道这不是理想的解决方案，使用 javascript 来修复黑客，但只要你的代码最初尽可能接近（愚蠢的 IE 有时会破坏东西）然后移动一些 px使用 javascript 并没有一些人想象的那么重要。再加上时间/成本的原因，这是一个快速简单的解决方案。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2009-04-27T12:47:45.230

在 ASP.NET 世界中，我倾向于使用内置的 BrowserCaps 功能将一组类写到 body 标记上，使您能够定位浏览器和平台的任意组合。

所以在预渲染中，我会运行类似这样的代码（假设你给你的标签一个 ID 并让它在服务器上运行）：

```
HtmlGenericControl _body = (HtmlGenericControl)this.FindControl("pageBody");
_body.Attributes.Add("class", Request.Browser.Platform + " " + Request.Browser.Browser + Request.Browser.MajorVersion); 
```

此代码使您能够在 CSS 中定位特定浏览器，如下所示：

```
.IE8 #nav ul li { .... }
.IE7 #nav ul li { .... }
.MacPPC.Firefox #nav ul li { .... } 
```

我们创建了 System.Web.UI.MasterPage 的子类，并确保我们所有的母版页都继承自我们专门的 MasterPage，以便每个页面都免费添加这些类。

如果您不在 ASP.NET 环境中，则可以使用 jQuery，它有一个浏览器插件，可以在页面加载时动态添加相似的类名。

这种方法的好处是可以从标记中删除条件注释，并且可以将主要样式和特定于浏览器的样式保留在 CSS 文件中大致相同的位置。这也意味着您的 CSS 更具前瞻性（因为它不依赖于可能修复的错误）并帮助您的 CSS 代码更有意义，因为您只需要查看

```
.IE8 #container { .... } 
```

代替

```
* html #container { .... } 
```

或更糟！

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2014-12-05T11:05:57.210

根据不断发展的线程，请参见下文以获得更完整的答案：

## 即 6

```
* html .ie6 {property:value;} 
```

或者

```
.ie6 { _property:value;} 
```

## 即 7

```
*+html .ie7 {property:value;} 
```

或者

```
*:first-child+html .ie7 {property:value;} 
```

## IE 6 和 7

```
@media screen\9 {
    .ie67 {property:value;}
} 
```

或者

```
.ie67 { *property:value;} 
```

或者

```
.ie67 { #property:value;} 
```

## 即 6、7 和 8

```
@media \0screen\,screen\9 {
    .ie678 {property:value;}
} 
```

## 即 8

```
html>/**/body .ie8 {property:value;} 
```

或者

```
@media \0screen {
    .ie8 {property:value;}
} 
```

## 仅限 IE 8 标准模式

```
.ie8 { property /*\**/: value\9 } 
```

## 即 8,9 和 10

```
@media screen\0 {
    .ie8910 {property:value;}
} 
```

## 仅限 IE 9

```
@media screen and (min-width:0) and (min-resolution: .001dpcm) { 
 // IE9 CSS
 .ie9{property:value;}
} 
```

## IE 9 及以上

```
@media screen and (min-width:0) and (min-resolution: +72dpi) {
  // IE9+ CSS
  .ie9up{property:value;}
} 
```

## IE 9 和 10

```
@media screen and (min-width:0) {
    .ie910{property:value;}
} 
```

## 仅限 IE 10

```
_:-ms-lang(x), .ie10 { property:value\9; } 
```

## IE 10 及以上

```
_:-ms-lang(x), .ie10up { property:value; } 
```

或者

```
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
   .ie10up{property:value;}
} 
```

## IE 11（及更高版本..）

```
_:-ms-fullscreen, :root .ie11up { property:value; } 
```

* * *

## Javascript 替代品

### [现代化](http://modernizr.com/)

> Modernizr 在页面加载时快速运行以检测功能；然后它创建一个带有结果的 JavaScript 对象，并将类添加到 html 元素

### [用户代理选择](http://rog.ie/blog/html5-boilerplate-addon)

Javascript：

```
var b = document.documentElement;
        b.setAttribute('data-useragent',  navigator.userAgent);
        b.setAttribute('data-platform', navigator.platform );
        b.className += ((!!('ontouchstart' in window) || !!('onmsgesturechange' in window))?' touch':''); 
```

在元素中添加（例如）以下`html`内容：

```
data-useragent='Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C)'
data-platform='Win32' 
```

允许非常有针对性的 CSS 选择器，例如：

```
html[data-useragent*='Chrome/13.0'] .nav{
    background:url(img/radial_grad.png) center bottom no-repeat;
} 
```

* * *

## 脚注

如果可能，请避免浏览器定位。识别并修复您发现的任何问题。支持[**渐进增强**](http://en.wikipedia.org/wiki/Progressive_enhancement)和[**优雅降级**](http://en.wikipedia.org/wiki/Fault_tolerance)。考虑到这一点，这是一个“理想世界”的场景，并非总是可以在生产环境中获得，因此——上述内容应该有助于提供一些不错的选择。

* * *

### 归因/基本阅读

*   [基思·克拉克](http://keithclark.co.uk/articles/moving-ie-specific-css-into-media-blocks/)
*   [保罗爱尔兰人](http://www.paulirish.com/2009/browser-specific-css-hacks/)
*   [网络虔诚](http://www.webdevout.net/css-hacks)
*   [扳手](http://www.thespanner.co.uk/2009/01/29/detecting-browsers-javascript-hacks/)

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2010-07-07T06:04:13.430

我意识到这是一个老问题，但这是我搜索时谷歌上的第一个结果，我认为我找到了比排名最高的建议和 OP 选择做什么更好的解决方案。

```
#nav li ul:not(.stupidIE) { color:red } 
```

因此，从技术上讲，这与 OP 想要的相反，但这仅意味着您必须先将所需的规则应用于 IE8，然后再将其应用于其他所有内容。当然，您可以在 () 中放置任何内容，只要它是有效的 css，实际上并没有选择任何内容。IE8 在这条线上阻塞并且不应用它，但是以前的 IE（好吧，我只检查了 IE7，我已经不再关心 IE6），只需忽略 :not() 并应用声明。当然，其他所有浏览器（我测试过 Safari 5、Opera 10.5、Firefox 3.6）都像您期望的那样应用该 css。

所以这个解决方案，我想像任何其他纯 CSS 解决方案一样，如果 IE 开发人员添加对 :not 选择器的支持，那么他们还将修复导致您以 IE8 为目标的任何差异。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-07-22T16:19:56.360

好吧，这不是 css hack，而是因为无法找到从 css 定位 ie8 的方法而感到沮丧，并且由于没有 ie 特定 css 文件的政策，我不得不遵循，我假设其他人可能会发现有用：

```
if (jQuery.browser.version==8.0) {
   $(results).css({
         'left':'23px',
         'top':'-253px'
      });
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-12-29T21:01:25.557

\9 不适用于**font-family**，相反，您需要使用上面提到的 Chris 的“<em>\0/ !important”，例如：

```
p { font-family: Arial \0/ !important; } 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-06-21T02:08:05.057

IE8 没有任何选择器技巧。这个问题的最佳资源是[http://browserhacks.com/#ie](http://browserhacks.com/#ie)

如果你想针对特定的 IE8，你应该在 html 中做评论

```
<!--[if IE 8]> Internet Explorer 8 <![endif]--> 
```

或者您可以使用属性黑客，例如：

```
/* IE6, IE7, IE8, but also IE9 in some cases :( */
#diecinueve { color: blue\9; }

/* IE7, IE8 */
#veinte { color/*\**/: blue\9; }

/* IE8, IE9 */
#anotherone  {color: blue\0/;} /* must go at the END of all rules */ 
```

有关此检查的更多信息：http: [//www.paulirish.com/2009/browser-specific-css-hacks/](http://www.paulirish.com/2009/browser-specific-css-hacks/)

# mysql - 命令行外的mysql转储

> ID：660653
> 
> 赞同：0
> 
> 时间：2009-03-19T00:37:01.357
> 
> 标签：mysql, mysqldump

是否有任何现代编程语言支持 mysqldump 作为一种方法，或者它仍然是命令行环境的领域。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T00:57:25.973

有适用于 .NET、Delphi 和通用 ODBC/DAO 的 API（数据库驱动程序），以及适用于 C/C++ 和其他语言的库。它永远不会被直接写入主流语言本身。这将限制该语言作为通用目的，因此使其不那么有用。

例如，Delphi 有一个名为 DBExpress 的数据库框架。为 MS SQL Server、Oracle、MySQL、DB2 等提供开箱即用的 DBExpress 驱动程序；可用的驱动程序取决于您决定购买的版本（Professional、Enterprise 或 Architect）。MySQL 在所有版本中都可用。

使用 DBExpress 框架使 Delphi 可用于任何决定为其提供 DBExpress 驱动程序的数据库引擎，并且驱动程序可以用 Delphi 本身编写。这使 Delphi 更加通用；仅使用单个 RDBMS 并没有硬编码。

编辑：正如其他人所说（我认为是 Jarret），mysqldump 的来源是可用的。使用可用于您选择的语言的包装器，您应该能够基于该源实现相同的功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T01:29:21.963

如果您使用 PHP 并且不介意使用 GPL 许可证，那么[phpMyAdmin](http://www.phpmyadmin.net/home_page/index.php)包含一些用于 MySQL 转储的代码（以及其他格式，如 CSV 等）。

查看文件：

```
libraries/export/sql.php 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T01:11:01.010

你的直觉是对的……对于一个编程语言库来说，提供对 mysqldump 的 API 访问是非常困难的。mysqldump的源码是用C写的，有自己的`main()`功能；它的设计几乎可以作为自己的程序运行。它被构建为可执行文件，并且大部分错误报告和输出都是使用直接打印到标准输出的语句来处理的，而不是使用可以包装成特定语言值的返回值。

当编译特定编程语言的大多数绑定（PHP、python、Delphi、.NET 等）时，它们链接到`libmysql`，并且 libmysql 不包含对 mysqldump 程序的引用。我不能肯定地说没有人写过包装器，但它确实是一个非常奇怪的包装器。

换句话说，您最好的选择是使用您选择的编程语言中的子进程来调用 mysqldump 工具，并从标准输入或临时文件中吸收结果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T01:53:33.887

你的问题比较模糊。请描述您想要完成什么，以及您已经尝试过什么。

话虽如此，如果您想以 mysqldump 的方式生成 MySQL 数据库的 DB 转储，我知道没有任何 API 可以直接实现。但是还有许多其他的转储/备份数据库的方法，并且 mysqldump 格式有它的问题（对于一件事没有很好的定义，因此不容易解析）。因此，您可能会考虑另一种方法。

# c# - 可以在基类的方法中使用抽象属性值吗？

> ID：660656
> 
> 赞同：1
> 
> 时间：2009-03-19T00:37:47.080
> 
> 标签：c#

如果我在我的 C# Base 类中创建一个抽象属性，然后一个子类实现它，那么一旦子类设置了该属性，是否可以稍后在我的 Base 类的方法之一中引用和使用该属性？

我想将一个值从我的子类传递到基类，以便在我的基类中我可以在该基类方法中使用它执行一些逻辑。

甚至不是属性而是字段...相同的想法...但是如果情况如此，我需要将该字段设置在子类中...不认为这是可能的吗？如果我可以通过抽象字段在我的子类中设置某种标志，那么我真的不需要属性，以便基类可以将该标志用于我的子类将依赖的某些逻辑，例如发送 HttpRequest。

基本上，我希望能够使用这个基类在任何子类中设置一个标志来表示真或假，以便基类的 SendRequest 方法知道是否从我在基类中设置的几个 URI 中进行选择。该标志将确定在基类的 SendRequest 方法中使用哪种格式，因为每个子类在基类应用于该子类的 URI 格式方面会有所不同，以便代表子类发送 HttpRequest。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-19T00:39:42.987

是的，这基本上是抽象属性和方法的全部目的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T00:47:13.530

听起来像这样的东西会起作用：

```
class Base
{
    protected Boolean Flag { get; set; }

    public void Foo()
    {
        if (this.Flag)
        {
            // logic here
        }
    }
}

class Child : Base
{
    public Child()
    {
        // you can set Flag anywhere you wish
        this.Flag = true;
    }
} 
```

我不认为你需要任何东西`abstract`。您可以`Flag`在子类型中设置，然后在任一类型中检查条件逻辑。

# c# - 从 C# 中的完整文件路径解析目录名称

> ID：660657
> 
> 赞同：35
> 
> 时间：2009-03-19T00:37:50.417
> 
> 标签：c#, file

如果我有一个字符串变量：

```
"C:\temp\temp2\foo\bar.txt" 
```

我想得到

**“富”**

做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：76
> 
> 时间：2009-03-19T00:40:07.120

采用：

```
new FileInfo(@"C:\temp\temp2\foo\bar.txt").Directory.Name 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-19T04:40:22.800

我完全不同意飞碟，但我一直使用

```
Path.GetFileNameWithoutExtension(@"C:\temp\temp2\foo\bar.txt") 
```

我怀疑 FileInfo 实际上会触及文件系统以获取它的信息，而我希望 GetFileNameWithoutExtension 只是字符串操作 - 所以一个优于另一个的性能可能会更好。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-07-24T10:19:03.590

我认为最简单的解决方案是

```
DirectoryInfo dinfo = new DirectoryInfo(path);

字符串文件夹名称= dinfo.Parent.Name；

```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-02-18T15:53:09.303

根据 Handleman 的建议，您可以执行以下操作：

```
Path.GetFileName(Path.GetDirectoryName(path)) 
```

这不会触及文件系统（与 不同`FileInfo`），并且会执行所需的操作。这将适用于文件夹，因为正如[MSDN](https://msdn.microsoft.com/en-us/library/system.io.path.getfilename(v=vs.110).aspx)所说：

> **返回值：**路径中最后一个目录字符之后的字符。如果 path 的最后一个字符是目录或卷分隔符，则此方法返回 String.Empty。如果 path 为 null，则此方法返回 null。

此外，查看[参考源](http://referencesource.microsoft.com/#mscorlib/system/io/path.cs,95facc58d06cadd0)确认`GetFilename`不关心传入的路径是文件还是文件夹：它只是在进行纯字符串操作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-10-09T12:19:32.040

我有一次循环浏览父子目录

```
string[] years = Directory.GetDirectories(ROOT);
foreach (var year in years)
{
    DirectoryInfo info = new DirectoryInfo(year);
    Console.WriteLine(info.Name);
    Console.WriteLine(year);
    //Month directories
    string[] months = Directory.GetDirectories(year);
    foreach (var month in months)
    {
        Console.WriteLine(month);
        //Day directories
        string[] days = Directory.GetDirectories(month);
        foreach (var day in days)
        {
            //checkes the files in the days
            Console.WriteLine(day);
            string[] files = Directory.GetFiles(day);
            foreach (var file in files)
            {
                Console.WriteLine(file);                               
            }
        }
    }
} 
```

使用这一行，我只能获得当前目录名称

```
DirectoryInfo info = new DirectoryInfo(year);
Console.WriteLine(info.Name); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-10T19:07:49.710

这取决于您要如何处理数据，但另一种选择是使用 String.Split。

```
string myStr = @"C:\foo\bar.txt";
string[] paths = myStr.Split('\\');
string dir = paths[paths.Length - 2]; //returns "foo" 
```

这不会检查数组越界异常，但您明白了。

# c# - C# 在拖放时在 ListView 中实现自动滚动

> ID：660663
> 
> 赞同：5
> 
> 时间：2009-03-19T00:39:14.160
> 
> 标签：c#, winforms, listview, drag-and-drop, scroll

如何在 Winforms ListView 中实现自动滚动（例如，当您靠近顶部或底部时，ListView 滚动）？我在谷歌上四处搜寻，运气不佳。我不敢相信这不是开箱即用的！提前感谢戴夫

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-19T22:38:41.360

感谢您的链接（[http://www.knowdotnet.com/articles/listviewdragdropscroll.html），IC#ised](http://www.knowdotnet.com/articles/listviewdragdropscroll.html)

```
class ListViewBase:ListView
{
    private Timer tmrLVScroll;
    private System.ComponentModel.IContainer components;
    private int mintScrollDirection;
    [DllImport("user32.dll", CharSet = CharSet.Auto)]
    private static extern int SendMessage(IntPtr hWnd, int wMsg, IntPtr wParam, IntPtr lParam);
    const int WM_VSCROLL = 277; // Vertical scroll
    const int SB_LINEUP = 0; // Scrolls one line up
    const int SB_LINEDOWN = 1; // Scrolls one line down

    public ListViewBase()
    {
        InitializeComponent();
    }
    protected void InitializeComponent()
    {
        this.components = new System.ComponentModel.Container();
        this.tmrLVScroll = new System.Windows.Forms.Timer(this.components);
        this.SuspendLayout();
        // 
        // tmrLVScroll
        // 
        this.tmrLVScroll.Tick += new System.EventHandler(this.tmrLVScroll_Tick);
        // 
        // ListViewBase
        // 
        this.DragOver += new System.Windows.Forms.DragEventHandler(this.ListViewBase_DragOver);
        this.ResumeLayout(false);

    }

    protected void ListViewBase_DragOver(object sender, DragEventArgs e)
    {
        Point position = PointToClient(new Point(e.X, e.Y));

        if (position.Y <= (Font.Height / 2))
        {
            // getting close to top, ensure previous item is visible
            mintScrollDirection = SB_LINEUP;
            tmrLVScroll.Enabled = true;
        }else if (position.Y >= ClientSize.Height - Font.Height / 2)
        { 
            // getting close to bottom, ensure next item is visible
            mintScrollDirection = SB_LINEDOWN;
            tmrLVScroll.Enabled = true;
        }else{
            tmrLVScroll.Enabled = false;
        }
    }

    private void tmrLVScroll_Tick(object sender, EventArgs e)
    {
        SendMessage(Handle, WM_VSCROLL, (IntPtr)mintScrollDirection, IntPtr.Zero);
    }
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2015-12-08T16:23:42.610

可以使用[ListViewItem.EnsureVisible](https://msdn.microsoft.com/en-us/library/system.windows.forms.listviewitem.ensurevisible(v=vs.110).aspx)方法完成滚动。您需要确定您当前拖过的项目是否位于列表视图的可见边界，并且不是第一个/最后一个。

```
private static void RevealMoreItems(object sender, DragEventArgs e)
{
    var listView = (ListView)sender;

    var point = listView.PointToClient(new Point(e.X, e.Y));
    var item = listView.GetItemAt(point.X, point.Y);
    if (item == null)
        return;

    var index = item.Index;
    var maxIndex = listView.Items.Count;
    var scrollZoneHeight = listView.Font.Height;

    if (index > 0 && point.Y < scrollZoneHeight)
    {
        listView.Items[index - 1].EnsureVisible();
    }
    else if (index < maxIndex && point.Y > listView.Height - scrollZoneHeight)
    {
        listView.Items[index + 1].EnsureVisible();
    }
} 
```

然后将此方法连接到 DragOver 事件。

```
targetListView.DragOver += RevealMoreItems;

targetListView.DragOver += (sender, e) =>
{
    e.Effect = DragDropEffects.Move;
}; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-13T10:27:31.057

看看[ObjectListView](http://objectlistview.sourceforge.net)。它做这些事情。如果您不想使用 ObjectListView 本身，可以阅读代码并使用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-04-05T16:15:28.320

只是给未来的 googlers 的一个注释：要让它在更复杂的控件（例如 DataGridView）上工作，请参阅[这个线程](https://stackoverflow.com/questions/2567809/how-to-autoscroll-a-datagridview-during-drag-and-drop)。

# c++ - iostream 和大文件支持

> ID：660667
> 
> 赞同：7
> 
> 时间：2009-03-19T00:41:26.477
> 
> 标签：c++, stl, iostream, large-files, large-file-support

我试图找到一个明确的答案，但不能，所以我希望有人可能知道。

我正在 Linux（32 位操作系统）上使用 GCC 4.x 开发 C++ 应用程序。此应用程序需要能够读取大小 > 2GB 的文件。

我真的很想使用 iostream 的东西与 FILE 指针，但我找不到大文件 #defines (_LARGEFILE_SOURCE, _LARGEFILE64_SOURCE, _FILE_OFFSET_BITS=64) 是否对 iostream 标头有任何影响。

我在 32 位系统上编译。任何指针都会有所帮助。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-19T01:23:14.273

这在编译时已经为您确定了`libstdc++`，通常取决于是否`_GLIBCXX_USE_LFS`在`c++config.h`.

如果有疑问，请通过（或通过）传递您的可执行文件（或者`libstdc++.so`，如果动态链接它）并查看您的二进制文件/是否链接到/ /etc。或/ /等。`readelf -r``strings``libstdc++``fopen``fseek``fopen64``fseek64`

**更新**

只要您不需要/尝试`fseek`或`ftell`（您只需读取或写入流），您就不必担心 2GB 的限制。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T02:08:31.013

*如果您使用的是 GCC，则可以利用名为 __gnu_cxx:: stdio_filebuf*的 GCC 扩展，它将 IOStream 绑定到标准 C文件描述符。

您需要定义以下两件事：

> _LARGEFILE_SOURCE
> 
> _FILE_OFFSET_BITS=64

例如：

```
#include <cstdio>
#include <fstream>
#include <ext/stdio_filebuf.h>

int main()
{
  std::ofstream outstream;
  FILE* outfile;

  outfile = fopen("bigfile", "w");

  __gnu_cxx::stdio_filebuf<char> fdbuf(outfile, std::ios::out |
                                       std::ios::binary);
  outstream.std::ios::rdbuf(&fdbuf);

  for(double i = 0; i <= 786432000000.0; i++) {
    outstream << "some data";

  fclose(outfile);
  return 0; 
```

}

# windows - 获取子窗口的屏幕截图

> ID：660676
> 
> 赞同：0
> 
> 时间：2009-03-19T00:47:15.683
> 
> 标签：windows, winforms, screenshot, childwindow

如果我有一个窗口的句柄，当它们出现时如何截取任何新的子窗口？现在我的代码每 0.1 秒截取一个窗口窗体的屏幕截图。当我单击下拉列表框时，随后的屏幕截图不包括它。使用 spy++ 我可以看到创建了一个新的子窗口，但不确定如何确保它包含在我的屏幕截图中。有人有任何可能包含子窗口的代码吗？

提前致谢，

鲍勃

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T13:51:58.963

是的，ComboBox 的下拉菜单是一个特殊的窗口，一个 LISTBOX。.NET 没有提供获取句柄的内置方法，您可以 P/Invoke SendMessage 并发送 CB_GETCOMBOBOXINFO 消息。COMBOBOXINFO.hwndList 包含句柄。

请注意，还有其他控件的行为方式，例如 DateTimePicker。另请注意，窗口可以超出表单的范围。

[此线程](http://social.msdn.microsoft.com/Forums/en-US/winforms/thread/e234c4a7-0cf7-4284-a072-8152f7593002/)中的代码应该有助于正确执行 P/Invoke。

# javascript - 匹配最多 2 位小数的数字的正则表达式

> ID：660682
> 
> 赞同：10
> 
> 时间：2009-03-19T00:50:34.617
> 
> 标签：javascript, regex

我正在使用一个正则表达式，它将匹配最多包含用户定义的小数位数的数值。目前我有

```
/(^-?\d\d*\.\d*$)|(^-?\d\d*$)|(^-?\.\d\d*$)/ 
```

这将允许与输入一样多的地方，但我有时也希望允许 2 个用于货币或 4 个或更多用于其他输入。我正在构建的功能是

```
var isNumeric = function(val, decimals) {
    // decimals is not used yet
    var objRegExp = /(^-?\d\d*\.\d*$)|(^-?\d\d*$)|(^-?\.\d\d*$)/;
    return objRegExp.test(val);
}; 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-19T00:59:31.677

```
/^\s*-?[1-9]\d*(\.\d{1,2})?\s*$/ 
```

原谅空格 (\s) 是件好事。以上不允许从零开始。如果你想允许：

```
/^\s*-?\d+(\.\d{1,2})?\s*$/ 
```

以上都不允许小数点前没有任何内容的十进制数。如果你想允许：

```
/^\s*-?(\d+(\.\d{1,2})?|\.\d{1,2})\s*$/ 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-19T00:53:39.583

尝试这样的事情：

> `^\d+\.\d{0,3}$`

其中“3”是允许的最大小数位数。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-20T14:17:16.983

如果最后一位数字是“。”，则添加该 0。不涵盖点后空格的情况。

我认为这涵盖了所有情况，但你会想要比我在这里更严格地测试它。

```
var isNumeric = function(val, decimals) {
    if (decimals <= 0) {
        var re = /^\s*\d+\.?\s*$/;
        return re.test(val);
    } else {
        var reString = "^\\s*((\\d+(\\.\\d{0," + decimals + "})?)|((\\d*(\\.\\d{1," + decimals + "}))))\\s*$"
        var re = new RegExp(reString);
        return re.test(val);
    }
};

var test = function(val, decimals) {
    document.write("isNumeric(" + val + ", " + decimals + ") = " + isNumeric(val, decimals) + "<br/>");
}

test("123", 0);
test("123", 5);
test(" 123.45", 2);
test(" 123.45", 3);
test(" 123.45", 1);
test(" ", 0);
test(" ", 5);
test(" 3.", 0);
test(" 3.", 12);
test(" .", 3);
test(" .321 ", 5); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-19T01:41:53.573

我是一个 C# 人，但我发现像C# 或[RegexPal](http://regexpal.com/)[的调节器](http://sourceforge.net/projects/regulator/)这样的工具在尝试将 Regex 调整为“恰到好处”时非常有用。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-19T02:56:25.063

谢谢大家。我从所有答案中都使用了一些。

```
var isNumeric = function(val, decimalPlaces) {
    // If the last digit is a . then add a 0 before testing so if they type 25\. it will be accepted
    var lastChar = val.substring(val.length - 1);
    if (lastChar == ".") val = val + "0";

    var objRegExp = new RegExp("^\\s*-?(\\d+(\\.\\d{1," + decimalPlaces + "})?|\\.\\d{1," + decimalPlaces + "})\\s*$", "g");
    if (decimalPlaces == -1)
        objRegExp = new RegExp("^\\s*-?(\\d+(\\.\\d{1,25})?|\\.\\d{1,25})\\s*$", "g");

    return objRegExp.test(val);        
}; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-10-09T11:02:24.557

试试这个正则表达式，它对我来说很好：

```
^\d+\.\d{0,2}$ 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-19T01:32:42.253

这应该匹配最多两位小数的整数和小数。

```
/\A[+-]?\d+(?:\.\d{1,2})?\z/ 
```

**注意：** 将“{1,2}”中的“2”更改为您想要支持的任何小数位数。

我知道这不是您的问题的一部分，但是您也可以在没有正则表达式的情况下做到这一点。这是一种解决方案：

```
var isNumeric = function( val, decimals ) {
    if ( parseFloat( val ) ) {
        var numeric_string = val + '';
        var parts = numeric_string.split( '.', 1 );
        if ( parts[1] && parts[1].length > decimals ) {
            alert( 'too many decimal places' );
        }
        else {
            alert( 'this works' );
        }
    }
    else {
        alert( 'not a float' );
    }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-03-01T11:23:02.587

使用此模式：

```
[0-9]?[0-9]?(\.[0-9][0-9]?)? 
```

# regex - 非正则上下文无关语言和无限正则子语言

> ID：660683
> 
> 赞同：3
> 
> 时间：2009-03-19T00:51:28.513
> 
> 标签：regex, nlp, context-free-grammar

我为大学做了一份工作，基本上说：

“证明非正则语言 L={0^n 1^n : n natural} 没有无限的正则子语言。”

我通过矛盾证明了这一点。我基本上说有一种语言 S 是 L 的子语言，它是一种常规语言。因为 S 可能的正则表达式是 0*、1*、(1+0)* 和 (0o1)*。我检查每个语法并证明它们都不是语言 L 的一部分。

但是，我如何证明任何非常规上下文无关语言都不能包含任何常规无限子语言？

我不想要证明本身，我只想指出正确的方向。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T01:15:41.653

[对于 0^n 1^n 语言，研究抽水引理](http://en.wikipedia.org/wiki/Pumping_lemma "通过维基百科抽取引理")可能很有价值。 我认为当我学习泵引理时，它被用于 a^nb^n 语言（同样的事情。）可能泵引理可能有助于您的证明。

您也可以认为常规语言在补码、并集、交集和 kleene 星号下是封闭的。

也就是说，如果 L1 和 L2 是规则的，那么：

```
L1 L2 (concatenation) is also regular.
L1 n L2 is regular
L1 U L2 is regular
¬L1 is regular 
L1* is regular 
```

通过使用其中一些规则，您可以证明任何包含常规无限子语言的语言都是常规的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T05:45:41.927

L = {0^n 1^n : n natural} 是非常规上下文无关的。

M = 2*3* 是无限规则的。

N = L∪M 是非常规上下文无关的。N 包含 M。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T05:32:14.220

你的直觉很好。这里有两件事。

首先，几乎总是当问题采用“表明 L 不是正则/非 CF”的形式时，答案将涉及使用抽水引理。同样，当您收到诸如“表明没有 X ……”之类的问题时，简单的方法（几乎总是）将成为矛盾的证明。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T01:19:40.553

编辑：虚假陈述，仅适用于上下文无关语言

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T01:53:56.867

由于您只需要提示（谢天谢地，因为我从大学起就忘记了如何做证明），请查看[常规语言的定义及其具有的](http://en.wikipedia.org/wiki/Regular_language)属性。只是从那里看，我有足够的信息来证明这一说法。

# c# - 保存文件并自动创建目录

> ID：660685
> 
> 赞同：23
> 
> 时间：2009-03-19T00:51:54.580
> 
> 标签：c#, winforms, file

我正在连接许多变量，我想将该字符串保存为文件路径。

有没有一种方法，如果它们不存在，它会自动创建所有适当的目录，而不必检查每个目录的“是否存在”

例如。

```
"C:\" + a + "\" + b+ "\" + d + "\" + d + ".txt" 
```

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-03-19T00:54:40.190

使用`new FileInfo(path).Directory.Create()`.

（这会在层次结构中创建所需的任何内容。如果目录已经存在，它什么也不做。）

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-19T00:57:03.697

```
 using System.IO;
....
Directory.CreateDirectory(@"c:\temp\a\b\c\d\e"); 

```

# c# - C#当托盘图标不在同一个表单上时，如何将上下文菜单分配给托盘图标？

> ID：660713
> 
> 赞同：0
> 
> 时间：2009-03-19T01:03:28.733
> 
> 标签：c#, controls

我使用下面的代码以编程方式创建系统托盘图标，此代码位于类文件中，而不是在我的主窗体中。我已将 contextMenuStrip 控件拖到我的主窗体上，现在我需要将两者链接起来，但如果是私有的控件，我看不到它。将这两者联系起来的最佳方式是什么？

```
trayIcon = new NotifyIcon();
trayIcon.Icon = mainForm.Icon;
trayIcon.Text = "Test";
trayIcon.MouseDoubleClick += new MouseEventHandler(this.trayIcon_MouseDoubleClick);
trayIcon.ContextMenuStrip = //help needed here??? 
```

谢谢大家

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T01:16:22.633

您可以将 contextMenuStrip 的 Modifiers 属性设置为 public。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T01:18:38.603

没有什么能阻止你将主窗体上的 contextMenuStrip 公开，除了它的纯粹肮脏。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T02:30:19.947

如果您担心公开实际的 ContextMenuStrip 字段，为什么不提供一个非私有只读字段。这仍将在您的主表单对象中保持一定程度的封装。

```
public class MainForm { ...
  public ContextmenuStrip MyMenuStrip { 
    get { return contextMenuStrip; }
  }
} 
```

然后您可以访问 mainForm.MyMenuStrip 以获取托盘图标。

# project-management - 基于 Web 的应用程序的端到端软件开发周期？

> ID：660725
> 
> 赞同：0
> 
> 时间：2009-03-19T01:08:57.397
> 
> 标签：project-management, process, methodology, software-quality

我们正在寻找通过适当的文档进一步改进我们的软件开发过程的方法。但是，作为文档，这些文档/规范仅在我们打开和阅读时才可用。

例如，URS、SRS、ERD、DB 图、类图、用例、测试脚本、用户手册和培训材料通常是单独的文档。

有没有人在一个基于 Web 的系统中完成所有这些工作？

首先将所有需求键入系统，然后就可以轻松生成 URS。每当需求发生任何变化时，都必须将其输入系统，但可以轻松生成。

最重要的部分是可追溯性，在这里我们可以看到需求是如何实现的。有时，它们在 URS 中，但一直丢失，因为很难手动比较/检查它。很多时候不同的人做不同的过程，所以事情可能会不小心遗漏。例如，一个函数可能存在于系统和测试脚本中，但不存在于用户手册中。

我会想象过程中任何部分的任何更改都没有完全实施，因此可以采取行动。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-04-21T06:24:34.247

如果您使用敏捷方法，Collabnet 的 TeamForge 会有所帮助。网址： http: [//www.collab.net/downloads/ctf/](http://www.collab.net/downloads/ctf/)

Teamforge 建立在 SVN 之上，因为它是主干，并且具有您在敏捷项目中寻找的许多功能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-09-23T21:00:02.577

我建议使用许多**Wiki 系统**之一（通常使用跟踪器收集）来获取文档。很好的例子是：Trac、Redmine 和（商业）FogBugz、Jira。

您可以从工单中引用 wiki，从而允许

*   简单的信息流：规范 -> 实施团队
*   搜索能力
*   文档版本控制
*   ...

这些解决方案**在线工作**，不需要特殊的本地软件。

您可以使用相关的工单 ID 参考来跟踪规范说明和更改请求。稍后检查**为什么要**引入一些更改会更容易。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T01:16:29.047

您是否看过 Rational/IBM 的[Requisite Pro](http://www-01.ibm.com/software/awdtools/reqpro/)，我们公司经历了一个寻找需求管理套件的过程，最终选择了那个。最后，我们实现了对所有文档使用 Wiki，对所有功能进行编号的主电子表格，以及将功能交叉引用到其错误计数和烧毁的 Access DB，这是一个非常手动的过程，但它与项目经理一起工作得非常好谁有一些编码经验。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T01:23:19.873

我们使用[狮身人面像](http://sphinx.pocoo.org/)。

该文档与代码一起位于存储库中。

该文档包括通过 Sphinx`.. addmodule`命令的代码引用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T01:28:21.343

我们使用[XPlanner](http://www.xplanner.org/)。它主要面向 Xtreme Programming 中的迭代，但我们也将其用作需求规划工具。您可以向“故事”（= XP 中的功能）添加自由格式的注释，它们只是 wiki 页面（加上文件附件）。您还可以估计时间、创建任务等。

或者你可以只使用维基。其中有很多。我更喜欢像 wiki 这样的“自由形式”的东西，而不是提供/强制特定工作流程的东西，因为规划通常不会严格遵循特定的工作流程。（是好是坏是另外一回事……）

# python - Python：装饰器特定参数（与包装函数无关）？

> ID：660727
> 
> 赞同：6
> 
> 时间：2009-03-19T01:11:03.070
> 
> 标签：python, decorator

我正在寻找一个缓存装饰器，它给定一个函数将函数的结果缓存到装饰中指定的位置。像这样的东西：

```
@cacheable('/path/to/cache/file')
def my_function(a, b, c):
    return 'something' 
```

装饰器的参数与它包装的函数的参数完全分开。我已经看过很多例子，但我不太明白如何做到这一点 - 是否有可能为装饰器提供一个与包装函数无关且未传递给包装函数的参数？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-19T01:22:45.193

这个想法是你的装饰器是一个返回装饰器的函数。

**首先**编写你的装饰器，就好像你知道你的参数是一个全局变量一样。让我们这样说：

-

```
def decorator(f):
  def decorated(*args,**kwargs):
      cache = Cache(cachepath)
      if cache.iscached(*args,**kwargs):
          ...
      else:
          res = f(*args,**kwargs)
          cache.store((*args,**kwargs), res)
          return res
  return decorated 
```

**然后编写一个以cachepath**作为参数的函数并返回你的装饰器。

-

```
def cache(filepath)
    def decorator(f):
      def decorated(*args,**kwargs):
          cache = Cache(cachepath)
          if cache.iscached(*args,**kwargs):
              ...
          else:
              res = f(*args,**kwargs)
              cache.store((*args,**kwargs), res)
              return res
      return decorated
    return decorator 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-19T01:25:48.913

是的。如您所知，装饰器是一个函数。当写成表格时：

```
def mydecorator(func):
   def wrapper(*args, **kwargs):
       return func(*args, **kwargs)
   return wrapper

@mydecorator
def foo(a, b, c):
    pass 
```

传递给的参数`mydecorator`是函数`foo`本身。

当装饰器接受一个参数时，调用`@mydecorator('/path/to')`实际上将首先使用'/path/to'调用mydecorator函数。然后调用的结果`mydecorator(path)`将被调用来接收函数`foo`。您正在有效地定义一个动态包装函数。

简而言之，您需要另一层装饰器功能。

这是这个有点愚蠢的例子：

```
def addint(val):
    def decorator(func):
        def wrapped(*args, **kwargs):
            result = func(*args, **kwargs)
            return result + val
        return wrapped # returns the decorated function "add_together"
     return decorator # returns the definition of the decorator "addint"
                      # specifically built to return an extra 5 to the sum

@addint(5)
def add_together(a, b):
    return a + b

print add_together(1, 2)
# prints 8, not 3 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-19T02:11:19.133

保罗的回答很好，我会移动缓存对象，这样就不需要每次都构建它，并设计你的缓存，以便在缓存未命中时引发 KeyError：

```
def 缓存（文件路径）：
    def 装饰器（f）：
        f._cache = 缓存（缓存路径）
        def 装饰（*args，**kwargs）：
            尝试：
                键 = (args, kwargs)
                res = f._cache.get(key)
            除了 KeyError：
                res = f(*args, **kwargs)
                f._cache.put(key, res)
            返回资源
        返回装饰
    返回装饰器

```

# wpf - WPF 没有来自 RichTextBox 中的控件的事件

> ID：660730
> 
> 赞同：2
> 
> 时间：2009-03-19T01:11:46.640
> 
> 标签：wpf, focus, richtextbox

我正在使用 WPF，并且在 RichTextBox 控件中有一个表格。我需要获取表格单元格的背景颜色以更改它获得焦点。我的问题是我无法让 GotFocus 或任何其他事件为 TableCell 触发。

```
<RichTextBox>
    <FlowDocument>
       <Table>
           <Table.Columns> 
              <TableColumn />
           </Table.Columns>
           <TableRowGroup>
               <TableRow>
                   <TableCell GotFocus="SelectionCell_GotFocus">
                       <Paragraph>1</Paragraph>
                   </TableCell>
               </TableRow>
           </TableRowGroup>
       </Table>
    </FlowDocument>
</RichTextBox> 
```

下图显示了 RichTextBox 控件中的表格。我想做的是在用户在表格单元格之间移动时更改背景。

[替代文字 http://img16.imageshack.us/img16/8151/wpftable.png](http://img16.imageshack.us/img16/8151/wpftable.png)

编辑：经过更多调查，问题不仅限于 RichTextBox 中的表格，RichTextBox 中的任何控件似乎都无法生成事件。我在其中放置了一个按钮，但无法让它触发其 Click 事件。看起来 RichTextBox 屏蔽了所有事件，希望有办法取消屏蔽它们。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T23:54:00.273

一半的答案是将 RichTextBox 上的 IsDocumentEnabled 属性设置为 true。这允许根据[RichTextBox 中的嵌入式 UI 元素](http://social.msdn.microsoft.com/forums/en-US/wpf/thread/5372c48e-3040-4312-8263-59616e6728a8/)启用其中的控件。不幸的是，这仍然不会触发我需要的事件，即 TableCell 上的 GotFocus，尽管可以通过在单元格中放置一个按钮并单击它来触发该事件。这会将 GotFocus 事件从 UI 树中冒泡到 TableCell。我不想在每个单元格中都有一个按钮，但现在是时候寻找替代解决方案了。

```
<RichTextBox IsDocumentEnabled="True">
    <FlowDocument>
        <Table>
            <Table.Columns> 
                <TableColumn />
            </Table.Columns>
            <TableRowGroup>
                <TableRow>
                    <TableCell GotFocus="SelectionCell_GotFocus">
                        <BlockUIContainer>
                            <Canvas>
                                <Button Click="Button_Click">
                                    Click
                                </Button>
                            </Canvas>
                        </BlockUIContainer>
                    </TableCell>
                </TableRow>
            </TableRowGroup>
        </Table>
    </FlowDocument>
</RichTextBox> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-04T23:26:00.400

**更新**

*我确实找到了以下内容（在：[http](http://www.databaseforum.info/8/504107.aspx) : //www.databaseforum.info/8/504107.aspx）尝试并且它有效：*

ContentElement 是 Paragraph 的基类之一，顺便说一下，文档中几乎所有内容的基类定义了您要查找的属性和事件。

在代码中

```
void MyCode() 
{
    Paragraph p = new Paragraph();
    p.MouseEnter += p_MouseEnter;
}

void p_MouseEnter(object sender, EventArgs e) 
{
    Paragraph p = (Paragraph)sender;
    p.Background = Brushes.Red;
}

**In Markup**

<Paragraph MouseEnter="p_MouseEnter" />

**You can also trigger on properties like IsMouseOver in styles** 
```

# java - 绑定到Tomcat中的套接字

> ID：660732
> 
> 赞同：2
> 
> 时间：2009-03-19T01:13:57.930
> 
> 标签：java, sockets, tomcat

我正在编写一个 Tomcat 应用程序。作为其功能的一部分，它需要在某些事件发生时发送 UDP 多播。现在我的代码是这样的（主机和组是假的，异常处理被撕掉以节省空间）：

```
import java.net.*;
/* ..... */
DatagramSocket socket = new DatagramSocket(12345);
InetAddress group = InetAddress.getByName("111.222.333.444");
DatagramPacket packet = new DatagramPacket(buf, buf.length, group, 12346);
socket.send(packet); 
```

当我将它安装到 tomcat 时，这工作正常；但是，当我尝试安装新版本的应用程序（使用“ant remove;ant install;”）时，我无法绑定到套接字，并得到一个`java.net.BindException: Address already in use`. 唯一的出路就是每次都重启Tomcat，这显然是不能接受的。如何以对 Tomcat 友好的方式使用套接字？

根据皮特的回答，有几点澄清：

我不关闭套接字；它住在单例中。添加一个可以关闭Singleton的套接字并在servlet的destroy中调用它的方法，谢谢！我认为这有点 hacky（通过公共方法向世界公开这样的方法），但它完成了工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T01:51:41.160

通过断开（）/关闭（）使用它后，您是否关闭了套接字？套接字的生命周期是什么——每个请求还是单例？如果是每个请求，关闭套接字应该释放它。如果是单例，您需要以某种方式在“ant remove”上关闭它 - 如果关闭/重新启动 Tomcat 是不可接受的，那么您的 ant 脚本可能会调用一些安全页面等来关闭套接字。如果您可以导致关闭重启，则在 servlet 的 destroy() 方法中关闭套接字。

# java - 在线读取/写入/存储少量数据的最佳位置是什么？

> ID：660734
> 
> 赞同：0
> 
> 时间：2009-03-19T01:14:02.563
> 
> 标签：java, csv, storage

我希望能够以 CSV 格式在线存储、检索和修改少量文本数据 (< 2 mb)。我应该使用什么服务才能以编程方式（在 Java 中）执行此操作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T01:24:14.627

你可以试试谷歌的 App Engine。 [http://code.google.com/appengine/docs/whatisgoogleappengine.html](http://code.google.com/appengine/docs/whatisgoogleappengine.html)

还有亚马逊 S3。 [http://aws.amazon.com/s3/](http://aws.amazon.com/s3/)

我知道一些开源人员使用这些工具来存储在线持久数据以达到有用的效果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-25T17:14:27.500

试试 Google 电子表格（[Java API 参考](http://code.google.com/apis/spreadsheets/docs/2.0/developers_guide_java.html)）。您可以[上传一个 CSV](http://code.google.com/apis/documents/docs/2.0/developers_guide_java.html#UploadingSpreadsheet)，它会自动转换为电子表格，然后您可以通过编程方式[查询](http://code.google.com/apis/spreadsheets/docs/2.0/developers_guide_java.html#SendingStructuredQueries)或编辑它，或[在线操作它](http://docs.google.com/)，然后如果您需要将其作为 CSV 格式导出，您可以[将其导出](http://code.google.com/apis/documents/docs/2.0/developers_guide_protocol.html#DownloadingSpreadsheets)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T03:15:04.957

OpenDHT 听起来它会做你需要做的事情。

[http://www.opendht.org/](http://www.opendht.org/)

# ruby - 你能要求 ruby 将警告视为错误吗？

> ID：660737
> 
> 赞同：18
> 
> 时间：2009-03-19T01:14:36.960
> 
> 标签：ruby, warnings, heckle

ruby 是否允许您将警告视为错误？

我想这样做的一个原因是确保如果删除一行代码意味着发生警告，我可以选择确保突变体被杀死。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-03-19T14:32:37.573

不幸的是，没有真正的方法可以做到这一点，至少在大多数版本的 Ruby 上没有（*可能*存在变化），**没有监控程序输出**并在标准错误出现警告时中止它。原因如下：

*   **Ruby 定义[`Kernel.warn`](http://www.ruby-doc.org/core/classes/Kernel.html#M006017)，您*可以*重新定义**它以做任何您想做的事情（包括退出），并且您*希望*（希望）Ruby 始终使用它来报告警告（包括内部例如解析警告），*但是*
*   **在 Ruby 中本机**（在 C 中）实现的方法将依次直接调用一个名为`rb_warn`from的本机方法`source/server.c`，完全**绕过您的重新定义`Kernel.warn`**（例如`string literal in condition`，当执行类似的操作时发出的“”警告：`do_something if 'string'`，通过本机`rb_warn`from打印`source/parse.c`）
*   更糟糕的是，还有一个额外的本地方法，如果指定或指定`rb_warning`，Ruby 可以使用该方法记录警告。`-w``-v`

因此，如果您只需要对应用程序代码调用生成的警告采取措施，`Kernel.warn`那么**只需重新定义`Kernel.warn`. 否则，您有两个选择**：

1.  改变`source/error.c`退出`rb_warn`和`rb_warning`（和`rb_warn_m`？），并重建Ruby
2.  监视程序的“ `: warning:`”标准错误输出，并在匹配时中止它

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2019-06-08T00:55:42.177

你终于可以通过覆盖`Warning.warn`喜欢来做到这一点

```
module Warning
  def warn(msg)
    raise msg
  end
end 
```

这会将警告变成异常。该解决方案至少从 2.4 分支开始有效。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-14T18:46:43.977

您也可以潜在地使用 DTrace，并拦截对 and 的调用`rb_warn`，`rb_warning`尽管这不会产生您可以从某个地方拯救的异常。相反，它只会将它们放在您可以轻松记录它们的地方。

# c# - 你会推荐什么ORM？

> ID：660743
> 
> 赞同：1
> 
> 时间：2009-03-19T01:16:29.577
> 
> 标签：c#, linq, oracle, orm

这是我的要求：

1.  支持 C#
2.  支持甲骨文
3.  支持 LINQ
4.  能够将业务对象映射到数据库表（不一定是一对一映射）

我知道甲骨文实体框架提供者会支持所有这些，但有人告诉我，制作自定义映射并不容易。

你有什么建议？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-19T01:17:26.393

我会使用nHibernate。linq 支持即将到来。不确定它是否在他们的最新版本中，但他们刚刚发布了下一个版本的测试版。它支持您的其余要求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T03:49:52.610

如果您想要具有本机 linq 支持以及支持上述所有功能的东西，我会看看[llblgen pro](http://www.llblgen.com/defaultgeneric.aspx)或者有一个名为[Genome](http://www.genom-e.com/)的新播放器。

llblgen pro 已经存在了很长时间，并且在以前的项目中使用过它，建议您检查一下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T13:03:30.797

自己没有试过，但你可以试试：[http ://devart.com/dotconnect/oracle/](http://devart.com/dotconnect/oracle/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-12-09T09:31:24.220

[亚音速](http://www.subsonicproject.com/)。它是免费的，并且能够完成您所描述的所有事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-12-09T09:41:57.403

半票赞成[Mindscape](http://www.mindscape.co.nz/) Lightspeed - 一种适用于 Mono 的优秀工作单元风格的跨数据库 ORM。他们目前有一些有限的 LINQ 支持，更多的是在现场测试中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-12-09T09:19:21.630

使用 ALinq，[www.alinq.org](http://www.alinq.org)

# xml - 帮助！Flash 无法从第三方域加载 XML 数据

> ID：660749
> 
> 赞同：2
> 
> 时间：2009-03-19T01:21:00.080
> 
> 标签：xml, flash, rss, actionscript-2, data-access

我使用 RSS 提要从雅虎获取新闻，使用：

```
XML.load("http://finance.yahoo.com/rss/topstories") 
```

是的，[这是合法](https://stackoverflow.com/questions/395291/display-stocks-data-from-google-finance-or-yahoo-finance/401546#401546)的，虽然当我的 SWF 离线时它可以正常工作——它显示一个安全错误，但我允许我的 D 驱动器“域”在 Adob​​e[安全面板](http://www.macromedia.com/support/documentation/en/flashplayer/help/settings_manager04.html)中。

但是一旦我将它上传到我的服务器，并在线测试它：

*   在 Firefox3 中，数据加载失败，在状态栏上给我一条消息*“从 finance.yahoo.com 传输数据”*

*   在 InternetExplorer7 中，它静默失败，没有消息或警告。

发生了什么？我什至放了一个带有 * 通配符的[crossdomain.xml文件（允许所有域）。](http://www.moock.org/asdg/technotes/crossDomainPolicyFiles/)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T03:04:39.503

问题出在您的 crossdomain.xml 上...实际上将其添加到您的站点没有任何效果，您必须要求雅虎将其放在他们的域中:-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T09:19:27.373

似乎您需要在雅虎的子域才能访问它。

**[http://finance.yahoo.com/crossdomain.xml](http://finance.yahoo.com/crossdomain.xml)**

```
<cross-domain-policy>
    <allow-access-from domain="*.yahoo.com"/>
    <allow-access-from domain="us.js2.yimg.com"/>
</cross-domain-policy> 
```

一个快速的解决方法是在您自己的服务器上设置一个**代理脚本。**那里有很多例子。没有尝试过，但那个人写它的原因和你一样：

[http://www.abdulqabiz.com/blog/archives/general/php_proxy_script_for.php](http://www.abdulqabiz.com/blog/archives/general/php_proxy_script_for.php)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T01:31:24.940

我不确定这里到底出了什么问题，你需要给我一些我认为的更多细节。

我强烈建议您完整阅读此内容。

[http://www.adobe.com/devnet/flash/articles/fplayer8_security.html](http://www.adobe.com/devnet/flash/articles/fplayer8_security.html)

此外，跨域仅适用于您*请求*的*域*。

 *它还可以帮助您安装 Fiddler

[http://www.fiddler2.com/fiddler2/](http://www.fiddler2.com/fiddler2/)

或者查尔斯

[http://www.charlesproxy.com/](http://www.charlesproxy.com/)

这将使您能够更好地进行 http 调试。我的猜测是您的安全沙盒行为存在冲突。

# c - C中的指针与数组，非平凡的区别

> ID：660752
> 
> 赞同：11
> 
> 时间：2009-03-19T01:23:08.813
> 
> 标签：c, arrays, pointers

我以为我真的明白这一点，重新阅读标准（ISO 9899:1990）只是证实了我明显错误的理解，所以现在我在这里问。

以下程序崩溃：

```
#include <stdio.h>
#include <stddef.h>

typedef struct {
    int array[3];
} type1_t;

typedef struct {
    int *ptr;
} type2_t;

type1_t my_test = { {1, 2, 3} };

int main(int argc, char *argv[])
{
    (void)argc;
    (void)argv;

    type1_t *type1_p =             &my_test;
    type2_t *type2_p = (type2_t *) &my_test;

    printf("offsetof(type1_t, array) = %lu\n", offsetof(type1_t, array)); // 0
    printf("my_test.array[0]  = %d\n", my_test.array[0]);
    printf("type1_p->array[0] = %d\n", type1_p->array[0]);
    printf("type2_p->ptr[0]   = %d\n", type2_p->ptr[0]);  // this line crashes

    return 0;
} 
```

比较表达式`my_test.array[0]`并`type2_p->ptr[0]`根据我对标准的解释：

> 6.3.2.1 数组下标
> 
> “下标运算符[]的定义是E1[E2]等同于(*((E1)+(E2)))。”

应用这个给出：

```
my_test.array[0]
(*((E1)+(E2)))
(*((my_test.array)+(0)))
(*(my_test.array+0))
(*(my_test.array))
(*my_test.array)
*my_test.array

type2_p->ptr[0]
*((E1)+(E2)))
(*((type2_p->ptr)+(0)))
(*(type2_p->ptr+0))
(*(type2_p->ptr))
(*type2_p->ptr)
*type2_p->ptr 
```

`type2_p->ptr`具有类型“指向 int 的指针”，值是 的起始地址`my_test`。`*type2_p->ptr`因此计算为一个整数对象，其存储在相同的地址`my_test`。

更远：

> 6.2.2.1 左值、数组和函数指示符
> 
> “除非它是 sizeof 运算符或一元 & 运算符的操作数 ... ，具有类型的左值将转换为具有指向数组对象的初始元素且不是左值的`array of type`类型的表达式。”`pointer to type`

`my_test.array`具有类型“int 数组”并且如上所述转换为“指向 int 的指针”，其中第一个元素的地址作为值。`*my_test.array`因此计算为一个整数对象，其存储与数组中的第一个元素位于相同的地址。

最后

> 6.5.2.1 结构和联合说明符
> 
> 一个指向结构对象的指针，经过适当的转换，指向它的初始成员……，反之亦然。结构对象中可能有未命名的填充，但不是在其开头，这是实现适当对齐所必需的。

由于数组的第一个成员`type1_t`是数组，因此它的起始地址和整个`type1_t`对象的起始地址与上面描述的相同。因此，我的理解是`*type2_p->ptr`计算为一个整数，其存储与数组中的第一个元素位于相同的地址，因此与`*my_test.array`.

但事实并非如此，因为该程序在具有 gcc 版本 2.95.3、3.4.4 和 4.3.2 的 solaris、cygwin 和 linux 上始终崩溃，因此任何环境问题都是完全不可能的。

我的推理哪里错了/我不明白什么？如何声明 type2_t 以使 ptr 指向数组的第一个成员？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-19T01:45:31.847

如果我忽略了您的分析中的任何内容，请原谅我。但我认为所有这一切的根本错误是这个错误的假设

> type2_p->ptr 的类型为“指向 int 的指针”，其值为 my_test 的起始地址。

没有什么可以使它具有这种价值。相反，它很可能指向某个地方

```
0x00000001 
```

因为您所做的是将构成该整数数组的字节解释为指针。然后你添加一些东西到它和下标。

另外，我非常怀疑您对另一个结构的强制转换实际上是有效的（如，保证工作）。如果它们都是联合的成员，您可以转换然后读取任一结构的公共初始序列。但他们不在你的例子中。您也可以强制转换为指向第一个成员的指针。例如：

```
typedef struct {
    int array[3];
} type1_t;

type1_t f = { { 1, 2, 3 } };

int main(void) {
    int (*arrayp)[3] = (int(*)[3])&f;
    (*arrayp)[0] = 3;
    assert(f.array[0] == 3);
    return 0;
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-19T01:58:33.937

数组是一种存储。从语法上讲，它用作指针，但在物理上，该结构中没有“指针”变量——只有三个整数。另一方面，int 指针是存储在结构中的实际数据类型。因此，当您执行强制转换时，您可能*使 ptr 取数组中第一个元素的值，即 1。

*我不确定这实际上是定义的行为，但至少在大多数常见系统上它是这样工作的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-19T01:43:33.083

> 我的推理哪里错了/我不明白什么？

`type_1::array`（不是严格的 C 语法）不是`int *`; 它是一个`int [3]`.

> 如何声明 type2_t 以使 ptr 指向数组的第一个成员？

```
typedef struct 
{    
    int ptr[];
} type2_t; 
```

这声明了一个灵活的数组成员。来自 C 标准（6.7.2.1 第 16 段）：

> 然而，当一个 . （或->）运算符的左操作数是（指向）具有灵活数组成员的结构，右操作数命名该成员，它的行为就像该成员被替换为最长的数组（具有相同的元素类型) 不会使结构大于被访问的对象；数组的偏移量应保持灵活数组成员的偏移量，即使这与替换数组的偏移量不同。

即，它可以`type1_t::array`正确地别名。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-18T00:13:10.027

它必须被定义为行为。从记忆的角度考虑。

为简单起见，假设 my_test 位于地址 0x80000000。

```
type1_p == 0x80000000
&type1_p->my_array[0] == 0x80000000 // my_array[0] == 1
&type1_p->my_array[1] == 0x80000004 // my_array[1] == 2
&type1_p->my_array[2] == 0x80000008 // my_array[2] == 3 
```

当您将其转换为 type2_t 时，

```
type2_p == 0x80000000
&type2_p->ptr == 0x8000000 // type2_p->ptr == 1
type2_p->ptr[0] == *(type2_p->ptr) == *1 
```

要执行您想要的操作，您必须创建一个二级结构并将数组的地址分配给 ptr（例如 type2_p->ptr = type1_p->my_array）或将 ptr 声明为数组（或可变长度数组，例如整数点 [])。

或者，您可以以丑陋的方式访问元素：*(&type2_p->ptr)[0]*，*(&type2_p->ptr)[1]*。但是，这里要小心，因为*(&type2_p->ptr)[0]*实际上是一个*int**，而不是一个*int*。例如，在 64 位平台上，*(&type2_p->ptr)[0]*实际上是 0x100000002 (4294967298)。

# javascript - 您可以在 Rails RJS 中将 replace_html 与 visual_effect 结合使用吗？

> ID：660765
> 
> 赞同：3
> 
> 时间：2009-03-19T01:32:27.340
> 
> 标签：javascript, ruby-on-rails, ajax, scriptaculous

我正在使用 Ruby on Rails 开发一个网站，并且我有一个包含一些内容的 div。单击链接后，我希望该内容被其他内容替换。这适用于 replace_html 和 rjs。

但是，我希望在新旧内容之间有轻微的淡入淡出/出现（交叉淡入淡出？）过渡。此外，div 将调整大小，因此如果这样做会产生增长/收缩效果会更酷。我在想 Scriptaculous 必须有这样的内置功能，但如果有的话我肯定找不到。

顺便说一句，如果您有 Basecamp 帐户，则有一个很好的示例：登录并单击“所有人”，然后单击“添加新公司”以查看实际效果。

有人知道怎么做吗？谢谢！布赖恩

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-21T19:26:11.727

要交叉淡入淡出，您需要绝对定位新内容，并使用与旧内容相同的 x/y 坐标。这是一个经过测试的示例：

```
page.insert_html :after, 'old-content', content_tag('p', '[new content]', :id => 'new-content', :style => 'display:none')
page << <<-JS
  var oldOffset = $('old-content').cumulativeOffset();
  $('new-content').setStyle({
    position: 'absolute',
    left:     oldOffset.left + 'px',
    top:      oldOffset.top + 'px'
  });
JS
page['old-content'].fade :duration => 3
page['new-content'].appear :duration => 3 
```

注意中间的大块——在 Prototype 中有些事情比在 RJS 中更容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T08:04:05.883

一种策略可能是将元素放入包装 div 中，淡出该包装 div，替换元素中的 HTML，然后再次淡入包装 div。

我自己不是 RJS/scriptaculous 用户，所以我不确定代码是什么，但我很确定该策略会奏效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-20T03:48:27.230

淡出第一个 div。同时在第二格中失明。随着第一个消失，第二个似乎扩大了第一个的剩余部分。

嗯，类似的东西。

如果您想查看它们在调用什么，请加载 Firebug 并逐步执行代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T16:27:02.740

一种快速的方法是进行替换，然后使 div 脉动。

# javascript - Javascript 数组转换

> ID：660767
> 
> 赞同：1
> 
> 时间：2009-03-19T01:36:35.287
> 
> 标签：javascript, arrays

我有一个函数（我无法更改），它从数据库中查询数据并将其返回到一个变量中，如果我将其显示为文本，则该变量显示为以下格式：

```
var outputdata=
    [
        { itemA: 'M0929',  itemDate: new Date(1950,03-1,25,0,0,0,0),  itemID: 'JDR12' },
        { itemA: 'X0121',  itemDate: new Date(1983,07-1,07,8,0,0,0),  itemID: 'RPN50' },
        { itemA: 'U0229',  itemDate: new Date(1942,09-1,07,8,0,0,0),  itemID: 'CRG98' },
    ]; 
```

我需要将其转换为以下格式（特定日期格式无关紧要）以供另一个函数使用（我也无法更改）。

```
var inputdata=[
        [
            "M0929",
            "1950-03-25",
            "JDR12"
        ],
        [
            "X0121",
            "1983-07-07",
            "RPN50"
        ],
        [
            "U0229",
            "1942-09-07",
            "CRG98"
        ]
    ]; 
```

有人可以提供一些帮助...我不太了解javascript数组，而且我真的很想使用一个函数来进行转换。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T01:46:42.843

您可能必须自己编写它，例如：

```
function pad (what)
{
    return what < 10 ? '0'+what : String(what);
}
function transformData (data)
{
    var result = [];
    for (var i=0;i<data.length;++i)
    {
        var date = data[i]['itemDate'];
        result.push([
            data[i]['itemA'],
            date.getFullYear()+'-'+pad(date.getMonth())+'-'+pad(date.getDate()),
            data[i]['itemID']
        ]);
    }
    return result;
}

var outputdata=
    [
        { itemA: 'M0929',  itemDate: new Date(1950,03-1,25,0,0,0,0),  itemID: 'JDR12' },
        { itemA: 'X0121',  itemDate: new Date(1983,07-1,07,8,0,0,0),  itemID: 'RPN50' },
        { itemA: 'U0229',  itemDate: new Date(1942,09-1,07,8,0,0,0),  itemID: 'CRG98' },
    ];

var result = transformData(outputdata);

alert(result.join("\n")); 
```

现在，需要注意的是 UTC 日期的性质。更多细节可以在这里找到[http://www.w3schools.com/jsref/jsref_obj_date.asp](http://www.w3schools.com/jsref/jsref_obj_date.asp)。此外，我强烈建议您阅读更多关于一般 Javascript 的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T01:47:19.847

```
function convert(outputdata){
  var arr = [];
 for(var i = 0; i<outputdata.length; i++){
    var output = outputdata[i];
    var temp = [output.itemA, output.itemDate, output.itemID];
    arr[i] = temp;
 } 
 return arr;
} 
```

**编辑：**初始化*arr*。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T01:49:35.830

不是一个完整的回应，因为这闻起来像家庭作业（如果是，你应该这样标记它）。所以先提示：

*   您可以通过编写类似 `[ 7, 9*7, "ho" ]
*   您可以使用点符号获取属性，例如`obj.itemA`

# visual-c++ - 从 VC6 (LNK4099) 切换到 VS2005 后的链接器问题

> ID：660768
> 
> 赞同：0
> 
> 时间：2009-03-19T01:36:43.973
> 
> 标签：visual-c++, visual-studio-2005, linker, visual-c++-6, environment

我将我的一个旧项目移植到 VS2005 并出现链接器警告，例如

```
xxxxx.lib(xxxxxxxx.obj) : warning LNK4099: PDB 'vc60.pdb' was not found with ...; linking object as if no debug info 
```

现在，我尝试重建项目，但警告不会消失。它真的应该在寻找 vc60.pdb 而不是 vc80.pdb 吗？我确实有 vc80.pdb 文件..

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T01:46:54.793

您有一个 .obj 链接到您的 .lib 中，其中包含调试信息；该调试信息具有指向 vc60.pdb 的链接。如果 .lib 是您自己的，则需要重新编译源代码并重建 .lib 文件以更新该引用。如果 .lib 不是您的，您将不得不忽略此警告，并且无法调试到该特定目标文件的源代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T01:49:23.490

VS2005 通常不应该寻找 vc60.pdb，尤其是在完全重建之后。

也许您有一些第三方库没有重新编译并且仍然包含对旧调试信息的引用？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T01:42:57.313

通常为调试目的创建 .pdb 文件类型。根据我在 .pdb 文件类型上找到的一些信息，它显示“此文件包含在调试模式下执行程序时使用的调试信息”。

我看到如果您遇到零错误，您只会收到警告而不是程序应该运行的错误。

我相信您需要此文件的唯一时间是用于调试或分析。通常在最终构建中使用发布设置以获得程序的最快执行。希望这可以帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T01:52:10.053

它可能是一些用 VS2005 编译的 .lib 文件。

你需要重新编译**EVERYTHING**。

# python - Python Django 循环逻辑：错误说'int'不可迭代 - 检查我的语法？

> ID：660773
> 
> 赞同：0
> 
> 时间：2009-03-19T01:38:37.230
> 
> 标签：python, django

```
return sum(jobrecord.get_cost() or 0 
    for jobrecord in self.project.jobrecord_set.filter(
        date__lte=date,
        date__gte=self.start_date) or 0) 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T01:42:52.337

小改写后

```
query = self.project.jobrecord_set.filter(
        date__lte=date,
        date__gte=self.start_date)
values= ( jobrecord.get_cost() or 0 for jobrecord in query or 0 )
return sum( values ) 
```

仔细看`values= ( jobrecord.get_cost() or 0 for jobrecord in query or 0 )`

当查询为空时会发生什么？

你在评估`jobrecord.get_cost() or 0 for jobrecord in 0`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T02:13:33.667

0 确实不可迭代。我想你想放弃最后一个`or 0`。当过滤器查询不匹配任何元素时，它将返回一个空查询，并且您的总和将仅为 0，因为`sum([])`为零。

如果由于某种原因查询可能引发异常（无效日期或类似情况），则 or 子句也不会捕获该异常。 `[][1] or 0`仍然引发异常。

# javascript - JavaScript 可以从第三方域加载 XML 数据吗？

> ID：660774
> 
> 赞同：5
> 
> 时间：2009-03-19T01:38:39.257
> 
> 标签：javascript, rss, cross-domain

[JavaScript 可以从Yahoo](http://finance.yahoo.com/rss/topstories)加载 RSS XML 提要吗？

客户端 JS 是否允许访问第三方域？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T02:15:55.800

一种简单的方法是通过页面所在的服务器代理请求。步骤是：

1.  编写一个服务器端脚本在 rss 提要上执行一个 http 请求，当该脚本本身是请求时（即通过 get 或 post）
2.  使用 ajax 请求服务器端脚本，或者只是从该页面的主脚本中调用它。
3.  然后，服务器端脚本以某种可显示的形式返回提要源。
4.  利润！

在 IE 8 和 FF 3.1（不确定）上，可以通过专门的跨站点调用发出这些请求，但上一代浏览器仍然会出现问题。看：

[http://dannythorpe.com/2009/01/15/ie8-cross-domain-request-support-demo/](http://dannythorpe.com/2009/01/15/ie8-cross-domain-request-support-demo/) [http://ejohn.org/blog/cross-site-xmlhttprequest/](http://ejohn.org/blog/cross-site-xmlhttprequest/)功能在 FF 3.0 中受限，不清楚如果它会回到 3.1

但是，保证上述步骤不会违反任何浏览器 CSS 安全性，但会导致服务器上的一些延迟和额外的硬件负载。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-08T19:03:16.957

您可以使用我的博客文章[未成文指南雅虎查询语言中概述的技术](http://jawtek.blogspot.com/2009/03/unwritten-guide-to-yahoo-query-langauge.html)

您将使用这样的 yql 语句查询 XML 数据表：

```
`select * from xml
  where url="http://path/to/xml`
```

`然后，您将使用 src http://query.yahooapis.com/v1/public/yql?q={your yql here} 向您的 html 添加一个脚本标签（可以使用 document.createElement('script') 完成） &format=json&callback={your function here} 其中 {your yql here} 被替换为 yql 语句的 URI 编码版本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-02-19T01:29:09.980

您可以使用[Google Feed API](http://code.google.com/apis/feed/)从任何域/服务器加载 JavaScript 中的 RSS。它不仅仅是一个代理，它实际上从 Google 缓存中提供 RSS 内容，而不是访问原始服务器。对于无法处理 Slashdot 流量激增的小型服务器来说，这可能是救命稻草。

几年前，我[在 Silverlight 上的一篇文章中](http://dannythorpe.com/2007/05/30/a-cross-domain-silverlight-channel-9-videorss-player/)使用 Feed API 进行跨站点 RSS 访问。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T01:50:19.993

我不确定 JS，但我知道您可以使用[google 的 API](http://code.google.com/apis/ajaxfeeds/)之一，并且他们有一个 RSS 阅读器。我知道这可能不是您想要的，但是如果您通读文档，您可能会得到关于它是如何工作的答案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-08T18:31:20.250

不是直接的。您可以使用 Dana 关于代理请求的建议，或者查看一种称为 JSONP 的方法，该方法本质上将返回的 JSON 对象包装在自定义回调函数中，由您注入 DOM 的脚本标签请求。大多数 API 提供商都支持这一点（包括 Yahoo 的 API）。

# svn - 模板文件和源代码控制

> ID：660775
> 
> 赞同：1
> 
> 时间：2009-03-19T01:38:57.650
> 
> 标签：svn, version-control

有没有办法为存储在源代码控制中的文件提供类似 svn externals 的东西（最好是 Subversion，但如果其他 SCM 系统可能或更容易，我会感兴趣）。

这就是我的意思。假设我有一大堆 SQL 脚本，这些脚本必须合并到一个大脚本中以打包每个版本。如果我可以为整个脚本创建一个文件，然后以某种方式链接到其他文件，并且当任何引用的文件在 subversion 中更改时，该文件将自动更新（在 SVN 更新之后），那将是很好的。我猜连接的文件必须是只读的。

多考虑一下拥有太多文件可能会更容易。一个用于模板定义，另一个用于文件本身。

它可能看起来像这样。

模板文件（可能是 .sql.svntemplate 扩展名之类的）：

```
<external file="relative/repository/url/Script1.sql"/>
<external file="relative/repository/url/Script2.sql"/>
<external file="relative/repository/url/Script3.sql"/>
<external file="relative/repository/url/Script4.sql"/> 
```

当然，它不必是 XML。

然后当你添加并提交 .sql.svntemplate 文件时，Subversion 会自动生成一个同名的只读文件，除了没有 .svntemplate 扩展名。

例如

```
DBScripts.sql.svntemplate 
```

将生成一个名为的只读文件：

```
DBScripts.sql 
```

这将包含所有脚本的内容。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T03:02:51.770

您所描述的通常称为[派生对象](http://en.wikipedia.org/wiki/Derived_object)，许多源代码控制系统具有不同的处理方式。在最常见的情况下，派生对象是在构建阶段集成新标签的过程中创建的。其他常见的派生对象是编译的对象文件、存档文件和数据库文件。处理派生对象的源代码控制系统的一个示例是 IBM Rational ClearCase。

SVN 没有很好地处理实现的派生对象。我建议为预提交操作创建一个 make 文件。因此，在**svn checkin**之前，您运行“make -f Makefile.commit”，它会创建/更新所有相关的派生对象。您可以将特定的 Makefile 放入每个目录，并使它们包含来自子目录的 makefile，因此无论何时提交子树，只需在其目录中运行 makefile，它将更新您修改的整个子树中的衍生对象。您可以在生成文件中添加规则以在生成派生对象后将其设置为只读。

关于 Makefile stategies，请参阅 gnu 用户[手册](http://www.gnu.org/software/make/manual/make.html)。Make 是一个专门设计用于根据源文件修改和依赖关系创建派生对象的工具。

# c# - 如何轻松地将两个异步请求链接在一起？

> ID：660776
> 
> 赞同：4
> 
> 时间：2009-03-19T01:41:02.077
> 
> 标签：c#, .net, multithreading, asynchronous, iasyncresult

**2013 年编辑：** `async`现在`await`让这变得微不足道！:-)

* * *

我有一些屏幕抓取网站的代码（**仅用于说明目的**！）

```
 public System.Drawing.Image GetDilbert()
    {
        var dilbertUrl = new Uri(@"http://dilbert.com");
        var request = WebRequest.CreateDefault(dilbertUrl);
        string html;
        using (var webResponse = request.GetResponse())
        using (var receiveStream = webResponse.GetResponseStream())
        using (var readStream = new StreamReader(receiveStream, Encoding.UTF8))
            html = readStream.ReadToEnd();

        var regex = new Regex(@"dyn/str_strip/[0-9/]+/[0-9]*\.strip\.gif");
        var match = regex.Match(html);
        if (!match.Success) return null;
        string s = match.Value;
        var groups = match.Groups;
        if (groups.Count > 0)
            s = groups[groups.Count - 1].ToString();    // the last group is the one we care about

        var imageUrl = new Uri(dilbertUrl, s);
        var imageRequest = WebRequest.CreateDefault(imageUrl);
        using (var imageResponse = imageRequest.GetResponse())
        using (var imageStream = imageResponse.GetResponseStream())
        {
            System.Drawing.Image image_ = System.Drawing.Image.FromStream(imageStream, true /*useEmbeddedColorManagement*/, true /*validateImageData*/);
            return (System.Drawing.Image)image_.Clone(); // "You must keep the stream open for the lifetime of the Image."
        }
    } 
```

现在，我想异步调用 GetDilbert()。使用委托的简单方法：

```
 Func<System.Drawing.Image> getDilbert;
    IAsyncResult BeginGetDilbert(AsyncCallback callback, object state)
    {
        getDilbert = GetDilbert;
        return getDilbert.BeginInvoke(callback, state);
    }
    System.Drawing.Image EndGetDilbert(IAsyncResult result)
    {
        return getDilbert.EndInvoke(result);
    } 
```

虽然这确实有效，但它的效率并不高，因为委托线程将花费大部分时间等待两个 I/O 操作。

我想做的是打电话`request.BeginGetResponse()`，做正则表达式匹配，然后打电话`imageRequest.BeginGetResponse()`。同时使用标准异步调用模式并保留*BeginGetDilbert()*和*EndGetDilbert()*的签名。

我尝试了几种方法，但对其中任何一种都不完全满意；这似乎是一种皇家的痛苦。因此，问题。:-)

* * *

[编辑： C# 编译器团队](http://blogs.msdn.com/oldnewthing/archive/2008/08/15/8868267.aspx#8870195)似乎不赞成使用迭代器的方法。

> 编译器团队的请求：
> 
> 虽然可以肯定的是，您可以使用迭代器来实现状态机、穷人协程等等，但我希望人们不要这样做。
> 
> 请按照预期目的使用工具。如果您想编写状态机，请为自己编写一个专门用于解决该一般问题的库，然后使用它。
> 
> 将工具用于预期目的之外的目的是“聪明的”，聪明是坏的；聪明让维护程序员难以理解，聪明难以扩展，聪明难以推理，聪明让人“开箱即用”；那个盒子里有好东西。

* * *

选择`Future<>`答案，因为它保留在 C# 中，这与我的示例代码相同。不幸的是，TPL 和 F# 都没有得到 Microsoft 的官方支持……但是。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T02:20:43.243

把这件事做好是一场噩梦。您需要创建回调以传递给每个“开始”方法，然后运行该方法的“继续”。（并且不要忘记确保所有异常处理和 CompletedSynchronously 逻辑都是正确的！）当您今天在 C# 中编写此代码时，您的代码会变成一团毫无希望的意大利面条，但这是您实现目标的唯一方法（没有线程阻塞 I/O 等待）。

另一方面，如果您的情况在合理范围内，[F#](http://fsharp.net)会使其非常简单直接地正确创作。请参阅[此视频](http://channel9.msdn.com/pdc2008/TL11/)（即从 52:20 开始的 8 分钟）了解概要。

编辑

回答丹的评论，这是一个非常粗略的草图......我从我在 Outlook 中写的一封电子邮件中提取了它，我怀疑它是否可以编译。异常路径总是很粗糙，所以要小心（如果 'cb' 抛出怎么办？）；你可能想在 C# 的某个地方找到一个坚如磐石的 AR/Begin/End 实现（我不知道在哪里，我相信肯定有很多）并将其用作模型，但这显示了要点。问题是，一旦你创作了一次，你就永远拥有它；BeginRun 和 EndRun 作为任何 F# 异步对象的“开始/结束”工作。我们在 F# 错误数据库中提出了一项建议，即在 F# 库的未来版本中将 Begin/End APM 暴露在异步之上，以便更轻松地从传统 C# 代码中使用 F# 异步计算。（当然，我们也在努力更好地使用 .Net 4.0 中并行任务库中的“任务”。）

```
type AR<’a>(o,mre,result) =
    member x.Data = result
    interface IAsyncResult with
        member x.AsyncState = o
        member x.AsyncWaitHandle = mre
        member x.CompletedSynchronously = false
        member x.IsCompleted = mre.IsSignalled

let BeginRun(a : Async<’a>, cb : AsyncCallback, o : obj) =
    let mre = new ManualResetEvent(false)
    let result = ref None
    let iar = new AR(o,mre,result) :> IAsyncResult
    let a2 = async { 
        try
            let! r = a
            result := Choice2_1(r)
        with e ->
            result := Choice2_2(e)
            mre.Signal()
            if cb <> null then 
                cb.Invoke(iar)
            return () 
    }
    Async.Spawn(a2)
    iar

let EndRun<’a>(iar) =
    match iar with
    | :? AR<’a> as ar -> 
        iar.AsyncWaitHandle.WaitOne()
        match !(ar.Data) with
        | Choice2_1(r) -> r
        | Choice2_2(e) -> raise e 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T03:44:29.220

```
 public Image GetDilbert()
 {
     var   dilbertUrl  = new Uri(@"http://dilbert.com");
     var   request     = WebRequest.CreateDefault(dilbertUrl);
     var   webHandle   = new ManualResetEvent(false /* nonsignaled */);
     Image returnValue = null;

     request.BeginGetResponse(ar => 
     {  
          //inside AsynchCallBack method for request.BeginGetResponse()
          var response = (HttpWebResponse) request.EndGetResponse(ar); 

          string html;  
          using (var receiveStream = response.GetResponseStream())
          using (var readStream    = new StreamReader(  receiveStream
                                                      , Encoding.UTF8))
          {
             html = readStream.ReadToEnd();
          }

          var re=new Regex(@"dyn/str_strip/[0-9/]+/[0-9]*\.strip\.gif");
          var match=re.Match(html);

          var imgHandle = new ManualResetEvent(true /* signaled  */);

          if (match.Success) 
          {   
              imgHandle.Reset();              

              var groups = match.Groups;
              var s = (groups.Count>0) ?groups[groups.Count-1].ToString()
                                       :match.Value;
              var _uri   = new Uri(dilbertUrl, s);
              var imgReq = WebRequest.CreateDefault(_uri);

              imgReq.BeginGetResponse(ar2 => 
              {  var imageRsp= (HttpWebResponse)imgReq.EndGetResponse(ar2);

                 using (var imgStream=imageRsp.GetResponseStream())
                 { 
                    var im=(Image)Image.FromStream(imgStream,true,true);
                    returnValue = (Image) im.Clone();
                 }    

                 imgHandle.Set();           
              }, new object() /*state*/);
          }      

          imgHandle.WaitOne();
          webHandle.Set();  
     }, new object() /* state */);

     webHandle.WaitOne();  
     return returnValue;      
 } 
```

对于 Begin/EndGetDilbert() 方法，您可以使用[http://blogs.msdn.com/pfxteam/archive/2008/02/29/7960146.aspx](http://blogs.msdn.com/pfxteam/archive/2008/02/29/7960146.aspx)`Future<T>`中所述的技术

*另请参阅[http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.begingetresponse.aspx](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.begingetresponse.aspx)*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T22:59:17.830

您可能会发现 Jeff Richter 的[AsyncEnumerator](http://msdn.microsoft.com/en-us/magazine/cc721613.aspx)简化了很多事情。您可以在 Wintellect [PowerThreading](http://www.wintellect.com/PowerThreading.aspx)库中获得它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-24T19:33:47.330

毫无疑问：使用[Concurrency and Coordination Runtime](http://channel9.msdn.com/shows/Going+Deep/Expert-to-Expert-Meijer-and-Chrysanthakopoulos-Concurrency-Coordination-and-the-CCR/)。它使用了许多上面提到的技术，并且将使您的代码比滚动您自己的代码更简洁。

# php - PHP 应用程序是否应该对不正确的数据库值执行错误处理？

> ID：660784
> 
> 赞同：3
> 
> 时间：2009-03-19T01:44:24.860
> 
> 标签：php, database

想象一下……我在数据库中有一个名为“current_round”的字段。这可能只在 0,1,2,3 的范围内。

通过应用程序逻辑，不可能将大于 3 或小于 0 的数字放入数据库。

是否应该进行错误检查以查看值是否格式错误（即不在 0-3 范围内）？或者这只是不必要的开销？假设数据库中的值的格式/范围等是否正确（假设您正确分析/评估所有用户输入？）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T02:02:20.077

我通常不会验证数据库中的所有数据。相反，我尝试对数据库实施约束。在您的情况下，根据 0、1、2、3 的含义，我可能会使用带有外键约束的查找表，或者如果它们只是数值，我可能会使用检查约束（从 DB 供应商到下一个供应商不同）。

这有助于防止具有直接访问权限的人和/或可能使用相同数据库但不共享您的输入验证过程的未来应用程序对数据库进行更改。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T01:59:16.167

无论您决定在插入数据库之前将验证放在哪里，都应该在哪里捕获这些东西。

验证过程应仅在一处进行。取决于您的应用程序的结构：

*   它是面向过程的还是面向对象的？
*   如果它是面向对象的，那么您是否使用 Active Record 模式、Gateway 模式或 Data Mapper 模式来处理您的数据库映射？
*   您是否拥有与数据库抽象层分离的域对象？

然后你需要决定在你的应用程序中放置这个逻辑的位置。

在我的例子中，域对象包含验证逻辑和带有数据映射器的函数，这些映射器实际上对数据库执行插入和更新功能。因此，在我尝试将信息保存到数据库之前，我确认存在有效值。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-20T20:46:49.730

获取数据库为您执行此操作。[最先进的 DBMS（在http://FreeDB2.com](http://FreeDB2.com)上查看免费的 DB2 Express-C ）允许您定义约束。通过这种方式，您可以获得数据库以确保数据的语义完整性。在应用程序代码中完成此操作一开始会起作用，但您总是会发现它会因各种原因停止工作。您可能有其他应用程序将数据填充到数据库中，或者您可能会在现有应用程序中出现错误。最常发生的事情是您让新人在应用程序上工作，他们将添加无法执行与您所做的相同级别的检查的代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T04:34:13.703

通常，您应该检查您所期望的值或类型。并采取适当的行动。只有在所有检查都失败*后*，才可能有一些代码考虑如何处理“错误”值以及如何解决问题。这适用于状态值，例如您拥有的值，或者需要正确类型的输入类型。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-21T01:35:03.330

约束应该放在数据库上，只要记住捕获任何抛出的异常，如果您的应用程序有机会尝试插入/更新无效值

# visual-studio - 如何从现有 Visual Studio 项目中区分 Visual Studio 项目类型

> ID：660790
> 
> 赞同：125
> 
> 时间：2009-03-19T01:47:31.607
> 
> 标签：visual-studio, visual-studio-2005

使用 Visual Studio 2005。

.sln 或 .vcproj 文件（或其他任何地方）中是否有任何定义项目类型/子类型的内容？

编辑：我的意思是，当你创建一个项目时，你首先选择一种语言（例如 Visual C#），然后是项目类型（例如 Windows），然后是子类型（例如控制台应用程序）。

这些信息存储在 VS 文件中的什么位置？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-03-19T03:14:16.143

在项目 XML 文件中：

控制台应用程序包含：

```
<OutputType>Exe</OutputType> 
```

WinForms 应用程序包含：

```
<OutputType>WinExe</OutputType> 
```

库 (.dll) 项目包含：

```
<OutputType>Library</OutputType> 
```

并且不包含

```
<ProjectTypeGuids> 
```

ASP.NET 和 WCF 项目包含：

```
<ProjectTypeGuids>{603c0e0b-db56-11dc-be95-000d561079b0};{349c5851-65df-11da-9384-00065b846f21};{fae04ec0-301f-11d3-bf4b-00c04f79efbc}</ProjectTypeGuids>
<OutputType>Library</OutputType> 
```

GUID 会做一些事情来准确定义它是什么类型的项目。以上是从 ASP.NET 应用程序中获取的。它们也存在于 WCF 项目中，并且翻转 GUID 可以欺骗 Vis Studio 在您打开它时更改项目类型。

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2009-03-19T19:28:34.997

一些进一步的研究，我发现了这一点：

[信息：已知项目类型指南的列表](http://www.mztools.com/Articles/2008/MZ2008017.aspx)。

我的 .sln 文件包含：

Visual Studio 2005
项目（“{ **FAE04EC0-301F-11D3-BF4B-00C04F79EFBC** }”）=“AddNumbers”、“AddNumbers.csproj”、“{2C81C5BB-E3B0-457E-BC02-73C76634CCD6}”

链接显示：

项目类型 描述 项目类型 Guid
Windows (C#) { **FAE04EC0-301F-11D3-BF4B-00C04F79EFBC** }

所以它是 Windows C#，子类型是根据@HardCode 的回复。就我而言，它是“控制台应用程序”。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-19T02:39:08.287

.vproj 文件定义了项目类型，例如下面定义了一个 C++ 项目。

```
<VisualStudioProject
   ProjectType="Visual C++" 
```

项目标签还包括编译器版本。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-19T02:47:49.887

在解决方案资源管理器中双击“我的项目”，然后查看“应用程序类型：”组合框。它告诉您（并让您更改）项目类型。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2020-06-04T11:33:27.343

1.  右键单击解决方案的项目。
2.  打开属性 -> 应用程序选项卡。
3.  在右侧，您可以看到“输出类型”，它定义了现有解决方案的项目类型。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-05-22T20:30:22.503

如果您有兴趣查找项目的子类型，即在 C# Windows 项目类别下，检查它是 Windows 窗体应用程序还是 WPF

尝试在项目中添加新项目，它将显示特定于该项目类型的项目以及默认选项。

例如，如果有一个 WPF 项目，它会显示与 WPF 相关的选项，例如“窗口”、“页面”、“用户控件”……如果是窗口窗体应用程序，它会显示“窗口窗体”等.....

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-08-20T19:16:42.247

轻松解决。

如果您想知道它是 WCF 项目还是 ASP.NET Web 服务，只需在文件资源管理器中打开项目的文件夹即可。您可以将鼠标悬停在图标上，工具提示将显示项目类型，如图所示。此外，您可以在文件资源管理器中的**类型**列下查看，它也会在那里显示。

WCF 网络服务项目： [![WCF 网络服务](https://i.stack.imgur.com/3YJO5.jpg)](https://i.stack.imgur.com/3YJO5.jpg)

ASP.NET Web 服务项目： [![ASP.NET 网络服务](https://i.stack.imgur.com/69tV1.jpg)](https://i.stack.imgur.com/69tV1.jpg)

另请注意，如果您的项目在其**Properties**文件夹中有 Resources.Designer.cs 或 Settings.Designer.cs，则它可能是 WinForms 应用程序。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-04-18T00:05:57.940

遵循：解决方案资源管理器-> 将鼠标悬停/右键单击您的项目项（不是项目文件夹。检查属性视图以查找您是否单击了文件夹或项目）-> 属性。然后所有信息都可用于该项目。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-04-24T06:38:04.590

右键单击解决方案，然后单击文件资源管理器中的打开文件夹。导航到项目文件。将鼠标悬停在它上面，工具提示会显示项目文件的类型。

# cocoa - http请求和xml委托完成后，我需要在可可中返回一个字符串吗？

> ID：660792
> 
> 赞同：-1
> 
> 时间：2009-03-19T01:48:45.083
> 
> 标签：cocoa, cocoa-touch

我有以下 NSURLConnection 的委托方法

```
- (void)connectionDidFinishLoading:(NSURLConnection *)connection 
```

{

```
 NSLog(@"DONE, Receive bytes: %d", [webData length]);

NSString *theXML = [[NSString alloc]initWithBytes:[webData mutableBytes] length:[webData length] encoding:NSUTF8StringEncoding];
//NSLog(theXML);
[theXML release];

if(xmlParser)
{
    [xmlParser release];        
}
else 
{
    xmlParser = [[NSXMLParser alloc]initWithData:webData];
    [xmlParser setDelegate:self];
    [xmlParser setShouldResolveExternalEntities:YES];
    [xmlParser parse];
    [connection release];
    [webData release];
    NSLog(@"\n\n\n\n");
    NSLog(httpResult);
} 
```

我想返回`httpResult`- 我该怎么做？我在一个类中有上述方法。我在另一个控制器类中创建了这个类的一个实例，它调用一个函数来创建一个 http 请求。然后该函数依次调用该委托方法。我如何返回`httpResult`控制器类？

**我已经想通了-谢谢大家**

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T02:02:09.170

给该类一个委托或一个 didFinish 类型的回调，并将其设置为在完成时告诉您的控制器。

# iphone - 一台 Mac 上有多个 iPhone 开发者帐户？

> ID：660798
> 
> 赞同：20
> 
> 时间：2009-03-19T01:51:43.643
> 
> 标签：iphone, macos, xcode

我已经搜索但无法在任何地方找到这个问题。我和我的妻子即将进行 iPhone 开发，我们只有购买一台 iMac 24" 的资金来完成这项工作。任何有 iPhone 开发经验的人都知道是否可以在一台开发 Mac 上配置两个不同的 Apple 开发者帐户? 不仅通过开发者程序，而且 XCODE（我相信是）IDE 也支持它？

我们希望能够做的是我可以使用我的个人资料和开发人员/调试等登录我的 iPhone 应用程序，她在她自己的个人资料下做同样的事情（看不到我的，反之亦然）。分时不会成为问题，因为我在家工作，而她在家工作，我们将能够弄清楚那部分没问题。

请理解，我们对 Mac、OS X 以及 iPhone 开发领域都是全新的，所以我们不知道这是否可能。如果不是，我们的第二个选择是购买两台 Mac Mini（也包括键盘和鼠标），并为我们现有的每台 PC 显示器找出一些 KVM，然后以这种方式进行开发。我们不希望只在两个开发者帐户和 IDE 配置文件之间共享一台 iMac。

**更新：** 我和妻子利用 12 个月的无息优惠从 Best Buy 购买了 24 英寸 iMac，这使它成为 20 英寸 iMac 的选择。它有充足的 RAM（最大 8G 中的 4G）和 HD 空间（640G），我们正在习惯 MAC OS X 并将很快开始开发。我们创建了两个 OS X 帐户，以保持设置等分开。Windows 更接近 OS X，反之亦然，因为 OS X 上的东西看起来非常直观，我们对大约 8 分钟的整个拆箱和设置时间印象深刻！到现在为止还挺好。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-19T01:53:17.367

当然。只需在 iMac 上创建两个用户帐户。简单的！

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-07-25T21:43:56.617

我有两个我使用的 iPhone 开发人员帐户，所以不是两个帐户和两个人，而是两个帐户和一个人。不幸的是，作为同一个人，两个帐户最终都使用了相同的代理名称（而且似乎几乎不可能更改这一点——我要求更改的案例已经向 Apple 开放了几个月）。

这导致了两组密钥和证书，并且密钥具有相同的名称。这会导致 Xcode 出现问题，包括 Organizer 和代码签名。前段时间我在这些 6635822) 上提交了错误，但现在才找到解决这两个问题的方法。我把它写在一个博客条目中，以防它对其他人有帮助。

[http://geekanddad.wordpress.com/2009/07/25/work-around-for-multiple-iphone-dev-account-and-code-signing-and-xcode-organizer-problems/](http://geekanddad.wordpress.com/2009/07/25/work-around-for-multiple-iphone-dev-account-and-code-signing-and-xcode-organizer-problems/)

更新：2010 年 1 月：看起来 Apple 已经通过生成证书解决了这个问题 - 用户名现在似乎在括号中附加了一个数字（例如，我的名字 (A340D)）。我没有尝试在以前的帐户上重新生成证书以查看他们是否添加了此哈希，但新创建的帐户正在添加此哈希。

更新：2010 年 2 月 12 日：是的，如果您在帐户上重新生成证书，它会在名称后附加一个数字，这整个问题都不是问题。所以你现在可以只拥有一个钥匙串和所有证书 - 谢谢苹果！

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-19T04:58:29.013

这是一种方式。您可以共享 /Developer 工具的单个副本，但每个工具都有您自己的登录名、首选项和钥匙串。

如果您共享同一个 Mac OS X 用户帐户，但有两个 ADC 身份，则在 Safari 端，您只需确保在交换位置时退出 ADC 网站。

在 Xcode 方面，您需要将开发人员证书添加到您的钥匙串，并将两个配置文件添加到 Xcode 的管理器。如果您要拥有单独的配置文件和开发人员证书，我建议您每个人都拥有自己的手机。

关键部分是，对于您从事的每个项目，您需要将代码签名身份设置为拥有它的人的**完整且准确的身份。**项目设置了通配符“iPhone Developer”；您需要将其更改为“iPhone Developer—John Appleseed”才能使用您的签名证书和个人资料，而您的妻子也必须在她的项目中这样做。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-25T15:39:17.853

此外，如果您从一个开发者帐户复制应用程序并尝试使用与另一个帐户关联的身份和配置文件，它将无法正常工作。您必须退出 XCode 并编辑您可以在 .xcodeproj 包中找到的 project.pbxproj 文件。找到 CODE_SIGN_IDENTITY 或 PROVISIONING_PROFILE 旁边的每个术语并删除双引号中的值（保留双引号）。然后重新启动 XCode 并在 Get Info 的 Build 选项卡中为 Groups 和 Files 左上角的主要对象以及任何和所有 Targets 选择配置文件。然后它应该工作。显然，当使用一个 ADC 帐户的配置文件构建应用程序时，XCode 不会修复所有必要的信息以允许您更改为不同的 ADC 帐户。

# c# - 我的代码是否正确清理了它的列表 ?

> ID：660801
> 
> 赞同：4
> 
> 时间：2009-03-19T01:52:36.540
> 
> 标签：c#, dispose, idisposable, memorystream

我有一个执行 PDF 文件操作的第三方组件。每当我需要执行操作时，我都会从文档存储（数据库、SharePoint、文件系统等）中检索 PDF 文档。为了使事情有点一致，我将 PDF 文档作为`byte[]`.

这个第 3 方组件需要一个`MemoryStream[]`( `MemoryStream`array) 作为我需要使用的主要方法之一的参数。

我正在尝试将此功能包装在我自己的组件中，以便我可以将此功能用于我的应用程序中的许多区域。我基本上提出了以下几点：

```
public class PdfDocumentManipulator : IDisposable
{
   List<MemoryStream> pdfDocumentStreams = new List<MemoryStream>();

   public void AddFileToManipulate(byte[] pdfDocument)
   {
      using (MemoryStream stream = new MemoryStream(pdfDocument))
      {
         pdfDocumentStreams.Add(stream);
      }
   }

   public byte[] ManipulatePdfDocuments()
   {
      byte[] outputBytes = null;

      using (MemoryStream outputStream = new MemoryStream())
      {
           ThirdPartyComponent component = new ThirdPartyComponent();
           component.Manipuate(this.pdfDocumentStreams.ToArray(), outputStream);

           //move to begining
           outputStream.Seek(0, SeekOrigin.Begin);

           //convert the memory stream to a byte array
           outputBytes = outputStream.ToArray();
      }

      return outputBytes;
   }

   #region IDisposable Members
   public void Dispose()
   {
       for (int i = this.pdfDocumentStreams.Count - 1; i >= 0; i--)
       {
          MemoryStream stream = this.pdfDocumentStreams[i];
          this.pdfDocumentStreams.RemoveAt(i);
          stream.Dispose();
       }
   }
   #endregion
} 
```

我的“包装器”的调用代码如下所示：

```
 byte[] manipulatedResult = null;
    using (PdfDocumentManipulator manipulator = new PdfDocumentManipulator())
    {
        manipulator.AddFileToManipulate(file1bytes);
        manipulator.AddFileToManipulate(file2bytes);
        manipulatedResult = manipulator.Manipulate();
    } 
```

关于上面的几个问题：

1.  方法中的`using`子句是`AddFileToManipulate()`多余的和不必要的吗？
2.  `Dispose()`我在我的对象的方法中清理东西好吗？
3.  这是“可接受的”用法`MemoryStream`吗？我预计内存中不会同时有很多文件......总共可能有 1-10 个 PDF 页，每页大约 200KB。设计为在支持 ASP.NET 站点的服务器上运行的应用程序。
4.  有什么意见/建议吗？

感谢代码审查 :)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T02:35:54.830

AddFileToManipulate 让我害怕。

```
 public void AddFileToManipulate(byte[] pdfDocument)
   {
      using (MemoryStream stream = new MemoryStream(pdfDocument))
      {
         pdfDocumentStreams.Add(stream);
      }
   } 
```

此代码将已处置的流添加到您的 pdfDocumentStream 列表中。相反，您应该使用以下方法简单地添加流：

```
 pdfDocumentStreams.Add(new MemoryStream(pdfDocument)); 
```

并在 Dispose 方法中处理它。

此外，您应该考虑实现终结器以确保在有人忘记处置顶级对象的情况下处置东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T07:32:18.847

1.  AddFileToManipulate() 方法中的 using 子句是多余且不必要的吗？

更糟糕的是，它具有破坏性。您基本上是在添加内存流之前关闭它。有关详细信息，请参阅其他答案，但基本上，在最后处理，但不是任何其他时间。每次与对象一起使用都会导致在块的末尾发生 Dispose，即使该对象通过方法“传递”给其他对象也是如此。

2.  我在我的对象的 Dispose() 方法中清理东西好吗？

是的，但你让生活变得比需要的更困难。试试这个：

```
`foreach (var stream in this.pdfDocumentStreams)
{
    stream.Dispose();
}
this.pdfDocumentStreams.Clear();` 
```

`这同样有效，而且更简单。释放一个对象并不会删除它——它只是告诉它释放它的内部非托管资源。以这种方式对对象调用 dispose 很好 - 对象在集合中保持未被收集。您可以执行此操作，然后一次性清除列表。`

 `3.  这是 MemoryStream 的“可接受”用法吗？我预计内存中不会同时有很多文件......总共可能有 1-10 个 PDF 页，每页大约 200KB。设计为在支持 ASP.NET 站点的服务器上运行的应用程序。

这取决于你的情况。只有您可以确定将这些文件放在内存中的开销是否会给您带来问题。不过，这将是一个相当重的物体，所以我会小心使用它。

4.  有什么意见/建议吗？

实现终结器。每当您实现 IDisposable 时，这都是一个好主意。此外，您应该将您的 Dispose 实现重新设计为标准实现，或者将您的类标记为密封的。有关如何执行此操作的详细信息，[请参阅本文。](http://msdn.microsoft.com/en-us/library/ms244737(VS.80).aspx) 特别是，您应该有一个方法声明为`protected virtual void Dispose(bool disposing)`您的 Dispose 方法和您的终结器都调用。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T02:00:04.510

在我看来，您误解了 Using 的作用。

它只是替换的语法糖

```
MemoryStream ms;
try
{
ms = new MemoryStream();
}
finally
{
ms.Dispose();
} 
```

您在 AddFileToManipulate 中的使用是多余的。我会在 PdfDocumentManipulator 的构造函数中设置内存流列表，然后在所有内存流上调用 PdfDocumentManipulator 的 dispose 方法调用 dispose。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-19T02:27:55.083

边注。这似乎真的需要一个扩展方法。

```
public static void DisposeAll<T>(this IEnumerable<T> enumerable)
  where T : IDisposable {
  foreach ( var cur in enumerable ) { 
    cur.Dispose();
  }
} 
```

现在您的 Dispose 方法变为

```
public void Dispose() { 
  pdfDocumentStreams.Reverse().DisposeAll();
  pdfDocumentStreams.Clear();
} 
```

**编辑**

您不需要 3.5 框架即可拥有扩展方法。他们很乐意在 3.0 编译器上工作，目标是 2.0

[http://blogs.msdn.com/jaredpar/archive/2007/11/16/extension-methods-without-3-5-framework.aspx](http://blogs.msdn.com/jaredpar/archive/2007/11/16/extension-methods-without-3-5-framework.aspx)

# html - 如何将 HTML 表单提交到禁用调整大小的弹出窗口？

> ID：660810
> 
> 赞同：2
> 
> 时间：2009-03-19T01:57:42.100
> 
> 标签：html

我设计了一个带有提交按钮的 HTML 表单。但是，我不想将其提交到另一个页面，而是要提交到弹出窗口，在那里我可以限制弹出窗口的大小，比如“320x240”隐藏所有工具栏，禁用调整大小。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-19T02:26:16.057

这是我的尝试；这个 JavaScript 片段应该进入页面的头部：

```
<script>
process = function()
 {
    window.open('about:blank', 'popup', 'width=320,height=240,resizeable=no');
    document.login.setAttribute('target', 'popup');
    document.login.setAttribute('onsubmit', '');
    document.login.submit();
 };
</script> 
```

这是用于演示目的的示例表单：

```
<form action="handle.html" method="get" name="login" onsubmit="process(); return false;">
Username: <input type="text" name="username" id="username" /><br />
<input type="submit" />
</form> 
```

现在，这就是发生的事情：首先，我们设置一个表单并给它一个`onsubmit`属性，告诉它运行函数`process()`而`return false;`不是正常提交​​；从这一点开始，该函数接管并创建一个弹出窗口，为其命名和一些功能（无论如何，添加您想要的任何多余的），然后注意力回到我们现在设置的表单`target`我们刚刚创建的窗口名称的属性。

然后我们必须明确`onsubmit`我们之前设置的，否则同样的事情会再次发生，这肯定不是你想要的。最后，我们再次提交表单，它现在将所有信息传递到弹出窗口；从那里开始，它只是开始`handle.html`（或任何你最终调用你的处理页面）来处理数据。

希望我有所帮助。

# c# - “元素”是无效的 XmlNodeType

> ID：660811
> 
> 赞同：4
> 
> 时间：2009-03-19T01:57:46.153
> 
> 标签：c#, xml

我不明白这个。我真的没有得到 ReadEndElement。我假设在每个 ReadStartElement 之后，您需要关闭阅读器以推进到下一个开始元素，如果没有更多的开始元素，则关闭所有其他元素的 ReadEndElement？

返回的 XML 示例：

```
<Envelope>
<Body>
<RESULT>
<SUCCESS>true</SUCCESS>
<SESSIONID>dc302149861088513512481</SESSIONID>
<ENCODING>dc302149861088513512481
</ENCODING>
</RESULT>
</Body>
</Envelope>

           reader.Read();
            reader.ReadStartElement("Envelope");
            reader.ReadStartElement("Body");
            reader.ReadStartElement("RESULT");
            reader.ReadStartElement("SUCCESS");
            reader.ReadEndElement();
            reader.ReadStartElement("SESSIONID");
            _sessionID = reader.ReadString();
            reader.ReadEndElement();
            reader.ReadEndElement(); <-- error here
            reader.ReadEndElement();
            reader.ReadEndElement(); 
```

我忽略了重新调整的元素之一（编码），因为我不需要它......不确定这是否与它有关。也许我需要阅读每个元素，无论我是否想使用它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-19T02:06:09.363

您必须阅读文档中的每个节点（属性、元素、...）。

[如果阅读器位于一个元素上，您可以使用XmlReader.Skip](http://msdn.microsoft.com/en-us/library/system.xml.xmlreader.skip.aspx)跳过它（及其所有子节点）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-10-11T10:19:13.157

尝试使用 XmlSerializer 反序列化时遇到此错误。我有一个有效的 XML，其中包含一些`<br />` 在我的源文档中未编码的 HTML 标记。

```
<Event>
    <Id>1</Id>
    <Title>The first Sicknote with Chris Liberator</Title>
    <Copy>
     Sicknote - Techno vs Dubstep <br />
      ------------------------------------<br />
      <br /><br />
      Thursday 8th October - 11pm - 4am
    </Copy>
    <Date>2009-10-08T10:00:00</Date>
    <FlierImage>1.jpg</FlierImage>
  </Event> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2022-01-28T13:31:20.963

当我尝试使用以下元素解析 XML 时遇到错误：

```
<elem>><elem/> 
```

这是一个不正确的 XML 文件。

# iphone - 我们可以像日历应用程序那样更新 iPhone SDK 3.0 中的图标吗？

> ID：660818
> 
> 赞同：4
> 
> 时间：2009-03-19T02:01:07.847
> 
> 标签：iphone, iphone-sdk-3.0

在 iPhone 和 iPod Touch 上，日历应用程序每天都会更改图标，以便显示今天的日期。我已经使用 Apple 的支持事件来弄清楚如何在 2.x 中做到这一点，但他们说你不能。

有没有人在新的 iPhone 3.0 SDK 中找到允许这样做的 API？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T05:46:16.120

看起来不是这样：

> 您不能使用 SDK 更改应用程序包中的任何内容，包括图标。

虽然有几个人有一些可能的 hackie 想法。

[http://collison.ie/blog/2008/11/dynamic-defaultpng-files-on-the-iphone](http://collison.ie/blog/2008/11/dynamic-defaultpng-files-on-the-iphone)

**来源**

[https://devforums.apple.com/message/36001](https://devforums.apple.com/message/36001)

[https://devforums.apple.com/message/34548](https://devforums.apple.com/message/34548)

# c# - 将未映射的类与 NHibernate 命名查询一起使用

> ID：660820
> 
> 赞同：3
> 
> 时间：2009-03-19T02:01:12.870
> 
> 标签：c#, nhibernate, named-query

我正在使用带有 NHibernate 的自定义命名查询，我想返回一个 Person 对象的集合。Person 对象未使用 NHibernate 映射进行映射，这意味着我遇到了以下异常：

> System.Collections.Generic.KeyNotFoundException：给定的键不在字典中。

它在创建 Session 时被抛出，因为它在调用 NHibernate.Cfg.Mappings.GetClass(String className) 时找不到类名。这一切都是可以理解的，但我想知道是否有任何方法可以告诉 NHibernate 使用该类，即使我没有它的映射？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-19T15:37:07.703

你为什么不使用：

`query.SetResultTransformer(Transformers.AliasToBean(typeof(Person)));`

它将使用列别名作为属性名称将查询中每一列的数据插入到 Person 对象属性中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T15:44:23.490

如何创建一个返回未映射类型实例的查询？

我认为 Michal 有一个观点，也许你应该看看预测。（至少，这是我认为你正在寻找的）。

您在某些映射类型上创建查询，然后，您可以将该查询“投影”到“DTO”。为此，您必须“导入”您的 Person 类，以便 NHibernate 知道它，并且您必须使用 ResultTransformer。

像这样的东西：

```
ICriteria crit = session.CreateCriteria (typeof(Person));

// set some filter criteria

crit.SetProjection (Projections.ProjectionList()
                     .Add (Property("Name"), "Name")
                     .Add (Property( ... )
                   );

crit.SetResultTransformer(Transformers.AliasToBean(typeof(PersonView));

return crit.List<PersonView>(); 
```

但是，这仍然意味着您必须[导入](http://infozerk.com/averyblog/refactoring-using-object-constructors-in-hql-with-nhibernate/)该类，以便 NHibernate 知道它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-19T03:19:03.557

通过使用该类，NHibernate 基本上会猜测所涉及的所有内容，包括您打算为 Person 使用哪个表，以及字段映射。NHibernate 可能会被黑客入侵以基于匹配名称或其他内容进行动态绑定，但整个想法是使用 xml 文件创建从普通旧数据对象到数据库字段的映射。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-19T03:19:59.030

如果没有很好的理由不映射该类，只需添加映射即可获得最佳结果...

也就是说，您不能使用命名查询将结果直接注入到未映射的类中。您需要告诉它哪些列放入哪些字段，或者换句话说，一个映射。;) 但是，您可以从命名查询返回标量值，并且您可以获取这些对象数组并手动构建您的集合。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T03:43:12.110

为了解决这个问题，我最终使用了 TupleToPropertyResultTransformer 并提供了属性值列表。对此有一些限制，主要是 SQL 查询必须以与您向 TupleToPropertyResultTransformer 构造函数提供属性相同的顺序返回结果。

此外，属性类型是推断出来的，因此您需要小心仅返回整数值等的十进制列。除此之外，使用 TupleToPropertyResultTransformer 提供了一种相当简单的方法来使用 SQL 查询返回对象集合，而无需在 NHibernate 中显式映射对象.

# uml - 是否有用于 gui 事件映射的可视化图表格式？

> ID：660828
> 
> 赞同：2
> 
> 时间：2009-03-19T02:06:11.220
> 
> 标签：uml, diagram, modeling

有谁知道可以在 GUI 系统中映射事件的任何类型的 UML 变体？

我有一个非常复杂的事件驱动的 GUI 系统，我想创建一个图表，以便新开发人员可以轻松地了解各种视图触发的事件以及这些事件实例化/影响的模型/控制器或视图。

我一直在寻找看起来更像思维导图的东西，它在整个地方都有分支，而不是线性场景。

有没有人有任何想法？

问候，

克里斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T02:50:26.560

状态图。

旧且昂贵，但[这里](https://rads.stackoverflow.com/amzn/click/com/0201342782)有一篇关于使用状态图建模用户界面的好文章。我已经把我的页面磨损了......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-24T02:57:47.880

The communication diagram can lack sequence and it behaves more like a mind map than an activity or sequence diagram. If communicating events is your goal a state chart does show interaction, but rather, well, state. A communication diagram has less on it than an activitystate diagram, though that is not bad either, similar in nature.

You could just leverage UseCases and add keywords or label the uses edge/line. Not recommended if this will be maintained and be more than a pretty picture.

**(Image is slightly overloaded, you don't need the numbering and they don't have to be method calls)** [![http://www.agilemodeling.com/artifacts/communicationDiagram.htm](https://i.stack.imgur.com/gopfi.jpg)](https://i.stack.imgur.com/gopfi.jpg)
[(source: [agilemodeling.com](http://www.agilemodeling.com/images/models/communicationDiagram.jpg))]
[http://www.agilemodeling.com/artifacts/communicationDiagram.htm](http://www.agilemodeling.com/artifacts/communicationDiagram.htm)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T02:12:44.043

UML 活动图和状态图可以随处可见。

请参阅[http://www.agilemodeling.com/style/stateChartDiagram.htm](http://www.agilemodeling.com/style/stateChartDiagram.htm)

[![替代文字](https://i.stack.imgur.com/zxsoz.gif)](https://i.stack.imgur.com/zxsoz.gif)
[（来源：[agilemodeling.com](http://www.agilemodeling.com/images/style/stateChartDiagramSeminarRegistration.gif)）]

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T03:01:22.727

对于快速而肮脏的消息序列图，您无法击败[mscgen](http://www.mcternan.me.uk/mscgen/)的价格。它使用受 AT&T 的[Graphviz](http://www.graphviz.org/)包使用的语法启发的源文本，顺便说一句，这是呈现任意有向和无向图的好方法。

我经常使用 graphviz 来记录我的状态机，因为我发现与实现保持同步比 Visio 绘图更容易。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T03:06:57.797

最终帮助我*真正*理解 UML 状态图的书是 Samek 的[C/C++ 中的实用状态图，](https://rads.stackoverflow.com/amzn/click/com/1578201101)其中有几章关于它们以及构建基于状态的系统的令人印象深刻的实现框架。我认为仅仅为了解释如何用状态图思考是值得的。

为了实际创建快速状态图或类似的粗略图表，我在[GraphViz](http://www.graphviz.org/)中使用文本 DOT 语言做了大量工作，然后经常将这些图表直接包含到使用[doxygen](http://www.doxygen.nl)生成的文档中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-31T21:05:19.907

使用这个基于 D3 的自动最小生成树实现我取得了很好的效果。只需将图形边缘列表传递给它，它就会聚集并绘制一个类似 UML 的图表：

[https://github.com/cpettitt/dagre-d3](https://github.com/cpettitt/dagre-d3)

也非常适合状态图。![状态图](https://i.stack.imgur.com/6831O.jpg)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-06-16T02:57:51.730

我最近想起的另一种格式是 Bon 方法中的动态图。[我在Artima](http://www.artima.com/weblogs/viewpost.jsp?thread=158340)上写了一篇关于它的帖子。《[Seamless Object-Oriented Software Architecture](http://www.bon-method.com/index_normal.htm?book) 》一书于 2003 年免费提供。

这些图和通信图之间的区别在于将步骤分离为单独的图例。这本身可以读起来像一个用例，易于本地化，有时还可以显示替代解释。

![JOT文章中的示例](https://i.stack.imgur.com/qGM3s.png)

# python - 在 rss 提要中指定频道图像的 Django 方式

> ID：660836
> 
> 赞同：10
> 
> 时间：2009-03-19T02:11:26.807
> 
> 标签：python, django, rss

在 rss 提要中指定频道图像的“django 方式”是什么？我可以通过滚动自己的 xml 来手动完成，但正在寻找一种正确的方法。

**编辑** dobrych 的解决方案在这里不太适用，因为我专门询问 RSS 而不是 Atom 提要

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-29T21:55:08.557

找到了*正确*的做法。如[文档所述，我需要通过从](http://docs.djangoproject.com/en/dev/ref/contrib/syndication/?from=olddocs#custom-feed-generators)*Rss201rev2Feed 继承*和覆盖方法来创建自定义提要生成器

```
add_root_elements()

```

像这样：

```
class RssFooFeedGenerator(Rss201rev2Feed):
    def add_root_elements(self, handler):
        super(RssFooFeedGenerator, self).add_root_elements(handler)
        handler.addQuickElement(u"image", '',
            {
                 'url': u"http://www.example.com/images/logo.jpg",
                 'title': u"Some title",
                 'link': u"http://www.example.com/", 
             })     

class RssFooFeed(Feed):
    feed_type = RssFooFeedGenerator
    title = u"Foo items"
    link = u"http://www.example.com/"
    description = u"Some description" 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-01-17T11:58:11.157

对于有效的 RSS 2.0，你应该使用这个：

```
class ImageRssFeedGenerator(Rss201rev2Feed):
    def add_root_elements(self, handler):
        super(ImageRssFeedGenerator, self).add_root_elements(handler)
        handler.startElement(u'image', {})
        handler.addQuickElement(u"url", self.feed['image_url'])
        handler.addQuickElement(u"title", self.feed['title'])
        handler.addQuickElement(u"link", self.feed['link'])
        handler.endElement(u'image')

class LastPublishedPromiseFeed(Feed):
    link = 'http://www.example.com'
    feed_type = ImageRssFeedGenerator

    def feed_extra_kwargs(self, obj):
        return {'image_url': self.link + '/image.jpg'} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-19T02:50:45.090

我建议使用[django-atompub](http://code.google.com/p/django-atompub/)来生成 Atom 提要。它有非常好的类抽象和很多选项，所以没有任何 XML hacking，只有高级 Python 代码。

例子：

```
# Define feed class
class StreamFeed(Feed):
    ... [snipped]
    def item_links(self, item):
        return [{'rel': 'enclosure', 'href': item.file.url, 'length': item.file.size, 'type': item.mime.name},
        {'rel': 'alternate', 'href': full_url(item.get_absolute_url())}] 
```

我在我的开源照片博客 django 应用程序中使用了它。您可以通过[bitbucket repo](http://bitbucket.org/dobrych/mediatr/src/)查看示例。

完整的[提要生成代码](http://bitbucket.org/dobrych/mediatr/src/tip/feeds.py)。

# c++ - 负整数的 C++ 优化

> ID：660838
> 
> 赞同：1
> 
> 时间：2009-03-19T02:12:24.623
> 
> 标签：c++, c, optimization, micro-optimization

假设我们有一个负整数，比如 int a;

-a 有更快的实现吗？

我必须对此进行一些按位运算吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-19T02:16:53.020

几乎可以肯定，没有什么比您的编译器最有可能将其转换成的机器代码 NEG 指令更快的了。

如果有，我相信编译器会使用它。

对于二进制补码数，您不能将其加 1，但这几乎肯定会变慢。但我不完全确定 C/C++ 标准要求使用二进制补码（它们可能，我没有检查过）。

我认为这个问题属于那些试图重写`strcpy()`et al 以获得更快速度的人。那些人天真地假设 C 库`strcpy()`尚未通过使用特殊的机器代码指令进行大量优化（而不是大多数人第一次尝试的简单循环）。

您是否进行过性能测试，似乎表明您的否定花费了很长时间？

<微妙的幽默或我的妻子所说的不有趣>

</subtle-humor-or-what-my-wife-calls-unfunny>

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-19T02:24:42.907

你听说过“过早优化”这个词吗？如果您已经优化*了所有*代码，而这是唯一剩下的，那很好。如果没有，那你就是在浪费时间。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-19T02:28:31.353

为了澄清 Pax 的声明，

C++ 编译器不强制使用二进制补码，除了 1 种情况。将有符号类型转换为无符号类型时，如果数字为负数，则转换结果必须是整数的 2 的补码表示。

简而言之，没有比 -a 更快的方法了；即使有，它也不会是便携式的。还要记住，过早的优化是邪恶的。首先分析您的代码，然后处理瓶颈。

请参阅*C++ 编程语言，第 3 版。*，第 C.6.2.1 节。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-19T03:02:02.023

就 CPU 硬件而言，取反是一个非常简单的操作。我不知道有一个处理器需要更长的时间来进行否定而不是进行任何按位运算 - 其中包括一些 30 年历史的处理器。

只是好奇，是什么让你问这个问题？这当然不是因为您检测到了瓶颈。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T02:33:46.910

也许您应该考虑优化您的算法，而不是像这样的小事。如果这是优化的最后一件事，那么您的代码将尽可能快。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-19T11:59:41.013

所有好的答案。

如果`(-a)`有所作为，您已经进行了一些非常激进的性能调整。

对程序进行性能调优就像从湿海绵中取水一样。作为第一次编写程序，它非常潮湿。稍加努力，您就可以节省一些时间。用更多的努力，你可以把它弄干一些。

如果你真的很坚持，你可以把它放在你必须把它放在烈日下的地方，以从中获得最后的几个时间分子。

那是`(-a)`可能会有所作为的水平。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-19T02:14:45.023

您是否看到否定数字的性能问题？我很难想到大多数编译器都会对整数进行按位运算来否定它们。

# c++ - 在基于对话的项目与 SDI 项目之间进行选择

> ID：660843
> 
> 赞同：4
> 
> 时间：2009-03-19T02:14:21.823
> 
> 标签：c++, visual-studio, mfc

我对 MFC 并不陌生，但我想问这个论坛上的专家为什么会选择一个项目而不是另一个项目。我希望这不是一个愚蠢的问题，因为我对 MFC 比较陌生。

非常感谢

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-19T02:54:43.507

根据您的应用程序最适合的模板进行选择：

**单文档接口 (SDI)** - 如果您的应用程序一次只需要使用 1 个文档或数据对象或数据集

示例：记事本.exe

* * *

**多文档接口 (MDI)** - 如果您的应用程序需要一次处理多个文档或数据对象或数据集

示例：Visual Studio

* * *

**基于对话框**- 其他任何事情。

示例：计算器

* * *

无论您选择什么，最终您仍然可以使用相同的功能，并且您可以以任何方式对其进行自定义。所以你不会把自己限制在你开始的任何事情上。

所有变体都带有 CWinApp，它是派生 MFC 应用程序的基类。

对于基于对话框的应用程序，您也可以从[CDialog](http://msdn.microsoft.com/en-us/library/132s802t(VS.80).aspx)开始。对于 SDI 应用程序，您也可以从 CMainFrame、CDocument 和 CView 开始。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T03:03:38.837

如果您选择一个 SDI 项目，您将获得一个完整的模型-视图-控制器框架。你会得到一个文档类（继承自 CDocument），它理想地应该包含所有数据，以及一个视图类（继承自 CView）来处理显示。您将获得一个已附加菜单的托管框架，并且您可以覆盖一些功能以保存和加载到文件。

如果您有一个基于对话框的应用程序，那么您将获得一个对话框。而已。当然，这个对话框可以产生其他对话框，但应用程序本质上是由一个对话框组成的。

如果您正在开发一个只执行一项任务的小型应用程序，那么对话应用程序是合适的，因为您不需要开销。

如果您正在开发用户将加载、编辑和保存数据的应用程序，那么 SDI 路径会更合适。

回答完您的问题后，我会礼貌地询问您选择 MFC 而非 Windows 窗体是否有令人信服的理由。我相信 MFC 在当时是一项出色的技术，但 Visual Studio 套件提供了更高级的工具（如果您准备好走上 .NET 的道路）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-20T12:03:04.670

如果“文档”是您的应用程序的正确比喻，请使用 SDI 或 MDI。（一次只能打开一个文档，如果多于一个，则可以打开多个文档。）仔细想想，文档隐喻确实不适用于大多数应用程序。

# heap-memory - 免费商店的“堆”一词的由来是什么？

> ID：660855
> 
> 赞同：23
> 
> 时间：2009-03-19T02:23:24.360
> 
> 标签：heap-memory, terminology

我试图找到免费商店通常被称为堆的官方（或足够好的）原因。

除了它从数据段的末尾增长，我真的想不出一个好的理由，特别是因为它与堆数据结构关系不大。

注意：相当多的人提到这只是一堆杂乱无章的东西。但是对我来说，堆物理这个词意味着一堆物理上相互依赖的东西。你从下面拉出一个，其他所有东西都倒在上面，等等。换句话说，对我来说，堆听起来组织松散（例如，最新的东西在上面）。这并不是堆在大多数计算机上的实际工作方式，但如果你把东西放在堆的开头然后增长它，我想它可以工作。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-03-19T02:47:32.930

Knuth 拒绝将术语“堆”用作空闲内存存储的同义词。

> 几位作者在 1975 年左右开始将可用内存池称为“堆”。但是在本系列书籍中，我们将仅在与优先级队列相关的更传统意义上使用该词。（*基本算法，第 3 版*，第 435 页）

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-19T02:39:04.917

值得一提的是，早于 C 的 ALGOL68 有一个实际的*关键字* `heap`，用于从“全局堆”中为变量分配空间，而不是`loc`在堆栈上分配空间。

但我怀疑使用可能仅仅是因为它没有真正的结构。我的意思是，你不能保证在内存中获得最合适的块或下一个块，而是你会根据分配策略的突发奇想来获得你所得到的东西。

像大多数名字一样，它可能是一些只需要名字的程序员想到的。

我经常听说它有时被称为竞技场（很多个月前的一条错误消息说“内存竞技场已损坏”）。这会显示内存块在地址空间内以角斗式进行战斗的图像（就像电影 Tron 一样）。

最重要的是，它只是一个内存区域的名称，您也可以将其称为 brk-pool 或 sbrk-pool（在调用修改它之后）或其他十几个名称中的任何一个。

我记得当我们在 OSI 7 层模型还没有出现之前就将通信协议栈放在一起时，我们使用了分层方法，并且必须在每一层为块提出名称。

我们使用了块、段、块、节和各种其他名称，所有这些都只是表示一个固定长度的东西。可能堆有类似的起源：

> 卡罗尔：“嘿，鲍勃，对于一个只从大区域分配随机内存位的数据结构来说，有什么好名字？”
> 
> 鲍勃：“‘热气腾腾的马粪’怎么样？”
> 
> Carol：“谢谢，Bob，如果你同意的话，我会选择‘heap’。顺便问一下，离婚的进展如何？”

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-03-19T13:55:38.003

它被命名为一个堆，因为它会让人联想到一个*堆栈*的对比图像。

*   在一堆物品中，物品按照它们放置在那里的顺序放置在另一个之上，并且您只能移除最上面的一个（不会将整个东西翻倒）。

    ![像一堆文件一样堆叠](https://i.imgur.com/khqDF.jpg)

*   在堆中，物品的放置方式没有特定的顺序。您可以按任何顺序进入和移除项目，因为没有明确的“顶部”项目。

    ![像一堆甘草一样堆](https://i.imgur.com/E5QTV.jpg)

它很好地描述了在堆栈和堆中分配和释放内存的两种方式。嗯！

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-19T02:27:05.943

它是无序的。存储“堆”。

它不是一个有序的[堆数据结构](http://en.wikipedia.org/wiki/Heap_(data_structure))。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-19T04:01:44.390

我不知道它是否是第一个，但 ALGOL 68 有关键字 'heap' 用于从空闲内存堆中分配内存。

“堆”的第一次使用可能出现在 1958 年之间，当时 John McCarthy 为 Lisp 发明了垃圾收集和 ALGOL 68 的开发

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-19T02:59:50.530

这是一大堆杂乱无章的垃圾，除非你确切地知道在哪里看，否则什么也找不到。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-19T03:06:51.980

与堆栈相比，我一直认为这是一种描述它的聪明方式。堆就像一个杂草丛生的杂乱无章的堆栈。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-19T02:58:19.677

就像 java 和 javascript 一样，heap（免费存储）和 heap（数据结构）的命名是为了确保我们的兄弟情谊不会被外人渗透，从而保证我们的工作安全。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-19T07:20:42.417

堆通常具有以下特性：

1.  您无法预测块 malloc() 返回的地址。

2.  你不知道下一个 malloc() 返回的地址与前一个的地址有什么关系。

3.  您可以 malloc() 可变大小的块。

所以你有一些东西可以存储一堆可变大小的块，并以一些通常不可预测的顺序返回它们。如果不是“堆”，你还会怎么称呼它？

# c# - asp.net mvc 本地化

> ID：660872
> 
> 赞同：5
> 
> 时间：2009-03-19T02:34:10.140
> 
> 标签：c#, asp.net-mvc, localization, routing

我正在尝试使用路线实现本地化

我有以下内容：

```
routes.MapRoute( "DefaultLocalized", 
                 "{lang}/{controller}/{action}/{id}",
                 new { controller = "Home",
                       action = "Index",
                       id = "",
                       lang = "en" }
               );

routes.MapRoute( "Default",
                 "{controller}/{action}/{id}",
                 new { controller = "Home",
                       action = "Index",
                       id = "" }
               ); 
```

当我调用我的页面`domain/en/home/index`时，它可以正常工作，但是当我调用时，`domain/home/index`我收到错误 404：找不到资源。

此外，当我在`domain/en/home/index`并单击安全页面时，我会被重定向到`domain/Account/login`如何重定向到`domain/en/Account/login`？

此外，当我收到应用程序错误时，如何重定向到`domain/en/home/error`？

真正的问题是如何使用语言作为路由参数来实现本地化？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-19T05:09:49.610

默认情况下，路由将从左到右匹配，因此“domain/home/index”将首先匹配 lang=domain、controller=index、action（默认为 index）、id（默认为 0/null）。

为了解决这个问题，我相信您可以在 MapRoute 上指定一个正则表达式（例如，匹配恰好有 2 个字符的语言） - 它在某些时候发生了变化......（抱歉，目前没有 IDE，所以我可以'不准确检查）。

凭记忆，*可能*是：

```
routes.MapRoute( "DefaultLocalized", 
             "{lang}/{controller}/{action}/{id}",
             new { controller = "Home",
                   action = "Index",
                   id = "",},
             new { lang = "[a-z]{2}" }
           ); 
```

请注意，您可能不希望每个操作都采用“字符串 lang”，因此您应该在基本控制器或操作过滤器中处理路由的“lang”部分（在任何一种情况下，大概将信息添加到 ViewData）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-10-16T08:48:15.900

我知道这是一个非常古老的问题，但刚刚解决了完整的相关问题，我想我会分享我的解决方案。

下面是一个完整的解决方案，包括一些额外的技巧，可以轻松更改语言。它允许特定的文化，而不仅仅是特定的语言（但在这个例子中只保留了语言部分）。

## 特点包括：

*   在确定语言时回退到浏览器区域设置
*   使用 cookie 在访问期间保留语言
*   用 url 覆盖语言
*   支持通过链接更改语言（例如简单的菜单选项）

## 第一步：在RouteConfig中修改RegisterRoutes

这个新的路由包括一个约束（正如其他人也建议的那样），以确保语言路由不会抓取某些标准路径。不需要默认语言值，因为它全部由 处理`LocalisationAttribute`（参见步骤 2）。

```
 public static void RegisterRoutes(RouteCollection routes)
    {
        ...

        // Special localisation route mapping - expects specific language/culture code as first param
        routes.MapRoute(
            name: "Localisation",
            url: "{lang}/{controller}/{action}/{id}",
            defaults: new { controller = "Home", action = "Index", id = UrlParameter.Optional },
            constraints: new { lang = @"[a-z]{2}|[a-z]{2}-[a-zA-Z]{2}" }
        );

        // Default routing
        routes.MapRoute(
            name: "Default",
            url: "{controller}/{action}/{id}",
            defaults: new { controller = "Home", action = "Index", id = UrlParameter.Optional }
        );

    } 
```

## 步骤 2：创建本地化属性

这将在处理控制器请求之前查看控制器请求，并根据 URL、cookie 或默认浏览器文化更改当前文化。

```
// Based on: http://geekswithblogs.net/shaunxu/archive/2010/05/06/localization-in-asp.net-mvc-ndash-3-days-investigation-1-day.aspx
public class LocalisationAttribute : ActionFilterAttribute
{
    public const string LangParam = "lang";
    public const string CookieName = "mydomain.CurrentUICulture";

    // List of allowed languages in this app (to speed up check)
    private const string Cultures = "en-GB en-US de-DE fr-FR es-ES ro-RO ";

    public override void OnActionExecuting(ActionExecutingContext filterContext)
    {
        // Try getting culture from URL first
        var culture = (string)filterContext.RouteData.Values[LangParam];

        // If not provided, or the culture does not match the list of known cultures, try cookie or browser setting
        if (string.IsNullOrEmpty(culture) || !Cultures.Contains(culture))
        {
            // load the culture info from the cookie
            var cookie = filterContext.HttpContext.Request.Cookies[CookieName];
            var langHeader = string.Empty;
            if (cookie != null)
            {
                // set the culture by the cookie content
                culture = cookie.Value;
            }
            else
            {
                // set the culture by the location if not specified - default to English for bots
                culture = filterContext.HttpContext.Request.UserLanguages == null ? "en-EN" : filterContext.HttpContext.Request.UserLanguages[0];
            }
            // set the lang value into route data
            filterContext.RouteData.Values[LangParam] = langHeader;
        }

        // Keep the part up to the "-" as the primary language
        var language = culture.Split(new char[] { '-' }, StringSplitOptions.RemoveEmptyEntries)[0];
        filterContext.RouteData.Values[LangParam] = language;

        // Set the language - ignore specific culture for now
        Thread.CurrentThread.CurrentUICulture = CultureInfo.CreateSpecificCulture(language);

        // save the locale into cookie (full locale)
        HttpCookie _cookie = new HttpCookie(CookieName, culture);
        _cookie.Expires = DateTime.Now.AddYears(1);
        filterContext.HttpContext.Response.SetCookie(_cookie);

        // Pass on to normal controller processing
        base.OnActionExecuting(filterContext);
    }
} 
```

## 第 3 步：将本地化应用到所有控制器

例如

```
[Localisation]  <<< ADD THIS TO ALL CONTROLLERS (OR A BASE CONTROLLER)
public class AccountController : Controller
{ 
```

## 第 4 步：更改语言（例如从菜单中）

这是它变得有点棘手并需要一些解决方法的地方。

将 ChangeLanguage 方法添加到您的帐户控制器。这将从“以前的路径”中删除任何现有的语言代码，以使新语言生效。

```
 // Regex to find only the language code part of the URL - language (aa) or locale (aa-AA) syntax
    static readonly Regex removeLanguage = new Regex(@"/[a-z]{2}/|/[a-z]{2}-[a-zA-Z]{2}/", RegexOptions.Compiled);

    [AllowAnonymous]
    public ActionResult ChangeLanguage(string id)
    {
        if (!string.IsNullOrEmpty(id))
        {
            // Decode the return URL and remove any language selector from it
            id = Server.UrlDecode(id);
            id = removeLanguage.Replace(id, @"/");
            return Redirect(id);
        }
        return Redirect(@"/");
    } 
```

## 第 5 步：添加语言菜单链接

菜单选项由一个链接组成，该链接带有指定为路由参数的新语言。

例如（剃刀示例）

```
<li>@Html.ActionLink("English", "ChangeLanguage", "Account", new { lang = "en", id = HttpUtility.UrlEncode(Request.RawUrl) }, null)</li>
<li>@Html.ActionLink("Spanish", "ChangeLanguage", "Account", new { lang = "es", id = HttpUtility.UrlEncode(Request.RawUrl) }, null)</li> 
```

返回的 URl 是当前页面，经过编码可以成为 URL 的 id 参数。这意味着您需要启用某些转义序列，否则 Razor 会拒绝这些转义序列作为潜在的安全违规行为。

注意：对于非剃须刀设置，您基本上需要一个具有新语言和当前页面相对 URL 的锚点，路径如下： `http://website.com/{language}/account/changelanguage/{existingURL}`

where`{language}`是新的文化代码，并且`{existingURL}`是当前相对页面地址的 URL 编码版本（这样我们将返回相同的页面，并选择新的语言）。

## 第 6 步：在 URL 中启用某些“不安全”字符

返回 URL 所需的编码意味着您需要在 中启用某些转义字符，`web.config`否则现有 URL 参数将导致错误。

在您的 web.config 中，找到`httpRuntime`标签（或添加它）`<system.web>`并将以下内容添加到其中（基本上删除此属性的标准版本中的 % ）：

```
 requestPathInvalidCharacters="&lt;,&gt;,&amp;,:,\,?" 
```

在您的 web.config 中，找到该`<system.webserver>`部分并在其中添加以下内容：

```
<security>
  <requestFiltering allowDoubleEscaping="true"/>
</security> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-19T06:16:23.897

将约束添加为 new {lang = "[az]{2}"}。

此外，删除默认的 lang = "en"。如果你不这样做，当你在没有它的情况下浏览它时，路由会抓取语言规则。因此，如果您正在查看*域*并选择 About，它将使用 domain/en/Home/About 而不是更简单的 domain/Home/About

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-19T12:50:35.523

您还可以引入比 Marc Gravell 和 Freddy Rios 更严格的约束。

类似“en|de|fr|es”的东西。这意味着对语言进行硬编码，但通常这些语言很少且为人所知。

# apache-flex - Actionscript 和 ViewStack = 无法访问空对象引用的属性或方法

> ID：660878
> 
> 赞同：2
> 
> 时间：2009-03-19T02:35:28.297
> 
> 标签：apache-flex, actionscript-3, oop

我正在以面向对象的方式编写一个弹性程序，并且我已经到了创建一个 ViewStack 来容纳各种面板的地步。我的问题是，当我向 ViewStack 添加面板时，它会引发上述错误。毫无疑问，答案很明显，所以这里是包含我的 ViewStack 的管理器类的构造函数。

```
stack = new ViewStack();
loginPanel = new LoginPanel;
regPanel = new RegisterPanel;
stack.creationPolicy = "all";
stack.addChild(loginPanel);
stack.currentState = "loginPanel"; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T13:22:41.157

我不确定你为什么要设置`currentState`. `ViewStack`你想选择那个孩子吗？如果是这样，请尝试改用该`selectedChild`属性。这应该有效：

```
{
    stack = new ViewStack();

    loginPanel = new LoginPanel();

    regPanel = new RegisterPanel();

    stack.creationPolicy = "all";

    stack.addChild(loginPanel);

    stack.selectedChild = loginPanel;
} 
```

# wpf - 使用绑定重构 XAML 代码

> ID：660879
> 
> 赞同：0
> 
> 时间：2009-03-19T02:35:31.120
> 
> 标签：wpf, binding, refactoring, user-controls

我尝试通过引入新的用户控件来重构这样的 XAML：

```
<Window ...>
  <ComboBox ItemsSource="{Binding Greetings}" />
</Window> 
```

添加控件后，我有

控制 XAML：

```
<UserControl ...>
  <ComboBox ItemsSource="{Binding Items}" />
</UserControl> 
```

控制C#：

```
public static readonly DependencyProperty ItemsProperty =
  WpfUtils.Property<IEnumerable, ControlA>("Items");

public IEnumerable Items { get; set; } 
```

新窗口 XAML：

```
<Window ...>
  <uc:ControlA Items="{Binding Greetings}" />
</Window> 
```

在此之后，我在 ComboBox 中什么也看不到。这里有什么问题？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-19T09:42:47.050

您的 ComboBox 绑定到 DataContext。由于您的 DataContext 仍然是一个带有名为 Greetings 的列表的对象，因此这将不起作用...

您的 ContolA 应类似于以下内容：

```
<UserControl x:Name="Root" ...>
  <ComboBox ItemsSource="{Binding ElementName=Root, Path=Items}" />
</UserControl> 
```

现在，您的组合框绑定到 ControlA 的 Items 属性，而不是 DataContext 属性...

希望这可以帮助..

# flash - 您可以在 Eclipse-RCP 应用程序中嵌入 Flash (SWF)

> ID：660887
> 
> 赞同：1
> 
> 时间：2009-03-19T02:40:03.057
> 
> 标签：flash, eclipse-rcp

我没有 Eclipse-RCP 的背景。我的理解是 eclipse-rcp 应用程序是一种类似于 Adob​​e Air 的富客户端技术。

是否可以在 eclipse-rcp 应用程序内的面板中嵌入 swf flash 电影？flash 可以通过 ExternalInterface 与应用程序对话吗？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T13:10:12.437

[通过浏览器组件嵌入 flash](http://dev.eclipse.org/newslists/news.eclipse.platform.swt/msg42142.html)
[swt/java 和 flash 通信](http://osflash.org/pipermail/osflash_osflash.org/2005-October/004506.html)

我假设 flash 和 swf 是相同的（我已经很久没有做任何导演的东西了）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T02:47:24.710

看起来你可以找到一个合理的教程[http://rcpquickstart.com/2009/03/03/video-and-eclipse/](http://rcpquickstart.com/2009/03/03/video-and-eclipse/)。不幸的是，编解码器似乎存在一些问题，但希望它对您有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-02T00:51:40.047

如果没有更直接的选项，您可以使用嵌入您的 swf 的 html 文档嵌入 SWT 浏览器小部件。不是最干净的解决方案，但如果您知道目标平台上有支持 Flash 的浏览器，这将起作用。

# python - django：使用管理员日期选择器

> ID：660898
> 
> 赞同：13
> 
> 时间：2009-03-19T02:48:29.760
> 
> 标签：python, django, forms, django-forms, date

我正在尝试在我自己的 django 表单中使用管理员日期选择器。

大致遵循这里的讨论：http: [//www.mail-archive.com/django-users@googlegroups.com/msg72138.html](http://www.mail-archive.com/django-users@googlegroups.com/msg72138.html)

我有

a）在我的 forms.py 中包含该行

```
from django.contrib.admin import widgets 
```

b）并像这样使用小部件：

```
date = forms.DateTimeField(widget=widgets.AdminDateWidget()) 
```

c）在我的实际模板中，我添加了：

```
{{form.media}} 
```

包括 js / 样式等。

但是，当我尝试查看我的表单时，我没有得到很好的小部件；只是一个普通的文本框。Firefox javascript 错误控制台向我显示：

gettext 未在 calendar.js 中定义（第 26 行）

和

addEvent 未在 DateTimeShortcuts.js 中定义（第 254 行）

有什么建议么？这是 Django 自己的 javascript 库中的错误吗？

更新：基本上，需要包括核心和（或假的）i18lization

更新 2：Carl 指出这几乎是[Using Django time/date widgets in custom form](https://stackoverflow.com/questions/38601/using-django-time-date-widgets-in-custom-form/38916#38916)的副本（尽管从不同的位置开始）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T03:42:13.737

不，这不是错误。

它试图在 js 中调用 gettext() 国际化函数。您可以像在 python 代码或模板中那样进行 js 国际化，这只是一个鲜为人知的功能。

如果你的项目中不使用 js 国际化，你可以放。

```
<script>function gettext(txt){ return txt }</script> 
```

在您的顶部模板中，因此 js 解释器不会阻塞。

我知道这是一种解决问题的hacky方法。

编辑：

或者，您可以包含确切的 jsi18n js django 管理员参考，以使其即使与其他语言一起工作。我不知道它是哪一个。

这是今天发布在 django-users 上的：

[http://groups.google.com/group/django-users/browse_thread/thread/2f529966472c479d#](http://groups.google.com/group/django-users/browse_thread/thread/2f529966472c479d#)

也许是你，无论如何，以防万一。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T03:46:03.337

我想我通过将这些行明确添加到我的模板中解决了前半部分：

```
<script type="text/javascript" src="../../../jsi18n/"></script> 
<script type="text/javascript" src="/admin_media/js/core.js"></script>
<script type="text/javascript" src="/admin_media/js/admin/RelatedObjectLookups.js"></script> 
```

但它仍然报告不知道gettext

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T12:42:14.353

您可能会发现以下作品适合您：

```
<link href="/media/css/base.css" rel="stylesheet" type="text/css" media="screen" />
<script type="text/javascript" src="/admin/jsi18n/"></script>
<script type="text/javascript" src="/media/js/core.js"></script>
{{ form.media }} 
```

# iphone - drawAtPoint: 和 drawInRect: 模糊文本

> ID：660904
> 
> 赞同：8
> 
> 时间：2009-03-19T02:50:33.657
> 
> 标签：iphone, cocoa-touch, fonts, font-size

使用 drawAtPoint:、drawInRect: 甚至设置 UILabels 的 text 属性绘制字符串时 - 文本有时会显得有些模糊。

我倾向于在大多数地方使用 Helvetica，我注意到特定的字体大小会导致在模拟器和设备上出现某种程度的模糊。

例如：

```
UIFont *labelFont = [UIFont fontWithName:@"Helvetica-Bold" size:12]; 
```

将导致生成的标签具有稍微模糊的文本。

```
UIFont *labelFont = [UIFont fontWithName:@"Helvetica-Bold" size:13]; 
```

产生清晰的文本。

我的问题是为什么会发生这种情况？仅仅是为字体选择最佳字体大小的问题吗？如果是这样，最佳字体大小是多少？

更新：似乎可能不是字体大小导致模糊。矩形的中心可能是一个小数点。这是我在 Apple 开发者论坛上找到的评论：

> 检查位置。它可能在小数像素上。将中心更改为整数值。

我将所有点的值四舍五入，但仍有一些地方文本仍然模糊。有没有人遇到过这个问题？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-24T03:45:18.950

我已经解决了这个问题。

只需确保您绘制的点或矩形不会出现在小数像素上。

即`NSLog(@"%@", NSStringFromCGRect(theRect))`确定在分数像素上绘制的点。然后`round()`在这一点上打电话。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-24T22:25:10.880

您可能想查看 NSIntegralRect()，它可以满足您的需求。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-19T22:07:05.397

如果这是不正确的，请原谅我的无知，我对 iPhone 或 Cocoa 一无所知。

如果您要求文本在矩形中居中，您可能还需要确保矩形的宽度和/或高度是偶数。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-30T13:43:26.087

我也遇到过这个问题，但我的解决方案不同，可能会对某人有所帮助。`UIView`我的问题是通过`TouchesBegan` 和更改对象的大小后文本模糊，`CGAffineTransformMakeScale`然后回到`CGAffineTransformIdentity`.`TouchesEnded`

我尝试了不同的文本大小和 x 和 y 中心点的舍入，但都没有奏效。我的问题的解决方案是对我的宽度和高度使用均匀的尺寸`UIView`！

希望这可以帮助 ....

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-06T13:54:47.070

根据我的实验，某些字体在某些尺寸下无法清晰呈现。例如 Helvetica-Bold 不呈现“.”。在 16.0f 时很好，但在 18.0f 时很清晰。（如果你仔细观察，“。”的顶部像素是模糊的。）

在我注意到这一点之后，每次看到 UIView 时我都会感到厌烦，因为它是动态渲染的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-03-16T02:22:00.383

就我而言，我在自定义上绘制了文本`CALayer`，结果变得非常模糊。我通过设置`contentScale`适当的值来解决它：

目标-C：

```
layer.contentsScale = [UIScreen mainScreen].scale; 
```

迅速：

```
layer.contentsScale = UIScreen.main.scale 
```

# wcf - 在事物的异步事件方案中关闭服务客户端的最佳方法

> ID：660905
> 
> 赞同：1
> 
> 时间：2009-03-19T02:50:39.617
> 
> 标签：wcf

我有一个使用异步事件（在 svcutil 中使用`/async`和）实现的 WCF 服务客户端。`/tcv:Version35`

管理服务客户端的最佳方式是什么？

我在每个请求上创建一个新的服务客户端，并在事件委托返回时关闭服务客户端。在每个请求上创建一个新的服务客户端是一种好习惯吗？如果我尝试使用相同的服务客户端，那么一旦提供请求，我就必须取消注册每个请求的事件处理程序（这在某种程度上看起来不像是实现这一点的优雅方式）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-19T02:52:14.993

如果您的服务是无状态/无会话的，那么创建服务请求并在使用后关闭/处置它们是一个好习惯。

[有关如何正确处理 WCF 服务客户端的](http://blog.genom-e.com/PermaLink,guid,b9e3019d-0d68-4344-9c7a-407774323d0f.aspx)信息，请参阅此链接

# c - pthread_cond_timedwait 立即返回

> ID：660916
> 
> 赞同：9
> 
> 时间：2009-03-19T03:00:46.423
> 
> 标签：c, multithreading, conditional, system, pthreads

我有一个奇怪的问题。我有以下代码：

```
 dbg("condwait: timeout = %d, %d\n", 
        abs_timeout->tv_sec, abs_timeout->tv_nsec);
    ret = pthread_cond_timedwait( &q->q_cond, &q->q_mtx, abs_timeout );
    if (ret == ETIMEDOUT)
    {
      dbg("cond timed out\n");
      return -ETIMEDOUT;
    } 
```

`dbg`在每一行之前调用`gettimeofday`并在该行前面加上时间。它导致以下输出：

```
 7.991151: condwait: timeout = 5, 705032704
    7.991158: cond timed out 
```

如您所见，两条调试线之间只传递了 7 微秒，但`pthread_cond_timedwait`返回了`ETIMEDOUT`. 这怎么可能发生？我什至尝试在初始化 cond 变量时将时钟设置为其他值：

```
int ret;
ret = pthread_condattr_init(&attributes);
if (ret != 0) printf("CONDATTR INIT FAILED: %d\n", ret);
ret = pthread_condattr_setclock(&attributes, CLOCK_REALTIME);
if (ret != 0) printf("SETCLOCK FAILED: %d\n", ret);
ret = pthread_cond_init( &q->q_cond, &attributes );
if (ret != 0) printf("COND INIT FAILED: %d\n", ret); 
```

（没有打印出任何错误消息）。我都试过了`CLOCK_REALTIME`和`CLOCK_MONOTONIC`。

此代码是阻塞队列的一部分。我需要这样的功能，如果在 5 秒内没有任何东西放在这个队列上，就会发生其他事情。互斥体和条件都被初始化，因为如果我不使用阻塞队列工作正常`pthread_cond_timedwait`。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-19T03:05:56.070

pthread_cond_timedwait 需要绝对时间，而不是相对时间。您需要通过将当前时间添加到超时值来使您的等待时间成为绝对时间。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-11-09T07:07:58.623

溢出`timespec`通常是奇怪超时的罪魁祸首。
检查**EINVAL：**

```
void timespec_add(struct timespec* a, struct timespec* b, struct timespec* out)
{
    time_t sec = a->tv_sec + b->tv_sec;
    long nsec = a->tv_nsec + b->tv_nsec;

    sec += nsec / 1000000000L;
    nsec = nsec % 1000000000L;

    out->tv_sec = sec;
    out->tv_nsec = nsec;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-19T03:07:00.090

条件变量可以虚假地解除阻塞。您需要循环检查它并每次检查条件。您可能还需要更新超时值。

`pthread_cond_timedwait` [我在这里](http://www.opengroup.org/onlinepubs/000095399/functions/pthread_cond_timedwait.html)找到了一些文档。

> 当使用条件变量时，总是有一个布尔谓词涉及与每个条件相关联的共享变量等待如果线程应该继续，则该条件等待为真。可能会发生来自 pthread_cond_timedwait() 或 pthread_cond_wait() 函数的虚假唤醒。由于 pthread_cond_timedwait() 或 pthread_cond_wait() 的返回并不意味着该谓词的任何值，因此应在此类返回时重新评估谓词。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2017-03-20T10:48:56.363

正如已经在其他答案中提到的那样，您必须使用绝对时间。从 C11 开始，您可以使用`timespec_get()`.

```
struct timespec time;
timespec_get(&time, TIME_UTC);
time.tv_sec += 5;

pthread_cond_timedwait(&cond, &mutex, &time); 
```

# wpf - 为什么我的 WPF 路径动画闪烁？

> ID：660919
> 
> 赞同：3
> 
> 时间：2009-03-19T03:01:37.483
> 
> 标签：wpf, xaml, animation

为什么下面的动画在 MouseLeave 上闪烁并表现得很傻？如果可以复制，我会发布一个截屏视频。

```
<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">
  <Canvas>
    <Path Fill="Blue" Margin="15,15,15,15">
      <Path.Data>
        <!-- Describes an ellipse. -->
        <EllipseGeometry x:Name="MyAnimatedEllipseGeometry" Center="200,100" RadiusX="15" RadiusY="15" />
      </Path.Data>
      <Path.Triggers>
        <EventTrigger RoutedEvent="UIElement.MouseEnter">
          <BeginStoryboard>
            <Storyboard Duration="0:0:.5">
              <DoubleAnimation Storyboard.TargetName="MyAnimatedEllipseGeometry" 
                         Storyboard.TargetProperty="RadiusX"
                         From="15" To="100" />
              <DoubleAnimation Storyboard.TargetName="MyAnimatedEllipseGeometry" 
                         Storyboard.TargetProperty="RadiusY"
                         From="15" To="100" />
            </Storyboard>
          </BeginStoryboard>
        </EventTrigger>
        <EventTrigger RoutedEvent="UIElement.MouseLeave">
          <BeginStoryboard>
            <Storyboard Duration="0:0:.5">
              <DoubleAnimation Storyboard.TargetName="MyAnimatedEllipseGeometry" 
                         Storyboard.TargetProperty="RadiusX"
                         From="100" To="15" />
              <DoubleAnimation Storyboard.TargetName="MyAnimatedEllipseGeometry" 
                         Storyboard.TargetProperty="RadiusY"
                         From="100" To="15" />
            </Storyboard>
          </BeginStoryboard>
        </EventTrigger>
      </Path.Triggers>
    </Path>
  </Canvas>
</Page> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T15:34:11.753

原因是您`From`在`DoubleAnimation`s 上指定了 a。

如果发生时半径小于 100 `MouseLeave`，则该`From`属性将使其跃升至 100 并可能导致`MouseEnter`. 然后，您有两个相互竞争的动画，当椭圆半径在光标下方闪烁时，鼠标事件变得疯狂。

解决方案是省略`From`属性，这将导致动画从当前半径所在的任何位置开始：

```
<Page xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" Title="Window1">
    <Canvas>
        <Path Margin="15,15,15,15" Fill="Blue">
            <Path.Data>
                <!-- Describes an ellipse. -->
                <EllipseGeometry x:Name="MyAnimatedEllipseGeometry" Center="200,100" RadiusX="15" RadiusY="15"/>
            </Path.Data>
            <Path.Triggers>
                <EventTrigger RoutedEvent="UIElement.MouseEnter">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetName="MyAnimatedEllipseGeometry" Duration="0:0:.5" Storyboard.TargetProperty="RadiusX" To="100"/>
                            <DoubleAnimation Storyboard.TargetName="MyAnimatedEllipseGeometry" Duration="0:0:.5" Storyboard.TargetProperty="RadiusY" To="100"/>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
                <EventTrigger RoutedEvent="UIElement.MouseLeave">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation Storyboard.TargetName="MyAnimatedEllipseGeometry" Duration="0:0:.5" Storyboard.TargetProperty="RadiusX" To="15"/>
                            <DoubleAnimation Storyboard.TargetName="MyAnimatedEllipseGeometry" Duration="0:0:.5" Storyboard.TargetProperty="RadiusY" To="15"/>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Path.Triggers>
        </Path>
    </Canvas>
</Page> 
```

在不相关的说明中，当您设置时`Storyboard.Duration`，它不会加速您的子动画，它只会`Storyboard`过早结束。你真的想`Duration`在你的孩子上设置`DoubleAnimation`- 我已经修改了上面的 XAML 来做到这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T03:13:23.383

总是有硬件的常见罪魁祸首。但我怀疑这可能与执行动画所花费的时间有关。尝试增加动画运行的时间长度，或调整您正在移动的值的大小。

从 100 过渡到 15 半秒的时间并不多，反之亦然，因此您可能只是遇到了不够平滑的过渡，从而导致动画断断续续。请记住，时间是关键，您的目标应该至少为 30 fps 以获得流畅的动画。

# javascript - 如何在 jQuery 中获取当地时间？

> ID：660927
> 
> 赞同：13
> 
> 时间：2009-03-19T03:06:14.493
> 
> 标签：javascript, jquery, plugins, time

我正在使用 jQuery，我需要获取德国的当地时间。

从任何国家/地区访问我的网站的任何人都应该能够知道现在在德国的时间。

如果时间在 0:00 到 12:00 之间，我需要发出警报：“早安”。

如果时间在 12:00 到 17:00 之间，我需要发出警报：“下午好”。

如何在 jQuery 中实现这一点？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-19T04:06:05.003

您可以获取客户端的本地时区偏移量以获取 GMT 时间，然后添加德国时区（中欧时间 GMT+1）的偏移小时数：

```
function getDate(offset){
  var now = new Date();
  var hour = 60*60*1000;
  var min = 60*1000;
  return new Date(now.getTime() + (now.getTimezoneOffset() * min) + (offset * hour));
}

//...

var dateCET = getDate(1); // Central European Time is GMT +1

if (dateCET.getHours() < 12) {
    alert ("Good morning.");
} else {
    alert ("Good afternoon.");
} 
```

**更新：**我同意@Josh，上面的代码完全依赖于客户端。让我们尝试做得更好：

```
$(document).ready(function(){
  var timezone = "Europe/Berlin";
  $.getJSON("http://json-time.appspot.com/time.json?tz="+timezone+"&callback=?",
    function(data){
      if (data.hour < 12) {
        alert ("Good morning in "+timezone);
      } else {
        alert ("Good afternoon in "+timezone);
      }
    })
}); 
```

我们现在利用[JSONP](http://remysharp.com/2007/10/08/what-is-jsonp/)向[jsontime](http://simonwillison.net/2008/Jun/21/jsontime/)服务器进行跨域请求，该服务器公开了一个完整的 JSON API 来查询时间和时区信息。

[您可以在此处](http://jsbin.com/ozuku/edit)使用代码，也可以在[此处](http://json-time.appspot.com/)探索 JSONP API 。

万岁！，没有服务器端代码！

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-19T03:22:54.140

您想获得德国的时间，还是用户所在时区的时间，无论他们身在何处？如果是后者，该`Date()`函数默认在本地时区工作。

```
var d = new Date();    // defaults to the current time in the current timezone
if (d.getHours() < 12) {
    alert ("Good morning.");
} else {
    alert ("Good afternoon.");
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-31T04:11:27.833

您需要将 Web 服务器的日期/时间注入页面上的隐藏字段，然后您可以使用 jQuery 访问它并加载自然的[Javascript Date](http://www.w3schools.com/jsref/jsref_obj_date.asp)对象。您**不想**依赖客户端的日期/时间，因为它超出了您的控制范围，并且可能被设置为令人发指的东西。相信我。

# jquery - 如何更改 ModelForm 中所有 Django 日期字段的默认小部件？

> ID：660929
> 
> 赞同：42
> 
> 时间：2009-03-19T03:06:56.317
> 
> 标签：jquery, django, django-forms, widget, django-widget

给定一组典型模型：

```
# Application A
from django.db import models
class TypicalModelA(models.Model):
    the_date = models.DateField()

 # Application B
from django.db import models
class TypicalModelB(models.Model):
    another_date = models.DateField()

... 
```

如何将*所有*DateFields 的默认小部件更改为自定义 MyDateWidget？

我问是因为我希望我的应用程序有一个用于输入日期的 jQueryUI 日期选择器。

我已经考虑过使用我的自定义小部件扩展 django.db.models.DateField 的自定义字段。这是实施这种全面变革的最佳方式吗？这样的更改将需要专门将特殊的 MyDateField 导入每个模型，这是劳动密集型的，容易出现开发人员错误（即一些模型。DateField 将通过），并且在我看来似乎是不必要的重复工作。另一方面，我不喜欢修改被认为是models.DateField 的规范版本的东西。

想法和意见表示赞赏。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-03-19T05:41:25.710

您可以在您的`ModelForm`类上声明一个属性，称为`formfield_callback`. 这应该是一个将 Django 模型`Field`实例作为参数的函数，并返回一个表单`Field`实例以在表单中表示它。

然后您所要做的就是查看传入的模型字段是否是一个实例`DateField`，如果是，则返回您的自定义字段/小部件。如果没有，模型字段将有一个名为的方法`formfield`，您可以调用该方法来返回其默认表单字段。

所以，像：

```
def make_custom_datefield(f):
    if isinstance(f, models.DateField):
        # return form field with your custom widget here...
    else:
        return f.formfield(**kwargs)

class SomeForm(forms.ModelForm)
    formfield_callback = make_custom_datefield

    class Meta:
        # normal modelform stuff here... 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-19T03:12:43.790

[这篇文章](http://collingrady.wordpress.com/2008/07/24/useful-form-tricks-in-django/)帮助了我无数次。

它的核心涉及覆盖 ModelForm 的`__init__`方法，然后调用超类的`__init__`方法，然后单独调整字段。

```
class PollForm(forms.ModelForm):
    def __init__(self, *args, **kwargs):
        super(PollForm, self).__init__(*args, **kwargs)
        self.fields['question'].widget = forms.Textarea()

    class Meta:
        model = Poll 
```

这个方法可能看起来比 Vasil 的更复杂，但它提供了额外的好处，即能够精确地覆盖字段上的任何属性，而无需通过重新声明它来重置任何其他属性。

**更新：**建议的方法可以概括为更改所有日期字段，而无需严格输入每个名称：

```
from django.forms import fields as formfields
from django.contrib.admin import widgets

class PollForm(forms.ModelForm):
    def __init__(self, *args, **kwargs):
        super(PollForm, self).__init__(*args, **kwargs)
        for field_name in self.fields:
            field = self.fields[field_name]
            if isinstance(field, formfields.DateField):
                field.widget = widgets.AdminDateWidget()

    class Meta:
        model = Poll 
```

这对我`python3`有用`django 1.11`

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-19T03:21:02.320

好吧，创建一个自定义模型字段只是为了更改它的默认表单小部件并不是一个明显的起点。

您可以制作自己的表单小部件并覆盖表单中的字段，指定您自己的小部件，就像在 Soviut 的答案中一样。

还有一种更短的方法：

```
class ArticleForm(ModelForm):
     pub_date = DateField(widget=MyDateWidget())

     class Meta:
         model = Article 
```

有一个如何编写表单小部件的示例，它位于 Django 的表单包中。这是一个带有 3 个下拉菜单的日期选择器。

当我只想将一些 JavaScript 添加到标准 HTML 输入元素时，我通常会做的就是保持原样并通过稍后使用 JavaScript 引用它的 id 来修改它。您可以轻松地了解 Django 生成的输入字段 id 的命名约定。

当您在表单中覆盖它时，您也可以只提供小部件的类。然后通过类名用[jQuery](http://en.wikipedia.org/wiki/JQuery)捕获它们。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-07-23T20:52:33.423

我使用 JQuery。您只需查找要与日期选择器关联的字段的“id”，并将它们与 JQuery 和正确的显示格式绑定：

模型.py

```
class ObjectForm(ModelForm):
    class Meta:
        model = Object        
        fields = ['FieldName1','FieldName2'] 
```

在您使用视图呈现的页面顶部：

```
<head>
    <link type="text/css" href="/media/css/ui-darkness/jquery-ui-1.8.2.custom.css" rel="Stylesheet" /> 
    <script type="text/javascript" src="/media/js/jquery-1.4.2.min.js"></script>
    <script type="text/javascript" src="/media/js/jquery-ui-1.8.2.custom.min.js"></script>
</head>
<script type="text/javascript">
 $(function() {
        $("#id_FieldName1").datepicker({ dateFormat: 'yy-mm-dd' });
        $("#id_FieldName2").datepicker({ dateFormat: 'yy-mm-dd' });
 });
</script>
...
{{form}} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-19T09:31:31.930

您确实想要定义一个自定义小部件，并使用小部件的[内部 Media 类](http://docs.djangoproject.com/en/dev/topics/forms/media/#topics-forms-media)来定义必须包含在页面中以使小部件工作的 JS（和 CSS？）文件。如果你做对了，你可以让你的小部件完全独立和可重用。有关执行此操作的一个[示例，](http://bazaar.launchpad.net/~carljm/django-markitup/trunk/annotate/head%3A/markitup//widgets.py)请参见[django-markitup](http://launchpad.net/django-markitup)（它具有[MarkItUp! 通用标记编辑器](http://markitup.jaysalvat.com)的可重用小部件）。

然后使用 formfield_callback（参见 James Bennett 的回答）轻松将该小部件应用于表单中的所有 DateField。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-06-04T16:35:33.070

有些人可能会对此皱眉，但为了用您的自定义小部件替换日期选择器，我将为您的项目创建一个 monkeypatch 应用程序并在运行时修补 Django 本身。这样做的好处是任何第 3 方应用程序也将受到影响，因此向最终用户提供统一的界面，而无需修改第三方代码：

```
from django.forms.widgets import DateInput , DateTimeInput, TimeInput
from FOO.widgets import MyjQueryWidget

# be nice and tell you are patching
logger.info("Patching 'DateInput.widget = MyjQueryWidget': Replaces django DateInput to use my new super  'MyjQueryWidget'")

# be nicer and confirm signature of code we are patching and warn if it has changed - uncomment below to get the current hash fingerprint
# raise Exception(hashlib.md5(inspect.getsource(DateInput.widget)).hexdigest()) # uncommet to find latest hash
if not '<enter hexdigest fingerprint here>' == \
        hashlib.md5(inspect.getsource(DateInput.widget)).hexdigest():
    logger.warn("md5 signature of 'DateInput.widget' does not match Django 1.5\. There is a slight chance patch "
                    "might be broken so please compare and update this monkeypatch.")

# be nicest and also update __doc__
DateInput.__doc__ = "*Monkeypatched by <app name>*: Replaced django DateInput.widget with my new super  'MyjQueryWidget'" + DateInput.__doc__ 

DateInput.widget = MyjQueryWidget 
```

以上内容的灵感来自我在项目中使用的 html5monkeypatch，请查看[patch_widgets.py](https://github.com/danielsokolowski/django-html5monkeypatch/blob/master/html5monkeypatch/patch_widgets.py)和[patch_fields.py](https://github.com/danielsokolowski/django-html5monkeypatch/blob/master/html5monkeypatch/patch_fields.py)。

# iphone - iphone错误对话框？

> ID：660948
> 
> 赞同：4
> 
> 时间：2009-03-19T03:19:43.867
> 
> 标签：iphone, error-handling

我想知道当 iPhone 发生意外错误时是否可以显示一个拨号（而不是盲目地退出应用程序！）并且有时间记录或通过电子邮件发送崩溃...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-19T04:19:35.783

是的。开始执行 NSSetUncaughtExceptionHandler(&uncaughtExceptionHandler) 然后使用[Crash Reporter](http://landonf.bikemonkey.org/code/iphone/Crash_Reporter.20090129.html)之类的东西。好东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T03:33:11.947

我不知道您是否可以显示一个对话框，但是您可以通过使用该函数指定顶级异常处理程序来进行一些日志记录`NSSetUncaughtExceptionHandler`

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T03:30:12.157

我记得有一个方法可以在您的应用程序委托类中覆盖，在发生未处理的异常时会调用该方法。几天前，有人写了一篇博客文章，他们将异常信息从该方法发送到 Web 服务。

很抱歉，我在 UIApplicationDelegate 协议或前几天看到的博客文章中都找不到方法的名称。Apple 的在线文档目前似乎无法搜索（grrr！），我不记得我在哪里看到该博客文章 - 如果我找到它，我将编辑这篇文章以包含指向它的链接。

但是有**可能**进行某种恢复，或者至少能够将错误信息存储到磁盘以便以后发送。

# jquery - 如何使用 CakePHP 和 jQuery 实现跨域 Ajax 请求？

> ID：660949
> 
> 赞同：3
> 
> 时间：2009-03-19T03:19:49.483
> 
> 标签：jquery, xml, ajax, cakephp, cross-domain

我在我的项目中使用 CakePHP，并且我正在生成 XML 视图，以便我可以从外部网站与它们交互 (CRUD)。CakePHP 网站需要认证。

本质上，我想从“ [http://www.example.com](http://www.example.com) ”查看“ [http://mycakeapp.com/posts/views/1.xml ”](http://mycakeapp.com/posts/views/1.xml)

但是，使用 jQuery 的 ajax 函数时出现此错误：**访问受限 URI 被拒绝”代码：“1012**。从谷歌搜索看来，也许尝试 JSONP 是一种选择.. 但它不是蛋糕原生的，因此我宁愿使用 xml :(

我尝试过使用 iframe：它会加载登录屏幕 - 在我登录后，它会加载当前页面（例如“ [http://www.example.com](http://www.example.com) ”）！即使 iframe 源是“ [http://mycakeapp.com/posts/views/1.xml](http://mycakeapp.com/posts/views/1.xml) ”

有没有人解决过这个问题？

**更新：**更具体地说，我想创建一个与我的网站通信的书签（基于 CakePHP），因此 url 代理方法不起作用（但感谢您的建议）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-19T03:39:57.283

只需在 PHP 中制作一个代理脚本。让 Ajax 请求您的代理脚本，让您的代理脚本使用 cURL 在整个域中“转发”您的请求，只需让您的代理脚本回显您从 cURL 请求中获得的响应，您就可以开始了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-19T13:44:09.077

正如 mmattax 提到的，最简单的方法是使用代理脚本。

这是我用来调用另一个域的脚本，将一个 urlencoded proxy_url 参数传递给它。

url_proxy.php

```
// Is it a POST or a GET?
$url = ($_POST['proxy_url']) ? $_POST['proxy_url'] : $_GET['proxy_url'];

// Open the Curl session
$session = curl_init($url);

// If it's a POST, put the POST data in the body
if ($_POST['proxy_url']) {
    $postvars = '';
    while ($element = current($_POST)) {
        if (key($_POST) != 'proxy_url') {
            $postvars .= key($_POST).'='.$element.'&';
        }
        next($_POST);
    }
    curl_setopt ($session, CURLOPT_POST, true);
    curl_setopt ($session, CURLOPT_POSTFIELDS, $postvars);
}

// Don't return HTTP headers. Do return the contents of the call
curl_setopt($session, CURLOPT_HEADER, false);
curl_setopt($session, CURLOPT_RETURNTRANSFER, true);

// Make the call
$response = curl_exec($session);

// Return the response
if (curl_errno($session)) {
    $error_message = curl_error($session);
    echo 'Error: '.$error_message;
} else {
    echo $response;
}

curl_close($session);
?> 
```

在您的情况下，您可能希望更改错误处理位以返回您的应用程序可以解析的有效 xml 位。

我通常把它放在我的 webroot 中，然后从 javascript 中调用它，例如：

```
function showMapLegend(baseURL, layer) {
    var url = 'http://our-map-server/get-a-legend.php?layer='+layer;
    var dt = new Date();
    var proxy = baseURL + '/url_proxy.php?currDate='+dt.getTime()+'&proxy_url=';
    url = proxy + encodeURIComponent(url);

    new Ajax.Request(url, {
        method: 'get',
        onSuccess: function(transport) {
            $('map-legend-img').src = transport.responseText;
            new Effect.Appear('map-legend', {duration: 0.5});
        }
    });
} 
```

上面的示例 javascript 函数用于从我们的地图服务器获取一个简单的 url 字符串，我们不关心它是否失败，所以没有 onFailure 等，它主要是原型，但我相信你明白这是怎么回事使用代理脚本。

baseURL 变量被传入，它应该包含基本的“ [http://server/theappname](http://server/theappname) ”，比如你的应用程序的 url。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-25T11:24:41.770

JSONP 绝对是您正在寻找的。

也许以下页面可以帮助您：[http ://www.ibm.com/developerworks/xml/library/x-xml2jsonphp/](http://www.ibm.com/developerworks/xml/library/x-xml2jsonphp/)

# apache-flex - 将定义基本类型原型的代码放在哪里？

> ID：660957
> 
> 赞同：0
> 
> 时间：2009-03-19T03:24:38.927
> 
> 标签：apache-flex, actionscript-3, prototype

我已经向 Date 原型添加了函数，我想知道将代码放在 Flex 项目中的最佳位置是哪里？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T20:37:44.493

Flex 应用程序的最佳实践是创建一个实用程序类来操作类的实例，而不是更改该类的原型。例如，您可以创建一个带有接受对象作为参数`com.example.utils.DateUtil`的静态函数的类。`Date`您要遵循此最佳实践的原因是 Flex 默认使用编译器的严格设置，并且尝试访问添加到密封类原型的非标准函数会引发编译器错误。关闭严格模式的替代方法是不可取的，因为编译器将无法像在严格模式下那样优化您的代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-19T12:11:31.547

最好将它放在应用程序的预初始化处理程序中 - 以防原型在创建时被任何组件使用。

# python - 覆盖python threading.Thread.run()

> ID：660961
> 
> 赞同：45
> 
> 时间：2009-03-19T03:26:56.003
> 
> 标签：python, multithreading

鉴于[Python](http://docs.python.org/library/threading.html)`Thread.run()`文档：

> 您可以在子类中重写此方法。标准的 run() 方法调用作为目标参数传递给对象构造函数的可调用对象，如果有的话，顺序参数和关键字参数分别取自 args 和 kwargs 参数。

我构建了以下代码：

```
class DestinationThread(threading.Thread):
    def run(self, name, config):
        print 'In thread'

thread = DestinationThread(args = (destination_name, destination_config))
thread.start() 
```

但是当我执行它时，我收到以下错误：

```
Exception in thread Thread-1:
Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/2.6/lib/python2.6/threading.py", line 522, in __bootstrap_inner
    self.run()
TypeError: run() takes exactly 3 arguments (1 given) 
```

似乎我遗漏了一些明显的东西，但我看到的各种例子都适用于这种方法。最终，我试图将字符串和字典传递到线程中，如果构造函数不是正确的方法，而是在启动线程之前创建一个新函数来设置值，我对此持开放态度。

关于如何最好地做到这一点的任何建议？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-03-19T03:35:18.650

你真的不需要子类化 Thread。API 支持这一点的唯一原因是为了让来自 Java 的人更舒服，这是唯一明智地做到这一点的方法。

我们建议您使用的模式是将方法传递给 Thread 构造函数，然后调用`.start()`.

```
 def myfunc(arg1, arg2):
     print 'In thread'
     print 'args are', arg1, arg2

 thread = Thread(target=myfunc, args=(destination_name, destination_config))
 thread.start() 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-02-11T22:29:40.307

这是使用线程而不是扩展传递参数的示例`__init__`：

```
import threading

class Example(threading.Thread):

    def run(self):
        print '%s from %s' % (self._Thread__kwargs['example'],
                              self.name)

example = Example(kwargs={'example': 'Hello World'})
example.start()
example.join() 
```

这是一个使用多重处理的例子：

```
import multiprocessing

class Example(multiprocessing.Process):

    def run(self):
        print '%s from %s' % (self._kwargs['example'],
                              self.name)

example = Example(kwargs={'example': 'Hello World'})
example.start()
example.join() 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2011-02-03T18:53:50.627

的文档`threading.Thread`似乎暗示任何未使用的位置和关键字参数都被传递给运行。他们不是。

任何额外的位置参数和关键字`kwargs`确实被默认`threading.Thread.__init__`方法捕获，但它们仅传递给使用`target=`关键字指定的方法。它们不会传递给`run()`方法。

事实上，[Threading 文档](http://docs.python.org/library/threading.html)清楚地表明它*是*默认方法，它使用捕获的 args 和`run()`调用提供的方法：`target=``kwargs`

> “您可以在子类中覆盖此方法。标准 run() 方法调用传递给对象构造函数的可调用对象作为目标参数（如果有），顺序参数和关键字参数分别取自 args 和 kwargs 参数。”

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-11-12T23:56:29.707

如果您想保持面向对象的方法并且还具有运行参数，则可以执行以下操作：

```
import threading
class Destination:
    def run(self, name, config):
        print 'In thread'

destination = Destination()
thread = threading.Thread(target=destination.run,
    args=(destination_name, destination_config))
thread.start() 
```

如上所述，它也可以用`partial`

```
from functools import partial
import threading
class Destination:
    def run(self, name, config):
        print 'In thread'

destination = Destination()
thread = threading.Thread(target=partial(
    destination.run, destination_name, destination_config))
thread.start() 
```

与纯功能方法相比，这样做的优势在于它可以让您保持其他现有的面向对象代码相同。唯一的变化是让它不是子类 Thread，这应该没什么大不了的，因为根据`threading.Thread`文档：

> 只覆盖这个类的**init** ()和run()方法

如果您要覆盖 Thread 以便可以从子类中访问线程对象，那么我建议您只在对象中使用 threading.currentThread() 。通过这种方式，您可以根据 Tim Peters 的“Zen of Python”将线程的命名空间与您自己的命名空间分开：

> 命名空间是一个很棒的想法——让我们做更多的事情！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-04-24T14:59:59.257

为了解决一些关于重写`run()`方法是否需要额外参数的混淆，这里是一个重写`run()`方法的实现，它执行继承自的方法所做的事情`threading.Thread`。

请注意，这只是为了看看如何覆盖`run()`；这并不是一个有意义的例子。如果您只想使用顺序和/或关键字参数调用目标函数，则不需要子类；[Jerub 对这个问题的回答](https://stackoverflow.com/questions/660961/overriding-python-threading-thread-run/660974#660974)中已经指出了这一点。

以下代码同时支持 Python v2 和 v3。

尽管在 Python 2 代码中访问损坏的属性名称特别难看，但我不知道访问这些属性的另一种方法（如果你知道的话，请告诉我......）：

```
import sys
import threading

class DestinationThread(threading.Thread):

    def run(self):
        if sys.version_info[0] == 2:
            self._Thread__target(*self._Thread__args, **self._Thread__kwargs)
        else: # assuming v3
            self._target(*self._args, **self._kwargs)

def func(a, k):
    print("func(): a=%s, k=%s" % (a, k))

thread = DestinationThread(target=func, args=(1,), kwargs={"k": 2})
thread.start()
thread.join() 
```

它打印（在 Windows 7 上使用 Python 2.6、2.7 和 3.4 测试）：

```
func(): a=1, k=2 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2019-01-17T04:04:31.197

由于 Thread 构造函数参数目标是可调用的，`__call__`因此作为 run 方法应用

```
class Worker(object):
  def __call__(self, name, age):
    print('name, age : ',name,age)

if __name__ == '__main__':

  thread = Thread(target=Worker(), args=('bob','50'))
  thread.start() 
```

输出 ：

```
('name, age : ', 'bob', '50') 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2021-06-16T02:24:42.660

如果你真的需要一个子类，你可以像这样使用它

```
>>> class DestinationThread(threading.Thread):
    def __init__(self,name, config):
        super().__init__()
        self.name = name
        self.config = config
    def run(self):
        print("In thread") 
```

您可以通过 self.name & self.config 访问名称和配置

```
>>> thread = DestinationThread(destination_name, destination_config)
>>> thread.start() 
```

它会给你接受的输出。

输出：

```
In thread 
```

或者您可以使用目标参数。

```
thread = Thread(target=some_func, args=[arg1, arg2])
thread.start() 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-19T03:32:42.120

您将 run 方法定义为接受 3 个参数，但您使用一个参数调用它（python 使用对对象的引用调用它）。

您需要将参数传递给 run 而不是`__init__`.

或者让`__init__`方法接受参数。

# vb6 - 是否有相当于 sound.drv（16 位声音驱动程序）的 Windows 32 位版本

> ID：660966
> 
> 赞同：1
> 
> 时间：2009-03-19T03:32:28.563
> 
> 标签：vb6

我正在使用一个非常古老的程序，它使用 sound.drv 来制作一些简单的声音（比如旧的 Quickbasic 声音驱动程序，或者更古老的 Commodore64 合成器）

无论如何...我正在尝试找出是否有 32 位等效库。谷歌搜索它，但没有快乐。

这是声明的示例

```
Declare Function OpenSound Lib "sound.drv" () As Integer 
```

您使用 Sound.drv 来制作音调等，而不是播放实际的声音文件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-19T03:36:55.527

最基本的 win32 声音函数是[PlaySound()](http://msdn.microsoft.com/en-us/library/ms712879.aspx)。可能是一个很好的起点。你播放的是什么格式的声音？

# c# - C#中的泛型

> ID：660967
> 
> 赞同：2
> 
> 时间：2009-03-19T03:32:40.310
> 
> 标签：c#, generics

```
class Program
{
    static void Main(string[] args)
    {
        HomeFurniture homeFur = new HomeFurniture();
        Check<HomeFurniture,Furniture>(homeFur);
        OfficeFurniture officeFur = new OfficeFurniture();
        Check<OfficeFurniture,Furniture>(officeFur);
    }

    public static void Check<U,T>(T check) where T:Furniture
                                           where U:T
    {
        // I would like to set the properties of HomeFurniture as 
        // MyProperty = 9;
        // and that of OfficeFurniture  as 
        // MyProperty = 10;
    }

    public class HomeFurniture : Furniture
    {
        public int MyProperty { get; set; }
    }

    public class OfficeFurniture: Furniture
    {
        public int MyProperty { get; set; }
    }

    public class Furniture
    {

    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T03:42:52.207

为什么不在类中声明`MyProperty`然后`Furniture`覆盖它？

例子：

```
public class Furniture
{
    public virtual int MyProperty {get;}
}

public class HomeFurniture : Furniture
{
    public override int MyProperty
    {
        get
        {
            return 9;
        }
    }
}

public class OfficeFurniture : Furniture
{
    public override int MyProperty
    {
        get
        {
            return 10;
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-19T03:44:46.897

如果`Check`取决于家具的具体类型，它就不再是通用的了。

简单的单次调度应该是你所需要的：

```
public void Check(HomeFurniture f)
{
    f.MyProperty = 9;
}

public void Check(OfficeFurniture f)
{
    f.MyProperty = 10;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T03:41:15.220

```
HomeFurniture h = check as HomeFurniture;
if(h != null) {
  if( h.MyProperty != 9) { ... do some thing ...} 
} else {
  OfficeFurniture o = check as OfficeFurniture;
  if(o != null) {
    if( o.MyProperty != 10) { ... do some thing ...} 
  }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-19T03:42:22.550

不幸的是，泛型不会在这里为您提供帮助。处理此问题的最佳方法是更改`Check`​​为以下内容：

```
public static void Check(Furniture check)
{
    HomeFurniture homeFurniture = check as HomeFurniture;

    if (homeFurniture != null)
    {
        homeFurniture.MyProperty = 9;
        return;
    }

    OfficeFurniture officeFurniture = check as OfficeFurniture;

    if (officeFurniture != null)
    {
        officeFurniture.MyProperty = 10;
        return;
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-19T03:41:50.383

如果我理解你的问题，你想为每种类型的家具专门化你的通用功能吗？

如果是这样，遗憾的是，C# 不支持泛型的专门化。您只能使用“where”子句保证的接口来实现您的功能。

您也可以使用反射检查您的类型，但这会很笨拙且难以维护（并且完全违背了继承的目的）。

我建议使用您的家具类来声明一个虚拟方法来设置您在派生的 HomeFurniture 和 OfficeFurniture 类中覆盖的属性。

例如：

```
public class Furniture {
  public virtual void SetProperty(int val);
}

public class HomeFurniture  {
  public override void SetProperty(int val)  { // do homefurniture specific things 
  }
} 
```

等等。``*`*****************