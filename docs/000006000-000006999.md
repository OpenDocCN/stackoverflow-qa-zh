# StackOverflow 问答 000006000-000006999

# log4net - Log4Net 配置日志级别

> ID：6007
> 
> 赞同：65
> 
> 时间：2008-08-08T14:43:11.877
> 
> 标签：log4net

如何使[Log4net](http://logging.apache.org/log4net/index.html)仅记录 Info 级别的日志？这甚至可能吗？你可以只设置一个阈值吗？

这就是我所拥有的，它会按照我的预期记录 Info 及以上内容。我能做些什么让它只记录信息吗？

```
<logger name="BrokerCollection.Model.XmlDocumentCreationTask">
  <appender-ref ref="SubmissionAppender"/>
  <level value="Info" />
</logger> 
```

* * *

## 回答 #1

> 赞同：100
> 
> 时间：2008-08-13T21:18:38.423

在 appender 的定义中，我相信您可以执行以下操作：

```
<appender name="AdoNetAppender" type="log4net.Appender.AdoNetAppender">
    <filter type="log4net.Filter.LevelRangeFilter">
        <param name="LevelMin" value="INFO"/>
        <param name="LevelMax" value="INFO"/>
    </filter>
    ...
</appender> 
```

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2011-07-29T22:27:22.540

使用`threshold`.

例如：

```
 <appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender">
        <threshold value="WARN"/>
        <param name="File" value="File.log" />
        <param name="AppendToFile" value="true" />
        <param name="RollingStyle" value="Size" />
        <param name="MaxSizeRollBackups" value="10" />
        <param name="MaximumFileSize" value="1024KB" />
        <param name="StaticLogFileName" value="true" />
        <layout type="log4net.Layout.PatternLayout">
            <param name="Header" value="[Server startup]&#13;&#10;" />
            <param name="Footer" value="[Server shutdown]&#13;&#10;" />
            <param name="ConversionPattern" value="%d %m%n" />
        </layout>
    </appender>
    <appender name="EventLogAppender" type="log4net.Appender.EventLogAppender" >
        <threshold value="ERROR"/>
        <layout type="log4net.Layout.PatternLayout">
            <conversionPattern value="%date [%thread]- %message%newline" />
        </layout>
    </appender>
    <appender name="ConsoleAppender" type="log4net.Appender.ConsoleAppender">
        <threshold value="INFO"/>
        <layout type="log4net.Layout.PatternLayout">
            <param name="ConversionPattern" value="%d [%thread] %m%n" />
        </layout>
    </appender> 
```

在此示例中，所有 INFO 及以上信息都发送到控制台，所有 WARN 都发送到文件，而错误则发送到事件日志。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-17T16:28:25.817

**是的。** 它是通过 appender 上的过滤器完成的。

这是我通常使用的 appender 配置，仅限于 INFO 级别。

```
<appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender">
  <file value="${HOMEDRIVE}\\PI.Logging\\PI.ECSignage.${COMPUTERNAME}.log" />
  <appendToFile value="true" />
  <maxSizeRollBackups value="30" />
  <maximumFileSize value="5MB" />
  <rollingStyle value="Size" />     <!--A maximum number of backup files when rolling on date/time boundaries is not supported. -->
  <staticLogFileName value="false" />
  <lockingModel type="log4net.Appender.FileAppender+MinimalLock" />
  <layout type="log4net.Layout.PatternLayout">
        <param name="ConversionPattern" value="%date{yyyy-MM-dd HH:mm:ss.ffff} [%2thread] %-5level %20.20type{1}.%-25method at %-4line| (%-30.30logger) %message%newline" />
  </layout>

  <filter type="log4net.Filter.LevelRangeFilter">
        <levelMin value="INFO" />
        <levelMax value="INFO" />
  </filter>
</appender> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-05-03T11:45:48.010

如果您想动态执行它，请尝试以下操作：

```
using System;
using System.Collections.Generic;
using System.Text;
using log4net;
using log4net.Config;
using NUnit.Framework;

namespace ExampleConsoleApplication
{
  enum DebugLevel : int
  { 
    Fatal_Msgs = 0 , 
    Fatal_Error_Msgs = 1 , 
    Fatal_Error_Warn_Msgs = 2 , 
    Fatal_Error_Warn_Info_Msgs = 3 ,
    Fatal_Error_Warn_Info_Debug_Msgs = 4 
  }

  class TestClass
  {
    private static readonly ILog logger = LogManager.GetLogger(typeof(TestClass));

    static void Main ( string[] args )
    {
      TestClass objTestClass = new TestClass ();

      Console.WriteLine ( " START " );

      int shouldLog = 4; //CHANGE THIS FROM 0 TO 4 integer to check the functionality of the example
      //0 -- prints only FATAL messages 
      //1 -- prints FATAL and ERROR messages 
      //2 -- prints FATAL , ERROR and WARN messages 
      //3 -- prints FATAL  , ERROR , WARN and INFO messages 
      //4 -- prints FATAL  , ERROR , WARN , INFO and DEBUG messages 

      string srtLogLevel = String.Empty; 
      switch (shouldLog)
      {
        case (int)DebugLevel.Fatal_Msgs :
          srtLogLevel = "FATAL";
          break;
        case (int)DebugLevel.Fatal_Error_Msgs:
          srtLogLevel = "ERROR";
          break;
        case (int)DebugLevel.Fatal_Error_Warn_Msgs :
          srtLogLevel = "WARN";
          break;
        case (int)DebugLevel.Fatal_Error_Warn_Info_Msgs :
          srtLogLevel = "INFO"; 
          break;
        case (int)DebugLevel.Fatal_Error_Warn_Info_Debug_Msgs :
          srtLogLevel = "DEBUG" ;
          break ;
        default:
          srtLogLevel = "FATAL";
          break;
      }

      objTestClass.SetLogingLevel ( srtLogLevel );

      objTestClass.LogSomething ();

      Console.WriteLine ( " END HIT A KEY TO EXIT " );
      Console.ReadLine ();
    } //eof method 

    /// <summary>
    /// Activates debug level 
    /// </summary>
    /// <sourceurl>http://geekswithblogs.net/rakker/archive/2007/08/22/114900.aspx</sourceurl>
    private void SetLogingLevel ( string strLogLevel )
    {
     string strChecker = "WARN_INFO_DEBUG_ERROR_FATAL" ;

      if (String.IsNullOrEmpty ( strLogLevel ) == true || strChecker.Contains ( strLogLevel ) == false)
        throw new Exception ( " The strLogLevel should be set to WARN , INFO , DEBUG ," );

      log4net.Repository.ILoggerRepository[] repositories = log4net.LogManager.GetAllRepositories ();

      //Configure all loggers to be at the debug level.
      foreach (log4net.Repository.ILoggerRepository repository in repositories)
      {
        repository.Threshold = repository.LevelMap[ strLogLevel ];
        log4net.Repository.Hierarchy.Hierarchy hier = (log4net.Repository.Hierarchy.Hierarchy)repository;
        log4net.Core.ILogger[] loggers = hier.GetCurrentLoggers ();
        foreach (log4net.Core.ILogger logger in loggers)
        {
          ( (log4net.Repository.Hierarchy.Logger)logger ).Level = hier.LevelMap[ strLogLevel ];
        }
      }

      //Configure the root logger.
      log4net.Repository.Hierarchy.Hierarchy h = (log4net.Repository.Hierarchy.Hierarchy)log4net.LogManager.GetRepository ();
      log4net.Repository.Hierarchy.Logger rootLogger = h.Root;
      rootLogger.Level = h.LevelMap[ strLogLevel ];
    }

    private void LogSomething ()
    {
      #region LoggerUsage
      DOMConfigurator.Configure (); //tis configures the logger 
      logger.Debug ( "Here is a debug log." );
      logger.Info ( "... and an Info log." );
      logger.Warn ( "... and a warning." );
      logger.Error ( "... and an error." );
      logger.Fatal ( "... and a fatal error." );
      #endregion LoggerUsage

    }
  } //eof class 
} //eof namespace 
```

应用程序配置：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <configSections>
        <section name="log4net"
                 type="log4net.Config.Log4NetConfigurationSectionHandler, log4net" />
    </configSections>
    <log4net>
        <appender name="LogFileAppender" type="log4net.Appender.FileAppender">
            <param name="File" value="LogTest2.txt" />
            <param name="AppendToFile" value="true" />
            <layout type="log4net.Layout.PatternLayout">
                <param name="Header" value="[Header] \r\n" />
                <param name="Footer" value="[Footer] \r\n" />
                <param name="ConversionPattern" value="%d [%t] %-5p %c %m%n" />
            </layout>
        </appender>

        <appender name="ColoredConsoleAppender" type="log4net.Appender.ColoredConsoleAppender">
            <mapping>
                <level value="ERROR" />
                <foreColor value="White" />
                <backColor value="Red, HighIntensity" />
            </mapping>
            <layout type="log4net.Layout.PatternLayout">
                <conversionPattern value="%date [%thread] %-5level %logger [%property{NDC}] - %message%newline" />
            </layout>
        </appender>

        <appender name="AdoNetAppender" type="log4net.Appender.AdoNetAppender">
            <connectionType value="System.Data.SqlClient.SqlConnection, System.Data, Version=1.2.10.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />
            <connectionString value="data source=ysg;initial catalog=DBGA_DEV;integrated security=true;persist security info=True;" />
            <commandText value="INSERT INTO [DBGA_DEV].[ga].[tb_Data_Log] ([Date],[Thread],[Level],[Logger],[Message]) VALUES (@log_date, @thread, @log_level, @logger, @message)" />

            <parameter>
                <parameterName value="@log_date" />
                <dbType value="DateTime" />
                <layout type="log4net.Layout.PatternLayout" value="%date{yyyy'-'MM'-'dd HH':'mm':'ss'.'fff}" />
            </parameter>
            <parameter>
                <parameterName value="@thread" />
                <dbType value="String" />
                <size value="255" />
                <layout type="log4net.Layout.PatternLayout" value="%thread" />
            </parameter>
            <parameter>
                <parameterName value="@log_level" />
                <dbType value="String" />
                <size value="50" />
                <layout type="log4net.Layout.PatternLayout" value="%level" />
            </parameter>
            <parameter>
                <parameterName value="@logger" />
                <dbType value="String" />
                <size value="255" />
                <layout type="log4net.Layout.PatternLayout" value="%logger" />
            </parameter>
            <parameter>
                <parameterName value="@message" />
                <dbType value="String" />
                <size value="4000" />
                <layout type="log4net.Layout.PatternLayout" value="%messag2e" />
            </parameter>
        </appender>
        <root>
            <level value="INFO" />
            <appender-ref ref="LogFileAppender" />
            <appender-ref ref="AdoNetAppender" />
            <appender-ref ref="ColoredConsoleAppender" />
        </root>
    </log4net>
</configuration> 
```

csproj 文件中的引用：

```
<Reference Include="log4net, Version=1.2.10.0, Culture=neutral, PublicKeyToken=1b44e1d426115821, processorArchitecture=MSIL">
  <SpecificVersion>False</SpecificVersion>
  <HintPath>..\..\..\Log4Net\log4net-1.2.10\bin\net\2.0\release\log4net.dll</HintPath>
</Reference>
<Reference Include="nunit.framework, Version=2.4.8.0, Culture=neutral, PublicKeyToken=96d09a1eb7f44a77, processorArchitecture=MSIL" /> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-11-01T13:25:59.577

你可以使用 log4net.Filter.LevelMatchFilter。其他选项可以在 [log4net 教程中找到 - 过滤器](http://www.beefycode.com/post/log4net-tutorial-pt-7-filters.aspx)

在您的附加程序部分添加

```
<filter type="log4net.Filter.LevelMatchFilter">
    <levelToMatch value="Info" />
    <acceptOnMatch value="true" />
</filter> 
```

匹配时的接受默认值为 true，因此您可以将其排除在外，但如果您将其设置为 false，您可以过滤掉 log4net 过滤器

# svn - 您如何处理源代码管理中的配置文件？

> ID：6009
> 
> 赞同：101
> 
> 时间：2008-08-08T14:44:25.570
> 
> 标签：svn, git, version-control, cvs

假设您有一个典型的 Web 应用程序和一个文件 configuration.whatever。每个从事该项目的开发人员都将有一个用于他们的开发盒的版本，将有一个开发、生产和阶段版本。您如何在源代码管理中处理这个问题？根本不签入此文件，使用不同的名称进行检查或完全做一些花哨的事情？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2008-08-08T14:50:00.287

我过去所做的是有一个默认的配置文件，它被签入到源代码管理中。然后，每个开发人员都有自己的覆盖配置文件，该文件被排除在源代码管理之外。应用程序首先加载默认文件，然后如果存在覆盖文件，则加载该文件并使用覆盖文件中的任何设置优先于默认文件。

一般来说，覆盖文件越小越好，但对于一个非常不标准的环境的开发人员来说，它总是可以包含更多的设置。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-09-15T18:04:39.203

配置*就是*代码，您应该对其进行版本控制。我们的配置文件基于用户名；在 UNIX/Mac 和 Windows 中，您都可以访问用户的登录名，只要这些对项目是唯一的，就可以了。您甚至可以在环境中覆盖它，但您**应该**对所有内容进行版本控制。

这还允许您检查其他人的配置，这有助于诊断构建和平台问题。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-08-08T14:46:15.020

不要版本该文件。版本模板或其他东西。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-08-08T15:44:59.723

我的团队为每个环境（web.config.dev、web.config.test、web.config.prod）保留了不同版本的配置文件。我们的部署脚本复制出正确的版本，将其重命名为 web.config。这样，我们对每个环境的配置文件都有完整的版本控制，可以轻松地执行差异等。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-08-08T14:47:06.593

目前我有一个带有扩展名的“模板”配置文件，例如：

```
web.config.rename 
```

但是，如果关键更改发生了变化，我会发现此方法存在问题。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-08-31T11:01:56.727

+1 关于模板方法。

但是由于这个问题带有 Git 标记，因此我想到了分布式替代方案，其中自定义项保存在私有测试分支上：

```
A---B---C---D---           <- mainline (public)
     \       \
      B'------D'---        <- testing (private) 
```

在这个方案中，主线包含一个通用的“模板”配置文件，需要最少的调整才能发挥作用。

现在，开发人员/测试人员可以根据自己的意愿调整配置文件，并且只在一个私有测试分支上本地提交这些更改（例如 B' = B + 定制）。每次主线推进时，他们都会毫不费力地将其合并到测试中，这会导致合并提交，例如 D'（= D + B 自定义的合并版本）。

当“模板”配置文件更新时，这种方案真的很出色：双方的更改被合并，如果它们不兼容，极有可能导致冲突（或测试失败）！

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-16T18:47:00.780

我们使用的解决方案是只有一个配置文件 (web.config/app.config)，但我们在文件中添加了一个特殊部分，其中包含所有环境的设置。

在我们的配置文件中有一个**LOCAL、DEV、QA、PRODUCTION**部分，每个部分都包含与该环境相关的配置键。

使这一切工作的是一个名为**xxx.Environment**的程序集，它在我们所有的应用程序（winforms 和 webforms）中都被引用，它告诉应用程序它在哪个环境中运行。

**xxx.Environment 程序集从给定机器的machine.config**中读取一行信息，告诉它它在 DEV、QA 等设备上。这个条目存在于我们所有的工作站和服务器上。

希望这可以帮助。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2011-05-06T00:51:51.997

我一直将所有版本的配置文件保存在源代码管理中，与 web.config 文件位于同一文件夹中。

例如

```
web.config
web.qa.config
web.staging.config
web.production.config 
```

我更喜欢这种命名约定（而不是 web.config.production 或 production.web.config），因为

*   当您按文件名排序时，它将文件保存在一起
*   当您按文件扩展名排序时，它将文件保存在一起
*   如果文件意外推送到生产环境，您将无法通过 http 看到内容，因为 IIS 将阻止提供 *.config 文件

应配置默认配置文件，以便您可以在自己的机器上本地运行应用程序。

最重要的是，这些文件在各个方面都应该几乎 100% 相同，甚至是格式。您不应该在一个版本中使用制表符而在另一个版本中使用空格进行缩进。您应该能够对文件运行差异工具，以准确查看它们之间的不同之处。我更喜欢使用 WinMerge 来区分文件。

当您的构建过程创建二进制文件时，应该有一个任务使用适合该环境的配置文件覆盖 web.config。如果文件被压缩，那么应该从该版本中删除不相关的文件。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-09-08T16:11:26.820

我以前使用过模板，即 web.dev.config、web.prod.config 等，但现在更喜欢“覆盖文件”技术。web.config 文件包含大部分设置，但外部文件包含特定于环境的值，例如 db 连接。[保罗威尔逊博客](http://weblogs.asp.net/pwilson/archive/2003/04/09/5261.aspx)上的很好解释。

我认为这减少了配置文件之间的重复数量，这在添加新值/属性时会引起痛苦。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-08-08T14:49:52.453

@Grant 是对的。

我在一个有近 100 名其他开发人员的团队中，我们的配置文件没有被检入源代码管理。我们在每次签出时都会提取存储库中的文件版本，但它们不会更改。

对我们来说效果很好。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-08-08T14:51:35.400

签入的普通版本的 app/web.config 应该足够通用，可以在所有开发人员机器上工作，并随时了解任何新的设置更改等。如果您需要一组特定的 dev 设置/test/production 设置，使用这些设置检查单独的文件，正如 GateKiller 所说，使用某种命名约定，尽管我通常使用“web.prod.config”，因为不更改文件扩展名。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-08-08T15:41:29.137

我们使用一个模板配置文件签入到版本控制中，然后在我们的自动构建中使用特定于环境的设置替换模板文件中的特定条目。特定于环境的设置存储在一个单独的 XML 文件中，该文件也受版本控制。

我们在自动构建中使用 MSBuild，因此我们使用来自[MSBuild 社区任务](http://msbuildtasks.tigris.org/)的 XmlUpdate 任务来更新值。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2008-08-17T03:10:24.983

很长一段时间以来，我一直在做 bcwood 所做的事情。我将 web.dev.config、web.test.config、web.prod.config 等的副本保留在源代码控制之下，然后我的构建/部署系统会在部署到各种环境时自动重命名它们。您会在文件之间获得一定程度的冗余（尤其是其中的所有 asp.net 内容），但通常它工作得很好。您还必须确保团队中的每个人都记得在进行更改时更新*所有文件。*

顺便说一句，我喜欢在最后保留“.config”作为扩展名，这样文件关联就不会被破坏。

至于配置文件的本地开发者版本，我总是尽力鼓励人们尽可能使用相同的本地设置，这样就不需要拥有自己的版本。它并不总是对每个人都有效，在这种情况下，人们通常只是根据需要在本地更换它并从那里开始。这不是太痛苦或任何事情。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-08-08T14:50:48.617

我对它进行版本控制，但从不将其推送到其他服务器。如果生产服务器需要更改，我直接对配置文件进行更改。

它可能不漂亮，但它工作得很好。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-05T22:43:30.773

在我们的项目中，我们将配置存储在带有前缀的文件中，然后我们的构建系统根据当前系统的主机名提取适当的配置。这对我们相对较小的团队来说效果很好，允许我们在添加新配置项时将配置更改应用到其他人的文件。显然，这绝对不能扩展到拥有无限数量的开发人员的开源项目。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-10-20T09:03:42.027

我们这里有两个问题。

*   首先，我们必须控制软件附带的配置文件。

    如果开发人员在 devolvement 环境中使用相同的文件，那么开发人员很容易将不需要的更改签入到主配置文件中。

    另一方面，如果您有安装程序包含的单独配置文件，很容易忘记向其中添加新设置，或者让其中的注释与 devolvement 中的注释不同步配置文件。

*   然后我们遇到的问题是，当其他开发人员添加新的配置设置时，开发人员必须保持配置文件的副本是最新的。但是，对于每个开发人员来说，数据库连接字符串等一些设置是不同的。

*   问题/答案未涵盖第三个问题。 *当您安装新版本的软件时，如何合并客户对您的配置文件所做的更改？*

> 我还没有看到在所有情况下都能很好地工作的好的解决方案，但是我已经看到了一些*部分解决方案* （可以根据需要组合成不同的组合），从而大大减少了问题。

*   首先减少主配置文件中的配置项数量。

    如果您不需要让您的客户更改您的映射，请使用 Fluent NHibernate（或其他方式）将配置移动到代码中。

    对于依赖注入设置也是如此。

*   尽可能拆分配置文件，例如使用单独的文件来配置 Log4Net 记录的内容。

*   不要在大量配置文件之间重复项目，例如，如果您有 4 个 Web 应用程序都安装在同一台机器上，那么每个应用程序中的 web.config 文件都指向一个整体配置文件。

    （默认使用相对路径，因此很少需要更改 web.config 文件）

*   处理开发配置文件以获取发货配置文件。

    可以通过在 Xml 注释中设置默认值来完成，然后在构建完成时在配置文件中设置这些值。或者在创建安装程序的过程中删除部分。

*   每个开发人员都拥有一个，而不是只有一个数据库连接字符串。

    例如，在运行时首先在配置文件中查找“database_ianr”（其中ianr是我的用户名或机器名），如果没有找到，则查找“database”

    有一个第二级“例如 -oracle 或 -sqlserver”使开发人员可以更快地访问这两个数据库系统。

    这当然也可以对任何其他配置值进行。

    然后可以在发送配置文件之前删除所有以“_userName”结尾的值。

> 然而，最终你是一个“配置文件的所有者”，负责管理如上所述或其他方式的配置文件。他/她还应该在每次发货前对面向客户的配置文件进行比较。

**你不能消除对一个有爱心的人的需要一些这样的短问题。**

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2016-02-04T16:53:12.177

我不认为有一个单一的解决方案适用于所有情况，因为它可能取决于配置文件中数据的敏感性、您使用的编程语言以及许多其他因素。但我认为将所有环境的配置文件保持在源代码控制下很重要，这样您就可以随时知道它何时以及由谁更改，更重要的是，如果出现问题，能够恢复它。他们会的。

所以这就是我的做法。这通常适用于 NodeJS 项目，但我认为它也适用于其他框架和语言。

我所做的是`configs`在项目的根目录下创建一个目录，并在该目录下为所有环境保留多个文件（有时也为每个开发人员的环境提供单独的文件），这些文件都在源代码管理中进行跟踪。并且代码使用的实际文件命名`config`在项目的根目录中。这是唯一未跟踪的文件。所以看起来像这样

```
root
|
|- config (not tracked)
|
|- configs/ (all tracked)
    |- development
    |- staging
    |- live
    |- James 
```

当有人签出项目时，他复制了他想在未跟踪`config`文件中使用的配置文件，并且他可以随意编辑它，但也有责任在根据需要提交到其他环境文件之前复制这些更改。

在服务器上，未跟踪文件可以只是对应于该环境的已跟踪文件的副本（或引用）。在 JS 中，您可以简单地使用 1 行来要求该文件。

这个流程一开始可能有点复杂，但它有很大的优势：

1.  您永远不必担心在没有备份的情况下在服务器上删除或修改配置文件
2.  如果开发人员在他的机器上有一些自定义配置并且他的机器由于任何原因停止工作，情况也是如此
3.  在进行任何部署之前，您可以比较配置文件，`development`例如`staging`，查看是否有任何丢失或损坏。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-08-17T04:10:42.820

我们只是保持生产配置文件签入。开发人员有责任在将文件从源代码中安全地拉出以进行暂存或开发时更改文件。这在过去让我们很伤心，所以我不建议这样做。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-01-14T10:24:28.773

我遇到了同样的问题，我找到了解决方案。我首先将所有文件添加到中央存储库（也是开发人员的）。

因此，如果开发人员从存储库中获取文件，则开发人员配置也在那里。对此文件进行更改时，Git 不应该知道这些更改。这样，更改就不能被推送/提交到存储库，而是留在本地。

我通过使用 git 命令解决了这个问题：`update-index --assume-unchanged`. 我制作了一个 bat 文件，该文件在项目的预构建中执行，其中包含一个文件，其更改应该被 Git 忽略。这是我放在bat文件中的代码：

```
IF NOT EXIST %2%\.git GOTO NOGIT
set fileName=%1
set fileName=%fileName:\=/%
for /f "useback tokens=*" %%a in ('%fileName%') do set fileName=%%~a
set "gitUpdate=git update-index --assume-unchanged"
set parameter= "%gitUpdate% %fileName%"
echo %parameter% as parameter for git
"C:\Program Files (x86)\Git\bin\sh.exe" --login -i -c %parameter%
echo Make FIleBehaveLikeUnchangedForGit Done.
GOTO END
:NOGIT
echo no git here.
echo %2%
:END 
```

在我的预构建中，我会调用 bat 文件，例如：

```
call "$(ProjectDir)\..\..\MakeFileBehaveLikeUnchangedForGit.bat" "$(ProjectDir)Web.config.developer" "$(SolutionDir)" 
```

我在 SO 上找到了一个将正确的配置文件复制到 web.config/app.config 的 bat 文件。我也在预编译中调用了这个 bat 文件。这个bat文件的代码是：

```
@echo off
echo Comparing two files: %1 with %2
if not exist %1 goto File1NotFound
if not exist %2 goto File2NotFound
fc %1 %2 
if %ERRORLEVEL%==0 GOTO NoCopy
echo Files are not the same.  Copying %1 over %2
copy %1 %2 /y & goto END
:NoCopy
echo Files are the same.  Did nothing
goto END
:File1NotFound
echo %1 not found.
goto END
:File2NotFound
copy %1 %2 /y
goto END
:END
echo Done. 
```

在我的预构建中，我会调用 bat 文件，例如：

```
call "$(ProjectDir)\..\..\copyifnewer.bat" "$(ProjectDir)web.config.$(ConfigurationName)" "$(ProjectDir)web.config 
```

# asp.net - FireFox 中的默认表单按钮

> ID：6076
> 
> 赞同：7
> 
> 时间：2008-08-08T15:32:15.787
> 
> 标签：asp.net, vb.net

我正在构建一个服务器控件，它将搜索我们的数据库并返回结果。服务器控件包含一个 ASP:Panel。我已将面板上的默认按钮设置为等于我的按钮 ID，并将表单默认按钮设置为等于我的按钮 ID。

在面板上：

```
 MyPanel.DefaultButton = SearchButton.ID
```

在控件上：

```
Me.Page.Form.DefaultButton = SearchButton.UniqueID 
```

在 IE 和 Safari 中运行良好我可以输入搜索词并按 Enter 键，它可以正常搜索。如果我在 Firefox 中执行此操作，我会收到一个警告框，提示“对象引用未设置为对象的实例。

有人遇到过这个吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-08T15:53:23.030

SearchButton 是 LinkBut​​ton 吗？如果是这样，则写入浏览器的 javascript 无法正常工作。

这是一篇很好的博客文章，解释了这个问题以及如何解决它：

[在 ASP.NET 中使用 Panel.DefaultButton 属性和 LinkBut​​ton 控件](http://kpumuk.info/asp-net/using-panel-defaultbutton-property-with-linkbutton-control-in-asp-net/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-11T12:51:23.970

最终解决了我的问题：

```
 SearchButton.UseSubmitBehavior = False 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-08T15:53:58.130

我可能是错的，这可能没有什么不同，但你有没有试过：

```
Me.Page.Form.DefaultButton = SearchButton.ID 
```

代替

```
Me.Page.Form.DefaultButton = SearchButton.UniqueID 
```

# authentication - 登录ID用什么？

> ID：6080
> 
> 赞同：17
> 
> 时间：2008-08-08T15:40:58.903
> 
> 标签：authentication, web-applications, account

我们正处于对我们的产品进行重大改写的早期设计阶段。目前，我们的客户主要是企业。我们管理帐户。每个帐户的用户名都在自己的命名空间中，但这意味着我们不能在服务器之间移动资产。

我们想移动到单个命名空间。但这带来了唯一用户名的问题。

那么最好的主意是什么？

*   电子邮件地址（带验证）？
*   唯一的字母数字字符串（“johnsmith9234”）？
*   我们应该看看 OpenID 吗？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-08-08T15:46:12.187

**电子邮件地址**

合理的

1.  用户不经常更换电子邮件
2.  删除了询问用户名和电子邮件地址的步骤，无论如何您都需要
3.  用户不会经常忘记他们的电子邮件地址（见第一条）
4.  电子邮件将是唯一的，除非用户已经注册了该站点，在这种情况下，将他们转发到忘记密码屏幕
5.  几乎每个人都使用电子邮件作为访问网站的主要登录名，这意味着采用率不应受到您要求提供电子邮件地址这一事实的影响

* * *

**更新**

注册后，请务必要求用户创建某种用户名，不要在公共网站上乱扔他们的电子邮件地址！此外，使用电子邮件地址作为登录名的另一个好处：您不需要任何其他信息（如密码/密码确认），只需通过邮件向他们发送临时密码，或者完全放弃密码并发送一次性密码每次他们想登录时他们的电子邮件地址的 URL（参见：[mugshot.org](http://mugshot.org/main)）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-08T15:49:41.913

OpenID 非常巧妙，您应该认真考虑这一点，因为它基本上消除了保存本地用户名和密码的要求并担心身份验证。

现在很多网站都在使用 OpenID 和他们自己的，为用户提供了选择。

如果您决定自己推出，我建议您使用电子邮件地址。但是，如果您正在创建按帐户对用户进行分组的东西（例如，拥有多个用户的公司），请小心。在这种情况下，电子邮件地址可能会被多次使用（例如，如果他们为不止一家公司工作），您应该允许这样做。

！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-08T15:44:12.563

我喜欢 OpenID，但我仍然会使用电子邮件地址，除非您的用户社区非常精通技术。对于大多数人来说，它仍然更容易理解和记住。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-15T14:28:36.167

如果您使用电子邮件地址作为 ID，则不需要对其进行验证。有一天，我网站上的注册人数突然急剧下降，我对此深有体会。事实证明，包括我网站 IP 在内的整个 IP 地址范围都被列入黑名单。花了很长时间才解决它。在其他情况下，我看到 Gmail 将非常合法的电子邮件标记为垃圾邮件，这也会造成麻烦。

最好验证电子邮件地址，但不要让它阻止注册。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-15T14:35:01.597

> 目前，我们的客户主要是企业。

人们似乎错过了这条线。如果是为了企业，要求他们通过 OpenID 登录确实不太实用。他们要么必须使用外部 OpenID 提供商，要么他们糟糕的技术人员将不得不设置和配置公司 OpenID。

如果这是“StackOverflow 是否需要 OpenID 登录”或“我的博客评论系统是否允许您通过 OpenID 识别自己”，我的回答是“绝对！”，但在这种情况下，我认为 OpenID 不会很合适。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-08T15:46:36.227

我个人会说带有验证的电子邮件，OpenId 是一个好主意，但我发现找到一个你已经使用的提供商很痛苦，我在这里只有一个 openId，因为在 beta 测试前两天我决定在 blogspot 上开始一个博客. 但是互联网上的每个人都有一个电子邮件地址，尤其是在与企业打交道时，人们不太会选择使用个人博客或诸如此类的东西进行企业登录。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-08T15:48:06.567

我认为 OpenID 绝对值得一看。除了为您提供一个为客户提供统一 ID 的框架之外，它还可以为大型企业提供管理自己的登录信息并在他们使用的所有产品（包括您自己的产品）中提供通用登录的能力。在 OpenId 还比较少见的情况下，这并没有那么大的好处，但是随着越来越多的产品开始使用它，我怀疑能够为每个员工使用一个通用的公司 OpenId 登录名可能会成为一个很好的卖点。

由于您主要为企业提供服务，因此我认为自己托管 OpenId 帐户并不是不合理的。我只是认为额外的灵活性将使您的客户受益。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-08T15:54:51.077

如果您的大多数客户主要是企业，那么我认为使用电子邮件以外的任何东西都会给您的客户带来问题。大多数人都对电子邮件地址登录感到满意，并且由于他们是商业客户，因此他们可能希望使用他们的工作电子邮件而不是个人帐户。OpenID 创造了一种涉及第三方的情况，许多企业不喜欢第三方参与。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-16T00:57:33.673

如果您正在查看 OpenID，您应该查看[http://eaut.org/](http://eaut.org/)和[http://emailtoid.net](http://emailtoid.net)。基本上，您可以接受用于登录的电子邮件地址，并在后台将它们转换为 OpenID，而无需用户知道任何事情。它非常光滑的东西......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-08T15:42:21.303

OpenID 似乎是编写自己的用户管理/身份验证的一个很好的替代方案。这些天我看到越来越多的网站使用 OpenID，所以你的用户进入的门槛应该相对较低。

# build-automation - 为构建归档目的收集操作系统和工具版本号

> ID：6085
> 
> 赞同：6
> 
> 时间：2008-08-08T15:44:25.823
> 
> 标签：build-automation, versions, archive

我们的自动构建机器需要存档操作系统的版本号以及每次构建过程中使用的各种工具。（以防我们以后需要复制完全相同的构建，也许当机器早就死了。）

我看到命令“msinfo32.exe”可用于转储整个负载的系统版本信息，我们不妨存档。

有谁知道一种轻松存档 Visual Studio 工具版本号的方法？

其他开发人员使用什么机制来收集此类信息以用于存档目的？

* * *

法比奥戈麦斯的额外信息。

我同意你的观点，5 年后可能无法重新创建确切的操作系统和工具配置（直至最近的安全更新）。不幸的是，这确实来自合同要求。作为我们向客户交付的一部分，我们必须提供所有源代码的副本以及关于如何复制构建的明确说明。我们可能不可能完美地满足这个要求。

所以 - 我只会将你的答案标记为正确（我同意你的观点，这实际上是不可能的），然后继续玩剩下的堆栈溢出。:)

PS。如果堆栈溢出支持对答案的回复而不是编辑原始问题，那就太好了。但我看到它[已经被拒绝了](http://stackoverflow.uservoice.com/pages/general/suggestions/14403)。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-08-08T15:59:58.680

如果您在**命令行**上构建，您可以告诉它是冗长的，并将所有输出捕获到一个文本文件中，以便与每个构建一起归档。

`eg, msbuild <build_file> > myfile.txt`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-09T01:28:45.113

对不起，但是什么会导致需要在未来复制完全相同的构建？

根据我的经验，要么确保产品安装人员的安全，要么从头开始构建新版本。

此外，IMO 未来复制完全相同的构建的唯一方法是在虚拟机上运行构建机器并保留 VM 备份。

我认为您将来需要复制完全相同的构建的大多数软件将不再可用，因此您需要保留您在这台机器上安装的每个软件版本的副本。

您能否更具体地说明您要解决的问题？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-18T23:40:08.703

另一种建议：将相关工具（编译器、系统头文件和库等）放在存储库本身中，而不是期望它们在本地安装。另请参阅我就该主题撰写的[博客文章。](http://www.conifersystems.com/2008/09/15/machine-independent-builds/)

我将 Visual Studio、gcc 等都签入了我的 Subversion 存储库。

# database - 对具有低完整性的表进行规范化

> ID：6110
> 
> 赞同：6
> 
> 时间：2008-08-08T16:19:20.607
> 
> 标签：database

我收到了一张大约有 18000 行的桌子。每条记录都描述了一个客户的位置。问题是，当这个人创建表时，他们没有添加“公司名称”字段，只有“位置名称”，一个公司可以有很多位置。

例如，以下是一些描述同一客户的记录：

**位置表**

```
 ID  Location_Name     
 1   TownShop#1        
 2   Town Shop - Loc 2 
 3   The Town Shop     
 4   TTS - Someplace   
 5   Town Shop,the 3   
 6   Toen Shop4 
```

我的目标是让它看起来像：

**位置表**

```
 ID  Company_ID   Location_Name     
 1   1            Town Shop#1       
 2   1            Town Shop - Loc 2 
 3   1            The Town Shop     
 4   1            TTS - Someplace   
 5   1            Town Shop,the 3   
 6   1            Toen Shop4 
```

**公司表**

```
 Company_ID  Company_Name  
 1           The Town Shop 
```

没有“公司”表，我必须从代​​表多个位置的最具描述性或最佳位置名称生成公司名称列表。

目前我在想我需要生成一个相似的位置名称列表，然后手动浏览该列表。

任何关于我如何解决这个问题的建议都值得赞赏。

**@Neall，感谢您的发言，但不幸的是，每个位置名称都是不同的，没有重复的位置名称，只有相似。因此，在您的语句“repcount”的结果中，每一行都是 1。**

**@yukondude，您的第 4 步是我问题的核心。**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-08T16:40:43.933

我以前不得不这样做。唯一真正的方法是手动匹配各个位置。使用数据库的控制台界面和分组选择语句。首先，添加您的“公司名称”字段。然后：

```
SELECT count(*) AS repcount, "Location Name" FROM mytable
 WHERE "Company Name" IS NULL
 GROUP BY "Location Name"
 ORDER BY repcount DESC
 LIMIT 5; 
```

找出列表顶部的位置属于哪个公司，然后使用 UPDATE ... WHERE "Location Name" = "The Location" 语句更新您的公司名称字段。

PS - 你真的应该把你的公司名称和位置名称分成单独的表，并通过它们的主键来引用它们。

更新： - 哇 - 没有重复？你有多少记录？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-08T16:41:29.623

请更新问题，您有可用的公司名称列表吗？我问是因为您也许可以使用 Levenshtein 算法来查找您的 CompanyNames 列表和 LocationNames 之间的关系。

* * *

**更新**

> 没有公司名称列表，我必须从代​​表多个位置的最具描述性或最佳位置名称生成公司名称。

好的...试试这个：

1.  通过查找由大部分或全部字母字符组成的 LocationNames 来构建候选 CompanyNames 列表。您可以为此使用[正则表达式](http://us2.php.net/manual/en/book.pcre.php)。将此列表存储在单独的表中。
2.  按字母顺序对该列表进行排序并（手动）确定哪些条目应该是 CompanyNames。
3.  将每个 CompanyName 与每个 LocationName 进行比较并得出匹配分数（使用[Levenshtein](http://us2.php.net/manual/en/function.levenshtein.php)或其他一些字符串匹配算法）。将结果存储在单独的表中。
4.  设置阈值分数，使得任何 MatchScore < Threshold 都不会被视为与给定 CompanyName 匹配。
5.  通过 CompanyName | 手动审查 LocationNames 位置名称 | MatchScore，并找出哪些是真正匹配的。通过 MatchScore 排序应该可以减少过程中的痛苦。

上述操作的全部目的是使零件自动化并限制问题的范围。它远非完美，但有望为您省去手动浏览 18K 记录的麻烦。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-08T16:44:48.480

我打算推荐一些复杂的令牌匹配算法，但要正确处理真的很棘手，如果你的数据没有很多相关性（错别字等），那么它不会给出很好的结果。

我建议您向[Amazon Mechanical Turk](http://www.mturk.com/mturk/welcome)提​​交一份工作，然后让人工进行整理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-08T16:47:35.853

理想情况下，您可能需要一个名为 Company 的单独表，然后在此“Location”表中创建一个 company_id 列，该列是 Company 表主键的外键，可能称为 id。这将避免此表中的大量文本重复（超过 18,000 行，整数外键将在 varchar 列上节省相当多的空间）。

但是您仍然面临着一种方法来加载该 Company 表，然后将其与 Location 中的行正确关联。没有通用的解决方案，但您可以按照以下方式做一些事情：

1.  创建 Company 表，其中 id 列自动递增（取决于您的 RDBMS）。
2.  找到所有唯一的公司名称并将它们插入公司。
3.  将列 company_id 添加到接受 NULL（目前）并且是 Company.id 列的外键的 Location 中。
4.  对于 Location 中的每一行，确定相应的公司，并使用该公司的 id 更新该行的 company_id 列。这可能是最具挑战性的一步。如果您的数据与示例中显示的一样，您可能需要使用各种字符串匹配方法进行多次运行。
5.  一旦 Location 中的所有行都具有 company_id 值，那么您可以 ALTER Company 表以向 company_id 列添加 NOT NULL 约束（假设每个位置都*必须*有一个公司，这似乎是合理的）。

如果可以复制 Location 表，则可以逐步构建一系列 SQL 语句来填充 company_id 外键。如果你犯了一个错误，你可以重新开始并重新运行脚本直到失败。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-08T22:07:02.527

是的，我上一篇文章中的第 4 步非常棒。

无论如何，您可能必须手动完成其中的一些工作，但您可能能够将大部分工作自动化。对于您提供的示例位置，如下查询将设置适当的 company_id 值：

```
UPDATE  Location
SET     Company_ID = 1
WHERE   (LOWER(Location_Name) LIKE '%to_n shop%'
OR      LOWER(Location_Name) LIKE '%tts%')
AND     Company_ID IS NULL; 
```

我相信这将与您的示例相匹配（我添加了`IS NULL`不覆盖先前设置的 Company_ID 值的部分），但当然，在 18,000 行中，您必须非常有创意才能处理各种组合。

其他可能有帮助的方法是使用 Company 中的名称来生成上述查询。您可以执行以下操作（在 MySQL 中）：

```
SELECT  CONCAT('UPDATE Location SET Company_ID = ',
        Company_ID, ' WHERE LOWER(Location_Name) LIKE ',
        LOWER(REPLACE(Company_Name), ' ', '%'), ' AND Company_ID IS NULL;')
FROM    Company; 
```

然后只需运行它产生的语句。这可以为你做很多垃圾工作。

# .net - 在 .NET DLL 中存储连接字符串的最佳方式是什么？

> ID：6113
> 
> 赞同：17
> 
> 时间：2008-08-08T16:32:30.440
> 
> 标签：.net, sql-server, connection-string

我的团队目前正在开发的应用程序有一个用于执行所有数据库访问的 DLL。应用程序无法使用受信任的连接，因为数据库位于防火墙后面，而域服务器不在。所以看起来连接字符串需要有一个数据库用户名和密码。DLL 当前具有硬编码的数据库连接字符串，但我不想在我们启动时这样做，因为程序集可以被反汇编，并且用户名和密码就在那里。

其中一项要求是密码需要每隔几个月更改一次，因此我们需要将其推广到我们的内部用户群。

有没有一种方法可以存储加密的密码，以便我们可以轻松地将其分发给整个用户群，而无需将其存储在程序集中？

更新：感谢所有回答的人。我将尝试回答一些问题... ASP.NET WebForms 和 VB.NET WinForms 都使用数据 DLL。我知道应用程序可以有自己的配置文件，但我没有看到任何关于 DLL 的配置文件的内容。不幸的是，我在工作中无法到达 Jon Galloway 的职位，所以我无法判断这是否可行。从开发的角度来看，我们不想在内部使用 Web 服务，但可能会在明年某个时候将它们提供给第三方。我认为模拟不会起作用，因为我们无法通过防火墙对用户进行身份验证。由于用户（或以前的用户）可能成为攻击者，因此我们对所有人保密！

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-08T16:38:34.513

我不确定，但我相信您可以将其放在配置文件中并加密配置文件。

更新：请参阅 Jon Galloway 的帖子[。](http://weblogs.asp.net/jongalloway/archive/2008/04/13/encrypting-passwords-in-a-net-app-config-file.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-25T05:12:51.047

假设坏人将从您的配置文件中获取凭据。这意味着他们将能够登录到您的数据库并执行该用户能够执行的任何操作。所以只要确保用户不能做任何坏事，比如直接访问表。使该用户只能执行某些存储过程，您将处于更好的状态。这是 sprocs 大放异彩的地方。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-08T17:12:58.750

我不想这么说，但是一旦您将某些内容放在客户端计算机上，该数据的安全性就会消失。

如果您的程序要解密该字符串，您需要假设攻击者也可以这样做。将调试器附加到您的程序将是一种方法。

将连接字符串存储在服务器上并通过 Web 连接获取它听起来不错，直到您意识到该 Web 连接也需要安全性，否则攻击者也可以冒充您的程序并与 Web 连接对话。

让我问一个问题。你在向谁隐藏连接字符串？用户还是攻击者？如果是用户，为什么？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-08T16:44:30.180

如果应用程序是 ASP.NET 应用程序，那么只需加密`web.config`.

如果应用程序是在多台机器上运行的客户端应用程序，则不要在本地存储连接字符串，而是考虑使用 Web 服务或其他某种安全机制来集中存储它。这将有助于将来更轻松地更新，并且您不会在本地存储连接字符串。

只是一些想法。

**更新**[：](https://stackoverflow.com/questions/6113/what-is-the-best-way-to-store-connection-string-in-net-dlls#6162) @lassevk

*“将连接字符串存储在服务器上，并通过 Web 连接获取它听起来不错，直到您意识到该 Web 连接也需要安全性，否则攻击者也可以冒充您的程序并与 Web 连接对话。 "*

Web 服务的安全性是隐含的。根据部署的类型，有许多选项......例如客户端证书。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-08T17:28:06.130

还有一些其他的想法。您始终可以使用模拟。此外，您还可以使用 Enterprise Library 的（Common Library）。

```
<section name="enterpriseLibrary.ConfigurationSource" type="Microsoft.Practices.EnterpriseLibrary.Common.Configuration.ConfigurationSourceSection, Microsoft.Practices.EnterpriseLibrary.Common, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" />
<enterpriseLibrary.ConfigurationSource selectedSource="Common">
<sources>
  <add name="Common" type="Microsoft.Practices.EnterpriseLibrary.Common.Configuration.FileConfigurationSource, Microsoft.Practices.EnterpriseLibrary.Common, Version=3.1.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
    filePath="Config\Exception.config" />
</sources> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-08T17:30:27.623

.NET 支持对这样的配置值进行加密。您可以将其保留在配置文件中，但已加密。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-08T17:40:28.227

您希望能够分发 DLL，所有设置信息都位于可配置的位置，但事实是，除非您执行自定义操作，否则您无法拥有一个方便的 .NET DLL 配置文件。

也许您需要重新考虑您的 DLL 应该承担什么责任。要求库的用户传入连接字符串是否可能或有意义？您的 DLL 读取配置文件真的有意义吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-14T14:20:44.570

几个选项：

1.  存储在 web.config 中并加密
2.  存储在 dll 中并进行混淆处理（dotfuscator）
3.  在 web.config 中存储一个（当然是加密的）并在数据库中休息（如果你必须使用多个并且加密/解密变得很痛苦）

# language-agnostic - 你如何处理巨大的 if 条件？

> ID：6126
> 
> 赞同：29
> 
> 时间：2008-08-08T16:45:58.540
> 
> 标签：language-agnostic, if-statement

这在我使用过的每种语言中都困扰着我，我有一个 if 语句，但是条件部分有很多检查，我必须将它拆分为多行，使用嵌套的 if 语句，或者只是接受它的丑陋并继续前进用我的生命。

您是否发现任何其他方法可能对我和遇到同样问题的其他人有用？

示例，全部在一行：

```
if (var1 = true && var2 = true && var2 = true && var3 = true && var4 = true && var5 = true && var6 = true)
{ 
```

示例，多行：

```
if (var1 = true && var2 = true && var2 = true
 && var3 = true && var4 = true && var5 = true
 && var6 = true)
{ 
```

示例嵌套：

```
if (var1 = true && var2 = true && var2 = true && var3 = true)
{
     if (var4 = true && var5 = true && var6 = true)
     { 
```

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-08-08T16:54:30.143

将条件分成几个布尔值，然后使用主布尔值作为条件。

```
bool isOpaque = object.Alpha == 1.0f;
bool isDrawable = object.CanDraw && object.Layer == currentLayer;
bool isHidden = hideList.Find(object);

bool isVisible = isOpaque && isDrawable && ! isHidden;

if(isVisible)
{
    // ...
} 
```

更好的是：

```
public bool IsVisible {
    get
    {
        bool isOpaque = object.Alpha == 1.0f;
        bool isDrawable = object.CanDraw && object.Layer == currentLayer;
        bool isHidden = hideList.Find(object);

        return isOpaque && isDrawable && ! isHidden;
    }
}

void Draw()
{
     if(IsVisible)
     {
         // ...
     }
} 
```

确保你给你的变量名称实际上表明了意图而不是功能。这将极大地帮助开发人员维护您的代码……可能是您！

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-08-08T17:09:38.477

我很惊讶还没有人得到这个。专门针对此类问题进行了重构：

[http://www.refactoring.com/catalog/decomposeConditional.html](http://www.refactoring.com/catalog/decomposeConditional.html)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-08-08T17:10:27.897

这里有两个问题需要解决：可读性和可理解性

“可读性”解决方案是一个风格问题，因此可以解释。我的偏好是这样的：

```
if (var1 == true && // Explanation of the check
    var2 == true && // Explanation of the check
    var3 == true && // Explanation of the check
    var4 == true && // Explanation of the check
    var5 == true && // Explanation of the check
    var6 == true)   // Explanation of the check
    { } 
```

或这个：

```
if (var1 && // Explanation of the check
    var2 && // Explanation of the check
    var3 && // Explanation of the check
    var4 && // Explanation of the check
    var5 && // Explanation of the check
    var6)   // Explanation of the check
    { } 
```

也就是说，这种复杂的检查在扫描代码时可能很难在精神上解析（尤其是如果您不是原作者）。考虑创建一个辅助方法来抽象一些复杂性：

```
/// <Summary>
/// Tests whether all the conditions are appropriately met
/// </Summary>
private bool AreAllConditionsMet (
    bool var1,
    bool var2,
    bool var3,
    bool var4,
    bool var5,
    bool var6)
{
    return (
        var1 && // Explanation of the check
        var2 && // Explanation of the check
        var3 && // Explanation of the check
        var4 && // Explanation of the check
        var5 && // Explanation of the check
        var6);  // Explanation of the check
}

private void SomeMethod()
{
    // Do some stuff (including declare the required variables)
    if (AreAllConditionsMet (var1, var2, var3, var4, var5, var6))
    {
        // Do something
    }
} 
```

现在，当从视觉上扫描“SomeMethod”方法时，测试逻辑的实际复杂性被隐藏了，但语义却被保留了下来，以供人类在高层次上理解。如果开发者确实需要了解细节，可以检查 AreAllConditionsMet 方法。

我认为这正式称为“分解条件”重构模式。Resharper 或 Refactor Pro 等工具！可以使进行这种重构变得容易！

在所有情况下，拥有可读和可理解的代码的关键是使用真实的变量名。虽然我知道这是一个人为的例子，但“var1”、“var2”等**不是**可接受的变量名。它们的名称应该反映它们所代表的数据的基本性质。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-08-08T16:50:57.093

我经常将它们分成组件布尔变量：

```
bool orderValid = orderDate < DateTime.Now && orderStatus != Status.Canceled;
bool custValid = customerBalance == 0 && customerName != "Mike";
if (orderValid && custValid)
{
... 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-08-08T16:49:48.530

首先，我会移除所有`== true`部件，这样会缩短 50% ;)

当我有很大的条件时，我会寻找原因。有时我看到我应该使用多态，有时我需要添加一些状态对象。基本上，这意味着需要重构（代码味道）。

有时我使用[德摩根定律](http://en.wikipedia.org/wiki/De_Morgan%27s_laws)来简化布尔表达式。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-08-08T17:04:33.197

查看Kent Beck 的[实施模式](https://rads.stackoverflow.com/amzn/click/com/0321413091)。我正在考虑一种特殊的模式，它可能会在这种情况下有所帮助......它被称为“警卫”。您可以将它们分解为一个守卫，而不是拥有大量条件，这可以清楚地表明哪些是方法中的不利条件。

例如，如果您有一个方法可以做某事，但在某些情况下它不应该做某事，而不是：

```
public void doSomething() {
    if (condition1 && condition2 && condition3 && condition4) {
        // do something
    }
} 
```

您可以将其更改为：

```
public void doSomething() {
    if (!condition1) {
        return;
    }

    if (!condition2) {
        return;
    }

    if (!condition3) {
        return;
    }

    if (!condition4) {
        return;
    }

    // do something
} 
```

它有点冗长，但更具可读性，尤其是当你开始有奇怪的嵌套时，守卫可以提供帮助（结合提取方法）。

顺便说一句，我强烈推荐那本书。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-08-08T16:50:23.570

我见过很多人和编辑用一个选项卡缩进 if 语句中的每个条件，或者将其与打开的括号匹配：

```
if (var1 == true
    && var2 == true
    && var3 == true
   ) {
    /* do something.. */
} 
```

我通常将 close paren 放在与最后一个条件相同的行上：

```
if (var1 == true
    && var2 == true
    && var3 == true) {
    /* do something.. */
} 
```

但我不认为这很干净。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-08-08T16:55:23.090

好吧，首先，为什么不：

> if (var1 && var2 && var2 && var3 && var4 && var5 && var6) {
> ...

此外，重构抽象代码示例非常困难。如果您展示了一个特定示例，则可以更轻松地确定适合该问题的更好模式。

没有更好，但是我过去所做的：（以下方法可以防止短路布尔测试，即使第一个测试为假，所有测试也会运行。除非您知道您需要始终执行所有测试，否则不是推荐的模式返回之前的代码——感谢 ptomato 发现我的错误！）

> 布尔确定 = cond1;
> 好的 &= cond2;
> 好的 &= cond3;
> 好的 &= cond4;
> 好的 &= cond5;
> 好的 &= cond6;

~~与以下相同：（~~不一样，请参见上面的注释！）

> ok = (cond1 && cond2 && cond3 && cond4 && cond5 && cond6);

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-08-18T03:51:12.607

尝试查看函子和谓词。Apache Commons 项目有一组很棒的对象，允许您将条件逻辑封装到对象中。在 O'reilly 上可以找到它们的使用[示例](http://www.onjava.com/pub/a/onjava/2004/12/22/jakarta-gems-1.html?page=2)。代码示例摘录：

```
import org.apache.commons.collections.ClosureUtils;
import org.apache.commons.collections.CollectionUtils;
import org.apache.commons.collections.functors.NOPClosure;

Map predicateMap = new HashMap();

predicateMap.put( isHonorRoll, addToHonorRoll );
predicateMap.put( isProblem, flagForAttention );
predicateMap.put( null, ClosureUtils.nopClosure() );

Closure processStudents = 
    ClosureUtils.switchClosure( predicateMap );

CollectionUtils.forAllDo( allStudents, processStudents ); 
```

现在所有这些 isHonorRoll 谓词的详细信息以及用于评估它们的闭包：

```
import org.apache.commons.collections.Closure;
import org.apache.commons.collections.Predicate;

// Anonymous Predicate that decides if a student 
// has made the honor roll.
Predicate isHonorRoll = new Predicate() {
  public boolean evaluate(Object object) {
    Student s = (Student) object;

    return( ( s.getGrade().equals( "A" ) ) ||
            ( s.getGrade().equals( "B" ) && 
              s.getAttendance() == PERFECT ) );
  }
};

// Anonymous Predicate that decides if a student
// has a problem.
Predicate isProblem = new Predicate() {
  public boolean evaluate(Object object) {
    Student s = (Student) object;

    return ( ( s.getGrade().equals( "D" ) || 
               s.getGrade().equals( "F" ) ) ||
             s.getStatus() == SUSPENDED );
  }
};

// Anonymous Closure that adds a student to the 
// honor roll
Closure addToHonorRoll = new Closure() {
  public void execute(Object object) {
    Student s = (Student) object;

    // Add an award to student record
    s.addAward( "honor roll", 2005 );
    Database.saveStudent( s );
  }
};

// Anonymous Closure flags a student for attention
Closure flagForAttention = new Closure() {
  public void execute(Object object) {
    Student s = (Student) object;

    // Flag student for special attention
    s.addNote( "talk to student", 2005 );
    s.addNote( "meeting with parents", 2005 );
    Database.saveStudent( s );
  }
}; 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-08-18T05:39:28.880

Steve McConell 的建议，来自[Code Complete](https://rads.stackoverflow.com/amzn/click/com/0735619670)：使用多维表。每个变量都用作表的索引，if 语句变成表查找。例如，如果 (size == 3 && weight > 70) 转换为表条目 decision[size][weight_group]

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-08T16:49:54.427

我求助于单独的布尔值：

```
Bool cond1 == (var1 && var2);
Bool cond2 == (var3 && var4);

if ( cond1 && cond2 ) {} 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-08-08T17:33:46.477

正如其他人所提到的，我会分析您的条件，看看是否有办法将其外包给其他方法以提高可读性。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2010-05-09T12:01:29.030

在 PHP 等反射语言中，您可以使用变量变量：

```
$vars = array('var1', 'var2', ... etc.);
foreach ($vars as $v)
    if ($$v == true) {
        // do something
        break;
    } 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-08-08T16:59:56.747

我喜欢按级别分解它们，所以我会像这样格式化你的例子：

```
if (var1 = true
 && var2 = true
 && var2 = true
 && var3 = true
 && var4 = true
 && var5 = true
 && var6 = true){ 
```

当你有更多的嵌套时，它很方便，就像这样（显然，对于所有事情来说，真实条件比“= true”更有趣）：

```
if ((var1 = true && var2 = true)
 && ((var2 = true && var3 = true)
  && (var4 = true && var5 = true))
 && (var6 = true)){ 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2008-08-08T17:11:23.060

`all()`如果您碰巧在 Python 中编程，那么在变量列表上应用内置函数就很容易了（我将在这里只使用布尔文字）：

```
>>> L = [True, True, True, False, True]
>>> all(L) # True, only if all elements of L are True.
False
>>> any(L) # True, if any elements of L are True.
True 
```

您的语言中是否有任何相应的功能（C#？Java？）。如果是这样，那可能是最干净的方法。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-08-08T17:29:52.680

麦克道尔，

当使用表达式两边都计算的单个“&”运算符时，您是正确的。但是，当使用 '&&' 运算符时（至少在 C# 中），第一个返回 false 的表达式是最后一个计算的表达式。这使得将评估放在 FOR 语句之前与任何其他方式一样好。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-08-08T17:37:12.943

@tweakt

> 这并没有更好，但是我过去所做的：
> 
> 布尔确定 = cond1; 好的 &= cond2; 好的 &= cond3; 好的 &= cond4; 好的 &= cond5; 好的 &= cond6;
> 
> 这与以下内容相同：
> 
> ok = (cond1 && cond2 && cond3 && cond4 && cond5 && cond6);

实际上，这两件事在大多数语言中并不相同。第二个表达式通常会在其中一个条件为假时立即停止评估，如果评估条件代价高昂，这可能会大大提高性能。

为了可读性，我个人更喜欢上面 Mike Stone 的建议。冗长的评论很容易，并保留了能够提早退出的所有计算优势。如果它会混淆代码的组织以使条件评估远离其他函数，您也可以在函数中内联执行相同的技术。这有点俗气，但你总是可以这样做：

```
do {
    if (!cond1)
       break;
    if (!cond2)
       break;
    if (!cond3)
       break;
    ...
    DoSomething();
} while (false); 
```

while (false) 有点俗气。我希望语言有一个名为“once”的范围运算符，或者你可以轻松摆脱的东西。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-08-18T04:15:01.220

我喜欢将每个条件分解为描述性变量。

```
bool isVar1Valid, isVar2Valid, isVar3Valid, isVar4Valid;
isVar1Valid = ( var1 == 1 )
isVar2Valid = ( var2.Count >= 2 )
isVar3Valid = ( var3 != null )
isVar4Valid = ( var4 != null && var4.IsEmpty() == false )
if ( isVar1Valid && isVar2Valid && isVar3Valid && isVar4Valid ) {
     //do code
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-10-14T21:07:38.657

如果我在 Perl 中进行，这就是我运行检查的方式。

```
{
  last unless $var1;
  last unless $var2;
  last unless $var3;
  last unless $var4;
  last unless $var5;
  last unless $var6;

  ... # Place Code Here
} 
```

如果您打算在子例程中使用它，请替换`last`with的每个实例`return`；

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2017-05-03T17:11:48.390

```
 if (   (condition_A)
        && (condition_B)
        && (condition_C)
        && (condition_D)
        && (condition_E)
        && (condition_F)
       )
    {
       ...
    } 
```

与

```
 if (condition_A) {
       if (condition_B) {
          if (condition_C) {
             if (condition_D) {
                if (condition_E) {
                   if (condition_F) {
                      ...
                   }
                }
             }
          }
       }
    } 
```

和

```
 if (   (   (condition_A)
            && (condition_B)
           )
        || (   (condition_C)
            && (condition_D)
           )
        || (   (condition_E)
            && (condition_F)
           )
       )
    {
       do_this_same_thing();
    } 
```

与

```
 if (condition_A && condition_B) {
       do_this_same_thing();
    }
    if (condition_C && (condition_D) {
       do_this_same_thing();
    }
    if (condition_E && condition_F) {
       do_this_same_thing();
    } 
```

如果多个条件表达式不使用显式括号指示表达式分析，而不是依赖运算符优先级规则和更少的括号，则大多数用于检查代码的静态分析工具都会抱怨。

开/闭大括号 {}、开闭括号 ()、带括号的条件表达式和左侧的运算符在同一缩进级别的垂直对齐是一种非常有用的做法，它极大地增强了代码的可读性和清晰度，而不是干扰所有内容可能会卡在单行上，没有垂直对齐、空格或括号

运算符优先级规则很棘手，例如 && 的优先级高于 ||，但 | 优先于 &&

所以， ...

```
 if (expr_A & expr_B || expr_C | expr_D & expr_E || expr_E && expr_F & expr_G || expr_H {
    } 
```

是一个非常简单的多重条件表达式，供人类错误地阅读和评估。

```
 if (   (  (expr_A)
            & (expr_B)
           )
        || (  (expr_C)
            | (  (expr_D)
               & (expr_E)
              )
           )
        || (   (expr_E)
            && (  (expr_F)
                & (expr_G)
               )
           )
        || (expr_H)
       )
    {
    } 
```

水平空格（换行）、垂直对齐或显式括号指导表达式评估没有任何问题，所有这些都增强了可读性和清晰度

* * *

## 回答 #21

> 赞同：-2
> 
> 时间：2008-08-08T17:13:49.730

如果你这样做：

```
if (var1 == true) {
    if (var2 == true) {
        if (var3 == true) {
            ...
        }
    }
} 
```

然后，您还可以对某些不正确的情况做出回应。例如，如果您正在验证输入，您可以为用户提供如何正确格式化输入的提示，或者其他什么。

# svn - 修复 SVN 校验和

> ID：6130
> 
> 赞同：66
> 
> 时间：2008-08-08T16:49:17.377
> 
> 标签：svn, subclipse

我在 Flex Builder 3 中使用 subclipse，最近在尝试提交时收到此错误：

`svn: Checksum mismatch for '/Users/redacted/Documents/Flex Builder 3/path/to/my/file.mxml'; expected: 'f8cb275de72776657406154dd3c10348', actual: 'null'`

我通过以下方式解决了它：

1.  提交所有其他更改的文件，省略麻烦的文件。
2.  将故障文件的内容复制到 TextMate 窗口
3.  在 FlexBuilder/Eclipse 中删除我的项目
4.  从 SVN 检查我的项目
5.  从 TextMate 窗口复制故障文件的文本
6.  提交更改。

它有效，但我不禁想到有更好的方法。导致 svn:checksum 错误的实际情况是什么，最好的解决方法是什么。

也许更重要——这是更大问题的征兆吗？

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2008-08-08T16:56:13.027

.svn 目录中的文件，用于跟踪您已签出的内容、时间、修订版本以及从何处，对于该特定文件已以某种方式损坏。

这并不比正常的奇怪文件问题更危险或更严重，并且可能是由于各种问题，例如颠覆程序在更改中死亡，电源中断等。

除非它发生更多，否则我不会从中获得太多。

可以通过执行您所做的操作来修复它，复制您的工作文件，签出新副本，然后重新添加修改后的文件。

请注意，如果您有一个繁忙的项目，通常必须合并更改，这可能会导致问题。

例如，您和一位同事都签出一份新副本，然后开始处理同一个文件。在某个时候，您的同事会检查他的修改。当您尝试这样做时，您会遇到校验和问题。如果您现在复制更改的文件，重新签出，那么 subversion 将无法跟踪您的更改应该如何合并回来。

如果您在这种情况下没有遇到问题，当您有时间签入您的修改时，您需要先更新您的工作副本，并可能处理与您的文件的冲突。

但是，如果您重新结帐并完成对同事的更改，现在看起来您删除了他的更改并替换为您自己的更改。没有冲突，也没有来自颠覆的迹象表明有什么不对劲。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-23T21:30:14.267

除了错误或磁盘损坏等，还有一个更简单的原因。我认为最有可能发生这种情况的原因是有人在工作副本上编写了递归文本替换，而不排除 .svn 文件。
这意味着文件的原始副本（基本上是文件的 BASE 版本，存储在 .svn 管理区域内）被修改，这会使 MD5 和无效。

@Andrew Hedges：这也解释了为什么您的解决方案可以解决此问题。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-25T14:04:32.303

SVN 将您签出的所有文件的原始副本保存在 .svn 目录中。这称为文本库。这允许快速的差异和恢复。在各种操作期间，SVN 将对这些基于文本的文件进行校验和，以捕获文件损坏问题。

通常，SVN 校验和不匹配意味着不应该更改的文件以某种方式更改。这意味着什么？

1.  磁盘损坏（硬盘或 IDE 电缆损坏）
2.  坏内存
3.  网络链接不好
4.  某种后台进程在您背后更改了文件（恶意软件）

所有这些都很糟糕。

**但是**，我认为您的问题有所不同。查看错误消息。请注意，它需要一些 MD5 散列，但取而代之的是“空”。如果这是一个简单的文件损坏问题，我希望您将有两个不同的 MD5 散列作为预期/得到的。你有一个'null'的事实意味着其他事情是错误的。

我有两个理论：

1.  SVN 中的错误。
2.  某些东西对文件具有排他锁，并且 MD5 不会发生。

在 #1 的情况下，尝试升级到最新的 SVN 版本。也许也可以将其发布在 svn-devel 邮件列表 ( [http://svn.haxx.se](http://svn.haxx.se) ) 上，以便开发人员可以看到。

在 #2 的情况下，检查文件是否被锁定。您可以下载 Process Explorer 的副本进行检查。请注意，您可能想查看谁锁定了基于**文本的**文件，而不是您尝试提交的实际文件。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-25T08:18:24.103

就在今天，我通过将损坏目录的副本检出到 /tmp 并用刚刚合并的文件替换 .svn/text-base 中的文件来设法从这个错误中恢复。**[我在我的博客上](http://andrew.hedges.name/blog/2009/01/25/how-to-recover-from-checksum-mismatch-errors-in-svn)**详细地写了这个过程**。**我很想听听更有经验的 SVN 用户介绍每种方法的优缺点。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-08-09T01:12:37.393

我偶尔会收到类似的东西，通常是几周内没有人靠近过的文件。一般来说，如果你知道你没有在有问题的目录中工作，你可以删除有问题的目录并运行

```
svn update 
```

重新创建它。

如果您在目录中有实时更改，那么就像 lassevk 和您自己建议的那样，需要更谨慎的方法。

一般来说，我会说最好不要留下未提交的已编辑文件，并保持工作副本整洁 - 不要将一大堆额外文件添加到您不会使用的工作副本中。定期提交，然后如果工作副本出现问题，您可以删除整个内容并重新开始，而不必担心您可能会丢失或可能不会丢失什么，也无需尝试找出要保存哪些文件的痛苦。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-03-06T18:56:18.367

尝试：svn up --force file.c

这对我有用，无需做任何额外的事情

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-05-06T13:58:46.530

从修补 .svn/entries 文件到全新结帐，我观察到了很多解决方案。

这可能是一种新方式（感谢我的同事）：

```
- go to work directory where recorder/expected checksum issue occured
- call "svn diff" and make sure that there isnt any local modifications
- cd ..
- remove trouble file's directory with "rm -rf"
- issue "svn up" command, svn client will restore new fresh files copies 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-11-20T16:17:04.803

我发现的另一个甚至可能更可怕的校验和冲突解决方法如下：

**警告：**确保您的本地副本是最知名的版本，并且您项目中的其他任何人都知道您在做什么！（以防这还不是很明显）。

如果您知道该文件的本地副本是“好的”，您可以直接从 SVN 服务器中删除该文件，然后强制提交您的本地副本。

直接删除的语法：

```
svn delete -m "deleting corrupted file XXXX" 
svn+ssh://username@svnserver/path/to/XXXX 
```

祝你好运！

Ĵ

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-06-30T08:46:50.490

马特，有比你描述的更简单的方法 - 在 .svn/entries 文件中修改校验和。这是完整的描述： http: [//maymay.net/blog/2008/06/17/fix-subversion-checksum-mismatch-error-by-editing-svnentries-file/](http://maymay.net/blog/2008/06/17/fix-subversion-checksum-mismatch-error-by-editing-svnentries-file/)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-07-08T16:19:33.803

作为检查新副本的替代方法（在尝试所有其他选项后我也必须这样做），而不是将您之前保存的所有更改合并到其中，以下方法以相同的方式工作，但为我节省了大量资金时间，可能还有一些错误：

1.  查看新的工作副本
2.  将 .svn 文件夹从您的新副本复制到损坏的副本中
3.  瞧

当然，您应该备份原始损坏的工作副本以防万一。就我而言，完成后我可以随意删除它，因为一切都很顺利。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2014-06-12T14:02:53.710

这将在 .svn 文件夹损坏时发生。解决方案：删除文件包含的整个文件夹并再次签出该文件夹。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-07-07T23:14:41.297

有这个问题，我们的开发虚拟机都是 *nix 我们的工作站 win32。一些傻瓜在 *nix 框上创建了同名（不同大小写）的文件突然在 Win32 上的结帐爆炸......因为 win 不知道 MD5 反对的 2 个同名文件中的哪一个，*nix 上的结帐很好......让我们有点摸不着头脑

我可以通过从具有良好工作副本的 *nix 框中复制“.svn”文件夹来更新 win 框上的存储库。还没有看到回购是否可以清理到我们可以再次进行完整结帐的地步

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2012-01-18T21:30:30.050

另一种简单的方法......

1.  更新您的项目以获取最新版本
2.  在另一个文件夹中签出相同的版本
3.  将新结帐中的 .svn 文件夹替换为工作副本（我已替换 .svn-base 文件）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-04-24T05:05:14.870

1.  仅将具有问题文件的文件夹从存储库检出到其他位置。
2.  确保`.svn\text-base\<problematic file>.svn-base`与已签出的相同。
3.  确保有问题的文件部分*（该部分的所有行）*与`.svn\entries`已签出的部分相同。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2013-01-10T15:19:09.770

你不会相信这一点，但我实际上已经通过`<scm>...</scm>`从我希望签入的有问题的 pom.xml 文件中删除立场来修复我的错误。它包含它签入的颠覆存储库的 URL（这就是 Maven设置是为了！），但不知何故，它在签入时为文件生成了错误的校验和。

我确实尝试了所有上述解决此问题的方法，但无济于事。我是否遇到过校验和生成器不够健壮的非常罕见的情况？

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-04-22T07:50:45.917

我也偶然发现了这个问题，并试图寻找快速的解决方案，尝试了这个线程中给出的一些解决方案。这就是我在我的开发环境中解决这个问题的方法（对我来说这是最小的变化）：

1-文件损坏的本地删除目录（WEB-INF）：

```
 svn: Checksum mismatch for 'path-to-folder\WEB-INF\web.xml':
   expected:  d60cb051162e4a6790a3ea0c9ddfb434
     actual:  16885ded2cbc1adc250e4cbbc1427546 
```

2-从新结帐中复制和粘贴目录（WEB-INF）

3- svn up，现在 Eclipse/TortoiseSVN 开始在这个目录中显示冲突

4- 将冲突标记为已解决

这行得通，我能够更新，提交早期损坏的 web.xml

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-05-17T09:03:33.750

在我的情况下，总和是不同的。我所做的只是：

1) 签出到单独的文件夹

2）用我的项目问题文件替换.svn目录中这个文件夹中的文件，这在svn-client错误消息中说

3) ..利润！

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-07-30T10:48:01.427

1.  转到导致问题的文件夹
2.  执行命令`svn update --set-depth empty`
3.  此文件夹将清空并还原空文件夹
4.  与 svn 同步并更新。

这对我有用。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-07-14T13:22:41.603

虽然这是一个老问题，但我想我也会给我的 2 美分，因为我已经与这个问题搏斗了一个多小时。

上面的解决方案要么对我不起作用，要么看起来过于复杂。

我的解决方案只是从项目中删除所有 svn 文件夹。

`find . -name .svn -exec rm -rf {} \;`

在此之后，我再次对项目进行了简单的检查。因此，我所有未提交的文件都完好无损，但仍然重建了所有 svn 文件。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-08-20T04:37:26.717

我在 ubuntu 14.04 上遇到了这个问题，并通过以下步骤解决：

1.  $ cd /var/www/myProject
2.  $ svn升级
3.  $ svn更新

在这些步骤之后，我可以毫无错误地提交文件。

* * *

## 回答 #21

> 赞同：-2
> 
> 时间：2010-05-04T15:33:38.157

这是我解决问题的方法 - v 很简单，但根据上面的 jsh，需要确保您的副本是最好的。

简单地

1.  复制同一文件夹中的所有问题文件。
2.  用 svn rm 删除旧的
3.  犯罪。
4.  然后将副本重命名为原始文件名。
5.  再次提交。

怀疑这可能会杀死该文件上的各种修订历史记录，所以这是一种非常丑陋的方法......

# linux - 你如何杀死所有超过某个年龄的 Linux 进程？

> ID：6134
> 
> 赞同：67
> 
> 时间：2008-08-08T16:50:46.643
> 
> 标签：linux, bash, unix, process

我对某个服务器上的一些类似僵尸的进程有疑问，这些进程需要不时被杀死。我怎样才能最好地识别运行时间超过一个小时左右的那些？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-08-08T17:03:56.850

找到了一个适合我的答案：

**警告：这将找到*并杀死*长时间运行的进程**

```
ps -eo uid,pid,etime | egrep '^ *user-id' | egrep ' ([0-9]+-)?([0-9]{2}:?){3}' | awk '{print $2}' | xargs -I{} kill {} 
```

（其中*user-id*是具有长时间运行进程的特定用户 ID。）

第二个正则表达式匹配具有可选天数的时间，后跟小时、分钟和秒组件，因此长度至少为一小时。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2012-05-09T23:50:32.473

如果他们只是需要被杀死：

```
if [[ "$(uname)" = "Linux" ]];then killall --older-than 1h someprocessname;fi 
```

如果你想看看它匹配的是什么

```
if [[ "$(uname)" = "Linux" ]];then killall -i --older-than 1h someprocessname;fi 
```

对于每个进程匹配，该`-i`标志将提示您是/否。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-08-08T16:56:56.880

对于超过一天的任何事情，

```
ps aux 
```

会给你答案，但它会下降到日精度，这可能没有那么有用。

```
USER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND
root         1  0.0  0.0   7200   308 ?        Ss   Jun22   0:02 init [5]
root         2  0.0  0.0      0     0 ?        S    Jun22   0:02 [migration/0]
root         3  0.0  0.0      0     0 ?        SN   Jun22   0:18 [ksoftirqd/0]
root         4  0.0  0.0      0     0 ?        S    Jun22   0:00 [watchdog/0] 
```

如果您在 linux 或其他具有 /proc 文件系统的系统上，在此示例中，您只能看到进程 1 自 6 月 22 日以来一直在运行，但看不到它的启动时间。

```
stat /proc/<pid> 
```

会给你一个更准确的答案。例如，这是进程 1 的确切时间戳，ps 仅显示为 Jun22：

```
ohm ~$ stat /proc/1
  File: `/proc/1'
  Size: 0               Blocks: 0          IO Block: 4096   directory
Device: 3h/3d   Inode: 65538       Links: 5
Access: (0555/dr-xr-xr-x)  Uid: (    0/    root)   Gid: (    0/    root)
Access: 2008-06-22 15:37:44.347627750 -0700
Modify: 2008-06-22 15:37:44.347627750 -0700
Change: 2008-06-22 15:37:44.347627750 -0700 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-08-08T17:20:01.917

通过这种方式，您可以获得十个最旧的进程的列表：

```
ps-精灵 | 排序-r -k12 | 头 -n 10
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-05-14T15:54:11.633

Jodie C 等人已经指出`killall -i`可以使用，如果要使用进程名杀死也可以。但是如果你想通过与 相同的参数杀死`pgrep -f`，你需要使用类似下面的东西，使用纯 bash 和`/proc`文件系统。

```
#!/bin/sh                                                                                                                                               

max_age=120 # (seconds)                                                                                                                                 
naughty="$(pgrep -f offlineimap)"                                                                                                                       
if [[ -n "$naughty" ]]; then # naughty is running                                                                                                       
  age_in_seconds=$(echo "$(date +%s) - $(stat -c %X /proc/$naughty)" | bc)                                                                              
  if [[ "$age_in_seconds" -ge "$max_age" ]]; then # naughty is too old!                                                                                 
    kill -s 9 "$naughty"                                                                                                                                
  fi                                                                                                                                                    
fi 
```

**这使您可以使用完整的进程名称**查找并杀死早于`max_age`秒的进程；即，可以通过引用“offlineimap”来终止命名的进程，而此处介绍的解决方案仅适用于字符串“python2”。**`/usr/bin/python2 offlineimap``killall`**

 *** * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-08-13T07:19:40.447

Perl 的 Proc::ProcessTable 可以解决问题： [http ://search.cpan.org/dist/Proc-ProcessTable/](http://search.cpan.org/dist/Proc-ProcessTable/)

您可以将其安装在 debian 或 ubuntu 中`sudo apt-get install libproc-processtable-perl`

这是一个单行：

```
perl -MProc::ProcessTable -Mstrict -w -e 'my $anHourAgo = time-60*60; my $t = new Proc::ProcessTable;foreach my $p ( @{$t->table} ) { if ($p->start() < $anHourAgo) { print $p->pid, "\n" } }' 
```

或者，更格式化，将其放入一个名为 process.pl 的文件中：

```
#!/usr/bin/perl -w
use strict;
use Proc::ProcessTable;
my $anHourAgo = time-60*60;
my $t = new Proc::ProcessTable;
foreach my $p ( @{$t->table} ) {
    if ($p->start() < $anHourAgo) {
        print $p->pid, "\n";
    }
} 
```

然后运行`perl process.pl`

这为您提供了更多的多功能性和 1 秒的开始时间分辨率。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2012-06-14T23:52:50.447

您可以使用`bc`加入 mob 答案中的两个命令，并获取自进程开始以来经过的秒数：

```
echo `date +%s` - `stat -t /proc/<pid> | awk '{print $14}'` | bc 
```

编辑：

在等待长进程运行时感到无聊，这是在摆弄几分钟后出现的结果：

```
#file: sincetime
#!/bin/bash
init=`stat -t /proc/$1 | awk '{print $14}'`
curr=`date +%s`
seconds=`echo $curr - $init| bc`
name=`cat /proc/$1/cmdline`
echo $name $seconds 
```

如果你把它放在你的路径上并这样称呼它：sincetime

它将打印进程 cmdline 和启动后的秒数。你也可以把它放在你的路径中：

```
#file: greptime
#!/bin/bash
pidlist=`ps ax | grep -i -E $1 | grep -v grep | awk '{print $1}' | grep -v PID | xargs echo`
for pid in $pidlist; do
    sincetime $pid
done 
```

如果你运行：

```
greptime <pattern> 
```

其中patterns是一个字符串或扩展的正则表达式，它将打印出所有匹配这个模式的进程以及它们启动后的秒数。:)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-10-24T02:49:34.603

做一个`ps -aef`。这将向您显示该过程开始的时间。然后使用`date`命令查找当前时间。计算两者之间的差异以找到过程的年龄。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-08-11T03:15:05.837

我做了类似于接受的答案但略有不同的事情，因为我想根据进程名称和运行超过 100 秒的错误进程进行匹配

```
kill $(ps -o pid,bsdtime -p $(pgrep bad_process) | awk '{ if ($RN > 1 && $2 > 100) { print $1; }}') 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-02-16T17:39:07.747

`stat -t /proc/<pid> | awk '{print $14}'`

从纪元开始以秒为单位获取进程的开始时间。与当前时间 ( `date +%s`) 比较以获取进程的当前年龄。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-08T16:54:49.643

使用 ps 是正确的方法。我之前已经做过类似的事情，但手边没有源代码。通常 - ps 有一个选项可以告诉它要显示哪些字段以及按哪些字段排序。您可以按运行时间对输出进行排序，grep 所需的进程，然后将其终止。

高温高压

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2012-04-02T09:07:24.583

如果有人在 C 中需要这个，你可以使用 readproc.h 和 libproc：

```
#include <proc/readproc.h>
#include <proc/sysinfo.h>

float
pid_age(pid_t pid)
{
        proc_t proc_info;
        int seconds_since_boot = uptime(0,0);
        if (!get_proc_stats(pid, &proc_info)) {
                return 0.0;
        }

        // readproc.h comment lies about what proc_t.start_time is. It's
        // actually expressed in Hertz ticks since boot

        int  seconds_since_1970 = time(NULL);
        int time_of_boot = seconds_since_1970 - seconds_since_boot;
        long  t = seconds_since_boot - (unsigned long)(proc_info.start_time / Hertz);

        int delta = t;
        float days = ((float) delta / (float)(60*60*24));
        return days;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-07-06T09:16:01.100

在某个地方遇到过..认为它简单而有用

可以直接在 crontab 中使用命令，

```
* * * * * ps -lf | grep "user" |  perl -ane '($h,$m,$s) = split /:/,$F
+[13]; kill 9, $F[3] if ($h > 1);' 
```

或者，我们可以将其编写为 shell 脚本，

```
#!/bin/sh
# longprockill.sh
ps -lf | grep "user" |  perl -ane '($h,$m,$s) = split /:/,$F[13]; kill
+ 9, $F[3] if ($h > 1);' 
```

并像这样称呼它为crontab，

```
* * * * * longprockill.sh 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-08-26T04:29:40.417

我`sincetime`上面的@Rafael S. Calsaverini 版本：

```
#!/bin/bash
ps --no-headers -o etimes,args "$1" 
```

这会反转输出字段：首先是经过的时间，其次是包含参数的完整命令。这是首选，因为完整的命令可能包含空格。

# windows - 如何在 Visual Studio 2008 xml 编辑器中编辑工作项？

> ID：6151
> 
> 赞同：7
> 
> 时间：2008-08-08T17:04:25.973
> 
> 标签：windows, visual-studio, tfs

我正在尝试通过 VS2008 xml 编辑器自定义一些 TFS 工作项，但是每次我打开一个工作项 xml 文件时，它都会跳转到图形设计器。给我的只是一个“查看 XML”按钮，它不允许您直接编辑 xml。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-08T17:06:14.910

啊，看起来你必须去文件->打开并单击打开按钮旁边的向下箭头以“打开”xml编辑器。如果有人想复制和粘贴这个，免费接受的答案：P

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-08T17:52:07.783

我没有 TFS，但我知道在常规 VS 中，大多数项目的上下文菜单中有一个 Open With... 选项，甚至可以让您更改默认编辑器。当您厌倦了在 Windows 窗体上打开设计器而不是代码文件时非常有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-10T08:02:59.530

根据 Coincoin 的回答，此功能也非常适合为 ASPX 设置默认编辑器。如果您想最常使用代码编辑器，那么这是您想要更改的默认设置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-18T12:02:57.303

阅读这篇文章——我想你可能没有意识到——没有必要编辑 XML——事实上这样做非常困难。图形设计器实际上会让您更改工作项类型、添加新字段、更改工作流程、规则等。

更改 XML 的唯一原因是 Process Editor（为图形设计师提供的工具）中是否存在错误。我对工作项类型进行了广泛的修改，只有一个实例我必须更改 XML。

# svn - Subversion Hooks 的常见类型

> ID：6155
> 
> 赞同：42
> 
> 时间：2008-08-08T17:08:51.957
> 
> 标签：svn, version-control, scripting, svn-hooks

人们为 Subversion 使用了哪些类型的钩子脚本？只是一般的想法，但代码也会很棒！

* * *

## 回答 #1

> 赞同：69
> 
> 时间：2008-09-16T02:21:00.277

我正在使用`pre-revprop-change`允许我在执行提交后实际返回并编辑评论和此类信息的钩子。如果提交注释中缺少/错误信息，这将非常有用。

在这里，我发布了一个`pre-revprop-change.bat`Windows NT 或更高版本的批处理文件。您当然可以通过更多修改来增强它。您还可以从中派生一个 `post-revprop-change.cmd`来备份旧的`snv:log`某处或只是将其附加到新日志中。

唯一棘手的部分是能够从批处理文件中实际解析标准输入。这是在这里使用`FIND.EXE`命令完成的。

另一件事是，我收到了其他用户关于使用`/b`with`exit`命令的问题的报告。`/b`如果错误情况表现不佳，您可能只需要在特定应用程序中删除它。

```
@ECHO OFF

set repos=%1
set rev=%2
set user=%3
set propname=%4
set action=%5

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Only allow changes to svn:log. The author, date and other revision
:: properties cannot be changed
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
if /I not '%propname%'=='svn:log' goto ERROR_PROPNAME

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Only allow modifications to svn:log (no addition/overwrite or deletion)
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
if /I not '%action%'=='M' goto ERROR_ACTION

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Make sure that the new svn:log message contains some text.
::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
set bIsEmpty=true
for /f "tokens=*" %%g in ('find /V ""') do (
 set bIsEmpty=false
)
if '%bIsEmpty%'=='true' goto ERROR_EMPTY

goto :eof

:ERROR_EMPTY
echo Empty svn:log properties are not allowed. >&2
goto ERROR_EXIT

:ERROR_PROPNAME
echo Only changes to svn:log revision properties are allowed. >&2
goto ERROR_EXIT

:ERROR_ACTION
echo Only modifications to svn:log revision properties are allowed. >&2
goto ERROR_EXIT

:ERROR_EXIT
exit /b 1 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-04T21:40:58.250

如果您有混合使用存储库的 unix 和 Windows 用户，我建议您使用*[case-insensitive.py](http://svn.apache.org/viewvc/subversion/trunk/contrib/hook-scripts/case-insensitive.py?view=markup)*预提交钩子脚本作为预防措施。[它可以防止由于文件重命名仅更改了文件名的大小写而导致 Windows 用户](http://subversion.apache.org/faq.html#case-change)svn 更新失败的难以解决的情况。相信我，它很有可能会为您省去麻烦。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-08-27T17:05:01.083

我们使用[FogBugz](http://www.fogcreek.com/FogBugz/)进行错误跟踪，它提供了颠覆提交脚本，允许您在签入注释中包含案例编号，然后将错误与修复它的签入相关联。它确实需要设置一个[WebSVN](http://websvn.tigris.org/)实例，以便您的存储库有一个基于 Web 的查看器。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-08T19:30:58.067

在我的工作场所，我们设置了一个 post-commit 挂钩，它生成 RSS 提要，这些提要显示在各种仪表板中，并用于代码审查人员知道什么时候该审查，并让我们看到新员工是否有足够的承诺.

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-08-26T23:49:14.457

我们将它们用于以下几件事：

*   与错误跟踪器集成（[在我们的案例中为 Trac](http://trac.edgewall.org/) - 一条显示“关闭 #514”的提交消息会自动将该错误标记为已关闭
*   与构建集成集成（[在我们的例子中是 buildbot](http://buildbot.net/) - 提交到被监视的分支会触发构建
*   用于验证提交的预提交钩子 - 我们使用[svnchecker](http://svnchecker.tigris.org/)。它验证了我们的 Python 代码的[PEP8 正确性](http://www.python.org/dev/peps/pep-0008/)
*   将签到邮件发送到邮件列表
*   运行缩进脚本

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-01-25T21:11:18.167

对于那些正在为**snvsync**操作寻找 pre-revprop-change.bat 的人：

[https://gist.github.com/1679659](https://gist.github.com/1679659)

```
@ECHO OFF

set user=%3

if /I '%user%'=='syncuser' goto ERROR_REV

exit 0

:ERROR_REV echo "Only the syncuser user may change revision properties" >&2
exit 1 
```

它只是来自这里：[http](http://chestofbooks.com/computers/revision-control/subversion-svn/Repository-Replication-Reposadmin-Maint-Replication.html) ://chestofbooks.com/computers/revision-control/subversion-svn/Repository-Replication-Reposadmin-Maint-Replication.html并已适用于 Windows。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-08T20:38:12.313

我正在使用 post-commit 钩子（[我认为是这个](http://lincolnloop.com/blog/2007/may/04/basecamp-svn-integration/)）为每次提交在 Basecamp 上的论坛上发布消息。两大优势：

1.  作为首席开发人员，我每天早上都会收到一份提交汇总（通过那个 basecamp 论坛的 RSS 提要），并且可以很快看到我的团队在做什么。

2.  我们的 Trac/SVN 安装在我们的防火墙后面，因此这让我在其他地方的上级可以了解我们正在做什么。他们可能不理解，但对经理来说，很多活动看起来，嗯，很多活动；）

我想这的最终结果类似于@Aviv 正在做的事情。

我正在寻找在单独的服务器上构建最新提交以进行持续集成的解决方案，但我将不得不改变我们对数据库模式进行更改的方式，然后才能工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-10T11:27:16.487

前段时间在 subversion 用户邮件列表上讨论过这个问题。[这篇](http://svn.haxx.se/users/archive-2008-07/0779.shtml)文章特别有一些有用的想法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-09-02T19:31:59.757

post-commit 挂钩，用于将存储库中发生更改的电子邮件通知发送到电子邮件列表。您需要将 sendmail.exe 和[sendmail.ini](http://glob.com.au/sendmail/)放在与挂钩文件相同的文件夹中。

您还需要 post-commit.cmd 旁边的文件 post-commit.tos.txt 来列出邮件收件人。该文件应包含：

```
user1@example.com,user2@example.com,user3@example.com 
```

这是钩子代码：

```
@ECHO OFF
setlocal

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Get subversion arguments
set repos=%~1
set rev=%2

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Set some variables
set tos=%repos%\hooks\%~n0.tos.txt
set reposname=%~nx1
set svnlookparam="%repos%" --revision %rev%

if not exist "%tos%" goto :END

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Prepare sendmail email file
set author=
for /f "tokens=* usebackq" %%g in (`svnlook author %svnlookparam%`) do (
  set author=%%g
)

for /f "tokens=* usebackq delims=" %%g in ("%tos%") do (
  set EmailNotificationTo=%%g
)
set SendMailFile=%~n0_%reposname%_%rev%.sm

echo To: %EmailNotificationTo% >> "%SendMailFile%"
echo From: %reposname%.svn.technologie@gsmprjct.com >> "%SendMailFile%"
echo Subject: [%reposname%] Revision %rev% - Subversion Commit Notification  >> "%SendMailFile%"

echo --- log [%author%] --- >> "%SendMailFile%"
svnlook log %svnlookparam% >> "%SendMailFile%" 2>&1
echo --- changed --- >> "%SendMailFile%"
svnlook changed %svnlookparam% --copy-info >> "%SendMailFile%" 2>&1

echo .>> "%SendMailFile%"

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Send email
type "%SendMailFile%" | "%~dp0sendmail.exe" -t

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Clean-up
if exist "%SendMailFile%" del "%SendMailFile%"

:END
endlocal 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-25T21:59:57.317

我们使用钩子脚本检查以下内容：

*   已提供提交日志消息
*   已为提交指定了审阅者
*   存储库中没有自动生成的代码或禁止的文件类型
*   创建分支/标签时发送电子邮件

我们仍然要实现以下内容：

*   当用户获得文件锁定时发送电子邮件
*   当您的锁被盗时发送电子邮件
*   更改修订属性时向所有人发送电子邮件

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-13T07:16:35.083

一个钩子，用于通知错误/问题管理系统对存储库的更改。IE。提交消息中包含 issue:546 或类似标签，已被解析并提供给错误管理系统。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-04T21:02:23.897

我们使用提交钩子脚本来触发我们的发布机器人。在我们不同的产品中将新的发布信息写入名为 changes.txt 的文件将触发标签和相关工件的创建。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-04T21:20:06.957

我有一个使用我发送到篝火室的 Ruby Tinder 库的设置，如果有人想要脚本，我可以发布或将代码发送给你。

我见过的其他常见问题是错误跟踪系统和电子邮件通知的帖子。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-08-08T17:15:26.903

我认为最常见的一种是允许人们在提交后更改修订评论。

您需要启用 'pre-revprop-change' 挂钩脚本以允许这样做。提供的示例，如果启用，则仅允许编辑评论属性并且只能是原始提交者。非常适合纠正错别字。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-09-05T03:06:06.290

我在提交时忘记输入评论。没有时间弄清楚为什么我的 pre-revprop-change 挂钩不起作用。所以下面的 svnadmin 命令对我有用，可以输入提交消息： `svnadmin setlog <filesystem path to my repository> --bypass-hooks -r 117 junk`，其中“垃圾”是包含我想成为评论的文本的文件。`svn setlog help`有更多使用信息...

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-09-02T19:04:06.563

Windows 预提交挂钩以检查日志是否包含某些内容。

```
@ECHO OFF
setlocal

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Get subversion arguments
set repos=%~1
set txn=%2

:::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Set some variables
set svnlookparam="%repos%" -t %txn%

::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
:: Make sure that the new svn:log message contains some text.
set bIsEmpty=true
for /f "tokens=* usebackq" %%g in (`svnlook log %svnlookparam%`) do (
   set bIsEmpty=false
)
if '%bIsEmpty%'=='true' goto ERROR_EMPTY

echo Allowed. >&2

goto :END

:ERROR_EMPTY
echo Empty log messages are not allowed. >&2
goto ERROR_EXIT

:ERROR_EXIT
:: You may require to remove the /b below if your hook is called directly by subversion
exit /b 1

:END
endlocal 
```

# .net - 用于解析网页链接的正则表达式？

> ID：6173
> 
> 赞同：17
> 
> 时间：2008-08-08T17:24:19.100
> 
> 标签：.net, html, regex

我正在寻找一个 .NET 正则表达式从网页中提取所有 URL，但还没有找到一个足够全面来涵盖您可以指定链接的所有不同方式。

还有一个附带问题：

是否有**一个正则表达式来统治它们**？还是我最好使用一系列不太复杂的正则表达式，只对原始 HTML 使用多重传递？（速度与可维护性）

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-08T17:32:12.253

```
((mailto\:|(news|(ht|f)tp(s?))\://){1}\S+) 
```

我从[regexlib.com拿了这个](http://regexlib.com/Search.aspx?k=URL)

[编者注：{1} 在这个正则表达式中没有真正的功能；[看到这个帖子](https://stackoverflow.com/questions/13470/question-about-specific-regular-expression)]

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-08-17T03:00:34.317

来自 RegexBuddy 库：

## 网址：全文查找

最后的字符类确保如果 URL 是某些文本的一部分，则 URL 后的逗号或句号等标点符号不会被解释为 URL 的一部分。

> `\b(https?|ftp|file)://[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|]`

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-17T01:08:30.410

使用[Html Agility Pack](https://html-agility-pack.net/)，您可以使用：

```
HtmlDocument doc = new HtmlDocument();
doc.Load("file.htm");
foreach(HtmlNode link in doc.DocumentElement.SelectNodes("//a@href")
{
Response.Write(link["href"].Value);
}
doc.Save("file.htm"); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-08T17:52:29.497

所有 HTTP 和 MAILTO

```
(["'])(mailto:|http:).*?\1 
```

由 href 或 src 调用的所有链接，包括相对链接。

```
#Matches things in single or double quotes, but not the quotes themselves
(?<=(["']))((?<=href=['"])|(?<=src=['"])).*?(?=\1)

#Maches thing in either double or single quotes, including the quotes.
(["'])((?<=href=")|(?<=src=")).*?\1 
```

但是，第二个只会为您提供使用双引号的链接。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-08T17:29:50.183

查看 URI 规范。这可以帮助你很多。就性能而言，您几乎可以在一个普通网页中提取所有 HTTP 链接。当我说谦虚时，我绝对不是指像 ELisp 手册那样包含所有 HTML 手册的一页。性能也是一个敏感的话题。我的建议是衡量你的表现，然后决定是使用一个正则表达式还是使用多个更简单的正则表达式来提取所有链接。

[http://gbiv.com/protocols/uri/rfc/rfc3986.html](http://gbiv.com/protocols/uri/rfc/rfc3986.html)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-08T17:32:01.893

我没有时间尝试考虑一个可能不起作用的正则表达式，但我想评论说你绝对应该打破你的正则表达式，至少如果它达到[这种丑陋程度](http://www.codinghorror.com/blog/archives/000214.html)：

```
(?:(?:\r\n)?[ \t])*(?:(?:(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t]
)+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ \t]))*"(?:(?:
\r\n)?[ \t])*)(?:\.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(
?:\r\n)?[ \t])+|\Z|(?=[\["()<>@,;:\\".\[\]]))|"(?:[^\"\r\\]|\\.|(?:(?:\r\n)?[ 
\t]))*"(?:(?:\r\n)?[ \t])*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\0
....*SNIP*....
*))*@(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])
+|\Z|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*)(?:\
.(?:(?:\r\n)?[ \t])*(?:[^()<>@,;:\\".\[\] \000-\031]+(?:(?:(?:\r\n)?[ \t])+|\Z
|(?=[\["()<>@,;:\\".\[\]]))|\[([^\[\]\r\\]|\\.)*\](?:(?:\r\n)?[ \t])*))*\>(?:(
?:\r\n)?[ \t])*))*)?;\s*) 
```

（这应该与电子邮件地址匹配）

编辑：我什至不能把它放在一个帖子上，太讨厌了....

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-08T17:29:57.560

网址？如图像/脚本/css/等？

> `%href="(.["]*)"%`

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-08T17:31:35.157

只要 HTML 的作者使用引号，这将从所有 a 标记中捕获 URL：

```
<a[^>]+href="([^"]+)"[^>]*> 
```

[我在这里](http://www.rubular.com/regexes/840)做了一个例子。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-09-05T16:14:25.447

根据[https://www.rfc-editor.org/rfc/rfc3986](https://www.rfc-editor.org/rfc/rfc3986)

从任何文本（不仅是 HTML）中提取 url

```
(http\\://[:/?#\\[\\]@!%$&'()*+,;=a-zA-Z0-9._\\-~]+) 
```

# c# - 如何使事件回调进入我的 win 表单线程安全？

> ID：6184
> 
> 赞同：39
> 
> 时间：2008-08-08T17:32:41.783
> 
> 标签：c#, .net, winforms, multithreading, events

当您从表单中订阅对象上的事件时，您实际上是将回调方法的控制权交给了事件源。您不知道该事件源是否会选择在不同的线程上触发事件。

问题是，当调用回调时，您不能假设可以在表单上创建更新控件，因为有时如果在与运行表单的线程不同的线程上调用事件回调，这些控件会引发异常。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2008-08-08T18:05:24.493

为了稍微简化 Simon 的代码，您可以使用内置的通用 Action 委托。它可以避免在你的代码中添加一堆你并不真正需要的委托类型。此外，在 .NET 3.5 中，他们向 Invoke 方法添加了一个 params 参数，因此您不必定义临时数组。

```
void SomethingHappened(object sender, EventArgs ea)
{
   if (InvokeRequired)
   {
      Invoke(new Action<object, EventArgs>(SomethingHappened), sender, ea);
      return;
   }

   textBox1.Text = "Something happened";
} 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-08-08T17:35:40.937

以下是要点：

1.  您不能从与创建它们的线程（表单的线程）不同的线程进行 UI 控件调用。
2.  委托调用（即事件挂钩）在与触发事件的对象相同的线程上触发。

所以，如果你有一个单独的“引擎”线程在做一些工作，并且有一些 UI 监视状态变化，这些变化可以反映在 UI 中（例如进度条或其他），那么你就有问题了。引擎火灾是一个对象更改事件，该事件已被表单挂钩。但是在引擎的线程上调用了 Form 向引擎注册的回调委托……而不是在 Form 的线程上。因此，您无法从该回调中更新任何控件。嗬！

**BeginInvoke**来救援。只需在所有回调方法中使用这个简单的编码模型，就可以确定一切都会好起来的：

```
private delegate void EventArgsDelegate(object sender, EventArgs ea);

void SomethingHappened(object sender, EventArgs ea)
{
   //
   // Make sure this callback is on the correct thread
   //
   if (this.InvokeRequired)
   {
      this.Invoke(new EventArgsDelegate(SomethingHappened), new object[] { sender, ea });
      return;
   }

   //
   // Do something with the event such as update a control
   //
   textBox1.Text = "Something happened";
} 
```

这真的很简单。

1.  使用**InvokeRequired**确定此回调是否发生在正确的线程上。
2.  如果不是，则使用相同的参数在正确的线程上重新调用回调。您可以使用**Invoke**（阻塞）或**BeginInvoke**（非阻塞）方法重新调用方法。
3.  下次调用该函数时，**InvokeRequired**返回 false，因为我们现在在正确的线程上并且每个人都很高兴。

这是解决此问题并使您的表单免受多线程事件回调的一种非常紧凑的方法。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-08-31T21:35:33.897

在这种情况下，我经常使用匿名方法：

```
void SomethingHappened(object sender, EventArgs ea)
{
   MethodInvoker del = delegate{ textBox1.Text = "Something happened"; }; 
   InvokeRequired ? Invoke( del ) : del(); 
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-04T20:08:40.190

我对这个主题有点晚了，但你可能想看看[基于事件的异步模式](http://msdn.microsoft.com/en-us/library/wewwczdw.aspx)。如果实施得当，它保证总是从 UI 线程引发事件。

这是一个只允许一个并发调用的简短示例；支持多个调用/事件需要更多的管道。

```
using System;
using System.ComponentModel;
using System.Threading;
using System.Windows.Forms;

namespace WindowsFormsApplication1
{
    public class MainForm : Form
    {
        private TypeWithAsync _type;

        [STAThread()]
        public static void Main()
        {
            Application.EnableVisualStyles();
            Application.Run(new MainForm());
        }

        public MainForm()
        {
            _type = new TypeWithAsync();
            _type.DoSomethingCompleted += DoSomethingCompleted;

            var panel = new FlowLayoutPanel() { Dock = DockStyle.Fill };

            var btn = new Button() { Text = "Synchronous" };
            btn.Click += SyncClick;
            panel.Controls.Add(btn);

            btn = new Button { Text = "Asynchronous" };
            btn.Click += AsyncClick;
            panel.Controls.Add(btn);

            Controls.Add(panel);
        }

        private void SyncClick(object sender, EventArgs e)
        {
            int value = _type.DoSomething();
            MessageBox.Show(string.Format("DoSomething() returned {0}.", value));
        }

        private void AsyncClick(object sender, EventArgs e)
        {
            _type.DoSomethingAsync();
        }

        private void DoSomethingCompleted(object sender, DoSomethingCompletedEventArgs e)
        {
            MessageBox.Show(string.Format("DoSomethingAsync() returned {0}.", e.Value));
        }
    }

    class TypeWithAsync
    {
        private AsyncOperation _operation;

        // synchronous version of method
        public int DoSomething()
        {
            Thread.Sleep(5000);
            return 27;
        }

        // async version of method
        public void DoSomethingAsync()
        {
            if (_operation != null)
            {
                throw new InvalidOperationException("An async operation is already running.");
            }

            _operation = AsyncOperationManager.CreateOperation(null);
            ThreadPool.QueueUserWorkItem(DoSomethingAsyncCore);
        }

        // wrapper used by async method to call sync version of method, matches WaitCallback so it
        // can be queued by the thread pool
        private void DoSomethingAsyncCore(object state)
        {
            int returnValue = DoSomething();
            var e = new DoSomethingCompletedEventArgs(returnValue);
            _operation.PostOperationCompleted(RaiseDoSomethingCompleted, e);
        }

        // wrapper used so async method can raise the event; matches SendOrPostCallback
        private void RaiseDoSomethingCompleted(object args)
        {
            OnDoSomethingCompleted((DoSomethingCompletedEventArgs)args);
        }

        private void OnDoSomethingCompleted(DoSomethingCompletedEventArgs e)
        {
            var handler = DoSomethingCompleted;

            if (handler != null) { handler(this, e); }
        }

        public EventHandler<DoSomethingCompletedEventArgs> DoSomethingCompleted;
    }

    public class DoSomethingCompletedEventArgs : EventArgs
    {
        private int _value;

        public DoSomethingCompletedEventArgs(int value)
            : base()
        {
            _value = value;
        }

        public int Value
        {
            get { return _value; }
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-30T21:57:58.433

作为`lazy programmer`，我有一个非常懒惰的方法来做到这一点。

我所做的只是这个。

```
private void DoInvoke(MethodInvoker del) {
    if (InvokeRequired) {
        Invoke(del);
    } else {
        del();
    }
}
//example of how to call it
private void tUpdateLabel(ToolStripStatusLabel lbl, String val) {
    DoInvoke(delegate { lbl.Text = val; });
} 
```

你可以在你的函数中内联 DoInvoke 或者将它隐藏在单独的函数中来为你做脏活。

请记住，您可以将函数直接传递给 DoInvoke 方法。

```
private void directPass() {
    DoInvoke(this.directInvoke);
}
private void directInvoke() {
    textLabel.Text = "Directly passed.";
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-08T17:41:18.333

在许多简单的情况下，您可以使用 MethodInvoker 委托，而无需创建自己的委托类型。

# .net - 智能客户端软件工厂的经验

> ID：6207
> 
> 赞同：16
> 
> 时间：2008-08-08T17:59:41.230
> 
> 标签：.net, scsf

有没有人有任何使用Microsoft 模式和实践小组的[Smart Client Software Factory](http://www.codeplex.com/smartclient)构建“真实世界”应用程序的经验？我正在寻找有关掌握它的难度的建议，它是否会缩短您的上市时间以及任何其他一般陷阱。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-11-11T15:07:06.753

我们将 SCSF 用于一个有大约 10 名开发人员的真实世界应用程序。建立和开发一种使用模式是一个陡峭的学习曲线，但是一旦建立起来，向项目介绍新的开发人员就非常容易了。使用 CAB 和 SCSF 对我们的项目非常有益，尤其是让每个开发人员加快速度并提高工作效率。

SCSF 的一个缺点是它提供了很多可能不会使用的功能（我们可能只使用了 60% 的功能）。

我也在将 SCSF 用于一个新项目，并且正在考虑重构为 PRISM。PRISM 允许您剔除未使用的功能。如果您使用 WPF，我建议您研究 PRISM。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-08T18:54:00.823

我没有个人经验，所以赞成比我做的人的建议。我认识两个用过这家工厂的同事，他们都有相同的看法：

1.  设置和学习很痛苦
2.  最后还是值得的

所以如果你有前期的空闲时间，我会去的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-05-26T09:26:59.613

我们在 2006 年与 8 名（4 个 UI + 4 个 WCF 服务）开发人员一起开发了我们的 SCSF 应用程序（进入招聘阶段），目前一层有 350 名用户使用。

刚开始，由于教程较少，要学习的东西太多，我感谢[Matias Wolosky](http://blogs.southworks.net/mwoloski/)和[​​Eugenio Pace](http://blogs.msdn.com/b/eugeniop/)，他们在模式和实践/codeplex 方面做出了很多贡献。我们得分的关键领域是：-

1) UI 和业务的明确分离 2) 开发人员的重点角色 3) 基于应用程序的按需结构的模块 4) 通过 clickonce 轻松部署 5) 就绪模式和帮助程序，使开发人员的生活更轻松，更有条理。

随着时间的推移，它在用户中赢得了很多尊重，因为它支持：-

1) RBAC - 基于角色的访问控制 2) 功能的快速周转，因为我们巧妙地分离了基础设施服务/业务服务/ UI Helper 服务，并且整个应用程序是基于模块的（CAB 的最佳部分）。
3) 现在我们正在考虑迁移到 WPF 以添加更多爵士元素。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-11T04:41:11.747

我们使用[Web 服务软件工厂](http://www.codeplex.com/servicefactory)，我们非常喜欢它，因为它使开发人员更容易遵循标准和适当的模式。我们的学习曲线还不错——每个开发人员最多几个小时。

除此之外，没有其他值得一提的优点和缺点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-20T16:17:33.087

我们将 SCSF 用于具有 6 个开发人员的真实世界复合应用程序；整个团队规模为 14 人，包括 BA、PM、测试人员等。就像 Torrey 所说，对于没有 OO 或设计模式经验的 3 名开发人员来说，这是一个陡峭的学习曲线。我和另外两个人多年来一直是 OO 纯粹主义者。所以我们只需要识别这些模式就可以像鸭子一样去CAB。在项目的中途，我们组织了一个为期一周的 OO 原则培训课程，然后是设计模式。其他 3 人完成此课程后，生产力立即开始提高。

我的建议是，确保您的团队拥有完善的 OO 和设计模式知识。当他们可以看到他们识别的模式时，曲线就会下降。

# css - FF3 WinXP ！= FF3 Ubuntu - 为什么？

> ID：6208
> 
> 赞同：14
> 
> 时间：2008-08-08T18:03:26.230
> 
> 标签：css, firefox, ubuntu

我有一个刚刚上传到互联网上的网站，在 Ubuntu 和 WinXP 上使用 Firefox 3.0.1 显示的效果不同。

我在 Ubuntu 上注意到的两件事：

1.  网站图标不见了
2.  背景颜色不显示（在样式表中设置）

我做错了什么？CSS 文件是在 Ubuntu 下获取的，那么为什么不应用所有样式表，只应用它喜欢的部分呢？为什么不显示图标？他们是同一个问题吗？

* * *

背景颜色的答案：无效的 HTML。但我很想有人解释为什么它可以在 Windows 而不是 Ubuntu 下工作。

关于 favicon 的答案：以前没有 favicon。浏览器缓存了缺少的图标。 [清除 Firefox 缓存](http://pcsupport.about.com/od/maintenance/ht/clearcacheff.htm)，一切正常。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-08T18:54:41.010

我首先建议让您验证 html 和 css 代码。如果您的标记中有任何错误，这些可能会导致渲染错误。

*   [CSS 验证器](http://jigsaw.w3.org/css-validator/)
*   [HTML 验证器](http://validator.w3.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-08T19:27:15.907

我还遇到了 WinXP 上的 FF3 和 OS X 上的 FF3 之间的差异（主要是 CSS 定位）。CSS 和 HTML 都得到了正确验证，但我一直无法弄清楚为什么会有这种差异。我认为渲染引擎是相同的，但显然至少有一些细微的差异。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-26T15:10:57.713

我同意.. 两种操作系统之间存在细微差别。其中一部分只是字体大小以及如何确定行高和字母间距。如此多的页面流是基于这些空白元素与其他页面元素交互的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-02T04:41:51.527

我相信这是字体问题和浏览器/操作系统问题。

我们知道不同的 firefox 版本取决于操作系统 - 有一些适用于 Linux 的 firefox 扩展，一些适用于 windows 的 firefox 扩展。这是我猜的字体。

尝试下载包含所有 windows 字体的 mtts core fonts (microsoft true type )，以便 firefox 可以显示您在 css 中指定的字体。

您还可以检查您是否使用了两个平台上都可用的字体。否则，我建议重新检查并重新验证您的代码。

另一个问题可能是屏幕分辨率。在具有高分辨率的 Windows 中可能没问题，但在低分辨率的 ubuntu 版本中则不行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-11-02T07:44:24.827

说得太明显了，但它们都是“Firefox 3.01”吗？例如，一个不是 Firefox 3.01 revision 3 update 6 service pack 9 而另一个，好吧，你明白了。

即使它们都是该平台上最新的 Firefox，也不意味着它们*完全*一样。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-13T09:40:42.330

要查看有什么不同，请在 Linux 和 Windows 的 Firefox 的地址栏中输入 about:config，按 Enter，然后比较输出

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-08-21T23:52:30.220

Ubuntu（我相信）将自己的补丁应用于 Firefox，所以也许是这个原因。话虽如此，我认为这些补丁仅用于较小的 GUI 类型更改。

# language-agnostic - 拆分字符串忽略引用的部分

> ID：6209
> 
> 赞同：22
> 
> 时间：2008-08-08T18:04:03.653
> 
> 标签：language-agnostic, parsing, csv

给定这样的字符串：

> a,"string, with",various,"values, and some",quoted

什么是基于逗号分割它而忽略引用部分内的逗号的好算法？

输出应该是一个数组：

> [ "a", "string, with", "various", "values, and some", "quoted" ]

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-08-08T19:36:34.093

看起来你在这里得到了一些很好的答案。

对于那些希望处理自己的 CSV 文件解析的人，请听从专家的建议，[不要使用自己的 CSV 解析器](http://secretgeek.net/csv_trouble.asp)。

您的第一个想法是，*“我需要处理引号内的逗号。”*

您的下一个想法将是，*“哦，废话，我需要处理引号内的引号。转义引号。双引号。单引号......”*

这是一条通往疯狂的道路。不要自己写。找到一个具有广泛单元测试覆盖率的库，该库涵盖了所有困难的部分，并为你经历了地狱。对于 .NET，使用免费的[FileHelpers](http://www.filehelpers.com/)库。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-08T21:07:28.450

**Python：**

```
import csv
reader = csv.reader(open("some.csv"))
for row in reader:
    print row 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-08T18:12:49.283

当然，使用 CSV 解析器会更好，但只是为了好玩，您可以：

```
Loop on the string letter by letter.
    If current_letter == quote : 
        toggle inside_quote variable.
    Else if (current_letter ==comma and not inside_quote) : 
        push current_word into array and clear current_word.
    Else 
        append the current_letter to current_word
When the loop is done push the current_word into array 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-08T18:13:11.623

作者在这里放入了一个处理您遇到问题的场景的 C# 代码块：

[.Net 中的 CSV 文件导入](https://stackoverflow.com/questions/1898/csv-file-imports-in-net#6111)

翻译应该不会太难。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-08T18:18:34.577

如果我选择的语言没有提供一种不假思索地做到这一点的方法，那么我最初会考虑两种选择作为简单的出路：

1.  预解析并用另一个控制字符替换字符串中的逗号，然后拆分它们，然后对数组进行后解析，以用逗号替换之前使用的控制字符。

2.  或者将它们拆分为逗号，然后将生成的数组解析为另一个数组，检查每个数组条目上的前导引号并将条目连接起来，直到我到达终止引号。

然而，这些都是技巧，如果这是一个纯粹的“心理”练习，那么我怀疑它们将被证明是无用的。如果这是一个现实世界的问题，那么了解该语言将有助于我们提供一些具体的建议。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-08T22:21:53.510

> 如果原始字符串中出现奇数个引号怎么办？

这看起来非常像 CSV 解析，它在处理引用字段时有一些特殊性。仅当字段用双引号分隔时，该字段才被转义，因此：

> 字段 1，“字段 2，字段 3”，字段 4，“字段 5，字段 6”字段 7

变成

> 字段1
> 
> 字段 2，字段 3
> 
> 字段4
> 
> “字段5
> 
> 场 6" 场 7

请注意，如果它不以引号开头和结尾，则它不是带引号的字段，并且双引号被简单地视为双引号。

如果我没记错的话，我链接到的代码实际上并没有正确处理这个问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-10-05T05:43:24.533

这是一个基于 Pat 伪代码的简单 python 实现：

```
def splitIgnoringSingleQuote(string, split_char, remove_quotes=False):
    string_split = []
    current_word = ""
    inside_quote = False
    for letter in string:
      if letter == "'":
        if not remove_quotes:
           current_word += letter
        if inside_quote:
          inside_quote = False
        else:
          inside_quote = True
      elif letter == split_char and not inside_quote:
        string_split.append(current_word)
        current_word = ""
      else:
        current_word += letter
    string_split.append(current_word)
    return string_split 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-08T18:36:07.460

我用它来解析字符串，不确定它在这里是否有帮助；但也许有一些小的修改？

```
function getstringbetween($string, $start, $end){
    $string = " ".$string;
    $ini = strpos($string,$start);
    if ($ini == 0) return "";
    $ini += strlen($start);   
    $len = strpos($string,$end,$ini) - $ini;
    return substr($string,$ini,$len);
}

$fullstring = "this is my [tag]dog[/tag]";
$parsed = getstringbetween($fullstring, "[tag]", "[/tag]");

echo $parsed; // (result = dog) 
```

/mp

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-08T18:40:40.617

这是一个简单的算法：

1.  判断字符串是否以字符`'"'`开头
2.  将字符串拆分为由`'"'`字符分隔的数组。
3.  用占位符标记引用的逗号`#COMMA#`
    *   如果输入以 a 开头，`'"'`则在数组中标记索引 % 2 == 0 的那些项目
    *   否则标记数组中索引 % 2 == 1 的那些项目
4.  连接数组中的项目以形成修改后的输入字符串。
5.  将字符串拆分为由`','`字符分隔的数组。
6.  `#COMMA#`用字符替换占位符数组中的所有实例`','`。
7.  该数组是您的输出。

这是python实现：（
固定处理'"a，b"，c，"d，e，f，h"，"i，j，k"'）

```
def parse_input(input):

    quote_mod = int(not input.startswith('"'))

    input = input.split('"')
    for item in input:
        if item == '':
            input.remove(item)
    for i in range(len(input)):
        if i % 2 == quoted_mod:
            input[i] = input[i].replace(",", "#COMMA#")

    input = "".join(input).split(",")
    for item in input:
        if item == '':
            input.remove(item)
    for i in range(len(input)):
        input[i] = input[i].replace("#COMMA#", ",")
    return input

# parse_input('a,"string, with",various,"values, and some",quoted')
#  -> ['a,string', ' with,various,values', ' and some,quoted']
# parse_input('"a,b",c,"d,e,f,h","i,j,k"')
#  -> ['a,b', 'c', 'd,e,f,h', 'i,j,k'] 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-08T18:52:50.030

这是标准的 CSV 样式解析。很多人尝试使用正则表达式来做到这一点。使用正则表达式可以达到大约 90%，但您确实需要一个真正的 CSV 解析器才能正确执行此操作。几个月前，我[在 CodeProject 上](http://www.codeproject.com/KB/database/CsvReader.aspx)发现了一个快速、出色的 C# CSV 解析器，我强烈推荐它！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-08T19:15:34.463

# 这是一次使用伪代码（又名 Python）的代码：-P

```
def parsecsv(instr):
    i = 0
    j = 0

    outstrs = []

    # i is fixed until a match occurs, then it advances
    # up to j. j inches forward each time through:

    while i < len(instr):

        if j < len(instr) and instr[j] == '"':
            # skip the opening quote...
            j += 1
            # then iterate until we find a closing quote.
            while instr[j] != '"':
                j += 1
                if j == len(instr):
                    raise Exception("Unmatched double quote at end of input.")

        if j == len(instr) or instr[j] == ',':
            s = instr[i:j]  # get the substring we've found
            s = s.strip()    # remove extra whitespace

            # remove surrounding quotes if they're there
            if len(s) > 2 and s[0] == '"' and s[-1] == '"':
                s = s[1:-1]

            # add it to the result
            outstrs.append(s)

            # skip over the comma, move i up (to where
            # j will be at the end of the iteration)
            i = j+1

        j = j+1

    return outstrs

def testcase(instr, expected):
    outstr = parsecsv(instr)
    print outstr
    assert expected == outstr

# Doesn't handle things like '1, 2, "a, b, c" d, 2' or
# escaped quotes, but those can be added pretty easily.

testcase('a, b, "1, 2, 3", c', ['a', 'b', '1, 2, 3', 'c'])
testcase('a,b,"1, 2, 3" , c', ['a', 'b', '1, 2, 3', 'c'])

# odd number of quotes gives a "unmatched quote" exception
#testcase('a,b,"1, 2, 3" , "c', ['a', 'b', '1, 2, 3', 'c']) 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-08T19:51:25.200

我只是忍不住想看看我是否可以让它在 Python 单行中工作：

```
arr = [i.replace("|", ",") for i in re.sub('"([^"]*)\,([^"]*)"',"\g<1>|\g<2>", str_to_test).split(",")] 
```

返回 ['a', 'string, with', 'various', 'values, and some', 'quoted']

它首先将引号内的 ',' 替换为另一个分隔符 (|)，将字符串拆分为 ',' 并替换 | 再次分隔符。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2018-10-15T02:28:08.043

既然你说语言不可知论，我尽可能用最接近伪代码的语言编写我的算法：

```
def find_character_indices(s, ch):
    return [i for i, ltr in enumerate(s) if ltr == ch]

def split_text_preserving_quotes(content, include_quotes=False):
    quote_indices = find_character_indices(content, '"')

    output = content[:quote_indices[0]].split()

    for i in range(1, len(quote_indices)):
        if i % 2 == 1: # end of quoted sequence
            start = quote_indices[i - 1]
            end = quote_indices[i] + 1
            output.extend([content[start:end]])

        else:
            start = quote_indices[i - 1] + 1
            end = quote_indices[i]
            split_section = content[start:end].split()
            output.extend(split_section)

        output += content[quote_indices[-1] + 1:].split()                                                                 

    return output 
```

# .net - 邮件通知

> ID：6210
> 
> 赞同：4
> 
> 时间：2008-08-08T18:04:24.950
> 
> 标签：.net, email

在我正在构建的 .net 系统中，需要自动电子邮件通知。这些应该可以由管理员编辑。最简单的方法是什么？SQL 表和所见即所得的编辑？

* * *

排队是个好主意。在我的老公司里，我一直在使用这种类型的流程。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-08T18:09:55.017

从高层次来看，是的。:D 主要是一些存储模板的地方。除非您还没有使用数据库，否则数据库是一个不错的选择，那么文件系统可以正常工作。

WSIWIG 编辑器（例如 fckeditor）运行良好，并为您提供了一些关于您允许的功能的不错选择。

如果您需要，某种代币替换系统也是一个好主意。例如，如果有人将 %FIRSTNAME% 放入电子邮件模板中，则生成电子邮件的代码可以进行一些简单的模式匹配，以将已知标记替换为其他已知值，这些值可能根据用户或其他情况而动态变化。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-08T18:25:17.810

我在想，如果这些是自动通知，那么这意味着它们可能会由于您的软件中的某种类型的事件而消失。如果这是一个基于 Web 的应用程序，并且您将发送其中的一些，那么请考虑实施一个电子邮件队列，而不是在每个事件上都发送一封电子邮件。

组件可以定期查询队列并发送任何待处理的项目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-08T18:07:03.727

您是在谈论接口和存储，还是发送电子邮件的实现？

是的，一个带有 FROM、TO、Subject、Body 的 SQL 表应该用于存储，而且，一个文本框甚至可能是一个 RichText 框应该用于编辑。

或者这是一个网络界面？

要实际发送它，请查看 System.Web.Mail 命名空间，它非常易于解释且易于使用:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-11T06:55:05.220

> [亚当海尔](https://stackoverflow.com/questions/6210/e-mail-notifications#6212)写道：
> 
> > 查看 System.Web.Mail 命名空间

您的意思是 .Net 2.0 及更高版本中的 System.Net.Mail :)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-11T07:33:18.730

在 .NET 3.0（和 3.5）中使用新的 Workflow 组件怎么样？这就是我们在当前项目中与模板结合使用的内容。模板具有基本格式，令牌被替换为用户信息。

# java - win64上的Eclipse

> ID：6222
> 
> 赞同：16
> 
> 时间：2008-08-08T18:17:50.460
> 
> 标签：java, eclipse, eclipse-3.4, ganymede

有人在 Windows XP 或 Vista 64 位上成功使用 Eclipse 的最新 64 位 Ganymede 版本吗？

目前我在 32 位 JDK 上运行普通的 Eclipse 3.4 发行版，并使用 64 位 JDK 启动和编译我的应用程序。我们之前的经验是 64 位 Eclipse 发行版对我们来说是不稳定的，所以我很好奇是否有人成功使用它。

我们使用的是 JDK 1.6.0_05。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-11T15:42:36.747

我正在使用带有 64 位 VM 的 Eclipse。但是我必须使用 Java 1.5，因为使用 Java 1.6，甚至 1.6.0_10ea，Eclipse 在更改 .classpath 文件时崩溃。在 Linux 上，我遇到了同样的问题，只能让 64 位 Eclipse 与 64 位 Java 1.5 一起工作。

问题似乎在于及时编译，因为使用 vmparam -Xint eclipse 可以工作——但这​​不是一个解决方案，因为它很慢。

**编辑：**

使用 1.6.0_11 似乎可以工作。

1.6_10 final 可能和评论中提到的一样有效，但我没有测试过。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-08T20:28:49.917

我已经成功地在 Vista x64 上使用它来完成一些轻量级的 Java 工作。没有什么太多的参与，也没有额外的插件，但基本的 Java 编码一直在正常工作，没有任何问题。我正在使用 3.4M7 版本，但看起来[3.4 稳定版本](http://download.eclipse.org/eclipse/downloads/drops/R-3.4-200806172000/index.php)现在支持 Vista x64。

# .net - VS 2008 - 对象消失？

> ID：6284
> 
> 赞同：8
> 
> 时间：2008-08-08T19:24:43.710
> 
> 标签：.net, visual-studio, tfs

我只使用 VS 2008 Team Foundation 几个星期。在过去的几天里，我注意到有时我页面上的一个对象/控件会从智能感知中消失。项目构建完美，对象仍在 HTML 中，但我仍然找不到对象。

还有人注意到这一点吗？

**编辑：**对于它的价值，我知道如果我关闭 VS 然后再次打开它，它就会回来。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-08-12T14:55:38.527

Visual Studio 2008[和 .NET 3.5 Framework Service Pack 1](http://msdn.microsoft.com/en-us/vstudio/products/cc533447.aspx)已经退出测试版，也许您可​​以看看这个错误是否仍然存在？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-10T11:53:28.923

我在使用 VS 2008 时也遇到了一些问题。谁会猜到我不需要在 Web 表单上选择多个控件...

无论如何，Service Pack 1 中已经修复了很多，目前处于 Beta 阶段。可能值得安装它。它在修复绝对定位方面已经走了一点路。当然，这不是您的问题，但您的解决方案也可能在那里。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-12T15:24:04.707

我偶尔会在 Visual Studio 2005 中得到这个。

我用来取回控件的一种方法是在代码视图和设计视图之间切换网页。我知道这不是一个修复程序，但它比重新启动 Visual Studio 快一点。

# c# - 为什么 Array.Length 是一个 int，而不是一个 uint

> ID：6301
> 
> 赞同：102
> 
> 时间：2008-08-08T19:34:13.503
> 
> 标签：c#, .net, int, uint

为什么是`Array.Length`int，而不是`uint`. 这让我很困扰（只是有点），因为长度值永远不会是负数。

这也迫使我在我自己的类中使用 int 作为长度属性，因为当你指定一个 int 值时，这需要显式转换......

所以最终的问题是：unsigned int ( `uint`) 有什么用处吗？甚至微软似乎也没有使用它们。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-08-08T19:50:14.987

Unsigned int 不符合 CLS，因此会将属性的使用限制为那些实现了`UInt`.

看这里：

框架 1.1

> [.NET Framework 类库简介](http://msdn.microsoft.com/en-us/library/hfa3fa08(VS.71).aspx)

框架 2.0

> [.NET Framework 类库概述](http://msdn.microsoft.com/en-us/library/hfa3fa08(VS.80).aspx)

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-01-29T13:15:42.737

很多原因：

*   uint 不符合 CLS，因此依赖于它的内置类型（数组）将是有问题的
*   最初设计的运行时禁止堆上的任何对象占用超过 2GB 的内存。由于小于或等于此限制的最大数组将是 new byte[int.MaxValue] ，因此能够生成正数但非法的数组长度会让人们感到困惑。
    *   请注意，尽管标准 Length as int 仍然存在，但在4.5 版本中已[消除了此限制。](http://msdn.microsoft.com/en-us/library/hh285054(v=vs.110).aspx)
*   从历史上看，C# 继承了 C 和 C++ 的大部分语法和约定。在这些数组中只是简单的指针运算，因此负数组索引是可能的（尽管通常是非法和危险的）。由于许多现有代码假定数组索引已签名，这将是一个因素
*   在相关说明中，在 C/C++ 中将有符号整数用于数组索引意味着与这些语言和非托管函数的互操作无论如何都需要在这些情况下使用 int，这可能会由于不一致而造成混淆。
*   BinarySearch 实现（许多算法的一个非常有用的组件）依赖于能够使用 int 的负值范围来指示未找到该值**以及**应插入此类值以保持排序的位置。
*   在对数组进行操作时，您可能希望对现有索引进行负偏移。如果您使用了一个偏移量，它将使您使用 unit 超出数组的开头，那么环绕行为将使您的索引可能合法（因为它是正数）。使用 int 结果将是非法的（但安全，因为运行时会防止读取无效内存）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-08T20:05:07.467

我认为这也可能与在较低级别上简化事情有关，因为如果 Array.Length 是无符号的，Array.Length 当然会在某个时候添加到负数，并添加到负整数（二进制补码） ，可能会出现混乱的结果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-10-13T15:23:42.283

似乎没有人提供“终极问题”的答案。

我相信无符号整数的主要用途是提供与外部系统（P/Invoke 等）的更轻松接口，并满足移植到 .NET 的各种语言的需求。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-08-08T19:40:31.587

通常，整数值是有符号的，除非您明确需要无符号值。这只是它们的使用方式。我可能不同意这个选择，但事实就是如此。

目前，在当今典型的内存限制下，如果您的数组或类似数据结构需要 UInt32 长度，您应该考虑其他数据结构。

使用字节数组，Int32 将为您提供 2GB 的值

# c# - 为什么 unsigned int 不符合 CLS？

> ID：6325
> 
> 赞同：117
> 
> 时间：2008-08-08T19:55:39.920
> 
> 标签：c#, .net, unsigned-integer, cls-compliant

为什么无符号整数不符合 CLS？

我开始认为类型规范只是为了性能而不是为了正确性。

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2008-08-08T20:01:53.497

并非所有语言都有无符号整数的概念。例如，VB 6 没有无符号整数的概念，我怀疑这导致了 VB7/7.1 的设计者也决定不实现（它现在在 VB8 中实现）。

去引用：

> [http://msdn.microsoft.com/en-us/library/12a7a7h3.aspx](http://msdn.microsoft.com/en-us/library/12a7a7h3.aspx)
> 
> CLS 的设计足够大，可以包含开发人员通常需要的语言结构，但又足够小，以至于大多数语言都能够支持它。此外，任何无法快速验证代码类型安全性的语言结构都被排除在 CLS 之外，因此所有符合 CLS 的语言都可以生成可验证的代码，如果他们选择这样做的话。

更新：几年前我确实想知道这一点，虽然我不明白为什么 UInt 不能进行类型安全验证，但我猜 CLS 家伙必须在某个地方有一个截止点，即基线最小值是多少支持的值类型数量。此外，当您考虑到越来越多的语言被移植到 CLR 的长期时，如果绝对没有概念，为什么还要强迫他们实现无符号整数以获得 CLS 合规性？

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2014-06-01T20:18:30.710

我怀疑，问题的一部分围绕着这样一个事实，即 C 中的无符号整数类型必须表现为抽象代数环的成员而不是数字[这意味着，例如，如果一个无符号的 16 位整数变量等于零, 减少它是*必需的*产生 65,535，如果它等于 65,535，则需要增加它以产生零。] 有时这种行为非常有用，但数字类型表现出这种行为可能违背了某些语言的精神。我猜想省略无符号类型的决定可能早于支持检查和未检查数字上下文的决定。就个人而言，我希望无符号数和代数环有单独的整数类型；将一元减号运算符应用于无符号 32 位数字应产生 64 位有符号结果[否定除零以外的任何值将产生负数]，但将一元减号应用于环类型应产生该环内的加法逆。

在任何情况下，无符号整数不符合 CLS 的原因是 Microsoft 决定语言不必支持无符号整数才能被视为“CLS 兼容”。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-08-08T20:04:59.090

无符号整数不符合 CLS，因为它们在某些语言之间不可互操作。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2010-09-07T13:27:40.030

Unsigned int 在现实生活中并没有给你带来太多好处，但是拥有超过 1 种类型的 int 会给你带来痛苦，所以很多语言只有 singed int。

符合 CLS 的目的是允许从多种语言中使用一个类……</p>

**请记住，没有人让您符合 CLS。**

您仍然可以**在**方法中使用无符号整数，或作为**私有**方法的参数，因为它只是符合 CLS 限制的公共 API。

# css - Haml：如何设置动态类值？

> ID：6326
> 
> 赞同：20
> 
> 时间：2008-08-08T19:56:42.787
> 
> 标签：css, ruby-on-rails, haml

我有以下 html.erb 代码，我希望将其移至 Haml：

```
<span class="<%= item.dashboardstatus.cssclass %>" ><%= item.dashboardstatus.status %></span> 
```

它所做的是将当前分配状态的 CSS 类与 span 相关联。

这在 Haml 中是如何完成的？我确定我错过了一些非常简单的东西。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-08-08T20:28:18.387

没有把握。也许：

```
%span{:class => item.dashboardstatus.cssclass }= item.dashboardstatus.status 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-12-14T09:40:32.110

您可以使用数组语法执行多个条件类选择器：

> %div{ class: [ ("active" if @thing.active?), ("highlight" if @thing.important?) ] }

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2017-09-20T10:35:13.470

这行得通。

页面的链接在哪里做这样的事情

```
 %div{"data-turbolinks" => "false"}
    = link_to 'Send payment', new_payments_manager_path(sender_id: current_user.id, receiver_id: @collaboration.with(current_user).id, collaboration_id: params[:id]), class: 'button' 
```

# sql - 多个外键？

> ID：6340
> 
> 赞同：18
> 
> 时间：2008-08-08T20:07:43.390
> 
> 标签：sql, mysql, foreign-keys

我有一张表格，用来记录从一个供应商向另一个供应商运送产品的天数和成本。我们（出色地：p）将运输供应商（FedEx、UPS）和产品处理供应商（Think...Dunder Mifflin）存储在“供应商”表中。所以，我的 SHIPPING_DETAILS 表中有三列都引用了 VENDOR.no。出于某种原因，MySQL 不允许我将所有三个定义为外键。有任何想法吗？

```
CREATE TABLE SHIPPING_GRID(  
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT 'Unique ID for each row',  
    shipping_vendor_no INT(6) NOT NULL COMMENT 'Foreign key to VENDOR.no for the shipping vendor (vendors_type must be 3)',  
    start_vendor_no INT(6) NOT NULL COMMENT 'Foreign key to VENDOR.no for the vendor being shipped from',  
    end_vendor_no INT(6) NOT NULL COMMENT 'Foreign key to the VENDOR.no for the vendor being shipped to',  
    shipment_duration INT(1) DEFAULT 1 COMMENT 'Duration in whole days shipment will take',  
    price FLOAT(5,5) NOT NULL COMMENT 'Price in US dollars per shipment lbs (down to 5 decimal places)',  
    is_flat_rate TINYINT(1) DEFAULT 0 COMMENT '1 if is flat rate regardless of weight, 0 if price is by lbs',  
    INDEX (shipping_vendor_no),  
    INDEX (start_vendor_no),  
    INDEX (end_vendor_no),  
    FOREIGN KEY (shipping_vendor_no) REFERENCES VENDOR (no),  
    FOREIGN KEY (start_vendor_no) REFERENCES VENDOR (no),  
    FOREIGN KEY (end_vendor_no) REFERENCES VENDOR (no)  
) TYPE = INNODB; 
```

*编辑删除双主键定义...*

* * *

是的，不幸的是，这并没有解决它。现在我得到：

> 无法创建表'./删除我的*数据库名称*/SHIPPING_GRID.frm'（错误号：150）

做一个 phpinfo() 告诉我这个mysql：

> 客户端 API 版本 5.0.45

是的，VENDOR.no 是 int(6) 类型。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-08-08T20:18:25.553

您定义了两次主键。尝试：

```
CREATE TABLE SHIPPING_GRID(  
    id INT NOT NULL AUTO_INCREMENT PRIMARY KEY COMMENT 'Unique ID for each row',  
    shipping_vendor_no INT(6) NOT NULL COMMENT 'Foreign key to VENDOR.no for the shipping vendor (vendors_type must be 3)',  
    start_vendor_no INT(6) NOT NULL COMMENT 'Foreign key to VENDOR.no for the vendor being shipped from',  
    end_vendor_no INT(6) NOT NULL COMMENT 'Foreign key to the VENDOR.no for the vendor being shipped to',  
    shipment_duration INT(1) DEFAULT 1 COMMENT 'Duration in whole days shipment will take',  
    price FLOAT(5,5) NOT NULL COMMENT 'Price in US dollars per shipment lbs (down to 5 decimal places)',  
    is_flat_rate TINYINT(1) DEFAULT 0 COMMENT '1 if is flat rate regardless of weight, 0 if price is by lbs',  
    INDEX (shipping_vendor_no),  
    INDEX (start_vendor_no),  
    INDEX (end_vendor_no),  
    FOREIGN KEY (shipping_vendor_no) REFERENCES VENDOR (no),  
    FOREIGN KEY (start_vendor_no) REFERENCES VENDOR (no),  
    FOREIGN KEY (end_vendor_no) REFERENCES VENDOR (no)  
) TYPE = INNODB; 
```

VENDOR 主键必须是 INT(6)，并且两个表都必须是 InnoDB 类型。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-08T20:44:23.597

> 能否提供 VENDOR 表的定义

我想到了。VENDOR 表是 MyISAM ...（编辑了您的答案，告诉我让它们都成为 INNODB ；））

（有什么理由*不*将 VENDOR 类型切换到 INNODB 吗？）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-08T20:18:58.173

我在这里运行代码，错误消息显示（这是正确的！）您将*id*字段设置为主键两次。

# sql - 如何将逗号分隔的列表传递给存储过程？

> ID：6369
> 
> 赞同：19
> 
> 时间：2008-08-08T20:48:29.377
> 
> 标签：sql, sap-ase

所以我有一个 Sybase 存储过程，它接受 1 个参数，该参数是一个逗号分隔的字符串列表，并在 IN() 子句中使用 in 运行查询：

```
CREATE PROCEDURE getSomething @keyList varchar(4096)
AS
SELECT * FROM mytbl WHERE name IN (@keyList) 
```

如何调用列表中超过 1 个值的存储过程？到目前为止我已经尝试过

```
exec getSomething 'John'         -- works but only 1 value
exec getSomething 'John','Tom'   -- doesn't work - expects two variables
exec getSomething "'John','Tom'" -- doesn't work - doesn't find anything
exec getSomething '"John","Tom"' -- doesn't work - doesn't find anything
exec getSomething '\'John\',\'Tom\'' -- doesn't work - syntax error 
```

**编辑：**我实际上发现这个[页面](http://vyaskn.tripod.com/passing_arrays_to_stored_procedures.htm)对将数组传递给存储过程的各种方法有很好的参考

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-14T09:27:30.793

如果您使用的是 Sybase 12.5 或更早版本，则不能使用函数。一种解决方法可能是用这些值填充一个临时表并从那里读取它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-10-25T16:01:30.880

这有点晚了，但不久前我遇到了这个确切的问题，我找到了解决方案。

诀窍是双引号，然后将整个字符串用引号括起来。

```
exec getSomething """John"",""Tom"",""Bob"",""Harry""" 
```

修改您的过程以将表条目与字符串匹配。

```
CREATE PROCEDURE getSomething @keyList varchar(4096)
AS
SELECT * FROM mytbl WHERE @keyList LIKE '%'+name+'%' 
```

自 ASE 12.5 以来，我已经在生产中使用它；我们现在是 15.0.3。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-08T21:04:58.703

将逗号分隔的列表传递给返回表值的函数。StackOverflow 上有一个 MS SQL 示例，如果我现在能看到的话，该死的。

> ```
> CREATE PROCEDURE getSomething @keyList varchar(4096)
> AS
> SELECT * FROM mytbl WHERE name IN (fn_GetKeyList(@keyList)) 
> ```

打电话给 -

> ```
> exec getSomething 'John,Tom,Foo,Bar' 
> ```

我猜 Sybase 应该能够做类似的事情？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-08T20:57:51.150

您需要使用逗号分隔的列表吗？过去几年，我一直采用这种想法并传入一个 XML 文件。openxml“函数”接受一个字符串并使其像xml，然后如果您使用数据创建一个临时表，它是可查询的。

```
DECLARE @idoc int
DECLARE @doc varchar(1000)
SET @doc ='
<ROOT>
<Customer CustomerID="VINET" ContactName="Paul Henriot">
   <Order CustomerID="VINET" EmployeeID="5" OrderDate="1996-07-04T00:00:00">
      <OrderDetail OrderID="10248" ProductID="11" Quantity="12"/>
      <OrderDetail OrderID="10248" ProductID="42" Quantity="10"/>
   </Order>
</Customer>
<Customer CustomerID="LILAS" ContactName="Carlos Gonzlez">
   <Order CustomerID="LILAS" EmployeeID="3" OrderDate="1996-08-16T00:00:00">
      <OrderDetail OrderID="10283" ProductID="72" Quantity="3"/>
   </Order>
</Customer>
</ROOT>'
--Create an internal representation of the XML document.
EXEC sp_xml_preparedocument @idoc OUTPUT, @doc
-- Execute a SELECT statement that uses the OPENXML rowset provider.
SELECT    *
FROM       OPENXML (@idoc, '/ROOT/Customer',1)
            WITH (CustomerID  varchar(10),
                  ContactName varchar(20)) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-09T00:05:04.847

关于 Kevin 将参数传递给将文本拆分为表格的函数的想法，这是我几年前对该函数的实现。工作一种享受。

[在 SQL 中将文本拆分为单词](http://www.madprops.org/blog/splitting-text-into-words-in-sql-revisited/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-07T13:18:46.057

这是一种可能有用的快速而肮脏的方法：

```
select  * 
from    mytbl 
where   "," + ltrim(rtrim(@keylist)) + "," like "%," + ltrim(rtrim(name)) + ",%" 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-23T20:17:38.717

不确定它是否在 ASE 中，但在 SQL Anywhere 中，*sa_split_list*函数从 CSV 返回一个表。它具有可选参数来传递不同的分隔符（默认为逗号）和每个返回值的最大长度。

[sa_split_list 函数](http://www.ianywhere.com/developer/product_manuals/sqlanywhere/1000/en/html/dbrfen10/rf-sa-set-http-option.html)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-23T20:36:39.560

像这样的调用的问题是： exec getSomething '"John","Tom"' 是它将 '"John","Tom"' 视为单个字符串，它只会匹配表中的条目 '"约翰”、“汤姆”。

如果您不想像 Paul 的回答那样使用临时表，那么您可以使用动态 sql。（假设 v12+）

```
CREATE PROCEDURE getSomething @keyList varchar(4096)
AS
declare @sql varchar(4096)
select @sql = "SELECT * FROM mytbl WHERE name IN (" + @keyList +")"
exec(@sql) 
```

您需要确保 @keylist 中的项目在它们周围有引号，即使它们是单个值。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-10-30T17:57:16.700

这适用于 SQL。在您的`GetSomething`过程中声明一个 XML 类型的变量，如下所示：

```
DECLARE @NameArray XML = NULL 
```

存储过程的主体实现以下内容：

```
SELECT * FROM MyTbl WHERE name IN (SELECT ParamValues.ID.value('.','VARCHAR(10)')
FROM @NameArray.nodes('id') AS ParamValues(ID)) 
```

在调用存储过程之前调用 SP 以声明和初始化 XML 变量的 SQL 代码中：

```
DECLARE @NameArray XML

SET @NameArray = '<id><</id>id>Name_1<<id>/id></id><id><</id>id>Name_2<<id>/id></id><id><</id>id>Name_3<<id>/id></id><id><</id>id>Name_4<<id>/id></id>' 
```

使用您的示例，对存储过程的调用将是：

```
EXEC GetSomething @NameArray 
```

我以前用过这种方法，效果很好。如果您想要快速测试，请将以下代码复制并粘贴到新查询并执行：

```
DECLARE @IdArray XML

SET @IdArray = '<id><</id>id>Name_1<<id>/id></id><id><</id>id>Name_2<<id>/id></id><id><</id>id>Name_3<<id>/id></id><id><</id>id>Name_4<<id>/id></id>'

SELECT ParamValues.ID.value('.','VARCHAR(10)')
FROM @IdArray.nodes('id') AS ParamValues(ID) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-06-03T01:13:32.650

要了解@Abel 提供的内容，帮助我的是：

我的目的是获取最终用户从 SSRS 输入的内容，并在我的 where 子句中将其用作 In (SELECT) 显然 @ICD_VALUE_RPT 将在我的数据集查询中被注释掉。

```
DECLARE @ICD_VALUE_RPT VARCHAR(MAX) SET @ICD_VALUE_RPT = 'Value1, Value2'
DECLARE @ICD_VALUE_ARRAY XML SET @ICD_VALUE_ARRAY = CONCAT('<id>', REPLACE(REPLACE(@ICD_VALUE_RPT, ',', '</id>,<id>'),' ',''), '</id>') 
```

然后在我的`WHERE`我添加：

```
(PATS_WITH_PL_DIAGS.ICD10_CODE IN (SELECT ParamValues.ID.value('.','VARCHAR(MAX)') FROM @ICD_VALUE_ARRAY.nodes('id') AS ParamValues(ID))
OR PATS_WITH_PL_DIAGS.ICD9_CODE IN (SELECT ParamValues.ID.value('.','VARCHAR(MAX)') FROM @ICD_VALUE_ARRAY.nodes('id') AS ParamValues(ID))
) 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-09-07T09:06:03.437

试试这个方法。它对我有用。

```
@itemIds varchar(max)

CREATE PROCEDURE getSomething @keyList varchar(4096)
AS
SELECT * FROM mytbl WHERE name IN (SELECT Value FROM [Global_Split] (@itemIds,',')) 
```

# mysql - 您如何管理开发、测试和生产中的数据库？

> ID：6371
> 
> 赞同：177
> 
> 时间：2008-08-08T20:50:02.930
> 
> 标签：mysql, svn

我很难找到关于如何在开发、测试和生产服务器之间管理数据库模式和数据的好例子。

这是我们的设置。每个开发人员都有一个运行我们的应用程序和 MySQL 数据库的虚拟机。这是他们的个人沙盒，可以为所欲为。目前，开发人员将对 SQL 模式进行更改，并将数据库转储到他们提交到 SVN 的文本文件中。

我们希望部署一个始终运行最新提交的代码的持续集成开发服务器。如果我们现在这样做，它将为每个构建从 SVN 重新加载数据库。

我们有一个运行“候选版本”的测试（虚拟）服务器。部署到测试服务器目前是一个非常手动的过程，通常需要我从 SVN 加载最新的 SQL 并对其进行调整。另外，测试服务器上的数据不一致。您最终会得到最后一个开发人员提交的沙盒服务器上的任何测试数据。

一切都崩溃的地方是部署到生产。由于我们无法用测试数据覆盖实时数据，因此这涉及手动重新创建所有架构更改。如果有大量的模式更改或转换脚本来操作数据，这可能会变得非常棘手。

如果问题只是架构，这将是一个更容易的问题，但是数据库中还有在开发过程中更新的“基础”数据，例如安全和权限表中的元数据。

这是我在迈向持续集成和一步构建方面看到的最大障碍。***你***如何解决它？

* * *

一个后续问题：如何跟踪数据库版本，以便知道要运行哪些脚本来升级给定的数据库实例？标准程序下方是否有像 Lance 提到的版本表？

* * *

感谢您提到塔伦蒂诺。我不在 .NET 环境中，但我发现他们的[DataBaseChangeMangement wiki 页面](http://code.google.com/p/tarantino/wiki/DatabaseChangeManagement)非常有帮助。特别是这个[PowerPoint演示文稿（.ppt）](http://tarantino.googlecode.com/svn/docs/Database-Change-Management.ppt)

我将编写一个 Python 脚本，`*.sql`根据数据库中的表检查给定目录中脚本的名称，并根据构成文件名第一部分的整数按顺序运行那些不存在的脚本。如果这是一个非常简单的解决方案，我怀疑它会是，那么我会在这里发布。

* * *

我有一个工作脚本。如果数据库不存在，它会处理初始化数据库，并根据需要运行升级脚本。还有用于擦除现有数据库和从文件导入测试数据的开关。大约有 200 行，所以我不会发布它（尽管如果有兴趣我可能会将它放在 pastebin 上）。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-08-08T21:01:09.490

有几个不错的选择。我不会使用“恢复备份”策略。

1.  编写所有架构更改的脚本，并让 CI 服务器在数据库上运行这些脚本。有一个版本表来跟踪当前的数据库版本，并且只在脚本用于较新版本时才执行。

2.  使用迁移解决方案。这些解决方案因语言而异，但对于 .NET，我使用 Migrator.NET。这允许您对数据库进行版本控制并在版本之间上下移动。您的架构是在 C# 代码中指定的。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2008-08-08T21:03:32.933

您的开发人员需要为他们处理的每个错误/功能编写更改脚本（模式和数据更改），而不仅仅是将整个数据库转储到源代码控制中。这些脚本会将当前的生产数据库升级到开发中的新版本。

您的构建过程可以将生产数据库的副本恢复到适当的环境中，并在其上运行源代码控制中的所有脚本，这会将数据库更新到当前版本。我们每天都会这样做，以确保所有脚本都正确运行。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-08-17T09:38:38.570

看看 Ruby on Rails 是如何做到这一点的。

首先有所谓的迁移文件，它基本上将数据库模式和数据从版本 N 转换到版本 N+1（或者在从版本 N+1 降级到 N 的情况下）。数据库有一个告诉当前版本的表。

测试数据库总是在单元测试之前被清除干净，并用文件中的固定数据填充。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-12T14:41:04.710

[Refactoring Databases: Evolutionary Database Design](https://rads.stackoverflow.com/amzn/click/com/0321293533)一书可能会给你一些关于如何管理数据库的想法。一个简短的版本也可以在[http://martinfowler.com/articles/evodb.html阅读](http://martinfowler.com/articles/evodb.html)

在一个 PHP+MySQL 项目中，我将数据库修订号存储在数据库中，当程序连接到数据库时，它会首先检查修订。如果程序需要不同的版本，它将打开一个用于升级数据库的页面。每次升级都在 PHP 代码中指定，这将更改数据库架构并迁移所有现有数据。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-16T08:09:36.773

您还可以考虑使用[SQL Compare](http://www.red-gate.com/products/SQL_Compare/index.htm)之类的工具来编写数据库不同版本之间的差异脚本，从而允许您在版本之间快速迁移

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-22T06:38:02.427

*   如下命名你的数据库 - `dev_<<db>> , tst_<<db>> , stg_<<db>> , prd_<<db>>`（显然你不应该硬编码数据库名称
*   因此，您甚至可以在同一物理服务器上部署不同类型的数据库（我不建议这样做，但您可能必须......如果资源紧张）
*   确保您能够在它们之间自动移动数据
*   将数据库创建脚本与人口分开=始终可以从头开始重新创建数据库并填充它（从旧的数据库版本或外部数据源
*   不要在代码中使用硬编码连接字符串（甚至不在配置文件中）-在配置文件中使用连接字符串模板，您会动态填充这些模板，需要重新编译的 application_layer 的每次重新配置都是不好的
*   一定要使用数据库版本控制和数据库对象版本控制——如果你能负担得起就使用现成的产品，如果不能自己开发一些东西
*   跟踪每个 DDL 更改并将其保存到某个历史记录表中（[此处为示例](http://ysgitdiary.blogspot.com/2009/04/db-trigger-to-force-versioning-in-ddl.html)）
*   每日备份！测试您能够以多快的速度恢复从备份中丢失的内容（使用自动恢复脚本
*   即使您的 DEV 数据库和 PROD 具有完全相同的创建脚本，您也会遇到数据问题，因此请允许开发人员创建 prod 的确切副本并使用它（我知道我会收到这个的缺点，但是更改当狗屎击中粉丝时，心态和业务流程将花费您更少的成本-因此，请强制编码人员合法地订阅它所做的任何事情，但请确保这一点

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-08-21T02:58:16.080

这是我一直不满意的事情——我们对这个问题的解决方案就是这样。几年来，我们为每个版本维护了一个单独的更改脚本。此脚本将包含上一个生产版本的增量。随着应用程序的每次发布，版本号都会增加，如下所示：

*   dbChanges_1.sql
*   dbChanges_2.sql
*   ...
*   dbChanges_n.sql

这工作得很好，直到我们开始维护两条开发线：用于新开发的主干/主线，以及用于错误修复、短期增强等的维护分支。不可避免地，需要对分支中的模式进行更改。此时，我们已经在 Trunk 中有 dbChanges_n+1.sql，所以我们最终采用了如下方案：

*   dbChanges_n.1.sql
*   dbChanges_n.2.sql
*   ...
*   dbChanges_n.3.sql

同样，这运行得很好，直到有一天我们在主线中看到 42 个增量脚本，在分支中看到 10 个。啊！

如今，我们只维护一个增量脚本并让 SVN 对其进行版本化 - 即我们在每个版本中覆盖该脚本。而且我们回避在分支中进行架构更改。

所以，我对此也不满意。我真的很喜欢从 Rails 迁移的概念。我对[LiquiBase](http://www.liquibase.org)非常着迷。它支持增量数据库重构的概念。值得一看，我很快就会详细了解它。有人有这方面的经验吗？我很想知道你的结果。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-02T23:30:03.217

我们的设置与 OP 非常相似。

开发人员在带有私有数据库的 VM 中进行开发。

[开发人员将很快进入私有分支]

测试在不同的机器上运行（实际上是在托管在服务器上的 VM 中）[即将由 Hudson CI 服务器运行]

通过将参考转储加载到数据库中进行测试。应用开发者模式补丁，然后应用开发者数据补丁

然后运行单元和系统测试。

生产作为安装程序部署给客户。

我们所做的：

我们获取沙盒数据库的模式转储。然后是 sql 数据转储。我们将其与之前的基线进行比较。那对增量是将n-1升级到n。

我们配置转储和增量。

因此，要安装版本 N CLEAN，我们将转储运行到一个空数据库中。要打补丁，请应用中间补丁。

（Juha 提到 Rail 的想法是有一个记录当前数据库版本的表是一个很好的想法，应该可以减少安装更新的烦恼。）

Delta 和转储必须在 beta 测试之前进行审查。我看不到任何解决方法，因为我看到开发人员自己将测试帐户插入数据库。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-16T07:07:11.780

恐怕我同意其他海报。开发人员需要编写他们的更改脚本。

在许多情况下，一个简单的 ALTER TABLE 不起作用，您还需要修改现有数据 - 开发人员需要了解需要哪些迁移并确保它们的脚本正确（当然您需要在某些时候仔细测试发布周期）。

此外，如果您有任何意义，您还将让您的开发人员为他们的更改编写脚本回滚，以便在需要时可以恢复它们。这也应该进行测试，以确保它们的回滚不仅执行没有错误，而且使数据库保持与以前相同的状态（这并不总是可能或可取的，但在大多数情况下是一个很好的规则） .

我不知道如何将它连接到 CI 服务器中。也许您的 CI 服务器需要有一个已知的构建快照，它每晚都会恢复到该快照，然后应用此后的所有更改。这可能是最好的，否则一个损坏的迁移脚本不仅会破坏当晚的构建，还会破坏所有后续构建。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-13T20:36:45.670

如果您在 .NET 环境中，那么解决方案是[Tarantino (archived)](http://web.archive.org/web/20150814180919/https://github.com/HeadspringLabs/Tarantino)。它在 NANT 构建中处理所有这些（包括要安装的 sql 脚本）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-22T12:53:34.037

查看[dbdeploy](http://dbdeploy.com/)，已经有 Java 和 .net 工具可用，您可以遵循他们的 SQL 文件布局和模式版本表标准并编写您的 python 版本。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-11-04T19:55:32.500

我们正在使用命令行[mysql-diff](http://bitbucket.org/stepancheg/mysql-diff/)：它将两个数据库模式（来自实时数据库或脚本）之间的差异输出为 ALTER 脚本。mysql-diff 在应用程序启动时执行，如果架构发生变化，它会报告给开发人员。因此开发人员不需要手动编写 ALTER，模式更新是半自动发生的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-12T14:17:41.943

我编写了一个工具（通过连接到[Open DBDiff](http://www.codeplex.com/OpenDBiff)）比较数据库模式，并向您建议迁移脚本。如果您进行删除或修改数据的更改，它将引发错误，但会为脚本提供建议（例如，当新模式中缺少列时，它将检查该列是否已重命名并创建 xx - 生成script.sql.suggestion 包含重命名语句）。

[http://code.google.com/p/migrationscriptgenerator/](http://code.google.com/p/migrationscriptgenerator/)恐怕只有 SQL Server :( 它也很 alpha，但摩擦力非常低（特别是如果你将它与 Tarantino 或[http://code.google结合使用.com/p/simplescriptrunner/](http://code.google.com/p/simplescriptrunner/)）

我使用它的方式是在你的 .sln 中有一个 SQL 脚本项目。您在本地还有一个 db_next 数据库，您可以对它进行更改（使用 Management Studio 或[NHibernate Schema Export](http://wiki.fluentnhibernate.org/show/GettingStarted:+First+Project)或[LinqToSql CreateDatabase](http://msdn.microsoft.com/en-us/library/bb399420.aspx)或其他东西）。然后使用 _dev 和 _next DB 执行 migrationscriptgenerator，这会创建。用于迁移的 SQL 更新脚本。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-03-12T14:10:41.743

对于 oracle 数据库，我们使用[oracle-ddl2svn](http://oracle-ddl2svn.googlecode.com)工具。

这个工具自动化了下一个过程

1.  对于每个数据库方案获取方案 ddls
2.  放在版本控制下

手动解决实例之间的更改

# javascript - 闭包风格有什么区别

> ID：6373
> 
> 赞同：23
> 
> 时间：2008-08-08T20:53:21.393
> 
> 标签：javascript

javascript 中有两种流行的闭包样式。我首先调用*匿名构造函数*：

```
new function() { 
  var code...
} 
```

和*内联执行函数*：

```
(function() {
  var code...
})(); 
```

这两者之间的行为是否存在差异？一个比另一个“更好”吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-08T22:02:14.830

两种情况都会执行函数，唯一真正的区别是表达式的返回值可能是什么，以及函数内部的“this”的值是什么。

基本上的行为

```
new expression 
```

等效于

```
var tempObject = {};
var result = expression.call(tempObject);
if (result is not an object)
    result = tempObject; 
```

当然 tempObject 和 result 是你永远看不到的瞬态值（它们是解释器中的实现细节），并且没有 JS 机制来执行“不是对象”检查。

从广义上讲，“new function() { .. }”方法会比较慢，因为需要为构造函数创建 this 对象。

也就是说，这应该不是真正的区别，因为对象分配并不慢，并且您不应该在热代码中使用此类代码（由于创建函数对象和相关闭包的成本）。

编辑：我意识到我错过的一件事是`tempObject`将获得`expression`原型，例如。（之前`expression.call`）`tempObject.__proto__ = expression.prototype`

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-08T21:08:38.197

@Lance：第一个也在执行。将其与命名构造函数进行比较：

```
function Blah() {
    alert('blah');
}
new Bla(); 
```

这实际上也在执行代码。匿名构造函数也是如此......

但这不是问题;-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-09T02:20:29.597

他们都通过执行代码块来创建一个闭包。就风格而言，我更喜欢第二种，原因如下：

乍一看，代码实际上会被执行并不是很明显。该行*看起来像是*在*创建*一个新函数，而不是作为构造函数执行它，但这并不是实际发生的事情。避免不做看起来像它正在做的事情的代码！

还有`(function(){`...`})();`制作漂亮的书挡标记，以便您可以立即看到您正在进入和离开闭包范围。这很好，因为它提醒阅读它的程序员注意范围的变化，并且如果您正在对文件进行一些后处理，例如缩小，则特别有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-08T22:20:46.540

好吧，我做了一个这样的页面：

```
<html>
<body>
<script type="text/javascript">
var a = new function() { 
  alert("method 1");

  return "test";
};

var b = (function() {
  alert("method 2");

  return "test";
})();

alert(a);  //a is a function
alert(b);  //b is a string containing "test"

</script>
</body>
</html> 
```

令人惊讶的是（无论如何对我来说）它提醒了“方法1”和方法2“。我没想到会提醒“方法1”。区别在于a和b的值是什么。a是函数本身，而 b 是函数返回的字符串。

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2008-08-09T00:29:38.633

是的，两者之间存在差异。

两者都是匿名函数并以完全相同的方式执行。但是，两者之间的区别在于，在第二种情况下，变量的范围仅限于匿名函数本身。不可能意外地将变量添加到全局范围。

这意味着通过使用第二种方法，您不会弄乱全局变量范围，这很好，因为这些全局变量值可能会干扰您可能在其他库中使用或在第三方库中使用的其他一些全局变量.

例子：

```
<html>
<body>
<script type="text/javascript">

new function() { 
a = "Hello";
alert(a + " Inside Function");
};

alert(a + " Outside Function");

(function() { 
var b = "World";
alert(b + " Inside Function");
})();

alert(b + " Outside Function");
</script>
</body>
</html> 
```

在上面的代码中，输出类似于：

> 你好内部函数
> 你好外部函数
> 世界内部函数

...然后，您会收到一个错误，因为 'b' 未在函数外部定义！

因此，我相信第二种方法更好……更安全！

# outlook - 在为事件实施 ICalendar 导出时应针对哪些客户？

> ID：6378
> 
> 赞同：5
> 
> 时间：2008-08-08T20:58:11.103
> 
> 标签：outlook, gmail, icalendar, recurrence

[http://en.wikipedia.org/wiki/ICalendar](http://en.wikipedia.org/wiki/ICalendar)

我正在努力实现事件的导出功能。上面的链接列出了大量支持 ICalendar 标准的客户端，但我可以看到的“三大客户端”是 Apple 的 iCal、Microsoft 的 Outlook 和 Google 的 Gmail。

我开始感觉到这些客户端中的每一个都实现了“标准”的不同部分，并且我不确定我们应该尝试从应用程序中导出哪些信息，以便有人可以将其放在他们的日历上（尤其是在复发前后）。

例如，据我了解，Outlook 不支持每小时重复。

你们中的任何人都可以从功能实现的角度提供“快乐媒体”的指导吗？

第二个问题，如果我们决定从导出中删除功能（例如每小时重复），因为 Outlook 不支持它，我们是否应该在应用程序中也支持它？（它是一个通用的事件调度应用程序，没有考虑特定的业务用途......所以我们真的在寻找快乐的媒介）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-12T03:10:43.130

我不得不说我不使用每小时重复功能，因为实际上有多少人在同一天重复发生事件？但是，我可以查看是否有人要安排他们需要在一天中重复的时间服用特定药物的时间。

我会说支持应用程序本身的全部功能，但在他们导出日历时会发出警告，说明所有事件详细信息可能无法按预期工作，或者找到一种方法以单独的 Outlook 以不同的方式导出，它确实提供每小时重复特征。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-08-09T14:29:08.610

我在[Lightning](http://www.mozilla.org/projects/calendar/) (Thunderbird) 和[Rainlendar](http://www.rainlendar.net/cms/index.php)中使用 iCal 。

我已经使用日历软件多年（几十年）并且从来没有需要在同一天重复事件。如果确实需要，在同一天添加额外的每日重复事件很简单。

# java - Java时区搞砸了

> ID：6392
> 
> 赞同：34
> 
> 时间：2008-08-08T21:24:01.490
> 
> 标签：java, linux, timezone

我正在运行一个 Tomcat 应用程序，我需要显示一些时间值。不幸的是，时间快到了一个小时。我调查了一下，发现我的默认 TimeZone 被设置为：

```
sun.util.calendar.ZoneInfo[id="GMT-08:00",
                           offset=-28800000,
                           dstSavings=0,
                           useDaylight=false,
                           transitions=0,
                           lastRule=null] 
```

而不是太平洋时区。当我尝试打印默认时区的[显示名称](http://docs.oracle.com/javase/7/docs/api/java/util/TimeZone.html#getDisplayName())时，这进一步表明，它出现“GMT-08:00”，这似乎表明它没有正确设置为美国太平洋时区。我在从 Gutsy Gibbon 升级的 Ubuntu Hardy Heron 上运行。

是否有我可以更新的配置文件来告诉 JRE 使用 Pacific 以及所有相关的夏令时信息？我机器上的时间显示正确，所以它似乎不是操作系统范围的错误配置。

* * *

好的，这里有更新。一位同事建议我在我的 /etc/profile 中更新 JAVA_OPTS 以包含“-Duser.timezone=US/Pacific”，这很有效（我还看到了我也更新了的 CATALINA_OPTS）。实际上，我只是将更改导出到变量中，而不是使用新的 /etc/profile （稍后重新启动将获取更改，我会很高兴）。

但是，我仍然认为有一个更好的解决方案......应该有一个 Java 配置，说明它正在使用哪个时区，或者它是如何获取时区的。如果有人知道这样的设置，那就太棒了，但现在这是一个不错的解决方法。

* * *

我使用的是 1.5，这绝对是 DST 问题。如您所见，时区设置为不使用夏令时。我的信念是它通常设置为 -8 偏移而不是特定的太平洋时区。由于通用 -8 偏移量没有夏令时信息，它当然不会使用它，但问题是，我在哪里告诉 Java 在启动时使用太平洋时区？我不是在寻找程序化解决方案，它应该是一个配置解决方案。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-08-09T00:46:46.260

这是 JVM 查找 zoneinfo 文件的方式的“怪癖”。请参阅[错误 ID 6456628](http://bugs.sun.com/bugdatabase/view_bug.do?bug_id=6456628)。

最简单的解决方法是使 /etc/localtime 成为指向正确 zoneinfo 文件的符号链接。对于太平洋时间，以下命令应该可以工作：

```
# sudo cp /etc/localtime /etc/localtime.dist
# sudo ln -fs /usr/share/zoneinfo/America/Los_Angeles /etc/localtime 
```

我对符号链接方法没有任何问题。

编辑：在命令中添加了“sudo”。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2010-10-12T08:15:01.203

在 Ubuntu 上，仅更改 /etc/localtime 文件是不够的。它似乎也在读取 /etc/timezone 文件。最好按照[说明](https://help.ubuntu.com/community/UbuntuTime)正确设置时区。特别是，请执行以下操作：

```
$ sudo cp /etc/timezone /etc/timezone.dist
$ echo "Australia/Adelaide" | sudo tee /etc/timezone
Australia/Adelaide
$ sudo dpkg-reconfigure --frontend noninteractive tzdata

Current default time zone: 'Australia/Adelaide'
Local time is now:      Sat May  8 21:19:24 CST 2010.
Universal Time is now:  Sat May  8 11:49:24 UTC 2010. 
```

在我的 Ubuntu 上，如果 /etc/localtime 和 /etc/timezone 不一致，Java 似乎从 /etc/timezone 读取默认时区。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-08T12:18:05.090

我有一个类似的问题，可能是同一个问题。但是，我的 tomcat 服务器在 windows 框上运行，因此符号链接解决方案将不起作用。

我设置`-Duser.timezone=Australia/Sydney`了`JAVA_OPTS`但是tomcat无法识别DST生效。作为一种解决方法，我将`Australia/Sydney`(GMT+10:00) 更改为`Pacific/Numea`(GMT+11:00) 以便正确显示时间，但是我很想知道实际的解决方案或错误（如果有）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-09T01:01:17.587

仔细检查您的操作系统正在使用的时区规则可能会有所帮助。

```
/usr/bin/zdump -v /etc/localtime | less 
```

这个文件应该包含你的夏令时规则，比如 2080 年的这个：

```
/etc/localtime  Sun Mar 31 01:00:00 2080 UTC = Sun Mar 31 02:00:00 2080 BST isdst=1 gmtoff=3600 
```

您可以将此与您认为应该使用的时区规则进行比较。它们可以在**/usr/share/zoneinfo/**中找到。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-02-27T20:36:19.483

添加一个对我有用的简短答案，您可以使用它`timedatectl`来设置时区。然后重启JVM。

```
sudo timedatectl set-timezone UTC 
```

# c# - 如何从内容页面访问母版页上的 .Net 元素？

> ID：6406
> 
> 赞同：15
> 
> 时间：2008-08-08T21:39:04.283
> 
> 标签：c#, .net

是否可以从为母版加载的页面访问母版页上的元素`ContentPlaceHolder`？

我有一个 ListView，它在母版页的导航区域中列出了人们的姓名。我想在将一个人添加到 ListView 数据绑定到的表中后更新 ListView。在`ListView`重新加载缓存之前，当前不会更新它的值。我们发现只要重新运行`ListView.DataBind()`就会更新列表视图的内容。我们无法在`ListView.DataBind()`使用母版页的页面上运行。

下面是我想做的一个示例，但是编译器错误说

> “当前上下文中不存在 PeopleListView”

GIS.master - ListView 所在的位置

```
...<asp:ListView ID="PeopleListView"... 
```

GISInput_People.aspx - 使用 GIS.master 作为它的母版页

GISInput_People.aspx.cs

```
AddNewPerson()
{
    // Add person to table
    ....

    // Update Person List
    PeopleListView.DataBind();
    ...
} 
```

在 C# .Net 中解决此类问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-08-08T21:46:22.053

我相信你*可以*通过使用 this.Master.FindControl 或类似的东西来做到这一点，但你可能不应该 - 它需要内容页面对母版页的结构了解太多。

我会建议另一种方法，例如在内容区域中触发一个事件，主人可以在触发时侦听并重新绑定。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-08T21:48:28.193

假设该控件在母版页上称为“PeopleListView”

```
ListView peopleListView = (ListView)this.Master.FindControl("PeopleListView");
peopleListView.DataSource = [whatever];
peopleListView.DataBind(); 
```

但是[@palmsey](https://stackoverflow.com/users/521/palmsey)更正确，特别是如果您的页面可能有多个母版页。将它们解耦并使用事件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-06-08T08:43:20.650

选项 1：您可以创建母版页控件的公共属性

```
public TextBox PropMasterTextBox1
{
    get { return txtMasterBox1; }
    set { txtMasterBox1 = value; }
} 
```

在内容页面上访问它，例如

```
Master.PropMasterTextBox1.Text="SomeString"; 
```

选项 2：在母版页上：

```
public string SetMasterTextBox1Text
{  
    get { return txtMasterBox1.Text; }
    set { txtMasterBox1.Text = value; }
} 
```

在内容页面上：

```
Master.SetMasterTextBox1Text="someText"; 
```

选项 3：您可以创建一些适合您的公共方法

* * *

这些方法不是那么有用，但如果您只想使用一些有限和预定义的控件，它会有所帮助

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-23T02:33:55.063

要记住的一个想法是以下 ASP.NET 指令。

```
<%@ MasterType attribute="value" [attribute="value"...] %> 
```

[MSDN 参考](http://msdn.microsoft.com/en-us/library/ms228274.aspx)

在引用 this.Master 时，它将通过创建对母版页的强类型引用来帮助您。然后，您可以引用您的 ListView 而无需 CAST。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-04-08T07:08:36.080

您可以使用代码 this.Master.FindControl(ControlID) 访问您想要的控件。它返回控件的引用，使更改生效。不可能在每种情况下都触发一个事件。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-08-08T21:44:53.863

假设您的母版页名为 MyMaster：

```
(Master as MyMaster).PeopleListView.DataBind(); 
```

**编辑：**由于 PeopleListView 将被默认声明为受保护，您需要将其更改为公共，或创建一个公共属性包装器，以便您可以从您的页面访问它。

# c# - C# 循环 - 中断与继续

> ID：6414
> 
> 赞同：836
> 
> 时间：2008-08-08T21:49:01.127
> 
> 标签：c#, loops, enumeration

在 C#（随意回答其他语言）循环中，`break`和`continue`作为离开循环结构并进入下一次迭代的手段有什么区别？

例子：

```
foreach (DataRow row in myTable.Rows)
{
    if (someConditionEvalsToTrue)
    {
        break; //what's the difference between this and continue ?
        //continue;
    }
} 
```

* * *

## 回答 #1

> 赞同：1564
> 
> 时间：2008-08-08T21:51:35.397

`break`将完全退出循环，`continue`将**跳过**当前迭代。

例如：

```
for (int i = 0; i < 10; i++) {
    if (i == 0) {
        break;
    }

    DoSomeThingWith(i);
} 
```

中断将导致循环在第一次迭代时退出 -`DoSomeThingWith`永远不会被执行。这里：

```
for (int i = 0; i < 10; i++) {
    if(i == 0) {
        continue;
    }

    DoSomeThingWith(i);
} 
```

不会执行`DoSomeThingWith`for ，`i = 0`但循环会**继续**`DoSomeThingWith`执行 for `i = 1`to `i = 9`。

* * *

## 回答 #2

> 赞同：391
> 
> 时间：2008-08-08T22:33:31.020

理解这一点的一个非常简单的方法是在每个关键字之后放置“循环”一词。如果这些术语只是像日常用语一样阅读，那么它们现在是有意义的。

**`break`**loop - 循环中断并停止。

**`continue`**loop - 循环继续执行下一次迭代。

* * *

## 回答 #3

> 赞同：106
> 
> 时间：2008-08-19T20:21:17.633

**break**导致程序计数器跳出最内层循环的范围

```
for(i = 0; i < 10; i++)
{
    if(i == 2)
        break;
} 
```

像这样工作

```
for(i = 0; i < 10; i++)
{
    if(i == 2)
        goto BREAK;
}
BREAK:; 
```

**continue**跳转到循环的末尾。在 for 循环中， continue 跳转到增量表达式。

```
for(i = 0; i < 10; i++)
{
    if(i == 2)
        continue;

    printf("%d", i);
} 
```

像这样工作

```
for(i = 0; i < 10; i++)
{
    if(i == 2)
        goto CONTINUE;

    printf("%d", i);

    CONTINUE:;
} 
```

* * *

## 回答 #4

> 赞同：50
> 
> 时间：2017-12-05T23:07:37.827

## 何时使用中断与继续？

1.  **Break** - 就像分手一样。很遗憾，你们要分开了。循环退出。

[![休息](https://i.stack.imgur.com/s97tT.png)](https://i.stack.imgur.com/s97tT.png)

2.  **继续**- 意味着你今天要休息一下，明天把它全部整理出来（即跳过当前的迭代）！

[![继续](https://i.stack.imgur.com/MilvY.jpg)](https://i.stack.imgur.com/MilvY.jpg)

（老生常谈的故事¯_(ツ)_/¯ 但帮助我记住 - 希望你也是！）

* * *

## 回答 #5

> 赞同：30
> 
> 时间：2008-08-08T21:50:09.347

`break`会完全停止`foreach`循环，`continue`会跳到下一个`DataRow`。

* * *

## 回答 #6

> 赞同：20
> 
> 时间：2008-08-08T22:35:46.757

不喜欢`break`和的人不止几个`continue`。我看到的关于它们的最新投诉是 Douglas Crockford 的*JavaScript: The Good Parts*。但是我发现有时使用其中一个确实可以简化事情，尤其是如果您的语言不包含`do-while`or`do-until`样式的循环。

我倾向于`break`在搜索列表的循环中使用。一旦找到，就没有继续的意义，所以你还不如退出。

我`continue`在对列表的大多数元素做某事时使用，但仍想跳过一些。

当轮询某人或某事的有效响应时，该`break`语句也派上用场。代替：

```
Ask a question
While the answer is invalid:
    Ask the question 
```

您可以消除一些重复并使用：

```
While True:
    Ask a question
    If the answer is valid:
        break 
```

`do-until`我之前提到的循环是针对该特定问题的更优雅的解决方案：

```
Do:
    Ask a question
    Until the answer is valid 
```

没有重复，也不`break`需要。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2010-12-21T07:27:03.600

都给出了很好的解释。我仍然发布我的答案只是为了举例说明是否有帮助。

```
// break statement
for (int i = 0; i < 5; i++) {
    if (i == 3) {
        break; // It will force to come out from the loop
    }

    lblDisplay.Text = lblDisplay.Text + i + "[Printed] ";
} 
```

这是输出：

> 0[印刷] 1[印刷] 2[印刷]

所以 3[Printed] & 4[Printed] 不会显示，因为 i == 3 时有中断

```
//continue statement
for (int i = 0; i < 5; i++) {
    if (i == 3) {
        continue; // It will take the control to start point of loop
    }

    lblDisplay.Text = lblDisplay.Text + i + "[Printed] ";
} 
```

这是输出：

> 0[印刷] 1[印刷] 2[印刷] 4[印刷]

所以 3[Printed] 不会显示，因为 i == 3 时有 continue

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-03-28T06:58:57.063

**休息**

Break 强制循环立即退出。

**继续**

这与break相反。它没有终止循环，而是立即再次循环，跳过其余代码。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-10-22T09:11:16.850

简单的回答：

**Break**立即退出循环。
**继续**开始处理下一个项目。（如果有的话，通过跳转到 for/while 的评估行）

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2013-10-10T15:34:49.427

举例

```
foreach(var i in Enumerable.Range(1,3))
{
    Console.WriteLine(i);
} 
```

打印 1、2、3（在单独的行上）。

在 i = 2 处添加中断条件

```
foreach(var i in Enumerable.Range(1,3))
{
    if (i == 2)
        break;

    Console.WriteLine(i);
} 
```

现在循环打印 1 并停止。

用继续代替中断。

```
foreach(var i in Enumerable.Range(1,3))
{
    if (i == 2)
        continue;

    Console.WriteLine(i);
} 
```

现在循环打印 1 和 3（跳过 2）。

因此，`break`停止循环，而`continue`跳到下一次迭代。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2008-08-09T02:31:13.537

不幸的是，Ruby 有点不同。PS：我的记忆有点模糊，如果我错了，请见谅

它没有break/continue，而是break/next，在循环方面表现相同

循环（和其他所有东西一样）是表达式，并且“返回”它们所做的最后一件事。大多数时候，从循环中获取返回值是没有意义的，所以每个人都这样做

```
a = 5
while a < 10
    a + 1
end 
```

但是，您可以这样做

```
a = 5
b = while a < 10
    a + 1
end # b is now 10 
```

但是，许多 ruby​​ 代码通过使用块来“模拟”循环。典型的例子是

```
10.times do |x|
    puts x
end 
```

由于人们想要用块的结果做事更为常见，这就是它变得混乱的地方。break/next 在块的上下文中意味着不同的东西。

break 会跳出调用块的代码

next 将跳过块中的其余代码，并将您指定的内容“返回”给块的调用者。没有例子，这没有任何意义。

```
def timesten
    10.times{ |t| puts yield t }
end

timesten do |x|
   x * 2
end
# will print
2
4
6
8 ... and so on

timesten do |x|
    break
    x * 2
end
# won't print anything. The break jumps out of the timesten function entirely, and the call to `puts` inside it gets skipped

timesten do |x|
    break 5
    x * 2
end
# This is the same as above. it's "returning" 5, but nobody is catching it. If you did a = timesten... then a would get assigned to 5

timesten do |x|
    next 5
    x * 2
end 
# this would print
5
5
5 ... and so on, because 'next 5' skips the 'x * 2' and 'returns' 5. 
```

是的。Ruby 很棒，但它有一些可怕的极端情况。这是我多年来使用它时见过的第二个最差的 :-)

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-03-23T18:23:02.750

请让我说清楚：请注意，既不添加中断也不添加继续，将恢复您的程序；即我陷入了某个错误，然后在记录它之后，我想恢复处理，并且下一行之间还有更多的代码任务，所以我让它失败了。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2013-03-09T12:50:42.173

要完全跳出 foreach 循环，使用**break**；

要进入循环中的下一个迭代，使用**continue**；

**如果您正在循环遍历对象集合（如数据表中的行）并且您正在搜索特定匹配项，则Break**很有用，当您找到该匹配项时，无需继续遍历剩余的行，因此您想要中断出去。

**当您在循环迭代中完成了您需要做的事情时，继续**很有用。你通常会在**if**之后**继续**。

 *** * *

## 回答 #14

> 赞同：2
> 
> 时间：2016-02-03T06:18:55.190

如果您不想使用**break**，您只需增加 I 的值，使其迭代条件为假，并且循环不会在下一次迭代中执行。

```
for(int i = 0; i < list.Count; i++){
   if(i == 5)
    i = list.Count;  //it will make "i<list.Count" false and loop will exit
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-02-20T14:25:35.670

至于其他语言：

```
'VB
For i=0 To 10
   If i=5 then Exit For '= break in C#;
   'Do Something for i<5
next

For i=0 To 10
   If i=5 then Continue For '= continue in C#
   'Do Something for i<>5...
Next 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-09-11T21:37:44.897

由于此处编写的示例对于理解概念非常简单，我认为查看正在使用的**continue 语句的更****实用版本**也是一个好主意。例如：

 **如果号码已经输入，我们要求用户输入 5 个唯一号码，我们给他们一个错误，然后继续我们的程序。

```
static void Main(string[] args)
        {
            var numbers = new List<int>();

            while (numbers.Count < 5)
            { 

                Console.WriteLine("Enter 5 uniqe numbers:");
                var number = Convert.ToInt32(Console.ReadLine());

                if (numbers.Contains(number))
                {
                    Console.WriteLine("You have already entered" + number);
                    continue;
                }

                numbers.Add(number);
            }

            numbers.Sort();

            foreach(var number in numbers)
            {
                Console.WriteLine(number);
            }

        } 
```

假设用户输入是 1,2,2,2,3,4,5。打印的结果是：

```
1,2,3,4,5 
```

为什么？因为每次用户输入一个已经在列表中的数字时，我们的程序都会忽略它并且不会将列表中已经存在的内容添加到其中。现在，如果我们尝试相同的代码但**没有 continue 语句**，假设用户的输入相同，即 1、2、2、2、3、4、5。输出将是：

```
1,2,2,2,3,4 
```

为什么？因为没有 continue 语句让我们的程序知道它应该忽略已经输入的数字。

现在对于**Break 语句**，我再次认为它是最好的例子。例如：

在这里，我们希望我们的程序不断要求用户输入一个数字。我们希望在用户输入“ok”时终止循环，并在最后计算所有先前输入的数字的总和并将其显示在控制台上。

这就是在本例中使用**break 语句**的方式：

```
{
            var sum = 0;
            while (true)
            {
                Console.Write("Enter a number (or 'ok' to exit): ");
                var input = Console.ReadLine();

                if (input.ToLower() == "ok")
                    break;

                sum += Convert.ToInt32(input);
            }
            Console.WriteLine("Sum of all numbers is: " + sum);
        } 
```

程序会要求用户输入一个数字，直到用户输入“OK”，然后才会显示结果。为什么？因为 break 语句在达到所需条件时完成或停止正在进行的过程。

如果那里没有 break 语句，程序将继续运行，并且当用户键入“ok”时不会发生任何事情。

我建议复制此代码并尝试删除或添加这些语句并自己查看更改。

# winforms - 如何以编程方式迭代数据网格行？

> ID：6430
> 
> 赞同：4
> 
> 时间：2008-08-08T22:08:29.980
> 
> 标签：winforms

经过多年的 Web 开发，我突然回到了 WinForms，并且在一些应该很简单的事情上遇到了麻烦。我有一个`ArrayList`绑定到 Windows Forms 的业务对象`DataGrid`。我希望用户能够编辑单元格，完成后，按保存按钮。那时我想迭代 中的所有行和列 `DataGrid`以查找任何更改，并将它们保存到数据库中。但我找不到访问`DataGrid`行的方法。

我还想实时验证单个单元格，因为它们已被编辑，但我很确定可以做到。（也许不是用 an `ArrayList`as the `DataSource`？）但至于迭代`DataGrid`，我很惊讶它似乎不可能。

为了使用数据网格，我真的必须将我的业务对象数据填充到数据表中吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-08T22:20:28.973

```
foreach(var row in DataGrid1.Rows)
{
  DoStuff(row);
}
//Or ---------------------------------------------   
foreach(DataGridRow row in DataGrid1.Rows)
{
  DoStuff(row);
}
//Or ---------------------------------------------
for(int i = 0; i< DataGrid1.Rows.Count - 1; i++)
{
  DoStuff(DataGrid1.Rows[i]);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-11T02:59:12.670

```
object cell = myDataGrid[row, col]; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-09T02:17:38.293

> WinForms 3.0 有什么比 1.1 好很多的吗？

我不了解 3.0，但您可以在 .NET 2.0 框架上运行的 VS 2008 中编写代码。（因此，您可以使用最新的 C# 语言，但只能使用 2.0 库）

这让你得到了泛型（`List<DataRow>`而不是那些 GodAwful ArrayLists）和大量其他东西，你最终会少写 3 倍的代码。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-08-12T02:37:15.893

啊哈，我真的只是再次测试每个人！:) 真正的答案是，您很少需要迭代数据网格。因为即使绑定到 ArrayList，绑定也是 2 路。尽管如此，知道如何直接迭代网格还是很方便的，它可以不时节省几行代码。

但 NotMyself 和 Orion 给出了更好的答案：说服利益相关者升级到更高版本的 C#，以节省开发成本并提高可维护性和可扩展性。

# .net - .NET 3.5 可再发行组件——200 MB？其他选择？

> ID：6440
> 
> 赞同：19
> 
> 时间：2008-08-08T22:32:01.243
> 
> 标签：.net, redistributable

最近，我在工作中使用了很多新的 .NET 3.5 功能。我正在构建的应用程序旨在分发给可能不会在他们的机器上安装 .NET 框架的最新版本（或*任何版本）的消费者。*

我去[下载 .NET 3.5 可再发行包](http://www.microsoft.com/downloads/details.aspx?FamilyId=333325FD-AE52-4E35-B531-508D977D32A6&displaylang=en)，却发现它差不多有***200 MB！***这对我的应用程序来说是不可接受的，因为它应该是一个快速且无痛的消费者应用程序，可以快速安装并在用户的机器上保持低调。对于已经安装了 .NET 3.5 的用户，到目前为止，我们的二进制下载是即时​​的。这个 200 MB 的大猩猩将使下载的大小增加四倍多。除了这个可再分发的包之外，还有什么其他的选择可以用来确保框架在机器上，不会让用户脱离我们的“快速和轻松”的工作流程吗？我们从开始下载到完成安装的目标时间不到两分钟。对于尚未安装 .NET 的人来说，这是不可能的吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-08-08T22:35:06.417

这是我仍然尽可能瞄准 .net 2.0 的可悲原因之一：/

但人们不一定需要完整的 200 MB 包。有一个 3 MB 的引导程序，它只会下载所需的组件：

[.net 3.5 SP1 引导程序](http://www.microsoft.com/downloads/details.aspx?FamilyID=ab99342f-5d1a-413d-8319-81da479ab0d7&DisplayLang=en)

但是，最坏的情况仍然是下载量很大。此外，请参阅[本文](http://blogs.msdn.com/astebner/archive/2008/01/10/7067719.aspx)以获取有关尺寸的更详细说明以及尺寸问题的替代解决方法。

补充：自从回答了这个问题后，Scott Hanselman 创建了[SmallestDotNet.com](http://www.smallestdotnet.com)，它将确定所需的最小下载量。不会改变最坏的情况，但知道仍然有用。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-08-08T23:00:49.343

一旦 .NET Framework 3.5 SP1 出现（应该很快），就会有第二个框架选项，即“客户端配置文件”，它是一个精简的框架，仅占用大约 30Mb 的内存。它不包括完整框架的所有命名空间和类，但理论上对于大多数常见应用程序来说应该足够了。如有必要，它可以升级到完整的框架（例如，如果您的软件更新引入了新的依赖项）

更多信息，请参见此处：[BCL 团队博客](http://blogs.msdn.com/bclteam/archive/2008/05/21/net-framework-client-profile-justin-van-patten.aspx)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-08-08T22:58:45.760

您是否查看过 .NET Framework 客户端配置文件？它比完整的可再发行包要小得多，并且经过优化，仅提供智能客户端所需的功能。

[这是一个很好的概述。](http://blogs.windowsclient.net/trickster92/archive/2008/05/21/introducing-the-net-framework-client-profile.aspx)

我不知道这是否会使下载保持在两分钟内，但它应该让你更接近一点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-07T16:55:31.393

.NET 4 中的客户端配置文件变得更好（并且更小），请参阅

*   [迈向更小的 .NET 4 - 有关客户端配置文件和下载 .NET 的详细信息](http://www.hanselman.com/blog/TowardsASmallerNET4DetailsOnTheClientProfileAndDownloadingNET.aspx)
*   [.NET Framework 4 客户端配置文件 RTM 中的新增功能](http://blogs.msdn.com/b/jgoldb/archive/2010/04/12/what-s-new-in-net-framework-4-client-profile-rtm.aspx)
*   [.NET 框架客户端配置文件 (MSDN)](http://msdn.microsoft.com/en-us/library/cc656912.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-08T22:59:48.473

此外，还值得包括（以某种方式）Service Pack 下载。事实上，根据您的可执行文件的构建方式，您可能会被迫安装框架和服务包。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-09T13:03:16.100

作为记录，Microsoft SQL Server 2008 需要 .Net Framework 3.5 SP1 才能在本周发布的同时安装和 RTM。仍然需要大量安装，但您可以从中提取客户端配置文件。只是不确定如何。

# javascript - 如何启用禁用的单选按钮？

> ID：6441
> 
> 赞同：19
> 
> 时间：2008-08-08T22:33:19.960
> 
> 标签：javascript, html, radio-button

以下代码在 IE 中效果很好，但在 FF 或 Safari 中效果不佳。我不能为我的生活找出原因。如果您选择“禁用 2 个单选按钮”选项，该代码*应该禁用单选按钮。*如果您选择“启用两个单选按钮”选项，它应该启用单选按钮。这两个工作...

但是，如果您不使用鼠标在 2 个选项（“启用...”和“禁用...”）之间移动，那么单选按钮似乎不会被正确禁用或启用，直到您单击其他任何位置在页面上（而不是单选按钮本身）。

如果有人有时间/好奇/觉得有帮助，请将下面的代码粘贴到 html 页面并在浏览器中加载。它在 IE 中运行良好，但问题在 FF（在我的情况下为 3）和 Safari 中表现出来，所有这些都在 Windows XP 上。

```
function SetLocationOptions() {
  var frmTemp = document.frm;
  var selTemp = frmTemp.user;
  if (selTemp.selectedIndex >= 0) {
    var myOpt = selTemp.options[selTemp.selectedIndex];
    if (myOpt.attributes[0].nodeValue == '1') {
      frmTemp.transfer_to[0].disabled = true;
      frmTemp.transfer_to[1].disabled = true;
      frmTemp.transfer_to[2].checked = true;
    } else {
      frmTemp.transfer_to[0].disabled = false;
      frmTemp.transfer_to[1].disabled = false;
    }
  }
}
```

```
<form name="frm" action="coopfunds_transfer_request.asp" method="post">
  <select name="user" onchange="javascript: SetLocationOptions()">
    <option value="" />Choose One
    <option value="58" user_is_tsm="0" />Enable both radio buttons
    <option value="157" user_is_tsm="1" />Disable 2 radio buttons
  </select>
  <br /><br />
  <input type="radio" name="transfer_to" value="fund_amount1" />Premium&nbsp;&nbsp;&nbsp;
  <input type="radio" name="transfer_to" value="fund_amount2" />Other&nbsp;&nbsp;&nbsp;
  <input type="radio" name="transfer_to" value="both" CHECKED />Both
  <br /><br />
  <input type="button" class="buttonStyle" value="Submit Request" />
</form>
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-09T18:15:12.900

要让 FF 在使用键盘时模仿 IE 的行为，可以在选择框上使用 keyup 事件。在您的示例中（我不喜欢以这种方式附加事件处理程序，但这是另一个主题），它会是这样的：

```
<select name="user" id="selUser" onchange="javascript:SetLocationOptions()" onkeyup="javascript:SetLocationOptions()"> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-08T23:01:17.050

嗯，IE 有一个有点不标准的对象模型。你正在做的事情不应该工作，但你正在逃脱它，因为 IE 对你很好。在 Firefox 和 Safari 中，代码中的 document.frm 计算结果为未定义。

您需要在表单元素上使用 id 值并用于`document.getElementById('whatever')`返回对它们的引用，而不是引用文档对象不存在的属性。

所以这会更好一些，并且可以做你所追求的：

```
Line 27: <form name="frm" id="f" ...

Line 6: var frmTemp = document.getElementById('f'); 
```

但是，如果您想了解更多关于正确的处理方式的信息，您可能想查看这本优秀的书：Jeremy Keith 的[DOM Scripting](http://domscripting.com/book/)

此外，当我们讨论这个主题时，同一作者的[Bulletproof Ajax](http://bulletproofajax.com/)也值得在您的书架上占有一席之地，正如Doug Crockford的[JavaScript：The Good Parts一样](http://www.amazon.co.uk/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-08T23:21:24.777

为什么不抓住其中一个 AJAX 脚本库，它们抽象出许多跨浏览器 DOM 脚本黑魔法，让生活变得轻松多了。

# unix - Unix shell 脚本中的日期运算

> ID：6467
> 
> 赞同：19
> 
> 时间：2008-08-08T23:24:02.933
> 
> 标签：unix, shell, date, math, scripting

我需要在用于控制第三方程序执行的 Unix shell 脚本中进行日期运算。

我正在使用一个函数来增加一天和另一个减少：

```
IncrementaDia(){
echo $1 | awk '
BEGIN {
        diasDelMes[1] = 31
        diasDelMes[2] = 28
        diasDelMes[3] = 31
        diasDelMes[4] = 30
        diasDelMes[5] = 31
        diasDelMes[6] = 30
        diasDelMes[7] = 31
        diasDelMes[8] = 31
        diasDelMes[9] = 30
        diasDelMes[10] = 31
        diasDelMes[11] = 30
        diasDelMes[12] = 31
}
{
        anio=substr($1,1,4)
        mes=substr($1,5,2)
        dia=substr($1,7,2)

        if((anio % 4 == 0 && anio % 100 != 0) || anio % 400 == 0)
        {
                diasDelMes[2] = 29;
        }

        if( dia == diasDelMes[int(mes)] ) {
                if( int(mes) == 12 ) {
                        anio = anio + 1
                        mes = 1
                        dia = 1
                } else {
                        mes = mes + 1
                        dia = 1
                }
        } else {
                dia = dia + 1
        }
}
END {
        printf("%04d%02d%02d", anio, mes, dia)
}
'
}

if [ $# -eq 1 ]; then
        tomorrow=$1
else
        today=$(date +"%Y%m%d")
        tomorrow=$(IncrementaDia $hoy)
fi 
```

但现在我需要做更复杂的算术。

这样做的最佳和更兼容的方式是什么？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-08-08T23:26:55.827

假设您有[GNU date](http://www.gnu.org/software/coreutils/manual/coreutils.html#date-invocation)，如下所示：

```
date --date='1 days ago' '+%a' 
```

和[类似的短语](http://www.gnu.org/software/coreutils/manual/coreutils.html#Date-input-formats)。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2011-11-23T15:22:31.783

这是在 shell 脚本中进行日期计算的简单方法。

```
meetingDate='12/31/2011' # MM/DD/YYYY Format
reminderDate=`date --date=$meetingDate'-1 day' +'%m/%d/%Y'`
echo $reminderDate 
```

以下是可以使用`date`实用程序实现的日期计算的更多变体。 [http://www.cyberciti.biz/tips/linux-unix-get-yesterdays-tomorrows-date.html](http://www.cyberciti.biz/tips/linux-unix-get-yesterdays-tomorrows-date.html) [http://www.cyberciti.biz/faq/linux-unix-formatting-dates-for-display/](http://www.cyberciti.biz/faq/linux-unix-formatting-dates-for-display/)

这在 RHEL 上对我有用。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2010-06-26T19:04:41.087

我编写了一个 bash 脚本，用于将用英语表示的日期转换为传统的 mm/dd/yyyy 日期。它被称为**ComputeDate**。

以下是它的一些使用示例。为简洁起见，我将每个调用的输出与调用放在同一行，用冒号 (:) 分隔。运行**ComputeDate时***不需要*下面显示的引号：

 **```
$ ComputeDate 'yesterday': 03/19/2010
$ ComputeDate 'yes': 03/19/2010
$ ComputeDate 'today': 03/20/2010
$ ComputeDate 'tod': 03/20/2010
$ ComputeDate 'now': 03/20/2010
$ ComputeDate 'tomorrow': 03/21/2010
$ ComputeDate 'tom': 03/21/2010
$ ComputeDate '10/29/32': 10/29/2032
$ ComputeDate 'October 29': 10/1/2029
$ ComputeDate 'October 29, 2010': 10/29/2010
$ ComputeDate 'this monday': 'this monday' has passed.  Did you mean 'next monday?'
$ ComputeDate 'a week after today': 03/27/2010
$ ComputeDate 'this satu': 03/20/2010
$ ComputeDate 'next monday': 03/22/2010
$ ComputeDate 'next thur': 03/25/2010
$ ComputeDate 'mon in 2 weeks': 03/28/2010
$ ComputeDate 'the last day of the month': 03/31/2010
$ ComputeDate 'the last day of feb': 2/28/2010
$ ComputeDate 'the last day of feb 2000': 2/29/2000
$ ComputeDate '1 week from yesterday': 03/26/2010
$ ComputeDate '1 week from today': 03/27/2010
$ ComputeDate '1 week from tomorrow': 03/28/2010
$ ComputeDate '2 weeks from yesterday': 4/2/2010
$ ComputeDate '2 weeks from today': 4/3/2010
$ ComputeDate '2 weeks from tomorrow': 4/4/2010
$ ComputeDate '1 week after the last day of march': 4/7/2010
$ ComputeDate '1 week after next Thursday': 4/1/2010
$ ComputeDate '2 weeks after the last day of march': 4/14/2010
$ ComputeDate '2 weeks after 1 day after the last day of march': 4/15/2010
$ ComputeDate '1 day after the last day of march': 4/1/2010
$ ComputeDate '1 day after 1 day after 1 day after 1 day after today': 03/24/2010 
```

我已经将这个脚本作为这个问题的答案，因为它说明了如何通过一组 bash 函数进行日期运算，并且这些函数可能对其他人有用。它正确处理闰年和闰世纪：

```
#! /bin/bash
#  ConvertDate -- convert a human-readable date to a MM/DD/YY date
#
#  Date ::= Month/Day/Year
#        |  Month/Day
#        |  DayOfWeek
#        |  [this|next] DayOfWeek
#        |  DayofWeek [of|in] [Number|next] weeks[s]
#        |  Number [day|week][s] from Date
#        |  the last day of the month
#        |  the last day of Month
#
#  Month ::= January | February | March | April | May | ...  | December
#  January  ::= jan | january | 1
#  February  ::= feb | january | 2
#  ...
#  December ::=  dec | december | 12
#  Day   ::= 1 | 2 | ... | 31
#  DayOfWeek ::= today | Sunday | Monday | Tuesday | ...  | Saturday
#  Sunday    ::= sun*
#  ...
#  Saturday  ::= sat*
#
#  Number ::= Day | a
#
#  Author: Larry Morell

if [ $# = 0 ]; then
   printdirections $0
   exit
fi

# Request the value of a variable
GetVar () {
   Var=$1
   echo -n "$Var= [${!Var}]: "
   local X
   read X
   if [ ! -z $X ]; then
      eval $Var="$X"
   fi
}

IsLeapYear () {
   local Year=$1
   if [ $[20$Year % 4]  -eq  0 ]; then
      echo yes
   else
      echo no
   fi
}

# AddToDate -- compute another date within the same year

DayNames=(mon tue wed thu fri sat sun )  # To correspond with 'date' output

Day2Int () {
   ErrorFlag=
   case $1 in
      -e )
         ErrorFlag=-e; shift
         ;;
   esac
   local dow=$1
   n=0
   while  [ $n -lt 7 -a $dow != "${DayNames[n]}" ]; do
      let n++
   done
   if [ -z "$ErrorFlag" -a $n -eq 7 ]; then
      echo Cannot convert $dow to a numeric day of wee
      exit
   fi
   echo $[n+1]

}

Months=(31 28 31 30 31 30 31 31 30 31 30 31)
MonthNames=(jan feb mar apr may jun jul aug sep oct nov dec)
# Returns the month (1-12) from a date, or a month name
Month2Int () {
   ErrorFlag=
   case $1 in
      -e )
         ErrorFlag=-e; shift
         ;;
   esac
   M=$1
   Month=${M%%/*}  # Remove /...
   case $Month in
      [a-z]* )
         Month=${Month:0:3}
         M=0
         while [ $M -lt 12 -a ${MonthNames[M]} != $Month ]; do
            let M++
         done
         let M++
   esac
   if [  -z "$ErrorFlag" -a $M -gt 12 ]; then
      echo "'$Month' Is not a valid month."
      exit
   fi
   echo $M
}

# Retrieve month,day,year from a legal date
GetMonth() {
   echo ${1%%/*}
}

GetDay() {
   echo $1 | col / 2
}

GetYear() {
   echo ${1##*/}
}

AddToDate() {

   local Date=$1
   local days=$2
   local Month=`GetMonth $Date`
   local Day=`echo $Date | col / 2`   # Day of Date
   local Year=`echo $Date | col / 3`  # Year of Date
   local LeapYear=`IsLeapYear $Year`

   if [ $LeapYear = "yes" ]; then
      let Months[1]++
   fi
   Day=$[Day+days]
   while [ $Day -gt ${Months[$Month-1]} ]; do
       Day=$[Day -  ${Months[$Month-1]}]
       let Month++
   done
   echo "$Month/$Day/$Year"
}

# Convert a date to normal form
NormalizeDate () {
   Date=`echo "$*" | sed 'sX  *X/Xg'`
   local Day=`date +%d`
   local Month=`date +%m`
   local Year=`date +%Y`
   #echo Normalizing Date=$Date > /dev/tty
   case $Date in
      */*/* )
         Month=`echo $Date | col / 1 `
         Month=`Month2Int $Month`
         Day=`echo $Date | col / 2`
         Year=`echo $Date | col / 3`
         ;;
      */* )
         Month=`echo $Date | col / 1 `
         Month=`Month2Int $Month`
         Day=1
         Year=`echo $Date | col / 2 `
         ;;
      [a-z]* ) # Better be a month or day of week
         Exp=${Date:0:3}
         case $Exp in
            jan|feb|mar|apr|may|june|jul|aug|sep|oct|nov|dec )
               Month=$Exp
               Month=`Month2Int $Month`
               Day=1
               #Year stays the same
               ;;
            mon|tue|wed|thu|fri|sat|sun )
               # Compute the next such day
               local DayOfWeek=`date +%u`
               D=`Day2Int $Exp`
               if [ $DayOfWeek -le $D ]; then
                  Date=`AddToDate $Month/$Day/$Year $[D-DayOfWeek]`
               else
                  Date=`AddToDate $Month/$Day/$Year $[7+D-DayOfWeek]`
               fi

               # Reset Month/Day/Year
               Month=`echo $Date | col / 1 `
               Day=`echo $Date | col / 2`
               Year=`echo $Date | col / 3`
               ;;
            * ) echo "$Exp is not a valid month or day"
                exit
               ;;
            esac
         ;;
      * ) echo "$Date is not a valid date"
          exit
         ;;
   esac
   case $Day in
      [0-9]* );;  # Day must be numeric
      * ) echo "$Date is not a valid date"
          exit
         ;;
   esac
      [0-9][0-9][0-9][0-9] );;  # Year must be 4 digits
      [0-9][0-9] )
          Year=20$Year
      ;;
   esac
   Date=$Month/$Day/$Year
   echo $Date
}
# NormalizeDate jan
# NormalizeDate january
# NormalizeDate jan 2009
# NormalizeDate jan 22 1983
# NormalizeDate 1/22
# NormalizeDate 1 22
# NormalizeDate sat
# NormalizeDate sun
# NormalizeDate mon

ComputeExtension () {

   local Date=$1; shift
   local Month=`GetMonth $Date`
   local Day=`echo $Date | col / 2`
   local Year=`echo $Date | col / 3`
   local ExtensionExp="$*"
   case $ExtensionExp in
      *w*d* )  # like 5 weeks 3 days or even 5w2d
            ExtensionExp=`echo $ExtensionExp | sed 's/[a-z]/ /g'`
            weeks=`echo $ExtensionExp | col  1`
            days=`echo $ExtensionExp | col 2`
            days=$[7*weeks+days]
            Due=`AddToDate $Month/$Day/$Year $days`
      ;;
      *d )    # Like 5 days or 5d
            ExtensionExp=`echo $ExtensionExp | sed 's/[a-z]/ /g'`
            days=$ExtensionExp
            Due=`AddToDate $Month/$Day/$Year $days`
      ;;
      * )
            Due=$ExtensionExp
      ;;
   esac
   echo $Due

}

# Pop -- remove the first element from an array and shift left
Pop () {
   Var=$1
   eval "unset $Var[0]"
   eval "$Var=(\${$Var[*]})"
}

ComputeDate () {
   local Date=`NormalizeDate $1`; shift
   local Expression=`echo $* | sed 's/^ *a /1 /;s/,/ /' | tr A-Z a-z `
   local Exp=(`echo $Expression `)
   local Token=$Exp  # first one
   local Ans=
   #echo "Computing date for ${Exp[*]}" > /dev/tty
   case $Token in
      */* ) # Regular date
         M=`GetMonth $Token`
         D=`GetDay $Token`
         Y=`GetYear $Token`
         if [ -z "$Y" ]; then
            Y=$Year
         elif [ ${#Y} -eq 2 ]; then
            Y=20$Y
         fi
         Ans="$M/$D/$Y"
         ;;
      yes* )
         Ans=`AddToDate $Date -1`
         ;;
      tod*|now )
         Ans=$Date
         ;;
      tom* )
         Ans=`AddToDate $Date 1`
         ;;
      the )
         case $Expression in
            *day*after* )  #the day after Date
               Pop Exp;   # Skip the
               Pop Exp;   # Skip day
               Pop Exp;   # Skip after
               #echo Calling ComputeDate $Date ${Exp[*]} > /dev/tty
               Date=`ComputeDate $Date ${Exp[*]}` #Recursive call
               #echo "New date is " $Date > /dev/tty
               Ans=`AddToDate $Date 1`
               ;;
            *last*day*of*th*month|*end*of*th*month )
               M=`date +%m`
               Day=${Months[M-1]}
               if [ $M -eq 2 -a `IsLeapYear $Year` = yes ]; then
                  let Day++
               fi
               Ans=$Month/$Day/$Year
               ;;
            *last*day*of* )
               D=${Expression##*of }
               D=`NormalizeDate $D`
               M=`GetMonth $D`
               Y=`GetYear $D`
               # echo M is $M > /dev/tty
               Day=${Months[M-1]}
               if [ $M -eq 2 -a `IsLeapYear $Y` = yes ]; then
                  let Day++
               fi
               Ans=$[M]/$Day/$Y
               ;;
            * )
               echo "Unknown expression: " $Expression
               exit
               ;;
         esac
         ;;
      next* ) # next DayOfWeek
         Pop Exp
         dow=`Day2Int $DayOfWeek` # First 3 chars
         tdow=`Day2Int ${Exp:0:3}` # First 3 chars
         n=$[7-dow+tdow]
         Ans=`AddToDate $Date $n`
         ;;
      this* )
         Pop Exp
         dow=`Day2Int $DayOfWeek`
         tdow=`Day2Int ${Exp:0:3}` # First 3 chars
         if [ $dow -gt $tdow ]; then
            echo "'this $Exp' has passed.  Did you mean 'next $Exp?'"
            exit
         fi
         n=$[tdow-dow]
         Ans=`AddToDate $Date $n`
         ;;
      [a-z]* ) # DayOfWeek ...

         M=${Exp:0:3}
         case $M in
            jan|feb|mar|apr|may|june|jul|aug|sep|oct|nov|dec )
               ND=`NormalizeDate ${Exp[*]}`
               Ans=$ND
               ;;
            mon|tue|wed|thu|fri|sat|sun )
               dow=`Day2Int $DayOfWeek`
               Ans=`NormalizeDate $Exp`

               if [ ${#Exp[*]} -gt 1 ]; then # Just a DayOfWeek
                  #tdow=`GetDay $Exp` # First 3 chars
                  #if [ $dow -gt $tdow ]; then
                     #echo "'this $Exp' has passed.  Did you mean 'next $Exp'?"
                     #exit
                  #fi
                  #n=$[tdow-dow]
               #else  # DayOfWeek in a future week
                  Pop Exp  # toss monday
                  Pop Exp  # toss in/off
                  if [ $Exp = next ]; then
                     Exp=2
                  fi
                  n=$[7*(Exp-1)]   # number of weeks
                  n=$[n+7-dow+tdow]
                  Ans=`AddToDate $Date $n`
               fi
               ;;
         esac
         ;;
      [0-9]* ) # Number  weeks [from|after] Date
         n=$Exp
         Pop Exp;
         case $Exp in
            w* ) let n=7*n;;
         esac

         Pop Exp; Pop Exp
         #echo Calling ComputeDate $Date ${Exp[*]} > /dev/tty
         Date=`ComputeDate $Date ${Exp[*]}` #Recursive call
         #echo "New date is " $Date > /dev/tty
         Ans=`AddToDate $Date $n`
         ;;
   esac
   echo $Ans
}

Year=`date +%Y`
Month=`date +%m`
Day=`date +%d`
DayOfWeek=`date +%a |tr A-Z a-z`

Date="$Month/$Day/$Year"
ComputeDate $Date $* 
```

该脚本广泛使用了我编写的另一个脚本（称为**col** ......对于那些使用Linux 提供的标准**col的人，我深表歉意）。**此版本的 **col**简化了从标准输入中提取列的过程。因此，

```
$ echo a b c d e | col 5 3 2 
```

印刷

```
e c b 
```

这是**col**脚本：

```
#!/bin/sh
# col -- extract columns from a file
# Usage:
#    col [-r] [c] col-1 col-2 ...
#   where [c] if supplied defines the field separator
#   where each col-i represents a column interpreted according to  the presence of -r as follows:
#        -r present : counting starts from the right end of the line
#        -r absent  : counting starts from the left side of the line
Separator=" "
Reverse=false
case "$1" in
 -r )  Reverse=true; shift;
 ;;
 [0-9]* )
 ;;
 * )Separator="$1"; shift;
 ;;
esac

case "$1" in
 -r )  Reverse=true; shift;
 ;;
 [0-9]* )
 ;;
 * )Separator="$1"; shift;
 ;;
esac

#  Replace each col-i with $i
Cols=""
for  f in $*
do
  if [ $Reverse = true ]; then
     Cols="$Cols \$(NF-$f+1),"
  else
     Cols="$Cols \$$f,"
  fi

done

Cols=`echo "$Cols" | sed 's/,$//'`
#echo "Using column specifications of $Cols"
awk -F "$Separator"  "{print $Cols}" 
```

当脚本调用不正确时，它还使用**printdirections**打印出方向：

```
#!/bin/sh
#
#  printdirections -- print header lines of a shell script
#
#  Usage:
#      printdirections path
#  where
#      path is a *full* path to the shell script in question
#      beginning with '/'
#
#  To use printdirections, you must include (as comments at the top
#  of your shell script) documentation for running the shell script.

if [ $# -eq 0 -o "$*" = "-h" ]; then
   printdirections $0
   exit
fi
#  Delete the command invocation at the top of the file, if any
#  Delete from the place where printdirections occurs to the end of the file
#  Remove the # comments
#  There is a bizarre oddity here.
   sed '/#!/d;/.*printdirections/,$d;/ *#/!d;s/# //;s/#//' $1 > /tmp/printdirections.$$

#  Count the number of lines
numlines=`wc -l /tmp/printdirections.$$ | awk '{print $1}'`

#  Remove the last   line
numlines=`expr $numlines - 1`

head -n $numlines /tmp/printdirections.$$
rm /tmp/printdirections.$$ 
```

要使用此功能，请将三个脚本分别放在文件**ComputeDate**、**col**和**printdirections**中。将文件放在 PATH 命名的目录中，通常是 ~/bin。然后使用以下命令使它们可执行：

```
$ chmod a+x ComputeDate col printdirections 
```

问题？给我发一些电子邮件：morell AT cs.atu.edu 将**ComputeDate**放在主题中。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2014-11-12T02:45:14.043

为了与 BSD/OS X 兼容，您还可以使用 date 实用程序`-j`来`-v`进行日期数学运算。请参阅[FreeBSD 联机帮助页了解 date](http://www.freebsd.org/cgi/man.cgi?query=date)。您可以将以前的 Linux 答案与此答案结合起来，这可能会为您提供足够的兼容性。

在 BSD 上，作为 Linux，运行`date`将为您提供当前日期：

```
$ date
Wed 12 Nov 2014 13:36:00 AEDT 
```

现在使用 BSD 的日期，您可以使用 进行数学运算`-v`，例如列出明天的日期（`+1d`加*一天*）：

```
$ date -v +1d
Thu 13 Nov 2014 13:36:34 AEDT 
```

您可以使用现有日期作为基础，并可以选择使用 strftime 指定解析格式，并确保使用`-j`这样您就不会更改系统日期：

```
$ date -j -f "%a %b %d %H:%M:%S %Y %z" "Sat Aug 09 13:37:14 2014 +1100"
Sat  9 Aug 2014 12:37:14 AEST 
```

您可以将其用作日期计算的基础：

```
$ date -v +1d -f "%a %b %d %H:%M:%S %Y %z" "Sat Aug 09 13:37:14 2014 +1100"
Sun 10 Aug 2014 12:37:14 AEST 
```

请注意，`-v`暗示`-j`.

可以按顺序提供多个调整：

```
$ date -v +1m -v -1w
Fri  5 Dec 2014 13:40:07 AEDT 
```

有关更多详细信息，请参见手册页。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-08-22T02:19:44.120

要在 UNIX 上对日期进行算术运算，您可以将日期作为 UNIX 纪元以来的秒数，进行一些计算，然后转换回可打印的日期格式。date 命令应该能够为您提供自纪元以来的秒数，并将该数字转换回可打印的日期。我的本地日期命令执行此操作，

```
% date -n
1219371462
% date 1219371462
Thu Aug 21 22:17:42 EDT 2008
% 
```

请参阅您当地的`date(1)`手册页。要增加一天，请添加 86400 秒。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-08-08T23:42:33.330

为什么不用像 perl 或 python 这样更自然地支持复杂日期处理的语言来编写脚本呢？当然，您*可以*在 bash 中完成所有操作，但我认为您还可以在使用 python 的平台之间获得更多的一致性，只要您可以确保安装了 perl 或 python。

我应该补充一点，将 python 和 perl 脚本连接到包含 shell 脚本中是非常容易的。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-08-08T23:33:24.503

```
date --date='1 days ago' '+%a' 
```

这不是一个非常兼容的解决方案。它仅适用于 Linux。至少，它在 Aix 和 Solaris 中不起作用。

它适用于 RHEL：

```
date --date='1 days ago' '+%Y%m%d'
20080807 
```

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-16T09:34:20.843

我已经碰到过几次了。我的想法是：

1.  日期算术总是很痛苦
2.  使用 EPOCH 日期格式时会更容易一些
3.  Linux 上的日期转换为 EPOCH，但在 Solaris 上没有
4.  对于便携式解决方案，您需要执行以下操作之一：
    5.  在 solaris 上安装 gnu date（已经提到，需要人工交互才能完成）
    6.  使用 perl 作为日期部分（**大多数**unix 安装都包括 perl，所以我通常认为此操作**不需要** 额外的工作）。

一个示例脚本（检查某些用户文件的年龄以查看是否可以删除该帐户）：

```
#!/usr/local/bin/perl

$today = time();

$user = $ARGV[0];

$command="awk -F: '/$user/ {print \$6}' /etc/passwd";

chomp ($user_dir = `$command`);

if ( -f "$user_dir/.sh_history" ) {
    @file_dates   = stat("$user_dir/.sh_history");
    $sh_file_date = $file_dates[8];
} else {
    $sh_file_date = 0;
}
if ( -f "$user_dir/.bash_history" ) {
    @file_dates     = stat("$user_dir/.bash_history");
    $bash_file_date = $file_dates[8];
} else {
    $bash_file_date = 0;
}
if ( $sh_file_date > $bash_file_date ) {
    $file_date = $sh_file_date;
} else {
    $file_date = $bash_file_date;
}
$difference = $today - $file_date;

if ( $difference >= 3888000 ) {
    print "User needs to be disabled, 45 days old or older!\n";
    exit (1);
} else {
    print "OK\n";
    exit (0);
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-08-09T12:37:19.243

进一步研究，我认为你可以简单地使用日期。我在 OpenBSD 上尝试了以下操作：我选择了 2008 年 2 月 29 日的日期和一个随机时间（以 080229301535 的形式），并在日期部分添加了 +1，如下所示：

```
$ date -j 0802301535
Sat Mar  1 15:35:00 EST 2008 
```

如您所见，日期正确格式化了时间......

高温高压

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-16T12:43:15.770

如果您想继续使用 awk，则 mktime 和 strftime 函数很有用：

```
 BEGIN { dateinit }
      { newdate=daysadd(OldDate,DaysToAdd)}

 # daynum: convert DD-MON-YYYY to day count
 #-----------------------------------------
function daynum(date,  d,m,y,i,n)
{
     y=substr(date,8,4)
     m=gmonths[toupper(substr(date,4,3))]
     d=substr(date,1,2)
     return mktime(y" "m" "d" 12 00 00")
}

 #numday: convert day count to DD-MON-YYYY
 #-------------------------------------------
function numday(n,  y,m,d)
{
    m=toupper(substr(strftime("%B",n),1,3))
    return strftime("%d-"m"-%Y",n)
}

 # daysadd: add (or subtract) days from date (DD-MON-YYYY), return new date (DD-MON-YYYY)
 #------------------------------------------
function daysadd(date, days)
{
    return numday(daynum(date)+(days*86400))
}

 #init variables for date calcs
 #-----------------------------------------
function dateinit(   x,y,z)
{
     # Stuff for date calcs
     split("JAN:1,FEB:2,MAR:3,APR:4,MAY:5,JUN:6,JUL:7,AUG:8,SEP:9,OCT:10,NOV:11,DEC:12", z)
     for (x in z)
     {
        split(z[x],y,":")
        gmonths[y[1]]=y[2]
     }
} 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-16T20:17:13.387

Chris FA Johnson 所著的“Shell Script Recipes: A Problem Solution Approach”一书（ISBN：978-1-59059-471-1）有一个可能有用的日期函数库。源代码可在[http://apress.com/book/downloadfile/2146](http://apress.com/book/downloadfile/2146)获得（日期函数在 tar 文件中的 Chapter08/data-funcs-sh 中）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-15T22:13:52.900

如果 GNU 版本的 date 适合您，为什么不获取源代码并在 AIX 和 Solaris 上编译它呢？

[http://www.gnu.org/software/coreutils/](http://www.gnu.org/software/coreutils/)

无论如何，如果您要编写自己的代码，源代码应该可以帮助您正确计算日期。

顺便说一句，像“那个解决方案很好，但你肯定会注意到它没有那么好。似乎没有人想到在构建 Unix 时修改日期。” 不要真的让我们到任何地方。到目前为止，我发现每一项建议都非常有用且目标明确。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-04-25T11:53:29.550

这是我的两分钱 - 一个使用`date`and的脚本包装器`grep`。

*示例用法*

```
> sh ./datecalc.sh "2012-08-04 19:43:00" + 1s
2012-08-04 19:43:00 + 0d0h0m1s
2012-08-04 19:43:01

> sh ./datecalc.sh "2012-08-04 19:43:00" - 1s1m1h1d
2012-08-04 19:43:00 - 1d1h1m1s
2012-08-03 18:41:59

> sh ./datecalc.sh "2012-08-04 19:43:00" - 1d2d1h2h1m2m1s2sblahblah
2012-08-04 19:43:00 - 1d1h1m1s
2012-08-03 18:41:59

> sh ./datecalc.sh "2012-08-04 19:43:00" x 1d
Bad operator :-(

> sh ./datecalc.sh "2012-08-04 19:43:00"
Missing arguments :-(

> sh ./datecalc.sh gibberish + 1h
date: invalid date `gibberish'
Invalid date :-( 
```

*脚本*

```
#!/bin/sh

# Usage:
#
# datecalc "<date>" <operator> <period>
#
# <date> ::= see "man date", section "DATE STRING"
# <operator> ::= + | -
# <period> ::= INTEGER<unit> | INTEGER<unit><period>
# <unit> ::= s | m | h | d

if [ $# -lt 3 ]; then
echo "Missing arguments :-("
exit; fi

date=`eval "date -d \"$1\" +%s"`
if [ -z $date ]; then
echo "Invalid date :-("
exit; fi

if ! ([ $2 == "-" ] || [ $2 == "+" ]); then
echo "Bad operator :-("
exit; fi
op=$2

minute=$[60]
hour=$[$minute*$minute]
day=$[24*$hour]

s=`echo $3 | grep -oe '[0-9]*s' | grep -m 1 -oe '[0-9]*'`
m=`echo $3 | grep -oe '[0-9]*m' | grep -m 1 -oe '[0-9]*'`
h=`echo $3 | grep -oe '[0-9]*h' | grep -m 1 -oe '[0-9]*'`
d=`echo $3 | grep -oe '[0-9]*d' | grep -m 1 -oe '[0-9]*'`
if [ -z $s ]; then s=0; fi
if [ -z $m ]; then m=0; fi
if [ -z $h ]; then h=0; fi
if [ -z $d ]; then d=0; fi

ms=$[$m*$minute]
hs=$[$h*$hour]
ds=$[$d*$day]

sum=$[$s+$ms+$hs+$ds]
out=$[$date$op$sum]
formattedout=`eval "date -d @$out +\"%Y-%m-%d %H:%M:%S\""`

echo $1 $2 $d"d"$h"h"$m"m"$s"s"
echo $formattedout 
```

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2016-07-13T21:46:17.793

这对我有用：

```
TZ=GMT+6;
export TZ
mes=`date --date='2 days ago' '+%m'`
dia=`date --date='2 days ago' '+%d'`
anio=`date --date='2 days ago' '+%Y'`
hora=`date --date='2 days ago' '+%H'` 
```

# performance - 更快地查找受时间限制的重复项

> ID：6475
> 
> 赞同：3
> 
> 时间：2008-08-08T23:46:31.357
> 
> 标签：performance, unix, awk, aix

在一台装有 AIX 的机器上，`PERL`如果它们具有相同的 id 并且如果它们在四个小时内注册，则我需要过滤将被视为重复的记录。

我使用这个过滤器实现了这个过滤器`AWK`并且工作得很好，但我需要一个更快的解决方案：

```
# Generar lista de Duplicados
awk'开始{
FS=","
}
/好的/ {
    老[$8] = f[$8];
    f[$8] = mktime($4, $3, $2, $5, $6, $7);
    x[$8]++;
}
/OK/ && x[$8]>1 && f[$8]-old[$8]

有什么建议么？有没有办法改善环境（预加载文件或类似的东西）？

输入文件已经排序。

通过[jj33](https://stackoverflow.com/questions/6475/faster-way-to-find-duplicates-conditioned-by-time#6869)建议的更正，我制作了一个新版本，对日期进行了更好的处理，但仍然保持低调以合并更多操作：

awk'开始{
    FS=",";
    秒每分钟=60；
    秒=3600；
    SECSPERDAY=86400；
    拆分（“0 31 59 90 120 151 181 212 243 273 304 334”，DAYSTOMONTH，“”）；
    拆分（“0 366 731 1096 1461 1827 2192 2557 2922 3288 3653 4018 4383 4749 5114 5479 5844 6210 6575 6940 7305”，DAYSTOYEAR，“”）；
}
/好的/ {
    老[$8] = f[$8];
    f[$8] = mktime($4, $3, $2, $5, $6, $7);
    x[$8]++;
}
/OK/ && x[$8]>1 && f[$8]-old[$8] 2 ) && ( ((y % 4 == 0) && (y % 100 != 0)) || (y % 400 = = 0) ) ) {
        d2m = d2m + 1；
    }
    d2y = DAYSTOYEAR[ y - 1999 ]；
    返回 ss + (mm*SECSPERMINUTE) + (hh*SECSPEROUR) + (d*SECSPERDAY) + (d2m*SECSPERDAY) + (d2y*SECSPERDAY);
}
'

```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-10-05T06:29:33.500

这听起来像是一个实际数据库的工作。甚至像 SQLite 这样的东西也可能在这里为您提供相当好的帮助。我看到的最大问题是您对“4 小时内”的定义。这是一个滑动窗口问题，这意味着您不能简单地将所有数据量化为 4 小时段……您必须分别计算每个其他元素的所有“附近”元素。啊。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-09T15:25:29.980

如果您的数据文件包含您的所有记录（即它包括文件中没有重复 ID 的记录），您可以对其进行预处理并生成一个仅包含具有重复 ID 的记录的文件。

如果这种情况会减少您需要使用 AWK 程序处理的文件大小。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-09T18:41:47.977

输入文件是如何排序的？比如，cat 文件|排序，还是通过单个特定字段或多个字段排序？如果有多个字段，哪些字段和顺序是什么？似乎小时字段是 24 小时制，而不是 12，对吧？所有日期/时间字段是否都用零填充（上午 9 点是“9”还是“09”？）

在不考虑性能的情况下，您的代码似乎存在月份边界问题，因为它假设所有月份都是 30 天。取两个日期 2008-05-31/12:00:00 和 2008-06-01:12:00:00。这些时间相隔 24 小时，但您的代码为两者生成相同的时间代码 (63339969600)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-10T03:12:10.240

我认为您需要考虑闰年。我没有做数学计算，但我认为在闰年，2 月的硬代码为 28 天，比较 2 月 29 日中午和 3 月 1 日中午会导致与以前相同的重复时间戳. 虽然看起来你没有像那样实现它。他们以你实现它的方式，我认为你仍然有问题，但它介于 $leapyear 的 12/31 和 $leapyear+1 的 1/1 之间。

我认为如果您的代码必须处理处理它们的时区，那么在时间更改期间您可能还会遇到一些冲突。

该文件似乎并没有以任何有用的方式进行排序。我猜该字段 $1 是某种状态（您正在检查的“OK”）。所以它是按记录状态排序的，然后是天，然后是月、年、小时、分钟、秒。如果是年、月、日，我认为那里可能会有一些优化。仍然可能是，但我的大脑现在正朝着不同的方向发展。

如果与总行数成比例的重复键数量很少，我认为最好的办法是减少 awk 脚本工作的文件，只使用重复键（正如[大卫所说](https://stackoverflow.com/questions/6475/faster-way-to-find-duplicates-conditioned-by-time#6813)）。您还可以对文件进行预处理，以便唯一存在的行是 /OK/ 行。我想我会使用管道来执行此操作，其中第一个 awk 脚本仅打印具有重复 ID 的行，而第二个 awk 脚本基本上是上面的那个，但经过优化以不查找 /OK/ 并且知道存在的任何键都是重复键。

如果您提前知道所有或大多数行都会有重复的键，那么可能不值得搞砸。我会硬着头皮用 C 语言编写它。代码行数更多，比 awk 脚本快得多。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-10T14:51:02.187

在许多 unixen 上，您可以通过特定的列或字段进行排序。因此，通过按 ID 排序文件，然后按日期排序，您不再需要保留上次看到每个 ID 时间的关联数组。所有上下文都按文件的顺序排列。

在我的具有 GNU 排序的 Mac 上，它是：

```
sort -k 8 < input.txt > output.txt 
```

对 ID 字段进行排序。您也可以通过说（例如）8,3 来对第二个字段进行排序，但只有 2 个字段。因此，unix 风格的 time_t 时间戳在文件中可能不是一个坏主意 - 它很容易排序，并为您节省所有这些日期计算。此外，（再次至少在 GNU awk 中），有一个[mktime 函数](http://www.gnu.org/manual/gawk/html_node/Time-Functions.html)可以从组件中为您生成 time_t。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-11T13:07:51.987

@[AnotherHowie](https://stackoverflow.com/questions/6475/faster-way-to-find-duplicates-conditioned-by-time#7210), I thought the whole preprocessing could be done with sort and uniq. The problem is that the OP's data seems to be comma delimited and (Solaris 8's) uniq doesn't allow you any way specify the record separator, so there wasn't a super clean way to do the preprocessing using standard unix tools. I don't think it would be any faster so I'm not going to look up the exact options, but you could do something like:

```
cut -d, -f8 <infile.txt | sort | uniq -d | xargs -i grep {} infile.txt >outfile.txt 
```

That's not very good because it executes grep for every line containing a duplicate key. You could probably massage the uniq output into a single regexp to feed to grep, but the benefit would only be known if the OP posts expected ratio of lines containing suspected duplicate keys to total lines in the file.

# unit-testing - 你如何模拟一个密封类？

> ID：6484
> 
> 赞同：70
> 
> 时间：2008-08-09T00:14:22.143
> 
> 标签：unit-testing, language-agnostic, tdd, mocking

[模拟密封类](http://www.google.com/search?q=how%20to%20mock%20sealed%20class)可能会很痛苦。我目前喜欢使用[适配器模式](http://en.wikipedia.org/wiki/Adapter_pattern)来处理这个问题，但有些东西总是让人感觉很奇怪。

**那么，模拟密封类的最佳方式是什么？**

*Java 答案非常受欢迎*。事实上，我预计 Java 社区处理这个问题的时间会更长，并且可以提供很多东西。

但这里有一些 .NET 意见：

*   [为什么 Duck 类型对 C# 开发人员很重要](http://haacked.com/archive/2007/08/19/why-duck-typing-matters-to-c-developers.aspx)
*   [为密封和其他模拟类型创建包装器](http://cs.rthand.com/blogs/blog_with_righthand/archive/2008/07/22/Creating-wrappers-for-sealed-and-other-types-for-mocking.aspx)
*   [WCF（和 Moq）的单元测试](http://weblogs.asp.net/cibrax/archive/2008/05/16/unit-tests-for-wcf.aspx)

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-08-28T06:44:22.923

对于 .NET，您可以使用[TypeMock](http://www.typemock.com/)之类的东西，它使用分析 API 并允许您挂钩对几乎任何东西的调用。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-08-09T09:40:37.727

我的一般经验法则是，我需要模拟的对象也应该有一个通用接口。我认为这在设计上是正确的，并且使测试更容易（如果你做 TDD，通常是你得到的）。有关这方面的更多信息，请参阅 Google 测试博客的[最新帖子](http://googletesting.blogspot.com/2008/08/by-miko-hevery-so-you-decided-to.html)（请参阅第 9 点）。

另外，在过去的 4 年里，我主要在 Java 领域工作，我可以说我一方面可以数出我创建最终（密封）类的次数。这里的另一条规则是我应该始终有充分的理由来密封一个课程，而不是默认密封它。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2010-04-06T20:12:03.190

我相信来自 Microsoft Research 的[Moles](http://research.microsoft.com/en-us/projects/Pex/)可以让您做到这一点。从痣页面：

> Moles 可用于绕过任何 .NET 方法，包括密封类型中的非虚拟/静态方法。

**更新：**在即将发布的 VS 11 版本中有一个名为“Fakes”的新框架，旨在取代 Moles：

> [Visual Studio 11](http://aka.ms/vs11-fakes)中的Fakes Framework是 Moles & Stubs 的下一代，最终将取代它。然而，Fakes 与 Moles 不同，因此从 Moles 转移到 Fakes 将需要对您的代码进行一些修改。稍后将提供此迁移的指南。
> 
> **要求**：Visual Studio 11 Ultimate，.NET 4.5

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-08-28T07:04:19.113

TypeMock 的问题在于它为糟糕的设计找借口。现在，我知道它隐藏的往往*是别人的*糟糕设计，但是允许它进入你的开发过程很容易导致你自己的糟糕设计被允许。

我认为如果你要使用一个模拟框架，你应该使用一个传统的框架（比如 Moq）并围绕不可模拟的东西创建一个隔离层，然后模拟隔离层。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-12-11T04:08:01.970

我几乎总是避免在我的代码深处依赖外部类。相反，我更愿意使用适配器/网桥与他们交谈。这样，我正在处理我的语义，翻译的痛苦被隔离在一个类中。

从长远来看，它还可以更轻松地切换我的依赖项。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2015-05-12T19:42:34.163

我最近遇到了这个问题，在阅读/搜索网页之后，似乎除了使用上面提到的另一个工具之外没有简单的方法。或者像我一样粗暴地处理事情：

*   创建密封类的实例而不调用构造函数。
*   System.Runtime.Serialization.FormatterServices.GetUninitializedObject(instanceType);

*   通过反射为您的属性/字段赋值

*   YourObject.GetType().GetProperty("PropertyName").SetValue(dto, newValue, null);
*   YourObject.GetType().GetField("FieldName").SetValue(dto, newValue);

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-12-08T05:14:09.100

我通常采用创建接口和适配器/代理类的方法来促进密封类型的模拟。但是，我也尝试过跳过创建接口并使用虚拟方法使代理类型不密封。当代理真的是一个自然的基类，它封装了密封类的一部分和用户部分时，这很有效。

在处理需要这种调整的代码时，我厌倦了执行相同的操作来创建接口和代理类型，因此我实现了一个库来自动化任务。

该代码比您参考的文章中给出的示例要复杂一些，因为它生成程序集（而不是源代码），允许在任何类型上执行代码生成，并且不需要太多配置。

欲了解更多信息，请参阅[此页面](http://jolt.codeplex.com/wikipage?title=Jolt.Testing.CodeGeneration.Proxy&referringTitle=Jolt.Testing)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-04-06T20:05:01.763

模拟密封类是完全合理的，因为许多框架类都是密封的。

就我而言，我正在尝试模拟 .Net 的 MessageQueue 类，以便我可以对优雅的异常处理逻辑进行 TDD。

如果有人对如何克服 Moq 关于“不可覆盖成员的无效设置”的错误有任何想法，请告诉我。

代码：

```
 [TestMethod]
    public void Test()
    {
        Queue<Message> messages = new Queue<Message>();
        Action<Message> sendDelegate = msg => messages.Enqueue(msg);
        Func<TimeSpan, MessageQueueTransaction, Message> receiveDelegate =
            (v1, v2) =>
            {
                throw new Exception("Test Exception to simulate a failed queue read.");
            };

        MessageQueue mockQueue = QueueMonitorHelper.MockQueue(sendDelegate, receiveDelegate).Object;
    }
    public static Mock<MessageQueue> MockQueue
                (Action<Message> sendDelegate, Func<TimeSpan, MessageQueueTransaction, Message> receiveDelegate)
    {
        Mock<MessageQueue> mockQueue = new Mock<MessageQueue>(MockBehavior.Strict);

        Expression<Action<MessageQueue>> sendMock = (msmq) => msmq.Send(It.IsAny<Message>()); //message => messages.Enqueue(message);
        mockQueue.Setup(sendMock).Callback<Message>(sendDelegate);

        Expression<Func<MessageQueue, Message>> receiveMock = (msmq) => msmq.Receive(It.IsAny<TimeSpan>(), It.IsAny<MessageQueueTransaction>());
        mockQueue.Setup(receiveMock).Returns<TimeSpan, MessageQueueTransaction>(receiveDelegate);

        return mockQueue;
    } 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2012-04-04T01:24:41.890

尽管它目前仅在 beta 版本中可用，但我认为值得牢记新[Fakes 框架](http://aka.ms/vs11-fakes)（[Visual Studio 11](http://www.microsoft.com/visualstudio/11/en-us) Beta 版本的一部分）的[shim功能。](http://msdn.microsoft.com/en-us/library/hh549176%28v=vs.110%29.aspx)

> Shim 类型提供了一种将任何 .NET 方法绕道到用户定义的委托的机制。Shim 类型由 Fakes 生成器生成代码，它们使用委托（我们称为 shim 类型）来指定新方法的实现。在底层，shim 类型使用在运行时注入到方法 MSIL 主体中的回调。

就我个人而言，我正在考虑使用它来模拟密封框架类（如 DrawingContext）上的方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-09T02:21:32.853

有没有办法从接口实现密封类......并模拟接口？

我觉得一开始就有密封的课程是错误的，但这就是我:)

# javascript - 你用什么风格来创建一个“类”？

> ID：6499
> 
> 赞同：24
> 
> 时间：2008-08-09T00:56:15.040
> 
> 标签：javascript

有几种方法可以在 javascript 中获得类类行为，最常见的似乎是基于原型的，如下所示：

```
function Vector(x, y, x) {
    this.x = x;
    this.y = y;
    this.z = z;
    return this;
}

Vector.prototype.length = function () { return Math.sqrt(this.x * this.x ... ); } 
```

和基于闭包的方法类似于

```
function Vector(x, y, z) {
    this.length = function() { return Math.sqrt(x * x + ...); }
} 
```

由于各种原因，后者更快，但我已经看到（并且我经常编写）原型版本并且很好奇其他人在做什么。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-09T02:05:33.840

将函数分配给原型更好（对于公共方法），因为类的所有实例都将共享该方法的相同副本。如果像第二个示例那样在构造函数中分配函数，则每次创建新实例时，构造函数都会创建长度函数的新副本并将其分配给该实例。

*但是，如果您希望*每个副本都有自己的副本，则后一种技术很有用，该技术的主要用途是执行私有/特权方法，这些方法可以访问在构造函数中声明并通过闭包机制继承的私有变量。

Douglas Crockford 有一个很好的[总结](http://javascript.crockford.com/private.html)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-22T02:43:19.413

原型还有对象字面量方法：

```
var Vector = function(){};

Vector.prototype = {
  init:function(x,y,z) {
    this.x = x;
    this.y = y;
    this.z = z;
  },
  length:function() {
    return Math.sqrt(x * x + ...);
  }
};

var v1 = new Vector();
v1.init(1,2,3); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-08-09T02:09:04.673

幸运的是，我使用了[prototype.js](http://prototypejs.org/)，它提供了一些不错的包装器。所以你可以这样做：

```
var Person = Class.create({
    initialize: function(name) {
        this.name = name;
    },
    say: function(message) {
        return this.name + ': ' + message;
    }
}); 
```

[`Prototype.js`文档：定义类和继承](http://prototypejs.org/learn/class-inheritance)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-09T01:12:26.863

好吧，我对此真的没有专家意见。我通常最终使用基于闭包的方法，只是因为它使代码更易于管理。但是，我发现自己在使用具有大量代码行的方法的原型。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-09T01:32:17.120

您还可以选择：

```
function Vector(x, y, z) {
  function length() {
    return Math.sqrt(x * x + ...);
  }
} 
```

这可能与示例 2 一样慢，但它看起来更像 Java/C# 并且更明确一些。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-07-26T19:52:55.290

我非常喜欢为此使用[John Resig 的库](http://ejohn.org/blog/simple-javascript-inheritance/)。轻量级、直截了当，如果您熟悉“通常”的面向对象风格，您已经知道如何使用它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-11-11T16:34:23.253

javascript中没有类。

然而有对象。你不需要一个类来在 javascript 中创建一个对象。它确实具有您可以使用 new 调用的构造函数，例如：

```
var james = new Person(); 
```

您可以通过以下方式模拟类行为：

原型示例：

```
function Car (type) {
    this.type = type;
    this.color = "red";
}

Car.prototype.getInfo = function() {
    return this.color + ' ' + this.type + ' car';
}; 
```

对象字面量示例

```
var car = {
    type: "honda",
    color: "red",
    getInfo: function () {
        return this.color + ' ' + this.type + ' car';
    }
} 
```

# c - 如何实现延续？

> ID：6512
> 
> 赞同：53
> 
> 时间：2008-08-09T01:18:37.943
> 
> 标签：c, lisp, scheme, continuations

我正在研究用 C 编写的 Scheme 解释器。目前它使用 C 运行时堆栈作为自己的堆栈，这在实现延续方面存在一个小问题。我目前的解决方案是将 C 堆栈手动复制到堆中，然后在需要时将其复制回来。除了不是标准的 C 之外，这种解决方案也不是很理想。

在 C 中实现 Scheme 延续的最简单方法是什么？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-08-31T05:02:30.977

Clinger、Hartheimer 和 Ost 的文章《[Implementation Strategies for First-Class Continuations](http://link.springer.com/article/10.1023/A:1010016816429) 》中有一个很好的总结。我建议特别查看 Chez Scheme 的实施。

堆栈复制并不那么复杂，并且有许多易于理解的技术可用于提高性能。使用堆分配的帧也相当简单，但是您需要权衡为不使用显式延续的“正常”情况创建开销。

如果您将输入代码转换为连续传递样式 (CPS)，那么您可以完全消除堆栈。然而，虽然 CPS 很优雅，但它在前端增加了另一个处理步骤，并且需要额外的优化来克服某些性能影响。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-08-09T02:49:25.903

我记得读过一篇可能对你有帮助的文章：*[MTA 上的切尼](http://home.pipeline.com/~hbaker1/CheneyMTA.html)*:-)

我知道的一些 Scheme 实现，例如[SISC](http://sisc.sourceforge.net/)，在堆上分配它们的调用帧。

@ollie：如果所有调用帧都在堆上，则不需要进行提升。当然，性能需要权衡：提升时间与分配堆上所有帧所需的开销。也许它应该是解释器中一个可调的运行时参数。:-P

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-12-05T08:00:30.907

如果您是从头开始，您真的应该考虑继续传递样式 (CPS) 转换。

好的资源包括“LISP in smallpieces”和[Marc Feeley 的 90 分钟演示方案](https://web.archive.org/web/20090702055316/http://www.iro.umontreal.ca/~boucherd/mslug/meetings/20041020/minutes-en.html)。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2011-10-30T15:31:12.843

到目前为止，似乎没有提到 Dybvig 的论文。阅读是一种享受。基于堆的模型最容易实现，但基于栈的效率更高。忽略基于字符串的模型。

R. Kent Dybvig。“方案的三种实施模式”。 [http://www.cs.indiana.edu/~dyb/papers/3imp.pdf](http://www.cs.indiana.edu/~dyb/papers/3imp.pdf)

另请查看 ReadScheme.org 上的实施文件。 [https://web.archive.org/http://library.readscheme.org/page8.html](https://web.archive.org/http://library.readscheme.org/page8.html)

摘要如下：

> 本文介绍了Scheme编程语言的三种实现模型。第一个是迄今为止在大多数 Scheme 实现中以某种形式使用的基于堆的模型；第二个是新的基于堆栈的模型，在执行大多数程序时比基于堆的模型效率更高；第三个是新的基于字符串的模型，旨在用于 Scheme 的多处理器实现。
> 
> 基于堆的模型在堆中分配了几个重要的数据结构，包括实际参数列表、绑定环境和调用帧。
> 
> 基于堆栈的模型尽可能在堆栈上分配这些相同的结构。这导致更少的堆分配、更少的内存引用、更短的指令序列、更少的垃圾收集和更有效的内存使用。
> 
> 基于字符串的模型在程序文本中分配这些结构的版本，它表示为一串符号。在基于字符串的模型中，Scheme 程序被翻译成专门设计用于支持 Scheme 的 FFP 语言。这种语言的程序直接由 FFP 机器执行，FFP 机器是一种多处理器字符串缩减计算机。
> 
> 基于堆栈的模型具有直接的实际好处；它是作者的 Chez Scheme 系统使用的模型，是 Scheme 的高性能实现。一旦机器实现，基于字符串的模型将有助于在 FFP 机器上提供 Scheme 作为 FFP 的高级替代方案。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2010-06-08T00:25:17.440

除了到目前为止你得到的很好的答案，我推荐 Andrew Appel 的 [Compiling with Continuations](https://rads.stackoverflow.com/amzn/click/com/052103311X)。它写得很好，虽然不直接与 C 打交道，但它是编译器编写者非常好的想法的来源。

Chicken Wiki 还有一些您会发现非常有趣的页面，例如 [内部结构](http://wiki.call-cc.org/chicken-internal-structure)和[编译过程](http://wiki.call-cc.org/chicken-compilation-process)（其中 CPS 以编译的实际示例进行解释）。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2008-08-28T10:05:19.227

传统的方法是使用`setjmp`and `longjmp`，尽管有一些警告。

这是一个[相当不错的解释](https://web.archive.org/web/20090206042150/http://homepage.mac.com/sigfpe/Computing/continuations.html)

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-25T17:59:39.747

您可以查看的示例有：[Chicken](http://www.call-with-current-continuation.org/)（一个 Scheme 实现，用 C 编写，支持延续）；Paul Graham 的[On Lisp](http://www.paulgraham.com/onlisp.html) - 他创建了一个 CPS 转换器来实现 Common Lisp 中的延续子集；和[Weblocks](http://common-lisp.net/project/cl-weblocks/) - 一个基于延续的 Web 框架，它还在 Common Lisp 中实现了有限形式的延续。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-12-03T13:04:35.363

延续不是问题：您可以使用 CPS 实现具有常规高阶函数的那些。天真的堆栈分配的问题是尾调用永远不会优化，这意味着你不能计划。

当前将方案的意大利面条堆栈映射到堆栈上的最佳方法是使用蹦床：本质上是额外的基础设施来处理非 C 类调用和过程退出。参见[蹦床风格 (ps)](http://www.cs.indiana.edu/~dfried/ts.ps)。

有[一些代码](http://cpscm.googlecode.com/svn/trunk/scm/cpscm.scm)说明了这两种想法。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2010-01-04T10:33:52.340

延续基本上包括在上下文切换点的堆栈和 CPU 寄存器的保存状态。至少你不必在切换时将整个堆栈复制到堆中，你可以只重定向堆栈指针。

使用纤维很容易实现延续。[http://en.wikipedia.org/wiki/Fiber_%28computer_science%29](http://en.wikipedia.org/wiki/Fiber_%28computer_science%29) 。唯一需要仔细封装的是参数传递和返回值。

在 Windows 中，光纤是使用 CreateFiber/SwitchToFiber 系列调用完成的。在符合 Posix 的系统中，可以使用 makecontext/swapcontext 来完成。

boost::coroutine 有一个适用于 C++ 的协同程序的工作实现，可以作为实现的参考点。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2017-10-25T08:17:27.417

正如所`soegaard`指出的，主要参考仍然是 `R. Kent Dybvig. "Three Implementation Models for Scheme"`.

这个想法是，延续是保持其评估控制堆栈的闭包。控制堆栈是必需的，以便从使用 创建延续的那一刻起继续评估`call/cc`。

经常调用延续会导致执行时间很长，并用重复的堆栈填充内存。我写了这个愚蠢的代码来证明，在 mit-scheme 中它会使方案崩溃，

该代码将前 1000 个数字相加`1+2+3+...+1000`。

```
(call-with-current-continuation 
 (lambda (break)
   ((lambda (s) (s s 1000 break))
    (lambda (s n cc)
      (if (= 0 n)
          (cc 0)
          (+ n
             ;; non-tail-recursive,
             ;; the stack grows at each recursive call
             (call-with-current-continuation
              (lambda (__)
                (s s (- n 1) __))))))))) 
```

如果您从 1000 切换到 100 000，代码将花费 2 秒，如果您增加输入数字，它将崩溃。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-09T01:29:33.537

请改用显式堆栈。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-08-09T02:55:01.947

帕特里克是正确的，您真正可以做到这一点的唯一方法是在解释器中使用显式堆栈，并在需要转换为延续时将适当的堆栈段提升到堆中。

这与在支持闭包的语言中支持闭包所需的基本相同（闭包和延续有些相关）。

# asp.net - Where should I put my log file for an asp.net application?

> ID：6530
> 
> 赞同：11
> 
> 时间：2008-08-09T02:03:52.033
> 
> 标签：asp.net, logging, permissions

I have a ASP.NET application that we've written our own logging module for.

My question is, where is the standard place to write a log file to? I.e. the website will be running as the anonymous user identity (e.g. IUSR on IIS7) and I need a place where I know it'll have permission to write to.

Cheers,

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-09T02:10:12.800

App_Data folder on the root of the project. It isn't served to web requests; so other people can't snoop for it.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-09T08:47:31.670

I would suggest putting the log file onto a seperate disk, though should give you a little performance gain so that your not trying to both read and write to the same disk as the website. If you cannot put the log file on a seperate disk, then I would simply choose a folder of your choice.

In any case, you will have to give the "Network Service" account "Modify" permissions to the desired folder.

If on the other hand, you have access to a databse, then log the information there. It will be much quicker than accessing the hard drive and won't be publically available. You'll also be able to report from the data quite easily.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-10T20:52:20.973

I'm not in a position to modify the permissions on folders (especially outside of the virtual directory home folder), and don't already have an App_Data folder, so am a bit hesitant to go with that.

So for the moment I'm going with the CommonApplicationData Folder.

*   On Vista/Server 2008 this is C:\ProgramData\
*   On XP/Server 2003 this is C:\Documents and Settings\All Users\Application Data\

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-10T20:57:21.433

> I'm not in a position to modify the permissions on folders (especially outside of the virtual directory home folder), and don't already have an App_Data folder, so am a bit hesitant to go with that.

If you have a website, you clearly have a folder somewhere. Can you not add a (non-web-facing) subfolder? It seems like that would be a more appropriate place to put your logs than dumping them into a global, shared folder.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-11T01:45:10.930

You could also log to the Windows Event log or to a table in a database. How often are people looking at the event log? If it's being examined on a regualr basis, writing to a table amkes the reporting back much easier as it's trivial to reverse the order and only show the last X events for the current time period. The Windows Event log you can also query the Windows Event Log through [PowerShell](http://en.wikipedia.org/wiki/Powershell) or with [LogParser](http://www.microsoft.com/downloads/details.aspx?FamilyID=890cd06b-abf8-4c25-91b2-f8d975cf8c07&displaylang=en).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-02-13T06:04:34.047

Push the app_data is the best idea, just bear in mind, when the publishing the projects, if the option "Delete all existing files before publishing" is ticked, then the current data in the folder will be gone. The workaround is to skip the deletion of app_data folder.

Another option to do logging is to use some existing framework such as Log4net.

# algorithm - 两颗弹珠和一座 100 层的建筑

> ID：6547
> 
> 赞同：39
> 
> 时间：2008-08-09T02:23:27.890
> 
> 标签：algorithm, puzzle

那些经典的编程面试问题之一......

给你两颗弹珠，并告诉它们从某个特定高度掉落时会破裂（如果从该高度以下掉落，可能不会受到损坏）。然后你被带到一栋 100 层的建筑物（大概高于特定高度），并被要求找到你可以在不破坏大理石的情况下掉落的最高楼层。

额外信息

*   您必须找到正确的楼层（不是可能的范围）
*   弹珠都保证在同一楼层破裂
*   假设您更换地板的时间为零——仅计算大理石滴的数量
*   假设正确的楼层随机分布在建筑物中

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2008-08-09T02:45:43.070

这里有趣的事情是你如何以尽可能少的滴数做到这一点。如果突破层是第 49 层，去第 50 层并掉第一个将是灾难性的，导致我们不得不进行 50 次下降。我们应该在第 n 层丢下第一个弹珠，其中 n 是所需的最大下落量。如果大理石在第 n 层破裂，我们可能必须在那之后滴下 n-1 次。如果弹珠没有破碎，我们就上到 2n-1 层，如果它在这里破碎，我们必须在最坏的情况下丢下第二颗弹珠 n-2 次。我们继续这样直到第 100 层，并尝试在 3n-2、4n-3....
和 n+(n-1)+(n-2)+...1 <=100
**n=14处打破它是否需要最大滴数**

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2014-01-15T09:32:13.247

[这个问题在《 Cracking the Coding Interview (5th)](https://rads.stackoverflow.com/amzn/click/com/098478280X) 》一书中的问题 6.5 中有介绍，解决方案总结如下：

## 观察：

无论我们如何删除 Marble1，Marble2 都必须进行线性搜索。例如，如果 Marble1 在 10 层和 15 层之间断裂，我们必须用 Marble2 检查中间的每一层

* * *

## 该方法：

**第一次尝试：**假设我们从 10 楼掉落大理石，然后从 20 楼……</p>

*   在第一滴（10 楼）的第一个 Marble 破裂中，我们最多总共有 10 滴。
*   如果第一个 Marble 在最后一滴（100 层）破裂，那么我们最多总共有 19 滴（1 到 100 层，然后是 91 到 99 层）。
*   这很好，但我们所考虑的只是绝对最坏的情况。我们应该做一些“负载平衡”以使这两种情况更加均匀。

**目标：** 创建一个掉落 Marble1 的系统，这样无论 Marble1 是在第一次掉落还是在最后一次掉落时破裂，所需的最多掉落次数都是一致的。

1.  一个完美的负载平衡系统将是一个 Marble1 的 Drops of Marble2 + Drops of Marble2 始终相同的系统，无论 Marble1 在哪里损坏。
2.  在这种情况下，由于 Marble1 的每一滴都会多走一步，因此 Marble2 可以少走一步。
3.  因此，我们必须每次将 Marble2 可能需要的步骤数减少一​​滴。例如，如果 Marble1 掉落在 20 楼然后是 30 楼，则 Marble2 可能需要走 9 步。当我们再次放下 Marble1 时，我们必须将可能的 Marble2 步骤减少到只有 8 个。例如，我们必须在 39 楼放下 Marble1。
4.  因此，我们知道，Marble1 必须从 X 层开始，然后向上 X-1 层，然后 X-2，……，直到达到 100。
5.  求解 X+(X-1)+(X-2)+…+1 = 100。X(X+1)/2 = 100 -> X = 14

**我们去 14 楼，然后是 27 楼，然后是 39 楼……这最多需要 14 步。**

* * *

## 代码和扩展：

*   对于代码实现，您可以在[此处查看](https://stackoverflow.com/a/14919702/2589776)。

*   有关`N`弹珠、`M`地板的扩展，请查看[第 12 章：鸡蛋和地板之谜](http://www.usvishakh.net/umesh/p2.pdf)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-09T02:29:48.110

它们在从相同高度掉落时都会断裂，还是它们不同？

如果它们相同，我会去 50 楼丢下第一个弹珠。如果它没有破裂，我会去 75 楼做同样的事情，只要它没有破裂，我就会继续上升 50% 的剩余空间。当它真的破裂时，我会回到比之前高的地方（所以如果它在 75 楼破裂，我会回到 51 楼）并放下第二块大理石并一次向上移动一层直到它破裂，在这一点上，我知道我可以从没有大理石破损的最高楼层跌落。

可能不是最好的答案，我很好奇其他人如何回答。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-09T02:40:56.653

我认为*真正的*问题是你想要答案有多准确。因为您的效率将真正取决于此。

如果你想要 100% 的弹珠准确率，我会同意贾斯汀的观点，那么一旦第一个弹珠破裂，你就必须从最后一个已知的“好”楼层一次上一层，直到你找出哪一层是赢家。” 甚至可以输入一些统计数据并从 25 楼而不是 50 楼开始，这样最坏的情况是 24 楼而不是 49 楼。

如果您的答案可以加或减一两层楼，那么可能会有一些优化。

其次，上下楼梯会影响你的效率吗？在这种情况下，每次上/下行程时总是放下两个弹珠并捡起两个弹珠。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-09T14:46:21.137

在第 10、20、30 层等处丢下第一个弹珠，直到它破裂，然后跳回最后一个已知的*好*地板，并开始一次一层地从那里丢下弹珠。最坏的情况是 99 是魔术地板，你总能在 19 滴或更少的时间内找到它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-09T02:37:41.760

我个人不是很喜欢这样的谜题，我更喜欢面试中的实际编程练习。

也就是说，首先这取决于我是否能从我将它们扔到的地板上判断它们是否坏了。我会假设我可以。

我会上二楼，丢下第一块大理石。如果它坏了我会尝试一楼。如果它坏了，我会知道它没有地板。

如果第一个没有坏，我会去四楼从那里掉下来。如果它坏了，我会回去拿另一块大理石，然后掉到 3 楼，不管坏与否，我会知道哪个是极限。

如果两个都没有坏，我会去拿两个，做同样的过程，这次从 6 楼开始。

这样，我可以跳过每隔一层，直到我得到一个打破的大理石。

如果大理石早早破裂，这将进行优化......我想可能有一个最佳数量的楼层我可以跳过以获得最大的每次跳过......但是如果一个打破，我将不得不单独检查每一层从最后一个已知楼层上方的一楼......如果我跳过太多楼层当然会很痛苦（对不起，现在不打算找出最佳解决方案）。

理想情况下，我想要一整袋弹珠，然后我可以使用二分搜索算法并将每一滴的楼层数分成两半……但是，这不是问题，是吗？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-03-27T10:48:17.580

如果您想要一个可以为您提供 N 层结果的通用解决方案（在您的情况下为 N=100），那么您只需求解二次方程[$x^2+x-2\cdot(N-1)=0$](https://chart.googleapis.com/chart?cht=tx&chl=x%5E2%2Bx-2%5Ccdot(N-1)%3D0)和结果是正根的[上限](https://en.wikipedia.org/wiki/Floor_and_ceiling_functions)。

这是：

[$$f(N)=天花板\bigg(\frac{-1+\sqrt{1+4\cdot2\cdot(N-1))}}{2}\bigg)$$](https://chart.googleapis.com/chart?cht=tx&chl=f(N)%3Dceiling%5Cleft(%5Cfrac%7B-1%2B%5Csqrt%7B1%2B4%5Ccdot2%5Ccdot(N-1))%7D%7D%7B2%7D%5Cright))

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-09T06:50:10.300

从 3 楼掉落第一块大理石。如果它坏了，你知道它是 1 楼或 2 楼，所以从 2 楼扔下另一个大理石。如果它没有坏，你发现 2 楼是最高的。如果它确实坏了，你会发现 1 楼是最高的。2滴。

如果从 3 楼掉下来没有破坏大理石，从 6 楼掉下来。如果它坏了，你知道 4 楼或 5 楼是最高的。从 5 楼丢下第二颗弹珠。如果它没有碎，你会发现 5 是最高的。如果是这样，4楼是最高的。4滴。

继续。

3 层 - 最多 2 滴

6 层 - 最多 4 滴

9 层 - 最多 6 滴

12 层 - 最多 8 滴

等等

3x 楼层 - 最多 2x 掉落

因此，对于一栋 99 层的建筑物，您最多可以有 66 滴。这是最大值。你的滴数可能会比这少。哦，66 也是 100 层建筑的最大值。如果休息地板是 98 或 97 楼，你只需要 66 滴。如果休息地板是 100，你会使用 34 滴。

即使你说没关系，这可能需要最少的步行量，而且你不必知道建筑物有多高。

部分问题在于您如何定义效率。总是在少于 x 滴的时间内得到解决方案是否更“有效”，或者在 y < x 的情况下有很好的机会在 y 滴中获得解决方案是否更有效，但需要注意的是，您可能有超过 x 滴?

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2014-07-20T14:34:34.373

只需 7 个弹珠就可以做得更好。

所以按照投票的答案，说大理石至少打破了 49 楼。

1.  50 楼 -> 休息（答案在 1 到 50 之间）
2.  25 楼 -> 不破（26 到 50）
3.  37 楼 -> 不破（38 到 50）
4.  43 楼 -> 不坏（44 到 50）
5.  46 楼 -> 不破（47 到 50）
6.  48 楼 -> 不破（49 或 50）
7.  49楼->休息（49楼，这一步实际上是需要的，因为它可能是大理石破裂的最低楼层在50楼）

这可以想象为在一个排序集中对某个 k 进行二分搜索，每次尝试我们将解决方案空间减半。对于 100 层，我们需要 log2 100 = 6.644（7 次尝试）。使用 7 块大理石，我们可以确定哪一层是大理石可以分解到 128 层的最低楼层。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2008-09-25T15:42:09.657

我要做的第一件事是使用从 1 楼开始的死简单算法，一次将大理石掉落一层，直到达到 100 或大理石破裂。

然后我会问我为什么要花时间优化它，直到有人能证明这将是一个问题。很多时候，当一个更简单的算法可以解决问题时，人们就会全神贯注于寻找完美的复杂算法。换句话说，在需要之前不要优化事物。

这可能是一个棘手的问题，看看你是否是那些能从鼹鼠山上造出一座山的人之一。

# c# - 在 C# 中，为什么不能使用 List 对象存储在列表中 variable It seems that a List object cannot be stored in a List variable in C#, and can't even be explicitly cast that way. List<string> sl = new List<string>(); Lis 问问题 问问题 2008-08-09T02:32:01.507 76305 次 This question shows research effort; it is useful and clear 86 This question does not show any research effort; it is unclear or not useful Bookmark this question. Show activity on this post. It seems that a List object cannot be stored in a List variable in C#, and can't even be explicitly cast that way. List<string> sl = new List<string>(); List<object> ol; ol = sl; results in Cannot implicitly convert type System.Collections.Generic.List<string> to System.Collections.Generic.List<object> And then... List<string> sl = new List<string>(); List<object> ol; ol = (List<object>)sl; results in Cannot convert type System.Collections.Generic.List<string> to System.Collections.Generic.List<object> Of course, you can do it by pulling everything out of the string list and putting it back in one at a time, but it is a rather convoluted solution. The reason is that a generic class like List<> is, for most purposes, treated externally as a normal class. e.g. when you say List<string>() the compiler says ListString() (which contains strings). [Technical folk: this is an extremely plain-English-ified version of what's going on] Consequently, obviously the compiler can't be smart enough to convert a ListString to a ListObject by casting the items of its internal collection. That's why there's extension methods for IEnumerable like Convert() that allow you to easily supply conversion for the items stored inside a collection, which could be as simple as casting from one to another. c#.netgenericscovariancetype-safety 4 14 回答 14 This answer is useful 39 Think of it this way, if you were to do such a cast, and then add an object of type Foo to the list, the list of strings is no longer consistent. If you were to iterate the first reference, you would get a class cast exception because once you hit the Foo instance, the Foo could not be converted to string! As a side note, I think it would be more significant whether or not you can do the reverse cast: List<object> ol = new List<object>(); List<string> sl; sl = (List<string>)ol; I haven't used C# in a while, so I don't know if that is legal, but that sort of cast is actually (potentially) useful. In this case, you are going from a more general class (object) to a more specific class (string) that extends from the general one. In this way, if you add to the list of strings, you are not violating the list of objects. Does anybody know or can test if such a cast is legal in C#? 于 2008-08-09T02:50:14.903 回答 This answer is useful 36 If you're using .NET 3.5 have a look at the Enumerable.Cast method. It's an extension method so you can call it directly on the List. List<string> sl = new List<string>(); IEnumerable<object> ol; ol = sl.Cast<object>(); It's not exactly what you asked for but should do the trick. Edit: As noted by Zooba, you can then call ol.ToList() to get a List 于 2008-08-09T03:07:44.337 回答 This answer is useful 14 You cannot cast between generic types with different type parameters. Specialized generic types don't form part of the same inheritance tree and so are unrelated types. To do this pre-NET 3.5: List<string> sl = new List<string>(); // Add strings to sl List<object> ol = new List<object>(); foreach(string s in sl) { ol.Add((object)s); // The cast is performed implicitly even if omitted } Using Linq: var sl = new List<string>(); // Add strings to sl var ol = new List<object>(sl.Cast<object>()); // OR var ol = sl.Cast<object>().ToList(); // OR (note that the cast to object here is required) var ol = sl.Select(s => (object)s).ToList(); 于 2008-08-10T11:54:37.673 回答 This answer is useful 11 原因是，在大多数情况下，类似的泛型类List<>在外部被视为普通类。例如，当您说List<string>()编译器说ListString()（其中包含字符串）时。[技术人员：这是正在发生的事情的非常简单的英语版本] 因此，显然编译器不能足够聪明地通过转换其内部集合的项目来将 ListString 转换为 ListObject。 这就是为什么有像 Convert() 这样的 IEnumerable 扩展方法，它允许您轻松地为存储在集合中的项目提供转换，这可以像从一个转换到另一个一样简单。 于 2008-08-09T02:38:02.883 回答 This answer is useful 6 This has a lot to do with covariance, e.g., generic types are considered as parameters, and if the parameters do not resolve properly to a more specific type then the operation fails. The implication of such is that you really cannot cast to a more general type like object. And as stated by Rex, the List object won't convert each object for you. You might want to try the ff code instead: List<string> sl = new List<string>(); //populate sl List<object> ol = new List<object>(sl); or: List<object> ol = new List<object>(); ol.AddRange(sl); ol will (theoretically) copy all the contents of sl without problems. 于 2008-08-09T02:58:26.463 回答 This answer is useful 5 Yes, you can, from .NET 3.5: List<string> sl = new List<string>(); List<object> ol = sl.Cast<object>().ToList(); 于 2008-10-18T20:26:02.400 回答 This answer is useful 3 Mike - I believe contravariance isn't allowed in C# either See Generic type parameter variance in the CLR for some more info. 于 2008-08-09T02:53:18.237 回答 This answer is useful 2 I think that this (contravariance) will actually be supported in C# 4.0\. http://blogs.msdn.com/charlie/archive/2008/10/27/linq-farm-covariance-and-contravariance-in-visual-studio-2010.aspx 于 2008-11-07T19:01:21.417 回答 This answer is useful 1 That's actually so that you don't try to put any odd "object" in your "ol" list variant (as List<object> would seem to allow) - because your code would crash then (because the list really is List<string> and will only accept String type objects). That's why you can't cast your variable to a more general specification. On Java it's the other way around, you don't have generics, and instead everything is List of object at runtime, and you really can stuff any strange object in your supposedly-strictly typed List. Search for "Reified generics" to see a wider discussion of java's problem... 于 2008-08-10T14:35:48.940 回答 This answer is useful 1 Such covariance on generics is not supported, but you can actually do this with arrays: object[] a = new string[] {"spam", "eggs"}; C# performs runtime checks to prevent you from putting, say, an int into a. 于 2008-10-09T21:54:25.877 回答 This answer is useful 0 Here is another pre-.NET 3.5 solution for any IList whose contents can be cast implicitly. public IList<B> ConvertIList<D, B>(IList<D> list) where D : B { List<B> newList = new List<B>(); foreach (D item in list) { newList.Add(item); } return newList; } (Based on Zooba's example) 于 2009-06-08T16:34:54.520 回答 This answer is useful 0 I have a: private List<Leerling> Leerlingen = new List<Leerling>(); And I was going to fill it with data collected in an List<object> What finally worked for me was this one: Leerlingen = (List<Leerling>)_DeserialiseerLeerlingen._TeSerialiserenObjecten.Cast<Leerling>(); .Cast it to the type you want to get an IEnumerable from that type, then typecast the IEnemuerable to the List<> you want. 于 2009-10-15T09:41:08.887 回答 This answer is useful 0 Mm, thanks to previous comments I found two ways to find it out. The first one is getting the string list of elements and then casting it to IEnumerable object list: IEnumerable<object> ob; List<string> st = new List<string>(); ob = st.Cast<object>(); And the second one is avoiding the IEnumerable object type, just casting the string to object type and then using the function "toList()" in the same sentence: List<string> st = new List<string>(); List<object> ob = st.Cast<object>().ToList(); I like more the second way. I hope this helps. 于 2016-03-17T21:38:26.597 回答 This answer is useful 0 List<string> sl = new List<string>(); List<object> ol; ol = new List<object>(sl); 于 2017-04-27T09:52:30.337 回答 Related 0 css - -webkit-transform height 正在改变移动 safari 上的视口 1 mercurial - hg起来 不更改为命名分支 1 javascript - 获取xml节点文本 1 c# - 如何将事件从外观附加到另一个类 1 windows - 使用 node.js 安装光纤时找不到模块 build.js 2 android - 如何将另一个表中的数据链接到当前表 [Android] 1 .net - typeperf 报告的内容与其他所有工具（mem profiler、process explorer、full dump）之间的差异 1 git - 即使使用 -f 添加目录时也会忽略目录中的某些文件 5 c++ - 在声明 C++ 之后初始化 const 变量 4 java - Spring JDBC 事务管理器 Reference php × 1429865 c/c++ × 756500 nginx × 49975 mongodb × 159057 mybatis × 3233 anaconda × 13410 pycharm × 14671 python × 1902243 vscode × 56040 docker × 110988 github × 49000 flask × 49129 ffmpeg × 24037 jmeter × 16910 matplotlib × 63493 bootstrap × 54641

> ID：6557
> 
> 赞同：86
> 
> 时间：
> 
> 标签：c#, .net, generics, covariance, type-safety

It seems that a List object cannot be stored in a List variable in C#, and can't even be explicitly cast that way.

```
List<string> sl = new List<string>();
List<object> ol;
ol = sl; 
```

results in Cannot implicitly convert type `System.Collections.Generic.List<string>` to `System.Collections.Generic.List<object>`

And then...

```
List<string> sl = new List<string>();
List<object> ol;
ol = (List<object>)sl; 
```

results in Cannot convert type `System.Collections.Generic.List<string>` to `System.Collections.Generic.List<object>`

Of course, you can do it by pulling everything out of the string list and putting it back in one at a time, but it is a rather convoluted solution.

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-08-09T02:50:14.903

Think of it this way, if you were to do such a cast, and then add an object of type Foo to the list, the list of strings is no longer consistent. If you were to iterate the first reference, you would get a class cast exception because once you hit the Foo instance, the Foo could not be converted to string!

As a side note, I think it would be more significant whether or not you can do the reverse cast:

```
List<object> ol = new List<object>();
List<string> sl;
sl = (List<string>)ol; 
```

I haven't used C# in a while, so I don't know if that is legal, but that sort of cast is actually (potentially) useful. In this case, you are going from a more general class (object) to a more specific class (string) that extends from the general one. In this way, if you add to the list of strings, you are not violating the list of objects.

Does anybody know or can test if such a cast is legal in C#?

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-08-09T03:07:44.337

If you're using .NET 3.5 have a look at the Enumerable.Cast method. It's an extension method so you can call it directly on the List.

```
List<string> sl = new List<string>();
IEnumerable<object> ol;
ol = sl.Cast<object>(); 
```

It's not exactly what you asked for but should do the trick.

Edit: As noted by Zooba, you can then call ol.ToList() to get a List

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-08-10T11:54:37.673

You cannot cast between generic types with different type parameters. Specialized generic types don't form part of the same inheritance tree and so are unrelated types.

To do this pre-NET 3.5:

```
List<string> sl = new List<string>();
// Add strings to sl

List<object> ol = new List<object>();

foreach(string s in sl)
{
    ol.Add((object)s);  // The cast is performed implicitly even if omitted
} 
```

Using Linq:

```
var sl = new List<string>();
// Add strings to sl

var ol = new List<object>(sl.Cast<object>());

// OR
var ol = sl.Cast<object>().ToList();

// OR (note that the cast to object here is required)
var ol = sl.Select(s => (object)s).ToList(); 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-08-09T02:38:02.883

原因是，在大多数情况下，类似的泛型类`List<>`在外部被视为普通类。例如，当您说`List<string>()`编译器说`ListString()`（其中包含字符串）时。[技术人员：这是正在发生的事情的非常简单的英语版本]

因此，显然编译器不能足够聪明地通过转换其内部集合的项目来将 ListString 转换为 ListObject。

这就是为什么有像 Convert() 这样的 IEnumerable 扩展方法，它允许您轻松地为存储在集合中的项目提供转换，这可以像从一个转换到另一个一样简单。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-08-09T02:58:26.463

This has a lot to do with covariance, e.g., generic types are considered as parameters, and if the parameters do not resolve properly to a more specific type then the operation fails. The implication of such is that you really cannot cast to a more general type like object. And as stated by Rex, the List object won't convert each object for you.

You might want to try the ff code instead:

```
List<string> sl = new List<string>();
//populate sl
List<object> ol = new List<object>(sl); 
```

or:

```
List<object> ol = new List<object>();
ol.AddRange(sl); 
```

ol will (theoretically) copy all the contents of sl without problems.

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2008-10-18T20:26:02.400

Yes, you can, from .NET 3.5:

```
List<string> sl = new List<string>();
List<object> ol = sl.Cast<object>().ToList(); 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-08-09T02:53:18.237

Mike - I believe contravariance isn't allowed in C# either

See [Generic type parameter variance in the CLR](http://blogs.msdn.com/rmbyers/archive/2005/02/16/375079.aspx) for some more info.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-11-07T19:01:21.417

I think that this (contravariance) will actually be supported in C# 4.0. [http://blogs.msdn.com/charlie/archive/2008/10/27/linq-farm-covariance-and-contravariance-in-visual-studio-2010.aspx](http://blogs.msdn.com/charlie/archive/2008/10/27/linq-farm-covariance-and-contravariance-in-visual-studio-2010.aspx)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-10T14:35:48.940

That's actually so that you don't try to put any odd "object" in your "ol" list variant (as `List<object>` would seem to allow) - because your code would crash then (because the list really is `List<string>` and will only accept String type objects). That's why you can't cast your variable to a more general specification.

On Java it's the other way around, you don't have generics, and instead everything is List of object at runtime, and you really can stuff any strange object in your supposedly-strictly typed List. Search for "Reified generics" to see a wider discussion of java's problem...

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-09T21:54:25.877

Such covariance on generics is not supported, but you can actually do this with arrays:

```
object[] a = new string[] {"spam", "eggs"}; 
```

C# performs runtime checks to prevent you from putting, say, an `int` into `a`.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-06-08T16:34:54.520

Here is another pre-.NET 3.5 solution for any IList whose contents can be cast implicitly.

```
public IList<B> ConvertIList<D, B>(IList<D> list) where D : B
{
    List<B> newList = new List<B>();

    foreach (D item in list)
    {
        newList.Add(item);
    }

    return newList;
} 
```

(Based on Zooba's example)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-10-15T09:41:08.887

I have a:

```
private List<Leerling> Leerlingen = new List<Leerling>(); 
```

And I was going to fill it with data collected in an `List<object>` What finally worked for me was this one:

```
Leerlingen = (List<Leerling>)_DeserialiseerLeerlingen._TeSerialiserenObjecten.Cast<Leerling>(); 
```

`.Cast` it to the type you want to get an `IEnumerable` from that type, then typecast the `IEnemuerable` to the `List<>` you want.

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2016-03-17T21:38:26.597

Mm, thanks to previous comments I found two ways to find it out. The first one is getting the string list of elements and then casting it to IEnumerable object list:

```
IEnumerable<object> ob;
List<string> st = new List<string>();
ob = st.Cast<object>(); 
```

And the second one is avoiding the IEnumerable object type, just casting the string to object type and then using the function "toList()" in the same sentence:

```
List<string> st = new List<string>();
List<object> ob = st.Cast<object>().ToList(); 
```

I like more the second way. I hope this helps.

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-04-27T09:52:30.337

```
List<string> sl = new List<string>();
List<object> ol;
ol = new List<object>(sl); 
```

# iphone - 使用 Cocoa 和 Objective-C 理解引用计数

> ID：6578
> 
> 赞同：123
> 
> 时间：2008-08-09T03:13:04.000
> 
> 标签：iphone, objective-c, cocoa, memory

我刚刚开始研究 Objective-C 和 Cocoa，以便使用 iPhone SDK。我对 C`malloc`和`free`概念相当满意，但 Cocoa 的引用计数方案让我很困惑。有人告诉我，一旦你理解它，它就非常优雅，但我还没有完全理解它。

和如何`release`工作以及它们的使用约定是什么？`retain``autorelease`

（或者失败了，你读到了什么帮助你得到它？）

* * *

## 回答 #1

> 赞同：149
> 
> 时间：2008-08-09T04:40:49.250

让我们从`retain`和开始`release`；`autorelease`一旦您了解了基本概念，这实际上只是一个特例。

在 Cocoa 中，每个对象都会跟踪它被引用的次数（具体来说，`NSObject`基类实现了这一点）。通过调用`retain`一个对象，你是在告诉它你想将它的引用计数加一。通过调用`release`，您告诉对象您正在释放它，并且它的引用计数递减。如果在调用 之后`release`，引用计数现在为零，则系统会释放该对象的内存。

`malloc`与此不同的基本方式`free`是任何给定对象都不需要担心系统的其他部分崩溃，因为您已经释放了它们正在使用的内存。假设每个人都在按照规则进行保留/释放，当一段代码保留然后释放对象时，任何其他引用该对象的代码都不会受到影响。

有时可能令人困惑的是知道在什么情况下应该调用`retain`and `release`。我的一般经验法则是，如果我想在某个对象上挂起一段时间（例如，如果它是类中的成员变量），那么我需要确保对象的引用计数知道我。如上所述，对象的引用计数通过调用`retain`. 按照惯例，当使用“init”方法创建对象时，它也会增加（实际上设置为 1）。在这两种情况下，我有责任在`release`完成后调用该对象。如果我不这样做，就会有内存泄漏。

对象创建示例：

```
NSString* s = [[NSString alloc] init];  // Ref count is 1
[s retain];                             // Ref count is 2 - silly
                                        //   to do this after init
[s release];                            // Ref count is back to 1
[s release];                            // Ref count is 0, object is freed 
```

现在为`autorelease`. 自动释放被用作一种方便（有时是必要的）方法来告诉系统在一段时间后释放这个对象。从管道的角度来看，当`autorelease`被调用时，当前线程`NSAutoreleasePool`会收到调用警报。现在`NSAutoreleasePool`知道一旦它获得机会（在事件循环的当前迭代之后），它就可以调用`release`该对象。从我们作为程序员的角度来看，它负责调用`release`我们，所以我们不必（事实上，我们不应该）。

需要注意的重要一点是（再次按照惯例）所有对象创建*类*方法都返回一个自动释放的对象。例如，在下面的示例中，变量“s”的引用计数为 1，但在事件循环完成后，它将被销毁。

```
NSString* s = [NSString stringWithString:@"Hello World"]; 
```

如果您想挂在该字符串上，则需要`retain`显式调用，然后`release`在完成后显式调用。

考虑以下（非常人为的）代码，您会看到需要的情况`autorelease`：

```
- (NSString*)createHelloWorldString
{
    NSString* s = [[NSString alloc] initWithString:@"Hello World"];

    // Now what?  We want to return s, but we've upped its reference count.
    // The caller shouldn't be responsible for releasing it, since we're the
    // ones that created it.  If we call release, however, the reference 
    // count will hit zero and bad memory will be returned to the caller.  
    // The answer is to call autorelease before returning the string.  By 
    // explicitly calling autorelease, we pass the responsibility for
    // releasing the string on to the thread's NSAutoreleasePool, which will
    // happen at some later time.  The consequence is that the returned string 
    // will still be valid for the caller of this function.
    return [s autorelease];
} 
```

我意识到这一切有点令人困惑——不过，在某些时候，它会点击。这里有一些参考资料可以帮助您：

*   [Apple](http://developer.apple.com/library/mac/#documentation/Cocoa/Conceptual/MemoryMgmt/Articles/MemoryMgmt.html "苹果介绍 Cocoa 的内存管理")对内存管理的介绍。
*   [Cocoa Programming for Mac OS X (4th Edition)](https://rads.stackoverflow.com/amzn/click/com/0321774086)，作者 Aaron Hillegas - 一本写得很好的书，里面有很多很好的例子。它读起来像一个教程。
*   如果您真的想潜入水中，您可以前往[Big Nerd Ranch](http://www.bignerdranch.com/ "大书呆子牧场")。这是由上述书籍的作者 Aaron Hillegas 经营的培训机构。几年前我参加了可可介绍课程，这是一种很好的学习方式。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-11T18:42:33.793

如果您了解保留/释放的过程，那么有两条黄金法则对于成熟的 Cocoa 程序员来说是显而易见的，但不幸的是，对于新手来说很少清楚地阐明这一点。

1.  如果返回对象的函数具有`alloc`,`create`或`copy`在其名称中，则该对象是您的。完成后必须打电话`[object release]`。或者`CFRelease(object)`，如果它是 Core-Foundation 对象。

2.  如果它的名称中没有这些词之一，则该对象属于其他人。`[object retain]`如果您希望在函数结束后保留​​对象，则必须调用。

在您自己创建的函数中也遵循此约定会很好。

（吹毛求疵者：是的，不幸的是，有一些 API 调用是这些规则的例外，但它们很少见）。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-08-09T22:27:12.860

如果您正在为桌面编写代码并且可以针对 Mac OS X 10.5，那么您至少应该考虑使用 Objective-C 垃圾收集。它确实会简化您的大部分开发工作——这就是为什么 Apple 首先投入所有精力来创建它，并使其表现良好。

至于不使用GC时的内存管理规则：

*   如果您使用`+alloc/+allocWithZone:`,或创建一个新对象`+new`，或者如果您是一个对象，您将获得它的所有权并且必须确保它被发送。`-copy``-mutableCopy``-retain``-release`
*   如果您以任何其他方式收到一个对象，您就*不是*它的所有者，*也不*应该确保它被发送`-release`。
*   如果您想确保发送对象，`-release`您可以自己发送，也可以发送对象`-autorelease`，当前*自动释放池*将在池耗尽时发送它`-release`（每次接收一次）。`-autorelease`

通常`-autorelease`用作确保对象在当前事件的长度内存活的一种方式，但之后会被清理，因为围绕 Cocoa 的事​​件处理有一个自动释放池。在 Cocoa 中，将自动释放的对象返回给调用者比返回调用者本身需要释放的对象要常见得多*。*

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-08-09T03:48:10.417

Objective-C 使用[引用计数](http://en.wikipedia.org/wiki/Reference_counting)，这意味着每个对象都有一个引用计数。创建对象时，它的引用计数为“1”。简单地说，当一个对象被引用（即存储在某个地方）时，它会被“保留”，这意味着它的引用计数会增加一。当不再需要一个对象时，它被“释放”，这意味着它的引用计数减一。

当对象的引用计数为 0 时，该对象被释放。这是基本的引用计数。

对于某些语言，引用会自动增加和减少，但objective-c 不是这些语言之一。因此程序员负责保留和释放。

编写方法的典型方式是：

```
id myVar = [someObject someMessage];
.... do something ....;
[myVar release];
return someValue; 
```

需要记住在代码中释放任何获取的资源的问题既乏味又容易出错。Objective-C 引入了另一个旨在使这变得更容易的概念：自动释放池。自动释放池是安装在每个线程上的特殊对象。如果您查看 NSAutoreleasePool，它们是一个相当简单的类。

当一个对象收到发送给它的“自动释放”消息时，该对象将查找位于当前线程堆栈上的任何自动释放池。它会将对象作为对象添加到列表中，以在将来的某个时间向其发送“释放”消息，这通常是在池本身被释放时。

使用上面的代码，您可以通过以下方式将其重写为更短且更易于阅读：

```
id myVar = [[someObject someMessage] autorelease];
... do something ...;
return someValue; 
```

因为对象是自动释放的，我们不再需要显式调用它的“释放”。这是因为我们知道一些自动释放池稍后会为我们做这件事。

希望这会有所帮助。维基百科的文章关于引用计数非常好。更多关于[自动释放池的信息可以在这里找到](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Concepts/AutoreleasePools.html)。另请注意，如果您正在为 Mac OS X 10.5 及更高版本构建，您可以告诉 Xcode 在启用垃圾收集的情况下构建，从而允许您完全忽略保留/释放/自动释放。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-08-09T03:59:35.683

Joshua (#6591) - Mac OS X 10.5 中的垃圾收集功能看起来很酷，但不适用于 iPhone（或者如果您希望您的应用程序在 Mac OS X 10.5 之前的版本上运行）。

此外，如果您正在编写一个库或可能被重用的东西，使用 GC 模式会锁定任何使用代码的人也使用 GC 模式，所以据我了解，任何试图编写广泛可重用代码的人都倾向于去管理手动记忆。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-10-20T00:42:12.933

与以往一样，当人们开始尝试重新编写参考资料时，他们几乎总是会出错或提供不完整的描述。

[Apple 在Memory Management Programming Guide for Cocoa](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/MemoryMgmt.html#//apple_ref/doc/uid/10000011)中对 Cocoa 的内存管理系统进行了完整的描述，最后对[内存管理规则](http://developer.apple.com/documentation/Cocoa/Conceptual/MemoryMgmt/Tasks/MemoryManagementRules.html#//apple_ref/doc/uid/20000994)进行了简短而准确的总结。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-19T20:04:07.550

除了您可能想考虑花 50 美元购买 Hillegass 书之外，我不会添加保留/释放的具体内容，但我强烈建议您在应用程序开发的早期就开始使用 Instruments 工具（甚至是您的第一！）。为此，运行-> 使用性能工具开始。我将从 Leaks 开始，它只是众多可用工具中的一种，但它有助于在您忘记释放时向您展示。您将看到多少信息不再令人生畏。但是请查看本教程以快速入门：
[COCOA 教程：使用仪器修复内存泄漏](http://www.cimgf.com/2008/04/02/cocoa-tutorial-fixing-memory-leaks-with-instruments)

实际上，尝试*强制*泄漏可能是学习如何防止泄漏的更好方法！祝你好运 ;）

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2008-08-09T13:48:50.283

> [马特迪拉德写道](https://stackoverflow.com/questions/6578/understanding-reference-counting-with-cocoa-objective-c#6614)：
> 
> 返回 [[s autorelease] 释放];

自动释放不*保留*对象。Autorelease 只是将它放入队列中，以便稍后发布。你不想在那里有发布声明。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-01-10T10:59:03.407

我平时收集的 Cocoa 内存管理文章：

[可可内存管理](http://iamleeg.blogspot.com/2008/12/cocoa-memory-management.html)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-08-09T04:25:46.537

NilObject 的回答是一个好的开始。这里有一些关于手动内存管理的补充信息（*iPhone 需要*）。

如果您个人`alloc/init`使用一个对象，它的引用计数为 1。当不再需要它时，您负责清理它，方法是调用`[foo release]`或`[foo autorelease]`. release 会立即清理它，而 autorelease 会将对象添加到自动释放池中，稍后会自动释放它。

autorelease 主要用于当您有一个需要返回相关对象的方法时（*因此您不能手动释放它，否则您将返回一个 nil 对象*）但您也不想持有它.

如果你获取了一个没有调用 alloc/init 来获取它的对象——例如：

```
foo = [NSString stringWithString:@"hello"]; 
```

但是你想挂在这个对象上，你需要调用[foo retain]。否则，它可能会得到`autoreleased`并且您将持有一个 nil 引用*（就像在上面的`stringWithString`示例*中那样）。当您不再需要它时，调用`[foo release]`.

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-12-08T11:00:52.243

iDeveloperTV Network 提供免费的截屏视频

[Objective-C 中的内存管理](http://ideveloper.tv/freevideo/details?index=17012088)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-11-06T03:55:38.047

上面的答案清楚地重述了文档所说的内容；大多数新人遇到的问题是无证案件。例如：

*   **Autorelease**：文档说它将在“未来的某个时候”触发发布。什么时候？！基本上，在您将代码退出回系统事件循环之前，您可以依靠该对象。系统可以在当前事件循环之后的任何时间释放对象。（我认为马特早些时候说过。）

*   **静态字符串**：`NSString *foo = @"bar";`——你必须保留还是释放它？不，怎么样

    ```
    -(void)getBar {
        return @"bar";
    } 
    ```

    ...

    ```
    NSString *foo = [self getBar]; // still no need to retain or release 
    ```

*   **创建规则**：如果你创建了它，你就拥有它，并期望发布它。

一般来说，新 Cocoa 程序员搞砸的方式是不了解哪些例程返回带有`retainCount > 0`.

[这是Cocoa 中非常简单的内存管理规则](http://www.stepwise.com/Articles/Technical/2001-03-11.01.html)的片段：

> *保留计数规则*
> 
> *   在给定块内，-copy、-alloc 和 -retain 的使用应该与 -release 和 -autorelease 的使用相同。
> *   使用便利构造函数（例如 NSString 的 stringWithString）创建的对象被认为是自动释放的。
> *   实现一个 -dealloc 方法来释放你拥有的实例变量

第一个项目符号说：如果您调用`alloc`（或`new fooCopy`），则需要对该对象调用 release。

第二个要点说：如果您使用便利构造函数*并且需要对象挂起*（如稍后要绘制的图像），则需要保留（然后释放）它。

第三个应该是不言自明的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-15T20:46:23.170

也有很多关于 cocoadev 的好信息：

*   [内存管理](http://www.cocoadev.com/index.pl?MemoryManagement)
*   [经验法则](http://www.cocoadev.com/index.pl?RulesOfThumb)

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-02-06T03:01:11.857

正如一些人已经提到的，Apple 的[内存管理简介](http://developer.apple.com/mac/library/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/mmPractical.html)是迄今为止最好的起点。

我还没有提到的一个有用的链接是[Practical Memory Management](http://developer.apple.com/mac/library/documentation/Cocoa/Conceptual/MemoryMgmt/Articles/mmPractical.html)。如果您通读它们，您会在 Apple 文档的中间找到它，但值得直接链接。这是内存管理规则的精彩执行摘要，其中包含示例和常见错误（基本上这里的其他答案试图解释，但不是很好）。

# methods - 您使用哪种敏捷软件开发方法最成功？

> ID：6579
> 
> 赞同：3
> 
> 时间：2008-08-09T03:19:59.117
> 
> 标签：methods, agile

有许多[敏捷软件开发](http://en.wikipedia.org/wiki/Agile_software_development)方法。您在实践中使用了哪些方法来交付成功的项目，该方法对成功有何贡献？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-08-09T03:39:44.600

我曾参与过不少声称以“敏捷”方式工作的组织，它们的处理通常似乎基于 XP（极限编程），但它们都没有遵循所有实践。

也就是说，我可能可以评论一些 XP 实践

*   **如果从项目开始就进行单元测试**，它似乎非常有用，但是进入现有代码库并开始尝试添加单元测试似乎非常困难。如果您有机会从头开始，测试驱动开发将是真正的帮助。

*   **持续集成**似乎是一件非常好的事情（或者更确切地说，缺乏它真的很糟糕）。也就是说，我所见过的组织通常都很小，以至于任何其他方法都显得愚蠢。

*   **用户故事卡**很好，因为有一个物理对象可以用来确定优先级，但它们不够详细，除非您的开发人员真正了解该领域，或者您有现场客户（我从来没有实际见过）。

*   **站立会议**对于新团队成员了解每个人以及他们的工作内容往往非常有用。老手很快就放松了，只说“我还在做 X”之类的话，他们过去一周一直在做这些事情——需要一个强大的领导者来迫使他们深入研究细节。

*   **重构**现在是一个真正被滥用的术语，但是当你有足够的单元测试时，从概念上将“更改现有代码的设计而不更改功能”与“添加新功能”的活动分开是非常有用的

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-09T03:21:59.923

Scrum 因为它显示了懒惰者的位置。它还可以更快地识别业务部门通常不知道他们真正想要交付什么

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-09T04:52:54.610

Scrum。

每日站立会议是确保事情保持正常并取得进展的好方法。我还认为让产品/市场人员以真实、有意义的方式参与到流程中是关键。它将创建一个更具协作性的环境，并消除当产品团队和开发团队是独立的“孤岛”时出现的大量对抗性垃圾。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-24T21:59:07.153

定期回顾是帮助团队变得更加有效/敏捷的好方法。这种做法不仅可以坚持特定的敏捷风格，还可以帮助团队确定哪些方面运作良好并适应不断变化的环境。

只要确保进行回顾的人知道他/她在做什么，否则它可能会退化为抱怨会议。

您可以带领团队进行许多练习，以帮助他们从回顾中反思和提取价值。我建议收听软件工程电台对[Linda Rising的采访，以获得很好的介绍。](http://www.se-radio.net/podcast/2008-07/episode-105-retrospectives-linda-rising)

在 Google 上搜索“心跳回顾”以获取更多信息。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-28T23:08:40.450

我一直在与一个使用 XP 和 Scrum 实践并带有一些精益的团队合作。这是非常有成效的。

**Daily Standup** - 帮助我们完整跟踪每个人的工作内容和位置。

**结对编程**- 改进了我们的代码库并帮助消除了被引入系统的“愚蠢”错误。

**迭代开发**- 使用 1 周的迭代通过设置更直接的目标来帮助提高我们的速度，这也有助于我们调整规模要求

**TDD** - 帮助我改变了我的编程方式，现在我不会编写任何不能修复损坏测试的代码，也不会编写任何没有明确定义要求的测试。我们还一直在使用可执行需求，这确实帮助开发人员和 BA 达成需求理解。

**看板**- 实时显示我们的位置。我们有一个里程碑和当前迭代。一目了然，您可以看到剩下的事情，正在做的事情，以及已经完成和接受的事情。如果你没有在日常站立中报告与你需要解释的黑板上的内容有关的事情。

**同一地点的团队**——每个人都跟上其他人正在做的事情。沟通及时，效率很高，我一点也不想念我的立方体。

# php - PHP4 到 PHP5 迁移

> ID：6594
> 
> 赞同：11
> 
> 时间：2008-08-09T03:49:36.017
> 
> 标签：php, migration

从 PHP4 到 PHP5 的顺利迁移需要遵循哪些好的步骤。哪些类型的代码可能会被破坏？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-08-09T04:44:49.710

我也曾经开发过一个应用程序，该应用程序大量使用 PHP4 的 XML 支持，并且需要大量工作才能迁移到 PHP5。

我当时看到的其他重大变化之一是函数参数的默认处理方式的变化。如果我记得的话，在 PHP4 中，除非您另外指定，否则它们是按副本传递的，但在 PHP5 中默认更改为按引用传递。在编写良好的代码中，这可能不会对您产生太大影响，但它肯定会导致问题。

我认为我发现改变的另一件事是不再允许对象覆盖其“this”字段。我会说一开始这是一个非常糟糕的主意（而且我认为它可能不是 PHP4 中的有意特性），但我确实发现我们系统的一些部分依赖它。

希望其中一些有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-09T05:00:11.927

我能给任何使用 PHP4 的人最好的建议是：

```
error_reporting( E_ALL ); 
```

它几乎会告诉你你需要做什么。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-09T04:12:31.290

我们有一个严重依赖 PHP 4 XML DOM 函数的应用程序，它需要进行大量的重组才能改变 PHP 5。

除此之外，大多数更改是对错误处理（利用异常）和 PHP 类等方面的改进。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-21T16:18:59.930

OOP 是最大的差异之一。它不会中断，因为 PHP4 和 PHP5 OOP 样式可以互换，但我建议利用 PHP5 的新 OOP 样式。将现有的类转换为 PHP5 的工作量并不大，它确实为您提供了一些额外的神奇方法，可以帮助解决一些现有的 hack（我记得在大多数类中都有一个几乎没用的 __toString 等效方法）。

# windows - 用于存储用户可配置应用程序设置的注册表与 INI 文件

> ID：6607
> 
> 赞同：53
> 
> 时间：2008-08-09T04:13:02.740
> 
> 标签：windows, registry, settings, configuration-files, ini

我是一个新的 Windows 程序员，我不确定我应该在哪里存储用户可配置的应用程序设置。我了解需要为用户提供一种用户友好的方式来更改应用程序设置，例如 Edit | 设置表格或类似的。但是，在用户点击该表单上的“应用”按钮后，我应该将值存储在哪里？

在 Windows 注册表中存储设置与将它们存储在本地 INI 文件或配置文件或类似文件中的优缺点是什么？

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-08-09T04:51:59.773

**配置文件的优点：**

1.  很容易做到。不需要知道任何 Windows API 调用。你只需要知道你的编程语言的文件 I/O 接口。
2.  便携的。如果您将应用程序移植到另一个操作系统，则无需更改设置格式。
3.  用户可编辑。用户可以在程序执行之外编辑配置文件。

**注册表的优点：**

1.  安全的。除非他/她知道 regedit，否则用户不会意外删除配置文件或损坏数据。然后用户只是在自找麻烦。
2.  我不是专业的 Windows 程序员，但我确信使用注册表可以更轻松地执行其他 Windows 特定的事情（用户特定的设置、网络管理的东西，如组策略或其他任何东西）。

如果您只需要一种简单的方式来存储配置信息，我会推荐一个配置文件，使用 INI 或 XML 作为格式。我建议仅在您想摆脱使用注册表的特定内容时才使用注册表。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2008-10-11T01:11:39.697

Jeff Atwood 有一篇很棒的[文章](http://www.codinghorror.com/blog/archives/000939.html)，介绍了 Windows 的注册表以及为什么改用 .INI 文件更好。

> 如果将每个应用程序的设置存储在一个我可以轻松查看、操作和备份它们的地方，我的生活会轻松很多。比如说……在 INI 文件中。
> 
> *   注册表是**单点故障**。这就是为什么你会发现每一个注册表编辑技巧都以一个关于如何用 regedit 破坏你的计算机的大肥尖叫免责声明开始的原因。
> *   注册表是**不透明的和二进制**的。尽管我不喜欢尖括号税，但至少 XML 配置文件是合理的人类可读的，并且它们允许尽可能多的评论。
> *   注册表必须**与文件系统同步**。删除一个应用程序而不“卸载”它，你就会留下陈旧的注册表。或者，如果应用程序的卸载程序编写不佳。文件系统不再是记录声明——它必须以某种方式与注册表保持同步。这完全违反了 DRY 原则。
> *   注册表是**单片**的。假设您想将应用程序移动到机器上的不同路径，甚至完全移动到不同的机器上。祝您好运，从巨大的注册表 tarball 中提取该特定应用程序的相关设置。一个给定的应用程序通常在注册表中散布着几十个设置。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-08-24T14:41:15.243

在注册表中使用 INI 文件还有一个我没有提到的优势：如果用户使用某种基于卷/文件的加密，他们可以很容易地对 INI 文件进行加密。使用注册表可能会出现更多问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-09T04:54:24.090

根据[GetPrivateProfileString](http://msdn.microsoft.com/en-us/library/ms724353.aspx)的文档，您应该使用注册表来存储初始化信息。

但是，话虽如此，如果您仍想使用 .ini 文件，并使用标准配置文件 API（`GetPrivateProfileString`、`WritePrivateProfileString`等）来访问它们，它们提供了自动提供由支持的“虚拟 .ini 文件”的内置方法注册表。双赢！

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-08-09T13:03:06.803

[这里](http://bytes.com/forum/thread48133.html)有一个类似的问题，涵盖了一些优点和缺点。

我建议不要使用注册表，除非您的应用程序绝对需要它。据我了解，由于设置文件的灵活性，微软正试图阻止使用注册表。此外，我不建议使用 .ini 文件，而是使用 .Net 的一些[内置功能](http://msdn.microsoft.com/en-us/library/k4s6c3a0.aspx)来保存用户/应用程序设置。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-10-11T02:14:16.200

使用与应用程序位于同一目录中的 ini 文件，可以将其与应用程序一起备份。因此，在您重新加载操作系统后，您只需恢复应用程序目录，就可以按照您想要的方式进行配置。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-08-09T13:13:39.623

我同意丹尼尔。如果它是一个大型应用程序，我想我会在注册表中做一些事情。如果它是一个小型应用程序，并且您希望在不制作配置表单的情况下使其某些方面可由用户配置，请快速获取 INI 文件。

我通常是这样解析的（如果.ini文件中的格式是option = value，每行1个，注释以#开头）：

```
static void Parse()
{
    StreamReader tr = new StreamReader("config.ini");
    string line;
    Dictionary<string, string> config = new Dictionary<string, string>();

    while ((line = tr.ReadLine()) != null)
    {
        // Allow for comments and empty lines.
        if (line == "" || line.StartsWith("#"))
            continue;

        string[] kvPair = line.Split('=');

        // Format must be option = value.
        if (kvPair.Length != 2)
            continue;

        // If the option already exists, it's overwritten.
        config[kvPair[0].Trim()] = kvPair[1].Trim();
    }
} 
```

编辑：对不起，我以为你已经指定了语言。上面的实现是在 C# 中。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-08-24T09:01:31.737

正如 Daniel 所指出的，将配置数据存储在注册表中可以让您选择使用管理模板。也就是说，您可以定义一个管理模板，在组策略中使用它并在网络范围内管理您的应用程序的配置。根据应用程序的性质，这可能是一个很大的好处。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2016-01-21T10:25:44.333

现有的答案涵盖了很多领域，但我想我会提到另一点。

我使用注册表来存储系统范围的设置。也就是说，当 2 个或更多程序需要完全相同的设置时。换句话说，多个程序共享的设置。

在所有其他情况下，我使用本地配置文件，该文件与可执行文件位于同一路径或下一层（在配置目录中）。其他答案已经涵盖了原因（便携式，可以使用文本编辑器进行编辑等）。

为什么要将系统范围的设置放入注册表？好吧，我发现如果一个设置是共享的，但你使用本地配置文件，你最终会复制设置。这可能意味着您最终需要在多个地方更改设置。

例如，假设 Program A 和 Program B 都指向同一个数据库。您可以为连接字符串设置“系统范围”的注册表设置。如果要指向不同的数据库，可以在一个地方更改连接字符串，两个程序现在都将针对另一个数据库运行。

注意 - 如果两个或多个程序不需要使用相同的值，那么以这种方式使用注册表是没有意义的。例如，程序 A 和程序 B 都需要一个***可能***相同但并非总是相同的数据库连接字符串。例如，我希望程序 B 现在使用测试数据库，但程序 A 应该继续使用生产数据库。

在上面的示例中，您可以有一些本地配置覆盖系统范围的设置，但对于简单的任务，它可能会开始变得过于复杂。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-11T01:40:20.713

注册表针对快速访问和轻松更新进行了优化，它是执行某些特定于 Windows 的操作（例如与扩展关联）的唯一方法。您可以忽略有关删除单个目录以卸载程序的论点 - Windows Vista 不允许您修改 Program Files 目录中的文件，因此您的配置无论如何都需要进入不同的文件夹。

Windows 编程有一个通用指南——按照微软期望的方式做事，你的生活会轻松很多。

也就是说，我可以看到 INI 文件的吸引力，我不会责怪任何人考虑它。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-01-27T02:52:35.103

ini 或配置文件有一个缺点，如果用户可以选择程序的安装位置，那就是定位它们。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-06-26T12:39:33.110

使用注册表的另一个缺点是，如果您在 32 位和 64 位应用程序的混合环境中工作，会很痛苦，因为访问注册表的系统调用会*随机*(*) 添加`\Wow6432Node\`到您的注册表路径中，让您在调试时发疯.

（*当然**不是**随机的，但是很容易迷路）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-06-03T09:41:06.947

好处：

*   大量配置文件的替换。
*   中心点的共同管理职能。
*   应用程序/驱动程序几乎可以保存任何数据。
*   与配置文件相比，甚至可以保存代码序列。
*   访问比文件快，因为数据库是索引的。
*   可以使用 RegMon 实用程序记录访问

缺点：

*   在没有图形配置程序的情况下难以使用。
*   使用注册表编辑器直接更改可能会产生不一致的状态。
*   不完整的卸载程序会在注册表中留下“回忆” 导致问题，例如新安装。
*   已安装的应用程序很难导出到其他 PC。
*   长期记录不佳。
*   专有结构，因此不适合标准 DB 访问（例如 SQL）
*   特定于计算机，因此不能移植到其他计算机。
*   注册表保护不足：取决于配置。

# java - 有没有像样的免费 Java 数据绘图库？

> ID：6612
> 
> 赞同：45
> 
> 时间：2008-08-09T04:29:42.190
> 
> 标签：java, plot, configuration

在最近的一个 Java 项目中，我们需要一个免费的基于 Java 的实时数据绘图实用程序。经过大量搜索，我们找到了来自 NOAA的名为[Scientific Graphics Toolkit 或 SGT的工具。](http://www.epic.noaa.gov/java/sgt/)它看起来相当健壮，但我们发现它的可配置性并不高。或者至少没有足够的可配置性来满足我们的需求。我们最终深入挖掘了 Java 代码并对代码进行了逆向工程并对其进行了全面更改，以使绘图工具的外观和行为符合我们希望它的外观和行为方式。当然，这扼杀了 NOAA 未来升级的任何机会。

那么，您使用哪些免费或廉价的基于 Java 的数据绘图工具或库？

*跟进：感谢[JFreeChart](http://www.jfree.org/jfreechart/)的建议。我查看了他们的网站，它看起来是一个非常不错的数据图表和绘图实用程序。我应该在我最初的问题中明确表示我正在专门寻找绘制实时数据。我更正了我上面的问题，以明确这一点。不过，JFreeChart 对实时数据的支持似乎[充其量是微不足道的](http://www.jfree.org/jfreechart/faq.html#FAQ5)。还有其他建议吗？*

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-08-09T06:23:19.140

我在多个项目中使用[JFreeChart取得了成功。](http://www.jfree.org/jfreechart/)它是*非常*可配置的。JFreeChart 是开源的，但它们对[开发者指南](http://www.jfree.org/jfreechart/devguide.html)收费。如果您正在做一些简单的事情，那么示例代码可能就足够了。否则，50 美元的开发人员指南是非常划算的。

关于“实时”数据，我也将 JFreeChart 用于这类应用程序。不幸的是，我不得不创建一些具有适当同步机制的自定义数据模型以避免竞争条件。然而，这并不是很困难，而且 JFreeChart 仍然是我的首选。但是，正如常见问题解答所建议的那样，如果这是一个大问题，JFreeChart 可能不会为您提供最佳性能。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-14T14:09:08.453

我刚刚遇到了一个类似的问题（出于工程目的显示快速更新的数据），我正在使用[JChart2D](http://jchart2d.sourceforge.net/docs/javadoc/index.html)。它非常简约，有一些怪癖，但看起来相当快：我正在运行基准速度测试，它每秒将 2331 个点（333x7 迹线）添加到条形图上，并在我的 3GHz Pentium 4 上使用 1% 的 CPU。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T08:33:32.873

[Live Graph](http://www.live-graph.org/)支持实时渲染。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-08-24T15:52:39.170

我正在使用[GRAL](http://trac.erichseifert.de/gral)进行实时绘图。这是一个 LGPL Java 库。尽管它不如 JFreeChart 强大，但它有一个更好的 API。我在很短的时间内完成了一个计划并开始运行。他们还发布了一个实时绘图示例。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-07T13:05:11.960

当我在谷歌上搜索 Java 的开源绘图库时，我发现了这个问题。我对这里发布的答案不太满意，所以我对这个问题做了一些进一步的研究。尽管这个问题早在 2008 年就已发布，但这对某些人来说可能仍然很有趣。

这是[Java 中的开源图表和报告工具列表](http://java-source.net/open-source/charting-and-reporting)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-23T14:19:14.747

我编写的库[Plot4j](http://www.softpedia.com/get/Programming/Components-Libraries/Plot4j.shtml)也支持实时绘图。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-06-29T16:09:58.613

[http://autoplot.org/](http://autoplot.org/)允许实时更新，并可用于创建多种类型的科学绘图。

要更新绘图，请指定数据文件的 URL，然后附加`&filePollUpdates=1&tail=100`. [请参阅http://autoplot.org/cookbook#Loading_Data](http://autoplot.org/cookbook#Loading_Data)中的示例

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-12-08T22:22:20.880

Waterloo Scientific Graphics 是一个新的 LGPL 项目。数据对象是可观察的，并且可以在实时绘图场景中更新。详情见[http://waterloo.sourceforge.net/](http://waterloo.sourceforge.net/)

几张截图：

![http://waterloo.sourceforge.net/images/AnatomyZ.png](https://i.stack.imgur.com/cSqxZ.png)

![http://waterloo.sourceforge.net/images/contour.png](https://i.stack.imgur.com/NjLsK.png)

![http://waterloo.sourceforge.net/images/errorbar.png](https://i.stack.imgur.com/m8ABZ.png)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-09T05:52:00.340

我在以前的项目中使用了 JFreeChart ( [http://www.jfree.org/jfreechart/ )。](http://www.jfree.org/jfreechart/)它具有一些非常好的内置功能，并且设计是可扩展的，因此如果您需要一些自定义图表注释或希望轴以不同方式呈现，或者其他什么，您可以随时滚动自己的扩展。绝对值得一试。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-09T07:41:29.310

我在一个需要可视化数据流和基于数据的计算的相当复杂的应用程序中使用了[JFreeChart 。](http://www.jfree.org/jfreechart/)我们实现了通过鼠标直观地编辑数据图的能力，并且拥有非常大的数据点集。JFreeChart 处理得很好。

不幸的是，我被 v0.7 卡住了，但在 API 清晰度方面，最新版本要好得多。社区非常有帮助，开发人员也在回复邮件。

如果您正在做一个网络应用程序并且不想打扰库，您可以查看[Google Chart API](http://code.google.com/apis/chart/)。我自己没有使用它，但我开始了一些非常有希望的测试。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-10-11T19:43:33.413

检查 ILOG 的[JViews](http://www.ilog.com/products/jviews/) - 他们有很多东西，有些东西可能适合您的需要。所有这些都非常可配置且速度非常快。虽然不是免费的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-06T14:11:08.253

对于实时绘图，您可以使用 QN Plot、JOpenChart 或其分支 Openchart2。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-06T14:38:21.380

JHandles 是 Octave 的替代图形包（一个数学包）。它可能值得研究，但特定于 Octave 可能没有你需要的东西。

-亚当

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-10-05T21:41:09.217

[PtPlot](http://ptolemy.berkeley.edu/java/ptplot/) 可能是一个不错的选择。以前称为托勒密。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-10-18T11:59:34.027

jcckit 可以处理实时绘图。不过，这是一只熊。

我分叉了它，并围绕它做了一个非常简单的包装器，用于非实时绘图。底层复杂的接口也可以直接使用。

[https://bitbucket.org/hughperkins/easyjcckit](https://bitbucket.org/hughperkins/easyjcckit)

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2009-12-10T14:35:50.363

您可能想查看 JMathPlot

# language-agnostic - 我应该使用什么规则引擎？

> ID：6613
> 
> 赞同：18
> 
> 时间：2008-08-09T04:34:29.467
> 
> 标签：language-agnostic, rule-engine

有哪些最好或最受欢迎的规则引擎？我还没有确定编程语言，所以告诉我规则引擎和它支持的编程语言。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-08-19T06:51:46.643

我是 Drools 的作者之一，我会避免拉皮条。

但是其他一些选项是 Jess（不是开源的），但使用剪辑语法（我们也支持其中的一个子集） - 这有点像 lisp 方言。

这真的取决于你想要它做什么，Haley 拥有强大的自然语言技术（他们最近收购了 RuleBurst - 他还拥有有趣的自然语言技术，可以处理带有嵌入规则的 word 文档 - 例如法律文档）。RuleBurst 也能够针对 .Net 运行时（也有一个 Drools.net “端口”可用 - 我最近还没有看到它在做什么，唉，时间不够用）。好的，我现在就把我的皮条客扔掉......对此感到抱歉。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-19T06:57:14.043

根据您的要求，[Windows Workflow Foundation](http://msdn.microsoft.com/en-us/netframework/aa663328.aspx) (.NET 3.5) 可能值得一看。

.NET 规则引擎[InRule](http://www.inrule.com/)支持 WF 和 BizTalk；不过没试过，不知道好不好用。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-09-16T21:08:21.377

这是 Martin Fowler 的一篇很棒的文章，它讨论了规则引擎何时有用。您可能会发现它很有帮助。

[http://martinfowler.com/bliki/RulesEngine.html](http://martinfowler.com/bliki/RulesEngine.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-09T05:01:10.910

我对 Haley 专家规则和 Haley 办公室规则都有一些经验。两个不错的系统，但我需要知道更多关于你想用它们来明确回答的信息（见[http://www.haley.com](http://www.haley.com)）

它们都支持 C# 和 Java（我认为也是一个 Web 服务 api）。

两者之间的区别主要在于您想要进入多少自然语言建模。Office 规则允许业务用户在 Office 文档中编写规则，并且主要关注立法要求建模。专家规则可以更灵活地定义它如何处理自然语言，但需要更多的工作来预先定义语言结构。

希望其中一些有所帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-12T16:59:31.647

我们已经使用了[http://jatha.sourceforge.net](http://jatha.sourceforge.net)和[http://www.jboss.com/products/rules](http://www.jboss.com/products/rules)。它们都非常好，但在大多数情况下，在我看来，JBoss 规则对于人们所做的很多事情来说都是矫枉过正的。它们都是基于 Java 的。

值得记住[Greenspun 的第十条编程规则](http://c2.com/cgi/wiki?GreenspunsTenthRuleOfProgramming)并直接导入它 :)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-12T17:20:41.993

我[检查了](http://dlinsin.blogspot.com/2006/11/jboss-rules-example.html)JBoss Rules aka Drools，它看起来很不错。我很想听听人们在生产中使用它的意见，因为我可能在我当前的项目中也需要一个规则引擎。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-15T20:58:15.243

Inrule[看到网站](http://www.inrule.com/)非常好！

它是一个基于 .NET 的规则引擎，具有可靠的 SDK 和面向非技术用户的漂亮 UI。过去对我很有用——几乎把我的开发成本降低了一半。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-10-21T23:13:28.207

我发现了另一个支持不同类型规则的规则引擎；程序、推理 (RETE) 和 FlowRule。这是一个非常灵活和可扩展的规则引擎（也是事件驱动的）。他们之前有免费版的快递版。

看看[http://www.flexrule.com](http://www.flexrule.com)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-01-14T21:29:23.093

对于非常容易理解的程序规则（如资格规则、保险规则、审计规则等），然后使用领域特定语言的简单决策表可以为您提供性能和简单性，而无需基于 RETE 的引擎的开销。

可以在[DTRules找到此类 Java 开源规则引擎](http://dtrules.com/wiki2/index.php?title=Main_Page)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-19T07:54:20.510

WF 已在 .net 3.0 中可用。尽管在 Visual Studio 的设计器端，它有点错误，并且可能会变得非常混乱。我在 Sharepoint 上使用它（WF 几乎是你唯一的选择），总的来说我对它非常满意，尽管学习曲线相当陡峭。

[Foundations of WF](http://www.apress.com/book/view/1590597184)是一本很好的入门书籍，因为它们从头到尾实现了一个完整的解决方案并解释了它背后的概念。

# c# - sgen.exe 在构建期间失败

> ID：6623
> 
> 赞同：16
> 
> 时间：2008-08-09T04:57:00.577
> 
> 标签：c#, visual-studio, msbuild

在更改了 Visual Studio 项目的输出目录后，它开始无法构建，并出现如下错误：

```
C:\Program Files\Microsoft Visual Studio 8\SDK\v2.0\bin\sgen.exe /assembly:C:\p4root\Zantaz\trunk\EASDiscovery\EASDiscoveryCaseManagement\obj\Release\EASDiscoveryCaseManagement.dll /proxytypes /reference:C:\p4root\Zantaz\trunk\EASDiscovery\EasDiscovery.Common\target\win_x32\release\results\EASDiscovery.Common.dll /reference:C:\p4root\Zantaz\trunk\EASDiscovery\EasDiscovery.Export\target\win_x32\release\results\EASDiscovery.Export.dll /reference:c:\p4root\Zantaz\trunk\EASDiscovery\ItemCache\target\win_x32\release\results\EasDiscovery.ItemCache.dll /reference:c:\p4root\Zantaz\trunk\EASDiscovery\RetrievalEngine\target\win_x32\release\results\EasDiscovery.RetrievalEngine.dll /reference:C:\p4root\Zantaz\trunk\EASDiscovery\EASDiscoveryJobs\target\win_x32\release\results\EASDiscoveryJobs.dll /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Shared.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.Misc.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.UltraWinChart.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.UltraWinDataSource.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.UltraWinDock.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.UltraWinEditors.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.UltraWinGrid.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.UltraWinListView.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.UltraWinMaskedEdit.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.UltraWinStatusBar.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.UltraWinTabControl.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.UltraWinToolbars.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.UltraWinTree.v8.1.dll" /reference:"C:\Program Files\Infragistics\NetAdvantage for .NET 2008 Vol. 1 CLR 2.0\Windows Forms\Bin\Infragistics2.Win.v8.1.dll" /reference:"C:\Program Files\Microsoft Visual Studio 8\ReportViewer\Microsoft.ReportViewer.Common.dll" /reference:"C:\Program Files\Microsoft Visual Studio 8\ReportViewer\Microsoft.ReportViewer.WinForms.dll" /reference:C:\p4root\Zantaz\trunk\EASDiscovery\PreviewControl\target\win_x32\release\results\PreviewControl.dll /reference:C:\p4root\Zantaz\trunk\EASDiscovery\Quartz\src\Quartz\target\win_x32\release\results\Scheduler.dll /reference:c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.configuration.dll /reference:c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Data.dll /reference:c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Design.dll /reference:c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.DirectoryServices.dll /reference:c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.dll /reference:c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Drawing.dll /reference:c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Web.dll /reference:c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Web.Services.dll /reference:c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Windows.Forms.dll /reference:c:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Xml.dll /compiler:/delaysign- 
    Error: The specified module could not be found. (Exception from HRESULT: 0x8007007E)
    C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Microsoft.Common.targets(1902,9): error MSB6006: "sgen.exe" exited with code 1. 
```

我将输出目录更改为 target/win_x32/release/results 但 sgen 中的路径似乎没有更新。项目中似乎没有提到传递到 sgen 的路径，所以我不确定如何修复它。作为一种解决方法，我已经禁用了序列化生成，但解决潜在问题会很好。有没有其他人看到这个？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2015-01-25T04:08:45.563

如果您在以发布模式构建 VS.NET 项目时遇到此问题，请使用以下解决方案：

转到项目属性并单击构建选项卡并将“生成序列化程序集”下拉列表的值设置为“关闭”。

Sgen.exe 是“XML 序列化程序生成器为指定程序集中的类型创建 XML 序列化程序集，以便在 XmlSerializer 序列化或反序列化指定类型的对象时提高其启动性能。” ( [MSDN](https://msdn.microsoft.com/en-us/library/bk3w6240%28v=vs.110%29.aspx) )

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-08-26T02:49:28.977

有关 sgen.exe 的选项，请参见[msdn](http://msdn.microsoft.com/en-us/library/bk3w6240(VS.80).aspx) [您有命令行，您可以手动使用它...删除您的 .XmlSerializers.dll 或使用 /force]

今天我还遇到了如何更[手动地指定 sgen 选项](http://www.kiwidude.com/blog/2007/02/vs2005-when-sgen-doesnt-work.html)。我希望它不使用 /proxy 开关，但它似乎可以让您指定输出目录。我对 msbuild 的了解不足以让它变得很棒，但这应该让你开始[在你选择的非可视化工作室编辑器中打开你的 .csproj/.vbproj，看看底部，你应该能够弄清楚如何/这是哪里]

[为方便起见，以下代码已将 UseProxyTypes 设置为 true]

```
<Target Name="GenerateSerializationAssembliesForAllTypes"
  DependsOnTargets="AssignTargetPaths;Compile;ResolveKeySource"
  Inputs="$(MSBuildAllProjects);@(IntermediateAssembly)"
  Outputs="$(OutputPath)$(_SGenDllName)">
    <SGen BuildAssemblyName="$(TargetFileName)"
      BuildAssemblyPath="$(OutputPath)" References="@(ReferencePath)"
      ShouldGenerateSerializer="true" UseProxyTypes="true"
      KeyContainer="$(KeyContainerName)" KeyFile="$(KeyOriginatorFile)"
      DelaySign="$(DelaySign)" ToolPath="$(SGenToolPath)">
        <Output TaskParameter="SerializationAssembly"
          ItemName="SerializationAssembly" />
     </SGen>
</Target>
<!-- <Target Name="BeforeBuild">
</Target> -->
<Target Name="AfterBuild"
  DependsOnTargets="GenerateSerializationAssembliesForAllTypes">
</Target> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-09T18:58:49.643

我还没有看到这个特殊问题，但最近对我们来说，在安装了一些随机且不相关（或者我们认为）的 Windows 安全更新后，来自 cl.exe 的“C1001：编译器中发生内部错误”类型崩溃已得到修复。

我们知道在使用相同版本和服务包级别的 Visual Studio 的其他机器上，该代码不会使编译器崩溃，但当我们尝试 Windows 安全更新时，我们真的是在抓着一根稻草。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-26T02:40:07.427

对我来说这看起来很合理，除非有什么限制了 4096 个字符 [你列出 4020 个字符]

4096 限制对我来说似乎有点荒谬，我通过搜索命令行限制找到的东西是 2048 或 32767 或 8192。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-05-17T20:41:30.637

当我在 GAC 中的一个网站项目上引用了一个程序集时，我遇到了这个问题，该程序集已被卸载，并且由于某种原因该引用触发了序列化程序集生成，并且 sgen 阻塞了该引用（因为它不再存在） . 删除引用并将序列化程序集生成关闭后，我不再遇到问题。

# php - PHP 数组索引：$array[$index] vs $array["$index"] vs $array["{$index}"]

> ID：6628
> 
> 赞同：34
> 
> 时间：2008-08-09T05:01:38.867
> 
> 标签：php, syntax

这些索引到 PHP 数组的方法之间有什么区别（如果有的话）：

```
$array[$index]
$array["$index"]
$array["{$index}"] 
```

我对性能和功能差异都感兴趣。

### 更新：

（回应@Jeremy）我不确定这是对的。我运行了这段代码：

```
 $array = array(100, 200, 300);
  print_r($array);
  $idx = 0;
  $array[$idx] = 123;
  print_r($array);
  $array["$idx"] = 456;
  print_r($array);
  $array["{$idx}"] = 789;
  print_r($array); 
```

并得到了这个输出：

```
Array
(
    [0] => 100
    [1] => 200
    [2] => 300
)

Array
(
    [0] => 123
    [1] => 200
    [2] => 300
)

Array
(
    [0] => 456
    [1] => 200
    [2] => 300
)

Array
(
    [0] => 789
    [1] => 200
    [2] => 300
) 
```

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-08-09T05:55:24.187

参见上面的@svec 和@jeremy。所有数组索引的类型首先是“int”，然后是“string”类型，并且将在 PHP 认为合适的情况下转换为该类型。

性能方面，$index 应该比 "$index" 和 "{$index}" 快（它们是相同的）。

一旦你开始一个双引号字符串，PHP 将进入插值模式并首先将其视为一个字符串，但会从本地范围内寻找变量标记（$、{} 等）来替换。这就是为什么在大多数讨论中，真正的“静态”字符串应该始终是单引号，除非您需要像“\n”或“\t”这样的转义快捷方式，因为 PHP 不需要在运行时尝试插入字符串，并且完整的字符串可以静态编译。

在这种情况下，双引号将首先将 $index 复制到该字符串中，然后返回该字符串，而直接使用 $index 将只返回该字符串。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-08-09T06:10:22.237

我对使用这样的索引的 3 种方法进行了计时：

```
for ($ii = 0; $ii < 1000000; $ii++) {
   // TEST 1
   $array[$idx] = $ii;
   // TEST 2
   $array["$idx"] = $ii;
   // TEST 3
   $array["{$idx}"] = $ii;
} 
```

使用了第一组测试`$idx=0`，使用了第二组`$idx="0"`，使用了第三组`$idx="blah"`。计时是使用`microtime()`差异完成的。我正在使用 WinXP、PHP 5.2、Apache 2.2 和 Vim。:-)

结果如下：

### 使用`$idx = 0`

```
$array[$idx]            // time: 0.45435905456543 seconds
$array["$idx"]          // time: 1.0537171363831 seconds
$array["{$idx}"]        // time: 1.0621709823608 seconds
ratio "$idx" / $idx     // 2.3191287282497
ratio "{$idx}" / $idx   // 2.3377348193858 
```

### 使用`$idx = "0"`

```
$array[$idx]            // time: 0.5107250213623 seconds
$array["$idx"]          // time: 0.77445602416992 seconds
$array["{$idx}"]        // time: 0.77329802513123 seconds
ratio "$idx" / $idx     // = 1.5163855142717
ratio "{$idx}" / $idx   // = 1.5141181512285 
```

### 使用`$idx = "blah"`

```
$array[$idx]           // time: 0.48077392578125 seconds
$array["$idx"]         // time: 0.73676419258118 seconds
$array["{$idx}"]       // time: 0.71499705314636 seconds
ratio "$idx" / $idx    // = 1.5324545551923
ratio "{$idx}" / $idx  // = 1.4871793473086 
```

`$array[$idx]`至少在我的机器上，性能比赛的不二之选也是如此。（结果非常可重复，顺便说一句，我运行了 3 或 4 次，得到了相同的结果。）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-08-09T07:05:44.483

> 我相信从性能的角度来看，$array["$index"] 比 $array[$index] 更快请参阅优化 PHP 代码性能的最佳实践

不要盲目相信您阅读的所有内容...我认为您误解了这一点。文章说 $array['index'] 比 $array[index] 快，其中 index 是一个**字符串**，而不是一个变量。那是因为如果你不把它用引号括起来，PHP 会寻找一个常量 var 并且找不到，所以假设你打算把它变成一个字符串。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-08-09T06:30:12.010

> 不同的索引方法何时会解析为不同的索引？

根据[http://php.net/types.array](http://php.net/types.array)，数组索引只能是整数或字符串。如果您尝试使用浮点数作为索引，它会将其截断为整数。因此，如果`$index`是一个值为 3.14 的浮点数，那么`$array[$index]`将评估为`$array[3]`并且`$array["$index"]`将评估为`$array['3.14']`。这是一些确认这一点的代码：

```
$array = array(3.14 => 'float', '3.14' => 'string');
print_r($array);

$index = 3.14;
echo $array[$index]."\n";
echo $array["$index"]."\n"; 
```

输出：

```
Array([3] => float [3.14] => string)
float
string 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-09T05:48:21.487

### 对更新的回应：

哦，你是对的，我猜如果数组索引字符串只包含数字，PHP 必须将它们转换为数字。我试过这段代码：

```
$array = array('1' => 100, '2' => 200, 1 => 300, 2 => 400);
print_r($array); 
```

输出是：

```
Array([1] => 300 [2] => 400) 
```

我做了更多的测试，发现如果数组索引（或键）仅由数字组成，它总是转换为整数，否则它是一个字符串。

电子垃圾箱：

你能解释一下为什么会更快吗？解释器是否需要额外的步骤来将“$index”解析为字符串以用作索引，而不是仅使用 $index 作为索引？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-09T05:05:38.203

如果 $index 是一个字符串，则没有区别，因为 $index、"$index" 和 "{$index}" 都计算为相同的字符串。如果 $index 是一个数字，例如 10，则第一行的计算结果为 $array[10]，其他两行的计算结果为 $array["10"]，它是与 $array[10] 不同的元素。

* * *

## 回答 #7

> 赞同：-6
> 
> 时间：2008-08-09T05:30:38.450

我相信从性能的角度来看，$array["$index"] 比 $array[$index] 更快请参阅[优化 PHP 代码性能的最佳实践](http://www.chazzuka.com/blog/?p=163)

当我在字符串中有一个数组时，我有时使用的另一种变体是：

```
$str = "this is my string {$array["$index"]}"; 
```

编辑：我的意思是 $row['id'] 比 $row[id] 快

# php - 关闭 register_globals 使代码工作

> ID：6633
> 
> 赞同：13
> 
> 时间：2008-08-09T05:13:55.877
> 
> 标签：php, register-globals

我继承了一些遗留的 PHP 代码，这些代码是在使用标准做法时写回的[`register_globals`](http://php.net/register_globals)（从 PHP 4.2.0 开始，此指令默认为关闭，于 2002 年 4 月 22 日发布）。

我们现在知道启用它对安全性不利。问题是如何在代码中找到我需要使用的所有`$_GET`地方`$_POST`？我唯一的想法是设置错误报告以警告未初始化的变量，然后测试站点的每个部分。有没有更简单的方法？我必须测试站点中的每个代码路径还是 PHP 会基于文件给出警告？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-09T08:11:55.487

如果您将错误报告设置为 E_ALL，它会在错误日志中警告有关未定义变量的完整文件名和行号（假设您正在记录到文件）。但是，只有在遇到未定义的变量时才会发出警告，因此我认为您必须测试每个代码路径。从命令行运行 php 似乎也没有帮助。

有一个调试工具叫xdebug，没试过，但也许有用？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-11T01:08:56.370

我使用内置的[Tokenizer](http://au.php.net/manual/en/ref.tokenizer.php)函数编写了一个[脚本。](http://pastebin.com/f6f379371)它非常粗糙，但它适用于我正在处理的代码库。我相信您也可以使用[CodeSniffer](http://pear.php.net/manual/en/package.php.php-codesniffer.php)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-17T17:36:54.673

您可以手动“伪造”寄存器全局效果，但会增加一些安全性。（我部分地从名为 xoops 的 osCommerce 分支中获取了这个）

```
//  Detect bad global variables
$bad_global_list = array('GLOBALS', '_SESSION', 'HTTP_SESSION_VARS', '_GET', 'HTTP_GET_VARS', '_POST', 'HTTP_POST_VARS', '_COOKIE', 'HTTP_COOKIE_VARS', '_REQUEST', '_SERVER', 'HTTP_SERVER_VARS', '_ENV', 'HTTP_ENV_VARS', '_FILES', 'HTTP_POST_FILES');
foreach ($bad_global_list as $bad_global ) {
    if ( isset( $_REQUEST[$bad_global] ) ) {
        die('Bad Global');
    }
}

//  Make global variables
foreach ($_REQUEST as $name -> $value) {
    $$name = $value; // Creates a varable nammed $name equal to $value.
} 
```

尽管您想调整它以使您的代码更安全，至少通过将全局配置变量（如路径和基本 url）添加到坏全局列表中。

您还可以使用它轻松编译所有使用的 get/post 变量的列表，以帮助您最终用 $_REQUEST['return_url]; 替换所有出现的，比如 $return_url；

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-09T07:01:06.503

我知道有一种方法可以使用某个命令为该脚本设置 php.ini 值，因此我也去寻找并找到了这个 - [Goto last post on page](http://forums.macosxhints.com/archive/index.php/t-8538.html)

我还发现了以下可能有用的帖子-[转到页面上的最后一篇文章](http://www.webmasterworld.com/forum88/1584.htm)

如果没有人找到答案，我会补充更多，但我现在必须赶火车。

# java - 我应该如何将文件加载到我的 Java 应用程序中？

> ID：6639
> 
> 赞同：72
> 
> 时间：2008-08-09T05:33:22.967
> 
> 标签：java, file, loading

我应该如何将文件加载到我的 Java 应用程序中？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2008-08-09T05:35:50.623

**简短的回答**

使用以下两种方法之一：

*   [`Class.getResource(String)`](http://java.sun.com/javase/6/docs/api/java/lang/Class.html#getResource(java.lang.String))
*   [`Class.getResourceAsStream(String)`](http://java.sun.com/javase/6/docs/api/java/lang/Class.html#getResourceAsStream(java.lang.String))

例如：

```
InputStream inputStream = YourClass.class.getResourceAsStream("image.jpg"); 
```

--

**长答案**

通常，不想使用绝对路径加载文件。例如，如果您能提供帮助，请不要这样做：

```
File file = new File("C:\\Users\\Joe\\image.jpg"); 
```

至少有两个原因不推荐使用这种技术。首先，它创建了对特定操作系统的依赖，这会阻止应用程序轻松迁移到另一个操作系统。Java 的主要优点之一是能够在许多不同的平台上运行相同的字节码。使用这样的绝对路径会使代码的可移植性大大降低。

其次，根据文件的相对位置，这种技术可能会创建外部依赖关系并限制应用程序的移动性。如果文件存在于应用程序的当前目录之外，这将创建一个外部依赖项，并且必须了解该依赖项才能将应用程序移动到另一台机器（容易出错）。

相反，使用类`getResource()`中的方法`Class`。这使得应用程序更加便携。它可以移动到不同的平台、机器或目录，并且仍然可以正常工作。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-09T07:18:04.550

getResource 很好，但是使用相对路径也可以，只要您可以控制工作目录的位置（通常可以）。

此外，可以使用[File.separator](http://java.sun.com/j2se/1.5.0/docs/api/java/io/File.html#separator)、[File.separatorChar](http://java.sun.com/j2se/1.5.0/docs/api/java/io/File.html#separatorChar)或[System.getProperty("file.separator")](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/System.html#getProperties())来解决有关分隔符的平台依赖性。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-08-27T18:47:33.393

你加载文件是为了什么 - 配置或数据（如输入文件）或作为资源？

*   如果作为资源，请遵循[Will 和 Justin给出的建议和示例](https://stackoverflow.com/questions/6639/how-should-i-load-files-into-my-java-application#6640)
*   如果配置，那么您可以使用[ResourceBundle](http://java.sun.com/j2se/1.4.2/docs/api/java/util/ResourceBundle.html)或[Spring](http://www.springframework.org/)（如果您的配置更复杂）。
*   如果您需要读取文件以处理其中的数据，此代码段可能会有所帮助`BufferedReader file = new BufferedReader(new FileReader(filename))`，然后使用`file.readLine();` “不要忘记关闭文件”读取文件的每一行。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-09T09:16:10.023

即使在 Windows 上，仅使用 Unix 样式的路径分隔符我也没有问题（尽管检查[File.separatorChar](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/io/File.html#separatorChar)是一种好习惯）。

使用[ClassLoader.getResource()](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/ClassLoader.html#getResource(java.lang.String))的技术最适合将从 JAR 文件加载的只读资源。有时，[您可以以编程方式确定应用程序目录](https://illegalargumentexception.blogspot.com/2008/04/java-finding-application-directory.html)，这对于管理员可配置文件或服务器应用程序很有用。（当然，用户可编辑的文件应该存储在[System.getProperty("user.home")](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/System.html#getProperty(java.lang.String))目录中的某个位置。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-02-20T17:21:44.813

```
public byte[] loadBinaryFile (String name) {
    try {

        DataInputStream dis = new DataInputStream(new FileInputStream(name));
        byte[] theBytes = new byte[dis.available()];
        dis.read(theBytes, 0, dis.available());
        dis.close();
        return theBytes;
    } catch (IOException ex) {
    }
    return null;
} // () 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2021-06-15T15:59:19.570

使用 docs.oracle.com/en/java/javase/11/docs/api/java.base/java/lang/ClassLoader.html#getResource(java.lang.String)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2019-12-23T12:20:17.890

```
public static String loadTextFile(File f) {
    try {
        BufferedReader r = new BufferedReader(new FileReader(f));
        StringWriter w = new StringWriter();

        try {
            String line = reader.readLine();
            while (null != line) {
                w.append(line).append("\n");
                line = r.readLine();
            }

            return w.toString();
        } finally {
            r.close();
            w.close();
        }
    } catch (Exception ex) {
        ex.printStackTrace();

        return "";
    }
} 
```

# browser - 使用网站图标的首选方式？

> ID：6642
> 
> 赞同：9
> 
> 时间：2008-08-09T05:41:40.830
> 
> 标签：browser, compatibility

我之前试图向网站添加一个网站图标，并寻找一种更好的方法来实现这一点，而不是`favicon.ico`在网站的根目录中转储文件。

我找到了这个不错的小指南：[如何添加网站图标](http://www.w3.org/2005/10/howto-favicon)。但是，首选方法在 IE (7) 中不起作用，第二种方法是老式方法（我辞职使用）。

是否有第三种方法适用于所有最流行的浏览器？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-08-09T05:48:15.433

这是我一直使用的：

```
<link rel="icon" href="favicon.ico" type="image/x-icon" />  
<link rel="shortcut icon" href="favicon.ico" type="image/x-icon" /> 
```

第二个是针对 IE 的。第一个适用于其他浏览器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-09T23:32:05.193

您可以使用 HTML 来指定网站图标，但这仅适用于具有此 HTML 的页面。更好的方法是将以下内容添加到您的 httpd.conf (Apache)：

```
AddType image/x-icon .ico 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-09T08:06:50.147

我认为最可靠的方法是简单地将**favicon.ico**文件添加到您网站的根目录。

除非您想手动覆盖默认的网站图标，否则我认为不需要元标记，但我找不到任何研究来支持我的论点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-09T05:44:56.983

这就是他们在 Stack Overflow 上的做法：

```
<link rel="shortcut icon" href="/favicon.ico" /> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-09T05:46:52.003

好吧，该文件位于根目录中，因此它不会显示标记是否有效，或者浏览器是否只是从通常的位置（根目录）获取图标。

**编辑：**我会试试看它是否有效。

**编辑 2：**只要文件是 IE7 的图标，使用这两个标签就可以使它适用于任何文件名：我尝试使用**`.png`**文件，它只适用于 Firefox。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-10-19T04:26:32.723

这些图标有上百万种不同的使用方式（不同的浏览器、不同的平台、移动站点固定、智能电视等），所以真的不再有一个简单的答案。有关一个很好的解释，请参见[这个 SO answer](https://stackoverflow.com/a/48969053/7343159)，但简短的回答是：

使用此站点，您可以上传 png/jpg，然后为您完成所有艰苦的工作：[https ://realfavicongenerator.net/](https://realfavicongenerator.net/)

# java - JUnit 与 TestNG

> ID：6658
> 
> 赞同：126
> 
> 时间：2008-08-09T06:31:25.283
> 
> 标签：java, testing, junit, testng

在工作中，我们目前仍在使用 JUnit 3 来运行我们的测试。我们一直在考虑切换到 JUnit 4 来编写**新**的测试，但我一直在关注 TestNG。你们都有哪些使用 JUnit 4 或 TestNG 的经验，并且对于大量测试似乎更有效？编写测试的灵活性对我们来说也很重要，因为我们的功能测试涵盖了广泛的方面，需要以多种方式编写才能获得结果。

旧的测试不会被重写，因为它们做得很好。不过，我希望在新测试中看到的是编写测试方式的灵活性、自然断言、分组和易于分布的测试执行。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-08-09T07:00:34.087

我都使用过，但我必须同意 Justin Standard 的观点，即您不应该真正考虑将现有测试重写为任何新格式。不管决定如何，运行两者都是微不足道的。TestNG 力求比 JUnit 更具可配置性，但最终它们都工作得一样好。

TestNG 有一个简洁的功能，您可以将测试标记为特定组，然后轻松运行特定组的所有测试，或排除特定组的测试。因此，您可以将运行缓慢的测试标记为“慢”组，然后在需要快速结果时忽略它们。他们文档中的一个建议是将某些子集标记为“签入”测试，每当您签入新文件时都应运行该测试。我从未在 JUnit 中看到过这样的功能，但话又说回来，如果你没有它，你就没有真的很想念它。

尽管它声称拥有高配置，但几周前我确实遇到了一个角落案例，我无法做我想做的事......我希望我能记住它是什么，但我想提出来所以你知道它并不完美。

TestNG 的最大优势是注释......无论如何，JUnit 在版本 4 中添加了这些注释。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-08-09T06:33:50.787

首先我要说的是，不要为了迎合最新潮流而重写所有的测试。Junit3 工作得非常好，并且在 4 中引入注解并没有给你带来很多好处（在我看来）。更重要的是你们*编写*测试，听起来像你做的那样。

使用任何看起来最自然的东西，并帮助您完成工作。

我无法评论 TestNG b/c 我没有使用它。但我会推荐[unitils](http://www.unitils.org/summary.html)，它是 JUnit/TestNG/DBUnit/EasyMock 的一个很好的包装器，不管你走哪条路。（它支持上面提到的所有口味）

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-08-09T09:33:28.257

大约一年前，我们遇到了同样的问题。我花了一些时间考虑哪个动作更好，最终我们意识到 TestNG 没有“杀手级功能”。它很好，并且有一些 JUnit 4 没有的特性，但我们不需要它们。
我们不希望人们在了解 TestNG 时对编写测试感到不舒服，因为我们希望他们继续编写大量测试。
此外，JUnit 几乎是 Java 世界中事实上的标准。没有一个像样的工具不支持它，你可以在网上找到很多帮助，他们在过去一年中添加了很多新功能，这表明它还活着。

我们决定坚持使用 JUnit，并且永不回头。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2008-08-18T10:09:42.563

TestNG 对我来说最大的吸引力包括它的支持测试组，更重要的是 - 测试组依赖关系（将测试标记为依赖于组会导致测试在依赖组失败时简单地跳过运行）。

TestNG 对我来说其他重要的吸引力包括测试参数、数据提供者、注释转换器，以及最重要的——充满活力和响应迅速的用户社区。

虽然从表面上看，您可能并不认为上面的所有 TestNGs 功能都可能不需要，但一旦您开始了解为您的测试带来的灵活性，您就会想知道您是如何应对 JUnit 的。

（免责声明 - 我根本没有使用过 JUnit 4.x，所以我无法真正评论那里的进步或新功能）。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2010-08-19T13:52:21.260

为以上所有人喝彩。我个人发现我更喜欢 TestNG 的其他一些事情是：

1.  for TestNG 发生在`@BeforeClass`类创建之后，因此您不受只能在其中调用类的静态方法的限制。

2.  并行和参数化测试，也许我只是没有足够的生活......但我只是在编写一组 Selenium 测试，接受驱动程序名称作为参数。然后定义 3 个并行测试组，IE、FF 和 Chrome 驱动程序各 1 个，并观看比赛！`HtmlUnit`我最初做了 4 个，但是由于某种原因，我处理的页面太多了，破坏了驱动程序。

是啊，可能需要找到那种生活。;)

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-08-05T12:24:34.000

我想分享我今天遇到的一个。与 TestNG 相比，我发现 Junit4 中的内置参数化运行器相当粗糙（我知道每个框架都有其优势，但仍然如此）。Junit4 注释 @parameters 仅限于一组参数。我在测试同一测试类中功能的有效和无效行为时遇到了这个问题。因此，它将使用它找到的第一个公共的、静态注释的方法，但它可以以任何顺序找到它们。这导致我们不必要地编写不同的类。然而，TestNG 提供了干净的方式来为每种方法提供不同类型的数据提供者。所以我们可以在同一个测试类中以有效和无效的方式测试相同的代码单元，分别放置有效/无效数据。我会选择TestNG。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-01-10T12:10:43.623

TestNG 的另一个优点是支持并行测试。我认为，在我们的多核时代，这很重要。

我也使用了这两个框架。但我使用 hamcrest 进行断言。Hamcrest 允许您轻松编写自己的断言方法。所以而不是

```
assertEquals(operation.getStatus(), Operation.Status.Active); 
```

你可以写

```
assertThat(operation, isActive()); 
```

这使您有机会在测试中使用更高级别的抽象。这使您的测试更加健壮。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2016-06-29T22:38:50.827

**JUnit 4 Vs TestNG – mkyong.com 的比较（2013 年更新）。**

结论：我建议使用 TestNG 作为 Java 项目的核心单元测试框架，因为 TestNG在参数化测试、依赖测试和套件测试（分组概念）方面**更先进。**

TestNG 用于功能性、高级别的测试和复杂的集成测试。它的灵活性对于大型测试套件特别有用。

此外，**TestNG 还涵盖了整个 JUnit4 核心功能**。我没有理由再使用 JUnit。

> 简单来说，**TestNG = JUnit + 更多。**那么，为什么要辩论？去拿TestNG :-)

[您可以在此处](http://www.mkyong.com/unittest/junit-4-vs-testng-comparison/)找到更详细的比较。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2017-12-12T05:02:09.917

## **为什么我们使用 TestNG 而不是 JUnit？**

1.  `@BeforeClass`和方法的声明`@AfterClass`在 JUnit 中必须是静态的，而 TestNG 在方法声明中具有更大的灵活性，它没有这些约束。

2.  **在 TestNG 中，我们可以使用 2 种方式对测试进行参数化**。@Parameter 或 @DataProvider 注释。

    i) **@Parameter**用于需要键值映射的简单情况。（数据通过 xml 文件提供）

    ii) **@DataProvider**用于复杂情况。使用二维数组，可以提供数据。

3.  在 TestNG 中，由于 @DataProvider 方法不需要是静态的，我们可以在同一个测试类中使用多个数据提供者方法。

4.  **依赖测试：**在TestNG中，如果初始测试失败，那么所有后续的依赖测试都会被跳过，不会被标记为失败。但是 JUnit 将其标记为失败。

5.  **分组：**单个测试可以属于多个组，然后在不同的上下文中运行（例如慢速或快速测试）。JUnit 类别中存在类似的功能，但缺少允许初始化测试/拆除测试的 @BeforeGroups / @AfterGroups TestNG 注释。

6.  **并行性：**如果您想在多个线程上并行运行相同的测试，TestNG 为您提供了一个简单易用的注释，而 JUnit 没有提供开箱即用的简单方法。

7.  **TestNG @DataProvider 还可以支持 XML 以输入数据、CSV 甚至纯文本文件。**

8.  TestNG 允许您声明测试之间的依赖关系，如果依赖关系测试未通过，则跳过它们。

> @Test(dependsOnMethods = { "dependOnSomething" })

JUnit 中不存在此功能

9.  **报告：**

默认情况下，TestNG 报告生成到一个测试输出文件夹，该文件夹包括 HTML 报告，其中包含所有测试数据、通过/失败/跳过、它们运行了多长时间、使用了哪个输入以及完整的测试日志。此外，它还将所有内容导出到 XML 文件中，该文件可用于构建您自己的报告模板。

在 JUnit 方面，所有这些数据也可以通过 XML 获得，但没有开箱即用的报告，您需要依赖插件。

## 资源链接：

1.  [快速 JUnit 与 TestNG 比较](http://www.baeldung.com/junit-vs-testng)
2.  [JUnit 与 TestNG：您应该选择哪个测试框架？](https://dzone.com/articles/junit-vs-testng-which-testing-framework-should-you)

本教程并列给出了一个很好的区别：[TestNG Vs JUnit：有什么区别？](https://www.guru99.com/junit-vs-testng.html)

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2008-09-05T19:44:40.967

Mike Stone 的回复中添加了一些内容：

1) 我最常使用 TestNG 组的事情是当我想在测试套件中运行单个测试方法时。我只需将此测试添加到组“phil”，然后运行该组。当我使用 JUnit 3 时，我会注释掉所有方法的条目，但我想在“套件”方法中运行的方法除外，但随后通常会忘记在签入之前取消注释它们。有了组，我不再有这个问题。

2) 根据测试的复杂性，可以使用 sed 自动将测试从 JUnit3 迁移到 TestNG，并创建一个基类来替换静态导入所有 TestNG 断言方法的 TestCase。

[我在这里](http://www.philvarner.com/blog/2008/01/30/testng-migration/)和[这里](http://www.philvarner.com/blog/2008/02/10/testng-part-2/)有关于我从 JUnit 迁移到 TestNG 的信息。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2014-04-06T16:56:18.493

我对 TestNG 真正强大的原因的看法：

```
1\.  JUnit still requires the before/after class methods to be static, which limits
    what you can do prior to the running of tests, TestNG never has this issue.

2\.  TestNG @Configuration methods can all take an optional argument to their 
    annotated methods in the form of a ITestResult, XmlTest, Method, or 
    ITestContext.  This allows you to pass things around that JUnit wouldn't 
    provide you.  JUnit only does this in listeners and it is limited in use.

3\.  TestNG comes with some pre-made report generation classes that you can copy
     and edit and make into your own beautiful test output with very little 
     effort. Just copy the report class into your project and add a listener 
     to run it.  Also, ReportNG is available.

4\.  TestNG has a handful of nice listeners that you can hook onto so you can do
     additional AOP style magic at certain phases during testing. 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2013-06-12T09:50:46.390

你的问题对我来说似乎是两个折叠。一方面您想比较两个测试框架，另一方面您想轻松实现测试，拥有自然断言等......

好的，首先 JUnit 在功能方面一直在追赶 TestNG，他们已经弥补了与 v4 的差距，但在我看来还不够好。在 TestNG 中，注释和数据提供者之类的东西仍然要好得多。此外，它们在测试执行方面更加灵活，因为 TestNG 具有测试依赖性、分组和排序。

JUnit 仍然要求某些 before/after 方法是静态的，这限制了您在运行测试之前可以做的事情，TestNG 从来没有这个问题。

TBH，除非您专注于集成/自动化测试，否则这两个框架之间的差异并不大。根据我的经验，JUnit 是从一开始就为单元测试而构建的，现在正被推向更高级别的测试，而 IMO 使它成为该工作的错误工具。TestNG 在单元测试方面表现出色，并且由于其强大的数据提供和强大的测试执行能力，在集成/自动化测试级别上工作得更好。

现在我认为是一个单独的问题，如何编写结构良好、可读性和可维护性好的测试。我相信您知道其中的大部分内容，但是诸如**工厂模式**、**命令模式**和**PageObjects**（如果您的测试网站）之类的东西是至关重要的，在您的测试 (SUT) 和实际测试之间有一个抽象层是非常重要的是（业务逻辑的断言）。为了获得更好的断言，您可以使用[Hamcrest](https://code.google.com/p/hamcrest/ "腘绳肌")。利用 javas 继承/接口来减少重复并加强通用性。

差点忘了，还用了**Test Data Builder Pattern**，这个加上TestNG的dataprovider注解非常有用。

# javascript - Reference that lists available JavaScript events?

> ID：6661
> 
> 赞同：24
> 
> 时间：2008-08-09T06:40:52.987
> 
> 标签：javascript, browser, client-side

I'm aware of things like `onchange`, `onmousedown` and `onmouseup` but is there a good reference somewhere that lists all of them complete with possibly a list of the elements that they cover?

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-09T06:42:20.003

W3Schools seems to have a good Javascript events reference: [HTML DOM Events](http://www.w3schools.com/jsref/dom_obj_event.asp)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-08-09T08:29:10.880

Quirksmode has a nice [event-compatibility table](http://quirksmode.org/dom/events/index.html) and an [introduction](http://quirksmode.org/js/introevents.html).

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-09T07:00:44.163

Here is a pretty good JavaScript event reference with the elements they are for:
[JavaScript Tutorial >> JavaScript Events](http://www.globalguideline.com/JavaScript_Guide/Java_Script_Events.php)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-08-09T07:49:41.023

This [Javascript Cheat Sheet](http://www.addedbytes.com/cheat-sheets/javascript-cheat-sheet/) has a complete list of of event handlers. Nearly all of them can be used on any html element except for one or two.

If you want to use a lightweight javascript library, [DOMAssistant](http://www.domassistant.com/) is very lightweight and allows you to add events to elements very easily. Like so:

```
$("#navigation a").addEvent("click", myFunc); 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-15T16:03:06.063

If you're going to be working with events (setting custom functions and event handlers), then I'd recommend checking out the [jQuery library](http://jquery.com/). It makes [event binding](http://docs.jquery.com/Events) so much easier than doing it by hand.

# .net - Web 服务——WCF 与 ASMX（“标准”）

> ID：6666
> 
> 赞同：34
> 
> 时间：2008-08-09T06:50:22.703
> 
> 标签：.net, wcf, web-services, visual-studio, asmx

我正在做一个新项目。与常规的老式 Web 服务相比，使用 WCF Web 服务有什么好处吗？

Visual Studio 为两者提供模板。有什么区别？优点和缺点？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-08-10T02:28:42.683

什么是“常规的老式 Web 服务”？ASMX 服务，还是您也在使用 WSE？ASMX 服务不是天生可互操作的，不支持 WS-* 规范，而且 ASMX 是一项很快老化的技术。WSE（Web Service Enhancements）服务确实添加了对 WS-* 的支持，并且可以使其具有互操作性，但 WCF 旨在取代 WSE，因此您应该花时间学习它。我想说的是，除非您的应用程序是一个快速而肮脏的一次性应用程序，否则如果您选择 WCF，您将获得巨大的灵活性并最终获得更好的设计。WCF*确实*有超越 [WebMethod] 属性的学习曲线，但在我看来，学习曲线被过度夸大了，而且它比传统的 ASMX 服务更强大且面向未来。

除非您的时间线根本无法忍受学习曲线，否则您将在学习 WCF 而不是仅仅坚持使用 ASP.NET Web 服务对自己大有裨益。应用程序只会继续变得越来越分布式和互连，而 WCF 是微软平台上分布式计算的未来。

[这是](http://msdn.microsoft.com/en-us/library/aa738737.aspx)两者之间的比较。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-08-09T08:35:18.077

自己做所有事情的优点是：

*   没有学习曲线
*   非常灵活

WCF 的优点是：

*   从长远来看，花费更少的时间
*   无需编程即可切换协议

WCF 的一个缺点：一些静态属性名称[可能很长](http://codebetter.com/blogs/james.kovacs/archive/2008/08/08/why-developers-are-interested-in-rest.aspx)......

总结一下：WCF 让您专注于编程，但您需要先学习它；-)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-10-05T20:02:57.587

WCF 专业版：您不需要 Web 服务器（即 IIS）。您实际上不需要服务器操作系统。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-10T02:13:06.007

我喜欢编写 WCF 服务可以轻松地将服务与实现分开的事实。您可以编写服务，然后将其托管在 IIS、控制台应用程序或 Windows 服务中；您还可以通过 HTTP、net TCP 等与它通信。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-12T21:56:24.910

对您的服务实现和交互进行单元测试更容易！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-09-30T06:27:21.080

如果你的项目使用的是framework 4.0，为什么不试试WebApi，它很容易理解并且使用约定优于配置。

它是使用超快速接口构建应用程序的好方法

看看 MS 的入门视频，它是从 WCF 数据服务演变而来的。

[http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api](http://www.asp.net/web-api/overview/getting-started-with-aspnet-web-api)

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2012-06-20T16:43:04.680

在我的经验中

**WCF**

使用它是荒谬的冗长，它与其他微软产品不太兼容，当然，它在微软世界之外没有被广泛接受。

但我的主要问题是它不稳定，它趋向于失败（在某些情况下）并且需要在使用之前对其进行调整。

**反而**

SOAP（又名标准 Web 服务），它可以工作，易于工作并且广泛兼容（Java-JAX 无需任何修改即可接受它）。

在 SOAP 中添加身份验证可能有点棘手，但并非不可能。

# c# - ASP.NET Web 服务结果、代理类和类型转换

> ID：6681
> 
> 赞同：11
> 
> 时间：2008-08-09T07:34:01.523
> 
> 标签：c#, asp.net, web-services

我对 ASP.NET 世界还很陌生，所以我可能会离这里很远，但到目前为止，这是我（有限的）知识中最好的！

假设我在*Business*命名空间中有一个标准的业务对象“Contact”。我编写了一个 Web 服务来从数据库中检索联系人的信息并将其返回。然后我编写一个客户端应用程序来请求所述详细信息。

现在，我还创建了一个实用方法，它接受一个“联系人”并用它做一些魔术，`Utils.BuyContactNewHat()`比如说。这当然需要类型的 Contact `Business.Contact`。

然后我回到我的客户端应用程序并想要使用该`BuyContactNewHat`方法，所以我添加了对我的*Utils*命名空间的引用，它就在那里。但是，问题出现在：

```
Contact c = MyWebService.GetContact("Rob);
Utils.BuyContactNewHat(c); // << Error Here 
```

由于返回类型`GetContact`是 of`MyWebService.Contact`并且不像`Business.Contact`预期的那样。我理解这是为什么，因为在访问 Web 服务时，您实际上是在针对 WSDL 生成的代理类进行编程。

那么，有没有一种“更简单”的方法来处理这种类型的不匹配？我正在考虑尝试创建一个通用转换器类，它使用反射来确保两个对象具有相同的结构，而不是简单地将值从一个对象传输到另一个对象。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-08-09T08:58:24.707

你在正确的轨道上。要将代理对象中的数据返回到您自己的对象之一，您必须执行左手右手代码。即复制属性值。我敢打赌，已经有一种使用反射的通用方法。

有些人如果只想通过网络获取业务对象，他们会使用 Web 服务（.net 远程处理）以外的东西。或者他们将使用二进制序列化。我猜您使用 Web 服务是有原因的，因此您必须进行属性复制。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-11T18:07:11.820

您实际上不必使用 WSDL 为您提供的生成的类。如果您看一下它生成的代码，它只是调用一些 .NET 框架类来提交 SOAP 请求。过去，我将该代码复制到一个普通的 .cs 文件中并对其进行了编辑。虽然我没有具体尝试过，但我看不出为什么不能删除代理类定义并使用原始类来接收 SOAP 调用的结果。它一定已经在幕后进行了反思，做两次似乎很可惜。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-27T18:35:48.427

我建议您编写一个 Schema Importer Extension，您可以使用它来控制代理代码生成。这种方法可用于（优雅地）解决您的问题而不会产生混乱（例如将对象从一个命名空间复制到另一个命名空间，或修改代理生成的 reference.cs 类，以便在下次更新 Web 引用时替换它）。

这是关于该主题的（非常）好的教程：

[http://www.microsoft.com/belux/msdn/nl/community/columns/jdruyts/wsproxy.mspx](http://www.microsoft.com/belux/msdn/nl/community/columns/jdruyts/wsproxy.mspx)

# oop - OOP 什么时候更适合？

> ID：6703
> 
> 赞同：29
> 
> 时间：2008-08-09T08:51:27.107
> 
> 标签：oop

自从我开始学习面向对象编程以来，我经常阅读文章/博客说函数更好，或者不是所有问题都应该建模为对象。从您的个人编程经历来看，您认为 OOP 何时能更好地解决问题？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-08-09T12:44:59.070

没有硬性规定。当您更善于解决问题并以 OO 心态思考时，使用 OOP 可以更好地解决问题。面向对象只是通过尝试使计算成为解决问题的更好工具而出现的另一种工具。

但是，它可以允许更好的代码重用，也可以使代码更整洁。但很多时候，这些受到高度赞扬的品质实际上并没有什么真正的价值。将 OO 技术应用于现有的功能应用程序确实会导致很多问题。技能在于学习许多不同的技术并将最适合手头的问题应用。

OO 经常被引用为软件开发的涅槃式解决方案，但很多时候它并不适合应用于手头的问题。很多时候，它会导致对问题进行过度设计以达到完美的解决方案，而实际上这通常是不必要的。

本质上，OOP 并不是真正的面向对象编程，而是将面向对象的思维映射到能够支持 OO 技术的编程语言。OO 技术可以由本质上不是 OO 的语言支持，并且您可以在函数式语言中使用一些技术来利用这些优势。

举个例子，我已经开发 OO 软件大约 20 年了，所以在解决问题时我倾向于用 OO 的术语来思考，而不管我用什么语言编写。目前我正在使用 Perl 5.6 实现多态性，而 Perl 5.6 本身并不支持它。我选择这样做是因为它会使代码的维护和扩展成为一项简单的配置任务，而不是开发问题。

不确定这是否清楚。OO 场有硬的人，Functional 场也有硬的人。还有一些人都尝试过，并试图从每个人身上得到最好的。两者都不是完美的，但两者都有一些非常好的特性，无论使用什么语言，你都可以使用它们。

如果您正在尝试学习 OOP，请不要只专注于 OOP，而是尝试将面向对象分析和一般 OO 原则用于解决问题的整个范围。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-19T12:10:09.170

我是一个老前辈，但也对 OOP 编程了很长时间。我个人反对使用 OOP 来使用它。我更喜欢对象有特定的存在原因，它们模拟了具体的东西，并且它们有意义。

我对许多新开发人员的问题是，他们对自己创建的代码所消耗的资源一无所知。在处理大量数据和访问数据库时，“完美”的对象模型可能是您在性能和资源方面所能做的最糟糕的事情。

我的底线是，如果它作为一个对象有意义，那么只要您考虑对象模型的实现对性能/资源的影响，就将它作为一个对象进行编程。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-08-09T09:07:27.653

我认为当您对与状态和在这些状态上的相关动作有凝聚力的东西进行建模时，它最适合。我想这有点模糊，但我不确定这里是否有完美的答案。

OOP 的优点在于它可以让您封装和抽象数据和信息，这对于构建大型系统来说是一个真正的福音。您可以对其他范例做同样的事情，但似乎 OOP 在这个类别中特别有用。

这也取决于您使用的语言。如果它是一种具有丰富 OOP 支持的语言，那么您可能应该利用它来发挥自己的优势。如果没有，那么您可能需要找到其他机制来帮助将问题分解为更小、更易于测试的部分。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-08-09T12:34:42.913

我被卖给了 OOP。

任何时候你可以为一个问题定义一个概念，它可能被包装在一个对象中。

OOP 的问题是有些人过度使用它，使他们的代码更难理解。如果您对对象中的内容和服务（静态类）中的内容非常小心，那么您将从使用对象中受益。

只是不要将不属于对象的东西放入对象中，因为您需要您的对象执行您最初没有想到的新事物，重构并找到添加该功能的最佳方法。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-11-06T13:42:41.960

有 5 个标准，您是否应该支持面向对象而不是基于对象、功能代码或过程代码。请记住，所有这些样式都适用于所有语言，它们是*样式*。所有这些都是以“在这种情况下我应该支持 OO 吗？”的风格写的。

该系统非常复杂，大约有 9k LOC（只是任意级别）。——随着系统变得越来越复杂，通过封装复杂性获得的好处会大大增加。使用 OO，与其他技术相反，您倾向于封装越来越多的复杂性，这在这个级别非常有价值。在此之前应优先考虑基于对象或程序。（这并不是在提倡一种特定的语言。在我看来， [OO](http://www.planetpdf.com/codecuts/pdfs/ooc.pdf) C 比 OO C++ 更适合这些特性，这种语言以泄漏抽象而臭名昭著，甚至可以与一个平庸/顽固的程序员一起吃午饭）。

您的代码不是对数据的操作（即基于数据库或基于数学/分析）。基于数据库的代码通常更容易通过程序样式表示。基于分析的代码通常更容易以功能样式表示。

您的模型是对某些事物的模拟（OO 擅长模拟）。

您正在做一些基于对象的 OO 子类型分派很有价值的事情（也就是说，您需要向特定类型和各种子类型的所有对象发送消息，并从所有对象中获得适当但不同的反应） .

您的应用程序不是多线程的，尤其是在非工作任务方法类型的代码库中。OO 在多线程程序中存在很大问题，并且需要不同的线程来执行不同的任务。如果你的程序由一个或两个主线程和许多工作线程组成，做同样的事情，OO 程序的混乱控制流更容易处理，因为所有工作线程将在它们接触的部分中被隔离，可以被认为是一个单一的代码部分。实际上考虑任何其他范式。函数式擅长多线程（没有副作用是一个巨大的好处），基于对象的编程可以给你带来一些 OO 封装的好处，但是在你的代码库的关键部分有更多可追溯的过程代码。当然，程序在这个领域也很出色。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-09T14:11:47.743

OO 不太好的一些地方是你在处理 SQL 中的“集合”数据。OO 倾向于使基于集合的操作更加困难，因为它并不是真正设计为最佳地获取两个集合的交集或两个集合的超集。

此外，有时功能方法会更有意义，例如取自[MSDN](http://msdn.microsoft.com/en-us/magazine/cc164244.aspx)的这个示例：

> 例如，考虑编写一个程序来将 XML 文档转换为不同形式的数据。虽然可以编写一个解析 XML 文档并应用各种 if 语句来确定在文档的不同点采取什么操作的 C# 程序，但可以说是一种更好的方法是将转换编写为可扩展样式表语言转换 (XSLT) 程序。毫不奇怪，XSLT 内部有大量的功能主义

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-09T14:17:22.817

我发现从“事物”的角度来思考给定的问题会有所帮助。

如果可以将问题视为具有一个或多个“事物”，其中每个“事物”具有许多属性或引用其状态的信息片段，以及可以对其执行的许多操作 - 那么 OOP可能是要走的路！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-19T12:21:05.417

学习面向对象编程的关键是学习设计模式。通过了解设计模式，您可以更好地了解何时需要类以及何时不需要。与编程中使用的任何其他东西一样，OOP 语言的类和其他功能的使用取决于您的设计和要求。像算法设计模式是一个更高层次的概念。

设计模式的作用与传统编程语言的算法相似。设计模式告诉您如何创建和组合对象以执行一些有用的任务。像最好的算法一样，最好的设计模式足够通用，可以应用于各种常见问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-10-13T16:59:36.553

在我看来，这更像是一个关于你作为一个人的问题。某些人在功能方面思考得更好，而另一些人则更喜欢类和对象。我想说，当 OOP 与您对世界的内部（主观）心智模型相匹配时，它更适合。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-28T14:41:25.870

面向对象代码和过程代码具有不同的扩展点。面向对象的解决方案使得在不修改现有函数的情况下添加新类变得更加容易（参见开闭原则），而过程代码允许您在不修改现有数据结构的情况下添加函数。根据预期的变化类型，系统的不同部分通常需要不同的方法。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-12-03T00:37:43.653

OO 允许将与对象相关的逻辑放置在单个位置（类或对象）中，以便将其解耦并更易于调试和维护。

我观察到的是，每个应用程序都是 OO 和过程代码的组合，其中过程代码是将所有对象绑定在一起的粘合剂（至少是主函数中的代码）。你越能把你的程序代码变成面向对象，就越容易维护你的代码。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-11-30T10:55:34.647

为什么使用 OOP 进行编程：

1.  它的灵活性——OOP 在使用实现方面非常灵活。
2.  它可以将你的源代码减少 99.9% 以上——这听起来像是我过分夸大了，但确实如此。
3.  实现安全性要容易得多——我们都知道安全性是 Web 开发的重要要求之一。使用 OOP 可以简化 Web 项目中的安全实施。
4.  它使编码更有条理——我们都知道干净的程序就是干净的编码。使用 OOP 而不是程序化可以使事情更有条理和系统化（显然）。
5.  它可以帮助您的团队轻松地相互合作——我知道你们中的一些人曾经/经历过团队项目，而你们中的一些人知道拥有相同的方法、实现、算法等非常重要

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-04T15:29:08.910

这取决于问题：OOP 范式在设计分布式系统或框架时很有用，在用户的操作过程中存在大量实体（例如：Web 应用程序）。

但是如果你有数学问题，你会更喜欢函数式语言（LISP）；对于性能关键系统，您将使用 ADA 或 C 等。

OOP 语言很有用，因为它也可能在程序运行中使用垃圾收集器（自动使用内存）：您在 C 中编写了很多时间，您必须手动调试和纠正内存问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2010-10-29T13:46:25.317

当你有东西时，OOP 很有用。一个套接字，一个按钮，一个文件。如果你在 er 中结束一个类，它几乎总是一个伪装成一个类的函数。TestRunner 很可能应该是一个运行测试的函数（并且可能命名为运行测试）。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-11-06T16:41:04.287

就个人而言，我认为 OOP 实际上是任何大型应用程序的必需品。我无法想象在不使用 OOP 的情况下拥有超过 100k 行代码的程序，这将是维护和设计的噩梦。

* * *

## 回答 #16

> 赞同：-1
> 
> 时间：2010-11-22T18:26:31.477

我告诉你什么时候 OOP 不好。

当架构师编写非常复杂的、无文档的 OOP 代码时。在项目中途离开。他在各种项目中使用的许多通用代码片段都缺少代码。感谢上帝提供 .NET Reflector。

而且该组织没有运行 Visual Source Safe 或 Subversion。

我很抱歉。2页代码登录是相当荒谬的，即使它是可爱的OOPed....

# asp.net - 大型网站的母版页

> ID：6719
> 
> 赞同：4
> 
> 时间：2008-08-09T09:51:37.533
> 
> 标签：asp.net, .net, master-pages, asp.net-2.0

我刚刚学习了 ASP.NET 2.0 中的母版页。

它们听起来很棒，但它们在实践中的效果如何？

有没有人有将它们用于大型网站的经验？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-09T09:55:02.660

我很确定我只在 ASP.NET MVC 的上下文中使用母版页，所以我不确定它是否与 Web 表单不同，但根据我的经验，它们不仅非常好，而且我无法想象不使用它们. 母版页是对网页的代码继承。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-09T12:25:55.380

如果您想在应用程序的所有页面中保持应用程序的外观，它们是必须的。

它们相当容易使用：

首先，设计您的母版页并定义您希望放置内容的位置：

```
<%@ Master ... %>

<%-- HTML code --%>
<asp:ContentPlaceHolder id="plhMainContent" runat="server" />
<%-- HTML code --%> 
```

您可以拥有任意数量的占位符，只需给它们适当的标识符，因为您稍后会需要它们。

然后在创建*`aspx`*页面时，您需要提及使用哪个母版页以及在哪个占位符中放置什么内容。

```
<%@ Page ... master="~/MasterPage.master" ... %>

<asp:Content ID="ContentIdentifier" ContentPlaceholderid="plhMainContent" runat="server">
    <%-- More HTML here --%>
    <%-- Insert web controls here --%>
</asp:content> 
```

只需确保链接到正确的母版页，并且您的内容引用了正确的占位符。

母版页可以节省大量时间并且非常强大。那里有教程，了解占位符和 Web 控件的强大功能。

在我工作的地方，我们为一些大公司广泛使用母版页和 Web 控件，与其他公司可以提供的相比，它使我们具有优势。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-09T11:41:25.470

它们非常有用，特别是在 CMS 环境中和大型站点中，正如 MattMitchell 所说，如果没有它们，您将构建一个大型站点是不可想象的。

选择模板，每个模板都有不同的可编辑区域，工作完成。母版页也可以被继承，因此您可以拥有一个 Style.Master，派生一个 Header.Master，然后从中派生所有基于布局的模板。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-09T12:13:13.597

母版页使构建支持模板的网站变得容易。

我认为使用母版页构建网站最棘手的部分是知道何时将内容放入母版页以及何时将内容放入子页面上的 ContentPlaceHolder。通常，动态内容进入占位符，而静态项目进入母版页，但有时会有灰色区域。这主要是一个设计/架构问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-09T12:50:32.413

在实践中，我并不经常发现不使用 MasterPages 开发的网站。它们允许对网站外观和感觉进行简单轻松的操作，并且还使导航元素和共享内容片段变得轻而易举。

ASP.Net 3.5 甚至允许跨单个母版页的多个内容页和标题部分的操作。

我将它评为使用 ASP.Net 的 Web 开发人员的十大工具之一。

甚至 ASP.Net MVC 也使用 MasterPages，而 Paul Haack 和他的人群放在一起的所有示例都使用了它们。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-09T15:01:41.417

我在这里呼应其他声音。我在 2.0 中使用过 Master Pages，该功能对我来说非常棒。我一直在嵌入横幅、标准化背景、从 Active Dir 捕获的内容和其他 JavaScript 功能，以便在整个应用程序中使用，保持外观和感觉的一致性，而无需在多个页面上重复工作。很棒的功能。

# user-interface - 图标：没有设计技能的开发人员如何使他/她的应用程序图标看起来漂亮？

> ID：6729
> 
> 赞同：61
> 
> 时间：2008-08-09T11:18:58.527
> 
> 标签：user-interface, icons

我可能花了太多时间试图让我的视觉界面看起来不错，虽然我非常擅长在可用性和风格之间找到合适的匹配，但我最不希望的一个领域是制作漂亮的图标。

你们是如何克服这个（我确定很常见的）问题的？我正在考虑按钮上的图像之类的东西，也许最重要的是实际的应用程序图标。

您是否依赖第三方设计师，无论是在室内还是室外？或者你知道一些隐藏的网站，它提供了很多图标供我们使用？我试过谷歌，但我似乎找到了非常具体的昂贵软件包，数百万个星际迷航图标或在 16x16 上看起来很糟糕的图标，这是我在应用程序按钮上的首选尺寸。

任何帮助/建议表示赞赏。

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-08-09T12:04:18.780

好的图标很难设计。我尝试过自己设计，并且也使用了内部图形设计师。然而，构建一个好的图标集需要大量的工作，即使对于平面设计师来说也是如此。

我相信您最好的解决方案是购买/找到一组用于您的项目的图标。

丝绸图标集是一个很好的免费集，可以在[FamFamFam](http://famfamfam.com/lab/icons/silk/)找到。这个集合有1000多个图标，非常受欢迎。

如果您正在寻找“不同”的东西，您可以花几百美元购买图标集。考虑到让设计师为您制作或自己制作它们的成本，这些套装的成本很便宜！

以下是我在网上遇到的一些图标设计师：

*   [图标工厂](http://iconfactory.com/stockicons)
*   [图标体验](http://www.iconexperience.com/index.php)
*   [图标自助餐](http://www.iconbuffet.com/)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-09T13:32:54.747

不要忘记，除非您有很多工具栏按钮或其他此类对象要填充，否则除了您自己独特的应用程序图标和系统图标之外，*只需很少的图标即可。*（请记住从用户机器上的现有库中调用它们，而不是重新打包它们，让律师高兴。）

拥有太多图标可能与拥有一些丑陋的图标一样糟糕。许多指导方针指出，如果您不能拥有具有专业外观的图标，则可以使用一些空白来代替。它可以帮助保持界面轻盈并感觉整洁。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-09T12:03:33.007

如果你有钱，一定要找专业的设计师。起初，如果您没有太多需要设计师的项目，只需在合同基础上雇用一个。如果您开始觉得需要一名全职设计师，那么聘请一名设计师将是有益的。

可以使用漂亮的免费图标集，但您应该四处寻找合适的图标集，您可以在大多数项目中重复使用它。

最后，如果您没有机会接触设计师，请保持外观非常干净和简单，因为您可能无法做出好看的设计（因为您不是艺术家）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-16T14:53:20.810

您不必成为出色的设计师，也可以为您的应用程序设计出体面的 UI 和出色的用户体验。

我认为您可以遵循某些原则，这些原则可以显着改善您的应用程序。

概括地说，这包括：

*   确定您的前 3 个用例
*   衡量和减少通过顶级用例所需的点击次数
*   素描，原型，扔掉，挑战自己，用更少的钱去做

我写了一篇博客文章，试图写出一些与 GUI 设计相关的原则。检查一下，让我知道你的想法。

[如何通过一些简单的原则改善您的 GUI 应用程序的用户体验。](http://www.tawheedkader.com/2008/09/how-to-create-a-better-enterprise-gui-app-with-some-basic-design-principles/)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-17T04:13:46.657

这些是我前段时间找到的图标链接，我认为它们尚未发布：

*   [用于 KDE 桌面的 Eyecandy](http://www.kde-look.org/index.php?xcontentmode=22x27)

*   [+3700 为您的网站或博客提供免费图标](http://www.blogmundi.com/2007/12/10/3700-iconos-gratis-para-tu-web-o-blog/)

*   [需要图标的人的图标](http://sweetie.sublink.ca/)

*   [探戈图标库](http://tango.freedesktop.org/Tango_Icon_Library)

这听起来也很有趣：[OpenClipArt](http://openclipart.org)但他们的网站似乎不提供快速预览（缩略图）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-09T11:27:21.833

我们有一个内部设计师来做我们的，尽管我们也使用自由设计师。

您可以尝试在[99 Designs](http://www.99designs.com)上发起设计竞赛吗？

还有一些免费的图标集可用，[比如这些](http://www.famfamfam.com/lab/icons/)。

如果您四处搜索，您还会发现很多可以使用的商用图标集（尽管显然这两个图标集选项都不会为您提供特定于您的应用程序的图标！）。

希望有帮助！

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-08-19T08:34:50.197

我有一对我真的很喜欢：

[GlyFx](http://glyfx.com/products/free.html)和[流动性矢量图标](http://www.gosquared.com/liquidicity/archives/122)。

来自 Liquidicity 的那些对 WPF 或 Silverlight 特别有用，您可以使即使缩放的界面看起来也很棒。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-09T12:47:14.120

我在注册我的 Visual Studio Express 副本时遇到了 IconBuffet。他们有一些很棒的图标，你可以在你的应用程序中使用它们。

对于应用程序开发，我也开始在 .Net 中使用 WPF 接口，很快也可以在 Mono 上使用。有了在 Windows 应用程序中使用网络图像和图片的能力，即使没有创意也可以开发一些很棒的界面。

对于网站布局，我使用 OSWD 之类的网站进行免费的设计和布局。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-08-09T13:14:24.520

我也推荐 IconFactory。或者更确切地说：[http](http://stockicons.com/) ://stockicons.com/有很多图标集价格实惠，如果您自己不是图形设计师，我认为购买专业集是您的最佳选择。

如果您只需要一个图标，那么聘请图形设计师可能是值得的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-08-09T14:52:41.590

但是你到底为什么认为你需要制作图标来让你的界面看起来不错呢？如今，图标驱动的界面是 UI 的祸根。例如，查看 Komodo IDE 或 Eclipse 的屏幕截图。这些界面设计得非常糟糕。在您将鼠标悬停在按钮上并获得工具提示之前，不可能知道按钮的作用。我建议你使用文本，除非有一个图标可以更好地代表概念，而不是觉得你需要直观地代表每个想法。

我想这取决于你开发 UI 的背景——你有很多用户不说英语作为他们的第一语言吗？是偶尔使用还是高级用户每天都使用？它是一个网站吗？它是桌面应用程序吗？

但是当你真的需要图标时，那里有一些很好的库。我认为一致性非常重要。[例如， Tango](http://tango.freedesktop.org/Tango_Icon_Library) “的存在是为了帮助为免费和开源软件创建一致的图形用户界面体验。” 并且相当吸引人的图标在知识共享下获得许可

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-08-13T13:55:42.140

我认为提到 Axialis 刚刚免费发布了他们的 Icon Studio for Visual Studio 2008 版本可能会很有趣。仅当安装了 VS 2008 Pro 或 TFS 并直接插入 VS 工具栏时才会安装。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-09-10T20:41:21.833

我一直很喜欢[VirtualLNK](http://www.virtuallnk.com/)的图标选择。他们有很多图标包，价格合理，外观现代。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-10T21:04:14.043

试试这个网站[www.iconsreview.com](http://www.iconsreview.com/)，他们提供各种图标包的评论，包括免费和购买。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-11T16:39:24.530

[www.iconshock.com](http://www.iconshock.com/)拥有超过 400,000 个图标，您可以花 400 美元左右购买整个系列。

或者，有许多网站提供免费图标，请务必检查许可证。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-01-21T18:35:04.623

I ended up getting $20 credits (min amount) from vectorstock - they have a lot of vector images, icons and stuff like that to choose from, selling for 1 credit (1$).

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-08-09T14:40:32.690

您总是可以继续[Elance](http://www.elance.com/p/landing/buyer.html)并聘请某人为您制作任何图标/徽标。我已经做过好几次了，你得到的东西很便宜。该网站上的竞争如此激烈，以至于最终会有人以您的价格进入。我一直认为，用你并不真正擅长的东西来转动你的轮子是没有意义的。

哦，是的，喜欢这个网站，保持简单总是最好的！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-08-09T15:58:44.420

我尽量让我的应用程序非常简单。如果巧妙地完成，简单性和可用性本身就是一个很好的设计。

以 Stackoverflow 的所有按钮为例。在您自己的应用程序中实现类似的东西应该不是很困难。他们很简单，他们完成了工作。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-10-17T04:46:23.923

尝试首先以干净和简单为目标，然后担心美学元素。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2010-06-02T09:10:48.233

## 作弊并使用照片！

I've struggle with this, What I tend to do now, is find photos of objects BUT on a plain white background. The background can be made transparent. I then use this [Conversion tool](http://converticon.com/) to convert a PNG file into an .ico. When exporting include all resolutions up to 512 pixel size for good results.

# firefox - 为什么我的网站图标不显示？

> ID：6732
> 
> 赞同：1
> 
> 时间：2008-08-09T11:30:09.520
> 
> 标签：firefox, ubuntu, favicon

我有一个网站，我刚刚上传到 Internet。当我在 Ubuntu 上使用 Firefox 3.0.1 浏览该站点时，我看不到图标；WinXP 上的 Firefox 3.0.1 会显示它。

**为什么**在 Ubuntu 下不显示图标？它是根目录下的 favicon.ico 文件，没有在 meta 标签中引用；它作为 GIF 会更好吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-08-09T13:24:01.067

以前，没有网站图标。浏览器缓存了缺少的图标。 [清除 Firefox 缓存](http://pcsupport.about.com/od/maintenance/ht/clearcacheff.htm)，一切正常。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-09T11:33:35.393

尝试看一下[之前的 Question](https://stackoverflow.com/questions/6642/perfect-way-to-use-favicons)，它表明您必须在 html 中放置两个元标记才能使其在所有浏览器和操作系统中工作。

# java - Java + SQL Server - 一个可行的解决方案？

> ID：6765
> 
> 赞同：12
> 
> 时间：2008-08-09T13:23:40.617
> 
> 标签：java, sql-server

我将开始一个新项目 - 从头开始​​重写现有系统（PHP + SQL Server），因为设计上有一些非常严重的限制。

我们对 SQL Server 有一些很好的了解（目前我们在现有系统中使用 SQL Server 2000），我们希望在我们的新项目中使用它的新版本（我猜是 2008 年）。

我真的很喜欢 Java 提供的技术——尤其是 Spring Framework 和 Wicket，而且我之前从其他项目和作业中非常熟悉 Java。因此，我们考虑使用 Java 和 Microsoft SQL Server。

SQL Server 有两个 JDBC 驱动程序 - jTDS 和 Microsoft 的一个 - [http://msdn.microsoft.com/en-us/data/aa937724.aspx](http://msdn.microsoft.com/en-us/data/aa937724.aspx)。我认为我们应该测试他们两个。

我应该知道这种解决方案有什么限制吗？有人体验过这种技术组合吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-08-09T20:18:15.240

我曾在一个项目中使用 MSQL Server 和 Java Stack。它工作得很好而且很长，因为 JDBC 不应该真正关心你的数据库。我们将 ehcache 与 Hibernate 一起使用，并且 MS JDBC 驱动程序出现问题，因此我们切换到 jtds，它的效果非常好。

很久以前了，所以你可能还想给 MS 司机一个机会……

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-09T13:58:38.453

我不了解 Java 和 2008 ......但你不应该对 Java 和 SQL2000 有太多的麻烦。正如 lubos 建议的那样，您可以帮自己一个忙，看看 c#，但是如果您对 Java 更熟悉，那么应该没有任何真正的限制，因为[Microsoft 支持JDBC 连接器](http://msdn.microsoft.com/en-us/data/aa937724.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-13T11:11:09.460

几年来，我们一直在运行使用 Hibernate 与多个远程 MSQL Server 实例通信的应用程序，并且在 M$ 驱动程序出现一些问题后，我们也很早就切换到了 jTDS 驱动程序。自从切换以来，我们根本没有任何问题。但是，它不是一个复杂的应用程序，因此它不使用任何 LOB。希望有帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-13T12:56:57.203

jTDS 非常好。我多年来一直在高可用性生产环境中使用它，没有出现任何问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T18:02:14.623

我会倾向于 jTDS 驱动程序。MSSQL 驱动程序有一个限制，您不能重复读取同一列两次。这在使用 Hibernate 时经常发生。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-07-29T17:21:30.777

JDBC 驱动程序适用于 SQL Server 2008，我没有遇到任何问题。您需要下载的版本取决于您安装的 JRE 的版本。JRE6 使用 JDBC4，JRE7 使用 JDBC4.1 等。从 Microsoft 下载正确的驱动程序并运行安装程序后，您需要将 **sqljdbc_auth.dll**从**\auth**目录复制到**c:\windows\system32**目录。然后可以使用此代码进行连接：

在您的标题中：

```
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement; 
```

在你的课堂上：

```
public class connectToSQL {

    public void connectToDB() throws Exception {
        Class.forName("com.microsoft.sqlserver.jdbc.SQLServerDriver");
        String connectionUrl = "jdbc:sqlserver://<IPADDRESS>:<PORT>;DatabaseName=<NAME OF DATABASE TO CONNECT TO>;IntegratedSecurity=false";    
        Connection con = DriverManager.getConnection(connectionUrl, "<SQL SERVER USER LOGIN>", "<SQL SERVER PASSWORD>");
        Statement s = con.createStatement();
        ResultSet r = s.executeQuery("SELECT * FROM <TABLENAME TO SELECT FROM>");
        while (r.next()) {
            System.out.println(r.getString(1));
        }
    }
} 
```

# flash - 如何制作具有透明背景的 Flash 电影

> ID：6778
> 
> 赞同：4
> 
> 时间：2008-08-09T13:54:29.837
> 
> 标签：flash, firefox, safari

Adobe的这个页面说要添加一个“wmode”参数并将其值设置为“透明”： http://kb.adobe.com/selfservice/viewContent.do?externalId= [tn_1420](http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_14201)

这在 IE 中完美运行。背景在 Firefox 和 Safari 中正确呈现，但是一旦您使用浏览器的滚动条然后将鼠标悬停在 Flash 控件上，您必须单击一次以激活该控件。如果您尝试点击 Adob​​e 示例中的播放按钮，您会看到此行为。

有人知道解决这个问题的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-13T13:50:07.673

另一个注意事项; 将 wmode 设置为透明有一些问题。例如，它可以在某些旧版本的 Firefox（2.0 之前）中破坏滚动（闪光灯保持在同一个位置而忽略滚动）。当 wmode 透明时，我也遇到了文本字段中的 ALT 键组合不起作用的问题。

此外，如果您需要将 html-content 放在 flash-content 之上（通常不是一个好主意，但在某些情况下它很有用） wmode=transparent 是要走的路。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-25T13:38:11.063

您知道嵌入时可以设置背景颜色吗？

> 在定义对象和/或嵌入标签时，以下属性是可选的。对于 object ，除非另有说明，否则所有属性都在 param 标签中定义：
> 
> **bgcolor** - [十六进制 RGB 值]，格式为 #RRGGBB 。指定影片的背景颜色。使用此属性覆盖 Flash 文件中指定的背景颜色设置。此属性不影响 HTML 页面的背景颜色。

[从http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_12701&sliceId=1](http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_12701&sliceId=1)剪切粘贴

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-09T14:19:43.420

启用无窗口模式 (wmode=) 使嵌入式 Flash 像其他元素一样操作和渲染。没有它，它会在一个单独的步骤中呈现，并且只是覆盖在浏览器的窗口上。

闪光灯元素会失去焦点吗？听起来输入焦点已移至 scollbar，然后您必须将其移回。

此外，您还不清楚焦点问题是仅在 FF 中还是在 IE 中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-11T14:33:56.527

Adobe 示例在 Firefox 3.0.1 中“有效”，因为背景是透明的。但是，在 Firefox 3.0.1 和 Safari 3.1.2 中，您必须单击两次播放按钮才能看到动画。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-19T20:04:30.350

在花了更多时间之后，我同意@grapefrukt。将 wmode 设置为透明会导致各种奇怪的问题，我认为应该避免。

相反，我求助于将背景颜色作为参数传递。我使用以下 ActionScript 来绘制背景。

```
var parameters:Object = LoaderInfo(this.root.loaderInfo).parameters;
opaqueBackground = parameters["background-color"]; 
```

编辑：感谢@grapefrukt 提醒我 bgcolor 参数（这使得上面的 ActionScript 完全没有必要）

# c# - String.Format 是否与 StringBuilder 一样高效

> ID：6785
> 
> 赞同：161
> 
> 时间：2008-08-09T14:24:05.703
> 
> 标签：c#, vb.net, performance, stringbuilder, string.format

假设我在 C# 中有一个 stringbuilder 执行此操作：

```
StringBuilder sb = new StringBuilder();
string cat = "cat";
sb.Append("the ").Append(cat).(" in the hat");
string s = sb.ToString(); 
```

这是否会像拥有以下内容一样有效或更有效：

```
string cat = "cat";
string s = String.Format("The {0} in the hat", cat); 
```

如果是这样，为什么？

**编辑**

在一些有趣的答案之后，我意识到我可能应该更清楚我所问的问题。我并没有太多要求哪个在连接字符串时更快，但在***将***一个字符串注入另一个字符串时哪个更快。

在上述两种情况下，我都想将一个或多个字符串注入到预定义模板字符串的中间。

对困惑感到抱歉

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2008-08-09T15:57:15.970

**注意：**这个答案是在 .NET 2.0 是当前版本时编写的。这可能不再适用于更高版本。

`String.Format`在内部使用 a `StringBuilder`：

```
public static string Format(IFormatProvider provider, string format, params object[] args)
{
    if ((format == null) || (args == null))
    {
        throw new ArgumentNullException((format == null) ? "format" : "args");
    }

    StringBuilder builder = new StringBuilder(format.Length + (args.Length * 8));
    builder.AppendFormat(provider, format, args);
    return builder.ToString();
} 
```

上面的代码是来自 mscorlib 的一个片段，所以问题变成了“`StringBuilder.Append()`比`StringBuilder.AppendFormat()`”快？

如果没有基准测试，我可能会说上面的代码示例使用`.Append()`. 但这是一个猜测，请尝试对两者进行基准测试和/或分析以获得适当的比较。

这个小伙子 Jerry Dixon 做了一些基准测试：

> [http://jdixon.dotnetdevelopersjournal.com/string_concatenation_stringbuilder_and_stringformat.htm](http://jdixon.dotnetdevelopersjournal.com/string_concatenation_stringbuilder_and_stringformat.htm)

**更新：**

可悲的是，上面的链接已经死了。然而，在返程机器上仍然有一份副本：

> [http://web.archive.org/web/20090417100252/http://jdixon.dotnetdevelopersjournal.com/string_concatenation_stringbuilder_and_stringformat.htm](http://web.archive.org/web/20090417100252/http://jdixon.dotnetdevelopersjournal.com/string_concatenation_stringbuilder_and_stringformat.htm)

归根结底，这取决于您的字符串格式是否会被重复调用，即您正在对超过 100 兆字节的文本进行一些严肃的文本处理，或者当用户不时单击按钮时是否会调用它。除非你正在做一些巨大的批处理工作，否则我会坚持使用 String.Format，它有助于代码的可读性。如果您怀疑性能瓶颈，请在您的代码上粘贴一个分析器，看看它到底在哪里。

* * *

## 回答 #2

> 赞同：45
> 
> 时间：2008-08-09T14:36:45.290

从[MSDN 文档](http://msdn.microsoft.com/en-us/library/system.text.stringbuilder.aspx)：

> String 或 StringBuilder 对象的连接操作的性能取决于内存分配发生的频率。String 连接操作总是分配内存，而 StringBuilder 连接操作仅在 StringBuilder 对象缓冲区太小而无法容纳新数据时才分配内存。因此，如果串联固定数量的 String 对象，则 String 类更适合串联操作。在这种情况下，编译器甚至可以将各个连接操作组合成一个操作。如果串联任意数量的字符串，则 StringBuilder 对象更适合串联操作；例如，如果一个循环连接随机数量的用户输入字符串。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2008-08-09T19:34:51.567

我运行了一些快速的性能基准测试，对于 10 次运行的平均 100,000 次操作，第一种方法（字符串生成器）花费的时间几乎是第二种方法（字符串格式）的一半。

所以，如果这种情况很少发生，那也没关系。但如果是普通操作，那么你可能要使用第一种方法。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-08-09T17:09:10.880

我希望**String.Format**会更慢 - 它必须解析字符串*然后*连接它。

几点注意事项：

*   **格式**是在专业应用程序中获取用户可见字符串的方法；这避免了本地化错误
*   如果您事先知道结果字符串的长度，请使用**StringBuilder(Int32)**构造函数来预定义容量

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-08-09T14:40:00.650

我认为在大多数情况下，您最关心的是这种清晰度，而不是效率。除非您将成吨的绳子压在一起，或者为低功率的移动设备构建一些东西，否则这可能不会对您的运行速度产生太大影响。

我发现，在我以相当线性的方式构建字符串的情况下，直接连接或使用 StringBuilder 是您的最佳选择。如果您正在构建的大部分字符串是动态的，我建议这样做。由于很少有文本是静态的，因此最重要的是清楚每条动态文本的放置位置，以防将来需要更新。

另一方面，如果你谈论的是一大块包含两个或三个变量的静态文本，即使它的效率有点低，我认为你从 string.Format 获得的清晰度让它值得。本周早些时候，当我不得不在 4 页文档的中心放置一点动态文本时，我使用了它。如果将一大段文本更新为一个片段，则比必须更新连接在一起的三个片段更容易。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2015-01-12T12:52:46.433

如果只是因为 string.Format 并没有完全按照您的想法做，那么这里是 6 年后在 Net45 上重新运行的测试。

Concat 仍然是最快的，但实际上相差不到 30%。StringBuilder 和 Format 仅相差 5-10%。运行测试几次，我得到了 20% 的变化。

毫秒，一百万次迭代：

*   串联：367
*   每个键的新 stringBuilder：452
*   缓存的 StringBuilder：419
*   字符串。格式：475

我学到的教训是性能差异是微不足道的，因此它不应该阻止您编写最简单的可读代码。这对我来说是经常但并非总是如此`a + b + c`。

```
const int iterations=1000000;
var keyprefix= this.GetType().FullName;
var maxkeylength=keyprefix + 1 + 1+ Math.Log10(iterations);
Console.WriteLine("KeyPrefix \"{0}\", Max Key Length {1}",keyprefix, maxkeylength);

var concatkeys= new string[iterations];
var stringbuilderkeys= new string[iterations];
var cachedsbkeys= new string[iterations];
var formatkeys= new string[iterations];

var stopwatch= new System.Diagnostics.Stopwatch();
Console.WriteLine("Concatenation:");
stopwatch.Start();

for(int i=0; i<iterations; i++){
    var key1= keyprefix+":" + i.ToString();
    concatkeys[i]=key1;
}

Console.WriteLine(stopwatch.ElapsedMilliseconds);

Console.WriteLine("New stringBuilder for each key:");
stopwatch.Restart();

for(int i=0; i<iterations; i++){
    var key2= new StringBuilder(keyprefix).Append(":").Append(i.ToString()).ToString();
    stringbuilderkeys[i]= key2;
}

Console.WriteLine(stopwatch.ElapsedMilliseconds);

Console.WriteLine("Cached StringBuilder:");
var cachedSB= new StringBuilder(maxkeylength);
stopwatch.Restart();

for(int i=0; i<iterations; i++){
    var key2b= cachedSB.Clear().Append(keyprefix).Append(":").Append(i.ToString()).ToString();
    cachedsbkeys[i]= key2b;
}

Console.WriteLine(stopwatch.ElapsedMilliseconds);

Console.WriteLine("string.Format");
stopwatch.Restart();

for(int i=0; i<iterations; i++){
    var key3= string.Format("{0}:{1}", keyprefix,i.ToString());
    formatkeys[i]= key3;
}

Console.WriteLine(stopwatch.ElapsedMilliseconds);

var referToTheComputedValuesSoCompilerCantOptimiseTheLoopsAway= concatkeys.Union(stringbuilderkeys).Union(cachedsbkeys).Union(formatkeys).LastOrDefault(x=>x[1]=='-');
Console.WriteLine(referToTheComputedValuesSoCompilerCantOptimiseTheLoopsAway); 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-05-23T21:33:21.450

`String.Format`在内部使用`StringBuilder`，因此在逻辑上导致了这样一种想法，即由于更多的开销，它的性能会有所降低。但是，在很大程度上，简单的字符串连接是在其他两个字符串之间注入一个字符串的最快方法。几年前，Rico Mariani 在他的第一次表演测验中证明了这一证据。简单的事实是，当字符串部分的数量已知时（没有限制——你可以连接一千个部分，只要你知道它总是 1000 个部分），连接总是比`StringBuilder`or快`String.Format`。它们可以通过单个内存分配和一系列内存副本来执行。[这](http://blogs.msdn.com/ricom/archive/2004/03/12/performance-quiz-1-of-a-series.aspx)是证据。

下面是一些`String.Concat`方法的实际代码，这些方法最终调用`FillStringChecked`，它使用指针来复制内存（通过反射器提取）：

```
public static string Concat(params string[] values)
{
    int totalLength = 0;

    if (values == null)
    {
        throw new ArgumentNullException("values");
    }

    string[] strArray = new string[values.Length];

    for (int i = 0; i < values.Length; i++)
    {
        string str = values[i];
        strArray[i] = (str == null) ? Empty : str;
        totalLength += strArray[i].Length;

        if (totalLength < 0)
        {
            throw new OutOfMemoryException();
        }
    }

    return ConcatArray(strArray, totalLength);
}

public static string Concat(string str0, string str1, string str2, string str3)
{
    if (((str0 == null) && (str1 == null)) && ((str2 == null) && (str3 == null)))
    {
        return Empty;
    }

    if (str0 == null)
    {
        str0 = Empty;
    }

    if (str1 == null)
    {
        str1 = Empty;
    }

    if (str2 == null)
    {
        str2 = Empty;
    }

    if (str3 == null)
    {
        str3 = Empty;
    }

    int length = ((str0.Length + str1.Length) + str2.Length) + str3.Length;
    string dest = FastAllocateString(length);
    FillStringChecked(dest, 0, str0);
    FillStringChecked(dest, str0.Length, str1);
    FillStringChecked(dest, str0.Length + str1.Length, str2);
    FillStringChecked(dest, (str0.Length + str1.Length) + str2.Length, str3);
    return dest;
}

private static string ConcatArray(string[] values, int totalLength)
{
    string dest = FastAllocateString(totalLength);
    int destPos = 0;

    for (int i = 0; i < values.Length; i++)
    {
        FillStringChecked(dest, destPos, values[i]);
        destPos += values[i].Length;
    }

    return dest;
}

private static unsafe void FillStringChecked(string dest, int destPos, string src)
{
    int length = src.Length;

    if (length > (dest.Length - destPos))
    {
        throw new IndexOutOfRangeException();
    }

    fixed (char* chRef = &dest.m_firstChar)
    {
        fixed (char* chRef2 = &src.m_firstChar)
        {
            wstrcpy(chRef + destPos, chRef2, length);
        }
    }
} 
```

那么，那么：

```
string what = "cat";
string inthehat = "The " + what + " in the hat!"; 
```

享受！

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-08-09T19:51:24.607

哦，最快的是：

```
string cat = "cat";
string s = "The " + cat + " in the hat"; 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-09T14:31:51.117

这真的取决于。对于连接很少的小字符串，实际上仅附加字符串会更快。

```
String s = "String A" + "String B"; 
```

但是对于较大的字符串（非常非常大的字符串），使用 StringBuilder 会更有效。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-09T16:29:55.513

> 在上述两种情况下，我都想将一个或多个字符串注入到预定义模板字符串的中间。

在这种情况下，我建议 String.Format 是最快的，因为它是专门为这个目的而设计的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2010-08-01T18:40:40.097

这实际上取决于您的使用模式。和之间的
详细基准可以在此处找到：[String.Format 不适合密集型日志记录](http://www.liranchen.com/2010/07/stringformat-isnt-suitable-for.html)`string.Join``string,Concat``string.Format`

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-08-09T14:28:47.550

我建议不要，因为 String.Format 不是为连接而设计的，它是为格式化各种输入（如日期）的输出而设计的。

```
String s = String.Format("Today is {0:dd-MMM-yyyy}.", DateTime.Today); 
```

# unix - 如何将 xml 文件编码为 xfdl (base64-gzip)？

> ID：6811
> 
> 赞同：4
> 
> 时间：2008-08-09T15:20:45.090
> 
> 标签：unix, compression, gzip, base64

在阅读其他内容之前，请花点时间阅读[原帖](https://stackoverflow.com/questions/1615/how-can-i-modify-xfdl-files-update-1)。

概述： .xfdl 文件是经过 gzip 压缩的 .xml 文件，然后使用 base64 进行编码。我希望将 .xfdl 解编码为 xml，然后我可以对其进行修改，然后重新编码回 .xfdl 文件。

> xfdl > xml.gz > xml > xml.gz > xfdl

我已经能够获取一个 .xfdl 文件并使用 uudeview 从 base64 对其进行解码：

```
uudeview -i yourform.xfdl 
```

然后用gunzip解压

```
gunzip -S "" < UNKNOWN.001 > yourform-unpacked.xml 
```

生成的 xml 是 100% 可读的，看起来很棒。在不修改 xml 的情况下，我应该能够使用 gzip 重新压缩它：

```
gzip yourform-unpacked.xml 
```

然后用base-64重新编码：

```
base64 -e yourform-unpacked.xml.gz yourform_reencoded.xfdl 
```

如果我的想法是正确的，那么原始文件和重新编码的文件应该是相等的。但是，如果我将 yourform.xfdl 和 yourform_reencoded.xfdl 放在无法比较的范围内，它们就不匹配了。此外，可以在 http://www.grants.gov/help/download_software.jsp#pureedge">.xfdl 查看器中查看原始文件。查看器说重新编码的 xfdl 不可读。

我也尝试过 uuenview 在 base64 中重新编码，它也会产生相同的结果。任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-09T16:56:56.737

据我所知，您找不到已压缩文件的压缩级别。当您压缩文件时，您可以使用 -# 指定压缩级别，其中 # 是从 1 到 9（1 是最快的压缩，9 是最压缩的文件）。在实践中，您永远不应该将压缩文件与已提取并重新压缩的文件进行比较，细微的变化很容易出现。在您的情况下，我将比较 base64 编码版本而不是 gzip 版本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-03-28T22:46:01.223

我在来自[http://iharder.net/base64](http://iharder.net/base64)的 Base64 类的帮助下在 Java 中做到了这一点。

我一直在开发一个在 Java 中进行表单操作的应用程序。我解码文件，从 XML 创建一个 DOM 文档，然后将其写回文件。

我在 Java 中读取文件的代码如下所示：

```
public XFDLDocument(String inputFile) 
        throws IOException, 
            ParserConfigurationException,
            SAXException

{
    fileLocation = inputFile;

    try{

        //create file object
        File f = new File(inputFile);
        if(!f.exists()) {
            throw new IOException("Specified File could not be found!");
        }

        //open file stream from file
        FileInputStream fis = new FileInputStream(inputFile);

        //Skip past the MIME header
        fis.skip(FILE_HEADER_BLOCK.length());   

        //Decompress from base 64                   
        Base64.InputStream bis = new Base64.InputStream(fis, 
                Base64.DECODE);

        //UnZIP the resulting stream
        GZIPInputStream gis = new GZIPInputStream(bis);

        DocumentBuilderFactory dbf = DocumentBuilderFactory.newInstance();
        DocumentBuilder db = dbf.newDocumentBuilder();
        doc = db.parse(gis);

        gis.close();
        bis.close();
        fis.close();

    }
    catch (ParserConfigurationException pce) {
        throw new ParserConfigurationException("Error parsing XFDL from file.");
    }
    catch (SAXException saxe) {
        throw new SAXException("Error parsing XFDL into XML Document.");
    }
} 
```

我在java中的代码看起来像这样将文件写入磁盘：

```
 /**
     * Saves the current document to the specified location
     * @param destination Desired destination for the file.
     * @param asXML True if output needs should be as un-encoded XML not Base64/GZIP
     * @throws IOException File cannot be created at specified location
     * @throws TransformerConfigurationExample
     * @throws TransformerException 
     */
    public void saveFile(String destination, boolean asXML) 
        throws IOException, 
            TransformerConfigurationException, 
            TransformerException  
        {

        BufferedWriter bf = new BufferedWriter(new FileWriter(destination));
        bf.write(FILE_HEADER_BLOCK);
        bf.newLine();
        bf.flush();
        bf.close();

        OutputStream outStream;
        if(!asXML) {
            outStream = new GZIPOutputStream(
                new Base64.OutputStream(
                        new FileOutputStream(destination, true)));
        } else {
            outStream = new FileOutputStream(destination, true);
        }

        Transformer t = TransformerFactory.newInstance().newTransformer();
        t.transform(new DOMSource(doc), new StreamResult(outStream));

        outStream.flush();
        outStream.close();      
    } 
```

希望有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-17T22:57:27.210

我一直在做类似的事情，这应该适用于 php。您必须有一个可写的 tmp 文件夹，并且 php 文件命名为 example.php！

```
 <?php
    function gzdecode($data) {
        $len = strlen($data);
        if ($len < 18 || strcmp(substr($data,0,2),"\x1f\x8b")) {
            echo "FILE NOT GZIP FORMAT";
            return null;  // Not GZIP format (See RFC 1952)
        }
        $method = ord(substr($data,2,1));  // Compression method
        $flags  = ord(substr($data,3,1));  // Flags
        if ($flags & 31 != $flags) {
            // Reserved bits are set -- NOT ALLOWED by RFC 1952
            echo "RESERVED BITS ARE SET. VERY BAD";
            return null;
        }
        // NOTE: $mtime may be negative (PHP integer limitations)
        $mtime = unpack("V", substr($data,4,4));
        $mtime = $mtime[1];
        $xfl   = substr($data,8,1);
        $os    = substr($data,8,1);
        $headerlen = 10;
        $extralen  = 0;
        $extra     = "";
        if ($flags & 4) {
            // 2-byte length prefixed EXTRA data in header
            if ($len - $headerlen - 2 < 8) {
                return false;    // Invalid format
                echo "INVALID FORMAT";
            }
            $extralen = unpack("v",substr($data,8,2));
            $extralen = $extralen[1];
            if ($len - $headerlen - 2 - $extralen < 8) {
                return false;    // Invalid format
                echo "INVALID FORMAT";
            }
            $extra = substr($data,10,$extralen);
            $headerlen += 2 + $extralen;
        }

        $filenamelen = 0;
        $filename = "";
        if ($flags & 8) {
            // C-style string file NAME data in header
            if ($len - $headerlen - 1 < 8) {
                return false;    // Invalid format
                echo "INVALID FORMAT";
            }
            $filenamelen = strpos(substr($data,8+$extralen),chr(0));
            if ($filenamelen === false || $len - $headerlen - $filenamelen - 1 < 8) {
                return false;    // Invalid format
                echo "INVALID FORMAT";
            }
            $filename = substr($data,$headerlen,$filenamelen);
            $headerlen += $filenamelen + 1;
        }

        $commentlen = 0;
        $comment = "";
        if ($flags & 16) {
            // C-style string COMMENT data in header
            if ($len - $headerlen - 1 < 8) {
                return false;    // Invalid format
                echo "INVALID FORMAT";
            }
            $commentlen = strpos(substr($data,8+$extralen+$filenamelen),chr(0));
            if ($commentlen === false || $len - $headerlen - $commentlen - 1 < 8) {
                return false;    // Invalid header format
                echo "INVALID FORMAT";
            }
            $comment = substr($data,$headerlen,$commentlen);
            $headerlen += $commentlen + 1;
        }

        $headercrc = "";
        if ($flags & 1) {
            // 2-bytes (lowest order) of CRC32 on header present
            if ($len - $headerlen - 2 < 8) {
                return false;    // Invalid format
                echo "INVALID FORMAT";
            }
            $calccrc = crc32(substr($data,0,$headerlen)) & 0xffff;
            $headercrc = unpack("v", substr($data,$headerlen,2));
            $headercrc = $headercrc[1];
            if ($headercrc != $calccrc) {
                echo "BAD CRC";
                return false;    // Bad header CRC
            }
            $headerlen += 2;
        }

        // GZIP FOOTER - These be negative due to PHP's limitations
        $datacrc = unpack("V",substr($data,-8,4));
        $datacrc = $datacrc[1];
        $isize = unpack("V",substr($data,-4));
        $isize = $isize[1];

        // Perform the decompression:
        $bodylen = $len-$headerlen-8;
        if ($bodylen < 1) {
            // This should never happen - IMPLEMENTATION BUG!
            echo "BIG OOPS";
            return null;
        }
        $body = substr($data,$headerlen,$bodylen);
        $data = "";
        if ($bodylen > 0) {
            switch ($method) {
                case 8:
                    // Currently the only supported compression method:
                    $data = gzinflate($body);
                    break;
                default:
                    // Unknown compression method
                    echo "UNKNOWN COMPRESSION METHOD";
                return false;
            }
        } else {
            // I'm not sure if zero-byte body content is allowed.
            // Allow it for now...  Do nothing...
            echo "ITS EMPTY";
        }

        // Verifiy decompressed size and CRC32:
        // NOTE: This may fail with large data sizes depending on how
        //       PHP's integer limitations affect strlen() since $isize
        //       may be negative for large sizes.
        if ($isize != strlen($data) || crc32($data) != $datacrc) {
            // Bad format!  Length or CRC doesn't match!
            echo "LENGTH OR CRC DO NOT MATCH";
            return false;
        }
        return $data;
    }
    echo "<html><head></head><body>";
    if (empty($_REQUEST['upload'])) {
        echo <<<_END
    <form enctype="multipart/form-data" action="example.php" method="POST">
    <input type="hidden" name="MAX_FILE_SIZE" value="100000" />
    <table>
    <th>
    <input name="uploadedfile" type="file" />
    </th>
    <tr>
    <td><input type="submit" name="upload" value="Convert File" /></td>
    </tr>
    </table>
    </form>
    _END;

    }
    if (!empty($_REQUEST['upload'])) {
        $file           = "tmp/" . $_FILES['uploadedfile']['name'];
        $orgfile        = $_FILES['uploadedfile']['name'];
        $name           = str_replace(".xfdl", "", $orgfile);
        $convertedfile  = "tmp/" . $name . ".xml";
        $compressedfile = "tmp/" . $name . ".gz";
        $finalfile      = "tmp/" . $name . "new.xfdl";
        $target_path    = "tmp/";
        $target_path    = $target_path . basename($_FILES['uploadedfile']['name']);
        if (move_uploaded_file($_FILES['uploadedfile']['tmp_name'], $target_path)) {
        } else {
            echo "There was an error uploading the file, please try again!";
        }
        $firstline      = "application/vnd.xfdl; content-encoding=\"base64-gzip\"\n";
        $data           = file($file);
        $data           = array_slice($data, 1);
        $raw            = implode($data);
        $decoded        = base64_decode($raw);
        $decompressed   = gzdecode($decoded);
        $compressed     = gzencode($decompressed);
        $encoded        = base64_encode($compressed);
        $decoded2       = base64_decode($encoded);
        $decompressed2  = gzdecode($decoded2);
        $header         = bin2hex(substr($decoded, 0, 10));
        $tail           = bin2hex(substr($decoded, -8));
        $header2        = bin2hex(substr($compressed, 0, 10));
        $tail2          = bin2hex(substr($compressed, -8));
        $header3        = bin2hex(substr($decoded2, 0, 10));
        $tail3          = bin2hex(substr($decoded2, -8));
        $filehandle     = fopen($compressedfile, 'w');
        fwrite($filehandle, $decoded);
        fclose($filehandle);
        $filehandle     = fopen($convertedfile, 'w');
        fwrite($filehandle, $decompressed);
        fclose($filehandle);
        $filehandle     = fopen($finalfile, 'w');
        fwrite($filehandle, $firstline);
        fwrite($filehandle, $encoded);
        fclose($filehandle);
        echo "<center>";
        echo "<table style='text-align:center' >";
        echo "<tr><th>Stage 1</th>";
        echo "<th>Stage 2</th>";
        echo "<th>Stage 3</th></tr>";
        echo "<tr><td>RAW DATA -></td><td>DECODED DATA -></td><td>UNCOMPRESSED DATA -></td></tr>";
        echo "<tr><td>LENGTH: ".strlen($raw)."</td>";
        echo "<td>LENGTH: ".strlen($decoded)."</td>";
        echo "<td>LENGTH: ".strlen($decompressed)."</td></tr>";
        echo "<tr><td><a href='tmp/".$orgfile."'/>ORIGINAL</a></td><td>GZIP HEADER:".$header."</td><td><a href='".$convertedfile."'/>XML CONVERTED</a></td></tr>";
        echo "<tr><td></td><td>GZIP TAIL:".$tail."</td><td></td></tr>";
        echo "<tr><td><textarea cols='30' rows='20'>" . $raw . "</textarea></td>";
        echo "<td><textarea cols='30' rows='20'>" . $decoded . "</textarea></td>";
        echo "<td><textarea cols='30' rows='20'>" . $decompressed . "</textarea></td></tr>";
        echo "<tr><th>Stage 6</th>";
        echo "<th>Stage 5</th>";
        echo "<th>Stage 4</th></tr>";
        echo "<tr><td>ENCODED DATA <-</td><td>COMPRESSED DATA <-</td><td>UNCOMPRESSED DATA <-</td></tr>";
        echo "<tr><td>LENGTH: ".strlen($encoded)."</td>";
        echo "<td>LENGTH: ".strlen($compressed)."</td>";
        echo "<td>LENGTH: ".strlen($decompressed)."</td></tr>";
        echo "<tr><td></td><td>GZIP HEADER:".$header2."</td><td></td></tr>";
        echo "<tr><td></td><td>GZIP TAIL:".$tail2."</td><td></td></tr>";
        echo "<tr><td><a href='".$finalfile."'/>FINAL FILE</a></td><td><a href='".$compressedfile."'/>RE-COMPRESSED FILE</a></td><td></td></tr>";
        echo "<tr><td><textarea cols='30' rows='20'>" . $encoded . "</textarea></td>";
        echo "<td><textarea cols='30' rows='20'>" . $compressed . "</textarea></td>";
        echo "<td><textarea cols='30' rows='20'>" . $decompressed  . "</textarea></td></tr>";
        echo "</table>";
        echo "</center>";
    }
    echo "</body></html>";
    ?> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-12T06:27:45.070

您需要将以下行放在 XFDL 文件的开头：

`application/vnd.xfdl; content-encoding="base64-gzip"`

生成 base64 编码文件后，在文本编辑器中打开它并将上面的行粘贴到第一行。确保 base64'ed 块从第二行的开头开始。

保存并在查看器中尝试！如果仍然无法正常工作，则可能是对 XML 所做的更改以某种方式使其不兼容。在这种情况下，在 XML 被修改之后，但在它被 gzip 和 base64 编码之前，使用 .xfdl 文件扩展名保存它并尝试使用查看器工具打开它。如果文件是有效的 XFDL 格式，查看器应该能够解析和显示未压缩/未编码的文件。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-02-16T20:43:17.513

检查这些：

[http://www.ourada.org/blog/archives/375](http://www.ourada.org/blog/archives/375)

[http://www.ourada.org/blog/archives/390](http://www.ourada.org/blog/archives/390)

它们是用 Python 编写的，而不是 Ruby，但这应该让你非常接近。

该算法实际上适用于标题为 'application/x-xfdl;content-encoding="asc-gzip"' 而不是 'application/vnd.xfdl; content-encoding="base64-gzip"' 但好消息是 PureEdge（又名 IBM Lotus Forms）将毫无问题地打开该格式。

然后最重要的是，这是一个 base64-gzip 解码（在 Python 中），因此您可以进行完整的往返：

```
with open(filename, 'r') as f:
  header = f.readline()
  if header == 'application/vnd.xfdl; content-encoding="base64-gzip"\n':
    decoded = b''
    for line in f:
      decoded += base64.b64decode(line.encode("ISO-8859-1"))
    xml = zlib.decompress(decoded, zlib.MAX_WBITS + 16) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-09T15:57:40.617

gzip 算法的不同实现总是会产生略有不同但仍然正确的文件，原始文件的压缩级别也可能与您运行它的不同。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-09T17:10:48.380

有意思，我试一试。然而，变化并不小。新编码的文件更长，并且在比较前后的二进制文件时，数据几乎完全不匹配。

之前（前三行）

```
H4sIAAAAAAAAC+19eZOiyNb3/34K3r4RT/WEU40ssvTtrhuIuKK44Bo3YoJdFAFZ3D79C6hVVhUq
dsnUVN/qmIkSOLlwlt/JPCfJ/PGf9dwAlorj6pb58wv0LfcFUEzJknVT+/ml2uXuCSJP3kNf/vOQ
+TEsFVkgoDfdn18mnmd/B8HVavWt5TsKI2vKN8magyENiH3Lf9kRfpd817PmF+jpiOhQRFZcXTMV 
```

之后（前三行）：

```
H4sICJ/YnEgAAzEyNDQ2LTExNjk2NzUueGZkbC54bWwA7D1pU+JK19/9FV2+H5wpByEhJMRH
uRUgCMom4DBYt2oqkAZyDQlmQZ1f/3YSNqGzKT3oDH6RdE4vOXuf08vFP88TFcygYSq6dnlM
naWOAdQGuqxoo8vjSruRyGYzfII6/id3dPGjVKwCBK+Zl8djy5qeJ5NPT09nTduAojyCZwN9 
```

正如你所看到`H4SI`的那样，比赛之后就是混乱。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-08T19:28:39.257

gzip 会将文件名放在文件头中，因此 gzip 压缩文件的长度会根据未压缩文件的文件名而有所不同。

如果 gzip 作用于流，则省略文件名并且文件更短一些，因此以下应该可以工作：

gzip yourform-unpacked.xml.gz

然后用base-64重新编码：base64 -e yourform-unpacked.xml.gz yourform_reencoded.xfdl

也许这会产生一个相同长度的文件

# linux - 在 Debian 中映射我的自定义键

> ID：6812
> 
> 赞同：3
> 
> 时间：2008-08-09T15:23:13.620
> 
> 标签：linux, keyboard, debian

我有一个带有一系列非标准按钮的 Microsoft 键盘，例如“邮件”、“搜索”、“网络/主页”等。

能够绑定这些键以便它们执行任意程序会很好。

有人知道如何在 Debian Etch 中做到这一点吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-08-09T15:52:39.443

我不能肯定地说，因为我没有使用 Debian，但如果你使用 Gnome，最简单的方法是运行 gnome-keybinding-properties（系统 > 首选项 > 键盘快捷键）

不要键入诸如`Ctrl`+之类的快捷方式，而是`M`点击键盘上的按钮。

如果您希望通过命令行或使用不同的桌面环境执行此操作，这可能会有所帮助：[不寻常的键和键盘](http://www.tldp.org/HOWTO/Keyboard-and-Console-HOWTO-14.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-08-21T18:09:37.763

运行 Debian，我遇到了同样的问题。我所做的是运行 xev 并查看这些键返回的键码。微软喜欢打破一些标准，所以一些多媒体键不起作用。但是那些会返回一个键码。然后用 xmodmap 编写一个脚本来正确映射这些键。

[Gentoo Wiki](http://gentoo-wiki.com/HOWTO_Use_Multimedia_Keys "如何使用多媒体密钥")有关于如何做这些事情的优秀文档。

我将 xmodmap 脚本放在 ~/.kde/Autostart/ 中，因为我使用的是 kde，但您也可以轻松地将它放在您的主文件夹中，并让您的 .bashrc 或 .profile 获取它。

映射键码后，您可以将这些键分配给桌面环境中的特定操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-15T14:21:01.840

我在 Debian 下为我的 PowerMate 使用了 Gizmo Daemon——它也支持花哨的键盘按键（尽管我还没有尝试过这些按键）。破解 gizmod 让它做我想做的事情非常容易。

[小发明守护进程](http://gizmod.sourceforge.net/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-15T18:37:48.640

有几种不同的方法可以做到这一点，最简单的通常是[keytouch](http://keytouch.sourceforge.net/)，它可能在 Debian 存储库中可用。用户手册在[这里](http://keytouch.sourceforge.net/user_manual/user_manual.html)。不过，您的键盘有可能无法使用它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-27T06:01:10.817

如果您想手动进行，您可以编辑 ~/.xmodmap 并使用 xmodmap ~/.xmodmap 应用修改

# java - Java 搜索中的类文件名必须以 .class 异常结尾

> ID：6816
> 
> 赞同：67
> 
> 时间：2008-08-09T15:40:30.357
> 
> 标签：java, eclipse, search

我希望有人可以帮助我解决我在特定项目中使用 Eclipse 中的 java 搜索功能时遇到的问题。

在一个特定项目上使用 java 搜索时，我收到一条错误消息`Class file name must end with .class`（请参阅下面的堆栈跟踪）。这似乎并没有发生在所有项目上，只是一个特定的项目，所以也许我应该尝试重建一些东西？

我已经尝试过`Project -> Clean`......并关闭 Eclipse，删除所有构建的类文件并重新启动 Eclipse 无济于事。

我在谷歌上找到的唯一参考是[http://www.crazysquirrel.com/computing/java/eclipse/error-during-java-search.jspx](http://www.crazysquirrel.com/computing/java/eclipse/error-during-java-search.jspx)，但不幸的是他的解决方案（关闭，删除类文件，重新启动）对我不起作用。

如果有人可以建议尝试一些东西，或者我可以收集更多信息来帮助追踪它，我将非常感谢您的指点。

```
Version: 3.4.0
Build id: I20080617-2000 
```

也刚刚找到这个线程 - [http://www.myeclipseide.com/PNphpBB2-viewtopic-t-20067.html](http://www.myeclipseide.com/PNphpBB2-viewtopic-t-20067.html) - 这表明当项目名称包含句点时可能会出现同样的问题。不幸的是，我的设置并非如此，所以我仍然卡住了。

```
Caused by: java.lang.IllegalArgumentException: Class file name must end with .class
at org.eclipse.jdt.internal.core.PackageFragment.getClassFile(PackageFragment.java:182)
at org.eclipse.jdt.internal.core.util.HandleFactory.createOpenable(HandleFactory.java:109)
at org.eclipse.jdt.internal.core.search.matching.MatchLocator.locateMatches(MatchLocator.java:1177)
at org.eclipse.jdt.internal.core.search.JavaSearchParticipant.locateMatches(JavaSearchParticipant.java:94)
at org.eclipse.jdt.internal.core.search.BasicSearchEngine.findMatches(BasicSearchEngine.java:223)
at org.eclipse.jdt.internal.core.search.BasicSearchEngine.search(BasicSearchEngine.java:506)
at org.eclipse.jdt.core.search.SearchEngine.search(SearchEngine.java:551)
at org.eclipse.jdt.internal.corext.refactoring.RefactoringSearchEngine.internalSearch(RefactoringSearchEngine.java:142)
at org.eclipse.jdt.internal.corext.refactoring.RefactoringSearchEngine.search(RefactoringSearchEngine.java:129)
at org.eclipse.jdt.internal.corext.refactoring.rename.RenameTypeProcessor.initializeReferences(RenameTypeProcessor.java:594)
at org.eclipse.jdt.internal.corext.refactoring.rename.RenameTypeProcessor.doCheckFinalConditions(RenameTypeProcessor.java:522)
at org.eclipse.jdt.internal.corext.refactoring.rename.JavaRenameProcessor.checkFinalConditions(JavaRenameProcessor.java:45)
at org.eclipse.ltk.core.refactoring.participants.ProcessorBasedRefactoring.checkFinalConditions(ProcessorBasedRefactoring.java:225)
at org.eclipse.ltk.core.refactoring.Refactoring.checkAllConditions(Refactoring.java:160)
at org.eclipse.jdt.internal.ui.refactoring.RefactoringExecutionHelper$Operation.run(RefactoringExecutionHelper.java:77)
at org.eclipse.jdt.internal.core.BatchOperation.executeOperation(BatchOperation.java:39)
at org.eclipse.jdt.internal.core.JavaModelOperation.run(JavaModelOperation.java:709)
at org.eclipse.core.internal.resources.Workspace.run(Workspace.java:1800)
at org.eclipse.jdt.core.JavaCore.run(JavaCore.java:4650)
at org.eclipse.jdt.internal.ui.actions.WorkbenchRunnableAdapter.run(WorkbenchRunnableAdapter.java:92)
at org.eclipse.jface.operation.ModalContext$ModalContextThread.run(ModalContext.java:121) 
```

感谢 McDowell，关闭和打开项目似乎已经修复了它（至少现在是这样）。

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-04-30T20:04:54.843

[对错误 269820](https://bugs.eclipse.org/bugs/show_bug.cgi?id=269820#c9)的评论#9解释了如何删除搜索索引，这似乎是解决其症状是可怕的损坏索引的解决方案

> 在“项目筛选”期间发生内部错误。
> 类文件名必须以 .class 结尾

消息框。

如何删除搜索索引：

1.  关闭日食
2.  删除 <workspace>/.metadata/.plugins/org.eclipse.jdt.core/*.index
3.  删除 <workspace>/.metadata/.plugins/org.eclipse.jdt.core/savedIndexNames.txt
4.  再次启动 Eclipse

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2008-08-09T16:31:32.623

另外两种用于修复某些 Eclipse 特性的通用机制：

*   关闭并打开项目
*   删除项目（但不是从磁盘！）并将其重新导入为现有项目

如果做不到这一点，[bugs.eclipse.org](https://bugs.eclipse.org/bugs/buglist.cgi?query_format=specific&order=relevance+desc&bug_status=__all__&product=JDT&content=Class+file+name+must+end+with+.class)可能会提供答案。

如果工作区缓存了损坏的东西，您可以通过在**workspace/.metadata/.plugins**中四处寻找来删除它。大多数这些东西都是相当短暂的（尽管备份并注意已删除的首选项）。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-11-20T12:58:19.360

前几天收到此错误。尝试手动从我的输出文件夹中删除所有 .class 文件和资源。没用。重新启动我的计算机（WinXP）。没用。在 Eclipse 中关闭我的项目并再次打开它。**工作！！！**希望这可以解决某人的问题。搜索工具对 Eclipse 来说是真正必不可少的。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-08-03T04:54:45.730

我最近也遇到了这个问题，下面的场景对我有用。

1.  关闭日食
2.  删除`<workspace>/.metadata/.plugins/org.eclipse.jdt.core/*.index`
3.  删除`<workspace>/.metadata/.plugins/org.eclipse.jdt.core/savedIndexNames.txt`
4.  再次启动 Eclipse

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-12-14T19:57:12.307

关闭项目对我没有任何帮助。我使用 -clean 标志启动了 eclipse，并且由于某种原因起作用。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-23T10:11:36.643

只是

*   关闭项目
*   清除手动输出文件夹
*   打开项目

（Eclipse 3.5 SR2，内部版本号：20100218-1602）

# performance - 在多核机器上扩展多线程应用程序

> ID：6817
> 
> 赞同：6
> 
> 时间：2008-08-09T15:42:17.840
> 
> 标签：performance, multithreading, scalability, malloc

我正在做一个项目，我们需要更多的性能。随着时间的推移，我们继续改进设计以更多地并行工作（线程和分布式）。然后最新的步骤是将其中的一部分移到具有 16 个内核的新机器上。我发现我们需要重新考虑如何在共享内存模型中扩展至那么多内核。例如，标准内存分配器不够好。

人们会推荐什么资源？

到目前为止，我发现 Sutter 的专栏 Dr. Dobbs 是一个好的开始。我刚拿到多处理器编程的艺术和关于英特尔线程构建块的 O'Reilly 书

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-08-09T22:13:12.233

其他几本书会有所帮助：

*   [同步算法和并发编程](https://rads.stackoverflow.com/amzn/click/com/0131972596 "同步算法和并发编程")
*   [并行编程模式](https://rads.stackoverflow.com/amzn/click/com/0321228111 "并行编程模式")
*   [CAR Hoare 的通信顺序过程](http://www.usingcsp.com/ "通信顺序过程")（该链接上的经典免费 PDF）

此外，考虑减少对并发进程之间共享状态的依赖。如果你能避免它，你会扩展得更好，因为你将能够分出独立的工作单元，而不必在它们之间进行尽可能多的同步。

即使您需要共享某些状态，请查看是否可以将共享状态与实际处理分开。这将使您能够并行执行尽可能多的处理，独立于将已完成的工作单元集成回共享状态。显然，如果您在工作单元之间存在依赖关系，这将不起作用，但值得研究而不是仅仅假设状态总是将被共享。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-08-09T16:59:53.190

您可能想查看[Google 的性能工具](http://code.google.com/p/google-perftools/wiki/GooglePerformanceTools)。他们发布了用于多线程应用程序的 malloc 版本。它还包括一组不错的分析工具。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-09T17:19:00.610

Jeffrey Richter 非常喜欢线程化。他的书中有几章是关于线程的，请查看他的博客：

[http://www.wintellect.com/cs/blogs/jeffreyr/default.aspx](http://www.wintellect.com/cs/blogs/jeffreyr/default.aspx)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-09T23:26:30.570

正如 monty python 所说的“现在换一种完全不同的东西”——你可以尝试一种不使用线程，而是使用进程和消息传递（无共享状态）的语言/环境。最成熟的一种是 erlang（以及这本出色而有趣的书： http: [//www.pragprog.com/titles/jaerlang/programming-erlang](http://www.pragprog.com/titles/jaerlang/programming-erlang)）。可能与您的情况不完全相关，但您仍然可以学到很多可以在其他工具中应用的想法。

对于其他环境：

.Net 有 F#（学习函数式编程）。JVM 有 Scala（它有演员，很像 Erlang，是功能性混合语言）。还有来自 Doug Lea for Java 的“fork join”框架，它为您做了很多艰苦的工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-09T18:51:36.803

FreeBSD 中的分配器最近获得了 FreeBSD 7 的更新。新的称为[jemaloc](http://people.freebsd.org/~jasone/jemalloc/bsdcan2006/jemalloc.pdf)，显然对于多线程而言更具可扩展性。

您没有提到您使用的是哪个平台，所以也许这个分配器可供您使用。（我相信[Firefox 3 使用 jemalloc](http://blog.pavlov.net/2008/02/05/jemalloc-now-on-the-trunk/)，即使在 Windows 上也是如此。所以端口必须存在于某处。）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-10T13:45:43.970

如果您正在进行大量内存分配，请查看[Hoard 。](http://www.hoard.org/)

滚动您自己的[无锁列表](http://www.boyet.com/Articles/LockfreeFreeList.html)。一个很好的资源在这里 - 它在 C# 中，但想法是可移植的。一旦你习惯了它们的工作方式，你就会开始看到其他可以使用它们的地方，而不仅仅是在列表中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-10T16:15:10.097

我将不得不在某个时候检查 Hoard、Google Perftools 和 jemalloc。目前，我们使用的是 Intel Threading Building Blocks 中的可扩展的_malloc，它的性能足够好。

不管好坏，我们在 Windows 上使用 C++，尽管我们的大部分代码都可以用 gcc 编译。除非有令人信服的理由迁移到 redhat（我们使用的主要 linux 发行版），否则我怀疑迁移是否值得头痛/政治麻烦。

我很想使用 Erlang，但现在有很多方法可以重做。如果我们考虑在电信环境中围绕 Erlang 开发的需求，它们与我们的世界（电子交易）非常相似。阿姆斯特朗的书在我的书架上：）

在我从 4 核扩展到 16 核的测试中，我学会了理解代码并行部分中任何锁定/争用的成本。幸运的是，我们有很大一部分可以随数据扩展，但由于额外的锁和内存分配器，即使这样一开始也不起作用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-26T12:07:21.557

我维护了一个可能持续感兴趣的并发链接博客：

[http://concurrency.tumblr.com](http://concurrency.tumblr.com)

# security - 防御性编程

> ID：6847
> 
> 赞同：11
> 
> 时间：2008-08-09T17:02:56.663
> 
> 标签：security, defensive-programming

在编写代码时，您是否有意识地进行防御性编程以确保高程序质量并避免您的代码被恶意利用的可能性，例如通过缓冲区溢出利用或代码注入？

您将始终应用于代码的“最低”质量水平是多少？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-08-09T18:00:26.907

在我的工作中，我们的代码必须是最高质量的。
所以，我们主要关注两点：

1.  测试
2.  代码审查

那些把钱带回家。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-08-09T18:05:09.363

与 abyx 类似，在我所在的团队中，开发人员总是使用单元测试和代码审查。除此之外，我还旨在确保我不包含人们*可能*使用的代码——我倾向于只为手头的对象按照规范运行所需的基本方法集编写代码. 我发现合并可能永远不会使用但提供功能的方法可能会无意中在系统中引入“后门”或意外/意外使用。

稍后返回并介绍被询问的方法、属性和属性要比预测可能永远不会发生的事情要容易得多。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-08-10T09:26:45.617

我建议对进入“组件”或框架的数据采取防御措施。在“组件”或框架内，人们应该认为数据是“正确的”。

这样想。由调用者提供正确的参数，否则所有函数和方法都必须检查每个传入参数。但是，如果只为调用者进行检查，则只需要检查一次。因此，参数应该是“正确的”，因此可以传递到较低的级别。

1.  始终检查来自外部来源、用户等的数据
2.  “组件”或框架应始终检查传入调用。

如果有错误并且在调用中使用了错误的值。什么是真正正确的事情？只有一个迹象表明程序正在处理的“数据”是错误的，有些像 ASSERTS 但其他人希望使用高级错误报告和可能的错误恢复。在任何情况下，都会发现数据有问题，在少数情况下，最好继续处理它。（请注意，如果服务器至少不死，那很好）

从卫星发送的图像可能是尝试高级错误恢复的案例...从互联网下载的图像以放置错误图标...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-08-13T18:15:11.803

我建议人们编写在开发环境中是法西斯主义而在生产环境中仁慈的代码。

在开发过程中，您希望尽早捕获错误的数据/逻辑/代码，以防止问题被忽视或导致难以追踪根本原因的后期问题。

在生产中尽可能优雅地处理问题。如果某事确实是不可恢复的错误，则处理它并将该信息呈现给用户。

作为一个例子，这里是我们规范化向量的代码。如果你在开发中给它输入错误的数据，它会尖叫，在生产中它会返回一个安全值。

```
inline const Vector3 Normalize( Vector3arg vec )
{
    const float len = Length(vec);
    ASSERTMSG(len > 0.0f "Invalid Normalization");
    return len == 0.0f ? vec : vec / len;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-08-09T17:09:25.853

我总是努力防止诸如注入攻击之类的事情。但是，当您在内部 Intranet 站点上工作时，大多数安全功能都感觉像是白费力气。我仍然做他们，也许不是那么好。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-09T17:47:10.223

嗯，有一套安全的最佳实践。至少，对于数据库应用程序，您需要注意 SQL 注入。

散列密码、加密连接字符串等其他内容也是标准。

从这里开始，这取决于实际应用。

幸运的是，如果您使用 .Net 等框架，则内置了很多安全保护。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-09T17:54:50.303

即使对于内部应用程序，您也必须始终进行防御性编程，这仅仅是因为用户可能只是靠运气编写的东西会破坏您的应用程序。当然，您可能不必担心试图骗取您的钱，但仍然如此。始终进行防御性编程并假设应用程序将失败。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-08-10T00:53:35.183

使用测试驱动开发当然有帮助。您一次编写一个组件，然后在编写代码之前枚举所有潜在的输入案例（通过测试）。这可以确保您已经涵盖了所有基础并且没有编写任何没有人会使用但可能会破坏的***酷代码。***

虽然我没有做任何正式的事情，但我通常会花一些时间查看每节课并确保：

1.  如果它们处于有效状态，则它们保持在有效状态
2.  无法在无效状态下构造它们
3.  在特殊情况下，它们会尽可能优雅地失败（通常这是清理和抛出）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-10T08:13:50.303

这取决于。

如果我真的想为自己使用一些东西，那么我将编写我不必考虑的最好的代码。让编译器成为我警告等的朋友，但我不会自动为它创建类型。

代码被使用的可能性越大，即使是偶尔，我也会提高检查级别。

*   最小幻数
*   更好的变量名
*   完全检查和定义的数组/字符串长度
*   通过合约断言编程
*   空值检查
*   异常（取决于代码的上下文）
*   基本解释性意见
*   可访问的使用文档（如果 perl 等）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-08-10T08:26:46.703

我将对防御性编程采用不同的定义，正如Josh Bloch的*[Effective Java所倡导的那样。](http://java.sun.com/docs/books/effective/)*在书中，他谈到了如何处理调用者传递给你的代码的可变对象（例如，在 setter 中），以及你传递给调用者的可变对象（例如，在 getter 中）。

*   对于 setter，请确保克隆任何可变对象，并存储克隆。这样，调用者就不能在事后更改传入的对象以破坏程序的不变量。
*   对于 getter，如果接口允许，则返回内部数据的不可变视图；否则返回内部数据的克隆。
*   当使用内部数据调用用户提供的回调时，酌情发送不可变视图或克隆，除非您打算通过回调更改数据，在这种情况下，您必须在事后验证它。

带回家的信息是确保没有外部代码可以为您在内部使用的任何可变对象保存别名，以便您可以维护您的不变量。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-08-10T11:27:30.960

我非常认为正确的编程可以防止这些风险。诸如避免已弃用的函数（至少在 Microsoft C++ 库中）由于安全漏洞而通常被弃用，以及验证跨越外部边界的所有内容。

仅从您的代码调用的函数不应该需要过多的参数验证，因为您控制调用者，即不跨越外部边界。其他人的代码调用的函数应该假设传入的参数在某些时候是无效的和/或恶意的。

我处理暴露函数的方法是简单地崩溃，如果可能的话，提供有用的信息。如果调用者无法正确获取参数，那么问题出在他们的代码中，他们应该修复它，而不是你。（显然你已经为你的函数提供了文档，因为它是公开的。）

只有当您的应用程序能够提升当前用户时，代码注入才是一个问题。如果一个进程可以将代码注入您的应用程序，那么它可以轻松地将代码写入内存并执行它。如果无法完全访问系统代码注入攻击是没有意义的。（这就是为什么管理员使用的应用程序不应该被较小的用户写入。）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-08-13T17:36:12.633

根据我的经验，积极采用防御性编程并不一定意味着您最终会提高代码质量。不要误会我的意思，你需要防御性地编程来捕捉用户会遇到的各种问题——当你的程序崩溃时用户不喜欢它——但这不太可能使代码更容易维护，测试等

几年前，我们制定了在我们软件的所有级别使用断言的政策，这与单元测试、代码审查等以及我们现有的应用程序测试套件一起对我们的代码质量产生了显着的积极影响。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-05T05:31:09.540

Java、签名的 JAR 和 JAAS。

Java 防止缓冲区溢出和指针/堆栈攻击。

不要使用 JNI。(Java Native Interface) 它向您展示 DLL/共享库。

签署 JAR 以阻止类加载成为安全问题。

JAAS 可以让您的应用程序不信任任何人，甚至不信任它自己。

J2EE 具有（诚然有限的）对基于角色的安全性的内置支持。

其中一些有一些开销，但安全漏洞消失了。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-09-07T11:28:38.657

简单的回答：**这取决于**. 过多的防御性编码**会**导致严重的性能问题。

# plugins - 为魔兽世界开发插件 - 开始？

> ID：6859
> 
> 赞同：18
> 
> 时间：2008-08-09T17:51:09.313
> 
> 标签：plugins, lua, add-on, world-of-warcraft

作为一个长期的魔兽世界玩家和一个热情的开发者，我决定将两者结合起来并着手开发一些插件。不仅是为了改善我的游戏体验，也是学习新事物的好机会。

有人对如何开始有任何建议吗？

有可以使用的IDE吗？如何进行测试？有现成的图书馆吗？或者我会通过忽略库并从头开始构建来获得更好的学习体验吗？我如何单枪击霍格？

很想听听您的建议、经验和观点。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-08-09T18:01:57.497

[这篇文章](http://www.wowwiki.com/Getting_started_with_writing_addons)解释了如何很好地开始。

你的第一个书签可能是美国界面论坛，尤其是那个 Stickies：

[http://us.battle.net/wow/en/forum/1011693/](http://us.battle.net/wow/en/forum/1011693/)

然后，获取一些简单的插件来了解 XML 和 LUA 如何交互。[WoWWiki HOWTO 列表](http://www.wowwiki.com/Category:HOWTOs)在这里也是一个好点。

需要记住的一件重要事情是：魔兽世界有多种语言版本。如果您有欧盟账户，您只需下载西班牙语、德语和法语的语言包，即可获得出色的测试平台。如果您是美国人，请检查您是否可以获得拉丁美洲版本。这样，您可以针对其他语言版本对其进行测试。

一旦您制作了 1 或 2 个非常小而简单的插件来学习如何使用它，请查看各种框架。[WowAce](http://www.wowace.com/)很受欢迎，但还有其他的。

请记住一件事：制作插件是工作。维护一个甚至是更多的工作。每个新补丁都可能发生重大变化，而下一个插件肯定会引起大量的插件外流，就像补丁 2.0.1 所做的那样。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-08-09T19:25:25.487

你可能喜欢的另一个有用的工具是[WarcraftAddOnStudio](http://www.codeplex.com/WarcraftAddOnStudio)，它可以让你在 Visual Studio 环境中制作插件。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-11T03:03:49.857

我主要通过查看暴雪 UI 的代码来学习附加组件的艺术。[您可以通过提取默认 UI](http://us.blizzard.com/support/article.xml?articleId=21466)或[在线查找默认 UI 的副本](http://wowcompares.com/)来查看该代码。附加组件开发人员有时喜欢过度设计他们的宠物项目（谁不呢？），而暴雪的代码通常非常严肃和简单。此外，[《Lua 编程》](http://www.lua.org/pil/)对于实际的 Lua 语言来说是一个非常有用的（如果稍微有点过时的话）参考。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-02T15:09:18.317

最好的方法是从《**魔兽世界编程**》这本书开始。它涵盖了 LUA、XML、WarcraftAddOnStudio 和 WoW API。本书还包含有关最佳实践和避免常见错误的部分。

# c# - 如何在继续之前等待线程完成？

> ID：6890
> 
> 赞同：13
> 
> 时间：2008-08-09T20:00:37.647
> 
> 标签：c#, multithreading, compact-framework

我有一些用于在 .NET CF 2.0 上启动线程的代码：

```
ThreadStart tStart = new ThreadStart(MyMethod);
Thread t = new Thread(tStart);
t.Start(); 
```

如果我在循环中调用它，则项目完全乱序。如何引入 wait after `t.Start()`，以便在代码继续之前完成线程上的工作？BeginInvoke/EndInvoke 会比手动创建线程更好吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-08-10T08:37:28.383

您需要对线程施加多少顺序？如果您只需要在代码继续之前完成循环中开始的所有工作，但您不关心循环中的工作完成的顺序，那么调用 Join 就是答案。要为[Kevin Kenny 的答案添加更多细节，](https://stackoverflow.com/questions/6890/compact-framework-how-to-wait-for-thread-complete-before-continuing#6935)您应该在循环*外*调用 Join 。这意味着您将需要一个集合来保存对您启动的线程的引用：

```
// Start all of the threads.
List<Thread> startedThreads = new List<Thread>();
foreach (...) {
  Thread thread = new Thread(new ThreadStart(MyMethod));
  thread.Start();
  startedThreads.Add(thread);
}

// Wait for all of the threads to finish.
foreach (Thread thread in startedThreads) {
  thread.Join();
} 
```

相反，如果你在循环内部调用 Join，结果基本上和完全不使用线程是一样的。循环体的每次迭代都会创建并启动一个线程，然后立即加入它并等待它完成。

如果各个线程产生了一些结果（例如，在日志中写入消息），那么消息可能仍会出现乱序，因为线程之间没有协调。通过与监视器协调，可以让线程按顺序输出它们的结果。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-20T12:54:56.200

等待线程完成的另一种方法是使用`AutoResetEvent`.

```
private readonly AutoResetEvent mWaitForThread = new AutoResetEvent(false);

private void Blah()
{
    ThreadStart tStart = new ThreadStart(MyMethod);
    Thread t = new Thread(tStart);
    t.Start();

    //... (any other things)
    mWaitForThread.WaitOne();
}

private void MyMethod()
{
     //... (execute any other action)
     mWaitForThread.Set();
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-08-09T22:32:07.840

如果我没看错，您是在一堆线程上开始工作项目，但您担心线程正在乱序完成，并且宁愿等到每个线程按照它们开始的顺序完成？

如果是这种情况，那么我不确定您为什么要为每个工作项创建一个线程。也许你可以扩展？

如果您确实需要等待线程完成，您可以这样做：

```
t.Join(); 
```

# .net - 抛出异常的性能注意事项

> ID：6891
> 
> 赞同：9
> 
> 时间：2008-08-09T20:01:09.050
> 
> 标签：.net, exception, optimization, performance

我多次遇到以下类型的代码，我想知道这是否是一种好的做法（从性能的角度来看）：

```
try
{
    ... // some code
}
catch (Exception ex)
{
    ... // Do something
    throw new CustomException(ex);
} 
```

基本上，编码人员所做的是他们将异常包含在自定义异常中并再次抛出该异常。

这在性能上与以下两个有何不同：

```
try
{
    ... // some code
}
catch (Exception ex)
{
    .. // Do something
    throw ex;
} 
```

或者

```
try
{
    ... // some code
}
catch (Exception ex)
{
    .. // Do something
    throw;
} 
```

抛开任何功能或编码最佳实践论点，这 3 种方法之间是否存在性能差异？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-08-09T21:17:35.057

@布拉德·塔特罗

在第一种情况下异常不会丢失，它被传递给构造函数。我会同意你的其余部分，第二种方法是一个非常糟糕的主意，因为堆栈跟踪的丢失。当我使用 .NET 时，我遇到了很多其他程序员这样做的情况，当我需要查看异常的真正原因时，我感到非常沮丧，却发现它从一个巨大的 try 块中被重新抛出，其中我现在不知道问题出在哪里。

我也赞同布拉德的评论，即你不应该担心表现。这种微优化是一个可怕的想法。除非您正在谈论在长时间运行的 for 循环的每次迭代中抛出异常，否则您很可能不会因使用异常而遇到性能问题。

当您有指标表明您需要优化性能时，请始终优化性能，然后点击被证明是罪魁祸首的地方。

拥有易于调试功能的可读代码（IE 不隐藏堆栈跟踪）比让某些东西运行得快一纳秒要好得多。

关于将异常包装到自定义异常中的最后一点说明......这可能是一个非常有用的构造，尤其是在处理 UI 时。您可以将每个已知且合理的异常情况包装到一些基本自定义异常（或从所述基本异常扩展的异常）中，然后 UI 可以捕获此基本异常。当被捕获时，异常需要提供向用户显示信息的方法，比如 ReadableMessage 属性，或者类似的东西。因此，任何时候 UI 遗漏一个异常，都是因为你需要修复一个错误，而任何时候它捕捉到一个异常，它都是一个已知的错误情况，可以并且应该由 UI 正确处理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-09T20:58:21.243

像大卫一样，我认为第二个和第三个表现更好。但是，这三者中的任何一个会表现得差到足以花时间担心它吗？我认为还有比性能更大的问题要担心。

FxCop 总是推荐第三种方法而不是第二种方法，这样原始堆栈跟踪就不会丢失。

*编辑：删除了完全错误的内容，Mike 很友好地指出了这一点。*

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-09T21:01:14.187

显然，您会因创建新对象（新异常）而受到惩罚，因此，正如您对附加到程序的每一行代码所做的那样，您必须确定更好的异常分类是否为额外的工作付出了代价。

作为做出该决定的一条建议，如果您的新对象没有携带有关异常的额外信息，那么您可能会忘记构建新的异常。

但是，在其他情况下，具有异常层次结构对于您的类的用户来说非常方便。假设您正在实现 Facade 模式，到目前为止考虑的场景都不是很好：

1.  将每个异常都作为异常对象提出是不好的，因为您正在丢失（可能）有价值的信息
2.  既不举起你捕捉到的每一种物体也不好，因为这样做你在创建立面时失败了

在这个假设的情况下，更好的做法是创建异常类的层次结构，将用户从系统的内部复杂性中抽象出来，让他们了解所产生的异常类型。

作为旁注：

我个人不喜欢使用异常（从 Exception 类派生的类的层次结构）来实现逻辑。就像在这种情况下：

```
try {
        // something that will raise an exception almost half the time
} catch( InsufficientFunds e) {
        // Inform the customer is broke
} catch( UnknownAccount e ) {
        // Ask for a new account number
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-16T14:24:37.277

不要这样做：

```
try
{
    // some code
}
catch (Exception ex) { throw ex; } 
```

因为这将丢失堆栈跟踪。

而是这样做：

```
try
{
    // some code
}
catch (Exception ex) { throw; } 
```

只需抛出即可，如果您希望它成为新自定义异常的内部异常，您只需要传递异常变量。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-08-10T01:03:49.720

正如其他人所说，最好的性能来自底部，因为你只是重新抛出一个现有的对象。中间的最不正确，因为它丢失了堆栈。

如果我想解耦代码中的某些依赖项，我个人会使用自定义异常。例如，我有一个从 XML 文件加载数据的方法。这可能会以许多不同的方式出错。

它可能无法从磁盘读取（FileIOException），用户可能会尝试从不允许的地方访问它（SecurityException），文件可能已损坏（XmlParseException），数据可能格式错误（DeserialisationException）。

在这种情况下，调用类更容易理解这一切，所有这些异常都会重新抛出一个自定义异常 (FileOperationException)，这意味着调用者不需要引用 System.IO 或 System.Xml，但仍然可以通过枚举和任何重要信息访问发生的错误。

如前所述，不要尝试对这样的东西进行微优化，抛出异常的行为是这里发生的最慢的事情。最好的改进是尽量避免异常。

```
public bool Load(string filepath)
{
  if (File.Exists(filepath)) //Avoid throwing by checking state
  {
    //Wrap anyways in case something changes between check and operation
    try { .... }
    catch (IOException ioFault) { .... }
    catch (OtherException otherFault) { .... }
    return true; //Inform caller of success
  }
  else { return false; } //Inform caller of failure due to state
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-08-09T20:50:35.503

第一个示例中的 throw 具有创建新 CustomException 对象的开销。

第二个示例中的重新抛出将抛出 Exception 类型的异常。

第三个示例中的重新引发将引发与“某些代码”引发的相同类型的异常。

所以第二个和第三个例子使用的资源更少。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-08-10T00:47:17.023

从纯粹的性能角度来看，我猜第三种情况是性能最高的。另外两个需要提取堆栈跟踪并构造新对象，这两者都可能相当耗时。

话虽如此，这三个代码块具有**非常**不同的（外部）行为，因此比较它们就像询问 QuickSort 是否比向红黑树中添加项目更有效。这并不像选择正确的事情那么重要。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T12:56:02.500

等等……如果抛出异常，我们为什么要关心性能？除非我们将异常用作正常应用程序流程的一部分（这是 WAYYYY 对最佳实践的做法）。

我只看到了与成功有关的性能要求，但从未看到失败的性能要求。

# sql - 如何创建 SQL Server 函数以将子查询中的多行“加入”到单个分隔字段中？

> ID：6899
> 
> 赞同：204
> 
> 时间：2008-08-09T20:11:18.467
> 
> 标签：sql, sql-server, string-concatenation

为了说明，假设我有两个表，如下所示：

```
VehicleID Name
1         Chuck
2         Larry

LocationID VehicleID City
1          1         New York
2          1         Seattle
3          1         Vancouver
4          2         Los Angeles
5          2         Houston 
```

我想编写一个查询以返回以下结果：

```
VehicleID Name    Locations
1         Chuck   New York, Seattle, Vancouver
2         Larry   Los Angeles, Houston 
```

我知道这可以使用服务器端游标来完成，即：

```
DECLARE @VehicleID int
DECLARE @VehicleName varchar(100)
DECLARE @LocationCity varchar(100)
DECLARE @Locations varchar(4000)
DECLARE @Results TABLE
(
  VehicleID int
  Name varchar(100)
  Locations varchar(4000)
)

DECLARE VehiclesCursor CURSOR FOR
SELECT
  [VehicleID]
, [Name]
FROM [Vehicles]

OPEN VehiclesCursor

FETCH NEXT FROM VehiclesCursor INTO
  @VehicleID
, @VehicleName
WHILE @@FETCH_STATUS = 0
BEGIN

  SET @Locations = ''

  DECLARE LocationsCursor CURSOR FOR
  SELECT
    [City]
  FROM [Locations]
  WHERE [VehicleID] = @VehicleID

  OPEN LocationsCursor

  FETCH NEXT FROM LocationsCursor INTO
    @LocationCity
  WHILE @@FETCH_STATUS = 0
  BEGIN
    SET @Locations = @Locations + @LocationCity

    FETCH NEXT FROM LocationsCursor INTO
      @LocationCity
  END
  CLOSE LocationsCursor
  DEALLOCATE LocationsCursor

  INSERT INTO @Results (VehicleID, Name, Locations) SELECT @VehicleID, @Name, @Locations

END     
CLOSE VehiclesCursor
DEALLOCATE VehiclesCursor

SELECT * FROM @Results 
```

但是，如您所见，这需要大量代码。我想要的是一个通用函数，它可以让我做这样的事情：

```
SELECT VehicleID
     , Name
     , JOIN(SELECT City FROM Locations WHERE VehicleID = Vehicles.VehicleID, ', ') AS Locations
FROM Vehicles 
```

这可能吗？或者类似的东西？

* * *

## 回答 #1

> 赞同：272
> 
> 时间：2008-08-10T01:05:00.980

如果您使用的是 SQL Server 2005，则可以使用 FOR XML PATH 命令。

```
SELECT [VehicleID]
     , [Name]
     , (STUFF((SELECT CAST(', ' + [City] AS VARCHAR(MAX)) 
         FROM [Location] 
         WHERE (VehicleID = Vehicle.VehicleID) 
         FOR XML PATH ('')), 1, 2, '')) AS Locations
FROM [Vehicle] 
```

它比使用游标容易得多，而且似乎工作得很好。

**更新**

对于仍在使用此方法和较新版本的 SQL Server 的任何人，还有另一种 [`STRING_AGG`](https://docs.microsoft.com/en-us/sql/t-sql/functions/string-agg-transact-sql?view=sql-server-ver15)方法，使用自 SQL Server 2017 以来可用的方法更容易且性能更高。

```
SELECT  [VehicleID]
       ,[Name]
       ,(SELECT STRING_AGG([City], ', ')
         FROM [Location]
         WHERE VehicleID = V.VehicleID) AS Locations
FROM   [Vehicle] V 
```

这也允许将不同的分隔符指定为第二个参数，从而比前一种方法提供更多的灵活性。

* * *

## 回答 #2

> 赞同：89
> 
> 时间：2008-08-10T13:15:20.023

请注意，[Matt 的代码](https://stackoverflow.com/questions/6899/how-to-create-a-sql-server-function-to-join-multiple-rows-from-a-subquery-into#6961)会在字符串末尾产生一个额外的逗号；如 Lance 帖子中的链接所示，使用 COALESCE （或 ISNULL ）使用类似的方法，但不会给您留下额外的逗号要删除。为了完整起见，以下是 Lance 在 sqlteam.com 上的链接中的相关代码：

```
DECLARE @EmployeeList varchar(100)
SELECT @EmployeeList = COALESCE(@EmployeeList + ', ', '') + 
    CAST(EmpUniqueID AS varchar(5))
FROM SalesCallsEmployees
WHERE SalCal_UniqueID = 1 
```

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2008-08-10T00:12:25.953

我不相信有办法在一个查询中做到这一点，但你可以用一个临时变量来玩这样的把戏：

```
declare @s varchar(max)
set @s = ''
select @s = @s + City + ',' from Locations

select @s 
```

这绝对比在光标上移动的代码少，而且可能更有效。

* * *

## 回答 #4

> 赞同：26
> 
> 时间：2011-01-06T15:20:41.437

在单个 SQL 查询中，不使用 FOR XML 子句。
公用表表达式用于递归连接结果。

```
-- rank locations by incrementing lexicographical order
WITH RankedLocations AS (
  SELECT
    VehicleID,
    City,
    ROW_NUMBER() OVER (
        PARTITION BY VehicleID 
        ORDER BY City
    ) Rank
  FROM
    Locations
),
-- concatenate locations using a recursive query
-- (Common Table Expression)
Concatenations AS (
  -- for each vehicle, select the first location
  SELECT
    VehicleID,
    CONVERT(nvarchar(MAX), City) Cities,
    Rank
  FROM
    RankedLocations
  WHERE
    Rank = 1

  -- then incrementally concatenate with the next location
  -- this will return intermediate concatenations that will be 
  -- filtered out later on
  UNION ALL

  SELECT
    c.VehicleID,
    (c.Cities + ', ' + l.City) Cities,
    l.Rank
  FROM
    Concatenations c -- this is a recursion!
    INNER JOIN RankedLocations l ON
        l.VehicleID = c.VehicleID 
        AND l.Rank = c.Rank + 1
),
-- rank concatenation results by decrementing length 
-- (rank 1 will always be for the longest concatenation)
RankedConcatenations AS (
  SELECT
    VehicleID,
    Cities,
    ROW_NUMBER() OVER (
        PARTITION BY VehicleID 
        ORDER BY Rank DESC
    ) Rank
  FROM 
    Concatenations
)
-- main query
SELECT
  v.VehicleID,
  v.Name,
  c.Cities
FROM
  Vehicles v
  INNER JOIN RankedConcatenations c ON 
    c.VehicleID = v.VehicleID 
    AND c.Rank = 1 
```

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2010-06-23T02:08:33.647

从我所看到`FOR XML`的（如前所述）来看，如果您还想像 OP 那样选择其他列（我猜大多数人会这样做），这是唯一的方法。使用`COALESCE(@var...`不允许包含其他列。

更新：感谢[programmingsolutions.net](http://blog.programmingsolution.net/sql-server-2008/comma-separated-list-csv-of-rows-of-a-column-using-for-xml-path)，有一种方法可以删除“尾随”逗号。通过将其设为前导逗号并使用`STUFF`MSSQL 的功能，您可以将第一个字符（前导逗号）替换为空字符串，如下所示：

```
stuff(
    (select ',' + Column 
     from Table
         inner where inner.Id = outer.Id 
     for xml path('')
), 1,1,'') as Values 
```

* * *

## 回答 #6

> 赞同：21
> 
> 时间：2010-09-09T00:15:49.720

## 在[SQL Server 2005中](http://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2005)

```
SELECT Stuff(
  (SELECT N', ' + Name FROM Names FOR XML PATH(''),TYPE)
  .value('text()[1]','nvarchar(max)'),1,2,N'') 
```

* * *

## 在 SQL Server 2016 中

您可以使用[FOR JSON 语法](https://docs.microsoft.com/en-us/sql/t-sql/queries/select-for-clause-transact-sql)

IE

```
SELECT per.ID,
Emails = JSON_VALUE(
   REPLACE(
     (SELECT _ = em.Email FROM Email em WHERE em.Person = per.ID FOR JSON PATH)
    ,'"},{"_":"',', '),'$[0]._'
) 
FROM Person per 
```

结果会变成

```
Id  Emails
1   abc@gmail.com
2   NULL
3   def@gmail.com, xyz@gmail.com 
```

即使您的数据包含无效的 XML 字符，这也可以工作

'"},{" *":"' 是安全的，因为如果您的数据包含 '"},{"* ":"'，它将被转义为 "},{\"_\":\"

您可以用任何字符串分隔符替换 ', '

* * *

## 而在 SQL Server 2017 中，Azure SQL 数据库

您可以使用新的[STRING_AGG 函数](https://docs.microsoft.com/en-us/sql/t-sql/functions/string-agg-transact-sql)

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2009-06-18T12:41:27.120

以下代码适用于 Sql Server 2000/2005/2008

```
CREATE FUNCTION fnConcatVehicleCities(@VehicleId SMALLINT)
RETURNS VARCHAR(1000) AS
BEGIN
  DECLARE @csvCities VARCHAR(1000)
  SELECT @csvCities = COALESCE(@csvCities + ', ', '') + COALESCE(City,'')
  FROM Vehicles 
  WHERE VehicleId = @VehicleId 
  return @csvCities
END

-- //Once the User defined function is created then run the below sql

SELECT VehicleID
     , dbo.fnConcatVehicleCities(VehicleId) AS Locations
FROM Vehicles
GROUP BY VehicleID 
```

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2011-05-30T15:15:06.557

我通过创建以下函数找到了解决方案：

```
CREATE FUNCTION [dbo].[JoinTexts]
(
  @delimiter VARCHAR(20) ,
  @whereClause VARCHAR(1)
)
RETURNS VARCHAR(MAX)
AS 
BEGIN
    DECLARE @Texts VARCHAR(MAX)

    SELECT  @Texts = COALESCE(@Texts + @delimiter, '') + T.Texto
    FROM    SomeTable AS T
    WHERE   T.SomeOtherColumn = @whereClause

    RETURN @Texts
END
GO 
```

用法：

```
SELECT dbo.JoinTexts(' , ', 'Y') 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2016-10-13T00:07:03.563

Mun 的答案对我不起作用，因此我对该答案进行了一些更改以使其正常工作。希望这可以帮助某人。使用 SQL Server 2012：

```
SELECT [VehicleID]
     , [Name]
     , STUFF((SELECT DISTINCT ',' + CONVERT(VARCHAR,City) 
         FROM [Location] 
         WHERE (VehicleID = Vehicle.VehicleID) 
         FOR XML PATH ('')), 1, 2, '') AS Locations
FROM [Vehicle] 
```

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2010-02-09T04:45:48.950

*版本说明：对于此解决方案，您必须使用 SQL Server 2005 或更高版本，并将 Compatibility Level 设置为 90 或更高版本。*

有关创建用户定义聚合函数的第一个示例，请参阅此[MSDN 文章](http://msdn.microsoft.com/en-us/library/ms131056.aspx "调用 CLR 用户定义的聚合函数")，该函数连接从表中的列中获取的一组字符串值。

我的谦虚建议是省略附加的逗号，以便您可以使用自己的临时分隔符（如果有）。

参考示例 1 的 C# 版本：

```
change:  this.intermediateResult.Append(value.Value).Append(',');
    to:  this.intermediateResult.Append(value.Value); 
```

和

```
change:  output = this.intermediateResult.ToString(0, this.intermediateResult.Length - 1);
    to:  output = this.intermediateResult.ToString(); 
```

这样，当您使用自定义聚合时，您可以选择使用自己的分隔符，或者根本不使用，例如：

```
SELECT dbo.CONCATENATE(column1 + '|') from table1 
```

**注意：**请注意您尝试在聚合中处理的数据量。如果您尝试连接数千行或许多非常大的数据类型，您可能会收到一个 .NET Framework 错误，指出“[t]he buffer is enough.”。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2016-05-04T19:15:00.820

对于其他答案，阅读答案的人必须了解车辆表并创建车辆表和数据以测试解决方案。

下面是一个使用 SQL Server“Information_Schema.Columns”表的示例。通过使用此解决方案，无需创建表或添加数据。此示例为数据库中的所有表创建一个逗号分隔的列名列表。

```
SELECT
    Table_Name
    ,STUFF((
        SELECT ',' + Column_Name
        FROM INFORMATION_SCHEMA.Columns Columns
        WHERE Tables.Table_Name = Columns.Table_Name
        ORDER BY Column_Name
        FOR XML PATH ('')), 1, 1, ''
    )Columns
FROM INFORMATION_SCHEMA.Columns Tables
GROUP BY TABLE_NAME 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-08-10T13:36:33.663

如果您运行的是 SQL Server 2005，则可以编写[自定义 CLR 聚合函数](https://docs.microsoft.com/en-us/sql/relational-databases/clr-integration-database-objects-user-defined-functions/clr-user-defined-aggregates)来处理此问题。

C#版本：

```
using System;
using System.Data;
using System.Data.SqlClient;
using System.Data.SqlTypes;
using System.Text;
using Microsoft.SqlServer.Server;
[Serializable]
[Microsoft.SqlServer.Server.SqlUserDefinedAggregate(Format.UserDefined,MaxByteSize=8000)]
public class CSV:IBinarySerialize
{
    private StringBuilder Result;
    public void Init() {
        this.Result = new StringBuilder();
    }

    public void Accumulate(SqlString Value) {
        if (Value.IsNull) return;
        this.Result.Append(Value.Value).Append(",");
    }
    public void Merge(CSV Group) {
        this.Result.Append(Group.Result);
    }
    public SqlString Terminate() {
        return new SqlString(this.Result.ToString());
    }
    public void Read(System.IO.BinaryReader r) {
        this.Result = new StringBuilder(r.ReadString());
    }
    public void Write(System.IO.BinaryWriter w) {
        w.Write(this.Result.ToString());
    }
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-09-04T06:10:54.243

试试这个查询

```
SELECT v.VehicleId, v.Name, ll.LocationList
FROM Vehicles v 
LEFT JOIN 
    (SELECT 
     DISTINCT
        VehicleId,
        REPLACE(
            REPLACE(
                REPLACE(
                    (
                        SELECT City as c 
                        FROM Locations x 
                        WHERE x.VehicleID = l.VehicleID FOR XML PATH('')
                    ),    
                    '</c><c>',', '
                 ),
             '<c>',''
            ),
        '</c>', ''
        ) AS LocationList
    FROM Locations l
) ll ON ll.VehicleId = v.VehicleId 
```

# c# - 尝试使用 CoreCon API 连接到设备时出现 DirectoryNotFoundException

> ID：6904
> 
> 赞同：4
> 
> 时间：2008-08-09T20:22:19.490
> 
> 标签：c#, visual-studio, windows-mobile, compact-framework, corecon

我正在尝试使用 Visual Studio 2008 中的 CoreCon API 以编程方式启动设备模拟器。当我打电话时`device.Connect()`，我莫名其妙地得到一个 DirectoryNotFoundException。如果我在 PowerShell 或 C# 控制台应用程序中尝试它，我会得到它。这是我正在使用的代码：

```
static void Main(string[] args)
{
     DatastoreManager dm = new DatastoreManager(1033);
     Collection<Platform> platforms = dm.GetPlatforms();

     foreach (var p in platforms)
     {
        Console.WriteLine("{0} {1}", p.Name, p.Id);
     }

     Platform platform = platforms[3];
     Console.WriteLine("Selected {0}", platform.Name);

     Device device = platform.GetDevices()[0];
     device.Connect();
     Console.WriteLine("Device Connected");

     SystemInfo info = device.GetSystemInfo();
     Console.WriteLine("System OS Version:{0}.{1}.{2}",info.OSMajor, info.OSMinor, info.OSBuildNo);

     Console.ReadLine();
} 
```

有谁知道我为什么会收到这个错误？我在 WinXP 32 位纯简 Visual Studio 2008 Pro 上运行它。我想这是一些配置问题，因为我无法从控制台应用程序或 PowerShell 执行此操作。

这是堆栈跟踪：

```
System.IO.DirectoryNotFoundException was unhandled

Message="The system cannot find the path specified.\r\n"

Source="Device Connection Manager"

StackTrace:
       at Microsoft.VisualStudio.DeviceConnectivity.Interop.ConManServerClass.ConnectDevice()
       at Microsoft.SmartDevice.Connectivity.Device.Connect()
       at ConsoleApplication1.Program.Main(String[] args) in C:\Documents and Settings\Thomas\Local Settings\Application Data\Temporary Projects\ConsoleApplication1\Program.cs:line 23
       at System.AppDomain._nExecuteAssembly(Assembly assembly, String[] args)
       at System.AppDomain.ExecuteAssembly(String assemblyFile, Evidence assemblySecurity, String[] args)
       at Microsoft.VisualStudio.HostingProcess.HostProc.RunUsersAssembly()
       at System.Threading.ThreadHelper.ThreadStart_Context(Object state)
       at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state)
       at System.Threading.ThreadHelper.ThreadStart() 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-08-14T00:43:49.693

安装 VS 2008 SP 1 为我修复了它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-08T12:20:52.483

可以在`<systemdrive>:\Program files\Common Files\Microsoft Shared\CoreCon\1.0\Bin`.

这是您可以获取此 dll 的路径，因此请将此 dll 添加到您的项目中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-09T22:04:42.217

我试过了，它工作正常。您可以粘贴整个异常和堆栈跟踪吗？

**更新：**奇怪的是，除了在 c:\windows\assembly\GAC_MSIL 文件夹下之外，我在我的机器上找不到该互操作组件。

为什么不启动 SysInternals FileMon 或 Process Monitor，它会节省一些猜测。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-09T22:29:38.127

我怀疑我的 Microsoft.VisualStudio.DeviceConnectivity.Interop 程序集有问题。我找不到磁盘上的副本。它仅在 GAC 中。我试图在 Reflector 中进行检查，但它也需要 Interop 程序集。由于 ConManServerClass 显然是 COM，也许有一个必须注册的 COM 库？

# forms - 如何在 VB6 中最好地共享可嵌入表单？

> ID：6913
> 
> 赞同：6
> 
> 时间：2008-08-09T21:05:40.027
> 
> 标签：forms, vb6, code-reuse

有没有一种在 VB6 中创建可以轻松嵌入到其他表单中的表单的好方法？

最近有几次，我想设计和编写一个可以插入到其他几个“父”表单中的 Form 对象。我的目标是创建一段集中的代码，用于以特定方式管理多个 UI 组件，然后能够在多个地方使用它（UI 布局和逻辑）。我当然愿意使用代码（而不是设计视图）来加载子表单。

到目前为止，我想出的最好的方法是将子窗体的所有有趣逻辑拉入类模块，并让每个父窗体布置 UI（可能在图片控件中）并将该图片对象传递到类模块。然后该类知道如何对图片进行操作，并假设所有预期的部分都已适当布局。这种方法有几个缺点，我想要一些更优雅的东西。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-08-10T01:05:59.560

看看 VB6 UserControls；我认为它们正是您所需要的。您可以在项目中创建一个 UserControl，向该控件添加控件和代码，然后将其插入到表单中，就像标准 VB6 控件一样。我曾多次使用 UserControls 来共享 UI 布局，效果很好。

# c++ - C++ 中单例的线程安全惰性构造

> ID：6915
> 
> 赞同：38
> 
> 时间：2008-08-09T21:16:29.193
> 
> 标签：c++, multithreading, singleton, construction, lazy-initialization

有没有办法在 C++ 中实现单例对象：

1.  以线程安全的方式懒惰地构造（两个线程可能同时是单例的第一个用户 - 它仍然应该只构造一次）。
2.  不依赖于预先构造的静态变量（因此在构造静态变量期间单例对象本身可以安全使用）。

（我不太了解我的 C++，但是在执行任何代码之前是否初始化了整数和常量静态变量（即，甚至在执行静态构造函数之前 - 它们的值可能已经在程序中“初始化”了）图像）？如果是这样 - 也许可以利用它来实现单例互斥锁 - 这又可以用来保护真正单例的创建..）

* * *

太好了，看来我现在有几个很好的答案（很遗憾我不能将 2 或 3 标记为**答案**）。似乎有两种广泛的解决方案：

1.  使用 POD 静态变量的静态初始化（与动态初始化相反），并使用内置原子指令实现我自己的互斥锁。这是我在问题中暗示的解决方案类型，我相信我已经知道了。
2.  使用其他一些库函数，例如[pthread_once](http://opengroup.org/onlinepubs/007908799/xsh/pthread_once.html)或[boost::call_once](http://www.boost.org/doc/libs/1_33_1/doc/html/call_once.html)。这些我当然不知道 - 并且非常感谢发布的答案。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2008-08-09T23:09:01.400

不幸的是，Matt 的答案具有C/C++ 内存模型不支持的所谓的*双重检查锁定。*（Java 1.5 及更高版本（我认为是 .NET）内存模型支持它。）这意味着在进行`pObj == NULL`检查和获取锁（互斥锁）之间，`pObj`可能已经在另一个线程上分配了. 线程切换发生在操作系统想要的任何时候，而不是在程序的“行”之间（在大多数语言中，编译后没有意义）。

此外，正如 Matt 承认的那样，他使用 a`int`作为锁而不是 OS 原语。不要那样做。正确的锁需要使用内存屏障指令、可能的缓存行刷新等；使用操作系统的原语进行锁定。这一点尤其重要，因为使用的原语可以在操作系统运行的各个 CPU 行之间发生变化；在 CPU Foo 上有效的东西可能在 CPU Foo2 上无效。大多数操作系统要么本机支持 POSIX 线程 (pthread)，要么将它们作为 OS 线程包的包装器提供，因此通常最好使用它们来说明示例。

如果您的操作系统提供了适当的原语，并且您绝对需要它来提高性能，那么您可以使用*原子比较和交换*操作来初始化共享全局变量，而不是执行这种类型的锁定/初始化。本质上，您编写的内容将如下所示：

```
MySingleton *MySingleton::GetSingleton() {
    if (pObj == NULL) {
        // create a temporary instance of the singleton
        MySingleton *temp = new MySingleton();
        if (OSAtomicCompareAndSwapPtrBarrier(NULL, temp, &pObj) == false) {
            // if the swap didn't take place, delete the temporary instance
            delete temp;
        }
    }

    return pObj;
} 
```

这仅在创建多个单例实例是安全的情况下才有效（每个线程碰巧同时调用 GetSingleton() 一个），然后扔掉额外的东西。Mac OS X 上提供的`OSAtomicCompareAndSwapPtrBarrier`功能——大多数操作系统都提供类似的原语——检查是否`pObj`存在`NULL`，并且只有在存在时才实际将其设置`temp`为它。这使用硬件支持实际上只执行*一次*交换并判断它是否发生。

如果您的操作系统提供介于这两个极端之间的另一个工具，那么可以利用的另一个工具是`pthread_once`. 这使您可以设置仅运行一次的功能-基本上是通过执行所有锁定/障碍/等。你的诡计 - 无论它被调用了多少次或它被调用了多少个线程。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-08-09T23:52:40.253

基本上，您要求同步创建单例，而不使用任何同步（以前构造的变量）。一般来说，不，这是不可能的。您需要一些可用于同步的东西。

至于你的另一个问题，是的，可以静态初始化的静态变量（即不需要运行时代码）保证在执行其他代码之前被初始化。这使得可以使用静态初始化的互斥锁来同步单例的创建。

从 C++ 标准的 2003 年修订版开始：

> 具有静态存储持续时间（3.7.1）的对象应在任何其他初始化发生之前进行零初始化（8.5）。零初始化和用常量表达式初始化统称为静态初始化；所有其他初始化都是动态初始化。使用常量表达式 (5.19) 初始化的具有静态存储持续时间的 POD 类型 (3.9) 的对象应在任何动态初始化发生之前进行初始化。在同一翻译单元的命名空间范围内定义的静态存储持续时间并动态初始化的对象应按照其定义在翻译单元中出现的顺序进行初始化。

如果您*知道*在初始化其他静态对象期间将使用此单例，我想您会发现同步不是问题。据我所知，所有主要编译器都在单个线程中初始化静态对象，因此在静态初始化期间是线程安全的。您可以将单例指针声明为 NULL，然后在使用它之前检查它是否已初始化。

但是，这假设您*知道*您将在静态初始化期间使用此单例。标准也不能保证这一点，因此如果您想完全安全，请使用静态初始化的互斥锁。

编辑：克里斯建议使用原子比较和交换肯定会奏效。如果可移植性不是问题（并且创建额外的临时单例也不是问题），那么它是一个开销稍低的解决方案。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2010-05-19T16:20:12.490

这是一个非常简单的懒惰构造的单例吸气剂：

```
Singleton *Singleton::self() {
    static Singleton instance;
    return &instance;
} 
```

这是懒惰的，下一个 C++ 标准 (C++0x) 要求它是线程安全的。事实上，我相信至少 g++ 以线程安全的方式实现了这一点。因此，如果那是您的目标编译器*，或者*如果您使用的编译器也以线程安全的方式实现了这一点（也许较新的 Visual Studio 编译器会这样做？我不知道），那么这可能就是您所需要的。

另请参阅有关此主题的[http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2513.html 。](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2513.html)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-08-10T04:13:08.543

没有任何静态变量你不能做到这一点，但是如果你愿意容忍一个，你可以使用[Boost.Thread](http://www.boost.org/doc/html/thread.html)来达到这个目的。阅读“一次性初始化”部分了解更多信息。

然后在您的单例访问器函数中，用于`boost::call_once`构造对象并返回它。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-16T10:21:51.773

对于 gcc，这相当简单：

```
LazyType* GetMyLazyGlobal() {
    static const LazyType* instance = new LazyType();
    return instance;
} 
```

GCC 将确保初始化是原子的。**对于 VC++，情况并非如此**。:-(

这种机制的一个主要问题是缺乏可测试性：如果您需要在测试之间将 LazyType 重置为新的，或者想要将 LazyType* 更改为 MockLazyType*，您将无法做到。鉴于此，通常最好使用静态互斥体 + 静态指针。

另外，可能还有一点：最好始终避免使用静态非 POD 类型。（指向 POD 的指针是可以的。）这样做的原因有很多：正如您所提到的，初始化顺序没有定义——尽管调用析构函数的顺序也没有定义。因此，程序在尝试退出时最终会崩溃；通常没什么大不了的，但有时当您尝试使用的分析器需要一个干净的退出时，这会是一个阻碍。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-10T04:34:59.793

虽然已经回答了这个问题，但我认为还有其他几点需要提及：

*   如果您想在使用指向动态分配实例的指针时对单例进行延迟实例化，则必须确保在正确的位置清理它。
*   您可以使用马特的解决方案，但您需要使用适当的互斥锁/关键部分进行锁定，并在锁定前后检查“pObj == NULL”。当然，**pObj**也必须是*静态*的；）。在这种情况下，互斥锁会不必要地繁重，最好使用关键部分。

但如前所述，如果不使用至少一个同步原语，就无法保证线程安全的延迟初始化。

编辑：是的，德里克，你是对的。我的错。:)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-10T05:11:03.247

> 您可以使用马特的解决方案，但您需要使用适当的互斥锁/关键部分进行锁定，并在锁定前后检查“pObj == NULL”。当然， pObj 也必须是静态的；）。在这种情况下，互斥锁会不必要地繁重，最好使用关键部分。

OJ，这行不通。正如克里斯指出的那样，这是双重检查锁定，不能保证在当前的 C++ 标准中工作。请参阅：[C++ 和双重检查锁定的风险](http://www.ddj.com/184405726)

编辑：没问题，OJ。它在它确实有效的语言中非常好。我希望它可以在 C++0x 中工作（尽管我不确定），因为它是一个非常方便的习语。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-11-09T17:32:29.957

1.  阅读弱记忆模型。它可以打破双重检查锁和自旋锁。英特尔是强大的内存模型（但），所以在英特尔上更容易

2.  小心使用“volatile”来避免缓存部分对象在寄存器中，否则你将初始化对象指针，而不是对象本身，另一个线程将崩溃

3.  静态变量初始化与共享代码加载的顺序有时并不重要。我见过破坏对象的代码已经被卸载的情况，所以程序在退出时崩溃了

4.  这样的物体很难正确销毁

一般来说，单例很难做对，也很难调试。最好完全避免它们。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-08-20T16:13:40.890

我想说不要这样做，因为它不安全，并且可能会比仅仅初始化这些东西更频繁地中断`main()`不会那么受欢迎。

（是的，我知道这意味着你不应该尝试在全局对象的构造函数中做有趣的事情。这就是重点。）

# shader - 开始着色器开发

> ID：6926
> 
> 赞同：19
> 
> 时间：2008-08-09T21:57:07.427
> 
> 标签：shader

我想开始使用 Microsoft 的 XNA 进行一些游戏开发。其中一部分是着色器开发，但我不知道如何开始。我知道[nVidia 的 FX Composer](http://developer.nvidia.com/object/fx_composer_home.html)是开发着色器的好工具，但我没有找到太多有用和更新的内容来说明如何真正开始使用。

你会推荐什么教程？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-08-10T04:21:32.333

在 XNA（显然使用 DirectX）中开发着色器需要了解[HLSL](http://msdn.microsoft.com/en-us/library/bb509561(VS.85).aspx)或着色器组件。我建议在深入了解后者之前先熟悉前者。

在编写任何着色器之前，最好对着色器管道有充分的了解，并尝试了解使用可编程着色器时可能发生的事情。当您熟悉像素的生命周期（从源数据一直到屏幕）时，理解着色器示例就会变得容易得多。

接下来尝试编写您自己的 HLSL，它执行[固定 T&L](http://www.computerhope.com/jargon/t/tandl.htm)管道过去所做的工作，只是为了让您手忙脚乱。这相当于顶点/像素着色器世界中的“hello world”程序。当你能够做到这一点并且你理解你所写的内容时，你就可以开始做更有趣的事情了。

作为下一步，您可能希望在您的一个着色器中从单个光源模拟基本的[反射光照。](http://www.gamasutra.com/features/20030418/engel_pfv.htm)然后，您可以在轨道上调整它以使用多个灯光。玩弄颜色和灯光的运动。这也将有助于熟悉着色器常量的使用。

当您有几个基本着色器在一起时，您应该尝试使您的游戏/引擎在不同的对象上使用多个/不同的着色器。开始添加一些其他位，例如基本[凹凸](http://www.paulsprojects.net/tutorials/simplebump/simplebump.html)或[法线贴图](http://www.bencloward.com/tutorials_normal_maps1.shtml)。

当你到了这个阶段，世界就是你的牡蛎。您可以开始深入研究一些时髦的效果，甚至考虑将 GPU 用于[超出](http://www.gpgpu.org/)最初预期的用途。

对于那些稍微高级一点的人，有几本可以免费在线获得的好书，其中包含来自 Nvidia 的一些很棒的信息[这里](http://developer.nvidia.com/object/gpu_gems_home.html)和[这里](http://developer.nvidia.com/object/gpu_gems_2_home.html)。

不要忘记有一本名为 ShaderX 的优秀系列书籍，其中涵盖了一些很棒的着色器内容。[1](https://rads.stackoverflow.com/amzn/click/com/1556220413)、[2](https://rads.stackoverflow.com/amzn/click/com/1556229887)、[3](https://rads.stackoverflow.com/amzn/click/com/1584503572)、[4](https://rads.stackoverflow.com/amzn/click/com/1584504250)、[5](https://rads.stackoverflow.com/amzn/click/com/1584504994)和[6](https://rads.stackoverflow.com/amzn/click/com/1584505443)已经在印刷中，而且[7](http://www.shaderx7.com/)即将推出。

祝你好运。如果你有一些着色器，我很乐意看到它们:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-08-14T15:57:36.833

我只是想重申一下 GPU Gems 书籍有多么棒——对于任何严肃的图形开发来说，这都是一个非常棒的资源。

OJ 基本上总结了一个非常好的学习过程，我只想补充一点，不能低估几何数学（至少是向量/矩阵）的良好基础——但这并不像人们有时所说的那么难。学习点积、叉积、法向量和矩阵乘法是很好的第一步:)。尝试准确了解世界/视图/投影-剪辑/屏幕空间之间发生了什么，透视划分是什么等。

当我开始学习时，一个很好的练习是在软件中实际实现整个 T&L 管道，并完成裁剪/剔除等。这是一个漫长的过程，可能看起来不值得，因为我相信你只想沉浸在乐趣中东西，但是对正在发生的事情有一个正确的理解是非常有用的，当你总是遇到更隐蔽和难以诊断的错误时，这将证明是值得的。

尽量不要一开始就使用 FX Composer 之类的工具，它们对原型设计很有用，但从长远来看，在基础上打下坚实的基础更值得。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-11-27T22:15:35.613

开始使用着色器的最佳方法之一是阅读 Frank Luna 的 DirectX 9.0ca Shader Approach 的 3D 游戏编程简介。作者首先介绍了DirectX和HLSL，然后逐渐揭示了shader的威力。他从非常简单的着色器开始，但在本书的结尾，您知道如何创建照明、阴影、粒子系统等。很棒的书。

OJ 建议您阅读 ShaderX 系列，但其中的内容不适合初学者，因此在您迈出第一步时对您没有太大帮助。

我还在[这里](http://blog.nankov.com/2008/10/30/best-books-about-game-development/)发布了一篇关于可以帮助您开始游戏开发的最佳书籍的文章。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-17T19:03:08.907

我会加入对 OJ 的赞扬——这确实是一个很好的答案。尽管如此，一旦您有了基本的了解，您就可以通过下载以下两个很棒的工具之一来快速学习很多东西：

*   渲染猴子[http://ati.amd.com/developer/rendermonkey/downloads.html](http://ati.amd.com/developer/rendermonkey/downloads.html)或
*   Fx 作曲家[http://developer.nvidia.com/object/fx_composer_home.html](http://developer.nvidia.com/object/fx_composer_home.html)

一旦你这样做了，去他们的项目库并开始浏览示例，从基本的阴影开始，然后转到阴影、法线贴图、材质、效果和你感兴趣的一切。拿一个项目，根据你设定的一些目标开始改变算法，看看如何得到它。你会发现很多例子真的很高级，它们会打开你的视野。

玩得开心

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-27T17:02:04.443

虽然已经给出了很多很好的建议，但如果您很难将注意力集中在所涉及的步骤上，[Mental Mill](http://www.mentalimages.com/products/mental-mill.html)提供了一种可视化的方式来构建着色器（Artist Edition 与 Fx Composer 免费捆绑在一起——它本身也是自由！）。

虽然您最好直接长期学习 HLSL 代码，但 Mental Mill 可以为您生成这些 Fx 文件（因此您可以查看更改）。请注意，与所有代码生成器一样，它比您了解 HLSL 后可能会做的更冗长！

效果的视觉进展，从一种方法到另一种方法，非常令人印象深刻！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-10T00:45:01.973

SAMS 的[XNA Unleashed](https://rads.stackoverflow.com/amzn/click/com/0672329646) by Chad Carter 是 XNA 的一个很好的起点，并且假设您在开始之前对游戏开发实践或硬数学知之甚少。它有两章关于基本和高级着色器。

作为旁注，请留意 Google 的 WPF 着色器教程，它现在使用相同的技术来允许 WPF 应用程序和教程中的客户着色器，因为我认为这些着色器在很大程度上与 XNA 兼容。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-18T10:34:11.453

我没有使用过 XNA 或 DirectX。但是，为了了解使用 Cg 进行着色器编程的基础知识，[Cg 教程](http://developer.nvidia.com/object/cg_tutorial_home.html)是我找到的最好的书。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-08-28T15:08:18.500

您还应该查看 RenderMonkey。这是一个很好的工具。就书籍而言，请查看 Riemer Grootjans 的 XNA 2.0 Game Programming Recipes ... 好书。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-11-15T01:46:28.517

关于视觉着色器编辑器的快速思考。使用这类编辑器是一件非常有趣的事情，但我真的非常建议坚持使用基于文本的 HLSL（RM 和 FXC 都可以完成这项工作）。我是一名游戏开发人员，并构建了一些着色器系统（例如，战地 2 和 Farcry 2 中的那个），老实说，我发现 HLSL 比迄今为止任何图形着色器网络都更有价值。

诸如遵循执行流程、调试着色器或能够快速迭代测试用例之类的事情，可以让您获得通过可视化工具几乎不可能获得的洞察力。

我自己也使用过视觉着色器构建器，我喜欢它们，而且有一天，当着色不像今天那样对性能至关重要时，它们可能是适合这项工作的工具。

..虽然我的猜测是在那一天到来之前我们会看到延迟照明和可能的完整软件渲染；）

# audio - 转码音视频

> ID：6932
> 
> 赞同：4
> 
> 时间：2008-08-09T22:19:59.580
> 
> 标签：audio, video, mp3, flv, mp4

将音频和视频转码以在网络上显示的最佳方式是什么？

我需要以编程方式进行。我想做一些像 YouTube 或谷歌视频这样的东西，用户可以上传他们想要的任何格式，我将它编码为 flv、mp3 和/或 mp4。我可以在我们的服务器上执行此操作，但我更愿意使用 EC2 实例甚至 Web 服务。我们有一个 Windows 2008 服务器。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-10T03:38:40.723

有点取决于你想花多少钱。如果这是一个全新的（而且大多是没有资金的）想法，那么请走 ffmpeg 路线，但是当您扩展并希望提高质量时，请考虑可以自动化的更专业的编码工具之一（Rhozet、Inlet、Digital Rapids 是3 个选项）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-06-10T01:13:18.793

我强烈推荐 ffmpeg。在 Windows 上，我发现[这个站点](https://ffmpeg.zeranoe.com/builds/)可以托管好的二进制文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-08-10T00:36:34.517

ffmpeg 可以做到，它是一个使用 libavcodec 的命令行工具。可以处理大多数视频格式的转换。如果适合您的需要，它的许可证是 LPGL。您可以以编程方式将其用作单独的进程，或者如果您觉得硬核，您可以自己使用 libavcodec 库直接编码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-08-10T12:58:59.370

当您想转码为 Flv（这可能是网络上最好的）时，我使用以下行：

```
ffmpeg -hq -y -i $directory/$file -r 20 -s 300x200 -deinterlace -ar 22050 $directory/$file.flv 1>/dev/null 2>/dev/null 
```

它工作得很好，当然在 linux 下:-)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-10T05:10:42.440

如果你正在寻找 GPL 的东西：

对于音频，请尝试[sox。](http://sox.sourceforge.net/) 很强大！它做了很多！它包含在大多数 linux 发行版中。

还有著名的用于 mp3 [音频] 编码的[LAME 。](http://lame.sourceforge.net/)

对于视频，[mencoder](http://www.mplayerhq.hu)令人印象深刻！它是[mplayer](http://www.mplayerhq.hu)包的一部分。它将处理大多数视频格式的转换。比我想象的要多得多。（有关文档，请参阅[第 9 章。MEncoder 的基本用法](http://www.mplayerhq.hu/DOCS/HTML/en/mencoder.html)和[第 10 章。使用 MEncoder 进行编码](http://www.mplayerhq.hu/DOCS/HTML/en/encoding-guide.html)。）

它可以创建的内容更加有限。但它确实支持*mpeg4*、*mpeg2*、*dvd-mpeg*、*flv*等等。（虽然我自己没有尝试过*flv*，但谷歌显示其他人正在使用它。）

我做过类似 jpeg + sound -> mpeg4 电影的事情：

```
nice +20 $MENCODER mf://${JPEGFILE}  -mf w=720:h=480:fps=1/${SOUNDLENGTH}:type=jpeg -audiofile ${SOUNDFILE} -ovc lavc -oac lavc -lavcopts vcodec=mpeg4 -ofps 30000/1001 -o ${MENU_MPG} 
```

或将任意格式的视频转码为兼容 dvd 的 mpeg：

```
nice +20 $MENCODER -edl ${EDL} -ovc lavc -oac lavc -lavcopts vcodec=mpeg2video:vrc_buf_size=1835:vrc_maxrate=9800:vbitrate=${VBITRATE}:keyint=18:acodec=ac3:abitrate=192:aspect=4/3:trell:mbd=2:dia=4:cmp=3:precmp=3:ildctcmp=3:subcmp=3:mbcmp=3:cbp:mv0:dc=10 -of mpeg -mpegopts format=dvd -vf scale=720:480,harddup -srate 48000 -af lavcresample=48000 -ofps 30000/1001 -o ./${INFILE}.reformatted  ${FILEPATH} 
```

-edl/-edlout [Edit Decision Lists] 用于剪掉我想要的视频部分。

对于 DVD-mpeg-video，${VBITRATE} 通常为 5000。但是，如果您稍微弄乱了一点，您可以将更多视频压缩到 DVD 上。假设您可以容忍工件。

scale=720:480,harddup -- 我的 dvdplayer 的比例不对，harddup 解决了我的*“el cheeseo”*播放器上的音视频不同步问题。

（为了在无法处理 4x3 视频的宽屏播放器上播放，我使用了诸如*"aspect=16/9"*、*"-vf scale=560:480,expand=720:480,harddup" 之类*的暴行。但总的来说你不想浪费位编码黑条。）

到目前为止，这不是[mencoder](http://www.mplayerhq.hu)最有效的一组选项！运行可能很耗时。但我心中还有其他目标...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-08-10T12:49:28.313

请注意，ffmpeg 的某些部分受 GPL 保护。我相信 libpostproc 模块是，如果我没记错的话，它用于转码。确保此许可证与您正在做的事情兼容。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-08-27T15:27:15.030

我会看一下 Main Concept 的参考 SDK：

[http://www.mainconcept.com/site/developer-products-6/pc-based-sdks-20974/reference-sdk-21221/information-21243.html](http://www.mainconcept.com/site/developer-products-6/pc-based-sdks-20974/reference-sdk-21221/information-21243.html)

它是为转码而构建的，因为它是一个许可的 SDK，它没有任何与 ffmpeg/libavcodec 相关的法律问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-05-06T23:41:02.290

[Rhozet Carbon Coder](http://www.rhozet.com/carbon_coder.html)可以处理[多种格式](http://www.rhozet.com/rhozet_formatGuide.pdf)，而且您可以使用插件来更改视频（例如添加水印）

# visual-studio - Visual Studio 和双/多显示器：如何优化显示器的使用？

> ID：6937
> 
> 赞同：44
> 
> 时间：2008-08-09T22:55:26.857
> 
> 标签：visual-studio, monitor, multiple-monitors

[Ultramon](http://www.realtimesoft.com/ultramon/)是一个很棒的双显示器程序（跨显示器拉伸屏幕），但我想知道在 Visual Studio 中是否有任何方法可以做某事，比如在一个显示器上打开一个代码选项卡，在第二个显示器上打开第二个代码选项卡只运行一个 Visual Studio 实例的监视器？

或者是否有任何其他建议可以在双显示器和 Visual Studio 上获得最大收益？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2014-11-27T11:00:39.397

> 在一台监视器上打开一个代码选项卡，在第二台监视器上打开第二个代码选项卡，仅运行一个 Visual Studio 实例

您可以简单地将 VS 之外的选项卡拖到另一个屏幕上。

![像这样](https://i.stack.imgur.com/KEqgt.png)

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2008-08-09T23:00:20.670

就个人而言，我设置了我的窗口，以便一个我的主监视器，我有一个主 Visual Studio 监视器，因此我的代码窗口最大化，只有工具箱停靠在左侧。这意味着代码窗口占用尽可能多的空间，同时保持代码的左边缘靠近屏幕中间，我的眼睛自然会看到。我的主显示器是一个宽屏幕，所以我发现它为我的代码提供了足够的空间。

我的辅助监视器有第二个窗口，其中包含我使用的工具窗口。所以我有解决方案资源管理器、错误列表、任务列表（//待办事项：评论）、输出窗口、查找结果等。所有这些都在我的辅助监视器上占用了尽可能多的空间。

调试时，解决方案资源管理器会移动主监视器，而 watch、autos 和 locals 窗口会取而代之。

我发现这为我提供了一个非常大的区域来编写代码，并且通过为它们提供比通常更多的空间，确实有助于使用所有这些额外的窗口。

**更新：**作为对每个人都在谈论使用第二个监视器进行文档或运行应用程序的回应，我完全同意，但忘了提及我是如何做到的。我经常使用[PowerMenu](http://www.abstractpath.com/powermenu/)来实现这一点。基本上我可以右键单击任何窗口并设置始终在顶部。因此，当我在调试时，我想查看我的输出窗口，但是如果我必须参考一些文档，我只需轻弹到 Mozilla（在第二个显示器上），将其设置在顶部，然后返回 Visual Studio。我发现这让我可以管理工具窗口，而无需大量调整它们，或者占用代码窗口中的宝贵空间。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-08-09T23:39:42.650

我有三台显示器，所以我通常使用以下配置运行：

*   左显示器：文档/电子书。
*   中间监视器：代码/调试
*   右监视器：测试应用程序/滚动日志文件（如果需要）

这通常工作得很好，而且由于显示器相当大，我很少需要全屏使用测试应用程序，所以我的 tail -f 窗口有足够的空间。

我还使用 AutoHotkey 分配热键，这些热键可以翻转到最重要的窗口，例如 Firefox 或我的 SSH 会话。这样我可以在必要时简单地使用快捷键来访问它们。

左侧显示器实际上是一台运行 Linux 和键盘/鼠标的独立计算机，与 Synergy 共享，所以我打开了多个电子书或文档页面，每个虚拟桌面上都有一个……我可以通过将鼠标向左移动来在文档之间切换使用快捷键。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-08-09T23:00:51.607

当我第一次拥有两台显示器时，我想和你一样，将所有空间用于 Visual Studio，但我认为你开始意识到最好将 VS 放在一台显示器上，然后将第二台显示器用于文档、外部资源等等。一开始你不会这么想，但是所有的小改动，比如能够在不隐藏代码的情况下最大化其他资源，都是一个很棒的功能。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-08-09T22:58:52.653

对于 GUI 调试来说，能够在一个屏幕上运行应用程序并将调试器放在另一个屏幕上是非常棒的。这是最实际的用途之一..

但实际上，这取决于您正在开发哪种应用程序，即是否需要监视打开的文件句柄、日志等。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-08-10T00:02:26.020

我的左侧显示器中有 VS，右侧有 GUI/运行窗口。但是，如果您想在每个监视器上打开代码选项卡，您可以使用 UltraMon 的选项在两个监视器上展开一个窗口，然后将代码页拖到上面，这样它就可以放置一个分隔符。然后，将该分隔线与监视器中的中断对齐。

我以前做过，只是为了测试一下。这不是一个糟糕的设置。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-31T21:13:21.430

三台显示器——全部为 1600x1200

*   左：电子邮件、IM、SQL Server Management Studio、远程桌面到服务器
*   中间：VisualStudio——可能是多个实例——最大化，解决方案资源管理器和团队资源管理器停靠在右侧，错误/输出停靠在底部，其他自动隐藏
*   右图：Web 浏览器——应用程序调试和正常的 Web 工作，ADUC（如果需要）

其他应用程序的移动取决于我正在处理的内容、显示器的拥挤程度以及打开的应用程序与我需要从中获取信息的目的之间的交互。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-31T21:14:43.330

我有三个监视器，在中间监视器上设置了 Visual Studio 全屏，右侧监视器配置了所有工具窗口，左侧监视器用于浏览器、帮助、SSMS、电子邮件等。

效果很好，除非我必须远程进入，所以我有一个单独的导出配置，可以将工具窗口移回 Visual Studio，还有一个可以为多个监视器设置它们。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-02-16T21:12:02.927

虽然我将[StudioTools](http://www.exactmagic.com/products/studiotools/index.html)用于其他目的，但它有一个“Tear off Editor”选项，您可以使用该选项将文件“tear off”到一个窗口并调整窗口大小。觉得很有帮助

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-02-16T21:29:14.940

我发现代码定义窗口在我的另一台显示器中打开是非常宝贵的。当光标移到编辑器中的类型名称上时，另一个窗口会显示其定义。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-09-10T14:56:08.253

您可以尝试在解决方案资源管理器中右键单击文件，打开方式，然后找到 devenv.exe。这将在一个新的 VS 实例中打开它。另外，它将 devenv 保存为您将来的默认选项之一，因此您不必一直四处寻找 devenv。不漂亮，但一种选择。

# performance - 有人用过谷歌性能工具吗？

> ID：6957
> 
> 赞同：5
> 
> 时间：2008-08-10T00:01:18.770
> 
> 标签：performance, multithreading, malloc, google-perftools

寻找有关以下方面的反馈：

[http://code.google.com/p/google-perftools/wiki/GooglePerformanceTools](http://code.google.com/p/google-perftools/wiki/GooglePerformanceTools)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-08-11T00:53:54.403

不久前我读到了一篇[相当不错的文章](http://web.archive.org/web/20090227051320/http://xtalk.msk.su:80/%7Eott/en/writings/prog-checking/GooglePT.html)，其中概述了 GPT 在各种场景中的一些测试和分析

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-08-17T13:12:24.300

我从 2007 年开始在工作中使用 GPT，我完全满意。我用它来监控和优化一个Linux网络库，并取得了显着的效果。

GPT 的主要缺陷是缺乏精度。由于设计的原因，您只获得了主要的耗时功能，但这通常是您想要优化程序时所需要的。

更准确地说，我建议使用其他工具，如 gprof 或 IBM Quantify。

# c# - 资源文件无效

> ID：6973
> 
> 赞同：13
> 
> 时间：2008-08-10T00:50:16.283
> 
> 标签：c#, visual-studio, resources

尝试编译我的 C# 项目时，出现以下错误：

```
'C:\Documents and Settings\Dan\Desktop\Rowdy Pixel\Apps\CleanerMenu\CleanerMenu\obj\Debug\CSC97.tmp' is not a valid Win32 resource file. 
```

经过多次谷歌搜索，我确定这通常是由项目使用的图标内的 256x256 图像引起的。我浏览了所有图标并删除了 256x256 版本，但错误仍然存​​在。关于如何摆脱这个的任何想法？

* * *

@Mike：一天晚上它神秘地出现了。我已经搜索了 csproj 文件，但没有提到 CSC97.tmp（我也检查了解决方案文件，但我也没有运气）。如果有帮助，我已在 pastebin 上发布[了 csproj 文件的内容](http://pastebin.com/mcd2607b)。

@Derek：没问题。这是编译器输出。

```
------ Build started: Project: Infralution.Licensing, Configuration: Debug Any CPU ------
Infralution.Licensing -> C:\Documents and Settings\Dan\Desktop\Rowdy Pixel\Apps\CleanerMenu\Infralution.Licensing\bin\Debug\Infralution.Licensing.dll
------ Build started: Project: CleanerMenu, Configuration: Debug Any CPU ------
C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Csc.exe /noconfig /nowarn:1701,1702 /errorreport:prompt /warn:4 /define:DEBUG;TRACE /main:CleanerMenu.Program /reference:"C:\Documents and Settings\Dan\Desktop\Rowdy Pixel\Apps\CleanerMenu\Infralution.Licensing\bin\Debug\Infralution.Licensing.dll" /reference:..\NotificationBar.dll /reference:..\PSTaskDialog.dll /reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Data.dll /reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.dll /reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Drawing.dll /reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Windows.Forms.dll /reference:C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\System.Xml.dll /reference:obj\Debug\Interop.IWshRuntimeLibrary.dll /debug+ /debug:full /optimize- /out:obj\Debug\CleanerMenu.exe /resource:obj\Debug\CleanerMenu.Form1.resources /resource:obj\Debug\CleanerMenu.frmAbout.resources /resource:obj\Debug\CleanerMenu.ModalProgressWindow.resources /resource:obj\Debug\CleanerMenu.Properties.Resources.resources /resource:obj\Debug\CleanerMenu.ShortcutPropertiesViewer.resources /resource:obj\Debug\CleanerMenu.LocalizedStrings.resources /resource:obj\Debug\CleanerMenu.UpdatedLicenseForm.resources /target:winexe /win32icon:CleanerMenu.ico ErrorHandler.cs Form1.cs Form1.Designer.cs frmAbout.cs frmAbout.Designer.cs Licensing.cs ModalProgressWindow.cs ModalProgressWindow.Designer.cs Program.cs Properties\AssemblyInfo.cs Properties\Resources.Designer.cs Properties\Settings.Designer.cs Scanner.cs ShortcutPropertiesViewer.cs ShortcutPropertiesViewer.Designer.cs LocalizedStrings.Designer.cs UpdatedLicenseForm.cs UpdatedLicenseForm.Designer.cs
error CS1583: 'C:\Documents and Settings\Dan\Desktop\Rowdy Pixel\Apps\CleanerMenu\CleanerMenu\obj\Debug\CSC97.tmp' is not a valid Win32 resource file

Compile complete -- 1 errors, 0 warnings
------ Skipped Build: Project: CleanerMenu Installer, Configuration: Debug ------
Project not selected to build for this solution configuration 
========== Build: 1 succeeded or up-to-date, 1 failed, 1 skipped ========== 
```

我还上传了我正在使用的图标。你可以[在这里查看。](http://rowdypixel.com/tmp/CleanerMenu.ico)

* * *

@迈克：谢谢！删除除 32x32 图像之外的所有内容后，一切正常。现在我可以回去并一一添加其他尺寸，看看哪个让我感到悲伤。:)

@Derek：自从我第一次遇到错误以来，我已经完全重新安装了 Windows（以及 SDK。）这不是重新安装的主要原因，但我希望它能修复问题。

现在，如果我能弄清楚为什么它以前适用于所有其他尺寸......

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-11-26T17:28:09.940

我的构建日志中出现了一个类似的问题，即“obj/debug/ ***** .tmp”文件出错。原来我的 C:\ 驱动器空间不足。清理一些空间后，我的构建开始工作。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-08-10T01:32:19.740

我不知道这是否会有所帮助，但来自[这个论坛](http://forums.msdn.microsoft.com/en-US/csharplanguage/thread/4217bec6-ea65-465f-8510-757558b36094/)：

> 将 .ico 文件添加到属性页面的应用程序部分，并收到所描述的错误，当我使用图标编辑器检查图标文件时，结果发现该文件具有多个版本的图像，即（16 x 16、24 x 24、32 x 32、48 x 48 vista 压缩），我删除了我不想重新保存文件的其他格式（仅使用 32x 32），应用程序现在编译没有错误。

尝试在图标编辑器中打开图标，看看您是否看到描述的其他格式（另外，尝试删除图标并查看项目是否会再次构建，只是为了验证图标是否导致它）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-08-10T00:54:56.790

这是您创建并添加到项目中的文件，还是神秘地出现了？

您也许可以检查您的 .csproj 文件并查看它是如何被引用的（它应该是一个简单的 xml 文件，您可以搜索 CSC97.tmp）。

也许发布您找到的信息，以便我们可以提供更多详细信息来帮助解决您的问题

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-08-10T01:30:42.927

环顾四周，似乎有些人通过修复或重新安装 .NET SDK 解决了这个问题。您可能想尝试一下。

PS我明白为什么你现在没有包含更多的编译器输出。那里没什么可看的。:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-08-15T22:43:49.733

在项目属性中，应用程序点击：在资源组中，只需选择图标和清单单选按钮。在我的项目中，这是问题所在，并通过上述步骤修复。********