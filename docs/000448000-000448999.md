# StackOverflow 问答 000448000-000448999

# c# - 为什么 C# 列表 .Find貌似返回NullReferenceException？

> ID：448002
> 
> 赞同：1
> 
> 时间：2009-01-15T19:01:00.797
> 
> 标签：c#, generics, containers

首先，根据[http://msdn.microsoft.com/en-us/library/x0b5b5bc.aspx](http://msdn.microsoft.com/en-us/library/x0b5b5bc.aspx)， List.Find 方法仅列为抛出 ArgumentNullException。但是，我有以下测试代码，当将 Find 与匿名委托一起使用时，当找不到正在搜索的对象时会引发 NullReferenceException。

```
namespace MyTestNS
{
  class MyTestClass
  {
    [TestMethod()]
    public void ArrayMatchTest()
    {
        List<A> objArray = new List<A>();
        objArray.Add(new A("1","one"));
        objArray.Add(new A("2", "two"));

        string findStr = "3";
        string foundVal;
        // Find using an anonymous delegate:
        foundVal = objArray.Find(delegate(A a) // <- System.NullReferenceException: Object reference not set to an instance of an object..
        {
            if (a.name == findStr)
                return true;
            else return false;
        }).value;
    }
  }
} 
```

我不明白为什么我得到一个 NullReferenceException 而不是 Find 只是没有找到项目并返回 null。我 90% 确定这是我从未见过的一些细微的编码错误，但这一直困扰着我一整天，请帮忙！

编辑：我应该提到我从别人那里继承了这个令人费解的代码，所以你在上面看到的曲折代码是我真实代码中失败的一个稍微简化的版本。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-01-15T19:07:55.273

`Find` **正在**返回 null。但是，您正在取消引用该结果。也就是说，您正在调用：

`Find(...).value`

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-15T19:14:50.987

您在一个地方发生了很多事情 - 我建议您稍微简化一下，以便您可以准确地看到出了什么问题。

`Find`您的调用的一个更简单的版本是这样的：

```
A a1 = objArray.Find(a => a.name == findStr); 
```

如果您的`Predicate<A>`退货会`false`怎样？向`objArray`您返回一个`null`引用并`a`分配给它。现在可以清楚地看到 using`a`会导致`NullReferenceException`.

# shell - 从文件中读取随机行的简单方法是什么？

> ID：448005
> 
> 赞同：268
> 
> 时间：2009-01-15T19:01:30.500
> 
> 标签：shell, random

从 shell 脚本中的文件中读取随机行的简单方法是什么？

* * *

## 回答 #1

> 赞同：389
> 
> 时间：2009-01-15T19:30:38.257

您可以使用`shuf`：

```
shuf -n 1 $FILE 
```

还有一个名为`rl`. 在 Debian 中，它位于`randomize-lines`完全符合您要求的软件包中，但并非在所有发行版中都可用。在其主页上，它实际上建议使用`shuf`代替（我相信它在创建时不存在）。 `shuf`是 GNU coreutils 的一部分，`rl`不是。

```
rl -c 1 $FILE 
```

* * *

## 回答 #2

> 赞同：74
> 
> 时间：2009-01-16T08:54:15.137

另一种选择：

```
head -$((${RANDOM} % `wc -l < file` + 1)) file | tail -1 
```

* * *

## 回答 #3

> 赞同：71
> 
> 时间：2010-11-10T12:28:04.560

```
sort --random-sort $FILE | head -n 1 
```

（不过，我更喜欢上面的 shuf 方法——我什至不知道它的存在，而且我永远也不会自己找到那个工具）

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2016-05-23T07:01:26.957

这很简单。

```
cat file.txt | shuf -n 1 
```

当然，这仅比“shuf -n 1 file.txt”本身慢一点。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-01-15T19:06:24.623

[perlfaq5：如何从文件中选择随机行？](http://perldoc.perl.org/perlfaq5.html#How-do-I-select-a-random-line-from-a-file%3f)这是来自骆驼书的水库采样算法：

```
perl -e 'srand; rand($.) < 1 && ($line = $_) while <>; print $line;' file 
```

与读取整个文件相比，这在空间上具有显着优势。您可以在 Donald E. Knuth 的 The Art of Computer Programming, Volume 2, Section 3.4.2 中找到这种方法的证明。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-01-15T19:12:25.297

使用 bash 脚本：

```
#!/bin/bash
# replace with file to read
FILE=tmp.txt
# count number of lines
NUM=$(wc - l < ${FILE})
# generate random number in range 0-NUM
let X=${RANDOM} % ${NUM} + 1
# extract X-th line
sed -n ${X}p ${FILE} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-15T19:17:59.030

单 bash 行：

```
sed -n $((1+$RANDOM%`wc -l test.txt | cut -f 1 -d ' '`))p test.txt 
```

小问题：重复的文件名。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-01-15T19:07:22.030

这是一个简单的 Python 脚本，可以完成这项工作：

```
import random, sys
lines = open(sys.argv[1]).readlines()
print(lines[random.randrange(len(lines))]) 
```

用法：

```
python randline.py file_to_get_random_line_from 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2013-09-04T06:43:08.610

**使用“ awk** ”的另一种方式

```
awk NR==$((${RANDOM} % `wc -l < file.name` + 1)) file.name 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2015-08-17T09:10:07.940

一个同样适用于 MacOSX 的解决方案，也应该适用于 Linux（？）：

```
N=5
awk 'NR==FNR {lineN[$1]; next}(FNR in lineN)' <(jot -r $N 1 $(wc -l < $file)) $file 
```

在哪里：

*   `N`是你想要的随机行数

*   `NR==FNR {lineN[$1]; next}(FNR in lineN) file1 file2` --> 保存写入的行号`file1`，然后打印对应的行`file2`

*   `jot -r $N 1 $(wc -l < $file)`-->在.范围内`N`随机抽取数字 ( `-r`) 进程替换将使它看起来像解释器的文件，所以在前面的例子中。`(1, number_of_line_in_file)``jot``<()``file1`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-08-23T07:41:10.063

这是我发现的，因为我的 Mac OS 没有使用所有简单的答案。我使用 jot 命令生成一个数字，因为在我的测试中 $RANDOM 变量解决方案似乎不是很随机。在测试我的解决方案时，输出中提供的解决方案存在很大差异。

```
 RANDOM1=`jot -r 1 1 235886`
   #range of jot ( 1 235886 ) found from earlier wc -w /usr/share/dict/web2
   echo $RANDOM1
   head -n $RANDOM1 /usr/share/dict/web2 | tail -n 1 
```

变量的回声是为了获得生成的随机数的视觉效果。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-06-15T13:00:15.587

```
#!/bin/bash

IFS=$'\n' wordsArray=($(<$1))

numWords=${#wordsArray[@]}
sizeOfNumWords=${#numWords}

while [ True ]
do
    for ((i=0; i<$sizeOfNumWords; i++))
    do
        let ranNumArray[$i]=$(( ( $RANDOM % 10 )  + 1 ))-1
        ranNumStr="$ranNumStr${ranNumArray[$i]}"
    done
    if [ $ranNumStr -le $numWords ]
    then
        break
    fi
    ranNumStr=""
done

noLeadZeroStr=$((10#$ranNumStr))
echo ${wordsArray[$noLeadZeroStr]} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-12-14T21:43:06.590

仅使用 vanilla sed 和 awk，而不使用 $RANDOM，一个简单、节省空间且相当快速的“单行”，用于从名为 FILENAME 的文件中伪随机选择单行，如下所示：

```
sed -n $(awk 'END {srand(); r=rand()*NR; if (r<NR) {sub(/\..*/,"",r); r++;}; print r}' FILENAME)p FILENAME 
```

（即使 FILENAME 为空，这也有效，在这种情况下不会发出任何行。）

这种方法的一个可能优点是它只调用 rand() 一次。

正如@AdamKatz 在评论中指出的那样，另一种可能性是为每一行调用 rand() ：

```
awk 'rand() * NR < 1 { line = $0 } END { print line }' FILENAME 
```

（可以基于归纳给出简单的正确性证明。）

### 警告`rand()`

“在大多数 awk 实现中，包括 gawk，每次运行 awk 时，rand() 都会从相同的起始数字或种子开始生成数字。”

-- [https://www.gnu.org/software/gawk/manual/html_node/Numeric-Functions.html](https://www.gnu.org/software/gawk/manual/html_node/Numeric-Functions.html)

# makefile - “没有给出文件名”是什么意思作为一个make错误？

> ID：448009
> 
> 赞同：1
> 
> 时间：2009-01-15T19:02:48.937
> 
> 标签：makefile, c++builder

我正在尝试构建一个 makefile，大约 5 秒后，我收到此错误：“没有给出文件名”。这是什么意思，我该如何解决？

```
[exec] Borland C++ 5.5.1 for Win32 Copyright (c) 1993, 2000 Borland
[exec] Error E2266: No file names given
[exec] ** error 1 ** deleting paslib.lib 
```

这是从带有选项“-B”和-“fproject.bpg”的 BPG 文件运行的。

我对 makefile 比较陌生，所以我不确定如何将 Make 文件传递​​给编译器。据我了解，我使用包含各种项目的 make 文件调用 make。Make 文件获取每个项目，创建另一个 makefile（使用 bpr2mak），然后编译它（使用 bcc32）。它是否正确？如果是，那么 make 应该将要构建的文件名传递给编译器。从我的输出来看，该项目成功地制作了一个 make 文件，但编译器失败了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-28T21:22:43.120

事实证明，实际问题出在 bcc32.exe，而不是 make。问题在这里讨论： [为什么 Borland C++ Builder 5 命令行编译器找不到我的文件？](https://stackoverflow.com/questions/489308/why-cant-the-borland-c-builder-5-command-line-compiler-find-my-files)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T19:35:24.220

看起来您正在调用 Borland C++ 编译器命令，而没有传递任何文件名进行编译。也许应该包含 C++ 文件名的 Make 变量为空、拼写错误等。

# javascript - 部分显示和隐藏 DIV

> ID：448015
> 
> 赞同：2
> 
> 时间：2009-01-15T19:04:39.400
> 
> 标签：javascript, jquery, html, templating

我需要部分隐藏 DIV，而不是完全隐藏。当页面加载时，我希望它显示第一个，比如说，位于 div 最上部的 100 像素。当用户点击某个按钮时，会打开 div（可能是 jQuery 的 show() 之类的滑动效果）。当用户点击返回相同的按钮时，div 将返回其原始状态，仅显示前 100 个像素。我试图弄清楚如何用 jQuery 做到这一点，因为它似乎是做到这一点的最好方法。有什么提示吗？谢谢你。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T19:07:55.510

可以通过将 div 的初始高度设置为 100px 并将其溢出设置为隐藏在 CSS 中来完成。然后，当您在 javascript 按钮单击时显示完整的 div 时，您可以将 div 的高度更改为自动。

示例：[http ://www.quirksmode.org/css/overflow.html](http://www.quirksmode.org/css/overflow.html)

CSS 代码：

```
overflow : hidden; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T19:12:22.583

您将需要切换方法和一些动画，jquery 样式：

使用 Css 将 div 的高度设置为 10px。

```
$("td").toggle(
  function () {
    $(this).animate( { height:"100px" } , 1000 )
  },
  function () {
     $(this).animate( { height:"10px" } , 1000 )
  }
); 
```

# css - Internet Explorer - 浮动 div 之间的空间

> ID：448017
> 
> 赞同：1
> 
> 时间：2009-01-15T19:05:14.140
> 
> 标签：css, internet-explorer, html, css-float

我遇到了 Internet Explorer 的演示问题。以下简单的代码块在 Safari、FireFox、Chrome 和 Opera 中呈现我所期望的效果。但是，它会导致IE6 和 IE7 中左右浮动的 DIV 元素之间存在明显的**空间。**

我的问题是：是否有更**正确**的方法来实现浮动，以使相同的 CSS 在 IE 和我提到的其他浏览器中都有效？如果没有，摆脱 Internet Explorer 空间的最佳方法是什么？

谢谢，马特

```
<style>
.left {
    width:100px;
    float:left;
    border: solid black 1px;
}

.right {
    width: 100px;
    margin-left:100 px;
    border: solid red 1px;
}
</style>

<div class="left">
    a
</div>
<div class="right">
    b
</div> 
```

因为这是一个社区维基。我想我会用下面计划 B 提出的解决方案发布工作代码。

```
<style>
        .left {
        width:100px;
        border: solid black 1px;
        float:left;
    }

    .right {
        width:100px;
        border: solid red 1px;
        float:left;
    }
    .clear {
        clear:both;
    }
</style>

<div class="left">
    a
</div>
<div class="right">
    b
</div>
<div class="clear"></div>
c 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T19:16:32.137

将它们都向左浮动，在两个 div 之后添加以下内容：

```
 <div class="clear"></div>

 .clear { clear: both; } 
```

或者使用填充而不是边距。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-20T21:19:08.400

```
.body {
    padding:0px;
    margin:0px;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T19:09:11.420

这是双边距浮动错误。这里描述得很好：

[http://www.positioniseverything.net/explorer/doubled-margin.html](http://www.positioniseverything.net/explorer/doubled-margin.html)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-15T19:07:28.257

尝试添加`display: inline`到浮动 div。我相信这是为浮动元素添加更多边距的 IE 错误。display: inline 过去为我工作过。希望这可以帮助。

# sql - 左、右、外连接和内连接有什么区别？

> ID：448023
> 
> 赞同：580
> 
> 时间：2009-01-15T19:07:31.377
> 
> 标签：sql, database, join

我想知道如何区分所有这些不同的连接......

* * *

## 回答 #1

> 赞同：821
> 
> 时间：2009-01-15T19:18:49.527

**简单示例**：假设您有一张`Students`桌子和一张`Lockers`桌子。在 SQL 中，您在连接中指定的第一个表`Students`, 是**LEFT**表，第二个表`Lockers`, 是**RIGHT**表。

每个学生都可以分配到一个储物柜，因此表格`LockerNumber`中有一个列`Student`。一个储物柜可能有多个学生，但尤其是在学年开始时，您可能会有一些没有储物柜的新生和一些没有分配学生的储物柜。

为了这个例子，假设你有**100 个学生**，其中 70 个有储物柜。您总共有**50 个储物柜**，其中 40 个储物柜至少有 1 个学生，10 个储物柜没有学生。

`INNER JOIN`相当于“*告诉我所有有储物柜的学生*”。
任何没有储物柜的学生，或任何没有学生的储物柜都丢失了。
**返回 70 行**

`LEFT OUTER JOIN`将是“*向我展示所有学生，如果他们有相应的储物柜的话*”。
这可能是一个普通的学生名单，或者可以用来识别没有储物柜的学生。
**返回 100 行**

`RIGHT OUTER JOIN`将是“*向我展示所有储物柜，以及分配给它们的学生（如果有的话*）”。
这可用于识别没有分配学生的储物柜，或有太多学生的储物柜。
**返回 80 行**（40 个储物柜中的 70 个学生的列表，加上没有学生的 10 个储物柜）

`FULL OUTER JOIN`会很愚蠢，可能没有多大用处。
类似“*显示所有学生和所有储物柜，并在可以匹配的地方匹配它们*”
**返回 110 行**（所有 100 名学生，包括没有储物柜的学生。加上没有学生的 10 个储物柜）

`CROSS JOIN`在这种情况下也相当愚蠢。
它不使用`lockernumber`学生表中的链接字段，因此您基本上最终会得到一个巨大的列表，其中包含每个可能的学生到储物柜配对，无论它是否真的存在。
**返回 5000 行**（100 个学生 x 50 个储物柜）。可能有用（通过过滤）作为将新学生与空储物柜匹配的起点。

* * *

## 回答 #2

> 赞同：149
> 
> 时间：2009-01-15T19:24:29.047

有三种基本的连接类型：

*   `INNER`join 比较两个表，并且只返回存在匹配的结果。当第一个表中的记录与第二个表中的多个结果匹配时，它们会重复。INNER 连接倾向于使结果集更小，但由于记录可以重复，这不能保证。
*   `CROSS`join 比较两个表并返回两个表中所有可能的行组合。您可以从这种连接中获得很多甚至可能没有意义的结果，因此请谨慎使用。
*   `OUTER`join 比较两个表并在匹配可用时返回数据，否则返回 NULL 值。与 INNER 连接一样，当它匹配另一张表中的多条记录时，这将复制一张表中的行。OUTER 联接倾向于使结果集更大，因为它们本身不会从集中删除任何记录。您还必须限定 OUTER 连接以确定何时何地添加 NULL 值：
    *   `LEFT`意味着无论如何都保留第一个表中的所有记录，并在第二个表不匹配时插入 NULL 值。
    *   `RIGHT`意思相反：无论如何保留第二张表中的所有记录，并在第一张表不匹配时插入 NULL 值。
    *   `FULL`表示保留两个表中的所有记录，如果没有匹配项，则在任一表中插入 NULL 值。

您经常会看到`OUTER`语法中省略了关键字。相反，它将只是“LEFT JOIN”、“RIGHT JOIN”或“FULL JOIN”。这样做是因为 INNER 和 CROSS 连接对于 LEFT、RIGHT 或 FULL 没有任何意义，因此它们本身就足以明确指示 OUTER 连接。

以下是您可能想要使用每种类型的示例：

*   `INNER`：您希望从“Invoice”表中返回所有记录，以及它们对应的“InvoiceLines”。这假定每张有效的发票都至少有一行。
*   `OUTER`：您想要返回特定发票的所有“InvoiceLines”记录，以及它们对应的“InventoryItem”记录。这是一家也销售服务的企业，因此并非所有 InvoiceLines 都有 IventoryItem。
*   `CROSS`：您有一个包含 10 行的数字表，每行包含值 '0' 到 '9'。您想要创建一个日期范围表来加入，以便您最终在该范围内的每一天都有一条记录。通过重复将此表与自身交叉连接，您可以根据需要创建任意数量的连续整数（假设您从 10 的 1 次方开始，每次连接都会将 1 添加到指数）。然后使用 DATEADD() 函数将这些值添加到范围的基准日期。

* * *

## 回答 #3

> 赞同：50
> 
> 时间：2009-01-15T19:13:21.427

只有4种：

1.  **内连接**：最常见的类型。为在连接条件上匹配的每对输入行生成一个输出行。
2.  **左外连接**：与内连接相同，只是如果在右侧表中找不到任何匹配行，则输出包含左侧表中的值的行，`NULL`每个右表中的值。这意味着左侧表格中的每一行将在输出中至少出现一次。
3.  **右外连接**：与左外连接相同，只是表的角色颠倒了。
4.  **全外连接**：左右外连接的组合。两个表中的每一行都将在输出中至少出现一次。

“交叉连接”或“笛卡尔连接”只是没有指定连接条件的内部连接，导致输出所有行对。

感谢 RusselH 指出 FULL 连接，我省略了。

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2018-01-12T04:26:30.817

SQL JOINS 区别：

很容易记住：

`INNER JOIN`只显示两个表共有的记录。

`OUTER JOIN`两个表的所有内容都合并在一起，无论它们是否匹配。

`LEFT JOIN`与`LEFT OUTER JOIN`- （从第一个（最左侧）表中选择具有匹配右表记录的记录。）

`RIGHT JOIN`与`RIGHT OUTER JOIN`- （从第二个（最右侧）表中选择具有匹配左表记录的记录。）

[![在此处输入图像描述](https://i.stack.imgur.com/iJUMl.png)](https://i.stack.imgur.com/iJUMl.png)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-15T19:15:22.577

[在 Wikipedia 上](http://en.wikipedia.org/wiki/Join_(SQL))查看Join (SQL)

*   内连接 - 给定两个表，内连接返回两个表中存在的所有行
*   左/右（外部）连接 - 给定两个表返回存在于连接的左表或右表中的所有行，加上当连接子句匹配时将返回另一侧的行，否则将返回 null那些列

*   Full Outer - 给定两个表返回所有行，当左列或右列不存在时将返回空值

*   交叉连接 - 笛卡尔连接，如果不小心使用可能会很危险

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2017-06-28T18:16:58.340

让它更明显可能会有所帮助。一个例子：

表格1：

ID_STUDENT STUDENT_NAME

```
1               Raony
2               Diogo
3               Eduardo
4               Luiz 
```

表 2：

ID_STUDENT 储物柜

```
3               l1
4               l2
5               l3 
```

当我这样做时，我得到了什么：

```
-Inner join of Table 1 and Table 2: 

    - Inner join returns both tables merged only when the key 
      (ID_STUDENT) exists in both tables

    ID_STUDENT       STUDENT_NAME      LOCKER   

        3               Eduardo          l1
        4               Luiz             l2

-Left join of Table 1 and Table 2:

    - Left join merges both tables with all records form table 1, in 
      other words, there might be non-populated fields from table 2

    ID_ESTUDANTE    NOME_ESTUDANTE     LOCKER   

        1               Raony            -
        2               Diogo            -
        3               Eduardo          l1
        4               Luiz             l2

-Right join of table 1 and table 2:

    - Right join merges both tables with all records from table 2, in 
      other words, there might be non-populated fields from table 1

    ID_STUDENT        STUDENT_NAME     LOCKER   

        3               Eduardo          l1
        4               Luiz             l2
        5               -                l3

-Outter join of table 1 and table 2:

    - Returns all records from both tables, in other words, there
      might be non-populated fields either from table 1 or 2.

    ID_STUDENT        STUDENT_NAME     LOCKER   
        1               Raony            -
        2               Diogo            -
        3               Eduardo          l1
        4               Luiz             l2
        5               -                l3 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-15T19:14:09.583

`LEFT JOIN``RIGHT JOIN`是s的类型`OUTER JOIN`。

`INNER JOIN`是默认值——两个表中的行必须匹配连接条件。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2015-02-15T20:20:53.323

**内连接**：只显示行，当它有来自两个表的数据时。

**外连接**：（*左/右）*：显示*左/右*表的所有结果与配对行（*s*），如果它*存在*与否。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-11-02T15:47:16.647

首先你要明白join是做什么的？我们连接多个表并从连接的表中获取特定结果。最简单的方法是**交叉连接**。

假设 tableA 有两列 A 和 B。而 tableB 有三列 C 和 D。如果我们应用交叉连接，它将产生很多无意义的行。然后我们必须使用主键进行匹配以获取实际数据。

**左：**它将返回左表中的所有记录和右表中的匹配记录。

**右：**它将与左连接相反。它将返回右表中的所有记录和左表中的匹配记录。

**内：**这就像十字路口。它将只返回两个表中匹配的记录。

**外：**这就像联合。它将返回两个表中的所有可用记录。

有时我们不需要所有数据，而且我们应该只需要公共数据或记录。我们可以使用这些连接方法轻松获得它。记住左右连接也是外连接。

您只需使用交叉连接即可获取所有记录。但是当涉及到数百万条记录时，它可能会很昂贵。因此，通过使用左、右、内或外连接使其变得简单。

谢谢

# python - 多线程资源访问——我应该把锁放在哪里？

> ID：448034
> 
> 赞同：5
> 
> 时间：2009-01-15T19:09:13.930
> 
> 标签：python, multithreading, locking

我有线程代码，每个线程都需要写入同一个文件。为了防止并发问题，我使用了 Lock 对象。

我的问题是我是否正确使用了锁。如果我从每个线程中设置锁，该锁是全局的还是仅特定于该特定线程？

基本上，我应该先创建一个 Lock 并将其引用传递给每个线程，还是可以像我在这里所做的那样从线程内设置它：

```
import time
from threading import Thread, Lock

def main():
    for i in range(20):
        agent = Agent(i)
        agent.start()

class Agent(Thread):
    def __init__(self, thread_num):
        Thread.__init__(self)
        self.thread_num = thread_num

    def run(self):
        while True:
            print 'hello from thread %s' % self.thread_num
            self.write_result()   

    def write_result(self):
        lock = Lock()
        lock.acquire()
        try:
            f = open('foo.txt', 'a')
            f.write('hello from thread %s\n' % self.thread_num)
            f.flush()
            f.close()
        finally:
            lock.release()

if __name__ == '__main__':
    main() 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T19:30:46.883

对于您的用例，一种方法可能是编写一个`file`锁定的子类：

```
class LockedWrite(file):
    """ Wrapper class to a file object that locks writes """
    def __init__(self, *args, **kwds):
        super(LockedWrite, self).__init__(*args, **kwds)
        self._lock = Lock()

    def write(self, *args, **kwds):
        self._lock.acquire()
        try:
            super(LockedWrite, self).write(*args, **kwds)
        finally:
            self._lock.release() 
```

要在您的代码中使用，只需替换以下函数：

```
def main():
    f = LockedWrite('foo.txt', 'a')

    for i in range(20):
        agent = Agent(i, f)
        agent.start()

class Agent(Thread):
    def __init__(self, thread_num, fileobj):
        Thread.__init__(self)
        self.thread_num = thread_num
        self._file = fileobj    

#   ...

    def write_result(self):
        self._file.write('hello from thread %s\n' % self.thread_num) 
```

这种方法将文件锁定放在文件本身中，这看起来更干净恕我直言

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-15T19:16:13.183

在方法之外创建锁。

```
class Agent(Thread):
    mylock = Lock()
    def write_result(self):
        self.mylock.acquire()
        try:
            ...
        finally:
            self.mylock.release() 
```

或者如果使用 python >= 2.5：

```
class Agent(Thread):
    mylock = Lock()
    def write_result(self):
        with self.mylock:
            ... 
```

要在 python 2.5 中使用它，您必须从未来导入语句：

```
from __future__ import with_statement 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T19:17:25.863

lock() 方法为每次调用返回一个锁对象。所以每个线程（实际上是对 write_result 的每个调用）都会有一个不同的锁对象。并且不会有锁定。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-15T19:18:13.880

使用的锁需要对所有线程通用，或者至少确保两个锁不能同时锁定同一个资源。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T19:19:51.820

锁实例应该与文件实例相关联。

换句话说，您应该同时创建锁和文件，并将两者传递给每个线程。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-15T19:52:41.830

您可以通过将单个线程（可能专门为此目的创建）指定为写入文件的唯一线程，并让所有其他线程通过将他们想要添加到文件中的字符串放入`queue.Queue`对象中。

队列具有内置的所有锁定功能，因此任何线程都可以随时安全地调用`Queue.put()`。文件编写器将是唯一的线程调用`Queue.get()`，并且可能会花费大部分时间阻塞该调用（具有合理的超时以允许线程干净地响应关闭请求）。所有同步问题都将由队列处理，您不必担心是否在某处忘记了某些锁定获取/释放... :)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-15T19:18:48.733

我很确定每个线程的锁需要是同一个对象。试试这个：

```
import time
from threading import Thread, Lock

def main():
    lock = Lock()
    for i in range(20):
        agent = Agent(i, lock)
        agent.start()

class Agent(Thread, Lock):
    def __init__(self, thread_num, lock):
        Thread.__init__(self)
        self.thread_num = thread_num
        self.lock = lock

    def run(self):
        while True:
            print 'hello from thread %s' % self.thread_num
            self.write_result()   

    def write_result(self):
        self.lock.acquire()
        try:
            f = open('foo.txt', 'a')
            f.write('hello from thread %s\n' % self.thread_num)
            f.flush()
            f.close()
        finally:
            lock.release()

if __name__ == '__main__':
    main() 
```

# java - 使用 JDBC，如何将多个 ID 替换为“DELETE FROM T WHERE id IN (?)”

> ID：448036
> 
> 赞同：1
> 
> 时间：2009-01-15T19:09:38.157
> 
> 标签：java, sql, jdbc, prepared-statement

我有一些代码可以生成一组我想从数据库表中删除的主键值。

```
long[] keysToDelete = { 0, 1, 2, 3 }; 
```

我想使用 PreparedStatement 来执行相当于

```
DELETE FROM MyTable WHERE myPrimaryKey IN (0, 1, 2, 3); 
```

知道怎么做吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-15T19:12:31.617

两步：

1.  使用适当的参数 # 构建 PreparedStatement SQL 字符串。
2.  循环遍历值数组并将每个值绑定到其参数。

不幸的是，没有很好的方法来一次绑定一个数组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-01-13T13:01:53.747

我编写了一个类来动态生成这样的多参数查询。它目前有一些限制（为了快速编写）并且尚未经过彻底测试，但可能是让您入门的好方法。限制：

*   只处理一个多参数参数 (??)
*   错误地将引号中的问号识别为参数
*   API 并不漂亮，但另一种选择是编写一个具有大量状态管理的完整 PreparedStatement 装饰器，这比我愿意投入的工作要多。

来源：

```
/**
 * A PreparedStatement decorator that can bind a set of arguments
 *
 * A specialized ?? placeholder in a string can be bound to a set of
 * values instead of just single values. Currently, only one such
 * specialized placeholder is supported, and you must bind it before
 * obtaining the prepared statement.
 *
 * If you want to bind additional values to the PreparedStatement after
 * producing it, you must run the parameter index through the param()
 * method.
 *
 * Example use:
 *
 * 
 *     MultiValueBinder binder = new MultiValueBinder(
 *          "UPDATE table SET value = ? WHERE id IN (??)", conn);
 *     binder.setInts(myIds);
 *
 *     PreparedStatement stmt = binder.statement();
 *     stmt.setString(binder.param(1), "myValue");
 *
 *     ResultSet rs = stmt.executeQuery();
 *
 * Note: this class is not robust against using question marks in literal
 * strings. Don't use them :).
 */
public class MultiValueBinder {
    private Connection connection;
    private PreparedStatement statement;
    private String sql;

    private int argumentsBefore = 0;
    private int setSize         = 0;

    public MultiValueBinder(String sql, Connection connection) {
        this.sql        = sql;
        this.connection = connection;
    }

    /**
     * Bind a collection of integers to the multi-valued argument
     */
    public void setInts(Collection<Integer> ints) throws SQLException {
        explodeQuery(ints.size());
        buildStatement();
        try {

            int i = 0;
            for (Integer integer: ints)
                statement.setInt(1 + argumentsBefore + i++, integer);

        } catch (Exception ex) {
            cleanStatement();
            throw (ex instanceof SQLException) ? (SQLException) ex : new SQLException(ex);
        }
    }

    /**
     * Bind a collection of strings to the multi-valued argument
     */
    public void setStrings(Collection<String> strings) throws SQLException {
        explodeQuery(strings.size());
        buildStatement();
        try {

            int i = 0;
            for (String str: strings)
                statement.setString(1 + argumentsBefore + i++, str);

        } catch (Exception ex) {
            cleanStatement();
            throw (ex instanceof SQLException) ? (SQLException) ex : new SQLException(ex);
        }
    }

    /**
     * Explode the multi-value parameter into a sequence of comma-separated
     * question marks.
     */
    private void explodeQuery(int size) throws SQLException {
        int mix = sql.indexOf("??");
        if (mix == -1) throw new SQLException("Query does not contain a multi-valued argument.");
        if (size == 0) throw new SQLException("Can't bind an empty collection; generated SQL won't parse.");

        // Count the number of arguments before the multi-marker
        argumentsBefore = 0;
        for (int i = 0; i < mix; i++) {
            if (sql.charAt(i) == '?') argumentsBefore++;
        }
        setSize = size;

        // Generate the exploded SQL query
        StringBuilder sb = new StringBuilder(sql.substring(0, mix)); // Start
        for (int i = 0; i < setSize; i++) {                          // ?, ?, ...
            if (i > 0) sb.append(", ");
            sb.append('?');
        }
        sb.append(sql.substring(mix + 2));                           // Remainder
        sql = sb.toString();
    }

    /**
     * Create the statement if it hasn't been created yet
     */
    private void buildStatement() throws SQLException {
        if (statement != null) return;
        if (sql.contains("??"))
            throw new SQLException("Multi-valued argument not bound yet.");
        statement = connection.prepareStatement(sql);
    }

    private void cleanStatement() {
        if (statement != null) {
            try {
                statement.close();
            } catch (Exception ex) {
                /* Ignore */
            }
            statement = null;
        }
    }

    public PreparedStatement statement() throws SQLException {
        buildStatement();
        return statement;
    }

    /**
     * Transform the 1-based-index of the given argument before query expansion
     * into the index after expansion.
     *
     * The ?? placeholder takes up one index slot.
     */
    public int param(int ix) {
        if (ix <= argumentsBefore) return ix;
        if (ix == argumentsBefore + 1)
            throw new RuntimeException(ix + " is the index of the multi-valued parameter.");
        return argumentsBefore + 1 + setSize;
    }
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T19:28:41.800

不完全确定，但这可能会有所帮助：

```
PreparedStatement pstmt = Connection.prepareStatement("DELETE FROM MyTable WHERE myPrimaryKey IN (?)");
pstmt.setArray(1, idArray); 
```

# browser - Linux中的模型（3ds）统计和快照

> ID：448043
> 
> 赞同：0
> 
> 时间：2009-01-15T19:11:56.110
> 
> 标签：browser, models, 3ds

我想编写一个应用程序，通过 cmd 行接收模型文件名，创建统计列表（多边形计数，缩放，尽可能多的或者我想要的统计）并加载模型及其纹理（使用其他任何东西）并从多个位置绘制它以将图像保存为png。

我该怎么做？有没有我可以用来从模型中提取数据的工具？画模型怎么样？我的服务器没有台式机或显卡，没有视频硬件会不会有问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T19:19:02.553

您可以使用[http://www.lib3ds.org/](http://www.lib3ds.org/)来读取数据，IIRC 它还附带了一个示例程序，您可以将其作为代码的基础。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T19:15:56.880

[查看wotsit.org](http://www.wotsit.org/list.asp?fc=2)上的 3DS 规格。AFAIK，没有官方规格。另一种可能性是寻找开源 3DS 库/工具并使用它们。

# asp.net - 使用 AJAX 隐藏/显示控件

> ID：448054
> 
> 赞同：1
> 
> 时间：2009-01-15T19:14:07.820
> 
> 标签：asp.net, ajax

我正在使用一个支持 ASP.NET AJAX 的 Web 应用程序（ASP.NET 2.0 和 AJAX Toolkit 1.0），它包含一个按钮和 2 个 UpdatePanel（UpdatePanel_1 和 UpdatePanel_2）

该按钮在 ScriptManager 对象中注册到 RegisterAsyncPostBackControl，UpdatePanel_1 处于“条件”更新模式并包含一个文本框。

UpdatePanel_2 处于“始终”更新模式并包含另一个 TextBox

当按下按钮时，它的处理程序调用 UpdatePanel_1.Update() 根据列表中随机选择的值更新 TextBox 的值；UpdatePanel_2 的 TextBox 也会自动更新，也无需刷新页面

基于布尔 ViewState 变量的值，我还想隐藏/显示 UpdatePanels，但出现错误：

“Sys.InvalidOperationException：找不到 ID 为“UpdatePanel_2”（或 UpdatePanel_1）的 UpdatePanel。

如果它是动态更新的，那么它必须在另一个 UpdatePanel 中”

如何在不添加额外的包装 UpdatePanel 的情况下完成？

```
protected void Page_Load(object sender, EventArgs e)
{
    ScriptManager1.RegisterAsyncPostBackControl(Button1); 

    if (!IsPostBack)   
    {

        Visibility = true;
    }

    UpdatePanel_1.Visible = !Visibility;
    UpdatePanel_2.Visible = Visibility;

    Visibility = !Visibility;        
}

protected void Button1_Click(object sender, EventArgs e)
{
        if (Panel1.Visible)
                 UpdatePanel_1.Update();    
}

protected bool Visibility
{
    get
    {
        return (bool)(ViewState["Visibility"] ?? true);
    }
    set
    {
        ViewState["Visibility"] = value;
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-26T20:04:14.853

问题是不可见的控件不会呈现给客户端。因此，试图让它们可见是行不通的，因为就客户而言，它们不存在。

尝试使用 style="display:none"，或者对可见和不可见面板使用不同的 CSS 类和样式，而不是设置 visible=false;

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-18T03:01:07.477

你可以不可见，或者可见控件是updatepanel的子级，不是不可见，可见updatepanel，我尝试使用updatemode = conditional but error，然后我将可见控件添加到updatepanel。希望对你有帮助 谢谢大家发帖

# c++ - C++ 单例 GetInstance() 返回

> ID：448056
> 
> 赞同：17
> 
> 时间：2009-01-15T19:14:09.647
> 
> 标签：c++, reference, singleton, pointers

在 C++ 中实现单例时，GetInstance() 是返回指向单例对象的指针还是引用更好？真的有关系吗？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-01-15T19:17:14.710

我更喜欢参考。每当我想记录以下内容时，我都会使用引用而不是指针：

*   不能为空
*   它不会被改变（指向别的东西）
*   它不应该被删除

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-15T19:19:29.620

我认为返回引用会更安全，但不要忘记单例对象的“复制保护”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T19:16:37.333

除了返回引用隐式保证单例存在之外，这无关紧要。（如果没有，你应该抛出一个异常。）

这也忽略了单例是邪恶的，就像全局是邪恶的一样，因为单例基本上是设计模式服装中的全局变量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-12-14T21:36:52.570

getInstance() 方法返回一个引用，因为函数静态对象在控制流第一次传递其定义时被初始化。此外，使用引用更好：现在用户不能删除单例的指针。另外，这个实现非常简单！

```
class CKeyboard
{
public:
    static CKeyboard& GetInstance()
    {
        static CKeyboard keyboard;
        return keyboard;
    }

private:
    CKeyboard() {}
    CKeyboard(const CKeyboard&);
    CKeyboard& operator=(const CKeyboard&);
}; 
```

[http://www.devartplus.com/3-simple-ways-to-create-singleton-in-c/](http://www.devartplus.com/3-simple-ways-to-create-singleton-in-c/)

# browser - 在浏览器中查看模型

> ID：448058
> 
> 赞同：0
> 
> 时间：2009-01-15T19:14:26.150
> 
> 标签：browser, viewer, 3ds

有没有办法通过 Flash、Java 或其他方式在浏览器中查看模型？

模型将存储在我的服务器上，客户端可以查看它以及纹理和模型需要的任何其他内容。

我想要任何与 3ds 完美配合的浏览器应用程序。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-15T19:28:55.980

VRML 基本上已经死了，但你仍然可以找到它的浏览器插件。本页介绍了一些更新的 3D 网络技术：[http ://en.wikipedia.org/wiki/Vrml](http://en.wikipedia.org/wiki/Vrml)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T19:34:27.187

看一下这个：

[http://blog.promethe.net/2008/12/24/display-half-life-3d-models-with-flash-10/](http://blog.promethe.net/2008/12/24/display-half-life-3d-models-with-flash-10/)

它还提到了一种叫做[DirectFlex](http://blog.directflex.net/what-is-directflex/)的东西，我个人没有使用过，但无论如何，这些链接中的任何一个都可能为您指明使用 Flash 10 显示模型的正确方向。希望能帮助到你！

# linq - Linq to Entities、EntityReferences 和 DataGridViews

> ID：448076
> 
> 赞同：1
> 
> 时间：2009-01-15T19:18:23.617
> 
> 标签：linq, datagridview, entityreference

我正在尝试从我的实体中选择某些字段以用作 datagridview 的数据源，但我无法使其工作。这样的事情可能吗？例如，我有一个包含多个实体引用的客户实体。我想从客户实体和这些实体引用中获取字段，并将它们显示在 datagridview 中。我一直无法想出一个 Linq 查询来完成此操作，即使您只是将整个实体用作数据源，也不会显示实体引用中的字段。知道我做错了什么吗？谢谢您的帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-15T19:32:16.193

```
from customer in context.customers
select new 
{
    Name = customer.Name,
    City = customer.Address.City
} 
```

这将创建一个自定义对象，您可以看到第二个属性正在引用主实体上的实体字段。基本上只需将数据转换为新对象并将生成的可枚举绑定到网格。

抱歉，如果这有点含糊不清，在我的手机上打字。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T19:54:44.197

警告：这没有使用实体框架引用进行测试。

使用对象数据源时，您可以引用对象引用的属性，但必须先转换对象：

```
<asp:Label ID="lblCity" runat="server" Text='<%# ((Customer)Container.DataItem).Address.City%>'></asp:Label> 
```

这可能是您访问实体引用属性的问题吗？

# javascript - 使用 OPENROWSET 通过 SQL Server 访问 Oracle DB

> ID：448077
> 
> 赞同：2
> 
> 时间：2009-01-15T19:18:38.483
> 
> 标签：javascript, sql-server, oracle, openrowset

我正在尝试使用客户端 Javascript 中的 OPENROWSET 通过 SQL Server 访问大型 Oracle 数据库，但运气不佳。以下是详细信息：

*   使用 OPENROWSET 访问 Oracle 数据库的 SQL Server 视图运行良好，所以我知道我有有效的连接字符串参数。但是，新的要求是依赖于客户端选择的极其动态的 Oracle 查询，我无法让动态（甚至参数化的）Oracle 查询从 SQL Server 视图或存储过程中工作。
*   对 SQL Server 数据库的客户端访问与动态和参数化查询完美配合。
*   我不能指望拥有任何 Oracle 客户端软件的客户。因此，必须通过 SQL Server 数据库、使用视图、存储过程或使用 OPENROWSET 的动态查询来访问 Oracle 数据库。
*   因为 SQL Server 数据库位于共享服务器上，所以我不允许使用全局链接数据库。

我的想法是定义一个函数，该函数将采用我自己版本的参数化 Oracle 查询，进行参数替换，将查询​​包装在 OPENROWSET 中，然后在 SQL Server 中执行，返回结果记录集。这是示例代码：

```
// db is a global variable containing an ADODB.Connection opened to the SQL Server DB
// rs is a global variable containing an ADODB.Recordset
. . .
ss = "SELECT myfield FROM mytable WHERE {param0} ORDER BY myfield;";
OracleQuery(ss,["somefield='" + somevalue + "'"]);
. . .
function OracleQuery(sql,params) {
  var s = sql;
  var i;
  for (i = 0; i < params.length; i++) s = s.replace("{param" + i + "}",params[i]);
  var e = "SELECT * FROM OPENROWSET('MSDAORA','(connect-string-values)';"
    + "'user';'pass','" + s.split("'").join("''") + "') q";
  try {
    rs.Open("EXEC ('" + e.split("'").join("''") + "')",db);
  } catch (eobj) {
    alert("SQL ERROR: " + eobj.description + "\nSQL: " + e);
  }
} 
```

我得到的 SQL 错误对我来说`Ad hoc access to OLE DB provider 'MSDAORA' has been denied. You must access this provider through a linked server.`毫无意义。Microsoft 对此错误的解释与注册表设置 ( `DisallowAdhocAccess`) 有关。这在我的 PC 上设置正确，但这肯定与数据库服务器有关，而不是客户端 PC，我希望那里的设置是正确的，因为上面提到的视图有效。

我尝试过的一种替代方法是消除 Open 语句中的封闭 EXEC：

```
rs.Open(e,db); 
```

但这会产生相同的错误。

我还尝试将 OPENROWSET 放入存储过程中。这在 SQL Server Management Studio 中执行时完美运行，但在从 Javascript 调用存储过程时失败并显示相同的错误消息。

我正在尝试做的事情可能吗？如果是这样，你能推荐如何修复我的代码吗？或者是否需要完全不同的方法？

欢迎任何提示或相关信息。提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T23:02:36.720

我自己来回答这个问题。我找到了答案，但我对结果不满意。有效的功能正在我的个人用户 ID 下运行，并且我拥有 db-owner 权限。为了使*临时*访问正常工作，我需要将`DisallowAdhocAccess`注册表设置设置为 0，或者将 db-owner 权限授予 Web 访问中使用的用户 ID。因为这是一个具有严格安全性的共享服务器，所以我不会被允许更改注册表设置，这会影响到比我的数据库更多的东西。我认为第二种选择同样危险。

结果，我显然坚持强迫用户安装 Oracle Instant Client，这样我就可以直接在客户端 Javascript 中打开到 Oracle 数据库的 ADO 连接。

我仍然欢迎对此的任何替代想法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T13:24:13.353

打开与数据库的客户端 ADO 连接是一个巨大的安全禁忌。您实际上是在向用户提供与您的数据库的连接凭据，并让他们敢于发现您的数据库安全性中的漏洞。即使您的受众是您公司的内部人员，您也可能会遇到他们没有安装 oracle 驱动程序（或旧版本）的问题。为什么不把 Oracle 查询隐藏在 JSON 调用后面呢？这样，您可以在服务器端清理数据库输入，并且您的用户永远不会收到纯文本的数据库连接凭据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-07T13:30:32.483

尝试在您的 sqlserver 框中推荐链接服务器[Linked Servers (Database Engine)](http://msdn.microsoft.com/en-us/library/ms188279.aspx)用于获取 oracle 数据

# sql - 从临时表中对查询结果进行排序

> ID：448087
> 
> 赞同：1
> 
> 时间：2009-01-15T19:20:57.090
> 
> 标签：sql, sql-server

我有一个 SQL 查询，我将在其中传输相当数量的响应数据，但我想尽快获得总行数以促进 UI 中的绑定。基本上我需要获取满足特定条件的所有行的快照，然后能够翻阅所有结果行。

这是我目前拥有的：

```
SELECT --主键列
进入#tempTable
FROM——某个表
--some 过滤子句
ORDER BY --主键列

选择@@ROWCOUNT

SELECT -- 主键列和其他一些列
来自#tempTable
JOIN——某个表

删除表#tempTable

```

每隔一段时间，查询结果就会出现乱序（大概是因为我正在从临时表中进行无序选择）。

在我看来，我有几个选择：

1.  将第二个 order by 子句添加到临时表中的 select 中。
2.  将 order by 子句移动到第二个 select 并让第一个 select 无序。
3.  使用主键列创建临时表以强制临时表的排序。

做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T19:25:31.353

使用数字 2。仅仅因为您在表上有一个主键并不意味着 select 语句的结果集将被排序（即使您实际看到的是）。

将数据放入临时表时无需对数据进行排序，因此将其取出。无论哪种方式，您都将获得相同的 @@ROWCOUNT 值。

所以这样做：

```
SELECT --primary key column
INTO #tempTable 
FROM --some table 
--some filter clause

SELECT @@ROWCOUNT

SELECT --the primary key column and some others
FROM #tempTable
JOIN -- some table
ORDER BY --primary key column

DROP TABLE #tempTable 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T19:24:36.723

将顺序从第一个选择移动到第二个选择。

数据库不是电子表格。您不会*按特定顺序将数据放入表中*。

只需确保在将其取回时正确订购即可。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-01-15T19:23:27.037

就个人而言，我会按照您最终想要的顺序选择数据。因此，在您的第一个选择中，请按时订购。这样它就可以利用任何现有的索引和访问路径。

# sql-server-2008 - SQL 2008 镜像，处于“正在恢复”状态

> ID：448088
> 
> 赞同：4
> 
> 时间：2009-01-15T19:21:02.690
> 
> 标签：sql-server-2008, mirroring

我正在使用主体、镜像和见证测试 SQL Server 2008 镜像。我已经浏览了[示例](http://msdn.microsoft.com/en-us/library/ms189047.aspx)，使用 NORECOVERY 恢复镜像。校长说它是同步的。但镜子仍然显示它处于“正在恢复……”状态。我应该就这样离开吗？我应该运行 RESTORE WITH RECOVERY 吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-15T20:05:08.810

是的，它保持在恢复状态。

镜像不能直接访问——它只有在主数据库出现故障并发生故障转移时才会“运行”。

# java - 将库从 Java 移植到 Python

> ID：448095
> 
> 赞同：6
> 
> 时间：2009-01-15T19:23:22.093
> 
> 标签：java, python

我即将将一个小型库从 Java 移植到 Python 并希望得到一些建议（很小〜几千行代码）。我对 Java 代码进行了一些研究，并注意到了两种语言中常见的一些设计模式。但是，肯定有一些纯 Java 的习语（单例等）在 Python 世界中通常不受欢迎。

我知道至少存在一个工具（j2py），它可以通过遍历 AST 将 .java 文件转换为 .py 文件。一些最初的实验产生了不太好的结果。

我是否应该考虑使用自动化工具来生成一些代码，或者语言是否足够不同以至于任何工具都会产生足够的返工来证明从头开始编写的合理性？

如果工具不是魔鬼，那么除了 j2py 之外，还有什么至少可以处理同项目导入管理的吗？我不希望任何工具将 3rd 方库从一种语言匹配到另一种语言的替代品。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-01-15T19:32:22.183

如果是我，我会考虑手工操作。几千行代码并不是很多代码，通过自己重写（而不是自动翻译），您将能够决定如何适当地利用 Python 习语。（FWIW，我几乎只在 Java 工作了 9 年，现在我在 Python 工作，所以我知道你必须做的那种翻译。）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-01-15T19:47:28.160

无论如何，第二次编写代码总是更好......再加上几千行 Java 可能可以翻译成几百行 Python。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-15T19:35:30.087

看看[Jython](http://www.jython.org/Project/)。它可以在 Java 之上相当无缝地集成 Python，并提供对 Java 库的访问，但仍然允许您动态地对它们进行操作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-15T19:53:08.007

自动翻译器（f2c、j2py 等）通常会发出您不想用手触摸的代码。当您需要做的就是使用输出时，这很好（例如，如果您有 C 编译器但没有 Fortran 编译器，f2c 允许您编译 Fortran 程序），但当您需要对代码执行任何操作时，这很糟糕。如果您打算将其用作黑匣子以外的任何东西，请手动翻译。在那个尺寸下，它不会太难。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-15T19:59:15.937

我会再手写一遍。我不知道有任何自动化工具会生成看起来不恶心的 Python，并且我自己将 Java 代码移植到 Python 中，我发现结果比原来的质量更高，而且更短。

您获得了质量，因为 Python 更具表现力（例如，匿名内部类 MouseAdapters 等不再支持简单的第一类函数），并且您还获得了第二次编写它的好处。

它也相当短：例如，可以省略 99% 的 getter/setter，以支持直接访问字段。对于其他 1% 的人，它们实际上可以做一些你可以使用的事情`property()`。

然而，正如大卫所说，如果您不需要阅读或维护代码，那么自动翻译器就可以了。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-15T20:26:36.503

Jython 不是您在最终解决方案中要寻找的东西，但它**会使**移植更加顺利。

我的方法是：

1.  如果存在现有测试（单元或其他），请在 Jython 中重写它们（使用 Python 的单元测试）
2.  在 Jython 中编写一些特性测试（记录当前行为的测试）
3.  逐类开始移植：
    *   对于每个类，在 Jython 中对其进行子类化，并一一移植方法，使超类中的方法抽象
    *   *每次*更改后，**运行测试**！
4.  现在，您将拥有可以工作的 Jython 代码，希望对 Java 的依赖性最小。
5.  在 CPython 中运行测试并修复剩下的问题。
6.  重构——你会想要对代码进行 Python 化，可能会使用 Python 习语来简化它。由于测试，这是安全和容易的。

我在过去取得了巨大的成功。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-30T16:32:58.413

我用过Java2Python。这还不错，您仍然需要理解代码，因为它不能正确完成所有操作，但它确实有帮助。

# .net - 多行行网格控件

> ID：448104
> 
> 赞同：0
> 
> 时间：2009-01-15T19:24:43.417
> 
> 标签：.net, controls, grid, components, multiline

有谁知道是否有任何多行行网格控件可供出售或在.net 中使用开源？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-15T20:11:28.750

Infragistics 似乎可以做到这一点。我用过基础设施；就第三方工具而言，它们还可以。它们没有错误，但有非常冗长的 API。文档非常好。

[http://devcenter.infragistics.com/Support/KnowledgeBaseArticle.Aspx?ArticleID=1043](http://devcenter.infragistics.com/Support/KnowledgeBaseArticle.Aspx?ArticleID=1043)

# c# - 如何防止打印屏幕

> ID：448106
> 
> 赞同：10
> 
> 时间：2009-01-15T19:25:28.390
> 
> 标签：c#, .net, winforms, .net-2.0, c#-2.0

我要求我正在开发的应用程序阻止用户轻松捕获屏幕内容。

我已经告知没有可行的方法来完全防止这种情况发生，但我正在寻找方法来为该过程引入一些障碍。

我正在使用 C#/.NET 2.0 和 WinForms

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-15T19:35:34.797

你不能。

您可以做的最好的事情是在叠加层上渲染到硬件加速设备，类似于视频播放器过去所做的事情。基本上，您将整个窗口涂成蓝色，并将图形渲染到视频卡上，然后视频卡将在内部将蓝色替换为图形。这样做的缺点是您必须放弃使用 winforms 控件，而且我不知道有任何方法可以轻松地使用 .NET 做到这一点。我认为如果您使用[DirectShow.NET](http://directshownet.sourceforge.net/)，他们的示例之一就是将您自己的图形放入流中。

即使完成了所有这些操作，仍然可以获得屏幕截图。只需使用数码相机拍摄屏幕照片即可。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-15T19:31:52.217

从[这里开始：](http://labnol.blogspot.com/2004/08/disable-print-screen-key-in-windows.html)

> A. Windows 使用注册的热键实现 Print Screen。Windows 使用预定义的热键 IDHOT_SNAPDESKTOP 和 IDHOT_SNAPWINDOW 来处理打印屏幕。这些对应于捕获整个屏幕的 Print Screen 和仅捕获活动窗口的 Alt+Print Screen。要禁用这些功能，您只需注册热键，这会导致 Windows 在用户按下任一热键时向您的应用发送 WM_HOTKEY 消息。您的实现可以忽略该消息以绕过默认的屏幕捕获行为。一个好的地方是在您的大型机类中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-15T19:44:36.013

FWIW，这是可能的。这是一些代码：

这将是您创建的 dll，然后从您的应用程序中调用 HookKeyboard 方法。我已经对其进行了测试，并且可以正常工作。当然，如果有人用相机拍照，这无济于事，但是，有道理。呐！

```
 namespace KeyboardHook
    {
        public class Hooker
        {

            [StructLayout(LayoutKind.Sequential)]
            public struct KBDLLHOOKSTRUCT
            {
                public int vkCode;
                public int scanCode;
                public int flags;
                public int time

;
            public int extraInfo;
        }

        public delegate int HookProc(int nCode, int wParam, IntPtr ptrKBDLLHOOKSTRUCT);

        [DllImport("user32.dll", CharSet = CharSet.Auto, CallingConvention = CallingConvention.StdCall, SetLastError = true)]
        public static extern IntPtr SetWindowsHookEx(int idHook, HookProc callBack, IntPtr hMod, int threadId);

        [DllImport("user32.dll", CharSet = CharSet.Auto, CallingConvention = CallingConvention.StdCall, SetLastError = true)]
        public static extern int CallNextHookEx(IntPtr hhk, int nCode, int wParam, IntPtr lParam);

        private static IntPtr kbh_Handle;
        private static HookProc kbh_HookProc;

        private const int VK_SNAPSHOT = 0x2C;
        private const int WM_KEYDOWN = 0x0100;
        private const int WM_SYSKEYDOWN = 0x0104;
        private const int WH_KEYBOARD_LL = 13;

        private static int LowLevelKeyboardProc(int nCode, int wParam, IntPtr lParam)
        {
            if (nCode < 0)
            {
                CallNextHookEx(kbh_Handle, nCode, wParam, lParam);
                return 0;
            }

            if (wParam == WM_KEYDOWN)
            {
                IntPtr kbdll = lParam;
                KBDLLHOOKSTRUCT kbdllstruct = (KBDLLHOOKSTRUCT)Marshal.PtrToStructure(kbdll, typeof(KBDLLHOOKSTRUCT));

                if (kbdllstruct.vkCode == VK_SNAPSHOT)
                    return -1;

            }

            return CallNextHookEx(kbh_Handle, nCode, wParam, lParam);
        }

        public static void HookKeyboard()
        {
            try
            {
                kbh_HookProc = LowLevelKeyboardProc;

                kbh_Handle = SetWindowsHookEx(WH_KEYBOARD_LL, kbh_HookProc, Marshal.GetHINSTANCE(Assembly.GetExecutingAssembly().GetModules()[0]), 0);

                if (kbh_Handle != IntPtr.Zero)
                    System.Diagnostics.Debug.WriteLine(String.Format("It worked! HookHandle: {0}", kbh_Handle));
                else
                {
                    throw new Win32Exception(Marshal.GetLastWin32Error());
                }
            }
            catch (Exception ex)
            {
                System.Diagnostics.Debug.WriteLine(String.Format("ERROR: {0}", ex.Message));
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-09-09T07:57:17.620

您可以尝试使用 msipc.dll 中提供的 IpcProtectWindow。

```
[DllImport("msipc.dll", SetLastError = false, CharSet = CharSet.Unicode, CallingConvention = CallingConvention.StdCall)]
internal static extern int IpcProtectWindow([In] IntPtr hwnd); 
```

[从 Microsoft](https://msdn.microsoft.com/en-us/library/hh535290(v=vs.85).aspx)下载 SDK

调用上面的函数并提供您要保护的表单的句柄。（Form.Handle 属性）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T19:34:23.707

这里有两个需要担心的情​​况。一个，当您的窗口/应用程序具有焦点时，另一个当它没有焦点时。

当它没有焦点时，您无能为力，即如果用户单击您的应用程序并点击桌面，则不会将密钥发送到您的应用程序，因此您将永远看不到它们。在这种情况下，您可以在您的应用程序失去焦点时最小化到托盘（或者，可能在表单上放置一个“空白”面板以防止用户在其上看到任何内容，这也会阻止打印屏幕的使用）。

在另一种情况下，当你有焦点时，捕捉击键并检查它们。如果按下 Alt 键且按下 PrintScreen 键，请重置该值，以免出现打印屏幕。（想一想，这可能行不通。我需要对其进行测试才能确定。）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-15T19:35:21.553

你可以看看电影播放器​​是做什么的。我相信它们直接渲染到硬件表面（通过 DirectX）。我怀疑你需要这样做。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-15T23:28:42.270

这并不能真正回答问题，但请记住，存在捕获屏幕的工具，并且一个简单的相机会破坏一切。

我的意思是好吧，你“必须”，但我会（但我还年轻而且还是学生，所以我不太了解可以说什么）回答这只是愚蠢的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-08-11T10:48:05.780

查看新技术 - [sivizion.com](http://www.sivizion.com/)，它们一起阻止打印屏幕 - 无法绕过它。如果有人想办法破解它，请在这里发帖，我做不到。我认为他们也许可他们的技术，不确定，检查一下。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-15T19:31:42.543

好吧，您可以尝试捕获该按钮，但我不确定它的效果如何。

一直让我烦恼的一件事是，每当我播放一部电影时，它都不会截屏。如果您可以通过单独的上下文进行渲染，那么拍照会很烦人。也许您可以通过类似的方式发送屏幕输出？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-12-20T12:43:10.710

有些应用程序可以从 OpenGL 和 DirectX 应用程序捕获屏幕！（取决于（它们用于录制游戏电影）ps。windows aero 是 DirectX

[http://www.fraps.com/](http://www.fraps.com/) 我认为这就是应用程序

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-08-01T07:57:55.010

您可以使用 Visual Cryptography 并利用视网膜持久性使任何随意的 Print Screen 无用（有关详细信息，请参阅[本文](http://delphitools.info/2012/08/01/defeat-print-screen-with-visual-cryptography/)，有关Web 演示的[bit.ly/vcrypto](http://bit.ly/vcrypto)）。

这个想法是在两个或多个随机噪声图像之间以高频率交替，这将通过视觉的持久性结合起来以揭示内容。屏幕截图只会抓取一张图像，并带有无意义的随机噪声。

这是以闪烁和引起用户头痛为代价的，可能会被拍摄屏幕照片的相机打败，或者被不那么随意的用户打败，但会打败任何随意的屏幕捕捉或帧抓取。

在该术语的学术含义中，可能偶尔有用！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-05-30T04:29:05.113

在 windows 窗体应用程序中，在窗体 keyup 事件中使用此代码，

```
 if (e.KeyCode == Keys.PrintScreen)
                {
                    Clipboard.Clear();
                } 
```

表单 keypreview 应该是 TRUE

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-10-15T11:50:30.630

Microsoft 已经开发了一个名为 SetWindowDisplayAffinity 的 API 来支持窗口内容保护。此功能使应用程序能够保护应用程序内容不被通过一组特定的公共操作系统功能和 API 捕获或复制
`SetWindowDisplayAffinity(hWnd, WDA_MONITOR);`

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-08-28T14:48:50.857

为时已晚，但有一个快速的解决方法，只需在 MDI 表单中使用它
Set **TopMost** Property of form **True**，然后在下面写 event private void frmMDI_Deactivate(object sender, EventArgs e){Clipboard.Clear();}

打印屏幕后用户必须最小化应用程序，当用户最小化应用程序时，我们正在清除剪贴板。

您可以在注销功能或屏幕移动或调整大小或任何其他需要的表单事件中使用它:)

如果 TopMost 属性为真，截图工具也不能通过这个复制屏幕。

是的，我们不能阻止用户从手机或摄像头等外部设备捕获屏幕。

* * *

## 回答 #15

> 赞同：-3
> 
> 时间：2012-09-18T14:10:12.430

我使用`Timer`对象和`Clipboard.Clear()`方法解决了它。

首先`Timer`使用 (Very fast) 将 a 添加到您的主窗体`Interval=1`，然后在其事件中添加以下代码：

```
Clipboard.Clear(); 
```

# browser - 您是否被迫为旧的网络浏览器开发？

> ID：448108
> 
> 赞同：3
> 
> 时间：2009-01-15T19:25:31.730
> 
> 标签：browser, obsolete

在我开始从事目前的工作之前，我一直想知道为什么人们仍在运行旧的网络浏览器。在这里，我被迫使用 IE6 来开发我们所有的内部应用程序，因为我们的目标用户也在使用 IE6。是否有其他人处于不允许他们运行最新技术的情况，是什么阻止了你？您是否尝试过说服 IT/管理层进行升级？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T19:33:31.807

相同的 IE6 在这里。我听说，大约在去年，我们正在更新到 IE7——就在 IE8 发布之时/之前。

我们目前正计划从 MSSQL Server 2000 升级到 2005——就在 2008 发布之后。

公司不喜欢“全新”——在其他人都发现问题之前，升级太昂贵且风险太大。如果它打破了你，你就被困在等待补丁。使用至少有好一年的东西，加上一份不错的更新列表和价格下降，仍然只会帮助他们考虑未来。

您可以尝试推动它，并且可能会发现他们已经考虑过了——但是，我不会对您寄予厚望。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T19:34:37.843

在我的大学里，我们有一件奇怪的事情：

*   几乎所有的台式电脑都迁移到了 IE7
*   但是，大约 20 个 HP ThinClient 终端（基本上是虚拟机）使用 IE6。远程访问系统也是如此。

我认为 IE6 的使用可能是运行客户端的软件中的一个缺陷，因为我们的 IT 人员非常擅长升级（尽管我们还没有使用 Vista - 是否有任何大型网络？）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T19:36:20.677

我在这里也有类似的情况。虽然我们在工作中没有被迫使用任何特定的浏览器/版本，但我们有一些客户（大公司）仍在使用 IE6。因此，我们还必须为 IE6 构建和测试所有内容。

现在我们有办法改变这种情况。我们正在通过使用虚拟 PC 来测试旧浏览器版本来处理这种情况。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T19:49:41.430

这是第 22 条规则。我使用 Opera，但我的银行和航空公司的网站不支持它——它们支持 IE6，所以我保留它。
我可以升级到 IE8，它们可能会工作，但我必须检查每个不能与 Opera 一起工作的网站，如果我发现任何网站也不能与 IE8 一起工作，我该如何降级？
所以我坚持使用 IE6，这意味着他们的服务器统计数据显示了很大比例的 IE6 用户，所以他们不会做任何破坏 IE6 的事情，所以没有人升级....

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-15T19:59:10.553

企业希望为用户带来的第一件事是稳定性和安全性。创新仅排在第三位。

他们不愿意进行任何更改，即使是用户要求的更改。出于某种原因：当您更改某些内容时，很可能其他内容会在某处损坏...

创新*可以*带来一些钱（或降低成本），但系统停止*肯定*要花钱，有时甚至是很多钱！

如果我是一家企业，我会做同样的事情：在需要之前不要升级（当然，除非你肯定会在竞争中获得一些分数）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T20:05:48.513

我为一家社交网络/媒体公司做 UI 工程（不幸的是，我们的受众通常是使用 IE6 的人）。我们为 IE6/IE7/FF3 和 2 Win 和 Mac/Safari 3 Win 和 Mac 设计。不过，最重要的是，如果您的标记格式良好并且使用了最佳实践（**NO HACKS**），那么大多数浏览器看起来都不会大惊小怪——即使是 IE6。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-15T20:07:31.473

首先，定义“旧”。如果旧的是IE6，那么是的。否则，没有。

我在桌面上使用 Firefox，但我们默认安装了 IE7。我们的外地办事处使用 IE6，因此我们必须针对它们。然而，我的桌面上没有安装 IE6。

多好的集群。

# ruby - 如何在 x64 Linux 上安装 Ruby Shoes？

> ID：448115
> 
> 赞同：2
> 
> 时间：2009-01-15T19:27:38.417
> 
> 标签：ruby, linux, installation, 64-bit, shoes

我最近发现了[Ruby Shoes](http://shoes.heroku.com/)，这对于像我这样的初学者来说听起来相当有用。唯一的问题是我的笔记本电脑是 x64，而唯一的 Linux 包是 i686。无论如何，我尝试了它，但它对我不起作用，我一直收到错误消息。当然，我没想到它会起作用，但是还有办法在 x64 Linux 上获取 Shoes 吗？谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T21:46:32.053

似乎没有适用于 Linux 的 64 位软件包，因此如果您的发行版没有打包鞋子，则需要自己编译。这并不像听起来那么可怕！

首先，确保您拥有正确的开发库：

> Shoes 依赖于 Cairo、Pango、libungif、libjpeg、GTK+ 2.0 和 Ruby，以及 GCC 及其链接器。
> 
> 要在 Ubuntu 或 Debian 上安装所有这些库：
> 
> # aptitude install libcairo2-dev libpixman-1-dev libpango1.0-dev \ libungif4-dev libjpeg62-dev libgtk2.0-dev vlc libvlc-dev \ libsqlite3-dev libcurl4-openssl-dev ruby​​1.8-dev rake
> 
> （在 8.10 之前的 Ubuntu 上，实际上你需要 libvlc0-dev。）
> 
> 在 Fedora 上安装这些库：
> 
> # yum install -y giflib-devel cairo-devel libpixman-devel \ pango-devel libjpeg-devel gtk2-devel sqlite-devel vlc-devel \ libcurl-devel ruby​​-devel

如果我知道您使用的是什么发行版，我可以更具体。准备好后，从[shoooes.net](http://shoooes.net)获取 tarball并解压缩。

然后，进入目录并运行

```
make 
```

这将构建项目。假设这成功完成，运行

```
make install 
```

如果您需要进一步的帮助来编译这个，请考虑加入[邮件列表](http://news.gmane.org/gmane.comp.lib.shoes)

*   发消息给**鞋子 AT code.whytheluckystiff.net**
*   抄送：**为什么 ATwhytheluckystiff.net**

或 irc.freenode.net 上的#shoes

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-21T01:37:52.197

我尝试了上面的说明。我有

```
[nathan@ebisu ~/tmp/shoes-0.r1134] make
build options: shoes raisins (0.r1134) [x86_64-linux]
CC       = cc
RUBY     = /usr
OPTIONS  =
CC shoes/app.c
CC shoes/canvas.c
CC shoes/effects.c
CC shoes/image.c
CC shoes/internal.c
CC shoes/ruby.c
CC shoes/world.c
CC shoes/native/gtk.c
CC shoes/http/curl.c
CC -o dist/libshoes.so
/usr/lib64/gcc/x86_64-suse-linux/4.3/../../../../x86_64-suse-linux/bin/ld: skipping incompatible /usr/lib/libjpeg.so when searching for -ljpeg
/usr/lib64/gcc/x86_64-suse-linux/4.3/../../../../x86_64-suse-linux/bin/ld: skipping incompatible /usr/lib/libjpeg.a when searching for -ljpeg
CC bin/main.c
CC -o dist/shoes-bin
/usr/lib64/gcc/x86_64-suse-linux/4.3/../../../../x86_64-suse-linux/bin/ld: skipping incompatible /usr/lib/libjpeg.so when searching for -ljpeg
/usr/lib64/gcc/x86_64-suse-linux/4.3/../../../../x86_64-suse-linux/bin/ld: skipping incompatible /usr/lib/libjpeg.a when searching for -ljpeg
cp: cannot stat `/usr/lib/libruby.so': No such file or directory
make: *** [dist/shoes.launch] Error 1 
```

显然我确实安装了 libjpeg。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T23:19:17.357

我正在使用 Fedora Core 10。这是我尝试构建它时得到的结果。

```
$ ~/shoes-0.r1134
bash: /home/Alex/shoes-0.r1134: is a directory
$ make
make: *** No targets specified and no makefile found.  Stop 
```

或者...

```
$ make shoes-0.r1134
make: Nothing to be done for `shoes-0.r1134'. 
```

另外，我查看了 repo，Ruby Shoes 不在其中。

# sql - 使用两个包含语句的 LINQ to SQL 查询失败

> ID：448116
> 
> 赞同：2
> 
> 时间：2009-01-15T19:28:10.523
> 
> 标签：sql, linq-to-sql, timeout, contains

我有两张桌子，`DH_MASTER`和`DH_ALIAS`。 `DH_MASTER`包含有关人员的信息，包括他们的姓名。 `DH_ALIAS`包含有关此人的 AKA 记录。这些表由`Operator`作为主键的字段链接`DH_MASTER`。

用户希望通过存储在其中的名称进行搜索，`DH_MASTER`并通过他们所有已知的别名进行搜索。如果在其中一个中找到任何匹配项，`DH_MASTER`则应返回`DH_ALIAS`该实体。`DH_MASTER`

我创建了下面的查询，它应该给出我描述的结果（返回or`DH_MASTER`的任何行）。`DH_MASTER.Name == name``DH_MASTER.DH_ALIAs(n).Name == name`

如果我只使用其中`.Contains`一条线，它就可以正常工作。我使用哪一个并不重要。但是当我尝试同时使用 BOTH 时执行失败。

```
 qry = From m In Context.DH_MASTERs _
          Where (m.Name.Contains(name)) _
              OrElse ((From a In m.DH_ALIAs _
                       Where a.Name.Contains(name)).Count() > 0) _
          Select m 
```

LinqToSQL 查询计算为以下 SQL 代码（如 SQL Server 查询可视化工具中所示）

```
 SELECT [t0].[Operator], [t0].[Name], [t0].[Version]
FROM [DHOWNER].[DH_MASTER] AS [t0]
WHERE ([t0].[Name] LIKE %smith%) OR (((
    SELECT COUNT(*)
    FROM [DHOWNER].[DH_ALIAS] AS [t1]
    WHERE ([t1].[Name] LIKE %smith%) AND ([t1].[Operator] = [t0].[Operator])
    )) > 0) 
```

编辑：选中查询可视化工具中的“显示原始”框会按预期显示参数化查询，因此应忽略下面的此文本块。

> 我不知道这是否是一个问题，但 .Contains 评估为一个 `LIKE` 表达式（这是我期望发生的），但参数没有封装在撇号中。

有趣的是，如果我将 SQL 查询复制/粘贴到 SQL 2005 查询分析器中并在`LIKE`参数周围添加撇号，它运行得很好。事实上，即使有超过 200 万行，它也快如闪电（眨眼间）。

但是当 LINQ 查询运行时，Web 应用程序锁定了大约 31 秒，然后它最终在 gv.DataBind 上出现此错误并失败： `Exception has been thrown by the target of an invocation.`

有了这个内部异常： `Timeout expired. The timeout period elapsed prior to completion of the operation or the server is not responding.`

有谁知道为什么会发生这种情况以及如何解决这种行为？这让我抓狂，因为 LinqToSql 生成的 SQL 在查询分析器中运行良好！

**更新：**

我已经根据答案中的技术重构了我的代码。这行得通！

```
qry = From m In qry _
 Where m.Name.Contains(name) OrElse _ 
 m.DH_ALIAs.Any(Function(aliasRec) aliasRec.Name.Contains(name)) _ 
Select m 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-23T14:35:42.183

这可能不合适，因为您的问题不同，但我记得我的一个程序中有一个问题： Contains() 不起作用（在我的情况下，它会在评估时抛出异常），所以也许 Contains-method 是有点破。

我换了

```
result.Contains( x ) 
```

和

```
result.Any( p => p == x ) 
```

确实有效。

你可以试试如果有效吗？至少这可能是朝着正确方向迈出的一步。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T08:36:31.803

Linq to sql 不直接在查询中指定值，它使用参数。你确定它直接在sql中有包含参数值吗？

无论如何，超时很可能是由死锁引起的：查询想要读取被另一个（插入/更新）查询/事务锁定的表中的行，并且该查询显然需要更长的时间才能完成。

# python - 使用 ReferenceProperties 过滤模型

> ID：448120
> 
> 赞同：5
> 
> 时间：2009-01-15T19:28:59.290
> 
> 标签：python, google-app-engine

我正在使用谷歌应用引擎，并且无法编写查询来过滤 ReferenceProperties。

例如。

```
class Group(db.Model):
    name = db.StringProperty(required=True)
    creator = db.ReferenceProperty(User)

class GroupMember(db.Model):
    group = db.ReferenceProperty(Group)
    user = db.ReferenceProperty(User) 
```

我试过写这样的东西：

```
members = models.GroupMember.all().filter('group.name =', group_name) 
```

以及其他各种不起作用的东西。希望有人可以在正确的方向上给我一个刺激...

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-08T20:04:38.940

如果您的组是唯一命名的，那么您的“group.name”是组实体的唯一标识符。

这意味着你可以写：

```
 members = models.GroupMember.all().filter(
    "group =",model.Group.gql("WHERE name=:1", group_name).get()
    ) 
```

尽管您只需要在堆栈中的某个地方还没有组实体时才需要这样做。

Google 关于 appengine 的多对多的文章在[这里](http://code.google.com/appengine/articles/modeling.html "使用 App Engine 建模")。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-11T22:30:31.707

如果您想要获取组的成员，ReferenceProperties 具有内置功能。

```
class GroupMember(db.Model):
    group = db.ReferenceProperty(Group, collection_name="groupMembers")
    user = db.ReferenceProperty(User, collection_name="groupMembers") 
```

然后你可以写：

```
# get the group entity somehow
group = Group.get(group_key)     
# do something with the members, such as list the nicknames
nicknames = [x.user.nickname for x in group.groupMembers] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T22:21:23.200

这需要加入，这在 App Engine 中是不可能的。如果要按另一个模型的属性进行过滤，则需要将该属性包含在要查询的模型中。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-23T03:35:41.943

这将导致两次数据存储命中，但应该可以工作。如果你使用 memcache 应该不是问题。

```
group = models.Group.all().filter("name =", group_name).get()
members = models.GroupMember.all().filter('group =', group) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-25T18:11:30.317

使用您在问题中定义的模型，假设您要列出名为“ *Space monkeys* ”的组的所有成员。

```
mygroup = Group.gql("WHERE name = :1",'Space monkeys')

for group_member in mygroup.groupmember_set:
    print 'group members name is: %s' % (group_member.user.name) 
```

“ `groupmember_set`”被称为“*隐式集合属性*”，非常有用。您可以通过使用`collection_name`关键字参数覆盖默认名称来调用它`ReferenceProperty`。例如，请参阅[Thomas L Holaday](https://stackoverflow.com/questions/448120/filtering-models-with-referenceproperties/539147#539147)的答案。

Rafe Kapla 在一篇非常好的论文中解释了这一切：[建模实体关系](http://code.google.com/appengine/articles/modeling.html)。

# java - 如何在 Java 中使用 foreach 循环来遍历 HashMap 中的值？

> ID：448122
> 
> 赞同：37
> 
> 时间：2009-01-15T19:30:03.607
> 
> 标签：java, foreach, hashmap

我正在尝试编译以下代码：

```
private String dataToString(){
    Map data = (HashMap<MyClass.Key, String>) getData();
    String toString = "";
    for( MyClass.Key key: data.keySet() ){
        toString += key.toString() + ": " + data.get( key );
    return toString;
} 
```

我在 for 行中收到一条错误消息：

```
不兼容的类型
找到：java.lang.Object
必需：MyClass.Key

```

该`getData()`方法返回一个`Object`（但在这种情况下，`Object`返回的具有`HashMap`结构）。 `MyClass.Key`是我为我的应用程序创建的一个枚举（在另一个类文件中 - `MyClass`）。

当我在 中创建具有相同结构的 foreach 循环时`MyClass.java`，我没有遇到这个问题。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-01-15T19:42:28.683

一种更有效的方法：

```
 Map<MyClass.Key, String> data = (HashMap<MyClass.Key, String>) getData(); 
  StringBuffer sb = new StringBuffer();
  for (Map.Entry<MyClass.Key,String> entry : data.entrySet()) {
       sb.append(entry.getKey());
       sb.append(": ");
       sb.append(entry.getValue());
   }
   return sb.toString(); 
```

如果可能的话，定义“getData”，这样你就不需要演员表了。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-01-15T19:32:43.603

改变：

```
Map data = (HashMap<MyClass.Key, String>) getData(); 
```

到

```
Map<MyClass.Key, String> data = (HashMap<MyClass.Key, String>) getData(); 
```

问题是`data.keySet()`返回 a `Collection<Object>`if data 只是 a `Map`。一旦你使它通用，`keySet()`将返回一个`Collection<MyClass.Key>`. 更好...迭代`entrySet()`，这将是一个`Collection<MyClass.Key, String>`. 它避免了额外的哈希查找。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-01-15T19:39:10.983

您可以改为获取 entrySet，以避免需要密钥类：

```
private String dataToString(){    
    Map data = (HashMap<MyClass.Key, String>) getData();    
    String toString = "";    
    for( Map.Entry entry: data.entrySet() ) {        
        toString += entry.getKey() + ": " + entry.getValue();
    }    
    return toString;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-04-19T21:40:19.783

[我在java 论坛上](http://www.engineeringserver.com/forum/foreach_loop_arraylist_primitive_data_hashmap-t2373.0.html)找到了这个简单的例子。它的语法与我正在寻找**的 List 的 foreach 非常相似。**

```
import java.util.Map.Entry;
HashMap nameAndAges = new HashMap<String, Integer>();
for (Entry<String, Integer> entry : nameAndAges.entrySet()) {
        System.out.println("Name : " + entry.getKey() + " age " + entry.getValue());
} 
```

[编辑：]我测试了它，它工作得很好。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-15T19:38:57.397

莫特林的回答是正确的。

我有两个笔记...

1.  不要使用`toString += ...`，而是使用`StringBuilder`并将数据附加到它。

2.  马丁建议的演员会给你未经检查的警告，你将无法摆脱，因为它真的不安全。

另一种方式，没有警告（和 StringBuilder）：

```
private String dataToString(){
    Map<?, ?> data = (Map<?, ?>) getData();
    StringBuilder toString = new StringBuilder();
    for (Object key: data.keySet()) {
        toString.append(key.toString());
        toString.append(": ");
        toString.append(data.get(key));
    }
    return toString.toString();
} 
```

这是可行的，因为您调用的 toString 方法`key`是在 Object 类中定义的，因此您根本不需要强制转换。

使用`entrySet`是更好的方法，因为它不需要在地图中进行另一次查找。

# wpf - WPF 用户控件

> ID：448124
> 
> 赞同：1
> 
> 时间：2009-01-15T19:30:21.330
> 
> 标签：wpf, data-binding, user-controls, dependency-properties

我想要一个用户控件，它接受一组人（属性“数据”）并将它们显示在列表框中。当我运行我的应用程序时，列表框中没有显示任何内容。你能指出我做错了什么吗？谢谢！！！

```
public class Person
{
    public string Name { get; set; }
    public int Age { get; set; }
    public override string ToString()
    {
        return Name + "(" + Age + ")";
    }
} 
```

用户控制：（uc1.xaml.cs）

```
public partial class uc1
{
    public static readonly DependencyProperty DataProperty = DependencyProperty.Register("Data", typeof (List<Person>), typeof (uc1));

    public List<Person> Data
    {
        get { return (List<Person>) GetValue(DataProperty); }
        set { SetValue(DataProperty, value); }
    }

    public uc1()
    {
        InitializeComponent();
    }

    private void UserControl_Loaded(object sender, RoutedEventArgs e)
    {
        DataContext = Data;
    }
} 
```

(uc1.xaml)

```
<ListBox ItemsSource="{Binding Name}" /> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T19:46:08.100

ItemsSource 属性控制在列表框中显示的项目列表。如果希望 ListBox 为每个人显示一行，则需要将 ItemsSource 设置为直接绑定到 DataContext。然后使用 DisplayMemberPath 属性来控制要显示的 Person 类的哪个属性。

这是适用于我的示例代码。人员类是相同的。

Window1.xaml.cs：

```
public partial class Window1 : Window
{
    public Window1()
    {
        InitializeComponent();
        List<Person> Data = new List<Person>();
        Data.Add(new Person { Name = "Test 1", Age = 5 });
        Data.Add(new Person { Name = "Test 2", Age = 10 });
        this.DataContext = Data;
    }
} 
```

Window1.xaml

```
<ListBox ItemsSource="{Binding}" DisplayMemberPath="Name" /> 
```

# cocoa - 如何从 UIImage (Cocoa Touch) 或 CGImage (Core Graphics) 获取像素数据？

> ID：448125
> 
> 赞同：203
> 
> 时间：2009-01-15T19:30:26.853
> 
> 标签：cocoa, cocoa-touch, core-graphics

我有一个 UIImage (Cocoa Touch)。从那，我很高兴得到一个 CGImage 或任何你想要的东西。我想写这个函数：

```
- (int)getRGBAFromImage:(UIImage *)image atX:(int)xx andY:(int)yy {
  // [...]
  // What do I want to read about to help
  // me fill in this bit, here?
  // [...]

  int result = (red << 24) | (green << 16) | (blue << 8) | alpha;
  return result;
} 
```

* * *

## 回答 #1

> 赞同：252
> 
> 时间：2009-08-11T21:02:49.167

仅供参考，我将 Keremk 的答案与我的原始大纲结合起来，清理了拼写错误，将其概括为返回一组颜色并编译整个内容。结果如下：

```
+ (NSArray*)getRGBAsFromImage:(UIImage*)image atX:(int)x andY:(int)y count:(int)count
{
    NSMutableArray *result = [NSMutableArray arrayWithCapacity:count];

    // First get the image into your data buffer
    CGImageRef imageRef = [image CGImage];
    NSUInteger width = CGImageGetWidth(imageRef);
    NSUInteger height = CGImageGetHeight(imageRef);
    CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();
    unsigned char *rawData = (unsigned char*) calloc(height * width * 4, sizeof(unsigned char));
    NSUInteger bytesPerPixel = 4;
    NSUInteger bytesPerRow = bytesPerPixel * width;
    NSUInteger bitsPerComponent = 8;
    CGContextRef context = CGBitmapContextCreate(rawData, width, height,
                    bitsPerComponent, bytesPerRow, colorSpace,
                    kCGImageAlphaPremultipliedLast | kCGBitmapByteOrder32Big);
    CGColorSpaceRelease(colorSpace);

    CGContextDrawImage(context, CGRectMake(0, 0, width, height), imageRef);
    CGContextRelease(context);

    // Now your rawData contains the image data in the RGBA8888 pixel format.
    NSUInteger byteIndex = (bytesPerRow * y) + x * bytesPerPixel;
    for (int i = 0 ; i < count ; ++i)
    {
        CGFloat alpha = ((CGFloat) rawData[byteIndex + 3] ) / 255.0f;
        CGFloat red   = ((CGFloat) rawData[byteIndex]     ) / alpha;
        CGFloat green = ((CGFloat) rawData[byteIndex + 1] ) / alpha;
        CGFloat blue  = ((CGFloat) rawData[byteIndex + 2] ) / alpha;
        byteIndex += bytesPerPixel;

        UIColor *acolor = [UIColor colorWithRed:red green:green blue:blue alpha:alpha];
        [result addObject:acolor];
    }

  free(rawData);

  return result;
} 
```

* * *

## 回答 #2

> 赞同：48
> 
> 时间：2009-01-15T22:31:48.623

一种方法是将图像绘制到由给定颜色空间的给定缓冲区支持的位图上下文（在本例中为 RGB）：（请注意，这会将图像数据复制到该缓冲区，所以你这样做想要缓存它而不是每次需要获取像素值时都执行此操作）

请参见下面的示例：

```
// First get the image into your data buffer
CGImageRef image = [myUIImage CGImage];
NSUInteger width = CGImageGetWidth(image);
NSUInteger height = CGImageGetHeight(image);
CGColorSpaceRef colorSpace = CGColorSpaceCreateDeviceRGB();
unsigned char *rawData = malloc(height * width * 4);
NSUInteger bytesPerPixel = 4;
NSUInteger bytesPerRow = bytesPerPixel * width;
NSUInteger bitsPerComponent = 8;
CGContextRef context = CGBitmapContextCreate(rawData, width, height, bitsPerComponent, bytesPerRow, colorSpace, kCGImageAlphaPremultipliedLast | kCGBitmapByteOrder32Big);
CGColorSpaceRelease(colorSpace);

CGContextDrawImage(context, CGRectMake(0, 0, width, height));
CGContextRelease(context);

// Now your rawData contains the image data in the RGBA8888 pixel format.
int byteIndex = (bytesPerRow * yy) + xx * bytesPerPixel;
red = rawData[byteIndex];
green = rawData[byteIndex + 1];
blue = rawData[byteIndex + 2];
alpha = rawData[byteIndex + 3]; 
```

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-08-08T04:22:47.063

Apple 的[技术问答 QA1509](http://developer.apple.com/qa/qa2007/qa1509.html)展示了以下简单方法：

```
CFDataRef CopyImagePixels(CGImageRef inImage)
{
    return CGDataProviderCopyData(CGImageGetDataProvider(inImage));
} 
```

用于`CFDataGetBytePtr`获取实际字节（以及`CGImageGet*`了解如何解释它们的各种方法）。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2018-01-16T12:42:13.807

无法相信这里***没有一个正确的答案***。无需分配指针，未相乘的值仍需归一化。切入正题，这里是 Swift 4 的正确版本。`UIImage`只需使用`.cgImage`.

```
extension CGImage {
    func colors(at: [CGPoint]) -> [UIColor]? {
        let colorSpace = CGColorSpaceCreateDeviceRGB()
        let bytesPerPixel = 4
        let bytesPerRow = bytesPerPixel * width
        let bitsPerComponent = 8
        let bitmapInfo: UInt32 = CGImageAlphaInfo.premultipliedLast.rawValue | CGBitmapInfo.byteOrder32Big.rawValue

        guard let context = CGContext(data: nil, width: width, height: height, bitsPerComponent: bitsPerComponent, bytesPerRow: bytesPerRow, space: colorSpace, bitmapInfo: bitmapInfo),
            let ptr = context.data?.assumingMemoryBound(to: UInt8.self) else {
            return nil
        }

        context.draw(self, in: CGRect(x: 0, y: 0, width: width, height: height))

        return at.map { p in
            let i = bytesPerRow * Int(p.y) + bytesPerPixel * Int(p.x)

            let a = CGFloat(ptr[i + 3]) / 255.0
            let r = (CGFloat(ptr[i]) / a) / 255.0
            let g = (CGFloat(ptr[i + 1]) / a) / 255.0
            let b = (CGFloat(ptr[i + 2]) / a) / 255.0

            return UIColor(red: r, green: g, blue: b, alpha: a)
        }
    }
} 
```

您必须首先将图像绘制/转换为缓冲区的原因是因为图像可以有几种不同的格式。需要此步骤才能将其转换为您可以阅读的一致格式。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2010-12-17T04:07:06.053

```
NSString * path = [[NSBundle mainBundle] pathForResource:@"filename" ofType:@"jpg"];
UIImage * img = [[UIImage alloc]initWithContentsOfFile:path];
CGImageRef image = [img CGImage];
CFDataRef data = CGDataProviderCopyData(CGImageGetDataProvider(image));
const unsigned char * buffer =  CFDataGetBytePtr(data); 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-04-16T02:31:34.287

这是一个 SO[线程](https://stackoverflow.com/questions/1042830/retrieving-a-pixel-alpha-value-for-a-uiimage)，其中@Matt 通过置换图像仅将所需像素渲染到 1x1 上下文中，以便所需像素与上下文中的一个像素对齐。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2015-04-16T11:47:13.940

### UIImage 是一个包装器，字节是 CGImage 或 CIImage

根据[UIImage 上的 Apple Reference，](https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIImage_Class/index.html)该对象是不可变的，您无法访问支持字节。`UIImage`如果您使用 a （显式或隐式）填充 a 确实可以访问 CGImage 数据，但如果由 a 支持`CGImage`，它将返回，反之亦然。`NULL``UIImage``CIImage`

> 图像对象不提供对其底层图像数据的直接访问。但是，您可以检索其他格式的图像数据以在您的应用程序中使用。具体来说，您可以使用 cgImage 和 ciImage 属性来检索分别与 Core Graphics 和 Core Image 兼容的图像版本。您还可以使用 UIImagePNGRepresentation( *:) 和 UIImageJPEGRepresentation(* :_:) 函数生成一个 NSData 对象，其中包含 PNG 或 JPEG 格式的图像数据。

### 解决此问题的常见技巧

如前所述，您的选择是

*   UIImagePNGRepresentation 或 JPEG
*   确定图像是否具有 CGImage 或 CIImage 支持数据并获取它

如果您想要的输出不是 ARGB、PNG 或 JPEG 数据并且数据尚未由 CIImage 支持，那么这些都不是特别好的技巧。

### 我的建议，试试 CIImage

在开发项目时，完全避免 UIImage 并选择其他东西可能更有意义。UIImage，作为 Obj-C 图像包装器，通常由 CGImage 支持，以至于我们认为它是理所当然的。CIImage 往往是一种更好的包装格式，因为您可以使用[CIContext](https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/QuartzCoreFramework/Classes/CIContext_Class/index.html)来获取您想要的格式，而无需知道它是如何创建的。在您的情况下，获取位图将是调用的问题

[- 渲染：toBitmap:rowBytes:bounds:format:colorSpace:](https://developer.apple.com/library/ios/documentation/GraphicsImaging/Reference/QuartzCoreFramework/Classes/CIContext_Class/index.html#//apple_ref/occ/instm/CIContext/render:toBitmap:rowBytes:bounds:format:colorSpace:)

作为一个额外的好处，您可以通过将过滤器链接到图像上来开始对图像进行很好的操作。这解决了很多图像颠倒或需要旋转/缩放等问题。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2017-01-26T23:10:07.560

基于 Olie 和 Algal 的答案，这里是 Swift 3 的更新答案

```
public func getRGBAs(fromImage image: UIImage, x: Int, y: Int, count: Int) -> [UIColor] {

var result = [UIColor]()

// First get the image into your data buffer
guard let cgImage = image.cgImage else {
    print("CGContext creation failed")
    return []
}

let width = cgImage.width
let height = cgImage.height
let colorSpace = CGColorSpaceCreateDeviceRGB()
let rawdata = calloc(height*width*4, MemoryLayout<CUnsignedChar>.size)
let bytesPerPixel = 4
let bytesPerRow = bytesPerPixel * width
let bitsPerComponent = 8
let bitmapInfo: UInt32 = CGImageAlphaInfo.premultipliedLast.rawValue | CGBitmapInfo.byteOrder32Big.rawValue

guard let context = CGContext(data: rawdata, width: width, height: height, bitsPerComponent: bitsPerComponent, bytesPerRow: bytesPerRow, space: colorSpace, bitmapInfo: bitmapInfo) else {
    print("CGContext creation failed")
    return result
}

context.draw(cgImage, in: CGRect(x: 0, y: 0, width: width, height: height))

// Now your rawData contains the image data in the RGBA8888 pixel format.
var byteIndex = bytesPerRow * y + bytesPerPixel * x

for _ in 0..<count {
    let alpha = CGFloat(rawdata!.load(fromByteOffset: byteIndex + 3, as: UInt8.self)) / 255.0
    let red = CGFloat(rawdata!.load(fromByteOffset: byteIndex, as: UInt8.self)) / alpha
    let green = CGFloat(rawdata!.load(fromByteOffset: byteIndex + 1, as: UInt8.self)) / alpha
    let blue = CGFloat(rawdata!.load(fromByteOffset: byteIndex + 2, as: UInt8.self)) / alpha
    byteIndex += bytesPerPixel

    let aColor = UIColor(red: red, green: green, blue: blue, alpha: alpha)
    result.append(aColor)
}

free(rawdata)

return result
} 
```

[迅速](/questions/tagged/swift "显示标记为“迅速”的问题")

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2020-02-16T10:43:14.883

**斯威夫特 5 版本**

此处给出的答案要么已过时，要么不正确，因为它们没有考虑以下内容：

1.  图像的像素大小可能与`image.size.width`/返回的点大小不同`image.size.height`。
2.  图像中的像素分量可以使用各种布局，例如 BGRA、ABGR、ARGB 等，也可能根本没有 alpha 分量，例如 BGR 和 RGB。例如，`UIView.drawHierarchy(in:afterScreenUpdates:)`方法可以生成 BGRA 图像。
3.  颜色分量可以预乘图像中所有像素的 alpha，需要除以 alpha 才能恢复原始颜色。
4.  对于 使用的内存优化`CGImage`，像素行的大小（以字节为单位）可能大于像素宽度乘以 4 的大小。

下面的代码是提供一个通用的 Swift 5 解决方案来获取`UIColor`所有此类特殊情况的像素。代码针对可用性和清晰度进行了优化，而*不是*针对性能进行了优化。

```
public extension UIImage {

    var pixelWidth: Int {
        return cgImage?.width ?? 0
    }

    var pixelHeight: Int {
        return cgImage?.height ?? 0
    }

    func pixelColor(x: Int, y: Int) -> UIColor {
        assert(
            0..<pixelWidth ~= x && 0..<pixelHeight ~= y,
            "Pixel coordinates are out of bounds")

        guard
            let cgImage = cgImage,
            let data = cgImage.dataProvider?.data,
            let dataPtr = CFDataGetBytePtr(data),
            let colorSpaceModel = cgImage.colorSpace?.model,
            let componentLayout = cgImage.bitmapInfo.componentLayout
        else {
            assertionFailure("Could not get a pixel of an image")
            return .clear
        }

        assert(
            colorSpaceModel == .rgb,
            "The only supported color space model is RGB")
        assert(
            cgImage.bitsPerPixel == 32 || cgImage.bitsPerPixel == 24,
            "A pixel is expected to be either 4 or 3 bytes in size")

        let bytesPerRow = cgImage.bytesPerRow
        let bytesPerPixel = cgImage.bitsPerPixel/8
        let pixelOffset = y*bytesPerRow + x*bytesPerPixel

        if componentLayout.count == 4 {
            let components = (
                dataPtr[pixelOffset + 0],
                dataPtr[pixelOffset + 1],
                dataPtr[pixelOffset + 2],
                dataPtr[pixelOffset + 3]
            )

            var alpha: UInt8 = 0
            var red: UInt8 = 0
            var green: UInt8 = 0
            var blue: UInt8 = 0

            switch componentLayout {
            case .bgra:
                alpha = components.3
                red = components.2
                green = components.1
                blue = components.0
            case .abgr:
                alpha = components.0
                red = components.3
                green = components.2
                blue = components.1
            case .argb:
                alpha = components.0
                red = components.1
                green = components.2
                blue = components.3
            case .rgba:
                alpha = components.3
                red = components.0
                green = components.1
                blue = components.2
            default:
                return .clear
            }

            // If chroma components are premultiplied by alpha and the alpha is `0`,
            // keep the chroma components to their current values.
            if cgImage.bitmapInfo.chromaIsPremultipliedByAlpha && alpha != 0 {
                let invUnitAlpha = 255/CGFloat(alpha)
                red = UInt8((CGFloat(red)*invUnitAlpha).rounded())
                green = UInt8((CGFloat(green)*invUnitAlpha).rounded())
                blue = UInt8((CGFloat(blue)*invUnitAlpha).rounded())
            }

            return .init(red: red, green: green, blue: blue, alpha: alpha)

        } else if componentLayout.count == 3 {
            let components = (
                dataPtr[pixelOffset + 0],
                dataPtr[pixelOffset + 1],
                dataPtr[pixelOffset + 2]
            )

            var red: UInt8 = 0
            var green: UInt8 = 0
            var blue: UInt8 = 0

            switch componentLayout {
            case .bgr:
                red = components.2
                green = components.1
                blue = components.0
            case .rgb:
                red = components.0
                green = components.1
                blue = components.2
            default:
                return .clear
            }

            return .init(red: red, green: green, blue: blue, alpha: UInt8(255))

        } else {
            assertionFailure("Unsupported number of pixel components")
            return .clear
        }
    }

}

public extension UIColor {

    convenience init(red: UInt8, green: UInt8, blue: UInt8, alpha: UInt8) {
        self.init(
            red: CGFloat(red)/255,
            green: CGFloat(green)/255,
            blue: CGFloat(blue)/255,
            alpha: CGFloat(alpha)/255)
    }

}

public extension CGBitmapInfo {

    enum ComponentLayout {

        case bgra
        case abgr
        case argb
        case rgba
        case bgr
        case rgb

        var count: Int {
            switch self {
            case .bgr, .rgb: return 3
            default: return 4
            }
        }

    }

    var componentLayout: ComponentLayout? {
        guard let alphaInfo = CGImageAlphaInfo(rawValue: rawValue & Self.alphaInfoMask.rawValue) else { return nil }
        let isLittleEndian = contains(.byteOrder32Little)

        if alphaInfo == .none {
            return isLittleEndian ? .bgr : .rgb
        }
        let alphaIsFirst = alphaInfo == .premultipliedFirst || alphaInfo == .first || alphaInfo == .noneSkipFirst

        if isLittleEndian {
            return alphaIsFirst ? .bgra : .abgr
        } else {
            return alphaIsFirst ? .argb : .rgba
        }
    }

    var chromaIsPremultipliedByAlpha: Bool {
        let alphaInfo = CGImageAlphaInfo(rawValue: rawValue & Self.alphaInfoMask.rawValue)
        return alphaInfo == .premultipliedFirst || alphaInfo == .premultipliedLast
    }

} 
```

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2020-02-21T12:25:37.343

要在 Swift 5 中访问 UIImage 的原始 RGB 值，请使用底层 CGImage 及其 dataProvider：

```
import UIKit

let image = UIImage(named: "example.png")!

guard let cgImage = image.cgImage,
    let data = cgImage.dataProvider?.data,
    let bytes = CFDataGetBytePtr(data) else {
    fatalError("Couldn't access image data")
}
assert(cgImage.colorSpace?.model == .rgb)

let bytesPerPixel = cgImage.bitsPerPixel / cgImage.bitsPerComponent
for y in 0 ..< cgImage.height {
    for x in 0 ..< cgImage.width {
        let offset = (y * cgImage.bytesPerRow) + (x * bytesPerPixel)
        let components = (r: bytes[offset], g: bytes[offset + 1], b: bytes[offset + 2])
        print("[x:\(x), y:\(y)] \(components)")
    }
    print("---")
} 
```

[https://www.ralfebert.de/ios/examples/image-processing/uiimage-raw-pixels/](https://www.ralfebert.de/ios/examples/image-processing/uiimage-raw-pixels/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-10-29T19:55:59.097

基于不同的答案，但主要基于[this](https://stackoverflow.com/a/3763313/423171)，这可以满足我的需要：

```
UIImage *image1 = ...; // The image from where you want a pixel data
int pixelX = ...; // The X coordinate of the pixel you want to retrieve
int pixelY = ...; // The Y coordinate of the pixel you want to retrieve

uint32_t pixel1; // Where the pixel data is to be stored
CGContextRef context1 = CGBitmapContextCreate(&pixel1, 1, 1, 8, 4, CGColorSpaceCreateDeviceRGB(), kCGImageAlphaNoneSkipFirst);
CGContextDrawImage(context1, CGRectMake(-pixelX, -pixelY, CGImageGetWidth(image1.CGImage), CGImageGetHeight(image1.CGImage)), image1.CGImage);
CGContextRelease(context1); 
```

由于这些行，您将拥有一个 AARRGGBB 格式的像素，其 alpha 在 4 字节无符号整数中始终设置为 FF `pixel1`。

# bash - bash 中的 lambda 函数

> ID：448126
> 
> 赞同：28
> 
> 时间：2009-01-15T19:30:37.257
> 
> 标签：bash, lambda

有没有办法在 bash 中实现/使用 lambda 函数？我在想类似的东西：

```
$ someCommand | xargs -L1 (lambda function) 
```

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-15T19:37:58.850

我不知道这样做的方法，但是您可以使用以下方法完成您尝试做的事情：

```
somecommand | while read -r; do echo "Something with $REPLY"; done 
```

这也会更快，因为您不会为每一行文本创建一个新进程。

**[编辑 2009-07-09]** 我做了两个改变：

1.  合并了 litb 关于使用`-r`禁用反斜杠处理的建议——这意味着输入中的反斜杠将不加改变地传递。
2.  我们没有将变量名称（例如`X`）作为参数提供给`read`，而是`read`分配给它的默认变量 ，`REPLY`。这具有保留前导和尾随空格的令人愉快的副作用，否则会被剥离（即使保留了内部空格）。

根据我的观察，这些更改一起保留了每个输入行上除了文字 NUL (ASCII 0) 字符之外的所有内容。

**[编辑 26/7/2016]**

根据评论者 Evi1M4chine 的说法，`$IFS`在运行之前设置为空字符串`read X`（例如，使用命令`IFS='' read X`）还应该在将结果存储到 时在开头和结尾保留空格`$X`，这意味着您不会被迫使用`$REPLY`.

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2013-12-19T08:46:15.097

如果你想要真正的函数，而不仅仅是管道或 while 循环（例如，如果你想传递它们，就好像它们是数据一样）我只是不做 lambdas，而是用重复的虚拟名称定义虚拟函数，使用正确扔掉，然后扔掉。像这样：

```
# An example map function, to use in the example below.
map() { local f="$1"; shift; for i in "$@"; do "$f" "$i"; done; }

# Lambda function [λ], passed to the map function.
λ(){ echo "Lambda sees $1"; }; map λ * 
```

就像在适当的函数式语言中一样，不需要传递参数，因为您可以将它们包装在闭包中：

```
# Let’s say you have a function with three parameters
# that you want to use as a lambda:
# (As in: Partial function application.)
trio(){ echo "$1 Lambda sees $3 $2"; }

# And there are two values that you want to use to parametrize a
# function that shall be your lambda.
pre="<<<"
post=">>>"

# Then you’d just wrap them in a closure, and be done with it:
λ(){ trio "$pre" "$post" "$@"; }; map λ * 
```

我认为它甚至比这里介绍的所有其他解决方案都要短。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-01T16:01:11.543

那这个呢？

```
somecommand | xargs -d"\n" -I{} echo "the argument is: {}" 
```

（假设每个参数都是一行，否则更改分隔符）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2020-10-11T22:04:40.740

```
#!/bin/bash

function customFunction() {
    eval $1
}

command='echo Hello World; echo Welcome;'
customFunction "$command" 
```

总帐

[来源](https://www.baeldung.com/linux/bash-functions)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-10-24T14:14:37.507

如果您只想要 xargs（`-P N`例如，由于并行选项），并且只想要 bash 作为函数代码，那么`bash -c`可以用作 xargs 的参数。

```
seq 1 10 | tr '\n' '\0' | xargs -0 -n 1 bash -c 'echo any bash code $0' 
```

tr 和 -0 选项用于禁用任何 xargs 参数替换。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2018-02-27T18:53:27.533

是的。可以传递一个表示命令调用的字符串变量，然后使用 eval 执行命令。

例子：

```
command='echo howdy'
eval "$command" 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-06-06T17:54:38.307

已经提到了 eval 技巧，但这是我的 bash 闭包扩展示例：

```
#!/usr/bin/env bash

set -e

function multiplyBy() {
    X="$1"

    cat <<-EOF
        Y="\$1"
        echo "$X * \$Y = \$(( $X * \$Y ))"
    EOF
}

function callFunc() {
    CODE="$1"
    shift

    eval "$CODE"
}

MULT_BY_2=`multiplyBy 2`
MULT_BY_4=`multiplyBy 4`

callFunc "$MULT_BY_2" 10
callFunc "$MULT_BY_4" 10 
```

*PS我刚刚想出了一个完全不同的目的，只是在谷歌搜索，看看某人是否正在使用它。**我实际上需要在主脚本的上下文（shell）中评估一个可重用的函数。***

# c# - 如何在 C# 中获取程序集列表？

> ID：448130
> 
> 赞同：0
> 
> 时间：2009-01-15T19:31:15.680
> 
> 标签：c#, reflection, assemblies

我需要获取目录中的程序集列表。还有其他方法吗？

```
System.IO.Directory.GetFiles(directory, "*.dll") 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T19:32:18.690

托管程序集也可以是 EXE。您的代码只会获取扩展名为“dll”的文件。也将返回不是程序集的 Ntive DLL。

在我需要执行此操作的少数情况下，我只是获得了所有文件的列表（类似于您所做的），然后使用 Assemby.LoadFrom 尝试加载每个文件，并在其本机事件中捕获异常。典型的异常是 ReflectionTypeLoadException，但如果无法解析引用，您也可能会收到此异常。

# php - 如何轻松简单地在 PHP 中安排 cron 作业？

> ID：448132
> 
> 赞同：1
> 
> 时间：2009-01-15T19:31:29.113
> 
> 标签：php, linux, unix, cron

如何轻松简单地在 PHP 中安排 cron 作业？Rails 有 BackgroundRB...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-21T19:56:10.513

这是添加到 crontab 的半 PHP 解决方案：

```
$cmd  = 'crontab -l > /tmp/crontab.bak'; // preserve current crontab
$cmd .= ' && echo "*/5 * * * * /foo/bar" >> /tmp/crontab.bak'; // append new command
$cmd .= ' && crontab /tmp/crontab.bak'; // update crontab
$cmd .= ' rm /tmp/crontab.bak'; // delete temp file

exec($cmd); // execute 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T19:37:51.300

大多数网站控制面板（假设您已经运行了 cPanel 或类似的东西）都包含一个 crontab 应用程序。如果您使用共享主机，请询问您的主机。

如果您在专用服务器上并安装了 cron，请查看[crontab 语法](http://en.wikipedia.org/wiki/Cron#crontab_syntax)。这些命令进入`crontab`，通常在`/etc`*nix 上。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-08-30T10:21:47.333

I recommend [http://www.phpjobscheduler.co.uk/](http://www.phpjobscheduler.co.uk/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-30T00:59:03.253

[PHP-Resque](http://github.com/chrisboulton/php-resque)是GitHub 开发人员编写的队列和后台进程框架的 PHP 端口。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T04:28:54.580

您将语言与框架混为一谈。PHP 没有比 Ruby 更多的 cron 调度。但是，如果您使用的是 PHP 框架或 cms，则可能有一些用于 cron 任务的实用程序。

如果您可以控制机器，这是一个有用的链接。 [http://troy.jdmz.net/cron/](http://troy.jdmz.net/cron) 如果您有共享主机，他们可能会为您提供一些用于 cron 工作的工具；问他们或查看知识库。

# .net - 强制 DataGridView 单元格仅接受数字输入的最佳方法是什么？

> ID：448142
> 
> 赞同：3
> 
> 时间：2009-01-15T19:33:54.630
> 
> 标签：.net, datagridview

目前我正在使用：

```
Private Sub dgvStock_CellEndEdit(ByVal sender As System.Object, ByVal e As System.Windows.Forms.DataGridViewCellEventArgs) Handles dgvStock.CellEndEdit
    Select Case Me.dgvStock.Columns(e.ColumnIndex).Name
        Case "Quantity", "Unit Cost"
            If Not IsNumeric(Me.dgvStock(e.ColumnIndex, e.RowIndex).Value) Then
                Me.dgvStock(e.ColumnIndex, e.RowIndex).Value = 0
            End If
    End Select
End Sub 
```

但是有更优雅的解决方案吗？最好首先防止非数字输入，而不是在输入后修复它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T21:31:48.527

如果您听的是 KeyPress 事件而不是 CellEndEdit 事件，您发布的解决方案可能会更好。然后，您可以在用户在文本框中键入时检查有效值，如果输入的值无效，则恢复为以前的值。

或者，这并不是您所要求的，但是您可以有某种视觉指示器来告诉用户他们输入的内容是无效的，例如将 ForeColor 更改为 Red？这将通知用户不良数据，同时不会将他或她与拒绝某些按键的文本框混淆。结合您当前的帖子条目检查可能是一个不错的解决方案。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-27T12:10:20.490

您还可以设置行的 ErrorText 属性并在 RowValidating 事件中检查标志或错误文本。如果存在错误，请将 Cancel 设置为 true。当值有效时，不要忘记将 errortext 设置为空字符串。

**更新：**

我刚刚尝试了这个并找到了更好的解决方案：检查 CellValidating 事件中的值并设置错误文本，因为在这里您可以取消验证。当前输入的值可以通过属性grid[e.ColumnIndex, e.RowIndex].EditedFormattedValue检索

# mysql - Leopard Server 的 MySQL 将其数据存储在哪里？

> ID：448143
> 
> 赞同：13
> 
> 时间：2009-01-15T19:34:04.473
> 
> 标签：mysql, macos, osx-leopard

我正在尝试从 Time Machine 恢复 MySQL 数据库中的表，但是我不知道也找不到 Leopard Server 的 MySQL 存储其数据文件的位置。

1.  有谁知道它们存放在哪里？
2.  有没有一种简单的方法可以在不恢复它们的情况下在它们上运行 mysqldump？
3.  关于 Time Machine 和 MySQL 数据文件，我还有什么需要了解的吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-15T22:33:49.477

连接到数据库并发出

```
SHOW VARIABLES LIKE 'datadir'; 
```

即使它已从默认值更改，它也会告诉您正确的答案。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-02-09T16:49:33.467

对于我的标准安装（来自包），它位于

```
/usr/local/mysql/data 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T22:13:34.387

它在 /var/mysql/dbname 中，其中 dbname 是数据库的名称。

# visual-studio - 自动将 vs2005 调试器附加到子进程

> ID：448154
> 
> 赞同：6
> 
> 时间：2009-01-15T19:35:52.490
> 
> 标签：visual-studio, process, debugging

我有一个在 Visual Studio 2005 中构建的主要 C++ 应用程序，称为 A.exe。它产生一个子进程 B.exe。我通过按 F5 在调试器中运行进程 A——我知道在进程 B 中命中断点的唯一方法是等待 A 启动它，然后运行 ​​Debug -> Attach to Process，然后手动选择 B.exe。如果我需要在进程 B 中调试初始化代码，这将不能很好地工作——我必须在开始时开始进行 10 秒的睡眠。

我缺少的 vs2005 GUI 中是否有一些技巧？

顺便说一句，我正在使用本机代码。

谢谢，内森

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-30T09:21:45.983

您可以告诉 Windows 在启动某个进程时自动附加调试器（通过在注册表设置中指定进程名称）。

详细信息在这里：http: [//msdn.microsoft.com/en-us/library/a329t4ed (v=vs.100).aspx](http://msdn.microsoft.com/en-us/library/a329t4ed(v=vs.100).aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-15T19:47:53.323

由于尚未附加调试进程，您将很难在子进程中使用[debugbreak命令。](http://msdn.microsoft.com/en-us/library/ms679297(VS.85).aspx)

但是，还有另一个可能有用。当您创建流程时，您将掌握它。所以[试一试 DebugBreakProcess](http://msdn.microsoft.com/en-us/library/ms679298(VS.85).aspx)函数。

# vb.net - 对结构的反思与类不同——但仅在代码中

> ID：448158
> 
> 赞同：6
> 
> 时间：2009-01-15T19:36:23.347
> 
> 标签：vb.net, .net-2.0

代码片段：

```
Dim target As Object
' target gets properly set to something of the desired type
Dim field As FieldInfo = target.GetType.GetField("fieldName", _
  BindingFlags.Instance Or BindingFlags.Public Or BindingFlags.NonPublic)
field.SetValue(target,newValue) 
```

如果目标设置为 CLASS 的实例，则此代码段可以完美运行。

但是，如果 target 设置为 STRUCTURE 的实例，则代码实际上不会更改字段的值。没有错误，但值保持不变。

而且，奇怪的是，如果我单步执行代码，请注意 SetValue 无法执行任何操作，然后立即转到“立即”窗口并键入完全相同的 SetValue 操作，*这很有效*。

关于发生了什么以及如何实际更改代码字段的任何建议？

编辑：

根据 Jon Skeet 的要求，实际代码：

```
Private Shared Function XmlDeserializeObject(ByVal objectType As Type, _
        ByVal deserializedID As String) As Object
    Dim result As Object
    result = CreateObject(objectType)

    mXmlR.ReadStartElement()
    Do While mXmlR.IsStartElement _
    AndAlso mXmlR.Name <> elementItem
        Dim field As FieldInfo = result.GetType.GetField(FullName, _
            BindingFlags.Instance Or BindingFlags.Public Or BindingFlags.NonPublic)
        field.SetValue(result, XmlDeserialize(field.FieldType))
    Loop

    Return result
End Function 
```

外部变量和调用例程：
* mXmlR 是一个 XmlTextReader，并且已正确初始化和定位（否则这不适用于类）
* CreateObject 工作（同上）
* XmlDeserialize 大部分工作，并且在问题点处理整数就好了. 唯一已知的问题是结构。

至于我如何检查值，我主要查看 Locals 窗口，但我也在 Immediate 窗口中使用了 print 语句，并且我正在运行一个 NUnit 测试，但由于这个问题而失败 - 而具有类而不是结构的等效测试通过。

这是测试。

```
<Serializable()> Private Structure SimpleStructure
    Public MemberOne As Integer
End Structure

<Test()> Sub A016_SimpleStructure()
    Dim input As New SimpleStructure
    input.MemberOne = 3
    Dim st As String = Serialize(input)
    Debug.Print(st)
    Dim retObject As Object = Deserialize(st)
    Assert.IsNotNull(retObject)
    Assert.IsInstanceOfType(GetType(SimpleStructure), retObject)
    Assert.AreEqual(input.MemberOne, DirectCast(retObject, SimpleStructure).MemberOne)
End Sub 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T13:48:40.203

使用您的原始示例，我同意它在 C# 中有效，但在 VB 中无效！如果您使用 Reflector 或 ILDasm，您将看到对 Field.SetValue(target, ...) 的调用实际上被编译（在 VB 中）为：

```
field.SetValue(RuntimeHelpers.GetObjectValue(target), ...) 
```

GetObjectValue “如果它是一个值类，则返回 obj 的装箱副本；否则返回 obj 本身。” 即值是在你的结构的副本上设置的！

[这个链接](http://www.tech-archive.net/Archive/DotNet/microsoft.public.dotnet.languages.vb/2006-10/msg00219.html)给出了解释（例如它）。解决方法是将目标声明为 System.ValueType 而不是 Object。我不确定这是否真的有助于您的实际代码：您可能需要一个凌乱的类型测试才能将值类型与引用类型分开处理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2013-10-09T13:32:22.520

问题是 VB 制作了对象的副本，而 setvalue 指令适用于副本，但不适用于对象本身。解决方法是通过 auxliar var 和 CType 函数恢复对原始对象的更改。在下面的示例中，我们要将*冠军*var的*国家*字段设置为*西班牙*（*冠军*是一个 *St_WorldChampion* 结构）。我们在*x*变量中进行更改，然后将它们复制到*冠军*变量。有用。

 ***```
Public Structure St_WorldChampion
    Dim sport As String
    Dim country As String
End Structure

Sub UpdateWorldChampion()
    Dim champion As New St_WorldChampion, x As ValueType
    Dim prop As System.Reflection.FieldInfo

    ' Initial values: Germany was the winner in 2006
    champion.country = "Germany"
    champion.sport = "Football"

    ' Update the World Champion: Spain since 2010
    x = champion
    prop = x.GetType().GetField("country")
    prop.SetValue(x, "Spain")
    champion = CType(x, St_WorldChampion)

End Sub 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T19:52:33.920

好吧，您还没有显示所有代码 - 特别是您设置的位置`target`以及之后如何检查字段的值。

这是一个示例，它显示它在 C# 中运行良好：

```
using System;
using System.Reflection;

struct Foo
{
    public int x;
}

class Test
{
    static void Main()
    {
        FieldInfo field = typeof(Foo).GetField("x");

        object foo = new Foo();
        field.SetValue(foo, 10);
        Console.WriteLine(((Foo) foo).x);
    }
} 
```

（我很确定语言的选择在这里无关紧要，但是我们可以肯定地说出更多的代码。）我强烈怀疑你正在做类似的事情：

```
Foo foo = new Foo();
object target = foo;
// SetValue stuff

// What do you expect foo.x to be here? 
```

上面代码段中的值`foo`不会改变 - 因为在第二行，值在装箱时被*复制。*之后您需要拆箱并再次复制：

```
foo = (Foo) target; 
```

如果不是这样，请展示一个简短但*完整*的程序来演示问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-07-24T16:25:39.390

嗨，我使用基督教示例制作了此功能，希望对您有所帮助。此函数使用也受到影响的属性

```
''' <summary>
''' Establece el -valor- en la -propiedad- en el -objeto-
''' Sets Value in Objeto.[propertyname]
''' </summary>
''' <param name="objeto">Object where we will set this property</param>
''' <param name="Propiedad">Name of the property</param>
''' <param name="valor">New Value of the property</param>
''' <returns>Object with changed property</returns>
''' <remarks>It works on structures!</remarks>
Function Establecer_propiedad(objeto As Object, Propiedad As String, valor As Object) As Object
    'Check arguments
    If objeto Is Nothing Then Throw New ArgumentNullException("Objeto")
    If String.IsNullOrWhiteSpace(Propiedad) Then Throw New ArgumentNullException("Propiedad")
    'Get the object type
    Dim t As Type = objeto.GetType
    'Get the propertyInfo by its name
    Dim prop As PropertyInfo = t.GetProperty(Propiedad)
    'Check if the property exist
    If prop Is Nothing Then Throw New InvalidOperationException("Property does not exist")
    If Not prop.CanWrite Then Throw New InvalidOperationException("Property is read only")
    'Determine if it is a class or a structure
    If Not t.IsValueType Then ' (it is a reference value)
        'Set without troubles
        If prop.CanWrite Then prop.SetValue(objeto, valor)
        'Return object
        Return objeto
    Else '(It is a structure)
        'Create a box using a valuetype
        'It doesnot work in object
        Dim Box As ValueType
        'Set item in box
        Box = objeto
        'Set value in box
        prop.SetValue(Box, valor)
        'Return box
        Return Box
    End If
End Function 
```

# javascript - 用 JSON 表示一个查询字符串

> ID：448160
> 
> 赞同：0
> 
> 时间：2009-01-15T19:36:34.733
> 
> 标签：javascript, json, query-string

我有这个 Javascript 数据：

```
[{id:123,type:"test"},{id:154,type:"another"}] 
```

您如何将其转换为某种东西，以便我可以将其作为 HTTP 发布请求传递？

```
menu[0][id] = 123
menu[0][type] = test
menu[1][id] = 154
menu[1][type] = another 
```

我不想传递实际的 JSON 数据，我想清理它并将其作为格式化的 HTTP 参数传递。

**编辑**

能够使用类似这样的东西在客户端解析对象，也许你们会在我将其签署为“已回答”之前提出更好的建议？

```
this.serialize = function(elem) {
    var childs = elem.childElements();
    var str = "";
    for(var i=0, item; i<childs.length; i++) {
        item = childs[i];
        str += ((i)?"&":"")+"menu[" + i +"][id]=" + item.id.replace(/item_/,"");
        str += "&menu[" + i +"][type]=" + item.className;
        str += "&menu[" + i +"][section]=" + elem.id;
        str += "&menu[" + i +"][position]=" + i;
    }
    return str;
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T20:20:01.010

```
var data = [{id:123,type:"test"},{id:154,type:"another"}];
var params = new Array();
for(var x = 0; x < data.length; x++) {
    params.push("id=[" + x + "]=" + escape(data[x].id));
    params.push("type=[" + x + "]=" + escape(data[x].type));
}
alert(params.join("&")); // output: id=[0]=123&type=[0]=test&id=[1]=154&type=[1]=another 
```

那是你要的吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T19:40:53.507

```
"?qsparam=" + escape("[{id:123,type:'test'},{id:154,type:'another'},...]") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T19:52:43.577

menu0.id=123&menu0.type=test&menu1.id=154&menu1.type=另一个

这在服务器上很容易解析，因为它是一种常规格式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T20:18:18.190

我相信 HTTP POST 只接受一个平面键/值集合，而不是任何任意的 JavaScript 数据结构。

如果您*可以将*其展平（例如，像 John Stauffer 的节目），并且如果您要发布到自己的域，则可以使用[.send](http://www.w3.org/TR/XMLHttpRequest/#send)`XMLHttpRequest`来发布和传递键/值集合，其格式类似于查询字符串[（数据）](http://www.w3.org/TR/XMLHttpRequest/#send)方法。

如果您不想自己实现它，大多数 JavaScript 库都应该有一个实现（例如[jQuery.post](http://docs.jquery.com/Ajax/jQuery.post)）。

# ios - 使用 iOS 确定设备（iPhone、iPod Touch）

> ID：448162
> 
> 赞同：374
> 
> 时间：2009-01-15T19:36:58.757
> 
> 标签：ios, objective-c, iphone, ipod-touch

有没有办法确定运行应用程序的设备。如果可能的话，我想区分`iPhone`和。`iPod Touch`

* * *

## 回答 #1

> 赞同：287
> 
> 时间：2009-01-15T19:54:04.603

您可以[`UIDevice`](https://developer.apple.com/library/ios/documentation/UIKit/Reference/UIDevice_Class/index.html#//apple_ref/occ/instp/UIDevice/model)像这样使用该类：

```
NSString *deviceType = [UIDevice currentDevice].model;

if([deviceType isEqualToString:@"iPhone"])
    // it's an iPhone 
```

* * *

## 回答 #2

> 赞同：279
> 
> 时间：2010-10-16T20:53:54.257

这是`UIDeviceHardware.m`来自上述[答案](https://stackoverflow.com/a/1561920/457406)的更新。

```
- (NSString *)platformString
{
    NSString *platform = [self platform];

    if ([platform isEqualToString:@"iPhone1,1"])    return @"iPhone 1G";
    if ([platform isEqualToString:@"iPhone1,2"])    return @"iPhone 3G";
    if ([platform isEqualToString:@"iPhone2,1"])    return @"iPhone 3GS";
    if ([platform isEqualToString:@"iPhone3,1"])    return @"iPhone 4";
    if ([platform isEqualToString:@"iPhone3,3"])    return @"Verizon iPhone 4";
    if ([platform isEqualToString:@"iPhone4,1"])    return @"iPhone 4S";
    if ([platform isEqualToString:@"iPhone5,1"])    return @"iPhone 5 (GSM)";
    if ([platform isEqualToString:@"iPhone5,2"])    return @"iPhone 5 (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone5,3"])    return @"iPhone 5c (GSM)";
    if ([platform isEqualToString:@"iPhone5,4"])    return @"iPhone 5c (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone6,1"])    return @"iPhone 5s (GSM)";
    if ([platform isEqualToString:@"iPhone6,2"])    return @"iPhone 5s (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone7,1"])    return @"iPhone 6";
    if ([platform isEqualToString:@"iPhone7,2"])    return @"iPhone 6 Plus";
    if ([platform isEqualToString:@"iPhone8,1"])    return @"iPhone 6s";
    if ([platform isEqualToString:@"iPhone8,2"])    return @"iPhone 6s Plus";
    if ([platform isEqualToString:@"iPhone8,4"])    return @"iPhone SE";
    if ([platform isEqualToString:@"iPod1,1"])      return @"iPod Touch 1G";
    if ([platform isEqualToString:@"iPod2,1"])      return @"iPod Touch 2G";
    if ([platform isEqualToString:@"iPod3,1"])      return @"iPod Touch 3G";
    if ([platform isEqualToString:@"iPod4,1"])      return @"iPod Touch 4G";
    if ([platform isEqualToString:@"iPod5,1"])      return @"iPod Touch 5G";
    if ([platform isEqualToString:@"iPod7,1"])      return @"iPod Touch 6G";
    if ([platform isEqualToString:@"iPad1,1"])      return @"iPad";
    if ([platform isEqualToString:@"iPad2,1"])      return @"iPad 2 (WiFi)";
    if ([platform isEqualToString:@"iPad2,2"])      return @"iPad 2 (GSM)";
    if ([platform isEqualToString:@"iPad2,3"])      return @"iPad 2 (CDMA)";
    if ([platform isEqualToString:@"iPad2,4"])      return @"iPad 2 (WiFi)";
    if ([platform isEqualToString:@"iPad2,5"])      return @"iPad Mini (WiFi)";
    if ([platform isEqualToString:@"iPad2,6"])      return @"iPad Mini (GSM)";
    if ([platform isEqualToString:@"iPad2,7"])      return @"iPad Mini (GSM+CDMA)";
    if ([platform isEqualToString:@"iPad3,1"])      return @"iPad 3 (WiFi)";
    if ([platform isEqualToString:@"iPad3,2"])      return @"iPad 3 (GSM+CDMA)";
    if ([platform isEqualToString:@"iPad3,3"])      return @"iPad 3 (GSM)";
    if ([platform isEqualToString:@"iPad3,4"])      return @"iPad 4 (WiFi)";
    if ([platform isEqualToString:@"iPad3,5"])      return @"iPad 4 (GSM)";
    if ([platform isEqualToString:@"iPad3,6"])      return @"iPad 4 (GSM+CDMA)";
    if ([platform isEqualToString:@"iPad4,1"])      return @"iPad Air (WiFi)";
    if ([platform isEqualToString:@"iPad4,2"])      return @"iPad Air (Cellular)";
    if ([platform isEqualToString:@"iPad4,4"])      return @"iPad mini 2G (WiFi)";
    if ([platform isEqualToString:@"iPad4,5"])      return @"iPad mini 2G (Cellular)";
    if ([platform isEqualToString:@"iPad5,1"])      return @"iPad mini 4 (WiFi)";
    if ([platform isEqualToString:@"iPad5,2"])      return @"iPad mini 4 (Cellular)";
    if ([platform isEqualToString:@"iPad5,3"])      return @"iPad Air 2 (WiFi)";
    if ([platform isEqualToString:@"iPad5,4"])      return @"iPad Air 2 (Cellular)";
    if ([platform isEqualToString:@"iPad6,3"])      return @"iPad Pro 9.7 inch (WiFi)";
    if ([platform isEqualToString:@"iPad6,4"])      return @"iPad Pro 9.7 inch (Cellular)";
    if ([platform isEqualToString:@"iPad6,7"])      return @"iPad Pro 12.9 inch (WiFi)";
    if ([platform isEqualToString:@"iPad6,8"])      return @"iPad Pro 12.9 inch (Cellular)";
    if ([platform isEqualToString:@"i386"])         return @"Simulator";
    if ([platform isEqualToString:@"x86_64"])       return @"Simulator";

    return platform;
} 
```

* * *

## 回答 #3

> 赞同：122
> 
> 时间：2009-10-13T18:01:40.847

请随意使用这个类（[gist @ github](https://gist.github.com/1323251)）

> 代码已删除并移至
> 
> [https://gist.github.com/1323251](https://gist.github.com/1323251)

**更新**(01/14/11)

显然，这段代码现在有点过时了，但它当然可以使用这个线程上提供的代码进行更新，`Brian Robbins`其中包括具有更新模型的类似代码。感谢您对该线程的支持。

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2012-12-03T08:15:15.757

我在我的应用程序中使用它。更新至 2012 年 12 月。

```
- (NSString *) platformString {
    // Gets a string with the device model
    size_t size;  
    sysctlbyname("hw.machine", NULL, &size, NULL, 0);  
    char *machine = malloc(size);  
    sysctlbyname("hw.machine", machine, &size, NULL, 0);  
    NSString *platform = [NSString stringWithCString:machine encoding:NSUTF8StringEncoding];  
    free(machine); 

    if ([platform isEqualToString:@"iPhone1,1"])    return @"iPhone 2G";
    if ([platform isEqualToString:@"iPhone1,2"])    return @"iPhone 3G";
    if ([platform isEqualToString:@"iPhone2,1"])    return @"iPhone 3GS";
    if ([platform isEqualToString:@"iPhone3,1"])    return @"iPhone 4";
    if ([platform isEqualToString:@"iPhone3,2"])    return @"iPhone 4";
    if ([platform isEqualToString:@"iPhone3,3"])    return @"iPhone 4 (CDMA)";    
    if ([platform isEqualToString:@"iPhone4,1"])    return @"iPhone 4S";
    if ([platform isEqualToString:@"iPhone5,1"])    return @"iPhone 5";
    if ([platform isEqualToString:@"iPhone5,2"])    return @"iPhone 5 (GSM+CDMA)";

    if ([platform isEqualToString:@"iPod1,1"])      return @"iPod Touch (1 Gen)";
    if ([platform isEqualToString:@"iPod2,1"])      return @"iPod Touch (2 Gen)";
    if ([platform isEqualToString:@"iPod3,1"])      return @"iPod Touch (3 Gen)";
    if ([platform isEqualToString:@"iPod4,1"])      return @"iPod Touch (4 Gen)";
    if ([platform isEqualToString:@"iPod5,1"])      return @"iPod Touch (5 Gen)";

    if ([platform isEqualToString:@"iPad1,1"])      return @"iPad";
    if ([platform isEqualToString:@"iPad1,2"])      return @"iPad 3G";
    if ([platform isEqualToString:@"iPad2,1"])      return @"iPad 2 (WiFi)";
    if ([platform isEqualToString:@"iPad2,2"])      return @"iPad 2";
    if ([platform isEqualToString:@"iPad2,3"])      return @"iPad 2 (CDMA)";
    if ([platform isEqualToString:@"iPad2,4"])      return @"iPad 2";
    if ([platform isEqualToString:@"iPad2,5"])      return @"iPad Mini (WiFi)";
    if ([platform isEqualToString:@"iPad2,6"])      return @"iPad Mini";
    if ([platform isEqualToString:@"iPad2,7"])      return @"iPad Mini (GSM+CDMA)";
    if ([platform isEqualToString:@"iPad3,1"])      return @"iPad 3 (WiFi)";
    if ([platform isEqualToString:@"iPad3,2"])      return @"iPad 3 (GSM+CDMA)";
    if ([platform isEqualToString:@"iPad3,3"])      return @"iPad 3";
    if ([platform isEqualToString:@"iPad3,4"])      return @"iPad 4 (WiFi)";
    if ([platform isEqualToString:@"iPad3,5"])      return @"iPad 4";
    if ([platform isEqualToString:@"iPad3,6"])      return @"iPad 4 (GSM+CDMA)";

    if ([platform isEqualToString:@"i386"])         return @"Simulator";
    if ([platform isEqualToString:@"x86_64"])       return @"Simulator";

    return platform;
} 
```

* * *

## 回答 #5

> 赞同：34
> 
> 时间：2016-04-19T11:55:02.860

**最新更新 - 2021 年 12 月：**添加了**iPhone 13**、**iPhone 13 mini**、**iPhone 13 Pro**、**iPhone 13 Pro Max**、**iPad**（第 9 代）、**iPad Pro 11"**（第 3 代）、**iPad Pro 12.9"**（第 5 代）、**iPad mini**（第 6 代）**Apple Watch Series 7**、**iMac 24"**（M1，2021）、**Mac mini**（M1，2020）、**MacBook Air**（M1，2020）、**MacBook Pro 13"**（M1，2020）、**MacBook Pro 14"**（ M1 Pro/Max, 2021), **MacBook Pro 16"** (M1 Pro/Max, 2021)

**移除了不支持 iOS 10 的设备**（由于字符限制）

* * *

## 迅速

（在 Swift 5、Swift 4、Swift 3 上测试）

下面的函数返回一个带有当前设备名称的**字符串。**

```
func userDeviceName() -> String {
    let platform: String = {
        var size = 0
        sysctlbyname("hw.machine", nil, &size, nil, 0)
        var machine = [CChar](repeating: 0,  count: Int(size))
        sysctlbyname("hw.machine", &machine, &size, nil, 0)
        return String(cString: machine)
    }()

    //iPhone
    if platform == "iPhone5,1"        { return "iPhone 5 (GSM)" }
    else if platform == "iPhone5,2"   { return "iPhone 5 (GSM+CDMA)" }
    else if platform == "iPhone5,3"   { return "iPhone 5c (GSM)" }
    else if platform == "iPhone5,4"   { return "iPhone 5c (GSM+CDMA)" }
    else if platform == "iPhone6,1"   { return "iPhone 5s (GSM)" }
    else if platform == "iPhone6,2"   { return "iPhone 5s (GSM+CDMA)" }
    else if platform == "iPhone7,2"   { return "iPhone 6" }
    else if platform == "iPhone7,1"   { return "iPhone 6 Plus" }
    else if platform == "iPhone8,1"   { return "iPhone 6s" }
    else if platform == "iPhone8,2"   { return "iPhone 6s Plus" }
    else if platform == "iPhone8,4"   { return "iPhone SE" }
    else if platform == "iPhone9,1"   { return "iPhone 7 (GSM+CDMA)" }
    else if platform == "iPhone9,3"   { return "iPhone 7 (GSM)" }
    else if platform == "iPhone9,2"   { return "iPhone 7 Plus (GSM+CDMA)" }
    else if platform == "iPhone9,4"   { return "iPhone 7 Plus (GSM)" }
    else if platform == "iPhone10,1"  { return "iPhone 8 (GSM+CDMA)" }
    else if platform == "iPhone10,4"  { return "iPhone 8 (GSM)" }
    else if platform == "iPhone10,2"  { return "iPhone 8 Plus (GSM+CDMA)" }
    else if platform == "iPhone10,5"  { return "iPhone 8 Plus (GSM)" }
    else if platform == "iPhone10,3"  { return "iPhone X (GSM+CDMA)" }
    else if platform == "iPhone10,6"  { return "iPhone X (GSM)" }
    else if platform == "iPhone11,2"  { return "iPhone XS" }
    else if platform == "iPhone11,6"  { return "iPhone XS Max" }
    else if platform == "iPhone11,8"  { return "iPhone XR" }
    else if platform == "iPhone12,1"  { return "iPhone 11" }
    else if platform == "iPhone12,3"  { return "iPhone 11 Pro" }
    else if platform == "iPhone12,5"  { return "iPhone 11 Pro Max" }
    else if platform == "iPhone12,8"  { return "iPhone SE (2nd generation)" }
    else if platform == "iPhone13,1"  { return "iPhone 12 mini" }
    else if platform == "iPhone13,2"  { return "iPhone 12" }
    else if platform == "iPhone13,3"  { return "iPhone 12 Pro" }
    else if platform == "iPhone13,4"  { return "iPhone 12 Pro Max" }
    else if platform == "iPhone14,4"  { return "iPhone 12 mini" }
    else if platform == "iPhone14,5"  { return "iPhone 12" }
    else if platform == "iPhone14,2"  { return "iPhone 12 Pro" }
    else if platform == "iPhone14,3"  { return "iPhone 12 Pro Max" }

        //iPod Touch
    else if platform == "iPod7,1"     { return "iPod Touch (6th generation)" }
    else if platform == "iPod9,1"     { return "iPod Touch (7th generation) (2019)" }

        //iPad
    else if platform == "iPad3,4"     { return "iPad (4th generation) (Wi-Fi)"}
    else if platform == "iPad3,5"     { return "iPad (4th generation) (GSM)" }
    else if platform == "iPad3,6"     { return "iPad (4th generation) (GSM+CDMA)" }
    else if platform == "iPad6,11"    { return "iPad (5th generation) (Wi-Fi)" }
    else if platform == "iPad6,12"    { return "iPad (5th generation) (Cellular)" }
    else if platform == "iPad7,5"     { return "iPad (6th generation) (2018) (Wi-Fi)" }
    else if platform == "iPad7,6"     { return "iPad (6th generation) (2018) (Cellular)" }
    else if platform == "iPad7,11"    { return "iPad (7th generation) (2019) (Wi-Fi)" }
    else if platform == "iPad7,12"    { return "iPad (7th generation) (2019) (Cellular)" }
    else if platform == "iPad11,6"    { return "iPad (8th generation) (2020) (Wi-Fi)" }
    else if platform == "iPad11,7"    { return "iPad (8th generation) (2020) (Cellular)" }
    else if platform == "iPad12,1"    { return "iPad (9th generation) (2021) (Wi-Fi)" }
    else if platform == "iPad12,2"    { return "iPad (9th generation) (2021) (Cellular)" }

        //iPad Air
    else if platform == "iPad4,1"     { return "iPad Air (Wi-Fi)" }
    else if platform == "iPad4,2"     { return "iPad Air (Cellular)" }
    else if platform == "iPad4,3"     { return "iPad Air (China)" }
    else if platform == "iPad5,3"     { return "iPad Air 2 (Wi-Fi)" }
    else if platform == "iPad5,4"     { return "iPad Air 2 (Cellular)" }
    else if platform == "iPad11,3"    { return "iPad Air (3rd generation) (2019) (Wi-Fi)" }
    else if platform == "iPad11,4"    { return "iPad Air (3rd generation) (2019) (Cellular)" }
    else if platform == "iPad13,1"    { return "iPad Air (4th generation) (2020) (Wi-Fi)" }
    else if platform == "iPad13,2"    { return "iPad Air (4th generation) (2020) (Cellular)" }

        //iPad Pro
    else if platform == "iPad6,3"     { return "iPad Pro 9.7\" (Wi-Fi)" }
    else if platform == "iPad6,4"     { return "iPad Pro 9.7\" (Cellular)" }
    else if platform == "iPad6,7"     { return "iPad Pro 12.9\" (Wi-Fi)" }
    else if platform == "iPad6,8"     { return "iPad Pro 12.9\" (Cellular)" }
    else if platform == "iPad7,1"     { return "iPad Pro 12.9\" (2nd generation) (Wi-Fi)" }
    else if platform == "iPad7,2"     { return "iPad Pro 12.9\" (2nd generation) (Cellular)" }
    else if platform == "iPad7,3"     { return "iPad Pro 10.5\" (Wi-Fi)" }
    else if platform == "iPad7,4"     { return "iPad Pro 10.5\" (Cellular)" }
    else if platform == "iPad8,1"     { return "iPad Pro 11\" (2018) (Wi-Fi)" }
    else if platform == "iPad8,2"     { return "iPad Pro 11\" (2018) (Wi-Fi, 1TB)" }
    else if platform == "iPad8,3"     { return "iPad Pro 11\" (2018) (Cellular)" }
    else if platform == "iPad8,4"     { return "iPad Pro 11\" (2018) (Cellular 1TB)" }
    else if platform == "iPad8,5"     { return "iPad Pro 12.9\" (3rd generation) (2018) (Wi-Fi)" }
    else if platform == "iPad8,6"     { return "iPad Pro 12.9\" (3rd generation) (2018) (Wi-Fi, 1TB)" }
    else if platform == "iPad8,7"     { return "iPad Pro 12.9\" (3rd generation) (2018) (Cellular)" }
    else if platform == "iPad8,8"     { return "iPad Pro 12.9\" (3rd generation) (2018) (Cellular, 1TB)" }
    else if platform == "iPad8,9"     { return "iPad Pro 11\" (2nd generation) (2020) (Wi-Fi)" }
    else if platform == "iPad8,10"    { return "iPad Pro 11\" (2nd generation) (2020) (Cellular)" }
    else if platform == "iPad8,11"    { return "iPad Pro 12.9\" (4th generation) (2020) (Wi-Fi)" }
    else if platform == "iPad8,12"    { return "iPad Pro 12.9\" (4th generation) (2020) (Cellular)" }
    else if platform == "iPad13,4"    { return "iPad Pro 11\" (3nd generation) (2021) (Wi-Fi)" }
    else if platform == "iPad13,5"    { return "iPad Pro 11\" (3nd generation) (2021) (Cellular US)" }
    else if platform == "iPad13,6"    { return "iPad Pro 11\" (3nd generation) (2021) (Cellular Global)" }
    else if platform == "iPad13,7"    { return "iPad Pro 11\" (3nd generation) (2021) (Cellular China)" }
    else if platform == "iPad13,8"    { return "iPad Pro 12.9\" (5th generation) (2021) (Wi-Fi)" }
    else if platform == "iPad13,9"    { return "iPad Pro 12.9\" (5th generation) (2021) (Cellular US)" }
    else if platform == "iPad13,10"   { return "iPad Pro 12.9\" (5th generation) (2021) (Cellular Global)" }
    else if platform == "iPad13,11"   { return "iPad Pro 12.9\" (5th generation) (2021) (Cellular China)" }

        //iPad Mini
    else if platform == "iPad4,4"     { return "iPad mini 2 (Wi-Fi)" }
    else if platform == "iPad4,5"     { return "iPad mini 2 (Cellular)" }
    else if platform == "iPad4,6"     { return "iPad mini 2 (China)" }
    else if platform == "iPad4,7"     { return "iPad mini 3 (Wi-Fi)" }
    else if platform == "iPad4,8"     { return "iPad mini 3 (Cellular)" }
    else if platform == "iPad4,9"     { return "iPad mini 3 (China)" }
    else if platform == "iPad5,1"     { return "iPad mini 4 (Wi-Fi)" }
    else if platform == "iPad5,2"     { return "iPad mini 4 (Cellular)" }
    else if platform == "iPad11,1"    { return "iPad mini (5th generation) (2019) (Wi-Fi)" }
    else if platform == "iPad11,2"    { return "iPad mini (5th generation) (2019) (Cellular)" }
    else if platform == "iPad14,1"    { return "iPad mini (6th generation) (2021) (Wi-Fi)" }
    else if platform == "iPad14,2"    { return "iPad mini (6th generation) (2021) (Cellular)" }

        //Apple TV
    else if platform == "AppleTV2,1"  { return "Apple TV 2G" }
    else if platform == "AppleTV3,1"  { return "Apple TV 3" }
    else if platform == "AppleTV3,2"  { return "Apple TV 3 (2013)" }
    else if platform == "AppleTV5,3"  { return "Apple TV 4" }
    else if platform == "AppleTV6,2"  { return "Apple TV 4K" }
    else if platform == "AppleTV11,1" { return "Apple TV 4K (2nd generation)" }

        //Apple Watch
    else if platform == "Watch1,1"    { return "Apple Watch (1st generation) (38mm)" }
    else if platform == "Watch1,2"    { return "Apple Watch (1st generation) (42mm)" }
    else if platform == "Watch2,6"    { return "Apple Watch Series 1 (38mm)" }
    else if platform == "Watch2,7"    { return "Apple Watch Series 1 (42mm)" }
    else if platform == "Watch2,3"    { return "Apple Watch Series 2 (38mm)" }
    else if platform == "Watch2,4"    { return "Apple Watch Series 2 (42mm)" }
    else if platform == "Watch3,1"    { return "Apple Watch Series 3 (38mm Cellular)" }
    else if platform == "Watch3,2"    { return "Apple Watch Series 3 (42mm Cellular)" }
    else if platform == "Watch3,3"    { return "Apple Watch Series 3 (38mm)" }
    else if platform == "Watch3,4"    { return "Apple Watch Series 3 (42mm)" }
    else if platform == "Watch4,1"    { return "Apple Watch Series 4 (40mm)" }
    else if platform == "Watch4,2"    { return "Apple Watch Series 4 (44mm)" }
    else if platform == "Watch4,3"    { return "Apple Watch Series 4 (40mm Cellular)" }
    else if platform == "Watch4,4"    { return "Apple Watch Series 4 (44mm Cellular)" }
    else if platform == "Watch5,1"    { return "Apple Watch Series 5 (40mm)" }
    else if platform == "Watch5,2"    { return "Apple Watch Series 5 (44mm)" }
    else if platform == "Watch5,3"    { return "Apple Watch Series 5 (40mm Cellular)" }
    else if platform == "Watch5,4"    { return "Apple Watch Series 5 (44mm Cellular)" }
    else if platform == "Watch6,1"    { return "Apple Watch Series 6 (40mm)" }
    else if platform == "Watch6,2"    { return "Apple Watch Series 6 (44mm)" }
    else if platform == "Watch6,3"    { return "Apple Watch Series 6 (40mm Cellular)" }
    else if platform == "Watch6,4"    { return "Apple Watch Series 6 (44mm Cellular)" }
    else if platform == "Watch5,9"    { return "Apple Watch SE (40mm)" }
    else if platform == "Watch5,10"   { return "Apple Watch SE (44mm)" }
    else if platform == "Watch5,11"   { return "Apple Watch SE (40mm Cellular)" }
    else if platform == "Watch5,12"   { return "Apple Watch SE (44mm Cellular)" }
    else if platform == "Watch6,6"    { return "Apple Watch Series 7 (41mm)" }
    else if platform == "Watch6,7"    { return "Apple Watch Series 7 (45mm)" }
    else if platform == "Watch6,8"    { return "Apple Watch Series 7 (41mm Cellular)" }
    else if platform == "Watch6,9"    { return "Apple Watch Series 7 (45mm Cellular)" }

        //iMac
    else if platform == "iMac21,1"        { return "iMac 24\" (M1, 2021)" }
    else if platform == "iMac21,2"        { return "iMac 24\" (M1, 2021)" }
        //Mac mini
    else if platform == "Macmini9,1"      { return "Mac mini (M1, 2020)" }
        //MacBookAir
    else if platform == "MacBookAir10,1"  { return "MacBook Air (M1, Late 2020)" }
        //MacBook Pro
    else if platform == "MacBookPro17,1"  { return "MacBook Pro 13\"  (M1, 2020)" }
    else if platform == "MacBookPro18,3"  { return "MacBook Pro 14\" (M1 Pro, 2021)" }
    else if platform == "MacBookPro18,4"  { return "MacBook Pro 14\" (M1 Max, 2021)" }
    else if platform == "MacBookPro18,1"  { return "MacBook Pro 16\" (M1 Pro, 2021)" }
    else if platform == "MacBookPro18,2"  { return "MacBook Pro 16\" (M1 Max, 2021)" }

        //Simulator
    else if platform == "i386"        { return "Simulator" }
    else if platform == "x86_64"      { return "Simulator"}

    return platform
} 
```

您可以使用以下代码对其进行测试：

```
print("Current device is: ", self.userDeviceName()) 
```

* * *

## Objective-C

我还在 Objective-C 代码中添加了新设备

**不要忘记**导入 sys/sysctl.h

```
 #import <sys/sysctl.h>  

- (NSString *) userDeviceName {
    size_t size;
    sysctlbyname("hw.machine", NULL, &size, NULL, 0);
    char *machine = malloc(size);
    sysctlbyname("hw.machine", machine, &size, NULL, 0);
    NSString *platform = [NSString stringWithCString:machine encoding:NSUTF8StringEncoding];

    free(machine);

    //iPhone
    if ([platform isEqualToString:@"iPhone5,1"])    return @"iPhone 5 (GSM)";
    if ([platform isEqualToString:@"iPhone5,2"])    return @"iPhone 5 (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone5,3"])    return @"iPhone 5c (GSM)";
    if ([platform isEqualToString:@"iPhone5,4"])    return @"iPhone 5c (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone6,1"])    return @"iPhone 5s (GSM)";
    if ([platform isEqualToString:@"iPhone6,2"])    return @"iPhone 5s (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone7,2"])    return @"iPhone 6";
    if ([platform isEqualToString:@"iPhone7,1"])    return @"iPhone 6 Plus";
    if ([platform isEqualToString:@"iPhone8,1"])    return @"iPhone 6s";
    if ([platform isEqualToString:@"iPhone8,2"])    return @"iPhone 6s Plus";
    if ([platform isEqualToString:@"iPhone8,4"])    return @"iPhone SE";
    if ([platform isEqualToString:@"iPhone9,1"])    return @"iPhone 7 (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone9,3"])    return @"iPhone 7 (GSM)";
    if ([platform isEqualToString:@"iPhone9,2"])    return @"iPhone 7 Plus (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone9,4"])    return @"iPhone 7 Plus (GSM)";
    if ([platform isEqualToString:@"iPhone10,1"])   return @"iPhone 8 (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone10,4"])   return @"iPhone 8 (GSM)";
    if ([platform isEqualToString:@"iPhone10,2"])   return @"iPhone 8 Plus (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone10,5"])   return @"iPhone 8 Plus (GSM)";
    if ([platform isEqualToString:@"iPhone10,3"])   return @"iPhone X (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone10,6"])   return @"iPhone X (GSM)";
    if ([platform isEqualToString:@"iPhone11,2"])   return @"iPhone XS";
    if ([platform isEqualToString:@"iPhone11,6"])   return @"iPhone XS Max";
    if ([platform isEqualToString:@"iPhone11,8"])   return @"iPhone XR";
    if ([platform isEqualToString:@"iPhone12,1"])   return @"iPhone 11";
    if ([platform isEqualToString:@"iPhone12,3"])   return @"iPhone 11 Pro";
    if ([platform isEqualToString:@"iPhone12,5"])   return @"iPhone 11 Pro Max";
    if ([platform isEqualToString:@"iPhone12,8"])   return @"iPhone SE (2nd generation)";
    if ([platform isEqualToString:@"iPhone13,1"])   return @"iPhone 12 mini";
    if ([platform isEqualToString:@"iPhone13,2"])   return @"iPhone 12";
    if ([platform isEqualToString:@"iPhone13,3"])   return @"iPhone 12 Pro";
    if ([platform isEqualToString:@"iPhone13,4"])   return @"iPhone 12 Pro Max";
    if ([platform isEqualToString:@"iPhone14,4"])   return @"iPhone 13 mini";
    if ([platform isEqualToString:@"iPhone14,5"])   return @"iPhone 13";
    if ([platform isEqualToString:@"iPhone14,2"])   return @"iPhone 13 Pro";
    if ([platform isEqualToString:@"iPhone14,3"])   return @"iPhone 13 Pro Max";

    //iPod Touch
    if ([platform isEqualToString:@"iPod7,1"])      return @"iPod Touch (6th generation)";
    if ([platform isEqualToString:@"iPod9,1"])      return @"iPod Touch (7th generation) (2019)";

    //iPad
    if ([platform isEqualToString:@"iPad3,4"])      return @"iPad (4th generation) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad3,5"])      return @"iPad (4th generation) (GSM)";
    if ([platform isEqualToString:@"iPad3,6"])      return @"iPad (4th generation) (GSM+CDMA)";
    if ([platform isEqualToString:@"iPad6,11"])     return @"iPad (5th generation) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad6,12"])     return @"iPad (5th generation) (Cellular)";
    if ([platform isEqualToString:@"iPad7,5"])      return @"iPad (6th generation) (2018) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad7,6"])      return @"iPad (6th generation) (2018) (Cellular)";
    if ([platform isEqualToString:@"iPad7,11"])     return @"iPad (7th generation) (2019) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad7,12"])     return @"iPad (7th generation) (2019) (Cellular)";
    if ([platform isEqualToString:@"iPad11,6"])     return @"iPad (8th generation) (2020) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad11,7"])     return @"iPad (8th generation) (2020) (Cellular)";
    if ([platform isEqualToString:@"iPad12,1"])     return @"iPad (9th generation) (2021) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad12,2"])     return @"iPad (9th generation) (2021) (Cellular)";

    //iPad Air
    if ([platform isEqualToString:@"iPad4,1"])      return @"iPad Air (Wi-Fi)";
    if ([platform isEqualToString:@"iPad4,2"])      return @"iPad Air (Cellular)";
    if ([platform isEqualToString:@"iPad4,3"])      return @"iPad Air (China)";
    if ([platform isEqualToString:@"iPad5,3"])      return @"iPad Air 2 (Wi-Fi)";
    if ([platform isEqualToString:@"iPad5,4"])      return @"iPad Air 2 (Cellular)";
    if ([platform isEqualToString:@"iPad11,3"])     return @"iPad Air (3rd generation) (2019) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad11,4"])     return @"iPad Air (3rd generation) (2019) (Cellular)";
    if ([platform isEqualToString:@"iPad13,1"])     return @"iPad Air (4th generation) (2020) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad13,2"])     return @"iPad Air (4th generation) (2020) (Cellular)";

    //iPad Pro
    if ([platform isEqualToString:@"iPad6,3"])      return @"iPad Pro 9.7\" (Wi-Fi)";
    if ([platform isEqualToString:@"iPad6,4"])      return @"iPad Pro 9.7\" (Cellular)";
    if ([platform isEqualToString:@"iPad6,7"])      return @"iPad Pro 12.9\" (Wi-Fi)";
    if ([platform isEqualToString:@"iPad6,8"])      return @"iPad Pro 12.9\" (Cellular)";
    if ([platform isEqualToString:@"iPad7,1"])      return @"iPad Pro 12.9\" (2nd generation) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad7,2"])      return @"iPad Pro 12.9\" (2nd generation) (Cellular)";
    if ([platform isEqualToString:@"iPad7,3"])      return @"iPad Pro 10.5\" (Wi-Fi)";
    if ([platform isEqualToString:@"iPad7,4"])      return @"iPad Pro 10.5\" (Cellular)";
    if ([platform isEqualToString:@"iPad8,1"])      return @"iPad Pro 11\" (2018) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad8,2"])      return @"iPad Pro 11\" (2018) (Wi-Fi, 1TB)";
    if ([platform isEqualToString:@"iPad8,3"])      return @"iPad Pro 11\" (2018) (Cellular)";
    if ([platform isEqualToString:@"iPad8,4"])      return @"iPad Pro 11\" (2018) (Cellular, 1Tb)";
    if ([platform isEqualToString:@"iPad8,5"])      return @"iPad Pro 12.9\" (3rd generation) (2018) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad8,6"])      return @"iPad Pro 12.9\" (3rd generation) (2018) (Wi-Fi, 1TB)";
    if ([platform isEqualToString:@"iPad8,7"])      return @"iPad Pro 12.9\" (3rd generation) (2018) (Cellular)";
    if ([platform isEqualToString:@"iPad8,8"])      return @"iPad Pro 12.9\" (3rd generation) (2018) (Cellular, 1TB)";
    if ([platform isEqualToString:@"iPad8,9"])      return @"iPad Pro 11\" (2nd generation) (2020) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad8,10"])     return @"iPad Pro 11\" (2nd generation) (2020) (Cellular)";
    if ([platform isEqualToString:@"iPad8,11"])     return @"iPad Pro 12.9\" (4th generation) (2020) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad8,12"])     return @"iPad Pro 12.9\" (4th generation) (2020) (Cellular)";
    if ([platform isEqualToString:@"iPad13,4"])     return @"iPad Pro 11\" (3nd generation) (2021) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad13,5"])     return @"iPad Pro 11\" (3nd generation) (2021) (Cellular US)";
    if ([platform isEqualToString:@"iPad13,6"])     return @"iPad Pro 11\" (3nd generation) (2021) (Cellular Global)";
    if ([platform isEqualToString:@"iPad13,7"])     return @"iPad Pro 11\" (3nd generation) (2021) (Cellular China)";
    if ([platform isEqualToString:@"iPad13,8"])     return @"iPad Pro 12.9\" (5th generation) (2021) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad13,9"])     return @"iPad Pro 12.9\" (5th generation) (2021) (Cellular US)";
    if ([platform isEqualToString:@"iPad13,10"])    return @"iPad Pro 12.9\" (5th generation) (2021) (Cellular Global)";
    if ([platform isEqualToString:@"iPad13,11"])    return @"iPad Pro 12.9\" (5th generation) (2021) (Cellular China)";

    //iPad mini
    if ([platform isEqualToString:@"iPad4,4"])      return @"iPad mini 2 (Wi-Fi)";
    if ([platform isEqualToString:@"iPad4,5"])      return @"iPad mini 2 (Cellular)";
    if ([platform isEqualToString:@"iPad4,6"])      return @"iPad mini 2 (China)";
    if ([platform isEqualToString:@"iPad4,7"])      return @"iPad mini 3 (Wi-Fi)";
    if ([platform isEqualToString:@"iPad4,8"])      return @"iPad mini 3 (Cellular)";
    if ([platform isEqualToString:@"iPad4,9"])      return @"iPad mini 3 (China)";
    if ([platform isEqualToString:@"iPad5,1"])      return @"iPad mini 4 (Wi-Fi)";
    if ([platform isEqualToString:@"iPad5,2"])      return @"iPad mini 4 (Cellular)";
    if ([platform isEqualToString:@"iPad11,1"])     return @"iPad mini (5th generation) (2019) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad11,2"])     return @"iPad mini (5th generation) (2019) (Cellular)";
    if ([platform isEqualToString:@"iPad14,1"])     return @"iPad mini (6th generation) (2021) (Wi-Fi)";
    if ([platform isEqualToString:@"iPad14,2"])     return @"iPad mini (6th generation) (2021) (Cellular)";

    //Apple TV
    if ([platform isEqualToString:@"AppleTV2,1"])   return @"Apple TV 2G";
    if ([platform isEqualToString:@"AppleTV3,1"])   return @"Apple TV 3";
    if ([platform isEqualToString:@"AppleTV3,2"])   return @"Apple TV 3 (2013)";
    if ([platform isEqualToString:@"AppleTV5,3"])   return @"Apple TV 4";
    if ([platform isEqualToString:@"AppleTV6,2"])   return @"Apple TV 4K";
    if ([platform isEqualToString:@"AppleTV11,1"])  return @"Apple TV 4K (2nd generation)";

    //Apple Watch
    if ([platform isEqualToString:@"Watch1,1"])     return @"Apple Watch (1st generation) (38mm)";
    if ([platform isEqualToString:@"Watch1,2"])     return @"Apple Watch (1st generation) (42mm)";
    if ([platform isEqualToString:@"Watch2,6"])     return @"Apple Watch Series 1 (38mm)";
    if ([platform isEqualToString:@"Watch2,7"])     return @"Apple Watch Series 1 (42mm)";
    if ([platform isEqualToString:@"Watch2,3"])     return @"Apple Watch Series 2 (38mm)";
    if ([platform isEqualToString:@"Watch2,4"])     return @"Apple Watch Series 2 (42mm)";
    if ([platform isEqualToString:@"Watch3,1"])     return @"Apple Watch Series 3 (38mm Cellular)";
    if ([platform isEqualToString:@"Watch3,2"])     return @"Apple Watch Series 3 (42mm Cellular)";
    if ([platform isEqualToString:@"Watch3,3"])     return @"Apple Watch Series 3 (38mm)";
    if ([platform isEqualToString:@"Watch3,4"])     return @"Apple Watch Series 3 (42mm)";
    if ([platform isEqualToString:@"Watch4,1"])     return @"Apple Watch Series 4 (40mm)";
    if ([platform isEqualToString:@"Watch4,2"])     return @"Apple Watch Series 4 (44mm)";
    if ([platform isEqualToString:@"Watch4,3"])     return @"Apple Watch Series 4 (40mm Cellular)";
    if ([platform isEqualToString:@"Watch4,4"])     return @"Apple Watch Series 4 (44mm Cellular)";
    if ([platform isEqualToString:@"Watch5,1"])     return @"Apple Watch Series 5 (40mm)";
    if ([platform isEqualToString:@"Watch5,2"])     return @"Apple Watch Series 5 (44mm)";
    if ([platform isEqualToString:@"Watch5,3"])     return @"Apple Watch Series 5 (40mm Cellular)";
    if ([platform isEqualToString:@"Watch5,4"])     return @"Apple Watch Series 5 (44mm Cellular)";
    if ([platform isEqualToString:@"Watch6,1"])     return @"Apple Watch Series 6 (40mm)";
    if ([platform isEqualToString:@"Watch6,2"])     return @"Apple Watch Series 6 (44mm)";
    if ([platform isEqualToString:@"Watch6,3"])     return @"Apple Watch Series 6 (40mm Cellular)";
    if ([platform isEqualToString:@"Watch6,4"])     return @"Apple Watch Series 6 (44mm Cellular)";
    if ([platform isEqualToString:@"Watch5,9"])     return @"Apple Watch SE (40mm)";
    if ([platform isEqualToString:@"Watch5,10"])    return @"Apple Watch SE (44mm)";
    if ([platform isEqualToString:@"Watch5,11"])    return @"Apple Watch SE (40mm Cellular)";
    if ([platform isEqualToString:@"Watch5,12"])    return @"Apple Watch SE (44mm Cellular)";
    if ([platform isEqualToString:@"Watch6,6"])     return @"Apple Watch Series 7 (41mm)";
    if ([platform isEqualToString:@"Watch6,7"])     return @"Apple Watch Series 7 (45mm)";
    if ([platform isEqualToString:@"Watch6,8"])     return @"Apple Watch Series 7 (41mm Cellular)";
    if ([platform isEqualToString:@"Watch6,9"])     return @"Apple Watch Series 7 (45mm Cellular)";

    //iMac
    if ([platform isEqualToString:@"iMac21,1"])        return @"iMac 24\" (M1, 2021)";
    if ([platform isEqualToString:@"iMac21,2"])        return @"iMac 24\" (M1, 2021)";
    //Mac mini
    if ([platform isEqualToString:@"Macmini9,1"])      return @"Mac mini (M1, 2020)";
    //MacBookAir
    if ([platform isEqualToString:@"MacBookAir10,1"])  return @"MacBook Air (M1, Late 2020)";
    //MacBook Pro
    if ([platform isEqualToString:@"MacBookPro17,1"])  return @"MacBook Pro 13\"  (M1, 2020)";
    if ([platform isEqualToString:@"MacBookPro18,3"])  return @"MacBook Pro 14\" (M1 Pro, 2021)";
    if ([platform isEqualToString:@"MacBookPro18,4"])  return @"MacBook Pro 14\" (M1 Max, 2021)";
    if ([platform isEqualToString:@"MacBookPro18,1"])  return @"MacBook Pro 16\" (M1 Pro, 2021)";
    if ([platform isEqualToString:@"MacBookPro18,2"])  return @"MacBook Pro 16\" (M1 Max, 2021)";

    //Simulator
    if ([platform isEqualToString:@"i386"])         return @"Simulator";
    if ([platform isEqualToString:@"x86_64"])       return @"Simulator";

    return platform;
} 
```

您可以使用以下代码对其进行测试：

```
NSLog(@"Current device is: %@", [self userDeviceName]); 
```

* * *

## 回答 #6

> 赞同：27
> 
> 时间：2012-06-19T10:08:01.163

```
if([UIDevice currentDevice].userInterfaceIdiom==UIUserInterfaceIdiomPad) {
    //Device is ipad 
}else{
    //Device is iphone
} 
```

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2014-12-24T00:39:37.290

更新了`iPad Air 2`和的平台字符串`iPad mini 3`：

```
- (NSString *)platformString
{
    NSString *platform = [self platform];

    if ([platform isEqualToString:@"iPhone1,1"])    return @"iPhone 1G";
    if ([platform isEqualToString:@"iPhone1,2"])    return @"iPhone 3G";
    if ([platform isEqualToString:@"iPhone2,1"])    return @"iPhone 3GS";
    if ([platform isEqualToString:@"iPhone3,1"])    return @"iPhone 4";
    if ([platform isEqualToString:@"iPhone3,3"])    return @"Verizon iPhone 4";
    if ([platform isEqualToString:@"iPhone4,1"])    return @"iPhone 4S";
    if ([platform isEqualToString:@"iPhone5,1"])    return @"iPhone 5 (GSM)";
    if ([platform isEqualToString:@"iPhone5,2"])    return @"iPhone 5 (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone5,3"])    return @"iPhone 5c (GSM)";
    if ([platform isEqualToString:@"iPhone5,4"])    return @"iPhone 5c (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone6,1"])    return @"iPhone 5s (GSM)";
    if ([platform isEqualToString:@"iPhone6,2"])    return @"iPhone 5s (GSM+CDMA)";
    if ([platform isEqualToString:@"iPhone7,1"])    return @"iPhone 6 Plus";
    if ([platform isEqualToString:@"iPhone7,2"])    return @"iPhone 6";
    if ([platform isEqualToString:@"iPod1,1"])      return @"iPod Touch 1G";
    if ([platform isEqualToString:@"iPod2,1"])      return @"iPod Touch 2G";
    if ([platform isEqualToString:@"iPod3,1"])      return @"iPod Touch 3G";
    if ([platform isEqualToString:@"iPod4,1"])      return @"iPod Touch 4G";
    if ([platform isEqualToString:@"iPod5,1"])      return @"iPod Touch 5G";
    if ([platform isEqualToString:@"iPad1,1"])      return @"iPad";
    if ([platform isEqualToString:@"iPad2,1"])      return @"iPad 2 (WiFi)";
    if ([platform isEqualToString:@"iPad2,2"])      return @"iPad 2 (GSM)";
    if ([platform isEqualToString:@"iPad2,3"])      return @"iPad 2 (CDMA)";
    if ([platform isEqualToString:@"iPad2,4"])      return @"iPad 2 (WiFi)";
    if ([platform isEqualToString:@"iPad2,5"])      return @"iPad Mini (WiFi)";
    if ([platform isEqualToString:@"iPad2,6"])      return @"iPad Mini (GSM)";
    if ([platform isEqualToString:@"iPad2,7"])      return @"iPad Mini (GSM+CDMA)";
    if ([platform isEqualToString:@"iPad3,1"])      return @"iPad 3 (WiFi)";
    if ([platform isEqualToString:@"iPad3,2"])      return @"iPad 3 (GSM+CDMA)";
    if ([platform isEqualToString:@"iPad3,3"])      return @"iPad 3 (GSM)";
    if ([platform isEqualToString:@"iPad3,4"])      return @"iPad 4 (WiFi)";
    if ([platform isEqualToString:@"iPad3,5"])      return @"iPad 4 (GSM)";
    if ([platform isEqualToString:@"iPad3,6"])      return @"iPad 4 (GSM+CDMA)";
    if ([platform isEqualToString:@"iPad4,1"])      return @"iPad Air (WiFi)";

    if ([platform isEqualToString:@"iPad4,2"])      return @"iPad Air (Cellular)";
    if ([platform isEqualToString:@"iPad4,4"])      return @"iPad mini 2G (WiFi)";
    if ([platform isEqualToString:@"iPad4,5"])      return @"iPad mini 2G (Cellular)";

    if ([platform isEqualToString:@"iPad4,7"])      return @"iPad mini 3 (WiFi)";
    if ([platform isEqualToString:@"iPad4,8"])      return @"iPad mini 3 (Cellular)";
    if ([platform isEqualToString:@"iPad4,9"])      return @"iPad mini 3 (China Model)";

    if ([platform isEqualToString:@"iPad5,3"])      return @"iPad Air 2 (WiFi)";
    if ([platform isEqualToString:@"iPad5,4"])      return @"iPad Air 2 (Cellular)";
    if ([platform isEqualToString:@"iPad6,8"])      return @"iPad Pro";

    if ([platform isEqualToString:@"i386"])         return @"Simulator";
    if ([platform isEqualToString:@"x86_64"])       return @"Simulator";

    return platform;
} 
```

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2010-10-18T10:39:47.467

更实用

```
#include <sys/types.h>
#include <sys/sysctl.h>

@interface UIDevice(Hardware)

- (NSString *) platform;

- (BOOL)hasRetinaDisplay;

- (BOOL)hasMultitasking;

- (BOOL)hasCamera;

@end

@implementation UIDevice(Hardware)

- (NSString *) platform{
    int mib[2];
size_t len;
char *machine;

mib[0] = CTL_HW;
mib[1] = HW_MACHINE;
sysctl(mib, 2, NULL, &len, NULL, 0);
machine = malloc(len);
sysctl(mib, 2, machine, &len, NULL, 0);

    NSString *platform = [NSString stringWithCString:machine encoding:NSASCIIStringEncoding];
    free(machine);
return platform;
}

- (BOOL)hasRetinaDisplay {
    NSString *platform = [self platform];
    BOOL ret = YES;
    if ([platform isEqualToString:@"iPhone1,1"]) {
        ret = NO;
    }
    else
        if ([platform isEqualToString:@"iPhone1,2"])    ret = NO;
    else 
        if ([platform isEqualToString:@"iPhone2,1"])    ret = NO;
    else 
        if ([platform isEqualToString:@"iPod1,1"])      ret = NO;
    else
        if ([platform isEqualToString:@"iPod2,1"])      ret = NO;
    else
        if ([platform isEqualToString:@"iPod3,1"])      ret = NO;
    return ret;
}

- (BOOL)hasMultitasking {
    if ([self respondsToSelector:@selector(isMultitaskingSupported)]) {
        return [self isMultitaskingSupported];
    }
    return NO;
}

- (BOOL)hasCamera {
   BOOL ret = NO;
   // check camera availability
   return ret;
}

@end 
```

你可以阅读属性

```
NSLog(@"platform %@, retita %@, multitasking %@", [[UIDevice currentDevice] platform], [[UIDevice currentDevice] hasRetinaDisplay] ? @"YES" : @"NO" , [[UIDevice currentDevice] hasMultitasking] ? @"YES" : @"NO"); 
```

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2010-07-23T18:55:53.663

这是新模型的小更新：

```
- (NSString *) platformString{
    NSString *platform = [self platform];
    if ([platform isEqualToString:@"iPhone1,1"]) return @"iPhone 1G";
    if ([platform isEqualToString:@"iPhone1,2"]) return @"iPhone 3G";
    if ([platform isEqualToString:@"iPhone2,1"]) return @"iPhone 3GS";
    if ([platform isEqualToString:@"iPhone3,1"]) return @"iPhone 4";
    if ([platform isEqualToString:@"iPod1,1"])   return @"iPod Touch 1G";
    if ([platform isEqualToString:@"iPod2,1"])   return @"iPod Touch 2G";
    if ([platform isEqualToString:@"iPod3,1"])   return @"iPod Touch 3G";
    if ([platform isEqualToString:@"i386"])   return @"iPhone Simulator";
    return platform;
} 
```

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2015-06-05T11:34:13.730

我知道已经勾选了答案，但为了将来参考，您始终可以使用设备屏幕尺寸来确定它是哪个设备：

```
if ([[UIDevice currentDevice] userInterfaceIdiom] == UIUserInterfaceIdiomPhone) {

    CGSize result = [[UIScreen mainScreen] bounds].size;

    if (result.height == 480) {
        // 3.5 inch display - iPhone 4S and below
        NSLog(@"Device is an iPhone 4S or below");
    }

    else if (result.height == 568) {
        // 4 inch display - iPhone 5
        NSLog(@"Device is an iPhone 5/S/C");
    }

    else if (result.height == 667) {
        // 4.7 inch display - iPhone 6
        NSLog(@"Device is an iPhone 6");
    }

    else if (result.height == 736) {
        // 5.5 inch display - iPhone 6 Plus
        NSLog(@"Device is an iPhone 6 Plus");
    }
} 

else if ([[UIDevice currentDevice] userInterfaceIdiom] == UIUserInterfaceIdiomPad) {
       // iPad 9.7 or 7.9 inch display.
       NSLog(@"Device is an iPad.");
} 
```

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2011-11-06T00:35:31.773

只需将 iPhone 4S 设备代码添加到此线程...

iPhone 4S 将返回字符串@"iPhone4,1"。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2011-12-12T17:57:52.463

这段代码怎么样，如果发布了新版本，您将使用最后知道的设备进行标识

```
- (NSString *)getModel {
    size_t size;
    sysctlbyname("hw.machine", NULL, &size, NULL, 0);
    char *model = malloc(size);
    sysctlbyname("hw.machine", model, &size, NULL, 0);
    NSString *sDeviceModel = [NSString stringWithCString:model encoding:NSUTF8StringEncoding];
    free(model);                              
    if ([sDeviceModel isEqual:@"i386"])      return @"Simulator";  //iPhone Simulator
    if ([sDeviceModel isEqual:@"iPhone1,1"]) return @"iPhone1G";   //iPhone 1G
    if ([sDeviceModel isEqual:@"iPhone1,2"]) return @"iPhone3G";   //iPhone 3G
    if ([sDeviceModel isEqual:@"iPhone2,1"]) return @"iPhone3GS";  //iPhone 3GS
    if ([sDeviceModel isEqual:@"iPhone3,1"]) return @"iPhone3GS";  //iPhone 4 - AT&T
    if ([sDeviceModel isEqual:@"iPhone3,2"]) return @"iPhone3GS";  //iPhone 4 - Other carrier
    if ([sDeviceModel isEqual:@"iPhone3,3"]) return @"iPhone4";    //iPhone 4 - Other carrier
    if ([sDeviceModel isEqual:@"iPhone4,1"]) return @"iPhone4S";   //iPhone 4S
    if ([sDeviceModel isEqual:@"iPod1,1"])   return @"iPod1stGen"; //iPod Touch 1G
    if ([sDeviceModel isEqual:@"iPod2,1"])   return @"iPod2ndGen"; //iPod Touch 2G
    if ([sDeviceModel isEqual:@"iPod3,1"])   return @"iPod3rdGen"; //iPod Touch 3G
    if ([sDeviceModel isEqual:@"iPod4,1"])   return @"iPod4thGen"; //iPod Touch 4G
    if ([sDeviceModel isEqual:@"iPad1,1"])   return @"iPadWiFi";   //iPad Wifi
    if ([sDeviceModel isEqual:@"iPad1,2"])   return @"iPad3G";     //iPad 3G
    if ([sDeviceModel isEqual:@"iPad2,1"])   return @"iPad2";      //iPad 2 (WiFi)
    if ([sDeviceModel isEqual:@"iPad2,2"])   return @"iPad2";      //iPad 2 (GSM)
    if ([sDeviceModel isEqual:@"iPad2,3"])   return @"iPad2";      //iPad 2 (CDMA)

    NSString *aux = [[sDeviceModel componentsSeparatedByString:@","] objectAtIndex:0];

//If a newer version exist
    if ([aux rangeOfString:@"iPhone"].location!=NSNotFound) {
        int version = [[aux stringByReplacingOccurrencesOfString:@"iPhone" withString:@""] intValue];
        if (version == 3) return @"iPhone4"
        if (version >= 4) return @"iPhone4s";

    }
    if ([aux rangeOfString:@"iPod"].location!=NSNotFound) {
        int version = [[aux stringByReplacingOccurrencesOfString:@"iPod" withString:@""] intValue];
        if (version >=4) return @"iPod4thGen";
    }
    if ([aux rangeOfString:@"iPad"].location!=NSNotFound) {
        int version = [[aux stringByReplacingOccurrencesOfString:@"iPad" withString:@""] intValue];
        if (version ==1) return @"iPad3G";
        if (version >=2) return @"iPad2";
    }
    //If none was found, send the original string
    return sDeviceModel;
} 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2013-01-12T17:57:15.613

添加到 Arash 的代码中，我不关心我的应用程序我使用的是什么型号，我只想知道什么样的设备，所以，我可以测试如下：

```
 if (UI_USER_INTERFACE_IDIOM() == UIUserInterfaceIdiomPad)
        {
            NSLog(@"I'm definitely an iPad");
    } else {
    NSString *deviceType = [UIDevice currentDevice].model;
                if([deviceType rangeOfString:@"iPhone"].location!=NSNotFound)
                {
                    NSLog(@"I must be an iPhone");

                } else {
                    NSLog(@"I think I'm an iPod");

                }
} 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2012-01-13T03:57:23.860

基于上面非常好的答案，这就是我想出的。这与@Rodrigo 的答案非常相似，但解决了@Oliver 对该答案的评论的担忧。这也提供了在输出字符串中包含模型字符串的选项。

```
+ (NSString *) deviceModel {
    size_t size;
    sysctlbyname("hw.machine", NULL, &size, NULL, 0);
    char *model = malloc(size);
    sysctlbyname("hw.machine", model, &size, NULL, 0);
    NSString *deviceModel = [NSString stringWithCString:model encoding:NSUTF8StringEncoding];
    free(model);      

    return deviceModel;
}

+ (NSString *) deviceName {
    NSString *deviceModel = [DeviceGateway deviceModel];                    

    if ([deviceModel isEqual:@"i386"])      return @"Simulator";  //iPhone Simulator
    if ([deviceModel isEqual:@"iPhone1,1"]) return @"iPhone1G";   //iPhone 1G
    if ([deviceModel isEqual:@"iPhone1,2"]) return @"iPhone3G";   //iPhone 3G
    if ([deviceModel isEqual:@"iPhone2,1"]) return @"iPhone3GS";  //iPhone 3GS
    if ([deviceModel isEqual:@"iPhone3,1"]) return @"iPhone4";    //iPhone 4 - AT&T
    if ([deviceModel isEqual:@"iPhone3,2"]) return @"iPhone4";    //iPhone 4 - Other carrier
    if ([deviceModel isEqual:@"iPhone3,3"]) return @"iPhone4";    //iPhone 4 - Other carrier
    if ([deviceModel isEqual:@"iPhone4,1"]) return @"iPhone4S";   //iPhone 4S
    if ([deviceModel isEqual:@"iPod1,1"])   return @"iPod1stGen"; //iPod Touch 1G
    if ([deviceModel isEqual:@"iPod2,1"])   return @"iPod2ndGen"; //iPod Touch 2G
    if ([deviceModel isEqual:@"iPod3,1"])   return @"iPod3rdGen"; //iPod Touch 3G
    if ([deviceModel isEqual:@"iPod4,1"])   return @"iPod4thGen"; //iPod Touch 4G
    if ([deviceModel isEqual:@"iPad1,1"])   return @"iPadWiFi";   //iPad Wifi
    if ([deviceModel isEqual:@"iPad1,2"])   return @"iPad3G";     //iPad 3G
    if ([deviceModel isEqual:@"iPad2,1"])   return @"iPad2";      //iPad 2 (WiFi)
    if ([deviceModel isEqual:@"iPad2,2"])   return @"iPad2";      //iPad 2 (GSM)
    if ([deviceModel isEqual:@"iPad2,3"])   return @"iPad2";      //iPad 2 (CDMA)

    NSString *aux = [[deviceModel componentsSeparatedByString:@","] objectAtIndex:0];

    //If a newer version exists
    if ([aux rangeOfString:@"iPhone"].location != NSNotFound) {
        int version = [[aux stringByReplacingOccurrencesOfString:@"iPhone" withString:@""] intValue];
        if (version == 3) return @"iPhone4";
        if (version == 4) return @"iPhone4s";
        return @"Newer iPhone";
    }
    if ([aux rangeOfString:@"iPod"].location != NSNotFound) {
        int version = [[aux stringByReplacingOccurrencesOfString:@"iPod" withString:@""] intValue];
        if (version == 4) return @"iPod4thGen";
        return @"Newer iPod";
    }
    if ([aux rangeOfString:@"iPad"].location != NSNotFound) {
        int version = [[aux stringByReplacingOccurrencesOfString:@"iPad" withString:@""] intValue];
        if (version == 1) return @"iPad3G";
        if (version == 2) return @"iPad2";
        return @"Newer iPad";
    }

    //If none was found, send the original string
    return deviceModel;
}

+ (NSString *) deviceNameWithDeviceModel:(BOOL)shouldIncludeDeviceModel {
    if (shouldIncludeDeviceModel) {
        return [NSString stringWithFormat:@"%@ (%@)", [DeviceGateway deviceName], [DeviceGateway deviceModel]];
    }

    return [DeviceGateway deviceName];
} 
```

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2015-09-06T22:07:31.590

有一个非常成熟的库（由我编写），称为[SDVersion](http://github.com/sebyddd/SDVersion)。您可以检查运行设备的型号、屏幕尺寸和许多其他参数。它还支持 OSX。

例子：

```
 // Check for device model
      if ([SDVersion deviceVersion] == iPhone6)
           NSLog(@"You got the iPhone 6\. Sweet !");
      else if ([SDVersion deviceVersion] == iPhone6Plus)
           NSLog(@"iPhone 6 Plus? Bigger is better!");
      else if ([SDVersion deviceVersion] == iPadAir2)
           NSLog(@"You own an iPad Air 2 !");

      // Check for device screen size
      if ([SDVersion deviceSize] == Screen4inch)
           NSLog(@"Your screen is 4 inches"); 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2013-05-22T06:59:46.993

```
NSString *deviceType = [UIDevice currentDevice].model; 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2015-04-25T12:13:17.920

```
#import <sys/utsname.h> 

NSString *iPhone = [self iPhoneVersion]; 

-(NSString*)iPhoneVersion
{
   NSString *platform;
   struct utsname systemInfo;
   uname(&systemInfo);
   platform = [NSString stringWithCString:systemInfo.machine encoding:NSUTF8StringEncoding];

   if ([platform isEqualToString:@"iPhone1,1"])    return @"iPhone 1G";
   if ([platform isEqualToString:@"iPhone1,2"])    return @"iPhone 3G";
   if ([platform isEqualToString:@"iPhone2,1"])    return @"iPhone 3GS";
   if ([platform isEqualToString:@"iPhone3,1"])    return @"iPhone 4";
   if ([platform isEqualToString:@"iPhone3,3"])    return @"VerizoniPhone 4";
   if ([platform isEqualToString:@"iPhone4,1"])    return @"iPhone 4S";
   if ([platform isEqualToString:@"iPhone5,1"])    return @"iPhone 5 (GSM)";
   if ([platform isEqualToString:@"iPhone5,2"])    return @"iPhone 5 (GSM+CDMA)";
   if ([platform isEqualToString:@"iPhone5,3"])    return @"iPhone 5c (GSM)";
   if ([platform isEqualToString:@"iPhone5,4"])    return @"iPhone 5c (GSM+CDMA)";
   if ([platform isEqualToString:@"iPhone6,1"])    return @"iPhone 5s (GSM)";
   if ([platform isEqualToString:@"iPhone6,2"])    return @"iPhone 5s (GSM+CDMA)";
   if ([platform isEqualToString:@"iPhone7,2"])    return @"iPhone 6";
   if ([platform isEqualToString:@"iPhone7,1"])    return @"iPhone 6 Plus";
   if ([platform isEqualToString:@"iPod1,1"])      return @"iPod Touch 1G";
   if ([platform isEqualToString:@"iPod2,1"])      return @"iPod Touch 2G";
   if ([platform isEqualToString:@"iPod3,1"])      return @"iPod Touch 3G";
   if ([platform isEqualToString:@"iPod4,1"])      return @"iPod Touch 4G";
   if ([platform isEqualToString:@"iPod5,1"])      return @"iPod Touch 5G";
   if ([platform isEqualToString:@"iPad1,1"])      return @"iPad";
   if ([platform isEqualToString:@"iPad2,1"])      return @"iPad 2 (WiFi)";
   if ([platform isEqualToString:@"iPad2,2"])      return @"iPad 2 (GSM)";
   if ([platform isEqualToString:@"iPad2,3"])      return @"iPad 2 (CDMA)";
   if ([platform isEqualToString:@"iPad2,4"])      return @"iPad 2 (WiFi)";
   if ([platform isEqualToString:@"iPad2,5"])      return @"iPad Mini (WiFi)";
   if ([platform isEqualToString:@"iPad2,6"])      return @"iPad Mini (GSM)";
   if ([platform isEqualToString:@"iPad2,7"])      return @"iPad Mini (GSM+CDMA)";
   if ([platform isEqualToString:@"iPad3,1"])      return @"iPad 3 (WiFi)";
   if ([platform isEqualToString:@"iPad3,2"])      return @"iPad 3 (GSM+CDMA)";
   if ([platform isEqualToString:@"iPad3,3"])      return @"iPad 3 (GSM)";
   if ([platform isEqualToString:@"iPad3,4"])      return @"iPad 4 (WiFi)";
   if ([platform isEqualToString:@"iPad3,5"])      return @"iPad 4 (GSM)";
   if ([platform isEqualToString:@"iPad3,6"])      return @"iPad 4 (GSM+CDMA)";
   if ([platform isEqualToString:@"iPad4,1"])      return @"iPad Air (WiFi)";
   if ([platform isEqualToString:@"iPad4,2"])      return @"iPad Air (Cellular)";
   if ([platform isEqualToString:@"iPad4,3"])      return @"iPad Air";
   if ([platform isEqualToString:@"iPad4,4"])      return @"iPad Mini 2G (WiFi)";
   if ([platform isEqualToString:@"iPad4,5"])      return @"iPad Mini 2G (Cellular)";
   if ([platform isEqualToString:@"iPad4,6"])      return @"iPad Mini 2G";
   if ([platform isEqualToString:@"iPad4,7"])      return @"iPad Mini 3 (WiFi)";
   if ([platform isEqualToString:@"iPad4,8"])      return @"iPad Mini 3 (Cellular)";
   if ([platform isEqualToString:@"iPad4,9"])      return @"iPad Mini 3 (China)";
   if ([platform isEqualToString:@"iPad5,3"])      return @"iPad Air 2 (WiFi)";
   if ([platform isEqualToString:@"iPad5,4"])      return @"iPad Air 2 (Cellular)";
   if ([platform isEqualToString:@"AppleTV2,1"])   return @"Apple TV 2G";
   if ([platform isEqualToString:@"AppleTV3,1"])   return @"Apple TV 3";
   if ([platform isEqualToString:@"AppleTV3,2"])   return @"Apple TV 3 (2013)";
   if ([platform isEqualToString:@"i386"])         return @"Simulator";
   if ([platform isEqualToString:@"x86_64"])       return @"Simulator";
   return platform;
} 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2013-09-18T12:03:58.140

我更进一步，将大的“isEqualToString”块转换为设备类型、世代和逗号后的其他限定符的位掩码分类（我称之为子世代）。它被包装在一个带有单例调用 SGPlatform 的类中，从而避免了大量重复的字符串操作。代码可用[https://github.com/danloughney/spookyGroup](https://github.com/danloughney/spookyGroup)

该类允许您执行以下操作：

```
if ([SGPlatform iPad] && [SGPlatform generation] > 3) {
    // set for high performance
} 
```

和

```
switch ([SGPlatform deviceMask]) {
case DEVICE_IPHONE:
    break;
case DEVICE_IPAD:
    break;
case DEVICE_IPAD_MINI:
    break;
} 
```

设备的分类在 platformBits 方法中。这个方法的读者应该很熟悉这个线程。我已经按设备的类型和代数对设备进行了分类，因为我最感兴趣的是整体性能，但是可以调整源以提供您感兴趣的任何分类，视网膜屏幕，网络功能等。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2014-03-10T13:58:48.463

下面提到的代码片段应该会有所帮助：

```
 if ([[UIDevice currentDevice] userInterfaceIdiom] == UIUserInterfaceIdiomPhone) {
   // iPhone device
 }
 else if ([[UIDevice currentDevice] userInterfaceIdiom] == UIUserInterfaceIdiomPad) {
   // iPad device
 }
 else {
  // Other device i.e. iPod
 } 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2012-12-21T10:57:05.213

```
- (BOOL)deviceiPhoneOriPod
  {
    NSString *deviceType = [UIDevice currentDevice].model;
    if([deviceType rangeOfString:@"iPhone"].location!=NSNotFound)
      return YES;
    else
      return NO;
  } 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2011-03-20T08:16:10.640

`Dutchie432`并`Brian Robbins`提供了很好的解决方案。但是仍然缺少一种型号，即**Verizon iPhone 4**。这是缺少的行。

```
if ([platform isEqualToString:@"iPhone3,2"])    return @"iPhone 4"; //Verizon 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2013-04-22T10:28:25.527

我喜欢 Erica Sadun 的东西。她包括 AppleTV 设备和您可能没有想到的其他设备。

[https://github.com/erica/uidevice-extension/blob/master/UIDevice-Hardware.h](https://github.com/erica/uidevice-extension/blob/master/UIDevice-Hardware.h)

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2015-04-13T06:26:23.120

的可能值

```
[[UIDevice currentDevice] model]; 
```

是`iPod touch`, `iPhone`, `iPhone Simulator`, `iPad`,`iPad Simulator`

如果您想知道哪些硬件`iOS`正在损坏，例如，`iPhone3`下面是该代码`iPhone4``iPhone5`

* * *

**注意：**下面的代码可能不包含所有设备的字符串，我和其他人在**GitHub 上**维护相同的代码，所以请从那里获取最新的代码

**目标-C**：[GitHub/DeviceUtil](https://github.com/InderKumarRathore/DeviceUtil)

**斯威夫特**：[GitHub/DeviceGuru](https://github.com/InderKumarRathore/DeviceGuru)

* * *

```
#include <sys/types.h>
#include <sys/sysctl.h>

- (NSString*)hardwareDescription {
    NSString *hardware = [self hardwareString];
    if ([hardware isEqualToString:@"iPhone1,1"]) return @"iPhone 2G";
    if ([hardware isEqualToString:@"iPhone1,2"]) return @"iPhone 3G";
    if ([hardware isEqualToString:@"iPhone3,1"]) return @"iPhone 4";
    if ([hardware isEqualToString:@"iPhone4,1"]) return @"iPhone 4S";
    if ([hardware isEqualToString:@"iPhone5,1"]) return @"iPhone 5";
    if ([hardware isEqualToString:@"iPod1,1"]) return @"iPodTouch 1G";
    if ([hardware isEqualToString:@"iPod2,1"]) return @"iPodTouch 2G";
    if ([hardware isEqualToString:@"iPad1,1"]) return @"iPad";
    if ([hardware isEqualToString:@"iPad2,6"]) return @"iPad Mini";
    if ([hardware isEqualToString:@"iPad4,1"]) return @"iPad Air WIFI";
    //there are lots of other strings too, checkout the github repo
    //link is given at the top of this answer

    if ([hardware isEqualToString:@"i386"]) return @"Simulator";
    if ([hardware isEqualToString:@"x86_64"]) return @"Simulator";

    return nil;
}

- (NSString*)hardwareString {
    size_t size = 100;
    char *hw_machine = malloc(size);
    int name[] = {CTL_HW,HW_MACHINE};
    sysctl(name, 2, hw_machine, &size, NULL, 0);
    NSString *hardware = [NSString stringWithUTF8String:hw_machine];
    free(hw_machine);
    return hardware;
} 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2016-11-30T04:07:38.647

在 Swift 3 中回答，

```
struct DeviceInformation {
    // UIDevice.current.model's value is "iPhone" or "iPad"，which does not include details; the following "model" is detailed, such as, iPhone7,1 is actually iPhone 6 plus
    static let model: String = {
        var size = 0
        sysctlbyname("hw.machine", nil, &size, nil, 0)
        var machine = [CChar](repeating: 0,  count: Int(size))
        sysctlbyname("hw.machine", &machine, &size, nil, 0)
        return String(cString: machine)
    }()

    static let uuid = UIDevice.current.identifierForVendor?.uuidString ?? ""
    static let idForAdService = ASIdentifierManager.shared().advertisingIdentifier.uuidString

    static func diviceTypeReadableName() -> String {
        switch model {
        case "iPhone1,1":   return "iPhone 1G"
        case "iPhone1,2":   return "iPhone 3G"
        case "iPhone2,1":   return "iPhone 3GS"
        case "iPhone3,1":   return "iPhone 4"
        case "iPhone3,3":   return "iPhone 4 (Verizon)"
        case "iPhone4,1":   return "iPhone 4S"
        case "iPhone5,1":   return "iPhone 5 (GSM)"
        case "iPhone5,2":   return "iPhone 5 (GSM+CDMA)"
        case "iPhone5,3":   return "iPhone 5c (GSM)"
        case "iPhone5,4":   return "iPhone 5c (GSM+CDMA)"
        case "iPhone6,1":   return "iPhone 5s (GSM)"
        case "iPhone6,2":   return "iPhone 5s (GSM+CDMA)"
        case "iPhone7,2":   return "iPhone 6"
        case "iPhone7,1":   return "iPhone 6 Plus"
        case "iPhone8,1":   return "iPhone 6s"
        case "iPhone8,2":   return "iPhone 6s Plus"
        case "iPhone8,4":   return "iPhone SE"
        case "iPhone9,1":   return "iPhone 7"
        case "iPhone9,3":   return "iPhone 7"
        case "iPhone9,2":   return "iPhone 7 Plus"
        case "iPhone9,4":   return "iPhone 7 Plus"
        case "iPod1,1":     return "iPod Touch 1G"
        case "iPod2,1":     return "iPod Touch 2G"
        case "iPod3,1":     return "iPod Touch 3G"
        case "iPod4,1":     return "iPod Touch 4G"
        case "iPod5,1":     return "iPod Touch 5G"
        case "iPod7,1":     return "iPod Touch 6G"
        case "iPad1,1":     return "iPad 1G"
        case "iPad2,1":     return "iPad 2 (Wi-Fi)"
        case "iPad2,2":     return "iPad 2 (GSM)"
        case "iPad2,3":     return "iPad 2 (CDMA)"
        case "iPad2,4":     return "iPad 2 (Wi-Fi)"
        case "iPad2,5":     return "iPad Mini (Wi-Fi)"
        case "iPad2,6":     return "iPad Mini (GSM)"
        case "iPad2,7":     return "iPad Mini (GSM+CDMA)"
        case "iPad3,1":     return "iPad 3 (Wi-Fi)"
        case "iPad3,2":     return "iPad 3 (GSM+CDMA)"
        case "iPad3,3":     return "iPad 3 (GSM)"
        case "iPad3,4":     return "iPad 4 (Wi-Fi)"
        case "iPad3,5":     return "iPad 4 (GSM)"
        case "iPad3,6":     return "iPad 4 (GSM+CDMA)"
        case "iPad4,1":     return "iPad Air (Wi-Fi)"
        case "iPad4,2":     return "iPad Air (Cellular)"
        case "iPad4,3":     return "iPad Air (China)"
        case "iPad4,4":     return "iPad Mini 2G (Wi-Fi)"
        case "iPad4,5":     return "iPad Mini 2G (Cellular)"
        case "iPad4,6":     return "iPad Mini 2G (China)"
        case "iPad4,7":     return "iPad Mini 3 (Wi-Fi)"
        case "iPad4,8":     return "iPad Mini 3 (Cellular)"
        case "iPad4,9":     return "iPad Mini 3 (China)"
        case "iPad5,1":     return "iPad Mini 4 (Wi-Fi)"
        case "iPad5,2":     return "iPad Mini 4 (Cellular)"
        case "iPad5,3":     return "iPad Air 2 (Wi-Fi)"
        case "iPad5,4":     return "iPad Air 2 (Cellular)"
        case "iPad6,3":     return "iPad Pro 9.7' (Wi-Fi)"
        case "iPad6,4":     return "iPad Pro 9.7' (Cellular)"
        case "iPad6,7":     return "iPad Pro 12.9' (Wi-Fi)"
        case "iPad6,8":     return "iPad Pro 12.9' (Cellular)"
        case "AppleTV2,1":  return "Apple TV 2G"
        case "AppleTV3,1":  return "Apple TV 3"
        case "AppleTV3,2":  return "Apple TV 3 (2013)"
        case "AppleTV5,3":  return "Apple TV 4"
        case "Watch1,1":    return "Apple Watch Series 1 (38mm, S1)"
        case "Watch1,2":    return "Apple Watch Series 1 (42mm, S1)"
        case "Watch2,6":    return "Apple Watch Series 1 (38mm, S1P)"
        case "Watch2,7":    return "Apple Watch Series 1 (42mm, S1P)"
        case "Watch2,3":    return "Apple Watch Series 2 (38mm, S2)"
        case "Watch2,4":    return "Apple Watch Series 2 (42mm, S2)"
        case "i386":        return "Simulator"
        case "x86_64":      return "Simulator"

        default:
            return ""
        }
    }
} 
```

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2018-04-19T10:06:20.537

为了简单的比较，我总是喜欢宏：

```
#define IS_IPOD [[UIDevice currentDevice].model containsString:@"iPod"]
#define IS_IPAD (UI_USER_INTERFACE_IDIOM() == UIUserInterfaceIdiomPad)
#define IS_IPHONE (UI_USER_INTERFACE_IDIOM() == UIUserInterfaceIdiomPhone) 
```

它简单易用。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2013-10-11T19:54:49.547

我想添加它来检索设备的正面和外壳颜色，有一个私有 API：

```
UIDevice *device = [UIDevice currentDevice];
SEL selector = NSSelectorFromString([device.systemVersion hasPrefix:@"7"] ? @"_deviceInfoForKey:" :  @"deviceInfoForKey:");
if ([device respondsToSelector:selector]) {
    NSLog(@"DeviceColor: %@ DeviceEnclosureColor: %@", [device performSelector:selector withObject:@"DeviceColor"], [device performSelector:selector withObject:@"DeviceEnclosureColor"]);
} 
```

我已经写了一篇关于这个的博客并提供了一个示例应用程序：

[http://www.futuretap.com/blog/device-colors/](http://www.futuretap.com/blog/device-colors/)

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2014-11-14T06:17:04.623

```
NSString *deviceType = [[UIDevice currentDevice] systemName]; 
```

我可以保证上述建议的适用于 iOS 7 及更高版本。我相信它也适用于 iOS 6。但我不确定。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2015-01-18T20:00:43.217

您可以在 GitHub 上查看[GBDeviceInfo](https://github.com/lmirosevic/GBDeviceInfo)，也可以通过 CocoaPods 获得。它提供了简单的 API 来检测各种属性，并支持所有最新设备：

*   设备系列

`[GBDeviceInfo deviceDetails].family == GBDeviceFamilyiPhone;`

*   设备型号

`[GBDeviceInfo deviceDetails].model == GBDeviceModeliPhone6.`

有关更多信息，请参阅[自述文件](https://github.com/lmirosevic/GBDeviceInfo/blob/master/README.md)。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2017-01-08T23:22:47.707

要识别 iPhone 4S，只需检查以下内容：

```
var isIphone4S: Bool {

    let width = UIScreen.main.bounds.size.width
    let height = UIScreen.main.bounds.size.height
    let proportions = width > height ? width / height : height / width

    return proportions == 1.5 && UIDevice.current.model == "iPhone"
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2019-01-21T16:12:26.283

我创建了一个扩展程序，可让您拥有 3 个级别的标识：

1.  设备类型
2.  iPhone/iPad 类型（英寸）
3.  设备型号

它会随着最后的 iOS 设备更新

[UIDeviceDetector](https://github.com/Rufy86/UIDeviceDetector)

* * *

## 回答 #31

> 赞同：-1
> 
> 时间：2017-02-02T20:00:57.917

更新平台字符串。

```
// Created from this thread: https://gist.github.com/Jaybles/1323251

// Apple TV
if ([platform isEqualToString:@"AppleTV2,1"])   return @"Apple TV 2G";
if ([platform isEqualToString:@"AppleTV3,1"])   return @"Apple TV 3G";
if ([platform isEqualToString:@"AppleTV3,2"])   return @"Apple TV 3G";
if ([platform isEqualToString:@"AppleTV5,3"])   return @"Apple TV 4G";

// Apple Watch
if ([platform isEqualToString:@"Watch1,1"])     return @"Apple Watch";
if ([platform isEqualToString:@"Watch1,2"])     return @"Apple Watch";

// iPhone
if ([platform isEqualToString:@"iPhone1,1"])    return @"iPhone 2G";
if ([platform isEqualToString:@"iPhone1,2"])    return @"iPhone 3G";
if ([platform isEqualToString:@"iPhone2,1"])    return @"iPhone 3GS";
if ([platform isEqualToString:@"iPhone3,1"])    return @"iPhone 4 (GSM)";
if ([platform isEqualToString:@"iPhone3,2"])    return @"iPhone 4 (GSM/2012)";
if ([platform isEqualToString:@"iPhone3,3"])    return @"iPhone 4 (CDMA)";
if ([platform isEqualToString:@"iPhone4,1"])    return @"iPhone 4S";
if ([platform isEqualToString:@"iPhone5,1"])    return @"iPhone 5 (GSM)";
if ([platform isEqualToString:@"iPhone5,2"])    return @"iPhone 5 (Global)";
if ([platform isEqualToString:@"iPhone5,3"])    return @"iPhone 5c (GSM)";
if ([platform isEqualToString:@"iPhone5,4"])    return @"iPhone 5c (Global)";
if ([platform isEqualToString:@"iPhone6,1"])    return @"iPhone 5s (GSM)";
if ([platform isEqualToString:@"iPhone6,2"])    return @"iPhone 5s (Global)";
if ([platform isEqualToString:@"iPhone7,2"])    return @"iPhone 6";
if ([platform isEqualToString:@"iPhone7,1"])    return @"iPhone 6 Plus";
if ([platform isEqualToString:@"iPhone8,1"])    return @"iPhone 6s";
if ([platform isEqualToString:@"iPhone8,2"])    return @"iPhone 6s Plus";
if ([platform isEqualToString:@"iPhone8,4"])    return @"iPhone SE";
if ([platform isEqualToString:@"iPhone9,1"])    return @"iPhone 7 (Global)";
if ([platform isEqualToString:@"iPhone9,3"])    return @"iPhone 7 (GSM)";
if ([platform isEqualToString:@"iPhone9,2"])    return @"iPhone 7 Plus (Global)";
if ([platform isEqualToString:@"iPhone9,4"])    return @"iPhone 7 Plus (GSM)";

// iPad
if ([platform isEqualToString:@"iPad1,1"])      return @"iPad 1";
if ([platform isEqualToString:@"iPad2,1"])      return @"iPad 2 (WiFi)";
if ([platform isEqualToString:@"iPad2,2"])      return @"iPad 2 (GSM)";
if ([platform isEqualToString:@"iPad2,3"])      return @"iPad 2 (CDMA)";
if ([platform isEqualToString:@"iPad2,4"])      return @"iPad 2 (Mid 2012)";
if ([platform isEqualToString:@"iPad3,1"])      return @"iPad 3 (WiFi)";
if ([platform isEqualToString:@"iPad3,2"])      return @"iPad 3 (CDMA)";
if ([platform isEqualToString:@"iPad3,3"])      return @"iPad 3 (GSM)";
if ([platform isEqualToString:@"iPad3,4"])      return @"iPad 4 (WiFi)";
if ([platform isEqualToString:@"iPad3,5"])      return @"iPad 4 (GSM)";
if ([platform isEqualToString:@"iPad3,6"])      return @"iPad 4 (Global)";

// iPad Air
if ([platform isEqualToString:@"iPad4,1"])      return @"iPad Air (WiFi)";
if ([platform isEqualToString:@"iPad4,2"])      return @"iPad Air (Cellular)";
if ([platform isEqualToString:@"iPad4,3"])      return @"iPad Air (China)";
if ([platform isEqualToString:@"iPad5,3"])      return @"iPad Air 2 (WiFi)";
if ([platform isEqualToString:@"iPad5,4"])      return @"iPad Air 2 (Cellular)";

// iPad Mini
if ([platform isEqualToString:@"iPad2,5"])      return @"iPad Mini (WiFi)";
if ([platform isEqualToString:@"iPad2,6"])      return @"iPad Mini (GSM)";
if ([platform isEqualToString:@"iPad2,7"])      return @"iPad Mini (Global)";
if ([platform isEqualToString:@"iPad4,4"])      return @"iPad Mini 2 (WiFi)";
if ([platform isEqualToString:@"iPad4,5"])      return @"iPad Mini 2 (Cellular)";
if ([platform isEqualToString:@"iPad4,6"])      return @"iPad Mini 2 (China)";
if ([platform isEqualToString:@"iPad4,7"])      return @"iPad Mini 3 (WiFi)";
if ([platform isEqualToString:@"iPad4,8"])      return @"iPad Mini 3 (Cellular)";
if ([platform isEqualToString:@"iPad4,9"])      return @"iPad Mini 3 (China)";
if ([platform isEqualToString:@"iPad5,1"])      return @"iPad Mini 4 (WiFi)";
if ([platform isEqualToString:@"iPad5,2"])      return @"iPad Mini 4 (Cellular)";

// iPad Pro
if ([platform isEqualToString:@"iPad6,3"])      return @"iPad Pro (9.7 inch/WiFi)";
if ([platform isEqualToString:@"iPad6,4"])      return @"iPad Pro (9.7 inch/Cellular)";
if ([platform isEqualToString:@"iPad6,7"])      return @"iPad Pro (12.9 inch/WiFi)";
if ([platform isEqualToString:@"iPad6,8"])      return @"iPad Pro (12.9 inch/Cellular)";

// iPod
if ([platform isEqualToString:@"iPod1,1"])      return @"iPod Touch 1G";
if ([platform isEqualToString:@"iPod2,1"])      return @"iPod Touch 2G";
if ([platform isEqualToString:@"iPod3,1"])      return @"iPod Touch 3G";
if ([platform isEqualToString:@"iPod4,1"])      return @"iPod Touch 4G";
if ([platform isEqualToString:@"iPod5,1"])      return @"iPod Touch 5G";
if ([platform isEqualToString:@"iPod7,1"])      return @"iPod Touch 6G";

// Simulator
if ([platform isEqualToString:@"i386"])         return @"Simulator";
if ([platform isEqualToString:@"x86_64"])       return @"Simulator"; 
```

# css - 2-col CSS 布局，背景颜色填充全高？

> ID：448164
> 
> 赞同：6
> 
> 时间：2009-01-15T19:37:50.363
> 
> 标签：css

我对 CSS 布局有相当多的了解。

我已经查看了相当多的 2 或 3 列布局的 CSS 布局，并且很难找到一个可靠的 2 列，它允许我执行以下操作：

我想要的是：

*   每列都有自己的背景颜色
*   我希望背景栏填满页面的整个高度
*   我不知道哪一列将包含最多的文本，所以每列必须独立调整大小

在我发现的所有布局中 - 或尝试过的所有布局中，它们都有这些问题之一

*   背景需要一张图片（有点聪明，但是很好！）
*   如果该列最长，则背景颜色仅填充整个高度

我很想恢复到`<TABLE>`我可以在大约 3 行代码中可靠地实现的状态。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T19:49:27.860

如果你不喜欢[仿列，请尝试](http://www.alistapart.com/articles/fauxcolumns/)**[多列布局](http://www.alistapart.com/articles/multicolumnlayouts/)**。

从任一块中删除内容（有很多内容）以尝试一下。

这一直是我遇到的麻烦 - 我建议您将**[A List Apart](http://www.alistapart.com/)**加入书签并查看 CSS 类别中的一些文章。他们为前端编码人员提供了一些优秀的教程和文章（例如 CSS 精灵、液体布局、字体等）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T19:46:22.403

如果您对图像背景有疑问，那么使用表格到底有什么理由呢？这对我来说似乎很倒退。图像背景为您提供适当的标记、所需的效果，并具有跨浏览器兼容性。

您可以使用 Javascript - 但这真的没有必要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T19:51:11.007

除非您使用固定高度（可能不是可行的解决方案）或通过使用背景图像（您已经将其标记为*问题*）来使用假列技术，否则您几乎不走运。

仿列技术被广泛使用并且是跨浏览器的功能。为什么这对您来说不是一个可行的解决方案？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-15T19:55:36.567

如果我的问题是正确的，那么您的布局应该很简单：

```
 <div class="wrapper">
    <div class="col1">Blahblah</div>
    <div class="col2">Blahblah</div>
    <div class="clear"></div>
 </div> 
```

样式.css：

```
 .wrapper { background-image: url(imageTile.gif); background-repeat: repeat-y; }
 .col1 { float: left; width: 100px; margin-right: 20px; }
 .col2 { float: left; width: 100px; }
 .clear { clear: both; } 
```

忘记一张桌子，IMO 这要容易得多。高度会随着内容而变化。imageTile.gif 应该是背景颜色的 1px x [x]px 切片，其中 [x] 是页面的宽度。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T20:21:11.837

这不是一个很难解决的问题，所以我不建议你回到桌子上。不过，我对您到底想要什么有点困惑，所以让我尽量以最好的方式帮助您。

```
<div class="a">Text A</div>
<div class="b">Text B</div> 
```

使用 CSS：

```
html, body
{
    height: 100%;
}

.a
{
    width: 50%;
    height: 100%;
    min-height: 100%; /* For IE */
    background-color: red;
    float: left;
}

.b
{
    width: 50%;
    height: 100%;
    min-height: 100%;
    background-color: blue;
    float: left;
} 
```

这会给你这样的东西：[for-simon.html](http://loganfs.com/testing/for-simon.html)

那是你要找的吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T19:46:29.970

我花了（浪费）很多时间来寻找一个好的 CSS 解决方案。伙计，用一张桌子。我们不会告诉任何人。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-08-31T10:27:40.437

迟到总比不好。认为这可能会有所帮助：

html

```
<div id="content"> 
    <div id="left"></div>
    <div id="right"></div>
</div> 
```

的CSS

```
#content { background-color: #F1EBD9; }
#left { float: left; width: 14em; }
#right { margin-left: 14em; background-color: #FFF; } 
```

您可以查看此@http [://alexandergutierrez.info/stretch-background-color-in-a-two-col-layout](http://alexandergutierrez.info/stretch-background-color-in-a-two-col-layout)

# cocoa - 使用 NSCoder 编码 CGPoint 结构

> ID：448173
> 
> 赞同：16
> 
> 时间：2009-01-15T19:40:58.297
> 
> 标签：cocoa

您如何使用 对`CGPoint`结构进行编码和解码`NSCoder`？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-01-15T23:23:16.320

编码：

```
CGPoint point = /* point from somewhere */
NSValue *pointValue = [NSValue value:&point withObjCType:@encode(CGPoint)];
[coder encodeObject:pointValue forKey:@"point"]; 
```

解码：

```
NSValue *decodedValue = [decoder decodeObjectForKey:@"point"];
CGPoint point;
[decodedValue getValue:&point]; 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2011-04-16T01:31:06.673

只是 iOS 开发者的更新。您可以在 Cocoa Touch 中执行以下操作（但不能在 Cocoa 中）：

```
[coder encodeCGPoint:myPoint forKey:@"myPoint"]; 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-15T19:51:30.663

`CGPoint`s 和`NSPoint`s 都是由两个`CGFloat`值组成的结构，因此您可以自由地将它们相互传递。快速而肮脏的方法是：

```
NSCoder *myNSCoder;
CGPoint myPoint;
[myNSCoder encodePoint:*(NSPoint *)myPoint]; 
```

这通常会起作用，但它在技术上违反了 C99 严格的别名规则。如果您想 100% 兼容该标准，则必须执行以下操作：

```
typedef union
{
  CGPoint cgPoint;
  NSPoint nsPoint;
} CGNSPoint;

CGNSPoint cgnsPoint = { .cgPoint = myPoint };
[myNSCoder encodePoint:cgnsPoint.nsPoint]; 
```

# .net - CSS列的.NET UserControl？

> ID：448174
> 
> 赞同：0
> 
> 时间：2009-01-15T19:41:04.630
> 
> 标签：.net, css, user-controls

是否有任何 .NET 控件可以帮助 CSS 布局，并使其易于快速进行更改 - 可能是动态的。

**更新：**

当我对 CSS 最佳实践进行了更多研究时，我几乎放弃了这个想法。

我决定使用 Yahoo YUI 的 reset css 和 grids css 来获得更容易更改的布局，并且已经在所有 A 级浏览器上进行了全面测试。

[网格的主要链接](http://developer.yahoo.com/yui/grids/)| [示例页面](http://developer.yahoo.com/yui/examples/grids/)| [具有固定列宽的示例](http://developer.yahoo.com/yui/examples/grids/grids-t5.html)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-15T19:45:36.510

我过去使用的是 Telerik 的商业控件[，](http://www.telerik.com/products/aspnet-ajax/splitter.aspx)称为[RadSplitter](http://www.telerik.com)。它不生成 CSS 布局，但允许您将页面划分为任意数量的区域。这些区域甚至可以调整大小或折叠/展开。

# java - 在 Swing 应用程序中组织动作？

> ID：448179
> 
> 赞同：7
> 
> 时间：2009-01-15T19:44:23.173
> 
> 标签：java, swing, code-organization

我当前的应用程序有一个 JFrame，其中大约 15 个操作存储为 JFrame 中的字段。每个动作都是一个匿名类，其中一些很长。

将动作分解成自己的类是否常见，可能在称为动作的子包中？

如果不是，通常如何驯服这种复杂性？

谢谢

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-15T19:59:51.067

如果您的操作可能是可重用的（例如，通过键盘快捷键、其他菜单、其他对话框等），特别是如果它们可以直接在底层模型（而不是 UI）上工作，那么通常会更好不要将它们作为匿名类。

相反，创建一个单独的包，并为每个包创建类。

通常，不直接实例化这些也是有意义的，而是使用某种管理器来定义常量并初始化和返回动作集，以便您可以例如在不同版本中提供不同的动作集或仅设置某些动作用于内部发布。

最后，检查您的操作是否可以重构为类层次结构。它们通常可以，这样可以节省代码复制，还可以帮助您增加健壮性（例如，在让操作执行之前检查某些条件）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-15T19:49:43.990

这就是我通常的做法。每个动作都有自己的类，该类具有对“app”对象的引用，因此它可以获取所需的资源。我通常有一个操作管理器来保存所有操作，因此有一个地方可以访问它们，也有一个地方可以更新它们的启用和内容。

最终这也变得难以管理，此时您应该开始考虑使用应用程序框架，如 Eclipse RCP、NetBeans 框架、JIDE 等。如果您想支持用户定义的键盘映射和类似的东西，尤其如此。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-15T20:34:27.923

我所做的是为动作类创建一个包（实际上是包树），然后根据上下文实例化每个类。几乎我所有的动作类都是抽象的，带有抽象方法来获取上下文（ala Spring）。

```
public abstract class CalcAndShowAction extends AbstractAction {
    //initialization code - setup icons, label, key shortcuts but not context.

    public void actionPerformed(ActionEvent e) {
        //abstract method since it needs ui context
        String data = getDataToCalc();

        //the actual action - implemented in this class, 
        //  along with any user interaction inherent to this action
        String result = calc(data);  

        //abstract method since it needs ui context
        putResultInUI(result);
    }
    //abstract methods, static helpers, etc...
}

//actual usage
//...
button.setAction(new CalcAndShowAction() {
    String getDataToCalc() {
        return textField.getText();
    }

    void putResultInUI(String result) {
        textField.setText(result);
    }
});
//... 
```

（抱歉有任何错误，我是在此文本框中手动编写的，而不是在 IDE 中）。

# java - 使用 JPA/EJB3 进行批量插入

> ID：448181
> 
> 赞同：23
> 
> 时间：2009-01-15T19:45:07.400
> 
> 标签：java, hibernate, orm, jpa, batch-insert

JPA/EJB3 框架是否提供标准方式来执行批量插入操作...？我们使用hibernate作为持久化框架，所以我可以回退到Hibernate Session并使用组合session.save()/session.flush()实现批量插入。但是想知道EJB3是否支持这个......

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2010-09-02T01:26:11.307

JPA 和 Hibernate 都没有为批量插入提供特别的支持，使用 JPA 进行批量插入的习惯用法与使用 Hibernate 相同：

```
EntityManager em = ...;
EntityTransaction tx = em.getTransaction();
tx.begin();

for ( int i=0; i<100000; i++ ) {
    Customer customer = new Customer(.....);
    em.persist(customer);
    if ( i % 20 == 0 ) { //20, same as the JDBC batch size
        //flush a batch of inserts and release memory:
        em.flush();
        em.clear();
    }
}

tx.commit();
session.close(); 
```

在这种情况下使用 Hibernate 的专有 API 不会提供任何优势 IMO。

### 参考

*   JPA 1.0 规范
    *   第 4.10 节“批量更新和删除操作”
*   Hibernate Core 参考指南
    *   [第 13 章批处理](http://docs.jboss.org/hibernate/core/3.3/reference/en/html/batch.html#batch-direct)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-01-15T20:05:04.753

[特别是对于hibernate，核心手册](http://www.hibernate.org/hib_docs/reference/en/html/batch.html)的整个第13章解释了这些方法。

但是您说您希望通过 Hibernate 使用 EJB 方法，因此实体管理器文档在[此处](http://www.hibernate.org/hib_docs/entitymanager/reference/en/html_single/#batch)也有一章。我建议您同时阅读（核心和实体管理器）。

在 EJB 中，它只是关于使用 EJB-QL（有一些限制）。如果您需要更多灵活性，Hibernate 会提供更多机制。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-04-03T05:00:47.620

使用中等记录数，您可以使用这种方式：

```
em.getTransaction().begin();
for (int i = 1; i <= 100000; i++) {
     Point point = new Point(i, i);
     em.persist(point);
     if ((i % 10000) == 0) {
          em.flush();
          em.clear();
     }
}
em.getTransaction().commit(); 
```

但是对于大量记录，您应该在多个事务中执行此任务：

```
em.getTransaction().begin();
for (int i = 1; i <= 1000000; i++) {
      Point point = new Point(i, i);
      em.persist(point);
      if ((i % 10000) == 0) {
          em.getTransaction().commit();
          em.clear();          
          em.getTransaction().begin();
      }
}
em.getTransaction().commit(); 
```

参考：[JPA 批量存储](http://www.objectdb.com/java/jpa/persistence/store#Batch_Store_)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-06T10:27:58.333

是的，如果您希望获得您定义的控制权，您可以回滚到您的 JPA 实现。

JPA 1.0 对 EL-HQL 的支持很丰富，但对 Criteria API 的支持很简单，但是这已在 2.0 中得到解决。

```
Session session = (Session) entityManager.getDelegate();
session.setFlushMode(FlushMode.MANUAL); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-12-13T15:30:43.453

帕斯卡

在您插入 100000 条记录的示例中，它是在单个事务中完成的，因为 commit() 仅在最后被调用。它是否给数据库带来了很大的压力？此外，万一有回滚，成本会太大..

以下方法会更好吗？

```
EntityManager em = ...;
for ( int i=0; i<100000; i++ ) {
   if(!em.getTransaction().isActive()) {
      em.getTransaction().begin();
   }
   Customer customer = new Customer(.....);
   em.persist(customer);
   if ((i+1) % 20 == 0 ) { //20, same as the JDBC batch size
      //flush and commit of inserts and release memory:
      em.getTransaction().commit(); 
      em.clear();
   }
}

session.close(); 
```

# visual-studio - 在 Visual Studio 中匹配右大括号

> ID：448186
> 
> 赞同：17
> 
> 时间：2009-01-15T19:46:57.100
> 
> 标签：visual-studio

Visual Studio 2008 中是否有我可以打开的设置可以为左大括号生成匹配的右大括号？

编辑：我想像 Visual Studio 这样强大的 IDE 会有这个非常有用的功能。

编辑：有没有可以写的宏？从我收到的回复看来，[ReSharper](http://en.wikipedia.org/wiki/ReSharper)是唯一的选择。我不想让我的公司投资 ReSharper 工具，我在一家相当大的企业工作，从采购中获得任何批准都不是一件容易的事。

编辑：我正在使用 VS 2010 Ultimate。Power Tools 和 Power 命令现在可以完成我在这篇文章中寻找的一切。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2010-07-20T09:07:12.703

> *我知道最初的问题是关于 VS2008，但我把它放在这里作为其他人的信息，并使其对最新版本有用*

## VS 2010 和 VS 2012

**Productivity Power Tools**（适用于[VS2010](http://visualstudiogallery.msdn.microsoft.com/d0d33361-18e2-46c0-8ff2-4adea1e34fef)和[VS2012](http://visualstudiogallery.msdn.microsoft.com/3a96a4dc-ba9c-4589-92c5-640e07332afd)）扩展现在支持自动支撑完成。

如果您已经为 VS2010 安装了它，则必须至少更新到 10.0.10710.22 版本。点击

```
Tools -> Extension Manager -> Updates 
```

安装完成后，您可以打开或关闭大括号完成功能，方法是转到

```
Tools -> Options -> Productivity Power Tools -> All Extensions -> Automatic Brace Completion 
```

> *最新版本现在提供了关闭您不喜欢的任何功能的功能，因此您可以根据需要对其进行配置*

## 对比 2013

即使 Visual Studio 2013 也有一个匹配的插件，VS 现在在不使用任何插件的情况下对自动大括号完成提供本机支持。只需前往：

```
Tools -> Options -> Text Editor -> C# 
```

勾选复选框反对**自动大括号完成**

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-15T19:51:25.123

我使用[ReSharper](http://www.jetbrains.com/resharper/)。除了右括号之外，它还有更多功能。唯一的缺点是它不是免费的。但是试一试。无论如何，代码分析是物有所值的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-15T20:13:20.073

大多数时候，您可以使用自动完成和代码片段。

如果要编写 for 循环，只需键入“for”，然后按 TAB。VS 将完成它（包括大括号）。

if、struct、class、switch 也一样……你甚至不必输入第一个大括号！

关于它的好论文：[https ://web.archive.org/web/1/http://blogs.techrepublic%2ecom%2ecom/programming-and-development/?p=655](https://web.archive.org/web/1/http://blogs.techrepublic%2ecom%2ecom/programming-and-development/?p=655)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-23T18:48:00.067

*编辑：谢谢 hyde，[Steven 的回答](https://stackoverflow.com/a/3288454/1123295)似乎是正确的：Microsoft Productivity Power Tools 现在确实有[2012 版本](http://visualstudiogallery.msdn.microsoft.com/3a96a4dc-ba9c-4589-92c5-640e07332afd)。*

原始过时的答案：

Microsoft 生产力工具似乎在 VS 2012 中还不能工作。如果您正在寻找适用于新版本的解决方案，您可以查看此扩展：

[http://visualstudiogallery.msdn.microsoft.com/0e33cb22-d4ac-4f5a-902f-aff5177cc94d](http://visualstudiogallery.msdn.microsoft.com/0e33cb22-d4ac-4f5a-902f-aff5177cc94d)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-10-29T02:35:53.033

在 VS 2013 中，有“自动定界符突出显示”选项（在工具、选项、文本编辑器下），并且在选中该框时应突出显示匹配的大括号，但它不在默认设置下。这是因为默认的背景是白色的，默认的高亮颜色也是白色的。这可以通过转到环境、字体和颜色以及更改“大括号匹配（矩形）”的背景颜色来更改。然后匹配的大括号将突出显示并可见。

在我回答问题是创建支架无法找到现有支架后，我意识到。因为这是我最终来到这里时试图回答的问题，所以我留下答案以防万一。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T20:11:43.897

取决于您要查找的内容 VS 确实有一些标准的自动完成功能 if[tab][tab] 和 for[tab][tab] try[tab][tab]（以及许多其他结构）会给您带来比匹配更多的东西牙套非常漂亮。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-05-19T19:50:38.093

在这里聚会迟到了，但我想你已经使用了一个独立运行的 AutoHotKey 脚本来为你插入右括号/引号。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-06-20T02:51:46.467

如果你不想为 ReSharper 或类似的包付费，我做了一个免费的扩展来自动关闭大括号。您可以在[http://visualstudiogallery.msdn.microsoft.com/en-us/0e33cb22-d4ac-4f5a-902f-aff5177cc94d](http://visualstudiogallery.msdn.microsoft.com/en-us/0e33cb22-d4ac-4f5a-902f-aff5177cc94d)的 Visual Studio 库中找到它。不过，它只适用于 Visual Studio 2010。

# sql-server - NAnt bcp (SQL Server) 任务的成功实现？

> ID：448192
> 
> 赞同：0
> 
> 时间：2009-01-15T19:48:45.490
> 
> 标签：sql-server, nant, bcp, nantcontrib

我正在寻找 SQL Server bcp 的 NAnt 任务或 bcp 本机输出的文件格式。

我想我可以为 bcp 构建一个 NAntContrib 任务，但我现在没有时间（我们曾经吗？）。

以前有人走过这条路吗？建议？

谢谢 - 乔恩

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-15T19:56:17.783

你总是可以使用 NAnt 的[`<exec>`任务](http://nant.sourceforge.net/release/latest/help/tasks/exec.html)来驱动 bcp ......

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T20:40:41.813

bcp 本身没有本机文件输出格式，但可以生成二进制文件，其中字段以包含字段长度的 1-4 字节标头为前缀。标题的长度或行/列分隔符格式在控制文件中指定（格式描述[here](http://msdn.microsoft.com/en-us/library/ms191516.aspx)），

如果使用带前缀的文件，SQL Server bcp 在标头中使用 -1 长度来表示空值。

bcp-speak 中的“Native”是指列数据的二进制表示。 [这个问题](https://stackoverflow.com/questions/2099919/what-are-the-binary-storage-formats-for-sqflt8-sqlmoney-and-other-native-sql-dat)对这些格式进行了一些讨论。

# c# - 未注册的事件处理程序导致内存泄漏

> ID：448197
> 
> 赞同：9
> 
> 时间：2009-01-15T19:50:06.687
> 
> 标签：c#, asp.net, events, idisposable, red-gate-ants

我正在维护一个存在内存泄漏的 Web 应用程序。

根据我使用 Red Gate ANTS 内存分析器的调查，我很确定内存泄漏是由业务层中的事件处理程序引起的。

有一个集合在添加的每个项目上注册一个事件处理程序，以便在项目的日期更改时集合可以重新排序。看来这个事件处理程序是罪魁祸首。

此应用程序的业务层相当复杂，因此将集合及其项保存在内存中会拖累一堆其他对象。

我在集合上实现了 IDisposable 并删除了 Dispose 方法中的事件处理程序：

```
p.OnPunchDateChanged -= this.OnPunchDateChanged; 
```

但是，实现 IDisposable 并没有帮助，因为我无法在 using 或 try/catch 块中包装对集合的所有引用。此集合由我无法控制的应用程序部分使用。

如何清除这些事件处理程序以解决此内存泄漏？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T20:01:39.097

首先，为了证明这一点，尝试将事件的添加和删除记录到一个简单的文本文件中。然后，检查添加与删除的数量。

听起来好像业务逻辑中的某个地方存在一个错误，在所有情况下都没有取消注册事件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-18T14:55:28.290

集合上的 Dispose 方法应由您的代码直接调用，因为该事件包含对集合的引用。您的收藏永远不会被垃圾收集器破坏。

您还应该更改集合的 Remove 和 Clean 方法的行为，以将事件处理程序与已删除的项目分离。

# c# - 使用 GROUP BY 和 COUNT(DISTINCT) 的 LINQ to SQL

> ID：448203
> 
> 赞同：66
> 
> 时间：2009-01-15T19:51:38.713
> 
> 标签：c#, linq, linq-to-sql

我必须执行以下 SQL 查询：

```
select answer_nbr, count(distinct user_nbr)
from tpoll_answer
where poll_nbr = 16
group by answer_nbr 
```

LINQ to SQL 查询

```
from a in tpoll_answer 
where a.poll_nbr = 16 select a.answer_nbr, a.user_nbr distinct 
```

映射到以下 SQL 查询：

```
select distinct answer_nbr, distinct user_nbr
from tpoll_answer
where poll_nbr = 16 
```

到现在为止还挺好。但是，在尝试对结果进行 GROUP 时会出现问题，因为我无法找到映射到我在此处编写的第一个查询的 LINQ to SQL 查询（感谢[LINQPad](http://www.linqpad.net/)使此过程变得更加容易）。以下是我发现的唯一一个给我想要的结果：

```
from answer in tpoll_answer where answer.poll_nbr = 16 _
group by a_id = answer.answer_nbr into votes = count(answer.user_nbr) 
```

这反过来又会产生以下丑陋且根本未优化的 SQL 查询：

```
SELECT [t1].[answer_nbr] AS [a_id], (
    SELECT COUNT(*)
    FROM (
        SELECT CONVERT(Bit,[t2].[user_nbr]) AS [value], [t2].[answer_nbr], [t2].[poll_nbr]
        FROM [TPOLL_ANSWER] AS [t2]
        ) AS [t3]
    WHERE ([t3].[value] = 1) AND ([t1].[answer_nbr] = [t3].[answer_nbr]) AND ([t3].[poll_nbr] = @p0)
    ) AS [votes]
FROM (
    SELECT [t0].[answer_nbr]
    FROM [TPOLL_ANSWER] AS [t0]
    WHERE [t0].[poll_nbr] = @p0
    GROUP BY [t0].[answer_nbr]
    ) AS [t1]
-- @p0: Input Int (Size = 0; Prec = 0; Scale = 0) [16]
-- Context: SqlProvider(Sql2008) Model: AttributedMetaModel Build: 3.5.30729.1 
```

任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：102
> 
> 时间：2009-01-16T09:42:41.187

没有直接支持`COUNT(DISTINCT {x}))`，但您可以从`IGrouping<,>`（即`group by`返回的内容）模拟它；恐怕我只“做” C#，所以你必须翻译成 VB ......

```
 select new
 {
     Foo= grp.Key,
     Bar= grp.Select(x => x.SomeField).Distinct().Count()
 }; 
```

这是一个罗斯文的例子：

```
 using(var ctx = new DataClasses1DataContext())
    {
        ctx.Log = Console.Out; // log TSQL to console
        var qry = from cust in ctx.Customers
                  where cust.CustomerID != ""
                  group cust by cust.Country
                  into grp
                  select new
                  {
                      Country = grp.Key,
                      Count = grp.Select(x => x.City).Distinct().Count()
                  };

        foreach(var row in qry.OrderBy(x=>x.Country))
        {
            Console.WriteLine("{0}: {1}", row.Country, row.Count);
        }
    } 
```

TSQL 不是我们想要的，但它可以完成这项工作：

```
SELECT [t1].[Country], (
    SELECT COUNT(*)
    FROM (
        SELECT DISTINCT [t2].[City]
        FROM [dbo].[Customers] AS [t2]
        WHERE ((([t1].[Country] IS NULL) AND ([t2].[Country] IS NULL)) OR (([t1]
.[Country] IS NOT NULL) AND ([t2].[Country] IS NOT NULL) AND ([t1].[Country] = [
t2].[Country]))) AND ([t2].[CustomerID] <> @p0)
        ) AS [t3]
    ) AS [Count]
FROM (
    SELECT [t0].[Country]
    FROM [dbo].[Customers] AS [t0]
    WHERE [t0].[CustomerID] <> @p0
    GROUP BY [t0].[Country]
    ) AS [t1]
-- @p0: Input NVarChar (Size = 0; Prec = 0; Scale = 0) []
-- Context: SqlProvider(Sql2008) Model: AttributedMetaModel Build: 3.5.30729.1 
```

然而，结果是正确的——可以通过手动运行来验证：

```
 const string sql = @"
SELECT c.Country, COUNT(DISTINCT c.City) AS [Count]
FROM Customers c
WHERE c.CustomerID != ''
GROUP BY c.Country
ORDER BY c.Country";
        var qry2 = ctx.ExecuteQuery<QueryResult>(sql);
        foreach(var row in qry2)
        {
            Console.WriteLine("{0}: {1}", row.Country, row.Count);
        } 
```

有定义：

```
class QueryResult
{
    public string Country { get; set; }
    public int Count { get; set; }
} 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-03-04T21:38:49.090

Marc Gravell 引用的 Northwind 示例可以重写为由 group 语句直接选择的 City 列：

```
from cust in ctx.Customers
where cust.CustomerID != ""
group cust.City /*here*/ by cust.Country
into grp
select new
{
        Country = grp.Key,
        Count = grp.Distinct().Count()
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-16T08:31:04.607

Linq to sql 不支持 Count(Distinct ...)。因此，您必须将代码中的 .NET 方法映射到 Sql 服务器函数（因此是 Count(distinct.. )）并使用它。

顺便说一句，如果您以既不是 VB.NET 也不是 C# 的格式发布从工具包复制的伪代码，这将无济于事。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-16T08:58:08.563

这就是您执行不同计数查询的方式。请注意，您必须过滤掉空值。

```
var useranswercount = (from a in tpoll_answer
where user_nbr != null && answer_nbr != null
select user_nbr).Distinct().Count(); 
```

如果你将它与你当前的分组代码结合起来，我想你会有你的解决方案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-25T11:09:35.183

group by 如何在 LINQ 中工作的简单而干净的示例

[http://www.a2zmenu.com/LINQ/LINQ-to-SQL-Group-By-Operator.aspx](http://www.a2zmenu.com/LINQ/LINQ-to-SQL-Group-By-Operator.aspx)

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2016-06-23T15:01:01.267

我不会费心在 Linq2SQL 中这样做。为您想要并理解的查询创建一个存储过程，然后在框架中为存储过程创建对象，或者直接连接到它。

# spring-security - 使用 Acegi/Spring Security 创建自定义身份验证

> ID：448204
> 
> 赞同：21
> 
> 时间：2009-01-15T19:51:47.527
> 
> 标签：spring-security

我无法准确地发现我需要实现什么才能使用 Spring Security 在我的 Web 应用程序中使用自定义身份验证方法。我有一个带有 Spring Security 插件的 Grails 应用程序，该插件当前使用标准用户/密码身份验证和浏览器表单。这工作正常。

我需要实现一种机制来实现一种[MAC](http://en.wikipedia.org/wiki/Message_authentication_code)身份验证。如果 HTTP 请求包含多个参数（例如用户标识符、时间戳、签名等），我需要获取这些参数，执行一些散列和签名/时间戳比较，然后对用户进行身份验证。

我不是 100% 确定从哪里开始。我需要扩展/实现哪些 Spring Security 类？我已经阅读了[参考文档](http://www.acegisecurity.org/guide/springsecurity.html)并且对这些概念有一个很好的理解，但我不确定我是否需要过滤器、提供者或管理器，或者在哪里/如何准确地创建[身份验证](http://static.springframework.org/spring-security/site/apidocs/org/springframework/security/Authentication.html)对象。我一直在尝试扩展[AbstractProcessingFilter](http://static.springframework.org/spring-security/site/apidocs/org/springframework/security/ui/AbstractProcessingFilter.html)和/或实现[AuthenticationProvider](http://static.springframework.org/spring-security/site/apidocs/org/springframework/security/providers/AuthenticationProvider.html)，但我只是理解如何让它们都玩得很好。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-04-10T11:37:31.453

1.  实现一个自定义`AuthenticationProvider`，从`Authentication`: `getCredentials()`、`getDetails()`和`getPrincipal()`.

    使用以下配置片段将其绑定到您的 Spring Security 身份验证机制中：

```
<bean id="myAuthenticationProvider" class="com.example.MyAuthenticationProvider">
    <security:custom-authentication-provider />
</bean> 
```

2.  如果您可以从标准实现中找到合适的步骤，则此步骤是可选的。如果没有，请实现一个扩展`Authentication`接口的类，您可以在其上放置身份验证参数：

    ```
    (e.g. a user identifier, timestamp, signature, etc.) 
    ```

3.  扩展一个`SpringSecurityFilter`将上述两个类联系在一起的自定义。例如，过滤器可能会使用您的实现作为输入来获取`AuthenticationManager`和调用。`authenticate()``Authentication`

    您可以扩展[AbstractAuthenticationProcessingFilter](https://fisheye.springsource.org/browse/~tag=3.0.5.RELEASE/spring-security/web/src/main/java/org/springframework/security/web/authentication/AbstractAuthenticationProcessingFilter.java?r=6ac858814407cee65e3c30779cb271ecaf3abd19)作为开始。

    您可以参考扩展的[UsernamePasswordAuthenticationFilter](https://fisheye.springsource.org/browse/~tag=3.0.5.RELEASE/spring-security/web/src/main/java/org/springframework/security/web/authentication/UsernamePasswordAuthenticationFilter.java?hb=true)`AbstractAuthenticationProcessingFilter`。`UsernamePasswordAuthenticationFilter`实现标准的用户名/密码认证。

4.  配置您的 Spring Security 以添加或替换标准`AUTHENTICATION_PROCESSING_FILTER`. 有关 Spring Security 过滤器的订单，请参阅[http://static.springsource.org/spring-security/site/docs/3.0.x/reference/ns-config.html#filter-stack](http://static.springsource.org/spring-security/site/docs/3.0.x/reference/ns-config.html#filter-stack)

    以下是如何用您的实现替换它的配置片段：

```
<beans:bean id="myFilter" class="com.example.MyAuthenticationFilter">
    <custom-filter position="AUTHENTICATION_PROCESSING_FILTER"/>
</beans:bean> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-18T08:44:52.200

下面是一个使用自定义 autenticationFilter（扩展 AUTHENTICATION_PROCESSING_FILTER）和 authenticationProvider 的 securityContext.xml 配置文件示例。用户认证数据由 jdbc 连接提供。配置适用于 Spring Security 2.0.x

```
<?xml version="1.0" encoding="UTF-8"?>

 <sec:global-method-security />

 <sec:http auto-config="false" realm="CUSTOM" create-session="always" servlet-api-provision="true"
  entry-point-ref="authenticationProcessingFilterEntryPoint" access-denied-page="/notauthorized.xhtml"
  session-fixation-protection="migrateSession">
  <sec:port-mappings>
   <sec:port-mapping http="80" https="443" />
  </sec:port-mappings>

  <sec:anonymous granted-authority="ROLE_ANONYMOUS" username="Anonymous" />
  <sec:intercept-url pattern="/**" access="ROLE_ANONYMOUS, ROLE_USER" />

  <sec:logout logout-url="/logoff" logout-success-url="/home.xhtml" invalidate-session="false" />

 </sec:http>

 <bean id="authenticationProcessingFilterEntryPoint" class="org.springframework.security.ui.webapp.AuthenticationProcessingFilterEntryPoint">
  <property name="loginFormUrl" value="/login.xhtml" />
  <property name="forceHttps" value="false" />
 </bean>

 <bean id="authenticationProcessingFilter" class="mypackage.CustomAuthenticationProcessingFilter">
  <sec:custom-filter position="AUTHENTICATION_PROCESSING_FILTER" />
  <property name="defaultTargetUrl" value="/" />
  <property name="filterProcessesUrl" value="/logon" />
  <property name="authenticationFailureUrl" value="/loginError.xhtml" />
  <property name="alwaysUseDefaultTargetUrl" value="false" />
  <property name="authenticationManager" ref="authenticationManager" />
 </bean>

 <jee:jndi-lookup id="securityDataSource" jndi-name="jdbc/DB_DS" /> 

 <bean id="myUserDetailsService" class="mypackage.CustomJdbcDaoImpl">
  <property name="dataSource" ref="securityDataSource" />
  <property name="rolePrefix" value="ROLE_" />
 </bean>

 <bean id="apcAuthenticationProvider" class="mypackage.CustomDaoAuthenticationProvider">
  <property name="userDetailsService" ref="myUserDetailsService" />
  <sec:custom-authentication-provider />
 </bean>

 <bean id="authenticationManager" class="org.springframework.security.providers.ProviderManager">
  <property name="providers">
   <list>
    <ref local="apcAuthenticationProvider" />
   </list>
  </property>
 </bean>

</beans> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-19T00:52:35.533

我最近提出了一个使用 Spring Security 3 进行自定义身份验证的示例应用程序。源代码在[这里](http://code.google.com/p/tinywebgears-samples/source/browse/trunk/customauth/)。更多细节在[这篇博文](http://beansgocrazy.blogspot.com/2011/07/custom-authentication-with-spring.html)中。

# c# - 检测字符串是否全部大写

> ID：448206
> 
> 赞同：66
> 
> 时间：2009-01-15T19:52:05.810
> 
> 标签：c#, string

在 C# 中有没有办法检测字符串是否全部大写？

大多数字符串都很短（即少于 100 个字符）

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-01-15T19:55:36.567

无需创建新字符串：

```
bool IsAllUpper(string input)
{
    for (int i = 0; i < input.Length; i++)
    {
        if (!Char.IsUpper(input[i]))
             return false;
    }

    return true;
} 
```

**编辑：**如果您想跳过非字母字符（*OP 的原始实现没有，但他/她的评论表明他们可能想要*）：

```
 bool IsAllUpper(string input)
    {
        for (int i = 0; i < input.Length; i++)
        {
            if (Char.IsLetter(input[i]) && !Char.IsUpper(input[i]))
                return false;
        }
        return true;
    } 
```

* * *

## 回答 #2

> 赞同：93
> 
> 时间：2009-01-15T20:06:34.610

我喜欢 LINQ 方法。

如果您想将其限制为*所有大写字母*（即没有空格等）：

```
return input.All(c => char.IsUpper(c)); 
```

或使用方法组转换：

```
return input.All(char.IsUpper); 
```

如果您只想禁止小写字母：

```
return !input.Any(c => char.IsLower(c)); 
```

或者

```
return !input.Any(char.IsLower); 
```

* * *

## 回答 #3

> 赞同：60
> 
> 时间：2009-01-15T19:53:57.553

简单的？

```
if (input.ToUpper() == input)
{
    // string is all upper
} 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-01-16T10:26:47.697

确保您的大写定义与 .Nets 的大写定义相匹配。

.Net 中的 ToUpper() 是一种语言操作。在某些语言中，大小写规则并不直接。[土耳其语 I 以此而闻名](http://en.wikipedia.org/wiki/Turkish_dotted_and_dotless_I)。

```
// Meaning of ToUpper is linguistic and depends on what locale this executes
// This test could pass or fail in ways that surprise you.
if (input.ToUpper() == input) 
{
    // string is all upper
} 
```

你可以使用

```
// Meaning of ToUpper is basically 'ASCII' ToUpper no matter the locale.
if (input.ToUpper(CultureInfo.InvariantCulture) == input) 
{
    // string is all upper
} 
```

您可能会想通过字符大写来节省内存

[MSDN 对此提出警告](http://msdn.microsoft.com/en-us/library/aa292134.aspx#vxconlanguageissuesanchorcapitalizationuppercasingandlowercasing)

```
for(int i = 0; i < input.Length; i++) {
   if(input[i] != Char.ToUpper(input[i], CultureInfo.InvariantCulture)) {
     return false;
   }
} 
```

上面的代码引入了一个错误。一些非英语“字母”需要两个 .net 字符来编码（代理对）。您必须检测这些对并将它们大写为一个单元。

此外，如果您省略文化信息以获取语言大写，您将引入一个错误，在某些语言环境中，您的自制大写算法与该语言环境的 .net 算法不一致。

当然，如果您的代码永远不会在英语语言环境之外运行或永远不会收到非英语文本，那么这些都不重要。

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-01-15T19:54:16.523

采用

```
if (input == input.ToUpper()) 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-01-15T19:53:49.393

我会将字符串转换为全部大写（使用`ToUpper`），然后将其与原始字符串（使用 ）进行比较`Equals`。应该可以在一行代码中实现。

`return s.Equals(s.ToUpper())`

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-01-15T19:57:02.913

如果这需要有良好的性能，我假设它发生了很多。如果是这样，请采用您的解决方案并执行几百万次并计时。我怀疑你所拥有的比其他解决方案更好，因为你没有创建一个必须清理的新垃圾收集对象，而且你不能在不迭代字符串的情况下复制它。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2018-10-31T20:11:26.427

您还可以调用 Windows 函数来告诉您字符串的构成。

```
GetStringTypeEx(LOCALE_USER_DEFAULT, CT_CTYPE1, s, s.Length, ref characterTypes); 
```

您为它提供一个`UInt16`与字符串长度相同的数组，并用标志的按位组合填充每个元素：

*   `C1_UPPER`(0x0001): 大写
*   `C1_LOWER`(0x0002): 小写
*   `C1_DIGIT`(0x0004)：十进制数字
*   `C1_SPACE`(0x0008): 空格字符
*   `C1_PUNCT`(0x0010): 标点符号
*   `C1_CNTRL`(0x0020): 控制字符
*   `C1_BLANK`(0x0040): 空白字符
*   `C1_XDIGIT`(0x0080): 十六进制数字
*   `C1_ALPHA`(0x0100)：任何语言字符：字母、音节或表意。有些字符可以是字母而不是大写或小写
*   `C1_DEFINED`(0x0200)：定义的字符，但不是其他 C1_* 类型之一

因此，如果您检查了字符串：

> 你好，“42”！

你会得到结果

> [0x210, 0x301, 0x382, 0x302, 0x302, 0x302, 0x210, 0x248, 0x210, 0x284, 0x284, 0x210, 0x210]

分解为：

```
|            | H | e | l | l | o | , |   | " | 4 | 2 | " | ! |
|------------|---|---|---|---|---|---|---|---|---|---|---|---|
| Defined    | X | X | X | X | X | X | X | X | X | X | X | X |
| Alpha      | x | x | x | x | x |   |   |   |   |   |   |   |
| XDigit     |   | x |   |   |   |   |   |   | x | x |   |   |
| Blank      |   |   |   |   |   |   | x |   |   |   |   |   |
| Cntrl      |   |   |   |   |   |   |   |   |   |   |   |   |
| Punct      |   |   |   |   |   | x |   |   |   |   | x | x |
| Space      |   |   |   |   |   |   | x |   |   |   |   |   |
| Digit      |   |   |   |   |   |   |   |   | x | x |   |   |
| Lower      |   | x | x | x | x |   |   |   |   |   |   |   |
| Upper      | x |   |   |   |   |   |   |   |   |   |   |   | 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-08-02T22:06:15.280

另一种方法

```
return input.Equals(input.ToUpper(), StringComparison.Ordinal) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-15T19:58:25.203

我认为以下几点：

```
bool equals = (String.Compare(input, input.ToUpper(), StringComparison.Ordinal) == 0) 
```

也可以工作，您可以确保在不考虑字符串大小写的情况下进行比较（我认为 VB.NET 默认情况下会忽略大小写）。O 甚至使用`String.CompareOrdinal(input, input.ToUpper())`.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-15T20:16:30.597

正则表达式浮现在脑海。在那里找到了这个：[http ://en.csharp-online.net/Check_if_all_upper_case_string](http://en.csharp-online.net/Check_if_all_upper_case_string)

# python - Python - 通过 HTTP 下载带有进度条和基本身份验证的文件

> ID：448207
> 
> 赞同：8
> 
> 时间：2009-01-15T19:52:18.260
> 
> 标签：python, http, download

我`urllib.urlretrieve`用于下载文件，并使用参数实现下载进度条`reporthook`。由于`urlretrieve`不直接支持身份验证，我想出了

```
import urllib

def urlretrieve_with_basic_auth(url, filename=None, reporthook=None, data=None,
                                username="", password=""):
    class OpenerWithAuth(urllib.FancyURLopener):
        def prompt_user_passwd(self, host, realm):
            return username, password

    return OpenerWithAuth().retrieve(url, filename, reporthook, data) 
```

这行得通——但似乎有更直接的方法可以做到这一点（可能使用 urllib2 或 httplib2 或......）——有什么想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-15T20:12:47.360

[urlgrabber](http://urlgrabber.baseurl.org/)内置了对进度条、身份验证等的支持。

# performance - 将变量同时更新为相同值的线程安全

> ID：448224
> 
> 赞同：1
> 
> 时间：2009-01-15T19:55:22.217
> 
> 标签：performance, multithreading, concurrency, thread-safety

以下构造是否是线程安全的，假设 foo 的元素已正确对齐和调整大小以便没有单词撕裂？如果不是，为什么不呢？

注意：下面的代码是我想做的一个玩具示例，而不是我实际的现实世界场景。显然，在我的示例中，有更好的编码可观察行为的方法。

```
uint[] foo;
// Fill foo with data.

// In thread one:
for(uint i = 0; i < foo.length; i++) {
     if(foo[i] < SOME_NUMBER) {
         foo[i] = MAGIC_VAL;
     }
}

// In thread two:
for(uint i = 0; i < foo.length; i++) {
     if(foo[i] < SOME_OTHER_NUMBER) {
         foo[i] = MAGIC_VAL;
     }
} 
```

乍一看，这显然不安全，所以我将强调为什么我认为它可能是安全的：

1.  仅有的两个选项是 foo 的元素保持不变或设置为 MAGIC_VAL。
2.  如果线程二在更新时看到 foo[i] 处于中间状态，那么只会发生两件事：中间状态是 <`SOME_OTHER_NUMBER`或者不是。如果是 < `SOME_OTHER_NUMBER`，线程二也会尝试将其设置为 MAGIC_VAL。如果没有，线程二将什么也不做。

编辑：另外，如果 foo 是 long 或 double 什么的，那么更新它就不能自动完成？您仍然可以假设对齐等是这样的，即更新 foo 的一个元素不会影响任何其他元素。此外，在这种情况下，多线程的重点是性能，因此任何类型的锁定都会破坏这一点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T20:35:06.457

在现代多核处理器上，您的代码在没有内存屏障的情况下不是线程安全的（至少在大多数语言中）。简而言之，如果没有明确的障碍，每个线程都可以从缓存中看到 foo 的完全不同的副本。

假设您的两个线程在某个时间点运行，然后在稍后某个时间点第三个线程读取 foo，它可能会看到一个完全未初始化的 foo，或者其他两个线程中的任何一个的 foo，或者混合两者都取决于 CPU 内存缓存的情况。

我的建议 - 不要试图在并发方面“聪明”，始终尝试“安全”。Smart每次都会咬你。破碎的[双重检查锁定](http://www.cs.umd.edu/~pugh/java/memoryModel/DoubleCheckedLocking.html)文章对在没有内存障碍的情况下内存访问和指令重新排序可能发生的情况有一些令人大开眼界的见解（尽管特别是关于 Java 及其（不断变化的）内存模型，它对任何语言都很有见地）。

您必须真正掌握语言指定的内存模型才能使用快捷方式。例如，Java 允许将变量标记为 volatile，它与记录为具有原子分配的类型相结合，可以通过强制它们进入主内存来允许非同步分配和获取（因此线程不会观察/更新缓存副本） .

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T20:34:19.657

您可以通过比较和交换操作安全且无锁定地执行此操作。您所拥有的*看起来*是线程安全的，但编译器可能会在某些情况下创建未更改值的写回，这将导致一个线程踩到另一个线程。

此外，这样做可能不会获得您想象的那么高的性能，因为像这样让两个线程写入相同的连续内存会导致CPU 缓存内的[MESI 转换](http://en.wikipedia.org/wiki/MESI_protocol)风暴，每个都非常慢。有关多线程内存一致性的更多详细信息，您可以查看 Ulrich Drepper 的“ [What Every Programmer Should Know About Memory](http://people.redhat.com/drepper/cpumemory.pdf) ”的第 3.3.4 节。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T20:01:08.710

如果对每个数组元素的读写都是原子的（即它们正确对齐，没有你提到的单词撕裂），那么这段代码应该没有任何问题。如果`foo[i]`小于`SOME_NUMBER`或中的任何`SOME_OTHER_NUMBER`一个，则至少一个线程（可能两者）将`MAGIC_VAL`在某个点将其设置为；否则，它将保持不变。使用原子读写，没有其他可能性。

但是，由于您的情况更复杂，所以要非常小心——确保`foo[i]`每个循环只读取一次并存储在局部变量中。如果您在同一迭代中多次阅读它，您可能会得到不一致的结果。即使您对代码进行最轻微的更改也可能立即使其在竞争条件下变得不安全，因此请对带有大红色警告标志的代码进行大量评论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T20:02:14.293

这是不好的做法，无论后果如何，您都不应该处于两个线程同时访问同一个变量的状态。您给出的示例过于简化，任何大多数复杂的示例几乎总是会出现与之相关的问题.. ...

记住：**信号量**是你的朋友！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-15T20:04:16.190

该特定示例是线程安全的。

这里没有真正涉及中间状态。该特定程序不会混淆。

不过，我建议在阵列上使用**互斥锁。**

# asp.net - ASP .NET 和 IIS

> ID：448230
> 
> 赞同：1
> 
> 时间：2009-01-15T19:56:47.453
> 
> 标签：asp.net, visual-studio, iis

与我一起工作的大多数开发人员都通过从 Visual Studio 运行它们来测试他们的 Web 应用程序，并使用 VS 的内置 Web 服务器来显示页面。我的问题是，当这些应用程序部署到 IIS 服务器时，它们的行为会有什么不同吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T20:02:41.280

您的应用程序可能表现不同的一个领域是安全领域。因为内置的 Web 服务器在您的身份下有效运行（即您可以作为管理员用户运行），所以当您部署到生产环境时，您的应用程序的生活可能会非常不同。

[请参阅Dominick Baier](http://www.leastprivilege.com/default.aspx)的这篇文章：

[http://www.leastprivilege.com/CassiniConsideredHarmful.aspx](http://www.leastprivilege.com/CassiniConsideredHarmful.aspx)

# unit-testing - 单元测试和 Web 应用程序 - 资源

> ID：448231
> 
> 赞同：0
> 
> 时间：2009-01-15T19:56:49.343
> 
> 标签：unit-testing, testing, web-applications, integration-testing

在 J2EE Web 应用程序中，人们如何管理资源以便它们对 Web 上下文和单元/集成测试都是可见的？

我发现你经常在开发过程中以某种方式配置你的源/资源文件夹（即，Maven 所期望的），因此你的单元测试将在你的 IDE 中运行。但是一旦 Web 应用程序被构建并打包到 WAR 文件中（即，当您的持续集成服务器完成构建时）您的单元测试将不再运行，因为资源位于其他位置。

您是否最终将资源保存在两个不同的地方并手动保持它们同步？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T22:34:52.987

我们尝试在容器中使用单元测试，但几年前就放弃了。最好（至少对我们来说）让每个单元测试只覆盖一个类，而不是别的，模拟出对其他类的依赖（参见[JMock](http://www.jmock.org/)或其许多竞争对手）。一个好的基本规则是，如果它涉及数据库、网络或文件系统，它就不是单元测试。（它可能对其他东西有用，但它不是单元测试。有关更多信息，请参阅[这些单元测试规则](http://www.artima.com/weblogs/viewpost.jsp?thread=126923)。）

以这种方式编写的单元测试可以在任何地方运行，而且速度极快（我们有数千个单元测试，在中等规格的硬件上运行时间不到 60 秒。）

您可能还想运行检查子系统或整个应用程序的集成测试。我们发现子系统测试也可以在其边界使用模拟——例如，我们伪造一个外部定价提要——并且端到端测试最适合使用[Selenium](http://seleniumhq.org/)或[WebDriver](http://code.google.com/p/webdriver/)等工具，这些工具可以让您在服务器上部署整个应用程序然后像用户一样用浏览器点击它。

（顺便说一句，在[Martin Fowler 的分类法中，我们的单元测试方法使我们](http://martinfowler.com/articles/mocksArentStubs.html)*成为模仿者，*而不是*古典主义者*。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T20:48:39.737

通常这是多模块构建的原因。外部服务位于与 Web 应用程序不同的构建单元中。因此，您在构建该模块时构建、打包和运行集成测试。

另一个模块可以包含您的域模型及其单元测试，它们也在构建时运行。

导致 WAR 的模块中根本没有任何 Java 代码，而只有与 Web 相关的工件，这是很常见的。虽然没有必要，但通常这样做是因为 war 模块中的代码不能包含到另一个模块中。

最后一个特殊情况是包含 web-tests 的模块。这个模块可能经常需要来自其他模块的测试范围的工件（因为它是从外部测试应用程序，但可能需要来自内部的数据）。这可以通过将测试资源打包到 jar 文件中来解决，为每个模块创建一组单独的“测试”jar 文件。

多模块构建是 maven 项目的标准，也很容易为其他构建系统（如 ant）设置。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T20:22:27.620

我不会在 WAR 文件中打包测试资源或测试，也不会从 WAR 运行单元测试。你为什么要这样做？

# java - Websphere Spring Hibernate Oracle 的缓存模型/框架是什么？

> ID：448246
> 
> 赞同：3
> 
> 时间：2009-01-15T19:59:36.293
> 
> 标签：java, hibernate, spring, caching, websphere

我们正在考虑为我们的应用程序实现一个缓存框架，以帮助提高我们网站的整体性能。

我们在 Websphere 6.1、Spring、Hibernate 和 Oracle 上运行。当前的重点是静态数据或在一天中变化很小但被大量使用的数据。

所以任何信息都会很棒。我已经开始了我的谷歌搜索和阅读，但想了解对社区成员有用的东西。我们感兴趣的一件事是，当下划线数据发生更改时，让系统使缓存失效的能力。

谢谢

更新：

我在 IBM 网站上看到一篇文章，其中说 Hibernate 的集群感知缓存与 WebSphere Application Server 的结合尚未确定。因此，尚未确定是否支持它们的使用。

对此有什么想法？我们在集群环境中运行。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T20:18:55.570

那么休眠缓存系统就是这样做的，我在[休眠（和二级缓存系统）](http://www.hibernate.org/hib_docs/reference/en/html/performance-cache.html)中有效且轻松地使用了[ehCache](http://ehcache.sourceforge.net/)。

[Lucene](http://lucene.apache.org/)也可能是一种选择，具体取决于具体情况。[Hibernate Search](http://search.hibernate.org/)或[Compass](http://www.compass-project.org/)可以帮助解决这个问题（尽管可能需要一些主要工作）。

尽管我从未这样做过，但使用[Terracotta](http://www.terracotta.org/)进行复制也是一种选择。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T20:20:11.930

Hibernate 内置了一级和二级缓存。您可以将其配置为使用 EhCache、OSCache、SwarmCache 或 C3P0——您的选择。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T00:38:33.223

您还可以利用 WebSphere 的默认缓存（即 DynaCache）来实现二级缓存。这将允许您利用 WebSphere 缓存基础设施来管理、监控和配置您的缓存

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T20:31:13.563

我使用了 ehCache 和 OSCache，发现 OSCache 更易于配置和使用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-02T16:34:42.407

> 我们感兴趣的一件事是，当下划线数据发生更改时，让系统使缓存失效的能力。

据我所见，Hibernate 实际上并没有执行上述操作——来自[Hibernate 的文档](http://www.hibernate.org/hib_docs/reference/en/html/performance-cache.html)：

> 当心。缓存永远不会知道另一个应用程序对持久存储所做的更改（尽管它们可能被配置为定期使缓存数据过期）。

显然，这意味着缓存没有 ESP，并且无法判断不在集群中的应用程序是否在数据库上调用了直接 DML - 但我猜你想要的是公开服务的能力旧版应用程序在更新该数据时挂钩并使缓存无效。而且，据我所知，没有关于如何做到这一点的建议。

# speech-recognition - 我可以在 Windows Server 2003 中使用 Vista 语音 API 吗？

> ID：448252
> 
> 赞同：0
> 
> 时间：2009-01-15T20:01:42.547
> 
> 标签：speech-recognition

我在 iphone 上编写了一个小应用程序，它将 30 秒的语音传输到通过远程处理调用 Windows 服务的网络服务器，该服务使用 Windows 2003 服务器上的 SAPI5.1 通过默认识别器将波形转换为文本。

我想将引擎更新到最新版本，并添加一个创建用于在 Vista 中运行的医疗语音模型。我可以通过 Windows 2003 服务器和 .net 3.5 库中编写的应用程序来做到这一点。无论如何，Vista 是否只使用 3.5 .net 库。我可以通过注册表或 api 调用更改语音模型吗，我知道在 vista 上使用语音模型你必须在语音识别下更改注册表项，

有任何想法吗？谢谢，汤姆

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T20:25:03.870

简短的回答是否定的，您需要坚持使用 sappi 5.1 如果您升级到 server 2008，您可能会使用 vista 特定的语音识别功能。你应该能够在 ..net 3.5 中使用 sappi 应用程序编程接口，我知道它可以与 .net 3.0 框架一起使用。有关可用的不同 sdk 的更多信息，请参阅此链接。[http://en.wikipedia.org/wiki/Speech_Application_Programming_Interface](http://en.wikipedia.org/wiki/Speech_Application_Programming_Interface)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-03-22T15:08:49.277

Microsoft 提供了一个免费下载的服务器识别器。请参阅[http://www.microsoft.com/downloads/en/details.aspx?FamilyID=1b1604d3-4f66-4241-9a21-90a294a5c9a4](http://www.microsoft.com/downloads/en/details.aspx?FamilyID=1b1604d3-4f66-4241-9a21-90a294a5c9a4)

请参阅[System.Speech.Recognition 和 Microsoft.Speech.Recognition 有什么区别？](https://stackoverflow.com/questions/2977338/what-is-the-difference-between-system-speech-recognition-and-microsoft-speech-rec/2998963#2998963)了解更多信息。

# java - 如何将战争文件的更新推送给客户端？

> ID：448254
> 
> 赞同：2
> 
> 时间：2009-01-15T20:01:52.717
> 
> 标签：java, web-applications, jakarta-ee

假设我的客户正在他们的 Intranet 上运行我的 J2EE WAR 应用程序，并且我为他们提供了更新……如何将更新后的 war 文件推送给他们？

我希望它是自动的，并且不需要客户端的人工交互。

这可以做到吗？

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T20:24:37.320

Tomcat（如果这是您的目标容器...）提供了一个管理器界面，允许您部署/启动/停止应用程序。

我已经使用 ant 和 maven 任务在远程部署战争方面取得了很好的效果，同时内置到构建过程中。

根据您的部署过程，这可能不适合您，但对于 dev & qa：强烈推荐。

编辑：当然，必须配置 apache 才能允许这种类型的访问。

请参阅：[部署程序操作方法](http://tomcat.apache.org/tomcat-6.0-doc/deployer-howto.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T21:00:53.457

[Glassfish 在此处](http://docs.sun.com/app/docs/doc/820-4502/beaeb?a=view)有关于部署的文档。

Ant 任务也可[在此处](http://docs.sun.com/app/docs/doc/819-2556/beaeq?l=en&q=ant+task&a=view)获得。

Glassfish 在内部使用 Tomcat，但 Tomcat 管理器不可用，因为它是一个单独的应用程序。

如果可以访问 glassfish 管理控制台，则可以使用它来上传和部署 war 文件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T20:25:15.867

我不确定您是否愿意让他们访问您的源代码存储库……即使在只读模式下也是如此。

如果是，那么您可以在 ANT 中编写脚本以检查最新版本的源代码（使用 CVS 任务），然后构建 .war 文件（使用 WAR 任务）。

唯一的技巧是在战争建立后自动部署它。Tomcat 会自动部署复制到某个目录的应用程序。对于 Websphere，请参阅[这个问题](https://stackoverflow.com/questions/4046/can-someone-give-me-a-working-example-of-a-buildxml-for-an-ear-that-deploys-in)和[这个问题](https://stackoverflow.com/questions/57291/is-there-a-simpler-way-to-deploy-to-websphere)。

对于其他 J2EE 服务器，我不知道该怎么做。

# java - 在基类构造函数中调用虚方法

> ID：448258
> 
> 赞同：32
> 
> 时间：2009-01-15T20:03:52.027
> 
> 标签：java, c#, c++, constructor

我知道从基类构造函数调用虚拟方法可能很危险，因为子类可能不处于有效状态。（至少在 C# 中）

我的问题是，如果虚拟方法是初始化对象状态的方法呢？这是一种好的做法还是应该是一个两步过程，首先创建对象然后加载状态？

第一个选项：（使用构造函数初始化状态）

```
public class BaseObject {
    public BaseObject(XElement definition) {
        this.LoadState(definition);
    }

    protected abstract LoadState(XElement definition);
} 
```

第二种选择：（使用两步过程）

```
public class BaseObject {
    public void LoadState(XElement definition) {
        this.LoadStateCore(definition);
    }

    protected abstract LoadStateCore(XElement definition);
} 
```

在第一种方法中，代码的使用者可以使用一条语句创建和初始化对象：

```
// The base class will call the virtual method to load the state.
ChildObject o = new ChildObject(definition) 
```

在第二种方法中，消费者必须创建对象然后加载状态：

```
ChildObject o = new ChildObject();
o.LoadState(definition); 
```

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-01-15T20:10:39.267

（这个答案适用于 C# 和 Java。我相信 C++ 在这个问题上的工作方式不同。）

在构造函数中调用虚方法确实很危险，但有时它会以最干净的代码结束。

我会尽可能地避免它，但不会*极大*地弯曲设计。（例如，“稍后初始化”选项禁止不变性。）如果您*确实*在构造函数中使用了虚拟方法，请*非常*详细地记录它。只要涉及的每个人都知道它在做什么，它就不应该引起*太多*问题。不过，正如您在第一个示例中所做的那样，我会尝试限制可见性。

编辑：这里重要的一件事是 C# 和 Java 在初始化顺序上有所不同。如果你有一个类，例如：

```
public class Child : Parent
{
    private int foo = 10;

    protected override void ShowFoo()
    {
        Console.WriteLine(foo);
    }
} 
```

在`Parent`构造函数调用的地方`ShowFoo`，在 C# 中它将显示 10。Java 中的等效程序将显示 0。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-01-15T20:18:50.653

在 C++ 中，在基类构造函数中调用虚方法将简单地调用该方法，就好像派生类还不存在（因为它不存在）。所以这意味着调用在编译时被解析为它应该在基类（或它派生的类）中调用的任何方法。

使用 GCC 测试，它允许您从构造函数调用纯虚函数，但它会发出警告，并导致链接时间错误。标准似乎未定义此行为：

“可以从抽象类的构造函数（或析构函数）调用成员函数；直接或间接地对纯虚函数进行虚拟调用（ *class.virtual* ）的效果是从这样的对象创建（或销毁）的对象构造函数（或析构函数）未定义。”

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-15T20:19:27.067

在 C++ 中，虚拟方法通过正在构建的类的 vtable 进行路由。因此，在您的示例中，它将生成一个纯虚拟方法异常，因为在构造 BaseObject 时根本没有要调用的 LoadStateCore 方法。

如果函数不是抽象的，只是什么都不做，那么你经常会让程序员摸不着头脑，试图记住为什么函数实际上没有被调用。

出于这个原因，你根本不能在 C++ 中这样做......

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-15T22:33:28.853

对于 C++，基构造函数在派生构造函数之前调用，这意味着虚拟表（保存派生类的重写虚函数的地址）尚不存在。出于这个原因，这被认为是一件非常危险的事情（特别是如果函数在基类中是纯虚拟的……这将导致纯虚拟异常）。

有两种方法可以解决这个问题：

1.  做一个构造+初始化的两步过程
2.  将虚函数移动到可以更紧密控制的内部类中（可以使用上述方法，详见示例）

(1) 的一个例子是：

```
class base
{
public:
    base()
    {
      // only initialize base's members
    }

    virtual ~base()
    {
      // only release base's members
    }

    virtual bool initialize(/* whatever goes here */) = 0;
};

class derived : public base
{
public:
    derived ()
    {
      // only initialize derived 's members
    }

    virtual ~derived ()
    {
      // only release derived 's members
    }

    virtual bool initialize(/* whatever goes here */)
    {
      // do your further initialization here
      // return success/failure
    }
}; 
```

(2) 的一个例子是：

```
class accessible
{
private:
    class accessible_impl
    {
    protected:
        accessible_impl()
        {
          // only initialize accessible_impl's members
        }

    public:
        static accessible_impl* create_impl(/* params for this factory func */);

        virtual ~accessible_impl()
        {
          // only release accessible_impl's members
        }

        virtual bool initialize(/* whatever goes here */) = 0;
    };

    accessible_impl* m_impl;

public:
    accessible()
    {
        m_impl = accessible_impl::create_impl(/* params to determine the exact type needed */);

        if (m_impl)
        {
            m_impl->initialize(/* ... */);  // add any initialization checking you need
        }
    }

    virtual ~accessible()
    {
        if (m_impl)
        {
            delete m_impl;
        }
    }

    /* Other functionality of accessible, which may or may not use the impl class */
}; 
```

方法 (2) 使用工厂模式为`accessible`类提供适当的实现（它将提供与您的`base`类相同的接口）。这里的主要好处之一是您可以在构造过程中进行初始化，`accessible`从而能够`accessible_impl`安全地使用虚拟成员。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-01-15T20:32:38.240

对于 C++，标准的第 12.7 节第 3 段涵盖了这种情况。

总而言之，这是合法的。它将解析为正在运行的构造函数类型的正确函数。因此，使您的示例适应 C++ 语法，您将调用`BaseObject::LoadState()`. 您无法访问`ChildObject::LoadState()`，并且尝试通过指定类和函数来执行此操作会导致未定义的行为。

抽象类的构造函数在 10.4 节第 6 节中介绍。简而言之，它们可以调用成员函数，但在构造函数中调用纯虚函数是未定义的行为。不要那样做。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-15T22:48:53.957

如果您有一个如您的帖子中所示的类，它`XElement`在构造函数中使用一个，那么唯一`XElement`可能来自的地方是派生类。那么为什么不直接在已经具有`XElement`.

您的示例可能缺少一些改变情况的基本信息，或者根本不需要使用来自基类的信息链接到派生类，因为它刚刚告诉了您确切的信息。

IE

```
public class BaseClass
{
    public BaseClass(XElement defintion)
    {
        // base class loads state here
    }
}

public class DerivedClass : BaseClass
{
    public DerivedClass (XElement defintion)
        : base(definition)
    {
        // derived class loads state here
    }
} 
```

那么你的代码真的很简单，而且你没有任何虚拟方法调用问题。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-01-16T10:51:45.290

对于 C++，请阅读 Scott Meyer 的相应文章：

[永远不要在构造或销毁期间调用虚函数](http://www.artima.com/cppsource/nevercall.html)

ps：注意文章中的这个异常：

> 这个问题几乎肯定会在运行前变得明显，因为 logTransaction 函数在 Transaction 中是纯虚拟的。除非它已被定义（***不太可能，但*** ***可能***），否则程序不会链接：链接器将无法找到 Transaction::logTransaction 的必要实现。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-15T20:33:50.017

通常，您可以通过使用更贪婪的基本构造函数来解决这些问题。在您的示例中，您将 XElement 传递给 LoadState。如果您允许在基本构造函数中直接设置状态，那么您的子类可以在调用构造函数之前解析 XElement。

```
public abstract class BaseObject {
   public BaseObject(int state1, string state2, /* blah, blah */) {
      this.State1 = state1;
      this.State2 = state2;
      /* blah, blah */
   }
}

public class ChildObject : BaseObject {
   public ChildObject(XElement definition) : 
      base(int.Parse(definition["state1"]), definition["state2"], /* blah, blah */) {
   }
} 
```

如果子类需要做大量工作，它可以卸载到静态方法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-15T22:53:14.603

在 C++ 中，从基类中调用虚函数是完全安全的——只要它们*不是纯*函数——有一些限制。但是，您不应该这样做。使用非虚拟函数更好地初始化对象，这些函数使用注释和适当的名称（如`initialize`）显式标记为此类初始化函数。如果它甚至在调用它的类中被声明为纯虚拟，则行为是未定义的。

调用的版本是从构造函数中调用它的类之一，而不是某些派生类中的某些覆盖器。这与虚函数表没有太大关系，但更多的是因为该函数的覆盖可能属于尚未初始化的类。所以这是被禁止的。

在 C# 和 Java 中，这不是问题，因为没有在进入构造函数主体之前完成的默认初始化之类的事情。在 C# 中，我认为唯一在体外完成的事情就是调用基类或同级构造函数。但是，在 C++ 中，当在进入派生类的构造函数主体之前处理构造函数初始化器列表时构造这些成员时，该函数的覆盖器对派生类成员所做的初始化将被撤消。

**编辑**：由于有评论，我认为需要澄清一下。这是一个（人为的）示例，假设允许调用 virtuals，并且调用将导致最终覆盖器的激活：

```
struct base {
    base() { init(); }
    virtual void init() = 0;
};

struct derived : base {
    derived() {
        // we would expect str to be "called it", but actually the
        // default constructor of it initialized it to an empty string
    }
    virtual void init() {
        // note, str not yet constructed, but we can't know this, because
        // we could have called from derived's constructors body too
        str = "called it";
    }
private:
    string str;
}; 
```

这个问题确实可以通过改变 C++ 标准并允许它来解决——调整构造函数的定义、对象生命周期等等。必须制定规则来定义`str = ...;`尚未构造的对象的含义。并注意它的效果如何取决于谁打电话`init`。我们得到的特性并不能证明我们必须解决的问题。因此，C++ 只是在构造对象时禁止动态调度。

# gcc - 静态链接到动态库。glibc

> ID：448265
> 
> 赞同：4
> 
> 时间：2009-01-15T20:06:26.983
> 
> 标签：gcc, g++, linker, glibc

所以。我有一个问题，我在一台机器上有两个版本的 GCC。
3.4.6 和 4.1

这是由于新软件的一些依赖性问题。（需要 glibc 4.1）

当我将这个新软件与 4.1 库链接时，它链接得很好。但是，在执行软件时找不到库，因为它在我的 LD_LIBRARY_PATH 中查看 3.4.6。如果我将 LD_LIBRARY_PATH 设置为 4.1 库，它会炸毁外壳，并杀死其他东西，因为 3.4.6 库用于此目的。

它有点像22。

有没有什么方法可以在链接时提供该共享库的绝对路径而不使用 LD_LIBRARY_PATH？

这样我可以希望有两个版本，但只为这个特定的应用程序使用 4.1？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-15T20:23:13.813

您的意思是在程序启动时使用的绝对路径并且在查找库时受到青睐？`rpath`正是这样。它将覆盖在 LD_LIBRARY_PATH 中设置的默认搜索路径和内容。只需告诉 gcc 将其传递给链接器：

```
g++ -Wl,-rpath,/usr/lib/my_4.1 -omy_binary *.cpp 
```

您可以让它向您显示搜索处理（使用`help`它为您提供更多选择）：

```
[js@HOST2 cpp]$ LD_DEBUG=libs ./a.out
  5859:     find library=libc.so.6 [0]; searching
  5859:      search path=/usr/lib/my_4.1/tls/i686/sse2:/usr/lib/my_4.1/tls/i686:
               /usr/lib/my_4.1/tls/sse2:/usr/lib/my_4.1/tls:
               /usr/lib/my_4.1/i686/sse2:/usr/lib/my_4.1/i686:
               /usr/lib/my_4.1/sse2:/usr/lib/my_4.1  (RPATH from file ./a.out)
  5859:       trying file=/usr/lib/my_4.1/tls/i686/sse2/libc.so.6
  5859:       ....
  5859:      search cache=/etc/ld.so.cache
  5859:       trying file=/lib/libc.so.6  (note: found here!)
  5859: 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T20:55:53.497

不是您问题的真正答案，而是替代解决方案：

您应该能够通过将新的 lib 路径添加到并以 root身份`/etc/ld.so.conf`运行来解决您的问题。`ldconfig`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-16T15:59:10.397

你不能只为需要它的应用程序设置 LD_LIBRARY_PATH 吗？即不是将其全局设置为导出变量，而是将程序运行为

LD_LIBRARY_PATH=/path/to/4.1/libs my_executabel

?

-k

# .net - 是否有一个 .NET IoC 更喜欢约定而不是配置？

> ID：448266
> 
> 赞同：7
> 
> 时间：2009-01-15T20:06:32.160
> 
> 标签：.net, dependency-injection, inversion-of-control

简而言之，如果您必须使用 IoC/DI 容器，那么它很容易部署（不喜欢使用 config/xml 文件来处理所有事情）、稳定、良好的文档并支持 .net，它会是哪一个？

可能只是我，但太多的 xml 文件，比如一个用于应用程序，一些用于 ORM，一些用于另一个组件，有时会让人不知所措。此外，在我看来，如果有一种做事方式（约定），那么搞砸的机会就会减少。

期待您的建议和可能的经验。我主要关心的是可维护性和易于部署。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T20:15:21.770

我认为您会在大多数容器中找到此功能。看看[这篇博文](http://blog.ashmind.com/index.php/2008/08/19/comparing-net-di-ioc-frameworks-part-1/)。它有点陈旧，但它会给你一个想法。到目前为止，活动容器可能有更好的支持。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T20:28:39.573

我使用[Ninject](http://ninject.org/)和[StructureMap](http://structuremap.sourceforge.net/Default.htm) —— 两者都允许您在没有 XML 的情况下连接您的配置。

不要无耻地宣传我的网站，但我在这里写了一个关于使用 Ninject 的[教程](http://frickinsweet.com/ryanlanciaux.com/post/Real-Ultimate-Power--Dependency-Injection-with-Ninject.aspx)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-15T20:49:54.647

也许您可以在没有容器的情况下使用 DI？

这是一个使用构造函数注入的示例：

```
public static void Main() {
  ILogger logger = new FileLogger();
  ISession session = new ConcreteSession();
  IRepository repository = new MyDataRepositoryImpl(session, logger);

  IApplication app = new MyApplication();
  app.AddModule(new DataSelector(repository));
  app.AddModule(new Editor(repository, new MyEditorFactory(session)));
  app.AddModule(new LdapAuthenticator(session, logger));
  // ...
  app.Run();
} 
```

如果你这样做，你的可执行模块将依赖于所有东西，所以你应该将它的责任限制在将东西连接在一起。您可以在其他模块中保持应用程序的大部分代码干净。

通常你不需要高级框架来管理你的依赖注入。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-15T22:35:51.127

试试[临富](http://www.codeproject.com/KB/cs/LinFu_IOC.aspx "我的容器")。它是目前最简单、最灵活的容器之一，并且需要最少的代码，并且它是 IOC 容器比较中唯一通过所有测试的容器。享受 ：）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-15T21:16:26.967

最新版本的[StructureMap](http://structuremap.sourceforge.net/Default.htm) 2.5.2 不仅让您可以像 Ryan 所说的那样在没有 XML 的情况下配置容器，而且它还能够根据约定自动连接事物，这似乎正是您正在寻找的。

```
ObjectFactory.Initialize(x => x.Scan(scanner =>
                                        {
                                           scanner.TheCallingAssembly();
                                           scanner.WithDefaultConventions();
                                        }));; 
```

来自 IAssemblyScanner.WithDefaultConvents() 上的文档：

> 将 DefaultConventionScanner 添加到扫描操作中。即，实现“ISomething”的名为“Something”的具体类将自动添加到PluginType“ISomething”

由于我已经拥有使用 Fluent Interface 的现有配置，因此我个人并没有做太多事情。但它看起来很有希望。

编辑：杰里米米勒刚刚发布了一篇关于[如何创建自己的约定的帖子......](http://codebetter.com/blogs/jeremy.miller/archive/2009/01/20/create-your-own-auto-registration-convention-with-structuremap.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-20T15:03:08.047

Castle Windsor 允许通过 Register 调用实现这一点。一个简单的场景是，假设您有很多实现*IController*接口的控制器：

```
container.Register(AllTypes.FromAssembly(assemblyA).BasedOn(typeof(IController)); 
```

您可以通过创建*IService*接口（无成员）并将其添加到上面来进一步简化此操作。这样，当您创建服务时，它会自动注册。

# python - __init__.py 是干什么用的？

> ID：448271
> 
> 赞同：3111
> 
> 时间：2009-01-15T20:09:09.707
> 
> 标签：python, module, package, python-packaging

`__init__.py`Python 源目录中的用途是什么？

* * *

## 回答 #1

> 赞同：1777
> 
> 时间：2009-01-15T20:13:24.987

它曾经是包的必需部分（[旧的，3.3 之前的“常规包”](https://docs.python.org/3/reference/import.html#regular-packages)，而不是[较新的 3.3+“命名空间包”](https://docs.python.org/3/reference/import.html#namespace-packages)）。

[这是文档。](https://docs.python.org/3/reference/import.html#regular-packages)

> Python 定义了两种类型的包，常规包和命名空间包。常规包是 Python 3.2 及更早版本中存在的传统包。常规包通常实现为包含`__init__.py`文件的目录。当一个常规包被导入时，这个`__init__.py`文件被隐式执行，它定义的对象被绑定到包命名空间中的名字。该`__init__.py`文件可以包含任何其他模块可以包含的相同 Python 代码，并且 Python 会在导入模块时为其添加一些附加属性。

但只需单击链接，它包含一个示例、更多信息和对命名空间包的解释，即没有`__init__.py`.

* * *

## 回答 #2

> 赞同：1054
> 
> 时间：2010-11-07T03:31:14.820

命名文件`__init__.py`用于将磁盘上的目录标记为 Python 包目录。如果你有文件

```
mydir/spam/__init__.py
mydir/spam/module.py 
```

并且`mydir`在您的路径上，您可以将代码导入`module.py`为

```
import spam.module 
```

或者

```
from spam import module 
```

如果您删除该`__init__.py`文件，Python 将不再在该目录中查找子模块，因此尝试导入该模块将失败。

该`__init__.py`文件通常是空的，但可用于以更方便的名称导出包的选定部分，保存方便的函数等。鉴于上面的示例，可以访问 init 模块的内容为

```
import spam 
```

基于[此](https://web.archive.org/web/20200721150953/http://effbot.org/pyfaq/what-is-init-py-used-for.htm)

* * *

## 回答 #3

> 赞同：583
> 
> 时间：2013-09-24T10:38:34.920

除了将目录标记为 Python 包和定义之外`__all__`，**`__init__.py`还允许您在包级别定义任何变量。**如果包以类似 API 的方式定义了将频繁导入的内容，那么这样做通常很方便。这种模式促进了对 Pythonic“扁平优于嵌套”哲学的坚持。

## 一个例子

这是我的一个项目中的一个示例，其中我经常导入一个`sessionmaker`调用`Session`来与我的数据库进行交互。我写了一个包含几个模块的“数据库”包：

```
database/
    __init__.py
    schema.py
    insertions.py
    queries.py 
```

我的`__init__.py`包含以下代码：

```
import os

from sqlalchemy.orm import sessionmaker
from sqlalchemy import create_engine

engine = create_engine(os.environ['DATABASE_URL'])
Session = sessionmaker(bind=engine) 
```

由于我`Session`在这里定义，我可以使用下面的语法开始一个新会话。此代码将在“数据库”包目录内部或外部执行相同。

```
from database import Session
session = Session() 
```

当然，这是一个小小的便利——替代方法是`Session`在我的数据库包中定义一个新文件，如“create_session.py”，并使用以下命令启动新会话：

```
from database.create_session import Session
session = Session() 
```

## 进一步阅读

有一个非常有趣的 reddit 线程涵盖了`__init__.py`这里的适当用途：

[http://www.reddit.com/r/Python/comments/1bbbwk/whats_your_opinion_on_what_to_include_in_init_py/](http://www.reddit.com/r/Python/comments/1bbbwk/whats_your_opinion_on_what_to_include_in_init_py/)

大多数人的意见似乎是`__init__.py`文件应该非常薄，以避免违反“显式优于隐式”的理念。

* * *

## 回答 #4

> 赞同：407
> 
> 时间：2015-04-08T08:29:37.057

有2个主要原因`__init__.py`

1.  为方便起见：其他用户不需要知道您的函数在包层次结构（[文档](https://docs.python.org/3/reference/import.html#submodules)）中的确切位置。

    ```
    your_package/
      __init__.py
      file1.py
      file2.py
        ...
      fileN.py 
    ```

    ```
    # in __init__.py
    from file1 import *
    from file2 import *
    ...
    from fileN import * 
    ```

    ```
    # in file1.py
    def add():
        pass 
    ```

    然后其他人可以通过调用 add()

    ```
     from your_package import add 
    ```

    不知道file1，比如

    ```
     from your_package.file1 import add 
    ```

2.  如果你想初始化一些东西；例如，日志记录（应该放在顶层）：

    ```
     import logging.config
     logging.config.dictConfig(Your_logging_config) 
    ```

* * *

## 回答 #5

> 赞同：157
> 
> 时间：2009-01-15T20:22:58.243

该`__init__.py`文件使 Python 将包含它的目录视为模块。

此外，这是要在模块中加载的第一个文件，因此您可以使用它来执行每次加载模块时要运行的代码，或指定要导出的子模块。

* * *

## 回答 #6

> 赞同：120
> 
> 时间：2016-10-12T06:36:59.080

从 Python 3.3 开始，`__init__.py`不再需要将目录定义为可导入的 Python 包。

检查[PEP 420：隐式命名空间包](https://docs.python.org/3/whatsnew/3.3.html#pep-420-implicit-namespace-packages)：

> 对不需要`__init__.py`标记文件并且可以自动跨越多个路径段的包目录的本机支持（受命名空间包的各种第三方方法的启发，如[PEP 420](https://www.python.org/dev/peps/pep-0420/)中所述）

这是测试：

```
$ mkdir -p /tmp/test_init
$ touch /tmp/test_init/module.py /tmp/test_init/__init__.py
$ tree -at /tmp/test_init
/tmp/test_init
├── module.py
└── __init__.py
$ python3

>>> import sys
>>> sys.path.insert(0, '/tmp')
>>> from test_init import module
>>> import test_init.module

$ rm -f /tmp/test_init/__init__.py
$ tree -at /tmp/test_init
/tmp/test_init
└── module.py
$ python3

>>> import sys
>>> sys.path.insert(0, '/tmp')
>>> from test_init import module
>>> import test_init.module 
```

参考：
[https://docs.python.org/3/whatsnew/3.3.html#pep-420-implicit-namespace-packages](https://docs.python.org/3/whatsnew/3.3.html#pep-420-implicit-namespace-packages)
[https://www.python.org/dev/peps/pep-0420/](https://www.python.org/dev/peps/pep-0420/)
[是__init__。 Python 3 中的包不需要 py 吗？](https://stackoverflow.com/questions/37139786/is-init-py-not-required-for-packages-in-python-3)

* * *

## 回答 #7

> 赞同：94
> 
> 时间：2018-05-12T15:41:25.780

尽管 Python 可以在没有`__init__.py`文件的情况下工作，但您仍然应该包含一个文件。

它指定目录应该被视为一个包，因此包含它（即使它是空的）。

**还有一种情况是您可能实际使用`__init__.py`文件：**

*假设您有以下文件结构：*

```
main_methods 
    |- methods.py 
```

并`methods.py`包含这个：

```
def foo():
    return 'foo' 
```

要使用`foo()`，您需要以下条件之一：

```
from main_methods.methods import foo # Call with foo()
from main_methods import methods # Call with methods.foo()
import main_methods.methods # Call with main_methods.methods.foo() 
```

也许您需要（或想要）保留`methods.py`在内部`main_methods`（例如运行时/依赖项），但您只想导入`main_methods`.

* * *

如果您更改了 to 的名称，`methods.py`则`__init__.py`只需`foo()`导入即可使用`main_methods`：

```
import main_methods
print(main_methods.foo()) # Prints 'foo' 
```

这是有效的，因为`__init__.py`它被视为包的一部分。

* * *

一些 Python 包实际上是这样做的。一个示例是[JSON](https://docs.python.org/3/library/json.html)，其中运行`import json`实际上是`__init__.py`从`json`包中导入（[请参阅此处的包文件结构](https://github.com/python/cpython/tree/3.6/Lib/json)）：

> **源代码：** `Lib/json/__init__.py`

* * *

## 回答 #8

> 赞同：64
> 
> 时间：2014-01-09T11:45:10.847

在 Python 中，包的定义非常简单。与 Java 一样，层次结构和目录结构是相同的。但是你必须有`__init__.py`一个包。我将`__init__.py`通过以下示例解释该文件：

```
package_x/
|--  __init__.py
|--    subPackage_a/
|------  __init__.py
|------  module_m1.py
|--    subPackage_b/
|------  __init__.py
|------  module_n1.py
|------  module_n2.py
|------  module_n3.py 
```

`__init__.py`可以为空，只要它存在。它表示该目录应该被视为一个包。当然，`__init__.py`也可以设置相应的内容。

如果我们在module_n1中添加一个函数：

```
def function_X():
    print "function_X in module_n1"
    return 
```

运行后：

```
>>>from package_x.subPackage_b.module_n1 import function_X
>>>function_X()

function_X in module_n1 
```

然后我们按照层次包调用module_n1这个函数。我们可以`__init__.py`像这样在 subPackage_b 中使用：

```
__all__ = ['module_n2', 'module_n3'] 
```

运行后：

```
>>>from package_x.subPackage_b import * 
>>>module_n1.function_X()

Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ImportError: No module named module_n1 
```

因此使用 * 导入，模块包以`__init__.py`内容为准。

* * *

## 回答 #9

> 赞同：46
> 
> 时间：2015-01-03T17:41:14.480

`__init__.py`会将其所在的目录视为可加载模块。

对于喜欢阅读代码的人，我将[两位炼金术士的](https://stackoverflow.com/users/2588818/two-bit-alchemist)评论放在这里。

```
$ find /tmp/mydir/
/tmp/mydir/
/tmp/mydir//spam
/tmp/mydir//spam/__init__.py
/tmp/mydir//spam/module.py
$ cd ~
$ python
>>> import sys
>>> sys.path.insert(0, '/tmp/mydir')
>>> from spam import module
>>> module.myfun(3)
9
>>> exit()
$ 
$ rm /tmp/mydir/spam/__init__.py*
$ 
$ python
>>> import sys
>>> sys.path.insert(0, '/tmp/mydir')
>>> from spam import module
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
ImportError: No module named spam
>>> 
```

* * *

## 回答 #10

> 赞同：40
> 
> 时间：2009-01-15T20:18:32.840

它有助于导入其他 python 文件。当您将此文件放在包含其他 py 文件的目录（例如东西）中时，您可以执行诸如 import stuff.other 之类的操作。

```
root\
    stuff\
         other.py

    morestuff\
         another.py 
```

如果在目录 stuff 中没有此`__init__.py`内容，则无法导入 other.py，因为 Python 不知道 stuff 的源代码在哪里，并且无法将其识别为包。

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2019-05-25T02:42:56.847

文件使`__init__.py`导入变得容易。当`__init__.py`包中存在an 时，`a()`可以从文件中导入函数，`b.py`如下所示：

```
from b import a 
```

但是，没有它，您将无法直接导入。您必须修改系统路径：

```
import sys
sys.path.insert(0, 'path/to/b.py')

from b import a 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2020-07-19T21:37:17.557

__init__.py 允许的一件事是将模块转换为包而不破坏 API 或创建无关的嵌套命名空间或私有模块*。当我想扩展命名空间时，这会有所帮助。

如果我有一个文件 util.py 包含

```
def foo():
    ... 
```

然后用户将`foo`访问

```
from util import foo 
```

如果我想为数据库交互添加实用程序函数，并且我希望它们在 下有自己的命名空间`util`，我需要一个新目录**，并保持 API 兼容性（这样`from util import foo`仍然有效），我会调用它实用程序/。我*可以*像这样将 util.py 移动到 util/ 中，

```
util/
  __init__.py
  util.py
  db.py 
```

并在 util/__init__.py 做

```
from util import * 
```

但这是多余的。我们可以将 util.py 内容放在 __init__.py 中，而不是使用 util/util.py 文件，用户现在可以

```
from util import foo
from util.db import check_schema 
```

我认为这很好地突出了`util`包的 __init__.py 如何以类似于`util`模块的方式运行

*这在其他答案中有所暗示，但我想在这里强调它
**没有使用进口体操。请注意，创建与文件同名的新包将不起作用，请参阅[此](https://stackoverflow.com/q/6393861/5986907)

# asp.net - c# HttpModule 处理伪子域

> ID：448281
> 
> 赞同：1
> 
> 时间：2009-01-15T20:13:58.403
> 
> 标签：asp.net, pseudocode, wildcard-subdomain

我是使用 .NET 进行开发并从事个人项目的新手。我的项目将允许用户创建自己的简单移动网站。

我想编写一个处理伪子域的 HTTP 模块。

我已经设置了我的 DNS 通配符`so sub.domain.com`等`xxx.domain.com`指向同一个应用程序。我希望能够从`sub.domain.com/pageID.html`URL 中提取子和 ID 部分，并从数据库服务器加载页面设置，以便构建页面并将其呈现给客户端。

我可以使用 URL 重写工具来做到这一点`isapirewrite`，但我希望我的应用程序独立于操作系统，以便服务器不需要安装任何 3rd 方应用程序。

是否可以使用 HTTP 处理程序来做到这一点？

任何人都可以发布一个例子吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-15T20:22:39.553

您可以随时查看域名。在哪里执行取决于您的应用程序的目标。例如，如果您想根据域提供不同的页面，您可以这样做：

```
public class MyModule : IHttpModule
{
    public void Dispose()
    {
    }

    public void Init(HttpApplication context)
    {
        context.BeginRequest += context_BeginRequest;
    }

    void context_BeginRequest(object sender, EventArgs e)
    {
        HttpApplication app = sender as HttpApplication;
        string host = app.Request.Url.Host;
        if(host == "first.domain.com")
        {
            app.Context.RewritePath("~/First.aspx");
        }
    }
} 
```

# perl - 如何使用 awk 或 Perl 增加大型 XML 文件中的数字？

> ID：448284
> 
> 赞同：5
> 
> 时间：2009-01-15T20:15:48.913
> 
> 标签：perl, awk

我有一个带有以下行的 XML 文件：

```
 <VALUE DECIMAL_VALUE="0.2725" UNIT_TYPE="percent"/> 
```

我想将此值增加 0.04 并保持 XML 的格式不变。我知道使用 Perl 或 awk 脚本可以做到这一点，但我很难用表达式来隔离数字。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T20:39:37.553

如果您在使用 xsltproc 命令的机器上，我建议您为此使用 XSLT。

对于 Perl 解决方案，我会选择使用 DOM。查看这篇[使用 Perl 处理 DOM 的](http://www.ibm.com/developerworks/xml/library/x-domprl/)文章。

那就是说。如果您的 XML 文件是以可预测的方式生成的，那么像下面这样天真的事情可能会起作用：

```
perl -pe 's#(<VALUE DECIMAL_VALUE=")([0-9.]+)(" UNIT_TYPE="percent"/>)#"$1" . ($2 + 0.4) . "$3"#e;' 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-15T21:51:23.963

如果你绝对确定你的 XML 格式永远不会改变，属性的顺序是固定的，你确实可以得到正确的数字的正则表达式......然后选择非基于解析器的解决方案。

就我个人而言，我会使用 XML::Twig（也许是因为我写了它；--）。它将 XML 处理为 XML，同时仍然尊重文件的原始格式，并且在开始工作之前不会将其全部加载到内存中。

以下未经测试的代码：

```
#!/usr/bin/perl
use strict;
use warnings;

use XML::Twig;

XML::Twig->new( # call the sub for each VALUE element with a DECIMAL_VALUE attribute
                twig_roots => { 'VALUE[@DECIMAL_VALUE]' => \&upd_decimal },
                # print anything else as is
                twig_print_outside_roots => 1,
              )
         ->parsefile_inplace( 'foo.xml');

sub upd_decimal
  { my( $twig, $value)= @_; # twig is the XML::Twig object, $value the element
    my $decimal_value= $value->att( 'DECIMAL_VALUE');
    $decimal_value += 0.4;
    $value->set_att( DECIMAL_VALUE => $decimal_value);
    $value->print;
  } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-15T20:50:46.970

这在标准输入上输入，输出到标准输出：

```
while(<>){
 if( $_ =~ /^(.*DECIMAL_VALUE=\")(.*)(\".*)$/ ){
  $newVal = $2 + 0.04;
  print "$1$newVal$3\n";
 }else{
  print $_;
 }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T20:38:02.440

类似于以下内容的东西将起作用。如果有额外的间距，它可能需要调整，但这留给读者作为练习。

```
function update_after(in_string, locate_string, delta) {
    local_pos = index(in_string,locate_string);
    leadin    = substr(in_string,0,local_pos-1);
    leadout   = substr(in_string,local_pos+length(locate_string));
    new_value = leadout+delta;
    quote_pos = index(leadout,"\"");
    leadout   = substr(leadout, quote_pos + 1);
    return leadin locate_string new_value"\"" leadout;
}

/^ *\<VALUE/{
    print  update_after($0, "DECIMAL_VALUE=\"",0.4);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-24T23:41:52.773

这是傻瓜

```
awk '/DECIMAL_VALUE/{
 for(i=1;i<=NF;i++){
    if( $i~/DECIMAL_VALUE/){
        gsub(/DECIMAL_VALUE=|\042/,"",$i)
        $i="DECIMAL_VALUE=\042"$i+0.4"\042"
    }
 }
}1' file 
```

# iphone - UIScrollView 缩放后如何重置？

> ID：448285
> 
> 赞同：20
> 
> 时间：2009-01-15T20:16:25.637
> 
> 标签：iphone, ios, cocoa-touch, uiscrollview, zooming

我在`UIScrollView`. 它是一个`UIView`使用自定义子类`CATiledLayer`作为其层的大型。

当我放大和缩小 时`UIScrollView`，我希望图形像从 返回图形时一样动态调整大小`viewForZoomingInScrollView`。但是，图表会以新的缩放级别重绘自身，我想将变换比例重置为 1x1，以便下次用户缩放时，变换从当前视图开始。如果我将转换重置为 Identity in `scrollViewDidEndZooming`，它会在模拟器中运行，但会`EXC_BAD_ACCSES`在设备上抛出一个。

这甚至不能完全解决模拟器上的问题，因为下次用户缩放时，变换会自行重置为它所处的缩放级别，所以看起来，如果我被缩放到 2x，例如，突然变成了 4 倍。当我完成缩放时，它以正确的比例结束，但实际的缩放行为看起来很糟糕。

所以首先：如何让图形在缩放后以 1x1 的标准比例重绘自身，以及如何在整个过程中进行平滑缩放？

**编辑：**新发现错误似乎是“ `[CALayer retainCount]: message sent to deallocated instance`”

我自己从不释放任何层。以前，我什至没有删除任何视图或任何东西。这个错误是在缩放和旋转时抛出的。如果我在旋转之前删除对象并在之后重新添加它，它不会引发异常。这不是缩放选项。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-01-16T19:29:19.393

除了告诉您检查并确保您不会无意中在代码中的某处自动释放视图或图层之外，我无法帮助您解决崩溃问题。我已经看到模拟器处理自动释放的时间与在设备上不同（通常是在涉及线程时）。

不过，视图缩放是`UIScrollView`我遇到的一个问题。在捏缩放事件期间，`UIScrollView`将采用您在`viewForZoomingInScrollView:`委托方法中指定的视图并对其应用变换。这种变换提供了视图的平滑缩放，而不必在每一帧都重新绘制它。在缩放操作结束时，您的委托方法`scrollViewDidEndZooming:withView:atScale:`将被调用，并让您有机会以新的比例因子对视图进行更高质量的渲染。通常，建议您将视图上的转换重置为`CGAffineTransformIdentity`，然后让您的视图以新的尺寸比例手动重绘。

但是，这会导致一个问题，因为`UIScrollView`它似乎没有监视内容视图变换，因此在下一次缩放操作中，它将内容视图的变换设置为整体比例因子。由于您已在最后一个比例因子处手动重绘视图，因此它会复合缩放，这就是您所看到的。

作为一种解决方法，我为内容视图使用 UIView 子类，并定义了以下方法：

```
- (void)setTransformWithoutScaling:(CGAffineTransform)newTransform;
{
    [super setTransform:newTransform];
}

- (void)setTransform:(CGAffineTransform)newValue;
{
    [super setTransform:CGAffineTransformScale(newValue, 1.0f / previousScale, 1.0f / previousScale)];
} 
```

其中 previousScale 是视图的浮点实例变量。然后我实现缩放委托方法如下：

```
- (void)scrollViewDidEndZooming:(UIScrollView *)scrollView withView:(UIView *)view atScale:(float)scale;
{
    [contentView setTransformWithoutScaling:CGAffineTransformIdentity];
// Code to manually redraw view at new scale here
    contentView.previousScale = scale;
    scrollView.contentSize = contentView.frame.size;
} 
```

通过这样做，发送到内容视图的变换会根据视图上次重绘的比例进行调整。`setTransform:`完成捏合缩放后，通过绕过正常方法中的调整，将变换重置为 1.0 的比例。这似乎提供了正确的缩放行为，同时让您在完成缩放时绘制清晰的视图。

更新（2010 年 7 月 23 日）：iPhone OS 3.2 及更高版本更改了滚动视图在缩放方面的行为。现在，a`UIScrollView`将尊重您应用于内容视图的身份转换，并且仅在`-scrollViewDidEndZooming:withView:atScale:`. 因此，上面的`UIView`子类代码仅对运行 iPhone OS 版本早于 3.2 的设备是必需的。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2011-08-02T16:33:33.377

感谢所有先前的答案，这是我的解决方案。
实现**UIScrollViewDelegate**方法：

```
- (UIView *)viewForZoomingInScrollView:(UIScrollView *)scrollView
{
    return tmv;
}

- (void)scrollViewDidEndZooming:(UIScrollView *)scrollView withView:(UIView *)view atScale:(float)scale
{
    CGPoint contentOffset = [tmvScrollView contentOffset];   
    CGSize  contentSize   = [tmvScrollView contentSize];
     CGSize  containerSize = [tmv frame].size;

    tmvScrollView.maximumZoomScale = tmvScrollView.maximumZoomScale / scale;
    tmvScrollView.minimumZoomScale = tmvScrollView.minimumZoomScale / scale;

    previousScale *= scale;

    [tmvScrollView setZoomScale:1.0f];

    [tmvScrollView setContentOffset:contentOffset];
    [tmvScrollView setContentSize:contentSize];
    [tmv setFrame:CGRectMake(0, 0, containerSize.width, containerSize.height)];  

    [tmv reloadData];
} 
```

*   **tmv**是我的 UIView 的子类
*   **tmvScrollView** — UIScrollView 的出口
*   在之前设置**maximumZoomScale**和**minimumZoomScale**
*   创建**previousScale**实例变量并将其值设置为 1.0f

完美地为我工作。

BR，尤金。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2015-06-03T06:53:00.010

我只是想在加载时重置为默认缩放比例，因为当我缩放它时，滚动视图在下次被释放之前具有相同的缩放比例。

```
-(void) viewWillAppear:(BOOL)animated {
      [self.scrollView setZoomScale:1.0f];
} 
```

改变了游戏。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-07T23:04:08.860

我在[github.com/andreyvit/ScrollingMadness/](http://github.com/andreyvit/ScrollingMadness/)详细讨论了 UIScrollView 缩放的工作原理（以及原因） 。

（该链接还包含对如何以编程方式缩放 UIScrollView、如何模拟照片库风格的分页+缩放+滚动、示例项目和封装了一些缩放魔术的 ZoomScrollView 类的描述。）

引用：

UIScrollView 没有“当前缩放级别”的概念，因为它包含的每个子视图都可能有自己的当前缩放级别。请注意，UIScrollView 中没有字段来保持当前缩放级别。但是我们知道有人存储了该缩放级别，因为如果您捏缩放子视图，然后将其变换重置为 CGAffineTransformIdentity，然后再次捏，您会注意到子视图之前的缩放级别已恢复。

事实上，如果你看一下反汇编，它是 UIView 存储自己的缩放级别（在 _gestureInfo 字段指向的 UIGestureInfo 对象内）。它还有一组很好的未记录方法，例如`zoomScale`和`setZoomScale:animated:`。（请注意，它还有一堆与旋转相关的方法，也许我们很快就会获得旋转手势支持。）

但是，如果我们创建一个仅用于缩放的新 UIView 并将我们真正的可缩放视图添加为其子视图，我们将始终从缩放级别 1.0 开始。我的程序化缩放实现就是基于这个技巧。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-11-12T05:33:14.393

一种相当可靠的方法，适用于 iOS 3.2 和 4.0 及更高版本，如下所示。您必须准备好以任何请求的比例提供您的可缩放视图（滚动视图的主要子视图）。然后，`scrollViewDidEndZooming:`您将删除此视图的模糊比例转换版本，并将其替换为绘制到新比例的新视图。

你会需要：

*   一个 ivar 用于保持以前的比例；让我们称之为 oldScale

*   一种识别可伸缩视图的方法，包括 for`viewForZoomingInScrollView:`和 for `scrollViewDidEndZooming:`；在这里，我要应用一个标签（999）

*   一种创建可伸缩视图、对其进行标记并将其插入到滚动视图中的方法（这里我称之为`addNewScalableViewAtScale:`）。记住，它必须根据比例做所有事情——它调整视图及其子视图或绘图的大小，并调整滚动视图的 contentSize 大小以匹配。

*   minimumZoomScale 和 maximumZoomScale 的常量。这些是必需的，因为当我们将缩放视图替换为详细的较大版本时，系统会认为当前比例为 1，因此我们必须欺骗它允许用户缩小视图。

那好吧。创建滚动视图时，以 1.0 的比例插入可缩放视图。例如，这可能在您`viewDidLoad`的 中（`sv`是滚动视图）：

```
[self addNewScalableViewAtScale: 1.0];
sv.minimumZoomScale = MIN;
sv.maximumZoomScale = MAX;
self->oldScale = 1.0;
sv.delegate = self; 
```

然后在你的`scrollViewDidEndZooming:`你做同样的事情，但补偿规模的变化：

```
UIView* v = [sv viewWithTag:999];
[v removeFromSuperview];
CGFloat newscale = scale * self->oldScale;
self->oldScale = newscale;
[self addNewScalableViewAtScale:newscale];
sv.minimumZoomScale = MIN / newscale;
sv.maximumZoomScale = MAX / newscale; 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-07-28T03:43:41.040

请注意，Brad 提供的解决方案有一个问题：如果您继续以编程方式放大（比如说双击事件）并让用户手动（缩小）缩小，一段时间后真实比例和比例之间的差异UIScrollView 正在跟踪会变得太大，因此`previousScale`在某些时候会超出 float 的精度，最终会导致不可预测的行为

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-06-29T05:21:45.860

**Swift 4.***和**Xcode 9.3**

将 scrollView 缩放比例设置为 0 会将您的 scrollView 重置为其初始状态。

```
self.scrollView.setZoomScale(0.0, animated: true) 
```

# asp.net - 如何将触发器添加到更新面板，其中触发器的事件位于中继器内的用户控件内？

> ID：448287
> 
> 赞同：3
> 
> 时间：2009-01-15T20:16:30.957
> 
> 标签：asp.net, asp.net-ajax, triggers, updatepanel

我有一个名为 CustomerFinder 的 UserControl 用于搜索客户。中继器内部有“添加”按钮。我为Repeater_ItemCommand 创建了一个事件处理程序。因为我要在其他页面上使用它。

在另一页上，我使用了这个不在 UpdatePanel 中的用户控件。选定客户有一个更新面板（当他们点击添加时，客户被选中）

当他们单击用户控件中的添加按钮时，我希望更新面板自行刷新。

[![替代文字](https://i.stack.imgur.com/no6zz.png)](https://i.stack.imgur.com/no6zz.png)
[（来源：[barbarosalp.com](http://www.barbarosalp.com/questions/updatePanelcommand.png)）]

正如您在上面看到的那样，Intellisense 可以获得事件名称“ **OnrptCustomersCommand** ”

[![替代文字](https://i.stack.imgur.com/Y6gml.png)](https://i.stack.imgur.com/Y6gml.png)
[（来源：[barbarosalp.com](http://www.barbarosalp.com/questions/updatePanelcommand1.png)）]

而这就是触发...

我收到一个错误“找不到事件‘OnrptCustomersComman’”

我怎样才能完成它？提前致谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T20:21:15.533

从触发器部分中删除`ucCustomerFinder`asyncpostbacktrigger 元素并将`pnlSelectedCustomers.Update()`命令添加到`Repeater_ItemCommand`转发器的事件中

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T20:30:12.940

感谢 Micheal Knishkern 关于他的回答。

但我也以我的方式做到了:)

只需从事件名称中删除两个字符“On”。

**OnrptCustomersEvent**到**rptCustomersEvent**

再次感谢

# java - 如何为除最后一行之外的所有行附加换行符？

> ID：448320
> 
> 赞同：33
> 
> 时间：2009-01-15T20:24:28.817
> 
> 标签：java, foreach, newline

我正在遍历 HashMap（有关更多详细信息，请参阅[我之前的问题](https://stackoverflow.com/questions/448122/how-do-i-use-a-foreach-loop-in-java-to-loop-through-the-values-in-a-hashmap)）并构建一个由 Map 中包含的数据组成的字符串。对于每个项目，我都会有一个新行，但对于最后一个项目，我不想要新行。我怎样才能做到这一点？我在想我可以通过某种方式检查条目是否是最后一个条目，但我不确定如何实际做到这一点。

谢谢！

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-01-15T20:27:26.817

将您的思维过程从“除了最后一次之外都添加换行符”更改为“除了第一次之外都添加换行符”：

```
boolean first = true;
StringBuilder builder = new StringBuilder();

for (Map.Entry<MyClass.Key,String> entry : data.entrySet()) {
    if (first) {
        first = false;
    } else {
        builder.append("\n"); // Or whatever break you want
    }
    builder.append(entry.key())
           .append(": ")
           .append(entry.value());
} 
```

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2009-01-15T20:30:54.500

一种方法（向 Jon Skeet 道歉，因为他借用了他的部分 Java 代码）：

```
StringBuilder result = new StringBuilder();

string newline = "";  
for (Map.Entry<MyClass.Key,String> entry : data.entrySet())
{
    result.append(newline)
       .append(entry.key())
       .append(": ")
       .append(entry.value());

    newline = "\n";
} 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-01-16T14:29:34.303

那这个呢？

```
StringBuilder result = new StringBuilder();

for(Map.Entry<MyClass.Key,String> entry : data.entrySet())
{
    builder.append(entry.key())
       .append(": ")
       .append(entry.value())
       .append("\n");
}

return builder.substring(0, builder.length()-1); 
```

必须道歉，并感谢 Jon 和 Joel 从他们的例子中“借鉴”。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-01-15T20:37:09.493

通常对于这类事情，我使用 apache-commons-lang [StringUtils#join](http://commons.apache.org/lang/api/org/apache/commons/lang/StringUtils.html#join(java.util.Collection,%20java.lang.String))。虽然编写所有这些实用程序功能并不难，但重用现有的经过验证的库总是更好。[Apache-commons](http://commons.apache.org/)充满了类似的有用的东西！

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-01-15T21:27:55.803

如果您使用迭代器而不是 for...each 您的代码可能如下所示：

```
StringBuilder builder = new StringBuilder();

Iterator<Map.Entry<MyClass.Key, String>> it = data.entrySet().iterator();

while (it.hasNext()) {
    Map.Entry<MyClass.Key, String> entry = it.next();

    builder.append(entry.key())
    .append(": ")
    .append(entry.value());

    if (it.hasNext()) {
        builder.append("\n");
    }
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-11-25T00:19:23.217

这可能是一个更好的例子......

```
final StringBuilder buf = new StringBuilder();
final String separator = System.getProperty("line.separator"); // Platform new line
for (Map.Entry<MyClass.Key,String> entry: data.entrySet()) {
    builder.append(entry.key())
       .append(": ")
       .append(entry.value())
       .append(separator);
}
// Remove the last separator and return a string to use.
// N.b. this is likely as efficient as just using builder.toString() 
// which would also copy the buffer, except we have 1 char less 
// (i.e. '\n').
final String toUse = builder.substring(0, builder.length()-separator.length()-1); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-16T14:15:48.930

这是我的简洁版本，它使用 StringBuilder 的长度属性而不是额外的变量：

```
StringBuilder builder = new StringBuilder();

for (Map.Entry<MyClass.Key,String> entry : data.entrySet())
{
    builder.append(builder.length() > 0 ? "\n" : "")
           .append(entry.key())
           .append(": ")
           .append(entry.value());
} 
```

（道歉并感谢 Jon 和 Joel 从他们的例子中“借鉴”。）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-05-12T20:23:18.167

一种解决方案是为 StringBuilder 创建一个自定义包装器。它不能扩展，因此需要一个包装器。

```
public class CustomStringBuilder {

final String separator = System.getProperty("line.separator");

private StringBuilder builder = new StringBuilder();

public CustomStringBuilder appendLine(String str){
    builder.append(str + separator);
    return this;
}

public CustomStringBuilder append(String str){
    builder.append(str);
    return this;
}

public String toString() {
    return this.builder.toString();
} 
```

}

像这样的实现：

```
CustomStringBuilder builder = new CustomStringBuilder();

//iterate over as needed, but a wrapper to StringBuilder with new line features.

builder.appendLine("data goes here");
return builder.toString(); 
```

这确实有一些缺点：

*   编写通常不以“领域/业务”为中心的代码
*   不使用开源标准解决方案，例如：StringUtils.join
*   被迫维护一个包装了最终 JDK 类的类，因此需要长期更新。

我使用 StringUtils.join 解决方案来迭代集合，甚至在代码中构建轻量级构建方法模式。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-15T20:27:49.293

假设您的 foreach 循环遍历文件，只需在每个字符串中添加一个新行，并在循环退出时删除最后一个新行。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-15T20:29:04.957

不确定这是否是最好的，但它是更简单的方法：

循环遍历所有值并将 \n 通常附加到字符串缓冲区中。然后，做这样的事情

```
sb.setLength(sb.length()-1); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-23T15:39:52.310

这就是为了补充 split 的 join 方法会派上用场的地方，因为这样您就可以使用新行作为分隔符来连接所有元素，当然它不会在结果末尾附加新行; 这就是我使用各种脚本语言（Javascript、PHP 等）的方式。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-05T23:45:02.613

如果你使用[Class Separator](http://ssdl-wiki.cs.technion.ac.il/wiki/index.php/Class_Separator)，你可以做

```
StringBuilder buf = new StringBuilder();
Separator separator = new Separator("\n");
for (Map.Entry<MyClass.Key,String> entry: data.entrySet()) {
    builder.append(separator)
       .append(entry.key())
       .append(": ")
       .append(entry.value());
} 
```

分隔符在第一次使用时打印为空字符串，而分隔符在所有后续使用时打印。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-17T13:28:36.267

哈！感谢[这篇文章](https://stackoverflow.com/questions/654054/separated-string-created-in-loop/654102#654102)，我找到了另一种方法来做到这一点：

```
public static class Extensions
{
    public static string JoinWith(this IEnumerable<string> strings, string separator)
    {
        return String.Join(separator, strings.ToArray());
    }
} 
```

当然这是在 C# 中，Java 将（还）不支持扩展方法，但你应该能够根据需要调整它——主要是`String.Join`无论如何使用，我相信 java 有一些类似的为了那个原因。

另请注意，这意味着对字符串进行额外的迭代，因为您必须首先创建数组，然后对其进行迭代以构建字符串。此外，您*将*创建数组，使用其他一些方法，您可能可以使用一次仅在内存中保存一个字符串的 IEnumerable 来解决。但我真的很喜欢额外的清晰度。

当然，鉴于扩展方法功能，您也可以将任何其他代码抽象为扩展方法。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-01-16T22:25:25.900

让图书馆为您做这件事。

```
import com.sun.deploy.util.StringUtils; 
```

以及许多其他人都有 StringUtils，它有一个 join 方法。您可以在一行中执行此操作：

```
StringUtils.join(list, DELIMITER); 
```

但对于更多上下文，这里是你如何使用哈希图来做到这一点。

```
public static String getDelimitatedData(HashMap<String, String> data) {
    final String DELIMITER = "\n"; //Should make this a variable
    ArrayList<String> entries = new ArrayList<>();

    for (Map.Entry<String, String> entry : data.entrySet()) {
        entries.add(entry.getKey() + ": " + entry.getValue());
    }

    return StringUtils.join(entries, DELIMITER);
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-11-21T20:33:31.447

使用 JDK 字符串连接 API：

```
String result = data.stream()
    .map((k,v) -> String.format("%s : %s", k, v)
    .collect(Collectors.joining("\n")); 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-09-05T14:23:07.867

如果您`trim()`不关心空格，并且仅当您不打算在`StringBuilder`.

这是一些示例代码

```
StringBuilder sb = new StringBuilder();

for (Map.Entry<String,String> entry : myMap.entrySet()) {
    builder.append(entry.key())
           .append(": ")
           .append(entry.value())
           .append("\n");
}
return sb.toString().trim(); 
```

# inno-setup - InnoSetup 中的友好 Windows 最低版本

> ID：448327
> 
> 赞同：11
> 
> 时间：2009-01-15T20:25:37.270
> 
> 标签：inno-setup

我可以在 Inno-Setup 中设置所需的最低版本（例如 XP SP3）

```
MinVersion=0,5.01.2600 
```

然而，这导致了相当不友好的消息框：

**`This program requires Windows NT version 5.1.2600 or later.`**

有什么办法可以代替这样说：

**`This program requires WindowsXP Service Pack 3 or later.`**

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-15T23:26:53.333

该字符串被命名[`WinVersionTooLowError`](https://github.com/jrsoftware/issrc/blob/master/Files/Default.isl#L59)并定义为

```
This program requires %1 version %2 or later. 
```

您可以在该[`[Messages]`](http://jrsoftware.org/ishelp/topic_messagessection.htm)部分重新定义它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-08-11T09:49:23.273

```
MinVersion=0,5.01.2600 
```

不行，在[Setup]区试试这个，在inno setup中也可以用在很多其他的地方。

```
MinVersion=0,5.1.2600 
```

# c - 我的简单 poll() 示例仅部分有效

> ID：448331
> 
> 赞同：6
> 
> 时间：2009-01-15T20:26:46.007
> 
> 标签：c, sockets, networking, tcp, polling

该程序应该接受端口 8888 上的 telnet 连接，然后使用 .从每个 telnet 客户端发送和消息，`poll()`但它并不能 100% 工作。似乎某些连接总是可以向任何人发送消息，并且程序运行良好，但总是至少有一个客户端无法发送消息。所有客户端始终可以接收（轮询不注册传入数据）。`send()``recv()`

这段代码自己运行，所以如果你把它放在一个文件中并编译它，`gcc -o app filename.c`那么你可以在端口 8888 上 telnet 到 localhost 并看到它不起作用。此代码是为 Fedora 编写的，但其中不应包含任何非 Linux 特定的内容。任何帮助将不胜感激。

```
#include <stdio.h>
#include <stdlib.h>
#include <poll.h>
#include <unistd.h>
#include <sys/time.h>
#include <sys/types.h>
#include <string.h>
#include <signal.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <errno.h>

#define PORT 8888
#define MAX_CONN 10
#define SECOND 1000
#define TIMEOUT (30 * SECOND)

static int listen_socket();

int main(int argc, char **argv)
{
    struct pollfd **my_fds;                  //array of pollfd structures for poll()
    struct pollfd *curr, *new_conn;          //so I can loop through
    int num_fds;                             //count of how many are being used
    int i, j;                                //for loops
    char buff[255], buff2[255];              //for sending and recieving text
    struct sockaddr_in my_addr, their_addr;  // my address information
    socklen_t sin_size;
    int buff_sz;                             //size of data recieved

    printf("App Started\n");

    //allocate space for 10 
    my_fds = (struct pollfd**) malloc(sizeof(struct pollfd*) * MAX_CONN);

    //set all the pointers to NULL
    for (i = 0; i < MAX_CONN; i++)
        *(my_fds + i) = NULL;

    //I call listen_socket() which creates a socket to listen to
    //this is anchored into my_fds array at element 0.
    curr = (struct pollfd*) malloc (sizeof(struct pollfd));
    curr->fd = listen_socket();
    curr->events = POLLIN;
    curr->revents = 0;

    *my_fds = curr;

    printf("Listening socket fd locked always at position zero in array: %d\n", curr->fd);

    //num_fds, the count of items in the array is set to 1
    //because the listen socket is already present
    num_fds = 1;

    //This is the main loop.
    //While (true)
    //  set all struct pollfd items revents to 0
    //  call poll
    //  loop through, see if there is data to read
    //      read the data
    //          loop through all sockets (except the listen_socket()) and send the data.
    while (1)
    {

        //reset all event flag
        for (i = 1; i < num_fds; i++)
        {
            curr = *(my_fds + i);
            curr->events = POLLIN | POLLPRI;
            printf("%i: fd %i\n", i, curr->fd);
            curr->revents = 0;
            send(curr->fd, "Enter some text:\n", 18, 0);
        }

        //put all this into poll and wait for something magical to happen
        printf("calling poll (%d sockets)\n", num_fds);
        if (poll(*my_fds, num_fds, TIMEOUT) == -1)
        {
            perror("poll");
            exit(0);
        }

        printf("poll returned!\n");

        //First item is the accepting socket....check it independently of the rest!
        curr = *my_fds;
        if (curr->revents != 0)
        {
            printf("We have a new connection.\nAccept goes here...\n");

            //Accept the connection
            sin_size = sizeof their_addr;
            new_conn = (struct pollfd*) malloc(sizeof(struct pollfd));
            new_conn->fd = accept(curr->fd, (struct sockaddr *)&their_addr, &sin_size);
            new_conn->events = POLLIN;
            new_conn->revents = 0;

            printf("Connection from %s\n", inet_ntoa(their_addr.sin_addr));
            sprintf(buff, "Your %i\n", num_fds);
            send(new_conn->fd, buff, 7, 0);

            //Add it to the poll call
            *(my_fds + num_fds) = new_conn;
            num_fds++;

        }
        else
        {
            //skip first one, we know that's the accepting socket (handled above).
            for (i = 1; i < num_fds; i++)
            {
                curr = *(my_fds + i);
                if (curr->revents != 0)
                {
                    buff_sz = recv(curr->fd, &buff, 254, 0);
                    buff[buff_sz] = '\0';
                    printf("Recieved: %s", buff);

                    //send the message to everyone else
                    for (j = 1; j < num_fds; j++)
                    {
                        printf("i = %i, j = %i\n", i, j);
                        if (j != i)
                        {
                            new_conn = *(my_fds + j);
                            sprintf(buff2, "%i sent you %i: %s", i, j, buff);
                            send(new_conn->fd, buff2, strlen(buff2) + 1, 0);
                        }
                    }
                }
            }
        }
    }

    printf("App Ended\n");
}

static int listen_socket()
{
    struct sockaddr_in a;
    int s;
    int yes;

    if ((s = socket(AF_INET, SOCK_STREAM, 0)) < 0) {
        perror("socket");
        return -1;
    }
    yes = 1;
    if (setsockopt(s, SOL_SOCKET, SO_REUSEADDR,
            (char *) &yes, sizeof(yes)) < 0) {
        perror("setsockopt");
        close(s);
        return -1;
    }
    memset(&a, 0, sizeof(a));
    a.sin_port = htons(PORT);
    a.sin_family = AF_INET;
    if (bind(s, (struct sockaddr *) &a, sizeof(a)) < 0) {
        perror("bind");
        close(s);
        return -1;
    }
    printf("Accepting connections on port %d\n", PORT);
    listen(s, 10);
    return s;
} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-15T20:47:46.663

poll 不应该采用一系列结构吗？从手册页：

```
 int poll(struct pollfd fds[], nfds_t nfds, int timeout); 
```

你正在传递一个指向结构的指针数组：

```
struct pollfd **my_fds; 
```

我认为你需要有

```
struct pollfd *my_fds = calloc(sizeof(pollfd), MAX_CONN); 
```

然后你的代码就有机会工作了。

# .net - 为什么我必须对本地程序集使用完全限定的程序集名称？

> ID：448337
> 
> 赞同：0
> 
> 时间：2009-01-15T20:28:13.333
> 
> 标签：.net, binding, assemblies, clr

在很多地方，比如在 app.config/web.config 文件中，我必须使用这个冗长的完全限定名称来指定类型，比如

`<add name="myListener" type="System.Diagnostics.TextWriterTraceListener, System, Version=1.0.3300.0, Culture=neutral, PublicKeyToken=b77a5c561934e089" />`

[这个 MSDN 网站](http://msdn.microsoft.com/en-us/library/k8xx4k69.aspx)说，

> 在 .NET Framework 中引用程序集时，不允许使用仅指定程序集名称的部分绑定。

好的，很好 - 但是为什么在某些地方，比如在定义我自己的自定义跟踪侦听器时，当我引用我自己的、非强命名的本地部署程序集时，我不能使用部分绑定？这有什么更深层次的原因吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-15T20:37:37.607

我想这部分与此有关：

[http://blogs.msdn.com/suzcook/archive/2003/05/30/57159.aspx](http://blogs.msdn.com/suzcook/archive/2003/05/30/57159.aspx)

LoadWithPartialName 在 v2 中已被贬值，我认为它在许多地方用于处理配置文件中的程序集名称。

虽然它应该可以工作（它只是折旧，而不是删除），但我想他们在内部对任何调用它的东西进行了更改，包括如何处理配置文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T20:38:55.247

这是一个安全问题。活页夹在查找程序集时遵循一组特定的目录。如果我想恶意破坏您的应用程序，我可以放入一个程序集中，在适当的位置定义您的类型。您的代码将加载这个未签名、不受信任的程序集，并以您的代码运行的任何特权开始执行我的代码。

其次，版本很重要，因为它允许依赖于共享程序集的已部署应用程序安全更新，因为 .net 允许您在 GAC 中为程序集指定更新策略。

最后，在 .net 中，拥有两个定义相同类型的程序集是完全合法的，它们可能由不同的作者或公司编写，因此完全限定名称可以保护您的代码不做错误的事情。

# haskell - 有没有关于如何使用 Haskell monad 函数的好例子？

> ID：448340
> 
> 赞同：4
> 
> 时间：2009-01-15T20:29:03.350
> 
> 标签：haskell, monads

Haskell monad 函数不太好理解，在哪里可以找到使用示例？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T22:39:17.423

我写了一个案例研究，名为[“剖析一个新的单子”](http://paulspontifications.blogspot.com/2007/08/anatomy-of-new-monad.html)。这是你的意思吗？

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-15T20:36:42.367

你的意思是名字像`fooM`和的函数`fooM_`？你可以通过阅读他们的源代码更好地理解它们，或者当你写一个`do`-expression 时，你可以考虑是否可以用一个相关的`fooM`-function 来表达。

你也可以看看[这个问题](https://stackoverflow.com/questions/412929/creative-uses-of-monads#412992)。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-16T19:20:10.783

我一直在寻找的答案是：[Haskell monad 函数之旅][1]

但我仍在为非标准单子寻找类似的东西。

[1]: [http://members.chello.nl/hjgtuyl/tourdemonad.html](http://members.chello.nl/hjgtuyl/tourdemonad.html) Haskell monad 函数之旅

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T19:30:56.003

O'Reilly 的新书*Real World Haskell*有一些关于 monad 的好章节，其中包括您似乎正在寻找的那种~~古怪的临时用户定义的抽象 monad 函数。~~

# regex - 使用什么 Vim 命令删除文件每一行某个字符之后的所有文本？

> ID：448346
> 
> 赞同：16
> 
> 时间：2009-01-15T20:30:34.063
> 
> 标签：regex, vim, vi, replace

设想：

*   我有一个包含管道（如`|` 字符）分隔数据的文本文件。
*   管道分隔字段中的每个数据字段都可以是可变长度的，因此计数字符将不起作用（或使用某种子字符串函数......如果它甚至存在于 Vim 中）。

是否可以使用 Vim 删除整个文件从第二个管道到行尾的所有数据？大约有 150,000 行，因此手动执行此操作只会吸引受虐狂……

例如，更改以下行：

```
1111|random sized text 12345|more random data la la la|1111|abcde
2222|random sized text abcdefghijk|la la la la|2222|defgh
3333|random sized text|more random data|33333|ijklmnop 
```

到：

```
1111|random sized text 12345
2222|random sized text abcdefghijk
3333|random sized text 
```

我确信这可以以某种方式完成......我希望。

**更新：**我应该提到我在 Windows XP 上运行它，所以我无法访问一些提到的 *nix 命令（`cut`在 Windows 上无法识别）。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-01-15T20:38:33.157

```
:%s/^\v([^|]+\|[^|]+)\|.*$/\1/ 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-15T20:43:58.560

您还可以录制宏：

```
qq02f|Djq 
```

然后你就可以玩它`100@q`来在接下来的 100 行运行宏。

宏观解释：

*   `qq`：开始宏录制；
*   `0`: 转到该行的第一个字符；
*   `2f|`：查找该`|` 字符在该行中的第二次出现；
*   `D`: 删除当前位置到行尾的文本；
*   `j`: 转到下一行；
*   `q`: 结束宏录制。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-15T20:43:02.213

如果您不必使用 Vim，另一种选择是 unix`cut`命令：

```
cut -d '|' -f 1-2 file > out.file 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-15T22:31:52.010

做同样事情的另一种 Vim 方法：

```
%s/^\(.\{-}|\)\{2}\zs.*//
%s/^\(.\{-}\zs|\)\{2}.*//  " If you want to remove the second pipe as well. 
```

这一次，正则表达式匹配尽可能少的字符 ( `\{-}`)，然后是 `|`两次 ( `\{2}`)，它们被忽略以将所有后续文本 ( `\zs`) 替换为空 ( `//`)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-09-30T04:47:00.173

代替替换，可以使用该`:normal`命令在每一行上重复一系列两个普通模式命令：`2f|`，跳转到该`|` 行的第二个字符，然后`D`，删除所有内容直到行尾。

```
:%norm!2f|D 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-01-28T18:51:14.323

您可以使用`:command`用户命令来运行替换：

```
:command -range=% YourNameHere <line1>,<line2>s/^\v([^|]+\|[^|]+)\|.*$/\1/ 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-01-15T20:48:21.657

你也可以这样做：

```
:%s/^\([^\|]\+|[^\|]\+\)\|.*$/\1/g 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-03-27T13:58:23.760

使用 awk：

```
awk -F"|" '{$0=$1"|"$2}1' file 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-15T20:40:47.677

我发现 vim 不擅长处理非常大的文件。我不确定你的文件有多大。也许 cat 和 sed 一起工作会更好。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-15T20:41:12.887

这是一个 sed 解决方案：

```
sed -e 's/^\([^|]*|[^|]*\).*$/\1/' 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-15T20:42:57.453

为什么要使用 Vim？为什么不直接跑

```
cat my_pipe_file | cut -d'|' -f1-2 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-15T21:02:19.677

`1,$`这将通过 cut过滤缓冲区 ( ) 中的所有行来完成这项工作：

```
:1,$!cut -d '|' -f 1-2 
```

要仅在当前行上执行此操作，请尝试：

```
:.!cut -d '|' -f 1-2 
```

# visual-sourcesafe - VSS 的有效绑定根？

> ID：448350
> 
> 赞同：3
> 
> 时间：2009-01-15T20:32:08.710
> 
> 标签：visual-sourcesafe

我正在尝试为我拥有的项目修复 Visual Source Safe 绑定，当我选择我认为项目应该绑定到的位置时，我得到一个对话框，上面写着：

`The folder you chose is not a valid binding root for the projects you have selected. You attempted to retarget a solution to a source control folder that is not within the solution's root. In the change source control dialog box, specify the root for the solution. Select the folder 5 levels higher in the tree to chagne the source control bindings correctly.`

这到底是什么意思？5 级以上没有文件夹。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-16T19:48:29.260

我想我想通了这一点。我打开了我的 vcproj 文件并搜索了 ..\..\.. 并找到了对文件 5 目录“更高”的几个引用。我删除了那些引用（这些文件实际上并不存在）并重新打开了该项目。完成此操作后，我可以将项目重新绑定到 SourceSafe。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-16T10:24:43.327

您可能需要检查文件“（项目名称）.vspscc”的本地版本是否为最新版本。它解决了我的上下文中的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-10T17:09:31.363

我遇到了同样的基本问题，VSS 要求我选择比我选择的目录高两级的目录。

在记事本中编辑 .vcproj 文件，我发现“SccLocalPath=..\..”，以及对位于“..\..”相对路径目录中的两个文件的引用（这两个文件都应该已从项目中删除） . 我手动从 .vcproj 中删除了这两个文件，并将 SccLocalPath 更改为简单的“..”，问题解决了。

# c# - 您如何确定何时单击父级上的子级中的按钮 - ASP.NET

> ID：448363
> 
> 赞同：0
> 
> 时间：2009-01-15T20:36:22.583
> 
> 标签：c#, asp.net, gridview, updatepanel, parent-child

在我的子用户控件中，我有一个带有 OnRowCommand 事件处理程序的网格视图，该处理程序在单击编辑按钮时执行。当在子控件中单击“编辑”按钮时，我想将父控件中的 ASP.NET 占位符控件的可见性设置为 true。

完成这项任务的最佳方法是什么？

**更新：**
在互联网上进行了更多研究后，我在我的子控件中创建了一个公共事件事件处理程序，并在触发 OnRowCommand 事件时引发了该事件。在父控件的 page_load 事件中，我将子用户控件事件映射到父控件中的私有事件。

子控件源代码：

```
public event EventHandler MyEvent;

protected void MyGridView_OnRowCommand(object sender, GridViewCommandEventsArgs e)
{
    if(MyEvent != null)
        MyEvent(sender, e);
} 
```

家长控制源代码：

```
protected void Page_Load(object sender, EventArgs e)
{
    MyChildControl.MyEvent += new EventHandler(this.MyLocalEvent);
}

private void MyLocalEvent(object sender, EventArgs e)
{
    MyPlaceHolder.Visible = true;
    MyUpdatePanel.Update();
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T20:40:31.140

在我的脑海中，我要么在子用户控件中创建一个新事件，该事件将在 OnRowCommand 触发时触发，要么使用 OnBubbleEvent - 我不记得确切的名称，但它是类似的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T21:11:54.090

除了冒泡事件，还有两种方法值得考虑：

一种。在您的子用户控件中创建一个新事件。在父控件中监听此事件。在子控件中触发此事件。

湾。在父控件中监听 gridview 事件 OnRowCommand。

方法 a 更好，因为泄漏的抽象更少。B 又快又脏，但如果这是一次性使用的用户控件，则不会产生负面影响。

创建事件相当容易，许多程序都包含事件模板，这意味着您输入的唯一内容就是事件的名称（例如 Resharper）。

# networking - 为什么这些文件夹的共享名称会附加美元符号？

> ID：448371
> 
> 赞同：64
> 
> 时间：2009-01-15T20:38:39.367
> 
> 标签：networking

我最近在一家刚刚失去服务器/网络管理员的公司担任 Web 开发职位。尽管我被聘为 Web 开发人员，但我被要求在服务器上执行一些日常维护任务，但我仍然遇到了麻烦，没有这类事情的背景。我们失去了与旧网络管理员的所有通信也无济于事。

这是情况。该大学这部分的几十名教职员工在服务器（Windows Server 2003，SP 2）上共享目录，例如`\\servername\Jones$`、`\\servername\Smith$`和`\\servername\Watson$`. 我的问题是：**为什么股票名称会附加美元符号？**这似乎不是技术要求，也不会将这些文件夹与其他类似名称的文件夹区分开来。**这种标准风格，是某种我无法理解的要求，还是我应该作为上一个管理员怪癖的产物而注销的东西？**

为有点蹩脚的问题道歉，但我无法弄清楚这一点，并且我一直在继续添加带有美元符号附加共享名称的新目录，因为我不确定它是否真的有必要。

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-01-15T20:45:14.673

SMB/CIFS URIs 中的 $ 表示共享是隐藏的，浏览共享文件夹时不会显示。这通常但不一定意味着它需要管理员权限才能访问它。

此约定也适用于共享打印机。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-01-15T20:42:30.437

在共享名称末尾添加美元符号 ($) 将隐藏网络邻居目录中的资源。这称为隐藏共享。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-01-15T20:45:37.713

`net view`附加美元符号会使共享隐藏，因此如果您在 Windows 资源管理器中浏览到计算机或在命令行上使用，它不会显示。

如果您想分享以在这些情况下出现，请不要在上面加上 $。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-01-15T20:46:25.497

共享名称末尾的 $ 隐藏了人们浏览的共享。

例如，如果您有一个共享“\computer1\share1$”，则浏览到“\computer1”的任何人都不会看到列出的该共享。

但是，如果您创建了“\computer1\share2”，他们将能够看到该共享。

这是我所知道的唯一区别。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-01-15T20:45:54.953

它们是“管理员共享”，如果您使用 Windows 资源管理器或大多数其他浏览工具浏览 \computer，它们通常是隐藏的。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-01-15T20:57:30.110

这是一个隐藏的共享。它不仅不显示，而且也不可搜索。

* * *

## 回答 #7

> 赞同：-3
> 
> 时间：2009-01-15T20:46:14.640

我知道，为了访问目标机器的非共享目录，您需要执行类似 \machinename\c$ 之类的操作，其中 c$ 代表 C:\ 驱动器。我不确定在这种情况下是否是这种情况。

# vb.net - 关联端未映射到 ADO 实体框架中

> ID：448374
> 
> 赞同：10
> 
> 时间：2009-01-15T20:39:36.137
> 
> 标签：vb.net, entity-framework, visual-studio-2008, ado.net

我刚开始使用 ADO.net Entity Framework 我已经将两个表映射在一起并收到以下错误：

```
Error   1   Error 11010: Association End 'OperatorAccess' is not mapped.    E:\Visual Studio\projects\Brandi II\Brandi II\Hospitals.edmx    390 11  Brandi II 
```

不知道我做错了什么。

我相信我可以为这个问题增加一些清晰度（边学习边学习）：

当我查看映射详细信息并查看关联时，operatoraccess 表的列（从上方）为空白，下拉列表仅包含链接表中的字段。

[![替代文字](https://i.stack.imgur.com/xaWL4.jpg)](https://i.stack.imgur.com/xaWL4.jpg)

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2010-05-05T15:05:20.887

实体框架设计器很糟糕 - 我多次遇到同样的问题（还有你的问题，克雷格）：

**当您的多对一关联设置不正确时，就会发生这种情况。** 他们可以*很容易地*修复设计师，使这个过程变得简单；但相反，我们必须忍受这种废话。

* * *

## 修理：

*   单击关联，然后转到*映射详细信息*视图。
*   在关联下，单击*Maps to <tablename>*。选择构成关系的*多方*的表（即，构成设计器中关联的 * 方的表）
*   在*Column*下，选择映射到每个实体端属性的表列。 **当这些条目之一为空白时，您会收到此错误**。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T20:53:55.780

您的问题中没有很多信息，但是，一般来说，这意味着存在不完全定义的关联。可能是您尝试将具有外键的一个表映射到另一个表，但没有映射该另一个表。当您尝试按类型继承表而不仔细遵循[实现该功能的步骤](http://msdn.microsoft.com/en-us/library/cc716702.aspx)时，您也可能会收到此错误。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-24T00:24:03.407

不确定答案，但我刚刚发布了一个类似的问题，这至少可以帮助澄清您遇到的问题。 [定义实体框架 1:1 关联](https://stackoverflow.com/questions/475150/defining-an-entity-framework-11-association)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-04-17T19:48:40.250

我遇到了完全相同的问题，这就是我为解决它所做的。

确保您在您的设计器中在您与之关联的表上设置了**实体键。**还要检查**StoreGeneratedPattern**是否设置为该实体键的**标识。**

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T16:45:46.370

我不得不回到数据库本身并澄清外键关系

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-05-23T02:35:48.567

在创建多到 0..1 和 0..1 到 0..1 关联的情况下，我遇到了这个问题。一个实体需要关联到多个表，而该实体没有为这些表定义外键。

我必须执行已接受答案中给出的表映射步骤，但请注意，这不仅适用于多对多关联；它适用于我为此实体添加的所有类型的关联。

在 Mapping Details 视图中，我必须选择具有非外键 ID 列的实体到各个表。这并不总是关系的“多”方面。只有我能够将相关实体属性映射到原始实体中的适当属性。选择“目标”实体将不允许我选择我需要的属性，并且错误仍然存​​在。

所以简而言之，我必须使用与实体相关的表进行映射，该表具有与我需要关联的各种实体（及其表的）主键相对应的“非外键”ID 字段。

## 实体 A

各种其他属性...

*   ID
*   联系人 ID
*   订单编号

等等

## 联系实体

*   ID
*   名
*   姓氏等

在映射详细信息中，我选择了***实体 A 的***表。然后它显示了关联的两端。我将其实体 A 的 Id 属性映射到其表的实际 ID 列（它们具有不同的名称）。然后，我将 Contact 实体的 Id 字段映射到 A 实体上的 ContactId 字段。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-08-22T14:37:04.857

只需从 Association>Edit Mapping 中选择多个关系表 (*) 并选择适当的关系

# c# - 使用 C# 正则表达式替换 XML 元素内容

> ID：448376
> 
> 赞同：4
> 
> 时间：2009-01-15T20:40:08.070
> 
> 标签：c#, .net, xml, regex, parsing

我正在编写一些处理记录 xml 数据的代码，并且我希望能够替换文档中某些元素（例如密码）的内容。我宁愿不序列化和解析文档，因为我的代码将处理各种模式。

样本输入文件：

文档#1：

```
 <user>
       <userid>jsmith</userid>
       <password>myPword</password>
    </user> 
```

文档#2：

```
<secinfo>
       <ns:username>jsmith</ns:username>
       <ns:password>myPword</ns:password>
 </secinfo> 
```

我希望我的输出是：

输出文档#1：

```
<user>
       <userid>jsmith</userid>
       <password>XXXXX</password>
 </user> 
```

输出文档#2：

```
<secinfo>
       <ns:username>jsmith</ns:username>
       <ns:password>XXXXX</ns:password>
 </secinfo> 
```

由于我将要处理的文档可能有多种模式，因此我希望提出一个很好的通用正则表达式解决方案，可以找到其中包含密码的元素并相应地屏蔽内容。

我可以使用正则表达式和 C# 解决这个问题，还是有更有效的方法？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-15T20:46:05.077

这个问题最好用 XSLT 解决：

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
    <xsl:template match="@* | node()">
        <xsl:copy>
            <xsl:apply-templates select="@* | node()"/>
        </xsl:copy>
    </xsl:template>
    <xsl:template match="//password">
        <xsl:copy>
            <xsl:text>XXXXX</xsl:text>
        </xsl:copy>
    </xsl:template>
</xsl:stylesheet> 
```

只要您正确处理命名空间，这将适用于两个输入。

### 编辑：澄清我的意思是“正确处理命名空间”

确保具有`ns`名称前缀的源文档具有为文档定义的命名空间，如下所示：

```
<?xml version="1.0" encoding="utf-8"?>
<secinfo xmlns:ns="urn:foo">
    <ns:username>jsmith</ns:username>
    <ns:password>XXXXX</ns:password>
</secinfo> 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-15T20:45:43.207

我会说您最好使用 .NET XmlDocument 对象解析内容并使用 XPath 查找密码元素，然后更改它们的 innerXML 属性。它的优点是更正确（因为 XML 首先不是常规的），并且在概念上易于理解。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-01-15T21:22:07.313

根据尝试在没有适当解析器的情况下解析和/或修改 XML 的系统的经验，让我说：**不要这样做**。使用 XML 解析器（这里有其他答案可以快速轻松地做到这一点）。

使用非 xml 方法来解析和/或修改 XML 流总是会让您在未来的某个时候感到痛苦。我知道，因为我感受到了那种痛苦。

我知道如果您使用正则表达式解决方案，它似乎会在运行时更快/更简单的代码/更容易理解/无论如何。但你以后只会让某人的生活变得悲惨。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-15T21:18:14.357

如果您对要匹配的内容有足够的了解，则**可以使用正则表达式。**例如，如果您正在寻找其中包含“密码”一词且没有内部标签的任何标签，则此正则表达式将起作用：

```
(<([^>]*?password[^>]*?)>)([^<]*?)(<\/\2>) 
```

您也可以在 zowat 的答案中使用相同的 C# replace 语句，但对于替换字符串，您可能希望使用 "$1XXXXX$4" 代替。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T21:34:39.707

正则表达式是错误的方法，当你最不期望的时候，我已经看到它出现了严重错误。

无论如何，XDocument 更有趣：

```
XDocument doc = XDocument.Parse(@"
            <user>
                <userid>jsmith</userid>
                <password>password</password>
            </user>");

doc.Element("user").Element("password").Value = "XXXX";

// Temp namespace just for the purposes of the example -
XDocument doc2 = XDocument.Parse(@"
            <secinfo xmlns:ns='http://tempuru.org/users'>
                <ns:userid>jsmith</ns:userid>
                <ns:password>password</ns:password>
            </secinfo>");

doc2.Element("secinfo").Element("{http://tempuru.org/users}password").Value = "XXXXX"; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-16T19:31:14.457

这是我在使用 XMLDocument 时想到的，它可能不像 XSLT 那样流畅，但应该足够通用以处理各种文档：

```
 //input is a String with some valid XML
            XmlDocument doc = new XmlDocument();
            doc.LoadXml(input);
            XmlNodeList nodeList = doc.SelectNodes("//*");

            foreach (XmlNode node in nodeList)
            {
                if (node.Name.ToUpper().Contains("PASSWORD"))
                {
                    node.InnerText = "XXXX";
                }
                else if (node.Attributes.Count > 0)
                {
                    foreach (XmlAttribute a in node.Attributes)
                    {
                        if (a.LocalName.ToUpper().Contains("PASSWORD"))
                        {
                            a.InnerText = "XXXXX";
                        }
                    }
                }    
            } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-11-10T07:57:54.077

XSLT 存在的主要原因是能够转换 XML 结构，这意味着 XSLT 是一种样式表，可以用来改变元素的顺序和元素的内容。因此，这是一种典型的情况，强烈建议使用 XSLT，而不是像 Andrew Hare 在前一篇文章中所说的那样进行解析。

# html - PDF转网页

> ID：448399
> 
> 赞同：0
> 
> 时间：2009-01-15T20:46:13.983
> 
> 标签：html, pdf

我得到一个完整的 .pdf 文件，其中包含图像、精美的字体、样式、渐变以及你拥有的东西。基本上它是通过消息传递给我的，“为我制作一个看起来完全像这样的网页。” 我尝试了一些 pdf 到 html 的工具，它们看起来都很糟糕。我想我只有两个选择，我讨厌他们两个。

1.  将 pdf 转换为一个大图像并使用图像映射添加链接。
2.  acrobat reader 附带的屏幕复制工具，用于将文件分割成各个部分（按钮、徽标等）。

她使用 Quarks 制作了这个 pdf。我从未使用过它，但我听说它很受欢迎。这些真的是我唯一的两个选择吗？请有人告诉我我错了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T20:53:59.103

从 PDF 中获取您可以使用的文本并进行清理。将 PDF 拉入 Photoshop 并切出您要使用的图形元素。使用图像重建页面并将您的文本放入 HTML 格式。

制作一片渐变并将它们用作重复的背景图像。

尝试向您的客户解释为什么花哨的字体不适合这种媒体。

编辑：

如果它只是一个屏幕截图，您不妨先把 PDF 放在首位。至少人们可以放大。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T20:53:33.720

不要使用一张大的图像地图。您可以从图像转换为文本的内容越多，您的 HTML 页面就会越好（更高效）。

将 PDF 分成几部分。制作徽标等图像，制作纯文本文本，制作按钮按钮控件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T21:07:17.327

就像狄奥德斯所说的一样，除了——

- 找到花哨的字体并查看许可或购买它的成本。制作两张账单并将它们发送给您的客户，一张使用精美字体，另一张使用标准字体。然后看看她是否想要花哨的字体。这将表明您认真对待您的工作，并可能使您的项目条件不那么严格。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T20:53:55.700

不，他们不是：

Adobes Online pdf 到 html[服务](http://www.adobe.com/products/acrobat/access_onlinetools.html)

或者

[pdftohtml](http://pdftohtml.sourceforge.net/)

# sql-server-2005 - 如何使用跨多个服务器链接的过程的事务？

> ID：448401
> 
> 赞同：6
> 
> 时间：2009-01-15T20:46:23.283
> 
> 标签：sql-server-2005, tsql, transactions

我正在尝试测试我们的一个供应商向我们提出的用于访问他们的产品数据库的命题，它涉及跨多个服务器的查询和事务。我以前从来没有直接在数据库上做过这个，坦率地说，我一无所知，所以我试图模拟一个证明这至少在概念上有效的证据。

我有两台 SQL Server 2005 服务器。为了争论，我们称它们为 Server1 和 Server2 [保持你的掌声] 每个都包含一个虚拟数据库。Server1 上的虚拟数据库称为 Source，Server2 上的虚拟数据库称为 Destination，只是为了简单起见。每个数据库分别保存一个名为 Input 和 Output 的表，因此该结构准解释如下：

*   Server1.Source.dbo.Input
*   Server2.Destination.dbo.Output

我在 Server2 上有一个名为 WriteDataToOutput 的存储过程，它接收单个 Varchar 参数并将其内容写入输出表。

现在棘手的问题开始了：

1.  我想在 Server1.Source 上创建一个存储过程，它调用在 Server2 上定义的 WriteDataToOutput 存储过程，这看起来很简单。
2.  我希望此调用成为事务的一部分，以便如果调用它的过程失败，则回滚整个事务。

至此，我不知道该做什么了。谁能指出我正确的方向？我在同一台服务器上的两个不同数据库上试过这个，它工作得很好，让我假设它可以在不同的服务器上工作，问题是，我该怎么做这样的事情？我从哪里开始？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-15T21:08:44.593

正如其他人所指出的，我同意链接服务器是最好的方法。

这是我第一次处理链接服务器时吸引我的一些建议：

*   如果链接服务器是实例，请确保将名称括起来。例如 [服务器名称\实例名称]。

*   为链接服务器中的表或视图使用别名，否则您将收到“无法绑定多部分标识符”错误。有 4 部分命名约定的限制。例如 SERVER.DATABASE.dbo.TABLE.FIELD 有五个部分，会报错。但是，`SELECT linked.FieldName FROM SERVER.DATABASE.dbo.TABLE AS linked`会正常工作

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-15T20:51:23.647

您将要链接服务器：

[http://msdn.microsoft.com/en-us/library/aa213778.aspx](http://msdn.microsoft.com/en-us/library/aa213778.aspx)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-15T21:02:46.697

对于第 2 步，您需要运行分布式事务协调器，您还需要使用 SET XACT_ABORT ON 以确保它会全部回滚您还需要启用 RPC，它在 2005 年及更高版本中默认关闭

有一大堆东西可以咬你的脖子

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-15T21:59:13.777

[MSDN](http://msdn.microsoft.com/en-us/library/ms188386.aspx)说，如果您使用命令 BEGIN DISTRIBUTED TRANSACTION，则可以跨链接服务器进行事务。

我记得虽然我在链接服务器上遇到了称为存储过程的问题，但我解决了它，而不是解决它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T21:05:59.513

使用链接服务器，您可以使用 DTC（分布式事务处理协调器）在单个事务中在任一服务器上运行存储过程。你肯定会想做一些性能分析。我发现一些使用链接的 SP 会大大降低数据库性能，尤其是当您尝试从两台服务器中的每台连接结果集时。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T21:07:45.003

设置链接服务器，然后您应该能够跨服务器执行选择/插入/更新。就像是：

```
INSERT INTO Server2.Destination.dbo.Output
SELECT * FROM Input  
WHERE <Criteria> 
```

这假设您正在从 Server1.Source 运行查询，因此您不需要完全限定。

# nhibernate - NHibernate 测试，模拟 ISession

> ID：448405
> 
> 赞同：6
> 
> 时间：2009-01-15T20:46:41.067
> 
> 标签：nhibernate, mocking, iqueryable

我正在使用 NHibernate 和 Rhinomocks 并且无法测试我想要的内容。我想在不访问数据库的情况下测试以下存储库方法（其中 _session 作为 ISession 注入到存储库中）：

```
public class Repository : IRepository
{
    (... code snipped for brevity ...)

    public T FindBy<T>(Expression<Func<T, bool>> where)
    {  
        return _session.Linq<T>().Where(where).FirstOrDefault();
    }
} 
```

我最初的方法是模拟 ISession，并在调用 Linq 时返回一个 IQueryable 存根（手动编码）。我有一个客户对象的 IList，我想在内存中查询以测试我的 Linq 查询代码，而无需访问数据库。而且我不确定这会是什么样子。我是否编写自己的 IQueryable 实现？如果是这样，有人为这种方法做过吗？还是我需要看看其他途径？

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-15T22:19:19.833

我如何完成这个测试是不将表达式传递给存储库，而是公开 IQueryable 为存储库提供一个接口，例如：

```
public interface IRepository<T>
{
    IQueryable<T> All();
    // whatever else you want
} 
```

像这样轻松实现：

```
public IQueryable<T> All()
{
    return session.Linq<T>();
} 
```

这意味着，而不是像在存储库上调用您的方法：

```
var result = repository.FindBy(x => x.Id == 1); 
```

你可以做：

```
var result = repository.All().Where(x => x.Id == 1); 
```

或者 LINQ 语法：

```
var result = from instance in repository.All()
             where instance.Id == 1
             select instance; 
```

这意味着您可以通过直接模拟存储库来获得相同的测试，这应该更容易。您只需让模拟返回您创建并调用 AsQueryable() 的列表。

正如您所指出的，这样做的目的是让您在不涉及数据库的情况下测试查询的逻辑，这会大大减慢它们的速度。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T21:44:08.237

从我的角度来看，这将被视为集成测试。NHibernate 有它自己通过的测试，在我看来，您正在尝试在自己的测试套件中复制其中的一些测试。我要么将 NHibernate 代码和测试添加到您的项目中，并将其与他们的测试一起添加到那里，如果他们没有一个非常相似的，并使用他们的测试方法或将其移动到集成测试场景并点击数据库。

如果这只是您不想设置数据库来测试您的事实，那么您很幸运，因为您使用的是 NHibernate。通过一些谷歌搜索，您可以找到很多示例，说明如何使用 SQLite “有点”与数据库进行集成测试，但将其保存在内存中。

# bash - 用于接收和重新传递引用参数的 Bash 脚本

> ID：448407
> 
> 赞同：102
> 
> 时间：2009-01-15T20:47:34.747
> 
> 标签：bash, unix

我试图让嵌套脚本安全地接收bash脚本的引用参数。有任何想法吗？

测试.sh

```
#!/bin/bash
echo $*
bash myecho.sh $* 
```

myecho.sh

```
#!/bin/bash
 echo $1
 echo $2
 echo $3
 echo $4 
```

样本：

```
bash test.sh aaa bbb '"ccc ddd"' 
```

结果：

```
aaa bbb "ccc ddd"
aaa
bbb
"ccc
ddd" 
```

想要的结果

```
aaa bbb "ccc ddd"
aaa
bbb
ccc ddd 
```

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2010-10-21T18:10:02.837

您想使用“$@”（引用美元）将参数传递给下标。像这样......

**`ls-color.sh:`**

```
#!/bin/bash
/bin/ls --color=auto "$@"    # passes though all CLI-args to 'ls' 
```

### 至于为什么……

从[Bash 手册页](http://linux.die.net/man/1/bash)：

> `$*`-- 展开到位置参数，从一开始。当扩展出现在双引号内时，它会扩展为单个单词，每个参数的值由 IFS 特殊变量的第一个字符分隔。也就是说，`"$*"`等价于 `"$1c$2c..."`，其中 c 是 IFS 变量值的第一个字符。如果未设置 IFS，则参数以空格分隔。如果 IFS 为空，则将参数连接起来而不插入分隔符。
> 
> `$@`-- 展开到位置参数，从一开始。当扩展出现在双引号内时，每个参数都扩展为一个单独的单词。即`"$@"`相当于`"$1" "$2" ...`如果双引号展开出现在一个单词中，第一个参数的展开与原词的开头部分连接，最后一个参数的展开与原词的最后部分连接单词。当没有位置参数时， `"$@"`扩展`$@`为空（即，它们被删除）。

* * *

*设置一些演示脚本...*

```
echo 'echo -e "\$1=$1\n\$2=$2\n\$3=$3\n\$4=$4"' > echo-params.sh
echo './echo-params.sh $*' > dollar-star.sh
echo './echo-params.sh $@' > dollar-at.sh
echo './echo-params.sh "$*"' > quoted-dollar-star.sh
echo './echo-params.sh "$@"' > quoted-dollar-at.sh
chmod +x *.sh 
```

`"$@"`-quoted-dollar-at 是一种***身份转换***，用于将 args 重新传递给子 shell（大约 99% 的时间，这就是你的意思）：

```
./quoted-dollar-at.sh aaa '' "'cc cc'" '"ddd ddd"'
  # $1= aaa
  # $2=            
  # $3= 'cc cc'
  # $4= "ddd ddd" 
```

`"$*"`-quoted-dollar-star***将 args 粉碎成一个字符串*** （大约 1% 的时间你实际上想要这种行为，例如在条件：）`if [[ -z "$*" ]]; then ...`：

```
./quoted-dollar-star.sh aaa '' "'cc cc'" '"ddd ddd"'
  # $1= aaa  'cc cc' "ddd ddd"   
  # $2=                     
  # $3=             
  # $4= 
```

`$*`/ `$@`- 没有引号，两种形式都会去掉一层引号并解释底层字符串中的空格，但忽略引号字符（几乎总是，这是一个错误）：

```
./dollar-star.sh aaa '' "'cc cc'" '"ddd ddd"'
  # $1= aaa
  # $2= 'cc                  
  # $3= cc'
  # $4= "ddd

./dollar-at.sh aaa '' "'cc cc'" '"ddd ddd"'
  # $1= aaa
  # $2= 'cc
  # $3= cc'
  # $4= "ddd 
```

* * *

如果你想找点乐子，你可以使用 "$@" 将东西嵌套到你想要的深度，如果你愿意，可以从 args 堆栈中推送和弹出元素。

```
function identity() {
  "$@"
}
set -x
identity identity identity identity identity echo Hello \"World\"
# + identity identity identity identity identity echo Hello '"World"'
# + identity identity identity identity echo Hello '"World"'
# + identity identity identity echo Hello '"World"'
# + identity identity echo Hello '"World"'
# + identity echo Hello '"World"'
# + echo Hello '"World"'
# Hello "World" 
```

* * *

## 回答 #2

> 赞同：72
> 
> 时间：2009-01-15T20:50:10.687

```
#!/bin/bash
echo $*
bash myecho.sh "$@" 
```

请注意，“$@”构造不是特定于 bash 的，它应该适用于任何 POSIX shell（它至少适用于破折号）。另请注意，给定您想要的输出，您根本不需要额外的引用级别。IE 只需调用上面的脚本，如：

```
./test.sh 1 2 "3 4" 
```

# c# - 学习移动适配技术的好资源

> ID：448411
> 
> 赞同：-1
> 
> 时间：2009-01-15T20:48:33.713
> 
> 标签：c#, asp.net, mobile

我是一名 Web 开发人员，多年来一直使用基于 ASP.NET 的门户应用程序。最近，我的公司委托我开发我们的门户产品的移动版本。

我找到了很多关于开发移动 Web 应用程序的资源，并且在我的任务中取得了很大的进步；然而，我还没有找到任何有价值的资源的一个主题是[内容改编](https://en.wikipedia.org/wiki/Content_adaptation)（特别是与 ASP.NET 的改编）：

> 内容适配是转换内容以适应设备能力的动作。内容适配通常与移动设备相关，移动设备由于计算能力有限、屏幕尺寸小和键盘功能受限而需要特殊处理。

我发现 MSDN 上的一些资源有点用处，但在具体示例方面并没有看到太多。

* * *

有谁知道这个主题的好网站或书籍，包括具体的例子？

**注意**：我通常在 中编码`C#`，但可以翻译大多数语言，因此不需要`C#`集中注意力（尽管它是首选）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-06T18:38:51.597

我不得不说，您最好的体验将是

WURFL 和邮件列表 wmlprogramming

从那里我还建议阅读 mobiforge，因为他们有很多关于如何为移动设备做事的文章，即使它是为 Java 和 PHP 编写的

总的来说，我发现 Java/PHP 社区在移动开发方面比 ASP.NET 社区走得更远。

我把它归结为微软对移动控件的糟糕实施。

# .net - 收据打印机？

> ID：448412
> 
> 赞同：8
> 
> 时间：2009-01-15T20:48:37.023
> 
> 标签：.net, printing, point-of-sale, zebra-printers

我正在开发一个需要打印收据的软件。

收据打印机最常见的类型是什么？

收据打印机 API 是否有任何行业标准？

有没有 .net 库呢？试图找到但没有找到任何东西。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-01-16T09:09:41.097

UnifiedPOS 是当今用于与销售点外围设备（包括收据打印机）通信的最常见 API：[http://www.nrf-arts.org/UnifiedPOS/default.htm](http://www.nrf-arts.org/UnifiedPOS/default.htm)。

Microsoft 有一个 .NET 的实现：[http://msdn.microsoft.com/en-us/library/ms828083.aspx](http://msdn.microsoft.com/en-us/library/ms828083.aspx)。

UnifiedPOS 从 OPOS（零售 POS 的 OLE）演变而来，因此请在 Google 上搜索 OPOS 以获取更多信息。您会发现支持 OPOS 的外围设备制造商比其他类型的 UnifiedPOS 多。Microsoft 的 .NET POS 将与 OPOS V1.8 服务对象一起使用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-15T20:53:03.767

[爱普生](http://pos.epson.com/developers/index.htm)有一个非常标准的系统。

[斑马](http://www.zebra.com/)是另一个大玩家。

在谷歌搜索其他帮助时，您可能想要寻找“POS 打印机”，而不是“收据打印机”，其中 POS 代表“销售点”。这样你会得到更多更好的点击。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-16T20:57:42.317

CodePlex 有一个 Zebra 项目，我用它来打印标签

[http://www.codeplex.com/sharpzebra](http://www.codeplex.com/sharpzebra)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-15T21:03:08.413

我过去使用过 Zebra 打印机。我不确定用于动态创建新文档的 API，但您可以使用他们的设计器来构建“文档”并动态填充和打印。他们的软件还可以，但我们发现 BarTender 在我们的实施中工作得更好一些。

Zebra 还有一种 Zebra 编程语言 (ZPL)，实际上使用起来很有趣（Windows 驱动程序在 2 年前非常糟糕）。文档非常好，很容易上手。我去扔了几个线轴，试图把一切都弄好。:-)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-06-14T05:43:11.723

如果您对 java 解决方案满意，请尝试 jzebra：[http ://code.google.com/p/jzebra](http://code.google.com/p/jzebra)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T20:54:21.863

Star Micronics，我在野外看到了很多；从未使用过它们，但使用本机 Windows 打印机驱动程序，我认为使用起来非常简单。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-15T21:33:02.970

[Verifone](http://www.verifone.com/)（大型 POS 和 pin-pad 制造商）也有几种打印机型号。

# emacs - 如何在 GNU Emacs 中实现相当于 Vim 的 Ctrl-n？

> ID：448428
> 
> 赞同：10
> 
> 时间：2009-01-15T20:54:13.453
> 
> 标签：emacs, autocomplete

Vim 的`Ctrl`+`N`通常是这样工作的：我输入几个字母，点击`Ctrl`+ `N`，Vim 会根据我所有打开的缓冲区中的单词为我提供补全。

Emacs 的解决方案不必完全相同。我主要是这样使用它：声明变量，然后在以后的代码中使用它。但我喜欢*不*解析源代码的轻量级方法。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-15T21:33:01.503

你想要 dabbrev-expand，默认绑定到 M-/。我没有使用过 Vim，但从你的描述来看，它的作用完全相同。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-01-15T21:28:15.693

试试 hippie-expand，绑定到你最喜欢的键

```
(global-set-key (kbd "M-/") 'hippie-expand) 
```

而不是呈现完成列表，而是通过就地完成重复点击绑定键循环。

为什么“嬉皮”-展开？我不知道，实际上我避免查看该函数，因为该名称没有提供信息且令人反感，直到我阅读[了“Life Is Too Short For Bad Code”的文章。](http://trey-jackson.blogspot.com/2007/12/emacs-tip-5-hippie-expand.html)（[hippie-expand 上的 EmacsWiki 条目](http://www.emacswiki.org/emacs/HippieExpand)也问“为什么是‘嬉皮士？’”，但也无法回答。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-16T03:00:07.787

我个人使用[AutoComplete](http://www.emacswiki.org/emacs/AutoComplete)它为您提供了一个不错的下拉框。您可以选择在激活之前要输入多少个字母，并自定义要显示的内容，包括 dabbrev-expand 中的内容。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-15T21:00:13.520

```
;; Allow tab to autocomplete

 (defun indent-or-expand (arg)
   "Either indent according to mode, or expand the word preceding point."
   (interactive "*P")
   (if (and
        (or (bobp)      (= ?w (char-syntax (char-before))))
        (or (eobp) (not (= ?w (char-syntax (char-after))))))
       (dabbrev-expand arg)
     (tab-to-tab-stop)))

 (defun my-tab-fix ()
   (local-set-key [tab] 'indent-or-expand))

 (add-hook 'as-mode-hook         'my-tab-fix)
 (add-hook 'java-mode-hook       'my-tab-fix)
 (add-hook 'c-mode-hook          'my-tab-fix)
 (add-hook 'sh-mode-hook         'my-tab-fix)
 (add-hook 'emacs-lisp-mode-hook 'my-tab-fix) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-29T12:40:04.073

在我看来，问题是我尝试过的emacs完成在上下文方面没有完成。

例如，如果您使用方法 foobar() 和参数 foo 编写一些 OOP，M-/ 将建议您同时使用 foo 和 foobar。

但是，如果您正在调用对象方法，而不是仅仅提供“foo”完成，那就太好了。

有没有人有解决方案？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-13T22:15:15.900

Aif> 这需要的远不止“嬉皮士扩展”所能提供的。如果你编写 C/C++ 代码，你可以使用 ECB [http://ecb.sourceforge.net/](http://ecb.sourceforge.net/)但坦率地说，这个项目已经死了，这个插件不是很可靠。如果您需要非常好的智能补全，您应该尝试 Eclipse (CDT)。但是如果你编写 python 代码，那么 Emacs (rope + flymake) 和 Eclipse (PyDev) 一样好。

# security - 将自定义字段类型部署到 bin 目录

> ID：448431
> 
> 赞同：1
> 
> 时间：2009-01-15T20:55:40.533
> 
> 标签：security, sharepoint, gac, cas, fieldtype

如此处所述[，](http://msdn.microsoft.com/en-us/library/ms473257.aspx) 自定义字段类型（以及它们引用的任何 dll？）必须部署到全局程序集缓存。为什么，部署到 bin 目录可能会出现什么问题？我正在尝试通过编写 CAS 策略来保护我的代码，并且由于我的字段控件使用了很多由我的其他代码共享的帮助方法，这似乎是一个阻碍。

到目前为止，我在 bin 部署中发现的唯一问题是，当该功能被停用然后使用 STSADM 重新激活时，我收到一条错误消息，指出我的字段类型未正确安装。使用 –force 开关或通过 GUI 激活似乎工作得很好。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-15T20:59:39.277

自定义字段在场范围内安装，如果将 dll 部署到 bin 目录，则必须确保它们位于所有 Web 应用程序的 bin 目录中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-08T18:49:34.530

我忘记将我的字段类型实现的接口之一放在 GAC 中，这导致了我上面描述的问题。

结论：自定义字段类型可以引用bin目录下的dll:s，只要创建对象不需要。

# web-services - 处理来自多个 Web 服务的相同类定义

> ID：448434
> 
> 赞同：3
> 
> 时间：2009-01-15T20:56:07.523
> 
> 标签：web-services, inheritance

情况：

我们有一个库项目，其中包含我们从事的各种集成的大部分代码。许多集成使用 Web 服务 API，我的主管不希望将 5 亿个 Web 服务引用添加到项目中。

然后，我们通常做的是添加对新项目的引用并将 References.vb 复制到解决方案中，然后调用生成的代码。如果对服务进行更改，则不是很方便，但它可以工作。

最近，我遇到了一个问题，我们必须使用 3 个 Web 服务进行相同的集成。其中 2 个包含相同的类定义，但是，它们位于不同的命名空间中，因为它们属于不同的服务。这对我来说成了一个问题，因为其中一项服务根据用户 ID 搜索用户，而另一项服务则撤回用户块。两者都返回一个在语义上完全相同的对象或列表。而且我需要以相同的方式处理数据，无论它来自一项服务还是另一项服务。

我的解决方案是去除服务中重复的类，并用从公共基类继承的类替换它们。这使我可以像使用相同的对象一样使用这两个对象，但是，它需要修改生成的 Web 服务代理。因此，每次我需要重新生成代理时都需要进行此更改。

我很好奇你们可能认为更好的解决方案是什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-20T00:38:15.267

你会后悔玩复制 Reference.vb 和编辑生成的文件的游戏。

切换到 WCF，您将能够告诉它您想要重用这些类型，而不是拥有多个或多或少相同的类型。

顺便说一句，如果不是所有的 Web 引用在服务器更改后同时更新，它们将“更少”相同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-20T00:32:01.210

另一种选择是在 Web 服务预先生成的代理之上构建一个抽象层，这样当您调用抽象层时，您始终可以使用相同的对象，因为它们被挤入（和挤出） ) 抽象层中的 Web 服务代理。这也将允许进行单元测试:)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T08:59:38.853

我认为您确实应该关注 3.5+ 的 WCF，但对于 .NET 2.0，请查看 WSCF（Web 服务合同优先）之类的东西，它以 XML 定义合同并生成一组可跨服务重用的库。例如，您定义了一个 MyComany.WS.Common 命名空间并在多个项目中使用该命名空间。然后，代码生成会构建一个共享类型库，用于所有 Web 服务。我们在 .NET 2 解决方案中广泛使用它，它很棒。我们必须围绕代码生成做一些额外的工作，以使其适合我们的构建过程，但一旦完成，我们就再也没有回头。

随着时间的推移，我们正在迁移到 .NET 3.5，因此 WSCF 将变得过时

[这是 WSCF 的thinktecture](http://www.thinktecture.com/resourcearchive/tools-and-software/wscf)站点的链接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-07T15:03:20.773

`wsdl.exe``/sharetypes`如果线路签名不正确，则使用该开关允许跨多个服务定义使用相同的类型。但是，我无法在我的情况下使用它，因为各种 wsdl 合同被粗心地命名了。

# windows - Windows 和重命名文件夹，“骗局”问题

> ID：448438
> 
> 赞同：39
> 
> 时间：2009-01-15T20:56:46.163
> 
> 标签：windows, directory

为什么在 Windows 中，不能将文件夹命名为“con”？

每当我尝试将文件夹命名为“con”（不带引号）时，它默认为其原始名称。

为什么这样做？

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-01-15T21:02:24.513

回到 MS-DOS 时代，“con”有特殊的含义。它引用了控制台，并允许您像对待任何其他文件一样对待它。例如，您可以通过键入来创建一个新的文本文件`copy con new.txt`。然后你可以输入你的文字并`^Z`在完成后点击。

问题是，你仍然可以这样做。因此，就文件系统而言，已经有一个名为`con`. 还有[其他保留名称](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365247)，但是我看到在键入此名称时，其他答案中已经提供了这些名称。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-15T21:00:58.697

> 不要使用以下保留的设备名称作为文件名：
> 
> CON、PRN、AUX、NUL、COM1、COM2、COM3、COM4、COM5、COM6、COM7、COM8、COM9、LPT1、LPT2、LPT3、LPT4、LPT5、LPT6、LPT7、LPT8 和 LPT9

[资料来源：MSDN](http://msdn.microsoft.com/en-us/library/aa365247.aspx)

也不能使用其他名称，例如驱动器名称：

> 时钟$，A：-Z：

[来源：微软支持](http://support.microsoft.com/kb/74496/en-us)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-02-27T09:07:42.523

Actually you can rename the folder to `con`

use this in the command prompt and this creates a system folder named `con` on your C: Drive

```
md \\\\\.\\\C:\con 
```

to remove this folder you need to use this in the command prompt

```
rd/s \\\\.\\\C:\con 
```

And just for those that are wondering "so why would you?" - my name is CON and if I wish to use that as my folder I WILL so "bugger you MS"

Con "OzDing"

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-15T21:00:36.780

这可以追溯到 MS-DOS。从控制台读取或写入名为“CON：”的文件。我想 Windows 仍然支持它以实现向后兼容性。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-01-15T21:00:54.657

来自[微软技术网](http://www.microsoft.com/technet/prodtechnol/Windows2000Pro/reskit/part3/proch17.mspx)：

> 几个特殊的文件名是系统保留的，不能用于文件或文件夹：
> 
> CON、辅助、COM1、COM2、COM3、COM4、LPT1、LPT2、LPT3、PRN、NUL

# xaml - Xaml 中的 WPF RadioButton 组

> ID：448439
> 
> 赞同：7
> 
> 时间：2009-01-15T20:57:02.170
> 
> 标签：xaml, radiobuttonlist

在我们正在构建的 WPF 应用程序中，我们在各个 StackPanel 中并排放置了 3 组 RadioButton。我们正在尝试对以下行为进行编程。在表单中切换时，我们不想切换每个单选按钮（标准行为），而是希望切换到每个组中的“第一个”单选按钮，并能够向上/向下箭头到另一个一旦我们进入组，每个组中的单选按钮（列表）。我们为列表中第一个单选按钮下方的单选按钮设置了 IsTabStop=False。这为我们提供了在每个组中切换所需的行为，但这不允许向上/向下箭头列表的能力。仅当 IsTabStop=True 时，向上/向下箭头行为才有效。我们还尝试设置单选按钮的 GroupName 属性，但行为与上述相同。在旧的 win 表单中，有一个具有这种行为的单选按钮列表控件，我们只是试图重新创建它。有谁知道如何重新创建这种行为？在此先感谢您的帮助...！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-03-25T10:01:52.917

一种解决方案是使用样式化列表框的技术，使其看起来像一个单选按钮组。然后可以在样式列表框之间切换，并使用箭头键选择单个“单选按钮”列表框项目。

这是一个完整的演示，也可以作为[示例应用程序下载](https://skydrive.live.com/redir.aspx?cid=a7a31d7d3256ccd4&resid=A7A31D7D3256CCD4!282&parid=A7A31D7D3256CCD4!256)

```
public class RadioButtonGroupsViewModel
{
    public RadioButtonGroupsViewModel()
    {
        Items1 = new List<string> {"One", "Two", "Three"};
        Selected1 = "One";

        Items2 = new List<string> {"Four", "Five", "Six"};
        Selected2 = "Five";

        Items3 = new List<string> {"Seven", "Eight", "Nine", "Ten"};
        Selected3 = "Ten";
    }

    public IEnumerable<string> Items1 { get; private set; }
    public string Selected1 { get; set; }

    public IEnumerable<string> Items2 { get; private set; }
    public string Selected2 { get; set; }

    public IEnumerable<string> Items3 { get; private set; }
    public string Selected3 { get; set; }
} 
```

Xaml

```
xmlns:theme="clr-namespace:Microsoft.Windows.Themes;assembly=PresentationFramework.Aero" 

  <Page.Resources>  
    <Style x:Key="RadioButtonListBoxStyle" TargetType="ListBox">
      <Setter Property="BorderThickness" Value="0" />
      <Setter Property="ItemContainerStyle">
        <Setter.Value>
          <Style TargetType="ListBoxItem">
            <Setter Property="SnapsToDevicePixels" Value="true" />
            <Setter Property="OverridesDefaultStyle" Value="true" />
            <Setter Property="Template">
              <Setter.Value>
                <ControlTemplate TargetType="ListBoxItem">
                    <RadioButton 
                        IsTabStop="False"
                        GroupName=""
                        IsChecked="{Binding IsSelected, RelativeSource={RelativeSource TemplatedParent}}" >
                        <RadioButton.Content>
                            <Border VerticalAlignment=
                                    "{TemplateBinding Control.VerticalContentAlignment}" Padding="2">
                                <ContentPresenter 
                                    Margin="{TemplateBinding Control.Padding}"
                                    VerticalAlignment=
                                      "{TemplateBinding Control.VerticalContentAlignment}"
                                    HorizontalAlignment=
                                      "{TemplateBinding Control.HorizontalContentAlignment}" 
                                    RecognizesAccessKey="True" />
                            </Border>
                        </RadioButton.Content>
                    </RadioButton>
                </ControlTemplate>
              </Setter.Value>
            </Setter>
          </Style>
        </Setter.Value>
      </Setter>
    </Style>
  </Page.Resources>

  <Page.DataContext>
    <Samples:RadioButtonGroupsViewModel />
  </Page.DataContext>

  <Grid>
    <Grid.RowDefinitions>
      <RowDefinition Height="auto" />
      <RowDefinition Height="auto" />
      <RowDefinition Height="auto" />
      <RowDefinition />
    </Grid.RowDefinitions>

    <ListBox Style="{StaticResource RadioButtonListBoxStyle}" 
             ItemsSource="{Binding Items1}"
             SelectedItem="{Binding Selected1}">
      <ListBox.ItemsPanel>
        <ItemsPanelTemplate>
          <StackPanel Orientation="Horizontal" 
                      KeyboardNavigation.DirectionalNavigation="Cycle" />
        </ItemsPanelTemplate>
      </ListBox.ItemsPanel>
    </ListBox>

    <ListBox Grid.Row="1" 
             Style="{StaticResource RadioButtonListBoxStyle}" 
             ItemsSource="{Binding Items2}"
             SelectedItem="{Binding Selected2}">
      <ListBox.ItemsPanel>
        <ItemsPanelTemplate>
          <StackPanel Orientation="Horizontal" 
                      KeyboardNavigation.DirectionalNavigation="Cycle" />
        </ItemsPanelTemplate>
      </ListBox.ItemsPanel>
    </ListBox>

    <ListBox Grid.Row="2" 
             Style="{StaticResource RadioButtonListBoxStyle}" 
             ItemsSource="{Binding Items3}"
             SelectedItem="{Binding Selected3}">
      <ListBox.ItemsPanel>
        <ItemsPanelTemplate>
          <StackPanel Orientation="Horizontal" 
                      KeyboardNavigation.DirectionalNavigation="Cycle" />
        </ItemsPanelTemplate>
      </ListBox.ItemsPanel>
    </ListBox>
  </Grid> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-08-18T15:48:56.013

我认为 KeyboardNavigation 附加属性可以解决问题。

我在 XAML 中模拟了一个快速 WPF 示例（对不起，长度），使用 ItemsControls 对 RadioButton 元素进行分组：

```
<Window
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:d="http://schemas.microsoft.com/expression/blend/2008" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="d"
  x:Class="Experiment.MainWindow"
  x:Name="Window"
  Title="MainWindow"
  Width="640" Height="480">

  <Grid x:Name="LayoutRoot">
    <Grid HorizontalAlignment="Left" Height="100" VerticalAlignment="Top" Width="100" Margin="91,139,0,0">
      <ItemsControl KeyboardNavigation.IsTabStop="False" KeyboardNavigation.TabNavigation="Once" KeyboardNavigation.DirectionalNavigation="Contained">
        <RadioButton Content="Alpha" KeyboardNavigation.TabIndex="2"/>
        <RadioButton Content="Delta" KeyboardNavigation.TabIndex="2"/>
        <RadioButton Content="Gamma" IsChecked="True" KeyboardNavigation.TabIndex="1"/>
        <RadioButton Content="Beta" KeyboardNavigation.TabIndex="2"/>
      </ItemsControl>
    </Grid>
    <Grid HorizontalAlignment="Left" Height="100" VerticalAlignment="Top" Width="100" Margin="244,139,0,0">
      <ItemsControl KeyboardNavigation.IsTabStop="False" KeyboardNavigation.TabNavigation="Once" KeyboardNavigation.DirectionalNavigation="Contained">
        <RadioButton x:Name="First" Content="Eenee" KeyboardNavigation.TabIndex="2"/>
        <RadioButton x:Name="Second" Content="Meenee" IsChecked="True" KeyboardNavigation.TabIndex="1"/>
        <RadioButton x:Name="Third" Content="Mynee" KeyboardNavigation.TabIndex="2"/>
        <RadioButton x:Name="Fourth" Content="Moe" KeyboardNavigation.TabIndex="2"/>
      </ItemsControl>
    </Grid>
    <Grid HorizontalAlignment="Left" Height="100" VerticalAlignment="Top" Width="100" Margin="391,139,0,0">
      <ItemsControl KeyboardNavigation.IsTabStop="False" KeyboardNavigation.TabNavigation="Once" KeyboardNavigation.DirectionalNavigation="Contained">
        <RadioButton Content="Extralarge" KeyboardNavigation.TabIndex="2"/>
        <RadioButton Content="Large" KeyboardNavigation.TabIndex="2"/>
        <RadioButton Content="Medium" KeyboardNavigation.TabIndex="2"/>
        <RadioButton Content="Small" IsChecked="True" KeyboardNavigation.TabIndex="1"/>
      </ItemsControl>
    </Grid>
  </Grid>
</Window> 
```

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-02-25T06:35:40.750

要从左到右更改方向，请使用 FlowDirection 属性为 RightToLeft。

RadioButton 用于组中，因此用户只能从可用选项中选择一个选项（无需额外编码即可取消选中其他选项）。使用与单选按钮相同的 GroupName 在组中进行标记，以便只能选择一个选项，如下所示。

```
 <RadioButton Height="16" Margin="26,18,132,0" Name="RadioButton_Option1" VerticalAlignment="Top" Background="Snow" BorderBrush="Black"  GroupName="Visit_eggHeadcafe.com" Foreground="DarkBlue">ASP.net Articles </RadioButton>

    <RadioButton Height="16" Margin="26,18,132,0" Name="RadioButton_Option2" VerticalAlignment="Top" Background="Snow" BorderBrush="Black"  GroupName="Visit_eggHeadcafe.com" Foreground="DarkBlue">C# Articles</RadioButton>

    <RadioButton Height="16" Margin="26,18,132,0" Name="RadioButton_Option3" VerticalAlignment="Top" Background="Snow" BorderBrush="Black"  GroupName="Visit_eggHeadcafe.com" Foreground="DarkBlue">ADO.net Articles</RadioButton>

    <RadioButton Height="17" Margin="26,18,115,0" Name="RadioButton_Option4" VerticalAlignment="Top" Background="Snow" BorderBrush="Black"  GroupName="Visit_eggHeadcafe.com" Foreground="DarkBlue" Width="164">SQL Server 2005 Articles</RadioButton>

    <Button  Margin="26,18,132,0" Width="75" Height="20" Click="Button_Click">Open Articles</Button>

    </StackPanel > 
```

# c# - Web 服务的一般异常

> ID：448440
> 
> 赞同：3
> 
> 时间：2009-01-15T20:57:08.877
> 
> 标签：c#, soap, dynamics-gp

我正在与 C# 中的 MS Dynamics GP WebServices 集成，但我不确定如何处理异常。

如果我使用不存在的 ID 执行 GetCustomer，W​​eb 服务会返回一个“通用”SoapException 并且消息是“未找到业务对象”。因此，我看到确定它是无效 ID 而不是任何其他错误的唯一方法是解析错误消息，我发现这个解决方案非常脆弱。我的 GP 版本是英语，在客户网站上它会是法语，我不知道网络服务消息会是哪种语言。我正在考虑捕捉它，解析消息并抛出更有意义的错误类型。

你看到更好的选择了吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T22:39:32.493

我有[一篇博客文章](http://theruntime.com/blogs/jacob/archive/2008/01/28/getting-at-the-details.aspx)详细介绍了我如何在 WCF 中克服这个问题（尽管如您所见，我不介意解析错误消息以获取详细信息）。这是它的肉：

```
catch (FaultException soapEx)
{
    MessageFault mf = soapEx.CreateMessageFault();
    if (mf.HasDetail)
    {
        XmlDictionaryReader reader = mf.GetReaderAtDetailContents();
        Guid g = reader.ReadContentAsGuid();
    }
} 
```

获得 GUID 后，您可以使用它来查询 GP Web 服务以获取错误的详细信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T21:23:50.850

不幸的是，eConnect API 和 GP Web 服务都返回一般错误，很高兴您不必解析 eConnect 错误。

好消息是，错误通常是静态的，因此您可以为它们构建解析器。创建自定义异常绝对是使用这种类型的 Web 服务的好方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T18:42:10.673

对于对该主题感兴趣的人的信息，Jacob Proffitt 的回应看起来像是要走的路。这是 Dynamics GP 文档中的一个狙击手：

```
catch(SoapException soapErr)
{
    // If a validation exception occurred, the logid will be in a child node
    if(soapErr.Detail.HasChildNodes == true)
    {
        // Create a guid for the logid value in the soap exception
        Guid guid = new Guid(soapErr.Detail.InnerText);

        // Get the validation result object
        validationResult = wsDynamicsGP.GetLoggedValidationResultByKey(guid, context);

        // Display the number of validation exceptions
        MessageBox.Show("Number of validation exceptions: " +
        validationResult.Errors.Length.ToString());
    } 
```

}

但在我引用的情况下：GetCustomer with an unexisting ID，“soapErr.Detail.HasChildNodes”行是假的，所以它失败了。

网络服务似乎充满了有趣的行为，这将比我预期的要长:(。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T21:11:07.570

您是否可以控制 WebService 代码？

在这种情况下，我将返回带有更易于解析的简单错误代码的 SoapExceptions，并让客户端应用程序根据解析的错误代码决定要显示的消息。

您可以在 WebService 上使用“错误代码”枚举以使代码更具可读性。

```
//Example
enum ErrorCodes
{
  BusinessObjectNotFound = 1000,
  AnotherPossibleError = 1002
}

try
{
//Code
}
Catch(BusinessObjectNotFoundException bex)
{
  throw new SoapException(ErrorCodes.BusinessObjectNotFound);
  //Or maybe...
  //throw new SoapException(((int)ErrorCodes.BusinessObjectNotFound).ToString());
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-11-08T20:21:35.853

我开始讨厌全科医生了。这可能是“糟糕的形式”，但这是我所做的：

```
try
{
    // query service for object by key
}
catch (System.ServiceModel.FaultException e)
{
    if (e.Message == "Business object not found.")
    {
        // create new object
    }
    else
    {
        // log the exception appropriately
    }
} 
```

# actionscript - 如何从 AIR 中的 JavaScript (HTMLLoader) 对象调用 ActionScript 方法？

> ID：448441
> 
> 赞同：3
> 
> 时间：2009-01-15T20:57:17.207
> 
> 标签：actionscript, air

所以我有一个应用程序沙箱 HTMLLoader 对象，我在[AIR](http://en.wikipedia.org/wiki/Adobe_Integrated_Runtime)中创建它，只是想从[JavaScript调用](http://en.wikipedia.org/wiki/JavaScript)[ActionScript](http://en.wikipedia.org/wiki/ActionScript)方法。在 Flash 中，这是通过我们可信赖的**ExternalInterface.addCallback()**函数完成的。但是在 AIR 中，情况就大不相同了，我似乎无法让它发挥作用。

 **这是我的项目的简化概述：

我的 AIR（ActionScript）主要：

```
public class Main extends Sprite {

    public var _as3Var:String = "testing";
    public function as3Function():void
    {
        trace("as3Function called from Javascript");
    }

    public function Main() {
        NativeApplication.nativeApplication.addEventListener(InvokeEvent.INVOKE, onInvoke);
    }

    protected function onInvoke(e:InvokeEvent):void {
        NativeApplication.nativeApplication.removeEventListener(InvokeEvent.INVOKE, onInvoke );
        var app = new App();
        addChild(app);
        app.init(new ExternalContainer(), e.currentDirectory, e.arguments);
    }
} 
```

这就是我创建 HTMLLoader 对象的方式：

```
{
    _html = new HTMLLoader();
    _html.useCache = false;
    _html.runtimeApplicationDomain = ApplicationDomain.currentDomain;
    _html.load(new URLRequest("sandbox/AirRoot.html"));
    _html.width = 800;
    _html.height = 600;
    App.ref.addChild(_html);
} 
```

最后，这是我在**AirRoot.html**文件中的 JavaScript 片段，它试图调用在我的 Main 类中声明的公共方法**as3Function() ：**

```
Exposed.testAs3 = function()
{
    air.trace("Exposed.testAs3 called");            /* This works fine. */
    air.trace("runtimeVersion:");                   /* This works fine. */
    air.trace(air.NativeApplication.nativeApplication.runtimeVersion);  /* This works fine. */
    air.trace("seeing if I can get to AS3 params...");  /* This works fine. */

    /* This doesn't work - get the following error: TypeError: Value undefined does not allow function calls. */
    air.NativeApplication.nativeApplication.as3Function();
} 
```

我错过了什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T04:35:13.773

好的，我将回答我自己的问题。我保证这不是为了获得更多声誉点数，但我今天很困惑，但现在找到了适当的答案和文档——这通常是许多工程师问题的主要问题......

无论如何，答案是：

AIR HTMLLoader 对象包含一个神奇的属性 ，`HTMLLoader.window`它是 JavaScript 窗口对象的代理。所以设置`HTMLLoader.window = AS3Function;`是一种方式 - 或者与我之前包含的示例相关（假设我设置了一个名为 Main 的静态属性，它指向 Main 类）：

```
_html.window.as3Function = Main.as3Function; 
```

现在在 JavaScript 中，我可以调用`as3Function`为：

```
<script>
    window.as3Function();
</script> 
```

另一个有趣的属性是 JavaScript“window.htmlLoader”对象。它是 AS3 HTMLLoader 父对象的代理，在我的例子中是 _html 对象。从这里您可以访问与 JavaScript 中的 _html 对象相关的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-10-28T21:45:10.607

我不确定这是否是新版本 AIR 的更改，但您不再需要在 javascript 调用中引用窗口，您可以这样做：

```
<script>
  as3Function();
</script> 
```

# asp.net - 验证器：当禁用 ClientSide 时，它 们是否在回发时保持禁用状态？

> ID：448444
> 
> 赞同：3
> 
> 时间：2009-01-15T20:57:57.410
> 
> 标签：asp.net, validation, client-side-validation

我一直在学习很多关于标准 asp.net 验证器的知识，我最近的发现是关于如何禁用验证器客户端，这非常酷。

现在，如果我的初始帖子启用了验证器，但客户端，我禁用它，服务器端是否识别客户端更改并保留它，或者它是否重新启用页面被发送回用户？

谢谢！

内特

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-16T02:32:55.313

.NET 服务器端验证器控件将在回发期间重置为它们在服务器端代码中设置的任何内容。

因此，例如，如果您在其 .aspx 标记中将必填字段验证器设置为 rqvControl.enabled = true，则在回发后，无论其客户端状态如何，都将启用它。

如果您在客户端设置验证器的状态，并且想要持久化它，那么您需要设置一个可以在回发期间在服务器代码中读取的值。这可以像从执行启用/禁用操作的 javascript 中设置隐藏字段值一样简单。在您的代码隐藏中，只需根据隐藏字段中的值处理验证器的启用状态。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T21:12:53.917

你如何在客户端禁用它们？我想除非在客户端上禁用它们的行为会回发，否则视图状态将保持不变，因此它们将在下一页刷新时重新启用（这里只是理论化）。

自己尝试一下，如果它不起作用，您也许可以添加一个隐藏字段，当您禁用验证器时您也在客户端上设置该字段，然后在回发期间检查服务器端的该字段以了解是否启用/禁用它们那里。

# emacs - 如何在 Emacs 中获得相当于 Vim 的 :Texplore？

> ID：448448
> 
> 赞同：1
> 
> 时间：2009-01-15T20:59:39.887
> 
> 标签：emacs

我知道 Mx dire，但想定制它。我想按一个键（例如 F2）并打开可怕的缓冲区。当我浏览目录层次结构时，它不应该打开新的缓冲区。

当我最终打开文件时，它也不应该为它打开新的缓冲区（不是绝对必要的，但强烈推荐）。

当然，这种行为可以是全局的，即对于所有可怕的缓冲区/调用。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T21:42:07.570

查看[dired-single](http://www.emacswiki.org/emacs/dired-single.el)，它几乎可以满足您的需求（除了最后一点，它为新访问的文件重用了 dired 缓冲区）。

警告讲师：我写了它，所以我偏向于它的有用性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T16:57:42.223

一些替代方案 - [EmacsWiki：DiredReuseDirectoryBuffer](http://www.emacswiki.org/emacs/DiredReuseDirectoryBuffer)和这个来自格式笨拙的博客条目的[简短片段。](http://avizit.blogspot.com/2004/10/dired-to-open-new-directories-in-same.html)

警告：我自己还没有尝试过。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-11-07T13:29:32.290

我知道这已经很老了，但您只需在目录或文件上按“a”即可获得此功能。它已经在那里了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-18T18:13:15.217

这是我最终使用的：

```
(require 'dired)
(global-set-key [(f2)] 'my-dired)
(defun my-dired ()
  (interactive)
  (dired (file-name-directory (buffer-file-name))))
(defadvice dired-advertised-find-file (around dired-subst-directory activate)
  "Replace current buffer if file is a directory."
  (interactive)
  (let ((orig (current-buffer)) (filename (dired-get-filename :no-error-if-not-filep t)))
  ad-do-it
  (when (not (eq (current-buffer) orig)) (kill-buffer orig)))) 
```

# c++ - 如何使用多个版本的 GCC

> ID：448457
> 
> 赞同：40
> 
> 时间：2009-01-15T21:01:31.753
> 
> 标签：c++, linux, gcc, g++

我们有一个需要 glibc 2.4（来自 gcc 4.1）的新应用程序。我们运行的机器有 gcc 3.4.6。我们不能升级，应用程序必须在这台机器上运行。

我们安装了 gcc 4.1，但是在编译时它使用了 3.4.6 中的所有包含等。

我们如何解决这个问题？

仅针对此应用程序使用 4.1 有什么建议吗？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-01-15T21:11:46.087

请参阅 GNU GCC FAQ 中的“如何安装多个版本的 GCC [”](http://gcc.gnu.org/faq.html#multiple)。

[这里](http://www.tellurian.com.au/whitepapers/multiplegcc.php)还有一份白皮书。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2016-11-21T12:40:58.183

对于 Ubuntu，这很容易

`sudo add-apt-repository ppa:ubuntu-toolchain-r/test`

`sudo apt-get update`

然后安装例如 gcc 版本 6

`sudo apt-get install gcc-6`

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-15T21:12:23.603

你试过`gcc-select`吗？否则，请尝试在您的 shell 中设置`INCLUDE_PATH`and 。`LIBRARY_PATH`

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-11-14T00:09:24.510

update-alternatives 是拥有多个 gcc 版本的好方法：

[http://ubuntuguide.net/how-to-install-and-setup-gcc-4-1g4-1-in-ubuntu-10-0410-10](http://ubuntuguide.net/how-to-install-and-setup-gcc-4-1g4-1-in-ubuntu-10-0410-10)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-15T21:14:15.707

你可能仍然执行旧的 gcc。`gcc`尝试从您的版本创建符号链接，例如

```
ln -s gcc-4.1 gcc 
```

请注意不要删除放置在那里的旧“gcc”二进制文件，以防它们放置的不仅仅是符号链接。如果您可以重新编译自己的 gcc 版本，最安全的方法是在配置 gcc 时使用另一个前缀，类似于`--prefix=/home/jojo/usr/gcc`（我使用 svn-trunk 的 gcc-4.4 这样做，效果很好）。

请注意，这只是运行正确的 gcc 版本。如果你更新你的 gcc，你的 glibc 也不会自动更新。它是一个单独的包，与系统的其余部分深度耦合。安装另一个 glibc 版本时要小心。

# emacs - 如何调整 Emacs 中的 >> 和 << 行为（Vim 仿真、缩进、缩进）？

> ID：448458
> 
> 赞同：3
> 
> 时间：2009-01-15T21:01:58.523
> 
> 标签：emacs, formatting

在 Vim 仿真模式 (viper + vimpulse) << 和 >> 的工作方式与 Vim 类似。我只想让他们缩进 2 个空格。我怎么做？（我知道，微不足道。但很有用）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-18T17:44:26.680

阅读 viper-cmd.el 代码（和测试）后，我确定正确答案是：

```
(setq viper-shift-width 2) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T21:05:08.080

我猜该模式可能使用 Emacs`tab-width`或`c-basic-offset`设置。两者都可以设置：

```
(setq tab-width 4)
(setq c-basic-offset 4) 
```

（当然，使用任何你想要的大小来代替`4`.）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-17T13:52:50.037

为了有空间而不是制表符，请将其添加到您的 .emacs ：

```
(setq-default indent-tabs-mode nil) 
```

让 Emacs 缩进 2 个空格，就像 mipadi 告诉你的那样，但我会使用`default-tab-width`

```
(setq default-tab-width 2) 
```

# php - 重写此函数的最有效方法是什么？

> ID：448463
> 
> 赞同：1
> 
> 时间：2009-01-15T21:03:12.327
> 
> 标签：php

```
 function get_total_adults()
{
    $sql = "SELECT SUM(number_adults_attending) as number_of_adults FROM is_nfo_rsvp";
    $result = mysql_query($sql) or die(mysql_error());
    $array = mysql_fetch_assoc($result);

    return $array['number_of_adults'];
} 
```

我知道有一种方法可以用更少的代码来编写它。我只是在寻找最好的方法（不使用 ezSQL 之类的东西）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T21:10:37.680

```
function get_total_adults() {
    $sql = 'SELECT SUM(number_adults_attending) FROM is_nfo_rsvp';
    $result = mysql_query($sql) or die(mysql_error());
    // I'd throw a catchable exception (see below) rather than die with a MySQl error

    return mysql_result($result, 0);
} 
```

至于我宁愿如何处理错误：

```
function get_total_adults() {
    $sql = 'SELECT SUM(number_adults_attending) FROM is_nfo_rsvp';
    $result = mysql_query($sql);
    if (!$result) {
        throw new Exception('Failed to get total number of adults attending');
    }

    return mysql_result($result, 0);
}

try {
    $total_adults = get_total_adults();
} catch(Exception $ex) {
    die('Whoops! An error occurred: ' . $ex->getMessage());
    // or even better, add to your template and dump the template at this point
}
// continue code 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T21:06:38.077

您可以删除查询的“as number_of_adults”部分并使用 mysql_result。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T21:08:17.170

你也可以试试[refactormycode.com](http://refactormycode.com)

# php - Wordpress 类别 ID 与评估问题

> ID：448470
> 
> 赞同：1
> 
> 时间：2009-01-15T21:07:07.220
> 
> 标签：php, mysql, wordpress, plugins, eval

好的，这有点复杂。我正在创建一个插件，并想从帖子页面中找到类别 ID。

那是容易的部分。

使它变得复杂的是我在 ob_start 中执行此操作（在“template_redirect”操作中开始），因为我想在将整个页面返回到浏览器之前对其进行编辑。同样，从 ob_start 函数中这很容易。

使用返回的 ID，我想评估一些存储在 sql 字段中的 php。我正在尝试从 ob_start 函数中执行此操作

```
$tui_cifp_insertvalue = tui_cifp_evaluate_html($tui_cifp_insertvalue); 
```

这叫这个

```
function tui_cifp_evaluate_html($string) {
return preg_replace_callback("/(<\?php|<\?|< \?php)(.*?)\?>/si",'EvalBuffer', $string);
} 
```

依次调用

```
function EvalBuffer($string) {
ob_start();
eval("$string[2];");
$ret = ob_get_contents();
ob_end_clean();
return $ret;
} 
```

而我试图评估的 php 是。

```
<?php tui_findPostThumbIMG([categoryID],100,100,'categoryintro-thumbnail','','',''); ?> 
```

这一切都在 ob_start 例程之外工作，但在这里即使是简单的 php 也不起作用。在 ob_start 例程中，插件中断并返回一个空白页面。

所以我想我可以在 ob_start 开始之前评估 php 并通过全局变量传递结果。这行得通，但是在开始使用以下内容时，类别 ID 不可用。

```
if ( strpos($_SERVER['REQUEST_URI'], 'wp-admin') === false ) {

global $holdvalue;

$tui_cifp_insertvalue = get_option('tui_cifp_insertvalue');

$categories = get_the_category();
$categoryID = $categories[0]->cat_ID;

$tui_cifp_insertvalue = str_replace("[categoryID]", $categoryID, $tui_cifp_insertvalue);

$holdvalue = tui_cifp_evaluate_html($tui_cifp_insertvalue);

add_action('template_redirect','tui_cifp_ob_start'); //

} 
```

ob_start 函数

```
function tui_cifp_ob_start()
{

ob_start('tui_cifp_templatefilter');

} 
```

好的，我很难过......有什么想法吗？

我要么需要找到一个在正确时间执行的钩子，以便我可以访问类别 ID，要么我需要弄清楚如何在 ob_start 期间评估 php。

哦……我想我应该说。我想要做的是用保存在字符串中的一些其他信息替换 wordpress 页面上的标签，但是如果绘制了整个页面，则需要能够执行此操作。

谢谢斯蒂芬

PS我在wordpress论坛上问过这个问题，没有回应。很抱歉交叉发布，但我有点绝望。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-16T02:51:10.440

我不偏爱 eval，但这似乎可行，无论最后是否有输出缓冲......

```
function tui_findPostThumbIMG()
{
 echo "hey hey\n";
}

ob_start();
$categoryID = 10;
$tui_cifp_insertvalue = "<?php tui_findPostThumbIMG([categoryID],100,100,'categoryintro-thumbnail','','',''); ?>";
$tui_cifp_insertvalue = str_replace("[categoryID]", $categoryID, $tui_cifp_insertvalue);
$tui_cifp_insertvalue = tui_cifp_evaluate_html($tui_cifp_insertvalue);
echo $tui_cifp_insertvalue;
ob_end_flush(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T08:31:53.827

感谢 OIS，感谢您提出该解决方案。然而，它和我一直在做同样的事情。我猜结构不同。

然而，它确实让我从不同的角度看待这个问题。

我意识到`get_the_category()`需要一个参数并且没有获得类别，因为它是不可用的 Post ID。我通过像这样预先进行设置解决了这个问题。

```
function tui_cifp_ob_start()
{

    global $tui_cifp_message, $tui_cifp_div, $wp_query;

    if (is_single()) 
    {

        $tui_cifp_div = get_option('tui_cifp_div');

        if ($tui_cifp_div !== '') 
        {

        $thePostID = $wp_query->post->ID;
        $categories = get_the_category($thePostID); 
        $categoryID = $categories[0]->cat_ID;

        $tui_cifp_message = get_option('tui_cifp_message');

        $categoryTitle = $categories[0]->cat_name;
        $categoryDescription = $categories[0]->category_description;

        $tui_cifp_message = str_replace("[categoryID]", $categoryID, $tui_cifp_message);
        $tui_cifp_message = str_replace("[categoryTitle]", $categoryTitle, $tui_cifp_message);
        $tui_cifp_message = str_replace("[categoryDescription]", $categoryDescription, $tui_cifp_message);
        $tui_cifp_message = $tui_cifp_div.$tui_cifp_message;

        $tui_cifp_message = tui_cifp_evaluate_html($tui_cifp_message);

        }

        ob_start('tui_cifp_templatefilter');

    }

} 
```

再次感谢。

# java - 使用带有 guice 的依赖注入的可浏览源的项目？

> ID：448471
> 
> 赞同：3
> 
> 时间：2009-01-15T21:07:16.657
> 
> 标签：java, dependency-injection, design-patterns, guice

我经常阅读有关依赖注入的信息，并且对 google 进行了研究，理论上我理解它可以做什么以及它是如何工作的，但我希望看到一个使用它的实际代码库（最好是 Java/guice）。

谁能给我指出一个开源项目，在那里我可以看到它是如何真正使用的？我认为浏览代码并查看整个设置比您在网络上找到的介绍文章中的常用片段更能说明问题。提前致谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-08-22T01:23:50.823

[Wave Protocol Server](http://code.google.com/p/wave-protocol/source/browse/src/org/waveprotocol/wave/examples/fedone/)是我最喜欢的示例应用程序。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T03:33:57.500

我在这个确切的问题上有点挣扎。它是如此抽象和简单，我一直担心我“做错了”。

我一直在依赖于其他项目的主项目中使用它，因为设置绑定的 Guice 模块是主项目的一部分。

我终于意识到图书馆应该自己提供模块。此时，您只能依赖于 Module 的实例（而不是特定的实例）以及由它绑定的接口。

更进一步，您可以使用 Java 6 中新的[ServiceLoader](http://java.sun.com/javase/6/docs/api/java/util/ServiceLoader.html)机制来自动定位和安装类路径上所有可用的 Guice 模块。然后，您只需更改类路径（db-real.jar 与 db-mock.jar）即可交换依赖项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-18T14:08:41.717

我知道您在 Java 领域，但在 .NET 领域，有几个使用反转控制容器编写的开源应用程序。查看[CodeCampServer](http://code.google.com/p/codecampserver/)，其中 UI 模块没有对依赖解析模块的引用。有一个 HttpModule 可以完成这项工作。（HttpModule 只是一个您可以插入的外部库，用于处理 ASP.NET 中的事件，在 CodeCampServer 中，UI 项目在运行时加载此 DependencyRegistrarModule，而无需对其进行任何编译时引用。）

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-01-15T21:16:18.107

我认为如果使用得当，依赖注入有一种从视图中消失的方式，它只是一种初始化/连接你的应用程序的方式——如果它看起来比你可能正在查看手头框架的额外功能更花哨，并且不是简单的依赖注入。

编辑：我建议实际开始使用它而不是尝试查找示例，然后如果您无法像您认为的那样工作，请回来并在此处发布问题 :-)

# sql - 检索具有最大日期的行

> ID：448478
> 
> 赞同：2
> 
> 时间：2009-01-15T21:09:52.237
> 
> 标签：sql

我有两个这样的表：

```
Table1 (Number column is unique)

Number | date

1234      2008-10-06 17:11:00

5678      2005-10-19 16:20:00

9023      2005-12-09 16:20:00

4243      2009-01-06 17:11:00

5234      2009-01-14 17:11:00

Table 2 

Number | code  

1234     A1   

1234     B1 

5678     A1

9023     A1

4243     C1

5234     C1 
```

我正在尝试从这两个表中检索数据，以便为表 2 中最新的（来自表 1）中的每个代码获取一行。

基于这个例子，我的结果是：

1234 A1（因为那是日期最晚的那个）

1234 B1（因为那是日期最晚的那个）

5234 C1（因为那是日期最晚的那个）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T21:13:57.720

```
Select Distinct T1.number, T2.code 
From Table2 T2 
   Join Table1 T1
       On T1.Number = T2.Number
           And T1.date =
              (Select Max(Date) From Table1
               Where Number = T2.Number) 
```

编辑：修复评论中指出的问题：

```
 Select Z.Number, Z.Code
  From (Select A.number, A.code, B.date
        From Table2 A Join Table1 B
           On B.Number = A.Number) Z
  Where Z.Date =
      (Select Max(Date) 
       From Table2 A Join Table1 B
           On B.Number = A.Number
       Where code = Z.Code) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T21:19:48.300

解析函数解。这是给甲骨文的；如果您使用的是另一个 RDBMS，它可能无法正常工作。如果给定代码有多个具有相同日期的行，这将任意选择一个。

```
SELECT number, code FROM (
  SELECT t1.number,
         t1.code,
         row_number() OVER ( PARTITION BY t1.code ORDER BY t2.date DESC ) date_sort_key
    FROM t1, t2
    WHERE t2.number = t1.number
  )
  WHERE date_sort_key = 1 
```

将 rank() 替换为 row_number() 将使其报告存在重复日期的多个条目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T23:24:55.177

这是适用于 SQL Server 的 Dave 答案的一个版本

```
 SELECT number, code FROM (
  SELECT Table2.number,
         Table2.code,
         row_number() OVER ( PARTITION BY table2.code ORDER BY table1.date DESC ) date_sort_key
    FROM table1, Table2
    WHERE Table2.number = table1.number
  ) a
  WHERE date_sort_key = 1 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T23:05:22.037

这适用于 SQL SERVER

```
CREATE table Table1 (number int, date datetime)
INSERT Table1 VALUES (1234, '2008-10-06 17:11:00')
,(5678, '2005-10-19 16:20:00')
,(9023, '2005-12-09 16:20:00')
,(4243, '2009-01-06 17:11:00')
,(5234, '2009-01-14 17:11:00')

CREATE table Table2 (number int, code varchar(2))
INSERT Table2 VALUES (1234, 'A1   ')
,(1234, 'B1') 
,(5678, 'A1')
,(9023, 'A1')
,(4243, 'C1')
,(5234, 'C1')

SELECT DISTINCT
  a.number
 ,a.code
FROM Table2 a
  INNER JOIN Table1 b ON a.number = b.number
  INNER JOIN (
    SELECT
      t2.code
     ,MAX(t1.date) as date
    FROM Table2 t2
      INNER JOIN Table1 t1
        ON t1.Number = t2.Number
    GROUP BY t2.code
  ) c ON b.date = c.date 
```

# wcf - 有没有办法获得异步 WCF 调用的错误反馈？

> ID：448487
> 
> 赞同：0
> 
> 时间：2009-01-15T21:13:03.150
> 
> 标签：wcf, asynchronous

我有一个 WCF 服务，它在同步（阻塞）模式下 100% 工作，我现在需要重新处理一个调用，以便它使用异步模式。

该服务使用身份验证并执行从客户端到服务器的分块文件传输，因此我对其进行了重新设计以使用“开始”异步前缀来启动呼叫。

现在，我正在通过故意修改用户凭据来测试错误，这会导致在它尝试传输的文件块的每个部分上调用超时，这需要很长时间。问题是我没有收到任何错误反馈，并且如果异步调用失败，我也看不到如何获得任何错误反馈。这导致一些非常大的文件根本无法上传，但客户端没有意识到它没有抛出异常。

我勾选了 Debug->Exceptions->All CLR exceptions 以查看是否有任何异常被吞下，但仍然没有。

总而言之，您如何从 WCF 中的异步调用中获得错误反馈？

提前致谢，

瑞安

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T21:20:15.053

服务器为您缓存异常，如果您为异步调用调用结束操作完成方法，它将抛出任何发生的异常。

```
private void go_Click(object sender, EventArgs e)
{
    client.BeginDoMyStuff(myValue, new AsyncCallback(OnEndDoMyStuff), null);
}

public void OnEndDoMyStuff(IAsyncResult asyncResult)
{
    this.Invoke(new MethodInvoker(delegate() { 
        // This will throw if we have had an error
        client.EndDoMyStuff(asyncResult);
    }));
} 
```

# paypal - 如何处理取消的定期付款

> ID：448490
> 
> 赞同：3
> 
> 时间：2009-01-15T21:13:19.780
> 
> 标签：paypal, payment, recurring

我正在使用 Paypal 为我的网站处理自动定期付款。用户付费订阅我的网站，这样他们就可以获得定期通讯。

因此，假设客户在几个月后取消了他们的会员资格。他们通过登录 Paypal 并取消未来的自动付款来做到这一点。我应该如何更新我的网站以反映这种取消？

我正在考虑的第一个解决方案是安排一个 cronjob，它在每个午夜执行一个脚本，以使用来自 Paypal 的信息更新我的数据库。

第二个解决方案是在时事通讯邮寄日，我执行一个脚本来使用来自 Paypal 的信息更新我的数据库。每次用户“登录”到我的网站时，该网站也会执行该脚本。

有没有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T21:21:01.357

如果我理解正确，Paypal 的服务器会在订阅状态发生变化时自动更新您的服务器（如果您进行了此配置）。这称为 IPN（即时付款通知），确实包括取消通知。这是[定期（订阅）付款的 Paypal 文档](https://cms.paypal.com/us/cgi-bin/?cmd=_render-content&content_ID=developer/e_howto_api_WPRecurringPayments#id086510570PN)。此外，您可以使用他们的 API 轮询他们的服务器以获取此信息，因此，如果您希望自己获取它，您可以。

# ms-access - 是否有一种简单的方法可以在 Access 中查找子表单的依赖项？

> ID：448511
> 
> 赞同：1
> 
> 时间：2009-01-15T21:20:43.620
> 
> 标签：ms-access

对于数据库中的给定表单，是否有一种快速/简单的方法来查找 Access 数据库中的所有其他表单，将其用作子表单？

注意：我只关心使用属性表定义的主要表单，很容易对任何在运行时将其动态设置为子表单的表单进行代码搜索。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T21:30:05.067

右键单击数据库窗口中的表单并选择“Object Dependencies” 这应该会为您提供将其作为子表单托管的表单列表。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T21:28:11.483

用VBA查也不是太难。

```
sfrmname="FormToFind"
For Each frm In CurrentProject.AllForms
   DoCmd.OpenForm frm.Name, acDesign
   For Each ctl In Forms(frm.Name).Controls
      If ctl.ControlType=acSubForm Then
         If ctl.SourceObject = sfrmname Then
            Debug.Print frm.Name
         End If
      End If
   Next
   DoCmd.Close acForm, frm.Name
Next 
```

或者那里。

# hardware - 启动微控制器模拟器/仿真器

> ID：448513
> 
> 赞同：3
> 
> 时间：2009-01-15T21:21:09.313
> 
> 标签：hardware, emulation, microcontroller, simulator

我想为以下微控制器板创建/启动模拟器：[http ://www.sparkfun.com/commerce/product_info.php?products_id=707#](http://www.sparkfun.com/commerce/product_info.php?products_id=707#)

固件是用汇编编写的，所以我正在寻找一些关于如何模拟硬件将接收的输入然后模拟器将响应固件的输出的指针。（这也需要在模拟环境中运行固件）。

关于如何开始的任何指示？

谢谢克里斯

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T21:31:44.063

您必须编写一个 PIC 模拟器，然后模拟端口的 IO 功能。

老实说，它看起来像是作为开发工具包设计的——如果你小心的话，我不会担心你的代码会破坏设备。除非这是企业软件包的亚军，否则我会严重质疑编写 sim 的投资回报率。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T21:33:07.633

编写一个完整的模拟器将是一个真正的挑战。我之前尝试过写一个ARM模拟器，告诉你，这不是一个小项目。你要么必须模拟整个 CPU 内核，要么找到一个已经编写好的内核。

您还需要弄清楚所有 IO 是如何工作的。sparkfun 可能有关于该板的文档，但如果它使用 MMIO 等，则需要编写内存管理器。

实际上，模拟器的概念与解释器并没有那么远。您需要解释固件代码，并基本上按照说明进行操作。

我会推荐一个好的交互式调试器而不是处理模拟器。破坏硬件的可能性很低，但实际上，您是宁愿买一块新板还是花 9 个月写一些不能实现整个系统的东西？

PIC 18F2520 很可能已经为它编写了一个仿真器内核，但您需要深入研究所有硬件规格以查看所有 IO 是如何映射的。如果您愿意，这将是一个很好的项目，但我会考虑只使用远程调试器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-15T21:57:50.720

制作模拟器/模拟器有什么特别的原因，而不是只使用真实的东西吗？

板子不贵；Microchip 现在拥有 RealICE 调试器，它比旧的 ICD2“冰球”响应速度快得多。

Microchip 的 MPLAB**已经**有一个内置的模拟器。它不会为您模拟整个电路板，但它会处理 18F2520。您可以使用输入测试向量和日志输出文件，我之前用不同的 Microchip IC 做过这个，它是可行的，但有点麻烦。我建议您采用单元测试方法并模块化您做事的方式；找出系统可管理部分的测试输入和预期输出。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-13T21:38:01.090

> PIC 18F2520 很可能已经为它编写了一个仿真器内核，

一个开源的、跨平台的微芯片/PIC 模拟器以“ [gpsim](http://sourceforge.net/projects/gpsim) ”的名义提供。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T21:49:11.720

代码中的错误极不可能损坏物理电路。如果这是可能的，那么它要么是电路板设计中的错误，要么应该非常清楚地记录在案。

如果我可以根据多年使用这些设备的经验向您提供一个建议：不要在组装中对它们进行编程。你会发疯的。使用 C 或 BASIC 或一些更高级别的语言。Microchip 为他们的大多数芯片生产了一个 C 编译器（不知道这个），其他公司也生产它们。

如果您坚持使用仿真器，我很确定 Microchip 几乎为他们的每一个微控制器都制作了一个仿真器（每个产品线至少一个，这可能已经足够好了）。这些模拟器并不总是便宜的，我不确定它们接受复杂外部输入的能力。

如果您仍然想尝试自己编写，我想您会发现模拟 PIC 本身将相当简单——所有操作码的格式都有很好的文档记录，内存架构等也是如此。它将被模拟板上的其他设备以及它们之间的互连会杀死您。您可能想研究使用 VHDL 工具对组件之间的互连进行编码，该工具将允许您为不同的组件创建自定义仿真。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-15T22:23:03.400

这不是硬件在环模拟器问题吗？（例如[http://www.embedded.com/15201692](http://www.embedded.com/15201692)）

# sql-server-2005 - 我可以将子文件夹添加到 SQL Server Management Studio 项目吗？

> ID：448514
> 
> 赞同：4
> 
> 时间：2009-01-15T21:21:14.990
> 
> 标签：sql-server-2005

使用 SSMS 组织大型项目的最佳方式是什么？

我想做类似的事情：

```
ProjectRoot
    SchemaObjects
        Tables
            Constraints
            Indexes
            Keys
        Functions
        Views
        Stored Procedures
     Scripts
         DataGeneration 
```

等等，但我找不到一个很好的方法来做到这一点......有什么建议吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T21:37:05.740

我认为在 SMSS 中无论如何都没有办法做到这一点，至少在 2005 年没有。也许第三方工具会给你这个；[这里](http://sqlserver2000.databases.aspfaq.com/how-do-i-manage-sql-server/msde.html)有 2000 Enterprise Manager 的替换列表；不是最新的，但可能是一个很好的起点。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-31T04:53:38.713

可悲的是没有。在 SSMS 之外维护您的对象脚本，并在 SSMS 中简单地编辑它们。

恕我直言，这是 SSMS 中缺少大量时间的一件事。

# html - 静态 html 博客/cms 在 USB 记忆棒上运行？

> ID：448515
> 
> 赞同：0
> 
> 时间：2009-01-15T21:21:17.283
> 
> 标签：html, content-management-system, blogs, portable-applications

拥有一个简单的博客、将整个站点部署为静态 html 通过 FTP/SFTP 和任何博客 API 的内容管理系统有哪些选择？

我知道 Thingamablog，但它已经一年多没有更新了，所以我想现在已经死了。我*必须*至少将静态 HTML 导出到 FTP 服务器的替代方案是什么？

如果该应用程序有一些可视 gui 来输入博客文章并可以从 USB 记忆棒运行，那就太好了。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T21:27:14.090

我不知道[Thingamablog](http://thingamablog.sourceforge.net/)已经死了只是因为它已经一年没有更新了。缺乏最近的更新并不一定意味着该项目已经死了，它可能只是意味着它已经实现了它的目标并且没有更多的东西可以添加。Thingamablog 能满足您的需求吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-22T18:09:02.103

[TiddlyWiki](http://www.tiddlywiki.com/)怎么样。不是博客或 CMS，但它似乎是您需要的那种东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-17T18:21:15.900

今天我遇到了这个工具：[Zeta producer](http://www.zeta-producer.com/index.html)。他们有免费和付费版本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-08T16:55:12.370

其次是 CityDesk 的动议。您可能可以在免费版本上运行您的博客（最多 50 个“资产”——文件、页面、图像等），并通过 FTP 将静态 HTML 发布到服务器作为其专长。添加更新很简单；重新发布过程会在您的新版本和服务器上的版本之间产生差异，并且只会进行必要的更改。

例子比比皆是——只需用谷歌搜索“*.cty”文件。这是我帮助运行的 CityDesk 网站：

*   [http://bv-embs-chapter.com](http://bv-embs-chapter.com)

希望这可以帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-09T10:24:51.583

Thingamablog 再次活跃。1.5 即将发布，目前 1.5veta5 是最新的。看起来很适合你需要的东西。

保罗。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-01-15T21:28:00.810

您可以使用 MoWeS Portable：模块化 Web 服务器。

[http://www.chsoftware.net/en/useware/mowes/mowes.htm](http://www.chsoftware.net/en/useware/mowes/mowes.htm)

它使您可以直接从 USB 驱动器或虚拟驱动器中挑选一些静态和动态服务，以便在 Web 服务器上运行。

我在工作和在家中使用 Mowes 从虚拟驱动器上运行 Wiki，我从我的 U 盘运行个人博客。

它易于配置且功能强大，足以提高生产力。

***编辑：***这里有一个链接可以帮助您开始使用它： [http://www.mediawiki.org/wiki/Manual:Installing_on_WOS_Portable_(Windows)](http://www.mediawiki.org/wiki/Manual:Installing_on_WOS_Portable_(Windows))

*在下载部分，您可以选择要安装的软件包。您可以在此处选择要包含的 CMS/博客软件。*

# ruby-on-rails - 多个视图的相同部分返回到调用它的任何视图

> ID：448521
> 
> 赞同：0
> 
> 时间：2009-01-15T21:25:08.883
> 
> 标签：ruby-on-rails, ruby, forms, partials

我目前正在两个不同的视图上重新使用部分。

> 查看 A
> 
> 视图 B

部分属于模型 A，但与模型 B 有关联，因此它也适用于模型 B。

它包含一个表单，当提交数据时，它总是将用户重定向到视图 A。但是，当我从视图 B 提交表单时，我希望被重定向回视图 B 而不是表单 A。

它现在重定向到视图 A 的原因是因为这是该表单所属的模型。因此，当发布时，它会与控制器 A 对话并使用重定向将用户带到 a_url。

如何告诉我的表单（或更多控制器操作）将用户重定向回他们来自的地方？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T21:52:49.903

解决了。

我在表单中添加了一个隐藏字段，其中包含渲染部分的控制器名称，然后我的 respond_to 块确定将用户发送到哪里。

查看代码：

```
<%= hidden_field_tag 'submitted_from', "#{controller.controller_name}" %> 
```

我的控制器代码：

```
if params[:submitted_from] == 'A'
  redirect_to a_url
else
  redirect_to b_url
end 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T17:04:50.557

您可能希望将其放置在会话中，而不是使用隐藏标签：

```
session[:submitted_from] = new_model_url 
```

在另一个动作中..

```
redirect_to(session[:submitted_from])
session[:submitted_from] = nil 
```

切换表单变量非常容易，而伪造会话可能更难（但并非不可能）。如果是我的申请，我会走这条路。

# c# - 强大的 .NET 地图 API？

> ID：448534
> 
> 赞同：3
> 
> 时间：2009-01-15T21:29:06.940
> 
> 标签：c#, .net, mapping, gis

我的一位同事想到了一种很好的方法来可视化我们在用户端应用程序中使用的大量数据，但我们不知道有很多可用的 sdk 或 api 挂钩。

我们试图从本质上重建 CNN 的“魔墙”。我们希望能够以“热图”的方式显示全国的趋势，并能够深入到一个州以显示跨县的相同趋势。我们不需要评论员喜欢使用的 move-states-all-over-the-place 功能。

我们知道 Mappoint，但如果它能够满足我们的要求，还需要做更多的研究。

尝试推出我们自己的产品会更有意义吗？有没有其他人尝试过这些方面的东西？我能看到的唯一问题是定义每个州的边界，或者在州一级按县定义。

想法？想法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-19T20:00:30.757

我们最终选择了[SharpMap](http://www.codeplex.com/SharpMap)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2014-03-14T12:03:02.167

您好，您可以查看 Telogis GeoBase C# SDK，支持 WPF、WinForms，并且有一个用于 Web 服务实现的 XML/SOAP 服务器。

[http://dev.telogis.com/](http://dev.telogis.com/)

（我为 Telogis 工作）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T21:36:17.237

我使用了[歧管](http://www.manifold.net)GIS。它很便宜，并且有一个很棒的 SDK。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-15T21:37:39.043

查看 ESRI 的产品... ArcGIS Server 和类似的东西

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-15T21:47:33.317

[http://en.googlemaps.subgurim.net/](http://en.googlemaps.subgurim.net/)

这是一个 asp.net 用户控件

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T22:00:17.970

我与 MapPoint 合作过，发现它非常强大——亚马逊上有一本书。（虽然它有点过时，但仍然大部分工作。）

我还使用 GoogleMaps 进行 Web 开发。如果我没记错的话，我认为 Google 已经发布了一个 API 以允许 GoogleEarth 在网站上使用。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-05T18:35:04.403

您可以尝试[CartoType](http://www.cartotype.com)，我们的便携式映射库。有适用于 .NET、普通 Windows、Android、iOS、Linux 和 Mac OS 的 CartoType SDK。

# c# - C# - 互斥锁的锁定问题

> ID：448550
> 
> 赞同：3
> 
> 时间：2009-01-15T21:36:07.550
> 
> 标签：c#, asp.net, locking, mutex

我有一个 Web 应用程序，它控制哪些 Web 应用程序从我们的负载均衡器获取流量。Web 应用程序在每个单独的服务器上运行。

它跟踪处于 ASP.NET 应用程序状态的对象中每个应用程序的“输入或输出”状态，并且只要状态发生更改，该对象就会被序列化为磁盘上的一个文件。当 Web 应用程序启动时，状态会从文件中反序列化。

虽然该站点本身只收到几个请求，而且它很少访问该文件，但我发现由于某种原因在尝试读取或写入文件时很容易发生冲突。这种机制需要非常可靠，因为我们有一个自动化系统，定期对服务器进行滚动部署。

在任何人发表任何质疑上述任何谨慎性的评论之前，请允许我简单地说，解释其背后的原因会使这篇文章比现在长得多，所以我想避免搬山。

也就是说，我用来控制对文件的访问的代码如下所示：

```
internal static Mutex _lock = null;
/// <summary>Executes the specified <see cref="Func{FileStream, Object}" /> delegate on 
/// the filesystem copy of the <see cref="ServerState" />.
/// The work done on the file is wrapped in a lock statement to ensure there are no 
/// locking collisions caused by attempting to save and load the file simultaneously 
/// from separate requests.
/// </summary>
/// <param name="action">The logic to be executed on the 
/// <see cref="ServerState" /> file.</param>
/// <returns>An object containing any result data returned by <param name="func" />. 
///</returns>
private static Boolean InvokeOnFile(Func<FileStream, Object> func, out Object result)
{
    var l = new Logger();
    if (ServerState._lock.WaitOne(1500, false))
    {
        l.LogInformation( "Got lock to read/write file-based server state."
                        , (Int32)VipEvent.GotStateLock);
        var fileStream = File.Open( ServerState.PATH, FileMode.OpenOrCreate 
                                  , FileAccess.ReadWrite, FileShare.None);                
        result = func.Invoke(fileStream);                
        fileStream.Close();
        fileStream.Dispose();
        fileStream = null;
        ServerState._lock.ReleaseMutex();
        l.LogInformation( "Released state file lock."
                        , (Int32)VipEvent.ReleasedStateLock);
        return true;
    }
    else
    {
        l.LogWarning( "Could not get a lock to access the file-based server state."
                    , (Int32)VipEvent.CouldNotGetStateLock);
        result = null;
        return false;
    }
} 
```

这*通常*有效，但有时我无法访问互斥锁（我在日志中看到“无法获得锁定”事件）。我无法在本地重现这个 - 它只发生在我的生产服务器（Win Server 2k3/IIS 6）上。如果我删除超时，应用程序将无限期挂起（竞争条件？？），包括后续请求。

当我确实收到错误时，查看事件日志告诉我，在记录错误*之前*，前一个请求已实现并释放了互斥锁。

互斥体在 Application_Start 事件中实例化。在声明中静态实例化它时，我得到相同的结果。

借口，借口：线程/锁定不是我的强项，因为我通常不必担心它。

关于为什么它随机无法获得信号的任何建议？

* * *

**更新：**

我已经添加了正确的错误处理（多么令人尴尬！），但我仍然遇到相同的错误 - 并且为了记录，未处理的异常从来都不是问题。

只有一个进程会访问该文件——我没有为此应用程序的网络池使用网络花园，也没有其他应用程序使用该文件。我能想到的唯一例外是当应用程序池回收时，旧的 WP 在创建新的 WP 时仍处于打开状态 - 但我可以从任务管理器中看出问题发生在只有一个工作进程时。

@mmr：使用 Monitor 与使用 Mutex 有何不同？根据 MSDN 文档，它看起来好像在有效地做同样的事情——如果我不能用我的 Mutex 获得锁，它*会*通过返回 false 来优雅地失败。

另一件需要注意的事情：我遇到的问题似乎完全是随机的 - 如果它在一个请求上失败，它可能会在下一个请求上正常工作。似乎也没有模式（至少肯定没有其他模式）。

* * *

**更新 2：**

此锁不用于任何其他调用。在 InvokeOnFile 方法之外引用 _lock 的唯一时间是在实例化它时。

调用的 Func 要么从文件中读取并反序列化为对象，要么将对象序列化并将其写入文件。这两个操作都不是在单独的线程上完成的。

ServerState.PATH 是一个静态只读字段，我不希望它会导致任何并发问题。

我还想重申我之前的观点，即我无法在本地（在 Cassini 中）重现这一点。

* * *

**得到教训：**

*   使用正确的错误处理（呃！）
*   为工作使用正确的工具（并对工具的作用/方式有基本的了解）。正如 sambo 指出的那样，使用 Mutex 显然有很多开销，这导致我的应用程序出现问题，而 Monitor 是专门为 .NET 设计的。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-01-15T21:40:26.513

**只有在需要跨进程同步**时才应该使用互斥锁。

> 虽然互斥锁可用于进程内线程同步，但通常首选使用 Monitor，因为 Monitor 是专门为 .NET Framework 设计的，因此可以更好地利用资源。相反，Mutex 类是 Win32 构造的包装器。虽然它比监视器更强大，但互斥体需要的互操作转换比 Monitor 类所需的计算成本更高。

如果您需要支持进程间锁定，则需要一个[Global mutex](https://stackoverflow.com/questions/229565/what-is-a-good-pattern-for-using-a-global-mutex-in-c)。

正在使用的模式非常脆弱，没有异常处理，并且您无法确保您的 Mutex 被释放。这是非常危险的代码，很可能是您在没有超时时看到这些挂起的原因。

此外，如果您的文件操作时间超过 1.5 秒，那么并发互斥锁可能无法抓取它。我建议正确锁定并避免超时。

我认为最好重新编写它以使用锁。此外，看起来您正在调用另一种方法，如果这需要永远，锁将永远持有。那是相当冒险的。

这既短又安全：

```
// if you want timeout support use 
// try{var success=Monitor.TryEnter(m_syncObj, 2000);}
// finally{Monitor.Exit(m_syncObj)}
lock(m_syncObj)
{
    l.LogInformation( "Got lock to read/write file-based server state."
                    , (Int32)VipEvent.GotStateLock);
    using (var fileStream = File.Open( ServerState.PATH, FileMode.OpenOrCreate
                                     , FileAccess.ReadWrite, FileShare.None))
    {
        // the line below is risky, what will happen if the call to invoke
        // never returns? 
        result = func.Invoke(fileStream);
    }
}

l.LogInformation("Released state file lock.", (Int32)VipEvent.ReleasedStateLock);
return true;

// note exceptions may leak out of this method. either handle them here.
// or in the calling method. 
// For example the file access may fail of func.Invoke may fail 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T21:47:02.770

如果某些文件操作失败，锁将不会被释放。很可能就是这种情况。将文件操作放在 try/catch 块中，并在 finally 块中释放锁。

无论如何，如果您在 Global.asax Application_Start 方法中读取文件，这将确保没有其他人在处理它（您说文件是在应用程序启动时读取的，对吗？）。为了避免应用程序池重启等冲突，您可以尝试读取文件（假设写操作需要排他锁），然后等待1秒，如果抛出异常则重试。

现在，您遇到了同步写入的问题。无论哪种方法决定更改文件，都应该注意不要调用写操作，如果另一个正在使用简单的锁定语句进行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T21:53:08.937

我在这里看到了几个潜在的问题。

编辑更新 2：如果该函数是一个简单的序列化/反序列化组合，我会将两者分成两个不同的函数，一个是“序列化”函数，一个是“反序列化”函数。他们真的是两个不同的任务。然后，您可以执行不同的特定于锁定的任务。Invoke 很漂亮，但是我自己为了“漂亮”而不是“工作”而遇到了很多麻烦。

1）您的 LogInformation 功能是否锁定？因为你首先在互斥锁内部调用它，然后一旦你释放互斥锁。因此，如果存在写入日志文件/结构的锁，那么您最终可能会遇到竞争条件。为避免这种情况，请将日志放在锁内。

2) 检查使用 Monitor 类，我知道它在 C# 中工作，我假设在 ASP.NET 中工作。为此，您可以简单地尝试获取锁，否则优雅地失败。使用它的一种方法是继续尝试获取锁。（编辑原因：请参见[此处](http://msdn.microsoft.com/en-us/library/ms173179(vs.80).aspx)；基本上，互斥锁是跨进程的，监视器仅在一个进程中，但是是为 .NET 设计的，因此是首选。文档没有给出其他真正的解释。）

3）如果文件流打开失败，因为别人有锁，会发生什么？这将引发异常，并可能导致此代码表现不佳（即，锁仍由具有异常的线程持有，并且另一个线程可以获取它）。

4）函数本身呢？这会启动另一个线程，还是完全在一个线程内？访问 ServerState.PATH 怎么样？

5) 还有哪些函数可以访问ServerState._lock？我更喜欢让每个需要锁的函数都有自己的锁，以避免出现竞争/死锁情况。如果您有许多线程，并且每个线程都尝试锁定同一个对象但执行完全不同的任务，那么您最终可能会出现死锁和竞争，而没有任何非常容易理解的原因。我改变了代码来反映这个想法，而不是使用一些全局锁。（我意识到其他人建议使用全局锁；我真的不喜欢这个想法，因为其他东西可能会为某些不是这个任务的任务抢占它）。

```
 Object MyLock = new Object();
    private static Boolean InvokeOnFile(Func<FileStream, Object> func, out Object result)
{
    var l = null;
    var filestream = null;
    Boolean success = false;
    if (Monitor.TryEnter(MyLock, 1500))
        try {
            l = new Logger();
            l.LogInformation("Got lock to read/write file-based server state.", (Int32)VipEvent.GotStateLock);
            using (fileStream = File.Open(ServerState.PATH, FileMode.OpenOrCreate, FileAccess.ReadWrite, FileShare.None)){                
                result = func.Invoke(fileStream); 
            }    //'using' means avoiding the dispose/close requirements
            success = true;
         }
         catch {//your filestream access failed

            l.LogInformation("File access failed.", (Int32)VipEvent.ReleasedStateLock);
         } finally {
            l.LogInformation("About to released state file lock.", (Int32)VipEvent.ReleasedStateLock);
            Monitor.Exit(MyLock);//gets you out of the lock you've got
        }
    } else {
         result = null;
         //l.LogWarning("Could not get a lock to access the file-based server state.", (Int32)VipEvent.CouldNotGetStateLock);//if the lock doesn't show in the log, then it wasn't gotten; again, if your logger is locking, then you could have some issues here
    }
  return Success;
} 
```

# c# - 用于加密的客户 WCF 绑定/绑定元素

> ID：448551
> 
> 赞同：0
> 
> 时间：2009-01-15T21:36:11.373
> 
> 标签：c#, .net, wcf, wcf-binding, wcf-encryption

我正在尝试为我的 WCF 服务实施加密。我知道有几个选项可供我执行此操作。我对他们不感兴趣。我想使用密码重新生成可重复的 RSA 密钥。然后，这些密钥将用于交换 AES 密钥，该密钥将用于加密实际传递的数据。

我想我需要一个自定义绑定来做到这一点。我也有兴趣尝试简单地将我自己的绑定元素添加到 NetTCP 绑定中。有没有人尝试自定义现有的绑定，或者创建一个完全自定义的绑定？

**更新 1**

我真的会接受有关创建自定义绑定的任何意见。我可以启动加密部分并从那里开始工作。

**更新2**

我有一个客户绑定和一个自定义绑定元素。现在我正在实现 MessageEncoder.WriteMessage 的覆盖。我需要知道该消息的去向，以便我可以使用正确的加密密钥。我似乎无法访问此目标地址。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-18T03:08:51.787

这里有一些链接给你：

[MSDN 文档中的自定义绑定](http://msdn.microsoft.com/en-us/library/aa347793.aspx)

[Kirk Evans 博客：WCF 和自定义绑定](http://blogs.msdn.com/kaevans/archive/2008/01/24/wcf-and-custom-bindings.aspx)

基本上你会做这样的事情：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <system.serviceModel>
    <bindings>
      <customBinding>
        <binding name="NetHttpBinding">
          <reliableSession />
          <compositeDuplex />
          <oneWay />
          <binaryMessageEncoding />
          <httpTransport />
        </binding>
      </customBinding>
    </bindings>
    <services>
      <service name="MyService">
        <endpoint
          address="http://localhost:8001/myService/"
          binding="customBinding"
          bindingConfiguration="NetHttpBinding"
          contract="MyServiceContract"
          name="HttpBinding" />
      </service>
    </services>
  </system.serviceModel>
</configuration> 
```

第一个链接应该对您最有帮助。祝你好运！

# javascript - 每次都使用ajax或一次加载所有内容

> ID：448557
> 
> 赞同：0
> 
> 时间：2009-01-15T21:37:43.630
> 
> 标签：javascript, jquery, css, ajax, dom

假设您在一个页面上有多个链接。当你点击时，一个 div 会通过 AJAX 更新。更新后的 div 包含来自数据库的数据。

根据这个场景，每次点击链接时，都会从数据库中抓取日期并注入到 div 中。

你会...

1.  支持这种情况或...
2.  会将每个链接的内容加载到几个隐藏的 div 中，并在每次链接点击时显示相关的 div。这样ajax调用只被调用一次..

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T21:40:52.063

取决于...内容会改变吗？如果是这样... Ajax 每次。如果不？Ajax 一次（或零次，如果可能）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T21:42:14.217

如果您正在检索的数据定期更改并且需要保持最新，我会选择选项 1，如果不是，我会选择选项 2，这样可以减少网络流量并提高性能。

您甚至可以选择选项 3 并在页面加载时呈现数据（在隐藏的 div 中），这样您就根本不需要 ajax。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-17T10:39:51.520

除了取决于要在 div 中加载的内容的更改频率之外，还需要考虑每个 div 应该包含多少数据。例如，假设您有 10 个 div，每个 div 都将包含相当大的数据块。现在，如果在初始页面加载期间加载它，或者在第一次链接点击时全部加载，如果用户平均只点击几个链接，那么效率会很低。鉴于这个借口，我认为在决定选择哪个选项来加载 divs 的内容时，您需要考虑两个要点：

1.  div的内容是否会频繁变化
2.  是否需要在div中加载大量数据

如果 1 或 2 的答案是肯定的，我建议使用 AJAX 加载“仅”该 div 的内容。否则，您可以在初始页面加载时加载所有 div

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-15T21:42:59.267

如果您正在考虑 2，为什么不首先使用那些隐藏的 div 加载页面呢？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T21:43:05.070

如果数据可能在初始页面加载和用户单击链接之间发生变化 - 使用 ajax。
如果您只是在紧凑的空间中呈现大量静态数据 - 在页面加载时加载它并根据需要隐藏/显示。

您想避免没有 javascript 的人丢失您的内容的可能性。例如搜索引擎。ajax 仍然比 DOM 操作慢。

# java - 从 Java 应用程序到 Flex 应用程序

> ID：448561
> 
> 赞同：0
> 
> 时间：2009-01-15T21:40:27.760
> 
> 标签：java, apache-flex

有没有人有过使用完整的 Java 桌面应用程序并使用 Flex 复制功能的经验？

如果有的话，有哪些需要注意或注意的最重要的事情？

根据您的经验，您可以提出哪些建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-07T21:59:22.597

可能有很多问题需要注意。这里有一些刚刚浮现在我脑海中的：

*   JVM 中不存在的 Flash Player 限制，例如能够到达 Player 边界矩形（以及无数其他）的“外部”。
*   不幸的是，ActionScript 3 没有等效的 java.lang.reflect.Proxy。这意味着（到目前为止）没有像样的模拟对象框架，以及一般反射方面的限制。
*   我不知道任何 AOP 功能按照您在 Java 中找到的顺序。
*   Java 应用程序是否使用在 Flex 中没有等效项且您不希望自己编写的库。
*   Java 应用程序可以使用 JNI 调用本机代码，而使用 Flash Player 尚无法实现。

即使通过“Flex”您包括 Adob​​e AIR 平台，该环境通常也比 JVM 受到更多限制。但是，不要因此而气馁——您可以从使用 Flex 中获得很多好处，例如无处不在的运行时、出色的语言和组件开发框架等。如果您的 Java 桌面应用程序是一个 RIA，那么 Flex 可能是一个港口的好人选。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-04T19:46:26.050

我不确定用 Flex 替换成熟的 Java 桌面应用程序是否是最佳选择。[来自 Adob​​e Flex 页面](http://www.adobe.com/products/flex/)：*Flex 是一个高效、免费的开源框架，用于构建和维护富有表现力**的 Web 应用程序**，这些应用程序一致地部署在所有主要浏览器、桌面和操作系统上。*

如果您正在考虑 Adob​​e 产品领域，Adobe AIR 可能是桌面应用程序的更好替代品。

# c - 我是否正确认为 strcmp 对于文字是等效的（并且安全的）？

> ID：448563
> 
> 赞同：16
> 
> 时间：2009-01-15T21:40:49.710
> 
> 标签：c, strcmp

我们都知道溢出可能导致的麻烦，这就是 strn* 存在的原因——而且大多数时候它们是有意义的。但是，我已经看到使用 strncmp 来比较命令行参数的代码，如下所示：

```
if(... strncmp(argv[i], "--help", 6) == 0 
```

现在，我会认为这是不必要的，甚至可能是危险的（对于更长的参数，很容易误算文字中的字符）。

strncmp 在空值上停止，并且代码已经假定 argv[i] 是空终止的。任何字符串文字都保证以空值结尾，那么为什么不使用 strcmp 呢？

也许我错过了一些东西，但我已经看过几次了，这一次让我很感兴趣，可以问。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-01-15T21:43:01.093

是的，这是完全安全的，并且被认为是标准做法。**保证**字符串文字正确地以空值结尾。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-01-15T21:48:20.707

您确定代码不适合匹配 `"--helpmedosoemthingwithareallylongoptionname"`吗？

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-15T21:47:19.180

你是对的。

此外，您提供的示例将匹配“--help”，但也匹配以“--help”开头的所有内容（如“--help-me”）。

过分热心==错误的罕见情况。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-15T21:44:13.010

据我所知，您是绝对正确的——没有理由使用 strncmp 代替 strcmp。也许人们只是过于谨慎（不一定是坏事）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T21:49:33.123

正如其他人所说，`strcmp()`与文字一起使用是完全安全的。如果你想使用`strncmp()`，试试这个：

```
strncmp(argv[i], "--help", sizeof("--help")) 
```

让编译器为您计算！

这只会匹配确切的字符串“--help”。如果您想匹配所有以`"--help"`（如您的代码一样）开头的字符串，请使用`sizeof() - 1`不包含最后一个`'\0'`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T21:44:17.487

是的，文字的存在将比较数据的大小限制为文字的大小。stncmp 在这里是多余的。

有人可能会说 strncmp 是一个养成的好习惯，但这被计算字符的麻烦所抵消。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-15T21:45:26.940

我可能会在 C 中写这样的东西（如果我经常使用 strncmp 并且不想进行字符计数）：

```
if(... strncmp(argv[i], "--help", sizeof("--help") - 1) == 0 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-15T21:46:50.993

这可能不是为了安全。可以只检查命令行参数的开始。许多程序只检查命令行开关的开头而忽略其余部分。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-01-15T23:11:10.353

呃......从技术上讲，这样的事情不会发生吗？

```
char *cp1 = "help";
cp1[4] = '!'; // BAD PRACTICE! don't try to mutate a string constant!
// Especially if you remove the terminating null!
  ...
strcmp(some_variable, "help"); 
// if compiler is "smart" enough to use the same memory to implement
// both instances of "help", you are screwed... 
```

我想这是一个病态的案例和/或垃圾进，垃圾出（“医生，当我把头撞在墙上时很痛！”“那就不要这样做！”）......

（ps我只是提出这个问题——如果你觉得这篇文章搅乱了水域，请适当评论，我会删除它）

# mercurial - mercurial 的最佳实践：分支与克隆，以及部分合并？

> ID：448567
> 
> 赞同：74
> 
> 时间：2009-01-15T21:41:57.680
> 
> 标签：mercurial, merge, branch

...所以我已经习惯了 Mercurial ( `add`, `commit`, `diff`) 的简单内容，并了解了 .hgignore 文件（耶！）并掌握了创建和在分支之间切换的窍门 ( `branch`, `update -C`)。

我有两个主要问题：

1.  如果我在分支“Branch1”中并且我想从分支“Branch2”中提取一些但不是全部的更改，我该怎么做？特别是如果所有更改都在一个子目录中。（我想我可以克隆整个存储库，然后使用像 Beyond Compare 这样的目录合并工具来挑选和选择我的编辑。似乎应该有一种方法来隔离一个文件或一个目录中的更改。）

2.  在分支之间切换`update -C`似乎很容易，我想知道为什么我会费心使用`clone`. 我只能想到几个原因（见下文）——还有其他一些我想念的原因吗？

    一种。如果我需要一次对两个版本/分支采取行动（例如，做一个性能指标差异）

    湾。用于备份（`clone`存储库到物理上不同位置的网络驱动器）

    C。像我上面提到的那样进行选择合并。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-01-15T23:09:47.113

我将克隆用于：

*   短命的地方分支机构
*   克隆到不同的开发机器和服务器

前一种用途对我来说非常罕见——主要是当我尝试一个我可能想要完全放弃的想法时。如果我想合并，我会想合并所有的更改。这种分支主要是为了跟踪不同开发者的分支，这样它们就不会互相干扰。只是为了澄清最后一点：

*   我一直致力于我的更改，并拉动我的开发人员同事的更改，他们拉动我的。
*   当我方便时，我会将这些分支中的一个（或全部）的所有更改合并到我的中。

对于功能分支或寿命更长的分支，我使用命名分支，它们可以在存储库之间更轻松地共享而无需合并。当您想要有选择地合并时，它也会“感觉”更好。

基本上我是这样看的：

*   命名分支用于开发应用程序的不同分支或版本
*   克隆用于管理对同一版本的应用程序的不同贡献。

这是我的看法，尽管这确实是一个政策问题。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-07-25T21:20:40.500

对于问题 1，您需要更清楚地了解“更改”的含义。您指的是以下哪一项：

1.  “我想将不同分支中的一些（但不是全部）变更集拉到这个分支中。”
2.  “我想将不同分支中的一些*文件的最新版本，但不是全部，拉到这个分支中。”*

如果您的意思是第 1 项，您应该查看[移植](https://www.mercurial-scm.org/wiki/TransplantExtension)扩展，特别是挑选几个变更集的想法。

如果您的意思是第 2 项，您将执行以下操作：

*   更新到要将更改拉入的分支。
*   用于`hg revert -r <branch you want to merge> --include <files to update>`将这些文件的内容更改为它们在另一个分支上的方式。
*   用于`hg commit`将这些更改作为新的变更集提交到分支。

至于问题2，我从不使用存储库克隆来分支自己，所以我不知道。我使用命名分支或匿名分支（有时带有书签）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-15T23:07:04.293

我还有另一种选择供您研究：可变队列。

这个想法是，在您当前的工作目录之上有一堆补丁（没有提交，“真正的”补丁）。然后，您可以添加或删除应用的补丁，添加一个，删除它，添加另一个，等等。一个补丁或其中的一个子集最终成为一个新的“功能”，就像您可能想要对分支做的那样。之后，您可以照常应用补丁（因为它是更改）。如果您与其他人一起工作，分支可能会更有用......？

# .net - 处理传入的电子邮件

> ID：448579
> 
> 赞同：7
> 
> 时间：2009-01-15T21:44:32.633
> 
> 标签：.net, email, imap, pop3

如何使用 .NET 以编程方式阅读传入的电子邮件。我需要一种方法来获取 POP 服务器上的电子邮件内容（在本例中为 XML）并将其读入我的应用程序。

理想情况下，这可以通过以下方式解决：

*   .NET 代码，我可以在我的网络服务器上作为后台任务运行以处理电子邮件。
*   一种可以将电子邮件内容发布到我的网络服务器的服务。

虽然我对其他选择持开放态度。

编辑：从“未回答”复制：

> 目前，我们正在考虑使用我们的托管公司提供的电子邮件帐户。
> 
> 我们自己的邮件服务器可能是一种选择，但我们需要联系主机。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T22:16:12.883

我们实际上只是实现了同样的事情。

我们处理电子邮件的内容并通过网络服务将数据推送到我们的 CRM。我们在 .net 3.5 中使用 c#

为了处理我们使用 IMap 的邮件。CodeProject 上有一些 .net 客户端库。我想我们用的是[LumiSoft](http://www.lumisoft.ee/lsWWW/download/downloads/net/)的那个。

我们尝试了 WebDav，但运气不佳。这给我们留下了 Pop3 或 IMap。IMap 支持我们需要的文件夹，所以我们就这么做了。如果您的服务器不支持 IMap，我相信用 POP3 做同样的事情会很容易。

基本上，我们每小时都会连接我们的 Exchange 服务器，并拉下任何新电子邮件并进行处理。到目前为止，它运作良好。

编辑：我们还使用[SharpMimeTools](http://anmar.eu.org/projects/sharpmimetools/)将原始电子邮件转换为更可用的格式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T22:27:25.060

.Net有[许多免费的 POP3 客户端实现。](http://www.google.com/search?q=c%23+pop3+client)

例如：[这个](http://www.codeproject.com/KB/IP/despop3client.aspx)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T22:03:46.560

有很多选择，如果你有一个服务总线供你使用，它主要带有一个 pop3 适配器。

或者您可以使用 pop3 api（来自 quiksoft 的 easymail 非常好）。它还具有处理弹跳的出色产品。

阅读所有 SMTP 消息。如果您拥有邮件服务器，则取决于服务器的类型，还有其他获取消息的方法，有时是自定义 API 和插件，或文件系统。您是否托管自己的邮件服务器？您使用哪个邮件服务器？

如果可能的话，我不会选择 POP 协议，它有一些限制，比如只有一个文件夹，“获取/读取”消息会从文件夹中删除消息（这意味着一个进程来读取消息）和其他东西. 根据您需要解析的邮件数量，它可能仍然对您有用。IMAP 已经是一种改进。

使用 quiksoft IMAP 组件：

```
//create a new IMAP4 object, connect 
//to a IMAP4 server and login 
IMAP4 imap = new IMAP4();
imap.Connect("mail.yourdomain.com");
imap.Login("mailbox", "password");

//select the inbox and download the envelopes
imap.SelectMailbox("Inbox");
EnvelopeCollection imapEnvelopes;
imapEnvelopes = imap.GetEnvelopes();

//loop through each message
//and output the subject
foreach (Envelope imapEnvelope in imapEnvelopes)
{
   //write the subject out to the console
   Console.WriteLine(imapEnvelope.Subject);
}

//close resources
imap.Logout(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T22:27:49.957

爱思华宝的 Merak 电子邮件服务器非常适合这一点。它让我们设置了一种称为可执行帐户的特殊帐户。您将 .exe 与电子邮件地址相关联，然后在命令行上选择要发送的一堆内容。当电子邮件发送到该帐户时，它会触发可执行文件。.exe 必须是一个控制台应用程序，您必须注意它不会挂起等等，但我认为这是完美的解决方案。

我们使用它来处理来自谷歌分析的处理统计数据和来自其他邮件服务器的退回。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-03-16T10:45:59.057

你总是可以自己动手做[一个 POP 3 类](http://www.i-programmer.info/projects/27-networking/664-a-pop-3-class.html) POP 是更简单的协议之一

# assembly - 解释汇编代码

> ID：448580
> 
> 赞同：4
> 
> 时间：2009-01-15T21:44:41.777
> 
> 标签：assembly, emulation, interpreter, simulation

那里有汇编口译员吗？

我在找什么：

*   我有一些我想运行的汇编固件代码，但不是在实际硬件上。
*   我想运行代码，看看它在做什么。

那么，那里有某种免费且易于使用的装配模拟器吗？

你能想到的任何其他指针？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T21:49:29.537

您应该只以“解释”程序集的方式查看某些处理器仿真器，例如：[Qemu](http://bellard.org/qemu/)或[Bochs](http://bochs.sourceforge.net/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-15T23:08:43.947

为了运行为特定设备设计的汇编代码，您需要使用专门模拟该设备的模拟器来运行它。像 Qemu 这样的 x86 模拟器将完全无法运行为 ARM CPU 内核编写的汇编代码。这不是“几乎可以工作”的情况，但它甚至无法运行第一条指令。

正如[Jason S 所提到的](https://stackoverflow.com/questions/448580/interpreting-assembly-code#448843)，模拟外围设备或 CPU 内核之外的任何东西都非常特定于您所拥有的设备。PCB 版本之间的细节甚至可能有所不同。

如果您只是对汇编代码在做什么感到好奇，您最好坐下来阅读 CPU 参考手册，然后依次检查每条指令。如果您要使用此设备进行任何认真的工作，那么无论如何您最终都必须具备这些知识。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-15T21:47:30.007

简短的回答：是的。

更长的答案：取决于您组装的 CPU 以及您正在连接的外围设备类型。世界上实际上有 1000 多种不同的 CPU 封装。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-15T21:49:09.600

对于 x86 程序集，您可以使用像 Bochs 这样的 x86 PC 模拟器。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-15T23:00:01.860

可能，但请注意，模拟核心指令集是一回事，而处理外围设备则是另一回事。

如果您只是模拟一种对数据进行操作的算法，您可能只需要模拟 CPU 内核就可以逃脱。

如果您需要模拟模数转换器或 UART 或 PWM 驱动器，那就完全不同了。CPU 核心指令集（通常）被很好地指定到可以很好地模仿它的行为的程度。指定外设只是为了显示它们的功能要求，而不是保证它们的行为足够精确以制作仿真器，而不必知道它们是如何实现相关外设的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-06-06T23:12:55.697

如我所见，您有 dsPIC30F4011 的汇编代码。此代码专用于此 RISC Microchip 机器。您需要为 dsPIC 下载 IDE，我建议从 [https://www.microchip.com/mplab/mplab-x-ide](https://www.microchip.com/mplab/mplab-x-ide)从 MPLAB 下载。之后，尝试为 dsPIC30F4011 创建项目并添加您的汇编文件。然后尝试我们的模拟器，看看你的代码在做什么。这对于开始来说已经绰绰有余了。

# linq - Linq to Sql 延迟加载

> ID：448585
> 
> 赞同：0
> 
> 时间：2009-01-15T21:46:04.567
> 
> 标签：linq, lazy-loading

如果您不打算使用延迟加载，是否应该在“使用”块中将延迟加载明确设置为 false？在我看来，块内的 dataContext 正在加载子对象。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-15T21:48:12.237

如果您根本不想要任何延迟加载，您可以通过修改 DBML 上的属性来关闭它。这将导致默认情况下关闭 DataContext 生成

# database-design - 如何防止规范化数据库明细表中的孤立记录？

> ID：448592
> 
> 赞同：1
> 
> 时间：2009-01-15T21:46:54.783
> 
> 标签：database-design, normalizing

我必须维护一个未正确规范化的旧数据库。例如，有一个项目表已经增长（或者可能像蘑菇一样）有 5 个或更多不同的日期列，用于项目从订购到交付日期的不同里程碑。还有几个表格，每个表格都有街道地址、邮件地址或网络链接的列。

我想规范化结构，为地址、预定日期等创建表格，以及允许 1:N 关系的必要表格（每个客户的地址、每个项目的截止日期等）。

现在我完全不确定如何处理对明细表中数据的更改。例如，考虑更改客户送货地址。更改地址表中的数据是不可能的，因为有多个记录（可能在多个表中）可以引用该记录。如果没有其他行与旧记录有外键关系，则添加新地址记录可能会使旧记录成为孤立记录。

我考虑过以下方法来处理这个问题：

*   添加新的明细记录，并在主表的更新触发器中检查是否必须删除旧的明细记录。这将需要所有与详细表有关系的表的知识，在所有表中或在存储过程中。我不喜欢这种失去分离的感觉。它还将在活动事务中涉及更多表。

*   让触发器尝试删除旧的详细记录，并捕获任何错误。这只是感觉不对。

*   与孤立记录一起生活，并定期进行维护任务以清理所有详细信息表。

在链接到多个主表的明细表中处理数据更改的首选方法是什么？阅读此内容的任何提示？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T22:02:29.743

部分问题可能是原始模式设计：外键指向错误的方向，将地址、电话号码等视为主要而不是详细信息。当您希望一次更新给定地址的所有用途时，这可能很方便，但根据我的经验，它总是会演变成太多困难的例外情况，例如，某个位置的一个人移动，因此您需要断开他们的链接而不是整个家庭或办公室搬迁，以便您更新现有记录。如果您尝试在 CRUD 屏幕上向用户隐藏此详细信息，您最终会遇到这样的情况，即它无法执行您想要的操作。

如果这样做只是为了折叠重复值，它实际上是数据库的非规范化：地址行的存在是没有意义的。唯一的区别是，与大多数非规范化不同，它试图获得空间效率而不是速度。此时创建链接表只会使问题复杂化。

例如，如果您希望每个联系人有多个地址，请将地址设为详细表，其中包含指向父联系人的外键，并且不要担心重复的地址值，因为*它们只是值*。否则，使 Address 成为一个真实的实体：添加一个标题或描述字段和一个 CRUD 屏幕，这样它就可以作为一个实体独立存在。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-15T21:49:50.440

与孤立记录一起生活，并定期进行维护任务以清理所有详细信息表。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T22:07:17.707

我认为您正在模糊删除和更新案例。

如果您有客户端 a 和客户端 b，并且两者都使用相同的地址，这将通过关系表中的记录反映出来（例如 ClientAddresses，尽管如果您要存储多个实体的地址，我相信它会比那）

我认为，如果两个客户端共享和地址，并且客户端 a 不正确，客户端 b 也将不正确（即数据输入错误），但如果您确定不希望客户端更改基地址信息，删除关联记录（从 ClientAddresses 中删除）并添加新地址。当您从关系表中执行删除（可能是从存储过程中）时，请检查是否有任何其他记录引用正在取消关联的地址记录，如果没有从基表中删除。

# visual-studio - 无法打开 linq-to-sql 设计器

> ID：448603
> 
> 赞同：0
> 
> 时间：2009-01-15T21:48:05.000
> 
> 标签：visual-studio, linq-to-sql

我能够使用 linq-to-sql，现在它突然停止工作了。双击 dbml 文件时，它说：

> “没有“...my.dbml”的编辑器，请确保安装了文件类型（.dbml）的应用程序。

我试图 devenv /resetsettings，它没有帮助。所以我修复/重新安装 vs.net 2008 设置的选项，它又失败了，没有有用的调试日志？

有人有同样的经历吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-16T19:48:39.807

我终于解决了这样的问题：我重命名了我的文件夹`C:\Documents and Settings`并再次登录，让系统为我重新生成所有东西，这解决了问题，后来我将我的文件从重命名的文件夹移动到新的用户配置文件。

我想这与我安装 F# 和 IRON Ruby 有关。

# sql-server - SSRS 报表生成器 2.0 - 与 SQL 2005 一起使用

> ID：448615
> 
> 赞同：4
> 
> 时间：2009-01-15T21:50:20.843
> 
> 标签：sql-server, sql-server-2005, reporting-services, ssrs-2008, reportbuilder

我开始研究 SSRS Report Builder 2.0，我在文档中看到它支持与 SQL 2005 的连接。

有谁知道针对 SQL 2005 制作的报告是否可以上传到 SSRS 2005 网站并从该网站运行？或者，如果它们是在 Report Builder 2.0 中生成的，它们是否只能从 SSRS 2008 网站运行？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-16T16:26:40.743

您不能在 2005 引擎上运行 2008 报告，但是您可以在 2008 引擎上运行 2005 报告，它会按需转换报告。

这是一个类似 q/a 的链接：
[https ://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=350119&wa=wsignin1.0](https://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=350119&wa=wsignin1.0)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-16T18:16:51.180

不，这是不可能的。2008 报表只能在 SSRS 2008 报表服务器上运行。保罗

# sql - 是否有相当于 Oracle 分析的 PostgreSQL？

> ID：448618
> 
> 赞同：2
> 
> 时间：2009-01-15T21:52:04.850
> 
> 标签：sql, oracle, postgresql, analytics

在另一个线程上，我看到了一个使用 Oracle 分析的 sql 问题的答案。PostgreSQL 或通用 SQL 中是否有等价物？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T22:40:07.577

唉.. 听起来他们也不会出现在 Postgres 8.4 中。不过，它们正在开发中。

一些有用的功能可以在这个贡献中找到：[http](http://www.postgresql.org/docs/8.3/static/tablefunc.html) ://www.postgresql.org/docs/8.3/static/tablefunc.html （connect_by，crosstab）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T23:12:39.320

我对 Oracle Analytics 不熟悉，但我使用过 Jasper Reports，我很喜欢它。

*   Jasper Reports 是一个库，您可以对其进行编码以运行报告。
*   Jasper Server 允许您在 Web 应用程序中托管您的报告。它具有安全性和调度功能。
*   iReport 是 Jasper 的 GUI 设计器，它可以将报告直接上传到 Jasper Server。
*   Jasper Analysis 用于分析。

更多信息：[http ://www.jaspersoft.com/JasperSoft_JasperServer.html](http://www.jaspersoft.com/JasperSoft_JasperServer.html)

大多数东西都是免费的，但也有商业版本。

# c# - 为什么 IEnumerable.Count() 的上限为 200？

> ID：448629
> 
> 赞同：2
> 
> 时间：2009-01-15T21:54:36.797
> 
> 标签：c#, .net, sql-server, linq-to-sql, .net-3.5

IEnumerable.Count()（或 IQueryable.Count()）使用 LINQ to SQL 的行数是否有限制？无论出于何种原因，如果我的查询返回超过 200 条记录，我只能从 IEnumerable.Count() 获得 200 条记录。我什至尝试过使用 IEnumerable.LongCount() （即使结果的数量不应该高到需要它）。我还验证了在数据库上调用 COUNT 会返回 200 多条记录。

我检查了 MSDN 并尝试用谷歌搜索它，但无济于事。

我要疯了，还是我在某处遗漏了什么？我想这没什么大不了的（因为程序正在插入正确数量的记录），但是能够记录传输的记录数量会很好。

> 我们可以看看一些示例代码吗？

```
public IEnumerable<Irms_tx_modify_profile_ban> ExtractNewAdmits()
    {
        var results = from a in _dc.Applications
                      select (Irms_tx_modify_profile_ban)new RMSProfile
                      {
                          //assign column names to property names
                      };

        //Don't know why, but Bad Things happen if you don't put the
        //OfType call here.
        IEnumerable<Irms_tx_modify_profile_ban> narrowed_results = results.OfType<Irms_tx_modify_profile_ban>();
        Program.log.InfoFormat("Read {0} records from Banner.", narrowed_results.Count());
        return narrowed_results;
      } 
```

关于发生坏事的评论的原因是由于[该线程中提出的问题](https://stackoverflow.com/questions/378895/operation-could-destabilize-the-runtime)。我刚刚发现的是，如果我在 narrowed_results (IEnumerable) 上调用 Count，它会返回正确的数量。如果我在结果（IQueryable）上调用它，它只返回 200。我将继续解决 Skeet 的答案（因为他提到了 IQueryable 和 IEnumerable 之间的区别），但如果有人能够解释为什么会发生这种情况，我'我想听听。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T21:57:04.887

我没有听说过这样的事情，而且听起来确实很奇怪。

要检查的最明显的事情是正在向数据库发送什么查询。此外，无论您是在调用`Enumerable.Count()`（即在 an 上`IEnumerable<T>`）还是`Queryable.Count()`（即在 an上`IQueryable<T>`），这也很重要。前者将遍历 .NET 代码中的实际行以检索计数；后者会将计数放入查询中。

我们可以看看一些示例代码吗？

编辑：好的，看到代码：

*   当您没有调用 OfType 时，它​​正在 SQL 级别执行计数。这应该在记录的 SQL 中可见，并且应该可以使用任何其他 SQL 工具重现。

*   我怀疑您实际上*不必*致电 OfType。您可以调用 AsEnumerable，或者只是声明`results`为`IEnumerable<Irms_tx_modify_profile_ban>`. 重要的是变量的类型决定了要使用的扩展方法——因此决定了在哪里执行计数。

值得注意的是，您当前的解决方案确实效率低下 - 它正在获取所有数据并对其进行计数，但忽略除计数之外的所有数据。将计数放到服务器端会更好 - 虽然我知道目前这不起作用，但我相信通过一些分析我们可以让它工作:)

# c# - 如何在 C# 中格式化日期时间，如“2008 年 10 月 10 日上午 10:43 CST”

> ID：448634
> 
> 赞同：4
> 
> 时间：2009-01-15T21:56:57.320
> 
> 标签：c#, datetime, formatting

是否有一种干净的方法将 DateTime 值格式化为“CST 2008 年 10 月 10 日上午 10:43”。

我需要正确的缩写和小写的“am”（或“pm”）等。

我自己做过，但它很丑，所以我正在寻找不同的方法。

谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-15T22:05:31.640

由于“tt”格式字符串说明符仅输出大写，您必须自己修改。此外，DateTimes 不存储时区的名称，只存储一个偏移量。

```
DateTime dt = DateTime.Now;
string ampm = dt.ToString("tt").ToLower();
string output = string.Format("{0:MMM. d, yyyy h:mm}{1}", dt, ampm); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-15T22:02:17.450

```
DateTimeObject.ToString("MMM. dd, yyyy hh:mmtt"); 
```

不确定 CST。

如果您想要更多组合，请参阅此链接：

[http://www.geekzilla.co.uk/View00FF7904-B510-468C-A2C8-F859AA20581F.htm](http://www.geekzilla.co.uk/View00FF7904-B510-468C-A2C8-F859AA20581F.htm)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T21:58:54.947

假设您的服务器配置为 CST：

```
string format = dateTime.ToString("mmm. dd, YYYY HH:MM tt ")
    .Replace(" AM ", "am")
    .Replace(" PM ", "pm") +
    " CST"; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T22:08:14.520

这行得通吗？

```
myDateTime.ToString("MMM. d, yyyy hh:mmtt \C\S\T"); 
```

# jquery - 在特定级别搜索特定父级

> ID：448637
> 
> 赞同：0
> 
> 时间：2009-01-15T21:57:29.550
> 
> 标签：jquery

如果您有一个递归结构，例如位于父表的 td 单元格内的子表，如何最好地遍历/选择特定的父表？例如，如果您想查找下一张桌子或第二张桌子怎么办？

一种方法可能是将这样的东西放在一个循环中：

```
//Get the next parent up.
$parentTable = $table.parent('td,th')
    .parent('tr')
    .parent('tbody')
    .parent('table'); 
```

但这看起来既丑陋又脆弱。

像这样的事情看起来很可怕，也可能无法预测：

```
$parentTable = $table.parents('table').eq(1);  // Get the 2nd parent table up. 
```

**解决**

我验证了 $table.parents('table').eq(N-1) 确实给了你第 N 个父母。至于我为什么使用表格进行格式化，至少这次不是。:) 我实际上是在显示递归数据，允许它在客户端上折叠。jQuery 让我做我以前从未考虑过的事情。

顺便说一句，在这种情况下使用 .parent('table') 将不起作用，因为 parent() 只会选择直接父级。与 child() 类似，它只选择直接子级。parents() 的类似物是 find()。parents() 一直向上，find() 一直向下。好东西！

**更新**

1.3 添加了一个新的遍历方法，最接近（），这在这里也很有用。Closest('table') 将向上遍历，直到找到最近的祖先表。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T22:13:28.957

这取决于你需要多精确。

```
$pTable = $table.parent('table'); //get the immediate parent table
$pTable = $table.parent('table.someclass') //get the parent table w/class someclass
$pTable = $table.parents('table').eq(n) //get the #-1 parent table 
```

这正是表格只能用于表格数据而不是布局的原因之一。您应该能够自信地遍历应用程序中的 DOM。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T22:19:17.447

```
$table.parents('table') 
```

尽可能可预测——它将为您提供起始对象和正文之间的父表的反向列表。

如果您无法事先确定嵌套表的结构，则遍历将不起作用，您需要根据其他条件选择对象。

# c# - 不同语言的注册表值

> ID：448653
> 
> 赞同：1
> 
> 时间：2009-01-15T22:03:37.947
> 
> 标签：c#, .net, registry

我有一个需要 .Net 的应用程序。我发现了如何检查注册表值以查看是否安装了 .Net 以及它是否是正确的版本。

我想知道的是：注册表值会根据操作系统的语言设置而改变。也就是说，如果秘鲁有人安装 .Net 并且我的应用程序调用类似

```
key.GetValue("Version"); 
```

会识别“版本”吗？还是需要西班牙语形式的“版本”。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T22:07:01.450

我有 99.99% 的把握它永远是“版本”。翻译注册表项是没有意义的，它只会让各地的开发人员变得更难。

话虽如此，显然最好找到 Microsoft 记录的密钥。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T22:07:03.323

注册表值将相同。

# colors - 选择颜色的库？

> ID：448655
> 
> 赞同：3
> 
> 时间：2009-01-15T22:04:13.470
> 
> 标签：colors

是否存在任何开源库，用于使用[颜色理论](http://en.wikipedia.org/wiki/Color_scheme)以编程方式选择和评估颜色集的兼容性？

能够根据简单的颜色和谐规则（如互补色、相似色、三色和四色）选择调色板将非常有用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T22:23:20.747

这不是一个直接的答案，也不是开源的，但您可以看看他们在[Adob​​e 的 Kuler 网站上所做的事情。](http://kuler.adobe.com/)他们有可能值得一读的[API 文档。](http://learn.adobe.com/wiki/display/kulerdev/home)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T02:28:48.473

我刚刚发现了这个：[Harmonies theory and math](http://easyrgb.com/index.php?X=WEEL)。

同样令人感兴趣的是[EasyRGB](http://easyrgb.com/)网站的其余部分，它将解释如何将 RGB 转换为 HSV 等。

虽然它不是源代码，但它是计算值的公式。

也很有趣：[“彩色杰克”](http://www.colorjack.com/sphere/)

# perl - Perl 中的对象和类有什么区别？

> ID：448657
> 
> 赞同：6
> 
> 时间：2009-01-15T22:06:06.070
> 
> 标签：perl, oop, class, object

我很难理解对象和类之间的概念差异。我不太了解任何编程语言中两者之间的区别，但目前我正在使用 Perl 和 Moose，所以我更喜欢使用这些东西进行解释。

干杯

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-01-16T03:50:15.360

有很多“类是蓝图，对象是从该蓝图构建的东西”，但由于您要求提供使用 Moose 和 Perl 的特定示例，我想我会提供一个。

在下面的示例中，我们将有一个名为“Hacker”的类。该类（如蓝图）描述了黑客是什么（他们的属性）以及他们可以做什么（他们的方法）：

```
package Hacker;       # Perl 5 spells 'class' as 'package'

use Moose;            # Also enables strict and warnings;

# Attributes in Moose are declared with 'has'.  So a hacker
# 'has' a given_name, a surname, a login name (which they can't change)
# and a list of languages they know.

has 'given_name'       => (is => 'rw', isa => 'Str');
has 'surname'          => (is => 'rw', isa => 'Str');
has 'login'            => (is => 'ro', isa => 'Str');
has 'languages'        => (is => 'rw', isa => 'ArrayRef[Str]');

# Methods are what a hacker can *do*, and are declared in basic Moose
# with subroutine declarations.

# As a simple method, hackers can return their full name when asked.

sub full_name {
    my ($self) = @_;   # $self is my specific hacker.

    # Attributes in Moose are automatically given 'accessor' methods, so
    # it's easy to query what they are for a specific ($self) hacker.

    return join(" ", $self->given_name, $self->surname);
}

# Hackers can also say hello.

sub say_hello {
    my ($self) = @_;

    print "Hello, my name is ", $self->full_name, "\n";

    return;
}

# Hackers can say which languages they like best.

sub praise_languages {
    my ($self) = @_;

    my $languages = $self->languages;

    print "I enjoy programming in: @$languages\n";

    return;
}

1;   # Perl likes files to end in a true value for historical reasons. 
```

现在我们已经有了 Hacker*类*，我们可以开始制作 Hacker*对象*了：

```
#!/usr/bin/perl
use strict;
use warnings;
use autodie;

use Hacker;    # Assuming the above is in Hacker.pm

# $pjf is a Hacker object

my $pjf = Hacker->new(
    given_name => "Paul",
    surname    => "Fenwick",
    login      => "pjf",
    languages  => [ qw( Perl C JavaScript) ],
);

# So is $jarich

my $jarich = Hacker->new(
    given_name => "Jacinta",
    surname    => "Richardson",
    login      => "jarich",
    languages  => [ qw( Perl C Haskell ) ],
);

# $pjf can introduce themselves.

$pjf->say_hello;
$pjf->praise_languages;

print "\n----\n\n";

# So can $jarich

$jarich->say_hello;
$jarich->praise_languages; 
```

这将产生以下输出：

```
Hello, my name is Paul Fenwick
I enjoy programming in: Perl C JavaScript

----

Hello, my name is Jacinta Richardson
I enjoy programming in: Perl C Haskell 
```

如果我愿意，我可以拥有尽可能多的 Hacker 对象，但仍然只有一个 Hacker 类描述了所有这些对象的工作方式。

祝一切顺利，

*保罗*

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-01-15T22:08:47.860

类是一种类型（如“SUV”）。对象是类的一个实例（“大卫的 SUV”）。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-15T22:38:44.740

Perl 方面：

*   一个*类*是一个`package`规范。一组主要用于辅助这些行为的行为和数据。
*   一个*对象*通常是一个“hashref”，它是包中的行为规范（和继承的行为）所允许的特定数据的集合。

现在，hashref 可能包含代码引用。在大多数情况下，这就是行为。但是对象可以使用该特定行为的唯一方法是通过某些继承（或混合）的类行为来指定该行为，该行为期望可能有一个 coderef 位于该位置并调用它。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-15T22:09:50.913

另一种看待它的方式是类是如何构建对象的蓝图。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-15T22:09:07.453

对象是类的单个实例。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-15T22:33:08.403

你是类 Human 的对象

*（Perl 中的类是具有一些特殊性质的模块，您最好先只了解一般情况）。*

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-07-04T11:02:45.427

在 perl 中，类只是一个包名。它具有对象的通用代码。

object 是一个可以访问类的属性和方法的实例。

```
package vehicle;
sub vehicle_detail
{
($number,$model,$num_of_wheel)=@_;
print "My car Details:\n@_";
} 
```

上述级别的车辆可用于任何车辆，如自行车、汽车、面包车等。该对象是由运营商 bless 创建的。

```
$bike_name='honda';
$ref_bike=\$bike_name;
bless $ref_bike,'vehicle'; 
```

现在，bless 为类车辆创建对象 honda。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-16T02:38:04.087

我没有看到人们在其他语言中以相同的方式使用这些术语。这可能是问题的一个原因。我想也许 PHP 用户在很多时候应该说“对象”时会说“类”？

不管怎样，这个例子怎么样——假设你必须为两个不同的数据库创建两个不同的数据库连接：

```
my $oracle_database_handle = DBI->connect( <oracle connection details here> );

my $mysql_database_handle =  DBI->connect( <mysql connection details here>  ); 
```

你会创建两个对象来做两种不同的事情，但它们都是同*一种*事情——DBI 数据库连接。

# visual-studio - 在 Visual Studio 2008 中保留换行的缩进

> ID：448660
> 
> 赞同：2
> 
> 时间：2009-01-15T22:06:56.490
> 
> 标签：visual-studio, indentation, word-wrap

在 Visual Studio 2008 中，有没有办法保持自动换行的长行的缩进？（仅 C# 需要它。）

打开自动换行后，它看起来像这样：

```
        var a = SomeFunctionOrWhateverWithSuperLongName(parameter1,
参数2）；

```

我希望它看起来像这样：

```
        var a = SomeFunctionOrWhateverWithSuperLongName(parameter1,
        参数2）；

```

我知道一些文本编辑器可以做到这一点。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T22:19:29.833

通常，可以在 更改代码格式设置`Tools -> Options -> Text Editor -> [Your Language] -> Formatting`。

我相信普通 VS 不支持它。但是，某些插件可能会提供此功能。

# javascript - 从 javascript 中的字符串解析 Int

> ID：448666
> 
> 赞同：24
> 
> 时间：2009-01-15T22:07:57.703
> 
> 标签：javascript, jquery

在javascript中，从以字母开头的字符串（例如“test [123]”）中解析INT的最佳方法是什么？我需要一些适用于以下示例的东西。

我的 JS：

```
$(document).ready(function() {

    $(':input').change( function() {
        id = parseInt($(this).attr("id"));  //fails for the data below
        alert(id);
    });
} 
```

我生成的 HTML：

```
<select id="attribute[123]">
<!-- various options -->
</select>
<select id="attribute[456]">
<!-- various options -->
</select> 
```

谢谢！

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2009-01-15T22:12:44.327

您可以使用正则表达式来匹配数字：

```
$(this).attr("id").match(/\d+/) 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-01-15T22:11:46.557

```
parseInt(input.replace(/[^0-9-]/,""),10) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T22:12:37.757

可能只是用 .replace() 过滤掉字符串。如果还有其他方法，那么我不知道：

```
parseInt("attribute[123]".replace("attribute[", "").replace("]", ""))); 
```

您可能可以使用一些正则表达式将其仅放入一个 .replace() 中，但我不擅长正则表达式，所以我只做了两次。

在你的浏览器中测试这个

```
javascript:alert(parseInt("attribute[123]".replace("attribute[", "").replace("]", ""))); 
```

应该报警 123。

# c# - 将 System::DateTime 转换为 _timeb

> ID：448671
> 
> 赞同：1
> 
> 时间：2009-01-15T22:09:16.313
> 
> 标签：c#, c++, datetime, .net-3.5

我有一个基于 C++ 的遗留应用程序，它使用 CRT`_ftime()`函数为传入的网络流量加上时间戳。该`_ftime()`函数返回一个`_timeb`结构，该结构具有 32 位和 64 位实现。我们正在使用 32 位实现，如下所示：

```
struct _timeb {
    long time;              // 4 bytes
    unsigned short millitm; // 2 bytes
    short timezone;         // 2 bytes
    short dstflag;          // 2 bytes
}; 
```

从 MSDN 文档中，以下是每个字段的解释方式：

*   **dstflag** - 如果夏令时当前对本地时区有效，则非零（`_tzset`有关如何确定夏令时的说明，请参阅。）
*   **millitm** - 秒的小数部分，以毫秒为单位
*   **time** - 自 1970 年 1 月 1 日午夜 (00:00:00) 以来的秒数，协调世界时 (UTC)。
*   **时区**- UTC 和本地时间之间的分钟差，向西移动。timezone 的值是根据全局变量的值设置的`_timezone`（请参阅 参考资料`_tzset`）。

我正在重新处理执行时间戳以在**.NET 3.5**中使用 C# 的代码部分。现在使用该`System.DateTime`结构生成时间戳，但我仍然需要将它们转换回该`_timeb`结构，以便旧版 C++ 代码可以对它们进行操作。以下是我在托管 C++ 桥接库中的操作方式：

```
DateTime dateTime = DateTime::UtcNow;
DateTime baseTime(1970, 1, 1, 0, 0, 0, DateTimeKind::Utc);
TimeSpan delta = dateTime - baseTime;

_timeb timestamp;
timestamp.time     = delta.TotalSeconds;
timestamp.millitm  = dateTime.Millisecond;
timestamp.dstflag  = TimeZoneInfo::Local->IsDaylightSavingTime(dateTime) ? 1 : 0;
timestamp.timezone = TimeZoneInfo::Local->BaseUtcOffset.TotalMinutes * -1; 
```

据我所知，这似乎重建了`_timeb`结构，就好像我`_ftime()`直接调用一样，这很好。问题是，时间戳是我们应用程序的关键部分，所以这必须是正确的。

我的问题有两个。

1.  我的算法是否存在某种缺陷？有没有人看到我错过的任何明显的东西？是否存在无法正常工作的边界条件？
2.  有没有更好的方法来进行转换？.NET 有没有办法以更直接的方式做到这一点？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-15T22:27:28.587

您知道 Y2K38 问题吗？我假设您检查了 .timezone 的符号。避免巧妙地使用 dateTime.Millisecond，这只会让下一个人感到困惑。否则看起来不错。

# emulation - 模拟器如何工作以及它们是如何编写的？

> ID：448673
> 
> 赞同：966
> 
> 时间：2009-01-15T22:10:15.827
> 
> 标签：emulation, c64

模拟器是如何工作的？当我看到 NES/SNES 或 C64 仿真器时，我感到很震惊。

![http://www.tommowalker.co.uk/snemzelda.png](https://i.stack.imgur.com/3BsOH.png)

您是否必须通过解释其特定的汇编指令来模拟这些机器的处理器？还有什么内容？它们通常是如何设计的？

您能给有兴趣编写模拟器（尤其是游戏系统）的人提供任何建议吗？

* * *

## 回答 #1

> 赞同：1121
> 
> 时间：2009-01-15T22:13:48.723

仿真是一个多方面的领域。以下是基本思想和功能组件。我将把它分成几部分，然后通过编辑填写详细信息。我将要描述的许多事情都需要了解处理器的内部工作原理——汇编知识是必要的。如果我对某些事情有点含糊不清，请提出问题，以便我可以继续改进这个答案。

## 基本思路：

仿真通过处理处理器和各个组件的行为来工作。您构建系统的每个单独部分，然后像硬件中的电线一样连接这些部分。

## 处理器仿真：

处理处理器仿真的三种方法：

*   解释
*   动态重新编译
*   静态重新编译

通过所有这些路径，您有相同的总体目标：执行一段代码来修改处理器状态并与“硬件”交互。处理器状态是给定处理器目标的处理器寄存器、中断处理程序等的集合。对于 6502，您将有许多 8 位整数表示寄存器：`A`、`X`、`Y`、`P`和`S`; 你也会有一个 16 位的`PC`寄存器。

通过解释，您从`IP`（指令指针——也称为`PC`程序计数器）开始并从内存中读取指令。您的代码解析此指令并使用此信息来更改处理器指定的处理器状态。解释的核心问题是它*非常*慢。每次处理给定指令时，都必须对其进行解码并执行必要的操作。

使用动态重新编译，您可以像解释一样对代码进行迭代，但不仅仅是执行操作码，您还可以构建一个操作列表。一旦到达分支指令，您就可以将此操作列表编译为主机平台的机器代码，然后缓存此编译代码并执行它。然后，当您再次点击给定指令组时，您只需执行缓存中的代码。（顺便说一句，大多数人实际上并没有列出指令列表，而是动态地将它们编译为机器代码——这使得优化变得更加困难，但这超出了这个答案的范围，除非有足够多的人感兴趣）

使用静态重新编译，您执行与动态重新编译相同的操作，但您遵循分支。您最终构建了代表程序中所有代码的代码块，然后可以在没有进一步干扰的情况下执行这些代码。如果没有以下问题，这将是一个很好的机制：

*   开始时不在程序中的代码（例如压缩、加密、在运行时生成/修改等）将不会被重新编译，因此它不会运行
*   已经证明找到给定二进制文件中的所有代码等价于[停机问题](http://en.wikipedia.org/wiki/Halting_problem)

这些结合在一起，使得静态重新编译在 99% 的情况下完全不可行。有关更多信息，Michael Steil 对静态重新编译做了一些很棒的研究——这是我见过的最好的。

处理器仿真的另一面是您与硬件交互的方式。这真的有两个方面：

*   处理器时序
*   中断处理

## 处理器时序：

某些平台——尤其是像 NES、SNES 等较旧的控制台——要求你的模拟器有严格的时间来完全兼容。使用 NES，您拥有 PPU（像素处理单元），它要求 CPU 在精确的时刻将像素放入内存中。如果您使用解释，您可以轻松地计算周期并模拟正确的时间；使用动态/静态重新编译，事情变得/很多/更复杂。

## 中断处理：

中断是 CPU 与硬件通信的主要机制。通常，您的硬件组件会告诉 CPU 它关心什么中断。这非常简单——当您的代码引发给定中断时，您查看中断处理程序表并调用正确的回调。

## 硬件仿真：

模拟给定的硬件设备有两个方面：

*   模拟设备的功能
*   模拟实际的设备接口

以硬盘驱动器为例。通过创建后备存储、读/写/格式化例程等来模拟功能。这部分通常非常简单。

设备的实际接口要复杂一些。这通常是内存映射寄存器（例如，设备监视更改以执行信令的内存部分）和中断的某种组合。对于硬盘驱动器，您可能有一个内存映射区域，您可以在其中放置读取命令、写入等，然后将这些数据读回。

我会更详细地介绍，但是您可以使用一百万种方法。如果您在这里有任何具体问题，请随时提出，我会添加信息。

## 资源：

我想我在这里做了一个很好的介绍，但还有很多**额外**的领域。我很乐意为您解答任何问题；由于巨大的复杂性，我对其中的大部分内容都非常模糊。

### 强制性维基百科链接：

*   [模拟器](http://en.wikipedia.org/wiki/Emulator)
*   [动态重新编译](http://en.wikipedia.org/wiki/Dynamic_recompilation)

### 通用仿真资源：

*   [Zophar——](http://www.zophar.net/) 这是我开始仿真的地方，首先下载仿真器并最终掠夺他们庞大的文档档案。这是您可能拥有的绝对最佳资源。
*   [NGEmu](http://ngemu.com/) -- 没有多少直接资源，但他们的论坛是无与伦比的。
*   [RomHacking.net](http://www.romhacking.net/) - 文档部分包含有关流行控制台机器架构的资源

### 仿真器项目参考：

*   [IronBabel——](http://sourceforge.net/projects/ironbabel)这是一个 .NET 的仿真平台，用 Nemerle 编写，可即时将代码重新编译为 C#。免责声明：这是我的项目，所以请原谅无耻的插件。
*   [BSnes](http://byuu.org/bsnes/) - 一个很棒的 SNES 模拟器，目标是循环完美的准确性。
*   [MAME——](http://www.mamedev.org/)**街机**模拟器。很好的参考。
*   [6502asm.com](http://6502asm.com/) -- 这是一个 JavaScript 6502 模拟器，带有一个很酷的小论坛。
*   [dynarec'd 6502asm](http://ironbabel.googlepages.com/6502.html) -- 这是我在一两天内做的一个小技巧。我从 6502asm.com 获取了现有的模拟器并将其更改为将代码动态重新编译为 JavaScript 以大幅提高速度。

### 处理器重新编译参考：

*   Michael Steil（上面引用过）对静态重新编译的研究在[本文中达到了高潮，您可以](http://www.weihenstephan.org/%7Emichaste/down/steil-recompilation.pdf)[在此处](http://www.pagetable.com/?p=35)找到源代码等。

## 附录：

自提交此答案以来已经有一年多的时间了，并且受到了所有关注，我认为是时候更新一些东西了。

也许现在仿真中最令人兴奋的事情是[libcpu](http://www.libcpu.org/wiki/Main_Page)，由前面提到的 Michael Steil 启动。它是一个旨在支持大量 CPU 内核的库，这些内核使用 LLVM 进行重新编译（静态和动态！）。它有巨大的潜力，我认为它会为仿真做很多事情。

[emu-docs](http://emudocs.org/)也引起了我的注意，其中包含一个很棒的系统文档存储库，这对于仿真目的非常有用。我在那里的时间不多，但看起来他们有很多很棒的资源。

我很高兴这篇文章对我有所帮助，我希望我能在今年年底/明年年初之前完成我关于这个主题的书。

* * *

## 回答 #2

> 赞同：126
> 
> 时间：2009-02-02T17:27:54.460

一个名叫 Victor Moya del Barrio 的人就这个主题写了他的论文。152 页上有很多很好的信息。[您可以在此处](http://www.scribd.com/doc/94546/Study-of-the-techniques-for-emulation-programming-by-Victor-Moya-del-Barrio)下载 PDF 。

如果您不想注册[scribd](http://www.scribd.com/)，您可以在 Google 上搜索 PDF 标题[“仿真编程技术研究”](https://www.google.com.au/search?q=Study%20of%20the%20techniques%20for%20emulation%20programming)。PDF有几个不同的来源。

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2009-01-15T22:43:44.043

模拟可能看起来令人生畏，但实际上比模拟要容易得多。

任何处理器通常都有一个写得很好的规范来描述状态、交互等。

如果您根本不关心性能，那么您可以使用非常优雅的面向对象程序轻松模拟大多数旧处理器。例如，X86 处理器需要一些东西来维护寄存器的状态（简单），一些东西来维护内存的状态（简单），以及接收每个传入命令并将其应用于机器的当前状态的东西。如果您真的想要准确性，您还可以模拟记忆翻译、缓存等，但这是可行的。

事实上，许多微芯片和 CPU 制造商都先针对芯片的仿真器测试程序，然后再针对芯片本身测试程序，这有助于他们找出芯片的规格是否存在问题，或者芯片在硬件中的实际实现是否存在问题。例如，编写一个会导致死锁的芯片规范是可能的，当硬件出现最后期限时，重要的是查看它是否可以在规范中重现，因为这表明存在比芯片实现中的问题更大的问题。

当然，视频游戏模拟器通常关心性能，因此它们不使用幼稚的实现，它们还包括与主机系统的操作系统接口的代码，例如使用绘图和声音。

考虑到旧视频游戏（NES/SNES 等）的性能非常缓慢，在现代系统上进行仿真非常容易。事实上，更令人惊奇的是，您可以下载一套有史以来的每款 SNES 游戏或任何一款 Atari 2600 游戏，考虑到当这些系统流行时，免费访问每个卡带将是梦想成真。

* * *

## 回答 #4

> 赞同：29
> 
> 时间：2010-07-07T18:17:46.453

我知道这个问题有点老了，但我想在讨论中添加一些内容。这里的大多数答案都围绕着解释他们所模拟系统的机器指令的模拟器。

但是，有一个非常著名的例外，称为“UltraHLE”（[维基百科文章](http://en.wikipedia.org/wiki/Ultrahle)）。UltraHLE 是有史以来最著名的模拟器之一，它模拟了商业 Nintendo 64 游戏（在家用计算机上具有不错的性能），当时人们普遍认为这是不可能的。事实上，当 UltraHLE 创建时，任天堂仍在为 Nintendo 64 制作新游戏！

我第一次在印刷杂志上看到关于模拟器的文章，以前我只在网上看到过它们的讨论。

UltraHLE 的概念是通过模拟 C 库调用而不是机器级调用来使不可能成为可能。

* * *

## 回答 #5

> 赞同：22
> 
> 时间：2010-11-11T10:19:39.570

值得一看的是 Imran Nazar 尝试用 JavaScript 编写[Gameboy](http://imrannazar.com/GameBoy-Emulation-in-JavaScript:-The-CPU)模拟器。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2010-08-05T15:36:42.850

在创建了我自己的 80 年代 BBC 微型计算机模拟器（在 Google 中输入 VBeeb）之后，有很多事情要知道。

*   你不是在模仿真实的东西，那将是一个复制品。相反，您正在模拟**State**。一个很好的例子是计算器，实物有按钮、屏幕、外壳等。但是要模拟计算器，您只需要模拟按钮是向上还是向下、LCD 的哪些段打开等。基本上，一组数字表示在计算器中可以改变的事物的所有可能组合。
*   您只需要模拟器的界面出现并表现得像真实的东西。越有说服力，仿真就越接近。幕后发生的事情可以是您喜欢的任何事情。但是，为了便于编写仿真器，在真实系统（即芯片、显示器、键盘、电路板和抽象计算机代码）之间存在心理映射。
*   要模拟计算机系统，最简单的方法是将其分解成更小的块并单独模拟这些块。然后将整个批次串在一起以获得成品。就像一组带有输入和输出的黑匣子，非常适合面向对象编程。您可以进一步细分这些块以使生活更轻松。

实际上，您通常希望为仿真的速度和保真度而写作。这是因为目标系统上的软件将（可能）比源系统上的原始硬件运行得更慢。这可能会限制编程语言、编译器、目标系统等的选择。
除此之外，您还必须限制您准备模拟的内容，例如不需要模拟微处理器中晶体管的电压状态，但它可能是必要的模拟微处理器寄存器组的状态。
一般来说，仿真的细节级别越小，您对原始系统的保真度就越高。
最后，旧系统的信息可能不完整或不存在。因此，掌握原始设备是必不可少的，或者至少要分清另一个别人写的好模拟器！

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2009-01-15T22:17:18.700

是的，您必须“手动”解释整个二进制机器代码混乱。不仅如此，大多数时候您还必须模拟一些在目标机器上没有等效硬件的奇异硬件。

简单的方法是逐一解释指令。这很好用，但速度很慢。一种更快的方法是重新编译——将源机器代码翻译成目标机器代码。这更复杂，因为大多数指令不会一对一映射。相反，您将不得不做出涉及额外代码的复杂变通方法。但最终它要快得多。大多数现代模拟器都这样做。

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2009-01-15T22:21:40.437

当您开发仿真器时，您正在解释系统正在处理的处理器组件（Z80、8080、PS CPU 等）。

您还需要模拟系统具有的所有外围设备（视频输出、控制器）。

您应该开始为 simpe 系统编写模拟器，例如老式的[Game Boy](http://en.wikipedia.org/wiki/Game_Boy)（使用 Z80 处理器，我没有弄错）或 C64。

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2010-05-16T16:51:43.763

> 模拟器很难创建，因为您需要模拟许多技巧（如不寻常的效果）、时间问题等。

有关这方面的示例，请参阅[http://queue.acm.org/detail.cfm?id=1755886](http://queue.acm.org/detail.cfm?id=1755886)。

这还将向您展示为什么您“需要”一个多 GHz CPU 来模拟 1MHz 的 CPU。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2010-05-16T13:27:42.957

还可以查看 Darek Mihocka 的[Emulators.com](http://emulators.com/)，了解有关 JIT 指令级优化的重要建议，以及构建高效仿真器的许多其他好东西。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2011-09-30T09:23:50.887

我从来没有做过任何花哨的事情来模拟游戏机，但我确实参加过一次课程，任务是为 Andrew Tanenbaums [Structured Computer Organization](http://www.pearsonhighered.com/educator/product/Structured-Computer-Organization/9780131485211.page)中描述的机器编写模拟器。这很有趣，给了我很多惊喜。在潜入编写真正的模拟器之前，您可能想拿起那本书。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-04-04T01:23:43.267

关于模拟真实系统或您自己的东西的建议？我可以说模拟器通过模拟整个硬件来工作。也许不是电路（就像硬件一样移动位。移动字节是最终结果，所以复制字节就可以了）。模拟器很难创建，因为您需要模拟许多技巧（如不寻常的效果）、时间问题等。如果一个（输入）部分出错，则整个系统可能会出现故障，或者充其量会出现错误/故障。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2010-05-16T13:22:06.433

[共享源设备模拟器](http://blogs.msdn.com/barrybo/archive/2006/07/17/668492.aspx)包含用于 PocketPC/Smartphone 模拟器的可构建源代码（需要 Visual Studio，在 Windows 上运行）。我在二进制版本的 V1 和 V2 上工作。

它解决了许多仿真问题： - 从客户虚拟到客户物理到主机虚拟的有效地址转换 - 客户代码的 JIT 编译 - 外围设备的模拟，例如网络适配器、触摸屏和音频 - 用于主机键盘和鼠标的 UI 集成 - 保存/状态恢复，用于模拟从低功耗模式恢复

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-06-28T06:55:36.133

添加@Cody Brocious 提供的答案
在虚拟化环境中，您正在向虚拟机模拟新系统（CPU、I/O 等），我们可以看到以下类别的模拟器。

解释：bochs 是解释器的一个例子，它是一个 x86 PC 仿真器，它将来自客户系统的每条指令翻译成另一组指令（主机 ISA）以产生预期的效果。是的，它很慢，它没有'不缓存任何东西，所以每条指令都经过相同的周期。

动态仿真器：Qemu 是一个动态仿真器。它对客户指令进行即时翻译也缓存结果。最好的部分是直接在主机系统上执行尽可能多的指令，以便仿真更快。正如 Cody 所提到的，它将代码分成块（1 个单一的执行流程）。

静态模拟器：据我所知，没有静态模拟器可以帮助虚拟化。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-02-01T21:31:08.167

我将如何开始仿真。

1.获取基于低级编程的书籍，你需要它来为任天堂的“假装”操作系统......游戏男孩......

2.获取专门的仿真书籍，也许还有操作系统开发。（您不会制作操作系统，而是最接近它的操作系统。

3.查看一些开源模拟器，尤其是那些你想为之制作模拟器的系统。

4.将更复杂的代码片段复制到您的IDE/编译器中。这将节省您编写长代码的时间。这是我做os开发的，用的是linux的一个区

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-06-05T04:13:07.623

我写了一篇关于[在 JavaScript 中模拟 Chip-8 系统](http://blog.alexanderdickson.com/javascript-chip-eight-emulator)的文章。

这是一个很好的起点，因为系统不是很复杂，但是您仍然可以了解操作码、堆栈、寄存器等如何工作。

我将很快为 NES 写一个更长的指南。

# database - 为什么要使用 ORM？

> ID：448684
> 
> 赞同：125
> 
> 时间：2009-01-15T22:13:26.803
> 
> 标签：database, orm

如果您对 ORM 的“优点”有动力，为什么要使用 ORM 来管理/客户，这些原因是什么？

尝试为每个答案保留一个理由，以便我们可以看到哪一个被选为最佳理由。

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-01-15T23:25:26.753

使用 ORM 的最重要原因是您可以拥有丰富的、面向对象的业务模型，并且仍然能够存储它并针对关系数据库快速编写有效的查询。从我的角度来看，除了可以编写的高级查询类型之外，与其他生成的 DAL 相比，我看不到一个好的 ORM 给您带来的任何真正优势。

我正在考虑的一种查询是多态查询。一个简单的 ORM 查询可能会选择数据库中的所有形状。你会得到一组形状。但是每个实例根据其鉴别器是正方形、圆形或矩形。

另一种类型的查询是在单个数据库调用中急切地获取一个对象和一个或多个相关对象或集合。例如，每个形状对象都返回填充了它的顶点和边集合。

我很抱歉在这里不同意这么多其他人，但我认为代码生成本身不足以成为使用 ORM 的充分理由。您可以为没有 ORM 的概念或性能开销的代码生成器编写或找到许多好的 DAL 模板。

或者，如果你认为你不需要知道如何编写好的 SQL 来使用 ORM，我不同意。从编写单个查询的角度来看，依赖 ORM 可能更容易。但是，当开发人员不了解他们的查询如何与 ORM 和他们翻译成的 SQL 一起工作时，使用 ORM 很容易创建性能不佳的例程。

拥有一个适用于多个数据库的数据层可能是一个好处。不过，我不必经常依赖它。

最后，我必须重申，根据我的经验，如果您没有使用 ORM 更高级的查询功能，还有其他选项可以通过更少的学习和更少的 CPU 周期来解决剩余的问题。

哦，是的，一些开发人员确实发现使用 ORM 很有趣，所以从保持开发人员快乐的角度来看，ORM 也很好。=)

* * *

## 回答 #2

> 赞同：61
> 
> 时间：2009-01-15T22:15:45.613

加快发展。例如，消除重复代码，如将查询结果字段映射到对象成员，反之亦然。

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2009-01-15T22:16:25.253

使数据访问更加抽象和可移植。ORM 实现类知道如何编写特定于供应商的 SQL，因此您不必这样做。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-01-15T22:16:56.877

支持数据访问层中业务规则的 OO 封装。您可以使用您喜欢的应用程序语言编写（和调试）业务规则，而不是使用笨拙的触发器和存储过程语言。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-01-15T22:25:07.827

为基本的 CRUD 操作生成样板代码。一些 ORM 框架可以直接检查数据库元数据、读取元数据映射文件或使用声明性类属性。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-01-15T22:40:50.760

您可以轻松迁移到不同的数据库软件，因为您正在开发抽象。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-04-29T14:15:36.097

发展幸福，IMO。ORM 抽象了很多你必须在 SQL 中做的裸机工作。它使您的代码库保持简单：需要管理的源文件更少，架构更改不需要数小时的维护。

我目前正在使用 ORM，它加快了我的开发速度。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-01-15T22:16:43.427

使您的对象模型和持久性模型匹配。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-01-15T22:15:35.037

尽量减少简单 SQL 查询的重复。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-01-15T22:23:53.977

我正在研究它的原因是避免从 VS2005 的 DAL 工具（模式映射、TableAdapters）生成的代码。

我一年多前创建的 DAL/BLL 工作正常（对于我构建它的目的），直到其他人开始使用它来利用一些生成的函数（我不知道在那里）

看起来它将提供比来自[http://www.asp.net的 DAL/BLL 解决方案更直观、更清洁的解决方案](http://wwww.asp.net)

我正在考虑创建自己的 SQL 命令 C# DAL 代码生成器，但 ORM 看起来像一个更优雅的解决方案

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-04-11T07:16:25.773

我认为这里有很多优点（可移植性、易于开发/维护、专注于 OO 业务建模等），但是当试图说服您的客户或管理层时，这一切都归结为**您将通过使用节省多少钱一个 ORM**。

对典型的任务（甚至可能出现的更大的项目）做一些估计，你会（希望！）得到一些难以忽视的切换参数。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2012-02-20T16:22:18.593

查询的编译和测试。

随着 ORM 工具的改进，通过编译时错误和测试更容易更快地确定查询的正确性。

编译查询有助于开发人员更快地发现错误。对？对。这种编译之所以成为可能，是因为开发人员现在使用他们的业务对象或模型在代码中编写查询，而不仅仅是 SQL 字符串或类似 SQL 的语句。

如果在 .NET 中使用正确的数据访问模式，则很容易针对内存集合中的查询逻辑进行单元测试。这加快了测试的执行速度，因为您不需要访问数据库、在数据库中设置数据甚至启动完整的数据上下文。[编辑]这并不像我想象的那样真实在内存中进行测试可能会带来[难以克服的挑战](https://stackoverflow.com/questions/5609508/asp-net-mvc3-and-entity-framework-code-first-architecture)。但我仍然发现这些集成测试比往年更容易编写。[/EDIT]

这在今天肯定比几年前被问到这个问题时更相关，但这可能只适用于我的经验所在的 Visual Studio 和 Entity Framework。如果可能，插入您自己的环境。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-15T22:47:53.833

95% 的时间将 sql 抽象出来，因此团队中的每个人都不需要知道如何编写超高效的数据库特定查询。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-01-15T22:18:50.070

.net 层使用 Code smith 模板

[http://nettiers.com/default.aspx?AspxAutoDetectCookieSupport=1](http://nettiers.com/default.aspx?AspxAutoDetectCookieSupport=1)

为什么要编写同样可以生成的代码。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-15T22:29:50.890

说服他们在更改发生时您将节省多少时间/金钱，并且您不必重写您的 SQL，因为 ORM 工具会为您做到这一点

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-04-05T08:38:55.733

我认为一个缺点是 ORM 需要在您的 POJO 中进行一些更新。主要涉及模式、关系和查询。因此，您不应该对模型对象进行更改的情况，可能是因为它在项目或 b/w 客户端和服务器上共享。所以在这种情况下，您需要将其分成两个级别，这需要额外的努力。

我是一名 android 开发人员，如您所知，移动应用程序的大小通常并不大，因此隔离纯模型和 orm-affected-model 的额外努力似乎不值得充分。

我知道这个问题是通用的。但移动应用程序也属于通用保护伞。

# web-services - 从 POST Web 服务报告错误

> ID：448703
> 
> 赞同：4
> 
> 时间：2009-01-15T22:18:37.870
> 
> 标签：web-services, exception, post

我正在开发一个 Web 服务（在 asp.net 中），我想让每个 Web 方法在发生内部错误时向调用它的人报告——例如当输入验证失败时。

当我使用 SOAP 公开我的 Web 服务时，可以通过引发 SoapException 来报告此类错误。但是如果我用普通的 POST（又名 Http-Post）公开我的 Web 服务呢？除了返回 500 错误 HTTP 状态代码之外，在这种情况下是否有报告错误或引发异常的标准？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T22:49:19.447

更改响应对象以包含状态字段和错误消息（或仅包含错误消息，如果为空，则在接收器处检查），并正确设置它而不是抛出异常。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T22:22:58.283

我总是只返回 500 状态代码以及错误的文本描述。只需确保它已记录在案，以便客户可以正确处理它。

# asp.net - 全文搜索的最接近匹配

> ID：448704
> 
> 赞同：5
> 
> 时间：2009-01-15T22:18:41.257
> 
> 标签：asp.net, sql-server-2005, full-text-search, design-patterns, string-matching

我正在尝试为我的网站实施内部搜索，如果输入错误的单词，可以为用户指明正确的方向，*就像你的意思是*：在谷歌搜索中。

有人知道如何进行这样的搜索吗？我们如何确定我们假设用户打算搜索的单词或短语的相关性？

*   我将 asp.net 和 sql server 2005 与 FTS (fullTextSearch) 一起使用

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T22:27:54.513

您可以使用一种算法来确定字符串相似性，然后从您的搜索索引中建议其他字符串，直至达到一定的差异。

其中一种算法是[Levenshtein distance](http://en.wikipedia.org/wiki/Levenshtein_distance)。

但是，不要忘记搜索现有的解决方案。我认为例如[Lucene](http://lucene.apache.org/java/docs/)具有搜索相似字符串的能力。

顺便说一句，这里有一篇关于这个主题的相关帖子：[谷歌的“你的意思是什么？” 算法工作？](https://stackoverflow.com/questions/307291/how-does-the-google-did-you-mean-algorithm-work)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T22:22:43.680

这是通过正则表达式查询与短语匹配的最接近的关键字来完成的。

[这](http://ajaxpatterns.org/Suggestion)是一篇很棒的文章，可能会对您有所帮助。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T22:22:30.390

我能想到的最简单的方法是编写一个函数来返回两个单词之间的不匹配程度，然后遍历所有单词并找到最好的单词。

我已经使用分支定界方法完成了这项工作。让我挖掘代码：

```
bool matchWithinBound(char* a, char* b, int bound){
  // skip over matching characters
  while(*a && *b && *a == *b){a++; b++;}
  if (*a==0 && *b==0) return true;
  // if bound too low, quit
  if (bound <= 0) return false;
  // try assuming a has an extra character
  if (*a && matchWithinBound(a+1, b, bound-1)) return true;
  // try assuming a had a letter deleted
  if (*b && matchWithinBound(a, b+1, bound-1)) return true;
  // try assuming a had a letter replaced
  if (*a && *b && matchWithinBound(a+1, b+1, bound-1)) return true;
  // try assuming a had two adjacent letters swapped
  if (a[0] && a[1]){
    char temp;
    int success;
    temp = a[0]; a[0] = a[1]; a[1] = temp;
    success = matchWithinBounds(a, b, bound-1);
    temp = a[0]; a[0] = a[1]; a[1] = temp;
    if (success) return true;
  }
  // can try other modifications
  return false;
}

int DistanceBetweenWords(char* a, char* b){
  int bound = 0;
  for (bound = 0; bound < 10; bound++){
    if (matchWithinBounds(a, b, bound)) return bound;
  }
  return 1000;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T22:28:05.247

使用 T-SQL 您可以使用该[`SOUNDEX`](http://doc.ddart.net/mssql/sql70/setu-sus_8.htm)功能对单词进行拼音比较。

如果您获取用户输入，然后通过 soundex 代码将其与数据库中的其他单词进行比较，您应该能够得出一个“你的意思是”列表吗？字。

例如

```
select SOUNDEX('andrew')
select SOUNDEX('androo') 
```

两者都会产生相同的输出（A536）。

现在有更好的算法，但是 soundex 是内置在 sql server 中的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-16T03:33:53.043

你为什么不使用谷歌电源？，你可以使用他们的建议服务

[这](http://code.google.com/p/pocketwit/source/browse/branches/MarcyNewFeatures/PockeTwit/OtherServices/GoogleSpell/SpellCheck.cs?r=1922)是一个关于c#的例子

# asp.net - 何时应在服务器控件上启用 EnableViewState？

> ID：448719
> 
> 赞同：28
> 
> 时间：2009-01-15T22:23:41.057
> 
> 标签：asp.net

何时应在服务器控件上启用**视图状态**是否有任何指南或规则？什么时候不***应该***？

我正在查看此[`SqlDatasource`示例](http://quickstarts.asp.net/QuickStartv20/util/srcview.aspx?path=~/aspnet/samples/data/GridViewMasterDetailsInsert.src)，并注意到标签控件的视图状态未启用：

```
<asp:Label ID="ErrorMessageLabel" EnableViewState="false" runat="server" /> 
```

为什么没有`EnableViewState`在标签控件上启用？我知道启用视图状态会带来一些开销，所以我只想在需要时使用它。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-01-15T23:20:47.247

这是一个很好的经验法则：如果您 (1) 在代码隐藏中更改属性的值，并且 (2) 需要知道您在以后的回发中设置的值而不重新计算值，那么您需要使用 ViewState。

例如。在我的页面标记中，我可能指定了一个 Label 控件，如下所示：

```
<asp:Label ID="TitleLabel" runat="server" Text="Update this Employee" /> 
```

然后在 Page_Load 事件中我有这个代码：

```
If Not IsPostBack AndAlso myEmployeeObject.IsNew Then TitleLabel.Text = "Create a new Employee" 
```

通过更改 Text 属性的值，我在 ViewState 中引入了一个新元素。如果我在任何后续 PostBack 期间获得 Label 的 Text 属性的值，则该值将是“创建新员工”。

当我着手尽量减少页面使用的 ViewState 数量时，我会这样做。我在页面上[启用了跟踪。](http://msdn.microsoft.com/en-us/library/ms972204.aspx)跟踪输出在浏览器中呈现时添加到页面底部。跟踪输出标识页面上的每个服务器控件，并包括每个控件存储的 ViewState（我相信以字节为单位）的数量。当我想用 ViewState 的开销换取重新计算值的开销时，我使用此信息来计算。

在我之前的示例中，我将选择在每个 PostBack 上重新计算 Label 的 Text 属性，并停止将 Text 属性存储在 ViewState 中。这就是我更新后的标记的样子：

```
<asp:Label ID="TitleLabel" runat="server" Text="Update this Employee" EnableViewState="false" /> 
```

还有我更新的 Page_Load 事件：

```
If myEmployeeObject.IsNew Then TitleLabel.Text = "Create a new Employee" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T22:30:16.520

只有当你需要在回发或其他东西上获取那个傻瓜的价值时，你才应该使用 viewstate。因此，对于标签示例，您只需要启用视图状态，如果您有类似的代码

```
void Button1_Click()
{
   label1.text += " more!";
} 
```

没有视图状态，回发无法弄清楚标签的内容，你只会得到“更多！” 一遍又一遍，没有附加。尝试一下。

真的，我们办公室的经验法则是在页面级别关闭它，然后根据需要启用它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T23:11:46.127

首先了解视图状态，这是一个可能有帮助的[博客条目。](http://weblogs.asp.net/infinitiesloop/archive/2006/08/03/Truly-Understanding-Viewstate.aspx)通过在页面级别禁用视图状态来开始开发页面。asp .net 2.0 中的大多数控件保存它们在控件状态下运行所需的状态，因此禁用视图状态不会影响大多数控件。

对于在视图状态（如列表框）中保存绑定到它们的数据的控件，您可以通过对 PreInit 事件进行绑定来避免数据进入视图状态（这适用于大多数用例）。

除此之外，如果您没有需要它的第三方控件，则使用视图状态所带来的性能损失远远超过您在回发之间获得的状态保存承诺。

最后使用工具来帮助您查看页面视图状态中发生的字节数。ASP.NET 视图状态帮助器和 Fiddler 中显示视图状态数据的插件将在这方面为您提供很大帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T22:29:16.850

仅当您想要跨 http 请求保留值时才启用viewstate，除此之外保持它 = false。您也不必启用viewstate 来使用控件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-15T22:30:24.413

每当您可以控制哪些内容很重要（如文本框或下拉列表）时，您都希望启用视图状态，以便内容可用并在回发时更新为最新。

任何类型的输出有些静态文本的控件（你没有从用户那里得到的东西）通常不会启用视图状态。这最小化了视图状态。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T22:41:52.067

您需要确保更好地理解 ViewState。除非您这样做，否则没有像“仅在必要时启用 ViewState”这样的笼统声明将真正有意义。了解视图状态何时被加载/保存/弄脏。

[这是](http://www.codeproject.com/KB/aspnet/aspnetviewstatepagecycle.aspx)我见过的更好的文章之一

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-10T15:01:34.343

老实说，我想不出任何时候您希望标签控件的 viewstate 设置为 true。它是一种让您的[w3wp.exe 占用大量内存](http://blog.whitesites.com/w3wp-exe-using-too-much-memory-and-resources__633900106668026886_blog.htm)的快速方法。

# c# - 此 XPath 的 LINQ to XML 等效项是什么

> ID：448729
> 
> 赞同：4
> 
> 时间：2009-01-15T22:27:28.197
> 
> 标签：c#, xml, linq, xpath

我想知道用 LINQ 实现这个 xpath 查询的“最佳实践”方式（在 C# 中）是什么：

```
/topNode/middleNode[@filteringAttribute='filterValue']/penultimateNode[@anotherFilterAttribute='somethingElse']/nodesIWantReturned 
```

我想要一个“nodesIWantReturned”的 IEnumerable 列表，但只能来自 XML 树的某个部分，具体取决于祖先属性的值。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-01-15T23:39:30.937

除了显示的 Linq 方法之外，您还可以导入`System.Xml.XPath`命名空间，然后使用[`XPathSelectElements`](http://msdn.microsoft.com/en-us/library/bb342176.aspx)扩展方法直接使用您的 XPath 查询。

在课堂上注意到这些方法比“正确的”Linq-to-XML 慢，但是很多时候这并不是很重要，有时使用 XPath 会更容易（它肯定更简洁！） .

```
var result = doc.XPathSelectElements("your xpath here"); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-15T22:37:21.983

```
var result = root.Elements("topNode")
                 .Elements("middleNode")
                 .Where(a => (string)a.Attribute("filteringAttribute") == "filterValue")
                 .Elements("penultimateNode")
                 .Where(a => (string)a.Attribute("anotherFilterAttribute") == "somethingElse")
                 .Elements("nodesIWantReturned"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T23:30:40.377

一个更*口头*的解决方案：

```
var nodesIWantReturned = from m in doc.Elements("topNode").Elements("middleNode")
              from p in m.Elements("penultimateNode")
              from n in p.Elements("nodesIWantReturned")
              where m.Attribute("filteringAttribute").Value == "filterValue"
              where p.Attribute("anotherFilterAttribute").Value == "somethingElse"
              select n; 
```

# iphone - 如何使用 iPhone SDK 加快或减慢背景音乐曲目？

> ID：448748
> 
> 赞同：3
> 
> 时间：2009-01-15T22:29:22.483
> 
> 标签：iphone, audio

是否有一种简单的方法来控制使用音频队列服务播放的声音文件循环的播放速度/速度？例如，如果一个游戏正在播放背景音乐，我想让 BGM 随着时间的流逝而加快，但不改变音乐的音高。谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T05:10:11.707

据我所知，没有简单的方法可以做到这一点。在 Mac 上，您可能会使用音频单元来执行此操作，但我认为对这些的支持仅限于 iPhone SDK。

您可以在 AudioQueue 播放回调期间在 AudioFileReadPackets() 和 AudioQueueEnqueueBuffer() 之间进行一些处理，但我认为在不改变音调的情况下进行速度转换将需要相当多的 CPU 时间。

录制不止一个音乐，并在音乐的无声段落中切换文件可能会更容易。

# vb.net - 准确的 Windows 计时器？System.Timers.Timer() 限制为 15 毫秒

> ID：448761
> 
> 赞同：2
> 
> 时间：2009-01-15T22:33:19.557
> 
> 标签：vb.net

我需要一个准确的计时器来将 Windows 应用程序连接到一台实验室设备。

我使用 System.Timers.Timer() 创建了一个每 10 毫秒计时一次的计时器，但这个时钟运行缓慢。例如，间隔为 10 毫秒的 1000 个滴答应该需要 10 挂钟秒，但实际上需要 20 挂钟秒（在我的 PC 上）。我猜这是因为 System.Timers.Timer() 是一个间隔计时器，每次经过时都会重置。由于在计时器经过和重置（再过 10 毫秒）之间总是需要一些时间，因此时钟运行缓慢。如果间隔很大（秒或分钟）但对于非常短的间隔是不可接受的，这可能很好。

每次系统时钟越过 10 毫秒（或其他）边界时，Windows 上是否有一个函数会触发一个过程？

这是一个简单的控制台应用程序。

谢谢

规范

更新： System.Timers.Timer() 对于小间隔非常不准确。

我写了一个简单的程序，以几种方式计算 10 秒：

间隔 = 1，计数 = 10000，运行时间 = 160 秒，每间隔毫秒 = 16

间隔 = 10，计数 = 1000，运行时间 = 16 秒，每间隔毫秒 = 15

间隔 = 100，计数 = 100，运行时间 = 11 秒，每间隔毫秒 = 110

间隔 = 1000，计数 = 10，运行时间 = 10 秒，每间隔毫秒 = 1000

无论间隔设置如何，似乎 System.Timers.Timer() 都无法以大约 15 毫秒的速度滴答作响。

请注意，这些测试似乎都没有使用任何可测量的 CPU 时间，因此限制不是 CPU，只是 .net 限制（错误？）

现在我认为我可以忍受一个不准确的计时器，它每 15 毫秒左右触发一个例程，并且该例程得到一个准确的系统时间。有点奇怪，但是...

我还发现了一个共享软件产品 ZylTimer.NET，它声称是一个更准确的 .net 计时器（分辨率为 1-2 毫秒）。这可能是我需要的。如果有一种产品，则可能还有其他产品。

再次感谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T22:38:56.160

您需要使用[高分辨率计时器](http://www.codeproject.com/KB/vb/vbnetstopwatch.aspx)，例如 QueryPerformanceCounter

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-15T22:56:45.390

从表面上看，答案类似于“高分辨率计时器”，但这是不正确的。答案需要定期生成刻度，而 Windows 高分辨率性能计数器 API 不会生成这样的刻度。

我知道这不是自己的答案，但迄今为止对这个问题的流行回答是错误的，足以让我觉得对它的简单评论是不够的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-04-05T18:35:34.750

限制是由系统心跳给出的。这通常默认为 64 拍/秒，即 15.625 毫秒。但是，有一些方法可以修改这些系统范围的设置，以在较新的平台上实现低至 1 毫秒甚至 0.5 毫秒的计时器分辨率：

1.  通过多媒体定时器接口 ( `timeBeginPeriod()`) 达到 1 ms 的分辨率：

    请参阅[获取和设置计时器分辨率](http://msdn.microsoft.com/en-us/library/windows/desktop/dd743626%28v=vs.85%29.aspx)。

2.  通过以下方式达到 0.5 ms 分辨率`NtSetTimerResolution()`：

    请参阅[Windows NT 高分辨率计时器内部](http://mirrors.arcadecontrols.com/www.sysinternals.com/Information/HighResolutionTimers.html)。

您可以通过隐藏的 API**获得 0.5 毫秒**`NtSetTimerResolution()`的分辨率。

我已经在[这个](https://stackoverflow.com/a/22862989/1504523)SO 答案中给出了所有细节。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-15T22:58:03.610

在 System.Diagnostics 中，您可以使用[Stopwatch](http://msdn.microsoft.com/en-us/library/system.diagnostics.stopwatch.aspx)类。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T23:07:29.520

在我的脑海中，我可以建议运行一个大部分时间都在休眠的线程，但是当它醒来时，它会检查正在运行`QueryPerformanceCounter`并偶尔触发你的过程。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-16T15:13:31.717

MSDN 上有一篇很好的文章：[Implement a Continuously Updating, High-Resolution Time Provider for Windows](http://msdn.microsoft.com/en-us/magazine/cc163996.aspx)

这是本文的[示例源代码](http://download.microsoft.com/download/8/7/4/8742bb70-c5c1-4833-80b2-6bcf2fadf69b/HighResolutionTimer.exe)(C++)。

# latex - 有没有办法让 LaTeX 将图形放置在同一页面中作为对该图形的引用？

> ID：448768
> 
> 赞同：36
> 
> 时间：2009-01-15T22:34:46.963
> 
> 标签：latex, figures

我正在使用 LaTeX 和图形环境。

我非常熟悉该环境的参数：[htbp]，并且我通常也熟悉 LaTeX 默认采用的策略来决定每个图形的放置位置。例如，通过将图形放置在页面的顶部或底部。

我想知道是否有我可以提供的包、宏或一些命令，这样如果我有一个单列文档并且我主要有一个对图形的文本引用，那么这个图形会更多可能会被放置在同一页的引用中？

例如，假设我有一个很长的段落，中间有一个 \ref{FIG:X}。渲染时，一些段落出现在分页符之前，而一些出现在分页符之后。我还可以将 figure 命令放置在整个段落之前和之后的某个位置。有没有办法让它实际放置在与实际参考相同的页面中？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-01-15T23:03:05.113

我不想听起来**太**消极，但是在某些情况下，如果没有大量“人为”的分页符调整，您想要的几乎是不可能的。

如果标注自然落在页面底部附近，并且图形落在下一页上，则将图形向后移动一页可能会使标注*向前*移动。

我会建议（尽可能，并取决于数字的确切大小）：

*   用[t]（如果必须的话，用[h]）放置数字
*   将数字尽可能靠近“正确”的位置（[t] 和 [h] 不同）
*   使用 \input 包含来自单独文件的数字，这将使您在进行最终调整时更容易移动它们

以我的经验，这是对非可用时间的一大消耗（:-)

* * *

在回复 Jon 的评论时，我认为这是一个固有的困难问题，因为 LaTeX 的家伙不是无精打采的。您可能喜欢阅读[Frank Mittelbach 的论文](https://www.latex-project.org/publications/2000-FMi-TUG-xo-pfloat.pdf)。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-10-06T04:56:46.423

是的，将 float 包包含在文档顶部，并将 H（大写 H）作为图形说明符：

```
\usepackage{float}

\begin{figure}[H]
.
.
.
\end{figure} 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-20T09:45:05.023

您可以随时添加“！” 进入您的浮动选项。这样，latex 会非常努力地将图形放置在您想要的位置（我主要使用 [h!tb]），从而扩展了正常的排版规则。

我找到了另一个解决方案：
使用[float](http://www.tex.ac.uk/tex-archive/macros/latex/contrib/float/) -package。这样，您可以将数字放置在*您*想要的位置。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-01-15T22:44:01.797

`[h]`我通过始终使用浮动（例如数字）上的选项来解决这个问题，以便它们（大部分）去我放置它们的地方。然后当我查看最终草稿时，我通过在 LaTeX 源中移动它来调整浮动的位置。通常这意味着在引用它的段落周围移动它。有时我需要在适当的位置添加分页符。

我发现在 LaTeX 中浮动的默认位置是合理的，但是几乎总是需要手动调整才能使这样的事情恰到好处。（有时，当有很多花车和脚注时，一切都不可能完美。）

该课程的[手册](http://www.ctan.org/tex-archive/macros/latex/contrib/memoir/memman.pdf)有`memoir`一些关于 LaTeX 如何放置浮点数的很好的信息以及一些关于操作算法的建议。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-01-31T14:20:20.230

如果您想在所有人物上强制执行此行为，请尝试

```
...
\usepackage{float}
\floatplacement{figure}{H}
... 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-02-17T11:16:30.067

也许这会对你有所帮助？

```
\begin{center}
\includegraphics[scale=0.5]{picture_name}
\end{center} 
```

我认为当你的数字跑掉时最好使用图形命令。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-23T05:01:43.583

我有一些有用的意见。因为我对人物的位置有类似的问题。我使用了包“wrapfig”，它可以让数字被文本包裹起来。就像是

```
...
\usepackage{wrapfig}
\usepackage{graphicx}
...
\begin{wrapfigure}{r}{53pt}
\includegraphics[width=53pt]{cone.pdf}
\end{wrapfigure} 
```

在选项`{r}`中意味着从右侧放置图形。`{l}`可用于左侧。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-02-08T15:35:26.193

```
\setcounter{topnumber}{2}
\setcounter{bottomnumber}{2}
\setcounter{totalnumber}{4}
\renewcommand{\topfraction}{0.85}
\renewcommand{\bottomfraction}{0.85}
\renewcommand{\textfraction}{0.15}
\renewcommand{\floatpagefraction}{0.7} 
```

[http://robjhyndman.com/researchtips/latex-floats/](http://robjhyndman.com/researchtips/latex-floats/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-01-26T23:21:29.213

我发现对此有帮助的一种方法是使用`\include{file_with_tex_figure_commands}`

（*不*输入）

# css - 如何在从 if（或捕获错误）加载样式之前测试 SWF URL？

> ID：448777
> 
> 赞同：0
> 
> 时间：2009-01-15T22:38:56.580
> 
> 标签：css, apache-flex, url, actionscript

我正在尝试使用以下代码从外部 SWF 加载样式，但是当 URL 无效时，我不断收到 ActionScript 错误：

```
Error: Unable to load style(Error #2036: Load Never Completed. URL: http://localhost/css/styles.swf): ../css/styles.swf.
at <anonymous>()[C:\autobuild\3.2.0\frameworks\projects\framework\src\mx\styles\StyleManagerImpl.as:858] 

private function loadStyles(): void
{
    try
    {
        var styleEvent:IEventDispatcher = 
            StyleManager.loadStyleDeclarations("../styles.swf");

        styleEvent.addEventListener(StyleEvent.COMPLETE, 
                                                    loadStyle_completeHandler);

        styleEvent.addEventListener(StyleEvent.ERROR, 
                                                    loadStyle_errorHandler);
    }
    catch (error:Error)
    {
        useDefault();
    }
}

private function loadStyle_completeHandler(event:StyleEvent): void
{
    IEventDispatcher(event.currentTarget).removeEventListener(
        event.type, loadStyle_completeHandler);

    goToNextStep();
}

private function loadStyle_errorHandler(event:StyleEvent): void
{
    IEventDispatcher(event.currentTarget).removeEventListener(
        event.type, loadStyle_errorHandler);

    useDefault();
} 
```

我基本上想继续使用默认样式，如果无法加载此文件，用户会看到错误 - 但我似乎找不到任何方法来做到这一点。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T23:05:49.460

有趣的问题。尝试删除 removeEventListener 调用，或将其注释掉；在我的简短测试中，似乎事件处理程序被调用了两次（我不确定为什么，尽管我怀疑它与样式继承有关），并且评论该行就可以了。

如果您有相同的结果，您可以尝试先检查侦听器（使用 hasEventListener），然后再将其附加到您的 loadStyles() 函数中。希望能帮助到你！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T14:36:42.883

** 不是答案，而是更新：

仅供参考，这是在调用 StyleManager.loadStyleDeclarations() 时运行的 mx.styles.StyleManagerImpl 源中的 ActionScript 代码。我运行调试器并在第 858 行添加了一个断点（“throw new Error(errorText);”），然后断点被捕获。我认为它不应该在那里被捕获，但应该运行之前的 IF ("if (styleEventDispatcher.willTrigger(StyleEvent.ERROR))") 。

```
public function loadStyleDeclarations2(
                    url:String, update:Boolean = true,
                    applicationDomain:ApplicationDomain = null,
                    securityDomain:SecurityDomain = null):
                    IEventDispatcher
{
    var module:IModuleInfo = ModuleManager.getModule(url);

    var readyHandler:Function = function(moduleEvent:ModuleEvent):void
    {
        var styleModule:IStyleModule =
            IStyleModule(moduleEvent.module.factory.create());

        styleModules[moduleEvent.module.url].styleModule = styleModule;

        if (update)
            styleDeclarationsChanged();
    };

    module.addEventListener(ModuleEvent.READY, readyHandler,
                            false, 0, true);

    var styleEventDispatcher:StyleEventDispatcher =
                                    new StyleEventDispatcher(module);

    var errorHandler:Function = function(moduleEvent:ModuleEvent):void
    {
        var errorText:String = resourceManager.getString(
            "styles", "unableToLoad", [ moduleEvent.errorText, url ]);

        if (styleEventDispatcher.willTrigger(StyleEvent.ERROR))
        {
            var styleEvent:StyleEvent = new StyleEvent(
                StyleEvent.ERROR, moduleEvent.bubbles, moduleEvent.cancelable);
            styleEvent.bytesLoaded = 0;
            styleEvent.bytesTotal = 0;
            styleEvent.errorText = errorText;
            styleEventDispatcher.dispatchEvent(styleEvent);
        }
        else
        {
            throw new Error(errorText);
        }
    };

    module.addEventListener(ModuleEvent.ERROR, errorHandler,
                            false, 0, true);

    styleModules[url] =
        new StyleModuleInfo(module, readyHandler, errorHandler);

    // This Timer gives the loadStyleDeclarations() caller a chance
    // to add event listeners to the return value, before the module
    // is loaded.
    var timer:Timer = new Timer(0);
    var timerHandler:Function = function(event:TimerEvent):void
    {
        timer.removeEventListener(TimerEvent.TIMER, timerHandler);
        timer.stop();
        module.load(applicationDomain, securityDomain);
    };

    timer.addEventListener(TimerEvent.TIMER, timerHandler, false, 0, true);

    timer.start();

    return styleEventDispatcher;
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-23T22:22:01.373

我调试了源代码，发现错误事件*被*触发了两次。因此，我只需在第一次触发 ERROR 事件处理程序时设置一个标志，并在继续之前检查该标志的值为 true：

```
private var isErrorTriggered:Boolean; // Default is false

private function loadStyle_completeHandler(event:StyleEvent):void
{
    IEventDispatcher(event.currentTarget).removeEventListener(
        event.type, loadStyle_completeHandler);

    goToNextStep();
}

private function loadStyle_errorHandler(event:StyleEvent):void
{
    if (isErrorTriggered)
        return;

    isErrorTriggered = true;

    useDefault();
} 
```

# .net - Castle-Windsor Fluent Interface：如何注册所有接口的所有实现？

> ID：448788
> 
> 赞同：2
> 
> 时间：2009-01-15T22:43:18.147
> 
> 标签：.net, castle-windsor, fluent-interface

我有两个程序集**EDC2.DAL**和**EDC2**，其中 EDC2.DaoInterfaces 定义了一组接口，用于数据访问对象到 EDC2.Domain 命名空间中的对象。这些都是由 EDC2.DAL 中的类实现的。

所以举个例子：

```
Assembly EDC2
  Namespace EDC2.DaoInterfaces
    ICustomerDao
    IProductDao
Assembly EDC2.DAL
  Namespace EDC2.DAL
    CustomerDao : ICustomerDao
    ProductDao : IProductDao 
```

我想使用 Windsor 的流利接口将 EDC2.DaoInterfaces 中的所有接口注册为由它们在 EDC2.DAL 中的相应实现者实现。

谁能告诉我该怎么做？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-16T01:37:01.497

[在这里](http://blogger.forgottenskies.com/?p=266)找到解决方案：

```
AllTypes.Pick().FromAssemblyNamed("EDC2.DAL").If(x => !x.IsGenericType).WithService.FirstInterface() 
```

# amazon-web-services - Amazon EC2 实例如何选择其内核？

> ID：448794
> 
> 赞同：15
> 
> 时间：2009-01-15T22:45:41.717
> 
> 标签：amazon-web-services, amazon-ec2, kernel, fedora

我有一个使用 Amazon 提供的 Fedora 8 64 位 AMI 的 Amazon EC2 实例，我想将其升级到 Fedora 10。

我尝试通过运行“yum update”来升级内核和所有软件包。这似乎工作正常，我看到我现在已经安装了 fc10 内核，并且我安装的所有软件包也都更新到了 Fedora 10 版本。

然而，我也注意到 fc8 内核仍然安装，当我重新启动我的映像时，它会返回运行 fc8 内核，而不是 fc10 内核（我从“uname -a”的输出推断出这一点）。

是否需要采取一些额外的步骤才能让我的映像在 fc10 内核下启动，或者这是否可能？亚马逊文档没有发现任何对我有用的东西。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2011-01-27T21:55:50.707

您可以创建自己的 AMI，但需要使用 Amazon 提供的内核。他们提供的最新版本是 2.6.21。我有一个用于 CentOS 实例的 fc（Fedora Core）内核列表。我很确定它们也可以在 Ubuntu 上正常工作。

当您使用 ec2-register 注册 AMI 时，您需要将它们烘焙到您的 AMI 中。它们可以在您启动实例时更改，但我喜欢从正确的 AKI（内核）和 ARI（ramdisk）开始。添加对临时磁盘的支持也很有帮助。您正在为更大实例的额外存储付费，您不妨使用它。我对 ec2-register 的魔法咒语：

```
ec2-register --snapshot snap-12345678 -K pk-XXXXXXXXXXX.pem -C cert-XXXXXXXXXXX.pem \
--description "EBS CentOS 5.5 i386" --name "base-image-i386-4" --architecture i386 \
--root-device-name /dev/sda1 -b /dev/sdb=ephemeral0 -b /dev/sdc=ephemeral1 \
-b /dev/sdd=ephemeral2 -b /dev/sde=ephemeral3 --region us-east-1 \
--kernel aki-6eaa4907 --ramdisk ari-e7dc3c8e 
```

您可以更改区域、快照 ID、描述、名称、拱门等。

还要记住内核和 ramdisk 是特定于区域的。我不记得我从哪里得到这个列表，但我很难找到它。希望它可以帮助某人。

2.6.21 内核可用作：

美国地区：

32 位：

```
* aki-6eaa4907
* ari-e7dc3c8e
* ami-48aa4921 
```

64 位：

```
* aki-a3d737ca
* ari-4fdf3f26
* ami-f61dfd9f 
```

欧盟地区：

32 位：

```
* aki-02486376
* ari-aa6348de
* ami-0a48637e 
```

64 位：

```
* aki-f2634886
* ari-a06348d4
* ami-927a51e6 
```

亚太地区：

64 位：

```
* aki-07f58a55
* ari-27f58a75
* ami-ddf58a8f 
```

32 位

```
* aki-01f58a53
* ari-25f58a77
* ami-c3f58a91 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-06-16T17:36:26.043

您不能将*自己的*内核映像上传到 EC2/Amazon。只有授权用户才能上传内核镜像。即使您上传自己的 Linux 操作系统映像并在 EC2 中从它启动，也会加载一个与您最初上传的内核不同的预定内核。这是亚马逊做出的政策决定。您最多可以做的是从您希望实例启动的预定和可用亚马逊内核列表中选择更改默认内核版本。

但是，您*可以*构建自己的内核模块或为加载的内核重建模块。编译您自己的模块或重新编译正在加载的内核提供的模块有点棘手，因为亚马逊中的内核是使用 Xen 管理程序修改的内核。您需要找出在您的实例中加载的特定内核源代码。

干杯

埃内斯托·贝内迪托

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-15T23:07:55.727

看起来你不能。这家伙试过了，但还没有成功。

[http://developer.amazonwebservices.com/connect/thread.jspa?messageID=72964#72964](http://developer.amazonwebservices.com/connect/thread.jspa?messageID=72964#72964)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-10T05:31:06.480

从技术上讲，至少直到最近，您还无法选择内核。您只能选择要打包到映像中的模块。亚马逊保留对内核的完全控制权。这可能是必要的，因为 Xen 虚拟化必须以某种特殊方式与内核交互。

在最近的更新中（几个月前，上次我检查），亚马逊扩展了他们的一些 API 和工具，允许您从他们提供的几个内核中进行选择。例如，您可以在 2.6.16 和 2.6.18 之间进行选择。

看起来最终可能会支持构建您自己的“内核映像”，但为此所需的工具并不完整。我猜他们（亚马逊）仅向特殊合作伙伴提供此功能，因为我看到出现了几个具有特殊关联内核映像的第三方映像。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-15T23:10:31.277

根据我使用 OpenSolaris AMI 的经验，这是不可能的。pkg image-update 工具也在 EC2 环境中被禁用，以精确防止这种情况发生。原因可能是每个映像都与特定的 ramdisk 和内核（aki 和 ari）相关联。而且，它们不能更新为新的。我认为，正如在您的案例中所观察到的，这也适用于其他 AMI。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-01-26T07:41:24.167

最好的选择可能是创建自己的 AMI；加载 AMI 时获得的内核是创建 AMI 时正在运行的内核。

# ubuntu - 将 Ubuntu 6.06 LTS Server 升级到 Ubuntu 8.10 Desktop 的升级路径是什么？

> ID：448807
> 
> 赞同：3
> 
> 时间：2009-01-15T22:48:23.847
> 
> 标签：ubuntu, vmware

我的开发团队使用 Ubuntu 6.06 LTS Server VMware 映像作为我们的开发环境。它上面有我们的开发堆栈。我想将它升级到 Ubuntu 8.10 桌面（注意：桌面，而不是服务器）。. . 同时不破坏原始图像中的任何开发堆栈。开发堆栈使用 6.06 发行版中的 apt-get 包。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T22:56:13.550

*   [首先执行网络升级到下一个 LTS 版本 (8.04)](http://www.ubuntu.com/getubuntu/upgrading-8.04#head-e059d5452a24b50d09c64df48058ef2d834eb197-2)
*   [然后升级到8.10](http://www.ubuntu.com/getubuntu/upgrading#Network%20Upgrade%20for%20Ubuntu%20Servers%20(Recommended))
*   现在你有一个 8.10 服务器。要安装桌面，只需执行

`sudo apt-get install ubuntu-desktop`

你很高兴去！在升级过程中，您可能会遇到一些问题——我在升级到 8.04 时发生的一件事是 trac 的配置不同，但幸福只是谷歌搜索而已。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T22:53:06.117

不支持从 6.06 直接升级到 8.10。从 6.06 升级到 8.04 应该可以工作，从 8.04 升级到 8.10 应该可以工作。由于您使用的是虚拟机，我强烈建议您在尝试升级之前拍摄快照。

花点时间查看 google、ubuntu 论坛和 ubuntu wiki 以了解您使用的特定软件包。在尝试此操作之前解决升级问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-28T21:24:00.310

您还需要安装另一个内核，因为 Ubuntu Server 带有为服务器配置的内核，而不是桌面。例如，您可以这样做`sudo apt-get install linux-image-generic`

# c++ - 计算总 CPU 使用率

> ID：448811
> 
> 赞同：1
> 
> 时间：2009-01-15T22:49:23.003
> 
> 标签：c++, windows

在进程执行期间的特定时间计算总 CPU 使用率的最佳算法是什么。

我正在使用 C++ 工作 Windows 平台。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-16T00:17:33.370

`GetProcessTimes` for 100-nanosecond resolution. If you want cycle times, use `QueryProcessCycleTime` in Vista and above.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T23:13:10.710

英特尔 VTune 是分析 CPU 资源的绝佳工具：http: [//www.intel.com/cd/software/products/asmo-na/eng/239144.htm](http://www.intel.com/cd/software/products/asmo-na/eng/239144.htm)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-09-01T15:30:30.363

让我向您推荐这篇很棒的文章： http: [//www.codeproject.com/KB/threads/Get_CPU_Usage.aspx](http://www.codeproject.com/KB/threads/Get_CPU_Usage.aspx)

我相信你会发现它很有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-27T10:40:05.470

// 声明
PerformanceCounter cpuCounter = null;

// 在构造函数的某个地方初始化..
cpuCounter = new PerformanceCounter();
cpuCounter.CategoryName = "处理器";
cpuCounter.CounterName = "% 处理器时间";
cpuCounter.InstanceName = "_Total";

然后要以 % 为单位获取 CPU 使用率，只需调用
cpuCounter.NextValue()

来源：http: [//zamov.online.fr/EXHTML/CSharp/CSharp_927308.html](http://zamov.online.fr/EXHTML/CSharp/CSharp_927308.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T00:03:06.507

Use WMI to get "PercentProcessorTime"; beware that this will probably have its own performance penalty.

If you are looking to throttle your application, a better way it to have your own internal performance metric specific to your application and throttle based on that (e.g. screen refresh rate, etc.)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T07:16:48.313

不要使用 WMI 只需使用 win32 NAPI

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-02T08:59:07.497

获取一段时间内总 CPU 负载的最简单方法是使用[GetSystemTimes](http://msdn.microsoft.com/en-us/library/windows/desktop/ms724400%28v=vs.85%29.aspx) API。它是从 Windows XP SP1 开始可用的内核函数。它返回自系统启动以来使用的 CPU 时间量。因此，在某个时间间隔内获得的这些值之间的差异将得出该时间间隔内的总 CPU 使用率。

请记住，此函数提供的内核时间包括“空闲”时间，因此您必须从中减去第一个参数返回的空闲时间。

该函数返回所有可用内核/处理器的总时间，因此您可能还希望将增量除以从[GetSystemInfo](http://msdn.microsoft.com/en-us/library/windows/desktop/ms724381%28v=vs.85%29.aspx)获得的处理器数量。

# oracle - Oracle 9i：据说缺少右括号

> ID：448821
> 
> 赞同：0
> 
> 时间：2009-01-15T22:54:02.370
> 
> 标签：oracle, function, ora-00907

我有一个用 Oracle 9i（版本 9.2.0.4.0）编写的简单函数来模拟内联 IF。对于那些感兴趣的人，这是代码：

```
create or replace
FUNCTION IIF  
   (testExpression NUMBER,
    trueResult NUMBER,
    falseResult NUMBER)
RETURN NUMBER   
AS
BEGIN
   /*
      A simple in-line IF function for use with SQL queries. If the test
      expression evaluates to any non-zero value, it is considered to be 
      true, and the trueResult is returned. Otherwise, falseResult is
      returned.
   */   
   IF (testExpression is null) or (testExpression = 0) THEN
      return falseResult;
   ELSE
      return trueResult;
   END IF;
END IIF; 
```

这不是火箭科学。现在，这里有个大谜团：如果我执行以下 SQL 语句，一切都很好，并且完全按照我的预期工作：

```
SELECT IIF(1, 'true', 'false') FROM DUAL;
SELECT IIF(0, 'false', 'true') FROM DUAL; 
```

但是，以下内容会从 Oracle 生成一个非常奇怪的错误：

```
SELECT IIF((0 = 1), 'false', 'true') FROM DUAL; 
```

该错误如下：

```
ORA-00907: missing right parenthesis. 
```

显然，事实并非如此。会有人碰巧对这种奇怪的事情有一个解释吗？

目前需要大量的自我控制来克制自己不要将 Oracle 服务器扔出窗外。甲骨文似乎*充斥*着这些无聊的东西。

编辑：我必须使用某种魔术语法在选择语句中使用相等运算符吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T23:13:35.997

也许你可以解释你想要做什么。我认为您正在寻找`CASE`or`DECODE`功能，但我不能确定。由于某种原因，您似乎正在违背 SQL 语言的本质。

发生错误是因为 Oracle 不希望`select`查询子句中包含关系运算符：

```
SQL> SELECT IIF(1>7, 0, 1) FROM DUAL;
SELECT IIF(1>7, 0, 1) FROM DUAL
            *
ERROR at line 1:
ORA-00907: missing right parenthesis

SQL> SELECT 1=0 FROM DUAL;
SELECT 1=0 FROM DUAL
        *
ERROR at line 1:
ORA-00923: FROM keyword not found where expected 
```

请参阅[这篇询问汤姆文章](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:6263249199595)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T02:15:32.337

你要

```
SELECT CASE WHEN *expr* then 'true' else 'false' end col_alias FROM DUAL; 
```

或用于简单的相等测试

```
SELECT DECODE(*val1*,*val2*,'true','false') col_alias FROM dual; 
```

这将比退出到 PL/SQL 函数执行得更好。您的方法不起作用的原因有很多。

1.  布尔值不是 Oracle 数据类型。

2.  它们是 PL/SQL 数据类型，但即便如此，也没有隐式转换为数字（零假，非零真）

3.  没有“表达式”数据类型，因此 SQL 引擎无法将表达式传递给 PL/SQL。

4.  即使您将表达式作为字符串传递给 PL/SQL，PL/SQL 引擎也无法动态评估字符串中的表达式。它必须将字符串构建成动态 SQL 语句并动态执行，返回结果（以有效的 SQL 数据类型，如字符串或数字）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T23:56:38.763

1.  Oracle 数据库中没有 BOOLEAN 类型，所以不能使用像“(1=0)”这样的表达式。
2.  即使存在 BOOLEAN 类型，您也已将第一个参数声明为 NUMBER 类型。你必须给它传递一个数字，或者可以隐式转换为一个的东西。
3.  最后，我不明白除了“无效数字”之外，您的任何示例实际上如何产生任何内容，因为您的第二个和第三个参数也不能转换为数字。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T22:59:59.050

从未与 oracle 合作过，我无法直接提供任何合理的建议，但是查看声明可能是 oracle 在从布尔值推断数字时遇到问题？..

IIF 签名需要一个 NUMBER 作为第一个参数，并且在调用中您正在传递一个 BOOL 评估。

这只是一个想法。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-16T16:14:11.797

除了decode和case，还有nvl。

# c++ - 在 VS 2008 中使用相同设置构建一堆 DLL 文件的最快方法

> ID：448828
> 
> 赞同：1
> 
> 时间：2009-01-15T22:57:32.037
> 
> 标签：c++, visual-studio-2008, shared-libraries

我目前正在移植一个 POSIX C++ 应用程序以在没有 Cygwin 或任何东西的情况下在 Windows 上运行。到目前为止没有问题。现在，该应用程序（ZNC，一个 IRC 保镖，如果你感兴趣的话）支持从 Linux/BSD 等上的 .so 共享库文件加载模块。

我毫无问题地移植了主要的可执行文件，全部打包到 VS 2008 项目文件中。现在，所述模块都是单独的 .cpp 文件，它们都无法链接到可执行文件，因为它们都导出 GetVersion() 等符号。而且无论如何也不可行。

所以，长话短说，我想（必须）将所有模块（超过 20 个）编译成单独的 DLL 文件。但是，我不想为每个项目创建一个 VS 项目。这意味着我可能必须创建一个makefile？或者类似的东西？我以前从未在 Windows 上这样做过，所以这是我的问题。将一堆 .cpps 编译成单独的 DLL 文件（具有相同的设置，所有这些都方便地存储在一个地方/文件中）的最佳方法是什么？

提前致谢！红外

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T23:47:15.913

据我所知，没有内置的方法可以做到这一点。所以这就是我要做的：

1.  将其中一个模块转换为 DLL，确保它可以正常工作并且一切正常。

2.  编写一个脚本，从一个有效的参考 vcproj 生成其他 20 个 vcproj。我不知道你的模块系统的细节，所以我不确定这会有多困难。

3.  将它们添加到解决方案中。

希望这行得通。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T23:53:30.487

[cmake](http://www.cmake.org/)与 MSVC 配合得很好，并且是跨平台的。您可以在一个（或者，根据您的选择，每个 dll 一个）CMakeList.txt 文件中列出所有库，它将生成包含所有项目文件的解决方案。在 unix 上，它生成 makefile。

哦，如果我没记错的话，在 Windows 中，make 被称为 nmake。

# ms-word - 突出显示 MS Word 文档中的搜索词

> ID：448830
> 
> 赞同：2
> 
> 时间：2009-01-15T22:57:35.670
> 
> 标签：ms-word, full-text-search, highlighting

我们有一个项目，我们需要通过基于 Web 的界面提供对 Word 文档集合的搜索。客户端希望在用户打开文档时突出显示搜索词。

打开文档时，有没有办法直接在 Word 中执行此操作？我们能想到的唯一选择是将 Word 文档转换为 HTML 并显示出来。

仅作为背景，我们目前使用 Windows SharePoint Services 进行文档搜索。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T23:35:51.740

您可以使用 Word 的突出显示功能来做到这一点。但是，要使用该功能，您必须在服务器端或客户端使用 Word 自动化。

VBA 中用于突出显示搜索词的脚本可能如下所示：

```
Sub Highlight(oDoc As Word.Document, term As String)

    With oDoc.Range.Find
        .ClearFormatting
        .Replacement.ClearFormatting
        .Replacement.Highlight = True
        .Text = term
        .Replacement.Text = term
        .Forward = True
        .Wrap = wdFindContinue
        .Format = True
        .MatchCase = False
        .MatchWholeWord = False
        .MatchWildcards = False
        .MatchSoundsLike = False
        .MatchAllWordForms = False
        .Execute Replace:=wdReplaceAll
    End With

End Sub 
```

该脚本执行搜索和替换并将突出显示应用于找到的文本。如果您对如何最好地自动化 Word（例如在服务器环境中）有任何疑问，请不要犹豫。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-05-04T03:15:30.930

Kwizcom 有一款产品可以满足这种需求——我没试过，你的里程可能会有所不同！SharePoint 搜索字符串突出显示 - [http://www.kwizcom.com/ProductPage.asp?ProductID=28](http://www.kwizcom.com/ProductPage.asp?ProductID=28)

此外，如果可以接受将 Word 文档转换为 PDF（并且假设您安装了 PDF iFilter 以便对这些文档进行索引），则可以通过将参数附加到 URL 来在结果文档中突出显示搜索词。Adobe Viewer 客户端可以解释这些并基本上对文档进行客户端搜索。有关详细信息，请参阅[http://www.novolocus.com/2008/05/15/hit-highlighting-inside-adobe-pdfs-using-sharepoint-search/ 。](http://www.novolocus.com/2008/05/15/hit-highlighting-inside-adobe-pdfs-using-sharepoint-search/)

希望这可以帮助！

# java - JScrollPane 现在显示其视口

> ID：448832
> 
> 赞同：1
> 
> 时间：2009-01-15T22:58:00.973
> 
> 标签：java, swing, jscrollpane, viewport

我正在使用 Java Swing 制作应用程序，但遇到了问题。我制作了一个选项卡式面板，它需要一个简单的面板和一个滚动面板。简单面板工作正常，但在我的滚动面板中，我只能看到滚动条，但看不到视口，我的代码如下：

内容窗格

```
public class ContentPane extends JTabbedPane {
    private InfoPanel ip;
    ScrollPanel sp;

    public InfoPanel getIp() {
        return ip;
    }

    public ContentPane(GraphPanel gp) {
        this.sp = new ScrollPanel(gp);
        this.sp.setViewportView(gp);

        this.addTab("Graph", this.sp);
        this.ip = new InfoPanel(gp);
        this.addTab("Info", ip);
    }
} 
```

滚动面板

```
public class ScrollPanel extends JScrollPane {
    public ScrollPanel(GraphPanel gp){
        this.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS);
        this.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);
        this.repaint();
    }
} 
```

图形面板

```
public GraphPanel(StatusBar sb) {
    this.sb = sb;
    zoomLevel = 5;
    sm = new Simulation();
    mh = new MouseHandler(this, sm);
    this.addMouseListener(mh);
    this.setBackground(new Color(240, 165, 98));        
    this.repaint();
} 
```

由于我没有收到任何错误或异常，因此我现在完全迷失了采取哪种方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T23:17:39.810

您不应该继承 JScrollPane，这不是必需的。

但是如果你这样做了，不要忘记将组件添加到滚动窗格中。

在您的子类中，您**没有**将 GraphPanel 添加到滚动窗格中。：

```
public class ScrollPanel extends JScrollPane {
    public ScrollPanel(GraphPanel gp){

         // ::::  HERE ::: you are not doing anything with gp 
         // like this.setViewPort( gp ) or something like that

        this.setHorizontalScrollBarPolicy(JScrollPane.HORIZONTAL_SCROLLBAR_ALWAYS);
        this.setVerticalScrollBarPolicy(JScrollPane.VERTICAL_SCROLLBAR_ALWAYS);
        this.repaint();
    }
} 
```

尝试：

```
public class ScrollPanel extends JScrollPane {
    public ScrollPanel(GraphPanel gp){
        super( gp );
        .... etc ... 
```

并让 GraphPanel 扩展 JComponent 或 JPanel

# .net - 如何随时检索在 IIS 上连接的用户数？

> ID：448834
> 
> 赞同：3
> 
> 时间：2009-01-15T22:58:06.403
> 
> 标签：.net, session

我想知道在一个简单的 .net 页面上的任何时候有多少用户连接到 IIS Web 服务器。有没有办法在 3.5 中使用本机 .net 类来告诉我这些信息？我想创建一个简单的网页，它会给我在给定时间的用户总数/打开会话数。

目前，我正在使用 Perfmon 来获取此信息，但是我想创建一个简单的网页来检索此信息

感谢你的帮助。

提前致谢。

尼拉吉

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T23:04:38.307

**更新 1：**为了更简单（和准确），只需使用 PerformanceCounter 对象来获取我在下面指定的信息。

**更新 0：**有[一篇关于如何](http://msdn.microsoft.com/en-us/library/ms979194.aspx)在 asp.net 页面中显示性能计数器的 msdn 文章（还有更多，但这并不重要）。

您可以显示

> 网络服务 => 当前连接 => 总数

您页面上的计数器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T23:09:22.697

如果您正在运行 IIS7，我知道[Microsoft.Web.Administration](http://msdn.microsoft.com/en-us/library/microsoft.web.administration.aspx)可以让您提取给定工作进程的请求列表。遗憾的是，我只在我们的管理脚本中运行了它，所以我不确定它在 Web 进程中的行为或安全要求是什么，但它可能会对您有所帮助。

# python - 如何创建带有按钮的网页，这些按钮在为网页提供服务的系统上调用各种 Python 脚本？

> ID：448837
> 
> 赞同：25
> 
> 时间：2009-01-15T22:58:46.447
> 
> 标签：python, windows, web-services, cgi

我是一个业余爱好者（也是相当新的）程序员，他用 python 编写了几个有用的（对我来说）脚本来处理各种系统自动化任务，包括复制、重命名和下载文件以及其他杂项活动。

我想从我的一个系统中创建一个网页，该网页仅显示几个按钮，允许我远程启动这些脚本。

问题是我不知道从哪里开始研究如何做到这一点。假设我有一个名为：

*file_arranger.py*

我需要做什么才能让网页执行该脚本？这不适合公共消费，所以任何轻量级的东西都会很棒。对于奖励积分，我需要查看哪些内容才能为 Web 用户提供此类脚本的输出？

编辑：第一个答案让我意识到我忘了包括这是一个 Win2k3 系统。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-15T23:16:36.507

[python 站点上的此页面](http://docs.python.org/library/cgi.html)对运行 python CGI 脚本所需的操作进行了很好的描述和示例。首先从最简单的情况开始。只需制作一个打印 html 的简短脚本。

```
#!/usr/bin/python                   #on windows change to your path to the python exe

print "Content-Type: text/html"     # HTML is following
print                               # blank line, end of headers
print "<TITLE>CGI script output</TITLE>"
print "<H1>This is my first CGI script</H1>"
print "Hello, world!" 
```

当您第一次尝试此操作时，最困难的部分通常是弄清楚将脚本放在哪里以及如何让 Web 服务器识别并运行它。如果您使用的是 apache Web 服务器，请查看[这些配置步骤](http://httpd.apache.org/docs/2.2/howto/cgi.html)。

一旦你有这个简单的脚本工作，你只需要添加一个 html 表单和按钮标签，并使用 action 属性将它指向你想要运行的脚本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-01-16T11:55:58.947

这种简单的方法只需要 Python 标准库。创建这个目录结构：

```
.
|-- cgi-bin
|   `-- script.py
|-- index.html
`-- server.py 
```

您将脚本放在“cgi-bin”目录中，“index.html”包含指向“cgi-bin”目录中脚本的链接（因此您不必手动键入它们，尽管可以），以及“server.py " 包含以下内容：

```
import CGIHTTPServer
CGIHTTPServer.test() 
```

要运行您的服务器，只需运行“server.py”。就是这样，没有 Apache，没有其他依赖项。

HTH...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-01-15T23:02:23.633

您只需将它放在设置为执行 CGI 脚本的目录中，然后您需要添加

```
#!/usr/bin/env python 
```

到顶部，如果链接到它，它应该像普通的 python 脚本一样执行脚本。（就像你想要一个 HTML 或 PHP 文件一样）

当然，这假设您的网络服务器完全设置为执行 CGI，并且您有一个 linux 系统。

如果您想要更花哨的东西，还有其他替代解决方案，例如 mod_python 和 Pylons 等 Web 框架，但我认为 CGI 解决方案更适合您的用例。

[编辑]

在 Windows 上，如果你有 Apache，你应该能够使用相同的方法，但替换 #! 后面的东西！使用 python.exe 的路径，如下所示：

```
#!C:\Python25\python.exe -u 
```

根据此链接，显然需要 -u 将 Python 置于无缓冲模式，该链接也有更深入的信息：[http ://www.imladris.com/Scripts/PythonForWindows.html](http://www.imladris.com/Scripts/PythonForWindows.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-15T23:05:05.623

您应该将[CherryPy](http://www.cherrypy.org/)视为您的 HTTP 请求处理程序，可以将其配置为在非常轻量级的[NGINX](http://nginx.net/) Web 服务器（或 Apache，如果您愿意）上运行。

然后，您可以将其他脚本导入您在 CherryPy 上运行的服务。这将为您提供更多控制来监视过程并在发生错误时捕获错误。

另一种选择是简单地告诉操作系统使用 os.system() 触发命令。 [在此处查看](http://www.frihost.com/forums/vt-62880.html)使用 os.system() 的不同方法的示例。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-16T00:05:09.620

您只需一个简单的 cgi 脚本（或一组脚本）即可开始使用。其他答案已经涵盖了如何做到这一点，所以我不会重复它；相反，我要强调的是，**使用纯文本会让你走得更远**。只需输出标题（`print("Content-type: text/plain\n")`加上 print 添加它自己的换行符，为您提供所需的空白行），然后运行您的正常程序。

这样，您脚本的任何正常输出都会发送到浏览器，您不必担心 HTML、转义、框架等任何事情。“做可能可行的最简单的事情。”

这尤其适用于您所描述的非交互式私人管理任务，并允许您从 shell 中使用相同的程序，而无需大惊小怪。您的驱动程序，即带有按钮的页面，可以是具有单按钮表单的静态 HTML 文件。甚至是链接列表。

要从那里继续前进，请查看日志记录模块（例如，将 INFO 消息发送到浏览器而不是命令行，或者通过配置处理程序使用不同的记录器轻松分类消息），然后开始考虑模板引擎和框架.

*不要*输出您自己的 HTML 并跳到使用许多现有库中的一个——即使花费一些额外的时间来学习该库，也会省去很多麻烦。或者至少通过有效地编写您自己的迷你引擎来封装您的输出。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-15T23:13:59.943

如果您了解 Apache [，这](http://www.linux.com/feature/136602)应该可以帮助您入门。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-15T23:15:52.827

在较早的问题中，我要求[将 AJAX 网站连接到 Python](https://stackoverflow.com/questions/336866/how-to-implement-a-minimal-server-for-ajax-in-python)的最小实现。这可能会完成您正在寻找的东西。它有一个按钮，可以触发一些 Python 代码，然后在页面上显示结果。我的解决方案使用 Python 中的内置网络服务器，所以它真的很轻量级（没有额外的包甚至 Apache）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-16T01:26:21.173

设置时，*请*注意限制对在您的 Web 服务器上执行某些操作的脚本的访问。将它们放在您不发布 URL 的目录中是不够的，因为迟早会有人找到它们。

至少，将这些脚本放在受密码保护的位置。您不希望互联网上的任何人都能够运行您的脚本。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-07-21T15:12:54.863

如果您现在使用的是 Python 3，那么***print***是一个需要括号的函数。

```
#!/Python34/python
print ("Content-type: text/html\n")
print ("<html><head>")
print ("</head><body>")
print ("Hello World from Python Script.")
print ("</body></html>") 
```

# model-view-controller - 控制器是否处理与 MVC 中模型的所有交互？

> ID：448839
> 
> 赞同：0
> 
> 时间：2009-01-15T22:58:55.807
> 
> 标签：model-view-controller

我正在使用 MVC 模式创建一个吃豆人游戏。根据[维基百科上的这个图表，](http://upload.wikimedia.org/wikipedia/commons/2/2e/ModelViewControllerDiagram.svg)模型和视图交互。

*“注：实线表示直接关联，虚线表示间接关联”*

现在根据我的理解，肯定一切都通过控制器吗？例如，玩家移动或用户点击添加到购物车，这不是由控制器处理并由控制器操作模型中的适当数据吗？

我看不出为什么视图会直接与模型交互？

谢谢

亚当

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T23:17:02.900

视图从模型中获取它应该显示的数据。（例如：您购物车中的商品列表）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-15T23:17:41.870

确实，几乎没有理由从您的视图中修改您的模型（这是不可以的），但您最终可能会从您的视图中访问（如阅读）模型。

让我们做一些伪代码。

假设你有`Player`一个`Game`模型。

您的控制器可能会执行以下操作：

```
player1 = new Player();
player1.setLives(3);
player1.setScore(0);
player1.setPosition(0, 0);
game = new Game();
game.addPlayer(player1);
game.launch(); 
```

然后，您的视图可能会执行以下操作：

```
foreach (game.getPlayers() as player) {
   gameBoard.draw(pacmanGlyh, player.getPosition());
} 
```

您会看到您正在使用视图中的模型。

但请记住，关于如何实现 MVC 的理念因程序员而异。有些人可能会建议使用[观察者模式](http://en.wikipedia.org/wiki/Observer_pattern)，具体取决于您在做什么。MVC 的最终目标是真正将您的业务逻辑与用户界面分离，让您在进行维护和重构以及保持代码干净时更轻松。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-15T23:19:07.797

不，视图从模型中读取数据（通常使用观察者模式）。PAC (presentation-abstraction-controller) 是使用中介者模式的基于 MVC 的模式的一个很好的例子——控制器在视图和模型之间传递消息。

# jquery - 用 jquery 加载页面后替换特定文本

> ID：448842
> 
> 赞同：1
> 
> 时间：2009-01-15T23:00:01.530
> 
> 标签：jquery, replace

页面加载 jquery 后，是否可以用其他文本替换确切的文本？

例如，我的数据是在 php 循环中动态生成的。完成信息输出后，我想进行查找和替换，将整个页面中的“测试短语 1”替换为“测试短语 2”。这可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-12T05:37:52.270

您不需要另一个插件来完成此任务。

jQuery 函数 .replace() 非常适合。您可以在任何属性或文本上使用它。例子：

```
var href = $this.attr("href").replace(/param\/.*\//, "param/newparam/"); 
```

这 - 使用正则表达式 - 接受一个 url 并替换第一次出现的`param/anything/`with `param/newparam`。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T23:48:44.523

我想你会发现[jquery-translate](http://code.google.com/p/jquery-translate/)很有用。它甚至有你需要的方法，即：$()。[节点包含文本](http://code.google.com/p/jquery-translate/wiki/NodesContainingText)（...）

# c - C中的可变大小数组与calloc

> ID：448844
> 
> 赞同：7
> 
> 时间：2009-01-15T23:00:39.703
> 
> 标签：c, algorithm, arrays, malloc

关于动态内存的讨论：[“C 指针和动态内存简介”](http://theocacao.com/document.page/234)

作者指出：

> 像这样的内存块可以有效地用作更灵活的数组。这种方法实际上在现实世界的 C 程序中更为常见。它也比“可变大小数组”更具可预测性和灵活性

他所说的内存块类型是这样的：

```
const int size = 5;
int * array = calloc(size, sizeof(int)); 
```

然后使用另一个指针遍历数组：

```
int * index = array;
for (i = 0; i < size; i++) {
    *index = 1; // or whatever value
    index++;
} 
```

我的问题是这种方法比像这样的标准可变大小数组更好吗？：

```
int array[variable]; 
```

或动态：

```
char name[] = "Nick"; 
```

作者并没有真正解释为什么我应该更喜欢前一种方法而不是后者。或者更具体地说：它如何更“可预测和灵活”？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-15T23:04:00.477

如果您声明`int array[variable]`将在堆栈上分配内存，这对于大型、相对永久的数据结构（例如您可能想要返回的数据结构）来说不是很好。如果使用数组语法，则不需要手动释放内存，因为它会在超出范围时被释放。`calloc`另一方面，将在运行时在堆上动态分配内存。完成后，您必须自己释放它。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-01-15T23:04:39.807

我同意 ocdecio 的观点，即[c89](/questions/tagged/c89 "显示标记为“c89”的问题")不允许

```
int array[variable] 
```

[c99](/questions/tagged/c99 "显示标记为“c99”的问题")允许某些类型的变量和表达式为数组大小。但除此之外，分配给`malloc`和家庭的东西可以使用`realloc`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-07-25T22:42:33.533

在堆栈上使用可变大小的数组作为自动变量（而不是使用 calloc/malloc/new/etc 的堆）对于将要运行很长时间并且需要制造和销毁批次的进程来说不是一个坏主意的小数组。这是因为堆栈保证永远不会碎片化，而内存可以并且将会碎片化。如果您正在编写固件或需要多年不间断运行的服务，则几乎禁止您使用 malloc 或 new。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-01-20T18:20:53.750

ISO C99 允许可变长度自动数组，作为扩展，GCC 在 C90 模式和 C++ 中接受它们。所以，不要忘记设置编译器标志 -std=c99 或 -std=gnu99。以下示例将起作用

```
#include<stdio.h>

int main()
{
    int n;
    printf("\n\tEnter the number of digits: ");
    scanf("%d", &n);

    char str[n];
    for(int i=0; i < n; i++) {
        scanf("%s", &str[i]);
    }

    printf("\n\tThe entered digits are: %s", str);
return 0;
} 
```

我保证:-)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-15T23:04:07.327

因为

```
int array[variable]; 
```

在标准 C 中无效——您只能用常量定义数组的长度。（比如你的

```
char name[] = "Nick"; 
```

例如，它不是可变长度的）。

因此，如果要基于程序变量创建长度数组，则有必要使用像 calloc() 这样的内存分配器。

只是不要忘记 free() 它。

# java - 免费 / 开源 Java 规则 / 工作流引擎

> ID：448846
> 
> 赞同：3
> 
> 时间：2009-01-15T23:01:27.190
> 
> 标签：java, workflow, rules

我正在寻找 Java 规则/工作流引擎。类似于 Microsoft 工作流引擎的东西。

有人可以推荐产品吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T23:08:36.177

[这](http://java-source.net/open-source/rule-engines)是许多开源 Java 规则引擎的简要说明，包括[Drools](http://drools.org/)等常见的嫌疑人。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T23:08:02.030

*   [jBPM](http://www.jboss.com/products/jbpm)：主要针对业务流程；
*   [OSWorkflow](http://www.opensymphony.com/osworkflow/documentation.action)：相当低级；和
*   [Spring Webflow](http://www.springsource.org/webflow)：不是通用的工作流引擎，但如果您需要实现基于流的 Web 应用程序，它是一个值得关注的产品。

世界自然基金会没有什么好说的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-05-01T09:02:44.153

CloudSlang：[http](http://www.cloudslang.io/) ://www.cloudslang.io/ 代码库可以在这里找到：[https ://github.com/CloudSlang](https://github.com/CloudSlang)

# c# - DataGridView：我需要哪个事件？

> ID：448849
> 
> 赞同：0
> 
> 时间：2009-01-15T23:02:09.437
> 
> 标签：c#, winforms, datagridview

我已将 DGV 正确绑定到数据和所有其他控件。我现在要做的是根据数据行的内容更新一个 PictureBox 。图片不是绑定数据的一部分，它始终在网络上可用。我有一个函数可以将 url 字符串构建到带有我需要的图像的网络服务器。

问题是我可以找出正确的事件。鼠标点击工作完美，但不允许键盘选择（即绑定字段更新，但图片框没有）。RowEnter/RowLeave 都给我留下了之前选择的行中的图片，而不是当前行。

任何见解将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-01-15T23:13:05.983

另一个疯狂的猜测：SelectionChanged

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-15T23:17:37.313

编辑：意识到你希望它在你选择一行时发生..

```
MyGrid.RowEnter += new DataGridViewCellEventHandler(MyGrid_RowEnter );

void MyGrid_RowEnter(object sender, DataGridViewCellEventHandlere)
{
    if (0 > e.RowIndex) return;

    //TODO: Do whatever with your image here..
} 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-01-15T23:05:14.920

疯狂猜测：OnRowDataBound

如果您想访问绑定到网格的行（及其列），请使用上面的事件。

您的问题是您的问题是您**确实**知道该事件，还是您的意思是您**不**知道该事件？

编辑：如果您希望此行为发生客户端（即选择一行时，没有后备），则某些JavaScript如整个行上的onclick Event Handler，（TR）或将复选框放在第一列中并使用Onlick为了那个原因。

否则，如果您希望每次选择行时都进行回发，那么您可以使用诸如 OnSelectedIndexChanged 之类的事件或 DGV 附带的内置命令。

# parsing - 我怎样才能最好地解析这个逗号分隔的文本文件？

> ID：448865
> 
> 赞同：1
> 
> 时间：2009-01-15T23:05:51.223
> 
> 标签：parsing, csv

我试图找出解析这个逗号分隔文本文件的最佳方法。这是一段摘录：

```
bldgA, fred, lunch
bldgA, sally, supper
bldgB, bob, parking lot
bldgB, frank, rooftop
... 
```

我想做的是阅读“bldgA”，然后我想要这个人（第二列），例如“fred”。但我不想解析寻找“fred”的文件，因为下一次 fred 可能不存在，而 bldgA 总是存在。我想阅读文本文件，看到我在 bldgA 上，然后阅读我列表中的下一项，即 fred。之后我想测试它是否是 fred、sally 等并打印出第三列。我知道使用数据库可能会更容易，但对于一个小文本文件来说似乎有点开销，所以我可以命名列。在我使用 Access 或其他小工具之前，我想我会尝试 Stack Overflow。这是我所拥有的：

```
string BuildingFile = Server.MapPath("buildings.txt");
StreamReader FileStreamReader;

FileStreamReader = File.OpenText(BuildingFile);

while (FileStreamReader.Peek() != -1)
{   
    string[] words;
    words = FileStreamReader.ReadLine().Split(',');

    foreach (string word in words)
    {
        if (word == "bldgA")
        {
            //but since word is only on "bldgA" 
            //how can I get the next item in the list which 
            //is on the same line?

            //print out the name of the person and then the duty
        }
        if (word == "bldgB")
        {
            //same as A   
        }
    }

}
FileStreamReader.Close(); 
```

我的最终输出是

“你在 bldgA，你的名字是 fred，你的职责是午餐”

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-15T23:15:35.337

如果您知道文件的格式总是正确的，您可以执行以下操作（使用您的代码，假设语言是 C#）：

```
String MyLocation = System.Net.Dns.GetHostName();

string MachineFile = Server.MapPath("buildings.txt");
StreamReader FileStreamReader;

FileStreamReader = File.OpenText(MachineFile);

while (FileStreamReader.Peek() != -1)
{   
    string[] words;
    words = FileStreamReader.ReadLine().Split(',');

    if(words.Length == 3)
    {
        StringBuilder output = new StringBUilder;
        output.Append("You are in ");
        output.Append(words[0]);
        output.Append(" and your name is ");
        output.Append(words[1]);
        output.Append(" and your duty is ");
        output.AppendLine(words[2]);
    }
}
FileStreamReader.Close(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T23:29:16.603

使用[FileHelpers](http://filehelpers.sourceforge.net/)库。它允许您创建类来存储数据，并提供一种简单的方法来解析数据存储（包括 csv）以填充这些类。

但是，正如您所建议的，这似乎是数据库的工作。我会考虑[SQLite](http://www.sqlite.org/)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T23:22:07.290

而不是使用 foreach 循环，你为什么不做这样的事情：

```
words = FileStreamReader.ReadLine().Split(',', 3);
StringBuilder output = new StringBuilder();
if (words.Length >= 1)
{
    output.AppendFormat("You are in {0}", words[0]);
    if (words.Length >= 2)
    {
        output.AppendFormat(" and your name is {0}", words[1]);
        if (words.Length >= 3)
        {
            output.AppendFormat(" and your duty is {0}", words[2]);
        }
    }
}
Console.WriteLine(output.ToString()); // or write wherever else you want your output to go 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-15T23:36:04.453

对象数据库更适合您的解决方案。您可以使用[db4o](http://www.db4o.com/s/dotnetdb.aspx)，非常好的开源之一。

但是如果你坚持使用逗号分隔文件，看看这个[CsvReader](http://www.codeproject.com/KB/database/CsvReader.aspx)，你可以用它来读取文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-15T23:10:10.480

基本上使用状态机。有一个名为“building”的变量，并在遇到一个时将建筑物名称存储在其中。然后有在该建筑物上运行的人名的案例。

你的解释不是很清楚，你的例子很奇怪。如果您可以改写，我很可能会提供更好的答案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-01-16T00:45:42.240

我认为您的摘录是这样的：

> BldgA，弗雷德，午餐
> BldgA，莎莉，晚餐
> BldgB，鲍勃，停车场
> BldgB，弗兰克，屋顶

获得所需输出的步骤：

*   读一行
*   沿逗号分割线
*   使用从 split 函数返回的部分格式化您想要的输出

`split`函数通常是正则表达式库的一部分。

在 Common Lisp 中，可以这样写：

```
(defun show-people-status (filename)
  (with-open-file (input-stream filename)
    (do ((line (read-line input-stream nil nil)
               (read-line input-stream nil nil)))
        ((null line) t)
      (apply #'format t "You are in ~a, your name is ~a, and your duty is ~a.~%"
             (cl-ppcre:split "," line))))) 
```

在 Perl 中，你可以使用这样的东西：

```
#!/usr/bin/perl -w
use strict;

use Tie::File;

tie (@data, 'Tie::File', $ARGV[0]);

foreach (@data) {
    (my $Building, my $Name, my $Duty) = split (/,/);
    print "You are in $Building, your name is $Name, and your duty is $Duty."; }; 
```

请注意，Perl 版本旨在作为独立脚本，而 CL 版本显示要从运行时使用的函数。也没有输入检查。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-01-16T01:58:20.050

在伪代码中：

```
#!/usr/bin/env python
import csv

with open('buildings.txt') as csvfile:
    for building, name, duty in csv.reader(csvfile):
        print("You are in %(building)s"
              " and your name is %(name)s"
              " and your duty is %(duty)s" % vars()) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-01-30T02:38:22.353

请原谅我以这种方式编程，但我认为它可能会解决您的问题。

我所做的唯一假设是在buildings.txt 的某个地方有一个名为“bldgA”的列，并且它的右侧总是还有2 列，这些是您想要的数据。

```
private static int GetIndexOf(string hay, string needle, char delimiter)
{
    return Array.FindIndex<string>(hay.Split(delimiter), delegate(string match)
    {
        if (needle.Equals(match.Trim()))
            return true;
        else
            return false;
    });
}

static void Main(string[] args)
{
    StreamReader sr = new StreamReader(Server.MapPath("buildings.txt"));
    using (sr)
    {
        for (string line; null != (line = sr.ReadLine()) && -1 != GetIndexOf(line, "bldgA", ','); )
        {
            Console.WriteLine("You are in bldgA and your name is {0} and your duty is {1}",
                line.Split(',')[GetIndexOf(line, "bldgA", ',') + 1].Trim(),
                line.Split(',')[GetIndexOf(line, "bldgA", ',') + 2].Trim());
        }
    }
} 
```

# linq-to-sql - 在将 Linq 重新创建为 SQL dbml 之后（或者可能在迁移到 .NET 3.5 SP1 之后创建匿名类型时出现奇怪的异常

> ID：448868
> 
> 赞同：2
> 
> 时间：2009-01-15T23:06:03.080
> 
> 标签：linq-to-sql, .net-3.5

我们将 .dbml 文件移出网站并移至另一个程序集，以便可以在多个应用程序之间共享它。问题是现在我遇到了一个没有任何意义的错误。

基本查询是这样的：

```
from D in Devices
select new
{
    EquipmentTypeID = D.DMXDeviceModel.DMXDeviceClass.DMXEquipmentType.ID,
    //... more fields
} 
```

有几个字段是这样查询的，现在它们都抛出以下异常： null 值不能分配给 System.Int32 类型的成员，这是一个不可为空的值类型。

有问题的 ID 字段在数据库或 Linq 实体类中不可为空。一切都正确匹配，因此那里的任何地方都不应该有空值。在将 .dbml 文件“移动”到另一个程序集之前，该代码也可以完美运行。

实际上，我们并没有移动它，因为我们尝试时还有其他一些错误和问题。我在新程序集中重新创建了它，但这无关紧要，因为它是从同一个数据库生成的。

我还尝试选择 D.DMXDeviceModel.DMXDeviceClass.DMXEquipmentType.ID 为空的任何内容，并且没有返回任何结果。

编辑：根据请求，这里是 dbml 文件的 xml。或至少相关部分：

```
<Table Name="dbo.DMXDevice" Member="DMXDevices">
  <Type Name="DMXDevice">
    <Column Name="ID" Type="System.Int32" DbType="Int NOT NULL IDENTITY" IsPrimaryKey="true" IsDbGenerated="true" CanBeNull="false" />
    <Column Name="DeviceModelID" Type="System.Int32" DbType="Int" CanBeNull="true" />    
    <Association Name="DMXDeviceModel_DMXDevice" Member="DMXDeviceModel" ThisKey="DeviceModelID" OtherKey="ID" Type="DMXDeviceModel" IsForeignKey="true" />    
  </Type>
</Table>

  <Table Name="dbo.DMXDeviceModel" Member="DMXDeviceModels">
    <Type Name="DMXDeviceModel">
      <Column Name="ID" Type="System.Int32" DbType="Int NOT NULL IDENTITY" IsPrimaryKey="true" IsDbGenerated="true" CanBeNull="false" />
      <Column Name="DeviceClassID" Type="System.Int32" DbType="Int NOT NULL" CanBeNull="false" />
      <Column Name="Model" Type="System.String" DbType="NVarChar(255) NOT NULL" CanBeNull="false" />      
    </Type>
  </Table> 
```

事实证明，当 DeviceModelID 为空时，通过 DMXDeviceModel 引用的任何内容都会引发此异常。创建匿名类型来处理空 DeviceModelID 似乎是一个问题……但为什么以前没有发生呢？

编辑编辑：你知道，我也搬到了 .NET 3.5 SP1，这改变了网站上的一些其他行为。也许这才是真正的罪魁祸首。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T17:06:25.763

答案是将表达式转换为可空类型，这让匿名类型知道期望它。我怀疑这是 SP1 的变化。

```
EquipmentTypeID = ((int?)D.DMXDeviceModel.DMXDeviceClass.DMXEquipmentType.ID), 
```

# audio - 网络（非？）流媒体音频解决方案？

> ID：448871
> 
> 赞同：4
> 
> 时间：2009-01-15T23:07:38.567
> 
> 标签：audio, web

我想在我的网站中嵌入多个音频。我希望文件加载但在用户点击按钮之前不播放。我还希望能够像 youtube 那样跳转到尚未加载的地方。如果我可以播放 ogg、aac、mp4 等，那就太好了，但我不认为这是可能的，所以我不介意用 ffmpeg（或其他任何东西）转换另一个版本

我可以用什么来让这个 youtube 像音频播放器一样？

-edit- 抱歉，伙计们，我不在，没有及时选择最佳答案。我找到[网络（非？）流媒体音频解决方案？](https://stackoverflow.com/questions/448871/web-nonstreaming-audio-solutions/550427#550427)紧随[网络（非？）流媒体音频解决方案的 sorin 是最好的吗？](https://stackoverflow.com/questions/448871/web-nonstreaming-audio-solutions/562958#562958)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-15T23:13:14.407

我不明白你为什么不想要流媒体？因为这正是我在这里推荐的。请注意，流媒体并不一定意味着大型、丑陋的嵌入式播放器，例如 Windows Media、QuickTime 或 Real Player。

我建议使用 MP3 音频和 Flash，使用免费的[JW FLV 媒体播放器](http://www.longtailvideo.com/players/jw-flv-player/)，它应该可以做任何你想做的事情，除了“低/高质量”的东西，但如果你需要的话，也许你可以只使用两个播放器。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-15T06:42:47.240

我会通过一个小的修改来支持迈克尔的建议：

您可以使用开源 Flash 播放器（如[XSPF Flash 播放器](http://musicplayer.sourceforge.net/)）并对其进行破解，使其甚至在您开始播放之前就开始加载声音。这样，您可以在一段时间后在客户端拥有所有声音（这取决于客户端和服务器之间的连接）。

您可能还想看看[Soundmanager v2](http://www.schillmania.com/projects/soundmanager2/)，它提供了与 Javascript 的紧密集成，而无需额外的 hack。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-17T22:45:55.287

你见过[懦弱的球员](http://www.wimpyplayer.com)吗？他们有各种产品，从简单的音频按钮到带有播放列表的视频播放器。

我不确定是否要跳到文件的不同部分，但他们说它可以使用 Ajax 进行编程，而且我知道你可以设置它是否自动开始播放。

我用了一段时间，但后来改用简单的“播放/暂停”按钮。

（顺便说一句，我不明白你对非流媒体播放器的兴趣。如果用户必须先下载文件，你为什么需要提供一个界面？他们不会用他们使用的任何程序打开它吗？在他们的电脑上？）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T21:41:55.307

1.  如果你想在浏览器中使用它，我建议你选择基于 Flash 的东西（它对最终用户来说更直接，基于更好的 API 并且比你想依靠的任何媒体播放器具有更好的渗透性）。
2.  在 Flash 中，您可以通过两种协议加载音频/视频：HTTP 或 RTMP。
3.  RTMP 是一种时尚的音频/视频协议，并且对文档内的“搜索”具有严格的支持。它在 Flash Media Server 中实现，但也在开源[Red5](http://osflash.org/red5)中实现。但是，这意味着您将需要运行此服务器或购买 RTMP 服务。
4.  HTTP 支持检索文件的一部分（通过指定 Range 标头），但协议本身与格式无关，因此如果它是可变比特率，您可能会遇到一些问题。因此，从技术上讲，您应该能够在文件中跳转到未加载的部分，尽管 Flash 可能不允许这样做......让我们说*专有*原因。
5.  即使使用 Flash，mp4、ogg、aac 也会出现问题。最好的办法是在上传时将它们转换为通用格式 - 我认为 Flash 仅支持版本 9 之前的 mp3 和从 Flash Player 9 开始的 AAC。ffmpeg 和 mplayer 可以处理/转换为多种格式。
6.  很抱歉，这里没有灵丹妙药。如果你想要一些灵活的东西，你将不得不牺牲一些开发时间并构建一些灵活的东西（不仅是网络播放器，还有一些幕后的魔法）。

# boo - 如何在 Boo 中添加语言关键字以让“何时”表现为“如果”

> ID：448878
> 
> 赞同：3
> 
> 时间：2009-01-15T23:09:23.040
> 
> 标签：boo

我似乎无法弄清楚如何将'when'关键字添加到应该表现为'if'的[BOO 。](http://boo.codehaus.org/)我想我可以制定一个方法，但是我不能像使用 if 那样移动 when 。任何指针将不胜感激。

-标记

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-01-19T08:40:24.653

这会做你想要的：

```
import Boo.Lang.Compiler.Ast
import Boo.Lang.Compiler.MetaProgramming

macro when:
    return [|
        if $(when.Arguments[0]):
            $(when.Block)
    |]

x = 1
when x == 1:
    print "x equals one"
when x == 2:
    print "x equals two" 
```

顺便说一句，请随时（也）在 Boo 邮件列表上询问以更快地获得（更多）答案；）

[http://groups.google.com/group/boolang/](http://groups.google.com/group/boolang/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T01:53:14.397

This would be a job for a macro. From the page you linked to, it seems that Boo has syntactic macros.

As an aside note, why do you need an exact duplicate of an existing functionality?

# .net - 使用 JSONP 与 .net 对话的 JQuery 有哪些好的示例？

> ID：448879
> 
> 赞同：11
> 
> 时间：2009-01-15T23:09:43.837
> 
> 标签：.net, jquery, jsonp

正如问题所说，Jquery 使用 JSONP 与 .net 页面或 Web 服务对话有哪些好的示例（或者只是示例）？

我正在尝试编写一个页面，该页面使用 JQuery 调用另一个网站（因此我需要使用 JSONP）来托管 web 服务/网页（两者都可以），但我找不到一个很好的例子。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-16T00:12:28.017

JSONP 只是包装在 js 方法中的 json。jQuery 提供方法名称作为查询字符串上的回调参数，然后 jsonp 端点必须采用该参数并将 json 包装在其中，然后将响应发回。服务器端语言确实无关紧要。

[带有 WCF 的 JSONP](http://msdn.microsoft.com/en-us/library/cc716898.aspx)

[不错的截屏](http://www.vimeo.com/1535196)

&下面的几篇文章

[Rick Strahl 有一篇关于它的博文](http://www.west-wind.com/Weblog/posts/107136.aspx)
[另一个](http://weblogs.asp.net/rashid/archive/2007/09/28/implement-jsonp-in-your-asp-net-application.aspx)

# redirect - 运行 CGI 应用程序而不从 HTML 重定向

> ID：448885
> 
> 赞同：1
> 
> 时间：2009-01-15T23:11:33.270
> 
> 标签：redirect, cgi, refresh

我有一个从 cgi 应用程序填充的 html 页面。现在，当我通过表单对我的 html 页面进行更改时

```
<form action="/cgi-bin/Lib.exe" method=POST name="checks" ID="Form2"> 
```

它把我从
[http://localhost/index.html](http://localhost/index.html)
带到
[http://localhost/cgi-bin/Lib.exe，CGI](http://localhost/cgi-bin/Lib.exe) 输出一些我放在那里的调试行。然后我必须手动返回索引以查看它的更新。

当 html 表单向 cgi 应用程序发送请求时，CGi 应用程序对数据库进行更新并重写索引 html。我如何留在索引页面上并查看它的更新？（我正在运行轻量级 GoAhead Web 服务器、C 中的 CGI 和 html、JS）

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-15T23:24:37.830

您可以从 CGI 脚本发送 302 状态代码，它将用户的浏览器重定向到`/index.html`.

基本上，让 CGI 脚本吐出这个：

```
HTTP/1.1 302 Found
Location: /index.html 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T23:14:50.737

您基本上是在问“我如何使用 AJAX”。我建议使用图书馆。在 JQuery 中，它看起来像：

```
$.ajax({
   type: "POST",
   url:  "/cgi-bin/Lib.exe",
   data: "foo=bar&spoo=fleem",
   success: function(html){
      $("#results").append(html);
   }
}); 
```

# c# - 将 Linq 用于 ObjectDataSource：如何使用 ToShortTimeString 转换日期时间？

> ID：448890
> 
> 赞同：2
> 
> 时间：2009-01-15T23:13:10.520
> 
> 标签：c#, linq, objectdatasource

我正在使用 ObjectDataSource 访问业务类并尝试生成对用户有意义的输出。返回值描述一个类（如在课堂和教学中，而不是软件中）。我想将上课时间显示为这样的范围：“9:00 AM - 10:00 AM”。

这是我用来提取数据的 Linq 查询：

```
return classQuery.Select(p => new SelectClassData
                              {
                                   ClassID = p.ClassID,
                                   Title = p.Title,
                                   StartDate = p.StartDate.ToShortDateString(),
                                   EndDate = p.EndDate.ToShortDateString(),
                                   TimeOfClass =
                                   p.StartDate.ToShortTimeString() + " - " +
                                                       p.EndDate.ToShortTimeString()
                               }).ToList(); 
```

如您所见，我在开始日期和结束日期中对开始和结束时间进行编码，即使它们可能在不同的日期。

当我执行此代码时，我得到：

*“无法将表达式 'p.EndDate.ToShortTimeString()' 转换为 SQL，并且无法将其视为本地表达式。”*

我知道我正在投影结果，但是作为 Linq 的新手，我假设 C# 调用 ToShortTimeString 发生在投影之后。谁能帮我弄清楚如何获得我正在寻找的字符串？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-01-15T23:24:02.590

原因是查询正在 LINQ to SQL 中使用。LINQ to SQL 将查询视为表达式树。它为某些方法（例如`Contains`）定义了映射，但由于它并没有真正执行它们，因此它不能在任意方法上工作。它解析查询并将其提交给 SQL 服务器。查询的等价物将作为 SQL 语句在数据库服务器上执行，并返回结果。问题是`ToShortTimeString()`在 LINQ to SQL 中没有等效的 SQL 转换。这里使用的技巧是从 SQL 服务器获取数据并在客户端调用方法（`AsEnumerable`将执行此操作）。

```
return classQuery.Select(p => new { p.ClassID, p.Title, p.StartDate, p.EndDate })
   .AsEnumerable()
   .Select(p => new SelectClassData { 
       ClassID = p.ClassID, 
       Title = p.Title, 
       StartDate = p.StartDate.ToShortDateString(), 
       EndDate = p.EndDate.ToShortDateString(), 
       TimeOfClass = p.StartDate.ToShortTimeString() + " - " + p.EndDate.ToShortTimeString() })
   .ToList(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T00:00:30.987

我非常喜欢 Mehrdad 的回答。它不仅解决了问题，还教会了我一些关于 Linq 的知识。谢谢！

不过，我一直在努力解决这个问题，并且确实提出了一种不同的方法，我将在这里描述，以防其他人在这个问题上绊倒想要考虑。我的 Linq to SQL 代码现在显示为：

```
return classQuery.Select(p => new SelectClassData
                              {
                                   ClassID = p.ClassID,
                                   Title = p.Title,
                                   sDate = p.StartDate,
                                   eDate = p.EndDate
                              }).ToList(); 
```

请注意，sDate 和 eDate 现在是 DateTime 对象而不是字符串。在“SelectClassData”对象中，我只是更改了声明，以便通过属性获取器访问 StartDate、EndDate 和 TimeOfClass 变量：

```
public class SelectClassData
{
    public int ClassID { get; set; }
    public string Title { get; set; }
    public DateTime sDate { get; set; }
    public DateTime eDate { get; set; }
    public string StartDate { get { return GetSDate(); } }
    public string EndDate { get { return GetEDate(); } }
    public string TimeOfClass { get { return GetTimeOfClass(); } }

    protected string GetSDate()
    {
        return sDate.ToShortDateString();
    }

    protected string GetEDate()
    {
        return eDate.ToShortDateString();
    }

    protected string GetTimeOfClass()
    {
        return sDate.ToShortTimeString() + " - " + eDate.ToShortTimeString();
    }
} 
```

也就是说，我通过 LinqToSql 设置了 sDate 和 eDate，但是在 Linq 检索*之后通过在目标数据类中实现它来执行“ToShortTimeString”和“ToShortDateString”转换。*

# search - 有哪些好的 API 或搜索方法可以将对象标记为类别并进行搜索？

> ID：448895
> 
> 赞同：1
> 
> 时间：2009-01-15T23:14:41.970
> 
> 标签：search, web, tagging

我想标记许多用户创建的内容并具有多种类型的类别（项目标签、desc 标签、样式/灵感标签等）。我看到可怕的搜索引擎，你使用的词越多，结果就越差，我不希望使用标记。

有哪些好的 API 或搜索方法可以将对象标记为类别并进行搜索？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-01-16T02:32:53.083

您可能想检查这些问题：

*   [您如何建议实施标签或标记](https://stackoverflow.com/questions/20856/how-do-you-recommend-implementing-tags-or-tagging)
*   [在数据库中存储标签的最有效方法是什么？](https://stackoverflow.com/questions/334183/what-is-the-most-efficient-way-to-store-tags-in-a-database)

它们都描述了相同的方法，应该可以轻松调整以允许您将标签组织到不同的类别中。

# web-frameworks - 选择一个简单的 Web 应用程序框架

> ID：448909
> 
> 赞同：9
> 
> 时间：2009-01-15T23:18:53.600
> 
> 标签：web-frameworks

我正在为我开始的一个爱好项目评估 Web 应用程序框架，并且开始疯狂地尝试在大量可供选择的框架中做出决定。框架语言并不能帮助我过滤掉框架，因为我在 Java、Python、Ruby 和 C# 方面的经验各不相同，并且不介意这些语言中的任何框架。

我正在寻求帮助，将选择范围缩小到几个，然后我可以更详细地调查。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T00:01:23.357

您可能想退后一步，真正考虑一下您最喜欢使用哪种语言进行编码，无论您在每种语言中的专业水平如何。这肯定会缩小你的选择范围。我认为如果不先选择语言就很难选择框架。例如，如果您最终在 ASP.NET MVC 中完成您的项目，并且发现自己一开始就不太喜欢 C#/.NET，该怎么办。

还要问自己为什么需要一个框架，或者一个框架如何帮助你完成你的爱好项目。（除非爱好项目只是为了学习一个框架。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-01-16T11:47:59.260

我的建议只是选择一个。

我正在使用 Rails，对整体的简单性和性能感到非常满意——无论是代码还是作为程序员的我。

最近我开始研究 Smalltalk 网络框架[Aida/Web](http://www.aidaweb.si)。它有自己的优点和缺点，但开发速度更快（无需重新启动，可以编辑正在运行的代码），在 RAM 上比在 Rails 上要容易得多，并且在 95% 的时间里你不需要数据库，只需使用图像来持久化。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-01-15T23:24:26.647

当然，通常的嫌疑人是 django 和 rails。从任何定义来看，它们都不是“小”。

我推荐[webpy](http://webpy.org)，它简单、小巧且不碍事。我认为 reddit 在它上面运行了一段时间，因为它是 Aaron Swartz 的智囊。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-01-15T23:35:47.573

rails 是一个不错的选择 - 它对于简单的事情很简单，同时允许更复杂的事情成为可能（总是一个好兆头）。最初有一点学习曲线，但所有框架都是如此。

如果你更喜欢 Java，你也可以看看 Groovy + Grails，这是一个非常相似的框架，带有 Java 的倾向（groovy 有点像 java 和 ruby​​ 的交叉，你可以混合和匹配 Java 和 Groovy 类同一个项目）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-01-15T23:23:45.087

很大程度上取决于您希望自己的爱好项目是什么。

我会说选择一个 Ruby 或 Python 的。

（我的大部分工作都是使用 java 完成的，但不认为这最适合业余爱好项目）

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-01-15T23:29:59.660

我在[http://www.asp.net/mvc/](http://www.asp.net/mvc/)做我的个人项目。我第一次这样做时，我只是通过对代码大惊小怪来打出一个工作站点。现在我正在重写它以尝试“更好地编码”并学习新的设计原则。

我也在工作中使用过codeigniter，虽然我喜欢它，但它是php，你没有提到它是一种语言选择。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-15T23:51:04.487

如果这只是个人爱好，我建议使用 .Net MVC、Rails 或 Zend（可能有一些不错的 Java 框架，但我不熟悉它们）。

我猜，既然这是一个爱好项目，你不会想花很多时间在网上寻找有关如何使用框架做事的示例或寻找有关如何设置它的教程。您可能希望能够立即使用一堆很酷的功能，而不会破坏或处理一堆错误。话虽如此，我认为 .Net MVC 和/或 Rails 将让您以最少的头痛获得最大的乐趣。有了许多其他开源框架，您将不得不从一开始就跳过很多您不想处理的圈子，并且需要大量时间文档来完成初始设置问题很难找到。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2012-11-28T12:26:54.667

爪哇：春天

Spring 是最流行的企业 Java 应用程序开发框架

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-01-15T23:21:56.150

试试[AIDA/Web](http://www.aidaweb.si)，一个 Smalltalk Web 框架，它以简单着称，更不用说 Smalltalk 的优雅了！

为了简单起见，不需要像 MySql 这样的附加数据库，因为 Smalltalk 图像本身就是一个功能强大的对象数据库。稍后当您的需求出现时，您可以决定采用关系型，甚至更好，保持纯 OO 并选择 Gemstone/S 对象数据库。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-01-15T23:28:42.393

我猜想在[LAMP 堆栈](http://en.wikipedia.org/wiki/LAMP_(software_bundle))上运行的东西是最容易设置的。[在这种情况下，我想CodeIgniter](http://codeigniter.com)和[Zend Framework](http://framework.zend.com/)会有一些不错的选择。然后是[Symphony](http://www.symfony-project.org/)和[CakePHP](http://cakephp.org/)，但我听到了对后者的混合评论（关于停滞不前的社区和/或棘手的配置）。

不幸的是，我没有时间彻底测试这四个中的任何一个，因为我一直忙于编写自己的框架，我不会无耻地（或以其他方式）插入。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-01-15T23:38:58.440

[Squatting](http://search.cpan.org/dist/Squatting/)是一个基于 perl 的小型 Web 框架，其灵感来自 Ruby 的[Camping](http://camping.rubyforge.org)。他们俩都很小。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-01-16T00:09:09.817

让我在这里提出一些真正超出该区域的建议：从裸机 C/C++ 甚至 Delphi 构建一个 ISAPI dll（或 Apache 等价物，如果这是您的偏好）。为什么？如果您有时间这样做，您将学到大量关于 Web 应用程序底层架构的知识，并且将为大家在这里推荐的所有框架打开一个全新的视角。

早在 2000 年，我就在 Delphi 做过这个，这是一次非常棒的学习经历。当然，这是基于您不需要快速构建任何东西并且该项目的主要目的是了解 Web 开发的概念。但是，如果这是您的目标，您将很难找到更好的方法。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-01-16T00:15:18.307

ASP.NET / ASP.NET MVC

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-01-16T12:45:36.867

在 Ruby 世界中，你有大玩家（[Rails](http://rubyonrails.org/)），但也有更轻量级的，比如[Merb](http://merbivor.org/)、[Sinatra](http://sinatra.rubyforge.org/)、[Camping](http://camping.rubyforge.org/files/README.html)和其他一些。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-01-16T01:22:30.463

如果您正在使用 Java 并且迫切需要一些东西来让您摆脱 ohfock-it's-2am-and-I-am-still-coding-this-sql-shite，那么请看 Grails [http://grails。组织](http://grails.org).

它和 Ruby on Rails 一样，除了它：

1.  应该比 Rails 更酷
2.  更好的性能
3.  丰富的 Java 库
4.  你会得到一些和平的 Rails 迪斯科噪音并完成工作。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-01-16T12:21:34.140

一些想法：

*   Java：[检票口](http://wicket.apache.org/)
*   Groovy：[圣杯](http://grails.org/)
*   红宝石：[导轨](http://rubyonrails.org/)

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2009-01-16T00:39:34.607

我建议 PHP 作为许多小型爱好 Web 应用程序的良好启动框架：

*   简单易学
*   它有据可查且成熟
*   保存更改并在浏览器中查看几乎不需要任何时间
*   有很多便宜的托管选项
*   您的开发环境是免费的，并且可以快速设置

# makefile - GNU Makefile 变量赋值 =、?=、:= 和 += 有什么区别？

> ID：448910
> 
> 赞同：891
> 
> 时间：2009-01-15T23:19:02.147
> 
> 标签：makefile, gnu-make

任何人都可以清楚地解释变量赋值在 Makefile 中是如何工作的。

和有什么区别：

```
 VARIABLE = value
 VARIABLE ?= value
 VARIABLE := value
 VARIABLE += value 
```

我已经阅读了GNU Make 手册中的[部分](http://www.gnu.org/software/make/manual/make.html#Reading-Makefiles)，但对我来说仍然没有意义。

* * *

## 回答 #1

> 赞同：1165
> 
> 时间：2009-01-15T23:25:35.207

### 懒人集

```
VARIABLE = value 
```

一个变量的正常设置，但在该`value`字段中提到的任何其他变量都在使用该变量时使用它们的值递归扩展，而不是它在声明时的值

### 立即设置

```
VARIABLE := value 
```

通过内部值的简单扩展来设置变量 - 其中的值在声明时扩展。

### 不存在时的惰性设置

```
VARIABLE ?= value 
```

仅当变量没有值时才设置变量。`value`总是在`VARIABLE`被访问时评估。它相当于

```
ifeq ($(origin VARIABLE), undefined)
  VARIABLE = value
endif 
```

有关更多详细信息，请参阅[文档](https://www.gnu.org/software/make/manual/html_node/Flavors.html#Flavors)。

### 附加

```
VARIABLE += value 
```

将提供的值附加到现有值（如果变量不存在，则设置为该值）

* * *

## 回答 #2

> 赞同：307
> 
> 时间：2009-01-15T23:34:46.093

使用**`=`**导致变量被赋值。如果变量已经有值，则将其替换。该值在使用时会被扩展。例如：

```
HELLO = world
HELLO_WORLD = $(HELLO) world!

# This echoes "world world!"
echo $(HELLO_WORLD)

HELLO = hello

# This echoes "hello world!"
echo $(HELLO_WORLD) 
```

使用**`:=`**类似于使用`=`。但是，不是在使用时扩展值，而是在赋值期间扩展它。例如：

```
HELLO = world
HELLO_WORLD := $(HELLO) world!

# This echoes "world world!"
echo $(HELLO_WORLD)

HELLO = hello

# Still echoes "world world!"
echo $(HELLO_WORLD)

HELLO_WORLD := $(HELLO) world!

# This echoes "hello world!"
echo $(HELLO_WORLD) 
```

*如果之前未分配*变量，则使用**`?=`**为变量分配一个值。如果变量之前被分配了一个空白值 ( )，*我认为*它仍然被认为是 set 。否则，功能与.*`VAR=`*`=`**

 **using**`+=`**类似于 using `=`，但不是替换值，而是将值附加到当前值，中间有一个空格。如果该变量以前是用 设置的，*我认为*`:=`它会被扩展。结果值在使用时会扩展*我认为*。例如：

 **```
HELLO_WORLD = hello
HELLO_WORLD += world!

# This echoes "hello world!"
echo $(HELLO_WORLD) 
```

如果`HELLO_WORLD = $(HELLO_WORLD) world!`使用了类似的东西，就会产生递归，这很可能会结束你的 Makefile 的执行。如果`A := $(A) $(B)`使用了，结果将与使用不完全相同，`+=`因为用而`B`展开，`:=`而`+=`不会导致`B`展开。

* * *

## 回答 #3

> 赞同：76
> 
> 时间：2012-12-23T14:43:59.037

我建议你用“make”做一些实验。`=`这是一个简单的演示，显示和之间的区别`:=`。

```
/* Filename: Makefile*/
x := foo
y := $(x) bar
x := later

a = foo
b = $(a) bar
a = later

test:
    @echo x - $(x)
    @echo y - $(y)
    @echo a - $(a)
    @echo b - $(b) 
```

`make test`印刷：

```
x - later
y - foo bar
a - later
b - later bar 
```

[在此处查看更详细的说明](https://web.archive.org/web/20151113045702/http://sunsite.ualberta.ca/Documentation/Gnu/make-3.79/html_chapter/make_6.html)

* * *

## 回答 #4

> 赞同：34
> 
> 时间：2009-01-15T23:26:15.410

使用时`VARIABLE = value`，如果`value`实际上是对另一个变量的引用，那么只有在使用时才确定值`VARIABLE`。最好用一个例子来说明这一点：

```
VAL = foo
VARIABLE = $(VAL)
VAL = bar

# VARIABLE and VAL will both evaluate to "bar" 
```

当你使用时`VARIABLE := value`，你会得到`value` *现在*的价值。例如：

```
VAL = foo
VARIABLE := $(VAL)
VAL = bar

# VAL will evaluate to "bar", but VARIABLE will evaluate to "foo" 
```

使用`VARIABLE ?= val`意味着您只设置`VARIABLE` *if* `VARIABLE`的值尚未设置。如果尚未设置，则将值的设置推迟到`VARIABLE`使用时（如示例 1 所示）。

`VARIABLE += value`只是附加`value`到`VARIABLE`. 的实际值`value`是按照最初设置时的值确定的，使用`=`或`:=`。

* * *

## 回答 #5

> 赞同：10
> 
> 时间：2016-12-12T11:40:50.050

在上述答案中，**重要的是要了解**“值在声明/使用时扩展”的含义。给出类似的值`*.c`并不需要任何扩展。只有当命令使用此字符串时，它才会触发一些通配符。类似地，一个类似`$(wildcard *.c)`or的值`$(shell ls *.c)`不需要任何扩展，并且在定义时被完全评估，即使我们`:=`在变量定义中使用。

在您有一些 C 文件的目录中尝试以下 Makefile：

```
VAR1 = *.c
VAR2 := *.c
VAR3 = $(wildcard *.c)
VAR4 := $(wildcard *.c)
VAR5 = $(shell ls *.c)
VAR6 := $(shell ls *.c)

all :
    touch foo.c
    @echo "now VAR1 = \"$(VAR1)\"" ; ls $(VAR1)
    @echo "now VAR2 = \"$(VAR2)\"" ; ls $(VAR2)
    @echo "now VAR3 = \"$(VAR3)\"" ; ls $(VAR3)
    @echo "now VAR4 = \"$(VAR4)\"" ; ls $(VAR4)
    @echo "now VAR5 = \"$(VAR5)\"" ; ls $(VAR5)
    @echo "now VAR6 = \"$(VAR6)\"" ; ls $(VAR6)
    rm -v foo.c 
```

运行`make`将触发创建一个额外（空）C 文件的规则，该文件被调用，`foo.c`但 6 个变量中没有一个具有`foo.c`其值。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2020-07-31T06:49:21.233

最赞成的答案可以改进。

让我参考 GNU Make 手册[“设置变量”](https://www.gnu.org/software/make/manual/html_node/Setting.html#Setting)和[“风味”](https://www.gnu.org/software/make/manual/html_node/Flavors.html#Flavors)，并添加一些注释。

### 递归扩展变量

> 您指定的值是逐字安装的；如果它包含对其他变量的引用，则只要替换此变量（在扩展某些其他字符串的过程中），就会扩展这些引用。发生这种情况时，称为*递归扩展*。

```
foo = $(bar) 
```

**catch** :`foo`将扩展为`$(bar)` **每次** `foo`评估的值，可能导致不同的值。当然，您不能称其为“懒惰”！如果在午夜执行，这可能会让您大吃一惊：

```
# This variable is haunted!
WHEN = $(shell date -I)

something:
    touch $(WHEN).flag

# If this is executed on 00:00:00:000, $(WHEN) will have a different value!
something-else-later: something
    test -f $(WHEN).flag || echo "Boo!" 
```

### 简单扩展变量

```
VARIABLE := value
VARIABLE ::= value 
```

> 用 ':=' 或 '::=' 定义的变量只是扩展变量。

> 简单的扩展变量由使用 ':=' 或 '::=' [...] 的行定义。这两种形式在 GNU make 中是等价的；但是，POSIX 标准 [...] 2012 仅描述了 '::=' 形式。

> 一个简单扩展变量的值被扫描一次，当变量被定义时，扩展对其他变量和函数的任何引用。

没有太多要补充的。它立即被评估，包括递归扩展变量的递归扩展。

**问题**：如果`VARIABLE`指的是`ANOTHER_VARIABLE`：

```
VARIABLE := $(ANOTHER_VARIABLE)-yohoho 
```

并且`ANOTHER_VARIABLE`在此分配之前未定义，`ANOTHER_VARIABLE`将扩展为空值。

### 未设置时分配

```
FOO ?= bar 
```

相当于

```
ifeq ($(origin FOO), undefined)
FOO = bar
endif 
```

仅当根本没有设置变量时才`$(origin FOO)`等于。`undefined`

**catch** : 如果`FOO`在 makefile、shell 环境或命令行覆盖中设置为空字符串，则**不会**分配它`bar`。

### 追加

```
VAR += bar 
```

[附加](https://www.gnu.org/software/make/manual/html_node/Appending.html)：

> 当所讨论的变量以前没有定义过时，'+=' 的作用就像普通的 '='：它定义了一个递归扩展的变量。但是，当有先前的定义时，'+=' 的确切作用取决于您最初定义的变量的风格。

所以，这将打印`foo bar`：

```
VAR = foo
# ... a mile of code
VAR += $(BAR)
BAR = bar
$(info $(VAR)) 
```

但这将打印`foo`：

```
VAR := foo
# ... a mile of code
VAR += $(BAR)
BAR = bar
$(info $(VAR)) 
```

**问题在于，根据之前分配的变量类型，其行为**会**`+=`有所不同。`VAR`**

 **### 多行值

[将多行值分配给变量](https://www.gnu.org/software/make/manual/html_node/Multi_002dLine.html)的语法是：

```
define VAR_NAME :=
line
line
endef 
```

或者

```
define VAR_NAME =
line
line
endef 
```

赋值运算符可以省略，然后它创建一个递归扩展变量。

```
define VAR_NAME
line
line
endef 
```

`endef`删除之前的最后一个换行符。

### 奖励：shell 赋值运算符 '!='</h3>

```
 HASH != printf '\043' 
```

是相同的

```
HASH := $(shell printf '\043') 
```

不要使用它。`$(shell)`call 更具可读性，强烈建议不要在 makefile 中同时使用这两种方法。至少，`$(shell)`遵循 Joel 的建议，[让错误的代码看起来很明显是错误](https://www.joelonsoftware.com/2005/05/11/making-wrong-code-look-wrong/)的。

# arrays - 将PowerShell数组传递给函数时如何扩展它

> ID：448911
> 
> 赞同：8
> 
> 时间：2009-01-15T23:19:03.957
> 
> 标签：arrays, powershell

我有两个 PowerShell 函数，第一个调用第二个。它们都采用 N 个参数，其中一个被定义为简单地添加一个标志并调用另一个。以下是示例定义：

```
function inner
{
  foreach( $arg in $args )
    {
      # do some stuff
    }
}

function outer
{
  inner --flag $args
} 
```

用法看起来像这样：

```
inner foo bar baz 
```

或这个

```
outer wibble wobble wubble 
```

目标是使后一个示例等效于

```
inner --flag wibble wobble wubble 
```

**问题：**正如这里定义的那样，后者实际上导致两个参数被传递给`inner`：第一个是“--flag”，第二个是包含“wibble”、“wobble”和“wubble”的数组。我想要的是`inner`接收四个参数：标志和三个原始参数。

所以我想知道的是如何说服powershell在将$args数组传递给之前扩展它`inner`，将它作为N个元素而不是单个数组传递。我相信你可以在 Ruby 中使用 splatting 运算符（* 字符）来做到这一点，而且我很确定 PowerShell 可以做到，但我不记得是如何做到的。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-01-24T00:21:57.403

PowerSHell V1 中没有很好的解决这个问题的方法。在 V2 中，我们添加了 splatting（尽管出于各种原因，我们为此使用 @ 而不是 *）。这是它的样子：

PS (STA-ISS) (2) > 函数 foo ($x,$y,$z) { "x:$xy:$yz:$z" }

PS (STA-ISS) (3) > $a = 1,2,3

PS (STA-ISS) (4) > foo $a # 作为单个参数传递

x:1 2 3 y:z:

PS (STA-ISS) (5) > foo @a # splatted

x:1 y:2 z:3

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T16:06:37.587

好吧，可能有更好的方法，但看看这是否有效：

```
inner --flag [string]::Join(" ", $args) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-01-16T16:34:18.980

基于@EBGreen 的想法，以及我在侧边栏中注意到的一个相关问题，一个可能的解决方案是：

```
function outer
{
    invoke-expression "inner --flag $($args -join ' ')"
} 
```

*注意：此示例使用 Powershell 2.0 CTP 的新`-join`运算符。*

但是，我仍然想找到一种更好的方法，因为这感觉像是一种黑客攻击并且在安全方面非常糟糕。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-06-01T16:01:25.403

如果您想要一个快速的现成解决方案，您可以复制粘贴我的：

```
<#
    .SYNOPSIS
    Asks a question and waits for user's answer

    .EXAMPLE
    Usage with shortcuts and without ReturnValue
    Invoke-Question -Question "What would you like" -Answers "&Eggs", "&Toasts", "&Steak"

    Shows the quesiton and waits for input. Let's assume user input is 'S', the return value would be 2 (index of "&Steak")

    .EXAMPLE
    Usage without shortcuts and with ReturnValue
    Invoke-Question -Question "What would you like" -Answers "Eggs", "Toasts", "Steak" -ReturnValue

    Shows the quesiton and waits for input. The answers are prefixed with numbers 1, 2 and 3 as shortcuts.
    Let's assume user input is 2, the return value would be "Toasts" (prefixed numbers are "index + 1")

    .EXAMPLE
    Usage from pipeline with default value
    @("Eggs", "Toasts", "Steak") | Invoke-Question -Question "What would you like" -ReturnValue -Default 2

    Shows the quesiton and waits for input. The answers are taken from pipeline and prefixed with numbers 1, 2 and 3 as shortcuts.
    Steak is marked as default. If user simply continues without a choice, Steak is chosen for her.
    However, let's assume user input is 1, the return value would be "Eggs" (prefixed numbers are "index + 1")
#>
function Invoke-Question {
    [CmdletBinding()]
    param(
        # Main question text
        [Parameter(Mandatory = $true)]
        [string] $Question,

        # Question description, e.g. explanation or more information
        [Parameter(Mandatory = $false)]
        [string] $Description = "",

        # Default answer as index in the array, no answer is selected by default (value -1)
        [Parameter(Mandatory = $false)]
        [int] $Default = -1,

        # Set of answers, if the label is given with & sign, the prefixed letter is used as shortcut, e.g. "&Yes" -> Y,
        # otherwise the answer is prefixed with "index + 1" number as a shortcut
        [Parameter(Mandatory = $true, ValueFromPipeline = $true)]
        [string[]] $Answers,

        # If set, returns a value of selected answer, otherwise returns its index in the Answer array
        [switch] $ReturnValue
    )

    begin {
        # init choices
        $choices = New-Object Collections.ObjectModel.Collection[Management.Automation.Host.ChoiceDescription]
        $answerNumber = 1
        $rememberAnswers = @()
    }

    process {
        #init answers
        foreach ($answer in $answers) {
            $rememberAnswers += $answer
            if ($answer -notmatch "&") {
                # add number if shortcut not specified
                $answer = "&$answerNumber $answer"
            }

            $choices.Add((New-Object Management.Automation.Host.ChoiceDescription -ArgumentList $answer))
            $answerNumber++
        }
    }

    end {
        # ask question and return either value or index
        $index = $Host.UI.PromptForChoice($Question, $Description, $choices, $Default)
        if ($ReturnValue) {
            $rememberAnswers[$index]
        } else {
            $index
        }
    }
} 
```

# zend-framework - Zend Framework：有没有办法获取视图模板目录的路径？

> ID：448916
> 
> 赞同：3
> 
> 时间：2009-01-15T23:20:16.233
> 
> 标签：zend-framework, templates, path, view

我只是想找到一种方法来使用 Zend 框架获取我的视图模板目录的路径。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T00:26:39.610

您可以使用 getScriptPaths() 函数，因此从您可以编写的视图中：

```
print_r($this->getScriptPaths()); 
```

# c# - 为什么在 Linux 中使用 Mono 时找不到 System.Text.RegularExpressions？

> ID：448917
> 
> 赞同：6
> 
> 时间：2009-01-15T23:20:17.217
> 
> 标签：c#, ubuntu, mono, monodevelop

我正在尝试使用 Mono 和 Monodevelop（IDE）在 Ubuntu 中编写 C# 项目。

除了找不到 System.Text.RegularExpressions (Package?) 之外，一切都在工作。我在互联网上找到的唯一相关的东西是[这里](https://bugs.launchpad.net/ubuntu/+source/mono/+bug/124857)

似乎发布了各种解决方案，但我不明白。请帮忙 ：）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-01-16T00:25:21.717

在 MonoDevelop 中，右键单击 References 并添加对`System`程序集的引用。

您可以使用`gmcs -r System *.cs`从命令行编译。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-08T14:53:32.220

在 VS2010 中也是如此。如果缺少组装，只需添加对 System 的引用。

# git - 如何删除 GitHub 上的提交？

> ID：448919
> 
> 赞同：1859
> 
> 时间：2009-01-15T23:20:54.127
> 
> 标签：git, github, git-commit

我“不小心”向 GitHub 推送了一个提交。

是否可以删除此提交？

我想恢复我的 GitHub 存储库，就像这次提交之前一样。

* * *

## 回答 #1

> 赞同：1350
> 
> 时间：2009-01-15T23:24:03.400

> **注意：**请在下面的评论中查看替代方案`git rebase -i`——</p>
> 
> `git reset --soft HEAD^`

首先，删除本地存储库上的提交。您可以使用`git rebase -i`. 例如，如果这是您的最后一次提交，您可以`git rebase -i HEAD~2`在弹出的编辑器窗口中执行并删除第二行。

然后，通过使用强制推送到 GitHub`git push origin +branchName --force`

参见[Git Magic Chapter 5: Lessons of History - And Then Some](http://www-cs-students.stanford.edu/%7Eblynn/gitmagic/ch05.html#_8230_and_then_some)了解更多信息（即如果你想删除旧的提交）。

哦，如果你的工作树很脏，你必须先做`git stash`，然后再做`git stash apply`。

* * *

## 回答 #2

> 赞同：1049
> 
> 时间：2009-01-16T00:11:01.683

```
git push -f origin HEAD^:master 
```

那应该“撤消”推动。

* * *

## 回答 #3

> 赞同：437
> 
> 时间：2014-04-21T20:26:33.600

如果只是一个错误（也许你分叉了一个 repo，然后最终推送到原来的而不是新的），那么为了一个简单的恢复，这里有另一种可能性：

```
git reset --hard 71c27777543ccfcb0376dcdd8f6777df055ef479 
```

显然，将该数字换成您要返回的提交的编号。

一旦您再次推送，此后的所有内容都将被删除。为此，下一步将是：

```
git push --force 
```

* * *

## 回答 #4

> 赞同：136
> 
> 时间：2016-02-09T11:58:15.887

1.  `git log` 找出你想要恢复的提交

2.  `git push origin +7f6d03:master` 而 7f6d03 是错误推送提交之前的提交。 `+`是为了`force push`

就是这样。

[这](http://samwize.com/2014/01/15/how-to-remove-a-commit-that-is-already-pushed-to-github/)是一个很好的指南，可以解决您的问题，简单易行！

* * *

## 回答 #5

> 赞同：89
> 
> 时间：2017-06-07T14:44:44.030

## **如果您想在删除后保留提交更改：**

*请注意，如果要删除的提交是最后提交的，则此解决方案有效。*

* * *

1 - 复制您想从日志中返回的提交参考：

```
git log 
```

2 - 将 git 重置为提交参考：

```
 git reset <commit_ref> 
```

3 - 存储/存储来自错误提交的本地更改，以便在推送到远程后使用：

```
 git stash 
```

4 - 将更改推送到远程存储库，（-f 或 --force）：

```
git push -f 
```

5 - 将存储的更改取回本地存储库：

```
git stash apply 
```

7 - 如果您在更改中有未跟踪/新文件，您需要在提交之前将它们添加到 git：

```
git add . 
```

6 - 添加您需要的任何额外更改，然后提交所需的文件，（或使用点“。”而不是说明每个文件名，以提交本地存储库中的所有文件：

```
git commit -m "<new_commit_message>" <file1> <file2> ... 
```

或者

```
git commit -m "<new_commit_message>" . 
```

* * *

## 回答 #6

> 赞同：41
> 
> 时间：2011-07-27T22:38:42.777

您需要清除缓存才能将其完全清除。这个来自 git 的帮助页面会帮助你。（它帮助了我） [http://help.github.com/remove-sensitive-data/](http://help.github.com/remove-sensitive-data/)

* * *

## 回答 #7

> 赞同：36
> 
> 时间：2017-11-15T12:39:15.747

删除最近的提交，保留你所做的工作：

```
git reset --soft HEAD~1 
```

删除最近的提交，破坏你所做的工作：

```
git reset --hard HEAD~1 
```

* * *

## 回答 #8

> 赞同：30
> 
> 时间：2016-08-10T08:41:55.523

```
1\. git reset HEAD^ --hard
2\. git push origin -f 
```

这对我有用。

* * *

## 回答 #9

> 赞同：28
> 
> 时间：2013-07-17T08:21:22.223

用于`git revert`恢复您的推送。

> git-revert - 恢复一些现有的提交
> 
> ```
> git revert [--edit | --no-edit] [-n] [-m parent-number] [-s] <commit>...
> git revert --continue
> git revert --quit
> git revert --abort 
> ```

还原相关补丁引入的更改，并记录一些记录它们的新提交。这要求您的工作树是干净的（不修改 HEAD 提交）。

**注意**：**git revert**用于记录一些新的提交，以扭转一些早期提交的效果（通常只是一个错误的提交）。如果您想丢弃工作目录中所有未提交的更改，您应该看到**git-reset**，尤其是**--hard**选项。

* * *

## 回答 #10

> 赞同：22
> 
> 时间：2017-03-07T01:27:45.397

要从远程存储库中删除提交：

```
 git push -f origin last_known_good_commit:branch_name 
```

为了从本地存储库中删除提交：

```
git reset --hard HEAD~1 
```

[关联](https://stackoverflow.com/questions/1270514/undoing-a-git-push)

* * *

## 回答 #11

> 赞同：21
> 
> 时间：2016-12-20T14:21:29.907

您需要从要恢复到的提交中知道您的提交哈希。您可以从 GitHub URL 获取它，例如：[https ://github.com/your-organization/your-project/commits/master](https://github.com/your-organization/your-project/commits/master)

假设来自提交的哈希（您想要返回的地方）是“99fb454”（长版本“99fb45413eb9ca4b3063e07b40402b136a8cf264”），那么您所要做的就是：

```
git reset --hard 99fb45413eb9ca4b3063e07b40402b136a8cf264
git push --force 
```

* * *

## 回答 #12

> 赞同：11
> 
> 时间：2015-06-22T10:36:58.730

在 Github 上找到您希望成为分支负责人的提交的 ref 规范，然后使用以下命令：

`git push origin +[ref]:[branchName]`

在您的情况下，如果您只想返回一个提交，请找到该提交的 ref 的开头，例如它是 7f6d03，以及您要更改的分支的名称，例如它是 master，并且请执行下列操作：

`git push origin +7f6d03:master`

加号被解释为`--force`，因为您正在重写历史记录，所以这将是必要的。

请注意，每当您`--force`提交时，您都可能会重写合并您分支的其他人的历史记录。但是，如果您快速发现问题（在其他人合并您的分支之前），您将不会遇到任何问题。

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2017-01-02T14:01:18.187

**如果您这样做是因为您在提交中有敏感数据，那么在此处使用其他答案是不安全**的（除了 subutux，我将对此进行扩展）。

[github 指南](https://help.github.com/articles/remove-sensitive-data/)建议使用外部工具，但我更喜欢使用内置工具。

首先，**备份您的存储库**。然后：

```
git filter-branch --force --index-filter \
'git rm --cached --ignore-unmatch PATH-TO-YOUR-FILE-WITH-SENSITIVE-DATA' \
--prune-empty --tag-name-filter cat -- --all 
```

在此之后，**确保存储库处于您想要的状态**。您可能想要对备份进行比较。

如果你确定它是正确的，那么：

```
#get rid of old unreferenced commits (including the data you want to remove)
git gc --prune=now
git push origin --force --all 
```

您可能希望将本地备份保留一段时间，以防万一。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2017-01-18T02:23:40.810

在您的终端上运行此命令。

```
git reset HEAD~n 
```

您可以从本地 repo 中删除最后 n 次提交，例如 HEAD~2。继续在您的存储库上强制 git push。

```
git push -f origin <branch> 
```

希望这可以帮助！

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2014-05-21T00:09:09.943

为了保留分支和合并结构，`--preserve-merges`在执行 rebase 时使用该选项很重要：

```
git rebase --preserve-merges -i HEAD^^ 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2017-09-20T02:32:40.003

对于 GitHub

*   在本地存储库中重置您的提交 (HARD)
*   创建一个新分支
*   推送新分支
*   删除旧分支（如果要删除主分支，则将新分支作为默认分支）

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2016-02-08T13:37:00.830

首先将本地更改保存在旁边的某个地方（备份）

您可以浏览您最近的提交，然后通过单击“复制完整的 SHA”按钮选择一个提交哈希以将其发送到剪贴板。

如果您的最后一次提交哈希是，假设 g0834hg304gh3084gh （例如）

你必须运行：

`git push origin +g0834hg304gh3084gh:master`

使用您之前复制的哈希使其成为“HEAD”修订版。

添加所需的本地更改。完毕 ;）

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2017-11-15T09:56:10.563

如果你想删除做交互式变基，

`git rebase -i HEAD~4`

`4 represents total number of commits to display count your commit and`相应地改变它

并从列表中删除您想要的提交...

**通过Ctrl+X(ubuntu)**或**:wq(centos)**保存更改

 **第二种方法，做还原，

```
git revert 29f4a2 #your commit ID 
```

这将恢复特定的提交

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2018-07-19T11:05:32.917

在[GitHub Desktop](https://desktop.github.com/)中，您只需右键单击提交并还原它，这将创建一个撤消更改的新提交。

意外提交仍将保留在您的历史记录中（例如，如果您不小心提交了 API 密钥或密码，这可能是一个问题），但代码将被还原。

这是最简单和最容易的选择，接受的答案更全面。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-07-17T12:44:24.550

重写历史不是很好。如果我们使用`git revert <commit_id>`，它会创建所述提交 ID 的干净反向提交。

如此一来，历史就没有被改写，而是大家都知道，已经有回溯了。

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2016-01-07T06:20:12.997

添加/删除文件以按照您想要的方式获取内容：

```
git rm classdir
git add sourcedir 
```

然后修改提交：

```
git commit --amend 
```

先前的错误提交将被编辑以反映新的索引状态 - 换句话说，就像您从一开始就没有犯过错误一样

请注意，只有在尚未推送时才应该这样做。如果您已推送，那么您只需正常提交修复即可。

# wcf - 有没有办法编写 asp.net Web 服务，以便它们更容易转换为 WCF？

> ID：448926
> 
> 赞同：0
> 
> 时间：2009-01-15T23:23:16.383
> 
> 标签：wcf, web-services

例如，我知道 WCF 样式的 Web 服务不像 Web 服务那样依赖会话/应用程序/请求/响应。在我的组织允许我使用 WCF 后立即编写 Web 服务以使它们成为 WCF 服务时，我是否应该记住任何其他问题？

我不认为我有兴趣编写 2.0 Web 服务然后使用 WCF 的兼容模式，因为如果没有新模型的这么多好处，那将是所有复杂性。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-16T00:36:43.037

我想到的一个建议是使用[合同优先方法](http://www.code-magazine.com/article.aspx?quickid=0507061&page=3)来构建您的 Web 服务，因为它与 wcf 消息/数据联系人的概念相似。除此之外，MSDN 还提供以下文章，这些文章是开展迁移任务的良好指南 -

*   [轻松进入 ASP.net WS 到 WCF 迁移](http://msdn.microsoft.com/en-us/library/aa738742.aspx)
*   [将 ASP.NET Web 服务迁移到 WCF](http://msdn.microsoft.com/en-us/library/ms730214.aspx)
*   [将 WSE 3.0 Web 服务迁移到 WCF](http://msdn.microsoft.com/en-us/library/ms732008.aspx)

# c++ - 在 WinCE 上调试时，如何将 Visual Studio 设置为始终加载它知道的符号文件？

> ID：448935
> 
> 赞同：3
> 
> 时间：2009-01-15T23:24:53.337
> 
> 标签：c++, debugging, visual-studio-2005, windows-ce

我正在通过 ActiveSync 连接在 Visual Studio 中调试 WinCE、C++ 程序。每次我启动该过程时，它都无法加载符号信息。但是，如果我右键单击模块并点击“加载符号”，它会正确定位符号信息，而无需我进一步提示。

有没有办法可以将 Visual Studio 设置为：

*   (a) 自动加载此符号信息，或
*   (b) 加载后自动将进程分解到调试器中（类似于 windbg 所做的）？

我猜在某个地方有一个设置，但我还没有找到它。

更新：我忘了在原始问题中提到我没有使用创建 exe 的 Visual Studio 实例进行调试。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-01-15T23:27:18.027

Visual Studio 应该会自动加载符号。但这可以禁用。转到工具 -> 选项 -> 调试器 -> 符号。应该有一个复选框，上面写着“仅在特别要求时从这些位置加载符号”。如果选中该框，则取消选中它。

# c - C 非阻塞键盘输入

> ID：448944
> 
> 赞同：91
> 
> 时间：2009-01-15T23:28:33.907
> 
> 标签：c, linux, asynchronous, input, nonblocking

我正在尝试用 C 语言（在 Linux 上）编写一个程序，该程序循环直到用户按下一个键，但不应该需要按键来继续每个循环。

有没有一种简单的方法可以做到这一点？我想我可以做到这一点，`select()`但这似乎需要做很多工作。

或者，有没有办法在程序关闭而不是非阻塞 io 之前捕获`ctrl`-按键来进行清理？`c`

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2009-01-15T23:37:48.147

如前所述，您可以使用`sigaction`ctrl-c`select`来捕获或捕获任何标准输入。

但是请注意，使用后一种方法，您还需要设置 TTY，使其处于一次字符而不是一次一行模式。后者是默认设置 - 如果您输入一行文本，它不会被发送到正在运行的程序的标准输入，直到您按下回车键。

您需要使用该`tcsetattr()`功能关闭 ICANON 模式，并且可能还禁用 ECHO。从内存中，您还必须在程序退出时将终端设置回 ICANON 模式！

为了完整起见，这里有一些我刚刚敲出的代码（nb：没有错误检查！）它设置了一个 Unix TTY 并模拟了 DOS`<conio.h>`函数`kbhit()`和`getch()`：

```
#include <stdlib.h>
#include <string.h>
#include <unistd.h>
#include <sys/select.h>
#include <termios.h>

struct termios orig_termios;

void reset_terminal_mode()
{
    tcsetattr(0, TCSANOW, &orig_termios);
}

void set_conio_terminal_mode()
{
    struct termios new_termios;

    /* take two copies - one for now, one for later */
    tcgetattr(0, &orig_termios);
    memcpy(&new_termios, &orig_termios, sizeof(new_termios));

    /* register cleanup handler, and set the new terminal mode */
    atexit(reset_terminal_mode);
    cfmakeraw(&new_termios);
    tcsetattr(0, TCSANOW, &new_termios);
}

int kbhit()
{
    struct timeval tv = { 0L, 0L };
    fd_set fds;
    FD_ZERO(&fds);
    FD_SET(0, &fds);
    return select(1, &fds, NULL, NULL, &tv) > 0;
}

int getch()
{
    int r;
    unsigned char c;
    if ((r = read(0, &c, sizeof(c))) < 0) {
        return r;
    } else {
        return c;
    }
}

int main(int argc, char *argv[])
{
    set_conio_terminal_mode();

    while (!kbhit()) {
        /* do some work */
    }
    (void)getch(); /* consume the character */
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-01-16T01:03:13.747

`select()`为了方便起见，它有点太低级了。我建议你使用`ncurses`库将终端置于 cbreak 模式和延迟模式，然后调用，如果没有准备好字符`getch()`，它将返回：`ERR`

```
WINDOW *w = initscr();
cbreak();
nodelay(w, TRUE); 
```

到那时，您可以在`getch`没有阻塞的情况下调用。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-01-15T23:31:33.260

在 UNIX 系统上，您可以使用call 为表示 Control+C 键序列`sigaction`的信号注册信号处理程序。`SIGINT`信号处理程序可以设置一个标志，该标志将在循环中进行检查，使其适当地中断。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-01-15T23:37:35.387

你可能想要`kbhit();`

```
//Example will loop until a key is pressed
#include <conio.h>
#include <iostream>

using namespace std;

int main()
{
    while(1)
    {
        if(kbhit())
        {
            break;
        }
    }
} 
```

这可能不适用于所有环境。一种可移植的方法是创建一个监视线程并设置一些标志`getch();`

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2014-04-23T19:55:36.813

另一种获得非阻塞键盘输入的方法是打开设备文件并读取它！

您必须知道您要查找的设备文件，即 /dev/input/event* 之一。你可以运行 cat /proc/bus/input/devices 来找到你想要的设备。

此代码适用于我（以管理员身份运行）。

```
 #include <stdlib.h>
  #include <stdio.h>
  #include <unistd.h>
  #include <fcntl.h>
  #include <errno.h>
  #include <linux/input.h>

  int main(int argc, char** argv)
  {
      int fd, bytes;
      struct input_event data;

      const char *pDevice = "/dev/input/event2";

      // Open Keyboard
      fd = open(pDevice, O_RDONLY | O_NONBLOCK);
      if(fd == -1)
      {
          printf("ERROR Opening %s\n", pDevice);
          return -1;
      }

      while(1)
      {
          // Read Keyboard Data
          bytes = read(fd, &data, sizeof(data));
          if(bytes > 0)
          {
              printf("Keypress value=%x, type=%x, code=%x\n", data.value, data.type, data.code);
          }
          else
          {
              // Nothing read
              sleep(1);
          }
      }

      return 0;
   } 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-01-15T23:36:32.813

curses 库可用于此目的。当然，`select()`在一定程度上也可以使用信号处理程序。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-01-17T03:08:31.120

如果你只是高兴地抓住了 Control-C，那就大功告成了。如果你真的想要非阻塞 I/O 但又不想使用 curses 库，另一种选择是将 lock、stock 和 bucket 移至[AT&T`sfio`库](http://www2.research.att.com/~astopen/download/ref/sfio/sfio.html)。它是一个很好的基于 C 模式的库，`stdio`但更灵活、线程安全且性能更好。（sfio 代表安全、快速的 I/O。）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-15T23:33:07.453

没有可移植的方法来做到这一点，但 select() 可能是一个好方法。有关更多可能的解决方案，请参阅[http://c-faq.com/osdep/readavail.html](http://c-faq.com/osdep/readavail.html)。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-02-04T08:10:43.780

您可以使用 select 执行此操作，如下所示：

```
 int nfds = 0;
  fd_set readfds;
  FD_ZERO(&readfds);
  FD_SET(0, &readfds); /* set the stdin in the set of file descriptors to be selected */
  while(1)
  {
     /* Do what you want */
     int count = select(nfds, &readfds, NULL, NULL, NULL);
     if (count > 0) {
      if (FD_ISSET(0, &readfds)) {
          /* If a character was pressed then we get it and exit */
          getchar();
          break;
      }
     }
  } 
```

没有太多的工作：D

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-06-17T02:12:36.820

这是为您执行此操作的功能。您需要`termios.h`POSIX 系统自带的。

```
#include <termios.h>
void stdin_set(int cmd)
{
    struct termios t;
    tcgetattr(1,&t);
    switch (cmd) {
    case 1:
            t.c_lflag &= ~ICANON;
            break;
    default:
            t.c_lflag |= ICANON;
            break;
    }
    tcsetattr(1,0,&t);
} 
```

分解：`tcgetattr`获取当前终端信息并将其存储在`t`. 如果`cmd`为 1，则将本地输入标志`t`设置为非阻塞输入。否则将被重置。然后`tcsetattr`将标准输入更改为`t`.

如果你没有在程序结束时重置标准输入，你的 shell 就会出现问题。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-12-02T05:05:51.527

在 C++ 中，我这样做了：

```
#include <chrono>
#include <thread>

using namespace std::chrono_literals;

void OnEnter()
{
    while (true)
    {
        getchar();
        // do something when enter is pressed
    }
}

int main()
{
    std::thread keyBoardCommands(OnEnter);

    while(true)
    {
        // code for main loop
        std::this_thread::sleep_for(16ms);
    }
} 
```

此代码将与平台无关。

# .net - .NET 中的互操作问题

> ID：448945
> 
> 赞同：2
> 
> 时间：2009-01-15T23:28:38.523
> 
> 标签：.net, interop

我有一个访问 32 位 COM 组件的 32 位托管程序集。当我使用 64 位标志编译程序集时，当我尝试从中访问 32 位 COM 组件时出现错误。

有没有办法解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T23:40:34.397

当您使用 64 位标志并在 64 位操作系统上运行时，程序集将加载到 64 位进程中。绝大多数 COM 对象都是作为“In Proc Servers”创建的。

创建“in proc server”的第一步是将包含 COM 对象的 DLL 加载到进行创建的进程中。DLL 是 32 位的，无法加载到进程中。

不幸的是，您遇到了 2 个选项

1.  为 32 位显式编译 .Net EXE
2.  编写组件，以便它可以托管在它自己的进程中。即使这样，我也不确定让 32 位和 64 位进程相互通信有多容易。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-01-15T23:42:29.230

除了已经给出的答案：

在 Windows x64 中，进程可以作为 32 位或 64 位进程启动。64 位进程只能加载 64 位 dll，32 位进程只能加载 32 位 dll。

如果您的 .Net 应用程序的平台目标（例如在项目属性中指定）设置为“任何 CPU”，则中间代码将根据目标平台编译为 32 位或 64 位代码，即在 x64 系统上，64 位代码将被生成。

因此，代码不能再在 64 位系统上加载 32 位 dll。

如果您的代码加载非托管程序集，您应该始终明确指定目标平台。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-15T23:39:24.400

您应该找到并安装此 com 组件的 64 位版本。如果它不可用，您必须将 .net 应用程序作为 32 位应用程序运行。com 组件正在您的进程中运行。而且你不能在同一个进程中同时运行 32 位和 64 位代码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T23:31:52.543

您可以尝试使用 corflags（可能/可能不起作用），或者将您的应用程序设置为仅在 32 位中编译。

```
corflags <assemblyname> /32bit- 
```

消除了对 .Net 程序集的 32 位限制。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-01T23:33:46.050

当进程加载为 x64 时，您无法加载 x86 二进制文件/程序集/任何内容。

# .net - WCF 最小客户端 app.config 设置

> ID：448949
> 
> 赞同：9
> 
> 时间：2009-01-15T23:28:54.733
> 
> 标签：.net, wcf, app-config

对于 app.config 中的简化 WCF 配置，我需要做的最小客户端设置是什么？

默认是这样的：

```
 <bindings>
        <wsHttpBinding>
            <binding name="WSHttpBinding_IService" closeTimeout="00:01:00"
                openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00"
                bypassProxyOnLocal="false" transactionFlow="false" hostNameComparisonMode="StrongWildcard"
                maxBufferPoolSize="524288" maxReceivedMessageSize="65536"
                messageEncoding="Text" textEncoding="utf-8" useDefaultWebProxy="true"
                allowCookies="false">
                <readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384"
                    maxBytesPerRead="4096" maxNameTableCharCount="16384" />
                <reliableSession ordered="true" inactivityTimeout="00:10:00"
                    enabled="false" />
                <security mode="Message">
                    <transport clientCredentialType="Windows" proxyCredentialType="None"
                        realm="" />
                    <message clientCredentialType="Windows" negotiateServiceCredential="true"
                        algorithmSuite="Default" establishSecurityContext="true" />
                </security>
            </binding>
        </wsHttpBinding>
    </bindings> 
```

我可以排除什么，我需要多少？

* * *

**编辑**：我应该开始撕掉零件直到它破裂吗？我希望能找到一些人们很幸运的优化好的 wsHttpBindings。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-01-16T14:36:21.200

Jerograv 是对的，因为这些都是默认值，您可以忽略所有这些。为了测试这一点，我创建了一个简单的服务并创建了所需的最小配置，这几乎是地址、绑定和合同——

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
    <system.serviceModel>
        <client>
            <endpoint address="http://sabra2/TestService/Service1.svc" binding="wsHttpBinding"
                contract="IService1"/>
        </client>
    </system.serviceModel>
</configuration> 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-17T18:13:52.883

请记住 WCF 的 ABC。地址，绑定，合同。这就是你所需要的！

您的客户端只需要有一个端点即可与 WCF 服务通信。每个端点只需要描述每个 ABC 就完成了。其他的东西可以稍后补上。

这就是我不喜欢在 Visual Studio 中添加服务引用的原因之一。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-16T00:35:41.197

我想你会发现*所有*这些都是可选的。无论如何，该特定绑定中的所有这些东西都是默认值。

事实上，在这种情况下，我认为在端点中指定绑定是可选的。

# .net - Winform Checklistbox 标题/列

> ID：448950
> 
> 赞同：0
> 
> 时间：2009-01-15T23:28:59.773
> 
> 标签：.net, vb.net, winforms, .net-3.5

有没有办法在 vb.net 的复选框中实现一个带有标题的新列？我做了一些搜索，但没有找到关于该主题的太多内容。我应该放弃任务并使用列表视图或其他控件吗？

感谢您的任何/所有帮助！联合部队

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-15T23:56:54.363

我建议使用带有复选框列的 ListView。你会有更好的运气。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-01-16T03:23:51.560

另一种选择是带有复选框列的 DataGridView。

# security - reCaptcha 是否被破解/被黑/OCR'd/被击败/被破坏？

> ID：448963
> 
> 赞同：175
> 
> 时间：2009-01-15T23:32:06.240
> 
> 标签：security, captcha, ocr, recaptcha

是否使用过任何编程方法来击败 reCAPTCHA？

我有兴趣看到证据和潜在的证明，特别是 reCAPTCHA 已经被完全自动化的、无人化的方法过时了。

澄清一下，**不要**以任何方式寻找涉及人类的 reCAPTCHA 作弊解决方案，无论是负责填写 CAPCHA、色情搜索者还是 Mechanical Turk 的团队。

我**也不**是在寻找 reCAPTCHA 的替代品，比如选择动物的类型、背景字段或 JavaScript 技巧。

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-02-14T21:43:10.577

我注意到这里几乎所有的答案都与CAPTCHA*概念*的无效性有关，原则上——虽然我非常同意他们的观点，但实际上几个月前[在 OWASP 上发表了一次演讲，](https://www.owasp.org/index.php/OWASP_Israel_2008_Conference)[解释了这一点](http://www.owasp.org/images/6/66/2008-09-14_OWASP_Israel_2008.ppt)——这个问题非常具体，所以我将提供一个演示。
但首先，我将重申该演示，重新阅读其他评论，因为验证码是毫无意义的，没有帮助，与实施无关......

但实际上，请查看[CAPTCHA Killer](http://www.captchakiller.com/)。您可以上传验证码图像，它会自动（如果不是立即）提供 OCR 的答案。它还提供了一个 API（我认为是 REST，但也可能是 SOAP）。我亲自尝试了许多 reCAPTCHA 图像，它实际上是一些最容易（或至少最快）损坏的图像。

**更新**：CAPTCHA Killer 的网站现已被撤下，显然是在法律压力下。有关该主题的完整概述，请参见[http://captcha.org/](http://captcha.org/)。

是的，OCR 并不是破解受 CAPTCHA 保护的站点的最佳方法——还有许多其他更好的方法。

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-04-29T09:17:29.510

您可能会对[这份关于 4chan 如何击败 reCAPTCHA 并使用它来操纵 Time.com 的年度 TIME 100 民意调查结果的详细报告](http://musicmachinery.com/2009/04/27/moot-wins-time-inc-loses/)感兴趣。

> Hacking Recaptcha（又名“阴茎洪水”）
> 
> 使用的下一个策略是查看他们是否可以找到 reCAPTCHA 实施中的缺陷。他们发现关于 reCAPTCHA 的一件事是，它总是向用户提供两个词以供解码 - 一个词是 reCAPTCHA 系统已知的控制词，而另一个是未知词（reCAPTCHA 使用人类来帮助纠正 OCR 错误）。维基百科描述了这个过程：“扫描的文本由两个不同的光学字符识别程序进行分析；在程序不一致的情况下，有问题的单词将被转换为验证码。该词与已知的控制词一起显示并由人类标记。那些一直被人类评委赋予单一标签的词被回收为控制词”。2iasdo4 Anonymous 意识到，如果他们总是用同一个词标记未知的扫描文本 - 如果他们这样做成千上万次，最终很大一部分未知词将被错误地标记为他们的词。他们所要做的就是查看验证码中的两个词，为“简单”的词输入正确的标签（大概是两个光学扫描仪会同意的词），然后输入“阴茎”一词硬一个。如果他们经常这样做，那么很快就会有很大一部分图像被标记为“阴茎”，并且自动投票的能力将恢复（一个副作用，匿名者并没有丢失，这是未来几年的概念会有一些数字书籍在整个文本中随机插入“阴茎”这个词。更新：我问 Ben Maurer，
> 
> 优化验证码
> 
> 与将“阴茎”一词洒在文本中的想法一样吸引人，匿名团队知道时间在流逝，如果他们要恢复消息，他们没有时间等待自动投票者重新上线 -他们将不得不手动投票，很多很多次。因此，他们需要能够尽可能快地输入验证码。他们制定了一套指导方针，使他们能够快速决定可以跳过哪些 reCAPTCHA 单词。例如：
> 
> > 您将得到 2 个字：1 真，1 假。
> > 
> > 对于`[REAL FAKE]`or `[FAKE REAL]`，您只需输入`REAL`它应该被接受。
> > 
> > 如果是`[LOOKSREAL LOOKSREAL]`或`[LOOKSFAKE LOOKSFAKE]`，通常只输入两个单词会更快。不要浪费宝贵的时间来决定其中哪一个是真实的。
> > 
> > 使用单词的外观和类型来识别假单词。不要只依赖其中之一。
> 
> 整个规则集在这里：[fake captcha](http://musicmachinery.files.wordpress.com/2009/04/fakecaptcha2.pdf)。

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2009-01-15T23:34:28.077

CAPTCHA 系统的弱点在于，人们在中国设置了一个满是人的房间，他们唯一的工作就是查看 CAPTCHA 图像并输入结果，该结果会插入实际发送垃圾邮件的自动化系统。

你真的无能为力。

它也比尝试在实际图像上进行图像识别、OCR 等便宜得多（反之，您可能会得到低于 0.01 美元的响应）。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-01-15T23:53:19.130

在屈服于使用验证码的压力之前，请考虑创造性的变通方法，例如设置一个标记为“您的评论”的字段，该字段被 CSS 隐藏。如果输入了该字段，则请求将被服务器丢弃。即使仍然没有很好的方法来击败满是报酬过低的工人的房间，大多数机器人也会爱上它，而验证码无论如何也无济于事。

**更新**：只需阅读一个[案例研究](http://marcelo.sampa.com/marcelo-calbucci/brave-tech-world/A-10-improvement-on-conversion-w.htm)，其中删除 CAPTCHA 可将转化率提高近 10%。这将向我表明，如果您仅仅为了过滤掉机器人而失去 10% 的潜在客户，那就太糟糕了。想象一下 10% 对大多数企业意味着什么。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-01-15T23:40:08.830

我最喜欢的验证码来自 Microsoft：[http ://research.microsoft.com/en-us/um/redmond/projects/asirra/](http://research.microsoft.com/en-us/um/redmond/projects/asirra/)

> Asirra（用于限制访问的动物物种图像识别）是一种 HIP，它通过要求用户识别猫和狗的照片来工作。这项任务对计算机来说很困难，但我们的用户研究表明，人们可以快速准确地完成它。许多人甚至认为它很有趣！

这是一项免费服务，他们有示例代码可以帮助您入门。

我想知道它会被破解多久。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-02-19T23:55:21.423

reCAPTACHA 没有损坏，也不会在很长一段时间内损坏。问题是，如果你实施自己的验证码，如果它坏了，可能需要很长时间才能修复它。

这取自[关于 reCAPTCHA 安全性的页面](http://recaptcha.net/security.html)：

> reCAPTCHA 是一种 Web 服务。这意味着所有图像都是由我们的服务器生成和分级的。(...) 这也提供了额外的保护级别：只要发现安全漏洞，我们的验证码就会自动更新。
> 
> *例如，如果有人编写了一个程序，可以读取我们扭曲的图像，我们可以在很短的时间内添加更多的扭曲，**而无需网络管理员在他们这边进行任何更改。***

我相信，由于他们专注于验证码，他们已经存储了改进的版本，如果需要，可以在很短的时间内部署。（当弱者还没有被破坏时，他们为什么要创造更强的安全性？）

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2009-02-16T07:58:59.297

它不仅被打败了，而且还在其上成功构建[了一个有用的应用程序](http://jdownloader.org/download)，成为打败大量直接下载网站（不仅是megaupload和rapidshare）的各种免费帐户保护的最神奇工具）。

[Jdownloader](http://jdownloader.org/download)是开源的，并且是用 Java 编写的，因此查看[源代码](https://www.syncom.org/svn/jdownloader/)不仅可以回答**它是否损坏**，还可以了解它是**如何**损坏的。

**编辑**：大多数直接下载网站不使用 reCaptcha，而是使用更简单的 Captcha 方法（3 个大写字母以不同颜色着色）。尽管如此，Jdownloader 和[Cryptload](http://cryptload.info/)（类似于 Jdownloader 的程序）是我所知道的唯一有效地破坏了 Captcha 方法的有效实现。我还没有听说过任何破解 reCaptcha 的实现。

**更新**：似乎至少一个 reCaptcha 实现（不是整个 reCaptcha 本身）[也已被破解](http://musicmachinery.com/2009/04/27/moot-wins-time-inc-loses/)。

**2010 年 12 月更新**：Jdownloader[似乎终于击败了 reCaptcha](http://jdownloader.org/news/blog/x20101106-135631recaptcha-anticaptcha-method)。该插件仍处于实验阶段，仅适用于 Windows 版本的 Jdownloader，但是，正如一位尝试过它的伙伴告诉我的，它确实有效。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-01-15T23:59:07.403

[去年在 Defcon 上](http://captchatalk.com/)有一次演讲，谈到了 CAPTCHA 的一般问题。他们所做的其中一件事是使用多个免费的 OCR 引擎并让他们投票选出最好的单词。这样做，他们能够获得一些不错的成功机会。对于一种，它是 40% 左右，但我不认为它是 reCaptcha。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2011-01-13T10:32:36.767

*   *[“事实上，它 [reCAPTCHA] 在 [2011 年 1 月 4 日] 变得非常无用](http://www.pcpro.co.uk/blogs/2011/01/12/vbulletin-forums-hit-by-recaptcha-cracking-spam-bot/?DCMP=NLC-Newsletters#ixzz1AuRKe1mu)，**当时**垃圾邮件发送者显然集体掌握了一个绕过 reCAPTCHA 并允许全自动注册过程的软件。机器人一直很忙，确实很忙, 从此"* [1]

2-3 年前，基于文本输入的验证码方法在他们输掉战斗时越界了，即进一步的复杂化只会使它们相对（因为计算机能力正在增加，而人类没有）更容易被机器使用，并且更令人反感和排斥，如果不是的话对人类来说，完全不可能。这与 CAPTCHA 的原始范例相矛盾，[作为一种测试，以确保响应不是由计算机生成的](http://en.wikipedia.org/wiki/CAPTCHA)

**更新：**
请注意，[reCAPTCHA](http://en.wikipedia.org/wiki/ReCAPTCHA)归[Google Inc.](http://en.wikipedia.org/wiki/Google)所有，但[Google Inc.](http://en.wikipedia.org/wiki/Google)不通过他们自己的服务使用它。
这是一个链接，其中包含 Google 自身/内部使用的验证码网页， [例如用于 Gmail 注册：](https://www.google.com/accounts/NewAccount?service=mail&continue=http://mail.google.com/mail/e-11-b746a09392cf630808ab7e5215d67-4df961e195996c35cdc4510fae6368659e3ce9c5&type=2)

![替代文字](https://i.stack.imgur.com/WCwdf.png)

* * *

* * *

请注意，Google 的[reCAPTCHA](http://en.wikipedia.org/wiki/ReCAPTCHA)始终包含 2 个单词。
这是[提供给其他人使用的带有 Google 的 reCAPTCHA 的图像](http://wiki.recaptcha.net/images/0/07/Rcptadefaultred.png)链接。

还有 reCAPTCHA 的截图：

![替代文字](https://i.stack.imgur.com/tfhsh.png)

我离开是为了向读者做出明显的结论。

引用： [ 1 ]
[vBulletin 论坛被 reCAPTCHA 破解垃圾邮件机器人攻击 | PC Pro 博客](http://www.pcpro.co.uk/blogs/2011/01/12/vbulletin-forums-hit-by-recaptcha-cracking-spam-bot/?DCMP=NLC-Newsletters#ixzz1AuRKe1mu)由 Davey Winder 于**2011 年 1 月 12 日**
发布

 *** * *

## 回答 #10

> 赞同：5
> 
> 时间：2010-03-02T14:49:39.427

我在一个受 reCAPTCHA 保护的系统上看到博客评论，页面加载，1 秒后帖子成功发布。User-Agent 是无稽之谈（在这种特殊情况下，它声称运行的是 Ubuntu 9.25/Firefox 3.8），引荐来源网址来自一个完全不相关的站点，没有指向我们的链接。

这显然是自动化的。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-10-03T02:39:15.583

reCAPTCHA 并没有被击败。如果是这样，那么为什么 Google 只是购买它并宣布他们将在 Google 内部应用该技术来增加对 Google 产品的欺诈和垃圾邮件保护？

来自[Google Acquires reCAPTCHA](http://mashable.com/2009/09/16/google-acquires-recaptcha/)于 2009 年 9 月 16 日发布到 Google 博客：

> 通过这种方式，reCAPTCHA 的独特技术改进了将扫描图像转换为纯文本的过程，即光学字符识别 (OCR)。该技术还为 Google 图书和 Google 新闻档案搜索等大型文本扫描项目提供支持。拥有文档的文本版本很重要，因为可以搜索纯文本，在移动设备上轻松呈现并显示给视障用户。因此，我们将在 Google 中应用该技术，不仅可以增强对 Google 产品的欺诈和垃圾邮件保护，还可以改进我们的图书和报纸扫描流程。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2011-02-09T05:06:46.913

击败验证码的最简单方法是 Amazon Mechanical Turk。有一个叫 Kermit Welda 的人每人支付一美分来注册 Hotmail、AOL 和 Gmail 帐户。那是 6,000 个假电子邮件帐户，每天 5 美分 = 300 美元。当您让其他人为您做肮脏的工作时，做生意的成本非常便宜。难怪我们服务器的垃圾邮件过滤器想要拒绝来自 Hotmail 的任何内容。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-02-16T08:01:14.487

AFAIK 实际上，没有工具可以破解 RE-captcha 实现，但最终我认为有人会得到它。

有趣的是，如果有人设法得到它，那么整个 RE-captcha 项目就毫无意义，因为 re-captcha 设计了无法以自动化方式完成的数字化书籍。

顺便提一句 ：

> CAPTCHA 系统的弱点在于，人们在中国设置了一个满是人的房间，他们唯一的工作就是查看 CAPTCHA 图像并输入结果，该结果会插入实际发送垃圾邮件的自动化系统。

你不能像这样想保护一个系统，这就像说“如果你的主机不在一个旧的军事掩体中，你的 Web 应用程序就不够安全，因为现在人们可以窃取你的机器”。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-01-30T21:46:20.883

有很多方法可以用来废话recaptcha。虽然很难使用启用了神经网络的程序来自动解决它们，但它可以抓取图像并让亚马逊的机械土耳其人或一些等效的程序来解决它们。

[http://codemagician.wordpress.com/2010/01/22/solving-recaptcha/](http://codemagician.wordpress.com/2010/01/22/solving-recaptcha/)

# css - 哪些字符在 CSS 类名/选择器中有效？

> ID：448981
> 
> 赞同：1290
> 
> 时间：2009-01-15T23:37:39.880
> 
> 标签：css, css-selectors

**CSS**类选择器中允许使用哪些字符/符号？
我知道以下字符*无效*，但哪些字符*有效*？

```
~ ! @ $ % ^ & * ( ) + = , . / ' ; : " ? > < [ ] \ { } | ` # 
```

* * *

## 回答 #1

> 赞同：1089
> 
> 时间：2009-01-15T23:42:27.670

可以直接查看[CSS 语法](http://www.w3.org/TR/CSS21/grammar.html#scanner)。

*基本上*¹，名称必须以下划线 ( `_`)、连字符 ( `-`) 或字母 ( `a`–<code>z) 开头，后跟任意数量的连字符、下划线、字母或数字。有一个问题：如果第一个字符是连字符，则第二个字符必须是²个字母或下划线，并且名称必须至少有 2 个字符长。

```
-?[_a-zA-Z]+[_a-zA-Z0-9-]* 
```

简而言之，前面的规则转换为从[W3C 规范中提取的以下规则。](https://www.w3.org/TR/CSS21/syndata.html#characters)：

> 在 CSS 中，标识符（包括选择器中的元素名称、类和 ID）只能包含字符 [a-z0-9] 和 ISO 10646 字符 U+00A0 及更高，加上连字符 (-) 和下划线 (_) ; 它们不能以数字或连字符后跟数字开头。标识符还可以包含转义字符和任何 ISO 10646 字符作为数字代码（请参阅下一项）。例如，标识符“B&W？” 可以写成“B&W？” 或“B\26 W\3F”。

以连字符或下划线开头的标识符通常保留用于特定于浏览器的扩展，如`-moz-opacity`.

¹由于包含转义的 unicode 字符（没有人真正使用），这一切都变得更加复杂。

²请注意，根据我链接的语法，以两个连字符开头的规则，例如`--indent1`，是无效的。但是，我很确定我已经在实践中看到了这一点。

* * *

## 回答 #2

> 赞同：201
> 
> 时间：2011-07-18T12:32:15.180

令我惊讶的是，这里的大多数答案都是错误的。事实证明：

**CSS 中的 CSS 类名中允许使用除 NUL 之外的任何字符。**（如果 CSS 包含 NUL（转义与否），则结果未定义。[ [CSS-characters](http://www.w3.org/TR/CSS21/syndata.html#characters) ]）

[Mathias Bynens 的回答](https://stackoverflow.com/a/6592488/8554766)链接到[说明](http://mathiasbynens.be/notes/css-escapes)和[演示](http://mathiasbynens.be/demo/crazy-class)如何使用这些名称。*用 CSS 代码写下来*，类名*可能需要转义*，但这不会改变类名。例如，一个不必要的过度转义表示看起来与该名称的其他表示不同，但它仍然引用相同的类名。

大多数其他（编程）语言没有转义变量名（“标识符”）的概念，因此变量的所有表示必须看起来相同。这不是 CSS 中的情况。

请注意，在 HTML 中，无法在[类名属性中包含](http://www.w3.org/TR/html/dom.html#classes)[空格字符（空格、制表符、换行符、换页符和回车符）](http://www.w3.org/TR/html/infrastructure.html#space-character)，因为它们已经将类彼此分开。

因此，如果您需要将随机字符串转换为 CSS 类名：请注意 NUL 和空格，然后转义（针对 CSS 或 HTML）。完毕。

* * *

## 回答 #3

> 赞同：82
> 
> 时间：2011-07-06T06:41:42.393

我在这里深入回答了你的问题：http: [//mathiasbynens.be/notes/css-escapes](http://mathiasbynens.be/notes/css-escapes)

这篇文章还解释了如何在 CSS（和 JavaScript）中转义任何字符，我也为此做[了一个方便的工具](http://mothereff.in/css-escapes#0~!%40%24%25%5E%26%2a%28%29%5f%2B-%3D%2C.%2F%27%3B%3A%22%3F%3E%3C%5B%5D%5C%7B%7D%7C%60%23)。从该页面：

> 如果你要给一个元素一个 ID 值`~!@$%^&*()_+-=,./';:"?><[]{}|`#`，选择器应该是这样的：
> 
> **CSS：**
> 
> ```
> <style>
>   #\~\!\@\$\%\^\&\*\(\)\_\+-\=\,\.\/\'\;\:\"\?\>\<\[\]\\\{\}\|\`\#
>   {
>     background: hotpink;
>   }
> </style> 
> ```
> 
> **JavaScript：**
> 
> ```
> <script>
>   // document.getElementById or similar
>   document.getElementById('~!@$%^&*()_+-=,./\';:"?><[]\\{}|`#');
>   // document.querySelector or similar
>   $('#\\~\\!\\@\\$\\%\\^\\&\\*\\(\\)\\_\\+-\\=\\,\\.\\/\\\'\\;\\:\\"\\?\\>\\<\\[\\]\\\\\\{\\}\\|\\`\\#');
> </script> 
> ```

* * *

## 回答 #4

> 赞同：71
> 
> 时间：2009-01-15T23:45:09.863

阅读[W3C 规范](http://www.w3.org/TR/CSS21/syndata.html#characters)。（这是 CSS 2.1，为您的浏览器假设找到合适的版本）

编辑：相关段落如下：

> 在 CSS 中，标识符（包括选择器中的元素名称、类和 ID）只能包含字符 [a-z0-9] 和 ISO 10646 字符 U+00A1 及更高，加上连字符 (-) 和下划线 (_) ; 它们不能以数字或连字符后跟数字开头。标识符还可以包含转义字符和任何 ISO 10646 字符作为数字代码（请参阅下一项）。例如，标识符“B&W？” 可以写成“B\&W\?” 或“B\26 W\3F”。

编辑2：正如@mipadi 在Triptych 的回答中指出的那样，有这个[警告](http://www.w3.org/TR/CSS21/syndata.html#vendor-keywords)，也在同一个网页中：

> 在 CSS 中，标识符可以以“-”（破折号）或“_”（下划线）开头。以“-”或“_”开头的关键字和属性名称保留用于特定于供应商的扩展。此类特定于供应商的扩展应具有以下格式之一：
> 
> ```
> '-' + vendor identifier + '-' + meaningful name 
> '_' + vendor identifier + '-' + meaningful name 
> ```
> 
> 例子）：
> 
> 例如，如果 XYZ 组织添加了一个属性来描述显示器东侧边框的颜色，他们可能会称之为 -xyz-border-east-color。
> 
> 其他已知示例：
> 
> ```
>  -moz-box-sizing
>  -moz-border-radius
>  -wap-accesskey 
> ```
> 
> 任何当前或未来级别的 CSS 都保证不会在属性或关键字中使用初始破折号或下划线。因此，典型的 CSS 实现可能无法识别此类属性，并且可能会根据处理解析错误的规则忽略它们。然而，因为最初的破折号或下划线是语法的一部分，所以 CSS 2.1 实现者应该始终能够使用符合 CSS 的解析器，无论他们是否支持任何特定于供应商的扩展。
> 
> 作者应避免特定于供应商的扩展

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2009-01-16T00:05:03.897

完整的正则表达式为：

```
-?(?:[_a-z]|[\200-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])(?:[_a-z0-9-]|[\200-\377]|\\[0-9a-f]{1,6}(\r\n|[ \t\r\n\f])?|\\[^\r\n\f0-9a-f])* 
```

因此，如果直接使用，则不允许使用除“<code>-”和“<code>_”之外的所有列出的字符。`foo\~bar`但是您可以使用反斜杠或使用 unicode 表示法对它们进行编码`foo\7E bar`。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2016-06-23T17:33:28.347

对于那些寻找解决方法的人，您可以使用属性选择器，例如，如果您的类以数字开头。改变：

```
.000000-8{background:url(../../images/common/000000-0.8.png);} /* DOESN'T WORK!! */ 
```

对此：

```
[class="000000-8"]{background:url(../../images/common/000000-0.8.png);} /* WORKS :) */ 
```

此外，如果有多个类，则需要在选择器中指定它们或使用`~=`运算符：

```
[class~="000000-8"]{background:url(../../images/common/000000-0.8.png);} 
```

**资料来源：**

1.  [https://benfrain.com/when-and-where-you-can-use-numbers-in-id-and-class-names/](https://benfrain.com/when-and-where-you-can-use-numbers-in-id-and-class-names/)
2.  [是否有一种解决方法可以使名称以数字开头的 CSS 类有效？](https://stackoverflow.com/questions/21227702/is-there-a-workaround-to-make-css-classes-with-names-that-start-with-numbers-val)
3.  [https://developer.mozilla.org/en-US/docs/Web/CSS/Attribute_selectors](https://developer.mozilla.org/en-US/docs/Web/CSS/Attribute_selectors)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2010-07-31T05:33:54.117

我的理解是下划线在技术上是有效的。查看：

[https://developer.mozilla.org/en/underscores_in_class_and_id_names](https://developer.mozilla.org/en/underscores_in_class_and_id_names)

“……2001 年初发布的规范勘误表首次使下划线合法化。”

上面链接的文章说永远不要使用它们，然后列出了不支持它们的浏览器，所有这些浏览器至少就用户数量而言是长期冗余的。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-10-12T14:04:04.020

对于 HTML5/CSS3 类和 ID 可以以数字开头。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2020-08-05T15:50:41.927

我们可以使用所有字符作为类名。即使喜欢`#`和`.`Just 我们也必须用`\`.

```
.test\.123 {
  color: red;
}

.test\#123 {
  color: blue;
}

.test\@123 {
  color: green;
}

.test\<123 {
  color: brown;
}

.test\`123 {
  color: purple;
}

.test\~123 {
  color: tomato;
}
```

```
<div class="test.123">test.123</div>
<div class="test#123">test#123</div>
<div class="test@123">test@123</div>
<div class="test<123">test<123</div>
<div class="test`123">test`123</div>
<div class="test~123">test~123</div>
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2019-09-07T14:42:06.853

离开@Triptych 的答案，您可以使用以下 2 个正则表达式匹配来使字符串有效：

```
[^a-z0-9A-Z_-] 
```

这是一个反向匹配，它选择任何不是字母、数字、破折号或下划线的东西，以便于删除。

```
^-*[0-9]+ 
```

这匹配字符串开头的 0 或 1 个破折号，后跟 1 个或多个数字，也便于删除。

我如何在 PHP 中使用它：

```
//Make alphanumeric with dashes and underscores (removes all other characters)
$class = preg_replace("/[^a-z0-9A-Z_-]/", "", $class);
//Classes only begin with an underscore or letter
$class = preg_replace("/^-*[0-9]+/", "", $class);
//Make sure the string is 2 or more characters long
return 2 <= strlen($class) ? $class : ''; 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-11-14T13:37:33.077

我**不建议使用除 Az、_- 和 0-9 之外的任何东西**，而使用这些符号进行编码更容易。也不要开始类，`-`而这些类通常是特定于浏览器的标志。为了避免 IDE 自动完成的任何问题，当您出于某种原因可能需要使用其他代码生成这些类名时，复杂性会降低。也许某些转译软件可能无法正常工作等等等等。

然而，CSS 在这方面相当松散。您可以使用任何符号，甚至表情符号也可以。

```
<style>
.{
  border: 2px solid blue;
  width: 100px;
  height: 100px;
  overflow: hidden;
}
</style>

<div class="">

</div> 
```

[![在此处输入图像描述](https://i.stack.imgur.com/oMC5Q.png)](https://i.stack.imgur.com/oMC5Q.png)

# regex - egrep 搜索空格

> ID：448997
> 
> 赞同：22
> 
> 时间：2009-01-15T23:40:39.373
> 
> 标签：regex, unix, grep

我正在尝试将 egrep 与正则表达式模式一起使用来匹配空格。

我之前在 Perl 和 C# 中使用过 RegEx，它们都支持`\s`搜索空格的模式。egrep（或至少我正在使用的版本）似乎不支持这种模式。

在网上的几篇文章中，我遇到了一个简写 [[:space:]]，但这似乎不起作用。任何帮助表示赞赏。

使用：SunOS 5.10

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-01-16T00:30:51.583

我在 SunOS 5.10 上看到了同样的问题。 `/usr/bin/egrep`不支持扩展正则表达式。

尝试使用`/usr/xpg4/bin/egrep`：

```
$ echo 'this line has whitespace
thislinedoesnthave' | /usr/xpg4/bin/egrep '[[:space:]]'
this line has whitespace 
```

另一种选择可能是只使用 perl：

```
$ echo 'this line has whitespace
thislinedoesnthave' | perl -ne 'chomp;print "$_\n" if /[[:space:]]/'
this line has whitespace 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-01-16T00:52:28.527

如果您使用 grep 的“降级”版本（我引用该术语是因为我工作的大多数 UNIX 仍然使用原始 RE，而不是那些带有“ `\s`”或“ `[[:space:]]`”的花哨的 :-），您可以恢复到RE的最低形式。

例如，如果`:space:`定义为空格和制表符，只需使用：

```
egrep '[ ^I]' file 
```

那`^I`是一个实际的制表符，而不是两个字符`^`和`I`。

`:space:` **这是**假设定义为制表符和空格，否则调整`[]`字符内的选择。

使用降级 RE 的优点是它们应该适用于所有平台（至少对于 ASCII；Unicode 或非英语语言可能有不同的规则，但我很少发现需要）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-09-10T03:36:07.470

如果您使用的是 bash，那么将制表符放在一行中的语法是

```
$'foo\tbar' 
```

我最近正在使用 sed 对制表符分隔的文件进行一些修复。文件的一部分是：

```
sed -E -e $'s/\t--QUOTE--/\t"/g' 
```

该参数由 bash 解析，并且 sed 看到一个带有文字标签的正则表达式。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-01-15T23:51:56.247

也许你应该用引号保护模式（如果是 bash，或者你正在使用的 shell 的任何等效项）。

[ 和 ] 对 shell 可能有特殊含义。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-01-15T23:47:43.917

```
$ cat > file
this line has whitespace
thislinedoesnthave
$ egrep [[:space:]] file 
this line has whitespace 
```

在debian下工作。

对于 Solaris，没有像（参见 gentoo）这样的“eselect”或替代文件来设置默认的 egrep 版本吗？

您是否尝试过 grep -E，因为如果您路径上的 egrep 不是好的，那么 grep 可能是。

# mysql - 如何将MYSQL数据库表从一台服务器导出到另一台服务器

> ID：448998
> 
> 赞同：3
> 
> 时间：2009-01-15T23:40:49.123
> 
> 标签：mysql

如何将 MYSQL 数据库选定的表（不是全部）从一台机器导出和导入到另一台机器？

干杯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-01-15T23:43:50.897

mysqldump [options] db_name [tables] 然后使用 mysql -u root -p < backup.sql 加载它们

或 rsync /var/lib/mysql/ ...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T14:40:46.883

我使用[MySQL Administrator](http://dev.mysql.com/downloads/gui-tools/5.0.html)，它可以让您以交互方式备份/导出到文件（并从文件恢复）。从命令行，@Aif 说了什么。如果您担心原子性/一致的数据库状态，请先 LOCK TABLES，然后再 UNLOCK TABLES。

# linux - 有没有办法弄清楚什么是使用 Linux 内核模块？

> ID：448999
> 
> 赞同：77
> 
> 时间：2009-01-15T23:41:27.080
> 
> 标签：linux, kernel, kernel-module

如果我加载一个内核模块并用 列出加载的模块`lsmod`，我可以获得模块的“使用计数”（引用该模块的其他模块的数量）。不过，有没有办法弄清楚*什么*在使用模块？

问题是我正在开发的一个模块坚持它的使用计数是 1，因此我不能`rmmod`用来卸载它，但它的“by”列是空的。这意味着每次我想重新编译和重新加载模块时，我都必须重新启动机器（或者，至少，我想不出任何其他方法来卸载它）。

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2013-03-19T07:59:23.927

实际上，似乎有一种方法可以列出声称模块/驱动程序的进程 - 但是，我没有看到它做广告（在 Linux 内核文档之外），所以我会在这里记下我的笔记：

首先，非常感谢[@haggai_e](https://stackoverflow.com/a/449856/277826)的回答；指向函数的指针`try_module_get`和`try_module_put`负责管理使用计数 (refcount) 的指针是让我能够追踪该过程的关键。

在网上进一步寻找这个，我不知何故偶然发现了帖子[Linux-Kernel Archive：[PATCH 1/2] tracking：减少模块跟踪点的开销](http://lkml.indiana.edu/hypermail/linux/kernel/1003.3/00570.html)；最终指向内核中存在的一个工具，称为（我猜）“跟踪”；相关文档位于[Documentation/trace - Linux kernel source tree](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/Documentation/trace)目录中。特别是，两个文件解释了跟踪工具，[events.txt](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/Documentation/trace/events.txt)和[ftrace.txt](http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/Documentation/trace/ftrace.txt)。

但是，在运行的 Linux 系统上还有一个简短的“tracing mini-HOWTO” `/sys/kernel/debug/tracing/README`（另见[我真的很厌倦人们说没有文档……</a>）；请注意，在内核源代码树中，该文件实际上是由文件](https://plus.google.com/111049168280159033135/posts/4njRkH5jCa5)[kernel/trace/trace.c 生成](https://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/tree/kernel/trace/trace.c#n2971)的。我已经在 Ubuntu 上对此进行了测试`natty`，请注意，由于`/sys`它是由 root 拥有的，因此您必须使用它`sudo`来读取此文件，如`sudo cat`或

```
sudo less /sys/kernel/debug/tracing/README 
```

...这几乎适用于`/sys`将在此处描述的所有其他操作。

* * *

首先，这是一个简单的最小模块/驱动程序代码（我从引用的资源中汇总），它简单地创建了一个`/proc/testmod-sample`文件节点，它返回字符串“This is testmod”。阅读时；这是**`testmod.c`**：

```
/*
https://github.com/spotify/linux/blob/master/samples/tracepoints/tracepoint-sample.c
https://www.linux.com/learn/linux-training/37985-the-kernel-newbie-corner-kernel-debugging-using-proc-qsequenceq-files-part-1
*/

#include <linux/module.h>
#include <linux/sched.h>
#include <linux/proc_fs.h>
#include <linux/seq_file.h> // for sequence files

struct proc_dir_entry *pentry_sample;

char *defaultOutput = "This is testmod.";

static int my_show(struct seq_file *m, void *v)
{
  seq_printf(m, "%s\n", defaultOutput);
  return 0;
}

static int my_open(struct inode *inode, struct file *file)
{
  return single_open(file, my_show, NULL);
}

static const struct file_operations mark_ops = {
  .owner    = THIS_MODULE,
  .open = my_open,
  .read = seq_read,
  .llseek   = seq_lseek,
  .release  = single_release,
};

static int __init sample_init(void)
{
  printk(KERN_ALERT "sample init\n");
  pentry_sample = proc_create(
    "testmod-sample", 0444, NULL, &mark_ops);
  if (!pentry_sample)
    return -EPERM;
  return 0;
}

static void __exit sample_exit(void)
{
    printk(KERN_ALERT "sample exit\n");
    remove_proc_entry("testmod-sample", NULL);
}

module_init(sample_init);
module_exit(sample_exit);

MODULE_LICENSE("GPL");
MODULE_AUTHOR("Mathieu Desnoyers et al.");
MODULE_DESCRIPTION("based on Tracepoint sample"); 
```

该模块可以使用以下内容构建**`Makefile`**（只需将其放在与 相同的目录中`testmod.c`，然后`make`在同一目录中运行）：

```
CONFIG_MODULE_FORCE_UNLOAD=y
# for oprofile
DEBUG_INFO=y
EXTRA_CFLAGS=-g -O0

obj-m += testmod.o

# mind the tab characters needed at start here:
all:
    make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

clean:
    make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean 
```

构建此模块/驱动程序时，输出是内核目标文件，`testmod.ko`.

* * *

至此，我们就可以准备`try_module_get`和相关的事件追踪了`try_module_put`；那些在`/sys/kernel/debug/tracing/events/module`：

```
$ sudo ls /sys/kernel/debug/tracing/events/module
enable  filter  module_free  module_get  module_load  module_put  module_request 
```

请注意，在我的系统上，默认情况下启用跟踪：

```
$ sudo cat /sys/kernel/debug/tracing/tracing_enabled
1 
```

...但是，模块跟踪（特别是）不是：

```
$ sudo cat /sys/kernel/debug/tracing/events/module/enable
0 
```

现在，我们应该首先制作一个过滤器，它将对`module_get`, `module_put`etc 事件做出反应，但仅限于`testmod`模块。为此，我们应该首先检查事件的格式：

```
$ sudo cat /sys/kernel/debug/tracing/events/module/module_put/format
name: module_put
ID: 312
format:
...
    field:__data_loc char[] name;   offset:20;  size:4; signed:1;

print fmt: "%s call_site=%pf refcnt=%d", __get_str(name), (void *)REC->ip, REC->refcnt 
```

在这里我们可以看到有一个名为 的字段`name`，其中包含我们可以过滤的驱动程序名称。要创建过滤器，我们只需`echo`将过滤器字符串放入相应的文件中：

```
sudo bash -c "echo name == testmod > /sys/kernel/debug/tracing/events/module/filter" 
```

在这里，首先请注意，由于我们必须调用`sudo`，我们必须将整个`echo`重定向包装为`sudo`-ed的参数命令`bash`。其次，请注意，由于我们写入的是“父级” `module/filter`，而不是特定事件（可能是`module/module_put/filter`等），因此此过滤器将应用于列为`module`目录的“子级”的所有事件。

最后，我们为模块启用跟踪：

```
sudo bash -c "echo 1 > /sys/kernel/debug/tracing/events/module/enable" 
```

从这一点开始，我们可以读取跟踪日志文件；对我来说，读取跟踪文件的阻塞、“管道”版本是有效的——就像这样：

```
sudo cat /sys/kernel/debug/tracing/trace_pipe | tee tracelog.txt 
```

此时，我们不会在日志中看到任何内容 - 所以是时候加载（并使用和删除）驱动程序了（在不同的终端`trace_pipe`中读取）：

```
$ sudo insmod ./testmod.ko
$ cat /proc/testmod-sample 
This is testmod.
$ sudo rmmod testmod 
```

如果我们回到`trace_pipe`正在读取的终端，我们应该会看到如下内容：

```
# tracer: nop
#
#           TASK-PID    CPU#    TIMESTAMP  FUNCTION
#              | |       |          |         |
          insmod-21137 [001] 28038.101509: module_load: testmod
          insmod-21137 [001] 28038.103904: module_put: testmod call_site=sys_init_module refcnt=2
           rmmod-21354 [000] 28080.244448: module_free: testmod 
```

这几乎就是我们将为我们的`testmod`驱动程序获得的所有内容 - 引用计数仅在驱动程序加载（`insmod`）或卸载（`rmmod`）时发生变化，而不是在我们进行通读时`cat`。所以我们可以简单地在那个终端`trace_pipe`中用`CTRL`+中断读取；`C`并完全停止追踪：

```
sudo bash -c "echo 0 > /sys/kernel/debug/tracing/tracing_enabled" 
```

在这里，请注意，大多数示例是指读取文件`/sys/kernel/debug/tracing/trace`而不是`trace_pipe`这里。然而，一个问题是这个文件并不意味着是“管道”（所以你不应该`tail -f`在这个`trace`文件上运行 a ）；`trace`但相反，您应该在每次操作后重新阅读。在第一个之后，我们将通过-ing和;`insmod`获得相同的输出。但是，在 之后，读取文件会给出：`cat``trace``trace_pipe``rmmod``trace`

```
 <...>-21137 [001] 28038.101509: module_load: testmod
   <...>-21137 [001] 28038.103904: module_put: testmod call_site=sys_init_module refcnt=2
   rmmod-21354 [000] 28080.244448: module_free: testmod 
```

...也就是说：此时，`insmod`已经退出了很长时间，因此它不再存在于进程列表中 - 因此无法通过当时记录的进程 ID (PID) 找到 - 因此我们获得一个空白`<...>`作为进程名称。因此，在这种情况下，最好记录（通过`tee`）运行输出。`trace_pipe`另外，请注意，为了清除/重置/擦除`trace`文件，只需将 0 写入其中：

```
sudo bash -c "echo 0 > /sys/kernel/debug/tracing/trace" 
```

如果这看起来违反直觉，请注意这`trace`是一个特殊文件，并且无论如何都会报告文件大小为零：

```
$ sudo ls -la /sys/kernel/debug/tracing/trace
-rw-r--r-- 1 root root 0 2013-03-19 06:39 /sys/kernel/debug/tracing/trace 
```

...即使它是“满的”。

最后，请注意，如果我们没有实现过滤器，我们将获得运行系统上*所有*`grep`模块调用的日志 - 这将记录任何调用（也包括后台）等，因为那些使用`binfmt_misc`模块：

```
...
  tr-6232  [001] 25149.815373: module_put: binfmt_misc call_site=search_binary_handler refcnt=133194
..
  grep-6231  [001] 25149.816923: module_put: binfmt_misc call_site=search_binary_handler refcnt=133196
..
  cut-6233  [000] 25149.817842: module_put: binfmt_misc call_site=search_binary_handler refcnt=129669
..
  sudo-6234  [001] 25150.289519: module_put: binfmt_misc call_site=search_binary_handler refcnt=133198
..
  tail-6235  [000] 25150.316002: module_put: binfmt_misc call_site=search_binary_handler refcnt=129671 
```

...这增加了相当多的开销（在日志数据量和生成它所需的处理时间方面）。

* * *

在查找此内容时，我偶然发现[了 Ftrace PDF 的 Debugging Linux Kernel](http://www.ckernel.org/news/downloads/2010file/Acelan_dirty-throttling.pdf)，它指的是一个工具[trace-cmd](http://git.kernel.org/cgit/linux/kernel/git/rostedt/trace-cmd.git/tree/)，它与上面的功能非常相似 - 但通过更简单的命令行界面。`trace-cmd`还有一个名为[KernelShark](http://people.redhat.com/srostedt/kernelshark/HTML/)的“前端阅读器”GUI ；这两个也都在 Debian/Ubuntu 存储库中，通过`sudo apt-get install trace-cmd kernelshark`. 这些工具可以替代上述过程。

最后，我要注意的是，虽然上面的`testmod`示例并没有真正显示在多个声明的上下文中的使用，但我使用相同的跟踪过程发现我正在编码的 USB 模块被多次`pulseaudio`声明USB 设备已插入 - 因此该过程似乎适用于此类用例。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-01-16T08:38:15.310

它在[Linux Kernel Module Programming Guide](http://www.linuxtopia.org/online_books/Linux_Kernel_Module_Programming_Guide/x573.html#AEN655)上说，模块的使用计数由函数`try_module_get`和`module_put`. 也许您可以找到为您的模块调用这些函数的位置。

更多信息：[https ://www.kernel.org/doc/htmldocs/kernel-hacking/routines-module-use-counters.html](https://www.kernel.org/doc/htmldocs/kernel-hacking/routines-module-use-counters.html)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-16T01:22:28.297

您所得到的只是哪些模块依赖于哪些其他模块的列表（`Used by`lsmod 中的列）。您无法编写程序来说明加载模块的原因，是否仍然需要它，或者如果您卸载它以及依赖它的所有东西可能会破坏什么。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-01-16T01:18:31.673

你可以试试`lsof`或`fuser`。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-11-08T15:04:28.780

如果您在没有 --force 选项的情况下使用 rmmod，它将告诉您正在使用什么模块。例子：

```
$ lsmod | grep firewire
firewire_ohci          24695  0 
firewire_core          50151  1 firewire_ohci
crc_itu_t               1717  1 firewire_core

$ sudo modprobe -r firewire-core
FATAL: Module firewire_core is in use.

$ sudo rmmod firewire_core
ERROR: Module firewire_core is in use by firewire_ohci

$ sudo modprobe -r firewire-ohci
$ sudo modprobe -r firewire-core
$ lsmod | grep firewire
$ 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-11-14T11:58:19.177

尝试 kgdb 并为您的模块设置断点

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2016-08-17T19:52:45.457

对于任何想弄清楚为什么他们不能重新加载模块的人，我可以通过以下方式解决这个问题

*   使用“modinfo”获取当前使用的模块的路径
*   rm -rfing 它
*   将我要加载的新模块复制到它所在的路径
*   键入“modprobe DRIVER_NAME.ko”。***************