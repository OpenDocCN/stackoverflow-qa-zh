# StackOverflow 问答 000504000-000504999

# java - java中的1行IF语句

> ID：504003
> 
> 赞同：7
> 
> 时间：2009-02-02T17:14:13.283
> 
> 标签：java, conditional

是否可以在 Java 中使用不带大括号的 IF 语句，例如：

```
if (x == y)
  z = x * y;
else
  z = y - x; 
```

这在 PHP 中是可能的，我不确定我是否做错了什么。

**澄清：**这是我正在使用的实际代码：

```
if (other instanceof Square)
    Square realOther = (Square) other;
else
    Rectangle realOther = (Rectangle) other; 
```

但是我遇到了诸如“realOther 上的语法标记，删除此标记”和“realOther 无法解决”之类的错误。

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-02T17:14:51.613

`if`是的，您可以在不使用花括号的情况下使用单个语句来跟踪语句（但您真的想要吗？），但您的问题更加微妙。尝试改变：

```
if (x=y) 
```

到：

```
if (x==y) 
```

某些语言（例如 PHP）将任何非零值视为 true 并将零（或`NULL`, `null`, `nil`, 不管）视为`false`，因此条件中的赋值操作有效。Java 只允许在条件语句中使用布尔表达式（返回或评估为布尔值的表达式）。您看到此错误是因为 的结果`(x=y)`是 的值`y`，而不是`true`或`false`。

您可以通过这个简单的示例看到这一点：

```
if (1)
    System.out.println("It's true");

if (true)
    System.out.println("It's true"); 
```

第一条语句将导致编译失败，因为`1`无法转换为布尔值。

**编辑：**我对您更新示例的猜测（您应该将其放入问题而不是作为新答案）是您`realOther`在这些语句中分配它之后尝试访问。这将不起作用，因为范围`realOther`仅限于`if`/`else`语句。您需要将声明移到语句`realOther`上方`if`（在这种情况下将无用），或者在`if`语句中添加更多逻辑）：

```
if (other instanceof Square)
    ((Square) other).doSomething();
else
    ((Rectangle) other).doSomethingElse(); 
```

为了进一步提供帮助，我们需要查看更多您的**实际**代码。

**编辑：**使用以下代码会导致您看到相同的错误（使用 编译`gcj`）：

```
public class Test {
    public static void Main(String [] args) {
        Object other = new Square();

        if (other instanceof Square)
            Square realOther = (Square) other;
        else
            Rectangle realOther = (Rectangle) other;

        return;
    }
}

class Rectangle {
    public Rectangle() { }
    public void doSomethingElse() {
        System.out.println("Something");
    }
}

class Square {
    public Square() { }
    public void doSomething() {
        System.out.println("Something");
    }
} 
```

`if`请注意，在/语句中添加花括号会将`else`错误减少为有关未使用变量的警告。我们自己的[mmyers](https://stackoverflow.com/users/13531/mmyers)指出：

> [http://java.sun.com/docs/books/jls/third_edition/html/statements.html](http://java.sun.com/docs/books/jls/third_edition/html/statements.html) 说：“每个局部变量声明语句都立即包含在一个块中。” 语句中的 `if`那些没有括号，因此它们不在一个块中。

另请注意，我的另一个示例：

```
((Square) other).doSomething() 
```

编译没有错误。

**编辑：**但我认为我们已经确定（虽然这是对模糊边缘情况的有趣深入研究），无论你试图做什么，你都没有正确地做到这一点。那么你到底*想做*什么？

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-02T17:19:55.160

以下代码*是*合法的：

```
int x = 5;
int y = 2;
int z = 0;

if (x == y)
  z = x * y;
else
  z = y - x; 
```

正如 Sean Bright 所提到的，您的问题是您正在尝试测试非布尔表达式。您应该在子句中使用`==`运算符而不是`=`运算符。`if`

`if-then-else`另一件要提到的事情是，许多人认为在语句中跳过使用花括号是不好的做法。它可能会导致错误，例如在`if`或`else`代码块的主体中​​添加另一条语句。这是一种可能很难弄清楚的错误类型。

使用`if-else`语句时这并不是真正的问题，因为 Java 会将其捕获为语法错误（`else`没有前面的语句`if`）。但是，请考虑以下`if`语句：

```
if (x == y)
  z = y * x; 
```

现在，假设稍后如果`x == y`. 您可以轻松地执行以下操作而不会意识到错误。

```
if (x == y)
  z = y * x;
  w = x * y - 5; 
```

当然，无论语句测试`w = x * y - 5`的结果如何，都会执行第二条语句。`if`如果你一开始就有花括号，你就会避免这个问题。

```
if (x == y) {
  z = y * x;
  w = x * y - 5; // this is obviously inside the if statement now
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-02T17:25:18.643

请始终查阅[JavaTM 编程语言的代码约定](http://java.sun.com/docs/codeconv/html/CodeConvTOC.doc.html)：

具体参见[第 7 章第 4 节](http://java.sun.com/docs/codeconv/html/CodeConventions.doc6.html#449)：

> **注意：** if 语句总是使用大括号 {}。避免以下容易出错的形式：
> 
> ```
> if (condition) //AVOID! THIS OMITS THE BRACES {}!
>     statement; 
> ```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-02T17:26:19.173

如果你想要一个单行，如果那是一个表达式，你可以使用三元运算符

```
 final int myVal = predicate ? consequent : alternative; 
```

这与

```
 final int myVal;
  if(predicate)
    myVal = consequent;
  else
    myVal = alternative; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-02T17:36:35.253

编辑：为了更清楚，这是你的问题：

这：

```
if (other instanceof Square)
    Square realOther = (Square) other;
else
    Rectangle realOther = (Rectangle) other; 
```

与此完全相同：

```
if (other instanceof Square) {
    Square realOther = (Square) other;
} else {
    Rectangle realOther = (Rectangle) other;
} 
```

请注意，您永远不会对 realOther 做任何事情。您在那里定义它，但由于它的范围仅限于那组大括号，因此您在碰到右大括号时就将其丢弃。

不包括大括号没有帮助，事实上它是一个语句（在 if 之后）使它成为一个独立的代码块，只要该块退出，“realOther”就会被丢弃。

Java 认识到这种情况并告诉您（草率地引用 Inigo Montoya）“我不认为这意味着您认为它意味着什么”。

第二个问题，Java 是强类型的。即使它可能允许像你说的那样的语法，在这个 if 语句之后，它必须具有 realOther 的绝对最终类型。您的 if 语句将完全打破 java 的大脑，因为它不知道 realOther 应该被视为矩形还是正方形。

假设矩形有一个 setWidth 和 setHeight 方法（而方形只有一个 setHeight）。在这个 IF 语句之后，Java 是否应该允许您调用 setWidth？Java 必须在编译时知道这些事情（如果不知道，我们就不需要强制转换）。

另一个编辑：

要修复它，您可以使用以下命令：

```
// class Rectangle extends Square
// Both implement setHeight, Rect also implements setWidth.
public void reSize(Square other, int h, int w) {
    other.setHeight(h);

    if (realOther instanceof Rectangle) {
        ((Rectangle)realOther).setWidth(w);
} 
```

换句话说，您应该使用相关对象的方式是尽可能长时间地将它们作为更抽象的对象，仅当您需要调用该对象的方法时才使用特定对象。

如果你编码正确，你几乎总是可以使用更抽象的，而很少使用具体的。使用 square 和 rect，这并不明显，square/rect 是一个相当草率的问题，它被用作您必须在 OO 编程中做出的一些艰难决定的示例，但它确实几乎一直都有效——我很少需要投...

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-02T17:20:50.930

这是可能的（除了@Sean 指出的错字/错误），但根据您遵循的代码指南，它被认为是错误的形式。

我通常遵循的代码指南（无论是在工作中还是在我决定的私人项目中）都禁止没有块的单个语句（即每个 if/while/for 都需要一个块）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-02T18:25:11.393

你的代码是这样的吗？

```
if (other instanceof Square)
  Square realOther=(Square) other;
else
  Rectangle realOther=(Rectangle) other;

//...

realOther.doSomething(); 
```

问题是在 Java 中，不像 PHP，在语句`realOther`之外不存在。`if`是什么类型的`other`？是`Object`吗？如果是这样，Square 和 Rectangle 是否有共同的基类或接口？（`Shape`也许？）如果是这样，你应该做更多这样的事情：

```
Shape realOther = null;
if(other instanceof Shape)
  realOther = other;

//...

if(realOther != null)
  realOther.doSomething(); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-02T17:18:11.623

是的，但是您需要在 if-else 之间保留分号，如下所示：

```
if (true) System.out.println("true"); else System.out.println("false"); 
```

此外，请确保将比较运算符修复为`==`.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-02T17:23:56.930

仅仅因为你可以做某事并不意味着你应该做。

考虑添加日志记录时会发生什么：

```
if (x==y)
   z=x*y;
else
  System.out.println("Values weren't equal);
  z=y-x; 
```

惊喜！“z”永远不会等于 x * y。虽然您可能认为省略括号会使您的代码更具可读性，但它会降低安全性。我之所以这么说，是因为我不得不对大量具有相同缺陷的代码进行故障排除。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-02T17:30:45.107

我总是使用大括号，因为有些语言允许使用大括号，有些则不允许，而且我永远无法让它们保持直线。也许我太老了，也许我知道太多语言。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-02T18:15:06.580

我必须同意 Bill K...“你不能在 if 语句中说‘Square realOther’，因为你在单行代码的范围内声明它，它会在 if 语句的末尾消失。”

考虑预先将 realOther 定义为 Object，然后简单地将 realOther 与 = (Square) other; / =（矩形）其他；

不过，地方性是你的问题。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-02T19:41:18.590

让您的代码使用大括号，然后删除它们。如果你正在学习新的东西，你应该一次做一件事。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-05-22T19:51:35.340

你也可以这样写一行 if then else 语句：

```
z = (x == y)? x*y : y-z; 
```

# .net - WPF、Windows 窗体或其他？

> ID：504014
> 
> 赞同：14
> 
> 时间：2009-02-02T17:15:57.337
> 
> 标签：.net, wpf, winforms, architecture

我们即将着手开发一种新产品。我们当前的产品是使用 VB.NET 编写的传统客户端-服务器 Windows 窗体应用程序。

**WPF 准备好用于业务应用程序了吗？** 从我所见，使用 WPF 开发用户界面似乎比使用 Windows 窗体更难。但我认为速度伴随着经验。不过，我有点担心 WPF 可能不会流行起来。

**我们应该继续使用 Windows 窗体吗？** 如果我们继续使用 Windows 窗体，我们是否将自己贬低为开箱即用的弃用？我认为上市速度会更快，但 Windows 窗体在五年内还会出现吗？

**我们是否应该从 Microsoft 产品中迁移出去？** 我们所有的开发人员都是 .NET 开发人员，因此迁移到另一个开发环境可能是不可能的。

我希望我有一个水晶球。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-02T17:27:32.447

我们冒险并完全在 WPF 中构建了我们最新的桌面电子商务包（除了报告，我们使用 ReportViewer 进行互操作）。我没有一天后悔过。WPF 的声明式方法对每个人来说都很容易掌握，它有助于强制将 UI 与业务逻辑分离。

也就是说，如果您的团队有很多 WinForms 经验，那么花时间学习 WPF 可能会适得其反。

如果这不是问题，请尝试 WPF，也许您会上瘾。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-02T17:22:46.730

1.  WPF 在最近的几个 MS 应用程序中使用，包括 Visual Studio 2010，因此我认为在您自己的应用程序中使用它是“安全的”。开发速度当然取决于您对工具及其功能的熟悉程度。

2.  [Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)肯定会在五年内出现。

3.  如果您正在构建一个旨在在 Windows 桌面上运行的产品，那么您将很难找到比[.NET](http://en.wikipedia.org/wiki/.NET_Framework)更好的东西，尤其是考虑到它是您已经知道的。如果您认为有一天可能需要 Mac 或 Linux 端口，您可能需要考虑替代方案。即便如此，随着[Mono](http://en.wikipedia.org/wiki/Mono_%28software%29)不断改进并且没有*立即*计划这样的移植，.NET 看起来还是不错的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-03T14:08:40.663

WPF 实际上比 Windows 窗体更易于使用，只是完全不同。一旦您了解了[XAML](http://en.wikipedia.org/wiki/Extensible_Application_Markup_Language)的强大功能以及您可以使用数据绑定、样式和动画做什么，您就再也不想回到将控件拖动到 Windows 窗体设计器中了。

只需习惯您必须手动编写 XAML 而不是使用可视化设计器的想法。Visual Studio 2008 中内置的 XAML 设计器是垃圾，[Expression Blend](http://en.wikipedia.org/wiki/Microsoft_Expression_Blend)更好，但它非常面向设计器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T17:22:12.253

在我选择的平台（Windows 窗体或 WPF）中，我的主要问题是将应用程序安装在客户的 PC 上。

我们的客户主要是大公司。因此，我们必须安装的每一个额外组件都意味着批准时间框架的延迟。

所以我选择了 .NET 2.0 和 Windows Forms，因为这将预装在我必须安装的所有 PC 的 90% 中。

如果您的客户是家庭/最终用户，那么最精美的 UI (WPF) 可能值得一看。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T17:24:49.317

@GvS：这没什么实际意义，因为我几乎肯定 3.0/3.5 已经自动更新了一段时间。但需要注意的是，Windows 2000 下不支持 WPF。

要考虑的另一点是 WPF 和[Windows 窗体](http://en.wikipedia.org/wiki/Windows_Forms)控件不可互换。如果你对 Windows Forms 控件有较大的投资，它们在 WPF 中的一个 Windows Forms 包装器中可以在一定程度上使用它们，但它是非常不同的。

# c# - Variable declaration not resolving as expected

> ID：504027
> 
> 赞同：2
> 
> 时间：2009-02-02T17:19:59.607
> 
> 标签：c#, codedom

Using CodeDom in C#, I am trying to generate the following for loop:

```
for (int i = 0; i < ds.Tables[0].Rows.Count; i = (i + 1)) 
```

Except that my code is generating this:

```
for (int i; (i < ds.Tables[0].Rows.Count); i = (i + 1)) 
```

Note that this does not initialize i to zero, which does not compile in C#. (VB does accept this).
So I have to go in later after the code is generated and fix it manually, which is mostly just annoying, but I'd like to fix it. The code to generate the entire statement is as follows:

```
CodeVariableDeclarationStatement idx = new CodeVariableDeclarationStatement(new CodeTypeReference("System.Int32"), "i", new CodePrimitiveExpression(0));
        CodeIndexerExpression dsIndex = new CodeIndexerExpression(new CodeVariableReferenceExpression("ds.Tables"), new CodeExpression[] { new CodePrimitiveExpression(0) });
        CodeBinaryOperatorExpression comp = new CodeBinaryOperatorExpression(new CodeVariableReferenceExpression("i"), CodeBinaryOperatorType.LessThan, new CodePropertyReferenceExpression(dsIndex, "Rows.Count"));
        CodeAssignStatement incr = new CodeAssignStatement(new CodeVariableReferenceExpression("i"), new CodeBinaryOperatorExpression(new CodeVariableReferenceExpression("i"), CodeBinaryOperatorType.Add, new CodePrimitiveExpression(1)));
        CodeIterationStatement iterator = new CodeIterationStatement(idx, comp, incr); 
```

According to [MSDN](http://msdn.microsoft.com/en-us/library/system.codedom.codevariabledeclarationstatement.aspx) this is the way to initialize a value, unless there's something subtle I'm missing. Can anybody help?

**Edit:** The code is correct. It turns out another project in the solution was referencing a Redgate-SQL library that had an expired license, and it was somehow preventing my updates from getting deployed correctly. Thanks for your help and time.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T17:38:08.010

It seems to work well on my machine.

Returns:

```
for (int i = 0; (i < ds.Tables[0].Rows.Count); i = (i + 1)) {
} 
```

What version of the framework are you using?

# javascript - JavaScript 字节序编码？

> ID：504030
> 
> 赞同：12
> 
> 时间：2009-02-02T17:21:18.917
> 
> 标签：javascript, encoding, bit-manipulation, endianness

[对 SO 的回应](https://stackoverflow.com/questions/503052/javascript-is-ip-in-one-of-these-subnets/503238#503238)让我想到，JavaScript 是否保证跨操作系统和浏览器的某种字节序编码？

或者换句话说，在 JavaScript 中整数“安全”的按位移位？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-02-02T17:35:46.533

移位是安全的，但你的问题是有缺陷的，因为字节顺序不会影响移位操作。在所有语言的大端和小端系统上，左移是相同的。（右移可能不同，但仅是由于符号位的解释，而不是任何位的相对位置。）

只有当您可以选择将某些内存块解释为字节或更大的整数值时，字节序才会发挥作用。一般来说，Javascript 不会为您提供该选项，因为您无法访问任意内存块，尤其是变量占用的内存块。[类型化数组](http://www.khronos.org/registry/typedarray/)以字节序敏感的方式提供数据视图，但顺序取决于主机系统；对于所有可能的 Javascript 主机环境，它不一定相同。

字节序描述的是*物理*存储顺序，而不是*逻辑*存储顺序。从逻辑上讲，最右边的位*始终*是最低有效位。该位的字节是否是位于最低内存地址的字节是一个完全独立的问题，只有当您的语言公开诸如“最低内存地址”这样的概念时才重要，而 Javascript 没有。类型化数组可以，但仅限于类型化数组的上下文中；他们仍然不提供对任意数据存储的访问。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2012-12-05T22:39:00.850

其中一些答案已经过时，因为在使用类型化数组时字节序*可能是相关的！*考虑：

```
var arr32 = new Uint32Array(1);
var arr8 = new Uint8Array(arr32.buffer);
arr32[0] = 255;
console.log(arr8[0], arr8[1], arr8[2], arr8[3]); 
```

当我在 Chrome 的控制台中运行它时，它会产生`255 0 0 0`，表明我的机器是 little-endian。但是，[类型化数组默认使用系统字节序](http://www.ecma-international.org/ecma-262/6.0/#sec-typedarray-objects)，因此您可能会看到`0 0 0 255`您的机器是否为大字节序。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-02T17:23:27.900

是的，他们是安全的。[尽管由于 JS 位操作是“黑客](http://www.hunlock.com/blogs/The_Complete_Javascript_Number_Reference#quickIDX4)” ，因此您没有获得您可能希望的速度优势。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-02T17:44:07.997

ECMA 脚本确实有整数类型的概念，但它在必要时被隐式强制转换为双精度浮点值或从双精度浮点值强制转换（如果表示的数字太大或如果它具有小数部分）。

许多主流的 Javascript 解释器（SpiderMonkey 就是一个例子）在实现中采取了一种捷径，将所有数值解释为双精度值，以避免检查每条指令的值的实际本机类型。作为实现 hack 的结果，位操作被实现为强制转换为整数类型，然后再强制转换为双精度表示。因此，在 Javascript 中使用位级操作并不是一个好主意，而且无论如何您都不会获得性能提升。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-02T17:31:57.600

> JavaScript中整数的按位移位是“安全的”吗？

仅适用于适合 32 位（31+符号）的整数。不像 Python，你不能得到 1<<40。

这就是 ECMA-262 定义按位运算符工作的方式，即使 JavaScript 数字实际上是浮点数。（从技术上讲，双精度浮点数，为您提供 52 位尾数，足以轻松覆盖 32 位整数的范围。）

在按位算术中不存在“字节顺序”问题，并且 JavaScript 中没有内置可能涉及字节顺序的字节存储格式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T17:24:04.683

JavaScript 没有整数类型，只有浮点类型。您永远无法接近实现细节来担心这一点。

# svn - 在 SVN 或其他版本控制系统中复制 Sourcesafe 的链接能力？

> ID：504034
> 
> 赞同：5
> 
> 时间：2009-02-02T17:22:54.483
> 
> 标签：svn, version-control, visual-sourcesafe

目前我的团队使用 Visual Sourcesafe，并且非常熟悉第一手的 GUI 是多么可怕，并且听到了互联网上关于它有多不可靠的说法，我一直在努力推动转向 SVN。

今天我和经理讨论了他支持的最终举措，他问是否可以在 SVN 中创建 sourcesafe 样式的链接。对于不熟悉 sourcesafe 的人来说，链接在概念上与 Linux 下的文件链接相同。我们使用它们来链接项目之间的共享代码/库。我解释说没有办法使用 SVN 创建链接，他提出这可能是迁移的主要症结所在。

我告诉他，在我本地的 SVN 中（我一直在简化我的开发，只在 sourcesafe 中定期检查），我将共享代码/库放在一个位置，并将 ANT 引用到该位置。但是，我感觉到他对这个解决方案并没有留下深刻的印象，因为它增加了 ANT 任务的复杂性。就我个人而言，我认为拥有一个稍微复杂一点的 ANT 脚本而不是在源代码管理中拥有一堆链接文件是值得的，但这确实是您订阅哪种范例的问题。

我很好奇广大开发人员是如何解决这个限制的，以及像 Git 和 Mercurial 这样的更新的源代码控制系统支持链接吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-02T17:28:05.503

查看[`svn:externals`](http://svnbook.red-bean.com/en/1.0/ch07s03.html)属性。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T18:09:38.273

我们使用 TFS 进行版本控制，而 TFS 也没有 VSS 链接功能。我们已经消除了所有链接文件。之前链接的所有类文件都已放入类库中，这些类库作为解决方案中的共享项目引用共享给我们的其他项目。所以本质上你共享库，而不是类文件。

有一些调整过程习惯了这一点，但从那时起我就没有错过任何链接。通过像这样设置代码，它确实促进了更好的设计实践。仅在一个项目中使用类有助于避免破坏性更改，因为测试更改的影响要容易得多（使用链接，您甚至可能不知道更改是否导致编译问题）。当您不必担心链接文件时，更好的源代码控制系统的一些功能（如强大的分支和合并支持）工作得更好。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-17T07:55:56.177

当源文件应该在不同平台（.NET、Silverlight、.NetCF）之间共享时，链接很有用，因为源文件可能是相同的，因此可以共享，但编译的库不能在这些平台之间共享。

# .net - .NET 中的全局与单例

> ID：504036
> 
> 赞同：5
> 
> 时间：2009-02-02T17:23:00.117
> 
> 标签：.net, singleton, global

我这里有一个很常见的情况。多年来我一直没有发现我正在做的事情是否符合行业标准。考虑一个连接到数据库的应用程序，但是连接字符串而不是存储在某些文件/设置中作为命令行参数传递在启动时或在应用程序启动时浏览数据库。

那么有必要将该连接字符串保存在应用程序范围内的某个位置。我见过的最常见的方法是使用 get/set 方法保存连接字符串的模块或全局类。我会这样做的另一种方法是使用单例。我的 DAL 可以在需要时通过 GetConnectionString 方法访问连接字符串。

有更好的方法吗？

**更新：**我没有配置文件，即使我有，我也需要在应用程序实例的生命周期内读取一次连接字符串。您能否详细说明“将其注入任何类”部分

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-02T17:31:09.723

一般来说，全局状态，无论是全局类还是单例，都应该尽可能避免。

理想的解决方案是让您的应用程序从配置中加载连接字符串并将其[注入](http://en.wikipedia.org/wiki/Dependency_injection)任何需要它的类中。根据应用程序的大小，像[Unity](http://www.codeplex.com/unity)或[Castle Windsor这样的](http://www.castleproject.org/container/index.html)[IoC](http://en.wikipedia.org/wiki/Inversion_of_control)容器可以提供帮助，但肯定不是解决方案的必需部分。

如果这不是一个选项，并且您坚持维护全局状态（由于现有的代码库或其他原因），我不知道您建议的两种方法之间存在巨大差异。

**更新：**澄清一下，暂时忘记有关 IoC 容器的所有内容，“注入”只是“作为参数传入”的一种奇特方式（传递给类的构造函数，或通过属性，或其他方式）。

与其让数据访问类必须请求连接字符串（来自某种全局或单例），不如让它通过构造函数或属性传入。

**更新#2：**我认为对于这种方法的含义仍然存在一些误解。

它基本上归结为您的数据访问类是否如下所示：

```
public class DataAccessClass
{
    public DataAccessClass()
    {
        _connString = SomeStaticThing.GetConnectionString();
    }
} 
```

或者

```
public class DataAccessClass
{
    public DataAccessClass(string connString)
    {
        _connString = connString;
    }
} 
```

[这些](http://misko.hevery.com/2008/08/25/root-cause-of-singletons/) [文章](http://googletesting.blogspot.com/2008/12/static-methods-are-death-to-testability.html)（事实上，该博客中的许多文章）详细说明了后者优于前者的一些原因（尤其是因为前者几乎不可能进行单元测试）。

是的，在*某些地方*，首先必须有一些静态人员负责获取连接字符串，但关键是您对静态方法的依赖仅限于那个位置（这很可能是您的引导应用程序过程中的主要方法），而不是散布在整个代码库中。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-02T18:38:31.680

很高兴看到这么简单的问题有这么多创造性的解决方案；-)

来自OP问题的显着事实：

1.  连接字符串在命令行上传递
2.  许多其他组件可能需要使用连接字符串

所以，*没有办法绕过使用静态元素*；无论是全局变量（在 .NET 中很难做到，真的，没有封闭类）、静态类还是单例都无关紧要。最短路径解决方案是由处理命令行的 Program 类初始化的静态类。

*每个其他解决方案仍然需要对传入的 connect-string 进行静态访问*，尽管它们可能会将其隐藏在一个或多个间接层之后。

我并不是说您不想用更花哨的东西来修饰基本解决方案，但这不是必需的，它并没有消除*所描述*的连接字符串的基本静态/全局性质。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-02T17:31:42.517

如果您要存储的只是一个字符串（可能还有一堆其他全局应用程序设置），我只会使用一个带有一堆属性的静态类来保存所有这些。单例需要更多的代码和维护工作，但在这种情况下这是不必要的工作，因为您的属性类不会做任何事情；只是拿着东西。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-02T17:33:52.807

当然有办法。首先，了解[依赖注入](http://martinfowler.com/articles/injection.html)和类似技术的速度，并阅读有关[服务层](http://martinfowler.com/eaaCatalog/serviceLayer.html)的信息，因为这就是您在这里所需要的。

就服务层而言，您需要某种配置服务，它将是您的应用程序的一部分将查询配置信息的模块 - 连接字符串、URI 等：

```
interface IConfigurationService
    string ConnectionString
    bool IntegratedSecurity
    bool EncryptProfiles 
```

您的系统中只有一个实例应该非常简单`IConfigurationService`，但这是通过选择的 DI 容器实现的，而不是使用单例模式。

接下来，您的所有 DAL 服务都将获得对以下内容的引用`IConfigurationService`：

```
class FooDal : IFooDal
    IConfigurationService ConfigurationService 
```

以便他们现在可以使用`IConfigurationService.ConnectionString`来获取连接字符串。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T17:35:11.480

这取决于。

请记住，单例：

*   强制该类的一个实例将存在，并且
*   提供全球访问

全局只提供全局访问，但不保证实例化的数量。

最后的选择当然是使用局部变量。也就是说，将配置信息作为参数传递给构造函数或任何需要的地方。

在前两者之间进行选择应该有点容易。如果该类的两个实例存在，那会是一场灾难吗？我会说可能不会。我可能想实例化我自己的配置类来为应用程序的一个特定组件提供单独的选项，或者初始化我的单元测试。

在极少数情况下，您*需要*保证只存在一个实例。出于这个原因，全局可能是比单例更好的选择。

本地和全球之间的选择比较棘手。全局可变状态通常最好避免。*不可变*状态的问题较小，并且不会导致与全局可变状态相同的同步/并发/可伸缩性问题。

但通常，最好将其作为局部变量传递给需要它的组件。这可以手动完成，只需将其传递给需要 DB 访问的对象的构造函数，或者在某种程度上可以使用 IoC 容器自动化。

但无论如何，如果它不是全局的，那么你的代码就会变得更通用，更便携。*如果它对代码工作必须*存在的类和全局数据具有隐藏的依赖关系，那么它就不能轻易地在其他项目中使用，或者如果你过多地重构整个代码库。

单元测试也变得更加困难，因为代码甚至无法编译，除非存在一些我们理想情况下希望从测试中排除的外部数据。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T18:11:39.050

正如@Anton 所说，你需要有一个接口来暴露类似的东西

```
interface IConfigurationService
    string ConnectionString 
```

然后，每当您的类中的一个需要您的连接字符串时，您就可以在包含有效字符串的构造时为其提供 IConfigurationService 的实现。您需要在应用程序启动时（可能是您获得数据库地址的时间）找到一个有效的位置来创建您的实现，并将其传递给需要它的类。

尽管与单例或全局相比，这似乎需要做很多工作，但这会降低代码中的耦合度，从而提高可重用性并使单元测试更容易，并且一旦你说服自己全局（大部分）是邪恶的，那就非常简单了 :)

如前所述，有 IoC 容器将提供框架来执行此操作，但在您的情况下它可能有点矫枉过正，而且在将工作交给“魔术盒”之前为自己使用该模式很不错

# javascript - 在 JavaScript 中确定浏览器窗口的位置？

> ID：504052
> 
> 赞同：39
> 
> 时间：2009-02-02T17:27:27.923
> 
> 标签：javascript

由于各种愚蠢的原因，我希望能够在屏幕上检测浏览器窗口的矩形。标题栏和所有。

这是可能的，还是 JavaScript 仅限于其页面的视口？

**编辑：**我可能不清楚，但查看端口是窗口中可见的页面部分。这可能不是浏览器常用的术语，但在图形中很常见。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2009-02-02T17:37:23.673

对于符合标准的浏览器：

**X** - **Y** -[`window.screenX`](https://developer.mozilla.org/en/DOM/window.screenX)
**[`window.screenY`](https://developer.mozilla.org/en/Window.screenY)**

 **对于 IE：

**X** - **Y** -[`window.screenLeft`](http://msdn.microsoft.com/en-us/library/ms534389(VS.85).aspx)
**[`window.screenTop`](http://msdn.microsoft.com/en-us/library/ms534390(VS.85).aspx)**

 **请记住，[实现方式各不相同](http://www.quirksmode.org/dom/w3c_cssom.html)。小心多显示器设置...

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-02T17:53:47.887

看看以下属性：

*   [window.screen.height](https://developer.mozilla.org/en/DOM/window.screen.height)：返回屏幕的高度（以像素为单位）。
*   [window.screen.top](https://developer.mozilla.org/en/DOM/window.screen.top)：返回与当前屏幕顶部的距离（以像素为单位）。
*   [window.screen.width](https://developer.mozilla.org/en/DOM/window.screen.width)：返回屏幕的宽度。
*   [window.screen.left](https://developer.mozilla.org/en/DOM/window.screen.left)：返回从主屏幕左侧到当前屏幕左侧的距离（以像素为单位）。

（这些不会为您提供窗口大小或位置，但可以让您在具有多个显示器的系统上操作时正确解释它们）

* * *

## 回答 #3

> 赞同：-8
> 
> 时间：2009-02-02T17:30:07.543

从谷歌第一个结果复制粘贴：

```
// Browser Window Size and Position
// copyright Stephen Chapman, 3rd Jan 2005, 8th Dec 2005
// you may copy these functions but please keep the copyright notice as well
function pageWidth() 
{
return window.innerWidth != null? window.innerWidth : document.documentElement && document.documentElement.clientWidth ?  document.documentElement.clientWidth : document.body != null ? document.body.clientWidth : null;
} 
function pageHeight() 
{
return  window.innerHeight != null? window.innerHeight : document.documentElement && document.documentElement.clientHeight ?  document.documentElement.clientHeight : document.body != null? document.body.clientHeight : null;
} 
function posLeft() 
{
return typeof window.pageXOffset != 'undefined' ? window.pageXOffset :document.documentElement && document.documentElement.scrollLeft ? document.documentElement.scrollLeft : document.body.scrollLeft ? document.body.scrollLeft : 0;
} 
function posTop() 
{
return typeof window.pageYOffset != 'undefined' ?  window.pageYOffset : document.documentElement && document.documentElement.scrollTop ? document.documentElement.scrollTop : document.body.scrollTop ? document.body.scrollTop : 0;
} 
function posRight() 
{
return posLeft()+pageWidth();
} 
function posBottom() 
{
return posTop()+pageHeight();
} 
```

# javascript - jQuery UI Sortable connectWith 日历上的加载时间性能

> ID：504059
> 
> 赞同：0
> 
> 时间：2009-02-02T17:28:20.090
> 
> 标签：javascript, performance, jquery-ui, jquery-ui-sortable, draggable

jQuery UI 可排序 + 可拖动 1.6rc5

我在做什么：创建具有不同日期范围的日历（例如：可能显示 1 周，可能显示 20 周）。此日历每天都有事件，事件可在当天本身以及可见日历上的所有其他日期之间排序。我的平均日历日期范围约为 10 周，其中包括大约 50 个事件。

问题：对于日历上的每一天，jQuery 的 Sortable 交互需要一定的时间来设置。可见的天数越多，jQuery 应该对其应用 Sortable，页面加载所需的时间就越多。加入选项“connectWith”以将所有日历日连接在一起作为交互的可排序列表。并且页面需要大约 10 倍的时间来加载。对于 10 周，50 事件示例，页面加载大约需要 50 秒。

代码：

日历代码如下所示：

```
<table ... id="main-calendar"...> 
<tbody> 
<tr ... class="calendarDaysRow"...> 
<td ... > 
<ul class="schedule-sortable"> 
<li>SORTABLE ITEMS HERE</li> ...  
</ul>
</td> ... 
</tr> ... 
</tbody>
</table> 
```

设置可排序交互：

```
jQuery("#main-calendar tbody tr.calendarDaysRow ul.schedule-sortable").sortable({ 
    connectWith: ["#main-calendar tbody tr.calendarDaysRow ul.schedule-sortable"]
}); 
```

我在寻找什么：页面加载时更快的加载/设置时间。我将继续查看可排序的源，但似乎没有很多可排序的选项可以优化交互设置时间。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-13T14:21:25.530

似乎没有更优化的方式来使用 jQuery 进行排序。UI 版本 1.7 中最好的方法是使用元素 ID 来访问元素。

# sql - Oracle删除与多个值匹配的行

> ID：504060
> 
> 赞同：28
> 
> 时间：2009-02-02T17:28:28.013
> 
> 标签：sql, oracle

我想做类似的事情：

```
DELETE FROM student WHERE
student.course, student.major IN
(SELECT schedule.course, schedule.major FROM schedule) 
```

但是，您似乎只能将一列与 IN 运算符一起使用。真的吗？似乎这样的查询应该是可能的。

* * *

## 回答 #1

> 赞同：51
> 
> 时间：2009-02-02T17:32:29.597

不，你只需要括号：

```
DELETE FROM student WHERE
(student.course, student.major) IN
(SELECT schedule.course, schedule.major FROM schedule) 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-02-03T11:17:31.553

您还可以使用 EXISTS 子句：

```
DELETE FROM student WHERE
EXISTS
(
  SELECT 1 FROM schedule 
  WHERE schedule.course=student.course 
  AND schedule.major=student.major
) 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-02T17:32:51.233

```
DELETE FROM student WHERE
(student.course, student.major) IN
(SELECT schedule.course, schedule.major FROM schedule) 
```

在 where 子句中将括号括起来。干杯!

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-02T22:19:51.547

在 Oracle 中，您可以从内联视图中执行删除操作，但它通常需要一个外键，以确保删除该行的表中的行不能由视图中的多行表示。

```
create table parent (id number primary key);
create table child (id number primary key, parent_id number references parent);
insert into parent values(1);
insert into child values(2,1);
delete from (select * from parent p, child c where c.parent_id = p.id); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-04-06T11:29:41.297

请注意，如果任何属性为空，则该行被认为不是 IN。也就是说，如果课程相同并且学生和日程专业都为空，则不会删除行。

如果某个属性（例如专业）可能为 null，并且您希望 null = null 为真，请尝试：

```
DELETE
FROM student
WHERE (student.course, NVL(student.major,'sOmeStRinG') )
IN (SELECT schedule.course, NVL(schedule.major,'sOmeStRinG') FROM schedule) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-02T17:37:10.850

下面的语法适用于 SQLServer ~~，但我相信它是标准 sql~~ ，但正如评论中指出的那样，这是非标准实现，Oracle 目前不支持。

我将其留作参考

```
delete s
from 
    student s 
    inner join schedule sch
    on s.course=sch.course 
    and s.major = sch.major 
```

# java - JSP 中的 EL 停止评估

> ID：504071
> 
> 赞同：2
> 
> 时间：2009-02-02T17:31:35.123
> 
> 标签：java, jsp, maven-2, jetty, el

在 JSP 页面（index.jsp）中：

```
${requestContext.requestURL} is the URL 
```

只显示表达式本身。它曾经被评估为“ [http://.../somerset/](http://.../somerset/) ”

我在 Eclipse 中使用 maven-archetype-webapp 原型创建了 Maven 项目。Jetty 版本是 jetty-6.1.14。

我的 web.xml 很简单：

```
<web-app>
    <display-name>Archetype Created Web Application</display-name>
    <servlet>
      <servlet-name>SomersetServlet</servlet-name>
      <display-name>SomersetServlet</display-name>
      <description></description>
      <servlet-class>com.foo.somerset.SomersetServlet</servlet-class>
    </servlet>
    <servlet-mapping>
      <servlet-name>SomersetServlet</servlet-name>
      <url-pattern>/som.do</url-pattern>
    </servlet-mapping>
</web-app> 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-02T18:05:05.677

由于某些可能的原因，请参阅[Javascript String.replace(/\$/,str) 在 jsp 文件中的工作异常。](https://stackoverflow.com/questions/472500/javascript-string-replace-str-works-weirdly-in-jsp-file/472573#472573)

您的 web.xml 应包含对 web-app_2_4.xsd 架构的引用，例如

```
<web-app xmlns="http://java.sun.com/xml/ns/j2ee"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee/web-app_2_4.xsd"
      version="2.4"> 
```

这启用了 servlet 2.4 和 jsp 2.0 处理，其中包括 EL。

Btw`requestContext`不是有效的隐式对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T17:37:10.883

不正确匹配的引号会导致这种行为，其中表达式只是被视为字符串。如果是这种情况，您的 IDE 通常会以不同的颜色突出显示它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T17:45:01.523

确保您有指令，以及您使用的其他库

```
<jsp:root ..... 
```

更多关于定义的信息在这里

[http://java.sun.com/products/jsp/tags/12/syntaxref123.html](http://java.sun.com/products/jsp/tags/12/syntaxref123.html)

# .net - System.Net.Mail.MailMessage 问题

> ID：504080
> 
> 赞同：1
> 
> 时间：2009-02-02T17:33:17.660
> 
> 标签：.net, asp.net, smtp

我将一些电子邮件功能放入我的一个 asp.net 项目中：

我需要向订阅者列表发送电子邮件，列表从几十到几百个订阅者不等 - （未来可能有数千个）。

当我有几十封电子邮件时，我会这样做：

```
Mailmsg.Bcc.Add(New System.Net.Mail.MailAddress("asample@gmail.com")) 
```

对于每个订户，它工作正常。

在您陷入困境之前，您可以通过这种方式添加的电子邮件地址数量的实际限制是多少？此外，如果您将 300 个电子邮件地址添加到“收件人”或“密件抄送”字段，将单个电子邮件拆分为单独电子邮件的工作在哪里进行？在你的 smtp 服务器上？

向您的电子邮件添加数十或数百个地址与让您的代码循环并一次发送一个地址的优点和缺点是什么。一种方法比另一种更有可能被标记为垃圾邮件吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T17:57:15.740

限制更多是由您的连接性和 SMTP 服务器驱动的......但是，您以错误的方式进行操作。一种被视为垃圾邮件的可靠方法是发送一封包含一堆密件抄送项目的电子邮件。为每个收件人发送一封电子邮件，并将他们作为收件人地址，您会过得更好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T19:39:14.600

**密件抄送缺点：**

使用密件抄送并不像它的名字所暗示的那样盲目。BCC 标头仍附加到发送的每条消息。这可能意味着您通过与其他收件人共享他们的电子邮件地址来损害收件人的隐私。您不应该指望接收服务器剥离密件抄送标头。

**System.Net.Mail**

您显然没有单独自定义电子邮件。如果您创建邮件并遍历您的地址列表，我怀疑您的邮件离开 SMTP 服务器所需的时间会比 BCC 方法长。您的 .net 代码将需要更长的时间来执行，但我怀疑 SMTP 服务器将成为瓶颈。我在这里说的没有经验证据，所以请对最后一点持保留态度。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T18:06:44.473

发送一堆带有 TO 地址的电子邮件的警告，一些 SMTP 服务器会根据您在 60 秒时间段内发送的电子邮件数量来切断您或限制您的传输速率，这完全取决于您的电子邮件服务器或 ISP。

# java - 除了命令行，我在哪里可以设置用于运行 Netbeans 的 JRE/JDK？

> ID：504087
> 
> 赞同：19
> 
> 时间：2009-02-02T17:35:02.137
> 
> 标签：java, netbeans, netbeans6.5

首先，我知道命令行参数，但我不想使用它，因为我想学习，而不仅仅是完成它，所以......

**在哪里可以设置用于运行 Netbeans 的 JRE/JDK？**

一点背景：

1.  我安装了JDK 1.6_10（系统是Windows Vista Business 64）
2.  我安装了 Netbeans 6.5
3.  几周后，我卸载了 Netbeans 6.5（我希望通过重新安装来解决一些问题）
4.  我还卸载了 JDK 1.6_10 并安装了 1.6_11。
5.  我重新安装了 Netbeans 6.5
6.  现在我无法启动 Netbeans，因为它坚持使用旧的 JDK。（尝试使用默认版本也不起作用。JAVA_HOME设置为1.6_11）

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-02-02T17:41:28.237

尝试在 {NetBeans 目录}/etc/netbeans.conf 中设置 netbeans_jdkhome。

> # JDK 的默认位置，可以使用 --jdkhome 覆盖：netbeans_jdkhome="..." # （省略路径，因为我在非标准位置有 Java）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-11-29T15:04:17.043

根据投票的答案，这就是我在 Mac 上所做的事情，而且效果很好......

```
(download JDK from Oracle)
$ vi /Applications/NetBeans/NetBeans\ 8.2.app/Contents/Resources/NetBeans/etc/netbeans.conf
[...]
#netbeans_jdkhome="/Applications/NetBeans/NetBeans 8.2.app/Contents/Resources/NetBeans/bin/jre"
netbeans_jdkhome="/Library/Java/JavaVirtualMachines/jdk1.8.0_112.jdk/Contents/Home/" 
```

# .net - Google Maps API/Geocoding - 我可以通过仅传递邮政编码来检索响应吗？

> ID：504089
> 
> 赞同：1
> 
> 时间：2009-02-02T17:35:43.163
> 
> 标签：.net, google-maps

问候：

我在 .NET 3.5 中组合了一个 RESTful Web 服务，它接受一个电话号码并进行反向查找以检索该位置的邮政编码。我现在正在创建一个 *.aspx 页面，它将向 Google Maps API 呈现请求的输出。此输出将是地图上的一个多边形，该多边形将是美国邮政编码。我想知道我是否可以只在地址参数的 http 请求中传递该邮政编码。[http://code.google.com/apis/maps/documentation/geocoding/](http://code.google.com/apis/maps/documentation/geocoding/)上的示例基本上传入了整个街道地址。不太确定 ZIP 是否足够。

有谁有过这方面的工作经验？

提前致谢！

托德

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T17:43:23.163

只传递邮政编码应该可以正常工作。

[向http://maps.google.com/maps/geo](http://maps.google.com/maps/geo?q=63131&output=json&oe=utf8&sensor=false)**发出请求？[**q=63131**](http://maps.google.com/maps/geo?q=63131&output=json&oe=utf8&sensor=false) [&output=json&oe=utf8&sensor=false](http://maps.google.com/maps/geo?q=63131&output=json&oe=utf8&sensor=false)在 ExtendedData 属性中使用 LatLonBox 为您提供有效结果。您必须手动转到该 URL，因为如果没有 API 密钥的请求有引用 URL，Google 会拒绝这些请求。**

 *** * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-06-24T18:38:38.947

这是我使用的一些代码，我只传递了一个邮政编码，它工作正常。

```
var map = null;
  var geocoder = null;
  var address = "SW1A 0AA";

  function initialize() {
    if (GBrowserIsCompatible()) {
      map = new GMap2(document.getElementById("map_canvas"));
      map.addControl(new GSmallMapControl());
      map.addControl(new GMapTypeControl());
      map.setMapType(G_HYBRID_MAP);
      geocoder = new GClientGeocoder();

        if (geocoder) {
            geocoder.getLatLng(
              address,
              function(point) {
                  map.setCenter(point, 13);
                  var marker = new GMarker(point);
                  map.addOverlay(marker);
              }
            );
          }
    }
  } 
```

# printing - XPS Document Print Tiling

> ID：504091
> 
> 赞同：0
> 
> 时间：2009-02-02T17:36:29.557
> 
> 标签：printing, xps

Currently I have an XPS document whose width is too large for the paper. I would like it to print the clipped off contents on additional pages. I have not been successful at finding a setting to accomplish this.

Any ideas for a solution?

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-30T21:23:00.763

您可以通过使用 PrintTicket 或使用 PrintQueue 来控制它。XpsDocument（除了 PrintTicket）中没有任何东西可以控制打印机如何处理这个问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-26T21:03:57.133

博伊德，

从 Visual Studio DGML 图创建的 XPS 文档也有同样的问题。我的解决方案的部分内容是在[http://craigwatson1962.wordpress.com/2010/11/26/convert-an-xps-to-jpeg-png-tiff-or-bmp-in-a4-pages /](http://craigwatson1962.wordpress.com/2010/11/26/convert-an-xps-to-jpeg-png-tiff-or-bmp-in-a4-pages/) 此解决方案将 XPS 平铺成多个 A3 或 A4 页面以图形文件格式，或平铺成 TIFF 文件中的多个页面。

# jquery - JQuery，$（this）在fadeIn，fadeOut回调函数中不正确？

> ID：504102
> 
> 赞同：2
> 
> 时间：2009-02-02T17:39:13.953
> 
> 标签：jquery

我想在页面上淡入淡出（）图像并在动画完成后将其从 DOM 中删除。听起来很容易？

示例代码（图像的 id 为“img1”）：

```
   $("#img1").fadeOut("slow", function() { $(this).remove() });

```

这不起作用。当我使用 Firebug 检查页面时，图像仍然存在。它只是隐藏的。

第二个示例应该使图像闪烁：

```
   $("#img1").fadeOut("slow", function() { $(this).fadeIn() });

```

奇怪的。

* * *

感谢您提供的示例页面，它们运行良好且符合预期。

问题一定是其他的，并且只发生在我的项目环境中。

旁注：当我在回调函数中执行简单的 console.log($(this)) 时，结果是窗口对象本身？！

当我发现什么副作用会造成问题时，我会更新这个问题。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T17:52:01.337

这两个示例都按我的预期工作，如此处所示[（](http://jsbin.com/exacu)为糟糕的形象道歉，这是我发现的第一件事！）。Image 1 淡出然后从 DOM 中删除，Image2 淡出然后回到 Image1 最初放置的位置。

我对你的理解正确吗？

PS您可以在[此处编辑示例](http://jsbin.com/exacu/edit)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-04T13:52:12.313

> Query 支持链接，这意味着您可以使用以下命令获得相同的东西：
> 
> $('#img1').fadeOut('slow').remove(); $('#img1').fadeOut('slow').fadeIn('slow');
> 
> 它看起来更好，它会工作=）

```
$('#img1').fadeOut('slow').fadeIn('slow'); 
```

会起作用，因为 jQuery 会将效果排队，但是当你调用

```
$('#img1').fadeOut('slow').remove(); 
```

框架将在后台运行 fadeOut 并在对象开始淡出之前执行 remove()

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T17:54:30.910

它为我工作。Firebug 1.2.1 中的 HTML Inspector 清楚地显示了被删除的元素。也许您没有使用最新的 JQuery？

我的测试代码如下：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <script src="http://code.jquery.com/jquery-latest.js"></script>
  <script>
  $(document).ready(function(){

    $("p").click(function () {
      $("p").fadeOut("slow", function()
      {
         $(this).remove();
      });
    });

  });
  </script>
  <style>
  p { font-size:150%; cursor:pointer; }
  </style>
</head>
<body>
  <p>
    If you click on this paragraph
    you'll see it just fade away.
  </p>
</body>
</html> 
```

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-02-02T17:52:19.387

jQuery 支持链接，这意味着您可以使用以下命令获得相同的东西：

```
$('#img1').fadeOut('slow').remove();
$('#img1').fadeOut('slow').fadeIn('slow'); 
```

它看起来更好，它会工作=）

# java - 如何在 Java 中编写正确的微基准测试？

> ID：504103
> 
> 赞同：943
> 
> 时间：2009-02-02T17:39:41.690
> 
> 标签：java, jvm, benchmarking, jvm-hotspot, microbenchmark

您如何在 Java 中编写（和运行）正确的微基准测试？

我正在寻找一些代码示例和注释来说明要考虑的各种事情。

示例：基准测试应该测量时间/迭代还是迭代/时间，为什么？

相关：[秒表基准测试是否可以接受？](https://stackoverflow.com/questions/410437/is-stopwatch-benchmarking-acceptable)

* * *

## 回答 #1

> 赞同：842
> 
> 时间：2009-02-04T20:49:28.043

[Java HotSpot 的创建者](https://wiki.openjdk.java.net/display/HotSpot/Main)关于编写微基准测试的提示：

**规则 0：**阅读有关 JVM 和微基准测试的著名论文。一个不错的是[Brian Goetz，2005 年](http://www.ibm.com/developerworks/java/library/j-jtp02225)。不要对微基准有太多期望；它们仅测量有限范围的 JVM 性能特征。

**规则 1：**始终包含一个预热阶段，它会一直运行您的测试内核，足以在计时阶段之前触发所有初始化和编译。（在预热阶段，较少的迭代是可以的。经验法则是数万次内循环迭代。）

**规则 2：**始终使用 、 等运行`-XX:+PrintCompilation`，`-verbose:gc`因此您可以验证编译器和 JVM 的其他部分在您的计时阶段没有做意外的工作。

**规则 2.1：**在计时和预热阶段的开始和结束时打印消息，以便您可以验证在计时阶段没有来自规则 2 的输出。

**规则 3：**注意`-client`和`-server`、 和 OSR 与常规编译之间的区别。该`-XX:+PrintCompilation`标志使用 at 符号报告 OSR 编译以表示非初始入口点，例如：`Trouble$1::run @ 2 (41 bytes)`. 如果您追求最佳性能，则首选服务器而不是客户端，并且经常使用 OSR。

**规则 4：**注意初始化效果。不要在计时阶段第一次打印，因为打印会加载并初始化类。不要在预热阶段（或最终报告阶段）之外加载新类，除非您正在专门测试类加载（并且在这种情况下仅加载测试类）。规则 2 是您抵御此类影响的第一道防线。

**规则 5：**注意反优化和重新编译的影响。在计时阶段第一次不要采用任何代码路径，因为编译器可能会根据先前的乐观假设，即根本不会使用该路径，从而产生垃圾并重新编译代码。规则 2 是您抵御此类影响的第一道防线。

**规则 6：**使用适当的工具来读懂编译器的想法，并期望对它产生的代码感到惊讶。在形成关于什么使某事变得更快或更慢的理论之前，自己检查代码。

**规则 7：**减少测量中的噪音。在安静的机器上运行你的基准测试，并运行几次，丢弃异常值。用于`-Xbatch`将编译器与应用程序序列化，并考虑设置`-XX:CICompilerCount=1`以防止编译器与自身并行运行。尽量减少 GC 开销，设置`Xmx`（足够大）equals`Xms`并[`UseEpsilonGC`](http://openjdk.java.net/jeps/318)在可用时使用。

**规则 8：**为您的基准测试使用库，因为它可能更有效并且已经为此唯一目的进行了调试。例如[JMH](http://openjdk.java.net/projects/code-tools/jmh/)、[Caliper](https://github.com/google/caliper)或[Bill 和 Paul 的优秀 UCSD Benchmarks for Java](http://cseweb.ucsd.edu/users/wgg/JavaProf/javaprof.html)。

* * *

## 回答 #2

> 赞同：256
> 
> 时间：2010-12-18T23:35:07.853

我知道这个问题已被标记为已回答，但我想提两个帮助我们编写微基准测试的库

**[来自谷歌的卡尺](https://github.com/google/caliper)**

*入门教程*

1.  [http://codingjunkie.net/micro-benchmarking-with-caliper/](http://codingjunkie.net/micro-benchmarking-with-caliper/)
2.  [http://vertexlabs.co.uk/blog/caliper](http://vertexlabs.co.uk/blog/caliper)

**[来自 OpenJDK 的 JMH](http://openjdk.java.net/projects/code-tools/jmh/)**

*入门教程*

1.  [避免 JVM 上的基准测试陷阱](http://www.oracle.com/technetwork/articles/java/architect-benchmarking-2266277.html)
2.  [使用 JMH 进行 Java 微基准测试](http://nitschinger.at/Using-JMH-for-Java-Microbenchmarking)
3.  [JMH简介](https://web.archive.org/web/20181018130828/http://java-performance.info:80/jmh)

* * *

## 回答 #3

> 赞同：92
> 
> 时间：2009-02-02T17:46:59.193

Java 基准测试的重要事项是：

*   首先通过多次运行代码来预热 JIT，然后再对其**计时**
*   确保你运行它足够长的时间，以便能够在几秒或（更好）几十秒内测量结果
*   虽然您不能`System.gc()`在迭代之间调用，但在测试之间运行它是一个好主意，这样每个测试都有望获得一个“干净”的内存空间来使用。（是的，`gc()`与其说是保证，不如说是一种暗示，但根据我的经验，它很*可能*真的会收集垃圾。）
*   我喜欢显示迭代和时间，以及可以缩放的时间/迭代分数，以便“最佳”算法获得 1.0 分，而其他算法则以相对方式得分。这意味着您可以长时间运行*所有*算法，改变迭代次数和时间，但仍能获得可比较的结果。

我正在撰写有关 .NET 基准测试框架设计的博客。我有[几个](http://msmvps.com/blogs/jon_skeet/archive/2009/01/26/benchmarking-made-easy.aspx)较早的[帖子](http://msmvps.com/blogs/jon_skeet/archive/2009/01/29/for-vs-foreach-on-arrays-and-lists.aspx)可能会给您一些想法 - 当然，并非所有内容都合适，但其中一些可能是合适的。

* * *

## 回答 #4

> 赞同：49
> 
> 时间：2013-04-03T12:32:49.617

[jmh](http://openjdk.java.net/projects/code-tools/jmh/)是 OpenJDK 的最新成员，由 Oracle 的一些性能工程师编写。当然值得一看。

> jmh 是一个 Java 工具，用于构建、运行和分析用 Java 和其他针对 JVM 的语言编写的纳米/微型/宏观基准。

非常有趣的信息片段隐藏在[样本测试评论](http://hg.openjdk.java.net/code-tools/jmh/file/tip/jmh-samples/src/main/java/org/openjdk/jmh/samples/)中。

也可以看看：

*   [避免 JVM 上的基准测试陷阱](http://www.oracle.com/technetwork/articles/java/architect-benchmarking-2266277.html)
*   [关于jmh的主要优势的讨论](https://groups.google.com/forum/#!msg/mechanical-sympathy/m4opvy4xq3U/7lY8x8SvHgwJ)。

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2009-02-02T19:54:35.787

> 基准测试应该测量时间/迭代还是迭代/时间，为什么？

这取决于**您**要测试的内容。

如果您对**延迟**感兴趣，请使用时间/迭代；如果您对**吞吐量**感兴趣，请使用迭代/时间。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-02-02T17:57:01.200

如果您尝试比较两种算法，请为每种算法至少做两个基准测试，交替顺序。IE：

```
for(i=1..n)
  alg1();
for(i=1..n)
  alg2();
for(i=1..n)
  alg2();
for(i=1..n)
  alg1(); 
```

我在不同通道中同一算法的运行时发现了一些明显的差异（有时 5-10%）。

此外，请确保*n*非常大，以便每个循环的运行时间至少为 10 秒左右。迭代次数越多，基准时间中的重要数字就越多，数据就越可靠。

* * *

## 回答 #7

> 赞同：16
> 
> 时间：2009-02-02T18:00:10.260

确保您以某种方式使用在基准代码中计算的结果。否则你的代码可以被优化掉。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2009-02-02T17:46:59.583

在 Java 中编写微基准测试有许多可能的陷阱。

首先：您必须计算各种花费时间或多或少随机的事件：垃圾收集、缓存效果（文件的 OS 和 CPU 的内存）、IO 等。

第二：您不能相信在很短的时间间隔内测量的时间的准确性。

第三：JVM 在执行时优化你的代码。因此，在同一个 JVM 实例中的不同运行将变得越来越快。

我的建议：让你的基准测试运行几秒钟，这比运行几毫秒更可靠。预热 JVM（意味着至少运行一次基准测试而不进行测量，JVM 可以运行优化）。并多次运行您的基准测试（可能 5 次）并取中值。在新的 JVM 实例中运行每个微基准测试（调用每个新 Java 基准测试），否则 JVM 的优化效果会影响以后运行的测试。不要执行在预热阶段未执行的事情（因为这可能会触发类加载和重新编译）。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2013-01-21T14:04:05.993

还应该注意的是，在比较不同的实现时，分析微基准测试的结果可能也很重要。因此应进行[显着性检验。](http://en.wikipedia.org/wiki/Significance_testing)

这是因为`A`在大多数基准测试运行期间，实现可能比实现更快`B`。但`A`也可能具有更高的分布，因此`A`与`B`.

因此，正确编写和运行微基准测试也很重要，而且要正确分析它。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2017-03-19T19:21:23.860

为了补充其他出色的建议，我还要注意以下几点：

对于某些 CPU（例如带有 TurboBoost 的 Intel Core i5 系列），温度（和当前使用的内核数量，以及它们的利用率百分比）会影响时钟速度。由于 CPU 是动态时钟的，这可能会影响您的结果。例如，如果您有一个单线程应用程序，则最大时钟速度（使用 TurboBoost）高于使用所有内核的应用程序。因此，这可能会干扰某些系统上单线程和多线程性能的比较。请记住，温度和电压也会影响 Turbo 频率的维持时间。

也许您可以直接控制一个更根本的重要方面：确保您测量的是正确的东西！例如，如果您要`System.nanoTime()`对特定代码位进行基准测试，请将对赋值的调用放在有意义的地方，以避免测量您不感兴趣的事物。例如，不要这样做：

```
long startTime = System.nanoTime();
//code here...
System.out.println("Code took "+(System.nanoTime()-startTime)+"nano seconds"); 
```

问题是代码完成后，您并没有立即获得结束时间。相反，请尝试以下操作：

```
final long endTime, startTime = System.nanoTime();
//code here...
endTime = System.nanoTime();
System.out.println("Code took "+(endTime-startTime)+"nano seconds"); 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2010-12-18T23:22:11.887

[http://opt.sourceforge.net/](http://opt.sourceforge.net/) Java Micro Benchmark - 确定不同平台上计算机系统的比较性能特征所需的控制任务。可用于指导优化决策和比较不同的 Java 实现。

# sql - SQL 2005 事务复制：快照处理期间的行为？

> ID：504110
> 
> 赞同：1
> 
> 时间：2009-02-02T17:43:02.040
> 
> 标签：sql, replication

因此，我的 SQL (2005) Transactional Replication 通常与单个发布者和单个（只读）订阅者一起工作得很好。数据更改和更新完美流畅，延迟大约 5 秒，这很好。

我花了几天时间试图解决的一个烦人的问题（并且到处搜索答案）是*新的*存储过程/表/等。不要传播给只读订阅者，即使我已将它们作为“文章”添加到“出版物”。该发布将“传输模式更改”设置为 ON，并且将存储过程设置为传输其定义。但是，出于某种原因，他们没有。

我的“快照代理”进程设置为未计划。（换句话说，它只发生一次，当我手动启动它时。）我应该把它安排在一个时间表上以启用新的或修改的表和存储过程的传输吗？

我认为仅仅将对象作为文章添加到出版物中就可以了，但除非我做快照，否则它仍然不会发送它。连接这些的 WAN 是完全快速和可靠的，所以这不是问题，并且表数据更新传输相对快速和完美。

虽然我可以按计划安排我的快照代理，但这对主发布数据库或只读副本的用户是否有任何实时生产影响？（我的网站目前每月有 4 多万独立用户，所以我希望将干扰降到最低……）谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T18:53:50.307

事务复制仅从源（发布）数据库的事务日志中分发（然后发布）DML（数据操作语言）语句。

新表和存储过程不会复制到订阅者。在此特定上下文中的模式更改，尽管我不得不承认在某些联机丛书文档中有点不清楚，但请参阅现有模式，即如果您要将列添加到现有数据库，则此更改将传播到订户。

为了澄清，这里有一篇 Microsoft 文章，其中详细说明了您可以进行的架构更改。

[ [http://msdn.microsoft.com/en-us/library/ms151870(SQL.90).aspx][1]](http://msdn.microsoft.com/en-us/library/ms151870(SQL.90).aspx][1])

我希望这有帮助。复制是一个很大的主题领域，所以如果我能提供进一步的帮助，请告诉我。

Oh yes, you are correct, if you add new articles to your publication you will need to create an updated snapshot.

Cheers,

# mysql - MySQL：获取特定行的行号（排名）

> ID：504116
> 
> 赞同：7
> 
> 时间：2009-02-02T17:45:10.197
> 
> 标签：mysql

我有一个`users`表，其中有一列名为`money_sent`. 我想按`money_sent`降序对该表进行排序，然后找出特定用户的“排名”。

例如，只有 111 人的花费比用户 12392 多，因此他们的排名为 112。

我怎么能查询这个？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-02T17:50:12.213

怎么样：

```
SELECT count(*) FROM users WHERE money_sent < (
    SELECT money_sent FROM users WHERE user = 'joe'
); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T17:50:28.000

```
SELECT Row,user, money_sent
FROM (SELECT @row := @row + 1 AS Row, user, money_sent 
       FROM table1 order by money_sent desc) 
As derived1 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T18:01:05.110

如果您还想获取用户的行以及该用户的排名，则可以使用以下内容：

```
SELECT u1.*, COUNT(u2.user) 
FROM users u1
  LEFT OUTER JOIN users as u2 ON (u1.money_sent < u2.money_sent)
GROUP BY u1.user; 
```

# c - 如何在不覆盖任何数据的情况下在文件开头添加新行？

> ID：504118
> 
> 赞同：4
> 
> 时间：2009-02-02T17:45:50.693
> 
> 标签：c, text, file

我试图弄清楚如何在文件（标题）的开头写一行新的文本。我知道我可以打开文件，或者寻找文件的开头，但如果我用它写，它会覆盖那里的内容。我是否必须编写一个新文件，然后将其他数据逐行写入，还是有更好的方法？

示例文件：

```
1, 01/01/09, somedata, foo, bar
2, 01/02/09, somedata, foo, bar
3, 01/03/09, somedata, foo, bar 
```

我想结束

```
3, 1-3, 01/04/09
1, 01/01/09, somedata, foo, bar
2, 01/02/09, somedata, foo, bar
3, 01/03/09, somedata, foo, bar 
```

编辑：

这就是我最终做的事情：

```
FILE *source;
FILE *output;
char buffer[4096];
size_t bytesRead;

memset(buffer, 0, sizeof(buffer);

source = fopen("sourcefile.txt", "r");
output = fopen("output.txt", "w+");

fprintf(output, "my header text\n");

while(!feof(source))
{
  bytesRead = fread(&buffer, 1, sizeof(buffer), source);
  fwrite(&buffer, 1, bytesRead, output);
}

fprintf(output, "my footer text");

fclose(source);
fclose(output);

remove(source);
rename("output.txt", "source.txt"); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-02T17:50:47.423

您将不得不重写整个文件，但这并不一定意味着您必须逐行读取和写入原始数据。逐行读取相对较慢，因此如果文件足够小以适合内存，则将其全部读取为一大块（或大块），然后在写入新数据后将其写回。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T17:51:48.560

好吧，可能*最*简单的事情就是注意到你想要做的就是 unix`cat`命令的等价物。如果您使用的是 unix，则可以从 c 中调用它。或者您可以阅读 gnu textutils 中的源代码。

但无论如何，所有这些解决方案都只是重写文件！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T17:48:12.827

您必须打开一个新文件并重新写入。

# cocoa - 在 Cocoa 中的进程之间传递数据的最佳实践

> ID：504122
> 
> 赞同：4
> 
> 时间：2009-02-02T17:47:11.970
> 
> 标签：cocoa, events, event-handling, ipc, nsnotifications

我正在解决一个需要我在 64 位 Cocoa 应用程序中执行以下操作的问题：

1.  从我的应用程序中生成一个 32 位 Cocoa 辅助工具（命令行工具）。此帮助程序将打开一个文件（准确地说是一部快速电影）并使用 32 位 API（Quicktime-C API）访问有关该文件的信息
2.  从 32 位进程收集的数据需要传回 64 位应用程序。
3.  64 位应用程序应等到 32 位进程完成后再继续

在 Cocoa 中有很多方法可以实现这一点，但据我所知，这是我可以采用的两种方法。

## 选项 1：带有管道的 NSTask

1.  使用 NSTask 生成 32 位进程
2.  将 NSTasks 标准输出重定向到管道，并在 64 位进程中从该管道读取数据。
3.  解析管道中的数据，这将涉及将字符串从标准输出转换为数据（整数、浮点数、字符串等）

## 选项 2：带有 NSDistributedNotificationCenter 的 NSTask

1.  使用 NSTask 生成 32 位进程
2.  当数据在 32 位进程中准备好时，发送一个 NSNotification 到分布式通知中心，并在事件中包含一个包含所有相关数据的字典。
3.  在 64 位应用中订阅相同的 NSNotification

所以我对 StackOverflowers 的问题是，哪个选项“更好”？
哪个是更好的做法？
哪个更有效率？

我倾向于选项 2，因为似乎涉及的代码更少。如果这两种方法都不是很好，有没有更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T18:05:25.240

您说子流程将是一个应用程序。不要为此使用 NSTask——它会混淆 Launch Services。（如果您的意思是它是一个辅助工具，以便好奇的专家用户可以从命令行运行它，那么 NSTask 就可以了。）

无论哪种方式，DNC 都可以工作，但如果子进程确实是一个应用程序，请不要使用 NSTask+NSPipe——使用分布式对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-05T18:00:21.753

NSDistributedNotificationCenter 可以正常工作，但请记住，您的应用程序并不能“保证”接收操作系统的分布式通知。我实际上并没有在实践中看到这一点，但在选择技术时要记住这一点。

您没有提到的另一个选项是分布式对象。分布式对象正是为此目的而制作的。它处理序列化或设置在进程之间或通过网络工作的代理对象。文档有点缺乏，它不支持 Cocoa 的一些较新的部分，例如绑定，它不是很容易使用，但是当我处理两个以复杂方式协同工作的进程时，我仍然更喜欢它。

# tsql - Transact-Sql INTO 子句语法

> ID：504127
> 
> 赞同：0
> 
> 时间：2009-02-02T17:48:13.340
> 
> 标签：tsql

我在这里做错了什么？我对 INTO 子句的使用似乎与我在 Microsoft 的 Transact-SQL 参考页面中找到的示例相匹配，但我一定遗漏了一些东西。

```
DECLARE @rowtemp table(TestRunID int, RunOrder int)

SELECT TestRunID, ROW_NUMBER() OVER (ORDER BY TestRuns.TestTime ASC) 
AS 'RunOrder' INTO @rowtemp FROM TestRuns WHERE RunID = @runID 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T17:52:43.817

您不能将 SELECT INTO 与表变量一起使用，而且 SELECT INTO 会创建一个表，因此您不会先创建该表

试试这个

```
DECLARE @rowtemp table(TestRunID int, RunOrder int)

INSERT INTO  @rowtemp
SELECT TestRunID, ROW_NUMBER() OVER (ORDER BY TestRuns.TestTime ASC) 
AS 'RunOrder'  FROM TestRuns WHERE  RunID = @runID 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T17:52:07.157

您不能将表变量与 SELECT INTO 一起使用。请改用 # temp 表。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T17:53:58.133

表变量不能与 SELECT INTO 一起使用，您可以使用 #temp 表或稍微重新排列您的语句以便阅读。

```
DECLARE @rowtemp table(TestRunID int, RunOrder int)

INSERT INTO @rowtemp 
 SELECT 
  TestRunID, 
  ROW_NUMBER() OVER (ORDER BY TestRuns.TestTime ASC) AS 'RunOrder' 
FROM 
 TestRuns 
WHERE 
 RunID = @runID 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T17:53:41.053

乔说的。另外，INTO 创建了一个新表。由于该表已经存在（您刚刚创建它），因此该语句失败。

# jquery - 如何在 jQuery 中动态构建 $.ajax 方法的“数据”部分

> ID：504129
> 
> 赞同：0
> 
> 时间：2009-02-02T17:49:43.557
> 
> 标签：jquery

我正在尝试为我当前的应用程序构建一个可重用的 $.ajax 方法，但我正在努力寻找有关如何构建**数据的可靠信息：**动态部分...

目前我正在查看类似于下面的函数的东西，但我不确定如何使用 jQuery 1.3.x 来实现这个（或者这种类型的东西是否被移入核心？）

```
var extraParams = {
    timestamp: +new Date()
};

$.each(options.extraParams, function (key, param) {
    extraParams[key] = typeof param == "function" ? param() : param;
}); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T18:05:40.683

我将此方法用作包装器，以便可以发送参数。此外，使用方法顶部的变量可以以更高的比率将其最小化，并在进行多次类似调用时允许某些代码重用。

```
function InfoByDate(sDate, eDate) {
    var divToBeWorkedOn = '#AjaxPlaceHolder';
    var webMethod = 'http://MyWebService/Web.asmx/GetInfoByDates'
    var parameters = "{'sDate':'" + sDate + "','eDate':'" + eDate + "'}"

    $.ajax({
        type: "POST",
        url: webMethod,
        data: parameters,
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function (msg) {
            $(divToBeWorkedOn).html(msg.d);
        },
        error: function (e) {
            $(divToBeWorkedOn).html("Unavailable");
        }
    });
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-15T15:25:45.377

你问题的这一部分：

```
typeof param == "function" ? param() : param; 
```

应该用当前的 jQuery 语法编写为

```
$.isFunction(param) ? param() : param; 
```

我希望这可以帮助你建立你想要的东西。

# asp.net-mvc - 如何在 ASP.Net MVC 中提交带有链接的表单？

> ID：504130
> 
> 赞同：4
> 
> 时间：2009-02-02T17:49:57.910
> 
> 标签：asp.net-mvc, xhtml, hyperlink, form-submit

我有一个 HTML 表单，并且我有一个接受 POST 请求的控制器操作。一切都可以使用常规提交按钮，但我想使用链接（<a>-tag）提交表单，以便能够进一步控制格式。有没有办法很好地内置到 ASP.NET MVC 框架中，或者我应该编写自己的扩展方法？甚至可以在没有 javascript 的情况下做到这一点（我将来会使用 AJAX，但它必须在没有 javascript 的情况下工作）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T18:06:12.243

[这是一个完整的例子。](http://haacked.com/archive/2009/01/30/delete-link-with-downlevel-support.aspx)请注意，这个特定示例做了一些相当重要的事情：它为禁用 JavaScript 的浏览器提供了后备。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-21T11:48:01.850

如果启用了 javascript 和 jQuery，这将有效地用链接替换所有提交按钮：

```
$("input:submit").hide().each(function (index, Element) {
    var elm = $(Element);
    elm.after($("<a href=#>" + elm.val() + "</a>")
            .click(function () { elm.click(); })
        );
}); 
```

基于已接受答案中链接到的帖子。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T17:56:55.897

我不知道有一个助手，据我所知，不使用 javascript 就不可能使用锚标记提交表单。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T18:10:06.823

您不能使用没有 Javascript 的链接（<a> 标记）“提交表单”。javascript 将在幕后生成标准的 POST 请求（与单击提交表单按钮相同）。

对于那些禁用 JS 的人，还有其他解决方法，看看 @Craig Stuntz 提交的内容。

# email - 解析电子邮件“已接收：”标头

> ID：504136
> 
> 赞同：8
> 
> 时间：2009-02-02T17:51:15.207
> 
> 标签：email, parsing

我们需要`Received:`根据 RFC 5321 解析电子邮件标头。我们需要提取邮件经过的域\IP。此外，我们需要确定 IP 是否是内部 IP。是否已经有一个可以提供帮助的库，尤其是在 C\C++ 中。

例如，

```
Received: from server.mymailhost.com (mail.mymailhost.com [126.43.75.123])
    by pilot01.cl.msu.edu (8.10.2/8.10.2) with ESMTP id NAA23597;
    Fri, 12 Jul 2002 16:11:20 -0400 (EDT) 
```

我们需要提取“by”服务器。

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T19:29:58.720

'Received' 行使用的格式在 RFC 2821 中定义，正则表达式无法解析它。

（无论如何，您都可以尝试，对于已知软件生成的有限标头子集，您可能会成功，但是当您将其附加到现实世界邮件中发现的一系列奇怪内容时，它将失败。）

使用现有的 RFC 2821 解析器应该没问题，但否则你应该预料到会失败，并编写软件来应对它。不要围绕它建立任何重要的东西，比如安全系统。

> 我们需要提取“by”服务器。

'from' 更有可能是有用的。'by' 行中给出的主机名与主机本身一样，因此不能保证它是可公开解析的 FQDN。当然，您不会在那里获得有效的（TCP-Info）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2012-02-10T00:08:04.880

有一个 Perl [Received 模块](http://search.cpan.org/~simon/Email-Received-1.00/lib/Email/Received.pm)，它是 SpamAssassin 代码的一个分支。它返回`Received`带有相关信息的标头的哈希。例如

```
{ ip => '64.12.136.4', 
  id => '875522', 
  by => 'xxx.com',
  helo => 'imo-m01.mx.aol.com' } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T17:59:12.837

[vmime](http://www.vmime.org/)应该没问题，更何况任何邮件库都允许你这样做。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T17:57:24.213

您可能会想使用正则表达式

(?<=by).*(?=with)

这将为您提供 Pilot01.cl.msu.edu (8.10.2/8.10.2)

编辑：我觉得这很有趣，当它实际得到 OP 的要求时，它被修改了。

C＃：

```
string header = "Received: from server.mymailhost.com (mail.mymailhost.com [126.43.75.123]) by pilot01.cl.msu.edu (8.10.2/8.10.2) with ESMTP id NAA23597; Fri, 12 Jul 2002 16:11:20 -0400 (EDT)";
       System.Text.RegularExpressions.Regex r = new System.Text.RegularExpressions.Regex(@"(?<=by).*(?=with)");
       System.Text.RegularExpressions.Match m = r.Match(header);
       Console.WriteLine(m.Captures[0].Value);
       Console.ReadKey(); 
```

我没有声称它是完整的，但我想知道给它 -1 的人是否尝试过。呸..

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T18:02:10.957

您可以使用正则表达式。它看起来像这样（未经测试）：

```
#include <regex.h>

regex_t *re = malloc(sizeof(regex_t));

const char *restr = "by ([A-Za-z.]+) \(([^\)]*)\)";

check(regcomp(re, restr, REG_EXTENDED | REG_ICASE), "regcomp");

size_t nmatch = 1;

regmatch_t *matches = malloc(sizeof(regmatch_t) * nmatch);

int ret = regexec(re, YOUR_STRING, nmatch, matches, 0);

check(ret != 0, "regexec");

int size;

size = matches[2].rm_eo - matches[2].rm_so;
char *host = malloc(sizeof(char) * size);
strncpy(host, YOUR_STRING + matches[2].rm_so, size );
host[size] = '\0';

size = matches[3].rm_eo - matches[3].rm_so;
char *ip = malloc(sizeof(char) * size);
strncpy(ip, YOUR_STRING + matches[3].rm_so, size );
ip[size] = '\0'; 
```

check 是一个宏，可以帮助您确定是否有任何问题：

```
#define check(condition, description) if (condition) { fprintf(stdout, "%s:%i - %s - %s\n", __FILE__, __LINE__, description, strerror(errno)); exit(1); } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-08-19T16:09:12.873

```
typedef struct mailHeaders{
    char name[100];
    char value[2000];
}mailHeaders;

int header_count = 0;
mailHeaders headers[30];    // A struct to hold the name value pairs

char *GetMailHeader(char *name)
{
    char *value = NULL;;
    int i;

    for(i=0;i<header_count;i++){
        if(strcmp(name,headers[i].name) == 0){
            value = headers[i].value;
            break;
        }
    }
    return(value);
}

void ReadMail(void)
{

    //Loop through the email message line by line to separate the headers.  Then save the name value pairs to a linked list or struct.  
          char *Received = NULL // Received header
    char *mail = NULL;  // Buffer that has the email message.
    char *line = NULL;  // A line of text in the email. 
    char *name = NULL;  // Header name
    char *value = NULL; // Header value

    int index = -1;     // Header index

    memset(&headers,'\0',sizeof(mailHeaders));

    line = strtok(mail,"\n");
    while(line != NULL)
    {

        if(*line == '\t') // Tabbed headers
        {
            strcat(headers[index].value,line); // Concatenate the tabbed values
        }
        else
        {
            name = line;  
            value = strchr(line,':');  // Split the name value pairs.  
            if(value != NULL)
            {
                *value='\0';    // NULL the colon 
                value++;        // Move the pointer past the NULL character to separate the name and value
                index++;
                strcpy(headers[index].name,name);    // Copy the name to the data structure
                strcpy(headers[index].value,value);  // Copy the value to the data structure
            }

        }

        if(*line == '\r') // End of headers
            break;

        line = strtok(NULL,"\n"); // Get next header
        header_count = index;
    }

          Received = GetMailHeader("Received");

} 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2009-02-02T17:56:47.800

解析这样的标头并不难，即使是逐行手动解析。正则表达式可以通过查看`by\s+(\w)+\(`. 对于 C++，你可以试试那个[库](http://www.scalingweb.com/mime_parser.php)或者[那个](http://www.hotscripts.com/Detailed/76234.html).

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2009-02-02T17:57:32.853

您是否考虑过使用[正则表达式](http://www.regular-expressions.info/examples.html)？

[这](http://www.mtmnet.com/PDF_FILES/NonRoutableIPaddresses.PDF)是内部不可路由地址范围的列表。

# ios - Mac上的Delphi - 可能吗？

> ID：504152
> 
> 赞同：23
> 
> 时间：2009-02-02T17:54:29.490
> 
> 标签：ios, delphi, macos

我负责一个 Delphi/Win32 项目管理应用程序。我刚刚完成了对 Delphi 2009 的迁移。

越来越多的美国用户希望在他们的 Mac 电脑上使用该应用程序，而大多数是 Windows 用户。

是否有解决方案可以轻松构建可以在 MacOS 上本地运行的 Delphi 应用程序？

**随着 2011 年底 RAD Studio XE2 的发布，Delphi 开发人员应该能够构建一次并在 Win 32/64 和 MacOS 32 上分发，并承诺支持 iOS。**

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-02T18:04:18.580

您可能想尝试拉撒路：

[http://www.lazarus.freepascal.org/](http://www.lazarus.freepascal.org/)

[http://wiki.lazarus.freepascal.org/index.php/OS_X_Programming_Tips](http://wiki.lazarus.freepascal.org/index.php/OS_X_Programming_Tips)

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-02T18:02:55.247

Mac OS X 不运行 Windows 程序。它不提供您需要的*任何API，例如 kernel32、user32 等中的函数。*

您可以尝试通过[Crossover](http://www.codeweavers.com/products/)运行您的程序。其他选项包括虚拟机，例如[VMware Fusion](http://www.vmware.com/products/fusion/)和[Parallels](http://www.parallels.com/)。

您可能会尝试的另一件事是使用 .Net。将您的程序转换为使用[.Net 版本的 Delphi](http://www.codegear.com/products/radstudio)，然后[在 Mac 上的 Mono 上](http://www.mono-project.com/Mono:OSX)运行它。不过，我不会对这种方法充满信心。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-02T19:51:22.703

您在 OSX 上运行本机 Delphi 代码的选项非常有限。您可以使用 Lazarus/Freepascal，但这与 Delphi 相差甚远。它将生成本机代码。

或者，您可以使用 Prism 和 Mono。这显然运作良好。看看[http://devcenter.remobjects.com/osx](http://devcenter.remobjects.com/osx)或[http://wiki.remobjects.com/](http://wiki.remobjects.com/)。另外，请查看 remobjects 博客和 embarcadero.public.delphiprism.mono.osx 新闻组。

这需要单声道可再分发。然而，mono 还支持链接和提前编译，因此您可能能够在其上获得接近本机代码的内容。

在任何一种情况下，您都需要重写您的 ui，因为 osx 的外观和约定是不同的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-08-09T16:04:29.430

这是一个非常古老的线程，但对于浏览此处并在 2011 年第三季度或之后寻找答案的人来说，答案是肯定的。

随着今年 Rad Studio XE2 的发布，Delphi 开发人员将能够为 Mac OS 以及即将推出的 Win32、Win64 和 iOS 更多平台创建本机应用程序。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-02T21:42:55.443

Delphi 和 Mac 的未来可能会有一些希望。

[Delphi.Org 的播客](http://www.delphi.org/2008/12/18-coderage-iii-wrap-up/)回顾了 CodeRage III（2008 年 12 月）的闭幕主题演讲，当时 Embarcadero 的 Wayne Williams 谈到了未来。它是这样说的：

> 我认为韦恩演讲中最令人兴奋的部分是标有“未来”的幻灯片，其中列出了公司范围内正在进行的一些研究计划。它具体列出了 Mac、Linux、Cloud、Application Virtualization、FireBird、Touch、64bit、SMP 和 Multi-core。当我询问适用于 Mac 和 Linux 的 Delphi 时，他们说今天，使用 Delphi Prism 和 Mono，您可以使用 Mac 和 Linux，但在他们的实验室中，他们正在研究本地支持，并且他们有一个重要的开端。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-25T22:41:14.633

虽然 Lazarus 路线不是简单的重新编译，但我对它有很好的经验。我之前尝试过（Delphi）.NET+mono 方式（WinCE、Linux 和 OS X），但惨遭失败。

Codegear 说了很多，但下一个 Delphi 版本将只有 64 位的 PREVIEW（cmdline 编译器）。如果您假设之后的版本是完整的 64 位产品，您可以确定 OS X 最早是 2 年之后。

拉撒路或重新编码。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-02T18:38:23.520

我听了最近的一次 Delphi 2009 炫耀电话会议，他们说可以使用 Delphi Prism 在 Mac 上运行，并且有一个名为 Oxidizer 的自动转换实用程序。我不确定你是否会称它为原生，因为你需要 Mono，但我认为它比 Wine 更好。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-03T15:42:29.880

另一种选择是开发基于 Web 的应用程序。这避免了“gui 不同”的问题，并让您专注于您的产品。如果您查看一些最新的 AJAX 控件，您可以非常接近完整的桌面应用程序体验，而无需做出太多牺牲。如果您的应用程序需要在本地运行，那么在 Delphi 中开发本地 Web 服务并将其转换为专门针对 OSX 的 Lazarus 对我来说似乎是一项更容易且易于管理的任务。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-02T21:21:48.247

没有一个很好的解决方案。有人提到了 Lazurus，但它还没有“出现”。Delphi 不是一个跨平台的工具。如果你真的想要一个 Mac 版本，那么你可能应该看看替代品。

如果您的应用程序是基于消费者的，那么您的用户会期待很多 Cocoa 的优点。使用其他任何东西来制作 Mac 应用程序会让他们变得暴躁。

但是，如果它更像是一个商业应用程序，那么这通常不那么重要。我使用 REALbasic 构建大量 Mac/Windows 业务应用程序。它与 Delphi 非常相似，因此应该很容易上手。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-06T23:14:49.293

我们发布了一个使用 Delphi/Free Pascal 创建跨平台应用程序 (Mac OSX) 的新产品。看看[http://twinforms.com/](http://twinforms.com/)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2016-10-11T08:39:44.040

欢迎来到未来/重温过去！

MacOS：[https ://www.embarcadero.com/products/rad-studio/mac-osx-development](https://www.embarcadero.com/products/rad-studio/mac-osx-development)

iOS：[https ://www.embarcadero.com/products/rad-studio/ios-development](https://www.embarcadero.com/products/rad-studio/ios-development)

# asp.net - 单击 DetailsView cancelButton 时是否触发了任何服务器端事件？

> ID：504158
> 
> 赞同：0
> 
> 时间：2009-02-02T17:56:00.063
> 
> 标签：asp.net, asp.net-2.0

在 DetailsView 的插入模式或编辑模式下，单击取消按钮的默认行为是清除 TextBox 中的输入。但我只想重定向到其他页面而不是清除输入。我希望触发服务器端事件，以便我可以响应。重定向。

客户端（一些 JS？）重定向也很好。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T18:37:35.847

查看[ModeChanging 事件](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.detailsview.modechanging.aspx)和[CancelingEdit 属性](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.detailsviewmodeeventargs.cancelingedit.aspx)。

```
void DetailsView_ModeChanging(Object sender, DetailsViewModeEventArgs e)
{
    if (e.NewMode == DetailsViewMode.Edit ||
        e.NewMode == DetailsViewMode.Insert)
    {
        if (e.CancelingEdit)
        {
            //canceled
        }
    }
} 
```

# windows - 将 Kerberos 与 DCOM 一起使用时是否需要 SPN？

> ID：504167
> 
> 赞同：2
> 
> 时间：2009-02-02T17:57:30.047
> 
> 标签：windows, security, kerberos, dcom

我正在使用 DCOM 在 Windows 网络上提供各种应用程序服务，使用 Kerberos 来处理身份验证。系统通常工作正常，但我遇到了从单独的（受信任的）域访问服务的问题。特别是，服务无法回调客户端应用程序，收到错误“发生安全包特定错误”。此外，如果我调整服务以明确要求 Kerberos 身份验证（而不是使用 SNEGO/negotiate），客户端甚至无法调用服务器（再次收到“发生安全包特定错误”）。

令人困惑的是，事情已经运行多年没有问题。但是，与我们之前所做的相比，这里有一些不同之处。一方面，所涉及的服务器运行的是我以前没有使用过的 Windows 2008。此外，如上所述，仅当从单独域的帐户访问服务时才会发生错误，并且以前的使用从未尝试过此操作。

现在问题是：我没有为此 DCOM 服务使用 SPN（服务主体名称），但一些错误和事件日志让我认为这可能是问题所在。但是，我发现的所有文档都不清楚这是否正确，或者如果我确实需要它，我将如何设置 SPN。**有人确定 SPN 是否是我在这里缺少的吗？**如果是这样，你能指出我应该如何做吗？

*额外细节：*

对于服务器设置为强制 Kerberos 身份验证的场景，打开[Extended RPC Debugging](http://msdn.microsoft.com/en-us/library/aa373838(VS.85).aspx)会提供一些额外的线索。客户端可以使用 CoCreateInstanceEx 成功连接，但服务接口上的调用会失败，如上所述。RPC 错误记录在位置 140 处显示错误，错误代码为 0x80090303（“指定的目标未知或无法访问”），该记录的第三个参数是空字符串。这表明缺少 SPN 是罪魁祸首。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-05T17:52:21.923

**编辑**：看起来我可能对此有些误解。我发现至少有一个网站声明[DCOM 会自动为您处理 SPN](http://alt.pluralsight.com/wiki/default.aspx/Keith.GuideBook/HowToUseServicePrincipalNames.html)（请参见页面底部），并且我确认如果客户端要求 Kerberos 身份验证并使用“主机/[计算机名]”作为 SPN，他们可以成功连接。

* * *

如果在 DCOM 服务器进程中调用 CoInitializeSecurity 时明确要求 Kerberos 身份验证，则该服务看起来确实需要 SPN。对我来说，电话看起来像这样：

**警告：请不要在未确保这些值适合您的安全需求的情况下直接复制此代码。**

```
SOLE_AUTHENTICATION_SERVICE sas;
sas.dwAuthnSvc = RPC_C_AUTHN_GSS_KERBEROS;
sas.dwAuthzSvc = RPC_C_AUTHZ_NONE;
sas.pPrincipalName = L"myservice/mymachine";
sas.hr = S_OK;
CoInitializeSecurity( 0, 1, &sas, 0, RPC_C_AUTHN_LEVEL_DEFAULT,
    RPC_C_IMP_LEVEL_DEFAULT, 0, EOAC_NONE, 0 ); 
```

可以使用 配置 SPN [`setspn`](http://technet.microsoft.com/en-us/library/cc773257.aspx)，如下所示：

```
setspn -A myservice/mymachine serviceusername 
```

（有关详细信息，请参阅 setspn 文档）。

不幸的是，这仍然没有解决我的问题，但我认为剩下的问题与测试机器的一些特定问题有关。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-18T20:25:57.870

就其价值而言，Kerberos 根据定义需要 SPN。您也许可以利用内置的 SPNS (host/) 和 host 所暗示的各种风格（此别名翻译存储在 AD 中，但对于我的生活，我似乎无法找到列出在哪里的文章这是找到的）。

我将从查看跨域身份验证开始 - 使用 kerberos 可能会很棘手。我首先在客户端和服务器上打开完整的[kerberos 日志记录](http://support.microsoft.com/kb/262177/)，看看是否有任何结果。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-07-07T09:53:31.283

我在尝试创建远程 COM 对象的实例时遇到了这个错误。如果客户端在调用 CoInitializeSecurity() 期间使用“委托”模拟级别，并且 COM+ 服务在域级别没有“委托”权限​​的用户帐户下运行，我们可能会遇到此错误。

# objective-c - 如何将不透明类型添加到集合中

> ID：504174
> 
> 赞同：0
> 
> 时间：2009-02-02T18:00:11.633
> 
> 标签：objective-c, cocoa, collections

如何将不透明类型添加到可可中的集合中？

我收到了一个编译器警告（显然，因为不透明类型不是对象）：

```
CGColorSpaceRef colorSpace;
NSArray *myArray = [NSArray arrayWithObject:colorSpace]; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T18:28:46.537

您可以使用 NSValue 类将不透明类型包装在对象中。从[这里](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/nsvalue_Class/Reference/Reference.html)：

> NSValue 对象是单个 C 或 Objective-C 数据项的简单容器。它可以保存任何标量类型，例如 int、float 和 char，以及指针、结构和对象 ID。此类的目的是允许将此类数据类型的项添加到集合中，例如 NSArray 和 NSSet 的实例，这要求它们的元素是对象。NSValue 对象总是不可变的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-06T06:32:12.873

CoreFoundation 数据类型 (CFTypes) 可以直接添加到集合中。（需要将它们强制转换为 (id) 以抑制警告。）这称为“免费桥接”。

```
CGColorSpaceRef colorSpace;
NSArray *myArray = [NSArray arrayWithObject:(id)colorSpace]; 
```

# java - Java Paint 方法不绘制？

> ID：504189
> 
> 赞同：3
> 
> 时间：2009-02-02T18:05:26.753
> 
> 标签：java, swing, label, jpanel, paint

我正在研究一个简单的小摆动组件，我正在扯头发试图弄清楚为什么我的绘画方法不起作用。

这个组件背后的想法是它是一个带有标签的小型 JPanel。背景（标签后面）应该是白色的，左侧有一个彩色矩形表示两个测量值的比率：“实际”和“预期”。

如果你有一堆这些组件垂直对齐，它们会形成一个条形图，由水平条组成。

这种事情应该超级简单。

无论如何，这是代码：

```
package com.mycompany.view;

import java.awt.Color;
import java.awt.Graphics;
import java.awt.Rectangle;

import javax.swing.JLabel;
import javax.swing.JPanel;

public class BarGraphPanel extends JPanel {

   private static final Color BACKGROUND = Color.WHITE;
   private static final Color FOREGROUND = Color.BLACK;

   private static final Color BORDER_COLOR = new Color(229, 172, 0);
   private static final Color BAR_GRAPH_COLOR = new Color(255, 255, 165);

   private int actual = 0;
   private int expected = 1;

   private JLabel label;

   public BarGraphPanel() {
      super();
      label = new JLabel();
      label.setOpaque(false);
      label.setForeground(FOREGROUND);
      super.add(label);
      super.setOpaque(true);
   }

   public void setActualAndExpected(int actual, int expected) {
      this.actual = actual;
      this.expected = expected;
   }

   @Override
   public void paint(Graphics g) {

      double proportion = (expected == 0) ? 0 : ((double) actual) / expected;
      Rectangle bounds = super.getBounds();

      g.setColor(BACKGROUND);
      g.fillRect(bounds.x, bounds.y, bounds.width, bounds.height);

      g.setColor(BAR_GRAPH_COLOR);
      g.fillRect(bounds.x, bounds.y, (int) (bounds.width * proportion), bounds.height);

      g.setColor(BORDER_COLOR);
      g.drawRect(bounds.x, bounds.y, bounds.width, bounds.height);

      label.setText(String.format("%s of %s (%.1f%%)", actual, expected, proportion * 100));
      super.paint(g);
      g.dispose();
   }

} 
```

这是简单的测试工具：

```
package com.mycompany.view;

import java.awt.Dimension;
import java.awt.GridLayout;

import javax.swing.JFrame;
import javax.swing.UIManager;

public class MyFrame extends JFrame {

   public MyFrame() {
      super();
      super.setLayout(new GridLayout(3, 1));
      super.setPreferredSize(new Dimension(300, 200));

      BarGraphPanel a = new BarGraphPanel();
      BarGraphPanel b = new BarGraphPanel();
      BarGraphPanel c = new BarGraphPanel();

      a.setActualAndExpected(75, 100);
      b.setActualAndExpected(85, 200);
      c.setActualAndExpected(20, 300);

      super.add(a);
      super.add(b);
      super.add(c);
   }

   public static void main(String[] args) {
      javax.swing.SwingUtilities.invokeLater(new Runnable() {
         public void run() {
            createAndShowGUI();
         }
      });
   }

   public static void createAndShowGUI() {

      try {
         UIManager.setLookAndFeel(UIManager.getSystemLookAndFeelClassName());
      } catch (Throwable t) { }

      MyFrame frame = new MyFrame();
      frame.pack();
      frame.setVisible(true);
   }

} 
```

测试工具创建一个简单的框架，然后添加其中三个控件。

标签都正确呈现，这向我表明paint() 方法实际上正在被调用，但矩形没有被绘制到 Graphics 对象。

我究竟做错了什么？

为什么 Swing 编程如此糟糕？

* * *

这是我的最终代码。谢谢大家，你们的帮助！

```
public void paintComponent(Graphics g) {

   double proportion = (expected == 0) ? 0 : ((double) actual) / expected;

   Rectangle bounds = super.getBounds();

   g.setColor(BACKGROUND);
   g.fillRect(0, 0, bounds.width, bounds.height);

   g.setColor(BAR_GRAPH_COLOR);
   g.fillRect(0, 0, (int) (bounds.width * proportion), bounds.height);

   g.setColor(BORDER_COLOR);
   g.drawRect(0, 0, bounds.width - 1, bounds.height - 1);

   FontMetrics metrics = g.getFontMetrics();
   String label = String.format("%s of %s (%.1f%%)", actual, expected, proportion * 100);
   Rectangle2D textBounds = metrics.getStringBounds(label, g);

   g.setColor(FOREGROUND);
   g.drawString(label, 5, (int) ((bounds.height + textBounds.getHeight()) / 2));
} 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T18:25:26.213

我想你几乎已经在评论中回答了你自己的问题，以及大卫的回答。更改`paint(Graphics g)`并`paintComponent(Graphics g)`删除方法的最后两行，你应该没问题。

**编辑：**奇怪的是，这仅适用于三个中的第一个。更多测试正在进行中...

顺便说一句，您在边框绘制代码中有一个错误。它应该是：

```
g.setColor(BORDER_COLOR);
g.drawRect(bounds.x, bounds.y, bounds.width - 1, bounds.height - 1); 
```

**EDIT2：**好的，明白了。您的完整`paintComponent`方法应如下所示：

```
@Override
public void paintComponent(Graphics g) {
    double proportion = (expected == 0) ? 0 : ((double) actual) / expected;
    Rectangle bounds = super.getBounds();
    g.setColor(BACKGROUND);
    g.fillRect(0, 0, bounds.width, bounds.height);
    g.setColor(BAR_GRAPH_COLOR);
    g.fillRect(0, 0, (int) (bounds.width * proportion), bounds.height);
    g.setColor(BORDER_COLOR);
    g.drawRect(0, 0, bounds.width-1, bounds.height-1);
    label.setText(String.format("%s of %s (%.1f%%)", actual, expected, proportion * 100));
} 
```

请注意，给定的坐标`g.fillRect()`和`g.drawRect()`是相对于组件的，因此它们必须从 (0,0) 开始。

不，我不能帮助你回答你的最后一个问题，尽管我能感觉到你的痛苦。:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T18:27:01.920

在您的 JPanel 中，您调用了 super.setOpaque(true)。当您调用 super.paint() 并覆盖您的 retangles 时，JPanel 将完全填充背景。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T18:22:00.230

不确定这是否是您问题的根源，但在 Swing 中您应该改写`paintComponent(Graphics2D)`...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T18:27:37.053

如果有的话，我认为你应该调用 super.paint(g); 在您方法的顶部，而不是在最底部。超类可能正在您的东西之上绘制。

# sql - 替代行级触发器？

> ID：504198
> 
> 赞同：2
> 
> 时间：2009-02-02T18:07:45.830
> 
> 标签：sql, sql-server, triggers

MS SQL Server 没有行级触发器，对吗？如果我需要从触发器中插入一行，然后根据第一次插入的结果插入另一行，游标会是最好的解决方案吗？

例如，有没有更好的方法来做到这一点：

```
CREATE TABLE t1 (foo int)
CREATE TABLE t2 (id int IDENTITY, foo int)
CREATE TABLE t3 (t2_id int)

GO

CREATE TRIGGER t1_insert_trg ON t1 FOR INSERT AS
    DECLARE c CURSOR FOR
        SELECT foo FROM inserted
    DECLARE @foo int
    OPEN c
    FETCH NEXT FROM c INTO @foo
    WHILE @@FETCH_STATUS = 0
    BEGIN
        INSERT INTO t2 (foo) VALUES (@foo)
        INSERT INTO t3 (t2_id) VALUES (@@IDENTITY)
        FETCH NEXT FROM c INTO @foo
    END
    CLOSE c
    DEALLOCATE c 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T18:31:48.323

我假设您使用的是 2005 年或更高版本？如果是这样，请查看 OUTPUT 子句，您不需要行级触发器。例如：

```
USE tempdb;
GO

CREATE TABLE t1 (foo int);
CREATE TABLE t2 (id int IDENTITY, foo int);
CREATE TABLE t3 (t2_id int);
GO

CREATE TRIGGER t1_insert ON t1
FOR INSERT AS
BEGIN   
    DECLARE @new_rows TABLE(new_id INT, old_foo INT);

    INSERT t2(foo)
      OUTPUT inserted.id, inserted.foo 
      INTO @new_rows
    SELECT foo
    FROM inserted;

    INSERT t3 SELECT new_id FROM @new_rows;
END
GO

INSERT t1(foo) SELECT 1 UNION ALL SELECT 5;
SELECT * FROM t1;
SELECT * FROM t2;
SELECT * FROM t3;
GO

DROP TABLE t1,t2,t3; 
```

您还可以通过在 T1 上插入一个插入 T2 的触发器，然后在 T2 上插入一个插入 T3 的触发器来管理此问题。恕我直言，这不会那么有效，也不容易管理，但我会提出它更容易遵循（如果你被困在 2000 年，这可能是你唯一的选择）。两者都可以是基于集合的，并且不需要游标或任何其他逐行处理方法。

```
USE tempdb;
GO

CREATE TABLE t1 (foo int);
CREATE TABLE t2 (id int IDENTITY, foo int);
CREATE TABLE t3 (t2_id int);
GO

CREATE TRIGGER t1_insert ON t1
FOR INSERT AS
BEGIN       
    INSERT t2(foo)
    SELECT foo FROM inserted;
END
GO

CREATE TRIGGER t2_insert ON t2
FOR INSERT AS
BEGIN
    INSERT t3(t2_id)
    SELECT id FROM inserted;
END
GO

INSERT t1(foo) SELECT 1 UNION ALL SELECT 5;
SELECT * FROM t1;
SELECT * FROM t2;
SELECT * FROM t3;
GO

DROP TABLE t1,t2,t3; 
```

（顺便说一句，如果您要获取标识值，请使用 SCOPE_IDENTITY()，而不是 @@IDENTITY。）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T18:36:51.667

您可能能够避免光标或需要知道使用以下插入插入了什么标识。

```
Insert INTO t2 (foo) Select foo from inserted
Insert into t3 (t2_id) Select t2.id from t2
inner join inserted  i on t2.foo = i.foo 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T18:21:51.837

为什么不级联触发器 - 在 T2 上使用 INSERT 触发器在 T3 上执行插入。然后，您可以避免 t1_insert_trg 中的光标，而只需使用 insert - 如下所示：

```
CREATE TRIGGER t1_insert_trg ON t1 FOR INSERT AS
    INSERT INTO t2
    SELECT foo FROM inserted -- fires t2 INSERTED trigger 

CREATE TRIGGER t2_insert_trg ON t2 FOR INSERT AS
    INSERT INTO t3 
    SELECT id FROM inserted 
```

# javascript - 如果条件相同，如何检查多个局部变量

> ID：504199
> 
> 赞同：1
> 
> 时间：2009-02-02T18:08:37.747
> 
> 标签：javascript

好吧，我发现下面的代码非常重复和烦人。在不使用数组作为起点的情况下重构代码的任何其他方式（即避免在代码中使用`array[x]`, `array[y]`,`array[z]`作为以数组开头的结果，因为,`x`完全不相关并且分组没有意义他们是为了可读性）`y``z`

```
var x = "";
var y = "";
var z = "";
...

...variables get set

if(x != undefined && x != "")
    doSomethingHere();

if(y != undefined && y != "")
    doSomethingThere();

if(z != undefined && z != "")
    doSomethingElse();
... 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-02T18:15:08.233

至少您可以将验证规则分解为它们自己的功能：

```
function IsValid(x)
{
    return (x != undefined && x != "");
}

var x = "";
var y = "";
var z = "";
//...

//...variables get set

if(IsValid(x)) doSomething();
if(IsValid(y)) doSomething();
if(IsValid(z)) doSomething(); 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-02T19:13:06.213

除了乔尔所说的之外，您还可以执行以下操作：

```
function doOnValid(x, func){
 if(x != undefined && x != "") func();
} 
```

然后你可以这样做：

```
doOnValid(x, doSomething);
doOnValid(y, doSomethingElse);
doOnvalid(z, function() { /*Yay lambda function*/ }); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T18:35:13.217

如果你想避免重复，无论是垂直的 (var x;\r\n;var y;\r\n...) 还是水平的 (if (x || y || z || ...) ，整理事物的一个好方法是将变量作为属性收集到一个对象中：

```
var vars = {
    x: 42,
    y: "",
    z: undefined
};

for (var v in vars) {
    var value = vars[v];

    if (value != undefined && value != "") {
        doSomething();
    }
} 
```

最重要的是，如果每个变量要采取的动作不同，您还可以定义一个“动作”结构：

```
var actions = {
    x: doSomething,
    y: doSomethingElse,
    z: doSomething
};

for (var v in vars) {
    var value = vars[v];

    if (value != undefined && value != "") {
        actions[v]();
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T18:11:34.010

您将 x,y 和 z 初始化为 "" 是否有原因？

如果你只是这样做

```
 var x;

 ..... maybe set x .....

 if (x)
    doSomething() 
```

你节省了很多绒毛。你可以对 y 和 z 做同样​​的事情 ;) x 的初始值是未定义的，你可以用 if (x) 来检查，这意味着与 if (x != undefined) 相同

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T18:13:23.680

首先，因为 undefined 和空字符串 ("") 在 javascript 中都评估为 "false"，所以您可以将条件更改为：

```
if (x) 
     doSomething();
if (y) 
     doSomething();
if (z) 
     doSomething(); 
```

如果要做的事情总是一样的，你当然可以

```
if (x || Y || z)
     doSomething(); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T18:13:12.417

我猜原来应该使用 y != undefined 并且 doSomething () 在所有情况下都是相同的函数：

```
if((x != undefined && x != "") || 
   (y != undefined && y != "") ||
   (z != undefined && z != ""))
    doSomething(); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T18:15:13.397

所以要跟进克罗森沃尔德的回答，我认为你想要的是

```
var x;
var y;
var z;

// do stuff

if (x||y||z)
  doSomething(); 
```

哪个更整洁

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-02T21:45:39.727

假设您希望为每个条件执行一个独特的操作，这将尽可能简洁。

```
(x && doX());
(y && doY());
(z && doZ()); 
```

这是有效的，因为您的特定变量测试只是减少到变量的值。当然，您也可以编写自定义条件函数：

```
function is_valid(x){
    // return true or false
}

( is_valid(x) && doX() );
( is_valid(y) && doY() );
( is_valid(z) && doZ() ); 
```

# windows - 有谁知道 Windows 平台的 Pipe Viewer 的一个很好的替代品？

> ID：504204
> 
> 赞同：8
> 
> 时间：2009-02-02T18:10:05.747
> 
> 标签：windows, scripting, windows-xp

如果您不知道 Pipe Viewer 是什么（我直到 5 分钟前才知道它），那么[这个博客](http://www.catonmat.net/blog/unix-utilities-pipe-viewer/)很好地通过一些示例对其进行了简要介绍。作为 ETL 开发人员，我编写了很多 Perl 脚本，而且很多时候，我使用的文件需要很长时间才能操作（解压缩、移动等）。因此，这个工具会很棒，除非我在 Windows 环境中工作。如果有人知道可以为您提供在管道中运行的操作的进度的工具，请告诉我，因为这将使我的脚本更加有用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T03:02:32.130

我终于让它在 Cygwin 环境中工作，尽管这不是原始帖子的答案。

`--disable-nls`成功了。

```
./configure --disable-nls    
make    
make test    
cp pv /usr/bin 
```

== by Kenji (k2) ==

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2016-08-25T21:02:22.377

[Cygwin](http://cygwin.com)将**pv （管道查看器）**作为[可用包](http://cygwin.com/cgi-bin2/package-cat.cgi?file=x86_64%2Fpv%2Fpv-1.4.12-1&grep=pv)，因为我不知道什么时候......但默认情况下**没有安装**它。

1.  [从安装页面](http://cygwin.com/install.html)下载 Cygwin 安装程序可执行文件。
2.  在安装 cygwin 时，您需要在***Utils***部分中**明确搜索并标记**安装**pv 。**

 **如果您已经安装了 cygwin，您可以稍后通过重新运行安装可执行文件来添加它。*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T18:19:07.600

我怀疑 win32 是否存在这样的工具，但它应该在 cygwin 上运行。但是话又说回来你可能不使用它:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-10-30T18:25:52.927

我怀疑您想使用管道查看器来捕获控制台应用程序的输出性能（字节/秒）。

如果要衡量一个进程的IO读写性能，我推荐使用*Process Explorer*。您可以找到每个过程的性能。

请参阅[https://docs.microsoft.com/en-us/sysinternals/downloads/process-explorer](https://docs.microsoft.com/en-us/sysinternals/downloads/process-explorer)

# c# - How to read command line arguments of another process in C#?

> ID：504208
> 
> 赞同：30
> 
> 时间：2009-02-02T18:10:50.097
> 
> 标签：c#, process, diagnostics

How can I obtain the command line arguments of another process?

Using static functions of the `System.Diagnostics.Process` class I can obtain a list of running processes, e.g. by name:

```
Process[] processList = Process.GetProcessesByName(processName); 
```

However, there is no way to access the command line used to start this process. How would one do that?

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-02-02T18:45:42.210

> If you did not use the Start method to start a process, the StartInfo property does not reflect the parameters used to start the process. For example, if you use GetProcesses to get an array of processes running on the computer, the StartInfo property of each Process does not contain the original file name or arguments used to start the process. (source: [MSDN](http://msdn.microsoft.com/en-us/library/system.diagnostics.process.startinfo.aspx))

Stuart's WMI suggestion is a good one:

```
string wmiQuery = string.Format("select CommandLine from Win32_Process where Name='{0}'", processName);
ManagementObjectSearcher searcher = new ManagementObjectSearcher(wmiQuery);
ManagementObjectCollection retObjectCollection = searcher.Get();
foreach (ManagementObject retObject in retObjectCollection)
    Console.WriteLine("[{0}]", retObject["CommandLine"]); 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-02T18:22:07.673

If you're targeting Windows XP or later and you can afford the overhead of WMI, a possibility would be to look up the target process using WMI's [WIN32_Process class](http://msdn.microsoft.com/en-us/library/aa394372(VS.85).aspx), which has a CommandLine property.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T18:14:34.147

`Process.StartInfo` returns a [ProcessStartInfo](http://msdn.microsoft.com/en-us/library/system.diagnostics.processstartinfo_members.aspx) object that allegedly but not necessarily has the arguments in the Arguments property.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T18:23:38.073

Are both projects yours? Could you modify the source for the process you're trying to examine to make it give you its command-line arguments, rather than trying to read them from somewhere outside of that process?

# javascript - JavaScript：对字符串中的数字进行加法或减法

> ID：504219
> 
> 赞同：1
> 
> 时间：2009-02-02T18:14:33.257
> 
> 标签：javascript, regex

我有一个看起来像“(3) New stuff”的字符串，其中 3 可以是任何数字。
我想增加或减少这个数字。

我想出了以下方法：

```
var thenumber = string.match((/\d+/));
thenumber++;
string = string.replace(/\(\d+\)/ ,'('+ thenumber +')'); 
```

有没有更优雅的方法来做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T18:30:24.537

其他方式：

```
string = string.replace(/\((\d+)\)/ , function($0, $1) { return "(" + (parseInt($1, 10) + 1) + ")"; }); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T23:03:03.673

我相信 Gumbo 是在正确的轨道上

```
"(42) plus (1)".replace(/\((\d+)\)/g, function(a,n){ return "("+ (+n+1) +")"; }); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T18:20:45.180

没有扩展 String 对象，它对我来说看起来不错。

```
String.prototype.incrementNumber = function () {
  var thenumber = string.match((/\d+/));
  thenumber++;
  return this.replace(/\(\d+\)/ ,'('+ thenumber +')');
} 
```

用法将是：

```
alert("(2) New Stuff".incrementNumber()); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T18:22:36.813

我相信您的方法是您可以拥有的最优雅的方法，原因如下：

*   由于输入不是“干净”的数字，因此您确实需要涉及某种字符串解析器。使用正则表达式是代码效率非常高的方法
*   通过查看代码，很清楚它的作用

没有把它包装成一个函数，我认为没有更多工作要做

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T20:45:56.913

正如 galets 所说，我认为您的解决方案不是一个坏的解决方案，但这里有一个函数，可以将指定值添加到字符串中指定位置的数字。

```
var str = "fluff (3) stringy 9 and 14 other things";

function stringIncrement( str, inc, start ) {
    start = start || 0;
    var count = 0;
    return str.replace( /(\d+)/g, function() {
        if( count++ == start ) {
            return(
                arguments[0]
                .substr( RegExp.lastIndex )
                .replace( /\d+/, parseInt(arguments[1])+inc )
            );
        } else {
            return arguments[0];
        }
    })
}

// fluff (6) stringy 9 and 14 other things :: 3 is added to the first number
alert( stringIncrement(str, 3, 0) );

// fluff (3) stringy 6 and 14 other things :: -3 is added to the second number
alert( stringIncrement(str, -3, 1) );

// fluff (3) stringy 9 and 24 other things :: 10 is added to the third number
alert( stringIncrement(str, 10, 2) ); 
```

# c# - 通过 COM 启动和控制新的应用程序实例

> ID：504256
> 
> 赞同：0
> 
> 时间：2009-02-02T18:22:08.500
> 
> 标签：c#, .net, delphi, com, interop

我正在使用 C#.NET 来启动和控制 Delphi 编写的可执行文件。Delphi 应用程序有一个 COM 接口。

我已将 Delphi 可执行文件（我们将其称为 DelphiApp.exe）作为资源导入 Visual Studio。

以下 C# 代码有效——*如果*没有其他 DelphiApp.exe 实例正在运行：

```
DelphiApp.DelphiAppClass da = new DelphiAppClass();
da.DoStuff(1, 3, 4); 
```

如果 DelphiApp.exe 的一个实例正在运行，上面的代码将“接管”其中一个实例，这不是我想要的。当我声明一个 new`DelphiAppClass()`时，我总是希望它是一个新的应用程序实例。

我已经尝试了几种解决方法——比如如果已经存在一个新的 DelphiApp 进程，则启动一个新的进程——但我似乎找不到处理这个问题的正确方法。

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T15:14:27.003

当您创建您的 delphi 自动化服务器时，请确保您使用**ciSingleInstance**作为自动机对象构造函数中的第四个参数。例如：

```
TAutoObjectFactory.Create(ComServer, TTestServer, Class_TestServer,
  ciSingleInstance, tmApartment); 
```

这将要求每个对象都为其创建一个新的自动化对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T16:11:46.640

> 当您创建您的 delphi 自动化服务器时，请确保您使用 ciSingleInstance 作为自动机对象构造函数中的第四个参数。

我已经在 OP 评论中发布了这个——在 Delphi 中，我使用这行代码来定义 COM 行为：

```
TTypedComObjectFactory.Create(ComServer, TDelphiApp, Class_DelphiApp, ciSingleInstance, tmSingle); 
```

据我所知，这是在 COM 端进行设置的正确方法。（如果没有，请告诉我我做错了什么！）

我正在使用 Delphi 7，FWIW。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T21:30:38.337

上周有人问了一个问题，听起来可能与您的问题相反（想要重用应用程序，但不断更新）。也许它可以让你走上正确的道路？

[如何使用第二个客户端重用 Delphi ole 服务器](https://stackoverflow.com/questions/495785/how-to-reuse-a-delphi-ole-server-with-a-second-client)

# c++ - 相同成员函数的公共和私有访问

> ID：504257
> 
> 赞同：3
> 
> 时间：2009-02-02T18:22:16.050
> 
> 标签：c++, inheritance, private

我有一个类（A 类），旨在由其他人编写的其他类继承。我还有另一个类（B 类），它也继承自 A。

B 必须访问一些 A 的成员函数，这些成员函数不应被其他继承类访问。

因此，这些 A 的成员函数对于 B 应该是公共的，但对于其他人来说应该是私有的。

如何在不使用“朋友”指令的情况下解决它？

谢谢你。

编辑：示例为什么我需要它。

```
class A
{
public:
  void PublicFunc()
  {
    PrivateFunc();
    // and other code
  }
private:
  virtual void PrivateFunc();
};

class B : public class A
{
private:
  virtual void PrivateFunc()
  {
    //do something and call A's PrivateFunc
    A::PrivateFunc(); // Can't, it's private!
  }
}; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T18:35:27.363

你不能。这就是朋友的目的。

另一种方法是更改​​程序的设计/架构。但是对于这方面的提示，我需要更多的上下文。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T18:56:53.123

你说的是：A 有两组子类。一组应该可以访问，另一组不应该。只有一个品牌的子类（即 B）“看到”A 的成员感觉不对。

如果你的意思是：只有*我们*可以使用*这*部分功能，而我们的客户不能，还有其他的手段。

（通过继承的功能重用经常让你陷入这种问题。如果你通过聚合来重用，你可能会绕过它。）

一条建议：

```
// separate the 'invisible' from the 'visible'.
class A_private_part {
protected: 
  int inherited_content();
public:
  int public_interface();          
};

class B_internal : public A_private_part {
};

class A_export : private A_private_part {
public:
    int public_interface() { A_private_part::public_interface(); }
};

// client code
class ClientClass : public A_export {
}; 
```

但更好的是采用聚合方式，将当前的“A”拆分为可见和不可见的部分：

```
class InvisibleFunctionality {
};

class VisibleFunctionality {
};

class B {
    InvisibleFunctionality m_Invisible;
    VisibleFunctionality m_Visible;
};

// client code uses VisibleFunctionality only
class ClientClass {
    VisibleFunctionality m_Visible;
}; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T18:41:32.313

我认为你在这里有一个更大的问题。您的设计似乎不合理。

1）我认为“朋友”结构一开始就有问题

2）如果“朋友”不是你想要的，你需要重新检查你的设计。

我认为您要么需要做一些事情来完成工作，使用“朋友”，要么开发一个更强大的架构。看看[一些](http://developer.yahoo.com/ypatterns/) [设计模式](http://www.tml.tkk.fi/~pnr/Tik-76.278/gof/html/)，我相信你会发现一些有用的东西。

编辑：

看到您的示例代码后，您肯定需要重新构建。A 类可能不在你的控制之下，所以这有点棘手，但可能希望你想将 B 类重新做为一个“有”类而不是“是一个”类。

```
public Class B
{
    B() 
    {

    }

    void someFunc()
    {
       A a; //the private functions is now called and a will be deleted when it goes out of scope
    }

}; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T18:49:53.780

好吧 - 如果你想要你所描述的，那么*朋友*是最好的解决方案。每个编码标准都建议不要使用*朋友*，但替代设计更复杂 - 那么也许值得例外。

要解决没有朋友的问题将需要不同的架构

一种解决方案可能是使用一种形式的[pImpl 习惯用法](http://en.wikipedia.org/wiki/Pimpl_idiom)，其中“B”派生自内部实现对象，而其他客户端派生自外部类。

另一个可能是在“A”和“其他客户端”之间放置一个额外的继承层。就像是：

```
class A {
public:
  void foo ();
  void bar ();
};

class B : public A {  // OK access to both 'foo' and 'bar'
};

class ARestricted : private A {
public:
  inline void foo () { A::foo (); };    // Forwards 'foo' only
}; 
```

但是，这种解决方案仍然存在问题。'ARestricted' 无法转换为 'A'，因此这需要通过 'A' 的其他“getter”来解决。但是，您可以以不会被意外调用的方式命名此函数：

```
 inline A & get_base_type_A_for_interface_usage_only () { return *this; } 
```

在尝试考虑其他解决方案并假设您的层次结构需要如您所描述的那样，我建议您只使用*朋友*！

**编辑：** 所以[xtofl](https://stackoverflow.com/users/6610/xtofl)建议将类型“A”重命名为“AInternal”，将“ARestricted”类型重命名为“A”。

那行得通，只是我注意到“B”不再是“A”。但是，AInternal 可以虚拟继承 - 然后“B”可以从“AInternal”和“A”派生！

```
class AInternal {
public:
  void foo ();
  void bar ();
};

class A : private virtual AInternal {
public:
  inline void foo () { A::foo (); };    // Forwards 'foo' only
};

// OK access to both 'foo' and 'bar' via AInternal
class B : public virtual AInternal, public A {
public:
  void useMembers ()
  {
    AInternal::foo ();
    AInternal::bar ();
  }
};

void func (A const &);

int main ()
{
  A a;
  func (a);

  B b;
  func (b);
} 
```

当然现在你有了虚拟基础和多重继承！嗯....现在，这比一个*朋友*声明好还是坏？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-03T09:14:55.717

我觉得这是一个有趣的挑战。这是我解决问题的方法：

```
class AProtectedInterface
{
public:
    int m_pi1;
};

class B;
class A : private AProtectedInterface
{
public:
    void GetAProtectedInterface(B& b_class);

    int m_p1;
};

class B : public A
{
public:
    B();
    void SetAProtectedInterface(::AProtectedInterface& interface);

private:
    ::AProtectedInterface* m_AProtectedInterface;
};

class C : public A
{
public:
    C();
};

C::C()
{
    m_p1 = 0;
//    m_pi1 = 0; // not accessible error
}

B::B()
{
    GetAProtectedInterface(*this);

    // use m_AProtectedInterface to get to restricted areas of A
    m_p1 = 0;
    m_AProtectedInterface->m_pi1 = 0;
}

void A::GetAProtectedInterface(B& b_class)
{
    b_class.SetAProtectedInterface(*this);
}

void B::SetAProtectedInterface(::AProtectedInterface& interface)
{
    m_AProtectedInterface = &interface;
} 
```

如果你一直使用这种模式，你可以通过使用模板来减少代码。

```
template<class T, class I>
class ProtectedInterfaceAccess : public I
{
public:
    void SetProtectedInterface(T& protected_interface)
    {
        m_ProtectedInterface = &protected_interface;
    }

protected:
    T& GetProtectedInterface()
    {
        return *m_ProtectedInterface;
    }

private:
    T* m_ProtectedInterface;
};

template<class T, class I>
class ProtectedInterface : private T
{
public:
    void SetupProtectedInterface(I& access_class)
    {
        access_class.SetProtectedInterface(*this);
    }
};

class Bt;
class At : public ProtectedInterface <::AProtectedInterface, Bt>
{
public:
    int m_p1;
};

class Bt : public ProtectedInterfaceAccess<::AProtectedInterface, At>
{
public:
    Bt();
};

class Ct : public At
{
public:
    Ct();
};

Ct::Ct()
{
    m_p1 = 0;
    // m_pi1 = 0; // not accessible error
}

Bt::Bt()
{
    SetupProtectedInterface(*this);

    m_p1 = 0;
    GetProtectedInterface().m_pi1 = 0;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T18:34:39.427

如果我理解：

*   A 将被其他开发人员子类化。
*   B 将由其他开发人员继承并从 A 继承。
*   A 有一些您不希望外部开发人员通过 B 访问的方法。

我不认为这可以在不使用朋友的情况下完成。我没有办法让超类的成员只对直接继承者可用。

# asp.net - 同一个 asp.net 应用程序中的默认资源提供程序和 SqlResourceProviderFactory

> ID：504259
> 
> 赞同：1
> 
> 时间：2009-02-02T18:22:28.763
> 
> 标签：asp.net, resources

是否可以使用在应用程序中使用 .resx 文件但在子文件夹中使用 SqlResourceProvider 的默认资源提供程序？

似乎唯一使用的是在根的 web.config 中配置的那个？

任何的想法 ？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-10-05T20:57:36.287

我需要类似的东西，为特定的类键返回一个自定义的 ResourceProvider ，然后回退到默认的资源提供者。

我创建了一个自定义 ResourceProviderFactory，它在请求时返回我的自定义资源提供程序，否则返回 null，这似乎导致使用默认提供程序。

```
[DesignTimeResourceProviderFactory(typeof(CustomizedResourceProviderDesignTimeFactory))]
public class CustomizedResourceProviderFactory : ResourceProviderFactory
{
    public override IResourceProvider CreateGlobalResourceProvider(string classKey)
    {
        if (classKey == "MyCustomResourceClass")
        {
            return new CustomizedResourceProvider(classKey);
        }
        else
        {
            return null;
        }
    }
    // etc.
} 
```

# css - 可接受的 CSS hacks/修复

> ID：504261
> 
> 赞同：7
> 
> 时间：2009-02-02T18:22:43.427
> 
> 标签：css, shim, css-hack

是否有一个“好的”干净的 CSS hack 列表，它们肯定是面向未来的？

例如，`zoom:1`它是安全的，只要它只提供给 IE，并且你记得它就在那里。使用子选择器的常见技巧*并不*安全，因为 IE7 支持它们。使用`height:1%`感觉很脏（但那可能只是我）。

我知道[ie7-js](http://code.google.com/p/ie7-js/)，所以 IE6 的错误并不让我担心。另外，我不是在寻找宗教辩论，只是寻找来源。

* * *

感谢您的回复 - 我选择了具有最佳来源的答案作为答案。

也感谢使用单独的 CSS 文件的建议，或者不用担心。我完全同意你的看法，对我来说，这些都是给定的。但是当遇到布局问题时，我想要一个安全的修复程序，将我不得不在 $IE 或 $FF + 1 中重新审视问题的风险降到最低。抱歉，我没有说得更清楚。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-02T18:29:22.960

对于大多数 IE 错误，我认为您最好在指向浏览器特定样式表的链接周围使用[条件注释。](http://en.wikipedia.org/wiki/Conditional_comment)它倾向于使事情保持整洁，并且非常自我记录。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-02T18:25:34.343

这是一个记录良好且经过良好测试的浏览器错误的好地方，黑客允许您解决它们：

[http://www.positioniseverything.net/](http://www.positioniseverything.net/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-02T18:33:22.190

对于涉及 CSS 和跨浏览器兼容性的问题，我经常使用 Peter-Paul Koch 的“ [QuirksMode ”网站。](http://www.quirksmode.org/)他倾向于对特定于浏览器的方法不屑一顾，但他确实有一个关于[CSS Hacks](http://www.quirksmode.org/css/csshacks.html)的页面。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-02T19:38:03.073

为 Yahoo Performance 团队工作的[Nicole Sullivan](http://www.stubbornella.org/content/) (AKA *Stubbornella ) 在*[The 7 Habits for Exceptional Perf](http://link.brightcove.com/services/link/bcpid1842749445/bctid1828663478)中建议您应该使用 CSS underscore hack 来修补 IE6 错误，因为：

*   黑客应该很少见。
*   如果您只有 5-6 次 hack（这已经很多了），那么将它们放在外部文件中从而将其与其上下文分开是没有意义的。
*   额外的文件会导致性能损失（[雅虎最佳实践，规则 1](http://developer.yahoo.com/performance/rules.html#num_http)）。

但是应该注意，这不是有效的 CSS。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-02T18:59:30.140

没有像干净/可接受的 [css] hack 这样的东西 - 总是按照标准编写代码，然后使用浏览器+版本特定的样式表来进行任何使事情正常工作所需的 hack。

例如：
`default.css`
`default.ie6-fix.css`
`default.ie7-fix.css`
`default.ff2-fix.css`
等

然后，当发布新版本的浏览器时，复制以前版本的 hack 并删除不再适用的位（并在必要时添加新位）。

（使用 IE 的条件注释和其他浏览器的用户代理嗅探加载单个样式表。）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-02T18:26:14.590

用于 IE6 的 Underscore-hack 效果很好，例如。

```
min-height:50px;
_height:50px; 
```

它不需要将内容脱离上下文移动到新的 css 文件中，只有 IE6 可以获取它们，如果您决定停止支持 IE6，它们很容易被过滤掉。它们也非常小，不会让你的 CSS 变得那么混乱。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-02T19:30:13.090

修改您的 CSS 以获得特定于浏览器的支持永远不会出错 - 只要您可以轻松地包含它。正如您会注意到的，符合标准的浏览器，*咳**除*MSIE 之外的所有内容，都不会在未来的版本中中断。新的 W3C 标准也不会破坏以前的标准，它们通常最多弃用或扩展以前的标准。

人们提到了非常适合处理 IE 的条件注释。但是您需要更多的东西来处理所有浏览器（移动、壁虎、webkit、opera 等）。通常，您将解析传入的请求标头以从 User-Agent 参数中获取浏览器类型和版本。基于此，您可以开始加载 CSS 文件。

我相信我们大多数人的做法是：

*   首先开发一个符合标准的浏览器（我们以 FF 为例）
*   一旦 CSS 完成，您就可以为 IE 提供支持（这可以通过条件注释轻松完成，如前所述）
    *   首先创建一个 CSS 文件，它将为 IE6 和以下任何其他版本微调所有内容
    *   然后创建一个 CSS 文件来处理 IE7 的所有内容
    *   最后，创建一个 CSS 文件来处理 IE8 及更高版本的所有内容
        *   IE9 发布后，确保将 IE8+ 处理设置为特定于 IE8，并创建一个包含所需修复的 IE9+ CSS 文件
*   最后，为 webkit 修复创建一个额外的 CSS 文件
    *   如果需要，您还可以创建其他文件以专门针对 Chrome 或 Safari（如果需要）

关于特定于浏览器的 CSS 实现，我通常将所有这些组合到我的主 css 文件中（如果需要，您可以轻松地搜索它们并在一个文档中替换它们）。所以如果某些东西必须是透明的，我会在同一个块中设置不透明度和过滤器（MSIE）。浏览器只是忽略他们不支持的实现，所以你的安全。我倾向于避免的具体实现是自定义实现（嘿，我喜欢 W3C 上面的 -moz 框，但我只是不想依赖它）。

与 CSS 继承和覆盖一样，您不必重新定义每个 CSS 文件中的所有 CSS 声明和定义。每个连续加载的 CSS 文件应该**只**包含修复所需的选择器和特定定义，没有其他内容。

你最终得到的是你的（巨大的）主 css 文件和其他文件，每个文件包含几行，用于特定的浏览器修复 - 总结起来并不是很难维护和跟踪。这是个人喜好，您的基本 css 文件将基于哪个浏览器，但通常您将定位一个浏览器，该浏览器将为其他浏览器产生最少的问题（所以是的，为 IE6 开发将是一个非常糟糕的决定观点）。

与往常一样，遵循良好实践，对每个类的选择器和细节以及使用框架保持务实和细致，这将引导你走上善意的道路，而很少需要修复。除非您想以无序无意义的混乱结束，否则结构化您的 CSS 文件是一个巨大的优势。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-02T22:14:24.553

[Centricle](http://centricle.com/ref/css/filters/)有一个很好的 CSS hack 列表及其兼容性。

我不认为你会找到一个未来证明的黑客列表，因为知道人们可以知道接下来将在 IE 中实现什么愚蠢的事情。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-12-21T00:16:20.610

这篇文章很好地总结了 CSS hacks：[http ://www.webdevout.net/css-hacks](http://www.webdevout.net/css-hacks)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-01-09T19:49:48.880

这是一个非常稳定的过滤器[列表：](http://en.wikibooks.org/wiki/Cascading_Style_Sheets/Hacks_and_Filters)

```
/* Opera */
.dude:read-only { color: green; } 

/* IE6/IE7 */
@media, 
  { 
  .dude { color: silver;} 
  }

/* IE8  \0 */
@media all\0 
  { 
  .dude { color: brown; } 
  }

/* IE9 monochrome and \9 */
@media all and (monochrome: 0) 
  { 
  .dude { color: pink\9; } 
  }

/* Webkit */
* > /**/ .dude, x:-webkit-any-link { color:red; }
    /* 
    * > /**/ 
    /* hides from IE7; remove if unneeded */

/* Firefox */
@-moz-document url-prefix() 
  { 
  .dude { color: green; }
  } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-02T22:09:01.363

在定义规则时，我发现允许发生自然退化很好，例如，在 CSS3 中支持 RGBA 颜色模型，但在 CSS2 中没有，所以我发现自己在做：

```
 background-color: #FF0000; 
 background-color: rgba( 255,0,0, 50% ); 
```

因此，当后面的规则在不支持它的旧浏览器上失败时，它将降级为先前定义的样式。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-02T22:16:11.273

我更喜欢Hiroki Chalfant 描述的[全局条件注释技术；](http://www.positioniseverything.net/articles/cc-plus.html)

我发现将面向 IE 的规则与面向标准的规则并排保存在一个有效的样式表中很有帮助。

# asp.net - 在 asp.net 控件中分配属性和添加属性之间的区别

> ID：504267
> 
> 赞同：1
> 
> 时间：2009-02-02T18:23:58.463
> 
> 标签：asp.net

我正在动态创建 ASP.NET 文本框控件。我想知道分配控件的属性和将其添加为属性之间的区别。

例如：我可以这样做：

```
TextBox txtBox = new TextBox();
txtBox.MaxLength = 100; 
```

或者我可以

```
txtBox.Attributes.Add("maxlength", "100); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T18:29:23.540

第一个示例是强类型的，因此编译器将检查以确保 a) MaxLength 存在并且 b) 为该属性设置了一个整数。

第二个示例将起作用，但编译器无法检查您添加的属性是否正确。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T18:28:00.420

最后，它们被翻译成 maxlength HTML 属性。TextBox 提供一个属性主要是为了方便。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T18:33:20.643

第一个更好，因为拼写错误或使用错误。第一个也更具可读性。

# mysql - MySQL 二进制与哈希 ID 的非二进制

> ID：504268
> 
> 赞同：26
> 
> 时间：2009-02-02T18:24:00.010
> 
> 标签：mysql, string, binary

假设我想使用哈希作为 ID 而不是数字。`BINARY`将它们存储为非二进制文件会带来性能优势吗？

```
CREATE TABLE `test`.`foobar` (
  `id` CHAR(32) BINARY CHARACTER SET ascii COLLATE ascii_bin NOT NULL,
  PRIMARY KEY (`id`)
)
CHARACTER SET ascii; 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-02T19:01:01.603

是的。哈希摘要通常存储为十六进制数字的 ASCII 表示，例如单词“哈希”的 MD5 是：

```
0800fc577294c34e0b28ad2839435945 
```

这是一个 32 个字符的 ASCII 字符串。

但是 MD5 确实产生了一个 128 位的二进制哈希值。这*应该*只需要将 16 个字节存储为二进制值而不是十六进制数字。因此，您可以通过使用二进制字符串来获得一些空间效率。

```
CREATE TABLE test.foobar (
  id BINARY(16) NOT NULL PRIMARY KEY
);

INSERT INTO test.foobar (id) VALUES (UNHEX(MD5('hash'))); 
```

* * *

关于。您的评论是您更关心性能而不是空间效率：

我不知道 BINARY 数据类型比 CHAR 更快的任何原因。

如果您有效地使用缓存缓冲区，那么一半的大小可能对性能有好处。也就是说，如果字符串是存储相同十六进制值所需的 CHAR 大小的一半，则给定数量的高速缓存内存可以存储两倍多的 BINARY 数据行。同样，该列上索引的缓存内存可以存储两倍。

结果是更有效的缓存，因为随机查询更有可能命中缓存的数据或索引，而不是需要磁盘访问。缓存效率对于大多数数据库应用程序来说都很重要，因为通常瓶颈是磁盘 I/O。如果您可以使用高速缓存来降低磁盘 I/O 的频率，那么这比在一种数据类型或另一种数据类型之间进行选择更划算。

至于存储在 BINARY 中的哈希字符串与 BIGINT 之间的区别，我会选择 BIGINT。缓存效率会更高，而且在 64 位处理器上整数运算和比较应该非常快。

我没有测量数据来支持上述说法。选择一种数据类型而不是另一种数据类型的净收益很大程度上取决于数据库和应用程序中的数据模式和查询类型。要获得最精确的答案，您必须尝试两种解决方案并衡量差异。

* * *

关于。您假设二进制字符串比较比默认的不区分大小写的字符串比较更快，我尝试了以下测试：

```
mysql> SELECT BENCHMARK(100000000, 'foo' = 'FOO');
1 row in set (5.13 sec)

mysql> SELECT BENCHMARK(100000000, 'foo' = BINARY 'FOO');
1 row in set (4.23 sec) 
```

所以二进制字符串比较比不区分大小写的字符串比较快 17.5%。但请注意，在对这个表达式求值 1 亿次之后，总的差异仍然不到 1 秒。虽然我们可以测量速度的相对差异，但速度的绝对差异确实微不足道。

所以我要重申：

*   衡量，不要猜测或假设。你有根据的猜测在很多时候都是错误的。在您进行每次更改之前和之后进行测量，这样您就知道它有多大帮助。
*   将您的时间和精力投入到获得最大收益的地方。
*   不要为小事出汗。当然，一个微小的差异加上足够的迭代次数，但考虑到这些迭代次数，具有更大绝对收益的性能改进仍然是可取的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-02T18:40:36.823

从[手册](http://dev.mysql.com/doc/refman/5.0/en/binary-varbinary.html)：

```
The BINARY and VARBINARY types are similar to CHAR and VARCHAR, except
that they contain binary strings rather than non-binary strings. That is,
they contain byte strings rather than character strings. This means that
they have no character set, and sorting and comparison are based on the
numeric values of the bytes in the values. 
```

由于`CHAR(32) BINARY`会导致在`BINARY(32)`后台创建列，因此好处是按该列排序将花费更少的时间，并且如果该列被索引，则可能更少的时间来查找相应的行。

# c# - ASP.NET 3.5 自定义配置部分不起作用

> ID：504269
> 
> 赞同：0
> 
> 时间：2009-02-02T18:24:03.567
> 
> 标签：c#, asp.net, web-config

我正在尝试使用自定义配置部分，我之前已经成功完成了很多次，但由于某种原因，今天它不起作用。配置部分的代码是：

```
public class RedirectorConfiguration : ConfigurationSection
{
    [ConfigurationProperty("requestRegex", DefaultValue = ".*")]
    public string RequestRegex { get; set; }

    [ConfigurationProperty("redirectToUrl", IsRequired = true)]
    public string RedirectToUrl { get; set; }

    [ConfigurationProperty("enabled", DefaultValue = true)]
    public bool Enabled { get; set; }
} 
```

web.config 中的相关部分是：

```
<?xml version="1.0"?>
<configuration>
    <configSections>
        <section name="httpRedirector" type="Company.HttpRedirector.RedirectorConfiguration, Company.HttpRedirector"/>
    </configSections>
    <httpRedirector redirectToUrl="http://www.google.com" />
</configuration> 
```

我正在尝试使用以下 HttpModule 中的代码：

```
using System;
using System.Configuration;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Text.RegularExpressions;
using System.Web;

namespace Company.HttpRedirector
{
    public class HttpRedirectorModule : IHttpModule
    {
        static RegexOptions regexOptions = RegexOptions.IgnoreCase | RegexOptions.IgnorePatternWhitespace;
        static Regex requestRegex = null;

        public void Dispose() { }

        public void Init(HttpApplication context)
        {
            context.PreRequestHandlerExecute += new EventHandler(context_PreRequestHandlerExecute);
        }

        void context_PreRequestHandlerExecute(object sender, EventArgs e)
        {
            var app = sender as HttpApplication;
            var config = ConfigurationManager.GetSection("httpRedirector") as RedirectorConfiguration;

            if (app == null || app.Context == null || config == null)
                return; // nothing to do

            if (requestRegex == null)
            {
                requestRegex = new Regex(config.RequestRegex,
                    regexOptions | RegexOptions.Compiled);
            }

            var url = app.Request.Url.AbsoluteUri;
            if (requestRegex != null || requestRegex.IsMatch(url))
            {
                if (!string.IsNullOrEmpty(config.RedirectToUrl))
                    app.Response.Redirect(config.RedirectToUrl);
            }
        }
    }
} 
```

发生的事情是配置对象成功返回，但所有标记为“ConfigurationProperty”的属性都设置为空/类型默认值，就好像它从未尝试映射配置文件中的值一样。启动过程中没有异常。

知道这里发生了什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-03T09:24:21.330

您的配置类没有正确的属性。它应该是：

```
 [ConfigurationProperty("requestRegex", DefaultValue = ".*")]
    public string RequestRegex
    {
        get
        {
            return (string)this["requestRegex"];
        }
        set
        {
            this["requestRegex"] = value;
        } 
    } 
```

# security - 哪个更好，白名单或黑名单安全，或两者兼而有之？

> ID：504272
> 
> 赞同：10
> 
> 时间：2009-02-02T18:24:50.990
> 
> 标签：security

我将很快构建一个网络应用程序，我需要一个安全模型，以便不同的用户可以访问应用程序的不同部分和/或应用程序的这些特定部分中的不同数据集。我在以下两种实现安全性的方法之间进行辩论：

**白名单：**默认情况下，用户无权访问任何内容，并且可以访问他们需要的内容。

或者

**黑名单：**默认情况下，用户可以访问所有内容，并且他们的访问权限已从他们不需要的内容中删除。

是否有首选方法的最佳实践？如果有另一种方法可以更好地解决这个问题，那也会很有趣。

谢谢。

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-02-02T18:59:19.127

来自经典论文[“计算机系统中的信息保护”（Saltzer & Schroeder 1975）](http://web.mit.edu/Saltzer/www/publications/protection/)，其中描述了八项重要的设计原则，其中之一是：

> 故障安全默认值：基于权限而不是排除的访问决策。这一原则由 E. Glaser 在 1965 年提出，8 意味着默认情况是无法访问，保护方案确定了允许访问的条件。另一种选择，其中机制试图识别应该拒绝访问的条件，为安全系统设计提供了错误的心理基础。保守的设计必须基于为什么对象应该是可访问的，而不是为什么它们不应该是可访问的。在大型系统中，一些对象将被不充分考虑，因此默认缺少权限更安全。给予明确许可的机制中的设计或实现错误往往会因拒绝许可而失败，这是一种安全的情况，因为它会很快被发现。另一方面，明确排除访问的机制中的设计或实现错误往往会因允许访问而失败，这种失败在正常使用中可能会被忽视。这一原则既适用于保护机制的外观，也适用于其底层实现。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-02-02T18:26:12.470

白名单。使用黑名单，您必须考虑所有可能无效的输入。使用白名单，您只需考虑什么是有效的。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-02T19:59:36.320

让我们想象一下，你有一套一千把门钥匙，你需要让别人进入。

您是否愿意遍历所有钥匙并尝试取出此人绝对不需要的钥匙并将其余的给他们？还是您宁愿只给他们他们绝对需要的钥匙，而拒绝他们剩下的？

哪个更容易出错？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-02T18:26:22.577

安全性始终围绕您所谓的“白名单”构建。把他们锁在外面，只打开他们需要的东西。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-02T20:12:04.517

你不知道你不知道什么。

有很多方法可以逃避用户验证（使用 UTF-8 或其他编码等），并且不止一种方法可以进行跨站点脚本攻击。你确定你能想出涵盖所有可能攻击的黑名单吗？这个列表可能是无限的。

然而，列出好东西的清单要容易得多，因此也更安全。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-02T18:27:48.457

在 Web 应用程序的场景中，我总是使用白名单。通常，给用户的权力过少总比给用户的权力过多好。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-02T18:27:49.610

这样，始终使用白名单，即使您错过了一些您不会受到攻击的东西。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-02T18:27:45.103

悲观的说白名单，乐观的说黑名单。在线，我更看重安全性，所以如果需要白名单/黑名单，一定要加入白名单。

# c++ - 当数组名称在括号中且前面有插入符号指针时，这意味着什么？

> ID：504284
> 
> 赞同：3
> 
> 时间：2009-02-02T18:26:34.263
> 
> 标签：c++

我有一个无符号数字数组，称为 dataArray （实际上在我试图弄清楚的程序中，它们是作为十六进制数字输入的，但我认为这并不重要）。我有另一个 unsigned char 类型的变量，称为 c。

这是做什么的？

```
unsigned int dataArray[]={1,2,3,4,5};
unsigned char c;
x=c^ (dataArray)[i]; 
```

我已经读过插入符号是对 c 的引用，但是当数组名称在括号中时它是什么意思？似乎 x 只是设置为 dataArray 中的第 (i-1) 个元素，但在什么情况下不是这样？

谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-02T18:30:07.280

括号不影响这里的语义。x 计算为 c（此处未定义）和 dataArray[i] 的按位异或。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T19:38:42.277

在某些派生语言中，插入符号用于声明托管指针。它是微软制造的所谓C++/CLI语言，用于.Net。它在普通的 C++ 中没有这个含义。在表达式中，插入符号意味着，正如其他人已经解释的那样，无论如何，按位异或。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T18:32:52.173

此处使用的`^`字符是按位 XOR（请参阅[wikipedia](http://en.wikipedia.org/wiki/Operators_in_C_and_C%2B%2B)）。括号在这里没有任何意义，因为运算符 [] 的优先级高于按位异或。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T19:20:46.977

嗯不错。这在我正在使用的程序中是有意义的。我曾以为插入符号是一个指针，但它是一个 XOR，然后在该行的后面有一个 &（按位与）。该程序用于发送和接收来自电子设备的信号，因此可以预期位级逻辑。非常感谢您的快速回复。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T18:32:38.383

如果这真的是 C++，那么 '^' 是 XOR 位运算符。括号是多余的，在这个例子中什么也不做。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T18:32:55.933

据我所知， ^ 没有超载。如果输入并正确编译，它将尝试 XOR 操作，但在这种情况下，它可能会弄乱您不希望的数据...

# database - 重命名引用表中的 DB 列（违规？）

> ID：504285
> 
> 赞同：1
> 
> 时间：2009-02-02T18:26:51.283
> 
> 标签：database, naming, conventions, acid

假设我有这张桌子：

```
Person table
--------------
PersonId

Address table
------------
AddressId
PersonAddressId 
```

其中 PersonAddressId 是 PersonId 和外键。重命名外键是否存在任何类型的数据库违规？当它们具有不同的名称时，使用起来会变得非常混乱。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T18:51:17.067

在可能的情况下，将外键列命名为与其引用的主键列相同通常会有所帮助。

当然，有时这是不可能的：

*   中的两列`Address`可能都是 的外键`Person`，因此显然您不能同时命名这两列`PersonId`。
*   一些表包含自身的外键，例如`Employee.manager_id`可能是对`Employee.employee_id`. 同样，在这种情况下，您不能将列命名为与引用的主键相同的名称。

SQL 中没有严格的命名约定。建议的元数据命名约定的一个来源是[ISO 11179](http://metadata-standards.org/11179/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T18:32:07.607

同意，这就是为什么约定将 PersonAddressId 命名为 PersonId。

# wpf - Windows 对话框默认标题

> ID：504288
> 
> 赞同：3
> 
> 时间：2009-02-02T18:27:05.587
> 
> 标签：wpf, dialog

是否有内置的默认样式或 WPF 元素可以为我提供下面的等效样式文本“选择连接选项”？

[替代文字 http://i.msdn.microsoft.com/Aa511327.TopRules07(en-us,MSDN.10).png](http://i.msdn.microsoft.com/Aa511327.TopRules07(en-us,MSDN.10).png)

我认为这个标题会改变以匹配应用程序正在运行的操作系统（XP、Vista、7）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T00:57:22.147

这是“主要说明”文本，即

> 12 点 蓝色 (#003399) Segoe UI

根据[文本的 Vista UX 指南](http://msdn.microsoft.com/en-us/library/aa974176.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T00:52:56.247

You will want to consult the Vista UX Guidelines, which outlines things like that: [http://msdn.microsoft.com/en-us/library/aa511258.aspx](http://msdn.microsoft.com/en-us/library/aa511258.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-05-01T05:30:25.310

不在WPF中，不。

您可以使用 Win32 视觉样式 API 中的 GetThemeFont 和 GetThemeColor，但只能在启用视觉样式时使用。经典主题（Windows 经典和高对比度主题）中禁用了视觉样式，因此您需要对此类情况的替代方案进行硬编码。在 Windows SDK 中查找 AeroStyle.xml 以了解经典的后备值是什么。

我在这里写了更多关于此的内容：http: [//blog.quppa.net/2011/04/30/windows-theme-fonts/](http://blog.quppa.net/2011/04/30/windows-theme-fonts/)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-03T14:02:46.430

阅读这篇博文：

[http://blogs.msdn.com/wpfsdk/archive/2008/09/08/custom-window-chrome-in-wpf.aspx](http://blogs.msdn.com/wpfsdk/archive/2008/09/08/custom-window-chrome-in-wpf.aspx)

它包含您想了解的有关更改窗口框架的所有信息，请查看“**扩展玻璃框架**”和“**从标题栏中删除冗余信息**”部分。

# c# - LINQ to XML：将多个级别折叠到单个列表

> ID：504290
> 
> 赞同：3
> 
> 时间：2009-02-02T18:27:08.613
> 
> 标签：c#, linq, c#-3.0, linq-to-xml

我目前正在开发 Silverlight 应用程序，需要将 XML 数据转换为适当的对象以进行数据绑定。本次讨论的基本类定义是：

```
public class TabularEntry
    {
        public string Tag { get; set; }
        public string Description { get; set; }
        public string Code { get; set; }
        public string UseNote { get; set; }
        public List<string> Excludes { get; set; }
        public List<string> Includes { get; set; }
        public List<string> Synonyms { get; set; }
        public string Flags { get; set; }
        public List<TabularEntry> SubEntries { get; set; }
    } 
```

以下是可能用于提供此对象的 XML 示例：

```
<I4 Ref="1">222.2
    <DX>Prostate</DX>
    <EX>
        <I>adenomatous hyperplasia of prostate (600.20-600.21)</I>
        <I>prostatic:
            <I>adenoma (600.20-600.21)</I>
            <I>enlargement (600.00-600.01)</I>
            <I>hypertrophy (600.00-600.01)</I>
        </I>
    </EX>
    <FL>M</FL>
</I4> 
```

因此，各种节点映射到特定属性。这个问题的关键是`<EX>`和`<I>`节点。节点将`<EX>`包含一个或多个`<I>`节点的集合，并且在此示例中匹配上述类定义中的“排除”属性。

挑战来了（对我来说）。我无法控制发出此 XML 的 Web 服务，因此无法更改它。您会注意到，在此示例中，一个`<I>`节点还包含一个或多个`<I>`节点的另一个集合。我希望我可以使用 LINQ to XML 查询，它允许我将两个级别合并到一个集合中，并使用一个字符来分隔较低级别的项目，所以在这个例子中，当 LINQ 查询返回一个 TablularEntry对象，它将包含如下所示的排除项的集合：

*   前列腺腺瘤性增生（600.20-600.21）
*   前列腺：
*   *腺瘤 (600.20-600.21)
*   *放大 (600.00-600.01)
*   *肥大（600.00-600.01）

因此，在 XML 中，最后 3 个条目实际上是第二个条目的子对象，但在对象的 Excludes 属性中，它们都是同一个集合的一部分，前三个子对象包含标识符字符/字符串。

我有我在下面使用的 LINQ 查询的开始，我无法完全弄清楚将为我整合子对象的位。现在存在的代码是：

```
List<TabularEntry> GetTabularEntries(XElement source)
        {
            List<TabularEntry> result;

            result = (from tabularentry in source.Elements()
                         select new TabularEntry()
                         {
                             Tag = tabularentry.Name.ToString(),
                             Description = tabularentry.Element("DX").ToString(),
                             Code = tabularentry.FirstNode.ToString(),
                             UseNote = tabularentry.Element("UN") == null ? null : tabularentry.Element("UN").Value,
                             Excludes = (from i in tabularentry.Element("EX").Elements("I")
                                             select i.Value).ToList()
                         }).ToList();

            return result;
        } 
```

我在想我需要在里面嵌套一个 FROM 语句

> 排除=（来自我...）

声明收集子节点，但不能完全完成。当然，这可能是因为我的逻辑有点混乱。

如果您需要更多信息来回答，请随时提问。

提前致谢，

史蒂夫

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T19:13:05.540

试试这个：

```
 List<TabularEntry> GetTabularEntries(XElement source)
    {
        List<TabularEntry> result;

        result = (from tabularentry in source.Elements()
                  select new TabularEntry()
                  {
                      Tag = tabularentry.Name.ToString(),
                      Description = tabularentry.Element("DX").ToString(),
                      Code = tabularentry.FirstNode.ToString(),
                      UseNote = tabularentry.Element("UN") == null ? null : tabularentry.Element("UN").Value,
                      Excludes = (from i in tabularentry.Element("EX").Descendants("I")
                                  select (i.Parent.Name == "I" ? "*" + i.Value : i.Value)).ToList()

                  }).ToList();

        return result;
    } 
```

**（编辑）**

如果您需要“I”的当前嵌套级别，您可以执行以下操作：

```
 List<TabularEntry> GetTabularEntries(XElement source)
    {
        List<TabularEntry> result;

        result = (from tabularentry in source.Elements()
                  select new TabularEntry()
                  {
                      Tag = tabularentry.Name.ToString(),
                      Description = tabularentry.Element("DX").ToString(),
                      Code = tabularentry.FirstNode.ToString(),
                      UseNote = tabularentry.Element("UN") == null ? null : tabularentry.Element("UN").Value,
                      Excludes = (from i in tabularentry.Element("EX").Descendants("I")
                                  select (ElementWithPrefix(i, '*'))).ToList()

                  }).ToList();

        return result;
    }

    string ElementWithPrefix(XElement element, char c)
    {
        string prefix = "";
        for (XElement e = element.Parent; e.Name == "I"; e = e.Parent)
        {
            prefix += c;
        }
        return prefix + ExtractTextValue(element);
    }

    string ExtractTextValue(XElement element)
    {
        if (element.HasElements)
        {
            return element.Value.Split(new[] { '\n' })[0].Trim();
        }
        else
            return element.Value.Trim();
    } 
```

输入：

```
<EX>
    <I>adenomatous hyperplasia of prostate (600.20-600.21)</I>
    <I>prostatic:
        <I>adenoma (600.20-600.21)</I>
        <I>enlargement (600.00-600.01)</I>
        <I>hypertrophy (600.00-600.01)
            <I>Bla1</I>
            <I>Bla2
                <I>BlaBla1</I>
            </I>
            <I>Bla3</I>
        </I>
            </I>
</EX> 
```

结果：

```
* adenomatous hyperplasia of prostate (600.20-600.21)
* prostatic:
* *adenoma (600.20-600.21)
* *enlargement (600.00-600.01)
* *hypertrophy (600.00-600.01)
* **Bla1
* **Bla2
* ***BlaBla1
* **Bla3 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T19:07:08.453

后代会得到你所有的`I`孩子。这`FirstNode`将有助于将 的`prostatic:`价值与其子项的价值区分开来。的值中有一个返回字符`prostatic:`，我用`Trim`.

```
XElement x = XElement.Parse(@"
<EX>
  <I>adenomatous hyperplasia of prostate (600.20-600.21)</I>
  <I>prostatic:
    <I>adenoma (600.20-600.21)</I>
    <I>enlargement (600.00-600.01)</I>
    <I>hypertrophy (600.00-600.01)</I>
  </I>
</EX>");
//
List<string> result = x
  .Descendants(@"I")
  .Select(i => i.FirstNode.ToString().Trim())
  .ToList(); 
```

这是获取这些星号的一种hacky方法。我没有时间改进它。

```
List<string> result2 = x
  .Descendants(@"I")
  .Select(i =>
    new string(Enumerable.Repeat('*', i.Ancestors(@"I").Count()).ToArray())
    + i.FirstNode.ToString().Trim())
  .ToList(); 
```

# ide - 增量粘贴插件？

> ID：504296
> 
> 赞同：3
> 
> 时间：2009-02-02T18:28:01.887
> 
> 标签：ide, plugins, text-editor, clipboard

我知道经常使用 for 循环生成重复内容比粘贴 20 次内容并手动将每次粘贴更改为正确的数字更好。但是，假设内容是硬编码的，我只想要一个 1-20 的列表。

我想要一个带有“智能”粘贴命令的文本编辑器，该命令可以在剪贴板上的字符串中嵌入任何数字，并在每次粘贴时递增。如果它不存在，我会做一个插件。

我正在想一个很好的 2-stroke 键盘快捷键来做到这一点，靠近 ctrl-V。也许 ctrl-g 或 numpad_+ （在没有缩放的应用程序中）。

它存在吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T23:14:04.430

在[Zeus](http://www.zeusedit.com)中，这可以很容易地完成，如下所示：

1.  列标记要转换为数字的区域
2.  使用*宏，执行脚本*菜单
3.  输入*数字*运行[数字](http://www.zeusedit.com/forum/viewtopic.php?t=2092)Lua 宏
4.  输入序列的*第一个数字*

标记区域将替换为从步骤 4 中提供的*第一个数字开始的递增数字序列。*

> 我正在想一个好的 2-stroke 键盘快捷键来做到这一点，

将其变成按键动作就像将[数字](http://www.zeusedit.com/forum/viewtopic.php?t=2092)Lua 宏绑定到键盘一样简单。

这是它如何工作的示例。如果下面文本中的*1*值被标记为列，并且宏以起始编号*1000*执行：

```
Field_1
Field_1
Field_1
Field_1 
```

将进行以下文本更改：

```
Field_1000
Field_1001
Field_1002
Field_1003 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T18:36:55.800

[Armed Bear J](http://armedbear.org/j.html)有一个重新编号区域命令，以及一个保留大小写的替换文件，这意味着我经常为这些功能保留它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T18:40:54.297

TextPad 是另一个具有填充区域功能的文本编辑器，用于填充字符、字符串或递增数字（从 X 开始，左对齐或右对齐，空格或零填充。）

我现在使用 Notepad++，但我必须保留 TextPad 只是为了实现数字填充功能。

# asp.net - 最佳实践：ASP.NET 中的 CSS 或主题？

> ID：504299
> 
> 赞同：14
> 
> 时间：2009-02-02T18:28:20.310
> 
> 标签：asp.net, css, themes

什么时候应该使用 ASP.NET 主题，什么时候应该使用 CSS？使用其中一种的优点或缺点是什么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-02T18:37:38.263

我建议在主题上使用 CSS。这样做的原因是在 CSS 中，您可以修改样式以使其适用于所有浏览器。你可以对主题做同样的事情，但微软的设计师因修复你修复的东西而臭名昭著，以使它们在所有浏览器上都能工作，因此适得其反。坚持使用 CSS，你会花更少的时间在胡闹上。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-02T18:34:56.087

一起更好！

但是主题不是 CSS 的替代品，或者它们不是为与 CSS 相同的目的而构建的。它的目的是在您的应用程序上定义不同的主题并用一行来更改它们。主题可以包括 CSS 文件、图像文件和皮肤。

使用皮肤，您可以定义 asp.net 控件的样式，因此它包含复杂而完整的解决方案。例如，您可以定义一个 gridview 并定义它的样式和属性。您可以在应用程序范围内定义它。

所以你我认为他们在一起更好，但不等于比较。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-08-05T16:34:10.510

If you are considering to hire an external design agency or designer you are much better off with CSS, since CSS is well known to them - since Themes are much more developer/VS centric.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T18:54:17.200

如果您使用会员、个人资料和个性化，主题会非常方便。除此之外，是的，Visual Studio 设计器是臭名昭著的。如果您考虑到浏览器兼容性，则应该广泛使用 CSS。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T19:12:15.403

如前所述，它们并不相互排斥。我有机会拥有多个主题，这些主题本身包含自己的一组 CSS/Media/Skin 文件，这些文件根据站点配置是适当的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-06T19:51:26.457

You should combine them. Use your css files in the theme folder for your normal styling of all the html elements in your website (include all the generated elements).

In the skin file of a control, you can set the default css class. Other properties like the layout and default behavior of the elements (sample: calender control) are editable here too.

Skin files are good for all layout specific configuration you can't easily do with css, but with the .net properties of the controls.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-10-30T10:25:36.477

Well i would recommend using both together, i use the theme to set the css classes on controls and then style them in the css files. Example:

Skin:

```
<asp:CompareValidator runat="server" Text="*" CssClass="Validator" Display="Dynamic" />
<asp:RangeValidator runat="server" Text="*" CssClass="Validator" Display="Dynamic" />
<asp:CustomValidator runat="server" Text="*" CssClass="Validator" Display="Dynamic" />
<asp:RegularExpressionValidator runat="server" Text="*" CssClass="Validator" Display="Dynamic" />
<asp:RequiredFieldValidator runat="server" Text="*" CssClass="Validator" Display="Dynamic" />
<asp:ValidationSummary runat="server" CssClass="ValidationSummary" /> 
```

Css:

```
.Validator
{
    color: Red;   
}

.ValidationSummary
{
    font-size: 0.8em;
}

.ValidationSummary > ul
{
    list-style-type: disc;
    padding: 0 0 0 15px; 
    margin: 0;
}

.ValidationSummary > ul > li
{
    padding: 0;
    margin: 0;
    color: Red;
} 
```

# sql - 用于 OLTP 的 Sql 2005 锁定 - 已提交还是未提交？

> ID：504323
> 
> 赞同：1
> 
> 时间：2009-02-02T18:33:22.063
> 
> 标签：sql, sql-server-2005, locking, deadlock

我公司聘请来解决死锁问题的 DBA 刚刚告诉我，如果我们将事务级别从 READ UNCOMMITTED 设置为 READ COMMITTED，我们的 OLTP 数据库锁定问题将会得到改善。

这不是100％错误吗？READ COMMITTED 会导致更多的锁，对吗？

* * *

更多细节：

我们的数据非常“孤立”且用户特定。99.9999999% 的用户交互都使用您自己的数据，而我们的脏读场景（如果发生）几乎不会影响用户尝试执行的操作。

* * *

感谢所有答案，有问题的 dba 最终变得无用，我们通过添加单个索引解决了锁定问题。

* * *

我很遗憾我没有指定更新语句而不是常规选择发生的锁定问题。从我的谷歌搜索来看，两种不同的查询类型在处理锁定问题时有不同的解决方案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T19:03:12.893

这听起来确实有点轻率的决定，但是如果没有您环境的所有细节，就很难说。

您应该建议您的 DBA 考虑使用 SQL Server 的高级隔离功能，即使用行版本控制技术。这被引入到 SQL Server 2005 以专门解决遇到高锁定的 OLTP 数据库的问题。

以下白皮书包含相当复杂的主题，但它是所有优秀 DBA 的必读之物。它包括如何在不同类型的环境（即 OLTP、卸载报告环境等）中使用每个附加隔离级别的示例。

[http://msdn.microsoft.com/en-us/library/ms345124.aspx](http://msdn.microsoft.com/en-us/library/ms345124.aspx)

总而言之，如果没有首先深入了解过度锁定在您的环境中是如何发生的，就修改所有 T-SQL 查询的事务隔离是愚蠢和轻率的。

我希望这会有所帮助，但如果您需要进一步澄清，请告诉我。

干杯!

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T18:58:04.433

这不取决于您的问题是什么：例如，如果您的问题是死锁，锁定级别的增加可能不会导致更早获得锁，从而降低致命拥抱的可能性吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-04T02:43:01.530

如果数据是孤立的并且您仍然遇到死锁，那么您可能只需要向导致问题的查询添加行锁提示，以便在行级别而不是页级别（这是默认设置）获取锁。

如果您因为 SELECT 语句而锁定数据，READ UNCOMMITTED 将减少锁定的数量。如果您因为 INSERT、UPDATE 和 DELETE 语句而锁定数据，那么将隔离级别更改为 READ UNCOMMITTED 不会为您做任何事情。READ UNCOMMITTED 与在查询中添加 WITH (NOLOCK) 具有相同的效果。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T19:06:30.423

这听起来很可怕。您真的只想更改这些参数以避免死锁吗？也许需要锁定数据？

也就是说，DBA 可能指的是新的（自 SQL Server 2005 起）READ COMMITTED SNAPSHOT，它使用行版本控制并且可以消除某些类型的死锁。

[http://www.databasejournal.com/features/mssql/article.php/3566746/Controlling-Transactions-and-Locks-Part-5-SQL-2005-Snapshots.htm](http://www.databasejournal.com/features/mssql/article.php/3566746/Controlling-Transactions-and-Locks-Part-5-SQL-2005-Snapshots.htm)

# sql-server - 跟踪文件 - 如何使用它

> ID：504326
> 
> 赞同：2
> 
> 时间：2009-02-02T18:33:46.307
> 
> 标签：sql-server, crash, trace, sql-server-profiler

我们有一个在 IIS 6/ASP.NET 2.0 上运行的应用程序，该应用程序由 SQL Server 2005 STD 版本 X64 支持。有时，应用程序会因一些愚蠢的消息而崩溃（某些文件未在“select firled1, filed2.. from mytable”中找到）。当应用程序报告错误时，我从 sql server 获取了活动跟踪。注意：只有在服务器负载过重时才会遇到崩溃，例如多个用户同时创建一些报告。

问题是：如何使用跟踪文件来解决这种情况？如何检测出问题所在？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-21T18:14:46.483

我在 SQLServerPedia上有一个[关于 Profiler 入门的视频教程。](http://sqlserverpedia.com/wiki/Using_SQL_Server_Profiler "SQL Server Profiler 入门视频")简而言之，您需要将该跟踪文件导出到一个表中，然后单步执行以查看弹出的错误。Profiler 的跟踪文件或跟踪表本身不会说“这是您需要修复的内容以避免此错误”，就像转储文件会告诉您“这是错误的代码行”一样 - 您仍然需要一位经验丰富的 DBA 来解释结果。您可能希望将跟踪文件带到您当地的 SQL Server 用户组会议上，看看是否有人可以帮助您。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T19:25:56.717

好的，您需要将跟踪数据转换为可以查询的形式，即表格。

以下是有关如何将跟踪文件加载到 SQL Server 表中的详细信息。

[http://support.microsoft.com/kb/270599](http://support.microsoft.com/kb/270599)

然后，您需要确定导致您的问题的事件。在跟踪中搜索您感兴趣的数据库中发生的事件以及在您遇到错误时发生的事件。

以下链接为 SQL Server Profiler/Trace 信息提供了一个很好的起点。

[http://msdn.microsoft.com/en-us/library/ms187929.aspx](http://msdn.microsoft.com/en-us/library/ms187929.aspx)

通读这个，如果你卡住了，请告诉我。

干杯，

# sql-server - 通过 SSIS 创建和复制访问表到 SQL？SQL 2008

> ID：504330
> 
> 赞同：2
> 
> 时间：2009-02-02T18:35:00.127
> 
> 标签：sql-server, ms-access, ssis, upsizing

我正在尝试想出一种方法将表从 Access 数据库中拉出，在 SQL 2008 DB 中自动创建这些相同的表，并将数据移动到新表中。这个过程会定期发生，每次可能会有不同的表格。

我想完全在 SSIS 中做到这一点。

C# SQL CLR 对象是一个选项。

我遇到的主要问题是如何获取 Access 表的架构，然后将其转换为可以通过 SSIS 运行的 SQL 脚本。

有任何想法吗？

蒂亚杰

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T19:31:23.633

SSIS 无法在运行时适应新表。（您可以更改连接，将源移动到具有不同名称但架构相同的表）因此，我认为您所说的操作并不容易：将 Access DB 中的任意一组表升级为 SQL（镜像它们的结构和数据、命名等），这样我就可以编写一些直接的 SQL 将数据转换到另一个 SQL 数据库或数据库的同一部分。

您可以从 C# 访问 SSIS 对象模型并以编程方式构建包（或修改模板包），然后执行它。这可能会物有所值，但 SSIS 对象模型有点深。SSIS 团队博客[终于开始提供示例](http://blogs.msdn.com/mattm/archive/2008/12/30/samples-for-creating-ssis-packages-programmatically.aspx)（一年后我不得不为自己解决很多问题）

总是有升迁向导，我敢肯定有一些第三方工具。

# java - 如何在 JMockit 中使用通用对象模拟方法？

> ID：504332
> 
> 赞同：4
> 
> 时间：2009-02-02T18:35:16.367
> 
> 标签：java, generics, mocking, jmockit

如果您知道如何使用 JMockit，这个问题是不言自明的：如何模拟具有泛型的方法？我想模拟这个方法： public T save(T entity) 但它总是抛出这样的异常：

```
mockit.RealMethodNotFoundForMockException: Corresponding real methods not found for the following mocks:
Object save(Object)
    at mockit.internal.RedefinitionEngine.modifyRealClass(RedefinitionEngine.java:130)
    at mockit.internal.RedefinitionEngine.modifyRealClass(RedefinitionEngine.java:88)
    at mockit.internal.RedefinitionEngine.redefineMethods(RedefinitionEngine.java:72)
    at mockit.Mockit.setUpMocks(Mockit.java:197)
    at com.mytest.MyTest.setUp(AdminManagerImplTest.java:83) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2015-03-17T16:00:57.090

只是为了完整起见：

我在 Java 1.6 模式、TestNG 和 jMockit 1.5 和 1.16 中使用类的方法内 MockUp<...> 时遇到了类似的问题。

我的课：

`public class MyCache extends AbstractLazyCache<ExchangeObject> {...}`

模拟方法：

```
 public abstract class AbstractLazyCache<CachedObject> extends AbstractCache {
      // ...

      protected void putCachedObject(String tenantId, String objectId, CachedObject o, Date expiryDate) {...}
  } 
```

原始模拟尝试：

```
 new MockUp<MyCache>() {
        // invoked once manually, once on expired cache
        @Mock(invocations = 2)
        public void putCachedObject(Invocation inv, String tenantId, String objectId,
                RangeExchange o, Date expiryDate) {
            // expire one second in the future
            inv.proceed(tenantId, objectId, o, new Date(System.currentTimeMillis() + waitTimeMillis));
        }
    }; 
```

我有一个类似的例外。通过在 public 之后添加一个**额外的泛型参数**，我的测试用例终于成功了：

```
 new MockUp<MyCache>() {
        // invoked once manually, once on expired cache
        @Mock(invocations = 2)
        public <RangeExchange> void putCachedObject(Invocation inv, String tenantId, String objectId,
                RangeExchange o, Date expiryDate) {
            // expire one second in the future
            inv.proceed(tenantId, objectId, o, new Date(System.currentTimeMillis() + waitTimeMillis));
        }

    }; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T19:41:10.883

它对我有用，例如

```
包一个；

导入 junit.framework.TestCase；
导入 mockit.Mockit；

公共类 JMockitCoreExampleTest 扩展 TestCase {

    公共类 MockMe {
        公共T保存（T t）{
            返回空值；
        }
    }

    公共无效 testDoOperationAbc() {
        Mockit.redefineMethods(MockMe.class, SayThatYouMockMe.class);
                MockMe 模拟 = 新的 MockMe();
        System.out.println(mock.save("aaa"));
    }

    公共静态类 SayThatYouMockMe {
        公共T保存（T t）{
            返回 t;
        }
    }
}

```

输出

```
加载的外部工具：mockit.integration.junit3.JUnitTestCaseDecorator
加载的外部工具：mockit.integration.junit4.JUnit4ClassRunnerDecorator
啊啊啊

```

也许你在嘲笑hibernate的保存方法？如果是这样，请尝试使用 jmockit 的 hibernate3emul.jar

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T21:04:45.440

我认为您的问题可能是您的泛型类型签名与您尝试模拟的方法不匹配。请记住，泛型类型信息在运行时不可用，因此 JMockit 只能看到擦除泛型类型信息所产生的方法。

例如，假设您有以下签名：

```
public <T> void foo(T param) {
  ...
} 
```

编译器将其转换为：

```
public void foo(Object param) {
  ...
} 
```

这是出现在字节码中的签名，也是 JMockit 通过反射看到的。

相比之下，以下签名：

```
public <T extends Map> foo(T param) {
  ...
} 
```

擦除到：

```
public void foo(Map param) {
  ...
} 
```

因此，例如，如果您的模拟实现使用第一个签名，而实际类使用第二个签名，则底层擦除将不匹配，并且 JMockit 将无法找到该方法。

有关更多信息，请参见[http://today.java.net/pub/a/today/2003/12/02/explorations.html](http://today.java.net/pub/a/today/2003/12/02/explorations.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-28T13:40:54.213

也许你和我有同样的星座：

我尝试模拟方法`<T> T merge(T t)`并`org.hibernate.ejb.EntityManagerImpl`得到相同的 Mockit 错误。

```
Mockit.redefineMethods(EntityManagerImpl.class, EntityManagerImplMock.class); 
```

我的错是合并方法不是在它的超类中声明的，`org.hibernate.ejb.EntityManagerImpl`而是在它的超类中声明的`AbstractEntityManagerImpl`。我现在有

```
Mockit.redefineMethods(AbstractEntityManagerImpl.class, EntityManagerImplMock.class); 
```

和

```
public static class EntityManagerImplMock {
    public <T> T merge(final T o) {
        // nothing
        return o;
    }
} 
```

一切正常。

# algorithm - 实现二分查找有哪些陷阱？

> ID：504335
> 
> 赞同：61
> 
> 时间：2009-02-02T18:35:44.323
> 
> 标签：algorithm, binary-search

二进制搜索比看起来更难实现。“虽然二分搜索的基本思想相对简单，但细节却出奇地棘手……”——唐纳德·克努斯。

哪些错误最有可能被引入到新的二分搜索实现中？

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2011-06-18T01:49:15.377

这个问题[最近又被问到了](https://stackoverflow.com/questions/6372037/binary-search-problems)。除了 Knuth 的名言“虽然二分搜索的基本思想比较简单，但细节可能出奇地棘手”，还有一个惊人的历史事实（参见 TAOCP，第 3 卷，第 6.2.1 节），二分搜索首次发表于1946 年，但第一次发布*没有错误*的二进制搜索是在 1962 年。Bentley 的经验是，当他在贝尔实验室和 IBM 等地的专业程序员课程中分配二进制搜索并给他们两个小时时，每个人都报告说他们做对了，在检查他们的代码时，90% 的人年复一年地有错误。

除了鲟鱼定律之外，这么多程序员在使用二分搜索时出错的根本原因可能是他们不够小心：*Programming Pearls*将其引用为“编写代码，将其扔到墙上，然后获得质量保证或测试协议”与错误”的方法。并且有很大的错误空间。不仅仅是这里的其他几个答案提到的溢出错误，还有逻辑错误。

下面是一些二进制搜索错误的示例。这绝不是详尽无遗的。（正如托尔斯泰在《*安娜·卡列尼娜*》中所写——“所有幸福的家庭都是相似的；每个不幸的家庭都各有各的不幸”——每一个不正确的二分搜索程序都有其不正确的一面。）

## 帕蒂斯

以下 Pascal 代码取自 Richard E Pattis 的论文*Textbook errors in binary search* (1988)。他看了二十本教科书，想到了这个二分搜索（顺便说一句，Pascal 使用从 1 开始的数组索引）：

```
PROCEDURE BinarySearch (A         : anArray,
                        Size      : anArraySize,
                        Key       : INTEGER,
                        VAR Found : BOOLEAN;
                        VAR Index : anArrayIndex);
Var Low, High : anArrayIndex;
BEGIN         
   LOW := 1;
   High := Size;

   REPEAT
      Index := (Low + High) DIV 2;
      If Key < A[Index]
         THEN High := Index - 1
         ELSE Low  := Index + 1
   UNTIL (Low > High) OR (Key = A[Index]);

   FOUND := (Low <= High)
END; 
```

看起来好吗？这有不止一个错误。在进一步阅读之前，看看你是否能找到它们。即使您第一次看到 Pascal，您也应该能够猜到代码的作用。

* * *

他描述了许多程序存在的五个错误，尤其是上述错误：

**错误 1**：它不在 O(log n) 时间内运行，其中 n = 大小。出于对正确编程实践的热情，一些程序员将二进制搜索编写为一个函数/过程，并将其传递给一个数组。（这不是 Pascal 特有的；想象在 C++ 中通过值而不是通过引用传递向量。）这只是将数组传递给过程的 Θ(n) 时间，这违背了整个目的。更糟糕的是，一些作者显然给出了*递归*二进制搜索，每次都传递一个数组，运行时间为 Θ(n log n)。（这并不牵强；我实际上见过这样的代码。）

**错误 2**：当 size = 0 时失败。这可能没问题。但是根据预期的应用程序，正在搜索的列表/表*可能会*缩小到 0，并且必须在某个地方进行处理。

**错误3**：它给出了错误的答案。每当循环的最终迭代以 Low=High 开始时（例如，当 Size=1 时），它设置 Found:=False，即使`Key`在数组中也是如此。

**错误 4**`Key` ：只要小于数组的最小元素，就会导致错误。（`Index`变为 1 后设置`High`为 0 等；导致越界错误。）

**错误 5**`Key` ：只要大于数组的最大元素，就会导致错误。（`Index`变为之后`Size`，它设置`Low`为 Size+1 等；导致越界错误。）

他还指出，“修复”这些错误的一些明显方法也被证明是错误的。现实生活中的代码也经常有这个属性，当程序员写了一些不正确的东西，发现了一个错误，然后“修复”它直到它*看起来*正确而没有仔细考虑。

在他尝试的 20 本书中，只有 5 本书有正确的二分查找。在剩下的 15 个（讽刺的是，他说 16 个）中，他发现了 11 个错误 1 ​​实例，6 个错误 2 实例，错误 3 和 4 各两个，以及错误 5 一个。这些数字加起来远远超过 15，因为其中几个有多个错误。

* * *

## 更多示例

二进制搜索不仅仅用于搜索一个数组以查看它是否包含一个值，所以这里还有一个示例。当我想到更多时，我可能会更新此列表。

假设您有一个递增（非递减）函数 f：R->R，并且（例如，因为您想要 f 的根），您想要找到最大的`t`使得`f(t) < 0`. 看看你能在下面找到多少错误：

```
float high = INF, low = 0;
while(high != low) {
   float mid = (low + high)/2;
   if(f(mid)>0) high=mid;
   else low=mid;
}
printf("%f", high); 
```

（有些：[0,INF] 中可能没有这样的 t，如果`f`在某个区间上为 0，那么这是错误的，永远不要比较浮点数是否相等等）

## 如何编写二分查找

我曾经犯过几个这样的错误——前几十次我写了二分搜索（那是在时间压力的编程比赛中），大约 30% 的时间在某个地方有一个错误——直到我找到了写它的简单方法正确。从那以后（我记得）我没有错误地进行二分搜索。诀窍很简单：

> **保持不变。**

查找/决定并明确说明您的“低”和“高”变量在整个循环中满足的一些不变属性：之前、期间和之后。确保它永远不会被违反。当然你还需要考虑终止条件。这在*Programming Pearls*的第 4 章中有详细的解释，它从半形式化方法*派生了一个二分搜索程序。*

例如，为了稍微抽象出正在检查的条件，假设您想找到`x`某个条件`poss(x)`为真的最大整数值。即使是问题定义的这种明确性也超出了许多程序员的起点。（例如，`poss(x)`可能是`a[x] ≤ v`某个值`v`；这是找出排序数组中有多少元素`a`大于`v`，比如说。）然后，编写二进制搜索的一种方法是：

```
int lo=0, hi=n;
//INVARIANT: poss(lo) is true, poss(hi) is false
//Check and ensure invariant before starting binary search
assert(poss(lo)==true);
assert(poss(hi)==false);
while(hi-lo>1) {
    int mid = lo + (hi-lo)/2;
    if(poss(mid)) lo = mid;
    else hi = mid;
}
printf("%d \n",lo); 
```

您可以添加更多的断言语句和其他检查，但基本思想是，因为您*仅*在知道这是真的时才更新`lo`到，所以您保持始终为真的不变量。同样，您设置为仅当为假时，因此您保持始终为假的不变量。单独考虑终止条件。（注意 when为 1，与 相同。所以不要将循环写为，否则会出现无限循环。）在循环结束时，保证最多为 1，因为你总是保持你的不变量（是真的并且`mid` *`poss(mid)``poss(lo)``hi``mid``poss(mid)``poss(hi)``hi-lo``mid``lo``while(hi>lo)``hi-lo``poss(lo)``poss(hi)`为假），它不能为 0。另外，由于您的不变量，您知道这`lo`是返回/打印/使用的值。当然，还有其他编写二进制搜索的方法，但维护不变量是一种总是有帮助的技巧/纪律。*

 ** * *

## 回答 #2

> 赞同：35
> 
> 时间：2009-02-02T18:38:29.590

以下是我能想到的一些：

*   **在确定下一个区间的边界时**出现逐一错误****
***   **重复项的处理**，如果您想返回数组中的第一个相等项，而是返回一个后续相等项*   **计算索引时的数值下溢/溢出**，具有巨大的数组*   **递归*与*非递归**实现，您应该考虑的设计选择**

 **这些是你心目中的吗？

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-02-02T18:41:02.330

[读这个](http://googleresearch.blogspot.com/2006/06/extra-extra-read-all-about-it-nearly.html)。Java 的二进制搜索实现在任何人发现它之前隐藏了将近十年的错误。

该错误是整数溢出。它没有引起人们的问题，因为几乎没有人在搜索足够大的数据结构。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-04-23T06:14:38.913

人们无法正确实现二分搜索的一个关键原因是我们**没有很好地描述二分搜索，这是一个定义明确的问题，但通常没有很好地定义它。**

一个普遍的规则是从失败中学习。在这里，考虑“无效”案例有助于澄清问题。如果输入为空怎么办？如果输入包含重复项怎么办？每次迭代我应该通过一个条件测试还是两个测试（加上提前终止的额外测试）来实现它？以及其他技术问题，例如计算索引中的数值溢出/下溢，以及其他技巧。

正如@Zach Scrivena 指出的那样，可以通过很好地描述问题来避免的错误是一个错误和重复项目的处理。

许多人将二进制搜索视为在给定排序数组的情况下找到目标值。这就是二进制的使用方式，而不是二进制搜索本身。

**我将尝试给出二进制搜索的相对严格的定义/公式，并展示一种**通过遵循一种特定方法来解决一个错误和重复问题的方法，这当然不是新的。

```
# (my) definition of binary search:
input: 
    L: a 'partially sorted' array, 
    key: a function, take item in L as argument
prerequisite: 
    by 'partially sorted' I mean, if apply key function to all item of L, we get a 
    new array of bool, L_1, such that it can't be partitioned to two left, right blocks, 
    with all item in left being false, all item in right being true. 
    (left or/and right could be empty)
output: 
    the index of first item in right block of L_1 (as defined in prerequisite). 
    or equivalently, the index of first item in L such that key(item) == True 
```

这个定义自然地解决了重复问题。

通常有两种方式来表示数组，[] 和 [)，我更喜欢后者，[) 的等价方法是使用 (start, count) 对。

```
# Algorithm: binary search
# input: L: a 'partially sorted' array, key: a function, take item in L as argument
    while L is not empty:
        mid = left + (right - left)/2  # or mid = left + count/2
        if key(mid item) is True:
            recede right # if True, recede right
        else:
            forward left # if False, forward left
    return left 
```

因此，如果您将**“如果为真，则后退（结束）”**和**“如果为假，则向前（开始）”**部分正确，您几乎完成了。我称之为**二分搜索的“FFTR 规则”。**如果要找到第一个项目，如上面的定义，左边将是开始，但是如果你要找到最后一个项目，右边将是开始。如果你符合 [) 时尚，那么一个可能的实现是，

```
while left<right:
    mid = left + (right - left)/2
    if key(L(mid)) == True:
        right = mid
    else:
        left = mid+1
    return left 
```

让我们进一步验证它，首先显示收敛，然后显示正确性。

**收敛：**

```
whenever left == right, we exit loop (also true if being empty at the first)

so, in the loop, if denote, 

    diff = (right - left)/2, 

    lfstep = 1 + diff/2, 'lfstep' for 'left index forward step size'

    rbstep = diff - diff/2, 'rbstep' for 'right index back (recede) step size'

it can be show that lfstep and rbstep are alway positive, so left and right 
will be equal at last. 

both lfstep and rbstep are asymptotically half of current subarray size, so it's 
of logarithm time complexity. 
```

**正确性：**

```
if the input array is empty:
    return the left index;
else:
    if key(mid item) is true:
        "recede right"
        so mid and all item after mid are all true, we can reduce the search range 
        to [left, mid), to validate it, there are two possible cases,
        case 1:
            mid is the first item such that key(item) is True, so there are no true items 
            in new search range [left, mid), so the test will always be false, and we 
            forward left at each iteration until search range is empty, that is  
            [finalleft,mid), since we return finalleft, and finalleft == mid, correctly done!
        case 2:
            there are item before mid such that key(item) is True,
            in this case we just reduce to a new problem of smaller size
    else:
        "forward left"
        mid and all item before mid is false, since we are to find the first true one, 
        we can safely reduce to new search range [mid+1, right) without change the result. 
```

等效（开始，计数）版本，

```
while count>0:
    mid = start + count/2
    if key(L[mid]) == True:
        right = mid
    else:
        left = mid+1
return left 
```

**总结一下**，如果符合 [) 约定，

```
1\. define your key function of your problem, 
2\. implement your binary search with "FFTR rule" -- 
    "recede (end) if True ( key(item) == True) else forward (start)" 
    examples:
        if to find a value target, return index or -1 if not found,
        key = lambda x: x>=target, 
        if L[found_index] == target: return found_index
        else: return -1 
```

至于通过额外的测试提前终止，我认为不值得，但你可以试试。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T18:41:23.547

在计算两个索引之间的中点时，如果不考虑将高值和低值相加，可能会导致整数溢出。

[参考](http://googleresearch.blogspot.com/2006/06/extra-extra-read-all-about-it-nearly.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-02-24T19:18:08.360

现代处理器的流水线架构更适合进行线性搜索，而不是进行具有大量决策和分支的二进制搜索。

因此，一个常见的**性能错误**和**过早的优化**（你知道，这些是万恶之源）是使用二进制搜索，而简单的线性搜索会更快，当然更简单。

根据读取的数量，即使对数据进行排序也会使事情变慢。对于简单的键（例如 32 位整数），线性和二进制之间的收支平衡点很容易达到 1000 个元素。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-09-06T06:43:20.823

> 我在实现二分搜索时遇到的一个错误是在计算中间元素时整数范围溢出。众所周知，二分查找实现的步骤是：

1.  找到中间元素。
2.  检查是否：

*   目标元素大于中间元素，从中间+1搜索到结束索引
*   目标元素小于中间元素，从start到mid-1索引搜索
*   目标元素等于中间元素，返回索引。

在上述所有步骤中，都会重新计算中间元素。现在，中间元素被发现为： mid = (start+end)/2 现在，如果结束索引太高（对于非常大的数组），它可能会溢出 INT 范围。所以，一个更好的方法是：mid = start + (end-start)/2

如果您仔细检查，最终它会给我们相同的值，但我们摆脱了可能遇到的溢出问题。

> 此外，正如我们所知，二进制搜索只能在排序列表上实现。假设在问题中说明输入列表已排序，但未提及它是按升序还是降序排列。在这种情况下，您可能需要添加一个额外的条件来检查它。

# java - hibernate中Set和Collection的区别

> ID：504337
> 
> 赞同：1
> 
> 时间：2009-02-02T18:36:06.770
> 
> 标签：java, hibernate

在我的休眠实体对象上为 @OneToMany 或 @ManyToMany 属性使用 Set 或 Collection 有什么区别？

Hibernate 会根据您选择的不同映射事物吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T18:47:26.827

在休眠的上下文中，以下是您将使用 Set 而不是 Collection 的场景：-

“从 Order as orders left 获取 join orders.orderLineItems as orderLineItems ORDER BY orders.id DESC”

它返回重复项，因此使用散列集删除它们。

查询查询 = session.getNamedQuery("OrdersAndLoadLineItems"); 设置 set = new LinkedHashSet(); set.addAll(query.list());
返回集；

这取自 Hibernate FAQ 链接是[http://www.hibernate.org/117.241.html](http://www.hibernate.org/117.241.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T18:40:12.207

如果您查看[API](http://www.hibernate.org/hib_docs/v3/api/org/hibernate/mapping/Set.html) `Set`扩展`Collection`。根据描述，Set 不允许空值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T18:40:20.240

Collection 是一个接口，不能被实例化。Set 也是一个接口。

因此，您使用什么并不重要，只要您使用的实例化对象与那些兼容即可。

所以通常，你会做这样的事情：

```
private Set parts = new HashSet(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T18:41:39.130

集合比集合更通用。Set 是 Collection 的更具体的子接口。见[这里](http://www.hibernate.org/hib_docs/reference/en/html/collections.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-22T13:21:23.027

我不知道有什么区别，但是如果你使用 Set 你可以在 JPA 中获取多个包，但是如果你使用 List，例如，你不能在一个查询中获取多个包。

# function - 使用 Lua 访问函数的主体

> ID：504338
> 
> 赞同：11
> 
> 时间：2009-02-02T18:36:21.637
> 
> 标签：function, debugging, lua, function-pointers, visualizer

我将回到这里的基础知识，但在 Lua 中，您可以像这样定义一个表：

```
myTable = {}
myTable [1] = 12 
```

打印表引用本身会带回一个指向它的指针。要访问它的元素，您需要指定一个索引（即，就像您使用数组一样）

```
print(myTable )    --prints pointer
print(myTable[1])  --prints 12 
```

现在函数是一个不同的故事。您可以像这样定义和打印函数：

```
myFunc = function() local x = 14 end     --Defined function
print(myFunc)                            --Printed pointer to function 
```

有没有办法访问已定义函数的主体。我正在尝试组合一个小型代码可视化器，并希望使用特殊函数/变量“播种”给定函数，以允许可视化器将自身“挂钩”到代码中，我需要能够重新定义该函数变量或字符串。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-02T21:35:39.857

在普通 Lua 中无法访问给定函数的主体源代码。源代码在编译为字节码后被丢弃。

注意顺便说一句，该函数可以在运行时使用类似加载字符串的工具来定义。

部分解决方案是可能的 - 取决于您实际想要实现的目标。

您可以从调试库中获取源代码位置——如果启用了调试库并且调试符号没有从字节码中剥离。之后，您可以加载实际的源文件并从那里提取代码。

您可以使用所需的元数据手动装饰您感兴趣的功能。请注意，Lua 中的函数是有效的表键，因此您可以创建函数到元数据表。您可能希望将此表设为弱键，这样就不会阻止 GC 收集函数。

如果您需要分析 Lua 代码的解决方案，请查看[Metalua](http://metalua.luaforge.net/)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-02T19:52:18.847

查看调试库中的[Lua Introspective Facilities](http://www.lua.org/pil/23.1.html)。

> 调试库中主要的内省函数是 debug.getinfo 函数。它的第一个参数可能是函数或堆栈级别。当您为某个函数 foo 调用 debug.getinfo(foo) 时，您会得到一个包含有关该函数的一些数据的表。该表可能具有以下字段：

我认为你想要的领域是 func 。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-04T10:04:22.077

使用调试库是您唯一的选择。使用它，您可以获得字符串（如果函数是在使用“loadstring”加载的块中定义的）或定义函数的文件的名称；以及函数定义开始和结束的行号。请参阅[文档](http://www.lua.org/manual/5.1/manual.html#5.9)。

在我目前的工作中，我们对 Lua 进行了修补，以便它甚至为您提供函数开始和结束的列号，因此您可以使用它来获取函数源。该补丁不是很难复制，但我认为我不会被允许在这里发布它:-(

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T19:09:52.350

您可以通过为每个函数创建一个[环境（请参阅](http://www.lua.org/manual/5.1/manual.html#2.9)[setfenv](http://www.lua.org/manual/5.1/manual.html#pdf-setfenv)）并使用全局（相对于局部）变量来完成此操作。在函数执行后，函数中创建的变量将出现在环境表中。

```
env = {}
myFunc = function() x = 14 end
setfenv(myFunc, env)
myFunc()
print(myFunc)    -- prints pointer
print(env.x)     -- prints 14 
```

或者，您可以使用[调试库](http://www.lua.org/manual/5.1/manual.html#5.9)：

```
> myFunc = function() local x = 14 ; debug.debug() end
> myFunc()
> lua_debug> _, x = debug.getlocal(3, 1)
> lua_debug> print(x) -- prints 14 
```

[使用钩子函数](http://www.lua.org/manual/5.1/manual.html#pdf-debug.sethook)检索局部变量可能对您更有用，而不是显式进入调试模式（即添加 debug.debug() 调用）

Lua C API 中还有一个[调试接口](http://www.lua.org/manual/5.1/manual.html#3.8)。

# c# - 为 asp.net 实现此动态登录方案的最简单方法

> ID：504342
> 
> 赞同：1
> 
> 时间：2009-02-02T18:37:06.970
> 
> 标签：c#, asp.net-membership, membership, membership-provider

我目前有一个站点，不同的用户可以登录，并且根据他们的子域，显示来自不同数据库的不同数据。我正在重写 SqlMembershipProvider 以使用“临时”连接字符串，这是我在初始化方法期间动态设置的，根据这篇文章的说明：

[http://forums.asp.net/p/997608/2209437.aspx](http://forums.asp.net/p/997608/2209437.aspx)

```
public override void Initialize(string name, NameValueCollection config)
    {
        // intercept the setting of the connection string so that we can set it ourselves...
        string specifiedConnectionString = config["connectionStringName"];

        ConnectionStringSettings connectionString = ConfigurationManager.ConnectionStrings[specifiedConnectionString];

        var fi = typeof(ConfigurationElement).GetField("_bReadOnly", BindingFlags.Instance | BindingFlags.NonPublic);

        fi.SetValue(connectionString, false);

        connectionString.ConnectionString = WakeflyClientHelper.GetClientConnectionStringByCurrentSubdomain();

        config["connectionStringName"] = connectionString.Name;

        // Pass doctored config to base classes
        base.Initialize(name, config);
    } 
```

问题是 SqlMembershipProvider 类似乎是“静态的”，因为当多个用户从不同的子域连接时，他们最终会从一个数据库中看到用户帐户，而不是他们自己的。看起来 Initialize 是由应用程序调用的，而不是基于每个请求的。

**所以我对你的问题是......实施解决方案的最简单方法是什么？**

我以前没有编写过自定义提供程序，所以我不确定它是如何工作的，或者有什么限制。而且，如果我自己编写，如果我忽略了某些东西（更不用说花费的时间），总是有可能出现安全漏洞。有任何想法吗？

更新 1：我可以有一个数据库，但是，给定子域中的用户需要能够在自己的子域中添加/编辑/删除用户，而不会看到其他子域的用户。在这个计划下这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T19:00:12.447

SQLMembershipProvider 的代码在[此处](http://download.microsoft.com/download/a/b/3/ab3c284b-dc9a-473d-b7e3-33bacfcc8e98/ProviderToolkitSamples.msi)提供。您可以通过将项目添加到解决方案并更改 web.config 中的命名空间引用来扩展/更改您认为必要的内容。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T18:40:53.610

我已经使用单个成员数据库来处理所有登录，然后根据他们登录的域将它们连接到适当的数据库。

# php - 一个代码，多个网站

> ID：504355
> 
> 赞同：0
> 
> 时间：2009-02-02T18:40:07.167
> 
> 标签：php, frameworks, shared-hosting

我需要开发一个项目，让我可以实例化一个网站的多个副本，但每个副本都需要是一个单独的网站。我可以将相同的代码上传到许多不同的帐户，但我希望只有一份代码副本。可以说，每个网站都是一个“实例”。这样我可以一次上传代码并同时更新所有网站。

出于技术原因，我需要使用 PHP（但就我自己的知识而言，我也对其他选项感兴趣），我认为 Jelix 可能是一个不错的框架选择。那里有更好的选择吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T18:45:35.613

您可以将所有代码放在一个目录中，然后在所有网站中创建虚拟子目录，这些子目录都指向该目录。这就是 Microsoft 在 SharePoint 中解决问题的方式。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T18:45:54.393

最简单的选择是将所有网站链接到一台服务器（可能是分布式的）。

通过您的网络服务器传递调用 URL 以生成配置信息。使用这些传递的 URL 来定义每个站点之间的差异。

除此之外，框架对这个问题几乎无关紧要，所以我将把它留给其他人来回答。

请记住，如果您制作 2​​0 份相同代码的副本，那将是修复错误所需时间的 20 倍。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T18:47:46.060

如果您将 UNIX 或 Linux 用于 Web 服务器，则可以创建 PHP 代码的一个主副本，然后使用符号链接指向位于不同目录中的实际文件，并在 Apache 中设置虚拟网站。您也可以将特定于站点的配置文件放在这些目录下，但是大部分 PHP 代码将被解析为“主”代码的符号链接。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T19:03:07.263

我不确定您说的是哪种网站，但为什么不使用已经开发的应用程序，如 Wordpress 或任何其他 cms？每个网站上的代码都是相同的，您可以轻松更新它。特定于网站的数据仅存在于单个配置文件和 MySQL 数据库中。

# .net - 时间作为决定值

> ID：504367
> 
> 赞同：2
> 
> 时间：2009-02-02T18:42:34.293
> 
> 标签：.net, vb.net, iis

我有一段代码用于确定是否应该发生某个事件。代码看起来像这样。

```
 If (Date.Now.Ticks Mod 100) < 4 Then
            Return True
        Else
            Return False
        End If 
```

这里的想法是这个事件应该在 100 次中发生 4 次，即 4%。然而，在生产中，实际百分比在 10% 到 60% 之间。该应用程序托管在两台负载平衡的 Win2k3 服务器上。

任何建议都会有所帮助。

基思

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T18:46:49.993

你为什么不使用这个：

```
Dim r As New Random(System.DateTime.Now.Millisecond)
Return r.Next(0, 100) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T18:56:35.200

你得到这种行为的原因是*你没有要求 4% 的时间给你一个 True value*，你要求任何时候 Ticks 模 100 的数量小于 4。

给定一个统一的随机数生成器，如[System.Random](http://msdn.microsoft.com/en-us/library/system.random.aspx)：

```
Dim random As New Random()
Return random.NextDouble() < 0.04 
```

使用[Random.NextDouble](http://msdn.microsoft.com/en-us/library/system.random.nextdouble.aspx)，您将有相同的概率选择 0.0 到 1.0 之间的任何数字。因此，只要随机双精度值小于 0.04，我就可以通过返回 true 来要求 4% 的时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T18:55:15.657

查看 DateTime.Now.Ticks 的结果。在我的盒子（这是一个 Vista 盒子 - 操作系统在这里几乎肯定很重要）采样 5 秒并获取所有不同的值，*所有*滴答计数都以“91”结尾。代码如下。

虽然它在您的服务器上显然不是*那么*糟糕，但计时器粒度肯定会产生重大影响。使用随机数生成器肯定是更好的选择。请注意，您应该创建 的单个实例`Random`，或者每个线程创建一个实例 - 这*不是*`Random`线程安全的。为简单起见，您可能想在[MiscUtil中使用我的](http://pobox.com/~skeet/csharp/miscutil)[StaticRandom](http://pobox.com/~skeet/csharp/miscutil/usage/staticrandom.html)类。

这是滴答测试代码：

```
using System;
using System.Collections.Generic;
using System.Globalization;
using System.Linq;

public class Test
{
    static void Main()
    {
        foreach(long tick in GetTicks().Distinct())
        {
            Console.WriteLine(tick);
        }
    }

    static IEnumerable<long> GetTicks()
    {
        DateTime end = DateTime.Now.AddSeconds(5);
        DateTime now;
        while ((now = DateTime.Now) < end)
        {
            yield return now.Ticks;
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T19:05:18.613

首先，返回的滴答数可以通过从任何系统计时器获取的常数因子进行缩放，这样它就不会命中每个整数，并且取它 mod 100 不会给你从 0 到 99 的每个数字等概率。

其次，如果您的代码是事件驱动的，系统将确定它何时被激活；此激活时间可能往往是固定的刻度倍数。此外，激活和执行代码之间的运行时间往往是相似的。因此，根据您计算机上发生的其他情况，滴答数将是半可预测的。

结果是，滴答数高度依赖于系统；您想使用实际的随机数生成器来获取随机数...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T18:48:26.310

100 次中有 4 次？所以你想要“Ticks mod 25 == 0”？另外，我不是 VB 程序员，但你能不能摆脱所有“如果 -- Else”而只是“返回 (Date.Now.Ticks mod 25) == 0”？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T18:49:00.160

随机性的本质是你得到随机的结果。如果您的实际百分比介于 10% 和 60% 之间，则您的代码可能运行正确，但您的样本量可能太小而无法收敛。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T18:50:23.373

使用[真正的随机数生成器](http://msdn.microsoft.com/en-us/library/system.security.cryptography.rngcryptoserviceprovider.aspx)比依赖时间函数要好得多。

# java - Maven FindBugs 插件

> ID：504368
> 
> 赞同：2
> 
> 时间：2009-02-02T18:42:46.023
> 
> 标签：java, maven-2, maven-plugin, findbugs

你有用法：[findbugs-maven-plugin](http://mojohaus.org/findbugs-maven-plugin/usage.html)

```
<project>
  [...]
  <reporting>
    [...]
    <plugin>
      <groupId>org.codehaus.mojo</groupId>
      <artifactId>findbugs-maven-plugin</artifactId>
      <version>1.2.1</version>
      <configuration>
        <xmlOutput>true|false</xmlOutput>
        <xmlOutputDirectory>directory location of findbugs xdoc xml report</xmlOutputDirectory>
        <threshold>High|Normal|Low|Exp|Ignore</threshold>
        <effort>Min|Default|Max</effort>
        <excludeFilterFile>findbugs-exclude.xml</excludeFilterFile>
        <includeFilterFile>findbugs-include.xml</includeFilterFile>
        <visitors>FindDeadLocalStores,UnreadFields</visitors>
        <omitVisitors>FindDeadLocalStores,UnreadFields</omitVisitors>
        <onlyAnalyze>org.codehaus.mojo.findbugs.*</onlyAnalyze>
        <pluginList>/libs/fb-contrib/fb-contrib-2.8.0.jar</pluginList>
        <debug>true|false</debug>
        <relaxed>true|false</relaxed>
        <findbugsXmlOutput>true|false</findbugsXmlOutput>
        <findbugsXmlOutputDirectory>directory location of findbugs legact xml format report</findbugsXmlOutputDirectory>
      </configuration>
    </plugin>
    [...]
  </reporting>
  [...]
</project> 
```

但是有一次：

```
mvn site 
```

我得到：

```
[INFO] ------------------------------------------------------------------------
[ERROR] BUILD ERROR
[INFO] ------------------------------------------------------------------------
[INFO] Failed to resolve artifact.

GroupId: org.codehaus.mojo
ArtifactId: findbugs-maven-plugin
Version: 1.2.1

Reason: Unable to download the artifact from any repository

  org.codehaus.mojo:findbugs-maven-plugin:pom:1.2.1

from the specified remote repositories:
  central (http://repo1.maven.org/maven2) 
```

你知道为什么吗？我应该怎么办？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-02T18:51:00.297

查看存储库，您的版本应该是 1.2，而不是 1.2.1

还有，你的配置不对，需要选择一些选项。所以它应该看起来像：

```
 <plugin>
  <groupId>org.codehaus.mojo</groupId>
  <artifactId>findbugs-maven-plugin</artifactId>
  <version>1.2</version>
  <configuration>
    <threshold>High</threshold>
    <effort>Default</effort>
  </configuration>
</plugin> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T18:49:59.020

试试看：

```
<version>1.2</version> 
```

[http://repo2.maven.org/maven2/org/codehaus/mojo/findbugs-maven-plugin/](http://repo2.maven.org/maven2/org/codehaus/mojo/findbugs-maven-plugin/)

好像他们做了一个简单的复制/粘贴错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-04T16:50:29.280

作为父项目结构的一部分，将 site.xml 放入 parent-project/src/site：

```
 |--- src 
      |---site
            |---site.xml 
```

“Better Builds with Maven”（在线免费书籍）中的示例 site.xml 应该可以帮助您入门。

创建 site.xml 后，`mvn site`从父项目目录执行。它将获取您的报告设置，包括萤火虫报告。站点建成后，每个子项目都会有目录 /target/site，其中包含 index.html 和项目报告的链接。项目报告应包含萤火虫报告。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T19:35:46.277

该报告将在目标/站点中。在浏览器中查看文件 index.html，而不是查找项目报告，然后查找错误报告。

# apache-flex - Flex：为视频动态创建预览图像

> ID：504383
> 
> 赞同：6
> 
> 时间：2009-02-02T18:47:30.507
> 
> 标签：apache-flex, actionscript-3, video, videodisplay

我正在使用 VideoDisplay 播放 flv、mov 和 mp4，一切正常。它们都是通过渐进式下载加载的，而不是流式传输的。我想做的是抓取一个指定的帧（就像在 10 秒标记处显示的任何内容），将其转换为位图并将该位图用作视频的预览图像。我想在运行时执行此操作，因此我不必为要显示的每个视频创建预览图像。

关于如何做到这一点的任何想法？我宁愿不要通过播放来伪造它——寻找那个特定的帧然后暂停它，但我可能别无选择？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T22:44:57.547

Ryan 和 James 是正确的——正确的方法可能是在上传/转码时提取帧。但是，如果这不是一个选项，您可以选择使用您自己的某种默认/占位符图像（通用的或以某种方式适用于尚未捕获拇指的所有视频），并且只需使用 VideoDisplay 的 DisplayObject-ness抓取然后将帧上传到您的服务器，例如：

```
<mx:Script>
    <![CDATA[

        var captured:Boolean;

        private function creationCompleteHandler(event:Event):void
        {
            videoDisplay.source = "http://yourserver/yourvideo.flv";
        }

        private function videoDisplay_playheadUpdate(event:VideoEvent):void
        {
            if (!captured && videoDisplay.playheadTime >= 10)
                capture();
        }

        private function capture():void
        {
            var bmpData:BitmapData = new BitmapData(videoDisplay.width, videoDisplay.height);
            bmpData.draw(videoDisplay);

            captured = true;

            // Now just upload the byte array to your server for the next user
            var loader:URLLoader = new URLLoader();
            loader.dataFormat = URLLoaderDataFormat.BINARY;

            // ... etc.
        }

    ]]>
</mx:Script>

<mx:VideoDisplay id="videoDisplay" playheadUpdate="videoDisplay_playheadUpdate(event)" /> 
```

同样，它可能不是最优雅的解决方案，但它确实有效。这样，第一个用户会看到通用图像，但此后每个用户都会获得生成的缩略图。（当然，届时您将上传并正确关联。）有意义吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T19:25:55.670

我很确定这是不可能的。很可能……但不要这么认为。我认为加载视频的唯一方法是使用 NetStream 和 NetConnection 对象，如您所知，这只是开始加载视频。

如果这是用户生成的视频，我认为最好的办法是拥有一些生成预览图像的服务器端脚本。不知道这是如何完成的，但认为这是大多数剪辑网站的工作方式。

如果所有视频都在您的控制范围内，则可以为其中一个视频编辑程序编写脚本，以自动从文件列表中为特定帧生成图像。我认为这可能是您可以快速启动并运行的最佳选择。

抱歉，答案含糊……如果您需要快速解决方案，它可能会为您指明正确的方向。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-02T19:31:15.270

我同意詹姆斯的观点，真正做到这一点的唯一方法是使用服务器端脚本并从视频中提取某些帧。即使您可以使用 flex 来完成此操作，您也真的不想将执行此操作的负担（我认为这将是处理器密集型）放在客户端计算机上。更不用说预先创建图像比让 flex 确定每次加载时显示的缩略图要有效得多。

# .net - DotNet 2.0 或 3.5、IE、XSL 和 XSL-FO 功能是什么？

> ID：504386
> 
> 赞同：2
> 
> 时间：2009-02-02T18:48:18.463
> 
> 标签：.net, internet-explorer, xslt, xsl-fo

我完全是 XSL 和 XSL-FO 的菜鸟，我正在寻找一些关于在使用 XSL 格式化 XML 数据以进行报告时使用 DotNet 2.0 和 3.5 的可能性和限制的建议。

这就是我想要做的。

1)根据一些业务规则从SQL 2005 DB中获取数据

2) 直接从 SQL 输出到 xml 或从其他一些自定义中间层组件创建 xml 文件并将文件保存到磁盘。

3) 使用第 3 方库从转换后的文件创建 pdf。<-- 我也需要有关工具的建议。

我关心的是分页符和在发生中断时将相关内容保持在一起。据我所知，这两个命令是为此：keep-with-previous 和 keep-with-next 但我认为是 XSL-FO 命令，如果我错了，请纠正我。在基本 XSL 命令中也有这个。 [http://www.w3.org/TR/xsl/#keepbreak](http://www.w3.org/TR/xsl/#keepbreak) 从我读到的 IE 和 DotNet 不支持 XSL-FO 仍然是真的吗？我还阅读了一些关于将 XSL 模式添加到 Visual Studios 模式以进行智能感知的文章，有没有人知道用于此目的的当前 XSL-FO 模式。因此，考虑到我想要完成的工作以及我的担忧，我应该了解 XSL-FO 在 DotNet 和 IE 中的局限性。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-12T14:17:16.437

我在 Java 和 .NET 环境中都使用过很多专业的 XSL-FO。它确实使您可以完全控制打印的文档/PDF。我自己已经生成了非常复杂的 PDF 文件，可以批量打印（小册子和论文）。它们包括复杂的结构，如列中浮动的文本、图形（使用嵌入式 SVG）和表格。

XSL-FO 用于打印 HTML 用于屏幕。鉴于你学会了很好地了解它，你将能够用它生产任何东西，无论设计多么复杂。

基于 Java 的[FOP](http://xmlgraphics.apache.org/fop/)可能是最好的 XSL-FO 处理器之一。而且它也是免费的、开源的。

[AltSoft 的商业 .NET XML2PDF](http://alt-soft.com/Products_xml2pdf.aspx)很好 2.

XSL-FO 绝对是生成 PDF 或打印文档时的最佳选择。

编辑：我猜我只回答了你的部分问题。到目前为止，任何常见浏览器都不原生支持 XSL-FO。我不认为有任何计划在 IE 中实现本机支持，如果是的话，我会感到非常惊讶。XSL-FO 只是 XML，因此到今天为止，您将不再需要 .NET Framework 对 XSL-FO 的任何进一步支持。通常，使用 XSLT 生成 XSL-FO，然后将转换结果传递给格式化对象处理器，例如 FOP。在某些情况下，如果您的 XSL-FO 文档非常复杂，那么 XSLT（至少不是 1.0）是不够的。然后，您可能会考虑使用用 C# 等语言编写的 XSLT 扩展。在某些情况下，也许 XSLT 不适合这项工作，那么您可以考虑使用代码来生成 XSL-FO。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T19:14:42.653

查看[Aspose PDF](http://www.aspose.com/categories/file-format-components/aspose.pdf-for-.net-and-java/default.aspx)以从 XSL-FO 生成 PDF。但是，它不是免费的，但根据您的需要，它可能物有所值。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T22:46:27.653

.NET 2.0 和 3.5 除了进行从 xml 到 xsl-fo 的转换之外什么都不做。您仍然需要编写 XSLT 文件，据我所知，Visual Studio 下的 xsl-fo 没有智能感知。我使用[http://www.alt-soft.com](http://www.alt-soft.com)的产品从 xsl-fo 转换为 pdf。要编写 xsl-fo，我使用 Stylus Studio。您还可以查看 Altova 的 Stylvision。[http://www.renderx.com/](http://www.renderx.com/)也生产与 alt-soft 类似的产品。我还使用 alt 软件产品将 SVG 从 Dundas Charting 转换为 PDF。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-16T13:36:13.497

可以在这里找到非官方架构：http: [//xmlgraphics.apache.org/fop/fo.html#fo-validate](http://xmlgraphics.apache.org/fop/fo.html#fo-validate)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T20:54:16.383

感谢您提供 xsd 资源的链接。我会投票赞成你的回复，但我还没有要点:)

xsl-fo 基本上毫无价值，除非您将其转换为 PDF 或其他“可读”格式，所以我怀疑 IE 或任何浏览器会“支持”xsl-fo。我想您可以创建一个对 mime 类型做出反应的插件，然后浏览器/插件会将 xsl-fo 转换为 pdf。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-03T22:19:04.183

好的，我下载了 syntext xsd 并将其放在与我的 xsl 相同的目录中，该目录生成 xsl-fo，并使用 Visual Studio 编辑器工作。它只允许您“智能感知”与您所在位置相关的正确标签。很有帮助。事实上，除非我做错了什么，否则它比 Sylus Studio 更有用，它不会限制你只使用有效的标签。

# compiler-construction - 在使用 LLVM 编写 JIT 时，您将如何重用 C 操作码实现？

> ID：504389
> 
> 赞同：7
> 
> 时间：2009-02-02T18:49:12.580
> 
> 标签：compiler-construction, jit, llvm, language-implementation

在 llvm 教程和示例中，编译器通过这样的调用输出 LLVM IR

```
return Builder.CreateAdd(L, R, "addtmp"); 
```

但是很多解释器都是这样写的：

```
switch (opcode) {
     case ADD:
             result = L + R;
             break;
     ... 
```

您将如何提取这些代码片段中的每一个以使用 LLVM 制作 JIT，而无需在 LLVM IR 中重新实现每个操作码？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-03T07:57:44.483

好的，首先获取所有代码片段并将它们重构为它们自己的函数。所以你的代码去：

```
void addOpcode(uint32_t *result, uint32_t L, uint32_t R) {
    *result = L + R;
}

switch (opcode) {
    case ADD:
            addOpcode(&result, L, R);
            break;
     .... 
```

好的，所以在这样做之后你的解释器应该仍然运行。现在获取所有新功能并将它们放在自己的文件中。现在使用 llvm-gcc 或 clang 编译该文件，而不是生成本机代码，而是使用[“cpp”后端](http://llvm.org/svn/llvm-project/llvm/trunk/lib/Target/CppBackend/CPPBackend.cpp)(-march -cpp) 编译它。这将生成为编译单元实例化字节码的 C++ 代码。您可以指定选项以将其限制为特定功能等。您可能想要使用 "-cppgen module" 。

现在将您的解释器循环粘合在一起对生成的 C++ 代码的调用，而不是直接执行原始代码，然后将其传递给一些优化器和本机代码生成器。Gratz 在 JIT 上 ;-) 你可以在几个 LLVM 项目中看到一个这样的例子，比如[llvm-lua](http://code.google.com/p/llvm-lua)中的 vm_ops 。

# iphone - 您如何使用 iPhone SDK 实现可滑动的图像堆栈，例如 Photo 应用程序？

> ID：504393
> 
> 赞同：7
> 
> 时间：2009-02-02T18:49:58.397
> 
> 标签：iphone, objective-c

我想获取一堆图像（或者可能是一组用于下载图像的 URL），并使用 iPhone SDK 使用用户滑动来平滑地为堆栈中的下一个图像设置动画，并一次一个地全屏显示它们。Apple 的 Photo.app 似乎可以做到这一点。此外，如果尚未检索到图像，我想显示进度指示器。

你能指出我的示例代码并解释如何实现这种技术吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-02T19:28:54.557

您需要使用 UIScrollview 的页面控制机制。Apple 有大量的示例代码，其中一个叫做 Page Control，很奇怪：

[http://developer.apple.com/iphone/library/samplecode/PageControl/index.html](http://developer.apple.com/iphone/library/samplecode/PageControl/index.html)

如果你想要除此之外的任何行为，你必须自己动手。

# cocoa-touch - 是否可以从 NIB 初始化 UINavigationController 子类？

> ID：504400
> 
> 赞同：1
> 
> 时间：2009-02-02T18:51:38.283
> 
> 标签：cocoa-touch, interface-builder

我有一个`UITabBarController`基于应用程序。选项卡将根据数据库条目创建，所以我事先不知道它们。我想以**编程**方式为每个选项卡初始化一个`UINavigationController`子类（我有几种不同的类型）。

理想情况下，我真的很想`UINavigationController`使用 Interface Builder 绘制整个子类 + 它的子视图，就像您在 IB 中为每个选项卡添加定义视图时可以做的那样（即当您提前知道选项卡将是什么时）。我尝试将“类标识”设置为我的`UINavigationController`子类名称，然后`UINavigationController`在其中添加一个，但显然它没有在“文件所有者”级别注入实例......

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-04T08:07:31.610

我最终没有 subclassing `UINavigationController`，看来这不是推荐的。我很快意识到`UINavigationController`从 IB 内部设计 's 并没有太多好处。相反，我`UIViewController`对. 当我以编程方式填充标签时，最好简单地包装子类。子类 化直接阻止了我正确使用注入视图的属性。`UINavigationBar``viewDidLoad``[[UINavigationController alloc] initWithRootController: subclass];``UINavigationController``navigationItem`

# java - 如何在 ANTLR 3 中处理字符串文字中的转义序列？

> ID：504402
> 
> 赞同：21
> 
> 时间：2009-02-02T18:52:24.397
> 
> 标签：java, string, antlr, escaping

我一直在查看 ANTLR v3 文档（以及我可信赖的“The Definitive ANTLR reference”副本），但我似乎找不到在字符串文字中实现转义序列的干净方法（我目前正在使用 Java目标）。我曾希望能够做类似的事情：

```
fragment 
ESCAPE_SEQUENCE
    : '\\' '\'' { setText("'"); }
    ;

STRING  
    : '\'' (ESCAPE_SEQUENCE | ~('\'' | '\\'))* '\''
      { 
        // strip the quotes from the resulting token
        setText(getText().substring(1, getText().length() - 1));
      } 
    ; 
```

例如，我希望输入标记“ `'Foo\'s House'`”成为字符串“ `Foo's House`”。

不幸的是，片段`setText(...)`中的调用`ESCAPE_SEQUENCE`设置了整个`STRING`令牌的文本，这显然不是我想要的。

有没有一种方法可以在不添加返回结果字符串并手动替换转义序列的方法的情况下实现此语法（例如，使用类似规则`setText(escapeString(getText()))`中的内容`STRING`）？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-16T10:58:24.983

以下是我在我编写的 JSON 解析器中完成此操作的方法。

```
STRING      
@init{StringBuilder lBuf = new StringBuilder();}
    :   
           '"' 
           ( escaped=ESC {lBuf.append(getText());} | 
             normal=~('"'|'\\'|'\n'|'\r')     {lBuf.appendCodePoint(normal);} )* 
           '"'     
           {setText(lBuf.toString());}
    ;

fragment
ESC
    :   '\\'
        (   'n'    {setText("\n");}
        |   'r'    {setText("\r");}
        |   't'    {setText("\t");}
        |   'b'    {setText("\b");}
        |   'f'    {setText("\f");}
        |   '"'    {setText("\"");}
        |   '\''   {setText("\'");}
        |   '/'    {setText("/");}
        |   '\\'   {setText("\\");}
        |   ('u')+ i=HEX_DIGIT j=HEX_DIGIT k=HEX_DIGIT l=HEX_DIGIT
                   {setText(ParserUtil.hexToChar(i.getText(),j.getText(),
                                                 k.getText(),l.getText()));}

        )
    ; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2013-07-27T09:57:59.270

对于 ANTLR4、Java 目标和标准转义字符串语法，我使用了一个专用的单例类：CharSupport 来翻译字符串。它在 antlr API 中可用：

```
STRING          :   '"' 
                (   ESC  
                |   ~('"'|'\\'|'\n'|'\r') 
                )* 
                    '"' { 
                        setText( 
                            org.antlr.v4.misc.CharSupport.getStringFromGrammarStringLiteral(
                                getText()
                            )
                        ); 
                    }
                ; 
```

正如我在 V4 文档和实验中看到的那样，词法分析器部分不再支持 @init！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-04-28T07:00:34.597

另一种（可能更有效）的替代方法是使用规则参数：

```
STRING
@init { final StringBuilder buf = new StringBuilder(); }
:
    '"'
    (
    ESCAPE[buf]
    | i = ~( '\\' | '"' ) { buf.appendCodePoint(i); }
    )*
    '"'
    { setText(buf.toString()); };

fragment ESCAPE[StringBuilder buf] :
    '\\'
    ( 't' { buf.append('\t'); }
    | 'n' { buf.append('\n'); }
    | 'r' { buf.append('\r'); }
    | '"' { buf.append('\"'); }
    | '\\' { buf.append('\\'); }
    | 'u' a = HEX_DIGIT b = HEX_DIGIT c = HEX_DIGIT d = HEX_DIGIT { buf.append(ParserUtil.hexChar(a, b, c, d)); }
    ); 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-06-02T16:46:25.267

我需要这样做，但我的目标是 C 而不是 Java。这是我根据答案#1（和评论）做的，以防有人需要类似的东西：

```
QUOTE   :      '\'';
STR
@init{ pANTLR3_STRING unesc = GETTEXT()->factory->newRaw(GETTEXT()->factory); }
        :       QUOTE ( reg = ~('\\' | '\'') { unesc->addc(unesc, reg); }
                        | esc = ESCAPED { unesc->appendS(unesc, GETTEXT()); } )+ QUOTE { SETTEXT(unesc); };

fragment
ESCAPED :       '\\'
                ( '\\' { SETTEXT(GETTEXT()->factory->newStr8(GETTEXT()->factory, (pANTLR3_UINT8)"\\")); }
                | '\'' { SETTEXT(GETTEXT()->factory->newStr8(GETTEXT()->factory, (pANTLR3_UINT8)"\'")); }
                )
        ; 
```

HTH。

# c# - 为什么不能优化？

> ID：504403
> 
> 赞同：4
> 
> 时间：2009-02-02T18:52:30.357
> 
> 标签：c#, performance, optimization, methods

我有一个用于添加向量的函数，如下所示：

```
public static Vector AddVector(Vector v1, Vector v2)
{
    return new Vector(
      v1.X + v2.X,
      v1.Y + v2.Y,
      v1.Z + v2.Z);
} 
```

不是很有趣。但是，我为向量重载了“+”运算符，并在重载中调用了 AddVector 函数以避免代码重复。我很好奇这是否会导致两个方法调用，或者是否会在编译或 JIT 时进行优化。我发现它确实导致了两次方法调用，因为我总共获得了 10 **%**通过复制 AddVector 的代码以及 '+' 和 '*' 运算符重载方法中的点积方法来提高性能。当然，这是一个小众案例，因为它们每秒被调用数万次，但我没想到会这样。我想我希望该方法被内联到另一个或其他东西中。而且我认为这不仅仅是方法调用的开销，还有将方法参数复制到另一个方法（它们是结构）中。

没什么大不了的，我可以复制代码（或者可能只是删除 AddVector 方法，因为我从不直接调用它）但是当我决定为某事创建一个方法时，它会在未来困扰我很多，比如拆分一个大方法分成几个小方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T19:07:30.437

如果您编译到调试模式或使用附加的调试器开始该过程（尽管您可以稍后添加一个），那么包括内联在内的一大类 JIT 优化将不会发生。

尝试通过在发布模式下编译它来重新运行您的测试，然后在没有附加调试器的情况下运行它（在 VS 中为 Ctrl+F5），看看您是否看到了预期的优化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T19:02:53.067

> “而且我认为这不仅仅是方法调用的开销，还有将方法参数复制到另一个方法（它们是结构）中。”

你为什么不测试一下？编写一个引用两个向量结构而不是结构本身的 AddVector 版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T19:21:20.737

不要认为这`struct`是性能的正确选择。在某些情况下，复制成本可能很高。直到你测量你才知道。此外，`struct`s 具有[令人毛骨悚然](https://stackoverflow.com/questions/370859/why-isnan-is-a-static-method-on-the-double-class-instead-of-an-instance-property/370996#370996)的行为，特别是如果它们是可变的，但即使它们不是。

另外，其他人说的是正确的：

*   在调试器下运行将禁用 JIT 优化，使您的性能测量无效。
*   在调试模式下编译也会使性能测量无效。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T20:33:50.357

我有 VS 处于发布模式，我没有调试就跑了，所以这不能怪。在 Release 文件夹中运行 .exe 会产生相同的结果。我安装了 .NET 3.5 SP1。

我是否使用结构取决于我创建了多少东西以及复制与引用时它有多大。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T19:10:56.933

你说`Vector`的是一个结构。根据[2004 年的一篇博文](http://blogs.msdn.com/davidnotario/archive/2004/11/01/250398.aspx)，值类型是不内联方法的一个原因。我不知道在此期间规则是否发生了变化。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T21:03:23.510

我能想到的只有一个优化，也许你想要一个 vOut 参数，这样你就可以避免调用 new() 从而减少垃圾收集——当然，这完全取决于你对返回的向量做了什么，如果你是否需要坚持它，如果你遇到垃圾收集问题。

# git - 在 DVCS 中创建漂亮的修订历史值得付出努力吗？

> ID：504409
> 
> 赞同：4
> 
> 时间：2009-02-02T18:54:16.390
> 
> 标签：git, mercurial, dvcs, bazaar

我过去常常回去编辑我的 Mercurial 提交，试图创造一段美好的历史。我可能将两个不相关的东西放在一个提交中，或者我可能做了几个提交，这些提交被更好地理解为一个提交，但最终这似乎是在浪费时间，我克服了历史不完美的小尴尬。

你还这样做吗？为什么它对你有价值，你为什么不再做，你有没有做过，或者你正在考虑开始？

如果我为 Linux 内核做贡献，这显然值得我花时间，因为否则 Linus 会拒绝我的补丁，但 IMO dvcs 用户的一大错误是想象他们的项目就像 Linux 内核。我的项目通常只有几个开发人员。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-04T05:00:42.327

这不值得努力。

只要“小费”是漂亮的，你最好让历史变得丑陋并准确地反映工作是如何产生的，而不是你希望工作是如何产生的。

当我有一半时间在挖掘历史时，我会问“这过去是什么样子的？” 但另一半时间我在问“为什么这最终看起来像这样”，我想看看开发人员的失败尝试，即使他宁愿抹去他曾经尝试过的道路不成功。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-02T19:00:13.943

我努力清理我的修订历史。我的工作流程是进行小而有意义的编辑、提交、重复，直到进行一些较大的修改。然后我返回并将提交重新排序/组合成功能原子提交，并将那些修改后的提交推出。这允许其他开发人员看到产生功能差异的提交，而不是大量的琐碎提交。使发生回归时更容易调试回归。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T19:04:00.363

如果它是一个可以预期在修订之间来回切换的应用程序，例如从旧版本分支以维护不同的版本，我会考虑拥有干净准确的提交消息作为项目的宝贵工具。

如果您只是在进行增量更新，而在极少数情况下破坏构建的可能性很小，那么我不会太在意它们是否非常准确。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T21:16:49.520

如果您只附加到历史记录并查看最新版本，那对您来说并不重要。

我最近在做一个项目，有人通过在两个分支上应用一个大补丁来“合并”。我通过寻找引入了一项功能的更改来发现它，以查看随之而来的测试。浪费了很多时间。

您还将看到合并引入的新维度使二分变得更加困难。它不再只是左或右。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-12T21:10:07.320

我试图记住提交评论稍后会出现在注释视图中。因此，我试图解释已提交更改的意图和整体效果，而不是更改本身。

# regex - 提取一段文本，其中结束表达式取决于开始表达式

> ID：504417
> 
> 赞同：3
> 
> 时间：2009-02-02T18:56:37.273
> 
> 标签：regex, perl

我有一个结构如下的文本字符串：

```
= Some Heading (1)

Some text

== Some Sub-Heading (2)

Some more text

=== Some Sub-sub-heading (3)

Some details here

= Some other Heading (4) 
```

我想提取第二个标题的内容，包括任何小节。我事先不知道第二个标题的深度是多少，所以我需要从那里匹配到下一个具有相同深度的标题，或者更浅，或者字符串的末尾。

在上面的示例中，这将产生：

```
== Some Sub-Heading (2)

Some more text

=== Some Sub-sub-heading (3)

Some details here 
```

这就是我卡住的地方。如何使用打开第二个标题的匹配子表达式作为关闭该部分的子表达式的一部分。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-02T19:28:25.667

```
#!/usr/bin/perl

my $all_lines = join "", <>;

# match a Heading that ends with (2) and read everything between that match
# and the next heading of the same depth (\1 matches the 1st matched group)
if ( $all_lines =~ /(=+ Heading )\([2]\)(.*?)\1/s ) {
    print "$2";
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T20:27:24.970

这会将文件分成几个部分：

```
my @all = split /(?=^= )/m, join "", <$filehandle>;
shift @all; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T21:03:30.560

我会跳过尝试使用复杂的正则表达式。而是编写一个简单的解析器并构建一棵树。

这是一个粗略且现成的实现。它仅针对惰性编码进行了优化。您可能希望使用 CPAN 中的库来构建解析器和树节点。

```
#!/usr/bin/perl

use strict;
use warnings;

my $document = Node->new();
my $current = $document;

while ( my $line = <DATA> ) {

    if ( $line =~ /^=+\s/ ) {

        my $current_depth = $current->depth;
        my $line_depth = Node->Heading_Depth( $line );

        if ( $line_depth > $current_depth ) {
            # child node.
            my $line_node = Node->new();
            $line_node->heading( $line );
            $line_node->parent( $current );
            $current->add_children( $line_node );
            $current = $line_node;
        }
        else {

            my $line_node = Node->new();
            while ( my $parent = $current->parent ) {

                if ( $line_depth == $current_depth ) {
                    # sibling node.
                    $line_node->heading( $line );
                    $line_node->parent( $parent );
                    $current = $line_node;
                    $parent->add_children( $current );

                    last;
                }

                # step up one level.
                $current = $parent;
            }
        }

    }
    else {
        $current->add_children( $line );
    }

}

use Data::Dumper;
print Dumper $document;

BEGIN {
    package Node;
    use Scalar::Util qw(weaken blessed );

    sub new {
        my $class = shift;

        my $self = {
            children => [],
            parent   => undef,
            heading  => undef,
        };

        bless $self, $class;
    }

    sub heading {
        my $self = shift;
        if ( @_ ) {
            $self->{heading} = shift;
        }
        return $self->{heading};
    }

    sub depth {
        my $self = shift;

        return $self->Heading_Depth( $self->heading );
    }

    sub parent {
        my $self = shift;
        if ( @_ ) {
            $self->{parent} = shift;
            weaken $self->{parent};
        }
        return $self->{parent};
    }

    sub children {
        my $self = shift;
        return @{ $self->{children} || [] };
    }

    sub add_children {
        my $self = shift;
        push @{$self->{children}}, @_;
    }

    sub stringify {
        my $self = shift;

        my $text = $self->heading;
        foreach my $child ( $self->children ) {
            no warnings 'uninitialized';
            $text .= blessed($child) ? $child->stringify : $child;
        }

        return $text;
    }

    sub Heading_Depth {
        my $class  = shift;
        my $heading = shift || '';

        $heading =~ /^(=*)/;
        my $depth = length $1;

        return $depth;
    }

}

__DATA__
= Heading (1)

Some text

= Heading (2)

Some more text

== Subheading (3)

Some details here

== Subheading (3)

Some details here

= Heading (4) 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T22:05:10.967

daotoad 和 jrockway 是绝对正确的。如果您尝试解析树状数据结构，将正则表达式弯曲到您的位置只会导致难以理解且仍然不够通用的复杂代码块。

但是，如果您坚持，这里有一个有效的修订片段。匹配相同深度的分隔符或字符串结尾是一种复杂情况。在小于或等于当前深度的深度匹配字符串更具挑战性，需要两步。

```
#!/usr/bin/perl

my $all_lines = join "", <>;
# match a Heading that ends with (2) and read everything between that match
# and the next heading of the same depth (\2 matches the 2nd parenthesized group)
if ( $all_lines =~ m/((=+) [^\n]*\(2\)(.*?))(\n\2 |\z)/s ) {
    # then trim it down to just the point before any heading at lesser depth
    my $some_lines = $1;
    my $depth = length($2);
    if ($some_lines =~ m/(.*?)(\n={1,$depth} |\z)/s) {
        print "$1\n";
    }
} 
```

但我的建议是避免这条路线，并用可读和可维护的东西来解析它！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-03T13:48:24.790

只是为了一笑：

```
/^(?>(=+).*\(2\))(?>[\r\n]+(?=\1=|[^=]).*)*/m 
```

前瞻确保，如果一行以等号开头，则至少比原始行的前缀多一个等号。请注意，前瞻的第二部分匹配除等号以外的任何字符，*包括*换行符或回车符。这让它匹配一个空行，但不匹配字符串的结尾。

# ruby-on-rails - 在 Rails 中你不能在另一个框架中做的事情是什么？

> ID：504419
> 
> 赞同：1
> 
> 时间：2009-02-02T18:57:21.050
> 
> 标签：ruby-on-rails, ruby, frameworks

我想知道我应该考虑使用 Rails 以外的框架的情况。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T20:01:39.327

Ruby on Rails 并不是想成为一个万能的 Web 开发框架。如果您要构建一个主要使用 CRUD 操作构建的应用程序，您希望使用大量 AJAX，并且您可以完全控制数据库，那么 Ruby on Rails 是少数几个出色的选择之一。如果您正在做其他事情，那么可能还有另一个框架更符合您的要求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T20:06:37.697

两件事情。首先，Ruby 是一种相对年轻的语言，当你尝试做一些更深奥的事情（比如连接到非主流或旧类型的数据源）时，你可能会遇到困难。它还具有较差的 GC，并且没有内核线程，这两者对于高性能平台都非常重要。主代码库 (MRI) 非常老套（许多巧妙的混淆程序员技巧，如宏），并且有些部分写得不好（想到 gc 和线程调度）。同样，它是一个非常年轻的平台，非常迅速地流行起来。

其次，虽然 ruby​​ 语言和 rails 的想法/范式都是惊人的，但 ruby​​ 和 rails 平台却不是。ruby 和 rails 都有很多非常丑陋的地方，与其他平台（php/asp/jsp）的正常部署相比，部署解决方案处于黑暗时代。

被指控在这里拖钓，所以我将解释一下。由于线程模型，Rails 无法同时处理请求，除非您启动 Rails 应用程序的多个完整实例。为此，您有两种选择，一种是相对年轻且仍在开发中的乘客 (mod_rails)，另一种是久经考验的 apache 负载均衡器，其背后有多个 mongrel 实例。

Either way, the lack of the ability to just just spawn workers means you will want 5-10 full instances of your application running, which incurs a very large overhead (can easily be 300-500megs per app depending on your gems and how big your app is). Because of that, the infrastructure needed to serve rails is a hell of alot more complecated then most other things.

Now, that being said, the situation has been continuously getting better (I mean, passenger is usable now, it wasn't the last time I had to deal with deploying a rails app). I would be very surprised if rails doesn't catch up in the next few years.

Also, rubinius/jruby are doing things the right way, and are moving along at a great pace. I wouldn't be suprised if MRI gets dropped in the next few years in favor of one of those implementations for mainstream rails work.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T20:31:39.547

**edit:** Matt amended his answer tastefully :) I've removed my own comments pointing out the things he's fixed.

Yes, Ruby definitely has some shortcomings. Green threads being a huge one. But as Matt has said, things are moving along in better directions.

The other posts are pretty much on the money. Decently simple CRUD apps are best suited for rails, though there *are* other frameworks you can try in Ruby that offer more flexibility.

Here's a great (and might I add objective) example of where *not* to use rails: [Does the Rails ORM limit the ability to perform aggregations?](https://stackoverflow.com/questions/504553/does-the-rails-orm-limit-the-ability-to-perform-aggregations)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T19:03:18.243

哇，开始一场火焰战的方式！

我将首先说 Rails 适用于大多数应用程序。然而，如果你需要做很多异步类型的工作（比如系统之间的消息传递，比如获取一个请求，把它放在一个队列中并在不同的线程中处理它，甚至在另一台机器上），Rails 可能不是你的最好的选择。Ruby，至少在目前，在多线程代码方面并不是很强大。

让侮辱飞起来！

# powershell - Powershell 导致 a: 启动时寻找；我该如何阻止这个？

> ID：504423
> 
> 赞同：2
> 
> 时间：2009-02-02T18:58:57.363
> 
> 标签：powershell

我已经编写了一个 powershell 脚本，我已经把它变成了一个计划任务。到目前为止，一切都很好。我遇到的问题是每次启动 Powershell 时，都会导致我的软盘驱动器进行寻道；这意味着每五分钟（根据任务计划），我会从软盘驱动器中得到一点“磨合”。

如何禁用此行为？

```
    C:\fa>powershell -noprofile
    Windows PowerShell
    版权所有 (C) 2006 Microsoft Corporation。版权所有。

    PS C:\fa> 退出

    C:\fa>
```

当我做这个测试时，我在开始*和*退出时都会得到一个搜索。如果我有一张软盘放入驱动器，我认为错误会消失。

作为一个糟糕的解决方法，我在 BIOS 中禁用了软盘驱动器。我已经删除了关于驱动器不可用的红鲱鱼；这是因为另一个问题。

在我的个人资料中找到指向 A: 的内容的建议方法一无所获。

```
PS C:\fa2> dir Env:\ | ?{$_.Value -like "A:\*"}
PS C:\fa2> 
```

当然，这是在我在 BIOS 中重新启用软盘驱动器之后。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-05T04:29:12.250

我会说它是在运行时发生的驱动器枚举。Powershell 构建驱动器列表并为每个驱动器创建别名，因此您可以键入“A:”并使其像 cmd.exe 一样工作。我认为这是因为如果您在不拥有共享驱动器（由另一个节点拥有）的集群服务器上启动 Powershell，它会发出一个错误，指出该驱动器不可访问。然而，外壳中的一切都是正常的。

话虽如此，我从未在我管理的数百台机器中的任何一台上看到过这种行为（软盘驱动器在加载时搜索）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T19:10:15.360

它可能是您的个人资料脚本中的内容。我没有遇到过 PowerShell 导致任何软盘驱动器活动...
如果您使用 -noprofile 选项启动 PowerShell.exe，它将不会运行配置文件脚本（只要您的脚本不依赖于配置文件中的任何内容）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-04T22:06:21.523

停止使用软盘？

/鸭子

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T15:57:38.617

我认为这可能是权限问题。您可以在 PowerShell 之外访问驱动器吗？

[我在这里](http://blogs.msdn.com/johnsheehan/archive/2007/11/27/a-very-powershell-thanksgiving.aspx)和[这里](http://www.techtalkz.com/microsoft-windows-powershell/180540-initializedefaultdrives-error-message-startup.html)找到了几个关于这个问题的参考资料。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-04T02:50:48.347

检查以确保您的环境中没有任何内容指向驱动器。

```
 dir Env:\ | ?{$_.Value -like "A:\*"} 
```

# c# - 在数组内移动对象

> ID：504427
> 
> 赞同：0
> 
> 时间：2009-02-02T18:59:53.383
> 
> 标签：c#, arrays, memory, object, xna

我正在尝试在 XNA 中制作类似俄罗斯方块的游戏，目前我正在考虑最好的处理方式。

这就是我目前所拥有的：我有一个名为 Block 的类，它具有例如纹理和颜色色调。

然后我打算把所有东西都放在一个双数组中，比如：

```
Block[,] blocks = new Block[10,20]; 
```

这将是完整的网格。

然后当块向下移动时，我正在考虑这样做：

```
blocks[x,y+1] = blocks[x,y];

blocks[x,y] = null; 
```

起初我认为这是一个好主意，但现在当我一直在思考时，我不太确定。它如何与内存等一起工作？每次我这样做时它会创建一个新对象还是什么？有人可以解释一下当我在数组中移动对象时它是如何工作的吗？

我并不是真的在寻找特定于俄罗斯方块的答案，我只是对它的实际工作方式感兴趣。

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T19:06:46.083

不，你只是在移动指针。当你说：

```
blocks[x,y+1] = blocks[x,y]; 
```

你本质上做的是交换指针。该对象将准确地停留在它所在的位置，但现在它不是在索引 x,y 处，而是在 x 的索引处，y+1。当你说

```
blocks[x,y] = null; 
```

在那里你正在删除对对象 x,y 的引用，如果没有其他东西持有引用，垃圾收集器将清理它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T00:01:56.083

上面的第一个答案几乎是正确的，但是分配不是交换指针，而是复制它。在第一行代码之后，有两个对最初在 blocks[x,y] 处引用的对象的引用。空赋值删除了原始引用，但新引用仍然存在于 blocks[x,y+1]。Null 和堆对象将是 GC 的公平游戏。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T19:08:25.677

如果您在数组中存储值类型（例如 int、string），那么每次复制值时确实会创建数据的副本，因为值类型在 C# 中是不可变的。由于您在数组中存储了一个类（这是一个引用类型），因此您的代码实际上只是制作了指针的副本，而不是整个对象。

# algorithm - 您将如何编写程序来生成俳句？

> ID：504428
> 
> 赞同：78
> 
> 时间：2009-02-02T19:00:00.903
> 
> 标签：algorithm

计算机俳句
你会如何编写一个程序
来为你制作它们

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-02-02T21:08:04.530

测量音节
理解语义流
你的目标可以实现

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-02-02T21:26:56.427

请勿尝试诗歌 与金属和碎片
无法很好地融合

更严重的是，好的俳句（甚至是坏的俳句）更多的是浓缩意义和意象，而不是计算音节。它通常也基于从自然中收集的主题。随机单词生成和音节计数会让你得到衡量的胡言乱语，但不是诗歌......

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-02T19:18:47.933

首先，您需要研究[马尔可夫链](http://en.wikipedia.org/wiki/Markov_chain)，其次，有一本关于计算机生成诗歌的书，名为[Virtual Muse](https://rads.stackoverflow.com/amzn/click/com/0819522392)。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-02-02T21:07:33.393

*   计算音节
*   随机生成单词
*   合理安排

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-04-03T21:50:55.480

俳句 很简单，我会 记
下来

//我其实很喜欢俳句

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-02T19:12:51.143

并非所有的俳句都有相同数量的音节，但这是一个开始的地方。

在实际挑选单词方面，我认为词类不是我要开始的地方。相反，我会查看[马尔可夫链，并在现有的俳句上训练你的词汇量。](http://www.cs.umd.edu/class/spring2007/cmsc132/Projects/p6/p6.html)

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-04-03T21:24:26.073

在[俳句村](http://www.haikuvillage.com)，我们拥有以多种方式轻松完成此任务的技术。一种想法是简单地阅读全球 twitter 提要，并检测无意的俳句。由于后端也有字典，可能会产生有问题的俳句，但我认为质量会有所欠缺。

我认为如果我们有一个星级评分系统，那么我想机器学习可以用来决定什么是“好”。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-02-19T14:14:09.670

```
for (i is 0
and i is less than thirteen)
print s i plus plus 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-02T20:26:27.093

实现一种遗传算法，从带有音节计数注释的字典中生成俳句，然后付钱让人们阅读并将它们作为适应度函数进行评分[机械土耳其人会有所帮助]。随着时间的推移，您的程序应该会发展出一些好的程序。

编辑：

如果您注意健身，您需要的 GA 会
以 CPU 速度发展

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-02T21:50:46.783

“用十七个音节来表达一个人的心情是很困难的……” （伟大的[约翰库珀克拉克](http://www.johncooperclarke.com/Pages/poemlist.htm)退房[比斯利街](http://www.johncooperclarke.com/Pages/beasley.htm)，我的最爱之一）

电脑有多难？逻辑不知道情绪:)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-03T01:00:10.957

为了使其可读，将字典分成名词、动词、形容词，并带有音节计数。

想出一些表格的模板：

[名词] [动词]"s"

[动词] a(n) [形容词] [名词]

[形容词] [名词]

并把你的字典修剪成美丽的词。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-04-03T21:40:43.740

你的程序必须理解
隐喻和意象
并具有创造性。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-02T19:10:22.100

我会查找句法编程和语言，并尝试找到语法结构的库。从那里添加字数和音节数约束应该是一个简单的步骤。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-02T23:23:20.030

这里有人建议使用字典并使用*马尔可夫链*生成单词序列。这似乎是一个理论上可行的解决方案，特别是如果您使用高阶马尔可夫链（不是二元或三元组）。

但我认为在实践中，如果您可以收集现有俳句的数据库并*有选择地更改其中的单个单词*（例如，将给定单词更改为另一个语义相关的单词），效果会更好。现有的俳句为您提供了某种结构和凝聚力，您只需（交换）更改其中的小部分即可创建新的俳句（旧俳句的变体）。

当然，使用这种方法，它们不会是全新的俳句，但至少它们会为读者带来一些乐趣。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-03T07:33:38.167

按关系顺序解析现有的俳句，例如在 yy n 次之后使用的单词 xx。因此，在创建时，xx 出现在 yy 之后的可能性将是（n / yy 之后使用的所有单词的总数）。这样，它将被选择性地随机化，并且仍然可以是有效的俳句。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-02-03T09:23:08.167

编写程序以生成日语俳句。测量你的音节数量会容易得多，而且你会忠于诗歌的原始语言。如果您对项目有灵活性，为什么不制作原始日文 - 然后将英文逐字逐字显示在其旁边。至少可以说它看起来很神秘。

无论如何，只是对问题的不同看法。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2010-09-30T08:34:18.117

马尔可夫序列
音节数据库
三行python

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-02-02T19:03:25.250

我将从某种字典文件开始，其中包含每个单词的音节数。然后从中挑选单词加起来所需的音节/行

至于使它成为诗歌，而不仅仅是随机的单词，我不知道。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-02-02T19:07:48.483

除了使用 Ian 的音节计数概念外，您还可以按词性对单词进行分类并生成短语。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-02-02T19:25:00.073

从故事的语义看，使用采样和傅立叶变换。选择一些用单个单词简化的详细描述的重要部分，并留给读者用她自己的想象力来填补空白

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2010-09-30T08:29:07.000

让计算机输出高质量俳句的算法是这样的：

## 设置阶段

```
loop:
  find the email address of a world-renowned writer of haiku
  confirm that this person is willing to generate haiku on demand
until sucker^H^H^H^H^H^Hwriter is found 
```

## 执行阶段

```
loop:
  wait for a haiku request
  when a haiku request is received, email the previously-stored master and ask for a haiku
  wait for the haiku to return by reply
  output haiku 
```

当然，可以对这个基本架构进行各种增强。例如，设置阶段可以扩展为建立一个俳句专家*池*。执行阶段可用于在空闲时间生成俳句，并将它们缓存以应对未来的需求。这种调整的细节留给学生练习。

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2010-02-19T13:51:55.180

我喜欢这个问题。这是非常有想象力的。下面回答。

* * *

很多人建议马尔可夫链，但我真的不认为这是可能的。您需要智能地知道音节是否是 PHONEMES，然后您必须知道音节在哪里结束。

如果你曾经这样做过，我会感到惊讶。

# tsql - T-Sql 如何从另一个存储过程中的存储过程返回表

> ID：504431
> 
> 赞同：14
> 
> 时间：2009-02-02T19:00:25.630
> 
> 标签：tsql, stored-procedures

我想做以下事情。基本上有一个存储过程调用另一个返回表的存储过程。这是怎么做到的？

```
 ALTER PROC [GETSomeStuff]
    AS
    BEGIN

    @table = exec CB_GetLedgerView @accountId, @fromDate, @toDate, @pageSize, @pageNumber, @filter, @status, @sortExpression, @sortOrder, @virtualCount OUTPUT

   Select * from @table
   --Do some other stuff here        
    END 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-02T19:03:58.260

存储过程的目标必须是临时表或实际表，因此您可以

```
 Insert into #table exec CB_GetLedgerView @accountId, @fromDate, 
@toDate, @pageSize, @pageNumber, 
@filter, @status, @sortExpression, 
@sortOrder, @virtualCount OUTPUT 
```

如果存储过程的输出结果集与目标表中的顺序位置和行数不匹配，则指定列列表。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2013-06-25T18:32:34.660

至少如上所述，临时表方法对我不起作用。您可以轻松地使用变量。

```
DECLARE @return_value INT
DECLARE @tblOutputTable TABLE(Col1 BIT NOT NULL, Col2 INT NOT NULL)

INSERT INTO @tblOutputTable EXEC @return_value = [dbo].[SomeSp] @Param1 = 15, @Param2 = 2 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T20:07:42.967

也许您的示例并不真正具有代表性，但我的第一个问题是，您是否真的需要以更大的复杂性为代价进行这两个程序？像这样的分解在某种程度上是 SQL 的反模式。（尽管有些人会不同意，但我已经在 SO 上看到了这一点，并得到了多数同意。）

# java - 有没有一种方法可以使以前的版本最新，而无需在 teamprise 中进行另一次提交？

> ID：504441
> 
> 赞同：0
> 
> 时间：2009-02-02T19:02:46.233
> 
> 标签：java, eclipse, version-control, tfs, teamprise

标题或多或少总结了它。我们使用 MS TFS 作为我们的版本控制，它通过 teamprise 插件（企业标准，主要是一个 MS 商店。我希望我们可以只使用 SVN，因为坦率地说 Teamprise 插件是相当残暴的）集成到 eclipse。假设有人提交了一个包含我们想要保留的更改的文件，但还没有。如果此提交是第 3 版，是否有办法将第 2 版标记为最新版本，而无需将第 2 版重新签入第 4 版，这意味着我稍后必须将第 3 版签入第 5 版，而不仅仅是重新标记 4作为我想使用它的最新时间？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T21:04:50.200

在 TFS 中，特定路径的“最新”被确定为为该项目签入的最后一个文件（解决了任何合并冲突）。我会建议一些可以为您提供所需工作流程的东西：

1.  在分支机构工作对你有帮助吗？然后，您可以决定何时将代码主线中的更改合并到您正在处理的区域中。
2.  Teamprise 支持 Eclipse 中的同步功能，因此您可以右键单击项目并选择“同步”。这将向您显示与存储库中最新版本相比的更改。从那里您可以将这些文件与最新版本进行比较，并查看您想要更新哪些文件以及您希望将哪些文件保留在本地（工作区）版本中。
3.  如果您对任何文件或文件夹执行“查看历史记录”，您将获得该文件发生的更改历史记录。然后，您可以通过从历史视图中选择“获取此版本”来获取您想要的任何特定版本。
4.  如果分支对您不起作用，那么您可能想尝试使用标签。在 TFS 中，标签就像“标签”并且是可编辑的。使用这些机制（例如同步和从历史中获取），您可以决定您想要拥有哪些版本的文件并用您的特定标签标记这些文件。然后，您可以执行“获取特定”并添加您的标签名称（如果您愿意）。

如果您要问的是“有没有办法轻松回滚更改”，那么您可以说版本 4 或文件有您不想要的更改，所以您想将每个人的代码回滚到版本 3 ，那么恐怕现在唯一的方法是签出文件，获取旧版本（从历史记录视图），然后签入该文件。发布时，TFS 2010 将具有本机支持将回滚作为版本控制操作，Teamprise 应该在服务器可用时立即支持它。

此外，我要补充一点，我个人从使用持续集成等工具中获益良多（TFS 2008 对开箱即用的 CI 提供了一些出色的支持，但其他开源 CI 服务器，例如 CruiseControl 和 Hudson 也支持 TFS）。这一点，再加上 TFS 的签入是原子的这一事实，意味着开发人员可以学会相信“最新”版本的代码总是好的。它鼓励开发人员经常和定期签入更改。

可能是因为这些工作方式，我们可能错过了 Teamprise 的一些功能，这些功能可能会为您提供更多帮助，我们很可能只是假设人们想要获取最新信息，所以这就是我们正在做的最简单的事情。如果您认为 Teamprise 不能充分支持您访问 Team Foundation Server 的功能，那么我很乐意听取您的意见。我的电子邮件地址是 martin@teamprise.com。或者，您可以通过 support@teamprise.com 联系我们的支持热线，访问 Teamprise 论坛，网址为[http://support.teamprise.com](http://support.teamprise.com)或致电 (217) 356-8515 分机给我们的支持团队。2\. 我们喜欢从客户那里获得反馈，以使产品变得更好，而通常会提供最好的反馈的是那些对当前工具不满意的客户。

如果回滚是您非常需要的功能，请告诉我们。

# c - 更改为货币格式的最佳方法是什么？

> ID：504442
> 
> 赞同：1
> 
> 时间：2009-02-02T19:02:46.623
> 
> 标签：c, currency

我有一个需要转换为货币的值列表，例如“12000”、“12345”、“123456”（“120.00”、“123.45”、“1234.56”）。我知道的唯一方法是将值转换为字符串，将第一个 strlen()-2 字符复制到一个字符串（美元），将剩余的两位数字复制到另一个字符串（美分），然后将它们写入如下：

```
printf("%s.%s", dollars, cents); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-02T19:05:06.570

```
printf("$%.2f", value/100); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-03T08:14:33.670

不要使用浮点数来存储或表示货币金额。使用多头（如果您需要超过 40 亿美分，请使用多头）。以最小可用单位表示货币通常是个好主意，例如使用 10000 表示 100Euro）。那么格式化这些值的正确方法（假设 100 美分兑欧元或美元）是：

```
printf( "%d.%02d", value/100, value%100); 
```

希望这是有道理的...

用货币价值计算是一个复杂的主题，但你不能出错，因为你总是希望对最接近的货币单位（例如美分）有一个四舍五入的答案，并始终确保计算四舍五入误差（例如，除以 1 美元您应该以三种方式结束 33+33+34 或 33+33+33+1)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-05T23:45:10.857

要将小于 $1.00 的值加上 0 前缀，请使用：

printf("$%0.2f", value / 100.0);

如果 value = 25，这将导致 $0.25

# jquery - 如何从 ASP.NET AJAX 响应中显示灯箱对话框

> ID：504464
> 
> 赞同：2
> 
> 时间：2009-02-02T19:07:30.827
> 
> 标签：jquery, ajax, asp.net-ajax, thickbox

我想在我们的网站上使用Thickbox（或其中一种）来显示从服务器返回的信息消息。示例包括从 biz 逻辑返回的警告消息等。

需要此功能的第一个地方是 asp:wizard 控件上的导航按钮。当用户尝试继续前进时，我们会验证他们的产品选择，并且可能会有我们需要显示的消息。

对于测试，由于我是 JQuery 和 Thickbox 的新手，我创建了一个测试页面。相关部分如下：

```
<asp:Panel runat="server" ID="pnl" Visible="false" style="display:none;background-color:Black;">
<div style="background-color:Black; width=300; height=200; ">
    <asp:Label runat="server" ID="lblMessage" ForeColor="White" />

    <script language="javascript" type="text/javascript">

        function showMessage()
        {
            tb_show("Message", "#TB_inline?height=200&width=300&inlineId=<%# me.pnl.ClientID %>", null);
        }

        $(document).ready(function() { showMessage(); });

    </script>
</div> 
```

目前，我让Thickbox 在IE7 中显示，但它翻了一番。我将两个垂直的厚盒堆叠在一起，都有标题和关闭按钮，只有最上面的一个有我的内容。

在 Chrome 中，窗口的背景是灰色的，但没有可见的厚框窗口。

当我将整个内容包装在 AJAX UpdatePanel 中时，我什么也得不到。

我究竟做错了什么？

* * *

好的，所以更多信息。我已经得到了Thickbox 和另一个名为LightView 的工作。以下脚本块在页面中是静态的（Thickbox 版本）：

```
<script type="text/javascript" language="javascript">
        function showMessage(sender, args)
        {
            tb_show("Message", "#TB_inline?height=200&width=300&inlineId=ctl00_ctl00_cph1_cphMain_pnl", null);

     }
     function StartWatch() {
         var prm = Sys.WebForms.PageRequestManager.getInstance();
         prm.add_endRequest(showMessage);
     } 
```

回发设置标签的文本，该文本位于对 tb_show 的调用中指定的 div 内。*我知道在回发触发之前*需要调用 prm.add_endRequest 调用。

有几个问题。首先，这其中有太多是硬连线的——页面中的 asp:panel 和标签、拼写出的 div 的 ID 等等。

我们真正想要的是能够以某种方式从后面的任何代码中调用它，例如：

```
Page.ShowMessage("Hello lightbox!") 
```

我想我可以在母版页文件中包含一些脚本和一个 DIV。在被调用之前它将被隐藏。

但是，我需要能够：

a) 控制何时发生。并不是每个 AJAX 请求（事实上，大多数都不需要）在返回时都需要显示一条消息。因此，我要么不必调用 endRequest 方法，要么让 endRequest 方法检查从 AJAX 调用返回的内容以确定它是否真的需要调用 showMessage()。

b) 我需要找到一种方法让 UpdatePanel 包含消息中的某些内容。*如果我可以在调用 showMessage()之前*执行一行 JavaScript 来更新隐藏消息或设置隐藏消息 DIV 的内容，我想我们会很高兴。

厚盒插件使用 JQuery，Lightview 使用原型和脚本。Lightview 更漂亮——更好的图像、动画等。我真的不在乎哪个。

我正在使用 .NET 中内置的 AJAX (Atlas) 框架。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T18:52:57.257

迟到的答案，但也许还不算太晚。我对你的问题有点困惑，我将回答这部分：

> 我们真正想要的是能够以某种方式从后面的任何代码中调用它，例如：
> 
> Page.ShowMessage("你好灯箱！")

让我们用Thickbox 和jQuery 来做，这是我所熟悉的，但这会给你一个用Lightview 重现它的总体思路。首先，您需要一个客户端脚本来转换“Hello lightbox！”。将消息转换为 html 元素，然后将其用作带有 TB 的内联内容。为此，我们将创建一个 id 为 myTBInline 的 div：

```
function showMessage(message)
{
    var divId = "myTBInline"; // You can change this id...

    var div = $("#" + divId); // try to retrieve the div if it exists

    if (div.length > 0) // if div already exists (previous call)
        div.empty();    // then remove its content
    else
        div = $('<div id="' + divId + '"/>'); // else create it

    // add the message to the div
    div.append(message);

    // display Thickbox using the div as inline element
    tb_show("Message", "#TB_inline?height=200&width=300&inlineId=" + divId, null);
} 
```

这是困难的部分。现在是简单的部分，能够从后面的代码中调用它。您必须添加一个方法，因为它可以是静态/共享的。我通常使用 C#，但我会尝试为您使用 VB 语法编写它（我上次使用 VB.Net 是在 2005 年；）

```
Public Shared Class Thickbox
    Public Shared Sub ShowMessage(Type type, string message)
        Dim script as String = "showMessage('" + message.Replace("'", "\'") + "');";
        ClientScriptManager.RegisterStartupScript(type, "Thickbox", script, true);
    End Sub
End Class 
```

干得好。在您的页面中，您可以通过以下方式使用该方法：

```
Thickbox.ShowMessage(GetType(), "Hello Thickbox!"); 
```

查看关于 SO 的[其他问题。](https://stackoverflow.com/questions/625326/control-lightbox-modal-from-code-behind-of-asp-net)该实现使用 jqModal 并且非常小（不需要客户端脚本）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-24T02:56:35.900

If you want to control when the message is displayed with endRequest, one really simple method is to use a variable. Set a hidden input field as a flag (should be in the update panel as otherwise it would not be updated). Then, in your ShowMessage function, always read the value of the hidden input. If set, then popup the Thickbox. Else, do nothing.

As for the item b, you could go the same route (but this might just pepper the view with lots of unnecessary hidden fields). Any thoughts of using page methods or web services? It's lot more flexible for interaction.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-10T05:16:54.683

我经常遇到的一件事是，当您从 AJAX 请求返回 javascript 时，出于安全原因，默认情况下它不会执行，您必须在 ajax 请求中启用它。很抱歉很痛苦，但我只知道 Prototype 中的设置，而不是 Asp.Net AJAX - 但至少需要检查一下吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-25T11:15:46.817

我有一个问题，即在 jQuery 库中使用灯箱可能会导致一些问题，其中灯箱由于某处发生冲突而无法正确加载。

我发现的方法是使用 jQuery 版本的灯箱。 [http://plugins.jquery.com/project/jquerylightbox_bal](http://plugins.jquery.com/project/jquerylightbox_bal)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-24T06:36:42.207

另一种方法是用您选择的模态覆盖 JS 的内置`alert()`和`confirm()`函数（而不是显示您可能认为的浏览器默认模态）。

[http://dev.iceburg.net/jquery/jqModal/#examples](http://dev.iceburg.net/jquery/jqModal/#examples)并向下滚动到“覆盖”以获取示例。您可以在此页面上的 firebug 控制台中尝试一下。跑：`alert('zomg!');`在那儿。

```
function alert(msg) {
  //your modal js here.
} 
```

对 ASP.NET 了解不多，但我假设发送警报是默认情况下会帮助您完成的事情。这只会覆盖默认操作。

# mysql - 导入从 mysqldump --routines 生成的 mysql 过程

> ID：504475
> 
> 赞同：5
> 
> 时间：2009-02-02T19:09:58.027
> 
> 标签：mysql, stored-procedures, mysqldump

我使用 mysqldump 工具来制作我的数据库的副本。问题是，当我使用 --routines 参数输出我的存储过程和我的数据时，当我尝试导入它时，生成的输出会导致错误。

它是这样的：

```
% mysqldump --routines MyDB | mysql MyDB2 
```

（其中 MyDB2 已存在但为空）

我得到的错误如下：

```
ERROR 1064 (42000) at line 307: You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near '' at line 23 
```

如果我省略 --routines，一切都会正常工作。

有人遇到过这种情况么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T19:33:50.960

我可以通过将它分成两个调用来实现它：

```
% mysqldump MyDB | mysql MyDB2
% mysqldump --routines --no-create-info --no-data --no-create-db --skip-opt MyDB | mysql MyDB2 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-02-11T22:58:42.057

如果在 MyDB2 中运行查询时出现错误，最好：

1.  运行 mysqldump 将输出保存到保存的文件中。
2.  一点一点地运行文件，找出哪个部分有问题。
3.  修复那一点。

我曾经遇到过这样的问题，我从旧版本的 mysql 导出并导入到新版本中，该新版本已将我的列名之一声明为保留字。您在不同服务器上的两个数据库是否运行不同版本的mysql？或者数据库之间是否存在其他差异（例如字符集）？

# dependencies - 逻辑和物理组件

> ID：504480
> 
> 赞同：1
> 
> 时间：2009-02-02T19:11:55.573
> 
> 标签：dependencies, logical-components

对于这个小组作业，我们必须生成一个设计文档，其中包括系统/模块间依赖关系以及进程间依赖关系的分解。

我们被警告要注意逻辑组件和物理组件之间的差异。有人可以向我解释一下每个是什么吗？

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T23:54:00.343

组件是一个专门的类，它具有一个或多个提供和必需的接口形式的外部规范，以及一个由一个或多个实现其行为的分类器组成的内部实现。（感谢该定义的 UML 规范）。

物理组件是特定于平台的，类似于 CORBA 或 .NET 或 WSDL 组件——以具体形式存在于系统中的东西。逻辑组件与平台无关（或与平台无关），是一种有用的设计工件，可能会或可能不会被实现为物理组件。

# asp.net-mvc - ASP MVC Release Candidate 1 的安装问题

> ID：504487
> 
> 赞同：0
> 
> 时间：2009-02-02T19:13:03.107
> 
> 标签：asp.net-mvc, installation

我已经尝试安装 RC1 必须已经 5 次并且总是在“配置模板”步骤中遇到相同的问题。我已经尝试了我能想到的一切，但现在我既没有 RC1 也没有 Beta。有没有人遇到过这个错误？对我能做什么有什么建议吗？

我的问题的屏幕截图在[这里](http://picasaweb.google.com/lh/photo/4jr9YoJPo3x_vv66Ipd5Cg)（不知道为什么我不能将它作为图像放置。

[（在这里](http://forums.asp.net/t/1378638.aspx)交叉发布到 ASP.NET 论坛，但我真的不希望那里有太多有用的响应。）

**编辑：**这是我能想到的所有可能会影响它的东西：Coderush、Refactor Pro!、Source Outliner、TestDriven.Net、MbUnit（安装一些模板）、一些 DevExpress 插件（GhostDoc、CR_Classcleaner） , F#, 规格#

我还安装（和卸载）了 ASP.NET MVC Beta

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T15:14:35.087

碰巧遇到这个……你安装了 VS 的 Clone Detective 吗？似乎有些人在安装 MVC Beta 时遇到了麻烦。

[http://www.codeplex.com/CloneDetectiveVS/WorkItem/View.aspx?WorkItemId=11549](http://www.codeplex.com/CloneDetectiveVS/WorkItem/View.aspx?WorkItemId=11549)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-03T01:09:09.487

在删除任何较旧的 MVC 安装的明显步骤之后，我听说模板可能与 Visual Studio 加载项有问题。尝试删除您可能正在运行的 VS 的任何附加组件，然后运行安装程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-10T18:38:36.720

作为记录，给我带来问题的是 F# 或 Spec#，因为我并没有真正使用太多，我都卸载了两者，RC1 运行良好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T19:35:08.150

您没有明确说明，您是否安装了任何其他以前的版本（例如测试版或预览版）？在安装 RC 之前，您需要卸载 Beta 或 Preview x。

# javascript - 关于使用 NAnt 创建和部署最小化 JavaScript 的建议？

> ID：504493
> 
> 赞同：2
> 
> 时间：2009-02-02T19:15:22.213
> 
> 标签：javascript, nant, packing, minimized

您对如何使用 NAnt 部署最小化（最小）版本的 JavaScript 文件有任何建议或示例吗？

是否有任何好的命令行应用程序或脚本来帮助在 Windows 上最小化或打包 JavaScript？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T19:19:27.243

如果你对 Java 的依赖没问题，你可以使用[YUI Compressor](http://developer.yahoo.com/yui/compressor/)（否则有[它的 .NET 端口](http://www.codeplex.com/YUICompressor)）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T19:40:10.510

Kariem（我的同事）围绕 JSMin（Douglas Crockford 的 C# 代码）编写了一个开源 nAnt 任务包装器，可以在[这里](http://ra-ajax.org/custom-nant-jsmin-task-for-minifying-javascript-files.blog)找到...

当您以后想在 nAnt 中执行 GZip 任务时，也可以随意使用我们的（也是开源的）[nAnt gzipper](http://ra-ajax.org/webresource-axd-and-javascript-gzip-compression-a-simple-solution.blog)

这两个都是[Ra-Ajax](http://ra-ajax.org)下载的一部分，可以[在谷歌代码的 Ra-Ajax 下载页面找到](http://code.google.com/p/ra-ajax/)

哦，是的，几乎忘了提到他们都有一个许可的开源许可证（免费使用），尽管在“道格拉斯精神”中我们选择在他自己的自定义开源许可证下发布它们，这大致是一个 MIT 许可证尽管带有“不用于邪恶目的”条款；）

我们发现“无恶”条款非常有趣，我们不得不自己使用它。此外，我们正在构建 Doug 的代码，所以构建“他的精神”也是公平的，对吧...？;)

玩得开心 ：）

# c# - 当 MultiColumn 设置为 true 时，如何使我的选中列表框垂直滚动？

> ID：504494
> 
> 赞同：1
> 
> 时间：2009-02-02T19:15:59.857
> 
> 标签：c#, .net, winforms, checkedlistbox

我有一个 Checkedlistbox，它有 3 行高，大到可以显示大约 5 个元素。

只要我的元素少于 15 个，一切都运行良好。但是，如果我添加第 16 个元素，checkedlistbox 会显示一个水平滚动条，它占用 2 个项目行，这意味着所有项目现在只在一行上。

更糟糕的是，如果我删除了额外的项目，水平滚动条会保持原位。

我试过使用：

```
mycheckedlistbox.HorizontalScrollbar = false;
mycheckedlistbox.ScrollAlwaysVisible = false; 
```

但这似乎没有任何效果。

我使用 multicolumn=true 模式，这似乎导致了这种不当行为

有没有办法阻止控件显示水平滚动条，而是使用垂直滚动条？

我在[msdn 论坛](http://social.msdn.microsoft.com/Forums/en-US/winforms/thread/34dc9eb0-57b5-4b8f-9b32-5f496f3519ba/)上找到了一个有类似问题的人，但似乎他没有得到答案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T19:29:32.623

滚动条使项目的布局双稳定。您可以通过敲击头部使滚动条消失：

```
 checkedListBox1.MultiColumn = false;
  checkedListBox1.MultiColumn = true; 
```

这迫使 WF 重新创建控制手柄，闪烁可能几乎看不到。是的，垂直滚动条是可能的，但您必须放弃 MultiColumn。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T19:29:39.720

好吧，从那里的答案和我进行的少数测试来看，这似乎是不可能的，但与此同时，我认为你正在试图打破这个目的。如果我在你的鞋子里，我会使用一个没有网格线的 DataGridView 和一个不能编辑的。您可以更好地控制网格中发生的事情，并且您可以自定义它比 CheckedListBox 更多。您可以获得与那里的 DataGridViewCheckBoxColumns 相同的效果。

（如果您需要代码示例，请在评论中发布，我会快速制作示例。）

# wpf - 一个简单的 ParentAdapter 实现是什么样的？

> ID：504499
> 
> 赞同：0
> 
> 时间：2009-02-02T19:18:25.093
> 
> 标签：wpf, design-time, cider

我正在尝试编写一个`ParentAdapter`实现；我有兴趣为我正在编写的一些 WPF 控件提供设计时支持，这就是您管理自定义逻辑以将项目重新设置为不同容器控件的方式。我从小处着手，创建一个`StackPanel`只允许`Button`在设计时作为父元素的派生类的概念（是的，我知道面板本身也需要代码来支持这一点。）我从我的想法开始可能是最简单的`ParentAdapter`：

```
using System;
using System.Windows;
using System.Windows.Controls;
using Microsoft.Windows.Design.Interaction;
using Microsoft.Windows.Design.Model;

namespace ControlLibrary.Design
{
    internal class SimplePanelParentAdapter : ParentAdapter
    {
        public override bool CanParent(ModelItem parent, Type childType)
        {
            return (childType == typeof(Button));
        }

        // moves the child item into the target panel; in this case a SimplePanel
        public override void Parent(ModelItem newParent, ModelItem child)
        {
            using (ModelEditingScope undoContext = newParent.BeginEdit())
            {
                // is this correct?
                //child.Content.SetValue("I'm in a custom panel!");
                SimplePanel pnl = newParent.GetCurrentValue() as SimplePanel;
                pnl.Children.Add(child.GetCurrentValue() as UIElement);                
                undoContext.Complete();
            }

        }

        public override void RemoveParent(ModelItem currentParent, ModelItem newParent, ModelItem child)
        {
            // No special things need to be done, right?
            child.Content.SetValue("I was in a custom panel.");
        }
    }
} 
```

当我在设计时使用它时，只要我将一个按钮拖到我的自定义面板上，`NullReferenceException`就会从 VS 代码的深处抛出一个。我的代码没有抛出异常，因为我可以一直执行我的方法；调用堆栈表明 Microsoft.Windows.Design.Developer.dll 中的代码正在引发异常。

显然我做错了什么，但文档没有提供任何示例，我的 search-fu 似乎表明没有人在尝试这个，或者任何尝试它的人都没有谈论它。有人有建议吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T20:24:05.290

我自己找到了我的问题的答案。该问题是由编辑模型而不是`ModelItem`包装器引起的。我应该做的（并且确实有效）是这样的：

```
using System;
using System.Windows.Controls;
using Microsoft.Windows.Design.Interaction;
using Microsoft.Windows.Design.Model;

namespace ControlLibrary.Design
{
    internal class SimplePanelParentAdapter : ParentAdapter
    {
        public override bool CanParent(ModelItem parent, Type childType)
        {
            return (childType == typeof(Button));
        }

        // moves the child item into the target panel; in this case a SimplePanel
        public override void Parent(ModelItem newParent, ModelItem child)
        {
            using (ModelEditingScope undoContext = newParent.BeginEdit())
            {
                ModelProperty prop = newParent.Properties["Children"];
                ModelItemCollection items = (ModelItemCollection)prop.Value;
                items.Add(child);

                undoContext.Complete();
            }

        }

        public override void RemoveParent(ModelItem currentParent, ModelItem newParent, ModelItem child)
        {
            using (ModelEditingScope scope = child.BeginEdit())
            {
                ModelProperty prop = currentParent.Properties["Children"];
                ((ModelItemCollection)prop.Value).Remove(child);

                scope.Complete();
            }
        }
    }
} 
```

当我编写第一个代码并且不确定我应该如何在 Children 属性上调用 Add() 时，我感到很困惑；看起来 ModelProperty.Value 用 ModelItemCollection 包装了集合，所以除非你不遗余力地让你的类使用钝接口，否则它应该可以工作。

# c# - 读取混合（即文本和二进制）数据的最佳方式是什么？

> ID：504500
> 
> 赞同：3
> 
> 时间：2009-02-02T19:18:37.497
> 
> 标签：c#, file-io

我需要能够读取混合二进制和非二进制数据的文件格式。假设我知道输入是好的，那么最好的方法是什么？举个例子，让我们假设一个文件的第一行是双精度，换行符（0x0D 0x0A），然后是十字节的二进制数据。当然，我可以计算换行符的位置，然后制作一个 BinaryReader 并寻找到那个位置，但我一直认为必须有更好的方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T19:25:06.437

您可以使用 System.IO.BinaryReader。但问题在于，在调用任何 Read 方法之前，您*必须*知道要读取的数据类型。

```
Read(byte[], int, int)
Read(char[], int, int)
Read()
Read7BitEncodedInt()
ReadBoolean()
ReadByte()
ReadBytes(int)
ReadChar()
ReadChars()
ReadDecimal()
ReadDouble()
ReadInt16()
ReadInt32()
ReadInt64()
ReadSByte()
ReadSingle()
ReadString()
ReadUInt16()
ReadUInt32()
ReadUInt64() 
```

当然，在 System.IO.BinaryWriter 中写入也存在相同的方法。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T19:22:46.880

此文件格式是否已修复？如果不是，那么更改为对字符串使用以长度为前缀的格式是一个非常好的主意。然后您可以读取正确的数量并将其转换为字符串。

否则，您将需要从文件中读取块，扫描换行符，并解码正确数量的数据，或者（如果您没有找到换行符）将其缓冲到其他地方（例如 MemoryStream）或只记住起点并适当地倒带流。它*会*很难看，但这只是因为文件格式的不足。

我建议您*不要*“过度解码”（即解码字符串之后的任意二进制数据） - 虽然它可能不会造成任何伤害，但在某些编码中，您可能正在读取不可能的二进制数据序列，然后开始进入 DecoderFallbacks 等领域。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T19:26:40.350

在 Compact Framework 上读取通过网络传入的 HTTP 请求时，我不得不处理这个问题。我的解决方案是推出我自己的非缓冲 ASCII-only StreamReader，这样可以安全地交错调用 StreamReader 和底层 Stream。

# flash - 如何控制动态加载的 SWF

> ID：504504
> 
> 赞同：2
> 
> 时间：2009-02-02T19:19:28.477
> 
> 标签：flash, actionscript-3

我有一个加载外部 SWF 文件的闪存片。我需要能够将加载的 swf 文件移动到主时间轴中的下一帧。

这是代码片段：

```
var request:URLRequest = new URLRequest(file);
loader.load(request);
var swfTimeline:MovieClip = loader.content as MovieClip;
swfTimeline.nextFrame(); 
```

如果我在 swfTimeline 上运行跟踪，我会得到一个空对象引用。我想我找到了解决方法，但现在我遇到的问题是加载的 SWF 是 ActionScript 2，而 AS3 似乎不想将 AS2 SWF 作为普通影片剪辑处理。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-02T20:31:51.530

您需要先在加载器上添加一个事件侦听器，以便知道加载何时完成。所以从你的代码片段我会建议像

```
var request:URLRequest = new URLRequest(file);
loader.addEventListener(Event.COMPLETE, function(event : Event) : void
{
var swfTimeline:MovieClip = loader.content as MovieClip;
swfTimeline.nextFrame();
});
loader.load(request); 
```

组织此代码的许多不同方法，但这应该可以解决问题

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-11T15:17:20.983

如果您想将符号从 Flash 加载到 Flex，那么这应该会有所帮助。

```
loader.contentLoaderInfo.applicationDomain.getDefinition("here linkage name") as Class 
```

此代码可以将一个电影剪辑放置在舞台上，它的基于时间线的动作脚本（动画结束时的停止命令等）完好无损。一种使用方法如下：

```
var c:Class = loader.contentLoaderInfo.applicationDomain.getDefinition("BA_doors") as Class
_animation = new c() as MovieClip
addChild(_doors) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T19:38:41.870

使用加载 SWF 的 Loader 对象的 content 属性。例如...

```
var swfTimeline:MovieClip = loader.content as MovieClip;
swfTimeline.nextFrame(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-01-19T06:32:54.810

应该是..

```
loader.currentTarget.content as MovieClip; 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T20:32:32.497

如果您在尝试获取内容时得到 null，则可能必须等待加载完成事件：

```
 swfLoader.addEventListener(Event.COMPLETE, onSwfLoaded); 
```

一旦 swf 完全加载，您将不再获得 null。

需要注意的一件事是，即使在您获得 COMPLETE 事件之前，swf 上的主时间线也会开始运行。您需要在 Flash 电影的第一帧上使用 stop() 来执行您想要执行的操作......即使这样也可能会出现问题。有时主时间线有自己的想法。

在我的项目中，我们最近决定完全清除主时间线，并从符号库中加载电影......将电影剪辑作为符号加载可以让您完全控制，但您必须使用变换才能正确放置它们（因为您没有没有主舞台了。）

只要您使用的是 AS3 flash9 影片剪辑，您就可以完全控制 Flex。

享受！

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-11T03:07:57.633

据我所知 - AVM2 电影（您的 AS3 电影）与 AVM1 电影（您的 as2 swf）对话的唯一方法是使用 LocalConnection 对象。

至于你的第一个问题 - 我正在与同样的事情作斗争......我需要在完整事件触发之前访问 loader.content 属性。

祝你好运！

问候，

克里斯

# sql - 使用 SQL 搜索一对多关系中的集合

> ID：504508
> 
> 赞同：2
> 
> 时间：2009-02-02T19:20:53.903
> 
> 标签：sql, search

给定表格：

角色：roleid，名称
权限：permissionid，名称
role_permission：roleid，permissionid

我有一组权限，我想查看是否存在具有这些权限的现有角色，或者是否需要创建一个新角色。请注意，我已经知道权限 ID，因此权限表实际上可以忽略 - 为了清楚起见，我只是将其包含在此处。

这可以在 SQL 查询中执行吗？我想它必须是一个动态生成的查询。

如果没有，有没有比简单地遍历每个角色并查看它是否具有确切权限的蛮力方法更好的方法？

请注意，我正在寻找一个具有确切权限集的角色——不多也不少。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T19:28:46.913

您可以选择具有您要查找的权限子集的所有角色。数一数权限数，看看是否正好等于你需要的权限数：

```
select r.roleid 
from role r
where not exists (select * from role_permissions rp where rp.roleid = r.roleid and rp.permissionid not in (1,2,3,4)) -- id of permissions
   and (select count(*) from role_permissions rp where rp.roleid = r.roleid) = 4 -- number of permissions 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T21:12:46.610

在对我对这个问题的第一个答案进行了哈希处理后，这里有一个稍微偏左的字段替代方案，它可以工作，但确实涉及向数据库添加数据。

诀窍是在权限表中添加一列，为每一行保存一个唯一值。

这是一种相当常见的模式，并且会给出精确的结果。缺点是您必须编写代码来隐藏数字等价物。

```
id int(10) 
name varchar(45) 
value int(10) 
```

那么内容会变成：

```
Permission:           Role                   Role_Permission
id  name  value       id  name               roleid permissionid
--  ----  -----       --  ----               ------ ------------
1   Read     8         1   Admin                1          1
2   Write   16         2   DataAdmin            1          2
3   Update  32         3   User                 1          3
4   Delete  64                                  1          4
                                                2          1
                                                2          3
                                                2          4 
```

然后每个角色组合都会给出一个唯一的值：

```
SELECT x.roleid, sum(value) FROM role_permission x
inner join permission p
on x.permissionid = p.id
Group by x.roleid 
```

给予：

```
roleid   sum(value)
------   ----------
    1          120       (the sum of permissions 1+2+3+4 = 120)
    2          104       (the sum of permissions 1+3+4 = 104) 
```

现在我把那个开瓶器放在哪里了……

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T19:45:17.660

这是一个旧的 sql 技巧（至少在 Oracle 中有效）：

```
SELECT roleid FROM role_permission t1
WHERE NOT EXISTS (
(SELECT permissionid FROM role_permission t2 WHERE t2.roleid = t1.roleid
 MINUS
 SELECT permissionid FROM role_permission WHERE roleid = 'Admin')
UNION
(SELECT permissionid FROM role_permission t2 WHERE roleid = 'Admin'
 MINUS
 SELECT permissionid FROM role_permsission t2 WHERE t2.roleid = t1.roleid)
) 
```

也未验证。红酒总是听起来不错。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T19:52:07.960

您基本上需要检查是否有一个角色具有您正在检查的确切数量的不同权限。

我已经在 SQL Server 2005 上检查了这个存储过程，它只返回那些权限 id 与传入的逗号分隔权限 id 列表中的角色 id 完全匹配的角色 id -

```
CREATE PROC get_roles_for_permissions (@list nvarchar(max)) -- @list is a comma separated list of your permission ids
AS
SET NOCOUNT ON

BEGIN

DECLARE     @index INT, @start_index INT, @id INT
DECLARE     @permission_ids TABLE (id INT)           

    SELECT @index = 1 
    SELECT @start_index = 1
    WHILE @index <= DATALENGTH(@list)
    BEGIN

        IF SUBSTRING(@list,@index,1) = ','
        BEGIN
                SELECT @id = CAST(SUBSTRING(@list, @start_index, @index - @start_index ) AS INT)
                INSERT INTO @permission_ids ([id]) VALUES (@id)
                SELECT @start_index = @index + 1
        END
        SELECT @index  = @index + 1
    END
    SELECT @id = CAST(SUBSTRING(@list, @start_index, @index - @start_index ) AS INT)
    INSERT INTO @permission_ids ([id]) VALUES (@id)

SELECT 
r.roleid 
FROM
role r 
INNER JOIN 
role_permission rp 
ON r.roleid = rp.roleid
INNER JOIN
@permission_ids ids
ON
rp.permissionid = ids.id
GROUP BY r.roleid
HAVING(SELECT COUNT(*) 
       FROM role_permission 
       WHERE roleid = r.roleid) = (SELECT COUNT(*) FROM @permission_ids)

END 
```

**示例数据**

```
CREATE TABLE [dbo].[role](
    [roleid] [int] IDENTITY(1,1) NOT NULL,
    [name] [nvarchar](50)
    )

CREATE TABLE [dbo].[permission](
    [permissionid] [int] IDENTITY(1,1) NOT NULL,
    [name] [nvarchar](50)
    )

CREATE TABLE [dbo].[role_permission](
    [roleid] [int],
    [permissionid] [int]
    )

INSERT INTO role(name) VALUES ('Role1')
INSERT INTO role(name) VALUES ('Role2')
INSERT INTO role(name) VALUES ('Role3')
INSERT INTO role(name) VALUES ('Role4')

INSERT INTO permission(name) VALUES ('Permission1')
INSERT INTO permission(name) VALUES ('Permission2')
INSERT INTO permission(name) VALUES ('Permission3')
INSERT INTO permission(name) VALUES ('Permission4')

INSERT INTO role_permission(roleid, permissionid) VALUES (1, 1)
INSERT INTO role_permission(roleid, permissionid) VALUES (1, 2)
INSERT INTO role_permission(roleid, permissionid) VALUES (1, 3)
INSERT INTO role_permission(roleid, permissionid) VALUES (1, 4)
INSERT INTO role_permission(roleid, permissionid) VALUES (2, 2)
INSERT INTO role_permission(roleid, permissionid) VALUES (2, 3)
INSERT INTO role_permission(roleid, permissionid) VALUES (2, 4)
INSERT INTO role_permission(roleid, permissionid) VALUES (3, 3)
INSERT INTO role_permission(roleid, permissionid) VALUES (3, 4)
INSERT INTO role_permission(roleid, permissionid) VALUES (4, 4)

EXEC get_roles_for_permissions '3,4' -- RETURNS roleid 3 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T19:39:06.893

也许使用子查询...

```
SELECT * FROM role r
WHERE r.rolid = (SELECT x.roledid 
                 FROM role_permission 
                 WHERE x.permissionid in (1,2,3,4); 
```

抱歉，还没有验证这一点，但刚刚花了一个小时为另一个问题调试 PHP 代码，我觉得需要一杯红酒。

# asp.net - 如何组织具有许多数据绑定的 ASP.NET 向导控件

> ID：504511
> 
> 赞同：1
> 
> 时间：2009-02-02T19:21:30.533
> 
> 标签：asp.net, controls, wizard

我有一个向导控件，每个步骤都有数据绑定控件。我不能一次将它们全部数据绑定，因为它们依赖于上一步。所以，基本上我在每一步中得到的是保存到上一步的数据库，以及当前步骤的初始化。

关于如何最好地组织我的代码有什么建议吗？它可以工作，但它的可读性不是很好，而且非常脆弱。

编辑：我应该补充一点，我已经看过大多数向导控制教程，但它们似乎都没有解决我想要做的事情。特别是需要在步骤之间保存和检索数据，以及在重新访问该步骤时如何防止它再次检索相同的数据。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-02T19:29:10.440

你所做的听起来很合理。你能更具体地说明你遇到的问题吗？

关于向导控件的一件事，随着您的工作流程变得越来越复杂，我认为您的工作流程状态和向导 SelectedViewIndex 之间的耦合变得有问题。出于这个原因，我最终将它们分开。我通常会使用状态/状态机模式，其中当前工作流状态用于确定适当的向导视图索引（反之亦然）。

如果您正在寻找有关如何实现状态机的示例，我有一个测试应用程序，它可以像向导控件一样遍历对话框，但使用 javascript 除外。查看[http://main(dot)test.wishpot.com/WaveDataCollection.Frank/](http://main(dot)test.wishpot.com/WaveDataCollection.Frank/)，进入 CollectSamples.aspx 页面后，继续查看源代码，然后在 GotoState 函数处开始查看。

C# 中的状态机有点不同，主要区别在于状态对象是一个具有固定数量的事件处理程序的抽象类，每个状态都从实现每个处理程序的类继承（有些可能会引发异常）。使用 javascript，我们不需要抽象状态类...此外，在服务器端执行此操作时，您将需要能够从存储在数据库中的状态 ID 映射到状态类。

# debugging - Flex Builder，让 Flash 播放器在错误时运行

> ID：504513
> 
> 赞同：1
> 
> 时间：2009-02-02T19:22:10.750
> 
> 标签：debugging, flexbuilder, compilation, flash

我得到了这个项目，这个错误一直在发生，而且它现在不在我的桌子上修复它。我还有其他优先事项。这个错误对于项目的其他部分来说也不是什么大问题——但是每次当我在 Flex Builder 中启动调试播放器时抛出这个错误时，它都会立即关闭播放器。

是否有可能我可以（暂时）关闭这个在错误时关闭我的 flashplayer 的“动作”，这样我就可以加快我的工作流程。

这让我很紧张...

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T19:24:20.590

AFAIK，停止该错误的唯一方法是修复它，或使用 Flash 播放器的非调试版本。

出于好奇，您遇到的错误是什么？问题是否需要很长时间才能解决？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T19:30:44.930

“立即关闭播放器”是指调试器响应未捕获的异常吗？如果是这样，你不能把有问题的代码包装在一个 try/catch 块中，以防止调试器停止，然后再返回它，也许？

# .net - ASP.NET——如何在不过度设计的情况下有效地使用设计模式！

> ID：504517
> 
> 赞同：17
> 
> 时间：2009-02-02T19:23:11.777
> 
> 标签：.net, asp.net, oop, design-patterns

自从 ASP.NET 出现以来，我很感激人们对我一直在努力解决的困境的想法。

在经典的 ASP 中，代码层很少。ASP 页面包含 HTML 和脚本组合。COM 组件包含业务逻辑和[DAO](http://en.wikipedia.org/wiki/Data_access_object)基础设施。ASP 页面本身很乱，但一切都在一个地方。

ASP.NET 的代码隐藏整理了代码，这很好。这些控件允许我们在表示层上更加面向对象。这些东西很好。

这是我的问题。我参与的许多项目都是企业 Web 应用程序，但并不是那么复杂，比如 10 个左右的网页/用户界面、大量的数据库交互等。这些过去理解起来是小菜一碟。现在我经常会遇到 5 到 10 层代码来创建一个相当简单的网页。这些可能包括 ASP、代码隐藏、控制类、[DTO](http://en.wikipedia.org/wiki/Data_transfer_object)类、ORM 对象，然后是其他一些只是为了它而投入的。

除了访问数据库的 5-10 层之外，还有许多仅为存储普通数据而创建的自定义对象，而不是使用诸如集合之类的[POCO （普通旧 CLR 对象）。](http://en.wikipedia.org/wiki/Plain_Old_CLR_Object)要理解这些对象，通常必须追溯包括 3 级或更多级别的对象和接口的继承层次结构。

这里是关键：以前，我查看 1 个 ASP 页面并说 1 或 2 个小对象，一些 SQL 查询，这些都完成了工作并且维护和理解相当简单。

现在，对于同一个页面，实际上可能有 50 个或更多对象，分布在自定义命名空间中的数百个对象中。

我问你们，代码工匠们，这是进步吗？是不是有些人对他们的滑稽有趣的新设计图案玩具有点过火了？有快乐的媒介吗？ *有没有一种方法可以有效地使用设计模式，而不会创建太多对象，以至于它变得比旧的程序范式更糟糕的意大利面条代码？*

请分享你的想法。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-02T19:30:33.463

撇开组织需要这些抽象级别的可能性（不太可能，但确实会发生），开发人员（尤其是在非敏捷、公司/企业环境中）添加太多抽象层是很常见的。它发生在经典的 ASP 中，.NET 让它变得更容易。我们大多数从事这个行业的人都有一种使事情过于复杂的自然倾向，而克服这一点需要纪律和积极的头脑。

此外，许多平庸的开发人员错误地认为，最大化抽象层和模式使用会使他们成为更好的开发人员。

最后，许多平庸的开发人员被教导他们应该使用层、抽象和模式，但没有被教导得足够好，不知道如何、何时或为什么。所以他们进入一个项目时会想“好吧，我知道我应该在这里有一些层......”你可以想象会发生什么。

最终，最佳实践的“最佳实践”是**尽可能简单地编写代码，直到遇到**阻碍您前进的真正问题。很多时候，**您的工具箱**中应该有适合该任务的模式或最佳实践，就像您有合适的扳手扳手一样。最佳实践和模式是工具——你不会拿出锤子开始摆动，直到你有一个需要敲打的钉子。软件开发也是如此。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-02T19:40:44.423

有些人是[建筑宇航员](http://www.joelonsoftware.com/articles/fog0000000018.html)，他们会坚持认为这些层都是必要的，除非你包含它们，否则设计绝对是垃圾。

另一方面，人们将这一切抛在一边，只是将所有代码拼凑在一起：这很简单，对，那么为什么不在代码隐藏中将 SQL 查询直接填充到列表框控件中呢？

您已经发现了 astronaut 版本的问题，只是执行简单任务过于复杂。

第二种方法的问题在于，虽然它适用于小型应用程序，但这些相同的应用程序有发展成大型应用程序的趋势，然后一切都崩溃了。您花费大量时间一遍又一遍地修复相同的错误，因为相同的查询或代码段已根据需要被复制/粘贴，并稍作修改，并传播到各处。

当然，还有一个中间立场。取决于你问的是谁，具体的谎言在哪里会有所不同。但它就在那里。

建立一个健全的业务层是实现目标的好一步。这应该是呈现系统中对象的最简单视图的层，并且不包含面向公众的数据库相关内容（除了可能告诉业务层如何访问数据库的 Connection 对象）。这将您的所有逻辑整合到一个地方，因此项目的 ASP 部分只需将抽象的“User.LoadAll()”方法连接到显示用户列表的表。ASP 应用程序应该不知道它是从数据库、Web 服务读取还是只是一堆编造的东西……它只是与业务层对话。

在业务层下，您可以直接进行查询，您可以使用 ORM，您可以构建更深的数据访问层来做这些事情.. 好的是这个决定完全由业务层包含（您可以稍后更改它） ，如果需要，不影响业务层的公共API）。

现在处理用户的任何查询都包含在 User 对象中。如果您在加载权限的方式上有错误，可以在一个地方修复它。

我刚刚进行了如上所述的迁移（在代码隐藏中使用 SQL 的 ASP，到不同的表示 - 业务 - 数据源 (ORM) 层），这很棒。尽管它确实为获取实际信息增加了几层，但一旦业务方法起作用，其余代码就会起作用。修复错误很简单，并且可以在任何地方修复它。接近尾声时，很快就会出现这样的情况，当您需要获取用户可以运行的报告列表时，有人已经为此编写了一个业务方法（User.GetReports()），而在此之前，您可能永远不会找到它，如果它已经完成 - 如果你幸运的话，它被编写为一个函数，而不仅仅是内联代码。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-02T19:34:13.470

我曾从事过在相反方向上做得不好的项目（200+ MB 源代码树，没有设计模式）。相信我，这也不是正确的解决方案。代码变得不可维护，开发人员绊倒了旧代码，等等。

另一方面，回答您关于设计模式的问题：

不，这不是进步。是的，有些人过火了。可能有一个快乐的媒介，但我认为它需要世界上的设计模式专家冷静一点。

我尝试使我的解决方案尽可能简单。这可能涉及设计模式……也可能不涉及；真的没关系，只要能用，而且容易维护。重要的是……设计模式不是解决糟糕代码的灵丹妙药。仅仅因为一个人使用设计模式并不意味着一个人的代码写得很好。不幸的是，太多的开发人员被教导（或他们自己相信）：如果他们使用设计模式，他们的代码质量会更高；这不一定是真的（我认为甚至不是定期的）。

顺便说一句：如果您想要一个出色的过度设计示例，请查看 CruiseControl.NET 托盘应用程序的源代码。这是对设计模式失控的一个很好的演示（老实说，Thoughtworks 整体就是一个很好的演示）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-02T19:32:34.783

我认为您看到的大部分内容可能是正式的业务层和数据层代码。在这种情况下，代码应该遵循明确定义的模式，以便清楚地知道什么在哪里以及（更重要的是）为什么。如果不是这样，您就不是在查看具有代表性的 ASP.NET 代码。

与您关于易于遵循[Classic ASP](http://en.wikipedia.org/wiki/Active_Server_Pages)的论点相反，我发现任何大小的 Classic ASP 站点很快就会变成未记录的包含文件的迷宫，因此很难确定函数的实现位置或变量声明的位置。

主要的是 ASP.NET 在帮助开发人员安全地重用代码方面比经典 ASP 做得更好，所以当他们利用这一点时不要感到惊讶。

现在，这并不能真正解决您对分层设计过度的担忧。真的，我认为这取决于情况。如果您的网站是访问数据库的*唯一*系统并且它不是那么大，那么它可能是矫枉过正。但即使在这种情况下，大部分数据和业务层代码都可以由[ORM](http://en.wikipedia.org/wiki/Object-relational_mapping)解决方案编写，这是一件好事，因为此类代码通常没有错误，并且可以被推到修订系统的某个阴暗角落并被遗忘. 然后，当（不是“如果”）站点发展成为可以真正利用构建良好的数据层的东西时，该代码已经到位以支持它，并且生产或维护成本非常低。

另一方面，如果您的网站与企业报告软件或用于管理的 Windows 桌面应用程序共享对数据库的访问，或者多个小型应用程序与同一个数据库通信，那么所有这些“额外”代码可能都有用。编写数据和业务层代码的一个重要原因是，该代码可以在与数据库通信的每个不同系统之间共享，这样该代码就可以在一个地方实现。也许这是为一个小型网站编写的大量代码，但在这种情况下，它不是为该站点编写的。它是为站点和其他几个应用程序运行的环境编写的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-02T20:02:55.190

对我来说，问题源于关注了太多文章，而作者没有花时间解释解决方案的背景。

一个为中型企业编写商业应用程序的人被锁定在某些技术中，他构建应用程序的方式与一个为供应商工作的人将其软件销售给其他公司的人不同。

所以对于想要做“正确的事情”的没有经验的开发人员来说，我认为过度工程是一个容易掉入的陷阱。

还有其他人只是希望每个项目都“完美”。我不知道对那些家伙说什么。我从来没有足够的时间或预算来使任何项目“完美”。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-02T19:34:14.140

我认为在 Classic ASP 中使用我熟悉的设计模式会很困难，因此在这方面我们处于领先地位。

虽然我没有在 ASP.NET 中使用[MVC](http://www.asp.net/mvc/)实现，但我的理解是它解决了您的许多问题，因为它更加直接和简单。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-02T19:37:33.183

您提到的所有工具和技术的目的是在业务需求快速变化的世界中管理复杂性。“复杂性和快速变化的业务需求”是否代表了您的应用程序所在的世界？

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-02T19:56:11.350

我认为这是一个更高层次的一般原则的例子。

就像我们小学时用的剪刀一样，尖端圆润，边缘钝。你不能很好地切割，但你自己（或其他任何人）也不能很容易。

任何强大的东西都可以创造更大的利益和更大的潜力……否则。

值得称赞的是，微软在提供入门门槛低的工具方面做得非常好，因此任何老程序员都可以相对快速地完成一些有用的事情。但由于它们的简单性，有时它们不能很好地扩展，您需要升级到更复杂的工具集 - 但学习如何正确有效地使用新东西是值得的。所以你的问题是一个很好的问题，因为这是“首先理解它”过程的一部分。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-02T19:39:30.463

这是进步，也不是进步。我们使用的新工具的使用情况可能是这里的问题，因为有些可能过度构建而另一些可能构建不足，例如，从标记到数据库逻辑再到业务逻辑的所有内容都在代码中，只是为了将它们保持在一起。

在某些情况下，设计模式可以用作解决问题的好方法。例如，在以前的工作中，这些设备有一些必须支持的常用命令，因此我为每种类型的设备构建了一个适配器类和一个类，可以很好地解决问题。另一个帮助设计模式的例子是让外观模式隐藏外部系统如何运作的一些细节，以便有一个共同的内部功能列表来支持。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-02T21:40:26.600

感谢到目前为止的所有评论。再澄清一点，在经典的 ASP 中，我们使用的是 VB 组件，这自然限制了我们将它们过度复杂化的能力，从某种意义上说，这很好，因为它使它更简单。

我喜欢 Rex 的回复“最终，最佳实践的‘最佳实践’是尽可能简单地编写代码，直到遇到阻碍你前进的真正问题。”

这听起来与我听到的另一个相似，即“过早的优化是万恶之源”。</p>

在此之后，如果我们只是将所有总线逻辑放在代码隐藏中，然后在我们发现哪些代码真正被多个页面使用时将其移动到共享库中呢？例如，如果它是一页，您可以在代码隐藏中包含所有内容。如果有两个页面共享一个逻辑，则制作一个组件。如果两个组件使用 SQL Server，则创建一个新组件以简化 SQL 查询等。

我也喜欢 Dana 在构建自定义应用程序与单个应用程序方面的区别。如果有 1000 个其他人会使用它，那么拥有一个成熟的 API 是一回事。将相同的能量投入一次性应用程序可能是浪费时间。

“建筑宇航员”是过度工程倾向的一个很好的名词！

许多人表示有一个中间立场，我认为（希望）这就是我们都在寻找的！也就是说，C# 给了我们做[火箭科学](http://en.wiktionary.org/wiki/rocket_science)的能力，但是也许这个级别只需要 5% 的时间。我认为加剧这个问题的事实是，如今大多数面试官都喜欢你非常熟悉所有火箭科学......

我想提出的另一个相关问题是：仅使用 POCO（.NET 提供）对象在 ASP.NET 架构中存储数据怎么样。我已经看到一些架构为每种类型的数据交换创建一个新对象。仅仅创建一个集合对象（比如列表）并称它为“this data”、“thatdata”等不是更简单吗？

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-04T07:19:53.357

根据我的经验，完全不使用自定义数据库对象会更加敏捷。在较旧的 .NET 版本中，您可以传递 DataTable 对象。在 .NET 3.5 中，您可以使用 LINQ 免费获得强类型。

令人惊讶的是，一些开发人员花费 75% 的时间从数据库中检索数据。哪个 .NET 没有任何自定义代码就可以完美运行。使用标准库，您会发现您有更多的时间来解决业务问题。

# c# - WPF 中 ContextMenu 中的 CommandParameters

> ID：504533
> 
> 赞同：13
> 
> 时间：2009-02-02T19:29:22.390
> 
> 标签：c#, wpf, .net-3.5

我有一个场景，我有一个 WPF TreeView 控件，`HierarchicalDataTemplate`它的项目有一个。现在在里面`HierarchicalDataTemplate`，我有一个`Label`和`Label`一个`ContextMenu`带有一个菜单项的`Delete`。删除菜单项绑定到一个名为的命令，该命令`DeleteCommand`是已设置为的类的`DataType`一部分`HierarchicalDataTemplate`。

现在，我想传递ContextMenu 的菜单项`TreeView`中的控件，以便在删除当前选定项时处理 TreeViewItems 的选择。`CommandParameters``Delete``DeleteCommand`

但是，如果我将 绑定`CommandParameters`为`{Binding ElementName=TreeViewName}`或其他任何内容，它始终为 null ，除非绑定的元素是`DataContext`.

任何人都可以帮助我解决问题，因为我认为，我已经尝试了所有可能的东西，例如 RelativeSource 和 AncestorType 等，但它始终为空。对我来说，它看起来像是框架中的限制或错误。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-02T22:17:43.860

问题是 ContextMenu 位于其自己的可视化树的根部，因此任何 RelativeSource.FindAncestor 绑定都不会超过 ContextMenu。

一种解决方案是使用[PlacementTarget](http://msdn.microsoft.com/en-us/library/system.windows.controls.contextmenu.placementtarget.aspx)属性从标签设置两阶段绑定：

```
<Label Tag="{Binding RelativeSource={RelativeSource FindAncestor, AncestorType={
    x:Type TreeView}}}">
    <Label.ContextMenu>
        <ContextMenu>
            <MenuItem Header="Delete" Command="{x:Static local:Commands.DeleteCommand}"
                CommandParameter="{Binding PlacementTarget.Tag, RelativeSource={
                RelativeSource FindAncestor, AncestorType={x:Type ContextMenu}}}"/>
        </ContextMenu>
    </Label.ContextMenu>
</Label> 
```

然而，这很 hacky。您最好将 MenuItem 的[CommandTarget](http://msdn.microsoft.com/en-us/library/system.windows.input.icommandsource.commandtarget.aspx)属性设置为 ContextMenu 的 PlacementTarget 并在 TreeView 上使用命令处理程序。这意味着您不必传递 TreeView。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2015-08-12T14:34:03.407

```
<ContextMenu>
    <MenuItem Header="Edit Item"
                   Command="{Binding EditItemCommand, Mode=OneWay}"
                   CommandParameter="{Binding Path=UIElement.(views:DataGridView.SelectedItems), RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}" />
<ContextMenu> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-05-16T03:56:36.060

```
<MenuItem Header="..." 
          Command="{Binding Path=...}" 
          CommandParameter="{Binding Path=PlacementTarget, RelativeSource={RelativeSource Mode=FindAncestor, AncestorLevel=1, AncestorType={x:Type ContextMenu}}}">
</MenuItem> 
```

ContextMenu.PlacementTarget，是承载菜单项的标签。从 Lavel 可以访问其父 Treeview。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T19:36:15.010

看看[WPF CommandParameter Binding Problem](https://stackoverflow.com/questions/257396/wpf-commandparameter-binding-problem)。也许它可以提供一些关于正在发生的事情的指示。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-01-06T16:56:08.273

对于 DataGrid 中的每个元素

```
<ContextMenu>
    <MenuItem Header="Edit Item"
                   Command="{Binding EditItemCommand, Mode=OneWay}"
                   CommandParameter="{Binding Path=PlacementTarget.SelectedItem, RelativeSource={RelativeSource AncestorType={x:Type ContextMenu}}}" />
<ContextMenu> 
```

# mysql - 存储大量文本（到数据库还是作为文件？）的最佳实践是什么，以及压缩它呢？

> ID：504544
> 
> 赞同：5
> 
> 时间：2009-02-02T19:33:41.117
> 
> 标签：mysql, database, storage, blob, text-compression

我正在构建一个网络应用程序来处理用户和客户之间的内部电子邮件和其他常见的中小型文本块。存储这些数据的最佳方法是什么？在数据库（MySQL）中还是作为数千个单独的文件？压缩它（PHP 的 gzcompress() 或 MySQL 的压缩特性）怎么样？

这将不是一个公共应用程序，因此用户负载将是最小的（一次少于 20 个用户）。然而，应用程序中每天都会有大量的通信来回进行，所以我预计随着时间的推移数据量会增长得相当大（这就是我想压缩它的原因）。

我想将数据保存在数据库中以便于访问和移植，但是我在这里看到的一些关于图像的线程建议使用文件存储。你怎么看？

谢谢你，赛斯

编辑澄清：我不需要对文本进行任何形式的搜索，这就是为什么我倾向于压缩它以节省空间。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T19:40:40.743

对于已经采用特定格式的图像和文档（excel、word 文档、pdf 文件等），我更喜欢文件存储。但对于原始文本，我可能更愿意使用数据库。跨机器复制以进行故障转移更容易，您可以对文本进行子字符串搜索，虽然我不知道用于压缩它的特定算法，但我认为数据库会是更好的方法。但前提是您已经只有文本并且它只是文本。我更喜欢使用文件存储的任何其他格式的文档。

除非我遗漏了什么，否则我会使用 CLOB 而不是 BLOB，如果它只是文本的话。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T21:35:28.093

将文件保存在数据库中的主要原因之一是使其与您存储的其余数据保持一致。使用预定义的数据集进行备份、（重新）部署等将更容易。此外，更容易保证事务的完整性。

将文本存储为文件的好处之一可能是使用网络服务器更容易为它们提供服务，如果这是使用文件的唯一剩余好处，您可以考虑在网络服务器上缓存文件——这将为您提供很多数据库的简单备份和事务，但同时允许一些 http 请求的加速。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T19:50:01.723

我会选择使用数据库。您描述了要存储大量消息的场景。您没有提供有关系统的太多信息，但我猜您可能希望对消息进行排序、分组和应用其他几个属性。将消息及其属性保存在数据库中而不是使用文件存储会更容易并且可能更快。

在压缩方面，我不知道哪种方法最有效。您可能应该在选择之前尝试两者。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-03T08:12:54.173

我想知道这个“中等块”有多大。如果文本只是写入消息（因此小于 10 KB），那么压缩会使它们变得更小，并且不会对数据库增长产生太大影响。它使开发和维护也变得更加容易，让所有东西都可以通过单一查询获得，而不必单独获取文件内容。

# wpf - 如何在我的 wpf 应用程序中实现 ajax 样式的加载面板？

> ID：504546
> 
> 赞同：2
> 
> 时间：2009-02-02T19:34:01.770
> 
> 标签：wpf, panel

我正在调用 wcf 服务，所以我想显示某种类型的微调器，以便用户可以看到正在发生的操作。我想知道有人有一些例子可以看。

编辑：这就是我要找的： [WPF 中的 Spinning Progress Control](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/0875ebf8-bb77-45ea-a929-d40743a3bf03/)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T19:44:18.787

您可能正在寻找 PriorityBinding。-- 您可以绑定到旋转动画，然后在返回后绑定到实际数据。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T20:06:34.793

您是否正在为您的通话寻找[异步模式？](http://msdn.microsoft.com/en-us/library/ms730059.aspx)

1.  启动 WPF 应用程序的 WCF
2.  显示动画
3.  等待 WCF 调用返回
4.  隐藏动画

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-07-21T18:54:37.830

我编写了这个[用户控件](http://huydinhpham.blogspot.com/2011/07/wpf-loading-panel.html)，它可能会有所帮助，它会显示带有旋转进度条的消息，以显示它当前正在加载某些内容。

```
 <ctr:LoadingPanel x:Name="loadingPanel"
                    IsLoading="{Binding PanelLoading}"
                    Message="{Binding PanelMainMessage}"
                    SubMessage="{Binding PanelSubMessage}" 
                    ClosePanelCommand="{Binding PanelCloseCommand}" /> 
```

它有几个可以绑定的基本属性。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-23T15:25:25.340

这是一个较老的问题，但是对于这种问题，我一直在使用 Extended WPF Toolkit 中的 BusyIndi​​cator 类。它提供了一种简洁的方式来使用动态视觉指示器覆盖您的控件，您可以根据需要进行扩展。这是包含更多详细信息和一些屏幕截图的链接：

[CodePlex 上的 BusyIndi​​cator 文档](http://wpftoolkit.codeplex.com/wikipage?title=BusyIndicator&referringTitle=Home)

...并且该控件的作者还提供[了一个很好的关于如何使用它的](http://elegantcode.com/2011/10/07/extended-wpf-toolkitusing-the-busyindicator/)文章。

# c# - 更新数据绑定 ComboBox

> ID：504551
> 
> 赞同：7
> 
> 时间：2009-02-02T19:35:00.067
> 
> 标签：c#, .net, combobox, refresh

我遇到了与此几乎相同的问题：

[C# 更新绑定到通用列表的组合框](https://stackoverflow.com/questions/433281/c-update-combobox-bound-to-generic-list)

但是，我正在尝试更改显示的字符串；不添加、删除或排序。我已经尝试过引用问题中提供的 BindingList 解决方案，但没有帮助。我可以看到组合框的 DataSource 属性在我编辑项目时已正确更新，但组合框中显示的内容不是 DataSource 属性中的内容。

我的代码如下所示：

```
mSearchComboData = new List<SearchData>();
mSearchComboData.Add(new SearchData("", StringTable.PatientID));
mSearchComboData.Add(new SearchData("", StringTable.LastName));
mSearchComboData.Add(new SearchData("", StringTable.LastPhysician));
mSearchComboData.Add(new SearchData("", StringTable.LastExamDate));

mBindingList = new BindingList<SearchData>(mSearchComboData);

SearchComboBox.Items.Clear();
SearchComboBox.DataSource = mBindingList;
SearchComboBox.ValueMember = "Value";
SearchComboBox.DisplayMember = "Display";

... 
```

当我尝试更新内容时，我会执行以下操作：

```
int idx = SearchComboBox.SelectedIndex;
mBindingList[idx].Display = value;
SearchComboBox.Refresh(); 
```

编辑：：

RefreshItems 似乎是一个私有方法。我刚刚收到错误消息：

“'System.Windows.Forms.ListControl.RefreshItems()' 由于其保护级别而无法访问”

ResetBindings 无效。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-02T20:23:29.627

如果您要更改整个对象，即您的整个 SearchData 对象，则绑定列表将知道此更改，因此正确的事件将在内部被触发，并且组合框将更新。但是，由于您只更新一个属性，绑定列表不知道发生了什么变化。

您需要做的是让您的 SearchData 类实现 INotifyPropertyChanged。这是我写的一个快速示例来演示：

```
public class Dude : INotifyPropertyChanged
    {
        private string name;
        private int age;

        public int Age
        {
            get { return this.Age; }
            set
            {
                this.age = value;
                if (this.PropertyChanged != null)
                {
                    this.PropertyChanged(this, new PropertyChangedEventArgs("Age"));
                }
            }
        }
        public string Name
        {
            get
            {
                return this.name;
            }

            set
            {
                this.name = value;
                if (this.PropertyChanged != null)
                {
                    this.PropertyChanged(this, new PropertyChangedEventArgs("Name"));
                }
            }
        }

        public event PropertyChangedEventHandler PropertyChanged;

    } 
```

这是一些要测试的代码：

```
 private void button1_Click(object sender, EventArgs e)
        {
            //Populate the list and binding list with some random data  
            List<Dude> dudes = new List<Dude>();
            dudes.Add(new Dude { Name = "Alex", Age = 27 });
            dudes.Add(new Dude { Name = "Mike", Age = 37 });
            dudes.Add(new Dude { Name = "Bob", Age = 21 });
            dudes.Add(new Dude { Name = "Joe", Age = 22 });

            this.bindingList = new BindingList<Dude>(dudes);
            this.comboBox1.DataSource = bindingList;
            this.comboBox1.DisplayMember = "Name";
            this.comboBox1.ValueMember = "Age";

        }

    private void button3_Click(object sender, EventArgs e)
    {
        //change selected index to some random garbage
        this.bindingList[this.comboBox1.SelectedIndex].Name = "Whatever";
    } 
```

由于我的类现在实现了 INotifyPropertyChanged，因此绑定列表会在发生更改时得到“通知”，因此所有这些都将起作用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T19:45:06.087

代替`SearchComboBox.Refresh();`

尝试`SearchComboBox.RefreshItems();`

或者`SearchComboBox.ResetBindings();`

我认为您确实需要后者。

[您可以在此处](http://msdn.microsoft.com/en-us/library/system.windows.forms.combobox_methods(VS.80).aspx)访问其成员的文档。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-03-09T13:02:02.960

这是一个旧帖子，但这可能很有用。

我刚刚查看了同样的问题，发现如果您调用对象，并且更改了 Items 位置，它会在内部`ResetItem`为您引发通知事件，从而导致列表更新。`BindingList``Itemchanged`

```
int idx = SearchComboBox.SelectedIndex;
mBindingList[idx].Display = value;

mBindingList.ResetItem(idx); //raise Item changed event to update the list display 
```

# ruby-on-rails - Rails ORM 是否限制了执行聚合的能力？

> ID：504553
> 
> 赞同：3
> 
> 时间：2009-02-02T19:35:09.303
> 
> 标签：ruby-on-rails, ruby, orm, aggregate

我担心 Rails 是否可以处理金融应用程序所需的复杂聚合类型，尤其是 ORM 是否可以有效地处理这些。在我正在考虑使用它的财务应用程序中，需要对以各种方式汇总的详细财务数据进行大量报告。如果没有 Rails ORM 的支持，我需要直接编写 SQL。但我担心一旦我开始这样做，Rails 的其他部分可能无法正常工作，因此我可能最终主要使用 Rails 作为其路由，而很少使用其他部分。这是一个有效的担忧还是我不必要地担心？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T19:48:30.947

这个问题说明了一个被广泛讨论的 RoR 问题 - 它与困难的数据库映射要求相对不适。（这实际上是 ActiveRecord 模式的困难所在。）它喜欢将复杂的查询分解为更适合 AR 模型的更简单的查询，您可能已经知道这是对表的相对较轻的抽象，具有基于例如一个的简单关系对多类型断言。

所以我想说，如果你自己接受 SQL 职责，然后让 RoR 处理非持久性部分，你会更舒服。

这不仅限于 RoR。大多数对象关系建模工具都提出了相同的问题。

（脚注：我几乎使用了 ORM 的缩写，但还有另一个 ORM 恰好很好地专门处理了这些类型的概念数据库设计和抽象问题：对象角色建模。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T22:47:03.597

ActiveRecord 的局限性是我在科学环境中使用 Rails 时遇到困难的原因之一。您可能想查看替代的 Ruby ORM，它们可以更轻松地使用旧数据库：

*   [续集](http://sequel.rubyforge.org "续集")
*   [数据映射器](http://www.datamapper.org "数据映射器")

最终，尽管 ORM 的设计使您远离 SQL，但它们可能都不适合。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T20:30:03.793

Rails 可能不是此应用程序的合适平台。或者您可以考虑对数据库中的视图使用 ActiveRecord。在视图中聚合数据，然后使用“rails_sql_views”gem，您可以将它们视为普通模型。（我从来没有使用过这个，所以我不知道它在实践中的效果如何。）

链接：[rails_sql_views](http://activewarehouse.rubyforge.org/rails_sql_views/)

**编辑：**在进一步检查中，您甚至可能不需要任何宝石或任何其他特殊设置来简单地查询视图。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T03:47:14.537

我喜欢活动记录的原因是它可以让您深入了解抽象。我还没有遇到过 AR 无法处理的情况。我敢肯定可能会有一些非常深奥的例子，但更好的问题是给出一个你想要做的查询类型的例子，让别人告诉你如何在 AR 中做到这一点。

# c# - 在 WinCE 中用颜色绘制数据网格行

> ID：504558
> 
> 赞同：0
> 
> 时间：2009-02-02T19:36:35.277
> 
> 标签：c#, compact-framework, windows-ce

如何用红色字段“age”= 30 的值绘制数据网格中的所有行？

我在 WinCE 工作。

*谢谢你的帮助！*

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-29T17:07:22.470

尝试类似的东西。我设置

`Datagrid1.Datasource = Datatable1.DefaultView`

其中 Datatable1 是一个包含名为“Age”的列的数据表

对不起，在VB中

私有子paintColors()

```
 Dim vI As Int64 
    DataGrid1.SelectionBackColor = Color.OrangeRed
    Dim vI As Int64 = 0
    For vI = 0 To Datatable1.DefaultView.Count - 1

        If Datatable1.DefaultView.Item(vI)("Age") = 30 Then
            DataGrid1.Select(vI)
        Else
            DataGrid1.UnSelect(vI)
        End If

    Next 
```

结束子

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T19:03:56.980

我建议回到链接到的示例 ctacke 并专门查看：

```
DataGridCustomColumnBase.DrawBackground 
```

在那里，它支持以特定颜色为替代行着色一行。一旦你完全理解了这一点**，****你就可以** **随时随地**为它们涂上你想要的任何颜色。

 ****示例代码非常棒，您可以使用完整的框架，然后将您的知识（因为这家伙使他的代码与 CF <-> FF 交叉兼容）移植到 CF。重新阅读并理解该示例，因为它是一个非常好的示例。

# java - 是否可以让 MouseMotionListener 监听所有系统鼠标运动事件？

> ID：504559
> 
> 赞同：5
> 
> 时间：2009-02-02T19:36:36.257
> 
> 标签：java, swing, awt

我的样板听众：

```
class MyMouseMotionListener implements MouseMotionListener {
public void mouseDragged(MouseEvent e) {
    System.out.println("Dragged...");
}

public void mouseMoved(MouseEvent e) {
    System.out.println("Moved...");
}} 
```

很简单，但是为了监听系统范围的事件，我应该添加什么？我一直在研究诸如 GraphicsDevice 和 AccessibleContext 子类之类的东西——它们不直接提供 MouseMotionListeners 的添加，但我希望它们能给我一些关于如何实现它的想法。

**编辑：**这根本不是基于事件的，但我发现了这个：

```
MouseInfo.getPointerInfo().getLocation() 
```

实际上会在我的应用程序上下文之外返回鼠标位置，即使应用程序本身没有焦点也是如此。如果事件的值发生变化，有什么方法可以观察并调度事件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T20:12:08.417

您可以使用 订阅 Java 容器层次结构中的所有鼠标事件[`Toolkit.addAWTEventListener(AWTEventListener listener, long eventMask)`](http://docs.oracle.com/javase/8/docs/api/java/awt/Toolkit.html#addAWTEventListener-java.awt.event.AWTEventListener-long-)。该`eventMask`参数确定侦听器将接收哪些事件。

所以你的代码看起来像：

`Toolkit.getDefaultToolkit().addAWTEventListener(new MyMouseMotionListener(), [AWTEvent.MOUSE_MOTION_EVENT_MASK](http://docs.oracle.com/javase/8/docs/api/java/awt/AWTEvent.html#MOUSE_MOTION_EVENT_MASK));`

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T19:43:15.760

更新：您可以轮询 MouseInfo 的位置，但您永远不会获得按钮状态。您将需要使用本机代码来获取按钮状态。

我认为没有任何方法可以不使用本机代码来监听应用程序容器层次结构之外的鼠标光标。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-07-20T18:01:03.583

我通过使用上述根据请求获取鼠标位置的能力解决了同样的问题。然后我启动了一个新线程，在其余程序执行期间不断地执行此操作。

> > MouseInfo.getPointerInfo().getLocation()

我也不得不让主类扩展线程

```
public class MouseMotion extends Thread { 
```

这要求您创建一个名为 run 的函数。在您的 void 函数中，只需创建一个无限循环

```
public void run() {
int n=10;
for (int i=0;i<n; n++) //horrible infinite loop
{
    Thread.sleep(100); //this will slow the capture rate to 0.1 seconds
    PointerInfo a = MouseInfo.getPointerInfo();
    Point p = new Point (0,0);
    a = MouseInfo.getPointerInfo();
    p = a.getLocation();
    int x = (int)p.getX(); //getX and getY return doubles so typecast
    int y = (int)p.getY();
    System.out.println(""+x+"   "+y);   //to see it grabing locations not needed
}
} 
```

现在剩下的就是在您开始观察鼠标移动时调用线程。我在我的 main 之后立即启动线程

```
public static main (String[] args) throws Exception {
Thread thread = new MouseMotion();
thread.start();
...} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T20:45:19.507

如果您想监听/捕获系统上的所有鼠标事件（例如，不仅仅是您的应用程序窗口），您将需要一个[mouse hook](http://www.codeproject.com/KB/DLL/hooks.aspx?fid=2061&df=90&mpp=25&noise=3&sort=Position&view=Quick&fr=126&select=240257)。

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2012-12-17T16:39:29.127

为此有几个库，我经常将其中一个用于应用程序。

JNativeHook 具有处理本地鼠标和键盘事件的非凡能力。（谷歌它我懒得去subversion。虽然你可以下载这个库，它就像你两次调用库后的普通鼠标事件一样工作。

我希望当我在谷歌上冲浪时，有人会在这样的线程上发布这个库。我一直在使用 stackoverflow，但我不是注册会员，因为我从不公开寻求帮助。

# c# - 缓存 Lucene.net 搜索结果

> ID：504565
> 
> 赞同：6
> 
> 时间：2009-02-02T19:38:27.753
> 
> 标签：c#, performance, caching, lucene.net

我已经使用[Lucene.net](http://incubator.apache.org/lucene.net/)在几个小型网站上实现了搜索功能（数据库内容和上传的文档），没有任何问题。现在我有一个网站，我正在索引 5000 多个文档（主要是 PDF）并且查询变得有点慢。

我假设加速它的最佳方法是实现某种缓存。谁能给我关于从哪里开始的任何指示/示例？如果您除了缓存还有其他建议（例如，我应该使用多个索引吗？）我也想听听这些建议。

编辑：

导致查询缓慢的愚蠢用户错误。我一次为整个结果集创建了亮点，而不仅仅是我正在显示的“页面”。哎呀。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-03T00:24:43.383

我将在这里做一个很大的假设，并假设您在查询索引的调用之间没有挂在索引搜索器上。

如果这是真的，那么您绝对应该为您的索引的所有查询共享索引搜索器。随着索引变得更大（并且它实际上不必变得非常大才能成为一个因素），重建索引搜索器将变得越来越多的开销。要使其正常工作，您需要同步对查询解析器类的访问（它不是线程安全的）。

顺便说一句，Java 文档（我发现）同样适用于 .net 版本。

有关您的问题的更多信息，请参见此处： [http ://wiki.apache.org/lucene-java/ImproveSearchingSpeed](http://wiki.apache.org/lucene-java/ImproveSearchingSpeed)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T22:17:06.030

Lucene 使用自己的内部“缓存”机制使索引检索成为一种快速操作。不过，我不认为缓存是您的问题。

5000 个索引的文档在大小上听起来微不足道，但这在很大程度上取决于您构建索引的方式、索引/存储的内容、查询的方式（操作上）、文档大小等。

请尽可能多地填写有关您的索引的信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T23:46:42.083

首先，Lucene 本身支持内存版本的目录：

```
Lucene.Net.Store.RAMDirectory 
```

你可以像这样使用它：

```
RAMDirectory idx = new RAMDirectory();

// Make an writer to create the index
IndexWriter writer =
    new IndexWriter(idx, new StandardAnalyzer(), true); 
```

如果这对您有用，但它使用了太多 ram，请编写一个包装器并将其公开为接口或 web 服务。或者，如果您只是想缓存您正在查询的内容以控制实体何时从缓存中退出，您可以围绕 Lucene 编写一个包装器，该包装器显然会根据关键字为您缓存最常见的结果。

我更喜欢前面提到的。使用 RAMDirectory 创建一个围绕 Lucene 存储的 Web 服务或服务项目。这样，如果索引很大，您可以将 Web 服务卸载到具有大量内存的另一台服务器上 - 并获得近乎即时的结果。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-01T19:22:12.550

一定要优化你的索引。

此外，这是实现缓存的一种快速/简单/有效的方法： HttpRuntime.Cache.Add(...);

您可以使用任何类型的项目/库中的 ASP.Net 缓存。

# jakarta-ee - OC4J EAR 文件格式 - 支持 jar 文件

> ID：504575
> 
> 赞同：0
> 
> 时间：2009-02-02T19:40:05.940
> 
> 标签：jakarta-ee, oc4j, ear

我以前曾使用过 JBoss 和 WebLogic，但这是我使用 OC4J 的第一份工作。我们使用的是 10.1.2.0.2 版本，但使用的是 JRE 1.4.2。我正在创建一个 EAR 文件，其中包含一个 WAR 文件和一个 EJB 文件。我们使用 Spring/Hibernate 来访问数据库，而不是实体 bean，因此 EJB 是会话 bean。问题是把 Spring 和 Hibernate jar 文件放在哪里。我尝试将它们放在 META-INF/lib 下的 ejb-jar 文件以及 EAR 文件的 lib 目录中，但无济于事。我认为那是因为我们没有运行 JRE 5。我见过的最接近的在线帮助[是](http://download.oracle.com/docs/cd/B14099_19/web.1012/b14017/deploy.htm#sthref441).

他们去哪里？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T20:04:46.577

知道了。我需要放置在 ear/META-INF 目录中的 orion-application.xml 文件。我将所有支持 jar 文件放在 ear/lib 目录中。

```
<orion-application>
  <library path="lib"/>
</orion-application> 
```

# c# - 网络上的 C# 应用程序

> ID：504585
> 
> 赞同：3
> 
> 时间：2009-02-02T19:42:29.943
> 
> 标签：c#, deployment, networking

我遇到过一些情况，我被要求将应用程序（C#、.Net 2.0）部署到服务器，而用户需要通过网络测试应用程序。我发现以下内容可以正常工作，除了警告告诉您“嘿，您在网络上运行它，您确定要这样做吗？”：

```
%systemroot%\Microsoft.NET\Framework\v2.0.50727\caspol -m -cg 1.2 -url \\<Path> FullTrust 
```

有没有比上述方法更好的集中应用程序的方法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-02T19:44:25.743

尝试使用[ClickOnce](http://en.wikipedia.org/wiki/ClickOnce)部署。我们将它用于我们所有网络部署的应用程序。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-02T19:51:00.160

授予 FullTrust 的问题在于，[它真的意味着*完全*信任](http://blogs.msdn.com/eugene_bobukh/archive/2005/05/06/415217.aspx)。如果您的应用程序具有任何类型的身份/安全控制，授予完全信任将绕过所有这些。

我想否则，您将您的机器“暴露”给从另一台机器运行的文件，因此它们可能会造成损坏，但这并不比在远程机器上运行的任何其他本机 win32 可执行文件差，所以恕我直言，这没什么大不了的.

我建议最好的解决方案是简单地将应用程序安装在用户的机器上。您可以使用 ClickOnce 之类的工具让他们轻松轻松地完成此操作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T19:45:58.563

最好的解决方案可能是签署您的程序集，并将完全信任策略推送到这些程序集的所有客户端计算机。然后，只需通过 UNC 路径从网络共享运行它们，就好像它们是本地的一样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T19:45:27.393

您可能会查看[ClickOnce](http://msdn.microsoft.com/en-us/library/t71a733d.aspx)部署。通常比在共享上运行更好的部署方式。

# javascript - jQuery：“this.cloneNode 不是函数”当包含在带有原型的页面中时

> ID：504594
> 
> 赞同：0
> 
> 时间：2009-02-02T19:44:37.163
> 
> 标签：javascript, jquery, jquery-ui, prototypejs

我正在尝试在书签中使用 jQuery，这意味着我无法控制将插入 JavaScript 的页面。根据我对[noConflict](http://docs.jquery.com/Core/jQuery.noConflict)的阅读，它要求首先插入 jQuery。在小书签的情况下，情况正好相反。

那么 - 有人对这是否可能有任何建议吗？我发现它在使用prototype.js 的页面上除外。在那些页面上，当我尝试使用 jQuery UI 库时，我在 jQuery 的内部得到错误“this.cloneNode is not a function”，大概是因为原型中的某些东西正在处理它。

任何帮助/建议将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-03T19:50:07.947

noConflict 必须在包含 jQuery 之后调用，并且在包含其他一些库之前。所以最好最后包含 jQuery，然后调用 noConflict —— 然后它应该将 $ 变量返回到包含 jQuery 之前的任何值。

这是一种痛苦。您的小书签需要：

```
if(!jQuery) {
    include_jQuery();
    var $ = jQuery.noConflict();
} else {
    var $ = jQuery;
}
// do things with $ 
```

如果它已经有jQuery，以避免破坏页面。

# asp.net - ashx 处理程序发布问题

> ID：504595
> 
> 赞同：1
> 
> 时间：2009-02-02T19:44:47.537
> 
> 标签：asp.net, session, post, ashx

我在 myCustom.ashx 处理程序周围得到了一些令人困惑的结果。

如果我通过浏览器访问处理程序：

```
Token.Instance.User.UserId = 162 // which is correct 
```

如果我发布到处理程序：

```
Token.Instance.User.UserId = 163 // a new user is generated. 
```

好像当我发布它时会创建一个新会话。

额外信息：

```
public class myCustom: IHttpHandler, IReadOnlySessionState

<sessionState mode="InProc" timeout="30" cookieName="xxx"/> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T19:52:12.497

您是否使用工具来发帖？它有不同的 UserAgent 字符串吗？这可能就是您获得与浏览器中不同的会话/用户 ID 的原因。

# c# - 在 MenuStrip 中添加水平分隔符

> ID：504598
> 
> 赞同：25
> 
> 时间：2009-02-02T19:45:15.507
> 
> 标签：c#, .net-3.5, menustrip

我似乎找不到在 MenuStrip 中添加水平分隔符的任何方法。Visual Studio 抱怨无法将 ToolStropSeparator 添加到 MenuStrip。

知道我该怎么做吗？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2010-12-03T10:40:17.427

在要由分隔符分隔的两个字段之间的空格中，键入：

```
- 
```

然后回车（在设计器中）

如果您需要以编程方式执行此操作，您可以使用相同的技巧：

```
contextMenu1.MenuItems.Add(new MenuItem("-")); 
```

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-02-02T19:54:03.463

我能够运行这样的代码：

```
this.menuMain.Items.Add(new ToolStripSeparator()); 
```

没有任何麻烦......你得到什么样的错误？

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-11-26T03:41:38.637

您可以右键单击菜单条，然后单击“插入”->“分隔符”。就这样。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-06-24T10:24:59.123

步骤： 1.右键contextmenuStrip items -> Insert -> Separator

或者

1.  a）单击（为 ContextMenuStrip 键入文本框）要放置水平分隔符的位置，然后输入“-”（减号）b）输入希望这会对您有用:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-01-10T14:10:05.770

我喜欢用 - 而不是分隔符来做我的。所以说我想做一个水平分隔符，我会做大约 30 个来创建一条长度为 30 的水平虚线。然后我会将其启用属性设置为 false，这样就不能像垂直一样单击它。就做| 然后您的每个项目的项目，您会注意到它将创建与每个项目匹配的垂直线。[注意] 由于每一项之间的间距，垂直线将被点。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-08-05T09:52:23.560

就这么简单，

右键单击上下文菜单条图标。然后选择插入，然后选择分隔符|

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-05-21T02:21:52.670

出于某种原因，在 VS 2019 (16.8.4) 中，上述与设计师相关的答案似乎都不适合我。缺少插入分隔符选项，并且在文本中使用“-”似乎不起作用。

我可以添加分隔符的唯一方法是在设计器中执行以下操作：

顶部菜单条上的人民币 - >选择`Edit DropDownItems`

这会弹出一个对话框，允许您添加分隔符（以及任何其他菜单项）。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-06-16T20:08:52.590

1.  将 MenuStrip 添加到表单
2.  单击 MenuStrip 并单击“属性”窗口中的项目“...”
3.  在“选择项目并添加到下面的列表”部分中的打开窗口中单击添加
    示例为 3 然后选择例如 toolStripMenuItem1 并单击 DropDownItems “...”然后在新打开的窗口部分中“选择项目并添加到下面的列表”选择分隔符 | 并添加它。好锁

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2016-11-03T09:54:13.287

菜单条项目没有分隔符。

然而;

您可以选择您想要的项目之间的空间，并设置左边距或右边距值。这同样有效。

# nhibernate - 如何使用 NHibernate 查询 SQL 2005 XML 字段？

> ID：504605
> 
> 赞同：2
> 
> 时间：2009-02-02T19:47:02.617
> 
> 标签：nhibernate, hibernate, nhibernate-mapping

我的 Microsoft SQL Server 2005 数据库包含一个具有 XML 字段的表，该字段具有一些重要的元数据，在普通 SQL 下，我可以运行以下查询并获取没有设置 UPC 代码的项目列表......不幸的是我我很难使用 NHibernate 的 Criteria API 重新创建此查询：

```
SELECT [Id],[meta].value( '(/meta/upc)[1]', 'nvarchar(max)') as upc
FROM 
 [mediaContent].[dbo].[audioVideo]
WHERE
 [meta].value( '(/meta/upc)[1]', 'nvarchar(max)') != '' 
```

有什么建议么？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-03T23:14:32.700

尽管 xml 字段可以[非常](http://www.hibernate.org/368.html)[无缝地](http://ayende.com/Blog/archive/2006/05/30/NHibernateAndXMLColumnTypes.aspx)[映射](http://joeydotnet.com/blog/archive/2009/01/14/nhibernate--xml-columns.aspx) ，但我认为它们不能像使用 HQL 或 Criteria 那样进行查询。

在这种情况下，我会坚持使用 SQL。

# perl - 如何在 Windows 的后台运行 Perl 脚本？

> ID：504612
> 
> 赞同：2
> 
> 时间：2009-02-02T19:48:41.570
> 
> 标签：perl, winapi, background, process

我有一个 Perl 脚本，当它的工作完成时会弹出一个消息框。我怎样才能在后台运行它？

我查看了[Proc::Background](http://search.cpan.org/dist/Proc-Background)，但这需要启动一个特定的命令。如果可能的话，我希望我的代码在后台运行而不产生新进程。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-02T20:30:14.950

一种方法是使用`wperl`Windows GUI 版本而不是`perl`.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T22:14:03.930

考虑将其作为服务运行。[这里](http://www.perlmonks.org/index.pl?node_id=230377)有一个 Perl 脚本 ，它将实际为您安装它。

或者，您也可以尝试[ExeService](https://slion.net/view/Dev/ExeService)，该程序允许您将可执行文件、脚本和命令作为 Windows 服务运行。

有关什么是 Windows 服务的更多信息，请参阅 *[Windows 服务](http://en.wikipedia.org/wiki/Windows_service)*（维基百科）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T22:10:59.957

如果您有 Perl 5.x，请使用[`fork`](http://perldoc.perl.org/perlfork.html). Fork 是一个内置关键字，并且在所有平台上都受支持。

这是一些示例代码：

*[Re: Windows 中的 Perl 后台进程](http://www.perlmonks.org/?node_id=663272)*

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-10T12:57:01.723

```
use Win32::GUI; 
BEGIN {
    Win32::GUI::Hide(scalar(Win32::GUI::GetPerlWindow()))
}; 
```

这将使您的脚本在后台运行

# css - 如何使用 CSS 和 HTML 模拟分页符？

> ID：504614
> 
> 赞同：6
> 
> 时间：2009-02-02T19:49:37.700
> 
> 标签：css

我正在尝试生成一个 CSS 类来帮助我定义“分页符”。

我知道如果我使用`@media:print .MyDiv{ width:100%; height:100%; }`，然后我可以将 a 的类设置`div`为`MyDiv`，它将尽可能地打印 1 页。

这很好，但是我遇到了一个我不知道如何处理的新项目，我希望可以做类似的事情。我需要创建一个`div`将自己延伸到“页面末尾”的空白。

就像是：

```
<style type="text/css">
@media print .PageBreak { 
    width: 100%; 
    height: *; /* space left on current page */ 
}
@media screen .PageBreak {
    border-bottom: 1px solid black;
}
</style>

<!-- ... -->

<div>This should appear on the first page.</div>

<div class="PageBreak"><!--
    This DIV should stretch itself out so that the next piece
    of content appears on the next page (only when printing).
--></div>

<div>This should appear on the second page.</div> 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-02T19:52:11.110

这是打印的，对吧？

你不能只用这个吗？

```
<p style="page-break-before: always"></p> 
```

还有一些其他的[分页符](http://www.w3schools.com/cssref/pr_print_pagebb.asp)选项也值得了解。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T20:58:49.557

如果有人对我使用的解决方案感兴趣：

```
<style type="text/css">
@media print {
    .PageBreak {
        page-break-before: always;
    }
}
@media screen { 
    .PageBreak { 
        border-bottom: 1px dashed black; 
        width: 100%;
        margin-bottom: 12px; 
    }
}
</style> 
```

很简单。谢谢马克和[马克](https://stackoverflow.com/users/305/mark-biek)。[_](https://stackoverflow.com/users/50866/mark-davidson)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T19:52:57.177

对不起，如果我遗漏了一些东西，但是有什么原因你不能在 css 中使用默认的分页符。

[使用 CSS 指定用于打印的分页符](http://www.javascriptkit.com/dhtmltutors/pagebreak.shtml)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-04-10T13:38:25.543

如果您的 html 作为附件，并且用户正在使用 gmail 预览文件，则 gmail 会删除任何具有 page-break-after 属性规则的 css 规则。

# php - 如何比较两个数组并列出 PHP 中的差异？

> ID：504616
> 
> 赞同：3
> 
> 时间：2009-02-02T19:50:20.380
> 
> 标签：php, arrays

我正在构建一个表单来执行以下操作：

*   打印用户和权限表，从 MySQL 中提取。用户拥有的每个权限都是一个复选框，而他们缺少的每个权限都是一个未选中的框。
*   允许管理员选中和取消选中复选框以授予或删除权限。
*   提交表单后，仅显示将更改权限的用户的确认页面，突出显示特定更改。
*   确认更改后，相应地修改数据库。

为此，我创建了两组用户权限：一组根据数据库显示的内容，另一组根据表单显示的内容。

如果用户在 MySQL 中缺少权限，它将显示为 0。如果他们在表单提交中缺少权限，则根本不存在。

以下是数组的两个简单示例：

### 数据库阵列

```
[用户 1] => 数组（[公共] => 1
                [私人] => 1
                [秘密] => 1
               )
[用户2] => 数组（[公共] => 1
                [私人] => 0
                [秘密] => 0
               )

```

### 表单提交数组（从 User1 撤销“秘密”并将其提供给 User2）

```
[用户 1] => 数组（[公共] => 1
                [私人] => 1
               )

[用户2] => 数组（[公共] => 1
                  [秘密] => 1
                 )

```

## 问题

我怎样才能**优雅地将这两个数组组合**成一个“更改”数组，例如：

*   省略两者具有相同权限的用户
*   其余用户拥有所有权限 - 公开的、私有的和秘密的 - 设置为 0 或 1。
*   如果表单提交数组中缺少每个权限，则为 0，如果在表单提交数组中，则为 1

例如，结合以上将给出：

```
[用户 1] => 数组（[公共] => 1
                [私人] => 1
                [秘密] => 0
               )
[用户2] => 数组（[公共] => 1
                [私人] => 0
                [秘密] => 1
               )

```

## 迄今为止的尝试

*   作为第一步，我尝试将 array_merge() 与第二个列出的表单数组一起使用，认为它会覆盖它们不同的数据库数组。相反，它删除了不同的元素。
*   我曾尝试设置一个 foreach() 语句来比较两个数组，但它变得复杂了，我认为必须有一个更简单的方法

# 更新

哇！一个新的答案把我的注意力拉回到这个老问题上。我得到了这个工作，但后来我放弃了这个疯狂的代码 - 它太复杂了，无法回去使用。相反，我编写了一个 PHP 后端脚本来一次更改一个权限，然后编写了一个 AJAX 前端来发送更改。更简单的代码，并且更改对用户来说是即时的。突出显示效果可提供有关已更改内容的即时页面反馈。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T19:56:19.930

这可能是您正在寻找的： [array_diff()](http://php.net/manual/en/function.array-diff.php)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T20:00:05.557

[您可以通过参考PHP: Arrays 手册](http://www.php.net/array)找到您需要的内容。您已经很好地记录了这个问题，但我仍然无法清楚地说明您需要什么。

具体来说，您应该考虑使用 array_diff() 和 array_intersect() 来计算两个数组的差异或交集。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T20:10:40.747

发布数据仅包含您应该授予的权限。因此，设置一个“基线”，将所有权限设置为 0。然后与提交合并。

```
$empty_perms = array("public" => 0, "private" => 0, "secret" => 0);

$new_user1_perms = array_merge($empty_perms, $_POST['User1']);
$new_user2_perms = array_merge($empty_perms, $_POST['User2']); 
```

现在使用合并的数组更新数据库。这样，您将为所有元素设置正确的权限。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T22:34:02.313

让我们尝试将 gnud 的解决方案与按值比较相结合。我又添加了一个关键“成员”以显示零权限不变。

```
// empty permissions
$empty_perms = array("public" => 0, "private" => 0, "secret" => 0, "member" => 0);

// original permissions (please note that it MUST contain ALL keys)
$old_perms = array("public" => 1, "private" => 0, "secret" => 1, "member" => 0);

// POST data container
$post_data = array("public" => 1, "private" => 1);

// apply new user permissions - put them into db
$new_perms = array_merge($empty_perms, $post_data);

// differences to show
$diff_perms = array();

// compare new and old permissions
foreach($empty_perms as $k => $v) {
    $diff_perms[$k] = (int)($old_perms[$k] !== $new_perms[$k]);
} 
```

此示例应为您提供以下结果（旧的、新的、更改）：

```
Array
(
    [public] => 1
    [private] => 0
    [secret] => 1
    [member] => 0
)

Array
(
    [public] => 1
    [private] => 1
    [secret] => 0
    [member] => 0
)

Array
(
    [public] => 0
    [private] => 1
    [secret] => 1
    [member] => 0
) 
```

希望这可以帮助。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T20:15:42.873

[我想知道差异执行](https://stackoverflow.com/questions/371898/how-does-differential-execution-work)的某种变化是否会有所帮助。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-28T19:20:20.100

要使用`array_diff()`第一个参数，必须是超集，或两个数组中较大的一个。`array_diff()`当您不确定哪个数组更大时使用：

```
 //start with the superset of for array_diff to return differences
  if(count($prev_wholesaler_assignments) > count($wholesalers)){
      $perm_diff = array_diff($prev_wholesaler_assignments,$wholesalers);  
  } elseif (count($prev_wholesaler_assignments) < count($wholesalers)){
      $perm_diff = array_diff($wholesalers,$prev_wholesaler_assignments);
  } 
```

无论哪个数组恰好更大，这都会返回析取。

# algorithm - 确定电子邮件地址的健康/有效性

> ID：504631
> 
> 赞同：2
> 
> 时间：2009-02-02T19:54:34.960
> 
> 标签：algorithm, language-agnostic, email, maintenance, verification

网站的日常维护通常涉及验证链接是否有效、标记不良链接等。

我知道如何通过脚本匹配电子邮件地址（尤其是在`mailto:`链接中的网页上下文中）。我的问题是如何在不发送垃圾邮件地址的情况下验证它们是否正常？

剥离域并验证它正在侦听端口 25 是部分答案，但不处理验证用户名/别名。

有没有办法将此添加到我管理的网站的维护脚本中？

我真的不在乎它是用什么语言写的，只要它有效:)

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-02T20:08:37.550

SMTP 曾经有一个“VRFY”命令，它询问服务器是否认为用户名有效。现在每个人都将其关闭，以防止垃圾邮件。

过去也可以开始发送电子邮件，“MAIL FROM：...”，“RCPT TO：...”，如果地址不存在，接收服务器会在 RCPT TO 之后立即通知您好的。那也不管用了。

这是一种冗长的说法，“不，我认为没有办法做到这一点，而无需实际发送电子邮件。”

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T20:25:12.883

同意[Jay](https://stackoverflow.com/questions/504631/determining-the-health-validity-of-an-email-address/504674#504674)的观点：为完成这项特定工作而构建的所有漂亮功能通常都被关闭......

唯一的方法是向该地址发送电子邮件；即便如此，你也不是 100% 确定的。

*   该地址可能是垃圾；没有人检查它。
*   邮箱已满（暂时？）并且您获得了 DSN
*   SMTP 服务器故障/中断

恕我直言，继续检查域（如果您不想被列入黑名单，请轻松连接）和反垃圾邮件工具（如 akismet/spamhaus）来过滤用户提交的内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T20:21:01.817

这取决于您需要它的准确程度，因为较早的答案表明您可以通过脚本使用 SMTP 服务器接口。那么它只是如此准确，即使您发送电子邮件，它也可能永远不会 100% 准确，一些 SMTP 服务器可能会接受该电子邮件，但随后将其丢弃，或者某些电子邮件地址可能未使用，但仍接受邮件。

手工无法替代，您只能通过自动化达到一定的信心水平，而不是 100%。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T20:16:58.033

一个更好的方法是等到你有一封正常的电子邮件发送到订阅列表，并在其中包含一个请求，要求任何想要留在列表中的人在合理的时间内填写表格。之后，您可以假设没有回复的人不再需要任何邮件并将其删除。

# javascript - 带有翻转的图像

> ID：504633
> 
> 赞同：0
> 
> 时间：2009-02-02T19:55:08.017
> 
> 标签：javascript, css, image

我有一个大图像必须放在背景中。

假设图像是正方形。现在，当有人将鼠标悬停在正方形的任何角上时，图像应该变为图像的绿色版本。

实际上背景图像将保留，但我必须以某种方式将绿色图像切片覆盖在背景图像上。

所以我有一个名为“background.png”的文件，然后是“corner1.png”、corner2.png 等。

我该如何实施？我是否必须知道将图像正确放置在角落的确切像素数？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T20:16:24.307

您应该可以使用 CSS 将角落图像叠加到背景图像的每个角落中。您不需要知道那些角落图像的大小来放置它们，只需使用对齐参数，

然后，鼠标悬停动作将与那些不可见的图像对象相关联。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T20:20:49.320

```
<div class="image">
    <div class="top left" onmouseover="javascript: cornerHover();" />
    <div class="top right" onmouseover="javascript: cornerHover();" />
    <div class="bottom left" onmouseover="javascript: cornerHover();" />
    <div class="bottom right" onmouseover="javascript: cornerHover();" />
</div>

<style>
    div.image {background: url() top left no-repeat;
    div.image > div { position: absolute; width: 10px; height: 10px; }
    div.image > div[class=top] { top: 0; }
    div.image > div[class=bottom] { bottom: 0; }
    div.image > div[class=left] { left: 0; }
    div.image > div[class=right] { right: 0; }

    /* if corners need to have a different background */
    div.image > div[class=top][class=left] { background: url(); }
    div.image > div[class=top][class=right] { background: url(); }
    div.image > div[class=bottom][class=left] { background: url(); }
    div.image > div[class=bottom][class=right] { background: url(); }
</style> 
```

可能需要一些微调

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T22:33:42.237

以下示例在 background.png 的四个角上有热点（具有自己的角背景），当这些热点被鼠标悬停时，会在背景顶部（但不在角上）显示叠加图像。这可以更改以删除角落图像等。这是您要找的吗？

```
<style>
  #bgImage { position: relative; background: url(background.png) top left no-repeat; width: 500px; height: 500px; }
  #overlayImage { position: absolute; width: 500px; height: 500px; background-position: top left; background-repeat: no-repeat; }
  #bgImage a.top, #bgImage a.right, #bgImage a.bottom, #bgImage a.left { position: absolute; width: 25px; height: 25px; cursor: pointer; display: block; }
  #bgImage a.top { top: 0; }
  #bgImage a.right { right: 0; }
  #bgImage a.bottom { bottom: 0; }
  #bgImage a.left { left: 0; }
  #bgImage a.top-left { background: url(corner1.png) top left no-repeat; }
  #bgImage a.top-right { background: url(corner2.png) top left no-repeat; }
  #bgImage a.bottom-left { background: url(corner3.png) top left no-repeat; }
  #bgImage a.bottom-right { background: url(corner4.png) top left no-repeat; }
</style>

<script>
    function ShowOverlay()
    {
        document.getElementById("overlayImage").style.backgroundImage = "url(green-overlay.png)";
    }

    function HideOverlay()
    {
        document.getElementById("overlayImage").style.backgroundImage = "none";
    }
</script>

<div id="bgImage">
    <div id="overlayImage"></div>

    <a class="top left top-left" onmouseover="ShowOverlay()" onmouseout="HideOverlay()"></a>
    <a class="top right top-right" onmouseover="ShowOverlay()" onmouseout="HideOverlay()"></a>
    <a class="bottom left bottom-left" onmouseover="ShowOverlay()" onmouseout="HideOverlay()"></a>
    <a class="bottom right bottom-right" onmouseover="ShowOverlay()" onmouseout="HideOverlay()"></a>
</div> 
```

# c++ - LPTSTR 到 int (c++)

> ID：504635
> 
> 赞同：3
> 
> 时间：2009-02-02T19:55:43.350
> 
> 标签：c++, casting, lptstr

我在创建进程时传递了一些数字参数（在 VC++ 中）

我坚持将 LPTSTR 转换为 int。

提前致谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-02T19:59:19.940

LPTSTR 只是一个指向字符或宽字符字符串的长指针。

使用`_ttoi`or`_tstoi`用于与字符宽度无关的转换方式。

另见

*   [如何将 C++ 字符串转换为 int？](https://stackoverflow.com/questions/200090/how-do-you-convert-a-c-string-to-an-int)
*   [http://msdn.microsoft.com/en-us/library/hc25t012(VS.71).aspx](http://msdn.microsoft.com/en-us/library/hc25t012(VS.71).aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T01:29:02.943

盖克！你到底想做什么？您的问题是在父进程端（调用`CreateProcess()`）还是在子进程端？

有几种方法可以将参数从父进程传递到[`CreateProcess()`](http://msdn.microsoft.com/en-us/library/ms682425.aspx)函数创建的子进程。如果您可以将这些参数编码为大小合理的字符串，那么通过命令行参数（`lpCommandLine`CreateProcess 的参数）传递它们可能是最直接和可移植的，第二个是环境变量。

如果你有一个数据结构，你不能在一个合理大小的字符串中编码（或者因为它是大量的内存，或者它不容易序列化），那么你需要求助于一些进程间通信的方法。文件或共享内存块是执行此操作的两种方式。在任何一种情况下，您都需要为孩子找到一个商定的位置（如果是文件，则为文件路径，或共享内存块的名称），然后将此字符串作为命令行传递参数或环境变量。

如果您尝试`lpCommandLine`在子进程中解析参数，那么这就是其他人的建议。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T19:59:13.093

尝试使用该[`atoi()`](http://www.cplusplus.com/reference/clibrary/cstdlib/atoi.html)函数（如果您使用宽字符，则使用适当的版本）将字符串转换为整数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T21:13:46.297

我的建议是使用 _tcstol 而不是 _ttoi 之类的东西，这样您就可以处理错误情况，例如字符串中的非数字。例如：

```
int result = atoi("0");
result = atoi("foo"); 
```

在这两种情况下，结果都是 0，但只有在第二种情况下，转换才会出错。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-02T20:02:54.707

LPTSTR 是指向字符串的指针，因此如果您想要的是表示字符串值的 int，则不应将其转换为 int。

如果您知道字符串包含数字，例如“1234”，您应该能够使用 _wtoi 函数将其转换为 int

例如

int num = _wtoi(foo);

其中 foo 是 LPTSTR。

编辑：仅当 LPTSTR 是 UNICODE 字符串时，上述内容才能正常工作。即定义了_UNICODE。如果不是，你应该使用atoi。

请参阅[http://msdn.microsoft.com/en-us/library/yd5xkb5c(VS.80).aspx](http://msdn.microsoft.com/en-us/library/yd5xkb5c(VS.80).aspx)

# php - 正则表达式或在php中查找文件的东西

> ID：504641
> 
> 赞同：0
> 
> 时间：2009-02-02T19:57:42.143
> 
> 标签：php, regex, file

我在数据库中有一个名称，可以说它的“DFectuoso”和一些旧系统存储的 DFectuoso_randomnameofafile.doc。

现在我想找到所有已提交的“DFectuoso”拥有并在 PHP 页面中显示指向它们的链接。

从这个开始的方法是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T20:03:11.540

我会尝试与[`glob()`](http://php.net/glob)结合使用[`readfile()`](http://php.net/readfile)。

在我的头顶上：

```
$findname = 'DFectuoso';
foreach (glob('/path/to/somewhere/'.$findname.'*') as $file) {
  provide_a_link_to($file);
} 
```

并使用 . 传递文件`readfile()`。

请记住，如果您`$_GET`用于将所选文件传递给用户，请先清理并验证权限。不要随便，`readfile($_GET['chosenFile']);`否则你会惹上麻烦的！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T20:03:59.340

一个好方法是使用[glob()](http://php.net/glob)。

```
$files = glob("PATH_TO_FILES/DFectuoso_*.doc");
echo "<ul>\n";
foreach($files as $f)
    echo '<li><a href="'.$f.'">'.$f."</a></li>\n";
echo "</ul>\n"; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T20:11:52.880

如果它不像查找具有特定前缀的文件那么简单，您可以执行以下操作：

```
$files = glob('*');

function filter_files($filename) {
    // Do any processing you want on the filename here
    $file_matches = preg_match('/^DFectuoso.*\.(doc|txt)$/', $filename);
    return $file_matches;
}

$found_files = array_filter($files, 'filter_files'); 
```

# c# - 帮我将此行转换为 C#

> ID：504642
> 
> 赞同：0
> 
> 时间：2009-02-02T19:58:13.390
> 
> 标签：c#

请帮我将此行转换为 C#。

```
objManagementBaseObject.SetPropertyValue("hDefKey", CType("&H" &
Hex(RegistryHive.LocalMachine), Long)) 
```

C# 中的相关参考：System.Management

谢谢你。

附加信息：

代码最初是在 VB 中。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T20:09:37.470

它看起来`RegistryHive.LocalMachine`只是一个枚举值，在这种情况下通过 Hex() 传递它只是浪费时间：

```
objManagmentBaseObject.SetPropertyValue("hDefKey", (long)RegistryHive.LocalMachine); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T20:13:50.443

```
objManagementBaseObject.SetPropertyValue("hDefKey", (long)RegistryHive.LocalMachine); 
```

是相当于 VB.NET 行的 C#。

感谢您的洞察力！

# c# - 使用委托条件对 C# 列表进行二进制搜索

> ID：504645
> 
> 赞同：7
> 
> 时间：2009-02-02T19:59:19.957
> 
> 标签：c#, search, list

我有一个`List<T>`我不想搜索给定项目，而是搜索满足给定条件的项目。给定列表中的一个项目，我可以测试 4 个条件中的哪一个为真：

*   所需的项目必须在左侧
*   所需的项目必须在右侧
*   这是所需的项目
*   想要的不能在列表中

快速浏览列表功能并不令人鼓舞，所以我想知道是否有人知道我可以使用的功能？

编辑：这是一个本地临时列表，所以我知道它会被正确排序

编辑： BinarySearch 看起来几乎是正确的，但在我的情况下，我没有可比较的项目。我会使用 Jon Skeet 的解决方案并忽略一个 arg，但我不确定我是否可以指望它总是相同的 arg。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-02T20:13:31.207

**新编辑：**我将在下面留下额外的二进制搜索，因为它们对其他人有用，这是我认为您真正想要的最后一个选项。如果它正在寻找的项目“小于”指定的项目，您的代表应该返回一个正数，如果它“大于”指定的项目，则返回一个负数，如果它是正确的，则返回 0。

```
public static int BinarySearchForMatch<T>(this IList<T> list,
    Func<T,int> comparer)
{
    int min = 0;
    int max = list.Count-1;

    while (min <= max)
    {
        int mid = (min + max) / 2;
        int comparison = comparer(list[mid]);
        if (comparison == 0)
        {
            return mid;
        }
        if (comparison < 0)
        {
            min = mid+1;
        }
        else
        {
            max = mid-1;
        }
    }
    return ~min;
} 
```

**旧编辑：**我将在下面留下原始答案，但这里有另外两个选项。

第一个从源数据投影到键类型，并指定要查找的键。比较本身只是以该键类型的默认方式完成：

```
public static int BinarySearchBy<TSource,TKey>(this IList<TSource> list, 
    Func<TSource,TKey> projection, TKey key)
{
    int min = 0;
    int max = list.Count-1;

    while (min <= max)
    {
        int mid = (min + max) / 2;
        TKey midKey = projection(list[mid]);
        int comparison = Comparer<TKey>.Default.Compare(midKey, key);
        if (comparison == 0)
        {
            return mid;
        }
        if (comparison < 0)
        {
            min = mid+1;
        }
        else
        {
            max = mid-1;
        }
    }
    return ~min;
} 
```

第二个采用 Func 代替，将列表中的项目与我们正在寻找的键进行比较。当然，代码几乎完全相同 - 只是比较发生了变化：

```
public static int BinarySearchBy<TSource,TKey>(this IList<TSource> list, 
    Func<TSource,TKey,int> comparer, TKey key)
{
    int min = 0;
    int max = list.Count-1;

    while (min <= max)
    {
        int mid = (min + max) / 2;
        int comparison = comparer(list[mid], key);
        if (comparison == 0)
        {
            return mid;
        }
        if (comparison < 0)
        {
            min = mid+1;
        }
        else
        {
            max = mid-1;
        }
    }
    return ~min;
} 
```

这些都未经测试，但至少可以编译:)

**原答案：**

您可以`List<T>.BinarySearch`使用`IComparer<T>`. 您不必编写自己的实现`IComparer<T>`- 我已经在[MiscUtil](http://pobox.com/~skeet/csharp/miscutil)`IComparer<T>`中进行了，它从`Comparison<T>`委托构建了一个。这只发现了前三个条件，但二进制搜索将从其余条件中找出最后一个。

事实上，代码太短了，我不妨把它贴在这里（诚然，没有注释）。

```
public sealed class ComparisonComparer<T> : IComparer<T>
{
    readonly Comparison<T> comparison;

    public ComparisonComparer(Comparison<T> comparison)
    {
        if (comparison == null)
        {
            throw new ArgumentNullException("comparison");
        }
        this.comparison = comparison;
    }

    public int Compare(T x, T y)
    {
        return comparison(x, y);
    }
} 
```

所以你可能会做类似的事情：

```
var comparer = new ComparisonComparer<Person>((p1, p2) => p1.ID.CompareTo(p2.ID));
int index = list.BinarySearch(employee, comparer); 
```

MiscUtil 还有一个`ProjectionComparer`您可能感兴趣的功能——您只需指定一个投影，就像`OrderBy`使用 LINQ 一样——但这实际上取决于您的用例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T20:03:52.257

你确定这些条件吗？通常，如果列表已排序，则可以使用，在这种情况下，您可能首先要使用 a [`SortedList<TKey, TValue>`](http://msdn.microsoft.com/en-us/library/ms132319.aspx)。

无论哪种方式，假设 C# 3.0 或更高版本您可能需要该`.Where()`方法。将您的条件写成 Lambda 并让框架进行搜索。它应该使用适合该集合的搜索技术。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T20:06:49.083

您可能希望在对象的自定义比较器中实现它（在 C# 文档中奇怪地称为比较器）。

# c# - 与 LINQ to XML 联合

> ID：504648
> 
> 赞同：5
> 
> 时间：2009-02-02T19:59:41.080
> 
> 标签：c#, linq, linq-to-xml, union, openxml-sdk

我需要将两组 XElement 合并为一组唯一的元素。使用 .Union() 扩展方法，我只得到一个“联合所有”而不是联合。我错过了什么吗？

```
var elements = xDocument.Descendants(w + "sdt")
                   .Union(otherDocument.Descendants(w + "sdt")
                   .Select(sdt =>
                       new XElement(
                           sdt.Element(w + "sdtPr")
                               .Element(w + "tag")
                               .Attribute(w + "val").Value,
                           GetTextFromContentControl(sdt).Trim())
                   )
               ); 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T03:45:26.333

你的第一个冲动几乎是正确的。:) 根据**David B**，如果你不告诉 LINQ 你是如何定义相等的，然后给它一堆 XElement，它会通过引用来比较它们。幸运的是，您可以通过指定 IEqualityComparer‹XElement› 来告诉它使用不同的标准（基本上，一个对象具有一个 Equals 方法，如果两个 XElement 根据您的定义返回 true，否则返回 false，以及一个 GetHashCode 方法，该方法采用 XElement并根据您的相等标准返回哈希码）。

例如：

```
var elements = xDocument.Descendants(w + "sdt")
               .Union(otherDocument.Descendants(w + "sdt", new XElementComparer())
               .RestOfYourCode 
```

...

项目中的其他地方

```
public class XElementComparer : IEqualityComparer‹XElement› {
   public bool Equals(XElement x, XElement y) {
     return ‹X and Y are equal according to your standards›;
}

 public int GetHashCode(XElement obj) {
     return ‹hash code based on whatever parameters you used to determine        
            Equals. For example, if you determine equality based on the ID 
            attribute, return the hash code of the ID attribute.›;

 }

 } 
```

注意：我家里没有框架，所以没有测试确切的代码，IEqualityComparer 代码来自[这里](http://community.sgdotnet.org/forums/t/11567.aspx)（向下滚动到第二篇文章）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T20:21:53.220

如果不看你用什么来得出这个结论，就很难对你的“左连接”观察进行故障排除。这是我在黑暗中拍摄的。

```
XDocument doc1 = XDocument.Parse(@"<XML><A/><C/></XML>");
XDocument doc2 = XDocument.Parse(@"<XML><B/><C/></XML>");
//
var query1 = doc1.Descendants().Union(doc2.Descendants());
Console.WriteLine(query1.Count());
foreach (XElement e in query1) Console.WriteLine("--{0}",e.Name);

6
--XML
--A
--C
--XML
--B
--C
//
var query2 = doc1.Descendants().Concat(doc2.Descendants())
  .GroupBy(x => x.Name)
  .Select(g => g.First());
Console.WriteLine(query2.Count());
foreach (XElement e in query2) Console.WriteLine("--{0}", e.Name);

4
--XML
--A
--C
--B 
```

在 linq to objects（实际上是 linq to xml）中，针对引用类型的 Union 使用引用相等来测试重复项。XElement 是一种引用类型。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T21:26:00.827

我能够让以下工作，但它很丑陋：

```
var elements = xDocument.Descendants(w + "sdt")
                   .Concat(otherDocument.Descendants(w + "sdt")
                               .Where(e => !xDocument.Descendants(w + "sdt")
                                               .Any(x => x.Element(w + "sdtPr")
                                                             .Element(w + "tag")
                                                             .Attribute(w + "val").Value ==
                                                         e.Element(w + "sdtPr")
                                                             .Element(w + "tag")
                                                             .Attribute(w + "val").Value)))
                   .Select(sdt =>
                       new XElement(
                           sdt.Element(w + "sdtPr")
                               .Element(w + "tag")
                               .Attribute(w + "val").Value,
                           GetTextFromContentControl(sdt).Trim())
                   )
               ); 
```

肯定有更好的方法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T23:06:42.403

这样的事情呢？

```
var xDoc = from f in xDocument.Descendants(w + "sdt")
    select new {xNode = f, MatchOn = f.Element(w + "sdtPr").Element(w + "tag").Attribute(w + "val").Value };

var oDoc = from o in otherDocument.Descendants(w + "sdt")
    select new {MatchOn = o.Element(w + "sdtPr").Element(w + "tag").Attribute(w + "val").Value };

var elements = from x in xDoc.Where(f => !oDoc.Any(o => o.MatchOn == f.MatchOn))
    select new XElement(x.MatchOn, GetTextFromContentControl(x.xNode).Trim()); 
```

# nunit - 使用 NUnit 驱动 NDepend

> ID：504650
> 
> 赞同：7
> 
> 时间：2009-02-02T19:59:57.927
> 
> 标签：nunit, teamcity, build-automation, ndepend, cqlinq

是否可以使用 NUnit 使用 NDepend 运行 CQL 查询？如果能够在 UnitTests 库中包含 NDepend dll 并编写如下测试，那就太好了：

```
[Test] public void
DomainAssemblyHasNoDatabaseDependencies
... 
```

或类似的东西。

这将使与 Team City 集成变得非常容易，并且如果任何静态分析测试失败，则构建会自动失败。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-03T11:45:16.147

这要归功于与 NDepend v4 一起发布的[NDepend.API](http://www.ndepend.com/API/webframe.html)，尤其要归功于命名空间[NDepend.CodeQuery](http://www.ndepend.com/API/webframe.html?NDepend.API~NDepend.CodeQuery_namespace.html)，其中包含以编程方式运行 CQLinq 或 CQL 代码查询所需的内容以及以简单字符串形式呈现的规则。

[这是开始使用 NDepend.API 的文档](http://www.ndepend.com/API/webframe.html?NDepend.API_gettingstarted.html)。

我们建议在*$NDependInstallPath$\NDepend.PowerTools.SourceCode\NDepend.PowerTools.sln中查看名为**Query Code with CQLinq的 PowerTool 的源代码*

 *最后请注意，由于 NDepend.API，您还可以直接编写代码查询/规则，甚至使用 C# 或 VB.NET 代码（因此可以嵌入到单元测试中的代码）的静态分析器。

# c# - ASP.NET-MVC 中的表单发布上的 FormCollection 为空

> ID：504681
> 
> 赞同：32
> 
> 时间：2009-02-02T20:12:24.703
> 
> 标签：c#, asp.net, asp.net-mvc

我正在使用我过去经常使用的方法发布一个非常简单的表单。显示我的代码可能比输入冗长的解释更容易。这是HTML：

```
<% Html.BeginForm("CreateMarketingType", "ListMaintenance"); %>
    <div id="ListMaintenanceContainer">
        <table>
            <tr>
                <th>Marketing Type Id</th>
                <th>Marketing Type Name</th>
            </tr>                    
                <%foreach (MarketingType marketingType in ViewData.Model.MarketingTypes) %>
                <%{ %>
                    <tr>
                        <td><%= marketingType.MarketingTypeId.ToString() %></td>
                        <td><%= marketingType.MarketingTypeName %></td>
                    </tr>
                <%} %>
        </table>
        <div>
            <fieldset id="fsSaveNewMarketingType">
                <legend>Add New Marketing Type</legend>
                <label for="txtNewMarketingTypeName">New Marketing Type Name:</label>
                <input type="text" id="txtNewMarketingTypeName" />
                <input type="submit" value="Save" id="CreateMarketingType" />
            </fieldset>
        </div>                    
    </div>
<% Html.EndForm();%> 
```

这是控制器代码：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult CreateMarketingType(FormCollection form)
{
    string newMarketingTypeName = Request.Form["txtNewMarketingTypeName"].ToString();

    MarketingType newMarketingType = new MarketingType() { MarketingTypeName = newMarketingTypeName };

    _marketingTypeRepository.AddNewMarketingType(newMarketingType);

    return View("ListMaintenance", GetModel());
} 
```

提交按钮发布表单，并调用了方法，但是我的参数中定义的表单对象为空。我也尝试过 Request.Form 并且得到了相同的结果。我在这里错过了什么吗？

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-02-02T20:24:45.303

您的所有输入都没有名称属性。没有名称 = 不在 FormCollection 中。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-02-09T13:24:28.500

我遇到了这个问题，然后意识到我在提交表单之前禁用了所有 INPUT 控件（作为 UX 功能）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-04-28T14:06:30.257

希望我能把它作为一个简单的评论发布，但我没有那个特权......我添加了我所有的名字属性，但仍然没有快乐。请记住将您的 name 属性添加到表单本身。必须使用接受 htmlAttributes 的 HTML.BeginForm 的重载。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-06-20T22:50:38.520

我看到这个问题已经回答了。以下是我在 MVC 视图中使用的另一种方法，当时表单集合为空。使用 JavaScript / jQuery，它将名称-值对设置为附加到表单的隐藏控件。

**JavaScript / jQuery**

```
 $("#btnExport").click(function (event) {
                event.preventDefault();

                //Append the parameter to the form
                var practiceVal = $('#Practice').val();
                $('<input />').attr('type', 'hidden')
                   .attr('name', "Practice").attr('value', practiceVal)
                   .appendTo('#formHome');

                //Submit
                $('#formHome').submit();
            }); 
```

**形式**

```
 <form id="formHome" method="post">
 </form> 
```

参考[**表格**](https://www.w3.org/TR/html401/interact/forms.html#h-17.2)

> 当提交表单进行处理时，一些控件`name`与它们的当前值配对，并且这些对与表单一起提交

# sql-server-2005 - 链接服务器和约束 SQL 2005

> ID：504685
> 
> 赞同：1
> 
> 时间：2009-02-02T20:14:08.303
> 
> 标签：sql-server-2005

有谁知道您是否可以通过 SQL 2005 中的链接服务器删除表上的约束

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-04T02:27:36.147

你可以，但你必须使用一些动态的 SQL 技巧来实现它。

```
declare @cmd VARCHAR(4000)
SET @cmd = 'Use YourDatabase
ALTER TABLE YourTable
DROP CONSTRAINT YourConstraint'

exec YourServer.master.dbo.sp_executesql @SQL 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T20:56:16.207

[您可以在 SQLServer 2k5 中的链接服务器表的视图上使用外键吗？](https://stackoverflow.com/questions/442587/can-you-have-a-foreign-key-onto-a-view-of-a-linked-server-table-in-sqlserver-2k5)

我会说你不能。

# java - 大 XML 文件和 OutOfMemoryError

> ID：504689
> 
> 赞同：2
> 
> 时间：2009-02-02T20:14:59.817
> 
> 标签：java, xml, memory, parsing, out-of-memory

我正在尝试在 java 中解析一个最大为 500 mb 的 XML 文件。我尝试使用 SAX，但它给了我这个错误 java.lang.OutOfMemoryError: Java heap space at com.sun.org.apache.xerces.internal.util.XMLStringBuffer.append(Unknown Source) 你能帮帮我吗？非常感谢。PS 较小的 XML 文件可以正常工作

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-02T20:40:42.167

很可能您没有正确使用 SAX，或者您的应用程序不适合流处理。

SAX 的重点是避免将整个 XML 结构保存在内存中，但这只有在您可以在不保留太多上下文的情况下以小块处理 XML 并且处理的结果比处理后的 XML 小得多的情况下才有可能（这样它也不会使用太多内存）或者本身可以传递给接收者或连续写入磁盘。

**编辑：**您也有可能只是发生了内存泄漏，即您持有不再需要的数据，从而阻止它被垃圾收集。如果您使用任何列表、映射或集合来处理 XML，请确保在处理一个 XML 块时添加到它们的任何内容在开始下一个块之前都已删除。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-02T20:20:45.063

尝试使用 XML 的 Streaming API（java6 中的新功能）

[http://www.javabeat.net/articles/14-java-60-features-part-2-pluggable-annotation-proce-2.html](http://www.javabeat.net/articles/14-java-60-features-part-2-pluggable-annotation-proce-2.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-02T20:21:30.613

您可以尝试通过指定例如来增加 Java 堆大小

```
java -Xmx1024M MyClass 
```

在命令行上（或任何适合您文档大小的值）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-02T20:57:49.993

StAX for Java 6 之前的版本：http: [//stax.codehaus.org/](http://stax.codehaus.org/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T21:12:41.680

假设您有以下 XML 结构：

```
<?xml version="1.0"?>
<list>
    <item>
        <name>Alpha</name>
        <age>10</age>
    </item>
    <item>
        <name>Beta</name>
        <age>20</age>
    </item>
    <!-- many many items -->
</list> 
```

你想得到所有的 <item>

```
public class Item
{
    String name;
    String age;
} 
```

您的 SAX 处理程序将如下所示

```
public class MyHandler extends DefaultHandler
{
    Item current=null;
    StringBuilder content=null;

    @Override
    public void startElement(String uri, String localName, String name, Attributes attributes) throws SAXException 
    {
        if(name.equals("item"))
        {
            current= new Item();
        }
        else if(name.equals("name") || name.equals("age"))
        {
            content= new StringBuilder();
        }
    }

    @Override
    public void endElement(String uri, String localName, String name) throws SAXException
    {
        if(name.equals("item"))
        {
        //DO SOMETHING WITH current
        System.out.println(current);
        current=null;
        }
        else if(name.equals("name"))
        {
        current.name= content.toString();
        }
        else if(name.equals("age"))
        {
        current.age= content.toString();
        }
        content=null;
    }

    @Override
    public void characters(char[] ch, int start, int length) throws SAXException 
    {
        if(content!=null)
        {
            content.append(ch,start,length);
        }
    }
} 
```

如您所见，`content`仅在`age`and`name`标记之间被记忆。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-08-26T21:09:28.627

您可能想查看 ScaleDOM，它允许解析非常大的 XML 文件：[https ://github.com/whummer/scaleDOM](https://github.com/whummer/scaleDOM)

由于 XML 节点的延迟加载，ScaleDOM 占用的内存很小。它只将 XML 文档的一部分保存在内存中，并在必要时从源文件中重新加载节点。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-03T21:30:12.147

看看 Apache Digester。

[这是一个小教程](http://www.ibm.com/developerworks/java/library/j-lucene/)

# c# - 是否有 OO 模型来生成 SQL？

> ID：504692
> 
> 赞同：1
> 
> 时间：2009-02-02T20:15:54.633
> 
> 标签：c#, .net, sql, semantics

我一直想知道是否有任何代码可以以某种对象树的形式表示 SQL，这些对象树可以组装、修改然后最终呈现为有效的 SQL？

从我的头顶上看，它可能看起来像那样......

```
var stmnt = new Statement();
stmnt
  .AddMaster("Customer")
  .Show("Firstname, "Lastname")
  .AddJoin("Address", "ID", "CustomerID")
  .Show("Street", "City");
stmnt.WhereStatement()
  .AddParameter("Address.City", Op.Equal);

string sql = stmnt.Generate();
// select a.FirstName, a.LastName, b.Street, b.City
// from Customer a
// join Address b on b.CustomerID = a.ID
// where b.City = :p1 
```

这只是一个例子，外面的事情可能完全不同，但是是的，我很想听听这方面的情况。

更新：

我知道使用 ORM 技术从数据库中获取结果的多种可能性，但我追求的是 SQL 本身的模型。我知道抽象级别非常低，但它可能允许多个协作者可以处理 SQL 语句（多个连接，多个 where），然后可以在构建阶段结束时“渲染”。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T20:16:45.600

Hibernate 有自己的 Hibernate 查询语言 (HQL)，它将类似 SQL 的构造表示为对象。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T20:21:13.143

一个 OR-Mapper，例如 Microsoft 的[LINQ](http://msdn.microsoft.com/en-us/vcsharp/aa904594.aspx)

这里有些例子：

```
from c in customers
where c.LastName.StartsWith("A")
select c

//

var q = from c in db.Contact
           where c.DateOfBirth.AddYears(35) > DateTime.Now
           orderby c.DateOfBirth descending
           select c; 
```

一些帮助您入门的链接：

*   [http://www.hookdonlinq.com/LINQtoSQL5MinuteOverview.ashx](http://www.hookedonlinq.com/LINQtoSQL5MinuteOverview.ashx)
*   [http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx](http://weblogs.asp.net/scottgu/archive/2007/05/19/using-linq-to-sql-part-1.aspx)
*   [http://msdn.microsoft.com/en-us/library/bb386976.aspx](http://msdn.microsoft.com/en-us/library/bb386976.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T20:22:58.223

见上文，我见过不止一个程序员走上这条路。（而且我告诉不止一位程序员，我见过不止一位程序员……但通常他们最终会自己发现它的工作原理。）

我看到的困难是您在没有提供太多抽象方式的情况下增加了相当大的复杂性。您几乎需要知道无论如何您最终会使用什么 SQL。

（至少在您的插图中表示的模式的程度上，您直接指定子句。ORM 的抽象远不止于此。）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-02T22:25:14.997

Python 包 SQLAlchemy 有一个 ORM 层，但它也有一个 SQL 生成层。

[我知道你标记了这篇文章 c# 和 .net，但我想你可能想看看还有什么]

这是一些示例代码：

```
from sqlalchemy import Table, Column, Integer, String, MetaData, ForeignKey
from sqlalchemy.sql import select

metadata = MetaData()

# Make a basic customer table.
Customer = Table('Customer',
                 metadata,
                 Column('ID', Integer, primary_key=True),
                 Column('FirstName', String),
                 Column('LastName', String))

# Make a basic address table
Address = Table('Address',
                metadata,
                Column('ID', Integer, primary_key=True),
                Column('City', String),
                Column('Street', String),
                Column('CustomerID', None, ForeignKey('Customer.ID')))

# Generate some sql
stmt = select([Customer.c.FirstName,
               Customer.c.LastName,
               Address.c.Street,
               Address.c.City],
              from_obj=Customer.join(Address),
              whereclause=Address.c.City == 'Wellington')

# Display
print stmt
# output:
SELECT "Customer"."FirstName", "Customer"."LastName", "Address"."Street", "Address"."City" 
FROM "Customer" JOIN "Address" ON "Customer"."ID" = "Address"."CustomerID" 
WHERE "Address"."City" = :City_1

# note that SQLAlchemy picked up the join condition from the foreign key.
# you can specify other join conditions if you want. 
```

通常，您将通过使用 SQLAlchemy 连接到数据库来执行该语句。然后你可以这样做：

```
for row in stmt.execute():
    print 'Name:', row.c.FirstName, row.c.LastName, 'City:', row.c.City 
```

希望这可以帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T20:19:27.310

您可以尝试[MetaDb](http://www.codeplex.com/metadb)。有一些工作已经完成。 [示例查询 http://i3.codeplex.com/Project/Download/FileDownload.aspx?ProjectName=metadb&DownloadId=11482](http://i3.codeplex.com/Project/Download/FileDownload.aspx?ProjectName=metadb&DownloadId=11482)

但如果您可以使用 .NET 3.5，则可以使用 LINQ。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T20:18:54.380

在 .Net 中，Linq 几乎可以满足您的要求。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T20:19:26.157

如果您仍在使用 .NET 2.0 并且尚未继续使用 LINQ，那么我将创建一个基本语句类，然后创建允许使用装饰器模式的类。

这样，您就可以继续将您需要的内容添加到基本语句中。

# python - 为什么 IronPython 比官方 Python 解释器快

> ID：504716
> 
> 赞同：15
> 
> 时间：2009-02-02T20:21:28.307
> 
> 标签：python, performance, ironpython

根据这个：

[http://www.codeplex.com/IronPython/Wiki/View.aspx?title=IP20VsCPy25Perf&referringTitle=IronPython%20Performance](http://www.codeplex.com/IronPython/Wiki/View.aspx?title=IP20VsCPy25Perf&referringTitle=IronPython%20Performance)

IronPython (Python for .Net) 在同一台机器上比普通 Python (cPython) 更快。为什么是这样？我认为编译的 C 代码总是比等效的 CLI 字节码更快。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-02-02T20:23:27.600

Python 代码不会被编译为 C，Python 本身是用 C 编写的并解释 Python 字节码。CIL 被编译为机器代码，这就是为什么您在使用 IronPython 时会看到更好的性能。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-03T12:49:08.357

你是对的，C 的速度要快得多。这就是为什么在这些结果中，CPython 处理字典时的速度是纯 C 的两倍。另一方面，Python 代码不是编译的，而是解释的。CPython 中的函数调用非常慢。但另一方面：

```
TryRaiseExcept:  +4478.9% 
```

现在，IronPython 得到的地方是非常错误的。

然后是这个 PyPy 项目，其目标之一是即时编译器。甚至还有 Python 的一个子集，称为 RPython（精简 Python），可以静态编译。这当然要**快得多**。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-07T00:21:05.403

我不确定您是如何得出 IronPython 比 CPython 更快的结论。您发布的链接似乎表明他们擅长不同的事情（如已指出的例外情况）。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-05-06T17:59:51.190

将你的问题“为什么？”转为“哦，真的吗？” “擅长不同的事情”（杰森贝克）是正确的。例如，cpython 比 IronPython 轻松启动时间。

```
c:\Python26\python.exe Hello.py
c:\IronPython\ipy.exe Hello.py 
```

Cpython 几乎立即（<100 毫秒）执行一个基本的 hello world，其中 IronPython 的启动开销为 4 或 5 秒。这让我很恼火，但还不足以阻止我使用 IronPython。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-02T20:26:06.393

是否可以通过您链接到的页面上的此符号来解释：

> 由于动态语言运行时中的站点缓存，IronPython 在 PyStone 传递次数上比默认值表现更好

# ruby-on-rails - Ruby on Rails 新手

> ID：504721
> 
> 赞同：1
> 
> 时间：2009-02-02T20:22:48.990
> 
> 标签：ruby-on-rails, ruby, web-applications, backup

我继承了一个有问题的 Ruby on Rails 应用程序。我已经阅读了一些关于 Rails 的书籍，但还没有看到一些问题的答案。

1.  备份应用程序的最佳方法是什么？我可以`tar -cvzf app.tgz app`吗？我还不知道该应用程序是否具有 sqlite3 数据库或连接到数据库服务器。

2.  将应用程序移动到另一台服务器进行测试的最佳方法是什么？同样，我不知道是 sqlite3 还是支持它的数据库服务器。

谢谢，

迈克尔

**更新**：是的，我将使用版本控制。现在没有。我想我试图解决的问题是：应用程序目录的可移植性如何；如果我想将整个应用程序移动到另一台计算机上，我还需要随身携带其他东西吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-08T22:30:19.370

> 我还不知道该应用程序是否具有 sqlite3 数据库或连接到数据库服务器。

查看config目录下的database.yml文件。适配器线会告诉你它正在使用什么数据库。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-09-24T12:49:57.750

备份我发现的代码的一个好方法是使用 git 并推送到存储在 Dropbox ( [http://getdropbox.com](http://getdropbox.com) )上的裸存储库

工作流程是这样的（假设像 OSX 这样的基于 Unix 的系统，如果是 Windows，则相应地调整路径）

创建本地应用程序并从中创建一个 git repo：

```
cd ~/Rails
rails my_app
cd my_app
git init
git add .
git commit -m "first commit" 
```

然后在您的 Dropbox 目录上，创建一个裸存储库（我在它下面使用了一个名为 'git' 的目录）

```
cd ~/Dropbox/git
mkdir my_app.git
cd my_app.git
git init --bare 
```

现在回到你的应用程序并添加 Dropbox 作为源并推送到它

```
cd ~/Rails/my_app
git remote add origin ~/Dropbox/git/my_app.git
git push origin master 
```

在您的 ~/Rails 目录中进行更改后，只需推送到 Dropbox 存储库，它将备份到他们的服务器上（您可以轻松地在链接到 Dropbox 的所有机器上共享存储库）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-03T01:22:21.163

我会看看 Capistrano - 这是首选的部署/管理工具。

它的核心是从源代码控制中获取您的应用程序，部署和配置目标服务器，并运行任何数据库迁移。

您可以使用它来指向多个服务器（例如测试、登台和生产）。

要回答您的实际问题，您可以通过简单地复制 Rails 目录来移动您的应用程序（注意：不仅*是*应用程序目录，还有父目录）。您的数据库需要单独管理 - 对于 sqlite，您可以只获取文件，如果您使用的是 MySQL，您可能会转储数据库并在下一个服务器上重新配置。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-24T13:12:50.730

您可以复制整个目录。但是，通常的做法是先“冻结”您的 Rails 安装和 gem 到目录中，如果这还没有完成的话。这可确保您复制应用程序的测试服务器也具有并使用完全相同版本的 Rails 和安装的任何 gem。

如果这样做了，你应该有一个 vendor/rails/ 目录。

你可以通过运行“冻结”你的 Rails：

```
rake rails:freeze:gems 
```

您还需要确保两台主机上的 Ruby 版本相同或相似。我在使用 1.8.7 和 1.9.1 时遇到了问题 - 请记住这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T20:23:43.543

对于两者，我建议使用版本管理系统。也许[颠覆](http://subversion.tigris.org/)

这就是我所做的，出于类似的原因。

如果您查看 config/database.yml 中的数据库设置，您会发现正在使用的数据库。如果它是 sqlite，只需确保它是 subversion 存储库的一部分。

除此之外，当您在另一台服务器上进行导出或签出时，只需确保该服务器可以访问数据库，无论它在哪里。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T20:31:36.757

版本控制应该是一个好的开始。您应该立即找出什么是后备数据库，并确保您不仅有 1 个数据库文件/服务器，还有第二个用于测试的实例。不要乱用生产数据。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T20:42:02.507

要“备份”应用程序的代码，您可以将 git 与[http://github.com](http://github.com)一起使用。这为您提供了一个可以放置代码的异地区域，但我认为您必须为私有存储库付费（大约 12 美元/月）。或者，只需在办公室的另一个盒子上设置一个 git 服务器并将其托管在那里。

“数据库设置”保存在 config/database.yml 中，这将告诉您需要了解的有关数据库的信息。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-09-24T09:25:05.573

用于代码的 GIT（或 SVN）+ Capistrano，对于数据，有以下选项：

*   有几个 Rails 插件用于转储您的应用程序数据库和资产。我最喜欢的是 github.com/toy/dump。您可以运行`rake dump:create`和`rake dump:restore`. 最令人兴奋的是 capistrano 集成——`cap dump:mirror:down`下载应用程序资产和数据库，它会在本地机器上创建您网站的克隆。

*   如果您需要自动备份您的应用程序以睡个好觉，我建议您[备份我的应用程序](http://backupmyapp.com)服务。这是自动备份 Rails 应用程序的完整解决方案，您只需要安装它们的插件，它们就会自动处理其余的过程。他们将您的备份历史记录保存数周，您可以通过浏览器浏览它们并自动恢复其中的任何一个。

# sql - SQL - 查询多维数据集

> ID：504728
> 
> 赞同：2
> 
> 时间：2009-02-02T20:23:56.583
> 
> 标签：sql, stored-procedures, reporting-services, cubes

所以我刚刚在我们的一个 SQL 数据库中收到了一个到多维数据集的连接字符串。我应该根据这些数据创建一个可以通过电子邮件发送给 30 个人的报告。

我更愿意编写一个存储过程，让 SSRS 在它应该发送的时候发送它。问题是数据库非常复杂，我不确定我是否可以匹配所有内容并获得正确的信息。

无论如何，我可以编写一个存储过程来查看多维数据集中的信息吗？

我不确定这是否重要，但数据库和多维数据集位于同一 SQL 服务器上。

有关多维数据集的任何信息都会有所帮助。我知道它们会根据它们可能最常用于的用途进行一些预先计算。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T20:32:35.863

[尝试 OpenQuery 和/或 OpenRowset 并通过 MDX](http://sqlblogcasts.com/blogs/drjohn/archive/2008/09/27/mdx-and-sql-combining-relational-and-multi-dimensional-data-into-one-query-result-set.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T20:37:47.633

您可以使您的报表使用常规存储过程，但该存储过程仍然必须运行针对多维数据集的 MDX 查询（通过 OLEDB）。

我不确定您使用的是什么报告；特别是无论它是本地报告还是基于服务器的报告，但 SQL Server 基于服务器的报告确实有一个 MDX 生成器，它对初学者隐藏了 MDX 语法，并且足以填充简单的表（SSRS 2008 中的 Tablix）和基于矩阵的报告。对于更复杂的报告，它有助于学习 MDX 语法。

如果您使用本地报告（在应用服务器上运行，而不是在报告服务器上运行），您必须了解 MDX 语法，因为您必须使用此 MDX 查询通过中间件组件上的 OLEDB 提供程序查询 Analysis Services Cube。

还有一件事，当您需要向下钻取和/或从摘要向下钻取到详细信息时，最好使用多维数据集。它们最适合用于对具有维度信息的数据（度量）进行切片和切块。矩阵控件是查看多维数据集中数据的最佳工具，其中数据单元格本身表示一个度量，该单元格的列和标题表示一个度量。然后，矩阵将根据您选择的维度自动“转换”数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T20:26:54.957

两种不同的语言——T-SQL 是用于查询关系数据的 RDBMS 工具；与您使用 MDX 的多维数据集交谈。

# c# - 如何投射列表 有效地？

> ID：504729
> 
> 赞同：24
> 
> 时间：2009-02-02T20:24:02.950
> 
> 标签：c#, linq-to-sql

我有一个

```
List<InputField> 
```

但我需要一个

```
List<IDataField> 
```

有没有办法在 c# 中转换它？或者使用 Linq 获得相同的结果？

我有两个实现相同接口的类：

```
interface IDataField { }
class InputField : IDataField { }
class PurchaseField : IDataField { } 
```

此列表来自 Linq-to-Sql 查询：

```
List<InputField> list = (from i .... select i).ToList(); 
```

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-02T20:46:47.083

.OfType<T> 和 .Cast<T> 都会返回一个 T 的列表，但是这两个方法的含义是不同的。

list.OfType()**过滤**原始列表并返回所有类型为 T 的项目，并跳过不属于该类型的项目。

list.Cast()将原始列表中的所有项目**转换**为类型 T，并为无法转换为该类型的项目引发异常。

在您的情况下，两者都会给出相同的结果，但使用 .Cast() 会更清楚地传达您的意图，所以我建议使用它。

```
List<InputField> list = (from i .... select i).Cast<IDataField>().ToList(); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-02T20:25:35.067

```
List<InputField> raw = (from i .... select i).ToList();
List<IDataField> result = raw.OfType<IDataField>().ToList(); 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-02T20:39:36.117

您也可以使用**List.ConvertAll**。

文档：http: [//msdn.microsoft.com/en-us/library/73fe8cwf.aspx](http://msdn.microsoft.com/en-us/library/73fe8cwf.aspx)

例子：

```
List<IDataField> newList = oldList.ConvertAll(i => i as IDataField); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-02T20:34:03.570

由于列表来自

```
List<InputField> list = (from i .... select i).ToList(); 
```

难道你不能只修复“select i”部分来代替返回 IDataField 吗？像这样的东西：

```
List<InputField> list = (from i .... select (IDataField)i).ToList(); 
```

如果这不起作用，则 IEnumerable 的“Cast”扩展可能会起作用：

```
List<DataField> list2 = list.Cast<IDataField>(); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-02T20:51:17.480

以防万一：我几乎没有 C# 经验，但如果这种泛型构造与 Java 中的含义相同，那么您**必须**创建一个由超类型参数化的全新 List。换句话说，如果 的每个实例`Bangle`也是 的实例`Akthud`，则并不**意味着**每个实例`List<Bangle>`也是`List<Akthud>`。

这样做的原因是您可以有两个对 this 的引用`List<Bangle>`。如果第二个引用强制转换然后将其称为 a `List<Akthud>`，则允许向其添加 an `Akthud`- 但现在第一个引用具有 a `List<Bangle>`，其成员并非全`Bangle`是 s。违反！

话虽这么说，大卫 B 的答案确实应该做你想做的，正确的，AFAICT。（它看起来像一个复制操作。）

[如果我误解了 C# 泛型的语义，我希望有人在评论中纠正我！]

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-02T20:25:59.670

我不知道直接演员会产生预期的效果。我很少这样做，通常是这样的：

```
List<InputField> list = .....
List<IDataField> list2 = new (List<IDataField>((IDataField[])list.ToArray())); 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-04T11:50:16.863

ConvertAll 似乎是一个更好的解决方案，因为它不依赖于 Linq 库并且更短更直观。

但是它们都是解决方法，而不是解决方案。他们都使用相同的数据创建了一个新集合。.net 中应该支持泛型协方差，即泛型集合中的向上转换，这将允许您自然地做到这一点。例如：

```
List<IDataField> ls = (List<IDataField>)List<InputField> 
```

从我目前的搜索来看，我的结论是 .Net 3.5 版不支持此功能。因此，我们必须最终找到解决方法。

这些是关于该主题的讨论：

*   [C# 泛型协方差](http://jopinblog.wordpress.com/2007/10/26/c-generic-covariance/)
*   [协变通用列表](http://www.fotia.co.uk/fotia/DN.01.CoVariantGenericList.aspx)
*   [泛型是协变的、反变的还是不变的？](http://msdn.microsoft.com/en-gb/library/aa479859.aspx#fundamentals_topic12)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-10-21T06:47:47.797

我有以下字符串

```
 var str = "2 4 7 8 10"; 
```

当我投如下

```
var numbersInt2 = numbers.Split(' ')
                .ToList().Cast<int>().ToList(); 
```

它返回一个异常但是

> System.InvalidCastException：“指定的演员表无效。”

, 如果使用以下

```
var numbersInt = numbers.Split(' ')
                .ToList().ConvertAll(int.Parse); 
```

有用。

# .net - 从 Internet Explorer 中访问硬件

> ID：504730
> 
> 赞同：2
> 
> 时间：2009-02-02T20:24:29.437
> 
> 标签：.net, silverlight, internet-explorer, hardware

是否可以从 Internet Explorer 中访问硬件设备（网络摄像头、磁卡读卡器等）？

如果是，使用了哪些技术？是否有任何.Net 示例。

就我而言，我需要访问将连接到客户端计算机的磁卡读卡器。Web 应用程序需要能够访问读卡器并获取卡信息，然后这些信息将用于访问服务器上运行的数据库中的数据表。

我见过集成到网站中的网络摄像头，想知道这是怎么做到的？因为如果可以访问网络摄像头，那么连接到 USB 端口的任何其他设备也应该如此。

最后，SilverLight 应用程序可以访问硬件吗？他们可以打印到附加的打印机吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T20:30:08.147

自定义 ActiveX 控件可能是您最好的选择

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T12:10:56.127

您可以尝试使用[FullTrust WPF-Browser](http://nahidulkibria.blogspot.com/2008/05/how-to-run-wfpxbap-in-full-trust-mode.html)应用程序 xbap。您需要使用 ssl 证书，但如果这些证书安装在客户端计算机和服务器上，您可以使用浏览器中的硬件。

当您在本地计算机上托管 xbap 时，您不需要证书，因此您可以对其进行测试。测试部署时，您可以从 Visual Studio 创建证书并将其安装在服务器上，然后让用户下载并安装它们。

访问硬件的另一种方法是将[应用程序注册到 URL 协议](http://msdn.microsoft.com/en-us/library/aa767914(VS.85).aspx)。并与之交流。这样你就可以像写 HTML

```
 <A href="MyScanReader://ReadTheScanNo?12345">Scan</A> 
```

让该应用程序通过调用 url 将数据发送到服务器。我们曾经用它从浏览器中启动应用程序。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T20:36:20.380

如果您*需要*硬件访问权限，那么 Web 应用程序是一个糟糕的选择。您必须在客户端安装一些具有足够权限才能访问设备的东西，因此您最好编写一个只与服务器对话的成熟客户端应用程序。

是的，您可以编写一个以完全权限运行并以某种方式将数据传递到页面的浏览器插件。但是你仍然必须确保它安装在每台客户端机器上，现在你有两个非常不同的代码库需要维护。除非插件和/或网络应用程序仅在某些方面有用（插件充当通用输入驱动程序，或者应用程序仍然可以在不使用插件的情况下接受输入），你最终只会让你自己和你的用户的生活变得更加困难。

正如[gregmac 所提到](https://stackoverflow.com/questions/504730/accessing-hardware-from-within-internet-explorer/504778#504778)的，您甚至可能实际上*不需要*直接的硬件访问。先看看那个...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T20:36:27.650

[您可以使用 flash](http://www.adobe.com/devnet/flash/articles/webcam_motion_02.html)访问网络摄像头。我从未使用过磁卡阅读器，但大多数条码阅读器只是显示为键盘，并且由于它是一种类似的技术，因此也可以以这种方式配置读卡器。

我之前写过一个使用条形码阅读器的网络应用程序，当你专注于某些领域时，你只需简单地扫描它。Javascript 有助于处理，因此它捕获在数据末尾发送的 Enter 按键等。

当焦点位于允许扫描的任何字段上时，我还在角落出现了一个框，上面写着“准备扫描”。在我的例子中，它是一个库存应用程序，所以它包括数量和项目# 字段。

这里的一个巨大的好处是它可以在 IE 以外的浏览器中运行 - 这意味着您的应用程序的客户端部分的运行速度至少会快两倍（IE 是迄今为止最慢的主流浏览器）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-04-10T01:01:00.800

了解设备是否具有可以与之通信的内置 Web 服务器。一些指纹和读卡器提供了内置的 Web 服务器，您只需将命令发送到这些服务器，它们就会处理与设备的通信。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T21:00:22.610

此处提到了自定义 ActiveX，这是肯定的。如果您需要跨浏览器或跨平台支持，Java 小程序可能是更好的选择。

# c# - DirectX 或 OpenGL

> ID：504754
> 
> 赞同：9
> 
> 时间：2009-02-02T20:31:37.800
> 
> 标签：c#, .net, opengl, directx

如果您正在用 C# 编写下一个 3d 图形密集型应用程序（如 3d 建模和动画软件），哪个会是更好的选择？

如果我们将 C# 视为独立于平台的，那么 OpenGL 似乎很诱人，但性能等呢？

由于使用的语言是 C#，因此性能是非常重要的考虑因素。

编辑：您也可以考虑 SlimDX 和 TAO、OpenTK、csGL 等。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-02-02T21:02:19.003

我推荐 OpenGL 的原因如下：-

1.  跨平台 - 如今，OpenGLES 与移动平台特别相关
2.  OpenGL 着色语言实现本质上优于 DirectX 着色器。
3.  OpenGL 更容易学习，因为它可以用很少的代码行设置基本渲染
4.  从哲学上讲，OpenGL 被设计为通用渲染引擎，而 DirectX 始终面向游戏，因此 OpenGL 似乎更适合您的问题。
5.  OpenGL 是一种稳定的技术，已经存在了一段时间，并将继续存在。DirectX 更依赖于 Microsoft 的突发奇想，如果 MS 愿意，它可能会立即被弃用。

也就是说，您的系统要求和您的个人偏好可能会以任何一种方式提示它，因为这两种方法都是可靠的实现。不利的一面是 OpenGL 在很大程度上是一个状态机，很难适应 OO，尽管这当然不是不可能的。

编辑：添加以澄清我对 OpenGL 着色器模型本质上优于 DirectX 的评论。这是因为 DirectX 着色器是在开发时针对通用 GPU 模型与程序一起编译的，而 OpenGL 着色器作为源代码保存并在运行时由 OpenGL 驱动程序编译。因此，理论上驱动程序编写者可以利用 GPU 的特定（或在运行旧程序时更新）功能并创建运行速度比 DirectX 着色器更快的编译代码。这是一个小问题，但可能非常重要。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-02T20:40:00.937

Direct3D 和 OpenGL 之间的性能差异几乎为零。两者的特征集并没有一一对应，但很接近。OpenGL 的主要优点是跨平台支持。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-17T02:30:21.690

就图形子系统而言，托管代码的性能还不错。每次调用 DirectX 时，SlimDX 都会对完全本地代码支付轻微的惩罚，但这绝不是严重的。实际的惩罚取决于调用 - 调用 DrawPrimitive 将比调用 SetRenderState 更昂贵，因此按百分比计算，您最终会在 SetRenderState 调用上损失更多。SlimDX 包含一个经过调整的数学库，通常性能非常好，尽管您必须小心使用它。分析，即使使用像 NProf 这样的垃圾工具，也可以非常快速地突出显示这些内容，因此不难修复。

总体而言，如果我们考虑通过 D3D 进行渲染的通用、*完全优化*的 C++ 和 C# 代码，C# 版本可能在 C++ 版本的 10-15% 范围内。不过，这很难实现；考虑一下在 C# 中工作节省了多少时间，您可以将其应用于更高级别的图形优化，如果您必须用 C++ 构建整个事物，您可能根本没有时间进行这些优化。即使你设法在 C++ 中获得额外的 10%，它也会在几个月内迅速缩小到 5%，因为新一轮硬件比以往任何时候都更快地撕裂你的应用程序代码。我知道我会选择什么——这就是我开始编写 SlimDX 的原因。

OpenTK 具有类似的性能特征，但需要注意的是他们的数学库在某些地方相当慢。这是我与他们讨论过的一个实现错误，希望很快就会得到修复。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-02T20:42:00.683

OpenGL 过去在性能特性方面落后，但事情最终得到了解决。举个例子，考虑可绑定的制服，在 OpenGL 获得类似的机制之前，Direct3D 有一个更快的机制。除了有时支持不同的功能集外，没有什么区别。

因此，除非您打算使用最新的 GPU 功能，否则我建议您使用 OpenGL。可以肯定地说，OpenGL 在性能相关功能方面落后的领域并不多。

顺便说一句，C# 和 .NET 仅在您采取某些预防措施时才独立于平台。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-06-05T14:05:13.240

这是我对您的诚实建议：**两者都使用**。

## 建议

我会权衡哪一天有更多工具可用于完成程序，然后出于性能原因，我会利用另一个以确保在不同系统上的最大性能。

## 关于辩论的想法

让我们回顾一下：程序的性能取决于很多因素，主要是您的努力（应用程序的代码）和给定计算机上的驱动程序。图形 API 是您的应用程序与 GPU 通信的一种方式，因此您非常依赖于为已安装的 GPU 实现给定驱动程序的好坏程度。

## 我的选择

Direct3D 在某些显卡上有时比 OpenGL 更快，这是因为显卡供应商及其驱动程序。

DirectX 提供了大量工具来加速开发。我意识到一开始它的学习曲线非常陡峭，但请允许我提醒您，您恰好是一名程序员。我什至敢说一个很好的。

## 结论

因此，您必须能够奋力拼搏，*慢慢开发自己的框架，利用这两种 API，从而使您能够测试和实现*您想到的任何程序。

真挚地，

Mossa *Nova* Merhi

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-02T21:15:01.910

如果你不喜欢 XNA，你可以使用[SlimDX](http://code.google.com/p/slimdx/)。与 XNA 不同，SlimDX 支持 DirectX 10。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-02T21:19:54.973

使用 OpenGL，您可以在 Windows XP 和 Linux 上使用“DirectX 10 功能”，例如几何着色器。使用 GLUT 可以非常简单地在几分钟内启动并运行演示应用程序。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-02T21:22:47.497

我使用过 OpenGL 和 DirectX。我认为性能非常相似。我更喜欢 OpenGL 的编程模型——尤其是它对转换的处理，以及对拾取操作的直接支持。我不喜欢 MS 每次升级操作系统时都继续重新包装相同功能的方式，我认为 OpenGL 可以保护您免受这种情况的影响。

但是，两者都很古怪，您需要花费大量时间确保它与托管应用程序框架（无论是 Windows 还是其他东西）很好地交互。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-02T20:36:54.797

我觉得 OpenGL 不像 XNA 那样适合纯 OO 环境。也就是说，如果您真的关心跨平台兼容性，那么您的后端应该无关紧要。

将应用程序的业务逻辑设计为独立于渲染后端。您应该能够插入 OpenGL 渲染对象，然后将其换成 XNA 渲染器没问题。这不仅增加了您的潜在客户群（通过启用对两者的支持），而且使您的应用程序设计更好。

还有一点需要注意的是，DX 不应该在 .NET 中使用，因为托管 DirectX 已被弃用；使用 XNA。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-02T20:58:33.677

这取决于您打算定位的平台。

如果您只需要针对 Windows 使用 XNA

对于跨平台的工作，也许其他人已经使用单声道和 openGL 完成了一些工作 - 我假设您打算制作图形软件而不是游戏，因此拥有像 winForms 这样的框架对您的所有人都非常有帮助用户界面控件。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-02T21:24:30.330

您可能想要研究 IrrLicht 引擎，它同时具有 C++ 和 .Net API，并且完全与图形 API 无关（这意味着您可以使用相同的代码来执行 OpenGL 或 DirectX，程序员甚至不必知道您使用的是哪个正在使用）

您可能还想研究 SlimDX，它是 XNA 的一个非常快速、轻量级的开源替代品

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-04-17T02:37:15.030

DirectX 将在 Windows 上获得更好的视频驱动程序支持，因为它是 MSFT 用来认证卡的。我们发现，对于 Windows 上的廉价卡，OpenGL 支持缺乏、崩溃或完全错误。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-04-17T02:44:38.350

您可能想看看这个： [http ://groups.google.com/group/microsoft.public.win32.programmer.directx.managed/browse_thread/thread/1fc097147796e15b](http://groups.google.com/group/microsoft.public.win32.programmer.directx.managed/browse_thread/thread/1fc097147796e15b)

现在不支持托管 API，因此 OpenGL 可能是您最好的选择，除非您想使用 XNA。

根据您可能想要支持的其他平台，例如移动设备或 XBox360，这可能会帮助您决定使用哪个 api。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-09-22T15:32:45.787

就性能而言，两者实际上是相同的，您的代码和设计将是影响速度的主要因素。此外，这两个 API 都得到了很好的维护（与 5 年前 dx 遥遥领先相比）。

在这种情况下，一种选择是根据您的理念和每个 API 背后的理念进行选择。

有些可能需要商业重点；卖软件，倒钱，做生意。来自商业环境，金钱可以加快速度，**dx**可能非常适合这种情况，您可以在能力和开发工具等方面与微软达成有趣的交易。

另一方面，**OpenGL**是一个开放标准，这意味着人们可以讨论/评估并为改进标准 API 做出贡献，这将首先保证为社会造福。这更符合一种科学方法，其目标可能是发布研究、发布免费软件、建立社区并从世界各地的开发人员那里获得反馈，多平台。

它们是软件进化的不同观点，我认为两者都有自己的优势，我们仍然可以在两个来自非常不同的背景但做非常相似的事情的 API 之间进行选择，这是很好的。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-02T20:35:19.773

DirectX 有一个托管 API，可让您以“本机”C# 对象的形式访问 DirectX API。这对 OpenGL 来说是一个巨大的进步。

# javascript - 在客户端禁用 HTML 元素 (javascript)

> ID：504771
> 
> 赞同：5
> 
> 时间：2009-02-02T20:34:32.053
> 
> 标签：javascript, jquery, html

我正在寻找禁用整个 HTML 元素（通常是 a `<div>`）的最简单方法。

“禁用”是指一种阻止用户单击元素中包含的任何元素的方法。例如，如果您将表单放入禁用的元素中，则表单元素将无法获得焦点。我尝试过一种遍历 DOM 并禁用它找到的每个元素的方法。它有效，但似乎太复杂了，我正在寻找一种更简单的方法，比如`$("#mydiv").disable()`

我想防止用户触发其他事件，如 onmouseover 等，甚至避免用户使用键盘选择和修改元素。也许某种覆盖要禁用的整个元素的半透明覆盖可以解决问题。

这对 jQuery 是否可行，或者你知道用普通 JS 实现它的简单方法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T21:48:14.153

[jQuery 插件 BlockUI](http://malsup.com/jquery/block/)是实现这一目标的好方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T20:42:29.120

类似的东西：

```
$("#mydiv").find("input").attr('disabled','disabled'); 
```

这基本上找到`input`了 myDiv 元素中的所有元素，并禁用它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T20:40:33.820

这是 DOM 遍历的方法，但没那么复杂：

```
$('#mydiv').find('input').attr('disabled','true');
$('#mydiv *').unbind(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T20:46:19.877

禁用 div 之上的 div 怎么样？

```
<style>

    div.disableall { filter:alpha(opacity=25);-moz-opacity:.25;opacity:.25; background-color: black; height: 100%; width: 100%; position: absolute; top: 0px; left: 0px; z-index: 500; /* just preventing */ }

</style> 
```

并添加到要禁用的 div 中：

```
<script type="text/javascript">
    var disable = document.createElement("div");
    disable.className = 'disableall';
    document.getElementById('mydiv').appendChild(disable);
</script> 
```

我想这应该可行。

ps：您应该根据需要修复z-index

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-02T20:41:45.440

我很快想到的是使用半透明的 div 悬停在旧内容上方（使用诸如“ `position: relative`”和“ `top: -123px`”之类的 CSS 选项）或添加`READONLY`到您的表单和按钮中。

但是，无论您选择哪种方式，请记住这些更改只是客户端。JavaScript、HTML 和 CSS 都非常容易在运行时更改。所以，在服务器端也要为这些事情做好准备。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-02T20:55:43.463

您可以创建一个 div 来动态覆盖它 - 在原型中它会是这样的：

```
var el = new Element("div", {style: "position: absolute; z-index: 2"});
Element.insert(document.body, el);
Element.clonePosition(el, $("mydiv")); 
```

然后按照您希望将其禁用的样式进行设置。

但是，如果您对该区域中有哪些元素有一个很好的了解，那么禁用似乎是更好的选择 - 这可以防止键盘访问元素 - 使用 Tab 键并输入数据或使用返回键来激活它们。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-06-27T21:12:32.890

jQuery BlockUI 插件允许您在使用 AJAX 时模拟同步行为，而无需锁定浏览器 [1]。激活后，它将阻止用户对页面（或页面的一部分）进行活动，直到它被停用。BlockUI 将元素添加到 DOM 以使其具有阻止用户交互的外观和行为。

[http://malsup.com/jquery/block/](http://malsup.com/jquery/block/)

# .net - 我应该为这个字符串数据使用什么类型的 OO 数据结构？

> ID：504773
> 
> 赞同：0
> 
> 时间：2009-02-02T20:35:28.417
> 
> 标签：.net, oop, serialization, data-structures

假设我的程序总是传递一个字符串，表示 Wiki 语法中的数据表。就像是：

```
 {||Client:||ABC|-|Contact:||Joe Smith|-|Current revision:||1.0||} 
```

我不希望我的每个特定 Wiki 表对象（例如，ClientContactTable、CustomerOrderTable 等）都知道如何解析出 | 和 - 和}。因此，我想编写 1 块代码，将字符串解析为一些“中间”层数据对象，我可以将其传递给每个特定 Wiki 表对象的构造函数。

**我的问题是：**中间层对象应该是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T20:41:54.520

您想要实现[`System.Runtime.IFormatter`](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.iformatter.aspx)创建一个通用的 WikiTable 序列化格式化程序。为了帮助您解决这个问题，您可以从[`System.Runtime.Formatter`](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.formatter.aspx)基类继承。

一旦你这样做了，你会像这样使用它：

```
Stream msg = GetWikiClientContactTableMessage();
WikiTableFormatter wtf = new WikiTableFormatter(); // nice name ;)
ClientContactTable result = (ClientContactTable)wtf.Deserialize(msg); 
```

此外，如果您更像 XmlSerializer 并让调用者将预期的输出类型传递给构造函数，则此代码可能会更容易编写。然后，如果需要，您可以使用反射来获取您期望的属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T20:38:35.383

我会使用从字符串到字符串的映射。

这不是特别 OO，但它会完成这项工作，除非有一些我不知道的工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T20:38:41.563

我会使用字典或哈希表。

[http://msdn.microsoft.com/en-us/library/xfhwa508.aspx](http://msdn.microsoft.com/en-us/library/xfhwa508.aspx)

如果 msdn 文档难以阅读（一直是为我准备的），我将简要介绍一下。基本上，字典将一个对象（字符串？）作为键，将另一个对象作为数据。

```
Dictionary<string,string> d = new Dictionary<string,string>();
d["key1"] = "value";
d["anotherkey"] = "anothervalue"; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T22:22:33.083

正如其他人所说，如果您希望名字充当键，请使用关联映射（字符串->字符串）。那应该是最干净的方法；这意味着您的解析代码可以包含大量输入检查和错误处理，否则这些输入检查和错误处理会为每个对象类重复。

如果您绝对必须包含多个具有相同名称的条目（例如，同一客户的多个联系人），您可以回退到 (string,string) 对的列表。

# c++ - WinAPI 和 UTF-8 支持

> ID：504779
> 
> 赞同：9
> 
> 时间：2009-02-02T20:36:27.760
> 
> 标签：c++, winapi, mfc, localization, utf-8

关于 UTF-8 支持和各种 Win32 API 的快速问题。

在典型的 C++ MFC 项目中，MessageBox() 是否可以显示 UTF-8 编码的字符串？

谢谢，安德鲁

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-02T20:39:25.227

快速回答：没有。

更长的答案：如果字符串只包含常规的 ANSI 字符，例如美国英语，它将起作用，因为这些字符代码在 UTF-8 和 ANSI 中是相同的。

如果包含非 ANSI 字符或任何双字节编码字符，则需要使用 MultiByteToWideChar 和 CP_UTF8 转换为 Unicode-16。您的程序还需要使用定义的 UNICODE 进行编译，或者您可以使用“W”API 调用 - 例如 MessageBoxW。

（请注意，采用文本参数的函数，如 MessageBox、CreateWindow 映射到“A”或“W”版本，具体取决于是否定义了 UNICODE）。

这也可能有用；

[http://www.joelonsoftware.com/articles/Unicode.html](http://www.joelonsoftware.com/articles/Unicode.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-02T20:43:04.487

不，将[MultiByteToWideChar](http://msdn.microsoft.com/en-us/library/dd319072(VS.85).aspx)与`CP_UTF8`. 为什么A做不到，见[http://www.siao2.com/2006/10/11/816996.aspx ；](http://www.siao2.com/2006/10/11/816996.aspx)W (UCS-2) 是唯一的选择。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-02T22:29:17.860

我使用 ATL/MFC 字符串转换宏。例如，如果您有一个名为`myUTF8Str`包含 UTF8 字符的 ASCII 字符串：

```
::MessageBox(hWnd, CA2T(myUTF8Str, CP_UTF8), _T("Caption"), MB_OK); 
```

或者，您可以创建字符串的实例，例如：

```
CA2T myConvertedString(myUTF8Str, CP_UTF8);
...
TRACE(_T("Converted: %s\n"), myUTF8Str.m_psz); 
```

请注意`m_psz`允许对原始字符串指针进行只读访问的成员。

您还可以使用 进行编码`CT2A`，例如：

```
CT2A myEncodedString("Some UTF8", CP_UTF8); 
```

如果不使用 TEXT 宏，则使用 CA2W、CW2A 等。

# .net - 我应该从客户端删除子对象，还是通过存储过程

> ID：504788
> 
> 赞同：1
> 
> 时间：2009-02-02T20:38:54.667
> 
> 标签：.net, sql

我正在处理数据层的两个部分。我开始创建过程，以及将使用过程的业务对象层。

是否有确定应在何处进行删除的最佳实践？

这是场景。我有一个带有子表页面外键的表书。如果我删除这本书，我也想删除这些页面。如果删除页面失败，我希望整本书留下（事务）。

删除应该发生在托管代码中（通过创建事务，删除所有子对象，最后是书）还是在过程中（再次在事务中）？

还是有关系？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T20:42:42.583

那么有3种方法：

1.  使用 TransactionScope 在应用程序中执行此操作
2.  在过程中做
3.  在 PK-FK 关系上创建级联删除。

根据您的 DAL 的外观，您必须做出选择。如果是 ORM，则选择 1。否则选择 3。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T20:47:52.887

我会说这取决于您将数据的“逻辑”存储在哪里。

1）如果您的存储过程大多是带有简单插入/更新/删除的“愚蠢”存储过程。我会将删除项放在数据层对象中，您将在其中拥有更复杂的代码。

2）如果您编写了许多复杂的存储过程，则需要检查业务规则。将逻辑全部保留在 SP 中，并使数据层保持简单。

真的是你想要复杂性所在的地方。不要在对象和 SP 中设置太多规则，否则维护将是一个婊子。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T20:43:12.100

称我为老式的，但我总是让数据库做数据库的工作；让它负责删除并将一个值返回给调用代码，以指示操作成功或失败。

我知道 ADO.NET 在管理 SQL 操作方面做得很好，但我通常将其限制为配置连接、添加参数然后运行存储过程。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T20:43:40.600

我的偏好是从托管代码中执行子删除。如果从此处完成，则更容易确保所有删除都以相同的方式执行，并且它为其他开发人员提供了一个容易的地方来了解该实体的工作原理。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T21:05:33.490

如果在删除主对象时应该始终删除子对象，那么最好的地方是在数据库中。没有通过 GUI 完成的导入或查询可能会发生变化。想想如果你需要从一个停业的出版商那里删除所有的书会发生什么。没有人会通过 GUI 一次完成一项。因此，如果级联删除是您数据库中的一个选项，请设置它。如果不是通过触发器进行。

不过，在执行此操作之前，请非常确定您要删除子对象。您会丢失所需的历史数据吗？通常将父记录标记为非活动比删除它更好。这样您就不会丢失图书订单的历史记录，因为您在图书不再可用时删除了所有子记录。如果您的系统涉及订购、仓储或财务系统或任何其他系统，其中子表将保存具有日期历史的记录并且可能需要在报告中或在研究客户电话时调用，您几乎永远不想删除记录.

# c - ffmpeg av_seek_frame

> ID：504792
> 
> 赞同：18
> 
> 时间：2009-02-02T20:39:48.003
> 
> 标签：c, ffmpeg

我正在尝试使用 ffmpeg 的 av_seek_frame 方法在电影中搜索，但是我在确定如何生成要搜索的时间戳时遇到了最大的麻烦。假设我想向前或向后寻找 x 帧，并且我知道电影当前在哪个帧上，我将如何去做？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2012-01-05T07:59:32.080

我是这样做的：

```
// Duration of one frame in AV_TIME_BASE units
int64_t timeBase;

void open(const char* fpath){
    ...
    timeBase = (int64_t(pCodecCtx->time_base.num) * AV_TIME_BASE) / int64_t(pCodecCtx->time_base.den);
    ...
}

bool seek(int frameIndex){

    if(!pFormatCtx)
        return false;

    int64_t seekTarget = int64_t(frameIndex) * timeBase;

    if(av_seek_frame(pFormatCtx, -1, seekTarget, AVSEEK_FLAG_ANY) < 0)
        mexErrMsgTxt("av_seek_frame failed.");

} 
```

AVSEEK_FLAG_ANY 可以搜索每一帧，而不仅仅是关键帧。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-09T19:58:22.377

简单的回答：你应该有一个 AVFormatContext 对象。它的`duration`属性告诉你你的文件有多长，时间戳乘以 1000 可以在 av_seek_frame 中使用，因此将其视为 100%。然后，您可以计算要搜索的视频的深度。

如果你想前进一帧，只需调用 av_read_frame 和 avcodec_decode_video 直到它用非零值填充 got_picture_ptr。在调用 avcodec_decode_video 之前，请确保来自 av_read_frame 的数据包来自视频流。然后 avcodec_decode_video 将填充 AVFrame 结构，您可以使用它来做任何事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-03-21T04:18:29.383

不确定这是否超级准确，但以下内容非常简单并且似乎有效：

```
int n_seconds = 10; // seek forward 10 seconds
// time_base is in seconds, eg. the time base may be 1/1000th of a second,
// so just multiply by the reciprocal (den = denominator, num = numerator)
int64_t ts = av_rescale(
    n_seconds,
    format_ctx->streams[video_stream_index]->time_base.den,
    format_ctx->streams[video_stream_index]->time_base.num
);
// even though it mentions in docs that you shouldn't use this because it is a
// work in progress, it's been around for more than a decade now, ffplay/ffmpeg/ffprobe
// all use it...it is the most consistent and easiest to use. the way I am using
// it here is to seek to the nearest keyframe (not frame!). I would not recommend
// using it in any other way:
// eg. AVSEEK_FLAG_ANY/FRAME/BACKWARD (BACKWARD is ignored anyways)
// 0 as flag seeks to keyframes only. I have set the max timestamp to the same value so
// that we only look for nearest keyframes behind us
int err = avformat_seek_file(pFormatContext, video_stream_index, 0, ts, ts, 0); 
```

这寻求最近的关键帧！这可能离你想要的很远。但是，它只会落后于目标时间戳，因此您可以`av_read_frame`直到到达您想要的位置，使用`AVframe->pts`*`AVStream->timebase`来计算帧的时间（用于`av_rescale`执行此操作）。

另请注意，如果您需要向后搜索（即您已经阅读过的帧后面的帧`av_read_frame`），或者您将`av_read_frame`在一个帧上多次调用，您必须分别使用`avcodec_send_packet`和发送/接收数据包/帧`avcodec_receive_frame`，否则编解码器上下文将不同步（我认为这是问题所在？）。您不能只是空白地读取数据包。您还应该`avcodec_flush_buffers`在寻找到您正在阅读的位置后面的新位置之后（您可能应该在每次寻找时都调用它，但我不确定性能）。

文档参考：

[int avformat_seek_file (..., int stream_index, int64_t min_ts, int64_t ts, int64_t max_ts, int flags)](https://ffmpeg.org/doxygen/2.8/group__lavf__decoding.html#ga3b40fc8d2fda6992ae6ea2567d71ba30)

# javascript - 如何在 JavaScript 中为自定义对象创建方法？

> ID：504803
> 
> 赞同：50
> 
> 时间：2009-02-02T20:42:36.687
> 
> 标签：javascript, object, methods

是不是像...

```
var obj = new Object();

obj.function1 = function(){
    //code
} 
```

或类似的东西？

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2009-02-02T21:04:12.073

您可以从已经获得的答案中看到，方法不止一种。

```
#1
var o = new Object();
o.method = function(){}

#2
var o = new Object();
o.prototype.method = function(){}

#3
function myObject() {
    this.method = function(){}
}
var o = new myObject();

#4
function myObject() {}
myObject.prototype.method = function(){}
var o = new myObject();

#5
var o = {
    method: function(){}
} 
```

#3 和 #4 使用构造函数。这意味着您可以使用它们来创建相同“类”的多个对象（类在 JavaScript 中并不真正存在）

#4 与 #3 不同，因为使用 #4 构造的所有对象都将共享相同的“方法”方法，因为它是其原型的属性。这节省了内存（但只节省了非常少的内存），如果您更改原型的方法，所有#4 对象将立即更新 - 即使它们已经被实例化。

#1、#2 和 #5 几乎是等价的。这是因为一次可能只有其中一个，所以 #2 将方法添加到原型中这一事实并不重要。（不考虑克隆）

还有更多方法可以使用带闭包的工厂向对象添加方法，或者向函数或私有嵌套函数添加“静态”属性/方法...... :)

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2009-02-02T20:45:47.540

```
var newObj = {
    met1 : function () {
        alert('hello');
    }
}; 
```

然后，可以像这样调用该方法：

```
newObj.met1(); 
```

顺便说一句，在声明一个新对象时，使用对象字面量 ( `{}`)，而不是`new Object()`构造函数。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-02-02T20:44:43.640

一般使用[原型](http://www.w3schools.com/jsref/jsref_prototype_math.asp)属性：

```
function YourObject()
{
    //
}

YourObject.prototype.yourMethod= function()
{
   //
} 
```

我还没有看到任何人提到的一件事是为什么你可能想要使用`prototype`属性而不是对象文字表示法：这样做可以确保函数定义在从你的函数原型创建的对象的所有实例之间共享，而不是每次实例化一次。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-10-15T13:23:52.487

别着急，代码如下：

```
 var myObj=function(){
      var value=null

     this.setValue=function(strValue){

     this.value=strValue;
     };

     this.getValue=function(){
     return this.value;
     };    
}; 
```

你可以这样调用这个对象：

```
 var obj= new myObj();
    obj.setValue("Hi!");
    alert(obj.getValue()); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-02-08T09:46:33.010

```
 Function.prototype.implement = function(member, value) {
   this[member] = value;
   return this;
}

function MyFunction() {
 //...
}

(function($){

 $.implement("a", "blabla")
 .implement("b", function(){ /* some function */ })
 .implement("c" {a:'', b:''});

})(MyFunction); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-12-01T12:30:13.037

使用[es6](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/Method_definitions)，您可以这样做：

```
var a = {
    func(){
        return 'The value';
    }
}

document.getElementById('out').innerHTML = a.func(); 
```

```
<div id="out"></div>
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-05-26T00:10:59.700

您还可以执行以下操作，而不是使用“Object.create()”方法。

函数调用：

```
com.blah.MyChildObj.prototype = createObject(com.blah.MyParentObj.prototype, 
    com.blah.MyChildObj); 
```

函数定义：

```
function createObject(theProto, theConst) {
    function x() {};
    x.prototype = theProto;
    x.prototype.constructor = theConst;
    return new x();
} 
```

# ajax - jQuery 效果多个元素

> ID：504806
> 
> 赞同：1
> 
> 时间：2009-02-02T20:43:05.330
> 
> 标签：ajax, jquery

试图用一个来击中两个元素，`load()`但在我尝试的过程中没有成功。这就是我现在必须刷新页面上的一个部分，它工作正常。

```
$('#refreshme_'+request).load("http://www.example.com/add_list/"); 
```

我试过这个

```
$('#refreshme_'+request, .xPlanner).load("http://www.example.com/add_list/"); 
```

这根本不起作用。想让我的代码高效，需要一次调用刷新 2 个 DOM。有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T20:59:02.050

```
var request = "foo";
$("#refreshme_" + request + ", .xPlanner").load("http://www.example.com/add_list/"); 
```

和

```
<div id="#refreshme_foo">Lorem</div>
<div class="xPlanner">Ipsum</div> 
```

作品。这是你想要做的吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T20:59:28.370

我想知道你是否不能使用类似的东西：

```
$.get("http://www.example.com/add_list/", function(data) {
    $('#refreshme_'+request).html(data);
    // same for second
}); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T21:06:35.860

您将要使用 .get 代替：

```
 $.get("http://www.example.com/add_list/", function(data) {
        $("#refreshme1").html(data);
        $("#refreshme2").html(data);
    }); 
```

这是伪的，但你明白了。

# c - 如何在 C 中找到当前机器的完整主机名（主机名和域信息）？

> ID：504810
> 
> 赞同：37
> 
> 时间：2009-02-02T20:44:11.067
> 
> 标签：c, sockets, posix, environment

在 C 项目 (POSIX) 中，如何获取当前系统的完全限定名称？

例如，我可以通过 `gethostname()`从 unistd.h 获取我机器的主机名。这可能会给我`machine3`回报，但我实际上正在寻找`machine3.somedomain.com`例如。

我该如何获取这些信息？如果可能的话，我不想使用对 system() 的调用来执行此操作。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-02-03T00:08:17.007

要获得机器的完全限定名称，我们必须首先获得本地主机名，然后查找规范名称。

最简单的方法是首先使用`uname()`or获取本地主机名`gethostname()`，然后执行查找`gethostbyname()`并查看`h_name`它返回的结构的成员。如果您使用的是 ANSI c，则*必须*使用`uname()`.`gethostname()`

例子：

```
char hostname[1024];
hostname[1023] = '\0';
gethostname(hostname, 1023);
printf("Hostname: %s\n", hostname);
struct hostent* h;
h = gethostbyname(hostname);
printf("h_name: %s\n", h->h_name); 
```

不幸的是，`gethostbyname()`在当前的 POSIX 规范中已弃用，因为它不能很好地与 IPv6 配合使用。此代码的更现代版本将使用`getaddrinfo()`.

例子：

```
struct addrinfo hints, *info, *p;
int gai_result;

char hostname[1024];
hostname[1023] = '\0';
gethostname(hostname, 1023);

memset(&hints, 0, sizeof hints);
hints.ai_family = AF_UNSPEC; /*either IPV4 or IPV6*/
hints.ai_socktype = SOCK_STREAM;
hints.ai_flags = AI_CANONNAME;

if ((gai_result = getaddrinfo(hostname, "http", &hints, &info)) != 0) {
    fprintf(stderr, "getaddrinfo: %s\n", gai_strerror(gai_result));
    exit(1);
}

for(p = info; p != NULL; p = p->ai_next) {
    printf("hostname: %s\n", p->ai_canonname);
}

freeaddrinfo(info); 
```

当然，这只有在机器有一个 FQDN 可以提供的情况下才有效 - 如果没有，最终的结果`getaddrinfo()`与不合格的主机名相同。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2011-11-25T10:50:37.040

我的解决方案：

```
#ifdef WIN32
    #include <Windows.h>
    #include <tchar.h>
#else
    #include <unistd.h>
#endif

void GetMachineName(char machineName[150])
{
    char Name[150];
    int i=0;

    #ifdef WIN32
        TCHAR infoBuf[150];
        DWORD bufCharCount = 150;
        memset(Name, 0, 150);
        if( GetComputerName( infoBuf, &bufCharCount ) )
        {
            for(i=0; i<150; i++)
            {
                Name[i] = infoBuf[i];
            }
        }
        else
        {
            strcpy(Name, "Unknown_Host_Name");
        }
    #else
        memset(Name, 0, 150);
        gethostname(Name, 150);
    #endif
    strncpy(machineName,Name, 150);
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T21:17:58.190

`gethostname()`是获取本地主机名的 POSIX 方式。退房`man`。

BSD 功能`getdomainname()`可以为您提供域名，因此您可以构建完全限定的主机名。恐怕没有 POSIX 方法来获取域。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T20:50:34.720

我相信您正在寻找：

[通过地址获取主机](http://www.opengroup.org/onlinepubs/009695399/functions/gethostbyaddr.html)

只需将 localhost IP 传递给它。

还有一个 gethostbyname 函数，也很有用。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-02T20:49:36.127

最简单的方法，试试 uname()

如果这不起作用，请使用 gethostname() 然后 gethostbyname() 最后 gethostbyaddr()

hostent{} 的 h_name 应该是您的 FQDN

# c# - 如何判断拖放操作是否失败？

> ID：504814
> 
> 赞同：6
> 
> 时间：2009-02-02T20:45:20.240
> 
> 标签：c#, wpf, drag-and-drop

在我看来，没有办法检测拖动操作是否成功，但必须有某种方法。假设我想执行从源到目的地的“移动”。如果用户将鼠标悬停在无法接受放置的某些应用或控件上，我怎么知道？

就此而言，我怎么知道拖动何时完成？

我看到了[这个问题](https://stackoverflow.com/questions/480156/how-do-i-tell-if-a-drag-drop-has-ended-in-winforms)，但他的解决方案对我不起作用，*而且*`e.Action`总是。 *`Continue`*

 ** * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-02T21:00:15.950

我不确定这是否可以帮助您，但 DoDragDrop 方法返回最终的 DragDropEffects 值。

```
var ret = DoDragDrop( ... );
if(ret == DragDropEffects.None) //not successfull
else // etc. 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-02T21:03:10.390

啊，我想我明白了。原来对 DoDragDrop 的调用实际上是*同步*的（多么蹩脚），并返回一个值，如果操作失败`DragDropEffects`，则设置为。`None`所以基本上这意味着只要用户处于拖动过程中，应用程序（或至少 UI 线程）就会被冻结。这对我来说似乎不是一个非常优雅的解决方案。

好的 cz_dl 我看到你刚刚发布了那件事，所以我会给你答案。

不过我不明白：目的地如何确定操作应该是移动还是副本？这不应该取决于源应用程序吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T23:08:46.750

无法添加评论，所以另一个答案。当我第一次看到 DoDragDrop 被同步调用时，我也很惊讶，它并没有冻结 UI。

但是我认为复制/移动的东西是完全合乎逻辑的。您可以在源应用程序中调用 DoDragDrop 方法时指定允许的效果，这对您来说很重要。目标应用程序将如何处理和使用它所决定的数据。

# cocoa-touch - 石英绘图优化

> ID：504817
> 
> 赞同：0
> 
> 时间：2009-02-02T20:45:52.297
> 
> 标签：cocoa-touch, optimization, quartz-graphics

我有一个视图，它有一个背景图像，并且`CGPath`随着用户触摸屏幕而改变。绘制图像`CGContextDrawImage()`然后在顶部绘制路径不够快，并且会阻碍触摸事件的性能。我想要的是有一个位图缓冲区，并且只绘制路径中的更改。因此，视图`drawRect()`将只是绘制缓冲区。我怀疑我需要使用`CGContext`s 但我不知道该怎么做。有没有其他优化方法？

*编辑：*

每次用户触摸屏幕时，我都会添加路径；所以“路径变化”是指向现有路径添加更多点。这就是为什么我认为我可以只缓冲图像并只绘制路径的“增量”而不是每次都绘制整个东西。目前我的绘图和事件逻辑是这样的：

```
-(void)drawRect{
    //Draw the background image
    //Draw the whole path
}

-(void)touchesMoved{
    //Add the touch point to the path
    [self setNeedsDisplay];
} 
```

以这种方式绘制背景会使触摸事件采样的性能明显低于仅绘制路径。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T22:48:17.760

如果背景图像没有改变（我无法确定是否改变），那么您应该将背景图像放在不同的 CoreAnimation 层中，该层包含其顶部的路径。这让 GPU 可以处理合成，而不是在您的 -drawRect 中完成所有操作。然后可以在可能的情况下缓存背景图像，您唯一需要更新的就是路径（您仍然可以避免在每一帧中完全重绘）。您还可以执行缩放或旋转路径等操作，而不必担心对背景图像的影响。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T22:10:14.280

实际上，这几乎就是它的工作方式。传递给 drawRect 的上下文绘制到 CALayer 中，该 CALayer 被缓冲，直到您执行需要视图重绘自身的操作。您提到“当用户触摸屏幕”时路径会更改 - 然后您是否在视图上设置 setNeedsDisplay ？

如果你真的每次都有不同的路径，那么你将无法缓冲它。如果它是相同的，只要你没有调用 setNeedsDisplay，或者会影响它被调用的东西，那么支持你的视图的层应该被缓冲。我在图层中有很多这样的视图，所有这些都有很多花哨的 CG 东西（绘制和填充路径、剪切图像、着色等），并且性能非常好。

如果您有不同的路径（可能在视觉上表示触摸） - 您可能想考虑使用替代视图 - 它们本身不会改变 - 或者可能在单个预渲染视图上使用视图动画？

如果这些都没有达到目标，请发布更多信息以帮助我们了解您要执行的操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T23:19:49.007

我不是 100% 肯定它在 iPhone 上以这种方式工作，但在等效的 Mac OS X 类上，setNeedsDisplay: 是有效同步的，因此昂贵的绘图操作会破坏循环的性能。尝试将绘图代码放在每秒执行几次的计时器上，而不是在事件处理代码中显式调用它。

有关更多信息，请参阅[此 CocoaBuilder 线程](http://www.cocoabuilder.com/archive/message/cocoa/2008/12/20/225963)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-05T14:18:03.777

从您的编辑看来，您正在做某种绘图应用程序。

在那种情况下，我会尝试“未知”的建议（将背景图像放在与路径不同的图层/视图中）。事实上，无论如何我都会这样做。你在使用 CGPath 吗？如果不是，它可能也值得这样做。

如果您*仍然*遇到问题，可能值得将当前的“编辑”（快速连续绘制的任何线条）分离到它们自己的路径（在它们自己的图层/视图中），并在合适的之后将它们添加到主路径空闲时间（使用计时器）。

# php - PHP 类中的作用域

> ID：504820
> 
> 赞同：1
> 
> 时间：2009-02-02T20:46:18.787
> 
> 标签：php, database, connection, scope

我正在创建一个数据库连接对象，但我不确定最好的方法是什么......

如果我创建一个建立连接的 dbConnection 类（使用 mysql_connect），我可以从主脚本中的任何位置调用 mysql_query 吗？

从其他类里面呢？我需要将对象或属性作为参数传递吗？

基本上，我正在寻找使用简单类一次连接到数据库的最佳方式（在速度+内存方面）......

我已经发布了数据库连接类的构造函数：

```
function __construct($database="") {
if (!empty($database)){ $this->db = $database; }
$this->dblink = mysql_connect($this->host,$this->username,$this->password);
if (!this->dblink) {
    //Fatal Error
}
mysql_select_db($this->db, $this->dblink); 
```

}

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T20:50:42.613

我建议不要创建自己的数据库抽象类，而是尝试使用[ezSQL](http://www.woyano.com/jv/ezsql)。作者在使它非常易于使用方面做得非常出色。类完成的查询返回的数据结构比 mysql_query 返回的数据结构灵活得多，它会为您节省大量工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T21:09:16.213

您快到了。我的数据库类是这样的：

```
class DB {
  function __construct($host,$user,$pass,$db) {
    // error checking has been removed for brevity
    $this->mysql = mysql_connect($host,$user,$pass);
    mysql_select_db($this->mysql, $db);
  }
  function fetchRows($query) {
    // error checking removed again
    $result = mysql_query($this->mysql);
    $return = array();
    while($data = mysql_fetch_assoc($result))
      $return[] = $data;
    mysql_free_result($result);
    return $return;
  }
} 
```

在我的主要包含文件中，我有这样的东西：

```
require 'DB.inc.php';
$GLOBALS['DB'] = new DB('localhost', 'root', '', 'my_database'); 
```

然后在我项目的任何部分，我都可以运行这样的查询：

```
global $DB;
$query = 'SELECT UserID, UserName FROM users';
foreach($DB->fetchRows($query) as $user)
    echo "$user[UserID]: $user[UserName]\n"; 
```

**注意：**不建议使用 mysql_pconnect()，请参阅[手册页](http://www.php.net/mysql_pconnect)用户评论，原因有一些。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T21:11:31.997

当您要执行查询时，应将连接对象作为参数传递给查询函数。您需要在要运行查询的任何地方访问连接对象。

```
require_once DBConnection;
require_once SomeClass;

$con = new DBConnection();
$query = "Select * FROM Users";
mysql_query($query, $con->link);

// Use the connection in another class that takes a connection object in the constructor
$someclass = new SomeClass($con);
$someclass->executeQueryThree(); 
```

但是，我更倾向于在 DBConnection 类中使用 mysql_query 作为方法，如下所示：

公共函数查询($query) { $result = mysql_query($query, $this->link); 返回$结果；}

然后执行以下操作：

```
$query = "Select * FROM Users";
$con = new DBConnection();
$result = $con->query($query);

// From within SomeClass
$someclass = new SomeClass();
$result = $con->query($someclass->getQuery3()); 
```

# performance - 有没有人真正有效地实现了斐波那契堆？

> ID：504823
> 
> 赞同：155
> 
> 时间：2009-02-02T20:46:38.347
> 
> 标签：performance, algorithm, language-agnostic, data-structures, fibonacci-heap

你们有没有人实现过[Fibonacci-Heap](http://en.wikipedia.org/wiki/Fibonacci_heap)？几年前我就这样做了，但它比使用基于数组的 BinHeaps 慢了几个数量级。

那时，我认为这是一个宝贵的教训，说明研究并不总是像它声称的那样好。然而，许多研究论文声称他们的算法的运行时间基于使用斐波那契堆。

你有没有设法产生一个有效的实施？或者您是否使用过大到斐波那契堆效率更高的数据集？如果是这样，一些细节将不胜感激。

* * *

## 回答 #1

> 赞同：140
> 
> 时间：2009-02-03T18:02:09.227

~~Boost [C++ 库](http://www.boost.org/)在`boost/pending/fibonacci_heap.hpp`. 该文件显然已经存在`pending/`多年，根据我的预测将永远不会被接受。此外，该实现中存在错误，这些错误已由我的熟人和全能酷家伙 Aaron Windsor 修复。不幸的是，我可以在网上找到的该文件的大多数版本（以及 Ubuntu 的 libboost-dev 包中的那个）仍然存在错误。我不得不从 Subversion 存储库中提取[一个干净的版本。](http://svn.boost.org/svn/boost/trunk/boost/pending/fibonacci_heap.hpp)~~

自[1.49版以来，](http://www.boost.org/doc/libs/1_49_0/doc/html/heap.html) [Boost C++ 库](http://www.boost.org/)添加了许多新的堆结构，包括斐波那契堆。

我能够针对 dijkstra_shortest_paths.hpp 的修改版本编译[dijkstra_heap_performance.cpp](http://svn.boost.org/svn/boost/trunk/boost/graph/dijkstra_shortest_paths.hpp)以[比较](http://svn.boost.org/svn/boost/trunk/libs/graph/test/dijkstra_heap_performance.cpp)斐波那契堆和二进制堆。（在 行中，更改为。）我首先忘记使用优化进行编译，在这种情况下，斐波那契堆和二进制堆的性能大致相同，而斐波那契堆的性能通常微不足道。在我用非常强大的优化编译后，二进制堆得到了巨大的提升。在我的测试中，斐波那契堆仅在图形非常大且密集时才优于二进制堆，例如：`typedef relaxed_heap<Vertex, IndirectCmp, IndexMap> MutableQueue``relaxed``fibonacci`

```
Generating graph...10000 vertices, 20000000 edges.
Running Dijkstra's with binary heap...1.46 seconds.
Running Dijkstra's with Fibonacci heap...1.31 seconds.
Speedup = 1.1145. 
```

据我了解，这涉及到斐波那契堆和二进制堆之间的根本区别。两种数据结构之间唯一真正的理论区别是斐波那契堆在（摊销的）恒定时间内支持递减键。另一方面，二叉堆从它们作为数组的实现中获得了很大的性能。使用显式指针结构意味着斐波那契堆会遭受巨大的性能打击。

*因此，要在实践中*从斐波那契堆中受益，您必须在减少键非常频繁的应用程序中使用它们。就 Dijkstra 而言，这意味着底层图是密集的。一些应用程序可能本质上是减少键强度；我想尝试[Nagomochi-Ibaraki 最小切割算法](http://www.cs.amherst.edu/ccm/challenge5/p_queue/index.html)，因为它显然会生成很多 reduce_keys，但要让时序比较工作起来太费劲了。

*警告*：我可能做错了什么。您可能希望尝试自己重现这些结果。

*理论说明*：在 reduction_key 上改进的斐波那契堆性能对于理论应用很重要，例如 Dijkstra 的运行时。斐波那契堆在插入和合并方面也优于二叉堆（斐波那契堆的摊销常数时间）。插入本质上是无关紧要的，因为它不会影响 Dijkstra 的运行时，并且修改二进制堆以在摊销的常数时间内也具有插入是相当容易的。在恒定时间内合并非常棒，但与此应用程序无关。

*个人笔记*：我和我的一个朋友曾经写过一篇论文，解释了一个新的优先级队列，它试图在没有复杂性的情况下复制斐波那契堆的（理论）运行时间。这篇论文从未发表过，但我的合著者确实实现了二进制堆、斐波那契堆和我们自己的优先级队列来比较数据结构。实验结果的图表表明，斐波那契堆在总比较方面略胜二叉堆，这表明斐波那契堆在比较成本超过开销的情况下表现更好。不幸的是，我没有可用的代码，并且可能在您的情况下比较便宜，所以这些评论是相关的，但不直接适用。

顺便说一句，我强烈建议尝试将斐波那契堆的运行时间与您自己的数据结构相匹配。我发现我只是自己重新发明了斐波那契堆。之前我认为斐波那契堆的所有复杂性都是一些随机的想法，但后来我意识到它们都是自然而然的。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-04-19T04:46:04.937

[早在 1993 年，Knuth 就在他的著作Stanford Graphbase](http://www-cs-faculty.stanford.edu/~knuth/sgb.html)中比较了斐波那契堆和二叉堆的最小生成树。他发现斐波那契在他正在测试的图形大小下比二叉堆慢 30% 到 60%，不同密度的 128 个顶点。

[源代码](ftp://ftp.cs.stanford.edu/pub/sgb/sgb.tar.gz)位于 MILES_SPAN 部分中 的C（或者更确切地说是 CWEB，它是 C、数学和 TeX 的交叉）中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-11-11T21:19:05.963

**免责声明**

我知道结果非常相似，并且“看起来运行时间完全由堆以外的东西控制”（@Alpedar）。但我在代码中找不到任何证据。它的代码是开放的，所以如果你能找到任何可能影响测试结果的东西，请告诉我。

* * *

也许我做错了什么，但我[写了一个测试](https://github.com/guitcastro/dijkstra-heaps-test)，基于[A.Rex](https://stackoverflow.com/a/508221/1107651) anwser 比较：

*   斐波那契堆
*   D-Ary 堆 (4)
*   二叉堆
*   松弛堆

所有堆的执行时间（仅适用于完整图）非常接近。测试是针对具有 1000、2000、3000、4000、5000、6000、7000 和 8000 个顶点的完整图进行的。对于每个测试，生成 50 个随机图，输出是每个堆的平均时间：

对输出感到抱歉，它不是很冗长，因为我需要它来从文本文件构建一些图表。

* * *

以下是结果（以秒为单位）：

![堆结果表](https://i.stack.imgur.com/Gsd05.png)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-02-15T18:50:34.243

我还用斐波那契堆做了一个小实验。这是详细信息的链接：[Experimenting-with-dijkstras-algorithm](https://gabormakrai.wordpress.com/2015/02/11/experimenting-with-dijkstras-algorithm/)。我刚刚搜索了术语“Fibonacci heap java”，并尝试了一些现有的 Fibonacci heap 的开源实现。似乎其中一些有一些性能问题，但也有一些相当不错。至少，它们在我的测试中击败了幼稚的二进制堆 PQ 性能。也许他们可以帮助实施有效的。

# sql-server - 如何使 SQL 数据库中的日志尽可能小？

> ID：504833
> 
> 赞同：1
> 
> 时间：2009-02-02T20:48:51.510
> 
> 标签：sql-server, backup, logging, truncate

这个问题可能有点初级，但这里有：

我有一个带有 4 GB 日志文件的 SQL Server 数据库。数据库为 16GB，每晚备份一次。

我可以定期截断日志，因为每晚都会备份整个 DB+Log 吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T20:51:22.003

您可以在备份前每晚运行类似这样的维护计划。这将尝试将您的日志文件缩小/截断到 1 兆

```
BACKUP LOG DBNAME
TO disk = 'D:\Program Files\Microsoft SQL Server\MSSQL.1\MSSQL\Backup\DBNAME.log'
DBCC SHRINKFILE('DBNAME_Log', 1) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T21:09:57.333

您确定每晚都备份日志而不仅仅是数据库吗？

如果是这样，那么这个数据库是做什么的？您是否正在删除和刷新整个表？如果是这样，您的日志可能是适合您拥有的事务量的大小。您希望日志足够大以处理您的正常事务负载而不必增长。小日志可能会损害性能。

如果这个数据库本质上不是事务性的（即，表是通过完全刷新而不是一次记录来填充的），则将恢复模式更改为简单。不要这样做，但如果您有事务表，您需要能够从日志中恢复而不是简单地重新导入数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-03T15:54:05.973

如果您可以在白天运行日志备份（取决于负载等。这对您来说可能或不可能），您可以通过这样做来控制日志文件。这将防止日志文件本身变得如此之大，并且还提供了让您能够在出现问题时恢复到更接近故障点的能力。

您仍然需要使用 DBCC SHRINKFILE 缩小日志文件一次，但如果在此之后定期备份它，它不应该稳定在较小的大小。

# php - 在 Rails 中写响应？（就像 PHP 中的“回声”）

> ID：504839
> 
> 赞同：16
> 
> 时间：2009-02-02T20:50:27.687
> 
> 标签：php, ruby-on-rails, translation

我知道我可以在 Rails 中做到这一点：

```
<%="hello" %> 
```

但是有什么办法可以做到这一点

```
<%
echo "hello"
%> 
```

并让它出现在响应中？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-02T21:37:13.737

你有没有试过`concat`。

我在 Rails 文档中徘徊时看到了这一点。完全不确定，因为我对 Rails 很陌生。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-03T12:55:04.087

你必须写的是

```
<% concat "bank" %> 
```

现在你可以做类似的事情

```
<%
  10.times do
    concat "cat"
  end
%> 
```

十只猫

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2010-12-29T11:51:20.440

使用`concat`，我试过了，它可以工作。但是，如果您需要使用 HTML 字符，请使用：

```
concat(sanitize("STRING")) 
```

或打开你的`app/helpers/application_helper.rb`并写下：

```
def echo(str)
    concat sanitize str
end 
```

所以你可以输入：`echo "hello<br />\n"`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T20:59:22.923

您正在寻找“打印”或“放置”，具体取决于您是否需要换行符（可能不是）。几乎每个对象都实现了 .to_s，它也可以工作，尽管我的感觉是可能有更好的方法来做任何你想做的事情。还有更多关于此的上下文吗？

# iphone - iPhone SDK：输入一定数量的字符后，动画将无法加载

> ID：504843
> 
> 赞同：1
> 
> 时间：2009-02-02T20:50:56.577
> 
> 标签：iphone, objective-c, core-animation

好的，这是代码：

```
[lblMessage setText: txtEnter.text];
[lblMessage sizeToFit];

scrollingTextView.contentSize = lblMessage.frame.size;
float width = (lblMessage.frame.size.width) + (480);

[UIView beginAnimations:@"pan" context:nil];
[UIView setAnimationDuration:durationValue];
[UIView setAnimationRepeatCount:5];
scrollingTextView.contentOffset = CGPointMake(width,0);
[UIView commitAnimations];

//The scrolling text view is rotated.
scrollingTextView.transform = CGAffineTransformMakeRotation (3.14/2);

[self.navigationController setNavigationBarHidden:YES];
btnChange.transform = CGAffineTransformMakeRotation (3.14/2); 
```

我让用户输入一些文本，按下按钮，然后用文本替换标签，在页面上的滚动视图中旋转 90 度。

在一定数量的字符之后，例如说 20.. 动画将无法加载。我可以回去，直到动画运行。

关于我哪里出错的任何想法，或者存储文本等的更好方法等？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-02T22:46:54.003

Core Animation 动画在单独的线程上执行。当您将 contentOffset 的更改包含在 beginAnimations / commitAnimations 块中时，该更改将逐渐动画化。接下来在动画块之外发生的滚动文本视图旋转将立即执行。由于两者都在不同线程上与相同的控件进行交互，因此出现奇怪的行为也就不足为奇了。

如果您想以与 contentOffset 相同的方式为文本的旋转设置动画，请将该行代码移动到动画块内。

如果您希望在偏移更改动画完成后发生旋转，请设置回调委托方法。您可以在动画块的开头使用类似于以下内容的代码：

```
[UIView setAnimationDelegate:self];
[UIView setAnimationDidStopSelector:@selector(contentOffsetAnimationHasFinished:finished:context:)]; 
```

这需要您实现如下委托方法：

```
- (void)contentOffsetAnimationHasFinished:(NSString *)animationID finished:(BOOL)finished context:(void *)context;
{
// Do what you need to, now that the first animation has completed
} 
```

编辑（2009 年 2 月 6 日）：我刚刚创建了您的应用程序的简化版本，仅使用横向文本滚动，并且发现设备上的动画与任意数量的字符都没有问题。我删除了所有无关的调用来布局按钮等，并且只为文本设置动画。我不是每次单击按钮时都将旋转变换应用于滚动视图，而是让它开始旋转并保持这种状态。

我认为这可能是层大小问题，因为 iPhone 有 1024 x 1024 纹理大小限制（之后您需要使用 CATiledLayer 来支持您的 UIView），但我能够布置大于 1024 像素的文本并且仍然有这个工作。

一个完整的 Xcode 项目演示这个可以在[这里](http://www.sunsetlakesoftware.com/sites/default/files/TestOfRotatingText.zip)下载。我不知道您的问题是什么，但这与您在此处提供的文本动画代码无关。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-03T14:26:57.083

对，这段代码在模拟器中运行良好，直到我在 txtEnter.text 中输入超过 20 个字符之前都运行良好：

```
- (IBAction)updateMessage:(id)sender
{

    //Animation coding

    //Put the message in a resize the label
    [lblMessage setText: txtEnter.text];
    [lblMessage sizeToFit];

    //Resize the scrolliew and change the width.
    scrollingTextView.contentSize = lblMessage.frame.size;
    float width = (lblMessage.frame.size.width) + (480);
    scrollingTextView.transform = CGAffineTransformMakeRotation (3.14/2);

    //Begin the animations
    [UIView beginAnimations:@"pan" context:nil];
    [UIView setAnimationDuration:durationValue];
    [UIView setAnimationRepeatCount:5];

    //Start the scrolling text view to go across the screen
    scrollingTextView.contentOffset = CGPointMake(width,0);
    [UIView commitAnimations];

    //General hiding and showing points.
    [txtEnter resignFirstResponder];
    [btnChange setHidden:NO];
    [txtEnter setHidden:YES];
    [btnUpdate setHidden:YES];
    [lblSpeed setHidden:YES];
    [lblBackground setHidden:YES];
    [backgroundColourControl setHidden:YES];
    [speedSlider setHidden:YES];
    [scrollingTextView setHidden:NO];
    [backgroundImg setHidden:NO];
    [toolbar setHidden:YES];

    [self.navigationController setNavigationBarHidden:YES animated:YES];

    //Depending on the choice from the segment control, different colours are loaded
    switch([backgroundColourControl selectedSegmentIndex] + 1) 
    { 
        case 1: 
            [[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleBlackTranslucent animated:YES];
            break; 
        case 2: 
            [[UIApplication sharedApplication] setStatusBarStyle:UIStatusBarStyleBlackOpaque animated:YES];
            break; 
        default: break; 
    }   

    btnChange.transform = CGAffineTransformMakeRotation (3.14/2);

} 
```

我已经尝试过你的方法 Brad，但似乎无法让 (void) 部分正常工作。

我的应用程序用一条消息填充标签，然后将它们全部旋转以使其像处于横向模式一样。然后它会在滚动视图中滚动标签，就像在屏幕上滚动消息一样。

# visual-studio-2008 - 为 Visual Studio 2008 部署 Crystal Reports Basic

> ID：504848
> 
> 赞同：0
> 
> 时间：2009-02-02T20:51:40.367
> 
> 标签：visual-studio-2008, crystal-reports, installation, windows-installer, inno-setup

我正在开发一个链式安装程序，包括使用 Inno Setup 的 Crystal Reports Basic (10.5) 的 .msi 安装。我找不到任何部署指南来确定它是否已安装在目标 PC 上，尽管看起来我可以多次调用 .msi 并且它总是尝试安装（从不进行典型的修复/删除）。

我在 HKEY_CLASSES_ROOT\Installer\Products\ 下为 Crystal Reports 找到了一个注册表项，我还可以在 GAC 中找到一个程序集。作为 Inno Setup 的新手，我不确定如何在 GAC 中找到文件，但我想我可以弄清楚。

我的问题是：是否推荐选项？有比这两个更好的选择吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-26T04:14:12.987

当我们使用 Crystal 时，我们使用了合并模块。我们还在 Visual Studio 中使用设置和部署项目，因此可以选择检测它是否已经安装。

你见过这个吗？[http://www.randem.com/crsupport.html](http://www.randem.com/crsupport.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-08T18:09:19.273

我前段时间遇到了同样的问题，并且有解决方案。**带有Crystal Report 安装**的 Inno 脚本。[水晶报表 9 和 11 安装](http://www.sportamok.com/development/delphi/13-inno-setup-crystal-report-deployment)

我喜欢 Inno，因为它快速、简单，而且你可以完全控制整个过程。Crystal Report msi 包只是痛苦。

希望能帮助到你。

# firefox - 在 Selenium IDE 中使用 waitForCondition ( script,timeout )

> ID：504849
> 
> 赞同：5
> 
> 时间：2009-02-02T20:52:20.957
> 
> 标签：firefox, selenium

我使用 Firefox 的 Selenium IDE 扩展录制了一个脚本，我想添加命令 waitForCondition。我看到它需要两个参数：脚本和超时。在 Selenium IDE 中，每个命令都有 3 个文本字段：命令名称（我假设为“waitForCondition”）、目标和值。我应该在哪里以及如何将这两个参数放在这个 UI 中？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T20:56:17.113

```
 waitForCondition
var value = selenium.getText("foo"); value.match(/bar/);
3000 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-15T17:07:02.940

命令：waitForCondition
目标：var value = selenium.getText("foo"); value.match(/bar/);
价值：3000

# .net - 我应该如何处理 XML 中的 URL？

> ID：504852
> 
> 赞同：1
> 
> 时间：2009-02-02T20:55:16.973
> 
> 标签：.net, xml, url

我正在创建一个 XML 文档，我想将 URL 存储在一个节点内，如下所示：

```
<ns:url>http://example.com</ns:ulr> 
```

我的问题是，我是否需要对 URL 进行编码/转义？

如果我这样做，.Net XmlDocument 对象会为我处理这个吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T21:00:00.740

一般来说，大多数 DOM 实现（包括 XmlDocument）应该默认处理任何必要的文本内容转义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T21:17:45.367

DOM/XmlWriter/无论你使用什么都应该为你处理。一个小问题：您可能会发现使用 XDocument 更容易（如果您有 3.5） - 命名空间的使用要简单得多（IMO）：

```
XNamespace ns = "http://consoso/foobar";
XDocument doc = new XDocument(
     new XElement("Foo",
         new XAttribute(XNamespace.Xmlns + "ns", ns), // alias
         new XElement("Bar", "abc"),
         new XElement(ns + "url", "http://foo/bar")
     )
 );
 string s = doc.ToString(); 
```

这创造了：

```
<Foo xmlns:ns="http://consoso/foobar">
  <Bar>abc</Bar>
  <ns:url>http://foo/bar</ns:url>
</Foo> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T20:57:56.297

我怀疑总体上是否有必要逃避它。但是，您可能有一些应用程序级别的要求来执行此操作。

您应该绝对将 URL 编码为 XML 文本（例如，它不应该包含`>`）。

**澄清：**这并不意味着您应该将编码文本传递给 DOM 实现。我知道的所有 XML API 都可以为您做到这一点；因此，对于所有实际情况，您都不需要手动操作。我只是说应该**做**。

# perl - Perl 中左值子例程的用途是什么？

> ID：504857
> 
> 赞同：18
> 
> 时间：2009-02-02T20:56:32.073
> 
> 标签：perl, subroutine, lvalue

我不明白左值子例程的用途是什么？什么是我用普通子程序无法完成的？你能发布一些例子吗？

谢谢

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-02T23:55:43.460

您可以使用左值子作为对象成员的设置器：

```
sub x : lvalue {
    my $self = shift;
    $self->{x};
} 
```

然后后来：

```
$foo->x = 5; 
```

这结合了直接设置成员的直观性和封装 setter 的灵活性，以防您以后想要更改对象的实现方式。与以下在 Perl 中设置成员的更传统方法相比：

直觉但脆弱；如果你改变 $foo 的实现方式会怎样？

```
$foo->{x} = 5; 
```

传统的setter方法；不使用赋值语法来表示赋值：

```
$foo->set_x(5); 
```

当然，Perl 社区从未真正接受过左值方法，并且使用左值 subs 是“奇怪的”，任何为了直观而获得的东西都会因为这一切的陌生而丢失。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-02-02T21:25:29.377

建议避免使用 LValue。它们很有趣，但它们会让新用户感到困惑，因为他们会假设所有 subs 是如何工作的，因此当有更好的方法可用时，应该在代码中避免它。

有时使用 LValue 结果来做脏活是非常实用的。

```
substr( $string, $start, $stop ) = 'somevalue' # replaces the specified part of the substring. 
```

但是，这也做同样的事情：

```
substr( $string, $start, $stop , 'somevalue' ); 
```

这里的区别主要是前者具有更强的表达能力，因为它将行为委托给使用它的代码而不是函数本身。

例如：

```
substr( $string, $start, $stop ) =~ s/a/b/g 
```

会要求你做

```
my $x = substr( $string, $start, $stop ); 
$x =~ s/a/b/g/; 
substr( $string, $start, $stop, $x ); 
```

这有点讨厌。

虽然，这里还有一个令人讨厌的地方，因为您必须考虑是否使用 $x 进行替换是否可以追溯修改字符串（因为 substr 是 LValue 子）。我不认为它有，但它不够模糊，我必须检查手册才能记住它是否有，这很糟糕。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-02T21:20:26.890

它们提供了不同的界面，在某些情况下可以更直观。与传统的 setter 不同，您实际上可以直接更改值。例如

```
lvalue_sub($foo) =~ s/foo/bar/; 
```

可以比

```
my $tmp = some_sub($foo);
$tmp =~ s/foo/bar/;
some_sub($foo, $tmp); 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-01-14T20:24:11.163

我不能说在我的普通 Perl 东西中大量使用它们，但是在获取切片或 piddle 的其他小节时，它们在 Perl 数据语言中被广泛使用。例如：

```
my $a = sequence(100);
# use lvalue in this increment:
$a->where($a < 10)++;

# Zero-out the last four elements
# notice the use of the overloaded .= operator:
$a->slice("-10:") .= 0; 
```

与 Perl 中的许多东西一样，这个特性在整个生态系统中的使用并不多，但它至少在这个利基市场中的使用让 PDL 用户的生活*变得*更加轻松。

# html - 视图中的单选按钮请求语法

> ID：504858
> 
> 赞同：0
> 
> 时间：2009-02-02T20:57:14.410
> 
> 标签：html, django, button, radio-button

我正在尝试编写一个 html 表单，其中包括一个单选按钮和关键字搜索。代码在这里：

[http://dpaste.com/115844/](http://dpaste.com/115844/)

django 视图无法识别此语法：

```
pubtypeid = request.GET['pubtypeid'] 
```

有人可以帮我正确地写这个吗？

谢谢，

安娜

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-02T21:00:53.577

您错误地使用了“如果”。它应该有两个“=”，而不是一个。

# javascript - 您如何测量文本在 Javascript 中占用的空间？

> ID：504859
> 
> 赞同：7
> 
> 时间：2009-02-02T20:57:35.267
> 
> 标签：javascript, css, text, layout

在 Javascript 中，我有一个特定的字符串，我想以某种方式测量它在某个元素内将占用多少空间（以像素为单位）。

基本上我所拥有的是一个将浮动在其他所有内容之上的元素（如工具提示），我需要通过 Javascript 手动设置它的宽度，因此它会根据里面的文本进行调整。
我不能让它自然地“自动增长”，就像一个内联元素会水平增长以包含它的子元素。

在 Windows 中有执行此操作的 API。有没有办法在 Javascript 中做同样的事情？
如果没有像样的方法，您认为哪种方法可行？（例如，尝试不同的宽度并检查高度以确保它没有超过某个阈值）。

显然，我可以在我的 JS 中硬编码的“像素值”越少越好。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-02T21:01:42.157

试试这个

[http://blog.mastykarz.nl/measuring-the-length-of-a-string-in-pixels-using-javascript/](http://blog.mastykarz.nl/measuring-the-length-of-a-string-in-pixels-using-javascript/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-02T21:18:12.793

鉴于此 HTML `<span>text here</span>`，您必须阅读 span 的 offsetWidth 属性，该属性仅在元素本身添加到 DOM 时才分配，*而没有*使其不可见的样式。从技术上讲，这意味着浏览器必须能够可视地加载 DOM 中的元素，才能构造和分配 offsetWidth 属性。

像这样的东西会起作用：

```
var span = document.createElement("span");
span.appendChild(document.createTextNode("text here"));

span.style = ""; // to make sure the elment doesn't have "display: none" or such
document.body.appendChild(span); // adding it to the DOM

var textWidth = span.offsetWidth;

// be sure to hide or remove the span if you don't need it anymore 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T21:05:36.343

这很容易使用 JavaScript 框架。我在这个例子中使用了[原型。](http://prototypejs.org)

```
<span id='text' style='border:1px solid #000000;font-size:14px'>hello this is sample text</span>

<script type="text/javascript">
alert($('text').getWidth())
</script> 
```

# ruby - 从文本块中提取电子邮件地址

> ID：504860
> 
> 赞同：4
> 
> 时间：2009-02-02T20:57:37.297
> 
> 标签：ruby, regex

如何创建包含在文本块中的电子邮件地址数组？我试过了

`addrs = text.scan(/ .+?@.+? /).map{|e| e[1...-1]}`

但是（不足为奇）它不能可靠地工作。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-02T21:00:02.160

这个怎么样以获得（稍微）更好的正则表达式

```
\b[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b 
```

你可以在这里找到这个：

[电子邮件正则表达式](http://www.regular-expressions.info/email.html)

仅供参考，您的电子邮件的问题在于您在电子邮件地址之前或之后只允许使用一种分隔符。如果用空格分隔，您将单独匹配“@”。

# .net - 在活动目录中，mailNickname 用于什么？

> ID：504868
> 
> 赞同：9
> 
> 时间：2009-02-02T20:59:11.753
> 
> 标签：.net, active-directory, adsi

在活动目录中，mailNickname 是否应该始终等于 samaccountname？或者，它是否应该始终等于邮件属性（减去“@domain”）？

我问的原因是，我们最近将每个人的主电子邮件地址更改为 first.last 表单，并将 mail 属性设置为相同。但是，我们是否还需要修改 mailNickname 属性？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-03T02:32:15.577

不，它不必*与*sAMAccountName 相同。碰巧它通常是相同的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-03T02:49:30.893

mailNickName 是电子邮件别名。如果您使用的是 Exchange，那么您需要更改邮件地址策略以更新邮件属性。如果您使用该策略，您还可以为每个用户指定其他格式或域。

# javascript - 在 ASP 中设置焦点

> ID：504879
> 
> 赞同：2
> 
> 时间：2009-02-02T21:01:26.523
> 
> 标签：javascript

我在 ASP 中维护一个站点，其中一项任务是将焦点设置在页面上的文本框上。这是我尝试过的：

```
<script type="text/javascript">
<!--
document.psForm['password'].focus();
//AND
document.getElementById("password").focus();
-->
</script> 
```

我不认为这会起作用......而且它没有：

```
<form id="psForm" action="logonpw.asp" method="post" defaultfocus="password"> 
```

这不起作用：

```
<body onload="javascript:docuument.psForm.password.focus();"> 
```

这是表格：

```
<form id="psForm" action="logonpw.asp" method="post">
    <table border="0" cellpadding="5">
  <tr>
    <td>
          Password:
       </td>
    <td>
      <input type="password" name="password" value="<%= password %>" size="50">
        </td>
      </tr>
     </table>
</form> 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-02T21:06:12.630

试试这个：添加：

```
id="password" 
```

到输入标签，然后使用：

```
document.getElementById("password").focus(); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T21:06:03.147

一个动作

```
<script type="text/javascript">
<!--
document.psForm['password'].focus();
//AND
document.getElementById("password").focus();
-->
</script> 
```

到页面源的底部。

b) 负载防火规范

```
<script type="text/javascript">
<!--
function handleOnLoad(){
document.psForm['password'].focus();
//AND
document.getElementById("password").focus();
}
-->
</script>
...
<body onload="handleOnLoad();"> 
```

顺便说一句，只有第二个 onfocus 会有任何好处。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T21:03:39.407

```
<body onload="javascript:docuument.psForm.password.focus();"> 
```

应该

```
<body onload="javascript:document.psForm.password.focus();"> 
```

检查拼写...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T21:04:25.597

```
<body onload="javascript:document.psForm.password.focus();"> 
```

文件拼写错误

# wpf - GridView 中的两种方式数据绑定

> ID：504887
> 
> 赞同：2
> 
> 时间：2009-02-02T21:04:10.840
> 
> 标签：wpf, xaml, gridview, data-binding, two-way-binding

我们有一个应用程序，它使用简单的单向绑定与 GridView 来显示一些数据。好吧，现在我们需要允许用户更改一些数据，所以我一直在尝试让两种方式的数据绑定在 GridView 中工作。到目前为止，一切都正确显示，但在 GridView 中编辑单元格似乎什么也没做。我在搞砸什么？像这样的双向数据绑定甚至可能吗？我是否应该开始转换所有内容以使用不同的控件，比如 DataGrid？

我写了一个小测试应用程序来显示我的问题。如果你尝试一下，你会发现属性设置器在初始化后永远不会被调用。

xml:

```
 Title="Window1" Height="300" Width="300">
    <Grid>
        <ListView Name="TestList">
            <ListView.View>
                <GridView>
                    <GridViewColumn Header="Strings">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <TextBox Text="{Binding Path=String, Mode=TwoWay}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                    <GridViewColumn Header="Bools">
                        <GridViewColumn.CellTemplate>
                            <DataTemplate>
                                <CheckBox IsChecked="{Binding Path=Bool, Mode=TwoWay}"/>
                            </DataTemplate>
                        </GridViewColumn.CellTemplate>
                    </GridViewColumn>
                </GridView>
            </ListView.View>
        </ListView>
    </Grid>
</Window> 
```

这是相应的代码：

```
using System.Collections.Generic;
using System.Windows;

namespace GridViewTextbox
{
    public partial class Window1 : Window
    {
        private List<TestRow> _rows = new List<TestRow>();

        public Window1()
        {
            InitializeComponent();

            _rows.Add(new TestRow("a", false));
            _rows.Add(new TestRow("b", true));
            _rows.Add(new TestRow("c", false));

            TestList.ItemsSource = _rows;
            TestList.DataContext = _rows;
        }
    }

    public class TestRow : System.Windows.DependencyObject
    {
        public TestRow(string s, bool b)
        {
            String = s;
            Bool = b;
        }

        public string String
        {
            get { return (string)GetValue(StringProperty); }
            set { SetValue(StringProperty, value); }
        }

        // Using a DependencyProperty as the backing store for String.  This enables animation, styling, binding, etc...
        public static readonly DependencyProperty StringProperty =
            DependencyProperty.Register("String", typeof(string), typeof(TestRow), new UIPropertyMetadata(""));

        public bool Bool
        {
            get { return (bool)GetValue(BoolProperty); }
            set { SetValue(BoolProperty, value); }
        }

        // Using a DependencyProperty as the backing store for Bool.  This enables animation, styling, binding, etc...
        public static readonly DependencyProperty BoolProperty =
            DependencyProperty.Register("Bool", typeof(bool), typeof(TestRow), new UIPropertyMetadata(false));
    }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-02T21:14:25.530

当您使用依赖属性时，绑定不会调用 Setter，而是直接更改值（使用 SetValue 或类似的东西）。

尝试添加一个 PropertyChangedCallback，并在其中设置一个断点以查看该值是否从 GridView 更改。

```
public static readonly DependencyProperty BoolProperty =
    DependencyProperty.Register("Bool", typeof(bool), typeof(TestRow), new UIPropertyMetadata(false, OnBoolChanged));
private static void OnBoolChanged(DependencyObject sender, DependencyPropertyChangedEventArgs e)
{
    //this method will be called everytime Bool changes value
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T21:25:02.123

如果它们是依赖属性，则不会从 WPF 调用属性设置器。这些被用作 CLR 便利，并由不知道 DependencyProperty 的代码调用。

WPF 代码将执行以下操作：

```
yourControl.SetValue(TestRow.StringProperty, someValue); 
```

不是：

```
yourControl.String = someValue; 
```

您需要挂钩 DepedencyPropertyChanged 事件才能听到更改。

# regex - 如何使用 Perl 正则表达式删除所有连字符？

> ID：504892
> 
> 赞同：3
> 
> 时间：2009-02-02T21:05:06.203
> 
> 标签：regex, perl

我以为这样就可以了...

```
$rowfetch = $DBS->{Row}->GetCharValue("meetdays");
$rowfetch = /[-]/gi;
printline($rowfetch); 
```

但似乎我错过了正则表达式语法的一小部分但很关键。

`$rowfetch`总是类似于：

```
------S
-M-W---
--T-TF- 
```

等等...代表一周中的哪几天开会

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-02T21:07:31.037

```
$rowfetch =~ s/-//gi 
```

这就是你在那里的第二条线路所需要的。您只是在寻找东西，而不是在没有“s”前缀的情况下实际更改它。

您还需要为此使用正则表达式运算符“=~”。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-02T21:39:21.627

这是您的代码目前所做的：

```
# Assign 'rowfetch' to the value fetched from:
#      The function 'GetCharValue' which is a method of: 
#         An Value in A Hash Identified by the key "Row" in:
#          Either a Hash-Ref or a Blessed Hash-Ref
#      Where 'GetCharValue' is given the parameter "meetdays"
$rowfetch = $DBS->{Row}->GetCharValue("meetdays");
# Assign $rowfetch to the number of times 
#  the default variable ( $_ ) matched the expression /[-]/ 
$rowfetch = /[-]/gi;
#  Print the number of times. 
printline($rowfetch); 
```

这相当于编写了以下代码：

```
$rowfetch = ( $_ =~ /[-]/ ) 
printline( $rowfetch ); 
```

你正在寻找的魔法是

```
=~ 
```

代币代替

```
= 
```

前者是 Regex 运算符，后者是赋值运算符。

也有许多不同的正则表达式运算符：

```
if( $subject =~ m/expression/  ){
} 
```

仅当 $subject 与给定表达式匹配时才会执行给定的代码块，并且

```
$subject =~ s/foo/bar/gi 
```

用“bar”替换（`s/`）所有“foo”实例，不区分大小写（ ），并在变量上`/i`多次重复替换（ ） 。`/g``$subject`

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-07T21:18:46.080

使用[`tr`](http://perldoc.perl.org/perlop.html#tr%2fSEARCHLIST%2fREPLACEMENTLIST%2fcds)运算符比使用`s///`正则表达式替换更快。

```
$rowfetch =~ tr/-//d; 
```

基准：

```
use Benchmark qw(cmpthese);

my $s = 'foo-bar-baz-blee-goo-glab-blech';

cmpthese(-5, {
  trd => sub { (my $a = $s) =~ tr/-//d },
  sub => sub { (my $a = $s) =~ s/-//g },
}); 
```

我的系统上的结果：

```
 Rate  sub  trd
sub  300754/s   -- -79%
trd 1429005/s 375%   -- 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-08T01:31:11.873

题外话，但没有连字符，你怎么知道“T”是星期二还是星期四？

# javascript - 在 Javascript 中查找对象

> ID：504899
> 
> 赞同：1
> 
> 时间：2009-02-02T21:06:43.237
> 
> 标签：javascript, search, object

我有一个包含数千个复选框的表单，当一个被选中时，我想选中它下面的所有框。这有效：

```
<html>
<body>
<form name="myform">
<input type="checkbox" name="box1" onClick="redrawboxes(this);">1<br>
<input type="checkbox" name="box2" onClick="redrawboxes(this);">2<br>
...
</form>
</body>
</html>
<script>
function redrawboxes(obj){  
    //check all boxes below 
    var foundit=false;
    for (e=0; e<document.myform.elements.length; e++){
        if (foundit==false){ //search for checked obj
            if(obj == document.myform.elements[e]){ 
                foundit=true;   
            }
        }else{ //continuing below checked box
            if(obj.checked){ //are we checking or unchecking
                    document.myform.elements[e].checked = true;
            }else{
                    document.myform.elements[e].checked = false;
            }
        }
    }
}
</script> 
```

但是对于几千多的盒子，IE 速度慢得让人无法接受。（Firefox 工作正常。）除了遍历整个列表之外，还有更好的方法来找到原始框吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-02T21:34:03.433

这两个 jQuery 建议都非常好。对于像这样的 DOM 争论，你最好使用一个好的库。

关于在表单上放置数千个复选框的可疑智慧的评论也很好......

但是，如果你确实有充分的理由这样做，并且你不能使用 jQuery 或类似的东西，这里有一个快速、直接的 JS 方法：

```
function redrawboxes(obj)
{  
    //check all boxes below     
    var next = obj;
    while ( (next = next.nextSibling) )
    {
      if ( next.nodeName.toLowerCase() == "input" 
        && next.type.toLowerCase() == "checkbox" )
        next.checked = obj.checked;
    }
} 
```

*在 FF3、FF3.1、IE6、Chrome 1、Chromium 2 中测试*

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T21:09:39.143

我可能会为此投票，但请尝试使用 jquery。它具有为此优化的选择器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T21:10:36.787

里面有广告！

如果你使用 jQuery，你可以尝试我的插件来使你的循环异步，这将允许运行一个长循环而不会冻结浏览器。

[http://mess.genezys.net/jquery/jquery.async.php](http://mess.genezys.net/jquery/jquery.async.php)

如果你不想使用 jQuery，你可以下载插件并根据自己的需要修改代码，它并不真正依赖 jQuery。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-02T21:33:12.607

您可以像这样读出所选复选框的名称：

```
function redrawboxes(obj) {
    var name = obj.name;
    var state = obj.checked;

    // get that index
    var index = name.substr(3) * 1; // just to be sure it's a number
    var length = document.myform.elements.length;
    var allElements = document.myform.elements

    // (un)check all elements below
    for (var i = index; i < length; i++) {
        allElements[i].checked = state;
    }
} 
```

您可以通过使用局部变量来大大加快您的代码速度，并且有一个`if`可以替换的 - 语句。

*编辑：*实际上，一次性错误不是错误，因为用户自己（未）选中了该特定复选框。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-02T22:19:23.573

不知道它有多快，但您可以尝试 jQuery 方式，从[www.jquery.com](http://www.jquery.com)获取 jQuery并在页面上插入以下代码：

```
$(function(){
    $("input:checkbox").click(function(){
        $(this).nextAll("input:checkbox").each(function(){
            this.checked = true;
        });
    });
}); 
```

# java - 除了拥有正确的方法之外，还有更多的接口吗

> ID：504904
> 
> 赞同：159
> 
> 时间：2009-02-02T21:07:36.497
> 
> 标签：java, oop, language-features, interface

所以可以说我有这个界面：

```
public interface IBox
{
   public void setSize(int size);
   public int getSize();
   public int getArea();
  //...and so on
} 
```

我有一个实现它的类：

```
public class Rectangle implements IBox
{
   private int size;
   //Methods here
} 
```

如果我想使用 IBox 接口，我实际上无法创建它的实例，顺便说一下：

```
public static void main(String args[])
{
    Ibox myBox=new Ibox();
} 
```

对？所以我实际上必须这样做：

```
public static void main(String args[])
{
    Rectangle myBox=new Rectangle();
} 
```

如果这是真的，那么接口的唯一目的是确保实现接口的类具有接口所描述的正确方法？或者接口还有其他用途吗？

* * *

## 回答 #1

> 赞同：142
> 
> 时间：2009-02-02T21:12:59.933

接口是使您的代码更加灵活的一种方式。你要做的是：

```
Ibox myBox=new Rectangle(); 
```

然后，稍后，如果您决定要使用不同类型的框（可能有另一个库，具有更好类型的框），您将代码切换为：

```
Ibox myBox=new OtherKindOfBox(); 
```

一旦你习惯了它，你会发现它是一种很棒的（实际上是必不可少的）工作方式。

另一个原因是，例如，如果您想创建一个框列表并对每个框执行一些操作，但您希望列表包含不同类型的框。在每个盒子上你可以做：

```
myBox.close() 
```

（假设 IBox 有一个 close() 方法）即使 myBox 的实际类会根据您在迭代中所处的框而变化。

* * *

## 回答 #2

> 赞同：125
> 
> 时间：2009-02-02T22:03:38.083

使接口有用的**不是**“您可以改变主意并在以后使用不同的实现，而只需要更改创建对象的地方”这一事实。那不是问题。

真正的重点已经在名称中：它们定义了一个任何人都可以实现的*接口，以使用在该接口上操作的所有代码。*最好的例子是`java.util.Collections`它提供了各种专门在接口上操作的有用方法，例如`sort()`或`reverse()`for `List`。这里的重点是，这段代码现在可用于对实现接口的**任何**类进行排序或反转`List`——不仅是`ArrayList`and `LinkedList`，还包括您自己编写的类，这些类可能以编写者`java.util.Collections`从未想象过的方式实现。

同样，您可以编写在众所周知的接口或您定义的接口上运行的代码，其他人可以使用您的代码，而无需要求您支持他们的类。

接口的另一个常见用途是回调。例如，[java.swing.table.TableCellRenderer](http://java.sun.com/javase/6/docs/api/javax/swing/table/TableCellRenderer.html)，它允许您影响 Swing 表在特定列中显示数据的方式。您实现该接口，将实例传递给`JTable`，并且在表格呈现期间的某个时刻，您的代码将被调用以执行其工作。

* * *

## 回答 #3

> 赞同：120
> 
> 时间：2013-06-20T17:46:18.930

我读过的众多用途之一是在 Java 中如果没有多重继承使用接口就很困难：

```
class Animal
{
void walk() { } 
....
.... //other methods and finally
void chew() { } //concentrate on this
} 
```

现在，想象一个案例：

```
class Reptile extends Animal 
{ 
//reptile specific code here
} //not a problem here 
```

但，

```
class Bird extends Animal
{
...... //other Bird specific code
} //now Birds cannot chew so this would a problem in the sense Bird classes can also call chew() method which is unwanted 
```

更好的设计是：

```
class Animal
{
void walk() { } 
....
.... //other methods 
} 
```

Animal 没有chew() 方法，而是放在一个接口中：

```
interface Chewable {
void chew();
} 
```

并让 Reptile 类实现这个而不是 Birds（因为 Birds 不能咀嚼）：

```
class Reptile extends Animal implements Chewable { } 
```

和鸟类简单的情况：

```
class Bird extends Animal { } 
```

* * *

## 回答 #4

> 赞同：48
> 
> 时间：2009-02-02T21:14:48.057

接口的目的是**多态性**，也就是**类型替换**。例如，给定以下方法：

```
public void scale(IBox b, int i) {
   b.setSize(b.getSize() * i);
} 
```

调用该`scale`方法时，您可以提供任何实现`IBox`接口的类型的值。换句话说，如果`Rectangle`和`Square`两者都实现`IBox`，您可以在任何预期的地方提供 a`Rectangle`或 a 。`Square``IBox`

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2009-02-02T21:27:32.477

接口允许静态类型语言支持多态性。一个面向对象的纯粹主义者会坚持认为一种语言应该提供继承、封装、模块化和多态性，以便成为一种功能齐全的面向对象语言。在动态类型或鸭子类型的语言（如 Smalltalk）中，多态是微不足道的。然而，在静态类型语言（如 Java 或 C#）中，多态性远非微不足道（事实上，从表面上看，它似乎与强类型的概念不一致。）

让我演示一下：

在动态类型（或鸭子类型）语言（如 Smalltalk）中，所有变量都是对对象的引用（不多也不少。）所以，在 Smalltalk 中，我可以这样做：

```
|anAnimal|    
anAnimal := Pig new.
anAnimal makeNoise.

anAnimal := Cow new.
anAnimal makeNoise. 
```

该代码：

1.  声明一个名为 anAnimal 的局部变量（请注意，我们不指定变量的类型 - 所有变量都是对对象的引用，不多也不少。）
2.  创建名为“Pig”的类的新实例
3.  将 Pig 的新实例分配给变量 anAnimal。
4.  将消息发送`makeNoise`给猪。
5.  使用牛重复整个过程，但将其分配给与 Pig 相同的变量。

相同的 Java 代码看起来像这样（假设 Duck 和 Cow 是 Animal 的子类：

```
Animal anAnimal = new Pig();
duck.makeNoise();

anAnimal = new Cow();
cow.makeNoise(); 
```

这一切都很好，直到我们介绍蔬菜类。蔬菜有一些与动物相同的行为，但不是全部。例如，动物和蔬菜可能都可以生长，但显然蔬菜不会发出噪音，动物也无法收获。

在 Smalltalk 中，我们可以这样写：

```
|aFarmObject|
aFarmObject := Cow new.
aFarmObject grow.
aFarmObject makeNoise.

aFarmObject := Corn new.
aFarmObject grow.
aFarmObject harvest. 
```

这在 Smalltalk 中非常有效，因为它是鸭子类型的（如果它像鸭子一样走路，并且像鸭子一样嘎嘎叫 - 它就是鸭子。）在这种情况下，当消息发送到对象时，会在接收者的方法列表，如果找到匹配的方法，则调用它。如果没有，则会抛出某种 NoSuchMethodError 异常——但这一切都是在运行时完成的。

但是在 Java 这种静态类型语言中，我们可以为变量分配什么类型？玉米需要从蔬菜继承，以支持生长，但不能从动物继承，因为它不会发出噪音。Cow 需要从 Animal 继承来支持 makeNoise，但不能从 Vegetable 继承，因为它不应该实现收获。看起来我们需要*多重继承*——从多个类继承的能力。但事实证明这是一个非常困难的语言特性，因为会出现所有边缘情况（当多个并行超类实现相同的方法时会发生什么？等等）

随之而来的接口...

如果我们创建动物和蔬菜类，每个实现 Growable，我们可以声明我们的牛是动物，我们的玉米是蔬菜。我们还可以声明动物和蔬菜都是可生长的。这让我们写这个来增长一切：

```
List<Growable> list = new ArrayList<Growable>();
list.add(new Cow());
list.add(new Corn());
list.add(new Pig());

for(Growable g : list) {
   g.grow();
} 
```

它让我们这样做，发出动物的声音：

```
List<Animal> list = new ArrayList<Animal>();
list.add(new Cow());
list.add(new Pig());
for(Animal a : list) {
  a.makeNoise();
} 
```

鸭子类型语言的优点是你可以获得非常好的多态性：一个类提供行为所要做的就是提供方法。只要每个人都表现得很好，并且只发送与定义的方法匹配的消息，一切都很好。缺点是直到运行时才捕获到下面的错误类型：

```
|aFarmObject|
aFarmObject := Corn new.
aFarmObject makeNoise. // No compiler error - not checked until runtime. 
```

静态类型语言提供了更好的“契约式编程”，因为它们会在编译时捕获以下两种错误：

```
// Compiler error: Corn cannot be cast to Animal.
Animal farmObject = new Corn();  
farmObject makeNoise(); 
```

--

```
// Compiler error: Animal doesn't have the harvest message.
Animal farmObject = new Cow();
farmObject.harvest(); 
```

所以....总结一下：

1.  接口实现允许你指定对象可以做什么样的事情（交互），类继承让你指定应该如何做事情（实现）。

2.  接口为我们提供了“真正的”多态性的许多好处，而不会牺牲编译器类型检查。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-02-02T21:14:07.700

通常，接口定义了您应该使用的接口（顾名思义；-)）。样本

```
 public void foo(List l) {
   ... do something
} 
```

现在您的函数`foo`接受`ArrayList`s, `LinkedList`s, ... 不仅是一种类型。

Java 中最重要的是您可以实现多个接口，但您只能扩展一个类！样本：

```
 class Test extends Foo implements Comparable, Serializable, Formattable {
...
} 
```

是可能的，但是

```
 class Test extends Foo, Bar, Buz {
...
} 
```

不是！

您上面的代码也可能是：`IBox myBox = new Rectangle();`. 现在重要的是，myBox 仅包含来自 IBox 的方法/字段，而不包含来自`Rectangle`.

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-02-02T21:11:03.510

你可以做

```
Ibox myBox = new Rectangle(); 
```

这样您就可以将此对象用作 Ibox 并且您并不关心它真的是`Rectangle`.

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-02-02T21:58:50.090

我认为您了解接口所做的一切，但您还没有想象接口有用的情况。

如果您在一个狭窄的范围内（例如，在一个方法调用中）实例化、使用和释放一个对象，那么接口实际上并没有添加任何东西。正如您所指出的，具体类是已知的。

接口有用的地方是当一个对象需要在一个地方创建并返回给可能不关心实现细节的调用者时。让我们将您的 IBox 示例更改为形状。现在我们可以有 Shape 的实现，例如 Rectangle、Circle、Triangle 等，getArea() 和 getSize() 方法的实现对于每个具体类都是完全不同的。

现在您可以使用具有各种 createShape(params) 方法的工厂，该方法将根据传入的参数返回适当的 Shape。显然，工厂将知道正在创建的 Shape 类型，但调用者不会知道关心它是圆形，还是方形，等等。

现在，假设您必须对形状执行各种操作。也许您需要按区域对它们进行排序，将它们全部设置为新大小，然后在 UI 中显示它们。Shapes 都是由工厂创建的，然后可以很容易地传递给 Sorter、Sizer 和 Display 类。如果您将来需要添加一个六边形类，您无需更改任何内容，只需更改工厂即可。如果没有界面，添加另一个形状会变得非常混乱。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2017-05-15T06:27:09.520

为什么是界面？？？？？？

它从一只狗开始。特别是**哈巴狗**。

哈巴狗有多种行为：

```
public class Pug { 
private String name;
public Pug(String n) { name = n; } 
public String getName() { return name; }  
public String bark() { return  "Arf!"; } 
public boolean hasCurlyTail() { return true; } } 
```

你有一只拉布拉多犬，它也有一套行为。

```
public class Lab { 
private String name; 
public Lab(String n) { name = n; } 
public String getName() { return name; } 
public String bark() { return "Woof!"; } 
public boolean hasCurlyTail() { return false; } } 
```

我们可以制作一些哈巴狗和实验室：

```
Pug pug = new Pug("Spot"); 
Lab lab = new Lab("Fido"); 
```

我们可以调用他们的行为：

```
pug.bark() -> "Arf!" 
lab.bark() -> "Woof!" 
pug.hasCurlyTail() -> true 
lab.hasCurlyTail() -> false 
pug.getName() -> "Spot" 
```

假设我经营一个狗窝，我需要跟踪我所饲养的所有狗。我**需要将我的哈巴狗和拉布拉多犬存放在单独的数组中**：

```
public class Kennel { 
Pug[] pugs = new Pug[10]; 
Lab[] labs = new Lab[10];  
public void addPug(Pug p) { ... } 
public void addLab(Lab l) { ... } 
public void printDogs() { // Display names of all the dogs } } 
```

但这显然不是最优的。如果**我也想养一些贵宾犬**，我必须更改我的犬舍定义以添加一组贵宾犬。事实上，我需要为每种狗创建一个单独的数组。

洞察力：哈巴狗和拉布拉多犬（和贵宾犬）都是狗的类型，它们具有相同的行为。也就是说，我们可以说（为了这个例子的目的）所有的狗都可以吠叫，有名字，可能有也可能没有卷曲的尾巴。我们可以使用一个接口来定义所有狗可以做什么，但是让特定类型的狗来实现这些特定的行为。界面说“这是所有狗都可以做的事情”，但没有说明每种行为是如何完成的。

```
public interface Dog 
{
public String bark(); 
public String getName(); 
public boolean hasCurlyTail(); } 
```

然后我稍微改变 Pug 和 Lab 类来实现 Dog 行为。我们可以说哈巴狗是狗，实验室是狗。

```
public class Pug implements Dog {
// the rest is the same as before } 

public class Lab implements Dog { 
// the rest is the same as before 
} 
```

我仍然可以像以前一样实例化 Pugs 和 Labs，但现在我也有了一种新的方法：

```
Dog d1 = new Pug("Spot"); 
Dog d2 = new Lab("Fido"); 
```

这表示 d1 不仅是一只狗，它特别是一只哈巴狗。d2 也是 Dog，特别是 Lab。我们可以调用这些行为，它们像以前一样工作：

```
d1.bark() -> "Arf!" 
d2.bark() -> "Woof!" 
d1.hasCurlyTail() -> true 
d2.hasCurlyTail() -> false 
d1.getName() -> "Spot" 
```

这是所有额外工作都得到回报的地方。Kennel 类变得简单得多。我只需要一个数组和一个 addDog 方法。两者都适用于狗的任何物体；即实现 Dog 接口的对象。

```
public class Kennel {
Dog[] dogs = new Dog[20]; 
public void addDog(Dog d) { ... } 
public void printDogs() {
// Display names of all the dogs } } 
```

以下是如何使用它：

```
Kennel k = new Kennel(); 
Dog d1 = new Pug("Spot"); 
Dog d2 = new Lab("Fido"); 
k.addDog(d1); 
k.addDog(d2); 
k.printDogs(); 
```

最后一条语句将显示：Spot Fido

接口使您能够指定一组行为，实现该接口的所有类将共享这些行为。因此，我们可以定义变量和集合（例如数组），它们不必事先知道它们将保存什么样的特定对象，只需知道它们将保存实现接口的对象。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-02-02T21:14:57.947

Collections 框架是一个很好的接口使用示例。如果您编写一个接受 a 的函数`List`，那么用户传入 a`Vector`或 an`ArrayList`或 a`HashList`或其他什么都没有关系。你也可以将它传递`List`给任何需要一个`Collection`或`Iterable`接口的函数。

这使得类似的功能成为`Collections.sort(List list)`可能，无论它是如何`List`实现的。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-02-02T21:48:18.800

这就是为什么[工厂模式](http://en.wikipedia.org/wiki/Factory_method_pattern)和其他创建模式在 Java 中如此流行的原因。你是对的，没有它们，Java 没有提供开箱即用的机制来轻松抽象实例化。*尽管如此，在您没有*在方法中创建对象的任何地方都会获得抽象，这应该是您的大部分代码。

顺便说一句，我通常鼓励人们不要遵循“IRealname”机制来命名接口。这是一个 Windows/COM 的东西，它把一只脚踩在了匈牙利符号的坟墓里，而且真的没有必要（Java 已经是强类型的，拥有接口的全部意义在于让它们在很大程度上与类类型没有区别）。

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-02-03T11:10:35.857

不要忘记，在以后你可以获取一个*现有的*类，并让它实现`IBox`，然后它就会对你所有的盒子感知代码可用。

如果接口被命名为*-able* ，这会变得更清楚一些。例如

```
public interface Saveable {
....

public interface Printable {
.... 
```

等（命名方案并不总是有效，例如我不确定`Boxable`这里是否合适）

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2016-03-04T21:16:07.453

> 接口的唯一目的是确保实现接口的类具有接口描述的正确方法？或者接口还有其他用途吗？

我正在使用**java 8**版本引入的界面新功能更新答案。

[从关于接口摘要的](https://docs.oracle.com/javase/tutorial/java/IandI/summary-interface.html)oracle 文档页面：

***接口声明可以包含***

1.  方法签名
2.  默认方法
3.  静态方法
4.  常量定义。

***唯一具有实现的方法是默认方法和静态方法。***

**接口用途**：

1.  定义**合同**
2.  将不相关的类**与具有能力的**类联系起来（例如，实现`Serializable`接口的类之间可能有也可能没有任何关系，除了实现该接口
3.  提供**可互换的**实现，[例如策略模式](https://dzone.com/articles/design-patterns-strategy)
4.  **默认方法**使您能够向库的接口添加新功能，并确保与为这些接口的旧版本编写的代码的二进制兼容性
5.  **使用静态方法组织库中的辅助方法**（您可以将特定于接口的静态方法保留在同一接口中，而不是在单独的类中）

*关于抽象类*和*接口*之间的区别以及带有工作示例的用例的一些相关 SE 问题：

[接口和抽象类有什么区别？](https://stackoverflow.com/questions/1913098/what-is-the-difference-between-an-interface-and-abstract-class/33957698#33957698)

[我应该如何解释接口和抽象类之间的区别？](https://stackoverflow.com/questions/18777989/how-should-i-have-explained-the-difference-between-an-interface-and-an-abstract/34978606#34978606)

查看[文档](https://docs.oracle.com/javase/tutorial/java/IandI/defaultmethods.html)页面以了解 java 8 中添加的新功能：*默认方法和静态方法*。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-02-04T14:54:30.397

接口的目的是**抽象**，或与实现解耦。

如果你在你的程序中引入一个抽象，你就不会关心可能的实现。您对它能做什么而不是*如何**做*感兴趣，并且您使用 an`interface`在 Java 中表达这一点。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-02T21:14:26.200

如果您有 CardboardBox 和 HtmlBox（两者都实现了 IBox），则可以将它们都传递给任何接受 IBox 的方法。即使它们非常不同且不能完全互换，但不关心“打开”或“调整大小”的方法仍然可以使用您的类（可能是因为它们关心在屏幕上显示某些内容需要多少像素）。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-02-02T21:17:17.570

将功能添加到 java 以允许多重继承的接口。Java的开发者虽然/意识到多重继承是一个“危险”的特性，这就是为什么他们想出了接口的想法。

多重继承是危险的，因为你可能有一个像下面这样的类：

```
 class Box{
    public int getSize(){
       return 0;
    }
    public int getArea(){
       return 1;
    }

}

class Triangle{
    public int getSize(){
       return 1;
    }
    public int getArea(){
       return 0;
    }

}

class FunckyFigure extends Box, Triable{
   // we do not implement the methods we will used the inherited ones
} 

```

这将是我们使用时应该调用的方法

```
 FunckyFigure.GetArea(); 

```

所有问题都通过接口解决，因为你知道你可以扩展接口并且它们不会有分类方法......当然编译器很好，它会告诉你是否没有实现方法，但我喜欢这样认为一个更有趣的想法的副作用。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2018-06-22T08:05:25.570

以下是我对接口优势的理解。如果我错了，请纠正我。想象一下，我们正在开发操作系统，而其他团队正在开发某些设备的驱动程序。所以我们开发了一个接口StorageDevice。我们有其他开发团队提供的两种实现方式（FDD 和 HDD）。

然后我们有一个 OperatingSystem 类，它可以通过传递一个实现了 StorageDevice 接口的类的实例来调用接口方法，例如 saveData。

这里的好处是我们不关心接口的实现。另一个团队将通过实现 StorageDevice 接口来完成这项工作。

```
package mypack;

interface StorageDevice {
    void saveData (String data);
}

class FDD implements StorageDevice {
    public void saveData (String data) {
        System.out.println("Save to floppy drive! Data: "+data);
    }
}

class HDD implements StorageDevice {
    public void saveData (String data) {
        System.out.println("Save to hard disk drive! Data: "+data);
    }
}

class OperatingSystem {
    public String name;
    StorageDevice[] devices;
    public OperatingSystem(String name, StorageDevice[] devices) {

        this.name = name;
        this.devices = devices.clone();

        System.out.println("Running OS " + this.name);
        System.out.println("List with storage devices available:");
        for (StorageDevice s: devices) {
            System.out.println(s);
        }

    }

    public void saveSomeDataToStorageDevice (StorageDevice storage, String data) {
        storage.saveData(data);
    }
}

public class Main {

    public static void main(String[] args) {

        StorageDevice fdd0 = new FDD();
        StorageDevice hdd0 = new HDD();     
        StorageDevice[] devs = {fdd0, hdd0};        
        OperatingSystem os = new OperatingSystem("Linux", devs);
        os.saveSomeDataToStorageDevice(fdd0, "blah, blah, blah...");    
    }
} 
```

# sql-server - 对标识列使用 uniqueidentifier(GUID) 还是 bigint 更好？

> ID：504905
> 
> 赞同：34
> 
> 时间：2009-02-02T21:08:02.580
> 
> 标签：sql-server

对于 SQL Server，对标识列使用 uniqueidentifier(GUID) 还是 bigint 更好？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-02-02T21:10:36.443

这取决于你在做什么：

*   如果速度是主要关注点，那么普通的旧`int`版本可能就足够了。
*   如果您确实将拥有超过 20 亿条（带有 B ;) ）记录，那么请使用`bigint`顺序 guid。
*   如果您需要能够轻松地与远程创建的记录同步，那就`Guid`太好了。

**更新**
有关 Guid 的一些附加（不太明显）注释：

*   它们可能对索引很苛刻，这会削弱数据库性能的核心
*   您可以使用顺序 guid 来恢复一些索引性能，但放弃第二点中使用的一些随机性。
*   Guid 可能很难手动调试 ( `where id='xxx-xxx-xxxxx'`)，但您也可以通过顺序 guid ( `where id='xxx-xxx' + '123'`) 获得其中的一部分。
*   出于同样的原因，Guids 可以使基于 ID 的安全攻击更加困难，但并非不可能。（您不能只键入`'http://example.com?userid=xxxx'`并期望获得其他人帐户的结果）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-02T21:09:24.700

一般来说，我会推荐一个`BIGINT`over a `GUID`（因为 guid 又大又慢），但问题是，你甚至需要那个吗？（即，您是否在进行复制？）如果您预计少于 20 亿行，那么传统的`INT`就可以了。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-02T21:11:52.040

您是在进行复制还是让销售人员运行需要合并的断开连接的数据库，使用 GUID。否则我会选择int或bigint。从长远来看，它们更容易处理。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-02T21:11:15.303

不取决于你需要什么。DB**性能**将从整数中获得，而 GUID 对于**复制**很有用，并且不需要从 DB 中听到已创建的标识，即代码可以在插入行之前创建 GUID 标识。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T21:11:44.943

如果您计划使用合并复制，则 a`ROWGUIDCOL`对性能有益（[请参阅此处了解信息](http://msdn.microsoft.com/en-us/library/ms152770.aspx)）。否则，我们需要更多关于您对“更好”的定义的信息；更好的是什么？

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2013-10-17T13:53:56.827

使用 GUID 可能有更多方面或要求。

*   如果主键是任何数字类型（Int、BigInt 或任何其他类型），那么您需要将其设为 Identity 列，或者您需要检查表中最后保存的值。
*   而在这种情况下，如果将外部表中的记录保存为事务，则很难获得主键的最后一个标识值。就像如果使用 IDENT_CURRENT 一样，那么在将记录保存在外键中时会再次影响性能。
*   所以如果保存记录为事务，那么先生成主键的Guid，然后将生成的键（Guid）保存在主表和外表中会很方便。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T21:10:42.527

这实际上取决于传入的信息是否是顺序的。我强烈建议用户使用 GUID 可能会更好。但是对于顺序数据，例如订单或其他需要轻松排序的东西，bigint 可能是更好的解决方案，因为它将被索引并提供快速排序而无需另一个索引的成本。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-02T21:11:15.927

这实际上取决于您是否期望在图片中进行复制。复制需要一个行 UUID，因此如果您打算这样做，您不妨提前进行。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-02T21:12:42.820

除非您真正需要 GUID，例如能够在任何地方生成密钥，而不仅仅是在服务器上，否则我会坚持使用基于 INTEGER 的密钥。GUID 的创建成本很高，并且使实际查看数据变得更加困难。另外，您是否尝试过在 SQL 查询中键入 GUID？这是痛苦的！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-02T21:15:05.840

我和安德鲁·罗林斯在一起。

现在你可以争论空间效率。一个 int 是什么，最多 8 个字节？一个向导会更长。

但我偏爱的主要原因有两个：可读性和访问时间。数字对我来说比 GUID 更容易（因为我总是可以轻松找到下一个/上一个记录）。

至于访问时间，请注意，某些数据库可能会开始出现 GUID 的大问题。我知道 MySQL 就是这种情况（[MySQL InnoDB Primary Key Choice: GUID/UUID vs Integer Insert Performance](http://www.kccoder.com/mysql/uuid-vs-int-insert-performance/ "标题")）。对于 SQL Server，这可能不是什么大问题，但需要注意。

我会说坚持使用INT或BIGINT。我认为您需要 GUID 的唯一一次是当您将它们分发出去并且出于安全原因不希望人们能够猜测其他记录的 ID 时。

# sql-server - 链接/事件到 sql server 报告服务 2004 中的另一个报告

> ID：504908
> 
> 赞同：4
> 
> 时间：2009-02-02T21:08:57.977
> 
> 标签：sql-server, reporting-services

大家好，提前感谢。有没有办法提供从一个 .rdl 到另一个详细信息报告的链接。我正在使用 .net 1.1，我相信这是 SSRS 的第一个版本。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-02T21:56:15.103

如果我正确理解您的问题，SSRS 报告可以通过 URL 直接链接到另一个报告。

下面的文章讨论了可以在 sql server 报告中使用的各种导航类型。

[http://msdn.microsoft.com/en-us/library/aa964132(SQL.90).aspx#rsrptnvdrldn05](http://msdn.microsoft.com/en-us/library/aa964132(SQL.90).aspx#rsrptnvdrldn05)

# c# - 数据库部署策略 (SQL Server)

> ID：504909
> 
> 赞同：52
> 
> 时间：2009-02-02T21:09:10.067
> 
> 标签：c#, asp.net, sql-server-2005, svn, visual-studio-2005

我正在寻找一种方法来进行日常部署并使数据库脚本与版本保持一致。

目前，我们有一种相当不错的方式来部署我们的源代码，我们有单元代码覆盖、持续集成和回滚过程。

问题是使数据库脚本与发布保持一致。每个人似乎都在测试数据库上尝试脚本，然后实时运行它们，当 ORM 映射更新（即更改生效）时，它会选择新列。

第一个问题是脚本不必写在任何地方，通常每个人都“尝试”将它们放入 Subversion 文件夹，但有些懒惰的人只是实时运行脚本，大多数时候没有人知道谁做了什么给数据库。

第二个问题是我们有 4 个测试数据库，它们总是不符合要求，唯一真正将它们对齐的方法是从实时数据库中恢复。

我坚信这样的过程需要简单、直接且易于使用才能帮助开发人员，而不是阻碍他们。

我正在寻找的是使开发人员能够轻松记录他们的数据库脚本以便它们可以作为发布过程的一部分运行的技术/想法。**开发人员希望遵循的过程**。

任何故事、用例甚至链接都会有所帮助。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-02-05T21:26:10.213

对于这个问题，我选择使用迁移工具： [Migratordotnet](http://code.google.com/p/migratordotnet/)。

使用迁移（在任何工具中），您有一个简单的类用于执行更改并撤消它们。这是一个例子：

```
[Migration(62)]
public class _62_add_date_created_column : Migration
{
    public void Up()
    {
       //add it nullable
       Database.AddColumn("Customers", new Column("DateCreated", DateTime) );

       //seed it with data
       Database.Execute("update Customers set DateCreated = getdate()");

       //add not-null constraint
       Database.AddNotNullConstraint("Customers", "DateCreated");
    }

    public void Down()
    {
       Database.RemoveColumn("Customers", "DateCreated");
    }
} 
```

此示例说明如何处理易失性更新，例如将新的非空列添加到具有现有数据的表中。这可以轻松实现自动化，您可以轻松地在版本之间上下移动。

这对我们的构建来说是一个非常有价值的补充，并且**极大地**简化了流程。

我在这里发布了 .NET 中各种迁移框架的比较：http: [//benscheirman.com/2008/06/net-database-migration-tool-roundup](http://benscheirman.com/2008/06/net-database-migration-tool-roundup)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-02T21:16:44.230

阅读[K.Scott Allen 关于数据库版本控制的系列文章](http://odetocode.com/Blogs/scott/archive/2008/01/31/11710.aspx)。
我们基于他描述的技术构建了一个用于以受控方式应用数据库脚本的工具，并且效果很好。
然后，这可以用作持续集成过程的一部分，当对保存数据库升级脚本的 URL 进行提交时，每个测试数据库都部署了更改。我建议使用基线脚本和升级脚本，以便您始终可以运行一系列脚本以将数据库从当前版本获取到所需的新状态。
不过，这仍然需要开发人员的一些流程和纪律（所有更改都需要整合到新版本的基本安装脚本和补丁脚本中）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-02T21:44:15.097

几年来，我们一直在使用 RedGate 的 SQL Compare：

[http://www.red-gate.com/products/index.htm](http://www.red-gate.com/products/index.htm)

专业版有一个命令行界面，您可以使用它来设置您的部署过程。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-05T21:47:59.907

我们使用[K. Scott Allen](http://odetocode.com/Blogs/scott/archive/2008/01/31/11710.aspx)描述的数据库版本控制的修改版本。我们使用[数据库发布向导](http://www.codeplex.com/sqlhost/Wiki/View.aspx?title=Database%20Publishing%20Wizard)来创建原始基线脚本。然后是一个基于 SQL SMO 的自定义 C# 工具来转储存储过程、视图和用户函数。包含模式和数据更改的更改脚本由[Red Gate](http://www.red-gate.com/)工具生成。所以我们最终得到了一个类似的结构

```
Database\
    ObjectScripts\ - contains stored procs, views and user funcs 1-per file
    \baseline.sql - database snapshot which includes tables and data
    \sc.01.00.0001.sql - incremental change scripts
    \sc.01.00.0002.sql
    \sc.01.00.0003.sql 
```

自定义工具在必要时创建数据库，在必要时应用 baseline.sql，在必要时添加 SchemaChanges 表，并在必要时根据 SchemaChanges 表中的内容应用更改脚本。每次我们通过 cc.net 进行部署构建时，该过程都会作为 nant 构建脚本的一部分发生。

如果有人想要 schemachanger 应用程序的源代码，我可以把它扔到 codeplex/google 或任何地方。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-02T21:18:59.640

到这里：

[https://blog.codinghorror.com/get-your-database-under-version-control/](https://blog.codinghorror.com/get-your-database-under-version-control/)

向下滚动到 odetocode.com 网站的 5 个链接列表。精彩的五部分系列。我会以此为起点来获取想法并找出适合您团队的流程。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-02T21:42:26.177

如果您正在谈论尝试保持数据库模式同步，请尝试使用[Red Gate SQL 比较 SDK](http://www.red-gate.com/products/SQL_Comparison_SDK/index.htm)。基于创建脚本 (newDb) 构建临时数据库 - 这就是您希望数据库的样子。将 newDb 与旧数据库 (oldDb) 进行比较。从该比较中获取更改集并使用 Red Gate 应用它。您可以将此升级过程构建到您的测试中，并且您可以尝试让所有开发人员同意在一个地方保存数据库的创建脚本。同样的做法适用于跨多个版本升级数据库并在每个步骤之间运行数据迁移脚本和流程（使用 XML 文档映射创建和数据迁移脚本）

编辑：使用 Red Gate 技术，您只关心创建脚本，而不是升级脚本，因为 Red Gate 提供了升级脚本。它还可以让您删除和创建索引、存储过程、函数等。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-02T21:17:00.703

您应该考虑使用 MSBuild 或 NAnt 等构建工具。我们使用 CruiseControl.NET、NAnt 和 SourceGear Fortress 的组合来处理我们的部署，包括 SQL 对象。NAnt db 构建任务调用 sqlcmd.exe 以在我们的开发和登台环境中更新脚本，然后将它们签入 Fortress。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-09-11T19:31:07.880

我们使用[Visual Studio for Database Professionals](http://msdn.microsoft.com/en-us/library/dd193266.aspx)和 TFS 来版本化和管理我们的数据库部署。这使我们可以像对待代码一样对待我们的数据库（签出、签入、锁定、查看版本历史、分支、构建、部署、测试等），如果我们愿意，甚至可以将它们包含在相同的解决方案文件中。

我们的开发人员可以在本地数据库上工作，以避免在共享环境中踩到彼此的更改。当他们将数据库更改检查到 TFS 中时，我们有持续集成来构建、测试和部署到我们的集成开发环境。我们在发布分支上有单独的构建，以便为每个后续环境创建不同的部署脚本。

稍后，如果在发布中发现错误，我们可以转到发布分支并同时修复代码和数据库。

这是一个很棒的产品，但由于微软的营销失误，它的采用在早期受到了阻碍。它最初是 Team System 下的一个独立产品。这意味着为了同时使用开发者版和数据库版的功能，您需要升级到更昂贵的 Team Suite 版。我们（和许多其他客户）为此让微软感到悲痛，我们很高兴他们今年宣布[DB Pro 已被合并到开发者版](http://blogs.msdn.com/vstsdb/archive/2009/02/24/visual-studio-team-system-development-and-database-editions-merged.aspx)中，并且任何获得开发者版许可的人都可以立即安装数据库版。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-09-18T21:11:01.217

Gus 不经意地提到了[DB Ghost](http://www.innovartis.co.uk/)（上图）——我认为它是一种潜在的解决方案。

我的公司如何使用 DB Ghost 的简要概述：

*   在初始开发过程中合理确定新数据库的架构后，我们使用 DB Ghost 'Data and Schema Scripter' 为所有数据库对象（和任何静态数据）创建脚本 (.sql) 文件，然后签入这些脚本文件到源代码控制中（该工具将对象分成文件夹，例如“存储过程”、“表”等）。此时，我们可以使用 DB GHost 'Packager' 或 'Packager Plus' 工具来创建一个独立的可执行文件，从而从这些脚本中创建一个新的 DB。
*   对数据库模式的所有更改都通过签入特定脚本文件来签入到源。
*   在任何时候，我们都可以使用打包程序来创建可执行文件，以 (a) 创建新数据库或 (b) 更新现有数据库。某些与路径相关的更改（例如，需要更新数据的更改）需要一些自定义，但我们有运行前更新和更新后的脚本。

“更新”过程涉及创建一个干净的“源”数据库，然后（在更新前自定义脚本之后）比较源数据库和目标数据库的模式。DB Ghost 更新目标数据库以匹配

我们经常对生产数据库进行更改（我们在 7 个不同的生产环境中有 14 个客户），但不可避免地会使用 DB Ghost 更新可执行文件（在我们的构建过程中创建）部署足够大的更改集。任何未签入到源（或未签入到正在发布的相应分支）的生产更改都将丢失。这迫使每个人都一致地签入更改。

总结一下：

*   如果您强制执行使用 DB Ghost 更新可执行文件部署所有数据库更新的策略，则可以“强制”开发人员一致地签入他们的更改，而不管它们是否在此期间手动部署。
*   在构建过程中添加一个（或多个）步骤以创建 DB Ghost 更新可执行文件将有效地执行测试以验证是否可以从脚本创建 DB（即，因为 DB Ghost 创建一个“源”DB，即使在创建更新可执行包）并且如果您添加一个（或多个步骤）来执行更新包[在您提到的四个测试数据库中的任何一个上]，您可以使您的测试数据库与源代码保持一致。

使用此工具（实际上是一套相关工具）“轻松”部署哪些更改有一些警告和一些限制，但它们都相当小（至少对我的公司而言）：

*   重命名对象必须在自定义脚本之一中完成
*   整个数据库总是更新的（例如，单个模式中的对象不能单独更新）使得难以支持主应用程序数据库中的客户特定对象

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-09-10T14:18:06.553

这些帖子中有很多我想要跟进的链接（我几年前“推出了我自己的”系统，必须看看是否有相似之处）。你需要的一件事，我希望在这些链接中提到，就是纪律。如果有人可以随时更改任何内容，我不太明白任何自动化系统如何工作。（您的问题暗示这可能发生在您的生产系统上，但显然这不可能。）

让一个人（传说中的“数据库管理员”）专门负责管理数据库（尤其是生产数据库）更改的任务是一种非常常见的解决方案。至于保持 X 开发和测试数据库之间的一致性：如果它/它们被许多用户使用，那么最好再次让个人充当更改的“票据交换所”；如果每个人都有自己的数据库实例，那么他们有责任保持它的有序性，并且当他们需要更新的基线数据库时，拥有一个中央一致的数据库“源”将是至关重要的。

这是最近的 Stack Overflow 帖子，可能会引起您的兴趣：[how-to-refresh-a-test-instance-of-sql-server-with-production-data-without-using](https://stackoverflow.com/questions/1349628/how-to-refresh-a-test-instance-of-sql-server-with-production-data-without-using-f/1349767)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-09-10T15:00:37.883

[Refactoring Databases](http://www.agiledata.org/essays/databaseRefactoring.html)一书在概念层面解决了许多这些问题。

就工具而言，我知道[DB Ghost](http://www.innovartis.co.uk/)适用于 SQL Server。我听说 Visual Studio 的[Data Dude](http://blogs.msdn.com/gertd/archive/2007/11/21/visual-studio-team-system-2008-database-edition.aspx)版本在最新版本中确实得到了改进，但我没有任何经验。

就真正实现持续集成风格的数据库开发而言，由于您需要大量的数据库副本，它会非常迅速地占用资源。当数据库可以安装在开发人员工作站上时，这是非常可行的，但当数据库太大以至于需要跨网格部署时，这是不切实际的。要做到这一点，您基本上需要每个开发人员 1 个数据库副本 [进行 DDL 更改的开发人员，而不仅仅是对 procs 的更改] + 6 个通用副本。常见的副本如下：

1.  INT DEV --> 开发人员“签入”他们对 INT DEV 的重构以进行集成测试。当集成测试通过时，这个数据库被复制到 DEV。
2.  DEV --> 这是数据库的“官方”开发副本。INT DEV 使用 DEV 的副本定期刷新。致力于新重构的开发人员从 DEV 获得数据库的新副本。
3.  INT QA --> 与 INT DEV 的想法相同，但 QA 团队除外。当集成测试在此处通过时，此数据库将被复制到 QA 和 DEV*。
4.  质量保证
5.  INT PROD --> 除了生产之外，与 INT QA 的想法相同。当此处通过集成测试时，此数据库将复制到 PROD、QA* 和 DEV*
6.  产品

*当跨 DEV/QA/PROD 行复制数据库时，您还需要运行脚本来更新与特定环境相关的测试数据（例如，在 QA 中设置 QA 团队用来测试但在生产中不存在的用户）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-09-11T19:49:56.710

一种可能的解决方案是研究在您的测试数据库上实施 DML 审计，然后将这些审计日志滚动到一个脚本中以进行最终测试和实时部署。SQL Server 2008 显着改进了 DML 审计，但即使 SQL Server 2005 也通过触发器支持它。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-12-11T18:23:05.103

Red Gate 有一篇论文描述了如何实现构建自动化：http: [//downloads.red-gate.com/HelpPDF/ContinuousIntegrationForDatabasesUsingRedGateSQLTools.pdf](http://downloads.red-gate.com/HelpPDF/ContinuousIntegrationForDatabasesUsingRedGateSQLTools.pdf)

这是围绕[SQL Source Control](http://www.red-gate.com/products/sql-development/sql-source-control/)构建的，它与 SSMS 和您现有的源代码控制系统集成。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-04-01T13:10:50.170

我编写了一个基于 .NET 的工具来自动处理数据库版本控制。我们一直在生产中使用此工具来处理向多个环境推出数据库更新（包括补丁），在每个已运行脚本的数据库中保留日志，并以自动化方式完成所有操作。它有一个命令行控制台，因此您可以创建使用此工具的批处理脚本。看看：[https ://github.com/bmontgomery/DatabaseVersioning](https://github.com/bmontgomery/DatabaseVersioning)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2011-07-27T11:57:08.487

就其价值而言，这是我的前雇主使用的简单、低成本方法的真实示例（作为基本的第一步，我试图给当前雇主留下深刻印象）。

添加一个名为“DB_VERSION”或类似名称的表。在每个升级脚本中，在该表中添加一行，该行可以包含尽可能少或尽可能多的列来描述升级，但至少我建议{ VERSION，EXECUTION_DATE，DESCRIPTION，EXECUTION_USER}。现在，您对所发生的事情有了具体的记录。如果有人运行他们自己的未经授权的脚本，您仍然需要遵循上述答案的建议，但这只是显着改进现有版本控制（即没有）的一种简单方法。

现在让我们有一个从数据库的 v2.1 到 v2.2 的升级脚本，并且您想验证孤独的特立独行的家伙实际上已经在他的数据库上运行它，您可以只搜索 VERSION = 'v2.2' 和如果得到结果，请不要运行此升级脚本。如有必要，可以内置到控制台实用程序应用程序中。

# signal-processing - TI DSP 中的 17 位和 40 位数学是怎么回事？

> ID：504919
> 
> 赞同：1
> 
> 时间：2009-02-02T21:10:51.403
> 
> 标签：signal-processing

TMS320C55x 有一个 17 位 MAC 单元和一个 40 位累加器。为什么使用非 2 宽度单位？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-03T01:14:42.597

40 位累加器在一些 TI DSP 中很常见。这个想法基本上是您可以累积多达 256 个任意 32 位产品而不会溢出。（与在 C 中，如果你使用 32 位产品，你可以很快溢出，除非你使用 64 位整数。）

访问这些功能的唯一方法是通过汇编代码或特殊的编译器内在函数。如果使用常规的 C/C++ 代码，累加器是不可见的。您无法获得指向它的指针。

因此，没有任何真正需要遵守 2 次方方案。DSP 内核已针对功耗/性能权衡进行了相当优化。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-02T21:13:52.427

我可能在这里谈论我的帽子，但我希望看到 17 位的东西用来避免在添加/减去 16 位样本时需要单独的进位位。

# sql - SQL 表子查询

> ID：504920
> 
> 赞同：0
> 
> 时间：2009-02-02T21:10:57.877
> 
> 标签：sql, mysql, database, subquery

假设说，我有两个名为`foo`and的表。`bar`

foo 有列`foo_id`，`foo_fluff` bar 有列`bar_id`，，`foo_id``timestamp`

我需要一个查询，它将检索表格栏包含的任何 foo_id 的返回一行，并带有最新的时间戳。

因此，如果 bar 有三行，其中两行的 foo_id 为 1，其中 1 的 foo_id 为 2，它将返回 2 行。对于 foo_id 1 ，它将返回两行中时间戳较大的行。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-02T21:17:57.380

我认为这就是您要寻找的（除非它必须是子查询而不是联接）

```
select max(bar.timestamp), foo.foo_fluff 
 from foo
 inner join bar
          on foo.foo_id = bar.foo_id
 group by foo.foo_fluff 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-02T21:17:51.093

```
SELECT timestamp FROM bar GROUP BY foo_id ORDER BY timestamp DESC 
```

如果要从 foo 表中选择数据，只需在 foo_id 上加入 foo 表

# javascript - 带脚本的文本编辑器...适用于 Linux

> ID：504943
> 
> 赞同：5
> 
> 时间：2009-02-02T21:14:48.167
> 
> 标签：javascript, linux, scripting, cross-platform, text-editor

一段时间以来，我一直在我的 Windows 机器上使用 UltraEdit。事实证明，使用熟悉的语言 (JavaScript) 编写脚本的能力非常有用。唯一的问题是我不能在我的 Linux 机器上使用它。是否有在 Linux 上运行并具有集成脚本引擎的类似文本编辑器？

不破坏银行并且跨平台会很棒。

编辑：虽然可录制的宏很棒，但我更多地使用脚本引擎。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-02-02T21:42:17.627

所有主要的开源编辑器和大多数其他编辑器都具有某种描述的脚本工具——一些（尤其是 Emacs）以它而闻名。唯一不会像[pico 这样非常轻量级的。](http://en.wikipedia.org/wiki/Pico_(text_editor))

[vim](http://www.vim.org)具有[本机脚本语言](http://vimdoc.sourceforge.net/htmldoc/usr_41.html)，也可以使用嵌入式[Python、](http://www.python.org) [Tcl](http://www.tcl.tk)或[Perl](http://www.cpan.org)解释器构建，这些解释器可以通过插件机制对选择、缓冲区等进行操作。 [Emacs](http://www.gnu.org/software/emacs/)完全是关于脚本的——它有一个内置于系统核心的 LISP 解释器，并且大部分编辑器都是用 LISP 编写的。有一个关于 emacs 的笑话将其描述为一个 LISP 解释器，有人碰巧用它来编写文本编辑器。

Vim 的用户界面源自 vi，它有点古怪，但一旦你习惯了它就会非常强大。它还特别好地录制了键盘宏，并具有非常好的正则表达式搜索/替换工具。

Emacs 被认为有点像巴洛克式的怪物，而且非常庞大和复杂。然而，它的脚本功能是首屈一指的，并且有[各种各样的宏包](http://www.emacswiki.org/emacs/WikifiedEmacsLispList)可以做很多事情。它有一群非常忠诚的追随者；一旦您克服了学习曲线（网络上有大量资源可以帮助您解决此问题），它确实是一个非常强大的系统。您可以将 emacs 自定义为一个完整的 IDE，并且周围有人声称将大部分时间都花在其中。

这两个编辑器都可以在文本模式或 GUI 下工作，并且具有高度的可移植性，可在各种平台上运行。它们都是开源的。

我都用过；我曾经在 1990 年代使用[XEmacs](http://www.xemacs.org/)（可以追溯到几年前的 emacs 的主要代码分支），但后来又使用了 vim。我什至在 Windows 上使用 vim。

如果您觉得 Vim 或 Emacs 的用户界面有点过多，还有[许多其他可用的文本编辑器](http://en.wikipedia.org/wiki/Category:Linux_text_editors)，其中许多都提供脚本。其中的例子是[SciTE](http://www.scintilla.org/SciTEDoc.html)，它有一个内置的[Lua](http://www.lua.org/)解释器，[NEdit，](http://www.nedit.org/)它有一个自己的自制宏语言或[GEdit](http://projects.gnome.org/gedit/)，它基本上是用[Python](http://www.python.org)编写的（也可以用于编写脚本）并有一个插件 API。

**编辑：**在一些特定项目（例如[Mozilla](http://www.mozilla.org/)）之外，Javascript 作为独立或嵌入式脚本语言在开源圈子中从来没有受到太大的关注。从历史上看，没有一种流行的开源 Javascript 解释器能像 Python 或 Tcl/Tk 那样被广泛接受。Javascript 更广泛地用于封闭源代码系统，例如 UltraEdit 或 InDesign（仅举几例），而其他语言在开源项目中更受欢迎。

我所知道的开源文本编辑器都没有将 javascript 作为脚本语言的一个选项（如果您知道的话，请随意介入并评论或编辑）。您可能不得不将 Javascript 迁移到另一种语言，例如 Python 或 LISP。然而，现在 QT 带有一个 Javascript 解释器 (QTScript)，您可能会发现一些基于 KDE 的解释器提供了它作为脚本选项，但我并没有特别意识到任何在我脑海中的东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-02T21:18:55.523

emacs 是免费的，并且有自己的嵌入式 lisp 方言，几乎可以用来编写任何东西，包括轻量级脚本以及邮件用户代理和 IRC 客户端；-)

有一点学习曲线，但我对 emacs 的体验非常积极。我不太喜欢模态界面，并且没有其他编辑器将导航快捷方式放在您的手指下。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-02T21:20:15.690

我使用[jEdit](http://jedit.org/)，这是一个很棒的编辑器，允许使用 beanshell 编写脚本。由于它是用 Java 编写的，因此它在 Windows 和 Linux 下运行良好。

Simon Groenewolt 提到，存在一个插件 ( [JavascriptShell](http://plugins.jedit.org/plugins/?JavaScriptShell) )，它允许您在 Javascript 中编写宏和脚本，而不仅仅是在 Beanshell 中。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-02T21:43:34.847

Vim 无处不在，vimscript 非常简单且面向文本编辑：http: [//vimdoc.sourceforge.net/htmldoc/usr_41.html](http://vimdoc.sourceforge.net/htmldoc/usr_41.html)

这是默认的。你也可以使用 Python、Ruby、Perl、Scheme……但这需要编译。

Python 可能是一个不错的选择，因为omnicomplete 需要它。无论如何，我为omnicomplete运行一个单独的二进制文件，因为我喜欢超精益vim用于其他用途，请在此处查看：http: [//vim.wikia.com/wiki/Compile_a_separate_copy_of_Vim_for_Python_coding](http://vim.wikia.com/wiki/Compile_a_separate_copy_of_Vim_for_Python_coding)

老实说，我没有使用 python 本身编写 vim 脚本。我通常使用 vanilla vim 编写代码，无论是否使用 python，并且没有自动完成功能。但是，我确实从 vim 调用 python 和任何其他命令来逐行处理我的文件，如果您有兴趣，可能会回复更多关于此的信息，但这不需要编译任何东西，按原样工作。

编辑：如果你想要一个点击式编辑器，你可以在 gVim [http://cream.sourceforge.net/download.html](http://cream.sourceforge.net/download.html)上运行 Cream 我仍然认为 vim 需要一点时间来适应并且非常值得学习，更重要的是，考虑到您可以使用您的基本 vi 知识通过 SSH 连接到服务器没问题，并且它安装在任何 *nix 中。我喜欢我可以重复使用的知识，从长远来看可以节省我的时间和麻烦。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-02T21:26:39.843

如果您不需要非常复杂的脚本，vim/gvim 允许您记录击键序列并播放它。并且您可以对播放进行重复计数，这样您就可以在一行上记录一个操作，然后一步一步重复接下来的 10,000 行。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-02T21:50:55.940

哇，我真的不想在这里发动一场圣战，但是所有这些 Emacs 建议都没有抓住重点。Emacs 非常强大，但说实话。它不像学习墙那样有学习曲线。从像 UltraEdit 这样的点击式 IDE 风格的编辑器出发，将会产生巨大的文化冲击。

老实说，当有人说他们喜欢用 javascript 编写脚本并在 Linux 中寻找类似的东西时，你说的第一件事就是*“学习 LISP”*？！

**这就是为什么人们认为 Linux 很难使用的原因**

* * *

我将完全转向另一个方向并建议[Aptana Studio](http://www.aptana.com)

它具有针对多种语言的内置突出显示和代码完成功能，并支持使用[Eclipse Monkey](http://72.3.219.182/docs/index.php/About_Eclipse_Monkey)在 javascript 中编写脚本。它基于 Eclipse，因此在 java 上运行，因此是多平台的。它是免费提供的。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-02T21:17:38.160

这有点陈词滥调，但是emacs。还是我误解了 UE 的脚本引擎是什么？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-02T21:18:32.793

试试 Emacs，无论是 XEmacs 还是 GNU Emacs。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-02T21:47:27.227

我使用gedit。你可以用 Python 编写插件。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-02T21:56:46.070

[Komodo Edit](http://www.activestate.com/store/download.aspx?prdGUID=20f4ed15-6684-4118-a78b-d37ff4058c5f)是在 Mozilla 的 XUL Runner 之上制作的。它提供了通过扩展（如 Firefox）或宏、片段、命令来扩展它的可能性。您可以用 JavaScript 或 Python 编写这些代码片段，这很好，但您仍然必须了解[API](http://docs.activestate.com/komodo/5.0/komodo-js-api.html)才能做一些有用的事情。

它采用 Mozilla 技术构建，也可以在 Linux 上运行。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-02-04T21:55:48.880

看起来[Komodo Edit](http://www.activestate.com/store/download.aspx?prdGUID=20f4ed15-6684-4118-a78b-d37ff4058c5f)、[SciTE](http://scintilla.sourceforge.net/SciTEDoc.html)和[Eclipse Monkey](http://72.3.219.182/docs/index.php/About_Eclipse_Monkey)是赢家。Komodo Edit 似乎与 Ultra Edit 最相似。SciTE 是我以前用过的东西，Lua 没那么难；[SciTE 的 API](http://www.scintilla.org/SciTELua.html)虽然不像[Komodo Edit 的 API](http://docs.activestate.com/komodo/5.0/komodo-js-api.html)那样广泛。Eclipse Monkey 是我肯定会使用的东西，但它需要 Eclipse，它绝对不是文本编辑器。

编辑：UltraEdit 即将推出 Mac 和 Linux。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-02-02T22:05:41.527

在 Linux 中进行脚本文本编辑的传统方法是使用在 *nixes 中（几乎）一直可用的工具：sed、awk、grep 等。当然，它们可能看起来不像集成的 Javascript 引擎那样“方便”，但它们非常成熟并且运行良好。如果这种脚本语言必须在编辑器中，Emacs 在这里可能也是一个不错的选择。

正如许多其他人提到的那样，您可以使用“集成”类型的解决方案来解决问题，但恕我直言，命令行在这方面更强大。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-02T22:45:37.640

[SciTE](http://scintilla.sourceforge.net/SciTEDoc.html)可以使用[Lua](http://www.scintilla.org/SciTELua.html)编写脚本，并且是一款出色、简单的编辑器，如果您每天在 Linux 和 Windows 之间切换，它的行为方式几乎相同。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-03T11:42:55.857

我不知道您将编辑器中的脚本功能用于什么目的，但您可能需要考虑使用 Linux 命令行工具（例如[sed](http://www.gnu.org/software/sed/manual/sed.html)或[awk](http://www.delorie.com/gnu/docs/gawk/gawk_toc.html) ）自动执行这些任务。

# forms - 什么时候应该使用 GET 或 POST 方法？他们之间有什么区别？

> ID：504947
> 
> 赞同：269
> 
> 时间：2009-02-02T21:15:47.213
> 
> 标签：forms, http, post, get, http-method

使用`GET`或`POST`方法有什么区别？哪个更安全？他们每个人的（缺点）优点是什么？

（[类似问题](https://stackoverflow.com/questions/46585/when-do-you-use-post-and-when-do-you-use-get)）

* * *

## 回答 #1

> 赞同：283
> 
> 时间：2009-02-02T21:23:11.613

这不是安全问题。HTTP 协议将 GET 类型的请求定义为[幂等](https://stackoverflow.com/questions/1077412/what-is-an-idempotent-operation)，而 POST 可能有副作用。用简单的英语来说，这意味着 GET 用于查看某些内容，而不更改它，而 POST 用于更改某些内容。例如，搜索页面应使用 GET，而更改密码的表单应使用 POST。

另外，请注意 PHP 有点混淆了这些概念。POST 请求从查询字符串和请求正文中获取输入。GET 请求只是从查询字符串中获取输入。所以 POST 请求是 GET 请求的超集；您可以`$_GET`在 POST 请求中使用，并且在其中包含具有相同名称的参数甚至可能是有意义的`$_POST`，`$_GET`这意味着不同的东西。

例如，假设您有一个用于编辑文章的表单。article-id 可能在查询字符串中（因此，可以通过 获得`$_GET['id']`），但假设您要更改 article-id。然后新的 id 可能会出现在请求正文 ( `$_POST['id']`) 中。好吧，也许这不是最好的例子，但我希望它能说明两者之间的区别。

* * *

## 回答 #2

> 赞同：85
> 
> 时间：2009-02-02T21:17:59.987

当用户在表单中输入信息并单击提交时，可以通过两种方式将信息从浏览器发送到服务器：在 URL 中，或在 HTTP 请求的正文中。

前面示例中使用的 GET 方法将名称/值对附加到 URL。不幸的是，URL 的长度是有限的，所以这种方法只有在只有几个参数的情况下才有效。如果表单使用大量参数，或者如果参数包含大量数据，则 URL 可能会被截断。此外，在 URL 上传递的参数在浏览器的地址字段中可见，而不是显示密码的最佳位置。

GET 方法的替代方法是 POST 方法。此方法将名称/值对打包在 HTTP 请求的正文中，这使得 URL 更清晰，并且对表单输出没有大小限制。它也更安全。

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2011-04-04T06:10:51.743

最好的答案是第一个。

您正在使用：

*   **获取数据时要获取数据（GET DATA）**。****
***   **POST**当你想发送数据时（POST DATA）。**

 *** * *

## 回答 #4

> 赞同：27
> 
> 时间：2009-02-02T22:19:44.103

使用`GET`. 由于数据出现在 URL 字符串中，因此可能有人在地址栏/URL 上查看您的肩膀可能能够查看他们不应该知道的内容，例如可能被用来劫持您的会话的会话 cookie。请记住，*每个人*都有照相手机。

另一个安全隐患`GET`与`GET`作为请求 URL 的一部分记录到大多数 Web 服务器访问日志的变量有关。根据情况、监管环境和数据的一般敏感性，这可能会引起关注。

一些客户端/防火墙/IDS 系统可能会对`GET`包含过多数据的请求不满意，因此可能会提供不可靠的结果。

`POST`支持高级功能，例如支持用于将文件上传到 Web 服务器的多部分二进制输入。

`POST`需要一个 content-length 标头，这可能会增加特定于应用程序的客户端实现的复杂性，因为必须提前知道提交的数据大小，从而防止客户端请求以独占的单通道增量模式形成。对于那些选择滥用`HTTP`它作为 RPC（远程过程调用）传输的人来说，这可能是一个小问题。

其他人已经很好地涵盖了这个问题的语义差异和“何时”部分。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2009-02-02T21:23:28.913

如果有大量数据或某种敏感信息（真正敏感的东西也需要安全连接），您应该使用 POST。

如果您希望人们能够为您的页面添加书签，请使用 GET，因为所有数据都包含在书签中。

请注意人们使用 GET 方法点击 REFRESH，因为每次都会再次发送数据而不会警告用户（POST 有时会警告用户重新发送数据）。

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2009-02-02T21:23:11.597

当我**从URL 中检索信息时使用 GET，当我****向**URL发送信息时使用 POST 。

* * *

## 回答 #7

> 赞同：17
> 
> 时间：2014-04-02T15:51:22.037

这个[W3C 文档](http://www.w3.org/2001/tag/doc/whenToUseGet.html)解释了 HTTP GET 和 POST 的使用。

我认为这是一个权威来源。

摘要是（文件的第 1.3 节）：

> *   如果交互更像是一个问题（即，它是一个安全操作，例如查询、读取操作或查找），则使用**GET 。**
> *   在以下情况下使用**POST**：
>     *   交互更像是一个命令，或者
>     *   交互以用户感知的方式更改资源的状态（例如，订阅服务），或
>     *   用户应对交互结果负责。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2009-02-02T21:21:21.163

Get 和 Post 方法与您使用的服务器技术无关，它在 php、asp.net 或 ruby​​ 中的工作方式相同。GET 和 POST 是 HTTP 协议的一部分。正如标记所指出的，POST 更安全。POST 表单也不会被浏览器缓存。POST 也用于传输大量数据。

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2009-02-03T18:47:17.510

更改数据时使用 POST 的原因：

*   像 Google Web Accelerator 这样的网络加速器将点击页面上的所有 (GET) 链接并缓存它们。如果链接对事物进行更改，这将非常糟糕。
*   浏览器缓存 GET 请求，因此即使用户单击链接，它也可能不会向服务器发送请求以执行更改。
*   为了保护您的站点/应用程序免受 CSRF 攻击，您必须使用 POST。为了完全保护您的应用程序，您还必须在服务器上生成一个唯一标识符并将其发送到请求中。

此外，不要将敏感信息放在查询字符串中（只有 GET 选项），因为它会显示在地址栏、书签和服务器日志中。

希望这可以解释为什么人们说 POST 是“安全的”。如果您要传输敏感数据，则必须使用 SSL。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2014-06-26T12:07:51.480

`GET`并且`POST`是*可以*实现类似目标的 HTTP 方法

`GET`基本上是为了获取（检索）数据，A`GET`不应该有正文，所以除了 cookie 之外，传递信息的唯一地方是 URL 并且 URL 的长度有限，与发送的数据是一部分`GET`相比不太安全`POST`网址

`GET`发送密码、信用卡或其他敏感信息时 切勿使用！，URL中的每个人都可以看到数据，可以缓存数据。`GET`当我们重新加载或回调按钮时是无害的，它将被标记，参数保留在浏览器历史中，只允许ASCII字符。

`POST`可能涉及任何事情，例如存储或更新数据、订购产品或发送电子邮件。`POST`方法有一个主体。

`POST`方法是安全的，可以将敏感和机密信息传递给服务器，它不会在 URL 的查询参数中可见，并且参数不会保存在浏览器历史记录中。数据长度没有限制。当我们重新加载时，浏览器应该提醒用户数据即将被重新提交。`POST`方法无法添加书签

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2020-07-30T09:47:02.817

[这个问题和其他](https://stackoverflow.com/questions/3477333/what-is-the-difference-between-post-and-get)关于 SO的问题中的所有或大部分答案都与此相关`GET`并且`POST`被误导了。它们在技术上是正确的，并且正确地解释了[标准](https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods)，但在实践中却完全不同。让我解释：

`GET`被认为是[幂等](https://developer.mozilla.org/en-US/docs/Glossary/idempotent)的，但不是必须的。您可以将参数传递`GET`给对数据进行永久更改的服务器脚本。相反，`POST`被认为*不是*幂等的，但您可以`POST`对一个脚本不做任何更改的服务器。所以这是一种错误的二分法，在实践中是不相关的。

此外，说`GET`如果重新加载不会损害任何东西是错误的——当然，如果它调用的脚本和它传递的参数正在进行永久性更改（例如删除数据），它当然可以。也可以`POST`！

现在，我们知道这`POST`（到目前为止）更安全，因为它不会暴露正在传递的参数，也不会被缓存。另外，您可以传递更多数据，并`GET`获得一个干净、不混淆的 URL。它做了所有`GET`可以做的事情。所以它只是更好。至少在生产中。

所以在实践中，什么时候应该使用`GET`vs. `POST`？我`GET`在开发过程中使用，所以我可以查看和调整我传递的参数。我用它来快速尝试不同的值（例如测试条件）甚至不同的参数。如果我需要一组不同的参数，我可以做到这一点，而无需构建表单并且不必修改它。我只需根据需要在浏览器中编辑 URL。

一旦开发完成，或者至少稳定，我将所有内容切换到`POST`.

如果您能想到任何技术上的原因表明这是不正确的，我将非常乐意学习。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-03-05T10:06:49.087

1.  GET 方法用于发送不太敏感的数据，而 POST 方法用于发送敏感数据。
2.  与 GET 方法相比，使用 POST 方法可以发送大量数据。
3.  GET 方法发送的数据在浏览器标题栏中可见，而 POST 方法发送的数据不可见。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-03-06T18:33:07.913

如果要从 URL 检索资源，请使用 GET 方法。如果您点击浏览器的后退按钮，您总是可以看到最后一页，并且它可能被加入书签，因此它不如 POST 方法安全。

如果您想向 URL “提交”某些内容，请使用 POST 方法。例如你想创建一个谷歌账户，你可能需要填写所有详细信息，然后你点击“提交”按钮（这里调用POST方法），一旦你提交成功，然后尝试点击浏览器的返回按钮，您将收到错误或新的空白表格，而不是填写表格的最后一页。

* * *

## 回答 #14

> 赞同：-10
> 
> 时间：2012-09-30T05:45:26.053

**`GET`方法：**

*   它仅用于发送 256 个字符的日期

*   使用此方法时，可以在浏览器上看到信息

*   这是表单使用的默认方法

*   它没有那么安全。

* * *

**`POST`方法：**

*   它用于发送无限数据。

*   使用这种方法，在浏览器上看不到信息

*   您可以明确提及该`POST`方法

*   它比`GET`方法更安全

*   它提供了更高级的功能

# c - 在释放指针变量指向的内容后重用它们是否安全？

> ID：504948
> 
> 赞同：11
> 
> 时间：2009-02-02T21:16:13.827
> 
> 标签：c, memory, pointers

在释放指针指向的数据后重用指针是否安全且可预测？

例如：

```
char* fileNames[] = { "words.txt", "moreWords.txt" };
char** words = NULL;
int* wordsCount = NULL;
for ( i = 0; i < 2; ++i ) {
    data = fopen( fileNames[i], "r" );
    words = readWords( data );
    wordsCount = countWords( words );

    free( wordsCount );
    for ( j = 0; words[j]; ++j )
        free( words[j] );
    free( words );
    fclose( data );
} 
```

*省略错误检查

我正在运行代码并且它似乎在运行（没有警告、错误或内存问题），但我想知道在大多数环境（特别是在典型的 Linux 环境中）使用它是否安全且可预测？

如果这不是“安全且可预测的”，那么在两个不同文件上完成相同操作的最佳方法是什么，而不是创建两倍数量的指针等？

**编辑：**我在问是否可以在释放指针**变量指向的内容后重用它。**我知道你不应该在释放后使用指针**值。**假设代码工作正常（它按预期工作，内存被正确释放等等）。我无法更改规格。对于这个任务。

谢谢！

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-02T21:21:28.760

What you're doing is fine: because, after you release a pointer, you're reinitializing it before you reuse it.

If the question is "is it safe to reuse a pointer **value** after freeing it" then the answer is "no".

If the question is "is it safe to reuse a pointer **variable** after freeing its value" then the answer is "yes, provided you reinitialize it to a (new) valid value before you reuse it".

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-02T21:18:43.430

是的。那是安全的。（丑陋，但安全:)）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-02T21:21:18.277

I can't tell. It looks safe, but I don't see the memory allocations so I can't be sure you're freeing the right things.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T21:21:44.347

I can't see any technical issue with reusing them. It might harm from readability and maintainability perspective and increase the chance of errors.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-02T21:22:15.857

It is safe to assign something else to the same pointer. It's absolutely NOT safe to re-use the free'ed memory. At one time, a lot of code would free a block of memory, and then use it as if it hadn't been free-ed. It caused massive problems when that code was ported to other operating systems that weren't so happy with that paradigm.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-02T21:22:41.147

It's unclear to me what you mean by re-use.

If you mean this:

```
int* pInt = new int;
*pInt = 3;
delete pInt;

pInt = new int; 
```

Then yes, it's safe.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T21:21:13.160

不。

另一个提示——仅仅因为你在没有被撞到的情况下穿过高速公路也并不安全。

您认为您正在“重用”哪些指针？尽管我假设 readWords 和 countWords 分配内存，但在释放后我看不到任何东西被使用。如果他们不这样做，那么您将面临更大的问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-02T21:23:28.070

Not clear as the allocation is not shown.

In general it is safe to reassign a pointer to point to something else after freeing what it used to point to.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-02T21:24:12.920

First, I fail to see a premature "freeing" here (no apostrophe!). Where do you think you access data that you've already freed, exactly?

Furthermore, even if you would access data after freeing it, it depends on the system whether this is somewhat safe or not. Systems might choose to give freed memory to other processes for re-use immediately, while other systems, especially if you use the rather private lib functions such as malloc, might just use memory that is only available to this one process of yours, so nothing will happen to freed memory because no other parts of the system will know about it.

# javascript - Array.sort() 会在可能的情况下保留数组的顺序吗？

> ID：504966
> 
> 赞同：2
> 
> 时间：2009-02-02T21:18:50.420
> 
> 标签：javascript, sorting, cross-browser

我想这取决于它是如何实现的。如果有人回来告诉我“是的，几乎在所有浏览器中，项目的顺序只会在需要满足排序条件时才会更改，我会很高兴。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-02T21:23:11.583

您正在寻找的是算法是否“稳定”。众所周知，Firefox 不是，而 IE 是。javascript 标准不需要稳定的排序算法。

编辑：Firefox 3+ 有一个稳定的排序。请参阅[http://www.hedgerwow.com/360/dhtml/js_array_stable_sort.html](http://www.hedgerwow.com/360/dhtml/js_array_stable_sort.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-02T21:19:37.860

每个浏览器都有不同的实现，所以不要指望它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-02T21:27:00.967

我相信这取决于您在数组中排序的对象类型。您可以向 array.sort() 提供“排序函数”来确定对特定对象进行排序的规则。例如，考虑函数：

```
function sortInt(a, b){
   if ( a < b )
    return -1;
   else if ( a == b )
     return 0;
   else if ( a > b )
     return 1;
} 
```

所以这显然是人为的，但您可以将这种相同类型的想法应用于任何“可比较”的对象。您将始终返回 a -1、0 或 1，具体取决于 a 是否小于、等于或大于 b（恭敬地）。

然后你会说：`array.sort(sortInt);`

警告：

如果语法不完美，请原谅我，因为我手头没有示例。从跨浏览器的角度来看，我也不确定 Array.sort() 的稳定性。

**编辑：**修复了伪代码片段的格式

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-02T23:54:31.683

所有主流浏览器都有稳定的排序算法，而且（因为那里有一些愚蠢的代码）它们可以处理不一致的比较函数。

# git - 合并来自 git 存储库外部的更改

> ID：504969
> 
> 赞同：2
> 
> 时间：2009-02-02T21:19:06.083
> 
> 标签：git, version-control

我正在与该国另一端的另一位开发人员合作，他是我们项目的负责人，并且没有使用正式的版本控制系统。最后，我在 git 中跟踪我的所有代码。我最近开始为主要项目做贡献，并希望能够跟踪其他开发人员的更新。

当我收到他更新的代码时，通常是 zip 文件的形式。如果我只是将文件解压缩到我的 git 工作文件夹中，git 认为每个文件都已更改，大概是因为 stat 信息已更改。

我希望看到一种方法，我可以将新代码与我的工作副本一起解压缩，并仅合并更改。最好的方法是什么？因为它是一个 Powerbuilder 项目，所以大部分文件都是二进制文件。

谢谢！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-02T21:55:52.937

二进制文件，如果存储在 Git 中，必然会创建一个新版本（即在下一次提交时考虑）。
那么：您需要这些二进制文件，还是可以重建它们？

至于来源，在 Git 中，[SHA1 为王](http://www.kernel.org/pub/software/scm/git/docs/git-whatchanged.html)，并且~~因为文件的日期（时间戳）参与其计算~~，由于外部文件集的内容可能完全不同（更多文件、临时文件、应忽略的文件……），因此最好：

*   解压到单独的目录
*   使用[WinMerge](http://winmerge.org/)之类的工具来检测基于内容的更改，合并它们，然后仅提交实际演变的文件。
    您只需比较两组目录和文件：一组是您解压缩远方同事的开发文件，另一组是您当前工作的目录和文件。

* * *

感谢[rq](https://stackoverflow.com/users/4596/rq)指出时间戳不是 SHA1 计算的一部分。只有：

*   类型
*   尺寸
*   blob 的内容

是[SHA1 计算](http://book.git-scm.com/1_the_git_object_model.html)的一部分：（[来源：][[alexgirard.com](http://alexgirard.com/git-book/assets/images/figure/object-blob.png)][）][![替代文字](https://i.stack.imgur.com/u8E2Z.png)](https://i.stack.imgur.com/u8E2Z.png)

但是，当将大量外部管理的文件导入 git 存储库时，您可能会将新文件添加到 git 管理的目录中，更改它们的内容，从而更改它们的 SHA1 密钥，即使旧的 git 管理的文件没有更改。
这意味着如果这些新文件只是临时文件或无论如何都应该被忽略/重新创建/重新生成的文件，那么树中的许多更改都是​​人为的。

[![替代文字](https://i.stack.imgur.com/EiK16.png)](https://i.stack.imgur.com/EiK16.png)
[（来源：[alexgirard.com](http://alexgirard.com/git-book/assets/images/figure/object-tree.png)）]

上述过程只是确保以*外部*方式检测*外部*文件集和 git 管理的文件集之间发生了什么变化，并判断它是否必须是 git 工作目录的一部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-06T10:53:21.600

看看是否`contrib/fast-import/import-zips.py`会做你想做的事。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-06-21T03:42:52.710

尽管不完全确定这是一个好主意，但这是我在几乎相同的情况下想做的事情：

基本上为他们维护一个回购怎么样？

您收到的任何更改都会放在他们的仓库中并提交。然后在需要时将他们的 repo 合并到你的 repo 中，这将是一个跟踪的遥控器？

# c# - String.ToLower() 是否总是分配内存？

> ID：504972
> 
> 赞同：5
> 
> 时间：2009-02-02T21:19:54.413
> 
> 标签：c#, .net, string, lowercase

`String.ToLower()`如果所有字符都是小写的，是否返回相同的引用（例如，不分配任何新内存）？

内存分配很便宜，但对数以万计的短字符串进行快速检查更便宜。大多数时候，我正在使用的输入已经是小写的，但如果不是，我想这样做。

我正在使用 C# / .NET 特别是，但我的好奇心扩展到其他语言，所以请随意回答你最喜欢的语言！

注意：字符串*是*不可变的，但这并不意味着函数总是必须返回一个新的，而是意味着没有任何东西可以改变它们的字符内容。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-02T21:26:33.603

我希望如此，是的。快速测试同意（但这不是证据）：

```
string a = "abc", b = a.ToLower();
bool areSame = ReferenceEquals(a, b); // false 
```

一般来说，尝试与做你想做的**比较器一起工作。**例如，如果您想要一个不区分大小写的字典，请使用：

```
var lookup = new Dictionary<string, int>(
    StringComparer.InvariantCultureIgnoreCase); 
```

同样地：

```
bool ciEqual = string.Equals("abc", "ABC",
    StringComparison.InvariantCultureIgnoreCase); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-02T21:24:30.270

字符串是不可变的。String.ToLower() 将始终返回新实例，从而在每次 ToLower() 调用时生成另一个实例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-02T21:29:01.897

Sun 的 String.toLowerCase() 的 Java 实现实际上并不总是分配新的字符串。它检查是否所有字符都是小写的，如果是，则返回原始字符串。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-02T21:39:04.873

[编辑]
[实习](http://en.wikipedia.org/wiki/String_intern_pool)无济于事——请参阅对此答案的评论。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-06-29T05:56:23.217

如果您使用以下代码，它将不会分配新内存，并且会覆盖原始字符串（这可能是您想要的，也可能不是您想要的）。它需要一个 ascii 字符串。如果您在从您无法控制的函数返回的字符串上调用它，预计会发生奇怪的事情。

```
public static unsafe void UnsafeToLower(string asciiString)
{
    fixed (char* pstr = asciiString)
    {
        for(char* p = pstr; *p != 0; ++p)
            *p = (*p > 0x40) && (*p < 0x5b) ? (char)(*p | 0x60) : (*p);
    }
} 
```

它需要的时间大约是 ToLowerInvariant 的 25%，并且避免了内存分配。

如果你在一个紧密的循环中经常说 100,000 或更多的字符串，我只会使用这样的东西。

# c# - 为什么我不能在抽象 C# 类上创建抽象构造函数？

> ID：504977
> 
> 赞同：64
> 
> 时间：2009-02-02T21:21:00.447
> 
> 标签：c#, inheritance, oop, constructor, abstract-class

我正在创建一个抽象类。我希望我的每个派生类都被迫实现构造函数的特定签名。因此，如果我想强迫他们实现一种方法，我会做我会做的事情，我做了一个抽象的方法。

```
public abstract class A
{
    abstract A(int a, int b);
} 
```

但是我收到一条消息说抽象修饰符在这个项目上是无效的。我的目标是强制执行一些这样的代码。

```
public class B : A
{
    public B(int a, int b) : base(a, b)
    {
        //Some other awesome code.
    }
} 
```

这都是 C# .NET 代码。谁能帮我吗？

**更新 1**

我想补充一些东西。我最终得到的是这个。

```
private A() { }

protected A(int a, int b)
{
    //Code
} 
```

这就是一些人所说的，默认是私有的，并且该类需要实现一个构造函数。但是，这不会强制使用签名 A(int a, int b) 的构造函数。

```
public abstract class A
{
    protected abstract A(int a, int b)
    {

    }
} 
```

**更新 2**

我应该清楚，为了解决这个问题，我将我的默认构造函数设为私有，并保护我的其他构造函数。我并不是真的在寻找一种让我的代码工作的方法。我处理好了。我希望了解为什么 C# 不允许您这样做。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-02-03T18:46:10.570

您不能拥有抽象构造函数，因为抽象意味着您必须在任何非抽象子类中重写它，并且您不能重写构造函数。

如果您考虑一下，这是有道理的，因为您总是调用子类的构造函数（使用 new 运算符）而不是基类。

一般来说，在 C# 中强制特定构造函数签名的唯一方法是使用**new()**泛型约束，它强制类型参数存在无参数构造函数。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-02-02T21:24:48.910

将 A 类中的构造函数更改为

```
protected A(int a, int b)
{
    // Some initialisation code here
} 
```

然后你的子类将不得不使用它，因为没有默认构造函数。

但是，它们仍然可以更改构造函数的实际签名。据我所知，没有办法强制子类为其构造函数使用特定的签名。我很确定构造函数不能是抽象的。

你到底需要这个做什么？我们也许可以建议解决此问题。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-05-05T19:55:07.893

尽管您不能覆盖构造函数，因此不能定义抽象构造函数，但您可以在抽象基类中放置一个抽象工厂方法。所有派生类都需要覆盖它。

```
public abstract class A 
{ 
    abstract A MakeAInstance(int a, int b); 
} 

public class B : A 
{ 
    // Must implement:
    override A MakeAInstance(int a, int b) {
        // Awesome way to create a B instance goes here
    }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-03-29T05:50:04.003

多种原因：

1）构造函数不是继承的，因此您不能覆盖它们。

2）构造函数是静态成员函数，因为它不需要调用特定的实例。抽象意味着“虚拟”，这意味着实现可以根据特定实例的子类化方式而有所不同，这与“静态”关键字的含义相反。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-02T21:28:58.480

您不能强制执行构造函数签名，因为每个派生类都可以（必须！）定义自己的构造函数，并且它们可以采用他们喜欢的任何参数。

如果您需要将一组给定的变量传递给派生类的对象，请定义一个需要由派生类实现的抽象方法。如果类没有实现抽象方法，你会得到一个编译器错误。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-07-10T10:04:37.367

希望这对新手有所帮助，因为我正在寻找一个带有接受参数的 ctor 的“普通”公共课程，然后我需要将其设为子课程，因此我需要一个空的 ctor。

我以前不知道这一点：如果你创建了一个受保护的 ctor，那么子类会看到它，但程序的其余部分看不到它（我想我的困惑是因为在 asp.net 中我看到了 aspx 页面中所有受保护的继承自cs...)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-02T22:09:00.193

只要子类调用超类的构造函数，所有子类总是可以指定自己的构造函数——因此无法强制类具有特定的构造函数（至少，这是它在 Java 中的工作方式）。你可以看到使用工厂模式会让你到达某个地方——你可以在接口中定义一个工厂方法——但是你需要一个单独的工厂类，因为你的抽象基类不知道需要的对象的实际类创建的。

但是：也许添加您遇到的问题的更具体示例可能会提示其他/更好的响应。您是在寻找一些通用的实例化代码，还是担心必须完成抽象基类的特定设置？

如果您只关心必须由抽象类完成的初始化，请创建一个方法来执行此操作，并记录该方法的用法。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-05-05T19:31:22.173

不确定这是否有帮助-但我觉得这将是您问题的解决方案：

```
public class A
{
  public A(int a, int b)
  {
    DoSomething(int a, int b);
  }

  virtual public void DoSomething(int a, int b)
  {

  }
}

public class B : A
{
  override public void DoSomething(int a, int b)
  {
    //class specific stuff
  }
} 
```

结果，您可以在具有正确行为的任何派生类中调用具有所需参数的构造函数。******************