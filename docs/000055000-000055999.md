# StackOverflow 问答 000055000-000055999

# security - 什么是确保页面安全的干净/简单的方法？

> ID：55010
> 
> 赞同：3
> 
> 时间：2008-09-10T18:50:47.903
> 
> 标签：security, forms, ssl, https

假设您有一个收集和提交敏感信息的表单，并且您希望确保永远不会通过不安全（非 HTTPS）方式访问它，您如何最好地执行该策略？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-10T18:54:02.357

如果您正在运行 Apache，则可以在`RewriteRule`中添加一个`.htaccess`，如下所示：

```
RewriteCond %{HTTPS} "off"
RewriteRule /mypage.html https://example.com/mypage.html 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T00:54:28.823

我认为最安全的解决方案是将代码仅保留在 SSL 文档根目录中。这将确保您（或将来的其他开发人员）不会意外链接到表单的非安全版本。如果您在 HTTP 和 HTTPS 上都有表单，您甚至可能不会注意到是否无意中使用了错误的表单。

如果这不可行，那么我将采取至少两个预防措施。执行 Apache URL 重写，并检查您的代码以确保会话已加密 - 检查 HTTP 标头。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-10T18:52:01.270

看看这个： http: [//www.dotnetmonster.com/Uwe/Forum.aspx/asp-net/75369/Enforcing-https](http://www.dotnetmonster.com/Uwe/Forum.aspx/asp-net/75369/Enforcing-https)

编辑：这从 IIS 的角度显示了解决方案，但您应该能够为此配置任何 Web 服务器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-10T18:53:34.823

在 IIS 中？转到安全设置并点击“需要安全连接”。或者，您可以检查页面加载中的服务器变量并重定向到安全页面。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-10T18:55:13.853

我建议查看呈现表单的代码中的请求，如果它不使用 SSL，则发出指向 https URL 的重定向。

您还可以在 Apache 中使用重写规则来重定向用户。

或者，您不能通过 HTTP 提供页面，而仅将其保存在 HTTPS 站点的文档根目录中。

# .net - 我应该始终使用 AndAlso 和 OrElse 运算符吗？

> ID：55013
> 
> 赞同：48
> 
> 时间：2008-09-10T18:51:52.487
> 
> 标签：.net, vb.net, boolean-logic

有没有我不想使用[`AndAlso`](http://msdn.microsoft.com/en-us/library/cb8x3kfz.aspx)运算符而不是[`And`](http://msdn.microsoft.com/en-us/library/sdbcfyzh.aspx)运算符的情况？…或者我不想使用[`OrElse`](http://msdn.microsoft.com/en-us/library/ea1sssb2.aspx)运算符而不是[`Or`](http://msdn.microsoft.com/en-us/library/06s37a7f.aspx)运算符？

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2008-09-10T18:56:39.870

来自[MSDN](http://msdn.microsoft.com/en-us/library/wz3k228a.aspx)：

**短路权衡**

*短路可以通过不评估不能改变逻辑运算结果的表达式来提高性能。但是，如果该表达式执行其他操作，则短路会跳过这些操作。例如，如果表达式包含对 Function 过程的调用，则如果表达式短路，则不会调用该过程，并且 Function 中包含的任何其他代码都不会运行。如果您的程序逻辑依赖于任何附加代码，您可能应该避免短路运算符。*

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-10T18:54:11.420

> 是否存在我不想使用 AndAlso 运算符而不是 And 运算符的情况？

当然：如果你想确保表达式的*两边*都被评估。例如，如果双方都是作为具有副作用的其他操作的结果返回布尔值的方法调用，则可能是这种情况。

但一般来说，只要在 C/C++/C# 中使用`AndAlso`/ ，`OrElse`就使用`&&`/ `||`，这当然是绝大多数时间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2021-11-04T15:12:16.683

它们是 VB.net 中完全不同的功能，并且都有自己的用例（尽管对于最常见的用途，两者都可以使用）

`AndAlso`并且`OrElse`是**条件**运算符，它们返回一个 true 或 false 布尔值，并且只评估他们需要的内容，直到它们达到无法更改的结果（对于 AndAlso 为 false，对于 OrElse 为 true）。这些等价于 C# 和 Java 等语言`&&`。`||`

`And`并且`Or`是**位运算**符，它们将传递给它们的任何位组合成一个结果，并且由于这些位总是可以通过进一步的评估来改变，因此需要评估所有内容。这些等价于 C# 和 Java 等语言`&`。`|`

大多数时候，当您查看和/或操作时，您需要条件结果。按位运算将产生一个真或假的值，并且（通常）会匹配来自适当条件运算符的真假结果，它们平均只需要更长的时间，因为它们会评估所有内容。

当您关心值中的特定位时，应使用按位运算符，通常用于以尽可能紧凑的方式存储设置或权限，并尽可能快地读取和应用它们。例如，在基于 Unix 的系统中，文件的读/写/执行权限以这种方式使用位标志：

> 0b001 - 执行权限
> 0b010 - 写入权限
> 0b100 - 读取权限

因此，在十进制中，值 7 可以完成所有三个操作，值 4 只能读取，6 可以读取和写入，等等。如果有人试图写入文件，它会通过使用检查他们的权限`And 0b010`并获得真值或基于该位置的位的错误结果。要更新该值以让用户执行文件，您将使用`Or 0b001`他们当前的权限并存储结果。

区别就在这里：

> 0b001 (真实) AndAlso 0b010 (真实) = 0b000 (虚假)
> 0b001 (真实) AndAlso 0b010 (真实) = True

# .net - Application to Stress Test in a Windows .NET Application

> ID：55035
> 
> 赞同：6
> 
> 时间：2008-09-10T18:57:41.163
> 
> 标签：.net, stress-testing

I am developing a Windows .NET application (WinForms) and I need to simulate a stress test of the database and the application ( more than 100 conections).

**What tools do you recommend?**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-09-10T19:12:10.753

Tools like [AutomatedQA TestComplete](http://www.automatedqa.com/products/testcomplete/) allow you to make a script which simulates a user controlling your application. Running multiple scripts at the same time could be your stress test.

# visual-studio - Rehsarper 4.0 - 重命名类不会重命名文件

> ID：55039
> 
> 赞同：1
> 
> 时间：2008-09-10T18:59:56.680
> 
> 标签：visual-studio, resharper

Rehsarper 4.0 - 重命名类不会重命名文件...<br> 我可能在选项中设置了一些意外，但我找不到它。有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-10T19:03:32.240

当我在 Resharper 中进行重命名时，文本框下方有一个复选框，您可以在其中键入新名称，显示“将文件名与类名同步”。检查并重命名文件。

确保您使用的是 Resharper 的重命名（右键单击/重构/重命名）而不是 Visual Studio 的（右键单击/重命名），因为后者绝对不会重命名文件。

# language-agnostic - 如何编写一个简单的聊天机器人 AI？

> ID：55042
> 
> 赞同：33
> 
> 时间：2008-09-10T19:00:40.500
> 
> 标签：language-agnostic, artificial-intelligence, chat, chatbot

我想构建一个机器人，它会根据答案向某人提出一些简单的问题和分支。我意识到从人类响应中解析含义将是一项挑战，但是您如何设置程序来处理对话的“状态”？

这将是人和机器人之间的一对一对话。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-10T19:04:47.463

您可能希望将[马尔可夫链](http://en.wikipedia.org/wiki/Markov_chain)作为机器人 AI 的基础。很久以前我写了一些东西（我一点也不引以为豪的代码，并且需要一些 mods 才能在 Python > 1.5 上运行），这对你来说可能是一个有用的起点：[http://sourceforge.net/projects/benzo/](http://sourceforge.net/projects/benzo/)

编辑：这是 Python 中一个最小的马尔可夫链示例，它接受来自标准输入的输入，并根据输入中单词的连续概率输出文本。它针对 IRC 风格的聊天日志进行了优化，但是通过它运行任何大小合适的文本都应该展示这些概念：

```
import random, sys

NONWORD = "\n"
STARTKEY = NONWORD, NONWORD
MAXGEN=1000

class MarkovChainer(object):
    def __init__(self):
        self.state = dict()

    def input(self, input):
        word1, word2 = STARTKEY
        for word3 in input.split():
            self.state.setdefault((word1, word2), list()).append(word3)
            word1, word2 = word2, word3 
        self.state.setdefault((word1, word2), list()).append(NONWORD)

    def output(self):
        output = list()
        word1, word2 = STARTKEY
        for i in range(MAXGEN):
            word3 = random.choice(self.state[(word1,word2)])
            if word3 == NONWORD: break
            output.append(word3)
            word1, word2 = word2, word3
        return " ".join(output)

if __name__ == "__main__":
    c = MarkovChainer()
    c.input(sys.stdin.read())
    print c.output() 
```

从这里插入持久性和 IRC 库并拥有您正在谈论的机器人类型的基础非常容易。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-18T17:53:27.490

人们已经提到，有状态并不是典型聊天机器人的重要组成部分：

*   一个纯马尔可夫实现可能会表达一种非常松散的状态，如果它正在实时增长它的词典和表格——人类对话者之前的话语可能会在对话的后期偶然出现——但马尔可夫模型没有任何固有的选择或产生这种反应的机制。

*   基于解析的机器人（例如 ELIZA）通常会尝试响应用户最近输入的（某些）语义内容，而不考虑先前的交换。

也就是说，您当然*可以*向聊天机器人添加一些状态，而不管您使用的是哪种输入解析和语句合成模型。如何做到这一点在很大程度上取决于你想用你的状态来完成什么，这从你的问题中并不清楚。然而，有几个一般的想法：

*   创建关键字堆栈。当您的人提供输入时，从他们的陈述/问题中解析出关键字并将这些关键字扔到某种堆栈上。当您的聊天机器人无法在最近的输入中提出令人信服的响应时——或者，也许只是随机地，把事情混在一起——回到你的堆栈，抓住一个以前的关键字，然后用它来播下你的下一个关键字合成。对于加分，让机器人明确承认它正在回到以前的主题，例如“等等，人类，你之前提到过 foo。[由 foo 播种的句子]”。

*   在机器人中构建类似 RPG 的对话逻辑。当您解析人工输入时，为来自用户的特定对话提示或内容切换标志，并有条件地更改聊天机器人可以谈论的内容或交流方式。例如，聊天机器人对粗话大发雷霆（或责骂或大笑）是相当普遍的；一个聊天机器人会兴奋起来，并且有条件*地保持这种状态，直到向 道歉*，这将是一个有趣的状态变化。将输出切换为全部大写，投入对抗性言论或要求或抽泣等。

你能澄清一下你希望国家帮助你完成什么吗？

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-10-20T09:20:26.820

想象一个在每个节点或神经元中具有解析能力的神经网络。根据规则和解析结果，神经元会触发。如果某些神经元被激发，你会对问题的主题和语义有一个很好的了解，因此可以给出一个很好的答案。

记忆是通过保持会话中讨论的主题来完成的，增加下一个问题的触发，因此指导最后可能答案的选择过程。

将您的规则和模式保存在知识库中，但在开始时将它们编译到内存中，每个规则都有一个神经元。您可以使用诸如侦听器或事件函数之类的东西来设计突触。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-10T19:09:13.257

我认为您可以查看[Kooky](http://kookybot.org/)的代码，而 IIRC 它也使用马尔可夫链。

另请查看[古怪的引语](http://quotes.kookybot.org/top)，它们不久前出现在 Coding Horror 中，有些很搞笑。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-10T19:11:27.433

我认为要开始这个项目，最好有一个带有问题的数据库（组织为一棵树。在每个节点中都有一个或多个问题）。这些问题应该用“是”或“否”来回答。

如果机器人开始提问，它可以从您标记为开始问题的问题数据库中的任何问题开始。答案是通往树中下一个节点的路径。

编辑：这是一个用 ruby​​ 编写的简单文件，您可以从以下内容开始：[rubyBOT](http://snippets.dzone.com/posts/show/1785)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2014-05-28T01:31:02.643

天真的聊天机器人程序。没有解析，没有聪明，只是一个训练文件和输出。

它首先在文本上训练自己，然后使用来自该训练的数据来生成对对话者输入的响应。训练过程创建一个字典，其中每个键是一个单词，值是训练文本中任何位置顺序跟随该单词的所有单词的列表。如果一个词在这个列表中出现了不止一次，那么这反映了它更有可能被机器人选择，不需要概率性的东西，只需用一个列表来做。

机器人从您的输入中选择一个随机词，并通过选择另一个随机词来生成响应，该随机词已被视为其持有的词的后继词。然后它通过依次找到该词的后继词并迭代地继续执行该过程，直到它认为它已经说得足够多，从而重复该过程。它通过停在训练文本中标点符号之前的一个词来得出这个结论。然后它再次返回输入模式以让您响应，依此类推。

这不是很现实，但我在此挑战任何人在 71 行代码中做得更好！对于任何初露头角的 Python 爱好者来说，这都是一个巨大的挑战，我只希望我能向更广泛的受众开放挑战，而不是我访问这个博客的少数访问者。为了编写一个始终保证语法正确的机器人，它肯定接近几百行，我通过尝试考虑最简单的规则来极大地简化程序，让计算机仅仅尝试有话要说。

它的反应至少可以说是相当印象派的！此外，您必须将您所说的内容放在单引号中。

我使用战争与和平作为我的“语料库”，训练运行需要几个小时，如果您不耐烦，请使用较短的文件……</p>

这是教练

```
#lukebot-trainer.py
import pickle
b=open('war&peace.txt')
text=[]
for line in b:
    for word in line.split():
        text.append (word)
b.close()
textset=list(set(text))
follow={}
for l in range(len(textset)):
    working=[]
    check=textset[l]
    for w in range(len(text)-1):
        if check==text[w] and text[w][-1] not in '(),.?!':
            working.append(str(text[w+1]))
    follow[check]=working
a=open('lexicon-luke','wb')
pickle.dump(follow,a,2)
a.close() 
```

这是机器人

```
#lukebot.py
import pickle,random
a=open('lexicon-luke','rb')
successorlist=pickle.load(a)
a.close()
def nextword(a):
    if a in successorlist:
        return random.choice(successorlist[a])
    else:
        return 'the'
speech=''
while speech!='quit':
    speech=raw_input('>')
    s=random.choice(speech.split())
    response=''
    while True:
        neword=nextword(s)
        response+=' '+neword
        s=neword
        if neword[-1] in ',?!.':
            break
    print response 
```

当它说一些似乎部分有道理的东西时，你往往会有一种不可思议的感觉。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-10T19:03:42.163

我建议查看贝叶斯概率。然后只需监视聊天室一段时间即可创建您的概率树。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-10T23:03:14.427

我不确定这就是你要找的东西，但是有一个名为[ELIZA](http://en.wikipedia.org/wiki/ELIZA)的旧程序，它可以通过接受你所说的内容并在执行一些简单的文本转换后向你吐出它来进行对话。

如果我没记错的话，很多人都相信他们是在和一个真实的人“交谈”，并与它进行了长时间的精心对话。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-08-05T20:40:54.520

如果您只是涉足，我相信[Pidgin](http://pidgin.im/)允许您编写聊天风格行为的脚本。框架的一部分可能会记录谁在何时发送消息的状态，并且您希望为最后 N 条消息中的每一条记录您的机器人的内部状态。未来的状态决策可以基于对先前状态的检查和最近几条消息的内容进行硬编码。或者你可以做一些类似马尔可夫链的事情，并将其用于解析和生成。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-10-09T00:45:43.783

如果您不需要学习机器人，那么使用 AIML ( [http://www.aiml.net/](http://www.aiml.net/) ) 很可能会产生您想要的结果，至少在机器人解析输入和基于它的回答方面。

您将重用或创建由 XML（以 AIML 格式）制成的“大脑”，并在程序（解析器）中解析/运行它们。有几种不同语言的解析器可供选择，据我所知，在大多数情况下，代码似乎是开源的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-08-17T13:10:04.823

您可以使用“ChatterBot”，并使用“flask-chatterbot-master”在本地托管它

**链接：**

1.  [ChatterBot 安装] [https://chatterbot.readthedocs.io/en/stable/setup.html](https://chatterbot.readthedocs.io/en/stable/setup.html)
2.  [主机本地使用-flask-chatterbot-master]：[https ://github.com/chamkank/flask-chatterbot](https://github.com/chamkank/flask-chatterbot)

干杯，

拉特纳卡尔

# sql - 在 SQL Server 中将字符串中每个单词的首字母大写的最佳方法是什么

> ID：55054
> 
> 赞同：55
> 
> 时间：2008-09-10T19:07:08.363
> 
> 标签：sql, sql-server, string

在 SQL Server 中将字符串中每个单词的首字母大写的最佳方法是什么。

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-09-10T19:09:23.647

来自[http://www.sql-server-helper.com/functions/initcap.aspx](http://www.sql-server-helper.com/functions/initcap.aspx)

```
CREATE FUNCTION [dbo].[InitCap] ( @InputString varchar(4000) ) 
RETURNS VARCHAR(4000)
AS
BEGIN

DECLARE @Index          INT
DECLARE @Char           CHAR(1)
DECLARE @PrevChar       CHAR(1)
DECLARE @OutputString   VARCHAR(255)

SET @OutputString = LOWER(@InputString)
SET @Index = 1

WHILE @Index <= LEN(@InputString)
BEGIN
    SET @Char     = SUBSTRING(@InputString, @Index, 1)
    SET @PrevChar = CASE WHEN @Index = 1 THEN ' '
                         ELSE SUBSTRING(@InputString, @Index - 1, 1)
                    END

    IF @PrevChar IN (' ', ';', ':', '!', '?', ',', '.', '_', '-', '/', '&', '''', '(')
    BEGIN
        IF @PrevChar != '''' OR UPPER(@Char) != 'S'
            SET @OutputString = STUFF(@OutputString, @Index, 1, UPPER(@Char))
    END

    SET @Index = @Index + 1
END

RETURN @OutputString

END
GO 
```

这里有一个更简单/更小的一个（但如果任何行没有空格，“无效的长度参数传递给 RIGHT 函数。”）：

[http://www.devx.com/tips/Tip/17608](http://www.devx.com/tips/Tip/17608)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2017-09-21T13:17:00.377

作为表值函数：

```
CREATE FUNCTION dbo.InitCap(@v AS VARCHAR(MAX))
RETURNS TABLE
AS
RETURN 
WITH a AS (
    SELECT (
        SELECT UPPER(LEFT(value, 1)) + LOWER(SUBSTRING(value, 2, LEN(value))) AS 'data()'
        FROM string_split(@v, ' ')
        ORDER BY CHARINDEX(value,@v)
        FOR XML PATH (''), TYPE) ret)

SELECT CAST(a.ret AS varchar(MAX)) ret from a
GO 
```

请注意，`string_split`需要`COMPATIBILITY_LEVEL`130。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-10-27T20:03:45.260

如果您正在 Oracle/PLSQL 中寻找相同问题的答案，那么您可以使用函数 INITCAP。下面是一个来自表**部门的属性****dname**的示例，它具有值（'sales'、'management'、'production'、'development'）。

 **```
SQL> select INITCAP(dname) from department;

INITCAP(DNAME)
--------------------------------------------------
Sales
Management
Production
Development 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-10T19:55:00.527

我已经使用了很长时间的一个变体是：

```
CREATE FUNCTION [widget].[properCase](@string varchar(8000)) RETURNS varchar(8000) AS
BEGIN   
    SET @string = LOWER(@string)
    DECLARE @i INT
    SET @i = ASCII('a')
    WHILE @i <= ASCII('z')
    BEGIN
        SET @string = REPLACE( @string, ' ' + CHAR(@i), ' ' + CHAR(@i-32))
        SET @i = @i + 1
    END
    SET @string = CHAR(ASCII(LEFT(@string, 1))-32) + RIGHT(@string, LEN(@string)-1)
    RETURN @string
END 
```

如果您愿意，您可以轻松修改以处理除空格以外的项目之后的字符。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-01-02T13:22:04.507

不使用循环的另一种解决方案 - 具有递归 CTE 的纯基于集合的方法

```
create function [dbo].InitCap (@value varchar(max))
returns varchar(max) as
begin

    declare
        @separator char(1) = ' ',
        @result varchar(max) = '';

    with r as (
        select value, cast(null as varchar(max)) [x], cast('' as varchar(max)) [char], 0 [no] from (select rtrim(cast(@value as varchar(max))) [value]) as j
        union all
        select right(value, len(value)-case charindex(@separator, value) when 0 then len(value) else charindex(@separator, value) end) [value]
        , left(r.[value], case charindex(@separator, r.value) when 0 then len(r.value) else abs(charindex(@separator, r.[value])-1) end ) [x]
        , left(r.[value], 1)
        , [no] + 1 [no]
        from r where value > '')

    select @result = @result +
    case
        when ascii([char]) between 97 and 122 
            then stuff(x, 1, 1, char(ascii([char])-32))
        else x
    end + @separator
    from r where x is not null;

    set @result = rtrim(@result);

    return @result;
end 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-07-22T21:09:23.020

这是最简单的一行代码。

```
select 
        LEFT(column, 1)+ lower(RIGHT(column, len(column)-1) )
     from [tablename] 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-04-11T16:05:36.757

```
;WITH StudentList(Name) AS (
      SELECT CONVERT(varchar(50), 'Carl-VAN')
UNION SELECT 'Dean o''brian'
UNION SELECT 'Andrew-le-Smith'
UNION SELECT 'Eddy thompson'
UNION SELECT 'BOBs-your-Uncle'
), Student AS (
    SELECT CONVERT(varchar(50), UPPER(LEFT(Name, 1)) + LOWER(SUBSTRING(Name, 2, LEN(Name)))) Name, 
           pos = PATINDEX('%[-'' ]%', Name)
    FROM StudentList
    UNION ALL
    SELECT CONVERT(varchar(50), LEFT(Name, pos) + UPPER(SUBSTRING(Name, pos + 1, 1)) + SUBSTRING(Name, pos + 2, LEN(Name))) Name, 
           pos = CASE WHEN PATINDEX('%[-'' ]%', RIGHT(Name, LEN(Name) - pos)) = 0 THEN 0 ELSE pos + PATINDEX('%[-'' ]%', RIGHT(Name, LEN(Name) - pos)) END
    FROM Student
    WHERE pos > 0
)
SELECT Name
FROM Student 
WHERE pos = 0
ORDER BY Name 
```

这将导致：

*   安德鲁-勒-史密斯
*   Bobs-Your-Uncle
*   卡尔-范
*   迪恩·奥布莱恩
*   艾迪汤普森

使用基于递归 CTE 集的查询应该胜过执行过程式 while 循环查询。在这里，对于更高级的示例，我还将我的单独设置为 3 个不同的字符 [-' ] 而不是 1。像我所做的那样使用 PATINDEX 可以让我查找许多字符。您也可以在单个字符上使用 CHARINDEX，并且此函数除了第三个参数 StartFromPosition，因此我可以进一步简单地将 pos 公式的第二部分递归到（假设一个空格）： pos = CHARINDEX(' ', Name, pos + 1）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-12-11T13:59:30.730

```
BEGIN
DECLARE @string varchar(100) = 'asdsadsd asdad asd'
DECLARE @ResultString varchar(200) = ''
DECLARE @index int = 1
DECLARE @flag bit = 0
DECLARE @temp varchar(2) = ''
WHILE (@Index <LEN(@string)+1)
BEGIN
    SET @temp = SUBSTRING(@string, @Index-1, 1)
    --select @temp
    IF @temp = ' ' OR @index = 1
        BEGIN
            SET @ResultString = @ResultString + UPPER(SUBSTRING(@string, @Index, 1))
        END
    ELSE
        BEGIN

            SET @ResultString = @ResultString + LOWER(SUBSTRING(@string, @Index, 1)) 
        END 

    SET @Index = @Index+ 1--increase the index
END
SELECT @ResultString 
```

结尾

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-06-25T21:26:17.237

仅限英文数据。

从性能的角度来看超级非高效，但从生产力的角度来看是高效的。将其用作一次性转换器：

```
SELECT 
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(
REPLACE(

UPPER(LEFT(City,1))+LOWER(SUBSTRING(City,2,LEN(City)))

,' a', ' A')
,' b', ' B')
,' c', ' C')
,' d', ' D')
,' e', ' E')
,' f', ' F')
,' g', ' G')
,' h', ' H')
,' i', ' I')
,' j', ' J')
,' k', ' K')
,' l', ' L')
,' m', ' M')
,' n', ' N')
,' o', ' O')
,' p', ' P')
,' q', ' Q')
,' r', ' R')
,' s', ' S')
,' t', ' T')
,' u', ' U')
,' v', ' V')
,' w', ' W')
,' x', ' X')
,' y', ' Y')
,' z', ' Z')

FROM [Dictionaries].[dbo].[Cities]
  WHERE Country = 'US' AND City like '% %'
  ORDER BY City 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-09-12T01:22:43.223

我正在寻找最好的大写方式，我重新创建了简单的 sql 脚本

如何使用 SELECT dbo.Capitalyze('这是一个有多个空格的测试')

结果“这是一个包含多个空格的测试”

CREATE FUNCTION Capitalyze(@input varchar(100) ) 返回 varchar(100) 作为开始

```
declare @index int=0
declare @char as varchar(1)=' '
declare @prevCharIsSpace as bit=1
declare @Result as varchar(100)=''

set @input=UPPER(LEFT(@input,1))+LOWER(SUBSTRING(@input, 2, LEN(@input)))
set @index=PATINDEX('% _%',@input)
if @index=0
    set @index=len(@input)
set @Result=substring(@input,0,@index+1)

WHILE (@index < len(@input))
BEGIN
    SET @index = @index + 1
    SET @char=substring(@input,@index,1)
    if (@prevCharIsSpace=1)
    begin
        set @char=UPPER(@char)
        if (@char=' ')
            set @char=''
    end

    if (@char=' ')
        set @prevCharIsSpace=1
    else
        set @prevCharIsSpace=0

    set @Result=@Result+@char
    --print @Result
END
--print @Result
return @Result 
```

结尾

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-10-03T06:59:49.780

fname 是列名，如果 fname 值为 akhil，则 UPPER(left(fname,1)) 提供大写首字母 (A) 和子字符串函数 SUBSTRING(fname,2,LEN(fname)) 提供(khil) 使用 + 然后结果连接两者是（阿基尔）

```
select UPPER(left(fname,1))+SUBSTRING(fname,2,LEN(fname)) as fname
FROM [dbo].[akhil] 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2019-10-09T02:10:56.143

在**SQL Server 2016+ 上**使用 JSON 提供保证的单词顺序：

```
CREATE FUNCTION [dbo].[InitCap](@Text NVARCHAR(MAX))
RETURNS NVARCHAR(MAX)
AS
BEGIN
    RETURN STUFF((
        SELECT ' ' + UPPER(LEFT(s.value,1)) + LOWER(SUBSTRING(s.value,2,LEN(s.value)))
        FROM OPENJSON('["' + REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(@Text,'\','\\'),'"','\"'),CHAR(9),'\t'),CHAR(10),'\n'),' ','","') + '"]') s
        ORDER BY s.[key]
    FOR XML PATH(''),TYPE).value('(./text())[1]','NVARCHAR(MAX)'),1,1,'');
END 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-11-20T07:06:52.000

```
GO
CREATE FUNCTION [dbo].[Capitalize](@text NVARCHAR(MAX)) RETURNS NVARCHAR(MAX) AS
BEGIN
    DECLARE @result NVARCHAR(MAX) = '';
    DECLARE @c NVARCHAR(1);
    DECLARE @i INT = 1;
    DECLARE @isPrevSpace BIT = 1;

    WHILE @i <= LEN(@text)
    BEGIN
        SET @c = SUBSTRING(@text, @i, 1);
        SET @result += IIF(@isPrevSpace = 1, UPPER(@c), LOWER(@c));
        SET @isPrevSpace = IIF(@c LIKE '[    -]', 1, 0);
        SET @i += 1;
    END
    RETURN @result;
END
GO

DECLARE @sentence NVARCHAR(100) = N'i-thINK-this    soLUTION-works-LiKe-a charm';
PRINT dbo.Capitalize(@sentence);
-- I-Think-This Solution-Works-Like-A Charm 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-03-04T14:58:51.507

SELECT dbo.ProperCase('Xyz 在 qrst 之后')

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-06-02T18:56:22.540

它可以像这样简单：

```
DECLARE @Name VARCHAR(10) = 'merin';

SELECT @Name AS Name, REPLACE(@Name, LEFT(@Name, 1),  UPPER(LEFT(@Name, 1))) AS CapitalizedName 
```

[![在此处输入图像描述](https://i.stack.imgur.com/Ew3ER.png)](https://i.stack.imgur.com/Ew3ER.png)

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2021-06-16T08:00:18.237

建议的功能可以正常工作，但是，如果您不想创建任何功能，我就是这样做的-

```
select ID,Name
,string_agg(concat(upper(substring(value,1,1)),lower(substring(value,2,len(value)-1))),' ') as ModifiedName 
from Table_Customer 
cross apply String_Split(replace(trim(Name),'  ',' '),' ')
where Name is not null
group by ID,Name; 
```

上面的查询用空格 (' ') 分割单词并创建每个具有一个子字符串的不同行，然后将每个子字符串的第一个字母转换为大写字母并保持保持为小写字母。最后一步是根据键进行字符串聚合。

希望你觉得它有用！

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2019-06-06T16:22:37.353

```
IF OBJECT_ID ('dbo.fnCapitalizeFirstLetterAndChangeDelimiter') IS NOT NULL
    DROP FUNCTION dbo.fnCapitalizeFirstLetterAndChangeDelimiter
GO

CREATE FUNCTION [dbo].[fnCapitalizeFirstLetterAndChangeDelimiter] (@string NVARCHAR(MAX), @delimiter NCHAR(1), @new_delimeter NCHAR(1))
RETURNS NVARCHAR(MAX)
AS 
BEGIN
    DECLARE @result NVARCHAR(MAX)
    SELECT @result = '';
    IF (LEN(@string) > 0)
        DECLARE @curr INT
        DECLARE @next INT
        BEGIN
            SELECT @curr = 1
            SELECT @next = CHARINDEX(@delimiter, @string)
            WHILE (LEN(@string) > 0)
                BEGIN
                    SELECT @result = 
                        @result + 
                        CASE WHEN LEN(@result) > 0 THEN @new_delimeter ELSE '' END +
                        UPPER(SUBSTRING(@string, @curr, 1)) + 
                        CASE 
                            WHEN @next <> 0 
                            THEN LOWER(SUBSTRING(@string, @curr+1, @next-2))
                            ELSE LOWER(SUBSTRING(@string, @curr+1, LEN(@string)-@curr))
                        END
                    IF (@next > 0)
                        BEGIN
                            SELECT @string = SUBSTRING(@string, @next+1, LEN(@string)-@next)
                            SELECT @next = CHARINDEX(@delimiter, @string)
                        END
                    ELSE
                        SELECT @string = ''
                END
        END
    RETURN @result
END
GO 
```

* * *

## 回答 #18

> 赞同：-3
> 
> 时间：2016-09-13T18:00:12.583

你应该试试这个

```
Select INITCAP(column_name) from table_name; 
```

这将大写提到的属性条目的第一个字母。

# python - 什么是最好的 Django 搜索应用程序？

> ID：55056
> 
> 赞同：114
> 
> 时间：2008-09-10T19:09:14.600
> 
> 标签：python, django, search, search-engine

我正在构建一个需要搜索功能的 Django 项目，在没有 之前`django.contrib.search`，我必须选择一个搜索应用程序。那么，哪个是最好的？“最好”是指...

*   易于安装/设置
*   有一个 Django 或至少 Python 友好的 API
*   可以执行相当复杂的搜索

以下是我听说过的一些应用程序，如果您知道，请推荐其他应用程序：

*   [djangosearch](http://code.google.com/p/djangosearch/)
*   [django-狮身人面像](http://code.google.com/p/django-sphinx/)

我还想避免使用第三方搜索引擎（如 Google SiteSearch），因为我想索引的一些数据仅供网站成员使用，不应公开。

* * *

## 回答 #1

> 赞同：105
> 
> 时间：2009-05-08T16:10:42.847

查看[Haystack Search——](http://haystacksearch.org/)一个基于新模型的搜索抽象层，目前支持[Xapian](http://xapian.org/)、[Solr](http://lucene.apache.org/solr/)和[Whoosh](https://bitbucket.org/mchaput/whoosh/wiki/Home)。看起来它得到了很好的支持和记录。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-11T07:03:56.893

Justin，我会先尝试[djangosearch](http://code.google.com/p/djangosearch/)：Jacob Kaplan-Moss（Django 的首席开发人员）正在研究它。

潜在危险：

*   主页警告 API 可能不完全稳定

潜在好处：

*   “长期目标是实现这一目标`django.contrib.search`。”</li>

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-10-16T20:43:50.233

我正在寻找同样的东西，就像很多其他人一样。让我们希望*django.contrib.search*很快就会被添加。

与此同时，这是我发现的：

*   [http://code.google.com/p/djangosearch/](http://code.google.com/p/djangosearch/)
*   [http://code.google.com/p/django-sphinx/](http://code.google.com/p/django-sphinx/)
*   [http://code.google.com/p/djapian/](http://code.google.com/p/djapian/)
*   [http://code.google.com/p/django-search-lucene/](http://code.google.com/p/django-search-lucene/)
*   [http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/](http://www.sai.msu.su/~megera/postgres/gist/tsearch/V2/)

对我来说，大多数看起来很复杂，坦率地说，实施起来有点令人生畏。我很想知道你对这些的看法。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-05-09T21:38:37.243

[djangosearch](http://code.google.com/p/djangosearch/)的谷歌代码页表明它不再处于积极开发中，并建议使用[haystack](http://haystacksearch.org/)或[solango](http://code.google.com/p/django-solr-search/)。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-10-23T20:07:28.897

我推荐 Sphinx 用于全文搜索和聚合，django-sphinx 足以用于生产。我们发现 Sphinx 是索引和搜索文档的资源最少且最快的方法，并且 django-sphinx 是 sphinx 客户端之上的一个很好的包装器。

聚合分组特别好，例如，如果您想显示有多少具有特定标签或特定作者（或两者）的文档与搜索匹配。内存属性更新也很方便，尤其是对于立即删除已删除的文章。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-11T15:28:50.347

谢谢加思。之前看到 djangosearch 想成为官方的 Django 搜索，但是因为找不到任何文档而犹豫要不要使用它！幸运的是，[subversion](http://code.google.com/p/djangosearch/source/browse/branches/soc-new-backends/doc/README.txt)中有一个我以前没见过的 README，它让 API 看起来很酷：

```
# set up the model
class Event(models.Model):
    title = models.CharField(max_length=255)
    date = models.DateField()
    is_outdoors = models.BooleanField()

    index = djangosearch.ModelIndex(text=['title'], 
                                    additional=['date', 'is_outdoors'])

# run a search
results = Event.index.search("django conference") 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2011-04-22T23:33:01.527

我只需要一个**非常快速**的解决方案，对于内部应用程序来说不会大惊小怪。

我很快就找到了[将搜索添加到 Django](http://julienphalip.com/post/2825034077/adding-search-to-a-django-site-in-a-snap)的文章，这对我来说非常有用！

显然它缺乏像 Haystack 这样的真实项目的速度、可扩展性和特性，但是这个更容易设置，而且我真的不需要任何东西，只需要关键字 AND 搜索。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-26T05:38:19.513

您可能需要考虑让 Yahoo 使用他们的 Build your own Search Service (BOSS) 来完成所有艰苦的工作。这是一篇很棒的博客文章，可以引导您完成整个过程： [http ://www.peterkrantz.com/2008/yahoo-search-in-django/](http://www.peterkrantz.com/2008/yahoo-search-in-django/)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-01-27T16:31:04.970

看起来这里的每个人都错过了[django-xappy](https://launchpad.net/django-xappy)

在对所有现有的 Django 搜索插件进行快速评估后，我发现这是最灵活且最易于使用的插件。它在一些地方很粗糙，但它仍然是在 Django 项目中使用[Xapian](http://xapian.org)搜索引擎功能的最佳方式。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-15T05:40:40.457

您可能想查看[Django Solr 搜索](http://code.google.com/p/django-solr-search/)（又名“Solango”），它附带了一些很好的文档来帮助您入门……

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-17T19:48:21.247

如果您有大量数据要编入索引或者您期望高流量，我建议您使用一些外部搜索引擎，例如[Solr](http://lucene.apache.org/solr/)。这样，您将保持*无共享*方法并能够独立扩展您的站点组件。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-05-31T22:59:10.570

我想我将不得不向 Djapian 大喊一声。

它坚如磐石......只需拉下一个源分布并窥视内部。一流的代码，没有太多的评论。

它仍然是一个年轻的软件项目，但我认为 django 社区应该支持这个项目。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-10-24T07:24:20.310

谢谢乔，

我们决定使用 Tsearch2 和自定义 postgres 适配器。Tsearch2 不需要额外的进程来运行，这很方便，因为我们在一个内存有限的 WebFaction 主机上......它还没有完全完成，但似乎是一个很好的解决方案......

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-14T15:56:45.290

我发现[Djoosh](http://github.com/idangazit/djoosh/tree/master)依赖于纯 Python 外部搜索引擎[Whoosh](http://whoosh.ca/)与我的“Python”大脑配合得很好。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2012-05-13T15:22:19.900

如果你愿意使用第三方搜索引擎，我可以推荐[Yahoo BOSS](http://developer.yahoo.com/search/boss/)和[django-bosssearch](https://bitbucket.org/jaap3/django-bosssearch/)。

Yahoo BOSS is a paid service, but it saves you setting up and maintaining other search software on your server.

# php - php函数参数错误抑制，empty() isset() 仿真

> ID：55060
> 
> 赞同：10
> 
> 时间：2008-09-10T19:09:47.577
> 
> 标签：php, error-handling, error-suppression

我很确定这个问题的答案是否定的，但万一有一些 PHP 大师

是否可以以可以传入无效参数或不存在的变量的方式编写函数，并且如果不使用 php 就不会出错`'@'`

就像 empty 和 isset 一样。你可以传入一个你刚刚组成的变量，它不会出错。

```
ex:

empty($someBogusVar); // no error

myHappyFunction($someBogusVar); // Php warning / notice 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-11-23T00:32:47.353

通过引用传递变量时不会出现任何错误（PHP 将默默地创建一个新变量）：

```
 function myHappyFunction(&$var)
 {       
 } 
```

但我建议不要滥用它来隐藏编程错误。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-10T20:09:21.817

总而言之，正确的答案是**不，你不应该**（见下面的警告）。

许多人在这个线程中已经提到了一些解决方法，比如在条件中使用引用变量或 isset() 或 empty() 以及在 PHP 配置中抑制通知。除了明显的解决方法之外，使用您不想要的@。

[总结与Gerry](https://stackoverflow.com/users/109561/gerry)的有趣评论讨论：如果您**检查函数内部变量的值**并正确处理未定义或空情况，则通过引用传递变量确实有效。只是不要使用引用传递作为关闭 PHP 的一种方式（这是我原来不应该指向的地方）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-10T19:46:38.253

您可以使用 func_get_args 来执行此操作，如下所示：

```
error_reporting(E_ALL);
ini_set('display_errors', 1);

function defaultValue() {
    $args = func_get_args();

    foreach($args as $arg) {
        if (!is_array($arg)) {
            $arg = array($arg);
        }
        foreach($arg as $a) {
            if(!empty($a)) {
                return $a;
            }
        }
    }

    return false;
}

$var = 'bob';

echo defaultValue(compact('var'), 'alpha') . "\n"; //returns 'bob'
echo defaultValue(compact('var2'), 'alpha') . "\n"; //returns 'alpha'
echo defaultValue('alpha') . "\n"; //return
echo defaultValue() . "\n"; 
```

这个函数更进一步，会给你任意数量的参数的第一个非空值（你总是可以强制它最多只占用两个参数，但这对我来说看起来更有用）。

编辑：原始版本没有使用 compact 来尝试制作一个 args 数组，但仍然给出了错误。错误报告提高了一个档次，这个带有紧凑的新版本不太整洁，但仍然做同样的事情，并允许您为不存在的变量提供默认值。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-12-08T14:46:30.187

在某些情况下，检查变得繁琐且不必要。
因此我写了这个小魔法函数：

```
/**
 * Shortcut for getting a value from a possibly unset variable.
 * Normal:
 *   if (isset($_GET['foo']) && $_GET['foo'] == 'bar') {
 * Short:
 *   if (value($_GET['foo']) == 'bar') {
 *
 * @param mixed  $variable 
 * @return mixed  Returns null if not set
 */
function value(&$variable) {
    if (isset($variable)) {
        return $variable;
    }
} 
```

它不需要对 myHappyFunction() 进行任何更改。
你必须改变

```
myHappyFunction($someBogusVar); 
```

到

```
myHappyFunction(value($someBogusVar)); 
```

明确说明您的意图。这使它成为我书中的**好习惯**。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-10T19:12:41.860

不，因为这与函数没有任何关系；该错误来自尝试取消引用不存在的数组键。您可以更改 PHP 设置的警告级别以抑制这些错误，但最好不要这样做。

话虽如此，你*可以*做类似的事情

```
function safeLookup($array, $key)
{
  if (isset($array, $key))
    return $array[$key];

  return 0;
} 
```

并使用它代替数组键查找

```
defaultValue(safeLookup($foo, "bar"), "baz); 
```

现在我需要洗个澡：）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-19T20:09:16.573

> 是否可以以可以传入无效参数或不存在的变量的方式编写函数，并且如果不使用'@'，php不会出错

**是的你可以！**

porneL 是正确的[编辑：我没有足够的分数来链接到他的答案或投票，但它在这个页面上]

当他警告说“但我建议不要滥用它来隐藏编程错误”时，他也是正确的。但是，出于同样的原因，也应避免通过错误控制运算符 (@) 进行错误抑制。

我是 Stack Overflow 的新手，但我希望不正确的答案在页面上排名最高而正确答案没有得到投票的情况并不常见。:(

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-10T19:18:00.083

> @Brian：我使用三元运算为我做检查：

```
return $value ? $value : $default; 
```

这将返回 $value 或 $default。取决于 $value 的值。如果它是 0、false、empty 或任何类似的值，将返回 $default 中的值。

我更愿意挑战模拟 empty() 和 isset() 等函数

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-10T19:33:16.350

我敢肯定，关于三元运算符 vrs 函数调用可能会有很好的讨论。但是这个问题的重点是看看我们是否可以创建一个在不使用'@'的情况下传入不存在的值时不会抛出错误的函数

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-10T19:46:50.313

@Sean 布赖恩已经回答了

```
return isset($input) ? $input : $default; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-10T19:49:12.023

肖恩，你可以这样做：

```
$result = ($func_result = doLargeIntenseFunction()) ? $func_result : 'no result'; 
```

编辑：

> 我敢肯定，关于三元运算符 vrs 函数调用可能会有很好的讨论。但是这个问题的重点是看看我们是否可以创建一个在不使用'@'的情况下传入不存在的值时不会抛出错误的函数

我告诉过你，用`isset()`. 三元条件的第一部分不检查 null 或 not null，它检查`true`or `false`。如果您尝试在 PHP 中检查`true`或检查`false`空值，您会收到这些警告。`isset()`检查变量或表达式是否返回空值，并返回一个布尔值，可以由三元组的第一部分进行评估而不会出现任何错误。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-02T19:09:20.400

虽然原始问题的答案是“否”，但还有一个没有人提到的选项。

当您使用@ 符号时，PHP 所做的只是覆盖`error_reporting`级别并将其临时设置为零。您可以使用 " `ini_restore('error_reporting');`" 将其设置回使用 @ 之前的任何值。

在我想编写一个方便的函数来检查是否设置了变量并且还有一些其他属性，否则返回默认值的情况下，这对我很有用。但是，通过发送一个未设置的变量会导致 PHP 通知，所以我使用 @ 来抑制它，然后`error_reporting`在函数内部设置回原始值。

就像是：

```
$var = @foo($bar);

function foo($test_var)
{
     ini_restore('error_reporting');

     if(is_set($test_var) && strlen($test_var))
     {
          return $test_var;
     }
     else
     {
          return -1;
     }
} 
```

因此，在上述情况下，如果未设置，当我使用不存在的变量`$bar`调用时，我不会收到错误消息。`foo()`但是，我会从我错误键入`is_set`而不是`isset`.

这可能是一个有用的选项，涵盖了原始问题在精神上提出的问题，如果不是实际上的话。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-05-31T07:34:24.293

如果只是给参数添加一个默认值，调用函数时可以跳过它。例如：

```
function empty($paramName = ""){
    if(isset($paramName){
        //Code here
    }
    else if(empty($paramName)){
        //Code here
    }
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-06-05T00:55:23.513

只需一行，您就可以完成它：`myHappyFunction($someBogusVar="");`

我希望这就是你要找的。如果您阅读 php 文档，在[默认参数值](http://php.net/manual/en/functions.arguments.php)下，您可以看到为函数的参数分配默认值有助于防止在使用函数时出现错误消息。

在此示例中，您可以看到使用默认参数的区别及其优势：

**PHP代码：**

```
<?php
function test1($argument)
{
    echo $argument;
    echo "\n";
}

function test2($argument="")
{
    echo $argument;
    echo "\n";
}

test1();
test1("Hello");
test1($argument);
$argument = "Hello world";
test1($argument);

test2();
test2("Hello");
test2($argument);
$argument = "Hello world";
test2($argument);
?> 
```

**行的输出`test1()`：**

> **警告**：缺少 test1() 的参数 1。
> 你好。
> .
> 你好世界。

**行的输出`test2()`：**

> .
> 你好。
> 
> 你好世界。

这也可以结合使用 to`isset()`和其他功能来完成您想要的。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-09-10T19:25:44.840

再往上走抽象树，你用它做什么？

您可以根据需要在每个类中初始化这些值，也可以创建一个包含所有默认值和属性的特定类，例如：

```
class Configuration {

    private var $configValues = array( 'cool' => 'Defaultcoolval' ,
                                       'uncool' => 'Defuncoolval'  );

    public setCool($val) {
        $this->configValues['cool'] = $val;
    }

    public getCool() {
        return $this->configValues['cool'];
    }

} 
```

这个想法是，当在代码中上下各处使用 defaultValue 函数时，每当您必须更改值时，它将成为维护的噩梦，寻找您放置 defaultValue 调用的所有位置。它也可能会导致你重复自己，违反 DRY。

而这是一个存储所有这些默认值的地方。您可能很想避免创建这些 setter 和 getter，但它们也有助于维护，以防需要对输出进行一些修改或验证输入。

# keyboard-shortcuts - 如何跳转到 CodeRush 中的类定义

> ID：55061
> 
> 赞同：2
> 
> 时间：2008-09-10T19:10:04.223
> 
> 标签：keyboard-shortcuts, coderush

刚刚下载了 CodeRush 试用版，我无法轻易找到我真正想要的功能。我希望能够开始输入一个类名并跳转到它的定义，有点像快速导航器，但我希望它在我的解决方案中的封闭文件以及打开的文件中搜索。我知道 R# 有这种能力，我认为 CodeRush 也有。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-10T21:48:31.067

1) `Ctrl`+ `Shift`+ `Q`(这将调出快速导航)

2) 开始输入类型、变量等的名称。

3) 按 Enter 选择目标何时显示在列表顶部

如果范围尚未设置为“解决方案”（您可以通过快速导航右侧的下拉菜单来判断），您可以点击++`Alt`进行设置，它将保存状态。`Shift``S`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-08T02:31:07.873

对特洛伊出色回答的快速评论，如果您下载的版本是较新的版本，3.2，则快速导航已重新映射到`Ctrl`+ `Shift`+ `Q`。

# wpf - 在 WPF 应用程序中显示 PDF

> ID：55083
> 
> 赞同：27
> 
> 时间：2008-09-10T19:19:52.997
> 
> 标签：wpf, pdf

任何想法如何在 WPF Windows 应用程序中显示 PDF 文件？

* * *

我正在使用以下代码运行浏览器，但该`Browser.Navigate`方法没有执行任何操作！

```
WebBrowser browser = new WebBrowser();
browser.Navigate("http://www.google.com");
this.AddChild(browser); // this is the System.Windows.Window 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-06T06:25:06.023

您可以使用 WindowsFormHost 控件使 Acrobat Reader 控件在 WPF 应用程序中工作。我在这里有一篇关于它的博客文章：

[http://hugeonion.com/2009/04/06/displaying-a-pdf-file-within-a-wpf-application/](http://hugeonion.com/2009/04/06/displaying-a-pdf-file-within-a-wpf-application/)

我还有一个 5 分钟的截屏视频，讲述了我是如何在这里制作的：

[http://www.screencast.com/t/JXRhGvzvB](http://www.screencast.com/t/JXRhGvzvB)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-10T19:25:07.680

您可以简单地在表单上托管一个 Web 浏览器控件并使用它来打开 PDF。

.NET 3.51 中有一个新的本机 WPF“WebBrowser”控件，或者您可以在 WPF 应用程序中托管 Windows.Forms 浏览器。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-10T20:04:59.020

哎呀。这是一个winforms应用程序。不适用于 WPF。无论如何我都会发布这个。

试试这个

```
private AxAcroPDFLib.AxAcroPDF axAcroPDF1;
this.axAcroPDF1 = new AxAcroPDFLib.AxAcroPDF();
this.axAcroPDF1.Dock = System.Windows.Forms.DockStyle.Fill;
this.axAcroPDF1.Enabled = true;
this.axAcroPDF1.Name = "axAcroPDF1";
this.axAcroPDF1.OcxState = ((System.Windows.Forms.AxHost.State)(resources.GetObject("axAcroPDF1.OcxState")));
axAcroPDF1.LoadFile(DownloadedFullFileName);
axAcroPDF1.Visible = true; 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2013-06-29T15:11:59.027

试试`MoonPdfPanel - A WPF-based PDF viewer control` [http://www.codeproject.com/Articles/579878/MoonPdfPanel-A-WPF-based-PDF-viewer-control](http://www.codeproject.com/Articles/579878/MoonPdfPanel-A-WPF-based-PDF-viewer-control)

GitHub：[https ://github.com/reliak/moonpdf](https://github.com/reliak/moonpdf)

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-24T14:44:18.323

以下代码需要安装 Adob​​e Reader 并将 Pdf 扩展连接到此。它只是运行它：

```
String fileName = "FileName.pdf";
System.Diagnostics.Process process = new System.Diagnostics.Process(); 
process.StartInfo.FileName = fileName;
process.Start();
process.WaitForExit(); 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2011-04-22T19:14:02.833

只需像这样使用框架和网络浏览器

```
Frame frame = new Frame();
WebBrowserbrowser = new WebBrowser();
browser.Navigate(new Uri(filename));
frame.Content = browser; 
```

然后，当您不再需要它时，请执行以下操作来清理它：

```
WebBrowser browser = frame.Content as WebBrowser;
browser.Dispose();
frame.Content = null; 
```

如果您不清理它，那么您可能会遇到内存泄漏问题，具体取决于您使用的 .NET 版本。如果我不清理，我会在 .NET 3.5 中看到严重的内存泄漏。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-10-17T10:15:33.230

披露：这是一个商业广告，我为这家公司工作。

我意识到答案已被接受，但以下不需要 Adob​​e Reader/Acrobat，它是 WPF 解决方案 - 与 Winforms 不同。我也意识到这是一个老问题，但它刚刚更新，所以我想它仍然是真实的。

[PDFRasterizer.NET 3.0](https://www.tallcomponents.com/pdfrasterizer3.aspx)允许您呈现到 WPF FixedDocument。它保留所有矢量图形（PDF 图形被转换为或多或少等效的 WPF 元素。这可能最接近您的需要。

```
using (FileStream file = new FileStream(path, FileMode.Open, FileAccess.Read))
{
  pdfDoc = new Document(file);

  ConvertToWpfOptions convertOptions = new ConvertToWpfOptions();
  RenderSettings renderSettings = new RenderSettings();
  ...

  FixedDocument wpfDoc = pdfDoc.ConvertToWpf(renderSettings, convertOptions, 0, 9, summary);
} 
```

您可以将 wpfDoc 传递给例如 WPF DocumentViewer 以快速实现查看器。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-01-05T18:19:35.110

您也可以使用 FoxitReader。它是免费的，并带有一个 ActiveX 控件，在您安装 FoxitReader 应用程序后，该控件会在 Web 浏览器（IE 和其他浏览器）中注册。因此，在系统上安装 FoxitReader 后，放置一个 WebBrowser 控件并将其 Source 属性设置为指向 PDF 文件的文件路径。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-10T19:21:22.557

检查一下： http: [//itextsharp.sourceforge.net/](http://itextsharp.sourceforge.net/) 您可能必须使用 WindowsFormsHost，但由于它是开源的，您可能可以在 WPF 中使它更优雅一点。

# c++ - 如何在 C++ 中处理数组（在堆栈上声明）？

> ID：55093
> 
> 赞同：15
> 
> 时间：2008-09-10T19:27:04.430
> 
> 标签：c++, arrays

我有一个类来解析将结果保存在数组成员中的矩阵：

```
class Parser
{
  ...
  double matrix_[4][4];
}; 
```

这个类的用户需要调用一个 API 函数（比如，一个我无法控制的函数，所以我不能只是改变它的接口来让事情更容易工作），看起来像这样：

```
void api_func(const double matrix[4][4]); 
```

我想出让调用者将数组结果传递给函数的唯一方法是将成员公开：

```
void myfunc()
{
  Parser parser;
  ...
  api_func(parser.matrix_);
} 
```

这是做事的唯一方法吗？我对像这样声明的多维数组是多么不灵活感到震惊。我认为`matrix_`基本上与 a 相同`double**`，我可以（安全地）在两者之间进行转换。事实证明，我什至找不到一种*不安全*的方式在事物之间进行转换。假设我在`Parser`类中添加了一个访问器：

```
void* Parser::getMatrix()
{
  return (void*)matrix_;
} 
```

这将编译，但我不能使用它，因为似乎没有办法转换回奇怪的数组类型：

```
 // A smorgasbord of syntax errors...
  api_func((double[][])parser.getMatrix());
  api_func((double[4][4])parser.getMatrix());
  api_func((double**)parser.getMatrix()); // cast works but it's to the wrong type 
```

错误是：

> 错误 C2440：“类型转换”：无法从“void *”转换为“const double [4][4]”

...带有一个有趣的附录：

> 没有对数组类型的转换，尽管有对引用或指向数组的指针的转换

我也无法确定如何转换为引用或指向数组的指针，尽管它在这里可能对我没有帮助。

可以肯定的是，在这一点上，这件事纯粹是学术性的，因为`void*`演员阵容几乎不比一个公开的班级成员更干净！

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-10T19:53:16.443

这是一个很好，干净的方式：

```
class Parser
{
public:
   typedef double matrix[4][4];

   // ...

   const matrix& getMatrix() const
   {
      return matrix_;
   }

   // ...

private:
  matrix matrix_;
}; 
```

现在您正在使用描述性类型名称而不是数组，但由于它是一个`typedef`，编译器仍然允许将其传递给采用基本类型的不可更改的 API 函数。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-10T19:59:33.167

试试这个。它在 gcc 4.1.3 上干净地编译：

```
typedef double FourSquare[4][4];

class Parser
{
  private:
    double matrix_[4][4];

  public:
    Parser()
    {
        for(int i=0; i<4; i++)
          for(int j=0; j<4; j++)
            matrix_[i][j] = i*j;
    }

  public:
    const FourSquare& GetMatrix()
    {
        return matrix_;
    }
};

void api_func( const double matrix[4][4] )
{
}

int main( int argc, char** argv )
{
    Parser parser;
    api_func( parser.GetMatrix() );
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-10T19:38:02.207

我过去曾使用过这样的联合来传递矩阵：

```
union matrix {
    double dflat[16];
    double dmatr[4][4];
}; 
```

然后将指针传递给您的设置器并将数据复制到您的类中的矩阵中。

有其他方法可以处理这个问题（更通用），但根据我的经验，这个解决方案最终往往是最干净的。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-10T20:07:17.347

> 我认为 matrix_ 本质上与双精度相同**

在 C 中有真正的多维数组，而不是指向数组的指针数组，所以一个 double[4][4] 是一个由四个 double[4] 数组组成的连续数组，相当于一个 double[16]，而不是一个 (double *)[4]。

> 没有对数组类型的转换，尽管有对数组的引用或指针的转换将值转换为 double[4][4] 将尝试在堆栈上构造一个 - 相当于 std::string(parser.getMatrix( )) - 除了数组不提供合适的构造函数。即使可以，您也可能不想这样做。

由于类型对步幅进行编码，因此您需要一个完整类型（double[][] 不会这样做）。您可以将 void* 重新解释为 ((double[4][4])*)，然后获取参考。但最简单的方法是首先对矩阵进行 typedef 并返回正确类型的引用：

```
typedef double matrix_t[4][4];

class Parser
{
    double matrix_[4][4];
public:
    void* get_matrix () { return static_cast<void*>(matrix_); }

    const matrix_t& get_matrix_ref () const { return matrix_; }
};

int main ()
{
    Parser p;

    matrix_t& data1 = *reinterpret_cast<matrix_t*>(p.get_matrix());

    const matrix_t& data2 = p.get_matrix_ref();
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-10T21:15:18.540

要详细说明所选答案，请注意这一行

```
const matrix& getMatrix() const 
```

这很棒，您不必担心指针和强制转换。您正在返回对基础矩阵对象的*引用。*恕我直言，引用是 C++ 的最佳特性之一，我在直接用 C 编码时错过了它。

如果您不熟悉 C++ 中引用和指针之间的区别，[请阅读本文](https://isocpp.org/wiki/faq/references)

无论如何，您必须意识到，如果`Parser`实际拥有底层矩阵对象的对象超出范围，则任何尝试通过该引用访问矩阵的代码现在都将引用一个超出范围的对象，并且你会崩溃的。

# wpf - 是否有良好的 WPF 枢轴控制？

> ID：55096
> 
> 赞同：15
> 
> 时间：2008-09-10T19:29:02.930
> 
> 标签：wpf, controls

有没有人有任何良好的 wpf 数据透视表控件的经验？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-10T19:34:59.047

[DevExpress Grid 控件](http://www.devexpress.com/Products/NET/Controls/WPF/Grid/)具有良好的枢轴功能。Winforms 使用它很多。我认为 WPF 版本也可用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T04:39:22.433

[Xceed WPF Grid](http://xceed.com/Grid_WPF_Intro.html)看起来有很多很棒的功能。我们使用他们的 WinForms 网格，它做得很好。他们有一个演示应用程序，您可以下载该应用程序，展示您可以使用网格的不同方式。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-03T02:44:01.883

VIBlend 的[数据网格控件](http://www.viblend.com/products/winforms/gridview.aspx)具有数据透视表功能。我不确定他们是否有 WPF 版本，但您当然可以在 WPF 中托管 WinForms 控件。另一种选择是尝试托管 MS Office OWC。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T04:31:11.317

替代方案：如果您正在运行 OLAP，
[Excel OWC是一个很好的查询和报告工具。](http://www.microsoft.com/downloads/details.aspx?familyid=7287252c-402e-4f72-97a5-e0fd290d4b76&displaylang=en)它有点过时并且记录不充分，但在 Intranet 上运行良好，并且可以通过网络发出吱吱声。

[http://msdn.microsoft.com/en-us/magazine/cc164070.aspx](http://msdn.microsoft.com/en-us/magazine/cc164070.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-10T20:15:31.007

如果可能的话，我还需要能够拖动列标题并使它们成为行标题，并对数据进行相应的汇总和分组。类似于旧的 ActiveX DataDynamics Dynamicube 的东西。

[http://www.datadynamics.com/Products/ProductOverview.aspx?Product=DC](http://www.datadynamics.com/Products/ProductOverview.aspx?Product=DC)

自动汇总、过滤正在使用的数据项等，而无需编写大量代码以自定义方式完成。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-03T03:09:03.447

我建议[WPF Toolkit](http://www.codeplex.com/wpf/Release/ProjectReleases.aspx?ReleaseId=14963)可以从 Codeplex 中的 DatGrid 下载。这与最新的 WPF(.NET3.5 SP1) 兼容，它是免费的，并且几乎具有通用的所有功能（甚至更多）但是有些商业供应商拥有良好的网格控件（不是真正免费的）。像 Xceed、Infragistics、Component One、Telerik

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-09T17:38:14.817

目前没有 WPF Pivot Grid 控件。最有可能拥有它的供应商 DevExpress 还没有 XtraPivotGrid 的 WPF 版本。

最好的办法是使用 WPF 控件中托管的 XtraPivotGrid。

您可以做的另一件事是使用另一个网格供应商并通过使用 LINQ 或手动操作 DataTable 来进行“透视”。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-02-24T07:44:33.300

[适用于 WPF 的 DevExpress Pivot Grid](http://devexpress.com/Home/Announces/Roadmap-2010.xml#wpf)几乎已准备就绪。将于今年上半年发布。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2011-02-02T09:48:54.633

我是 Infragistics 的一名顾问，过去几周我一直在 Infragistics XamPivotGrid 工作。我们一直在努力使这种控制快速且内存高效。作为用户和开发人员，我对这个控件的可用性印象深刻。您可以在 www.infragistics.com 上的 WPF 和 Silverlight NetAdvantage 数据可视化产品中查看此控件！

:-)

# svn - 查找 SVN 工作文件夹的结帐历史记录

> ID：55099
> 
> 赞同：4
> 
> 时间：2008-09-10T19:32:35.510
> 
> 标签：svn, tortoisesvn

我们有一个由 SVN 支持的 Intranet 站点，因此该站点是存储库的检出副本（仅由 IIS 使用的工作文件夹）。今天网站上的某些东西引起了问题，我想知道如何找出在过去 48 小时内签出到该工作文件夹的内容。

**更新：**如果有一个选项我需要打开以在将来启用它，它是什么？

另外，作为一个必然的问题，如果我必须使用文件创建时间，我怎样才能以递归方式快速地为一个大文件夹做到这一点？

* * *

如果我必须检查创建时间，那么[这个问题](https://stackoverflow.com/questions/56682/how-to-see-if-a-subfile-of-a-directory-has-changed)也将对解决方案有所帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-10T19:33:35.710

您可以在本地文件上使用创建日期。您不能使用修改日期，因为 Subversion 在结帐时将其设置为最后更改。

Subversion*也可以*记录结帐，但那是服务器端的

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-10T20:56:39.240

web 文件夹中的所有代码都应该由 SVN 提交支持，不是吗？

如果是这种情况，您应该能够轻松地通过查看您提交的最后几个更改的 SVN 日志来跟踪问题。 `svn info`将告诉您当前工作副本的修订版本，因此您知道从哪里开始查找

一旦你追踪到包含 bug 的提交，你就可以`svn blame`找到做它的人，并向他们解释他们忽略了什么以及他们是如何导致 bug 的。然后你可以让他们为搞砸网站的每个人买午餐。

如果您在本地修改/添加了任何不在 SVN 中的文件，那么`svn stat`您`svn diff`将向您展示这些更改是什么，这样您就可以确定它们是否也导致了问题。然后，您应该恢复这些更改，以便您的工作副本是一个干净的签出，或者将更改提交到存储库中。

没有什么比试图追踪代码中的错误更糟糕的了，但在 3 小时后才发现该错误实际上并不存在于您的任何代码中，而是在一些愚蠢的本地调整中，有人在工作副本中进行了从未提交过的操作：- (

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-10T20:14:03.990

取决于您访问 SVN 存储库的方式 - 如果您以 file:// URL 的形式访问它，我认为您不走运。但是，如果您使用 svnserve 或其中一个 HTTP 网关，您应该能够检查您的服务器日志以访问 SVN url。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-10T20:27:20.637

我会在 web 文件夹中运行一个*svn st*（以查找自检出后更改的任何文件）并将其与存储库进行比较。

# c# - 如何从方法返回匿名类型？

> ID：55101
> 
> 赞同：13
> 
> 时间：2008-09-10T19:33:28.347
> 
> 标签：c#, linq, data-structures, parameter-passing

我有一个想要从多个地方调用的 Linq 查询：

```
var myData = from a in db.MyTable
             where a.MyValue == "A"
             select new  {
                            a.Key,
                            a.MyValue
                          }; 
```

如何创建一个方法，将这段代码放入其中，然后调用它？

```
public  ???  GetSomeData()
{
   // my Linq query
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-10T20:32:44.787

IQueryable 和 IEnumerable 都可以工作。但是您想使用特定于类型的版本， IQueryable `<`T`>`或 IEnumerable `<`T `>`。

因此，您需要创建一个类型来保存数据。

```
var myData = from a in db.MyTable
             where a.MyValue == "A"
             select new MyType
             {
                 Key = a.Key,
                 Value = a.MyValue
             }; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-10T19:35:44.333

[`IQueryable`](http://msdn.microsoft.com/en-us/library/system.linq.iqueryable.aspx)

所以你的方法声明看起来像

```
public IQueryable GetSomeData() 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-10T20:41:30.960

通用方法应该为您提供智能感知：

```
public class MyType {Key{get;set;} Value{get;set}}

public IQueryable<T> GetSomeData<T>() where T : MyType, new() 
 { return from a in db.MyTable
          where a.MyValue == "A" 
          select new T {Key=a.Key,Value=a.MyValue};
 } 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-10T19:38:52.030

如果你想返回，你需要一个类型。

而不是`var`，声明使用`IEnumerable<>`并返回该变量。遍历它实际上会执行查询。

# asp.net - 如何使用 asp.net 将 .docx 转换为 html？

> ID：55113
> 
> 赞同：8
> 
> 时间：2008-09-10T19:36:39.447
> 
> 标签：asp.net, xml, xslt, openxml

Word 2007 将其文档保存为 .docx 格式，这实际上是一个 zip 文件，其中包含一堆内容，包括带有文档的 xml 文件。

我希望能够获取一个 .docx 文件并将其放入我的 asp.net Web 应用程序的文件夹中，并让代码打开 .docx 文件并将文档的（xml 部分）呈现为网页。

我一直在网上搜索有关此的更多信息，但到目前为止还没有找到太多。我的问题是：

1.  您会 (a) 使用 XSLT 将 XML 转换为 HTML，还是 (b) 使用 .net 中的 xml 操作库（例如 3.5 中的 XDocument 和 XElement）转换为 HTML 或 (c) 其他？
2.  您是否知道我可以将其用作起点的任何开源库/项目？

谢谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-10T19:37:40.100

试试这个[帖子](http://blog.maartenballiauw.be/post/2008/01/11/Preview-Word-files-(docx)-in-HTML-using-ASPNET-OpenXML-and-LINQ-to-XML.aspx)？我不知道，但可能是你正在寻找的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-05-10T16:27:19.017

我编写了[mammoth.js](https://github.com/mwilliamson/mammoth.js)，这是一个将 docx 文件转换为 HTML 的 JavaScript 库。如果您想在 .NET 中进行服务器端渲染，[NuGet 上](https://www.nuget.org/packages/Mammoth)还有一个 .NET 版本的 Mammoth 。

Mammoth 试图通过查看语义信息来生成干净的 HTML——例如，将 Word 中的段落样式（例如`Heading 1`）映射到 HTML/CSS 中的适当标签和样式（例如`<h1>`）。如果您想要产生精确视觉副本的东西，那么猛犸象可能不适合您。如果你有一些已经结构良好的东西并且想要将它转换为整洁的 HTML，那么 Mammoth 可能会成功。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-10T19:39:24.340

Word 2007 具有可用于转换为 HTML 的 API。这是一篇讨论它的帖子[http://msdn.microsoft.com/en-us/magazine/cc163526.aspx](http://msdn.microsoft.com/en-us/magazine/cc163526.aspx)。您可以找到有关 API 的文档，但我记得 API 中有一个转换为 HTML 的功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-09-04T05:26:02.667

此代码将有助于将`.docx`文件转换为文本

```
function read_file_docx($filename){

    $striped_content = '';
    $content = '';

    if(!$filename || !file_exists($filename)) { echo "sucess";}else{ echo "not sucess";}

    $zip = zip_open($filename);

    if (!$zip || is_numeric($zip)) return false;

    while ($zip_entry = zip_read($zip)) {

        if (zip_entry_open($zip, $zip_entry) == FALSE) continue;

        if (zip_entry_name($zip_entry) != "word/document.xml") continue;

        $content .= zip_entry_read($zip_entry, zip_entry_filesize($zip_entry));

        zip_entry_close($zip_entry);
    }// end while

    zip_close($zip);

    //echo $content;
    //echo "<hr>";
    //file_put_contents('1.xml', $content);     

    $content = str_replace('</w:r></w:p></w:tc><w:tc>', " ", $content);
    $content = str_replace('</w:r></w:p>', "\r\n", $content);
     //header("Content-Type: plain/text");

    $striped_content = strip_tags($content);

      $striped_content = preg_replace("/[^a-zA-Z0-9\s\,\.\-\n\r\t@\/\_\(\)]/","",$striped_content);

    echo nl2br($striped_content); 
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-01-16T13:45:22.130

我正在使用互操作。这有点问题，但在大多数情况下都可以正常工作。

```
using System.Runtime.InteropServices;
using Microsoft.Office.Interop.Word; 
```

这个返回html转换文档的路径列表

```
public List<string> GetHelpDocuments()
    {

        List<string> lstHtmlDocuments = new List<string>();
        foreach (string _sourceFilePath in Directory.GetFiles(""))
        {
            string[] validextentions = { ".doc", ".docx" };
            if (validextentions.Contains(System.IO.Path.GetExtension(_sourceFilePath)))
            {
                sourceFilePath = _sourceFilePath;
                destinationFilePath = _sourceFilePath.Replace(System.IO.Path.GetExtension(_sourceFilePath), ".html");
                if (System.IO.File.Exists(sourceFilePath))
                {
                    //checking if the HTML format of the file already exists. if it does then is it the latest one?
                    if (System.IO.File.Exists(destinationFilePath))
                    {
                        if (System.IO.File.GetCreationTime(destinationFilePath) != System.IO.File.GetCreationTime(sourceFilePath))
                        {
                            System.IO.File.Delete(destinationFilePath);
                            ConvertToHTML();
                        }
                    }
                    else
                    {
                        ConvertToHTML();
                    }

                    lstHtmlDocuments.Add(destinationFilePath);
                }
            }

        }
        return lstHtmlDocuments;
    } 
```

而这个将 doc 转换为 html。

```
private void ConvertToHtml()
    {
        IsError = false;
        if (System.IO.File.Exists(sourceFilePath))
        {
            Microsoft.Office.Interop.Word.Application docApp = null;
            string strExtension = System.IO.Path.GetExtension(sourceFilePath);
            try
            {
                docApp = new Microsoft.Office.Interop.Word.Application();
                docApp.Visible = true;

                docApp.DisplayAlerts = WdAlertLevel.wdAlertsNone;
                object fileFormat = WdSaveFormat.wdFormatHTML;
                docApp.Application.Visible = true;
                var doc = docApp.Documents.Open(sourceFilePath);
                doc.SaveAs2(destinationFilePath, fileFormat);
            }
            catch
            {
                IsError = true;
            }
            finally
            {
                try
                {
                    docApp.Quit(SaveChanges: false);

                }
                catch { }
                finally
                {
                    Process[] wProcess = Process.GetProcessesByName("WINWORD");
                    foreach (Process p in wProcess)
                    {
                        p.Kill();
                    }
                }
                Marshal.ReleaseComObject(docApp);
                docApp = null;
                GC.Collect();
            }
        }
    } 
```

杀字不好玩，但总不能让它挂在那里挡住别人吧？

在 web/html 中，我将 html 渲染到 iframe。

有一个下拉列表，其中包含帮助文档列表。值是它的 html 版本的路径，文本是文档的名称。

```
private void BindHelpContents()
    {
        List<string> lstHelpDocuments = new List<string>();
        HelpDocuments hDoc = new HelpDocuments(Server.MapPath("~/HelpDocx/docx/"));
        lstHelpDocuments = hDoc.GetHelpDocuments();
        int index = 1;
        ddlHelpDocuments.Items.Insert(0, new ListItem { Value = "0", Text = "---Select Document---", Selected = true });

        foreach (string strHelpDocument in lstHelpDocuments)
        {
            ddlHelpDocuments.Items.Insert(index, new ListItem { Value = strHelpDocument, Text = strHelpDocument.Split('\\')[strHelpDocument.Split('\\').Length - 1].Replace(".html", "") });
            index++;
        }
        FetchDocuments();

    } 
```

在所选索引更改时，将其重新渲染为框架

```
 protected void RenderHelpContents(object sender, EventArgs e)
    {
        try
        {
            if (ddlHelpDocuments.SelectedValue == "0") return;
            string strHtml = ddlHelpDocuments.SelectedValue;
            string newaspxpage = strHtml.Replace(Server.MapPath("~/"), "~/");
            string pageVirtualPath = VirtualPathUtility.ToAbsolute(newaspxpage);// 
            documentholder.Attributes["src"] = pageVirtualPath;
        }
        catch
        {
            lblGError.Text = "Selected document doesn't exist, please refresh the page and try again. If that doesn't help, please contact Support";
        }
    } 
```

# regexbuddy - RegexBuddy 在使用之间将其工作数据存储在哪里？

> ID：55114
> 
> 赞同：5
> 
> 时间：2008-09-10T19:36:47.620
> 
> 标签：regexbuddy

好吧，所以我是个白痴。

所以我正在研究一个需要很长时间才能制作的正则表达式。在完善它之后，我用超快的硬盘驱动器升级了我的工作机器，并意识到我从未将正则表达式保存在任何地方，只是使用 RegexBuddy 的自动保存来存储它。哑哑哑。

我将正则表达式的副本发送给同事，但现在他找不到它（或我们的通信记录）。我找到正则表达式的最大希望是在旧硬盘上的 RegexBuddy 中找到它。每次关闭 RegexBuddy 时，它都会自动保存您正在处理的任何内容。我已经进行了一些初步搜索，试图确定它实际保存工作数据的位置，但我没有成功。

这个问题是我愚蠢行为的结果，但我认为这是一个最终在这里提出问题的好机会。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-10T20:06:57.953

在我的 XP 机器上，它位于注册表中：

```
HKEY_CURRENT_USER\Software\JGsoft\RegexBuddy3\History 
```

有两个名为**Action0**和**Action1**的 REG_BINARY 键具有包含历史记录中我的两个正则表达式的十六进制数据。

![操作注册表项的屏幕截图](https://i.stack.imgur.com/0k0b0.png)

我正在测试正则表达式的测试数据在这里：

```
C:\Documents and Settings\<username>\Application Data\JGsoft\RegexBuddy 3 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-10T20:00:21.870

当然，这取决于操作系统，但在 Windows 上，我猜是应用程序数据目录。我不记得 xp 上的路径，但在 vista 上是这样的：

C:\Users\*用户名*\AppData\

然后它可能会在这里：

C:\Users\*用户名*\AppData\roaming

# c# - 实例化对象上的 NullReferenceException？

> ID：55130
> 
> 赞同：0
> 
> 时间：2008-09-10T19:48:00.667
> 
> 标签：c#, asp.net, yellow-screen-of-death

这是我继承的应用程序的一段代码，用户出现黄屏死机：

> 你调用的对象是空的

在线上：

```
bool l_Success ... 
```

现在我 95% 确定错误的论点是`ref l_Monitor`非常奇怪的，因为该对象是在几行之前实例化的。任何人都知道为什么会发生这种情况？请注意，我在代码的其他地方看到了同样的问题。

```
IDMS.Monitor l_Monitor = new IDMS.Monitor();
l_Monitor.LogFile.Product_ID = "SE_WEB_APP";

if (m_PermType_RadioButtonList.SelectedIndex == -1) {
    l_Monitor.LogFile.Log(
        Nortel.IS.IDMS.LogFile.MessageTypes.ERROR,
        "No permission type selected"
        );
    return;
}
bool l_Success = SE.UI.Utilities.GetPermissionList(
    ref l_Monitor,
    ref m_CPermissions_ListBox,
    (int)this.ViewState["m_Account_Share_ID"],
    (m_PermFolders_DropDownList.Enabled)
        ? m_PermFolders_DropDownList.SelectedItem.Value
        : "-1",
    (SE.Types.PermissionType)m_PermType_RadioButtonList.SelectedIndex,
    (SE.Types.PermissionResource)m_PermResource_RadioButtonList.SelectedIndex); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-10T19:49:46.203

您确定尝试在 l_Monitor 实例上访问的属性之一不为空吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-10T19:51:50.550

暂时为该 (loooooongg) 行上的所有属性查询添加一些变量。运行调试器，检查值并消除小错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-10T19:56:17.793

我倾向于同意其他人的观点；听起来您传递的参数之一 SE.UI.Utilities.GetPermissionList 是 null 导致异常。最好的办法是启动调试器并检查变量是否在调用该代码之前。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-17T15:32:29.523

实际上是在 catch 块中抛出的`NullReferenceException`，因此堆栈跟踪无法显示该代码行，因此它在调用者处停止。

这确实是`l_Monitor`实例的属性之一。

# sql-server - 数据库引擎比较 - Windows Mobile

> ID：55140
> 
> 赞同：4
> 
> 时间：2008-09-10T19:51:03.157
> 
> 标签：sql-server, windows-mobile, pocketpc, sql-server-mobile

Windows Mobile 上有哪些不同的数据库选项可用？我已经使用 CEDB 和 EDB 来满足线性数据集的需求。

我听说过 SQL Server 2005 移动版。但是比其他人有什么优势（如果有的话）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-10T21:10:02.327

另请查看[SQLite for Windows CE](http://sqlite-wince.sourceforge.net/)。Compact Framework 中也有可用的 .NET 绑定来使用它。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-29T19:37:33.767

我发现 sqllite 和代码库都易于实现和安装。比微软选项更容易（也更稳定），微软选项似乎在严重变化。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-10T20:01:06.627

我认为它现在称为 SQL Server Compact。优点是它与完整的 sql server 语法兼容，因为您为它编写的任何查询都可以保证在等效的 SQL Server Express/Standard/Enterprise DB 上工作。但是，反过来不一定是正确的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-10T20:03:49.040

您需要 SQL 支持吗？如果没有，请查看一个轻量级的可嵌入 DBM 类解决方案。我已经将 Tokyo Cabinet 用于许多不需要 SQL 的嵌入式解决方案，并且非常享受它提供的速度和灵活性。YMMV。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-10T19:55:41.397

我们使用 Sybase Ultralite。在此之前，我们使用 Codebase 连接到 foxpro 表。我不是移动开发人员，但我知道我们选择它而不是 SQL Server 是为了提高性能和内存使用率。我们还发现，当我们发现任何问题时，他们得到了很好的支持。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-11-09T18:57:34.653

我会避免再使用 CEDB，因为我相信 WM7 正在放弃对它的支持。

# c# - 在用户控件/表单中嵌入文件选择器

> ID：55147
> 
> 赞同：1
> 
> 时间：2008-09-10T19:52:21.983
> 
> 标签：c#, .net, winforms

我继承了一个桌面应用程序，它有一个嵌入在控件中的自定义 .NET 文件选择器，但它有一些问题。
我想用非自定义文件选择器（如`OpenFileDialog`）替换它。

但是，由于各种原因，它需要嵌入到父控件而不是弹出对话框中。
是否有我缺少的控件，或者 MS 仅提供开箱即用的弹出对话框？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-10T19:55:50.227

.Net 控件是内置于 Windows 中的常用对话框的薄包装器，即*对话框*。所以没有办法像控件一样嵌入它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T04:35:47.047

根据您的需要，您可以滥用 Web 浏览器控件来显示本地文件和文件夹。它不匹配 OpenFileDialog 的所有功能，但它可以工作。

这是我回想起的一个。 [壳牌超级包装](http://www.ssware.com/megapack.htm)。它有 ActiveX 和 .NET 版本。看起来很有希望。

或者，如果您想构建自己的，您可以从 CodeProject：[A Windows Explorer in a User Control](http://www.codeproject.com/KB/miscctrl/ExplorerTree.aspx)开始。这看起来是一个好的开始。这是另一个：[一个 All VB.NET Explorer Tree Control with ImageList Management](http://www.codeproject.com/KB/cpp/VbNetExpTree.aspx)。

# sql-server - 在 SQL Server 中，执行插入时是否可以获得记录的“id”？

> ID：55159
> 
> 赞同：12
> 
> 时间：2008-09-10T19:56:54.470
> 
> 标签：sql-server, identity

在 SQL Server 2005 中，我在一个表中有一个“id”字段，该字段的“Is Identity”属性设置为“Yes”。因此，当在该表上执行插入时，“id”会自动设置为下一个递增整数。执行插入以获取“id”设置的内容时是否有一种简单的方法，而无需在插入后立即执行 Select 语句？

> 重复：
> [获取插入行标识的最佳方法？](https://stackoverflow.com/questions/42648/best-way-to-get-identity-of-inserted-row)

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2008-09-10T20:02:45.407

至少在 .Net 中，您可以一次性向服务器发送多个查询。我在我的应用程序中执行此操作：

```
command.CommandText = "INSERT INTO [Employee] (Name) VALUES (@Name); SELECT SCOPE_IDENTITY()";
int id = (int)command.ExecuteScalar(); 
```

奇迹般有效。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-10T20:51:40.453

如果要插入多行，则在语句中使用`OUTPUT`and`INSERTED.columnname`子句`insert`是一种将所有 id 放入临时表的简单方法。

```
DECLARE @MyTableVar table( ID int,  
                               Name varchar(50),  
                               ModifiedDate datetime);  
INSERT MyTable  
        OUTPUT INSERTED.ID, INSERTED.Name, INSERTED.ModifiedDate INTO @MyTableVar  
SELECT someName, GetDate() from SomeTable 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-10T20:02:00.667

Scope_identity() 是首选方式，请参阅：[获取当前标识值的 6 种不同方法](http://wiki.lessthandot.com/index.php/6_Different_Ways_To_Get_The_Current_Identity_Value)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-10T20:09:12.473

SCOPE_IDENTITY(); 是你最好的选择。如果您使用的是 .NET，只需传递一个我们的参数并在程序运行后检查该值。

```
CREATE PROCEDURE [dbo].[InsertProducts]
    @id             INT             = NULL OUT,
    @name           VARCHAR(150)    = NULL,
    @desc           VARCHAR(250)    = NULL

AS

    INSERT INTO dbo.Products
       (Name,
        Description)
    VALUES
       (@name,
        @desc)

    SET @id = SCOPE_IDENTITY(); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-10T19:58:31.733

您必须选择 scope_identity() 函数。

要从应用程序代码中执行此操作，我通常将此过程封装在一个存储过程中，因此它看起来仍然像对我的应用程序的一个查询。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-10T21:08:38.180

我倾向于使用企业管理器将触发器附加到表中。这样您就不必担心在代码中写出额外的 sql 语句。我的看起来像这样：

Create Trigger tblName On dbo.tblName For Insert As select new_id = @@IDENTITY

然后，在您的代码中，将您的插入语句视为选择语句 - 只需执行并评估结果。“newID”列将包含您刚刚创建的行的标识。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-01-02T10:30:07.890

这可能是我为 SQL Server 找到的最佳工作解决方案。SQL Server [在插入语句后返回标识列的值](https://stackoverflow.com/questions/17993606/sql-server-return-the-value-of-identity-column-after-insert-statement)

# linq-to-entities - 为什么所有 Linq To 实体都讨厌？

> ID：55179
> 
> 赞同：6
> 
> 时间：2008-09-10T20:05:02.983
> 
> 标签：linq-to-entities

我注意到似乎对 Linq To Entities 有相当多的敌意，尤其是来自 Alt.Net 的人。我理解对更多“拖放”编程的阻力，但据我了解，Linq To Entities 不需要它。

我们目前正在使用Linq to SQL，并且我们正在使用DBML文档来定义它（一旦你得到十几个左右的表，设计器就很没用了。）

那么为什么同样的方法对 Linq To Entities 不起作用呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-01-05T13:10:25.773

实际上，一旦开始深入研究，LTE 对于企业级框架完全没有用处。几乎没有继承支持的事实（在 LTS 中也是如此）导致大量冗余代码。此外，我将回到 LTS（Linq to SQL），因为它实际上允许您通过属性而不是文件来定义映射。LTE 仅适用于外部文件。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-10T20:09:11.287

我不认为这是对它本身的*想法的仇恨。*只是人们不喜欢它的*实施*。

[http://efvote.wufoo.com/forms/ado-net-entity-framework-vote-of-no-confidence/](http://efvote.wufoo.com/forms/ado-net-entity-framework-vote-of-no-confidence/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-20T07:14:50.487

Linq to Entity 的仇恨是当之无愧的。这个产品没有任何比 GU 在他的博客上使用它的蹩脚演示更复杂的目的。英孚远未准备好迎接黄金时段。微软只是无法在 .BLOAT 世界中正确获取数据，他们似乎每次都在改变数据范式。FoxPro 已经存在 20 年了，具有相同的基本数据核心。鉴于 SQL Server 使用了很多 VFP 数据技术，或许 MSFT 可以从一些有用的东西中学习一些关于操作数据和以数据为中心的语言的知识。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-05T13:16:30.613

我对 Linq to Entities 的原则和一般的实体框架非常满意，但我对它目前的化身持保留态度。不过，我确实坦率地承认，除了自我教育和非常小的方式之外，我没有以任何方式使用它。灵活性水平似乎还没有，但我相信它会到来。一位 MS 技术布道者（伟大的职位）告诉我，EF 是 MS 未来的战略选择。假设是这种情况，我只能看到这个领域的情况越来越好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-01-05T13:24:35.807

也可能有一点“第二名”的敌意。MS 在L2E 上上市*很晚*，大约三年前，我本人对 ORM 产生了兴趣，此时还无处可见 MS。

我们中的很多人已经花时间学习另一个 ORM（例如 NHibernate），并且已经习惯了某种级别和类型的可用功能，而这在 L2E 中还不明显。

老实说，这种“第二名”的敌意并不是什么老新闻，我不知道为什么 MS 不花更多时间支持已经到位的解决方案，我们以前在 NAnt -> MSBuild 和 NUnit -> MsTest 上已经看到了这一切，如果他们只是接受一种更好、更成熟的解决方案并努力支持它，而不是一直在酝酿自己的解决方案，这将为每个人节省大量的时间和精力。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-03-22T15:47:57.970

我要补充一点，TPT 继承的 LTE 实现简直就是犯罪。[在这里](https://stackoverflow.com/questions/4126668/when-quering-over-a-base-type-why-does-the-ef-provider-generate-all-those-union-a)查看我的问题。

虽然我这样做了，但我相信许多[已发表的 EF 专家](http://www.amazon.com/s/ref=nb_sb_noss?url=search-alias=aps&field-keywords=entity+framework+in+books&x=0&y=0)至少部分是同谋。我还没有在 EF 上找到任何已发布的材料，警告不要查询基本类型。如果我要在我拥有的模型上尝试它，SQL Server 只是放弃了例外。

> 您的 SQL 语句的某些部分嵌套得太深。重写查询或将其分解为更小的查询。

我很想重写查询，但 LTE 免除了我的负担。谢谢（^不）

# python - 在 Python 中，如何轻松地从字典中检索已排序的项目？

> ID：55180
> 
> 赞同：12
> 
> 时间：2008-09-10T20:05:25.493
> 
> 标签：python, sorting, dictionary, list

与列表不同的字典没有排序（并且没有“排序”属性）。因此，您不能依赖第一次添加时以相同的顺序获取项目。

遍历包含字符串作为键值的字典并按键升序检索它们的最简单方法是什么？

例如，你有这个：

```
d = {'b' : 'this is b', 'a': 'this is a' , 'c' : 'this is c'} 
```

我想按以下按键排序的顺序打印关联的值：

```
this is a
this is b
this is c 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-10T20:10:05.687

您的意思是您需要按键值排序的值吗？在这种情况下，应该这样做：

```
for key in sorted(d):
    print d[key] 
```

**编辑：**更改为使用 sorted(d) 而不是 sorted(d.keys())，谢谢[Eli](https://stackoverflow.com/users/1694/eli-courtwright)！

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-10T20:10:51.550

或者更短，

```
for key, value in sorted(d.items()):
    print value 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T09:34:47.153

```
for key in sorted(d):
  print d[key] 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-10T20:08:48.933

这个片段会这样做。如果您要经常这样做，您可能想要制作一个“排序键”方法或类似的方法，以使其更容易阅读。

```
keys = list(d.keys())
keys.sort()
for key in keys:
    print d[key] 
```

编辑：dF 的解决方案更好——我忘记了 sorted()。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-10T20:11:55.073

```
>>> d = {'b' : 'this is b', 'a': 'this is a' , 'c' : 'this is c'}
>>> for k,v in sorted(d.items()):
...     print v, k
... 
this is a a
this is b b
this is c c 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-12T15:11:00.007

您还可以按值对字典进行排序并控制排序顺序：

```
import operator

d = {'b' : 'this is 3', 'a': 'this is 2' , 'c' : 'this is 1'}

for key, value in sorted(d.iteritems(), key=operator.itemgetter(1), reverse=True):
    print key, " ", value 
```

输出：
b 这是 3
a 这是 2
c 这是 1

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-10T20:12:48.173

```
d = {'b' : 'this is b', 'a': 'this is a' , 'c' : 'this is c'}
ks = d.keys()
ks.sort()
for k in ks:
    print "this is " + k 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-10-28T08:52:25.280

你的意思是“排序”而不是“有序”？看来您的问题旨在对字典进行排序，而不是对其进行排序。如果您的意思是“有序”，您可以使用集合模块中的 OrderedDict。这些字典会记住输入键/值对的顺序：

```
from collections import OrderedDict 
```

参考资料：[https ://docs.python.org/2/library/collections.html#collections.OrderedDict](https://docs.python.org/2/library/collections.html#collections.OrderedDict)

# c# - 弹出另一个窗口请求信息后，如何在文本框中插入文本？

> ID：55203
> 
> 赞同：1
> 
> 时间：2008-09-10T20:14:01.667
> 
> 标签：c#, asp.net, javascript

我有一个用 C# 编写的 asp.net 网页。
使用一些 javascript，我弹出另一个 .aspx 页面，该页面有一些填充的控件，我从中创建了一小段文本。
当用户在该对话框上单击“确定”时，我想将该段文本插入页面上最初“弹出”对话框/弹出页面的文本框中。

我猜这将涉及javascript，这不是我的强项。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-10T20:27:05.783

您将不得不执行以下操作：

```
parent.opener.document.getElemenyById('ParentTextBox').value = "New Text"; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-10T20:19:33.963

您可以做的是创建一个 ajax 模式弹出窗口而不是一个新窗口。语义和美学价值更大，更不用说数据传递更容易。

[http://www.asp.net/ajax/ajaxcontroltoolkit/samples/modalpopup/modalpopup.aspx](http://www.asp.net/ajax/ajaxcontroltoolkit/samples/modalpopup/modalpopup.aspx)

# vb6 - Visual Basic 6.0 中的运算符优先顺序是什么？

> ID：55206
> 
> 赞同：16
> 
> 时间：2008-09-10T20:14:07.983
> 
> 标签：vb6

Visual Basic 6.0 (VB6) 中的运算符优先顺序是什么？

特别是对于逻辑运算符。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-10T20:16:37.463

### 算术运算优先顺序

1.  `^`
2.  `-`（一元否定）
3.  `*`,`/`
4.  `\`
5.  `Mod`
6.  `+`, `-`（二进制加法/减法）
7.  `&`

### 比较操作优先顺序

1.  `=`
2.  `<>`
3.  `<`
4.  `>`
5.  `<=`
6.  `>=`
7.  `Like`,`Is`

### 逻辑运算优先顺序

1.  `Not`
2.  `And`
3.  `Or`
4.  `Xor`
5.  `Eqv`
6.  `Imp`

**资料来源：** [Sams 在 24 小时内自学 Visual Basic 6 — 附录 A：运算符优先级](http://www.informit.com/library/content.aspx?b=STY_VB6_24hours&seqNum=247)

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-10T20:36:35.060

这取决于您是否在调试器中。*真的。* 嗯，有点。

当然，括号是第一位的。然后算术（+、-、*、/ 等）。然后比较（>、<、= 等）。然后是逻辑运算符。诀窍是未定义给定优先级内的执行顺序。给定以下表达式：

```
If A < B And B < C Then 
```

您可以保证`<`不等式运算符都将在逻辑`And`比较之前进行评估。但是您不能保证首先执行哪个不等式比较。

**IIRC，调试器从左到右执行，但编译后的应用程序从右到左执行。** 我可以让它们倒退（已经很长时间了），但重要的是它们是不同的。实际优先级不会改变，但执行顺序可能会改变。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-05T15:58:48.787

# **使用括号**

* * *

编辑：这是我对新代码的建议！但是奥斯卡正在阅读别人的代码，所以必须以某种方式弄清楚。我建议 VBA 手册主题[*Operator Precedence*](https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/operator-precedence)。VBA 与 VB6 有 99% 的等效性 - 表达式求值是 100% 等效的。我在这里粘贴了逻辑运算符信息。

逻辑运算符按以下优先顺序进行评估：

```
不是   
和   
或者   
异或   
方程   
小鬼   

```

该主题还解释了比较和算术运算符的优先级。

我建议一旦你弄清楚了优先级，你就用括号括起来，除非有充分的理由不编辑代码。

# algorithm - 生成字谜的算法

> ID：55210
> 
> 赞同：56
> 
> 时间：2008-09-10T20:15:17.483
> 
> 标签：algorithm, language-agnostic, puzzle

生成字谜的最佳策略是什么。

> ```
> An anagram is a type of word play, the result of rearranging the letters
> of a word or phrase to produce a new  word or phrase, using all the original
> letters exactly once; 
> ex. 
> ```
> 
> *   **十一加二**是***十二加一的字谜***
> *   **小数点**是***I'm a dot in place的字谜***
> *   **天文学家**是***月球凝视者的字谜***

起初它看起来很简单，只是将字母打乱并生成所有可能的组合。但是，只生成字典中的单词的有效方法是什么。

我遇到了这个页面，[在 Ruby 中解决字谜](http://lojic.com/blog/2007/10/22/solving-anagrams-in-ruby/)。

但是你的想法是什么？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-12-17T21:00:32.397

这些答案中的大多数都非常低效和/或只会给出一个单词的解决方案（没有空格）。我的解决方案可以处理任意数量的单词并且非常有效。

你想要的是一个 trie 数据结构。这是一个**完整**的Python 实现。您只需要保存在一个名为的文件中的单词列表，`words.txt` 您可以在此处尝试拼字游戏词典单词列表：

[http://www.isc.ro/lists/twl06.zip](http://www.isc.ro/lists/twl06.zip)

```
MIN_WORD_SIZE = 4 # min size of a word in the output

class Node(object):
    def __init__(self, letter='', final=False, depth=0):
        self.letter = letter
        self.final = final
        self.depth = depth
        self.children = {}
    def add(self, letters):
        node = self
        for index, letter in enumerate(letters):
            if letter not in node.children:
                node.children[letter] = Node(letter, index==len(letters)-1, index+1)
            node = node.children[letter]
    def anagram(self, letters):
        tiles = {}
        for letter in letters:
            tiles[letter] = tiles.get(letter, 0) + 1
        min_length = len(letters)
        return self._anagram(tiles, [], self, min_length)
    def _anagram(self, tiles, path, root, min_length):
        if self.final and self.depth >= MIN_WORD_SIZE:
            word = ''.join(path)
            length = len(word.replace(' ', ''))
            if length >= min_length:
                yield word
            path.append(' ')
            for word in root._anagram(tiles, path, root, min_length):
                yield word
            path.pop()
        for letter, node in self.children.iteritems():
            count = tiles.get(letter, 0)
            if count == 0:
                continue
            tiles[letter] = count - 1
            path.append(letter)
            for word in node._anagram(tiles, path, root, min_length):
                yield word
            path.pop()
            tiles[letter] = count

def load_dictionary(path):
    result = Node()
    for line in open(path, 'r'):
        word = line.strip().lower()
        result.add(word)
    return result

def main():
    print 'Loading word list.'
    words = load_dictionary('words.txt')
    while True:
        letters = raw_input('Enter letters: ')
        letters = letters.lower()
        letters = letters.replace(' ', '')
        if not letters:
            break
        count = 0
        for word in words.anagram(letters):
            print word
            count += 1
        print '%d results.' % count

if __name__ == '__main__':
    main() 
```

当你运行程序时，单词会被加载到内存中的 trie 中。之后，只需输入您要搜索的字母，它就会打印结果。它只会显示使用所有输入字母的结果，不会更短。

它从输出中过滤掉短词，否则结果的数量是巨大的。随意调整`MIN_WORD_SIZE`设置。请记住，仅使用“astronomers”作为输入，如果`MIN_WORD_SIZE`为 1，则会得到 233,549 个结果。也许您可以找到一个更短的单词列表，其中只包含更常见的英语单词。

`MIN_WORD_SIZE`此外，除非您将“im”添加到字典并设置为 2 ，否则缩略词“I'm”（来自您的一个示例）不会出现在结果中。

获取多个单词的技巧是每当您在搜索中遇到一个完整的单词时就跳回树中的根节点。然后你继续遍历 trie，直到所有字母都用完。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-10T20:32:10.373

对于字典中的每个单词，按字母顺序对字母进行排序。所以“foobar”变成了“abfoor”。

然后当输入字谜出现时，也对其字母进行排序，然后查找。 **它和哈希表查找一样快！**

对于多个单词，您可以对已排序的字母进行组合，随时进行排序。仍然比生成所有组合快得多*。*

*（有关更多优化和详细信息，请参阅评论）*

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-10T22:15:49.487

请参阅华盛顿大学 CSE 系的此[作业。](http://www.cs.washington.edu/education/courses/cse143/08sp/handouts/23.html)

基本上，您有一个数据结构，它只包含单词中每个字母的计数（数组适用于 ascii，如果您需要 unicode 支持，请升级到地图）。您可以减去其中两个字母组；如果计数为负数，您就知道一个词不能是另一个词的字谜。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-11T08:10:50.367

预处理：

用每个叶子作为已知单词构建一个 trie，按字母顺序键入。

搜索时：

将输入字符串视为多重集。通过像深度优先搜索一样遍历索引树来找到第一个子词。在每个分支上，您都可以问，我输入的其余部分中是否包含字母 x？如果你有一个好的多集表示，这应该是一个恒定时间查询（基本上）。

一旦你有了第一个子词，你就可以保留剩余的多重集并将其视为一个新的输入来查找该字谜的其余部分（如果存在的话）。

通过记忆增强此过程，以更快地查找常见的余数多重集。

这非常快 - 每次 trie 遍历都保证给出一个实际的子字，并且每次遍历在子字的长度上花费线性时间（根据编码标准，子字通常非常小）。但是，如果您*真的*想要更快的东西，您可以在预处理中包含所有 n-gram，其中 n-gram 是连续 n 个单词的任何字符串。当然，如果 W = #words，那么您将从索引大小 O(W) 跳转到 O(W^n)。也许 n = 2 是现实的，具体取决于字典的大小。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-28T00:46:25.293

Michael Morton（Mr. Machine Tool）使用名为 Ars Magna 的工具对程序字谜进行了开创性的工作之一。这是一篇基于他的工作[的轻文章。](http://query.nytimes.com/gst/fullpage.html?res=9B06E6DB133EF93BA2575BC0A9639C8B63)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2013-01-03T04:12:26.563

所以[这](https://github.com/parekhparth/AnagramSolver)是 Jason Cohen 建议的 Java 中的工作解决方案，它的性能比使用 trie 的解决方案要好一些。以下是一些要点：

*   仅使用作为给定单词集子集的单词加载字典
*   字典将作为键的已排序单词的散列和作为值的实际单词集（如 Jason 所建议）
*   遍历字典键中的每个单词并进行递归前向查找以查看是否为该键找到任何有效的字谜
*   只做正向查找，因为所有已经遍历过的单词的字谜应该已经找到了
*   合并与键关联的所有单词，例如，如果 'enlist' 是要找到字谜的单词，并且要合并的一组键之一是 [ins] 和 [elt]，以及键的实际单词 [ins ] 是 [sin] 和 [ins]，对于键 [elt] 是 [let]，那么最终的合并词集将是 [sin, let] 和 [ins, let]，这将是我们最终字谜列表的一部分
*   还要注意的是，这个逻辑只会列出唯一的单词集，即“十一加二”和“二加十一”将是相同的，并且只有其中一个会在输出中列出

下面是找到一组字谜键的主要递归代码：

```
// recursive function to find all the anagrams for charInventory characters
// starting with the word at dictionaryIndex in dictionary keyList
private Set<Set<String>> findAnagrams(int dictionaryIndex, char[] charInventory, List<String> keyList) {
    // terminating condition if no words are found
    if (dictionaryIndex >= keyList.size() || charInventory.length < minWordSize) {
        return null;
    }

    String searchWord = keyList.get(dictionaryIndex);
    char[] searchWordChars = searchWord.toCharArray();
    // this is where you find the anagrams for whole word
    if (AnagramSolverHelper.isEquivalent(searchWordChars, charInventory)) {
        Set<Set<String>> anagramsSet = new HashSet<Set<String>>();
        Set<String> anagramSet = new HashSet<String>();
        anagramSet.add(searchWord);
        anagramsSet.add(anagramSet);

        return anagramsSet;
    }

    // this is where you find the anagrams with multiple words
    if (AnagramSolverHelper.isSubset(searchWordChars, charInventory)) {
        // update charInventory by removing the characters of the search
        // word as it is subset of characters for the anagram search word
        char[] newCharInventory = AnagramSolverHelper.setDifference(charInventory, searchWordChars);
        if (newCharInventory.length >= minWordSize) {
            Set<Set<String>> anagramsSet = new HashSet<Set<String>>();
            for (int index = dictionaryIndex + 1; index < keyList.size(); index++) {
                Set<Set<String>> searchWordAnagramsKeysSet = findAnagrams(index, newCharInventory, keyList);
                if (searchWordAnagramsKeysSet != null) {
                    Set<Set<String>> mergedSets = mergeWordToSets(searchWord, searchWordAnagramsKeysSet);
                    anagramsSet.addAll(mergedSets);
                }
            }
            return anagramsSet.isEmpty() ? null : anagramsSet;
        }
    }

    // no anagrams found for current word
    return null;
} 
```

[你可以从这里](https://github.com/parekhparth/AnagramSolver)分叉 repo并使用它。我可能错过了许多优化。但是代码有效并且确实找到了所有的字谜。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-12-19T16:14:53.790

这是我[的](http://dev.vvirlan.com/new-algorithm-anagram/)新颖解决方案。

Jon Bentley 的书 Programming Pearls 包含一个关于查找单词字谜的问题。该声明：

> 给定一本英语单词词典，找出所有的字谜。例如，“pots”、“stop”和“tops”都是彼此的字谜，因为每个都可以通过排列其他字母来形成。

我想了一下，我想到解决方案是获取您正在搜索的单词的签名并将其与字典中的所有单词进行比较。一个单词的所有字谜应该有相同的签名。但是如何实现呢？我的想法是使用算术基本定理：

算术基本定理指出

> 除了重新排列为一个或多个素数的乘积之外，每个正整数（数字 1 除外）都可以用一种方式表示

所以这个想法是使用前 26 个素数的数组。然后对于单词中的每个字母，我们得到相应的素数 A = 2、B = 3、C = 5、D = 7……然后我们计算输入单词的乘积。接下来，我们对字典中的每个单词执行此操作，如果一个单词与我们的输入单词匹配，那么我们将其添加到结果列表中。

性能或多或少可以接受。对于 479828 个单词的字典，获取所有字谜需要 160 毫秒。这大约是 0.0003 毫秒/字，或 0.3 微秒/字。算法的复杂度似乎是 O(mn) 或 ~O(m)，其中 m 是字典的大小，n 是输入单词的长度。

这是代码：

```
package com.vvirlan;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileReader;
import java.io.IOException;
import java.util.ArrayList;
import java.util.Date;
import java.util.List;
import java.util.Scanner;

public class Words {
    private int[] PRIMES = new int[] { 2, 3, 5, 7, 11, 13, 17, 19, 23, 29, 31, 37, 41, 43, 47, 53, 59, 61, 67, 71, 73,
            79, 83, 89, 97, 101, 103, 107, 109, 113 };

    public static void main(String[] args) {
        Scanner s = new Scanner(System.in);
        String word = "hello";
        System.out.println("Please type a word:");
        if (s.hasNext()) {
            word = s.next();
        }
        Words w = new Words();
        w.start(word);
    }

    private void start(String word) {
        measureTime();
        char[] letters = word.toUpperCase().toCharArray();
        long searchProduct = calculateProduct(letters);
        System.out.println(searchProduct);
        try {
            findByProduct(searchProduct);
        } catch (Exception e) {
            e.printStackTrace();
        }
        measureTime();
        System.out.println(matchingWords);
        System.out.println("Total time: " + time);
    }

    private List<String> matchingWords = new ArrayList<>();

    private void findByProduct(long searchProduct) throws IOException {
        File f = new File("/usr/share/dict/words");
        FileReader fr = new FileReader(f);
        BufferedReader br = new BufferedReader(fr);
        String line = null;
        while ((line = br.readLine()) != null) {
            char[] letters = line.toUpperCase().toCharArray();
            long p = calculateProduct(letters);
            if (p == -1) {
                continue;
            }
            if (p == searchProduct) {
                matchingWords.add(line);
            }
        }
        br.close();
    }

    private long calculateProduct(char[] letters) {
        long result = 1L;
        for (char c : letters) {
            if (c < 65) {
                return -1;
            }
            int pos = c - 65;
            result *= PRIMES[pos];
        }
        return result;
    }

    private long time = 0L;

    private void measureTime() {
        long t = new Date().getTime();
        if (time == 0L) {
            time = t;
        } else {
            time = t - time;
        }
    }
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-13T14:58:18.420

几个月前，我使用了以下计算字谜的方法：

*   为字典中的每个单词计算一个“代码”：创建一个从字母表中的字母到素数的查找表，例如以 ['a', 2] 开始并以 ['z', 101] 结束。作为预处理步骤，通过在查找表中查找它包含的每个字母的质数并将它们相乘来计算字典中每个单词的代码。为以后的查找创建一个代码到单词的多重映射。

*   如上所述计算输入单词的代码。

*   计算多图中每个代码的 codeInDictionary % inputCode。如果结果为 0，则您找到了一个字谜，您可以查找相应的单词。这也适用于 2 个或更多单词的字谜。

希望这会有所帮助。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-15T18:33:37.840

*Jon Bentley 的《 Programming Pearls*》一书很好地涵盖了这类内容。必读。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-10T20:34:29.823

我怎么看：

你想建立一个表格，将无序的字母集映射到列表单词，即通过字典，这样你就可以结束了，比如说

```
lettermap[set(a,e,d,f)] = { "deaf", "fade" } 
```

然后从你的起始词，你找到一组字母：

```
 astronomers => (a,e,m,n,o,o,r,r,s,s,t) 
```

然后遍历该组的所有分区（这可能是最技术性的部分，只是生成所有可能的分区），并查找该组字母的单词。

编辑：嗯，这几乎就是 Jason Cohen 发布的内容。

编辑：此外，对问题的评论提到生成“好”字谜，如示例:)。在你建立所有可能的字谜列表后，通过 WordNet 运行它们并找到语义上接近原始短语的那些:)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-10-11T10:46:09.527

如果我将字典作为哈希映射，因为每个单词都是唯一的，并且 Key 是该单词的二进制（或十六进制）表示。然后，如果我有一个单词，我可以很容易地以 O(1) 复杂度找到它的含义。

现在，如果我们必须生成所有有效的字谜，我们需要验证生成的字谜是否在字典中，如果它存在于字典中，则它是有效的，否则我们需要忽略它。

我假设一个单词最多 100 个字符（或更多，但有限制）。

所以我们把它当作一个索引序列的任何单词，比如单词“hello”，都可以表示为“1234”。现在“1234”的字谜是“1243”，“1242”..etc

我们唯一需要做的就是为特定数量的字符存储所有此类索引组合。这是一项一次性任务。然后可以通过从索引中选择字符来从组合中生成单词。因此我们得到了字谜。

要验证字谜是否有效，只需索引字典并验证即可。

唯一需要处理的是重复项。这很容易完成。当我们需要与以前在字典中搜索过的进行比较时。

该解决方案强调性能。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2008-12-27T23:42:58.197

前段时间我写了一篇关于如何快速找到两个单词字谜的博客文章。它的工作速度非常快：在 Ruby 程序中，为一个文本文件超过 300,000 个单词（4 兆字节）的单词查找所有 44 个双单词字谜只需要 0.6 秒。

[两个单词 Anagram Finder 算法（在 Ruby 中）](http://martin.ankerl.com/2008/08/09/two-word-anagram-finder-algorithm/)

当允许将单词列表预处理为从按字母排序的单词到使用这些字母的单词列表的大型哈希映射时，可以使应用程序更快。从那时起，可以序列化和使用这些预处理数据。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-10T20:26:22.713

在我的脑海中，最有意义的解决方案是从输入字符串中随机挑选一个字母，并根据以该字母开头的单词过滤字典。然后选择另一个，过滤第二个字母等。此外，过滤掉剩下的文本不能组成的单词。然后当你碰到一个单词的结尾时，插入一个空格并用剩余的字母重新开始。您还可以根据单词类型限制单词（例如，您不会有两个相邻的动词，您不会有两个相邻的文章，等等）。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2008-09-10T21:12:10.293

1.  正如 Jason 建议的那样，准备一个字典来制作哈希表，其中关键字按字母顺序排序，并且值单词本身（每个键可能有多个值）。
2.  在查找之前删除空格并对查询进行排序。

在此之后，您需要进行某种递归、详尽的搜索。伪代码很粗略：

```
function FindWords(solutionList, wordsSoFar, sortedQuery)
  // base case
  if sortedQuery is empty
     solutionList.Add(wordsSoFar)
     return

  // recursive case

  // InitialStrings("abc") is {"a","ab","abc"}
  foreach initialStr in InitalStrings(sortedQuery)
    // Remaining letters after initialStr
    sortedQueryRec := sortedQuery.Substring(initialStr.Length)
    words := words matching initialStr in the dictionary
    // Note that sometimes words list will be empty
    foreach word in words
      // Append should return a new list, not change wordSoFar
      wordsSoFarRec := Append(wordSoFar, word) 
      FindWords(solutionList, wordSoFarRec, sortedQueryRec) 
```

最后，您需要遍历解决方案列表，并打印每个子列表中的单词，它们之间有空格。对于这些情况，您可能需要打印所有订单（例如“我是 Sam”和“Sam I am”都是解决方案）。

当然，我没有对此进行测试，这是一种蛮力方法。

# php - 唯一密钥生成

> ID：55218
> 
> 赞同：12
> 
> 时间：2008-09-10T20:17:03.000
> 
> 标签：php, web-services, security, passwords

我正在寻找一种方法，特别是在 PHP 中，我将保证始终获得唯一的密钥。

我做了以下事情：

```
strtolower(substr(crypt(time()), 0, 7)); 
```

但是我发现有时我会得到一个重复的键（很少，但经常）。

我也想过这样做：

```
strtolower(substr(crypt(uniqid(rand(), true)), 0, 7)); 
```

但是根据 PHP 网站，uniqid() 可以，如果 uniqid() 在同一微秒内被调用两次，它可以生成相同的密钥。我认为添加 rand() 它很少会，但仍然可能。

在上面提到的行之后，我还删除了 L 和 O 等字符，这样用户就不会感到困惑。这可能是重复的部分原因，但仍然是必要的。

我想到的一个选择是创建一个网站，该网站将生成密钥，将其存储在数据库中，确保它是完全唯一的。

还有其他想法吗？是否有任何网站已经这样做了，它们有某种 API 或者只是返回密钥。我找到了[http://userident.com](http://userident.com)但我不确定密钥是否完全唯一。

这需要在没有任何用户输入的情况下在后台运行。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-10T21:06:12.557

只有 3 种方法可以生成唯一值，它们是密码、用户 ID 等：

1.  使用有效的 GUID 生成器 - 这些生成器很长并且不能缩小。如果你只使用部分**你 FAIL**。
2.  至少部分数字是从单个序列中顺序生成的。您可以添加绒毛或编码以使其看起来不那么连续。优点是它们开始时间短 - 缺点是它们需要单一来源。解决单一来源限制的方法是对来源进行编号，因此您可以包含 [source #] + [seq #]，然后每个来源都可以生成自己的序列。
3.  通过其他方式生成它们，然后根据先前生成的值的单一历史记录检查它们。

不保证任何其他方法。请记住，从根本上说，您正在生成一个二进制数（它是一台计算机），但随后您可以将其编码为十六进制、十进制、Base64 或单词列表。选择适合您使用的编码。通常对于用户输入的数据，您需要一些 Base32 的变体（您暗示过）。

**关于 GUIDS 的注意事项**：它们从长度和用于生成它们的方法中获得了独特性的力量。 *任何小于 128 位的内容都是不安全的。* 除了随机数生成之外，GUID 还具有一些特性，使其更加独特。请记住，它们实际上只是唯一的，而不是完全唯一的。这是可能的，尽管实际上不可能有一个副本。

**更新了关于 GUID 的说明**：自从写这篇文章以来，我了解到许多 GUID 生成器使用加密安全的随机数生成器（很难或不可能预测下一个生成的数字，并且不太可能重复）。实际上有 5 种不同的[UUID 算法](http://en.wikipedia.org/wiki/Universally_Unique_Identifier#Definition)。算法 4 是 Microsoft 当前用于 Windows GUID 生成 API 的算法。[GUID](http://en.wikipedia.org/wiki/Globally_unique_identifier)是 Microsoft 对 UUID 标准的实现。

**更新**：如果你想要 7 到 16 个字符，那么你需要使用方法 2 或 3。

**底线**：坦率地说，没有完全独特的东西。即使你使用顺序生成器，你最终也会用完宇宙中所有的原子的存储空间，从而循环回到你自己并重复。你唯一的希望是在达到那个点之前宇宙的热寂。

即使是最好的随机数生成器也有可能重复等于您正在生成的随机数的总大小。以四分之一为例。它是一个完全随机的比特生成器，它的重复几率是 2 分之一。

所以这一切都归结为你的独特性门槛。通过使用序列，然后对其进行 base32 编码，您可以对 1,099,511,627,776 个数字具有 8 位数字的 100% 唯一性。任何其他不涉及检查过去数字列表的方法仅具有等于 n/1,099,511,627,776（其中 n = 生成的先前数字的数量）不唯一的几率。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-10T20:30:06.697

**任何算法都会导致重复**。

因此，我是否可以建议您使用现有算法* 并简单地检查重复项？

*轻微添加：如果`uniqid()`可以基于时间不唯一，还包括一个全局计数器，您在每次调用后递增。这样，即使在同一微秒内，情况也会有所不同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-10T20:20:48.950

如果不编写代码，我的逻辑是：

从您喜欢的任何可接受的字符生成随机字符串。
然后将一半的日期戳（部分秒和全部）添加到前面，另一半添加到末尾（或者如果您愿意，可以在中间的某个位置）。

保持快乐！
H

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-10T20:22:25.140

如果您使用原始方法，但在密码前添加用户名或电子邮件地址，则如果每个用户只能有 1 个密码，它将始终是唯一的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-10T20:22:29.993

您可能对处理相同问题的这篇文章感兴趣：[GUID 是全局唯一的，但 GUID 的子字符串不是](http://blogs.msdn.com/oldnewthing/archive/2008/06/27/8659071.aspx)。

> > 该算法的目标是使用时间和位置的组合（相对论极客的“时空坐标”）作为唯一性密钥。但是，计时并不完美，因此有可能，例如，从同一台机器快速连续生成两个 GUID，它们在时间上彼此如此接近以至于时间戳相同。这就是唯一性的用武之地。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-10T20:23:29.600

我通常这样做：

```
$this->password = '';

for($i=0; $i<10; $i++)
{
    if($i%2 == 0)
        $this->password .= chr(rand(65,90));
    if($i%3 == 0)
        $this->password .= chr(rand(97,122));
    if($i%4 == 0)
        $this->password .= chr(rand(48,57));
} 
```

我想有一些理论上的漏洞，但我从来没有遇到过重复问题。我通常将它用于临时密码（例如在密码重置后），它的效果很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-10T20:27:48.560

您可能对 Steve Gibson 在[https://www.grc.com/passwords.htm](https://www.grc.com/passwords.htm)上的密码生成器的顶级安全实现感兴趣（没有来源，但他对它的工作原理有详细的描述） 。

该网站创建了巨大的 64 个字符的密码，但由于它们是完全随机的，因此您可以轻松地使用前 8 个（或多个）字符来获得不太安全但“尽可能随机”的密码。

编辑：从您以后的回答中，我看到您需要的东西更像是 GUID 而不是密码，所以这可能不是您想要的...

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-10T20:31:19.393

正如 Frank Kreuger 评论的那样，使用 GUID 生成器。

喜欢[这个](http://www.phpclasses.org/browse/package/1738.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-10T20:51:35.227

我仍然不明白为什么密码必须是唯一的？如果您的 2 个用户具有相同的密码，有什么缺点？

这是假设我们谈论的是与用户 ID 相关联的密码，而不仅仅是唯一标识符。如果*这*就是您要寻找的东西，为什么不使用 GUID？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-11T21:11:09.757

我确实相信您的部分问题是您试图为我们提供一个用于两种不同用途的单一功能......密码和 transaction_id

这确实是两个不同的问题领域，最好不要尝试一起解决它们。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-09-15T11:58:50.377

我最近想要一个快速简单的随机唯一键，所以我做了以下事情：

```
$ukey = dechex(time()) . crypt( time() . md5(microtime() + mt_rand(0, 100000)) ); 
```

所以，基本上，我得到了以秒为单位的 unix 时间，并添加了一个从时间 + 随机数生成的随机 md5 字符串。这不是最好的，但对于低频请求来说已经相当不错了。它快速且有效。

我做了一个测试，我会生成数千个键，然后寻找重复，每秒大约 800 个键没有重复，所以还不错。我想这完全取决于 mt_rand()

我将它用于调查跟踪器，我们的提交率约为每分钟 1000 份调查......所以现在（交叉手指）没有重复。当然，速率不是恒定的（我们在一天中的某些时间收到提交）所以这不是失败证明也不是最好的解决方案......提示是使用增量值作为键的一部分（在我的情况下，我使用了 time()，但可能会更好）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-03-18T19:49:59.173

Ingoring 加密部分与创建唯一值没有太大关系，我通常使用这个：

```
function GetUniqueValue()
{
   static $counter = 0; //initalized only 1st time function is called
   return strtr(microtime(), array('.' => '', ' ' => '')) . $counter++;
} 
```

当在同一进程中调用时，$counter 会增加，因此值在同一进程中始终是唯一的。

当在不同的进程中调用时，您必须非常不幸地获得 2 个具有相同值的 microtime() 调用，认为 microtime() 调用通常在同一脚本中调用时也具有不同的值。

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2008-09-10T20:26:37.237

我通常做一个随机子字符串（随机化 8 到 32 之间的字符数，或者为了用户方便而更少）或者我得到的某个值的 MD5，或者时间，或者某种组合。为了获得更多随机性，我将值的 MD5 （比如姓氏）与时间连接起来，再次 MD5，然后取随机子字符串。是的，您*可以获得*相同的密码，但可能性不大。

# php - 如何为 PHP 站点实现 HTML 缓存？

> ID：55223
> 
> 赞同：12
> 
> 时间：2008-09-10T20:20:46.470
> 
> 标签：php, html, caching

为 PHP 站点实现缓存的最佳方法是什么？显然，有些东西不应该被缓存（例如搜索查询），但我想找到一个好的解决方案来确保我避免“挖掘效应”。

我知道 WordPress 有 WP-Cache，但我正在编写一个不是基于 WP 构建的自定义解决方案。我有兴趣编写自己的缓存（如果它足够简单的话），或者您可以向我指出一个不错的轻量级框架。虽然我不太了解 Apache，所以如果它是一个 PHP 框架，那么它会更合适。

谢谢。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-10T20:32:32.747

您可以使用[输出缓冲](http://uk3.php.net/manual/en/function.ob-get-contents.php)来选择性地保存部分输出（您想要缓存的部分）并在时间不够长时将它们显示给下一个用户。这样，您仍然可以即时呈现页面的其他部分（例如，可自定义的框、个人信息）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-10T20:26:23.853

最好的方法是使用代理缓存（Squid、Varnish）并提供适当的 Cache-Control/Expires 标头以及 ETag：请参阅[Mark Nottingham 的缓存教程](http://www.mnot.net/cache_docs/)以获取有关缓存如何工作以及如何充分利用的完整描述缓存代理的性能。

另请查看[memcached](http://www.danga.com/memcached/)，并尝试在其中缓存您的数据库查询（或者更好的是，预渲染页面片段）。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-15T14:34:35.870

如果代理缓存是不可能的，并且您正在提供完整的 HTML 文件，那么您将通过完全绕过 PHP 获得最佳性能。研究[WP Super Cache](http://ocaoimh.ie/wp-super-cache/)的工作原理。

未缓存的页面被复制到与您的站点具有相似 URL 结构的缓存文件夹中。在以后的请求中，mod_rewrite 会记录缓存文件的存在并提供它。其他 RewriteCond 指令用于确保评论者/登录用户看到实时 PHP 请求，但大多数访问者将直接由 Apache 提供服务。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-12T05:31:45.250

我会推荐[Memcached](http://www.danga.com/memcached/)或[APC](http://us3.php.net/apc)。两者都是内存缓存解决方案，具有非常简单的 API 和大量库。

这 2 个问题是您需要将它们安装在您的 Web 服务器或另一台服务器上（如果它是 Memcached）。

## 装甲运兵车

优点：

*   简单的
*   快速地
*   也加快了 PHP 的执行速度

缺点

*   不适用于分布式系统，每台机器都在本地存储其缓存

## 内存缓存

优点：

*   快速（ish）
*   可以安装在单独的服务器上供所有 Web 服务器使用
*   高度测试，在 LiveJournal 开发
*   被所有大人物（Facebook、雅虎、Mozilla）使用

    缺点：
*   比 APC 慢

*   可能的网络延迟
*   配置略多

我不建议自己写，那里有很多。如果您无法在您的网络服务器上安装软件，您可以使用基于磁盘的缓存，但可能存在竞争问题需要处理。一个请求可能正在写入文件，而另一个请求正在读取。

您实际上可以缓存搜索查询，甚至几秒钟到一分钟。除非您的数据库每秒更新超过几次，否则有些延迟是可以的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-10T23:34:15.537

PHP Smarty 模板引擎 ( [http://www.smarty.net](http://www.smarty.net) ) 包括一个相当先进的缓存系统。

您可以在 Smarty 手册的缓存部分找到详细信息：[http ://www.smarty.net/manual/en/caching.php](http://www.smarty.net/manual/en/caching.php)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-10T21:35:03.530

您似乎正在寻找 PHP 缓存框架。我向您推荐模板系统 TinyButStrong，它带有一个非常好的 CacheSystem 插件。它简单、轻便、可定制（你可以缓存你想要的 html 文件的任何部分），非常强大 ^^

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-13T00:24:59.033

页面或部分页面的简单缓存 - Pear::CacheLite 类。我还将 APC 和 memcache 用于不同的事情，但到目前为止我看到的其他答案更多的是用于更完整和更复杂的系统。如果您只需要节省一些精力来重建页面的一部分 - 带有文件支持存储的 Cache_lite 就完全足够了，而且实现起来非常简单。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-13T01:25:51.400

[Project Gazelle](https://whatcd.github.io/Gazelle/)（一个开源 torrent 网站）提供了在网站上设置 Memcached 的分步指南，您可以轻松地在您可能想要设置的任何其他网站上使用它来处理大量流量。

获取源代码并阅读文档。

# windows - Windows 和连续扇区上的文件

> ID：55256
> 
> 赞同：4
> 
> 时间：2008-09-10T20:34:45.283
> 
> 标签：windows, filesystems

有没有办法保证 Windows 上的文件（使用 NTFS 文件系统）将使用硬盘上的连续扇区？换句话说，文件的第一个块将存储在某个扇区中，文件的第二个块将存储在下一个扇区中，依此类推。

我应该补充一点，我希望能够以编程方式创建这个文件，所以我宁愿不只是要求用户在创建这个文件后对他们的硬盘进行碎片整理。如果有办法以编程方式仅对我创建的文件进行碎片整理，那也可以。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-10T20:45:32.853

我将从这里开始：

[http://technet.microsoft.com/en-us/sysinternals/bb897428.aspx](http://technet.microsoft.com/en-us/sysinternals/bb897428.aspx)

并遵循 Mark 的碎片整理文档：

[http://technet.microsoft.com/en-us/sysinternals/bb897427.aspx](http://technet.microsoft.com/en-us/sysinternals/bb897427.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-10T20:48:04.407

我知道没有这样的保证。

但也要记住，NTFS“文件”由多个数据流组成。因此，您实际上正在寻找一种方法来保证**流**是连续的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-10T20:40:47.077

我相信没有办法做到这一点。您只能在写入文件后对其进行碎片整理。

# c# - 刷新页面上的所有更新面板？

> ID：55270
> 
> 赞同：4
> 
> 时间：2008-09-10T20:39:20.827
> 
> 标签：c#, asp.net, asp.net-ajax

我有一些代码可以修改其他更新面板中的几个控件绑定到的值。当此事件处理程序触发时，我希望它强制其他更新面板也刷新，以便它们可以重新绑定。

这可能吗？

编辑：

澄清一下，我在一个用户控件中有一个更新面板，其他更新面板在其他用户控件中，所以除非我要公开一些自定义属性并使用 findControl 等，否则它们无法看到对方...

再次编辑：

这是我想出的：

```
public void Update()
{
    recursiveUpdate(this); 
}

private void recursiveUpdate(Control control)
{
    foreach (Control c in control.Controls)
    {
        if (c is UpdatePanel)
        {
            ((UpdatePanel)c).Update();
        }

        if (c.HasControls())
        {
            recursiveUpdate(c);
        }
    }
} 
```

我有 3 个充满更新面板的主要用户控件，这些控件在主页上是可见的，所以我在那里添加了一个 Update 方法，在这三个上调用 Update。

在我的触发控件中，我只是将 this.Page 转换为 currentpage 并调用 Update。

编辑：

啊啊啊啊！

更新面板刷新时，它不会在其中的子控件中调用 Page_Load ...我现在该怎么办！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-10T20:52:30.530

注册一个 PostBackTrigger（而不是 AsyncPostBackTrigger）会在特定事件触发时刷新每个面板怎么样。

或者将已经刷新某些 UpdatePanel 的触发器也添加到其他 UpdatePanel。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-10T20:52:11.950

您可以在要更新的更新面板中设置触发器，也可以在后面的代码中明确地说 updatepanel.update()。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-10T20:54:54.267

如果您想从[客户端 Javascript](http://encosia.com/2007/07/13/easily-refresh-an-updatepanel-using-javascript/)刷新 updatepanel，这是一个很好的技术。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-10T22:36:54.053

Page.DataBind() 在所有子控件上启动一轮数据绑定。这将导致 Asp.Net 重新评估每个控件上的绑定表达式。如果这还不够，您可以添加任何您想要确保启动到用户控件中的 OnDataBinding 或 OnDataBound 覆盖的逻辑。例如，如果您需要重新执行 Page_Load 事件，您可以简单地在重写的 OnDataBound 方法中调用它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-05-16T14:46:33.487

将两个视图面板实例化为第三个演示者类，然后让演示者类控制两个视图。例如：

例如，您可以忽略您需要“中产阶级”来完成其工作的内容，例如，您可以拥有；

```
PresenterClass.AttachInterface(mIOrder);
PresenterClass.DoSomeCalulation();
PresenterClass.drawPanel(1);
PresenterClass.AttachInterface(mIOtherOrder);
PresenterClass.DoSomeCalulation();
PresenterClass.drawPanel(2); 
```

每个视图都有自己的控件。有很多不同的方法可以做到这一点.. 或者，您可以使用中间类来实例化两个面板，然后在每个面板中，您可以使用“获取方法”来检索数据进行处理。

# sql-server - VistaDB有什么优势

> ID：55273
> 
> 赞同：12
> 
> 时间：2008-09-10T20:40:27.687
> 
> 标签：sql-server, database, sqlite, firebird, vistadb

多年来，我已经看到了对 VistaDB 的引用以及 SQLite、Firebird、MS SQL 等工具。人。我从来没有理由考虑它。

与使用其他技术相比，为 VistaDB 付费有什么好处？我想到的事情：
1.紧凑的框架支持。SQLite+MSSQL 支持 CF。
2\. 需要迁移路径到“更强大”的系统。火鸟+MSSQL。
3\. 需要更高级的功能，例如触发器。火鸟+MSSQL

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-21T15:24:12.323

VistaDB 客户端运行时是免费的。正如您所说，运行时永远不会“在凌晨 3 点过期”。只有开发人员工具以这种方式获得许可。每个开发人员需要 1 个许可证，很简单。我们甚至提供了一个非常便宜的 Lite 版本，没有 Visual Studio 工具。

**其他一些好处**

**100% 托管代码**- 引擎中没有互操作或其他非托管调用。这对一些人来说是一件大事，而另一些人则不在乎。

**不需要注册表访问**- 大多数其他 proc 数据库需要注册表访问才能查找父控件或权限。VistaDB 只做你告诉它做的事情，甚至会在中等信任下运行。

**运行时和数据库（单个文件）的XCopy 部署**。您可以 xcopy 应用程序、运行时和数据库并运行。无需在机器上安装或配置，无需特殊权限（我们可以在中等信任或更高级别运行）。

**隔离存储**- 您可以将整个数据库放入隔离存储并直接从那里运行。这使得为​​企业环境构建以域友好方式编​​写数据库的安全单击一次应用程序变得非常容易。无需将用户数据存储在共享驱动器上，也无需担心权限映射。

**CLR 触发器/CLR 过程**- 您可以编写 CLR 代码并将它们用作触发器或存储过程。我们最近刚刚引入了一些更改，使维护可以在 VistaDB 和 SQL Server 2005/2008 中运行的单个 CLR 程序集变得更加容易。

**T-SQL** Procs - VistaDB T-SQL Procs 与 SQL Server 2005/2008 兼容。在我们的引擎中运行的任何过程都将在 SQL Server 中运行。这并不意味着在那里运行的任何东西都会移植到我们。我们是 SQL Server 中功能的一个子集。但我们也是在没有 SQL Server 的情况下运行 T-SQL Procs 的唯一方法（SQL CE 做不到）。

我个人认为最大的特点之一是以后升级到 SQL Server 的能力。所有 VistaDB 类型、语法和 CLR Procs、T-SQL procs 等都将在 SQL Server 上运行。（你不能把所有东西都从 SQL Server 带到 VistaDB，它只是一个子集）

**32/64 位部署**- VistaDB 是单一程序集部署，无需更改即可运行 32 位和 64 位。SQL CE 根据操作系统需要两种不同的运行时，根本无法在 IIS 下运行。 ~~Access 没有 64 位运行时，最新的 32 位运行时只能通过 MSI 部署。32 位版本的 Windows 有运行时，64 位版本没有。~~

**Relational Integrity** - VistaDB 实际上还强制执行您的约束和外键。您可以进行特定的级联更新和删除操作。评论我们就像 SQLITE 的人在这方面是错误的。它们解析约束，但不强制执行它们。

编辑：他们现在在 SQLite 中确实支持 FK。但默认情况下它们不会被编译，并且不使用与 SQL Server 相同的语法。

**中等信任** - 在中等信任的 Web 服务器上运行的能力是许多人不会关心的另一个功能，但它很重要。许多第三方控件甚至无法在 Medium Trust 中运行。由于我们承诺 100% 托管代码和所需的最少权限，我们可以在 Medium Trust 内运行完整的引擎。

**- 完全披露 -**我是 VistaDB 的所有者，所以我可能有偏见。:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-10T21:42:58.147

好吧，主要的是它是纯托管代码 - 物有所值；它不仅适用于运行 .NET 的典型 Windows 机器，而且适用于运行 Compact Framework 甚至适用于[**Mono**](http://www.mono-project.com/)的任何地方。以下是他们主页上一些值得注意的要点：

*   真正嵌入 ZeroClick 的小 < 1 MB 占用空间
*   Microsoft SQL Server 2005 兼容的数据类型和 T-SQL 语法
*   没有 SQL CE 限制
*   单用户、多用户本地或使用共享网络。
*   部分受信任的共享主机没有问题。
*   免版税分发 - SQL Server 的单 CPU 部署成本超过 VistaDB 的站点许可！

值得注意的一点是，Rob Howard 的公司[**Telligent**](http://telligent.com/)将其用作新 CMS 软件“ [**Graffiti**](http://graffiticms.com/) ”的默认数据库。

我在这里和那里玩过它，但还没有建立任何反对它的东西。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-25T18:25:56.890

对我来说，VistaDB 最有趣的特性是它可以在中等信任环境中运行。这使其成为创建中小型 .NET 网站的完美解决方案，这些网站可以通过复制和粘贴（x-copy 部署）部署在服务器上。

而且几乎所有 Windows 共享主机提供商（如 GoDaddy）都不允许您在完全信任模式下运行您的网站。如果您希望使用 SQLite，也不会为您将任何第三方二进制文件安装到 GAC 中，例如 System.Data.SQLite.dll。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-10T22:04:36.550

我以前没见过 VistaDB，它看起来确实很酷。

**更新：**收到来自 VistaDB 某人的评论 - 他们的更新模型仅用于获取新版本。如果您的许可证过期，您的旧设备不会停止工作，这很高兴知道。

将原始帖子保留为恕我直言，关于软件许可证到期的警告仍然值得考虑，即使 VistaDB 本身很好。

* * *

它绝对看起来比 SQLite '更有特色'，但我看不出有什么可以证明成本的合理性。该网站似乎表明您可以以 279 美元的价格购买一个许可证，但这意味着这只是 1 年的订阅。明年您是否必须再支付 279 美元才能阻止您的网站崩溃？

如果是这样，请记住将“成本”考虑在内，因为他们的 VistaDB 许可证已过期，当您在凌晨 3 点（墨菲定律，总是凌晨 3 点）接到您惊慌失措的客户的电话时会带来多少不便:-(

我亲身体验过一些即将到期的软件，但从来都不是很好。您可以向您的客户发送电子邮件和消息，并让他们的整个屏幕闪烁红色，说“您需要在下周之前获得新的许可证”，他们仍然永远不会这样做，而且您仍然会在凌晨 3 点感到痛苦。到期。

# php - 杀死在 FastCGI / IIS 上运行的特定 PHP 脚本？

> ID：55279
> 
> 赞同：2
> 
> 时间：2008-09-10T20:41:48.620
> 
> 标签：php, iis, fastcgi

我是一名 PHP 开发人员，但老实说，我的服务器管理知识有些欠缺。

我今天启动了一个脚本，该脚本花了很长时间才运行，而且因为它嵌入了对 的调用`ignore_user_abort()`，所以在浏览器中按“停止”显然是徒劳的。

在 FastCGI 设置中强制执行 15 分钟的时间限制，但这仍然很长，因为我真的不得不等待它结束才能继续其他任何事情。

有什么方法可以在任何给定时刻管理/杀死 FastCGI 正在执行的任何 PHP 脚本吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-10T21:30:41.933

php进程是否出现在taskmanager中？
我想知道如果你在那里杀死它会发生什么。IIS 会启动另一个来处理下一个请求吗？

# security - 在 ASP Classic 中究竟如何配置 httpOnly Cookie？

> ID：55296
> 
> 赞同：13
> 
> 时间：2008-09-10T20:49:52.470
> 
> 标签：security, asp-classic, httponly

我希望在我的旧版 ASP 经典站点中实现 httpOnly。有谁知道该怎么做？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2013-02-11T18:39:13.517

如果您在 IIS 7/7.5 上运行经典 ASP 网页，则可以使用 IIS URL 重写模块编写规则以使您的 cookie 仅 HTTP。

将以下内容粘贴到 web.config 的部分：

```
<rewrite>
    <outboundRules>
        <rule name="Add HttpOnly" preCondition="No HttpOnly">
            <match serverVariable="RESPONSE_Set_Cookie" pattern=".*" negate="false" />
            <action type="Rewrite" value="{R:0}; HttpOnly" />
            <conditions>
            </conditions>
        </rule>
        <preConditions>
            <preCondition name="No HttpOnly">
                <add input="{RESPONSE_Set_Cookie}" pattern="." />
                <add input="{RESPONSE_Set_Cookie}" pattern="; HttpOnly" negate="true" />
            </preCondition>
        </preConditions>
    </outboundRules>
</rewrite> 
```

详情见这里：[http ://forums.iis.net/t/1168473.aspx/1/10](http://forums.iis.net/t/1168473.aspx/1/10)

作为背景，出于 PCI 合规性的原因，需要 HTTPOnly cookie。PCI 标准人员（为了信用卡安全）让您的 sessionID cookie 至少有 HTTPOnly，以帮助防止 XSS 攻击。

此外，目前（2013 年 2 月 11 日），所有主流浏览器都支持对 cookie 的 HTTPOnly 限制。这包括当前版本的 IE、Firefox、Chrome 和 Safari。

有关各种浏览器版本如何工作和支持的更多信息，请参见此处： [https ://www.owasp.org/index.php/HTTPOnly](https://www.owasp.org/index.php/HTTPOnly)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-10T21:49:08.193

```
Response.AddHeader "Set-Cookie", "mycookie=yo; HttpOnly" 
```

其他选项如`expires`,`path`和`secure`也可以通过这种方式添加。我不知道有什么神奇的方法可以改变你的整个饼干收藏，但我可能错了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-10T21:03:18.863

您需要将“;HttpOnly”附加到响应 cookie 集合中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-07-28T15:21:21.367

```
Response.AddHeader "Set-Cookie", ""&CStr(Request.ServerVariables("HTTP_COOKIE"))&";path=/;HttpOnly"&"" 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-07-06T07:14:47.527

如果您使用 IIS7 或 IIS7.5 并安装 URL 重写加载项，则可以执行此操作。您可以创建一个重写规则，将“HttpOnly”添加到任何输出的“Set-Cookie”标头中。将以下内容粘贴到 web.config 的 <system.webServer> 部分。然后我使用 Fiddler 来证明输出。

问候，杰里米

```
 <rewrite>
        <outboundRules>
            <rule name="Add HttpOnly" preCondition="No HttpOnly">
                <match serverVariable="RESPONSE_Set_Cookie" pattern=".*" negate="false" />
                <action type="Rewrite" value="{R:0}; HttpOnly" />
                <conditions>
                </conditions>
            </rule>
            <preConditions>
                <preCondition name="No HttpOnly">
                    <add input="{RESPONSE_Set_Cookie}" pattern="." />
                    <add input="{RESPONSE_Set_Cookie}" pattern="; HttpOnly" negate="true" />
                </preCondition>
            </preConditions>
        </outboundRules>
    </rewrite> 
```

* * *

## 回答 #6

> 赞同：-4
> 
> 时间：2008-09-11T19:37:24.117

HttpOnly 对提高 Web 应用程序的安全性几乎没有什么作用。一方面，它只适用于 IE（Firefox“支持”它，但在某些情况下仍会向 Javascript 公开 cookie）。另一方面，它只能防止对您的应用程序的“偷渡式”攻击；它无法阻止跨站点脚本攻击重置密码、更改电子邮件地址或下订单。

你应该使用它吗？当然。它不会伤害你。但是在你开始搞乱 HttpOnly 之前，你应该确定你正在做的 10 件事。

# asp.net - 使用 Web 服务的 asp，如何处理记录集对象？

> ID：55297
> 
> 赞同：1
> 
> 时间：2008-09-10T20:50:32.093
> 
> 标签：asp.net, web-services, asp-classic

目前，我运行一个经典（旧）ASP 网页，其中记录集对象直接用于糟糕的旧 spagethi 代码风格。

我正在考虑在 asp.net 中实现一个数据层作为 web 服务以提高可管理性。这也是将网站升级到 asp.net 的第一步。该网站本身仍然是 ASP 的时刻......

任何人都可以推荐一种用 Web 服务兼容类型（如数组或其他东西）替换记录集对象类型的好方法吗？我在下面用什么替换？：

```
set objRS = oConn.execute(SQL)
while not objRS.eof
   ...
   name = Cstr(objRS(1))
   ...
wend 
```

并且还可以替换多个记录集？我在说话 ：

```
 set objRS = objRs.nextRecordset 
```

有人经历过这个并可以推荐吗？

***@AdditionalInfo - 你要求的:-)***

让我从头开始。 **现有情况是**：我有一个旧的 ASP 网站，其经典的分层内容（标题、部分、小节、内容）通过存储过程从数据库中提取出来，并且内容页面也在数据库中（指向 html 文件的链接）。

现在糟糕的是，ASP 代码遍布在许多 .asp 文件中，所有这些文件都进行自己的数据库连接、读取、写入（您必须注册内容）。最近我们遇到了 SQL 注入攻击的问题，所以我被要求修复它。

我*可以*去更改所有的 .asp 页面以防止 sql 注入，但这太疯狂了。所以我想建立一个数据层——所有页面都使用这个层来访问数据库。曾经修复和更新数据库访问代码的地方。

做出这个决定，我认为 asp.net 升级还很遥远，为什么不开始使用 asp.net 作为数据层呢？这样在升级站点时可以重复使用它。

这让我想到了上面的问题！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-10T21:26:16.517

首先，我本周最喜欢的建议是：如果您的 Web 服务是本地对象，请不要将其视为本地对象，否则您将付出非常高昂的性能代价。本质上，不要在你的 web 应用程序中做这样的事情：

```
MyDataWebService ws = new MyDataWebService();
foreach(DataItem item in myData)
{
    ws.Insert(item);
} 
```

您应该始终希望尽量减少对 Web 服务（和 SQL）的调用：

```
MyDataWebService ws = new MyDataWebService();
ws.Insert(myData); // Let the web service process the whole set at once. 
```

现在，就用于 Web 服务调用的数据类型而言，您基本上有两种选择：

*   数据集
*   其他一切（数组）

从 Web 服务返回的大多数集合（如 List<MyData>）实际上在 Web 服务调用期间转换为数组。请记住，Web 服务不返回对象（数据 + 行为），而只是返回数据结构（或一系列）。因此，列表和数组之间几乎没有区别。

DataSet 是更复杂的类；他们使用自己的自定义序列化程序，并且几乎可以在调用应用程序中完全重新创建。使用这样的 DataSet 需要付出性能成本，因此我通常不建议在大多数情况下使用它。使用数组来回传递数据往往更有效，坦率地说，它更容易做到。

你的情况有点不同；因为您正在转换已经使用 ADO 的现有站点，所以 ADO.NET 数据集可能是您最好的升级路径。ADO.NET 和 ADO 非常相似，因此直接更新可能会更容易。这取决于您的网站是如何构建的。

对于您问题的最后一部分，DataSet 确实支持类似于 ADO 的 Recordset 的多个记录集。它们被称为数据表。每个 DataSet 至少有一个 DataTable，您可以按任意顺序读取它们。

祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-10T21:40:51.770

我建议在您的 ASP 代码中使用 XmlHttp 类。

假设您在 MyService.asmx 中有一个与此类似的 ASMX Web 服务：

```
[WebMethod]
public string HelloWorld()
{
  return "Hello World";
} 
```

你可以在 ASP 中这样称呼它：

```
Dim xhr

Set xhr = server.CreateObject("MSXML2.XMLHTTP")

xhr.Open "POST", "/MyService.asmx/HelloWorld", false
xhr.SetRequestHeader "content-type", "application/x-www-form-urlencoded"
xhr.Send

Response.Write(xhr.ResponseText) 
```

ResponseText 将是以下 XML 响应：

```
<string>Hello World</string> 
```

假设您的服务返回了一组数据，您可以使用 XPath 或任何其他 XML 处理技术/库对其进行迭代。

谷歌搜索有关 MSXML2 可能会回答您的任何特定问题，因为它特定于 ASP 经典。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T00:59:45.287

与其分层思考，不如尝试通过应用程序进行垂直切片并将其转换为 .net。这样，您将获得在 .net 中编码的整个功能，而不是不相交的部分。在不改善用户体验或添加功能的情况下替换完美运行的代码有什么商业价值？

您还可以考虑使用 Web 服务而不是直接 ado 调用来权衡性能。Web 服务是解决多个不相交的应用程序/团队访问公共模式问题的一个很好的解决方案；它们不会使单个孤立的应用程序更易于维护，只会更慢和更复杂。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T18:56:44.110

如果您想坚持使用经典 ASP，那么我建议您通过 ASP 类创建一个数据库处理对象，然后只需使用该对象来创建记录集。这将集中您的数据库处理代码并使您只需在一个位置处理 SQL 注入攻击。

一个简单的例子。

```
Class clsDatabase

    Private Sub Class_Initialize()
        If Session("Debug") Then Response.Write "Database Initialized<br />"
    End Sub

    Private Sub Class_Terminate()
        If Session("Debug") Then Response.Write "Database Terminated<br />"
    End Sub

    Public Function Run(SQL)
        Set RS = CreateObject("ADODB.Recordset")
        RS.CursorLocation = adUseClient
        RS.Open SQLValidate(SQL), Application("Data"), adOpenKeyset, adLockReadOnly, adCmdText
        Set Run = RS
        Set RS = nothing
    End Function

    Public Function SQLValidate(SQL)
        SQLValidate = SQL
        SQLValidate = Replace(SQLValidate, "--", "", 1, -1, 1)
        SQLValidate = Replace(SQLValidate, ";", "", 1, -1, 1)
        SQLValidate = Replace(SQLValidate, "SP_", "", 1, -1, 1)
        SQLValidate = Replace(SQLValidate, "@@", "", 1, -1, 1)
        SQLValidate = Replace(SQLValidate, " DECLARE", "", 1, -1, 1)
        SQLValidate = Replace(SQLValidate, "EXEC", "", 1, -1, 1)
        SQLValidate = Replace(SQLValidate, " DROP", "", 1, -1, 1)
        SQLValidate = Replace(SQLValidate, " CREATE", "", 1, -1, 1)
        SQLValidate = Replace(SQLValidate, " GRANT", "", 1, -1, 1)
        SQLValidate = Replace(SQLValidate, " XP_", "", 1, -1, 1)
        SQLValidate = Replace(SQLValidate, "CHAR(124)", "", 1, -1, 1)
    End Function
End Class 
```

然后要使用它，您可以将调用更改为：

```
Set oData = new clsDatabase
Set Recordset = oData.Run("SELECT field FROM table WHERE something = another")
Set oData = nothing 
```

当然，您可以扩展基本类来处理参数化存储过程或其他什么以及更多验证等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-17T04:07:27.250

另一种选择是使用 COM Interop 在 .NET 中创建可从经典 ASP 调用的程序集。

从 Visual Studio 创建 COM 互操作程序集（例如 Microsoft Visual C# 2005 Express Edition）：

*   创建一个新的类库项目
*   打开项目属性

    *   在 Application 下选择 Assembly Information... 并启用“Make assembly COM-Visible”
    *   在签名下启用签名程序集并创建或选择现有的强名称密钥文件
*   编写和构建库

    *   COM 互操作类必须具有默认构造函数，并且仅发布非静态类和方法
*   将 .dll 复制到所需的文件夹/机器

*   使用 RegAsm 为 COM 注册 .dll

例如（根据需要调整）：

```
"C:\Windows\Microsoft.NET\Framework\v2.0.50727\RegAsm.exe" "C:\path\to\assembly.dll" /tlb /codebase 
```

*   从 ASP 调用程序集

例如（根据需要调整）：

```
Dim obj, returnValue
Set obj = Server.CreateObject("MyProject.MyClass")
returnValue = obj.DoSomething(param1, param2) 
```

笔记：

*   程序集在更新时必须通过 RegAsm 重新注册

也可以看看：

*   [向 COM 公开 .NET Framework 组件 (MSDN)](http://msdn.microsoft.com/en-us/library/zsfww439(VS.71).aspx)
*   [CodeProject：从 ASP 页调用 .NET 组件](http://www.codeproject.com/KB/dotnet/dotnetcomponentandasp.aspx)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-21T06:14:05.077

应该使用参数化的 sql 查询来处理 Sql 注入。这不仅会消除安全风险，还会显着提高数据库性能，因为它能够重用执行计划，而不是每次都重新计算它。通过字符串替换来处理它的建议是愚蠢的。VB 在处理字符串方面很糟糕，那些“替换”语句在性能和内存方面将非常昂贵（而且，你实际上只需要处理 ' 字符）

将代码移至 .net 并不能让它变得更好。在你的页面中有 db 代码还不错；特别是如果您正在谈论一个只有几个开发人员的小型网站。数以千计的网站使用这种技术来处理数以亿计的交易。现在，未参数化的动态 sql 很糟糕，您应该努力消除它，但这不需要重写应用程序或 .net 即可。我总是很好奇为什么人们将 .net 视为对其应用程序的事实上的改进。COM 模型中存在的大多数不良代码和不良习惯只是在转换过程中向前传播。

您要么需要承诺创建一个真正内聚的、最小耦合的 OO 设计；要么 或者只是保持你的状态，因为它并不是那么糟糕。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-01-22T15:30:07.730

太糟糕了，我在 2008 年没有看到这个问题。对我来说，您的网站似乎正在使用 Justa 框架。简单的方法是修改 Justa 代码以将搜索和数据输入提交到 urlencode。我做到了，并且为我完美地工作。

其余代码足够安全，可以防止任何类型的 os SQL 注入或其他尝试进入数据库。

# ruby-on-rails - Ruby 的自动代码质量工具？

> ID：55313
> 
> 赞同：37
> 
> 时间：2008-09-10T21:00:07.390
> 
> 标签：ruby-on-rails, ruby, code-analysis

关于 Java，我真正怀念的一件事是工具支持。FindBugs、Checkstyle 和 PMD 实现了代码质量指标和自动错误检查的三位一体。

是否有任何东西可以检查简单的错误和/或 Ruby 代码的样式违规？如果我可以将它改编为 Rails 等框架，那么我可以加分，以便遵循 Rails 惯用语。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-11T02:41:16.743

我最近开始为 Ruby 寻找类似的东西。到目前为止我遇到的情况：

*   [斋九郎](http://saikuro.rubyforge.org/)
*   [鲁迪](http://www.martyandrews.net/blog/2008/09/first_official_release_of_rood.html)
*   [鞭打](http://ruby.sadi.st/Flog.html)

这些可能是开始的地方。不幸的是，我还没有使用这三个中的任何一个来提供一个好的意见。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-11T17:59:39.127

Saikuro 和 Flog 可以很好地了解代码复杂性的基本概念。您还可以使用像 rcov 这样的工具来查看您的测试覆盖率。
Rails 项目有一个插件，可以将所有这些指标组合到一个 rake 任务中。它被称为[metric_fu](http://metric-fu.rubyforge.org/)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2012-10-11T16:59:45.997

我最近发现和测试的项目：

*   [https://github.com/railsbp/rails_best_practices](https://github.com/railsbp/rails_best_practices)
    *   似乎有效，并给出了合理的警告
*   [https://github.com/simplabs/excellent](https://github.com/simplabs/excellent)
    *   有效，但有不少误报
*   [https://github.com/troessner/reek](https://github.com/troessner/reek)
    *   我不同意这个工具的大部分警告，但它有效
*   [http://www.cs.umd.edu/projects/PL/druby/](http://www.cs.umd.edu/projects/PL/druby/)
    *   这需要ocaml；没试过，不过好像还不错
*   [http://roodi.rubyforge.org/](http://roodi.rubyforge.org/)
    *   似乎不兼容 Ruby 1.9
*   [https://github.com/gdb/ruby-static-checker](https://github.com/gdb/ruby-static-checker)
    *   对我来说坏了，只捕获名称错误，所以单元测试应该涵盖这一点。
*   [https://github.com/michaeledgar/laser](https://github.com/michaeledgar/laser)
    *   不为我编译

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-04-17T15:02:46.940

您可能想尝试[RuboCop](https://github.com/bbatsov/rubocop)。它是一个基于[Ruby 样式指南](https://github.com/bbatsov/rubocop)的 Ruby 代码样式检查器。它维护得非常积极，它基于标准的 Ruby 工具（如`ripper`库）。它适用于 Ruby 1.9 和 2.0，并具有出色的 Emacs 集成。我希望你会发现它有用！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-10T21:25:39.153

[Dust](http://github.com/kevinclark/dust/tree/master)看起来可以帮助您找到未使用和无用的代码，这似乎有点适合您所追求的。

我不知道有任何其他此类工具。
这个问题在 ruby​​ 中比在 java 中更难解决——你会注意到所有这些 java 工具都标榜自己使用代码的“静态分析”。
ruby 代码的静态分析通常是不可能的，因为没有任何静态可以分析（方法通常在运行时创建等等）

无论如何，其中一些东西在 ruby​​ 中是不需要的，因为语言内置了它们。例如，您不需要编码标准来强制您的类都是，`NamedLikeThis`因为如果它们不是，代码将无法工作。

PS我*必须*添加标准免责声明，即这些工具通常有点像红鲱鱼。你可以花一整天的时间让你的代码遵循工具认为它应该是的样子，并最终得到比你开始时更多的错误。
恕我直言，最好的解决方案是流利地编写代码，以便您可以更轻松地阅读它。再多的静态分析都不会像人类阅读代码那样好，它清楚地说明了它的目的。能够做到这一点是 ruby​​ 比许多其他语言领先几光年的地方。我个人建议您将精力集中在学习如何更流利地写作，并就这些事情对您的团队进行教育，而不是花时间进行静态分析。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-09T14:03:46.927

另一个不错的工具，虽然根据作者的说法处于早期阶段是臭气：

[http://reek.rubyforge.org/](http://reek.rubyforge.org/)

reek 目前包括对以下代码异味的非常幼稚的检查：

*   长方法
*   大班
*   功能嫉妒
*   无法交流的名字
*   长参数列表
*   实用功能
*   嵌套迭代器
*   控制对
*   复制
*   项目清单

就我个人而言，我认为它仍然存在太多误报，但仅仅查看我的一些代码中的输出就帮助我重新思考了一些关于代码风格和架构的决定。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2013-03-20T04:45:15.097

[Code Climate](https://codeclimate.com/)是一个 SaaS 工具，它通过 git 集成并自动“评分”您的代码。如果质量突然下降，它会通过各种渠道通知您。漂亮的用户界面。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-11-26T18:00:52.977

当被问到这个问题时，我没有看到这个问题，但我做的一篇博客文章也可能会有所帮助。在其中，我介绍了一堆 Ruby 工具，特别介绍了 4 个代码质量工具......

1.  鲁迪
2.  灰尘
3.  鞭打
4.  斋九郎

也值得一试 Towelie and Flay

[http://devver.wordpress.com/2008/10/03/ruby-tools-roundup/](http://devver.wordpress.com/2008/10/03/ruby-tools-roundup/)

现在我们已经将很多工具组合成一个唯一的 Ruby 代码质量和指标监控工具，称为 Caliper。这可能很好地满足您的需求。它跟踪项目生命周期内的各种质量指标。

[Caliper - 改进你的 Ruby 代码](http://getcaliper.com)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-11-21T01:57:09.900

还有[优秀](https://github.com/simplabs/excellent)的。我还没有尝试过，但它看起来也很有希望。

# opengl - OpenGL和闪烁

> ID：55317
> 
> 赞同：1
> 
> 时间：2008-09-10T21:02:52.733
> 
> 标签：opengl

当 CallList 中的对象与近平面相交时，我会闪烁...，我该怎么办？

我使用 OpenGL 和 SDL。

是的，它是双缓冲的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-10T22:07:24.747

这听起来像你得到z-fighting。

“Z-fighting 是 3D 渲染中的一种现象，当两个或多个图元在 z 缓冲区中具有相似值时会发生这种现象，并且在共面多边形中尤其普遍。这种效果会导致伪随机像素以一个多边形的颜色进行渲染“ （来自[维基百科](http://en.wikipedia.org/wiki/Z-fighting)）

[您可以在OpenGL 常见问题解答](http://www.opengl.org/resources/faq/technical/depthbuffer.htm)中获得有关该问题的更多信息。

glPolygonOffset 可能会有所帮助，但您也可能会遇到麻烦。Tom Forsyth 在他的[常见问题解答](http://tomsdxfaq.blogspot.com/2002_07_01_archive.html#79344425#79344425)中有一个很好的解释：它谈到了 ZBIAS，但这只是 DirectX 的等价物。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-13T19:21:42.220

问题是我的旋转函数有一些浮点错误，这搞砸了我的 model_view 矩阵。

你们谁也猜不到，抱歉浪费了你们的时间。

虽然我不认为移动近平面甚至应该被视为解决任何类型问题的方法，但通常还有其他问题，因为openGL确实支持多边形与近平面相交。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-10T21:07:30.400

尝试将近剪裁平面放得更远一点：例如使用 gluPerspective -> 第三个参数**zNear** [http://www.opengl.org/documentation/specs/man_pages/hardcopy/GL/html/glu/perspective.html](http://www.opengl.org/documentation/specs/man_pages/hardcopy/GL/html/glu/perspective.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-10T21:08:56.403

啊，你的意思是*近*平面。:)

嗯......在同一平面上绘制多边形时的另一件事是使用[glPolygonOffset](http://www.cs.sfu.ca/~haoz/teaching/htmlman/polygonoffset.html)

从描述

```
 glPolygonOffset is useful for rendering hidden-line images,
  for applying decals to surfaces, and for rendering solids
  with highlighted edges. 
```

# windows-mobile - Windows Mobile 上的 JVM 选择

> ID：55322
> 
> 赞同：8
> 
> 时间：2008-09-10T21:05:06.677
> 
> 标签：windows-mobile, jvm

Windows Mobile 上可用的 JVM 实现有哪些？

[Esmertec JBed](http://www.esmertec.com/40.html)是我 WinMo 手机上的一个。

想知道这个区域中有多少其他 JVM 供应商。是否有可用的比较或基准数据？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-17T13:18:46.707

Windows CE 的一般 JVM 选择（包括 Pocket PC 和 Windows Mobile）：

*   肌酸酐
*   [迈赛府](http://www2s.biglobe.ne.jp/~dat/java/project/jvm/index_en.html)
*   [斯克尔米尔 CEEJ](http://www.skelmir.com/solutions/handheld.html)

如果您希望在 WinMo 和 Symbina 之间有一个共同的代码库，您还可以查看[Red Five Labs](http://www.redfivelabs.com/)。他们有一个 Symbian 运行时允许您运行 COMpact Framework 应用程序，因此您可以拥有一个适用于两者的 CF 代码库。我评估了 Red Five 产品的早期测试版，但从那以后就没有使用过，所以我无法证明它的质量或覆盖范围。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T05:03:51.830

原因是在 WinMo 和 Symbian 中有相同的代码库。

我个人的偏好是对两者都有本地解决方案。但这意味着开发和维护两组代码库。出于某种原因，管理层不喜欢这样;)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-15T15:00:16.183

有 2 个用于 WinMo 的 JVM，用于 J2SE 的 Mysaifu 和用于 J2ME 的 IBM WebSphere Everyplace Micro Environment。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-29T09:50:05.387

Prakash，因为您的目标是在 J2ME 和 WinMo 手机之间建立一个通用代码库，请查看 alcheMo。alcheMo 不是 JVM，而是完全自动化的 J2ME 到原生 Win32 WinMo 移植解决方案。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-11-15T16:47:15.693

即使在这个问题上运行得有点晚并且只是为了完整起见：[JBlend(micro)](http://www.aplixcorp.com/en/products/jb_micro/overview.html)是用于 Windows Mobile 6.1 和 6.5 的 Java 环境，例如在 HTC 设备上使用。它支持 CLDC 和 MIDP 1.0 和 2.0。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-06-15T07:48:44.460

[phoneME](http://davy.preuveneers.be/phoneme/)（[java.net 页面](http://java.net/projects/phoneme)）似乎是另一种选择。[LWUIT FAQ](http://download.oracle.com/javame/dev-tools/lwuit-1.4/LWUIT_Developer_Guide_HTML/bbjgjggh.html)推荐它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-10T21:19:21.667

这不是一个真正的答案，但是如果您正在为 WinMo 开发，将您的软件定位于 .NET 框架紧凑版不是更有意义吗？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-17T09:51:31.370

惠普还在他们的旧款掌上电脑上安装了一个名为 HP Chai 的 JVM

# asp.net - ASP.NET Web 应用程序生成输出 - 如何包含所有部署文件？

> ID：55323
> 
> 赞同：4
> 
> 时间：2008-09-10T21:06:06.050
> 
> 标签：asp.net, deployment, build-process, build-automation

当我构建我的[ASP.NET](http://en.wikipedia.org/wiki/ASP.NET) Web 应用程序时，我得到一个 .dll 文件，其中包含网站的代码（这很棒），但该网站还需要所有 .aspx 文件和朋友，并且这些需要放置在正确的目录结构。作为每次构建的结果，我怎样才能将这一切都放在一个目录中？试图从源目录中选择正确的文件是一件痛苦的事情。

最终结果应该是 xcopy 可部署的。

**更新：**我不想手动使用我知道的发布命令。我希望应用程序所需的全套文件成为构建输出 - 这意味着我还可以通过运行[MSBuild](http://en.wikipedia.org/wiki/MSBuild)在一个地方获得全套文件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T14:15:42.033

一种解决方案似乎是 Web 部署项目 (WDP)，它是 Visual Studio（和 msbuild）的附加组件，可将 Web 项目构建到目录中，并且可以选择合并程序集并更改 web.config 文件。构建 WDP 的输出是在一个目录中部署站点所需的所有文件。

有关 Web 部署项目的更多信息：

1.  关于WDP 2008[的 webdevtools MSDN 博客的公告](http://blogs.msdn.com/webdevtools/archive/2008/01/25/announcing-rtw-of-visual-studio-2008-web-deployment-projects-wdp.aspx)
2.  [ScottGu 介绍 WDP 2005](http://weblogs.asp.net/scottgu/archive/2005/11/06/429723.aspx)

此解决方案的唯一缺点是需要附加组件，该附加组件必须在构建机器上可用。不过，现在已经足够好了！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-10T21:08:33.627

ASP.NET 没有为*新*站点提供*真正的*xcopy 部署。这取决于在 IIS 中有一个虚拟目录/应用程序。但是，一旦创建了该虚拟目录，您就可以使用 xcopy 进行更新。

 ** * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-10T21:09:28.163

你可以[发布网站](http://msdn.microsoft.com/en-us/library/1y1404zt(VS.80).aspx)。如果你想自动化你的部署，你需要使用一些[脚本](http://www.codeproject.com/KB/install/DeploySite.aspx)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T00:09:28.117

您是否尝试过在 .net 框架目录中使用 aspnet_compiler.exe？我很确定您可以创建 Web 应用程序或网站的“部署就绪”版本。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-18T20:32:02.090

MSBuild 上的 _CopyWebApplication 目标将完全满足您的需求。问题是只有主程序集会被复制到 bin 文件夹，这就是为什么需要复制任务来复制 bin 文件夹上的任何其他文件的原因。

我试图将示例脚本作为这篇文章的一部分发布，但未能成功。

请查看我博客上的这篇[文章](http://callicode.com/Homeltpagegt/tabid/38/EntryId/27/How-to-only-publish-the-runtime-files-of-an-asp-net-application-using-CruiseControl-net.aspx)，该文章描述了如何创建类似于您需要的 MSBuild 脚本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-10T21:07:38.650

您是否尝试在解决方案资源管理器中右键单击该网站并单击“发布网站”？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-10T21:09:30.660

构建 --> 发布

将出现一个对话框，指导您完成整个过程。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-10T21:18:23.417

对于您在更新中描述的自动化构建，我建议您查看[MSBuild](http://msdn.microsoft.com/en-us/library/0k6kkbsd.aspx)和[CruiseControl.NET](http://confluence.public.thoughtworks.org/display/CCNET/Welcome+to+CruiseControl.NET)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-08-16T09:54:41.017

这取决于您需要多么复杂的解决方案，例如，您可以只使用脚本和 jenkins。您可以将 MSBUild 与 Jenkins 一起使用，仅用于部署到 IIS。如果你有 Jenkins，其他工具很容易在以后连接到它。但是，如果您只想构建，请使用 jenin 执行每个使用 MSDeploy 的构建的脚本，它会很好用。

我就是这样做的，只是给你一个感觉：

Sonarqube 使用 Gallio、Gendarme、FXcop、Stylecop、NDepths 和 PartCover 来获取您的指标，所有这些都非常简单，因为 SonarQube 无需太多配置即可自动执行此操作。

这是 Jenkins 女巫构建和获取声纳指标以及自动部署到 IIS 的另一项工作。我使用一个简单的脚本一行来调用我的 MSBuild 和 wich URL、pass 和 user。

![](https://i.stack.imgur.com/VbAmP.png)

还有 Sonarqube，我项目的所有指标。这是一个简单的 MVC4 应用程序，但效果很好！：

![](https://i.stack.imgur.com/0nKLI.png)

如果您想了解更多信息，我可以为您提供一个很好的指南。

整个设置使用 MSBuild，也构建和部署应用程序。

# asp.net - 如何在回发中保持 DragPanelExtender 的位置？

> ID：55330
> 
> 赞同：2
> 
> 时间：2008-09-10T21:08:52.313
> 
> 标签：asp.net, javascript, dom, asp.net-ajax

我已经找到了这篇文章：

[http://www.dotnetcurry.com/ShowArticle.aspx?ID=181&AspxAutoDetectCookieSupport=1](http://www.dotnetcurry.com/ShowArticle.aspx?ID=181&AspxAutoDetectCookieSupport=1)

但我有不同的情况。我在母版页中嵌入了一些 hiddenFields 并尝试将 dragPanel 的位置存储在其中。

我正在使用 javascript 来存储 dragPanel 的位置，然后当用户单击链接时，会加载新页面，但 dragPanel 会重置到起始位置。

**有什么简单的方法可以做到这一点？**

伪代码：

```
**this is in MasterPage.master**

function pageLoad()

{  

    // call the savePanelPosition when the panel is moved

    $find('DragP1').add_move(savePanelPosition);  

    var elem = $get("<%=HiddenField1.ClientID%>");   

    if(elem.value != "0")
    {

        var temp = new Array();

        temp = elem.value.split(';');

        // set the position of the panel manually with the retrieve value

        $find('<%=Panel1_DragPanelExtender.BehaviorID%>').set_location(new 

Sys.UI.Point(parseInt(temp[0]),parseInt(temp[1])));

    }

}      

function savePanelPosition()

{
    var elem = $find('DragP1').get_element();

    var loc = $common.getLocation(elem);

    var elem1 = $get("<%=HiddenField1.ClientID%>");

    // store the value in the hidden field

    elem1.value = loc.x + ';' + loc.y;

}        

<asp:Button ID="Button1" runat="server" Text="Button"/>

<asp:HiddenField ID="HiddenField1" runat="server" Value="0" 
```

但是，**HiddenField**在重定向页面 foo.aspx 中不可见

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-16T19:58:34.057

与其将位置信息存储在隐藏字段中，不如将其存储在 cookie 中。信息很小，因此对页面加载性能的影响很小。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-11-19T16:25:55.317

好的，所以我得到了拖动的东西，保存在数据库中，在我的一台显示器上显示很酷 1600X1050 一切都很好，很好，花花公子！可是等等！我在另一台 1366x768 显示器上打开了相同的页面，并且面板全部关闭。

保存功能以像素为单位保存，因此当您移至另一个“分辨率”时，面板会关闭。你知道吗？

PS我可以弹出一条消息，说明用户更改他们的显示器设置，大声笑...

# sql-server - 定制 SQL Server '编码' sproc - 有没有更简洁的方法？

> ID：55340
> 
> 赞同：1
> 
> 时间：2008-09-10T21:15:12.173
> 
> 标签：sql-server, tsql

我只是想知道在 SQL Server 2005 中是否有更好的方法来执行此操作。

实际上，我使用了一个 originator_id（0 到 99 之间的数字）和一个“next_element”（它实际上只是一个 1 到 999,999 之间的顺序计数器）。我们正在尝试从它们中创建一个 6 字符的“代码”。

originator_id 乘以一百万，然后加上计数器，得到一个介于 0 和 99,999,999 之间的数字。

然后我们将其转换为“base 32”字符串 - 一个假的 base 32，我们实际上只是使用 0-9 和 AZ，但为了清楚起见，删除了一些更令人困惑的字母数字（I、O、S、Z） .

为此，我们只需将数字除以 32 的幂，在每个阶段使用我们为每个幂得到的结果作为我们所选字符数组中字符的索引。

```
因此，61 的发起者 ID 和 9 的 NextCodeElement 给出的代码为“1T5JA9”

(61 * 1,000,000) + 9 = 61,000,009
61,000,009 格 (5^32 = 33,554,432) = 1 = '1'
27,445,577 格 (4^32 = 1,048,576) = 26 = 'T'
   182,601 格 (3^32 = 32,768) = 5 = '5'
    18,761 格 (2^32 = 1,024) = 18 = 'J'
       329 格 (1^32 = 32) = 10 = 'A'
         9 格 (0^32 = 1) = 9 = '9'

所以我的代码是 1T5JA9

```

以前我已经让这个算法工作（在 Delphi 中），但现在我真的需要能够在 SQL Server 2005 中重新创建它。显然我没有与 Delphi 中相同的功能，但这是我的采取例行公事。它可以工作，我可以很好地生成代码（或将代码重构回它们的组件）。

但它看起来有点啰嗦，而且我不确定将除法结果选择为 int 的技巧（即，真的是强制转换）是否一定是“正确的”——这种方法是否有更好的 SQLS 方法的东西？

```
CREATE 过程 dummy_RP_CREATE_CODE @NextCodeElement int, @OriginatorID int,
  @code varchar(6) 输出
作为
开始
  声明@raw_num int；
  声明@bcelems char(32);
  声明@chr int；

  选择@bcelems='0123456789ABCDEFGHJKLMNPQRTUVWXY';
  选择@code='';

  -- 添加originator_id，缩放到位
  选择@raw_num = (@OriginatorID * 1000000) + @NextCodeElement;

  -- 现在将其转换为 6 字符代码

  -- 5^32
  选择@chr = @raw_num / 33554432；
  选择@raw_num = @raw_num - (@chr * 33554432);
  选择@code = @code + SUBSTRING(@bcelems, 1 + @chr, 1);

  -- 4^32
  选择@chr = @raw_num / 1048576；
  选择@raw_num = @raw_num - (@chr * 1048576);
  选择@code = @code + SUBSTRING(@bcelems, 1 + @chr, 1);

  -- 3^32
  选择@chr = @raw_num / 32768；
  选择@raw_num = @raw_num - (@chr * 32768);
  选择@code = @code + SUBSTRING(@bcelems, 1 + @chr, 1);

  -- 2^32
  选择@chr = @raw_num / 1024；
  选择@raw_num = @raw_num - (@chr * 1024);
  选择@code = @code + SUBSTRING(@bcelems, 1 + @chr, 1);

  -- 1^32
  选择@chr = @raw_num / 32；
  选择@raw_num = @raw_num - (@chr * 32);
  选择@code = @code + SUBSTRING(@bcelems, 1 + @chr, 1);

  -- 0^32  
  选择@code = @code + SUBSTRING(@bcelems, 1 + @raw_num, 1);

  -  就是这样！
结尾;

```

我并不非常关心优化，除非这种方法实际上比任何替代方法都差一个数量级（或更多）。

代码只会以小批量的方式执行，可能每 10 分钟左右生成 20 或 30 个代码。由于数字范围很大，我不想将代码预先计算到一个巨大的表格中（在任何给定的安装中，只会使用整个代码范围的一小部分）。

但是，我确信可能有一种更简洁的方法可以实现相同的结果——尤其是那些除法和减法。

任何建设性的批评、意见或建议都将受到欢迎。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-10T23:44:26.123

看到它是 SQL Server 2005，有什么理由不使用 CLR 存储过程？您可以使用您选择的 CLR 语言，它可能是您现有 Delphi 代码的相对直接的端口。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T11:25:26.857

虽然它可以在 SQL Server 2005 中清楚地完成，但我认为某种预编译的高级语言例程具有足够的“非数据库性”是有意义的。

我为 Interbase/Firebird 编写了 DLL，为 SQL Server 编写了 T-SQL 存储过程，但从未编写过 CLR 例程。这将是一个有趣的练习！

# oracle - 如何终止连接到我的 oracle 数据库的所有会话？

> ID：55342
> 
> 赞同：29
> 
> 时间：2008-09-10T21:16:10.613
> 
> 标签：oracle, session, sqlplus, kill, database-administration

我需要在没有管理员监督的情况下快速（并强制）终止连接到我的 oracle 数据库的所有外部会话。

我不想只是锁定数据库并让用户优雅地退出。

我将如何编写这个脚本？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2008-09-10T21:27:44.500

此答案深受此处对话的影响： [http ://www.tek-tips.com/viewthread.cfm?qid=1395151&page=3](http://www.tek-tips.com/viewthread.cfm?qid=1395151&page=3)

```
ALTER SYSTEM ENABLE RESTRICTED SESSION;

begin     
    for x in (  
            select Sid, Serial#, machine, program  
            from v$session  
            where  
                machine <> 'MyDatabaseServerName'  
        ) loop  
        execute immediate 'Alter System Kill Session '''|| x.Sid  
                     || ',' || x.Serial# || ''' IMMEDIATE';  
    end loop;  
end; 
```

我跳过了源自数据库服务器的终止会话，以避免终止 Oracle 与其自身的连接。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2010-09-29T19:45:24.943

作为 SYS：

```
startup force; 
```

残酷，却不失优雅。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-13T20:00:36.743

在杀死会话之前，如果可能的话

```
ALTER SYSTEM ENABLE RESTRICTED SESSION; 
```

阻止新会话连接。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-10-18T10:55:32.377

一段时间以来，我一直在使用类似的东西来终止共享服务器上的会话。可以删除“where”的第一行以终止所有非“sys”会话：

```
BEGIN
  FOR c IN (
      SELECT s.sid, s.serial#
      FROM v$session s
      WHERE (s.Osuser = 'MyUser' or s.MACHINE = 'MyNtDomain\MyMachineName')
      AND s.USERNAME <> 'SYS'
      AND s.STATUS <> 'KILLED'
  )
  LOOP
      EXECUTE IMMEDIATE 'alter system kill session ''' || c.sid || ',' || c.serial# || '''';
  END LOOP;
END; 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-10-24T16:10:07.413

如果您想阻止新用户连接，但允许当前会话继续直到它们处于非活动状态，您可以将数据库置于 QUIESCE 模式：

```
ALTER SYSTEM QUIESCE RESTRICTED; 
```

从[Oracle 数据库管理员指南](http://download.oracle.com/docs/cd/B28359_01/server.111/b28310/start004.htm)：

> 非 DBA 活动会话将继续，直到它们变为非活动状态。活动会话是当前在事务、查询、提取或 PL/SQL 语句中的会话；或当前持有任何共享资源（例如，入队）的会话。不允许非活动会话变为活动状态...一旦所有非 DBA 会话变为非活动状态，ALTER SYSTEM QUIESCE RESTRICTED 语句完成，数据库处于静默状态

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-02-02T18:14:21.713

附加信息

> 重要的 Oracle 11g 更改以更改会话终止会话
> 
> Oracle 作者 Mladen Gogala 指出，在使用 inst_id 列时，现在需要一个 @ 符号来终止会话：

```
alter system kill session '130,620,@1'; 
```

[http://www.dba-oracle.com/tips_killing_oracle_sessions.htm](http://www.dba-oracle.com/tips_killing_oracle_sessions.htm)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-12T17:34:05.543

**尝试登录时触发**

尝试断开用户连接，您不应该允许他们连接。

有这种触发器的例子。

```
CREATE OR REPLACE TRIGGER rds_logon_trigger
AFTER LOGON ON DATABASE
BEGIN
  IF SYS_CONTEXT('USERENV','IP_ADDRESS') not in ('192.168.2.121','192.168.2.123','192.168.2.233') THEN
    RAISE_APPLICATION_ERROR(-20003,'You are not allowed to connect to the database');
  END IF;

  IF (to_number(to_char(sysdate,'HH24'))< 6) and (to_number(to_char(sysdate,'HH24')) >18) THEN
    RAISE_APPLICATION_ERROR(-20005,'Logon only allowed during business hours');
  END IF;

END; 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-02T14:05:04.610

我发现下面的代码片段很有帮助。取自：http: [//jeromeblog-jerome.blogspot.com/2007/10/how-to-unlock-record-on-oracle.html](http://jeromeblog-jerome.blogspot.com/2007/10/how-to-unlock-record-on-oracle.html)

```
select
owner||'.'||object_name obj ,
oracle_username||' ('||s.status||')' oruser ,
os_user_name osuser ,
machine computer ,
l.process unix ,
s.sid||','||s.serial# ss ,
r.name rs ,
to_char(s.logon_time,'yyyy/mm/dd hh24:mi:ss') time
from v$locked_object l ,
dba_objects o ,
v$session s ,
v$transaction t ,
v$rollname r
where l.object_id = o.object_id
and s.sid=l.session_id
and s.taddr=t.addr
and t.xidusn=r.usn
order by osuser, ss, obj
; 
```

然后跑：

```
Alter System Kill Session '<value from ss above>'
; 
```

杀死单个会话。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-05-25T09:57:44.677

要回答所提出的问题，这里是完成这项工作的最准确的 SQL，您可以将它与 PL/SQL 循环结合以实际运行 kill 语句：

```
select ses.USERNAME,
    substr(MACHINE,1,10) as MACHINE, 
    substr(module,1,25) as module,
    status, 
    'alter system kill session '''||SID||','||ses.SERIAL#||''';' as kill
from v$session ses LEFT OUTER JOIN v$process p ON (ses.paddr=p.addr)
where schemaname <> 'SYS'
    and not exists
    (select 1 
        from DBA_ROLE_PRIVS 
        where GRANTED_ROLE='DBA' 
            and schemaname=grantee)
    and machine!='yourlocalhostname' 
order by LAST_CALL_ET desc; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2016-03-30T04:47:34.460

如果 Oracle 在 Unix /Linux 中运行，那么我们可以 grep 查找所有客户端连接并终止它

grep所有oracle客户端进程：

ps -ef | grep 本地=否 | grep -v grep | awk '{打印 $2}' | wc -l

杀死所有 oracle 客户端进程：

杀死 -9`ps -ef | grep LOCAL=NO | grep -v grep | awk '{print $2}'`

# palm-os - palm OS 中的“后台”任务

> ID：55350
> 
> 赞同：4
> 
> 时间：2008-09-10T21:19:39.340
> 
> 标签：palm-os, garnet-os

我正在尝试创建一个 Palm OS 应用程序，以每 X 分钟或几小时检查一次网站，并在有数据可用时提供通知。我知道这种事情可以在新的 Palm 上完成——例如，当应用程序不在顶部时，我的 Centro 可以下载电子邮件或网站——但我不知道该怎么做。谁能指出我正确的方向？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-11T04:37:39.507

这是可以做到的，但非常困难。您必须采取几个步骤。

首先，这仅适用于 Palm OS 5，并且在一些早期的 Palm OS 5 设备上是粗略的。最新的设备更好但并不完美。

接下来，您需要使用 AlmSetAlarm 为您的应用程序创建警报。这就是您完成“每 X 分钟或几小时”部分的方式。

当警报触发时，您的应用程序将获得一个 sysAppLaunchCmdAlarmTriggered 启动代码，即使它尚未运行。如果你只想做一些简单快速的事情，你可以响应启动代码来做，你就完成了。

在警报启动代码中完成您的工作后，请务必设置下一个警报，以便您继续被呼叫。

重要提示：响应此启动代码时，您无法访问全局变量！根据编译器中的设置，您可能也无法访问某些 C++ 功能，例如虚函数（在内部使用全局变量）。您可以在 Codewarrior 中设置一个可以帮助解决此问题的设置，但我不太熟悉它。您应该构建您的代码，使其不需要全局变量；例如，您可以使用 FtrSet 和 FtrGet 来存储您可能需要的全局数据位。最后，您将只能访问 68000 个机器代码的单个 64KB 代码段。如果没有设置全局变量，段间跳转将无法正常工作。

您可以通过将大部分代码移至 PNOlet 来绕过这些限制，但这是一个完全不同且更复杂的主题。

如果您想做一些可能需要一段时间的更复杂的事情（例如加载网页或下载电子邮件），强烈建议不要在警报启动代码期间执行此操作。您可以在 sysAppLaunchCmdDisplayAlarm 启动代码中执行某些操作并向用户显示允许他们取消的表单。但这肯定会很快变得烦人。

更好的用户体验（但更复杂）是成为后台应用程序。这有点黑魔法，并没有得到很好的支持，但这是可能的。成为后台应用程序基本上分为三个步骤：

1.  使用 DmDatabaseProtect 保护您的应用程序数据库。这将确保您的应用程序被锁定，因此无法删除。

2.  使用 MemHandleLock 和 MemHandleSetOwner 锁定您的代码段（将所有者设置为 0）。这将确保您的代码被加载到内存中并且不会被移动。

3.  注册一些通知。例如，sysNotifyIdleTimeEvent 是一个很好的通知，可用于执行一些周期性的后台处理。

设置完成后，您可以退出警报启动代码，然后等待您的通知触发。然后，当调用通知处理程序时，您将执行所有后台处理。

Also make sure that if you allocate any system objects (memory, handles, file handles, etc.), you set their owner to 0 (system) if you expect them to persist after you return from your notification handler. Otherwise the system will clean them up. If you do this, be super careful to avoid memory and resource leaks!! They will never get cleaned up when the owner is set to 0!

To leave background mode, simply do the reverse: unregister for notifications, unlock your code segment, and unprotect your application database.

If you do any network operations in the background, be sure that you set the sockets to non-blocking mode and deal correctly with that! Otherwise you will block the foreground application and cause problems.

# c# - __doPostBack 在 Firefox 中不起作用

> ID：55360
> 
> 赞同：3
> 
> 时间：2008-09-10T21:28:13.907
> 
> 标签：c#, asp.net

__doPostBack 在 Firefox 3 中不起作用（尚未检查 2）。在 IE 6 和 7 中一切都运行良好，甚至在 Chrome 中运行？

这是一个简单的 asp:LinkBut​​ton 与 OnClick 事件

```
<asp:LinkButton ID="DeleteAllPicturesLinkButton" Enabled="False" OnClientClick="javascript:return confirm('Are you sure you want to delete all pictures? \n This action cannot be undone.');" OnClick="DeletePictureLinkButton_Click" CommandName="DeleteAll" CssClass="button" runat="server"> 
```

javascript 确认正在触发，所以我知道 javascript 正在工作，特别是 __doPostBack 事件。页面上还有很多内容，只是不知道发布整个页面是否有效。

我启用了对页面加载事件的控制。

有任何想法吗？

* * *

我希望这是正确的方法，但我找到了答案。我想我会把它放在这里而不是放在stackoverflow“答案”中

似乎它与嵌套 ajax 工具包 UpdatePanel 有关。当我卸下顶层面板时，它已修复。

如果其他人有同样的问题，希望这会有所帮助。我仍然不知道具体是什么导致了这个问题，但这就是我的解决方案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-17T20:35:43.083

检查您的用户代理字符串。同样的事情曾经发生在我身上，我意识到这是因为我正在测试一些页面作为“googlebot”。生成的 JavaScript 取决于知道用户代理是什么。

来自[http://support.mozilla.com/tiki-view_forum_thread.php?locale=tr&comments_parentId=160492&forumId=1](http://support.mozilla.com/tiki-view_forum_thread.php?locale=tr&comments_parentId=160492&forumId=1)：

> 要重置您的用户代理字符串，请在地址栏中键入 about:config 并按 Enter。这会显示一个首选项列表。在过滤器框中输入 general.useragent，这应该会显示一些首选项（可能是其中的 4 个）。如果有任何用户设置了状态，请右键单击首选项并选择重置

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-16T22:46:40.727

我在 Firefox 中遇到了同样的问题（__doPostBack 无法正常工作）——浪费了整整一个小时。问题原来是HTML。如果你像这样使用 HTML：

```
<input type="button" id="yourButton" onclick="doSomethingThenPostBack();" value="Post" /> 
```

其中“doSomethingThenPostBack”只是一个调用 __doPostBack 的 JavaScript 方法，表单***不会***在 Firefox 中发布。它将在 IE 和 Chrome 中回发***。***要解决此问题，请确保您的 HTML 是：

```
<input type="submit" id="yourButton" ... 
```

关键是**类型**属性。它必须在 Firefox 中“**提交**”才能使 __doPostBack 工作。其他浏览器似乎并不在意。希望这可以帮助其他遇到此问题的人。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-10T21:33:14.487

是因为你在做**退货**确认吗？似乎 return 语句应该阻止其余代码触发。我认为 if 语句会起作用

```
if (!confirm(...)) { return false; } _doPostBack(...); 
```

能把所有的js代码贴在链接的OnClick里吗？

**编辑**：啊哈，忘记了链接按钮会发出这样的代码

```
<a href="javascript:__doPostBack()" onclick="return confirm()" /> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-10T21:47:13.907

这可能看起来很简单，但是您是否确认您的 Firefox 设置未设置为干扰回发？有时由于调试会话中的奇怪浏览器配置，我会遇到类似的问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-10T22:14:45.497

你在处理 PageLoad 事件吗？如果是这样，请尝试以下

```
if (!isPostBack)
{
    //do something
}
else if (Request.Form["__EVENTTARGET"].ToLower().IndexOf("myevent") >= 0)
{
    //call appropriate function.
} 
```

检查您是否以这种方式接到电话，如果是这样，那么可能该事件未连接并且需要显式调用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-10T22:24:35.847

您对 "Enabled = 'false'" 有什么期望？

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-10T23:11:49.447

我在某些 web 表单上遇到了 firebug 问题，与网络分析器有关的事情可能会与回发有关。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-10T21:41:15.903

无论有没有 OnClientClick 事件，它仍然不起作用。

_doPostBack 事件是 .NET 生成的自动生成的 javascript。

```
function __doPostBack(eventTarget, eventArgument) {

    if (!theForm.onsubmit || (theForm.onsubmit() != false)) {

        theForm.__EVENTTARGET.value = eventTarget;

        theForm.__EVENTARGUMENT.value = eventArgument;

        theForm.submit();

    }

} 
```

*&95; 是下划线，似乎是stackoverflow代码块格式的问题。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-10T22:08:09.147

现在我考虑了一下，正如我在上次编辑中所指出的那样，您想要删除 javascript: 在客户端单击属性中。不需要，因为 onclick 事件本身就是 javascript。试试看，看看是否有效。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-11T18:07:04.787

似乎它与嵌套 ajax 工具包 UpdatePanel 有关。当我卸下顶层面板时，它已修复。

如果其他人有同样的问题，希望这会有所帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-26T20:32:11.703

我在一个正在开发的网络应用程序中遇到了同样的问题，我尝试解决了几个小时。

最后，我做了一个新的网络表单，在里面放了一个链接按钮，效果很好！

然后我注意到以下问题：

...

我将顺序切换为以下，并立即修复：...

IE 没有任何问题（无论如何我都注意到了）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-06-22T11:25:21.707

我有一个类似的问题。事实证明，Akamai 正在修改用户代理字符串，因为正在应用不需要的设置。

这意味着某些 .NET 控件无法正确呈现 __doPostBack 代码。此问题已在[此处](http://www.dotnetlite.com/2010/06/21/loss-of-__dopostback-code-after-protecting-a-site-with-akamai/)发布。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-10-22T05:11:15.067

@Terrapin：你完全正确（对我来说，无论如何）。

我正在运行用户代理切换器，无意中选择了 Googlebot 2.1 代理。

在 Reporting Services 2008 中，它导致实际呈现报告的 iframe 大约为 300x200 像素，而在 Reporting Services 2008 R2 中，在错误控制台中抛出“__doPostBack undefined”错误。

切换回默认用户代理解决了我的所有问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-07-16T15:31:15.530

我对 Firefox 也有同样的问题。您是否可以使用 jQuery .trigger() 方法而不是`__doPostBack()`使用在将回发事件注册为单击操作的元素上触发单击操作？

例如，如果您的 aspx 页面中有此元素：

```
<asp:Button runat="server" ID="btnMyPostback" OnClick="btnMyPostback_Click" CssClass="hide" ToolTip="Click here to submit this transaction."  /> 
```

以及控制器中的回发事件：

```
 protected void btnMyPostback_Click(object sender, EventArgs e)
 {
     //do my postback stuff
 } 
```

您可以通过以下方式进行回发：

```
$("#btnMyPostback").trigger("click"); 
```

如果`Page_Load`您需要在`Page_Load`.

# python - 如何在 Python 的 IDLE 中获取 Emacs 的键绑定？

> ID：55365
> 
> 赞同：6
> 
> 时间：2008-09-10T21:32:47.140
> 
> 标签：python, emacs, ide, keyboard

我主要使用 Emacs 来编写 Python 代码，但有时我使用 IDLE。有没有办法在 IDLE 中轻松更改键绑定以匹配 Emacs？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T08:18:07.027

IDLE 提供 Emacs 键绑定，无需安装其他软件。

1.  打开菜单项 Options -> Configure IDLE...
2.  转到键选项卡
3.  在对话框右侧的下拉菜单中，将选择更改为“IDLE Classic Unix”

这不是真正的 emacs 键绑定，但您可以获得移动、保存/打开等基础知识......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-10T23:33:46.820

有一个名为 Windows 的程序，`XKeymacs`它允许您为不同的程序指定 emacs 键绑定。它应该与 IDLE 一起使用。

[http://www.cam.hi-ho.ne.jp/oishi/indexen.html](http://www.cam.hi-ho.ne.jp/oishi/indexen.html)

-标记

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T16:36:39.850

['readline' 模块](http://www.python.org/doc/2.5/lib/module-readline.html)应该提供 Emacs 之类的键绑定甚至功能。但是，它在 Windows 上不可用，但在 Unix 上可用。因此，如果您不使用 Windows，这可能是一个可行的解决方案。

```
import readline 
```

由于我在 Windows 上运行 IDLE，很遗憾这不是我的选择。

# java - 读取 VC++ CArchive 二进制格式（或 Java 读取（CObArray））

> ID：55369
> 
> 赞同：3
> 
> 时间：2008-09-10T21:33:48.480
> 
> 标签：java, visual-c++, serialization, mfc, carchive

是否有关于用于序列化各种 MFC 数据结构的二进制格式的明确文档？我已经能够在十六进制编辑器中查看我自己的一些类，并使用 Java 的 ByteBuffer 类来读取它们（使用自动字节顺序转换等）。

但是，我目前在尝试引入 CObArray 数据时遇到了问题，因为似乎有一个相当大的标题对我来说是不透明的，并且不清楚它是如何持久化对象类型信息的。

是否有一组对此有帮助的在线文档？或者来自过去处理过这个问题的人的一些示例 Java 代码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-10T21:53:09.323

由于 MFC 附带源代码，我将创建一个测试 MFC 应用程序，该应用程序序列化 CObArray 并逐步执行序列化代码。这应该为您提供所需的所有信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-10T22:00:41.630

我同意 jmatthias：使用 MFC 源代码。

MSDN 上的[这个页面](http://msdn.microsoft.com/en-us/library/32wxt301%28VS.71%29.aspx)也可能有用。

# c# - 通过继承扩展枚举

> ID：55375
> 
> 赞同：93
> 
> 时间：2008-09-10T21:39:21.477
> 
> 标签：c#, java, .net

我知道这与枚举的想法相反，但是可以在 C#/Java 中扩展枚举吗？我的意思是“扩展”，既包括向枚举添加新值的意义，也包括从现有枚举继承的面向对象意义。

我认为这在 Java 中是不可能的，因为它最近才得到它们（Java 5？）。不过，C# 似乎更宽容那些想做疯狂事情的​​人，所以我认为这可能以某种方式存在。大概它可以通过反射被破解（不是你每个人都实际使用这种方法）？

我不一定对实现任何给定的方法感兴趣，它只是在我想到时激起了我的好奇心:-)

* * *

## 回答 #1

> 赞同：110
> 
> 时间：2008-09-10T22:29:39.640

不能扩展 Enums 的原因是它会导致多态性问题。

假设您有一个枚举 MyEnum，其值为 A、B 和 C，并将其扩展为值为 D 作为 MyExtEnum。

假设一个方法在某处需要一个 myEnum 值，例如作为参数。提供一个 MyExtEnum 值应该是合法的，因为它是一个子类型，但是当结果是 D 时，你会怎么做？

为了消除这个问题，扩展枚举是非法的

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2008-09-10T23:25:45.713

当内置枚举不够用时，你可以用老式的方式来制作自己的枚举。例如，如果你想添加一个额外的属性，例如一个描述字段，你可以这样做：

```
public class Action {
    public string Name {get; private set;}
    public string Description {get; private set;}

    private Action(string name, string description) {
        Name = name;
        Description = description;
    }

    public static Action DoIt = new Action("Do it", "This does things");
    public static Action StopIt = new Action("Stop It", "This stops things");
} 
```

然后，您可以像这样将其视为枚举：

```
public void ProcessAction(Action a) {
    Console.WriteLine("Performing action: " + a.Name)
    if (a == Action.DoIt) {
       // ... and so on
    }
} 
```

诀窍是确保构造函数是私有的（或者如果您想继承则受保护），并且您的实例是静态的。

* * *

## 回答 #3

> 赞同：42
> 
> 时间：2009-11-06T17:10:01.433

您走错路了：枚举的子类将具有*更少的*条目。

在伪代码中，思考：

```
enum Animal { Mosquito, Dog, Cat };
enum Mammal : Animal { Dog, Cat };  // (not valid C#) 
```

任何可以接受 Animal 的方法都应该能够接受 Mammal，但反过来不行。子类化是为了使某些东西更具体，而不是更一般。这就是为什么“对象”是类层次结构的根。同样，如果枚举是可继承的，那么枚举层次结构的假设根将具有所有可能的符号。

但是不，C#/Java 不允许子枚举，AFAICT，尽管它有时会非常有用。这可能是因为他们选择将枚举实现为整数（如 C）而不是内部符号（如 Lisp）。（上图，（Animal）1代表什么，（Mammal）1代表什么，它们的值是一样的吗？）

不过，您可以编写自己的类似枚举的类（使用不同的名称）来提供此功能。使用 C# 属性，它甚至可能看起来不错。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2008-09-11T12:27:47.987

枚举应该代表所有可能值的枚举，因此扩展确实违背了这个想法。

但是，您可以在 Java（可能是 C++0x）中做的是使用接口而不是枚举类。然后将标准值放入实现该功能的枚举中。显然你不能使用 java.util.EnumSet 之类的。这是“更多NIO特性”中采取的做法，JDK7中应该有。

```
public interface Result {
    String name();
    String toString();
}
public enum StandardResults implements Result {
    TRUE, FALSE
}

public enum WTFResults implements Result {
    FILE_NOT_FOUND
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-10T21:49:38.177

您可以使用 .NET 反射在运行时从现有枚举中检索标签和值（`Enum.GetNames()`这`Enum.GetValues()`是您将使用的两种特定方法），然后使用代码注入创建一个包含这些元素和一些新元素的新方法。这似乎有点类似于“从现有枚举继承”。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-12-11T22:12:16.340

我没有看到其他人提到这一点，但枚举的序数值很重要。例如，对于 grails，当您将枚举保存到数据库时，它使用序数值。如果你能以某种方式扩展一个枚举，你的扩展的序数值是什么？如果你在多个地方扩展它，你怎么能对这些序数保持某种顺序？序数值的混乱/不稳定将是一件坏事，这可能是语言设计者没有触及这一点的另一个原因。

如果您是语言设计者，另一个困难是如何保留应该返回所有枚举值的 values() 方法的功能。你会在什么上调用它，它如何收集所有的值？

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-10T21:44:03.557

如果您返回源代码并进行编辑，添加枚举是一件相当常见的事情，任何其他方式（继承或反射，如果可能的话）都可能在您升级库时回来并打击您他们引入了相同的枚举名称*或*相同的枚举值——我见过很多低级代码，其中整数与二进制编码匹配，你会遇到问题

理想情况下，引用枚举的代码应仅写为等于（或开关），并尝试通过不期望枚举集为 const 来证明未来

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-10T23:59:15.697

如果您的意思是基类意义上的扩展，那么在 Java 中......不。

但是，如果这就是您的意思，您可以扩展枚举值以具有属性和方法。

例如，以下使用 Bracket 枚举：

```
class Person {
    enum Bracket {
        Low(0, 12000),
        Middle(12000, 60000),
        Upper(60000, 100000);

        private final int low;
        private final int high;
        Brackets(int low, int high) {
            this.low = low;
            this.high = high;
        }

        public int getLow() {
            return low;
        }

        public int getHigh() {
            return high;
        }

        public boolean isWithin(int value) {
           return value >= low && value <= high;
        }

        public String toString() {
            return "Bracket " + low + " to " + high;
        }
    }

    private Bracket bracket;
    private String name;

    public Person(String name, Bracket bracket) {
        this.bracket = bracket;
        this.name = name;
    }

    public String toString() {
        return name + " in " + bracket;
    }        
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-11T19:27:38.510

不久前看到一篇关于 Java 的帖子，请查看[http://www.javaspecialists.eu/archive/Issue161.html](http://www.javaspecialists.eu/archive/Issue161.html)。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-10T21:42:21.563

你不能继承/扩展一个枚举，你可以使用[属性](http://msdn.microsoft.com/en-us/library/system.componentmodel.descriptionattribute.aspx)来[声明一个描述](http://blog.waynehartman.com/articles/84.aspx)。如果您正在寻找一个整数值，那是内置的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-10T21:42:21.907

嗯——据我所知，这是做不到的——枚举是在设计时编写的，只是为了方便程序员。

我很确定，在编译代码时，等效值将替换枚举中的名称，从而消除了枚举的概念和（因此）扩展它的能力。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2010-07-12T17:40:42.610

我希望能够将值添加到作为现有值组合的 C# 枚举中。例如（这是我想做的）：

AnchorStyles 定义为

`public enum AnchorStyles { None = 0, Top = 1, Bottom = 2, Left = 4, Right = 8, }`

我想添加一个 AnchorStyles.BottomRight = Right + Bottom 所以而不是说

```
my_ctrl.Anchor = AnchorStyles.Right | AnchorStyles.Bottom; 
```

我只能说

```
my_ctrl.Anchor = AnchorStyles.BottomRight; 
```

这不会导致上面提到的任何问题，所以如果可能的话，那就太好了。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-08-26T11:29:40.230

就 java 而言，这是不允许的，因为向枚举添加元素将有效地创建超类而不是子类。

考虑：

```
 enum Person (JOHN SAM}   
 enum Student extends Person {HARVEY ROSS} 
```

多态性的一般用例是

```
 Person person = Student.ROSS;   //not legal 
```

这显然是错误的。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2014-12-17T06:12:10.160

一段时间前，即使我想做这样的事情，发现枚举扩展会破坏很多基本概念......（不仅仅是多态）

但是，如果枚举是在外部库中声明的，您仍然可能需要这样做，并且请记住，在使用此枚举扩展时，您应该特别小心...

```
public enum MyEnum { A = 1, B = 2, C = 4 }

public const MyEnum D = (MyEnum)(8);
public const MyEnum E = (MyEnum)(16);

func1{
    MyEnum EnumValue = D;

    switch (EnumValue){
      case D:  break;
      case E:  break;
      case MyEnum.A:  break;
      case MyEnum.B:  break;
   }
} 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2019-10-30T17:07:10.840

**临时/本地解决方法**，当您只想非常本地/一次性使用时：

```
enum Animals { Dog, Cat }
enum AnimalsExt { Dog = Animals.Dog, Cat= Animals.Cat,  MyOther}
// BUT CAST THEM when using:
var xyz = AnimalsExt.Cat;
MethodThatNeedsAnimal(   (Animals)xyz   ); 
```

查看所有答案：[枚举“继承”](https://stackoverflow.com/questions/757684/enum-inheritance)

# windows - ant build.xml windows 路径中的空白

> ID：55386
> 
> 赞同：15
> 
> 时间：2008-09-10T21:45:54.130
> 
> 标签：windows, ant, whitespace, build.xml

我正在使用 Windows，我正在尝试让 ANT 工作。

当我从命令行进行 ant 构建时，我得到： `C:\dev\Projects\springapp\${%ANT_HOME%}\lib not found.`

我查看了`build.xml`文件，发现：（ `appserver.home=${user.home}/apache-tomcat-6.0.14`我只是直接从教程中复制和粘贴的）

我将其更改为：

`appserver.home="C:\Program Files\Apache Software Foundation\Tomcat 6.0"`

但现在我得到：

`C:\dev\Projects\springapp\"C:Program FilesApache Software FoundationTomcat 6.0"\lib not found.`

似乎 Program Files 和 Tomcat 6.0 中的空白导致构建失败。如何在 xml 文件中处理这些而不用没有空格的路径重新创建目录？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-10T22:20:56.930

将其更改为

```
appserver.home="C:\\Program Files\\Apache Software Foundation\\Tomcat 6.0" 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-09-08T12:49:05.073

带有“/”而不是“\”的变体适用于我的系统。只需要在路径结构前后删除"符号即可。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-07-26T13:21:06.283

在设置值`dir /x`时使用和使用 thme查找这些目录的 Windows 短名称。`path`

Windows[如何确定/处理任何给定文件的 DOS 短名称？](https://stackoverflow.com/questions/324041/how-does-windows-determine-handle-the-dos-short-name-of-any-given-file)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T15:36:12.137

看起来您的属性设置不正确。

我猜您的 basedir 属性指向 C:\dev\Projects\springapp 并且您的属性使用的值如下：

```
<property name="property.1" value="directory" /> 
```

代替

```
<property name="property.1" location="directory" /> 
```

如果位置是相对路径，则使用 location 属性将链接解析为相对于您的 basedir，如果您输入其中之一，则解析为绝对路径。如果您可以发布部分 Ant 文件，具体说明如何定义 appserver.home 以及如何在引发错误的任务中使用它，我可能会更具体。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-01T18:32:32.363

在 build.xml 的顶部，尝试添加 `<property environment="env"/>` 然后使用`${env.USER_HOME}`（或您环境中的任何内容）。那是为我做的（${env.JAVA_HOME} 而不是`${java.home}`）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-10T23:32:57.227

除了转义 windows 目录分隔符之外，还要确保您输入的所有路径都应使用正确的大小写，Windows 不区分大小写但会保留大小写，而 Ant 区分大小写。

# python - 用于 HTML 解析的 Python 正则表达式 (BeautifulSoup)

> ID：55391
> 
> 赞同：11
> 
> 时间：2008-09-10T21:49:53.900
> 
> 标签：python, regex, screen-scraping

我想获取 HTML 中隐藏输入字段的值。

```
<input type="hidden" name="fooId" value="12-3456789-1111111111" /> 
```

我想在 Python 中编写一个返回值的正则表达式`fooId`，因为我知道 HTML 中的行遵循格式

```
<input type="hidden" name="fooId" value="**[id is here]**" /> 
```

有人可以在 Python 中提供一个示例来解析 HTML 的值吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-10T22:16:24.273

对于这种特殊情况，BeautifulSoup 比正则表达式更难编写，但它更健壮......我只是贡献了 BeautifulSoup 示例，因为您已经知道要使用哪个正则表达式:-)

```
from BeautifulSoup import BeautifulSoup

#Or retrieve it from the web, etc. 
html_data = open('/yourwebsite/page.html','r').read()

#Create the soup object from the HTML data
soup = BeautifulSoup(html_data)
fooId = soup.find('input',name='fooId',type='hidden') #Find the proper tag
value = fooId.attrs[2][1] #The value of the third attribute of the desired tag 
                          #or index it directly via fooId['value'] 
```

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-15T17:35:44.360

我同意 Vinko [BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)是要走的路。但是我建议使用`fooId['value']`来[获取属性](http://www.crummy.com/software/BeautifulSoup/documentation.html#The%20attributes%20of%20Tags)而不是依赖值作为第三个属性。

```
from BeautifulSoup import BeautifulSoup
#Or retrieve it from the web, etc.
html_data = open('/yourwebsite/page.html','r').read()
#Create the soup object from the HTML data
soup = BeautifulSoup(html_data)
fooId = soup.find('input',name='fooId',type='hidden') #Find the proper tag
value = fooId['value'] #The value attribute 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-10T21:59:47.357

```
import re
reg = re.compile('<input type="hidden" name="([^"]*)" value="<id>" />')
value = reg.search(inputHTML).group(1)
print 'Value is', value 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-10T21:57:00.640

解析是那些你真的不想自己动手的领域之一，如果你能避免的话，因为你将在未来几年内追逐边缘情况和错误

我建议使用[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)。它有很好的声誉，从文档中看起来很容易使用。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-14T13:14:10.740

Pyparsing 是 BeautifulSoup 和正则表达式之间的一个很好的过渡步骤。它比正则表达式更健壮，因为它的 HTML 标记解析理解大小写、空格、属性存在/不存在/顺序的变化，但比使用 BS 更简单地进行这种基本的标记提取。

您的示例特别简单，因为您要查找的所有内容都在打开的“输入”标签的属性中。这是一个 pyparsing 示例，显示了输入标签的几种变体，这些变体将使正则表达式适合，并且还显示了如果标签在评论中，如何不匹配标签：

```
html = """<html><body>
<input type="hidden" name="fooId" value="**[id is here]**" />
<blah>
<input name="fooId" type="hidden" value="**[id is here too]**" />
<input NAME="fooId" type="hidden" value="**[id is HERE too]**" />
<INPUT NAME="fooId" type="hidden" value="**[and id is even here TOO]**" />
<!--
<input type="hidden" name="fooId" value="**[don't report this id]**" />
-->
<foo>
</body></html>"""

from pyparsing import makeHTMLTags, withAttribute, htmlComment

# use makeHTMLTags to create tag expression - makeHTMLTags returns expressions for
# opening and closing tags, we're only interested in the opening tag
inputTag = makeHTMLTags("input")[0]

# only want input tags with special attributes
inputTag.setParseAction(withAttribute(type="hidden", name="fooId"))

# don't report tags that are commented out
inputTag.ignore(htmlComment)

# use searchString to skip through the input 
foundTags = inputTag.searchString(html)

# dump out first result to show all returned tags and attributes
print foundTags[0].dump()
print

# print out the value attribute for all matched tags
for inpTag in foundTags:
    print inpTag.value 
```

印刷：

```
['input', ['type', 'hidden'], ['name', 'fooId'], ['value', '**[id is here]**'], True]
- empty: True
- name: fooId
- startInput: ['input', ['type', 'hidden'], ['name', 'fooId'], ['value', '**[id is here]**'], True]
  - empty: True
  - name: fooId
  - type: hidden
  - value: **[id is here]**
- type: hidden
- value: **[id is here]**

**[id is here]**
**[id is here too]**
**[id is HERE too]**
**[and id is even here TOO]** 
```

您可以看到，pyparsing 不仅匹配这些不可预测的变化，它还返回对象中的数据，从而可以轻松读取各个标签属性及其值。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-10T21:56:05.290

```
/<input type="hidden" name="fooId" value="([\d-]+)" \/>/ 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T09:41:15.970

```
/<input\s+type="hidden"\s+name="([A-Za-z0-9_]+)"\s+value="([A-Za-z0-9_\-]*)"\s*/>/

>>> import re
>>> s = '<input type="hidden" name="fooId" value="12-3456789-1111111111" />'
>>> re.match('<input\s+type="hidden"\s+name="([A-Za-z0-9_]+)"\s+value="([A-Za-z0-9_\-]*)"\s*/>', s).groups()
('fooId', '12-3456789-1111111111') 
```

# cuda - 您是否成功使用了 GPGPU？

> ID：55403
> 
> 赞同：19
> 
> 时间：2008-09-10T21:59:23.363
> 
> 标签：cuda, gpgpu, hpc

我很想知道是否有人通过使用例如[nVidia CUDA编写了利用](http://www.nvidia.com/object/cuda_get.html)[GPGPU](http://en.wikipedia.org/wiki/GPGPU)的应用程序。如果是这样，您发现了哪些问题，与标准 CPU 相比，您获得了哪些性能提升？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-11-25T22:18:40.460

我一直在使用[ATI 的流 SDK](http://ati.amd.com/technology/streamcomputing/sdkdwnld.html)而不是 Cuda 进行 gpgpu 开发。您将获得什么样的性能增益取决于***很多***因素，但最重要的是数字强度。（即计算操作与内存引用的比率。）

BLAS level-1 或 BLAS level-2 函数（例如添加两个向量）仅对每 3 个内存引用执行 1 个数学运算，因此 NI 为 (1/3)。使用 CAL 或 Cuda 总是比仅在 cpu 上运行*要慢。*主要原因是将数据从 cpu 传输到 gpu 并返回所需的时间。

对于像 FFT 这样的函数，有 O(N log N) 次计算和 O(N) 次内存引用，因此 NI 为 O(log N)。如果 N 非常大，比如 1,000,000，那么在 gpu 上执行它可能会更快；如果 N 很小，比如 1,000，它几乎肯定会更慢。

对于 BLAS 3 级或 LAPACK 函数，如矩阵的 LU 分解，或寻找其特征值，需要 O(N^3) 次计算和 O(N^2) 次内存引用，因此 NI 为 O(N)。对于非常小的数组，假设 N 是几个分数，这在 cpu 上仍然会更快，但是随着 N 的增加，算法很快从内存限制到计算限制，并且 gpu 上的性能提升非常迅速地。

任何涉及复杂算术的计算都比标量算术多，这通常会使 NI 加倍并提高 gpu 性能。

[![](https://i.stack.imgur.com/kXBjR.gif)](https://i.stack.imgur.com/kXBjR.gif)
[（来源：[earthlink.net](http://home.earthlink.net/~mtie/CGEMM%20081121.gif)）]

这是 CGEMM 的性能——在 Radeon 4870 上完成的复杂单精度矩阵-矩阵乘法。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-11T04:03:27.467

我写了一些简单的应用程序，如果你可以并行化浮点计算真的很有帮助。

我发现以下由伊利诺伊大学厄巴纳香槟分校教授和 NVIDIA 工程师共同教授的课程在我刚开始时非常有用：http: [//courses.ece.illinois.edu/ece498/al/Archive/Spring2007/Syllabus.html](http://courses.ece.illinois.edu/ece498/al/Archive/Spring2007/Syllabus.html)（包括所有讲座的录音）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-05-12T14:11:51.517

我已经将 CUDA 用于几种图像处理算法。当然，这些应用程序非常适合 CUDA（或任何 GPU 处理范例）。

IMO，将算法移植到 CUDA 时有三个典型阶段：

1.  **初始移植：**即使对 CUDA 有非常基本的了解，您也可以在几个小时内移植简单的算法。如果幸运的话，您的性能会提高 2 到 10 倍。
2.  **琐碎优化：**这包括使用纹理输入数据和填充多维数组。如果您有经验，这可以在一天内完成，并且可能会使您的性能提高 10 倍。生成的代码仍然可读。
3.  **核心优化：**这包括将数据复制到共享内存以避免全局内存延迟，将代码翻过来以减少使用的寄存器数量等。您可以在这一步花费数周时间，但性能提升并不值得大多数情况下。在这一步之后，您的代码将变得如此模糊，以至于没有人理解它（包括您）。

这与为 CPU 优化代码非常相似。然而，GPU 对性能优化的响应甚至比 CPU 更难预测。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-09-10T22:05:43.473

我一直在使用 GPGPU 进行运动检测（最初使用 CG，现在使用 CUDA）和图像处理稳定化（使用 CUDA）。在这些情况下，我已经获得了大约 10-20 倍的加速。

根据我的阅读，这对于数据并行算法来说是相当典型的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-15T11:34:18.067

虽然我还没有任何使用 CUDA 的实际经验，但我一直在研究这个主题并发现了许多论文，这些论文记录了使用 GPGPU API 取得的积极成果（它们都包括 CUDA）。

本文描述[了](http://www.cse.ust.hk/catalac/papers/gpujoin_sigmod08.pdf)如何通过创建许多可以组合成有效算法的并行原语（map、scatter、gather 等）来并行化数据库连接。

在[本文](http://www.manavski.com/downloads/PID505889.pdf)中，创建了 AES 加密标准的并行实现，其速度与谨慎的加密硬件相当。

最后，[本文](http://www.sciencedirect.com/science?_ob=ArticleURL&_udi=B6WKJ-4SVV8GS-2&_user=632453&_rdoc=1&_fmt=&_orig=search&_sort=d&view=c&_version=1&_urlVersion=0&_userid=632453&md5=8041f5b9d8a14cd18e96b12881f8d1df)分析了 CUDA 在结构化和非结构化网格、组合逻辑、动态规划和数据挖掘等众多应用中的应用情况。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-10-23T09:21:24.490

我已经在 CUDA 中实现了蒙特卡洛计算以用于某些财务用途。优化后的 CUDA 代码比“本可以更努力但不是真的”多线程 CPU 实现快约 500 倍。（此处将 GeForce 8800GT 与 Q6600 进行比较）。众所周知，蒙特卡洛问题是令人尴尬的平行问题。

遇到的主要问题包括由于 G8x 和 G9x 芯片对 IEEE 单精度浮点数的限制而导致的精度损失。随着 GT200 芯片的发布，这可以通过使用双精度单元在一定程度上缓解，但会牺牲一些性能。我还没试过。

此外，由于 CUDA 是 C 扩展，因此将其集成到另一个应用程序中并非易事。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-05-21T22:15:10.867

我在 GPU 上实现了一个遗传算法，并获得了大约 7 的速度提升。正如其他人指出的那样，更高的数值强度可能会带来更多的收益。所以，是的，如果应用程序是正确的，收益就在那里

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-09-09T15:25:12.497

我已经实现了 Cholesky 分解，用于使用 ATI Stream SDK 在 GPU 上求解大型线性方程。我的观察是

![替代文字](https://i.stack.imgur.com/vQZkq.jpg)

性能加速高达 10 倍。

通过将其扩展到多个 GPU 来解决相同的问题以对其进行更多优化。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-02-11T22:32:00.207

我编写了一个复值矩阵乘法内核，它在我使用它的应用程序中比 cuBLAS 实现高出约 30%，以及一种向量外积函数，它比其余的乘法跟踪解决方案运行几个数量级问题。

这是最后一年的项目。我花了整整一年的时间。

[http://www.maths.tcd.ie/~oconbhup/Maths_Project.pdf](http://www.maths.tcd.ie/~oconbhup/Maths_Project.pdf)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-05-12T14:35:02.627

是的。我已经使用 CUDA api实现了[非线性各向异性扩散滤波器。](http://www.cs.huji.ac.il/~cheny/reading/diffusion/classic.pdf)

这相当容易，因为它是一个过滤器，必须在给定输入图像的情况下并行运行。我在这方面没有遇到很多困难，因为它只需要一个简单的内核。加速大约是 300 倍。这是我在 CS 上的最后一个项目。该项目可以在[这里](http://projetos.inf.ufsc.br/arquivos_projetos/projeto_833/tcc_EdisonGustavoMuenz.pdf)找到（它是用葡萄牙语写的）。

我也尝试过编写[Mumford&Shah](http://www.dam.brown.edu/people/mumford/Papers/DigitizedVisionPapers--forNonCommercialUse/89-Mumford-Shah.pdf)分割算法，但是写起来很痛苦，因为 CUDA 还处于起步阶段，所以会发生很多奇怪的事情。`if (false){}`我什至看到通过在代码 O_O 中添加 a 来提高性能。

这种分割算法的结果并不好。与 CPU 方法相比，我的性能损失了 20 倍（但是，由于它是 CPU，因此可以采用产生相同结果的不同方法）。它仍在进行中，但不幸的是我离开了我正在工作的实验室，所以也许有一天我可能会完成它。

# c# - Path.GetTempFileName -- 目录名称无效

> ID：55411
> 
> 赞同：10
> 
> 时间：2008-09-10T22:06:40.477
> 
> 标签：c#, asp.net, iis

遇到一个问题，在某些服务器上，我们在使用 Path.GetTempFileName 时收到目录名称无效的错误。进一步调查表明它正在尝试将文件写入 c:\Documents and Setting\computername\aspnet\local settings\temp（通过使用 Path.GetTempPath 找到）。该文件夹存在，所以我假设这一定是关于 asp.net 帐户的权限问题。

有人告诉我 Path.GetTempFileName 应该指向 C:\Windows\Microsoft.NET\Framework\v2.0.50727\temporaryasp.net 文件。

我还被告知这个问题可能是由于服务器上安装 IIS 和 .NET 的顺序造成的。我已经完成了典型的“aspnet_regiis -i”并检查了文件夹等的安全性。此时我被卡住了。

任何人都可以对此有所了解吗？

**更新：**事实证明，提供对文件夹的“IUSR_ComputerName”访问权限就可以了。这是正确的程序吗？我似乎不记得过去这样做过，显然，我想遵循最佳实践来维护安全。毕竟，这是文件上传过程的一部分。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-13T05:56:29.970

这可能是假冒和不同身份验证方法不匹配的组合。

有很多件；我将尝试一一检查。

**模拟**是一种“临时”切换线程正在运行的用户帐户的技术。从本质上讲，该线程短暂地获得了与被模拟的帐户相同的权限和访问权限——不多也不少。一旦线程完成创建网页，它就会“恢复”回原始帐户并为下一次调用做好准备。此技术用于访问只有登录到您网站的用户才能访问的资源。坚持这个概念一分钟。

**现在，默认情况下 ASP.NET 在名为ASPNET**的本地帐户下运行一个网站。同样，默认情况下，只有 ASPNET 帐户和 Administrators 组的成员可以写入该文件夹。您的临时文件夹在该帐户的权限范围内。这是谜题的第二部分。

模仿不会自行发生。它需要在您的 web.config 中有意打开。

```
<identity impersonate="true" /> 
```

如果该设置缺失或设置为 false，您的代码将在上述 ASPNET 帐户下纯粹且简单地执行。鉴于您的错误消息，我很肯定您有 impersonation=true。没有什么不妥！模仿具有超出此讨论范围的优点和缺点。

剩下一个问题：当您使用模拟时，*哪个帐户会被模拟*？

除非您在 web.config 中指定帐户（[此处为标识元素的完整语法](http://msdn.microsoft.com/en-us/library/72wdk8cc.aspx)），否则模拟的帐户是 IIS 移交给 ASP.NET 的帐户。这取决于用户如何通过身份验证（或不通过身份验证）进入该站点。那是你的第三个也是最后一个作品。

IUSR_ComputerName 帐户是由 IIS 创建的低权限帐户。默认情况下，**如果用户无法通过身份验证**，则此帐户是运行 Web 呼叫的帐户。也就是说，用户以“匿名”身份进入。

总之，这就是发生在你身上的事情：

您的用户正在尝试访问该网站，而 IIS 由于某种原因无法验证此人。因为匿名访问是打开的，（或者您不会看到 IUSRComputerName 访问临时文件夹），IIS 无论如何都允许用户，但作为一般用户。您的 ASP.NET 代码运行并模拟此通用 IUSR___ComputerName“来宾”帐户；只是现在代码无法访问 ASPNET 帐户可以访问的内容，包括它自己的临时文件夹。

授予 IUSR_ComputerName 对该文件夹的 WRITE 访问权限会使您的症状消失。

但这只是症状。您需要查看**此人为何以“匿名/访客”的身份出现？**

有两种可能的情况：

a) 您打算使用 IIS 进行身份验证，但您的某些服务器在 IIS 中的身份验证设置错误。

在这种情况下，您需要在这些服务器上禁用匿名访问，以便进行通常的身份验证机制。请注意，您可能仍需要向您的用户授予对该临时文件夹的访问权限，或者改用另一个文件夹，您的用户已经可以访问该文件夹。

我已经多次处理过这种情况，坦率地说，放弃 Temp 文件夹会让您不那么头疼；在服务器中创建一个专用文件夹，设置适当的权限，并在 web.config 中设置其位置。

b) 你不想对人进行身份验证，或者你想使用 ASP.NET 表单身份验证（它使用 IIS 的匿名访问绕过 IIS 中的检查，让 ASP.NET 直接处理身份验证）

这个案子有点复杂。

您应该转到 IIS 并禁用除“匿名访问”之外的所有形式的身份验证。请注意，您不能在开发人员的框中执行此操作，因为调试器需要启用集成身份验证。所以你的调试框会和真实的服务器有点不同；请注意这一点。

然后，您需要决定是否应该关闭模拟，或者相反，在 web.config 中指定要模拟的帐户。如果您的 Web 服务器不需要外部资源（如数据库），请执行第一个。如果您的网站确实需要在可以访问数据库（或其他一些外部资源）的帐户下运行，请执行后者。

您还有另外两种选择来指定要模拟的帐户。一，您可以转到 IIS 并将“匿名”帐户更改为可以访问资源的帐户，而不是 IIS 为您管理的帐户。第二种选择是将加密的帐户和密码存储在注册表中。这一步有点复杂，也超出了本次讨论的范围。

祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-10T22:18:26.547

可能是因为[IIS_WPG](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/3648346f-e4f5-474b-86c7-5a86e85fa1ff.mspx?mfr=true)无权访问临时文件夹。如果您认为这是权限问题，请在 asp.net 工作进程上运行[Procmon](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)并检查 AccessDenied 错误。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-07-25T18:00:01.183

我在诊断正在写入临时文件的控制台应用程序时遇到了这个错误。在我的一次测试迭代中，我清除了 temp 中的所有文件/目录以进行“干净的”运行。我通过注销并重新登录解决了这个自我造成的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-10T22:15:58.067

您可以使用**Path.GetTempPath()**找出它试图写入的目录。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-07T09:44:31.693

我的一个 ASP.Net 应用程序遇到了同样的问题。我得到了**Path.GetTempPath()**但它抛出了一个异常：

*“无法写入文件“C:\Windows\Temp\somefilename”，异常：对路径“C:\Windows\Temp\somefilename”的访问被拒绝。”*

我在此页面上尝试了一些建议，但没有任何帮助。

最后，我进入 Web 服务器（IIS 服务器）并更改了服务器“C:\Windows\Temp”目录的权限，以赋予“Everyone”用户完全的读写权限。

然后，最后，异常消失了，我的用户可以从应用程序下载文件。呸！

# asp.net-mvc - ASP.NET MVC 与时代精神

> ID：55414
> 
> 赞同：5
> 
> 时间：2008-09-10T22:11:24.583
> 
> 标签：asp.net-mvc, model-view-controller, zend-framework

ASP.NET MVC 似乎是一个相当大的入口。谁能总结一下它的 MVC 实现如何与其他语言的流行 MVC 框架相媲美？（我特别想的是 Rails 和 Zend 框架，虽然显然有很多。）关于学习曲线、常用术语、易用性和感觉良好因素的观察。

（为了了解一点背景知识，我已经避免使用 ASP.NET 有一段时间了，因为我真的很讨厌 webforms 方法，但是 Jeff 在播客上的大量赞美几乎说服了我试一试。）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-17T12:42:58.790

我刚刚进入 ASP.NET MVC，所以这些是一些将其与 Rails 进行比较的早期想法：

**大多数情况下都设法坚持使用静态类型，但代价是一些额外的代码。**
这要么给你温暖的模糊感，要么让你觉得有点束缚，这取决于你对动态打字的感觉。例如，您可以让您的视图期待特定类型的数据（因此可以在编译时检查您的视图）。

**更好地分离框架的各个部分。**
所以 Rails 中没有规定的数据访问机制，例如 ActiveRecord；你可以自由选择你自己的。如果你想要一些便宜的东西，如果你想要更冗长的东西，LINQ 感觉很相似。您可以使用 ASP.NET 的非 WebForms 部分，例如缓存和身份验证。

**仍在玩功能追赶。**
Preview 5 带来了 AcceptVerbs、模型更新器（类似于 Ruby 的 hash.merge）以及更多将表单绑定到模型的方法。感觉在他们检查 Rails 的大部分功能集之前还有更多的事情要做。

我仍然缺少一点 Rails 的自由和优雅（我猜其中大部分归功于 Ruby），但 ASP.NET MVC 确实感觉非常接近。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T01:36:22.077

如果您已经在使用 .NET 惯用语进行编程，那么很容易掌握 MVC 框架中发生的许多事情。另一方面，如果您在开始之前从未关注过 Ruby，那么 Rails 可能很容易上手（当然，在基本层面上）。

不过，您似乎在谈论质量作为 MVC 的问题，在我看来，这两个框架（不能代表 Zend）在分离关注点方面做得很好。

# project-management - 您是否积极管理技术债务？

> ID：55421
> 
> 赞同：23
> 
> 时间：2008-09-10T22:15:23.247
> 
> 标签：project-management, technical-debt

您是否积极管理软件开发项目的[技术债务](http://forums.construx.com/blogs/stevemcc/archive/2007/11/01/technical-debt-2.aspx)，如果是，您是如何做到的？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-10T22:31:53.660

管理技术债务的一个方面是让非技术经理相信您需要分配时间来进行重构和错误修复。

[这是一篇文章，其中包含](https://blog.asmartbear.com/software-quality-mortgage.html)有关如何执行此操作的具体建议。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-10T22:23:53.413

在我们的团队中，我们积极管理技术债务。我们做 Scrum，所以我们根据估计和我们剩余的 sprint 容量为当前迭代或下一次迭代生成一张技术债务卡，它们像功能和错误卡一样被优先考虑。我们还通过跨团队积压的技术债务来管理更大的跨团队债务项目，我们在每个 Scrum 团队的冲刺计划期间优先考虑并注入这些技术债务。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-10T22:56:00.857

如果你想弥补旧罪，我认为安排处理技术债务的时间很重要，但我也认为你不应该养成这种习惯。一旦你清理了烂摊子，你应该避免让你的项目陷入更多的债务，除非你有充分的理由这样做。

像 Mike 建议的那样积极管理它似乎是最合理的方法，但我认为（向您的团队）明确表示您不应该安排时间或计划长期重构是非常重要的。

重构应该是编写代码的自然部分，因此应该包含在您的其他估计和计划中，而不是被视为单独的活动——除非您必须这样做，即出于“历史”原因或因为您有意识地决定实现某些东西给定的方式，然后在以后重新实现它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-11T18:27:18.843

你所做的是**创造一种文化**，除非在极端情况下，否则技术债务是不可接受的。就像只支付现金并仅将信用卡用作绝对最后手段的人一样。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-08-11T11:27:50.507

如果我真的需要积累技术债务，因为我需要现在发布一些东西，我会提交一个关于它的严重错误，所以它得到最高优先级。但这仅适用于极端情况（客户上下跳跃，妻子正在寻找装饰物等）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T10:09:48.607

It depends a lot on the product. When I worked in a field where our code had to be outside-audited it was a planned part of our sprint. PM just asked development what area needed refactoring and it was put in the plan. That's not to say you wouldn't fix the code in the area you were working on, but you wouldn't devote a day to rewriting a mangled chunk of code that worked. Now I'm working in scrum and developers just do it as they work. My impression is that about the same amount of time goes into refactoring work, either way.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-11T18:53:20.727

我同意安德斯的观点。如果您必须建立管理技术债务的系统，这意味着您仍在添加它。通过升级您对“完成”的定义，首先停止负债。

这确实意味着“负债”模块将更难完成。开发人员应该意识到这一点并分配更多的故事点，以便他们将事情“完成”在他们的身后。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-11T19:07:12.163

如果您迟到发布周期，您不想过多地更改代码库。这意味着总会有一些技术债务。我通常为次优的更改编写 FIXME:s，然后在开始为下一个版本实现功能之前处理它们。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-08-11T11:12:12.973

Java Posse 最近介绍了[技术债务](http://javaposse.com/index.php?post_id=513672#)的管理，看起来非常全面。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-04-18T15:59:34.100

在我迄今为止参与的项目中，一些技术债务仅在项目新阶段开始时才“支付”（管理），即在“大发布”或里程碑之后。

技术债务的一个非常重要的方面是它不仅涉及开发人员，还涉及管理。从这个意义上说，我知道处理它的最佳方法是让“非技术项目利益相关者”看到它，一旦他们了解技术债务的含义，他们可能会分配时间和资源来管理技术债务。

本文[讨论](http://www.construx.com/10x_Software_Development/Technical_Debt/)了几种类型的技术债务，哪些可能是健康的，特别是如何管理和跟踪技术债务负担。

# c# - 如何解析相对时间？

> ID：55434
> 
> 赞同：12
> 
> 时间：2008-09-10T22:27:51.143
> 
> 标签：c#, parsing, time, language-agnostic

这个问题是问题的另一面，“[我如何计算相对时间？](https://stackoverflow.com/questions/11/how-do-i-calculate-relative-time) ”。

给定相对时间的一些人工输入，你如何解析它？默认情况下，您将从 偏移`DateTime.Now()`，但可以选择从另一个偏移`DateTime`。

（首选 C# 中的答案）

示例输入：

*   “在 20 分钟内”
*   “5小时前”
*   “3 小时 2 米”
*   “下周”

**编辑：** 假设我们可以对输入定义一些限制。这种代码在网络上将是一件有用的事情。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-10T23:05:47.727

谷歌搜索会[找到 parsedatetime](http://code.google.com/p/parsedatetime/)库（与[Chandler 项目](http://chandlerproject.org/)相关联），它就是专门为此而设计的。它是开源的（Apache 许可）并用 Python 编写。它似乎相当复杂——来自主页：

> parsedatetime 能够解析，例如，以下内容：
> 
> ```
> * Aug 25 5pm
> * 5pm August 25
> * next saturday
> ...
> * tomorrow
> * next thursday at 4pm
> * at 4pm
> * eod
> * in 5 minutes
> * 5 minutes from now
> * 5 hours before now
> * 2 days from tomorrow 
> ```

由于它是用纯 Python 实现的，并且没有使用任何花哨的东西，因此它很有可能与[IronPython](http://www.codeplex.com/Wiki/View.aspx?ProjectName=IronPython)兼容，因此您可以将它与 .net 一起使用。如果你特别想要一个 C# 解决方案，你可以根据他们使用的算法编写一些东西......

它还带有一大堆单元测试。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-10T22:39:07.120

那是为日期处理构建 DSL（领域特定语言）。我不知道是否有人为 .NET 做过一个，但 DSL 的构建相当简单：

1.  精确定义语言，您将接受哪些输入形式以及您将如何处理歧义
2.  构建语言的语法
3.  构建将您的语言解析为可操作 AST 的有限状态机

您可以自己完成所有这些操作（例如，借助[Dragon Book](http://en.wikipedia.org/wiki/Compilers:_Principles,_Techniques,_and_Tools)）或借助相关工具，如此[链接](http://www.codeproject.com/KB/recipes/YourFirstDSL.aspx)所示。

只需认真思考一下可能性，在好的 UI 示例的帮助下，您就有很大的机会覆盖您的应用程序将收到的实际输入的一半以上。如果您的目标是接受人类可能键入的所有内容，您可以记录被确定为模棱两可的输入，然后将它们添加到语法中，只要它们可以被解释，因为有些东西本质上是模棱两可的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-10T23:08:30.920

ruby 人试图用一个叫做**Chronic**的解析器来解决这个问题。

*   [慢性 RDocs](http://chronic.rubyforge.org/)
*   [GitHub 上的慢性病](http://github.com/mojombo/chronic/tree/master)

我最近观看了一段内容丰富的视频演示，介绍了作者如何解决这个问题。

*   [慢性介绍（圣地亚哥红宝石旅）](http://podcast.sdruby.com/2006/10/3/episode-008-chronic)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-10T23:12:52.500

这可能不是那么有帮助，因为你在谈论 c#，但由于没有人提到它，你可以尝试看看 php 的优秀且完全疯狂的原生[strtotime](http://us2.php.net/strtotime)函数

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-10T23:03:30.590

这：[http](http://www.codeproject.com/KB/edit/dateparser.aspx) ://www.codeproject.com/KB/edit/dateparser.aspx 与您要完成的任务相当接近。不是最优雅的解决方案，但肯定可以为您节省一些工作。

# .net - 使用 Microsoft 的应用程序块

> ID：55437
> 
> 赞同：4
> 
> 时间：2008-09-10T22:30:38.217
> 
> 标签：.net, design-patterns, application-blocks

我没有做过很多 .NET 编程，但我检查了一些由 Microsoft 的模式和实践组发布的应用程序块。我想知道这些通常是如何使用的：

*   直接链接到应用程序
*   添加到应用程序并使用它们构建的源代码，也许还有一些自定义
*   编写特定于应用程序的代码时用作参考的示例代码

我确信这三种用法都很常见，但最典型的使用模式是什么？

是否有一些特定的应用程序块被“每个人”使用？

[注意：这个问题与Enterprise Library Application Blocks OR Home Grown Framework](https://stackoverflow.com/questions/53065/enterprise-library-application-blocks-or-home-grown-framework)相关，但不一样？.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T21:41:47.303

我已经广泛使用了 Microsoft 的企业库。如果可能，它们通常不应该包含在您的项目中。编译的额外成本可能很高。此外，没有理由让您的项目中的源代码使用这些类。只要您在项目中添加对 DLL 的引用，您仍然会在编码期间获得智能。还建议避免在您的开发人员环境中浮动多个代码库。如果您需要自定义类，请在自己的解决方案中打开它们并保持一个版本处于活动状态。当然，如果您需要回滚更改，我总是强烈建议使用版本控制（VSS 或 Subversion）。

对于通常编码更好的 Microsoft 类，还有一些开源替代品（即 Log4Net、nUnit 等）。Microsoft 代码往往臃肿且效率低下。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-10T22:35:48.190

我通常将源代码放入我的项目中，然后我可以获得更好的智能感知（以及对它们的更好理解）。不过，我根本不倾向于定制它们。我喜欢让它们有库存，这样我就可以在需要时随时分发库存二进制文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-10T22:46:21.067

我已经尝试了 Enterprise Lib 3.1（2007 年 5 月）的几个应用程序块，这里有一些评论：

缓存应用程序块：在简单场景（如内存缓存）中不如 System.Web.Caching 有趣 异常处理和日志记录：过于复杂。NLog 或 Log4Net 是更好的解决方案。

我查看了其他 Blocks，但它们似乎不适合我们的项目。

最后，我们完全放弃了 EntLib，因为定制起来很痛苦……我建议你真正考虑一个比 EntLib 更不单一的解决方案。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-10T23:05:36.263

我们只是将 EntLib 3.1 二进制文件放在全局程序集缓存中，并在我们的项目中添加引用。不过，我们通常只使用日志框架。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-10T22:51:49.540

我认为最方便的方法是将 App blocks\EntLib 添加为解决方案项。这样，您每次构建项目时都不会重新编译它们（它们根本不会参与构建过程），并且您可以轻松访问它们的源代码\设置断点等。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-08-30T18:46:46.223

我们通过添加对 DLL 的引用来使用这些块，确保设置了“本地复制”，以便将它们与应用程序一起部署到应用程序的 bin 文件夹中。这意味着我们不必与 GAC 混为一谈 - 简单得多！

调试时，Visual Studio 仍然可以单步执行源代码，即使它没有直接包含在您的项目中，只要您的硬盘上某处有 EntLib 源代码。它会在第一次使用时提示您输入位置，然后记住它。

我们目前使用 Caching、Exception 和 Logging 块。我们还没有想到其余的用例。

# java - 在 C++ 中使用模板检查继承

> ID：55440
> 
> 赞同：2
> 
> 时间：2008-09-10T22:35:06.913
> 
> 标签：java, c++, templates

我有一个类，它是围绕另一个实现所需功能的类的包装类（用作公共接口）。所以我的代码看起来像这样。

```
template<typename ImplemenationClass> class WrapperClass {
// the code goes here
} 
```

现在，我如何确保`ImplementationClass`只能从一组类派生，类似于 java 的泛型

```
<? extends BaseClass> 
```

句法？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-10T22:43:38.140

它很冗长，但你可以这样做：

```
#include <boost/utility/enable_if.hpp>
#include <boost/type_traits/is_base_of.hpp>

struct base {};

template <typename ImplementationClass, class Enable = void>
class WrapperClass;

template <typename ImplementationClass>
class WrapperClass<ImplementationClass,
      typename boost::enable_if<
        boost::is_base_of<base,ImplementationClass> >::type>
{};

struct derived : base {};
struct not_derived {};

int main() {
    WrapperClass<derived> x;

    // Compile error here:
    WrapperClass<not_derived> y;
} 
```

这需要一个对标准有良好支持的编译器（最新的编译器应该没问题，但旧版本的 Visual C++ 不行）。有关详细信息，请参阅[Boost.Enable_If 文档](http://www.boost.org/doc/libs/1_36_0/libs/utility/enable_if.html)。

正如 Ferruccio 所说，一个更简单但功能更弱的实现：

```
#include <boost/static_assert.hpp>
#include <boost/type_traits/is_base_of.hpp>

struct base {};

template <typename ImplementationClass>
class WrapperClass
{
    BOOST_STATIC_ASSERT((
        boost::is_base_of<base, ImplementationClass>::value));
}; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-10T22:38:00.603

在目前的情况下，除了通过评论或第三方解决方案之外没有其他好的方法。Boost为此提供了一个[概念检查库](http://www.boost.org/doc/libs/1_36_0/libs/concept_check/concept_check.htm)，我认为gcc也有一个实现。概念在 C++0x 改进列表中，但我不确定您是否可以指定子类型 - 它们更多地用于“必须支持这些操作”，这（大致）等效。

**编辑：**维基百科有这[部分](http://en.wikipedia.org/wiki/C%2B%2B0x#Concepts)关于 C++0x 中的概念，这比草案提案更容易阅读。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T13:41:08.497

请参阅[Stoustrup 自己关于该主题的话](http://www.research.att.com/~bs/bs_faq2.html#constraints)。

基本上是一个小类，您可以在某处实例化，例如模板类构造函数。

```
template<class T, class B> struct Derived_from {
    static void constraints(T* p) { B* pb = p; }
    Derived_from() { void(*p)(T*) = constraints; }
}; 
```

# visual-studio - 跨 Visual Studio 版本迁移旧项目时，最好的方法是什么？

> ID：55448
> 
> 赞同：4
> 
> 时间：2008-09-10T22:45:20.367
> 
> 标签：visual-studio, migration, legacy

我一直在考虑我们内部有多少项目仍在使用 Visual Studio 6 进行开发，以及如何最好地将它们迁移到 Visual Studio 2008。这些项目有 C/C++ 和 VB 的风格。

让 VS2008 将工作空间转换为解决方案、修复任何编译错误并继续你的快乐方式会更好吗？或者，最好从一个干净的解决方案开始，然后通过项目丢弃死代码来跨项目迁移代码？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-10T23:09:39.887

Microsoft p&p 团队推荐了一些[策略](http://msdn.microsoft.com/en-us/library/ms978506.aspx)来回答这个问题。基本上，他们推荐您提到的项目方法。当然，他们假设的应用程序架构简洁，没有令人讨厌的、黑暗的角落，深夜的编码和大量的咖啡都是从那里涌现出来的。

让 VS2008 为您转换项目并查看修复错误需要多少努力并没有什么坏处。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-10T23:27:50.017

几年前，当我不得不将一个 VB6 应用程序转换为 VS2003 时，我运行了转换器，它产生了一些基本上可以编译的东西，但根本不是很好。我最终不得不修改它生成的一大块代码。

我将从一个干净的解决方案开始，然后在项目上运行转换器并仅复制您需要的代码。我注意到 VB6 项目和转换后的 VB.NET 项目 (WinForm) 之间的最大区别之一是内置控件。转换器会尝试保留您正在使用的控件类型，即使它们是旧的和过时的。因此，通过使用现代控件（文本框、选项卡控件等）创建新表单，然后复制您需要的代码，您可能会得到更好的服务。

# version-control - 你能在 Perforce 中“忽略”一个文件吗？

> ID：55449
> 
> 赞同：103
> 
> 时间：2008-09-10T22:45:31.193
> 
> 标签：version-control, perforce, ignore

我有时会使用 Perforce 的 P4V IDE 中的“协调离线工作...”功能来同步我在与 P4 库断开连接时一直在处理的所有文件。它启动另一个执行“文件夹差异”的窗口。

我有我不想签入源代码管理的文件（例如在 bin 文件夹中找到的文件，例如 DLL、代码生成的输出等）。有没有办法过滤这些文件/文件夹，使其不显示为“新”，这可能是添加。它们往往会弄乱我真正感兴趣的文件列表。P4 是否具有与 Subversion 的“忽略文件”功能等效的功能？

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-09-10T23:48:48.123

从 2012.1 版本开始，Perforce 支持`P4IGNORE`环境变量。我更新了我对[这个关于忽略目录](https://stackoverflow.com/a/3103898/4228)的问题的回答，并解释了它是如何工作的。然后我注意到了这个答案，我想这现在是多余的。

* * *

假设您有一个名为“CLIENT”的客户端，一个名为“foo”的目录（位于您的项目根目录），并且您希望忽略该目录树中的所有 .dll 文件，您可以在工作区视图中添加以下行来完成这：

```
-//depot/foo/*.dll //客户端/foo/*.dll
-//depot/foo/.../*.dll //CLIENT/foo/.../*.dll

```

第一行将它们从目录“foo”中删除，第二行将它们从所有子目录中删除。现在，当您“协调离线工作...”时，所有 .dll 文件将被移动到文件夹差异显示底部的“排除文件”文件夹中。它们不会妨碍您，但如果您确实需要，仍然可以查看和操作它们。

您也可以采用另一种方式，这会将您的“排除文件”文件夹减少到一个，但您将无法操作其中包含的任何文件，因为路径将被损坏（但如果您只是想要它们你的方式，没关系）。

```
-//depot/foo.../*.dll //CLIENT/foo.../*.dll

```

* * *

## 回答 #2

> 赞同：52
> 
> 时间：2012-10-29T17:17:09.400

对，但是。

Perforce 版本 2012.1 添加了一个名为[p4ignore](http://www.perforce.com/blog/120130/new-20121-p4ignore)的功能，受 Git 的启发。然而，Perforce 开发人员在没有正当理由的情况下对行为进行了更改，这恰好使该功能变得不那么有用。

虽然 Git 从所有[`.gitignore`](https://www.kernel.org/pub/software/scm/git/docs/gitignore.html)文件中获取规则，但 Perforce 不知道在哪里查找，直到您在环境变量中指定文件名`P4IGNORE`。这种自由是一种诅咒。您不能破解两个使用不同名称作为其忽略文件的存储库。

此外，Perforce 的忽略功能也无法解决问题。您可以为自己轻松设置它，但除非他们明确选择加入，否则其他人不会受益。没有提交的贡献者可能会意外提交不受欢迎的文件（例如`bin`，由构建脚本创建的文件夹）。

Git 的忽略功能很棒，因为它开箱即用。如果将`.gitignore`文件添加到存储库（[每个人都这样做](https://github.com/search?q=extension%3A.gitignore)），他们将为每个人解决问题。没有人会意外地公开他们的私钥。

有趣的是，[Perforce 文档](http://www.perforce.com/perforce/doc.current/manuals/cmdref/env.P4IGNORE.html)显示 '.p4ignore' 作为示例忽略规则，这是倒退的！如果规则有用，则应将它们作为存储库的一部分进行共享。

* * *

Perforce 仍然可以很好地利用该功能。为文件名选择一个约定，比如`p4ignore.txt`，这样该功能就可以发挥作用。删除`P4IGNORE`环境变量，它会适得其反。编辑文档，鼓励开发者分享有用的规则。让用户在其主文件夹中的文件中写入个人规则，[就像 Git 一样](https://www.kernel.org/pub/software/scm/git/docs/gitignore.html)。

如果你认识 Perforce 的任何人，请给他们发邮件。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2012-02-15T00:41:15.687

这适用于 Perforce 2013.1，新的 P4IGNORE 机制首次添加到版本 2012.1，在 Perforce 博客中描述：

> [https://www.perforce.com/blog/new-20121-p4ignore](https://www.perforce.com/blog/new-20121-p4ignore)

正如目前所描述的，您将环境变量“P4IGNORE”设置为包含要忽略的文件列表的文件名。

所以你可以检查一下，看看你喜欢它。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2010-06-11T08:03:27.370

如果您想要一个适用于所有工作空间而无需复制的解决方案，您（或您的系统管理员）可以通过使用 p4 保护表中的以下行来拒绝提交这些文件类型：

```
write user * * -//.../*.suo
write user * * -//.../*.obj
write user * * -//.../*.ccscc 
```

我记得以前做过这个，但我没有必要的权限在这里测试这个。查看[Perforce 的系统管理员指南](http://www.perforce.com/perforce/doc.092/manuals/p4sag/p4sag.pdf)并尝试一下

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2012-03-02T18:10:38.537

从 2011.1 版开始，Perforce Streams 使忽略文件变得更加容易。根据[文档，](http://www.perforce.com/perforce/doc.current/manuals/cmdref/stream.html)您可以忽略目录中的某些扩展名或某些路径。

从`p4 help stream`

```
Ignored: Optional; a list of file or directory names to be ignored in
                 client views. For example:

                     /tmp      # ignores files named 'tmp'
                     /tmp/...  # ignores dirs named 'tmp'
                     .tmp      # ignores file names ending in '.tmp'

                 Lines in the Ignored field may appear in any order.  Ignored
                 names are inherited by child stream client views. 
```

这基本上完成了@raven 的回答所指定的操作，但使用流更容易完成，因为它使用该流自动传播到每个工作空间。它也适用于从您指定忽略类型的流继承的任何流。

您可以通过`p4 stream //stream_depot/stream_name`或右键单击 p4v 的流视图中的流来编辑流。

正如@svec 所指出的，为每个工作区指定忽略文件的功能即将推出，实际上是在[P4 2012.1 beta 中。](http://www.perforce.com/blog/120130/new-20121-p4ignore)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-11T13:11:55.010

Will 的使用建议`.p4ignore`似乎只适用于 WebSphere Studio (P4WSAD) 插件。我只是在我的本地 windows 框上尝试过，我列出的任何文件和目录都*没有*被忽略。

Raven 修改客户规范的建议是 Perforce 下的正确方法。正确组织您的代码/数据/可执行文件和生成的输出文件将使从检查中排除文件的过程更加容易。

作为一种更严格的方法，您始终可以编写一个提交触发器，如果​​更改列表包含某个文件或具有某个扩展名的文件等，它将拒绝提交更改列表。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2010-10-07T16:16:35.793

历史答案 - 不再正确。在最初写这篇文章的时候，这是真的；

您不能写入和签入​​服务器将用来制定忽略规则的文件；perforce 中的一般 glob 或正则表达式文件模式忽略。

其他答案具有全局的全局服务器配置（而不是每个文件夹）。其他答案显示了可能对您有用的东西，如果您希望每个文件夹中的一行乘以您想在该单个文件夹中忽略的扩展数，或者仅在 WebSphere Studio 插件中提供此功能，或者为服务器提供功能管理员，但对用户不可用。

简而言之，我发现 Perforce 在这方面真的很弱。虽然我很欣赏那些使用 Eclipse 插件的人可以使用`.p4ignore`.，而且我认为这很棒，但它让我们这些不使用 Eclipse 插件的人一头雾水。

更新：请参阅 2012 年年中添加的新 P4IGNORE 功能的已接受答案。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-02-11T19:10:14.897

我发现使用像这样的 BASH 脚本最容易协调离线工作：

```
#!/bin/bash
# reconcile P4 offline work, assuming P4CLIENT is set
if [ -z "$P4CLIENT" ] ; then echo "P4CLIENT is not set"; exit 1; fi
unset PWD # confuses P4 on Windows/CYGWIN

# delete filew that are no longer present
p4 diff -sd ... | p4 -x - delete

# checkout files that have been changed.  
# I don't run this step.  Instead I just checkout everything, 
# then revert unchanged files before committing.
p4 diff -se ... | pr -x - edit

# Add new files, ignoring subversion info, EMACS backups, log files
# Filter output to see only added files and real errors
find . -type f \
 | grep -v -E '(\.svn)|(/build.*/)|(/\.settings)|~|#|(\.log)' \
 | p4 -x - add \
 | grep -v -E '(currently opened for add)|(existing file)|(already opened for edit)' 
```

我改编自[这篇 Perforce 知识库文章](http://kb.perforce.com/article/2)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-07-26T14:00:24.150

我也在寻找类似 .p4ignore 的解决方案（而不是与特定 IDE 绑定的解决方案）。到目前为止，我发现的最接近的是 p4delta。听起来它将完全按照原始海报的要求进行，尽管通过另一层间接。

[http://p4delta.sourceforge.net](http://p4delta.sourceforge.net)

不幸的是，虽然这似乎确实产生了正确的文件列表，但我无法让“p4delta --execute”工作（“无法修改冻结的字符串”）并且该项目一年内没有更新。也许其他人会有更好的运气。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2010-01-25T09:43:35.517

如果您使用的是 Eclipse Perforce 插件，那么[插件文档](http://perforce.com/perforce/doc.091/manuals/p4wsad/topics/adding.html)列出了几种忽略文件的方法。

# c# - 您将使用哪种 C# 项目类型来重新开发 MFC C++ activex 控件？

> ID：55451
> 
> 赞同：0
> 
> 时间：2008-09-10T22:47:35.650
> 
> 标签：c#, c++, visual-studio, code-migration

查看 VS2008 中的 C# 项目模板，提供 WPF 用户控件库、WPF 自定义控件库和 Windows 窗体控件库。如果您想将用 C++ 编写的旧式活动控件移入 C# 和 .NET 的世界，您会使用哪一个？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-10T23:10:50.900

听起来你正试图同时做几件不同的事情：

1.  将您的代码迁移到在较新版本的 Visual Studio 中构建。
2.  将您使用的技术迁移到更新的技术（ActiveX 到 .net）
3.  迁移您的语言（c++ 到 c#）。

如果你有一个小的代码库，你可能也可以从头开始，并根据需要将功能移植到新的代码库中。

对于更大的代码库，您需要意识到这在工作量和缺陷率方面都是一项昂贵的任务。

一个订单可能是：

1.  将您的代码导入到较新版本的 Visual Studio 中。得到它编译。查看每个项目的项目设置。
2.  重构您的代码以尽可能地隔离 mfc 和 activex 代码。遵循良好的重构实践，尤其是在开始之前没有很多单元测试的情况下。
3.  考虑用 .net 替换您的 ActiveX 层。
4.  考虑哪个 GUI 工具包最适合替换 MFC。
5.  语言 - 考虑首先迁移到托管 c++。
6.  考虑从托管 c++ 迁移到 c#。

Most importantly be able to justify doing all of the above!

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-10T22:55:49.983

没有可以为您执行此操作的项目模板。您不妨阅读并从用户控件开始。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-10T23:00:29.177

您必须考虑将托管该控件的目标应用程序。如果它是一个业务应用程序，我[听说](http://wpf.netfx3.com/blogs/presentation_bloggers/archive/2007/08/30/wpf-for-biz-apps-or-not.aspx)WPF 并没有提供比 Forms 更大的优势。然而，根据[这篇](http://hestia.typepad.com/flatlander/2007/08/should-i-use-wp.html)博客文章，作者认为杀手级 WPF 是一个 LOB 应用程序，它利用 WPF 提供的图形功能进行数据可视化。

最后，我想这是一个成本/收益分析。您是走 WPF 路线并为图形数据可视化的未来利益付出学习曲线的成本，还是坚持久经考验的方法并冒着开发过时应用程序的风险。

# mime-types - 电子邮件消息的可能 mimetype 层次结构是什么？

> ID：55460
> 
> 赞同：0
> 
> 时间：2008-09-10T22:57:22.647
> 
> 标签：mime-types, html-email, email, email-validation

我正在使用一个递归调用自身并尝试`text/html`从电子邮件（如果存在）中提取 MIME 类型部分以进行进一步处理的代码片段。

“text/html”可能存在于其他内容中，例如`multipart/alternative`，所以我试图找出是否有定义的电子邮件 MIME 类型层次结构。

有谁知道是否有以及它是什么？即哪些类型可以作为其他类型的父对象？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T00:03:34.190

理论上，只有 multipart/ 和 message/ 可以作为其他类型的父级（根据 RFC2046）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-10T23:03:43.740

您的问题假定邮件客户端遵循 MIME 编码的 RFC 标准，而他们没有。我建议您从来源收集大量邮件，并尝试按原样处理它们。您面临的问题很难（也许不可能）100% 解决。

# php - 我应该使用一个大的 SQL Select 语句还是几个小的 SQL Select 语句？

> ID：55463
> 
> 赞同：18
> 
> 时间：2008-09-10T23:02:40.653
> 
> 标签：php, mysql, performance, optimization

我正在使用从 MySQL 发送的数据构建一个 PHP 页面。

是不是更好

*   1 个`SELECT`带有 4 个表连接的查询，或者
*   `SELECT`4 个没有表连接的小查询；我确实从 ID 中选择

哪个更快，每种方法的优缺点是什么？我只需要每个表中的一行。

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-10T23:08:36.490

如果您真的担心，您应该运行一个分析工具，因为它取决于很多事情并且它可能会有所不同，但通常最好编译更少的查询和更少的数据库往返。

确保尽可能使用 where 和 join on 子句过滤事物。

但老实说，这通常无关紧要，因为与数据库可以做的相比，您可能不会受到那么大的打击，所以除非优化是您的规范，否则您不应该过早地做它并做最简单的事情。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-10T23:07:03.310

通常，最好有一个 SELECT 语句。拥有数据库的主要原因之一是它们处理信息的速度很快，特别是在查询格式的情况下。

如果这种方法有任何缺点，那就是有些类型的分析无法用一个大的 SELECT 语句来完成。RDBMS 纯粹主义者会坚持认为这是一个数据库设计问题，在这种情况下，您将回到我最初的建议。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-11T00:14:55.487

当您使用 JOIN 而不是多个查询时，您允许数据​​库应用其优化。您还可能会检索不需要的行（如果您要用多个选择替换 INNER 联接），这会增加您的应用程序服务器和数据库服务器之间的网络流量。即使它们在同一个盒子上，这也很重要。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-11T00:18:12.967

这可能取决于您从数据库中获取数据后如何处理数据。如果您独立使用这四个结果中的每一个，那么拥有四个单独的 SELECT 语句会更加合乎逻辑和清晰。另一方面，如果您将所有数据一起使用，例如在表中创建统一的行之类的，那么我会使用单个 SELECT 和 JOIN。

我做了一些 PHP/MySQL 的工作，我发现即使对于包含大量 JOIN 的大型表的查询，数据库也非常擅长优化——如果你有智能索引的话。因此，如果您对性能很认真，请开始阅读[查询优化和索引](http://www.informit.com/articles/article.aspx?p=377652)。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-10T23:07:15.883

我会说 1 查询与联接。这样，您只需访问服务器一次。如果你的表是用索引连接的，它应该很快。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T00:29:30.663

好吧，在 Oracle 下，您希望利用查询缓存，如果您在顺序处理中有很多小查询，如果最后一个查询将第一个查询从缓存中推出，那就太糟糕了......正好让您在下一次循环中循环并再次运行第一个查询（显然使用不同的参数值）。

我们正在使用 Java 存储过程构建 XML 输出文件，并且肯定发现每个单独查询的往返时间都在吞噬我们。我们发现在尽可能少的查询中获取所有数据，然后根据需要将这些值插入 XML DOM 会快得多。

唯一的缺点是 Java 代码不太优雅，因为数据获取现在远离它的使用。但是我们必须在尽可能接近零的时间内生成一个大型的复杂 XML 文件，因此我们必须优化速度。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-13T00:41:35.157

但是，在处理合并表时要小心。根据我的经验，尽管在大多数情况下单个连接可能很好，但当涉及合并表时，您可能会遇到奇怪的情况。

# c# - 仅在发布模式下卸载命令失败

> ID：55482
> 
> 赞同：3
> 
> 时间：2008-09-10T23:16:32.867
> 
> 标签：c#, installation, service

我能够通过命令行和自定义 Inno Setup 安装程序成功卸载第三方应用程序。

命令行执行：

```
MSIEXEC.exe /x {14D74337-01C2-4F8F-B44B-67FC613E5B1F} /qn 
```

Inno 设置命令：

```
[Run]
Filename: msiexec.exe; Flags: runhidden waituntilterminated; 
Parameters: "/x {{14D74337-01C2-4F8F-B44B-67FC613E5B1F} /qn";
StatusMsg: "Uninstalling Service..."; 
```

在调试模式下执行以下 C# 代码时，我还能够以编程方式卸载应用程序。

C#代码：

```
string fileName = "MSIEXEC.exe";
string arguments = "/x {14D74337-01C2-4F8F-B44B-67FC613E5B1F} /qn";

ProcessStartInfo psi = new ProcessStartInfo(fileName, arguments)
{
    CreateNoWindow = true,
    UseShellExecute = false,
    RedirectStandardOutput = true
};

Process process = Process.Start(psi);
string errorMsg = process.StandardOutput.ReadToEnd();
process.WaitForExit(); 
```

但是，当作为已编译、部署的 Windows 服务运行时，相同的 C# 代码会产生以下失败输出：

```
"This action is only valid for products that are currently installed." 
```

补充评论：

*   发出卸载命令的 Windows 服务与在调试模式下测试的代码在同一台机器上运行。Windows 服务正在以本地系统帐户运行/登录。
*   我查阅了我的应用程序日志，并验证了在调试和发布模式下执行的命令参数是相同的。
*   我已经咨询了事件查看器，但它没有提供任何线索。

想法？任何帮助将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-10T23:34:31.293

**步骤 1：** [检查 MSI 错误日志文件](https://stackoverflow.com/questions/15109/visual-studio-2005-setup-project-install-crashes-over-terminal-server#15286)

我怀疑您的问题是由于作为 LocalSystem 运行造成的。

本地系统帐户与恰好具有管理员权限的普通用户帐户不同。它无法访问网络，而且它与注册表和文件系统的交互也完全不同。

从内存中读取/写入注册表下的“主目录”或 HKCU 的任何请求实际上都会进入默认用户配置文件，或者在临时目录的情况下，`c:\windows\temp`

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T00:47:41.960

我过去在安装时遇到过类似的问题，客户使用 SYSTEM 帐户进行安装，这导致非管理用户出现各种权限问题。

如果应用程序没有出现“已安装”，MSI 日志文件并没有真正的帮助，我建议从捕获`MSIINV.EXE`系统帐户下的输出开始，这将为您提供当前安装程序的“清单”（或该用户看到的安装）[http://blogs.msdn.com/brada/archive/2005/06/24/432209.aspx](http://blogs.msdn.com/brada/archive/2005/06/24/432209.aspx)

我认为您可能需要回到绘图板上，看看您是否真的需要 Windows 服务来进行卸载。如果您还没有遇到过各种各样的 Vista UAC 问题，您可能会遇到...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T22:24:15.837

感谢那些提供帮助的人。这似乎是一个权限问题。我已更新我的服务以在管理员帐户下运行，并且它能够成功卸载第三方应用程序。就 Orion 而言，虽然本地系统帐户是一个强大的帐户，可以完全访问系统——http: [//technet.microsoft.com/en-us/library/cc782435.aspx——](http://technet.microsoft.com/en-us/library/cc782435.aspx)但它似乎没有执行卸载的必要权限。

[有关 LocalSystem 能够卸载其安装的应用程序的完整故事，请参阅附加评论。]

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-12T02:32:46.380

这很奇怪。LocalSystem 绝对具有安装应用程序的权限（这就是 Windows 更新和 Active Directory 中的软件部署的工作方式），因此它也应该能够卸载。

也许应用程序最初是按用户而不是按机器安装的？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-12T22:14:17.960

@保罗拉隆德

该应用程序的安装程序包含在自定义 InnoSetup 安装程序中。反过来，InnoSetup 安装程序由登录用户手动执行。也就是说，卸载是由在本地系统帐户下运行的服务触发的。

显然，你在做某事。我进行了一项快速测试，该测试在 LocalSystem 帐户下安装并卸载了应用程序，并且一切正常运行。你是对的。LocalSystem 帐户具有安装它的应用程序所需的卸载权限。你拯救了这一天。感谢您的反馈！

# java - 查找 JNDI 用于错误报告的设置

> ID：55487
> 
> 赞同：1
> 
> 时间：2008-09-10T23:27:17.880
> 
> 标签：java, jndi

我有一个使用 JNDI 维护的 J2SE 应用程序。（它使用 JNDI 来查找它的 J2EE 应用程序服务器。）

它对于找不到 JNDI 服务器的错误报告非常差。

我一直在寻找一种方法来显示 InitialContext 试图与之交谈的服务器。

有没有人有一个巧妙的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T00:54:43.333

报告价值`InitialContext.getEnvironment().get(Context.PROVIDER_URL)`可能会有所帮助。

# c# - 以只读方式返回集合

> ID：55502
> 
> 赞同：21
> 
> 时间：2008-09-10T23:43:35.577
> 
> 标签：c#, .net, multithreading, collections, concurrency

我在多线程环境中有一个对象，它维护着一组信息，例如：

```
public IList<string> Data 
{
    get 
    {
        return data;
    }
} 
```

我目前已`return data;`用 a 包裹`ReaderWriterLockSlim`以保护集合免受共享违规。但是，为了更加确定，我想将集合作为只读返回，以便调用代码无法对集合进行更改，只能查看已经存在的内容。这是可能吗？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-10T23:47:57.783

如果您的基础数据存储为列表，您可以使用[List(T).AsReadOnly](http://msdn.microsoft.com/en-us/library/e78dcd75.aspx)方法。
如果您的数据可以枚举，您可以使用[Enumerable.ToList](http://msdn.microsoft.com/en-us/library/bb342261.aspx)方法将您的集合转换为 List 并在其上调用 AsReadOnly。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2008-09-11T01:45:52.977

如果您唯一的目的是让调用代码不出错，并在它应该只读取所有必要的时候修改集合是返回一个不支持添加、删除等的接口。为什么不返回`IEnumerable<string>`？调用代码必须强制转换，如果不知道他们正在访问的属性的内部结构，他们不太可能这样做。

但是，如果您的意图是阻止调用代码观察来自其他线程的更新，您将不得不回退到已经提到的解决方案，根据您的需要执行深层或浅层复制。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2009-12-18T23:47:34.580

我投票赞成您接受的答案并同意它-但是我可以给您一些考虑吗？

不要直接返回集合。制作一个准确命名的业务逻辑类，以反映集合的目的。

这样做的主要优势在于您不能将代码添加到集合中，因此，只要您的对象模型中有一个本机“集合”，您就总是在整个项目中分布有非 OO 支持代码来访问它。

例如，如果您的收藏是发票，那么您的代码中可能有 3 或 4 个地方迭代未付发票。你可以有一个 getUnpaidInvoices 方法。但是，当您开始考虑诸如“payUnpaidInvoices(payer, account);”之类的方法时，真正的威力就出现了。

当您传递集合而不是编写对象模型时，您将永远不会想到整个类的重构。

另请注意，这使您的问题特别好。如果您不希望人们更改集合，则您的容器不需要包含修改器。如果您稍后决定仅在一种情况下您实际上必须修改它，您可以创建一个安全机制来执行此操作。

当你传递一个原生集合时，你如何解决这个问题？

此外，无法使用额外数据增强本机集合。下次当您发现您将 (Collection, Extra) 传递给不止一两个方法时，您就会认识到这一点。它表示“Extra”属于包含您的收藏的对象。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2008-09-12T17:16:00.720

我认为您在这里混淆了概念。

`ReadOnlyCollection`为现有集合提供只读包装器，允许您（A 类）在知道调用者（B 类）不能修改集合（即不能添加或删除任何元素）的情况下安全地传递**对**集合**的**引用集合。）

绝对没有线程安全保证。

*   如果您（A 类）在将底层集合作为 a 分发后继续修改它，`ReadOnlyCollection`那么 B 类将看到这些更改，使任何迭代器失效等，并且通常对集合的任何常见并发问题持开放态度。
*   此外，如果集合中的元素是可变的，那么您（A 类）**和**调用者（B 类）都将能够更改集合中对象的任何可变状态。

您的实现取决于您的需求： - 如果您不关心调用者（B 类）看到对集合的任何进一步更改，那么您可以克隆集合，分发它，然后停止关心。- 如果您确实需要调用者（B 类）查看对集合所做的更改，并且希望它是线程安全的，那么您手上的问题就更大了。一种可能性是实现您自己的 ReadOnlyCollection 线程安全变体以允许锁定访问，尽管如果您想支持 IEnumerable，这将是不平凡且非执行的，并且它*仍然*不能保护您免受收藏。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-11T00:22:24.860

应该注意[aku](https://stackoverflow.com/questions/55502/return-collection-as-read-only#55507)的答案只会保护列表为只读。列表中的元素仍然非常可写。我不知道是否有任何方法可以保护非原子元素而不克隆它们，然后再将它们放入只读列表。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-21T08:08:52.867

您想使用[yield](http://msdn.microsoft.com/en-us/library/9k7k7cf0.aspx)关键字。您遍历 IEnumerable 列表并使用 yeild 返回结果。这允许消费者在不修改集合的情况下使用 for each。

它看起来像这样：

```
List<string> _Data;
public IEnumerable<string> Data
{
  get
  {
    foreach(string item in _Data)
    {
      return yield item;
    }
  }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-21T07:28:07.507

您可以改用该集合的副本。

```
public IList<string> Data {
get {
    return new List<T>(data);
}} 
```

这样，更新就无所谓了。

# asp.net - 如何注销多个 asp.net 应用程序？

> ID：55503
> 
> 赞同：3
> 
> 时间：2008-09-10T23:44:04.377
> 
> 标签：asp.net, authentication, forms-authentication, asp.net-1.1

我有一个主要的 asp.net 应用程序，它是用 asp.net 1.1 编写的。在应用程序下方运行的是几个 2.0 应用程序。要完全注销用户，我可以使用 FormsAuthentication.SignOut 注销 1.1 应用程序还是比这更复杂？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-11T00:51:29.737

您要执行的操作称为单点登录和单点注销。根据您设置应用程序的方式存在差异。我将尝试澄清这些差异在哪里发挥作用。

要实现单点登录和单点注销，您需要使所有应用程序之间的 cookie 名称、保护和路径属性相同。

```
<authentication mode="Forms">
    <forms name=".cookiename"
           loginUrl="~/Login.aspx" 
           timeout="30" 
           path="/" />
</authentication> 
```

接下来，您需要添加机器密钥，并且它们在所有应用程序之间必须相同。

```
<machineKey validationKey="F9D1A2D3E1D3E2F7B3D9F90FF3965ABDAC304902"
            encryptionKey="F9D1A2D3E1D3E2F7B3D9F90FF3965ABDAC304902F8D923AC"
            validation="SHA1" /> 
```

您在为应用程序使用二级或三级域吗？如果是这样，您将需要通过将域添加到 cookie 来做更多的事情：

```
protected void Login(string userName, string password)
{
    System.Web.HttpCookie cookie = FormsAuthentication.GetAuthCookie(userName, False);
    cookie.Domain = "domain1.com";
    cookie.Expires = DateTime.Now.AddDays(30);
    Response.AppendCookie(cookie);
} 
```

现在要进行单点注销，调用 FormsAuthentication.SignOut 可能还不够。下一个最好的方法是将 cookie 过期设置为过去的日期。这将确保 cookie 不会再次用于身份验证。

```
protected void Logout(string userName)
{
    System.Web.HttpCookie cookie = FormsAuthentication.GetAuthCookie(userName, False);
    cookie.Domain = "domain1.com";
    cookie.Expires = DateTime.Now.AddDays(-1);
    Response.AppendCookie(cookie);
} 
```

我考虑到您对所有应用程序都使用相同的数据库。如果应用程序使用单独的数据库进行注册和身份验证，那么我们将需要做更多的事情。如果是这种情况，请告诉我。否则这应该适合你。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T00:26:15.787

如果您为所有应用程序都拥有一个中央会话存储，这可能会更容易。然后，您可以在一处将会话设置为空。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-17T12:34:01.927

这对我有用：

在 Logout 事件中，使用 Request 对象中的 Cookies 集合代替 FormsAuthentication.GetAuthCookie 方法，如下所示：

```
HttpCookie cookie = Request.Cookies.Get(otherSiteCookieName);
cookie.Expires = DateTime.Now.AddDays(-1);
HttpContext.Current.Response.Cookies.Add(cookie); 
```

当然，这需要您知道您希望用户退出的站点的 Cookie 名称 - 但是，如果您在所有 Web 应用程序中使用相同的 cookie，这将不是问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-30T15:43:02.883

我更喜欢使用 web.config

```
<authentication mode="Forms">
    <forms domain=".tv.loc" loginUrl="~/signin" timeout="2880" name="auth" />
</authentication> 
```

# sql-server - 如何有条件地在 SQL Server 中创建存储过程？

> ID：55506
> 
> 赞同：25
> 
> 时间：2008-09-10T23:45:27.617
> 
> 标签：sql-server, stored-procedures

作为我的集成策略的一部分，我运行了一些 SQL 脚本来更新数据库。所有这些脚本做的第一件事就是检查它们是否需要运行，例如：

```
if @version <> @expects
    begin
        declare @error varchar(100);
        set @error = 'Invalid version. Your version is ' + convert(varchar, @version) + '. This script expects version ' + convert(varchar, @expects) + '.';
        raiserror(@error, 10, 1);
    end
else
    begin
        ...sql statements here...
    end 
```

效果很好！除非我需要添加存储过程。“create proc”命令必须是一批sql命令中唯一的命令。在我的 IF 语句中添加“create proc”会导致此错误：

```
'CREATE/ALTER PROCEDURE' 必须是查询批处理中的第一条语句。

```

哎哟! 如何将 CREATE PROC 命令放入我的脚本中，并仅在需要时才执行？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-09-11T00:16:51.100

这是我想出的：

将其包装在 EXEC() 中，如下所示：

```
if @version <> @expects
    begin
        ...snip...
    end
else
    begin
        exec('CREATE PROC MyProc AS SELECT ''Victory!''');
    end 
```

奇迹般有效！

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2016-04-15T12:00:39.647

SET NOEXEC ON 是关闭部分代码的好方法

```
IF NOT EXISTS (SELECT * FROM sys.assemblies WHERE name = 'SQL_CLR_Functions')
  SET NOEXEC ON
GO
CREATE FUNCTION dbo.CLR_CharList_Split(@list nvarchar(MAX), @delim nchar(1) = N',')
RETURNS TABLE (str nvarchar(4000)) AS EXTERNAL NAME SQL_CLR_Functions.[Granite.SQL.CLR.Functions].CLR_CharList_Split
GO
SET NOEXEC OFF 
```

在这里找到： [https ://codereview.stackexchange.com/questions/10490/conditional-create-must-be-the-only-statement-in-the-batch](https://codereview.stackexchange.com/questions/10490/conditional-create-must-be-the-only-statement-in-the-batch)

PS 另一种方法是 SET PARSEONLY { ON | 离开 }。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-11T03:40:40.767

但请注意存储过程中的单引号 - 它们需要通过添加第二个引号来“转义”。第一个答案已经做到了，但以防万一你错过了。年轻球员的陷阱。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-11T04:26:41.700

对数据库进行版本控制是可行的方法，但是……为什么有条件地创建存储过程。对于视图、存储过程、函数，只需有条件地删除它们并每次重新创建它们。如果您有条件地创建，那么您将不会清理有问题或 2 年前由另一个开发人员（您或我永远不会这样做）放入的数据库，他确信他会记得删除一次紧急更新。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-08T16:15:35.400

删除和创建的问题是您丢失了以前应用于被删除对象的任何安全授权。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-02-21T18:49:23.970

这是一个旧线程，但 Jobo 是不正确的： Create Procedure 必须是批处理中的第一条语句。因此，您不能使用`Exists`来测试存在，然后使用`Create`or `Alter`。遗憾。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2019-07-19T14:59:01.403

更改现有的存储过程要好得多，因为可能会添加已添加的属性和权限，并且如果删除了存储过程，这些属性和权限将丢失。

因此，测试它是否不存在，如果不存在则创建一个虚拟 proc。然后之后使用alter 语句。

```
IF NOT EXISTS(SELECT * FROM sysobjects WHERE Name = 'YOUR_STORED_PROC_NAME' AND xtype='P')
EXECUTE('CREATE PROC [dbo].[YOUR_STORED_PROC_NAME] as BEGIN select 0 END')
GO
ALTER  PROC [dbo].[YOUR_STORED_PROC_NAME]
.... 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T08:15:15.130

我必须承认，我通常会同意@Peter - 我每次都有条件地放弃然后无条件地重新创建。过去，在尝试猜测数据库之间的架构差异时，无论有没有任何形式的版本控制，我都被抓住了太多次。

话虽如此，您自己的建议@Josh 很酷。当然很有趣。:-)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2018-04-04T10:20:59.040

我的解决方案是检查proc是否存在，如果存在则删除它，然后创建proc（与@robsoft的答案相同，但有一个例子......）

```
IF EXISTS(SELECT * FROM sysobjects WHERE Name = 'PROC_NAME' AND xtype='P') 
BEGIN
    DROP PROCEDURE PROC_NAME
END
GO
CREATE PROCEDURE PROC_NAME
    @value  int
AS
BEGIN
    UPDATE  SomeTable
    SET     SomeColumn = 1
    WHERE   Value = @value
END
GO 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-01-14T05:03:37.227

```
IF NOT EXISTS(SELECT * FROM sys.procedures WHERE name = 'pr_MyStoredProc')
BEGIN

     CREATE PROCEDURE pr_MyStoredProc AS .....
     SET NOCOUNT ON
END

ALTER PROC pr_MyStoredProc
AS
SELECT * FROM tb_MyTable 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-01-14T05:05:36.693

使用 T-SQL 中的“Exists”命令查看存储的过程是否存在。如果是，请使用“Alter”，否则使用“Create”

# c++ - 函数级静态变量何时分配/初始化？

> ID：55510
> 
> 赞同：93
> 
> 时间：2008-09-10T23:49:09.107
> 
> 标签：c++, variables

我非常有信心在程序启动时分配（并初始化，如果适用）全局声明的变量。

```
int globalgarbage;
unsigned int anumber = 42; 
```

但是在函数中定义的静态函数呢？

```
void doSomething()
{
  static bool globalish = true;
  // ...
} 
```

`globalish`什么时候分配空间？我猜程序什么时候开始。但是它也会被初始化吗？还是在`doSomething()`第一次调用时初始化？

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2008-09-11T00:18:08.460

我对此很好奇，所以我编写了以下测试程序并使用 g++ 4.1.2 版本对其进行了编译。

```
include <iostream>
#include <string>

using namespace std;

class test
{
public:
        test(const char *name)
                : _name(name)
        {
                cout << _name << " created" << endl;
        }

        ~test()
        {
                cout << _name << " destroyed" << endl;
        }

        string _name;
};

test t("global variable");

void f()
{
        static test t("static variable");

        test t2("Local variable");

        cout << "Function executed" << endl;
}

int main()
{
        test t("local to main");

        cout << "Program start" << endl;

        f();

        cout << "Program end" << endl;
        return 0;
} 
```

结果不是我所期望的。直到第一次调用函数时才调用静态对象的构造函数。这是输出：

```
global variable created
local to main created
Program start
static variable created
Local variable created
Function executed
Local variable destroyed
Program end
local to main destroyed
static variable destroyed
global variable destroyed 
```

* * *

## 回答 #2

> 赞同：60
> 
> 时间：2008-09-12T12:20:09.697

C++ 标准中的一些相关措辞：

> ## 3.6.2 非本地对象的初始化 [basic.start.init]
> 
> ### 1
> 
> 在进行任何其他初始化之前，具有静态存储持续时间 ( *basic.stc.static* ) 的对象的存储应进行零初始化 ( *dcl.init )。**使用常量表达式 ( expr.const* )初始化的具有静态存储持续时间的 POD 类型 ( *basic.types* ) 的对象应在任何动态初始化发生之前进行初始化。在同一翻译单元中定义并动态初始化的具有静态存储持续时间的命名空间范围的对象应按照其定义在翻译单元中出现的顺序进行初始化。[注： *dcl.init.aggr* **描述了聚合成员的初始化顺序。*stmt.dcl*中描述了本地静态对象的初始化。]**
> 
>  **[下面的更多文本为编译器编写者添加更多自由]
> 
> ## 6.7 声明声明[stmt.dcl]
> 
> ...
> 
> ### 4
> 
> *具有静态存储持续时间 ( basic.stc.static* ) 的所有本地对象的零初始化 ( *dcl.init* )在任何其他初始化发生之前执行。具有使用常量表达式初始化的静态存储持续时间的 POD 类型 ( *basic.types ) 的本地对象在首次进入其块之前被初始化。**允许实现对具有静态存储持续时间的其他本地对象进行早期初始化，其条件与允许实现在命名空间范围内（ basic.start.init*）静态初始化具有静态存储持续时间的对象的条件相同***）。否则，此类对象在控件第一次通过其声明时被初始化；这样的对象在其初始化完成时被认为已初始化。如果初始化抛出异常退出，说明初始化未完成，下次控件进入声明时会再次尝试。如果在初始化对象时控制重新进入声明（递归），则行为未定义。[*示例：****
> 
>  **```
>  int foo(int i)
>       {
>           static int s = foo(2*i);  // recursive call - undefined
>           return i+1;
>       } 
> ```
> 
> --*结束示例*]
> 
> ### 5
> 
> 当且仅当构造变量时，才会执行具有静态存储持续时间的本地对象的析构函数。[注： *basic.start.term* 描述了具有静态存储持续时间的本地对象被销毁的顺序。]****

 *** * *

## 回答 #3

> 赞同：28
> 
> 时间：2008-09-11T00:41:46.857

所有静态变量的内存都是在程序加载时分配的。但是局部静态变量是在第一次使用时创建和初始化的，而不是在程序启动时。有一些关于它的好读物，以及一般的静力学，[here](https://web.archive.org/web/20100328062506/http://www.acm.org/crossroads/xrds2-4/ovp.html)。一般来说，我认为其中一些问题取决于实现，特别是如果你想知道这些东西在内存中的位置。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-11T01:00:58.823

编译器将在程序加载时分配在函数中定义的静态变量`foo`，但是编译器还将向您的函数添加一些附加指令（机器代码），`foo`以便在第一次调用它时，这些附加代码将初始化静态变量（例如调用构造函数，如果适用的话）。

@Adam：编译器在幕后注入代码是您看到结果的原因。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-12-03T15:49:16.380

我尝试再次测试**Adam Pierce**的代码并添加了另外两个案例：类中的静态变量和 POD 类型。我的编译器是 g++ 4.8.1，在 Windows 操作系统（MinGW-32）中。结果是类中的静态变量与全局变量相同。它的构造函数将在进入主函数之前被调用。

*   结论（针对g++，Windows环境）：

1.  **类中的全局变量**和**静态成员：在进入****主**函数***(1)***之前调用构造函数。
2.  **局部静态变量**：仅在执行第一次到达其声明时才调用构造函数。
3.  如果**局部静态变量是 POD 类型，那么在进入****main**函数***(1)***之前它也会被初始化。POD 类型示例：*static int number = 10；*

**(1)**：正确的状态应该是：*“在调用来自同一翻译单元的任何函数之前”。*但是，为了简单起见，如下例所示，它是*main*函数。

```
#include <iostream>                     
#include <string>

using namespace std;

class test
{
public:
   test(const char *name)
            : _name(name)
    {
            cout << _name << " created" << endl;
    }

    ~test()
    {
            cout << _name << " destroyed" << endl;
    }

    string _name;
    static test t; // static member
 };
test test::t("static in class");

test t("global variable");

void f()
{
    static  test t("static variable");
    static int num = 10 ; // POD type, init before enter main function

    test t2("Local variable");
    cout << "Function executed" << endl;
}

int main()
{
    test t("local to main");
    cout << "Program start" << endl;
    f();
    cout << "Program end" << endl;
    return 0;
 } 
```

**结果：**

```
static in class created
global variable created
local to main created
Program start
static variable created
Local variable created
Function executed
Local variable destroyed
Program end
local to main destroyed
static variable destroyed
global variable destroyed
static in class destroyed 
```

有人在 Linux 环境中测试过吗？

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-11T05:58:41.620

> 还是在第一次调用 doSomething() 时对其进行了初始化？

是的。除其他外，这使您可以在适当的时候初始化全局访问的数据结构，例如在 try/catch 块中。例如，而不是

```
int foo = init(); // bad if init() throws something

int main() {
  try {
    ...
  }
  catch(...){
    ...
  }
} 
```

你可以写

```
int& foo() {
  static int myfoo = init();
  return myfoo;
} 
```

并在 try/catch 块中使用它。在第一次调用时，变量将被初始化。然后，在第一次和下一次调用时，将返回其值（通过引用）。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-10T23:54:27.237

静态变量在代码段内分配——它们是可执行映像的一部分，因此映射到已经初始化的位置。

函数范围内的静态变量的处理方式相同，范围纯粹是语言级别的构造。

出于这个原因，您可以保证静态变量将被初始化为 0（除非您指定其他内容）而不是未定义的值。

您可以利用其他一些初始化方面的优势——例如，共享段允许您的可执行文件的不同实例同时运行以访问相同的静态变量。

在 C++（全局范围）中，静态对象的构造函数作为程序启动的一部分在 C 运行时库的控制下被调用。在 Visual C++ 下，至少初始化对象的顺序可以由[init_seg](http://support.microsoft.com/kb/104248) pragma 控制。

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2022-01-24T16:36:11.477

在下面的代码中，它打印 Initial = 4，这是 static_x 的值，因为它是在编译时实现的。

```
 int func(int x)
    {
        static int static_x = 4;
        static_x = x;
        printf ("Address = 0x%x",&static_x );   // prints 0x40a010
        return static_x;
    }
    int main()
    {
        int x = 8;
        uint32_t *ptr = (uint32_t *)(0x40a010); // static_x location
        printf ("Initial = %d\n",*ptr);
        func(x);

        return 0;
    } 
```

# c# - Visual Studio 2005 上的编译时间非常慢

> ID：55517
> 
> 赞同：133
> 
> 时间：2008-09-10T23:56:00.353
> 
> 标签：c#, visual-studio, compilation

我们的编译时间非常慢，在双核 2GHz、2G Ram 机器上可能需要超过 20 分钟。

这在很大程度上是由于我们解决方案的规模已经增长到 70 多个项目，以及当您拥有大量文件时 VSS 本身就是一个瓶颈。（不幸的是，换掉 VSS 不是一种选择，所以我不希望它下降到 VSS bash 中）

我们正在考虑合并项目。我们还在寻找多种解决方案来实现更大的关注点分离和更快的应用程序每个元素的编译时间。当我们试图保持同步时，我可以看到这将成为一个 DLL 地狱。

我很想知道其他团队是如何处理这个扩展问题的，当你的代码库达到临界质量时你会怎么做，而你浪费了半天时间看状态栏传递编译消息。

**更新** 我没有提到这是一个 C# 解决方案。感谢所有 C++ 建议，但几年前我不得不担心标题。

**编辑：**

到目前为止有帮助的好建议（并不是说下面没有其他好的建议，只是有帮助）

*   新的 3GHz 笔记本电脑 - 在向管理人员求助时，失去利用率的力量会产生奇迹
*   在编译期间禁用反病毒
*   在编译期间与 VSS（实际上是网络）“断开连接” - 我可能会让我们完全删除 VS-VSS 集成并坚持使用 VSS UI

仍然没有通过编译进行 rip-snorting，但每一点都有帮助。

Orion 在评论中确实提到泛型也可能有作用。从我的测试来看，似乎对性能的影响很小，但还不够高，无法确定 - 由于磁盘活动，编译时间可能不一致。由于时间限制，我的测试没有像在实时系统中出现那样多的泛型或代码，因此可能会累积。我不会避免在应该使用泛型的地方使用它们，只是为了编译时性能

**解决方法**

我们正在测试在新解决方案中构建应用程序新区域的做法，根据需要导入最新的 dll，当我们对它们感到满意时，它们会将它们集成到更大的解决方案中。

我们也可以通过创建临时解决方案来对现有代码做同样的事情，这些解决方案只是封装了我们需要处理的区域，并在重新集成代码后将它们丢弃。我们需要权衡重新集成此代码所需的时间与我们在开发过程中没有像 Rip Van Winkle 那样的快速重新编译经验所获得的时间。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2008-09-11T01:34:44.267

Chromium.org 团队列出了几个[加速构建的](http://dev.chromium.org/developers/how-tos/build-instructions-windows)选项（此时大约在页面的一半处）：

> 按加速递减顺序：
> 
> *   安装 Microsoft 修补程序[935225](http://support.microsoft.com/kb/935225)。
> *   安装 Microsoft 修补程序[947315](http://support.microsoft.com/kb/947315)。
> *   使用真正的多核处理器（即 Intel Core Duo 2；而不是 Pentium 4 HT）。
> *   使用 3 个并行构建。在 Visual Studio 2005 中，您将在**Tools > Options... > Projects and Solutions > Build and Run > maximum number of parallel project builds**中找到该选项。
> *   禁用 .ilk、.pdb、.cc、.h 文件的防病毒软件，仅在**modify**上检查病毒。禁用扫描源所在的目录。不要做傻事。
> *   在第二个硬盘驱动器上存储和构建 Chromium 代码。它不会真正加快构建速度，但至少当您执行 gclient 同步或构建时，您的计算机将保持响应。
> *   定期对硬盘进行碎片整理。
> *   禁用虚拟内存。

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2011-07-08T15:18:35.290

# 我们在一个解决方案中有近 100 个项目，开发构建时间只有几秒钟 :)

对于本地开发版本，我们创建了一个 Visual Studio 插件，它可以更改`Project references`和`DLL references`卸载不需要的项目（当然还有一个将它们切换回来的选项）。

*   *一次*构建我们的整个解决方案
**   卸载我们当前未处理的项目并将所有项目引用更改为 DLL 引用。*   在签入之前，将所有引用从 DLL 更改回项目引用。*

 *当我们一次只处理几个项目时，我们的构建现在只需几秒钟。我们还可以调试其他项目，因为它链接到调试 DLL。该工具通常需要 10-30 秒才能进行大量更改，但您不必经常这样做。

## 2015 年 5 月更新

*我达成的协议（在下面的评论中）是，如果*它获得足够的兴趣，我会将插件发布到开源。4 年后它只有 44 票（而 Visual Studio 现在有两个后续版本），所以它目前是一个低优先级的项目。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2008-12-12T01:20:55.810

我在一个有 21 个项目和 1/2 百万 LOC 的解决方案上遇到了类似的问题。最大的不同是获得更快的硬盘驱动器。从性能监视器'Avg。Disk Queue'会在笔记本电脑上显着增加，表明硬盘驱动器是瓶颈。

这是总重建时间的一些数据...

1) 笔记本电脑，Core 2 Duo 2GHz，5400 RPM 驱动器（不确定缓存。是标准的戴尔 inspiron）。

重建时间 = 112 秒。

2) 台式机（标准版），Core 2 Duo 2.3Ghz，单个 7200RPM 驱动器 8MB 缓存。

重建时间 = 72 秒。

3) Desktop Core 2 Duo 3Ghz，单 10000 RPM WD Raptor

重建时间 = 39 秒。

不能低估 10,000 RPM 驱动器。构建速度明显更快，加上显示文档等其他所有内容，使用文件资源管理器明显更快。通过加快代码构建运行周期，极大地提高了生产力。

*考虑到公司在开发人员工资上的花费，他们可以*浪费*多少来为他们配备与接待员使用的 PC 相同的 PC。*

* * *

## 回答 #4

> 赞同：16
> 
> 时间：2012-05-11T15:58:11.707

对于 C# .NET 构建，您可以使用[.NET Demon](http://www.red-gate.com/products/dotnet-development/dotnet-demon/?utm_source=.NET%2bDemon&utm_medium=stackoverflow&utm_campaign=55517)。它是一个接管 Visual Studio 构建过程以使其更快的产品。

它通过分析您所做的更改来做到这一点，并仅构建您实际更改的项目，以及实际依赖于您所做更改的其他项目。这意味着如果您只更改内部代码，则只需构建一个项目。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2008-09-11T22:48:54.297

关闭您的防病毒软件。它增加了编译时间。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2008-09-10T23:59:46.553

使用分布式编译。Xoreax [IncrediBuild](http://www.xoreax.com)可以将编译时间缩短到几分钟。

我在一个巨大的 C\C++ 解决方案上使用了它，通常需要 5-6 个小时来编译。IncrediBuild 帮助将这一时间缩短到 15 分钟。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2011-05-25T21:44:00.340

将 Visual Studio 编译时间缩短到几秒钟的说明

不幸的是，Visual Studio 不够聪明，无法将程序集的接口更改与无关紧要的代码主体更改区分开来。这一事实，当与大型交织的解决方案相结合时，有时几乎每次您更改一行代码时都会产生一场不需要的“完整构建”的完美风暴。

克服这个问题的一个策略是禁用自动参考树构建。为此，请使用“配置管理器”（构建/配置管理器...然后在“活动解决方案配置”下拉列表中，选择“新建”）创建一个名为“ManualCompile”的新构建配置，该配置从调试配置中复制，但执行不选中“创建新项目配置”复选框。在这个新的构建配置中，取消选中每个项目，这样它们都不会自动构建。点击“关闭”保存此配置。这个新的构建配置将添加到您的解决方案文件中。

您可以通过 IDE 屏幕顶部的构建配置下拉菜单（通常显示“调试”或“发布”的那个）从一种构建配置切换到另一种构建配置。实际上，这个新的 ManualCompile 构建配置将使构建菜单选项无效：“构建解决方案”或“重建解决方案”。因此，当您处于 ManualCompile 模式时，您必须手动构建您正在修改的每个项目，这可以通过在解决方案资源管理器中右键单击每个受影响的项目，然后选择“构建”或“重建”来完成。您应该看到您的整体编译时间现在只需几秒钟。

要使此策略起作用，AssemblyInfo 和 GlobalAssemblyInfo 文件中的 VersionNumber 必须在开发人员的机器上保持静态（当然不是在发布构建期间），并且您不签署您的 DLL。

使用这种 ManualCompile 策略的一个潜在风险是开发人员可能会忘记编译所需的项目，并且当他们启动调试器时，会得到意想不到的结果（无法附加调试器、找不到文件等）。为避免这种情况，最好使用“调试”构建配置来编译更大的编码工作，并且仅在单元测试期间使用 ManualCompile 构建配置或进行有限范围的快速更改。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-11T00:13:44.787

如果这是 C 或 C++，并且您没有使用预编译头文件，那么您应该使用。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2008-11-08T14:24:03.927

我们的主要解决方案中有 80 多个项目，根据开发人员使用的机器类型，构建大约需要 4 到 6 分钟。我们认为这太长了：对于每一次测试，它真的会蚕食你的 FTE。

那么如何获得更快的构建时间呢？您似乎已经知道，真正影响构建时间的是项目数量。当然，我们不想摆脱我们所有的项目，只是简单地将所有源文件放在一个文件中。但是我们仍然有一些项目可以合并：由于解决方案中的每个“存储库项目”都有自己的单元测试项目，我们只是将所有单元测试项目合并为一个全局单元测试项目。这减少了大约 12 个项目的项目数量，并且以某种方式节省了 40% 的时间来构建整个解决方案。

我们正在考虑另一种解决方案。

您是否还尝试为新项目设置新的（第二个）解决方案？第二个解决方案应该使用解决方案文件夹简单地合并所有文件。因为您可能会惊讶地看到该新解决方案的构建时间 - 只有一个项目。

但是，使用两种不同的解决方案需要仔细考虑。开发人员可能倾向于在第二种解决方案中实际工作，而完全忽略第一种。由于 70 多个项目的第一个解决方案将是处理您的对象层次结构的解决方案，这应该是您的构建服务器应该运行所有单元测试的解决方案。所以持续集成的服务器必须是第一个项目/解决方案。您必须维护您的对象层次结构，对。

第二种只有一个项目（构建速度更快）的解决方案将比所有开发人员都完成测试和调试的项目。不过，您必须照顾他们查看构建服务器！如果有任何问题必须修复。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2008-11-08T14:32:18.700

确保您的引用是项目引用，而不是直接指向库输出目录中的 DLL。

此外，将这些设置为不复制到本地，除非绝对必要（主 EXE 项目）。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-09-10T23:59:56.443

我最初在此处发布了此回复： [https](https://stackoverflow.com/questions/8440/visual-studio-optimizations#8473) ://stackoverflow.com/questions/8440/visual-studio-optimizations#8473 您可以在该页面上找到许多其他有用的提示。

如果您使用的是 Visual Studio 2008，则可以使用 /MP 标志进行编译，以并行构建单个项目。我读过这也是 Visual Studio 2005 中未记录的功能，但我自己从未尝试过。

您可以使用 /M 标志并行构建多个项目，但这通常已经设置为机器上可用内核的数量，尽管我相信这只适用于 VC++。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2010-05-27T08:35:39.590

我注意到这个问题已经很久了，但这个话题今天仍然很有趣。最近同样的问题困扰着我，最能提高构建性能的两件事是（1）使用专用（和快速）磁盘进行编译和（2）对所有项目使用相同的输出文件夹，并在项目上将 CopyLocal 设置为 False参考。

一些额外的资源：

*   [https://stackoverflow.com/questions/8440/visual-studio-optimizations](https://stackoverflow.com/questions/8440/visual-studio-optimizations)
*   [http://weblogs.asp.net/scottgu/archive/2007/11/01/tip-trick-hard-drive-speed-and-visual-studio-performance.aspx](http://weblogs.asp.net/scottgu/archive/2007/11/01/tip-trick-hard-drive-speed-and-visual-studio-performance.aspx)
*   [http://arnosoftwaredev.blogspot.com/2010/05/how-to-improve-visual-studio-compile.html](http://arnosoftwaredev.blogspot.com/2010/05/how-to-improve-visual-studio-compile.html)
*   [http://blog.brianhartsock.com/2009/12/22/analyzing-visual-studio-build-performance/](http://blog.brianhartsock.com/2009/12/22/analyzing-visual-studio-build-performance/)

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2010-08-24T15:25:51.230

一些分析工具：

tools->options->VC++ project settings -> Build Timing = Yes 会告诉你每个 vcproj 的构建时间。

将`/Bt`开关添加到编译器命令行以查看每个 CPP 文件占用了多少

用于`/showIncludes`捕获嵌套包含（包含其他头文件的头文件），并查看哪些文件可以通过使用前向声明节省大量 IO。

这将通过消除依赖性和性能消耗来帮助您优化编译器性能。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2010-09-14T22:26:19.997

在花钱购买更快的硬盘驱动器之前，请尝试完全在 RAM 磁盘上构建您的项目（假设您有空闲的 RAM）。您可以在网上找到各种免费的 RAM 磁盘驱动程序。您不会找到任何比 RAM 磁盘更快的物理驱动器，包括 SSD。

在我的例子中，一个需要 5 分钟才能在 7200 RPM SATA 驱动器上使用 Incredibuild 构建 6 核 i7 的项目使用 RAM 磁盘仅减少了大约 15 秒。考虑到重新复制到永久存储的需要和丢失工作的可能性，15 秒不足以激励使用 RAM 磁盘，也可能不足以激励在高 RPM 或 SSD 驱动器上花费数百美元。

小幅提升可能表明构建受 CPU 限制或 Windows 文件缓存相当有效，但由于这两个测试都是在文件未缓存的状态下完成的，因此我非常倾向于 CPU 限制编译。

根据您正在编译的实际代码，您的里程可能会有所不同——所以请不要犹豫进行测试。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2011-01-10T15:38:47.470

完成构建后，您的构建目录有多大？如果您坚持使用默认设置，那么您构建的每个程序集都会将其依赖项的所有 DLL 及其依赖项的依赖项等复制到其 bin 目录。在我之前的工作中，当我处理大约 40 个项目的解决方案时，我的同事发现，到目前为止，构建过程中最昂贵的部分是一遍又一遍地复制这些程序集，并且一个构建可以生成相同 DLL 的千兆字节副本，并且再次。

以下是 NDepend 的作者 Patrick Smacchia 关于他认为应该和不应该是单独的程序集的一些有用建议：

[http://codebetter.com/patricksmacchia/2008/12/08/advices-on-partitioning-code-through-net-assemblies/](http://codebetter.com/patricksmacchia/2008/12/08/advices-on-partitioning-code-through-net-assemblies/)

基本上有两种方法可以解决这个问题，并且都有缺点。一是减少装配数量，这显然是很多工作。另一种方法是重新构建构建目录，以便合并所有 bin 文件夹，并且项目不会复制其依赖项的 DLL - 它们不需要，因为它们都在同一个目录中。这大大减少了在构建过程中创建和复制的文件数量，但它可能难以设置，并且可能会让您难以仅提取特定可执行文件所需的 DLL 以进行打包。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2008-09-11T00:07:39.623

也许采取一些通用功能并制作一些库，这样就不会为多个项目一遍又一遍地编译相同的源代码。

如果您担心不同版本的 DLL 会混淆，请使用静态库。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2008-09-11T00:56:21.580

关闭 VSS 集成。您可能没有选择使用它，但 DLL 总是“意外”重命名......

并且一定要检查你的预编译头设置。Bruce Dawson 的指南有点旧，但仍然*非常*好 - 看看：[http ://www.cygnus-software.com/papers/precompiledheaders.html](http://www.cygnus-software.com/papers/precompiledheaders.html)

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2008-09-11T01:05:55.023

我有一个项目，它有 120 个或更多的 exe、lib 和 dll，并且需要相当长的时间来构建。我使用一棵从一个主批处理文件调用生成文件的批处理文件树。过去，我遇到过增量（或者是喜怒无常）标题的奇怪问题，所以我现在避免使用它们。我很少做一个完整的构建，通常在我去散步一个小时的时候把它留到一天结束（所以我只能猜测大约需要半小时）。所以我理解为什么这对于工作和测试是行不通的。

对于工作和测试，我为每个应用程序（或模块或库）准备了另一组批处理文件，其中也有所有调试设置——但这些仍然调用相同的 make 文件。我可能会不时关闭 DEBUG 并决定构建或制作，或者我是否还想构建模块可能依赖的库，等等。

批处理文件还将完成的结果复制到（或多个）测试文件夹中。根据设置，这会在几秒到一分钟内完成（而不是半小时）。

我使用了不同的 IDE (Zeus)，因为我喜欢控制 .rc 文件之类的东西，并且实际上更喜欢从命令行编译，即使我使用的是 MS 编译器。

如果有人感兴趣，很高兴发布此批处理文件的示例。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2008-11-08T14:33:24.623

禁用源目录上的文件系统索引（特别是 obj 目录，如果您希望源可搜索）

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2008-09-11T00:14:04.477

如果这是一个 Web 应用程序，将批处理构建设置为 true 可能会有所帮助，具体取决于场景。

```
<compilation defaultLanguage="c#" debug="true" batch="true" > 
```

您可以在此处找到概述：[http ://weblogs.asp.net/bradleyb/archive/2005/12/06/432441.aspx](http://weblogs.asp.net/bradleyb/archive/2005/12/06/432441.aspx)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-11T01:18:23.823

Xoreax IB 的一种更便宜的替代方案是使用我所说的 uber-file 构建。它基本上是一个 .cpp 文件

```
#include "file1.cpp"
#include "file2.cpp"
....
#include "fileN.cpp" 
```

然后你编译超级单元而不是单个模块。我们已经看到编译时间从 10-15 分钟缩短到 1-2 分钟。您可能必须尝试每个 uber 文件有多少 #include 才有意义。取决于项目。等等。也许你包括 10 个文件，也许 20 个。

你付出了代价，所以要小心：

1.  您不能右键单击文件并说“编译...”，因为您必须从构建中排除单个 cpp 文件并仅包含 uber cpp 文件
2.  您必须小心静态全局变量冲突。
3.  添加新模块时，您必须保持 uber 文件是最新的

这有点痛苦，但对于一个在新模块方面基本上是静态的项目来说，最初的痛苦可能是值得的。在某些情况下，我已经看到这种方法击败了 IB。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2008-09-11T02:26:07.730

您可能还想检查循环项目引用。曾经对我来说是个问题。

那是：

项目 A 参考项目 B

项目 B 参考项目 C

项目 C 引用项目 A

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2009-10-22T16:04:52.283

如果它是 C++ 项目，那么您应该使用预编译的头文件。这在编译时间上有很大的不同。不确定 cl.exe 到底在做什么（不使用预编译的头文件），它似乎在最终到达正确的位置之前在所有错误的地方寻找**大量的 STL 头文件。**这会为每个正在编译的 .cpp 文件增加整整几秒的时间。不确定这是 cl.exe 错误，还是 VS2008 中的某种 STL 问题。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2009-12-01T14:26:41.753

查看您正在构建的机器，它是否经过优化配置？

通过确保安装了正确的 SATA 过滤器驱动程序，我们刚刚将我们最大的 C++ 企业级产品的构建时间从**19 小时缩短**到*16 分钟。*

微妙的。

* * *

## 回答 #25

> 赞同：1
> 
> 时间：2010-08-24T15:23:01.220

Visual Studio 2005 中有未记录的 /MP 开关，请参阅[http://lahsiv.net/blog/?p=40](http://lahsiv.net/blog/?p=40)，这将启用基于文件而不是基于项目的并行编译。这可能会加快最后一个项目的编译速度，或者，如果您编译一个项目。

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2010-09-16T12:39:37.743

选择 CPU 时：L1 缓存大小似乎对编译时间有巨大影响。此外，拥有 2 个快速核心通常比 4 个慢速核心更好。Visual Studio 没有非常有效地使用额外的内核。（我是根据我对 C++ 编译器的经验得出的，但对于 C# 编译器来说可能也是如此。）

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2010-10-01T14:07:13.187

我现在也确信 VS2008 存在问题。我在带有 3G Ram 的双核英特尔笔记本电脑上运行它，并关闭了防病毒功能。编译解决方案通常非常巧妙，但如果我一直在调试后续的重新编译，通常会减慢速度。从持续的主磁盘指示灯可以清楚地看出存在磁盘 I/O 瓶颈（您也可以听到）。如果我取消构建并关闭 VS，磁盘活动就会停止。重新启动VS，重新加载解决方案，然后重新构建，速度要快得多。下次单位

我的想法是这是一个内存分页问题 - VS 只是内存不足，O/S 开始页面交换以尝试腾出空间，但 VS 要求的比页面交换所能提供的更多，所以它会慢下来。我想不出任何其他解释。

VS 绝对不是 RAD 工具，是吗？

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2013-04-30T15:54:59.767

贵公司是否碰巧将 Entrust 用于他们的 PKI/加密解决方案？事实证明，对于一个用 C# 构建的相当大的网站，我们的构建性能非常糟糕，在 Rebuild-All 上花费了 7 分钟以上。

我的机器是 i7-3770，有 16GB 内存和 512GB SSD，所以性能应该不会那么差。我注意到在构建相同代码库的旧辅助机器上，我的构建时间快得惊人。所以我在两台机器上启动了 ProcMon，分析了构建，并比较了结果。

瞧，性能慢的机器有一个不同之处——堆栈跟踪中对 Entrust.dll 的引用。使用这个新获得的信息，我继续搜索 StackOverflow 并发现：[MSBUILD (VS2010) very slow on some machines](https://stackoverflow.com/questions/5298491/msbuild-vs2010-very-slow-on-some-machines)。根据接受的答案，问题在于 Entrust 处理程序正在处理 .NET 证书检查，而不是本机 Microsoft 处理程序。Tt 还建议 Entrust v10 解决了 Entrust 9 中普遍存在的这个问题。

我目前已将其卸载，并且我的构建时间下降到*24 秒*。YYMV 与您当前正在构建的项目数量，可能无法直接解决您询问的扩展问题。*如果我可以在不*诉诸卸载软件的情况下提供修复程序，我将对此回复进行编辑。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-09-11T22:35:20.727

到目前为止有帮助的好建议（并不是说下面没有其他好的建议，如果您遇到问题，我建议您阅读，这对我们有帮助）

*   新的 3GHz 笔记本电脑 - 在向管理人员求助时，失去利用率的力量会产生奇迹
*   在编译期间禁用反病毒
*   在编译期间与 VSS（实际上是网络）“断开连接” - 我可能会让我们完全删除 VS-VSS 集成并坚持使用 VSS UI

仍然没有通过编译进行 rip-snorting，但每一点都有帮助。

我们还在测试在新解决方案中构建应用程序新区域的做法，根据需要导入最新的 dll，当我们对它们感到满意时，它们会将它们集成到更大的解决方案中。

我们也可以通过创建临时解决方案来对现有代码做同样的事情，这些解决方案只是封装了我们需要处理的区域，并在重新集成代码后将它们丢弃。我们需要权衡重新集成此代码所需的时间与我们在开发过程中没有像 Rip Van Winkle 那样的快速重新编译经验所获得的时间。

Orion 在评论中确实提到泛型也可能有作用。从我的测试来看，似乎对性能的影响很小，但还不够高，无法确定 - 由于磁盘活动，编译时间可能不一致。由于时间限制，我的测试没有像在实时系统中出现那样多的泛型或代码，因此可能会累积。我不会避免在应该使用泛型的地方使用它们，只是为了编译时性能

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2009-03-31T14:29:39.267

VS2008肯定有问题。因为我唯一做的就是安装 VS2008 来升级我用 VS2005 创建的项目。我的解决方案中只有 2 个项目。它不大。用 VS2005 编译：30 秒 用 VS2008 编译：5 分钟

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2011-03-25T12:32:28.007

我发现有一些东西对加速**C# /.NET**构建很有用：

*   将小项目组合成更大的项目，因为构建解决方案的每个项目开销很大。（如果需要控制跨层调用，请使用**nDepend ）**

*   将我们所有的项目构建到某个输出目录中，然后在所有项目引用上将“copy local”设置为 false - 由于减少 IO，这可能会导致很大的加速。

*   打开你的病毒检查器，看看它是否有很大的不同；如果是这样，请找到[更快的病毒检查程序](https://stackoverflow.com/questions/1305709/slowdown-of-microsoft-visual-studio-due-to-different-virus-scanner)，或从病毒检查程序扫描中排除“热”文件夹

*   使用 perforce 监视器和 sys 内部工具来查看您的编译需要这么长时间。

*   考虑一个 ram 磁盘来放置你的输出目录。

*   考虑使用 SSD

*   更多的内存有时会产生很大的影响——（如果你通过移除一个小内存而大大减慢了机器中的内存，你可以通过添加更多内存来获得很大的速度）删除不需要的项目引用（你可能必须首先删除不需要的“使用”）

*   考虑为您的最低域层使用依赖注入框架和接口，因此仅在接口更改时才需要重新编译所有内容 - 根据接口更改的频率，这可能不会获得太大收益。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2011-08-03T22:50:59.653

我发现以下有助于编译速度： 经过反复编译（内存中的迭代开发），我会退出 VS2008。然后进入项目目录并删除所有`obj`和`bin`文件夹，重新启动项目，我的编译时间又回来了。这类似于`Clean solution`VS2008 中的操作。

只是想确认这是否对那里的任何人有用。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2011-08-30T15:27:49.180

我在这里找到了解决方法：http: [//blogs.msdn.com/b/vsdteam/archive/2006/09/15/756400.aspx](http://blogs.msdn.com/b/vsdteam/archive/2006/09/15/756400.aspx)

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2014-09-24T07:34:26.823

缓慢的 Visual Studio 性能……已解决！2014 年 9 月 24 日，作者：乌兹玛·阿比迪

我今天遇到了一个奇怪的与性能相关的问题。即使是最简单的操作，我的 Microsoft Visual Studio 似乎也需要很长时间才能执行。我四处搜索并尝试了一些人们的想法，例如禁用加载项或清除 Visual Studio 的最近项目列表，但这些建议似乎并没有解决问题。我记得 Windows SysInternals 网站有一个名为 Process Monitor 的工具，它可以嗅探任何正在运行的程序对注册表和文件的访问。在我看来，Visual Studio 是在做某事，而 Process Monitor 应该可以帮助我弄清楚它是什么。我下载了最新版本，在调整了一下显示过滤器后，运行它，令我惊恐的是，我发现 Visual Studio 太慢了，因为它要访问 C 语言中的 10,000 多个文件夹：\Users\krintoul\AppData\Local\Microsoft\WebSiteCache 在大多数 IDE 操作中。我不知道为什么会有这么多文件夹，而且也不知道 Visual Studio 对它们做了什么，但是在我压缩这些文件夹并将它们移动到其他地方之后，Visual Studio 的性能得到了极大的提升。

Windows SysInternals 网站有许多其他有用的实用程序，用于网络管理、安全、系统信息等。看看这个。我相信你会发现一些有价值的东西。

# crash - 如何计算崩溃的“成本”？

> ID：55531
> 
> 赞同：11
> 
> 时间：2008-09-11T00:05:58.053
> 
> 标签：crash, statistics, crash-reports

### 背景：

前段时间，我为我们的一个内部程序建立了一个记录和分类应用程序崩溃的系统。当时，我结合使用频率和累计损失时间（程序启动和崩溃之间的时间）来确定崩溃类型的优先级。它工作得相当好。

现在，The Powers That Be 想要关于正在处理的每种类型的崩溃*成本*的可靠数字。或者至少，*看起来*可靠的数字。我想我可以使用总损失时间乘以某个合理的数字，但这似乎很狡猾。

### 问题：

是否有任何既定的方法来计算应用程序崩溃的实际成本？或者做不到这一点，发表的研究推测这样的成本？

* * *

### 共识

准确性是不可能的，但是如果始终如一地应用并且清楚地记录其局限性，则基于正常运行时间的估计就足够了。谢谢，马特，猎户座，花时间回答这个问题。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-11T00:23:06.233

> The Powers That Be 想要关于正在处理的每种类型的崩溃成本的可靠数字

我想乘坐我的热气球飞往火星，但这并不意味着这样的事情是可能的。

说真的，我认为你有责任告诉他们没有办法准确地衡量这一点。告诉他们您可以对崩溃进行排名，或者您可以对数据实际执行的任何操作，但这就是您所拥有的一切。

诸如“我们实际上无法计算出它的成本。我们确实有关于运行多长时间的数据，等等，但附加成本的唯一方法是假装 X 分钟等于 X 美元，即使这在现实中没有根据”

如果您只是制作一些废话成本计算算法并且根本不推后，那么当管理层转身并使用这个任意编造的数字做一些愚蠢的事情（例如消防人员）或决定不修复任何崩溃和相反，专注于利用他们与 sharepoint 门户互联网网络共享爱服务器 2013 的协同作用

**更新：**澄清一下，我并不是说你应该只依赖 100% 准确的统计数据，而放弃其他一切。
我认为重要的是你知道你在测量什么。您实际上不是在衡量成本，而是在衡量正常运行时间。因此，您应该提前了解它。如果您想估算成本，那很好，但我相信您需要说清楚..

如果我要生成这样的报告，我会将其称为“崩溃正常运行时间报告”，并且可能会有一个名为“基于 5 美元/分钟的估计成本”的辅助字段。经理们得到了他们的成本估算，但很明显，实际报告是基于正常运行时间的，而成本只是一个估算，以及估算的工作原理。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2008-09-11T00:15:33.037

我还没有看到任何研究，但一个合理的启发式是这样的：

（崩溃发生时自上次应用程序保存的时间 + 重新启动应用程序的时间） * 应用程序操作员的平均每小时费率。

如果崩溃对外部客户有一些影响，或者可能会延迟其他事情（即创建一个瓶颈，使得另一个人因为其他人的应用程序崩溃而坐等等待），那么估计会变得更加复杂。

也就是说，你的“能力”很可能会对一个非常粗略的估计感到满意，只要它始终如一地应用并且他们可以看到它随着时间的推移如何变化。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-12T00:54:40.517

这里缺少一个因素.. 大多数应用程序都有一个“屈曲”因素，崩溃突然开始“花费”更多，因为人们对您的应用程序提供的服务失去信心。一旦发生这种情况，让用户重新信任和使用系统 可能会**非常昂贵。**

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-12-14T17:13:59.297

这取决于...

就成本而言，*唯一*重要的是崩溃对**业务的影响**，因此它取决于应用程序的类型。

对于可能的应用程序，可能无法确定业务影响。对于其他人来说，可能会有有意义的措施。

基于需求的措施可能是有意义的——如果销售稳定，那么销售应用程序的停机时间可能是有用的。如果销售波动不可预测，那么这些措施就不那么有用了。

维修费用也可能有用。

# c++ - 在多维和单维数组之间进行转换

> ID：55532
> 
> 赞同：3
> 
> 时间：2008-09-11T00:06:58.097
> 
> 标签：c++, arrays

这是从[我的上一个问题的这个答案中得出的](https://stackoverflow.com/questions/55093/how-to-deal-with-arrays-declared-on-the-stack-in-c#55183)。编译器是否保证将其视为`array[4][4]`相同`array[16]`？

例如，以下任一调用`api_func()`是否安全？

```
void api_func(const double matrix[4][4]);

// ...

{
  typedef double Matrix[4][4];

  double* array1 = new double[16];
  double array2[16];

  // ...

  api_func(reinterpret_cast<Matrix&>(array1));
  api_func(reinterpret_cast<Matrix&>(array2));
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T01:42:11.113

来自 C++ 标准，指的是`sizeof`运算符：

> 当应用于数组时，结果是数组中的总字节数。这意味着元素数组的`n`大小`n`是元素大小的倍数。

由此，我会这么说，`double[4][4]`并且`double[16]`必须具有相同的基础表示。

即，给定

```
sizeof(double[4]) = 4*sizeof(double) 
```

和

```
sizeof(double[4][4]) = 4*sizeof(double[4]) 
```

那么我们有

```
sizeof(double[4][4]) = 4*4*sizeof(double) = 16*sizeof(double) = sizeof(double[16]) 
```

我认为符合标准的编译器必须同样实现这些，而且我认为这不是编译器会意外破坏的东西。实现多维数组的标准方法按预期工作。打破标准需要额外的工作，可能没有任何好处。

C++ 标准还规定数组由连续分配的元素组成，这消除了使用指针和填充做任何奇怪的事情的可能性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T00:53:49.513

我认为**多维**数组引入的填充没有问题。

数组中的每个元素都必须满足架构强加的填充要求。数组 [N][M] 在内存中的表示形式总是与 [M*N] 之一相同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T00:53:53.180

每个数组元素应由编译器按顺序排列在内存中。这两个声明虽然不同的类型是相同的底层内存结构。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T23:43:24.430

@康拉德鲁道夫：

我自己把这两个（行专业/列专业）搞混了，但我知道这一点：它定义明确。

例如，int x[3][5] 是一个大小为 3 的数组，其元素是大小为 5 的 int 数组。（§6.5.2.1）添加标准中关于数组、寻址等的所有规则。你得到第二个下标引用连续的整数，而第一个下标将引用连续的 5-int 对象。（所以 3 是更大的数字；在**x[1]** [0] 和**x[2]** [0] 之间有 5 个整数。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T00:12:30.003

我会担心为 Matrix[5][5] 之类的东西添加填充以使每一行单词对齐，但这可能只是我自己的迷信。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T07:24:35.517

一个更大的问题是：你真的需要进行这样的演员阵容吗？

尽管您*可能*能够摆脱它，但完全避免它仍然更具可读性和可维护性。例如，您可以始终使用 double[m*n] 作为实际类型，然后使用包装此类型的类，并可能重载 [] 运算符以方便使用。在这种情况下，您可能还需要一个中间类来封装单行——这样 my_matrix[3][5] 之类的代码仍然可以按预期工作。

# security - 自动生成的密码中要避免的字符

> ID：55556
> 
> 赞同：28
> 
> 时间：2008-09-11T00:27:50.060
> 
> 标签：security, passwords, user-experience

我需要生成一些密码，我想避免可能相互混淆的字符。是否有明确的我应该避免的角色列表？我目前的清单是

il10o8B3Evu![]{}

还有其他容易混淆的字符对吗？对于特殊字符，我将自己限制在数字键下，尽管我知道这取决于您的键盘国籍！

作为一个骑手的问题，我希望我的密码是“wordlike”你有一个喜欢的算法吗？

谢谢 ：）

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2008-09-11T01:24:43.760

以下是 Steve Gibson 用于他的[“Perfect Paper Password”](https://www.grc.com/ppp.htm)系统的字符集。它们是“允许的字符”而不是“要避免的字符”，但它们对于您想要的似乎非常合理：

一组标准的 64 个字符

```
!#%+23456789:=?@ABCDEFGHJKLMNPRS
TUVWXYZabcdefghijkmnopqrstuvwxyz 
```

更大的 88 个字符集

```
!"#$%&'()*+,-./23456789:;<=>?@ABCDEFGHJKLMNO
PRSTUVWXYZ[\]^_abcdefghijkmnopqrstuvwxyz{|}~ 
```

对于可发音的密码，我不熟悉算法，但您可能希望将[APG](http://www.adel.nursat.kz/apg/)和[pwgen](http://sourceforge.net/projects/pwgen/)作为起点。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-11T00:37:48.117

我首选的方法是获取 3、4 和 5 个字母单词的单词列表。然后选择其中至少 2 个，并在每个单词之间放置一个随机的 2 位数字或特殊符号 (%&*@#$)。如果您愿意，每个单词最多可以随机大写一个字符。

根据您的强度要求，您最终会得到易于记忆和交流的密码，例如：

*   柠檬%办公桌
*   paper&boy32hat

请记住，您偶尔会得到有趣或不恰当的单词组合（我会让您发挥您的想象力）。如果不喜欢所提供的密码，我通常有一个按钮允许生成新密码。

通常，只使用人们通常知道其名称的符号。在美国标准键盘上，我会避免使用 ~`'/\^

我想这比您的主要问题更能回答您的骑手问题。..

祝你好运！

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-11T04:18:23.217

阅读[选择安全密码](http://www.schneier.com/blog/archives/2007/01/choosing_secure.html)。

那里有一个有趣的花絮：要获得更安全的密码，请确保一些数字和特殊字符出现在中间。破解程序在开始时会检查它们，并且会更快结束。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-11T01:16:54.417

要添加到吉姆的答案，您还可以使用单词列表并用符号随机替换某些字符（@ 表示 A，0（零）表示 O 或 5 表示 S）和/或从单词中删除元音.

*   lmn%办公桌
*   p@per&b0y32H@t

仍然主要是人类可读的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-11T02:25:17.313

作为另一种选择，您可以使用等宽/终端字体（如 courier）来打印密码。这样，相似的字符应该更容易区分。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-09-15T17:16:22.597

几年前，对于一个国际客户，我必须生成随机、安全的密码，然后我的客户将这些密码邮件合并到文档中，并通过邮寄方式发送给 40 个国家/地区的收件人。由于不知道文档中要使用什么字体，我使用了一个字符列表，例如 Steve Gibson [64 字符](https://www.grc.com/ppp.htm)集，以消除相似字形之间的混淆。

为了使生成的密码发音清晰，从而更容易记住，我将辅音和元音配对在一起，并添加了一些辅音有向字母（sh、th、wh 等）。

为了减少生成不适当或冒犯性单词的机会（用英语或接收者的语言），我将连续的字母字符限制为两个，并在中间使用数字或标点符号：

```
Es4tU$sA6
wH@cY8Go2 
```

现在回顾我的方法，我意识到不适当性算法还有改进的空间。仅使用上面的规则，现在一些冒犯性的词是可能的，因为一些数字和标点符号被替换了字母。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-11T19:49:49.843

对于人类可读的密码，我最近使用了一个与下面的非常相似的 PHP 脚本。它运作良好。诚然，密码不会非常安全（因为它们容易受到字典攻击），但对于可记忆或至少可读的密码来说，它工作得很好。但是，这个函数不应该按原样使用，它更多的是为了说明而不是其他任何东西。

```
function generatePassword($syllables = 2, $use_prefix = true)
{

    // Define function unless it is already exists
    if (!function_exists('arr'))
    {
        // This function returns random array element
        function arr(&$arr)
        {
            return $arr[rand(0, sizeof($arr)-1)];
        }
    }

    // Random prefixes
    $prefix = array('aero', 'anti', 'auto', 'bi', 'bio',
                    'cine', 'deca', 'demo', 'dyna', 'eco',
                    'ergo', 'geo', 'gyno', 'hypo', 'kilo',
                    'mega', 'tera', 'mini', 'nano', 'duo',
                    'an', 'arch', 'auto', 'be', 'co',
                    'counter', 'de', 'dis', 'ex', 'fore',
                    'in', 'infra', 'inter', 'mal', 
                    'mis', 'neo', 'non', 'out', 'pan',
                    'post', 'pre', 'pseudo', 'semi',
                    'super', 'trans', 'twi', 'vice');

    // Random suffixes
    $suffix = array('dom', 'ity', 'ment', 'sion', 'ness',
                    'ence', 'er', 'ist', 'tion', 'or',
                    'ance', 'ive', 'en', 'ic', 'al',
                    'able', 'y', 'ous', 'ful', 'less',
                    'ise', 'ize', 'ate', 'ify', 'fy', 'ly'); 

    // Vowel sounds 
    $vowels = array('a', 'o', 'e', 'i', 'y', 'u', 'ou', 'oo', 'ae', 'ea', 'ie'); 

    // Consonants 
    $consonants = array('w', 'r', 't', 'p', 's', 'd', 'f', 'g', 'h', 'j', 
                        'k', 'l', 'z', 'x', 'c', 'v', 'b', 'n', 'm', 'qu');

    $password = $use_prefix?arr($prefix):'';
    $password_suffix = arr($suffix);

    for($i=0; $i<$syllables; $i++)
    {
        // selecting random consonant
        $doubles = array('n', 'm', 't', 's');
        $c = arr($consonants);
        if (in_array($c, $doubles)&&($i!=0)) { // maybe double it
            if (rand(0, 2) == 1) // 33% probability
                $c .= $c;
        }
        $password .= $c;
        //

        // selecting random vowel
        $password .= arr($vowels);

        if ($i == $syllables - 1) // if suffix begin with vovel
            if (in_array($password_suffix[0], $vowels)) // add one more consonant 
                $password .= arr($consonants);

    }

    // selecting random suffix
    $password .= $password_suffix;

    return $password;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-10-28T05:02:40.243

在我的（电气工程、技术）研究生院中，所有计算机帐户都使用密码进行初始化，我认为这些密码是由标准 linux 实用程序生成的。它们由三个随机音节组成，每个音节中有三个小写字母。结果是相当安全的（大约有数十亿种可能的组合），但又如此清晰，以至于我在十多年后仍然使用其中的一些密码。詹姆斯的例子很好地证明了这一点。

网络安全专家对密码的一般评论：它们很糟糕，有几个原因，包括：

*   通常很容易被破坏，无论是通过社会工程还是使用攻击软件，尤其是当您对目标 *有所了解时。*

    *示例 1：* 我最近需要修改受密码保护的技术文档。看着日期，我知道当时我们的驻地技术作家是谁，输入了我脑海中的第一个词，然后立即解锁了文件。

    *示例 2：* 标准密码破解程序允许破解者指定一组对用户提供的字典进行操作的规则。用 $ymb01$ 替换某些字母或翻译成 1337 等是微不足道的。

*   “安全”密码不是。鉴于大多数人需要记住的密码数量之多，“记住”像“a4$N!8_q”这样的“强”密码的最常见方法是将其写在一张纸上（或者更糟的是，将其存储在一个文本文件）。'纳夫说。

如果您需要真正*安全*的身份验证，*多因素*（或*双因素*）是行业接受的机制。“两个因素”通常是您*拥有*的东西（例如访问卡）和您*知道*启用它的东西（例如 PIN）。没有另一个，两者都无法工作——你需要两者。

另一方面，请考虑您真正需要的安全级别。你在保护什么？“坏人”想要得到它有多严重，如果他们这样做了会有什么后果？机会是，“Its@Secret！” 绰绰有余。:-)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-11T19:35:26.167

我不喜欢 wordlist 方法。例如，在 OSX 上的 /usr/share/dict/words 中，有 5110 个 4 字符的单词。将其中两个与分隔符一起使用会产生约 600M 的组合。但是，如果您直接将字符集与强随机数生成器一起使用，您将拥有 88^9 种可能的密码，3.16e+17 种组合。

无论哪种方式，针对该系统的可能攻击都将针对随机数生成器，因此请确保您使用的是加密强的。如果使用 PHP 的标准 rand 函数，它会通过注册和重置数千个密码来进行攻击，以采样 RNG 状态，然后预测剩余的 RNG 状态，这将减少攻击者需要测试的可能密码数量。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-10-14T15:15:06.917

一种起始方法可能是生成大部分有效的英语音节，将它们混合，然后进行 text->l33t 转换。已经对世代自然语言语法进行了研究，因此其中一项可能会有所帮助。

例如 ah ul ing 都是有效音节或接近它...混合它们 -> Ingulah...l33t it -> 1ngu4h。它是最好的吗？不。但至少它是半发音的（如果你说 l33t）并且在计算上更安全。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-03-10T23:30:54.557

```
function random_readable_pwd($length=12){
    // special characters
    $sym="!\"§$%&/()={[]}\,.-_:;@>|";

    // read words from text file to array
    $filename="special.txt";
    if (!file_exists($filename)) { die('File "'.$filename.'" is not exists!'); }
    $lines = file($filename);
    foreach ($lines as $line_num => $line) {
        $line=substr($line, 0, -2);
        $words[].=$line;
    }

    // Add words while password is smaller than the given length
    $pwd = '';
    $ran_date=date("s");
    while (strlen($pwd) < $length){
        $r = mt_rand(0, count($words)-1);
        // randomly upercare word but not all in one time
        if ($ran_date % 3 == 0) $words[$r]=ucwords($words[$r]);
        $pwd .= $words[$r];
        //randomly add symbol
        if ($ran_date % 2 == 0) $pwd .= $sym{mt_rand(0,strlen($sym))};
        $ran_date++;
    }

    // append a number at the end if length > 2 and
    // reduce the password size to $length
    $num = mt_rand(1, 99);
    if ($length > 2){
        $pwd = substr($pwd,0,$length-strlen($num)).$num;
    } else { 
        $pwd = substr($pwd, 0, $length);
    }

    return $pwd;

} 
```

# asp.net - 现场 asp.net web.config 设置

> ID：55572
> 
> 赞同：5
> 
> 时间：2008-09-11T00:48:10.743
> 
> 标签：asp.net, security, web-config

我最近才开始使用 asp.net 和 c#。是否有适用于实时最终网站的 web.config 设置的标准实践集？似乎有很多可用的选项，我希望简化性能、关闭可能的安全漏洞和其他不必要的选项。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T01:04:59.220

[提示/技巧：使用 VS 2005 自动化开发、QA、登台和生产 Web.Config 设置](http://weblogs.asp.net/scottgu/archive/2007/09/21/tip-trick-automating-dev-qa-staging-and-production-web-config-settings-with-vs-2005.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T01:02:04.390

空的 web.config（或至少缺少*`<`system.web>*元素）意味着框架的所有推荐默认值都将生效。然后您只需要关心主机（例如，IIS）设置。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T01:07:59.977

从一个干净的 web.config 开始，只添加你需要的部分。

为了安全起见，您真正能做的就是确保为您的生产框标记 <compelation debug="false"> 并将自定义错误设置为 true。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T01:41:09.743

使用位置标签保护所有包含任何敏感信息的文件夹。[使用DPAPI](http://msdn.microsoft.com/en-us/library/ms998280.aspx)加密任何连接字符串。

# ruby-on-rails - 学习 Ruby on Rails

> ID：55574
> 
> 赞同：241
> 
> 时间：2008-09-11T00:50:59.520
> 
> 标签：ruby-on-rails, ruby, ide

就目前而言，我是一名 Java 和 C# 开发人员。我对 Ruby on Rails 的了解越多，我就越想学习它。

您发现学习 RoR 的最佳途径是什么？在 Windows 上开发会更容易，还是应该只用 Linux 运行虚拟机？

是否有可以匹配 Visual Studio 健壮性的 IDE？任何要开发的程序都可以提供很好的开销吗？有什么好书吗？

说真的，任何提示/技巧/咆哮都会很棒。

* * *

## 回答 #1

> 赞同：205
> 
> 时间：2008-09-11T01:11:52.683

我从职业生涯中的 C# 转向个人生活中的 Ruby 和 RoR，我发现 linux 对个人开发更具吸引力。特别是现在我已经开始使用 git，Linux 上的实现更加简洁。

目前我正在双启动并且越来越接近全职运行 Ubuntu。我在开发环境中使用带有各种插件的 gedit。截至 2010 年底，我正在推动使用 Vim 进行开发，甚至在 OS X 上使用 Textmate。

大量 Rails 开发人员正在使用（喘不过气的）Mac，这实际上让我想到了那个方向。

虽然我没有尝试过，但[Ruby in Steel](http://www.sapphiresteel.com/)为您提供了 Visual Studio 世界中的 Ruby IDE ，如果您有兴趣，[IronRuby是 Ruby 的 .NET 风格。](http://www.ironruby.net/)

就书籍而言，Pragmatic Programmers 的*[Programming Ruby](http://pragprog.com/titles/ruby3/programming-ruby-3)*（也称为 Pickaxe）一书是学习 Ruby 的事实。我硬着头皮买了那本书和*[使用 Rails 进行敏捷 Web 开发](http://pragprog.com/book/rails4/agile-web-development-with-rails)*；两本书都很棒。

[Peepcode](http://peepcode.com/)截屏视频和 PDF 书籍也非常适合入门；每个截屏视频 9 美元，很难出错。我真的买了5包。

另请查看以下内容：

*   [官方 Rails 指南](http://guides.rubyonrails.org/)
*   [Railscasts](http://railscasts.com/)
*   [railsapi.com](http://railsapi.com/)或[Ruby on Rails - APIdock](http://apidock.com/rails)
*   [红宝石秀](http://rubyshow.com/)
*   [僵尸导轨](http://railsforzombies.org)
*   [Softies on Rails](http://www.softiesonrails.com/) - 面向 .NET 开发人员的 Ruby on Rails
*   [Rails 播客](http://podcast.rubyonrails.org/)
*   [Rails 最佳实践](http://www.codeschool.com/courses/rails-best-practices)

在过去的一个月里，我已经完成了 Rails 和 Rails Envy 播客的积压工作，它们为许多主题提供了精彩的见解，甚至在一般软件开发方面也是如此。

* * *

## 回答 #2

> 赞同：125
> 
> 时间：2008-09-15T13:26:02.977

请注意，rails 世界是一堆令人沮丧的过时且不一致的文档和示例。它可能是目前发展最快、最流行的开发社区之一。当你学到一些东西时，它已经改变了。甚至这些书在他们谈论的轨道版本中也不一致。通过博客记录！说够了。

我目前在 Windows 上做 RoR。我的建议是尽可能避免使用窗户。很多事情都不起作用，而且 Rails 社区真的不关心你。迁移到 Git 真的把我搞砸了，因为它在 Windows 上运行得不是很好。很多 gem 会因此而失败（Heroku 看起来是一个很酷的工具——对我来说太糟糕了，它无法处理窗口的 Git 设置）。Capistrano 出来了。它继续并且令人讨厌地继续。

另外，在你的脑海里，你总是想知道什么时候有什么不工作“是不是 rails/windows 的问题？” 我不确定这是否可以通过使用 linux 来解决，因为 linux 会带来自己的麻烦，例如不断升级所有这些不同的依赖项等……如果这是您喜欢的事情，它可能是您的一个不错的选择。那些享受系统摆弄的日子已经过去了，我只想继续做我的工作。我打算在家用机器上安装 ubuntu，这样我就可以熟悉像 capistrano 这样的东西，所以也许我的看法会改变。

我强烈建议您是否要在认真考虑购买 Mac 的任何时间进行 rails dev。如果你珍惜你的时间和理智，它几乎会立即收回成本。取决于您如何评估您的时间 10 小时调试 windows/linux 设置问题，并且无论如何您花费的成本与 Mac 成本一样多。

与它所取代的东西相比，Rails 是一种乐趣，但它的支持者跳过了许多无聊但重要的东西，比如文档、兼容性问题和社区建设，这有点令人痛苦。它比 Django 等其他框架强大得多，但我有时会查看 Django 文档和社区，并像一个有着狂野性感女友的男人看着他朋友朴素但理智而稳定的妻子一样叹息。但是随后 rails 添加了一个功能，我会说“哦，闪亮！”

IMO Rails 截屏视频比 Peepcode 截屏视频要好。RubyPlus 也有截屏视频，请注意，它们的边缘有点粗糙。BuildingWebApps 有一个免费的在线课程，可以在中途开始进行截屏。

* * *

## 回答 #3

> 赞同：96
> 
> 时间：2008-09-15T16:01:41.123

阻力最小的路径：

*   考虑一个简单的 Web 项目。
*   **访问 ruby​​onrails.org**并查看他们的“15 分钟内博客”截屏视频，让您兴奋不已。
*   获取 O'Reilly Media 的**Learning Ruby的副本**
*   获取 Mac 或 Linux 机器。
    （由于 Rails 通常是在这些基础上开发的，因此早期的 Rails 受挫较少。）
*   获取一份**使用 Rails 进行敏捷 Web 开发**的副本。
*   获取该书中描述的 Ruby 和 Rails 版本。
*   浏览那本书的第一部分，以了解它的感觉。
*   转到**railscasts.com**并查看最早的视频以进行仔细查看。
*   购买Obie Fernandez**的 The Rails Way**，以更深入地了解 Rails 及其功能。
*   然后升级到最新的 Rails 生产版本，并查看最新的 railscasts.com 视频。

* * *

## 回答 #4

> 赞同：24
> 
> 时间：2008-09-20T23:40:11.873

我写了一篇名为[“Rails 入门——我希望我知道](http://betterexplained.com/articles/starting-ruby-on-rails-what-i-wish-i-knew/)的事情”的帖子，很多人都觉得它很有帮助。

基础：

*   使用 Rails 进行敏捷开发（书籍）
*   InstantRails 用于 Windows 上的快速 ruby​​/rails 环境
*   Aptana 作为 IDE
*   用于版本控制的 Subversion

在线教程很不错，但很分散。花 30 美元买一本书，以获得更全面的理解。

* * *

## 回答 #5

> 赞同：20
> 
> 时间：2010-07-30T03:52:33.427

我发现[http://railstutorial.org/book](http://railstutorial.org/book)是学习 Rails 的绝佳资源

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-12-18T19:49:39.020

我真的很喜欢 Jetbrains 的 RubyMine。它似乎是一个功能非常齐全的 IDE，这是我从许多其他替代品中错过的东西。同样对于一个简单的环境，我喜欢文本编辑器。干净利落。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2008-09-11T01:00:07.890

```
IDE：NetBeans
书籍：使用 Rails 进行敏捷 Web 开发
安装：Instant Rails

```

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2011-03-16T07:02:17.847

1.  **[Ruby 中面向对象设计模式的数据结构和算法](http://www.brpreiss.com/books/opus8/html/book.html)** Bruno R. Preiss | 2004年出版

2.  **[学习编程](http://pine.fm/LearnToProgram/)** Chris Pine | 实用书架 2006年出版，176页

3.  **[邻居先生的谦逊小红宝石书](http://www.linuxinsight.com/files/humble_little_ruby_book.pdf)** Jeremy McAnally | 2006年出版，147页

4.  **[Ruby 编程：实用程序员指南](http://www.rubycentral.com/book/)** David Thomas、Andrew Hunt | Addison-Wesley 2000 年出版，608 页

5.  **[Rails in a Nutshell](http://rails-nutshell.labs.oreilly.com/)** C. Fauser, J. MacAulay, E. Ocampo-Gooding, J. Guenin | O'Reilly Media 2009 年出版，352 页

6.  **[Ruby 最佳实践](http://rubybestpractices.com/)** Gregory T. Brown | O'Reilly Media 2009 年出版，328 页

7.  **[红宝石要领](http://www.techotopia.com/index.php/Ruby_Essentials)** | 技术乌托邦 2007 年出版

8.  **[Ruby on Rails 安全](http://www.rorsecurity.info/the-book)** Heiko Webers | OWASP 2009 年出版，48 页

9.  **[Ruby 用户指南](http://www.ruby-doc.org/docs/UsersGuide/rg/)** Mark Slagell | 2005年出版

10.  **[Ruby](http://www.sapphiresteel.com/the-book-of-ruby)** Huw Collingbourne 之书 | 2009年出版，425页

11.  [](http://www.sapphiresteel.com/IMG/pdf/LittleBookOfRuby.pdf)**Ruby Huw Collingbourne[**的小书|**](http://www.sapphiresteel.com/IMG/pdf/LittleBookOfRuby.pdf) Dark Neon Ltd. 2008 年出版，87 页**

***   **[Ruby 的why（辛酸）指南](http://poignantguide.net/ruby/)** 为什么幸运僵硬？2008年出版** 

 *** * *

## 回答 #9

> 赞同：9
> 
> 时间：2008-09-11T01:00:15.580

现在有一个非常可靠[的关于 NETTUTS 的系列正在进行中](http://net.tutsplus.com/tutorials/ruby/learn-ruby-on-rails-from-scratch-week-1/)，您可能会感兴趣。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2010-11-27T03:12:21.853

[http://railsforzombies.org/](http://railsforzombies.org/)是一个不错的选择。引入了一种在浏览器中学习 Ruby on Rails 的全新方式，无需额外配置。

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2008-09-15T15:48:40.890

和你一样，我是一名尝试学习更多 Ruby On Rails 的 java/C# 开发人员。

我正在参加免费的在线课程[Ruby on Rails Programming with Passion](http://www.javapassion.com/rubyonrails/)，这是一门很好的入门课程，请查看。

我们使用[NetBeans](http://www.netbeans.org/)作为 IDE (win/mac/linux/solaris)，如果您习惯 Eclipse 或 Visual Studio，您很有可能会喜欢它。

* * *

## 回答 #12

> 赞同：7
> 
> 时间：2011-07-10T08:47:31.283

很棒的决定！在使用 Rails 之前先了解 Ruby 是非常有用的，所以这里是我对 Rails 的最佳路径的看法：

*   [Learn to Program by Chris Pine](http://pine.fm/LearnToProgram/) - 您可以在一个下午阅读这篇文章，感受一下 Ruby 语言。
*   [David Black 的 The Well Grounded Rubyist](http://www.manning.com/black2/) - 正如标题所说，它将为您提供良好的语言基础。
*   [Russ Olsen 的 Eloquent Ruby](https://rads.stackoverflow.com/amzn/click/com/0321584104) - 这本书非常棒，读起来就像一本小说。
*   [Gregory Brown 的 Ruby Best Practices](http://rubybestpractices.com/) - 至此，您应该已经为本书的高级水平做好了准备。
*   [Rails for Zombies](http://railsforzombies.org/) - 一个下午即可完成的有趣教程。
*   [Rails Tutorial by Michael Hartl](http://ruby.railstutorial.org/) - 很棒的（免费）教程，我听说他附带的截屏视频很棒。
*   [由 Sam Ruby 使用 Rails 进行敏捷 Web 开发](http://pragprog.com/book/rails4/agile-web-development-with-rails)- 当你完成这个时，你现在是一个完全有能力的 Rails 人！

除了书本之外，最重要的是获得有关您所做工作的反馈。为此，我建议花时间在 irc.freenode.net #ruby 和 #rubyonrails 上。在 stackoverflow 上发布您正在处理或遇到问题的事情也非常有帮助，因为人们提供的评论、解释和对事物的不同思考方式非常宝贵。

你也绝对应该看看[Ruby Rogues 播客](http://rubyrogues.com/)，它们提供了宝贵的信息，评论员都是 Ruby 社区中非常受人尊敬的人。为了您的观看和阅读乐趣（按此顺序），请前往 Ryan Bates 的[Railscasts](http://railscasts.com/)和 Eifion Bedford 的[Asciicasts](http://asciicasts.com/)。

最后，我建议在 github 上查看不同的 gem，阅读代码，然后为它们做出贡献。您不必过于雄心勃勃并进行大量重新编码，尤其是在开始时。只需从一些小事开始，例如编辑和使 README 文件更易于阅读。

我不使用 IDE，但在 Railsconf 上我看到了 Jetbrains 的[Rubymine](http://www.jetbrains.com/ruby/)演示，它看起来非常棒。

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2009-11-05T15:54:52.133

0) 首先学习红宝石。这个非常重要。Rails 的一个巨大优势是 Ruby：一种很棒的语言，它非常强大，但也非常容易被误解。在线浏览一些 Ruby 教程。当 Daily WTF 出现编码挑战时，请用 Ruby 编写它们。你会很快把它捡起来。

1）去买书“Ruby for Rails”

2) 查看 Rails 教程并订阅[Riding Rails](http://weblog.rubyonrails.org/)博客。

3）在本地建立一个应用程序。不要使用脚手架。

4）当你在你的应用程序中安装插件时，去看看那个插件中的代码（在你的供应商目录中）并学习它。这是学习 Ruby 和 Rails 内部结构的最佳方法之一。当您不了解某事的工作原理时，请在此处发布，1000 人会帮助您。

至于你的其他问题：

是的，您需要在 Linux 环境中进行开发。您*可以*在 Windows 上开发 Rails，但这并不意味着应该这样做。许多 gem 在 Windows 上跟不上速度。

NetBeans 作为 IDE 运行良好。如果你在 Mac 上，你会因为使用 Textmate 而获得街头信誉。

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2010-07-12T04:20:08.723

我很惊讶很少有人提到Why's (Poignant) Guide to Ruby。为什么可能不再存在，但该指南很容易在网上找到（[谷歌首先指出](http://mislav.uniqpath.com/poignant-guide/ "为什么是 Ruby 的辛酸指南")）它很容易阅读并提供了我对 Ruby 的介绍。

在指南之后，我会推荐其他人推荐的任何一本书，或者按照[Learning Rails](http://learningrails.com)上的一系列截屏视频，这就是我如何获得足够多的 Ruby on Rails 危险。一旦你完成了 Learning Rails 系列。你想用 Rails 做什么将开始偏离一般教程，这就是[Railscasts](http://railscasts.com)成为一个很棒的工具的地方。Railscasts 在某些时候没有涉及到 Rails，没有什么可以做的。

* * *

## 回答 #15

> 赞同：5
> 
> 时间：2010-07-12T04:25:23.457

找到附近的 Ruby 用户组并开始参加。我发现这是结识许多对发展充满热情并愿意教书的人的好方法。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2010-07-12T04:34:34.067

我的第一个建议是先了解一下[符号](http://www.robertsosinski.com/2009/01/11/the-difference-between-ruby-symbols-and-strings/)。Rails 不是有史以来最小的框架，虽然肯定有很多东西要学，但如果你至少对它与其他语言的不同（“特殊”）有一点了解，它的大部分内容就会开始变得有意义。正如所指出的，在任何主要语言中都没有确切的类比，但是 Rails 大量使用它们，以使内容易于阅读并表现良好，这就是我提出它的原因。我第一次接触 Rails 也是我第一次看 Ruby（远在 2.0 之前），首先引起我注意的是`:things`他们路过的傻瓜，我问，“WTF 是*这样*吗？”

另外，查看[RubyQuiz](http://www.rubyquiz.com/)并阅读该网站上其他人的答案。

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2008-09-11T02:03:32.077

我是从 Java 出身到 Ruby 来的。我发现本教程很有帮助[http://www.ruby-lang.org/en/documentation/ruby-from-other-languages/to-ruby-from-java/](http://www.ruby-lang.org/en/documentation/ruby-from-other-languages/to-ruby-from-java/)。说到学习 rails，我不能说我使用了多少脚本\控制台。它允许您使用代码并学习如何做您不确定的事情。

我买过的唯一一本书是 Agile Web Development with Rails，第三版[http://www.pragprog.com/titles/rails3/agile-web-development-with-rails-third-edition](http://www.pragprog.com/titles/rails3/agile-web-development-with-rails-third-edition)。它非常有用，并且很好地概述了 Rails 框架。除此之外，我还经常观看 Railscasts ( [http://railscasts.com](http://railscasts.com) )，这是一个很棒的屏幕投射博客，涵盖了各种 Rails 主题。

我个人更喜欢使用 Linux（因为 git 效果更好）。但是，我也使用过 windows，除了 git，我认为操作系统的选择不会影响你的编程。

我在 IDE 中使用 netbeans，偶尔使用 vim（使用 rails 插件）。我喜欢 netbeans，但我发现它在 Rails 支持方面仍然有点不稳定（并非所有功能都始终有效）。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2008-09-12T19:54:09.780

对于像我这样从 PHP 转向 RoR 的人来说，这看起来是一个很好的资源

[http://railsforphp.com/](http://railsforphp.com/)还有一本书[Rails for PHP Developers](http://www.pragprog.com/titles/ndphpr)

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2010-03-26T21:19:56.107

我曾经在 Windoze 上做 Java 和 C#。

我会支持这些来源：

**IDE**：尝试 Apatana RadRails 3 先睹为快：[http](http://www.radrails.org/3) ://www.radrails.org/3 。它是最接近 Visual Studio 的东西。我到处玩它，但仍然喜欢 Textmate 的轻盈。

**操作系统**：Mac OS 得到了 Ruby 社区的最多（如果不是全部的话）的喜爱。其他任何事情都被视为私生子。

**书籍**：

*   实用程序员指南（镐书）
*   使用 Rails 进行敏捷 Web 开发

**截屏**：

*   Peepcode（付费）是一种快速掌握概念的好方法
*   [Railscasts（免费）](http://railscasts.com/)是每周一次逐步获取新宝石和概念的好方法
*   [Railscasts (pro)](http://railscasts.com/pro)也是以相当低的价格获取概念的好方法。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2008-09-11T01:22:34.000

Rails 的任何东西的 ubber 来源都是[http://www.rubyonrails.org/](http://www.rubyonrails.org/)如果他们在网站上没有它，你可能不需要它。

快速食谱是 Ruby on Rails: Up and Running 您可以从 O'Rielly 获得它或在 Google 上搜索在线版本。他们会引导您了解 Rails 的约定并使用 Instant Rails，这没问题。

一本更好的 Rails 书籍“使用 Rails 进行敏捷 Web 开发” 这是 Rails 的精华所在。它会引导您下载和设置 Rails、Gems 以及所有内容。

如果你想成为一名 Java '人' 并想要一本过渡书，O'Reilly 有“Java 开发人员的 Rails” [http://oreilly.com/catalog/9780977616695/?CMP=AFC-ak_book&ATT=Rails+for+Java+Developers](http://oreilly.com/catalog/9780977616695/?CMP=AFC-ak_book&ATT=Rails+for+Java+Developers)

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2008-09-15T13:47:30.773

您可以尝试的另一个 IDE 是[Aptana](http://www.aptana.com/rails)。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2008-09-15T14:35:12.297

哦，我差点忘了。这里还有一些 Ruby 截屏资源：

[SD Ruby](http://podcast.sdruby.com/) - 有很多在线视频 - 我发现他们的 Rest talk SD9 和 SD10 是最好的介绍之一。其他休息谈话假设你什么都知道。这些是非常介绍性和重点的。

[Obie Fernandez](http://www.infoq.com/presentations/fernandez-restful-rails-apps)在 InfoQ - Restful Rails 上。我还阅读了他的 Rails Way 书，发现它内容丰富，但确实冗长而曲折，而且质量有点不一致。我从这本书中学到了很多东西，但我觉得必须通读重复和不相关的东西才能找到好的部分，这有点令人痛苦。

Netbeans 是一个不错的手持 IDE，如果您有耐心等待它的工具提示，它可以教您很多语言技巧（即使在非常快的机器上，它也是一个非常缓慢的 IDE），您可以使用 IDE 以图形方式浏览可用的发电机和类似的东西。获取最新版本，您甚至可以内置运行 Rspec 测试。

[Bort](http://jimneath.org/2008/09/09/bort-base-rails-application/)是一个预构建的基础应用程序，其中已经插入了许多标准插件。如果您下载它并使用它并弄清楚它是如何设置的，那么您创建自己的全功能应用程序就已经完成了一半。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2008-09-15T15:32:15.640

我的建议只是开始 - 选择一个你通常用来学习 MVC 风格语言的小项目（即带有数据库的东西，也许是一些基本的工作流程），然后当你需要学习一个概念时，使用一个（或两者的

使用 Rails或 Rails 方式[进行敏捷 Web 开发](http://pragprog.com/book/rails4/agile-web-development-with-rails)

了解它是如何工作的，然后尝试一下。

敏捷 Web 开发的问题在于它已经过时了，而且场景运行时间太长，以至于你真的不想构建一次。Rails 方式可能很难遵循，因为它从参考转向学习，但是当它很好时，它比敏捷 Web 开发更好。

但总的来说，它们都是好书，都适合学习，但它们都没有提供你想要遵循的“教育”路径。因此，我阅读了前者的几章（足以了解基本概念并学习如何引导第一个应用程序 - 也有一些在线文章对此也有帮助）然后才开始，然后每隔几天我就会阅读关于新事物或我使用书籍来理解某些事物。

还有一件事：这两本书都比 Ruby 书籍更多的是 Rails 书籍，如果你要编写干净的代码，那么尽早花一天时间学习 Ruby 语法是值得的。Why's Guide to Ruby 是一本不错的，还有其他的。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2010-03-02T00:30:13.770

我买了 Patrick Lenz 的书“Simply Rails 2”。
这本书很好地介绍了 Ruby 和 Ruby on Rails。
至于我的 ruby​​ 安装和数据库，我使用了 Cygwin。
它带有 PostgreSQL、ruby 和 svn。
我喜欢 PostgreSQL，因为我来自 Oracle
背景，所以感觉比 MySQL 更舒服。

我发现另一个非常有用的实用程序是
用于访问 PostgreSQL 数据库的 pgAdmin。

我需要做的第一件事是安装 gems。
我从 ruby​​forge
wget “ [http://rubyforge.org/frs/download.php/60718/rubygems-1.3.5.tgz](http://rubyforge.org/frs/download.php/60718/rubygems-1.3.5.tgz) ” 获得了 gems tar 文件

一旦我设置了 gems，我就安装了

rails
ruby​​-postgres
postgres
机架

我还需要一个问题跟踪系统，所以我安装了 redmine。
wget " [http://rubyforge.org/frs/download.php/60718/rubygems-1.3.5.tgz](http://rubyforge.org/frs/download.php/60718/rubygems-1.3.5.tgz) "

我发现在我的情况下使用类 UNIX 环境 (Cygwin) 更
可取，因为许多教程都是
针对 OS X 或 Linux 定制的。

我使用的文本编辑器是 Textpad。我正在寻找替代方案。我认为带有 rails 插件的 vim 可能会很好地工作。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2010-05-19T17:24:46.873

我来自非编程背景。我自学了 PHP，最近加入了一家专门研究 Ruby on Rails 的公司。他们有一个全面的 Rails 培训计划，它足够灵活，可以适应我们想要实施的任何改变。虽然我不是 Rails 专业人士，但我想分享一下我使用 Rails 的经验。我希望它有所帮助。

这是我正在遵循的路径[结合我正在使用的工具]

*   从一个简单的红宝石指南开始。这将有很大帮助，因为整个 Rails 框架都围绕类和对象展开。
*   环境和操作系统并不重要。虽然我在 Mac 上工作，但我经常在 Linux 和 Windows 上工作，我没有遇到任何问题。
*   从一本解释使用演示应用程序的好书开始。[我正在使用 Rails 的敏捷 Web 开发 - 实用书架]。还有很多其他的好书。
*   完成应用程序后，您将对框架有一个很好的了解。
    *   尝试理解 Active Record 模块生成的 SQL 查询。
    *   浏览 Rails 指南。您会发现该框架要容易得多。
*   保持练习。

几个小鬼点

*   完全学习一门语言需要数年时间。所以要有耐心，不要停止学习。
*   在需要时通过 rails api。[在开发您的第一个应用程序时]
*   谷歌你不明白的东西。人们写了关于几乎所有主题的精彩文章。
*   使用 Stackoverflow :-) [仅当您无法自己找到解决方案时。]
*   在您的手机或视频播放器上加载 railscast。在旅行或空闲时间观看。它们每个只有几分钟。你会学到很多东西，也会学到最好的做事方式。

工具

*   Shell [在 Mac 和 Ubuntu 中]
*   编辑器 [Mac 中的 Textmate、Ubuntu 中的 Gedit 和 Windows 中的 Notepad++]
*   安装了 Firebug 的 Firefox 用于测试。

最后我有一件事要说“继续努力”。祝一切顺利。

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2011-08-15T17:53:45.413

学习任何东西（包括 Ruby on Rails）的最快方法是结**对编程。**

找一个了解 Rails 的人，挑选一个示例应用程序，坐下来，修复错误，添加功能。

知识共享令人难以置信。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2008-09-11T15:09:51.747

[我认为Peepcode](http://peepcode.com/)的截屏视频和短书非常好。他们有截屏视频让您入门，并在您变得更高级时提供一些。

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2008-09-12T02:00:22.683

有一个名为[Softies on Rails](http://www.softiesonrails.com/)的网站，由几个前 .NET 开发人员编写，可能会有一些用处。他们有一本名为[Rails for .NET Developers](http://pragprog.com/titles/cerailn/rails-for-net-developers)的书将在未来几个月内出版……

我开始在 Windows 机器上使用 Eclipse 的[RadRails](http://www.aptana.com/rails)插件和 Dreamweaver 的[RubyWeaver](http://rubyweaver.gilluminate.com/)扩展（早在 Rails 的 1.x 时代）。从那以后，我搬到了一台运行 TextMate 的 Mac 上，并没有想过要回去。

至于书籍，我从 The Ruby Way 和 Agile Web Development with Rails 开始。当您开始进入 Rails 开发时，它肯定有助于建立 Ruby 的背景。

一定要看 Ryan Bates 的 Railscast 系列。

* * *

## 回答 #29

> 赞同：1
> 
> 时间：2008-09-15T13:41:57.980

我发现 Obie Fernandez 的“The Rails Way”非常出色，并且当使用 Rails 进行敏捷 Web 开发似乎还远远不够时，我经常提到它。Obie Fernandez 也有一个不错的[博客](http://obiefernandez.com/)。

* * *

## 回答 #30

> 赞同：1
> 
> 时间：2008-09-15T16:03:18.933

再等几个月，[Simon St. Laurent 和 Edd Dumbill 的 Learning Rails](http://oreilly.com/catalog/9780596518776/?CMP=AFC-ak_book&ATT=Learning+Rails)将在 11 月问世。这一系列的书非常棒，这本书将涵盖最新版本的 Rails。

* * *

## 回答 #31

> 赞同：1
> 
> 时间：2008-12-22T02:27:44.390

一旦您的环境启动并运行，这有助于为您提供用户可以登录的基本应用程序。

具有所有花里胡哨的宁静身份验证： [http ://railsforum.com/viewtopic.php?id=14216&p=1](http://railsforum.com/viewtopic.php?id=14216&p=1)

* * *

## 回答 #32

> 赞同：1
> 
> 时间：2009-01-12T17:54:38.437

我目前正在学习 RoR，这是我到目前为止所做的： 1\. 阅读并遵循 SitePoint 的“Simply Rails 2.2” 2\. 阅读并遵循 Oreilly 的“Rails, Up and Running”第二版。

这两本书很有启发性，并且采取了不同风格的相同方法；第二本书更激进一点，如果你有一些 RoR 知识，这很好。

如上所述，阅读资源时要格外小心，有很多过时的视频和文章。

* * *

## 回答 #33

> 赞同：1
> 
> 时间：2009-11-20T13:01:35.983

学习 Ruby 的好链接： [http ://en.wikibooks.org/wiki/Ruby_Programming](http://en.wikibooks.org/wiki/Ruby_Programming)

* * *

## 回答 #34

> 赞同：1
> 
> 时间：2009-12-07T15:19:05.730

只是为了 +1 使用 Rails 进行敏捷 Web 开发（但请确保您获得最新版本）- [http://pragprog.com/](http://pragprog.com/)

我在 Mac 上开发，这有时是有益的——它是一个非常受 Rails 开发人员欢迎的平台，所以您看到的许多博客文章都是面向 Mac 的。Linux 也很棒；）

最后——而且我与公司完全没有关系——当你确实有一些你想要上线的东西时，heroku 是一个不错的选择。找到一个便宜的 Rails 主机并不容易，所以这是一个很好的起点。不过，那里也有很多其他很棒的主持人！Heroku 确实需要 git 进行版本控制（尽管您可以在 subversion 之上使用它）。

祝你好运！

* * *

## 回答 #35

> 赞同：1
> 
> 时间：2009-12-18T05:19:22.907

Railscasts shmailcasts ... 1\. 想出一些你想开发的类型的应用程序。
2\. 花 20 分钟整理一些用户流程 3\. 阅读“使用 Rails 进行敏捷 Web 开发”的前几章，牢记您的项目 4\. 在 windows 或 mac 机器上安装 Netbeans 和 rails。两者都是一样的。5\. 开发您的应用程序 6\. 在您开发时咨询 bajillion 和一个在线参考资料。

* * *

## 回答 #36

> 赞同：1
> 
> 时间：2010-05-26T16:52:11.967

《使用 Rails 进行敏捷开发》一书是第一大教具。它有一个很好的栩栩如生的（ish）应用程序，它通过章节建立起来，因为它向您介绍了不同的概念。我完成了两次示例，之后我有了足够的知识来做自己的事情并依赖 Rails API 文档（[http://api.rubyonrails.org/](http://api.rubyonrails.org/)）。

* * *

## 回答 #37

> 赞同：1
> 
> 时间：2010-08-09T11:15:41.283

要学习 Ruby，请阅读[David Black 的“The Well-Grounded Rubyist”](http://www.manning.com/black2/)。它非常清晰，写得很好，组织得很好。**我读过的最好的技术书籍**（可能是十几本，因为我是一个相对较新的程序员）。

要学习 Rails，请阅读“ [Head First Rails](http://oreilly.com/catalog/9780596515775) ”。他们解释了所有神秘的部分是如何协同工作的。对这些愚蠢的事情要有耐心，并按照自己的方式处理这些例子——它会得到回报。（此外，为了保持一致性，请使用他们使用的任何版本的 Rails。您可以稍后升级。）

这两本书都假设您对 OOP 编程和 MVC 架构几乎一无所知。如果您确实知道一点，请不要略读，因为您可能会错误地假设事情。（例如，Ruby 对象没有公共属性，只有 getter 和 setter。但您可以使用一行自动创建多个 getter/setter，例如`attr_accessor :attr1, :attr2, :attr3`.）

* * *

## 回答 #38

> 赞同：1
> 
> 时间：2010-09-14T16:47:41.933

毫无疑问

[使用 Rails 进行敏捷 Web 开发](http://pragprog.com/book/rails4/agile-web-development-with-rails)

和

Rspec 书

为了好玩

高级 Rails 食谱

*   我会链接到其他两个，但 Stack Overflow 不会让我这样做。查看同一个站点。

* * *

## 回答 #39

> 赞同：1
> 
> 时间：2011-03-24T21:12:38.123

我很久以前看过臭名昭著的“15 分钟内写博客”视频，当时 Rails 可能大约是 1.0 版或类似的版本。Ruby/Rails 世界最重要的事情之一是，鉴于它是一个很棒的社区，与其他框架相比，它的变化快得离谱。

今天，Rails 与过去有很大不同，尽管主要意识形态保持不变。在过去的几年里，我已经学到了很多关于 Rails 的东西，但我仍然在不断地学习关于它的新东西。

对我来说最有价值的资源可以帮助我发现并跟上 Ruby 和 Rails 的最新方法：

*   [Rails Guides](http://guides.rubyonrails.org/) - 一种学习 Rails 本身的好方法，由社区编辑，由核心贡献者主持。该网站提供了很多关于 Rails 的大部分重要主题的内容，可以帮助您快速启动和运行。它涵盖了 bot 框架的最新稳定版本和边缘版本。

*   如果您了解 Rails 的主要思想，我绝对建议您查看（并订阅）Ryan Bates 的[Railscasts](http://www.railscasts.com)。让我引用该网站本身，我认为这很不言自明：

    > 每周，Ryan Bates 都会主持一期新的 Railscasts 节目，介绍 Ruby on Rails 的技巧和窍门。这些截屏视频很短，专注于一种技术，因此您可以快速将其应用到您自己的项目中。这些主题针对的是中级 Rails 开发人员，但初学者和专家也将从中获得一些东西。

*   还有很多关于 Ruby/Rails 的播客，我一直在听的两个是 [Ruby5](http://ruby5.envylabs.com/)和[Ruby Show](http://rubyshow.com/)。

*   对于 API 调用等更具体的问题，我推荐 APIDock 的[Rails](http://apidock.com/rails)和[Ruby](http://apidock.com/ruby)部分，您可以在其中获得有关特定方法的更多信息。

*   如果您对该框架更加熟悉，那么值得一看[Rails Best Practices](http://rails-bestpractices.com/)。有很多关于大多数人在开始使用 Rails 学习曲线时提出的某些问题的短文。该站点旨在指出这些问题并帮助初学者找到编写更好、更深思熟虑的代码的方法。您还可以使用一个[gem](https://github.com/flyerhzm/rails_best_practices)来扫描您的应用程序并指出这些问题并提供解决方案/解决方法。漂亮整齐！

这些资源应该可以帮助您开始使用 Rails。祝您在 Rails 世界之旅中好运，欢迎加入社区。

* * *

## 回答 #40

> 赞同：1
> 
> 时间：2012-01-19T16:41:32.740

这里有很多好的意见。我会添加这里没有的东西。我的经验：

*   [使用RailsInstaller](http://railsinstaller.org)在 Windows 上运行 Rails 很容易，尤其是在您使用 SQLite 时。
*   如果您想使用需要 C 扩展的 Ruby gem（例如 RMagick），安装会很困难且无法预测。
*   在 Windows 上安装 PostgreSQL 很痛苦，连接到 Rails 也很痛苦。
*   git 在 Windows 上不能正常工作。
*   IDE 体积庞大（Aptana）。记事本++已经足够好了。
*   Ubuntu 上的 Rails 很简单，需要 C 库的 gem 也能正常工作。
*   如果您的计算机足够强大，请使用 VirtualBox 或 VMWare Player，并使用 Ubuntu 虚拟机。

设置资源

*   [本页](http://www.rubypluspl.us/2012/01/new-year-updated-ubuntu-rails-setup.html)展示了如何在 Ubuntu 11.10 上设置 Ruby/Rails/PostgreSQL。
*   如果您不喜欢 RVM（我不喜欢），请使用[rbenv](https://github.com/sstephenson/rbenv)。RVM 和 rbenv 是管理多个 Ruby 版本的工具，包括 JRuby、Rubinius 等。

用于开发/测试的实时部署

*   实时部署可让您的朋友试用您的应用程序。它还可以更轻松地与需要回调 Rails 服务器的 Web 服务交互（例如 PayPal IPN 或 Twilio）。
*   Heroku.com 是我最喜欢部署的地方。
*   localtunnel.com 是一个很好的实用工具，可以将公开可见的 URL 指向您的本地 Rails 服务器。（我只将它用于基于 Windows 的 Rails 服务器）。

学习

*   试用网络上的教程。
*   使用 stackoverflow.com 提问。
*   在控制器中使用“raise Exception, params.to_s”来停止应用程序打印出所有驱动控制器的参数。这让我对数据如何在 Rails 应用程序中来回传输有了最大的了解。
*   使用 Rails 控制台（“rails 控制台”）检查数据，并在将代码片段嵌入模型或控制器之前试用它们。

* * *

## 回答 #41

> 赞同：0
> 
> 时间：2009-07-04T20:47:21.367

Ruby：我用了 Learn to program （在一个周末），Ruby Visual QuickStart（信不信由你，这本 QS 书“摆脱困境”非常棒）。这花了大约一周的时间。

Rails：我刚刚在“积极”的一周内完成了 Learn Rails。绝对觉得我有螺母和螺栓。这是我认为重要的2009年！

现在我打算把一本更高级的书和一个真实的项目结合起来。

IDE：如果您是 vim 迷，带有 rails 插件的 VIM 非常棒。否则，请尝试上述任何建议。

当然，railscast 等对最新的东西很有用。

* * *

## 回答 #42

> 赞同：0
> 
> 时间：2009-08-12T18:57:20.397

我的步骤是：

```
* Agile development with Rails (book)
* Railscasts - very useful, always learn something new.
* And of course the RoR API 
```

* * *

## 回答 #43

> 赞同：0
> 
> 时间：2009-09-16T06:25:08.527

书籍：Obie Fernandez 的 Rails Way IDE：Netbeans 或 TextMate。

* * *

## 回答 #44

> 赞同：0
> 
> 时间：2009-12-03T19:13:30.300

我公司三年来一直在开发知识管理和决策支持平台[mavenlive.com 。](http://www.mavenlive.com)在过去的几年里，我们学到了很多关于 Rails 的知识，下面是我的一些建议。

1.  切换到 Mac！您可以使用的工具和 Mac 上的开发环境使您的工作效率远高于 Windows。

2.  railcasts.com 拥有丰富的从初学者到专家的信息性截屏视频。您总能从 Ryan 的帖子中找到新的、更有效的做事方式。

3.  缩放 Rails 截屏视频与 NewRelic 相结合，为我们的应用程序性能提供了强大的洞察力，使我们能够有效地开发，同时对未来的可伸缩性问题保持警惕。

* * *

## 回答 #45

> 赞同：0
> 
> 时间：2009-12-11T22:54:22.667

阅读[guides.rails.info](http://guides.rails.info)上的所有指南，从[Rails 入门开始。](http://guides.rails.info/getting_started.html)它们写得很好，组织得很好，而且是最新的。

* * *

## 回答 #46

> 赞同：0
> 
> 时间：2009-12-18T05:01:32.353

[http://www.teachmetocode.com](http://www.teachmetocode.com)是学习 Ruby 和 Ruby on Rails 的绝佳资源。有涵盖 Rails 基础知识的截屏视频，以及关于如何使用 Ruby on Rails 创建 Twitter 克隆的 6 部分系列。

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2010-01-16T04:12:12.627

我实际上有一篇关于[开始使用 Rails](http://kconrails.com/getting-started-with-ruby-on-rails/)的文章，应该会有所帮助。它没有涵盖的问题的唯一部分是操作系统。Mac 是这里的主导者，信不信由你！但我愉快地使用 Ubuntu。有 gedit 插件可以让你非常接近 TextMate - 事实上，我更喜欢 gedit。

如果您在 Windows 机器上并且可以使用 linux，那绝对是一个更好的方法。Windows 上的 Rails 有很多问题。

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2010-02-10T08:42:04.363

[我在Neighborly 先生的 Humble Little Ruby Book](http://www.humblelittlerubybook.com/)的帮助下学习了 Ruby 。这是一个优秀的可免费下载的 Ruby 介绍，其中包含大量示例，我会 100% 推荐。

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2011-03-29T23:07:51.527

这里有一些很棒的建议！

我将列出的一些资源已经被提及，一些我认为没有。我绝对仍然不是专业人士，我只是在过去几个月里一直在学习，而且我的进步很快。这就是帮助我的原因：

1.  为什么是 Ruby 的辛酸指南：臭名昭著的 _why 对 Ruby 语言的精彩介绍。
2.  Agile web development with rails book：一本很好的书，有一些很好的深入跟进
3.  Michael Hartl 的 Rails 教程 (railstutotrial.org)：这是我最喜欢的资源。Hartl 引导您浏览演示应用程序并解释所有内容的风格让我很满意。
4.  Rails for Zombies - 经历了两次，非常适合加强基础知识。
5.  Railscasts - 我一开始就开始关注这个，但直到现在我才真正开始掌握 Rails，它们并没有帮助。在你把脚弄湿后，我会把这些留到最后。
6.  Think Vitamin's rails 教程也很不错。一开始我跟着这些屏幕截图，去感受语言，然后在最后再做一次。
7.  “Learning Rails”播客虽然已经过时（Rails 2），但也是一个很好的入门资源。我在开车/锻炼时听了这个。

我希望这有帮助！我远非专业人士，但我一头扎进，尽可能多地从多种资源中吸收。我上面提到的那些是最有帮助的！

哦，现在真正帮助我的是提出个人项目和设置某些任务。跟随很棒，但是当您在没有向导的情况下潜入水中时，您会真正学到东西！

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2011-05-11T06:43:42.597

试试这本书[http://ruby.railstutorial.org/ruby-on-rails-tutorial-book](http://ruby.railstutorial.org/ruby-on-rails-tutorial-book)

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2011-05-11T06:52:57.637

这也是一个很好的阅读 [http://guides.rubyonrails.org/](http://guides.rubyonrails.org/)

* * *

## 回答 #52

> 赞同：0
> 
> 时间：2011-06-08T20:56:43.690

我现在正在学习 Rails，如果您使用的是 Windows（假设使用 C# 开发人员），如果不能选择购买 Mac，我强烈建议您在 Linux 上学习。

如果您不想在您的硬盘上为 Ubuntu 创建单独的分区，我建议您查看[Wubi](http://www.ubuntu.com/download/ubuntu/windows-installer)，这是一个适用于 Ubuntu 的 Windows 安装程序。在 Ubuntu 上的 Rails 体验比在 Windows 上要少得多，我认为它类似于 OSX 开发环境，只是没有那么多的应用程序支持。我目前正在使用一个 alpha 文本编辑器[Redcar](http://redcareditor.com/)，它允许您拥有一些 textmate 的功能，即流行的 OSX 编辑器。

我读过的关于 Rails 的好书是 Cloves Carneiro Jr 和 Rida Al Barazi 所著的《Beginning Rails 3》。还有 Noel Rappin 的 Rails Test Prescriptions，关于以测试驱动的方法进行开发。

我最喜欢让我从业余爱好者转向关注的东西是 Ryan Bates 的[Railscasts](http://railscasts.com)。他通常每周一左右发布关于 Rails gems 的截屏视频，或者最近发布 Sass、SCSS、Coffeescript 和与 Rails 3.1 相关的技术。

我觉得对于任何初级程序员来说，必读的是[为什么（辛酸）指南 ruby](http://mislav.uniqpath.com/poignant-guide/book/chapter-1.html)​​ 。不幸的是 _why 就在我开始接触 Ruby 时消失了，但他的内容仍然分散在各种来源中。它具有古怪的幽默感，到最后您将非常了解 Ruby 的语法。

* * *

## 回答 #53

> 赞同：0
> 
> 时间：2011-06-21T03:11:39.407

我同意 srboisvert。不要在 Windows 上执行此操作。您可以将 Ubuntu（Linux 版本）添加到 Windows 并进行双启动。它需要一些工作，但它比违背常规并试图让所有东西都在 Widows 上运行更容易。

Ubuntu、Heroku 和 Git 运行良好。刚开始时要知道学习曲线很陡。聘请 Guru.com 或 Elance 的人来帮助您。

此外，在 Mac 上运行 Textmate 是首选解决方案，因此，如果您正在考虑购买 Mac 或可以使用 Mac，这是最好的选择。我认为您不需要太多的计算能力...

最后，我最喜欢的书是 Rails 的敏捷 Web 开发。谷歌搜索效果不太好，因为大部分信息来自旧版本的 Rails，并且已被弃用或不起作用。

* * *

## 回答 #54

> 赞同：0
> 
> 时间：2011-11-08T21:29:32.097

我在 Mac OS 上使用 RoR 和 textmate 进行编程，非常棒。

我建议使用“Programming Ruby 1.9”（The Pickaxe Book）for Ruby and Agile Web Development with Rails”来学习 Rails，两者均由 Pragmatic Bookshelf 出版。

祝你好运！

* * *

## 回答 #55

> 赞同：0
> 
> 时间：2012-02-07T02:37:01.843

我刚开始时也问了同样的问题——希望有一份关于学习 Rails 的规范性指南……找不到，所以决定我会为有一天可能会发现自己在类似船上的其他人写一个 :) 你可以找到在这里：

[学习 Ruby 和 Rails 的最佳方式](http://astonj.com/tech/best-way-to-learn-ruby-rails//)

（它现在实际上与官方 Ruby on Rails IRC 聊天室中的 !learn factoid 助手一起返回。）

* * *

## 回答 #56

> 赞同：0
> 
> 时间：2012-03-23T07:35:37.820

I have got up to speed with Ruby on Rails fairly quickly via this free online course which is currently being offered by UC Berkeley - [Software as a Service - Engineering Long Lasting Software](https://www.coursera.org/saas/auth/welcome) with instruction by [Armando Fox](http://www.eecs.berkeley.edu/Faculty/Homepages/fox.html) and [David Patterson](http://www.eecs.berkeley.edu/~pattrsn/). I can't speak highly enough of this course... it really was a privilege to learn Rails from these guys. And there is an active community on the course forums if you run into difficulty along the way. The first offering of the online course has now finished (as of 25 March, 2012) - the next time it will be run will be sometime in September of 2012.

它假定您是一个相当称职的开发人员，并让您在第二周开始使用 ruby​​，然后 Rails 从第三周一直运行到课程结束（五周）。您的作业由自动评分者标记。您将获得一个预构建的 Ubuntu VM 映像，其中预装了开发所需的一切（例如 Ruby、Rails、Rake、Gems、RSPec、Cucumber 等）。您所要做的就是在 MacOSX、Windows 和 Linux 上运行的（免费）VirtualBox 软件中启动 VM。

该课程有一本推荐的教科书……[在这里](http://beta.saasbook.info/)……但是您可以通过在线查看讲座和截屏来获得。

# asp.net - ASP.Net：如果我有 Session ID，我可以得到 Session 对象吗？

> ID：55576
> 
> 赞同：14
> 
> 时间：2008-09-11T00:52:25.053
> 
> 标签：asp.net, session

This question is related to [this one](https://stackoverflow.com/questions/43324/can-i-put-an-aspnet-session-id-in-a-hidden-form-field)，尽管我认为我在那里有点啰嗦，无法真正得到一个好的答案。我会保持简短。

我正在开发一个接受来自 aspx 页面的表单发布的 Web 处理程序 (ashx)。当处理程序收到此表单发布时，为了做它需要做的事情，它需要知道登录的用户（User.Identity.Name），但我不能依赖浏览器发送的cookie。

我知道我可以获取 Session.SessionID 并将其放置在隐藏的表单字段中，但是一旦我的处理程序收到表单帖子，我如何使用该 SessionID 来确定登录用户的身份？

我将 StateServer 模式用于会话状态。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T01:11:29.440

我认为您可以在 HttpHandler 上实现[IReadOnlySessionState接口](http://www.hanselman.com/blog/GettingSessionStateInHttpHandlersASHXFiles.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-10-27T17:30:51.733

Jonas 在这里发布了一个很好的答案：

[我可以将 ASP.Net 会话 ID 放在隐藏的表单字段中吗？](https://stackoverflow.com/questions/43324/can-i-put-an-aspnet-session-id-in-a-hidden-form-field#237682)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T01:40:11.303

除非需要直接使用会话，否则您始终可以将有关登录用户身份的任何信息存储在单例字典或缓存中，并通过存储在隐藏字段中的 SessionID 引用它。我个人在这方面看到了安全问题，但不会涉及这些问题。我会考虑为这种类型的实现发布一次性身份。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T01:38:53.337

在 HttpHandler 或 HttpModule 实现中，您不能总是从 BeginRequest 事件访问会话。您可以处理另一个事件，称为 OnAcquireRequestState。如果您在该事件中编写代码，则 HttpContext.Current.Session 不会为空。

# internet-explorer - 如何在 Mac 上的 Microsoft Internet Explorer 中测试我的网页？

> ID：55577
> 
> 赞同：35
> 
> 时间：2008-09-11T00:53:06.707
> 
> 标签：internet-explorer, macos, testing

我想测试我在所有现代版本的 Internet Explorer（6、7 和 8 beta）中创建的网页，但我主要在 Mac 上工作，通常无法直接访问 PC。

* * *

## 回答 #1

> 赞同：59
> 
> 时间：2008-09-11T00:53:35.130

**更新：**微软现在为各种版本的 IE 提供虚拟机映像，可以在所有主要的 OS X 虚拟化平台（[VirtualBox](https://www.virtualbox.org)、[VMWare Fusion](http://www.vmware.com/products/fusion/overview.html)和[Parallels](http://www.parallels.com/)）上使用。

从以下位置下载适当的图像：[https ://developer.microsoft.com/en-us/microsoft-edge/tools/vms/](https://developer.microsoft.com/en-us/microsoft-edge/tools/vms/)

* * *

在基于 Intel 的 Mac 上，您可以在虚拟机中运行 Windows。对于要测试的每个版本的 IE，您都需要一个虚拟机。

以下说明包括免费和合法的虚拟化软件和 Windows 磁盘映像。

1.  下载一些虚拟机软件。我们将使用的开发人员磁盘映像将与[VMWare Fusion](http://www.vmware.com/products/fusion/)或[Sun Virtual Box](http://www.virtualbox.org/)一起使用。VMWare 具有更多功能但售价 80 美元，另一方面，Virtual Box 更基本但对大多数用户免费（有关详细信息，请参阅[Virtual Box 许可常见问题解答](http://www.virtualbox.org/wiki/Licensing_FAQ)）。
2.  下载微软免费提供的 IE 开发者磁盘镜像：[http://www.microsoft.com/downloads/...](http://www.microsoft.com/downloads/details.aspx?FamilyId=21EABB90-958F-4B64-B5F1-73D0A413C8EF&displaylang=en)
3.  [使用MacPorts](http://www.macports.org)提供的[cabextract](http://www.cabextract.org.uk/)或源代码（感谢[Clinton](https://stackoverflow.com/users/6262/clinton) ）提取磁盘映像。
4.  [从http://www.kju-app.org/](http://www.kju-app.org/)下载 Q.app并将其放在 /Applications 文件夹中（您需要它来将磁盘映像转换为 VMWare/Virtual Box 可以使用的格式）

此时，该过程取决于您使用的 VM 软件。

**虚拟盒子用户**

1.  在您的 Mac 上打开一个 Terminal.app（您可以在 /Applications/Utilities 中找到它）并运行以下命令序列，将 input.vhd 替换*为*您开始的 VHD 文件的名称，并将*output.vdi*替换为该名称您希望最终的磁盘映像具有：

    ```
    /Applications/Q.app/Contents/MacOS/qemu-img convert -O raw -f vpc "input.vhd" temp.bin
    VBoxManage convertdd temp.bin "output.vdi"
    rm temp.bin
    mv "output.vdi" ~/Library/VirtualBox/VDI/
    VBoxManage modifyvdi "output.vdi" compact 
    ```

2.  启动 Virtual Box 并创建一个新的虚拟机
3.  选择刚刚创建的新 VDI 文件作为引导硬盘

**VMWare 融合用户**

1.  在您的 Mac 上打开一个 Terminal.app（您可以在 /Applications/Utilities 中找到它）并运行以下命令，将*input.vhd*和*output.vmdk*替换为您正在处理的 VHD 文件的名称和您想要的名称您生成的磁盘映像具有：

    ```
    /Applications/Q.app/Contents/MacOS/qemu-img convert -O vmdk -f vpc "input.vhd" "output.vmdk"
    mv "output.vmdk" ~/Documents/Virtual\ Machines.localized/ 
    ```

    这可能需要一段时间（在我的 2.4GHz Core 2 Duo MacBook w/2Gb RAM 上，每个磁盘映像大约需要 30 分钟）。

2.  启动 VMWare Fusion 并创建一个新的虚拟机
3.  在高级磁盘选项中选择“使用和现有磁盘”，找到刚刚创建的VMDK文件

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2012-04-30T17:28:43.473

我推荐三种不同的方法：

**基于云的交互式虚拟机**

使用类似[SauceLabs](https://saucelabs.com/)或[BrowserStack](http://browserstack.com/)的东西。您将能够选择一个浏览器，输入一个 url 并使用真正的操作系统和真正的浏览器，并根据您的需要进行测试和交互。这两者还支持设置往返您自己机器的隧道，因此任何本地主机名都可以正常工作。

还有[CrossBrowserTesting](http://crossbrowsertesting.com/)，[browserling](http://browserling.com/) / [testling](http://testling.com/)，它们似乎有类似的服务，虽然我自己没有使用过这些。

**本地虚拟化**

您可以使用[VirtualBox](http://www.virtualbox.org/)（免费和开源，类似于 VMWare 或 Parallels）在您的计算机上创建一个或多个虚拟机。您可能知道也可能不知道，但您不需要为这些虚拟机获取 Microsoft Windows 的正式副本。Microsoft 提供了简化的 Windows 安装的免费 VM 映像，用于测试 Internet Explorer 和 Microsoft Edge（**[下载](https://www.microsoft.com/en-us/download/details.aspx?displaylang=en&id=11575)**）。检查其中一篇文章以启动并运行它：

*   [在 Mac OS X 上测试](http://www.xairon.net/2011/06/testing-ie6-7-8-and-9-on-mac-os-x/)IE6、7、8 和 9，2011-06，xairon.net
*   [用于 Mac 的 Internet Explorer 的简单方法](http://osxdaily.com/2011/09/04/internet-explorer-for-mac-ie7-ie8-ie-9-free/)，2011 年 9 月，osxdaily.com

过去，还有本地 Mac 应用程序（例如[ies4osx](http://www.kronenberg.org/ies4osx/)），或者如果您没有 Windows，则需要 VM 的 Windows 应用程序（例如[IETester](http://www.my-debugbar.com/wiki/IETester/HomePage)或[MultipleIEs](http://tredosoft.com/Multiple_IE)）。缺点是这些仿真通常不如真正的客户端稳定，而且更难调试，因为它们不在浏览器的自然环境中运行。有时会导致在真实浏览器中不会发生的错误，并且可能没有真实浏览器会出现的错误。

**云端截图工厂**

如果您不需要交互性和/或需要更便宜的解决方案（请注意，这种方法可能并不总是更便宜，在做出假设之前做一些研究）还有在线服务，就像前一个一样，可以访问真正的浏览器/操作系统环境。但与前面相反，不授予对实际机器的交互访问权限，而只是获取屏幕截图。这既有好处也有坏处。缺点是您无法与之交互。然而，好处是其中大多数都可以轻松汇总屏幕截图，因此您不必一个接一个地开始会话并获取屏幕截图。

我用过的一些：

*   [BrowserShots](http://browsershots.org/)（免费并且曾经是我最喜欢的，虽然速度慢让替代品更具吸引力）
*   [Adobe BrowserLab](https://browserlab.adobe.com/)（也是免费的，需要 Adob​​e ID。没有 BrowserShots 那么多的选项和覆盖范围，但是：无延迟、即时截图、比较视图以及让截图在给定秒数后而不是立即截取的能力（到测试异步的东西）。
*   [CrossBrowserTesting](http://crossbrowsertesting.com/)（不是免费的，但也有一个交互环境（见上一个方法）和一个截图工厂，就像你自己的私有“BrowserShots”站点）

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-11T00:59:35.380

在 Mac 上虚拟化 Windows 后，您还可以尝试使用**Mutiple IE**安装程序来获得各种风格的 Internet Explorer，而无需创建单独的 VM 实例。

*   [多个 IE 安装程序](http://tredosoft.com/Multiple_IE)

如果您只想查看页面在各种浏览器中如何呈现的简单屏幕截图，您可以尝试免费服务**browsershots**，或者有许多服务会自动在多个浏览器中测试您的页面。

*   [browsershots.org](http://browsershots.org/)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-11T05:11:28.847

[Litmus](http://litmusapp.com/ "石蕊")是另一种基于网络的替代方案。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T01:01:28.450

如果您只想获取屏幕截图，[Browsershots是另一种选择。](http://browsershots.org/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-09-01T11:55:48.740

VHD 的最新版本（2009 年 1 月）存在问题。VHD 看到有硬件更改并提示输入许可证密钥，最终将用户锁定在外。目前还没有已知的解决方法。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-11T01:05:07.380

如果您没有可以在虚拟机中运行的 Windows 副本（VMware 也不是免费的），您可以尝试[IEs4Linux](http://www.tatanka.com.br/ies4linux/page/Does_IEs_4_Linux_Work_with_Mac_OSX)。它需要你在你的 Mac 上配置一些开源的东西，但它都是免费的。你至少需要 fink、wine 和 cabextract。有关某些特定命令行方向的信息，请参见上面的链接。没那么难！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T07:49:54.677

我不时使用 Codeweavers Crossover 产品来执行此操作。

[http://www.codeweavers.com/products/cxmac/](http://www.codeweavers.com/products/cxmac/)

这是与虚拟化不同的选择，与某些托管解决方案相比，它为您提供了更多的控制权。也就是说，它基于 WINE，因此您可能会遇到这样做的所有问题和问题。也就是说，对于没有插件的基本测试等，它工作得很好。

我不能 100% 确定是否支持 IE8，您需要检查一下，但它肯定会为您提供对 6 和 7 的原生支持。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-01-27T18:06:26.100

一旦它可用于 Mac，您就可以使用[Spoon 浏览器（基于 Web）。](http://spoon.net/Browsers/)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2012-02-25T02:31:42.117

[OSX Daily 解释了如何使用单个终端命令安装 Windows VM](http://osxdaily.com/2011/09/04/internet-explorer-for-mac-ie7-ie8-ie-9-free/)（假设您已经[安装了 VirtualBox](https://www.virtualbox.org/wiki/Downloads)）。总结一下：

即 7：

```
curl -s https://raw.github.com/xdissent/ievms/master/ievms.sh | IEVMS_VERSIONS="7" bash 
```

即 8：

```
curl -s https://raw.github.com/xdissent/ievms/master/ievms.sh | IEVMS_VERSIONS="8" bash 
```

即 9：

```
curl -s https://raw.github.com/xdissent/ievms/master/ievms.sh | IEVMS_VERSIONS="9" bash 
```

所有的IE！：

```
curl -s https://raw.github.com/xdissent/ievms/master/ievms.sh | bash 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-15T12:34:39.483

[有一个名为ies4osx](http://www.kronenberg.org/ies4osx/)的 IEs4 Linux 的 OSX 发行版，它在没有任何配置的情况下对我来说运行良好。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-01-21T04:25:23.420

Browsershots 很好，但如果您需要测试功能而不仅仅是整体视觉渲染，那么它就没有用了。

IEs4OSX 和 IEs4Linux 有严重的缺陷。他们对 Flash 和 Silverlight 等插件和扩展没有真正的支持。渲染不精确，而且非常不稳定。为了进行测试，您确实需要在 Windows 上运行的实际 IE 版本，但您不需要专用的盒子。

VirtualBox 上的 IE 图像确实是最好的，也是最简单的方法。

如果有人正在寻找视觉演练，我在这里有一个[截屏视频。](http://www.10voltmedia.com/blog/2008/12/screencast-install-internet-explorer-on-osx-using-virtualbox/)

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-01-21T17:47:21.257

另一个基于 Web 的替代方案（尽管正如 Jeff 所说，对测试功能没有多大用处）是[http://www.browsercam.com](http://www.browsercam.com)

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2008-09-15T19:24:26.907

如果这是一个商业网站（或一个重要的网站，它实际上在 IE 上运行很重要），那么不要走便宜的路线 - 投资一两台 Windows 机器。您的客户会感谢您的。

否则，虚拟化。

# asp.net - CSS 未应用于未经身份验证的 ASP.NET 页面

> ID：55594
> 
> 赞同：14
> 
> 时间：2008-09-11T01:01:53.720
> 
> 标签：asp.net, css

在开发（现场工作正常）时，我们网站的页面在用户通过身份验证（登录）之前不会选择正确的 CSS。

所以 Logon 和 Logoff 表单看起来很糟糕，但是一旦进入站点，CSS 就会再次起作用。

我猜这是某种身份验证问题？并没有真正深入研究它，因为它只是在开发时工作所以不是一个大问题，但很高兴知道如何解决它。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-01-06T18:51:24.837

要允许未经身份验证的用户查看您的 .css 文件（或任何其他文件/目录），您可以将 location 元素添加到指向 .css 文件的 web.config 文件。

```
<configuration>
   <system.web>
      // system.web configuration settings.
   </system.web>
   <location path="App_Themes/Default/YourFile.css">
      <system.web>
         <authorization>
            <allow users="*"/>
         </authorization>
      </system.web>
   </location>
</configuration> 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-11T01:03:35.853

检查并确保 CSS 文件本身不在您要保护的区域中。如果需要，您可以通过 web.config 手动排除该文件。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2013-05-29T16:23:39.537

我自己也遇到了这个问题，手动添加位置没有任何区别。我发现我已授予 IIS_IUSRS 对文件夹的访问权限，因此我的应用程序池访问文件没有问题，但 IIS 使用 IUSR 帐户进行匿名访问。

为了解决这个问题，我打开了 IIS 管理器 -> IIS：身份验证 -> 选择“匿名身份验证” -> 单击操作：编辑 ..（或右键单击）-> 选择“应用程序池标识”

现在匿名访问尝试使用具有正确文件权限的 IIS_IUSRS。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-11T01:06:16.050

您可以尝试使用[Fiddler](http://fiddler2.com/fiddler2/)或[HttpWatch](http://httpwatch.com/)之类的工具，并检查登录页面是否确实有请求访问 .css 文件。验证返回码是否为 200。可能是因为您的开发框中的相对路径问题。

# asp.net - Gridview ItemTemplate 中多个评估字段的最佳技术？

> ID：55607
> 
> 赞同：34
> 
> 时间：2008-09-11T01:11:08.240
> 
> 标签：asp.net, data-binding, gridview, eval

在 GridView ItemTemplate 中使用多个 EVAL 字段的最佳方法是什么？

希望对外观格式以及设置超链接/javascript等有一些控制。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2008-09-11T02:10:35.380

IMO 更清楚的是：

```
<%# String.Format("{0} - {1}", Eval("Name1"), Eval("Name2")) %> 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-11T01:21:44.313

我以前用过这个（不好，我知道）：

```
<%# Eval("Name1", "{0} - ")%> <%#Eval("Name2")%> 
```

结果 = '约翰 - 史密斯'

但刚刚发现我也可以将两个（或更多）Evals 放在同一个数据绑定组中：

```
<%#Eval("Name1") & " - " & Eval("Name2")%> 
```

结果 = '约翰 - 史密斯'

或者

```
<%# "First Name - " & Eval("Name1") & ", Last Name - " & Eval("Name2")%> 
```

结果 = '名字 - 约翰，姓氏 - 史密斯'

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-11T02:23:46.503

Eval 和 Bind 都很糟糕。
为什么要通过反射获取属性？您可以像这样直接访问它：

```
((MyObject)Container.DataItem).MyProperty

```

这不像在运行时您不知道该对象。无论如何，那是我的两分钱。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-04-09T21:17:45.717

我有一个最简单的方法来做同样的事情......

```
<asp:Label ID="lblName" runat="server" Text='<%#Eval("FirstName").ToString() +", "+ Eval("LastName").ToString() %>'></asp:Label> 
```

.

```
<%#Eval("FirstName").ToString() +", "+ Eval("LastName").ToString() %> 
```

Here both objects are converted into string the concatenate them.

# javascript - JavaScript 私有方法

> ID：55611
> 
> 赞同：523
> 
> 时间：2008-09-11T01:12:39.030
> 
> 标签：javascript, oop, private-methods

要使用公共方法创建 JavaScript 类，我会执行以下操作：

```
function Restaurant() {}

Restaurant.prototype.buy_food = function(){
   // something here
}

Restaurant.prototype.use_restroom = function(){
   // something here
} 
```

这样我班的用户可以：

```
var restaurant = new Restaurant();
restaurant.buy_food();
restaurant.use_restroom(); 
```

如何创建可以由`buy_food`and`use_restroom`方法调用但不能由类的用户在外部调用的私有方法？

换句话说，我希望我的方法实现能够做到：

```
Restaurant.prototype.use_restroom = function() {
   this.private_stuff();
} 
```

但这不应该工作：

```
var r = new Restaurant();
r.private_stuff(); 
```

我如何定义`private_stuff`为私有方法，以便这两个都成立？

我已经阅读了[Doug Crockford 的](http://javascript.crockford.com/private.html)文章几次，但似乎“私有”方法不能被公共方法调用，而“特权”方法可以在外部调用。

* * *

## 回答 #1

> 赞同：439
> 
> 时间：2008-09-11T01:26:52.583

你可以这样做，但缺点是它不能成为原型的一部分：

```
function Restaurant() {
    var myPrivateVar;

    var private_stuff = function() {  // Only visible inside Restaurant()
        myPrivateVar = "I can set this here!";
    }

    this.use_restroom = function() {  // use_restroom is visible to all
        private_stuff();
    }

    this.buy_food = function() {   // buy_food is visible to all
        private_stuff();
    }
} 
```

* * *

## 回答 #2

> 赞同：201
> 
> 时间：2014-08-07T01:34:39.930

# 使用自调用函数并调用

JavaScript 使用[原型](http://en.wikipedia.org/wiki/Prototype-based_programming)并且没有像面向对象语言那样的类（或方法）。JavaScript 开发人员需要在 JavaScript 中思考。

维基百科引用：

> 与许多面向对象的语言不同，函数定义和方法定义之间没有区别。相反，区别发生在函数调用期间。当函数作为对象的方法被调用时，函数的本地 this 关键字将绑定到该对象以进行该调用。

使用[自调用函数](http://en.wikipedia.org/wiki/Immediately-invoked_function_expression)和[调用函数](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call)调用私有“方法”的解决方案：

```
var MyObject = (function () {

  // Constructor
  function MyObject(foo) {
    this._foo = foo;
  }

  function privateFun(prefix) {
    return prefix + this._foo;
  }

  MyObject.prototype.publicFun = function () {
    return privateFun.call(this, ">>");
  }

  return MyObject;

}()); 
```

```
var myObject = new MyObject("bar");
myObject.publicFun();      // Returns ">>bar"
myObject.privateFun(">>"); // ReferenceError: private is not defined 
```

[call 函数](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function/call)允许我们使用适当的上下文 ( ) 调用私有函数`this`。

# 使用 Node.js 更简单

如果您使用的是[Node.js](http://nodejs.org/)，则不需要[IIFE](http://en.wikipedia.org/wiki/Immediately-invoked_function_expression)，因为您可以利用[模块加载系统](http://nodejs.org/api/modules.html)：

```
function MyObject(foo) {
  this._foo = foo;
}

function privateFun(prefix) {
  return prefix + this._foo;
}

MyObject.prototype.publicFun = function () {
  return privateFun.call(this, ">>");
}

module.exports= MyObject; 
```

加载文件：

```
var MyObject = require("./MyObject");

var myObject = new MyObject("bar");
myObject.publicFun();      // Returns ">>bar"
myObject.privateFun(">>"); // ReferenceError: private is not defined 
```

# （新！）未来 JavaScript 版本中的本地私有方法

TC39[私有方法和 JavaScript 类的 getter/setter](https://github.com/tc39/proposal-private-methods)提案处于第 3 阶段。这意味着很快，JavaScript 将在本地实现私有方法！

请注意，现代 JavaScript 版本中已经存在[JavaScript 私有类字段。](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Private_class_fields)

这是如何使用它的示例：

```
class MyObject {

  // Private field
  #foo;

  constructor(foo) {
    this.#foo = foo;
  }

  #privateFun(prefix) {
   return prefix + this.#foo;
  }

  publicFun() {
    return this.#privateFun(">>");
  }

} 
```

您可能需要一个[JavaScript 转译器/编译器](https://babeljs.io)才能在旧的 JavaScript 引擎上运行此代码。

PS：如果您想知道为什么要使用`#`前缀，[请阅读此](https://github.com/tc39/proposal-private-fields/issues/14).

# （已弃用）带有 Bind 运算符的 ES7

警告：绑定运算符 TC39 命题即将失效[https://github.com/tc39/proposal-bind-operator/issues/53#issuecomment-374271822](https://github.com/tc39/proposal-bind-operator/issues/53#issuecomment-374271822)

bind 操作符`::`是一个 ECMAScript[提议](https://github.com/zenparsing/es-function-bind)，[在 Babel](https://babeljs.io/blog/2015/05/14/function-bind)（[阶段 0](https://babeljs.io/docs/plugins/preset-stage-0/)）中实现。

```
export default class MyObject {
  constructor (foo) {
    this._foo = foo;
  }

  publicFun () {
    return this::privateFun(">>");
  }
}

function privateFun (prefix) {
  return prefix + this._foo;
} 
```

* * *

## 回答 #3

> 赞同：164
> 
> 时间：2008-09-11T01:27:38.573

您可以像这样模拟私有方法：

```
function Restaurant() {
}

Restaurant.prototype = (function() {
    var private_stuff = function() {
        // Private code here
    };

    return {

        constructor:Restaurant,

        use_restroom:function() {
            private_stuff();
        }

    };
})();

var r = new Restaurant();

// This will work:
r.use_restroom();

// This will cause an error:
r.private_stuff(); 
```

此处有关此技术的更多信息：[http ://webreflection.blogspot.com/2008/04/natural-javascript-private-methods.html](http://webreflection.blogspot.com/2008/04/natural-javascript-private-methods.html)

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2008-09-11T02:30:32.540

在这些情况下，当您拥有公共 API 并且想要私有和公共方法/属性时，我总是使用模块模式。这种模式在 YUI 库中很流行，详细信息可以在这里找到：

[http://yuiblog.com/blog/2007/06/12/module-pattern/](http://yuiblog.com/blog/2007/06/12/module-pattern/)

这真的很简单，其他开发人员也很容易理解。举个简单的例子：

```
var MYLIB = function() {  
    var aPrivateProperty = true;
    var aPrivateMethod = function() {
        // some code here...
    };
    return {
        aPublicMethod : function() {
            aPrivateMethod(); // okay
            // some code here...
        },
        aPublicProperty : true
    };  
}();

MYLIB.aPrivateMethod() // not okay
MYLIB.aPublicMethod() // okay 
```

* * *

## 回答 #5

> 赞同：21
> 
> 时间：2012-02-15T05:43:12.013

这是我创建的课程，以了解 Douglas Crockford 在他的网站[Private Members in JavaScript中的建议](http://javascript.crockford.com/private.html)

```
function Employee(id, name) { //Constructor
    //Public member variables
    this.id = id;
    this.name = name;
    //Private member variables
    var fName;
    var lName;
    var that = this;
    //By convention, we create a private variable 'that'. This is used to     
    //make the object available to the private methods. 

    //Private function
    function setFName(pfname) {
        fName = pfname;
        alert('setFName called');
    }
    //Privileged function
    this.setLName = function (plName, pfname) {
        lName = plName;  //Has access to private variables
        setFName(pfname); //Has access to private function
        alert('setLName called ' + this.id); //Has access to member variables
    }
    //Another privileged member has access to both member variables and private variables
    //Note access of this.dataOfBirth created by public member setDateOfBirth
    this.toString = function () {
        return 'toString called ' + this.id + ' ' + this.name + ' ' + fName + ' ' + lName + ' ' + this.dataOfBirth; 
    }
}
//Public function has access to member variable and can create on too but does not have access to private variable
Employee.prototype.setDateOfBirth = function (dob) {
    alert('setDateOfBirth called ' + this.id);
    this.dataOfBirth = dob;   //Creates new public member note this is accessed by toString
    //alert(fName); //Does not have access to private member
}
$(document).ready()
{
    var employee = new Employee(5, 'Shyam'); //Create a new object and initialize it with constructor
    employee.setLName('Bhaskar', 'Ram');  //Call privileged function
    employee.setDateOfBirth('1/1/2000');  //Call public function
    employee.id = 9;                     //Set up member value
    //employee.setFName('Ram');  //can not call Private Privileged method
    alert(employee.toString());  //See the changed object

} 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2009-09-01T10:13:29.010

我想到了这个：编辑：实际上，有人已经链接到一个相同的解决方案。呸！

```
var Car = function() {
}

Car.prototype = (function() {
    var hotWire = function() {
        // Private code *with* access to public properties through 'this'
        alert( this.drive() ); // Alerts 'Vroom!'
    }

    return {
        steal: function() {
            hotWire.call( this ); // Call a private method
        },
        drive: function() {
            return 'Vroom!';
        }
    };
})();

var getAwayVechile = new Car();

hotWire(); // Not allowed
getAwayVechile.hotWire(); // Not allowed
getAwayVechile.steal(); // Alerts 'Vroom!' 
```

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2019-12-25T01:17:27.630

您现在可以使用[es10 私有方法](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Classes/Class_fields#Private_Methods)来执行此操作。您只需要`#`在方法名称之前添加一个。

```
class ClassWithPrivateMethod {
  #privateMethod() {
    return 'hello world';
  }

  getPrivateMessage() {
    return #privateMethod();
  }
} 
```

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2013-08-14T03:06:00.707

我认为由于对闭包缺乏了解，此类问题一次又一次地出现。Сlosures 是 JS 中最重要的东西。每个 JS 程序员都必须去感受它的精髓。

**1.**首先我们需要做单独的范围（闭包）。

```
function () {

} 
```

**2.**在这方面，我们可以为所欲为。没有人会知道。

```
function () {
    var name,
        secretSkills = {
            pizza: function () { return new Pizza() },
            sushi: function () { return new Sushi() }
        }

    function Restaurant(_name) {
        name = _name
    }
    Restaurant.prototype.getFood = function (name) {
        return name in secretSkills ? secretSkills[name]() : null
    }
} 
```

**3.**为了让全世界知道我们的餐厅班，我们必须从关闭中归还它。

```
var Restaurant = (function () {
    // Restaurant definition
    return Restaurant
})() 
```

**4.**最后，我们有：

```
var Restaurant = (function () {
    var name,
        secretSkills = {
            pizza: function () { return new Pizza() },
            sushi: function () { return new Sushi() }
        }

    function Restaurant(_name) {
        name = _name
    }
    Restaurant.prototype.getFood = function (name) {
        return name in secretSkills ? secretSkills[name]() : null
    }
    return Restaurant
})() 
```

**5.**此外，这种方法具有继承和模板的潜力

```
// Abstract class
function AbstractRestaurant(skills) {
    var name
    function Restaurant(_name) {
        name = _name
    }
    Restaurant.prototype.getFood = function (name) {
        return skills && name in skills ? skills[name]() : null
    }
    return Restaurant
}

// Concrete classes
SushiRestaurant = AbstractRestaurant({ 
    sushi: function() { return new Sushi() } 
})

PizzaRestaurant = AbstractRestaurant({ 
    pizza: function() { return new Pizza() } 
})

var r1 = new SushiRestaurant('Yo! Sushi'),
    r2 = new PizzaRestaurant('Dominos Pizza')

r1.getFood('sushi')
r2.getFood('pizza') 
```

我希望这可以帮助某人更好地理解这个主题

* * *

## 回答 #9

> 赞同：10
> 
> 时间：2017-06-07T22:02:10.560

就个人而言，我更喜欢以下在 JavaScript 中创建类的模式：

```
var myClass = (function() {
    // Private class properties go here

    var blueprint = function() {
        // Private instance properties go here
        ...
    };

    blueprint.prototype = { 
        // Public class properties go here
        ...
    };

    return  {
         // Public class properties go here
        create : function() { return new blueprint(); }
        ...
    };
})(); 
```

如您所见，它允许您定义类属性和实例属性，每个属性都可以是公共的和私有的。

* * *

### 演示

```
var Restaurant = function() {
    var totalfoodcount = 0;        // Private class property
    var totalrestroomcount  = 0;   // Private class property

    var Restaurant = function(name){
        var foodcount = 0;         // Private instance property
        var restroomcount  = 0;    // Private instance property

        this.name = name

        this.incrementFoodCount = function() {
            foodcount++;
            totalfoodcount++;
            this.printStatus();
        };
        this.incrementRestroomCount = function() {
            restroomcount++;
            totalrestroomcount++;
            this.printStatus();
        };
        this.getRestroomCount = function() {
            return restroomcount;
        },
        this.getFoodCount = function() {
            return foodcount;
        }
    };

    Restaurant.prototype = {
        name : '',
        buy_food : function(){
           this.incrementFoodCount();
        },
        use_restroom : function(){
           this.incrementRestroomCount();
        },
        getTotalRestroomCount : function() {
            return totalrestroomcount;
        },
        getTotalFoodCount : function() {
            return totalfoodcount;
        },
        printStatus : function() {
           document.body.innerHTML
               += '<h3>Buying food at '+this.name+'</h3>'
               + '<ul>' 
               + '<li>Restroom count at ' + this.name + ' : '+ this.getRestroomCount() + '</li>'
               + '<li>Food count at ' + this.name + ' : ' + this.getFoodCount() + '</li>'
               + '<li>Total restroom count : '+ this.getTotalRestroomCount() + '</li>'
               + '<li>Total food count : '+ this.getTotalFoodCount() + '</li>'
               + '</ul>';
        }
    };

    return  { // Singleton public properties
        create : function(name) {
            return new Restaurant(name);
        },
        printStatus : function() {
          document.body.innerHTML
              += '<hr />'
              + '<h3>Overview</h3>'
              + '<ul>' 
              + '<li>Total restroom count : '+ Restaurant.prototype.getTotalRestroomCount() + '</li>'
              + '<li>Total food count : '+ Restaurant.prototype.getTotalFoodCount() + '</li>'
              + '</ul>'
              + '<hr />';
        }
    };
}();

var Wendys = Restaurant.create("Wendy's");
var McDonalds = Restaurant.create("McDonald's");
var KFC = Restaurant.create("KFC");
var BurgerKing = Restaurant.create("Burger King");

Restaurant.printStatus();

Wendys.buy_food();
Wendys.use_restroom();
KFC.use_restroom();
KFC.use_restroom();
Wendys.use_restroom();
McDonalds.buy_food();
BurgerKing.buy_food();

Restaurant.printStatus();

BurgerKing.buy_food();
Wendys.use_restroom();
McDonalds.buy_food();
KFC.buy_food();
Wendys.buy_food();
BurgerKing.buy_food();
McDonalds.buy_food();

Restaurant.printStatus();
```

另请参阅[**此 Fiddle**](https://jsfiddle.net/0yL21mr6/1/)。

* * *

## 回答 #10

> 赞同：9
> 
> 时间：2008-09-15T13:47:18.217

所有这些关闭都会让你付出代价。确保您测试速度影响，尤其是在 IE 中。您会发现使用命名约定会更好。仍然有很多企业网络用户被迫使用 IE6...

* * *

## 回答 #11

> 赞同：9
> 
> 时间：2020-10-23T17:18:05.377

## ES2021 / ES12 - 私有方法

私有方法名称以哈希`#`前缀开头，并且**只能**在定义它的类内部访问。

```
class Restaurant {

  // private method
  #private_stuff() {
    console.log("private stuff");
  }

  // public method
  buy_food() {
    this.#private_stuff();
  }

};

const restaurant = new Restaurant();
restaurant.buy_food(); // "private stuff";
restaurant.private_stuff(); // Uncaught TypeError: restaurant.private_stuff is not a function 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2018-07-22T23:32:41.463

不要那么冗长。它是 Javascript。使用**命名约定**。

在 es6 类工作多年后，我最近开始了一个 es5 项目的工作（使用已经非常冗长的 requireJS）。我已经一遍又一遍地讨论了这里提到的所有策略，基本上归结为**使用命名约定**：

1.  Javascript 没有范围关键字，例如`private`. 其他进入 Javascript 的开发人员会预先知道这一点。因此，一个简单的命名约定就足够了。带有下划线前缀的简单命名约定解决了私有属性和私有方法的问题。
2.  出于速度原因，让我们利用 Prototype，但不要再冗长了。让我们尽量让 es5“类”看起来与我们在其他后端语言中可能期望的一样接近（并将每个文件视为一个类，即使我们不需要返回实例）。
3.  让我们用一个更现实的模块情况来演示（我们将使用旧的 es5 和旧的 requireJs）。

**我的工具提示.js**

```
 define([
        'tooltip'
    ],
    function(
        tooltip
    ){

        function MyTooltip() {
            // Later, if needed, we can remove the underscore on some
            // of these (make public) and allow clients of our class
            // to set them.
            this._selector = "#my-tooltip"
            this._template = 'Hello from inside my tooltip!';
            this._initTooltip();
        }

        MyTooltip.prototype = {
            constructor: MyTooltip,

            _initTooltip: function () {
                new tooltip.tooltip(this._selector, {
                    content: this._template,
                    closeOnClick: true,
                    closeButton: true
                });
            }
        }

        return {
            init: function init() {
               new MyTooltip();  // <-- Our constructor adds our tooltip to the DOM so not much we need to do after instantiation.
            }

            // You could instead return a new instantiation, 
            // if later you do more with this class.
            /* 
            create: function create() {
               return new MyTooltip();
            }
            */
        }
    }); 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2014-08-18T15:01:18.713

采用任何遵循 Crockford 的*私有*或*特权*模式的解决方案。例如：

```
function Foo(x) {
    var y = 5;
    var bar = function() {
        return y * x;
    };

    this.public = function(z) {
        return bar() + x * z;
    };
} 
```

在任何情况下，如果攻击者对 JS 上下文没有“执行”权限，他就无法访问任何“公共”或“私有”字段或方法。如果攻击者确实拥有该访问权限，他可以执行以下单行：

```
eval("Foo = " + Foo.toString().replace(
    /{/, "{ this.eval = function(code) { return eval(code); }; "
)); 
```

请注意，上面的代码对所有构造函数类型隐私都是通用的。这里的一些解决方案会失败，但应该清楚的是，几乎所有基于闭包的解决方案都可以像这样使用不同的`replace()`参数来破坏。

执行此操作后，任何创建的对象`new Foo()`都将具有一个`eval`方法，可以调用该方法来返回或更改构造函数闭包中定义的值或方法，例如：

```
f = new Foo(99);
f.eval("x");
f.eval("y");
f.eval("x = 8"); 
```

我可以看到的唯一问题是它不适用于只有一个实例并且它是在加载时创建的情况。但是没有理由实际定义原型，在这种情况下，攻击者可以简单地重新创建对象而不是构造函数，只要他有方法传递相同的参数（例如，它们是常量或从可用值计算）。

**在我看来，这几乎使 Crockford 的解决方案毫无用处。**由于“隐私”很容易打破他的解决方案的缺点（降低可读性和可维护性、降低性能、增加内存），因此基于“无隐私”原型的方法是更好的选择。

我通常使用前导下划线来标​​记方法`__private`和`_protected`字段（Perl 风格），但在 JavaScript 中拥有隐私的想法只是表明它是一种被误解的语言。

因此，除了他的第一句话外，**我不同意****[Crockford 。](http://crockford.com/javascript/private.html)**

**那么如何在 JS 中获得真正的隐私呢？**将所有需要私有的东西放在服务器端，并使用 JS 进行 AJAX 调用。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-11T03:10:32.367

模块模式的巅峰之作：[揭示模块模式](http://www.wait-till-i.com/2007/08/22/again-with-the-module-pattern-reveal-something-to-the-world/ "来自 Chris Heilemann，自然")

一个非常健壮的模式的一个巧妙的小扩展。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2008-09-29T10:39:21.760

如果您想要具有公共函数访问私有函数的能力的全部公共和私有函数，请为这样的对象布局代码：

```
function MyObject(arg1, arg2, ...) {
  //constructor code using constructor arguments...
  //create/access public variables as 
  // this.var1 = foo;

  //private variables

  var v1;
  var v2;

  //private functions
  function privateOne() {
  }

  function privateTwon() {
  }

  //public functions

  MyObject.prototype.publicOne = function () {
  };

  MyObject.prototype.publicTwo = function () {
  };
} 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2011-04-18T14:00:24.533

```
var TestClass = function( ) {

    var privateProperty = 42;

    function privateMethod( ) {
        alert( "privateMethod, " + privateProperty );
    }

    this.public = {
        constructor: TestClass,

        publicProperty: 88,
        publicMethod: function( ) {
            alert( "publicMethod" );
            privateMethod( );
        }
    };
};
TestClass.prototype = new TestClass( ).public;

var myTestClass = new TestClass( );

alert( myTestClass.publicProperty );
myTestClass.publicMethod( );

alert( myTestClass.privateMethod || "no privateMethod" ); 
```

与 georgebrock 类似，但不那么冗长（恕我直言）这样做有什么问题吗？（我在任何地方都没有看到）

编辑：我意识到这有点没用，因为每个独立的实例化都有自己的公共方法副本，从而破坏了原型的使用。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2013-10-30T23:09:33.953

那这个呢？

```
var Restaurant = (function() {

 var _id = 0;
 var privateVars = [];

 function Restaurant(name) {
     this.id = ++_id;
     this.name = name;
     privateVars[this.id] = {
         cooked: []
     };
 }

 Restaurant.prototype.cook = function (food) {
     privateVars[this.id].cooked.push(food);
 }

 return Restaurant;

})(); 
```

私有变量查找在立即函数的范围之外是不可能的。没有重复功能，节省内存。

缺点是查找私有变量很笨拙`privateVars[this.id].cooked`，打字很荒谬。还有一个额外的“id”变量。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2014-12-10T09:01:44.010

这是迄今为止我最喜欢的关于私有/公共方法/成员和 javascript 中的实例化的内容：

这是文章：[http ://www.sefol.com/?p=1090](http://www.sefol.com/?p=1090)

这是一个例子：

```
var Person = (function () {

    //Immediately returns an anonymous function which builds our modules 
    return function (name, location) {

        alert("createPerson called with " + name);

        var localPrivateVar = name;

        var localPublicVar = "A public variable";

        var localPublicFunction = function () {
            alert("PUBLIC Func called, private var is :" + localPrivateVar)
        };

        var localPrivateFunction = function () {
            alert("PRIVATE Func called ")
        };

        var setName = function (name) {

            localPrivateVar = name;

        }

        return {

            publicVar: localPublicVar,

            location: location,

            publicFunction: localPublicFunction,

            setName: setName

        }

    }
})();

//Request a Person instance - should print "createPerson called with ben"
var x = Person("ben", "germany");

//Request a Person instance - should print "createPerson called with candide"
var y = Person("candide", "belgium");

//Prints "ben"
x.publicFunction();

//Prints "candide"
y.publicFunction();

//Now call a public function which sets the value of a private variable in the x instance
x.setName("Ben 2");

//Shouldn't have changed this : prints "candide"
y.publicFunction();

//Should have changed this : prints "Ben 2"
x.publicFunction(); 
```

JSFiddle：http: [//jsfiddle.net/northkildonan/kopj3dt3/1/](http://jsfiddle.net/northkildonan/kopj3dt3/1/)

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2015-02-02T14:28:19.913

在大多数情况下，模块模式是正确的。但是如果你有数千个实例，类可以节省内存。如果节省内存是一个问题，并且您的对象包含少量私有数据，但有很多公共函数，那么您将希望所有公共函数都存在于 .prototype 中以节省内存。

这就是我想出的：

```
var MyClass = (function () {
    var secret = {}; // You can only getPriv() if you know this
    function MyClass() {
        var that = this, priv = {
            foo: 0 // ... and other private values
        };
        that.getPriv = function (proof) {
            return (proof === secret) && priv;
        };
    }
    MyClass.prototype.inc = function () {
        var priv = this.getPriv(secret);
        priv.foo += 1;
        return priv.foo;
    };
    return MyClass;
}());
var x = new MyClass();
x.inc(); // 1
x.inc(); // 2 
```

该对象`priv`包含私有属性。它可以通过 public function 访问，但是除非你将 传递给它，否则`getPriv()`这个函数会返回，而这只有在 main 闭包中才知道。`false``secret`

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2015-06-25T05:48:30.753

将所有代码包装在匿名函数中：然后，所有函数将是私有的，只有附加到`window`对象的函数：

```
(function(w,nameSpacePrivate){
     w.Person=function(name){
         this.name=name;   
         return this;
     };

     w.Person.prototype.profilePublic=function(){
          return nameSpacePrivate.profile.call(this);
     };  

     nameSpacePrivate.profile=function(){
       return 'My name is '+this.name;
     };

})(window,{}); 
```

用这个 ：

```
 var abdennour=new Person('Abdennour');
  abdennour.profilePublic(); 
```

# [小提琴](https://jsfiddle.net/abdennour/8nzgm64u/)

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2018-02-16T19:55:30.813

我更喜欢将私有数据存储在关联的`WeakMap`. 这允许您将公共方法保留在它们所属的原型上。对于大量对象，这似乎是处理此问题的最有效方法。

```
const data = new WeakMap();

function Foo(value) {
    data.set(this, {value});
}

// public method accessing private value
Foo.prototype.accessValue = function() {
    return data.get(this).value;
}

// private 'method' accessing private value
function accessValue(foo) {
    return data.get(foo).value;
}

export {Foo}; 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2011-05-29T19:37:04.127

私有函数不能使用模块模式访问公共变量

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2012-11-11T02:10:44.297

由于每个人都在这里发布他自己的代码，我也会这样做......

我喜欢 Crockford，因为他在 Javascript 中引入了真正的面向对象模式。但他也想出了一个新的误解，“那个”。

那么他为什么要使用“that = this”呢？它与私有函数完全无关。它与内部功能有关！

因为根据 Crockford 的说法，这是错误的代码：

```
Function Foo( ) {
    this.bar = 0; 
    var foobar=function( ) {
        alert(this.bar);
    }
} 
```

所以他建议这样做：

```
Function Foo( ) {
    this.bar = 0;
    that = this; 
    var foobar=function( ) {
        alert(that.bar);
    }
} 
```

所以正如我所说，我很确定 Crockford 对此的解释是错误的（但他的代码肯定是正确的）。还是他只是在愚弄 Javascript 世界，想知道谁在复制他的代码？我不知道...我不是浏览器极客；D

**编辑**

啊，就是这样：['var that = this;' 是什么意思？在 JavaScript 中是什么意思？](https://stackoverflow.com/questions/4886632/what-does-var-that-this-mean-in-javascript)

所以克罗基的解释真的错了......但他的代码是正确的，所以他仍然是一个很棒的人。:))

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2013-03-30T17:23:30.997

一般来说，我将私有对象 _ 临时添加到对象中。您必须在该方法的“Power-constructor”中明确打开隐私。如果您从原型调用该方法，您将能够覆盖原型方法

*   使公共方法在“Power-constructor”中可访问：（ctx 是对象上下文）

    ```
    ctx.test = GD.Fabric.open('test', GD.Test.prototype, ctx, _); // is a private object 
    ```

*   现在我有了这个 openPrivacy：

    ```
    GD.Fabric.openPrivacy = function(func, clss, ctx, _) {
        return function() {
            ctx._ = _;
            var res = clss[func].apply(ctx, arguments);
            ctx._ = null;
            return res;
        };
    }; 
    ```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2013-05-17T09:25:15.367

您必须在您的实际构造函数周围放置一个闭包，您可以在其中定义您的私有方法。要通过这些私有方法更改实例的数据，您必须将“this”作为函数参数或使用 .apply(this) 调用此函数：

```
var Restaurant = (function(){
    var private_buy_food = function(that){
        that.data.soldFood = true;
    }
    var private_take_a_shit = function(){
        this.data.isdirty = true;   
    }
    // New Closure
    function restaurant()
    {
        this.data = {
            isdirty : false,
            soldFood: false,
        };
    }

    restaurant.prototype.buy_food = function()
    {
       private_buy_food(this);
    }
    restaurant.prototype.use_restroom = function()
    {
       private_take_a_shit.call(this);
    }
    return restaurant;
})()

// TEST:

var McDonalds = new Restaurant();
McDonalds.buy_food();
McDonalds.use_restroom();
console.log(McDonalds);
console.log(McDonalds.__proto__); 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2013-08-14T18:49:07.407

这就是我的工作：

需要[您可以在此处找到](https://github.com/najamelan/TidBits_Javascript_OoJs)的一类糖代码。还支持受保护的、继承的、虚拟的、静态的东西……

```
;( function class_Restaurant( namespace )
{
    'use strict';

    if( namespace[ "Restaurant" ] ) return    // protect against double inclusions

        namespace.Restaurant = Restaurant
    var Static               = TidBits.OoJs.setupClass( namespace, "Restaurant" )

    // constructor
    //
    function Restaurant()
    {
        this.toilets = 3

        this.Private( private_stuff )

        return this.Public( buy_food, use_restroom )
    }

    function private_stuff(){ console.log( "There are", this.toilets, "toilets available") }

    function buy_food     (){ return "food"        }
    function use_restroom (){ this.private_stuff() }

})( window )

var chinese = new Restaurant

console.log( chinese.buy_food()      );  // output: food
console.log( chinese.use_restroom()  );  // output: There are 3 toilets available
console.log( chinese.toilets         );  // output: undefined
console.log( chinese.private_stuff() );  // output: undefined

// and throws: TypeError: Object #<Restaurant> has no method 'private_stuff' 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2013-12-10T17:02:29.120

```
Class({  
    Namespace:ABC,  
    Name:"ClassL2",  
    Bases:[ABC.ClassTop],  
    Private:{  
        m_var:2  
    },  
    Protected:{  
        proval:2,  
        fight:Property(function(){  
            this.m_var--;  
            console.log("ClassL2::fight (m_var)" +this.m_var);  
        },[Property.Type.Virtual])  
    },  
    Public:{  
        Fight:function(){  
            console.log("ClassL2::Fight (m_var)"+this.m_var);  
            this.fight();  
        }  
    }  
}); 
```

[https://github.com/nooning/JSClass](https://github.com/nooning/JSClass)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2014-01-16T16:18:11.673

我创建了一个新工具，允许您在原型 [https://github.com/TremayneChrist/ProtectJS上拥有真正的私有方法](https://github.com/TremayneChrist/ProtectJS)

例子：

```
var MyObject = (function () {

  // Create the object
  function MyObject() {}

  // Add methods to the prototype
  MyObject.prototype = {

    // This is our public method
    public: function () {
      console.log('PUBLIC method has been called');
    },

    // This is our private method, using (_)
    _private: function () {
      console.log('PRIVATE method has been called');
    }
  }

  return protect(MyObject);

})();

// Create an instance of the object
var mo = new MyObject();

// Call its methods
mo.public(); // Pass
mo._private(); // Fail 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2015-01-28T11:14:18.203

我知道这有点太晚了，但是这个怎么样？

```
var obj = function(){
    var pr = "private";
    var prt = Object.getPrototypeOf(this);
    if(!prt.hasOwnProperty("showPrivate")){
        prt.showPrivate = function(){
            console.log(pr);
        }
    }    
}

var i = new obj();
i.showPrivate();
console.log(i.hasOwnProperty("pr")); 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2016-05-10T14:37:52.670

这个问题已经有很多答案了，但没有一个能满足我的需要。所以我想出了自己的解决方案，我希望它对某人有用：

```
function calledPrivate(){
    var stack = new Error().stack.toString().split("\n");
    function getClass(line){
        var i = line.indexOf(" ");
        var i2 = line.indexOf(".");
        return line.substring(i,i2);
    }
    return getClass(stack[2])==getClass(stack[3]);
}

class Obj{
    privateMethode(){
        if(calledPrivate()){
            console.log("your code goes here");
        }
    }
    publicMethode(){
        this.privateMethode();
    }
}

var obj = new Obj();
obj.publicMethode(); //logs "your code goes here"
obj.privateMethode(); //does nothing 
```

正如你所看到的，当在 javascript 中使用这种类型的类时，这个系统可以工作。据我所知，上面评论的方法都没有。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2020-09-03T10:56:00.920

一个丑陋的解决方案，但它有效：

```
function Class(cb) {
    const self = {};

    const constructor = (fn) => {
        func = fn;    
    };

    const addPrivate = (fnName, obj) => {
        self[fnName] = obj;
    }

    const addPublic = (fnName, obj) => {
        this[fnName] = obj;
        self[fnName] = obj;
        func.prototype[fnName] = obj;
    }

    cb(constructor, addPrivate, addPublic, self);
    return func;
}

const test = new Class((constructor, private, public, self) => {
    constructor(function (test) {
        console.log(test)
    });
    public('test', 'yay');
    private('qwe', 'nay');
    private('no', () => {
        return 'hello'
    })
    public('asd', () => {
        return 'this is public'
    })
    public('hello', () => {
        return self.qwe + self.no() + self.asd()
    })
})
const asd = new test('qweqwe');
console.log(asd.hello());
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2021-01-03T16:49:09.693

老问题，但这是一个相当简单的任务，可以用核心 JS**正确**解决......没有 ES6 的类抽象。事实上，据我所知，类抽象甚至不能解决这个问题。

我们可以使用良好的旧构造函数甚至更好地使用`Object.create()`. 让我们先使用构造函数。这本质上是与[georgebrock 的答案](https://stackoverflow.com/a/55638/4543207)类似的解决方案，因为`Restaurant`构造函数创建的所有餐厅都将具有相同的私有方法，因此受到批评。我会努力克服这个限制。

```
function restaurantFactory(name,menu){

  function Restaurant(name){
    this.name = name;
  }

  function prototypeFactory(menu){
    // This is a private function
    function calculateBill(item){
      return menu[item] || 0;
    }
    // This is the prototype to be
    return { constructor: Restaurant
           , askBill    : function(...items){
                            var cost = items.reduce((total,item) => total + calculateBill(item) ,0)
                            return "Thank you for dining at " + this.name + ". Total is: " + cost + "\n"
                          }
           , callWaiter : function(){
                            return "I have just called the waiter at " + this.name + "\n";
                          }
           }
  }

  Restaurant.prototype = prototypeFactory(menu);

  return new Restaurant(name,menu);
}

var menu = { water: 1
           , coke : 2
           , beer : 3
           , beef : 15
           , rice : 2
           },
    name = "Silver Scooop",
    rest = restaurantFactory(name,menu);

console.log(rest.callWaiter());
console.log(rest.askBill("beer", "beef"));
```

现在显然我们无法`menu`从外部访问，但我们可以轻松地重命名`name`餐厅的属性。

这也可以完成，`Object.create()`在这种情况下，我们跳过构造函数并简单地做 like `var rest = Object.create(prototypeFactory(menu))`并将 name 属性添加到`rest`对象之后 like `rest.name = name`。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2021-04-23T18:45:46.513

我知道这是一个老话题，但我试图找到一种方法来保持代码的“简单性”以实现可维护性并保持轻量级的内存负载。它带有这种模式。希望能帮助到你。

```
const PublicClass=function(priv,pub,ro){
    let _priv=new PrivateClass(priv,pub,ro);
    ['publicMethod'].forEach(k=>this[k]=(...args)=>_priv[k](...args));
    ['publicVar'].forEach(k=>Object.defineProperty(this,k,{get:()=>_priv[k],set:v=>_priv[k]=v}));
    ['readOnlyVar'].forEach(k=>Object.defineProperty(this,k,{get:()=>_priv[k]}));
};

class PrivateClass{
    constructor(priv,pub,ro){
        this.privateVar=priv;
        this.publicVar=pub;
        this.readOnlyVar=ro;
    }
    publicMethod(arg1,arg2){
        return this.privateMethod(arg1,arg2);
    }
    privateMethod(arg1,arg2){
        return arg1+''+arg2;
    }
}
// in node;
module.exports=PublicClass;
// in browser;
const PublicClass=(function(){
    // code here
    return PublicClass;
})(); 
```

旧浏览器的原理相同：

```
var PublicClass=function(priv,pub,ro){
    var scope=this;
    var _priv=new PrivateClass(priv,pub,ro);
    ['publicMethod'].forEach(function(k){
        scope[k]=function(){return _priv[k].apply(_priv,arguments)};
    });
    ['publicVar'].forEach(function(k){
        Object.defineProperty(scope,k,{get:function(){return _priv[k]},set:function(v){_priv[k]=v}});
    });
    ['readOnlyVar'].forEach(function(k){
        Object.defineProperty(scope,k,{get:function(){return _priv[k]}});
    });
};

var PrivateClass=function(priv,pub,ro){
    this.privateVar=priv;
    this.publicVar=pub;
    this.readOnlyVar=ro;
};
PrivateClass.prototype.publicMethod=function(arg1,arg2){
    return this.privateMethod(arg1,arg2);
};
PrivateClass.prototype.privateMethod=function(arg1,arg2){
    return arg1+''+arg2;
}; 
```

* * *

为了减轻公共类的冗长和负载，将此模式应用于构造函数：

```
const AbstractPublicClass=function(instanciate,inherit){
    let _priv=instanciate();
    inherit.methods?.forEach(k=>this[k]=(...args)=>_priv[k](...args));
    inherit.vars?.forEach(k=>Object.defineProperty(this,k,{get:()=>_priv[k],set:v=>_priv[k]=v}));
    inherit.readonly?.forEach(k=>Object.defineProperty(this,k,{get:()=>_priv[k]}));
};

AbstractPublicClass.static=function(_pub,_priv,inherit){
    inherit.methods?.forEach(k=>_pub[k]=(...args)=>_priv[k](...args));
    inherit.vars?.forEach(k=>Object.defineProperty(_pub,k,{get:()=>_priv[k],set:v=>_priv[k]=v}));
    inherit.readonly?.forEach(k=>Object.defineProperty(_pub,k,{get:()=>_priv[k]}));
}; 
```

采用 ：

```
// PrivateClass ...
PrivateClass.staticVar='zog';
PrivateClass.staticMethod=function(){return 'hello '+this.staticVar;};

const PublicClass=function(priv,pub,ro){
    AbstractPublicClass.apply(this,[()=>new PrivateClass(priv,pub,ro),{
        methods:['publicMethod'],
        vars:['publicVar'],
        readonly:['readOnlyVar']
    }]);
};
AbstractPublicClass.static(PublicClass,PrivateClass,{
    methods:['staticMethod'],
    vars:['staticVar']
}); 
```

* * *

PS：这种方法的默认值（大多数情况下可以忽略不计）与完整的公众相比，它可以占用很小的计算负载。但是，只要您不将它与高度请求的课程一起使用就可以了。

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2021-08-30T00:59:47.590

**2021在这里！**

当您尝试读取私有属性时，此 polyfill 有效地隐藏了您的私有属性和方法返回**undefined ，当您尝试执行私有方法时返回****TypeError**，从而有效地使它们对外部都是**私有**的，但让您可以使用公共方法访问它们.

如果你检查它，你会发现它很容易实现。在大多数情况下，您不需要做任何古怪的事情，例如使用 Proxy 对象、下划线函数 (_myprivate)、getter 或 setter。都不是。唯一需要做的就是在你的构造函数中放置一段代码，旨在让你向外界公开你的公共接口。

```
((self) => ({
      pubProp: self.pubProp,
      // More public properties to export HERE
      // ...
      pubMethod: self.pubMethod.bind(self)
      // More public mehods to export HERE
      // Be sure bind each of them to self!!!
      // ... 
 }))(self); 
```

上面的代码是魔法发生的地方。它是一个 IIFE，它返回一个对象，其中仅包含您想要公开并绑定到第一次实例化的对象的上下文的属性和方法。

您仍然可以访问隐藏的属性和方法，但只能通过您的公共方法，就像 OOP 应该做的那样。
将这部分代码视为您的**module.exports**

顺便说一句，这是没有使用最新的 ES6“ **#** ”添加到语言。

```
'use strict';

class MyClass {
  constructor(pubProp) {
    let self = this;
    self.pubProp = pubProp;
    self.privProp = "I'm a private property!";
    return ((self) => ({
      pubProp: self.pubProp,
      // More public properties to export HERE
      // ...
      pubMethod: self.pubMethod.bind(self)
      // More public mehods to export HERE
      // Be sure to bind each of them to self!!!
      // ... 
    }))(self);
  }

  pubMethod() {
    console.log("I'm a public method!");
    console.log(this.pubProp);

    return this.privMethod();
  }

  privMethod() {
    console.log("I'm a private method!");
  return this.privProp
  }
}

const myObj = new MyClass("I'm a public property!");
console.log("***DUMPING MY NEW INSTANCE***");
console.dir(myObj);
console.log("");
console.log("***TESTING ACCESS TO PUBLIC PROPERTIES***");
console.log(myObj.pubProp);
console.log("");
console.log("***TESTING ACCESS TO PRIVATE PROPERTIES***");
console.log(myObj.privProp);
console.log("");
console.log("***TESTING ACCESS TO PUBLIC METHODS***");
console.log("1\. pubMethod access pubProp ");
console.log("2\. pubMethod calls privMethod");
console.log("3\. privMethod access privProp");
console.log("")
console.log(myObj.pubMethod());
console.log("");
console.log("***TESTING ACCESS TO PRIVATE METHODS***");
console.log(myObj.privMethod());
```

[检查我的要点](https://git.io/JEPGi)

# css - CSS选择/样式第一个词

> ID：55612
> 
> 赞同：82
> 
> 时间：2008-09-11T01:13:56.110
> 
> 标签：css

这个让我有点难过。我想将我的#content div 中所有段落的第一个单词设为 14pt，而不是段落的默认值 (12pt)。有没有办法在直接的 CSS 中做到这一点，还是我把第一个单词放在一个跨度中来完成这个？

* * *

## 回答 #1

> 赞同：92
> 
> 时间：2008-09-11T01:18:21.560

您正在寻找的是一个不存在的伪元素。有`:first-letter`和`:first-line`，但没有`:first-word`。

你当然可以用 JavaScript 来做到这一点。这是我发现的一些代码：[http ://www.dynamicsitesolutions.com/javascript/first-word-selector/](http://www.dynamicsitesolutions.com/javascript/first-word-selector/)

* * *

## 回答 #2

> 赞同：36
> 
> 时间：2008-09-11T16:34:12.513

我不得不不同意 Dale... strong 元素实际上是使用错误的元素，暗示了内容的意义、用途或重点，而您只是打算为元素提供样式。

理想情况下，您可以使用伪类和样式表来完成此操作，但由于这是不可能的，您应该使您的标记在语义上正确并使用`<span class="first-word">`.

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2010-06-29T09:43:17.847

同样的事情，使用 jQuery：

```
$('#links a').each(function(){
    var me = $(this);
    me.html( me.text().replace(/(^\w+)/,'<strong>$1</strong>') );
  }); 
```

或者

```
$('#links a').each(function(){
    var me = $(this)
       , t = me.text().split(' ');
    me.html( '<strong>'+t.shift()+'</strong> '+t.join(' ') );
  }); 
```

（通过[jQuery 邮件列表](http://www.mail-archive.com/jquery-en@googlegroups.com/msg24374.html)中的“Wizzud” ）

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2015-03-24T20:36:53.617

可悲的是，即使有了 CSS 3 之类的东西，我们仍然没有`:first-word` `:last-word`使用纯 CSS 的 etc 之类的东西。值得庆幸的是，现在几乎所有的东西都有一个 JavaScript，这让我接受了我的建议。使用[nthEverything](https://github.com/FWeinb/nthEverything)和[jQuery](https://jquery.com/)，您可以扩展传统的 Pseudo 元素。

目前有效的 Pseudos 是：

*   `:first-child`
*   `:first-of-type`
*   `:only-child`
*   `:last-child`
*   `:last-of-type`
*   `:only-of-type`
*   `:nth-child`
*   `:nth-of-type`
*   `:nth-last-child`
*   `:nth-last-of-type`

并使用 nth Everything 我们可以将其扩展为：

*   `::first-letter`
*   `::first-line`
*   `::first-word`
*   `::last-letter`
*   `::last-line`
*   `::last-word`
*   `::nth-letter`
*   `::nth-line`
*   `::nth-word`
*   `::nth-last-letter`
*   `::nth-last-line`
*   `::nth-last-word`

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-11T01:17:08.333

您必须将单词包装在一个跨度中才能完成此操作。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2011-11-23T14:17:46.293

纯 CSS 解决方案：

使用 :first-line 伪类。

```
display:block;
Width:40-100px; /* just enough for one word, depends on font size */
Overflow:visible; /* so longer words don't get clipped.*/
float:left; /* so it will flow with the paragraph. */
position:relative; /* for typeset adjustments. */ 
```

没有测试那个。很确定它会为你工作。我之前已经将块规则应用于伪类。对于每个第一个单词，您可能会遇到固定宽度，因此 text-align:center; 并给它一个漂亮的背景或处理负面空间的东西。

希望这对你有用。:)

-Motekye

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-11T01:21:02.677

使用[强](http://www.w3schools.com/tags/tag_phrase_elements.asp)元素，这就是它的目的：

```
<div id="content">
    <p><strong>First Word</strong> rest of paragraph.</p>
</div> 
```

然后在您的样式表中为它创建一个样式。

```
#content p strong
{
    font-size: 14pt;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2013-02-19T22:35:26.980

这是我将一些 JavaScript 和 jQuery 放在一起用`<span>`标签包装每个段落的第一个单词。

```
$(function() {
    $('#content p').each(function() {
        var text = this.innerHTML;
        var firstSpaceIndex = text.indexOf(" ");
        if (firstSpaceIndex > 0) {
            var substrBefore = text.substring(0,firstSpaceIndex);
            var substrAfter = text.substring(firstSpaceIndex, text.length)
            var newText = '<span class="firstWord">' + substrBefore + '</span>' + substrAfter;
            this.innerHTML = newText;
        } else {
            this.innerHTML = '<span class="firstWord">' + text + '</span>';
        }
    });
}); 
```

然后，您可以使用 CSS 为`.firstWord`.

它并不完美，因为它不能解释每种类型的空白；但是，我相信它可以通过一些调整来完成您所追求的。

请记住，此代码只会在页面加载后执行，因此可能需要几秒钟才能看到效果。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-11T01:21:43.907

没有一个简单的 CSS 方法。您可能必须使用 JavaScript + Regex 才能跨度弹出。

理想情况下，第一个单词会有一个伪元素，但你不走运，因为这似乎不起作用。我们确实有 :first-letter 和 :first-line。

您可能可以使用 :after 或 :before 的组合来获得它，而无需使用跨度。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-11-14T18:42:05.303

使用 HTML+CSS 的简单方法：

```
TEXT A <b>text b</b>

<h1>text b</h1>

<style>
    h1 { /* the css style */}
    h1:before {content:"text A (p.e.first word) with different style";    
    display:"inline";/* the different css style */}
</style> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2021-10-01T11:06:06.790

您可以选择第一个字母或行

```
p::first-letter {
  font-weight: bold;
  color: red;
} 
```

[https://css-tricks.com/almanac/selectors/f/first-letter/](https://css-tricks.com/almanac/selectors/f/first-letter/)

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2016-11-01T12:12:23.450

在段落文本中插入跨度标记。例如 `<p><span>Hello</span>My Name Is Dot</p` ，然后设置第一个字母的样式。

# javascript - WebKit/Safari 的控制台 API 在哪里？

> ID：55633
> 
> 赞同：64
> 
> 时间：2008-09-11T01:23:24.700
> 
> 标签：javascript, console, safari

WebKit/Safari 支持控制台对象，这类似于 Firebug 所做的。但究竟支持什么？Firebug有一个[控制台文档](http://getfirebug.com/wiki/index.php/Console_API)，但在哪里可以找到 Safari/WebKit 的控制台文档？

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2008-09-11T01:39:25.520

支持的方法最初是：

*   `console.log()`
*   `console.error()`
*   `console.warn()`
*   `console.info()`

较新版本的 WebKit 还添加了以下方法，使 WebKit 控制台 API 几乎与[Firebug 的控制台 API](http://getfirebug.com/wiki/index.php/Console_API)相同：

*   `console.count()`
*   `console.debug()`
*   `console.profileEnd()`
*   `console.trace()`
*   `console.dir()`
*   `console.dirxml()`
*   `console.assert()`
*   `console.time()`
*   `console.profile()`
*   `console.timeEnd()`
*   `console.group()`
*   `console.groupEnd()`

（基于 WebKit nightly build WebKit-SVN-r37126 的新信息，在撰写本文时这些方法在 Safari 中不可用）

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2010-01-29T20:53:51.943

Apple 在 Safari 开发人员指南的[控制台](https://developer.apple.com/library/content/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Console/Console.html)部分中记录了控制台 API。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2011-01-15T06:52:40.997

我知道这是一个古老且已回答的问题，但您也可以打开控制台并键入`console.__proto__`，您将获得它支持的所有内容的可扩展列表。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-08-04T17:46:08.507

Firebug 的控制台 API 文档已移至此处：

[http://getfirebug.com/wiki/index.php/Console_API](http://getfirebug.com/wiki/index.php/Console_API)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-05-16T19:28:35.040

试试这个：

```
console.dir(console) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-15T12:08:12.997

Console 对象似乎有一个内置的“API”，以“私有属性”的形式，您可以通过在 Webkit javascript-console 中执行此操作来显示

```
> for(o in console) console.dir(o)
    _commandLineAPI
    log
    warn
    … 
```

_commandLineAPI：

```
> console.dir(_commandLineAPI)
  CommandLineAPI
    $0: "—"
    $1: "—"
    $2: "—"
    $3: "—"
    $4: "—"
    $$: bound: function () {
    $x: bound: function (xpath, context) {
    clear: bound: function () {
    copy: bound: function (object) {
    dir: bound: function () {
    dirxml: bound: function () {
    inspect: bound: function (object) {
    keys: bound: function (object) {
    monitorEvents: bound: function (object, types) {
    profile: bound: function () {
    profileEnd: bound: function () {
    unmonitorEvents: bound: function (object, types) {
    values: bound: function (object) {
    __proto__: CommandLineAPI 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-01-20T15:05:06.553

目前 Safari 控制台[URL](https://developer.apple.com/library/content/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Console/Console.html#//apple_ref/doc/uid/TP40007874-CH6-SW1)已损坏。

这是副本（按“运行代码片段”）： [![在此处输入图像描述](https://i.stack.imgur.com/3uTn8.png)](https://i.stack.imgur.com/3uTn8.png)

```
<article id="contents" tabindex="0" role="main" class="isShowingTOC">
  <a id="top" name="top"></a>
        <a id="INDEX" href="/web/20170322101551/https://developer.apple.com/library/content/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/index.html" style="display:none;" onclick="s_objectID=&quot;http://web.archive.org/web/20170322101551/https://developer.apple.com/library/content/documentati_9&quot;;return this.s_oc?this.s_oc(e):true"></a>

        <a name="//apple_ref/doc/uid/TP40007874-CH6-SW1" title="The Console"></a><h1 id="pageTitle">The Console</h1><p>The console offers a way to inspect and debug your webpages. Think of it as the Terminal of your web content. The console has access to the DOM and JavaScript of the open page. Use the console as a tool to modify your web content via interactive commands and as a teaching aid to expand your knowledge of JavaScript. Because an object’s methods and properties autocomplete as you type, you can see all available functions that are valid in Safari.</p><p>For example, open the console and type <code>$$(‘p’)[1]</code>. (<code>$$</code> is shorthand for <code>document.querySelectorAll</code>—see more shorthand commands in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40007874-CH6-SW7" data-renderer-version="1" onclick="s_objectID=&quot;http://web.archive.org/web/20170322101551/https://developer.apple.com/library/content/documentati_10&quot;;return this.s_oc?this.s_oc(e):true">Table 5-1</a></span>.) Because this paragraph is the second instance of the <code>p</code> element on this page (<code>[1]</code> in a 0-based index), the node represents this paragraph. As you hover over the node, its position on the page is visibly highlighted. You can expand the node to see its contents, and even press Command-C to copy it to your clipboard.</p><section><a name="//apple_ref/doc/uid/TP40007874-CH6-SW5" title="Command-Line API"></a><h2 class="jump">Command-Line API</h2><p>You can inspect HTML nodes and JavaScript objects in more detail by using the console commands listed in <span class="content_text">Table 5-1</span>. Type the command-line APIs interactively within the console.</p><p>If your scripts share the same function name as a Command-Line API function, the function in your scripts takes precedence.</p><a name="//apple_ref/doc/uid/TP40007874-CH6-SW7" title="Table 5-1Commands available in the Web Inspector console"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 5-1</strong>&nbsp;&nbsp;Commands available in the Web Inspector console</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Command</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Description</p></th></tr><tr><td scope="row"><p><code>$(</code><em>selector</em><code>)</code></p></td><td><p>Shorthand for <code>document.querySelector</code>.</p></td></tr><tr><td scope="row"><p><code>$$(</code><em>selector</em><code>)</code></p></td><td><p>Shorthand for <code>document.querySelectorAll</code>.</p></td></tr><tr><td scope="row"><p><code>$x(</code><em>xpath</em><code>)</code></p></td><td><p>Returns an array of elements that match the given <span class="content_text"><a href="http://web.archive.org/web/20170322101551/http://www.w3.org/TR/xpath/" class="urlLink" rel="external" onclick="s_objectID=&quot;http://web.archive.org/web/20170322101551/http://www.w3.org/TR/xpath/_1&quot;;return this.s_oc?this.s_oc(e):true">XPath</a></span> expression.</p></td></tr><tr><td scope="row"><p><code>$0</code></p></td><td><p>Represents the currently selected node in the content browser.</p></td></tr><tr><td scope="row"><p><code>$</code><em>1..4</em></p></td><td><p>Represents the last, second to last, third to last, and fourth to last selected node in the content browser, respectively. </p></td></tr><tr><td scope="row"><p><code>$_</code></p></td><td><p>Returns the value of the last evaluated expression.</p></td></tr><tr><td scope="row"><p><code>dir(</code><em>object</em><code>)</code></p></td><td><p>Prints all the properties of the object.</p></td></tr><tr><td scope="row"><p><code>dirxml(</code><em>object</em><code>)</code></p></td><td><p>Prints all the properties of the object. If the object is a node, prints the node and all child nodes.</p></td></tr><tr><td scope="row"><p><code>keys(</code><em>object</em><code>)</code></p></td><td><p>Prints an array of the names of the object’s own properties.</p></td></tr><tr><td scope="row"><p><code>values(</code><em>object</em><code>)</code></p></td><td><p>Prints an array of the values of the object’s own properties.</p></td></tr><tr><td scope="row"><p><code>profile(</code><em>[title]</em><code>)</code></p></td><td><p>Starts the JavaScript profiler. The optional argument <code>title</code> contains the string to be printed in the header of the profile report. See <span class="content_text"><a href="/web/20170322101551/https://developer.apple.com/library/content/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Instruments/Instruments.html#//apple_ref/doc/uid/TP40007874-CH4-SW7" data-renderer-version="1" onclick="s_objectID=&quot;http://web.archive.org/web/20170322101551/https://developer.apple.com/library/content/documentati_11&quot;;return this.s_oc?this.s_oc(e):true">JavaScript and Events Recording</a></span>.</p></td></tr><tr><td scope="row"><p><code>profileEnd()</code></p></td><td><p>Stops the JavaScript profiler and prints its report. See <span class="content_text"><a href="/web/20170322101551/https://developer.apple.com/library/content/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Instruments/Instruments.html#//apple_ref/doc/uid/TP40007874-CH4-SW7" data-renderer-version="1" onclick="s_objectID=&quot;http://web.archive.org/web/20170322101551/https://developer.apple.com/library/content/documentati_12&quot;;return this.s_oc?this.s_oc(e):true">JavaScript and Events Recording</a></span>.</p></td></tr><tr><td scope="row"><p><code>getEventListeners(</code><em>object</em><code>)</code></p></td><td><p>Prints an object containing the object’s attached event listeners.</p></td></tr><tr><td scope="row"><p><code>monitorEvents(</code><em>object[, types]</em><code>)</code></p></td><td><p>Starts logging all events dispatched to the given object. The optional argument <code>types</code> defines specific events or event types to log, such as “click”.</p></td></tr><tr><td scope="row"><p><code>unmonitorEvents(</code><em>object[, types]</em><code>)</code></p></td><td><p>Stops logging for all events dispatched to the given object. The optional argument <code>types</code> defines specific events or event types to stop logging, such as “click”.</p></td></tr><tr><td scope="row"><p><code>inspect(</code><em>object</em><code>)</code></p></td><td><p>Inspects the given object; this is the same as clicking the Inspect button.</p></td></tr><tr><td scope="row"><p><code>copy(</code><em>object</em><code>)</code></p></td><td><p>Copies the given object to the clipboard.</p></td></tr><tr><td scope="row"><p><code>clear()</code></p></td><td><p>Clears the console.</p></td></tr></tbody></table></div><p>The functions listed in <span class="content_text">Table 5-1</span> are regular JavaScript functions that are part of the Web Inspector environment. That means you can use them as you would any JavaScript function. For example, you can assign a chain of Console API commands to a variable to create a useful shorthand. <span class="content_text">Listing 5-1</span> shows how you can quickly see all event types attached to the selected node.</p><a name="//apple_ref/doc/uid/TP40007874-CH6-SW6" title="Listing 5-1Find the events attached to this element"></a><p class="codesample clear"><strong class="caption_number">Listing 5-1</strong>&nbsp;&nbsp;Find the events attached to this element</p><div class="codesample clear"><table><tbody><tr><td scope="row"><pre>var evs = function () {<span></span></pre></td></tr><tr><td scope="row"><pre>    return keys(getEventListeners($0));<span></span></pre></td></tr><tr><td scope="row"><pre>};<span></span></pre></td></tr></tbody></table></div><p>After defining this function, inspect the magnifying glass in the top-right corner of this webpage, and type <code>evs()</code> in the console. An array containing the string “click” is returned, because there is a click event listener attached to that element.</p><p>Of course, these functions shouldn’t be included in your website’s JavaScript files because they are not available in the browser environment. Only use these functions in the Web Inspector console. Console functions you can include in your scripts are described in <span class="content_text"><a href="#//apple_ref/doc/uid/TP40007874-CH6-SW3" data-renderer-version="1" onclick="s_objectID=&quot;http://web.archive.org/web/20170322101551/https://developer.apple.com/library/content/documentati_13&quot;;return this.s_oc?this.s_oc(e):true">Console API</a></span>.</p></section><section><a name="//apple_ref/doc/uid/TP40007874-CH6-SW3" title="Console API"></a><h2 class="jump">Console API</h2><p>You can output messages to the console, add markers to the timeline, and control the debugger directly from your scripts by using the commands listed in <span class="content_text">Table 5-2</span>.</p><div class="importantbox clear"><aside><a name="//apple_ref/doc/uid/TP40007874-CH6-DontLinkElementID_5" title="Important"></a><p><strong>Important:</strong>&nbsp;These functions exist to aid development and should not be included in any of your production JavaScript.</p><p></p></aside></div><a name="//apple_ref/doc/uid/TP40007874-CH6-SW8" title="Table 5-2JavaScript functions available in the Console API"></a><div class="tableholder"><table class="graybox" border="0" cellspacing="0" cellpadding="5"><caption class="tablecaption"><strong class="caption_number">Table 5-2</strong>&nbsp;&nbsp;JavaScript functions available in the Console API</caption><tbody><tr><th scope="col" class="TableHeading_TableRow_TableCell"><p>Function</p></th><th scope="col" class="TableHeading_TableRow_TableCell"><p>Description</p></th></tr><tr><td scope="row"><p><code>console.assert(expression, object)</code></p></td><td><p>Asserts whether the given expression is true. If the assertion fails, prints the error and increments the number of errors in the activity viewer. If the assertion succeeds, prints nothing.</p></td></tr><tr><td scope="row"><p><code>console.clear()</code></p></td><td><p>Clears the console.</p></td></tr><tr><td scope="row"><p><code>console.count([title])</code></p></td><td><p>Prints the number of times this line has been called.</p></td></tr><tr><td scope="row"><p><code>console.debug(object)</code></p></td><td><p>Alias of <code>console.log()</code>.</p></td></tr><tr><td scope="row"><p><code>console.dir(object)</code></p></td><td><p>Prints the properties and values of the object.</p></td></tr><tr><td scope="row"><p><code>console.dirxml(node)</code></p></td><td><p>Prints the DOM tree of an HTML or XML node.</p></td></tr><tr><td scope="row"><p><code>console.error(object)</code></p></td><td><p>Prints a message to the console with the error icon. Increments the number of errors shown in the activity viewer.</p></td></tr><tr><td scope="row"><p><code>console.group([title])</code></p></td><td><p>Prints subsequent logs under a disclosure of the given title.</p></td></tr><tr><td scope="row"><p><code>console.groupEnd()</code></p></td><td><p>Ends the previously declared console grouping.</p></td></tr><tr><td scope="row"><p><code>console.info(object)</code></p></td><td><p>Alias of <code>console.log()</code>.</p></td></tr><tr><td scope="row"><p><code>console.log(object)</code></p></td><td><p>Prints the object to the console with the log icon. Increments the number of logs shown in the activity viewer.</p></td></tr><tr><td scope="row"><p><code>console.markTimeline(</code><em>label</em><code>)</code></p></td><td><p>Marks the Timeline with a green vertical dashed line that indicates when this line of code was called. See <span class="content_text"><a href="/web/20170322101551/https://developer.apple.com/library/content/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Instruments/Instruments.html#//apple_ref/doc/uid/TP40007874-CH4-SW2" data-renderer-version="1" onclick="s_objectID=&quot;http://web.archive.org/web/20170322101551/https://developer.apple.com/library/content/documentati_14&quot;;return this.s_oc?this.s_oc(e):true">Recording Timelines</a></span>.</p></td></tr><tr><td scope="row"><p><code>console.profile(</code><em>[title]</em><code>)</code></p></td><td><p>Starts the JavaScript profiler. The optional argument <code>title</code> contains the string to be printed in the header of the profile report. See <span class="content_text"><a href="/web/20170322101551/https://developer.apple.com/library/content/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Instruments/Instruments.html#//apple_ref/doc/uid/TP40007874-CH4-SW7" data-renderer-version="1" onclick="s_objectID=&quot;http://web.archive.org/web/20170322101551/https://developer.apple.com/library/content/documentati_15&quot;;return this.s_oc?this.s_oc(e):true">JavaScript and Events Recording</a></span>.</p></td></tr><tr><td scope="row"><p><code>console.profileEnd(</code><em>[title]</em><code>)</code></p></td><td><p>Stops the JavaScript profiler and prints its report. See <span class="content_text"><a href="/web/20170322101551/https://developer.apple.com/library/content/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Instruments/Instruments.html#//apple_ref/doc/uid/TP40007874-CH4-SW7" data-renderer-version="1" onclick="s_objectID=&quot;http://web.archive.org/web/20170322101551/https://developer.apple.com/library/content/documentati_16&quot;;return this.s_oc?this.s_oc(e):true">JavaScript and Events Recording</a></span>.</p></td></tr><tr><td scope="row"><p><code>console.time(</code><em>name</em><code>)</code></p></td><td><p>Starts a timer associated with the given name. Useful for timing the duration of segments of code.</p></td></tr><tr><td scope="row"><p><code>console.timeEnd(</code><em>name</em><code>)</code></p></td><td><p>Stops the timer associated with the given name and prints the elapsed time to the console.</p></td></tr><tr><td scope="row"><p><code>console.trace()</code></p></td><td><p>Prints a stack trace at the moment the function is called. See <span class="content_text"><a href="/web/20170322101551/https://developer.apple.com/library/content/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Debugger/Debugger.html#//apple_ref/doc/uid/TP40007874-CH5-SW6" data-renderer-version="1" onclick="s_objectID=&quot;http://web.archive.org/web/20170322101551/https://developer.apple.com/library/content/documentati_17&quot;;return this.s_oc?this.s_oc(e):true">Figure 4-2</a></span>.</p></td></tr><tr><td scope="row"><p><code>console.warn(</code><em>object</em><code>)</code></p></td><td><p>Prints a message to the console with the warning icon. Increments the number of warnings shown in the activity viewer.</p></td></tr><tr><td scope="row"><p><code>debugger</code></p></td><td><p>Stops JavaScript execution at the current line. This is the equivalent of setting a breakpoint programmatically. See <span class="content_text"><a href="/web/20170322101551/https://developer.apple.com/library/content/documentation/AppleApplications/Conceptual/Safari_Developer_Guide/Debugger/Debugger.html#//apple_ref/doc/uid/TP40007874-CH5-SW2" data-renderer-version="1" onclick="s_objectID=&quot;http://web.archive.org/web/20170322101551/https://developer.apple.com/library/content/documentati_18&quot;;return this.s_oc?this.s_oc(e):true">Breakpoints</a></span>.</p></td></tr></tbody></table></div></section>

        <div class="copyright"><br><hr><div align="center"><p class="content_text" lang="en" dir="ltr"> Updated: 2016-09-13</p></div></div>

        <div id="pediaWindow">
            <div id="pediaHeader"></div>
            <div id="pediaBody"></div>
        </div>
    </article>
```

# windows-vista - 您如何在 Windows Vista 会话 0 和桌面之间进行通信？

> ID：55639
> 
> 赞同：7
> 
> 时间：2008-09-11T01:29:21.940
> 
> 标签：windows-vista, ipc

在 Vista 之前的早期版本的 Windows 中，您可以让 Windows 服务与当前登录的桌面用户交互，以便在服务的屏幕上轻松显示信息。在 Windows Vista 中，为安全起见，添加了会话 0，以将服务与桌面隔离。在服务和在 Session 0 之外运行的应用程序之间进行通信的简单方法是什么？到目前为止，我已经通过使用 TCP/IP 在两者之间进行通信来解决这个问题，但这似乎是一种草率的方式。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T01:48:13.733

您也可以使用共享内存或命名管道来促进 IPC。从概念上讲，这类似于 TCP/IP，但您不必担心找到未使用的端口。

您必须确保您创建的命名对象以“Global\”为前缀，以允许所有会话都可以访问它们，如此处[所述](http://msdn.microsoft.com/en-us/library/aa366537(VS.85).aspx)。

AFAIK 服务无法再直接与桌面交互。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T01:57:29.343

事实上，出于安全原因，不再可能直接与“桌面”通信。当您生活在具有多个活动用户+远程会话的机器中时，“桌面”到底是什么？

解决问题的一般方法是使用通过某种 RPC 机制（TCP/IP、IPC、.Net Remoting Channels over 其中之一等）进行通信的服务应用程序。这有点痛苦，但我认为这些好处值得改变。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T02:31:04.117

对于与桌面对话的服务，您几乎受困于其中一种 RPC 机制。为此目的，.NET 远程处理机制 ( [IpcServerChannel](http://msdn.microsoft.com/en-us/library/system.runtime.remoting.channels.ipc.ipcserverchannel.aspx) ) 并不难实现。

[同样使用 .NET，桌面应用程序可以使用ServiceController.ExecuteCommand](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicecontroller.executecommand.aspx)直接向服务发送消息。服务通过[ServiceBase.OnCustomCommand](http://msdn.microsoft.com/en-us/library/system.serviceprocess.servicebase.oncustomcommand.aspx)接收这些命令。这更容易做到，如果控制服务是您的唯一要求，这就是您所需要的。

# c++ - C++ 中的 Unicode 处理

> ID：55641
> 
> 赞同：107
> 
> 时间：2008-09-11T01:30:32.140
> 
> 标签：c++, unicode

C++ 中 Unicode 处理的最佳实践是什么？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-09-11T01:37:17.303

*   使用 [ICU](http://www.icu-project.org/)处理您的数据（或类似的库）
*   在您自己的数据存储中，确保所有内容都以相同的编码存储
*   确保您始终将 unicode 库用于字符串长度、大小写状态等普通任务。切勿使用标准库内置函数，`is_alpha`除非这是您想要的定义。
*   我说的还不够：***如果您关心正确性，请永远******不要迭代 a 的索引，始终使用您的 unicode 库。`string`***

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-11-21T01:09:03.840

如果您不关心与以前的 C++ 标准的向后兼容性，当前的 C++11 标准已经内置了 Unicode 支持：[http ://www.open-std.org/JTC1/SC22/WG21/docs/papers/2011 /n3242.pdf](http://www.open-std.org/JTC1/SC22/WG21/docs/papers/2011/n3242.pdf)

因此，在 C++ 中进行 Unicode 处理的真正最佳实践是使用内置工具。不过，旧代码库并不总是有这种可能，因为目前标准是如此新。

编辑：澄清一下，C++11 支持 Unicode，因为它现在支持 Unicode 文字和 Unicode 字符串。但是，标准库对 Unicode 处理和转换的[支持有限。](http://www.cplusplus.com/reference/codecvt/)对于您当前的需求，这可能就足够了。但是，如果您现在需要做大量繁重的工作，那么您可能仍需要使用[ICU](http://www.icu-project.org)之类的东西来进行更深入的处理。目前有一些提案[正在制定中，](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3398.html)以包括对不同编码之间的文本转换的更强大的支持。我的猜测（和希望）是这将成为下[一份技术报告](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2005/n1810.html)的一部分。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-09-11T01:46:51.977

我们公司（和其他公司）使用最初由 Taligent 开发的开源[Internation Components for Unicode (ICU) 库。](http://www.icu-project.org/)

它处理字符串、语言环境、转换、日期/时间、排序规则、转换等。人。

从 [ICU 用户指南开始](http://www.icu-project.org/userguide/intro.html)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-11T01:33:53.503

这是 Windows 编程的清单：

*   _T("my string") 中包含的所有字符串
*   strlen() 等函数替换为 _tcslen() 等。
*   使用 LPTSTR 和 LPCTSTR 代替 char * 和 const char *
*   在 Dev Studio 中启动新项目时，请务必确保在项目属性中选择了 Unicode 选项。
*   对于 C++ 字符串，使用 std::wstring 而不是 std::string

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-11T01:40:08.980

查看 [C++ 中不区分大小写的字符串比较](https://stackoverflow.com/questions/11635/case-insensitive-string-comparison-in-c)

该问题有一个指向 Microsoft Unicode 文档的链接：http: [//msdn.microsoft.com/en-us/library/cc194799.aspx](http://msdn.microsoft.com/en-us/library/cc194799.aspx)

如果您查看该文章旁边的 MSDN 左侧导航栏，您应该会发现很多与 Unicode 函数有关的信息。它是“编码字符”一章的一部分（[http://msdn.microsoft.com/en-us/library/cc194786.aspx](http://msdn.microsoft.com/en-us/library/cc194786.aspx)）

它有以下小节：

*   代码页模型
*   Windows 中的双字节字符集
*   统一码
*   混合环境中的兼容性问题
*   Unicode 数据转换
*   将基于 Windows 的程序迁移到 Unicode
*   概括

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-03-12T04:10:39.177

虽然这可能不是每个人的最佳实践，但如果您愿意，您可以编写自己的 C++ UNICODE 例程！

我刚刚完成了一个周末。我学到了很多东西，虽然我不能保证它 100% 没有错误，但我做了很多测试，它似乎可以正常工作。

我的代码在新 BSD 许可下，可以在这里找到：

[http://code.google.com/p/netwidecc/downloads/list](http://code.google.com/p/netwidecc/downloads/list)

它被称为 WSUCONV，并带有一个在 UTF-8、UTF-16 和标准 ASCII 之间转换的示例 main() 程序。如果你扔掉主要代码，你就有了一个很好的读/写 UNICODE 的库。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-02-15T19:15:15.187

正如上面所说，在使用大型系统时，库是最好的选择。但是，有时您确实想自己处理事情（可能是因为该库会使用许多资源，例如微控制器上的资源）。在这种情况下，您需要一个简单的库，您可以从中复制部分以获得您实际需要的东西。

Willow Schlanger 的示例代码似乎不错（有关详细信息，请参阅他的答案）。

我还发现了另一个代码更小的代码，但缺乏完整的错误检查，只处理 UTF-8，但更容易取出。

这是看起来不错的嵌入式库的列表。

### 嵌入式库

*   [http://code.google.com/p/netwidecc/downloads/list（UTF8、UTF16LE、UTF16BE、UTF32](http://code.google.com/p/netwidecc/downloads/list)）
*   [http://www.cprogramming.com/tutorial/unicode.html](http://www.cprogramming.com/tutorial/unicode.html) (UTF8)
*   [http://utfcpp.sourceforge.net/](http://utfcpp.sourceforge.net/)（简单的 UTF8 库）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T01:39:07.097

使用 IBM 的[Unicode 国际组件](http://www.icu-project.org/)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-09-23T09:30:58.203

看看[UTF-8 Everywhere的建议](http://utf8everywhere.org/)

# php - 如何保证 mySQL 数据库的安全？

> ID：55643
> 
> 赞同：10
> 
> 时间：2008-09-11T01:31:57.080
> 
> 标签：php, mysql, security, aes

我将实施一个`PHP/mySQL`设置来存储信用卡信息。

这似乎`AES_ENCRYPT/AES_DECRYPT`是要走的路，

**但我仍然对某一点感到困惑：**

**如何保证加密密钥的安全？**

将其硬连线到我的 PHP 脚本中（它将与数据库位于同一服务器上）似乎是一个主要的安全漏洞。

**这里的“最佳实践”解决方案是什么？**

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-11T01:35:45.560

您应该仔细考虑是否真的需要保留 CC#。如果您没有充分的理由，请不要！每隔一周，您就会听到一些公司遭到入侵和 CC# 被盗的消息。所有这些公司都犯了一个致命的缺陷——他们保留了太多的信息。保留 CC# 直到交易清除。之后，将其删除。

就保护服务器而言，最好的做法是保护硬件并使用 MySQL 的内部系统套接字，并确保阻止对 MySQL 服务器的任何网络访问。确保您同时使用系统权限和 MySQL 权限，以根据需要允许尽可能少的访问。对于某些脚本，您可能会考虑只写身份验证。确实没有万无一失的加密方法（因为您总是需要解密，因此必须存储密钥）。这并不是说您不应该 - 您可以将密钥存储在一个位置，如果您检测到系统受损，您可以破坏文件并使数据变得无用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-09-24T08:00:04.113

MySQL，您可以通过六个简单的步骤来保护您的敏感数据。

第 1 步：删除授权表中的通配符

第 2 步：要求使用安全密码

注意：使用 MySQL “--secure-auth” 选项来防止使用旧的、不太安全的 MySQL 密码格式。

第三步：检查配置文件的权限

第 4 步：加密客户端-服务器传输

第 5 步：禁用远程访问

第六步：主动监控MySQL访问日志

安全工具

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T02:25:21.260

我同意，但如果你不需要也不要抄送。但如果你真的有，请确保拥有它的文件无法在网络上访问。您可以编写一个返回密钥的二进制文件。这样它就不会以明文形式存储。但是，如果您的服务器受到损害，仍然很容易得到它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-15T15:48:37.800

您需要的安全性取决于您的应用程序。例如，如果 cc# 仅在用户登录时使用（精简在线商店类型场景），那么您可以使用用户纯文本密码的哈希值加密 cc#，per-用户 salt 和专用的 cc# salt。不要永久存储此值。

由于您没有存储此值，因此您唯一可以获得此值的时间是用户输入密码登录时。只需确保您有良好的会话到期和垃圾收集策略。

如果这种情况不适用于您，请更详细地描述您的情况，以便我们提供更合适的答案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-01-21T11:11:52.400

将您的数据库文件放在计算机外部，比如说外部硬盘并将其保存在安全的地方。仅当您只能在放置此外部驱动器的地方开发此项目时才有效:) 或者您至少可以使用文件系统加密工具（如 [https://itsfoss.com/password-protect-folder-linux/ ）保护这些文件](https://itsfoss.com/password-protect-folder-linux/)

在生产环境的情况下，我同意 Kyle Cronin。

# sharepoint - SharePoint 权限

> ID：55669
> 
> 赞同：0
> 
> 时间：2008-09-11T02:01:04.280
> 
> 标签：sharepoint, permissions

我想创建一个文件夹，让无权查看站点其余部分的用户可以看到。该用户组将被授予访问该站点的权限，但我只希望他们能够查看一个特定页面。

是否可以在不访问每个页面并删除新用户组的访问权限的情况下做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T02:11:15.490

是的，您应该能够创建一个新组并将用户添加到该列表/子网站/其他任何内容中。这是假设您没有向某处的所有用户授予访问权限。如果您这样做了，那么希望默认访问权限被授予默认用户组（如共享点访问者），您可以更改该组以排除您只想访问站点的有限部分的用户。

如果创建正确，新组不应访问站点的其余部分。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-17T04:26:45.287

如果您对用户/组在 ACL 上（例如，父站点/Web）上的 ACL 上被列为“受限访问”这一事实感到厌烦。这只是 SharePoint 使用的占位符，用于确保人们至少可以访问最少的对象集（例如主题和其他 UI 文件以及父 Web 本身）以访问您实际希望他们有权访问的列表或项目。

只要该组只能访问单个列表，您就应该担心他们可以访问其他任何内容。

# javascript - 如何获取鼠标单击画布元素的坐标？

> ID：55677
> 
> 赞同：308
> 
> 时间：2008-09-11T02:07:45.263
> 
> 标签：javascript, canvas

将单击事件处理程序添加到将返回单击的 x 和 y 坐标（相对于画布元素）的画布元素的最简单方法是什么？

无需兼容旧版浏览器，Safari、Opera 和 Firefox 即可。

* * *

## 回答 #1

> 赞同：251
> 
> 时间：2013-08-05T08:26:06.513

如果您喜欢简单但仍需要跨浏览器功能，我发现此解决方案最适合我。这是@Aldekein 解决方案的简化，但**没有 jQuery**。

```
function getCursorPosition(canvas, event) {
    const rect = canvas.getBoundingClientRect()
    const x = event.clientX - rect.left
    const y = event.clientY - rect.top
    console.log("x: " + x + " y: " + y)
}

const canvas = document.querySelector('canvas')
canvas.addEventListener('mousedown', function(e) {
    getCursorPosition(canvas, e)
}) 
```

* * *

## 回答 #2

> 赞同：180
> 
> 时间：2011-05-09T03:29:14.843

**更新**（2016 年 5 月 5 日）：应该[改用 patriques 的答案](https://stackoverflow.com/a/18053642/1026023)，因为它更简单、更可靠。

* * *

由于画布的样式并不总是相对于整个页面，因此`canvas.offsetLeft/Top`并不总是返回您需要的内容。它将返回相对于它的 offsetParent 元素偏移的像素数，它可以类似于包含应用了样式`div`的画布的元素。`position: relative`考虑到这一点，您需要`offsetParent`从画布元素本身开始循环遍历 s 链。这段代码非常适合我，在 Firefox 和 Safari 中测试过，但应该适用于所有人。

```
function relMouseCoords(event){
    var totalOffsetX = 0;
    var totalOffsetY = 0;
    var canvasX = 0;
    var canvasY = 0;
    var currentElement = this;

    do{
        totalOffsetX += currentElement.offsetLeft - currentElement.scrollLeft;
        totalOffsetY += currentElement.offsetTop - currentElement.scrollTop;
    }
    while(currentElement = currentElement.offsetParent)

    canvasX = event.pageX - totalOffsetX;
    canvasY = event.pageY - totalOffsetY;

    return {x:canvasX, y:canvasY}
}
HTMLCanvasElement.prototype.relMouseCoords = relMouseCoords; 
```

最后一行便于获取相对于画布元素的鼠标坐标。获得有用坐标所需要做的就是

```
coords = canvas.relMouseCoords(event);
canvasX = coords.x;
canvasY = coords.y; 
```

* * *

## 回答 #3

> 赞同：84
> 
> 时间：2010-12-13T15:38:09.077

**编辑 2018：**这个答案已经很老了，它对不再需要的旧浏览器进行检查，因为`clientX`and`clientY`属性在所有当前浏览器中都有效。您可能想查看[Patriques Answer](https://stackoverflow.com/a/18053642/540725)以获得更简单、更新的解决方案。

**原始答案：**
正如我当时发现但不再存在的文章中所述：

```
var x;
var y;
if (e.pageX || e.pageY) { 
  x = e.pageX;
  y = e.pageY;
}
else { 
  x = e.clientX + document.body.scrollLeft + document.documentElement.scrollLeft; 
  y = e.clientY + document.body.scrollTop + document.documentElement.scrollTop; 
} 
x -= gCanvasElement.offsetLeft;
y -= gCanvasElement.offsetTop; 
```

对我来说工作得很好。

* * *

## 回答 #4

> 赞同：39
> 
> 时间：2012-08-24T17:41:21.697

现代浏览器现在为您处理这个问题。Chrome、IE9 和 Firefox 像这样支持 offsetX/Y，从点击处理程序中传入事件。

```
function getRelativeCoords(event) {
    return { x: event.offsetX, y: event.offsetY };
} 
```

大多数现代浏览器也支持 layerX/Y，但是 Chrome 和 IE 使用 layerX/Y 作为页面点击的绝对偏移量，包括边距、填充等。在 Firefox 中，layerX/Y 和 offsetX/Y 是等价的，但偏移量没有'以前不存在。因此，为了与稍旧的浏览器兼容，您可以使用：

```
function getRelativeCoords(event) {
    return { x: event.offsetX || event.layerX, y: event.offsetY || event.layerY };
} 
```

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2011-03-24T10:44:40.823

根据新鲜的[Quirksmode](http://www.quirksmode.org/dom/w3c_cssom.html#mousepos)所有主要浏览器都支持`clientX`和方法。`clientY`所以，这里是 - 在带有滚动条的页面上的滚动 div 中工作的良好、有效的代码：

```
function getCursorPosition(canvas, event) {
var x, y;

canoffset = $(canvas).offset();
x = event.clientX + document.body.scrollLeft + document.documentElement.scrollLeft - Math.floor(canoffset.left);
y = event.clientY + document.body.scrollTop + document.documentElement.scrollTop - Math.floor(canoffset.top) + 1;

return [x,y];
} 
```

这也需要[jQuery](https://jquery.com/)用于`$(canvas).offset()`.

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2011-05-08T15:57:28.900

我做了一个完整的演示，可以在每个浏览器中使用这个问题的解决方案的完整源代码：[Coordinates of a mouse click on Canvas in Javascript](http://miloq.blogspot.com/2011/05/coordinates-mouse-click-canvas.html)。要尝试演示，请复制代码并将其粘贴到文本编辑器中。然后将其保存为 example.html，最后用浏览器打开该文件。

* * *

## 回答 #7

> 赞同：13
> 
> 时间：2019-05-19T07:00:38.577

因此，这既简单又比看起来要复杂一些。

首先这里通常有混淆的问题

1.  **如何获取元素相对鼠标坐标**

2.  **如何获取 2D Canvas API 或 WebGL 的画布像素鼠标坐标**

所以，答案

# 如何获取元素相对鼠标坐标

元素是否是获取元素相对鼠标坐标的画布对于所有元素都是相同的。

“如何获取画布相对鼠标坐标”的问题有 2 个简单的答案

### 简单的答案#1 使用`offsetX`和`offsetY`

```
canvas.addEventListner('mousemove', (e) => {
  const x = e.offsetX;
  const y = e.offsetY;
}); 
```

这个答案适用于 Chrome、Firefox 和 Safari。与所有其他事件值不同`offsetX`，`offsetY`将 CSS 转换考虑在内。

最大的问题是截至 2019/05 `offsetX`，`offsetY`它们在触摸事件中不存在，因此不能与 iOS Safari 一起使用。它们确实存在于指针事件中，这些事件存在于 Chrome 和 Firefox 中，但不存在于 Safari 中，尽管[显然 Safari 正在处理它](https://webkit.org/blog/8419/release-notes-for-safari-technology-preview-67/)。

另一个问题是事件必须在画布上。如果您将它们放在其他元素或窗口上，您以后不能选择画布作为您的参考点。

## 简单答案 #2 使用`clientX`,`clientY`和`canvas.getBoundingClientRect`

如果您不关心 CSS 转换，那么下一个最简单的答案是调用并从和中`canvas. getBoundingClientRect()`减去左`clientX``top``clientY`

```
canvas.addEventListener('mousemove', (e) => {
  const rect = canvas.getBoundingClientRect();
  const x = e.clientX - rect.left;
  const y = e.clientY - rect.top;
}); 
```

只要没有 CSS 转换，这将起作用。它也适用于触摸事件，因此适用于 Safari iOS

```
canvas.addEventListener('touchmove', (e) => {
  const rect = canvas. getBoundingClientRect();
  const x = e.touches[0].clientX - rect.left;
  const y = e.touches[0].clientY - rect.top;
}); 
```

# 如何获取 2D Canvas API 的画布像素鼠标坐标

为此，我们需要获取上面得到的值，并将画布显示的大小转换为画布本身的像素数

和和`canvas.getBoundingClientRect`_`clientX``clientY`

```
canvas.addEventListener('mousemove', (e) => {
  const rect = canvas.getBoundingClientRect();
  const elementRelativeX = e.clientX - rect.left;
  const elementRelativeY = e.clientY - rect.top;
  const canvasRelativeX = elementRelativeX * canvas.width / rect.width;
  const canvasRelativeY = elementRelativeY * canvas.height / rect.height;
}); 
```

或与`offsetX`和`offsetY`

```
canvas.addEventListener('mousemove', (e) => {
  const elementRelativeX = e.offsetX;
  const elementRelativeY = e.offsetY;
  const canvasRelativeX = elementRelativeX * canvas.width / canvas.clientWidth;
  const canvasRelativeY = elementRelativeY * canvas.height / canvas.clientHeight;
}); 
```

# 注意：**在所有情况下都不要在画布上添加填充或边框。这样做会使代码变得非常复杂。而不是您想要在其他元素中围绕画布的边框或填充，并将填充和/或边框添加到外部元素。**

使用的工作示例`event.offsetX`，`event.offsetY`

```
[...document.querySelectorAll('canvas')].forEach((canvas) => {
  const ctx = canvas.getContext('2d');
  ctx.canvas.width  = ctx.canvas.clientWidth;
  ctx.canvas.height = ctx.canvas.clientHeight;
  let count = 0;

  function draw(e, radius = 1) {
    const pos = {
      x: e.offsetX * canvas.width  / canvas.clientWidth,
      y: e.offsetY * canvas.height / canvas.clientHeight,
    };
    document.querySelector('#debug').textContent = count;
    ctx.beginPath();
    ctx.arc(pos.x, pos.y, radius, 0, Math.PI * 2);
    ctx.fillStyle = hsl((count++ % 100) / 100, 1, 0.5);
    ctx.fill();
  }

  function preventDefault(e) {
    e.preventDefault();
  }

  if (window.PointerEvent) {
    canvas.addEventListener('pointermove', (e) => {
      draw(e, Math.max(Math.max(e.width, e.height) / 2, 1));
    });
    canvas.addEventListener('touchstart', preventDefault, {passive: false});
    canvas.addEventListener('touchmove', preventDefault, {passive: false});
  } else {
    canvas.addEventListener('mousemove', draw);
    canvas.addEventListener('mousedown', preventDefault);
  }
});

function hsl(h, s, l) {
  return `hsl(${h * 360 | 0},${s * 100 | 0}%,${l * 100 | 0}%)`;
}
```

```
.scene {
  width: 200px;
  height: 200px;
  perspective: 600px;
}

.cube {
  width: 100%;
  height: 100%;
  position: relative;
  transform-style: preserve-3d;
  animation-duration: 16s;
  animation-name: rotate;
  animation-iteration-count: infinite;
  animation-timing-function: linear;
}

@keyframes rotate {
  from { transform: translateZ(-100px) rotateX(  0deg) rotateY(  0deg); }
  to   { transform: translateZ(-100px) rotateX(360deg) rotateY(720deg); }
}

.cube__face {
  position: absolute;
  width: 200px;
  height: 200px;
  display: block;
}

.cube__face--front  { background: rgba(255, 0, 0, 0.2); transform: rotateY(  0deg) translateZ(100px); }
.cube__face--right  { background: rgba(0, 255, 0, 0.2); transform: rotateY( 90deg) translateZ(100px); }
.cube__face--back   { background: rgba(0, 0, 255, 0.2); transform: rotateY(180deg) translateZ(100px); }
.cube__face--left   { background: rgba(255, 255, 0, 0.2); transform: rotateY(-90deg) translateZ(100px); }
.cube__face--top    { background: rgba(0, 255, 255, 0.2); transform: rotateX( 90deg) translateZ(100px); }
.cube__face--bottom { background: rgba(255, 0, 255, 0.2); transform: rotateX(-90deg) translateZ(100px); }
```

```
<div class="scene">
  <div class="cube">
    <canvas class="cube__face cube__face--front"></canvas>
    <canvas class="cube__face cube__face--back"></canvas>
    <canvas class="cube__face cube__face--right"></canvas>
    <canvas class="cube__face cube__face--left"></canvas>
    <canvas class="cube__face cube__face--top"></canvas>
    <canvas class="cube__face cube__face--bottom"></canvas>
  </div>
</div>
<pre id="debug"></pre>
```

`canvas.getBoundingClientRect`使用and `event.clientX`and 的工作示例`event.clientY`

```
const canvas = document.querySelector('canvas');
const ctx = canvas.getContext('2d');
ctx.canvas.width  = ctx.canvas.clientWidth;
ctx.canvas.height = ctx.canvas.clientHeight;
let count = 0;

function draw(e, radius = 1) {
  const rect = canvas.getBoundingClientRect();
  const pos = {
    x: (e.clientX - rect.left) * canvas.width  / canvas.clientWidth,
    y: (e.clientY - rect.top) * canvas.height / canvas.clientHeight,
  };
  ctx.beginPath();
  ctx.arc(pos.x, pos.y, radius, 0, Math.PI * 2);
  ctx.fillStyle = hsl((count++ % 100) / 100, 1, 0.5);
  ctx.fill();
}

function preventDefault(e) {
  e.preventDefault();
}

if (window.PointerEvent) {
  canvas.addEventListener('pointermove', (e) => {
    draw(e, Math.max(Math.max(e.width, e.height) / 2, 1));
  });
  canvas.addEventListener('touchstart', preventDefault, {passive: false});
  canvas.addEventListener('touchmove', preventDefault, {passive: false});
} else {
  canvas.addEventListener('mousemove', draw);
  canvas.addEventListener('mousedown', preventDefault);
}

function hsl(h, s, l) {
  return `hsl(${h * 360 | 0},${s * 100 | 0}%,${l * 100 | 0}%)`;
}
```

```
canvas { background: #FED; }
```

```
<canvas width="400" height="100" style="width: 300px; height: 200px"></canvas>
<div>canvas deliberately has differnt CSS size vs drawingbuffer size</div>
```

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2012-04-01T02:21:49.793

这是[Ryan Artecona](https://stackoverflow.com/a/5932203/1305768)对宽度可变 (%) 的画布的回答的一个小修改：

```
 HTMLCanvasElement.prototype.relMouseCoords = function (event) {
    var totalOffsetX = 0;
    var totalOffsetY = 0;
    var canvasX = 0;
    var canvasY = 0;
    var currentElement = this;

    do {
        totalOffsetX += currentElement.offsetLeft;
        totalOffsetY += currentElement.offsetTop;
    }
    while (currentElement = currentElement.offsetParent)

    canvasX = event.pageX - totalOffsetX;
    canvasY = event.pageY - totalOffsetY;

    // Fix for variable canvas width
    canvasX = Math.round( canvasX * (this.width / this.offsetWidth) );
    canvasY = Math.round( canvasY * (this.height / this.offsetHeight) );

    return {x:canvasX, y:canvasY}
} 
```

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2009-10-04T14:37:52.927

进行坐标转换时要小心；点击事件中返回多个非跨浏览器值。如果浏览器窗口滚动（在 Firefox 3.5 和 Chrome 3.0 中验证），则单独使用 clientX 和 clientY 是不够的。

[这篇 quirks mode](http://www.quirksmode.org/js/events_properties.html)文章提供了一个更正确的函数，可以使用 pageX 或 pageY 或 clientX 与 document.body.scrollLeft 和 clientY 与 document.body.scrollTop 的组合来计算相对于文档原点的点击坐标。

更新：此外， offsetLeft 和 offsetTop 是相对于元素的填充大小，而不是内部大小。应用了 padding: 样式的画布不会将其内容区域的左上角报告为 offsetLeft。这个问题有多种解决方案；最简单的一种可能是清除画布本身上的所有边框、填充等样式，而是将它们应用于包含画布的框。

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2014-11-29T17:27:08.020

我不确定所有这些[通过父元素循环](https://stackoverflow.com/a/5932203/607407)并做各种[奇怪事情](http://en.wikipedia.org/wiki/Deep_magic)的答案的意义何在。

该`HTMLElement.getBoundingClientRect`方法旨在处理任何元素的实际屏幕位置。`scrollTop`这包括滚动，所以不需要类似的东西：

> [**（来自 MDN）**](https://developer.mozilla.org/en-US/docs/Web/API/Element.getBoundingClientRect)在计算边界矩形时会考虑视口区域（或 **任何其他可滚动元素）的滚动量**

### 正常图像

这里已经发布了[最简单的方法。](https://stackoverflow.com/a/20788872/607407)只要*不涉及狂野的 CSS*规则，这是正确的。

### 处理拉伸的画布/图像

当图像像素宽度与其 CSS 宽度不匹配时，您需要对像素值应用一些比率：

```
/* Returns pixel coordinates according to the pixel that's under the mouse cursor**/
HTMLCanvasElement.prototype.relativeCoords = function(event) {
  var x,y;
  //This is the current screen rectangle of canvas
  var rect = this.getBoundingClientRect();
  var top = rect.top;
  var bottom = rect.bottom;
  var left = rect.left;
  var right = rect.right;
  //Recalculate mouse offsets to relative offsets
  x = event.clientX - left;
  y = event.clientY - top;
  //Also recalculate offsets of canvas is stretched
  var width = right - left;
  //I use this to reduce number of calculations for images that have normal size 
  if(this.width!=width) {
    var height = bottom - top;
    //changes coordinates by ratio
    x = x*(this.width/width);
    y = y*(this.height/height);
  } 
  //Return as an array
  return [x,y];
} 
```

只要画布没有边框，[**它就适用于拉伸图像（jsFiddle）**](http://jsfiddle.net/Darker/cfzn01c6/)。

### 处理 CSS 边框

如果画布有粗边框，[事情就变得有点复杂了](http://jsfiddle.net/Darker/nrw7xu2r/1/)。您实际上需要从边界矩形中减去边框。这可以使用[.getComputedStyle](https://developer.mozilla.org/en/docs/Web/API/window.getComputedStyle)来完成。这个[答案描述了这个过程](https://stackoverflow.com/a/27204448/607407)。

然后函数长大一点：

```
/* Returns pixel coordinates according to the pixel that's under the mouse cursor**/
HTMLCanvasElement.prototype.relativeCoords = function(event) {
  var x,y;
  //This is the current screen rectangle of canvas
  var rect = this.getBoundingClientRect();
  var top = rect.top;
  var bottom = rect.bottom;
  var left = rect.left;
  var right = rect.right;
  //Subtract border size
  // Get computed style
  var styling=getComputedStyle(this,null);
  // Turn the border widths in integers
  var topBorder=parseInt(styling.getPropertyValue('border-top-width'),10);
  var rightBorder=parseInt(styling.getPropertyValue('border-right-width'),10);
  var bottomBorder=parseInt(styling.getPropertyValue('border-bottom-width'),10);
  var leftBorder=parseInt(styling.getPropertyValue('border-left-width'),10);
  //Subtract border from rectangle
  left+=leftBorder;
  right-=rightBorder;
  top+=topBorder;
  bottom-=bottomBorder;
  //Proceed as usual
  ...
} 
```

我想不出任何会混淆这个最终功能的东西。[**在JsFiddle**](http://jsfiddle.net/Darker/nrw7xu2r/2/)看到自己。

### 笔记

如果您不喜欢修改原生`prototype`s，只需更改函数并调用它`(canvas, event)`（并将任何替换`this`为`canvas`）。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2013-07-01T10:10:30.950

这是一个非常好的教程-

[http://www.html5canvastutorials.com/advanced/html5-canvas-mouse-coordinates/](http://www.html5canvastutorials.com/advanced/html5-canvas-mouse-coordinates/)

```
 <canvas id="myCanvas" width="578" height="200"></canvas>
<script>
  function writeMessage(canvas, message) {
    var context = canvas.getContext('2d');
    context.clearRect(0, 0, canvas.width, canvas.height);
    context.font = '18pt Calibri';
    context.fillStyle = 'black';
    context.fillText(message, 10, 25);
  }
  function getMousePos(canvas, evt) {
    var rect = canvas.getBoundingClientRect();
    return {
      x: evt.clientX - rect.left,
      y: evt.clientY - rect.top
    };
  }
  var canvas = document.getElementById('myCanvas');
  var context = canvas.getContext('2d');

  canvas.addEventListener('mousemove', function(evt) {
    var mousePos = getMousePos(canvas, evt);
    var message = 'Mouse position: ' + mousePos.x + ',' + mousePos.y;
    writeMessage(canvas, message);
  }, false); 
```

希望这可以帮助！

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2016-01-14T03:23:44.323

在 2016 年使用 jQuery 来获取相对于画布的点击坐标，我这样做：

```
$(canvas).click(function(jqEvent) {
    var coords = {
        x: jqEvent.pageX - $(canvas).offset().left,
        y: jqEvent.pageY - $(canvas).offset().top
    };
}); 
```

这是因为 canvas offset() 和 jqEvent.pageX/Y 都是相对于文档的，无论滚动位置如何。

请注意，如果您的画布被缩放，那么这些坐标与画布**逻辑坐标**不同。要获得这些，您*还可以*执行以下操作：

```
var logicalCoords = {
    x: coords.x * (canvas.width / $(canvas).width()),
    y: coords.y * (canvas.height / $(canvas).height())
} 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2013-07-02T05:40:30.430

我推荐这个链接- [http://miloq.blogspot.in/2011/05/coordinates-mouse-click-canvas.html](http://miloq.blogspot.in/2011/05/coordinates-mouse-click-canvas.html)

```
<style type="text/css">

  #canvas{background-color: #000;}

</style>

<script type="text/javascript">

  document.addEventListener("DOMContentLoaded", init, false);

  function init()
  {
    var canvas = document.getElementById("canvas");
    canvas.addEventListener("mousedown", getPosition, false);
  }

  function getPosition(event)
  {
    var x = new Number();
    var y = new Number();
    var canvas = document.getElementById("canvas");

    if (event.x != undefined && event.y != undefined)
    {
      x = event.x;
      y = event.y;
    }
    else // Firefox method to get the position
    {
      x = event.clientX + document.body.scrollLeft +
          document.documentElement.scrollLeft;
      y = event.clientY + document.body.scrollTop +
          document.documentElement.scrollTop;
    }

    x -= canvas.offsetLeft;
    y -= canvas.offsetTop;

    alert("x: " + x + "  y: " + y);
  }

</script> 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-07-26T23:10:13.073

在 Prototype 中，使用累积偏移（）进行递归求和，如上面 Ryan Artecona 所述。

[http://www.prototypejs.org/api/element/cumulativeoffset](http://www.prototypejs.org/api/element/cumulativeoffset)

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-11-02T10:02:45.400

你可以这样做：

```
var canvas = yourCanvasElement;
var mouseX = (event.clientX - (canvas.offsetLeft - canvas.scrollLeft)) - 2;
var mouseY = (event.clientY - (canvas.offsetTop - canvas.scrollTop)) - 2; 
```

这将为您提供鼠标指针的确切位置。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2013-12-01T08:05:03.927

[请参阅http://jsbin.com/ApuJOSA/1/edit?html,output](http://jsbin.com/ApuJOSA/1/edit?html,output)上的演示。

```
 function mousePositionOnCanvas(e) {
      var el=e.target, c=el;
      var scaleX = c.width/c.offsetWidth || 1;
      var scaleY = c.height/c.offsetHeight || 1;

      if (!isNaN(e.offsetX)) 
          return { x:e.offsetX*scaleX, y:e.offsetY*scaleY };

      var x=e.pageX, y=e.pageY;
      do {
        x -= el.offsetLeft;
        y -= el.offsetTop;
        el = el.offsetParent;
      } while (el);
      return { x: x*scaleX, y: y*scaleY };
  } 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2019-05-29T14:57:49.243

我正在创建一个在 pdf 上具有**画布**的应用程序，这涉及到很多画布的大小调整，例如放大和缩小 pdf，然后每次放大/缩小 PDF 我必须调整画布大小以适应pdf 的大小，我在 stackOverflow 中查看了很多答案，但没有找到最终解决问题的完美解决方案。

我使用的是**rxjs**和 angular 6，但没有找到任何特定于最新版本的答案。

这是对任何利用**rxjs**在画布上绘图的人都有帮助的完整代码片段。

```
 private captureEvents(canvasEl: HTMLCanvasElement) {

    this.drawingSubscription = fromEvent(canvasEl, 'mousedown')
      .pipe(
        switchMap((e: any) => {

          return fromEvent(canvasEl, 'mousemove')
            .pipe(
              takeUntil(fromEvent(canvasEl, 'mouseup').do((event: WheelEvent) => {
                const prevPos = {
                  x: null,
                  y: null
                };
              })),

              takeUntil(fromEvent(canvasEl, 'mouseleave')),
              pairwise()
            )
        })
      )
      .subscribe((res: [MouseEvent, MouseEvent]) => {
        const rect = this.cx.canvas.getBoundingClientRect();
        const prevPos = {
          x: Math.floor( ( res[0].clientX - rect.left ) / ( rect.right - rect.left ) * this.cx.canvas.width ),
          y:  Math.floor( ( res[0].clientY - rect.top ) / ( rect.bottom - rect.top ) * this.cx.canvas.height )
        };
        const currentPos = {
          x: Math.floor( ( res[1].clientX - rect.left ) / ( rect.right - rect.left ) * this.cx.canvas.width ),
          y: Math.floor( ( res[1].clientY - rect.top ) / ( rect.bottom - rect.top ) * this.cx.canvas.height )
        };

        this.coordinatesArray[this.file.current_slide - 1].push(prevPos);
        this.drawOnCanvas(prevPos, currentPos);
      });
  } 
```

这是修复的片段，鼠标坐标相对于画布的大小，无论您如何放大/缩小画布。

```
const prevPos = {
  x: Math.floor( ( res[0].clientX - rect.left ) / ( rect.right - rect.left ) * this.cx.canvas.width ),
  y:  Math.floor( ( res[0].clientY - rect.top ) / ( rect.bottom - rect.top ) * this.cx.canvas.height )
};
const currentPos = {
  x: Math.floor( ( res[1].clientX - rect.left ) / ( rect.right - rect.left ) * this.cx.canvas.width ),
  y: Math.floor( ( res[1].clientY - rect.top ) / ( rect.bottom - rect.top ) * this.cx.canvas.height )
}; 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-06-18T20:24:34.080

这是上述 Ryan Artecona 解决方案的一些修改。

```
function myGetPxStyle(e,p)
{
    var r=window.getComputedStyle?window.getComputedStyle(e,null)[p]:"";
    return parseFloat(r);
}

function myGetClick=function(ev)
{
    // {x:ev.layerX,y:ev.layerY} doesn't work when zooming with mac chrome 27
    // {x:ev.clientX,y:ev.clientY} not supported by mac firefox 21
    // document.body.scrollLeft and document.body.scrollTop seem required when scrolling on iPad
    // html is not an offsetParent of body but can have non null offsetX or offsetY (case of wordpress 3.5.1 admin pages for instance)
    // html.offsetX and html.offsetY don't work with mac firefox 21

    var offsetX=0,offsetY=0,e=this,x,y;
    var htmls=document.getElementsByTagName("html"),html=(htmls?htmls[0]:0);

    do
    {
        offsetX+=e.offsetLeft-e.scrollLeft;
        offsetY+=e.offsetTop-e.scrollTop;
    } while (e=e.offsetParent);

    if (html)
    {
        offsetX+=myGetPxStyle(html,"marginLeft");
        offsetY+=myGetPxStyle(html,"marginTop");
    }

    x=ev.pageX-offsetX-document.body.scrollLeft;
    y=ev.pageY-offsetY-document.body.scrollTop;
    return {x:x,y:y};
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-01-05T06:26:35.210

首先，正如其他人所说，您需要一个函数来获取[canvas 元素的位置](http://www.quirksmode.org/js/findpos.html)。这是一种比此页面上的其他一些方法更优雅的方法（恕我直言）。您可以将*任何*元素传递给它并获取它在文档中的位置：

```
function findPos(obj) {
    var curleft = 0, curtop = 0;
    if (obj.offsetParent) {
        do {
            curleft += obj.offsetLeft;
            curtop += obj.offsetTop;
        } while (obj = obj.offsetParent);
        return { x: curleft, y: curtop };
    }
    return undefined;
} 
```

现在计算光标相对于它的当前位置：

```
$('#canvas').mousemove(function(e) {
    var pos = findPos(this);
    var x = e.pageX - pos.x;
    var y = e.pageY - pos.y;
    var coordinateDisplay = "x=" + x + ", y=" + y;
    writeCoordinateDisplay(coordinateDisplay);
}); 
```

请注意，我已将通用`findPos`函数与事件处理代码分开。（*应该是这样*。我们应该尽量让我们的功能各自完成一项任务。）

`offsetLeft`和的值`offsetTop`是相对于 的`offsetParent`，它可能是一些包装`div`节点（或其他任何东西，就此而言）。当没有包裹`canvas`它们的元素时，它们是相对于的`body`，所以没有要减去的偏移量。这就是为什么我们需要在做其他事情之前确定画布的位置。

同样，`e.pageX`并`e.pageY`给出光标相对于文档的位置。这就是为什么我们从这些值中减去画布的偏移量以到达真实位置。

*定位*元素的替代方法是直接使用 和 的`e.layerX`值`e.layerY`。这比上述方法更不可靠，原因有两个：

1.  当事件不在定位元素内发生时，这些值也相对于整个文档
2.  它们不是任何标准的一部分

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2016-06-13T12:49:39.237

ThreeJS r77

```
var x = event.offsetX == undefined ? event.layerX : event.offsetX;
var y = event.offsetY == undefined ? event.layerY : event.offsetY;

mouse2D.x = ( x / renderer.domElement.width ) * 2 - 1;
mouse2D.y = - ( y / renderer.domElement.height ) * 2 + 1; 
```

在尝试了许多解决方案之后。这对我有用。可能会帮助其他人因此发布。从[这里得到](http://www.scriptscoop2.com/t/f93cbd2d95e2/javascript-threejs-issue-with-raycaster-intersection.html)

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2019-01-24T23:15:26.427

这是一个简化的解决方案（这不适用于边框/滚动）：

```
function click(event) {
    const bound = event.target.getBoundingClientRect();

    const xMult = bound.width / can.width;
    const yMult = bound.height / can.height;

    return {
        x: Math.floor(event.offsetX / xMult),
        y: Math.floor(event.offsetY / yMult),
    };
} 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2008-09-11T02:49:27.190

嘿，这是在道场中，只是因为这是我已经为项目准备的代码。

如何将其转换回非 dojo vanilla JavaScript 应该是相当明显的。

```
 function onMouseClick(e) {
      var x = e.clientX;
      var y = e.clientY;
  }
  var canvas = dojo.byId(canvasId);
  dojo.connect(canvas,"click",onMouseClick); 
```

希望有帮助。

# .net - .NET 命名空间

> ID：55692
> 
> 赞同：8
> 
> 时间：2008-09-11T02:26:45.327
> 
> 标签：.net, namespaces

我的背景主要是作为一名 Java 开发人员，但最近我一直在做一些 .NET 方面的工作。所以我一直在尝试在家里做一些简单的项目来更好地使用.NET。我已经能够将我的大部分 Java 经验转移到使用 .NET（特别是 C#）中，但唯一真正让我困惑的是命名空间。

我知道命名空间类似于 Java 包，但据我所知，主要区别在于 Java 包使用实际的文件夹来显示分隔，而在 .NET 中则没有，所有文件都位于一个文件夹中并且命名空间只是在每个类中声明。

我觉得这很奇怪，因为我总是将包视为组织和分组相关代码的一种方式，使其更易于导航和理解。由于在 .NET 中它不能以这种方式工作，加班后，该项目显得更加拥挤并且不那么容易导航。

我在这里错过了什么吗？我必须。我应该在解决方案中将事情分解成单独的项目吗？或者有没有更好的方法来组织项目中的类和文件？

[编辑：正如布莱尔指出的，这与这里](https://stackoverflow.com/questions/4664/should-the-folders-in-a-solution-match-the-namespace)提出的问题几乎相同。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-11T02:29:49.687

我不能声称这是最佳实践，但我经常看到文件组织在一个目录层次结构中，该目录层次结构反映了命名空间。如果它更适合您的代码心智模型，那么就这样做 - 我想不出有什么害处。仅仅因为 .NET 模型不强制命名空间、项目和目录结构之间的关系并不意味着如果你愿意，你就不能拥有这样的关系。

对于将代码分解成比您需要的更多的项目，我会有点谨慎，因为当您必须管理多个程序集时，这会减慢编译速度并增加一点开销。

编辑：请注意，这个问题几乎与[解决方案中的文件夹是否应与命名空间匹配？](https://stackoverflow.com/questions/4664/should-the-folders-in-a-solution-match-the-namespace)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-11T02:31:12.400

是的，在 .NET 命名空间中不依赖于文件系统或其他任何东西。在我看来，这是一个很大的优势。例如，您可以将代码拆分到不同的程序集中，从而实现灵活的分发。

在 Visual Studio 中工作时，IDE 往往会在您将新文件夹添加到项目树时引入新的命名空间。

这是来自 MSDN 的有用链接：

[命名空间命名准则](http://msdn.microsoft.com/en-us/library/893ke618(VS.71).aspx)

> 命名命名空间的一般规则是使用公司名称，后跟技术名称以及可选的功能和设计，如下所示。
> **CompanyName.TechnologyName[.Feature][.Design]**

当然，您可以以您认为更合适的方式使用命名空间。但是，如果您要共享代码，我建议您遵循公认的标准。

**编辑**：

我强烈建议任何 .net 开发人员获取一份《[框架设计指南](https://rads.stackoverflow.com/amzn/click/com/0321246756)》，这本书将帮助您了解.NET 的设计*方式*和*原因。*

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-11T02:31:07.563

一个 VS 解决方案通常包含一个或多个项目。这些项目具有默认命名空间（通常命名空间就是项目的名称）。通常，如果您在项目中添加一个文件夹，则其中的所有类将命名如下：

> > DefaultNamespace.FolderName.ClassName

当然，您可以更改项目的默认命名空间，并以您希望的任何方式命名您的类。

至于何时/如何将内容分解为项目，这是经验和/或偏好的问题。但是，您绝对应该在解决方案中将内容分解为项目，以使您的项目井井有条。如果管理太多程序集变得很麻烦（正如 Blair 建议的那样），您始终可以[将](http://research.microsoft.com/~mbarnett/ILMerge.aspx)您的程序集合并到一个程序集中。ILMerge 的优点在于，即使您最终只得到一个程序集，您的所有类都保留其原始的完全限定名称。

同样重要的是要记住 VS 解决方案与代码无关 - 即。他们没有被建造。VS Solutions 只不过是一种对项目进行分组的方式；它是构建并转换为 DLL 的项目。

最后，VS 让您可以在解决方案的任何位置添加“虚拟”文件夹。这些文件夹不映射到文件系统中的文件夹，只是用作帮助您在解决方案中组织项目和其他工件的另一种方式。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-12T03:30:14.043

命名空间是一个逻辑分组，而项目是一个物理分组。

为什么这很重要？想想 .NET 2.0、3.0 和 3.5。.NET 3.0 基本上是带有一些额外程序集的 .NET 2.0，而 3.5 添加了更多程序集。因此，例如，.NET 3.5 添加了`DataPager`控件，它是一个 Web 控件，应该分组在`System.Web.UI.WebControls`. 如果名称空间和物理位置相同，则不可能是因为它位于不同的程序集中。

因此，将命名空间作为独立的逻辑实体意味着您可以拥有多个不同程序集的成员，这些程序集都在逻辑上组合在一起，因为它们旨在相互结合使用。

（另外，让你的物理和逻辑布局非常相似并没有错。）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-11T02:37:01.417

事实上，.Net 环境允许您将代码扔到 IDE/文件系统，就像意大利面条靠墙一样。

然而，这并不意味着这种方法是理智的。坚持前面提到的 project.foldername.Class 方法通常是个好主意。将一个命名空间中的所有类保存到同一个类中也是一个非常好的主意。

在 Java 中，您可以做类似这样的麻烦事来获得您想要的所有“灵活性”，但这些工具往往会强烈反对它。老实说，对我来说，在被介绍给 .Net 世界时最令人困惑的事情之一就是由于相对较差的指导，这可能是多么草率/不一致。不过，只要稍加思考，就很容易将事情整理得井井有条。:)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-12-04T14:24:01.627

不同之处在于 .net 命名空间与 java 包没有多大关系。

.net 命名空间纯粹用于管理声明范围，与文件、项目或其位置无关。

当您在该命名空间中包含“使用”时，可以访问在特定命名空间中声明的所有内容。

好简单。

名称的选择以及是否/有多少“。” 您使用的分隔符完全取决于您。

VS 默认添加 .foldernames 到你的命名空间只是为了尝试和提供帮助。

这篇文章很好地解释了命名空间：http: [//www.blackwasp.co.uk/Namespaces.aspx](http://www.blackwasp.co.uk/Namespaces.aspx)

它最后还有一个示例命名约定，尽管您的命名约定是您的电话！;)

也就是说，我工作过的大多数地方和与我共事过的人都以公司名称开头，这是明智的，因为它使该公司的类型名称与众不同，（与其他库、供应商、开源项目等分开）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-11T02:30:49.607

您可以将文件夹添加到每个命名空间的解决方案中。虽然它仍会编译为单个可执行文件，但它会组织您的源文件并提供（我认为是）所需的效果？

我通常为项目中的每个命名空间添加一个文件夹，并根据相同的层次结构嵌套它们（例如 MyApp.View.Dialogs）

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-11T02:31:13.897

命名空间是纯语义的。虽然它们通常确实反映了文件夹结构，但至少在使用 Visual Studio IDE 时，它们不需要这样做。

您可以在多个库中引用相同的命名空间，虽然丑陋但真实。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-11T02:38:17.920

我一直认为源文件组织和为类和对象分配标识符是两个独立的问题。我倾向于将相关的类保存在组中，但并不是每个组都应该是一个命名空间。命名空间的存在（或多或少）是为了解决名称冲突的问题——在像 C 这样的平面命名空间语言中，你不能走两英尺而不绊倒像`mycompany_getcurrentdate`or之类的标识符`MYCGetCurrentDate`，因为与第三个函数中的另一个函数发生冲突的风险——派对（或系统）库要小得多。如果您为每个逻辑分隔都创建了一个包或命名空间，您会得到（Java 示例）类名，例如`java.lang.primitivewrapper.numeric.Integer`，这几乎是多余的。

# agile - 您如何将 FogBugz 与敏捷方法结合使用？

> ID：55693
> 
> 赞同：19
> 
> 时间：2008-09-11T02:29:25.413
> 
> 标签：agile, fogbugz, schedule

FogBugz 中的“基于证据的调度”很有趣，但我如何使用敏捷方法论呢？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-11T18:56:10.020

正如[eed3si9n](https://stackoverflow.com/questions/55693/how-do-you-use-fogbugz-with-an-agile-methodology#55702)所说，如果您对 EBS 的估计保持一致，FogBugz 会为您解决这个问题。

至于更笼统的说法，FogBugz 如何与敏捷方法相适应，最好的办法是将 sprint 作为迷你版本进行。创建一个 sprint 并将您希望为该 sprint 实现的案例添加到该版本（或里程碑）。如果您进行为期一周的冲刺，请给它一个结束日期，比如一周后。然后 EBS 可以跟踪它并告诉您是否按时完成。

报告部分中的图表还将向您显示燃尽图。术语有点不同，因为 FogBugz 不仅仅是敏捷的，但信息就在那里。

您想查看完成 sprint 的预期时间是保持稳定还是继续前进。如果它是稳定的，那么你就在正轨上并且你的燃尽率达到了目标。如果它正在缓慢上升，那么您将失去优势，并且您的 sprint 会被延迟。是时候将事情转移到下一个 sprint 或找出你搞砸估计的原因了 :)

本质上，我认为这是一个燃尽图而不是燃尽图，但它为您提供了相同问题的相同答案。我会按时完成吗？我还有什么可做的？

Atalasoft 的Lou Franco也就此 [发表了一篇出色的文章。](https://loufranco.com/blog/scrum-at-atalasoft-burndown-charts-from-fogbugz)[帕特里克奥特曼](http://paltman.com/2006/09/05/sprint-burndown-from-fogbugz/)也有一篇文章。

**更新：**固定链接到奥特曼的文章

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T02:32:38.557

我问过 FogBugz 的人同样的事情，因为例如在 XP 中，你会在 IET（理想工程时间）中提供估计。他们的回答是在您提供估算的方式上保持一致。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-01-20T09:46:35.457

我们开始使用 FogBugz 来处理我们技术团队中的几乎所有事情：文档、错误报告、管理任务。随着时间的推移，我们逐渐变得更加敏捷。

我所做的是创建了一个名为 Product Backlog 的版本，并在未来给出了一个任意的发布日期。我将 FogBugz 字段“版本”更改为“优先级”，以便我们可以按优先级排序。为了管理产品积压，我大量使用区域对用户故事进行分类。区域可以是主题或史诗。每个迭代都是 FogBugz 中的一个版本。

现在，我们最近开始使用的一件事是故事点，而不是用于估算我们的产品待办列表的理想任务天数。FogBugz 不理解故事点的测量单位，因此相当令人困惑，我们的 Product Backlog 中的 1 SP 在 FogBugz 中报告为 1 天。如果有任何混淆，这可能是危险的。但是我们的团队很小。我不使用 FogBugz 中的内置报告工具，但如果可以的话，那就太好了。

所以，我所有的故事点和速度计算都是在 Excel 中的 FogBugz 之外完成的。目前这似乎很好。我们正在使用索引卡来跟踪用户故事的任务，并将便利贴作为办公室板上的任务。看看 Kniberg 写的“Scrum and XP from the Trenches”一书，它影响了我的决定。实际上，我们在早上的 Scrums 中盯着上面的所有东西都放在一块大板上真的很有帮助。

我确实认为 FogBugz 的历史估计历史和报告非常出色。这适用于计划扑克世界吗？我想至少从团队的估计历史来看是这样。

由于产品待办列表中的用户故事经常随着迭代计划会话而发展，（敏捷计划）如果有一个 wiki 风格的案例编辑而不是描述线程，那就太好了。

有传言说下一个主要版本将更加支持敏捷流程，所以我*非常*期待看到它提供。

编辑：FogBugz 7 现在可以更好地管理产品“项目”积压。看一看！

[http://www.fogcreek.com/FogBugz/blog/post/Scrum-Friendly-Features.aspx](http://www.fogcreek.com/FogBugz/blog/post/Scrum-Friendly-Features.aspx)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-12-17T15:35:04.847

以下是在您的计划中包含故事点的一些建议：

当您将您的故事输入 FB7 时，您可以将其作为一个案例进行，并将来自 Planning Poker 的故事点数包含在您创建的名为“故事点”的新自定义字段中（如何执行以下操作）。然后，当您开始着手处理该故事时，如有必要，您可以将其进一步分解为子案例，并输入完成每个子案例的预计时间（预计时间将在故事中累加（顶部）案例的“估计”字段，以及提要基于证据的调度/燃尽图）

这里有两件事需要考虑在你的 FogBugz 安装中修改以反映你的敏捷命名法。

(1) 开箱即用，FB 类别“专题”最像您的“故事”。但是您可以更改您的类别名称，并在管理 > 工作流程 > 自定义类别中添加新名称。以下是有关此的其他信息：

[http://www.fogcreek.com/FogBugz/docs/70/topics/plugins/CustomWorkflow.html?isl=174457](http://www.fogcreek.com/FogBugz/docs/70/topics/plugins/CustomWorkflow.html?isl=174457)

(2) 要捕获故事点，您可能需要在案例对话框中创建一个自定义字段。这是通过包含的自定义字段插件完成的。有关这方面的更多信息，请访问 isl=174461

请注意，使用自定义字段，您还可以为故事添加一个文本编辑框，该文本编辑框将始终出现在案例对话标题中（无论其下方的案例活动历史记录有多长。）

# java - 在 java servlet 中流式传输大文件

> ID：55709
> 
> 赞同：44
> 
> 时间：2008-09-11T02:40:12.563
> 
> 标签：java, java-io

我正在构建一个需要扩展的 java 服务器。其中一个 servlet 将提供存储在 Amazon S3 中的图像。

最近在负载下，我的虚拟机内存不足，这是在我添加代码来提供图像之后，所以我很确定流较大的 servlet 响应会导致我的麻烦。

我的问题是：在从数据库或其他云存储读取时，如何编写 java servlet 以将大型（> 200k）响应流式传输回浏览器是否有任何最佳实践？

我考虑将文件写入本地临时驱动器，然后生成另一个线程来处理流，以便可以重新使用 tomcat servlet 线程。这似乎会很重。

任何想法将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-09-11T03:53:45.523

如果可能，您不应将要提供的文件的全部内容存储在内存中。相反，获取数据的 InputStream，并将数据分段复制到 Servlet OutputStream。例如：

```
ServletOutputStream out = response.getOutputStream();
InputStream in = [ code to get source input stream ];
String mimeType = [ code to get mimetype of data to be served ];
byte[] bytes = new byte[FILEBUFFERSIZE];
int bytesRead;

response.setContentType(mimeType);

while ((bytesRead = in.read(bytes)) != -1) {
    out.write(bytes, 0, bytesRead);
}

// do the following in a finally block:
in.close();
out.close(); 
```

我同意 toby 的观点，你应该改为“将它们指向 S3 url”。

至于OOM异常，您确定它与提供图像数据有关吗？假设您的 JVM 有 256MB 的“额外”内存用于提供图像数据。在 Google 的帮助下，“256MB / 200KB”= 1310。对于 2GB 的“额外”内存（现在是非常合理的数量），可以同时支持超过 10,000 个客户端。即便如此，1300 个并发客户端是一个相当大的数字。这是您遇到的负载类型吗？如果没有，您可能需要在其他地方寻找 OOM 异常的原因。

编辑 - 关于：

> 在这个用例中，图像可能包含敏感数据......

几周前，当我阅读 S3 文档时，我注意到您可以生成可以附加到 S3 URL 的过期密钥。因此，您不必向公众开放 S3 上的文件。我对技术的理解是：

1.  初始 HTML 页面包含指向您的 webapp 的下载链接
2.  用户点击下载链接
3.  您的 web 应用程序会生成一个 S3 URL，其中包含一个在 5 分钟后到期的密钥。
4.  使用步骤 3 中的 URL 向客户端发送 HTTP 重定向。
5.  用户从 S3 下载文件。即使下载需要超过 5 分钟，这也有效 - 一旦下载开始，它可以继续完成。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-11T02:45:02.617

为什么不直接将它们指向 S3 url？从 S3 获取一个工件，然后通过您自己的服务器将其流式传输给我，这违背了使用 S3 的目的，即将带宽和处理图像提供给 Amazon。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2014-04-23T18:31:36.330

我见过很多代码，例如 john-vasilef 的（目前已接受）的答案，一个紧的 while 循环从一个流中读取块并将它们写入另一个流。

我提出的论点是反对不必要的代码重复，支持使用 Apache 的 IOUtils。如果您已经在其他地方使用它，或者如果您正在使用的另一个库或框架已经依赖于它，那么它就是已知且经过充分测试的单行代码。

在以下代码中，我将一个对象从 Amazon S3 流式传输到 servlet 中的客户端。

```
import java.io.InputStream;
import java.io.OutputStream;
import org.apache.commons.io.IOUtils;

InputStream in = null;
OutputStream out = null;

try {
    in = object.getObjectContent();
    out = response.getOutputStream();
    IOUtils.copy(in, out);
} finally {
    IOUtils.closeQuietly(in);
    IOUtils.closeQuietly(out);
} 
```

6 行定义明确的模式以及适当的流关闭看起来非常扎实。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T03:38:08.917

托比是对的，如果可以的话，你应该直接指向 S3。如果你不能，这个问题有点模糊，无法给出准确的回答：你的 Java 堆有多大？内存不足时同时打开多少个流？
您的读写/缓冲区有多大（8K 好）？
您正在从流中读取 8K，然后将 8k 写入输出，对吗？您不是想从 S3 读取整个图像，将其缓冲在内存中，然后一次发送整个图像吗？

如果你使用 8K 缓冲区，你可能有 1000 个并发流在 ~8Megs 的堆空间中，所以你肯定做错了什么......

顺便说一句，我不是凭空选择 8K，它是套接字缓冲区的默认大小，发送更多数据，比如 1Meg，你将阻塞持有大量内存的 tcp/ip 堆栈。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T06:24:24.727

我非常同意 toby 和 John Vasileff 的观点——如果您可以容忍相关问题，S3 非常适合卸载大型媒体对象。（一个自己的应用程序实例对 10-1000MB FLV 和 MP4 执行此操作。）例如：没有部分请求（字节范围标头），但是。一个人必须“手动”处理，偶尔的停机时间等等。

如果这不是一个选项，John 的代码看起来不错。我发现 2k FILEBUFFERSIZE 的字节缓冲区在微基准测试中是最有效的。另一种选择可能是共享 FileChannel。（文件通道是线程安全的。）

也就是说，我还要补充一点，猜测导致内存不足错误的原因是一个典型的优化错误。通过使用硬指标，您将提高成功的机会。

1.  将 -XX:+HeapDumpOnOutOfMemoryError 放入 JVM 启动参数中，以防万一
2.  在负载下运行的 JVM ( **jmap -histo <pid> ) 上使用 jmap**
3.  分析指标（jmap -histo 输出，或让 jhat 查看您的堆转储）。很可能您的内存不足来自意想不到的地方。

当然还有其他工具，但是 jmap 和 jhat 带有 Java 5+ '开箱即用'

> 我考虑将文件写入本地临时驱动器，然后生成另一个线程来处理流，以便可以重新使用 tomcat servlet 线程。这似乎会很重。

啊，我不认为你不能这样做。即使可以，这听起来也很可疑。管理连接的 tomcat 线程需要控制。如果您遇到线程不足，请增加 ./conf/server.xml 中的可用线程数。同样，指标是检测这一点的方法——不要只是猜测。

问题：您是否也在 EC2 上运行？你的tomcat的JVM启动参数是什么？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T03:23:16.673

你必须检查两件事：

*   你要关闭流吗？很重要
*   也许您正在“免费”提供流连接。流并不大，但同时很多很多流可以窃取你所有的内存。创建一个池，这样您就不能同时运行一定数量的流

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T06:16:03.170

除了 John 建议的之外，您还应该反复刷新输出流。根据您的 Web 容器，它可能会缓存部分甚至全部输出并立即刷新（例如，计算 Content-Length 标头）。那会消耗相当多的内存。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-10-01T15:23:14.750

如果您可以构建文件以使静态文件独立且位于各自的存储桶中，则可以通过使用 Amazon S3 CDN [CloudFront](http://aws.amazon.com/cloudfront/)来实现当今最快的性能。

# ruby-on-rails - 用于分发离线 Ruby on Rails 应用程序的选项

> ID：55711
> 
> 赞同：19
> 
> 时间：2008-09-11T02:40:50.253
> 
> 标签：ruby-on-rails, ruby, desktop-application, offline, software-distribution

我正在开发一个使用 Ruby on Rails 的应用程序，主要是作为学习该语言的借口。

这不是一个基于 Web 的应用程序 - 也许我选择了错误的语言，但是......

我的理解是，为了在其他人的计算机上运行这个应用程序的实例，他们需要在 Rails 上安装 ruby​​，以及一个网络服务器（或者 webrick，也许），以及我的应用程序代码。

我只是好奇是否有任何其他选项可以将我的应用程序作为独立应用程序分发，或者只是一种简单的方法将 Web 浏览器和 ROR 与我的应用程序一起打包以进行简单的一步安装？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-11T02:45:26.390

我个人从来不需要这样做。但是，我遇到了本教程[http://www.erikveen.dds.nl/distributingrubyapplications/rails.html](http://www.erikveen.dds.nl/distributingrubyapplications/rails.html)，我认为这会有所帮助。本教程介绍了如何将 Rails 应用程序实际转换为独立的 exe 文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T11:42:41.450

**请注意，Slingshot 似乎是一个死项目（见评论）。出于历史目的，我将把这个答案留在这里，因为它不太可能回来**

Joyent 的[**弹弓**](http://joyent.com/developers/slingshot/)可能是一个不错的选择。

> Joyent Slingshot 允许开发人员像标准桌面应用程序一样部署 Rails 应用程序，它可以在线和离线（同步）工作，具有拖放功能，并与所有其他桌面应用程序交互。
> 
> 使用 Joyent 弹弓：
> 
> *   创建混合 Web/桌面应用程序
> *   同步线上线下数据
> *   在线和离线应用程序使用相同的代码
> *   轻松部署和更新您的应用程序
> *   拖入和拖出应用程序

**以下是一些进一步的链接，可帮助您进行评估和/或帮助您入门：**

*   [介绍 Joyent 弹弓](http://joyeur.com/2007/03/22/joyent-slingshot)
*   [基本应用程序演练](https://dev.joyent.com/projects/slingshot/wiki/BasicApp)
*   [弹弓维基](https://dev.joyent.com/projects/slingshot/wiki/Slingshot)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T21:57:12.457

大多数人将 ruby​​ 程序（包括 Rails webapps）作为独立 exe 发布的方式是通过 ruby​​script2exe。[他们在http://www.erikveen.dds.nl/distributingrubyapplications/rails.html](http://www.erikveen.dds.nl/distributingrubyapplications/rails.html)描述了如何打包 Rails 应用程序。Ruby、Rails 和所有相关的库都将包含在 EXE 文件中。

正如其他人所提到的，Ruby 不一定是 Rails，如果您真的想要一种简单的方法来用 Ruby 编写可分发的 GUI 应用程序，[Shoes](http://code.whytheluckystiff.net/shoes/)是一个很好的起点。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T03:04:04.613

您可以通过将 Ruby on Rails 冻结到您想要在项目中使用的 Rails 版本来包含它。他们称之为冻结。用户无需安装 Rails 即可使用您的应用程序。您可以使用您在项目中使用的任何库来执行此操作。如果项目使用库，只需将其放在项目中的 Vendor 文件夹下即可。然后使用类似于[@Josh](https://stackoverflow.com/questions/55711/options-for-distribution-of-an-offline-ruby-on-rails-application#55718)回答的工具来打包它。

不过，您将需要一个 Web 服务器来运行该项目。没有办法解决这个问题。Ruby on Rails 在这方面就像 ASP.NET，因为它是一个服务器端框架。服务器使用 Rails 框架运行代码并将 HTML 输出到浏览器。

不幸的是，你可能选择了错误的框架来做你想做的事。除了 Ruby on Rails，您可能还想查看[Shoes](http://shoesrb.com/)，这是一个使用 Ruby 开发 GUI 应用程序的框架。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T13:23:32.113

You could always consider compiling your Ruby to JVM byte-code (via [JRuby](http://jruby.codehaus.org/)) or .NET byte-code (via [IronRuby](http://www.ironruby.net/)) to distribute to people who have those virtual machines and don't want to install a Ruby runtime.

You might want to check out [Shoes](http://code.whytheluckystiff.net/shoes/) for building desktop applications in Ruby. Rails really is tuned for building websites.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-11T02:42:59.250

[可能是Gears on Rails](http://code.google.com/p/gearsonrails/)？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T13:46:20.107

您没有具体说明它是否应该是 GUI 应用程序。从其他答案，我猜是这样。

因此，您需要明确您的目标是什么。RoR 是一个专门用于 Web 应用程序的框架。如果您的目标是学习 RoR，我会说让自己获得一些便宜的虚拟主机并让自己成为一个应用程序。如果您的目标是学习 Ruby，而不一定是 Rails，那么 Shoes、IronRuby、JRuby、MacRuby 等可能是不错的选择。

# php - PHP：如何检查两个类的所有公共方法是否返回相同的值？

> ID：55713
> 
> 赞同：2
> 
> 时间：2008-09-11T02:42:09.923
> 
> 标签：php, oop

实际上，如果我有一个`class c`and 的实例，`$c1`并且`$c2` 它可能具有不同的私有变量数量，但它们的所有公共方法都返回相同的值，我希望能够检查`$c1 == $c2?`

有谁知道一个简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-11T08:19:23.483

很难准确地遵循你所追求的。您的问题似乎暗示这些公共方法不需要参数，或者如果它们需要，它们将是相同的参数。

使用内置的反射类可能会走得很远。

下面粘贴的是一个快速测试，我进行了比较两个类的所有公共方法的返回并确保它们相同。您可以轻松地对其进行修改以忽略不匹配的公共方法（即仅检查 class2 中存在于 class1 中的公共方法是否相等）。提供一组参数来传递会比较棘手 - 但可以通过一组方法名称/参数来调用每个类来完成。

无论如何，这可能包含一些对您有用的内容。

```
$class1 = new Class1();
$class2 = new Class2();
$class3 = new Class3();
$class4 = new Class4();
$class5 = new Class5();

echo ClassChecker::samePublicMethods($class1,$class2); //should be true
echo ClassChecker::samePublicMethods($class1,$class3); //should be false - different values
echo ClassChecker::samePublicMethods($class1,$class4); //should be false -- class3 contains extra public methods
echo ClassChecker::samePublicMethods($class1,$class5); //should be true -- class5 contains extra private methods

class ClassChecker {

    public static function samePublicMethods($class1, $class2) {

        $class1methods = array();

        $r = new ReflectionClass($class1);
        $methods = $r->getMethods();

        foreach($methods as $m) {
            if ($m->isPublic()) {
                @$result = call_user_method($m->getName(), $class1);
                $class1methods[$m->getName()] = $result;
            }
        }

        $r = new ReflectionClass($class2);
        $methods = $r->getMethods();

        foreach($methods as $m) {

            //only comparing public methods
            if ($m->isPublic()) {

                //public method doesn't match method in class1 so return false
                if(!isset($class1methods[$m->getName()])) {
                    return false;
                }

                //public method of same name doesn't return same value so return false
                @$result = call_user_method($m->getName(), $class2);
                if ($class1methods[$m->getName()] !== $result) {
                    return false;
                }
            }
        }

        return true;
    }
}

class Class1 {

    private $b = 'bbb';

    public function one() {
        return 999;
    }

    public function two() {
        return "bendy";
    }

}

class Class2 {

    private $a = 'aaa';

    public function one() {
        return 999;
    }

    public function two() {
        return "bendy";
    }
}

class Class3 {

    private $c = 'ccc';

    public function one() {
        return 222;
    }

    public function two() {
        return "bendy";
    }

}

class Class4 {

    public function one() {
        return 999;
    }

    public function two() {
        return "bendy";
    }

    public function three() {
        return true;
    }

}

class Class5 {

    public function one() {
        return 999;
    }

    public function two() {
        return "bendy";
    }

    private function three() {
        return true;
    }

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T08:43:07.090

您还可以实现一个 equal($other) 函数，例如

```
<?php
类Foo {
    公共函数等于（$o）{
        return ($o instanceof 'Foo') && $o.firstName()==$this.firstName();
    }
}

```

或使用 foreach 迭代一个对象的公共属性（此行为可能会被覆盖）并将它们与另一个对象的属性进行比较。

```
<?php
函数 equalsInSomeWay($a, $b) {
    if ( !($b instanceof $a) ) {
        返回假；
    }

    foreach($a as $name=>$value) {
        if ( !isset($b->$name) || $b->$name!=$value ) {
            返回假；
        }
    }
    返回真；
}

```

（未经测试）

或（或多或少）使用反射类相同，请参阅[http://php.net/manual/en/language.oop5.reflection.php#language.oop5.reflection.reflectionobject](http://php.net/manual/en/language.oop5.reflection.php#language.oop5.reflection.reflectionobject)
使用反射，您还可以实现更多鸭子-类型的比较，如果你愿意，比如“我不在乎它是一个实例还是同一个类，只要它具有相同的公共方法并且它们返回'相同'的值”
它真的取决于如何你定义“平等”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T03:02:59.983

您可以在类中定义 PHP 的**__toString**魔术方法。

例如

```
class cat {
    private $name;
    public function __contruct($catname) {
        $this->name = $catname;
    }

    public function __toString() {
        return "My name is " . $this->name . "\n";
    }
}

$max = new cat('max');
$toby = new cat('toby');
print $max; // echoes 'My name is max'
print $toby; // echoes 'My name is toby'

if($max == $toby) {
    echo 'Woohoo!\n';
} else {
    echo 'Doh!\n';
} 
```

然后您可以使用相等运算符来检查两个实例是否相等。

高温下，

鲁士

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T03:18:06.640

乔治：你可能已经看过了，但它可能会有所帮助：[http ://usphp.com/manual/en/language.oop5.object-comparison.php](http://usphp.com/manual/en/language.oop5.object-comparison.php)

> 使用比较运算符（==）时，对象变量的比较方式很简单，即：如果两个对象实例具有相同的属性和值，并且是同一类的实例，则它们相等。

它们不会被隐式转换为字符串。

如果你想做比较，你最终会修改你的类。您还可以使用 getter 和 setter 编写一些自己的 todo 比较方法

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T04:34:40.107

您可以尝试编写自己的类到插件并编写根据您定义的内容进行比较的方法。例如：

```
class Validate {
    public function validateName($c1, $c2) {
        if($c1->FirstName == "foo" && $c2->LastName == "foo") {
            return true;
        } else if (// someother condition) {
            return // someval;
        } else {
            return false;
        }
    }

    public function validatePhoneNumber($c1, $c2) {
        // some code
    }
} 
```

这可能是您不必修改预先存在的类代码的唯一方法

# php - 找出您的 PHP 代码在哪里变慢（性能问题）

> ID：55720
> 
> 赞同：30
> 
> 时间：2008-09-11T02:47:49.597
> 
> 标签：php, mysql, performance, profiling

这是我在 SO 的第一个问题。

我最近被要求维护我公司的内部应用程序。这些应用程序是用 PHP 构建的，它的编码相当好（OO、DB Abstraction、Smarty），没有什么 WTF 风格。

问题是应用程序**很慢**。

如何找出导致应用程序速度变慢的原因？我已经优化了代码以进行很少的数据库查询，所以我知道是 PHP 代码需要一段时间才能执行。我需要一些工具来帮助我解决这个问题，并且需要设计一个检查我的代码的策略。

我可以自己进行检查/策略工作，但我需要更多 PHP 工具来确定我的应用程序在哪里出错。

想法？

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2008-09-11T03:06:52.313

我最近在类似的情况下使用了[XDebug 分析。](http://www.xdebug.org/docs/profiler)它输出一个完整的配置文件报告，可以使用许多常见的分析应用程序读取（虽然不能给你一个列表，我只是使用了 slackware 附带的一个）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-11T14:58:28.687

正如 Juan 提到的，xDebug 非常好。如果您使用的是 Windows，[WinCacheGrind](http://sourceforge.net/projects/wincachegrind/)会让您查看报告。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-11T19:37:26.583

观看 Rasmus Lerdorf（PHP 的创建者）的演示文稿。他介绍了一些测试 PHP 速度和寻找什么的好例子，以及一些可以减慢速度的内部结构。XDebug 是他使用的一种工具。他还提出了一个非常明确的观点，即了解您使用框架会带来哪些性能成本。

视频： [http ://www.archive.org/details/simple_is_hard](http://www.archive.org/details/simple_is_hard)

幻灯片（因为很难在视频中看到）： [http ://talks.php.net/show/drupal08/1](http://talks.php.net/show/drupal08/1)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-15T16:28:45.770

有许多变量会影响您的应用程序的性能。我建议您不要立即认为 PHP 是问题所在。

首先，您如何为 PHP 提供服务？您是否尝试过 Apache 或 IIS 本身的基本优化？服务器是否忙于处理其他类型的请求？您是否利用了[PHP 代码加速器](http://www.google.com/search?q=php+code+accelerator)？测试服务器是否是您的瓶颈的一种方法是尝试在另一台服务器上运行应用程序。

其次，整个应用程序的性能是否缓慢，或者它似乎只影响某些页面？这可以告诉您从哪里开始分析性能。如果整个应用程序很慢，则问题更可能出现在底层服务器/平台中，或者是作为每个请求的一部分的全局 SQL 查询（例如，用户身份验证）。

第三，您提到最小化 SQL 查询的数量，但是优化现有查询呢？如果您使用 MySQL，您是否利用了每个存储系统的各种优势？您是否对最重要的查询运行[EXPLAIN](http://dev.mysql.com/doc/refman/5.0/en/explain.html)以确保它们被正确索引？这对于访问大表的查询至关重要；数据集越大，您越会注意到索引不佳的影响。幸运的是，有很多[像这篇文章这样](http://www.devshed.com/c/a/MySQL/Analyzing-Queries-for-Speed-with-EXPLAIN/)解释如何使用 EXPLAIN 的文章。

第四，一个常见的错误是假设您的数据库服务器会自动使用系统可用的所有资源。您应该检查以确保您已为数据库应用程序显式分配了足够的资源。例如，在 MySQL 中，您需要为键缓冲区、临时表大小、线程并发性、innodb 缓冲池大小等添加自定义设置（在 my.cnf 文件中）。

如果您已经仔细检查了以上所有内容，但仍然无法找到瓶颈，那么 Xdebug 之类的代码分析器绝对可以提供帮助。就个人而言，我更喜欢 Zend Studio 分析器，但它可能不是最佳选择，除非您已经在利用 Zend 平台堆栈的其余部分。然而，根据我的经验，PHP 本身是性能缓慢的根本原因是非常罕见的。通常，代码分析器可以帮助您更准确地确定哪些数据库查询应受到指责。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-03-30T09:51:33.740

您也可以使用[APD](http://pecl.php.net/package/apd)（高级 PHP 调试器）。

让它工作很容易。

```
$ php apd-test.php

$ pprofp -l pprof.SOME_PID

Trace for /Users/martin/develop/php/apd-test/apd-test.php
Total Elapsed Time = 0.12
Total System Time  = 0.01
Total User Time    = 0.07

         Real         User        System             secs/    cumm
%Time (excl/cumm)  (excl/cumm)  (excl/cumm) Calls    call    s/call  Memory Usage Name
--------------------------------------------------------------------------------------
71.3 0.06 0.06  0.05 0.05  0.01 0.01  10000  0.0000   0.0000            0 in_array
27.3 0.02 0.09  0.02 0.07  0.00 0.01  10000  0.0000   0.0000            0 my_test_function
 1.5 0.03 0.03  0.00 0.00  0.00 0.00      1  0.0000   0.0000            0 apd_set_pprof_trace
 0.0 0.00 0.12  0.00 0.07  0.00 0.01      1  0.0000   0.0000            0 main 
```

有一个很好的教程如何编译 APD 并使用它进行分析：[http ://martinsikora.com/compiling-apd-for-php-54](http://martinsikora.com/compiling-apd-for-php-54)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-11T21:02:48.950

phpED ( [http://www.nusphere.com/products/phped.htm](http://www.nusphere.com/products/phped.htm) ) 还提供了很好的调试和分析功能，以及在 PHP 代码中添加监视、断点等的能力。集成分析器直接提供 IDE 中每个函数调用和类方法的时间分解。浏览器插件还可以与 Firefox 或 IE 快速集成（即用浏览器访问慢速 URL，然后单击按钮进行分析或调试）。

它在指出应用程序慢的地方以集中大部分编码工作时非常有用；它避免浪费时间优化已经很快的代码。在尝试过 Zend 和 Eclipse 之后，我现在已经被 phpED 的易用性所吸引。

请记住，在针对 Web 服务器进行调试时，Xdebug 和 phpED（带有 DBG）都需要安装额外的 PHP 模块。phpED 还提供（我未尝试过）本地调试选项。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-13T00:24:34.370

Xdebug 配置文件绝对是要走的路。另一个提示 - WincacheGrind 很好，但最近没有更新。 [http://code.google.com/p/webgrind/](http://code.google.com/p/webgrind/) - 在浏览器中可能是一种简单快捷的选择。

但有可能，它仍然是数据库。检查相关索引 - 并且它有足够的内存来缓存尽可能多的工作数据。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-11T20:32:06.047

如果它的代码库很大，如果您还没有，请尝试 apc。

[http://pecl.php.net/package/APC](http://pecl.php.net/package/APC)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-12T19:11:09.803

您也可以尝试使用 php.ini 中的 register_tick_function 函数。它告诉 php 在您的代码中定期调用某个函数。然后，您可以跟踪当前正在运行的函数以及调用之间的时间量。然后你可以看到什么是花费最多的时间。 [http://www.php.net/register_tick_function](http://www.php.net/register_tick_function)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-11T03:47:59.610

我们使用 Zend 开发环境（windows）。昨天，我们通过在运行 Process Explorer 时单步调试调试器来解决内存使用高峰问题，以观察每行执行时的内存/cpu/磁盘活动。

进程资源管理器：[http](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx) ://technet.microsoft.com/en-us/sysinternals/bb896653.aspx 。

ZDE 包括一个基本的性能分析器，它可以显示页面请求期间每个函数调用所花费的时间。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-09-11T14:50:03.340

我使用[PEAR Benchmark](http://pear.php.net/package/Benchmark)和[log4php](http://incubator.apache.org/log4php/)的组合。

在我想要分析的脚本顶部，我创建了一个环绕[Benchmark_Timer](http://pear.php.net/package/Benchmark/docs/latest/Benchmark/Benchmark_Timer.html)对象的对象。在整个代码中，我添加了`$object->setMarker("name");`调用，尤其是在可疑代码周围。

包装类有一个 destroy 方法，它获取日志信息并将其写入 log4php。我通常将其发送到系统日志（许多服务器，聚合到一台服务器上的一个日志文件）。

在调试中，我可以查看日志文件并查看需要改进的地方。稍后在生产中，我可以解析日志文件并进行性能分析。

它不是 xdebug，但它始终处于打开状态，使我能够比较代码的任意两次执行。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-05-13T08:38:04.280

如果您的服务器性能下降是应用程序处理缓慢的原因，您还可以查看[HA 代理或任何其他负载平衡解决方案。](http://www.haproxy.org/)服务器。

# git - 你应该多久使用一次 git-gc？

> ID：55729
> 
> 赞同：247
> 
> 时间：2008-09-11T02:59:13.830
> 
> 标签：git, git-gc

你应该多久使用一次 git-gc？

[手册页](http://www.kernel.org/pub/software/scm/git/docs/git-gc.html)简单地说：

> 鼓励用户在每个存储库中定期运行此任务，以保持良好的磁盘空间利用率和良好的运行性能。

是否有一些命令可以获取一些对象计数以确定是否该 gc 了？

* * *

## 回答 #1

> 赞同：216
> 
> 时间：2008-09-11T03:10:24.350

这主要取决于存储库的使用量。如果一个用户每天签入一次，并且每周执行一次分支/合并/等操作，您可能不需要每年运行一次以上。

有几十个开发人员在处理几十个项目，每个项目每天检查 2-3 次，您可能希望每晚运行它。

不过，比需要的更频繁地运行它不会有什么坏处。

我要做的是现在运行它，然后在一周后测量磁盘利用率，再次运行它，然后再次测量磁盘利用率。如果它的大小下降 5%，则每周运行一次。如果下降更多，则更频繁地运行它。如果下降较少，则减少运行频率。

* * *

## 回答 #2

> 赞同：110
> 
> 时间：2008-09-17T20:41:39.217

请注意，垃圾收集存储库的缺点是，垃圾会被收集。众所周知，作为计算机用户，我们现在认为是垃圾的文件可能在未来三天内变得非常有价值。git 保留其大部分碎片的事实多次拯救了我的培根——通过浏览所有悬空提交，我恢复了许多我不小心封存的工作。

所以不要在你的私人克隆中过于整洁。几乎不需要它。

OTOH，对于主要用作遥控器的存储库，数据可恢复性的价值是值得怀疑的，例如。所有开发人员推入和/或拉出的地方。在那里，经常启动 GC 运行和重新打包可能是明智的。

* * *

## 回答 #3

> 赞同：33
> 
> 时间：2008-09-15T21:23:00.070

最新版本的 git 会在需要时自动运行 gc，因此您无需执行任何操作。[请参阅man git-gc(1)](http://www.kernel.org/pub/software/scm/git/docs/git-gc.html#_options)的选项部分：“一些 git 命令在执行可能创建许多松散对象的操作后运行 git gc --auto。”

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2013-08-30T20:50:28.873

如果您使用的是[**Git-Gui**](http://git-scm.com/docs/git-gui)，它会[告诉您](https://stackoverflow.com/questions/1106529/how-to-skip-loose-object-popup-when-running-git-gui)何时应该担心：

> ```
> This repository currently has approximately 1500 loose objects. 
> ```

以下命令将带来类似的数字：

```
$ git count-objects 
```

除了，[从它的来源](http://code.ohloh.net/file?fid=ixHQFFqenblz1kBNxchs4xCFe6w&cid=S766kQUyJJc&s=%22This%20repository%20currently%20has%20approximately%22&fp=288055&mpundefined=&projSelected=true&filterCheckedundefined=&filterChecked=true&mp=1&ml=1&me=1&md=1#L107)， git-gui 会自己做数学，实际上在`.git/objects`文件夹中计算一些东西，可能会带来一个近似值（我不知道`tcl`要正确阅读它！）。

无论如何，它**似乎是根据***大约*300 个松散物体的任意数量发出警告。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2008-09-11T04:00:27.927

将它放在每晚（下午？）在你睡觉时运行的 cron 作业中。

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2014-03-12T16:39:30.963

使用新的 (Git 2.0 Q2 2014) 设置，您可以在没有任何中断的情况下执行此操作[**`gc.autodetach`**](https://git-scm.com/docs/git-config/2.1.0#git-config-gcautodetach)。

请参阅[提交 4c4ac4d](https://github.com/git/git/commit/4c4ac4db2c933fbae1c6e6bcf90d9bee5f823fc7)和[提交 9f673f9](https://github.com/git/git/commit/9f673f9477c63433aa0774c11b9e42979721f4d6)（[Nguyễn Thái Ngọc Duy，又名 pclouds](https://github.com/pclouds)）：

> `gc --auto`需要时间并且可以暂时阻止用户（但同样令人讨厌）。
> 让它在支持它的系统上在后台运行。
> 在后台运行时唯一丢失的是打印输出。但`gc output`并不是很有趣。
> 您可以通过更改将其保持在前台`gc.autodetach`。

* * *

自该 2.0 版本以来，虽然存在一个错误：git 2.7 (Q4 2015) 将确保**不会丢失错误消息**。
请参阅[Nguyễn Thái Ngọc Duy (](https://github.com/pclouds) [)的](https://github.com/pclouds)[提交 329e6e8](https://github.com/git/git/commit/329e6e8794c347d3da92144f88ad838945508ac6)（2015 年 9 月 19 日） 。^(（由)^([Junio C Hamano 合并 --](https://github.com/gitster)) ^([--](https://github.com/gitster))^在^([提交 076c827](https://github.com/git/git/commit/076c8278583b70547c1c5a65941a661f08210252))^(中，2015 年 10 月 15 日）)[`pclouds`](https://github.com/pclouds)
^([`gitster`](https://github.com/gitster))

> ## `gc`: 从守护进程中保存日志`gc --auto`并在下次打印
> 
> 虽然[提交 9f673f9](https://github.com/git/git/commit/9f673f9477c63433aa0774c11b9e42979721f4d6)（`gc`：用于在后台运行的配置选项`--auto`- 2014-02-08）有助于减少一些关于“”占用终端的抱怨`gc --auto`，但它会产生另一组问题。
> 
> 由于守护进程，该集合中的最新版本`stderr`已关闭，并且所有警告都丢失了。这个末尾的警告`cmd_gc()`特别重要，因为它告诉用户如何避免“ `gc --auto`”重复运行。
> 因为stderr是关闭的，用户不知道，自然会抱怨' `gc --auto`'浪费CPU。
> 
> **Daemonized`gc`现在保存`stderr`到`$GIT_DIR/gc.log`. 在用户删除之前，
> Following`gc --auto`不会运行并`gc.log``gc.log`**打印出来。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-15T21:16:46.530

我在进行大量结帐后使用 git gc ，并且有很多新对象。它可以节省空间。例如，如果您使用 git-svn 签出一个大型 SVN 项目，然后执行 git gc，您通常会节省大量空间

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2015-05-14T21:20:03.753

此报价来自； [使用 Git 进行版本控制](https://rads.stackoverflow.com/amzn/click/com/1449316387)

> **Git 自动运行垃圾收集**：
> 
> • 如果存储库中有太多松散对象
> 
> • 当推送到远程存储库时
> 
> • 在一些可能引入许多松散对象的命令之后
> 
> • 当某些命令（如 git reflog）过期时明确请求它
> 
> 最后，当您使用 git gc 命令明确请求垃圾收集时，就会发生垃圾收集。但那应该是什么时候呢？这个问题没有可靠的答案，但有一些好的建议和最佳实践。
> 
> **您应该考虑在以下几种情况下手动运行 git gc：**
> 
> • 如果您刚刚完成了一个 git filter-branch 。回想一下，filter-branch 重写了许多提交，引入了新的提交，并将旧的提交留在了一个 ref 上，当您对结果感到满意时应该将其删除。所有那些死对象（由于您刚刚删除了指向它们的一个引用，因此不再被引用）应该通过垃圾回收来删除。
> 
> • 在一些可能引入许多松散对象的命令之后。例如，这可能是一个很大的变基工作。
> 
> **另一方面，什么时候应该警惕垃圾收集？**
> 
> • 如果存在您可能想要恢复的孤立引用
> 
> • 在 git rerere 的上下文中，您不需要永远保存决议
> 
> • 在只有标签和分支足以使 Git 永久保留提交的情况下
> 
> • 在 FETCH_HEAD 检索（通过 git fetch 的 URL 直接检索）的上下文中，因为它们会立即受到垃圾回收的影响

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2014-04-27T22:53:34.913

我在进行大提交时使用，尤其是当我从存储库中删除更多文件时。之后，提交速度更快

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2019-07-31T11:50:43.253

您不必`git gc`经常使用，因为`git gc`（垃圾收集）会在几个常用命令上自动运行：

```
git pull
git merge
git rebase
git commit 
```

来源：[git gc 最佳实践和常见问题解答](https://www.atlassian.com/git/tutorials/git-gc)

# ms-word - 如何使用 VSTO 检测 Word 中的文本和光标位置变化

> ID：55735
> 
> 赞同：1
> 
> 时间：2008-09-11T03:05:48.353
> 
> 标签：ms-word, ms-office, vsto

我想编写一个单词插件，每当用户键入某些内容或移动当前插入点时，它都会进行一些计算并更新一些 ui。通过查看 MSDN 文档，我没有看到任何明显的方式，例如文档或应用程序对象上的 TextTyped 事件。

有谁知道这是否可能不轮询文件？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-06-23T17:23:51.350

实际上有一种方法可以在输入一个单词时运行一些代码，你可以使用 SmartTags，并重写 Recognize 方法，只要输入一个单词就会调用这个方法，这意味着每当用户输入一些文本并点击空格、制表符或输入键。

然而，这样做的一个问题是，如果您使用“Range.Text”更改文本，它会将其检测为单词更改并调用该函数，因此可能会导致无限循环。

这是我用来实现此目的的一些代码：

```
public class AutoBrandSmartTag : SmartTag
{
    Microsoft.Office.Interop.Word.Document cDoc;

    Microsoft.Office.Tools.Word.Action act = new Microsoft.Office.Tools.Word.Action("Test Action");

    public AutoBrandSmartTag(AutoBrandEngine.AutoBrandEngine _engine, Microsoft.Office.Interop.Word.Document _doc)
        : base("AutoBrandTool.com/SmartTag#AutoBrandSmartTag", "AutoBrand SmartTag")
    {
        this.cDoc = _doc;

        this.Actions = new Microsoft.Office.Tools.Word.Action[] { act };
    }

    protected override void Recognize(string text, Microsoft.Office.Interop.SmartTag.ISmartTagRecognizerSite site, 
        Microsoft.Office.Interop.SmartTag.ISmartTagTokenList tokenList)
    {
        if (tokenList.Count < 1)
            return;

        int start = 0;
        int length = 0;
        int index = tokenList.Count > 1 ? tokenList.Count - 1 : 1;

        ISmartTagToken token = tokenList.get_Item(index);

        start = token.Start;
        length = token.Length;
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T05:47:51.693

您可能已经发现，[Word 有事件](http://msdn.microsoft.com/en-us/library/aa269681(office.10).aspx)，但它们用于非常粗略的操作，例如打开文档或切换到另一个文档。我猜 MS 这样做是为了防止糟糕的宏减慢打字速度。

简而言之，没有什么好方法可以做你想做的事。 [Word MVP 在此线程中证实了这一点。](http://www.microsoft.com/communities/newsgroups/en-us/default.aspx?dg=microsoft.public.office.developer.com.add_ins&tid=4c3e438e-d9ab-4384-b29c-105175fd252e&cat=&lang=&cr=&sloc=&p=1)

# css - 在浏览器中本地缓存菜单系统的最佳方法是什么？

> ID：55752
> 
> 赞同：3
> 
> 时间：2008-09-11T03:23:30.993
> 
> 标签：css, menu

我有一个非常大的级联菜单系统，其中包含 300 多个项目。*（我知道它很大，但这是一个要求。）*
目前，它是用 javascript 编写的，因此外部文件被浏览器缓存。

为了改善搜索引擎结果，我需要将其转换为 CSS 菜单系统。
我意识到浏览器也会缓存外部样式表，但是，

*   有没有办法缓存菜单内容（`<ul>`和`<li>`标签）？

如果我使用 javascript ( `document.write`) 编写内容，我可以将其保存在外部 javascript 文件中，该文件将在本地缓存，但是，

*   这对搜索引擎友好吗？

什么是最好的解决方案？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-11T03:29:09.700

完成您想做的事情的最佳方式是使用[SiteMaps](https://www.google.com/webmasters/tools/docs/en/protocol.html)通知 Google 您网站的网址。基本上，您需要将菜单的层次结构数据转换为站点地图。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T04:15:48.840

您可以预先将菜单生成为静态 html / javascript 文件，并让所有页面从您网站上的同一 URL 拉取该网站。这样，客户端浏览器将进行缓存。您只需在部署中执行一个步骤，即可为菜单生成 html 文件。

尝试让它生成尽可能多的纯 HTML (+JS +CSS)，然后可以使用 javascript 调整任何必须是动态的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T04:39:41.637

你可以只用 CSS 和 HTML 来做所有的事情，而且你不需要使用任何 Java 脚本。参见 < [http://www.netwiz.com.au/cssmenu.htmlvalue](http://www.netwiz.com.au/cssmenu.htmlvalue) >。这个页面展示了一个与特定文档软件一起使用的工具，但示例 CSS 和 HTML 展示了如何在大量浏览器中将 ul li 元素用于仅 CSS/HTML 的菜单。

您仍然有菜单中有 300 个项目的问题，这将增加加载时间。如果这是一个问题，我想您可以将此代码移动到单独的 iframe 以增加它被缓存在代理（或浏览器）的机会。冒着冒犯纯粹主义者的风险，即使是框架也可以完成这项工作，但是如果主题页面直接链接到，您将遇到无法显示菜单的问题。

# c++ - 在 Visual C++ 中创建自定义性能计数器

> ID：55753
> 
> 赞同：5
> 
> 时间：2008-09-11T03:25:26.403
> 
> 标签：c++, visual-c++, performancecounter

有人知道使用普通非托管 Visual C++ 创建自定义性能计数器的方法吗？

我知道可以使用托管 C++ 轻松完成，但我需要使用非托管 Windows 服务来完成。

我也知道您可以检索性能计数器数据，但我需要创建一些自定义计数器并在应用程序运行时增加它们。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2015-06-02T19:48:43.883

在 Vista 及更高版本中更改了对添加 C++ 性能计数器的支持。另一个答案中建议的性能 DLL 方法仍然有效，但[此处](https://msdn.microsoft.com/en-us/library/aa965334(v=vs.85).aspx)描述的新技术更易于使用。

在这种方法中，您编写一个描述您的计数器的清单，运行 CTRPP，这是一个从您的清单生成代码的工具。编译此代码并将其链接到您的应用程序，并添加调用以初始化进程（它启动后台线程），并添加代码以根据需要更新计数器。发布计数器的细节由运行生成代码的后台线程处理。

您还需要运行 lodctr /m:[manifest file] 来注册您的计数器，然后才能使用它们。这必须以管理员身份运行。

顺便说一句：另一个程序 unlodctr 反转 lodctr 的效果，如果您对计数器进行任何更改，则必须使用它，因为没有“替换”操作，只删除旧的，然后安装新的。

<RANT>以上所有内容的文档都非常糟糕。例如 lodctr 完全针对 Vista 进行了重新设计，但 MSDN 中的文档都是针对 XP 版本的，不再适用。如果您访问 MSDN，请随意使用“此文档没有帮助”按钮，也许 Microsoft 会收到消息。</RANT>

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-11T06:09:49.550

见这里：http: [//msdn.microsoft.com/en-us/library/aa371925.aspx](http://msdn.microsoft.com/en-us/library/aa371925.aspx)

这并不难，但有点乏味，因为 API 涉及到大量使用自引用、可变长度结构，并且必须采用一些 IPC 机制来从受监控的进程中获取数据。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T08:41:17.813

不要使用 ATL 性能监视器类。我知道他们很容易添加，他们有一个向导和所有，但他们无可救药地被窃听了。我在工作中将它们添加到我的一个开发应用程序中，然后不得不在 6 个月后检查并撕掉代码。总而言之，大约 3 周的工作都被这种噪音淹没了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T08:32:05.433

我一直在寻找更容易实现的东西。我可能不得不使用这种方法。一位同事（感谢 PJ）还向我展示了一个 Scribble 教程，该教程已被修改以展示如何使用 ATL 类添加性能计数器： [PerformanceScribble 示例：MFC 应用程序中的性能监控](http://msdn.microsoft.com/en-us/library/z1xc8ye3(VS.80).aspx "PerformanceScribble 示例：MFC 应用程序中的性能监控")

这里最大的缺点是目前我的应用程序不使用 MFC 或 ATL，我必须添加对它的支持。

# bash - 如何在 Bash 中将文件名中的填充数字归零？

> ID：55754
> 
> 赞同：60
> 
> 时间：2008-09-11T03:25:41.783
> 
> 标签：bash, rename

使用 Bash 以以下形式重命名文件的最佳方法是什么：

```
(foo1, foo2, ..., foo1300, ..., fooN) 
```

使用零填充文件名：

```
(foo00001, foo00002, ..., foo01300, ..., fooN) 
```

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2010-12-30T10:23:45.687

它不是纯 bash，但使用 Perl 版本的`rename`:

```
rename 's/\d+/sprintf("%05d",$&)/e' foo* 
```

`'s/\d+/sprintf("%05d",$&)/e'`Perl 替换正则表达式在哪里。

*   `\d+`将匹配第一组数字（至少一个数字）
*   `sprintf("%05d",$&)`将匹配的数字传递给 Perl's `sprintf`，`%05d`并将填充到五位数

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2008-09-11T03:47:46.070

如果`N`不是先验固定的：

```
for f in foo[0-9]*; do
  mv "$f" "$(printf 'foo%05d' "${f#foo}")"
done 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2010-09-13T11:54:54.573

我有一个更复杂的情况，文件名有后缀和前缀。我还需要从文件名中减去数字。

例如，我想`foo56.png`成为`foo00000055.png`.

如果您正在做更复杂的事情，我希望这会有所帮助。

```
#!/bin/bash

prefix="foo"
postfix=".png"
targetDir="../newframes"
paddingLength=8

for file in ${prefix}[0-9]*${postfix}; do
  # strip the prefix off the file name
  postfile=${file#$prefix}
  # strip the postfix off the file name
  number=${postfile%$postfix}
  # subtract 1 from the resulting number
  i=$((number-1))
  # copy to a new name with padded zeros in a new folder
  cp ${file} "$targetDir"/$(printf $prefix%0${paddingLength}d$postfix $i)
done 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2017-08-08T13:22:17.380

我使用的单行命令是这样的：

```
ls * | cat -n | while read i f; do mv "$f" `printf "PATTERN" "$i"`; done 
```

例如，模式可以是：

*   使用增量计数器重命名：（`%04d.${f#*.}`保留原始文件扩展名）
*   使用带前缀的增量计数器重命名：（`photo_%04d.${f#*.}`保留原始扩展名）
*   使用增量计数器重命名并将扩展名更改为 jpg：`%04d.jpg`
*   使用带有前缀和文件基名的增量计数器重命名：`photo_$(basename $f .${f#*.})_%04d.${f#*.}`
*   ...

您可以过滤要重命名的文件，例如`ls *.jpg | ...`

您可以使用`f`作为文件名的变量，即`i`计数器。

对于您的问题，正确的命令是：

```
ls * | cat -n | while read i f; do mv "$f" `printf "foo%d05" "$i"`; done 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2019-03-29T01:07:23.197

To left-pad numbers in filenames:

```
$ ls -l
total 0
-rw-r--r-- 1 victoria victoria 0 Mar 28 17:24 010
-rw-r--r-- 1 victoria victoria 0 Mar 28 18:09 050
-rw-r--r-- 1 victoria victoria 0 Mar 28 17:23 050.zzz
-rw-r--r-- 1 victoria victoria 0 Mar 28 17:24 10
-rw-r--r-- 1 victoria victoria 0 Mar 28 17:23 1.zzz

$ for f in [0-9]*.[a-z]*; do tmp=`echo $f | awk -F. '{printf "%04d.%s\n", $1, $2}'`; mv "$f" "$tmp"; done;

$ ls -l
total 0
-rw-r--r-- 1 victoria victoria 0 Mar 28 17:23 0001.zzz
-rw-r--r-- 1 victoria victoria 0 Mar 28 17:23 0050.zzz
-rw-r--r-- 1 victoria victoria 0 Mar 28 17:24 010
-rw-r--r-- 1 victoria victoria 0 Mar 28 18:09 050
-rw-r--r-- 1 victoria victoria 0 Mar 28 17:24 10 
```

**Explanation**

```
for f in [0-9]*.[a-z]*; do tmp=`echo $f | \
awk -F. '{printf "%04d.%s\n", $1, $2}'`; mv "$f" "$tmp"; done; 
```

*   note the backticks: ``echo ... $2}\`` (The backslash, \, immediately above just splits that one-liner over two lines for readability)
*   in a loop find files that are named as numbers with lowercase alphabet extensions: `[0-9]*.[a-z]*`
*   echo that filename (`$f`) to pass it to `awk`
*   `-F.` : `awk` field separator, a period (`.`): if matched, separates the file names as two fields (`$1` = number; `$2` = extension)
*   format with `printf`: print first field (`$1`, the number part) as 4 digits (`%04d`), then print the period, then print the second field (`$2`: the extension) as a string (`%s`). All of that is assigned to the `$tmp` variable
*   lastly, move the source file (`$f`) to the new filename (`$tmp`)

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-03T08:43:45.170

纯 Bash，除了 'mv' 没有外部进程：

```
for file in foo*; do
  newnumber='00000'${file#foo}      # get number, pack with zeros
  newnumber=${newnumber:(-5)}       # the last five characters
  mv $file foo$newnumber            # rename
done 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-11T03:41:38.737

以下将做到这一点：

```
for ((i=1; i<=N; i++)) ; do mv foo$i `printf foo%05d $i` ; done 
```

**编辑：**改为使用 ((i=1,...))，谢谢[mweerden](https://stackoverflow.com/users/4285/mweerden)！

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-02-26T15:17:29.210

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-09-03T01:59:06.040

This answer is derived from Chris Conway's accepted answer but **assumes your files have an extension** (unlike Chris' answer). Just paste this (rather long) one liner into your command line.

```
for f in foo[0-9]*; do mv "$f" "$(printf 'foo%05d' "${f#foo}" 2> /dev/null)"; done; for f in foo[0-9]*; do mv "$f" "$f.ext"; done; 
```

**OPTIONAL ADDITIONAL INFO**

This script will rename

```
foo1.ext    > foo00001.ext
foo2.ext    > foo00002.ext
foo1300.ext > foo01300.ext 
```

To test it on your machine, just paste this one liner into an **EMPTY** directory.

```
rm * 2> /dev/null; touch foo1.ext foo2.ext foo1300.ext; for f in foo[0-9]*; do mv "$f" "$(printf 'foo%05d' "${f#foo}" 2> /dev/null)"; done; for f in foo[0-9]*; do mv "$f" "$f.ext"; done; 
```

This deletes the content of the directory, creates the files in the above example and then does the batch rename.

For those who don't need a one liner, the script indented looks like this.

```
for f in foo[0-9]*;
  do mv "$f" "$(printf 'foo%05d' "${f#foo}" 2> /dev/null)";
done;

for f in foo[0-9]*;
  do mv "$f" "$f.ext";
done; 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-11T03:43:43.677

这是一个快速的解决方案，它假设一个固定长度的前缀（你的“foo”）和固定长度的填充。如果您需要更大的灵活性，也许这至少是一个有用的起点。

```
#!/bin/bash

# some test data
files="foo1
foo2
foo100
foo200
foo9999"

for f in $files; do
    prefix=`echo "$f" | cut -c 1-3`        # chars 1-3 = "foo"
    number=`echo "$f" | cut -c 4-`         # chars 4-end = the number
    printf "%s%04d\n" "$prefix" "$number"
done 
```

# asp.net - ASP.NET - app_data 文件夹中 sql server 数据库的性能影响

> ID：55755
> 
> 赞同：2
> 
> 时间：2008-09-11T03:25:56.213
> 
> 标签：asp.net, sql-server, database

默认的**asp.net**成员资格提供程序使用`.mdf`数据库中的 sql server 数据库文件`app_code`。
就调用平面文件数据库而不是在标准 sql 环境中运行而言，它的可扩展性如何？
这是否仅推荐用于中小型流量站点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-11T03:30:09.950

对于可以在一台服务器上运行的任何站点来说，这是一个合理的权衡。对于中小型流量站点来说，这是相当合理的。

当您发展到一个网络场时，您最好使用单独的服务器。此外，根据您的应用程序对数据库的依赖程度，您可能会发现将 SQL 查询移交给完全不同的服务器/处理器来处理数据库端的性能会更好。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T06:47:42.297

除了“学习”项目，我不会推荐这个。

对于任何实际应用程序，无论大小，您都不知道您将添加哪种类型的“下一个功能”。您想拥有一个真正独立的数据库，您可以在其中委派功能，您可以将作业设置为独立运行，坐在不同的 HD 上，也许将其拆分到不同的 VM 中？

您可以使用 SQL Express 并且仍然是“免费的”，并且最好在站点增长并且数据库更难移动之前进行这种分离。

# php - PHP 多形式验证和重定向

> ID：55757
> 
> 赞同：4
> 
> 时间：2008-09-11T03:27:07.007
> 
> 标签：php, validation, post

我有`buy.php`一个**表格**，您可以在其中输入*物品、数量、运输数据等。*

当您单击**提交按钮**时，它会回发`buy.php` `($_SERVER['PHP_SELF'])`并进行一些数据验证。

如果缺少字段或错误，则会突出显示它们。如果一切正确，我将`$_POST`数据保存在`$_SESSION`变量中，然后执行 a `header('Location: check.php')`，在其中显示数据，以便买家在实际购买前最后一次检查信息。

现在，如果我进入`check.php`并点击返回按钮`buy.php`以便我可以更改内容，浏览器会询问我是否要重新发送 POST 数据。我试图避免这种情况。

**有人对 PHP Multiform 验证有什么好的建议或好的做法吗？**

**另外，如果我有 n 个页面供用户填写，`buy.php, buy2.php, ... buyn.php`那么在 check.php 之前，同样的想法是否仍然成立？**

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T03:35:47.033

您可以在保存到会话对象后重定向到 buy.php，然后服务器重定向到 check.php，这意味着当用户点击返回时，他们将返回 GET 请求而不是 POST 请求

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-06-27T16:18:10.427

是的——我同意上述观点。我总是`redir`远离上一篇文章，所以点击返回会将它们弹回而不会出现错误或重新提交。它还避免了并发症。你总是可以`redir`用`?m`或`&m`（即：）标记链接页面并将`page.php?m`其放在页面顶部：（`elseif`之后使用）

```
if (isset($_GET['m'])) {
  echo 'order placed.';
}
else {
  //...
} 
```

您也可以将所有内容都放在一页上。只需将提交按钮命名为`submit1`, `submit2`，例如：（请记住，如果您使用图像进行提交，它将变为`$_POST['submit1_x']`:)

```
if (isset($_POST[submit1]) {
  //validate + save session data from form1
  //display form 2
} else if(isset($_POST[submit2])) {
  //validate + save session data from form2
  //display form 3
} else {
  //display first form
  //<input type="submit" name="submit1" value="Continue">
} 
```

# php - 如何使用 PHP 找到用户的 IP 地址？

> ID：55768
> 
> 赞同：38
> 
> 时间：2008-09-11T03:36:45.643
> 
> 标签：php, ip-address

当他/她进入我的页面时，我想找到用户的 IP 地址。我如何以编程方式做到这一点？

# visual-studio-2008 - 如何在不同的 Visual Studio 解决方案中引用 WCF 服务？

> ID：55797
> 
> 赞同：2
> 
> 时间：2008-09-11T04:18:07.743
> 
> 标签：visual-studio-2008, wcf

一个解决方案中的 Visual Studio 2008 项目需要引用同一开发机器上另一个 VS 2008 解决方案中的 WCF 服务。有人对如何最好地做到这一点有任何建议吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T04:20:06.053

托管服务，然后在其他项目中使用托管服务的 URI 让 VS 为您创建代理。

**[这是](http://msdn.microsoft.com/en-us/library/bb628652.aspx)**有关如何添加参考的分步文章。这里**[有](http://msdn.microsoft.com/en-us/library/bb552363.aspx)**一篇文章教你如何在 VS 中托管服务（这可能是开发时最简单的事情）。不过，我建议您在 IIS 中托管您的服务，即使在开发期间也是如此。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T04:58:06.697

右键单击另一个 VS 中的 WCF 解决方案，然后单击 Debug -> Start，这应该会使 WCF 显示在系统托盘中。然后，在要添加服务的 VS 中，添加服务引用。

如果您希望能够步入 WCF 代码进行调试，请在菜单中打开 Debug -> Attach Tread。然后向下滚动列表，直到您看到 WCF 服务在您的其他 VS 中运行。

# vb.net - Visual Studio 自动化：在加载解决方案时枚举打开的窗口

> ID：55804
> 
> 赞同：1
> 
> 时间：2008-09-11T04:25:41.687
> 
> 标签：vb.net, visual-studio, scripting, automation

如何在使用宏加载解决方案时枚举打开的代码窗口（即编辑文档的窗口）？

您可能知道，MSVS 会记住打开的文件，即当您加载解决方案时，IDE 会加载以前打开的文件。我想要做的是在解决方案加载时对这些窗口执行一些操作。

我试图在 SolutionEvents_Opened 处理程序中访问这些窗口。但是没有运气 - 似乎在调用 SolutionEvents_Opened 时提到的窗口不可用。DTE.Documents 为空，并且 DTE.Windows.Items 不包含它们。

我需要一些代码，例如：

```
Private Sub SolutionEvents_Opened() Handles SolutionEvents.Opened
   Dim window As Window = DTE.Documents.Item(?).Windows // one of the opened windows
   ...
End Sub 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-17T06:29:41.870

我发现枚举窗口的一种方法是在 DocumentEvents.DocumentOpened 事件上，但它总是会触发它，而不仅仅是在加载解决方案期间。根据我的经验，SolutionEvents.Opened 似乎根本没有被触发，否则可以在其中更改静态变量。

[不过，这](http://www.dotnetmonster.com/Uwe/Forum.aspx/vs-ext/1231/SolutionEvents-Opened-but-no-active-projects)可能有助于解释它。

# .net - 如果通常在存储库的结构中执行任何操作以反映已部署的单元，该怎么办？

> ID：55823
> 
> 赞同：0
> 
> 时间：2008-09-11T04:52:07.303
> 
> 标签：.net, dll, version-control, directory

这是对该问题的跟进：

[解决方案中的文件夹是否应该与命名空间匹配？](https://stackoverflow.com/questions/4664/should-the-folders-in-a-solution-match-the-namespace#4672)

对这个问题的共识是一个合格的“是”：也就是说，文件夹 == 命名空间，一般来说，但不是盲目的（java 需要的方式）。

确实，这就是我设置项目的方式。

但是设置源代码控制让我对当前的文件夹结构犹豫不决。与 .NET Framework 一样，我的项目中的命名空间并不总是一对一地匹配部署的单元。说你有

```
库-> lib.dll
lib.data -> lib.dll
lib.ecom -> lib.ecom.dll
lib.ecom.paypal -> lib.ecom.paypal.dll

```

换句话说，子命名空间可能会或可能不会随父命名空间一起提供。

那么部署在一起的命名空间是否以任何方式分组？

顺便说一句，我不使用 VS 或 NAnt——只是使用老式的构建批次。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-11T08:59:10.453

我通常不会真正考虑这一点，只是做“感觉正确的事情”，但通常我最终会使用非常适合以下策略的名称。

我将使用树中最高的公共命名空间作为 .dll 名称，就像您正在做的那样；

使用 lib 和 lib.data，这是 lib，因此 dll 称为 lib。对于 lib.ecom 和 lib.ecom.paypal，这是 lib.ecom，因此 dll 称为 ecom。

在某些情况下，您需要多考虑一些事情，例如我们有以下命名空间（警告，简单示例即将出现），我们希望将它们分组到两个 dll 中

```
myapp.view
myapp.presentation

myapp.model
myapp.dataaccess 
```

我们不能使用 myapp，因为那样我们就会有两个 myapp 程序集。在这种情况下，我使用最合适的命名空间名称。如果这些命名空间是最重要的，第一个可能称为 myapp.presentation 和第二个 myapp.model。

# c# - 如何解析 XML 文件？

> ID：55828
> 
> 赞同：492
> 
> 时间：2008-09-11T05:04:56.303
> 
> 标签：c#, xml

有没有在 C# 中解析 XML 文件的简单方法？如果是这样，是什么？

* * *

## 回答 #1

> 赞同：325
> 
> 时间：2008-09-11T05:17:41.547

这很简单。我知道这些是标准方法，但您可以创建自己的库来更好地处理这些方法。

这里有些例子：

```
XmlDocument xmlDoc= new XmlDocument(); // Create an XML document object
xmlDoc.Load("yourXMLFile.xml"); // Load the XML document from the specified file

// Get elements
XmlNodeList girlAddress = xmlDoc.GetElementsByTagName("gAddress");
XmlNodeList girlAge = xmlDoc.GetElementsByTagName("gAge"); 
XmlNodeList girlCellPhoneNumber = xmlDoc.GetElementsByTagName("gPhone");

// Display the results
Console.WriteLine("Address: " + girlAddress[0].InnerText);
Console.WriteLine("Age: " + girlAge[0].InnerText);
Console.WriteLine("Phone Number: " + girlCellPhoneNumber[0].InnerText); 
```

此外，还有一些[其他方法](http://www.google.lt/search?hl=lt&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&hs=pLz&q=parse+XML+C%23&btnG=Paie%C5%A1ka&meta=)可以使用。例如，[这里](http://support.microsoft.com/kb/307548). 而且我认为没有一种最好的方法可以做到这一点。你总是需要自己选择，什么最适合你。

* * *

## 回答 #2

> 赞同：250
> 
> 时间：2008-09-11T05:05:59.423

如果您使用的是 .NET 3.5 或更高版本，我会使用[LINQ to XML 。](https://docs.microsoft.com/en-us/dotnet/csharp/programming-guide/concepts/linq/linq-to-xml)

* * *

## 回答 #3

> 赞同：49
> 
> 时间：2008-09-11T06:16:07.677

使用良好的[XSD 架构通过](http://en.wikipedia.org/wiki/XSD)[xsd.exe](http://msdn.microsoft.com/en-us/library/x6c1kb0s.aspx)创建一组类，并使用 an[`XmlSerializer`](http://msdn.microsoft.com/en-us/library/system.xml.serialization.xmlserializer.aspx)从 XML 中创建对象树，反之亦然。如果您对模型的限制很少，您甚至可以尝试使用 Xml*Attributes 在模型类和 XML 之间创建直接映射。

MSDN 上有[一篇关于 XML 序列化的介绍性文章。](http://msdn.microsoft.com/en-us/library/182eeyhh.aspx)

性能提示：构造一个`XmlSerializer`是昂贵的。`XmlSerializer`如果您打算解析/写入多个 XML 文件，请保留对您的实例的引用。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-09-11T07:48:03.073

如果您正在处理大量数据（数兆字节），那么您希望用于`XmlReader`流式解析 XML。

其他任何东西（`XPathNavigator`, `XElement`，`XmlDocument`即使`XmlSerializer`您保留完整生成的对象图）也会导致[高内存使用](https://stackoverflow.com/questions/1505075/deciding-on-when-to-use-xmldocument-vs-xmlreader)和非常缓慢的加载时间。

当然，如果您无论如何都需要内存中的所有数据，那么您可能没有太多选择。

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-09-11T05:12:40.733

使用[`XmlTextReader`](http://msdn.microsoft.com/en-us/library/system.xml.xmltextreader(VS.80).aspx)、[`XmlReader`](http://msdn.microsoft.com/en-us/library/system.xml.xmlreader(VS.80).aspx)和命名空间[`XmlNodeReader`](http://msdn.microsoft.com/en-us/library/system.xml.xmlnodereader(VS.80).aspx)。[`System.Xml.XPath`](http://msdn.microsoft.com/en-us/library/system.xml.xpath(VS.80).aspx)和 ( [`XPathNavigator`](http://msdn.microsoft.com/en-us/library/system.xml.xpath.xpathnavigator(VS.80).aspx), [`XPathDocument`](http://msdn.microsoft.com/en-us/library/system.xml.xpath.xpathdocument(VS.80).aspx), [`XPathExpression`](http://msdn.microsoft.com/en-us/library/system.xml.xpath.xpathexpression(VS.80).aspx), [`XPathnodeIterator`](http://msdn.microsoft.com/en-us/library/system.xml.xpath.xpathnodeiterator(VS.80).aspx))。

通常[`XPath`](http://www.codeproject.com/KB/cpp/myXPath.aspx)使阅读 XML 更容易，这正是您可能正在寻找的。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2018-02-23T15:38:01.763

我最近刚被要求处理一个涉及解析 XML 文档的应用程序，我同意 Jon Galloway 的观点，即在我看来，基于 LINQ to XML 的方法是最好的。但是，我确实需要挖掘一些才能找到可用的示例，所以事不宜迟，这里有一些！

欢迎任何评论，因为此代码有效，但可能并不完美，我想了解更多有关为该项目解析 XML 的信息！

```
public void ParseXML(string filePath)  
{  
    // create document instance using XML file path
    XDocument doc = XDocument.Load(filePath);

    // get the namespace to that within of the XML (xmlns="...")
    XElement root = doc.Root;
    XNamespace ns = root.GetDefaultNamespace();

    // obtain a list of elements with specific tag
    IEnumerable<XElement> elements = from c in doc.Descendants(ns + "exampleTagName") select c;

    // obtain a single element with specific tag (first instance), useful if only expecting one instance of the tag in the target doc
    XElement element = (from c in doc.Descendants(ns + "exampleTagName" select c).First();

    // obtain an element from within an element, same as from doc
    XElement embeddedElement = (from c in element.Descendants(ns + "exampleEmbeddedTagName" select c).First();

    // obtain an attribute from an element
    XAttribute attribute = element.Attribute("exampleAttributeName");
} 
```

使用这些函数，我能够解析 XML 文件中的任何元素和任何属性，这完全没有问题！

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2017-10-17T12:19:38.897

此外，您可以通过以下方式使用 XPath 选择器（选择特定节点的简单方法）：

```
XmlDocument doc = new XmlDocument();
doc.Load("test.xml");

var found = doc.DocumentElement.SelectNodes("//book[@title='Barry Poter']"); // select all Book elements in whole dom, with attribute title with value 'Barry Poter'

// Retrieve your data here or change XML here:
foreach (XmlNode book in nodeList)
{
  book.InnerText="The story began as it was...";
}

Console.WriteLine("Display XML:");
doc.Save(Console.Out); 
```

[文档](https://msdn.microsoft.com/en-us/library/hcebdtae(v=vs.110).aspx)

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2008-09-11T05:12:57.720

如果您使用的是 .NET 2.0，请尝试使用`XmlReader`它的子类`XmlTextReader`和`XmlValidatingReader`. 它们提供了一种快速、轻量级（内存使用等）、只进的方式来解析 XML 文件。

如果您需要[`XPath`](http://en.wikipedia.org/wiki/XPath)功能，请尝试`XPathNavigator`. 如果您需要内存中的整个文档，请尝试`XmlDocument`.

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2008-09-11T05:11:04.900

我不确定是否存在“解析 XML 的最佳实践”。有许多适用于不同情况的技术。使用哪种方式取决于具体场景。

您可以使用[LINQ to XML](http://en.wikipedia.org/wiki/Language_Integrated_Query#LINQ_to_XML_.28formerly_called_XLINQ.29)、[`XmlReader`](http://msdn.microsoft.com/en-us/library/system.xml.xmlreader.aspx)，[`XPathNavigator`](http://msdn.microsoft.com/en-us/library/system.xml.xpath.xpathnavigator.aspx)甚至是正则表达式。如果您详细说明您的需求，我可以尝试提供一些建议。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2017-07-18T20:41:09.147

您可以使用此库解析 XML `System.Xml.Linq`。下面是我用来解析 XML 文件的示例代码

```
public CatSubCatList GenerateCategoryListFromProductFeedXML()
{
    string path = System.Web.HttpContext.Current.Server.MapPath(_xmlFilePath);

    XDocument xDoc = XDocument.Load(path);

    XElement xElement = XElement.Parse(xDoc.ToString());

    List<Category> lstCategory = xElement.Elements("Product").Select(d => new Category
    {
        Code = Convert.ToString(d.Element("CategoryCode").Value),
        CategoryPath = d.Element("CategoryPath").Value,
        Name = GetCateOrSubCategory(d.Element("CategoryPath").Value, 0), // Category
        SubCategoryName = GetCateOrSubCategory(d.Element("CategoryPath").Value, 1) // Sub Category
    }).GroupBy(x => new { x.Code, x.SubCategoryName }).Select(x => x.First()).ToList();

    CatSubCatList catSubCatList = GetFinalCategoryListFromXML(lstCategory);

    return catSubCatList;
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2017-02-16T14:26:33.327

您可以使用[ExtendedXmlSerializer](https://github.com/wojtpl2/ExtendedXmlSerializer)进行序列化和反序列化。

**安装您可以从 nuget 安装 ExtendedXmlSerializer**或**[运行](https://www.nuget.org/packages/ExtendedXmlSerializer/)以下命令：**

 **```
Install-Package ExtendedXmlSerializer 
```

**序列化：**

```
ExtendedXmlSerializer serializer = new ExtendedXmlSerializer();
var obj = new Message();
var xml = serializer.Serialize(obj); 
```

**反序列化**

```
var obj2 = serializer.Deserialize<Message>(xml); 
```

**.NET 中的标准 XML 序列化器非常有限。**

*   不支持具有循环引用的类或具有接口属性的类的序列化，
*   不支持字典，
*   没有读取旧版XML的机制，
*   如果要创建自定义序列化程序，您的类必须继承自 IXmlSerializable。这意味着您的课程将不是 POCO 课程，
*   不支持 IoC。

**ExtendedXmlSerializer 可以做到这一点以及更多。**

ExtendedXmlSerializer 支持**.NET 4.5**或更高版本以及**.NET Core**。您可以将它与 WebApi 和 AspCore 集成。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2017-11-16T12:27:26.037

您可以使用 XmlDocument 并从可以 Linq 到 XML 类的属性中操作或检索数据。

# asp.net - 在匿名用户可以投票的网络竞赛中，是否有可靠的方法来防止作弊？

> ID：55835
> 
> 赞同：12
> 
> 时间：2008-09-11T05:12:42.230
> 
> 标签：asp.net, silverlight

我正在开展一个基于网络的竞赛，该竞赛应该允许匿名用户投票，但我们希望防止他们多次投票。基于 IP 的限制可以通过匿名代理绕过，用户可以清除 cookie 等。可以使用 Silverlight 应用程序，它可以访问隔离存储，但用户仍然可以清除它。

如果没有一些小丑用机器人或其他东西投票给自己，我认为不可能做到这一点。有想法吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-11T05:28:14.890

最简洁的答案是不。更长的答案是：但你可以让它变得任意困难。我会做什么：

*   投票需要解决验证码（尽可能避免自动投票）。为了更有效，我建议准备多种类型的简单验证码（如“选择与猫的照片”、“什么是 2+2”、“输入单词”等）并将它们旋转一天中的时间和 IP，这应该会使自动系统无效（即，如果有人使用 IP A 创建一个机器人来解决验证码，这将在第二天变得无用，或者如果她/他将其分发到其他计算机/使用代理）
*   在按 IP 过滤时，您应该小心考虑多个主机位于一个公共 IP 后面的情况（AFAIK AOL 通过几个 IP 代理所有客户 - 因此这样的限制将有效地禁止 AOL 用户）。此外，许多代理会发送指向原始 IP 的标头（例如 X-Forwarded-For），因此您也可以查看一下。
*   最后，使用诸如 FSO（Flash 共享对象 - “Flash cookie”）之类的东西对于 99.99% 的人来说已经够晦涩难懂了。Silverlight 更加晦涩难懂。更狡猾的是，您可以购买其他域并从该域设置 FSO（因此，如果用户正在寻找您的域设置的 FSO，他们将看不到任何内容）

这些方法都不是 100%，但希望它们结合起来可以为您提供所需的保证水平。如果您想更上一层楼，您需要添加某种用户注册（这可以简单到在投票发生时询问有效的电子邮件地址并将确认链接发送到给定地址而不计算没有点击链接的投票 - 所以它不需要是一个成熟的“使用用户名/密码/名字/姓氏/等创建一个帐户”）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T05:38:49.250

不，你不能，只需要一个人和一个愿意的论坛来[改变在线投票的结果](http://news.cnet.com/8301-13577_3-9914423-36.html)。

您必须意识到在线投票的固有缺陷，而不是试图绕过它们，而是尝试利用它们为您带来优势。

-亚当

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T05:18:22.823

不，这是用户的计算机，他们在控制之中。不幸的是，唯一的解决方案就是把它带回你的法庭，可以这么说并要求认证。

然而，验证码至少有助于限制对人类用户的投票。

当然，即使使用身份验证，您也无法强制执行单一投票，因为它们会教机器人注册......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-11T05:21:29.837

你当然可以让它变得困难。

使用诸如 IP 地址、浏览器用户代理、机器名称以及您可以获得的任何其他信息等内容构建用户配置文件怎么样？

存储每个用户的配置文件，然后如果您收到的配置文件与数据库中已有的配置文件足够相似（您必须对其进行调整），您可以放弃该投票。

我想您可能可以使用 silverlight 建立一个更好的配置文件，但我不确定哪些信息可以让您访问。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T05:23:28.287

由于您列出的原因，客户端解决方案已被淘汰——它们可以由用户操作。服务器端解决方案——正如你所说——可以被愚弄和绕过。

如果你愿意接受这样一个事实，即你不能 100% 确定每人只获得一票，那么你可以采取一些措施来减少噪音。

*   在您的投票提交表单中使用验证码，以使机器人和脚本更难投票。
*   将每个 IP 地址的投票数限制为一。
*   考虑要求注册才能投票。（我知道这破坏了您最初的问题的一部分，但它使您对投票有更大程度的控制。）

这是一个好的开始。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T05:23:48.520

我在比赛开发和监控方面的个人经验告诉我，不，如果你让匿名用户投票（或做任何让他们参与比赛的事情），没有可靠的方法来避免作弊。

你可以玩 IP，在一个动作和下一个动作之间引入延迟，但这真的很困难：最好的方法是引入验证码或类似的东西，如果适用于你的特定情况。

最重要的是，不要让匿名用户参与：让他们“玩”并访问模拟，但比赛需要登录。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-12-15T00:31:58.377

I have to agree that the short answer is no...though if you look at my recent answer here: [How to anonymously identify a user and store that information](https://stackoverflow.com/questions/4445404/how-to-anonymously-identify-a-user-on-a-web/4445584#4445584) you certainly can get it within a 6 percent margin of error.

# c# - 如何测试我的 Linq IQueryable 是否已执行

> ID：55843
> 
> 赞同：4
> 
> 时间：2008-09-11T05:18:43.167
> 
> 标签：c#, linq

我目前正在使用 Linq to NHibernate（尽管这不是关于这个问题的问题）来对我的数据库执行查询，并且我希望能够测试当前`IQueryable`结果实例是否已执行。

调试器知道 my`IQueryable`没有被*“调用”*，因为它告诉我扩展 Results 属性将*“枚举”*它。有没有办法让我也以编程方式识别它。

我希望这是有道理的 ：）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-17T17:41:36.000

如何编写这样的 IQueryable 包装器：

```
class QueryableWrapper<T> : IQueryable<T>
{
    private IQueryable<T> _InnerQueryable;
    private bool _HasExecuted;

    public QueryableWrapper(IQueryable<T> innerQueryable)
    {
        _InnerQueryable = innerQueryable;
    }

    public bool HasExecuted
    {
        get
        {
            return _HasExecuted;
        }
    }

    public IEnumerator<T> GetEnumerator()
    {
        _HasExecuted = true;

        return _InnerQueryable.GetEnumerator();
    }

    System.Collections.IEnumerator System.Collections.IEnumerable.GetEnumerator()
    {
        return GetEnumerator();
    }

    public Type ElementType
    {
        get { return _InnerQueryable.ElementType; }
    }

    public System.Linq.Expressions.Expression Expression
    {
        get { return _InnerQueryable.Expression; }
    }

    public IQueryProvider Provider
    {
        get { return _InnerQueryable.Provider; }
    }
} 
```

然后你可以像这样使用它：

```
var query = new QueryableWrapper<string>(
    from str in myDataSource
    select str);

Debug.WriteLine("HasExecuted: " + query.HasExecuted.ToString());

foreach (string str in query)
{
    Debug.WriteLine(str);
}

Debug.WriteLine("HasExecuted: " + query.HasExecuted.ToString()); 
```

输出是：

假
String0
String1
...
真

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T05:27:02.570

我相信您可以使用[DataContext.Log](https://docs.microsoft.com/en-us/dotnet/api/system.data.linq.datacontext.log)记录执行的所有内容。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-17T10:17:27.017

假设您使用的是 Visual Studio，您可以插入`DataContext.Log = Console.Out`到您的代码中。然后，您可以在输出窗口中观察 SQL 的执行情况。

我不确定是否可以以编程方式测试查询是否已执行。您可以强制它执行，例如通过调用`.ToList`查询。

# sql - 数据安全是否应该在数据库端进行？

> ID：55845
> 
> 赞同：6
> 
> 时间：2008-09-11T05:21:30.757
> 
> 标签：sql, security, stored-procedures

我们正在为我们的新内部应用程序建立一个新的框架和开展业务的方式。我们当前的设计要求所有安全逻辑都应该由我们的数据库处理，所有信息（我的意思是全部）都将通过存储过程进出数据库。

理论上，数据访问层从存储过程请求信息并将身份验证传递给数据库。数据库确定用户的角色/权限并决定是否执行任务（无论是检索数据还是进行更新）。

我想这意味着更少的数据库事务。一次调用数据库。如果安全性在我们的数据访问层，这将需要 1 次数据库调用来确定用户是否具有适当的权限，然后需要 1 次单独的数据库调用来执行操作。

一方面，我发现 SQL 管理工作室完全缺乏 IDE。我主要担心的是，我们最终将不得不在存储过程中维护一些令人讨厌的业务逻辑，以获得一些非常小的性能提升。

现在，我们将 LINQ 用于我们的 ORM。它看起来轻巧快速，但最重要的是，它真的很容易快速开发。

维护成本是否值得性能提升？我们是否自欺欺人地认为甚至会有明显的性能提升？还是我们只是在为自己做噩梦？

我们的环境：

*   内部的非关键业务应用程序
*   C#/ASP.NET 3.5
*   视窗 2003
*   微软 SQL 服务器 2005
*   35 个中型 Web 应用程序，大约 500 个用户

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-11T05:30:19.957

**不要那样做**。当“数据库大师”决定去另一家公司时，我们最近有一个**非常糟糕的经历。**程序中所有逻辑的维护简直太可怕了！！

是的，您将获得一些性能改进，但这不值得。事实上，在内部应用程序中，性能甚至不是一个大问题。在好的服务器上投入更多的钱。它会得到回报的。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T05:35:27.153

不幸的是，没有“一个真正的答案”。您必须做出的选择取决于多种因素，例如：

*   团队对给定解决方案的熟悉程度（即，如果他们中的大多数人擅长编写 SQL，则可以在数据库中，但是如果他们中的大多数人更喜欢 C#，则应该在代码中）
*   各党派的“政权”
*   ETC

在任何方向都没有决定性的优势（正如您所说的性能提升是最小的），要记住的一件事是 DRY（不要重复自己）原则：不要重新实现功能两次（在代码中和DB），因为让它们保持同步将是一场噩梦。选择一种解决方案并坚持下去。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T05:31:34.430

你可以做到，但开发和维护它是一个巨大的痛苦。从从事几乎所有业务逻辑都编码在存储过程中的项目的人那里得到它。

为了安全起见，ASP.NET 内置了用户和角色管理，因此您可能会节省访问数据库的次数，但那又如何呢？作为交换，处理和调试系统和验证错误变得更加烦人，因为它们必须从数据库中冒出来。

单元测试要困难得多，因为可用于单元测试 sprocs 的框架还不够发达。

正确的 oop 和域驱动设计几乎是不可能的。

如果有的话，性能提升将很小。[我们在这里](https://stackoverflow.com/questions/50346/why-is-parameterized-sql-generated-by-nhibernate-just-as-fast-as-a-stored-proce)谈到了这个。

我建议，如果您想保持作为开发人员的理智，那么您必须竭尽全力将数据库保留为持久层

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T19:25:34.503

恕我直言：

应用服务层 -> 应用逻辑和验证
应用数据层 -> 数据逻辑和安全
数据库 -> 数据一致性

你迟早会被 sproc 方法所困扰，我已经学会了这一点。
Procs 非常适合需要大量性能的一次性操作，但 CRUD 部分是数据层的工作

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-11T07:34:33.077

这完全取决于您的情况，最好不要走 SP 路线并以 DDD 方式做所有事情（在代码中创建域模型并使用它）。

但是，如果您的数据库不仅被您的应用程序使用，而且被许多人使用，那么您可能应该考虑使用 Web 服务。无论如何，数据库应该只能通过执行业务规则的一层来访问，否则您最终会得到“脏”数据，并且事后清理数据比事先编写一些业务规则要痛苦得多。一个好的数据库应该设置检查约束和索引，所以不管你喜欢与否，它都会有一些业务规则。

如果您必须处理数百万和数十亿条记录，您将很高兴有一个优秀的 DB-guy 为您解决问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-11T19:22:24.700

存储过程通常是安全的胜利。简化应用程序和数据库之间的关系可以减少可能出错的地方；将业务逻辑连接到数据库的代码中的错误往往是安全问题。因此，您的 DBA 将事情锁定到存储过程并没有错。

将应用程序锁定到存储过程的另一个好处是，应用程序堆栈的数据库连接可以将其权限锁定到特定的存储过程调用，仅此而已。

让 DBA 参与应用程序的安全逻辑的好处是，不同的应用程序功能和角色可以在数据库中划分为视图，因此即使需要动态 SQL 和通用选择语句，SQL 漏洞造成的损害可以约束。

当然，另一方面是失去了灵活性。与 DBA 就存储过程参数的不断协商相比，ORM 的开发显然要快得多。而且，随着这些存储过程的压力越来越大，这些过程本身越来越有可能求助于动态 SQL，这与应用程序组合的 SQL 一样容易受到攻击。

这里有一个快乐的中间地带，你应该尝试找到它。我最近从事的项目从非常可怕的 SQL 注入问题中解救出来，因为 DBA 已经为“最小权限”仔细配置了数据库、它的连接和它的存储过程，因此任何一个数据库用户都只能访问他们的内容需要知道。

显然，当您在应用程序逻辑中编写 SQL 代码时，请确保您始终使用参数化准备好的语句，您正在清理您的输入，您注意国际化输入（有很多很多方式可以说单一-quote over HTTP），并且当输入对于列宽而言太大时，您要注意数据库的行为。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-11T05:37:48.987

我的观点是应用程序本身应该处理身份验证和授权。在数据库方面，您应该只根据需要处理数据加密。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-11T05:55:52.937

我过去构建了基于存储过程的应用程序。在您的情况下，可能有一种方法可以在数据库层保持身份验证并将您的业务逻辑放在 C# 中。使用视图来限制数据（您只能看到您有权访问的行）。这些视图可以在 LINQ 中像表一样轻松使用。您将更新设置为使用存储过程进行。

这允许 linq、C# 中的业务逻辑以及数据库中控制对数据的访问的通用身份验证层。

# wpf - TextBox.TextChanged & ICommandSource

> ID：55855
> 
> 赞同：10
> 
> 时间：2008-09-11T05:36:17.557
> 
> 标签：wpf, mvvm, command, event-binding

我正在为我的 WPF UI 遵循[MV-VM](http://blogs.msdn.com/johngossman/archive/2005/10/08/478683.aspx)模式。我想将文本框的 TextChanged 事件的命令连接到我的 ViewModel 类中的命令。我能想到的完成此任务的唯一方法是从 TextBox 控件继承，并实现 ICommandSource。然后我可以指示从 TextChanged 事件中触发该命令。对于看起来如此简单的事情来说，这似乎是太多的工作。

有没有更简单的方法（比继承 TextBox 并实现 ICommandSource）将 TextChanged 事件连接到我的 ViewModel 类？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2008-09-11T09:51:56.537

首先，您肯定考虑过使用 PropertyChanged 的​​ UpdateSourceTrigger 将双向数据绑定到您的视图模型？这样每次更改文本时都会调用您绑定到的属性的属性设置器？

如果这还不够，那么我会使用附加行为来解决这个问题。在 Julian Dominguez 的博客上，您会找到[一篇](http://blogs.southworks.net/jdominguez/2008/08/icommand-for-silverlight-with-attached-behaviors/)关于如何在 Silverlight 中执行非常相似的操作的文章，该文章应该很容易适应 WPF。

基本上，在一个静态类（称为 TextBoxBehaviours）中，您定义了一个名为（可能）ICommand 类型的 TextChangedCommand 的附加属性。为该属性连接一个 OnPropertyChanged 处理程序，并在处理程序中检查该属性是否设置在 TextBox 上；如果是，则向文本框上的 TextChanged 事件添加一个处理程序，该处理程序将调用属性中指定的命令。

然后，假设您的视图模型已分配给视图的 DataContext，您可以像这样使用它：

```
<TextBox
  x:Name="MyTextBox"
  TextBoxBehaviours.TextChangedCommand="{Binding ViewModelTextChangedCommand}" /> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-11T10:07:31.570

使用事件绑定和命令方法可能不是正确的使用方法。这个命令到底会做什么？

您可能需要考虑对 VM 中的字符串字段使用数据绑定。这样，您就可以从那里调用命令或函数，而不是让 UI 关心。

```
<TextBox Text="{Binding WorldName}"/>
....
public string WorldName
{
    get
    {
        return WorldData.Name;
    }
    set
    {
        WorldData.Name = value;
        OnPropertyChanged("WorldName");
        // CallYourCustomFunctionHere();
    }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T08:58:41.140

您不能只处理 TextChanged 事件并从那里执行命令吗？

```
private void _textBox_TextChanged(object sender, EventArgs e)
{
    MyCommand.Execute(null);
} 
```

正如您所说，另一种方法是创建一个`TextBox`充当命令源的工具，但这似乎有点矫枉过正，除非您计划在许多地方共享和利用它。

# c++ - 如何在一个 catch 块中捕获所有类型的异常？

> ID：55859
> 
> 赞同：12
> 
> 时间：2008-09-11T05:41:15.640
> 
> 标签：c++, exception-handling, try-catch

在 C++ 中，我试图在一次捕获中捕获所有类型的异常（就像`catch(Exception)`在 C# 中一样）。它是如何完成的？更重要的是，如何捕获被零除的异常？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-11T05:43:38.647

```
catch (...)
{
   // Handle exceptions not covered.
} 
```

重要注意事项：

*   更好的方法是捕获您实际上可以从中恢复的特定类型的异常，而不是所有可能的异常。
*   catch(...) 还将捕获某些严重的系统级异常（取决于编译器），您将无法可靠地从中恢复。以这种方式捕捉它们然后吞下它们并继续可能会在您的程序中导致更严重的问题。
*   根据您的上下文，可以接受使用 catch(...)，前提是重新抛出异常。在这种情况下，您记录所有有用的本地状态信息，然后重新抛出异常以允许它向上传播。但是，如果您选择这条路线，您应该阅读[RAII 模式。](http://en.wikipedia.org/wiki/Resource_acquisition_is_initialization)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-11T06:47:15.420

您**不想**使用 catch (...) （即带有省略号的 catch），除非您确实、绝对、最可证明的需要它。

这样做的原因是一些编译器（最常见的是 Visual C++ 6）也会将诸如分段错误和其他非常糟糕的情况之类的错误转换为您可以使用 catch (...) 轻松处理的异常。这非常糟糕，因为您再也看不到崩溃了。

从技术上讲，是的，您也可以将除以零（为此您必须使用“StackOverflow”），但是您确实应该首先避免进行此类除法。

相反，请执行以下操作：

*   如果您确实知道会发生什么样的异常，请仅捕获这些类型，并且
*   如果您需要自己抛出异常，并且需要捕获您将抛出的所有异常，请使这些异常派生自 std::exception （如 Adam Pierce 建议的那样）并捕获它。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-11T16:57:11.427

如果您在 Windows 上并且需要处理除以零和访问冲突等错误，您可以使用结构化异常转换器。然后在你的翻译器中你可以抛出一个 c++ 异常：

```
void myTranslator(unsigned code, EXCEPTION_POINTERS*)
{
    throw std::exception(<appropriate string here>);
}

_set_se_translator(myTranslator); 
```

请注意，代码会告诉您错误是什么。您还需要使用 /EHa 选项进行编译（C/C++ -> Code Generatrion -> Enable C/C++ Exceptions = Yes with SEH Exceptions）。

如果这没有意义，请查看 [_set_se_translator] 的文档（[http://msdn.microsoft.com/en-us/library/5z4bw5h5(VS.80).aspx）](http://msdn.microsoft.com/en-us/library/5z4bw5h5(VS.80).aspx))

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-11T07:15:08.177

如果捕获所有异常（包括操作系统异常）确实是您所需要的，那么您需要查看您的编译器和操作系统。例如，在 Windows 上，您可能有“__try”关键字或编译器开关以使“try/catch”捕获 SEH 异常，或两者兼而有之。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-11T05:44:55.693

让你所有的自定义异常类都继承自 std::exception，然后你就可以简单地捕获 std::exception。这是一些示例代码：

```
class WidgetError
    : public std::exception
{
public:
    WidgetError()
    { }

    virtual ~WidgetError() throw()
    { }

    virtual const char *what() const throw()
    {
        return "You got you a widget error!";
    }
}; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-11T05:47:04.317

在 C++ 中，标准没有定义被零除异常，并且实现往往不会抛出它们。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-11T11:11:06.517

当然，您可以使用`catch (...) { /* code here */ }`，但它确实取决于您想要做什么。在 C++ 中，你有确定性的析构函数（没有那些终结的垃圾），所以如果你想清理，正确的做法是使用 RAII。

例如。代替：

```
void myfunc()
{
    void* h = get_handle_that_must_be_released();
    try { random_func(h); }
    catch (...) { release_object(h); throw; }
    release_object(h);

} 
```

执行以下操作：

```
#include<boost/shared_ptr.hpp>

void my_func()
{
    boost::shared_ptr<void> h(get_handle_that_must_be_released(), release_object);
    random_func(h.get());
} 
```

如果您不使用 boost，请使用析构函数创建您自己的类。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-10-03T16:41:51.567

你可以用它`catch(...)`来捕捉一切，但是**你没有得到一个对象**来检查、重新抛出、记录或做任何事情。所以......你可以“加倍” try 块并重新抛出一个处理单一类型的外部捕获。如果您为自定义异常类型定义构造函数，该类型可以从您想要组合在一起的所有类型构建自身，则此方法非常有效。然后，您可以从 中抛出一个默认构造的`catch(...)`，其中可能包含一条消息或代码，例如“未知”，或者您想要跟踪此类事情。

例子：

```
try
{ 
    try
    {       
        // do something that can produce various exception types
    }
    catch( const CustomExceptionA &e ){ throw e; } \
    catch( const CustomExceptionB &e ){ throw CustomExceptionA( e ); } \
    catch( const std::exception &e )  { throw CustomExceptionA( e ); } \
    catch( ... )                      { throw CustomExceptionA(); } \
} 
catch( const CustomExceptionA &e ) 
{
    // Handle any exception as CustomExceptionA
} 
```

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2008-09-11T05:45:07.643

如果我没记错的话（自从我看过 C++ 以来已经有一段时间了），我认为以下应该可以解决问题

```
try
{
 // some code
}
catch(...)
{
 // catch anything
} 
```

和一个快速的谷歌（[http://www.oreillynet.com/pub/a/network/2003/05/05/cpluspocketref.html](http://www.oreillynet.com/pub/a/network/2003/05/05/cpluspocketref.html)）似乎证明我是正确的。

# c# - 为什么我不能删除这个 cookie？

> ID：55860
> 
> 赞同：8
> 
> 时间：2008-09-11T05:42:44.153
> 
> 标签：c#, asp.net, javascript, ajax, cookies

好的，这是 411 - 我的 Global.asax.cs 文件中有以下事件处理程序：

```
private void Global_PostRequestHandlerExecute(object sender, EventArgs e)
{
   if (/* logic that determines that this is an ajax call */)
   {
      // we want to set a cookie
      Response.Cookies.Add(new HttpCookie("MyCookie", "true"));
   }
} 
```

该处理程序将在 Ajax 请求期间运行（由于我正在使用的 Ajax 框架），以及在其他时间 - if 语句的条件过滤掉非 Ajax 事件，并且工作正常（它不相关在这里，所以为了简洁起见，我没有包括它）。

我们可以说这很好 - cookie 已设置，我可以在客户端上读取它，并且一切都很好。

现在是让我发疯的部分。

这是我用来删除 cookie 的 JavaScript 函数：

```
function deleteCookie(name) {
   var cookieDate = new Date();
   cookieDate.setTime(cookieDate.getTime() - 1);
   document.cookie = (name + "=; expires=" + cookieDate.toGMTString());
} 
```

所以，当然，在设置 cookie 之后的某个时间点，我会像这样删除它：

```
deleteCookie("MyCookie"); 
```

只是，这不起作用；cookie 仍然存在。那么，有人知道为什么吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-10-02T16:25:06.207

you have to delete your cookie at the same path where you created it. so create your cookie with path=/ and delte it with path=/ as well..

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T16:05:22.973

*   您是否检查了客户端和服务器端的 cookie 域和路径以确保它们相同？
*   一个cookie安全而另一个不安全吗？
*   除此之外，正如 Erlend 建议的那样，我怀疑服务器/客户端时钟同步问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T10:55:36.803

你试过用`;expires=Thu, 01-Jan-1970 00:00:01 GMT`吗？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T11:21:42.407

奇怪..您粘贴的代码几乎是逐字记录的：[http](http://www.quirksmode.org/js/cookies.html) ://www.quirksmode.org/js/cookies.html工作正常..

我知道您正在使用 Ajax，但是您是否尝试过**将其快速敲入服务器端代码以查看是否有效**？这可能有助于确定是 JS 问题还是其他问题（例如 cookie 上的神秘文件锁定）？

### 更新

刚用了谷歌，看起来浏览器设置也可能有问题。我不认为你的问题是这里的代码，它更有可能是别的东西。我建议尝试将上述作为 PoC，我们可以从那里开始。:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-11T14:46:01.103

[大约一周前，我在我的博客](http://rickyrosario.com/blog/javascript-cookie-utility)上发布了一个 js cookie 实用程序。这在所有“A 级”浏览器上都对我有用。

```
var CookieUtil = {
  createCookie:function(name,value,days) {
    if (days) {
        var date = new Date();
        date.setTime(date.getTime()+(days*24*60*60*1000));
        var expires = "; expires="+date.toGMTString();
    }
    else var expires = "";
    document.cookie = name+"="+value+expires+"; path=/";
  },
  readCookie:function(name) {
    var nameEQ = name + "=";
    var ca = document.cookie.split(';');
    for(var i=0;i < ca.length;i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1,c.length);
        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
    }
    return null;
  },
  eraseCookie:function(name) {
    createCookie(name,"",-1);
  }
}; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-09-15T01:26:13.310

此外，如果在创建过程中指定了 cookie 域，我发现您在尝试删除（过期）时还必须指定 cookie 域。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-13T07:22:15.990

我们确定没有将 Cookie 设置为 HttpOnly 的代码（我们没有遗漏上面的任何内容）吗？HttpOnly 属性将阻止（现代）浏览器修改 cookie。我很想看看你是否可以像 Rob 建议的那样在服务器端杀死它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-02T16:15:00.197

我假设你在浏览器端调用这个 javascript。您使用的是哪个浏览器，您如何查看 cookie 以确认它仍然存在？

# encryption - 如何对单个文件实施密码保护？

> ID：55862
> 
> 赞同：21
> 
> 时间：2008-09-11T05:43:24.683
> 
> 标签：encryption, cryptography, passwords

我正在编写一个小桌面应用程序，它应该能够加密数据文件并用密码保护它（即必须输入正确的密码才能解密）。我希望加密的数据文件是独立且可移植的，因此必须将身份验证嵌入文件中（或者我假设）。

根据我所知道的，我有一个看起来可行且合乎逻辑的策略（这可能足以造成危险），但我不知道它是否真的是一个好的设计。所以告诉我：这疯了吗？有没有更好/最好的方法来做到这一点？

*   第一步：用户输入明文密码，例如“MyDifficultPassword”
*   第 2 步：应用程序对用户密码进行哈希处理，并使用该值作为对称密钥来加密/解密数据文件。例如“MyDifficultPassword”-->“HashedUserPwdAndKey”。
*   第 3 步：应用程序对第​​ 2 步中的哈希值进行哈希处理，并将新值保存在数据文件头（即数据文件的未加密部分）中，并使用该值来验证用户的密码。例如 "HashedUserPwdAndKey" --> "HashedValueForAuthentication"

基本上，我是从实现网站密码的常用方法（即当您不使用 OpenID 时）推断出来的，即将用户密码的（加盐）哈希存储在您的数据库中，并且从不保存实际密码. 但是由于我使用散列用户密码作为对称加密密钥，所以我不能使用相同的值进行身份验证。所以我再次对其进行哈希处理，基本上将其视为另一个密码，并将双重哈希值保存在数据文件中。这样，我可以将文件带到另一台 PC 上，只需输入我的密码即可对其进行解密。

那么这种设计是相当安全的，还是天真无望的，还是介于两者之间？谢谢！

编辑：澄清和后续问题：盐。
我认为盐必须保密才能有用，但您的答案和链接暗示情况并非如此。例如，由埃里克森（下）链接的[这个规范说：](ftp://ftp.rsasecurity.com/pub/pkcs/pkcs-5v2/pkcs5v2-0.pdf)

> 因此，此处定义的基于密码的密钥派生是密码、盐和迭代计数的函数，其中后两个量不需要保密。

这是否意味着我可以将盐值存储在与散列密钥相同的位置/文件中，并且仍然比在散列时完全不使用盐更安全？这是如何运作的？

更多上下文：加密文件不打算与其他人共享或解密，它实际上是单用户数据。但是我想将它部署在我无法完全控制的计算机上的共享环境中（例如在工作中），并且能够通过简单地复制文件来迁移/移动数据（这样我就可以在家中使用不同的工作站等）。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-11T06:37:40.467

### 密钥生成

我建议使用公认的算法，例如在[PKCS #5 2.0 版](ftp://ftp.rsasecurity.com/pub/pkcs/pkcs-5v2/pkcs5v2-0.pdf)中定义的 PBKDF2从您的密码生成密钥。它类似于您概述的算法，但能够生成更长的对称密钥以用于 AES。您应该能够找到为不同算法实现 PBE 密钥生成器的开源库。

### 文件格式

您还可以考虑使用[加密消息语法](http://www.ietf.org/rfc/rfc3852.txt)作为文件格式。这需要您进行一些研究，但同样有现有的库可供使用，并且它开辟了与其他软件更顺畅地互操作的可能性，例如启用 S/MIME 的邮件客户端。

### 密码验证

关于您存储密码哈希的愿望，如果您使用 PBKDF2 生成密钥，您可以为此使用标准密码哈希算法（大盐，一千轮哈希），并获得不同的值。

或者，您可以计算内容的 MAC。密码上的哈希冲突更有可能对攻击者有用；内容上的哈希冲突可能毫无价值。但它可以让合法的接收者知道错误的密码被用于解密。

### 密码盐

[Salt](http://en.wikipedia.org/wiki/Cryptographic_salt)有助于阻止预先计算的字典攻击。

假设攻击者有一个可能的密码列表。他可以对每个哈希值进行哈希处理，并将其与受害者密码的哈希值进行比较，看看是否匹配。如果列表很大，这可能需要很长时间。他不想在下一个目标上花费太多时间，所以他将结果记录在一个“字典”中，其中哈希指向其相应的输入。如果密码列表非常非常长，他可以使用[彩虹表之](http://lasecwww.epfl.ch/~oechslin/projects/ophcrack/)类的技术来节省一些空间。

但是，假设他的下一个目标将他们的密码加盐。*即使攻击者知道盐是什么，他的预计算表也毫无价值*——盐会改变每个密码产生的哈希值。他必须重新散列他列表中的所有密码，将目标的盐添加到输入中。每种不同的盐都需要不同的字典，如果使用了足够多的盐，攻击者将没有空间为所有盐存储字典。交易空间以节省时间不再是一种选择；攻击者必须回退到对他想要攻击的每个目标的列表中的每个密码进行哈希处理。

所以，没有必要对盐保密。确保攻击者没有与该特定盐对应的预先计算的字典就足够了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-11T06:03:17.990

正如 Niyaz 所说，如果您使用强算法的高质量实现，例如[SHA-265](http://en.wikipedia.org/wiki/SHA)和[AES](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard)进行散列和加密，这种方法听起来很合理。此外，我建议使用[Salt](http://en.wikipedia.org/wiki/Salt_(cryptography))来减少创建所有密码哈希字典的可能性。

当然，阅读[Bruce Schneier](http://www.schneier.com/)的[Applied Cryptography](http://www.schneier.com/book-applied.html)也永远不会出错。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T05:56:00.037

如果您使用的是强哈希算法 (SHA-2) 和强加密算法 (AES)，则可以使用这种方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T06:01:43.640

为什么不使用支持密码保护文件的压缩库？我过去使用过包含 XML 内容的受密码保护的 zip 文件：}

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-11T07:08:06.337

是否真的需要将散列密码保存到文件中。您不能只使用带有一些盐的密码（或散列密码），然后用它加密文件。解密时只需尝试使用密码+盐解密文件。如果用户提供了错误的密码，则解密的文件不正确。

我能想到的唯一缺点是如果用户不小心输入了错误的密码并且解密速度很慢，他必须等待重试。当然，如果忘记密码，则无法解密文件。

# .net - 确定图像的文件类型

> ID：55869
> 
> 赞同：50
> 
> 时间：2008-09-11T05:50:52.700
> 
> 标签：.net, image, content-type, mime-types

我正在从一项服务下载一些图像，该服务并不总是包含内容类型并且不为我正在下载的文件提供扩展名（呃，不要问）。

在 .NET 中确定图像格式的最佳方法是什么？

正在读取这些下载图像的应用程序需要具有适当的文件扩展名，否则将彻底崩溃。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-09-11T06:11:18.593

一种可能更简单的方法是使用 Image.FromFile() 然后使用 RawFormat 属性，因为它已经知道最常见格式的标头中的魔术位，如下所示：

```
Image i = Image.FromFile("c:\\foo");
if (System.Drawing.Imaging.ImageFormat.Jpeg.Equals(i.RawFormat)) 
    MessageBox.Show("JPEG");
else if (System.Drawing.Imaging.ImageFormat.Gif.Equals(i.RawFormat))
    MessageBox.Show("GIF");
//Same for the rest of the formats 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2012-09-16T22:01:44.430

您可以在不引用 System.Drawing 和不必要的对象图像创建的情况下使用下面的代码。即使没有 System.IO 的流和引用，您也可以使用[Alex解决方案。](https://stackoverflow.com/a/9446083/1046374)

```
public enum ImageFormat
{
    bmp,
    jpeg,
    gif,
    tiff,
    png,
    unknown
}

public static ImageFormat GetImageFormat(Stream stream)
{
    // see http://www.mikekunz.com/image_file_header.html
    var bmp = Encoding.ASCII.GetBytes("BM");     // BMP
    var gif = Encoding.ASCII.GetBytes("GIF");    // GIF
    var png = new byte[] { 137, 80, 78, 71 };    // PNG
    var tiff = new byte[] { 73, 73, 42 };         // TIFF
    var tiff2 = new byte[] { 77, 77, 42 };         // TIFF
    var jpeg = new byte[] { 255, 216, 255, 224 }; // jpeg
    var jpeg2 = new byte[] { 255, 216, 255, 225 }; // jpeg canon

    var buffer = new byte[4];
    stream.Read(buffer, 0, buffer.Length);

    if (bmp.SequenceEqual(buffer.Take(bmp.Length)))
        return ImageFormat.bmp;

    if (gif.SequenceEqual(buffer.Take(gif.Length)))
        return ImageFormat.gif;

    if (png.SequenceEqual(buffer.Take(png.Length)))
        return ImageFormat.png;

    if (tiff.SequenceEqual(buffer.Take(tiff.Length)))
        return ImageFormat.tiff;

    if (tiff2.SequenceEqual(buffer.Take(tiff2.Length)))
        return ImageFormat.tiff;

    if (jpeg.SequenceEqual(buffer.Take(jpeg.Length)))
        return ImageFormat.jpeg;

    if (jpeg2.SequenceEqual(buffer.Take(jpeg2.Length)))
        return ImageFormat.jpeg;

    return ImageFormat.unknown;
} 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2008-09-11T05:57:01.657

所有图像格式都将它们的初始字节设置为特定值：

*   JPG: [0xFF 0xD8](http://en.wikipedia.org/wiki/JPEG#Syntax_and_structure)
*   PNG：[0x89 0x50 0x4E 0x47 0x0D 0x0A 0x1A 0x0A](http://en.wikipedia.org/wiki/Portable_Network_Graphics#File_header)
*   GIF：['G''我''F'](http://www.w3.org/Graphics/GIF/spec-gif89a.txt)

搜索“jpg 文件格式”，将 jpg 替换为您需要识别的其他文件格式。

正如 Garth 建议的那样，有一个[包含此类“神奇数字”的数据库，可以](http://pwet.fr/man/linux/formats/magic)显示许多文件的文件类型。如果您必须检测许多不同的文件类型，则值得通过它来查找所需的信息。如果您确实需要扩展它以涵盖许多文件类型，请查看实现引擎以正确使用数据库的关联[文件命令](http://pwet.fr/man/linux/commandes/posix/file)（对于许多文件格式而言，这不是微不足道的，并且几乎是一个统计过程）

-亚当

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-11T06:01:23.487

亚当指出了完全正确的方向。

如果您想了解如何**感知几乎所有文件**`file`，请查看UNIX、Linux 或 Mac OS X 机器上命令背后的数据库。

`file`使用“幻数”数据库——亚当列出的那些初始字节——来感知文件的类型。`man file`会告诉你在你的机器上哪里可以找到数据库，例如`/usr/share/file/magic`. `man magic`会告诉你它的[格式](http://linux.die.net/man/5/magic)。

您可以根据在数据库中看到的内容编写自己的检测代码，使用预打包的库（例如[python-magic](http://hupp.org/adam/hg/python-magic)），或者——如果你*真的很*冒险——实现 .NET 版本的`libmagic`. 没找到，希望有大佬指点一下。

如果您手边没有 UNIX 机器，数据库将如下所示：

```
# PNG [便携式网络图形，或“PNG 不是 GIF”] 图像
# (Greg Roelofs, newt@uchicago.edu)
#（阿尔伯特·卡哈兰，acahalan@cs.uml.edu）
#
# 137 PNG \r \n ^Z \n [4字节长度] HEAD [HEAD数据] [HEAD crc] ...
#
0 字符串 \x89PNG PNG 图像数据，
>4 属于 !0x0d0a1a0a 损坏，
>4 属于 0x0d0a1a0a
>>16 属于 x %ld x
>>20 属于 x %ld,
>>24 字节 x %d 位
>>25 字节 0 灰度，
>>25 字节 2 \b/颜色 RGB，
>>25 字节 3 颜色图，
>>25 字节 4 灰度+alpha，
>>25 字节 6 \b/颜色 RGBA，
#>>26 字节 0 放气/32K,
>>28 字节 0 非隔行扫描
>>28 字节 1 隔行扫描
1 字符串 PNG PNG 图像数据，已损坏

# 动图
0 字符串 GIF8 GIF 图像数据
>4 字符串 7a \b，版本 8%s，
>4 字符串 9a \b，版本 8%s，
>6 leshort >0 %hd x
>8 leshort >0 %hd
#>10 字节 &0x80 颜色映射，
#>10 字节&0x07 =0x00 2 种颜色
#>10 字节&0x07 =0x01 4 色
#>10 字节&0x07 =0x02 8 色
#>10 字节&0x07 =0x03 16 色
#>10字节&0x07 =0x04 32色
#>10 字节&0x07 =0x05 64 色
#>10 字节&0x07 =0x06 128 色
#>10 字节&0x07 =0x07 256 色

```

祝你好运！

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-08-21T09:18:22.977

有确定图像 MIMETYPE 的编程方式。

有类**System.Drawing.Imaging.ImageCodecInfo**。

此类具有属性**MimeType**和**FormatID**。它还有一个**GetImageEncoders**方法，它返回所有图像编码器的集合。创建由格式 id 索引的 mime 类型的字典很容易。

**System.Drawing.Image**类具有**System.Drawing.Imaging.ImageFormat**类型的属性**RawFormat** ，其属性**Guid**等效于**System.Drawing.Imaging.ImageCodecInfo**类的属性**FormatID**，这是从字典中获取 MIMETYPE 的关键。

 ******例子：

创建 mime 类型字典的静态方法

```
static Dictionary<Guid, string> GetImageFormatMimeTypeIndex()
{
  Dictionary<Guid, string> ret = new Dictionary<Guid, string>();

  var encoders = System.Drawing.Imaging.ImageCodecInfo.GetImageEncoders();

  foreach(var e in encoders)
  {
    ret.Add(e.FormatID, e.MimeType);
  }

  return ret;
} 
```

采用：

```
Dictionary<Guid, string> mimeTypeIndex = GetImageFormatMimeTypeIndex();

FileStream imgStream = File.OpenRead(path);
var image = System.Drawing.Image.FromStream(imgStream);
string mimeType = mimeTypeIndex[image.RawFormat.Guid]; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T05:54:37.573

尝试将流加载到 System.IO.BinaryReader。

然后，您需要参考您需要的每种图像格式的规范，并逐字节加载标题以与规范进行比较。例如这里是[PNG规范](http://www.libpng.org/pub/png/pngdocs.html)

补充：PNG的实际[文件结构](http://www.libpng.org/pub/png/spec/1.2/PNG-Structure.html)。

# php - 跟踪用户点击浏览器上的后退按钮的时间

> ID：55871
> 
> 赞同：24
> 
> 时间：2008-09-11T05:52:56.610
> 
> 标签：php, javascript, browser

是否可以检测用户何时单击浏览器的后退按钮？

我有一个 Ajax 应用程序，如果我可以检测到用户何时单击后退按钮，我可以显示相应的数据

任何使用 PHP、JavaScript 的解决方案都是可取的。地狱，任何语言的解决方案都很好，只需要我可以翻译成 PHP/JavaScript 的东西

### 编辑：从下面剪切和粘贴：

哇，所有优秀的答案。我想使用 Yahoo，但我已经使用 Prototype 和 Scriptaculous 库，不想添加更多 ajax 库。但它使用*iFrames*，它为我编写自己的代码提供了一个很好的指针。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2008-09-11T06:10:16.100

我最喜欢的框架之一是[Yahoo! 的 Browser History Manager](http://developer.yahoo.com/yui/history/)。您注册事件并在用户返回到该状态时回调您。如果你想了解它是如何工作的，[这里有一篇关于雅虎决策的有趣博客文章！设计时做](http://yuiblog.com/blog/2007/02/21/browser-history-manager/)出来的。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-11T06:01:42.720

有多种方法可以做到这一点，尽管有些方法只适用于某些浏览器。我知道的一个想法是在页面上嵌入一个几乎不可见的微小 iframe。当用户点击后退按钮时，iframe 被导航回来，您可以检测到然后更新您的页面。 [这](http://www.ajaxonomy.com/2007/web-design/a-better-ajax-back-button-solution)是另一个解决方案。

您可能还想查看 gmail 之类的源代码，看看他们是如何做到的。

[顺便说一下，这里](http://www.codeproject.com/KB/ajax/Salajax.aspx)有一个图书馆，里面有你要找的东西

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-11T06:04:34.070

无法判断用户何时单击后退按钮或按退格键返回浏览器，但是可以检测到以特定顺序发生的其他事件。这个[示例 javascript](https://web.archive.org/web/20080214125014/http://www.willmaster.com/library/javascript/detecting_a_back_button_click.php)有一个相当好的方法来检测返回命令：

然而，传统的方法是使用 cookie 或引用页面跟踪用户在您的站点中的移动。当用户转到页面 A，然后是页面 B，然后再次出现在页面 A 上（特别是当 B 上没有指向 A 的链接时），那么您知道他们返回了 - A 可以检测到这一点并重定向它们或以其他方式。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-11T06:14:00.053

雅虎用户界面库是我个人最喜欢的客户端 JS 库，它有一个出色的[浏览器历史管理器](http://developer.yahoo.com/yui/history/)，可以完全满足您的要求。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-10-30T15:28:46.817

检查您是否返回到需要刷新的页面缓存版本的最简单方法是添加将被缓存的隐藏输入元素，您可以检查它是否仍然具有其默认值。

只需将以下内容放在您的身体标签内。我把我的放在结束标签之前。

```
<input type="hidden" id="needs-refresh" value="no">
<script>
    onload=function(){
        var e = document.getElementById("needs-refresh");
        if (e.value === "yes")
            location.reload();
        e.value = "yes";
    }
</script> 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2015-12-16T10:09:57.380

我用 value 设置了`$wasPosted`一个`$_SESSION`变量`false`。

我所有的帖子都通过同一个 php 文件，并设置`$wasPosted`为`true`.

所有`header(location:)`请求之前都设置`$wasPosted`为`true`。

如果`$wasPosted`是`false`，则在使用后退或前进按钮后加载页面。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-15T20:16:33.443

dojo 工具包具有在 javascript 中处理此问题的功能。我认为在纯 PHP 中没有任何好的方法来处理它。

这是他们拥有的文档页面：http: [//dojotoolkit.org/book/dojo-book-0-9/part-3-programmatic-dijit-and-dojo/back-button-undo](http://dojotoolkit.org/book/dojo-book-0-9/part-3-programmatic-dijit-and-dojo/back-button-undo)

# transactions - 分布式事务如何工作（例如 MSDTC）？

> ID：55878
> 
> 赞同：14
> 
> 时间：2008-09-11T06:01:04.453
> 
> 标签：transactions, acid, mstdc

我以一种模糊的方式了解常规 ACID 事务是如何工作的。您在数据库上执行一些工作，直到设置了某种提交标志才确认工作。提交部分基于一些基本假设（例如单个磁盘块写入是原子的）。如果发生灾难性错误，您可以在恢复阶段清除未提交的数据。

分布式事务如何工作？在我读过的一些 MS 文档中，您可以以某种方式跨数据库和文件系统（除其他外）执行事务。

这项技术可以（并且可能）用于安装程序，您希望程序完全安装或完全不存在。您只需在安装程序启动时开始事务。接下来，您可以连接到注册表和文件系统，进行定义安装的更改。工作完成后，只需提交，如果由于某种原因安装失败，则回滚。这个神奇的分布式事务协调器会自动为您清理注册表和文件系统。

两个不同的系统怎么可能以这种方式进行交易？在我看来，总是有可能使系统处于不一致的状态，即文件系统已提交其更改而注册表没有。我认为在 MSDTC 中甚至可以通过网络执行事务。

我已经阅读了[http://blogs.msdn.com/florinlazar/archive/2004/03/04/84199.aspx](http://blogs.msdn.com/florinlazar/archive/2004/03/04/84199.aspx)，但感觉这只是解释的开始，应该大大扩展第 4 步。

**编辑：**根据我在[http://en.wikipedia.org/wiki/Distributed_transaction](http://en.wikipedia.org/wiki/Distributed_transaction)上收集的信息，可以通过两阶段提交（[http://en.wikipedia.org/wiki/Two-phase_commit](http://en.wikipedia.org/wiki/Two-phase_commit)）来完成。读完后，我仍然没有 100% 理解方法，步骤之间似乎有很大的错误空间。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T06:31:04.537

关于“第4步”：

> 事务管理器与资源管理器协调以确保所有成功完成请求的工作或如果完成则没有任何工作，从而维护 ACID 属性。

这当然需要所有参与者提供正确的接口和（无错误的）实现。界面看起来像这样：

```
public interface ITransactionParticipant {
    bool WouldCommitWork();
    void Commit();
    void Rollback();
} 
```

事务管理器在提交时询问所有参与者是否愿意提交事务。只有当参与者能够在所有允许的错误条件（验证、系统错误等）下提交此事务时，参与者才能断言这一点。在所有参与者都断言了提交事务的能力之后，管理器将`Commit()`消息发送给所有参与者。如果任何参与者引发错误或超时，则整个事务将中止，并且个别成员将回滚。

该协议要求参与者在断言他们的提交能力之前已经记录了他们的整个交易内容。当然，这必须在特殊的本地事务日志结构中才能从各种故障中恢复。

# sql - 如何查看正在执行的实际 Oracle SQL 语句

> ID：55899
> 
> 赞同：28
> 
> 时间：2008-09-11T06:26:01.040
> 
> 标签：sql, oracle

我正在使用一个定制的内部应用程序，它每周生成一组标准报告。我无法访问应用程序的源代码，每个人都告诉我没有可用于 Oracle 数据库模式的文档。（啊！）

我被要求为现有报告的变体定义规范（例如，应用额外的过滤器来约束数据集，并稍微修改布局）。这在原则上听起来很简单，但是如果没有任何现有的文档就很难。

我的理解是日志不能帮助我，因为报告只查询数据库；它实际上并没有插入、删除或更新数据库值，所以没有什么要记录的（这是正确的吗？）。

所以我的问题是：是否有工具或实用程序（Oracle 或其他）可以用来查看在报告生成作业仍在运行时正在执行的实际 SQL 语句？我想，如果我可以看到实际访问了哪些表来生成现有报告，我将有一个很好的起点来探索架构并确定用于我自己的报告的正确 SQL。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-09-11T06:45:01.540

在数据字典方面，您可以使用很多工具，例如[Schema Spy](http://schemaspy.sourceforge.net/)

要查看正在运行的查询，请查看视图 sys.v_$sql 和 sys.v_$sqltext。您还需要访问 sys.all_users

需要注意的一件事是，使用参数的查询将显示一次，并带有类似的条目

```
and TABLETYPE=’:b16’ 
```

而其他不会出现多次的，例如：

```
and TABLETYPE=’MT’ 
```

这些表的一个实际示例是以下 SQL，用于查找前 20 个磁盘读取消耗量最大的问题。您可以通过删除**WHERE rownum <= 20**并添加**ORDER BY 模块**来更改此设置。您经常会发现该模块会给您提供有关正在运行查询的软件的错误线索（例如：“TOAD 9.0.1.8”、“JDBC 瘦客户端”、“runcbl@somebox (TNS V1-V3)”等）

```
SELECT 
 module, 
 sql_text, 
 username, 
 disk_reads_per_exec, 
 buffer_gets, 
 disk_reads, 
 parse_calls, 
 sorts, 
 executions, 
 rows_processed, 
 hit_ratio, 
 first_load_time, 
 sharable_mem, 
 persistent_mem, 
 runtime_mem, 
 cpu_time, 
 elapsed_time, 
 address, 
 hash_value 
FROM 
  (SELECT
   module, 
   sql_text , 
   u.username , 
   round((s.disk_reads/decode(s.executions,0,1, s.executions)),2)  disk_reads_per_exec, 
   s.disk_reads , 
   s.buffer_gets , 
   s.parse_calls , 
   s.sorts , 
   s.executions , 
   s.rows_processed , 
   100 - round(100 *  s.disk_reads/greatest(s.buffer_gets,1),2) hit_ratio, 
   s.first_load_time , 
   sharable_mem , 
   persistent_mem , 
   runtime_mem, 
   cpu_time, 
   elapsed_time, 
   address, 
   hash_value 
  FROM
   sys.v_$sql s, 
   sys.all_users u 
  WHERE
   s.parsing_user_id=u.user_id 
   and UPPER(u.username) not in ('SYS','SYSTEM') 
  ORDER BY
   4 desc) 
WHERE
 rownum <= 20; 
```

请注意，如果查询很长.. 您将不得不查询 v_$sqltext。这将存储整个查询。您将不得不查找 ADDRESS 和 HASH_VALUE 并拾取所有部分。例如：

```
SELECT
 *
FROM
 sys.v_$sqltext
WHERE
 address = 'C0000000372B3C28'
 and hash_value = '1272580459'
ORDER BY 
 address, hash_value, command_type, piece
; 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-11T06:59:55.793

很抱歉简短的回答，但已经晚了。谷歌“oracle 事件 10046 sql 跟踪”。最好跟踪单个会话，因为如果它是共享 sql 并被多个用户使用，那么从 v$sql 确定哪个 SQL 属于哪个会话并不容易。

如果您想给您的 Oracle DBA 朋友留下深刻印象，请学习如何使用事件 10046 设置 Oracle 跟踪，解释等待事件的含义并找到最高 cpu 消费者。

Quest 有一个免费产品，允许您在 SQL 从客户端发出时捕获它，但不确定它是否适用于您的产品/版本的 Oracle。谷歌“quest oracle sql monitor”为此。

晚安。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T06:44:44.397

我认为[V$SQLAREA](http://download-uk.oracle.com/docs/cd/B19306_01/server.102/b14237/dynviews_2129.htm)表包含您要查找的内容（请参见**SQL_TEXT**和**SQL_FULLTEXT**列）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-11T06:46:04.720

是的，这绝对是可能的。v$sql 视图包含该信息。像[这段代码这样的](http://www.oracle.com/technology/oramag/code/tips2005/100305.html)东西应该为您指明正确的方向。我自己还没有尝试过那段特定的代码——现在离 Oracle 数据库还很远。

[编辑]该死的已经有另外两个答案了。下次必须打字更快;-)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-16T17:00:57.883

- 我使用类似的东西，概念和一些从 asktom 窃取的代码。
-- 欢迎提出改进建议

> WITH
> sess AS
> (
> SELECT *
> FROM V$SESSION
> WHERE USERNAME = USER
> ORDER BY SID
> )
> SELECT si.SID,
> si.LOCKWAIT,
> si.OSUSER,
> si.PROGRAM,
> si.LOGON_TIME,
> si.STATUS,
> (
> SELECT ROUND(USED_UBLK*8 /1024,1)
> 从 V$TRANSACTION,
> sess
> WHERE sess.TADDR = V$TRANSACTION.ADDR
> AND sess.SID = si.SID
> 
> ) rollback_remaining,
> 
> (
> SELECT (MAX(DECODE(PIECE, 0,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 1,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 2,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 3,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 4,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 5,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 6,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 7,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 8,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 9,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 10,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 11,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 12,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 13,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 14,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 15,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 16,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 17,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 18,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 19,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 20,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 21,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 22,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 23,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 24,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 25,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 26,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 27,SQL_TEXT,NULL)) ||
> MAX(解码(PIECE, 28,SQL_TEXT,NULL)) ||
> MAX(DECODE(PIECE, 29,SQL_TEXT,NULL)))
> FROM V$SQLTEXT_WITH_NEWLINES
> WHERE ADDRESS = SI.SQL_ADDRESS AND
> PIECE < 30
> ) SQL_TEXT
> FROM sess si;

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-16T14:51:45.197

我在 Java 应用程序中有（有）类似的问题。我围绕 Oracle 驱动程序编写了一个 JDBC 驱动程序包装器，因此所有输出都发送到一个日志文件。

# web-services - Web 服务 - 一个城市的当前时区？

> ID：55901
> 
> 赞同：54
> 
> 时间：2008-09-11T06:30:04.667
> 
> 标签：web-services, timezone

是否有某种（或任何其他方式）的网络服务来提取（美国）城市的当前时区设置。对于该国不遵循夏令时并且在其他人都在切换夏季/冬季时间时基本上会跳转时区的部分地区......我不喜欢创建自己的不遵循 DST 的地方的数据库。有没有办法按需提取这些数据？

我需要这个用于数据库服务器（而不是客户端工作站） - 存储在数据库中的实体具有 City、State 作为属性。我需要随时知道这些实体的当前时区。

* * *

## 回答 #1

> 赞同：74
> 
> 时间：2013-02-20T19:33:12.343

我们遇到了同样的问题，除了上面的好建议外，谷歌似乎有两个互补的 API，一个用于来自地理编码（纬度/经度）数据的时区和地理编码 API。

例如，要获取旧金山的时区和偏移量：

### 1) 将城市转换为地理编码位置：

[http://maps.googleapis.com/maps/api/geocode/json?address=San%20Francisco,+CA&sensor=false](http://maps.googleapis.com/maps/api/geocode/json?address=San%20Francisco,%20CA&sensor=false)

地理编码位置在 JSON 返回数据中：

```
"location": {
    "lat":  37.77492950,
    "lng": -122.41941550
} 
```

### 2) 将地理编码位置转换为本地时区和偏移量（如果有）：

[https://maps.googleapis.com/maps/api/timezone/json?location=37.77492950,-122.41941550×tamp=1331161200&sensor=false](https://maps.googleapis.com/maps/api/timezone/json?location=37.77492950,-122.41941550&timestamp=1331161200&sensor=false)

返回当前时区信息：

```
{
          "status": "OK",
       "dstOffset":  0.0,
       "rawOffset": -28800.0,              
      "timeZoneId": "America/Los_Angeles",
    "timeZoneName": "Pacific Standard Time"
} 
```

一个地区的时区可能会因多种原因而改变。所以最好找一个权威的基于服务器的解决方案而不是缓存。有关更多信息，请参阅[Wikipedia 的时区文章](http://en.wikipedia.org/wiki/Time_zone#Programming_languages)。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2008-09-11T06:43:53.320

earthtools.org 提供了一个免费的网络服务来从这里获取一个城市的时区：

[http://www.earthtools.org/webservices.htm#timezone](http://www.earthtools.org/webservices.htm#timezone)

您只需像这样传入 long/lat 值：（这是针对纽约的）

[http://www.earthtools.org/timezone-1.1/40.71417/-74.00639](http://www.earthtools.org/timezone-1.1/40.71417/-74.00639)

* * *

**编辑：**

好像earthtools 已经关闭了。Google Time Zone API 是一个不错的选择（在 2008 年回答这个问题时不存在）。要使用它，您必须首先在您的帐户上[激活 Time Zone API 。](https://console.developers.google.com/flows/enableapi?apiid=timezone_backend&keyType=SERVER_SIDE)如果您保持在以下限制以下，则免费：

*   每 24 小时有 2500 个请求。
*   每秒 5 个请求。

[该文档](https://developers.google.com/maps/documentation/timezone/intro)可在 Google Developers 上找到。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-11T07:14:13.733

Geonames.org 有一组精彩的世界数据，可通过网络服务或下载获得：

[http://www.geonames.org/export/ws-overview.html](http://www.geonames.org/export/ws-overview.html)

尤其

[http://www.geonames.org/export/web-services.html#timezone](http://www.geonames.org/export/web-services.html#timezone)

.

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2011-11-24T08:56:28.867

Earthtool 的时区信息不是最新的……例如，斯里兰卡当前的偏移量是 GMT 的 +5.5，但 EarthTools 显示为 +6，这是 2005 年之前的旧偏移量。

我建议[GeoNames.org](http://GeoNames.org)。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2008-09-11T06:43:56.660

[WorldTimeServer.com](http://www.worldtimeserver.com/time_zone_guide/)似乎有一个综合时区数据库，您可以购买各种格式的访问权限，包括用于 Web 的 .NET 组件。

没有联系，只是最近自己研究了同样的事情。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-06-02T12:23:20.730

简单的离线库：[APTimeZones](https://github.com/Alterplay/APTimeZones)

为了找到某个位置的时区，您可以使用 Google Maps API 的时区 API。不幸的是，这需要您查询远程服务，并且您会受到它们的限制。

[这是一个名为APTimeZones](https://github.com/Alterplay/APTimeZones)的库 rom Alterplay （已附加 Git），它允许您从给定位置提取 NSTimeZone 而无需连接到远程服务。 [APTimeZones](https://github.com/Alterplay/APTimeZones)通过查询本地时区列表（包含在库中）来工作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-01-05T01:27:30.950

万一有人碰到这个问题。

*   您可以使用 Google API 搜索地址。这将返回纬度/对数。有了这些值，您可以使用例如 PHP 找到最近的时区。

*   或者您可以使用类似 timezoneapi.io 的 API（我支持它），它使您能够搜索地址/城市/国家/地区。它返回给定时区的地址、时区信息和当前日期/时间。

[https://timezoneapi.io/developers/address](https://timezoneapi.io/developers/address)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-04-26T16:30:17.703

我知道这已得到解答，但我发布此答案是因为人们可能仍然觉得它有用 - 所选答案现在无法成功运行。

Google 有自己的服务，非常可靠且易于使用，并以 JSON 格式输出信息。它甚至允许指定自定义时间，例如获取马耳他 02/02/2013 的时区。

[https://developers.google.com/maps/documentation/timezone/](https://developers.google.com/maps/documentation/timezone/)

# eclipse - Eclipse 替代 VS .sln 文件

> ID：55903
> 
> 赞同：12
> 
> 时间：2008-09-11T06:33:27.620
> 
> 标签：eclipse

我最近不得不从 Visual Studio 切换到 Eclipse CDT。
似乎 Eclipse“工作区”与 VS 解决方案文件不太一样。
Eclipse 工作区使用该`.metadata`文件夹来管理多个项目，但用户设置或 IDE 首选项与项目/解决方案设置之间似乎没有简单的区别。

我想要的是一种将一组相关（和依赖）项目组合在一起的方法，并将该数据保存在源代码管理中，而无需开发人员不需要共享的所有其他用户特定内容。你知道，就像`.sln`Visual Studio 中的文件。

Eclipse 不能以这种方式工作吗？（如果没有，那为什么不呢？）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-11T06:41:49.503

是的，你是对的，eclipse 管理项目的方式与 VS 管理解决方案文件的方式不同。然而，为了将一组相关项目放入 VCS 中，在 File->Export 中有一个*Team Project Set*的概念，然后在 Team 文件夹下有 Team Project Set。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-11T07:25:33.767

就像 JProgrammer 所说的，有 Team Project Set。您可以向您的同事发送一堆 .psf 文件，其工作方式类似于 VS.NET。我只能说我们对这个功能有很好的经验。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T06:41:05.730

我经常发现 IDE 有一种首选的工作方式。当然，您也许可以让 IDE 以您的方式完成它，但您最终可能会一直与之抗争。

尝试像他们的制造商所希望的那样使用您的 IDE。他们对你应该如何做你的工作做出了假设。他们根据这些假设优化了用户体验。

顺其自然。其他任何东西都会让你变得粗糙、苦涩、皱纹，让你喘不过气来！

**推论**：如果可以，请选择与您对工作流做出相同假设的 IDE！

# winapi - Win32 CreatePatternBrush

> ID：55932
> 
> 赞同：4
> 
> 时间：2008-09-11T07:13:24.280
> 
> 标签：winapi, gdi

MSDN 为 CreatePatternBrush 显示以下内容：

> 您可以使用 DeleteObject 函数删除图案画笔而不影响关联的位图。因此，您可以使用此位图创建任意数量的图案画笔。

我的问题是相反的。如果 HBRUSH 长期存在，我可以在创建画笔后立即删除 HBITMAP 吗？IE：HBRUSH 是否存储自己的 HBITMAP 副本？

在这种情况下，我希望 HBRUSH 具有对象范围，而 HBITMAP 将具有方法范围（创建 HBRUSH 的方法）。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-10-17T14:27:04.970

HBRUSH 和 HBITMAP 是完全独立的。句柄可以彼此完全独立地删除，并且一旦创建，对任何一个对象的更改都不会影响另一个。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-06-17T12:58:30.097

画笔确实有自己的位图副本。通过在创建画笔后删除位图然后使用画笔很容易看到这一点（工作正常）

不幸的是，使用 GetObject 填充 LOGBRUSH 结构将返回成员 lbhatch 中的原始 BITMAP 句柄，而不是副本的句柄。如果删除位图，则在返回的位图句柄上使用 GetObject 会失败。

在这种情况下，任何人都知道如何从画笔中获取原始位图尺寸？即使删除了原始位图，我也希望创建图案画笔的副本。我可以简单地用画笔绘制原始位图的副本，但我不知道它的大小。我尝试使用 SetbrushorgEx (hdc, -1,-1)，希望当我将画笔选择到设备上下文中时，-1 的模数会减少，并在我使用 GetBrushOrgEx 检索时获取值。不工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T07:25:34.563

我认为位图必须比画笔更长寿：画笔只是引用现有位图而不是复制它。

你总是可以尝试一下，看看发生了什么。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-16T13:03:57.920

我怀疑 CreatePatternBrush() API 复制了你给它的位图，因为 HBITMAP 是：

1.  一个 GDI 句柄，其最大数量是有限的，以及
2.  可能相当大。

Win32 和 GDI 倾向于保守地创建数据的内部副本，这仅仅是因为在创建它们的大多数 API 时（CreatePatternBrush() 可以追溯到 Windows 95，并且许多函数仍然更旧），内存和 GDI 句柄要多得多供应比现在有限。（例如，Windows 95 需要在只有 4MB RAM 的系统上运行良好。）

# silverlight - 如何分析 Silverlight 应用程序？

> ID：55943
> 
> 赞同：18
> 
> 时间：2008-09-11T07:29:00.903
> 
> 标签：silverlight, profiling

他们是否有任何支持 Silverlight 的分析器？我试过ANTS（3.1版）没有任何成功？版本 4 支持吗？我可以尝试其他任何产品吗？

**自 Silverlight 4 发布以来进行了更新** ，现在可以对 SL 应用程序进行完整的分析...查看有关该主题的[这篇文章](http://blogs.msdn.com/seema/archive/2010/01/28/pdc-vs2010-profiling-silverlight-4.aspx)

> 在 PDC，我宣布 Silverlight 4 带有新的 CoreCLR 功能，可以通过 VS2010 分析器进行分析：这意味着我们第一次让您能够分析使用的托管代码和本机代码（用户或平台）通过 Silverlight 应用程序。呜呼。感谢 CLR 团队。
> 
> 旁注：从 silverlight 1-3 开始，只能使用 xperf（请参阅 XPerf：Silverlight 的 CPU 采样器）之类的东西，它非常强大，可以查看 layout/text/media/gfx/etc 管道，但只提供本机调用堆栈。 )

来自[SilverLite](http://blogs.msdn.com/seema)（[PDC 视频，TechEd Iceland，VS2010，分析，Silverlight 4](http://blogs.msdn.com/seema/archive/2010/01/28/pdc-vs2010-profiling-silverlight-4.aspx)）

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-11T07:35:43.370

在此处安装 XPerf 和 xperfview：http: [//msdn.microsoft.com/en-us/library/cc305218.aspx](http://blogs.msdn.com/b/seema/archive/2008/10/08/xperf-a-cpu-sampler-for-silverlight.aspx)

(1) 启动您的样本

(2) xperf -on 基础

(3) 稍等

(4) xperf –d myprofile.etl

(5) 完成后，设置符号路径：

```
    设置 _NT_SYMBOL_PATH= srv *C:\symbols* http://msdl.microsoft.com/downloads/symbols
```

(6) xperfview myprofile.etl

(7) 跟踪 -> 加载符号

*   选择要查看的 CPU 图表区域
*   右键单击并选择汇总表

(8) 接受 EULA 以使用符号，展开 IExplore，展开 agcore.dll 或任何您的顶级模块

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-04-30T17:30:33.227

Visual Studio 2010（带有 Silverlight 4 工具）附带用于分析 Silverlight 应用程序的命令行支持。

分析 SL4 的完整说明可在以下网址找到：http: [//www.nachmore.com/2010/profiling-silverlight-4-with-visual-studio-2010/](http://www.nachmore.com/2010/profiling-silverlight-4-with-visual-studio-2010/)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-04-05T09:51:05.443

试试 JetBrains dotTrace 性能分析器。以下是详细信息： [http ://confluence.jetbrains.net/display/NetProf/How+to+profile+silverlight+application](http://confluence.jetbrains.net/display/NetProf/How+to+profile+silverlight+application)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-11-03T07:38:29.830

[这](http://blogs.msdn.com/seema/archive/2008/10/08/xperf-a-cpu-sampler-for-silverlight.aspx)是有关使用 XPerf 的详细博客条目...还可以查看[此](http://channel9.msdn.com/pdc2008/PC06/)视频（在 PDC 上）关于分析 silverlight！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-09-04T19:57:57.033

AtoLogic SilverProfiler 应该适合您。见[http://www.atologic.com](http://www.atologic.com)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-03-19T19:30:24.407

SL 4.0 具有 coreclr etw 事件。应该能够使用 XPERF 和[Perfmonitor](http://bcl.codeplex.com/releases/view/42784)以及 clr etw 诊断异常、gc、线程和少数其他。我在[博客](http://naveensrinivasan.wordpress.com/2010/03/15/undocumented-silverlight-feature-%e2%80%93-etw-tracing/)上写过这个。

仅供参考，使用 Perfmonitor 应该能够提供调用堆栈。

ETW 仅在 Windows 中可用。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-01-20T17:04:34.640

我喜欢红门蚂蚁。我发现它比 dotTrace 更好。

# ssl - 无法建立 SSL 连接

> ID：55953
> 
> 赞同：0
> 
> 时间：2008-09-11T07:34:33.857
> 
> 标签：ssl, connection, limits

我正在使用具有 GPRS 媒体的设备连接到运行 stunnel 的 PC。在 TCPIP 连接上，会话数是无限的。但是，当涉及到 SSL 连接时，它最多只能成功 1062 个会话。我已经尝试了 3 次，但没有任何区别。我检查了 OpenSSL 代码，似乎找不到任何将 SSL 连接限制为 1062 的代码块。从 SSL 的角度来看，有什么限制连接数的吗？

* * *

是的，我使用的是后付费电话 SIM，但 TCPIP 没有任何问题。它只发生在 SSL 连接上。我们也尝试使用相同的 OpenSSL stunnel 连接到其他 PC，但最终只能连接 1062 个连接。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-12T10:30:07.857

我想我不是唯一一个遇到这种问题的人。我发现 Sun Java System Directory Server 的打开 ssl 连接限制仅达到 1020 (FD_SETSIZE=1024)。虽然它是硬编码的，所以你可以清楚地看到问题的原因。然而，就我而言，我似乎找不到罪魁祸首...... :(

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T09:06:33.137

您是否通过电话提供商连接 - 这可能是问题吗？

# php - mysql_insert_id 替代 postgresql

> ID：55956
> 
> 赞同：23
> 
> 时间：2008-09-11T07:37:00.107
> 
> 标签：php, postgresql, insert-id

`mysql_insert_id()`PostgreSQL的 php 函数有替代方法吗？大多数框架通过查找 ID 中使用的序列的当前值来部分解决问题。但是，有时主键不是串行列....

* * *

## 回答 #1

> 赞同：43
> 
> 时间：2008-09-11T09:32:42.247

从 PostgreSQL 的角度来看，在伪代码中：

```
 * $insert_id = INSERT...RETURNING foo_id;-- only works for PostgreSQL >= 8.2\. 

 * INSERT...; $insert_id = SELECT lastval(); -- works for PostgreSQL >= 8.1

 * $insert_id = SELECT nextval('foo_seq'); INSERT INTO table (foo...) values ($insert_id...) for older PostgreSQL (and newer PostgreSQL) 
```

`pg_last_oid()`仅适用于您有 OID 的情况。自 PostgreSQL 8.1 起，OID 已默认关闭。

因此，根据您拥有的 PostgreSQL 版本，您应该选择上述方法之一。当然，理想情况下，使用抽象出上述内容的数据库抽象库。否则，在低级代码中，它看起来像：

# 方法一：插入...返回

```
// yes, we're not using pg_insert()
$result = pg_query($db, "INSERT INTO foo (bar) VALUES (123) RETURNING foo_id");
$insert_row = pg_fetch_row($result);
$insert_id = $insert_row[0]; 
```

# 方法二：INSERT；最后一个（）

```
$result = pg_execute($db, "INSERT INTO foo (bar) values (123);");
$insert_query = pg_query("SELECT lastval();");
$insert_row = pg_fetch_row($insert_query);
$insert_id = $insert_row[0]; 
```

# 方法三：nextval(); 插入

```
$insert_query = pg_query($db, "SELECT nextval('foo_seq');");
$insert_row = pg_fetch_row($insert_query);
$insert_id = $insert_row[0];
$result = pg_execute($db, "INSERT INTO foo (foo_id, bar) VALUES ($insert_id, 123);"); 
```

最安全的选择是第三种方法，但它很笨拙。最干净的是第一个，但您需要运行最新的 PostgreSQL。大多数数据库抽象库还没有使用第一种方法。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-11T07:42:16.177

查看INSERT 语句的[RETURNING 可选子句。](http://www.postgresql.org/docs/current/interactive/sql-insert.html)（链接到官方 PostgreSQL 文档）

但基本上，你这样做：

```
INSERT INTO table (col1, col2) VALUES (1, 2) RETURNING pkey_col 
```

并且 INSERT 语句本身返回受影响行的 id（或您指定的任何表达式）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-11T08:43:38.183

来自 php.net：

```
$res=pg_query("SELECT nextval('foo_key_seq') as key");
$row=pg_fetch_array($res, 0);
$key=$row['key'];
// now we have the serial value in $key, let's do the insert
pg_query("INSERT INTO foo (key, foo) VALUES ($key, 'blah blah')"); 
```

这应该始终提供唯一的密钥，因为从数据库中检索的密钥将永远不会再次检索。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-05-02T23:36:42.760

您还可以使用：

```
$result = pg_query($db, "INSERT INTO foo (bar) VALUES (123) RETURNING foo_id");
$insert_row = pg_fetch_result($result, 0, 'foo_id'); 
```

您必须在 pg_fetch_result 中指定要查找的行号和字段的名称，这是获取所需数据的更精确方法，但我不知道这是否有一些惩罚查询的性能。请记住，此方法适用于 PostgreSQL 版本 8.2 及更高版本。

# asp.net - .net Web 应用程序中的异常处理

> ID：55961
> 
> 赞同：8
> 
> 时间：2008-09-11T07:45:56.340
> 
> 标签：asp.net, exception-handling

我承认：我不为过多的异常处理而烦恼。我知道我应该做更多，但我永远无法思考从哪里开始和在哪里停止。我不是偷懒。离得很远。这是我对异常处理的矛盾心理过度劳累了。似乎在最小的应用程序中似乎有无数个地方可以应用异常处理，并且开始感觉像是矫枉过正。

我已经通过仔细的测试、验证和默默的祈祷，但这是一个等待发生的糟糕的编程事故。

那么，您的异常处理最佳实践是什么？特别是，应该应用异常处理的最明显/关键的地方在哪里，应该考虑的地方在哪里？

抱歉这个问题含糊不清，但我真的很想一劳永逸地结束这本书。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-11T07:49:00.840

Microsoft 的[模式和实践团队在将异常管理的最佳实践整合到企业库](http://msdn.microsoft.com/en-us/practices/default.aspx)[异常处理应用程序块](http://msdn.microsoft.com/en-us/library/cc511522.aspx)中做得很好

如果不使用 Enterprise Library，我*强烈*建议您阅读他们的文档。P&P 团队描述了异常处理的常见场景和最佳实践。

为了帮助您入门，我建议阅读以下文章：

*   MSDN 上的[异常处理](http://msdn.microsoft.com/en-us/library/ms229005.aspx)
*   MSDN[上 .NET 中的异常管理](http://msdn.microsoft.com/en-us/library/ms229005.aspx)
*   CodeProject[上 .NET 中的异常处理最佳实践](http://www.codeproject.com/KB/architecture/exceptionbestpractices.aspx)

ASP.NET 特定文章：

*   [用户友好的 ASP.NET 异常处理](http://www.codeproject.com/KB/aspnet/ASPNETExceptionHandling.aspx)
*   [使用 ASP.NET 进行全局异常处理](http://www.developer.com/net/asp/article.php/961301)
*   [C# 和 ASP .Net 中的异常处理](http://www.codersource.net/asp_net_exception_handling.aspx)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-11T08:01:52.433

异常处理的黄金法则是：

> “只抓住你知道如何处理的东西”

我见过太多的 try-catch 块，其中 catch 只会重新抛出异常。这没有任何价值。仅仅因为您调用了一个可能引发异常的方法，并不意味着您必须处理调用代码中可能出现的异常。让异常沿调用堆栈向上传播到其他知道该做什么的代码通常是完全可以接受的。在某些情况下，让异常一直传播到用户界面层然后捕获并将消息显示给用户是有效的。可能没有代码最适合知道如何处理这种情况，用户必须决定行动方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-11T07:53:27.820

我建议您首先添加一个良好的错误页面，该页面捕获所有异常并向用户打印稍微不那么不友好的消息。请务必记录异常的所有可用详细信息并进行修改。让用户知道您已经这样做了，并给他一个返回到（可能）可以工作的页面的链接。

现在，使用该日志来检测应该在哪里进行特殊异常处理。请记住，除非您打算对异常进行处理，否则捕获异常是没有用的。如果您有上述页面，则在所有数据库操作上单独捕获数据库异常是没有用的，除非您有某种特定的方法可以在该特定点恢复。

请记住：唯一比不捕获异常更糟糕的是，捕获它们并且什么都不做。这只会隐藏真正的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T08:03:20.917

一般而言，可能比 ASP.NET 特定的异常处理更多，但是：

*   尝试捕获尽可能接近原因的异常，以便您可以记录（记录）尽可能多的有关异常的信息。
*   在程序的入口点包含某种形式的包罗万象、最后手段的异常处理程序。在 ASP.NET 中，这可能是应用程序级别的错误处理程序。
*   如果您不知道如何“正确”处理异常，请让它冒泡到 catch all 处理程序，您可以将其视为“意外”异常。
*   将 .NET 中的 Try***** 方法用于访问字典等操作。如果您在一个循环中抛出多个异常，这有助于避免主要的性能问题（异常处理相对较慢）。
*   不要使用异常处理来控制程序的正常逻辑，例如通过 throw 语句退出循环。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-23T17:23:39.540

从全局异常处理程序开始，例如[http://code.google.com/p/elmah/](http://code.google.com/p/elmah/)。

那么问题就归结为您正在编写什么样的应用程序以及您需要提供什么样的用户体验。用户体验越丰富，您想要提供的异常处理就越好。

例如，考虑一个具有磁盘配额、文件大小限制、图像尺寸限制等的照片托管站点。对于每个错误，您可以简单地返回“发生错误。请重试”。或者您可以进行详细的错误处理：

*   “您的文件太大。最大文件大小为 5mb。”
*   “你的图片太大了。最大尺寸为 1200x1200。”
*   “您的相册已满。最大存储容量为 1GB”。
*   “您的上传出错。我们的仓鼠不高兴。请稍后再回来。”

等等等等

没有一种适合所有异常处理的方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-11T07:49:35.957

好吧，在最基本的层面上，您应该处理 Global.asax 文件中的 HttpApplication.Error 事件。这应该记录发生在一个地方的任何异常，以便您可以查看异常的堆栈跟踪。

除了这个基本级别之外，理想情况下，您应该处理您知道可以从中恢复的异常 - 例如，如果您希望文件可能被锁定，那么处理 IOException 并将错误报告给用户将是一个好主意。

# c# - 不安全的 C# 和用于 2D 渲染的指针，好还是坏？

> ID：55963
> 
> 赞同：4
> 
> 时间：2008-09-11T07:47:22.343
> 
> 标签：c#, graphics, pointers

我正在编写一个包装 DirectX 9 并提供简化接口来执行 2D 像素级绘图的 C# 控件。.NET 要求我将此代码包装在一个不安全的代码块中，并使用允许不安全代码选项进行编译。

我锁定了整个表面，然后返回一个指向锁定的内存区域的指针。然后我可以使用“简单”指针算法直接写入像素数据。我对此进行了性能测试，发现与我所知道的其他“安全”方法相比，速度有了很大提高。

这是在 C# .NET 应用程序中操作单个像素的最快方法吗？有没有更好、更安全的方法？如果有一种同样快速的方法不需要指针操作，那么我更喜欢使用它。

（我知道这是 2008 年，我们都应该使用 DirectX 3D、[OpenGL](http://en.wikipedia.org/wiki/OpenGL)等，但是这个控件专门用于 2D 像素渲染，根本不需要 3D 渲染。）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-13T20:41:18.503

使用不安全指针是在 C# 中进行直接内存操作的最快方法（绝对比使用 Marshal 包装函数更快）。

只是出于好奇，您要执行哪种 2D 绘图操作？

我问是因为锁定 DirectX 表面以进行像素级操作会破坏您希望从使用 DirectX 中获得的大部分硬件加速优势。此外，DirectX 设备在通过终端服务（远程桌面）使用时将无法初始化，因此在这种情况下控件将无法使用（这对您来说可能无关紧要）。

在绘制大三角形和变换图像（纹理映射到四边形）时，DirectX 将是一个巨大的胜利，但它在单个像素处理方面并不会真正表现得那么好。

留在 .NET 领域，一种替代方法是保留 Bitmap 对象作为您的表面，使用 LockBits 并通过返回的 BitmapData 对象中的不安全指针直接访问像素。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-25T04:27:26.207

是的，这可能是最快的方法。

几年前，我不得不在像素级别比较两张 1024x1024 的图像；get-pixel 方法耗时 2 分钟，不安全扫描耗时 0.01 秒。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-18T13:57:09.637

我还使用 unsafe 来加速这种性质的事情。至少可以说，性能改进是戏剧性的。这里的重点是，只要你知道自己在做什么，unsafe 就会关闭一堆你可能不需要的东西。

另外，请查看[DirectDraw](https://en.wikipedia.org/wiki/DirectDraw)。它是 DirectX 的 2D 图形组件。它真的很快。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-11T07:51:23.567

我最近的任务是为我们的一个瘦客户端应用程序 (C#) 创建一个简单的直方图控件。我正在分析的图像大约是 1200x1200，我必须走同样的路线。我可以毫无问题地让事物自己绘制一次，但需要重新调整控件的大小。我试图避免它，但我不得不获取原始内存本身。

我并不是说使用标准的 .NET 类是不可能的，但我最终还是无法让它发挥作用。

# wix - 使 WiX 安装集升级到同一个文件夹

> ID：55964
> 
> 赞同：29
> 
> 时间：2008-09-11T07:47:46.663
> 
> 标签：wix, windows-installer

如何对使用[WiX](http://en.wikipedia.org/wiki/WiX)构建的安装集 (MSI) 进行重大升级，并将其安装到与原始安装相同的文件夹中？

安装被正确检测为升级，但仍显示目录选择屏幕并使用默认值（不一定是当前安装文件夹）。

我是否必须进行手动工作，例如在第一次安装时将安装文件夹保存在注册表项中，然后在升级时读取此注册表项？如果是这样，有什么例子吗？

[或者是否有一些更简单的方法可以在MSI](http://en.wikipedia.org/wiki/Windows_Installer)或 WiX中实现这一点？

作为参考，我当前的 WiX 文件如下：

```
<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2003/01/wi">
    <Product Id="a2298d1d-ba60-4c4d-92e3-a77413f54a53"
             Name="MyCompany Integration Framework 1.0.0"
             Language="1033"
             Version="1.0.0"
             Manufacturer="MyCompany"
             UpgradeCode="9071eacc-9b5a-48e3-bb90-8064d2b2c45d">

        <!-- Package information -->
        <Package Keywords="Installer"
                 Id="e85e6190-1cd4-49f5-8924-9da5fcb8aee8"
                 Description="Installs MyCompany Integration Framework 1.0.0"
                 Comments="Installs MyCompany Integration Framework 1.0.0"
                 InstallerVersion="100"
                 Compressed="yes" />

        <Upgrade Id='9071eacc-9b5a-48e3-bb90-8064d2b2c45d'>
            <UpgradeVersion Property="PATCHFOUND"
                            OnlyDetect="no"
                            Minimum="0.0.1"
                            IncludeMinimum="yes"
                            Maximum="1.0.0"
                            IncludeMaximum="yes"/>
        </Upgrade>

        <!-- Useless but necessary... -->
        <Media Id="1" Cabinet="MyCompany.cab" EmbedCab="yes" />

        <!-- Precondition: .NET 2 must be installed -->
        <Condition Message='This setup requires the .NET Framework 2 or higher.'>
            <![CDATA[MsiNetAssemblySupport >= "2.0.50727"]]>
        </Condition>

        <Directory Id="TARGETDIR"
                   Name="SourceDir">
            <Directory Id="MyCompany"
                       Name="MyCompany">
                <Directory Id="INSTALLDIR"
                           Name="Integrat"
                           LongName="MyCompany Integration Framework">
                    <Component Id="MyCompanyDllComponent"
                               Guid="4f362043-03a0-472d-a84f-896522ce7d2b"
                               DiskId="1">
                        <File Id="MyCompanyIntegrationDll"
                              Name="IbIntegr.dll"
                              src="..\Build\MyCompany.Integration.dll"
                              Vital="yes"
                              LongName="MyCompany.Integration.dll" />
                        <File Id="MyCompanyServiceModelDll"
                              Name="IbSerMod.dll"
                              src="..\Build\MyCompany.ServiceModel.dll"
                              Vital="yes"
                              LongName="MyCompany.ServiceModel.dll" />
                    </Component>

                    <!-- More components -->
                </Directory>
            </Directory>
        </Directory>

        <Feature Id="MyCompanyProductFeature"
                 Title='MyCompany Integration Framework'
                 Description='The complete package'
                 Display='expand'
                 Level="1"
                 InstallDefault='local'
                 ConfigurableDirectory="INSTALLDIR">
            <ComponentRef Id="MyCompanyDllComponent" />
        </Feature>

        <!-- Task scheduler application. It has to be used as a property -->
        <Property Id="finaltaskexe"
                  Value="MyCompany.Integration.Host.exe" />
        <Property Id="WIXUI_INSTALLDIR"
                  Value="INSTALLDIR" />

        <InstallExecuteSequence>
            <!-- command must be executed: MyCompany.Integration.Host.exe /INITIALCONFIG parameters.xml -->
            <Custom Action='PropertyAssign'
                    After='InstallFinalize'>NOT Installed AND NOT PATCHFOUND</Custom>
            <Custom Action='LaunchFile'
                    After='InstallFinalize'>NOT Installed AND NOT PATCHFOUND</Custom>

            <RemoveExistingProducts Before='CostInitialize' />
        </InstallExecuteSequence>

        <!-- execute comand -->
        <CustomAction Id='PropertyAssign'
                      Property='PathProperty'
            Value='[INSTALLDIR][finaltaskexe]' />
        <CustomAction Id='LaunchFile'
                      Property='PathProperty'
                      ExeCommand='/INITIALCONFIG "[INSTALLDIR]parameters.xml"'
                      Return='asyncNoWait' />

        <!-- User interface information -->
        <UIRef Id="WixUI_InstallDir" />
        <UIRef Id="WixUI_ErrorProgressText" />
    </Product>
</Wix> 
```

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2008-09-11T09:25:20.593

WiX 教程中有一个示例：[https ://www.firegiant.com/wix/tutorial/getting-started/where-to-install/](https://www.firegiant.com/wix/tutorial/getting-started/where-to-install/)

```
<Property Id="INSTALLDIR">
  <RegistrySearch Id='AcmeFoobarRegistry' Type='raw'
    Root='HKLM' Key='Software\Acme\Foobar 1.0' Name='InstallDir' />
</Property> 
```

当然，您也必须将注册表项设置为安装的一部分。将其粘贴在作为原始安装一部分的组件中：

```
<RegistryKey
         Key="Software\Software\Acme\Foobar 1.0"
         Root="HKLM">
  <RegistryValue Id="FoobarRegInstallDir"
             Type="string"
             Name="InstallDir"
             Value="[INSTALLDIR]" />
</RegistryKey> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-01-17T12:11:10.463

“注册表”已弃用。现在这部分代码应该如下所示：

```
<RegistryKey Id="FoobarRegRoot"
             Action="createAndRemoveOnUninstall"
             Key="Software\Software\Acme\Foobar 1.0"
             Root="HKLM">
  <RegistryValue Id="FoobarRegInstallDir"
                 Type="string"
                 Name="InstallDir"
                 Value="[INSTALLDIR]" />
</RegistryKey> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-04-16T22:08:39.420

在这样的简单情况下，您实际上不需要将 RegistryKey 与 RegistryValue 分开。此外，无论您是在进行机器安装还是用户安装，使用 HKMU 而不是 HKLM 都可以解决这个问题。

```
<RegistryValue
  Root="HKMU"
  Key="Software\[Manufacturer]\[ProductName]"
  Name="InstallDir"
  Type="string"
  Value="[INSTALLDIR]"
  KeyPath="yes" /> 
```

# sql - Windows 上的 SQLite 数据库是否有等效的 MySQLAdmin 或 SQL Server Management Studio？

> ID：55968
> 
> 赞同：6
> 
> 时间：2008-09-11T07:48:53.867
> 
> 标签：sql, windows, sqlite

我需要一些软件来探索和修改一些 SQLite 数据库。是否存在类似于 SQL Server Management Studio 或 MySQLAdmin 的东西？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-11T07:52:32.610

[作为 Firefox 插件](https://addons.mozilla.org/en-US/firefox/addon/5817)（主要针对齿轮，但应该可以）

[作为一个（糟糕的）基于网络的应用程序](http://www.sqlitemanager.org)

还有[一大堆管理工具](http://www.sqlite.org/cvstrac/wiki?p=ManagementTools)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-11T08:43:48.150

我还在[http://sqlite.phxsoftware.com/](http://sqlite.phxsoftware.com/)上发现了一些用于 Visual Studio 的 SQLite 软件，它允许您使用 Visual Studio Server Explorer 创建到 SQLite 数据库的连接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-11T10:12:43.740

SQLiteManager（Vinko 提到的 Firefox 插件）也可以作为一个独立的应用程序，与 XULRunner 一起工作。

# c# - 测试对象不是类型

> ID：55978
> 
> 赞同：0
> 
> 时间：2008-09-11T07:58:38.493
> 
> 标签：c#, syntax, object, testing

我知道如何使用 IS 关键字测试对象以查看它是否属于某个类型，例如

```
if (foo is bar)
{
  //do something here
} 
```

但是您如何测试它不是“bar”？，我似乎找不到与 IS 一起使用的关键字来测试否定结果。

顺便说一句 - 我有一种可怕的感觉，这太明显了，所以提前道歉......

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-11T08:00:05.027

```
if (!(foo is bar)) {
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-11T08:07:23.730

您也可以使用[as 运算符](http://msdn.microsoft.com/en-us/library/cscsdfbt(VS.71).aspx)。

> as 运算符用于执行兼容类型之间的转换。

```
bar aBar = foo as bar; // aBar is null if foo is not bar 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-11T08:00:52.310

没有特定的关键字

```
if (!(foo is bar)) ...
if (foo.GetType() != bar.GetType()) .. // foo & bar should be on the same level of type hierarchy 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-17T16:35:06.657

您应该澄清您是否要测试一个对象是否*完全*是某种类型或可以从某种类型*分配*。例如：

```
public class Foo : Bar {} 
```

假设你有：

```
Foo foo = new Foo(); 
```

如果你想知道 foo 是否不是 Bar()，那么你可以这样做：

```
if(!(foo.GetType() == tyepof(Bar))) {...} 
```

但是如果你想确保 foo 不是从 Bar 派生的，那么一个简单的检查是使用 as 关键字。

```
Bar bar = foo as Bar;
if(bar == null) {/* foo is not a bar */} 
```

# c# - C# 中的 const 和 readonly 有什么区别？

> ID：55984
> 
> 赞同：1568
> 
> 时间：2008-09-11T08:02:19.297
> 
> 标签：c#, .net, constants, readonly

**`const`**C#和C#有什么区别**`readonly`**？

您什么时候会使用其中一种？

* * *

## 回答 #1

> 赞同：1461
> 
> 时间：2008-09-11T08:24:41.770

除了明显的区别

*   必须在定义`const`VS`readonly`值时声明值可以动态计算，但需要在构造函数退出之前分配......之后它被冻结。
*   `const`是隐含的`static`。您使用`ClassName.ConstantName`符号来访问它们。

有细微的差别。考虑一个定义在`AssemblyA`.

```
public class Const_V_Readonly
{
  public const int I_CONST_VALUE = 2;
  public readonly int I_RO_VALUE;
  public Const_V_Readonly()
  {
     I_RO_VALUE = 3;
  }
} 
```

`AssemblyB`在代码中引用`AssemblyA`和使用这些值。编译时：

*   在`const`值的情况下，它就像一个查找替换。值 2 被“烘焙”到`AssemblyB`'s IL。这意味着如果明天我更新`I_CONST_VALUE`到 20，*`AssemblyB`在我重新编译之前仍然会有 2*。
*   在`readonly`值的情况下，它就像`ref`一个内存位置。该值未烘焙到`AssemblyB`的 IL 中。这意味着如果内存位置被更新，`AssemblyB`则无需重新编译即可获取新值。所以如果`I_RO_VALUE`更新到30，只需要build `AssemblyA`，不需要重新编译所有客户端。

因此，如果您确信常量的值不会改变，请使用`const`.

```
public const int CM_IN_A_METER = 100; 
```

但是，如果您有一个可能会改变的常数（例如精度）.. 或者有疑问时，请使用`readonly`.

```
public readonly float PI = 3.14; 
```

*更新：Aku 需要提及，因为他首先指出了这一点。我还需要插入我学到的地方：[Effective C# - Bill Wagner](https://rads.stackoverflow.com/amzn/click/com/0321245660)*

* * *

## 回答 #2

> 赞同：309
> 
> 时间：2008-09-11T08:15:15.630

const 有一个陷阱！如果您从另一个程序集中引用一个常量，它的值将直接编译到调用程序集中。这样，当您更新引用程序集中的常量时，它不会在调用程序集中更改！

* * *

## 回答 #3

> 赞同：178
> 
> 时间：2008-12-02T11:50:14.753

## 常数

*   常量默认是静态的
*   它们在编译时必须有一个值（你可以有例如 3.14 * 2，但不能调用方法）
*   可以在函数中声明
*   被复制到使用它们的每个程序集中（每个程序集都获得值的本地副本）
*   可用于属性

## 只读实例字段

*   必须在构造函数退出时设置值
*   在创建实例时进行评估

## 静态只读字段

*   在代码执行命中类引用时进行评估（当创建新实例或执行静态方法时）
*   在静态构造函数完成时必须有一个评估值
*   不建议将 ThreadStaticAttribute 放在这些上（静态构造函数将仅在一个线程中执行，并将为其线程设置值；所有其他线程将具有未初始化的此值）

* * *

## 回答 #4

> 赞同：68
> 
> 时间：2008-09-11T10:37:04.913

只是要补充一点，`readonly`对于引用类型，只会使引用只读而不是值。例如：

```
public class Const_V_Readonly
{
  public const int I_CONST_VALUE = 2;
  public readonly char[] I_RO_VALUE = new Char[]{'a', 'b', 'c'};

  public UpdateReadonly()
  {
     I_RO_VALUE[0] = 'V'; //perfectly legal and will update the value
     I_RO_VALUE = new char[]{'V'}; //will cause compiler error
  }
} 
```

* * *

## 回答 #5

> 赞同：47
> 
> 时间：2008-09-11T08:04:07.870

[这解释了它](http://en.csharp-online.net/const,_static_and_readonly)。总结： const 必须在声明时初始化，readonly 可以在构造函数上初始化（因此根据使用的构造函数具有不同的值）。

编辑：请参阅上面 Gishu 的问题以了解细微差别

* * *

## 回答 #6

> 赞同：44
> 
> 时间：2011-05-21T13:21:27.683

`const`: 不能在任何地方更改。

`readonly`: 这个值只能在构造函数中改变。在正常功能中无法更改。

* * *

## 回答 #7

> 赞同：36
> 
> 时间：2012-09-17T11:48:03.097

常量成员是在编译时定义的，不能在运行时更改。常量使用`const`关键字声明为字段，并且必须在声明时进行初始化。

```
public class MyClass
{
    public const double PI1 = 3.14159;
} 
```

`readonly`成员就像一个常数，因为它代表一个不变的值。不同之处在于，`readonly`成员可以在运行时在构造函数中进行初始化，也可以在声明时进行初始化。

```
public class MyClass1
{
     public readonly double PI2 = 3.14159;

     //or

     public readonly double PI3;

     public MyClass2()
     {
         PI3 = 3.14159;
     }
} 
```

**常量**

*   它们不能被声明为`static`（它们是隐式静态的）
*   常量的值在编译时评估
*   常量仅在声明时初始化

**只读**

*   它们可以是实例级的或静态的
*   该值在运行时评估
*   readonly 可以在声明中初始化，也可以通过构造函数中的代码初始化

* * *

## 回答 #8

> 赞同：33
> 
> 时间：2008-10-19T22:14:57.473

只读有一个小问题。可以在构造函数中多次设置只读字段。即使该值是在两个不同的链式构造函数中设置的，它仍然是允许的。

```
public class Sample {
    private readonly string ro;

    public Sample() {
        ro = "set";
    }

    public Sample(string value) : this() {
        ro = value; // this works even though it was set in the no-arg ctor
    }
} 
```

* * *

## 回答 #9

> 赞同：29
> 
> 时间：2008-09-11T08:07:46.910

const 是编译时常量，而 readonly 允许在运行时计算值并在构造函数或字段初始化程序中设置。因此，“const”始终是常量，但“readonly”在分配后是只读的。

C# 团队的 Eric Lippert 有[更多](https://docs.microsoft.com/en-us/archive/blogs/ericlippert/immutability-in-c-part-one-kinds-of-immutability)关于不同类型不变性的信息。

* * *

## 回答 #10

> 赞同：16
> 
> 时间：2009-01-31T11:42:05.920

[这是另一个链接](http://www.anotherchris.net/csharp/const-vs-readonly-in-csharp/)，展示了 const 如何不是版本安全的，或者与引用类型相关。

**摘要**：

*   const 属性的值是在编译时设置的，在运行时不能更改
*   const 不能标记为静态 - 关键字表示它们是静态的，与可以的只读字段不同。
*   const 不能是除了值（原始）类型之外的任何东西
*   readonly 关键字将该字段标记为不可更改。但是可以在类的构造函数中更改属性
*   readonly only 关键字也可以与 static 结合使用，使其行为方式与 const 相同（至少在表面上）。当您查看两者之间的 IL 时，存在显着差异
*   const 字段在 IL 中被标记为“literal”，而 readonly 是“initonly”

* * *

## 回答 #11

> 赞同：16
> 
> 时间：2016-01-12T17:42:57.993

**只读**：可以在运行时通过 Tor 更改值。但不是通过成员函数

**常量**：默认为静态。值不能从任何地方更改（Ctor、Function、运行时等无处）

* * *

## 回答 #12

> 赞同：12
> 
> 时间：2009-10-13T02:26:55.403

还有一个问题：只读值可以通过反射被“狡猾”的代码改变。

```
var fi = this.GetType()
             .BaseType
             .GetField("_someField", 
                       BindingFlags.Instance | BindingFlags.NonPublic);
fi.SetValue(this, 1); 
```

[我可以使用反射更改 C# 中的私有只读继承字段吗？](https://stackoverflow.com/questions/1401458/can-i-change-a-private-readonly-inherited-field-in-c-using-reflection/1401499#1401499)

* * *

## 回答 #13

> 赞同：10
> 
> 时间：2008-09-11T08:03:46.157

我相信`const`所有对象的值都是相同的（并且必须用文字表达式初始化），而`readonly`每个实例化的值可能不同......

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2008-09-17T13:02:06.403

它们都是常量，但在编译时也可以使用 const。这意味着差异的一个方面是您可以使用 const 变量作为属性构造函数的输入，但不能使用只读变量。

例子：

```
public static class Text {
  public const string ConstDescription = "This can be used.";
  public readonly static string ReadonlyDescription = "Cannot be used.";
}

public class Foo 
{
  [Description(Text.ConstDescription)]
  public int BarThatBuilds {
    { get; set; }
  }

  [Description(Text.ReadOnlyDescription)]
  public int BarThatDoesNotBuild {
    { get; set; }
  }
} 
```

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2008-10-02T20:43:37.180

我们办公室的一位团队成员就何时使用 const、static 和 readonly 提供了以下指导：

*   当你有一个在运行时可以知道的类型的变量（字符串字面量、整数、双精度、枚举......）你希望类的所有实例或消费者都可以访问值不应更改的位置时，请使用**const 。**
*   当您拥有希望类的所有实例或使用者都可以访问值可以更改的位置的数据时，请使用**静态。**
*   当您有一个在运行时无法知道的类型的变量（对象）时，使用**静态只读**，您希望类的所有实例或使用者都可以访问值不应更改的位置。
*   当您有一个实例级变量时使用**只读**，您将在创建对象时知道该变量不应更改。

最后一点： const 字段是静态的，但反之则不正确。

* * *

## 回答 #16

> 赞同：6
> 
> 时间：2018-09-08T06:39:10.003

## 常数

1.  const 关键字可以应用于字段或局部变量
2.  我们必须在声明时分配 const 字段
3.  没有分配内存因为 const 值在编译后嵌入在 IL 代码本身中。这就像找到所有出现的 const 变量并用它的值替换。所以编译后的 IL 代码将有硬编码的值来代替 const 变量
4.  C# 中的 const 默认是静态的。
5.  所有对象的值都是恒定的
6.  存在 dll 版本问题 - 这意味着每当我们更改公共 const 变量或属性时（实际上，理论上不应该更改），必须重新构建使用此变量的任何其他 dll 或程序集
7.  只有 C# 内置类型可以声明为常量
8.  const 字段不能作为 ref 或 out 参数传递

## 只读

1.  readonly 关键字仅适用于字段而不是局部变量
2.  我们可以在声明时或在构造函数中分配只读字段，而不是在任何其他方法中。
3.  为只读字段分配的动态内存，我们可以在运行时获取该值。
4.  Readonly 属于创建的对象，因此只能通过类的实例访问。要使其成为类成员，我们需要在 readonly 之前添加 static 关键字。
5.  该值可能因使用的构造函数而异（因为它属于类的对象）
6.  如果您将非原始类型（引用类型）声明为只读，则只有引用是不可变的，而不是它包含的对象。
7.  由于该值是在运行时获得的，因此只读字段/属性不存在 dll 版本控制问题。
8.  我们可以在构造函数上下文中将 readonly 字段作为 ref 或 out 参数传递。

* * *

## 回答 #17

> 赞同：6
> 
> 时间：2019-06-04T20:09:07.627

*   何时使用`const`或`readonly`

    *   `const`

        *   **编译**时常量：**绝对**常量，值在声明时设置，在 IL 代码本身中
    *   `readonly`

        *   **运行**时常量：可以通过配置文件在构造函数/init中设置`App.config`，但一旦初始化就无法更改

* * *

## 回答 #18

> 赞同：5
> 
> 时间：2008-09-11T08:41:51.527

标记为 const 的变量只不过是强类型的 #define 宏，在编译时 const 变量引用被内联文字值替换。因此，只能以这种方式使用某些内置的原始值类型。标记为只读的变量可以在运行时在构造函数中设置，并且它们的只读性也在运行时强制执行。有一些与此相关的较小的性能成本，但这意味着您可以将 readonly 用于任何类型（甚至是引用类型）。

此外，const 变量本质上是静态的，而 readonly 变量可以是特定于实例的，如果需要的话。

* * *

## 回答 #19

> 赞同：5
> 
> 时间：2014-12-15T13:01:10.900

C#.Net 中的 const 和 readonly 字段之间存在显着差异

const 默认是静态的，需要用常量值初始化，以后不能修改。构造函数中也不允许更改值。它不能用于所有数据类型。对于前日期时间。它不能与 DateTime 数据类型一起使用。

```
public const DateTime dt = DateTime.Today;  //throws compilation error
public const string Name = string.Empty;    //throws compilation error
public readonly string Name = string.Empty; //No error, legal 
```

readonly 可以声明为静态的，但不是必需的。声明时无需初始化。可以使用构造函数分配或更改其值。因此，它在用作实例类成员时具有优势。两个不同的实例化可能具有不同的只读字段值。对于前 -

```
class A
{
    public readonly int Id;

    public A(int i)
    {
        Id = i;
    }
} 
```

然后可以使用即时特定值初始化只读字段，如下所示：

```
A objOne = new A(5);
A objTwo = new A(10); 
```

在这里，实例 objOne 的只读字段值为 5，而 objTwo 的值为 10。使用 const 是不可能的。

* * *

## 回答 #20

> 赞同：3
> 
> 时间：2008-09-17T13:28:01.177

另一个*问题*。

由于 const 实际上只适用于基本数据类型，如果你想使用一个类，你可能会觉得“被迫”使用 ReadOnly。但是，当心陷阱！ReadOnly 意味着你不能用另一个对象替换这个对象（你不能让它引用另一个对象）。但是任何引用对象的进程都可以自由修改对象***内部***的值！

所以不要误以为 ReadOnly 意味着用户不能改变事情。C# 中没有简单的语法来防止类的实例化更改其内部值（据我所知）。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2011-02-20T12:29:26.910

A`const`必须是**硬编码的**，其中 as`readonly`可以**在类的构造函数**中设置。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2009-09-08T12:20:05.193

常量将作为文字值编译到使用者中，而静态字符串将用作对所定义值的引用。

作为练习，尝试创建一个外部库并在控制台应用程序中使用它，然后更改库中的值并重新编译它（无需重新编译消费者程序），将 DLL 放入目录并手动运行 EXE，您应该会发现常量字符串不会改变。

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2013-09-28T08:19:52.010

const 和 readonly 相似，但并不完全相同。const 字段是编译时常量，这意味着可以在编译时计算该值。只读字段允许在构造类型期间必须运行某些代码的其他场景。构造后，只读字段无法更改。

例如， const 成员可用于定义成员，例如：

```
struct Test
{
    public const double Pi = 3.14;
    public const int Zero = 0;
} 
```

因为像 3.14 和 0 这样的值是编译时常量。但是，请考虑您定义类型并希望提供一些预制实例的情况。例如，您可能想要定义一个 Color 类并为黑色、白色等常见颜色提供“常量”。使用 const 成员是不可能的，因为右侧不是编译时常量。可以使用常规静态成员执行此操作：

```
public class Color
{
    public static Color Black = new Color(0, 0, 0);
    public static Color White = new Color(255, 255, 255);
    public static Color Red = new Color(255, 0, 0);
    public static Color Green = new Color(0, 255, 0);
    public static Color Blue = new Color(0, 0, 255);
    private byte red, green, blue;

    public Color(byte r, byte g, byte b) {
        red = r;
        green = g;
        blue = b;
    }
} 
```

但是没有什么可以阻止 Color 的客户使用它，也许是通过交换 Black 和 White 值。不用说，这会引起 Color 类的其他客户的恐慌。“只读”功能解决了这种情况。通过在声明中简单地引入 readonly 关键字，我们保留了灵活的初始化，同时防止客户端代码乱七八糟。

```
public class Color
{
    public static readonly Color Black = new Color(0, 0, 0);
    public static readonly Color White = new Color(255, 255, 255);
    public static readonly Color Red = new Color(255, 0, 0);
    public static readonly Color Green = new Color(0, 255, 0);
    public static readonly Color Blue = new Color(0, 0, 255);
    private byte red, green, blue;

    public Color(byte r, byte g, byte b) {
        red = r;
        green = g;
        blue = b;
    }
} 
```

有趣的是，const 成员始终是静态的，而 readonly 成员可以是静态的，也可以不是静态的，就像常规字段一样。

可以为这两个目的使用单个关键字，但这会导致版本控制问题或性能问题。假设我们为此使用了一个关键字（const）并且开发人员写道：

```
public class A
{
    public static const C = 0;
} 
```

另一个开发人员编写了依赖于 A 的代码：

```
public class B
{
    static void Main() {
        Console.WriteLine(A.C);
    }
} 
```

现在，生成的代码可以依赖于 AC 是编译时常量这一事实吗？即，AC 的使用可以简单地用值 0 代替吗？如果您对此说“是”，那么这意味着 A 的开发人员无法更改 AC 的初始化方式——这在未经许可的情况下束缚了 A 的开发人员的手。如果你对这个问题说“不”，那么就会错过一个重要的优化。也许 A 的作者肯定 AC 将永远为零。const 和 readonly 的使用允许 A 的开发人员指定意图。这有助于更好的版本控制行为和更好的性能。

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2014-01-24T07:34:17.300

ReadOnly ：该值只会从类的构造函数中初始化一次。
const：可以在任何函数中初始化，但只能初始化一次

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2014-04-05T14:39:18.013

不同之处在于静态只读字段的值是在运行时设置的，因此对于程序的不同执行，它可以具有不同的值。但是，const 字段的值设置为编译时常量。

请记住：对于引用类型，在两种情况下（静态和实例），只读修饰符只会阻止您为该字段分配新引用。它特别不会使引用指向的对象不可变。

有关详细信息，请参阅有关此主题的 C# 常见问题解答：http: [//blogs.msdn.com/csharpfaq/archive/2004/12/03/274791.aspx](http://blogs.msdn.com/csharpfaq/archive/2004/12/03/274791.aspx)

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2015-04-09T21:09:25.080

常量变量在编译时声明和初始化。病房后无法更改该值。只读变量将仅从类的静态构造函数初始化。仅当我们要在运行时分配值时才使用只读。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2009-09-08T12:24:24.163

原则上; 您可以在运行时将静态只读字段的值分配给非常量值，而必须为 const 分配一个常量值。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2008-09-15T10:14:17.103

对人们上面所说的内容要补充一件事。如果您有一个包含只读值的程序集（例如只读 MaxFooCount = 4; ），您可以通过发送具有不同值的新版本的程序集（例如只读 MaxFooCount = 5;）来更改调用程序集看到的值

但是使用 const 时，它会在调用者编译时被折叠到调用者的代码中。

如果您已达到此 C# 熟练程度，您就可以阅读 Bill Wagner 的书《有效的 C#：50 种改进 C# 的具体方法》，它详细回答了这个问题（以及其他 49 件事）。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2008-09-15T21:30:19.740

主要区别在于Const 是#DEFINE 的C 等价物。该数字实际上被替换为 a-la 预编译器。Readonly 实际上被视为一个变量。

当您的项目 A 依赖于项目 B 中的公共常量时，这种区别尤其相关。假设公共常量发生了变化。现在您选择的 const/readonly 将影响项目 A 的行为：

const：项目 A 没有捕获新值（当然，除非它用新的 const 重新编译），因为它是用替换的常量编译的。

只读：项目 A 将始终向项目 B 询问其变量值，因此它将获取 B 中公共常量的新值。

老实说，我建议您对几乎所有内容都使用只读，除了真正的通用常量（例如 Pi、Inches_To_Centimeters）。对于任何可能改变的东西，我说使用只读。

希望这会有所帮助，艾伦。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2019-04-29T20:26:40.117

**Const**：应用程序生命周期内的绝对常数值。

**Readonly**：可以在运行时更改。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2021-04-24T16:11:04.637

readonly 字段的值可以更改。但是， const 字段的值不能更改。

在只读字段中，我们可以在声明时或在该类的构造函数中赋值。如果是常量，我们只能在声明时赋值。

Readonly 可以与 Static 修饰符一起使用，但常量不能与 static 一起使用。****************