# StackOverflow 问答 000763000-000763999

# cocoa - 在 Cocoa 中当前应用程序更改时收到通知

> ID：763002
> 
> 赞同：12
> 
> 时间：2009-04-18T06:09:41.763
> 
> 标签：cocoa

我希望在当前应用程序发生更改时收到通知。我看了看 NSWorkspace。只有当您自己的应用程序激活或失去活动时，它才会发送通知。我想了解每个应用程序。我怎样才能在 Cocoa 中做到这一点？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2010-12-17T19:30:59.230

如果您的目标是 10.6 或更高版本，则会收到通知：

```
// NSWorkspaceDidActivateApplicationNotification
[[[NSWorkspace sharedWorkspace] notificationCenter] addObserver:self selector:@selector(foremostAppActivated:) name:NSWorkspaceDidActivateApplicationNotification object:nil]; 
```

苹果文档：http: [//developer.apple.com/library/mac/DOCUMENTATION/Cocoa/Reference/ApplicationKit/Classes/NSWorkspace_Class/Reference/Reference.html#//apple_ref/doc/uid/20000391-SW97](http://developer.apple.com/library/mac/DOCUMENTATION/Cocoa/Reference/ApplicationKit/Classes/NSWorkspace_Class/Reference/Reference.html#//apple_ref/doc/uid/20000391-SW97)

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-18T06:59:52.253

谢谢杰森。Carbon Event Manager 中的 kEventAppFrontSwitched 是一个神奇的词

```
- (void) setupAppFrontSwitchedHandler
{
    EventTypeSpec spec = { kEventClassApplication,  kEventAppFrontSwitched };
    OSStatus err = InstallApplicationEventHandler(NewEventHandlerUPP(AppFrontSwitchedHandler), 1, &spec, (void*)self, NULL);

    if (err)
        NSLog(@"Could not install event handler");
}

- (void) appFrontSwitched {
    NSLog(@"%@", [[NSWorkspace sharedWorkspace] activeApplication]);
} 
```

和处理程序

```
static OSStatus AppFrontSwitchedHandler(EventHandlerCallRef inHandlerCallRef, EventRef inEvent, void *inUserData)
{
    [(id)inUserData appFrontSwitched];
    return 0;
} 
```

# objective-c - 如何停止 NSInvocationOperation？

> ID：763003
> 
> 赞同：9
> 
> 时间：2009-04-18T06:10:06.070
> 
> 标签：objective-c, cocoa, multithreading, pyobjc

我有一个 NSInvocationOperation 可以在后台下载并解析一系列 NSXMLDocuments 以响应我的 UI。

我停止调用操作的尝试是调用我的 NSOperationQueue 的 cancelAllOperations。但这似乎不会停止调用的执行。

关于我将如何解决这个问题的任何想法？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-08-11T21:03:42.130

**更新：**当我这样做时，仪器会显示大量泄漏。*谨慎行事！*我把这个留在这里，以防我真的在做某事，而其他人可以弄清楚如何克服泄漏障碍。

这是一个扭曲的想法，我在输入以下内容时正在重新尝试：

将操作设置为**NSInvocationOperation**的*initWithTarget:selector:object:**方法*的对象。假设你已经有一个**NSOperationQueue**（我们称之为*queue*）：

 ******```
NSInvocationOperation *operation = [NSInvocationOperation alloc];
operation = [operation initWithTarget:self selector:@selector(myOperation:) object:operation];
[queue addOperation:operation];
[operation release]; 
```

请注意，我们必须将 alloc 分解为它自己的调用。否则我们无法将*对象*设置为*操作*！

然后，在您的操作方法中，将对象投射回去并根据需要对*isCancelled*进行检查。例如：

```
 - (void)myOperation:(id)object {
    NSInvocationOperation *operation = (NSInvocationOperation *)object;
    if ([operation isCancelled]) return;
    ...
  } 
```

*确保您的选择器在initWithTarget:...*调用中以冒号结尾，因为您现在将传入一个对象。

到现在为止还挺好。现在，如果我可以强制*cancelAllOperations*，我会知道这是否真的有效。:)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2010-06-02T11:16:11.113

您需要检查 NSInvocationOperation isCancelled 是否为 YES。要在 NSInvocationOperation 中做到这一点，您可以使用 Key Value Observing：

在运行操作时将您的对象添加为 NSInvocationOperation isCancelled 观察者：

```
NSInvocationOperation *operation = [[NSInvocationOperation alloc] initWithTarget:<targetObj> selector:@selector(<targetMethod>) object:nil];
[operation addObserver:<targetObj> forKeyPath:@"isCancelled" options:NSKeyValueObservingOptionNew context:nil];
[operQueue addOperation:operation];
[operation release]; 
```

然后在 targetObj 中实现

```
- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary *)change context:(void *)context; 
```

观察 isCancelled 是否被 NSOperationQueue 的 cancelAllOperations 更改。您可以在此处设置私有标志，targetMethod 可以检查它并在需要时取消。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-05-01T20:39:38.493

上面的帖子很棒，但更直接地回答了原始问题：您似乎无法停止 NSInvocationOperation 对象，因为它不支持取消。你将不得不对它进行子类化。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-18T06:22:07.727

由您的`NSOperation`对象的实现来实际*停止*它正在做的事情，清理并在收到通知它已被取消时退出。您要取消队列上的所有操作的消息将导致队列停止将要运行的新操作出列，并将取消消息发送到当前正在运行的任何操作。

在您的操作的主要方法中，您应该在`isCancelled`实际取消时检查并处理该状态。

有关详细信息，请参阅线程编程指南中的[创建和管理操作对象](http://developer.apple.com/documentation/Cocoa/Conceptual/Multithreading/OperationObjects/OperationObjects.html#//apple_ref/doc/uid/10000057i-CH14-SW1)。

# powershell - 内部逻辑的Powershell问题

> ID：763008
> 
> 赞同：1
> 
> 时间：2009-04-18T06:13:29.213
> 
> 标签：powershell

我在 Powershell 1.0 中遇到了一件奇怪的事情，我不明白为什么 Powershell 会以这种方式做出反应。

情况：我在驱动器上创建了几个以字母 e 开头的 zip 文件：

现在我想将它们全部删除。但是我的 e: 驱动器上有更多的 zip 文件。所以我只想删除这个特定文件夹及其子文件夹中的那些。

我想为此使用的命令是：

```
PS E:\> Get-ChildItem -Path E:\Webdev\icons\ -Include *.zip -Recurse -Name -Force | Remove-Item -Force 
```

然而，在执行时，我得到了一堆错误，都说

> 找不到路径 E:\test.zip，因为它不存在。

确实，e 下没有 test.zip 这样的文件：它确实存在于我交给脚本的图标文件夹下。

解决方案是让我将目录更改为图标文件夹并在那里执行命令。

但这不合逻辑。我希望能够说出应该在哪个目录中删除文件，然后只在该目录中删除它们。为什么 Powershell 开始在当前目录中查找文件对我来说是个谜。

有人可以向我解释一下吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-18T06:33:21.473

如果您删除`Remove-Item`管道末尾的 ，您将看到返回的所有路径名都相对于您通过`-Path`参数输入的路径 to `Get-ChildItem`。因此`Remove-Item`，在当前目录中查找所有路径`Get-ChildItem`返回。

正如 capar 所建议的，`-Name`参数是这里的问题。删除它可确保您获得`Remove-Item`可以轻松找到文件的 File 对象：

```
Get-ChildItem -Path E:\Webdev\icons\ -Include *.zip -Recurse -Force | Remove-Item -Force 
```

将按预期工作。如果您可以使用对象解决问题，请不要降低到字符串级别:-)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T06:32:26.577

使用 -Name 时，Get-ChildItem 似乎返回搜索路径加上文件名之后的路径部分。然后将此文件名通过管道传送到使用当前目录和返回的文件名的 Remove-Item 中。

我使用 -FullName 尝试了该命令，但这似乎不起作用，因此您应该能够将该命令通过管道传输到 Select-Object 以指定全名并将其通过管道传输到 Remove-Item。

尝试：

```
 Get-ChildItem -Path E:\Webdev\icons -Include *.zip -Recurse | 
Select-Object -Property FullName | Remove-Item -Force 
```

# business-objects - 业务对象 - 无效数据提供者

> ID：763009
> 
> 赞同：1
> 
> 时间：2009-04-18T06:14:31.347
> 
> 标签：business-objects

我正在创建一个包含六个数据提供者的 BO 报告。由于某些原因，报表管理器中出现了一个幽灵数据提供者，它与另一个数据提供者同名，但其中没有对象。

我无法编辑/删除这个数据提供者（幽灵），因为它没有出现在数据管理器中。

任何建议，删除此数据提供者（幽灵）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T11:11:57.717

谢谢，已经解决了。

我所做的是，

我右键单击数据提供者，它就在这个数据提供者（幽灵）的下方，

我单击了编辑数据提供程序，它最终出现在一个新的查询面板中，其中没有对象，但是我希望其中有一些对象。

所以，我添加了一个对象并保存了查询。现在，Ghost 数据提供程序名称更改为（查询 10），并且开始出现在数据管理器中。

看起来像一个奇怪的错误。

# sql - 关于 SQL 中游标的错误

> ID：763013
> 
> 赞同：1
> 
> 时间：2009-04-18T06:20:54.607
> 
> 标签：sql, sql-server, sql-server-2005, tsql, cursors

以下是我的存储过程。它包含一个子查询

```
 Select StartTime From DrTimings Where DrID = @DrID 
```

如果此子查询返回多个值，则会出现错误。子查询返回多行。我想在光标中获取每个 @StartTime 和 @EndTime 。意味着我想“从 Doctor 获取下一个到 @StTime 和 @EndTime”

我可以在游标中使用两个参数吗？

```
ALTER PROCEDURE [dbo].SP_AFK_GetSlotsByDate
    @DrID int,
    @AppointmentDate Datetime 
AS
BEGIN

Declare @StartTime Datetime
Declare @EndTime Datetime
BEGIN
    SET @StartTime = (Select StartTime From DrTimings Where DrID = @DrID)
    SET @EndTime =  (Select EndTime From DrTimings Where DrID = @DrID)
END

DECLARE Doctor CURSOR FOR

Select StartTime  from  TimeList1 where StartTime>=@StartTime and StartTime<@EndTime

Declare @StTime datetime
Declare @SlotID int
Declare @AppointmentTime datetime

Declare @TempSlots Table (SlotID int , AppointmentTime datetime null) 

Insert into
@TempSlots
(
SlotID ,
AppointmentTime
)
values(
0,
Getdate()
)

open Doctor
    fetch next from Doctor into @StTime
        while @@fetch_status = 0
            Begin

Select  @SlotID= T.SlotId from TimeList1 T
where T.StartTime>=@StartTime and T.StartTime<@EndTime and
T.SlotId not in 
        (Select A.SlotId from AppointmentSheet A where A.AppointmentDate=@AppointmentDate)

Select @AppointmentTime = Convert(varchar,right(T.StartTime,7),131)+' - '+ Convert(varchar,right(T.EndTime,7),131) 
from TimeList1 T
where T.StartTime>=@StartTime and T.StartTime<@EndTime and
T.SlotId not in 
        (Select A.SlotId from AppointmentSheet A where A.AppointmentDate=@AppointmentDate)

        Update @TempSlots
        Set SlotID  = @SlotID,
                AppointmentTime=@AppointmentTime

    fetch next from Doctor into @StTime
           end
    close Doctor
    deallocate Doctor

    Select * From @TempSlots
END 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T06:34:09.943

只需以这种方式添加下一个变量：

```
fetch next from Doctor into @StTime, @EndTime 
```

光标的 select 语句应包含 EndTime 列：

```
select StartTime, EndTime 
from   TimeList1 
where  StartTime>=@StartTime and StartTime<@EndTime 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T06:35:43.497

虽然游标是遍历结果集的一种简单方法，但由于性能影响，*不推荐使用游标。*

如果我知道**TimeList1**表的结构以及它与 DrTimings 表的关系，我会推荐一个*不*使用游标的版本。

但是，在查看了您的 T-SQL 之后，我决定为您提供一个更新版本，以减少冗余并使用 JOINS 而不是子查询：

```
ALTER PROCEDURE [dbo].SP_AFK_GetSlotsByDate
(
    @DrID int,
    @AppointmentDate DateTime 
)
AS

DECLARE 
    @StartTime DateTime,
    @EndTime DateTime,
    @SlotID int,
    @AppointmentTime DateTime;

-- Retrieve the initial values for StartTime and EndTime
-- These values get overwritten by the cursor (?)
SELECT 
    @StartTime = StartTime,
    @EndTime = EndTime
FROM
    DrTimings
WHERE
    DrID = @DrID;

DECLARE @TempSlots TABLE
(
    SlotID int, 
    AppointmentTime datetime NULL
); 

-- Set default values
INSERT @TempSlots (SlotID,AppointmentTime)
VALUES (0, GETDATE());

DECLARE Doctor CURSOR FOR
SELECT 
    StartTime,
    EndTime  
FROM  
    TimeList1 
where 
    StartTime >= @StartTime AND 
    StartTime < @EndTime;

OPEN Doctor
FETCH NEXT FROM Doctor INTO @StartTime,@EndTime
WHILE @@FETCH_STATUS = 0
    BEGIN
        SELECT
            @SlotID = T.SlotId, 
            @AppointmentTime = CONVERT(varchar,RIGHT(T.StartTime,7),131)
                               + ' - ' + CONVERT(varchar,RIGHT(T.EndTime,7),131) 
        FROM 
            TimeList1 T
            LEFT JOIN AppointmentSheet A ON T.SlotId = A.SlotId
        WHERE 
            T.StartTime >= @StartTime AND 
            T.StartTime < @EndTime AND
            A.AppointmentDate = @AppointmentDate AND
            A.SlotId IS NULL;

        -- This table will always be updated to contain the latest values
        -- it will contain only one row
        UPDATE 
            @TempSlots
        SET
            SlotID  = @SlotID,
            AppointmentTime = @AppointmentTime;

        FETCH NEXT FROM Doctor INTO @StartTime,@EndTime
    END

CLOSE Doctor
DEALLOCATE Doctor

-- Return results
SELECT 
    SlotId,
    AppointmentTime
FROM 
    @TempSlots; 
```

**更新**：如果目的是获取 SlotId 和 AppointmentTime 的最新值，则甚至不需要迭代。

# ms-access - 是否可以在 Access 中创建递归查询？

> ID：763016
> 
> 赞同：19
> 
> 时间：2009-04-18T06:24:05.553
> 
> 标签：ms-access, recursion, hierarchy

我有一张`job`桌子

```
Id
ParentID
jobName
jobStatus 
```

根 ParentID 为 0。

是否可以在 Access 中创建查询以查找给定的根`job`？数据库是没有链接表的 MDB。Access版本是2003。一个`job`可以有好几级孙子深。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2010-04-23T18:36:08.730

可以在 Access 中创建查询来查找给定作业的根。不要忘记 VBA 函数的强大功能。您可以在 VBA 模块中创建递归函数，并将其结果用作查询中的输出字段。

例子：

```
Public Function JobRoot(Id As Long, ParentId As Long) As Long
   If ParentId = 0 Then
      JobRoot = Id
      Exit Function
   End If

   Dim Rst As New ADODB.Recordset
   Dim sql As String
   sql = "SELECT Id, ParentID FROM JobTable WHERE Id = " & ParentId & ";"
   Rst.Open sql, CurrentProject.Connection, adOpenKeyset, adLockReadOnly

   If Rst.Fields("ParentID") = 0 Then
      JobRoot = Rst.Fields("Id")
   Else
      JobRoot = JobRoot(Id, Rst.Fields("ParentID"))    ' Recursive.
   End If

   Rst.Close
   Set Rst = Nothing
End Function 
```

您可以通过使用查询构建器或仅在查询字段中输入带有参数的函数名称来从查询中调用此递归函数。

它将产生根。

（我承认 OP 现在已经一岁了，但是当每个人都说不可能的事情是可能的时，我不得不回答）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-18T06:36:18.207

不，不是。在 SServer 2005 之后的 SQL Server 中支持递归查询，但在 Access 中不支持。

如果您事先知道级别数，您可以编写一个查询，但它不会是一个递归查询。

在 SQL Server 中，为此使用 CTE（一个 SQL 扩展）：请参阅[http://blog.crowe.co.nz/archive/2007/09/06/Microsoft-SQL-Server-2005---CTE-Example- of-a-simple.aspx](http://blog.crowe.co.nz/archive/2007/09/06/Microsoft-SQL-Server-2005---CTE-Example-of-a-simple.aspx)

但是，常规 SQL 没有递归支持。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-18T08:24:39.553

您不能递归查询。

您可以进行任意数量的左连接，但您只能提升与连接数量相同的级别。

或者您可以使用[Celko 的“嵌套集模型”](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)来检索所有父母。这将需要修改您的表结构，以使插入和更新更加复杂。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2015-08-22T22:45:56.837

这不能在 Access 中使用纯 SQL 来完成，但是一点点 VBA 可以走很长一段路。

添加对**Microsoft 脚本运行时**的引用（**工具**->**引用...**）。

这假设 ID 是唯一的，并且没有循环：例如 A 的父节点是 B，但 B 的父节点是 A。

```
Dim dict As Scripting.Dictionary

Function JobRoot(ID As Long) As Long
    If dict Is Nothing Then
        Set dict = New Scripting.Dictionary
        Dim rs As DAO.Recordset
        Set rs = CurrentDb.OpenRecordset("SELECT ID, ParentID FROM Job", dbOpenForwardOnly, dbReadOnly)
        Do Until rs.EOF
            dict(rs!ID) = rs!ParentID
            rs.MoveNext
        Loop
        Set rs = Nothing

        Dim key As Variant
        For Each key In dict.Keys
            Dim possibleRoot As Integer
            possibleRoot = dict(key)
            Do While dict(possibleRoot) <> 0
                possibleRoot = dict(possibleRoot)
            Loop
            dict(key) = possibleRoot
        Next
    End If
    JobRoot = dict(ID)
End Function

Sub Reset() 'This needs to be called to refresh the data
    Set dict = Nothing
End Sub 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-07-27T15:42:18.230

好的，这是真正的交易。首先，您的查询的目标受众是什么……表格？报告？函数/过程？

表格：需要更新吗？在笨拙的情况下使用树视图控件它会很好地工作。报告：在打开事件中使用参数表单设置“老板工作”级别，然后在 vba 中处理递归，**并按所需顺序**用数据填充记录集。将报告记录集设置为此填充的记录集并处理报告。功能/程序：与上面报告中描述的数据加载几乎相同。通过代码，处理必要的“树行走”并将结果集以所需的顺序存储在记录集中，并根据需要进行处理。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-09-17T01:54:09.087

我在使用树视图结构时遇到了一个相关问题，当用户想要删除一个节点时，他想删除该树下的所有节点。孩子，孩子的孩子等。

递归的工作....

因此，要删除表中的数据以匹配树视图节点删除，请使用将删除节点的递归函数，并向下递归并删除所有子节点、孙节点等。

函数示例：

```
Public Sub RemoveChildKeys(MyKey)
' deletes passed key and removes all children and grandchildren ect etc of passed key recursively

   Dim TheDB As DAO.Database
   Dim TheTable As DAO.Recordset
   Dim MySql As String

   Set TheDB = CurrentDb

   MySql = "Select * from TblIndex WHERE [Parent]=" & MyKey & ";"
   Set TheTable = TheDB.OpenRecordset(MySql)

   While Not TheTable.EOF
     RemoveChildKeys (TheTable!Key)  ' <---- Calls itself
     TheTable.MoveNext
   Wend

   DoCmd.RunSQL "Delete * FROM TblIndex WHERE [Key]=" & MyKey  ' delete in table

End Sub 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-06-28T11:13:36.363

Zev 的贡献给了我很大的启发和学习。但是，需要对代码进行一些编辑。请注意，我的表名为“tblTree”。

```
Dim dict As Scripting.Dictionary

Function TreeRoot(ID As Long) As Long
    If dict Is Nothing Then
        Set dict = New Scripting.Dictionary ' Requires Microsoft Scripting Runtime
        Dim rs As DAO.Recordset
        Set rs = CurrentDb.OpenRecordset("tblTree", dbOpenForwardOnly, dbReadOnly)
        Do Until rs.EOF
            dict.Add (rs!ID), (rs!ParentID)
            rs.MoveNext
        Loop
        Set rs = Nothing
    End If

    TreeRoot = ID

    Do While dict(TreeRoot) <> 0    ' Note: short version for dict.item(TreeRoot)
        TreeRoot = dict(TreeRoot)
    Loop
End Function 
```

在相同的上下文中还有另一个有用的功能。如果孩子在任何嵌套级别中与提供的 ParentID 匹配，则“ChildHasParent”返回 true。

```
Function ChildHasParent(ID As Long, ParentID As Long) As Boolean
    If dict Is Nothing Then
        Set dict = New Scripting.Dictionary ' Requires Microsoft Scripting Runtime
        Dim rs As DAO.Recordset
        Set rs = CurrentDb.OpenRecordset("tblTree", dbOpenForwardOnly, dbReadOnly)
        Do Until rs.EOF
            dict.Add (rs!ID), (rs!ParentID)
            rs.MoveNext
        Loop
        Set rs = Nothing
    End If

    ChildHasParent = False

    Do While dict(ID) <> 0    ' Note: short version for dict.item(TreeRoot)
        ID = dict(ID)
        If ID = ParentID Then
            ChildHasParent = True
            Exit Do
        End If
    Loop
End Function 
```

# svn - 哪个版本控制系统最适合我？

> ID：763026
> 
> 赞同：5
> 
> 时间：2009-04-18T06:35:59.283
> 
> 标签：svn, version

我主要在windows上开发。

我是唯一的开发人员，唯一让我感到困惑的是，无论我去哪里，我怎么能随身携带它们。**我不希望它们在互联网上的某些服务器上**。因为我有时不得不离线工作好几天（或者有时连接速度很慢）。

大多数情况下，我将项目放在便携式设备上。因此，当我回到家时，我希望我的 PC 版本和便携式版本的项目能够与更改和历史记录同步。

对不起，如果它有点混乱。这是我能说的最好的了。

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-18T06:38:37.950

您可以将 SVN 存储库（它只是一个包含一些文件的文件夹）放在本地驱动器或外部硬盘驱动器上。我已经使用这样的东西很长一段时间了，而且效果非常好。

我无法评论它是否比 GIT 或任何其他 VCS 系统更好，但我发现 SVN 非常好。为其构建的文档和支持工具（例如：TortoiseSVN）非常好。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-18T07:10:05.083

[Mercurial](http://www.selenic.com/mercurial/wiki/)也很不错，甚至还有一个[Visual Studio 源代码控制提供程序](http://sharesource.org/project/visualhg/)（我从未尝试过，但它存在！）。它速度很快，它是免费的（就像在啤酒和语音中一样）并且它是分布式的，这意味着它应该很好地处理不同计算机之间的合并——甚至比 Subversion 更好，我敢打赌。它也被一些相当大的项目使用，包括 Mozilla、Sun 的 OpenSolaris 和 OpenJDK 团队，以及（很快）Python 项目本身。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-18T08:11:57.837

听起来像 GIT 或 Bzr 这样的分布式版本控制系统可能是您正在寻找的，您可以将所有代码保存在本地（在外部存储设备上设置存储库），但您仍然可以选择分支和合并。另外，如果您确实发现自己需要与其他开发人员共享，他们只需获取您的一个分支的本地副本即可。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-18T07:07:18.927

+1 为 nickf 的推荐。

有两件事可以让它更容易开始（无论如何对于 Windows）：

两者一键安装： http: [//svn1clicksetup.tigris.org/](http://svn1clicksetup.tigris.org/)

视觉 SVN 服务器： http: [//www.visualsvn.com/server/](http://www.visualsvn.com/server/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-18T09:38:38.813

Git 是您正在寻找的。

1.  分发 - 您提到您希望即使在网络中断时也能够进行版本控制。

2.  同步 - 与 CVS 或 SVN 等 SCM 不同，在 git 中合并是无痛的。

我在 Windows 上使用 git，它对我很有用。

# web-analytics-tools - 服务器端分析

> ID：763028
> 
> 赞同：8
> 
> 时间：2009-04-18T06:37:38.420
> 
> 标签：web-analytics-tools

有人知道任何服务器端分析工具吗？

我听说过 awstats、webalizer 和 urchin。最后一个很贵。

awstats/webalizer 真的是唯一的免费工具吗？分析市场似乎存在一个令人难以置信的漏洞，客户端市场如此饱和，而服务器端......不是。

建议？谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T07:20:03.140

据我所知，这些是您的选择。

[http://en.wikipedia.org/wiki/List_of_web_analytics_software](http://en.wikipedia.org/wiki/List_of_web_analytics_software)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-28T14:48:34.463

查看[http://piwik.org/](http://piwik.org/)。这是一个基于 PHP/MySQL 的系统，您可以安装在自己的服务器上，然后像使用 Google Analytics 一样嵌入标签。不同之处在于数据是发送到您自己的服务器而不是 Google 的。

在这里的另一篇文章中找到了它（虽然现在找不到它的链接）。

# php - 制作实时时钟 javascript

> ID：763032
> 
> 赞同：5
> 
> 时间：2009-04-18T06:38:35.220
> 
> 标签：php, javascript

有谁知道如何让实时javascript时间运行..

我有这个 php 代码

```
 $expiredate = date('d m Y G:i:s', $rdate1);
    $f_ex_date = explode(" ", $expiredate);
    $f_ex_time = explode(":", $expiredate);
    $_endDate = mktime($f_ex_date[0],$f_ex_date[1],$f_ex_date[2],$f_ex_date[1],$f_ex_date[0],$f_ex_date[2]);
    $time = $_endDate - time();
    $days = floor($time/86400);
    $hours = floor(($time-($days*86400))/3600);
    $mins = floor (($time-($days*86400)-($hours*3600))/60);
    $secs = floor ($time-($days*86400)-($hours*3600)-($mins*60));

   echo "Your account going to be expired in <span style=\"color: #C11B17;font-family:arial;font-size: 16px;\">".$days."</span> Days <span style=\"color: #C11B17;font-family:arial;font-size: 16px;\">".$hours."</span> Hours <span style=\"color: #C11B17;font-family:arial;font-size: 16px;\">".$mins."</span> Minutes <span style=\"color: #C11B17;font-family:arial;font-size: 16px;\">".$secs."</span> Seconds"; 
```

有没有可能让它像现场直播一样？？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-18T07:37:16.187

这是如何做到的。[**工作演示**](http://www.rootspot.com/stackoverflow/timer.php)。

首先，在 HTML 文档的顶部：

```
.datetime {
    color: #C11B17;
    font-family:arial;
    font-size: 16px;
} 
```

我们这样做是为了稍微清理一下我们的 HTML 代码：

```
$rdate1 = 1240550032; // Fri, 24 Apr 2009 05:13:52 GMT
$expiredate = date('d m Y G:i:s', $rdate1);
$time = $rdate1 - time();
$days = floor($time/86400);
$hours = floor(($time-($days*86400))/3600);
$mins = floor(($time-($days*86400)-($hours*3600))/60);
$secs = floor($time-($days*86400)-($hours*3600)-($mins*60));

printf("
    Your account is going to expire in
    <span class='datetime' id='days'>%s</span> Days
    <span class='datetime' id='hours'>%s</span> Hours
    <span class='datetime' id='minutes'>%s</span> Minutes
    <span class='datetime' id='seconds'>%s</span> Seconds
", $days, $hours, $mins, $secs); 
```

我不太确定您采取的中间步骤来自哪里，但上面的代码让我知道`$rdate1`（可能是 unix 时间戳）和`time()`.

最后，我们可以用 Javascript 做这样的事情来更新页面加载后的时间：

```
addEvent(window, 'load', function() {
    var eDays = document.getElementById('days');
    var eHours = document.getElementById('hours');
    var eMinutes = document.getElementById('minutes');
    var eSeconds = document.getElementById('seconds');
    var timer;
    timer = setInterval(function() {
        var vDays = parseInt(eDays.innerHTML, 10);
        var vHours = parseInt(eHours.innerHTML, 10);
        var vMinutes = parseInt(eMinutes.innerHTML, 10);
        var vSeconds = parseInt(eSeconds.innerHTML, 10);

        vSeconds--;
        if(vSeconds < 0) {
            vSeconds = 59;
            vMinutes--;
            if(vMinutes < 0) {
                vMinutes = 59;
                vHours--;
                if(vHours < 0) {
                    vHours = 23;
                    vDays--;
                }
            }
        } else {
            if(vSeconds == 0 &&
               vMinutes == 0 &&
               vHours == 0 &&
               vDays == 0) {
                clearInterval(timer);
            }
        }
        eSeconds.innerHTML = vSeconds;
        eMinutes.innerHTML = vMinutes;
        eHours.innerHTML = vHours;
        eDays.innerHTML = vDays;
    }, 1000);
});

function addEvent( obj, type, fn ) {
  if ( obj.attachEvent ) {
    obj['e'+type+fn] = fn;
    obj[type+fn] = function(){obj['e'+type+fn]( window.event );}
    obj.attachEvent( 'on'+type, obj[type+fn] );
  } else
    obj.addEventListener( type, fn, false );
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-18T06:46:21.583

使用一点 JavaScript 在客户端上是可行的。如果不使用 jQuery 之类的框架，这在此处将有微不足道的帮助，基本方法将类似于以下内容：

*   设置事件处理程序以每秒触发一次

在事件处理程序中：

*   检索当前日期和时间并根据需要对其进行格式化
*   用新值更新另一个元素的内容

作为一个具体示例，以下函数将使用命名元素设置简单的日期/时间更新：

```
function clock( id ) {
    var target = document.getElementById( id );
    if( target ) {
        var callback = function() {
            var datetime = new Date().toLocaleString();
            target.innerHTML = datetime;
        };
    callback();
        window.setInterval( callback, 1000 );
    }
} 
```

注意[`new Date().toLocaleString()`](https://developer.mozilla.org/en/Core_JavaScript_1.5_Reference/Global_Objects/Date#Methods_2)用于检索和格式化当前日期/时间；此外，使用[`window.setInterval()`](https://developer.mozilla.org/en/DOM/window.setInterval)设置回调以每秒触发一次。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T06:43:27.317

PHP，因为它是*[服务器端的](http://en.wikipedia.org/wiki/Server-side_scripting)*，所以不能活。您必须进行日期操作（至少是更改的内容）并使用 JavaScript 更新 DOM，这是*[client-side](http://en.wikipedia.org/wiki/Client-side_scripting)*。

史蒂夫

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-01-18T17:04:41.103

[JS-Clock](http://thiago-cavalcanti.github.com/JS-Clock/)是实时时钟的最佳解决方案。它的迷你 JS 版本只有 4 KB。我推荐这个。

# c# - 确定一个具体的值或表达式是否通过？

> ID：763034
> 
> 赞同：1
> 
> 时间：2009-04-18T06:38:45.843
> 
> 标签：c#, linq, lambda

无论如何确定一个值是否作为参考传递，例如。x.Age 或特定值。例如。20个这样。

```
value(x => x.Age) 
```

或者

```
value(x => 20) 
```

干杯

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T06:58:25.097

如果 value() 采用 Func<,> 或其他委托类型，那么您基本上无法分辨。该函数已编译：充其量，您可以使用反射查看 IL 并尝试启发式地找出它。

如果 value() 接受一个表达式，那么您可以遍历表达式树。这在一般情况下可能很复杂，但对于像您这样的简单情况，查找 MemberExpression 与 ConstantExpression 就足够了。

# sql-server - 需要优化：选择特定编号的记录

> ID：763035
> 
> 赞同：0
> 
> 时间：2009-04-18T06:39:18.807
> 
> 标签：sql-server

我有一张有很多行的表。它被索引。我经常做的一个操作是从这个表中选择一个随机记录。为此，我使用以下 SQL 语句：

```
SELECT TOP 1 * 
FROM 
    ( SELECT TOP (@RecNo) * FROM Table ORDER BY Date ASC ) AS subquery1 
ORDER BY 
    Date DESC ; 
```

其中@RecNo 是随机数。查询需要花费大量时间来运行。有什么想法可以在这里优化吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T06:41:15.590

尝试按集群主键排序。`ORDER BY`或者在您的子句中包含集群主键。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T05:50:06.693

由于您使用的是 SQL 2005，请尝试使用 ROW_NUMBER() 函数：

[http://msdn.microsoft.com/en-us/library/ms186734.aspx](http://msdn.microsoft.com/en-us/library/ms186734.aspx)

基本上是这样的：

```
SELECT * FROM Table WHERE (ROW_NUMBER() OVER Date ASC) = @RecNo 
```

您可能需要使用子查询或 CTE 来使用`ROW_NUMBER()`谓词中的值。

我不知道这最终是否会比这种`NEWID()`方法更快。`ROW_NUMBER()`取决于 SQL在找到它要查找的值时是否会短路操作。最坏的情况下，它会`ROW_NUMBER()`为每一行生成一个，最好的情况下，它会在找到该行后立即停止（*可能*是第一行......）。

为每一行生成 也可能`ROW_NUMBER()`比生成 GUID 或以其他方式对整个表进行排序要快得多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T06:48:33.870

你真正想要完成什么？我想你只想得到一个随机行。最简单的方法是

```
 SELECT TOP 1 * FROM Table ORDER BY newid() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T06:03:46.037

你对桌子有多少控制权？

你能介绍一个新的“row_id”列吗？然后在新列上建立索引，只需执行以下操作：

```
SELECT * FROM Table WHERE row_id = @RecNo 
```

# multithreading - 线程名称——你什么时候需要知道它们？

> ID：763041
> 
> 赞同：6
> 
> 时间：2009-04-18T06:45:42.910
> 
> 标签：multithreading

不久前，我创建了一个关于[线程命名约定](https://stackoverflow.com/questions/149932/naming-conventions-for-threads)的 SO 问题。问题类似于，“你应该如何命名一个线程？”

回首往事，线程名称仅在您必须阅读线程名称时才重要。

您能否提供真实世界的示例，说明您何时必须检查线程并根据它们的名称来辨别它们？这与平台/框架无关。

你是如何（在什么环境下）这样做的？

换句话说，在什么情况下您必须解决问题并且必须**按名称**检查线程，您是如何完成的？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T07:05:40.693

在 Java 中查找连接泄漏时，有时跟踪对象以查看它是由哪个线程创建的很有用。在我们的例子中，它是 Finalizer 线程。这使我们得出结论，事情正在被垃圾收集，但没有足够快地完成。即一堆东西正在等待最终确定，这一切都在一个线程中完成。

结果，我们吸取了关于不依赖 Finalize 的教训。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T11:38:28.887

这个问题目前没有明显的原因被标记为“linux”......无论如何，如果您使用的是 Visual Studio，线程名称会出现在调试器的线程窗口中，所以如果您正在调试具有大量线程的应用程序，这个名字使得在调试器的这个窗口中找到“你关心的线程”变得超级容易。

简而言之，我只是使用它，因为它与调试器工具很好地交互。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T08:51:57.427

有时在 Java EE 应用程序服务器上，能够跟踪单个线程上的所有活动很有用，这些活动通常由池子系统赋予适当的名称，例如。'http-25'、'http-12' 等等。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T07:15:04.807

对生产服务器进行线程转储以确定挂起/减速的原因通常*非常有用。*在这种情况下，通常会有大量不同角色的线程。在 Java 应用程序中，您可能正在查看应用程序用来建立性能保证的石英线程和可能的不同线程池。可以说，线程池名称通常比实际线程名称更重要，但如果您尝试识别死锁线程，则各个线程名称也可能很重要。由于线程通常具有指示其角色的名称，因此有助于理解正在发生的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-10-30T08:02:53.127

我正在使用线程名称来帮助调试使用 Orocos 工具链编写的多线程机器人控制应用程序的实时性能。每个组件都在一个单独的线程中运行，我将编写 shell 脚本，使用通用工具来管理线程的优先级以及它们运行在哪些内核上（因此，间接地，哪些线程抢占了其他线程，以及何时）。这样做的好处是您可以在程序运行时调整程序的性能，如果您还设置了连续输出的性能指标，这将特别有用。

# javascript - 删除？来自 document.location.search

> ID：763044
> 
> 赞同：11
> 
> 时间：2009-04-18T06:48:26.743
> 
> 标签：javascript, replace

如何将 document.location.search 放入不带“？”的变量中 是否有一个简单的正则表达式，或者我可以忽略第一个字符？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-18T06:55:38.957

没问题

```
window.location.search.substr(1); 
```

## 编辑

第一次我什至没有考虑，但是您应该参考window.location，而不是document.location。它具有最广泛的浏览器支持。

[https://developer.mozilla.org/En/Document.location#Notes](https://developer.mozilla.org/En/Document.location#Notes)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T06:51:40.493

您可以简单地替换“？” 带有空字符串的字符：

```
var searchWithoutQuestionMark = document.location.search.replace('?', ''); 
```

史蒂夫

# asp.net-mvc - 提交按钮不适用于在动态局部视图中呈现的 ajax 表单

> ID：763047
> 
> 赞同：0
> 
> 时间：2009-04-18T06:48:50.330
> 
> 标签：asp.net-mvc, asp.net-ajax

我有一些 jQuery 加载部分视图并将其插入到 DOM 中。到目前为止，一切都很好。

但是现在我对呈现的用户控件进行了一些更改，以包含一个 Ajax 表单。但是，此表单的提交按钮似乎不会触发 Ajax 调用。据我所知，它根本没有做任何事情。我在控制器中的断点也没有被触发。

如果我使用链接并添加 onclick="submit()"，表单将被提交，并在我的控制器中触发操作，但当然，这是一个普通的帖子，而不是 ajax 帖子。

形式如下：

```
<% using(Ajax.BeginForm("actionName", new AjaxOptions {
           OnSuccess = "updatePanel" })) { %>
  <!-- form elements in here -->
  <input type="submit" />
<% } %> 
```

我刚刚发现，如果我将 OnSuccess 更改为 OnComplete，它会发布帖子，我完全不明白。

但是，即使将其更改为 OnComplete 可以正常工作，但我在 microsoft ajax 库中的某个位置出现异常：

```
try {
  a._webRequest.completed(Sys.EventArgs.Empty)
} finally {
  if (a._xmlHttpRequest!=null) {
    a._xmlHttpRequest.onreadystatechange = Function.emptyMethod;
    a._xmlHttpRequest = null
  }
} 
```

光标在 finally 的末尾高亮显示，表示 Object 没有此属性或方法。

我想我可以忍受它；当它不断在 MicrosoftAjax.js 中抛出异常并在 VS 中触发调试器时，这只是令人讨厌的测试内容。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T16:06:55.697

如果您使用的是 OnSuccess，您是否也不需要 UpdateTarget 这就是为什么它一开始没有触发？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T19:53:05.717

您确定您引用的是 Microsoft AJAX JS 文件吗？

你需要确保你有...

```
<script src="../../Scripts/MicrosoftAjax.js" type="text/javascript"></script>
<script src="../../Scripts/MicrosoftMvcAjax.js" type="text/javascript"></script> 
```

在您网站的某个地方。默认情况下，我认为 ASP.NET MVC 项目不会添加这些 JS 引用。

# apache-flex - 如何在 FLEX 中通过 URL 发送值

> ID：763049
> 
> 赞同：0
> 
> 时间：2009-04-18T06:52:24.283
> 
> 标签：apache-flex, send, dataprovider

我想从客户端发送带有 flex 的 URL 的当前日期，并希望在服务器上获取它。我正在使用 MXML 和 ActonScript。

请帮我。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T09:45:33.027

[这](http://blog.flexexamples.com/2007/10/29/passing-parameters-to-an-httpservice/)`HTTPService`是一个如何使用'`send()`方法传递对象的示例。只需包装您的`Date`对象并通过`send()`调用传递它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T07:11:46.357

你可以看看

[http://livedocs.adobe.com/flex/3/html/help.html?content=Part4_data_access_1.html](http://livedocs.adobe.com/flex/3/html/help.html?content=Part4_data_access_1.html)

并从那里阅读以查看您的 kinf od 请求（HTML、XML）需要什么。

简而言之，您必须拥有一些数据服务（fe mx:HTTPService）和适当的方法（发送）并将它们与您的控件连接起来

编辑：系统时间： http://livedocs.adobe.com/flex/3/html/help.html?content= [08_Dates_and_times_3.html](http://livedocs.adobe.com/flex/3/html/help.html?content=08_Dates_and_times_3.html)

# asp.net - 如何在每次刷新页面时旋转一行文本？

> ID：763056
> 
> 赞同：0
> 
> 时间：2009-04-18T06:59:14.983
> 
> 标签：asp.net, asp.net-mvc

目前，Reddit 已关闭。每次您访问它时，它都会显示一个徽标，并在其下方显示一条有趣的消息。每次刷新页面时，它都会显示一条新消息。

![替代文字](https://imgur.com/NS87G.png)

我怎么能写一些简单的东西~旋转~（不是随机的）每次刷新页面上的一行文本？

我正在使用 ASP.NET MVC，但如果有针对此问题的 JavaScript 解决方案也可以。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T08:34:17.330

你可以这样写：

对于 javascript，只需使用 Andy White 发布的链接并将调用替换为`Math.floor(7*Math.random())`获取/设置 cookie 值。您可以在 google 上找到现成的 javascript 函数来读取和写入 cookie。

对于 asp.net mvc，代码不会有太大差异，您只需要寻找可以轻松操作 cookie 的函数，因为它们是内置的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-19T01:57:04.297

将您的消息加载到数组或某种可通过索引访问的集合中。

类似的东西（我没有验证所有语法）：

```
string getQuote(){
 //Load collection of lines
  ArrayList quotes = getQuotesData();
  int quoteCount = quotes.Count;

 // Set session or application variable to some number
  int counter;
  if( !Integer.parse( Session("counter"), counter ) ) { counter = 0; }
  if( counter > quoteCount ) { counter = 0; }

  return quotes[counter];
} 
```

另外，我确信在 javascript 中也有类似的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T07:01:18.363

以下是如何在 javascript 中执行此操作的示例：

[http://www.webdevelopersnotes.com/tips/html/random_text_display_using_javascript_1.php3](http://www.webdevelopersnotes.com/tips/html/random_text_display_using_javascript_1.php3)

# php - 如何用另一个唯一 URL 替换字符串中的每个 URL？

> ID：763064
> 
> 赞同：2
> 
> 时间：2009-04-18T07:07:08.787
> 
> 标签：php, regex, preg-replace, replace

我有以下内容：

```
$reg[0] = '`<a(\s[^>]*)href="([^"]*)"([^>]*)>`si';
$reg[1] = '`<a(\s[^>]*)href="([^"]*)"([^>]*)>`si';
$replace[0] = '<a$1href="http://www.yahoo.com"$3>';
$replace[1] = '<a$1href="http://www.live.com"$3>';
$string = 'Test <a href="http://www.google.com">Google!!</a>Test <a href="http://www.google.com">Google!!2</a>Test';
echo preg_replace($reg, $replace, $string); 
```

结果是：

```
Test <a href="http://www.live.com">Google!!</a>Test <a href="http://www.live.com">Google!!2</a>Test 
```

我希望最终得到（不同之处在于第一个链接）：

```
Test <a href="http://www.yahoo.com">Google!!</a>Test <a href="http://www.live.com">Google!!2</a>Test 
```

这个想法是用唯一的其他 URL 替换字符串内链接中的每个 URL。这是一个通讯系统，我想跟踪人们点击了什么，所以 URL 将是一个“假” URL，在记录点击后他们将被重定向到真实 URL。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T07:34:21.140

问题是您的第一个替换字符串将与第二个搜索模式匹配，有效地用第二个替换字符串覆盖第一个替换字符串。

除非您能以某种方式将“修改过的”链接与原始链接区分开来，以免它们被其他表达式捕获（也许通过添加额外的 HTML 属性？），否则我认为您无法真正通过一次`preg_replace()`调用来解决这个问题. 想到的一种可能的解决方案（除了正则表达式中的差异）是使用[`preg_match_all()`](http://php.net/preg-match-all)，因为它会给你一个匹配的数组来使用。然后，您可以通过遍历数组并`str_replace()`在每个匹配的 URL 上运行 a 来使用跟踪 URL 对匹配的 URL 进行编码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-19T09:43:35.267

I do not know, if I'd understood it right. But I'd written following snippet: The regex matches some hyperlinks. Then it loops thru the result and compares the text nodes against the hyperlink references. When a text node is found in a hyperlink reference, then it extends the matches by inserting a trackback sample link with a unique key.

**UPDATE** The snippets finds all hyperlinks:

1.  find links
2.  build track back link
3.  find position of each found link (matches[3]) and set a template tag
4.  replace templatetags by trackback links Each link position is unique.

$string = '<h1>Newsletter Name</h1> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec lobortis, ligula <a href="http://bar.com">sed sollicitudin</a> dignissim, lacus dolor suscipit sapien, <a href="http://foo.com">bar.com</a> ipsum ligula non tortor. Quisque sagittis sodales elit. Mauris dictum blandit lacus. Mauris consequat <a href="http://last.fm">laoreet lacus</a>.</p> <h1>Newsletter Name</h1> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec lobortis, ligula <a href="http://bar.com">sed sollicitudin</a> dignissim, lacus dolor suscipit sapien, <a href="http://foo.com">bar.com</a> ipsum ligula non tortor. Quisque sagittis sodales elit. Mauris dictum blandit lacus. Mauris consequat <a href="http://last.fm">laoreet lacus</a>.</p> <h1>Newsletter Name</h1> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec lobortis, ligula <a href="http://bar.com">sed sollicitudin</a> dignissim, lacus dolor suscipit sapien, <a href="http://foo.com">bar.com</a> ipsum ligula non tortor. Quisque sagittis sodales elit. Mauris dictum blandit lacus. Mauris consequat <a href="http://last.fm">laoreet lacus</a>.</p> ';

```
$regex = '<[^>]+>(.*)<\/[^>]+>';
preg_match_all("'<a\s+href=\"(.*)\"\s*>(.*)<\/[^>]+>'U",$string,$matches);

$uniqueURL = 'http://www.yourdomain.com/trackback.php?id=';

foreach($matches[2] as $k2 => $m2){
    foreach($matches[1] as $k1 => $m1){
        if(stristr($m1, $m2)){
                $uniq = $uniqueURL.md5($matches[0][$k2])."_".rand(1000,9999);
                $matches[3][$k1] = $uniq."&refLink=".$m1;
        }
    }
}

foreach($matches[3] as $key => $val) {

    $startAt = strpos($string, $matches[1][$key]);
    $endAt= $startAt + strlen($matches[1][$key]);

    $strBefore = substr($string,0, $startAt);
    $strAfter = substr($string,$endAt);

    $string = $strBefore . "@@@$key@@@" .$strAfter;

}
foreach($matches[3] as $key => $val) {
        $string = str_replace("@@@$key@@@",$matches[3][$key] ,$string);
}
print "<pre>";
echo $string; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T08:46:27.957

我不擅长正则表达式，但如果你正在做的只是用一个跟踪点击并重定向用户的内部 URL 替换外部 URL（即不是你的站点/应用程序的一部分），那么它应该很容易构造一个仅匹配外部 URL 的正则表达式。

因此，假设您的域是`foo.com`，那么您只需要创建一个正则表达式，它只匹配不包含以 . 开头的 URL 的超链接`[http://foo.com](http://foo.com)`。现在，正如我所说，我对正则表达式很不好，但这是我最好的尝试：

```
$reg[0] = '`<a(\s[^>]*)href="(?!http://foo.com)([^"]*)"([^>]*)>`si'; 
```

编辑：如果您还想跟踪对内部 URL 的点击，那么只需替换`[http://foo.com](http://foo.com)`为您的重定向/跟踪页面的 URL，例如`[http://foo.com/out.php](http://foo.com/out.php)`.

我将通过一个示例场景来说明我在说什么。假设您有以下时事通讯：

```
<h1>Newsletter Name</h1>
<p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec lobortis,
ligula <a href="http://bar.com">sed sollicitudin</a> dignissim, lacus dolor
suscipit sapien, <a href="http://foo.com">eget auctor</a> ipsum ligula
non tortor. Quisque sagittis sodales elit. Mauris dictum blandit lacus.
Mauris consequat <a href="http://last.fm">laoreet lacus</a>.</p> 
```

出于本练习的目的，搜索模式将是：

```
// Only match links that don't begin with: http://foo.com/out.php
`<a(\s[^>]*)href="(?!http://foo.com/out\.php)([^"]*)"([^>]*)>`si 
```

这个正则表达式可以分解为 3 个部分：

1.  `<a(\s[^>]*)href="`
2.  `(?!http://foo.com/out\.php)([^"]*)`
3.  `"([^>]*)>`

在搜索的第一遍，脚本将检查：

```
<a href="http://bar.com"> 
```

此链接满足正则表达式的所有 3 个组件，因此 URL 存储在数据库中并替换为`[http://foo.com/out.php?id=1](http://foo.com/out.php?id=1)`.

在搜索的第二遍中，脚本将检查：

```
<a href="http://foo.com/out.php?id=1"> 
```

此链接匹配 1 和 3，但不匹配 2。因此搜索将转到下一个链接：

```
<a href="http://foo.com"> 
```

此链接满足正则表达式的所有 3 个组件，因此 URL 存储在数据库中并替换为`[http://foo.com/out.php?id=2](http://foo.com/out.php?id=2)`.

在搜索的第 3 遍中，脚本将检查前 2 个（已替换）链接，跳过它们，然后找到与时事通讯中最后一个链接的匹配项。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-19T20:56:26.493

Until PHP 5.3 where you can just create a function on the spot, you have to use either create_function (which I hate) or a helper class.

```
/**
 * For retrieving a new string from a list.
 */
class StringRotation {
    var $i = -1;
    var $strings = array();

    function addString($string) {
        $this->strings[] = $string;
    }

    /**
     * Use sprintf to produce result string
     * Rotates forward
     * @param array $params the string params to insert
     * @return string
     * @uses StringRotation::getNext()
     */
    function parseString($params) {
        $string = $this->getNext();
        array_unshift($params, $string);
        return call_user_func_array('sprintf', $params);
    }

    function getNext() {
        $this->i++;
        $t = count($this->strings);
        if ($this->i > $t) {
            $this->i = 0;
        }
        return $this->strings[$this->i];
    }

    function resetPointer() {
        $this->i = -1;
    }
}

$reg = '`<a(\s[^>]*)href="([^"]*)"([^>]*)>`si';
$replaceLinks[0] = '<a%2$shref="http://www.yahoo.com"%4$s>';
$replaceLinks[1] = '<a%2$shref="http://www.live.com"%4$s>';

$string = 'Test <a href="http://www.google.com">Google!!</a>Test <a href="http://www.google.com">Google!!2</a>Test';

$linkReplace = new StringRotation();
foreach ($replaceLinks as $replaceLink) {
    $linkReplace->addString($replaceLink);
}

echo preg_replace_callback($reg, array($linkReplace, 'parseString'), $string); 
```

# c++ - C++ 友元类

> ID：763068
> 
> 赞同：6
> 
> 时间：2009-04-18T07:08:52.747
> 
> 标签：c++, coding-style

我意识到有很多关于 C++ 中友元类的问题。不过，我的问题与特定情况有关。鉴于以下代码，以这种方式使用朋友是否合适？

```
class Software
{
    friend class SoftwareProducer;

    SoftwareProducer* m_producer;
    int m_key;
    // Only producers can produce software
    Software(SoftwareProducer* producer) : m_producer(producer) { }

public:
    void buy()
    {
        m_key = m_producer->next_key();
    }
};

class SoftwareProducer
{
    friend class Software;

public:
    Software* produce()
    {
        return new Software(this);
    }

private:
    // Only software from this producer can get a valid key for registration
    int next_key()
    {
        return ...;
    }
}; 
```

谢谢，

最好的祝福，

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-18T07:15:59.187

当然，这是完全合理的。基本上你所做的与工厂模式非常相似。我认为这没有问题，因为您的代码似乎暗示每个 Software 对象都应该有一个指向其创建者的指针。

不过，通常您可以避免使用像 SoftwareProducer 这样的“管理器”类，而只在 Software 中使用静态方法。因为似乎可能只有一个 SoftwareProducer。可能是这样的：

```
class Software {
private:
    Software() : m_key(0) { /* whatever */ }
public:
    void buy() { m_key = new_key(); }
public:
    static Software *create() { return new Software; }
private:
    static int new_key() { static int example_id = 1; return example_id++; }
private:
    int m_key;
}; 
```

然后你可以这样做：

```
Software *soft = Software::create();
soft->buy(); 
```

当然，如果您确实计划拥有多个 SoftwareProducer 对象，那么您所做的似乎是合适的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T07:15:41.730

这对我来说似乎完全合理。

查看工厂：从 Bruce Eckel 的[Thinking in C++中](http://www.codeguru.com/cpp/tic/tic_c.shtml)[封装对象创建](http://www.codeguru.com/cpp/tic/tic0289.shtml)，以了解有关朋友的这种特殊用途的更多信息。

您还可以查看[朋友的 C++ 常见问题解答以](http://www.parashift.com/c++-faq-lite/friends.html)了解更多经验法则。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T07:17:38.793

我认为将 SoftwareProducer 作为 Software 的朋友是可以接受的，但我认为 Software 没有理由成为 SoftwareProducer 类的朋友。这是它们之间不必要的依赖。您可以将 key 作为 Software 类的构造函数参数。此外，您可能希望将 Software 类的析构函数设为私有，以便除了 SoftwareProducer 之外没有人可以销毁它们。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T12:22:53.787

我不会讨论友谊问题，但我倾向于不喜欢循环依赖。软件依赖于 SoftwareProducer，而后者又依赖于软件......我会尝试重构。

另请注意，友谊关系打开了其他类的*所有实例的内部。*这就像说您在*next_key*中的评论是错误的：

将 next_key*设为*私有会禁止任何类调用它，但是一旦您打开*Software*类，任何软件都可以在所有*SoftwareProducers上调用**next_key*。

 *# xsd - XSD - 需要 2 个属性之一？

> ID：763072
> 
> 赞同：67
> 
> 时间：2009-04-18T07:13:15.573
> 
> 标签：xsd

有没有办法指定 XSD 中需要 2 个属性之一？

例如，我有这样的定义：

```
<xs:attribute name="Name" type="xs:string" use="optional" />
<xs:attribute name="Id" type="xs:string" use="optional" /> 
```

我希望能够定义至少其中一项是必需的。那可能吗？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-18T07:56:14.160

不，我认为你不能用属性来做到这一点。您可以将两个包装`<xs:element>`成一个`<xs:choice>`- 但对于属性，恐怕没有等效的构造。

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2013-08-01T18:40:30.977

XSD 1.1 将允许您使用断言来执行此操作。

```
<xsd:element name="remove">
    <xsd:complexType>                        
        <xsd:attribute name="ref" use="optional"/>
        <xsd:attribute name="uri" use="optional"/>
        <xsd:assert test="(@ref and not(@uri)) or (not(@ref) and @uri)"/>            
    </xsd:complexType>
</xsd:element> 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-18T08:10:06.203

Marc 说的很对……你不能在 XSD 中的 xs:choice 父元素中包含 xs:attribute 子元素。

逻辑似乎是，如果一个元素的两个实例具有一组互斥的属性，那么它们在逻辑上是两个不同的元素。

[Jeni Tennison在这里](http://lists.xml.org/archives/xml-dev/200107/msg00038.html)提出了一个解决方法。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-08-12T22:11:54.143

您应该在 W3C wiki 上查看此页面：[简单属性隐含](http://www.w3.org/wiki/Simple_attribute_implication)和[属性互斥](http://www.w3.org/wiki/Attribute_mutex)

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2015-03-24T14:43:04.447

该示例定义了一个名为“person”的元素，该元素必须包含“employee”元素或“member”元素。

```
<xs:element name="person">
  <xs:complexType>
    <xs:choice>
      <xs:element name="employee" type="employee"/>
      <xs:element name="member" type="member"/>
    </xs:choice>
  </xs:complexType>
</xs:element> 
```

# asp.net - 纠正 JScript 运行时错误

> ID：763074
> 
> 赞同：1
> 
> 时间：2009-04-18T07:13:59.817
> 
> 标签：asp.net

当我运行应用程序时，出现如下错误：

Microsoft JScript 运行时错误：Sys.ArgumentTypeException：“Sys._Application”类型的对象无法转换为“Sys._Application”类型。参数名称：实例

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-07-18T11:38:26.100

将ScriptManager的**ScriptMode属性设置为****Release**。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T08:27:28.673

如果您的**web.config**未正确配置为使用 Microsoft 的 ASP.NET Ajax，则可能会发生此错误。

如果您有 VS2008，则会自动添加此设置。在 VS2005 中，如果您的 ASP.NET 项目开始时不是 Ajax，则需要手动添加设置。

这是一个例子：

```
<configuration>

  <configSections>

    <sectionGroup name="system.web.extensions" type="System.Web.Configuration.SystemWebExtensionsSectionGroup, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35">

      <sectionGroup name="scripting" type="System.Web.Configuration.ScriptingSectionGroup, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35">

        <section name="scriptResourceHandler" type="System.Web.Configuration.ScriptingScriptResourceHandlerSection, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" requirePermission="false" allowDefinition="MachineToApplication"/>

        <sectionGroup name="webServices" type="System.Web.Configuration.ScriptingWebServicesSectionGroup, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35">

          <section name="jsonSerialization" type="System.Web.Configuration.ScriptingJsonSerializationSection, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" requirePermission="false" allowDefinition="Everywhere"/>

          <section name="profileService" type="System.Web.Configuration.ScriptingProfileServiceSection, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" requirePermission="false" allowDefinition="MachineToApplication"/>

          <section name="authenticationService" type="System.Web.Configuration.ScriptingAuthenticationServiceSection, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" requirePermission="false" allowDefinition="MachineToApplication"/>

        </sectionGroup>

      </sectionGroup>

    </sectionGroup>

  </configSections>

  <system.web>

    <pages>

      <controls>

        <add tagPrefix="asp" namespace="System.Web.UI" assembly="System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>

      </controls>

    </pages>

    <compilation debug="true">

      <assemblies>

        <add assembly="System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>

        <add assembly="System.Design, Version=2.0.0.0, Culture=neutral, PublicKeyToken=B03F5F7F11D50A3A"/>

        <add assembly="System.Windows.Forms, Version=2.0.0.0, Culture=neutral, PublicKeyToken=B77A5C561934E089"/>

      </assemblies>

    </compilation>

    <httpHandlers>

      <remove verb="*" path="*.asmx"/>

      <add verb="*" path="*.asmx" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>

      <add verb="*" path="*_AppService.axd" validate="false" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>

      <add verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" validate="false"/>

    </httpHandlers>

    <httpModules>

      <add name="ScriptModule" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>

    </httpModules>

  </system.web>

  <system.web.extensions>

    <scripting>

      <webServices>

        <!-- Uncomment this line to customize maxJsonLength and add a custom converter -->

        <!--

          <jsonSerialization maxJsonLength="500">

            <converters>

              <add name="ConvertMe" type="Acme.SubAcme.ConvertMeTypeConverter"/>

            </converters>

          </jsonSerialization>

        -->

        <!-- Uncomment this line to enable the authentication service. Include requireSSL="true" if appropriate. -->

        <!--

          <authenticationService enabled="true" requireSSL = "true|false"/>

        -->

        <!-- Uncomment these lines to enable the profile service. To allow profile properties to be retrieved

             and modified in ASP.NET AJAX applications, you need to add each property name to the readAccessProperties and

             writeAccessProperties attributes. -->

        <!--

          <profileService enabled="true"

            readAccessProperties="propertyname1,propertyname2"

            writeAccessProperties="propertyname1,propertyname2" />

        -->

      </webServices>

      <!--

        <scriptResourceHandler enableCompression="true" enableCaching="true" />

      -->

    </scripting>

  </system.web.extensions>

  <system.webServer>

    <validation validateIntegratedModeConfiguration="false"/>

    <modules>

      <add name="ScriptModule" preCondition="integratedMode" type="System.Web.Handlers.ScriptModule, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>

    </modules>

    <handlers>

      <remove name="WebServiceHandlerFactory-Integrated"/>

      <add name="ScriptHandlerFactory" verb="*" path="*.asmx" preCondition="integratedMode" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>

      <add name="ScriptHandlerFactoryAppServices" verb="*" path="*_AppService.axd" preCondition="integratedMode" type="System.Web.Script.Services.ScriptHandlerFactory, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>

      <add name="ScriptResource" preCondition="integratedMode" verb="GET,HEAD" path="ScriptResource.axd" type="System.Web.Handlers.ScriptResourceHandler, System.Web.Extensions, Version=1.0.61025.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"/>

    </handlers>

  </system.webServer>

</configuration> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-07-09T11:07:40.297

谢谢！ScriptMode="Release" 帮助我解决使用 Tranfer.Redirect 显示的页面上的问题

# delphi - 组件包 - 在哪里划分运行时、设计时间、注册等

> ID：763075
> 
> 赞同：3
> 
> 时间：2009-04-18T07:14:01.050
> 
> 标签：delphi

在构建用于安装的组件时，我知道注册单元通常是“应该分开”的东西，但是什么时候应该将组件*安装*分成两个单独的包（通常一个是运行时，另一个是设计时） ）。

额外问题：当运行时和设计时包分开时，可接受的包命名约定是什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T08:24:30.800

任何特定于 IDE 中使用的东西，例如与设计者交互、对象检查器（属性编辑器...）或组件注册（图标、调色板信息...）都应该进入设计时包，通常以前缀为前缀dcl。

在应用程序中使用组件所需的最低限度的任何其他内容都进入运行时包。运行时包中禁止对设计单元的任何引用。

通常将编译器版本号作为设计时和运行时包的后缀：dclMyPackage120.bpl 和 MyPackage120.bpl（对于 D2009，它是编译器的 20.0 版并设置定义 VER200；对于 D2007，它是 10.5 版以及 *100.bpl 和 *105.bpl 的混合包，这要归功于二进制兼容性）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T08:43:06.700

查看有关该主题的 Delphi Wiki：[http](http://delphi.wikia.com/wiki/Creating_Packages) ://delphi.wikia.com/wiki/Creating_Packages 它是否回答了您的问题？如果不是，也许，你应该重述它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T08:28:31.743

包的命名或多或少取决于您，但您应该尝试模仿其他提供商正在使用的包命名方案之一。

正确的包命名的目标是：

*   将一个提供商的软件包分组并将它们与其他提供商的软件包分开
*   明确区分运行时和设计时包
*   使产品的各种不兼容版本以及Delphi / BCB的各种版本的并行安装成为可能

因此，通常包的名称应包含公司/产品的短字母组合、版本号的一位或两位数字、可接受的 Delphi / BCB 密钥之一（如 D5、D2007 或 BCB6）。对于设计时包，名称中通常有一个“ds”或类似名称，在其他方面与运行时包的名称相同。

# python - 如何在我的网站上将 WMD 降价语法转换为 HTML？

> ID：763087
> 
> 赞同：3
> 
> 时间：2009-04-18T07:21:39.143
> 
> 标签：python, html, django, markdown, wmd

我正在使用 django 并在我的网站上实现 WMD，我只是想知道如何将 markdown 语法转换为 HTML 以进行显示，是否应该调用某种函数来进行此转换？

处理降价的最佳方法是什么，即。我是按原样将降价保存到数据库中，然后在显示时对其进行解析，还是应该保存转换后的 HTML，然后在编辑期间将其转换为标记？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-18T07:47:21.843

查看Django 附带的[标记插件。](http://docs.djangoproject.com/en/1.0/ref/contrib/#markup)这就是你要找的。

> 要激活这些过滤器，请将“django.contrib.markup”添加到您的 INSTALLED_APPS 设置中。完成此操作后，在模板中使用 {% load markup %}，您将可以访问这些过滤器。如需更多文档，请阅读 django/contrib/markup/templatetags/markup.py 中的源代码。

如果您仍然卡住，还可以查看[这篇文章了解更多详细信息。](http://www.freewisdom.org/projects/python-markdown/Django)

# java - Java：对外部构造对象的依赖注入？

> ID：763089
> 
> 赞同：2
> 
> 时间：2009-04-18T07:25:11.757
> 
> 标签：java, design-patterns, dependency-injection

我是 DI 的忠实粉丝，
我目前正在开发一个不那么小的项目，它在任何地方都使用 DI
*（经典而美丽的 DI**手工**）。*

在我看来，有以下优点：

*   习惯了就很**直观**
*   不会以负面的方式 影响**可读性***（事实上，它会变得更好）*，
*   但最重要的是：如果我想用某些接口的不同实现来**测试**部分或整个项目，我可以通过更改 **几个字符**来完成，而不是进行复杂的重构/重命名或其他变通方法。

但是，遗憾的是，我不知道如何以优雅的方式将 DI 与外来创建的对象一起使用（请记住，我是手动进行 DI 的，没有一些框架）。

手动 DI 意味着：您**将某些东西传递给 c-tor**。没有全球工厂或类似的，上帝保佑！

例如，JAXB 自己创建对象。没有办法告诉 JAXBContext：“请使用以下参数来创建我的对象”。JAXB 只接受无参数的 c-tors。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T16:23:17.350

为什么“手动DI”必须意味着“将某些东西传递给c-tor”？

你能做到吗？

```
ThingOne one = new ThingOne();
one.setInjectedItem( a );
one.setOtherInjectedItem( b ); 
```

在 spring 依赖注入中，这将是通过属性进行的注入，我不明白为什么不能“手动”完成。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T08:47:35.113

JAXBContext 不使用[工厂方法](http://ws.apache.org/jaxme/apidocs/javax/xml/bind/JAXBContext.html#newInstance(java.lang.String,%20java.lang.ClassLoader))吗？您可以像构造构造函数一样将参数传递给它。如果这不能满足您的要求，则`context.setXyz(xyzInstance)`在创建对象后传统的 setter 注入（即调用方法）将手动模拟 spring 等人自动执行的操作...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T07:35:19.343

众所周知，人们使用[吸气剂注入](http://weblogs.java.net/blog/crazybob/archive/2004/05/getterbased_dep.html)来做到这一点。我不知道如何在 luddite DI 环境中做到这一点。

# java - 在 1 个单个 UDP 数据报中发送多个数据

> ID：763094
> 
> 赞同：1
> 
> 时间：2009-04-18T07:39:31.160
> 
> 标签：java, udp, packets

我正在做一个关于编写一个简单的 IM 系统的网络编程任务（很像最简单的 Windows Messenger 版本）。

规范规定我必须在单个数据报包中发送超过 4 个数据字段，它们是：

```
To From Type Message
where type refers to message type, implemented as a user defined enum class. 
```

我想学习如何将所有这些数据打包到一个数据包中。

更新：到目前为止的帮助，但是说我有字符串句子和字符串，从正常的方式单独修补数据包将是

```
byte[] sendData = new byte [256]
sendData = sentence.getBytes(); 
```

但是我怎样才能将“from”字符串与句子字符串一起附加到 sendData？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T08:46:24.913

您可以使用类似的方式发送任何可序列化的对象。

```
ByteArrayOutputStream buffer = new ByteArrayOutputStream();
ObjectOutputStream out = new ObjectOutputStream(buffer);
out.writeObject(objectYouWantToSend);
out.close();
buffer.close();
DatagramPacket packet = new 
    DatagramPacket(buffer.toByteArray(), 
                   buffer.size(), 
                   InetAddress.getByName(...),
                   portNumber);
socket.send(packet); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T09:22:08.197

简而言之，您需要做的是：

1.  创建一个对象（类），其中包含您的 4 个字段（从/到/枚举/消息）
2.  序列化这个。它必须实现[Serializable](https://docs.oracle.com/javase/7/docs/api/java/io/Serializable.html)。有关如何序列化的信息，请参见此处的其他解决方案
3.  转换为字节数组并向下发送套接字（有关详细信息，请参见其他地方）

在另一端，您将读取此字节流，反序列化并将其转换为上面 1\. 中定义的类的实例。

通过创建一个包含 4 个字段的对象并序列化该对象，这允许您将所有四个字段一起发送（我的印象是这是绊脚石？）。

请注意，数据报会受到网络传输层的大小限制，但对于这个应用程序，我怀疑这不是问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T07:47:12.590

您只需在将它们传递到网络接口之前附加它们。类似于以下内容：

```
byte[] buff = new byte[256];
// Add al your fields here to buff.
DatagramPacket packet = new DatagramPacket(buff, buff.length, address, 1234);
socket.send(packet); 
```

如果它们不是所有字符串，则需要将它们编码为这样。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T07:49:46.127

编码数据有很多选择，所有这些都归结为将四个字段放入一个数据结构中，然后一次性发送。

*   DIY（自己动手……）
*   [JSON](http://en.wikipedia.org/wiki/JSON)
*   Java[序列化](http://java.sun.com/javase/6/docs/api/java/io/Serializable.html)
*   [ASN.1](http://en.wikipedia.org/wiki/Abstract_Syntax_Notation_One)
*   XML
*   *ETC...*

重要的部分是编码需要显示四个字段中的哪一个在数据包中的哪个点，否则远端将无法可靠地对其进行解码。

# c# - 有什么办法可以防止控制台应用程序关闭？

> ID：763097
> 
> 赞同：0
> 
> 时间：2009-04-18T07:42:39.093
> 
> 标签：c#

有什么办法可以防止控制台应用程序关闭？

（用户无法关闭程序）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T08:33:16.350

看看 Win32[控制台 API](http://msdn.microsoft.com/en-us/library/ms682073(VS.85).aspx)。

您可以尝试创建一个窗口（非控制台应用程序），然后使用 AllocConsole() 创建您自己的控制台窗口。由于我还没有尝试过，所以我不能说 Windows 是否仍会尝试终止您的进程。

另一种方法是创建一个后台进程/服务来完成这项工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T08:34:01.370

通常可以通过按 CTRL-C 中止控制台应用程序。

[您可以通过设置Console.TreatControlCAsInput 属性](http://msdn.microsoft.com/en-us/library/system.console.treatcontrolcasinput.aspx)或处理[Console.CancelKeyPress 事件](http://msdn.microsoft.com/en-us/library/system.console.cancelkeypress.aspx)来防止 CTRL-C 中止您的应用程序。

当然，这不会阻止用户终止您的进程，例如使用任务管理器。

# git - 灵活与静态分支（Git vs Clearcase/Accurev）

> ID：763099
> 
> 赞同：31
> 
> 时间：2009-04-18T07:45:39.867
> 
> 标签：git, version-control, clearcase, accurev

我的问题是关于 Git 处理分支的方式：每当您从提交分支时，除非您通过合并*强制*它，否则该分支将永远不会收到来自父分支的更改。

*但是在我们 Clearcase 或 Accurev 等其他系统中，您可以指定如何使用某种继承机制*来填充分支：我的意思是，对于 Clearcase，使用 config_spec，您可以说“获取在分支 /main/issue001 上修改的所有文件和然后继续使用 /main 上的那些或使用这个特定的基线”。

在 Accurev 中，您也有一个类似的机制，它让流从上层分支（流如何调用它们）接收更改，而无需在分支上合并或创建新提交。

你在使用 Git 时不会错过这个吗？你能列举出这种*继承*是必须的场景吗？

谢谢

**更新**请阅读下面的 VonC 答案以真正关注我的问题。一旦我们同意“线性存储”和基于 DAG 的 SCM 具有不同的功能，我的问题是：**哪些是现实生活场景（尤其是对于 OSS 以外的公司），线性可以做 DAG 不可能做的事情？他们值得吗？**

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-18T21:11:13.487

要理解为什么 Git 不提供您所说的某种“继承机制”（不涉及提交），您必须首先了解这些 SCM 的**[核心概念](https://stackoverflow.com/questions/645008/what-are-the-basic-clearcase-concepts-every-developer-should-know/645771#645771)**之一（例如 Git 与 ClearCase）

*   ClearCase 使用**线性版本存储**：元素（文件或目录）的每个版本都与同一元素的先前版本以直接*线性关系链接。*

*   Git 使用**DAG -有向无[环图](http://en.wikipedia.org/wiki/Directed%5Facyclic%5Fgraph)**：文件的每个“版本”实际上是树中全局更改集的一部分，而树本身就是提交的一部分。之前的版本必须在之前的提交中找到，可以通过单个有向无环图路径访问。

在线性系统中，配置规范可以指定几个规则来实现您看到的“继承”（对于给定的文件，首先选择某个版本，如果不存在，则选择另一个版本，如果不存在，则选择一个第三，以此类推）。

分支是*线性*历史中的一个[分支](http://en.wikipedia.org/wiki/Fork_(software_development))，是给定选择规则的给定版本（在此之前的所有其他选择规则仍然适用，因此产生“继承”效果）

 *在 DAG 中，提交代表您将获得的所有“继承”；没有“累积”的版本选择。此图中只有一个路径可以选择您将在此确切点（提交）看到的所有文件。
分支只是此图中的一条新路径。

要在 Git 中应用其他版本，您必须：

*   将其他一些提交合并到您的分支中（例如[stsquad 的回答](https://stackoverflow.com/questions/763099/flexible-vs-static-branching-git-vs-clearcase-accurev/763259#763259)中提到的 git pull ）或
*   重新设置您的分支（正如[Greg 提到](https://stackoverflow.com/questions/763099/flexible-vs-static-branching-git-vs-clearcase-accurev/763116#763116)的那样）

但由于 Git 是基于 DAG 的 SCM，它总是会导致新的提交。

**您在 Git 中“失去”的是某种“组合”（当您选择具有不同连续选择规则的不同版本时），但这在D** VCS中是不切实际的（如在“分布式”中）：当您使用 Git 创建一个分支，您需要有一个明确定义的起点*和内容，并且可以轻松复制到其他存储库。*

在纯粹的中央 VCS 中，您可以使用您想要的任何规则来定义您的工作区（在 ClearCase 中，您的“视图”，快照或动态）。

* * *

[unknown-google](https://stackoverflow.com/users/92457/unknown-google)在评论中添加（以及上面的问题）：

> 所以，一旦我们看到这两种模型可以实现不同的事情（线性与 DAG），我的问题是：哪些是现实生活场景（尤其是对于 OSS 以外的公司）线性可以做 DAG 不可能的事情？他们值得吗？

当谈到选择规则方面的“现实生活场景”时，您可以在线性模型中**为同一组文件设置***多个*选择规则。

 **考虑这个“配置规范”（即 ClearCase 选择规则的“配置规范”）：

```
element /aPath/... aLabel3 -mkbranch myNewBranch
element /aPath/... aLabel2 -mkbranch myNewBranch 
```

它选择所有标记为“ `aLabel2`”的文件（并从那里分支），除了那些标记为“ `aLabel3`”的文件 - 并从那里分支 - （因为该规则在提到“ `aLabel2`”的那个之前）。

这值得么？

不。

**实际上，出于简单**的原因， ClearCase 的 UCM 风格（ClearCase 产品中包含的“**[统一配置管理](https://stackoverflow.com/questions/449549/how-to-leverage-clearcases-features/449810#449810)**”方法，代表从基本 ClearCase 使用中推导出的所有“最佳实践”）不允许这样做。一组文件称为“组件”，如果您想针对给定标签（称为“基线”）进行分支，则将按照以下配置规范进行翻译：

 **```
element /aPath/... .../myNewBranch
element /aPath/... aLabel3 -mkbranch myNewBranch
element /aPath/... /main/0 -mkbranch myNewBranch 
```

您必须选择**一个**起点（此处为“ `aLabel3`”）并从那里开始。如果您还想要“ `aLabel2`”中的文件，则将所有“ ”文件合并`aLabel2`到“myNewBranch”中的文件。

这是您不必使用 DAG 进行的“简化”，其中图形的每个节点代表一个分支的唯一定义的“起点”，无论所涉及的文件集是什么。

合并和变基足以将该起点与给定文件集的其他版本结合起来，以实现所需的“组合”，同时将特定历史记录*隔离*在分支中。

总体目标是在“应用于*连贯*组件的*连贯版本控制操作”中进行推理。*“连贯”的文件集是处于明确定义的连贯状态的文件：

 **   如果已标记，则其**所有**文件都已标记
*   如果分支，其**所有**文件将从**相同的唯一**起点分支

这在 DAG 系统中很容易做到；在线性系统中可能会更加困难（尤其是在“配置规范”可能很棘手的情况下使用“Base ClearCase”），但它是通过同一基于线性工具的 UCM 方法强制执行的。

不是通过“私有选择规则技巧”（使用 ClearCase，一些选择规则顺序）实现“组合”，而是仅通过 VCS 操作（变基或合并）实现它，这为每个人留下了清晰的跟踪（相反到开发人员私有的配置规范，或在一些但不是所有开发人员之间共享）。*再次强调，与“动态灵活性”相反，它增强了一种连贯性*，**您以后可能很难重现**这种感觉。

这可以让你离开[VCS（版本控制系统）](http://en.wikipedia.org/wiki/Revision_control)的领域，进入[SCM（软件配置管理）](http://en.wikipedia.org/wiki/Software_Configuration_Management)的领域，它主要关注的是“**再现性**”。而这（SCM 功能）可以通过基于线性或基于 DAG 的 VCS 来实现。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T08:06:42.530

听起来您正在寻找的可能是[`git rebase`](http://git-scm.com/docs/git-rebase). 重新定位分支在概念上将其与其原始分支点分离，并在其他点重新连接它。（实际上，变基是通过将分支的每个补丁依次应用到新分支点来实现的，创建一组新补丁。）在您的示例中，您可以将分支变基到上分支的当前尖端，这本质上将“继承”对另一个分支所做的所有更改。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-18T10:31:49.093

我不完全清楚你的要求，但听起来 git 的跟踪语义就是你想要的。当您从 am origin 分支时，您可以执行以下操作：

git -t -b my_branch origin/master

然后未来的“git pull”会自动将 origin/master 合并到你的工作分支中。然后你可以使用“git cherry -v origin/master”来看看有什么区别。您可以在发布更改之前使用“git rebase”来清理历史记录，但一旦您的历史记录公开（即其他人正在关注该分支），则不应使用 rebase。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-09-10T13:58:42.157

至于 accurev 使用的继承方案：当查看[git-flow](http://nvie.com/git-model)时，GIT 用户可能会“了解”全部内容（另请参见：http: [//github.com/nvie/gitflow](http://github.com/nvie/gitflow)和[http://jeffkreftmeijer.com/ 2010/why-arent-you-using-git-flow/](http://jeffkreeftmeijer.com/2010/why-arent-you-using-git-flow/)）

这个 GIT 分支模型或多或少地（手动/在 git-flow 工具的帮助下）完成了 accurev 自动开箱即用的工作，并且具有**强大的**GUI 支持。

所以*看起来*GIT 可以做 accurev 所做的事情。因为我从来没有真正每天使用 git/git-flow，所以我不能真正说出它是如何工作的，但它看起来确实很有希望。（减去适当的 GUI 支持:-)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-10-18T23:18:52.370

我会尽力回答你的问题。（这里不得不说，我没用过GIT，只是看了一下，所以如果我下面提到的有不对的地方还请指正）

*“你能列举出这种继承是必须的场景吗？”*

我不会说这是必须的，因为您可以使用您拥有的工具解决问题，并且可能是您环境的有效解决方案。我想这更多的是过程而不是工具本身。确保您的流程是连贯的，并且还允许您及时返回以重现任何中间步骤/状态是目标，而且该工具让您可以尽可能轻松地运行您的流程和 SCMP

我可以看到拥有这种*“继承”*行为并使用配置规范的强大功能很方便的一种情况是，当您希望将一组更改“**隔离**”映射到任务（devtask、CR、SR 或任何定义的变更集的目的/范围）

使用此组合可以让您的开发分支干净，并且仍然使用其余代码的不同组合（使用组合），并且在任务的**整个**生命周期中仍然**只有与**分支中隔离的任务相关的内容，直到整合阶段。

 **作为纯粹主义者必须提交/合并/变基只是为了有一个“定义的起点”，我想它会“**污染**”你的分支，你最终会在你的分支/更改集中进行更改+其他更改。

这种隔离何时/何地有用？以下几点可能仅在公司追求 CMM 和某些 ISO 认证的背景下有意义，并且可能对其他类型的公司或 OSS 不感兴趣

*   由于非常挑剔，您可能希望准确计算对应于单个开发人员的更改集的代码行数（添加/修改/删除），稍后用作代码和工作量估算的一个输入。

*   可以更轻松地在不同阶段查看代码，只需将您的代码放在一个分支中（不与其他更改粘连）

在有多个团队和 +500 名开发人员同时在同一个基本代码上同时工作的大型项目中，（其中图形化的单个元素版本树看起来像一个杂乱的错综复杂的网络，有多个负载线，每个大客户一个，或者每个技术一个）大型配置使用深度组合的规范使这么多人无缝地工作，以使相同的产品/系统（基本代码）适应不同的目的。使用此配置规范，动态地为每个团队或子团队提供不同的视图，以了解他们需要什么以及他们需要从哪里分支，（在几种情况下级联），而无需创建中间集成分支，或不断合并和重新定位所有您需要开始的位。来自相同任务/目的的代码是不同标签的分支，但很有意义。（您可以在此处争论“已知基线”作为 SCM 的原则，但书面 SCM 计划中考虑的简单标签完成了工作）必须有可能用 GIT 解决这个问题（我猜是以非动态方式）但我发现如果没有这种“继承”行为，真的很难想象。我猜 VonC 提到的“如果分支，它的所有文件都将从同一个唯一起点分支”在这里被破坏了，但除了它在 SCMP 上有很好的记录之外，我记得这样做有充分的商业理由。

是的，构建我上面提到的这些配置规范并不是免费的，一开始有 4-5 个高薪人员在 SCM 后面，但后来被自动脚本减少了，这些脚本询问你在标签/分支/功能方面想要什么，并将为你写CS。

这里的可重复性是通过将配置规范与任务一起保存在 devTask 系统中来实现的，因此上游的每个任务都映射到需求，下游映射到配置规范，一组更改（代码文件、设计文档、测试文档ETC）

因此，到这里为止，一个结论可能是，只有当您的项目足够大/足够复杂（并且您可以在项目的整个生命周期中负担得起 SC 经理 :)）时，您才会开始考虑是否需要“继承”行为或真正通用的工具，否则您将直接使用免费的工具，并且已经处理了 SCM 的连贯性……但是 SCM 工具上可能还有其他因素可能使您坚持使用一个或另一个.. . 继续阅读..

一些旁注，可能超出主题，但我想在某些情况下需要考虑我的情况。

我必须在这里补充一点，我们使用的是“good-ol CC”而不是 UCM。完全同意 VonC 关于*允许“引导”灵活性以实现更连贯配置的良好方法*。好消息是 CC 非常灵活，您可以（并非不费力气）找到一种使事情连贯的好方法，而在其他 SCM 中您可能会免费获得它。但是例如在这里（以及我与 CC 合作过的其他地方）对于 C/C++ 项目，我们无法承受没有*winkin的代价*功能（重用派生对象），减少了几倍的编译时间。可以说，拥有更好的设计，更解耦的代码，优化 Makefile 可以减少编译整个东西的需要，但有些情况下你需要一天编译多次，共享 DO 可以节省大量的时间/金钱。我现在在哪里，我们尝试尽可能多地使用免费工具，我认为如果我们能找到更便宜或免费的工具来实现*winkin*功能，我们将摆脱 CC。

我将用 Paul 提到的一些东西来结束，*不同的工具对于不同的目的比其他的更好，*但我会补充一点，你可以通过一个连贯的过程来摆脱工具的一些限制，而不会影响可重复性，SCM 中的关键点最后我猜这个答案*值得吗？*取决于您的“问题”、您正在运行的 SDLC、您的 SCM 进程，以及是否有任何额外的功能（如 winkin）可能在您的环境中有用。

我的 2 美分

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2010-11-11T08:29:09.993

您是否注意到您也可以使用 GIT 检查特定的文件版本？

只需使用这个：

```
git checkout [< tree-ish >] [--] < paths > 
```

像每个配置规范一样，任何现有版本的文件（路径）都可以加载到工作树中。引用 git-checkout 文档：

以下序列检查出 master 分支，将 Makefile 恢复为两个修订版，`hello.c`错误地删除，然后从索引中取回：

```
$ git checkout master             
$ git checkout master~2 Makefile             
$ rm -f hello.c            
$ git checkout hello.c 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2012-09-08T13:35:30.330

抛开理论不谈，从我多年来在商业生产环境中使用 AccuRev 的角度来看，这里有一种明显的实际看法：只要子流与祖先没有太大分歧，继承模型就可以很好地工作。仍在开发中。当继承流太不同时，它就会崩溃。

继承（较早版本的子版本）允许祖先流中的更改在子流中处于活动状态，而无需任何人做任何事情（除非需要合并，在这种情况下它显示为深度重叠，很高兴能够看到）。

这听起来很棒，在实践中，当所有涉及的流都相对相似时。我们将该模型用于给定生产版本以下的修补程序和服务包级别流。（这对我们来说实际上比这要复杂一些，但这是一般的想法。）

生产版本是并行的，没有继承性，在它们下面都有那些修补程序和服务包子项。启动一个新版本意味着创建一个新的版本级别流，并手动将前一个版本的最新维护流中的所有内容推送到其中。之后，必须手动将适用于较晚版本的早期版本的更改推送到每个版本中，这需要更多的工作，但允许更大的控制。

我们最初在所有版本中都使用继承模型，后来的版本是早期版本的子版本。这在一段时间内运作良好，但随着时间的推移变得难以管理。不同版本之间的主要架构差异使得不可避免地继承更改成为一个坏主意。是的，您可以在两者之间放置一个快照来阻止继承，但是所有更改都必须手动推送，并且父快照子和并行非继承流之间唯一真正的区别是整个图形流视图不断向下推送在右边，这是一个 PITA。

AccuRev 的一个非常好的事情是您始终可以选择。这不是 SCM 程序架构的固有约束。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-11-30T14:26:44.160

没有 MultiSite 的 ClearCase 是单个存储库，但 Git 是分布式的。ClearCase 在文件级别提交，但 Git 在存储库级别提交。（最后一个区别意味着原始问题是基于误解，正如此处其他帖子中所指出的那样。）

如果这些是我们正在谈论的差异，那么我认为“线性”与“DAG”是区分这些 SCM 系统的一种令人困惑的方式。在 ClearCase 中，文件的所有版本都称为文件的版本“树”，但实际上它是一个有向无环图！与 Git 的真正区别在于每个文件都存在 ClearCase 的 DAG。所以我认为将 ClearCase 称为非 DAG 而将 Git 称为 DAG 是一种误导。

（顺便说一句，ClearCase 以与其文件类似的方式对其目录进行版本化 - 但这是另一回事。）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-18T14:33:12.443

我不确定您是否在问什么，但您正在证明 Accurev 流是与 Git（或 SVN）分支不同的工具。（我不知道 Clearcase。）

例如，正如您所说，使用 Accurev，您*被迫*使用某些工作流程，这为您提供了 Git 不支持的可审计的更改历史记录。Accurev 的继承使某些工作流程更高效，而另一些则不可能。

使用 Git，您可以在本地存储库或功能分支中隔离探索性编码，而 Accurev 不能很好地支持。

不同的工具适用于不同的目的；询问每个人的优点是很有*用的*。

# python - 自动获取视图参数

> ID：763103
> 
> 赞同：0
> 
> 时间：2009-04-18T07:48:08.423
> 
> 标签：python, django, django-urls, django-views

```
some_view?param1=10&param2=20

def some_view(request, param1, param2): 
```

在 Django 中这可能吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T12:47:22.400

你总是可以写一个装饰器。例如。类似（未经测试）：

```
def map_params(func):
    def decorated(request):
        return func(request, **request.GET)
    return decorated

@map_params
def some_view(request, param1, param2):
    ... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T07:54:09.890

我不确定是否可以将它们作为*参数*传递给视图函数，但为什么不能`GET`从 访问变量`request.GET`？给定那个 URL，Django 应该`request.GET['param1']`是 10 和`request.GET['param2']`20。否则，你必须想出一些奇怪的正则表达式来尝试做你想做的事。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T08:27:15.913

我同意 Paolo 的观点……“？”之后的内容 是 GET 参数，应该这样对待。也就是说，如果您真的想保留 some_view() 的定义，如您在问题中所述，您可以执行以下操作：

```
from django.http import Http404
def some_view_proxy(request):
     if 'param1' in request.GET and 'param2' in request.GET:
         return some_view(request, request.GET['param1'],
                          request.GET['param2'])
     raise Http404 
```

或者您可以像这样定义 some_view() 并使用 GET 参数。只是好奇，你为什么要那个？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T12:26:15.337

与其对抗 Django，不如直接请求 some_view/10/20 然后设置 urls.py 来提取参数？

# java - 在 JPA 中注释包含非实体类的地图

> ID：763111
> 
> 赞同：1
> 
> 时间：2009-04-18T07:59:14.170
> 
> 标签：java, jpa

是否可以在 JPA 中使用具有非实体类的地图？如果是，应该如何正确注释？

```
 @Entity
class A {

   @HowShouldIAnnotateThis?
   private Map<B, Integer> myMap = new HashMap<B, Integer>();

}

@Entity
class B {
 ...
} 

```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T08:51:06.573

JPA 1.0 无法做到这一点。[`@BasicMap`](http://wiki.eclipse.org/Using_EclipseLink_JPA_Extensions_(ELUG)#How_to_Use_the_.40BasicMap_Annotation)如果您不介意将您的应用程序耦合到给定的 JPA 提供程序，一些实现提供了专有的扩展（例如 EclipseLink ），您可以使用这些扩展。

JPA 2.0 将提供与`@ElementCollection`.

# configuration - postfix：如何向用户发送电子邮件

> ID：763113
> 
> 赞同：-1
> 
> 时间：2009-04-18T08:02:11.620
> 
> 标签：configuration, debian, postfix-mta

我在 debian lenny 上运行一个网络服务器。如何设置 postfix 向用户发送电子邮件以进行用户注册，忘记密码？如何配置系统？

我不希望系统收到任何来自外界的电子邮件，包括用户回复。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-29T10:51:16.773

我猜，邮件服务器的设置和配置超出了 stackoverflow 的范围，因为它涉及各种系统管理任务（例如为服务器设置反向 IP）。只需使用 Google 找到一堆关于在 Debian 上设置 Postfix 服务器的教程。

但这可能比必要的努力更多。您是否考虑过使用 SMTP 将外发邮件传递到外部机器上的现有 SMTP 服务器？

如果在现有邮件服务器上为外发邮件设置邮件帐户是您的项目的一个选项，那么在您的 Web 应用程序中编写 SMTP 发送代码将比设置新邮件服务器省力得多：

SMTP 部分几乎是微不足道的（例如在 Python 中： http: [//docs.python.org/library/smtplib.html#smtp-example](http://docs.python.org/library/smtplib.html#smtp-example)）。唯一的问题是，根据外部 SMTP 服务器，您必须先通过服务器进行身份验证，然后才能允许通过 SMTP 发送邮件。通常这是作为 SMTP-after-POP 实现的，因此您必须首先通过 POP3 提供邮件帐户的凭据。但这也很容易实现（再次在 Python 中： http: [//docs.python.org/library/poplib.html#pop3-example](http://docs.python.org/library/poplib.html#pop3-example)）：

```
import poplib,smtplib

recipient="your.customer@whereever"
msg="Subject: Welcome\n\nWelcome...\n"
sender="newwebservice@example.org"
pass="xyz"

pop3=poplib.POP3('mail.example.org')
pop3.user(sender)
pop3.pass_(pass)
pop3.quit()

smtp=smtplib.SMTP('mail.example.org')
smtp.sendmail(sender, recipient, msg)
smtp.quit() 
```

# c# - 颜色对话框

> ID：763120
> 
> 赞同：0
> 
> 时间：2009-04-18T08:13:03.107
> 
> 标签：c#, colors, color-picker

我需要在 colordialog 窗口的自定义颜色框中获取添加的颜色。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T08:25:54.090

[ColorDialog.CustomColors](http://msdn.microsoft.com/en-us/library/system.windows.forms.colordialog.customcolors.aspx)属性

[这是一个如何使用它的例子](http://social.msdn.microsoft.com/forums/en-US/csharpgeneral/thread/19cf2bdd-7e97-4642-8272-a125fb668179/)

# algorithm - 计算 3D 高度图的轮廓？

> ID：763128
> 
> 赞同：7
> 
> 时间：2009-04-18T08:24:20.257
> 
> 标签：algorithm, 3d, 2d, gis, contour

我正在寻找一个函数或示例来生成表示高度图中特定高度的轮廓的线条列表。

例如，

```
Lines[] = GetContours(Heights[512,512], HeightValue) 
```

其中 Heights 是一个 512x512 的浮点值数组，HeightValue 是应绘制轮廓的高度。高度可能包含该特定高度的多条线（例如马鞍或岛链）

有没有人有或知道在哪里可以得到一个算法来生成这个？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T09:14:11.807

你实际上想要做的是画一条等值线。不久前
看到[我的问题。](https://stackoverflow.com/questions/231642/drawing-an-iso-line-of-a-2d-implicit-scalar-field)
[其中一个答案中给出的链接](http://web.archive.org/web/20140718130446/http://members.bellatlantic.net/~vze2vrva/thesis.html)非常有帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T09:15:09.790

标准算法是[前进广场](http://en.wikipedia.org/wiki/Marching_squares)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T09:17:56.540

算法：

a）找出哪些多边形的顶点高于和低于您感兴趣的高度。

b) 将这些多边形的边缘与平面相交以获得平面上的线。

c) 将线条连接在一起。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T09:29:03.157

看看[Srtm2Osm](http://wiki.openstreetmap.org/index.php/Srtm2Osm)，这是我用来从 NASA 的 SRTM 数据生成轮廓的工具。您可以在 C# 代码中找到该算法。

# php - 仅使用一个文件的自定义错误页面

> ID：763135
> 
> 赞同：1
> 
> 时间：2009-04-18T08:28:02.883
> 
> 标签：php, html, .htaccess, error-handling

尽管我确信有可能我看不到我将如何做到以下几点。

使用 .htaccess 将 html 错误指向单个错误处理页面（这不是问题）。

然后该页面检查实际的错误代码是什么（404、500 等），并根据每个错误代码显示一条消息。

我正在尝试在 PHP 环境中执行此操作，它适用于简约网站，因此文件越少越好。

这是我正在制作的 404 示例[http://isitup.org/404](http://isitup.org/404)，我想要的只是相应地切换数字。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T08:48:00.107

我总是放入我的 .htaccess：

```
ErrorDocument 403  /error.php?error=403
ErrorDocument 404  /error.php?error=404
ErrorDocument 500  /error.php?error=500 
```

等等我想要的任何错误，然后只需在 $_GET['error'] 上切换大小写。

不要认为有任何更复杂的方法可以做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T08:50:16.607

由于您使用 .htaccess 将错误重定向到自定义错误处理程序文件，因此您可以使用它`$_SERVER['REDIRECT_STATUS']`来获取 HTTP 错误代码。基于此，您可以根据错误代码显示不同的消息。

# math - c=2^N +-1 快速计算 (a*b) mod c

> ID：763137
> 
> 赞同：9
> 
> 时间：2009-04-18T08:29:45.610
> 
> 标签：math, integer, modulo, prng, knuth

在 32 位整数数学中，加法和乘法的基本数学运算是隐式计算的，模 2^32，这意味着您的结果将是加法或乘法的最低位。

如果你想用不同的模数计算结果，你当然可以使用不同语言的任意数量的 BigInt 类。对于 a,b,c < 2^32 的值，您可以计算 64 位长整数的中间值，并使用内置的 % 运算符来减少到正确的答案

但是有人告诉我，当 C 的形式为 (2^N)-1 或 (2^N)+1，不使用 64 位数学或一个 BigInt 库，并且非常有效，比任意模计算更有效，并且还可以正确计算如果包含中间乘法，通常会溢出 32 位 int 的情况。

不幸的是，尽管听说这种特殊情况有快速评估方法，但我实际上并没有找到该方法的描述。“那不是在 Knuth 吗？” “这不是维基百科的某个地方吗？” 是我听到的喃喃自语。

这显然是随机数生成器中的一种常用技术，因为 2147483647 是一个等于 2^31 -1 的素数，所以它对 a*b mod 2147483647 进行乘法运算。

所以我会问专家。这个我找不到任何讨论的聪明的特殊情况乘法与mod方法是什么？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-18T09:54:49.057

我认为诀窍如下（我打算以 10 为底，因为它更容易，但原则应该成立）

假设你在乘法`a*b mod 10000-1`，并且

```
a = 1234 = 12 * 100 + 34
b = 5432 = 54 * 100 + 32 
```

现在`a*b = 12 * 54 * 10000 + 34 * 54 * 100 + 12 * 32 * 100 + 34 * 32`

```
12 * 54 * 10000 =  648 * 10000
34 * 54 * 100   = 1836 * 100
12 * 32 * 100   =  384 * 100
34 * 32         = 1088 
```

从`x * 10000 ≡ x (mod 10000-1)`[1] 开始，第一项和最后一项变为 648+1088。第二个和第三个术语是“技巧”的来源。请注意：

```
1836 = 18 * 100 + 36
1836 * 100 ≡ 18 * 10000 + 3600 ≡ 3618 (mod 10000-1). 
```

这本质上是一个循环移位。给出 648 + 3618 + 8403 + 1088 的结果。还要注意，在所有情况下，相乘的数字都 < 10000（因为 a < 100 和 b < 100），所以如果你只能将多个 2 位数字放在一起，这是可以计算的, 并添加它们。

在二进制中，它会以类似的方式工作。

以 a 和 b 开头，都是 32 位。假设您想将它们相乘 mod 2^31 - 1，但您只有一个 16 位乘法器（给出 32 位）。该算法将是这样的：

```
 a = 0x12345678
 b = 0xfedbca98
 accumulator = 0
 for (x = 0; x < 32; x += 16)
     for (y = 0; y < 32; y += 16)
         // do the multiplication, 16-bit * 16-bit = 32-bit
         temp = ((a >> x) & 0xFFFF) * ((b >> y) & 0xFFFF)

         // add the bits to the accumulator, shifting over the right amount
         total_bits_shifted = x + y
         for (bits = 0; bits < total_bits_shifted + 32; bits += 31)
             accumulator += (temp >> (bits - total_bits_shifted)) & 0x7FFFFFFF

         // do modulus if it overflows
         if (accumulator > 0x7FFFFFFFF)
             accumulator = (accumulator >> 31) + (accumulator & 0x7FFFFFFF); 
```

为时已晚，因此其中的累加器部分可能无法正常工作。我认为原则上它是正确的。有人可以随意编辑它以使其正确。

展开，这也相当快，我猜这也是 PRNG 使用的。

```
[1]: x*10000 ≡ x*(9999+1) ≡ 9999*x + x ≡ x (mod 9999)
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T08:51:50.597

假设您可以将 a*b 计算为`p*2^N+q`。这可能需要 64 位计算，或者您可以将 a 和 b 拆分为 16 位部分并在 32 位上进行计算。

那么`a*b mod 2^N-1 = p+q mod 2^N-1`自`2^N mod 2^N-1 = 1`.

并且`a*b mod 2^N+1 = -p+q mod 2^N+1`由于`2^N mod 2^N+1 = -1`.

在这两种情况下，都没有除以`2^N-1`or `2^N+1`。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T08:40:12.947

快速搜索一下：[http](http://home.pipeline.com/~hbaker1/AB-mod-N.pdf) ://home.pipeline.com/~hbaker1/AB-mod-N.pdf 。不幸的是，我现在已经太迟了，无法理解这一点，只写简化公式，但它可能在那篇论文中的某个地方。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T08:54:32.790

与其在每一步都做模归约，可以使用[蒙哥马利归约](http://en.wikipedia.org/wiki/Montgomery_reduction)（还有其他[描述](http://palms.ee.princeton.edu/PALMSopen/bubshait01large.pdf)）来降低模乘计算的成本。不过，这仍然没有使用 N 的属性是加/减 2 的幂。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-18T11:25:06.017

您正在寻找的身份是`x mod N = (x mod 2^q)- c*floor(x/2^q)`，因为`N = 2^q + c`并且 c 是任何整数（但通常是±1）。

您可能需要阅读Richard Crandall 和 Carl Pomerance的*“素数：计算视角”*中的*第 9.2.3 节：“特殊形式的模”。*除了理论，它还包含实现上述关系的算法的伪代码。

 ** * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-23T06:22:48.073

我找到了一个关于这个主题的[相当广泛的页面，不仅讨论了算法，还讨论了问题和解决方案的具体](http://www.firstpr.com.au/dsp/rand31/)**历史**以及人们使用解决方案的方式。

# javascript - 选择给定存储在字符串中的 div 名称的对象

> ID：763140
> 
> 赞同：0
> 
> 时间：2009-04-18T08:31:48.867
> 
> 标签：javascript, jquery, dom

这是一个简单的问题，希望也有类似的简单答案。

如果 div 选择器的**id**存储在字符串中，如何动态选择 div 对象。

这就是我目前所做的，我相信 jQuery 必须有自己的方式来做到这一点：

```
<div id="boo">Some content...</div>

var divName = 'boo';
var divObj  = $('#' + divName);  // I really don't like the concatenation of '#' 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-18T08:36:53.143

我假设您的意思是 div 的**id**，它实际上与**name**不同，但是您所得到的内容是准确的，而不是那么侵入性。我会坚持下去。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T08:43:14.017

如果您愿意，还可以创建一个简单的辅助函数：

```
var $E = function( id ) {
    return jQuery('#' + id);
};
// usage:
$E('myElement').css('background-color', 'red'); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T12:57:13.517

如果你真的在谈论 ID，而不是名称属性，那么你的例子中提到的就是这样做的好方法，我在这个解决方案中看不到任何疯狂的东西。

如果你想使用 name 属性而不是这样做：

```
var divObj = $("div[name='"+ divName +"']"); 
```

但是 name 属性通常用于表单输入字段。

# batch-file - 在 Windows 上自动启动批处理文件

> ID：763149
> 
> 赞同：0
> 
> 时间：2009-04-18T08:42:33.333
> 
> 标签：batch-file, scripting, windows-server-2003

我想创建一个脚本，该脚本将在服务器打开时运行以执行基本操作，例如创建目录并将二进制文件从 FTP 服务器复制到其中。我需要它在用户登录之前运行，只要服务器打开。这将部署在我的 EC2 Windows 服务器上。

检查（[http://www.bleepingcomputer.com/tutorials/tutorial44.html](http://www.bleepingcomputer.com/tutorials/tutorial44.html)）我发现只有服务才能在用户登录之前运行。

我看到我可以将批处理变成 com (bat2exe) 并将其设置为服务，但这不适用于 ECHO、md 等内部命令。我还可以将服务伪装成“cmd /k batch.命令”。

两者看起来都很麻烦。有没有一种优雅的方式来做到这一点？

谢谢，

三木

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T08:49:03.300

您可以使用 Windows 任务计划程序并将其设置为系统启动时。[这是有关该任务计划程序](http://msdn.microsoft.com/en-us/library/aa383614(VS.85).aspx)的更多信息

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T08:46:37.003

您可以使用[任务计划程序](http://msdn.microsoft.com/en-us/library/aa383614%28VS.85%29.aspx)。计划任务可以在启动时运行，甚至在用户登录之前（但是它们在指定用户的上下文中运行）。

# c - 我应该费心在我的 C 代码中检测 OOM（内存不足）错误吗？

> ID：763159
> 
> 赞同：24
> 
> 时间：2009-04-18T08:48:11.947
> 
> 标签：c, memory-management, malloc

我已经将大量的 C 代码行用于清理标签/条件以用于失败的内存分配（由`alloc`返回的系列表示`NULL`）。我被告知这是一种很好的做法，因此，在内存故障时，可以标记适当的错误状态，并且**调用者可以潜在地执行“优雅的内存清理”并重试。**我现在对这种哲学有一些疑问，我希望能澄清一下。

我想调用者可能会释放过多的缓冲区空间或剥离其数据的关系对象，但*我***发现调用者很少有能力**（或处于适当的抽象级别）这样做。此外，**从被调用函数中提前返回而没有副作用通常很重要。**

我还刚刚发现了 Linux OOM 杀手，这似乎使这些努力在我的主要开发平台上毫无意义。

> 默认情况下，Linux 遵循乐观的内存分配策略。这意味着当 malloc() 返回非 NULL 时，不能保证内存确实可用。这是一个非常糟糕的错误。如果发现系统内存不足，一个或多个进程将被臭名昭著的 OOM 杀手杀死。

我认为可能还有其他平台遵循相同的原则。**是否有一些实用的东西使得检查 OOM 条件值得？**

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-18T09:18:03.560

如果用户或系统管理员限制（参见 ulimit）进程的内存空间，或者操作系统支持每个用户的内存分配限制，即使在具有大量内存的现代计算机上也可能发生内存不足的情况。在病态的情况下，碎片化使这很有可能，甚至。

但是，由于现代程序中普遍使用动态分配的内存，因此处理内存不足错误变得非常麻烦。检查和处理此类错误必须在任何地方进行，而且复杂性很高。

我发现最好把程序设计成可以随时崩溃。例如，确保用户创建的数据一直保存在磁盘上，即使用户没有明确保存。（例如，请参见 vi -r。）这样，您可以创建一个函数来分配内存，该函数在出现错误时终止程序。由于您的应用程序旨在随时处理崩溃，因此崩溃是可以的。用户会感到惊讶，但不会失去（很多）工作。

永不失败的分配函数可能是这样的（未经测试、未编译的代码，仅用于演示目的）：

```
/* Callback function so application can do some emergency saving if it wants to. */
static void (*safe_malloc_callback)(int error_number, size_t requested);

void safe_malloc_set_callback(void (*callback)(int, size_t))
{
    safe_malloc_callback = callback;
}

void *safe_malloc(size_t n)
{
    void *p;

    if (n == 0)
        n = 1; /* malloc(0) is not well defined. */
    p = malloc(n);
    if (p == NULL) {
        if (safe_malloc_callback)
            safe_malloc_callback(errno, n);
        exit(EXIT_FAILURE);
    }
    return p;
} 
```

Valerie Aurora 的文章[Crash-only software](http://lwn.net/Articles/191059/)可能很有启发性。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-18T10:05:01.217

看看问题的另一面：如果你 malloc 内存，它失败了，而你在 malloc 处*没有* 检测到它，你什么时候*检测*到它？

显然，当您尝试取消引用指针时。

你将如何检测它？通过获得一个`Bus error`或类似的东西，在 malloc 之后的某个地方，您必须使用核心转储和调试器进行跟踪。

另一方面，你可以写

```
 #define OOM 42 /* just some number */

  /* ... */

  if((ptr=malloc(size))==NULL){
      /* a well-behaved fprintf should NOT malloc, so it can be used
       * in this sort of context
       */
      fprintf(stderr,"OOM at %s: %s\n", __FILE__, __LINE__);
      exit(OOM);
   } 
```

并获得“parser.c:447 处的 OOM”。

你选。

### 更新

关于优雅回报的好问题。确保优雅返回的困难在于，通常你真的无法建立一个范例或模式来说明你如何做到这一点，尤其是在 C 中，它毕竟是一种花哨的汇编语言。在垃圾收集环境中，您可以强制进行 GC；在带有异常的语言中，您可以抛出异常并展开事情。在 C 中，你必须自己做，所以你必须决定要投入多少精力。

在*大多数*程序中，异常终止是您能做的最好的事情。在这个方案中，您（希望）在 stderr 上得到一个有用的消息——当然它也可能是一个记录器或类似的东西——以及一个作为返回码的已知值。

具有较短恢复时间的高可靠性程序会将您推向类似[恢复块](http://www.cs.ncl.ac.uk/publications/books/papers/101.pdf)的状态，您可以在其中编写代码以尝试使系统恢复到可生存状态。这些很棒，但很复杂；我链接到的论文详细讨论了它们。

中间，你可以想出一个更复杂的内存管理方案，比如管理你自己的动态内存池——毕竟，如果别人可以写 malloc，你也可以。

但是没有一般的模式（无论如何我都知道）进行*足够*的清理以能够可靠地返回并让周围的程序继续。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-18T08:56:05.703

无论平台如何（可能是嵌入式系统除外），检查`NULL`然后直接退出而不手动进行任何（或大量）清理是一个好主意。

内存不足不是一个简单的错误。这对当今的系统来说是一场灾难。

The *Practice of Programming*（Brian W. Kernighan 和 Rob Pike，1999 年）一书定义了类似`emalloc()`这样的函数，如果没有剩余内存，就会退出并显示错误消息。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-18T10:09:58.363

这取决于你在写什么。它是一个通用库吗？如果是这样，您希望尽可能优雅地处理内存不足问题，特别是如果可以合理预期它将用于 el-cheapo 系统或嵌入式设备。

考虑一下：程序员正在使用您的库。他的程序中有一个错误（可能是未初始化的变量），它向您的代码传递了一个愚蠢的参数，因此试图分配一个 3.6GB 的内存块。显然`malloc()`返回NULL。他宁愿在库代码的某处生成无法解释的段错误，还是返回值来指示错误？

为了避免对代码进行错误检查，一种方法是在开始时分配合理的内存量，并根据需要对其进行子分配。

关于 Linux OOM 杀手，我听说现在主要发行版默认禁用此行为。即使它已启用，也不要误解：`malloc()` *可以*返回 NULL，如果您的程序的总内存使用量超过 4GiB（在 32 位系统上），它肯定会返回。换句话说，即使`malloc()`实际上并不能确保您获得一些 RAM/交换空间，它*也会*保留您的部分地址空间。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-18T09:17:43.013

我建议做一个实验 - 编写一个小程序，它不断分配内存而不释放它，然后在分配失败时打印一条小（固定）消息。当你运行这个程序时，你注意到你的系统有什么影响？消息是否会被打印？

如果系统运行正常并且在显示错误之前保持响应，那么我会说是的，值得检查。OTOH，如果系统在显示消息之前变得缓慢、无响应并且最终无法使用（如果有的话），那么 II 会说不，不值得检查。

**重要提示：在运行此测试之前，请保存所有重要工作。不要在生产服务器上运行它。**

关于 Linux OOM 行为 - 这实际上是可取的，并且是大多数操作系统的工作方式。重要的是要意识到，当您 malloc() 一些内存时，您不是直接从操作系统获取它，而是从 C 运行时库获取它。这通常会要求操作系统预先（或在第一次请求时）提供一大块内存，然后通过 malloc/free 接口进行管理。由于许多程序根本不使用动态内存，因此操作系统不希望将“真实”内存交给 C 运行时 - 相反，它会交给一些未提交的虚拟机，这些虚拟机实际上会在您进行 malloc 调用时被提交。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-18T08:59:49.017

对于当今的计算机和通常安装的 RAM 量，到处检查内存分配错误可能过于详细。正如您所看到的，通常很难或不可能对要解除分配的内容做出合理的决定。随着您的进程分配越来越多的内存，操作系统将相应地减少可用于磁盘缓冲区的内存量。当它低于某个阈值时，操作系统将开始将内存分页到磁盘。（这是一种简化，因为内存管理中有很多因素。）

一旦操作系统开始分页内存，整个系统就会变得越来越慢，并且可能需要很长时间才能让您的应用程序真正从 malloc 中看到 NULL（如果有的话）。

在当今系统上可用的大量内存中，“内存不足”错误更有可能意味着代码中的错误试图分配任意数量的内存。在这种情况下，您的过程中再多的释放和重试都无法解决问题。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-18T08:55:57.717

您必须权衡哪个对您来说更好或更坏：将所有工作都用于检查 OOM 或让您的程序在意外时间失败

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-18T11:46:58.177

进程通常在堆栈大小上以资源限制（参见 ulimit (3)）运行，而不是在堆大小上。malloc (3) 将从操作系统逐页管理其堆区域的内存增加，并且操作系统将安排此页面以某种方式物理分配并对应于您的进程的堆。如果您的计算机中没有更多的 RAM，那么大多数操作系统都有类似磁盘上的交换分区之类的东西。当您的系统开始需要使用交换时，事情会逐渐变慢。如果一个过程导致了这种情况，它可以很容易地用 ps (1) 之类的实用程序来识别。

除非您的代码要在资源限制的情况下运行，或者在内存容量较小且没有交换的系统上运行，否则我认为可以假设 malloc (3) 成功进行编程。如果您不确定，只需制作一个虚拟包装器，有朝一日可能会进行检查并简单地退出。错误状态返回值没有意义，因为您的程序需要它已经分配的内存。如果你的 malloc (3) 失败并且你不检查 NULL，那么当它开始访问它获得的 (NULL) 指针时，你的进程无论如何都会死掉。

malloc (3) 的问题在大多数情况下不是由内存不足引起的，而是由于程序中的逻辑错误导致对 malloc 和 free 的不当调用。通过检查 malloc 成功不会检测到这个常见的问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-18T20:01:57.007

好。一切视情况而定。

首先。如果您检测到内存不足以满足您的需求 - 您会怎么做？最常见的用法是：

```
if (ptr == NULL) {
    fprintf(log /* stderr or anything */, "Cannot allocate memory");
    exit(2);
} 
```

好。即使它不使用 malloc，它也可以分配缓冲区。如果它是一个 GUI 应用程序，那就太糟糕了——您的用户不太可能发现它。如果您的用户“足够聪明”从控制台运行应用程序来检查错误，他可能会看到某些东西吞噬了他的全部记忆。行。那么可能会显示一个对话框吗？但是显示对话框可能会吃掉资源——而且通常会。

其次——为什么需要OOM的信息？它发生在两种情况下：

1.  其他软件有问题。你不能用它做任何事情
2.  你的程序有问题。在这种情况下，它是一个 GUI 程序，您不太可能以任何方式通知用户（更不用说 99% 的用户没有阅读消息，并且会说软件崩溃而没有进一步的细节）。如果不是，用户很可能会发现它（观察系统监视器或使用更专业的软件）。
3.  要释放一些缓存等。您应该签入系统，但请注意它可能无法正常工作。您只能处理自己的 sbrk/mmap/etc。调用，在 Linux 中你无论如何都会得到 OOM

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-18T08:57:18.070

是的，我相信它是，如果您始终如一地遵循这种做法。这对于用 C 编写的大型程序可能不切实际，因为这可能需要大量的体力劳动，但在更现代的语言中，大部分工作都是为您完成的，因为内存不足会导致抛出异常。

始终这样做的好处是程序不会由于内存不足导致缓冲区溢出而进入未定义状态（这显然会由于提前退出函数而导致未定义状态的可能性，尽管这是不同类别的错误）。这样做后，您的程序可以始终如一地处理错误情况，或者如果失败是严重的，则决定以优雅的方式退出。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-18T09:32:53.897

如果您设计错误的软件，检查 OOM 条件并采取适当的措施可能会很困难。您是否真的需要检查这种情况取决于您想要获得的软件的可靠性。

例如，VirtualBox 虚拟机管理程序将检测内存不足错误并优雅地暂停虚拟机，允许用户关闭一些应用程序以释放内存。我在 Windows 下观察到了这种行为。实际上，VirtualBox 中几乎所有的调用都有成功指示符作为返回值，您可以只返回`VERR_NO_MEMORY`表示内存分配失败。这引入了一些额外的检查，但在这种情况下它是值得的。

# c# - DataGridView 项目双击

> ID：763162
> 
> 赞同：10
> 
> 时间：2009-04-18T08:50:12.253
> 
> 标签：c#, .net, winforms, datagridview

我在 Windows 窗体中有一个 DataGridView。我想处理每个单元格上的双击事件以显示与该记录相关的详细信息表单。不幸的是，双击列标题时会执行双击事件。我该怎么办？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-18T14:59:35.047

您应该检查事件参数的`RowIndex`and`ColumnIndex`属性。如果其中一个为负数，则表示单击了行标题或列标题，您应该忽略该事件。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-18T09:08:02.507

你在处理什么事件？理想情况下，您应该处理`CellDoubleClick`或`CellMouseDoubleClick`事件并在该处理程序中打开您的详细信息表单。后一个事件将使用任何鼠标按钮捕获双击（可以使用`MouseEventArgs.Button`属性查询按钮。

# c - C中的字符移位

> ID：763172
> 
> 赞同：0
> 
> 时间：2009-04-18T08:56:20.647
> 
> 标签：c, char

我试图在库中找到可以根据需要来回移动字符的函数，例如：

如果此函数消耗 'a' 和一个数字向前移动 3 ，它将被移动 3 次并且输出将是 'd'。

如果这个函数消耗 '5' 和一个向前移动的数字 3 ，它将被移动 3 次并且输出将是 '8'。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-18T08:59:55.677

您不需要调用函数来执行此操作。只需将数字直接添加到字符即可。

例如：

```
'a' + 3 
```

评估为

```
'd' 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-18T08:58:04.543

鉴于您的要求，这样做：

```
char char_shift(char c, int n) {
   return (char)(c + n);
} 
```

如果你的意思是别的东西（也许打算'Z' + 1 = 'A'），那么重写你的问题......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T09:47:21.523

在 C 中，a**`char`**是整数类型（如**`int`**, 和**`long long int`**）。

它的功能与其他整数类型一样，除了它可以存储的值范围通常限制为 -128 到 127 或 0 到 255，尽管这取决于实现。

例如：

```
char x = 3;
char y = 6;
int z;

z = x + y;
printf("z = %d\n", z); //prints z = 9 
```

类型（通常作为数组的**`char`**一部分）最常用于存储文本，其中每个字符都编码为数字。

字符和字符串常量很方便。如果我们假设机器使用[ASCII](http://en.wikipedia.org/wiki/ASCII)字符集（今天几乎无处不在），在这种情况下大写 A 被编码为 65，那么：

```
char x = 'A';
char str[] = "AAA"; 
```

相当于

```
char x = 65;
char str[] = {65, 65, 65, 0}; 
```

因此，类似的东西`'X' + 6`非常有意义 - 结果将取决于字符编码。在 ASCII 中，它相当于`88 + 6`which is `94`which is `'^'`。

# xml - 关心写xml

> ID：763177
> 
> 赞同：0
> 
> 时间：2009-04-18T09:00:14.477
> 
> 标签：xml, vb.net

我有一个邮件应用程序。在发送给每个收件人时，我正在写入一个名为 mail.xml 的 XML 文件。我使用以下代码：

```
Dim from As String = txtFrom.Text
Dim txto As String = txtTo.Text
Dim subj As String = txtSubject.Text
Dim body As String = txtBody.Text
Dim settings As New XmlWriterSettings()
settings.Indent = True
settings.NewLineOnAttributes = True
Using writer As XmlWriter = XmlWriter.Create("C:\xmlmailfile.xml", settings)
  writer.WriteStartDocument()
  writer.WriteStartElement("EMail")
  writer.WriteStartElement("From")
  writer.WriteStartAttribute("From")
  writer.WriteValue(from)
  writer.WriteEndAttribute()
  writer.WriteStartElement("To")
  writer.WriteStartAttribute("To")
  writer.WriteValue(txto)
  writer.WriteEndAttribute()
  writer.WriteStartElement("Subject")
  writer.WriteStartAttribute("Subject")
  writer.WriteValue(subj)
  writer.WriteEndAttribute()
  writer.WriteStartElement("Body")
  writer.WriteStartAttribute("Body")
  writer.WriteValue(body)
  writer.WriteEndAttribute()
  writer.WriteEndElement()
  writer.WriteEndDocument()
  writer.Flush()
End Using 
```

输出是：

```
<?xml version="1.0" encoding="utf-8" ?> 
<EMail>
  <From From="abc@xyz.com">
  <To To="def@pqr.com">
    <Subject Subject="Hi">
      <Body Body="Hello" /> 
    </Subject>
  </To>
  </From>
 </EMail> 
```

在这里，我无法附加到现有输出。只有一个“电子邮件”部分正在输出。我想为每个收件人添加一个“电子邮件”部分。但是，在上面的代码中，新的部分替换了以前编写的部分。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-18T09:18:32.577

XML 文档只能有一个根元素。我建议你有一个根`Emails`元素，`Email`它下面有元素。请注意，您仍然无法在同一个文件中附加新元素 - 您必须读取现有文件并重写它。理论上你*可以*只覆盖最后一行（你总是知道它会有多长时间，所以你可以找到正确的地方）但是将文件读入内存，附加一个新`Email`元素，然后写出更健壮整个文档。

*我也认为在*主题元素中包含`Body`元素有点奇怪。我建议这样的结构：

 *```
<?xml version="1.0" encoding="utf-8" ?> 
<Emails>
  <Email>
    <From Address="abc@xyz.com">
    <Recipient Type="To" Address="def@pqr.com" />
    <Recipient Type="Cc" Address="ghi@pqr.com" />
    <Subject>Hi</Subject>
    <Body>Body text</Body> 
  </Email>
  <Email>
    <!-- Second email comes here -->
  </Email>
</Emails> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T09:23:00.100

除了实施 Jon 关于对 XML 进行必要修改的建议之外，您还需要遍历 XmlWriter 的`WriteXXX`方法。从电子邮件元素开始并为每个收件人循环。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T12:57:52.487

作为对您在内存中修改它的评论的回应：

考虑编写这样的模式：

```
<?xml version="1.0" encoding="utf-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema">
  <xs:complexType name="FromType">
    <xs:attribute name="Address" type="xs:string"/>
  </xs:complexType>
  <xs:simpleType name="RecipientMethod">
    <xs:restriction base="xs:string">
      <xs:enumeration value="To"/>
      <xs:enumeration value="Cc"/>
      <xs:enumeration value="Bcc"/>
    </xs:restriction>
  </xs:simpleType>
  <xs:complexType name="RecipientType">
    <xs:attribute name="Type" type="RecipientMethod"/>
    <xs:attribute name="Address" type="xs:string"/>
  </xs:complexType>
  <xs:complexType name="Email">
    <xs:sequence>
      <xs:element name="From" type="FromType" minOccurs="1" maxOccurs="1"/>
      <xs:element name="Recipient" type="RecipientType" minOccurs="1" maxOccurs="unbounded"/>
      <xs:element name="Subject" type="xs:string" minOccurs="0" maxOccurs="1"/>
      <xs:element name="Body" type="xs:string" minOccurs="0" maxOccurs="1"/>
    </xs:sequence>
  </xs:complexType>
  <xs:complexType name="Emails">
    <xs:sequence>
      <xs:element name="Emails" type="Email" minOccurs="1" maxOccurs="unbounded"/>
    </xs:sequence>
  </xs:complexType>
  <xs:element name="Emails" type="Emails"/>
</xs:schema> 
```

并在其上运行模式编译器 xsd.exe（[此处](http://msdn.microsoft.com/en-us/library/x6c1kb0s.aspx)）

使用它生成的类，您只需设置成员，如下所示：

```
Emails e= new Emails();
e.Email = new Email[2];
e.Email[0] = new Email();
e.Email[0].From = new FromType();
... 
```

设置成员后，请执行以下操作：

```
FileStream f ...
XmlSerializer x = new XmlSerializer( e, f );
x.Serialize(e); 
```

同样，您可以反序列化：

```
Emails ne = x.DeSerialize(); 
```

然后修改它以添加一个新的电子邮件：

```
Email newEmail = Email[ne.Email.Length + 1];
for(int i = 0; i < ne.Email.Length; i++)
    newEmail[i] = ne.Email[i];
newEmail[ne.Email.Length] = new Email();
....
ne.Email = newEmail; 
```

然后将其序列化。

# php - WordPress 中的替代帖子

> ID：763179
> 
> 赞同：1
> 
> 时间：2009-04-18T09:02:24.563
> 
> 标签：php, wordpress

为了在我的 WordPress 网站上投放广告，但每隔几篇文章，我想在每篇文章的底部添加一个简单的条件，其中包含我的广告代码。

我有以下内容：

```
<?php if (the_ID() % 3 == 0){ ?>
ad code

<?php } ?> 
```

但这所做的只是回应帖子的 id.... 对于每个帖子！

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T09:12:57.393

`the_ID`所做的只是*回*显当前帖子的 ID 。

如果要*获取*ID，请`get_the_ID()`改用。

# c++ - 我们如何确保缓存以减少 SQLite 数据库的文件系统写入周期

> ID：763184
> 
> 赞同：1
> 
> 时间：2009-04-18T09:13:11.417
> 
> 标签：c++, c, linux, sqlite

我想在`SQLite`数据库中实现缓存。我的主要目标是将数据写入**RAM**，当缓存被填满时，我想将所有数据刷新到磁盘数据库。我想知道这是否可能？如果可能的话，我可以有一些示例代码吗？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T09:32:18.487

SQLite 已经进行了自己的缓存，这可能比您可以实现的任何东西都更有效 - 您可以在[此处](http://www.sqlite.org/c3ref/pcache_methods.html)阅读有关它的接口的信息。您可能对其他优化感兴趣 - 这里有一个常见问题[解答](http://web.utk.edu/~jplyon/sqlite/SQLite_optimization_FAQ.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T23:38:17.487

由于 sqlite 是事务性的，它依赖 fsync 来确保在提交事务时完成一组特定的语句。fsync 的速度和实现因平台而异。

因此，通过在事务中批处理多个语句，您可以显着提高速度，因为在调用 fsync 之前将写入多个数据块。

[这里](http://www.sqlite.org/speed.html)的一篇较早的 sqlite 文章说明了在事务内部和外部执行多个 INSERT 之间的区别。

但是，如果您正在编写需要并发访问数据的应用程序，请注意当 sqlite 启动写入事务时，所有读取（选择语句）都将被阻止。您可能想探索在写入事务发生时使用内存中的缓存来检索数据。

话虽如此，sqlite 的缓存方案也有可能为您处理。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T09:40:32.413

您可能想查看[SQLite 微调命令（pragmas）](http://www.sqlite.org/pragma.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-19T00:47:38.083

你为什么要这样做？您是否遇到性能问题？或者您想阻止其他连接看到数据，直到您将数据提交到磁盘？

关于同步到磁盘，需要在数据库完整性和速度之间进行权衡。你想要什么取决于你的情况。

1.  使用事务。优点：可靠性高，操作简单。缺点：一旦你开始一个事务，除非你`COMMIT`或`ROLLBACK`. 这通常是最好的解决方案。如果你一次有很多工作要做，开始一个事务，写下你需要的一切，然后`COMMIT`。您的所有更改都将缓存在 RAM 中，直到您`COMMIT`，此时数据库将显式同步到磁盘。

2.  使用[`PRAGMA journal_mode=MEMORY`](http://www.sqlite.org/pragma.html#pragma_journal_mode)和/或[`PRAGMA synchronous=OFF`](http://www.sqlite.org/pragma.html#pragma_synchronous)。优点：速度快，操作简单。缺点：数据库不再对断电和程序崩溃安全。 **使用这些选项可能会丢失整个数据库**。但是，它们避免经常显式同步到磁盘。

3.  将您的更改写入[内存数据库](http://www.sqlite.org/inmemorydb.html)并在需要时手动同步。优点：速度快，可靠。缺点：复杂，另一个程序可以在你不知道的情况下写入数据库。通过写入内存数据库，您无需同步到磁盘，除非您愿意。其他程序可以写入数据库文件，如果您不小心，您可能会覆盖这些更改。这个选项可能太复杂了，不值得。

# c# - 功能 或谓词 ?

> ID：763188
> 
> 赞同：8
> 
> 时间：2009-04-18T09:15:19.307
> 
> 标签：c#, linq, delegates, lambda

我一次又一次地看到使用`Func<TObject, bool>`when的 API（特别是在 .NET 框架中）`Predicate<TObject>`似乎是一个完全负责任的选择。API 设计人员可能有什么*好的*理由这样做？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-18T09:21:49.867

在 LINQ 中，`Func<T, bool>`用于类似`Where`这样的事情，以便采用索引和元素的其他重载是一致的：

```
IEnumerable<T> Where(IEnumerable<T> source, Func<T, bool> predicate)
IEnumerable<T> Where(IEnumerable<T> source, Func<T, int, bool> predicate) 
```

我个人认为这个名字`Predicate`更具描述性，所以*我*会在没有像上面那样的一致性问题的情况下使用它。请注意，只需要了解`Action`和`Func`委托类型就可以说...

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T09:19:00.437

与 LINQ 的其余部分保持一致？

（已注意到“异常”，但对于匿名委托和 lambda 函数，它没有任何区别，因此几乎不需要注意区别。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T09:20:03.257

Func<> 委托是为方法指定 lambda/委托的“新”方式。但是，只有一组方便的委托，如果有更具体的委托做同样的事情，那就去吧。

在您的示例中，我总是选择 Predicate<> 因为它更具自我记录性（假设谓词是您想要的）

# html - HTML - 调整 div

> ID：763192
> 
> 赞同：1
> 
> 时间：2009-04-18T09:18:28.207
> 
> 标签：html, css

我有一个包含以下 div 的网页。

```
<div id="main">
    <div id=left></div>
    <div id=right></div>
</div> 
```

由于页面的主体是蓝色背景色，并假设 div left 和 div right 是白色的。当说右 div 的内容达到 div main 的高度时，div main 不会扩展，所以看起来很奇怪。

当 div 右扩展超过它时，如何让 div main 扩展？

希望这不会令人困惑。

马尔科姆

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T09:23:19.693

我假设“左”和“右”意味着你用你的 CSS 左右浮动它们。

如果是这样，您需要[清除它们](http://www.quirksmode.org/css/clearing.html)。让你的 HTML 看起来像这样：

```
<div id="main">
    <div id=left></div>
    <div id=right></div>
    <br style='clear: both;'>
</div> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-19T16:29:03.857

你应该给 #main 的 CSS 提供 overflow: hidden 属性。此外，您应该**始终**引用属性值。（在将 id 分配给#left 和#right 时，您没有这样做）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T10:29:52.543

您可以（需要）使用重置 css 文件来处理这些 css 问题。[您可以从此处](http://developer.yahoo.com/yui/reset/) 查看有关 Yahoo 重置 css 文件的详细信息

希望这有帮助

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T10:37:47.097

您的“左”和“右” div 是否浮动？默认情况下，您的“主”div 不会围绕它包含的浮动元素展开。您可以通过在 CSS 中添加`overflow: auto`to来解决此问题。`div#main`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T12:26:26.647

你可以尝试这样的事情：

```
<html>
<head>
<style>
#equal      {
        overflow: hidden;
        }

#left, #right{
        padding-bottom: 5000px;
        margin-bottom: -5000px;
        width: 150px;
        }

#left       {
        float: left;
        background-color: red;
        }

#right      {
        float: right;
        background-color: green;
        }
</style>
</head>
<body>
<div id="main">
<div id="equal">
<div id="left">blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah blah </div>
<div id="right">blah blah blah blah blah blah </div>
</div>
</div>
</body>
</html> 
```

# matlab - MATLAB deconvolucy.m 中数组类型“DAMPAR”的问题

> ID：763204
> 
> 赞同：0
> 
> 时间：2009-04-18T09:27:55.143
> 
> 标签：matlab, image, image-processing

下面是我尝试编辑的部分代码，MATLAB 的[deconvolucy](http://www.mathworks.com/access/helpdesk/help/toolbox/images/index.html?/access/helpdesk/help/toolbox/images/deconvlucy.html)。
类类型不匹配的 DAMPAR 似乎有问题。

任何人都可以提供帮助，或者是否有人知道更好的方式来调用我（如在 deconvolucy.m 中）可以容忍的图像？

[也许我应该在使用前将图像转换为数组？我该怎么做？]

// -- 代码 -- //
*I = imread('C:\Users\Lem\Desktop\III\TIFF\69_M.000.tif', 'tif');
类(I)
PSF = fspecial('高斯',7,10);
V = .0001;
BlurredNoisy = imnoise(imfilter(I,PSF),'gaussian',0,V);
WT = 零（大小（I））；
WT(5:end-4,5:end-4) = 1;
J1 = deconvlucy(BlurredNoisy,PSF);
J2 = deconvlucy(BlurredNoisy,PSF,20,sqrt(V));
J3 = deconvlucy(BlurredNoisy,PSF,20,sqrt(V),WT);
//...
...
...//*

？？？在 316 处使用 ==> deconvlucy>parse_inputs 时出错
在函数 deconvlucy 中，DAMPAR 必须与输入图像属于同一类。

*==> deconvlucy 中的错误 102
[J,PSF,NUMIT,DAMPAR,READOUT,WEIGHT,SUBSMPL,sizeI,classI,numNSdim]=...*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T11:01:57.647

您已使用 imread 读取图像。所以它可能以 uint8 的形式出现？imread 的帮助说结果将是 tiff 图像的某个顺序的整数。归还时我是什么班级？

然后过滤图像。似乎 imfilter 将为整数输入图像返回一个整数图像。

接下来，使用 imnoise 添加噪声。从 imnoise 的在线帮助中，它在内部将图像转换为 [0,1]（双）数，添加高斯噪声，然后转换回整数输出。所以你的模糊图像应该仍然是整数，可能是 uint8 元素。

fspecial 的帮助说它将返回 PSF 的双精度输出。

您只使用两个参数调用了反卷积，因此它使用 DAMPAR 的默认值。（我认为这不应该在这里失败。反卷积的作者似乎没有提供与输入类型一致的默认值。）

对 IPT 或反卷积不太了解，我可能首先建议使用两个不同的调用重新运行此代码。

```
J1 = deconvlucy(BlurredNoisy,PSF,[],0);

J1 = deconvlucy(BlurredNoisy,PSF,[],uint8(0)); 
```

如果其中一个调用没有解决问题，则表明反卷积需要图像的双重输入 BlurredNoisy。去卷积的在线帮助在这里并不具体。它只是说 I 可能是 N 维数组或单元数组。进一步在帮助中，它将结果称为数字数组。所以我相信去卷积的图像应该是浮点图像。（按照我的标准，这是帮助中的一个缺陷。）

然后我可能会尝试将您的图像缩放为 [0,1] 作为双倍。然而，这只是一个猜测。所以像：

```
BlurredNoisy = double(BlurredNoisy)/255; 
```

这假设您的图像最初是课堂上的 uint8 。

# mysql - 集团工会

> ID：763206
> 
> 赞同：0
> 
> 时间：2009-04-18T09:31:29.643
> 
> 标签：mysql, group-by, union

我有以下查询总是给我两行。我想使用 tbluser.userid 将它们分组到一行，是否可以将联合分组？

```
SELECT
SUM(tblfooditem.calories)
FROM tblfooditem
INNER JOIN tbluser ON tblfooditem.userid = tbluser.userid
WHERE tblfooditem.userid=?userid AND tblfooditem.date=?date
GROUP BY tbluser.userid
UNION
SELECT
SUM(tbladdedmealitem.calories)
FROM tbladdedmeal
INNER JOIN tbluser ON tbladdedmeal.userid = tbluser.userid
WHERE tbladdedmeal.userid=?userid AND tbladdedmeal.date=?date
GROUP BY tbluser.userid; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T09:41:37.217

这是可能的。

```
select sum(s) from (
SELECT
    SUM(tblfooditem.calories) S,tbl.userid
    FROM tblfooditem
    INNER JOIN tbluser ON tblfooditem.userid = tbluser.userid
    WHERE tblfooditem.userid=?userid AND tblfooditem.date=?date
    GROUP BY tbluser.userid
    UNION
    SELECT
    SUM(tbladdedmealitem.calories) S,tbl.userid
    FROM tbladdedmeal
    INNER JOIN tbluser ON tbladdedmeal.userid = tbluser.userid
    WHERE tbladdedmeal.userid=?userid AND tbladdedmeal.date=?date
    GROUP BY tbluser.userid
) Q
group by Q.userid 
```

# delphi - 更改 form.showModal 的默认模态结果

> ID：763210
> 
> 赞同：3
> 
> 时间：2009-04-18T09:35:00.350
> 
> 标签：delphi, event-handling, modal-dialog, default, onkeypress

在我的 Delphi 应用程序中，我有一个自定义 Yes, No, Cancel 对话框，将从主窗体调用该对话框以确认保存对当前编辑的文件所做的更改。这通常可以通过 messageDlg() 实现，但我希望这个对话具有自定义外观，所以我试图通过以下方式实现此功能

```
case myDialogue.showModal of
  mrYes: <<save changes>>;
  mrNo: <<quit application without saving changes>>
  mrCancel: <<set the closeAction to caNone and do nothing>>
end; 
```

问题是，默认情况下，表单通过返回*mrNo* `TModalResult`来响应按 Escape 键。而且您可以看到这是多么糟糕，因为您的直觉告诉您，退出模态对话将取消预期的退出应用程序过程，但实际上发生的是您发出*不保存任何更改*命令并且应用程序退出。

直到我以这种方式失去了一个小时的工作，我才注意到这种行为。没有 FormKeyPressed 事件处理程序或*任何*响应按键的内容被放入 myModalDialogue 代码中。它是如此有效，以至于在使用显示的表单中按 Esc`showModal`将返回`mrNo`。如何覆盖此默认行为？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-18T09:37:51.187

您需要确保“否”按钮的 Cancel 属性为 False，并且“取消”按钮的 Cancel 属性为 True。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-18T09:38:31.793

设置对话框中按钮的取消和默认属性。

# c++ - 这段代码会做什么？（内存管理）

> ID：763213
> 
> 赞同：2
> 
> 时间：2009-04-18T09:38:12.793
> 
> 标签：c++, memory-management

```
char *p = new char[200];
char *p1 = p;
char *p2 = &p[100];
delete [] p1; 
```

顺便说一句，这不是一个测试，也不是我真正需要知道的任何事情:)

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-18T09:41:23.503

```
 // allocate memory for 200 chars
 // p points to the begining of that 
 // block
 char *p = new char[200];
 // we don't know if allocation succeeded or not
 // no null-check or exception handling

 // **Update:** Mark. Or you use std::no_throw or set_new_handler. 
 // what happens next is not guranteed

 // p1 now points to the same location as p
 char *p1 = p;

 // another pointer to char which points to the
 // 100th character of the array, note that
 // this can be treated as a pointer to an array
 // for the remaining 100-odd elements
 char *p2 = &p[100];

 // free the memory for 200 chars
 delete [] p1;

 // **Update:** Doug. T
 // [...] p and p2 are now pointing to freed memory 
 // and accessing it will be undefined behavior 
 // depending on the executing environment. 
```

# c# - C#：从字符串中删除特定于语言的符号

> ID：763221
> 
> 赞同：0
> 
> 时间：2009-04-18T09:47:10.073
> 
> 标签：c#

为了这个例子，假设我正在解析一些用德语写的文本。这意味着它包含像 ü 或 Ö 这样的符号。问题在于，当所有德语特定符号都呈现为空方格时。请看一下这张图片：

[图片 http://img8.imageshack.us/img8/7502/93341046.png](http://img8.imageshack.us/img8/7502/93341046.png)

因为我不知道这个符号是 ü 还是 Ö 我想用“。”替换它。（点）。所以上图中的字符串应该变成“Osnabr.ck”。我怎么做？任何帮助将不胜感激！

最好的问候，基里尔

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T09:55:49.897

您可以使用正则表达式来替换您不需要的任何字符。只需将您想要的字符放在否定集中：

```
str = Regex.Replace(str, "[^0-9A-Za-z _]", "."); 
```

您应该查看用于解码文本的编码。看起来您使用的编码与用于对文本进行编码的编码不同，因为字符显示不正确。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T09:51:21.013

如果您想查看实际字符（我注意到您在 Visual Studio 的即时窗口中显示该值），您需要使用可以显示字符的字体。正方形的存在意味着您使用的字体不包含与这些字符匹配的字形。您可以在选项对话框中更改 Visual Studio 各个部分中使用的字体。

[这个问题的更多细节在这里](https://stackoverflow.com/questions/217228/what-does-it-mean-when-my-text-is-displayed-as-boxes)。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-18T12:13:40.657

字符串类上有一个 Replace 方法。用其他东西替换单个字符是最简单的：

```
InnerText.Replace("ü", "."); 
```

您可以通过链接 Replace 来同时更改多个字符：

```
InnerText.Replace("ü", "[ue]").Replace("Ö", "[Oe]"); 
```

# embedded - 为什么 XST 优化了我的寄存器，我该如何阻止它？

> ID：763224
> 
> 赞同：1
> 
> 时间：2009-04-18T09:52:06.973
> 
> 标签：embedded, verilog, fpga, xilinx

我有一个简单的 verilog 程序，它增加一个 32 位计数器，使用 $sformat 将数字转换为 ASCII 字符串，然后使用 FTDI FT245RL 一次将字符串推送到主机 1 个字节。

不幸的是，赛灵思 XST 一直在优化字符串寄存器向量。我尝试过各种初始化和访问例程，但没有成功。我似乎无法关闭优化，而且我在网上找到的所有示例都与我的初始化例程差别不大。我究竟做错了什么？

```
module counter(CK12, TXE_, WR, RD_, LED, USBD);

   input CK12;
   input TXE_;
   output WR;
   output RD_;
   output [7:0] LED;
   inout [7:0] USBD;

   reg [31:0] count = 0;

   reg [7:0] k;
   reg wrf  = 0;
   reg rd   = 1;
   reg [7:0] lbyte = 8'b00000000;   

   reg td              = 1;
   parameter MEM_SIZE  = 88;
   parameter STR_SIZE  = 11;
   reg [MEM_SIZE - 1:0] str;
   reg [7:0] strpos = 8'b00000000;

   initial
     begin
        for (k = 0; k < MEM_SIZE; k = k + 1)
          begin
             str[k]    = 0;
          end
     end

   always @(posedge CK12)
     begin
        if (TXE_ == 0 && wrf == 1)
          begin
             count    = count + 1;
             wrf         = 0;
          end

        else if (wrf == 0)  // If we've already lowered the strobe, latch the data
          begin
             if(td)
               begin
                  $sformat(str, "%0000000000d\n", count);
                  strpos = 0;
                  td     = 0;
               end

             str      = str << 8;
             wrf         = 1;
             strpos      = strpos + 1;       

             if(strpos == STR_SIZE)
               td        = 1;

          end       
     end

   assign RD_             = rd;
   assign WR              = wrf;
   assign USBD            = str[87:80];
   assign LED             = count[31:24];

endmodule 
```

> 从环境 /opt/Xilinx/10.1/ISE 中的文件“3s100e.nph”加载应用程序 Rf_Device 的设备。WARNING:Xst:1293 - FF/Latch str_0 在 block 中有一个常数值 0。此 FF/Latch 将在优化过程中被修整。
> 
> WARNING:Xst:1896 - 由于其他 FF/Latch 修整，FF/Latch str_1 在 block 中具有恒定值 0。此 FF/Latch 将在优化过程中被修整。
> 
> WARNING:Xst:1896 - 由于其他 FF/Latch 修整，FF/Latch str_2 在 block 中具有恒定值 0。此 FF/Latch 将在优化过程中被修整。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T17:56:56.587

$sformat 任务不太可能是可综合的——考虑编译器需要生产什么硬件来实现这个功能！这意味着您的“str”寄存器永远不会更新，因此编译器认为它可以优化它。考虑一个 BCD 计数器，也许还有一个将 BCD 代码转换为 ASCII 代码的查找表。

AFAIK 'initial' blocks are not synthesisable. To initialize flops, use a reset signal. Memories need a 'for' loop like you have, but which triggers only after reset.

# delphi - 如何“扫描”当前安装的 VCL 组件的完整列表

> ID：763232
> 
> 赞同：5
> 
> 时间：2009-04-18T10:08:15.873
> 
> 标签：delphi, class, ide, components, vcl

[对于这个问题](https://stackoverflow.com/questions/691989/full-vcl-class-browser-for-delphi)，我仍然没有找到真正令人满意的答案，现在正在考虑推出自己的答案。我有 ModelMaker 和 GExperts，似乎都没有加载我正在寻找的*综合类层次结构。*同样，我不认为 DevExpress 的人会分叉 CDK 代码，该代码编译完整的类列表以继承... ;-)

所以...

如果我只想为所有**注册**的组件类（或者甚至包括非组件的所有类，如果这同样容易/可能的话）构建一个自引用表，那么最好的方法是什么？

注意：我真的不需要属性/方法细节；只是一个完整的类名（和父名）列表，我可以将其存储到表中并放入树视图中。但是，除此之外的任何内容都非常受欢迎作为奖励信息。:-)

* * *

稍后更新：

一个答案出现在我关于 SO 的“最近”部分，但不是这里的问题（也许他们删除了它？），是这样的：

*“你可能想看看组件搜索的代码，它可能会帮助你枚举所有已安装的组件。”*

该代码可用吗？是这样，它藏在哪里？学习会很有趣。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-18T12:33:10.813

不幸的是，实现 RegisterClass 机制的代码隐藏在 Classes implementation 部分。

如果您需要它来获取 IDE 中安装的组件列表，您可以编写一个设计包，将其安装到 IDE 中并在 ToolsAPI 单元中使用 IOTAPackageServices。这将为您提供已安装软件包及其组件的列表。

注意：您必须将 designide.dcp 添加到您的 'requires' 子句才能使用 Delphi 的内部单元，如 ToolsAPI。

更多的工作，但更通用的方法是枚举所有加载的模块。您可以在包模块上调用 GetPackageInfo (SysUtils) 以枚举包含的单元名称和所需的包。但是，这不会为您提供包中包含的类的列表。

您可以枚举包的导出函数列表（例如，在[JCL](http://jcl.delphi-jedi.org/ "JEDI 代码库")中使用 TJclPeImage ）并搜索那些命名如下：

> `@<unit_name>@<class_name>@`

例如：'@System@TObject@'。

通过使用函数名称调用 GetProcAddress，您可以获得 TClass 引用。从那里您可以使用 ClassParent 遍历层次结构。通过这种方式，您可以枚举在运行使用运行时包编译的 Delphi 可执行文件的进程中加载​​的所有包中的所有类（Delphi IDE 也是如此）。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-19T08:33:30.193

另一个想法是扫描导出函数列表顶部的类型信息，以便您可以跳过进一步枚举。类型信息以前缀“@$xp$”开头的名称导出。这是一个例子：

```
unit PackageUtils;

interface

uses
  Windows, Classes, SysUtils, Contnrs, TypInfo;

type
  TDelphiPackageList = class;
  TDelphiPackage = class;

  TDelphiProcess = class
  private
    FPackages: TDelphiPackageList;

    function GetPackageCount: Integer;
    function GetPackages(Index: Integer): TDelphiPackage;
  public
    constructor Create; virtual;
    destructor Destroy; override;

    procedure Clear; virtual;
    function FindPackage(Handle: HMODULE): TDelphiPackage;
    procedure Reload; virtual;

    property PackageCount: Integer read GetPackageCount;
    property Packages[Index: Integer]: TDelphiPackage read GetPackages;
  end;

  TDelphiPackageList = class(TObjectList)
  protected
    function GetItem(Index: Integer): TDelphiPackage;
    procedure SetItem(Index: Integer; APackage: TDelphiPackage);
  public
    function Add(APackage: TDelphiPackage): Integer; 
    function Extract(APackage: TDelphiPackage): TDelphiPackage;
    function Remove(APackage: TDelphiPackage): Integer;
    function IndexOf(APackage: TDelphiPackage): Integer;
    procedure Insert(Index: Integer; APackage: TDelphiPackage);
    function First: TDelphiPackage;
    function Last: TDelphiPackage;

    property Items[Index: Integer]: TDelphiPackage read GetItem write SetItem; default;
  end;

  TDelphiPackage = class
  private
    FHandle: THandle;
    FInfoTable: Pointer;
    FTypeInfos: TList;

    procedure CheckInfoTable;
    procedure CheckTypeInfos;
    function GetDescription: string;
    function GetFileName: string;
    function GetInfoName(NameType: TNameType; Index: Integer): string;
    function GetShortName: string;
    function GetTypeInfoCount(Kinds: TTypeKinds): Integer;
    function GetTypeInfos(Kinds: TTypeKinds; Index: Integer): PTypeInfo;
  public
    constructor Create(AHandle: HMODULE; AInfoTable: Pointer = nil);
    destructor Destroy; override;

    property Description: string read GetDescription;
    property FileName: string read GetFileName;
    property Handle: THandle read FHandle;
    property ShortName: string read GetShortName;
    property TypeInfoCount[Kinds: TTypeKinds]: Integer read GetTypeInfoCount;
    property TypeInfos[Kinds: TTypeKinds; Index: Integer]: PTypeInfo read GetTypeInfos;
  end;

implementation

uses
  RTLConsts, SysConst,
  PSAPI, ImageHlp;

{ Package info structures copied from SysUtils.pas }

type
  PPkgName = ^TPkgName;
  TPkgName = packed record
    HashCode: Byte;
    Name: array[0..255] of Char;
  end;

  PUnitName = ^TUnitName;
  TUnitName = packed record
    Flags : Byte;
    HashCode: Byte;
    Name: array[0..255] of Char;
  end;

  PPackageInfoHeader = ^TPackageInfoHeader;
  TPackageInfoHeader = packed record
    Flags: Cardinal;
    RequiresCount: Integer;
    {Requires: array[0..9999] of TPkgName;
    ContainsCount: Integer;
    Contains: array[0..9999] of TUnitName;}
  end;

  TEnumModulesCallback = function (Module: HMODULE; Data: Pointer = nil): Boolean;
  TEnumModulesProc = function (Callback: TEnumModulesCallback; Data: Pointer = nil): Boolean;

const
  STypeInfoPrefix = '@$xp$';

var
  EnumModules: TEnumModulesProc = nil;

function PackageInfoTable(Module: HMODULE): PPackageInfoHeader; forward;

function AddPackage(Module: HMODULE; Data: {TDelphiPackageList} Pointer): Boolean;
var
  InfoTable: Pointer;
begin
  Result := False;

  if (Module <> HInstance) then
  begin
    InfoTable := PackageInfoTable(Module);
    if Assigned(InfoTable) then
      TDelphiPackageList(Data).Add(TDelphiPackage.Create(Module, InfoTable));
  end;
end;

function GetPackageDescription(Module: HMODULE): string;
var
  ResInfo: HRSRC;
  ResData: HGLOBAL;
begin
  Result := '';
  ResInfo := FindResource(Module, 'DESCRIPTION', RT_RCDATA);
  if ResInfo <> 0 then
  begin
    ResData := LoadResource(Module, ResInfo);
    if ResData <> 0 then
    try
      Result := PWideChar(LockResource(ResData));
      UnlockResource(ResData);
    finally
      FreeResource(ResData);
    end;
  end;
end;

function EnumModulesPS(Callback: TEnumModulesCallback; Data: Pointer = nil): Boolean;
var
  ProcessHandle: THandle;
  SizeNeeded: Cardinal;
  P, ModuleHandle: PDWORD;
  I: Integer;
begin
  Result := False;

  ProcessHandle := OpenProcess(PROCESS_QUERY_INFORMATION or PROCESS_VM_READ, False, GetCurrentProcessId);
  if ProcessHandle = 0 then
    RaiseLastOSError;
  try
    SizeNeeded := 0;
    EnumProcessModules(ProcessHandle, nil, 0, SizeNeeded);
    if SizeNeeded = 0 then
      Exit;

    P := AllocMem(SizeNeeded);
    try
      if EnumProcessModules(ProcessHandle, P, SizeNeeded, SizeNeeded) then
      begin
        ModuleHandle := P;
        for I := 0 to SizeNeeded div SizeOf(DWORD) - 1 do
        begin
          if Callback(ModuleHandle^, Data) then
            Exit;
          Inc(ModuleHandle);
        end;

        Result := True;
      end;
    finally
      FreeMem(P);
    end;
  finally
    CloseHandle(ProcessHandle);
  end;
end;

function EnumModulesTH(Callback: TEnumModulesCallback; Data: Pointer = nil): Boolean;
begin
  Result := False;
  // todo win9x?
end;

function PackageInfoTable(Module: HMODULE): PPackageInfoHeader;
var
  ResInfo: HRSRC;
  Data: THandle;
begin
  Result := nil;
  ResInfo := FindResource(Module, 'PACKAGEINFO', RT_RCDATA);
  if ResInfo <> 0 then
  begin
    Data := LoadResource(Module, ResInfo);
    if Data <> 0 then
    try
      Result := LockResource(Data);
      UnlockResource(Data);
    finally
      FreeResource(Data);
    end;
  end;
end;

{ TDelphiProcess private }

function TDelphiProcess.GetPackageCount: Integer;
begin
  Result := FPackages.Count;
end;

function TDelphiProcess.GetPackages(Index: Integer): TDelphiPackage;
begin
  Result := FPackages[Index];
end;

{ TDelphiProcess public }

constructor TDelphiProcess.Create;
begin
  inherited Create;
  FPackages := TDelphiPackageList.Create;
  Reload;
end;

destructor TDelphiProcess.Destroy;
begin
  FPackages.Free;
  inherited Destroy;
end;

procedure TDelphiProcess.Clear;
begin
  FPackages.Clear;
end;

function TDelphiProcess.FindPackage(Handle: HMODULE): TDelphiPackage;
var
  I: Integer;
begin
  Result := nil;

  for I := 0 to FPackages.Count - 1 do
    if FPackages[I].Handle = Handle then
    begin
      Result := FPackages[I];
      Break;
    end;
end;

procedure TDelphiProcess.Reload;
begin
  Clear;

  if Assigned(EnumModules) then
    EnumModules(AddPackage, FPackages);
end;

{ TDelphiPackageList protected }

function TDelphiPackageList.GetItem(Index: Integer): TDelphiPackage;
begin
  Result := TDelphiPackage(inherited GetItem(Index));
end;

procedure TDelphiPackageList.SetItem(Index: Integer; APackage: TDelphiPackage);
begin
  inherited SetItem(Index, APackage);
end;

{ TDelphiPackageList public }

function TDelphiPackageList.Add(APackage: TDelphiPackage): Integer;
begin
  Result := inherited Add(APackage);
end;

function TDelphiPackageList.Extract(APackage: TDelphiPackage): TDelphiPackage;
begin
  Result := TDelphiPackage(inherited Extract(APackage));
end;

function TDelphiPackageList.First: TDelphiPackage;
begin
  Result := TDelphiPackage(inherited First);
end;

function TDelphiPackageList.IndexOf(APackage: TDelphiPackage): Integer;
begin
  Result := inherited IndexOf(APackage);
end;

procedure TDelphiPackageList.Insert(Index: Integer; APackage: TDelphiPackage);
begin
  inherited Insert(Index, APackage);
end;

function TDelphiPackageList.Last: TDelphiPackage;
begin
  Result := TDelphiPackage(inherited Last);
end;

function TDelphiPackageList.Remove(APackage: TDelphiPackage): Integer;
begin
  Result := inherited Remove(APackage);
end;

{ TDelphiPackage private }

procedure TDelphiPackage.CheckInfoTable;
begin
  if not Assigned(FInfoTable) then
    FInfoTable := PackageInfoTable(Handle);

  if not Assigned(FInfoTable) then
    raise EPackageError.CreateFmt(SCannotReadPackageInfo, [ExtractFileName(GetModuleName(Handle))]);
end;

procedure TDelphiPackage.CheckTypeInfos;
var
  ExportDir: PImageExportDirectory;
  Size: DWORD;
  Names: PDWORD;
  I: Integer;
begin
  if not Assigned(FTypeInfos) then
  begin
    FTypeInfos := TList.Create;
    try
      Size := 0;
      ExportDir := ImageDirectoryEntryToData(Pointer(Handle), True, IMAGE_DIRECTORY_ENTRY_EXPORT, Size);
      if not Assigned(ExportDir) then
        Exit;

      Names := PDWORD(DWORD(Handle) + DWORD(ExportDir^.AddressOfNames));
      for I := 0 to ExportDir^.NumberOfNames - 1 do
      begin
        if StrLIComp(PChar(DWORD(Handle) + Names^), STypeInfoPrefix, StrLen(STypeInfoPrefix)) <> 0 then
          Break;
        FTypeInfos.Add(GetProcAddress(Handle, PChar(DWORD(Handle) + Names^)));
        Inc(Names);
      end;
    except
      FreeAndNil(FTypeInfos);
      raise;
    end;
  end;
end;

function TDelphiPackage.GetDescription: string;
begin
  Result := GetPackageDescription(Handle);
end;

function TDelphiPackage.GetFileName: string;
begin
  Result := GetModuleName(FHandle);
end;

function TDelphiPackage.GetInfoName(NameType: TNameType; Index: Integer): string;
var
  P: Pointer;
  Count: Integer;
  I: Integer;
begin
  Result := '';
  CheckInfoTable;
  Count := PPackageInfoHeader(FInfoTable)^.RequiresCount;
  P := Pointer(Cardinal(FInfoTable) + SizeOf(TPackageInfoHeader));
  case NameType of
    ntContainsUnit:
      begin
        for I := 0 to Count - 1 do
          P := Pointer(Cardinal(P) + StrLen(PPkgName(P)^.Name) + 2);
        Count := Integer(P^);
        P := Pointer(Cardinal(P) + SizeOf(Integer));
        if (Index >= 0) and (Index < Count) then
        begin
          for I := 0 to Count - 1 do
            P := Pointer(Cardinal(P) + StrLen(PUnitName(P)^.Name) + 3);
          Result := PUnitName(P)^.Name;
        end;
      end;
    ntRequiresPackage:
      if (Index >= 0) and (Index < Count) then
      begin
        for I := 0 to Index - 1 do
          P := Pointer(Cardinal(P) + StrLen(PPkgName(P)^.Name) + 2);
        Result := PPkgName(P)^.Name;
      end;
    ntDcpBpiName:
      if PPackageInfoHeader(FInfoTable)^.Flags and pfPackageModule <> 0 then
      begin
        for I := 0 to Count - 1 do
          P := Pointer(Cardinal(P) + StrLen(PPkgName(P)^.Name) + 2);
        Count := Integer(P^);
        P := Pointer(Cardinal(P) + SizeOf(Integer));
        for I := 0 to Count - 1 do
          P := Pointer(Cardinal(P) + StrLen(PUnitName(P)^.Name) + 3);
        Result := PPkgName(P)^.Name;
      end;
  end;
end;

function TDelphiPackage.GetShortName: string;
begin
  Result := GetInfoName(ntDcpBpiName, 0);
end;

function TDelphiPackage.GetTypeInfoCount(Kinds: TTypeKinds): Integer;
var
  I: Integer;
begin
  CheckTypeInfos;
  Result := 0;
  for I := 0 to FTypeInfos.Count - 1 do
    if (Kinds = []) or (PTypeInfo(FTypeInfos[I])^.Kind in Kinds) then
      Inc(Result);
end;

function TDelphiPackage.GetTypeInfos(Kinds: TTypeKinds; Index: Integer): PTypeInfo;
var
  I, J: Integer;
begin
  CheckTypeInfos;
  Result := nil;
  J := -1;
  for I := 0 to FTypeInfos.Count - 1 do
    if (Kinds = []) or (PTypeInfo(FTypeInfos[I])^.Kind in Kinds) then
    begin
      Inc(J);
      if J = Index then
      begin
        Result := FTypeInfos[I];
        Break;
      end;
    end;
end;

{ TDelphiPackage public }

constructor TDelphiPackage.Create(AHandle: HMODULE; AInfoTable: Pointer = nil);
begin
  inherited Create;
  FHandle := AHandle;
  FInfoTable := AInfoTable;
  FTypeInfos := nil;
end;

destructor TDelphiPackage.Destroy;
begin
  FTypeInfos.Free;
  inherited Destroy;
end;

initialization
  case Win32Platform of
    VER_PLATFORM_WIN32_WINDOWS:
      EnumModules := EnumModulesTH;
    VER_PLATFORM_WIN32_NT:
      EnumModules := EnumModulesPS;
    else
      EnumModules := nil;
  end;

finalization

end. 
```

IDE中安装的测试设计包的单元：

```
unit Test;

interface

uses
  SysUtils, Classes,
  ToolsAPI;

type
  TTestWizard = class(TNotifierObject, IOTAWizard, IOTAMenuWizard)
  private
    { IOTAWizard }
    procedure Execute;
    function GetIDString: string;
    function GetName: string;
    function GetState: TWizardState;
    { IOTAMenuWizard }
    function GetMenuText: string;
  end;

implementation

uses
  TypInfo,
  PackageUtils;

function AncestryStr(AClass: TClass): string;
begin
  Result := '';
  if not Assigned(AClass) then
    Exit;

  Result := AncestryStr(AClass.ClassParent);
  if Result <> '' then
    Result := Result + '\';
  Result := Result + AClass.ClassName;
end;

procedure ShowMessage(const S: string);
begin
  with BorlandIDEServices as IOTAMessageServices do
    AddTitleMessage(S);
end;

{ TTestWizard }

procedure TTestWizard.Execute;
var
  Process: TDelphiProcess;
  I, J: Integer;
  Package: TDelphiPackage;
  PInfo: PTypeInfo;
  PData: PTypeData;

begin
  Process := TDelphiProcess.Create;
  for I := 0 to Process.PackageCount - 1 do
  begin
    Package := Process.Packages[I];
    for J := 0 to Package.TypeInfoCount[[tkClass]] - 1 do
    begin
      PInfo := Package.TypeInfos[[tkClass], J];
      PData := GetTypeData(PInfo);
      ShowMessage(Format('%s: %s.%s (%s)', [Package.ShortName, PData^.UnitName, PInfo^.Name, AncestryStr(PData^.ClassType)]));
    end;
  end;
end;

function TTestWizard.GetIDString: string;
begin
  Result := 'TOndrej.TestWizard';
end;

function TTestWizard.GetName: string;
begin
  Result := 'Test';
end;

function TTestWizard.GetState: TWizardState;
begin
  Result := [wsEnabled];
end;

function TTestWizard.GetMenuText: string;
begin
  Result := 'Test';
end;

var
  Index: Integer = -1;

initialization
  with BorlandIDEServices as IOTAWizardServices do
    Index := AddWizard(TTestWizard.Create);

finalization
  if Index <> -1 then
    with BorlandIDEServices as IOTAWizardServices do
      RemoveWizard(Index);

end. 
```

您必须将 designide 添加到您的 requires 子句中。当你安装这个设计包时，一个新的菜单项 Test 应该出现在 Delphi 的 Help 菜单下。单击它应该会在消息窗口中显示所有加载的类。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T12:19:55.027

你试过Delphi自带的类浏览器吗？

浏览器使用快捷键 CTRL-SHIFT-B 加载。我相信您可以通过在浏览器中单击鼠标右键来访问其选项。在这里，您可以选择仅显示项目中的类或所有已知类。

我还没有检查，但我希望 TComponent 的每个后代，包括已安装的组件都在 TComponent 节点下方可见。使用 CTRL-F 搜索特定类。

* * *

**编辑：**根据这个[Delphi Wiki](http://delphi.wikia.com/wiki/Default_IDE_Shortcut_Keys) page，CTRL+SHIFT+B 仅在 Delphi5 中可用。我没有 Delphi 2007 来检查这个，但如果你在你的版本中找不到类浏览器，我怀疑没有。

# c# - 为什么“while”在 C# 中如此受欢迎？

> ID：763233
> 
> 赞同：4
> 
> 时间：2009-04-18T10:08:56.667
> 
> 标签：c#, for-loop, iteration, while-loop

问题字段有点太短，无法提出我的真正问题。如果有人可以更好地概括它，请随意。

我真正的问题是：这些天我正在阅读很多其他人的 C# 代码，我注意到一种特定形式的迭代被广泛传播，（见代码）。
我的第一个问题是：

所有这些迭代都是等价的吗？

我的第二个是：为什么更喜欢第一个？它与可读性有关吗？现在我不相信第一种形式比 for-form 更易读，一旦你习惯了它，可读性在这些结构中太过主观了，当然，你使用最多的东西看起来更具可读性，但我可以向大家保证，for-form 至少具有同样的可读性，因为它全部在一行中，您甚至可以阅读构造中的初始化。

因此第二个问题：为什么在代码中看到的第三种形式少得多？

```
 // the 'widespread' construct
        int nr = getNumber();
        while (NotZero(nr))
        { 
            Console.Write(1/nr);
            nr = getNumber();
        }

        // the somewhat shorter form
        int nr;
        while (NotZero(nr = getNumber()))           
            Console.Write(1 / nr);            

        // the for - form
        for (int nr = getNumber(); NotZero(nr); nr = getNumber())
            Console.Write(1 / nr); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-18T10:15:16.823

> 所有这些迭代都是等价的吗？

是的

> 为什么更喜欢第一个？有没有。与可读性有关？

因为您可能希望将 nr var 的范围扩展到 while 循环之外？

> 为什么在代码中看到的第 3 种形式少得多？

它是等效的，相同的陈述！您可能更喜欢后者，因为您不想扩展 nr 变量的范围

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-18T10:20:28.667

您显示的第一种和第三种形式重复了对 GetNumber 的调用。我更喜欢第二种形式，尽管它的缺点当然是在一个条件下使用了副作用。但是我几乎*只*用一个while循环来做到这一点。通常我不会将结果作为参数传递 - 我发现自己的常见情况是：

```
string line;
while ( (line = reader.ReadLine()) != null)
... 
```

和

```
int bytesRead;
while ( (bytesRead = stream.Read(buffer, 0, buffer.Length)) > 0)
... 
```

这两个现在对我来说都是惯用的，它们不会给我带来任何问题——正如我所说，它们允许我只陈述每条逻辑一次。

如果你不喜欢有太多范围的变量，你可以引入一个额外的块：

```
{
  int bytesRead;
  while ( (bytesRead = stream.Read(buffer, 0, buffer.Length)) > 0)
  {
     // Body
  }
} 
```

就我个人而言，我不倾向于这样做——“太宽”的范围并没有给我*带来*太多困扰。

我怀疑编写一个封装所有这些的方法不会太难。就像是：

```
ForEach(() => reader.ReadLine(), // Way to obtain a value
        line => line != null,    // Condition
        line =>
{
    // body
}; 
```

请注意，对于线阅读，我有一门课程可以帮助您：

```
foreach (string line in new LineReader(file))
{
    // body
} 
```

（它不仅适用于文件 - 它非常灵活。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-18T10:33:56.933

我认为第三种形式（for-loop）是这些替代方案中最好的，因为它将事物置于正确的范围内。另一方面，不得不重复调用 getNumber() 也有点尴尬。

一般来说，我认为显式循环被广泛过度使用。高级语言应该提供映射、过滤和归约。当这些高级构造适用且可用时，循环代替循环就像使用`goto`代替循环。

如果映射、过滤或缩减不适用，我可能会为这种循环编写一个小宏（不过，C# 没有这些，是吗？）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-18T10:59:23.893

我提供另一种选择

```
 foreach (var x in InitInfinite(() => GetNumber()).TakeWhile(NotZero))
    {
        Console.WriteLine(1.0/x);
    } 
```

其中 InitInfinite 是一个简单的辅助函数。整个程序：

```
using System;
using System.Collections.Generic;
using System.Linq;
class Program
{
    static IEnumerable<T> InitInfinite<T>(Func<T> f)
    {
        while (true)
        {
            yield return f();
        }
    }
    static int N = 5;
    static int GetNumber()
    {
        N--;
        return N;
    }
    static bool NotZero(int n) { return n != 0; }
    static void Main(string[] args)
    {
        foreach (var x in InitInfinite(() => GetNumber()).TakeWhile(NotZero))
        {
            Console.WriteLine(1.0/x);
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-18T10:17:03.823

我认为人们经常使用 while() 循环，因为它最能代表您在脑海中可视化任务的方式。我认为使用它比任何其他循环结构都有任何性能优势。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-18T10:20:30.337

这是一个随机的猜测：

当我编写 C# 代码时，我编写的仅有的两个循环结构是 while() 和 foreach()。也就是说，没有人再使用“for”了，因为“foreach”通常有效并且通常更优越。（这是一个过度概括，但它有一个真理的核心。）结果，我的大脑不得不紧张地阅读任何“for”循环，因为它不熟悉。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-18T12:17:18.510

至于为什么（1）和（2）比（3）“优先”，我的感觉是，大多数人认为后者是一种迭代范围的方式，使用条件来定义范围，而不是继续在某些条件仍然成立时迭代一个块。关键字语义适合这种解释，我怀疑，部分原因是，人们发现表达式在这种情况下最易读。例如，我永远不会使用 (1) 或 (2) 来迭代一个范围，尽管我可以。

在（1）和（2）之间，我被撕裂了。由于紧凑性，我以前最常使用 (2)（在 C 中），但现在（在 C# 中）我通常写 (1)。我想我已经开始重视可读性而不是紧凑性，并且（1）似乎更容易快速解析，因此即使我最终重复了少量逻辑，我也更容易理解。

老实说，我很少再编写 while 语句了，通常在以前使用 while 语句的情况下使用 foreach 或 LINQ。想一想，我也不确定我是否使用了很多 for 语句，除非在单元测试中我生成一些固定数量的测试对象。

# c# - 自定义表单设计器，使用 WinAPI 移动/调整控件大小

> ID：763239
> 
> 赞同：1
> 
> 时间：2009-04-18T10:15:40.440
> 
> 标签：c#, winapi, form-designer

我必须解决一些问题并增强很久以前为数据库项目编写的表单设计器。在设计面板类代码中，我遇到了这些行

```
private void DesignPanel_MouseDown(object sender, MouseEventArgs e)
{
    if (e.Button == MouseButtons.Left)
    {
        (sender as Control).Capture = false;
        switch (FMousePosition)
        {
        case MousePosition.mpNone: 
            SendMessage((sender as Control).Handle, WM_SYSCOMMAND, 0xF009, 0);
            break;// Move
        case MousePosition.mpRightBottom: 
            SendMessage((sender as Control).Handle, WM_SYSCOMMAND, 0xF008, 0);
            break;//RB
        case MousePosition.mpLeftBottom: 
            SendMessage((sender as Control).Handle, WM_SYSCOMMAND, 0xF007, 0); 
            // ... here are similar cases ...
        case MousePosition.mpLeft:
            SendMessage((sender as Control).Handle, WM_SYSCOMMAND, 0xF001, 0);
            break;//L  
        }
    }
} 
```

FMousePosition 指示鼠标是否在选定控件的任何边缘上。

令我困惑的是这些 Windows 消息：似乎没有关于 WM_SYSCOMMAND 参数为 0xF001-0xF009 的文档（也许它启动了某种“拖动/调整大小序列”）。有任何想法吗？

如果我的建议是正确的，那么我该如何取消这些序列？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T10:42:09.113

它们是[未记录](http://msdn.microsoft.com/en-us/library/ms646360(VS.85).aspx)的参数。搜索后，我设法找到了这个列表。

*   **0xF000** ( `SC_SIZE`, 表格居中光标)
*   **0xF001** ( `SC_SZLEFT`, 从左调整大小)
*   **0xF002** (`SC_SZRIGHT`, Resize from right)
*   **0xF003** (`SC_SZTOP`, Resize from top)
*   **0xF004** (`SC_SZTOPLEFT`, Lock the bottom right corner of the form, the top left corner move for resize)
*   **0xF005** (`SC_SZTOPRIGHT`, Same from bottom left corner)
*   **0xF006** (`SC_SZBOTTOM`, Lock top right and left border, resize bottom)
*   **0xF007** (`SC_SZBOTTOMLEFT`, Lock top and right border, resize other border)
*   **0xF008** (`SC_SZBOTTOMRIGHT`, Lock left and top border and resize other)
*   **0xF009** (`SC_SIZE|0x9`, Drag from anywhere)
*   **0xF00F** (`SC_SEPARATOR`)
*   **0xF010** (`SC_MOVE`, Put cursor centered at the upper order)
*   **0xF012** (`SC_DRAGMOVE`, move by dragging)
*   **0xF020** (`SC_MINIMIZE`, Auto-Minimize Form)
*   **0xF030** (`SC_MAXIMIZE`, Auto-Maximize Form)
*   **0xF040** (`SC_NEXTWINDOW`, Stop! You don't want that, it will lock all mouse click and make you reboot)
*   **0xF148** (`SC_SCREENSAVE|0x8`, Activate ScreenSaver)
*   **0xF13E** (`SC_TASKLIST|0xE`, Activate StartButton)

Reference: [http://www.delphi3000.com/articles/article_1054.asp#Comments](http://www.delphi3000.com/articles/article_1054.asp#Comments)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T10:42:45.837

Based on my *Win32 Programming* (Rector and Newcomer) p902-903 explains *`WM_SYSCOMMAND` is sent when the user selects an item from the system menu* (rather than sending the normal `WM_COMMAND`).

The [MSDN help](http://msdn.microsoft.com/en-us/library/ms646360(VS.85).aspx) says SC_SIZE = 0xF000 and it and *Win32 Programming* also say *Windows uses the four low-order bits of the predefined system menu IDs internally* but doesn't go on to clarify their use. Thanks stukelly for clarifying them.

# c# - 如何在 C# 中使用 WinAPI 中的 WSAAsyncSelect？

> ID：763242
> 
> 赞同：0
> 
> 时间：2009-04-18T10:17:09.500
> 
> 标签：c#, winapi, callback, winsock, wsaasyncselect

我厌倦了 .NET BeginRead、EndRead 的东西。我很想像以前在 Delphi/C++ 中那样使用 WSAAsyncSelect

```
//Async CallBack handler Declaration
procedure MessageHandler(var Msg:Tmessage);Message WM_WINSOCK_ASYNC_MSG;

//Where i setup the Async
dwError := WSAAsyncSelect(Sock, form1.handle, WM_WINSOCK_ASYNC_MSG, FD_CLOSE or FD_READ);

//Async Callback Handler
procedure Tform1.MessageHandler(var Msg:Tmessage);
begin
  case WSAGetSelectEvent(MSG.LParam) of //LParam is FD_READ/FR_CLOSE/FD_WRITE
    FD_READ: OnSocketRead(MSG.WParam); //WPARAM is the Socket itself.
    FD_CLOSE: OnSocketClose(MSG.WParam);
  end;
end; 
```

是否可以在 C# 中设置该事件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-20T08:03:04.253

如果我理解正确，您可以使用[`SocketAsyncEventArgs`](http://msdn.microsoft.com/en-us/library/system.net.sockets.socketasynceventargs.aspx)相同的模式。

# java - GWT 对 Java 布局管理器有多少支持？

> ID：763250
> 
> 赞同：1
> 
> 时间：2009-04-18T10:25:22.570
> 
> 标签：java, gwt, layout-manager

这似乎是一个答案是隐含的问题，因此我找不到任何明确的东西。

Google Web Toolkit 是否仅支持自定义布局管理器或 Java 布局管理器的子集？

例如，是否*可以*使用 GroupLayout 获取 Java Swing 应用程序并使其与 GWT 一起使用？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T11:43:00.933

GWT 布局支持是通过“Panel”的子类完成的。其中一些像 'DockPanel' 的行为有点像 Swing 布局 (BorderLayout)，但你永远无法获取 Swing 代码并将其编译成 GWT。

当谈到 GWT 时，这是一个常见的误解。它是用 Java 编写的，仅仅是因为 Java 是静态类型的，并且受到世界级编辑器的广泛支持。它是用 Java 编写的，这与 GWT 团队允许您将 SWT/AWT/Swing 移植到 GWT 的愿望无关。Web 是与桌面不同的环境，并且由于您的代码最终编译为 javascript，因此使用任何类型的 Java 桌面应用程序并点击转换按钮是没有意义的。这就是 Applets 多年前尝试做的事情……我们都知道结果如何；）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T10:37:42.650

不，GWT 不支持来自 Swing/AWT 的布局管理器。这些不兼容。

不兼容的根源在于它们是具有不同 API 的完全不同的技术。Swing/AWT 是基于像素的，而 GWT 呈现为 HTML。GWT 布局仅输出不同的 HTML 标记（div/table/inline 元素，...），而 Swing/AWT 布局实际上计算子组件的位置。在 GWT 中，子项的位置由浏览器在显示时计算。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T11:05:01.290

最重要的问题是万维网不是桌面应用程序，无论您多么希望它是。涉及的问题很多，以下是一些浮现在脑海中的问题：

*   WWW 是无状态的，桌面应用程序不是。WWW 通常是通过 cookie、URI 参数和会话管理来实现有状态的，而现在我们已经使用了几十年，我们主要讨论了 WWW 的有状态/无状态问题。

*   WWW 页面（*现在*）用某种形式的 XML 和通常的 CSS 来描述，其中页面被描述为一棵树。与桌面应用程序相比，虽然它可能对 XML 和普通组件集群做几乎相同的事情，但它只是不一样。最大的问题之一是在 DA 中，这些组件*在***应用程序**级别上本质上是有状态的，而在 WWW 中，您最多可以在**页面**级别上真正有状态，甚至需要 JavaScript/AJAX。

因此，直接使用布局管理器是不行的。但是，假设您使用的 Web UI 框架允许它，您可能会创建一些行为与布局管理器非常相似的东西。虽然我不具体了解 GWT，但我相信至少可以在 JSP（或我最喜欢的[Apache Wicket](http://wicket.apache.org/)）中做一个简单的布局管理器，并使其行为与 Swing 布局管理器一样。

请注意，我的意思是在这里将布局管理器的整个概念重新创建为一组专门的类/诸如此类，正如 Peter Štibraný 回答的那样，GWT 不直接支持它们（事实上，除了 Swing 之外，我没有听说过任何东西) 并且我相信为 Swing 布局管理器创建一个包装/适配器而不是仅仅为 WWW 创建您自己的、专有的会更努力。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-19T05:19:24.417

如果您想要一个 Swing Web 应用程序，请考虑 AjaxSwing，但要为网络延迟和消耗服务器资源做好准备。我认为一旦有了 SVG/VML 库，我们就会看到更多的东西转移到网络上。如果您想查看 JavaScript IDE，请查看 Sun Labs 的 Lively Kernel。人们是否尝试过将 Swing 移植到 GWT？很明显，有很多 Swing 可以移植到 GWT 的 AjaxSwing，只是可能不是 Java2D 的东西。可能一些聪明的公司会想出如何将 Swing 转换为 Web 客户端技术。

# java - 如何将 @BasicMap 用于键值为实体的 HashMap

> ID：763251
> 
> 赞同：0
> 
> 时间：2009-04-18T10:26:04.130
> 
> 标签：java, jpa, eclipselink

对于键值为实体且值为整数的地图，我应该如何使用 EclipseLink 的 @BasicMap 注释？

```
 @Entity
class A {

   // This doesn't work, as the key is an entity
   @BasicMap
   private Map<B, Integer> myMap = new HashMap<B, Integer>();

}

@Entity
class B {
 ...
} 

```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-09T06:13:36.117

我发现这是不可能的，因为 BasicMap 仅适用于主要数据类型。

# c# - 如何阻止 C# 的 switch 语句生成 CIL switch 指令

> ID：763254
> 
> 赞同：4
> 
> 时间：2009-04-18T10:28:07.947
> 
> 标签：c#, clr, switch-statement

C# 的 switch 语句可以编译为 CIL switch 指令或 if/else 指令，具体取决于[此处](https://stackoverflow.com/questions/44905/c-switch-statement-limitations-why#48259)提到的语句中的情况。有没有办法强制编译器总是在代码块中生成 if/else 变体？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-18T10:38:01.823

最简单的方法是在代码中使用 if/else。除此之外，这让读者更清楚这就是你*想要*发生的事情，而不是使用开关。

编辑：好的，所以可读性对你来说并不重要——但基本上如果你想改变编译的代码，源代码就必须改变。您可以使用 Mono 编译器并自己修改它，但我怀疑是否有任何方法可以让 Microsoft 编译器有效地忽略您正在使用 switch 语句。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T11:18:16.750

您是否尝试过不同的编译器（即 Mono），或者尝试将有问题的类放在单独的程序集中并为它切换到不同的语言？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T11:49:55.690

你是如何让编译器做到这一点的？我用VS2008做了一个测试：

```
public static int DoSomething(int i) {
    switch (i) {
        case 1: return 0;
        case 100: return 1;
        case 1000: return 2;
        default: return 3;
    }
} 
```

编译为：

```
.method public hidebysig static int32 DoSomething(int32 i) cil managed
{
    .maxstack 2
    .locals init (
        [0] int32 CS$1$0000,
        [1] int32 CS$4$0001)
    L_0000: nop 
    L_0001: ldarg.0 
    L_0002: stloc.1 
    L_0003: ldloc.1 
    L_0004: ldc.i4.1 
    L_0005: beq.s L_0016
    L_0007: ldloc.1 
    L_0008: ldc.i4.s 100
    L_000a: beq.s L_001a
    L_000c: ldloc.1 
    L_000d: ldc.i4 0x3e8
    L_0012: beq.s L_001e
    L_0014: br.s L_0022
    L_0016: ldc.i4.0 
    L_0017: stloc.0 
    L_0018: br.s L_0026
    L_001a: ldc.i4.1 
    L_001b: stloc.0 
    L_001c: br.s L_0026
    L_001e: ldc.i4.2 
    L_001f: stloc.0 
    L_0020: br.s L_0026
    L_0022: ldc.i4.3 
    L_0023: stloc.0 
    L_0024: br.s L_0026
    L_0026: ldloc.0 
    L_0027: ret 
} 
```

那里没有切换指令。

也许您应该向 Microsoft 提交错误？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-06-07T05:04:15.593

不，您无法控制 C# 编译器如何发出 CIL 指令。即使可以，由于高级编译器优化，AOT 或 JIT 编译器可能会将 CIL 指令转换为本地机器代码指令，这与您所期望的大不相同。

# c# - 字符串填充问题

> ID：763257
> 
> 赞同：0
> 
> 时间：2009-04-18T10:29:33.620
> 
> 标签：c#, string, padding

使用填充下方给出的代码似乎没有按预期播放，理论上文本**“添加此文本”**应该从两个字符串的第 21 列开始，但在 str2 中它有一些额外的空格。在检查两个字符串的长度时，长度结果与预期的相同 20。

```
 string str1 = "Test".PadRight(20);
        string str2 = "Test123".PadRight(20);

        string common = "Add this text";

        MessageBox.Show(str1.Length.ToString());
        MessageBox.Show(str2.Length.ToString());

        MessageBox.Show(str1 + common + "\n" + str2 + common); 
```

以前有人遇到过这个问题吗？有什么明显的我失踪了。

非常感谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T10:33:35.983

也许您的 MessageBox 正在显示可变间距字体？

尝试将字体设置为`Courier New`（在任何相关控件中），看看是否有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T12:27:19.017

将您的代码更改为：

```
 string str1 = "Test".PadRight(20, 'W');
    string str2 = "Test123".PadRight(20, 'I');
    string common = "Add this text";
    MessageBox.Show(str1.Length.ToString());
    MessageBox.Show(str2.Length.ToString());
    MessageBox.Show(str1 + common + "\n" + str2 + common); 
```

这样，您将看到是否正确填充了正确数量的字符，并且您还可以判断这是否是其他人所说的字体宽度问题。

# caching - 如何编写最能利用 CPU 缓存来提高性能的代码？

> ID：763262
> 
> 赞同：171
> 
> 时间：2009-04-18T10:33:53.067
> 
> 标签：caching, performance, cpu-cache

这听起来像是一个主观问题，但我正在寻找的是特定的实例，您可能遇到过与此相关的情况。

1.  如何使代码，缓存有效/缓存友好（更多的缓存命中，尽可能少的缓存未命中）？从这两个角度来看，数据缓存和程序缓存（指令缓存），即一个人的代码中与数据结构和代码结构相关的东西，应该由一个人来处理以使其缓存有效。

2.  是否有任何特定的数据结构必须使用/避免，或者是否有一种特定的方式来访问该结构的成员等......以使代码缓存有效。

3.  是否有任何程序构造（if、for、switch、break、goto、...）、代码流（for 在 if、if 在 for 中等...）在这件事上应该遵循/避免？

我期待听到与制作缓存高效代码相关的个人经验。它可以是任何编程语言（C、C++、Assembly...）、任何硬件目标（ARM、Intel、PowerPC...）、任何操作系统（Windows、Linux、S ymbian...）等。 .

多样性将有助于更好地深入理解它。

* * *

## 回答 #1

> 赞同：127
> 
> 时间：2009-06-19T16:20:47.187

缓存的作用是减少 CPU 等待内存请求完成时停止的次数（避免内存*延迟*），并且作为第二个效果，可能会减少需要传输的数据总量（保留内存*带宽*）。

避免遭受内存获取延迟的技术通常是首先要考虑的事情，而且有时会大有帮助。有限的内存带宽也是一个限制因素，特别是对于许多线程想要使用内存总线的多核和多线程应用程序。一组不同的技术有助于解决后一个问题。

提高**空间局部性**意味着您可以确保每个缓存行在映射到缓存后被完全使用。当我们查看各种标准基准时，我们发现其中很大一部分未能在缓存行被驱逐之前使用 100% 的已获取缓存行。

提高缓存行利用率在三个方面有帮助：

*   它倾向于在缓存中容纳更多有用的数据，从本质上增加有效缓存大小。
*   它倾向于在同一高速缓存行中容纳更多有用的数据，从而增加在高速缓存中可以找到所请求数据的可能性。
*   它降低了内存带宽要求，因为会减少取数。

常用技术有：

*   使用较小的数据类型
*   组织数据以避免对齐漏洞（通过减小大小对结构成员进行排序是一种方法）
*   当心标准的动态内存分配器，它可能会在内存预热时引入漏洞并在内存中传播数据。
*   确保在热循环中实际使用了所有相邻数据。否则，考虑将数据结构分解为热组件和冷组件，以便热循环使用热数据。
*   避免表现出不规则访问模式的算法和数据结构，并支持线性数据结构。

我们还应该注意，除了使用缓存之外，还有其他方法可以隐藏内存延迟。

现代 CPU:s 通常有一个或多个*硬件预取器*。他们训练缓存中的未命中并尝试发现规律。例如，在对后续缓存行进行几次未命中后，硬件预取器将开始将缓存行提取到缓存中，以预测应用程序的需求。如果你有一个常规的访问模式，硬件预取器通常会做得很好。如果您的程序不显示常规访问模式，您可以通过自己添加*预取指令*来改进。

以这样一种方式重新组合指令，使那些总是在缓存中丢失的指令彼此靠近，CPU 有时可以重叠这些提取，以便应用程序只承受一个延迟命中（*内存级并行性*）。

为了减少整体内存总线压力，您必须开始解决所谓的**时间局部性**问题。这意味着您必须在数据尚未从缓存中逐出时重用数据。

合并涉及相同数据的循环（*循环融合*），并采用称为*平铺*或*阻塞*的重写技术，都努力避免那些额外的内存提取。

虽然这个重写练习有一些经验法则，但您通常必须仔细考虑循环携带的数据依赖性，以确保您不会影响程序的语义。

这些东西在多核世界中真正得到了回报，在添加第二个线程后，您通常不会看到太多的吞吐量改进。

* * *

## 回答 #2

> 赞同：59
> 
> 时间：2009-04-18T10:51:26.923

我不敢相信没有更多的答案。无论如何，一个经典的例子是“从里到外”迭代一个多维数组：

```
pseudocode
for (i = 0 to size)
  for (j = 0 to size)
    do something with ary[j][i] 
```

缓存效率低下的原因是，当您访问单个内存地址时，现代 CPU 会从主内存加载具有“近”内存地址的缓存行。我们在内部循环中遍历数组中的“j”（外部）行，因此对于内部循环的每次行程，缓存行将导致刷新并加载靠近 [ j][i] 条目。如果将其更改为等效项：

```
for (i = 0 to size)
  for (j = 0 to size)
    do something with ary[i][j] 
```

它会运行得更快。

* * *

## 回答 #3

> 赞同：48
> 
> 时间：2009-04-18T13:22:56.840

基本规则实际上相当简单。棘手的地方在于它们如何应用于您的代码。

缓存的工作原理有两个：时间局部性和空间局部性。前者的想法是，如果您最近使用了某个数据块，您可能很快就会再次需要它。后者意味着如果您最近使用了地址 X 的数据，您可能很快就会需要地址 X+1。

缓存试图通过记住最近使用的数据块来适应这一点。它使用缓存线运行，通常大小为 128 字节左右，因此即使您只需要一个字节，包含它的整个缓存线也会被拉入缓存。因此，如果您之后需要以下字节，它已经在缓存中。

这意味着您总是希望自己的代码尽可能地利用这两种形式的局部性。不要跳过所有的内存。在一个小区域做尽可能多的工作，然后转移到下一个区域，在那里做尽可能多的工作。

一个简单的例子是 1800 的答案显示的 2D 数组遍历。如果你一次遍历它一行，你就是按顺序读取内存。如果按列执行，您将读取一个条目，然后跳转到完全不同的位置（下一行的开头），读取一个条目，然后再次跳转。当你最终回到第一行时，它将不再在缓存中。

这同样适用于代码。跳转或分支意味着缓存使用效率较低（因为您不是按顺序读取指令，而是跳转到不同的地址）。当然，小的 if 语句可能不会改变任何东西（你只是跳过了几个字节，所以你仍然会在缓存区域内结束），但函数调用通常意味着你正在跳转到一个完全不同的可能不会被缓存的地址。除非它最近被调用。

不过，指令缓存的使用通常不是问题。您通常需要担心的是数据缓存。

在结构或类中，所有成员都是连续布局的，这很好。在一个数组中，所有条目也是连续布局的。在链表中，每个节点都分配在完全不同的位置，这很糟糕。指针通常倾向于指向不相关的地址，如果取消引用它可能会导致缓存未命中。

如果你想利用多个内核，它会变得非常有趣，因为通常情况下，一次只有一个 CPU 在其 L1 缓存中可能有任何给定的地址。因此，如果两个内核不断地访问同一个地址，则会导致不断的缓存未命中，因为它们正在争夺地址。

* * *

## 回答 #4

> 赞同：45
> 
> 时间：2009-04-18T12:56:17.263

如果您对内存和软件的交互方式感兴趣，我建议您阅读 Ulrich Drepper 撰写的由 9 部分组成的文章[每个程序员都应该了解的内存。](http://lwn.net/Articles/250967/)它还[以 104 页的 PDF 格式](http://people.redhat.com/drepper/cpumemory.pdf)提供。

与这个问题特别相关的部分可能是[第 2 部分](http://lwn.net/Articles/252125/)（CPU 缓存）和[第 5 部分](http://lwn.net/Articles/255364/)（程序员可以做什么 - 缓存优化）。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2009-04-18T11:13:55.760

除了数据访问模式，缓存友好代码的一个主要因素是数据*大小*。更少的数据意味着更多的数据适合缓存。

这主要是内存对齐数据结构的一个因素。“传统”智慧说数据结构必须在字边界对齐，因为 CPU 只能访问整个字，如果一个字包含多个值，则必须做额外的工作（读取-修改-写入而不是简单的写入） . 但是缓存可以完全使这个论点无效。

类似地，Java 布尔数组为每个值使用一个完整字节，以便允许直接对单个值进行操作。如果使用实际位，您可以将数据大小减少 8 倍，但是访问单个值会变得更加复杂，需要位移和掩码操作（`BitSet`该类会为您执行此操作）。但是，由于缓存效应，当数组很大时，这仍然比使用 boolean[] 快得多。IIRC I 曾经以这种方式实现了 2 或 3 倍的加速。

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-04-18T10:54:41.643

缓存最有效的数据结构是数组。如果您的数据结构按顺序排列，因为 CPU 从主内存一次读取整个缓存行（通常为 32 字节或更多），则缓存效果最好。

任何以随机顺序访问内存的算法都会破坏缓存，因为它总是需要新的缓存行来容纳随机访问的内存。另一方面，通过数组顺序运行的算法是最好的，因为：

1.  它使 CPU 有机会预读，例如推测性地将更多内存放入缓存中，稍后将访问这些内存。这种预读提供了巨大的性能提升。

2.  在大型数组上运行紧密循环还允许 CPU 缓存循环中执行的代码，并且在大多数情况下，您可以完全从缓存内存中执行算法，而不必阻塞外部内存访问。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2013-05-15T22:58:54.690

我在游戏引擎中看到的一个示例是将数据从对象中移出并移入它们自己的数组中。受物理影响的游戏对象可能还附加了许多其他数据。但是在物理更新循环期间，所有引擎关心的都是关于位置、速度、质量、边界框等的数据。所以所有这些都被放入它自己的数组中，并尽可能针对 SSE 进行优化。

因此，在物理循环期间，物理数据使用矢量数学以数组顺序进行处理。游戏对象使用它们的对象 ID 作为各种数组的索引。它不是指针，因为如果必须重新定位数组，指针可能会失效。

在许多方面，这违反了面向对象的设计模式，但通过将需要在同一个循环中操作的数据放在一起，使代码变得更快。

这个例子可能已经过时了，因为我预计大多数现代游戏都使用像 Havok 这样的预构建物理引擎。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2009-06-01T17:24:30.037

只有一篇文章涉及到它，但是在进程之间共享数据时出现了一个大问题。您希望避免多个进程同时尝试修改同一个高速缓存行。这里需要注意的是“错误”共享，其中两个相邻的数据结构共享一个高速缓存行，并且对其中一个的修改会使另一个的高速缓存行无效。这可能会导致高速缓存行在共享多处理器系统上的数据的处理器高速缓存之间不必要地来回移动。避免它的一种方法是对齐和填充数据结构以将它们放在不同的行上。

* * *

## 回答 #9

> 赞同：7
> 
> 时间：2012-03-19T11:07:13.720

用户*1800 INFORMATION*对“经典示例”的评论（评论太长）

我想检查两个迭代顺序（“外部”和“内部”）的时间差异，所以我用一个大型二维数组做了一个简单的实验：

```
measure::start();
for ( int y = 0; y < N; ++y )
for ( int x = 0; x < N; ++x )
    sum += A[ x + y*N ];
measure::stop(); 
```

和`for`交换循环的第二种情况。

较慢的版本（“x first”）为 0.88 秒，较快的版本为 0.06 秒。这就是缓存的力量:)

我使用过`gcc -O2`，但循环**仍未**优化。*Ricardo*的评论“大多数现代编译器可以自己解决这个问题”并不成立

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-04-18T10:37:13.183

我可以回答 (2)，说在 C++ 世界中，链表很容易杀死 CPU 缓存。在可能的情况下，数组是更好的解决方案。没有关于这是否适用于其他语言的经验，但很容易想象会出现同样的问题。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-04-18T10:50:13.323

高速缓存排列在“高速缓存行”中，并且（实际）内存以这种大小的块读取和写入。

因此，包含在单个高速缓存行中的数据结构更有效。

类似地，访问连续内存块的算法将比以随机顺序跳过内存的算法更有效。

不幸的是，高速缓存行大小在处理器之间变化很大，因此无法保证在一个处理器上最佳的数据结构在任何其他处理器上都是有效的。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-04-18T19:55:42.123

要问如何制作代码，缓存有效缓存友好和其他大多数问题，通常是问如何优化程序，因为缓存对性能的影响非常大，任何优化的程序都是缓存的有效缓存友好。

我建议阅读优化，这个网站上有一些很好的答案。在书籍方面，我推荐[计算机系统：程序员的观点](http://csapp.cs.cmu.edu/)，其中有一些关于正确使用缓存的好文本。

（顺便说一句 - 与缓存未命中一样糟糕，更糟糕的是 - 如果程序正在从硬盘[分页......）](http://en.wikipedia.org/wiki/Paging)

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2016-04-19T01:05:23.167

关于数据结构选择、访问模式等一般建议已经有很多答案了。在这里，我想添加另一个代码设计模式，称为**软件管道**，它利用了主动缓存管理。

这个想法借鉴了其他流水线技术，例如 CPU 指令流水线。

这种类型的模式最适用于那些

1.  可以分解为合理的多个子步骤，S[1], S[2], S[3], ...其执行时间与 RAM 访问时间（~60-70ns）大致相当。
2.  接受一批输入并对它们执行上述多个步骤以获得结果。

让我们看一个只有一个子过程的简单案例。通常代码会这样：

```
def proc(input):
    return sub-step(input)) 
```

为了获得更好的性能，您可能希望将多个输入批量传递给函数，以便摊销函数调用开销并增加代码缓存局部性。

```
def batch_proc(inputs):
    results = []
    for i in inputs:
        // avoids code cache miss, but still suffer data(inputs) miss
        results.append(sub-step(i))
    return res 
```

但是，如前所述，如果该步骤的执行与 RAM 访问时间大致相同，您可以进一步改进代码，如下所示：

```
def batch_pipelined_proc(inputs):
    for i in range(0, len(inputs)-1):
        prefetch(inputs[i+1])
        # work on current item while [i+1] is flying back from RAM
        results.append(sub-step(inputs[i-1]))

    results.append(sub-step(inputs[-1])) 
```

执行流程如下所示：

1.  *prefetch(1)* 要求 CPU 将 input[1] 预取到缓存中，其中 prefetch 指令本身需要 P 个周期并返回，并且在后台 input[1] 将在 R 个周期后到达缓存。
2.  *works_on(0)* 对 0 的冷错过并对其进行处理，这需要 M
3.  *prefetch(2)* 发出另一个 fetch
4.  *works_on(1)* 如果 P + R <= M，则输入[1] 应该在此步骤之前已经在缓存中，从而避免数据缓存未命中
5.  *作品_on(2)* ...

可能涉及更多步骤，然后您可以设计一个多级管道，只要步骤的时间和内存访问延迟匹配，您将遭受很少的代码/数据缓存未命中。然而，这个过程需要通过许多实验来调整，以找出正确的步骤分组和预取时间。由于其所需的努力，它在高性能数据/数据包流处理中得到了更多采用。在 DPDK QoS Enqueue 管道设计中可以找到一个很好的生产代码示例：http: [//dpdk.org/doc/guides/prog_guide/qos_framework.html](http://dpdk.org/doc/guides/prog_guide/qos_framework.html)第 21.2.4.3 章。排队管道。

可以找到更多信息：

[https://software.intel.com/en-us/articles/memory-management-for-optimal-performance-on-intel-xeon-phi-coprocessor-alignment-and](https://software.intel.com/en-us/articles/memory-management-for-optimal-performance-on-intel-xeon-phi-coprocessor-alignment-and)

[http://infolab.stanford.edu/~ullman/dragon/w06/lectures/cs243-lec13-wei.pdf](http://infolab.stanford.edu/%7Eullman/dragon/w06/lectures/cs243-lec13-wei.pdf)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2010-12-06T04:09:57.943

除了对齐你的结构和字段，如果你的结构如果堆分配，你可能想要使用支持对齐分配的分配器；否则你`_aligned_malloc(sizeof(DATA), SYSTEM_CACHE_LINE_SIZE);`可能会有随机的虚假分享；请记住，在 Windows 中，默认堆有 16 字节对齐。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-04-18T11:35:57.410

编写程序以占用最小的大小。这就是为什么对 GCC 使用 -O3 优化并不总是一个好主意。它占据了更大的尺寸。通常，-Os 与-O2 一样好。这一切都取决于所使用的处理器。YMMV。

一次处理少量数据。这就是为什么如果数据集很大，效率较低的排序算法可以比快速排序运行得更快。想办法将较大的数据集分解为较小的数据集。其他人提出了这个建议。

为了帮助您更好地利用指令的时间/空间局部性，您可能需要研究如何将代码转换为汇编。例如：

```
for(i = 0; i < MAX; ++i)
for(i = MAX; i > 0; --i) 
```

这两个循环产生不同的代码，即使它们只是解析一个数组。无论如何，您的问题是非常特定于架构的。因此，严格控制缓存使用的唯一方法是了解硬件的工作原理并针对它优化代码。

# iphone - cocos2d 帮助在圆上找点

> ID：763278
> 
> 赞同：2
> 
> 时间：2009-04-18T10:47:55.433
> 
> 标签：iphone, math, cocos2d-iphone, trigonometry

我正在尝试在 cocos2d for iphone 上下文中解决一个棘手的数学问题。

基本上我有一个随时间旋转的轮盘。

我想在某些点（如罗盘序数点 N、S、E、W）将 Sprite 锁在车轮上，并在所有其他点反弹。

我有轮子旋转的图像，只需要解决我可以测试精灵在旋转时是否在圆的正确点与圆相交的部分。

我认为这个问题正朝着正确的方向发展，但我无法理解它。谁能帮忙解释一下？

[在最接近给定点的圆上找到点的最佳方法](https://stackoverflow.com/questions/300871/best-way-to-find-a-point-on-a-circle-closest-to-a-given-point)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T11:23:11.853

所以你有一个半径为 r 的圆，中心为 (x0,y0)。

一个点位于圆外，坐标为 (x,y)。您的问题是在圆上找到最接近点 (x,y) 的点。

解决方案很简单。点到圆的最接近投影是通过简单的缩放来完成的。因此，

```
d = sqrt((x-x0)^2 + (y-y0)^2)
xp = x0 + (x - x0)*r/d
yp = y0 + (y - y0)*r/d 
```

新点 (xp,yp) 将位于圆本身上。老实说，你最好在极坐标中工作，原点在圆的中心。然后一切都会变得容易得多。

您的下一个问题将是它在圆圈上的哪个位置？不要忘记圆上的指南针的点会随着时间而旋转。atan2 函数将为您提供点 (xp-x0,yp-y0) 所在的角度。大多数工具集都将具有该功能。看到我在这里减去了原点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T11:25:34.500

如果我理解正确：

首先检查精灵与轮盘中心之间的距离。这会告诉你精灵是否在轮子的边缘。（如果没有，什么都不会发生，对吧？）

然后，找出精灵与轮盘赌的“x 轴”形成的角度。

```
spriteAngle = atan2(sprite.x - rouletteCentre.x, sprite.y - rouletteCentre.y) 
```

您需要找到该`atan2()`功能的等价物。它通常以弧度返回答案；如果您愿意，您可能希望将其转换为度数或四分之一圈或其他东西。

然后，减去轮盘本身旋转的角度（如果轮盘本身正在旋转，如果没有，那么你已经完成了）。确保您的角度测量是一致的。

```
actualAngle = spriteAngle - rouletteRotationAngle 
```

请注意，actualAngle 可能在 0-360 度范围之外，您需要使其“环绕”。

最后，您将希望允许小范围的值作为可接受的值（例如，98 度到 102 度可能算作“北”）。

# java - Java中可变模型的声明性派生属性

> ID：763285
> 
> 赞同：3
> 
> 时间：2009-04-18T10:57:50.853
> 
> 标签：java, modeling, data-binding, declarative, frp

是否有用于同步 POJO 属性的框架？例如，我想表达（以某种高级的、声明性的形式），`foo.text = bar.text + baz.text`或者`foo.y = (max(bars, y)).y`不必注册属性更改，元素添加和删除值和（尤其是）集合上的侦听器，这些是重复且容易出错的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T11:01:14.607

[javafx](http://www.javafx.com/)和它的[绑定运算符](http://java.sun.com/javafx/1/tutorials/core/dataBinding/)。例如：

```
var x = 10;
var y = bind -x + 100;
assert y == 90;        // passes
y = 40;                // bind! 
assert x == 60;        // passes 
```

对于 java 看看[JSR 295](https://beansbinding.dev.java.net/)

# linux - 是否有适用于 Linux 的 AppVerifier 或 Driver Verifier 之类的东西？

> ID：763292
> 
> 赞同：3
> 
> 时间：2009-04-18T11:11:24.863
> 
> 标签：linux, testing

我希望有人可以将我指向类似于 Microsoft 工具[Application Verifier](http://technet.microsoft.com/en-us/library/bb457063.aspx)和[Driver Verifier](http://www.microsoft.com/whdc/DevTools/tools/DrvVerifier.mspx)的 Linux 软件。（它们分别是 Windows 应用程序和驱动程序的压力测试器。）

Linux 有这样的东西吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T18:43:20.440

我根本不熟悉应用程序验证器和驱动程序验证器......

对于应用程序，[Valgrind](http://valgrind.org/)作为检查泄漏、释放后使用、双重释放、缓冲区溢出、使用未初始化数据、不安全的并发数据访问等等的工具非常有用。

还存在许多测试程序对无效输入的恢复能力的[fuzzer](http://fusil.hachoir.org/)（[zzuf](http://en.wikipedia.org/wiki/Fuzz_testing)、[fusil](http://caca.zoy.org/wiki/zzuf)等）。

GCC 本身有`-fstackprotector`，它启用了 SSP（堆栈粉碎保护器，又名 ProPolice）；`-fmudflap`，它检测到其他一些不良的内存使用情况；和（与`glibc`）`-D_FORTIFY_SOURCE=`*n*一起，对各种字符串和内存函数进行额外检查。

在Linux内核中，“Kernel hacking”菜单下有很多配置开关：

*   `CONFIG_DEBUG_SLAB`, `CONFIG_DEBUG_PAGEALLOC`, 等，确保内存被合理分配、使用和释放
*   `CONFIG_DEBUG_OBJECTS`，它检查对象是否被有序地使用和释放
*   [kmemcheck](http://git.kernel.org/?p=linux/kernel/git/vegard/kmemcheck.git)，“内核的 Valgrind”
*   [`CONFIG_PROVE_LOCKING`](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=Documentation/lockdep-design.txt;hb=HEAD)，它分析所有可能的死锁
*   `CONFIG_DEBUG_PREEMPT`, `CONFIG_DEBUG_MUTEXES`, `CONFIG_DEBUG_SPINLOCK`, `CONFIG_DEBUG_SPINLOCK_SLEEP`, 等，警告不正确使用锁定
*   [`CONFIG_FAULT_INJECTION`公司](http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=blob;f=Documentation/fault-injection/fault-injection.txt;hb=HEAD) ，这很有可能导致内存分配和 I/O 失败

# xml - Xml 转义/编码术语

> ID：763294
> 
> 赞同：20
> 
> 时间：2009-04-18T11:12:14.253
> 
> 标签：xml, encoding, escaping, html-encode, xml-encoding

我对以下短语中的“转义”和“编码”这两个术语之间的区别感到困惑：

XML 编码

Xml 转义

编码的 HTML

转义网址

...

谁能给我解释一下？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-18T12:04:21.943

[编码](http://en.wikipedia.org/wiki/Character_encoding)描述了文件的字符如何物理地以二进制形式写入（如 Unicode 或 ANSI）。

[转义](http://en.wikipedia.org/wiki/Escape_character)是指将特殊字符（例如`<`and `>`）替换为其[XML 实体](http://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references)等效项（例如`&lt;`and `&gt;`）的过程。对于 URL，转义是指将字符替换为以 开头的字符串`%`，例如`%20`单个空格。

转义因语言而异，但编码通常是被广泛接受的标准。有时这些术语的使用含糊不清（特别是用于表示转义的编码），但它们定义明确且不同。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-10-14T14:51:22.580

在每个 Web 应用程序中，数据由不同的层组成，如视图层、模型层、数据库层等。每一层都“应该”独立开发，以满足各种可伸缩性和可维护性要求。

现在，基本上，每一层都需要相互“交谈”，并且他们必须决定他们可以交谈的语言。这称为编码。存在各种类型的编码，如 ASCII、UTF-8、UTF-16 等。现在，如果用户是中国人或日本人，那么对他来说 ASCII 不起作用，因此他会继续使用 UTF-16 或任何其他能保证中文交流的编码技术。所以从web层开始，汉字要经过业务层，再到数据层，到处都是一样的“编码”方案。

为什么 ？

现在假设，您的 Web 层以 UTF-16 格式发送数据，支持中文，但数据库层只接受 ASCII，那么数据库层会混淆您在说什么！它只理解英文字符，它不会理解其余的。这是关于编码的。

转义：

有一组数据称为“元数据”，从浏览器的角度来看，它们具有特殊的含义。例如，`<>`从浏览器的角度来看是元数据。浏览器解析器知道其中包含的所有数据`<>`都将被解释。现在攻击者使用这种技术来迷惑浏览器。例如 ：

```
<input type="text" value="${name} /> 
```

如果我用

```
name="/><script>alert(document.cookie)</script> 
```

然后浏览器看到的结果代码将是

```
<input type="text" value=""/><script>alert(document.cookie)</script> /> 
```

意思是，现在您需要指示浏览器我放入的任何内容都`name=""`应该被“转义”，或者应该只被视为数据。所以有各种函数可以编码/转义`<>`为它们的 html 等价物`%3C%3E`，所以现在浏览器知道这需要区别对待。基本上逃避意味着逃避他们的实际意义（粗略地说）。

```
 <input type="text" value="${fn:escapeXML(name)} /> 
```

使用 JSTL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-04-20T21:02:11.357

TL;DR**这两个术语是可以互换的**（如果您的意思是转换某些字符，以便将它们解释为纯字符串数据）。这场辩论是老生常谈了。来自[CWE-116：不正确的编码或输出转义](http://cwe.mitre.org/data/definitions/116.html)：

> “编码”和“转义”术语的用法差异很大。例如，在某些编程语言中，术语可以互换使用，而其他语言提供的 API 将这两个术语用于不同的任务。这种重叠的用法延伸到了 Web，例如“转义”JavaScript 函数，其目的是为了编码。当然，编码和转义的概念比 Web 早了几十年。在这样的背景下，CWE 很难采用不会被某些选区误解的一致词汇。

有趣的是，JavaScript 也有`encodeURIComponent()`，它的[规范](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf)完全避免了争论：

> encodeURIComponent 函数**计算一个新版本**的 URI，其中某些字符的每个实例都被一个、两个、三个或四个表示字符的 UTF-8 编码的转义序列替换。

我个人认为将一般过程称为“编码”更合适，因为您正在创建要通过通信通道（一段标记/编程代码）传输并由接收器（解析器）解释的代码[。](http://en.wikipedia.org/wiki/Code)我认为`<`用完全不同的东西代替`&#60;`并称之为“逃避”是愚蠢的。

# java - 在运行时设置 JVM 堆大小

> ID：763295
> 
> 赞同：62
> 
> 时间：2009-04-18T11:13:48.180
> 
> 标签：java, jvm, runtime, heap-memory

有没有办法从正在运行的 Java 程序设置堆大小？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-04-18T11:23:13.587

不。

对于具有非常可变堆要求的应用程序，您可以将最大堆大小设置为非常高`-Xmx`并进行调整`-XX:MaxHeapFreeRatio`，`-XX:MinHeapFreeRatio`以便在堆缩小时应用程序不会挂起大量内存（它使用默认设置） ）。

但请注意，当应用程序实际使用的内存变化剧烈且快速时，这可能会导致性能问题 - 在这种情况下，您最好将其挂在所有内存上，而不是将其归还给操作系统只是为了声明它一秒钟后再次。您可能还想摆弄[GC 选项](http://java.sun.com/javase/technologies/hotspot/vmoptions.jsp)以确保 GC 不会留下太多无人认领的对象，当堆有很大的增长空间时，它往往会这样做，这会破坏目标希望堆大小适应应用程序的需求。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-18T11:17:32.960

根据[http://www.dreamincode.net/forums/showtopic96263.htm](http://www.dreamincode.net/forums/showtopic96263.htm)，您不能在运行时执行此操作，但您可以生成具有不同堆大小的另一个进程。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-18T11:20:26.557

您可以在启动应用程序时调整这些设置，但一旦 JVM 启动并运行，这些值就无法更改。像这样的东西：

> `java -Xms32m -Xmx512m FooBar`

将最小堆大小设置为 32MB，将最大堆大小设置为 512MB。一旦设置了这些，您就不能在正在运行的程序中更改它们。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-10-29T23:12:18.860

共识可能确实是这是不可能的，但我们应该查看 JVM 源代码，看看它是如何进行人体工程学控制的。如果能够让 JVMTI 代理能够在线/在运行时调整堆/perm/tenured/new/&c 大小，那就太好了。

这会做什么？它将允许代理根据性能或占用空间目标推断大小调整，这在将 JVM 迁移到云中时非常重要。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-01-25T20:54:02.983

您可以在启动时使用**-mx**选项（也称为**-Xmx**）这是您应该需要的最大大小，因为您不需要将其设置为超过您将需要的最大大小。

但是，一种解决方法是让 main() 检查最大大小并在最大大小不符合要求时重新启动 java。即启动另一个java程序并死掉。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-25T19:25:11.563

我问自己同样的问题。与上面的答案不同，我可以对**我的**应用程序增加最大堆 JVM 大小做一些事情。如果应用程序是集群模式下的 Web 服务器，我可以启动一个更改了最小/最大堆大小的新实例，而不是关闭初始实例。这在 GlassFish 中尤其简单，您将管理实例与 nodeAgent（应用服务器集群实例）JVM 分开。

由于许多 JVM 应用程序都是 Web 应用程序，因此我认为值得保留在此博客中。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-18T11:34:58.910

如果我正确理解您的问题，您正在尝试在*运行时*更改堆大小。我看不出有任何理由为什么这应该是可能的。使用JVM 选项在*启动*时设置堆大小。`-Xmx`我还建议您`-Xms`仅在绝对需要时才设置该选项。此选项设置分配给 JVM 的初始头内存量。

您应该知道您的应用程序在内存方面的行为。`-Xmx`明智地设置 的值。如果您的应用程序是某种服务器应用程序，您可以设置更高的值，否则会在客户端计算机上运行的其他可能应用程序以及可用内存中妥协您的选择。

# mysql - MySQL 数据库更改跟踪

> ID：763301
> 
> 赞同：3
> 
> 时间：2009-04-18T11:18:29.650
> 
> 标签：mysql, database, change-tracking

您使用哪些工具来跟踪 MySQL 数据库中的更改？
目前我在一个项目中，我们使用纯文本文件（通过 SVN 控制版本），我们在对数据库进行更改时手动添加 SQL 语句。
许多更改时不时地神奇地消失，我们现在正在寻找一种更好的方法来更改跟踪我们的数据库。

**编辑：**
我忘了提到一件事，我们正在使用存储过程和函数，所以我们不仅要跟踪/版本控制上的更改的数据库结构。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-18T11:24:53.800

有一个简单的解决方案：

*   通过脚本对数据库模式和静态数据进行所有更改
*   版本控制脚本

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-08T03:12:08.730

Toad for MySQL 有一个很棒的模式比较工具

[http://www.quest.com/toad-for-mysql/](http://www.quest.com/toad-for-mysql/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T11:59:54.963

我认为你需要这样的东西（我对 Firebird 进行了测试，效果很好）： [http](http://www.upscene.com/products.audit.index.php) ://www.upscene.com/products.audit.index.php 我以为有 MySQL 版本，但没有 :(

对于 MySQL，我只看到了这个： http: [//solutions.mysql.com/solutions/partner.php ?partner=1532](http://solutions.mysql.com/solutions/partner.php?partner=1532)

但如果只是为了开发，我觉得[这里](https://stackoverflow.com/questions/763301/mysql-database-change-tracking/763306#763306)给出的答案 是好的

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-04T20:00:11.290

[mysql-diff](http://bitbucket.org/stepancheg/mysql-diff/)比较表，但尚未比较存储过程。

# .net - .NET 项目版本控制中第三方 Dll 的位置

> ID：763309
> 
> 赞同：7
> 
> 时间：2009-04-18T11:29:10.797
> 
> 标签：.net, version-control

在版本控制系统中检查 .NET 项目的第三方参考 Dll 的理想位置（目录）是什么。通常我见过大多数人将它们放在 bin 下，以便运行时可以自动拾取这些文件。然而，这是正确的方法。

我最初想要一个单独的目录，它与名为 lib 的 bin 并行，它将包含所有第三方 Dll 的，但这需要更改应用程序配置文件，以便运行时拾取 lib 目录。我的想法是，lib 将包含第三方 dll，而 bin 将包含项目 Binary（可以是 Dll 或 Exe）

首选方式是什么，重点是版本控制中的位置，而不仅仅是物理文件系统。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-18T15:59:11.193

我们使用以下目录结构（更多详细信息见[我的博客](http://code.logos.com/blog/2012/11/building-code-at-logos-repository-layout.html)）：

```
Solution\
  Libraries\
    third-party DLLs here
  Source\
    Project1\
    Project2\ 
```

每个项目引用（使用“添加引用”对话框中的“浏览”选项卡）“库”文件夹中的程序集。这些会在编译时自动复制到每个项目的“bin”文件夹中。（当然，“库”文件夹致力于版本控制。）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-18T11:32:04.500

让单独的目录包含第三方程序集（这将使源代码管理中的维护变得更容易），然后在您的项目中创建对这些程序集的引用。然后，在构建时，您的第三方程序集将被复制到您的中`\bin`，您无需进行任何配置更改。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-06-26T18:40:50.870

我假设这些 3rd 方 DLL 将用于您的多个项目。因此，将 DLL 直接放在每个项目的 bin 下意味着您最终拥有与项目一样多的 DLL 副本（在 VCS 中），这并不优雅。正如 Andrew H. 提到的，如果 DLL 真的很常见，它们应该放在一个公共目录中，所有其他需要它的项目都可以引用它。这里唯一的问题是能够区分同一个 DLL 的不同版本：随着时间的推移，您最终可能会得到类似的结果：

```
/common/ThirdPartyLibrary.dll  (version 1.2)    
/common/ThirdPartyLibrary.dll  (version 1.3) 
```

我知道（目前）最好的方法是用明确的版本号重命名第 3 方 DLL 并在您的项目中引用该新名称，这样您的项目肯定会始终引用正确的版本。像：

```
/common/ThirdPartyLibrary_v1.2.dll    
/common/ThirdPartyLibrary_v1.3.dll 
```

# cakephp - Cakephp - checkPasswords 总是错误的

> ID：763316
> 
> 赞同：0
> 
> 时间：2009-04-18T11:36:55.737
> 
> 标签：cakephp, model, passwords

我正在处理注册过程，并想检查两个密码（密码 + 重新输入的密码）是否相等。这些是我在用户模型中的验证规则：

```
var $validate = array(
    'username' => array( 
            'notEmpty' => array( 
                    'rule' => array('minLength', 5), 
                    'required' => true, 
                    'allowEmpty' => false, 
                    'message' => 'User name has to be at least 5 characters long' 
                ),
        array(
            'rule' => 'isUnique',
            'message' => 'User name taken. Use another'
        )
    ),
    'password' => array(
                'notEmpty' => array( 
                    'rule' => array('minLength', 6), 
                    'required' => true, 
                    'allowEmpty' => false, 
                    'message' => 'Password has to be at least 6 characters long'
        ),
        'password_similar' => array( 
                    'rule' => 'checkPasswords',
                    'message' => 'Entered passwords does not match' 
            )
    ),
    'email' => array(
        'rule' => 'email',
        'required' => true,
        'allowEmpty' => false,
        'message' => 'Please enter a valid email'
    )
); 
```

在`users_controller.php`我有这个`checkPasswords`功能：

```
function checkPasswords($data) { 
    if($data['password'] == $this->data['User']['password2hashed']) 
        return true; 
      else
        return false;    
} 
```

我的 singup 函数如下所示：

```
function signup(){ 
    if (!empty($this->data)) { 
        if(isset($this->data['User']['password2'])) 
               $this->data['User']['password2hashed'] = $this->Auth->password($this->data['User']['password2']); 

     $this->User->create(); 

    if ($this->User->save($this->data)) { 
.
.
.
} 
```

无论我做什么，密码都不匹配。即使我将`checkPasswords`功能更改为：

```
function checkPasswords($data) { 
    return true;
} 
```

什么可能导致这种行为？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T12:09:42.273

我的天啊，我刚刚意识到 checkPasswords 函数不应该在控制器中，而是在模型中。问题解决了，惭愧。。。

# erlang - 为什么函数参数中没有动态位模式？

> ID：763336
> 
> 赞同：3
> 
> 时间：2009-04-18T12:06:18.257
> 
> 标签：erlang, binary, pattern-matching, bits

我正在 Erlang 中尝试位模式匹配：

```
-module(test).
-export([test/2]).

%test(P,<<X:P,0:1>>) ->
%    X.

test(P,X) ->
    <<Y:P,0:1>> = X,
    Y. 
```

在编译注释掉的版本时，`test/2`我收到一条抱怨“变量'P'未绑定”。有什么好的理由不允许第一个版本与第二个版本一样工作吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T16:15:11.653

因为在注释掉的版本中 P 是一个长度 - 为了使它工作，Erlang 需要执行双重匹配 - 将第二个参数的值与未确定的模式匹配......

您在子句模式匹配中提出的问题是“这是我的子句吗”-您不能“弹出子句”然后退出，如果不是...

在第二个示例中，X 在匹配之前绑定，您承诺进入子句和 if `<<Y:P,0:1>> don't match X`，那么崩溃时间！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-09-26T11:35:42.690

原因是函数的参数是独立评估的。绑定到变量的正确性仅作为第二步进行检查。

这意味着在您的第一个示例中， P 在评估第二个参数时将不受约束，这违反了模式匹配规则。相反，在您的第二个示例中， P 在评估二进制文件的模式匹配时被绑定。

# c# - winforms 应用程序内存使用情况

> ID：763339
> 
> 赞同：2
> 
> 时间：2009-04-18T12:09:57.983
> 
> 标签：c#, winforms, memory

无论如何，我可以让我的应用程序告诉用户有多少内存，以及应用程序是否接近占用其中的大部分。

另外，你怎么知道机器给操作系统、显卡等提供了多少内存？.

例如，如果您有 4gb 的内存，实际分配给应用程序的内存有多少，您可以配置它吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T12:59:02.937

> 无论如何，我可以让我的应用程序告诉用户有多少内存，以及应用程序是否接近占用其中的大部分。

是的，这是可能的（请参阅其他一些答案），但您的应用程序不太可能真正需要关心。你认为你需要对记忆压力如此敏感的地方是什么？

> 另外，你怎么知道机器给操作系统、显卡等提供了多少内存？.

同样，这**应该**可以使用 WMI 调用，但更大的问题是为什么需要这样做？

> 例如，如果您有 4gb 的内存，实际分配给应用程序的内存有多少，您可以配置它吗？

不，这不是一个可配置的值。当 .NET 应用程序启动时，操作系统会分配一块内存供其使用。这是由操作系统处理的，无法配置用于确定要分配的内存量的算法。同样，无法配置 .NET 运行时用于托管堆、堆栈、大型对象堆等的内存量。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T13:28:00.620

我想我对这个问题的解读有点不同，所以希望这个回答不会太离题！

[通过使用 Windows 任务管理器，甚至更好的是 Sysinternals Process Monitor](https://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)，您可以很好地了解您的应用程序消耗了多少内存。这是一种快速查看流程高峰期的方法，以了解它们的行为方式。

开箱即用，x86 进程只能处理 2GB 的 RAM。这意味着您机器上的任何单个进程最多只能消耗 2GB。实际上，在出现内存不足异常之前，您可能只能消耗 1.5-1.8。

您的 Windows 副本实际可以处理多少 RAM 取决于 Windows 版本和 cpu 架构。

使用您的 4GB RAM 示例，操作系统将为您的应用程序提供高达 2GB 的 RAM（所有进程共享），并且它将为自己保留 2GB。

根据您运行的操作系统，您可以使用 boot.ini 中的 /3GB 开关进行调整，将应用程序的比率调整为 3GB，操作系统调整为 1GB。这对操作系统有一些影响，所以我会先回顾一下这种影响，看看你是否可以接受权衡（YMMV）。

对于能够寻址大于/3GB 的单个应用程序，您需要在 PE 映像头中设置一个特定位。这个[问题/答案](https://stackoverflow.com/questions/586826/imagefilelargeaddressaware-and-3gb-os-switch)已经有关于这个主题的很好的信息。

x64架构下的游戏变化。:)

一些很好的参考资料：

[Windows 版本的内存限制](http://msdn2.microsoft.com/en-us/library/aa366778.aspx)

[虚拟地址空间](http://msdn2.microsoft.com/en-us/library/aa366912(VS.85).aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T12:22:42.913

我认为您可以使用 WMI 来获取所有这些信息

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T12:31:19.680

如果您不想使用 WMI，可以使用 GlobalMemoryStatusEx()：

函数调用：
[http ://www.pinvoke.net/default.aspx/kernel32/GlobalMemoryStatusEx.html](http://www.pinvoke.net/default.aspx/kernel32/GlobalMemoryStatusEx.html)

返回数据：
[http ://www.pinvoke.net/default.aspx/Structures/MEMORYSTATUSEX.html](http://www.pinvoke.net/default.aspx/Structures/MEMORYSTATUSEX.html)

MemoryLoad 会给你一个介于 0 到 100 之间的数字，它代表正在使用的物理内存的百分比，TotalPhys 会告诉你物理内存的总量（以字节为单位）。

内存很棘手，因为可用内存是物理（ram）和虚拟（页面文件）类型的混合。具体的混合，以及去哪里，由操作系统决定。幸运的是，这在某种程度上是可配置的，因为 Windows 允许您规定要使用多少虚拟内存（如果有的话）。

请注意，并非 32 位 Windows（XP 和 Vista）中的所有内存都可供使用。Windows 可能报告最多安装了 4GB，但只有 3.1-3.2GB 可供操作系统和应用程序实际使用。这与 IIRC 的遗留解决问题有关。

祝你好运

# c# - C# 虚拟（或抽象）静态方法

> ID：763344
> 
> 赞同：12
> 
> 时间：2009-04-18T12:16:37.000
> 
> 标签：c#, inheritance

静态继承就像实例继承一样工作。除非您不允许将静态方法设为虚拟或抽象。

```
class Program {
    static void Main(string[] args) {
        TestBase.TargetMethod();
        TestChild.TargetMethod();
        TestBase.Operation();
        TestChild.Operation();
    }
}

class TestBase {
    public static void TargetMethod() {
        Console.WriteLine("Base class");
    }

    public static void Operation() {
        TargetMethod();
    }
}

class TestChild : TestBase {
    public static new void TargetMethod() {
        Console.WriteLine("Child class");
    }
} 
```

这将输出：

```
Base class
Child class
Base class
Base class 
```

但我想要：

```
Base class
Child class
Base class
Child class 
```

如果我可以使用静态方法，我会将 TargetMethod 设为虚拟，它会完成这项工作。但是有没有办法得到同样的效果？

编辑：是的，我可以将 Operation 的副本放在子类中，但这需要将大量代码复制并粘贴到每个子类中，在我的情况下，这大约是 35 个类，这是维护的噩梦。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-18T12:31:07.620

不，您不能覆盖静态方法。“静态”也意味着它是由编译器静态绑定的，所以实际调用的方法不是在运行时找到的，而是在编译时绑定的。

你应该做的是使类非静态。使方法虚拟并覆盖它，并充分利用真正的继承。然后，如果您真的需要它，请为您的类的引用创建一个静态入口点。例如静态工厂、单例（在大多数情况下它是一种反模式，但与静态类一样好）或只是一个静态属性。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-18T12:55:42.180

您可以将 TargetMethod 存储为委托，子类可以根据需要进行更改：

```
class TestBase {
    protected static Action _targetMethod;

    static new() {
       _targetMethod = new Action(() => {
           Console.WriteLine("Base class");
       });
    }

    public static void TargetMethod() {
        _targetMethod();
    }

    public static void Operation() {
        TargetMethod();
    }
}

class TestChild : TestBase {
    static new() {
       _targetMethod = new Action(() => {
           Console.WriteLine("Child class");
       });
    }
} 
```

但是，由于这些是静态实例——`_targetMethod`它们在所有实例之间共享——改变它`TestChild`也会改变它`TestBase`。你可能关心也可能不关心。如果你这样做，泛型或 a`Dictionary<Type, Action>`可能会有所帮助。

不过，总的来说，如果您不坚持使用静态，或者使用组合而不是继承，您将拥有更轻松的时间。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T13:22:59.103

如果您正在寻找抽象静态方法，那么这很有效，并且结果证明是我适应的最简单的解决方案：

```
class TestBase<ChildType> where ChildType : TestBase<ChildType> {
    //public static abstract void TargetMethod();

    public static void Operation() {
        typeof(ChildType).GetMethod("TargetMethod").Invoke(null, null);
    }
}

class TestChild : TestBase<TestChild> {
    public static void TargetMethod() {
        Console.WriteLine("Child class");
    }
} 
```

但我仍然将 Stafan 标记为解决方案，因为对于处于类似情况的任何人来说，使用实例继承可能是最好的建议。但我只需要为此重写太多代码。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-04-15T23:31:21.623

好的，这就是我所做的

```
public abstract class Base<T>
    where T : Base<T>, new()
{
    #region Singleton Instance
    //This is to mimic static implementation of non instance specific methods
    private static object lockobj = new Object();
    private static T _Instance;
    public static T Instance
    {
        get
        {
            if (_Instance == null)
            {
                lock (lockobj)
                {
                    if (_Instance == null)
                    {
                        _Instance = new T();
                    }

                }
            }
            return _Instance;
        }
    }

    #endregion //Singleton Instance

    #region Abstract Definitions

    public abstract T GetByID(long id);
    public abstract T Fill(SqlDataReader sr);

    #endregion //Abstract Definitions
}

public class InstanceClass : Base<InstanceClass>
{
    //empty constructor to ensure you just get the method definitions without any
    //additional code executing
    public InstanceClass() { }

    #region Base Methods

    public override InstanceClass GetByID(long id)
    {
        SqlDataReader sr = DA.GetData("select * from table");
        return InstanceClass.Instance.Fill(sr);
    }

    internal override InstanceClass Fill(SqlDataReader sr)
    {
         InstanceClass returnVal = new InstanceClass();
         returnVal.property = sr["column1"];
         return returnVal;
    }
} 
```

我认为这将是您想要做的事情的可行解决方案，而不会破坏太多纯粹的 OO 原则。

# jquery - 如何将表单值存储在 data() 对象中？

> ID：763345
> 
> 赞同：3
> 
> 时间：2009-04-18T12:17:01.303
> 
> 标签：jquery, forms, dom

提交后是否有一种简单的方法可以将表单数据存储在`data()`对象中？

假设这是我的表格：

```
<form id='myform'>  
<input type='text' name='bar' value='lorem'/>  
<input type='text name='foo' value='ipsum'/>  
</form> 
```

提交后数据应存储如下：

```
$("#myform").data('bar','lorem');  
$("#myform").data('foo','ipsum'); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T12:26:44.743

你可以这样做：

```
$('#myform').submit(function(e) {
    e.preventDefault(); // don't submit the form
    var form = $(this); // store it for later reference
    form.children('input').each(function() {
        form.data($(this).attr('name'), $(this).attr('value'));
    });
}); 
```

**编辑**：我的代码中有一些错误（`getChildren`» `children`，`myform`» `#myform`） - 我现在已经更正了。

请注意，此脚本不会提交表单。你可以添加[一些漂亮的 ajax](http://docs.jquery.com/API/1.3/Ajax)来做到这一点:) [http://docs.jquery.com/Ajax/serialize](http://docs.jquery.com/Ajax/serialize)

**更新**：实际上，jQuery 已经内置了这个功能：[`form.serialize()`](http://docs.jquery.com/Ajax/serialize). 它返回一个有效的查询字符串：

```
<form id="myForm">
    <input type="radio" value="A" name="foo" checked="checked" /> A<br />
    <input type="radio" value="B" name="foo" /> B
    <input type="text" name="bar" value="Bla bla" />
</form>
<script>
var queryString = $('#myForm').serialize(); //foo=A&bar=Bla+bla
</script> 
```

# c# - 处理 ObjectDataSource 异常的最佳方法是什么？

> ID：763346
> 
> 赞同：4
> 
> 时间：2009-04-18T12:17:17.403
> 
> 标签：c#, asp.net, objectdatasource

我在 ASPX 页面中有一个 ObjectDataSource，它从业务逻辑类调用 CRUD 操作。当这些操作期间发生异常时，我想通知用户错误并记录它们。但我希望我的业务逻辑和表示层之间有一个清晰的分离。我知道 Selected、Inserted、Updated、Deleted 事件提供了 ObjectDataSourceStatusEventArgs 类型的参数，其中包括发生异常的属性“Exception”。

这些事件的处理程序是处理 ObjectDataSource 异常的最佳位置还是有更好的方法？事件参数链的 Exception 属性是否包含操作过程中发生的所有异常？

欢迎任何意见或建议，

谢谢，

卡伦

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T13:21:48.013

在 Biz 层对象执行的 CRUD 操作期间引发异常时，它应该由 Biz 对象处理，但只是部分处理。这是因为您希望反馈到达表示层（并且您还希望记录错误）。因此，您可以：

一个。按原样重新抛出异常。这会将它冒泡到您的表示层。

湾。将名称-值数据对添加到`Data`异常的属性中，然后重新抛出它。

C。将引发的异常包装成自定义异常类型并抛出它。

然后，此异常将冒泡到您的 ObjectDataSource，并且可以通过`ObjectDataSourceStatusEventArgs.Exception`Selected/Inserted/Deleted/Updated 事件处理程序中的属性获得。然后，您应该检查此属性是否为 Null。如果没有，ObjectDataSource会将*任何异常*（是的，复数！）包装在一个`TargetInvocationException`包装器中，因此您可能需要获取 InnerException。

然后您可以修改 UI 元素以向用户提供操作未成功完成的必要反馈。此外，您需要将该`ExceptionHandled`属性设置为 True 以防止异常冒泡到页面级别。

至于记录异常，我个人会在两个层中记录错误 - 业务逻辑层和表示层。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T13:15:40.540

如果业务逻辑层中的方法被自动调用，我会使用这些事件。

我认为这些事件的目的是：以某种自定义方式显示错误。

但我不会自动调用逻辑层中的方法。相反，我将通过代码调用它们，并返回一个布尔值，指示操作是否成功。

像这样，当插入/更新一个人时：

```
if (Person.Save(data)) {
  // show OK message
} else {
  // show error message
} 
```

其中 Person 是相对于 Person 数据访问层类的 BAL 类。

希望这有帮助。

# iphone - 滚动背景

> ID：763348
> 
> 赞同：1
> 
> 时间：2009-04-18T12:19:10.970
> 
> 标签：iphone, cocoa-touch

在我的应用程序中，我正在向 UITextView 添加背景。但是当文本视图向下滚动时，图像与文本一起出现，新文本行的背景看起来是白色的。有没有简单的方法来应对它？这是我的代码：

```
textView = [ [UITextView alloc] initWithFrame: CGRectMake(10, 100, 270, 130)];

UIImageView *imgView = [ [UIImageView alloc]initWithFrame: CGRectMake(0, 0, 270, 130)];
imgView.image = [UIImage imageNamed: @"background.png"];
[textView addSubview: imgView];
[textView sendSubviewToBack: imgView];
[imgView release];

textView.opaque = YES;
textView.editable = YES;
textView.font = [UIFont systemFontOfSize: 12];
textView.textColor = [UIColor colorWithRed: 10.0f/255.0f green: 10.0f/255.0f blue: 10.0f/255.0f alpha: 1.0f];
textView.autocapitalizationType = UITextAutocapitalizationTypeNone;
textView.delegate = self;

[mainScrollView addSubview: textView]; 
```

我希望背景保持静止，文本在其上滚动。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T15:55:42.043

如果您希望背景保持静态并在其上滚动文本，只需将 UIImageView 添加到您将 UIScrollView 添加到的同一视图中（具有相同的尺寸等）。就像是：

```
UIImageView *imgView = [ [UIImageView alloc]initWithFrame: CGRectMake(0, 0, 270, 130)];
imgView.image = [UIImage imageNamed: @"background.png"];
[self addSubView:imgView];
[imgView release];

textView = [ [UITextView alloc] initWithFrame: CGRectMake(10, 100, 270, 130)];

textView.opaque = YES;
textView.editable = YES;
textView.font = [UIFont systemFontOfSize: 12];
textView.textColor = [UIColor colorWithRed: 10.0f/255.0f green: 10.0f/255.0f blue: 10.0f/255.0f alpha: 1.0f];
textView.autocapitalizationType = UITextAutocapitalizationTypeNone;
textView.delegate = self;
// Make the background of the textView transparent
textView.backgroundColor = [UIColor colorWithRed: 0.0 green: 0.0 blue: 0.0 alpha: 0.0];

[mainScrollView addSubview: textView]; 
```

我假设这段代码是在 UIView 上运行的，所以我同时添加了 UIImageView self. 如果您从 UIViewController 执行此操作，您可能希望将其更改为`[self.view addSubView:mainScrollView]`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T16:14:45.320

谢谢pgb。

这段代码终于对我有用：

```
 UIImageView *imgView = [ [UIImageView alloc]initWithFrame: CGRectMake(10, 100, 270, 130)];
    imgView.image = [UIImage imageNamed: @"background.png"];
    [mainScrollView addSubview: imgView];
    [mainScrollView sendSubviewToBack: imgView];
    [imgView release];

    textView = [ [UITextView alloc] initWithFrame: CGRectMake(10, 100, 270, 130)];

    textView.opaque = YES;
    textView.editable = YES;
    textView.font = [UIFont systemFontOfSize: 12];
    textView.textColor = [UIColor colorWithRed: 10.0f/255.0f green: 10.0f/255.0f blue: 10.0f/255.0f alpha: 1.0f];
    textView.autocapitalizationType = UITextAutocapitalizationTypeNone;
    textView.delegate = self;
    // Make the background of the textView transparent
    textView.backgroundColor = [UIColor colorWithRed: 0.0 green: 0.0 blue: 0.0 alpha: 0.0];

    [mainScrollView addSubview: textView]; 
```

# java - 验证内部类的实例

> ID：763359
> 
> 赞同：0
> 
> 时间：2009-04-18T12:26:37.630
> 
> 标签：java, validation

我有一个带有内部类 C 的 Java 类 B。B 的某些方法接受 C 的实例作为参数，但我只想接受由 B 的正确实例创建的 C 实例。有没有办法在编译时进行此验证?

* * *

**例子**

```
C c1 = new C();
B foo = c1.getB(); // foo was created by instance c1
C c2 = new C();
c2.method(foo); // I want a compiler error here. 
```

* * *

**我的情况**

有一个类名 Map，其中包含内部类 MapArea 的实例矩阵。这个方案的好处是我可以在构造函数中验证 xPos 和 yPos 字段，因此不会构建给定地图的无效区域。地图作为方法 distanceFrom(MapArea startingPos, MapArea toLocation, MapArea... otherLocations) 我试图避免再次验证地图区域参数。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T14:28:05.060

If this is really the behavior you want, `method()` should really be defined in the inner class.

In other words, instead of:

```
public class C {
  //...
  public void method(B b) {
    this.x = b.y;
    //...
  }
  //...
  public class B {
    //...
  }
  //...
} 
```

It should be:

```
public class C {
  //...
  public class B {
    //...
    public void method() {
      C c = this.C;
      c.x = this.y;
      //...
    }
  //...
  }
  //...
} 
```

Of course, this wouldn't solve the problem if, for example, you wanted `public void method(B b1, B b2, B b3)`, where all three instances of B are enclosed by the same instance of C.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T14:19:59.777

A compile error won't work, but you can at least throw an exception:

```
public class C
{
  public static void main (String [] args)
  {
    C c1 = new C();
    B b = c1.getB();
    c1.useB(b); //OK
    C c2 = new C();
    c2.useB(b); //throws IllegalArgumentException
  }

  public B getB() { return new B(); }

  public void useB(B b) {
    if(b.getC() != this)
      throw new IllegalArgumentException();
    //...
  }

  private class B
  {
    public C getC() { return C.this; }
    //...
  }
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T13:22:35.810

在编译时没有办法（AFAIK）这样做。

在运行时，您可以通过让外部实例的工厂方法将对自身的引用传递给内部实例的构造函数来实现。

内部类需要存储该引用，以便外部类可以检查它是否创建了该实例：

```
public class C {

    public class B {
        private C parent;
        private B(C parent) {
            this.parent = parent;
        }
        public C getParent() {
            return parent;
        }
    }

    public B getB() {
        return new B(this);
    }

    public void method(B b) {
        assert(this == b.getParent());
    }
} 
```

实际上，正如 Kip 的并发答案所示，`B`可以访问`C.this`以获取父对象，因此无需存储父引用。但是，如果 C 实际上不是内部类，则上述方法将是必要的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T14:25:59.917

There's no compile-time way to guard against instance-specific usage. Your best bet is probably throwing an Exception when the usage in incorrect. Another option you have is to have the parent class to have a `Map` of instances of the inner class, and to have other classes tell the outer class to operate on the inner class not by the instance but by some other references. This will work with other classes don't need to do anything directly with the inner class.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T12:42:27.827

如果您将内部类（C）的构造函数设为私有，我相信封闭类（B）仍然可以实例化它，而其他类则不能。这确保只有 B 和 C 可以实例化 C。

编辑：我已经用一个小模型验证了这一点。将内部类构造函数设为私有，然后只有内部类（C）或封闭类（B）可以实例化它。

有关更多信息，请参阅[http://tns-www.lcs.mit.edu/manuals/java-1.1.1/guide/innerclasses/spec/innerclasses.doc6.html](http://tns-www.lcs.mit.edu/manuals/java-1.1.1/guide/innerclasses/spec/innerclasses.doc6.html)。特别是：“访问保护永远不会阻止一个类使用另一个类的任何成员，只要一个包含另一个，或者它们被第三个类包围。”。

# .net - .NET 对可卸载类型的反思

> ID：763362
> 
> 赞同：1
> 
> 时间：2009-04-18T12:27:45.413
> 
> 标签：.net, reflection

我有一个包含不可加载类型的库（每当我尝试访问它们时，我都会得到一个 TypeLoadException）。因此，我不能使用 System.Reflection 命名空间来检查这些类型。是否有其他方法可以反映这些类型。当然，我不希望能够使用任何方法，我只想查看基本信息，例如方法名称，也许还有参数类型。

编辑：我知道并接受该类型是可卸载的，这是因为它定义了自己的 System.Object 并且没有对 mscorlib 的引用。反射器和 ildasm 工作，但我想在飞行中进行反射。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T12:59:26.163

您可以使用[Mono.Cecil](http://mono-project.com/Cecil)来反映程序集。不幸的是，由于接口不兼容，您必须更改反射代码。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T12:33:24.527

查看这篇博文：[调试 MissingMethodException、MissingFieldException、TypeLoadException](http://blogs.msdn.com/suzcook/archive/2004/02/13/debugging-a-missingmethodexception-missingfieldexception-typeloadexception.aspx)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T12:34:42.197

尝试使用[Reflector](http://www.red-gate.com/products/reflector/) - 它应该能够向您显示有关这些类型的一些元数据。如果这不起作用，请尝试使用[ILDASM](http://msdn.microsoft.com/en-us/library/f7dy01k1(VS.80).aspx)反汇编程序集以查看类型的元数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T12:35:24.333

用于`Assembly.ReflectionOnlyLoad`加载程序集。

见[msdn](http://msdn.microsoft.com/en-us/library/ms172331.aspx)

# c# - 如何处理ThreadPool和成员变量？

> ID：763370
> 
> 赞同：0
> 
> 时间：2009-04-18T12:34:38.797
> 
> 标签：c#, .net, multithreading, variables, member

我对 .NET 中的 ThreadPool 有点陌生。我想知道，如果我只能将一个对象发送到我的回调方法，我如何能够访问类成员变量来调用它的方法？（参见 CallBack() 中的 customClass）

我将如何从 customClass 加载数据？我是否将 customClass 传递给不同的 CallBack 方法？这种方法好吗？

正如您所看到的，这有点缺乏经验，所以一路上的任何提示都会非常感激。

谢谢你，凯夫

```
class Program
           {
                static void Main(string[] args)
                {
                    CustomClass customClass = new CustomClass();

                ThreadPool.QueueUserWorkItem(CallBack, "Hello"); 

                Console.Read();
            }

            private static void CallBack(object state)
            {
                customClass.SaveData(state.ToString());
            }
        } 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T12:49:12.850

```
class Program
{
  static void Main(string[] args)
  {
    CustomClass customClass = new CustomClass();
    ThreadPool.QueueUserWorkItem(x => CallBack(customClass, "Hello")); 
    Console.Read();
  }

  private static void CallBack(CustomClass custom, string text)
  {
    customClass.SaveData(text);
  }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T12:38:38.397

最简单的方法是使用[闭包](http://csharpindepth.com/Articles/Chapter5/Closures.aspx)来捕获您想要的所有变量（即使用匿名方法或 lambda 表达式）。如果您使用循环，您需要注意准确捕获的内容，但它比通过对象并必须将其转换回正确的类型等更方便。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T13:19:21.247

除了已经说过的：如果`CustomClass`在您的控制之下并且异步调用`SaveData`是一个常见的用例，您可以考虑提供一个`SaveDataAsync`方法：

```
class CustomClass {

    public void SaveDataAsync(string path) {
        ThreadPool.QueueUserWorkItem(state => this.SaveData(path));
    }

    public void SaveData(string path) {
        ...
    }
} 
```

请参阅[基于事件的异步模式](http://msdn.microsoft.com/en-us/library/wewwczdw.aspx)。

# python - 如何通过vim进行交互？

> ID：763372
> 
> 赞同：1
> 
> 时间：2009-04-18T12:34:43.103
> 
> 标签：python, linux, vim

我正在编写一个编辑器，它有很多可以通过文本轻松交互的参数。我发现为每个小参数实现单独的文本编辑器或大量 UI 代码很不方便。通常的按钮、盒子和小工具会很麻烦而且很笨拙。我宁愿让用户通过 vim 与这些参数进行交互。

对我来说，最好的方法是让编辑器用我的文本缓冲区打开 vim。然后，当有人将文本缓冲区保存在 vim 中时，我的编辑器会收到通知并更新它的视图。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T13:19:31.420

将您的中间结果（您希望用户编辑的内容）写入临时文件。然后`$EDITOR`在系统调用中使用环境变量让用户编辑临时文件，并在进程完成时读取结果。

这允许用户以伪标准方式配置他们想要使用的编辑器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T12:43:28.713

看看[这都是文本！](https://addons.mozilla.org/en-US/firefox/addon/4125). 它是一个 Firefox 插件，`textarea`在网页上对 s 执行类似的操作，但所讨论的编辑器是可配置的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T19:14:10.443

您还可以考虑将 VIM 集成到您的应用程序中。[皮达](http://pida.co.uk/)这样做

# c# - HTML 到 PDF - 性能不佳

> ID：763373
> 
> 赞同：2
> 
> 时间：2009-04-18T12:34:53.307
> 
> 标签：c#, html, performance, pdf, pdf-generation

我正在使用[ExpertPDF](http://www.html-to-pdf.net/Support.aspx#csharp)（.NET C# 库）将**HTML 转换为 PDF**，我的问题是这样做需要很多时间。

是否有任何自定义可以改善转换？

HTML 页面包含只有几张图像的表格数据，所以它并不复杂。

有没有其他人遇到过这个问题，或者你推荐另一个库来做这个？

我很感谢我能得到的所有提示，一定有办法提高这个动作的性能......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-19T10:00:33.013

如果你真的需要从 HTML 构建，我建议看看[websupergoo](http://www.websupergoo.com)，它不是免费或开源库可以从 HTML 导出 PDF。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T12:53:56.567

stackoverflow 中有很多关于这个主题的问题

*   [从原始 HTML/CSS 内容从 ASP.NET 生成 PDF？](https://stackoverflow.com/questions/570179/generate-pdf-from-asp-net-from-raw-html-css-content)
*   [在 .NET 中打印 PDF](https://stackoverflow.com/questions/8749/printing-a-pdf-in-net)
*   [如何以编程方式在我的 .NET 应用程序中创建 PDF？](https://stackoverflow.com/questions/177/how-do-i-programmatically-create-a-pdf-in-my-net-application)

*   [查看搜索结果](https://stackoverflow.com/search?q=html+to+pdf+.net)

# javascript - 如何在javascript中#include？

> ID：763395
> 
> 赞同：6
> 
> 时间：2009-04-18T12:51:17.010
> 
> 标签：javascript

假设我的 javascript 脚本**没有嵌入到 html/xml**中……我想编写一个小型辅助函数库以在我的脚本中使用。显然，javascript中必须有一个“#include”或“require”关键字，但我找不到。我对 Google 所做的任何事情都依赖于作为 html/xml 一部分的代码，这对我来说没有帮助。我该怎么办？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-18T13:02:40.790

我相信您的意思是为您的 javascript 文件编写某种依赖项跟踪框架，并使用称为“延迟加载”的过程仅在需要时加载所需的 JS 文件。

查看[Using.js](http://ajaxian.com/archives/usingjs-manage-javascript-dependencies)，它似乎可以满足您的需求。

此外，您可能想`addModule`从[YUILoader](http://developer.yahoo.com/yui/yuiloader/#addmodule)进行检查。它允许动态加载非 YUI 框架组件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T12:58:30.970

实际上，javascript 中并没有真正的#include 或 require。您实际上应该自己处理所有依赖项。我见过人们做一个黑客，他们做一个 document.write 来包含其他 javascript 文件。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-18T13:19:56.053

如果你关心的话，这里有一个包含的版本，它通过它的 DOM 接口使用文档对象：

```
function include(aFilename) {
     var script = document.createElement('script');
     script.src = aFilename;
     script.type = 'text/javascript';
     document.getElementsByTagName('head')[0].appendChild(script)
} 
```

问题是您必须在所有需要包含的源文件中包含此函数...：P：P

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-18T12:55:55.313

在 html 中包含一个 js 文件：

```
<script type="text/javascript" src="..."></script> 
```

为了正确起见，它应该在页眉中。

# internet-explorer - 通过虚拟化使用 IE 测试 Mac 开发的 WebApp？

> ID：763406
> 
> 赞同：0
> 
> 时间：2009-04-18T13:02:10.713
> 
> 标签：internet-explorer, macos, debugging, web-applications, virtual-machine

我目前正在我的 MacBook 上开发一个基于 Java 的 Web 应用程序。我的大部分测试是在 Firefox 和 Safari 上进行的，但一些客户表示有兴趣在带有 WinXP 和 Vista 的 Internet Explorer 上使用该应用程序。

我知道我会做一些严肃的客户端/Ajax 调试和调整。我确实有一个装有 WinXP 和 IE6 的 Fusion 来宾。

问题是：当我在主机（Mac）上运行我的应用程序时，说它正在监听[http://localhost:8080/myApp](http://localhost:8080/myApp)，我如何从 WinXP 来宾 VM 中访问它？

谢谢，罗洛

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T13:18:46.337

在 Mac 端打开系统偏好设置。网络。获取计算机的 IP 地址。尝试使用该 IP 而不是`localhost`.

这是[如何从来宾计算机访问主机的副本？](https://stackoverflow.com/questions/61449/how-do-i-access-the-host-from-vmware-fusion)

# http - 如何在重定向到 SSL 期间保持相同的 ASP 会话？

> ID：763407
> 
> 赞同：0
> 
> 时间：2009-04-18T13:02:22.740
> 
> 标签：http, session, ssl, asp-classic, e-commerce

我有一个运行经典 ASP 的购物车网站，在结帐过程中需要帮助。当用户准备结账时，他们会被重定向到网站的 SSL 版本。

```
Response.Redirect "https://example.com/beginCheckoutProcess.asp" 
```

当跳转发生时，客户在到达站点的 SSL 版本时开始一个新会话。这意味着他们购物车中的内容丢失了，给他们留下了糟糕的网站体验。

有没有办法在跳转到 SSL 时保持相同的 ASP 会话？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T14:19:31.400

如果您保持子域相同，它将正常工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T13:46:25.660

您是否尝试过设置 cookie 并将其存储在两端？然后您可以在另一端重新创建会话。

# 3d - 在工程应用程序中进行实时 3D 渲染的最佳方式是什么？

> ID：763408
> 
> 赞同：8
> 
> 时间：2009-04-18T13:02:26.717
> 
> 标签：3d, rendering

**我们正在开发一个基于 GIS 的应用程序，它在虚拟现实**环境中模拟真实的世界对象（即管道、道路等） 。目前我们使用[ESRI ArcGIS包中的](http://www.esri.com/)[ArcScene](http://www.esri.com/software/arcgis/extensions/3danalyst/index.html)进行3D 渲染，未来我们打算将其替换为我们自己的 3D 环境。

**问题：** 在上述应用程序中进行实时 3D 渲染的最佳方式是什么？我在这个领域没有任何经验，我真的很困惑。我应该使用一种可用的 3D 渲染引擎（下面列出的一些）吗？如果答案是肯定的，那么应该考虑哪些参数（无论其成本如何）？有没有人在这个领域有任何经验或建议？

**情况和必要性：**

1.  我们使用 C# .NET 环境来开发应用程序
2.  有大量的 3D 对象要显示
3.  3D 对象分组在不同的 CAD 文件中
4.  与最终 3D 场景的交互至关重要（例如选择一个 3D 对象）
5.  需要加载、卸载、打开、关闭和设置一层和/或对象的透明度。
6.  具有高细节的广泛模型（超过 800 公顷区域）的高性能实时渲染（从道路到非常精细的物体，如一颗螺丝钉）
7.  不需要提前着色问题（此时）
8.  纹理必须适用

**Rendring Engines：** 经过一番搜索，我找到了以下 3D 渲染解决方案：

1.  **[CadFaster|Engine](http://www.cadfaster.com/)**：“CadFaster|Engine 是一种独特且最具可扩展性的 3D 渲染解决方案，适用于技术应用程序。它比普通 CAD 应用程序快十倍以上。该引擎包括获得专利的 3D 数据集和几何图形*实时同步*机制，允许自动集成到主应用程序。CadFaster|Engine 还包含获得专利*的实时多边形缩减*，可提高 3D 性能。引自 DevMaster

2.  **[Quest3D](http://www.quest3d.com/)**：“使用 Quest3D 创建软件、网络和模拟器。Quest3D 是建筑可视化、产品可视化、数字娱乐、计算机辅助培训和高端 VR 应用程序的完美解决方案。” 引自 Quest3D 介绍

3.  **[OpenSceneGraph](http://www.openscenegraph.org/)**：“OpenSceneGraph 是一个开源的高性能 3D 图形工具包，应用程序开发人员在视觉模拟、游戏、虚拟现实、科学可视化和建模等领域使用。完全用标准 C++ 和 OpenGL 编写......。OpenSceneGraph 是现已确立为世界领先的场景图技术，广泛应用于 vis-sim、太空、科学、油气、游戏和虚拟现实行业。主要语言：C/C++ 语言封装：C#，...。引用自 OSG 主页。

4.  [DevMaster](http://www.devmaster.net/engines/list.php?fid=6&sid=2)和[3DLinks](http://www.3dlinks.com/links.cfm?categoryid=3&subcategoryid=31&order=catrating)上还有一个几乎完整的可用引擎列表

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-19T16:36:53.277

无论您使用哪种引擎，都需要了解一些关键概念。

由于您要处理如此多的对象，因此主要的是细节级别 (LoD)。确保您的对象具有与之关联的真实 LoD。例如，在查看整个场景时，您不会费心渲染螺丝的高细节模型。此外，当靠近它但仍然足够远时，螺丝的低细节版本足以进行渲染。

此外，您可以使用 Virtual Earth 之类的技巧并平铺您的数据（与 LoD 相关）。最后，剔除将非常重要，但可能涉及您已经提到的任何引擎。

如果您正在处理 GIS 的东西，请查看 AGI 的[Insight3D](http://blogs.agi.com/insight3d/index.php/about/)。仍处于早期开发阶段，但有很多好的技术支持，旨在处理大量对象、剔除、LoD 等。他们甚至有办法将视频嵌入为纹理。

编辑：

如果您按照您所说的那样处理 C#，我真的会看看 Insight3D。它是一个 3D GIS 引擎。不是游戏引擎。它是基于场景图的，这意味着您不必像其他引擎那样担心逐帧渲染。

他们有你需要的所有结构

1.  非常快速的命中测试（即您选择了哪个实体）。
2.  具有用于条件渲染的简单控件的场景图形类。
3.  时间作为场景图形的一部分集成到引擎中。这意味着您甚至可以定义事物在前一个时间点的样子并在其上来回切换。

对我来说，3D 引擎和游戏引擎之间的区别可能会变得非常模糊。就我所见，关键的区别在于游戏引擎更关心的是让事情看起来很好而不是准确。例如，我们使用虚幻引擎渲染我们的办公室，但我们必须将所有东西都制作成与现实生活不同的比例。它看起来很棒，但不是现实生活中的尺寸。在处理细节到螺丝钉时，这可能会有所不同。

一点免责声明：我不为 AGI 工作，但我亲自见过正在创建这个引擎的工程师。他们正在集成最新的 GPU 和渲染技术，因此它是迄今为止我用过的最快、性能最好的引擎之一。它利用了许多人用于高分辨率天文计算的主要应用程序 ( [STK](http://www.stk.com/products/desktopApp/stkFamily/editions/index.cfm?tab=key) )使用的知识和技术。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T15:51:04.503

[SlimDX SDK](http://slimdx.org/)可能是一个选项，如果您愿意从底层开始，它基本上是一种让您从 .NET 访问 DirectX 的方式。他们还有一系列样品供您开始。
[Ogre -](http://www.ogre3d.org) [LGPL](http://www.ogre3d.org/licensing)下的 3d 引擎或购买许可证
[garagegames.com](http://www.garagegames.com/) - 也有一些引擎，具体取决于您选择的语言（也是“低价”。这里没有 500k $ 引擎）

[Ogre](http://www.ogre3d.org)和garagegames.com[都有](http://www.garagegames.com/)“旧的” 3d 引擎，因此您应该能够找到完整的游戏或演示，以便检查性能。我不熟悉编写 cad 应用程序，所以当你说你有 3D 对象时，我不确定那是静态的还是可以在应用程序运行时更改的对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-21T13:00:49.520

我曾与 OpenSceneGraph 合作过，在我看来，如果您不擅长组织图形，则考虑到模型的具体情况（高细节、高对象数、分散的场景），最终可能会导致性能不佳。您将需要能够在空间上对场景进行分区（如八叉树、kd 树等）。

如果成本不是问题，您可以选择也提供咨询服务和销售引擎的供应商，这些引擎不需要与 OSG 完全相同的 3D 图形专业知识。

另一个需要考虑的问题是如何将模型导入引擎。如果您使用记录的文件格式，您可以自己完成，否则您将需要依赖外部库来读取和/或将模型导入您选择的引擎。

如果您的模型非常大，您将需要能够分页的东西，因为您的模型不适合可用内存（在这种情况下依赖操作系统进行分页并不是 IMO 的最佳主意）。

在这里您可以找到 3D 引擎的列表，其中一些是商业的：[http ://en.wikipedia.org/wiki/List_of_3D_graphics_APIs](http://en.wikipedia.org/wiki/List_of_3D_graphics_APIs)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T15:59:23.407

[Unity 2.5](http://unity3d.com/)现在有一个在 Windows 上运行的 IDE。还有一个网络查看器，因此（使用插件）您可以直接在网页上查看沉浸式环境。独立许可证只需 200 美元。

BTW GarageGames 现在获得了一项名为[Torque3D的新技术的许可](http://www.garagegames.com/)

同样值得一试的是在[devmaster.net](http://www.devmaster.net/engines/)上获得高度评价的[C4 引擎](http://www.terathon.com/c4engine/index.php)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T14:12:40.497

[http://www.blender.org/](http://www.blender.org/)自带游戏引擎

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-19T16:18:54.367

您应该查看 WPF、Windows 演示框架（请参阅 winfx，请参阅 avalon）并深入了解最新的发展。您可能会发现[此链接](http://labs.blogs.com/its_alive_in_the_lab/2007/04/interknowlogy_3.html)有些有趣。另外，什么是[三倍](http://thriple.codeplex.com/)？

# ruby-on-rails - 私人消息系统的数据模型

> ID：763411
> 
> 赞同：0
> 
> 时间：2009-04-18T13:04:26.713
> 
> 标签：ruby-on-rails, database-design, web-applications, migration, private-messaging

我正在为我的网络应用程序编写一个私人消息系统。只需将其视为与在 Facebook 或 Twitter 等典型社交网站上发送 PM 或什至通过 Hotmail 发送电子邮件相同的事情。

```
I have come up with the following migration so far:
class CreateMessages < ActiveRecord::Migration
  def self.up
    create_table :messages do |t|
      t.integer :sender_id, :recipient_id
      t.string :title
      t.text :body
      t.boolean :read
      t.timestamps
    end
  end

  def self.down
    drop_table :messages
  end
end 
```

但是sender_id和receiver_id都指向同一个字段，也就是Role模型中的id字段。我必须进行哪些更改才能使解释器知道它指的是该字段。我是否需要进行其他更改，例如连接表？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T22:05:45.133

如果我正确阅读了您的问题，您应该使用 belongs_to 的 class_name 选项对模型进行更改：

```
belongs_to :sender, :class_name => 'Role', :foreign_key => 'sender_id'
belongs_to :recipient, :class_name => 'Role', :foreign_key => 'recipient_id' 
```

不过，我认为外键是推断出来的，因此您应该可以将其关闭。

# database - 机器数据库的架构

> ID：763413
> 
> 赞同：4
> 
> 时间：2009-04-18T13:05:09.817
> 
> 标签：database, sysadmin

这可能更像是一个 serverfault.com 的问题，但是 a) 它还不存在 b) 当它存在时我需要更多的代表:~)

我的雇主有数百台服务器（全部为 *NIX），分布在多个地点。正如我所怀疑的那样，我们并不*真正*知道我们拥有多少台服务器：我不止一次惊讶地发现一台已经运行了 5 年的服务器，显然除了略微提高地球温度之外什么也没做。我们有许多存储服务器信息位的数据库[——Puppet](http://reductivelabs.com/products/puppet/)、[Cobbler](https://fedorahosted.org/cobbler/)、[Nagios](http://www.nagios.org/)、[Cacti](http://www.cacti.net/)、我们的负载平衡器、DNS、各种内部电子表格等等，但它们都非常不同、不完整和重叠。维持这种混乱需要时间和金钱。

所以，我想建立一个单独的数据库，其中包含每个服务器的详细信息（硬件规格、角色等）并替换（或至少为上面提到的数据库提供数据）。数据库和 Web 界面很可能是 Rails 应用程序，因为这是我最有经验的。我更像是系统管理员而不是编码员。

这个问题已经解决了吗？我找不到任何真正符合要求的开源软件，而且我通常不太热衷于臃肿的、GUI 供应商提供的解决方案。

我应该如何实现设备信息收集位？例如，当磁盘被添加或移除时，或者当服务器序列号因惠普更换主板而发生变化时，数据库更新设备记录会非常有用。此信息来自许多不同的来源：`dmidecode`命令行磁盘工具、针对服务器的 SNMP 或其板载熄灯卡等。我可以通过自定义脚本公开所有这些`net-snmp`，或者我可以运行一个本地轮询器，将信息报告回中央数据库（可能通过 RESTful 接口或其他方式）。它必须易于扩展。

你做过吗？如何？告诉我你的经历、发现、错误和建议！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-21T01:07:02.763

这听起来像是一个寻找解决方案的 LDAP 问题。LDAP 是为这类事情设计的：为数据搜索和检索（但不一定是写入）优化的项目目录。有许多 LDAP 服务器可供选择（OpenLDAP、Sun 的 OpenDS、Microsoft Active Directory，仅举几例……），而且我以前见过 LDAP 用于对服务器进行编目。[LDAP 非常标准化，通常搜索或读取但不经常更新的信息“数据库”是LDAP](http://en.wikipedia.org/wiki/LDAP)的强项。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-21T00:54:54.820

我的团队已经将所有系统转储到 RDF 中一两个月了，我们让系统实施人员在 excel 中创建初始数据，然后使用 Perl 将其转换为 N3 (RDF)。

我们在 Gruff ( [http://www.franz.com/downloads.lhtml](http://www.franz.com/downloads.lhtml) ) 中查看数据并将生成的 RDF 保存在 Allegro 中（来自与 Gruff 相同的人的三重存储）

它非常简单和灵活——没有模式意味着我们只是动态地扩充数据，并且使用各种 RDF 查看器和推理引擎，表示选项是无限的。

对我来说最好的部分？无需编码，只需创建三元组并将它们扔到商店中，然后以图表的形式查看它们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-29T03:35:20.747

详细机器信息的收集是一个非常令人沮丧的问题（许多供应商希望保持这种方式）。即使你可以花很多钱，你也可能不会找到解决这个问题的简单方法。IBM 和 HP 提供的产品可以满足您的需求，但它们非常、非常、昂贵，一旦您意识到您可能只需要它们提供的 40-50% 的功能，它们就会在您的嘴里留下不好的味道。您说您需要监视 *Nix 服务器...大多数（如果不是全部）unices 支持 RFC 1514（从 windows 2000 开始，windows 也支持此 RFC）。然而，RFC 1514 定义的主机 MIB 支持有其缺点。由于它是基于 SNMP 的，因此需要在机器上启用 SNMP，这通常不是 unix 和 windows 机器的默认设置。原因是 SNMP 是在全世界都使用 Internet 之前创建的，因此其安全性的陈旧、顽固的性质令人担忧。在许多环境中，出于安全原因，这可能是不可接受的。但是，如果您只处理防火墙后面的机器，这可能不是问题（我怀疑您的情况是这样）。几年前，我正在开发一个监控数百台 unix 和 windows 机器的产品。当时，我对如何从每台机器获取详细信息的机制进行了广泛的研究，例如磁盘信息、正在运行的进程、已安装的软件、正常运行时间、内存压力、CPU 和 IO 负载（包括网络），而无需运行自定义每台机器上的客户端。可以集中方式收集此信息。三四年前，RFC-1514 主机 MIB 规范是获取详细实时机器信息的唯一“标准”，无需借助操作系统特定的软件。Sun 和 Microsoft 多年前宣布了一项基于 WebService 的计划来解决其中的一些问题，但我怀疑它从未受到任何关注，因为我现在甚至不记得它的营销名称。

我应该提到 RFC 1514 肯定不是灵丹妙药。除非您有幸在每台机器上部署自定义信息收集客户端，否则您将受制于操作系统提供的 SNMP 服务。RFC-1514 规范规定有几个参数是可选的，如果您的目标操作系统没有实现它，那么您将返回自定义代码来提供信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-21T03:53:25.017

大型供应商提供了一些解决方案来管理大量机器，例如 IBM 的一些[Tivoli](http://www.ibm.com/software/tivoli/)产品。然而，对于仅仅数百台机器来说，这可能是多余的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-21T00:36:50.963

听起来像是大型组织会遇到的常见问题。我知道我们（50 人的公司）系统管理员有一个关于每台服务器、许可证和安装的硬件的信息的小访问数据库。他非常细心，但是到了更换或维修硬件的时候，他从他的小数据库中知道了一切。

您和您的组织可以赞助一个开源项目来获得 oyu 您需要的东西，并回馈社区，以便可以免费开发其他功能（您现在可能不需要）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T00:57:19.010

也许是一个简单的网络服务？只是接受机器名称或 IP 地址的东西。当服务获得输入时，它会将其放入队列中并启动一项任务以从通知它的机器收集数据。任务的性质（SNMP 询问、远程调用 Perl 脚本等）可以作为机器信息的一部分存储在数据库中。如果任务失败，机器 ID 将留在队列中，并定期重新轮询机器，直到收集到信息。当然，您还必须在您的服务器上运行某种监视器，以注意到发生了变化并发送通知；希望这可以通过您已经安装的任何服务器监控软件轻松完成。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-20T03:13:23.527

我正在考虑如何自己解决这个问题，我认为这是让我们处于黑暗时代的关键基础设施之一。希望这将成为 serverfault.com 上的一个热门问题。:)

这不仅仅是你可以安装一个工具来收集这些数据，因为这并不便宜，但理想情况下，你希望从硬件到网络上的应用程序的所有内容都输入到这个东西中。

我认为唯一有意义的方法是模块化方法。设备的范围和信息类型太不同，无法归于单一工具。此外，数据的收集需要尽可能被动和异步 - 运行基础设施的现实意味着会有中断，您不能依赖始终能够获取数据。

我认为您指出的工具形成了一个可以协同工作的生态系统——Cobbler 可以从裸机安装并移交给 Puppet，后者支持生成 Nagios 配置并将配置存储在数据库中；对我来说，只有 Cacti 在以编程方式插入新设备、模板等方面有点不透明，但我知道这是可能的。

最终，您必须坐下来弄清楚哪些信息对您工作的业务很重要，并围绕它设计一个数据库模式。然后，研究如何将所需的信息获取到数据库中，无论是来自 Facter、Nagios、Cacti 还是直接 snmp 调用。

既然您询问了数据的收集，我认为如果您有完全不同的工具包（戴尔、惠普等），那么创建一个库以尽可能多地抽象出它们之间的差异是有意义的，因此您的脚本只是进行标准调用例如“检查磁盘健康”。添加新硬件时，您可以添加到库中，而不必编写全新的脚本。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-27T08:19:04.020

有一些免费的软件服务器数据库解决方案，但我不知道它们是否提供挂钩以使用 dmidecode 或 SNMP 从机器自动更新信息。我听说的一个（但没有个人经验，抱歉）是[GLPI](http://glpi-project.org/?lang=en)。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-05-29T04:40:28.520

我相信你正在寻找 Zabbix。它是开源的，易于安装和使用。几年前我为一个客户端安装过，如果我没记错的话，它有一个客户端应用程序连接到 zabbix 服务器以使用请求的信息对其进行更新。我真的推荐它：[http ://www.zabbix.com](http://www.zabbix.com)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-12-20T23:09:22.660

Checkout [Machdb](http://www.machdb.org/ "数据库")它是您所描述问题的开源解决方案。

# .net - 在参数中传递大量值类型的性能

> ID：763414
> 
> 赞同：0
> 
> 时间：2009-04-18T13:06:39.610
> 
> 标签：.net, performance

我目前正在阅读 Jon Skeet 的 C# in Depth 并且一直在阅读有关值和引用类型的内容。

这让我想到了使用值类型作为方法参数的成本，因为该值在传递时会被复制。虽然在考虑整数时这个成本并不高，但如果这些值参数是多次传递的字符串怎么办。

使用说 StringBuilder 类并传递它而不是字符串类型会有好处吗？

如果您认为字符串很长，例如 1024 个字符，并且在方法之间仅传递了几次，则将其与具有相同值的 StringBuilder 进行对比，该值最终将传递引用的值，每个值为 4 或 8 个字节时间，你可以有相当大的性能改进。

这个问题也可能突出我可能缺少的关于 String 类型的重要理解，请随时在需要的地方指出这一点。

另外，这对每个实例中的字符串的垃圾收集有什么影响？

编辑：显然我确实忘记了有关字符串的一条重要信息，它使问题无效。谢谢格罗弗。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-18T13:07:42.027

String 不是值类型，它们只是不可变的对象。

传递字符串会产生与任何其他对象相同的成本：其引用的大小，在 Win32 上为 4 个字节。

另外注意：值类型语义（通过值传递）可以由编译器以优化的方式实现。我还没有查看 MS JIT 是如何做到的，但它当然仍然只能发送一个指向它的指针并要求目标在写入时进行复制。

这就是我们在[托管操作系统联盟](http://mosa.codeplex.com)JIT/AOT 编译器中要做的事情。

# c# - 异步操作中的异步操作

> ID：763417
> 
> 赞同：2
> 
> 时间：2009-04-18T13:10:51.393
> 
> 标签：c#, wcf, multithreading, apartments

我的多线程知识仍然很初级，所以非常感谢这里的一些指示。我有一个接口 IOperationInvoker（来自 WCF），它具有以下方法：

```
IAsyncResult InvokeBegin(object instance, object[] inputs, AsyncCallback callback, object state)
object InvokeEnd(object instance, out object[] outputs, IAsyncResult result) 
```

鉴于此接口的具体实现，我需要实现相同的接口，同时在单独的线程中调用底层实现。（如果你想知道为什么，具体的实现会调用一个需要处于不同公寓状态的遗留 COM 对象）。

目前，我正在做这样的事情：

```
public StaOperationSyncInvoker : IOperationInvoker {
   IOperationInvoker _innerInvoker;
   public StaOperationSyncInvoker(IOperationInvoker invoker) {
       this._innerInvoker = invoker;
   } 

    public IAsyncResult InvokeBegin(object instance, object[] inputs, AsyncCallback callback, object state)
    {
        Thread t = new Thread(BeginInvokeDelegate);
        InvokeDelegateArgs ida = new InvokeDelegateArgs(_innerInvoker, instance, inputs, callback, state);
        t.SetApartmentState(ApartmentState.STA);
        t.Start(ida);
        // would do t.Join() if doing syncronously
        // how to wait to get IAsyncResult?
        return ida.AsyncResult;
    }

    public object InvokeEnd(object instance, out object[] outputs, IAsyncResult result)
    {
        // how to call invoke end on the 
        // thread? could we have wrapped IAsyncResult
        // to get a reference here?
        return null;
    }

    private class InvokeDelegateArgs {
        public InvokeDelegateArgs(IOperationInvoker invoker, object instance, object[] inputs, AsyncCallback callback, object state)
        {
            this.Invoker = invoker;
            this.Instance = instance;
            this.Inputs = inputs;
            this.Callback = callback;
            this.State = state;
        }

        public IOperationInvoker Invoker { get; private set; }
        public object Instance { get; private set; }
        public AsyncCallback Callback { get; private set; }
        public IAsyncResult AsyncResult { get; set; }
        public Object[] Inputs { get; private set; }
        public Object State { get; private set; }
    }
    private static void BeginInvokeDelegate(object data)
    {
        InvokeDelegateArgs ida = (InvokeDelegateArgs)data;
        ida.AsyncResult = ida.Invoker.InvokeBegin(ida.Instance, ida.Inputs, ida.Callback, ida.State);
    }
} 
```

我想我需要用我自己的方法来包装返回的 AsyncResult，这样我就可以回到我们处理的线程......但老实说，我有点超出我的深度。任何指针？

非常感谢，

詹姆士

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T13:34:05.037

异步实现同步方法的最简单方法是将其放入委托中，并在生成的委托上使用`BeginInvoke`and`EndInvoke`方法。这将在线程池线程上运行同步方法，`BeginInvoke`并将返回一个`IAsyncResult`实现，因此您不必实现它的核心。但是，您确实需要将一些额外的数据走私到`IAsyncResult`返回的`IOperationInvoker.InvokeEnd`. 您可以通过创建一个`IAsyncResult`将所有内容委托给内部的实现来轻松做到这一点`IAsyncResult`，但有一个额外的字段来包含委托，因此当`IAsyncResult`实例传递给时`InvokeEnd`，您可以访问委托以调用`EndInvoke`它。

但是，在仔细阅读您的问题后，我发现您需要使用带有 COM 设置等的显式线程。

您需要做的是正确实施`IAsyncResult`。几乎所有内容都由此而来，因为`IAsyncResult`它将包含同步所需的所有位。

这是一个非常简单但效率不高的`IAsyncResult`. 它封装了所有基本功能：传递参数、同步事件、回调实现、从异步任务传播异常和返回结果。

```
using System;
using System.Threading;

class MyAsyncResult : IAsyncResult
{
    object _state;
    object _lock = new object();
    ManualResetEvent _doneEvent = new ManualResetEvent(false);
    AsyncCallback _callback;
    Exception _ex;
    bool _done;
    int _result;
    int _x;

    public MyAsyncResult(int x, AsyncCallback callback, object state)
    {
        _callback = callback;
        _state = state;
        _x = x; // arbitrary argument(s)
    }

    public int X { get { return _x; } }

    public void SignalDone(int result)
    {
        lock (_lock)
        {
            _result = result;
            _done = true;
            _doneEvent.Set();
        }
        // never invoke any delegate while holding a lock
        if (_callback != null)
            _callback(this); 
    }

    public void SignalException(Exception ex)
    {
        lock (_lock)
        {
            _ex = ex;
            _done = true;
            _doneEvent.Set();
        }
        if (_callback != null)
            _callback(this);
    }

    public object AsyncState
    {
        get { return _state; }
    }

    public WaitHandle AsyncWaitHandle
    {
        get { return _doneEvent; }
    }

    public bool CompletedSynchronously
    {
        get { return false; }
    }

    public int Result
    {
        // lock (or volatile, complex to explain) needed
        // for memory model problems.
        get
        {
            lock (_lock)
            {
                if (_ex != null)
                    throw _ex;
                return _result;
            }
        }
    }

    public bool IsCompleted
    {
        get { lock (_lock) return _done; }
    }
}

class Program
{
    static void MyTask(object param)
    {
        MyAsyncResult ar = (MyAsyncResult) param;
        try
        {
            int x = ar.X;
            Thread.Sleep(1000); // simulate lengthy work
            ar.SignalDone(x * 2); // demo work = double X
        }
        catch (Exception ex)
        {
            ar.SignalException(ex);
        }
    }

    static IAsyncResult Begin(int x, AsyncCallback callback, object state)
    {
        Thread th = new Thread(MyTask);
        MyAsyncResult ar = new MyAsyncResult(x, callback, state);
        th.Start(ar);
        return ar;
    }

    static int End(IAsyncResult ar)
    {
        MyAsyncResult mar = (MyAsyncResult) ar;
        mar.AsyncWaitHandle.WaitOne();
        return mar.Result; // will throw exception if one 
                           // occurred in background task
    }

    static void Main(string[] args)
    {
        // demo calling code
        // we don't need state or callback for demo
        IAsyncResult ar = Begin(42, null, null); 
        int result = End(ar);
        Console.WriteLine(result);
        Console.ReadLine();
    }
} 
```

客户端代码看不到`IAsyncResult`实现对于正确性很重要，否则它们可能会不恰当地访问方法或过早`SignalException`读取。如果没有必要，可以通过不构造实现（在示例中）`Result`来提高类的效率，但这很难做到 100% 正确。此外，and可以并且应该在实现中处理掉，就像所有实现 的对象一样。显然，应该检查以确保它已经实现了正确的类，以获得比强制转换异常更好的异常。我省略了这些和其他细节，因为它们模糊了异步实现的基本机制。`WaitHandle``ManualResetEvent``Thread``ManualResetEvent``End``IDisposable``End`

# n-tier-architecture - N 层架构设计关注点分离

> ID：763421
> 
> 赞同：3
> 
> 时间：2009-04-18T13:17:38.117
> 
> 标签：n-tier-architecture

我意识到已经有很多关于 n 层设计的帖子，这可能是我在思考问题和绕圈子，但我现在自己都感到困惑，希望从社区中得到一些澄清。

我正在尝试将我创建的项目（并且从一开始就没有很好地设计架构）分成不同的层（每个层都在他们自己的项目中）：

*   用户界面
*   业务对象
*   逻辑/业务
*   达尔

**UI**应该只调用逻辑层来获取它的东西

**业务对象**不应调用或引用其他任何东西，只是存储数据的一种方式

**逻辑**/**业务**层应该包含系统中获取、创建、更新、删除 (CRUD) 对象的所有方法，并且可以引用 BO 和 DAL 。它将业务逻辑应用于操作，然后将实际的 CRUD 委托给 DAL。

**DAL**只会在数据库上执行 CRUD 操作。它将引用 BO，因为它会为 Gets 等返回它们。

我的问题是逻辑类是否应该只调用其等效的 DAL 类而只调用逻辑类？换句话说，`CompanyLogic`类应该只调用`CompanyDAL`类。因此，如果它想通过 ID 获取 Client 对象，它将调用`ClientLogic.GetClientByID(int)`而不是`ClientDAL.GetClientByID(int)`.

我认为它可能应该留在自己的层的原因是：

1.  这似乎会放松项目之间的耦合

2.  逻辑呢，如果获取客户端对象中有一些逻辑验证（可能不是最好的例子，但希望它能够理解这一点）。

**编辑：**

我不确定这是否是我的糟糕设计，但目前业务层有许多类，包括 ClientBULL 和 CompnayBULL，这两个类相互调用。我为每个类使用一个接口，并有一个工厂来构建对象以尝试减少任何耦合，但由于在两个类中调用方法，它们现在不能没有彼此而存在。这是一个坏主意吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T13:33:35.800

好吧，这是我对您的设计的评论：

*   逻辑对于本质上是分配给抽象持久性的层来说是一个坏名字。我可能会称它为“存储库”或“持久性”或 DAO（数据访问对象），而不是“逻辑”，它是模棱两可的，绝对意味着*任何东西*。

*   如果您真的想将业务层与 DAL 分离，您的逻辑层应该只接受 DAL 的接口，而不是具体的 DAL 类。

*   关于验证应该放在哪里，有两种思想流派。有些完全可以在 UI 层进行验证；其他人宁愿抛出异常或从业务层传递消息。无论你走哪条路，只要保持一致，不要在多个地方重复验证，你会没事的。

*   *继续尝试编码，*这可能是我能给你的最好的建议。仔细考虑它很好，但有一次你需要在编码时看到它，只有这样，微妙的怪癖和陷阱才会暴露出来。无论你能想出什么原型，肯定会对你的开发和设计方向有价值。

祝你好运！

**更新**

重新编辑：在同一个命名空间或程序集中，对具体类的调用绝对没问题。我认为你需要为业务逻辑建立接口会过于复杂——我的意思是你应该遵循的规则不止一套吗？

I'm a believer of keeping things simple and following [YAGNI](https://stackoverflow.com/questions/750112/overengineering-how-to-avoid-it/750134#750134). Don't make an interface until there are more than two classes that are going to implement/already implementing that interface (the DAL is always an exception to this though).

# ruby - 从文本中提取统计信息

> ID：763428
> 
> 赞同：0
> 
> 时间：2009-04-18T13:20:02.573
> 
> 标签：ruby, nlp

我想知道 ruby​​ 中给定文本或文本组（从数据库中提取）中最经常出现的内容是什么。

有谁知道最佳实践是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T13:24:22.267

您可以从[统计自然语言处理](http://en.wikipedia.org/wiki/Stochastic_grammar)开始。此外，您还可以利用[AI Ruby 插件](http://web.media.mit.edu/~dustin/rubyai.html)页面上提到的一个或多个库。

# c++ - 对于 boost-asio 网络编程，处理响应的最佳方法是什么？

> ID：763429
> 
> 赞同：1
> 
> 时间：2009-04-18T13:20:25.007
> 
> 标签：c++, network-protocols, boost-asio, asynchronous

我是网络编程的新手，尤其是异步进程。从 boost-lib 开始

我正在实现一个类，以访问 imap 服务器。一般来说，我可以发送和接收命令和响应

响应在类内的出列队列中排队。我将简单的响应行放入队列中，以供进一步处理。

现在处理排队响应的最佳方法是什么？

1.  一个额外的线程来检查（基于时间）队列，是否有新条目？
2.  每次将新条目推送到队列时都会进行一些回调？
    如何实现和集成此回调？

也许有人对此有一个简短的例子。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T14:37:15.163

实现队列处理器的一种可能方式是使用信令信号量。

例如，如果您在符合 POSIX 的平台上，则为**pthread 条件类型** （[描述）。](http://www.humbug.org.au/talks/pthreads/pthread_cond.html)

您可以在后台等待 N 个“队列处理线程”。

1.  每次将某些东西推入队列时，您的信号量都会发送它的信号。

    *   信号由休眠的“队列处理”线程接收，这些线程开始处理队列，因为它们知道自己有数据。

    *   当线程完成处理它的数据时，检查队列大小以查看它是否应该获取其他内容，如果没有，则返回等待信号。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T17:24:27.557

> 每次将新条目推送到队列时都会进行一些回调？如何实现和集成此回调？

我假设您正在使用单线程同步连接。

做这样的事情：

```
class worker {

    deque<message> messages;
    bool is_writing_;

    push_message(message msg) {
        messages.push_back(msg);
        notify();
    }

    void notify()
    {
        if(!is_writing_) {
            is_writing_=true;
            init();
        }
    } 

    void init()
    {
        if(messages.empty()) { is_writing_=false; return; }
        messamge msg=messages.pop();
        convert_to_vector(v);
        async_write(socket,buffer(v),
            boost::bind(&worker::complete,this,placehoders::error));
    }
    void complete(error_code const &e)
    {
        if(!e) {
            init();
        }
        else { cleanup(); }
    }

}; 
```

**笔记！！！**

这是单线程实现。如果你想从你不应该调用的其他线程通知`some_worker->push_message(msg)`，你应该使用 iosrvice：

```
service.post(boost::bind(&worker::push_message,some_worker,msg)); 
```

并且`push_message`将从运行 ioservice 的同一线程中调用。

# java - 不需要操作系统的 Java VM？

> ID：763438
> 
> 赞同：18
> 
> 时间：2009-04-18T13:24:28.320
> 
> 标签：java, jvm, vmware, virtualization, xen

我知道 BEA 正在开发不需要底层操作系统的 LiquidVM，但想知道开源社区中是否有人正在开发类似的东西。

理想情况下，我想找到一个 VM 直接由 OS 引导加载程序加载的实现。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-07-17T07:48:01.623

与 SANOS 不同，[JNode](http://www.jnode.org)操作系统是一个完整的操作系统，具有许多受支持的设备、文件系统、网络堆栈、GUI 堆栈、命令外壳和 50 个左右的命令等等。JNode 目前在启用了一个处理器的 x86（32 位）上运行，但 x86-64 和多处理器版本正在开发中。（JNode 是 99.99% 的 Java。移植到新架构需要重写汇编程序中 0.01% 的代码，创建/修改特定于硬件的驱动程序......并为新架构编写本机代码编译器。）

我们目前有大约 7 名活跃的开发人员，但我们一直在寻找新的人加入团队，尤其是了解 Java 和代码生成、垃圾收集器、驱动程序等的人。

（为了它的价值，我们使用最新版本的 OpenJDK 类库：最后一次计数为 1.6u24。）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-18T14:05:08.393

Sun 项目[Squawk](https://squawk.dev.java.net/)是一个在硬件而不是底层操作系统上运行的虚拟机。对于像Squawk 是操作系统的[Sun SPOT](http://research.sun.com/projects/squawk/squawk-sunspot.html)这样的嵌入式设备很有用。

Squawk 在 GPLv2 下获得许可。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-18T19:08:32.423

还有[Project Guest VM](http://research.sun.com/projects/dashboard.php?id=185)，它是托管在 Xen 管理程序上的 JVM。虽然主页似乎对细节很简单，但也有关于这个项目的[谷歌技术讲座。](http://www.youtube.com/watch?v=iHIaH12f2Ek)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-18T19:04:38.080

你需要什么？

也许 Sanos 可以在硬件和 JVM 之间为您提供一小段代码，您可以使用它们吗？

[http://www.jbox.dk/sanos/](http://www.jbox.dk/sanos/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-19T03:27:53.690

[JNode OS](http://www.jnode.org/)是一个主要用 Java 编写的操作系统。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-25T14:06:24.270

甲骨文似乎再次朝着这个方向努力

> 甲骨文收购 BEA 系统获得的收益……甲骨文复兴了前卫的虚拟化技术：一种直接在虚拟机管理程序上运行的 Java 虚拟机，无需操作系统。

看

*   [虚拟化 JVM](http://searchservervirtualization.techtarget.com/news/article/0,289142,sid94_gci1510355,00.html)
*   [使用 Java 虚拟化的 Oracle one-ups VMware](http://www.javaworld.com/community/node/4304)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-18T19:21:46.370

只是我看到和听到的一小段。

MIT 在 60 年代/70 年代开发了一台 Lisp 机器，这是一台本质上理解 Lisp 的机器，我认为他们也将其商业化。

大约在 2002 年，我听说有人在 FPGA 或 ASIC 芯片上开发 JVM。

MIT/Lisp 的故事是真实的，我在他们的博物馆里看到过，有谁知道关于芯片上的 JVM 是否有任何真相？

谢谢，马丁。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-05-28T07:50:33.073

我对java很陌生，而且我对电子有一些了解。

JVM 是实际运行在系统上的虚拟机。它可能是 windows 或 solares x86 平台。但据我所知，JVM 本身充当了我们编译的字节码的系统。对于字节码，JVM 虚拟化它自己的 ALU、Heap、Stack 额外。它甚至有自己的机器和汇编语言。

因此，如果我们能够在硬件芯片上实现 JVM 规范，那么它将不再是 JVM，但我将成为独立的 Java 机器，我们可以在其上开发 100% 用 Ja​​va 编写的操作系统。

所以在这种情况下，JVM 将不是一个操作系统，而是一个直接理解 java 字节码的系统。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-10-08T00:30:02.093

JOE，Java On Everything，可以在没有操作系统的情况下运行 Java。全部是 Java，在[https://github.com/joekoolade/JOE](https://github.com/joekoolade/JOE)

> 通过将操作系统构建到程序中，JOE 可以在没有操作系统的情况下运行 Java 程序。这使程序更易于配置和部署。JOE 可以使任何 Java 程序员成为嵌入式开发人员。
> 
> JOE is a process virtual machine that can run a Java application without an operating system. It builds the OS into the program by virtualizing the OS and hardware. This removes the boundaries between the OS, hardware, user code, and virtual machine. The overhead and complexities in the user/supervisor crossing, program security, memory protection, virtual addressing, and the JNI library interface are replaced with simpler and more efficient mechanisms found in the Java language. JOE seamlessly blends those layers together by implementing them all in Java. This virtualized Java environment provides a secure, safe, cohesive, and consistent object oriented operation from application to hardware.

# sql - MySQL 中“go”的等价物是什么？

> ID：763442
> 
> 赞同：28
> 
> 时间：2009-04-18T13:31:17.257
> 
> 标签：sql, mysql, tsql

在 TSQL 中，我可以声明：

```
insert into myTable (ID) values (5)
GO
select * from myTable 
```

在 MySQL 中，我无法编写相同的查询。

在 MySQL 中编写此查询的正确方法是什么？

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2009-04-18T13:33:09.703

行尾的分号。

```
INSERT INTO myTable (ID) values (5); 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-04-18T13:46:44.553

分号是默认分隔符。但是，您可以使用 DELIMITER 关键字将其重新定义为您想要的任何内容。来自 MySQL 手册：

```
mysql> delimiter //

mysql> CREATE PROCEDURE simpleproc (OUT param1 INT)
    -> BEGIN
    ->   SELECT COUNT(*) INTO param1 FROM t;
    -> END;
    -> //
Query OK, 0 rows affected (0.00 sec)

mysql> delimiter ;

mysql> CALL simpleproc(@a);
Query OK, 0 rows affected (0.00 sec) 
```

当然，这不仅限于存储过程定义。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-06-18T23:00:01.767

我认为问题在于 GO 是批处理终止符，而不是语句终止符。在明确设置事务之后，我执行了这段代码，而没有告诉我该过程已经存在。如果没有事务语句，我会收到一个错误，表明该过程已经存在。

开始交易；如果存在 usp_test，则删除程序；犯罪; 开始交易；创建过程 usp_test() 从书籍中选择 *；犯罪; 调用 usp_test();

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-04-18T13:33:12.837

只是一个简单的;

所以试试

```
insert into myTable(ID) values (5);
select * from myTable; 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-18T13:37:06.883

使用分号 ( `;`)。它将分开你的陈述。

# user-interface - 可以在密码框中粘贴文本吗？

> ID：763450
> 
> 赞同：4
> 
> 时间：2009-04-18T13:34:57.093
> 
> 标签：user-interface, passwords

您的 Web 开发人员怎么看？我们是否应该在我们的 Web 应用程序中禁用在蒙面密码框中粘贴。这可能是一个安全漏洞或导致混乱或不需要的结果吗？这可能是关于用户体验的问题，而不是关于编程的问题。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-18T13:38:53.043

粘贴**完全**没问题，实际上禁用有时会导致更大的问题。大多数用户使用 keepass 或类似的应用程序来存储强密码。

如果**您强制人们每次都输入，这可能会迫使他们选择较弱的密码。**

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-18T13:37:23.420

在恕我直言，粘贴是可以的，并且是预期的。*然而，复制*通常是被禁止的，这是有充分理由的。这也是现在的预期。你真的只想使用大多数用户熟悉的东西，除非你有充分的理由不这样做。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T13:38:27.707

不，不要禁用粘贴。

一些安全密码管理应用程序包括支持将其存储的密码直接放入 C&P 缓冲区，而无需在屏幕上显示，禁用粘贴会使这些应用程序的用处降低。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T13:52:27.923

允许粘贴，但要确保用户注意到他粘贴的内容不符合最大长度。我正在使用为我自动生成 10 个字符的密码的 KeePass，当我的密码不起作用时，它会变得一团糟，因为注册只使用了前 8 个字符或类似字符。

还要确保登录密码框与注册密码框的最大长度相同。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T13:38:35.040

我不会。我经常粘贴密码，例如随机生成的密码以进行重置。我认为这不会对 Web 应用程序构成安全风险，只是风险会由用户继承。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-18T14:56:07.677

如果粘贴会导致您的数据库查询失败，那么粘贴只会是错误的。除此之外，其他所有人都有合理的理由允许它。当我无法粘贴密码时，远程桌面让我很生气，因为我使用 KeePass 来管理复杂的密码。我剩下要做的就是在我输入密码时将密码以纯文本形式留在屏幕上。

# sql - sql 问题 .. 如何动态地将列添加到 sql 查询结果集中？

> ID：763454
> 
> 赞同：0
> 
> 时间：2009-04-18T13:37:59.673
> 
> 标签：sql, tsql, dynamic-sql

我正在编写一份报告以返回有关我数据库中对象（“文件”）的详细信息。我的应用程序允许用户创建自己的标志以用于文件对象。标志基本上由一个名称组成，然后标志实例存储一个位值以指示它是否为父文件对象设置。

我想编写一个查询，该查询返回数据库中每个文件的一行，其中结果集中的前几列包含文件详细信息（id、名称、大小等），其余列是标志名称，并返回位值指示是否为给定的文件行设置了标志。

那有意义吗？我该如何编写查询？

谢谢你的帮助。

编辑：澄清..

作为此查询的一部分，我需要运行一个子查询来返回用户创建的标志（我在设计时不知道这些），然后在主查询中合并检查每个标志值以返回详细信息关于文件。

简化架构如下：

*   文件 {Id，名称}
*   标记 {Id，名称}
*   FileFlags {FileId, FlagId} - 此表中的一行表示为文件设置了标志

我需要查询来返回一个带有如下列的结果集：

**FileId** **文件** **名 Flag1Name** **Flag2Name** .... **FlagNName**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T13:55:43.983

您可以从查看SQL Server 2005+ 中可用的[Pivot函数开始。](http://msdn.microsoft.com/en-us/library/ms177410.aspx)有了它和一些字符串连接，您应该能够为任意数量的列组装查询

根据您的评论，您的选择将如下所示：

```
 SELECT <non-pivoted column>,

            [first pivoted column] AS <column name>,

            [second pivoted column] AS <column name>, ...
    From Table 
    PIVOT (
...
FOR 
...
) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T14:37:09.813

为什么不创建一个具有所需逻辑的存储过程——查询特定于用户的标志等——并在此基础上动态构建一个包含所需变量的查询字符串？

然后，您可以使用`EXECUTE`将动态查询集返回给用户。请参阅[http://msdn.microsoft.com/en-us/library/ms188332.aspx](http://msdn.microsoft.com/en-us/library/ms188332.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T13:48:01.303

听起来您可能需要一个交叉表查询，您希望将行转换为列。标志是否作为与父表的一对多关系存储在单独的表中？

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-18T13:40:22.273

我想你想要的是一个别名。[这是来自http://www.sql-tutorial.net/SQL-Aliases.asp](http://www.sql-tutorial.net/SQL-Aliases.asp)的示例

```
SELECT Employee, SUM(Hours) AS SumHoursPerEmployee
FROM EmployeeHours
GROUP BY Employee 
```

我真的必须查看您的架构才能进一步提供帮助。

**编辑** 也许你需要嵌套`SELECT`的 s。 [http://sqlzoo.net/1a.htm](http://sqlzoo.net/1a.htm)

# code-complexity - 你写的最难的程序是什么？

> ID：763464
> 
> 赞同：20
> 
> 时间：2009-04-18T13:49:05.687
> 
> 标签：code-complexity

只是好奇，我想知道你们所有有经验的程序员或新手（比如我）都做了什么。那么你写过的最难最复杂的程序是什么？

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-04-18T14:19:39.357

我在 2005/6 年创建的应用程序让人们可以创建以不同颜色绘制的房屋/汽车等的可视化。现在这当然可以在 Photoshop 中完成，但它还有很多很多。

![Viresol 输出预览](https://www.perhac.com/shared/viresol.jpg)

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-04-18T13:50:43.793

编译器

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-18T14:11:13.417

我不想写的，也不想写的。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-04-18T14:29:05.933

我曾经不得不编写一个使用 BWT（Burrows Wheeler 变换）的压缩算法，并且在算法中有一个步骤，您必须创建一个 HUGE 矩阵。我遇到了内存问题和速度问题，因为矩阵太大了。来发现，有一个非常简单的算法我可以使用并完全避免使用矩阵。

我还必须在 ASM 中编写一个简单的操作系统，这非常棘手。

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-04-18T14:33:34.440

用于求解非线性偏微分方程的库。我们在一个理论物理小组中使用它来解决在非常特殊的低温环境中出现的薛定谔方程的非线性适应。

让一个简单的求解器工作相对容易，但将其泛化**并**使其快速运行是一个挑战。

它目前在谷歌代码上是开源的：[fdtl](http://code.google.com/p/fdtl/)

* * *

## 回答 #6

> 赞同：8
> 
> 时间：2009-04-23T13:21:13.340

我曾经做过一个实时多摄像机视频处理软件，做运动检测和累积直方图魔术，所有这些都在 33MHz 的处理器和 640Mb 的 RAM 上。困难的部分是让它快速进行。在大约 4 年的时间里，大量的哈希、位移、作弊、咒骂和深夜与比萨饼和顿悟。哦，我也做了一个处理颜色的版本。哦，还有一个模块可以在大房间里看到蒸汽和白烟之间的区别（就像核反应堆一样）。哈，你试试看！你不会在任何教科书中找到这样的例子。:)

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-04-18T14:05:43.213

使用一个代码库在 Windows 和 Mac 上编译和运行的应用程序。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-04-18T14:36:36.803

任何与加密和安全有关的事情总是比看起来要难 1000%！

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-04-18T15:28:18.410

用于不稳定在线服务的通用调制解调器驱动程序。它还必须支持 30 种类型的调制解调器（在 Hayes 调制解调器之前）。它们都有不同的时间特性。

对于我们产品的 CP/M 和 DOS 版本，它必须用 8086 和 Z80 汇编程序编写。我仍然对某个半双工调制解调器做噩梦......

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-04-18T14:10:15.650

使用 COM 实现自动化，跨网格执行

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-04-18T14:56:13.950

可能是平局：使用[可满足性模理论](http://www.smt-lib.org/)的集合决策问题求解器和在 UNIX 操作系统之上运行的 C/ASM 中的协作进程调度器。第一个非常困难——在使用 SMT 之前从未做过，并且将高度理论的论文翻译成在不同环境中的实际实现是很困难的。第二个涉及挖掘到 OS 数据结构以理解它们，然后替换零碎在程序中的函数之间来回跳转，就好像它们是单独调度的线程一样。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-04-18T15:08:52.420

使用 ffmpeg api 的专有视频流类 - 在处理数据包和在正确的时间显示帧的级别，与音频同步。不像列出的其他一些那么难，但它踢了我好几个星期！

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-04-18T14:00:49.370

调试器

* * *

## 回答 #14

> 赞同：3
> 
> 时间：2010-06-05T10:43:40.127

我在 1998 年开始编写的[矢量图形库](http://www.ffconsultancy.com/products/smoke_vector_graphics/?so)，它广泛使用分层细分来提供 O(log n) 中的许多操作和 OpenGL 显示列表中记忆的各向异性镶嵌，以保持动态场景的高帧率。特别是，它可以流畅地放大复杂的矢量图形，因为它可以将它们分解成树并有效地剔除它们。多年来，它一直是世界上最快的消费级矢量图形渲染器。

最初的版本是 200kLOC 的 C++，但构成其设计基础的理论问题花了我 2 年时间解决。

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2010-09-30T19:55:10.957

2件事：

1) 编译器。语言的名称是“3-balls”（向一位做过他的球手术的朋友致敬）

2）一个没有单个宏的Windows汇编程序，所有东西都被压入堆栈并且地址都是相对的。它适用于所有 Windows（无地址编码）。基本上它是一个带有一些按钮和标签的简单窗口。但好消息是，我从对象和可执行文件中提取了操作码并从中生成了一个 shellcode。所以我可以利用程序上的任何缓冲区，并在运行的应用程序之上创建我自己的应用程序！很高兴在远程计算机上显示屏幕，远程计算机将执行他计算机上不存在的程序，您实际上将要执行的程序发送到远程计算机。

当然，这是太多的头缓存......但它值得我输入的所有字节！

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-04-18T14:57:27.347

我已经编写了几段代码，这些代码在多个空间维度（从 3 维到高达 7 维）进行建模。当您处理无法实际绘制甚至可视化的事物时，问题变得更加困难。

但实际上，作为一个花费我大部分时间为其他人在工作中使用的工具包构建的人，我认为我做过的最复杂的程序实际上是工具箱，一组工具可以在一个一致的方式。因为它们都是一起工作的，所以你可以说几十个实用程序实际上就像一个工具一样工作。（当然，任何模块化代码在这方面都是类似的。）在这里，我提供的一般都是建模工具，用于解决色彩管理问题。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-04-18T16:49:30.870

几周前的一次采访中，我被问到了这个问题（仍然没有听说我是否得到了这份工作）。

对我来说，这是我在基本介绍课之后的第一个编程课上的几项作业。这是我的大学第一次开设网页设计课程。由于它是新的，几名即将毕业的大四学生报名参加了大约一半的班级。教官是教高年级的，已经认识班上的很多人了。基本上，他是在他们的水平上教授它，而不是为班上其他缺乏经验的人教授。

可能最困难的任务是编写纯文本浏览器。我在解析各种标签时遇到问题并寻求帮助。讲师说，好吧，如果你有编译器课程，你可以写一个简单的。那时，“编译器”是一个黑盒子，它在程序运行之前做了一些神奇的事情。我真的不知道它是什么，更不用说我能写一个了。

让这件事变得困难的是没有必要的工具来完成这项工作，包括理解我在谷歌上得到的结果。（如果您已经了解自己在寻找什么，手册页和 API 非常棒，但不适用于教菜鸟。）在我的合作经验中，当我有一位导师说，如果你被卡住时，我学到的最多超过几个小时，让我知道，这样我就可以让你摆脱困境并继续前进。比那些除了每周左右都不想收到我的消息的人要好得多。

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-04-18T14:07:37.013

我正在开发另一个 PHP 框架，到目前为止，这是一段有趣的旅程。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-04-23T13:25:40.193

我目前正在编写一个 iPhone 应用程序。这绝对是我写过的最难的程序。不是因为语言难，代码难或其他原因，而是因为设备上的一切都必须如此流畅。

一切都必须看起来和感觉自然。因为我是一个真正的程序员（对流畅性、流畅性或设计一无所知......所以看起来）这对我来说真的很困难。该程序在代码方面有效，但在用户界面方面我很难完成工作。

线程也很烂;-)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-04-18T15:15:10.423

没什么特别的，但是一个函数可以绘制一个带有三角形的“球体”，有 nxn 个点并在两种颜色之间插入三角形（所以输入是半径、细分数、color1、color2）。工作时很难但很有趣:)

# windows - 有谁知道如何在 Windows Vista 中打开 JSR-82 应用程序？

> ID：763470
> 
> 赞同：1
> 
> 时间：2009-04-18T13:52:34.477
> 
> 标签：windows, mobile, bluetooth, jsr, jsr82

我有一个连接到任何运行 JSR-82 的主机设备。问题是我没有运行 JSR-82 应用程序的移动设备。我希望我可以简单地在 Windows 中连接到我的主机设备。这可能吗？

（我目前正在运行 Vista x64）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-23T15:02:15.607

[如果您知道主机设备使用的是什么协议，您可以使用常规桌面 Java 和 JSR-82 的Bluecove](http://bluecove.org/)实现 编写自己的客户端。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T14:04:20.687

例如，您是否尝试过使用[诺基亚 SDK 中的](http://www.forum.nokia.com/Resources_and_Information/Tools/Java_Tools.xhtml)手机模拟器？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-21T15:04:16.477

考虑到即使是最新的 Java Platform Micro Edition Software Development Kit 3.0 也不正式支持 Vista x64 ( [http://java.sun.com/javame/downloads/sdk30.jsp#req](http://java.sun.com/javame/downloads/sdk30.jsp#req) )，我只能建议使用不同的操作系统。

对不起。

# javascript - 移动 jQuery Slider 作为 div 动画位置

> ID：763471
> 
> 赞同：0
> 
> 时间：2009-04-18T13:53:12.087
> 
> 标签：javascript, jquery, jquery-ui

我正在尝试创建一个时间线播放器。

我有一个 div 对象，它从屏幕的一侧移动到另一侧（即使用 animate() 来更改 div 的“左”位置）。让我们假设这个动画需要 5 秒才能发生。

我希望 jQuery 滑块在动画旁边一点一点地递增。滑块也必须花费 5 秒才能到达其末端以匹配它正在跟踪的动画。

有人知道如何实施吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T14:42:54.357

唔。滑块有一个手柄（一个`a`元素），带有`style="left: X%;"`.
以与其他动画相同的速度动画这个手柄怎么样？这是一个例子：

```
var $slider = $('#slider').slider(); // initialize the slider
var $handle = $slider.find('a'); // get the UI handle
var $other  = $('#other');

function moveHandle(perc, duration) {
  $slider.slider('disable').css('opacity', 1); // we don't want the user to
                                               // move it while animating
  $handle.animate({
    left: perc + '%'
  }, duration, function() {
    $slider.slider('enable');
  });
}
moveHandle(100, 2000);

$other.animate({
  left: 300 // replace 300px with whatever you want
}, 2000); 
```

一个工作演示： http: [//jsbin.com/iwise/36](http://jsbin.com/iwise/36)
您可以随意扩展或修改它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T15:40:30.050

我质疑为什么您希望滑块由动画对象控制，而不是让滑块控制动画。如果让播放栏控制动画，用户可以按预期随机播放。我已将我的工作演示放在[http://jsbin.com/ijoka](http://jsbin.com/ijoka)上。这个想法是有一个间隔计时器，在播放时增加播放头，并且*幻灯片*和幻灯片*更改*事件触发动画。

```
<script type="text/javascript">
        var playing = false;
        var interval;
        var i = 0;

        $(function() {
                $('#slider').slider({min: 0, max: 100});
                $('#slider').bind('slide', function(e, ui) { i = ui.value; a(ui.value);}).bind('slidechange', function(e, ui) { a(ui.value);});

        });

        function a(p) {
         $('#box').css('left', p + "%");
        }

        function play() {
            if(playing) {
                playing = false;
                clearInterval(interval);
            } else {
                i = $('#slider').slider('value');
                playing = true;
                interval = setInterval(step, 100);
            }
        }

        function step() {
            i = i + 2;
            $('#slider').slider('value', i);
        }
    </script> 
```

# mysql - size limit of a mysql query ruby/mysql

> ID：763477
> 
> 赞同：1
> 
> 时间：2009-04-18T13:58:57.707
> 
> 标签：mysql, ruby-on-rails, ruby

I hope this is the appropriate place to ask my question.

My mysql query currently looks like this

```
@records = Record.find(:all, :select => "`records`.id, records.level as level,
  (SELECT (count( b.id ) + 1)
  FROM records as a, records as b
  WHERE a.id =  records.id and b.skill > a.skill and b.created_at ='#{vandaag}' ) as ranktoday,
  (SELECT (count( a1.id ) + 1)
  FROM records as a1, records as b1
  WHERE a1.id =  timestamp1.id and b1.skill > a1.skill and b1.created_at ='#{timestamp1}' ) as ranktimestamp1,
  records.skill as skill, worlds.title as world, chars.name as name, vocs.voc as vocation, timestamp1.skill as timestamp1",
  :conditions => ["`s1`.title = :skill AND `records`.created_at = :vandaag ", {:skill => params[:id], :vandaag => vandaag, :timestamp1 => timestamp1}],
  :joins => "
  LEFT OUTER JOIN `skilltypes` as `s1` ON `s1`.id = `records`.skilltype_id
  LEFT OUTER JOIN `records` as `timestamp1` on `timestamp1`.character_id = `records`.character_id and `timestamp1`.created_at = '#{timestamp1}'
  LEFT OUTER JOIN `characters` as `chars` ON `chars`.id = `records`.character_id
  LEFT OUTER JOIN `vocations` as `vocs` ON `vocs`.id = `chars`.vocation_id
  LEFT OUTER JOIN `worlds` ON `worlds`.id = `chars`.world_id",
  :limit => "500",
  :order => "`records`.skill DESC" 
```

To me it's a quite long query and i'm afraid all these joins are causing my problems.
And if i'm right the order statement causes mysql to join all the records with the tables, and after that result only the first 500, instead of ordering the records first, limiting and then start joining it. You understand?

And the problem wouldn't be that big if i had only 1000 records, but currently i got 380000 records and daily i'm getting another 21000 records.

My actual question is how do I find out if it's better to split joins in different mysql queries?
Or is my mysql query just a mess and working on your laughmuscles and make me look like a fool?

I'm kind of stuck here since the loading time is horrible.

Greetz, Rikkert

Edit: And I've got indexes on characters.world_id, characters.vocation_id, records.character_id, records.skilltype_id, records.skill, records.world_id which i think should be enough Greetz, Rikkert

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-04T12:12:29.967

我绝对不是 MySQL 专家，但根据我的经验，我发现使用 sub-SELECTs 可能是一些性能问题的根源。

我尽量避免使用它们，但并不总是可以这样做。

这个 SO 有一些您可能会觉得有用的更多信息：

[MySQL子选择性能问题？](https://stackoverflow.com/questions/341086/mysql-subselect-performance-question)

它还讨论了我在这些情况下用来尝试诊断故障的 EXPLAIN 命令。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T14:51:06.550

My first question is, do you have indexes set up? Any place in your query that you have a comparison, you probably should have an index set up on the columns involved.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-19T11:00:45.360

首先，看起来您并没有真正按预期使用活动记录。让它为您管理表之间的关联。我猜可能有一种方法可以获得您需要的信息，而无需求助于那么多手动 sql 构建。抱歉，如果我只是挑选您为示例编辑的内容。

其次，使用 EXPLAIN 来了解 mysql 如何执行您的查询。

Mysql的查询规划器非常简单，经常让习惯Oracle等的人感到惊讶。mysql在线文档有一些关于Mysql如何使用索引的很好的资料。

优化复杂查询的一种常见模式是去规范化：也就是说，使用观察者来维护您想要的信息的第二个表（基本上是一个物化视图）。

# python - Python初学者：如何防止“终于”执行？

> ID：763480
> 
> 赞同：3
> 
> 时间：2009-04-18T14:01:21.380
> 
> 标签：python

功能代码：

```
# Connect to the DB
try:
    dbi = MySQLdb.connect(host='localhost', \
                          user='user', \
                          passwd='pass', \
                          db='dbname', \
                          port=3309)

    print "Connected to DB ..."

except MySQLdb.Error, e:
    apiErr = 2
    apiErrMsg = "Error %d: %s" % (e.args[0], e.args[1])
    return

    # To prevent try..finally bug in python2.4,
    # one has to nest the "try: except:" part. 
try:
    try:
        sql = dbi.cursor()
        sql.execute("""
        SELECT *
        FROM table
        WHERE idClient =  %s
        """, (key, ))

        access = sql.fetchall()

        # [some more code here]           

    except MySQLdb.Error, e:
        apiErr = 2
        apiErrMsg = "Error %d: %s" % (e.args[0], e.args[1])
        return

finally:
    sql.close()
    dbi.close() 
```

我知道在 try .. except .. finally 中，finally 块将始终执行。在上面的代码中，如果第一个 try 块中出现异常，我不希望执行第二个 try 块中的 finally。我究竟做错了什么？

（注：使用python 2.4）

澄清：我不知道发生错误时 MySQLdb 是否会自动关闭连接。上面代码我面临的问题是，当建立连接时出错（代码的第一个 try 块），在 finally 块中调用 dbi.close() 会引发“AttributeError: 'NoneType' object has no属性 'close'" 参考 dbi ...

**解决方案**：这按预期工作 -

```
# define at the start 
dbi = None
sql = None 
```

在 finally 块中，

```
if sql is not None:
    sql.close()
if dbi is not None:
    dbi.close() 
```

感谢那些回答的人。我从你们所有人那里学到了一些新东西。（下次我会尝试更清楚地表达我的问题:)。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T14:47:59.023

使用`else:`而不是`finally:`. 请参阅文档的[异常处理](http://docs.python.org/tutorial/errors.html#handling-exceptions)部分：

> 该`try ... except`语句有一个可选的 else 子句，当它出现时，它必须跟在所有 except 子句之后。如果 try 子句不引发异常，则它对于必须执行的代码很有用。

```
for arg in sys.argv[1:]:
    try:
        f = open(arg, 'r')
    except IOError:
        print 'cannot open', arg
    else:
        print arg, 'has', len(f.readlines()), 'lines'
        f.close() 
```

..基本上：

```
try:
    [code that might error]
except IOError:
    [This code is only ran when IOError is raised]
else:
    [This code is only ran when NO exception is raised]
finally:
    [This code is always run, both if an exception is raised or not] 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-18T14:14:58.727

我认为在这种情况下您确实想使用 finally，因为您想关闭这些连接。

我不同意在同一个方法中应该有两个 try 块的想法。

我认为设计中的缺陷是获取连接并以相同的方法执行查询。我建议将两者分开。服务类或方法知道工作单元。它应该获取连接，将其传递给另一个执行查询的类，并在完成后关闭连接。这样，查询方法可以抛出它遇到的任何异常，并将清理工作留给负责连接的类或方法。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-18T14:05:34.927

最后不要用。如果您不希望代码总是被执行，那么您应该找到另一个满足您需求的流控制结构。

完成此行为的一种方法是将“finally”块中的语句移动到“try”块的底部。这样，当抛出异常时它们不会被执行，但会在所有其他语句之后被执行，否则。

**编辑：**

经过进一步讨论，在您的情况下，您确实想使用“finally”。我建议在尝试关闭连接之前检查您的连接是否已经关闭。

# python - 站点地图中的优先问题

> ID：763485
> 
> 赞同：1
> 
> 时间：2009-04-18T14:05:41.963
> 
> 标签：python, django, sitemap

我正在尝试使用 Django 站点地图。

```
class BlogSiteMap(Sitemap):
    """A simple class to get sitemaps for blog"""

    changefreq = 'hourly'
    priority = 0.5

    def items(self):
        return Blog.objects.order_by('-pubDate')

    def lastmod(self, obj):
        return obj.pubDate 
```

我的问题是..我想将前 3 个博客对象的优先级设置为 1.0，其余的设置为 0.5 优先级。

我阅读了[文档](http://docs.djangoproject.com/en/dev/ref/contrib/sitemaps/#ref-contrib-sitemaps)，但无法摆脱它。

任何帮助都是不言而喻的。提前致谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T15:02:47.223

我认为您可以更改每个对象的优先级。比如这样：

```
def items(self):
    for i, obj in enumerate(Blog.objects.order_by('-pubDate')):
       obj.priority = i < 3 and 1 or 0.5
       yield obj

def priority(self, obj):
    return obj.priority 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-22T15:23:40.670

类似的东西可能会起作用：

```
def priority(self, obj):
    if obj.id in list(Blog.objects.all()[:3].values_list('id'))
        return 1.0
    else:
        return 0.5 
```

# jquery - 表达式网络中的智能感知 jquery + 外部 js？

> ID：763490
> 
> 赞同：1
> 
> 时间：2009-04-18T14:07:38.497
> 
> 标签：jquery, intellisense, microsoft-expression-web

谁能告诉我我做错了什么？我正在尝试在表达式 web 2 中为外部 js 和 jquery 获取智能感知

我可以在 Visual Studio 2008 中做到这一点

我已经搜索了谷歌，但似乎无法找到这样做的方式

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T14:30:52.247

我知道您必须为 VS2008 安装一个[修补程序才能让智能感知与 jQuery 一起工作。](http://code.msdn.microsoft.com/KB958502)该修补程序允许 VS 解析文件的 VS 注释版本以获取智能提示。我认为 Expression Web 不存在类似的修补程序。

引用链接：

> 此修补程序仅适用于产品 Visual Studio 2008 SP1 和带有 SP1 的 Visual Web Developer 2008 速成版。如果您尝试将其应用到其他版本的 Visual Studio 或 Visual Web Developer Express，您将收到带有消息的错误对话框。

# sql-server - Log SQL Server Password change

> ID：763498
> 
> 赞同：1
> 
> 时间：2009-04-18T14:14:12.130
> 
> 标签：sql-server, security, windows-xp, passwords, password-protection

I have a recent unfortunate event. I host a business partner's SQLServer 2005 server, and the "sa" password was mysteriously changed (nobody wants to take responsibility on it). So I was wondering, **is there a way I can configure SQL Server 2005 to log all password changes?**

I know that could be achieved with Windows Server 2003, Windows Server 2008 or similar. But the thing is, I am running on Windows XP Pro (I know I should not be doing this, but my business partner claims she doesn't have the budget to buy a full fledge Windows Server OS).

Thanks a lot!

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-19T17:58:24.190

一些想法...

1.  使用 SQL 分析器，[审核登录更改密码事件类](http://technet.microsoft.com/en-us/library/ms190672(SQL.90).aspx)
2.  [DDL 触发器](http://technet.microsoft.com/en-us/library/ms189799(SQL.90).aspx)，指定[ALTER USER DDL 事件](http://technet.microsoft.com/en-us/library/ms189871(SQL.90).aspx)
3.  重命名“sa”，创建一个虚拟“sa”帐户

任何有权更改密码的人都可以撤消或关闭任何审核

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-19T00:41:07.757

一旦您第二次丢失数据，他们是否有足够的资金从头开始重新创建数据库？说真的，您应该简单地使用 Windows 事件查看器来查看最后一次访问。SA 通常会在安全日志中显示一个事件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-07-24T08:55:58.183

gbn有正确的想法

在研究同一主题时，我发现了 Aaron Bertrand 写的一个很好的例子。
本质上，您需要使用 AUDIT_LOGIN_CHANGE_PASSWORD_EVENT 参数创建一个事件

```
CREATE EVENT NOTIFICATION PasswordChangeNotification
    ON SERVER WITH FAN_IN
    FOR AUDIT_LOGIN_CHANGE_PASSWORD_EVENT
    TO SERVICE 'PasswordChangeService', 'current database';
GO 
```

你可以在这里找到他的例子
[http://www.mssqltips.com/sqlservertip/2708/tracking-login-password-changes-in-sql-server/](http://www.mssqltips.com/sqlservertip/2708/tracking-login-password-changes-in-sql-server/)

# php - 在 MySQL 中，如何从具有三个字段的搜索表单中检索多个值？

> ID：763510
> 
> 赞同：1
> 
> 时间：2009-04-18T14:28:04.500
> 
> 标签：php, mysql

我有两张桌子：

1.  客户
2.  城市

然后在搜索表单中我有三个字段：

1.  填写客户姓名的文本输入表单
2.  一个选择框来选择他们想要搜索的城市（表格城市）
3.  另一个选择框选择用户想要搜索的主要业务（业务包含在客户表中）

根据表单字段的选择，它将从两个表中进行搜索。

我正在考虑根据用户选择进行多个 SQL 查询。

问题是用户可能不会用客户的名字填写输入表单，或者可能会，但不会选择城市等。

那么我是否必须根据用户选择执行多个 if 来显示多个 sql 查询？也许我有一个不那么令人困惑的解决方案......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T14:37:04.773

也许您的数据库结构可以更改以帮助您。例如，我假设您在城市和客户之间有关系。听起来企业类似于“技术”或“搜索”，在这种情况下，您可以拥有多个具有相同业务的客户吗？可能值得将业务移植到单独的表中，然后参考这些表。然后你可以有一个简单的查询，例如：

```
SELECT *
FROM clients
WHERE clients.city = {form result: cities.id}
AND clients.business = {form result: businesses.id}
ORDER BY clients.name
LIMIT 0, 30 
```

现在假设用户没有填写其中一个字段（例如城市），您有两个选择：通过验证用户输入强制他们填写或将其用作通配符，在这种情况下，您可以`WHERE clients.city`从查询中删除该子句。假设您要提供来自 Cities的`<select>`选项值。`id`

在这种情况下，我将以编程方式构建查询：

```
$queryStr = 'SELECT * FROM clients';
if (!empty($_POST['city']) && !empty($_POST['business'])) {
    $queryStr .= ' WHERE city = ' . filter($_POST['city']) . ' AND business = ' . filter($_POST['business']);
} elseif (!empty($_POST['city'])) {
    $queryStr .= ' WHERE city = ' . filter($_POST['city']);
} elseif (!empty($_POST['business'])) {
    $queryStr .= ' WHERE business = ' . filter($_POST['business']);
} else {
    // pass
}
$queryStr .= ' ORDER BY name LIMIT 0, 30'; 
```

其中 filter 是您选择的过滤方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T14:41:59.927

只需使用您的标准查询数据库。如果客户/城市确实存在，那么它们就会出现，否则查询将返回一个空集。就这么简单，无需验证其中任何一个的存在——例如，用户应该足够聪明，能够想出一个现有的城市名称。

你唯一需要做的就是mysql_real_escape_string()。

# asp.net - IIS 同时请求限制

> ID：763512
> 
> 赞同：4
> 
> 时间：2009-04-18T14:28:53.140
> 
> 标签：asp.net, iis, iis-7

Vista 上的 IIS 7 对并发请求有限制（最多 10 个）。我的 Vista 上有一台安装了 Windows Server 2008 的 Virtual PC。虚拟 PC 上的 IIS 7 仍然限制同时请求。当我在 ASP.NET 开发服务器上运行相同的应用程序时，没关系 - 没有限制。

是主机操作系统的问题吗？如何调整 IIS 以处理更多并发请求？这对于应用程序来说是必须的，因为它应该处理大量并发的打开连接和与之连接的请求。

**UPD：**我注意到在 Vista 本身和虚拟 PC 下运行应用程序之间存在差异。

在 Vista 上运行时，存在请求限制 (10)。如果已经有 10 个长时间运行的请求，则以下请求会挂起（它们在请求队列中）。

在虚拟机上运行时会发生一些奇怪的事情。我只完成了 2 个长期运行的请求。以下请求（即使不是长时间运行）被阻止。

对于这个测试，我使用了自己编写的负载测试脚本。它一次推送很多请求。

有任何想法吗？如何在 IIS 上测试应用程序？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T14:40:04.080

我会说最可能的罪魁祸首是微软限制了与其消费级操作系统的同时*入站连接的数量。*现在，我们不能让您将它们用作服务器！:)

您是否`500 Server Busy`在虚拟服务器上遇到错误，或者请求在网络级别被拒绝？答案将回答您的问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-02-04T13:27:27.213

Virtual PC 是一个客户端虚拟化软件，主要用于测试、演示等。你可以在上面安装服务器操作系统，但连接限制仍然适用。

IIS7 以后的请求不会被拒绝，而只是排队，所以您所看到的是预期的。负载测试需要在使用服务器虚拟化 (hyper-v) 的服务器操作系统上进行。

# database - sqlite 上的 information_schema.columns

> ID：763516
> 
> 赞同：7
> 
> 时间：2009-04-18T14:31:15.427
> 
> 标签：database, sqlite, schema

我想做如下查询：

```
SELECT table_name, column_name, data_type, is_nullable, ... 
FROM information_schema.columns 
```

在 sqlite 数据库上。

我检查了

```
PRAGMA table_info(table_name); 
```

但不适合我的需要，只需检查*一张*表的字段。

我检查了

```
select * from sqlite_master where type = 'table'; 
```

但这只是获取表名和创建查询。

有没有办法将这些“加入”到方法中？或任何其他建议或想法？发送

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-23T22:54:07.943

我知道您不想听到这个，但是您将无法使用 SQLite 从 SQL 进行连接。`table_info`pragma 没有映射到标准查询，而是硬编码到 SQLite 源中的虚拟机程序。该程序仅支持单个表。句号。:)

如果您的需求只是测试，那么编写脚本来做您想做的事情应该不会太难。否则，您将不得不将其写入您的应用程序。无论哪种方式，您都将使用您的 sqlite_master 查询从 sqlite_master 中选择表名，使用 从中进行 SQL 查询`sqlite3_mprintf("pragma table_info(%s);",name)`，然后准备/执行它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T15:06:01.663

SQLite C API 对这类事情有更多的支持；例如，请参阅[此页面](http://www.sqlite.org/c3ref/table_column_metadata.html)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-10-24T02:18:24.230

仅供参考，如果您使用的是 .Net，则可以使用 DbConnection.GetSchema 方法来检索通常位于 INFORMATION_SCHEMA 中的信息。如果你有一个抽象层，你可以为所有类型的数据库使用相同的代码（注意 MySQL 似乎切换了限制数组的第一个 2 个参数）。

# javascript - JQuery hover, image map, loops and arrays

> ID：763519
> 
> 赞同：3
> 
> 时间：2009-04-18T14:32:13.850
> 
> 标签：javascript, jquery

I want to use the jQuery hover method for rollovers above a base area image map that incorporates numerous odd shapes, so that rolling over each exact shape triggers an image swap, as well as an .innerhtml swap in a separate text block. I started with a placeholder “zero” image that’s completely transparent, then swap to a png above the live image map area on rollover, then back to the zero image on rollout.

So, code for one area map zone looks something like the below. Here, areamapImage1 corresponds to a coordinate zone of the base image.

```
$('#areamapImage1').hover(
    function() {
        $('#imageSwap').attr('src','images/image1.png');
    },
    function() {
        $('#imageSwap').attr('src','images/image0.png');
}); 
```

This works like a charm, as long as I declare each hover function explicitly. For 20 images, that generates a ton of unnecessary code; obviously, it screams for arrays and a loop. So... should be simple to fill two arrays: one for the image map areas and one for the swap images. Console logging after the loop gives me what I expect, but the hover function doesn’t work. As I’ve never done much of anything in JS, I strongly suspect there’s a brain-dead operator error here, either due to JS/jQuery syntax or scope. As far as I can tell though, the variables should be available to the hover function(?). Both arrays return strings. jQuery has a syntax that puts selectors in single quotes; when I tried setting up the imageArea array to include the quotes explicitly, the hover threw a very strange syntax error, so I assume jQuery just uses regular strings instead.

Thanks for any suggestions!

```
$(document).ready(function() {

    // image preload
    var imageSource = []; 
    imageSource[0] = 'images/image0.png'  //load 0 position with "empty" png
    var imageAreas = [];

    // area map and image array fill
    for (var i=1; i<21; i++) {
        imageSource[i] = 'images/image' + i + '.png'; // 
        imageAreas[i] = '#areamap_Image' + i;

    $(imageAreas[i]).hover(   // hover function

        function() {
            $('#imageSwap').attr('src',imageSource[i]); 
        },
        function() {
            $('#imageSwap').attr('src','images/image0.png');
    });

};

}); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T14:37:59.203

As posted, your hover call isn't within your for loop, so it's only running for i=21.

EDIT: I'm going to expand this and actually propose a different method: first loop through all your area maps and add some information to them using jQuery's 'data' call. That way you can assign the same hover function to all your area maps.

Example:

```
$(document).ready(function() {
  for(var i = 1; i < 21; i++) {
    $('#areamap_Image' + i).data('rolloverImage', 'images/image' + i + '.png');
  }

  // Replace 'area' with a more specific selector if necessary
  $('area').hover(
    function() {
      $('#imageSwap').attr('src', $(this).data('rolloverImage'));
    },
    function() {
      $('#imageSwap').attr('src', 'images/image0.png');
    }
  );
}); 
```

# c++ - 删除一个字符数组

> ID：763520
> 
> 赞同：24
> 
> 时间：2009-04-18T14:32:19.310
> 
> 标签：c++, memory-management

这个问题与[这个](https://stackoverflow.com/questions/763213/what-would-this-code-do-memory-management)有关。鉴于此代码：

```
char *p = new char[200];
delete[] p; 
```

如果你`p[100] = '\0'`在删除p之前设置会发生什么？

当我尝试删除非空终止字符数组时，我有一些代码出现调试错误，这与删除未分配的堆内存有关。它似乎删除了数组边界之外的内存。

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-04-18T14:34:13.643

编码：

```
char *p = new char[200];
p[100] = '\0';
delete[] p; 
```

是完全有效的 C++。delete 不知道也不关心以 null 结尾的字符串，因此您的错误一定有其他原因。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-18T14:36:46.867

不会有什么特别的事情发生。您将在分配的内存中间的某个位置写入（距开头 100 个字节，在分配的内存结束前 99 个字节）。

然后你会释放分配的内存。编译器将完全按照我们的预期处理它。由它分配的内存与以空字符结尾的字符串完全无关。你可以把你想要的一切都塞进那个记忆里。它是一些“原始”存储块，您甚至可以在该内存中创建一些任意 C++ 对象（放置新）。

您的错误在其他地方。例如，一些常见的错误是这个，构造函数被调用一次，但析构函数被调用了两次，双重删除了一些东西：

```
struct A { P *p; A() { p = new P; } ~A() { delete p; } };
A getA() { return A(); } int main() { A a = getA(); } 
```

现在，发生的情况是默认构造函数被调用一次，而创建的对象被复制零次或多次。但是为每个创建的副本运行析构函数。因此，您将多次调用指针上的析构函数，从而导致这些奇怪的错误。*解决这个*问题的正确方法是使用智能指针，例如`shared_ptr`. 作为练习，您也可以不这样做，通过编写适当的复制构造函数来复制对象并在复制构造函数中分配内存，以便副本和相应的原始对象保持不同的指针。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-18T14:38:05.927

我认为您将普通的旧 char 数组与表示 C 样式字符串的 char 数组混淆了。C++ 删除操作符不关心 C 风格的字符串数组。它所看到的只是一个字符数组。这实际上与删除一个 int 数组没有什么不同。

空终止符的存在与否仅与将 a`char*`视为 C 样式字符串的函数相关。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-18T14:35:09.287

应该没关系。delete[] 应该用于删除动态分配的数组，而不管其内容如何。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-18T14:36:47.943

据我所知，这应该可以正常工作。您分配了一块内存，操作系统应该跟踪它，并且能够在被询问时释放它。将什么值放入已分配的缓冲区中根本不重要。

在字符数组中间添加 NULL 肯定会干扰 C 字符串函数，例如`strcmp`,`strlen`等，但这完全是另一回事。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-18T14:40:04.457

正如其他人所指出的，您发布的代码是完全有效的，不会造成任何问题。

该错误可能是由更改`p`介于两者之间的值引起的。

# asp.net - 不明白这个例外

> ID：763527
> 
> 赞同：0
> 
> 时间：2009-04-18T14:36:20.907
> 
> 标签：asp.net, linq-to-sql

我使用 linq to sql 我有一个 Mission 实体，它包含一组作业。假设我去查询每个任务的所有任务的总持续时间。

我写了以下查询：

```
return db.Missions.Select(m => new MissionNameDays()
    {
        Name = m.MissionName,
        Days = m.Assignments.Sum(a => a.Duration())
    }); 
```

持续时间被简单地定义为（为了简单起见）

```
public partial class Assignment
{
    public int Duration()
    {
        return 1;
    }
} 
```

运行此代码给了我以下异常：

> 当不使用 EXISTS 引入子查询时，选择列表中只能指定一个表达式。
> 说明：执行当前 Web 请求期间发生未处理的异常。请查看堆栈跟踪以获取有关错误及其源自代码的位置的更多信息。
> 
> 异常详情：System.Data.SqlClient.SqlException：当子查询没有用EXISTS引入时，选择列表中只能指定一个表达式。

我注意到如果我从查询中省略 Duration() （又名

```
Days = m.Assignments.Sum(a => 1) 
```

它工作正常
关于这个原因的任何想法？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T14:44:26.130

Duration 属性在 SQL 语句中是不可表达的，因为它不是表属性。由于它是 Assignments 上的方法，因此表达式解析器无法正确地将其转换为有效的 SQL 表达式。据推测，Assignments 表中有一些列将计算 Duration。尝试在 Select 表达式中使用用于计算 Duration 的相同表达式。

```
return db.Missions.Select(m => new MissionNameDays()
    {
        Name = m.MissionName,
        Days = m.Assignments.Sum(a => a.LengthInMinutes / 1440 )
    }); 
```

或者，您可以完成查询，然后使用 LINQToObjects 进行选择，这将与非列属性/方法一起使用。由于您没有在此查询中过滤任务，我想我会采用这种方法。

```
return db.Missions.ToList().Select(m => new MissionNameDays()
    {
        Name = m.MissionName,
        Days = m.Assignments.Sum(a => a.Duration())
    }); 
```

# asp.net - 为选定的会话变量设置长超时

> ID：763541
> 
> 赞同：0
> 
> 时间：2009-04-18T14:42:49.643
> 
> 标签：asp.net, asp.net-2.0, session-timeout

net 2.0，我希望管理会话变量超时 1 小时。

是否可以？如何？

我正在使用 Windows 身份验证。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T14:47:26.403

您可以在 web.config 中全局设置会话超时：

```
<configuration>
  <system.web>
    <sessionState 
      mode="InProc"
      cookieless="true"
      timeout="30" />
  </system.web>
</configuration> 
```

您可以通过设置 Session.Timeout 以编程方式覆盖代码中的该设置（例如，仅用于管理员会话），例如：

```
// set the current session's timeout to 60 minutes
// if the current user is an admin
if (currentUserIsAdmin)
    Session.Timeout = 60; 
```

查看[此 MSDN 页面](http://msdn.microsoft.com/en-us/library/system.web.sessionstate.httpsessionstate.timeout.aspx)了解详细信息。

# java - 在Java中，当我不在内部类中时如何访问外部类？

> ID：763543
> 
> 赞同：32
> 
> 时间：2009-04-18T14:43:30.907
> 
> 标签：java, syntax, nested

如果我有一个内部类的实例，如何*从不在内部类中的代码访问外部类*？我知道在内部类中，我可以`Outer.this`用来获取外部类，但我找不到任何外部获取方法。

例如：

```
public class Outer {
  public static void foo(Inner inner) {
    //Question: How could I write the following line without
    //  having to create the getOuter() method?
    System.out.println("The outer class is: " + inner.getOuter());
  }
  public class Inner {
    public Outer getOuter() { return Outer.this; }
  }
} 
```

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-18T15:32:29.773

类的字节码将包含一个名为type`Outer$Inner`的包范围字段。这就是在 Java 中实现非静态内部类的方式，因为在字节码级别没有内部类的概念。`this$0``Outer`

如果您真的愿意，您应该能够使用反射读取该字段。我从来没有任何需要这样做，所以你最好改变设计，这样就不需要了。

以下是使用反射时示例代码的外观。男人，太丑了 ;)

```
public class Outer {
    public static void foo(Inner inner) {
        try {
            Field this$0 = inner.getClass().getDeclaredField("this$0");
            Outer outer = (Outer) this$0.get(inner);
            System.out.println("The outer class is: " + outer);

        } catch (NoSuchFieldException e) {
            throw new RuntimeException(e);
        } catch (IllegalAccessException e) {
            throw new RuntimeException(e);
        }
    }

    public class Inner {
    }

    public void callFoo() {
        // The constructor of Inner must be called in 
        // non-static context, inside Outer.
        foo(new Inner()); 
    }

    public static void main(String[] args) {
        new Outer().callFoo();
    }
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-18T14:52:20.307

没有办法，设计使然。如果您需要通过内部类的实例访问外部类，那么您的设计是倒退的：内部类的要点通常只在外部类中使用，或者通过接口使用。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-18T15:41:55.430

当您需要访问外部类时，添加 getter 有什么问题？这样您就可以控制是否允许访问。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-07-14T10:48:06.987

事实上，这是一个非常好的问题，例如，如果您需要能够检查一个类的两个不同实例是否`Innner`共享同一个类实例`Outer`（== 或等于，具体取决于上下文）。

我建议制作一个通用接口（命名内部类并非绝对需要，但可以“instancedof”/强制转换为）：

```
public interface InnerClass<Outer> {
    Outer getOuter();
} 
```

可以应用于任何命名的内部类。

然后你做类似的事情：

```
class MyInnerClass implements InnerClass<Outer> {
    Outer getOuter() {
        return Outer.this;
    }
    // remaining implementation details
} 
```

这样您就可以从任何实现`InnerClass<Outer>`接口的内部类访问外部类（并检查它是否实际实现了它）。

如果您的内部类是匿名的，您只能这样做（感谢 Rich MacDonald 的示例）：

```
new InterfaceOrAbstractClass<Outer>() {
    Outer getOuter() { // super inefficient but this is the only way !
        return (Outer)getClass().getDeclaredField("this$0");
    }
    /* other methods */
} 
```

但`InterfaceOrAbstractClass` **必须**实现`InnerClass<Outer>`能够`getOuter()`在匿名类主体之外访问！

如果 javac 自动在所有内部类上实现某种`InnerClass<Outer>`接口会容易得多，并且即使在匿名类上它也可以非常高效地做到这一点（没有缓慢的内省处理）！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-18T15:53:29.693

如果您有一个（非静态）内部类，那么根据定义，您正在使用仅在外部类的封闭上下文中起作用的东西。因此，要获得内部类的句柄，您已经必须通过外部实例检索它。所以我能看到的唯一方法就是你需要一个这样的访问器是通过外部引用抓住内部，然后丢失或丢弃外部实例引用。

例如：

```
public class Outer{ 
   public class Inner {
   }
}

public class UsesInner{
 Collection<Outer.Inner> c = new ArrayList<Outer.Inner>();
} 
```

现在，您可以填充 c 的唯一方法是创建 Outer() 实例。我很想看到这样的有用目的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-03T21:58:08.940

这是您可能需要此行为的一个原因：您拥有内部`class`实例，并且需要`class`使用反射访问外部定义的方法。

为了记录，`inner.getClass().getDeclaredField("this$0")`工作。既然是字段`private`，你也需要调用`field.setAccessible(true)`。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2013-01-29T17:22:47.857

简单地写这个

```
class Outer {
  class Inner {
    Outer outer = Outer.this;
  }
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-18T15:46:23.533

你不能做这样的事情：

```
public static class Inner { // static now
    private final Outer parent;

    public Inner(Outer parent) { this.parent = parent; }

    public Outer get Outer() { return parent; }
} 
```

# django-models - django 对象获取/设置字段

> ID：763558
> 
> 赞同：28
> 
> 时间：2009-04-18T14:55:53.840
> 
> 标签：django-models

我可以通过其他方式获取对象字段的值`obj.field`吗？类似的东西`obj.get('field')`存在吗？设置字段的值也是如此。

* * *

## 回答 #1

> 赞同：70
> 
> 时间：2009-06-19T20:24:07.390

要获取字段的值：

```
getattr(obj, 'field_name') 
```

要设置字段的值：

```
setattr(obj, 'field_name', 'field value') 
```

要获取 Django 对象的所有字段和值：

```
[(field.name, getattr(obj,field.name)) for field in obj._meta.fields] 
```

您可以阅读[Model _meta API](https://docs.djangoproject.com/en/1.10/ref/models/meta/)的文档，这非常有用。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-18T15:10:11.077

你为什么要这个？

你可以使用

```
obj.__dict__['field'] 
```

我猜......虽然它不是一个方法调用

```
changed=[field for (field,value) in newObj.__dict__ if oldObj.__dict__[field] != value] 
```

将为您提供所有更改的字段的列表。

（虽然我不是 100% 确定）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-11-08T15:24:58.113

如果有人偶然发现这个小问题，答案就在这里： [如何自省 django 模型字段？](https://stackoverflow.com/questions/2384436/how-to-introspect-django-model-fields)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-06-18T19:57:16.833

获取相关字段：

```
def getattr_related(obj, fields):
    a = getattr(obj, fields.pop(0))
    if not len(fields): return a
    else:               return getattr_related(a, fields) 
```

例如，

```
getattr_related(a, "some__field".split("__")) 
```

不知道，也许有更好的方法可以做到这一点，但这对我有用。

# jquery - 为什么 jQuery load() 不起作用？

> ID：763561
> 
> 赞同：6
> 
> 时间：2009-04-18T14:56:08.550
> 
> 标签：jquery

为什么下面的 jQuery 代码不起作用？我已经在正文中放置了一个 div 元素。谢谢！

```
$(document).ready(function(){
  $("div").load("http://www.pagetutor.com/index.html");
}); 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-18T14:58:37.250

没有更多信息：

除非是 json 内容，否则您无法加载远程域内容。

[这是浏览器限制。](http://en.wikipedia.org/wiki/Same_origin_policy)

# licensing - 是否有可能拥有 DRM 软件的开源实现？

> ID：763572
> 
> 赞同：2
> 
> 时间：2009-04-18T15:03:18.907
> 
> 标签：licensing, cryptography, drm, security-by-obscurity

我很想知道是否有人想出了一种方法来以开源方式创建 DRM 的服务器部分，同时允许关闭 DRM 客户端。我知道如果客户端是开源的，那么删除 DRM 检查会很容易，但我相信服务器不会遇到同样的挑战。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-18T15:41:36.367

不是以任何实际的方式。

了解为什么将 DRM 与加密进行比较会有所帮助。加密是一种与受信任的第二方共享秘密的机制，而不受信任的第三方无法接收秘密消息。加密建立在非常扎实的数学背景之上，并且之所以起作用，是因为第二方被认为是可信任的用于解锁秘密消息的密钥。

另一方面，DRM 不将信任分配给除原始来源之外的任何一方。假设是第二方对秘密消息拥有有限的、可撤销的权利，并且不会将消息传递给任何其他方，即使他们愿意。问题是第二方必须以某种方式仍然解密消息，即使他们不相信有这样做的能力。这是 DRM 的基本概念挑战。

DRM 使用两种技术来实现这一点。首先是晦涩难懂。用于加密或解密托管消息的机制、算法和密钥本身是保密的。其次，专利保留用于某些方面，通常是解码算法，以便知道该部分的各方在法律上无法将其披露给其他方，或在没有适当许可的情况下使用它。

这两个功能都与开源相反。就其本质而言，开源公开了算法。在所谓的开源下发布的任何代码恰好也受专利保护，实际上并不是免费软件。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-18T15:04:02.650

这是可能的，但就像任何 DRM 一样，它天生就被破坏了。;)

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-18T15:23:03.900

还有[Project DReaM](http://en.wikipedia.org/wiki/Project_DReaM)，Sun 的开源 DRM 框架。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-18T15:11:59.183

我一点都不会感到惊讶。虽然我对此没有正式的理论，但由于流行的加密和散列函数是开源的并且经过很好的研究，大多数都经受住了黑客的考验一段合理的时间。而且我认为 DRM 与密码和哈希属于同一类问题。

我的意思是，现在被低估的 MD5 于 1992 年首次发布，直到 2005 年才展示了第一次制造和实际的碰撞（根据维基百科）。Blowfish 于 1993 年出版，至今仍没有有效的密码分析。

所以，当然，为什么不呢。这里的问题是，开源社区本身并没有动力去构建这样的设备……

*编辑：*我的回答受到了一些可以说是当之无愧的批评，基本上是说，简而言之，DRM 是默默无闻的安全性，其中默默无闻是通过使其开源而消失的。而且，当然，如前所述，我不同意谁。但是，我仍然不会感到惊讶，虽然今天的 DRM 是通过隐藏东西来完成的，但总有一天，一些聪明的人出现了，并设计了一个真正有效的 DRM。

当然，随心所欲地解雇，这实际上更像是一种思想游戏，但我学会了永远不要说永远。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-18T15:26:37.557

取决于你的意思——你认为在你无法控制的客户端机器上运行的*闭源*DRM 是“可能的”吗？我所看到的一切都表明它不是：它们迟早都会坏掉。

如果您认为是，那么我认为开源 DRM 也是可能的。:-)

# c++ - C++/Eclipse 未定义参考问题

> ID：763573
> 
> 赞同：0
> 
> 时间：2009-04-18T15:03:27.097
> 
> 标签：c++, linker

我在 Eclipse / C++ 中显然是链接器错误（“未定义的引用”）时遇到了麻烦。下面显示的所有类都可以正常编译，除了一个 PlayGame.cpp，它给出了“未定义的引用”错误（如下所示）。

下面是相关的类和代码片段。

播放器工厂.h

播放器工厂.cpp

游戏.h

游戏.cpp

```
// constructor for game:

Game::Game (const PlayerFactory& factory)

{

       cout << " constructor" << endl;

} 
```

玩游戏.cpp

```
// start of code for game where error occurs

#include "Game.h"

#include "PlayerFactory.h"

int main() {
   try

   {

      PlayerFactory factory;

      Game game (factory);  <== undefined reference error
      ... 
```

上面的行给出了错误“对‘Game(PlayerFactory const&)’的未定义引用”

导致此错误的原因是什么，如何纠正？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T15:06:58.573

声明的默认可见`class`性是私有的。`Player`所以类和`PlayerFactory`类的所有成员函数`private`都不能被客户端访问。您需要将它们公开。

***播放器.h***

```
#ifndef PLAYER_H 
#define PLAYER_H
class Player  
{  
public:
   virtual ~Player() {  
       cout << "Player destructor called" << endl;  

   }  
   virtual void Player::PlayerMakeMove(){  
       cout << "make move" << endl;  
   }  

};  
#endif // PLAYER_H 
```

***播放器工厂.h***

```
#ifndef PLAYERFACTORY_H
#define PLAYERFACTORY_H
class PlayerFactory  
{  
public:
   virtual ~PlayerFactory() {  
       cout << "PlayerFactory destructor called" << endl;  
   }  

   virtual std::auto_ptr<Player> PlayerFactory::MakePlayerX() const{  

       return PlayerFactory::MakePlayer('x');  
   }  

   virtual std::auto_ptr<Player> PlayerFactory::MakePlayerO() const{  
       return PlayerFactory::MakePlayer('o');  

   }  

   std::auto_ptr<Player> PlayerFactory::MakePlayer (char letter) const{  
       auto_ptr<Player> pt( new Player() );  
       return pt;  
   }  
};
#endif // PLAYERFACTORY_H 
```

此外，`Game::Play()`缺乏`return`声明。

```
Outcome Game::Play() {  
  cout << " play" << endl;  
  return PlayerXWon;
} 
```

请根据需要添加所需的标题、前向声明和`using`语句（我在这里跳过它们）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T15:55:23.480

好吧，无论出于何种原因，链接器都找不到构造函数的实现，这强烈表明它没有被编译。

几个调试步骤：

*   尝试找到由 gcc 生成的 .obj 文件。看看你能不能在其中找到 Game.obj。

*   找到一种方法让 IDE 输出它为 gcc 生成的命令行

*   如果没有直接的方法，总有：

    *   制作一个脚本，用它替换 gcc，然后让脚本将命令行写入一个文件并检查它。

# actionscript-3 - Can I pass parameters from and external .swf using Actionscript 3.0?

> ID：763575
> 
> 赞同：0
> 
> 时间：2009-04-18T15:04:46.987
> 
> 标签：actionscript-3, flash, parameters, external

I have a main .fla file that I am using to load a sequence of three games. If the user wins a game, they go on to the next game. Is it in any way possible to pass to the main project whether the user has won the game? I have tried using loader.content, but that does not seem to be working. I am using Flash CS3\.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T17:05:12.610

You can pass data to and from loaded swfs no problem. What it sounds like you are trying to do is communicate from the loaded swf to the loading swf. The ideal way to do this is to dispatch an event on the loaded swf and listen for it in the loading swf. Roughly (not tested it because i'm in a rush) you need something like this. Load the swf. Have a load complete handler. Get the content of the loader and listen to a custom event. You can pass whatever you want on this custom event.

```
var myLoader:Loader = new Loader(); 
var url:URLRequest = new URLRequest("myExternalMovie.swf"); 
myLoader.load(url);
myLoader.contentLoaderInfo.addEventListener(Event.COMPLETE, function(event : Event)
{
    var contenet : MovieClip = event.target.content;
    content.addEventListener(yourGameEvent.GAME_COMPLETE, yourGameEventHandler);

} 
```

If you've never used custom events before check this link (or google for more)

[http://www.adobe.com/devnet/flash/articles/creating_events.html](http://www.adobe.com/devnet/flash/articles/creating_events.html)

As a disclaimer thats the quick way to get the data into you main class. Personally i'm not a massive fan of passing data in events. I'd rather fire a empty event and the get data from properties of the firing object)... but that's just a personal preference.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-03-26T00:09:14.617

你可以使用`LocalConnection`类。

# mysql - MySQL "good" way to insert a row if not found, or update it if it is found

> ID：763577
> 
> 赞同：17
> 
> 时间：2009-04-18T15:05:33.787
> 
> 标签：mysql, database-design, upsert

Very often, I want to run a query on one of my users where I want a row stored and associated with that user, in a 1-to-1 relationship. So let's say (this is just an arbitrary example), that I have a table that keeps track of a user's car, along with some info about the car. Each user can have either 0 or 1 cars. If the user has no car, there is no entry in the table for that user.

cars table (again, just an example): id, user_id, car_make, car_model

So, when I update this table, I always end up doing something like this (pseudo-code):

```
result = SELECT * FROM cars WHERE user_id=5
if (num_rows(result)>0){
    UPDATE cars SET car_make='toyota', car_model='prius' WHERE user_id=5
}else{
    INSERT INTO cars (user_id, car_make, car_model) VALUES (5, 'toyota', 'prius')
} 
```

How can I make this into one elegant statement that works "atomically"? What happens if, in another process, the row is REMOVED between the SELECT and UPDATE statements? My UPDATE statement will fail where the INSERT statement should have run. And I feel like I need to do two similar (but different) statements to accomplish the same thing! What I need is some statement that will assure me that the data I want exists in the table, especially when I only want 1 row that satisfies my requirement. For example, it might be something like (this is totally made-up of course):

```
MAKE SURE A ROW IN cars WHERE user_id=5 IS SET WITH car_make='toyota', car_model='prius' 
```

That way, if user_id of 5 exists already, it will be updated, otherwise, it will be inserted. Also, if I changed the requirements, for example to say that each user can have zero or one cars of a given car_make, then I could further specify that:

```
MAKE SURE A ROW IN cars WHERE user_id=5 AND car_make='toyota' IS SET WITH car_model='prius' 
```

I hope my question makes sense! How can I improve this basic insert-if-not-found or update-if-found operation that comes up so often? Thanks for any help!

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-18T15:12:53.177

您可以使用“ [REPLACE INTO](http://dev.mysql.com/doc/refman/5.0/en/replace.html) ”或“ [INSERT... ON DUPLICATE KEY UPDATE](http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html) ”。我相信第二个是你想要的，但有些情况下 REPLACE INTO 很方便。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-06-25T02:26:14.700

从[我的其他堆栈溢出答案](https://stackoverflow.com/questions/1041859/i-want-to-do-insert-without-record-in-db/1041895#1041895)：

如果您想在单个语句中执行此操作，我建议使用`INSERT ... ON DUPLICATE KEY UPDATE`语法，如下所示：

```
INSERT INTO table (id, someothervalue) VALUES (1, 'hi mom')
  ON DUPLICATE KEY UPDATE someothervalue = 'hi mom'; 
```

`INSERT`如果不存在具有指定键值（主键或唯一键）的现有记录，则将执行初始语句。如果记录已存在，则执行以下`UPDATE`语句 ( `someothervalue = 3`)。

所有版本的 MySQL 都支持这一点。有关详细信息，请参阅[MySQL 参考手册页面`INSERT ... ON DUPLICATE KEY UPDATE`](http://dev.mysql.com/doc/refman/4.1/en/insert-on-duplicate.html)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-18T15:12:15.017

这称为 UPSERT（*UP*日期或在*SERT*中）。您可以搜索许多关于它的 SO 问题。[见维基百科](http://en.wikipedia.org/wiki/Upsert)

**编辑：** MySQL 4.1+ 支持 INSATE （*INS* ert 或 upd *ATE*），只要你有一个主键，它应该能让你得到同样的东西。[MySQL 手册](http://dev.mysql.com/doc/refman/4.1/en/insert-on-duplicate.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T15:13:29.117

我认为它更容易切换它。尝试插入，然后更新。

MySQL 特别有一个子句'ON DUPLICATE KEY'

在重复键更新时插入汽车（字段）值（值）...

这当然需要您设置正确的唯一键。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T15:08:29.490

In Oracle you have [Merge](http://www.sc.ehu.es/siwebso/KZCC/Oracle_10g_Documentacion/server.101/b10759/statements_9016.htm).

No idea on MySql, but the term might give you something else to search.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-18T15:16:53.603

我如何使用 ON DUPLICATE KEY UPDATE 的示例： INSERT INTO registry (name, value) VALUES ('" . $key . "', '" . $val . "') ON DUPLICATE KEY UPDATE value= '" . $ val . "'"

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-12-03T13:32:22.363

将您的列属性设置为 UNIQUE，否则会重复输入。

# java - How many threads can a Java VM support?

> ID：763579
> 
> 赞同：242
> 
> 时间：2009-04-18T15:06:45.187
> 
> 标签：java, multithreading

How many threads can a Java VM support? Does this vary by vendor? by operating system? other factors?

* * *

## 回答 #1

> 赞同：193
> 
> 时间：2009-04-18T15:16:04.430

这取决于您使用的 CPU、操作系统、其他进程正在执行的操作、您使用的 Java 版本以及其他因素。在关闭机器之前，我已经看到 Windows 服务器有 > 6500 个线程。当然，大多数线程都没有做任何事情。一旦机器达到大约 6500 线程（Java 中），整台机器就开始出现问题并变得不稳定。

我的经验表明，Java（最新版本）可以愉快地使用计算机本身可以承载的尽可能多的线程，而不会出现问题。

当然，您必须有足够的 RAM，并且您必须以足够的内存启动 Java，以完成线程正在执行的所有操作，并为每个线程拥有一个堆栈。任何具有现代 CPU（最近几代 AMD 或 Intel）和 1 - 2 Gig 内存（取决于操作系统）的机器都可以轻松支持具有*数千个*线程的 JVM。

如果您需要比这更具体的答案，最好的办法是进行分析。

* * *

## 回答 #2

> 赞同：97
> 
> 时间：2009-04-18T15:09:07.427

Um, lots.

There are several parameters here. The specific VM, plus there are usually run-time parameters on the VM as well. That's somewhat driven by the operating system: what support does the underlying OS have for threads and what limitations does it put on them? If the VM actually uses OS-level threads at all, the good old red thread/green thread thing.

What "support" means is another question. If you write a Java program that is just something like

```
 class DieLikeADog {
         public static void main(String[] argv){
             for(;;){
                new Thread(new SomeRunaable).start();
             }
         }
    } 
```

(and don't complain about little syntax details, I'm on my first cup of coffee) then you should certainly expect to get hundreds or thousands of threads running. But *creating* a Thread is relatively expensive, and scheduler overhead can get intense; it's unclear that you could have those threads do anything useful.

### Update

Okay, couldn't resist. Here's my little test program, with a couple embellishments:

```
public class DieLikeADog {
    private static Object s = new Object();
    private static int count = 0;
    public static void main(String[] argv){
        for(;;){
            new Thread(new Runnable(){
                    public void run(){
                        synchronized(s){
                            count += 1;
                            System.err.println("New thread #"+count);
                        }
                        for(;;){
                            try {
                                Thread.sleep(1000);
                            } catch (Exception e){
                                System.err.println(e);
                            }
                        }
                    }
                }).start();
        }
    }
} 
```

On OS/X 10.5.6 on Intel, and Java ~~6~~ 5 (see comments), here's what I got

```
New thread #2547
New thread #2548
New thread #2549
Can't create thread: 5
New thread #2550
Exception in thread "main" java.lang.OutOfMemoryError: unable to create new native thread
        at java.lang.Thread.start0(Native Method)
        at java.lang.Thread.start(Thread.java:592)
        at DieLikeADog.main(DieLikeADog.java:6)

```

* * *

## 回答 #3

> 赞同：57
> 
> 时间：2009-04-18T16:18:21.740

After reading Charlie Martin's post, I was curious about whether the heap size makes any difference in the number of threads you can create, and I was totally dumbfounded by the result.

Using JDK 1.6.0_11 on Vista Home Premium SP1, I executed Charlie's test application with different heap sizes, between 2 MB and 1024 MB.

For example, to create a 2 MB heap, I'd invoke the JVM with the arguments -Xms2m -Xmx2m.

Here are my results:

```
2 mb --> 5744 threads
4 mb --> 5743 threads
8 mb --> 5735 threads
12 mb --> 5724 threads
16 mb --> 5712 threads
24 mb --> 5687 threads
32 mb --> 5662 threads
48 mb --> 5610 threads
64 mb --> 5561 threads
96 mb --> 5457 threads
128 mb --> 5357 threads
192 mb --> 5190 threads
256 mb --> 5014 threads
384 mb --> 4606 threads
512 mb --> 4202 threads
768 mb --> 3388 threads
1024 mb --> 2583 threads 
```

So, yeah, the heap size definitely matters. But the relationship between heap size and maximum thread count is INVERSELY proportional.

Which is weird.

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2013-04-21T08:13:30.773

我知道这个问题已经很老了，但只想分享我的发现。

我的笔记本电脑能够处理产生`25,000`线程的程序，并且所有这些线程以 2 秒的定期间隔在 MySql 数据库中写入一些数据。

我用这个程序运行了这个程序，`10,000 threads`然后`30 minutes continuously`我的系统也很稳定，我可以进行其他正常操作，比如浏览、打开、关闭其他程序等。

有`25,000 threads`系统`slows down`，但它仍然响应。

立即使用`50,000 threads`系统`stopped responding`，我不得不手动重新启动系统。

我的系统详细信息如下：

```
Processor : Intel core 2 duo 2.13 GHz
RAM : 4GB
OS : Windows 7 Home Premium
JDK Version : 1.6 
```

在运行之前，我设置了 jvm 参数`-Xmx2048m`。

希望能帮助到你。

* * *

## 回答 #5

> 赞同：33
> 
> 时间：2009-04-18T20:08:53.637

**绝对理论最大值**通常是进程的用户**地址空间除以线程堆栈大小**（尽管实际上，如果您的所有内存都保留给线程堆栈，那么您将没有工作程序......）。

因此，在 32 位 Windows 下，例如，每个进程都有 2GB 的用户地址空间，给每个线程一个 128K 的堆栈大小，你会期望绝对最大 16384 个线程 (=2*1024*1024 / 128)。在实践中，我发现我可以在 XP 下启动大约 13,000。

然后，我认为您基本上是在 (a)*您是否*可以管理在代码中处理那么多线程而不做明显愚蠢的事情（例如让它们都等待同一个对象然后调用 notifyAll()...）， (b) 操作系统是否可以。原则上，如果 (a) 的答案也是“是”，则 (b) 的答案是“是”。

顺便说一句，您可以**在 Thread 的构造函数中指定堆栈大小**；您不需要（并且可能不应该）为此弄乱VM参数。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-18T17:54:40.337

在玩过 Charlie 的 DieLikeACode 类之后，看起来 Java 线程堆栈大小是您可以创建多少线程的重要组成部分。

> -Xss 设置java线程栈大小

例如

> java -Xss100k DieLikeADog

但是，Java 有[Executor](http://java.sun.com/docs/books/tutorial/essential/concurrency/executors.html)接口。我会使用它，您将能够提交数千个 Runnable 任务，并让 Executor 使用固定数量的线程处理这些任务。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-18T15:32:18.340

我记得在一次具有数千个内核（9000 个？）的贸易展上听过 Clojure 演讲，他必须在某些专用机器上运行他的应用程序，然后将它们全部加载。不幸的是，我现在找不到链接（帮助？）。

基于此，我认为可以肯定地说硬件和您的代码是限制因素，而不是 JVM。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-04-03T16:07:58.843

当我在运行 Trisquel linux (Ubuntu 18.04) 的 2GB 三星 AMD 处理器笔记本电脑上研究这个主题时。它可以管理 9534 个线程，然后抛出特殊的异常

> ```
> at java.base/java.lang.Thread.start0(Native Method)
> at java.base/java.lang.Thread.start(Thread.java:803)
> at Main.main(Main.java:11) 
> ```

代码 ：

```
public class MultithreadingRunnable implements Runnable {
    public void run() {
        System.out.println("ThreadID " +  Thread.currentThread().getId());
    }
 }

public class Main {
    public static void main(String[] ars) {

        for(int i = 0;i<10000;i++){
            Thread mr = new Thread(new MultithreadingRunnable());
            mr.start();
        }
    }
 } 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-04-01T13:17:04.297

现代 (systemd) linux 系统的附加信息。

有很多关于这个值的资源可能需要调整（例如[How to increase maximum number of JVM threads (Linux 64bit)](https://stackoverflow.com/questions/34452302/how-to-increase-maximum-number-of-jvm-threads-linux-64bit)）；然而，通过 systemd "TasksMax" 限制施加了一个新限制，该限制在 cgroup 上设置 pids.max。

对于登录会话，[UserTasksMax](https://www.freedesktop.org/software/systemd/man/logind.conf.html#UserTasksMax=)默认值为内核限制 pids_max（通常为 12,288）的 33%，并且可以在 /etc/systemd/logind.conf 中覆盖。

对于服务，[DefaultTasksMax](https://www.freedesktop.org/software/systemd/man/systemd-system.conf.html#DefaultTasksMax=)默认值为内核限制 pids_max（通常为 4,915）的 15%。您可以通过在“systemctl edit”中设置 TasksMax 或在 /etc/systemd/system.conf 中更新 DefaultTasksMax 来覆盖服务

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-12-15T08:59:20.210

至少在 Mac OS X 10.6 32bit 上，操作系统有一个限制（2560）。检查这个[stackoverflow 线程](https://stackoverflow.com/questions/2860889/cant-get-past-2542-threads-in-java-on-4gb-imac-osx-10-6-3-snow-leopard-32bit)。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-05-29T04:05:53.097

最大线程数取决于以下几点：

*   硬件配置，如微处理器、RAM。*   操作系统，例如是 32 位还是 64 位*   run 方法中的代码。如果 run 方法中的代码很大，那么单线程对象将需要更多的内存

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-10-11T20:46:13.083

2017 年... DieLikeADog 课程。

新线程 #92459 线程“主”java.lang.OutOfMemoryError 中的异常：无法创建新的本机线程

i7-7700 16GB 内存

* * *

## 回答 #13

> 赞同：-5
> 
> 时间：2010-12-10T09:13:47.190

您可以处理任意数量的线程；没有限制。我在看电影和使用 NetBeans 时运行了以下代码，它工作正常/没有停止机器。我认为你可以保留比这个程序更多的线程。

```
class A extends Thread {
    public void run() {
        System.out.println("**************started***************");
        for(double i = 0.0; i < 500000000000000000.0; i++) {
            System.gc();
            System.out.println(Thread.currentThread().getName());
        }
        System.out.println("************************finished********************************");
    }
}

public class Manager {
    public static void main(String[] args) {
        for(double j = 0.0; j < 50000000000.0; j++) {
            A a = new A();
            a.start();
        }
    }
} 
```

# .net - = 和 := 有什么区别

> ID：763593
> 
> 赞同：6
> 
> 时间：2009-04-18T15:16:22.857
> 
> 标签：.net, vb.net

我确定这很简单，但我找不到正确的字符串来获得谷歌结果。在 VB.NET 中 =（等号）和 :=（冒号后跟等号）有什么区别？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-18T15:20:42.843

:= 运算符用于在 VB.Net 中按名称传递参数。例如采取以下代码

```
Sub Foo(p1 As integer, p2 As String)
  .. 
End Sub

Sub Test()
  Foo(p2:="foo",p1:=42)
End Sub 
```

如果您严格查看此处涉及的类型，我将值乱序传递。但是因为我使用 := 按名称绑定参数，所以编译器将正确传递值。

= 运算符取决于 VB.Net 中的上下文。它可以是赋值或比较运算符。例如

```
Dim x = 42 ' Assignment
if x = 36 Then 
 'Comparison above
End if 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T15:23:21.810

等号用于赋值，也是比较运算符。赋值的一个例子是

```
 a = 5 
```

比较的一个例子是

```
 if (a = 5) then
    ' do something here
  end if 
```

:= 专门用于通过名称将特定参数设置为值的调用函数。例如：

```
Sub studentInfo(ByVal name As String, _
       Optional ByVal age As Short = 0, _
       Optional ByVal birth As Date = #1/1/2000#)

  Debug.WriteLine("Name = " & name & _
                "; age = " & CStr(age) & _
                "; birth date = " & CStr(birth))
End Sub 
```

通常，您会像这样调用函数：

```
Call studentInfo("Mary", 19, #9/21/1981#) 
```

但是你也可以这样调用函数：

```
Call studentInfo("Mary", birth:=#9/21/1981#) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T15:19:35.670

`=`是一个比较 AND 一个集合运算符，但`:=`只是一个集合运算符。

比较：`If 7 = 7 Then`...

放：`Dim myInt As Integer = 7`

假设您有一个名为的自定义对象`SuperList`，其构造函数接受一个名为 的变量`initialCount`，那么您可以执行以下操作：

```
Dim myList As New SuperList(initialCount:=10) 
```

当您知道要设置的值时，有时阅读构造函数会更容易，尤其是如果您有像这样的构造函数`SomeConstructor(12, 432, True, False, 32)`

看到更有意义`SomeConstructor(monthsInYear:=12, daysInYear:=432, leapYears:True, leapDays:=False, daysInMonth:=32)`

可能还有更多，但这就是我想不到的。

# iis - IIS5 下的 ASP.NET 3.5 部署问题

> ID：763594
> 
> 赞同：1
> 
> 时间：2009-04-18T15:16:45.227
> 
> 标签：iis, deployment, asp.net-ajax, iis-6

经历了将 ASP.NET 网站项目转换为 Web 应用程序项目的痛苦之后，我现在无法将其部署到 IIS5 下的实时 Web 服务器。

在我的本地开发机器（运行 IIS7）下，部署工作正常。我将 Visual Studio 2008 中的 Web 应用程序项目发布到本地计算机上的文件夹中，然后在 IIS7 下创建一个新网站。

当我尝试在 IIS5 下的实时服务器上执行相同操作（使用相同的部署文件）时，我得到以下信息：

“你调用的对象是空的。

第 1 行：<%@ Language="C#" MasterPageFile="~/MyMaster.master" AutoEventWireup="true" Inherits="MyMaster.index" Codebehind="index.aspx.cs" %> "

任何人有任何想法？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T15:28:33.060

Windows 2000[不支持](http://download.microsoft.com/download/9/a/e/9ae0f6cc-7032-408e-9ca7-989f9e4af4ec/dotNetReadMe.htm).NET Framework 3.5 。

* * *

**更新**

如果您要将网站项目转换为 Web 应用程序项目，请确保检查[这些](http://webproject.scottgu.com/CSharp/migration2/migration2.aspx) [指针](http://weblogs.asp.net/meligy/archive/2008/08/03/converting-vs-2008-website-to-web-application.aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T15:24:11.387

1.  您是否也在服务器上安装了 .NET Framework 3.5？你有没有在IIS管理器的网站的ASP.NET设置中把Framework版本改成2.0？

2.  aspx 文件的第一行不应该像下面的代码片段吗？

    <%@ Page Language="C#" MasterPageFile="~/MyMaster.master" AutoEventWireup="true" Inherits="MyMaster.index" Codebehind="index.aspx.cs" %>
    （我接了你的行并添加了*“页”*关键字。）

3.  您是否将所有程序集从本地 bin 文件夹部署到服务器？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T16:08:22.807

为清楚起见，Darin 是正确的 .NET 3.5 在 Windows 2000 上不受支持。您使用 2000 的假设源自您引用 IIS5 的问题。但是在评论中您提到您的服务器是 2003。因此您实际上使用的是 IIS6。

假设您已经在服务器上实际安装了 .NET 3.5，您还需要在 IIS 管理器中打开应用程序属性对话框并访问 .NET 选项卡，选择适当的框架，在这种情况下为 3.5。

# wpf - 如何确定何时在 Silverlight 中添加了新的 UIElement

> ID：763605
> 
> 赞同：2
> 
> 时间：2009-04-18T15:24:44.987
> 
> 标签：wpf, vb.net, canvas, silverlight-2.0, uielement

我正在设计一个从画布继承的 sliverlight 用户控件。我有必要找出何时将新`UIElement`添加到 MyBase 的 Children 属性，但没有像“ItemAdded”这样的事件。由于我想为我的画布的孩子设置动画，我不能使用`LayoutUpdated`事件（它被击中了一百万次）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T15:49:30.403

添加/删除子项时`Canvas`，它将自动失效，从而发生测量/排列循环。因此，您无需显式跟踪添加/删除操作。

相反，您只需要覆盖 MeasureOverride 方法，然后在该方法中您可以查看 Children 集并注意发生了哪些变化。这是 Silverlight 比 WPF 更难使用的一个领域。您不能提供自己的集合来存储像 WPF 这样的子项，也不能在现有的 Children 集合上挂钩事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-11T13:17:19.027

请注意，我没有 Silverlight 经验，但在 WPF 中，您可以在控件上使用 Loaded 和 Initialized 事件。

[有关MSDN 的 Mike Hillberg 博客的](http://blogs.msdn.com/mikehillberg/archive/2006/09/19/LoadedVsInitialized.aspx)更多信息

**初始化事件**

> Initialized 事件通常在元素的属性全部设置后触发。具体来说，FrameworkElement/FrameworkContentElement 实现 ISupportInitialize，当调用该接口的 EndInit 方法时，IsInitialized 属性设置为 true，并触发 Initialized 事件。

**加载事件**

> 当一个元素不仅被初始化，而且即将被渲染时，Loaded 事件就会触发。Loaded 事件的动机是您希望在加载时在应用程序中进行一些初始化的典型场景。

# c++ - 如何使用 C/C++ 制作 .com 文件？

> ID：763608
> 
> 赞同：4
> 
> 时间：2009-04-18T15:27:21.860
> 
> 标签：c++, c, com

我们如何使用 C/C++ 制作 .com 文件？是否可以？

编辑：我能够使用 darin 的建议成功地制作一个 com 文件。但不知何故，以下程序的exe文件无法转换为com文件。我收到 exe2bin 的“文件无法转换”消息。我正在使用 Borland Turbo C++ 3.0。有什么建议么？

```
#include <dos.h>
void interrupt (*oldint65)( );
char st[80] = {"Hello World$"};
void interrupt newint65(void);
void main()
{
    oldint65 = getvect(0x65); 
    setvect(0x65, newint65);
    geninterrupt (0x65);
    geninterrupt (0x65);
    geninterrupt (0x65);
    setvect(0x65, oldint65);
}
void interrupt newint65( )
{
     _AH = 0x09;
     _DX=(unsigned int)st;
     geninterrupt (0x21);
} 
```

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-18T15:38:35.343

在 C 中，您必须使用[TINY 内存模型](http://www.digitalmars.com/ctg/ctgMemoryModel.html)编译程序。然后您可以使用[EXE2BIN](http://technet.microsoft.com/en-us/library/bb490635.aspx)或类似的程序将 EXE 文件转换为 COM 文件。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T15:35:42.667

那将取决于你的意思。你想把你的程序编译**成**一个`.com`文件吗？如果可能的话，这将取决于您的编译器。
如果你正在编写一个编译器（或类似的东西），并且想从你**自己的**`.com`程序中生成一个文件，你应该看看[Wikipedia 上的 COM 文章](http://en.wikipedia.org/wiki/COM_file)，或者使用[NASM](http://nasm.us)汇编器来汇编到一个文件：.**`.com``nasm -o hello.com hello.asm`**

 *** * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-20T22:21:03.013

此外，可能值得指出的是，您似乎在进行 TSR 编程，这不太可能在 Windows XP/Vista 等非 DOS（即现代）操作系统上完全甚至正常工作。

您可能需要考虑运行诸如 bochs 之类的 DOS 仿真器，这也使得运行诸如 TC++ 之类的遗留开发工具变得更加容易

# sql - 报告查询：加入多个事实表的最佳方式？

> ID：763621
> 
> 赞同：0
> 
> 时间：2009-04-18T15:35:22.310
> 
> 标签：sql, performance, olap, fact-table, dimensional-modeling

我正在开发一个报告系统，该系统允许用户任意查询一组事实表，并限制每个事实表的多个维度表。我编写了一个查询构建器类，它根据约束参数自动组装所有正确的连接和子查询，并且一切都按设计工作。

但是，我有一种感觉，我没有生成最有效的查询。在一组具有几百万条记录的表上，这些查询大约需要 10 秒才能运行，我希望将它们降低到不到一秒的范围内。我有一种感觉，如果我可以摆脱子查询，结果会更有效率。

我不会向您展示我的实际架构（这要复杂得多），而是向您展示一个类似的示例，该示例说明了这一点，而无需解释我的整个应用程序和数据模型。

想象一下，我有一个音乐会信息数据库，其中包含艺术家和场地。用户可以任意标记艺术家和场地。所以架构看起来像这样：

```
concert
  id
  artist_id
  venue_id
  date

artist
  id
  name

venue
  id
  name

tag
  id
  name

artist_tag
  artist_id
  tag_id

venue_tag
  venue_id
  tag_id 
```

很简单。

现在假设我想查询数据库中今天一个月内发生的所有音乐会，所有带有“techno”和“长号”标签的艺术家，在带有“cheap-beer”和“great-mosh-pits”标签的音乐会上表演.

我能想出的最佳查询如下所示：

```
SELECT
  concert.id AS concert_id,
  concert.date AS concert_date,
  artist.id AS artist_id,
  artist.name AS artist_name,
  venue.id AS venue_id,
  venue.name AS venue_name,
FROM
  concert
INNER JOIN (
  artist ON artist.id = concert.artist_id
) INNER JOIN (
  venue ON venue.id = concert.venue_id
)
WHERE (
  artist.id IN (
    SELECT artist_id
    FROM artist_tag
    INNER JOIN tag AS a on (
      a.id = artist_tag.tag_id
      AND
      a.name = 'techno'
    ) INNER JOIN tag AS b on (
      b.id = artist_tag.tag_id
      AND
      b.name = 'trombone'
    )
  )
  AND
  venue.id IN (
    SELECT venue_id
    FROM venue_tag
    INNER JOIN tag AS a on (
      a.id = venue_tag.tag_id
      AND
      a.name = 'cheap-beer'
    ) INNER JOIN tag AS b on (
      b.id = venue_tag.tag_id
      AND
      b.name = 'great-mosh-pits'
    )
  )
  AND
  concert.date BETWEEN NOW() AND (NOW() + INTERVAL 1 MONTH)
) 
```

该查询有效，但我**真的**不喜欢拥有这些多个子查询。如果我可以完全使用 JOIN 逻辑来完成相同的逻辑，我感觉性能会大大提高。

在一个完美的世界里，我会使用一个真正的 OLAP 服务器。但是我的客户将部署到 MySQL 或 MSSQL 或 Postgres，我不能保证兼容的 OLAP 引擎将可用。所以我坚持使用带有星型模式的普通 RDBMS。

不要太在意这个例子的细节（我的真实应用程序与音乐无关，但它有多个事实表，与我在这里展示的那些有类似的关系）。在这个模型中，'artist_tag' 和 'venue_tag' 表用作事实表，而其他一切都是维度。

重要的是要注意，在这个例子中，如果我只允许用户限制单个艺术家标签或场地标签值，那么查询编写起来要简单得多。只有当我允许查询包含 AND 逻辑时，它才会变得非常棘手，需要多个不同的标签。

所以，我的问题是：您所知道的针对多个事实表编写有效查询的最佳技术是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T16:25:49.380

My approach is a bit more generic, putting the filter parameters in tables and then using GROUP BY, HAVING and COUNT to filter the results. I've used this basic approach several times for some very sophisticated 'searching' and it works very well (for me *grin*).

I also don't join on the Artist and Venue dimension tables initially. I'd get the results as id's (just needing artist_tag and venue_tag) then join the results on the artist and venue tables to get those dimension values. (Basically, search for the entity id's in a sub query, then in an outer query get the dimension values you need. Keeping them separate should improve things...)

```
DECLARE @artist_filter TABLE (
  tag_id INT
)

DECLARE @venue_filter TABLE (
  tag_id INT
)

INSERT INTO @artist_filter
SELECT id FROM tag
WHERE name IN ('techno','trombone')

INSERT INTO @venue_filter
SELECT id FROM tag
WHERE name IN ('cheap-beer','great-most-pits')

SELECT
  concert.id AS concert_id,
  concert.date AS concert_date,
  artist.id AS artist_id,
  venue.id AS venue_id
FROM
  concert
INNER JOIN
  artist_tag
    ON artist_tag.artist_id = concert.artist_id
INNER JOIN
  @artist_filter AS [artist_filter]
    ON [artist_filter].tag_id = artist_tag.id
INNER JOIN
  venue_tag
    ON venue_tag.venue_id = concert.venue_id
INNER JOIN
  @venue_filter AS [venue_filter]
    ON [venue_filter].tag_id = venue_tag.id
WHERE
  concert.date BETWEEN NOW() AND (NOW() + INTERVAL 1 MONTH)
GROUP BY
  concert.id,
  concert.date,
  artist_tag.artist_id,
  venue_tag.id
HAVING
  COUNT(DISTINCT [artist_filter].id) = (SELECT COUNT(*) FROM @artist_filter)
  AND
  COUNT(DISTINCT [venue_filter].id)  = (SELECT COUNT(*) FROM @venue_filter) 
```

(I'm on a netbook and suffering for it, so I'll leave out the outer query getting the artist and venue names from the artist and venue tables *grin*)

**EDIT**
Note:

Another option would be to filter the artist_tag and venue_tag tables in sub-queries/derived-tables. Whether this is worth it depends on how influential the join on the Concert table is. My assumption here is that there are MANY artist and venues, but once filtered on the concert table (itself filtered by the dates) the number of artists/venues decreases dramatically.

Also, there is often a need/desire to deal with the case where NO artist_tags and/or venue_tags are specified. From experience it is better to deal with this programatically. That is, use IF statements and queries specially suited to those cases. A single SQL query CAN be written to handle it, but is much slower than the programatic alternative. Equally, writing similar queries several times may look messy and degrade maintainability, but the increase in complexity need to get this to be a single query is often harder to maintain.

**EDIT**

Another similar layout could be...
- Filter concert by artist as sub_query/derived_table
- Filter results by venue as sub_query/derived_table
- Join results on dimension tables to get names, etc

(Cascaded filtering)

```
SELECT
   <blah>
FROM
  (
    SELECT
      <blah>
    FROM
      (
        SELECT
          <blah>
        FROM
          concert
        INNER JOIN
          artist_tag
        INNER JOIN
          artist_filter
        WHERE
        GROUP BY
        HAVING
      )
    INNER JOIN
      venue_tag
    INNER JOIN
      venue_filter
    GROUP BY
    HAVING
  )
INNER JOIN
  artist
INNER JOIN
  venue 
```

By cascading the filtering, each subsequent filtering has a reduce set it has to work on. This MAY reduce the work done by the GROUP BY - HAVING section of the query. For two levels of filtering I would guess this to be unlikely to be dramatic.

The original may still be more performant as it benefits additional filtering in a different manner. In your example:
- There may be many artist in your date range, but few which meet at least one criteria
- There may be many venues in your date range, but few which meet at least one criteria
- Before the GROUP BY, however, all concerts are eliminated where...
---> the artist(s) meets NONE of the criteria
---> AND/OR the venue meets NONE of the criteria

Where you are searching by many criteria this filtering degrades. Also where venues and/or artists share a lot of tags, the filtering also degrades.

So when would I use the original, or when would I use the Cascaded version?
- Original : Few search criteria and venues/artists are dis-similar from each other
- Cascaded : Lots of search criteria or venues/artists tend to be similar

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T15:52:10.740

对模型进行非规范化。在场地和艺术家表中包含标签名称。这样，您可以避免多对多关系，并且您拥有一个简单的星型模式。

通过应用这种非规范化，where 子句只能检查两个表（艺术家和场所）中的这个额外的 tag_name 字段。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-03-09T00:44:43.180

这种情况在技术上不是多个事实表。您在场所和标签以及艺术家和标签之间有多对多的关系。

我认为 MatBailie 在上面提供了一些有趣的示例，但我觉得如果您以一种有用的方式处理应用程序中的参数，这会简单得多。

除了用户在事实表上生成的查询之外，您首先需要两个静态查询来为用户提供参数选项。其中一个是适合场地的标签列表，另一个是适合艺术家的标签。

场地适当的标签：

```
SELECT DISTINCT tag_id, tag.name as VenueTagName
FROM venue_tag 
INNER JOIN tag 
ON venue_tag.tag_id = tag.id 
```

艺术家适当的标签：

```
SELECT DISTINCT tag_id, tag.name as ArtistTagName
FROM artist_tag 
INNER JOIN tag 
ON artist_tag.tag_id = tag.id 
```

这两个查询驱动一些下拉或其他参数选择控件。在报告系统中，您应该尽量避免传递字符串变量。在您的应用程序中，您将变量的字符串名称提供给用户，但将整数 ID 传递回数据库。

例如，当用户选择标签时，您获取 tag.id 值并将它们提供给您的查询（我有下面的`(1,2)`和`(100,200)`位）：

```
 SELECT
  concert.id AS concert_id,
  concert.date AS concert_date,
  artist.id AS artist_id,
  artist.name AS artist_name,
  venue.id AS venue_id,
  venue.name AS venue_name,
FROM 
concert
INNER JOIN artist 
    ON artist.id = concert.artist_id
INNER JOIN artist_tag
    ON artist.id = artist_tag.artist_id
INNER JOIN venue 
    ON venue.id = concert.venue_id
INNER JOIN venue_tag
    ON venue.id = venue_tag.venue_id
WHERE venue_tag.tag_id in ( 1,2 ) -- Assumes that the IDs 1 and 2 map to "cheap-beer" and "great-mosh-pits)
AND   artist_tag.tag_id in (100,200) -- Assumes that the IDs 100 and 200 map to "techno" and "trombone") Sounds like a wild night of drunken moshing to brass band techno!
AND concert.date BETWEEN NOW() AND (NOW() + INTERVAL 1 MONTH) 
```

# jquery - jQuery DIV 高度问题

> ID：763624
> 
> 赞同：0
> 
> 时间：2009-04-18T15:36:47.300
> 
> 标签：jquery, internet-explorer, height, jquery-animate

再会 ：）

我在固定大小的 div 上同时使用 jQuery 的 animate() 不透明度和高度。
在 Firefox 中一切正常，但在 IE8 中（有和没有兼容模式，所以我假设它在 IE6 和 IE7 中会有相同的行为），动画确实显示，但是当 div 高度达到 0%， div 的高度调整为该 div 内文本的高度。
我立即做的第一件事是将溢出设置为隐藏，但它仍然给出相同的行为。

我正在使用以下功能来缓慢切换高度/不透明度：

```
function OpacityFadeToggle(e_trigger, e_element, speed)
{
    $(e_trigger).toggle(
        function() {
            $(e_element).animate({ 
                opacity:    0.0,
                height:     "0px"
            }, speed);
        },
        function() {
            $(e_element).animate({
                opacity:    1.0,
                height:     "500px"
            }, speed);
        }
    );
}

$(function() {
    OpacityFadeToggle("a#a2", "div#b1", 1000);
}); 
```

我的“b1” div 的样式如下：

```
div#b1 {
    color:      #ffffff;
    background-color:   #000000;
    overflow:       hidden;
    width:      600px;
    height:     500px;
    padding:        0px;
    margin:     0px;
    display:        block;
} 
```

如果你想看一个活生生的例子，我在这里临时设置了一个页面：[点击我！](http://93.125.207.114/jquery_tests)

非常感谢您对此事的任何帮助。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T15:43:45.440

将其设置为 1px，然后在动画完成后隐藏 div 怎么样？此外，请确保在从 1px 动画到 500px 之前再次显示 div。

```
function OpacityFadeToggle(e_trigger, e_element, speed)
{
    $(e_trigger).toggle(
        function() {
                $(e_element).animate({ 
                        opacity:        0.0,
                        height:         "1px"
                }, speed).hide();
        },
        function() {
                $(e_element).show().animate({
                        opacity:        1.0,
                        height:         "500px"
                }, speed);
        }
    );
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T15:43:07.503

您可以尝试向 jQuery 的 animate 调用添加回调，并在回调中通过更改其 display 属性来隐藏 div。

# c# - 在 C# 中，是否有任何我不应该使用的内置异常？

> ID：763627
> 
> 赞同：11
> 
> 时间：2009-04-18T15:37:38.840
> 
> 标签：c#, .net, exception

.NET Framework 中是否定义了任何我不应该在自己的代码中抛出的异常，或者这是不好的做法？我应该自己写吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-18T15:40:42.000

您不应抛出任何由于用户错误而由 CLR 自动抛出的异常。例如

*   堆栈溢出异常
*   空引用异常
*   AccessViolationException
*   ETC ...

这样做的原因是让调用您的 API 的人感到困惑。用户应该能够区分 API 主动抛出的异常和非主动抛出的异常（由 CLR 抛出）。

原因是主动抛出的异常通常表示 API 中的已知状态。如果我调用一个 API 并且它抛出一个 ArgumentException，我有一个合理的期望，即给定对象处于良好状态。它认识到一个潜在的糟糕情况并积极考虑它。另一方面，如果它抛出 NullRefrenceException，则表明 API 遇到未知错误并且现在处于不可靠状态。

另一个较小的原因是，这些异常在由用户代码与 CLR 引发时表现不同。例如，如果用户代码抛出了 StackOverflowException，则可以捕获，但如果 CLR 抛出，则不能捕获。

*   [http://blogs.msdn.com/jaredpar/archive/2008/10/22/when-can-you-catch-a-stackoverflowexception.aspx](http://blogs.msdn.com/jaredpar/archive/2008/10/22/when-can-you-catch-a-stackoverflowexception.aspx)

**编辑**回应迈克尔的评论

您也不应该直接抛出 Exception、ApplicationException 或 SystemException。这些异常类型过于笼统，无法为调用 API 的代码提供有意义的信息。确实，您可以将非常描述性的消息放入消息参数中。但是根据消息捕获异常并不是直接的或可维护的。最好根据类型来捕捉它。

FxCop 关于这个主题的规则：http: [//msdn.microsoft.com/en-us/library/ms182338 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms182338(VS.80).aspx)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-18T16:14:46.303

框架中的大多数异常类都不是为了重用，因为它们通常被设计为发出某些特定于框架的错误的信号。就像[@JaredPar 提到的](https://stackoverflow.com/questions/763627/in-c-are-there-any-built-in-exceptions-i-shouldnt-use/763634#763634)那些，框架使用它们来指示框架中的某些状态。

*框架中确实有数十个甚至数百个例外，因此 IMO 列出我们应该*使用的那些更有用。在我的脑海中，这些是我积极使用的：

*   [ArgumentException](http://msdn.microsoft.com/en-us/library/system.argumentexception.aspx)、[ArgumentNullException](http://msdn.microsoft.com/en-us/library/system.argumentnullexception.aspx)和[ArgumentOutOfRangeException](http://msdn.microsoft.com/en-us/library/system.argumentoutofrangeexception.aspx)
*   [无效操作异常](http://msdn.microsoft.com/en-us/library/system.invalidoperationexception.aspx)
*   [不支持异常](http://msdn.microsoft.com/en-us/library/system.notsupportedexception.aspx)
*   [未实现异常](http://msdn.microsoft.com/en-us/library/system.notsupportedexception.aspx)

对于用户代码中的其他错误情况，最佳实践是创建自己的异常类。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-02-10T11:25:23.293

@Michael实际上有一种情况建议抛出NullReferenceException：如果扩展方法的第一个参数（“this”参数）为null。您需要这样做才能使空变量按预期运行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-18T17:03:09.307

微软曾一度告诉程序员不要直接从 Exception 继承，而是使用 ApplicationException 作为他们的基类。不知道这种观点是否仍然成立，虽然......

如果已经存在涵盖您的确切错误条件的预定义异常（例如“NullReferenceException”或“InvalidArgumentException”等） - 无论如何，请抛出这些异常，而不是在您自己的代码中重新发明它们。

马克

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-18T15:43:35.863

已经为您定义了几个例外。在推出自己的异常之前，请始终尝试使用这些[异常](http://msdn.microsoft.com/en-us/library/system.exception.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-19T10:00:14.683

例外情况的在线[设计指南](http://msdn.microsoft.com/en-us/library/ms229014.aspx "MSDN")包含原则建议（具体参见[本页](http://msdn.microsoft.com/en-us/library/ms229007.aspx "捕获和抛出标准异常类型")）。

《[Framework Design Guidelines: Conventions, Idioms, and Patterns for Reusable .NET Libraries, 2nd Edition》](http://www.informit.com/store/product.aspx?isbn=0321545613)一书对这个主题有更多的细节和更多的讨论。

# php - Zend 框架：如何取消设置 Zend_Db_Table_Rowset 对象中的数据行

> ID：763630
> 
> 赞同：4
> 
> 时间：2009-04-18T15:39:27.747
> 
> 标签：php, arrays, zend-framework, zend-db-table

我想迭代存储在 Zend_Db_Table_Rowset 对象中的数据行，然后删除/取消设置某些行，如果它们不满足某些条件。

我可以使用 toArray() 仅从对象中获取数据行，然后很容易取消设置我不需要的行。但由于我想保留我的对象以供进一步使用，我不想这样做。

当然，一种解决方案是调整我的查询以便只检索我需要的内容，但在这种情况下这是不可能的。至少我不知道怎么做。

我尝试了以下不起作用：

```
foreach ($rowset as $key => $row)
{
    if (!$condition == satisfied)
    {
        unset($rowset[$key]);
    }
} 
```

当然它不起作用，因为没有 $rowset[$key]... 数据存储在子数组 [_data:protected] 但未设置 $rowset[_data:protected][$key] 没有工作。

也许我对行集对象（或一般对象的表示）的概念还不够成熟，无法理解我在做什么。欢迎任何澄清和提示！

[编辑] $row->delete 不是一个选项，我不想从数据库中删除该行！我不想先创建一个数组，如果我想我会做 $rowset->toArray() [/EDIT]

**解决方案**：我最终做了我认为我做不到的事情，这意味着我将所有内容都集成到了初始查询中。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2011-06-13T21:30:14.183

[自定义行集类](http://framework.zend.com/manual/en/zend.db.table.html#zend.db.table.extending.row-rowset)的示例方法：

```
public function removeFromRowset($id) {
    foreach ($this->_rows as $i => $v) {
        if ($v->id == $id) { // found Row we want to remove
            unset($this->_rows[$i]); // delete both rowset
            unset($this->_data[$i]); // and original data
            break; // not necessary to iterate any more
        }
    }
    $this->_data = array_values($this->_data); // reindex both arrays (otherwise it breaks foreach etc.)
    $this->_rows = array_values($this->_rows);
    $this->_count = count($this->_data); // don't forget to update items count!
} 
```

它遍历您的 Rowset，根据其 id 找到 Row（假设“id”是唯一标识符），然后将其从 Rowset 中删除。

**请注意，这不会从数据库中删除行，它只是将其从行集中删除！**

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-18T21:38:36.913

您可以使用[自定义 Rowset 类](http://framework.zend.com/manual/en/zend.db.table.html#zend.db.table.extending.row-rowset)

然后，此类将有权访问内部存储的受保护 $_rows，并且您可以添加一个公共方法来应用您的过滤

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T17:41:04.613

我不知道有没有办法做到这一点。您可以先创建一个数组，然后修改该数组。

```
$rows = array();
foreach($rowset as $row)
{
     $rows[$row->id] = $row;
}

foreach ($rows as $key => $row)
{
     if(!$condition == satisfied)
     {
         unset($rows[$key]);
     }
} 
```

不是最有效的事情，但它确实有效。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-04-18T17:48:14.720

您还可以对单个行对象使用 delete() 方法。

```
foreach ($rowset as $row)
{
    if (!$condition == satisfied)
    {
       $row->delete();
    }
} 
```

# vim - 在 gvim 中，是否可以有多行文件选项卡？

> ID：763631
> 
> 赞同：5
> 
> 时间：2009-04-18T15:39:53.733
> 
> 标签：vim

在 gvim 中，是否可以有多行文件选项卡？

也就是说，它应该“开始”新的一行标签，而不是显示左/右箭头来导航标签行（对于不适合标签行的标签）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-18T17:23:37.057

AFAIK，不，除非您打算更改 vim 的源代码。

但是，如果你需要那么多标签，现在不要误会我的意思，但是如果你需要那么多标签，那你就做错了。“Vim 的方式”是有效的缓冲区和窗口控制。有许多不错的缓冲区管理器，可以在编辑许多缓冲区（文件）时提供帮助。尝试利用其中的一些。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-19T23:44:07.917

`:he setting-tabline`将为您提供可用的选项。可能不是您想要的，但有一些功能可以帮助您。

我个人使用制表符，但通过设置摆脱制表符

```
showtabline=0 
```

因为我认为这只是一种分心。您可以使用地图来`:tabs`获取选项卡上的内容，并且大多数缓冲区管理器插件对于严肃的编辑更有效。（我应该对此进行限定，我使用命令行 Vim 编辑器，并尽可能喜欢“禅”式环境或整洁，它可能不适合您的需要。）

这样我就有了 3 个带有拆分窗口排列的不同选项卡，用于不同的编辑任务，我可以使用`gt`和循环浏览这些任务`gT`。

编辑：

现在有一个插件可能值得一看来解决这个问题。

[https://github.com/gcmt/taboo.vim](https://github.com/gcmt/taboo.vim)

# c# - 是否可以更改 Windows 服务中的值 - 在 ini 文件或 xml 中？

> ID：763644
> 
> 赞同：1
> 
> 时间：2009-04-18T15:47:30.237
> 
> 标签：c#

我有 Windows 服务，有 Timer。

我想要更改计时器速度值的选项。

我该怎么做？与ini文件？还是xml文件？

可能吗 ？如果是，我可以获得示例代码吗？

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T16:08:56.957

大概你的意思是你想改变你的定时器的周期，即它多久到期一次。

我建议将计时器周期保留在配置文件中。使用 FileSystemWatcher 来跟踪这个文件——它会在文件更改时触发一个事件。当观察者检测到文件已更改并且您的代码确定时间段不同时，请更新计时器的到期时间段。根据您是否将计时器设置为自动重置或“手动”在到期时重置计时器，您可能需要以不同的方式处理它。如果它自动重置，那么您需要在值更改时停止并重新启动它。如果它是“手动”重置的，则可以将其设置为仅在计时器到期时获取新值。

可以在 MSDN 上找到如何使用[FileSystemWatcher](http://msdn.microsoft.com/en-us/library/system.io.filesystemwatcher.aspx)和与[ConfigurationManager类交互（以读取配置）的示例。](http://msdn.microsoft.com/en-us/library/system.configuration.configurationmanager.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T15:51:20.947

例如，您可以让 Windows 服务每 10 分钟检查一次对配置文件（txt 或 xml）所做的更改（使用计时器或踏板）。如果检测到更改，请让您的 Windows 服务使用新的配置值自行重新加载。

我曾经在 C# 中创建了一个服务，每 10 分钟记录一次配置文件的最后写入时间：

```
File.GetLastWriteTime(pathToYourConfigFile); 
```

如果新的写入时间小于记录的时间，配置文件将被重新加载。我使用了一个小的 XML 文件进行配置。您可以在磁盘上或使用 HTTP ( [http://somedomain.com/config.xml](http://somedomain.com/config.xml) ) 访问此文件。就我而言，我使用了 HTTP，因为配置文件与服务不在同一台服务器上。

# python - 如何存储带有`"`的字符串？

> ID：763654
> 
> 赞同：1
> 
> 时间：2009-04-18T15:57:00.900
> 
> 标签：python, json

我想要一个带有属性值的 JSON 对象作为带有字符的字符串`"`。例如：

```
{
"Dimensions" : " 12.0" x 9.6" "
} 
```

显然这是不可能的。我该怎么做呢？使用 Python。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-18T16:12:10.130

艾萨克是正确的。

至于如何在 python 中做到这一点，您需要提供更详细的说明来说明您是如何构建`JSON`对象的。例如，假设您没有使用外部库并且手动执行（荒谬，我知道），您会这样做：

```
>>> string = "{ \"Dimensions\" : \" 12.0\\\" x 9.6\\\" \" }"
>>> print string
{ "Dimensions" : " 12.0\" x 9.6\" " } 
```

显然，这有点愚蠢。如果您使用的是标准 python json 模块，请尝试以下操作：

```
from json import JSONEncoder
encoder = JSONEncoder()
string = encoder.encode({ "Dimensions":" 12.0\" x 9.6\" " })

>>> print string
{"Dimensions": " 12.0\" x 9.6\" "} 
```

这是期望的结果。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-19T11:29:19.257

Python 有两个符号可用于指定字符串文字，即单引号和双引号。

例如：my_string = "我到家了！"

或者，与您更相关，

```
>>> string = '{ "Dimensions" : " 12.0\\\" x 9.6\\\" " }'
>>> print string
{ "Dimensions" : " 12.0\" x 9.6\" " } 
```

您还可以在字符串前面加上 'r' 以指定它是原始字符串，因此不处理反斜杠转义序列，使其更清晰。

```
>>> string = r'{ "Dimensions" : " 12.0\" x 9.6\" " }'
>>> print string
{ "Dimensions" : " 12.0\" x 9.6\" " } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T15:59:25.513

JSON.stringify，如果使用 Javascript，将为您转义它。
如果没有，您可以像 \" 一样转义它们（在前面放一个 \）
编辑：在 Python 中，尝试[re.escape()](http://ayaz.wordpress.com/2007/04/22/reescape-pythons-equivalent-of-phps-addslashes/)或将所有 " 替换为 \"：

```
"json string".replace("\"","\\\""); 
```

# php - 如何在网页中构建上传功能

> ID：763655
> 
> 赞同：1
> 
> 时间：2009-04-18T15:57:14.193
> 
> 标签：php, upload, ftp

我已经看到了许多不同的解决方案，但我想知道是否有人可以建议哪个是让用户将自己的文件上传到自己**共享**主机上的文件夹的最优雅和最安全的版本？（`php.ini`等超出范围）。

文件的大小最大为 100mb，所以基于 FTP 的解决方案可能是最好的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T20:08:26.383

[SWF Upload](http://swfupload.org/)是一个很好的解决方案，它提供了一个进度条。您只需要在 php.ini 文件中允许最大文件大小为 100 mb 并调整它们的示例以满足您的需要。用户应该安装 Flash Player，因为单独的 php 无法获取上传状态。除此之外，对服务器/客户端没有限制。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T15:59:08.820

对于很大的文件，HTTP 上传速度很*慢*，可能被您的主机阻止，可能对您的浏览器来说太大等等。它们通常是有问题的。你可以使用 FTP，或者像[Github](http://github.com)在他们的仓库“下载”页面上做的那样，并使用 Flash/Flex。这允许更好的进度报告和更简洁的界面。这是一篇关于如何做类似事情的文章[http://www.flash-db.com/Tutorials/upload/](http://www.flash-db.com/Tutorials/upload/)。
我意识到这不是 PHP，但您*可以*在 PHP 中执行的唯一文件上传是 HTTP 文件。（AFAIK）

# c++ - 我们还应该“从小”优化吗？

> ID：763656
> 
> 赞同：16
> 
> 时间：2009-04-18T15:58:16.607
> 
> 标签：c++, c, optimization

我正在将我的 for 循环更改为增量 using`++i`而不是`i++`并开始思考，这真的有必要吗？当然，今天的编译器自己进行这种优化。

在这篇文章[http://leto.net/docs/C-optimization.php](http://leto.net/docs/C-optimization.php)中，Michael Lee 从 1997 年开始讨论其他优化，例如内联、循环展开、循环干扰、循环反转、强度降低等。这些还有意义吗？

**我们应该做哪些低级代码优化，我们可以安全地忽略哪些优化？**

编辑：这与过早优化无关。**优化的决定已经做出。**现在的问题是什么是最有效的方法。

轶事：我曾经查看过一个需求规范，其中指出：“程序员应该左移一位而不是乘以 2”。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-18T16:46:26.383

这是一个老生常谈的主题，SO 包含大量好的和坏的建议。

让我告诉你我从许多性能调优的经验中发现了什么。

性能与内存和清晰度等其他因素之间存在权衡曲线，对吗？你会期望获得更好的性能，你必须放弃一些东西，对吧？

只有当程序*处于权衡曲线上时，*这才是正确的。大多数软件，正如最初编写的那样，*距离权衡曲线*很远。大多数时候，谈论放弃一件事以获得另一件事是无关紧要和无知的。

我使用的方法不是测量，而是[诊断](https://stackoverflow.com/questions/375913/what-can-i-use-to-profile-c-code-in-linux/378024#378024)。我不在乎各种例程的速度或调用频率。我想确切地知道哪些指令导致缓慢，以及*为什么*。

在大型软件工作（而不是小型单人项目）中表现不佳的主要原因和主要原因是***泛滥***。使用了太多的抽象层，每个抽象层都会带来性能损失。这通常不是问题 - 直到它成为问题 - 然后它是一个杀手。

所以我所做的就是一次解决一个问题。我称这些为“蛞蝓”，是“慢虫”的缩写。我移除的每个 slug 都会产生 1.1 倍到 10 倍的加速，具体取决于它有多糟糕。每一个被移除的蛞蝓都会使剩余的蛞蝓占据剩余时间的大部分，因此它们变得更容易找到。这样一来，所有“唾手可得的果实”都可以快速处置掉。

那时，我知道是什么在浪费时间，但修复可能会更加困难，例如软件的部分重新设计，可能是通过删除无关的数据结构或使用代码生成。如果有可能做到这一点，那将掀起新一轮的排毒浪潮，直到程序不仅比开始时快很多倍，而且更小、更清晰。

我建议您自己获得这样的经验，因为当您设计软件时，您将知道*不*该做什么，并且您将从一开始就做出更好（和更简单）的设计。同时，您会发现自己与经验不足的同事不和，他们无法在不编出十几个课程的情况下开始思考设计。

补充：现在，为了回答你的问题，当诊断表明你有一个热点时应该进行低级优化（即调用堆栈底部的一些代码出现在足够的调用堆栈样本上（10% 或更多）要知道要花费大量时间）。如果热点在代码中，您可以编辑。如果您在“new”、“delete”或字符串比较中有一个热点，请在堆栈的更高位置查找要删除的内容。

希望有帮助。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-18T17:51:32.357

如果优化没有成本，那就去做吧。写代码的时候，`++i`跟写一样容易`i++`，所以更喜欢前者。它没有任何成本。

另一方面，返回并在*之后*进行此更改需要时间，而且很可能不会产生明显的差异，因此您可能不应该为此烦恼。

但是，是的，它可以有所作为。在内置类型上，可能不是，但对于复杂的类，编译器不太可能将其优化掉。原因是自增操作不再是编译器内置的内在操作，而是类中定义的函数。编译器可能能够像任何其他函数一样对其进行优化，但一般来说，它不能假设可以使用前增量而不是后增量。这两个函数可能做完全不同的事情。

因此，在确定编译器可以进行哪些优化时，请考虑它是否有足够的信息来执行它。在这种情况下，编译器不知道后增量和前增量对对象执行相同的修改，因此它不能假设一个可以替换为另一个。但是你有这方面的知识，所以你可以安全地执行优化。

您提到的许多其他内容通常可以由编译器非常有效地完成：内联可以由编译器完成，而且它通常比您做得更好。它只需要知道有多大比例的函数是由函数调用构成的，以及它被调用的频率是多少？一个经常被调用的大函数可能不应该被内联，因为你最终会复制大量代码，导致更大的可执行文件和更多的指令缓存未命中。内联始终是一种权衡，而且通常编译器比您更擅长权衡所有因素。

循环展开是一种纯粹的机械操作，编译器可以很容易地做到这一点。强度降低也是如此。交换内循环和外循环比较棘手，因为编译器必须证明更改的遍历顺序不会影响结果，这很难自动完成。所以这是一个你应该自己做的优化。

但即使是编译器能够做的简单的事情，你有时也会得到编译器没有的信息。如果你知道一个函数会被非常频繁地调用，即使它只是从一个地方调用，也可能值得检查编译器是否自动内联它，如果没有，则手动执行。

有时您可能比编译器更了解循环（例如，迭代次数始终是 4 的倍数，因此您可以安全地展开 4 次）。编译器可能没有此信息，因此如果要内联循环，则必须插入一个 Epilog 以确保正确执行最后几次迭代。

因此，如果 1）您确实需要性能，并且 2）您有编译器不需要的信息，那么这种“小规模”优化仍然是必要的。

在纯粹的机械优化上，您无法超越编译器。但是您可能能够做出编译器无法做到的假设，*那*就是您能够比编译器进行更好的优化。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-18T16:05:37.370

这些优化仍然是相关的。关于您的示例，在内置算术类型上使用 ++i 或 i++ 无效。

对于用户定义的递增/递减运算符，++i 更可取，因为它并不意味着复制递增的对象。

所以一个好的编码风格是在 for 循环中使用前缀递增/递减。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-18T16:06:22.453

一般来说，没有。编译器更擅长在整个代码库中进行像这样的小型、直接的微优化。通过使用正确的优化标志编译发布版本，确保您在此处启用编译器。如果您使用 Visual Studio，您可能希望尝试优先考虑大小而不是速度（在很多情况下小代码更快）、链接时代码生成（LTCG，它使编译器能够进行交叉编译优化），甚至可能是配置文件引导的优化。

您还需要记住，从性能的角度来看，您的大部分代码都无关紧要 - 优化此代码不会产生用户可见的效果。

您需要尽早定义您的绩效目标并经常测量以确保您达到了这些目标。如果超出您的目标，请使用分析器等工具来确定代码中的热点位置并对其进行优化。

[正如这里](https://stackoverflow.com/questions/312003/what-is-the-most-ridiculous-pessimization-youve-seen/312064#312064)的另一张海报所提到的，“没有测量和理解的优化根本不是优化——它只是随机变化。”

如果您已测量并确定特定函数或循环是热点，则有两种方法可以对其进行优化：

*   首先，通过减少昂贵代码的调用，在更高级别上对其进行优化。这通常会带来最大的好处。算法级别的改进属于这个级别 - 算法将更好的 big-O 应该导致运行热点代码更少。
*   如果不能减少调用，那么您应该考虑微优化。查看编译器发出的实际机器代码，并确定它在做什么是最昂贵的——如果结果是复制临时对象，那么考虑前缀 ++ 而不是后缀。如果它在循环开始时进行了不必要的比较，则将循环翻转为 do/while，依此类推。如果不理解*为什么*代码很慢，任何全面的微优化几乎都是无用的。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-04-18T16:51:51.457

是的，这些事情仍然是相关的。我做了一些这样的优化，但公平地说，我主要编写的代码必须在 ARM9 上大约 10 毫秒内完成相对复杂的事情。如果您正在编写在更现代的 CPU 上运行的代码，那么好处不会那么大。

如果您不关心可移植性，并且您正在做一些数学运算，那么您还可以考虑使用目标平台上可用的任何向量操作 - x86 上的 SSE，PPC 上的 Altivec。没有大量帮助，编译器无法轻松使用这些指令，而且这些内部函数现在非常容易使用。您链接到的文档中未提及的另一件事是指针别名。如果您的编译器支持某种“限制”关键字，您有时可以获得很好的速度改进。另外，当然，考虑缓存的使用也很重要。与优化奇数副本或展开循环相比，以充分利用缓存的方式重新组织代码和数据可以显着提高速度。

不过，与以往一样，最重要的是要进行剖析。仅优化实际上很慢的代码，确保您的优化实际上使其更快，并查看反汇编以查看编译器已经为您进行了哪些优化，然后再尝试改进它。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2009-04-18T17:03:41.833

不好的例子——决定是否使用`++i`或`i++`不涉及任何形式的权衡！**有（可能有）没有任何缺点**`++i`的净收益。有许多类似的场景，在这些领域进行任何讨论都是浪费时间。

 **也就是说，我认为了解*目标编译器能够优化小代码片段的****程度****非常重要***。事实是：现代编译器（有时令人惊讶！）擅长它。Jason 有一个关于优化（非尾递归）阶乘函数的[令人难以置信的故事。](https://stackoverflow.com/questions/405770/why-are-compilers-so-stupid/414774#414774)**

 **另一方面，编译器也可能非常愚蠢。关键是许多优化需要一个控制流分析，它变成了 NP 完备的。因此，优化成为编译时间和实用性之间的权衡。通常，优化的局部性起着至关重要的作用，因为当编译器认为的代码大小仅增加几条语句时，执行优化所需的计算时间就会增加太多。

正如其他人所说，这些微小的细节仍然是相关的，并且永远都是（在可预见的未来）。尽管编译器越来越聪明，机器越来越快，但我们的数据量也在增长——事实上，我们正在输掉这场特殊的战斗；在许多领域，数据量的增长速度远远超过计算机变得更好的速度。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2009-04-18T16:36:59.027

如今，您列出的所有优化对于 C 程序员来说实际上都无关紧要——编译器在执行内联、循环展开、循环干扰、循环反转和强度降低等事情上要好得多*。*

关于`++i`vs `i++`：对于整数，它们会生成相同的机器代码，因此您使用哪一个取决于样式/偏好。在 C++ 中，对象可以重载那些前置和后置运算符，在这种情况下，通常最好使用前置增量，因为后置增量需要额外的对象副本。

至于使用移位而不是乘以 2 的幂，编译器已经为你做了。根据架构的不同，它可以做更聪明的事情，例如在 x86 上将乘以 5 变成一条`lea`指令。但是，对于除以 2 的幂的除法和模数，您可能需要多加注意才能获得最佳代码。假设你写：

```
x = y / 2; 
```

如果`x`和`y`是有符号整数，则编译器无法将其转换为右移，因为它将产生负数的错误结果。因此，它发出右移和一些位旋转指令，以确保结果对于正数和负数都是正确的。如果您知道`x`并且`y`总是积极的，那么您应该帮助编译器并将它们改为无符号整数。然后，编译器可以将其优化为单个右移指令。

模数运算符的`%`工作方式类似——如果你用 2 的幂进行修改，对于有符号整数，编译器必须发出一条`and`指令，再加上一点点旋转，以使结果对正数和负数都正确，但它可以发出`and`如果处理无符号数，则为单条指令。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-20T11:07:22.827

当然是的，因为编译器需要更多的资源来优化未优化的代码，而不是优化已经优化的代码。特别是它会导致计算机消耗更多的能量，尽管它很小，但仍然会对已经受到伤害的自然造成不良影响。这对于开源代码尤其重要，因为它的编译频率高于封闭源代码。

走向绿色，拯救地球，优化自己

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-18T16:03:40.307

编译器可以更好地判断和做出此类决定。您所做的微优化可能会发挥作用，最终会错过重点。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-18T16:09:37.360

把它做好，然后让它变得更快——基于对性能的测量。

选择好算法并以最易读的方式实现它们。仅在必须时才权衡可读性以换取性能 - 即当您的用户说性能在口头或他们的行动中是不可接受的时。

正如 Donald Knuth/Tony Hoare 所说的“过早的优化是万恶之源”——30 年后的今天仍然如此……

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-04-18T16:10:26.733

上次我在用于 STL 迭代器的 Microsoft C++ 编译器上测试 ++it 和 it++ 时，++it 发出的代码更少，因此如果您处于大规模循环中，使用 ++it 可能会获得少量性能提升。

对于整数等，编译器将发出相同的代码。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-04-18T19:39:49.523

多年来我得到的一个有趣的观察是，上一代的*优化*代码似乎实际上在下一代中被*反优化*。即，这是由于处理器实现发生了变化，因此 if/else 成为现代 CPU 中的瓶颈，其中流水线很深。我想说干净、简短、简洁的代码通常是最好的最终结果。优化真正重要的地方在于数据结构，以使它们正确且苗条。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-04-18T20:08:26.350

我相信每个开发人员都应该知道关于优化的三句话——我首先在 Josh Bloch 的“Effective Java”一书中读到它们：

> 以效率的名义（不一定实现）比任何其他单一原因（包括盲目愚蠢）犯下的计算罪更多。

（[威廉·A·沃尔夫](http://en.wikipedia.org/wiki/William_Wulf)）

> 我们应该忘记小的效率，比如大约 97% 的时间：过早优化是万恶之源。

（[唐纳德·E·克努特](http://en.wikipedia.org/wiki/Donald_Knuth)）

> 我们在优化问题上遵循两条规则：
> 
> 规则1：不要这样做。
> 
> 规则 2：（仅适用于专家）。暂时不要这样做——也就是说，在你有一个完全清晰且未优化的解决方案之前不要这样做。

（[马杰克逊](http://en.wikipedia.org/wiki/Michael_A._Jackson)）

所有这些引用 (AFAIK) 至少有 20 到 30 年的历史，那时 CPU 和内存的意义远比今天重要。我认为开发软件的正确方法是首先有一个可行的解决方案，然后使用分析器来测试性能瓶颈在哪里。一位朋友曾经告诉我，一个用 C++ 和 Delphi 编写的应用程序存在性能问题。使用分析器，他们发现应用程序花费了大量时间将字符串从 Delphi 的结构转换为 C++ 结构，反之亦然 - 没有微优化可以检测到...

总而言之，不要以为你知道性能问题会出现在哪里。为此使用分析器。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-04-20T20:26:05.293

不要试图猜测你的编译器在做什么。如果您已经确定需要在此级别优化某些内容，请隔离该位并查看生成的程序集。如果您可以看到生成的代码正在执行一些可以改进的缓慢操作，请务必在代码级别对其进行修改，看看会发生什么。如果您确实需要控制，请在汇编中重写该位并将其链接。

这是一个痛苦的屁股，但真正看到正在发生的事情的唯一方法。请注意，一旦您更改任何内容（不同的 CPU、不同的编译器、甚至不同的缓存等），所有这些严格的优化都可能变得毫无用处，这是一种沉没成本。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-04-20T22:57:32.247

还需要注意，从前/后递增/递减运算符进行更改不会引入不良副作用。例如，如果您在循环上迭代 5 次只是为了多次运行一组代码而对循环索引值没有任何兴趣，那么您可能没问题 (YMMV)。另一方面，如果您确实访问了循环索引值，则结果可能不是您所期望的：

```
#include <iostream>

int main()
{
  for (unsigned int i = 5; i != 0; i--)
    std::cout << i << std::endl;

  for (unsigned int i = 5; i != 0; --i)
    std::cout << "\t" << i << std::endl;

  for (unsigned int i = 5; i-- != 0; )
    std::cout << i << std::endl;

  for (unsigned int i = 5; --i != 0; )
    std::cout << "\t" << i << std::endl;
} 
```

结果如下：

```
5
4
3
2
1
        5
        4
        3
        2
        1
4
3
2
1
0
        4
        3
        2
        1 
```

前两种情况没有区别，但请注意，尝试通过切换到预减运算符来“优化”第四种情况将导致迭代完全丢失。诚然，这是一个人为的情况，但是当我以相反的顺序（即从头到尾）遍历数组时，我已经看到了这种循环迭代（第三种情况）。

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-04-18T16:01:58.173

仅当您确定它们是相关的时。这意味着您之前已经在特定编译器上研究过此问题，或者您已经完成了以下操作：

1.  生成的功能代码
2.  分析了该代码
3.  确定的瓶颈
4.  简化设计以消除瓶颈
5.  选择的算法可以最大限度地减少对瓶颈的调用

如果您已经完成了所有这些事情，那么最好的办法通常是让您的编译器发出一些较低级别的内容，您可以检查自己（如汇编）并据此做出具体判断。根据我的经验，每个编译器都有点不同。有时对一个优化会导致另一个产生更大的效率较低的代码。

如果您还没有做过这些事情，那么我将其称为过早优化，我建议您不要这样做。在做这些事情之前进行优化所带来的回报与所涉及的成本相比是不成比例的。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-18T16:04:52.053

我想补充一点。这种“过早的优化是不好的”是一种垃圾。当你选择一个算法时你会怎么做？您可能会选择时间复杂度最高的那个 - OMG 过早优化。然而，每个人似乎都对此感到满意。所以看起来真正的态度是“过早的优化是不好的——除非你按照我的方式去做”在一天结束时，做任何你需要做的事情来制作你需要制作的应用程序。

“程序员应左移一位而不是乘以 2”。希望你不想乘以浮点数或负数；）

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-04-18T16:44:40.723

正如其他人所说，如果 i 是某个对象的实例，++i 可能比 i++ 更有效。这种差异对您来说可能很重要，也可能不重要。

但是，在您关于编译器是否可以为您进行这些优化的问题的上下文中，在您选择的示例中它不能。原因是 ++i 和 i++ 具有不同的含义——这就是为什么它们被实现为不同的函数。i++ 必须做额外的工作（在递增之前复制当前状态，执行递增，然后返回该状态）。如果您不需要额外的工作，那么为什么要选择其他更直接的形式呢？答案可能是可读性——但在这种情况下，编写 ++i 已经成为 C++ 中的惯用语，所以我不相信可读性会涉及到它。

因此，如果要在编写代码做不必要的额外工作（可能很重要，也可能不重要）之间做出选择，而这本身并没有好处，我总是会选择更直接的形式。这不是过早的优化。另一方面，它通常不够重要，不足以引起宗教信仰。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-04-18T17:23:12.537

当然，**当且仅当**它导致该特定程序的实际改进足以值得编码时间，任何可读性降低等时。我认为您不能在所有程序中为此制定规则，或者真的适合任何优化。这完全取决于在特定情况下真正重要的是什么。

使用 ++i 之类的东西，时间和可读性的权衡是如此之小，如果它确实会带来改进，那么它可能值得养成一个习惯。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-04-18T19:28:06.947

*   除非我在嵌入式设备上编写，否则我通常不会优化低于 O(f(n)) 复杂度。

*   对于典型的 g++/Visual Studio 工作，我认为基本的优化将会可靠地进行（至少在请求优化时）。对于不太成熟的编译器，这种假设可能是无效的。

*   如果我对数据流进行繁重的数学运算，我会检查编译器发出 SIMD 指令的能力。

*   我宁愿围绕不同的算法调整我的代码，而不是特定编译器的特定版本。算法将经受住多个处理器/编译器的考验，而如果您针对 2008 Visual C++（第一版）版本进行调整，那么您的优化甚至可能在明年都不起作用。

*   在旧计算机中非常合理的某些优化技巧今天被证明存在问题。例如，++/++ 运算符是围绕具有非常快的增量指令的旧架构设计的。今天，如果你做类似的事情

    `for(int i = 0; i < top; i+=1)`

    我假设编译器会优化`i+=1`成一条`inc`指令（如果 CPU 有的话）。

*   经典的建议是自上而下优化。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-04-18T20:20:56.710

首先 - 总是运行分析来检查。

首先，如果您优化代码的正确部分。如果代码运行总时间的 1% - 算了。即使您将其加速了 50%，您也可以获得 0.5% 的总加速。除非您正在做一些奇怪的事情，否则加速会慢得多（尤其是如果您确实使用了良好的优化编译器）。其次，如果您正确优化它。哪个代码在 x86 上运行得更快？

```
inc eax 
```

或者

```
add eax, 1 
```

好。据我所知，在早期的处理器中是第一个，但在 P4 上是第二个（如果这些特定指令运行得更快或更慢，这里无关紧要，关键是它一直在变化）。编译器可能是最新的此类更改 - 您不会。

在我看来，主要目标是编译器无法执行的优化 - 如前所述，数据大小（您可能认为现在 2 GiB 计算机不需要它 - 但如果您的数据比处理器缓存大 - 它会运行慢得多）。

一般来说——只有当你必须和/或你知道你在做什么时才这样做。这将需要大量关于问题中未提及的代码、编译器和低级计算机体系结构的知识（老实说，我没有提出）。它很可能一无所获。如果您想优化 - 在更高级别上进行。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-05-24T15:11:01.357

我仍然做 ra<<=1; 之类的事情 而不是 ra*=2; 并将继续。但是编译器（和它们一样糟糕），更重要的是计算机的速度是如此之快，以至于这些优化经常被淹没在噪音中。作为一个普遍的问题，不，这不值得，如果你专门在一个资源有限的平台（比如一个微控制器）上，每一个额外的时钟都非常重要，那么你可能已经这样做了，并且可能进行了大量的汇编程序调整。作为一种习惯，我尽量不给编译器太多额外的工作，但为了代码的可读性和可靠性，我不会特意去做。

The bottom line for performance though has never changed. Find some way to time your code, measure to find the low hanging fruit and fix it. Mike D. hit the nail on the head in his response. I have too many times seen people worry about specific lines of code not realizing that they are either using a poor compiler or by changing one compiler option they could see several times increase in execution performance.

# c# - 嵌套类有什么原因

> ID：763661
> 
> 赞同：1
> 
> 时间：2009-04-18T15:59:38.493
> 
> 标签：c#, oop

我一直在寻找可以在嵌套类中获得的优势。有很多关于如何做到这一点的例子，但我找不到关于在另一个类中声明一个类的原因。我什至查阅了我新到的“代码完成”，但那里也没有提及。我可以看到它更难阅读的缺点。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-18T16:04:54.453

通常，嵌套类只是为了支持其容器类的功能，本身没有生存能力。例如，它可能用于收集大量参数进行初始化，以保持主类的构造函数易于管理；或者它可以继承定义一个支持主类的专用集合。

从语义上讲，单独的类没有区别，但是嵌套发出了一个明确的信息，即该类不能单独使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T16:15:47.550

有几个设计决策以创建嵌套类而告终：

*   您想更明确地说明两个类之间的关系；一种 。name 比同一个命名空间中的两个类更明确
*   上下文相关类作为由上下文服务类包围的顶级嵌套类使这种依赖关系更加清晰**“这些事情在一起”**
*   避免命名空间污染
*   减少源文件的数量

所以嵌套类背后有两个原则：**依赖**和**更好的组织**

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T16:05:03.613

如果父类需要一些模型来工作，但不是所有其他类，请使用它们。所以一些数据的内部表示/帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T16:10:26.877

我通常将它们声明为私有，因此它们可以用于仅在外部类内部需要的某些功能，从而保持命名空间中不需要的辅助类。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T16:12:00.273

从我的角度来看，嵌套类不是强制性的。我通常只嵌套一个类，它只是一个小对象，只与一个特定的类有关。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-18T17:35:01.947

您可能会使用嵌套类来对涉及外部类实现的概念进行建模，但它与外部类的联系如此紧密，以至于嵌套类在任何其他上下文中使用都是没有意义的。嵌套类具有可见性并且可能显式依赖于不属于其公共 API 的外部类的详细信息。

一个常见的模式是嵌套类实现公共接口，外部类通过返回类型为公共接口的方法公开嵌套类的实例。迭代器模式就是一个例子。

# c# - 如何使用 JQuery 指示用户等到数据库更新

> ID：763662
> 
> 赞同：0
> 
> 时间：2009-04-18T16:00:37.693
> 
> 标签：c#, asp.net, jquery, sql, linq

我是 JQuery 的新手，但是作为我之前关于数据库重复条目的问题的后续，在论坛类型的应用程序中，问题是：JQuery 是向用户显示、事务进度、提交状态的好解决方案吗等什么是最好的解决方案，如果使用 JQuery Else 其他解决方案是正确的。

为了学习 JQuery，并集成到我的应用程序中，以替换 asp.net ajax 扩展程序和部分页面回发，任何人都可以为我指明有用资源的方向。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T16:17:57.433

jQuery sounds to me as the perfect tool for that, you could use these effects:

[http://docs.jquery.com/Effects](http://docs.jquery.com/Effects)

combined with an ajax call

[http://docs.jquery.com/Ajax](http://docs.jquery.com/Ajax)

used as asyncronous = false, so you revert the effect to the original state, once the ajax call has finished.

Of course then, there are plugins, but with these you can make your own behaviour easily.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T16:16:00.293

您可以使用[jQuery.ajax](http://docs.jquery.com/Ajax/jQuery.ajax#options)将请求发送回服务器进行处理。设置 beforeSend 并完成回调以显示/隐藏“正在进行中”的图像，例如动画 GIF 微调器。您还可以使用错误回调在请求失败时显示错误消息或[对话框。](http://docs.jquery.com/UI/API/1.7/Dialog)

```
 $.ajax({
   type: "POST",
   url: "forum-update.aspx",
   data: $('form').serialize(),
   beforeSend: function() { $('#spinner').show() },
   complete: function() { $('#spinner').hide() },
   error: function(request,status,error) {
       alert(error); // or maybe status?
   },
   success: function(msg){
     alert( "Data Saved: " + msg );
   }
 }); 
```

# asp.net - 网格视图中的错误

> ID：763665
> 
> 赞同：0
> 
> 时间：2009-04-18T16:03:28.187
> 
> 标签：asp.net

这是什么错误？“在执行当前 Web 请求期间发生了未处理的异常。请查看堆栈跟踪以获取有关该错误及其源自代码的位置的更多信息。”

源错误：在执行当前 Web 请求期间生成了未处理的异常。可以使用下面的异常堆栈跟踪来识别有关异常起源和位置的信息。

我在我的网站中使用了这个代码，我不使用 from datasource 。“如果 (!IsPostBack) { InstalledFontCollection Fonts = new InstalledFontCollection(); GridView1.DataSource = Fonts.Families; GridView1.DataBind(); } “谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T16:22:57.047

What type of data source did you use? If the GridView doesn't have a DataSourceControl to use for these actions then you have to create your own for paging and sorting.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T16:42:50.447

Since you are binding by code, the event associated with changing a page isn't supported by default.

To support it you must code by yourself the `PageIndexChanging` event. Look that you have a parameter `GridViewPageEventArgs` that allows you to know which page was selected.

More information [here](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.pageindexchanged.aspx), and a very deep article [here](http://dotnetslackers.com/articles/gridview/Custom-GridView-with-Paging-and-Filtering.aspx).

# sql - MYSQL优化&问题

> ID：763667
> 
> 赞同：1
> 
> 时间：2009-04-18T16:03:54.957
> 
> 标签：sql, mysql, optimization, subquery

我正在尝试优化我的 MySQL 查询，我需要一些帮助。这是我当前的查询：

```
SELECT *,
       (SELECT name FROM stores WHERE id = products.store_id) AS store_name,
       (SELECT username FROM stores WHERE id = products.store_id) AS store_username,
       (SELECT region_id FROM stores WHERE id = products.store_id) AS region_id,
       (SELECT city_id FROM stores WHERE id = products.store_id) AS city_id,
       (SELECT name FROM categories_sub WHERE id = products.subcategory_id) AS subcategory_name,
       (SELECT name FROM categories WHERE id = category_id) AS category_name
FROM products
WHERE date_start <= DATE(NOW()) AND date_end >= DATE(NOW()) 
```

我很确定它可以更快。

我也有一个问题，当我尝试按 region_id 选择所有产品时（通过添加类似“AND region_id = MYID”的内容）它不起作用，我想知道是否有可能让它工作，以及如何工作？

感谢您的时间！

**解决方案**

这是我的最终查询，如果它可以帮助任何人：

```
SELECT p.*,
       s.name AS store_name,
       cs.name AS subcategory_name,
       cat.id AS category_id, cat.name AS category_name,
       c.id AS city_id, c.name AS city_name,
       r.id AS region_id, r.name AS region_name
  FROM products p
       JOIN stores s ON (s.id = p.store_id)
       JOIN categories_sub cs ON (cs.id = p.subcategory_id)
       JOIN categories cat ON (cat.id = cs.category_id)
       JOIN cities c ON (c.id = s.city_id)
       JOIN regions r ON (r.id = c.region_id)
  WHERE DATE(NOW()) BETWEEN p.date_start AND p.date_end 
```

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T17:17:03.190

你真的需要学会使用`JOIN`. 它是关系查询的基本操作，就像`while()`循环是大多数应用程序语言中的基本控制结构一样。

任何有关 SQL 的书籍或教程都应涵盖`JOIN`.

```
SELECT p.*, 
 s.name AS store_name, s.username AS store_username, 
 s.region_id, s.city_id,
 cs.name AS subcategory_name,
 c.name AS category_name
FROM products p
 JOIN stores s ON (s.id = p.store_id)
 JOIN categories c ON (c.id = p.category_id)
 JOIN categories_sub cs ON (cs.id = p.subcategory_id)
WHERE DATE(NOW()) BETWEEN p.date_start AND p.date_end 
```

现在您可以在`WHERE`子句中添加更多条件：

```
 AND s.region_id = ?; 
```

* * *

还有一条评论...我试图通过使用`BETWEEN`谓词来变得聪明，但这可能会使 MySQL 相对简单的优化器感到困惑。MySQL 可能更容易优化您的原始语法：

```
WHERE p.date_start <= DATE(NOW()) AND p.date_end >= DATE(NOW()) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T16:10:30.277

```
SELECT A.*, B.name AS store_name, B.username as store_username, B.region_id as region_id, B.city_id AS city_id, C.name AS subcategory_name, D.name AS category_name FROM products A, stores B, categories_sub C, categories D
WHERE B.id = A.store_id AND B.id = A.subcategory_id and C.id = A.category_id AND 
A.date_start <= DATE(NOW()) AND A.date_end >= DATE(NOW()) 
```

# sql - T-SQL 将字符串拆分为多对一关系？

> ID：763669
> 
> 赞同：2
> 
> 时间：2009-04-18T16:04:48.933
> 
> 标签：sql, sql-server, string, csv, string-split

我有以下 SQL 脚本：

```
DECLARE @temp table (
    ID int IDENTITY(1, 1),
    data nvarchar(100)
)

INSERT INTO @temp (data) VALUES ('a,b,c')
INSERT INTO @temp (data) VALUES ('d,e,f')

SELECT *
FROM @temp AS T
    INNER JOIN
        (SELECT *
        FROM dbo.__StringSplit(T.data, ',', T.ID)) AS S
    ON T.ID = S.RefID 
```

在点击！执行后，我得到了这些：

```
Line 17 The multi-part identifier "T.data" could not be bound. 
```

我也尝试了非加入版本并得到了同样的错误：

```
SELECT T.ID, S.Item AS dataItem
FROM @temp AS T, dbo.__StringSplit(T.data, ',', T.ID) AS S
WHERE T.ID = S.RefID 
```

...

**我所期望的是，我应该得到一个带有来自 @test.ID 的 ID 的表，并且 @test.data 中的每个逗号分隔值都被拆分为自己的记录，并将其值放入 dataItem 字段中。**

我怎样才能做到这一点？
我需要使用游标吗？

我已将 dbo.__StringSplit 表值函数实现粘贴在[http://pastebin.com/f7dd6350f](http://pastebin.com/f7dd6350f)

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T16:26:32.437

In SQL2000 you need cursors. In SQL2005/2008, you can use CROSS APPLY satement; probably like next (can't test just now):

```
SELECT T.ID, S.Item AS dataItem
FROM @temp AS T CROSS APPLY dbo.__StringSplit(T.data, ',', T.ID) AS S 
```

* * *

**EDIT** - I found [this page on CROSS APPLY](http://www.sqlteam.com/article/using-cross-apply-in-sql-server-2005) and then came up with:

```
SELECT T.ID, S.Item AS dataItem
FROM @temp AS T
    CROSS APPLY
    dbo.__StringSplit(T.data, ',', T.ID) AS S
WHERE T.ID = S.RefID 
```

Which solved my problem :-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T21:55:56.420

你的分割字符串函数真的很慢，这里有一个链接可以更快：

[http://www.sommarskog.se/arrays-in-sql.html](http://www.sommarskog.se/arrays-in-sql.html)

# design-patterns - 在应用模式方面，您给予开发人员多少自主权？

> ID：763675
> 
> 赞同：2
> 
> 时间：2009-04-18T16:06:32.610
> 
> 标签：design-patterns, architecture

我与许多公司合作，主要是与架构师/首席开发人员合作，有时直接与开发人员合作。经常出现的一件事是，当架构师规定应用程序模式时，他们希望每次都能始终如一地遵循它，几乎没有变化的余地。

**演示模型/MV-VM**

演示模型 (MV-VM) 模式就是一个很好的例子。当我想到这种模式时，我认为它是“我们有一个对象模型来表示当前场景的状态和行为，以及一个将其呈现给 UI 的视图对象”。在我看来，代表状态的事物（模型/视图模型）比规定性指南更具概念性。一个视图可能使用许多对象来表示这种状态，或者它可能使用一个，或者它可能非常简单以至于它不需要，或者它可能共享一个。该模式的精神是我们将状态管理与可视化代码分开。

然而，我经常遇到的是模式被更多地解释为字面意思。一个典型的项目可能如下所示：

*   意见
    *   富
        *   FooView.xaml
        *   FooView.xaml.cs
        *   FooViewModel.cs
        *   FooModel.cs
    *   酒吧
        *   条形视图.xaml
        *   BarView.xaml.cs
        *   BarViewModel.cs
        *   条形模型.cs

有时，模型对象是空的，或者 ViewModel 只是将属性 getter/setter 转发给模型对象。有时视图是如此简单，以至于额外的对象只会使它变得比它需要的更复杂。

作为架构师/团队负责人，您是否希望开发人员每次都像清单一样遵循相同的流程？还是您更愿意将细节留给开发人员？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T16:27:28.613

Leave the details up to the developers, every time. Some solutions may get wild & hairy, but trying to control the details is a losing game for all. Developers have brains: tell them what you want them to achieve before telling them exactly how. When defining a reference architecture to be followed, focus on

*   Providing basic **principles** to follow: what's to be done, why, and the most important consequences.
*   Ensuring there are **standards** to be followed for e.g. coding and component usage
*   Providing **patterns** that support the principles. You're using Presentation Model for a reason, in order to achieve a specific set of nonfunctional requirements and business objectives. Tell them those reasons, and tell them in what ways you are going to get there.
*   Ensuring there are well-defined **practices** for things like version control and testing

Your job as architect is to ensure that the major nonfunctional requirements are identified, prioritized and achieved. Most of the time, at least in those company cultures I've worked with, acting as a guide and teacher is far more productive than trying to do all the thinking for others.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-20T12:15:48.577

虽然本都提出了很好的观点；问题是 Presentation 实际上是应用程序的结构。因此，如果您想添加新功能，实际上没有选择。

我自己的 CAD/CAM 应用程序在这方面非常严格。通过创建操纵模型的新命令对象来添加功能。您需要使用使用备忘录模式开发的对象来保存初始状态，然后保存更改的状态，以便正确实现撤消/重做。

然后，您必须将 Command 对象放在使用 Passive View 开发的 View 中的事件处理结构之一中。当然，我们的开发人员在命令对象内选择算法、支持对象和函数有相当大的自由裁量权。

如果您谈论的是一家公司制作的新应用程序，那么在选择各种模式时通常有充分的理由。在我们公司，我们必须在几十年内维持我们的应用程序，因此设计适应性非常重要。我们不能在开发中使用当月的味道，因为它会在 5、10、15 年后再次出现并困扰我们。我们的许多应用程序都是使用被动视图和通过定义明确的接口连接的多层设计的。当 MS 决定取消 VB6 以支持 VB.NET 时，这也起到了作用

然后有时只是经理跟随本月的味道。在这种情况下，您需要尝试让经理了解为什么您提出的方法从长远来看对公司更有效。否则，您需要了解公司为什么选择它所做的标准。

# class-design - 具有 N 层架构的类设计

> ID：763676
> 
> 赞同：0
> 
> 时间：2009-04-18T16:06:50.143
> 
> 标签：class-design

这个问题与我之前提出的问题非常接近，但我认为它们不是同一件事，所以认为将它们分开是明智的（当你听到这个问题时，这有点讽刺）。

[上一个问题](https://stackoverflow.com/questions/763421/n-tier-architecture-design-seperation-of-concerns)

我有一个分为两个项目的 Web 应用程序：

1) ASP.NET 站点 2) 包含业务对象、逻辑层方法和 DAL 方法的 DLL。它们分为不同的名称空间，但都在同一个 DLL 中。

我越看它并扩展开发，我就越意识到我走错了路。我想将它们拆分为单独的 DLL，以便我可以明确划分职责。

一旦我在不同的 DLL 中有代码，我意识到很多类相互调用。例如，当在 DAL 中创建客户对象列表时，它还会调用 companyDAL.cs 并获取客户所属的公司列表。所以我现在有两个直接相互引用的类。这似乎是一件相当糟糕的事情！它闻起来很糟糕，但我继续前进，并试图在我能做到的地方把事情分开。

为此，我将所有对象取出到接口，并将对它们的所有引用更改为接口。

我希望使用某种 DI（目前只是了解这一点），因此对于每个对象，我创建了一个构造函数，该构造函数为该 DLL 接收一个工厂，（该工厂将为该类可能的每个对象创建一个新实例要求）。我还放置了一个默认构造函数，它将使用默认工厂调用 DI 构造函数，以确保始终使用一个工厂。

一切都编译好了，所以我试了一下，得到了一个stackoverflow！这是我完全意识到，如果我有两个相互需要的类，那么没有另一个就无法实例化。

```
Factory
{
   IClient CreateNewIClient()
   {
         return new Client();
   }

   ICompany CreateNeIwCompany()
   {
          return new Company();
   }
}

Client
{
    private ICompany _company;

    public Client() : this (new Factory()) {}

    public Client(Factory factory)
    {
        _company = factory.CreateNewICompany();
    }

    public Client GetClientbyID(int id)
    {
       .... do stuff to get client from db
       ... got client object and companyid from db.
         client.Company = _company.GetCompanybyID(companyid);
        return client;
    }
}

 Company
 {
    private IClient _client;

    public Company() : this (new Factory()) {}

    public Company(Factory factory)
    {
        _client = factory.CreateNewIClient();
     }

    public Company GetCompanyWithAllClients(int companyid)
    {
         .... do stuff to get a company out and client ids
         .... for each client id found
          company.Clients.add(_client.GetClientByID(clientid));
          return company;
    } 
 } 
```

*   我是不是把 DI 的事情都搞错了，工厂的想法好吗？

*   我应该如何避免彼此需要的课程？他们现在这样的原因是为了避免重复代码。我确信我可以编写更简洁的 SQL 以一次性完成，或者至少在同一方法中的几个查询中，但我试图避免在不同的地方重复代码。

感谢您的任何建议。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T17:10:04.533

这与其说是对问题的澄清，不如说是一个答案。我认为您的工厂使事情变得有些复杂（因为您得到堆栈溢出异常而不是根本无法编译）。

问题是循环依赖。没有 B 的实例就不能实例化 A，没有 A 的实例就不能实例化 B 的实例。

```
public class Company : ICompany
{
    private IClient _client;

    // OK so first build a client and pass it in
    public Company(IClient client)
    {
       _client = _client;
    }
}

public class Client : IClient
{
    private ICompany _company;

    // OK so first build a company and pass it in.  Oh.  I can't... :(
    public Client(ICompany company)
    {
        _company = company;
    }    
} 
```

Misko 有一篇关于此的文章可能会有一些用处： http: [//misko.hevery.com/2008/08/01/circular-dependency-in-constructors-and-dependency-injection/](http://misko.hevery.com/2008/08/01/circular-dependency-in-constructors-and-dependency-injection/)

基本上：您的课程设计是问题所在，需要修复。工厂只是混淆了这个问题:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T16:17:08.917

Maybe you could use some ORM tool for you DAL, like NHibernate or Linq to SQL? NHibernate will map your data into objects with bi-directional links (if you want).

Edit: typo

Cheers, Rok

# documentation - 支持 MS Word 和 C# xmldoc 的帮助生成工具

> ID：763678
> 
> 赞同：11
> 
> 时间：2009-04-18T16:07:16.663
> 
> 标签：documentation, documentation-generation, sandcastle, help-authoring

我正在寻找可以满足此类要求的帮助/文档生成工具：

*   它应该支持 c# 编译器生成的 xmldoc 注释，或者（甚至更好）直接支持 sandcastle
*   它应该支持导入 MS Word 文档。
*   它应该支持创建从概念文档到源代码生成的参考文档的链接。
*   如果它支持 MS Word 中的概念文档创作，那就太好了

更多细节。我的项目是.NET 的框架/库。它有几个 VS 解决方案，总共有 50 多个 C# 项目。首先，我想从我的项目的源代码中生成帮助（未来的 chm & help2 & help3）。我将该文档称为“参考文档”。沙堡（尤其是使用[SCFB](http://www.codeplex.com/SHFB)) 可以很好地做到这一点。但是（我想这是很常见的情况）我有一些关于框架/库的附加文档。该文档位于 MS Word 文件中（5-10 个文件）。我将该文档称为“概念文档”。我想用概念文档和参考文档（如 MSDN）制作一个可靠的帮助系统。我希望帮助的概念部分包含链接（URL），这些链接引用了来自框架/库的每个 .NET 类型名称的帮助的参考部分。（显然任何帮助系统最终都只是 HTML）。

问题是如何创建这些链接。MS Word 文件对 C# xmldoc 一无所知。Sandcastle 不支持 Word 文件。所以我必须采取一些帮助创作工具（HAT）。到目前为止，我找不到任何适合我的工具。如果有任何帮助，我将不胜感激！

所有工具的绊脚石是链接自动创建。我希望在生成期间自动创建链接（可以在构建服务器上进行）。为什么会自动？因为它允许轻松重命名类型。例如。我在概念文档中有一些文本：“用于访问请求处理上下文使用 XOperationContext 类型的静态属性 Current”。这里 XOperationContext 是一个类型名称。我希望它成为结果帮助系统中 XOperationContext 类规范的链接（URL），而无需付出任何重大努力。我想在 Word 中（可能安装了一些 HAT 的插件）或在 HAT 的编辑器中将其标记为“如果可能，请制作此单词链接”。在生成过程中，如果存在具有此类名称的类型名称，则每个此类单词都将成为链接。

我知道这些工具：

*   [Toolsfactory Doc-o-Matic](http://www.doc-o-matic.com/index.html)（现在使用）
*   [Innovasys DocumentX 和 HelpStudio](http://www.doc-o-matic.com/index.html)
*   [ComponentOne 文档帮助](http://www.componentone.com/SuperProducts/DocToHelp/)

Doc-o-Matic 支持链接自动创建。真正自动。它尝试为 PascalCase 中的每个单词创建一个链接——非常出色。但它不支持 MS Word。Innovasys 和 ComponentOne 的软件不支持自动创建链接。Innovasys 的软件不支持 MS Word（对此我不确定 100%）。

我试图在 Innovasys 和 ComponentOne 的论坛上提问。到目前为止没有运气。Innovasys 的软支持方案和我的一样：在单独的工具 - HelpStudio 中创建概念文档，并使用另一个工具 - DocumentX 从源代码生成帮助。但是无法自动创建链接和导入 MS Word 文件。

因此，请分享您对该常见任务的过期时间（我相信它应该是常见的）。

ps如果我没有从英语语法的角度正确解释我的想法，请告诉我，我会再试一次。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-16T04:32:44.437

Sandcastle is open source, so why not invent something on your own? Write an office automation tool is not that hard after all. And you can even create a business on that tool.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T18:51:24.250

如何将您的 MS Word 文件导出为 HTML，然后将它们合并到帮助文件的 HTML 中？这是一个选择吗？格式可能会丢失一些，但它可能会让您更好地集成所有内容。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-05T14:56:19.540

我建议从[SandCastle](http://blogs.msdn.com/sandcastle/)开始，然后对其中一种输出文件格式进行后处理以生成 Word 文档。`*.docx`从头开始制作 Office 2007 Word 文档（[Brian Jones有一篇关于](http://blogs.msdn.com/brian_jones/)[Open XML SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=c6e744e5-36e9-45f5-8d8c-331df206e0d0&DisplayLang=en)的优秀博客，它支持处理来自 .NET 的 Office 文档。

如果创建一个完整的包对于您要完成的工作来说似乎太复杂或工作量太大，您总是可以决定从现有的 Word 文档开始，然后用您自己的文本替换占位符。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-04T21:14:08.417

你看过[Doxygen](http://www.doxygen.nl/)吗？它对 Word 文件没有任何作用，但它是开源的，所以也许您可以自己添加这些功能。我真的很喜欢它生成的文档，而且它非常轻量级，所以我将它包含在构建过​​程中以自动重新生成文档。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-05-23T03:37:49.110

我认为解决方案是首先将您的 Word 文件转换为 (X)HTML 或其他非二进制格式，然后将概念文档与参考文档一起导入。您可以根据文档正文的文本内容（如您所指出的）自动创建链接，或者通过预处理步骤运行概念文档以对其进行注释。这甚至可以是导入前运行的脚本。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-22T12:57:42.950

Try taking a look at SandCastle.

# java - 创建一个 JLabel 数组

> ID：763683
> 
> 赞同：1
> 
> 时间：2009-04-18T16:10:26.547
> 
> 标签：java, arrays, user-interface, netbeans, jlabel

我正在尝试使用 netbeans GUI 设计创建 5 个 Jlabel，标签应该显示 5 个不同的值。

我需要将这 5 个 JLabel 组合到 1 个标签数组中。设计中有什么选项可以让我这样做吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T16:23:44.660

use a Panel or an Internal Frame, then simply put your JLabels inside

# algorithm - 编程之谜：如何将 Excel 列名转换为数字？

> ID：763691
> 
> 赞同：45
> 
> 时间：2009-04-18T16:13:32.063
> 
> 标签：algorithm, puzzle

我最近在一次工作面试中被要求解决一个我认为分享会很有趣的编程难题。这是关于将 Excel 列字母转换为实际数字，如果你还记得的话，Excel 用从 A 到 Z 的字母命名它的列，然后序列为 AA、AB、AC... AZ、BA、BB 等。

您必须编写一个接受字符串作为参数的函数（如“AABCCE”）并返回实际的列号。

解决方案可以是任何语言。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-06-17T01:04:12.870

对我来说听起来像是一个标准的减少：

Python：

```
def excel2num(x): 
    return reduce(lambda s,a:s*26+ord(a)-ord('A')+1, x, 0) 
```

C＃：

```
int ExcelToNumber(string x) {
    return x.Aggregate(0, (s, c) => s * 26 + c - 'A' + 1 );
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-18T17:07:25.037

我很久以前为一些 Python 脚本写了这个：

```
def index_to_int(index):
    s = 0
    pow = 1
    for letter in index[::-1]:
        d = int(letter,36) - 9
        s += pow * d
        pow *= 26
    # excel starts column numeration from 1
    return s 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-18T16:59:57.147

从 STDIN 中读取一个列名并打印出其对应的编号：

```
perl -le '$x = $x * 26 - 64 + ord for <> =~ /./g; print $x' 
```

注意事项：假设为 ASCII。

**编辑：**替换`"`为`'`以便您的外壳不会`$x`在字符串中插入。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-11-23T23:49:48.527

巧合的是，我使用 javascript 解决了同样的问题

```
$(function() { //shorthand document.ready function
    var getNumber = function(x) {
        var result = 0;
        var multiplier = 1;
        for ( var i = x.length-1; i >= 0; i--)
        { 
            var value = ((x[i].charCodeAt(0) - "A".charCodeAt(0)) + 1);
            result = result + value * multiplier;
            multiplier = multiplier * 26;
        }
        return result;
    };

    $('#form').on('submit', function(e) { //use on if jQuery 1.7+
        e.preventDefault();  //prevent form from submitting
        var data = $("#number").val();
        $('#answer').text(getNumber(data));
    });
});
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<form id="form">
<input type="text" id="number"></input>
    <button>submit</button>
</form>
<p id="answer"></p>
```

```
 var getNumber = function(x) {
        var result = 0;
        var multiplier = 1;
        for ( var i = x.length-1; i >= 0; i--)
        { 
            var value = ((x[i].charCodeAt(0) - "A".charCodeAt(0)) + 1);
            result = result + value * multiplier;
            multiplier = multiplier * 26;
        }
        return result;
    }; 
```

[http://jsfiddle.net/M7Xty/1/](http://jsfiddle.net/M7Xty/1/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-18T16:22:44.303

哈 - 已经在我们的代码库中编写了它 - 大约 3 次不同的时间:(

```
%% @doc Convert an string to a decimal integer
%% @spec b26_to_i(string()) -> integer()

b26_to_i(List) when is_list(List) ->
    b26_to_i(string:to_lower(lists:reverse(List)),0,0).

%% private functions
b26_to_i([], _Power, Value) -> 
    Value;

b26_to_i([H|T],Power,Value)->
    NewValue = case (H > 96) andalso (H < 123) of
                   true ->
                       round((H - 96) * math:pow(26, Power));
                   _    ->
                       exit([H | T] ++ " is not a valid base 26 number")
               end,
    b26_to_i(T, Power + 1, NewValue + Value). 
```

谜底是它实际上不是数字的 Base26 表示（我们在这里的函数名是自欺欺人），因为其中没有 0。

顺序为：A、B、C ... Z、AA、AB、AC

而不是：A、B、C ...Z、BA、BB、BC

（语言是 Erlang，mais oui）。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-06-17T01:18:44.587

您可以像这样在 C 中执行此操作：

```
unsigned int coltonum(char * string)
{
   unsigned result = 0;
   char ch;

   while(ch = *string++)
      result = result * 26 + ch - 'A' + 1;

  return result;
} 
```

无错误检查，仅适用于大写字符串，字符串必须为空终止。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-18T16:28:48.780

假设列 A = 1

```
int GetColumnNumber(string columnName)
{
  int sum = 0;
  int exponent = 0;
  for(int i = columnName.Length - 1; i>=0; i--)
  {
    sum += (columnName[i] - 'A' + 1) *  (GetPower(26, exponent));
    exponent++;
  }
  return sum;
}

int GetPower(int number, int exponent)
{
  int power = 1;
  for(int i=0; i<exponent; i++)
    power *= number;
  return power;
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-06-16T23:47:04.523

警告：这两个版本都假定只有大写字母 A 到 Z。其他任何内容都会导致计算错误。添加一些错误检查和/或大写来改进它们并不难。

斯卡拉

```
def excel2Number(excel : String) : Int = 
  (0 /: excel) ((accum, ch) => accum * 26 + ch - 'A' + 1) 
```

哈斯克尔

```
excel2Number :: String -> Int
excel2Number = flip foldl 0 $ \accum ch -> accum * 26 + fromEnum ch - fromEnum 'A' + 1 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2010-01-07T16:56:26.890

从名称中获取列号

爪哇：

```
public int getColNum (String colName) {

    //remove any whitespace
    colName = colName.trim();

    StringBuffer buff = new StringBuffer(colName);

    //string to lower case, reverse then place in char array
    char chars[] = buff.reverse().toString().toLowerCase().toCharArray();

    int retVal=0, multiplier=0;

    for(int i = 0; i < chars.length;i++){
        //retrieve ascii value of character, subtract 96 so number corresponds to place in alphabet. ascii 'a' = 97 
        multiplier = (int)chars[i]-96;
        //mult the number by 26^(position in array)
        retVal += multiplier * Math.pow(26, i);
    }
    return retVal;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-02-26T09:56:26.027

从 Java 中的 int 获取列名（[在此处阅读更多内容](http://mcdrummerman.wordpress.com/2010/01/07/convert-a-column-number-to-a-column-name-java-example/#more-146)）：

```
public String getColName (int colNum) {

   String res = "";

   int quot = colNum;
   int rem;        
    /*1\. Subtract one from number.
    *2\. Save the mod 26 value.
   *3\. Divide the number by 26, save result.
   *4\. Convert the remainder to a letter.
   *5\. Repeat until the number is zero.
   *6\. Return that bitch...
   */
    while(quot > 0)
    {
        quot = quot - 1;
        rem = quot % 26;
        quot = quot / 26;

        //cast to a char and add to the beginning of the string
        //add 97 to convert to the correct ascii number
        res = (char)(rem+97) + res;            
    }   
    return res;
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2011-08-11T11:32:06.987

另一个德尔福：

```
function ExcelColumnNumberToLetter(col: Integer): string;
begin
  if (col <= 26) then begin
    Result := Chr(col + 64);
  end
  else begin
    col := col-1;
    Result := ExcelColumnNumberToLetter(col div 26) + ExcelColumnNumberToLetter((col mod 26) + 1);
  end;
end; 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-11-06T13:37:33.567

另一个Java：

```
public static int convertNameToIndex(String columnName) {
    int index = 0;
    char[] name = columnName.toUpperCase().toCharArray();

    for(int i = 0; i < name.length; i++) {
        index *= 26;
        index += name[i] - 'A' + 1;
    }

    return index;
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2016-02-08T03:53:28.850

简单的 Java 解决方案 -->

```
public class ColumnName {

public static int colIndex(String col)
{   int index=0;
    int mul=0;
    for(int i=col.length()-1;i>=0;i--)
    {   
        index  += (col.charAt(i)-64) * Math.pow(26, mul);
        mul++;
    }
    return index;
}

public static void main(String[] args) {

    System.out.println(colIndex("AAA"));

} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-18T16:16:04.630

将字符串视为以 A、B、... Z 表示的以 26 为底的列号的倒数是否有帮助？

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-18T16:18:17.870

这基本上是一个以 26 为基数的数字，不同之处在于该数字不使用 0-9，然后是字母，而**只**使用字母。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-04-18T16:39:01.783

这是一个CFML：

```
<cffunction name="ColToNum" returntype="Numeric">
    <cfargument name="Input" type="String" />
    <cfset var Total = 0 />
    <cfset var Pos = 0 />

    <cfloop index="Pos" from="1" to="#Len(Arguments.Input)#">
        <cfset Total += 26^(Pos-1) * ( Asc( UCase( Mid(Arguments.Input,Pos,1) ) ) - 64 ) />
    </cfloop>

    <cfreturn Total />
</cffunction>

<cfoutput>
    #ColToNum('AABCCE')#
</cfoutput> 
```

因为我心情很奇怪，所以这里有一个 CFScript 版本：

```
function ColToNum ( Input )
{
    var Total = 0;

    for ( var Pos = 1 ; Pos <= Len(Arguments.Input) ; Pos++ )
    {
        Total += 26^(Pos-1) * ( Asc( UCase( Mid(Arguments.Input,Pos,1) ) ) - 64 );
    }

    return Total;
}

WriteOutput( ColToNum('AABCCE') ); 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-04-18T19:25:03.023

普通 Lisp：

```
(defun excel->number (string)
  "Converts an Excel column name to a column number."
  (reduce (lambda (a b) (+ (* a 26) b))
          string
          :key (lambda (x) (- (char-int x) 64)))) 
```

*编辑：*逆运算：

```
(defun number->excel (number &optional acc)
  "Converts a column number to Excel column name."
  (if (zerop number)
      (concatenate 'string acc)
      (multiple-value-bind (rest current) (floor number 26)
        (if (zerop current)
            (number->excel (- rest 1) (cons #\Z acc))
            (number->excel rest (cons (code-char (+ current 64)) acc)))))) 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-04-18T22:48:20.117

稍微相关，更好的挑战是反过来：给定列号，找到作为字符串的列标签。

我为 KOffice 实现的 Qt 版本：

```
QString columnLabel( unsigned column )
{
  QString str;
  unsigned digits = 1;
  unsigned offset = 0;

  column--;
  for( unsigned limit = 26; column >= limit+offset; limit *= 26, digits++ )
    offset += limit;

  for( unsigned c = column - offset; digits; --digits, c/=26 )
    str.prepend( QChar( 'A' + (c%26) ) );

  return str;
} 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-04-19T01:39:09.427

另一个[更神秘的] erlang 示例：

```
col2int(String) -> col2int(0,String).
col2int(X,[A|L]) when A >= 65, A =< 90 ->
col2int(26 * X + A - 65 + 1, L);
col2int(X,[]) -> X. 
```

和反函数：

```
int2col(Y) when Y > 0 -> int2col(Y,[]).
int2col(0,L) -> L;
int2col(Y,L) when Y rem 26 == 0 -> 
   int2col(Y div 26 - 1,[(26+65-1)|L]);
int2col(Y,L) ->
   P = Y rem 26,
   int2col((Y - P) div 26,[P + 65-1|L]). 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-04-19T23:25:15.870

德尔福：

```
// convert EXcel column name to column number 1..256
// case-sensitive; returns 0 for illegal column name
function cmColmAlfaToNumb( const qSRC : string ) : integer;
var II : integer;
begin
   result := 0;
   for II := 1 to length(qSRC) do begin
      if (qSRC[II]<'A')or(qSRC[II]>'Z') then begin
         result := 0;
         exit;
      end;
      result := result*26+ord(qSRC[II])-ord('A')+1;
   end;
   if result>256 then result := 0;
end; 
```

-阿尔。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-04-20T21:19:56.600

```
def ExcelColumnToNumber(ColumnName):
    ColNum = 0
    for i in range(0, len(ColumnName)):
        # Easier once formula determined: 'PositionValue * Base^Position'
        # i.e. AA=(1*26^1)+(1*26^0)   or  792=(7*10^2)+(9*10^1)+(2*10^0)
        ColNum += (int(ColumnName[i],36) -9) * (pow(26, len(ColumnName)-i-1))
    return ColNum 
```

ps 我的第一个 Python 脚本！

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-06-17T00:00:37.490

此版本纯粹是功能性的，并允许替代“代码”序列，例如，如果您只想使用字母“A”到“C”。在 Scala 中，来自 dcsobral 的建议。

```
def columnNumber(name: String) = {
    val code = 'A' to 'Z'

    name.foldLeft(0) { (sum, letter) =>
        (sum * code.length) + (code.indexOf(letter) + 1)
    }
} 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2011-05-17T07:46:07.837

在数学中：

```
FromDigits[ToCharacterCode@# - 64, 26] & 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2011-06-18T03:02:44.740

使用 Mr. Wizard 令人敬畏的 Mathematica 代码，但摆脱了神秘的纯函数！

```
columnNumber[name_String] := FromDigits[ToCharacterCode[name] - 64, 26] 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2013-01-23T16:38:49.527

维基百科有很好的解释和算法

[http://en.wikipedia.org/wiki/Hexavigesimal](http://en.wikipedia.org/wiki/Hexavigesimal)

```
public static String toBase26(int value){
    // Note: This is a slightly modified version of the Alphabet-only conversion algorithm

    value = Math.abs(value);
    String converted = "";

    boolean iteration = false;

    // Repeatedly divide the number by 26 and convert the
    // remainder into the appropriate letter.
    do {
        int remainder = value % 26;

        // Compensate for the last letter of the series being corrected on 2 or more iterations.
        if (iteration && value < 25) {
            remainder--;
        }

        converted = (char)(remainder + 'A') + converted;
        value = (value - remainder) / 26;

        iteration = true;
    } while (value > 0);

    return converted;    
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2014-11-07T16:52:29.850

…只需要**PHP**的解决方案。这就是我想出的：

```
/**
 * Calculates the column number for a given column name.
 *
 * @param string $columnName the column name: "A", "B", …, "Y", "Z", "AA", "AB" … "AZ", "BA", … "ZZ", "AAA", …
 *
 * @return int the column number for the given column name: 1 for "A", 2 for "B", …, 25 for "Y", 26 for "Z", 27 for "AA", … 52 for "AZ", 53 for "BA", … 703 for "AAA", …
 */
function getColumnNumber($columnName){
    //  the function's result
    $columnNumber = 0;

    //  at first we need to lower-case the string because we calculate with the ASCII value of (lower-case) "a"
    $columnName = strtolower($columnName);
    //  ASCII value of letter "a"
    $aAsciiValue = ord('a') - 1;

    //  iterate all characters by splitting the column name
    foreach (str_split($columnName) as $character) {
        //  determine ASCII value of current character and substract with that one from letter "a"
        $characterNumberValue = ord($character) - $aAsciiValue;

        //  through iteration and multiplying we finally get the previous letters' values on base 26
        //  then we just add the current character's number value
        $columnNumber = $columnNumber * 26 + $characterNumberValue;
    }

    //  return the result
    return $columnNumber;
} 
```

当然，只需在 foreach 循环中将一些东西组合成一行代码，就可以稍微缩短脚本：

```
//  …
$columnNumber = $columnNumber * 26 + ord($character) - ord('a') + 1;
//  … 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-07-14T14:16:50.087

在 Python 中，没有减少：

```
def transform(column_string):
    return sum((ascii_uppercase.index(letter)+1) * 26**position for position, letter in enumerate(column_string[::-1])) 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2015-10-16T21:51:16.047

这是此代码在 Python 中的另一个版本：

```
keycode=1
for i in range (1,len(word)):
    numtest[i]=word[i-1]
    keycode = keycode*26*int(wordtest[numtest[i]])
last=word[-1:]
keycode=keycode+int(wordtest[last])
print(keycode)
print(bin(keycode))
#Numtest and wordtest are dictionaries. 
```

# java - 在 Eclipse 中运行的 Tomcat 实例的“工作”目录在哪里？

> ID：763693
> 
> 赞同：32
> 
> 时间：2009-04-18T16:14:44.197
> 
> 标签：java, eclipse, jsp, tomcat

在 Eclipse 中，您可以配置许多服务器以在 IDE 中运行，包括 Tomcat。根据您的 Tomcat 配置，在 webapp 的生命周期中的某个时刻，您的 JSP 文件将被编译成 servlet。这些新的 servlet *.class文件与从 JSP 创建的**.java*中间文件`%TOMCAT_HOME%/work`一起存储在该目录中。*当您的 JSP 抛出异常并引用对应于.java*而不是*.jsp*的行号时，此*.java*文件非常有用

 *****更新：**在我的环境（Windows）上，它位于：

> C:/Documents and Settings/ **%USER%** /workspace/.metadata/ .plugins /org.eclipse.wst.server.core/tmp0/work

也许要更完整地回答，有人可以发布 *nix 环境的位置。

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2009-04-18T17:43:28.650

你会发现它在

```
projectworkspace/.metadata/.plugins/org.eclipse.wst.server.core/tmp0 
```

这是 Eclipse 3.4 发布项目的默认位置。但是，这可以通过更改“服务器”视图中的设置来更改。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-19T08:39:26.297

转到“服务器”窗口->双击您的tomcat实例->单击“打开启动配置”->转到“参数”选项卡。

寻找这样的变量定义：

```
-Dcatalina.base="/Users/dirtyaffairs/Documents/workspace/.metadata/.plugins/org.eclipse.wst.server.core/tmp0" 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-04-18T19:03:03.030

最简单的方法最有可能向已编译的 JSP 页面询问字节码的来源。

来自[http://www.exampledepot.com/egs/java.lang/ClassOrigin.html](http://www.exampledepot.com/egs/java.lang/ClassOrigin.html)：

```
// Get the location of this class
Class cls = this.getClass();
ProtectionDomain pDomain = cls.getProtectionDomain();
CodeSource cSource = pDomain.getCodeSource();
URL loc = cSource.getLocation();  // file:/c:/almanac14/examples/ 
```

希望这会有所帮助。你想做什么？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2016-03-09T00:58:02.237

1.  在**Windows**上，转到 Eclipse 的 Tomcat 部署位置的最简单方法是在**Servers**视图中右键单击 Tomcat 实例，然后单击“ **Browse Deployment Location...** ”

    您应该会看到 Eclipse 巧妙地打开一个 Windows 资源管理器，将您带到确切的位置。就我而言，它需要我：

    `C:\eclipse4.3.2-jee-kepler-SR2-win32\workspaces\.metadata\.plugins\org.eclipse.wst.server.core\tmp1\wtpwebapps`

    从那里，您可以轻松浏览到“工作”目录，如下所示。

    如果你遵循这个，你永远不必记住位置！

    ### Eclipse 服务器视图：

    [![在此处输入图像描述](https://i.stack.imgur.com/yUA8Q.jpg)](https://i.stack.imgur.com/yUA8Q.jpg)

    ### Windows 资源管理器打开：

    [![在此处输入图像描述](https://i.stack.imgur.com/iRjFA.jpg)](https://i.stack.imgur.com/iRjFA.jpg)

    ### Windows 资源管理器（单击地址栏以显示完整路径）：

    [![在此处输入图像描述](https://i.stack.imgur.com/ediTn.jpg)](https://i.stack.imgur.com/ediTn.jpg)

2.  在**Amazon EC2 Linux 上**（但这与 Eclipse 无关），Tomcat**工作**目录位于`/var/cache/tomcat7/work`

    ```
    [ec2-user@ip-172-31-xx-xx ~]$ uname -a
    Linux ip-172-31-xx-xx 4.1.10-17.31.amzn1.x86_64 #1 SMP Sat Oct 24 01:31:37 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux

    [root@ip-172-31-xx-xx] /usr/share/tomcat7 $ ls -l
    total 4
    drwxr-xr-x 2 root root   4096 Jan  5 15:18 bin
    lrwxrwxrwx 1 root tomcat   12 Jan  5 15:18 conf -> /etc/tomcat7
    lrwxrwxrwx 1 root tomcat   23 Jan  5 15:18 lib -> /usr/share/java/tomcat7
    lrwxrwxrwx 1 root tomcat   16 Jan  5 15:18 logs -> /var/log/tomcat7
    lrwxrwxrwx 1 root tomcat   23 Jan  5 15:18 temp -> /var/cache/tomcat7/temp
    lrwxrwxrwx 1 root tomcat   24 Jan  5 15:18 webapps -> /var/lib/tomcat7/webapps
    lrwxrwxrwx 1 root tomcat   23 Jan  5 15:18 work -> /var/cache/tomcat7/work

    [root@ip-172-31-xx-xx] /var/cache/tomcat7/work/Catalina/localhost/init/org/apache/jsp $ ls -la
    total 180
    drwxr-xr-x 2 tomcat tomcat  4096 Jan  6 06:37 .
    drwxr-xr-x 3 tomcat tomcat  4096 Jan  6 06:37 ..
    -rw-r--r-- 1 tomcat tomcat 54172 Aug 17  2012 index_jsp.class
    -rw-r--r-- 1 tomcat tomcat  2106 Jan  6 06:37 index_jsp$FileComp.class
    -rw-r--r-- 1 tomcat tomcat  1034 Jan  6 06:37 index_jsp$FileInfo.class
    -rw-r--r-- 1 tomcat tomcat  6460 Jan  6 06:37 index_jsp$HttpMultiPartParser.class
    -rw-r--r-- 1 tomcat tomcat 89445 Aug 17  2012 index_jsp.java
    -rw-r--r-- 1 tomcat tomcat  2210 Jan  6 06:37 index_jsp$UplInfo.class
    -rw-r--r-- 1 tomcat tomcat  1208 Jan  6 06:37 index_jsp$UploadMonitor.class
    -rw-r--r-- 1 tomcat tomcat  1184 Jan  6 06:37 index_jsp$Writer2Stream.class 
    ```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-18T16:35:48.313

You can change it by setting scratchDir parameter in web.xml configuration of your server (in Servers project, not in your application web.xml!).

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2020-10-25T03:05:17.663

如果您在 Eclipse 中使用 Tomcat Maven 插件，那么您的 Tomcat 相关文件将在`<project folder>/target/tomcat`其中，包括位于的 tomcat 工作文件夹`<project folder>/target/tomcat/work`，您可以从那里找到您的 jsp .java 文件等。

（我知道这可能并不适用于所有人，但由于 Tomcat Maven 插件是使用 tomcat 进行开发并使用 maven 来管理依赖项并帮助构建过程的流行方式，我希望这些信息可能对某些人有所帮助）。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-18T16:31:21.520

I assume it would be the same location relative to your workspace.

# silverlight - Silverlight 截断文本/换行并且无法正确显示

> ID：763698
> 
> 赞同：1
> 
> 时间：2009-04-18T16:15:44.867
> 
> 标签：silverlight, layout, silverlight-3.0, expression-blend, xamlpad

请帮助我理解这背后的问题并解决它，我在获得我想要的文本显示行为时遇到了很多麻烦。

对于特定长度的字符串，TextBlock 会环绕，但不会更新控件以显示第二行，实际上使部分文本消失。

**这在 XamlPad 中可以正常工作，但在 Silverlight 3 和 Expression blend 3 中则不行**

```
<Grid x:Name="LayoutRoot" Background="{x:Null}">
    <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
    </Grid.RowDefinitions>
    <Grid.ColumnDefinitions>
        <ColumnDefinition Width="Auto"/>
        <ColumnDefinition Width="Auto"/>
    </Grid.ColumnDefinitions>
<Border CornerRadius="20,20,20,20" Grid.ColumnSpan="2" Grid.RowSpan="2" BorderBrush="#FF000000" BorderThickness="1,1,1,1">
    <Border.Background>
        <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
            <GradientStop Color="#FF2100FF"/>
            <GradientStop Color="#FFFFFFFF" Offset="1"/>
        </LinearGradientBrush>
    </Border.Background>
</Border>

<TextBlock x:Name="eventName" Grid.Column="1" Text="Amazing Music" FontSize="24" Margin="5,5,10,5" HorizontalAlignment="Left" VerticalAlignment="Top" Padding="0,0,0,0"/>
<TextBlock x:Name="eventDescription" Grid.Column="1" Grid.Row="1" Text="Amazin music in that house" TextWrapping="Wrap" FontSize="14" Margin="5" HorizontalAlignment="Left" VerticalAlignment="Top" MaxWidth="300" />
</Grid> 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T04:36:56.820

我认为布劳里奥有点意思。通过将文本包装在边框中的堆栈面板中，我能够使其正确包装和调整大小。将此 XAML 拖放到未设置宽度和高度的全新用户控件上。

```
<Border CornerRadius="20,20,20,20" BorderBrush="#FF000000" BorderThickness="1,1,1,1" 
    Height="Auto" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Width="192"
    Padding="5">
    <Border.Background>
        <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
            <GradientStop Color="#FF2100FF"/>
            <GradientStop Color="#FFFFFFFF" Offset="1"/>
        </LinearGradientBrush>
    </Border.Background>
    <StackPanel>
        <TextBlock x:Name="eventName" Text="Amazing Music" FontSize="24" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Padding="0,0,0,0"/>
        <TextBlock x:Name="eventDescription" Text="Amazin music in that house" TextWrapping="Wrap" FontSize="14" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" MaxWidth="300" />
    </StackPanel>
</Border> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-20T18:47:59.990

嗯....也许 hte isue 可以在网格上，尝试在虚拟堆栈面板中执行此操作，以检查您是否必须使用 auto 或 * ...

另一方面，如果您需要在修复区域内显示 TextBlock，

[http://www.tipsdotnet.com/TechBlog.aspx?PageIndex=0&BLID=7](http://www.tipsdotnet.com/TechBlog.aspx?PageIndex=0&BLID=7)

干杯布劳里奥

# sql - create and edit view table?

> ID：763709
> 
> 赞同：1
> 
> 时间：2009-04-18T16:19:38.617
> 
> 标签：sql

How to create a view with the name "changedata" to see the full name of all employees, salary, department name and the name of the region and allows edit of data from the table s_emp view?

```
create view change as 
SELECT a.last_name||','||a.first_name as "Nombre", 
       a.salary as "Salary", b.name"Department", 
       c.name as "Region Name"
FROM s_emp a, s_dept b, s_region c
WHERE a.dept_id = b.id AND b.region_id = c.id 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-25T03:23:54.300

两种选择。

1.  包括您希望使其可编辑的所有列，并确保视图是可更新的（我认为在这种情况下，您至少需要对 s_dept.id 和 s_region.id 进行唯一约束）。请注意，这仍然不允许编辑派生数据（例如，您的“Nombre”、“Department”和“Region Name”列将不可编辑）。

2.  创建 INSTEAD OF 触发器来处理视图上的插入、更新和/或删除。

# css - IE6 background-position(?) issue

> ID：763714
> 
> 赞同：5
> 
> 时间：2009-04-18T16:23:00.387
> 
> 标签：css, internet-explorer-6, background-image, background-position

I apply to **stackoverflow** as my last resort. I got this ie6 bug while using the image at the background of the link. It seems that ie6 scrolls the background. How can I avoid it?

At some width it shows like this:
[alt text http://img135.imageshack.us/img135/8849/badie1.png](http://img135.imageshack.us/img135/8849/badie1.png)

And at some other it shows like that:
[alt text http://img522.imageshack.us/img522/8180/badie2.png](http://img522.imageshack.us/img522/8180/badie2.png)

IE7 & FF show this just like I expect:
[alt text http://img142.imageshack.us/img142/2296/goodie.png](http://img142.imageshack.us/img142/2296/goodie.png)
The links are placed inside the div which is floating to the right.

```
<a href="/tr" class="menuLink" style="background-image:url(/img/tr.png);">TR</a>
<a href="/eng" class="menuLink" style="background-image:url(/img/eng.png); margin-right:30px;">ENG</a>
<a href="/logout" class="menuLink" style="background-image:url(/img/logout.png);"><?=$ui["exit"];?></a>

   .menuLink {
     font-family:"Tahoma";
     font-size:11px;
     color:#003300;
     text-decoration:underline;
     font-weight: bold;
     background-position:0% 50%;
     background-repeat:no-repeat;
    }
     .menuLink:hover {
     font-size:11px;
     color:#047307;
     text-decoration:underline;
     font-weight: bold;
     } 
```

Any hints how can I avoid this?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-04T07:51:10.890

我自己也遇到了这个问题，我发现`overflow:hidden`在带有背景图像的元素上使用解决了我的很多 IE6 问题（尽管不是全部）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T16:35:15.240

I would find a solution that works for IE6 and use [Conditional Comments](http://msdn.microsoft.com/en-us/library/ms537512(VS.85,loband).aspx) to filter out the other proper versions for IE7, FF, etc. I would also avoid using percents in the `background-position` for IE6 ([reference](http://www.quirksmode.org/css/background/background_try.html)).

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-14T11:20:31.833

您不能将背景位置与任何* ie6 .png 修复一起使用，解决方案是使图像成为 gif 或 8 位 png。

*我没有使用/尝试过

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-10-17T11:51:18.550

如果您的元素中有`padding-top`或`padding-bottom`在您的元素中带有背景图像，并且`background-positioning`- 在 IE6 中，您可以更改`padding-top: 16px;`为`margin-top: 16px;`并解决问题。

它不会将其他元素推开，并且不再使填充加倍。
否则，在 IE7 和 IE8 中，填充属性有效。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-14T17:47:41.937

正如这个对[某个相关问题的](https://stackoverflow.com/questions/594870)[回答](https://stackoverflow.com/questions/594870#595598)所建议的那样，我建议使用and而不是IE (pre-IE8)。`background-position-x``background-position-y``background-position`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-21T12:38:45.767

改变

```
background-position:0% 50%; 
```

至

```
background-position:50% 50%; 
```

并添加

```
background-repeat: no-repeat; 
```

这将使图像水平和垂直居中并停止图像平铺。

# sql - 这个 MySQL 语句有什么问题：DECLARE @ID INT

> ID：763718
> 
> 赞同：5
> 
> 时间：2009-04-18T16:24:28.137
> 
> 标签：sql, tsql, mysql

```
DECLARE @ID INT ; 
```

这条语句用 MS SQL Server 解析得很好，但给了我

*您的 SQL 语法有错误；检查与您的 MySQL 服务器版本相对应的手册，以在第 1 行的“DECLARE @ID INT”附近使用正确的语法*

有人知道原因吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-18T16:29:00.357

DECLARE 用于存储过程/函数。

如果您只想为常规查询设置变量，请使用 SET

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T16:30:28.607

尝试在没有@的情况下命名变量

```
DECLARE id INT; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-11-12T10:09:40.483

我们不能在普通查询中使用 Declare。

试试这个：

```
SET @ID =(Select id from mytable) 
```

# interop - DllImport - PreserverSig 和 SetLastError 属性

> ID：763724
> 
> 赞同：10
> 
> 时间：2009-04-18T16:27:48.050
> 
> 标签：interop, dllimport

在 MSDN 上，我找到了两个属性的以下描述：

**PreserveSig**将 PreserveSig 字段设置为 true 以直接转换具有 HRESULT 或 retval 值的非托管签名；将其设置为 false 以自动将 HRESULT 或 retval 值转换为异常。默认情况下，PreserveSig 字段为 true。

**SetLastError**使调用者能够使用 Marshal.GetLastWin32Error API 函数来确定执行方法时是否发生错误。在 Visual Basic 中，默认值为 true（这会增加一些开销）；在 C# 和 C++ 中，默认值为 false。

我的问题是：这两者如何相互关联？假设我将 PreserveSig 设置为“false”——这意味着我应该将 HRESULT 转换为异常——如果非托管函数返回表示错误或未发生错误的整数，如何将其转换为异常？

另外，如果我设法使用 PreserveSig 提取异常，为什么还需要调用 GetLastWin32Error 方法？

亲切的问候PK

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-18T17:26:42.340

Win32 函数几乎从不返回`HRESULT`. 相反，它们返回 a`BOOL`或使用特殊值来指示错误（例如，`CreateFile`returns `INVALID_HANDLE_VALUE`）。它们将错误代码存储在每个线程变量中，您可以使用`GetLastError()`. `SetLastError=true`指示封送拆收器在本机函数返回后读取此变量，并将错误代码存储在您以后可以使用`Marshal.GetLastWin32Error()`. 这个想法是 .NET 运行时可能会在幕后调用其他 Win32 函数，这会在您有机会检查之前弄乱 p/invoke 调用中的错误代码。

返回 a `HRESULT`（或等价物，例如`NTSTATUS`）的函数与 Win32 函数属于不同的抽象级别。通常这些函数与 COM 相关（高于 Win32）或来自`ntdll`（低于 Win32），因此它们不使用 Win32 上一个错误代码（尽管它们可能在内部调用 Win32 函数）。

`PreserveSig=false`指示封送拆收器检查返回`HRESULT`，如果它不是成功代码，则创建并抛出包含`HRESULT`. `DllImport`然后，您的ed 函数的托管声明将`void`作为其返回类型。

请记住，C# 或 VB 编译器无法检查`DllImport`ed 函数的非托管签名，因此它必须信任您告诉它的任何内容。如果你`PreserveSig=false`使用一个返回非 a 的函数`HRESULT`，你会得到奇怪的结果（例如随机异常）。如果你`SetLastError=true`使用一个没有设置最后一个 Win32 错误代码的函数，你将得到垃圾而不是有用的错误代码。

# silverlight - “应为 ResourceDictionary 的继承者” - 此错误是什么意思

> ID：763729
> 
> 赞同：12
> 
> 时间：2009-04-18T16:30:39.620
> 
> 标签：silverlight, silverlight-3.0

在 App.xaml 我有以下代码：

```
<Application
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    x:Class="FJW.App">
    <Application.Resources>
        <!-- Resources scoped at the Application level should be defined here. -->
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="themes/F4.xaml"/>
                <ResourceDictionary Source="themes/F3.xaml"/>
                <ResourceDictionary Source="themes/F2.xaml"/>
                <ResourceDictionary Source="themes/F0.xaml"/>
                <ResourceDictionary Source="themes/F1.xaml"/>
                <ResourceDictionary Source="themes/Palm.xaml"/>
                <ResourceDictionary Source="themes/Key.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Application.Resources>
</Application> 
```

Visual Studio 在字符串中发现错误`<ResourceDictionary Source="themes/...xaml"/>` - 引发以下错误消息：*应为 ResourceDictionary 的继承者。*

但是该项目正在正确编译并且工作正常。错误信息是什么意思？也许这是这个 Beta Silverlight 版本的错误？还是我的错误？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-23T07:41:19.723

嗯。这是一个 BuildAction 问题。

I set up BuildAction property for xamls as Resource. And when I changed this property back to Page - erorrs are vanished.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T04:50:00.067

会不会是那些 .xaml 文件里面的东西让你着迷？我将您的代码复制到一个新项目中，并且在 Visual Studio 或 Expression Blend 中都没有看到任何错误消息。

[替代文字 http://www.smips.com/brad/stackoverflow/so-109.jpg](http://www.smips.com/brad/stackoverflow/so-109.jpg)

# c# - GetHashCode 扩展方法

> ID：763731
> 
> 赞同：12
> 
> 时间：2009-04-18T16:34:31.387
> 
> 标签：c#, hash, hashcode, gethashcode

在阅读了 StackOverflow 上有关覆盖的所有问题和答案后，`GetHashCode()`我编写了以下扩展方法，以便轻松方便地覆盖`GetHashCode()`：

```
public static class ObjectExtensions
{
    private const int _seedPrimeNumber = 691;
    private const int _fieldPrimeNumber = 397;
    public static int GetHashCodeFromFields(this object obj, params object[] fields) {
        unchecked { //unchecked to prevent throwing overflow exception
            int hashCode = _seedPrimeNumber;
            for (int i = 0; i < fields.Length; i++)
                if (fields[i] != null)
                    hashCode *= _fieldPrimeNumber + fields[i].GetHashCode();
            return hashCode;
        }
    }
} 
```

（我基本上只重构了有人贴在那里的代码，因为我很喜欢它可以通用）

我这样使用：

```
 public override int GetHashCode() {
        return this.GetHashCodeFromFields(field1, field2, field3);
    } 
```

你看到这段代码有什么问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T19:03:38.487

这看起来是一种可靠的方法。

我唯一的建议是，如果您真的关心它的性能，您可能希望为几种常见情况添加通用版本（即可能 1-4 args）。这样，对于那些对象（很可能是小型的、键式复合对象），您将不会有构建数组以传递给方法、循环、任何通用值的装箱等的开销。调用语法将完全相同，但您将针对这种情况运行稍微优化的代码。当然，在您决定是否值得进行维护权衡之前，我会对此进行一些性能测试。

像这样的东西：

```
public static int GetHashCodeFromFields<T1,T2,T3,T4>(this object obj, T1 obj1, T2 obj2, T3 obj3, T4 obj4) {
    int hashCode = _seedPrimeNumber;
    if(obj1 != null)
        hashCode *= _fieldPrimeNumber + obj1.GetHashCode();
    if(obj2 != null)
        hashCode *= _fieldPrimeNumber + obj2.GetHashCode();
    if(obj3 != null)
        hashCode *= _fieldPrimeNumber + obj3.GetHashCode();
    if(obj4 != null)
        hashCode *= _fieldPrimeNumber + obj4.GetHashCode();
    return hashCode;
} 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-07-11T09:48:50.770

不久前我写了一些东西，你可能会解决你的问题......（实际上，它可能会被改进以包含你拥有的种子......）

无论如何，该项目称为 Essence ( [http://essence.codeplex.com/](http://essence.codeplex.com/) )，它使用 System.Linq.Expression 库来生成（基于属性）Equals/GetHashCode/CompareTo/ToString 的标准表示，以及因为能够基于参数列表创建 IEqualityComparer 和 IComparer 类。（我也有一些进一步的想法，但想在继续深入之前获得一些社区反馈。）

（这意味着它几乎和手写一样快 - 不是的主要是 CompareTo(); 因为 Linq.Expressions 在 3.5 版本中没有变量的概念 - 所以你有当你没有得到匹配时，在底层对象上调用 CompareTo() 两次。使用 Linq.Expressions 的 DLR 扩展解决了这个问题。我想我可以使用 emit il，但当时我并没有那么灵感.)

这是一个非常简单的想法，但我以前从未见过它。

现在的问题是，我对完善它失去了兴趣（这将包括为 codeproject 写一篇文章，记录一些代码等），但如果你觉得这会是什么，我可能会被说服这样做出于兴趣。

（codeplex 站点没有可下载的包；只需转到源代码并获取它 - 哦，它是用 f# 编写的（尽管所有测试代码都在 c# 中），因为这是我有兴趣学习的东西。）

无论如何，这是项目中测试的 c# 示例：

```
 // --------------------------------------------------------------------
    // USING THE ESSENCE LIBRARY:
    // --------------------------------------------------------------------
    [EssenceClass(UseIn = EssenceFunctions.All)]
    public class TestEssence : IEquatable<TestEssence>, IComparable<TestEssence>
    {
        [Essence(Order=0] public int MyInt           { get; set; }
        [Essence(Order=1] public string MyString     { get; set; }
        [Essence(Order=2] public DateTime MyDateTime { get; set; }

        public override int GetHashCode()                                { return Essence<TestEssence>.GetHashCodeStatic(this); }
    ...
    }

    // --------------------------------------------------------------------
    // EQUIVALENT HAND WRITTEN CODE:
    // --------------------------------------------------------------------
    public class TestManual
    {
        public int MyInt;
        public string MyString;
        public DateTime MyDateTime;

        public override int GetHashCode()
        {
            var x = MyInt.GetHashCode();
            x *= Essence<TestEssence>.HashCodeMultiplier;
            x ^= (MyString == null) ? 0 : MyString.GetHashCode();
            x *= Essence<TestEssence>.HashCodeMultiplier;
            x ^= MyDateTime.GetHashCode();
            return x;
        }
    ...
    } 
```

无论如何，这个项目，如果有人认为值得，需要打磨，但想法是存在的......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T16:37:06.733

我看起来不错，我只有一个问题：很遗憾，您必须使用 an`object[]`来传递值，因为这会将您发送给函数的任何值类型装箱。我认为您没有太多选择，除非您像其他人建议的那样走创建一些通用重载的路线。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T16:40:58.410

一般来说，你应该`unchecked`尽可能地缩小你的范围，尽管这并不重要。除此之外，看起来还不错。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T16:47:15.070

```
public override int GetHashCode() {
    return this.GetHashCodeFromFields(field1, field2, field3, this);
} 
```

（是的，我很迂腐，但这是我看到的唯一问题）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-19T01:33:40.860

更优化：

1.  创建一个代码生成器，它使用反射来查看您的业务对象字段并创建一个覆盖 GetHashCode()（和 Equals()）的新部分类。
2.  当您的程序以调试模式启动时运行代码生成器，如果代码已更改，请退出并通知开发人员重新编译。

这样做的好处是：

*   使用反射您可以知道哪些字段是值类型，因此它们是否需要空检查。
*   没有开销 - 没有额外的函数调用，没有列表构造等。如果您要进行大量字典查找，这一点很重要。
*   长实现（在具有大量字段的类中）隐藏在部分类中，远离您的重要业务代码。

缺点：

*   如果您没有对 GetHashCode() 进行大量字典查找/调用，那就大材小用了。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-19T09:22:34.943

我应该指出，在实现 GetHashCode 时您几乎不应该进行分配（这里[有一些](http://blogs.msdn.com/ricom/archive/2007/01/22/performance-quiz-12-the-cost-of-a-good-hash.aspx) [有用的](http://blogs.msdn.com/ricom/archive/2007/01/24/performance-quiz-12-the-cost-of-a-good-hash-some-help.aspx) [博客](http://blogs.msdn.com/ricom/archive/2007/01/26/performance-quiz-12-the-cost-of-a-good-hash-solution.aspx)文章）。

工作方式`params`（动态生成新数组）意味着这确实不是一个好的通用解决方案。您最好使用每个字段的方法调用并将散列状态作为传递给它们的变量来维护（这使得使用更好的散列函数和雪崩变得容易）。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-12-25T10:49:38.163

除了 using 引起的问题外`params object[] fields`，我认为在某些情况下不使用类型信息也可能是性能问题。假设有两个类`A`，`B`具有相同类型和数量的字段并实现相同的接口`I`。现在，如果您将`A`和`B`对象放入`Dictionary<I, anything>`具有相同字段和不同类型的对象中，最终将在同一个存储桶中。我可能会插入一些声明，例如`hashCode ^= GetType().GetHashCode();`

Jonathan Rupp 接受的答案处理参数数组，但不处理值类型的装箱。因此，如果性能非常重要，我可能会声明`GetHashCodeFromFields`没有对象而是`int`参数，并且发送的不是字段本身，而是字段的哈希码。IE

```
public override int GetHashCode() 
{
    return this.GetHashCodeFromFields(field1.GetHashCode(), field2.GetHashCode());
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-01-08T00:16:32.607

可能出现的一个问题是当乘法达到 0 时，最终的 hashCode 始终为 0，正如我刚刚在以下代码中遇到的具有很多属性的对象一样：

```
hashCode *= _fieldPrimeNumber + fields[i].GetHashCode(); 
```

我建议：

```
hashCode = hashCode * _fieldPrimeNumber + fields[i].GetHashCode(); 
```

或与 xor 类似的东西，如下[所示](https://stackoverflow.com/a/21604191)：

```
hashCode = hashCode * _fieldPrimeNumber ^ fields[i].GetHashCode(); 
```

# iphone - UITextField 是空的吗？

> ID：763735
> 
> 赞同：1
> 
> 时间：2009-04-18T16:36:15.707
> 
> 标签：iphone, cocoa-touch

要知道 UITextField 是否为空，我使用了以下代码：

```
if ( [ [textField text] isEqualToString:@""] ) 
```

但不幸的是，它以某种方式无法判断文本字段是否为空。

还有哪些方法？

当 [textField text] 为空时，它等于 nil。

谢谢你。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-18T16:40:25.260

也许试试`[[textField text] length] == 0`？

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-18T16:40:27.740

```
[textField hasText] 
```

请参阅[参考资料](http://developer.apple.com/iPhone/library/documentation/UIKit/Reference/UITextView_Class/Reference/UITextView.html#//apple_ref/occ/instm/UITextView/hasText)。

# javascript - 如何在 JavaScript 中获取文本框的值

> ID：763745
> 
> 赞同：104
> 
> 时间：2009-04-18T16:41:24.990
> 
> 标签：javascript, html

我正在尝试使用 JavaScript 从 HTML 文本框中获取值，但值没有出现在空格之后

例如：

```
<input type="text" name="txtJob" value="software engineer"> 
```

我只得到：上面的“软件”。我正在使用这样的脚本：

```
var jobValue = document.getElementById('txtJob').value 
```

我如何获得全部价值：“软件工程师”？

* * *

## 回答 #1

> 赞同：79
> 
> 时间：2009-04-18T16:45:38.867

您的元素没有 ID，只有名称。因此，您可以使用`getElementsByName()`方法获取具有此名称的所有元素的列表：

```
var jobValue = document.getElementsByName('txtJob')[0].value  // first element in DOM  (index 0) with name="txtJob" 
```

或者您为元素分配一个 ID：

```
<input type="text" name="txtJob" id="txtJob" value="software engineer"> 
```

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2009-04-19T02:33:50.637

+1 Gumbo：“id”是访问页面元素的最简单方法。IE（8 之前的版本）如果找不到具有给定 ID 的任何内容，将返回具有匹配“名称”的内容，但这是一个错误。

> 我只得到“软件”。

id-vs-name 不会影响这一点；我怀疑发生的事情是（与示例代码相反）您忘记引用您的“价值”属性：

```
<input type="text" name="txtJob" value=software engineer> 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2011-07-30T20:44:58.753

```
var word = document.getElementById("word").value;//by id
or
var word = document.forms[0].elements[0].value;//by index
//word = a word from form input
var kodlandi = escape(word);//apply url encoding

alert(escape(word));
or
alert(kodlandi); 
```

您没有对表单中的输入值使用编码的问题，因此浏览器不会将这些值添加到...

ontop 作为 unicode 编码/解码操作存在一些问题，因此请使用此函数编码字符串/数组

```
function urlencode( str ) 
{
// http://kevin.vanzonneveld.net3\.    
// +   original by: Philip Peterson4\.    
// +   improved by: Kevin van Zonneveld (http://kevin.vanzonneveld.net)5\.    
// *     example 1: urlencode('Kevin van Zonneveld!');
// *     returns 1: 'Kevin+van+Zonneveld%21'7\. 
   var ret = str; 
   ret = ret.toString();
   ret = encodeURIComponent(ret);
   ret = ret.replace(/%20/g, '+');
   return ret;
}

ex.
var word = "some word";
word = urlencode(word); 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2015-09-14T05:29:58.517

```
<!DOCTYPE html>
<html>
<body>
<label>Enter your Name here: </label><br>
<input type= text id="namehere" onchange="displayname()"><br>

<script>
function displayname() {
    document.getElementById("demo").innerHTML = 
document.getElementById("namehere").value;
}

</script>

<p id="demo"></p>

</body>
</html> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-18T16:44:43.110

将 的`id`属性设置`input`为`txtJob`。当你打电话时，你的浏览器表现得很古怪`getElementById`。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-11-13T02:31:53.153

当您想要文本框值时提供。简单一：

```
<input type="text" value="software engineer" id="textbox">

var result = document.getElementById("textbox").value; 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-08-27T05:14:53.877

如果您使用的是 ASP.NET，即使您使用的是母版页，下面这些示例中的服务器端代码标记也将提供准确的控件 ID。

Javascript：

```
document.getElementById("<%=MyControlName.ClientID%>").value; 
```

查询：

```
$("#<%= MyControlName.ClientID %>").val(); 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-19T02:56:48.397

如果它是一种形式，那么它将是：

```
<form name="jojo">
<input name="jobtitle">
</form> 
```

然后你会用javascript说：

```
var val= document.jojo.jobtitle.value

document.formname.elementname 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2021-02-07T00:13:40.760

这是一个简单的方法

```
document.getElemmentByName("txtJob").getAttribute("value") 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-03-11T13:38:03.280

如果您正在使用任何用户控件并想要获取任何文本框值，那么您可以使用以下代码：

```
var result = document.getElementById('LE_OtherCostsDetails_txtHomeOwnerInsurance').value; 
```

这里，,`LE_OtherCostsDetails`是用户控件的名称，`txtHomeOwnerInsurance`是文本框的 id。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2016-02-14T18:52:13.413

问题是你犯了一个**小小的错误！**

这是我使用的 JS 代码：

```
var jobName = document.getElementById("txtJob").value; 
```

您不应该使用 name=""。而是使用 id=""。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-01-04T20:38:34.620

**您需要更改您的代码如下： -**

```
<html>
<body>
<div>
<form align="center" method=post>
    <input id="mainText" type="text" align="center"placeholder="Search">

    <input type="submit" onclick="myFunction()" style="position: absolute; left: 450px"/>
</form>
</div>
<script>
function myFunction(){
    $a= document.getElementById("mainText").value;
    alert($a);
        }
</script>
</body>
</html> 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2017-01-20T11:50:38.267

因为您在软件工程师 html/php 之间使用了空格，所以不支持文本框下的值之间的空格，您必须使用此代码 **`<input type="text" name="txtJob" value=software_engineer>`** 它会起作用

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2017-09-30T15:29:16.257

```
 var jobValue=document.FormName.txtJob.value; 
```

试试上面的代码。

jobValue : 变量名。
FormName : html 中的表单名称。
txtJob : 文本框名称

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2017-11-20T13:57:08.603

使用 jquery 应该很简单：

HTML：

```
 <input type="text" name="txtJob" value="software engineer"> 
```

JS：

```
 var jobValue = $('#txtJob').val(); //Get the text field value
  $('#txtJob').val(jobValue);        //Set the text field value 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2018-02-26T07:18:44.003

为文本框设置 id。IE，

```
<input type="text" name="txtJob" value="software engineer" id="txtJob"> 
```

在 JavaScript 中

```
var jobValue = document.getElementById('txtJob').value 
```

在jQuery中

```
 var jobValue =  $("#txtJob").val(); 
```

# jquery - jQuery 选择器

> ID：763748
> 
> 赞同：0
> 
> 时间：2009-04-18T16:43:50.883
> 
> 标签：jquery

我有一个简单的 jQuery 选择器，它可以选择所有没有 noValidate 类的链接。如果我在一个项目上只有一个类，它会很好，但是如果我添加第二个类，它将不再找到该类。如何轻松检查该类是否包含 noValidate 而不是等于它。

电流选择器

```
$("a[class!=noValidate]").click(function() {
    //Magic Happens
}); 
```

适用于：

```
<a href="#" class="noValidate"> 
```

失败

```
<a href="#" class="noValidate className2"> 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T16:51:22.970

你有什么理由标记那些不应该被验证的链接而不是那些应该被验证的链接？第二种方法会容易得多，但是如果您需要坚持这一点，那么您可以执行以下操作：

```
$('a:not(.noValidate)').click(...); 
```

这是使用[`not`](http://docs.jquery.com/Selectors/not#selector)选择器并且只选择没有类“noValidate”的链接。jQuery 内部要获取页面中的所有链接，看是否有类，效率不高。理想情况下，您只需为*应该*验证的链接提供一个类，然后您可以执行以下操作：

```
$('a.validate').click(...); 
```

好多了，不是吗？也快得多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T16:50:53.597

尝试：

```
$("a:not(a[class*=noValidate])").click(function() { }); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T16:54:54.117

您可以使用[`not`](http://docs.jquery.com/Selectors/not)选择器：

```
$("a:not(.noValidate)").click(function() {
    //Magic Happens
}); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T16:48:25.567

你能反其道而行之吗？

```
$("a:not[.noValidate]").click(...);
// or

$("a").click(function() {
    //Magic Happens
});
var noValidateEvents = $("a.noValidate").data("events");
$("a.noValidate").unbind('click', noValidateEvents.click[0]); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T16:51:06.963

更改您的选择器以执行此操作：

```
"a:not([class^='noValidate'])" 
```

将匹配任何具有以**开头**的**`^=`**类属性的元素，并且包装它将否定匹配。 **`"noValidate"`**`not()`****

 **如果该类`"noValidate"`可能位于字符串中的不同位置，请尝试以下操作：

```
"a:not([class*='noValidate'])" 
```

这将匹配字符串中的任何位置。最后一种方法更危险，因为你有更大的潜力无意中匹配其他东西。

# c - 指定的初始化器和省略的元素

> ID：763763
> 
> 赞同：6
> 
> 时间：2009-04-18T16:52:17.617
> 
> 标签：c

谁能解释一下关于指定初始化程序的以下行：

> 初始化器列表可以省略在聚合中任何位置声明的元素，而不仅仅是在末尾。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-18T17:06:26.897

如果您使用传统的初始化列表，则元素的值是按顺序分配的，所以如果您有这个结构：

```
typedef struct _foo {
  int a;
  int b;
} foo_t; 
```

然后这个初始化器显式分配`a`而不是`b`：

```
foo_t value = { 7 }; 
```

没有指定的初始化器，唯一可以省略的元素是最后声明的元素

使用指定的初始化器，您可以省略在任何地方声明的元素：

```
foo_t value = { .b = 8 }; 
```

`value.a`因此，尽管是结构中的第一个值，但省略了初始化器。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T16:57:03.330

试试这个[链接](http://publib.boulder.ibm.com/infocenter/comphelp/v8v101/index.jsp?topic=/com.ibm.xlcpp8a.doc/language/ref/designators.htm)。

这个想法是能够在初始化期间引用复杂类型的成员，如结构。例如

```
struct s {
   int a, b;
};

int main() {
  struct s = { .b = 42, .a = -42 };
  return 0;
} 
```

指定值时与顺序无关，从而获得了灵活性。请记住，这是添加到 C99 标准中的，并且可能不受不完全支持 C99（或不支持该标准的早期版本）的编译器支持。

# django - 用于 django 应用程序的 nginx + FastCGI --- 运行两个网络服务器还是一个？

> ID：763764
> 
> 赞同：6
> 
> 时间：2009-04-18T16:53:41.343
> 
> 标签：django, deployment, nginx, fastcgi, web-deployment-project

我即将在 nginx Web 服务器上部署一个 Django 应用程序，并希望确保我正确构建了系统。

如果您在 apache 服务器上部署 Django，那么您仍然应该在应用程序前面放置一个 nginx 服务器来提供静态文件，这似乎是一种普遍的看法，在这种情况下，nginx 的性能更高。

如果不是 apache 用于 Django 代码，我想使用 nginx + FastCGI 来托管 Django 应用程序，是否有任何理由将第二个 nginx 安装配置为位于提供动态内容的 nginx 服务器前面，以处理静态内容以及重定向到动态内容？

具体来说，静态和动态内容是否会有不同的配置参数，这会让我想要将服务器分开，或者我可以将它们全部托管在单个 nginx 安装中，其中一些 URL 被映射到 django 内容，并且休息被映射到从同一个 nginx 安装服务的静态内容？

谢谢你的建议！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-19T15:11:02.220

大多数配置指令可以存在于位置块中（即，它们不是仅全局的），并且这样做很常见。仅使用 1 个 nginx 实例设置它应该没有问题。

这样做的好处之一是您可以最初以这种方式设置它，然后通过切换位置块以传递到后端服务器来改变主意，而外部世界不可见。

因此，现在继续在一台服务器上执行此操作，知道您可以稍后在需要扩展时放入后端服务器或集群。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T21:22:44.437

要回答您关于将 nginx 服务器放在另一个 nginx 前面的问题：不，通常没有充分的理由这样做。这个旧建议来自 Apache，尤其是当 mod_python 与 Apache prefork MPM 一起使用时。在此设置中，每个 Django 实例都将作为一个单独的进程在 mod_python / Apache 容器内运行，这将使用大量 RAM。这个想法是通过在繁重的 Apache 进程前面放置一个轻量级事件驱动的 HTTP 服务器（如 nginx）来保持静态文件服务远离 Apache。这节省了 RAM 并提高了性能。当对所有请求使用像 nginx 这样的轻量级服务器时，这不是问题。

nginx 对 URL 重写有很好的处理，查看 Rewrite 模块。

您的问题没有说明您期望的负载（连接数/秒），或者您为什么要首先使用 nginx。如果这是用于 VPS 服务器上的博客或类似的低负载设置，那么请考虑在守护程序模式下将 Apache 与 mod_wsgi 一起使用。这具有非常接近 FastCGI 的性能和 RAM 使用率，并且 mod_wsgi 最近成为托管 Django 的官方推荐方式，请参阅 [http://docs.djangoproject.com/en/dev/howto/deployment/modwsgi/](http://docs.djangoproject.com/en/dev/howto/deployment/modwsgi/)

一般来说，如果可能的话，我会建议使用 Apache / mod_wsgi，这是一个稳定而灵活的组合。确保您没有通过使用 Apache + mod_wsgi 可以做得很好的 nginx“过早优化”。有关守护程序模式下 mod_wsgi 的性能概述，请参阅： [http ://code.google.com/p/modwsgi/wiki/PerformanceEstimates](http://code.google.com/p/modwsgi/wiki/PerformanceEstimates)

nginx 很棒，但对于 Django 解决方案，恕我直言，nginx 更适合作为许多 Apache 实例的负载均衡器，或者用于静态文件的单独服务器。这两种使用场景都只对大负载有意义。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-19T23:11:51.410

我会说代理 django 到它自己的服务器只有在你使用 mod_python 滚动时才真正出现，即：使用 nginx 提供静态服务并将 django 代理到运行 mod_python 的 apache 实例。我很高兴通过 fastcgi 在 lighttpd 中运行 django，同样的 lighttpd 也提供静态内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T23:11:18.283

我确信可以使用一台 nginx 服务器在一个配置文件中配置所有动态和静态内容

# sql-server - Unexpected performance results comparing INT to BIGINT for IDENTITY columns

> ID：763773
> 
> 赞同：4
> 
> 时间：2009-04-18T17:04:35.917
> 
> 标签：sql-server, performance

I have been asked to perform a performance test using SQL Server 2008\. As part of this, I am comparing the speed of IDENTITY columns as PKs using INTs and BIGINTs. I have a simple routine to create 100,000 rows for each type and time the insert speed. The script looks like this:

```
SET NOCOUNT ON

CREATE TABLE TestData
(
    PK      INT IDENTITY PRIMARY KEY,
    Dummy   INT
)

DECLARE @Rows   INT
DECLARE @Start  DATETIME

SET @Rows = 100000
SET @Start = GETDATE()

WHILE @Rows > 0
BEGIN
    INSERT INTO TestData (Dummy) VALUES (@Rows)
    SET @Rows = @Rows - 1
END

SELECT @Start, GETDATE(), DATEDIFF(MS, @Start, GETDATE())

DROP TABLE TestData 
```

For testing BIGINT identities, I use a very slightly modified version:

```
SET NOCOUNT ON

CREATE TABLE TestData
(
    PK      BIGINT IDENTITY PRIMARY KEY,
    Dummy   INT
)

DECLARE @Rows   INT
DECLARE @Start  DATETIME

SET @Rows = 100000
SET @Start = GETDATE()

WHILE @Rows > 0
BEGIN
    INSERT INTO TestData (Dummy) VALUES (@Rows)
    SET @Rows = @Rows - 1
END

SELECT @Start, GETDATE(), DATEDIFF(MS, @Start, GETDATE())

DROP TABLE TestData 
```

To my surprise, the BIGINT version runs appreciably faster than the INT version. The INT version on my test kit takes about 30 seconds and the BIGINT about 25 seconds. Granted the test kit has a 64-bit processor. However, it is running 32-bit Windows and 32-bit SQL Server 2008.

Can anyone else recreate, deny, confirm or contest the results or point out if I have missed something?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-08T13:14:03.167

To take it a step further, do the same thing with a VARCHAR, such as this:

```
SET NOCOUNT ON

CREATE TABLE TestData
(
    PK          VARCHAR(8) PRIMARY KEY,
    Dummy       INT
)

DECLARE @Rows   INT
DECLARE @Start  DATETIME

SET @Rows = 100000
SET @Start = GETDATE()

WHILE @Rows > 0
BEGIN
    INSERT INTO TestData (PK, Dummy) VALUES (CONVERT(VARCHAR(8), @Rows), @Rows)
    SET @Rows = @Rows - 1
END

SELECT @Start, GETDATE(), DATEDIFF(MS, @Start, GETDATE())

DROP TABLE TestData 
```

I would expect this to be much slower, since the script is determining the "identity" column, and there are string conversions. Also, I made the VARCHAR(8) to match the number of bytes with a bigint. Yet, in my tests, this runs faster that the INT test from above.

What I take from this is that inserting records into an empty table will be pretty fast no matter what you throw at it. The implications of performance down the road, i.e. other indexes on the table, inserting rows when the table already has a lot of data, etc. is probably a much more important consideration.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-30T16:43:38.917

**Server1** - 在 SQL2005 SP3 64 位上......我刚刚尝试过（INT 然后 BIGINT）并得到 2.9 和 2.6 秒。然后将行增加到 500000 我得到了 15.2 和 15.3 秒。

*   更多 500K INT/BIGINT 运行：14.0/14.6s；14.0/15.3s；和 14.7/15.3 秒。所以 INT 比 BIGINT 快 5.8%。
*   将订单反转为 BIGINT/INT：15.4/13.8s；15.3/15.4s；和 12.9/12.7 秒。INT 在这里要快 4%。

**Server2** - 在 SQL2000 SP4 EE...

*   INT/BIGINT：13.7/10.9s；10.4/13.9s；9.9/10.2 秒。INT 快 2.9%。
*   然后切换到BIGINT/INT：10.2/13.3s；10.2/10.1s；和 11.2/10.0s。BIGINT 快 5.7%。

基本上 INT 通常但并不总是比 BIGINT 快，*但不是任何接近我在运行中看到的差异的东西。*

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-19T02:35:26.120

我在我的 SQL2008 上试过了。INT 需要 14 秒。BIGINT 需要 18 秒。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T19:29:37.363

只是一个猜测：你有没有尝试过先测试 BIGINT，然后再测试 INT？数据库服务器喜欢将东西保存在内存中以优化类似的操作......

# xcode - Formatting integer for string output

> ID：763774
> 
> 赞同：1
> 
> 时间：2009-04-18T17:04:47.057
> 
> 标签：xcode, debugging

In a breakpoint action, I'm going this:

```
@(const char *)[(NSString*)[myobject retainCount]UTF8String]@ 
```

which gives this output:

```
<Error: Cannot access memory at address 0x2> 
```

If I do this:

```
@(NSString*)[myboject retainCount]@ 
```

it outputs a memory address. But if I do this in code:

```
NSLog(@"retain count is: %d", [myobject retainCount]); 
```

it gives this output:

```
2009-04-18 09:58:48.085 myapp[80277:20b] retain count is: 1 
```

What is the syntax needed to output correctly in the breakpoint action?

Also, where can I find a complete listing of the format keys for breakpoint actions?

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T18:26:07.330

您应该能够在“日志”操作上实际使用“调试器命令”断点操作，将命令文本设置为：

`p (int)[myObject retainCount]`

如果你想记录一个 Objective-C 对象的描述：

`po myObject`

如果需要，您可以在它之前使用 Log 操作来显示一条消息，指示正在打印的内容。

至于您在这种情况下记录的特定保留计数问题，直接检查保留计数并尝试以这种方式解决与内存相关的错误并不是一个好习惯。请参阅[这篇文章](http://stac.koverflow.com/questions/656902/nsnumber-retain-count-issue/656965#656965)以获得关于此的一个很好的解释。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-19T14:02:40.480

retainCount 返回一个数字。简单地将其转换为字符串是不正确的，因为它是一个数字，而不是一个字符串。要将数字打印为字符串，您必须调用：

```
printf("%d",[myobject retaincount]); 
```

或打印出这个字符串：

```
[NSString stringWithFormat:@"%d",[myobject retaincount]]; 
```

# .net - 通过 WiX 3 检测程序集是否在 GAC 中？

> ID：763781
> 
> 赞同：2
> 
> 时间：2009-04-18T17:08:47.407
> 
> 标签：.net, installation, wix, windows-installer, wix3

我想在 WiX 3（最好通过条件）中检测特定程序集是否在 GAC 中。我知道该程序集的名称、版本和公钥令牌。有没有内置的方法可以做到这一点，还是我必须编写一个 CustomAction 来做到这一点？我将如何设置 CustomAction？（这将在安装开始之前。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T17:30:29.443

您可以使用[FileSearch](http://wix.sourceforge.net/manual-wix2/wix_xsd_filesearch.htm)在 %windir%\assembly\GAC （如果您知道所有其他值）中搜索文件，这有点麻烦，但可以。
完整的文件路径将存储在一个属性中，您可以在安装开始之前使用该属性。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-04T20:41:59.000

需要小心。程序集不仅可以安装在 %windir%\assembly\GAC 文件夹中。我的程序集最常安装在 %windir%\assembly\GAC_MSIL 中。只需搜索 %windir%\assembly\ 就可以了。

# java - DataNucleus：提交事务时如何自动执行操作？

> ID：763792
> 
> 赞同：2
> 
> 时间：2009-04-18T17:17:50.037
> 
> 标签：java, persistence, jdo, datanucleus

考虑使用具有以下持久性结构的 DataNucleus 的应用程序：

你有一个类，它有两个属性，比如*created* (Date) 和*lastUpdate* (Date)： 当要提交这个类的对象时，你如何自动用适当的值填充这些属性？适当的值将在将对象插入数据库时​​将*created*和*lastUpdate*都设置为当前时间，并在它发生更改时仅更新*lastUpdate 。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T18:26:48.747

我现在自己想通了。

您需要创建一个[InstanceLifecycleListener](http://db.apache.org/jdo/api20/apidocs/javax/jdo/listener/InstanceLifecycleListener.html) ...

```
public class BasicEntityLifecycleListener implements StoreLifecycleListener {

    public void postStore(InstanceLifecycleEvent evt) {
    }

    public void preStore(InstanceLifecycleEvent evt) {
        if((PersistenceCapable)evt.getSource() instanceof BasicEntity) {
            BasicEntity obj = (BasicEntity)evt.getSource();
            Date now = new Date();
            if(JDOHelper.isNew(obj))
                obj.setCreated(now);
            obj.setLastUpdate(now);
        }
    }
} 
```

然后在你的 PersistenceManager 中注册它......

```
PersistenceManager pm = pmf.getPersistenceManager();
pm.addInstanceLifecycleListener(new BasicEntityLifecycleListener(), null); 
```

我在[DataNucleus Access Plattorm 手册](http://www.datanucleus.org/products/accessplatform_1_1/datanucleus-accessplatform.pdf)中找到了解决方案，直到现在我才知道。在线手册对我来说似乎有点复杂。

# ruby - 从 Ruby 中的 RSS 源获取日期

> ID：763793
> 
> 赞同：3
> 
> 时间：2009-04-18T17:18:55.743
> 
> 标签：ruby, rss

我正在按照[http://www.rubyrss.com/](http://www.rubyrss.com/)上的说明解析来自 craigslist.org 的提要：

[http://seattle.craigslist.org/sof/index.rss](http://seattle.craigslist.org/sof/index.rss)

一切似乎都运行良好，但是当我无法从解析的对象中获取任何日期时：

```
irb(main):010:0> rss.date
NoMethodError: undefined method `date' for #<RSS::RDF:0x2c412b8>
        from (irb):10
irb(main):011:0> rss.channel.date
NoMethodError: undefined method `date' for #<RSS::RDF::Channel:0x2c406ec>
        from (irb):11
        from :0
irb(main):012:0> rss.items[0].date
NoMethodError: undefined method `date' for #<RSS::RDF::Item:0x2cdc290>
        from (irb):12
        from :0
irb(main):013:0> rss.items[1].date
NoMethodError: undefined method `date' for #<RSS::RDF::Item:0x2cd04a4>
        from (irb):13
        from :0 
```

我在这里做错了什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-24T18:51:54.227

你真的应该切换库。我建议使用[Feedzirra](http://github.com/pauldix/feedzirra/tree/master)。它的方式，方式，方式更快，并且得到积极维护。

```
require "feedzirra"
feed = Feedzirra::Feed.fetch_and_parse("http://seattle.craigslist.org/sof/index.rss")
feed.entries.first.published
# => Fri Apr 24 18:27:28 UTC 2009 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T19:28:52.500

使用 Firefox 查看 rss 提要，以便您可以轻松查看提要的结构。日期项目使用“都柏林核心”表示`<dc:date>`

试试这个：

```
require 'rss/dublincore'
rss.items[3].dc_date  #=>  Sat Apr 18 01:02:11 -0400 2009 
```

[Ruby rss parser reference](http://www.cozmixng.org/~rwiki/?cmd=view;name=RSS+Parser%3A%3AReference.en)和[Dublin Core](http://dublincore.org/)中的更多详细信息 。

# powershell - 将所有函数从某个目录加载到 PowerShell

> ID：763799
> 
> 赞同：16
> 
> 时间：2009-04-18T17:25:33.450
> 
> 标签：powershell

假设您是一名系统管理员，他使用 PowerShell 来管理他/她系统上的许多事情。

您可能已经编写了很多函数来执行您经常需要检查的事情。但是，如果您必须经常四处走动，经常使用不同的机器等等，您必须一次又一次地重新输入所有功能才能使用它们。由于某种原因，我什至每次退出并重新启动 PowerShell 时都必须这样做，因为它不会记住这些功能......

我写了一个函数来为我做这件事。我在这里发布它是因为我想确定它是万无一失的。函数本身存储在 中`allFunctions.ps1`，这就是为什么我将它排除在代码中的原因。

基本思想是你有一个文件夹，你可以在其中存储所有 ps1 文件，每个文件都包含一个函数。在 PowerShell 中，转到该目录，然后输入：

```
. .\allFunctions.ps1 
```

该脚本的内容是这样的：

```
[string]$items = Get-ChildItem -Path . -Exclude allFunctions.ps1
$itemlist = $items.split(" ")
foreach($item in $itemlist)
{
    . $item
} 
```

该脚本将首先收集您目录中的每个文件，这意味着您也可能在其中拥有所有非 ps1 文件。allFunctions.ps1 将被排除。

然后我根据空格对长字符串进行拆分，也就是这里常用的分隔符。然后我使用 Foreach 循环运行它，每次都将函数初始化到 PowerShell 中。

假设你有 100 多个函数，但你永远不知道哪些需要，哪些不需要？为什么不将它们全部输入而不是吹毛求疵？

所以我想知道，这里有什么问题？我希望这真的很安全，因为我可能会经常使用它。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-18T18:58:51.837

将它们包含在您的 PowerShell 配置文件中，以便每次启动 PS 时它们都会自动加载。

查看[Windows PowerShell 配置文件](http://msdn.microsoft.com/en-us/library/bb613488(VS.85,loband).aspx)以获取有关在何处找到您的配置文件脚本的详细信息。

PS 将您的个人资料默认为“我的文档”文件夹。我的在网络驱动器上，所以无论我在哪里登录，PowerShell 都指向同一个配置文件文件夹。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-23T21:08:41.643

您可以以更简单的方式执行此操作。我的个人资料中有这个：

```
##-------------------------------------------
## Load Script Libraries
##-------------------------------------------
Get-ChildItem ($lib_home + "*.ps1") | ForEach-Object {& (Join-Path $lib_home $_.Name)} | Out-Null 
```

其中 $lib_home 是一个文件夹，用于存储我要自动包含的脚本。在这种情况下，它会执行它们。所以我让脚本定义了全局函数。您也可以点源它们（将“&”替换为“.”）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-18T17:36:17.543

功能方面我认为有几种方法可以改进你的脚本。

首先是您的脚本依赖于脚本的名称不变。虽然我认为您不太可能更改此脚本的名称，但您永远不知道几年后您会是什么样的心情。相反，为什么不只是动态计算脚本的名称。

```
$scriptName = split-path -leaf $MyInvocation.MyCommand.Definition 
```

下一个问题是，如果您将目录放在包含空格的路径中，我相信您的拆分功能将失败。它将导致像“c:\foo bar\baz.ps1”这样的路径显示为“c:\foo”、“bar\baz.ps1”。最好删除拆分并仅使用 get-childitem 命令的枚举。

此外，您还依赖于当前路径，即包含脚本的路径。您应该将其设为显式参数或使用包含 allFunctions.ps1 文件的路径（我更喜欢后者）

这是我将使用的更新版本。

```
$scriptName = split-path -leaf $MyInvocation.MyCommand.Definition
$rootPath = split-path -parent $MyInvocation.MyCommand.Definition
$scripts = gci -re $rootPath -in *.ps1 | ?{ $_.Name -ne $scriptName }
foreach ( $item in $scripts ) {
  . $item.FullName
} 
```

从安全的角度来看，您必须考虑恶意用户将错误脚本添加到目标目录的可能性。如果他们这样做，它将与您的 allFunctions.ps1 文件一起执行，并可能损坏计算机。但是，当恶意用户可以访问您的文件系统时，他们可能会在没有您的脚本帮助的情况下造成损害，因此这可能是一个小问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-12-31T12:48:59.953

我在我的 PowerShell 4 和以下两行`Microsoft.PowerShell_profile.ps1`：

```
$modules = $env:USERPROFILE + "\..\*.psm1"
Import-Module $modules 
```

另外：[创建高级模块的教程](http://blogs.technet.com/b/heyscriptingguy/archive/tags/build+your+own+cmdlet/default.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-28T01:09:55.403

简单的解决方案：

```
$Path - file location
$Name - exluded file

Get-ChildItem -Path $Path | Where {$_.psIsContainer -eq $false}|Where { $_.Name -like "*.ps1" }|Where { $_.Name -ne $Name }|foreach-object -process {.$_.FullName}|out-null

read all object|file only| powershell file only|exclude file $Name| run ...|out-null 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-02-22T20:53:41.123

另一种解决方案是将函数组合到一个模块 (psm1) 文件中，然后使用 Import-Module 命令导入该文件。您可以如上所述将 Import-Module 命令添加到您的配置文件中，但语法要简单得多。

一个简单的开始方法是在 WindowsPowerShell 目录中创建一个名为 Modules 的文件夹。在该文件夹中，使用您的模块名称创建另一个文件夹。您的 psm1 文件保存在这里。然后将 Import-Module ModuleName.psm1 添加到您位于 WindowsPowerShell 目录中的配置文件中。如果您想使用不同的配置文件或将模块保存在另一个位置，则需要相应地操作路径。

另一个技巧是对模块文件中的每个函数使用 Export-ModuleMember FunctionName。这将掩盖您可能将其分发给的最终用户的支持功能。

# sql - 如何允许在 Oracle 中更新视图的结果？

> ID：763802
> 
> 赞同：0
> 
> 时间：2009-04-18T17:27:55.270
> 
> 标签：sql, oracle, plsql

我知道数据库视图是只读的，或者默认情况下至少是只读的。

是否可以启用oracle视图带来的数据变化？

**改写：**如果我只查看一个表，只是为了隐藏一些列，对这个数据的更改会在表上更新吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-18T17:33:35.630

是的，可以修改 Oracle 视图。

但是，有一些限制：

*   [包含集合运算符、聚合、GROUP BY、DISTINCT 和连接（通常）的视图](http://docs.oracle.com/cd/B28359_01/server.111/b28318/triggers.htm#CNCPT1684)是不可修改的
*   只有[一些连接视图](http://docs.oracle.com/cd/B28359_01/server.111/b28310/views001.htm#i1006232)是可修改的

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T17:30:14.017

我不相信默认情况下 Oracle 视图是只读的……单个表视图应该是可更新的，前提是它不包含 DISTINCT 或 GROUP BY 等多行操作。相关用户必须已被授予 UPDATE VIEW 权限。

如果您有权限更新有问题的视图，则删除列的简单视图绝对应该是可更新的...

```
GRANT UPDATE ON your_view_name TO your_user; 
```

当您尝试运行 UPDATE 语句时遇到什么错误？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T21:30:05.250

在 oracle 中，视图不包含它自己的基础数据。因此，如果您的视图允许更新，则基础表将被更新。

如果您需要更多信息，值得查看 Oracle 概念指南中的“视图”部分。

[http://download.oracle.com/docs/cd/B19306_01/server.102/b14220/schema.htm#sthref787](http://download.oracle.com/docs/cd/B19306_01/server.102/b14220/schema.htm#sthref787)

更多信息也可以在“创建视图”sql 命令中找到。

[http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_8004.htm#SQLRF01504](http://download.oracle.com/docs/cd/B19306_01/server.102/b14200/statements_8004.htm#SQLRF01504)

希望这可以帮助

问候

# c# - 类似于 Joomla/Mambo/Drupal 的 c# 操作系统项目中有哪些替代方案？

> ID：763803
> 
> 赞同：4
> 
> 时间：2009-04-18T17:27:57.890
> 
> 标签：c#, asp.net, drupal, joomla

我正在与一个客户开始一个项目来构建一个 Web 应用程序，但我对使用哪种解决方案有点困惑。

过去我曾为许多客户使用过 Joomla，但这个客户有特定的要求，我知道我将不得不自己构建。

我面临的问题是我在 .NET 范围内全职工作，虽然我是 PHP 的新手开发人员，而且我已经研究 Joomla 的插件架构大约一个月了，但我更喜欢构建ASP.NET 中的东西比我在 PHP 中的东西。

**我的问题是，有哪些 OS 项目具有与 Joomla/Mambo/Drupal 类似的社区，以及类似于 Joomla 的插件架构？**

我真的没有时间在 ASP.NET 中构建一个完整的 CMS 系统，但是如果已经存在可以给我 X%（25%、50% 等）的 Joomla 所拥有的东西，那至少会得到我在正确的道路上。如果在 ASP.NET 领域没有可比的东西，Joomla 有太多的扩展和太多的社区支持，我无法通过它。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T16:26:46.367

N2 看起来不错，不过我没用过：http: [//n2cms.com/](http://n2cms.com/)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-07T22:45:44.193

除了上面提到的 N2（我是它的忠实粉丝）之外，还有一个选项（对于真正勇敢的人！）使用 Phalanger 编译器在 .Net 上运行 Drupal——它需要 Phalanger 的多个补丁和至少一个修复 Drupal 本身（准确地说是会话 cookie 处理的东西）。作为奖励，您将获得性能下降以及 .Net 开发工具的所有优点。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-18T17:48:48.870

我已经使用（并且正在努力）[DotNetNuke](http://www.dotnetnuke.com/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-20T16:00:30.110

还有[Umbraco](http://umbraco.org/)，我听说过很好的事情:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-26T10:36:43.837

看看[凯霍加](http://www.cuyahoga-project.org/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-05-01T13:23:25.267

可能值得一看[Graffiti](http://graffiticms.com/)

虽然它不是开源的，但它是基于 .NET 的，并且具有简单的主题引擎和插件架构。它不像 Drupal 那样拥有庞大的追随者，但它的设置相当简单，并且在扩展它时适合您当前的技能。

**更新**：涂鸦现在是开源的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-20T16:04:43.253

有[mojoPortal](http://www.mojoportal.com)。

它似乎不像 DotNetNuke 那样“大”（例如），但它有很多功能：

*   博客、论坛、活动日历、谷歌地图、图片库、电子商务、安全文件共享、时事通讯、调查、投票、

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-20T16:12:21.830

Telerik 有一个社区版的[SiteFinity](http://www.telerik.com/products/sitefinity.aspx) CMS 系统。虽然我在 RadControls 方面拥有丰富的经验，但我不能保证 SiteFinity。不过，这可能值得一试，因为 Telerik 对其产品有很大的支持。

这可能是一个更大的延伸，但 Rob Connery（SubSonic 的家伙）[MVC StoreFront](http://blog.wekeroad.com/kona/kona-1/)具有良好的 CMS / 内容发布功能，具有插件架构。他发布了一系列围绕其功能的截屏视频。[Rob 对MIX](http://videos.visitmix.com/MIX09/T62F)的功能进行了预览。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-26T10:26:14.720

Umbraco 很棒。它使用一个类似的节点结构来实现 drupal，并且非常容易通过自定义用户控件或 XSLT 进行扩展。此外，我发现我的客户不是最懂计算机的人，他们发现 umbraco 界面易于使用。

# c# - 如何在数据网格中填写 RSS 提要？

> ID：763805
> 
> 赞同：1
> 
> 时间：2009-04-18T17:30:11.347
> 
> 标签：c#, asp.net, rss

我正在使用 .net c#，我想用 rss 提要填充数据网格。

问题是

当我将 rss 馈送返回到数据集时，我得到了多个存储不同数据的表。

意味着我想用“标题”和“图片”填充网格这是我的代码示例

```
protected void Button1_Click(object sender, System.EventArgs e)
{
   XmlTextReader reader = new XmlTextReader(txtUrl.Text); 
   DataSet ds = new DataSet();
   ds.ReadXml(reader);
   myDataGrid.DataSource = ds.Tables[2] ; 
   myDataGrid.DataBind(); 
} 
```

有关标题和描述以及发布日期的所有详细信息都位于表​​#2 中，相关图像和图像相关信息的大小存储在表#3 中，所以我怎么能感觉到这两列的网格？

提前致谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T17:47:52.210

我建议您尝试[RSS Tookit](http://www.codeplex.com/ASPNETRSSToolkit)。它是开源的，可以很好地处理 RSS 提要。您可以像这样轻松地绑定到 RSS 提要：

```
<ast:RssDataSource id="RssDataSource1" runat="server" maxitems="5" url="http://news.google.com/?output=atom"></ast:RssDataSource>
<asp:GridView ID="GridView1" runat="server" AutoGenerateColumns="False" DataSourceID="RssDataSource1">
  <Columns>
    <asp:HyperLinkField DataNavigateUrlFields="link" DataTextField="link" HeaderText="Link"/>
    <asp:BoundField DataField="title" HeaderText="Title" SortExpression="title" />
  </Columns>
</asp:GridView> 
```

来源取自[此页面](http://aspnetrsstoolkit.codeplex.com/Wiki/View.aspx?title=Consuming%20With%20RssDataSource&referringTitle=Home)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-19T08:10:48.657

或者，您可以只使用内置的**XmlDataSource**。

```
<asp:XmlDataSource id="XmlDataSource1" runat="server" XPath="/channel/item" DataFile="rssFeed.xml" />

<asp:GridView ID="GridView1" runat="server" AutoGenerateColumns="False" DataSourceID="XmlDataSource1">
  <Columns>
    <asp:BoundField DataField="title" HeaderText="Title" SortExpression="title" />
    <asp:BoundField DataField="description" HeaderText="Description" />
  </Columns>
</asp:GridView> 
```

我知道我给出的示例是针对 GridView 的，但我认为同样的原则也适用于 DataGrids。XPath 表达式采用 RSS 2.0。

# performance - 简单的 MySQL 查询需要很长时间

> ID：763815
> 
> 赞同：0
> 
> 时间：2009-04-18T17:37:54.857
> 
> 标签：performance, mysql

我们正在为一堆游戏运行一个统计站点，但是在日志超过 100 兆时，事情开始变慢，所以我们需要优化我们的查询。

然而，我们发现我们认为是一个简单的查询，大约需要 1.5 秒：

```
SELECT handle,
(
    SELECT COUNT(*)
    FROM kills
    WHERE killer=p.handle
    AND k_team != c_team
    AND gid=p.gid
) AS kills
FROM players as p
WHERE  gid="3245"
AND team="axis"
ORDER BY kills DESC LIMIT 0, 10; 
```

这会为其中一个团队生成一个结果列表。

桌杀和玩家分别由 36000 和 4000 行组成。

为什么该查询需要这么长时间以及如何优化？我们是否应该研究 JOIN？

最好的问候， 拉卡

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T17:50:18.820

一般来说，MySQL 执行连接的速度比子选择快。要了解如何优化查询，我建议阅读[EXPLAIN](http://dev.mysql.com/doc/refman/5.0/en/explain.html)语法。

首先，确保你的 kills 表有一个关于 killer 和 gid 的复合索引，然后尝试这个连接：

```
SELECT p.handle, COUNT(*) AS n_kills
来自玩家 p
    加入杀死k
    ON p.handle = k.killer
        和 p.gid = k.gid
其中 p.gid = 3245
    和 p.team = "轴"
    AND k.k_team != k.c_team
GROUP BY p.handle
ORDER BY n_kills DESC LIMIT 0,10

```

查看这两个表的 CREATE TABLE 语句将有助于确定索引的任何问题。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T17:42:51.553

您是否尝试过在`kills`表格`killer`列上放置索引？

**编辑**索引信息。[http://www.w3schools.com/Sql/sql_create_index.asp](http://www.w3schools.com/Sql/sql_create_index.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T17:44:10.160

是的，您绝对应该研究联接。从您发布的代码段中很难看出，但只要您可以在子查询上使用连接，这样做将是有益的。

您可能还需要考虑在数据库中的其他位置缓存杀死计数；特别是如果您使用 InnoDB，COUNT() 操作比简单地从数据库中选择 [相对] 最近的值需要更多时间。您可以通过增加适当记录上的杀戮计数或类似的东西在代码中轻松实现这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T17:45:59.860

尝试：

```
SELECT handle, count(*) as kills
FROM players as p
JOIN Kills as k ON k.gid = p.gid
WHERE  gid="3245"
AND team="axis"
ORDER BY kills DESC LIMIT 0, 10; 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-18T18:36:28.943

根据我的经验，限制中的偏移量（LIMIT 0,10）是性能杀手。如果您不限制并循环通过仅提取前十个记录行的资源，那么它将大大加快查询速度。为什么？您不会获取全部资源，只是将资源指针移到资源的末尾。只有前十行受到影响，其他行被丢弃。不管资源有多大。就试一试吧。你会看到的！

即在PHP中

```
$res=mysql_query("SELECT handle,
(
    SELECT COUNT(*)
    FROM kills
    WHERE killer=p.handle
    AND k_team != c_team
    AND gid=p.gid
) AS kills
FROM players as p
WHERE  gid="3245"
AND team="axis"
ORDER BY kills DESC;");

$i=0;
$results = array();
while($row=mysql_fetch_array($res)){
if($i<10){
  $results[] = $row;
}
$i++;
} 
```

只有LINUX！

视窗：

```
$i=0;
$results = array();
while($row=mysql_fetch_array($res)){
    if($i<10) {      
      $results[] = $row;
    } else {        
        mysql_close($db);
        break;
    }
     $i++;

} 
```

假设 indeces 设置得很好。

# com - 大多数对象不支持 COM 聚合吗？

> ID：763818
> 
> 赞同：5
> 
> 时间：2009-04-18T17:42:39.837
> 
> 标签：com, aggregation

我注意到许多关于 COM 的书籍等都指出，在 COM 聚合中实现一个可用作内部对象的对象相对容易。但是，除非我遗漏了什么，否则聚合似乎只能在极其有限的场景中成功，因此只有在明确识别出这种场景时才应提供对它的支持。

困扰我的部分如下。COM 聚合将内部对象的身份与外部对象的身份相结合。外部对象的实现者选择内部对象接口的子集，并将这些接口的请求转发给内部对象。内部对象将所有接口请求转发给外部对象。现在假设内部对象，作为其实现的一部分，构造子 COM 对象。大概一个接口指针被传递给该 COM 对象，以便它可以与其父对象通信。内部对象对它实现的接口有一些想法。然而，外部对象可能选择不转发其中一些接口。实际上，文档指出外部对象不应盲目转发接口。这似乎意味着内部对象通常不能将接口指针传递给其他 COM 对象，除非特别要求外部对象将所有这些接口转发给内部对象。这不限于子对象方案。实际上，内部对象实现传递接口指针的任何地方似乎都可能受到影响。

因此，聚合似乎不是通用目的，因为在内部对象必须与其他 COM 对象通信的情况下，它对外部对象提出了严格的要求，即必须最少转发哪些接口，并且不能添加更多接口。此列表在内部对象的未来版本中不会破坏与不转发这些接口的现有外部对象的兼容性。

这是对事物实际情况的正确（并且很少记录）描述还是故事还有更多内容？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T17:57:43.433

发现你的线程在这里萎靡不振，以为我会回应。对于初学者来说，聚合与 OOP 中的封装相比，但有一些显着差异。好的是在外部接口中需要很少的工作来公开聚合接口。不好的是，接口需要从一开始就设计为可聚合的，而 OOP 封装没有这种要求。这限制了您将 COM 类放在架子上的可能性，准备好了。从我自己的工作来看，当面临是否支持聚合的问题时，我还没有回答“是的，有一天可能会有用”。实施委托和非委托的 IUnknowns 让我感到头疼，这让我选择了“不”。

您关于创建对象的内部接口的问题很容易回答。内部接口不应该知道它已聚合。更重要的是，它不知道是谁聚合的。因此，它无法知道外部是否对对象有用，或者它是否会正确委托 QI。这不是一个真正的问题，它可以简单地将接口指针传递给它自己的接口之一。聚合并不禁止它。只需要转发未知接口。

但是，是的，聚合不是很实用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T18:03:27.757

我曾经实现或看到实现的每一个 COM 对象都在它的 create 方法中进行了非聚合检查。MSFT 提供的大多数 COM 对象不支持聚合。

# .net - 如何在.Net中跨进程共享对象？

> ID：763821
> 
> 赞同：3
> 
> 时间：2009-04-18T17:43:54.980
> 
> 标签：.net, distribution

我正在尝试跨单独的进程“共享”.net 对象。我有一种类型的进程，它是一个操作一组域实体的 Web 服务。另一种类型的进程是窗口服务，它对同一组对象进行一些自动批处理。

除了将数据库作为两种类型的进程读取/写入对象的共享空间的典型解决方案之外，让这些不同进程查看和处理相同对象的更好、更分布式的架构可能是什么？

我考虑过使用分布式缓存作为对象的共享存储，但这并不完全支持对象及其关系。插入分布式缓存的对象图被展平，对象最终存储在多个断开连接的副本中。

“消息总线”是否是正确的方式，让进程相互发送对象的更新副本？

还是有其他完全可以考虑的解决方案？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T17:57:11.033

我建议使用 WCF 服务。对于本地使用（从 Windows 服务调用），您可以使用 netNamedPipeBinding。这使您可以在将来物理上分离这两个过程。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T18:03:30.177

您将需要决定您的两个服务中的哪一个，或者可能是第三个，尚未成文的服务，是您的域对象的权威来源。

由权威源公开的远程处理或基于 WCF 的服务集应为您的对象图提供中心位置。但是，我认为您只是在为对象创建分布式缓存。

您是否考虑过[Velocity 项目](http://msdn.microsoft.com/en-us/data/cc655792.aspx)？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T18:09:17.760

在我们的项目中，我们使用 ScaleOut StateServer（一种商业产品 - [www.scaleoutsoftware.com](http://www.scaleoutsoftware.com)）在整个服务器场中完成对象的分布式缓存/复制，以实现类似目的。这非常有效，尽管使用对象确实会产生（反）序列化成本，因此在许多情况下，我们将存储的内容简化为可能的字符串值。

我们还没有完全评估 Velocity 项目，因为我们的使用在此之前就已经开始了，而且我们现在没有时间或令人信服的理由来考虑转换，但如果你现在才开始，这显然需要进行一些调查。

**编辑：**我确实错过了关于这个问题的重要部分——对象引用的扁平化。这可能会使事情过于复杂或有其他缺点，但是如果您采用更紧密地模拟分布式缓存中的数据库存储的方法（保持它存储每个不同对象实体的单个副本，并使用更松散的引用来链接那些实体在一起）？

示例：您有一个类“Group”，它具有“Leader”属性和“Members”集合，所有这些都包含作为“Person”类实例的对象。您必须使用自定义序列化来完成它，没有什么能神奇地解决并发/脏更新问题，但想法是您放入分布式缓存的内容实际上也是所有单独的“Person”实例作为“组”实例本身的浅拷贝。该浅拷贝将序列化正常的“组”属性（名称等），以及其中包含的每个“人员”引用的唯一标识符（如原始数据库 ID、GUID、唯一用户名或任何合适的），而不是Person 对象本身。所以你会有一个'LeaderID' 而不是领导者，成员集合将序列化为成员 ID 的列表。引用的每个 Person 也存储为单独的对象；这就是并发技巧发挥作用的地方。

在反序列化（或访问时，取决于使用模式）时，Group 浅拷贝将遵循所有 Person ID 引用，并使用单独存储在分布式缓存中的真实 Person 对象重新水合这些引用。您需要实现锁定机制，以确保对可以在许多不同组之间共享的这些对象的更新是安全的。您还需要版本控制机制和“脏检查”，以重新读取/获取在分布式缓存中对 Person 对象所做的任何更改。

它看起来确实很复杂，但这是我在不知道您的用例细节的情况下能想到的最通用的方法。

# entity-relationship - 关于第三范式的问题

> ID：763825
> 
> 赞同：0
> 
> 时间：2009-04-18T17:45:12.933
> 
> 标签：entity-relationship, relational, relational-database, third-normal-form

下表：

```
EmpId  State   Zip
1       FL   342008
2       CA   342001 
```

不是第 3 范式，因为 State 可传递地依赖于主键（EmpId）。

所以，如果我这样打破它： (EmpId,State) (State,PIN)

它在 3NF 中。

我也可以打破它： (EmpId,State) (EmpId,PIN) 它将再次处于 3NF 中。

但在第二种情况下，存在信息冗余，例如

```
1  FL
2  FL

1 342008
2 342008 
```

第二次分解违反了哪个性质？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T18:25:27.143

如前所述，存在冗余，因为可以通过邮政编码推断州，因此，您应该以这种方式拥有表格：

```
EmpId Zip
1     342008

Zip    State
342008 FL 
```

总是想什么取决于什么。当然，已经有一个[基于集合论进行归一化的标准过程](http://en.wikipedia.org/wiki/Third_normal_form)。[这](http://www.bkent.net/Doc/simple5.htm#label3.2)也可以帮助你。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T18:13:17.640

这并不能直接解决您的问题，但是严格来说， state 列是多余的，因为它可以从邮政编码中派生出来（尽管您显示的是六位数的邮政编码，这在美国不是标准的。 ) 您可以按 EmpID 和 ZIP 分解表格，将 State 单独留在查找表中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-06T13:57:25.783

为了直接解决所提出的问题，违反的属性是 FFD（对密钥的完全功能依赖）。

# iphone - 是否可以在 iPhone 上做一个漂亮的布隆过滤器？

> ID：763826
> 
> 赞同：1
> 
> 时间：2009-04-18T17:45:19.470
> 
> 标签：iphone, opengl-es

我正在开发一个带有简单矢量图形的 iPhone 游戏，尽管如果屏幕上的对象发光（即在渲染中应用了布隆过滤器），它看起来会特别好。

我对后处理技术相当陌生，我正在阅读的大多数教程都使用 GPU 上的着色器。我只是想知道这是否可以在 iPhone 硬件上实现，或者是否都必须在软件中完成（在这种情况下，我认为实时使用会太慢）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-02-05T17:07:49.143

这在 es1 设备上绝对是可能的。

1) 渲染纹理光照几何体，该几何体应该在黑色背景上绽放为纯白色。例如，如果相机在房间里看着窗户，并且您希望窗户绽放 - 仅将窗户渲染为纯白色，没有纹理。

2）创建此纹理的多个副本，每个副本缩小到之前大小的一半

3) 使用加法混合将所有这些拉伸到全屏的纹理渲染到渲染场景的顶部，调整每一层的 alpha 直到获得所需的质量

本质上，第 2 步和第 3 步所做的是使用本机纹理过滤在硬件中模拟高斯模糊。

所以你所拥有的是你的光源几何形状为黑底白字，高斯模糊，然后添加到你的场景中——瞧，假绽放:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-19T16:46:35.923

由于 iPhone 根本不支持着色器，我认为布隆过滤器很难实现。一些多通道技巧可能会根据场景产生令人信服的模仿，但可能太慢了。

此外，游戏“边缘”似乎在暂停屏幕上使用了绽放效果，但它是静态的，因此它可能是在软件中实现的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-12-19T23:03:19.930

您可以随时[截取屏幕截图并](http://www.cocos2d-iphone.org/forum/topic/1722)[像在这篇文章中那样](http://www.cocos2d-iphone.org/forum/topic/6315)模糊它，然后只使用添加剂混合，可能有用吗？

# web-services - Web 服务的更好方法是先合同还是最后合同？

> ID：763827
> 
> 赞同：13
> 
> 时间：2009-04-18T17:45:39.500
> 
> 标签：web-services, contract-first

哪个是开发 Web 服务的更好方法？先签约还是后签约？
各自的优点和缺点是什么？

你有哪些经验？

**编辑** 这个问题是关于 Web 服务的实现（阅读：SOAP）问题是是否应该首先对实现类进行编码，然后生成 WSDL 和 XSD 模式（最后一个合同）或首先编写 WSDL 和 XSD 模式，然后生成的实现类（合约优先）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-20T17:14:17.827

合同优先是普遍接受的“最佳实践”。

它使您对服务的生产者和消费者都非常清楚需要什么和期望什么。当您开始尝试转换 java 类型 -> xml 类型时，这一点变得尤为重要。您还可以跨不同的 Web 服务重用模式。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-10-01T18:25:50.173

我已经使用了这两种方法。我的建议是使用**契约优先**模式，但**代码优先**WSDL。

编写 WSDL 文件有很多奇怪的细微差别，例如绑定、端口等。我宁愿用工具而不是手工完成。有一些工具可以帮助做到这一点，但没有一个比这更简单

```
@网络服务
上市 ...
```

至少您可以验证您的部署。

对于模式，我建议**先契约**，因为 XML Schema 语言比你用 Java 描述的要丰富得多。我通常给出的一个例子是显示 XML Schema 可以限制字符串的大小并应用正则表达式模式。在 Java 和注解中这样做看起来有点混乱。

Another advantage of doing the schema as contract first is the presence of tools to convert your schema file into HTML documentation.

The XJC tool can generate the requisite class files. However, I would only recommend doing that at start.

In the end you should take the generated WSDL file and work with that instead. That way you can use wsimport and verify that the whole thing from WSDL to Schema is valid.

You can deploy with the WSDL file by using the wsdlLocation attribute in your @WebService implementation and the application server will fix the binding data for you when users request the WSDL from the server, but you still retain your annotations. Otherwise your annotations will not appear on the requested WSDL files.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-19T01:21:39.640

我怀疑答案是肯定的“这取决于”。

问题是，如果你建立*和发布*你的合同，你就会受到它的约束。这让改变变得更加困难。不是不可能，而是更难。

另一方面，如果您对模式等感到满意，那么弄乱合约比弄乱代码更快。因此您可以在合约中进行一些增量更改。

是不是也有可以从 WSDL 生成代码骨架的工具？我几乎肯定有。如果是这样，您最好将模式设为“代码”项，并从中生成代码。

# puzzle - 编程之谜：倒数不减

> ID：763832
> 
> 赞同：18
> 
> 时间：2009-04-18T17:48:07.623
> 
> 标签：puzzle

好的，以示例为目标：执行此操作的命令行应用程序：

倒计时.exe 7

打印 7 6 5 4 3 2 1

不允许任何形式的减法（包括使用减号）或字符串反转。

waaaaay 显然太容易了 :-) 答案概述（至少是原则）

1.  通过添加和递归
2.  通过使用模
3.  通过推动和弹出，（也许是最明显的？）
4.  通过使用溢出
5.  通过反复试验（也许是最不明显的？）

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-18T17:54:18.030

```
x = param;
while (x > 0) {
    print x;
    x = (x + param) mod (param + 1);
} 
```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-04-18T17:50:01.160

添加和递归怎么样？

```
public void Print(int i, int max) {
  if ( i < max ) { 
    Print(i+1, max);
  }
  Console.Write(i);
  Console.Write(" ");
}

public void Main(string[] args) {
  int max = Int32.Parse(args[0]);
  Print(1, max);
} 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-04-20T18:31:17.567

这是您错过的一种方法，反复试验：

```
import java.util.Random;

public class CountDown
{
    public static void main(String[] args)
    {
        Random rand = new Random();

        int currentNum = Integer.parseInt(args[0]);

        while (currentNum != 0)
        {
            System.out.print(currentNum + " ");
            int nextNum = 0;
            while (nextNum + 1 != currentNum) {
               nextNum = rand.nextInt(currentNum);
            }

          currentNum = nextNum;
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-04-18T18:04:55.587

将 1-7 压入堆栈。一个一个地弹出堆栈。打印 7-1。:)

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2009-04-18T18:44:00.377

使用 2 的恭维，毕竟这是计算机处理负数的方式。

```
int Negate(int i)
{
   i = ~i;  // invert bits
   return i + 1; // and add 1
}

void Print(int max)
{
   for( int i = max; i != 0; i += Negate(1) )
   {
     printf("%d ", i);
   }
} 
```

见[http://en.wikipedia.org/wiki/2's_complement](http://en.wikipedia.org/wiki/2's_complement)

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-04-18T17:54:45.207

将数字添加到字符串缓冲区中。

```
String out = "";
for (int i = 0; i < parm; i++)
{
   out = " " + (i+1) + out;
}
System.out.println(out); 
```

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2009-04-18T18:08:30.570

c/c++，有点算术溢出：

```
void Print(int max)
{
   for( int i = max; i > 0; i += 0xFFFFFFFF )
   {
      printf("%d ", i);
   }
} 
```

* * *

## 回答 #8

> 赞同：10
> 
> 时间：2009-06-20T00:23:44.130

我注意到没有人发布最愚蠢的答案，所以我会继续分享它：

```
int main (int argc, char **argv) {
  if ( ( argc < 1 ) || ( atoi(argv[1]) != 7 ) ) {
    printf("Not supported.\n");
  } else {
    printf("7 6 5 4 3 2 1\n");
  }
} 
```

不要恨我：看到了吗？我承认这是愚蠢的。:)

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-04-18T18:29:09.413

使用舍入误差：

```
void Decrement(int& i)
{
    double d = i * i;
    d = d / (((double)i)+0.000001); // d ends up being just smaller than i
    i = (int)d; // conversion back to an int rounds down.
}

void Print(int max)
{
   for( int i = max; i > 0; Decrement(i) )
   {
     printf("%d ", i);
   }
} 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2009-04-18T18:17:47.490

这并不难。使用模运算符。

```
for (int n = 7; n <= 49; n += 7) {
  print n mod 8;
} 
```

* * *

## 回答 #11

> 赞同：7
> 
> 时间：2009-04-20T18:17:07.130

**按位算术**

常数空间，没有加法、减法、乘法、除法、模数或算术否定：

```
#include <iostream>
#include <stdlib.h>
int main( int argc, char **argv ) {
    for ( unsigned int value = atoi( argv[ 1 ] ); value; ) {
        std::cout << value << " ";
        for ( unsigned int place = 1; place; place <<= 1 )
            if ( value & place ) {
                value &= ~place;
                break;
            } else
                value |= place;
    }
    std::cout << std::endl;
} 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-04-18T18:21:30.430

一个python版本：

```
import sys

items = list(xrange(1, int(sys.argv[1])+1))
for i in xrange(len(items)):
    print items.pop() 
```

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-04-20T17:59:13.650

这是作弊吧？

```
#!/usr/bin/env python 
def countdown(n):
    for i in range(n):
        print n
        n = n + (n + ~n) 
```

只是为了好玩，它的递归兄弟：

```
def tune_up(n):
    print n
    if n == 0:
        return
    else:
        return tune_up(n + (n + ~n)) 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2009-04-20T19:06:59.163

从包含从降序到您感兴趣的最大值的文件开始：

```
7 6 5 4 3 2 1 
```

然后...这仅适用于 9999

```
#!/bin/sh
MAX_NUM=9999
if [ ! -e descendingnumbers.txt ]; then
    seq -f%04.0f -s\  $MAX_NUM -1 1 > descendingnumbers.txt
fi
tail descendingnumbers.txt -c $[5 * $1] 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-04-18T17:57:30.223

Scala 中快速而肮脏的版本：

```
sealed abstract class Number
case class Elem(num: Number, value: Int) extends Number
case object Nil extends Number

var num: Number = Nil

for (i <- 1 until param)
  num = Elem(num, i)

while (num != null)
  num match {
    case Elem(n, v) => {
      System.out.print(v + " ")
      num = n
    }
    case Nil => {
      System.out.println("")
      num = null
    }
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-04-18T18:03:26.120

增加一个传递给 max_int 的有符号整数，然后将其“添加”到计数器......或者这是否考虑非法减法？

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-18T18:06:10.607

```
 public void print (int i)
    {
        Console.Out.Write("{0} ", i);
        int j = i;
        while (j > 1)
        {
            int k = 1;
            while (k+1 < j)
                k++;
            j = k;
            Console.Out.Write("{0} ", k );
        }
    } 
```

有点讨厌，但它确实有效

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-04-18T18:09:10.037

```
public class CountUp
{
    public static void main(String[] args)
    {

        int n = Integer.parseInt(args[0]);

        while (n != 0)
        {
            System.out.print(n + " ");
            n = (int)(n + 0xffffffffL);
        }
    }
} 
```

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2009-04-18T18:20:45.253

```
// count up until found the number. the previous number counted is
// the decremented value wanted.
void Decrement(int& i)
{
  int theLastOneWas;
  for( int isThisIt = 0; isThisIt < i; ++isThisIt )
  {
    theLastOneWas = isThisIt;
  }
  i = theLastOneWas;
}

void Print(int max)
{
   for( int i = max; i > 0; Decrement(i) )
   {
     printf("%d ", i);
   }
} 
```

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2009-04-18T19:04:58.890

我们在打这个吗？

```
import sys
for n in reversed(range(int(sys.argv[1]))):print n+1, 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2009-04-18T20:29:47.190

```
#!/usr/bin/env ruby

ARGV[0].to_i.downto(1) do |n|
  print "#{n} "
end
puts '' 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2009-04-18T22:06:59.513

哈斯克尔：

```
import System.Environment (getArgs)

func :: Integer -> [String]
func 0 = []
func n@(x+1) = show n:func x

main = putStrLn . unwords . func . read . head =<< getArgs 
```

称为 n+k 模式的“功能”允许这样做：在两个数字相加时进行模式匹配。一般[不使用](http://www.dcs.gla.ac.uk/mail-www/haskell/msg01131.html)。一个更惯用的方法是使用这个版本的 func：

```
func n = foldl (flip $ (:) . show) [] [1..n] 
```

或者，每行一个数字：

```
import System.Environment (getArgs)
import Data.Traversable

main = foldrM (const . print) () . enumFromTo 1 . read . head =<< getArgs 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2009-11-10T18:02:45.777

这算不算？仅使用添加指令...

```
int _tmain(int argc, _TCHAR* argv[])
{
   int x = 10;
   __asm mov eax,x;
   __asm mov ebx,0xFFFFFFFF;
   while (x > 0)
   {
      __asm add eax,ebx;
      __asm mov x,eax;
      __asm push eax;
      printf("%d ",x);
      __asm pop eax;
   }
   return 0;
} 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-04-18T18:29:23.063

珀尔：

```
$n = $ARGV[0];

while ($n > 0) {
  print "$n ";
  $n = int($n * ($n / ($n+1)));
} 
```

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-04-18T20:31:34.203

减法无论如何都是一种错觉

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2009-04-19T01:33:22.857

我喜欢 Dylan Bennett 的想法 - 简单、务实，而且它遵循 KISS 原则，恕我直言，这是我们在开发软件时应始终牢记的最重要概念之一。毕竟，我们编写代码主要是为了让其他人维护它，而不是让计算机读取它。Dylan 在旧 C 中的解决方案：

```
 #include <stdio.h>
int main(void) {
        int n;
        for (n = 7; n <= 49; n += 7) {
                printf("%d ", n % 8);
        }
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2009-04-19T02:14:35.317

在 C 中，使用旋转内存块（注意，这不是我引以为豪的东西......）：

```
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

#define MAX_MAX 10

void rotate_array (int *array, int size) {
  int tmp = array[size - 1];
  memmove(array + 1, array, sizeof(int) * (size - 1));
  array[0] = tmp;
}

int main (int argc, char **argv) {
  int idx, max, tmp_array[MAX_MAX];

  if (argc > 1) {
    max = atoi(argv[1]);
    if (max <= MAX_MAX) {
      /* load the array */
      for (idx = 0; idx < max; ++idx) {
        tmp_array[idx] = idx + 1;
      }
      /* rotate, print, lather, rinse, repeat... */
      for (idx = 0; idx < max; ++idx) {
        rotate_array(tmp_array, max);
        printf("%d ", tmp_array[0]);
      }
      printf("\n");
    }
  }

  return 0;
} 
```

以及将列表视为整数的常见 lisp 解决方案：

```
(defun foo (max)
  (format t "~{~A~^ ~}~%"
          (maplist (lambda (x) (length x)) (make-list max)))) 
```

把它变成可执行文件可能是最难的部分，留给读者作为练习。

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2009-04-20T17:27:23.913

# 通用 Lisp

从 7 开始倒数（使用递归，或者像这里一样，使用`loop`and `downto`）：

`(loop for n from 7 downto 1 do (print n))`

或者，也许是一个更有趣的解决方案。使用复数，我们只需重复添加 i 平方：

```
(defun complex-decrement (n)
  "Decrements N by adding i squared."
  (+ n (expt (complex 0 1) 2)))

(loop for n = 7 then (complex-decrement n)
      while (> n 0) do (print n)) 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2009-04-20T19:14:47.367

我喜欢递归

```
function printCountDown(int x, int y) {
  if ( y != x ) printCountDown(x, y++);
  print y + " ";
} 
```

你也可以使用乘法

```
function printNto1(int x) {
  for(int y=x*(MAXINT*2+1);y<=(MAXINT*2+1);y++) {
    print (y*(MAXINT*2+1)) + " ";
  }
} 
```

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2009-06-05T11:05:00.517

另一种 perl 版本可能是：

```
#!/usr/local/bin/perl
打印反向连接(" ",1 .. $ARGV[0]) 。"\n";

```

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2009-06-19T18:30:39.213

C：

```
char buf[2][50];
int buf_no, i;

buf_no = buf[0][0] = buf[1][0] = 0;

for (i = 1; i <= 7; ++i, buf_no = !buf_no) 
    sprintf(buf[buf_no], "%d %s", i, buf[!buf_no]);

printf(buf[!buf_no]); 
```

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2009-06-19T18:37:16.753

**PHP**

```
<?=implode(",", array_reverse( range(1, $_GET['limit']) ) )?> 
```

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2009-06-19T18:41:22.847

现在滥用字符串函数！

```
using System;
public class Countdown {
    public static void Main(string[] args){
        int start = 10;
        string buffer;
        if (args.Length > 0) start = int.Parse(args[0]);
        buffer = "".PadRight(start, 'z');
        while (buffer.Length > 0){
            Console.Write(buffer.Length.ToString() + " ");
            buffer = buffer.Substring(1);
        }
        Console.WriteLine();
    }
} 
```

* * *

## 回答 #34

> 赞同：0
> 
> 时间：2009-10-08T20:32:11.297

另一个 Scala 实现

```
class Countdown(countFrom: Int, countTo: Int) {
  def printListInReverse() = {
    val standardCount = for (i <- countFrom to countTo) yield i
    println(standardCount.reverse.mkString(" "))
  }
} 
```

* * *

## 回答 #35

> 赞同：-1
> 
> 时间：2009-04-18T17:49:26.777

加负1怎么样？

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2009-04-18T22:08:22.663

从 -7 开始计数，不要打印减号：

```
#!/usr/bin/env python
for i in range(-7, 0): print str(i)[1], 
```

* * *

## 回答 #37

> 赞同：-1
> 
> 时间：2009-04-20T18:50:40.233

输出到临时字符串，然后反转它，然后反转单个数字：

```
string ret;
for(int i=0;i<atoi(argv[1]);i++)
  ret += " " + itoa(i);

for(int i=0;i<ret.length()/2;i++)
   exchange(ret[i],ret[ret.length()-i-1]);

for(const char* t=&ret[0];t&&strchr(t,' ');t=strchr(t,' '))
for(int i=0;i<(strchr(t,' ')-t)/2;i++)
   exchange(t[i],t[strchr(t,' ')-t-1]);

printf(ret.c_str()); 
```

# functional-programming - 副作用是好事吗？

> ID：763835
> 
> 赞同：29
> 
> 时间：2009-04-18T17:49:02.347
> 
> 标签：functional-programming, procedural-programming, side-effects

我觉得这个词有点贬义。因此，我对维基百科中的两句话感到震惊：

> 命令式编程以使用副作用来使程序运行而闻名。反过来，函数式编程以其最小化副作用而闻名。[[1]](http://en.wikipedia.org/wiki/Side_effect_(computer_science))

由于我有点偏向数学，后者听起来很棒。副作用的论据是什么？它们是意味着失去控制还是接受不确定性？它们是好事吗？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-04-20T03:03:53.473

每隔一段时间，我就会看到一个关于 SO 的问题，这迫使我花半个小时来编辑一篇非常糟糕的 Wikipedia 文章。这篇文章现在只是中度糟糕。在与您的问题有关的部分中，我写道：

> 在计算机科学中，如果一个函数或表达式除了产生一个值之外，它还修改了某些状态或与调用函数或外部世界有*可观察*的交互，则称它具有**副作用。**例如，函数可能会修改全局或静态变量、修改其参数之一、引发异常、将数据写入显示或文件、读取数据、调用其他副作用函数或发射导弹。在存在副作用的情况下，程序的行为取决于过去的历史；也就是说，评估的顺序很重要。因为理解一个有效的程序需要考虑所有可能的历史，副作用往往使程序更难理解。
> 
>  *副作用对于使程序能够与外部世界（人、文件系统、网络上的其他计算机）交互至关重要。但是使用副作用的程度取决于编程范式。命令式编程以不受控制、混杂使用副作用而闻名。在函数式编程中，很少使用副作用。标准 ML 和 Scheme 等函数式语言不限制副作用，但程序员习惯于避免它们。函数式语言 Haskell 使用静态类型系统限制副作用；只有产生 IO 类型结果的函数才会有副作用。*

 ** * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-04-18T20:30:10.527

**副作用是一种必要的邪恶**，人们应该设法将它们最小化/本地化。

线程上的其他评论说无效果编程有时不那么**直观**，但我认为人们认为“直观”很大程度上是他们先前经验的结果，并且大多数人的经验都带有严重的命令偏见。主流工具每天都变得越来越实用，因为人们发现**无效果编程会导致更少的错误**（尽管有时是新的/不同类别的错误），因为单独的组件通过效果进行交互的可能性较小。

几乎没有人提到性能，并且**无效果编程的性能通常**比有效编程更差，因为计算机是冯诺依曼机器，旨在很好地处理效果（而不是设计为很好地处理 lambda）。现在我们正处于多核革命之中，这可能会改变游戏规则，因为人们发现他们需要利用核心来获得性能，而并行化有时需要火箭科学家才能完全正确地发挥作用，当你没有效果时，它很容易得到正确的结果。

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-04-18T17:57:50.847

在冯诺依曼机器中，副作用是使机器工作的东西。本质上，无论您如何编写程序，它都需要产生副作用才能工作（在低级别视图中）。

没有副作用的编程意味着将副作用抽象出来，这样你就可以考虑一般的问题——而不用担心机器的当前状态——并减少程序不同模块之间的依赖关系（无论是过程、类还是其他任何东西）。通过这样做，您将使您的程序更具可重用性（因为模块不依赖于特定状态来工作）。

所以是的，无副作用的程序是一件好事，但副作用在某种程度上是不可避免的（所以它们不能被认为是“坏的”）。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-04-18T17:57:46.167

临：

*   最后副作用是你想要完成的。
*   对于与外部世界交互的代码，副作用是很自然的。
*   它们使许多算法变得简单。
*   为了避免使用副作用，您需要通过递归来实现循环，因此您的语言实现需要尾调用优化。

缺点：

*   纯代码易于并行化。
*   副作用会使代码变得复杂。
*   纯代码更容易证明是正确的。

例如 Haskell，一开始它看起来很优雅，但是你需要开始与外部世界一起玩，它不再那么有趣了。（Haskell 将状态作为函数参数移动并将其隐藏到称为 Monads 的东西中，这使您能够以命令式的外观风格编写。）

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-04-18T17:59:45.397

没有副作用，您根本无法做某些事情。一个例子是 I/O，因为根据定义，在屏幕上显示消息是一种副作用。这就是为什么函数式编程的目标是尽量减少副作用，而不是完全消除它们。

撇开这一点不谈，在某些情况下，尽量减少副作用与其他目标（如速度或内存效率）发生冲突。其他时候，您的问题已经有一个概念模型，与突变状态的想法非常吻合，而与现有模型作斗争可能会浪费精力和精力。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2010-04-26T14:57:44.237

副作用就像任何其他武器一样。它们无疑是有用的，如果处理不当，可能会非常危险。

就像武器一样，你有各种不同程度的杀伤力的副作用。

在 C++ 中，副作用是完全不受限制的，这要归功于指针。如果变量被声明为“私有”，您仍然可以使用指针技巧访问或更改它。您甚至可以更改不在范围内的变量，例如调用函数的参数和局部变量。借助操作系统（mmap）的一点帮助，您甚至可以在运行时修改程序的机器代码！当你使用像 C++ 这样的语言编写代码时，你就被提升到了 Bit God 的级别，是你进程中所有内存的大师。编译器对您的代码所做的所有优化都是在您不滥用权力的假设下进行的。

在 Java 中，您的能力受到更多限制。范围内的所有变量都在您的控制之下，包括由不同线程共享的变量，但您必须始终遵守类型系统。尽管如此，由于您可以使用操作系统的一个子集以及静态字段的存在，您的代码可能会产生非本地影响。如果一个单独的线程以某种方式关闭了 System.out，它看起来就像魔术一样。这*将*是魔法：具有副作用的魔法。

Haskell（尽管宣传是纯粹的）具有 IO monad，它要求您使用类型系统注册所有副作用。将您的代码包装在 IO monad 中就像是 3 天的手枪等待期：您仍然可以自暴自弃，但除非您与政府达成一致。还有 unsafePerformIO 和它的同类，它们是 Haskell IO 的黑市，给你“不问任何问题”的副作用。

Miranda 是 Haskell 的前身，是一种在 monad 流行之前创建的纯函数式语言。Miranda（据我所知......如果我错了，请替换 Lambda 演算）根本没有 IO 原语。唯一完成的 IO 是编译程序（输入）并运行程序并打印结果（输出）。在这里，你拥有完全的纯洁。执行顺序完全无关。所有“效果”对于声明它们的函数来说都是局部的，这意味着代码的两个不相交部分永远不会相互影响。这是一个乌托邦（数学家）。或者相当于一个 distpia。这很无聊。什么都没有发生。你不能为它写一个服务器。您不能在其中编写操作系统。你不能在里面写 SNAKE 或俄罗斯方块。每个人都只是坐在那里看着数学。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-20T08:46:01.170

确实，正如这里的一些人所提到的，没有副作用就无法做出有用的应用程序。但由此并不能说以不受控制的方式使用副作用是一件好事。

考虑以下类比：具有没有分支指令的指令集的处理器将毫无价值。但是，这并不意味着程序员必须一直使用**goto**。相反，结构化编程和后来的 OOP 语言（如 Java）甚至可以在没有 goto 语句的情况下完成，而且没有人错过它。

（可以肯定的是，Java 中仍然存在 goto - 现在称为**break**、**continue**和**throw**。）

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-18T18:42:40.753

副作用对于大多数应用程序的重要部分是必不可少的。纯函数有很多优点。它们更容易考虑，因为您不必担心前置条件和后置条件。由于它们不改变状态，它们更容易并行化，随着处理器数量的增加，这将变得非常重要。

副作用是不可避免的。只要它们是比更复杂但更纯粹的解决方案更好的选择，就应该使用它们。纯函数也是如此。有时，使用功能解决方案可以更好地解决问题。

一切都很好 =) 您应该根据要解决的问题使用不同的范例。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-18T20:36:11.197

没有副作用，就不能执行 I/O 操作；所以你不能做一个有用的应用程序。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-01-03T08:13:21.257

这句话真的让我笑了。也就是说，我发现副作用的最小化可以真正转化为更容易推理和维护的代码。然而，我没有像我想要的那样去探索函数式编程的奢侈。

在使用围绕副作用的面向对象和过程语言工作时，我看待它的方式是*包含*和*隔离*副作用。

作为一个基本示例，视频游戏具有将图形渲染到屏幕的必要副作用。然而，关于副作用，这里有两种不同的设计路径。

一种是通过使渲染器非常抽象并基本上告诉要渲染什么来寻求最小化和松散耦合。然后系统的其他部分告诉渲染器要绘制什么，这可能是一组图元，如三角形和带有投影和模型视图矩阵的点，或者可能是更高层次的东西，如抽象模型、相机、灯光和粒子。无论哪种方式，这样的设计都围绕着许多导致外部副作用的事情，因为代码库的许多部分可能会将更改推送到渲染器（无论多么抽象或间接，净效应仍然是这样的一大堆东西系统触发外部渲染副作用）。

另一种方法是*控制/隔离*这些副作用。渲染器不会被告知要渲染什么，而是与游戏世界耦合（尽管这可能只是一些基本的抽象，也可能是对场景图的访问）。现在它自己访问场景（只读访问）并查看场景并使用更多的拉式设计来确定要渲染的内容。这导致渲染器与游戏世界的更多耦合，但这也意味着与屏幕输出相关的副作用现在完全包含在渲染器中。

后一种设计*包含*或*隔离*了副作用，我发现这种设计更容易维护和保持正确。它仍然会导致副作用，但与将图形输出到屏幕相关的所有副作用现在完全包含在渲染器中。如果那里有问题，您知道错误将出现在渲染器代码中，而不是外部滥用它并告诉它错误的事情要做的结果。

正因为如此，当谈到耦合时，我总是发现在引起外部副作用的事物中最大化传出（传出）耦合并最小化传入（传入）耦合更可取。无论抽象如何，这都适用。在副作用的上下文中，对于将要发生的副作用的通信，对`IRenderer`具体的依赖仍然是对具体的依赖。`Renderer`就将发生什么副作用而言，抽象没有任何区别。

渲染器应该依赖于世界的其他部分，以便它可以将这些副作用完全隔离到屏幕上；世界其他地方不应该依赖渲染器。文件保护程序的类比相同。文件保护程序不应该被外界告知要保存什么。它应该看看周围的世界，并找出自己要保存的东西。这就是寻求隔离和控制副作用的设计路径；它往往比基于推的更基于拉。如果你绘制出依赖关系，结果往往会引入更多的耦合（尽管它可能是松散的），因为保存器可能需要与它甚至不感兴趣保存的事物耦合，或者渲染器可能需要对事物进行只读访问它甚至对渲染没有兴趣去发现它对渲染感兴趣的东西。

然而，最终的结果是依赖流*远离*副作用而不是*流向*副作用。当我们有一个系统有许多依赖流向推动外部副作用时，我总是发现这些最难推理，因为系统的许多部分可能会改变外部状态，以至于很难弄清楚是什么将要发生还要*何时*何*地*。因此，纠正/预防该问题的最直接方法是寻求使依赖项*远离*副作用，而不是流向它们。

无论如何，我发现偏爱这些类型的设计是一种实用的方法，可以帮助避免错误，也有助于在它们存在时检测和隔离它们，使它们更容易复制和纠正。

我发现的另一个有用的策略是使系统的任何给定循环/阶段的副作用更加均匀。例如，我发现在这种情况下执行三个同质循环会更容易，而不是执行从某事物中删除关联数据、将其断开链接、然后将其删除的循环。第一个同构循环可以删除相关数据。第二个同构循环可以使节点脱链。第三个同质循环可以将其从系统的其余部分中移除。这是与实现而不是设计相关的较低级别的注释，但我经常发现结果更容易推理、维护甚至优化（更容易并行化，例如，

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-06-17T10:05:18.227

因为你的程序必须有副作用才能产生任何输出或有趣的效果（除了加热你的 CPU），问题是应该在你的程序中的哪里触发这些副作用。只有当它们隐藏在您意想不到的方法中时，它们才会变得有害。

根据经验：将纯方法和具有副作用的方法分开。将某些内容打印到控制台的方法应该只执行此操作，而不是计算您可能想在其他地方使用的一些有趣的值。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-18T17:54:44.237

好吧，一方面，使用副作用进行编程要容易得多，也更直观。对很多人来说，函数式编程很难理解——找到一个在 Ocaml 中教授/TAed 课程的人，你可能会听到各种关于人们无法理解它的故事。如果没有人能够真正遵循它，那么拥有设计精美、无副作用的功能代码又有什么用呢？使雇用人员来完成您的软件变得相当困难。

至少这是争论的一方面。许多人必须学习所有关于函数式风格和无副作用代码的原因有很多。想到了多线程。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2020-07-09T01:16:43.377

我认为平衡的答案是，人们应该寻找机会来最小化或避免副作用，或者考虑它们在哪里，并寻找机会将它们移动到其他地方以使代码更容易理解。

这里我给出一些代码的两个版本。当我开始寻找机会将看起来像第一个版本的代码更改为看起来像第二个版本的代码时，我的生活变得更好了：

它可能有一个具有属性`first, second, third`和方法的对象，`first_method, second_method, third_method`例如

```
def first_method(self):
    # calculate and set self.first

def second_method(self):
    # use self.first to calculate and set self.second

def third_method(self):
    # use self.first and self.second to calculate self.third 
```

然后是更高级别的方法：

```
def method(self):
    self.first_method()
    self.second_method()
    self.third_method() 
```

现在想象一下这些名称不是以“first”、“second”、“third”为前缀，而是描述了方法的作用，并且程序更复杂。这是我在探索滥用副作用的代码时经常遇到的问题。我经常需要查看函数的实现，以了解调用它们的效果是什么以及它们如何协同工作。

现在，无需对“副作用是邪恶的”东西发疯，我们仍然可以从避免副作用的愿望中受益：

```
def first_func():
    # calculate the first thing and return it

def second_func(first_thing):
    # use first_thing to calculate second_thing and return it

def third_func(first_thing, second_thing):
    # use first_thing and second_thing to calculate third_thing and return it 
```

并且更高级别的方法可能看起来像

```
def method(self):
    self.first_thing = first_func()
    self.second_thing = second_func(self.first_thing)
    self.third_thing = third_func(self.first_thing, self.second_thing) 
```

We still have side effects, `method` sets attributes of the object, but when we go to try to understand how the functions that make it up work together, it's crystal clear that you have to call them in this order and it is also crystal clear what each of them need to do their work.

Also, with the first version, when looking at the implementation of `method`, who knows what other attributes of the object get changed by each function. When looking at the second version, it's plain for all to see that calling `method` changes only three attributes without having to look at the implementation of the functions.

This example might seem simplistic because I crafted it out of thin air for this explanation. I tried my best to convey some real problems that I have when trying to understand code that was written without a certain slight disdain for side effects. Real world code that operates like the first version is harder to understand than real world code that operates like the second version.

My take on side effects, as others have said, is that it is worth while to ask yourself whether the side effects can be moved or avoided and that doing so often results in code that is easier to understand.

# c++ - Eclipse 有两个 C/C++ 索引器（快速且完整）：有什么区别？

> ID：763837
> 
> 赞同：13
> 
> 时间：2009-04-18T17:49:26.793
> 
> 标签：c++, c, eclipse, eclipse-cdt, indexer

Eclipse CDT 为 C/C++ 代码提供了两个索引器（Preferences > C/C++ > Indexer）。有谁知道这两者之间的确切区别是什么？

帮助文件并不完全有启发性：

> “CDT 支持其他索引器的贡献，默认 CDT 版本提供了 2 个索引器：
> 
> *   快速 C/C++ 索引器：提供最快的索引功能 - 声明和交叉引用信息。这是推荐的索引器。
>     
>     
> *   完整的 C/C++ 索引器：以性能为代价提供更准确的索引功能 - 声明和交叉引用信息。”

*更准确*是什么意思：它是否索引更多的东西，如果是，是哪些？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-21T22:23:23.613

这是 CDT 页面的摘录，描述了它们的解析和索引（[CDT/designs/Overview of Parsing](http://wiki.eclipse.org/CDT/designs/Overview_of_Parsing)）。它很好地描述了差异是什么以及快速索引器可能失败的地方：

> 解析和绑定解析是一个缓慢的过程，这是一个问题，因为用户希望内容辅助等代码编辑功能快速。出于这个原因，CDT 将绑定信息存储在称为“索引”或“PDOM”（持久文档对象模型）的磁盘缓存中，以便能够提供快速响应用户请求的功能。
> 
> 构建索引涉及解析项目中的所有代码、解析所有绑定并将这些绑定写入索引。每次用户编辑文件时，索引都会增量更新。
> 
> 旧版本的 CDT 支持三种不同的索引模式，快速索引、完全索引和无索引。默认设置是快速索引器，因为索引大型项目可能是一个耗时的过程。快速索引器和完整索引器之间的区别在于，快速索引器会跳过已经解析过一次的头文件，而完整索引器每次包含头文件时总是会重新解析头文件。然而，重要的是要了解完整的索引器，尽管它的名字，仍然不完全准确。
> 
> 当头文件包含在源文件中时，它受制于当时已定义的任何宏。一些库头文件将宏与预处理器条件 (#ifdefs) 结合使用以部分包含头文件。有时这样的头文件在一个项目中包含不止一次，如果每次包含头文件时，头文件所依赖的宏都不同，那么头文件的不同部分可能包含在不同的源文件中。在这种情况下，两个索引器都不会准确，因为它只会在第一次遇到标头时对其进行索引。
> 
> 完整索引器将重新解析它已经遇到的标头，但不会重新索引它们。因此，包含标头的源文件可能会被更准确地解析，但标头本身只会被索引一次。完整索引器比快速索引器慢得多，因为它会进行额外的解析，但它只是稍微准确一点。出于这个原因，不推荐使用完整索引器，并且已从当前版本的 CDT 中删除。
> 
> 每个项目都有一个与之关联的 PDOM。PDOM 作为平面二进制文件存储在磁盘上。索引器只会索引源文件包含的标头，因此如果项目中有一个 .h 文件不包含在任何 .c 或 .cpp 文件中，那么通常它不会被索引。但是，有一个用于索引项目中所有文件的首选项设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T18:01:52.567

我相信它总是在没有“缓存”的情况下重新解析任何找到/包含的文件。文件内容可能取决于预处理器定义的原因，因此它总是被重新解析。快速解析器假定自从第一次遇到文件以来没有任何变化。

（但我可能是错的）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-20T00:44:57.130

> 有谁知道这两者之间的确切区别是什么？

根据我的经验，大约 32MB 堆。

# c# - 将照片嵌入电子邮件

> ID：763848
> 
> 赞同：1
> 
> 时间：2009-04-18T17:54:45.517
> 
> 标签：c#, html, .net-3.5

我正在编写一个使用 SMTP 服务发送电子邮件的 Windows 应用程序。我想将一些动态创建的图像嵌入到电子邮件内容中。我怎样才能在.NET 中做到这一点？我的电子邮件格式是 HTML。我不想将我的图像托管到照片托管服务。我不想把它作为附件发送。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T20:11:30.523

在您的 MailMessage 对象上，您需要创建一个替代的 HTML 视图。然后将 LinkedResources 添加到您的替代 HTML 视图中。LinkedResource 接受文件或 Stream 对象的位置。为 LinkedResource 提供一个 ID，该 ID 将与您的 HTML 文件中的内容相匹配。

```
MailMessage 信息 = CreateYourMessage();
msg.IsBodyHtml = true;

字符串 html = GetHtmlFromFileOrText();

AlternateView htmlView = AlternateView.CreateAlternateViewFromString(html, Encoding.UTF8, "text/html");

LinkedResource img = new LinkedResource("location_of_image_or_stream_object");
img.ContentId = "Header_Image";
htmlView.LinkedResources.Add(img);

message.AlternateViews.Add(htmlView);

```

您的 html 文件或文本应该有这样的内容

<img src="cid:Header_Image" alt="" title="" />

请注意 cid 应与您的 LinkedResource 的 ContentID 匹配。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T18:06:06.910

这是一些 VB.NET 代码，更改为 C# 应该很简单。它必须附加。这就是 HTML 电子邮件的工作方式。

[http://www.example-code.com/vbdotnet/HtmlWithImage.asp](http://www.example-code.com/vbdotnet/HtmlWithImage.asp)

# c++ - 在 C++ 中将数组作为参数传递

> ID：763861
> 
> 赞同：13
> 
> 时间：2009-04-18T18:01:16.577
> 
> 标签：c++, arrays, sorting, mergesort, divide-and-conquer

我正在编写一个合并排序函数，现在我只是在使用一个测试用例数组（没有输入 - 现在是静态的）。我不知道如何将数组作为参数传递。这是我现在的代码：

```
//merge sort first attempt

#include <iostream>

#include <algorithm>

#include <vector>

int mergeSort(int[]);
int main() {
    int originalarray[] = { 1, 3, 5, 7, 9, 2, 4, 6, 8, 10 };
    mergeSort(originalarray[]);
}

int mergeSort(int[] originalarray) {
    int num = (sizeof(originalarray) / sizeof(int));
    std::vector < int > original(num);

    if (num > 2) {
        return num;
    }

    // Fill the array using the elements of originalarray
    // This is just for demonstration, normally original will be a parameter,
    // so you won't be filling it up with anything.
    std::copy(originalarray, originalarray + num, original.begin());

    // Create farray and sarray of the appropriate size
    std::vector < int > farray(num / 2);
    std::vector < int > sarray(num - farray.size());

    // Fill those using elements from original
    std::copy(original.begin(), original.begin() + farray.size(), farray.begin());
    std::copy(original.begin() + farray.size(), original.end(), sarray.begin());

    mergeSort(farray);
    mergeSort(sarray);
} 
```

请注意，此 mergeSort 函数不起作用，因为我还没有弄清楚如何合并它们（这是我的任务）。我想在处理它之前对我的两个向量进行排序，但我无法编译它，因为我需要将数组作为参数传递。我不明白指针，所以如果这是解决方案，我的借口是无知。我现在正在学习编程，以 C++ 作为第一语言，并且只对语言的特性有一个基本的掌握。谢谢您的帮助。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-04-18T18:24:11.530

只是为了扩展一点，请记住 C++ 数组*正是*C 数组。所以你所拥有的只是一块内存的地址，它声称（没有保证）是一个数组。

### 更新

好的，我们将再扩展一点。

C（以及因此 C++）实际上并没有这样的“数组”。它只有地址，指针。所以当你把某个东西变成一个“数组”时，真正发生的是你告诉编译器某个变量代表一个地址。

在 C 中区分*声明*和*定义*是很有用的。在声明中，您只是简单地给某物一个名称和一个类型；在定义中，您实际上分配了空间。

所以，如果我们从定义一个数组开始

```
int ar[100]; 
```

这意味着我们告诉编译器我们想要 100`int`的空间，我们希望它全部分配在一个块中，我们将使用`ar`它的名称。`sizeof`运算符给出类型或对象使用的字节数，因此我们的数组将`ar`占用 100×`sizeof(int)`字节。在大多数机器上，这将是 400 字节，但它因机器而异。

如果我们定义一个变量

```
int * ar_p;   // using '_p' as a reminder this is a pointer 
```

我们正在为将包含地址的变量定义空间。它的大小将是`sizeof(int*)`，通常是 4 或 8，但在某些机器上可能是 2 到 16 之间的任何值，在某些您不太可能很快遇到的机器上。

数组的*名称*是`ar`。编译器将该名称转换为地址，因此我们可以将该地址保存为

```
ar_p = ar ;     // THIS WORKS 
```

现在，为方便起见，假设我们的数组`ar`恰好从内存中的位置 1000 开始。

该名称`ar`没有分配任何空间*；*它就像一个常数，一个数字。所以，你不能撤销那个任务

```
ar = ar_p ;     // THIS WON'T WORK 
```

出于同样的原因你不能说

```
1000 = ar_p ;   // THIS WON'T WORK EITHER 
```

即，您不能更改 1000 的值。（回到 FORTRAN 的早期版本，由于复杂的原因，这个技巧会起作用。这是一个错误。直到您尝试调试一个程序“2”的值为 3。）

C 中的数组始终从零开始，即第一个索引始终为零。任何其他索引只是使用索引计算的地址。所以，`ar[0]`只是地址 1000 加上 0 字节的偏移量，或者说 1000\. `ar[1]`是 1000 加上大小的 1 倍`int`，所以*下一个*int 结束。事实上，这在 C 中总是正确的。

这称为*数组引用*。

当我们使用语法时，`*ar_p`我们是在告诉编译器从`ar_p`. `。

这称为*取消引用指针*。

如果我们说

```
ar_p = ar; 
```

然后`*ar_p`并`ar[0]`指同一件事。

当我们说`ar[0]`我们告诉编译器我们想要地址 0 字节的东西时`ar`。 `ar[1]`是来自 的地址 1`int`或 4 个字节`ar`。所以，`*(ar_p+3)`指的是同一个东西`ar[3]`。（我们需要括号，因为我们要先将地址加 3，然后再查看内容。 `*ar_p+3`将首先获取指向的内容`ap_p`，然后将其加 3。

问题是，C 不知道或不太关心数组到底有多大。如果我来做`ar[365]`，编译器会很高兴地生成代码来查看单元格 1000+(365× `sizeof(int)`)。如果它在你的数组中，很好，但如果它只是随机内存，那也很好。C不在乎。

（记住 C 来自电话公司。“我们不在乎；我们不必这样做。我们是电话公司。”）

所以，现在，我们知道了一些规则，我已经把它们移到了这里。将“≡”读作“等同于”或“相同于”。

您可以依赖的：

*   `foo(TYPE t[])`≡`foo(TYPE * t)`

由于 C 不知道指针和数组之间的区别，因此您可以声明其中任何一个。当你定义一个函数时，你可以写

```
void foo(int[] ar){ 
```

或者

```
void foo(int* ar){ 
```

并获得完全相同的效果。

*   `t[i]`≡`*(t+i)`

这是上面的。任何你可能写的地方`ar[i]`，你都可以用`*(ar+i)`. （实际上有一个奇怪的案例打破了这一点，但作为初学者你不会遇到它。）

*   其中`TYPE *t`,`(t+i)`将等于`t`plus处的地址`i*sizeof(TYPE)`

上面也解释了这一点。当你索引到一个数组时，比如`ar[42]`，这意味着你想要从起始地址开始的第 42 个。因此，如果您使用`int`的是 ，那么无论宽度有多宽，您都需要移动超过 42 次`int`，也就是说`sizeof(int)`。

现在，这就是 C，而且由于 C++ 被定义为“一种”C，所以它也适用于 C++。除了

*   除非`TYPE`是重载`operator[]`和的用户定义类型`operator*`。

在 C++ 中，您可以决定要定义一个新类型，其行为与任何其他类型一样，但您可以更改语言执行特定操作的方式。因此，程序员*可以*决定用他们自己设计的东西“重载”——即替换——数组引用和指针取消引用运算符的默认行为。作为初学者，您不应该很快面对它，但您应该意识到它。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-18T18:04:15.633

你不应该那样使用`sizeof(originalarray)/sizeof(int)`。它仅适用于静态声明的数组（大小在编译时已知）。您必须将大小连同它一起传递。您为什么不直接`vector`从数组中取出并传递它呢？

*旁注：*根据经验，请始终注意`sizeof`将在编译时进行翻译。所以它不可能知道作为参数传递的数组的大小。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-18T18:07:02.990

我看到你包括`<vector>`. 我建议你不要使用数组，只使用`vector`类。`vector` [您可以在此处](http://www.josuttis.com/libbook/cont/vector1.cpp.html)查看如何使用 STL 容器的示例。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-18T18:06:03.930

*   当您将数组传递给函数时，它们会衰减为指向数组第一个元素的指针，尽管有符号。所以，你没有`sizeof`按预期工作。

*   传入数组时，最好传入数组大小，这样就知道在哪里停下了。将其添加为附加参数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T19:42:24.837

除了上述所有答案，您可能还想查看来自 c-faq.com 的数组问答：http: [//c-faq.com/aryptr/index.html](http://c-faq.com/aryptr/index.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-18T20:35:05.570

不幸的是，很难在 C 或 C++ 中准确地完成您想做的事情。你可以像这样传递一个固定大小的数组：

```
int mergeSort(int originalarray[20])
{
    // do something
} 
```

但是，数组的大小不是由数字定义的，而是由初始化列表中的元素数定义的。

在您的情况下要做的事情（即使这确实是错误的事情）是分两步进行：

```
int originalarray[] = {1, 3, 5, 7, 9, 2, 4, 6, 8, 10};
const size_t arraySize = sizeof originalarray / sizeof originalarray[0];
int mergeSort(int array[arraySize])
{
    // do something
} 
```

太糟糕了，它不会做你需要做的事情：将数组传递给这样的函数会生成数组的副本，而排序的目的是更改原始数组。

实际上，如果不了解“指针”的概念，您将无法再进一步。

你需要开发的功能真的应该是这样的：

```
int originalarray[] = {1, 3, 5, 7, 9, 2, 4, 6, 8, 10};
const size_t arraySize = sizeof originalarray / sizeof originalarray[0];

int mergeSort(int *array, const size_t size)
{
    // do something
}

mergeSort(&(originalArray[0]), arraySize); 
```

换句话说，你传递一个指向第一个元素的指针，以及元素的数量。

或者，您可以处理向量。Vector 将相同的两件事（指向第一个元素的指针和大小）封装在一个称为“对象”的实体中。此外，它还为您管理内存，因此您可以根据需要扩展元素的数量。这是 C++ 的方式。太糟糕了，你不能像数组一样用 {...} 初始化向量。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-19T03:36:40.440

看起来您同时使用了动态分配的数组和向量，而我相信仅使用 std::vector 就足够了。

首先，让您的输入数组更改为 std::vector，并用您的输入数据填充它。

```
int main()
{
   std::vector<int> originalarray;
   for (int data = 1; data <= 10; data++)
   {
      originalarray.push_back(data);
   }
   mergeSort(originaldata);
} 
```

现在重要的是声明您的合并排序函数以引用 std::vector。

```
int mergeSort(std::vector<int>& originalarray)
{
   // The rest of your code, note that now you are passing 
   // in your array for sorting, so you can continue with your code to split
   // the vector into farray and sarray

   // then call sort on your halves.
   mergeSort(farray);
   mergeSort(sarray);

   // I'm guessing at this point you'd write code to combine your farray sarray, and
   // put it back into originalarray...don't forget to clear original array first!
} 
```

请注意，您似乎没有进行就地排序，因此预计您的排序需要一段时间，因为您要复制大量数据。

# delphi - 如果删除的单元仍在其他单元中使用，我清理我的使用子句会有什么不同吗？

> ID：763862
> 
> 赞同：7
> 
> 时间：2009-04-18T18:01:16.937
> 
> 标签：delphi, delphi-units

如果我的`uses`子句尽可能小，我个人喜欢它，但在许多应用程序中，真正的大单元（就膨胀可执行文件而言）喜欢`Forms`或`VirtualTrees`至少在另一个单元中需要。

`uses`所以：即使最终没有从项目中删除任何单元，如果我清理我的条款是否会有所不同？如果真是这样，那么是以哪种方式？并且：清理`uses`条款是应该尽快完成还是可以等到我偶然发现一个未使用的单元？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-18T18:16:01.970

如果它在项目的其他地方使用，它不会有太大的不同，除了产生更易于阅读的更清晰的代码。不过，它可能会影响一些小事情。

编译顺序：编译器根据哪些单元使用哪些单元来决定编译单元的顺序。如果从早期单元的 uses 子句中删除一个单元，这可能会导致在编译周期的后期编译使用的单元。这听起来可能不多，但请记住，**初始化**部分的运行顺序与编译单元的顺序相同。不过，这确实不应该对您的项目产生太大影响。

CodeInsight：当您拉起代码完成下拉菜单时，它将根据当前可用的所有单元提供选择。您可以通过减少您使用的单位数量来减少它必须过滤的选择数量 - 从而减少将血腥的东西拉起来所需的时间！（不，我不苦。你为什么问？）

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-18T18:23:23.140

一般没有。如果一个单元在项目中的任何地方使用过一次，那么再使用多少次并不重要。相反，如果一个单位在某个地方至少使用过一次，那么从多少个地方移除它并不重要。编译后的程序将表现相同，并且大小大致相同。

唯一的区别在于单元初始化和完成部分的顺序。单元使用顺序会影响这些部分的执行顺序，尽管从未记录过确切的效果（所以尽量不要依赖初始化顺序）。

但是我仍然鼓励你清理你的单元列表，出于同样的原因鼓励你清理你的变量列表和参数列表。当您摆脱不需要的东西时，阅读您保留的代码会更容易，因为您可以合理地确信您正在阅读的内容可以准确地了解代码的作用。如果您的代码提到了一堆单元但从未真正使用它们，那么下次您或其他人查看代码时，您将花费一些时间尝试找到您的代码使用这些设施的地方那些单位。（你会对自己说，“嗯，这段代码包括`Graphics`，但我看不到它在哪里绘制任何东西。我最好再看看，因为我认为这段代码没有任何类似的职责。嘿，同事——你能抽出一些时间告诉我这个单位在哪里画东西吗？”）

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-18T19:47:02.283

是的，有**一个技巧**经常被忽视并且可能会在后面咬你：
如果有一些**初始化/完成**代码，即使在你的单元中没有调用其他代码（并且**单元总是包含在内） ，它****也会始终执行**。虽然你认为它不会）。因此，删除项目中不需要的单元可能会产生显着差异。

 **另一件值得注意的事情是，当在 2 个不同的单位中存在**同音异义词时****，单位的顺序决定了编译器选择的标识符，**并且您在不使用单位名称前缀的情况下调用它们（作为最佳实践，您应该始终这样做）。

 **除此之外，正如 Mason 和 Rob 所指出的，单元顺序会影响它们的编译顺序以及初始化/完成的顺序。

至于代码洞察力，如果您删除不必要的单元会更快，但如果您在项目中使用的所有单元都显式添加到 dpr，而不是在通过另一个隐式添加时依赖搜索路径来查找它们，那么全局也会更快单元。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-20T09:32:31.697

我非常不同意 Mason 和 Rob：它确实有所作为！

减少依赖。

正如 Mason 和 Rob 所解释的，不同之处不在当前项目中。相反，不同之处在于您的 NEXT 项目。如果您在（客户端）单元中保留不必要的（服务器）单元，那么在另一个项目中使用该客户端单元也会引入依赖项。如果刚刚引入的单位没有其他合理的客户单位，那么你已经增加了膨胀。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-18T19:19:50.337

使用免费的 Pascal Analyzer 找出代码中未使用的单元。

# ruby-on-rails - 尝试使用 https 时发生乘客崩溃

> ID：763863
> 
> 赞同：0
> 
> 时间：2009-04-18T18:01:51.630
> 
> 标签：ruby-on-rails, ssl, passenger, shared-hosting

我在共享主机帐户上使用 ssl_requirements 插件。该托管服务提供商使用Passenger 来管理Rails。一切正常，直到我尝试转到需要 ssl 的页面（通过添加`ssl_required`过滤器强制执行）。发生这种情况时，Passenger 崩溃并返回 500 错误。错误内容如下：

```
 Passenger encountered the following error:
 The application spawner server exited unexpectedly: Broken pipe

 Exception class:
 PhusionPassenger::Railz::ApplicationSpawner::Error 
```

这是一个基本场景：

1.  用户正在使用 http 浏览非敏感数据。
2.  用户转到注册表单（需要 https）
3.  Ssl_requirement 发现用户没有使用正确的协议并将他们重定向到使用 https 的 url。
4.  乘客收到此请求并尝试生成一个新的 Rails 应用程序。
5.  当它使用[spawn_application](http://manalang.com/bdoc/rdoc/passenger-2.1.2/rdoc/classes/PhusionPassenger/Railz/ApplicationSpawner.html#M000053)方法时，它会遇到错误并崩溃

问题是我不知道问题出在哪里。我不认为这可能是 https 的问题，因为我可以手动输入 https 前缀并且一切正常。我认为问题在于 ssl_requirement 插件或乘客处理这个新 https 请求的方式。

大家有遇到过这样的场景吗？如果是这样，您能否指出一些资源来解决这个问题？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-20T20:27:46.470

您可能会收到Passenger 错误，因为DreamHost 因使用过多内存而终止了您的应用程序。

鉴于您使用的是 spawn，这可能是原因 - spawn 创建了一个全新的 Rails 进程。

尝试做一些不涉及产生新应用程序实例的事情。但是，我敢打赌，这不是 SSL 的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T02:03:20.310

您是否有权访问自己的虚拟主机 Apache 配置？如果是这样，那么我建议您将其配置为使用 Redirect 指令从 http URL 重定向到 https URL，而不是使用 ssl_requirement。我已经和Passenger一起这样做了，一切都很好。（因此，Passenger 处理 https 或 ssl 没有问题。我的猜测是 ssl_requirement 插件和Passenger 之间存在一些不兼容。）

# objective-c - 你如何翻转 NSView 的坐标系？

> ID：763867
> 
> 赞同：29
> 
> 时间：2009-04-18T18:04:08.460
> 
> 标签：objective-c, cocoa

我在界面构建器中创建了一个 NSScrollView，它具有可变数量的半唯一 NSView，可以通过编程方式从其中添加和删除。当我将 subViews 添加到 documentView 时，它们出现在左下角而不是左上角。我看到您可以检查 isFlipped bool 以确定视图的坐标系是否已翻转，但我找不到将其设置为翻转的方法。

有人知道我错过了什么吗？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-04-18T19:14:55.013

在您的`NSView`子类中，覆盖`isFlipped`：

> # 被翻转
> 
> 一个布尔值，指示视图是否使用翻转坐标系。
> 
> ## 宣言
> 
> ```
> var isFlipped: Bool { get } 
> ```
> 
> ## 讨论
> 
> 此属性的默认值为 ，这`false`将导致非翻转坐标系。
> 
> [...]
> 
> 如果您希望您的视图使用翻转坐标系，请覆盖此属性并返回`true`。

^(来源：[isFlipped - NSView | 苹果开发者文档](https://developer.apple.com/documentation/appkit/nsview/1483532-isflipped))

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2014-11-11T02:42:08.740

对于希望在 Swift 中执行此操作的任何人，以下是您在自定义类中覆盖的方式：

```
class FlippedView: NSView {
    override var isFlipped {
        get {
            return true
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2016-11-02T13:28:03.963

这个想法是每个单独的视图都有自己的绘制方式（例如，使用人工计算的路径），如果你突然翻转它的坐标平面，可能会变得非常不稳定（光栅可能很好，而路径可能会颠倒，计算可能会把东西放在屏幕外，贝塞尔控制点可能会扭曲，等等）。所以它不是可设置的，但子类可以指定`isFlipped`，因为它们肯定知道视图是如何绘制的。

子类也可以使其可设置，但他们必须期望它随时更改。

至于代码，这是[Jay](https://stackoverflow.com/a/26856580/3939277)在**Swift 5**中的回答：

```
open class FlippedView: NSView {
    override var isFlipped: Bool { true }
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2019-03-06T16:06:41.497

既然[Carl Carlson 问](https://stackoverflow.com/questions/763867/how-do-you-flip-the-coordinate-system-of-an-nsview/40381180#comment69507620_763987)了，这里是[Jay](https://stackoverflow.com/a/26856580/3939277)在 Objective-C 中的回答：

### 标题 ( `.h`)

```
@interface XYZFlippedView: NSView

- (BOOL) isFlipped;

@end 
```

### 实施 ( `.m`)

```
@implementation XYZFlippedView

- (BOOL) isFlipped
{
    return YES;
}

@end 
```

# wpf - WPF 框架访问父页面控件

> ID：763876
> 
> 赞同：1
> 
> 时间：2009-04-18T18:07:23.613
> 
> 标签：wpf, parent, frame

我有一个包含列表框和框架的 WPF 页面。框架具有加载到其中的各种页面，这些页面由列表框中的选择决定。

框架内的每一页都有各种不同的输入框，并有一个保存取消按钮。单击“保存”按钮时，我需要将内容保存到数据库中，并刷新父页面中的列表框以反映新数据。

保存数据很容易，但是当从框架内的页面调用它时，如何在父页面中启动列表框内容的刷新？

我需要以某种方式能够访问父页面控件来执行此操作。

有任何想法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-18T22:04:32.797

从技术上讲，可以进入父控件并使用它包含的控件，但它会导致代码非常难以维护，因为如果您更改父控件的结构，您会破坏所有包含的代码页。这将被认为是一个非常紧密耦合的设计，而且它通常很脆弱。

一个更简洁的设计是让您的页面类在按下 Save 按钮时引发一个事件。然后，您的父框架可以接收事件并刷新它知道在保存操作后需要刷新的任何内容。这更容易维护，因为您的组件更松散耦合，但它仍然将大量数据库知识放入您的 GUI 组件中。这样的设计可能适用于相对简单的应用程序，您不希望在其上进行大量维护或未来增强。

我喜欢的设计模式（和许多开发人员一样）是将数据库处理和业务逻辑隔离在一个或多个类中，并使用易于测试的简单编程接口。GUI 组件尽可能保持简单和精简，因此可以在必要时轻松更改它们。这通常被称为模型-视图-控制器模式，但它还有其他名称。在您的示例中，封装业务逻辑的“控制器”类将具有用于读取和设置信息的属性和方法，以及将更改写入数据库的“保存”或“提交”方法。保存完成后，它会引发“已保存”或“已更改”事件，通知所有控件（“视图”

# ruby-on-rails - ruby on rails 固定装置中的自动关联

> ID：763881
> 
> 赞同：18
> 
> 时间：2009-04-18T18:11:51.297
> 
> 标签：ruby-on-rails, ruby, fixtures

如[本文](http://api.rubyonrails.org/v2.3.8/classes/Fixtures.html)所述，我在夹具中使用自动关联。例如，如果一个区域对象有一个国家/地区 id，而不是执行“country_id”：1，我执行“country”：“USA”。“USA”是我的 countries.yml 文件中的一个标签，所以fixtures 知道如何处理这个问题。但是，这仅在您没有为国家对象指定 ID 值时才有效。所以我不能将美国的 ID 指定为 1。但如果我不将它指定为 1，它最终会是一个很大的值 8974343 ......这有点奇怪。有没有办法让固定装置自动生成不是超高的 id？....或者这样可以吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2010-07-14T08:00:58.147

这就是你如何获得夹具标签的自动生成的 id。

```
Fixtures.identify(:reginald) 
```

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-04-18T18:25:54.600

阅读 API 文档，这正是自动生成的夹具应该如何表现的——如果您想提前为夹具指定一个特定的 ID 值，您可能应该自己分配它。

如果没有，那么从 API 文档：

```
The generated ID for a given label is constant, so we can discover any fixture‘s ID without loading anything, as long as we know the label. 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2014-04-09T11:47:54.623

由于我没有足够的声誉发表评论，这是实际的 Rails 4.1 文档：

[http://edgeapi.rubyonrails.org/classes/ActiveRecord/FixtureSet.html#class-ActiveRecord::FixtureSet-label-Fixture+label+interpolation](http://edgeapi.rubyonrails.org/classes/ActiveRecord/FixtureSet.html#class-ActiveRecord::FixtureSet-label-Fixture+label+interpolation)

在夹具标签插值下：

```
monkey_id: <%= ActiveRecord::FixtureSet.identify(:reginald) %>
pirate_id: <%= ActiveRecord::FixtureSet.identify(:george) %> 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-07-12T02:21:17.250

夹具的 id 直接来自其名称的散列（这就是“只要我们知道标签，我们就可以在不加载任何东西的情况下发现任何夹具的 ID”）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-08-18T20:05:59.100

自动化测试以强制夹具完整性

```
 class FixtureIntegrityTest < ActiveSupport::TestCase
    context "fixture integrity" do
      should "work" do
        fixtures = Dir["test/fixtures/*.yml"].map do |file|
          [file, File.basename(file).sub(/\..*/, "").singularize, YAML.load(ERB.new(File.read(file)).result)]
        end

        failures = fixtures.reject(&:last).map { |file,*| "#{file} is empty!"}

        failures = failures.presence || fixtures.map do |_, klass, content|
          content.select{ |_,fixture| fixture["id"] }.map do |name, _|
            fixtures.map do |file, _, content|
              content.select { |_,fixture| fixture[klass] == name }.map do |_, fixture|
                "#{file} uses #{klass}: #{name}, but should use the id!"
              end
            end
          end
        end.flatten.compact

        assert_equal [], failures
      end
    end
  end 
```

# ms-access - MS Access (JET) 是否适合多用户访问？

> ID：763888
> 
> 赞同：17
> 
> 时间：2009-04-18T18:18:17.223
> 
> 标签：ms-access, multi-user

我有一个产品设计为使用 MS Access 文件作为数据库的桌面产品。

现在，一些用户需要将它安装在几台 PC（比如说 2 或 3 台）上并共享数据库。

我想将 MS Access 文件放在共享文件夹中并从 PC 访问它，但是...... JET 引擎是为多用户访问而设计的？

有什么提示或事情要注意这样做吗？

编辑：该应用程序是一个 .net 应用程序，使用数据库作为存储（不使用数据库作为前端）

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-19T21:53:43.327

这个帖子的答案中有太多错误信息，我不知道从哪里开始。我刚刚花了 4 分的信誉投票否决了带有误导性和错误信息的答案。

1.  Jet 数据库引擎（这就是这里所涉及的所有内容，正如 OP 通过编辑澄清的那样）默认情况下是多用户的——它是从头开始构建的。

2.  当网络不低于标准时，共享 Jet 数据存储*非常可靠。*这意味着不是 WAN 也不是无线，因为带宽必须足以让 Jet 维护 LDB 文件（用于多用户锁定），这意味着您的本地 PC 的 Jet 数据库引擎实例每秒 ping 一次（使用默认设置），并且因为 Jet 无法从断开的连接中恢复（这在无线环境中很常见）。

3.  Access 崩溃的情况是共享前端 Access 应用程序 MDB 时（此海报不是这种情况）。它失败的原因是因为您正在共享无法可靠共享且没有理由共享的内容。由于 Access 对象存储在 MDB 文件中的方式（整个 Access 项目存储在其中一个系统表的一条记录中的单个 BLOB 字段中），如果多个用户打开它很容易损坏。据我估计，在一个 MDB 中共享一个 Access 前端（或一个未拆分的 MDB 与表和表单/报告/等全部在一个 MDB 中）是 Access/Jet 文件损坏的 99.99% 的来源。

我对 OP 问题的基本回答是，是的，Jet 对于这种大小的应用程序来说将是一个很好的数据存储。但是，如果用户数量完全有可能增长到 25 人以上，那么最好从头开始使用在更高用户数量下更强大的数据库引擎。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-18T18:31:09.923

这样做是完全可行的；但是您必须将数据库拆分为前端（带有表单、查询、代码）和后端（仅数据）。每个用户都必须在自己的计算机上拥有前端，并链接到共享的后端。

它会很慢，因为 Jet 会产生大量的网络流量。Microsoft 也逐渐弃用 Access 作为开发工具。例如，Access 2007 的安全模型远不如 Access 2003 复杂。

作为一名长期的 Access 开发人员，我正在逐渐远离 Access。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-18T18:22:32.080

不要这样做... Jet 数据库声称能够支持多个用户，但是使用升迁向导将您的 Access 文件转换为 Sql Express 数据库非常容易。该数据库文件很容易被用户或管理员锁定，并且您的所有用户都将无法使用该数据库。

...而且[Sql Express 是免费的](http://www.microsoft.com/exPress/download/)。从那里升级到完整的 Sql Server 实例或其他商业数据库的路径很简单。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-18T18:38:06.303

在可靠的本地网络上有 2 或 3 个用户应该没问题，只要您经常备份网络驱动器。

避免表中的任何位/布尔字段 - Jet 有一些令人讨厌的损坏问题，可以多次访问它们。

还要记住，Access 中的所有锁定都是乐观的：您偶尔会收到脏读。

MS Access 专为像这样的小型办公场景而设计：您可以通过最少的编程进行设置的非关键轻型办公用途。

预计数据文件会不时损坏 - 定期备份。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-20T08:23:36.387

ACE/Jet 引擎是一款很棒的软件，虽然它*旨在*支持多用户，但实际上支持多用户并不是它的强项之一。对我来说最后一根稻草是从引擎中删除用户级安全性（ULS）的地方：我想我可以想象一个简单的数据库情况，所有用户都将拥有相同的权限（即对*所有*数据库对象的管理员访问权限）但 IMO 不是与 MS SQL Server 相比，可以很好地支持多个用户。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-18T18:26:45.877

是的，它支持多个（即，工作组大小的小数量）用户通过网络文件共享进行访问。但是，文件共享架构根本不适合支持多个用户同时写入文件。客户端/服务器数据库系统（SQL Server 等）通常提供更好的性能、安全性和可靠性。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-18T18:35:45.170

作为系统管理员，请不要将 Access 用于任何多用户。执行 Jeff Fritz 的建议并使用专为多用户访问而设计的数据库。您可能会认为您的小应用程序只会在少数人之间共享，但我向您保证，到今年年底它将拥有一百个用户和五十个新功能。如果这些都是 Access，而不是 VB/SQL Express，那么您的 Ops 人员会在一天晚上闯入您的房子并割断您的喉咙。

Access 不是客户端-服务器应用程序，在备份/恢复或任何自动化方面提供的功能很少。更不用说界面和数据库是非常紧密耦合的......所以如果你想把它变成一个网络应用程序，或者做出任何重大的改变，你的世界将充满痛苦。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-20T08:43:20.537

很多通用软件工程师已经做过很多次了，我们已经看到 .mdb 在多用户情况下损坏。如果这么多经验丰富的专业 Access 开发人员能够做到这一点，正如我倾向于相信的那样，那么我们这些通才一定是做错了什么，而且对于我们这么多人逃避事情来说，事情一定是相当基本但不明显的尖叫着“再也不会！” 因此，如果您认为自己是一位经验丰富的专业 Access 开发人员（或者您知道如何找到），那就去吧。但是，如果您是寻求轻量级后端的通才或临时用户，那么我建议您寻找其他地方（SQL Server 是很好的 IMO）。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-20T19:46:50.927

如果您的用户可以等待两倍的时间来获得具有一半功能的应用程序，那么请不要使用 Access。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-18T18:26:43.053

Jet 没有支持多用户方案所需的复杂锁定逻辑。如果您的应用程序主要是读取和低争用，您可以使用它。

我已经看到网站支持许多用户，但我会推荐 SQL Express，除非您有令人信服的理由选择 Jet。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-11-10T21:58:38.897

如果您使用终端服务器，则性能非常好。我们在一个 Access mdb 上有更多解决方案，最多可容纳 50 个用户。开发速度非常快，部署也很容易。

问题：

*   每个人都可以复制数据 mdb
*   没有访问权限
*   有限的商店程序
*   优化（压缩和修复）只能在不使用数据数据库的情况下进行
*   限制为 2 GB！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-12-30T03:39:29.370

我可以从痛苦的经历告诉你 Jet 3/3.5 并不可靠。我看到它在轻负载下经常崩溃，当发生崩溃时，您可能会面临数据损坏的风险。它曾经对任何电源问题、任何客户端崩溃（甚至是链接到 mdb 的 UI）和任何 LAN 问题都极为敏感。最新版本的 Jet 可能会更好，但在我看来，除了少量用户的琐碎数据输入之外，切换到 Sql Server 显然是一种方法。Sql Express 是免费的，您不会真正失去任何东西，特别是如果您的 UI 是在 .Net 中，而不是在 Access 中。

编辑：微软也不认为你应该依赖 Jet 4。

来自： http: [//support.microsoft.com/kb/303528](http://support.microsoft.com/kb/303528)

Microsoft Jet 不适用于高压力服务器应用程序、高并发服务器应用程序或每周 7 天、每天 24 小时的服务器应用程序。这包括服务器应用程序，例如 Web 应用程序、商务应用程序、事务应用程序和消息传递服务器应用程序。对于这些类型的应用程序，最好的解决方案是切换到真正的基于客户端/服务器的数据库系统，例如 Microsoft 数据引擎 (MSDE) 或 Microsoft SQL Server。在 Microsoft Internet Information Server (IIS) 等高压力应用程序中使用 Microsoft Jet 时，您可能会遇到以下任一问题： 数据库损坏 稳定性问题，例如 IIS 崩溃或锁定 驱动程序突然故障或持续故障连接到需要重新启动 IIS 服务的有效数据库

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-05-30T16:26:42.327

只需检查数据库锁定文件（如 .ldb）是否存在。如果它在那里，则有人正在访问该文件。如果它不存在，目前没有人访问该文件，您可以继续。否则，请等待该文件 (.ldb) 不再存在。

# dynamic - 通过 gdb 打印完整的控制流，包括变量的值

> ID：763891
> 
> 赞同：3
> 
> 时间：2009-04-18T18:20:34.847
> 
> 标签：dynamic, gdb, call-graph

这个想法是，给定程序的特定输入，我想以某种方式自动介入整个程序并转储其控制流以及所有正在使用的数据，如类及其变量。他们是一种直接的方法吗？或者这可以通过 gdb 上的一些脚本来完成，还是需要在 gdb 中进行修改？

好的，这个问题的原因是因为关于调试工具的想法。它的作用是这样的。给定程序的两种不同输入，一种导致不正确的输出，另一种导致正确的输出，它将告诉控制流的哪一部分对它们不同。

所以我认为需要将这两个控制流完全转储到差异引擎中。如果这两个输入遵循相似的控制流，那么它们的差异（在许多情况下）会很好地说明为什么存在错误。

这可以成为一个非常吸引人的工具，在此基础上构建了许多功能。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T21:09:36.080

告诉我们更多关于环境的信息。例如，dtrace 将在 Solaris 或 Leopard 中完成这项工作。gprof 是另一种可能性。

可以使用*yes(1)*或*expect(1)*来完成这种颠簸版本。

如果您想花哨，可以在某些版本中[使用 Python 编写 GDB 脚本。](http://sources.redhat.com/gdb/current/onlinedocs/gdb_22.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-10-09T19:59:13.113

您所描述的内容听起来有点像 gdb 的“跟踪点调试”。请参阅 gdb 的内部帮助“帮助跟踪点”。您还可以在此处查看白皮书：http: [//sourceware.org/gdb/talks/esc-west-1999/](http://sourceware.org/gdb/talks/esc-west-1999/)

不幸的是，目前还没有为本地调试实现此功能，但我相信 CodeSourcery 正在为此做一些工作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-14T02:59:03.407

看看这个，与 Coverity 不同，Fenris 是免费的并且被广泛使用。

[如何在 GDB 中自动打印下 N 个执行的行？](https://stackoverflow.com/questions/764382/automate-tracing-in-gdb/1123188#1123188)

# javascript - 弹出窗口中的 Ext Dependency Builder

> ID：763897
> 
> 赞同：1
> 
> 时间：2009-04-18T18:23:22.377
> 
> 标签：javascript, extjs, popup

我有一个让我发疯的大问题......我想在弹出窗口中添加一个“Ext Dependency Builder”组件......使用这里的组件：“ [http://extjs.com/deploy/ext/docs /index.html](http://extjs.com/deploy/ext/docs/index.html) "

> dialog = new Ext.LayoutDialog("name1", {布局参数})

其中“name1”是我的主 jsp 页面上 div 的名称。

我需要添加一个`Ext.BorderLayout("name2", {layout parameters})`

所以我想我应该使用另一个 id="name2" 的 div ... div name2 是否包含在 name1 中或者我应该如何使用它们？？？

任何帮助/示例将不胜感激:)

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-08T14:20:46.420

这些组件是 Ext 1.1 的一部分。当前的标准是 Ext 2.2，3.0 可能会在 6 月发布。API 在 1.x 和 2.x 之间发生了显着变化（升级到 3 非常向后兼容 2.x）。您可以在以下位置查看 2.x 的示例和演示页面：

[http://extjs.com/deploy/dev/examples/samples.html](http://extjs.com/deploy/dev/examples/samples.html)

和 API 文档：

[http://extjs.com/deploy/dev/docs/](http://extjs.com/deploy/dev/docs/)

此外，如果您访问下载页面，您会发现 Ext 3.0 RC 下载以及 2.2 下载（据我所知，1.1 不再可供下载）。

要在 2.x/3.x 中获得 BorderLayout，您将拥有如下内容：

```
var myModalWindow = new Ext.Window({
    applyTo:'name1',
    layout: 'border',
    items:[{
        region:'north',
        html:'<h1>This is a header of some kind</h1>'
    },{
        region:'west',
        xtype:'tree',
        // The rest of my TreePanel config
    },{
        region:'center',
        xtype:'tabpanel',
        activeTab:0,
        items:[{
            xtype:'grid',
            // the rest of my GridPanel config
        },{
            xtype:'form',
            // the rest of my FormPanel config
        }]
    }]
});
myModalWindow.show(); 
```

# sql - 将我的 MS SQL Server 知识转移到 MySQL 的学习资源

> ID：763900
> 
> 赞同：1
> 
> 时间：2009-04-18T18:24:57.550
> 
> 标签：sql, mysql

我是一位经验丰富的 MS SQL Server 开发人员
，但是在我的第一个 MySQL 项目中，我遇到了一些非常简单的问题
所以任何人都可以建议好的资源来帮助我将我的 MS SQL Server 知识转移到 MySQL
我不是在寻找 MySQL 的完整参考指南
我正在寻找针对有经验的 SQL 开发人员的东西

**编辑**：这是我遇到的问题示例（感谢[Neil Butterworth](https://stackoverflow.com/users/69307/neil-butterworth)）
1- 在哪里写我的第一个“select * from”，现在我知道了-
我必须[下载 MySQL](http://dev.mysql.com/downloads/mysql/5.1.html#downloads) IDE 不附带
- 我可以选择[SQLyog](http://www.webyog.com/en/download_form.php?url=http%3A%2F%2Fwww.webyog.com%2Fdownloads%2FSQLyog805.exe)作为 MySQL IDE

2- 如何在同一个查询中执行多个 sql 语句（[完成](https://stackoverflow.com/questions/763442/what-is-the-equivalent-of-go-in-mysql)）
3- 如何声明变量（[完成](https://stackoverflow.com/questions/763718/whats-wrong-with-this-mysql-statement-declare-id-int)）
4- 如何编写简单游标（仍在尝试）
5- 如何通过 MySQL 查询而不是通过 IDE 将主键添加到现有表（仍在尝试） 6- [Wamp Server](http://www.wampserver.com/en/)
之间有什么不同和 [MySQL + SQLyog]（仍在尝试）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T18:46:18.390

这是一个很好的起点： [从 MS SQL 迁移到 MySQL](http://dev.mysql.com/tech-resources/articles/migrating-from-microsoft.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T18:28:50.880

可能不会有任何指南可以解决您的具体问题，所以我只建议阅读 MySQL 网站上的优秀文档。如果您有一个导致悲伤的特定问题，并且文档中没有解决，请在此处询问。

# javascript - jQuery 更改 Div 按钮状态并单击禁用

> ID：763909
> 
> 赞同：4
> 
> 时间：2009-04-18T18:28:09.913
> 
> 标签：javascript, jquery, css, user-interface, frontend

下面的 javascript jQuery 代码有效，但我想向按钮的状态添加 2 个功能。

1.  当用户单击其中一个按钮时，未单击的另一个按钮将获得一个新类（外观）。

2.  两个按钮的状态都应更改为不可点击。

```
[div id="1" class="__button_image"] [/div]
[div id="2" class="__button_image"] [/div]

```

```
$("div.__button_image").mouseover(function () {
    $(this).addClass("__button_image_hover");
});

$("div.__button_image").mouseout(function () {
    jq(this).removeClass("__button_image_hover");
});

$("div.__button_image").click(function () {
    $(this).removeClass("__button_image_hover");
    $(this).addClass("__button_image_clicked");

    jQuery.get('/do/request');        
});

```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-20T21:58:31.453

这是我使用的最终代码：

```
$("div.__button_image").mouseover(function () {
    $(this).addClass("__button_image_hover");
});

$("div.__button_image").mouseout(function () {
    $(this).removeClass("__button_image_hover");
});

$("div.__button_image").click(function () {

    /** change button look to 'clicked' */
    $(this).addClass("__button_image_clicked");

    /** get the id of the current button */
    b_id = $(this).attr('id');

    /** unbind both vote buttons for *no* interaction */
    $("div.__button_image").unbind('click');
    $("div.__button_image").unbind('mouseover');
    $("div.__button_image").unbind('mouseout');

    /**
     * wire the .each function to iterate the classes 
     * so we can change the look of the one that was 
     * not clicked.
    */
    $('div.__button_image').each(function() {
      button_id = $(this).attr('id');
      if(button_id!=b_id) {
         $('#'+button_id).removeClass("__button_image");
         $('#'+button_id).addClass("__button_image_gray");  

    }
});

jQuery.get('/do/request?id='+b_id); 
$(this).parent().css('cursor', 'default'); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-18T18:38:19.423

有什么问题？我唯一能看到你失踪的是

```
$("div.__button_image").unbind('click'); 
```

这将删除“点击”处理程序（将其设置回默认值）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-19T19:17:59.210

我会将您的 click() 处理程序更改为：

```
$("div.__button_image").click(function () { 
    $(this).removeClass("__button_image_hover");
    $(this).addClass("__button_image_clicked");

    /*
     * Add look class to all buttons, then remove it from this one
     */
    $("div.__button_image").addClass("look");
    $(this).removeClass("look");

    /*
     * Remove click handler from all buttons
     */
    $("div.__button_image").unbind('click');

    jQuery.get('/do/request');        
}); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-11-04T22:00:04.600

这总是对我有用（也将不透明度更改为 80% 并将光标更改为等待）

```
$("#buttonDivId").css({opacity: 0.8, cursor: "wait"}).prop("disabled", true); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-12-19T00:46:20.093

如果您使用的是 JQuery UI，则可以使用 disable 方法。

```
$("selector").button("disable"); 
```

[http://api.jqueryui.com/button/](http://api.jqueryui.com/button/)

# wolfram-mathematica - FactorInteger 的替代形式？（数学）

> ID：763915
> 
> 赞同：6
> 
> 时间：2009-04-18T18:29:24.810
> 
> 标签：wolfram-mathematica

在数学中

```
a = FactorInteger[44420069694] 
```

分配

```
{{2, 1}, {3, 1}, {7, 1}, {11, 2}, {13, 1}, {23, 2}, {31, 1}, {41, 1}} 
```

到一个。现在，我希望扩展每个列表，而不是带有指数的因子。上面的分解将变成

```
{2, 3, 7, 11, 11, 13, 23, 23, 31, 41} 
```

我写了以下函数：

```
b = {}; Do[Do[b = Append[b, a[[i]][[1]]], {a[[i]][[2]]}], {i, Length[a]}] 
```

但如果你问我，它看起来很丑。肯定必须有一种更简洁的方法来实现这一目标吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-18T18:36:44.463

是的，例如：

```
Flatten[Map[Table[#[[1]], {#[[2]]}] &, a]] 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-02-20T22:55:22.323

Mathematica 6 或更高版本中的另一种方式。

在：=`Flatten[ConstantArray @@@ a]`

输出=`{2, 3, 7, 11, 11, 13, 23, 23, 31, 41}`

更短：

`Join @@ ConstantArray @@@ a`

* * *

## 发布的方法的速度比较

使用这些功能（按它们发布的顺序）：

```
zvrba = Flatten[Map[Table[#[[1]], {#[[2]]}] &, #]] &;
dreeves = Sequence @@ Table[#1, {#2}] & @@@ # &;
gdelfino = Flatten[# /. {p_, n_} :> Table[p, {n}]] &;
mrwizard = Join @@ ConstantArray @@@ # &;
sasha = Function[{p, e}, Array[p &, e, 1, Sequence]] @@@ # &; 
```

并分别给它们分配字母 Z、D、G、M、S，这是它们效率的时序图。

首先，为了增加输入中的列表数量：

![在此处输入图像描述](https://i.stack.imgur.com/OYkbx.gif)

其次，为了增加每个列表中的指数（重复长度）：

![在此处输入图像描述](https://i.stack.imgur.com/7kQsD.gif)

请注意，这些图表是对数的。越低越好。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-19T06:38:01.720

这是另一种方法：

```
rptseq[x_, n_] := Sequence @@ Table[x, {n}]
rptseq @@@ a 
```

可以用 lambda 函数将其浓缩为：

```
Sequence @@ Table[#1, {#2}] & @@@ a 
```

zvrba 的回答也可以浓缩一点，如果你喜欢这样的事情：

```
Flatten[Table[#1, {#2}]& @@@ a] 
```

（现在我看到了，我猜我的版本是 zvrba 的一个非常小的变体。）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-23T14:57:57.490

您还可以使用：

```
a /. {p_, n_} -> Table[p, {n}] // Flatten 
```

**2017 年 10 月 18 日更新**：

正如 Cory Walker 所指出的，我上面的答案“在两个不同的主要因素的情况下”失败了。此更新修复了它：

```
a /. {p_Integer, n_Integer} -> Table[p, {n}] // Flatten 
```

请注意，Mr Wizard 所做的基准测试是使用此更新之前的原始版本完成的。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-02-21T00:36:47.180

也可以使用 Array 来处理答案。这是执行此操作的简短代码：

```
In[11]:= PrimeFactorInteger[i_Integer] := 
 Function[{p, e}, Array[p &, e, 1, Sequence]] @@@ FactorInteger[i]

In[12]:= PrimeFactorInteger[2^3 3^2 5]

Out[12]= {2, 2, 2, 3, 3, 5} 
```

# c - 替换函数中的变量的 MS 编译器优化？

> ID：763920
> 
> 赞同：3
> 
> 时间：2009-04-18T18:33:19.620
> 
> 标签：c, optimization, visual-studio-2005

我不知道如何解释我看到的行为，但这里有。

我有一个函数 foo，它接受三个参数、一个指针、一个 int 和另一个指针。当我在 foo 内部断点时，我可以清楚地看到所有变量都是它们应该是的值。但是，当我退出局部变量声明时，其中一个参数（int）突然变为零。但是，函数的其余部分就像原始值一样执行，所以一切都很好。

这不会在完全调试中发生，但会在常规调试中发生。这是某种优化吗？如果是这样，它叫什么，我在哪里可以获得详细信息？

例子：

```
void foo(void *A, int B, void *C)
{
  // B == 5
  int X = 3;
  char *Y = getSomeStaticString();
  // ... some other variable declarations like the above

  // B, according to the debugger, is now 0
  if (B == 5) {
    // But this still executes
  }
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-18T18:35:13.440

您正在调试优化的代码。不能信任局部变量——编译器可以自由地重用它们的空间，将它们缓存在寄存器中，等等。

您可能看到的是 B 被缓存在一个寄存器中，并且它的堆栈位置正在被其他一些变量重用。

这里有类似的问题：[优化能否影响使用其 PDB 调试 VC++ 应用程序的能力？](https://stackoverflow.com/questions/563000/can-optimizations-affect-the-ability-to-debug-a-vc-app-using-its-pdb/567886)

# delphi - 有人知道 Graphics32 的当前状态吗？

> ID：763922
> 
> 赞同：5
> 
> 时间：2009-04-18T18:35:09.210
> 
> 标签：delphi, delphi-2010, graphics32

[Graphics32](http://www.graphics32.org/) 1.8.3的最后一个版本发布于 2007 年 3 月。

什么时候会有*正式*的Delphi 2010 兼容版本？

Graphics32 是否有任何公共 SCM 存储库？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-09-02T16:04:02.693

还没有正式发布，但我一直在尝试以局外人的身份推动事情向前发展。现在有一个可用于 D2009/D2010 的端口。目前，在发布正式版本之前，可以从我们的一个 Web 服务器下载这些端口。请参阅此处的通知：[Graphics32 RadStudio 2010](https://forums.embarcadero.com/message.jspa?messageID=154673)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T18:42:05.717

您可以尝试在此处的邮件列表中询问：[news.graphics32.org](http://news.graphics32.org)。[在该页面上搜索“delphi 2009”](http://graphics32.org/news/newsgroups.php?search_txt=%22delphi+2009%22&search=Search&group=graphics32.general)当前会产生以下结果：

[Graphic32 和德尔福 2009](http://graphics32.org/news/newsgroups.php?art_group=graphics32.general&article_id=8832)

不，没有公共 SCM 存储库。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-06-15T08:19:06.340

现在有一个[1.9 版本](http://graphics32.org/wiki/Main/Release)（2010 年 3 月），支持 Delphi 2010。项目还活着！看看[变化](http://graphics32.org/documentation/Docs/Overview/Changes.htm)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-12-30T03:33:32.813

碰到这个问题：Graphics32 现在托管在 Sourceforge 上，截至 2009 年 10 月。仍然没有新版本或对 Delphi 2009 或 2010 的官方支持。

# java - 将 Java Applet 上传到网页

> ID：763925
> 
> 赞同：1
> 
> 时间：2009-04-18T18:36:06.230
> 
> 标签：java, php, html, applet

我使用 netbeans 6.0 创建了一个 java 字母游戏小程序，它还有一个用于高分的 Microsoft Access 数据库。我想把它上传到一个网页上（比如它是如何在 miniclip facebook 等上完成的）我想知道它是如何完成的

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T18:54:15.360

我不确定“将其上传到网页中”是什么意思。[`<applet>`小程序使用标签](http://java.sun.com/docs/books/tutorial/deployment/applet/html.html)或[`<object>`标签](http://www.w3schools.com/TAGS/tag_object.asp)嵌入到网页中。但是，Access DB 可能会成为一个问题，因为它不适合具有潜在许多并发用户的 Internet 应用程序。

此外，直接从小程序访问数据库是一个非常糟糕的主意，因为小程序代码（每个人都可以全局访问）将需要包含数据库用户和密码，这意味着每个费心反编译小程序的人都可以做任何事情他们希望（并且允许该用户）使用数据库。至少，他们将能够进入童话般的高分（例如，5000 万，而完美的游戏让您获得 1000 分）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T19:55:32.433

正如 Michal Borgwardt 所说，为了将实际的小程序放在您的页面上，您需要上传已编译的类文件，然后使用小程序或对象标记。

对于高分，您需要在您的 Web 服务器上使用一个数据库（例如 MySQL）并编写一个使用 PHP 或 ASP 或您选择的其他 Web 语言与其接口的页面。然后，您将让小程序打开指定页面，并为其提供玩家姓名、分数等的 POST 参数。此外，由于此类事情可能会被欺骗，您需要找到一种方法来防止人们自己打开页面带有虚假名称和分数条目。

# javascript - 在不同的范围内操作

> ID：763927
> 
> 赞同：2
> 
> 时间：2009-04-18T18:36:39.957
> 
> 标签：javascript, jquery, html, css

我想知道是否可以完成以下操作。

我有一个我在表格中显示的“费用”列表。4 列 - 金额、日期、地点和内容。

我在想我想通过 jQuery 使每个可点击，这将扩展该特定费用，内联，以显示更详细的描述。

我想要做的是，点击时，用一个包含扩展信息的“td”替换“tr”的内容。问题是 'td' 只扩展到大约四分之一的表格。有没有办法让它延伸到整行，同时保持其他行中其他'td'的宽度？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-18T18:49:00.363

这就是我要做的。[**工作演示**](http://jsbin.com/omiru)。

```
<table id="expenses">
<thead>
  <tr>
    <td>Amount</td>
    <td>Date</td>
    <td>Where</td>
    <td>What</td>
  </tr>
</thead>
<tbody>
  <tr class='expense' id='expense-1'>
    <td>$5.99</td>
    <td>4/2/2009</td>
    <td>Taco Bell</td>
    <td>Chalupa</td>
  </tr>
  <tr class='details' id='details-1'>
    <td colspan='4'>
    It was yummy and delicious
    </td>
  </tr>
  <tr class='expense' id='expense-2'>
    <td>$4.99</td>
    <td>4/3/2009</td>
    <td>Burger King</td>
    <td>Whopper</td>
  </tr>
  <tr class='details' id='details-2'>
    <td colspan='4'>
    The king of burgers, indeed!
    </td>
  </tr>
  <tr class='expense' id='expense-3'>
    <td>$25.99</td>
    <td>4/6/2009</td>
    <td>Olive Garden</td>
    <td>Chicken Alfredo</td>
  </tr>
  <tr class='details' id='details-3'>
    <td colspan='4'>
    I love me some italian food!
    </td>
  </tr>
</tbody>
</table> 
```

有这样的风格：

```
#expenses tr.expense {
    cursor: pointer;
}
#expenses tr.details {
    display: none;
} 
```

然后让 Javascript 看起来像这样：

```
$(function() {
    $('tr.expense', '#expenses').click(function() {
        var id = $(this).attr('id').split('-').pop();
        var details = $('#details-'+id);
        if(details.is(':visible')) {
            details.hide();
        } else {
            details.show();
        }
    });
}); 
```

那应该这样做。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-18T18:40:49.807

```
<td colspan="4"> ? 
```

# c - 指针内存错误

> ID：763936
> 
> 赞同：2
> 
> 时间：2009-04-18T18:44:26.817
> 
> 标签：c, embedded, avr

## 问题

使用返回 Flash 中所需模式的地址的函数时，我无法从 Flash 存储器中获取数据（在下面的示例中进行了简化，只有 1 个常量：PATTERN_P）。

## 解释前的一些代码

类型`patternp`定义为

```
typedef prog_uchar patternp[NUM_ROWS]; 
```

全局 PATTERN_P 变量是一个 patternp 类型的数组，定义为

```
const patternp PATTERN_P PROGMEM = {
   0b11110000 ,
   0b10010000 ,
   0b10010000 ,
   0b10010000 ,
   0b11110000 ,
   0b10000000 ,
   0b10000000 ,
   0b10000000 
}; 
```

获取模式（）：

```
const patternp * getPattern()
{
      //... 
      return &PATTERN_P;
} 
```

主要的（）：

```
const patternp *bufferPattern = getPattern();

uint8_t rowPatternData[NUMBER_ROW_PER_MATRIX];
const patternp *bufferPattern = getPattern(s[iLetter]);  
for(int iRow = 0; iRow<NUMBER_ROW_PER_MATRIX; iRow++)
{  
    rowPatternData[iRow]=pgm_read_byte( &PATTERN_P[iRow] );   // <--- WORK!
    rowPatternData[iRow]=pgm_read_byte( bufferPattern[iRow] ); // Not Working! 

} 
```

## 说明

如您所见，代码获取了模式（在本例中，它每次都会返回 PATTERN_P...而不是我使用 pgm_read_byte 从闪存中获取数据。这使用 AVR pgmspace（下面的链接）。它需要一个地址并返回数据。上面的代码在我使用模板的直接访问时有效：&PATTERN_P[iRow]，但在我使用 bufferPattern[iRow] 或 &bufferPattern[iRow] 时不起作用。知道吗？

参考：pgm_read_byte 在[pgmspace中定义](http://www.nongnu.org/avr-libc/user-manual/group__avr__pgmspace.html)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T19:14:34.140

bufferPattern 是指向数组的指针。当您编写 bufferPattern[iRow] 时，这不会评估为指向 patternp 条目 iRow 的指针；[] 操作作用于指针，而不是它指向的数组。您似乎想要写的是 &((*bufferPattern)[iRow])。

这将解决眼前的问题。但是，代码有点混乱。可能通过直接传递数组来简化您的代码（C 不按值传递数组；因此它不会复制数组 - 您不需要创建指向数组的指针来避免这种情况）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T19:21:14.233

这

```
&PATTERN_P[iRow] 
```

是

```
&(PATTERN_P[iRow]) 
```

当你的工作线给出这个：

```
(&PATTERN_P)[iRow] 
```

# c# - 在 C# 中重新排序 BindingList 中的项目？

> ID：763939
> 
> 赞同：6
> 
> 时间：2009-04-18T18:47:22.910
> 
> 标签：c#, bindinglist

如何在 C# 的 BindingList 中移动项目？比如说，将最后添加的项目移到前面，还是与上一个项目交换？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-18T19:04:05.647

```
 static void Main(string[] args)
    {
        BindingList<string> list = new BindingList<string>();
        list.Add("Hello");
        list.Add("World");
        list.Add("Test");

        MoveLastToFirst(list);

        Swap(list, 1, 2);

        foreach (string s in list)
            Console.WriteLine(s); // Prints Test World Hello
    }

    private static void MoveLastToFirst<T>(BindingList<T> list)
    {
        int cnt = list.Count;
        T temp = list[cnt - 1];
        list.RemoveAt(cnt - 1);
        list.Insert(0, temp);
    }

    private static void Swap<T>(BindingList<T> list, int first, int second)
    {
        T temp = list[first];
        list[first] = list[second];
        list[second] = temp;
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T18:55:48.180

BindingList 具有实现 IList<> 的 Items 属性

所以你可以使用`Insert()`和`RemoveAt()`

# .net - 计算 System.Decimal 精度和比例

> ID：763942
> 
> 赞同：26
> 
> 时间：2009-04-18T18:52:20.340
> 
> 标签：.net, decimal

假设我们有一个 System.Decimal 数字。

举个例子，我们来看一个 ToString() 表示如下：

```
d.ToString() = "123.4500" 
```

关于这个十进制可以说以下内容。出于我们的目的，比例定义为小数点右侧的位数。有效比例类似，但忽略小数部分中出现的任何尾随零。（换句话说，这些参数的定义类似于 SQL 小数加上一些附加参数，以说明 System.Decimal 小数部分尾随零的概念。）

*   精度：7
*   规模：4
*   有效精度：5
*   有效规模：2

给定一个任意的 System.Decimal，我怎样才能有效地计算所有这四个参数而不转换为字符串并检查字符串？该解决方案可能需要 Decimal.GetBits。

更多示例：

```
Examples Precision  Scale  EffectivePrecision  EffectiveScale
0        1 (?)      0      1 (?)               0
0.0      2 (?)      1      1 (?)               0
12.45    4          2      4                   2
12.4500  6          4      4                   2
770      3          0      3                   0 
```

(?) 或者将这些精度解释为零也可以。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-18T20:14:11.033

是的，您需要使用`Decimal.GetBits`. 不幸的是，您必须使用 96 位整数，并且 .NET 中没有简单的整数类型可以处理 96 位。另一方面，您可能会使用`Decimal`自己...

这是一些产生与您的示例相同的数字的代码。希望你觉得它有用 ：）

```
using System;

public class Test
{
    static public void Main(string[] x)
    {
        ShowInfo(123.4500m);
        ShowInfo(0m);
        ShowInfo(0.0m);
        ShowInfo(12.45m);
        ShowInfo(12.4500m);
        ShowInfo(770m);
    }

    static void ShowInfo(decimal dec)
    {
        // We want the integer parts as uint
        // C# doesn't permit int[] to uint[] conversion,
        // but .NET does. This is somewhat evil...
        uint[] bits = (uint[])(object)decimal.GetBits(dec);

        decimal mantissa = 
            (bits[2] * 4294967296m * 4294967296m) +
            (bits[1] * 4294967296m) +
            bits[0];

        uint scale = (bits[3] >> 16) & 31;

        // Precision: number of times we can divide
        // by 10 before we get to 0        
        uint precision = 0;
        if (dec != 0m)
        {
            for (decimal tmp = mantissa; tmp >= 1; tmp /= 10)
            {
                precision++;
            }
        }
        else
        {
            // Handle zero differently. It's odd.
            precision = scale + 1;
        }

        uint trailingZeros = 0;
        for (decimal tmp = mantissa;
             tmp % 10m == 0 && trailingZeros < scale;
             tmp /= 10)
        {
            trailingZeros++;
        }

        Console.WriteLine("Example: {0}", dec);
        Console.WriteLine("Precision: {0}", precision);
        Console.WriteLine("Scale: {0}", scale);
        Console.WriteLine("EffectivePrecision: {0}",
                          precision - trailingZeros);
        Console.WriteLine("EffectiveScale: {0}", scale - trailingZeros);
        Console.WriteLine();
    }
} 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2010-12-14T11:06:59.317

当我需要在将十进制值写入数据库之前验证精度和比例时，我遇到了这篇文章。实际上，我想出了一种不同的方法来使用 System.Data.SqlTypes.SqlDecimal 来实现这一点，结果证明它比这里讨论的其他两种方法更快。

```
 static DecimalInfo SQLInfo(decimal dec)

     {

         System.Data.SqlTypes.SqlDecimal x;
         x = new  System.Data.SqlTypes.SqlDecimal(dec);                     
         return new DecimalInfo((int)x.Precision, (int)x.Scale, (int)0);
     } 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-18T21:56:32.877

使用 ToString 比 Jon Skeet 的解决方案快大约 10 倍。虽然这相当快，但这里的挑战（如果有任何接受者！）是击败 ToString 的性能。

我从以下测试程序得到的性能结果是： ShowInfo 239 ms FastInfo 25 ms

```
using System;
using System.Diagnostics;
using System.Globalization;

public class Test
{
    static public void Main(string[] x)
    {
        Stopwatch sw1 = new Stopwatch();
        Stopwatch sw2 = new Stopwatch();

        sw1.Start();
        for (int i = 0; i < 10000; i++)
        {
            ShowInfo(123.4500m);
            ShowInfo(0m);
            ShowInfo(0.0m);
            ShowInfo(12.45m);
            ShowInfo(12.4500m);
            ShowInfo(770m);
        }
        sw1.Stop();

        sw2.Start();
        for (int i = 0; i < 10000; i++)
        {
            FastInfo(123.4500m);
            FastInfo(0m);
            FastInfo(0.0m);
            FastInfo(12.45m);
            FastInfo(12.4500m);
            FastInfo(770m);
        }
        sw2.Stop();

        Console.WriteLine(sw1.ElapsedMilliseconds);
        Console.WriteLine(sw2.ElapsedMilliseconds);
        Console.ReadLine();
    }

    // Be aware of how this method handles edge cases.
    // A few are counterintuitive, like the 0.0 case.
    // Also note that the goal is to report a precision
    // and scale that can be used to store the number in
    // an SQL DECIMAL type, so this does not correspond to
    // how precision and scale are defined for scientific
    // notation. The minimal precision SQL decimal can
    // be calculated by subtracting TrailingZeros as follows:
    // DECIMAL(Precision - TrailingZeros, Scale - TrailingZeros).
    //
    //     dec Precision Scale TrailingZeros
    // ------- --------- ----- -------------
    //   0             1     0             0
    // 0.0             2     1             1
    // 0.1             1     1             0
    // 0.01            2     2             0 [Diff result than ShowInfo]
    // 0.010           3     3             1 [Diff result than ShowInfo]
    // 12.45           4     2             0
    // 12.4500         6     4             2
    // 770             3     0             0
    static DecimalInfo FastInfo(decimal dec)
    {
        string s = dec.ToString(CultureInfo.InvariantCulture);

        int precision = 0;
        int scale = 0;
        int trailingZeros = 0;
        bool inFraction = false;
        bool nonZeroSeen = false;

        foreach (char c in s)
        {
            if (inFraction)
            {
                if (c == '0')
                    trailingZeros++;
                else
                {
                    nonZeroSeen = true;
                    trailingZeros = 0;
                }

                precision++;
                scale++;
            }
            else
            {
                if (c == '.')
                {
                    inFraction = true;
                }
                else if (c != '-')
                {
                    if (c != '0' || nonZeroSeen)
                    {
                        nonZeroSeen = true;
                        precision++;
                    }
                }
            }
        }

        // Handles cases where all digits are zeros.
        if (!nonZeroSeen)
            precision += 1;

        return new DecimalInfo(precision, scale, trailingZeros);
    }

    struct DecimalInfo
    {
        public int Precision { get; private set; }
        public int Scale { get; private set; }
        public int TrailingZeros { get; private set; }

        public DecimalInfo(int precision, int scale, int trailingZeros)
            : this()
        {
            Precision = precision;
            Scale = scale;
            TrailingZeros = trailingZeros;
        }
    }

    static DecimalInfo ShowInfo(decimal dec)
    {
        // We want the integer parts as uint
        // C# doesn't permit int[] to uint[] conversion,
        // but .NET does. This is somewhat evil...
        uint[] bits = (uint[])(object)decimal.GetBits(dec);

        decimal mantissa =
            (bits[2] * 4294967296m * 4294967296m) +
            (bits[1] * 4294967296m) +
            bits[0];

        uint scale = (bits[3] >> 16) & 31;

        // Precision: number of times we can divide
        // by 10 before we get to 0 
        uint precision = 0;
        if (dec != 0m)
        {
            for (decimal tmp = mantissa; tmp >= 1; tmp /= 10)
            {
                precision++;
            }
        }
        else
        {
            // Handle zero differently. It's odd.
            precision = scale + 1;
        }

        uint trailingZeros = 0;
        for (decimal tmp = mantissa;
            tmp % 10m == 0 && trailingZeros < scale;
            tmp /= 10)
        {
            trailingZeros++;
        }

        return new DecimalInfo((int)precision, (int)scale, (int)trailingZeros);
    }
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-06-06T14:28:14.640

```
public static class DecimalExtensions
{
    public static int GetPrecision(this decimal value)
    {
        return GetLeftNumberOfDigits(value) + GetRightNumberOfDigits(value);
    }

    public static int GetScale(this decimal value)
    {
        return GetRightNumberOfDigits(value);
    }
    /// <summary>
    /// Number of digits to the right of the decimal point without ending zeros
    /// </summary>
    /// <param name="value"></param>
    /// <returns></returns>
    public static int GetRightNumberOfDigits(this decimal value)
    {
        var text = value.ToString(System.Globalization.CultureInfo.InvariantCulture).TrimEnd('0');
        var decpoint = text.IndexOf(System.Globalization.CultureInfo.InvariantCulture.NumberFormat.NumberDecimalSeparator);
        if (decpoint < 0)
            return 0;
        return text.Length - decpoint - 1;
    }

    /// <summary>
    /// Number of digits to the left of the decimal point without starting zeros
    /// </summary>
    /// <param name="value"></param>
    /// <returns></returns>
    public static int GetLeftNumberOfDigits(this decimal value)
    {
        var text = Math.Abs(value).ToString(System.Globalization.CultureInfo.InvariantCulture).TrimStart('0');
        var decpoint = text.IndexOf(System.Globalization.CultureInfo.InvariantCulture.NumberFormat.NumberDecimalSeparator);
        if (decpoint == -1)
            return text.Length;
        return decpoint;
    }
} 
```

我的解决方案与 NUMBER(p,s) DataType 的 Oracle 精度和比例定义兼容：

[https://docs.oracle.com/cd/B28359_01/server.111/b28318/datatype.htm#i16209](https://docs.oracle.com/cd/B28359_01/server.111/b28318/datatype.htm#i16209)

问候。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2016-08-15T10:56:26.047

我目前确实有类似的问题，但我不仅需要比例，还需要尾数作为整数。根据上面的解决方案，请在下面找到我能想到的最快的解决方案。统计数据：“ViaBits”在我的机器上进行 7,000,000 次检查需要 2,000 毫秒。“ViaString”同样的任务需要 4,000 毫秒。

```
 public class DecimalInfo {

    public BigInteger Mantisse { get; private set; }
    public SByte Scale { get; private set; }
    private DecimalInfo() {
    }

    public static DecimalInfo Get(decimal d) {
        //ViaBits is faster than ViaString.
        return ViaBits(d);
    }

    public static DecimalInfo ViaBits(decimal d) {
        //This is the fastest, I can come up with.
        //Tested against the solutions from http://stackoverflow.com/questions/763942/calculate-system-decimal-precision-and-scale
        if (d == 0) {
            return new DecimalInfo() {
                Mantisse = 0,
                Scale = 0,
            };
        } else {
            byte scale = (byte)((Decimal.GetBits(d)[3] >> 16) & 31);
            //Calculating the mantisse from the bits 0-2 is slower.
            if (scale > 0) {
                if ((scale & 1) == 1) {
                    d *= 10m;
                }
                if ((scale & 2) == 2) {
                    d *= 100m;
                }
                if ((scale & 4) == 4) {
                    d *= 10000m;
                }
                if ((scale & 8) == 8) {
                    d *= 100000000m;
                }
                if ((scale & 16) == 16) {
                    d *= 10000000000000000m;
                }
            }
            SByte realScale = (SByte)scale;
            BigInteger scaled = (BigInteger)d;
            //Just for bigger steps, seems reasonable.
            while (scaled % 10000 == 0) {
                scaled /= 10000;
                realScale -= 4;
            }
            while (scaled % 10 == 0) {
                scaled /= 10;
                realScale--;
            }
            return new DecimalInfo() {
                Mantisse = scaled,
                Scale = realScale,
            };
        }
    }

    public static DecimalInfo ViaToString(decimal dec) {
        if (dec == 0) {
            return new DecimalInfo() {
                Mantisse = 0,
                Scale = 0,
            };
        } else {
            //Is slower than "ViaBits".
            string s = dec.ToString(CultureInfo.InvariantCulture);

            int scale = 0;
            int trailingZeros = 0;
            bool inFraction = false;
            foreach (char c in s) {
                if (inFraction) {
                    if (c == '0') {
                        trailingZeros++;
                    } else {
                        trailingZeros = 0;
                    }
                    scale++;
                } else {
                    if (c == '.') {
                        inFraction = true;
                    } else if (c != '-') {
                        if (c == '0'){
                            trailingZeros ++;
                        } else {
                            trailingZeros = 0;
                        }
                    }
                }
            }

            if (inFraction) {
                return new DecimalInfo() {
                    Mantisse = BigInteger.Parse(s.Replace(".", "").Substring(0, s.Length - trailingZeros - 1)),
                    Scale = (SByte)(scale - trailingZeros),
                };
            } else {
                return new DecimalInfo() {
                    Mantisse = BigInteger.Parse(s.Substring(0, s.Length - trailingZeros)),
                    Scale = (SByte)(scale - trailingZeros),
                };
            }
        }
    }
} 
```

# c# - 将“this”作为参数传递 - C#

> ID：763943
> 
> 赞同：1
> 
> 时间：2009-04-18T18:52:36.533
> 
> 标签：c#, xna

我目前正在玩一些 XNA 的东西来学习编程 AI。无论如何，这是我的情况：A 类有一个函数，它引用 B 类的一个实例，对它做一些事情，然后返回它。B 类包含 A 类的一个实例，然后从中调用函数。

代码示例：

```
Class A
{
    B classB;

    public A()
    {
        classB = new B();
    }

    public void Act()
    {
        this = B.Do(ref this);
    }
}

Class B
{
    public A Do(ref A classA)
    {
        //Manipulate
        return classA;
    }
} 
```

我试过传递一个成员克隆..但这显然不起作用，因为“this”是只读的。我对此一无所知。我真的被困住了。有人有什么想法吗？理想情况下，我希望避免将对象中的每个变量都作为单独的参数传递，真的。

安迪。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-18T19:10:35.740

类是引用类型，所以这样做

```
Class B
{
    public void Do(A classA)
    {
        //Manipulate
    }
} 
```

应该操作对象 classA 的引用。然后在 A 中，

```
Class A
{
    B classB;

    public A()
    {
        classB = new B();
    }

    public void Act()
    {
        B.Do(this);
    }
} 
```

注意：“这确实有副作用，您传递的 A 的引用不能设置为 null（它只会将局部变量设置为 null）” - [JulianR](https://stackoverflow.com/users/61632/julianr)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T19:01:05.733

您的 B.Do() 方法通过使用 ref 和返回来执行它（修改 A）双倍。也不需要修改classA。而且因为您的目标`this`是它无论如何都行不通。您永远不会分配给`this`，这没有任何意义。

所以简单的答案是

```
class B
{
   void Do(A anA) { anA.PublicProp = 1; }
} 
```

但是循环引用确实使它成为一个可疑的设计。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-18T18:57:15.290

//Manipulate 中是否有特定内容要求您将类引用作为 ref 传递？为什么你还要返回 classA - 如果你开始使用 ref ，这似乎是多余的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-18T19:00:21.630

只需删除 ref 关键字。如果您想将参数更改为其他内容，则只需要 ref，如果您只想操纵它，请不要使用 ref。

我认为如果语言允许您将其更改为那样会很糟糕（难以理解），因此它不允许您尝试过。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-18T19:01:00.070

您不能将“ref”与“this”一起使用。为什么需要通过引用传递参数？

如果您的函数必须更改调用者所引用的对象，您只需要一个“ref”参数。如果您只需要操作和/或更改参数的字段，那么您不需要 ref 参数。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-18T19:05:01.590

为了更清楚起见，整个事情都是针对简单 AI 的行为（例如追逐、守卫、逃避等）。我想将整个 AI 实体传递给行为，以便我可以将所有实体的行为分开（有点像多个网页的单个样式表）。我想传递整个对象的原因是某些行为需要对象的某些部分，而有些则不需要。

至于我为什么要回来……我不太清楚我是怎么做出这个决定的。我会删除它

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-18T19:13:39.493

非常感谢，德里克 E！

我刚刚测试了你说的，效果很好。

我认为，我的问题是我在想，当我传递参数时，它会克隆它并对其进行操作，就像（我认为..）它在 PHP 或 VB 中所做的那样（不记得我被告知它在）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-06-28T17:24:14.523

对象总是通过引用而不是值传递。这就是我们将 C# 中的类称为引用类型的原因。如果您使用结构，请小心，因为它们是值类型。将传递结构的副本而不是原始结构。如果您希望传递原始内容，则必须添加**ref**关键字。**ref**仅在您希望用对另一个对象的引用替换对一个对象的引用时对对象有用。

# python - python，“a in b”关键字，多个a怎么样？

> ID：763944
> 
> 赞同：15
> 
> 时间：2009-04-18T18:53:11.117
> 
> 标签：python

我在 Python 中的冒险仍在继续，我最喜欢的书再次沉寂了。Python 提供了一种内置方法来测试变量是否在可迭代对象中，使用 'in' 关键字：

```
if "a" in "abrakadabra" :
  print "it is definitely here" 
```

但是是否可以测试列表中是否有多个项目（任何一个）？目前，我正在使用下面的语法，但它有点长：

```
if "// @in " in sTxt or "// @out " in sTxt or "// @ret " in sTxt or <10 more>
  print "found." 
```

当然，正则表达式可以提供帮助，但是使用正则表达式会占用大量冗长的代码，并且不会像“a in b”那样清晰。还有其他 Pythonic 方式吗？

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-18T18:58:14.773

```
alternatives = ("// @in ", "// @out ", "// @ret ")
if any(a in sTxT for a in alternatives):
    print "found"

if all(a in sTxT for a in alternatives):
   print "found all" 
```

[`any()`](http://docs.python.org/library/functions.html#any)并[`all()`](http://docs.python.org/library/functions.html#all)接受一个可迭代的并检查它们是否有任何/全部评估为真值。将它与生成器表达式结合起来，您可以检查多个项目。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-18T18:57:12.310

`any(snippet in text_body for snippet in ("hi", "foo", "bar", "spam"))`

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-18T20:20:41.390

如果您要针对相同的单词测试很多行，将它们编译为正则表达式可能会更快。例如：

```
import  re
words = ["// @in ", "// @out ", "// @ret "] + ["// @test%s " % i for i in range(10)]

my_regex = re.compile("|".join(map(re.escape, words)))

for line in lines_to_search:
    if my_regex.search(line):  print "Found match" 
```

一些快速的时间表明这通常比`any(word in theString for word in words)`方法更快。我已经用不同的文本（短/长有/没有匹配）测试了这两种方法。结果如下：

```
 { No keywords  } |  {contain Keywords }
         short    long       short    long
regex  : 0.214    27.214     0.147    0.149
any in : 0.579    81.341     0.295    0.300 
```

如果性能无关紧要，则该`any()`方法更具可读性。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-18T19:01:07.887

如果你想要*任何*检查，那么你会使用这个：

```
inthere = False
checks = ('a', 'b')

for check in checks:
    if check in 'abrakadabra':
        inthere = True
        break 
```

如果你想*全部*结帐，你可以使用这个：

```
inthere = True
checks = ('a', 'b')

for check in checks:
    if check not in 'abrakadabra':
        inthere = False
        break 
```

编辑：不知道更多 pythonic `any()`。在 python 上使用它可能会更好。

EDIT2：添加了 break 语句，并更正了*所有*情况。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-18T19:12:29.370

您还可以使用[set 方法和运算符](http://docs.python.org/3.0/library/stdtypes.html#set-types-set-frozenset)：

```
not alternatives.isdisjoint(sTxt)  # for "any"
(alternatives & sTxt) != set()  # Again, the intersection is nonempty
alternatives <= sTxt  # for "all" 
```

我认为这些比使用 any 或 all 更容易阅读，但必须将您的集合转换为集合。由于交集和遏制是您关心的，您可能会考虑首先将它们设置为集合。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-01-07T10:08:51.833

这一定是一个旧帖子，现在最简单的方法是使用列表：

```
a = "some long text which may or may not include bononos or cabbages"
alternatives = ["apple", "banana", "riverdale"]
if a in alternatives:
    print("Hm?") 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-18T19:00:01.867

语法中没有内置的方法来做到这一点。但是，您可以使用“任何”功能使其更容易，正如@MizardX 和@Benjamin Peterson 所展示的那样。

# git - 在远程主机上工作时出现 Git 提交权限错误

> ID：763956
> 
> 赞同：1
> 
> 时间：2009-04-18T18:59:58.793
> 
> 标签：git, unix, permissions

我正试图让我的网站受到版本控制。我使用 ExpanDrive 直接在服务器上工作，它使用 MacFUSE 将 SFTP 连接挂载为本地卷，我可以通过终端和其他本地应用程序访问该卷。

无论如何，在我尝试提交之前，一切都很顺利，当我收到这条消息时：

```
fatal: exec .git/hooks/pre-commit failed. 
```

如果我尝试手动运行 exec 命令，我会看到：

```
-bash: /Volumes/1&1 Internet/website/.git/hooks/pre-commit: Permission denied
-bash: exec: /Volumes/1&1 Internet/website/.git/hooks/pre-commit: cannot execute: Unknown error: 0 
```

我尝试使用我的 SFTP 客户端为 .git 目录下的所有内容提供完整（777）权限，但仍然没有运气。有谁知道我还可以尝试什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-19T03:21:02.723

通过授予 .git 目录下的所有内容完全 (777) 权限，您已经启用了 .git/hooks 中 Git 附带的所有示例脚本，通常它们的执行位是关闭的。当您尝试`commit`将现在可执行的示例预提交脚本尝试运行以将提交格式化为补丁时。

除非这是你想要做的，我建议你`chmod`/git/hooks/* 到 644，这样钩子脚本就不会执行。

编辑——重置钩子权限让你回到你首先遇到问题的状态。接下来尝试使用`--no-verify`标志进行提交，这应该绕过预提交挂钩（以及对提交消息的一些小检查）。这可能是一种解决方法，但我仍然不明白您为什么会遇到最初的问题。代码看起来非常简单——如果没有启用它，我看不出它如何尝试执行该钩子。如果以同样的方式失败，那么我会认为 ExpanDrive/MacFuse 系统没有正确处理权限（但这不太可能）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-09T03:03:44.493

我最终在我的笔记本电脑上设置了一个本地开发环境，我放弃了尝试通过 ExpanDrive 使用 git。在花了更多时间使用它之后，这些工具似乎并不适合一起工作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-16T20:25:23.290

我相信最近版本的 git 使用与启用挂钩的权限不同的机制。因此，如果您使用的是最新版本，您可能会从 .git/hooks 目录中删除所有内容（或将其移至其他位置），看看是否是问题所在。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-08-30T20:20:37.320

我有同样的问题。我正在单独的开发服务器 (devserver) 上进行开发和测试，而我的 IDE (PhpStorm) 在我的 Macbook 上。我正在使用 ExpanDrive 在我的 Mac 上通过 SFTP (SSH) 挂载开发服务器的 webroot。当我尝试在我的 Mac 上使用 Git 时，我收到了关于 SHA1 文件和其他内容的错误。

我已经这样解决了：

我已将`.git`目录从已安装的驱动器`/Volumes/devserver`移到我的 Macbook 上的主目录中的某个位置。之后，我将旧位置符号链接到`.git`目录的新位置。我不得不使用`../../Users/jeroen/###`，否则链接不正确。

移动和制作符号链接的示例：

```
cd  /Volumes/devserver
mkdir -p /Users/$USER/Code/devserver
mv .git /Users/$USER/Code/devserver/.git
ln -s ../../Users/$USER/Code/devserver/.git ./git
git status 
```

第一次使用“git”命令可能需要一段时间，因为 Git 正在重建一些缓存。

# python - 确定一个函数在 Python 模块中是否可用

> ID：763971
> 
> 赞同：36
> 
> 时间：2009-04-18T19:06:00.090
> 
> 标签：python

我正在研究一些使用该[`socket.fromfd()`](http://docs.python.org/library/socket.html#socket.fromfd)函数的 Python 套接字代码。

但是，这个方法并不是在所有平台上都可用，所以我写了一些回退代码，以防该方法没有定义。

**确定方法是否在运行时定义的最佳方法是什么？**以下是足够的还是有更好的成语？

```
if 'fromfd' in dir(socket):
    sock = socket.fromfd(...)
else:
    sock = socket.socket(...) 
```

我有点担心文档[`dir()`](http://docs.python.org/library/functions.html#dir)似乎不鼓励使用它。将[`getattr()`](http://docs.python.org/library/functions.html#getattr)是一个更好的选择，例如：

```
if getattr(socket, 'fromfd', None) is not None:
    sock = socket.fromfd(...)
else:
    sock = socket.socket(...) 
```

想法？

**编辑**正如[Paolo](https://stackoverflow.com/questions/763971/determine-if-a-function-is-available-in-a-python-module/763975#763975)指出的，这个问题几乎是关于确定属性存在的问题[的重复。](https://stackoverflow.com/questions/610883)但是，由于使用的术语是不相交的（lk 的*“对象具有属性”*与我的*“模块具有功能”*），因此保留此问题的可搜索性可能会有所帮助，除非可以将两者结合起来。

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2009-04-18T19:09:31.093

[`hasattr()`](http://docs.python.org/library/functions.html#hasattr)是最好的选择。随它去吧。:)

```
if hasattr(socket, 'fromfd'):
    pass
else:
    pass 
```

**编辑**：实际上，根据文档，所有 hasattr 正在做的是调用 getattr 并捕获异常。所以如果你想去掉中间人，你应该选择marcog的答案。

**编辑**：我也刚刚意识到这个问题实际上是[重复](https://stackoverflow.com/questions/610883/how-to-know-if-an-object-has-an-attribute-in-python/610893)的。那里的答案之一讨论了您拥有的两个选项的优点：捕获异常（“比许可更容易请求宽恕”）或只是事先检查（“在你跳跃之前查看”）。老实说，我更倾向于后者，但 Python 社区似乎更倾向于前者。

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-04-18T19:11:40.310

或者干脆使用 try..except 块：

```
try:
  sock = socket.fromfd(...)
except AttributeError:
  sock = socket.socket(...) 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-18T19:20:28.697

hasattr(obj, 'attributename') 可能是一个更好的选择。hasattr 将尝试访问该属性，如果它不存在，它将返回 false。

在 python 中可以有动态方法，即当你尝试访问它们时创建的方法。他们不会在 dir(...) 中。但是 hasattr 会检查它。

```
>>> class C(object):
...   def __init__(self):
...     pass
...   def mymethod1(self):
...     print "In #1"
...   def __getattr__(self, name):
...     if name == 'mymethod2':
...       def func():
...         print "In my super meta #2"
...       return func
...     else:
...       raise AttributeError
... 
>>> c = C()
>>> 'mymethod1' in dir(c)
True
>>> hasattr(c, 'mymethod1')
True
>>> c.mymethod1()
In #1
>>> 'mymethod2' in dir(c)
False
>>> hasattr(c, 'mymethod2')
True
>>> c.mymethod2()
In my super meta #2 
```

# android - Google Android - 如何判断 3g 和 2g 是否打开

> ID：763972
> 
> 赞同：10
> 
> 时间：2009-04-18T19:06:03.613
> 
> 标签：android, wireless, gprs

我正在为 Google Android 开发一个简单的应用程序来打开和关闭 wifi 或 3g 或 2g。

我看到[http://developer.android.com/reference/android/net/wifi/WifiManager.html#isWifiEnabled()](http://developer.android.com/reference/android/net/wifi/WifiManager.html#isWifiEnabled()) 你可以看到 wifi 是启用还是禁用，还有我们 [http://developer.android.com /reference/android/net/wifi/WifiManager.html#setWifiEnabled(boolean)](http://developer.android.com/reference/android/net/wifi/WifiManager.html#setWifiEnabled(boolean)) 打开和关闭 wifi。

我想知道是否可以为 3G 和 2G/GPRS 做同样的事情？我知道这是可能的，因为您可以关闭 3G 并打开 2G。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-18T19:14:09.990

## 2G/3G

要确定您的网络类型，请使用：

```
TelephonyManager.getNetworkType(); 
```

这是一些示例代码：

```
bool is3G = (manager.getNetworkType() == TelephonyManager.NETWORK_TYPE_UMTS); 
```

该课程的文档可以在以下位置找到：[TelephonyManager](http://developer.android.com/reference/android/telephony/TelephonyManager.html)

## 开关

要检查您的电话收音机是打开还是关闭，请使用：

```
ServiceState.getState(); 
```

设置它使用：

```
ServiceState.setState(STATE_POWER_OFF); 
```

目前尚不清楚 setState 方法是否存在于所有状态下的所有设备和功能上。没有此方法的文档。该类的文档可以在以下位置找到：[ServiceState](http://developer.android.com/reference/android/telephony/ServiceState.html)

这个问题也可能是相关的：[http ://code.google.com/p/android/issues/detail?id=1065](http://code.google.com/p/android/issues/detail?id=1065)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-05T09:06:59.670

您还可以使用 ConnectivityManager。像这样的东西：

```
ConnectivityManager connectivityManager =(ConnectivityManager)mContext.getSystemService(Context.CONNECTIVITY_SERVICE); 
NetworkInfo activeNetInfo = connectivityManager.getActiveNetworkInfo(); 
```

# php - ASP.NET，相当于PHP的Print_r函数？

> ID：763985
> 
> 赞同：3
> 
> 时间：2009-04-18T19:14:39.803
> 
> 标签：php, asp.net

PHP Print_r 对于打印出数组和字典集合很有用。asp.net 是在这个函数中构建的吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2014-02-10T06:38:20.800

你可以通过 JavaScriptSerializer 来实现

```
var json = new JavaScriptSerializer().Serialize(yourObject);
Response.Write("yourObject:" + json + "<br/>"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-18T19:32:50.273

框架基类库中没有这样的功能。如果是出于调试目的，您可以在代码中设置刹车点并分析集合中的值。如果是为了在屏幕上打印它，您可以覆盖每个对象的[ToString](http://msdn.microsoft.com/en-us/library/system.object.tostring.aspx)方法。如果这种格式可以接受，另一种选择是将数组序列化为 XML。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-18T19:57:09.763

正如其他人所说：如果这是您需要的，您可以使用调试器来获得更好的视图。如果要在 html 中显示数据，可以将对象绑定到控件，这是一种更强大、更灵活的输出处理方式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-26T13:26:16.460

不，.net 中没有可用的函数作为 print_r()。但是您可以使用自定义函数并打印数组或`IEnumerable`项目作为响应。例如：

```
if (val is IEnumerable)
        {
            var e = val as IEnumerable;
            foreach (var i in e)
            {
                Response.Write(i.ToString() + "<br />");
            }
        } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-10-30T15:53:17.540

你可以试试：

```
string[] weekDays4 = { "Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat" };
foreach (var item in weekDays4)
{
  Response.Write(item.ToString() + " test<br />");
} 
```

* * *

## 回答 #6

> 赞同：-3
> 
> 时间：2009-04-18T19:37:10.873

您正在寻找的是所谓的“漂亮的印刷”。谷歌“.NET pprint”你可能有一些运气。

但实际上，使用调试器。

# c# - 对类库的多次引用问题

> ID：763988
> 
> 赞同：-1
> 
> 时间：2009-04-18T19:15:37.680
> 
> 标签：c#, .net, wcf

我会尽力解释这个问题，因为这对我来说有点奇怪。

我有一个 C# 类库，它定义了一堆将用作数据传输对象或 DTO 的类。

有一个 Windows 窗体应用程序引用了这个 DTO 类库，还引用了另一个类库，该类库定义了模型 - 视图 - 演示者模式的演示者。

此演示者类库引用了另一个包含 WCF 代理类的类库。

WCF 代理类库引用了另一个类库，其中包含定义 WCF 服务协定的所有接口。

最后，这个带有 WCF 契约的库引用了第一个 DTO 类库，因为它们是作为方法的参数接收的。

现在在解释了这个基础结构之后，问题是 Windows 窗体项目没有编译我得到的错误是：

“Proheart.EmployeeView”没有实现接口成员“Proheart.IEmployeeView.JobDescriptions”。“Proheart.EmployeeView.JobDescriptions”无法实现“Proheart.IEmployeeView.JobDescriptions”，因为它没有匹配的返回类型“System.Collections.Generic.List”。

基本上代码如下所示：

```
//这个接口是在Presenters类库上定义的。
公共接口 IEmployeeView  
{  
   List<JobDescriptionDto> JobDescriptions { 设置；}
}

//这是Windows Forms项目中的窗体
公共部分类 EmployeeView：Form，IEmployeeView  
{
   public List<JobDescriptionDto> JobDescriptions { set { ... 做某事 } }
}

```

拜托，我需要帮助。我知道所有的类库分离可能听起来很奇怪，但这是因为部署策略。

谢谢。

PS我之前没有提到Presenter类库没有对DTO的引用，WCF服务代理也没有。它似乎是从服务接口类库中提取的，因为如果我手动将它添加到 Presenter 中，我会收到一个循环引用错误。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T19:29:45.850

我怀疑由于错误消息中的这一行，您可能在某处定义了另一个 List 类

> 因为它没有匹配的返回类型'System.Collections.Generic.List'

将光标移到 List<> 类上，查看它们是否都指向 System. Collections.Generic.List

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-19T15:42:07.293

一种替代方式是允许代理类引用的 DTO 与从服务返回的 DTO 不同。这听起来可能很奇怪，但如果 yhour 客户端是用 Java 编写的，就会出现这种情况。客户端只会看到服务接口的代理版本和服务接口中引用的 DTO 类的代理版本。

这减少了跨服务边界的耦合。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-18T19:25:16.190

您错过了通用论点：

```
//This is the form in the Windows Forms project
public partial class EmployeeView : Form, IEmployeeView  
{
   public List<JobDescriptionDto> JobDescriptions { set { ... do something } }
} 
```

# fedora - 挂载 LVM 覆盖/快照？

> ID：763989
> 
> 赞同：2
> 
> 时间：2009-04-18T19:16:51.123
> 
> 标签：fedora, snapshot, lvm, device-mapper

我正在尝试以编程方式挂载使用 Fedora LiveUSB 创建器创建的磁盘映像，但遇到了一些问题。

据我所知，在主机系统之外挂载 LVM 快照非常困难。我有“原始”图像和持久快照，所以我认为它在技术上应该是可行的。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T18:05:46.910

LVM 的卷概念不能跨系统移植，就像您可以将一些 md 驱动器放在一起并且它们仍然可以工作一样。每个 LVM vg 都有一个唯一标识符，您需要让系统的 LVM 接受它。换句话说，在您“告诉”它存在之前，LVM 无法“看到”卷组。一旦你这样做，它应该从那里一帆风顺。

快照由记录的扇区增量组成。您是对的，您应该能够通过同时显示原始快照和快照来显示快照。快照本身不起作用。

我假设您正在考虑一起编写脚本，因为您只需要 lvm 工具集来实现这一点。

一份小小的离别礼物，可以帮助你在路上。将其保存为/usr/sbin/lvms，将所有者设置为root/root，chmod 755，并使用它来保存您的指尖。

* * *

```
#!/bin/sh
#lvms command - consolidates all LVM views into a single command
pvscan 1>/dev/null 2>/dev/null
vgscan 1>/dev/null 2>/dev/null
lvscan 1>/dev/null 2>/dev/null
echo "Available Physical Volumes - - - - - - -"
pvs
echo
echo "Active Volume Groups - - - - - - - - - -"
vgs
echo
echo "Active Logical Volumes - - - - - - - - -"
lvs 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-02-03T05:53:26.880

Fedora LiveCD 或 LiveUSB 中的操作系统映像可以在暴露嵌入式根文件系统后挂载。Fedora 的 livecd-tools 包提供了一个实用程序[liveimage-mount](https://github.com/rhinstaller/livecd-tools/blob/master/tools/liveimage-mount)，它使用 Python 来执行此操作。

[Fedora LiveOS 映像](https://fedoraproject.org/wiki/LiveOS_image)（Live CD/USB 操作系统）技术使用设备映射器快照目标来制作根文件系统的压缩只读副本，以便在启动时进行读写挂载，其中文件系统写入进入临时或持久的写时复制覆盖。一切都是用`dmsetup`命令完成的。不涉及 LVM（尽管它也使用设备映射器技术）。

安装 LiveOS 的设备将在其基本文件系统中有一个 /LiveOS/ 目录。/LiveOS/squashfs.img 文件包含一个压缩（和只读）的 ext4 文件系统，该文件系统本身包含一个 /LiveOS/ 目录，并且在该文件中名为 ext3fs.img 的分布式根文件系统。因此，squashfs.img 文件包含一个目录和文件 /LiveOS/ext3fs.img，它本身包含根文件系统（带有 /bin、/boot、/dev、/etc、/home、...）。

如果设备上安装了持久覆盖文件，它将保存为
        /LiveOS/overlay-<LABEL>-<UUID>
其中 LABEL 和 UUID 是设备分区标签和 UUID，如以下命令报告的那样，
        `lsblk -o LABEL,UUID`

一个可以以编程方式

1.  循环挂载 squashfs.img 文件，然后
2.  为安装 1 中的 ext3fs.img 文件设置循环设备。
3.  如果没有持久覆盖，您可以简单地从
    第 2 步挂载 ext3fs.img 文件或循环设备（只读的基本映像）。
4.  如果有永久覆盖文件，请为其设置循环设备。
5.  以 512 字节扇区为单位确定根文件系统的大小，

    `blockdev --getsz <basefs_loop>`

6.  然后使用这个通用命令设置一个设备映射器快照目标，

    `dmsetup create <target_name> --table "0 <size> snapshot <basefs_loop> <overlay_loop> P 8"`

7.  最后，将 Device-mapper 目标挂载到所需的挂载点，

    `mount /dev/mapper/<target_name> <mount point>`

# unix - 为什么我使用 read 命令没有达到我的预期？

> ID：763990
> 
> 赞同：0
> 
> 时间：2009-04-18T19:18:35.177
> 
> 标签：unix, shell, stdin

当我使用 vezult [[1] 建议的命令时，我对我的计算机造成了一些破坏。](https://stackoverflow.com/questions/625656/favourite-command-line-trick/627870#627870)我希望单线器要求删除文件名。但是，它立即删除了我在文件夹中的文件：

```
> find ./ -type f | while read x; do rm "$x"; done 
```

我希望它等待我输入 stdin:s [[2]](http://en.wikipedia.org/wiki/List_of_Unix_utilities)。我无法理解它的动作。读取命令是如何工作的，你在哪里使用它？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-18T19:24:00.997

那里发生的事情是`read`从`stdin`. 当您将它放在管道的末端时，它会从该管道读取。

所以你的发现变成了

```
file1
file2 
```

等等; `read`读取它并用then`x`连续替换，因此您的循环变为`file1``file2`

rm“文件1” rm“文件2”

果然，rm 的每个*文件*都从当前目录“.”开始。

几个提示。

您不需要“/”。

说得更好更安全

```
 find . -type f 
```

因为如果您碰巧键入“ `. /`”（即点空格斜杠），find 将从当前目录开始，然后从根目录开始查找。如果有适当的权限，这个技巧会删除**计算机中的每个文件**。“ `.`”已经是一个目录的名称；你不需要添加斜线。

find 或 rm 命令将执行此操作

听起来您*想要*做的是浏览从当前目录“ `.`”开始的所有目录中的所有文件，并询问是否要删除它。你可以这样做

```
 find . -type f -exec rm -i {} \; 
```

或者

```
 find . -type f -ok rm  {} \; 
```

并且根本不需要循环。你也可以做

```
 rm -r -i * 
```

并获得*几乎*相同的效果，除了它也会尝试删除目录。如果目录为空，那甚至可以工作。

另一个想法

想想看，除非你有很多文件，否则你也可以这样做

```
rm -i `find . -type f` 
```

现在反引号中的查找将成为命令行上的一堆文件名，并且' `-i`'交互式标志`rm`将询问是或否问题。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-18T20:24:26.843

查理·马丁（Charlie Martin）对您的具体示例出了什么问题进行了很好的剖析和解释，但没有解决以下一般问题：

### 什么时候应该使用 read 命令？

答案是 - 当您想从某个文件中读取连续的行（很可能是管道中某些先前命令序列的标准输出）时，可能会将这些行拆分为几个单独的变量。拆分是使用 ' `$IFS`' 的当前值完成的，这通常意味着在空白和制表符上（在这种情况下，换行符不计算在内；它们分隔行）。如果读取命令中有多个变量，则第一个单词进入第一个变量，第二个进入第二个，...，并且该行的剩余部分进入最后一个变量。如果只有一个变量，则整行都进入该变量。

有很多用途。这是我拥有的使用 split 选项的更简单的脚本之一：

```
#!/bin/ksh
#
#   @(#)$Id: mkdbs.sh,v 1.4 2008/10/12 02:41:42 jleffler Exp $
#
#   Create basic set of databases

MKDUAL=$HOME/bin/mkdual.sql
ELEMENTS=$HOME/src/sqltools/SQL/elements.sql

cat <<! |
mode_ansi with log mode ansi
logged with buffered log
unlogged
stores with buffered log
!

while read dbs logging
do
    if [ "$dbs" = "unlogged" ]
    then bw=""; cw=""
    else bw="-ebegin"; cw="-ecommit"
    fi
    sqlcmd -xe "create database $dbs $logging" \
            $bw -e "grant resource to public" -f $MKDUAL -f $ELEMENTS $cw
done 
```

带有 here-document的`cat`命令将其输出发送到管道，因此输出进入`while read dbs logging`循环。第一个词进入`$dbs`并且是我要创建的（Informix）数据库的名称。该行的其余部分被放入 $logging。循环的主体处理未记录的数据库（在哪里`begin`和`commit`不工作），然后运行一个程序`sqlcmd`（与同名的 Microsoft 新来者完全分开；它自 1990 年左右就存在）创建一个数据库并填充它一些标准的表和数据——Oracle ' `dual`' 表的模拟，以及一组与“元素表”相关的表。

使用该`read`命令的其他脚本更大（到目前为止），但通常读取包含一个或多个文件名和一些其他相关属性的行，然后使用这些属性对文件应用适当的转换。

```
Osiris JL: file * | grep 'sh.*script' | sed 's/:.*//' | xargs wgrep read
esqlcver:read version letter
jlss:    while read directory
jlss:                read x || exit
jlss:            read x || exit
jlss:    while read file type link owner group perms
jlss:        read x || exit
jlss:    while read file type link owner group perms
kb: while read size name
mkbod:    while read directory
mkbod:while read dist comp
mkdbs:while read dbs logging
mkmsd:while read msdfile master
mknmd:while read gfile sfile version notes
publictimestamp:while read name type title
publictimestamp:while read name type title
Osiris JL: 
```

'Osiris JL:' 是我的命令行提示符；我在我的“bin”目录中运行了这个。' `wgrep`' 是 grep 的变体，它只匹配整个单词（避免使用像 'already' 这样的单词）。这说明了我是如何使用它的。

' `read x || exit`' 行用于从标准输入读取响应的交互式脚本，但如果命令获取 EOF（例如，如果标准输入来自`/dev/null`）则退出。*********************************