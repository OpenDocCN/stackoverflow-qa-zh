# StackOverflow 问答 000701000-000701999

# java - 设计良好的 JMX MBean 有哪些特点

> ID：701002
> 
> 赞同：10
> 
> 时间：2009-03-31T13:37:39.533
> 
> 标签：java, performance, jmx

设计 JMX MBean 的一些最佳实践是什么？有什么你觉得特别有用的例子吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-31T14:11:52.460

返回绝对计数而不是速率。例如，返回数据库提交的总数，而不是得出一个比率。

通过这样做，您的客户可以在他们需要的任何时间段内自行监控和得出费率。也许更重要的是，这可以保护客户在不经常连接的情况下不会错过费率激增。

如果您主要通过 HTML 接口使用 JMX bean，那么我将遵循几种做法。下面通常意味着你的 JMX bean 应该包装一个现有的 bean（而不是仅仅暴露 JMX 的现有方法）：

1.  输出格式正确的字符串，表示返回的对象。获得默认`toString()`输出可能几乎没用
2.  捕获并显示异常。否则，您可能会得到一个空白页面，并且必须转到日志文件以确定出了什么问题
3.  如果您正在显示不同的字符集，您可能必须适当地转义输出以防止显示问题（我在显示我们的中文数据的 JMX 控件中遇到了这个问题）
4.  对公开方法的输入应该进行适当的清理（例如，如果您输入一个 id 作为操作的一部分，您可能希望`trim()`它删除空格等）

以上将重点从简单地通过 JMX 公开的 bean 转变为接近可用管理控制台的东西。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-31T13:51:13.493

我的第一个 JMX bean 让我得到的第一件事是返回类型——如果你的方法返回字符串会容易得多——这样你的客户端可以轻松地显示响应（我主要使用 JConsole）——如果你不这样做，你会得到像 com.mycompany.Response@xxxx 这样的响应，这并不意味着太多:)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-31T21:57:00.313

确保属性没有副作用并且在操作中是可预测的。

没有什么比执行耗时（或资源消耗）操作的无辜属性更糟糕的了。我在我的时间里见过一些humdingers..

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-30T12:24:58.607

不要使用 JMX 进行日志记录，例如，不要使用返回自启动以来所有连接的详细信息的 MBean 函数。

应该记住，JMX 是用于监控的。含义 - 仅显示与当前时刻相关的数据。

# git - 获取版本

> ID：701003
> 
> 赞同：1
> 
> 时间：2009-03-31T13:38:35.927
> 
> 标签：git, version-control, version

我是唯一的开发人员，使用 GIT 对用 C 编写的嵌入式软件进行版本控制。软件需要知道它的版本，目前是通过包含一个带有单个 #define 的头文件来完成的：

```
#define SOFTWARE_VERSION "1.021"
```

该头文件由预构建 Python 脚本自动创建，该脚本试图从 GIT 存储库中获取最新标记（我使用当前版本字符串标记所有已发布版本）。这是我用来获取最新版本字符串的命令。

**git describe --tag HEAD**

整个链按预期工作，但它似乎并不健壮（我希望它会随着存储库变得更加复杂/分支而中断）。另外，我认为我可能遗漏了一些重要的东西，因为必须有更简单的方法来做到这一点。

任何人都可以提供工作流程或实施细节的改进吗？（如果有人感兴趣，我可以发布解析 git describe 输出的 python 脚本）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T13:59:59.993

将软件发布版本号与 CM 系统版本号分开。

是的，您需要知道与给定版本号对应的 CM 系统中的版本或标记，但不要使用 CM 系统版本号来定义版本号。

使用简单的 VCS，如 RCS 或 SCCS，以及简单的（一个文件）程序，您可以使用 VCS 提供程序版本 - 我自己做。但是我所有的复杂程序都使用完全独立的版本编号方案，与 VCS 中的版本号完全分离。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:10:09.673

正如在这个[SO question](https://stackoverflow.com/questions/677436/how-to-get-the-git-commit-count/677888)中提到的，**[`git describe`](http://www.kernel.org/pub/software/scm/git/docs/git-describe.html)**您可能需要引用一个中间“版本”，它既是：

*   基于最新的应用版本（即“标签”）
*   基于内部提交（即 sha1）

# c - 如何在基于 Debian 的系统上以编程方式获取 IP 地址？

> ID：701004
> 
> 赞同：3
> 
> 时间：2009-03-31T13:38:51.090
> 
> 标签：c, ip-address, debian

我正在尝试`IP Address`在我的程序中检索本地机器的。操作系统是`Ubuntu 8.10`. 我尝试使用`gethostname()`and`gethostbyname()`来检索`IP Address`. 我收到的答案是`127.0.1.1`。我了解到这似乎是一`Debian`件事： [此处链接的文档解释了这个想法。](http://www.linuxquestions.org/questions/linux-networking-3/what-does-127.0.1.1-mean-623421/)

我的`/etc/hosts`文件内容是：

> 127.0.0.1 本地主机
> 127.0.1.1 我的机器

在这种情况下，是否有任何其他方式以编程方式（首选 C 或 C++）在不修改机器上的系统文件的情况下获取 IP 地址？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T16:52:15.540

这是一些演示 SIOCGIFCONF 的快速而肮脏的代码：

```
#include <stdio.h>
#include <stdlib.h>
#include <sys/ioctl.h>
#include <net/if.h>
#include <netinet/in.h>
#include <arpa/inet.h>

int main()
{
    int sock, i;
    struct ifreq ifreqs[20];
    struct ifconf ic;

    ic.ifc_len = sizeof ifreqs;
    ic.ifc_req = ifreqs;

    sock = socket(AF_INET, SOCK_DGRAM, 0);
    if (sock < 0) {
        perror("socket");
        exit(1);
    }

    if (ioctl(sock, SIOCGIFCONF, &ic) < 0) {
        perror("SIOCGIFCONF");
        exit(1);
    }

    for (i = 0; i < ic.ifc_len/sizeof(struct ifreq); ++i)
        printf("%s: %s\n", ifreqs[i].ifr_name,
                inet_ntoa(((struct sockaddr_in*)&ifreqs[i].ifr_addr)->sin_addr));

    return 0;
} 
```

我在我的 Linux 机器上得到以下输出。

```
lo: 127.0.0.1
br0: 192.168.0.42
dummy1: 10.0.0.2 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-04-23T20:57:00.583

所以，根据肯的观点：

```
ip addr show scope global | grep inet | cut -d' ' -f6 | cut -d/ -f1 
```

遗憾的是，当 Debian 大神们发出“ip”命令时，他们并没有想到添加一个简单的命令来获取 ip 地址。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-31T14:10:12.090

请参阅“网络设备”，通过`man netdevice`或[在网络上](http://linux.die.net/man/7/netdevice)。
然后可以使用 SIOCGIFCONF 来获取所有传输层地址的枚举。

编辑（在手册页上）：`man`在 Linux（或其他类似 UNIX 的系统）上是一个非常有用的命令。它显示了对大多数命令、库函数、程序等的简要描述。打开 shell 提示符并键入`man ls`or `man netdevice`，你就会明白我的意思了。

编辑（关于 IP 的一般检索）：最简单的方法是，如果您认为 C 方法太杂乱，是一个简单的 shell 脚本，例如（只是从我的脑海中）：
`ifconfig|grep 'inet addr'|awk '{print $2}'|sed 's/addr://g'`

编辑（关于 Brain 解决方案）：他所做的是使用[if_nameindex()](http://www.opengroup.org/onlinepubs/009695399/functions/if_nameindex.html)函数来查找所有网络设备名称，然后在每个名称上使用 SIOCFIFCONF ioctl 来查找它们的 IP。正如他所说，它只列出了每个设备一个 IP。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T14:06:39.523

查看[netdevice](http://www.kernel.org/doc/man-pages/online/pages/man7/netdevice.7.html)手册页。调用 SIOCGIFCONF 以获取所有接口及其地址的列表。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-28T18:37:47.897

谢谢大家的分享！

对于 bash 解决方案，这就是我最终的结果：

```
#!/bin/bash

/sbin/ifconfig|fgrep 'inet addr:'|fgrep -v '127'|cut -d: -f2|awk '{print $1}'|head -n1 
```

头部确保返回主 IP，因为多宿主和/或逻辑接口也将在没有头部的情况下返回。

因此，如果脚本位于 /sbin/get_primary_ip，您可以执行以下操作：

```
foo=$(get_primary_ip) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-04-23T14:22:31.937

ifconfig 已过时且已弃用。iproute2 是新堆栈，使用 ip 命令：

ip addr，然后从那里解析。

# sql - 获取一系列值

> ID：701006
> 
> 赞同：1
> 
> 时间：2009-03-31T13:39:30.293
> 
> 标签：sql

我的表名为 TimeList，数据库中有 2 列 SlotID(int identity) 和 SlotTime(varchar) 是这样的。

```
SlotID   SlotTime
1        8:00AM-8:15AM
2        8:15AM-8:30AM
3        8:30AM-8:45AM
4        8:45AM-9AM
5        9AM-9:30AM 
```

同样直到下午 6:45-7:00。

如果我将 2 个参数 starttime 和 endtime 作为上午 8:00 和 endtime 作为上午 9 点传递，我想检索上面给定表中的前 4 行。任何人都可以帮助拥有这样的存储过程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T13:45:16.033

是否可以将表重构为如下所示：

```
SlotID   SlotStart   SlotEnd
----------------------------
1        8:00am      8:15am
2        8:15am      8:30am
... 
```

如果将时间拆分为单独的列，则查询日期范围会更容易。查询看起来像这样：

```
@StartTime = '8:00am'
@EndTime = '9:00am'

select SlotID, SlotStart, SlotEnd
from Slots
where SlotStart >= @StartTime
and SlotEnd <= @EndTime 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T13:48:49.053

您的数据未正确规范化，因此很难查询。一个字段应该只包含一个值，因此您应该在单独的字段中包含插槽的开始时间和结束时间：

```
SlotID   StartTime   EndTime
1        8:00AM      8:15AM
2        8:15AM      8:30AM
3        8:30AM      8:45AM
4        8:45AM      9:00AM
5        9:00AM      9:30AM 
```

这也允许您对字段使用日期时间类型而不是文本数据类型，以便您可以轻松地查询表：

```
select SlotId, StartTime, EndTime
from TimeList
where StartTime >= '8:00AM' and EndTime <= '9:00AM' 
```

对于您的原始表格设计，您将不得不使用字符串操作来拆分字段中的值，并转换这些值以使其具有可比性。如果您在表中获得大量数据，这将成为性能杀手，因为查询无法使用索引。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T13:49:14.183

问题是您的表格未标准化。请在[http://en.wikipedia.org/wiki/Database_normalization](http://en.wikipedia.org/wiki/Database_normalization)阅读它，它可以大大提高您设计的系统的质量。

在您目前的情况下，请遵循 Andy 的建议，将 SlotStart 和 SlotEnd 分开。你的时间格式也不好。使用 DateTime 格式（或您的数据库为您提供的任何时间类型）或像 INT 这样的数字类型来存储您的值（例如 1800 而不是 6:00PM）。

然后您可以轻松使用

SELECT FROM TimeList WHERE SlotStart>=... AND SlotEnd<=...

并从您的桌子上选择您喜欢的任何东西。

# ant - 如何定义 checkstyle 的抑制定义，适用于 ant 和 eclipse

> ID：701012
> 
> 赞同：8
> 
> 时间：2009-03-31T13:41:10.053
> 
> 标签：ant, build-process, continuous-integration, eclipse-plugin, checkstyle

我在项目 checkstyle 中使用，并且在我的 checkstyle-configuration 中定义了一个[SuppressionFilter 。](http://checkstyle.sourceforge.net/config.html#Filters)我使用 Apache ant 通过持续集成进行自动构建。

我的问题来自以下情况：我不想将太多文件填充到基于项目的ir中，因此 checkstyle.xml 和 suppresss.xml 都位于名为 conf 的子目录中（用于构建配置）。现在，Ant 和 Eclipse 以不同的方式查找 suppresss.xml。

在我声明了一个 ant-task 以使用 checkstyle 的基本配置查找 checkstyle.xml 之后，Ant 使用 project-basedir 作为 basedir 来查找 suppresss.xml。这个 checkstyle.xml 现在包含以下内容：

```
<module name="SuppressionFilter">
    <property name="file" value="conf/suppressions.xml"/>
</module> 
```

这样 ant-build 找到了 suppresss.xml，因为 build 的 basedir 是项目目录。

现在使用 Eclipse 的[checkstyle-plugin](http://eclipse-cs.sourceforge.net/)会带来一个问题。它从 checkstyle.xml 的路径 (conf) 开始查找 suppresss.xml。对于 Eclipse，声明必须如下所示才能起作用：

```
<module name="SuppressionFilter">
    <property name="file" value="suppressions.xml"/>
</module> 
```

编辑：即使这不起作用，Eclipse 似乎总是需要一个绝对路径。

我想知道一种方法，即 Eclipse 和 Ant 都可以使用相同的 checkstyle-configuration。有人知道这个问题的解决方案吗？绝对路径不是解决方案，因为每个开发人员和 CI-Server 对项目目录都有不同的路径。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2011-10-03T19:30:37.593

这个问题已经很老了，但我找到了使用[Checkstyle Advanced 属性](http://eclipse-cs.sourceforge.net/advanced_properties.html)的更好方法：

对于 Eclipse Checkstyle 插件，该`${samedir}`属性扩展为配置文件所在的目录：

在您的情况下，您的模块配置如下所示：

```
<module name="SuppressionFilter">
    <property name="file" value="${samedir}/conf/suppressions.xml" />
</module> 
```

Ant 目标也将设置`samedir`属性：

```
<checkstyle config="${checkstyle.tool.dir}/checks.xml" failOnViolation="false">
    <fileset dir="${src.dir}" includes="**/*.java" />
    <property key="samedir" value="${checkstyle.tool.dir}/conf" />
</checkstyle> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-06T13:03:47.530

使用 Checkstyle 的[属性扩展](http://checkstyle.sourceforge.net/config.html#Properties)功能。在您的`checkstyle.xml`声明`SupressionFilter`中：

```
<module name="SuppressionFilter">
    <property name="file" value="${checkstyle.suppressions.file}" default="suppressions.xml"/>
</module> 
```

然后在 Ant 构建脚本中修改 Checkstyle 任务以包含嵌套属性：

```
<checkstyle config="conf/checkstyle.xml">
    <fileset dir="src" includes="**/*.java"/>
    <property key="checkstyle.suppressions.file" value="conf/suppressions.xml"/>
</checkstyle> 
```

# .net - 在商业应用程序中创建 PDF，如何获得许可？

> ID：701016
> 
> 赞同：3
> 
> 时间：2009-03-31T13:41:32.597
> 
> 标签：.net, licensing

我正在从事一个商业项目，该项目的一小部分将创建报告并将报告写入 PDF。你会如何建议我这样做？我只知道诸如 itextsharp.sourceforge.net 之类的开源项目，但我猜我不能在商业上使用它。我有哪些选择？有人做过吗？

PS 使用.Net 开发。

谢谢小号

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-07T02:17:07.793

由于您使用的是 .Net，因此您可以使用本地 rdlc 报告（而不必安装报告服务。）并使用报告查看器导出为 pdf。

基本上，只需构建报告并调用 ReportViewer.LocalReport.Render() 并为格式指定“PDF”。

我已经为几个项目做过 - 效果很好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-07T02:00:43.653

If you are feeling particularly masochistic [the adobe PDF format specification](http://www.adobe.com/devnet/pdf/pdf_reference.html) is available.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T13:47:43.830

**SQL Server Reporting Services**可以生成 PDF 格式的报告。它与 Crystal Reports 非常相似，并且是 SQL Server 的一部分，因此无需额外费用。而且它很容易实现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T13:51:23.790

警告：我不是律师！

实际上，iTextSharp 是 LGPL，因此，如果我正确理解该许可证，您可以在闭源应用程序中毫无问题地使用它（不过，请阅读许可证以确保）。我认为使用 LGPL，您所要做的就是将 iTextSharp 的许可证包含在您的产品中。如果您正在开发付费服务，那么我认为您没有任何义务（法律上）做任何额外的事情。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T15:02:45.023

XML + XSLT + nFOP = PDF

上次我检查 nFOP 需要 J# 运行时，网址：http: [//sourceforge.net/projects/nfop/](http://sourceforge.net/projects/nfop/)

确保检查许可证的条款和条件。

ķ

# reporting-services - 从标题中获取图像

> ID：701021
> 
> 赞同：0
> 
> 时间：2009-03-31T13:42:09.193
> 
> 标签：reporting-services, reportingservices-2005

我有一个 SSRS 2005 rdl 文件，其中包含一个标题部分。标题部分有一个徽标图像。我需要知道徽标图像存储在 rdl 文件的哪个位置？该标志将用于其他报告。

谢谢

足球俱乐部

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T14:00:15.687

这取决于作者如何创建报告。您可以使用 4 种方法中的 1 种方法来存储要在报告中使用的图像：

1.  Embedded - 报告嵌入在实际报告文件中
2.  项目 - 图像存储在报告项目中，并在项目内的报告之间共享
3.  数据库 - 图像存储在数据库中
4.  网络 - 图像链接自网络上的某个位置

如果它是嵌入的，您的 rdl 将包含一个元素，其中包含元素内的实际文件内容。

如果它是一个项目图像，它将在一个标签内。

数据库和 Web 图像也会有相应的标签，尽管我从未处理过它们。

# .net - 事件在 .NET 页面周期中没有足够早地触发

> ID：701023
> 
> 赞同：0
> 
> 时间：2009-03-31T13:42:15.777
> 
> 标签：.net, user-controls, page-lifecycle

我有一个页面（表单），上面有很多用户控件，我试图用一个按钮来保存所有内容。UserControls 实际上是嵌套的，所以我想以某种方式向每个 UC 发出信号，告知它应该保存自己，而不是以某种方式将所有内容包装到一个事件中或让单个事件触发一连串的保存事件。

我的计划是使用一个静态类（[这个答案](https://stackoverflow.com/questions/407902/set-global-variable-for-duration-of-a-request/407954#407954)的代码的道具）：

```
public static class RequestScopedFormData
{
    private const string save_key = "request_form_is_saving";

    public static bool FormIsSaving
    {
        get
        {
            object o = HttpContext.Current.Items[save_key];
            return Convert.ToBoolean(o);
        }
        set
        {
            HttpContext.Current.Items[save_key] = value;
        }
    }
} 
```

理想情况下，我的 MasterPage 上的按钮将设置 RequestScopedFormData.FormIsSaving = true，并且当 .NET 构建页面及其用户控件时，他们会知道自己执行保存。

我遇到的问题是我无法在页面生命周期中足够早地触发事件以保存用户控件。即使我将保存代码移动到 PreRender 事件，并将保存 ImageButton 移动到页面本身（而不是 MasterPage），我也无法在 UC 保存检查之前将 FormIsSaving 设置为 true。

它发生这样的事情：

*   页面 Page_Load
*   MasterPage Page_Load
*   UC Page_Loads 和 PreRenders（它们是混合的，它会在加载其他之前预渲染一些）
*   MasterPage SaveButton_Click 事件（这是我设置类变量的地方）
*   MasterPage 预渲染
*   页面预渲染

所以不幸的是，SaveButton_Click 方法发生在加载 UC 之后，所以它们永远不会保存。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T13:44:02.217

更改您的 @Page 指令以包含 Trace="true" - 这将为您提供有关所调用内容的完整诊断，并允许您确定您需要的生命周期部分的最佳方法。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:46:40.210

您还可以检查回发是否是由保存按钮引起的：

```
Request.Form["__EVENTTARGET"].Contains({YourSaveButton}.UniqueID) 
```

表单变量在页面生命周期的早期可用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T14:20:34.483

你的控件都是从同一个接口派生的，还是你可以给它们添加一个通用接口？

然后在您的保存按钮方法中，您可以遍历页面上的所有控件，然后对于与您的界面匹配的项目，调用 Save 方法。

例如

```
foreach (Control cntrl in Page.Controls)
{
  if (cntrl is IMySavableControl)
  {
     cntrl.Save();
  }
} 
```

# eclipse - 有人让 LunarEclipse 与 Eclipse 3.4.1 一起工作吗？

> ID：701026
> 
> 赞同：2
> 
> 时间：2009-03-31T13:42:58.163
> 
> 标签：eclipse, eclipse-plugin, lua

我昨天花了几个小时试图让 LunarEclipse 与 Eclipse 3.4.1 和 DLTK 1.0 一起工作

[我在他们的 sourceforge 项目页面上](http://sourceforge.net/projects/lunareclipse)查看了一些错误报告，他们说他们的 1.2.9 版本应该与 DLTK1.0 一起使用。问题是他们实际上还没有发布 1.2.9。不过，您可以在他们的 SVN 存储库中获得它。

我下载了他们的 svn 存储库。令我沮丧的是，我终其一生都无法消除项目中的所有错误。它一直说它无法解析**org.eclipse.core.runtime.IProgressMonitor**即使我添加了 org.eclipse.core.runtime 外部 .jar 文件。

我猜 1.2.9 还没有完成。所以我想知道是否有人对如何做有一些提示。也许我应该得到一个旧版本的 eclipse 和 DLTK。

我已经检查了 LuaEclipse，但这也没有用。

概括：

*   有没有人让 LunarEclipse 与 eclipse 3.4.1 一起工作？
*   你能推荐任何其他用于 Eclipse 的 Lua IDE 或插件吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T20:27:01.717

LuaEclipse 1.3.0 的 Beta 版确实对我有用，而且非常稳定（调试器插件除外）。

在这里抓住它：

[http://luaeclipse.luaforge.net/preview/update-site](http://luaeclipse.luaforge.net/preview/update-site)

# c# - ASP.NET 自定义验证器客户端和服务器端验证未触发

> ID：701029
> 
> 赞同：74
> 
> 时间：2009-03-31T13:44:08.720
> 
> 标签：c#, .net, asp.net, validation, customvalidator

这在我之前没有发生过，但由于某种原因，客户端和服务器端验证事件都没有被触发：

```
<asp:TextBox ID="TextBoxDTownCity" runat="server" CssClass="contactfield" />
<asp:CustomValidator ID="CustomValidator2" runat="server" EnableClientScript="true"
    ErrorMessage="Delivery Town or City required"
    ClientValidationFunction="TextBoxDTownCityClient" 
    ControlToValidate="TextBoxDTownCity"
    OnServerValidate="TextBoxDTownCity_Validate" Display="Dynamic" >
</asp:CustomValidator> 
```

服务器端验证事件：

```
protected void TextBoxDTownCity_Validate(object source, ServerValidateEventArgs args)
{
    args.IsValid = false;
} 
```

客户端验证事件：

```
function TextBoxDCountyClient(sender, args) {
    args.IsValid = false;
    alert("test");
} 
```

我认为至少服务器端验证会触发，但不会。这在我以前从未发生过。这真的让我很难过。

我查看了输出，ASP.NET 正在识别客户端功能：

ASP.NET JavaScript 输出：

```
var ctl00_ctl00_content_content_CustomValidator2 = document.all ? document.all["ctl00_ctl00_content_content_CustomValidator2"] : document.getElementById("ctl00_ctl00_content_content_CustomValidator2");

ctl00_ctl00_content_content_CustomValidator2.controltovalidate = "ctl00_ctl00_content_content_TextBoxDTownCity";

ctl00_ctl00_content_content_CustomValidator2.errormessage = "Delivery Town or City required";

ctl00_ctl00_content_content_CustomValidator2.display = "Dynamic";

ctl00_ctl00_content_content_CustomValidator2.evaluationfunction = "CustomValidatorEvaluateIsValid";

ctl00_ctl00_content_content_CustomValidator2.clientvalidationfunction = "TextBoxDTownCityClient"; 
```

渲染的自定义验证器：

```
<span id="ctl00_ctl00_content_content_CustomValidator2" style="color:Red;display:none;">Delivery Town or City required</span> 
```

任何人都可以解释为什么客户端和服务器端验证都不会触发。

**编辑：错字我粘贴了错误的功能，问题还是一样**

只是对最后一条评论的另一个更新：TextBox 不能为空。我对此进行了测试，但事实并非如此。在空白页面上，CustomValidator 触发了我的客户端验证功能，没有值：

```
<asp:TextBox ID="TextBox1" runat="server" />
<asp:CustomValidator ID="CustomValidator1" runat="server" 
ErrorMessage="CustomValidator" ClientValidationFunction="TextBoxDAddress1Client"></asp:CustomValidator>
<asp:Button ID="Button1" runat="server" Text="Button" onclick="Button1_Click" /> 
```

* * *

## 回答 #1

> 赞同：133
> 
> 时间：2010-08-25T11:05:06.510

用这个：

```
<asp:CustomValidator runat="server" id="vld" ValidateEmptyText="true"/> 
```

验证一个空字段。

您不需要添加 2 个验证器！

* * *

## 回答 #2

> 赞同：114
> 
> 时间：2009-03-31T14:02:38.257

仅当不为空`CustomValidator`时才会触发。`TextBox`

如果你需要确保它不是空的，那么你也需要一个[`RequiredFieldValidator`](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.requiredfieldvalidator.aspx)。

> [**注意：**如果输入控件为空，则不调用验证函数且验证成功。使用RequiredFieldValidator 控件要求用户在输入控件中输入数据。](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.customvalidator.aspx)

**编辑：**

如果您`CustomValidator`指定了`ControlToValidate`属性（并且您的原始示例确实如此），那么只有当控件不为空时才会调用您的验证函数。

如果您未指定`ControlToValidate`，则每次都会调用您的验证函数。

这为该问题开辟了第二种可能的解决方案。`RequiredFieldValidator`您可以从 中省略`ControlToValidate`属性，而不是使用单独的 ，`CustomValidator`并设置您的验证函数来执行以下操作：

客户端代码（Javascript）：

```
function TextBoxDCountyClient(sender, args) {
    var v = document.getElementById('<%=TextBoxDTownCity.ClientID%>').value;
    if (v == '') {
        args.IsValid = false;  // field is empty
    }
    else {
        // do your other validation tests here...
    }
} 
```

服务器端代码（C#）：

```
protected void TextBoxDTownCity_Validate(
    object source, ServerValidateEventArgs args)
{
    string v = TextBoxDTownCity.Text;
    if (v == string.Empty)
    {
        args.IsValid = false;  // field is empty
    }
    else
    {
        // do your other validation tests here...
    }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-15T21:56:09.707

我的 Web 表单上根本没有执行客户端验证，我不知道为什么。事实证明，问题在于 javascript 函数的名称与服务器控件 ID 相同。

所以你不能这样做...

```
<script>
  function vld(sender, args) { args.IsValid = true; }
</script>
<asp:CustomValidator runat="server" id="vld" ClientValidationFunction="vld" /> 
```

但这有效：

```
<script>
  function validate_vld(sender, args) { args.IsValid = true; }
</script>
<asp:CustomValidator runat="server" id="vld" ClientValidationFunction="validate_vld" /> 
```

我猜它与内部 .NET Javascript 冲突？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-31T13:49:41.280

您是否验证了导致回发的控件已将 CausesValidation 设置为 tru 并且没有为其分配验证组？

我不确定还有什么可能导致这种行为。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-18T12:54:47.217

还要检查您是否没有使用验证组，因为如果设置了验证组属性并且未通过显式调用验证，则验证不会触发

```
 Page.Validate({Insert validation group name here}); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-31T13:50:57.847

如果客户端验证无效，则服务器端验证不会触发，回发不会发送。

您没有其他未通过的验证吗？

客户端验证未执行，因为您指定`ClientValidationFunction="TextBoxDTownCityClient"`了，这将查找名为`TextBoxDTownCityClient`验证函数的函数，但函数名称应为 `TextBoxDAddress1Client`

（正如你所写）

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-19T17:03:49.103

感谢您提供有关 ControlToValidate LukeH 的信息！

我在我的代码中尝试做的是仅确保当文本字段 B 具有特定值时某些文本字段 A 在字段中具有一些文本。否则， A 可以为空白或其他任何内容。去掉我标记中的 ControlToValidate="A" 为我解决了这个问题。

干杯!

# .net - 1999 年 10 月 12 日有什么意义？

> ID：701030
> 
> 赞同：94
> 
> 时间：2009-03-31T13:44:18.377
> 
> 标签：.net, asp.net, cookies

在[System.Web.Security.FormsAuthentication](http://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.aspx)的 SignOut 方法中，ASP.NET 团队选择通过将过期日期设置为“1999 年 12 月 12 日”来使 FormsAuth cookie 过期。

```
HttpCookie cookie = new HttpCookie(FormsCookieName, str);
cookie.HttpOnly = true;
cookie.Path = _FormsCookiePath;
cookie.Expires = new DateTime(0x7cf, 10, 12); 
```

1999 年 10 月 12 日有什么意义？这是一个内部笑话，还是有正当理由将您的 cookie 过期设置为该特定日期？

**编辑：** 下面的理论很有趣，但它们只是猜测。由于[Phil](https://stackoverflow.com/users/598/haacked)、 [Scott](https://stackoverflow.com/users/6380/scott-hanselman)和 ASP.NET 团队的其他成员都在 StackOverflow 上，我认为提供**赏金**会很有趣。希望有人能追踪到原始开发者并得到权威的答案。

**获奖：** 致 Scott Hanselman 将这个一直升级到[ScottGu](http://weblogs.asp.net/scottgu/about.aspx)。我真的希望有某种超级秘密、光明会式的含义，但看起来这只是“一年前”的老把戏。

* * *

## 回答 #1

> 赞同：193
> 
> 时间：2009-04-03T14:10:07.647

小学我亲爱的华生：

*   1999 年 10 月 12 日正好是 2000 年 1 月 1 日之前的 80 天。
*   对某些人来说，2000 年是世界末日
*   众所周知，[环游世界需要80天](http://en.wikipedia.org/wiki/Around_the_World_in_Eighty_Days)。
*   所以 1999 年 10 月 12 日是环游世界的最后一天。
*   众所周知，互联网遍布世界各地。
*   所以数据包（还有cookies）在世界各地旅行。
*   1999 年 10 月 12 日的到期日期是可以发送数据包的象征性最后一天。
*   无需在此日期之后发送。
*   因此，这是永不过期的象征性日期。

* * *

## 回答 #2

> 赞同：133
> 
> 时间：2009-04-08T20:39:38.277

好的，伙计们，我与 ASP.NET 团队中的十几个不同的人进行了交谈。我们认为，编写那行代码的开发人员已经走了。我们问了顾，他不确定。

该团队的 Stefan Schackow 在与 Manu Vasandani 交谈后说：

> “ASP.NET 开发人员被一群着火的野性忍者追赶，因此在完成该功能的同时，他们面临着巨大的压力，同时担心他们的生命安全。由于当时的热度（热情），仓促的决定是将常数设置为当前时间点，不到一年。不幸的是，做出这个决定的开发人员检查它的速度不够快，尽管有捷径，但最终还是死于忍者领袖的痛苦之中。 Eviscerati Extremus 减一'。”

翻译？该日期是该行代码编写日期的前一年。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-03-31T13:52:22.320

也许那行是在 1999 年 10 月 13 日写的，他们选择“昨天”作为一个任意的日期，这将永远是过去。

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-04-03T14:49:13.417

我不确定这与 ASP.NET 的开发是否相关，但那是我的 26 岁生日！

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2009-03-31T13:52:52.990

设置 cookie 的到期日期时，任何特定日期都没有好处。任何过去的日期都会导致浏览器删除 cookie。

根据[维基百科](http://en.wikipedia.org/wiki/October_12)：

*   佩尔韦兹·穆沙拉夫通过一场不流血的政变从纳瓦兹·谢里夫手中夺取了巴基斯坦的权力。
*   60 亿人之日：世界上第 60 亿人诞生。
*   澳大利亚司法和皇家专员罗伯特·马斯登·霍普逝世（生于 1919 年）
*   美国篮球运动员威尔特·张伯伦逝世（生于 1936 年）

其中，对我来说最有可能的是高跷威尔特。也许作者是个篮球迷。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-04-03T14:06:48.823

[1999 年 10 月 12 日：世界人口达到 60 亿](http://people.howstuffworks.com/population-six-billion.htm)

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-08T17:34:32.840

好的，所以我问过团队中的任何人似乎都不知道。猜猜是，比尔盖茨 1998 年 PDC 主题演讲之后的一年？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-31T13:50:37.487

我不认为这很重要。它可能只是过去的一个毫无意义的随机日期，或者像开发人员女儿的生日这样的事情——这对编写代码的人来说具有私人意义。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-06T19:11:18.927

如果转换`1999/10/12`为十六进制，则为`7CF/A/C`. 现在你可以在它上面做一个 ROT13 并且你有`2PS/N/P`
可能是 illuminati ... ;)

我真的不知道这个日期是否有任何意义。我不这么认为。

（出于娱乐目的，CW）

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-08T19:19:04.053

显然，写这篇文章的人是比尔盖茨在 99 年电信演讲的忠实粉丝。是的，你还记得那个： http: [//www.microsoft.com/presspass/exec/billg/speeches/1999/10-12telecom.aspx](http://www.microsoft.com/presspass/exec/billg/speeches/1999/10-12telecom.aspx)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-03T14:21:06.823

美国是 10/12/99，欧洲是 12/10/99，这是一个令人困惑的好日子。没有人知道是不是十二月！

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-08T17:41:37.113

就像“到达Tootsie Pop的Tootsie Roll中心需要[舔多少次”一样，世界可能永远不会知道。](http://www.tootsie.com/gal_licks.php)

# c# - 带有 MSXML 的 Com 互操作

> ID：701034
> 
> 赞同：1
> 
> 时间：2009-03-31T13:44:29.407
> 
> 标签：c#, com, interop, msxml, navision

我正在尝试通过 .Net 程序集与 Navision 进行 COM 互操作，特别是使用 MSXML 接口。这会导致以下错误消息：

程序集“C:\Users\bra\Documents\Visual Studio 2008\Projects\SOAPROXY\SOAPROXY\bin\Release\SOAPROXY.dll”无法转换为类型库。类型库导出器在处理“SOAPROXY.ISOap.PostEnvelope(#0), SOAPROXY”时遇到错误。错误：类型库导出器无法加载类型“MSXML2.IXMLDOMDocument”（错误：System.IO.FileNotFoundException：无法加载文件或程序集“Interop.MSXML2，版本=6.0.0.0，Culture=neutral，PublicKeyToken=fbdb4bb4a7dccef2”或其中之一它的依赖项。系统找不到指定的文件。文件名：'Interop.MSXML2，Version=6.0.0.0，Culture=neutral，PublicKeyToken=fbdb4bb4a7dccef2'）。肥皂氧

基本接口定义为

```
[Guid("some guid")]
[ComVisible(true)]
public interface ISoap
{
    IStatus State { get; }

    IXMLDOMDocument PostEnvelope(IXMLDOMDocument envelope, string action, string endpoint, string print, string store, string location);
}

[ClassInterface(ClassInterfaceType.None)]
[ComVisible(true)]
public class Soap : ISoap
{
     ...
} 
```

有什么线索吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-29T16:53:51.690

你有 GAC 的 MSXML6 上的互操作包装器吗？似乎 Fusion 无法加载程序集，并且要解决这个问题，您只需 GAC 即可。或者把它放在 Fusion 加载路径上。

但我不明白为什么需要 MSXML 才能向 SOAP Web 服务发出请求。为什么不直接使用.NET BCL 内置的[WebClient](http://msdn.microsoft.com/en-us/library/system.net.webclient(VS.80).aspx)广告[XmlDocument ？](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.aspx)

我从您上面写的内容中假设您想要构建一个 Navision“扩展”（可能不是正确的词）来连接到外部 Web 服务，它讲 XML，或者更具体地说，是 SOAP。并且还假设您可以在 .NET 中构建 Navision 扩展，但不能使用 wsdl.exe 或 svcutil.exe，这些工具用于 .NET 内置的 2 个 Web 服务堆栈。如果这是真的，为什么不使用 .NET 中可用的较低级别的 HTTP 和 XML 类呢？

您根本不需要 COM 互操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T13:55:20.223

在我看来，您似乎想通过 SOAP Web 服务与 Navision 交谈。如果您想这样做，您应该使用 .NET 的 Web 服务设施，即 WCF（Windows Communication Foundation）。

# c# - 如何使用 LLBLGen 连接带有条件的表？

> ID：701035
> 
> 赞同：4
> 
> 时间：2009-03-31T13:45:09.593
> 
> 标签：c#, sql, sql-server, llblgenpro

我有以下 Sql 查询，它返回我想要的结果类型：

```
SELECT b.ID, a.Name, b.Col2, b.COl3
FROM Table1 a
LEFT OUTER JOIN Table2 b on b.Col4 = a.ID AND b.Col5 = 'test' 
```

本质上，我希望行数等于表 1 (a)，同时列出表 2 (b) 中的数据，如果条件“测试”在表 2 中不存在，则为 NULL。

我对 LLBLGen 很陌生，并且尝试了一些东西，但它不起作用。如果条件存在，我可以让它工作；但是，当需求发生变化并导致我将查询重写为上述查询时，我不知所措。

以下是适用于现有产品但不适用于上述查询的旧 LLBLGen C# 代码：

```
LookupTable2Collection table2col = new LookupTable2Collection();

RelationCollection relationships = new RelationCollection();
relationships.Add(LookupTable2Entity.Relations.LookupTable1EntityUsingTable1ID, JoinHint.Left);

IPredicateExpression filter = new PredicateExpression();
filter.Add(new FieldCompareValuePredicate(LookupTable2Fields.Col5, ComparisonOperator.Equal, "test"));

table2col.GetMulti(filter, relationships); 
```

表 1 中有 3 条记录。即使表 2 中的所有项目都为 NULL，我也需要返回 3 条记录，因为条件不存在。有任何想法吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-31T22:22:50.207

您必须像这样将过滤器添加到关系联接中：

```
relationships.Add(LookupTable2Entity.Relations.LookupTable1EntityUsingTable1ID, JoinHint.Left).CustomFilter = new FieldCompareValuePredicate(LookupTable2Fields.Col5, ComparisonOperator.Equal, "test"); 
```

# iphone - 如何为非数据绑定 TableCells 设置自定义单元格

> ID：701038
> 
> 赞同：0
> 
> 时间：2009-03-31T13:45:54.473
> 
> 标签：iphone, objective-c

我很高兴能够使用 cellForRowAtIndexPath 委托设置我的 tableviewcells 的样式，但我想设置仍在屏幕上的所有未填充单元格的背景

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-31T13:55:42.750

嘿，基本上任何属于您的表格视图的单元格都属于特定索引和特定行

因此，如果您没有通过数据源填充特定部分 - 您仍然可以通过手动调用 cellForRowAtIndexPath 委托并传递该部分和行索引来获取对该 indexPath 中的单元格的引用

它会返回一个单元格。将其分配给您的私有变量并以您想要的方式对其进行编辑。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T14:23:12.323

`visibleCells`在表格视图上使用该方法。然后对细胞做你想做的事。

或者，您可以调用`indexPathsForVisibleRows`以获取索引路径。然后调用`cellForRowAtIndexPath:`获取每个索引路径对应的单元格。

# c++ - 可以将 const 引用返回给私有成员吗？

> ID：701040
> 
> 赞同：26
> 
> 时间：2009-03-31T13:46:46.390
> 
> 标签：c++, reference, constants

我需要实现对私有成员容器的只读访问。如果我返回一个常量引用，是否可以对其进行 const_cast 并获得对该成员的完全访问权限？要使用什么技术？

谢谢。

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-03-31T13:50:40.140

## 将 const 引用返回给私有成员是否安全

是的，只要引用的生命周期不超过返回它的对象的生命周期。如果您必须公开您不想修改的私有成员，这是一个很好的方法。这不是万无一失的，但它是在 C++ 中这样做的更好方法之一

## 是否可以使用 const_cast 来真正搞乱成员

是的，您无法采取任何措施来防止这种情况发生。任何时候都无法阻止某人在 C++ 中抛弃 const。这是 C++ 的限制/特性。

不过，一般来说，您应该将 const_cast 的每次使用都标记为错误，除非它包含足够详细的注释说明为什么需要这样做。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-31T13:56:01.187

在许多情况下，返回 const & 是明智之举，尤其是在返回的对象很大或无法复制的情况下。

关于 const_cast，请记住 C++ 中的“私有”访问说明符是对程序员的帮助——它不是一种安全措施。如果有人想访问一个对象的私有成员，它可以得到它们，不管你试图做什么来阻止它。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-31T13:49:49.860

```
const int &ref = your_object.your_function();
*(int*)&ref = 1234; 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-31T14:32:03.550

不要担心用户执行 const_casts 只是为了破坏您的不变量。如果他们真的想破坏您的代码，他们可以在您不提供内部属性访问器的情况下进行。通过返回一个常量引用，普通用户不会错误地修改您的数据。

[封装可以防止错误，而不是间谍活动](http://www.parashift.com/c++-faq-lite/classes-and-objects.html#faq-7.7)如果恶意编码人员真的关心并了解环境（编译器），他们无论如何都可以破坏它。常量在编译过程中丢失（在我知道的所有编译器中）。一旦编译单元被转换为二进制对象，这些对象就不知道 const-ness，并且可以利用它来利用。

```
// a.h
class A
{
public:
   A( int a ) : data_( a ) {}
   int get() const { return data_; }
private:
   int data_;
};

// malicious.h
class A;
void change( A& a, int new_value );

// malicious.cpp
//     does not include a.h, but redefines an almost exact copy of it
class A {
public:
   A( int a ) : data_( a ) {}
   int get() const { return data_; }
   int data_; // private removed
};
void change( A& a, int new_value )
{
   a.data_ = new_value;
}

// main.cpp
#include "a.h"
#include "malicious.h"
int main()
{
   A a(0);
   change( a, 10 );
   std::cout << a.get() << std::endl; // 10
} 
```

虽然上面的代码不正确（一个定义规则被破坏，类 A 有两个定义），但事实是大多数编译器 A 和恶意 A 的定义是二进制兼容的。代码将编译和链接，结果是外部代码可以访问您的私有属性。

既然知道了，***就别做了***。以后会是***的维护痛点。这让微软在为使用 API 返回对象的私有部分的软件提供向后兼容性方面花费了相当多的钱（新版本的 API 共享相同的公共接口但更改了内部结构会破坏一些第三方应用程序代码）。对于一些广泛可用的软件，供应商（在这种情况下是微软）将经历提供向后兼容性的痛苦，但对于鲜为人知的应用程序，他们不会，突然之间，您以前运行的应用程序将以各种方式失败。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-03-31T15:58:53.640

我认为赫伯·萨特曾经说过，人们应该“保护墨菲，而不是马基雅维利”。也就是说，您应该尽一切可能防止代码被意外错误地使用，但是对于有人故意滥用您的代码，您无能为力。

如果有人*真的*想破坏您的代码，他们可以，即使是`#define private public`在包含您的标头之前（从而造成 ODR 违规，但我离题了）。

所以是的，传回一个 const ref 很好。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2009-03-31T13:52:00.510

*const_cast*绝对可以用来获得对成员的完全访问权限。我想如果人们一心想用脚开枪，你就无法阻止他们。如果私有成员不重，请考虑返回该变量的副本。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-31T13:51:15.553

是的，所以这可能不是您想要做的。另一方面，如果有人麻烦 const 转换您的参考，他们可能真的知道他们在做什么。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-31T13:54:53.953

可以获得完全访问权限。但是为了什么？

不要忘记使访问器是 const 正确的

```
const MyType& getMyValue() const; 
```

您也可以在回调中注入私有值。

```
void doJob( callback c )
{
    c( myPrivateValue_ );
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2019-06-21T14:59:55.563

根据 Scott Meyer 的书[Effective C++](https://rads.stackoverflow.com/amzn/click/com/0321334876)（参见第 28 条），您应该避免使用它。以下是第 28 项的摘录：

> 这就是为什么任何返回对象内部句柄的函数都是危险的。句柄是指针、引用还是迭代器都没有关系。**它是否符合 const 并不重要**。返回句柄的成员函数本身是否为 const 并不重要。重要的是要返回一个句柄，因为一旦完成，您就冒着句柄将比它所引用的对象寿命更长的风险。

# html - 为块禁用 Markdown

> ID：701042
> 
> 赞同：17
> 
> 时间：2009-03-31T13:46:58.917
> 
> 标签：html, plugins, coding-style, markdown

Markdown 语法通常很方便写博客和评论；

但有时它会在您想要编写一个简单的 html 时干扰内容

是否有标签/语法要求降价像`pre`html 标签一样忽略该部分？

如果 pre 工作，如果降价部分需要包含 html 标签怎么办？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-31T13:57:24.447

Markdown 的原始实现（由 Gruber 提供）和 PHP Markdown 不会在块级 HTML 元素内格式化，因此您可以使用`<div>`，例如：

```
Markdown text.

More markdown text.

<div>
Markdown ignores inside the div, you can do all sorts of crazy stuff:
<a href="http://www.stackoverflow.com">Stack Overflow</a>.
<blink>Is blink still supported?</blink>
</div>

Yet more markdown text. 
```

将呈现为：

```
<p>Markdown text.</p>

<p>More markdown text.</p>

<div>
Markdown ignores inside the div, you can do all sorts of crazy stuff:
<a href="http://www.stackoverflow.com">Stack Overflow</a>.
<blink>Is blink still supported?</blink>
</div>

<p>Yet more markdown text.</p> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-31T13:49:43.433

至少在 Stack Overflow 上，... `<pre>`HTML 标记可以很好地用于此目的。它还可以像浏览器一样格式化您的文本：

```
这是预先格式化的，所以在这里我可以使用 /slash/ 和 *star* 的东西
没有问题，并且 [[方括号]] [是] 只是括号。

```

# apache-flex - 什么会导致 Flex/Flash 预加载器在 IE6 中挂起 HTTPS？

> ID：701045
> 
> 赞同：0
> 
> 时间：2009-03-31T13:47:28.977
> 
> 标签：apache-flex, flash, internet-explorer-6, https

我正在部署一个使用 Flex (3.2) / flexbuilder 构建的 Flash SWF。它是一个单一的 SWF，它自己不做任何进一步的数据请求。它有一些预加载器代码，用于在加载时显示进度条（大约 650mb）。

它在几乎所有环境中都可以正常工作，但是当通过 HTTPS 部署时，它无法加载 - 仅在 IE6 上。预加载器代码抛出了一个错误，这意味着预加载器事件传递了一个错误的值（注意，我不是 Flash 专家！）。

我在 Adob​​e 上找到了一些文档，暗示这种挂起可能是由于使用了无效的 SSL 证书引起的。我怀疑可能是这种情况（注意，我不是 SSL 专家，而不是 Flash 专家）。还有其他我应该探索的选择吗，还是我一般来说是在吠叫一棵错误的树？

仅供参考，这是调用堆栈的底部

```
 at flash.events::EventDispatcher/dispatchEventFunction()
        at flash.events::EventDispatcher/dispatchEvent()
        at mx.preloaders::Preloader/timerHandler()
        at flash.utils::Timer/_timerDispatch()
        at flash.utils::Timer/tick() 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-01T00:51:37.727

该问题似乎是由结合 HTTPS 使用“no-cache”标头引起的。您可以通过在服务器端删除它们（php、服务器重写等）来避免这种情况。

Adobe 关于该错误的说明（2005 年）：

[http://kb.adobe.com/selfservice/viewContent.do?externalId=fdc7b5c&sliceId=2](http://kb.adobe.com/selfservice/viewContent.do?externalId=fdc7b5c&sliceId=2)

Lessrain 在 2005 年也完成了有趣的测试套件：

[http://www.blog.lessrain.com/flash-loading-and-browser-cache-test-suite/](http://www.blog.lessrain.com/flash-loading-and-browser-cache-test-suite/)

...但是，嘿，真的有人还在使用 IE6 吗？

# delphi - 有没有办法在delphi中通过它的名字来实例化一个类？

> ID：701049
> 
> 赞同：12
> 
> 时间：2009-03-31T13:48:05.717
> 
> 标签：delphi, delphi-7

我想实例化一个类，但我只有它的名字在一个字符串中。有办法吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-31T13:54:52.517

这是来自 Delphi 帮助（Delphi 2006，但也至少可从 Delphi 7 获得）：

**语法** 函数GetClass(const AClassName: string): TPersistentClass;

**描述** 调用 GetClass 从类名中获取类。此类可用作需要类的例程的参数。必须先注册 Class，GetClass 才能找到它。表单声明中引用的表单类和组件类（实例变量）在加载表单时自动注册。其他类可以通过调用 RegisterClass 或 RegisterClasses 来注册。

这里有一些示例代码。仅因为 TButton 是 TControl 并且类型转换有效，所以才可以这样工作。

```
procedure TForm1.FormCreate(Sender: TObject);
begin
  RegisterClasses([TButton, TForm]);
end;

procedure TForm1.Button1Click(Sender: TObject);
var
  CRef : TPersistentClass;
  AControl : TControl;
begin
  CRef := GetClass('TButton');
  if CRef<>nil then
  begin
     AControl := TControl(TControlClass(CRef).Create(Self));
     with AControl do
     begin
        Parent := Self;
        Width := 50;
        Height := 30;
     end;
  end;
end; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-22T11:54:19.530

当我需要这样做时，我构建了自己的对象工厂，它使用了一个特殊的子类 TStringList，我目前使用的是 Delphi 7，所以字符串列表类只支持将一个对象附加到一个字符串，然后我得到子类 TStringList 来实现它也可能处理类类型，所以现在我可以实例化一个对象，只需将它的类名传递给工厂。以这种方式工作：

1st - 加载一个单例对象工厂；
2st - 向工厂注册任何对象，可以在单元的初始化部分；

主要的 Factory 方法可能是：isClassRegistered、registerClass、instanceateClass(ClassName: STring): TObject;

这样我就可以实例化任何对象，或者使用之前实例化的对象，甚至是它们的一个子集。

我宁愿使用枚举类型而不是字符串来标识一个类。

备注：这是一个非常非常简洁的例子，一个完整的函数式代码更复杂，但是，相信我，不会太多。

# validation - 我的存储库是否应该强制执行数据的有效性，如果是，在哪里以及如何执行？

> ID：701052
> 
> 赞同：3
> 
> 时间：2009-03-31T13:48:53.967
> 
> 标签：validation

我有一个像这样的存储库数据访问模式：

```
IRepository<T>
{
  .. query members ..
  void Add(T item);
  void Remove(T item);
  void SaveChanges();
} 
```

想象一下我有一个用户存储库的场景，用户有一个唯一的用户名，如果我创建一个用户名存在的新用户（想象我有一个不检查的哑 ui 层），当我添加它时到存储库，一切都很好.. 当我点击 SaveChanges 时，我的存储库尝试将项目保存到数据库中，幸运的是，我的数据库正在执行这些规则，并且由于唯一的密钥违规而使我返回一个中止的异常。

在我看来，通常这种验证是在存储库之上的层完成的，调用它的层知道他们应该确保这个规则，并且会预先检查和执行（希望在某种事务范围内避免竞争，但是存在的中等无知似乎并不总是可能的）。

我的存储库不应该执行这些规则吗？如果我的媒介是愚蠢的，例如没有任何完整性检查的平面数据库，会发生什么？

如果存储库正在验证这类事情，他们将如何以调用者可以准确识别出问题的方式通知调用者违规行为，异常似乎是一种糟糕的处理方式，因为它们相对昂贵且难以专门化归结为特定的违规行为..

例如，我一直在玩“Can”模式。CanAdd 和 Add，add 将调用 CanAdd 并在 can 返回冲突时抛出无效操作异常。CanAdd 还返回有关出错的违规列表。 . 这样我就可以开始通过堆栈堆叠这些例程.. 例如，上面的服务层也将有一个“Can”方法，该方法将返回存储库报告+它想要检查的任何其他违规行为（例如更复杂的业务规则，例如哪些用户可以调用特定操作）。

数据验证是如此基础，但我觉得对于如何可靠地处理更高级的验证要求没有真正的指导。

* * *

编辑，另外在这种情况下，您如何处理存储库中实体的验证并通过更改跟踪进行更新..例如：

```
using (var repo = ...)
{
  var user = repo.GetUser('user_b');
  user.Username = 'user_a';

  repo.SaveChanges(); // boom!
} 
```

正如您可以想象的那样，这将导致异常..深入兔子洞，想象一下当我添加用户时我已经有了一个验证系统，我做了这样的事情：

```
using (var repo = ...)
{
  var newUser = new User('user_c');
  repo.Add(newUser); // so far so good.

  var otherUser = repo.GetUser('user_b');
  otherUser.Username = 'user_c';

  repo.SaveChanges(); // boom!
} 
```

在这种情况下，在添加用户时进行验证是没有意义的，因为“下游”操作无论如何都会把我们搞砸，添加验证规则需要检查实际的持久性存储和任何排队等待持久化的项目。

这仍然不能阻止之前的更改跟踪问题.. 那么现在我要开始验证保存更改调用了吗？似乎显然不相关的行为可能会发生大量违规行为。

也许我在要求一个不切实际的、完美的安全网？

在此先感谢斯蒂芬。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T13:58:51.243

理想的规则是你的每一层都应该是一个黑盒子，它们都不应该依赖于另一个层的验证。这背后的原因是数据库不知道用户界面，反之亦然。所以当DB抛出异常时，UI必须有DB知识（坏事）才能把它转化成UI层能理解的东西，这样最终才能把它转化成*用户*能理解的东西。啊。

不幸的是，在每一层上进行验证也很困难。我的解决方案：要么将验证放在一个地方（可能是业务层），然后让其他层变得非常愚蠢。他们不会在其他地方检查任何东西。

或者以抽象的方式将您的验证写入模型，然后从中生成所有验证。例如：

```
String name;
Description nameDesc = new Description("name",
        new MaxLength(20), new NotNull()); 
```

这样，您可以编写检查描述内容的代码（生成代码甚至在运行时），并以很少的成本在每一层中进行验证，因为一个更改修复了所有层。

[编辑]为了验证，你只有这些情况：

*   重复键
*   超过一定限度
*   低于某个限度
*   空（未指定）
*   空的
*   格式错误（日期字段等）

因此，您应该能够摆脱这些异常类，这些异常类具有对象、字段、旧值和新值以及特殊信息，例如被击中的限制。所以我想知道你的许多异常类来自哪里。

对于您的另一个问题，这是......呃......由[两阶段提交协议](http://en.wikipedia.org/wiki/Two-phase_commit_protocol)“解决” 。我说“已解决”，因为在某些情况下协议出现故障，根据我的经验，给用户一个“重试？”要好得多。对话或其他方式来解决问题，而不是在 TPC 上投入大量时间。

# sql-server - 为什么 SQL Server 进入单用户模式？

> ID：701074
> 
> 赞同：9
> 
> 时间：2009-03-31T13:52:47.000
> 
> 标签：sql-server

我有一个运行了好几个月的应用程序。谢天谢地，我在我的数据库调用中使用了 try/catch 块，因为今天早上我从我的 catch 块中收到了一封电子邮件警报，上面写着：

> 消息：用户“NT AUTHORITY\NETWORK SERVICE”登录失败。原因：服务器处于单用户模式。目前只有一位管理员可以连接。
> 
> 来源：.Net SqlClient 数据提供者
> 
> 数据：System.Collections.ListDictionaryInternal

所以我去尝试访问该应用程序，是的，验证它不起作用。

我能够远程桌面到服务器并登录到突然“修复”问题的 SQL Server，但我不知道为什么会发生这种情况。（“固定”现在应用程序执行正常的 CRUD 操作。）

有谁知道为什么这可能会自发发生？

此外，如果我转到数据库 -> 属性 -> 选项 -> 状态，我确认限制访问位于“MULTI_USER”中。

该应用程序由强大的 SQL Server 2005 express 提供支持。那是问题吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-31T14:07:10.943

您是否检查了 Windows 事件日志以查看服务器是否发生了任何事情？安装任何更新后是否重新启动？

# perl - 如何使用 Perl 输入密码并将字符替换为“*”？

> ID：701078
> 
> 赞同：18
> 
> 时间：2009-03-31T13:54:15.903
> 
> 标签：perl, terminal, passwords, echo

我有一个要求用户输入密码的 Perl 脚本。如何在用户键入时仅回显“*”来代替用户键入的字符？

我正在使用 Windows XP/Vista。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-04-02T13:55:37.960

过去我为此使用过[IO::Prompt](http://search.cpan.org/dist/IO-Prompt/)。

```
use IO::Prompt;
my $password = prompt('Password:', -e => '*');
print "$password\n"; 
```

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2010-02-10T09:44:25.707

如果您不想使用任何软件包...仅适用于 UNIX

```
system('stty','-echo');
chop($password=<STDIN>);
system('stty','echo'); 
```

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2009-03-31T14:29:46.163

您可以使用 Term::ReadKey。这是一个非常简单的示例，对退格键和删除键进行了一些检测。我已经在 Mac OS X 10.5 上对其进行了测试，但根据[ReadKey 手册](http://search.cpan.org/dist/TermReadKey/ReadKey.pm)，它应该可以在 Windows 下运行。[手册](http://search.cpan.org/dist/TermReadKey/ReadKey.pm)指出在 Windows下使用非阻塞读取 ( `ReadKey(-1)`) 将失败。这就是为什么我使用基本上是 ReadKey(0) 的原因`getc`（更多关于 getc 在[libc 手册](http://www.gnu.org/software/hello/manual/libc/Character-Input.html)中）。

```
#!/usr/bin/perl                                                                                                                                                                                                

use strict;                                                                                                                                                                                                    
use warnings;                                                                                                                                                                                                  
use Term::ReadKey;                                                                                                                                                                                             

my $key = 0;                                                                                                                                                                                                   
my $password = "";                                                                                                                                                                                             

print "\nPlease input your password: ";                                                                                                                                                                        

# Start reading the keys                                                                                                                                                                                       
ReadMode(4); #Disable the control keys                                                                                                                                                                         
while(ord($key = ReadKey(0)) != 10)                                                                                                                                                                            
# This will continue until the Enter key is pressed (decimal value of 10)                                                                                                                                      
{                                                                                                                                                                                                              
    # For all value of ord($key) see http://www.asciitable.com/                                                                                                                                                
    if(ord($key) == 127 || ord($key) == 8) {                                                                                                                                                                   
        # DEL/Backspace was pressed                                                                                                                                                                            
        #1\. Remove the last char from the password                                                                                                                                                             
        chop($password);                                                                                                                                                                                       
        #2 move the cursor back by one, print a blank character, move the cursor back by one                                                                                                                   
        print "\b \b";                                                                                                                                                                                         
    } elsif(ord($key) < 32) {                                                                                                                                                                                  
        # Do nothing with these control characters                                                                                                                                                             
    } else {                                                                                                                                                                                                   
        $password = $password.$key;                                                                                                                                                                            
        print "*(".ord($key).")";                                                                                                                                                                              
    }                                                                                                                                                                                                          
}                                                                                                                                                                                                              
ReadMode(0); #Reset the terminal once we are done                                                                                                                                                              
print "\n\nYour super secret password is: $password\n"; 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-03-31T14:10:10.420

您应该查看[Term::ReadKey](http://search.cpan.org/perldoc?Term::ReadKey)或[Win32::Console](http://search.cpan.org/perldoc?Win32::Console)。您可以使用这些模块来读取单个按键并发出“*”或其他任何内容。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2012-08-30T07:49:00.243

基于 Pierr-Luc 的程序，只是在反斜杠上添加了一些控制。有了这个，你不能一直按反斜杠：

```
sub passwordDisplay() {
    my $password = "";
    # Start reading the keys
    ReadMode(4); #Disable the control keys
    my $count = 0;
    while(ord($key = ReadKey(0)) != 10) {
            # This will continue until the Enter key is pressed (decimal value of 10)
            # For all value of ord($key) see http://www.asciitable.com/
            if(ord($key) == 127 || ord($key) == 8) {
                    # DEL/Backspace was pressed
                    if ($count > 0) {
                            $count--;
                            #1\. Remove the last char from the password
                            chop($password);
                            #2 move the cursor back by one, print a blank character, move the cursor back by one
                            print "\b \b";
                    }
            }
            elsif(ord($key) >= 32) {
                    $count++;
                    $password = $password.$key;
                    print "*";
            }
    }
    ReadMode(0); #Reset the terminal once we are done
    return $password;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-02-07T14:49:40.287

使用 Pierr-Luc 的程序

```
# Start reading the keys                                                                                                                                                                                       
ReadMode(4); #Disable the control keys                                                                                                                                                                         
while(ord($key = ReadKey(0)) != '13' )                                                                                                                                                                            
# This will continue until the Enter key is pressed (decimal value of 10)                                                                                                                                      
{                                                                                                                                                                                                              
    # For all value of ord($key) see http://www.asciitable.com/                                                                                                                                                
    if(ord($key) == 127 || ord($key) == 8 && (length($password) > 0)) {                                                                                                                                                                   
        # DEL/Backspace was pressed                                                                                                                                                                            
        #1\. Remove the last char from the password                                                                                                                                                             
        chop($password);                                                                                                                                                                                       
        #2 move the cursor back by one, print a blank character, move the cursor back by one                                                                                                                   
        print "\b \b";                                                                                                                                                                                         
    } elsif(ord($key) > 32) {                                                                                                                                                                                  
        $password = $password.$key;                                                                                                                                                                            
        print "*";                                                                                                                                                                              
    }                                                                                                                                                                                                         
}                                                                                                                                                                                                              
ReadMode(0); #Reset the terminal once we are done 
```

* * *

## 回答 #7

> 赞同：-4
> 
> 时间：2009-03-31T13:59:54.767

您是否尝试过存储字符串（以便您的程序仍然可以读取它）并找出它的长度然后创建一个相同长度的字符串，但只使用'*'？

# ruby - OpenSSL 验证来自自己 CA 的证书

> ID：701084
> 
> 赞同：6
> 
> 时间：2009-03-31T13:55:08.413
> 
> 标签：ruby, openssl, x509certificate2

大家好，感谢您花时间阅读本文。

我需要验证我自己的 CA 颁发的证书，我有证书。我怎样才能做相当于openssl的

openssl 验证 -CAfile

在 Ruby 代码中？OpenSSL 的 RDoc 在这方面不是很有帮助。我试过了：

```
需要'openssl'

ca = OpenSSL::X509::Certificate.new(File.read('ca-cert.pem'))

lic = OpenSSL::X509::Certificate.new(File.read('cert.pem'))

把 lic.verify( ca )

```

但我得到：

```
test.rb:7:in `verify': 错误的参数（OpenSSL::X509::Certificate）！
（预期的 OpenSSL::PKey::PKey 类型）（TypeError）
  来自 test.rb:7

```

我什至无法在 [http://www.ruby-doc.org/stdlib/libdoc/openssl/rdoc/index.html](http://www.ruby-doc.org/stdlib/libdoc/openssl/rdoc/index.html)的 OpenSSL Rdoc 中找到“验证” 。

任何帮助表示赞赏。再次感谢！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-31T21:11:02.140

您需要验证

```
lic.verify(ca.public_key) 
```

此外，在此之前，您可以验证证书颁发者

```
lic.issuer.to_s == ca.subject.to_s 
```

我使用了一个[日语帮助页面](http://doc.loveruby.net/refm/api/view/class/OpenSSL=X509=Certificate)来获取可用方法的列表 :)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-05-10T13:40:04.107

`lic.verify()`仅从签署 lic 的证书中验证密钥。商业根 CA 不直接签署最终用户证书。通常涉及一到两个中间签名证书。

所以如果`CA -> signer -> user cert`那时

`lic.verify( signer.public_key)`并将`signer.verify( CA.public_key)`返回 true 但`lic.verify( CA.public_key )`将返回 false。

# iphone - iPhone WebApp 缓存

> ID：701087
> 
> 赞同：7
> 
> 时间：2009-03-31T13:55:14.467
> 
> 标签：iphone, caching, html

我为 iPhone 制作了一个简单的 Web 应用程序，它只有 6 个页面，每个页面上都有一个图像，我使用 Cube 过渡在它们之间切换，所有静态内容。

我需要它在 iPod Touch 上离线工作，即访问一次，断开 WiFi，然后能够浏览静态站点。

我正在尝试使用 HTML5 清单功能来做到这一点，但我显然做错了吗？

我的清单文件：

```
CACHE MANIFEST
index.html
main.css
main.js
Images/Appointments_Page.png
Images/backgroundStripes.png
Images/button.png
Images/button1.png
Images/button1_clicked.png
Images/button2.png
Images/button2_clicked.png
Images/button3.png
Images/button3_clicked.png
Images/button_clicked.png
Images/CloseIcon.png
Images/CloseIcon_pressed.png
Images/Efficacy_Page.png
Images/EfficacyGraph_Page.png
Images/Graph_Icon.png
Images/GraphIcon.png
Images/GraphIcon_pressed.png
Images/Home_Page.png
Images/Tolerability_Page.png
Images/TolerabilityTable_Page.png
Images/WebClipIcon.png
Parts/ButtonHandler.js
Parts/PushButton.js
Parts/setup.js
Parts/StackLayout.js
Parts/Transitions.css
Parts/Transitions.js
Parts/utilities.js 
```

我的 HTML 文件的顶部

```
<!DOCTYPE HTML>
<html manifest="cache-manifest"> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-31T16:13:37.020

嘿，我想通了，在这里留下答案，以防它帮助其他人。

我遇到的问题是我们的服务器（IIS6）拒绝提供我的清单文件。

我必须使用“text/cache-manifest”添加 MIME 类型“.manifest”。

从那时起，它一直缓存良好，所有 40 多个文件从 1kb 到 200kb 不等。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-06-18T17:32:19.690

我还写了一些关于使用 Manifest 的提示：[http ://wecreategames.com/blog/?p=210](http://wecreategames.com/blog/?p=210)

其他需要注意的事项：您需要重新加载应用程序 TWICE 以获取清单的新内容，并且您需要更改清单的实际内容以强制重新加载包含的页面（我通过将注释 #v.03 更改为 # v.04，或类似的东西）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-06-18T23:19:51.367

作为说明：Apple建议：

“声明清单文件的 HTML 文件......自动包含在应用程序缓存中。您无需将其添加到清单文件中。”

（[https://developer.apple.com/library/content/documentation/iPhone/Conceptual/SafariJSDatabaseGuide/OfflineApplicationCache/OfflineApplicationCache.html#//apple_ref/doc/uid/TP40007256-CH7-SW2](https://developer.apple.com/library/content/documentation/iPhone/Conceptual/SafariJSDatabaseGuide/OfflineApplicationCache/OfflineApplicationCache.html#//apple_ref/doc/uid/TP40007256-CH7-SW2)）

所以它可以将“index.html”从清单列表中删除。

# python - 通过返回迭代器而不是列表来节省 Py3k 内存

> ID：701088
> 
> 赞同：3
> 
> 时间：2009-03-31T13:55:17.820
> 
> 标签：python, memory, list, iterator, python-3.x

许多过去在 Python 2.x 中返回列表的方法现在似乎在 Py3k 中返回迭代器

迭代器也是生成器表达式吗？懒惰的评价？

因此，有了这个，python 的内存占用将大大减少。不是吗？

使用内置脚本从 2to3 转换的程序呢？

为了兼容性，内置工具是否将所有返回的迭代器显式转换为列表？如果是这样，那么 Py3k 的较低内存占用优势在转换后的程序中并不明显。是吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-31T16:27:59.560

其中许多并不完全是迭代器，而是特殊的视图对象。例如 range() 现在返回类似于旧的 xrange 对象的东西——它仍然可以被索引，但会根据需要懒惰地构造整数。

类似地 dict.keys() 给出了一个 dict_keys 对象，实现了对 dict 的视图，而不是使用键的副本创建一个新列表。

这如何影响内存占用可能取决于程序。当然，除非你真的需要列表，否则更强调使用迭代器，而使用列表通常是 python2 中的默认情况。这将导致普通程序的内存效率可能更高。然而，真正节省大量资金的情况可能已经作为迭代器在 python2 程序中实现，因为真正大量的内存使用会脱颖而出，并且更有可能已经解决。（例如，文件迭代器已经比旧`file.readlines()`方法更节省内存）

转换是由 2to3 工具完成的，通常会将 range() 之类的东西转换为迭代器，它可以安全地确定不需要真正的列表，所以代码如下：

```
for x in range(10): print x 
```

将切换到新的 range() 对象，不再创建列表，因此将获得减少内存的好处，但代码如下：

```
x = range(20) 
```

将转换为：

```
x = list(range(20)) 
```

因为转换器无法知道代码是否需要 x 中的*真实*列表对象。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T16:39:11.030

> 迭代器也是生成器表达式吗？懒惰的评价？

迭代器只是一个带有 next 方法的对象。大多数时候，当说函数返回迭代器时，文档的意思是它的结果是延迟加载的。

> 因此，有了这个，python 的内存占用将大大减少。不是吗？

这取决于。我猜想普通程序不会注意到*巨大*的差异。只有当您拥有大型数据集时，迭代器相对于列表的性能优势才真正显着。你可能想看看[这个问题](https://stackoverflow.com/questions/628903/performance-advantages-to-iterators)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-02-20T23:21:10.167

迭代器相对于列表的最大好处之一不是内存，而是计算时间。例如，在 Python 2 中：

```
for i in range(1000000):  # spend a bunch of time making a big list
    if i == 0:
        break  # Building the list was a waste since we only looped once 
```

现在举个例子：

```
for i in xrange(1000000):  # starts loop almost immediately
    if i == 0:
        break  # we did't waste time even if we break early 
```

尽管示例是人为设计的，但用例却不是：循环经常在中途中断。除非您要多次使用它，否则构建整个列表以仅使用其中的一部分是一种浪费。如果是这种情况，您可以显式构建一个列表：`r = list(range(100))`. 这就是为什么迭代器在 Python 3 中的更多地方是默认的；您什么都没有，因为您仍然可以在需要时显式创建列表（或其他容器）。但是，当您计划做的只是迭代一个可迭代的一次（我认为这是更常见的情况）时，您不会被迫这样做。

# javascript - 将项目添加到可排序列表时出现问题

> ID：701092
> 
> 赞同：0
> 
> 时间：2009-03-31T13:56:03.823
> 
> 标签：javascript, ruby-on-rails, ruby, ajax

我不完全确定如何发布这个问题，但是这里......

我有一个包含可排序项目列表的网络应用程序。我使用 Sortable 对它们进行 ajax 样式排序。这就像一个魅力。我可以拖放项目，直到我的心满意为止。

同时，有一个按钮允许在我的列表中创建新项目。这也是 ajaxified 并且在大多数情况下都有效。无论如何，新项目都会出现在我的列表中，并且 firebug 显示正在呈现的代码与其他列表项目完全相同。哦，它包含在正确的列表中。

问题是新项目不可拖动/可排序/无论如何。除非我刷新页面，否则我无能为力。有什么想法为什么会出现这种情况或我该如何解决？我真的很想解决这个问题。

我试图在这里粘贴代码，但不能让它工作，所以我选择了 paste。无论如何，这里是包含 2 个可排序项目的页面的代码。这是一个新的负载，一切都按预期工作。 [http://pastie.org/432585](http://pastie.org/432585)

在这一个中，我单击了创建新部分的按钮，但没有刷新。所以前两个部分是 DnD-able，但新的部分不是... [http://pastie.org/432591](http://pastie.org/432591)

我在这里使用 ruby​​ 和 rails 进行 ajaxing，诚然，我不太熟悉它应该如何工作。但我相信这种行为来自prototype.js，也可能来自dragdrop.js。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T14:22:36.257

在完成导致新元素注入页面的 ajax 调用后，我想新元素需要绑定到 DOM，并声明为可排序的。

如果您能向我们展示一些代码，或者至少让我们知道您将哪个库用于 ajax 和 Sortable 元素，那就太好了。

# perl - 如何修复 Net::Amazon::MechanicalTurk 的失败测试？

> ID：701093
> 
> 赞同：2
> 
> 时间：2009-03-31T13:56:14.637
> 
> 标签：perl, mechanicalturk

我在 Debian Linux（测试）上使用 Perl 5.10.0 并尝试安装 Perl 模块[Net::Amazon::MechanicalTurk](http://search.cpan.org/dist/Net-Amazon-MechanicalTurk) 1.01 版。当我运行模块的测试套件时，我收到如下错误：

```
t/01-ListOperations.............无法通过包“Net::Amazon::MechanicalTurk::Transport”找到对象方法“new” ::RESTTransport”，位于 /home/user/.cpan/build/Net-Amazon-MechanicalTurk-1.01-BO885C/blib/lib/Net/Amazon/MechanicalTurk/Transport.pm 第 21 行。
可疑
[...]
21/33 测试脚本失败。12/78 分测试失败。
Files=33, Tests=78, 46 wallclock secs (1.50 cusr + 0.22 csys = 1.72 CPU)
21/33 测试程序失败。12/78 分测试失败。

```

`Net::Amazon::MechanicalTurk::Transport::RESTTransport`ISA`Net::Amazon::MechanicalTurk::Transport`里面`Net::Amazon::MechanicalTurk::BaseObject`有一个子“新”的ISA。

`mturk_install.pl`正如脚本所验证的，我已安装所有必需的模块。我已经检查了模块的 CPAN 页面上的问题，但没有解决这些错误。

有没有人遇到这些问题并提出任何解决方案？如果你成功使用了这个模块，你运行的是哪个版本的 Perl？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T14:22:45.790

CPAN 测试人员也有类似的经历。

[http://www.nntp.perl.org/group/perl.cpan.testers/2009/03/msg3437850.html](http://www.nntp.perl.org/group/perl.cpan.testers/2009/03/msg3437850.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-14T01:27:44.517

我已经构建了一个小补丁来帮助解决这个问题。库的内部逻辑存在错误，导致所有模块无法正确加载。[在http://daveviner.blogspot.com/2009/12/amazon-mechanical-turk-perl-library.html](http://daveviner.blogspot.com/2009/12/amazon-mechanical-turk-perl-library.html)查看补丁和我的描述

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-03T08:55:50.053

[您应该向Net::Amazon::MechanicalTurk 的 CPAN bugtracker 队列](http://rt.cpan.org/Dist/Display.html?Queue=Net-Amazon-MechanicalTurk)提交错误报告

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-11-30T04:46:14.313

我知道这是旧帖子，但即使在新的 1.02 版本中它仍然是一个问题。修复起来很容易——只需从 lib/Net/Amazon/MechanicalTurk/ModuleUtil.pm 的第 35 行删除“已定义”即可。显然亚马逊的每个人都运行旧版本的 Perl。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-06T02:32:18.053

我已经应用了 Dave Viner 的补丁和 RT 队列中的两个补丁。[在我的 CPAN 目录](http://search.cpan.org/~bdfoy/)中有未经授权的版本 1.01_01 。我将检查 CPAN 测试人员对修复的响应，然后在正式版本上工作。如果你是原作者，请联系我。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-13T22:29:02.073

根据 CPAN 测试人员的说法，与[Net::Amazon::MechanicalTurk](http://search.cpan.org/dist/Net-Amazon-MechanicalTurk)一起使用的最新 Perl 版本是 5.8.9。我为这个特定模块构建了一个本地副本。

# mysql - Mysql 计数

> ID：701094
> 
> 赞同：0
> 
> 时间：2009-03-31T13:56:33.090
> 
> 标签：mysql

我有以下查询：

```
select MIN(q.a), * FROM 
   (
     sub-query1
   ) as q
   UNION
   sub-query2 
```

如何将 query1 中的元素数作为主查询行返回？

* * *

如果我使用计数（*）我只有计数

CountElement子查询1

我需要一些这样的

```
rowA, rowB, rowC, CountElementSub-Query1
rowA, rowB, rowC, CountElementSub-Query1
rowA, rowB, rowC, CountElementSub-Query1
rowA, rowB, rowC, CountElementSub-Query1 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-05-04T12:53:15.003

您正在寻找分组最小值/最大值：

[http://jan.kneschke.de/projects/mysql/groupwise-max/](http://jan.kneschke.de/projects/mysql/groupwise-max/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T14:18:56.517

您可以在选择中使用子查询作为列定义吗？

# sharepoint - MOSS 备用访问映射

> ID：701096
> 
> 赞同：3
> 
> 时间：2009-03-31T13:57:09.190
> 
> 标签：sharepoint, moss, dns

我在备用访问映射中列出的以下端口上创建了一个新的 MOSS 站点：

[http://sharepoint:27478](http://sharepoint:27478) 默认 [http://sharepoint:27478](http://sharepoint:27478)

我现在想配置一个域名指向这个。我将域配置为查看[http://sharepoint](http://sharepoint)，这是服务器的名称。

我需要在备用访问映射中进行哪些更改？

一切顺利

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T14:24:29.200

转到`Central Administration >> Operations >> Global Configuration >>Alternative Access Mappings`
此处只需选择您现有的应用程序[http://sharepoint:27478](http://sharepoint:27478)，然后将新的 url（带有域名）放在所需的区域中。

这篇关于[配置备用访问映射](http://technet.microsoft.com/en-us/library/cc263208.aspx)的 Technet 文章应该会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T14:02:42.640

您需要添加的只是外部名称。

看起来像：

[http://sharepoint:27478](http://sharepoint:27478)默认[http://www.mywebsite.com](http://www.mywebsite.com)

另请阅读本系列博客文章：

> [每个 SharePoint 管理员需要了解的有关备用访问映射的内容（第 1 部分，共 3 部分）](http://blogs.msdn.com/sharepoint/archive/2007/03/06/what-every-sharepoint-administrator-needs-to-know-about-alternate-access-mappings-part-1.aspx)

# asp.net - 如何强制会话暂停 20 分钟？

> ID：701097
> 
> 赞同：0
> 
> 时间：2009-03-31T13:57:20.000
> 
> 标签：asp.net, iis, entity-framework, iis-6, timeout

当谈到实际决定会话超时的原因时，我感到非常困惑。

Web 应用程序需要留出 20 分钟的“空闲时间”，然后才能将用户注销（或将其丢弃）。我在 IIS 中的 sessionState 和 Recycle 工作进程上尝试了不同的设置。超时仍然太短，而且就我的退出-n-脏原始测试而言，有点随机。

我在某处读到默认超时为 20 分钟，但在我的应用程序中，它似乎接近 5 分钟。有什么简单的方法可以改变这种情况吗？该应用程序在 IIS 6 上运行 .NET 3.5。

编辑：我刚刚意识到实体框架可能与问题有关，因为用户内容在实体框架中作为上下文保存。持有实体的时间是否有时间限制？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-31T13:59:42.757

用户将根据您在 web.config 中的身份验证设置注销。

会话超时将在 web.config 中的会话标记中设置。

如果它们不同，那么您将看到“有趣”的结果。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-31T14:00:24.360

[http://msdn.microsoft.com/en-us/library/ms972429.aspx](http://msdn.microsoft.com/en-us/library/ms972429.aspx)

如果你查看 web.config 你可以写一些这样的东西

```
<configuration>
  <sessionstate timeout="20" />
</configuration> 
```

在那里你可以设置你的超时..

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T14:10:42.730

使用会话状态超时。您不想使用 Recycle Worker，因为这将每 N 分钟回收与该 worker 关联的所有会话。如果您使用会话变量，最好将 Recycle Worker 设置为非常高的值。

# .net - WPF 调整窗口大小

> ID：701101
> 
> 赞同：3
> 
> 时间：2009-03-31T13:58:32.057
> 
> 标签：.net, wpf, resize, resolution, touchscreen

我维护了一个我正在重新写入.Net 的触摸屏应用程序。多年来，触摸屏的分辨率已大大提高。不仅分辨率更高，而且像素也更加密集，因此更难看到/操作触摸按钮。

WPF 有没有办法强制应用程序窗口随着分辨率/像素密度的变化而扩大自己的规模？我宁愿不必每隔几年就重新设计这些屏幕。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T14:07:45.187

就在这里。

您可以使用 WPF 的 ViewBox 包装您的容器。下面是例子：

```
<Window x:Class="TestWPF.Window1"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Title="Window1" Height="300" Width="300">

    <Viewbox Stretch="Uniform">
        <StackPanel Background="Azure" Height="400" Width="300" Name="stackPanel1" VerticalAlignment="Top">
            <Button Name="testBtn" Width="200" Height="50">
                <TextBlock>Test</TextBlock>
            </Button>
        </StackPanel>
    </Viewbox>

</Window> 
```

截屏： ![在此处输入图像描述](https://i.stack.imgur.com/kHeBY.jpg)

有关更多信息，请参阅[此主题](https://stackoverflow.com/questions/386484/how-can-i-only-allow-uniform-resizing-in-a-wpf-window/387110#387110)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T08:24:16.923

这是默认行为，每个 WPF“像素”是 1/96 英寸而不是实际像素（现在唯一的问题是几乎所有屏幕都设置为 96DPI，而不管屏幕实际分辨率如何）。

# git - 什么目录结构对 DVCS（如 git）有意义？

> ID：701104
> 
> 赞同：11
> 
> 时间：2009-03-31T13:59:12.773
> 
> 标签：git, dvcs

## 我习惯的：

*   服务器上的档案（纽约州、印第安纳州、北卡罗来纳州）
*   在我的开发机器上：
    *   一个名为 ~/work 的目录
    *   名为 ~/work/NY/devproject、~/work/NC/project 等的子目录
    *   不常见的是，名为 ~/work/NY/release/1.3/project、~/work/NY/test/1.3b/project 等的子目录
    *   有时名为 ~/proxy/NY、~/proxy/NC 等的目录包含存档的一次性本地缓存，以减少读取的网络流量。这些目录可以随时删除。
*   删除 ~/work/... 并从档案中重新填充它的临时构建

* * *

## 但是对于 DVCS，这没有意义

*   档案在我的开发机器上，但出于备份原因，近克隆在远程机器上。
*   进行临时构建意味着删除并重新提取整个存档，这似乎代价高昂。
*   看起来我有一个名为 ~/git/git.git/git 的目录，其中包含很多 git。

人们是否在 ~/git 中进行所有开发？如果您需要使用 dev、test、release 和 one-off-for-big-client 版本，它们是在 ~/git 下，还是可以在它们自己的树中的其他地方？第三方组件去哪儿了？这对 SO 来说太大了（我需要看书吗），还是可以用 ASCII 树图来回答？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-09-16T16:19:40.860

我同意 TED 的回答，因为我更喜欢将每个项目都保存在开发目录中。但是，当我在终端查看 bash 列表时，我喜欢轻松地看到三件事：

1.  这是什么类型的仓库——Git、Mercurial 或 Subversion
2.  伪中央仓库存储在哪里——Github.com、Bitbucket.org、Google Code 等。
3.  谁拥有伪中央仓库

我发现我可以通过为我的项目使用以下命名约定轻松地做到这一点：

```
~/development/project.whatwhere.who 
```

由于在使用 Mercurial 克隆本地项目时很常见，因此我在目录结构中添加了一层，如下所示：

```
~/development/project.whatwhere.who/project/   # Initial clone from remote repo
~/development/project.whatwhere.who/project.local.blah_descriptor/  # Local hg clone 
```

我使用的`whatwhere`约定如下：

*   github --- 存储在 github.com 上的 Git 存储库
*   gitorious --- 存储在 gitorious.org 上的 Git 存储库
*   git --- Git repo 存储在别处
*   gitsvn --- Subversion repo 使用存储在其他地方的 git-svn 克隆
*   hgbit --- 存储在 bitbucket.org 上的 Mercurial 存储库
*   hg.gcode --- 存储在 Google 代码上的 Mercurial 存储库
*   hg --- 存储在其他地方的 Mercurial 回购
*   svn.gcode --- 存储在 Google 代码上的 Subversion 存储库
*   svn.sforge --- Subversion 存储在 Sourceforge.net 上
*   svn.work ---- Subversion repo存储在我们公司的svn服务器上
*   svn --- Subversion repo 存储在某处

`who`约定只是所需人员的用户名。

下面是一些项目示例，都位于我的`~/development/`目录中：

```
fabric.github.bitprophet      # Bitprophet's fabric project cloned from Github
fabric.github.myusername      # My fork of the fabric project from Github
virtualenv.hgbit.ianb         # Ianb's virtualenv project cloned from Bitbucket
growl.hg.gcode                # Growl project cloned from Google code
ledgersmb.svn.sforge          # LedgerSMB project checked out from Sourceforge
coldfire.gitsvn               # Coldfire Subversion project at work cloned using git-svn
coldfire.svn                  # Coldfire Subversion project at work checked out with svn 
```

如果您的项目太多，为了帮助组织您的项目，您可能需要在`~/development`组织目录的正下方添加一个层。例如，您可能有以下目录：

```
~/development/workprojects/
~/development/opensrcprojects/
~/development/personalprojects/ 
```

*注意*：我通常将 Git 用于 DVCS，所以这个答案很可能倾向于那个方向。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-31T14:47:09.193

由于 Git 的工作方式，您真的不想将存储库（或分支）的工作目录放在另一个存储库的工作目录*下的目录中。*它会一直想要将您的子目录的内容放入父目录的存储库中。

如果您将所有分支都作为同级目录，那就可以了。

我倾向于做的（不管使用 Git、cvs 还是（ick）SourceSafe）有一个 Development 目录，每个项目、分支等都是其中的一个子目录。

# c# - 在 C# 中查找 IndexOf

> ID：701105
> 
> 赞同：3
> 
> 时间：2009-03-31T13:59:40.477
> 
> 标签：c#

我如何找到`indexof()`：

```
string value = "     50     "; 
```

有空格...但我不想使用`SubString()`或删除它们`Replace()`...

我必须删除空格`leftindex`，直到我得到`"5"`并删除.`rightindex``"0"`

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-31T14:00:50.397

字符串修剪

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-31T14:01:45.167

只需使用`value = value.Trim();`，“50”前后的所有空格都会消失。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-31T14:10:54.677

你可以像这样链接它

```
value.Trim().IndexOf(whatever); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T14:44:35.393

您不需要构建用于修剪空间的逻辑，因为 C# 中已经有 String.Trim() 可用

价值=价值。修剪（）；会给你“50”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-03-27T14:54:01.587

今天我学到了一些关于 jQuery ajax 调用和返回的 JSON 对象的细微差别的新知识。

如果您熟悉或在您的代码中使用过 jQuery ajax 调用，那么毫无疑问，以下代码示例与您之前看到的内容相比很典型：

更多答案请访问本站：

[http://net-2-media.com/test/c-indexof](http://net-2-media.com/test/c-indexof)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-31T15:05:04.813

仅供参考，有一个 .trimleft 和一个 trimright 所以你可以分别获得“50”或“50”

# .net - 哪个是支持 S/MIME 的最佳托管 .NET 电子邮件组件？

> ID：701110
> 
> 赞同：0
> 
> 时间：2009-03-31T14:00:18.837
> 
> 标签：.net, email, smtp, components, smime

我需要一个`System.Net.Mail.MailMessage`能够发送签名和/或加密电子邮件的替代品。

是否有涵盖该内容的开源库？

或者你对其中一些有一些经验：

*   [奇尔卡特邮件](http://www.chilkatsoft.com/mime-dotnet.asp)
*   [易信](http://www.quicksoftcorp.com/emdotnet/)
*   [.NET 的 Dart 邮件](http://www.dart.com/ptmlnet.aspx?source=adwords&gclid=CO7lrbCpzZkCFQMEZgody0ZKtw)

*   你有更多？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-31T14:15:25.353

看起来您实际上*可以使用 .NET 的 BCL 发送 S/MIME 加密电子邮件。*它需要一些技巧（不过还不错），但是您可以轻松地包装解决方案……请参阅[此 MSDN 论坛主题](http://social.microsoft.com/Forums/en-US/netfxnetcom/thread/74e4711e-1f66-43a7-9e3b-bc9cfbcd1b73/)，也可能参阅[此](http://social.msdn.microsoft.com/Forums/en-US/ncl/thread/ca93b37d-b8ad-4793-96a5-46d663c6cfad)。请注意，如果您对 BCL 解决方案不满意，还为商业产品[Rebex Secure Mail提供了一个示例。](http://www.rebex.net/secure-mail.net/)话虽如此，我肯定会建议尽可能使用 System.Net 命名空间中提供的解决方案，尽管需要一些自定义配置。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2010-04-06T21:17:11.290

[MIMEBlackbox](http://www.eldos.com/sbb/net-mime.php)是功能最丰富的 MIME、S/MIME 和 PGP/MIME 组件集。

# .net - XML序列化问题

> ID：701111
> 
> 赞同：1
> 
> 时间：2009-03-31T14:00:18.870
> 
> 标签：.net, xml-serialization

有一个具有下一种形式的 XML：

```
 <categories someAttribute="test">
  <category id="1">
   <title></title>
  </category>
  <category id="1">
   <title></title>
  </category>
 </categories> 
```

没有办法改变 XML 结构。但我想要的是用 XMLSerialization 替换有缺陷的手工编码 XML 生成。

请帮助这些类别列表。有没有办法指示 XML 序列化程序不包装类别列表

示例代码：

```
public class Category
{
    public int Id{get;set;}
}

public class Categories
{
    public List<Category> CategoriesList { get; set; } 
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T14:18:55.423

像这样：

```
public class Category
{
    [XmlAttribute("id")]
    public int Id { get; set; }

    [XmlElement("title")]
    public string Title { get; set; }
}

[XmlRoot("categories")]
public class Categories
{
    [XmlAttribute("someAttribute")]
    public string SomeValue { get; set; }

    [XmlElement("category")]
    public List<Category> CategoriesList { get; set; }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T14:09:24.230

查看 XmlAnyElementAttribute。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-31T14:05:54.067

使用[IXmlSerializable](http://msdn.microsoft.com/en-us/library/system.xml.serialization.ixmlserializable.aspx)接口，您可以自己定义如何编写 xml，或者您可以将列表制作成一个数组，我认为它会按照您想要的方式编写，但我不确定..

# wpf - 如果宿主应用程序不是 WPF，WPF 会处理 App.xaml 文件吗？

> ID：701114
> 
> 赞同：0
> 
> 时间：2009-03-31T14:01:37.180
> 
> 标签：wpf, mfc, resources, rhino

首先我只想说我是WPF的新手，所以请原谅我的无知......

我正在为 Rhino 4.0 创建一个 .Net 插件。通过该插件，我正在使用 WPF 开发 UI。

Rhino 4.0 CAD 引擎是一个 MFC/Win32 应用程序。该插件将在应用程序运行后执行，它创建 WPF 窗口，然后将 MFC 窗口“吸”入其中。

所以我的问题是，如果托管应用程序不是 WPF 应用程序，WPF 是否会查找 App.xaml 文件以获取应用程序级资源？

如果不是，那么存储应用程序级资源的最佳方式是什么？

谢谢，

杰森

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-10-17T16:25:44.487

App.xaml 用作部分类 App 的一部分：应用程序。如果您的应用程序没有基于 WPF 的 Application 类，您可以手动加载字典并与应用程序合并并创建一个主窗口并显示它（通过 Application 类的静态方法访问）。

代码有点像这样。

```
var reader = new XamlReader();
var dictionary = reader.read("path to xaml file") as ResourceDictionary;
if (dictionary != null)
    Application.MergedDictionaries.Merge(dictionary);

var mainWindow = new MyMainWindow();
mainWindow.Show(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:13:28.337

WPF 项目将 - 默认情况下 - 为您的应用程序生成一个入口点。此入口点`Application`为您构造和初始化您的派生类。如果需要，您始终可以手动创建实例，并在其中存储应用程序级资源：

```
App app = new App();
app.InitializeComponent();
app.Run(); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T13:07:14.083

您是否尝试过将资源存储在 MSDN 所称的“主题级别”？

在名为“ `<root>\Themes`”的文件夹中有一个名为`generic.xaml`.

对于不是 WPF 应用程序的项目，我没有尝试过此方法，但该方法可能对您有用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T14:13:12.863

我的猜测是它与 rhino 如何运行你的插件有关它是作为一个单独的进程运行它还是它只是调用你定义的一些东西？

如果它确实调用了您定义的函数，那么您可以将启动窗口的代码放在那里吗？

# asp.net - 将“onClientClick”javascript 添加到 ASP.NET 登录控件

> ID：701124
> 
> 赞同：0
> 
> 时间：2009-03-31T14:04:11.077
> 
> 标签：asp.net, javascript, asp.net-controls

我必须将来自第三方网站的登录页面放在我正在开发的另一个网站的 iframe 中。当用户登录时，我需要添加一些 JavaScript 以脱离 iframe，但我无法使登录按钮执行 JavaScript 并为登录进行回发 - 只是其中一个。

这是我正在尝试调整的 iframe 登录页面中的代码：

```
<asp:LoginView ID="LoginView1" runat="server">
<AnonymousTemplate>
    <asp:Login ID="Login1" runat="server" OnAuthenticate="Login1_Authenticate">
        <LayoutTemplate>
                <asp:Label ID="lblUsername" runat="server" AssociatedControlID="Username" Text="Email" />
                <asp:TextBox ID="Username" runat="server" Text="myName" />
                <asp:Label ID="lblPassword" runat="server" AssociatedControlID="Password" Text="Password" />
                <asp:TextBox ID="Password" runat="server" Text="myPassword" />
                <asp:ImageButton ID="btnLogin" runat="server" CommandName="Login" ImageUrl="~/Images/login-submit.gif" AlternateText="Login" OnClientClick="top.location.href = document.location.href; return true;" />
        </LayoutTemplate>
    </asp:Login>
</AnonymousTemplate>
<LoggedInTemplate>
    You are currently logged in blurb..
</LoggedInTemplate> 
```

目前，当单击登录按钮时，登录页面会脱离 iframe，但是我必须再次单击该按钮才能登录用户。谁能看到我做错了什么？谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T14:32:23.723

top.location.href 将浏览器的 url 设置为新的 url，因此您永远不会完成点击操作。

您可以做的是将表单的目标设置为“_top”

就像是

```
OnClientClick="document.getElementById('MYFORM_CLIENTID').target='_top';return true;" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:38:36.717

查看您的代码，我认为在第一次单击时您没有登录。您只是将父窗口重定向到您的登录页面（最初显示在 IFrame 中的那个）。这就是为什么您需要单击该按钮两次才能登录的原因 - 第二次没有重定向，因为父窗口的 URL 没有改变，所以基本上第二次该`top.location.href = document.location.href`部分不会产生任何结果并且登录继续进行。

我认为正确的做法是首先进行身份验证，然后进行重定向，这与目前的情况相反。您可以在该页面的回发时添加一个脚本，以便它检查它是否在框架中运行，如果是，它将父窗口重定向到另一个页面。当然，如果您可以修改代码...根据提供的详细信息，我只能说出可能出了什么问题并提出修复建议，但无法给出解决方案。

# .net - .NET 中固定宽度处理的最佳实践

> ID：701125
> 
> 赞同：2
> 
> 时间：2009-03-31T14:04:18.517
> 
> 标签：.net, fixed-length-record

我正在使用一个 .NET Web 服务，它将处理一个具有相对较长的多级记录格式的文本文件。文件中的每条记录代表一个不同的实体；记录包含多个子类型。（COBOL 作业当前正在处理相同的记录格式，如果这能让您更好地了解我们正在查看的内容）。我创建了一个类结构（如果您愿意，可以使用 DATA DIVISION）来保存输入数据。

我的问题是，在 .NET 中处理大型、复杂的固定宽度文件时，您发现了哪些最佳实践？我的一般方法是将整行读入一个字符串，然后将字符串中的数据解析到我创建的类中。但我不确定将字符串中的字符作为数组使用还是使用字符串本身会得到更好的结果。我想这是具体的问题，字符串与字符 []，但我会很感激任何人的任何其他指针。

谢谢。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-31T14:07:32.207

我将构建与行中的数据匹配的类，使用类型、长度等属性。然后使用`Microsoft.VisualBasic.FileIO.TextFieldParser`对象读取文件，使用一些通用代码基于类对解析器进行编程，然后读取数据并创建实例类的（全部使用反射）。

我用它来读取 CSV 及其快速、灵活、可扩展、通用且易于维护的特性。我还有一些属性允许我在每个字段被读取时添加通用验证。

我会分享我的代码，但它是我工作的公司的 IP。

# asp.net - 白标服务访问的角色

> ID：701130
> 
> 赞同：0
> 
> 时间：2009-03-31T14:05:14.973
> 
> 标签：asp.net, architecture, asp.net-2.0, roles, security-roles

好的，

我知道我做错了什么——但想不出更好的方法。我正在开发一个允许用户设置自己的迷你网站的网站。

宁之类的。此外，我只有 1 个基本登录名，并且（现在）通过角色提供对每个迷你网站的访问权限。

所以我现在这样做的方式是：

每次创建一个新的迷你网站 - 比如说等等，我都会在我的应用程序中创建 2 个角色。 **blah_users**和**blah_admin**

创建迷你网站的用户被赋予角色 - blah_admin 并且每个想要加入这个迷你网站（或网络）的其他用户被赋予角色 - blah_user。

任何人都可以查看来自任何网站的数据。但是要添加数据，必须是该迷你站点的成员（必须分配 blah_user 角色）

我面临的问题是，通过做一个基于角色的系统，我不得不手动做很多事情。在 User.IsAunthenticated 属性上工作的 Asp.Net 2 控件现在对我来说基本上没用，因为除了 IsAuthenticated 属性之外，我还必须检查用户是否具有适当的角色。

我猜有更好的方法来构建系统，但我不确定如何。有任何想法吗？

该网站正在 IIS 6 上的 ASP.Net 2 中开发。非常感谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T14:25:38.403

我担心 ASP.NET 的标准角色相关的东西不是你需要的。您可以尝试更改身份验证模块，使其：

1.  使用 cookie 登录。
2.  确定访问者的角色。也许你会使用一些特殊的表来对应用户和站点。
3.  使用枚举的用户角色制作自定义主体，并将身份和主体分配给当前请求。

我也不认为为每个站点制作特殊角色是个好主意。当你有一百个站点时，你也会有两百个角色。恐怕很难管理。

当我们解决类似的任务时，我们只是没有使用标准控件。我们在所有站点上都使用了一组角色。具体用户的会员资格根据当前站点及其与本站点的关系确定。

补充：另一种可能的调查是存在于 ASP.NET 身份验证系统中的应用程序。也许可以将每个子站点隔离到单独的应用程序中？

**更新：**适用于我们应用程序的方法。

1.  不要做很多克隆角色。只使用两个：用户和管理员。如果您的站点是公开的，那么“用户”角色可能只是全局的——一个站点上的用户与另一个站点上的用户没有区别。如果“users”和“everyone”是不同的角色，那么当然“users”也应该绑定到一个站点。

2.  使用标准 ASP.NET Membership 用户，但不使用标准角色机制。

3.  建立一种机制来存储站点和用户之间的关系。它可以是包含站点 ID、用户和角色的简单表。

4.  您必须覆盖的是 IsInRole 方法。（确切地说是方法，我稍后会介绍）**。**该方法在 IPrinciple 接口中，因此您必须制作自己的主体对象。这很简单。

    1.  这种类型的方法 IsInRole 应该查看当前站点（来自 HttpRequest）查看站点用户表并获取角色
5.  然后，您必须将您的委托人与请求相关联。在 PostAuthenticateRequest 事件中执行此操作。

6.  还有 RoleProvider。老实说，我不确定何时使用它，但它也有 IsInRole 方法。我们可以用同样的方式覆盖它。但是这个提供者的其他方法更难。例如 AddUsersToRoles。它接受用户名和角色的数组，但是应该将它添加到什么上下文（站点）？到电流？不确定，因为我不知道何时调用此方法。所以它需要一些实验。我看到（Reflector 有帮助）RopePrincipal 本身使用 RoleProvider 来获取角色列表，所以它可能只使用标准主体实现 RoleProvider。对于我们的应用程序来说，这不是一个案例，所以我不能说这里可能隐藏了哪些问题。

# data-structures - 用于实现UNDO和REDO选项的数据结构

> ID：701131
> 
> 赞同：52
> 
> 时间：2009-03-31T14:05:27.890
> 
> 标签：data-structures, design-patterns, undo-redo

我想实现 UNDO 和 REDO 选项（正如我们在 MS word 等中看到的那样）。你能给我推荐一个数据结构吗，我该如何实现它。？

* * *

## 回答 #1

> 赞同：111
> 
> 时间：2009-03-31T14:07:24.140

它不是一种数据结构，而是一种设计模式。您正在寻找[Command Pattern](http://en.wikipedia.org/wiki/Command_pattern)。

标准是将 Command 对象保存在堆栈中以支持多级撤消。为了支持重做，第二个堆栈保留您已撤消的所有命令。因此，当您弹出撤消堆栈以撤消命令时，您会将弹出的相同命令推送到重做堆栈中。当你重做一个命令时，你反过来做同样的事情。您弹出重做堆栈并将弹出的命令推回撤消堆栈。

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-05-26T10:30:44.723

实际上，此功能（甚至是四人组）的标准模式是[Memento](http://en.wikipedia.org/wiki/Memento_pattern)。

此外，虽然大多数程序使用撤消/重做堆栈，但某些文本编辑器的爱好者更喜欢撤消/重做*树*，以便在撤消一些命令、尝试新命令并改变主意时不会丢失整个历史记录。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-31T14:13:53.267

Objective-C Cocoa 有一个有据可查的 anwser，名为[NSUndoManager](http://developer.apple.com/documentation/Cocoa/Conceptual/UndoArchitecture/UndoArchitecture.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T14:33:30.613

您可以使用命令模式来实现撤消/重做

检查这些样本：

[http://www.codeproject.com/csharp/undoredobuffer.asp](http://www.codeproject.com/csharp/undoredobuffer.asp)

[http://www.dofactory.com/Patterns/PatternCommand.aspx](http://www.dofactory.com/Patterns/PatternCommand.aspx)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2017-05-04T13:41:00.167

这是命令模式的经典案例。以下是 Python 中撤消功能的示例实现：

```
from os import rename
class RenameFileCommand(object):
    def __init__(self, src_file, target_file):
        self.src_file=src_file
        self.target_file=target_file

    def execute(self):
        rename(self.src_file, self.target_file)

    def undo(self):
        rename(self.target_file,self.src_file)

class History(object):
    def __init__(self):
        self.commands=list()
    def execute(self, command):
        command.execute()
        self.commands.append(command)

    def undo(self):
        self.commands.pop().undo()

if __name__=='__main__':
    hist=History()
    hist.execute(RenameFileCommand( 'test1.txt', 'tmp.txt', ))
    hist.undo()
    hist.execute(RenameFileCommand( 'tmp2.txt', 'test2.txt',)) 
```

# asynchronous - Seam 环境中 jBPM 异步延续所需的简单解决方案

> ID：701142
> 
> 赞同：2
> 
> 时间：2009-03-31T14:09:19.597
> 
> 标签：asynchronous, seam, continuations, jbpm

我有一个启动业务流程的 Seam 应用程序。目前没有其他需要协调的应用程序或组件，只有一个 Web 应用程序。

我想在业务流程中使用异步延续，但目前，如果我这样做，流程只是处于非活动状态，相关操作不会执行。

如何在 Seam 环境中“开启”异步延续？

我看过这篇[文章](http://jogeraerts.blogspot.com/2007/10/jboss-seam-and-jbpm-async-nodes.html)，但找不到提到的任何类，有点卡住了！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-06T16:10:07.473

我最终偶然发现了一个附加到[JBSEAM-3837](https://jira.jboss.org/jira/browse/JBSEAM-3837)的解决方法，但只是**在**放弃了谷歌搜索之后，尝试自己编写一个类似的 Seam 组件，然后放弃它并选择了一个独立版本。

谈论刺激！

# c# - C# (.Net 2.0) 微优化第 2 部分：在网格中查找连续组

> ID：701153
> 
> 赞同：3
> 
> 时间：2009-03-31T14:11:04.210
> 
> 标签：c#, optimization, .net-2.0

我有一个非常简单的函数，它接受一个匹配的位域、一个网格和一个正方形。它曾经使用委托，但我进行了很多重新编码，最终使用位域`&`操作来避免委托，同时仍然能够在合理范围内执行匹配。基本上，挑战是`match`从特定的“领导者”方块开始，在网格中找到与位域匹配的所有连续元素。Square 是有点小（但不是很小）的类。关于如何将其推得更快的任何提示？请注意，网格本身非常小（此测试中有 500 个元素）。

**编辑：**值得注意的是，此函数每秒被调用超过 200,000 次。事实上，从长远来看，我的目标是减少调用它的频率，但这真的很难，因为我的最终目标是使用脚本处理分组系统，而不是硬编码。也就是说，这个函数总是比任何其他函数被调用得更多。

**编辑：**为了澄清，该功能不检查是否`leader`与位域匹配，设计。目的是领导者不需要匹配位域（尽管在某些情况下会匹配）。

**尝试失败的事情：**

*   用容量初始化字典和堆栈。
*   将 int 转换为枚举以避免强制转换。
*   将字典和堆栈移到函数之外，并在每次需要时清除它们。这会让事情变得更慢！

**事情尝试成功：**

*   编写哈希码函数而不是使用默认值：哈希码是预先计算的并且等于`x + y * parent.Width`. 谢谢你的提醒，吉姆米歇尔。
*   mquander 的技术：见`GetGroupMquander`下文。
*   进一步优化：一旦我切换到HashSets，我就摆脱了`Contains`测试并用测试代替了它`Add`。两者`Contains`和`Add`都被迫寻找密钥，因此仅检查添加是否成功比添加`Contains`失败检查失败时更有效。那是，`if (RetVal.Add(s)) curStack.Push(s);`

    ```
    public static List<Square> GetGroup(int match, Model grid, Square leader)
    {
        Stack<Square> curStack = new Stack<Square>();
        Dictionary<Square, bool> Retval = new Dictionary<Square, bool>();
        curStack.Push(leader);
        while (curStack.Count != 0)
        {
            Square curItem = curStack.Pop();
            if (Retval.ContainsKey(curItem)) continue;
            Retval.Add(curItem, true);
            foreach (Square s in curItem.Neighbors)
            {
                if (0 != ((int)(s.RoomType) & match))
                {
                    curStack.Push(s);
                }
            }
        }
        return new List<Square>(Retval.Keys);
    } 
    ```

=====

```
 public static List<Square> GetGroupMquander(int match, Model grid, Square leader)
    {
        Stack<Square> curStack = new Stack<Square>();
        Dictionary<Square, bool> Retval = new Dictionary<Square, bool>();
        Retval.Add(leader, true);
        curStack.Push(leader);
        while (curStack.Count != 0)
        {
            Square curItem = curStack.Pop();

            foreach (Square s in curItem.Neighbors)
            {
                if (0 != ((int)(s.RoomType) & match))
                {
                    if (!Retval.ContainsKey(s))
                    {
                        curStack.Push(s);
                        Retval.Add(curItem, true);
                    }
                }
            }
        }
        return new List<Square>(Retval.Keys);
    } 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T15:14:27.223

您发布的代码假定`leader`正方形与位域匹配。这是设计使然吗？

我假设您的`Square`班级已经实现了`GetHashCode`一种快速并提供良好分布的方法。

你确实说过微优化。. .

如果您对预期的项目数量有一个很好的了解，则可以通过预先分配字典来节省一点时间。也就是说，如果您知道匹配的项目不会超过 100 个，您可以编写：

```
Dictionary<Square, bool> Retval = new Dictionary<Square, bool>(100); 
```

这将避免不得不增加字典并重新散列所有内容。您也可以对堆栈执行相同的操作：将其预先分配到某个合理的最大大小以避免以后调整大小。

既然您说网格非常小，那么将堆栈和字典分配给网格大小似乎是合理的，如果这很容易确定的话。您只是在谈论`grid_size`每个引用，因此除非您的网格变得非常大，否则内存不是问题。

在进行推送之前添加一个检查以查看某个项目是否在字典中*可能会*加快一点速度。它取决于字典查找的相对速度，而不是堆栈中有重复项的开销。尝试一下可能是值得的，尽管如果它有很大的不同，我会感到惊讶。

```
if (0 != ((int)(s.RoomType) & match))
{
    if (!Retval.ContainsKey(curItem))
        curStack.Push(s);
} 
```

我真的在最后一个。你在你的内部循环中有那个演员。我知道 C# 编译器有时会为看似简单的转换生成数量惊人的代码，我不知道 JIT 编译器是否会优化这些代码。您可以通过创建枚举类型的局部变量并为其分配以下值来从内部循环中删除该强制转换`match`：

```
RoomEnumType matchType = (RoomEnumType)match; 
```

然后你的内循环比较变成：

```
if (0 != (s.RoomType & matchType)) 
```

没有演员表，这可能会减少一些周期。

编辑：除了微优化之外，通过稍微修改算法以避免多次处理任何项目，您可能会获得更好的性能。就目前而言，匹配的项目可以多次进入堆栈，不匹配的项目可以处理多次。由于您已经在使用字典来跟踪匹配的项目，因此您可以通过给不匹配的项目赋值来跟踪它们`false`。然后最后你只需创建一个有价值`List`的项目。`true`

```
 public static List<Square> GetGroup(int match, Model grid, Square leader)
    {
        Stack<Square> curStack = new Stack<Square>(); 
        Dictionary<Square, bool> Retval = new Dictionary<Square, bool>(); 
        curStack.Push(leader);
        Retval.Add(leader, true);
        int numMatch = 1;
        while (curStack.Count != 0)
        {
            Square curItem = curStack.Pop(); 
            foreach (Square s in curItem.Neighbors) 
            {
                if (Retval.ContainsKey(curItem))
                    continue;
                if (0 != ((int)(s.RoomType) & match))
                {
                    curStack.Push(s);
                    Retval.Add(s, true);
                    ++numMatch;
                }
                else
                {
                    Retval.Add(s, false);
                }
            }
        }
        // LINQ makes this easier, but since you're using .NET 2.0...
        List<Square> matches = new List<Square>(numMatch);
        foreach (KeyValuePair<Square, bool> kvp in Retval)
        {
            if (kvp.Value == true)
            {
                matches.Add(kvp.Key);
            }
        }
        return matches;
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T15:31:27.557

这里有几个建议——

如果您使用的是 .NET 3.5，则可以将 RetVal 更改为 HashSet<Square> 而不是 Dictionary<Square,bool>，因为您从不使用 Dictionary 中的值（仅键）。这将是一个小小的改进。

此外，如果将返回值更改为 IEnumerable，则可以直接返回 HashSet 的枚举数。根据结果​​的使用情况，在某些区域它可能会更快（如果你真的需要一个列表，你总是可以在结果上使用 ToList() ）。

但是，这里可以添加一个 BIG 优化 -

现在，您总是添加每个邻居，即使该邻居已被处理。例如，当leader被处理时，它添加leader+1y，然后当leader+1y被处理时，它把BACK放到leader中（即使你已经处理了那个Square），下一次leader从堆栈中弹出，你继续。这是很多额外的处理。

尝试添加：

```
`foreach (Square s in curItem.Neighbors)
{
    if ((0 != ((int)(s.RoomType) & match)) && (!Retval.ContainsKey(s)))
    {
        curStack.Push(s);
    }
}` 
```

`这样，如果您已经处理了邻居的正方形，它不会被重新添加到堆栈中，只是在稍后弹出时被跳过。`

 `# sql - 具有唯一列值的 Sql 查询

> ID：701161
> 
> 赞同：2
> 
> 时间：2009-03-31T14:13:07.263
> 
> 标签：sql, unique

我的目标是编写查询。我有三个表，A、B 和 C。这些表的编写方式是 A.bID = B.bID，B.cID = C.cID。这基本上允许我编写一个查询，将记录从 a 链接到 b，并将 b 记录链接到 c 的记录。到目前为止一切顺利，简单的查询。

我的问题是......查询中包含的列之一（我们称之为C.col3）必须具有唯一值；该列的值在查询结果中只能出现一次，而其他表中的其他列则没有这个要求。

有人可以帮我写这个查询吗？

谢谢...

**更新1：**

这是表格布局（对不起，我必须使用通用名称）

**表 A**
aID、bID、aCol1、aCol2、aCol3 ... aCol10

**表 B**
出价、cID、bCol1、bCol2、bCol3 ... bCol10

**表 C**
cID, cCol1, cCol2, ***col3*** , cCol4 ... cCol10

如果没有 col3 中的唯一值约束，我会这样编写查询：

```
SELECT
    A.aID, A.bID, A.aCol1 ... A.aCol10,
    B.bID, B.cID, B.bCol1 ... B.bCol10,
    C.cID, C.cCol1, C.cCol2, C.col3 ... C.cCol10
FROM
    A, B, C
WHERE 
    A.bID = B.bID AND B.cID = C.cID 
```

...但当然这并不能确保 C.col3 中的值是唯一的。

**更新 2：** 更多信息...
表 A 和表 B 具有一对多关系；A是“标题”，B是“项目”。
表 B 和表 C 具有一对一的关系。

这些表是缓存机制的一部分，所以很多数据看起来很相似，但在某些列中仍然不同。

由于 A 是表头，大部分重复值会在 A 中找到。

我首先需要按 A.aID 对行进行排序，但之后我只需要返回第一行，而 C.col3 的值不需要出现在该列的前一行。

这是否使事情更清楚了，还是我仍然没有任何意义？:)

**最终更新：**

我选择了 Bartosz Klimek 的答案，因为它最接近我的需要；我只需要修改中间的嵌套连接子句。

感谢大家的帮助！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T15:33:58.380

我将快速举一个你正在尝试做的事情的小例子，希望这将有助于澄清为什么你所问的（目前）是不可能的。

如果您有一个客户表 [CustomerID, CustomerName] 和一个订单表 [OrderID, CustomerID, DollarAmount]

如果您想要客户的所有订单：

```
SELECT CustomerName, OrderID, DollarAmount
FROM Customer, Orders
WHERE Customer.CustomerID = Orders.CustomerID 
```

它会回来

```
 "Acme Corp.", 1, $2300
 "Acme Corp.", 2, $3022
 "A company",  3, $1234 
```

一切都是好的。

但是您的问题的等价物是要求此查询，但具有唯一的 CustomerNames。在“Acme Corp”旁边，您会为 OrderID 和 DollarAmount 显示什么？

你可以使用聚合来显示一些东西，

```
SELECT CustomerName, MAX(OrderID), SUM(DollarAmount)
FROM Customer, Orders
WHERE Customer.CustomerID = Orders.CustomerID
GROUP BY Orders.CustomerID 
```

但我相信您提到您不想使用聚合。

这是否清楚地解释了这个问题？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T15:01:41.937

我开始发布另一个答案，但在重新考虑后我删除了它。如果我正确阅读了这个问题，我认为这是一个不可能/不合逻辑的问题。让我用一个例子来解释。如果我读错了，请举例说明您要查找的内容。

## 表 A

```
出价 COL1
1 价值1
2 值1
3 价值2

```

## 表 B

```
投标 CID COL 2
1 4 价值X
2 5 值Y
3 6 值Z

```

## 表 C

```
CID COL3
4 价值#
5 价值@
6价值~

```

## 预期结果

```
A.Col1 A.BID B.BID B.CID B.COL2 C.CID C.COL3
价值1？？1 1 4 值X 4 值#
价值1？？2 1 5 价值Y 5 价值@
值2 3 3 6 ValyeZ 6 值~

```

根据您不希望在第一列中重复 value1 的问题，但是如果您没有唯一约束，您建议在第二行中通常会重复什么？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T15:23:44.130

```
SELECT A.*, B.*, C.*
  FROM C
    JOIN B ON B.cID = C.cID
    JOIN A ON A.bID = B.bID
    JOIN
    (
      SELECT id = min(aID)
        FROM C
          JOIN B ON B.cID = C.cID
          JOIN A ON A.bID = B.bID
        GROUP BY col3
    ) D ON D.id = A.aID 
```

请注意，最后的子查询确保对于每个 col3 值，您在最终结果集中最多有一条记录。选择的记录是具有最小 aID 的记录。显然我假设aID、bID 和cID 分别是A、B 和C 的主键。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T14:17:40.870

```
select distinct c.col3 from c inner join b on c.cID = b.cID inner join a on b.bID = a.bID 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T14:22:14.293

如果您还需要表中的其他值，请使用：

```
select max(a.col1), sum(b.col2), col3 from a, b, c
where A.bID = B.bID, and B.cID = C.cID
group by C.col3 
```

在所有未分组的列上，您需要使用聚合函数，例如

*   AVG：列的平均值。
*   计数：记录数。
*   MAX：列的最大值。
*   MIN：列的最小值。
*   SUM：列的总和。

# html - 您能否提供一些示例说明为什么使用正则表达式难以解析 XML 和 HTML？

> ID：701166
> 
> 赞同：411
> 
> 时间：2009-03-31T14:13:39.727
> 
> 标签：html, xml, regex

我看到人们[一遍](https://stackoverflow.com/questions/699708/variable-order-regex-syntax)又一[遍地](https://stackoverflow.com/questions/457015/regular-expression-help)犯的一个错误是尝试使用正则表达式解析 XML 或 HTML。以下是解析 XML 和 HTML 困难的几个原因：

人们希望将文件视为一系列行，但这是有效的：

```
<tag
attr="5"
/> 
```

人们希望将 < 或 <tag 视为标签的开头，但这样的东西在野外存在：

```
<img src="imgtag.gif" alt="<img>" /> 
```

人们经常希望将开始标签与结束标签匹配，但 XML 和 HTML 允许标签包含自己（传统的正则表达式根本无法处理）：

```
<span id="outer"><span id="inner">foo</span></span> 
```

人们经常希望匹配文档的内容（例如著名的“在给定页面上查找所有电话号码”问题），但数据可能会被标记（即使在查看时看起来很正常）：

```
<span class="phonenum">(<span class="area code">703</span>)
<span class="prefix">348</span>-<span class="linenum">3020</span></span> 
```

评论可能包含格式错误或不完整的标签：

```
<a href="foo">foo</a>
<!-- FIXME:
    <a href="
-->
<a href="bar">bar</a> 
```

您还知道哪些其他问题？

* * *

## 回答 #1

> 赞同：269
> 
> 时间：2009-03-31T17:47:38.743

这里有一些有趣的有效 XML 供您参考：

```
<!DOCTYPE x [ <!ENTITY y "a]>b"> ]>
<x>
    <a b="&y;>" />
    <![CDATA[[a>b <a>b <a]]>
    <?x <a> <!-- <b> ?> c --> d
</x> 
```

这个小小的快乐是有效的 HTML：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd" [
    <!ENTITY % e "href='hello'">
    <!ENTITY e "<a %e;>">
]>
    <title>x</TITLE>
</head>
    <p id  =  a:b center>
    <span / hello </span>
    &amp<br left>
    <!---- >t<!---> < -->
    &e link </a>
</body> 
```

更不用说针对无效结构的所有特定于浏览器的解析。

祝你好运让正则表达式与之抗衡！

编辑（Jörg W Mittag）：这是另一个很好的格式良好、有效的 HTML 4.01：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd"> 
<HTML/
  <HEAD/
    <TITLE/>/
    <P/> 
```

* * *

## 回答 #2

> 赞同：71
> 
> 时间：2009-03-31T14:26:17.917

实际上

```
<img src="imgtag.gif" alt="<img>" /> 
```

不是有效的 HTML，也不是有效的 XML。

它不是有效的 XML，因为 '<' 和 '>' 不是属性字符串中的有效字符。它们需要使用相应的 XML 实体 < 进行转义。和>

它也不是有效的 HTML，因为 HTML 中不允许使用简短的结束形式（但在 XML 和 XHTML 中是正确的）。根据 HTML 4.01 规范，“img”标签也是一个隐式封闭标签。这意味着手动关闭它实际上是错误的，相当于关闭任何其他标签两次。

HTML 中的正确版本是

```
<img src="imgtag.gif" alt="&lt;img&gt;"> 
```

XHTML 和 XML 中的正确版本是

```
<img src="imgtag.gif" alt="&lt;img&gt;"/> 
```

您给出的以下示例也无效

```
<
tag
attr="5"
/> 
```

这也不是有效的 HTML 或 XML。标签的名称必须紧跟在“<”后面，尽管属性和结束的“>”可能在他们想要的任何位置。所以有效的 XML 实际上是

```
<tag
attr="5"
/> 
```

这是另一个更有趣的：您实际上可以选择使用 " 或 ' 作为属性引用字符

```
<img src="image.gif" alt='This is single quoted AND valid!'> 
```

发布的所有其他原因都是正确的，但解析 HTML 的最大问题是人们通常无法正确理解所有语法规则。您的浏览器将您的 tagoup 解释为 HTML 的事实并不意味着您实际上已经编写了有效的 HTML。

编辑：甚至 stackoverflow.com 都同意我关于有效和无效的定义。您的无效 XML/HTML 没有突出显示，而我的更正版本是。

基本上，XML 不是用正则表达式解析的。但也没有理由这样做。每种语言都有很多很多 XML 解析器。您可以在 SAX 解析器、DOM 解析器和 Pull 解析器之间进行选择。所有这些都保证比使用正则表达式解析要快得多，然后您可以在生成的 DOM 树上使用 XPath 或 XSLT 等很酷的技术。

因此，我的回答是：不仅用正则表达式解析 XML 很困难，而且也是一个坏主意。只需使用数以百万计的现有 XML 解析器之一，并利用 XML 的所有高级特性。

HTML 太难了，甚至无法自己尝试解析。首先，法律语法有许多您可能不知道的细微之处，其次，野外的 HTML 只是一大堆臭气熏天的东西（你明白我的意思）。有各种松散的解析器库可以很好地处理 HTML，如标签汤，只需使用这些。

* * *

## 回答 #3

> 赞同：60
> 
> 时间：2009-03-31T14:18:42.600

我写了一篇关于这个主题的完整博客文章：[正则表达式限制](https://blog.paranoidcoding.com/2008/10/15/regular-expression-limitations.html)

问题的症结在于 HTML 和 XML 是递​​归结构，需要计数机制才能正确解析。真正的正则表达式无法计数。您必须具有上下文无关语法才能计数。

上一段带有一点警告。某些正则表达式实现现在支持递归的想法。但是，一旦您开始将递归添加到您的正则表达式中，您实际上是在扩展边界，应该考虑使用解析器。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-04-01T05:58:55.523

列表中没有的一个问题是属性可以以任何顺序出现，因此如果您的正则表达式正在寻找带有 href “foo” 和类 “bar” 的链接，它们可以以任何顺序出现，并且具有任意数量的其他他们之间的事情。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-03-31T14:16:30.810

这取决于您所说的“解析”是什么意思。一般来说，XML 不能使用正则表达式解析，因为 XML 语法绝不是规则的。简而言之，正则表达式无法计数（好吧，Perl 正则表达式实际上可能能够计算事物），因此您无法平衡打开-关闭标签。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-03-31T14:29:24.713

人们是否真的通过使用正则表达式犯了错误，或者它对于他们想要完成的任务是否足够好？

我完全同意使用正则表达式解析 html 和 xml 是不可能的，因为其他人已经回答了。

但是，如果您的要求不是解析 html/xml，而只是在 html/xml 的“已知良好”位中获取一小部分数据，那么也许正则表达式甚至更简单的“子字符串”就足够了。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2012-07-14T23:52:04.930

我很想说“不要重新发明轮子”。除了 XML 是一种非常*非常*复杂的格式。所以也许我应该说“不要重新发明同步加速器”。

也许正确的陈词滥调开始“当你只有一把锤子......”你知道如何使用正则表达式，正则表达式擅长解析，那么为什么还要学习XML解析库呢？

因为解析 XML 很*困难*。由于不必学习使用 XML 解析库而节省的任何精力都将远远超过您必须做的创造性工作和 bug 扑灭的数量。为了您自己，谷歌“XML 库”并利用其他人的工作。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-03-31T14:20:06.233

人们通常默认编写贪婪模式，这通常会导致未经过深思熟虑的 .* 将大块文件吞入最大可能的 <foo>.*</foo> 中。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2015-10-22T10:26:10.013

我认为问题归结为：

1.  正则表达式几乎总是不正确的。存在无法正确匹配的合法输入。如果你足够努力，你可以让它 99% 正确，或者 99.999%，但是让它 100% 正确几乎是不可能的，如果仅仅是因为 XML 通过使用实体允许的奇怪的事情。

2.  如果正则表达式不正确，即使是 0.00001% 的输入，也会出现安全问题，因为有人可能会发现会破坏您的应用程序的一个输入。

3.  如果正则表达式足够正确以涵盖 99.99% 的情况，那么它将完全不可读和不可维护。

4.  正则表达式很可能在中等大小的输入文件上执行得非常糟糕。我第一次接触 XML 是用适当的 XML 解析器替换一个（错误地）解析传入 XML 文档的 Perl 脚本，我们不仅用 100 行任何人都可以理解的代码替换了 300 行不可读的代码，而且我们改进了用户响应时间从 10 秒到大约 0.1 秒。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2012-01-12T22:47:40.593

我相信[这个](https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags) **经典**有你正在寻找的信息。您可以在其中的一条评论中找到要点：

> 我认为这里的缺陷在于 HTML 是 Chomsky Type 2 语法（上下文无关语法），RegEx 是 Chomsky Type 3 语法（正则表达式）。**由于类型 2 语法从根本上说比类型 3 语法更复杂 - 你不可能希望完成这项工作**。但是许多人会尝试，有些人会声称成功，而另一些人会发现错误并完全把你搞砸。

来自维基百科的更多信息：[**乔姆斯基层次结构**](http://en.wikipedia.org/wiki/Chomsky_hierarchy)

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2015-11-22T15:12:54.597

[我在这里](https://stackoverflow.com/a/33856224/3257871)给出了这个问题的简化答案。虽然它不占 100% 标记，但我解释了如果您愿意做一些预处理工作是如何实现的。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2015-02-06T16:07:06.723

> 一般来说，XML 不能使用正则表达式解析，因为 XML 语法绝不是规则的。简而言之，正则表达式无法计数（好吧，Perl 正则表达式实际上可能能够计算事物），因此您无法平衡打开-关闭标签。

我不同意。如果您将在正则表达式中使用递归，您可以轻松找到打开和关闭标签。

[在这里](https://stackoverflow.com/questions/1692830/matching-pair-tag-with-regex/28369773#28369773)，我展示了正则表达式的示例，以避免在第一条消息中解析示例的错误。

# php - preg_replace_callback() 内存问题

> ID：701172
> 
> 赞同：1
> 
> 时间：2009-03-31T14:15:06.680
> 
> 标签：php, regex, preg-replace, preg-replace-callback

我在测试查找/替换功能时遇到内存问题。

假设搜索主题是：

```
$主题 = "我在 A+ 杂志上写了一篇文章。
它很长，充满了文字。
我想用链接替换本文中的每个 A+ 实例
到 A+ 专用页面。";

```

要找到的字符串：

```
$查找='A+';
$find = preg_quote($find,'/');

```

替换函数回调：

```
函数replaceCallback($match)
    {
      if (is_array($match)) {
          return '<a class="tag" rel="tag-definition" title="点击了解更多关于 ' .stripslashes($match[0]) . '" href="?tag=' . $match[0] .'">'。stripslashes($match[0]) 。'</a>';
      }
    }

```

和电话：

```
$result = preg_replace_callback($find, 'replaceCallback', $subject);

```

现在，从数据库中提取了完整的搜索模式。到目前为止，它是：

```
$find = '/(?![^<]+>)\b(voice recognition|test project reference|test|synesthesia|Superflux 2007|Suhjung Hur|scripts|Salvino a. Salvaggio|Professional Lighting Design Magazine|PLDChina|Nicolas Schöffer|Naziha Mestaoui|Nabi Art Center|Markos Novak|Mapping|Manuel Abendroth|liquid architecture|LAb[au] laboratory for Architecture and Urbanism|l'Arca Edizioni|l' ARCA n° 176 _ December 2002|Jérôme Decock|imagineering|hypertext|hypermedia|Game of Life|galerie Roger Tator|eversion|El Lissitzky|Bernhard Tschumi|Alexandre Plennevaux|A+)\b/s'; 
```

然后在 7 个 mysql 表的 23 列中查找此 $find 模式（如果找到则替换）。

使用建议的 preg_replace() 而不是 preg_replace_callback() 似乎已经解决了内存问题，但我遇到了新问题：preg_replace() 返回的主题缺少很多内容......

更新：

内容丢失是由于使用 preg_quote($find,'/'); 它现在可以工作了，除了... 'A+' 在这个过程之后变成了 'A '。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T14:39:22.877

我正在尝试重现您的错误，但需要先修复一个解析错误。要么这些代码不足以成为一个好的示例，要么确实存在错误。

首先，您存储在 $find 中的值不是拉模式 - 所以我必须添加模式分隔符。

其次，您的替换字符串不包括锚标记的结束元素。

```
$subject = "
I wrote an article in the A+ magazine. It'\s very long and full of words. I want to replace every A+ instance in this text by a link to a page dedicated to A+.
";

$find='A+';
$find = preg_quote($find,'/');

function replaceCallback($match)
{
  if (is_array($match)) {
      return '<a class="tag" rel="tag-definition" title="Click to know more about ' .stripslashes($match[0]) . '" href="?tag=' . $match[0]. '">' . stripslashes($match[0])  . '</a>';
  }
}

$result = preg_replace_callback( "/$find/", 'replaceCallback', $subject);

echo $result; 
```

此代码有效，但我不确定它是否是您想要的。另外，我强烈怀疑您根本不需要 preg_replace_callback() 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:31:47.687

这对我有用，我不得不稍微改变一下预赛，但它把我的每个 A+ 变成了一个链接。你最后也错过了一个`</a>`。

```
$subject = "I wrote an article in the A+ magazine. It'\s very long and full of words. I want to replace every A+ instance in this text by a link to a page dedicated to A+.";

function replaceCallback($match)
{
    if (is_array($match)) 
    {
        return '<a class="tag" rel="tag-definition" title="Click to know more about ' .stripslashes($match[0]) . '" href="?tag=' . $match[0]. '">' . stripslashes($match[0])  . '</a>';
    }
}

$result = preg_replace_callback("/A\+/", "replaceCallback", $subject);

echo $result; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T16:09:41.397

好的 - 我现在明白你为什么要使用回调了

首先，我会将您的回调更改为此

```
function replaceCallback( $match )
{
    if ( is_array( $match ) )
    {
        $htmlVersion    = htmlspecialchars( $match[1], ENT_COMPAT, 'UTF-8' );
        $urlVersion     = urlencode( $match[1] );
        return '<a class="tag" rel="tag-definition" title="Click to know more about ' . $htmlVersion . '" href="?tag=' . $urlVersion. '">' . $htmlVersion  . '</a>';
    }
    return $match;
} 
```

stripslashes 命令对你没有任何好处。

就解决内存问题而言，您可能希望将模式分解为多个模式并在循环中执行它们。我认为您的匹配对于 PHP 来说太大/太复杂，无法在单个调用周期中处理它。

# asp.net-mvc - 我想调试（设置断点）System.Web.Mvc.DefaultControllerFactory，这可能吗？

> ID：701178
> 
> 赞同：6
> 
> 时间：2009-03-31T14:16:59.187
> 
> 标签：asp.net-mvc, debugging, debug-symbols

我有一个引用 GAC 中的 System.Web.Mvc 程序集的项目。我也有来自 Codeplex 的 ASP.NET MVC 源代码。我想通过逐步了解 DefaultControllerFactory 的方法来更好地理解它。我怎么能设置这个？

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T15:31:03.533

1.  编译 MVC 代码。
2.  卸载 MVC（以确保您不调试零售位）
3.  使用您编译的程序集，而不是零售。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-01-03T18:31:28.900

[如果您确实从 Codeplex 下载了 MVC 源文件，我已经编写了有关如何调试 System.Web.Mvc 程序集](http://www.appetere.com/Blogs/SteveM/January-2010/How-to-debug-ASP-NET-MVC-using-source-code.aspx)的分步指南，您可能会发现它很有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-13T18:40:36.393

即使解决方案配置下拉菜单显示调试，您的程序集也可能在发布中编译。也可能是 w3p.exe 加载了您的发布程序集。

1 - 使用 Build->Configuration manager 功能并确保所有项目配置都是 Debug。2 - 构建干净 3 - 重建解决方案 4 - iisreset（如果已加载，则卸载发布程序集） 5 - 调用页面 6 - 附加过程

希望现在出现实心红色圆圈 - 祝你好运

# c++ - Windows 系统中是否存在未缓冲的 I/O？

> ID：701180
> 
> 赞同：10
> 
> 时间：2009-03-31T14:18:12.210
> 
> 标签：c++, c, winapi, file-io, low-level

我想找到没有缓冲区的低级 C/C++ API，相当于 linux 系统中的“write”。有吗？

fread、fwrite 等缓冲 I/O 不是我想要的。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-31T14:25:14.580

使用 FILE_FLAG_NO_BUFFERING 选项查看[CreateFile](http://msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-11-09T20:38:20.683

[http://www.codeproject.com/Articles/51678/Improve-responsiveness-in-Windows-with-the-FILE_FL](http://www.codeproject.com/Articles/51678/Improve-responsiveness-in-Windows-with-the-FILE_FL)

防止换出缓存的唯一方法是打开带有`FILE_FLAG_NO_BUFFERING`标志的文件。然而，这要求磁盘 I/O 请求的大小可以被扇区大小（512 到 4096 字节）整除，这需要对大多数依赖于能够请求不同大小的应用程序进行大量重写。

该项目包含一个插入式包装器，它提供`CreateFile_NB()`、`ReadFile_NB()`、`WriteFile_NB()`和`CloseHandle_NB()`函数，这些函数负责在关闭打开写入的文件时进行排队和调整文件大小。

[http://msdn.microsoft.com/en-us/library/cc644950(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/cc644950(v=vs.85).aspx)

当使用 CreateFile 函数打开或创建文件时，`FILE_FLAG_NO_BUFFERING`可以指定标志来禁用系统缓存正在读取或写入文件的数据。尽管这可以完全直接地控制数据 I/O 缓冲，但对于文件和类似设备，必须考虑数据对齐要求。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-31T14:26:21.630

POSIX write() 函数的 Win32 等效项是`[WriteFile()](http://msdn.microsoft.com/en-us/library/aa365747%28VS.85%29.aspx)`. 该文档建议使用非缓冲文件 I/O，并推荐[此页面](http://msdn.microsoft.com/en-us/library/cc644950%28VS.85%29.aspx)以获取更多信息。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-31T14:19:18.607

流大约是您可以获得的最低级别..并且它们*可以*是无缓冲的。

```
int setvbuf(
   文件*流，
   字符 * 缓冲区，
   整数模式，
   size_t 大小
);

```

例子

```
  setvbuf(stdout, (char *)NULL, _IONBF, 0); //无缓冲的标准输出

```

这是 vc2008 帮助文档的摘录。

setvbuf 函数允许程序控制流的缓冲和缓冲区大小。stream 必须引用自打开后未进行 I/O 操作的打开文件。buffer 指向的数组用作缓冲区，除非它为 NULL，在这种情况下 setvbuf 使用自动分配的长度为 size/2 * 2 字节的缓冲区。

模式必须是**_IOFBF**、**_IOLBF**或**_IONBF**。如果 mode 是**_IOFBF**或**_IOLBF**，则 size 用作缓冲区的大小。如果 mode 为 _IONBF，则流是无缓冲的，并且忽略大小和缓冲区。mode 的值及其含义是：

**_IOFBF** 全缓冲；即buffer作为缓冲区，size作为缓冲区的大小。如果缓冲区为 NULL，则使用自动分配的缓冲区大小字节长。

**_IOLBF** 对于某些系统，这提供了行缓冲。但是，对于 Win32，行为与 _IOFBF - Full Buffering 相同。

**_IONBF** 不使用缓冲区，无论缓冲区或大小如何。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-31T14:40:55.417

您可以使用`_write` [MSDN Page Here](http://msdn.microsoft.com/en-us/library/1570wh78.aspx)。

# c# - 如何在 WPF 中动态更改 GridView 列的顺序？

> ID：701181
> 
> 赞同：3
> 
> 时间：2009-03-31T14:18:30.323
> 
> 标签：c#, .net, asp.net

我有两个单选按钮。如果我单击第一个单选按钮，我希望列的顺序为：

*   资产名称
*   资产
*   团体
*   类型名称
*   Iprisklevel

如果我单击第二个单选按钮，我希望列的顺序为：

*   团体
*   资产名称
*   资产
*   类型名称
*   Iprisklevel

这是我的 XAML 示例：

```
<asp:GridView ID="dgAssets" runat="server" AutoGenerateColumns="False" AllowPaging="True"
            DataKeyNames="ID" AllowSorting="True" OnPageIndexChanging="dgAssets_PageIndexChanging"
            Width="100%" OnRowCommand="dgAssets_RowCommand" OnRowDataBound="dgAssets_RowDataBound"
            OnSorting="dgAssets_Sorting">
            <Columns>

                <asp:TemplateField Visible="False">
                    <ItemTemplate>
                        <%# DataBinder.Eval(Container.DataItem, "ID")%>
                    </ItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField SortExpression="ASSETNAME">
                    <ItemTemplate>
                        <%# DataBinder.Eval(Container.DataItem, "ASSETNAME")%>
                    </ItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField SortExpression="ASSET">
                    <ItemTemplate>
                        <%# DataBinder.Eval(Container.DataItem, "ASSET")%>
                    </ItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField SortExpression="GROUPS">
                    <ItemTemplate>
                        <%# DataBinder.Eval(Container.DataItem, "GROUPS")%>
                    </ItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField SortExpression="TYPENAME">
                    <ItemTemplate>
                        <%# DataBinder.Eval(Container.DataItem, "TYPENAME")%>
                    </ItemTemplate>
                </asp:TemplateField>
                <asp:TemplateField SortExpression="IPRISKLEVEL">
                    <ItemTemplate>
                        <%# DataBinder.Eval(Container.DataItem, "IPRISKLEVEL")%>
                    </ItemTemplate>
                </asp:TemplateField>

            </Columns>
        </asp:GridView> 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T14:26:31.787

与其在设计模式下添加列，不如使用 C# 代码动态添加它们。这将允许您以任何您喜欢的方式订购它们。

动态添加列的代码：

```
DataTable dt = yourDataTable;
foreach (DataColumn col in dt.Columns)
{
    BoundField bfield = new BoundField();
    bfield.DataField = col.ColumnName;
    bfield.HeaderText = col.ColumnName;
    dgAssets.Columns.Add(bfield);
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:35:19.143

如果您只想对单选按钮单击进行排序，请使用 DataView.Sort 方法，例如

```
dataView.Sort = "AssetName, Asset, Groups, TypeName, Iprisklevel"; 
```

然后在第二个单选按钮上单击执行

```
dataView.Sort = "Groups, AssetName, Asset, TypeName, Iprisklevel"; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T14:41:47.850

您必须动态添加列。下面是一些示例代码，它们添加了一个反过来数据绑定的列。请注意，此模板是您的页面类的子类。

此方法使用完全模板化的列。我相信您也可以使用可能更简单的绑定列。一切都取决于您通常在网格视图中使用的内容。

未经测试但从工作代码中删除：

```
private void AddTemplates()
{
    TemplateField templateField = new TemplateField();
    templateField.HeaderText = entity.ChangeHistoryColumn;
    templateField.ItemTemplate = new GridViewColumnTemplate();
    GridViewMain.Columns.Add(templateField);
}

public class GridViewColumnTemplate : ITemplate
{
    public GridViewColumnTemplate() { }

    public void InstantiateIn(Control container)
    {
        Label label = new Label();
        label.DataBinding += delegate(object sender, EventArgs e)
        {
            GridViewRow row = (GridViewRow)label.NamingContainer;

            int headerID = (int)DataBinder.Eval(row.DataItem, "HeaderID");
            ((Label)sender).Text = headerID.ToString();
        };

        container.Controls.Add(label);
    }
} 
```

# language-agnostic - 有什么策略可以避免满足吗？

> ID：701190
> 
> 赞同：5
> 
> 时间：2009-03-31T14:19:32.893
> 
> 标签：language-agnostic

> **满意**（“满足”和“足够”的组合）是一种决策策略，它试图满足充分性标准，而不是确定最佳解决方案。如果在结果计算中考虑了决策过程本身的成本，例如获得完整信息的成本，那么令人满意的策略通常可能是（接近）最优的。*[（来源）](http://en.wikipedia.org/wiki/Satisficing)*

软件工程中的大多数决策都很容易做出，而无需在该主题上思考数小时。想到的第一个解决方案通常足够好，因此我们可以快速使用它并继续下一个决定。

但是，在极少数情况下，您必须解决更困难和/或更关键的问题。如果以次优方式解决这些问题，可能会花费您大量金钱或时间。

在这些情况下，我通常会尝试提出几种完全不同的解决方案/方法来解决问题。然后我选择一个并改进它，直到我对我的解决方案完全满意。

通常这是可行的，但有时我只能想出一个足够但不是很好的解决方案。我知道我的解决方案不是很好，而且问题很严重，需要付出更多努力。然而，我已经找到的解决方案的知识阻碍了我的创造力，所以我找不到第二个（至少不是马上）。我坚持我平庸的想法，除非我可以问别人，否则我必须实施它才能继续前进。

有没有克服这个问题的技术？我能想到的两件事是与其他人进行头脑风暴会议或散步。

在这些情况下你会怎么做？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T15:01:58.237

我通常会遇到两个问题，将问题搁置一周：a）我的老板可能不会这样做，因为企业通常需要尽快解决，而不是稍后，并且 b）我的注意力跨度为金鱼，所以如果我放弃一个问题那么久，我将不得不花时间来解决这个问题，因为与此同时我的大脑已经充满了许多其他问题。

这并不完全是坏事，因为有时当我被迫刷新自己的代码和定义问题的业务约束时，我确实找到了一个更好、更优雅的解决方案，但有时我只是花半天时间让自己陷入同样的​​困境-结束。

话虽如此，把问题放在一边是个好主意，但重要的是时间框架。在一天结束的意大利面条代码大脑锁定惨败后的早晨，我经常在吃早餐时意识到一个解决方案。

尝试向同事阐明问题通常会有所帮助，因为这种努力会暴露您对问题的理解方面的差距。通常，除非他们实际上从一开始就与您一起解决问题，否则他们不会找到更好的解决方案，因为他们不会理解您可能花费数天时间在脑海中绘制的所有限制。

为了回答最初的问题，在一些同事休息并运行它之后，我的首选方法是实施适当的解决方案并让一些工作正常。

一个原因是，如果客户决定那不是他们想要的，因为他们从一开始就真的不知道他们想要什么，那么你就不会花太多时间在无论如何都会被扔掉的东西上。另一个原因是适当的解决方案可能就是：适当的。你可以继续前进。最好的理由是，实现可以让您快速解决难题，并且从那里您可能会开始看到更好的解决方案。

这就像作为建筑师构建模型。你可以画很多图，甚至花很多时间在漂亮的渲染上，但快速拿到胶枪并开始将纸板模型放在一起确实更有效。一旦您可以在 3D 中看到它，您就可以开始看到哪些地方没有正确排列，并且您没有将时间浪费在可以掩盖缺点的漂亮渲染上。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-31T14:25:42.380

根据我的经验，我通过将问题搁置一段时间来解决这个问题，比如一周。让它休息。然后带着更新鲜的头脑回来，你会开始看到以前看不到的东西。

当然，YMMV。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-31T14:30:36.940

向其他人描述问题并询问他们将如何解决。有时它会与您想出的解决方案相同，在这种情况下，指出您已经发现的缺陷并继续对话。

有时它会是一个您没有想到的解决方案，或者是一个可以帮助您使用您确实想到的解决方案解决问题的解决方案。

不管结果如何，我发现与他人讨论这个问题通常是一种非常有益的策略。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-07-03T03:54:37.190

我知道这有点异端，但我发现为解决方案编写文档会有所帮助。仅仅把它写在纸上就会迫使你以不同于在上面编码的方式思考和组织问题。尝试根据业务问题来描述解决方案往往有助于指出差距所在，而这些反过来又提出了替代解决方案。在最好的情况下，您最终会采用新方法。在最坏的情况下，您最终会得到文档。给自己一定的时间。从大纲开始，直到时间用完、完成文档或从替代解决方案中获得灵感。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T14:36:46.537

令人满意是催生人工智能的技术。一些非常重要的软件，包括驾驶方向生成器和网络路由，都是基于效率与完整性的权衡来完成的。

处理此问题的最佳方法是实施解决方案，并在项目的其他部分明显需要修复时修复其中不完整的部分。

显然，在这方面有很大的错误方向，最终会草率地组合在一起，但请记住，整个系统的上下文是衡量您所写内容质量的地方。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-31T14:37:00.793

我发现停止查看解决方案并开始查看问题很有用。也许我正在尝试解决错误的问题。看看，看看那里是否真的存在不同的问题。如果你觉得你的解决方案只是“足够”，那很可能是因为它没有解决正确的问题。

也许您的客户要求您制作更好的水壶。他们真的想要更好的水壶或更好的咖啡吗？也许你根本不需要给他们做一个水壶，而是把他们带到拐角处的咖啡馆。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-10T19:38:31.730

为什么要避免满足？这是生存所必需的。

# security - NHIbernate 和安全/业务层

> ID：701192
> 
> 赞同：2
> 
> 时间：2009-03-31T14:20:03.690
> 
> 标签：security, nhibernate, business-logic-layer

我刚刚开始为个人项目玩弄/学习 NHibernate，并且觉得我没有“得到”一些东西。我习惯于让应用程序像这样工作：

表示层 --> 业务层 --> 持久层。例如，我的表示层将调用 BusinessLayer.GetCustomer(id)。在该方法中，我将检查调用者是否有权获取客户。好的，这仍然适用于 NHibernate。不过，我的问题是我如何对更新、添加和删除有任何安全性？例如，假设我想修改我得到的客户。通常，我会这样做：

```
customer.FirstName ="Mike";
BusinessLayer.UpdateCustomer(customer); 
```

同样，UpdateCustomer 方法将检查您是否可以更新此客户。好的，但是使用 NHibernate，要更新客户，我只需设置 FirstName。然后我不需要调用更新，因为它都是透明的。这就是 Hibernate 的正确之处：“透明和自动持久性”。那么，如何通过这种透明度进行安全检查呢？我只是不相信自己足够不会犯错误并做类似的事情：

```
List<string> customerNames = new List<string>();
foreach (Customer c in GetCustomersThatLikeStuffThatILike()) {
   string custName="";
   c.CustomerName = custname; //Oops. I meant to say: custname = c.CustomerName;
   customerNames.Add(custName);  
} 
```

哎呀。我刚刚清除了数据库中所有客户的姓名。这是人为的吗？是的。现在，如果我有某种 BusinessLayer 检查到位，这只会引发异常，因为该用户无法更新其他用户的名称。

另一个问题。假设我是管理员，并且可以在系统中做任何事情，并且我有这样的代码：

```
//Display a customers orders that haven't shipped yet:
var Orders = Customer.Orders;
Orders.RemoveAll(order => order.HasNotShipped);
Grid.DataSource = Orders;
Grid.DataBind(); 
```

好的，所以在这里我只是想过滤订单，但我不小心把它们从数据库中删除了。透明度导致我做了一些非常糟糕的事情。如何减轻这种风险？

我真的*很想*使用 NHibernate，但我*不想*以错误的方式使用它。帮助！:)

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-31T16:36:52.160

对于您的安全问题，请查看 NHibernate [Inteceptor 文档](http://nhforge.org/doc/nh/en/index.html#manipulatingdata-interceptors "拦截器参考")。拦截器让您可以连接到会话生命周期，并启用您正在寻找的功能。

第二个问题是为什么您创建存储库并仅公开您需要的功能。如果应用程序不需要 RemoveAll 函数（大多数不需要），那么不要公开它。

# javascript - ExternalInterface.call() 没有得到返回值

> ID：701200
> 
> 赞同：6
> 
> 时间：2009-03-31T14:22:19.143
> 
> 标签：javascript, apache-flex, flash, actionscript-3

我有一个返回 div 的 innerHTML 的 Javascript 函数。我正在尝试从 Actionscript 调用此函数并存储返回值。我知道正在调用 Javascript 函数，因为有一个显示返回数据的警报，但是返回到 Actionscript 的数据为空。我不确定是什么原因造成的。这是我正在尝试做的代码示例：

```
Javascript:
function JSFunc () {
     var x = document.getElementById("myDiv");
     alert(x.innerHTML);
     return x.innerHTML;
}

Actionscript:
import flash.external.*;
if (ExternalInterface.available) {
     var retData:Object = ExternalInterface.call("JSFunc");
     if(retData != null) {
          textField.text = retData.toString();
     } else {
          textField.text = "Returned Null";
     }
} else {
     textField.text = "External Interface not available";
} 
```

就像我之前说的，警报会显示 div 的内容，但文本字段中的文本始终是“Returned Null”，这意味着 ExternalInterface 可用。我应该补充一点，我只能在 IE7 和 IE8 中进行测试。任何关于做什么的建议将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T16:08:37.873

这是基于您提供的代码[的工作示例。](http://osmanu.com/flex/EITest/EITest.html)您可以右键单击它以查看源代码。我怀疑问题出在“myDiv”的 HTML 中，或者在您进行 actionscript 调用时。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T19:37:28.043

我一直遇到的问题的根源必须是我用来嵌入 Flash 电影的对象标签。我使用了遵循此示例[http://www.w3schools.com/flash/flash_inhtml.asp](http://www.w3schools.com/flash/flash_inhtml.asp)的标签，我对其进行了更改以匹配此示例： http: [//kb.adobe.com/selfservice/viewContent.do ?externalId =tn_4150](http://kb.adobe.com/selfservice/viewContent.do?externalId=tn_4150)然后我确保将 id 添加到对象并且一切正常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T14:31:28.247

尝试加入`as String`通话：

```
textField.text = ExternalInterface.call("JSFunc") as String; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T14:38:35.737

我还注意到您的代码中有错字 => textField != textfield

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T15:10:50.213

尝试从外部接口调用中取回对象而不先强制转换它，然后在调试器中查看它。如果它不是字符串，则尝试将其强制转换为字符串将导致 null。这应该是一个字符串，但在尝试使用它之前看看你实际上得到了什么并没有什么坏处。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-02T06:49:13.993

在我看来，您的问题是您从 javascript 返回一个字符串，即 myDiv 元素的 innerHTML 属性。在 actionscript 中，您已将 ExternalInterface 调用返回的变量作为对象进行数据类型化，但它是一个字符串。也许你已经发现了这一点，但我不能说你还没有修改你的代码。

```
//The following is an Object
var x = document.getElementById("myDiv");

/*
You are returning the innerHTML property of x, a string, but on the
flash end your expecting an object in your actionscript.
*/
return x.innerHTML;

//The following seems incorrect to me.
var retData:Object = ExternalInterface.call("JSFunc");

//Should be
var retData:String = ExternalInterface.call("JSFunc"); 
```

希望这有帮助，保重。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-03-31T14:26:47.870

您应该使用 import 语句

```
import flash.external.*; 
```

# zend-framework - 如何在一个 Zend_Form 中连续放置 2 个按钮

> ID：701209
> 
> 赞同：3
> 
> 时间：2009-03-31T14:25:04.223
> 
> 标签：zend-framework, layout, zend-form, decorator

我认为在您的 Web 应用程序中拥有下面有“编辑删除”按钮的表单是一个常见的要求。但是采埃孚将一个按钮放在另一个按钮下，这是违反直觉的。我猜 ViewScript 装饰器可以帮助我完全覆盖按钮 html。

但是如何跨其他形式做到这一点，以避免重复？可能是我过于复杂了，我应该以某种方式粘贴 html 代码而不是按钮元素对象？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-08-06T00:16:31.057

这是我在自己的 Form 类中使用的代码，我的所有表单都继承自该类。主要技巧是仅在按钮本身上使用 ViewHelper 装饰器，并将按钮粘贴在使用 DtDdWrapper 的显示组中，并将按钮包装在 a 中以`<div class='buttons'>`获得额外的样式选项

```
 protected $_buttons = array();

  /**
   * Sets a list of buttons - Buttons will be standard submits, or in the getJson() version
   * they are removed from display - but stuck in the json in the .buttons property
   *
   * $buttons = array('save'=>'Save This Thing', 'cancel'=>'Cancel') as an example
   *
   * @param array $buttons 
   * @return void
   * @author Corey Frang
   */
  public function setButtons($buttons)
  {
    $this->_buttons = $buttons;
    foreach ($buttons as $name => $label)
    {
      $this->addElement('submit', $name, array(
          'label'=>$label,
          'class'=>$name,
          'decorators'=>array('ViewHelper'),
        ));
    }
    $this->addDisplayGroup(array_keys($this->_buttons),'buttons', array(
      'decorators'=>array(
        'FormElements',
        array('HtmlTag', array('tag'=>'div', 'class'=>'buttons')),
        'DtDdWrapper'
      )
    ));
  }

  // Example from form::init()
  $this->setButtons(array('save'=>'Save Entry', 'delete'=>'Delete Entry')); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:55:50.577

在 Zend Developer Zone 上阅读本教程：

[带有 Zend_Form 的装饰器](http://devzone.zend.com/article/3450-Decorators-with-Zend_Form)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T17:53:27.680

可以在 Form 的构造函数中修改按钮装饰器。由于 dt/dd 标签，按钮应该**没有 HtmlTag 装饰器以禁用单独的行，可以像这样删除 HtmlTag 装饰器：**

```
$buttonobject->setDecorators(array(
    'ViewHelper',
    //array('HtmlTag', array('tag' => 'dd')),
    //array('Label', array('tag' => 'dt')),         
)); 
```

评论仅用于演示目的。此外，出于样式目的，按钮可以分组到一个字段集中：

> $this->addDisplayGroup(array('delete','submit'),'buttons');

可选的 site.css 代码：

```
#fieldset-buttons { border: none; } 
```

# development-environment - 开发人员是否应在其 PC 上拥有管理员权限

> ID：701214
> 
> 赞同：152
> 
> 时间：2009-03-31T14:25:50.040
> 
> 标签：development-environment

开发人员应该在他们的 PC 上拥有管理员权限，还是给予他们高级用户访问权限就足够了？

一些评论：

*   如果他们想尝试一些需要安装的新应用程序，那么他们可以在虚拟机上尝试，然后让网络管理员为他们安装它。你认为这行得通吗？
*   开发人员需要在其 PC 上执行哪些需要管理员权限的操作？

我们是由 5 名开发人员组成的团队，负责构建 Web 应用程序

* * *

## 回答 #1

> 赞同：259
> 
> 时间：2009-03-31T14:51:19.697

答案是“是”。开发人员需要使用系统配置来测试项目、安装软件（如果没有别的，测试他们碰巧正在开发的任何东西的安装过程）、查看注册表并运行没有管理员权限就无法正常工作的软件（只需列出一些项目）。开发工作中还有许多其他任务需要管理权限才能完成。

请记住，开发人员不一定对生产系统具有 root 访问权限，本地 PC 上的管理员权限不会显着损害生产系统的安全性。几乎没有合法的操作理由来限制需要它来完成工作的员工对本地 PC 的管理员访问。

但是，提供管理访问权限的最重要原因是设置受损或二流的开发环境会向您的开发人员发送一条消息：

> *“我们如此看重你的工作，以至于我们准备无缘无故地严重损害你的工作能力。事实上，我们很乐意这样做来掩饰自己的屁股，迎合小官僚机构的一时兴起，或者因为我们根本无法被打扰。这只是最好的情况。最坏的情况是，我们真的是那种控制狂，认为告诉你如何做你的工作以及你做什么或不需要做什么是我们的特权。用你得到的东西去做，并感谢你有一份工作。*

一般来说，为开发人员提供二流（更不用说存在根本缺陷）的工作环境是惹恼员工的自然后果——无法留住有能力的人、员工流动率高、士气低落和交付质量差。不顾一切地这样做——特别是如果有一种迎合官僚心血来潮的暗示——是不负责任的。

请记住，您的员工流失不仅会产生更换员工的成本。人员流失最严重的代价是，留下来的大部分将是找不到更好工作的枯枝落叶。随着时间的推移，这会降低受影响部门的能力。如果您的行业足够接近，您还可以发现自己获得了声誉。

需要注意的一点是，与在 Windows 上相比，在 unix-oid 或大型机系统上进行开发时，管理权限的问题要小得多。在这些平台上，用户可以在自己的域中做更多的事情，而无需系统范围的权限。您可能仍然希望开发人员能够获得 root 或 sudo 访问权限，但如果没有这些访问权限，就会少得多。这种灵活性是 Unix 衍生操作系统在计算机科学学校中持续流行的一个重要但鲜为人知的原因。

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2009-03-31T14:31:34.817

开发人员应该完全控制他们正在使用的机器。大多数调试工具需要管理员权限才能连接到它们正在构建的应用程序的运行时。

此外，开发人员经常下载并尝试新事物。添加额外的步骤，例如需要网络管理员过来并为他们安装一些东西只会让开发人员感到沮丧，并且很快会让网络运营人员的生活陷入困境。

也就是说，他们应该是他们盒子上的管理员，而不是网络上的管理员。

* * *

## 回答 #3

> 赞同：51
> 
> 时间：2009-03-31T14:30:44.880

是和不是。

是的，它节省了很多麻烦系统支持的时间。

不，您的用户没有它，所以不要指望它。

我们使用管理员权限进行开发并在没有管理员权限的情况下进行测试。效果很好。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-03-31T14:46:44.357

本地管理员是的，出于上述所有原因。网络管理员不，因为他们将不可避免地被吸引到网络管理任务中，因为“他们可以”。开发人员应该正在发展。网络管理是一项完全不同的工作。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-03-31T15:14:51.780

开发人员通常需要做一般人不会做的事情，因此通常应该有管理员帐户。让他们跳过尴尬的圈子会浪费他们的时间并使他们士气低落。在高度安全的情况下可能会有例外，但如果你不能信任拥有管理员帐户的人，你肯定不能信任他们的代码。

他们还应该有一个与其用户具有相同权限的可用帐户（如果用户池具有不同的权限状态，则可以使用多个帐户）。否则，他们可能只是开发一些很酷的东西，部署它，然后发现它对用户不起作用。

还有太多方法可以用管理员帐户搞砸计算机（是的，我已经做到了）。IT 部门需要一个政策，如果他们不能快速修复开发人员的计算机，他们将对其进行重新映像。在我签约的一个地方，我必须签署一份该政策的副本才能获得我的管理员帐户。

这是一个非常适用于 Windows 的答案。在 Linux 和其他 Unix-y 系统中，开发人员通常只能使用用户帐户，通常不需要另一个帐户进行测试（如果他们有一个可以 sudo 使用的帐户，他们确实知道何时使用sudo，但他们可能需要一个具有相同组权限的人），并且很容易对操作系统造成难以置信的损害，因此需要相同的 IT 策略。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2009-09-15T14:18:01.250

忍受了必须在没有机器管理员权限的情况下进行开发的痛苦，我的回答只能是肯定的，这是必不可少的。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2009-09-09T16:44:00.427

是的，半条命 1（以及所有相关的模组：反恐精英、失败之日等）需要管理员权限（我认为至少在第一次运行时）才能在 Windows NT、2000、XP 等中正常工作.

而且，什么样的开发者不会在午餐时间玩反恐精英？（肯定是蹩脚的）

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2009-04-03T14:45:54.470

绝对地！否则我将如何安装下载管理器以在晚上下载电影？

有时开发人员确实需要在系统中安装一些东西或改变一些东西来测试一些想法。如果您每次需要更改某些内容时都必须致电管理员，那将是不可能的。

我也有我个人的观察，一些管理员倾向于把所有可能的事情都拧紧，以便让即使是很小的事情每天都依赖于他们，因此......什么，确保他们的工作？惹怒其他用户？没有答案。但是这里看不到常识。

上次我的电脑出现问题时，我积极参与了恢复系统，提出了一些与管理员团队合作的建议，或者我想……管理员变得非常生气并指责我试图教书他或重新定义规则。我想这只是他的自负，因为在我们房间里的其他同事中没有看到他那么酷。

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2009-09-09T16:37:13.757

答案是，开发者应该有 2 台机器！！

*   一种具有管理员权限和足够的电源、内存、屏幕大小和可移植性以及管理员权限的开发版本，加载了公司防病毒软件，但在需要自动重置策略时可由开发人员配置。

*   一种具有公司负载、策略、非管理员用户权限等的公司...开发人员可以将其用于单元测试发布模式应用程序，因为一些开发人员有使用管理员权限进行所有单元测试的讨厌习惯。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-03-31T14:30:15.193

如果您颠倒问题，我认为它会变得更容易回答；我们应该从开发人员那里删除管理员权限吗？有什么收获？

但实际上，我认为答案取决于你的背景和环境。小型初创公司将对 ISO 认证的政府机构有不同的回答。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-03-31T14:41:03.030

是的，但他们需要了解用户在更有限的环境中运行软件时将面临的限制。开发人员应该可以轻松访问资源和权限有限的“典型”环境。过去，我将构建部署到这些“典型”系统之一（通常是我自己的工作站上的虚拟机）作为构建过程的一部分，这样我总能快速了解软件最终是如何工作的——用户的机器。

程序员还有责任了解为非管理员用户编写软件的硬性规则。他们应该确切地知道他们总是允许（或禁止）访问哪些系统资源。他们应该知道用于获取这些资源的 API。

“它适用于我的机器”绝不是借口！

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-04-03T13:37:53.450

作为系统管理员，我完全支持在其工作站上拥有本地管理员权限的开发人员。在可能的情况下，使用标准的“用户”级别帐户执行大多数操作，然后使用另一个“管理员”帐户进行更改、安装应用程序等，这并不是一个坏主意。通常，您可以 sudo 或 runas 完成您想要的操作，甚至无需登录出去。提醒我们最终用户在发布到生产环境时必须跳过哪些安全问题也很有帮助。

附带说明一下，还建议您拥有一个 [干净的] 系统或虚拟机，这样您就可以正确地测试事物，而不会由于系统调整而陷入“它在我的系统上看起来/工作正常”的场景。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2009-04-03T14:58:56.797

### 没有超级用户

首先，Power User 基本上是管理员——因此将用户“*限制*”为 Power User 并不会增加系统的安全性——您还不如成为管理员。

### 以普通用户身份交互式登录

其次，开发人员当然需要对其开发人员机器（以及服务器和第二个盒子等）的管理访问权限，但当然，在正常开发或测试期间，任何人都不应以管理员身份交互登录。对此应用程序和大多数应用程序使用普通用户帐户。

你真的不想以管理员身份运行[插入任何浏览器、插件、IM、电子邮件客户端等]。

您通常也不以 root 身份登录您的 Linux 机器，即使您在需要时可能具有 root 访问权限。

### 使用单独的个人管理员帐户

为开发人员提供一个单独的个人管理员帐户到他/她的机器（最好是域帐户），该帐户也是其他开发/测试服务器和人员需要管理访问权限的盒子上的有效管理员。

利用“运行方式”和 Vista+ UAC 中的提示或请求提示，仅在需要时输入任务和进程的管理凭据。带有智能卡或类似功能的 PKI 可以大大减少经常输入凭据的压力。

### 每个人都很开心（或者？；）

然后审核访问。这种方式具有可追溯性，并且是一种简单的方法来找出谁正在使用您现在必须访问的特定开发/测试服务器上的终端服务会话......

诚然，肯定有一些开发工作永远不需要本地管理员权限——就像大多数 Web 开发一样，其中部署是针对单独的服务器或虚拟机进行测试的，而 cassini 或用于本地调试的任何东西实际上可以像普通用户一样运行良好。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2013-08-02T08:43:16.207

[抱歉英语不是我的母语，尽我所能:)] 好吧，

个人经验（我是 C++/SQL 开发人员）：

在我以前的工作中，我曾经是我的 Windows 机器的管理员。我还拥有数据库的 dbo（不是 dba）权限，包括生产环境数据库。在 2 年半的时间里，8 个人拥有这些疯狂的高权利……我们从来没有遇到过任何麻烦。实际上我们通过手动更新数据库解决了很多问题。我们可以为热修复和开发人员快速做很多事情。

现在我换了工作。我设法（哭了很多）成为我的 Windows 机器的管理员。但是开发服务器是我们使用 ssh 连接的红帽服务器。试图安装 Qt 是一种折磨，配额限制、空间限制、执行和写入权限。我们最终放弃了，并要求管理员为我们做这件事。2周后仍然没有安装任何东西。我在阅读报纸和使用 alt+tab 方面变得非常快。

我要求管理员权限，因为只有我的软件开发人员使用这台机器。

--> 回答：“如果有进程，你就不要做任何你想做的事情。它必须在 prod 中运行良好一次”。

--> 试图向非技术经理解释：“我在生产或 UAT 环境中没有任何管理员权限。但我的开发机器不同。如果我要建造椅子而不是软件，你会告诉我我可以吗？ '不要在我的工作室中放置我想要的任何工具，因为我的工作室需要看起来像使用椅子的地方？我给 uat 一个可执行包。我用来构建它们的库和工具对最终用户或安装包的家伙。”

我今天还在等。我找到了解决方案，打开一个开发环境，去找你最喜欢的在线评委，挑战自己。当有人看你的屏幕时，他会看到你在编程。;)

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2009-04-03T15:23:38.623

我主要在 *nix 世界和标准模型中工作，开发人员可以在普通的、非特权用户帐户中工作，并且能够（通过`sudo`或`su`）在必要时升级到管理员权限。

我不确定等效的 Windows 安排是什么，但根据我的经验，这是理想的设置：

*   一方面，按需提供管理员权限可以让开发人员在需要时完全控制他的工作站。

*   另一方面，Windows 软件长期以来一直假定所有用户都具有管理员权限，以至于许多程序无法为非管理员用户运行。许多 Windows 的安全问题直接源于这种隐含的要求，即为了能够可靠地使用计算机，所有用户都必须是管理员。 *这必须改变*，确保您的软件将为非管理员用户运行的最有效方法是让您的开发人员自己作为非管理员用户运行它。

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2009-03-31T14:44:02.353

你可以用两种方式回答这个问题。是和不是，或者这取决于。——我能不能再含糊一点……

这取决于他们是否需要完成他们的工作。如果是，则授予他们对其计算机的管理权限。如果没有，那就不要。并非所有软件开发都要求工程师拥有管理员权限。

是和否取决于你的看法。一些工程师将他们的计算机视为他们的领域，他们是他们领域的规则。其他人不想承担责任。

我曾在一家没有管理员权限的公司工作，每当我需要做一些需要管理员权限的事情时，我都必须致电服务台，他们授予我临时管理员权限，直到我重新启动。有时这很痛苦，但我就是这样生活的。我还曾在对我的计算机拥有完全管理员权限的地方工作。这很棒，除了我安装了一些软件，该软件会占用操作系统并且不得不将我的计算机带到服务台并让他们重新映像硬盘驱动器......

我个人认为工程师应该对他们的计算机拥有管理员权限，但要理解如果他们搞砸了，那么可以重新加载新的基线图像，他们将失去自原始基线以来所做的任何事情。但是，我不认为公司中的每个人都应该拥有其计算机的管理员权限。会计、行政助理和其他部门实际上并不需要拥有这些权利，因此不应授予它们。

* * *

## 回答 #17

> 赞同：2
> 
> 时间：2009-05-28T16:01:40.190

[https://msdn.microsoft.com/en-us/library/aa302367.aspx](https://msdn.microsoft.com/en-us/library/aa302367.aspx)

根据我的经验，我们（编码人员）和他们（安全）之间总是需要妥协。我承认（尽管我讨厌），上面的 Microsoft 文章有其优点。由于我多年来一直是一名程序员，所以我经历了我需要安装不同的调试器的痛苦，只是因为我不能生气而烦恼。它迫使我创造性地思考如何完成我的工作。经过多年与我们的安全团队（和几次讨论）的斗争，我理解他们必须保护所有区域的工作，包括我的桌面。他们向我展示了每天出现的漏洞，即使在最简单的 Quicktime 应用程序上也是如此。每次我想安装一个快速实用程序或调整我的本地 IIS 时，我都会看到他们的挫败感，这可能会导致严重的安全问题。直到我看到另一个开发人员被罐头，我才完全理解这一点。他试图调试并最终关闭了赛门铁克，只是为了让数百人获得（然后给）一些病毒。这是一团糟。在与其中一位“secheads”（安全人员）谈论发生的事情时，我可以看出他只想说，“告诉过你......”。

我了解到我们的 secheads（嗯，至少是我的）只是想保护我们的公司。好消息是我们确实找到了妥协，我可以完成我的工作，而且我们的安全网络让安全专家们很酷！

信条

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2019-09-17T19:47:00.140

是的，如果您希望渗透测试者或一些熟练的恶意用户在入侵您的域时站稳脚跟。

即妥协低级帐户>查找管理员-> Mimikatz->提升权限->域管理员。

所以不，普通用户不应该是管理员。

微软也说过 UAC 不是安全边界，所以不要这样使用它。有多种真实世界的 UAC 绕过可用。

如果他们需要管理员作为其工作角色的一部分，则提供单独的域本地管理员用户帐户，仅用于安装软件（仅在他们自己的机器上具有管理员权限），绝不用于一般用途或互联网访问。这应该有一个更严格的密码策略（例如 15 个字符的最小长度）。Runas 功能应该用于此。

任何普通用户帐户为管理员的环境都是安全灾难的根源。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-31T14:33:05.017

哇，这个问题肯定会带来一些有趣的答案。作为回复，我引用了经常使用的 - 'It Depends' :)

在小公司中，这可能只是一个务实的问题。开发人员也可能是最擅长技术的人，因此他们管理自己的机器是有意义的。

就个人而言，我是“管理员帐户”的粉丝，它可以在必要时使用 - 即“运行方式..”（我后来注意到这种方法在原则上与 UAC 非常相似）。

如果您正在开发桌面软件，那么对于开发人员来说，在他们的最终用户将体验到的范围内工作并不是一个坏主意——即有限或受限的权利。如果您在有限的权限下构建软件，那么您很有可能会遇到目标用户在相同权限集下将面临的相同问题。

话虽如此，如果你有一个好的测试实验室和/或一个体面的 QA 团队，这可能是一个有争议的问题 - 特别是如果你有一个半体面的 ALM 实践。

所以最后 - 我在没有 UAC 的情况下进行开发，主要是因为我相信自己和我的技能。在团队环境中，我会将其付诸表决。在较大的组织中，您可能没有这种自由。企业管理员通常拥有最终决定权:)

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-09-15T14:51:19.440

在我的公司，开发人员、工程师和我的老板（公司所有者）拥有本地管理员权限。我的老板也有网络管理员权限，以防我被那辆任性的巴士撞到（或退出）。其他人都被锁定了。

作为系统管理员，这种设置不时让我感到有些悲伤，尤其是在安装未经批准的软件时。但是，由于具有开发人员背景，我理解高级用户需要对他们的环境有更多的控制权，因此，我愿意忍受偶尔出现的怪癖或问题。我确实对他们的工作站进行了例行备份——以防万一。

顺便说一句，我在老板摆弄东西时遇到的问题比其他任何人都多。有点像老问题，“大象坐在哪里？他想去哪里！” 但在他本质上是“后备”系统管理员的小公司里，没有太多选择。

* * *

## 回答 #21

> 赞同：-2
> 
> 时间：2009-03-31T14:31:27.203

这取决于开发人员的技能以及他/她是否是顾问。

我认为经验丰富且值得信赖的开发人员有权对她/他的 PC 做任何他/她想做的事情，只要这不损害她/他的生产力是合理的。

* * *

## 回答 #22

> 赞同：-2
> 
> 时间：2009-04-03T15:05:25.813

Windows XP 上的任何人都不应使用管理员帐户进行日常使用，而在 Vista 中，如果您必须是管理员，则至少启用 UAC。尤其是 Web 开发人员和其他使用 Internet Explorer 浏览 Web 的开发人员。

您可以做的是让开发人员使用他们的常规用户帐户，但给他们第二个帐户，即他们 PC 上的管理员，以便他们可以根据需要使用它（运行方式）。我知道他们说 Web 开发，但对于 Windows 开发，您的软件应该使用普通用户帐户进行测试，而不是作为管理员。

# javascript - 写入文档的 IE 7 错误

> ID：701215
> 
> 赞同：0
> 
> 时间：2009-03-31T14:25:50.180
> 
> 标签：javascript, internet-explorer

我正在使用原型 JavaScript 库来读取文本区域的内容（通常是另一个 HTML 页面的**完整**标记），创建一个新窗口，然后将新窗口内容设置为相同的标记，例如所以：

```
var htmlContent = $("msHTML").value;
var win = window.open("preview.cfm", "Preview HTML", "left=20,top=20,width=500,height=500,toolbar=0,resizable=1,scrollbars=1");
win.document.write(htmlContent); //TODO - throwing an error in IE 7 - Error Invalid Argument
win.document.close(); 
```

这在 Firefox 中工作得很好，但正如评论中提到的，它在 IE7 中给出了非法参数异常。

任何人都可以帮忙吗？

在设置文档内容时，我在原型库中找不到任何可以绕过浏览器差异的东西。我知道可能有另一个基于原型构建的窗口库可能会起作用，但我认为这对于这个问题来说似乎有点矫枉过正。

提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T15:14:41.950

第二个参数为

```
window.open(url, name, features); 
```

**IE 中的“名称”，*不得*包含空格。**（影响所有版本的 IE）

```
//works
window.open('page.html', 'mypage', '');

//FAILS in IE
window.open('page.html', 'my page', ''); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:32:15.780

从中删除 URL 和标题**`window.open()`**- 这是一个与安全相关的问题。无论如何，您都不需要指定 URL，因为您在代码的下一行覆盖了窗口的内容。

这有效：

```
var win = window.open('', '', 'left=20,top=20,' +
         'width=500,height=500,toolbar=0,resizable=1,scrollbars=1');

win.document.write($("msHTML").value); 
```

# java - 在 Java 1.4 中获取线程的唯一标识符

> ID：701220
> 
> 赞同：5
> 
> 时间：2009-03-31T14:26:38.760
> 
> 标签：java, multithreading, uniqueidentifier

在 Java 1.4 中，有没有比使用更好的获取线程 ID 的方法`Thread.getName()`？

我的意思是，`getName()`在单元测试中返回类似的东西`"Thread-1"`，但在 WebLogic 10 中我得到`"[ACTIVE] ExecuteThread: '1' for queue: 'weblogic.kernel.Default (self-tuning)'.xml"`.

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-31T14:43:08.487

[Thread.getId](http://java.sun.com/javase/6/docs/api/java/lang/Thread.html#getId())（理论上它可以[溢出](https://stackoverflow.com/questions/591627/thread-getid-global-uniqueness-question)，但它被定义为不是，实际上也不会）。

1.5 现在正处于使用寿命结束期，但如果您使用的是旧的灰尘甲板 1.4，那么您可以使用[`ThreadLocal`](http://java.sun.com/javase/6/docs/api/java/lang/ThreadLocal.html). （注意，不要太紧跟 Java SE 6 API 文档！）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-31T14:43:38.047

你为什么需要这个？因为根据您的答案，有几种方法。

首先，了解线程的名称不能保证是唯一的。身份哈希码也不是。

如果您真的想将唯一 ID 与线程相关联，则需要自己进行。可能使用 IdentityHashMap。但是，这将引入一个您不希望在生产应用程序中闲逛的强大参考。

编辑：TofuBeer 的解决方案可能更好，尽管文档指出线程 ID 可以重复使用。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-31T15:08:10.703

如“ [Thread.getId() 全局唯一性问题](https://stackoverflow.com/questions/591627/thread-getid-global-uniqueness-question)” SO问题中所述，并由[**Thread.java**](http://kickjava.com/src/java/lang/Thread.java.htm)的源代码确认：

```
/* For generating thread ID */
private static long threadSeqNumber;

/* Set thread ID */
tid = nextThreadID();

private static synchronized long nextThreadID() {
    return ++threadSeqNumber;
} 
```

如果你还在java1.4中，线程id很容易自己实现。
然而，这种实现意味着当您多次运行程序时，给定线程将不会具有相同的 id。
因此，根据您的需要，您可能必须实施一个命名策略，它是：

*   对于给定的运行时会话是唯一的
*   在会话之间重用
*   仍然链接到由 1.4 JVM 管理的内部原始命名策略（“Thread-1”、“Thread-2”、...）

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-31T14:43:19.407

如果您使用的是 JDK 1.5 或更高版本，则可以使用[getID 。](http://java.sun.com/javase/6/docs/api/java/lang/Thread.html#getId%28%29)

是不是每次运行单元测试时都需要一个一致的值，或者只是一个唯一的值就足够了？

# c# - .NET - 将通用集合转换为 DataTable

> ID：701223
> 
> 赞同：80
> 
> 时间：2009-03-31T14:27:00.490
> 
> 标签：c#, generics, collections, datatable, nullable

我正在尝试将通用集合（列表）转换为 DataTable。我找到了以下代码来帮助我做到这一点：

```
// Sorry about indentation
public class CollectionHelper
{
private CollectionHelper()
{
}

// this is the method I have been using
public static DataTable ConvertTo<T>(IList<T> list)
{
    DataTable table = CreateTable<T>();
    Type entityType = typeof(T);
    PropertyDescriptorCollection properties = TypeDescriptor.GetProperties(entityType);

    foreach (T item in list)
    {
        DataRow row = table.NewRow();

        foreach (PropertyDescriptor prop in properties)
        {
            row[prop.Name] = prop.GetValue(item);
        }

        table.Rows.Add(row);
    }

    return table;
}    

public static DataTable CreateTable<T>()
{
    Type entityType = typeof(T);
    DataTable table = new DataTable(entityType.Name);
    PropertyDescriptorCollection properties = TypeDescriptor.GetProperties(entityType);

    foreach (PropertyDescriptor prop in properties)
    {
        // HERE IS WHERE THE ERROR IS THROWN FOR NULLABLE TYPES
        table.Columns.Add(prop.Name, prop.PropertyType);
    }

    return table;
}
} 
```

我的问题是，当我将 MySimpleClass 的属性之一更改为可为空的类型时，出现以下错误：

`DataSet does not support System.Nullable<>.`

如何在我的班级中使用 Nullable 属性/字段来做到这一点？

* * *

## 回答 #1

> 赞同：140
> 
> 时间：2009-03-31T14:33:21.427

然后大概你需要将它们提升到不可为空的形式，使用`Nullable.GetUnderlyingType`，也许将一些`null`值更改为`DbNull.Value`......

将分配更改为：

```
row[prop.Name] = prop.GetValue(item) ?? DBNull.Value; 
```

并在添加列时：

```
table.Columns.Add(prop.Name, Nullable.GetUnderlyingType(
            prop.PropertyType) ?? prop.PropertyType); 
```

它有效。（`??`是空合并运算符；如果它是非空的，它使用第一个操作数，否则计算并使用第二个操作数）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-31T14:34:25.573

好。由于 DataSet 不支持可为空的类型，因此您必须检查属性是否为泛型类型，获取该类型的泛型定义，然后使用`Nullable.GetUnderlyingType`. 如果值为 null，则`DBNull.Value`在 DataSet 中使用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-31T14:34:29.083

如果`Nullable.GetUnderlyingType()`给定您`prop.PropertyType`返回的非空值，请将其用作列的类型。否则，使用`prop.PropertyType`它自己。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2013-11-01T19:26:49.980

我知道这个问题很老，但我对我所做的扩展方法也有同样的问题。使用 Marc Gravell 的响应，我能够修改我的代码。此扩展方法将处理原始类型、字符串、枚举和具有原始属性的对象的列表。

```
using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Linq;
using System.Text;

/// <summary>
/// Converts a List&lt;T&gt; to a DataTable.
/// </summary>
/// <typeparam name="T">The type of the list collection.</typeparam>
/// <param name="list">List instance reference.</param>
/// <returns>A DataTable of the converted list collection.</returns>
public static DataTable ToDataTable<T>(this List<T> list)
{
    var entityType = typeof (T);

    // Lists of type System.String and System.Enum (which includes enumerations and structs) must be handled differently 
    // than primitives and custom objects (e.g. an object that is not type System.Object).
    if (entityType == typeof (String))
    {
        var dataTable = new DataTable(entityType.Name);
        dataTable.Columns.Add(entityType.Name);

        // Iterate through each item in the list. There is only one cell, so use index 0 to set the value.
        foreach (T item in list)
        {
            var row = dataTable.NewRow();
            row[0] = item;
            dataTable.Rows.Add(row);
        }

        return dataTable;
    }
    else if (entityType.BaseType == typeof (Enum))
    {
        var dataTable = new DataTable(entityType.Name);
        dataTable.Columns.Add(entityType.Name);

        // Iterate through each item in the list. There is only one cell, so use index 0 to set the value.
        foreach (string namedConstant in Enum.GetNames(entityType))
        {
            var row = dataTable.NewRow();
            row[0] = namedConstant;
            dataTable.Rows.Add(row);
        }

        return dataTable;
    }

    // Check if the type of the list is a primitive type or not. Note that if the type of the list is a custom 
    // object (e.g. an object that is not type System.Object), the underlying type will be null.
    var underlyingType = Nullable.GetUnderlyingType(entityType);
    var primitiveTypes = new List<Type>
    {
        typeof (Byte),
        typeof (Char),
        typeof (Decimal),
        typeof (Double),
        typeof (Int16),
        typeof (Int32),
        typeof (Int64),
        typeof (SByte),
        typeof (Single),
        typeof (UInt16),
        typeof (UInt32),
        typeof (UInt64),
    };

    var typeIsPrimitive = primitiveTypes.Contains(underlyingType);

    // If the type of the list is a primitive, perform a simple conversion.
    // Otherwise, map the object's properties to columns and fill the cells with the properties' values.
    if (typeIsPrimitive)
    {
        var dataTable = new DataTable(underlyingType.Name);
        dataTable.Columns.Add(underlyingType.Name);

        // Iterate through each item in the list. There is only one cell, so use index 0 to set the value.
        foreach (T item in list)
        {
            var row = dataTable.NewRow();
            row[0] = item;
            dataTable.Rows.Add(row);
        }

        return dataTable;
    }
    else
    {
        // TODO:
        // 1\. Convert lists of type System.Object to a data table.
        // 2\. Handle objects with nested objects (make the column name the name of the object and print "system.object" as the value).

        var dataTable = new DataTable(entityType.Name);
        var propertyDescriptorCollection = TypeDescriptor.GetProperties(entityType);

        // Iterate through each property in the object and add that property name as a new column in the data table.
        foreach (PropertyDescriptor propertyDescriptor in propertyDescriptorCollection)
        {
            // Data tables cannot have nullable columns. The cells can have null values, but the actual columns themselves cannot be nullable.
            // Therefore, if the current property type is nullable, use the underlying type (e.g. if the type is a nullable int, use int).
            var propertyType = Nullable.GetUnderlyingType(propertyDescriptor.PropertyType) ?? propertyDescriptor.PropertyType;
            dataTable.Columns.Add(propertyDescriptor.Name, propertyType);
        }

        // Iterate through each object in the list adn add a new row in the data table.
        // Then iterate through each property in the object and add the property's value to the current cell.
        // Once all properties in the current object have been used, add the row to the data table.
        foreach (T item in list)
        {
            var row = dataTable.NewRow();

            foreach (PropertyDescriptor propertyDescriptor in propertyDescriptorCollection)
            {
                var value = propertyDescriptor.GetValue(item);
                row[propertyDescriptor.Name] = value ?? DBNull.Value;
            }

            dataTable.Rows.Add(row);
        }

        return dataTable;
    }
} 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-07-14T14:04:01.580

这是一个经过一些修改的版本，允许使用空值和 '\0' 字符而不会破坏 DataTable。

```
using System;
using System.Collections;
using System.Collections.Generic;
using System.Reflection;
using System.Data;

namespace SomeNamespace
{
    public static class Extenders
    {
        public static DataTable ToDataTable<T>(this IEnumerable<T> collection, string tableName)
        {
            DataTable tbl = ToDataTable(collection);
            tbl.TableName = tableName;
            return tbl;
        }

        public static DataTable ToDataTable<T>(this IEnumerable<T> collection)
        {
            DataTable dt = new DataTable();
            Type t = typeof(T);
            PropertyInfo[] pia = t.GetProperties();
            object temp;
            DataRow dr;

            for (int i = 0; i < pia.Length; i++ )
            {
                dt.Columns.Add(pia[i].Name, Nullable.GetUnderlyingType(pia[i].PropertyType) ?? pia[i].PropertyType);
                dt.Columns[i].AllowDBNull = true;
            }

            //Populate the table
            foreach (T item in collection)
            {
                dr = dt.NewRow();
                dr.BeginEdit();

                for (int i = 0; i < pia.Length; i++)
                {
                    temp = pia[i].GetValue(item, null);
                    if (temp == null || (temp.GetType().Name == "Char" && ((char)temp).Equals('\0')))
                    {
                        dr[pia[i].Name] = (object)DBNull.Value;
                    }
                    else
                    {
                        dr[pia[i].Name] = temp;
                    }
                }

                dr.EndEdit();
                dt.Rows.Add(dr);
            }
            return dt;
        }

    }
} 
```

# php - 使用php上传后如何重命名文件名？

> ID：701230
> 
> 赞同：8
> 
> 时间：2009-03-31T14:29:31.763
> 
> 标签：php, file, rename

如何在文件上传之前或之后重命名文件？我只想重命名文件名，而不是扩展名。

```
$changeTXT = $_SESSION['username'];
$uploaderName = strtolower($changeTXT);
$changeTXT = strtolower($changeTXT);
$changeTXT = ucfirst($changeTXT);
$filelocation = $_POST['userfile'];
$filename = $_POST['filename'];
$max_size = $_POST['MAX_FILE_SIZE'];

$file = $_FILES['userfile'];

$allowedExtensions = array("wma", "mp3", "wav");

function isAllowedExtension($fileName) {
  global $allowedExtensions;

  return in_array(end(explode(".", $fileName)), $allowedExtensions);
}

if($file['error'] == UPLOAD_ERR_OK) {
  if(isAllowedExtension($file['name'])) {

$uploaddir = "uploads/".$uploaderName."/";

$uploadfile = $uploaddir . basename($_FILES['userfile']['name']);

if (move_uploaded_file($_FILES['userfile']['tmp_name'], $uploadfile)) {

    echo "Thank you for uploading your music!<br /><br />";

} else {

    echo "Your file did not upload.<br /><br />";

}

    echo "\n";

    echo "<a href='index.php'>Return</a> to index.<br /><br />$uploaddir";

} else {

    echo "You have tried to upload an invalid file type.<br /><br />";

  }

} else die("Cannot upload"); 
```

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-31T14:32:54.610

使用时`move_uploaded_file`你可以选择文件名，所以你可以选择任何你想要的。

当您上传文件时，将其放入具有临时名称的临时目录中，`move_uploaded_file()`允许您移动该文件，并且您还需要设置文件的名称。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-31T14:54:54.977

我建议您查看 Verot 的文件上传课程。它消除了通过 php 上传文件的许多痛苦，并使您的代码更具可读性/可维护性。

这是[课程](http://www.verot.net/php_class_upload.htm)和文档的链接。

至于您的问题的确切答案：要为上传的文件指定一个新名称，请将其作为 move_uploaded_file() 函数的第二个参数。

由于您想保留扩展名，请先将其存储在变量中：

```
$ext = explode('.',$_FILES['uploaded']['name']);
$extension = $ext[1]; 
```

您可以使用文件根名称来生成新名称（此处附加时间戳）：

```
$newname = $ext[0].'_'.time(); 
```

假设您上传了一个文件，并且您的表单输入变量名称为“myfile.png”，它将变为“myfile_2343544.png”；

现在，结合目标目录的本地路径、$newname 变量和文件扩展名来设置函数的第二个参数：

```
$full_local_path = 'path/to/your/filefolder/'.$newname.'.'.$extension ;
move_uploaded_file($_FILES['uploaded']['tmp_name'], $full_local_path); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-31T14:38:15.393

为什么不使用不同的名称保存它：

只需更改 $uploadfile 变量的名称：

```
$uploadfile = $uploaddir . "somefilename" . end(explode(".", $file['name'])); 
```

但是，如果您稍微重构一下代码，它不会受到伤害。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T14:33:04.047

当你这样做

```
$uploadfile = $uploaddir . basename($_FILES['userfile']['name']);

if (move_uploaded_file($_FILES['userfile']['tmp_name'], $uploadfile)) { 
```

只需将 $uploadfile 设置为所需文件名的整个路径；即“上传/mynewfilename.jpg”

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-04-10T09:56:41.533

您可以使用 move_uploaded_file 中的第二个参数来设置文件名。第一个参数是 /tmp 文件夹中文件的文件名，第二个参数是文件目录和新文件名。

```
move_uploaded_file($_FILES['file']['tmp_name'], "/new/file/dir/".[the new file name]); 
```

我知道这是一个老问题，但没有明确的答案。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-12-11T08:21:11.570

```
 <?php

  /*
     Just change the $path variable to your uploads path
     and dont forget the  / at the end of the  path.

     The way this function works is .When the user submits the form
     the uniqueFilename() function checks to see if there is a filename
     in your uploads folder, that has the same name as the one you intend
     to upload. If it finds a filename that has the same name as the one you want to
     upload it goes through the next steps

        Step 1

    strrpos($arg1,$arg2) - we use it to find the location where upload path ends and where the filename begins

    $arg1 = the filepath including the filename ex. uploads/myFile.jpg
    $arg2 = basename($filename); what this does is it  strips the path from the string and returns only the filename.

    When we use strrpos($arg1,$arg2) we basically tell the function to find the position of the path and exclude the filename

    Step 2

    substr($arg1,$arg2,$arg3) - looks in a string and extrats only the parts from the string that you want. We use it now to extract the uploads path.

    $arg1 = the full path of the uploaded file. ex. uploads/myFile.jpg
    $arg2 = 0  because we want to start from the begginning of the string
    $arg3 = $pathlocation which is the location of where the uploadpath ends and the file beggins

    when we use substr() here we intend to extract the uploads path.

    Step 3

    basename($arg1) strips out a path and returns the filename

    - we use this to save the original filename

    Notice that so far we have the path to the files saved and also
    the filename with its extension. We also have the file extension (.jpg|.png) or whatever

    Step 4

    pathinfo() - extracts the extension from the filename

    Step 5

    we us strrpos() to find the location of the last dot ( . ) in the filename because in step 6
    we use this location to cut the string where the dot ( . ) is

    Step 6

    substr() gets the file without the extension

    Step 7
    substr() takes the filename without extension and clips out the last charcter
    so if the filename is myFile this function would return myFil

    Step 8
    substr() again we use it to save the last character of the file so
                if our file is called myFile it would return e.

    Step 9
    Here we check to see if the last character of our file is numeric.
    Why do this? Because if the last character of a file is numeric we can just add a number to the
    file and end up with a new file with an added number so our file is
    myFile1 the 1 is numeric so our intention is to add to it
    so my myFile1 would end up being myFile2\. But what happens if our last character is not numeric?

    then we just add -1 to the file so that myFile would end up being myFile-1

    Step 10
    Since our filename exists in the database we must call the function uniqueFilename() again so that we can
    check and see if the new name exists in the database.

    This function basically keeps calling itself until it finds a filename that does not exists.
   */

    if(isset($_POST['submit'])){

    $path = "uploads/";

    $fullPath = $path.$_FILES['uploadFile']['name'];
    $full_local_path = $path.uniqueFilename($fullPath) ;
    move_uploaded_file($_FILES['uploadFile']['tmp_name'], $full_local_path);
    }
          /*
             * Function returns a unique filename
             * Param 1 is the path of the filename and the filename
             * returns filename with no path
             */
            function uniqueFilename($filepathAndFilename){

                // check to see if file exists
                if (file_exists($filepathAndFilename))
                {
                        /* step 1 */

                    //Get the path location without the basename
                  $filePathWithoutFilenameLocationInString = strrpos($filepathAndFilename,basename($filepathAndFilename));

                        /* step 2 */

                    //Get the path and cut the basename
                    $path = substr($filepathAndFilename,0,$filePathWithoutFilenameLocationInString);

                        /* Step 3*/
                    //Get the base filename
                    $filename = basename($filepathAndFilename);

                       /* Step 4 */
                       // get the extension
                    $fileExtension = pathinfo($filename, PATHINFO_EXTENSION);

                        /* Step 5 */
                    // find the position of the last dot
                    $dotLocation = strrpos($filename,'.');

                        /* Step 6 */
                    // Get the filename without the dot
                    $fileWithNoExtension = substr($filename,0,$dotLocation);

                        /* Step 7 */
                    //Get the name without the last character
                    $filenameMinusLastCharacter = substr($fileWithNoExtension,0,-1);

                       /* Step 8 */
                    //save the last character
                    $lastFilenameCharacter = substr($fileWithNoExtension,-1);

                        /* Step 9*/
                    //if the last character is numeric add 1
                    if (is_numeric($lastFilenameCharacter))
                    {
                        $newFilename = $path.$filenameMinusLastCharacter.($lastFilenameCharacter+1).'.'.$fileExtension;
                        //recursively call itself

                         /* Step 10*/
                        $results = uniqueFilename($newFilename);
                        return basename($results);
                    }else{

                        // if the last character is not numeric then add 1
                        $newFilename = $path.$fileWithNoExtension.'-1'.'.'.$fileExtension;

                            /* Step 10*/
                        //recursively call itself
                        $results = uniqueFilename($newFilename);
                        return basename($results);
                    }

                }
                return basename($filepathAndFilename);

            }
    ?>

    <!doctype html>
    <html>
    <head>
    <meta charset="UTF-8">
    <title>Untitled Document</title>
    </head>

    <body>

    <form method="post" enctype="multipart/form-data"/>
    <label>Upload File</label>
    <input type="file" name="uploadFile"/>
    <input type="submit" name="submit" value="submit"/>
    </form>

    </body>
    </html>`enter code here` 
```

# c# - 使用许可证保护自定义 .NET 组件的最佳方法是什么？

> ID：701232
> 
> 赞同：7
> 
> 时间：2009-03-31T14:29:42.277
> 
> 标签：c#, licensing

许可自定义 .NET 组件或应用程序进行销售的最佳方法是什么？

*   闭源
*   2 许可模式：
    *   试用有限功能许可证（免费）
    *   全功能

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-31T15:51:08.103

至于“封闭源”场景，请考虑使用混淆。我一直在使用[SmartAssembly](http://www.smartassembly.com/)，对结果非常满意。

至于许可模式。您说的是 .net 组件，因此目标受众是开发人员。我认为他们不会处理免费的有限试用。如果您要向开发者社区出售有价值的东西，请准备好在 Rapidshare 或种子上查看“全功能”版本。

我建议专注于支持和频繁更新/增强而不是保护。在大多数情况下，“业务”购买支持而不是二进制文件。

如果您需要一些工具标题，为什么不直接用谷歌搜索呢？“.net 许可”查询将为您提供各种链接。

希望有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T20:21:15.613

当您发布可升级到完整版本的软件试用版（换句话说，包含所有功能的程序集）时，您无法做很多事情来防止有人最终破解它。（使用 .net 比使用本机程序集更容易）。

签名和混淆是防止它以非常易读的形式被逆向工程的唯一方法，但仅使用反射器之类的东西基本上会给你完整的。

保持许可外观的最简单方法之一是：

*   使用公钥/私钥加密将许可信息（到期日期、启用的功能等）保存到文件中
*   在程序集中包含公钥
*   在您的应用程序开始时解码加密信息，以检查是否有人被许可使用您的应用程序。
*   必要时使用您的私钥生成许可证并分发这些文件（如果数据足够小，则为密钥）

作为替代方案，您可以在应用程序中以明文形式包含带有哈希码的许可信息（这是许可密钥，算法也应该支持公钥/私钥），并且只检查许可信息是否与哈希码匹配.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T14:35:49.470

这里有很多缺失的细节。

您是从某人那里获得许可还是尝试创建许可？

开源、闭源、销售？如果卖，你提供货源吗？

组件/应用程序的最终用途是什么？您是托管它（如多租户站点）还是更多 COTS？

你的竞争对手在用他们的销售模式做什么？它似乎对他们有用吗？例如，这听起来合理吗？<-效仿。

当您回答这些问题时，您会找到适合您需求的许可证。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T14:39:01.287

GPL。或者宣布它为公共领域。或者一个 24 页的 EULA，它限制用户在使用该组件时剃须的能力。或类似的东西。

您为什么不告诉我们您正在尝试做什么，预期用途是什么，以及您希望发生什么？

# visual-studio - 如何通过在 Visual Studio 2005 中选择一个大括号来导航到大括号的开头/结尾。？

> ID：701233
> 
> 赞同：3
> 
> 时间：2009-03-31T14:29:45.537
> 
> 标签：visual-studio

在 Visual Studio 2005 中，考虑我的程序有一个包含 10000 行代码的循环。如果我选择循环的开始或结束大括号'{或}'，我如何导航到循环的另一个大括号'}或{'。？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T14:32:14.970

按 ctrl + ] 应该将您带到任何突出显示的左大括号的匹配右大括号（实际上是任何选择的右大括号的匹配起始大括号）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:54:57.303

是的，在右大括号上按 CTRL+] 会将您带到左大括号。所以它是双向的。

# hibernate - 将 '0',"-1" 视为 Null

> ID：701236
> 
> 赞同：4
> 
> 时间：2009-03-31T14:30:24.913
> 
> 标签：hibernate

我正在使用一个大型的旧数据库，现在我尝试使用休眠而不是 SQL 来访问它。最大的问题之一是在没有约束的外键中使用“0”和“-1”（意思是“NULL”）。

我生成了很多代码，但我手动添加了连接。像这样

```
@OneToMany(fetch = FetchType.EAGER)
@JoinColumn(nullable = true, name = "fkActivityId")
public List<Activity> getActivities() {
    return activities;
} 
```

问题是，只要我有一个 fkActivityId = "-1" 或 "0" 表示 NULL 的对象，就会有一个异常抱怨找不到这样的对象。

有没有办法让 Hibernate 表现得好像它是 NULL？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T08:18:01.700

我现在尝试了两件事。

我写了一个 NullableIDType 扩展了 UserType，当数据包含“0”或“-1”时它会返回 null。就像 DanVinton 建议的那样（赞成！）。但有一个问题。我必须将 UserType 设置为**引用模型的 id**。

```
@Id 
@GeneratedValue
@Column(name = "pkID", unique = true, nullable = false, type = NullableIDType)
public Integer getPkId() {
    return this.pkId;
} 
```

这会强制**所有**对该模型的引用使用“0”而不是“null”。我忘了说，大多数时候 null 在应该使用的时候使用。因此，如果数据库一直使用“0”而不是“null”，这将起作用。

然后是@NotFound(action=NotFoundAction.IGNORE) w

```
@ManyToOne(fetch = FetchType.LAZY)
@JoinColumn(name="fkProjectBereichId",nullable = true)
@NotFound(action=NotFoundAction.IGNORE)
public Projectbereich getProjektbereich() {
    return projektbereich;
} 
```

起初，这似乎是一个糟糕但有效的解决方案，直到我保存了一些具有空引用的东西。它在数据库中保存为“null”，然后导致其他代码崩溃，正如它预期的“0”。

因此，为了使用休眠连接，我必须在任何地方使用相同的 null 值。没办法绕过去。

对于我的问题，这并不是一个真正令人满意的答案。但就是这样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:33:05.640

如果 fkActivityId 的值为 -1 或 0，则遍历您的数据库并将每个 fkActivityId 更新为 null。这就是 null 的用途。Hibernate 正确地完成了它的工作；是数据库设置不正确。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T14:40:27.977

Welbog 关于修复数据的答案将是首选方法。

如果您真的无法修复数据，您可以[编写自定义值类型](http://www.hibernate.org/hib_docs/nhibernate/1.2/reference/en/html/mapping.html#mapping-types-custom)来将凌乱的布尔 DB 字段映射到 java 布尔值并返回。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-31T14:33:02.473

对不起，我知道它不能回答这个问题，但如果你能回答，那就更好了。

```
update ExampleTable 
set fkActivityId = null 
where fkActivityId = 0 or fkActivityId = -1 
```

# asp.net - obout 组合框 setValue()

> ID：701238
> 
> 赞同：0
> 
> 时间：2009-03-31T14:30:44.367
> 
> 标签：asp.net, combobox, obout

我正在使用 obout 组合框来显示产品目录的色板，除了一件事之外，它非常酷。

在服务器上时，我明确设置了 .Value 属性（用于重置），它是在服务器端设置的，而不是在客户端。

例如，我添加了来自 Linq 的所有颜色样本，但随后添加了默认设置“颜色...”，其值为“”。但在第一次显示时，组合框显示为空（文本部分）。当我单击向下箭头时，一切都是正确的。

我已经尝试设置索引、值、文本并且没有工作。

我还添加了一个 registerclientscript 以尝试在客户端强制执行此操作，并且在脚本运行时（使用警报进行测试），该框未设置。

有任何想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-31T17:15:06.390

显然您不能将值设置为“”，您必须将其设置为“”。然后它将起作用。:)

# c# - 无法确定具有 ID 的功能的定义... - 未知 GUID

> ID：701243
> 
> 赞同：1
> 
> 时间：2009-03-31T14:31:11.087
> 
> 标签：c#, sharepoint, sharepoint-2007, web-parts

我正在开发一项功能以安装具有关联列表和列表实例的 WebPart。在部署列表时，会记录以下消息：

```
Failed to determine definition for Feature with ID
'cdca545a-333a-4b3f-ba15-ac3cdbb12312'.
Skipping this feature for element querying consideration. 
```

*（为清楚起见添加了换行符）*

我已经阅读了各种博客上的文章，这些文章建议通过功能搜索来识别有问题的功能。为了搜索 Sharepoint 12 目录，我下载了支持搜索子目录的[grep](http://pages.interlog.com/~tcharron/grep.html)版本，但是以下命令在我的开发 VM 或 Live 服务器上找不到任何匹配项：

```
grep -S cdca545a-333a-4b3f-ba15-ac3cdbb12312 <path to \12\> 
```

也没有：

```
grep -S -i cdca545a <path to \12\> 
```

我的开发机器由 Windows 2003 R2、Windows Sharepoint Service 3.0 SP1、Visual Studio 2008 和 STSDev 2008 组成。

目前该功能已部署但无法实例化列表，我正在尝试通过日志文件噪音来解决问题的根源。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T15:24:45.953

您可以尝试枚举您的 SharePoint 场上已安装的功能定义。以下是打印每个已安装功能的功能 ID 和显示名称的示例代码：

```
SPFeatureDefinitionCollection featureDefinitions = SPFarm.Local.FeatureDefinitions;
foreach (SPFeatureDefinition featureDefinition in featureDefinitions)
{
    Console.WriteLine("{0}: {1}", featureDefinition.Id, featureDefinition.DisplayName);
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T15:49:22.493

我不确定，但问题可能与列表实例功能有关。

在功能的元素清单中，您可以定义属性“FeatureId”，该属性必须指向包含创建列表实例时要使用的列表定义的功能。

所以这里有两个可能的错误来源。

1.  如果未定义此 FeatureId，则该功能假定列表定义是在同一功能（列表实例功能）中定义的。如果定义和实例有两个独立的特征，这可能会导致此错误。

2.  正如我已经说过的，FeatureId 必须是定义要使用的列表定义的功能的 GUID。也许您用新生成的 GUID 替换了这个 GUID，假设这不是列表定义功能的 FeatureId，而是列表实例在 MOSS 中创建时的标识符。

我自己从来没有遇到过这个问题，所以我只能猜测你错误的原因可能是什么。

也许这个[博客条目](http://blogit.create.pt/blogs/andrevala/archive/2008/06/17/SharePoint-2007-Deployment_3A00_-List-Instance-Features.aspx)可以帮助您进行进一步的调查。

# web-applications - 如何在 Web 应用程序中实现 REST？

> ID：701260
> 
> 赞同：6
> 
> 时间：2009-03-31T14:33:12.800
> 
> 标签：web-applications, rest, jakarta-ee

我想知道如何在我的 Web 应用程序中实现 REST。我想创建一个基于此服务的 Web 应用程序，但我不知道该怎么做。现在，我正在使用 J2EE 和 Tomcat。这些技术应该考虑什么？

**编辑：** 对不起，我的意思是 RESTful 服务。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-31T14:44:55.330

REST 不是特定的接口或技术，而是一种风格。最好的例子是 Web 本身——您的浏览器向 Web 服务器发送 HTTP 请求，Web 服务器以网页响应。

在这种情况下的表示状态转移：表示是网页，状态是其中包含的信息。我们可以通过切换到提供 xml 而不是 html 来更改表示，但信息将是相同的。

在 RESTful 服务中，您使用这种样式来回发送数据对象 - 状态从服务器传输给您，然后您再次发送新状态。

因此，从某种意义上说，如果您将服务器页面作为资源，Tomcat 已经为您做了 REST：http: [//carsales.com/cars/porsche2149](http://carsales.com/cars/porsche2149)可能是您汽车的资源，您可以使用 HTTP POST 或PUT 改变它的细节。

REST 的标志是使用 URI 来表示资源，如上所述，使用 JSON 或 XML 作为交换媒介（尽管使用 AHAH 和其他格式），并争论如何删除集合。

首先，确定您的资源将是什么，并组织您的 URI 系统以适应它（使用 URL 重写等）。然后确定您要使用的表示。最后，编写后端来处理传递状态表示，并更新数据库。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:58:05.860

我对 CXF 的 jax-rs 没有任何经验，但 Restlet 对我来说效果很好。它允许以直接的方式实现 RESTful 服务和客户端。它在针对 DekiWiki 的 REST 服务接口进行编程时帮助了我很多。有一本 O'Reilly 关于“RESTful Web Service”的书提供了不错的介绍。它也有关于 Restlet 的简短部分。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T14:49:04.633

这是一个开车的答案，但如果你想要一个框架/api来帮助这里有两个选择：

[雷斯特莱特](http://www.restlet.org/documentation/)

[CXF 的 jax-rs](http://cwiki.apache.org/CXF20DOC/jax-rs.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T15:10:57.357

我们还使用带有 JAX-RS 的 Restlet。

如果您要使用 JAX-RS（用于 RESTful Web 服务的 Java API），那么本[文档](http://www.jboss.org/file-access/default/members/resteasy/freezone/docs/1.0.0.GA/userguide/pdf/RESTEasy_Reference_Guide.pdf)可能会很有用（尽管它是在 JBoss RESTEasy 中开发的参考指南）。

我还推荐[REST 测试客户端](http://code.google.com/p/rest-client/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T05:58:09.830

[RESTful Web Services](http://oreilly.com/catalog/9780596529260/)是一本可能对您有所帮助的书。它描述了 RESTful Web 服务背后的动机，并提供了有关如何设计服务的说明。然后，您可以使用框架或仅使用普通 servlet 继续实现。

作为已经提到的实现方法的替代方案，我想添加 Spring MVC。[已经](http://blog.springsource.com/2007/11/14/annotated-web-mvc-controllers-in-spring-25/)可以创建 RESTful 应用程序，但在[Spring 3.0](http://blog.springsource.com/2009/03/08/rest-in-spring-3-mvc/)中将添加更直接的支持

# asp.net-mvc - ASP.Net MVC 中服务器控件的位置在哪里？

> ID：701263
> 
> 赞同：3
> 
> 时间：2009-03-31T14:33:36.043
> 
> 标签：asp.net-mvc, partial-views, custom-server-controls, code-reuse

在 ASP.Net MVC 的光明新世界中，推荐的 ASP.Net 服务器控件替换是什么？

在我看来，ASP.Net 的最佳特性之一是编写服务器控件的能力（尽管不可否认，事件模型处理起来很可怕）。如果这些控件是自填充的，那么它们可以在不同的项目之间共享，而无需大惊小怪——您只需引用服务器控件所在的程序集，然后将其放到 aspx 上。控制完成其余的工作。这非常适合小部件世界并提供有效的代码重用。如何在 MVC 中实现相同的目标？

我对不回发的自我填充控件最​​感兴趣，因为我很欣赏回发模型绝对不适合 MVC。它们仍然可以封装在一个可以在多个不同 MVC Web 项目之间共享的类中吗？或者这是否需要一种完全不同的思维方式，其中控件*不应该*填充自己，并且应该使用局部视图？有没有办法在项目之间共享部分视图？

最后，我可以在 MVC 项目中使用旧的（非回发）服务器控件吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T14:37:26.267

您可以使用 Html 辅助扩展方法模拟非回发控件的行为。就像 Html.TextBox() 等一样，你可以自己编写，如果你愿意，可以将它们封装在自己的项目中。

如果您编写了只输出 HTML 的控件，那么将它们转换为 Html 助手应该不难。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T17:01:29.167

最接近服务器控件的 Asp.Net MVC 是部分请求。在部分请求中，调用 MVC 操作方法，并将其输出附加到当前视图。不幸的是，对此（Html.RenderAction）的官方支持目前在期货程序集中。

如果您无法使用 futures 程序集，一位名叫 Steve Sanderson 的博主写了一篇关于实现类似功能的文章：http:
[//blog.codeville.net/2008/10/14/partial-requests-in-aspnet-mvc /](http://blog.codeville.net/2008/10/14/partial-requests-in-aspnet-mvc/)

# python - 是否有标准的第 3 方 Python 缓存类？

> ID：701264
> 
> 赞同：5
> 
> 时间：2009-03-31T14:33:38.993
> 
> 标签：python, design-patterns

我正在研究一个需要从网络数据库加载数据的客户端类。有人建议向客户端添加标准缓存服务可以提高其性能。

我非常希望不必构建我自己的缓存类——众所周知，这些提供了常见的故障点。使用别人开发的类比花费大量时间调试自制的缓存系统要好得多。

Java 开发人员有这个： [http ://ehcache.sourceforge.net/](http://ehcache.sourceforge.net/)

它是一个通用的高性能缓存类，可以支持各种存储。它有基于时间的到期选项和其他垃圾收集方法。它看起来真的很好。不幸的是，我找不到对 Python 这么好的东西。

那么，有人可以建议一个可供我使用的缓存类吗？我的愿望清单是：

*   能够限制缓存中的对象数量。
*   能够限制缓存中对象的最大年龄。
*   LRU 对象过期
*   能够选择多种存储形式（例如内存、磁盘）
*   调试良好，维护良好，至少被一个知名应用程序使用。
*   很棒的表演。

那么，有什么建议吗？

更新：我正在寻找对象的本地缓存。我连接的服务器已经被大量缓存。Memcached 不合适，因为它需要 Windows 客户端和服务器之间的额外网络流量。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T14:47:58.083

我建议使用[memcached](http://www.danga.com/memcached/)并使用[cmemcache](http://gijsbert.org/cmemcache/)来访问它。您不一定要限制缓存中的对象数量，但您可以设置过期时间并限制它使用的内存量。并且 memcached 被很多大牌使用。事实上，我称之为行业标准。

**更新**：

> 我正在寻找对象的本地缓存。

您可以在本地运行 memcached 并通过 localhost 访问它。我已经做过几次了。

除此之外，我能想到的唯一解决方案是[django 的缓存系统](http://docs.djangoproject.com/en/1.0/topics/cache/)。它提供了几个后端和一些其他配置选项。但如果你不使用 django，那可能有点重量级。

**更新 2：** 我想作为最后的手段，您还可以使用[jython](http://www.jython.org/Project/)并访问 java 缓存系统。如果您已经让客户使用 CPython，这可能有点困难。

**更新 3：** 对你有用可能有点晚了，但我以前的雇主使用[ZODB 来做](http://www.zodb.org/)这种事情。它是一个实际的数据库，但它的读取性能足够快，可以用于缓存。

# asp.net - JQuery 不适用于多视图

> ID：701265
> 
> 赞同：0
> 
> 时间：2009-03-31T14:34:03.093
> 
> 标签：asp.net, jquery

我正在使用更新面板在一个网页中使用 MultiView 服务器控件。在第二个视图中，我有一个 GridView；其第一列是 checkboc 控件，包括标题。

我想根据标题复选框切换数据项复选框。
为此，我编写了一个 Jquery 函数。但主要问题是，当我尝试查看页面源代码时，我无法找到第二个视图的 HTML。

如何使用 Jquery 或 Javascript 切换复选框？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T18:26:14.847

看不到 HTML 源代码的原因是 MultiView 是一个 ASP.NET 服务器控件，它只将当前选定的视图呈现给浏览器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T14:42:57.800

使用萤火虫。切换视图并更新 HTML 后，您将看到当前源代码，以便调试 jQuery。

# sql-server - 如何在 SQL Server 2005 中记录表和字段

> ID：701271
> 
> 赞同：5
> 
> 时间：2009-03-31T14:34:38.693
> 
> 标签：sql-server

在我的 SQL Server 学习过程中，我以某种方式错过了这一点。

我希望能够在我们的 SQL Server 2005 环境中记录表/字段/过程，但我找不到这样做的方法。这可能吗，还是我需要某种第三方应用程序？

这听起来像是一个不费吹灰之力的功能，所以我可能忽略了它。

谢谢！

JH

编辑：特别是，我正在谈论记录 SQL 对象（'此表用于 blah，并由 foo 和 bar 引用。'）。感谢所有的帮助——你们搞定了。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T14:41:47.817

SQL Server 具有可用于此目的的[扩展属性。](http://msdn.microsoft.com/en-us/library/ms190243.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-31T14:37:55.643

最好的文档工具之一是 RedGate 软件称为[SQL Doc](http://www.red-gate.com/products/SQL_Doc/index.htm)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T14:53:32.593

有很多工具——我个人非常喜欢 SQL Doc（由 Red-Gate 编写；之前提到过），但也喜欢 ApexSQL 的[ApexSQL Doc](http://www.apexsql.com/sql_tools_doc.asp)。

但是许多其他工具也将读取和记录数据库模式 - 如果您已经有帮助作者，请检查一下 - 它甚至可能也支持数据库文档！

马克

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T14:54:47.647

使用 stored_procedures、视图和函数，您可以简单地向对象定义添加注释语法，例如：

```
/*
some comment
*/
create view dbo.view sample ... 
```

对于表格和字段，它有点复杂，您可以按照[Chris](https://stackoverflow.com/questions/701271/how-can-i-document-tables-and-fields-in-sql-server-2005/701303#701303)的建议使用[扩展属性](http://msdn.microsoft.com/en-us/library/ms190243.aspx)。您可以通过 Management Studio 访问它，方法是从上下文菜单中选择探索的对象和属性中的表。

如果您有能力投资工具，则可以按照[TheTXI](https://stackoverflow.com/questions/701271/how-can-i-document-tables-and-fields-in-sql-server-2005/701283#701283)的建议选择[SQL Doc](http://www.red-gate.com/products/SQL_Doc/index.htm)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-08-30T04:20:38.557

您应该查看 www.aphilen.com，他们有一个可用的 SQL 文档工具，他们可能会帮助您完成尝试实现的目标，或者如果您有时间使用 sp_help objectname，您可以手动实现这一切

# xml - 何时在 RESTful 资源表示中包含子项？

> ID：701273
> 
> 赞同：8
> 
> 时间：2009-03-31T14:35:36.630
> 
> 标签：xml, rest, structure, nested

RESTful 设计似乎提倡平面或浅层结构化表示（至少当资源表示为 XML 时）。资源表示应该只包含 URI 标识的资源。我想知道何时在父资源中呈现资源的子资源是明智的？

详细地说，考虑一下：公司可能有多名员工。通常这种情况可能会被设计为两个独立的资源，公司和员工，其中员工将是公司的子资源。

```
/company/acme/
/company/acme/employees/
/company/acme/employee/john 
```

使用这种 URI 设计，公司表示应该包括到其员工的链接，但 XML 表示可能不包括员工本身。

因此，什么时候通过父项呈现子项才有意义？是否存在**仅**通过其父项呈现子项的情况。我的意思是根本没有子项目的 URI。只能通过父资源访问它们。

```
<company>
<name>Acme</name>
 <employees>
  <employee>John</employee>
  <employee>Jack</employee>
 </employees>
</company> 
```

只提供一种访问资源的方法是否明智：如果父项公开其子项，是否也可以有子项的显式 URI？那么，如果公司的 XML 包含公司的员工，那么提供 /company/acme/employees URI 是否有意义，尽管您可以通过公司资源获取相同的信息？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-31T14:46:50.693

如果子资源仅在其父资源的上下文中有意义，那么是的，它应该嵌套在其父资源中。例如，在 HTML 中，一个`<li>`元素作为子资源本身是没有意义的。

但是，如果一个资源可以独立存在，并且您想要独立于任何其他资源来操作资源，那么它应该有自己的 URI。这样，您可以 POST 或 PUT 到该资源，而不会影响其他相关资源，也不必将它们复制回服务器。如果您必须从父项中操作所有内容，请考虑如果一个人执行 GET，修改一个子项，然后在更改该子项的情况下对整个事情执行 PUT 会发生什么；如果其他人同时更改了其中一个怎么办？然后你需要添加锁和事务语义，这会破坏 REST 的整个无状态性。

至少对于 GET 请求，拥有某种形式的批量查询接口可能是个好主意，通过该接口，客户端可以一次获取大量资源；必须为每个资源执行新的 HTTP 请求可能需要很长时间，因为这意味着每个 GET 都需要在网络上进行新的往返。拥有批量更新功能可能也很有意义。但是，如果您希望一次能够操作一个资源，则需要为该资源提供一个 URI。

是的，拥有不止一种访问资源的方法是非常好的。你可以把它想象成一个博客；您可以在主页、存档页面或通过其永久链接获取故事。

**编辑**：如果您想进行批量更新而不遇到让一个客户端向服务器提供陈旧数据的问题，您基本上有两种选择：

1.  [**锁定**](http://en.wikipedia.org/wiki/Lock_(computer_science))。一个客户端告诉服务器“我想要锁定整个数据集”，获取它想要修改的数据，修改数据，将其发送回服务器，然后解锁。
2.  [**乐观并发**](http://en.wikipedia.org/wiki/Optimistic_concurrency_control)：客户端下载数据集，该数据集标有某种修订标签，服务器每次获取新数据时都会更改该标签。客户端对其进行修改，并将其发送回服务器。如果同时修改了集合中的任何其他数据，则修订标签将没有数据，服务器将响应“对不起，您的数据已过期，请重试”。

这些各有优缺点。锁定的问题在于它是有状态的，因此不太适合 REST 架构。如果客户端程序在拥有锁时崩溃或以其他方式死亡，那么除非您有某种锁超时，否则该数据将被永久锁定，这可能会变得很棘手。如果客户端正在执行某种涉及多个锁的花哨事务，锁定也可能导致死锁。

乐观并发的问题在于，如果数据集负载很高，并且有很多客户端同时更改它，那么给定客户端可能需要多次尝试才能发布其数据；事实上，一个缓慢的客户端最终可能会完全中断发布更新，因为其他客户端不断地更改数据，这意味着缓慢的客户端更改总是失败。

您需要自己决定哪些选项适合您。这些问题在更改单个资源时也会出现（一个更新可能会破坏另一个），但是当您将资源聚合到一个批量接口中时，它们会更频繁地出现。这就是为什么如果您要聚合资源，我建议您使用两个接口；可以单独访问资源的接口，以及可以一次读取和写入许多资源的可选批量接口。

# oop - 始终处理模型对象还是允许信息位传输？

> ID：701274
> 
> 赞同：1
> 
> 时间：2009-03-31T14:35:47.957
> 
> 标签：oop

关于面向对象构造中信息流的问题，例如从控制器到存储库。

传递的对象应该始终在模型中，还是应该允许较小部分的信息传播？

你会推荐什么？哪些因素决定了方法？

例如像

```
控制器：
    字符串别名 = “阿尔法”；
    bool aliasExists = Repository.CheckIfAliasExists(别名)
存储库：
    bool CheckIfAliasExists(字符串别名);

```

或类似的东西

```
控制器：
    字符串别名 = “阿尔法”；
    成员成员 = Repository.GetMemberByAlias(alias);
    bool aliasExists = member != null;
存储库：
    成员 GetMemberByAlias(字符串别名);

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T14:48:44.120

这是一个相当主观的主题，但我认为这个决定需要归结为两个想法：仅出于确定存在的目的检索整个对象的性能，以及允许对象特定信息达到更大范围的想法。

有些人会争辩说，允许应用程序更多地使用此标识信息会增加您完全绕过对象模型的机会，但在这些情况下，我通常会在性能方面犯错。

我的具体建议是采用前一种方法（尽管也不要使后者无效）。

# c++ - 我正在使用彗星服务器，我希望它与 C++ 交互

> ID：701277
> 
> 赞同：1
> 
> 时间：2009-03-31T14:36:58.267
> 
> 标签：c++, http, rest, comet

我正在为我正在编写的控制远程硬件的应用程序使用[坚持。](http://www.persvr.org)Persevere 是用 Java 编写的，不提供替代 API。

我使用基于 Web 的 GUI 作为控制面板。到现在为止还挺好。

我可以像 dojo 一样使用 REST 通道获取和设置数据，但问题是我真的不知道如何使用 REST 通道。我应该使用哪个库来这样做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-06-01T22:17:59.367

如果你使用 gcc 作为你的工具链，你可以嵌入一个带有 GCJ 的 JVM，以便在你的应用程序中运行 persevere。[GCJ](http://gcc.gnu.org/java/)使用它的[CNI](http://gcc.gnu.org/java/papers/cni/t1.html)接口（比 JNI 容易得多）使得从 Java 调用 C++ 变得很容易。我使用该方法在我们的 C++ 应用程序中使用[Java 脚本。](http://java.sun.com/developer/technicalArticles/J2SE/Desktop/scripting/)您甚至可以将 persevere jar 编译到本机库中，并使用 GCJ 将其链接到您的应用程序。

最好的参考是[GCJ 文档](http://www.gnu.org/software/gcc/java/docs.html)。
还有一个 Linux Journal 包含您可以阅读的文章[Embedded Java with GCJ 。](http://www.linuxjournal.com/article/8757)
您还可以研究[使用 gcj 的应用程序](http://www.gnu.org/software/gcc/java/done.html)。

# wpf - 如何捕获调试时不会发生的异常？

> ID：701291
> 
> 赞同：0
> 
> 时间：2009-03-31T14:39:08.387
> 
> 标签：wpf, visual-studio-2008, debugging

我有一些在后台线程上运行的图像处理代码，并在使用 Dispatcher.BeginInvoke() 完成处理后更新 UI 线程上的图像控件。当我在调试器之外运行我的应用程序时，它经常崩溃。一旦我在调试器中运行它，我根本无法让它发生。显然时间上的差异足以让我现在的生活变得悲惨;-)

我尝试在任何看起来相关的代码周围放置 try/catch 块并记录出现的任何错误，但无济于事 - 它以某种方式不断从我身边溜走，我不知道还能去哪里看。

我对使用调试器的希望是将调试器的异常捕获行为设置为在抛出任何异常时中断，但是由于在调试时我无法让异常发生，所以我无法找出我的代码在哪里抛出。

我可以附加到我崩溃的进程（因为它停留在屏幕上，只是完全没有响应），暂停调试器，并查看每个线程在代码中的位置，但这并没有真正帮助我 - 我不知道实际情况抛出的异常是。

关于如何进行的任何建议？

**编辑：**

1.  我一直在尽可能多的地方使用 System.Diagnostics.Trace.WriteLine() 和 DbgView。我可以追踪异常发生的位置，我无法找出*异常*是什么，这很重要。
2.  我以前使用过 WinDBG+SOS 来追踪内存泄漏，但没有追踪难以发现的异常。任何人都可以建议以这种身份使用 WinDBG+SOS 的资源吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T15:20:09.940

除了少数例外，每个都`BeginInvoke`应该有一个对应的`EndInvoke`对应项（有关更多详细信息，请参见此处，[为什么](http://blogs.msdn.com/cbrumme/archive/2003/05/06/51385.aspx)，一个例外是例如 Control.BeginInvoke）。

丢失`EndInvoke`可能是主线程未捕获异常并且您的应用程序终止的原因。

由于在您的特殊情况下您正在处理`Dispatcher`（未实现`EndInvoke`），您将必须处理[Dispatcher.UnhandledException](http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatcher.unhandledexception(VS.85).aspx)事件以捕获在执行委托期间抛出的任何异常。

顺便说一句，监控`System.Diagnostics.Trace`消息的好工具是Sysinternals 的[DbgView](http://technet.microsoft.com/en-us/sysinternals/bb896647.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T15:04:29.777

当你从未发现它时，你怎么能确定它是一个例外呢？

此外，与其将 try/catch 块放置在各处，不如将它们放置在边界处，尤其是线程边界处。将它们放在任何 ThreadStart 方法或 BeginInvoke 调用的其他代码或回调方法等周围。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-31T15:20:01.190

您可以在应用程序启动时调用的静态 Main 中放置一个 try/catch 吗？因此，当应用程序崩溃时，您可以在某处输出堆栈跟踪和异常信息。

# vb.net - 如何将空白行添加到绑定到列表的中继器 ?

> ID：701294
> 
> 赞同：1
> 
> 时间：2009-03-31T14:39:50.677
> 
> 标签：vb.net, controls, repeater

这可能吗？使用 VB.NET。

我可以在页脚中做吗？那会是最好的方法吗？将页脚绑定到数据表并在其中抛出一些空白行？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T14:42:19.090

我通过在转发器下方动态添加 HTML 来做到这一点，我减去 15 - repeater.items.count 然后迭代并添加行。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-04T11:05:39.687

你可以这样做，或者......你可以查看并将特定的设置为具有“margin-bottom：25px;”。

# sql-server-2000 - 每月前 4 天的 SQL Server 代理作业

> ID：701300
> 
> 赞同：2
> 
> 时间：2009-03-31T14:40:57.210
> 
> 标签：sql-server-2000

我想知道是否有人知道如何在 SQL Server 2000 中创建一个将在每月前 4 天运行的作业？我找到了如何在第一天或第二天运行一次作业，但我认为我可以在四天中的每一天运行的唯一方法是每天创建一个作业，这意味着我将创建 4 个作业。我希望有更好的方法。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T14:46:17.153

您可以创建一个具有 4 个计划的作业，而不是创建 4 个作业。

启动企业管理器，像往常一样创建您的工作，然后在“工作”属性的“计划”选项卡上添加 4 个计划，一个用于您希望该工作运行的月份中的每一天。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:47:37.303

抱歉，我手头没有 SQL 2000，但您能否在创建作业后向作业添加 4x 计划（编辑作业 > 新计划或类似）

抱歉，如果此方法不可用，您可以在 2008 年使用此方法

嘿嘿，正如杰森所说

# ruby - 在没有前缀“Ruby”的情况下启动 Ruby

> ID：701310
> 
> 赞同：12
> 
> 时间：2009-03-31T14:43:17.877
> 
> 标签：ruby, macos, unix, terminal

我在 OS X（使用 bash）和 unix 的新手。我想知道是否可以修改某些文件以运行 ruby​​ 程序，我不需要“ruby file.rb”，而是可以只运行“ruby.rb”。

有理由不这样做吗？

谢谢！

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-31T14:48:51.733

是的，你可以这样做。

假设`ruby.rb`里面有这样的东西：

```
#!/usr/bin/env ruby
puts 'Hello world' 
```

在命令行：`chmod +x ruby.rb`

这使其可执行。

然后你可以像这样执行它：

```
./ruby.rb 
```

有关更多详细信息，请参阅[wikibooks](http://en.wikibooks.org/wiki/Programming:Ruby_Creating_Ruby_programs)。

编辑（Jörg W Mittag）：使用`#!/usr/bin/env ruby`而不是`#!/usr/bin/ruby`作为 shebang 行更便携，因为在过去 20 年生产的每一个 Unix 上，该`env`命令都知道存在于 . `/usr/bin`，而 Ruby 安装通常到处都是。（例如，我住在`/home/joerg/jruby-1.2.0/bin/ruby`.）

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-31T14:54:13.483

正如其他人所提到的，您希望`#!`在开头有一个 shebang ( ) 行，并将权限更改为可执行。

我建议使用`#!/usr/bin/env ruby`而不是直接使用 Ruby 的路径，因为它会使您的脚本更易于移植到可能安装了 Ruby 的不同目录的系统中；`env`将在您的搜索路径中搜索，因此它会找到与您`ruby`在命令行上运行时执行的 Ruby 相同的 Ruby。当然，如果`env`在不同的位置，这会出现问题，但是比 Ruby更常见（它可能在`env`, ,等）`/usr/bin/env``/usr/bin/ruby``/usr/local/bin/ruby``/opt/bin/ruby``/opt/local/bin/ruby`

```
#!/usr/bin/env ruby
puts "Hello!" 
```

并使其可执行：

```
chmod +x file.rb 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-31T14:45:52.253

chmod +x /路径/到/文件

没有理由不这样做，只要在解释器前面加上 shebang（#!/usr/local/ruby 或 OSX 上的任何路径）。壳不在乎。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-31T14:49:01.560

将正确的 shebang 作为文件的第一行。前任：

```
#!/usr/bin/ruby 
```

在shell中，使文件可执行

```
chmod +x file 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-31T14:59:33.640

如果你想在运行这个应用程序时做一些更复杂的事情，你总是可以创建一个 shell 脚本：

```
#! /bin/sh
ruby ruby.rb 
```

如果你把它保存到 run_script，你只需要像前面提到的那样 chmod +x 它，然后执行以下命令：

```
$ ./run_script 
```

我怀疑这在您的特定情况下会比已经提到的解决方案更有用，但为了完整起见，值得注意。

# c++ - 调用临时对象的方法是否安全？

> ID：701313
> 
> 赞同：9
> 
> 时间：2009-03-31T14:43:31.900
> 
> 标签：c++, string, stl, g++

我有一个函数将返回一个 char*。由于我必须连接一些字符串，所以我写了以下行：

```
std::string other_text;
// ...
func(("text" + other_text).c_str()); 
```

我知道我可以避免命名我要使用的字符串的问题。我只是想借此机会提出一个更普遍的问题：调用临时变量的方法是否安全？是否符合标准？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-31T14:45:49.273

调用临时变量的方法是安全的，但返回临时变量的 char* 以供以后使用是不安全的。

这个 char* 指向一个即将被释放的缓冲区。一旦它被释放，您将有一个指向内存中无效区域的指针。

相反，请返回一个 std::string 对象。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-31T14:48:05.337

您可以在临时对象上调用方法，但是您必须注意对象的生命周期——特别是，如果您有一个`c_str()`在临时对象上调用返回的函数`std::string`，则该字符串对象将在函数返回时被销毁。

您上面的代码遇到了这个问题。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-31T14:51:55.470

在临时对象上调用 c_str() 返回的 C 字符串将一直有效，直到下一次在临时对象上调用 c_str() 为止，这永远不会发生。临时变量本身挂在它所属的完整表达式的末尾（return 语句）。

如果您要返回一个 std::string，那么一切都将是 hunkydory，因为字符串的复制构造函数将在返回中被调用以获取副本。如果你返回一个 char *，那么所有的赌注都会被取消，因为你返回的值将在函数退出时被处理掉。这与临时没有任何特别的关系，这是返回 char * 时的普遍问题 - 更喜欢返回 std::strings 。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-31T15:02:45.693

只要临时对象仍然存在，生成的指针就可以使用，通常直到表达式结束。例外情况是在初始化程序中使用临时变量（在这种情况下，它会持续到初始化结束），或者绑定到引用时。函数 return 语句中的临时语句会持续到函数退出（除非绑定到引用）。一旦临时生命周期结束，临时被销毁。在这种情况下，这意味着字符串析构函数运行，因此字符的内存被释放。换句话说，一旦返回值，它就保证无效。

您可以将字符串本身传回，将其作为 const 引用返回。您可以将 .c_str() 复制到新分配的内存，然后将其传回（作为指针或智能指针）。其中任何一个都行得通。

C++ 标准的第 12.2 节介绍了临时对象的生命周期。根据标准，您将返回一个指向已释放内存的指针。

# java - Excel中的数据验证字段

> ID：701314
> 
> 赞同：0
> 
> 时间：2009-03-31T14:43:32.167
> 
> 标签：java

我想知道如何通过java代码在excel表格中创建数据验证字段（列表）...jxl包中有没有可以创建数据验证字段的方法。？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-03T03:20:55.647

查看[WritableCellFeatures](http://jexcelapi.sourceforge.net/resources/javadocs/2_6/docs/jxl/write/WritableCellFeatures.html)的 Java 文档。那里有一些处理验证的方法。

我认为 jxl.write.WritableCellFeatures.setDataValidationList(java.util.Collection c) 是您正在寻找的。如果没有，这应该为您指明正确的方向。

# c# - 如何获得 int (C#) 中的第一个数字？

> ID：701322
> 
> 赞同：87
> 
> 时间：2009-03-31T14:45:05.720
> 
> 标签：c#

在 C# 中，获取 int 中第一个数字的最佳方法是什么？我想出的方法是将int转成字符串，找到字符串的第一个char，然后再转回int。

```
int start = Convert.ToInt32(curr.ToString().Substring(0, 1)); 
```

虽然这可以完成工作，但感觉可能有一个很好的、简单的、基于数学的解决方案来解决这样的问题。字符串操作感觉很笨拙。

**编辑：**不管速度差异如何， mystring[0] 而不是 Substring() 仍然只是字符串操作

* * *

## 回答 #1

> 赞同：229
> 
> 时间：2009-03-31T15:36:40.197

# 基准

首先，您必须确定“最佳”解决方案的含义，当然这要考虑算法的效率、可读性/可维护性以及将来出现错误的可能性。然而，仔细的单元测试通常可以避免这些问题。

我将这些示例中的每一个运行了 1000 万次，结果值是`ElapsedTicks`已通过的数量。

不用多说，从最慢到最快，算法是：

## 转换为字符串，取第一个字符

```
int firstDigit = (int)(Value.ToString()[0]) - 48; 
```

结果：

```
12,552,893 ticks 
```

## 使用对数

```
int firstDigit = (int)(Value / Math.Pow(10, (int)Math.Floor(Math.Log10(Value)))); 
```

结果：

```
9,165,089 ticks 
```

## 循环播放

```
while (number >= 10)
    number /= 10; 
```

结果：

```
6,001,570 ticks 
```

## 条件句

```
int firstdigit;
if (Value < 10)
     firstdigit = Value;
else if (Value < 100)
     firstdigit = Value / 10;
else if (Value < 1000)
     firstdigit = Value / 100;
else if (Value < 10000)
     firstdigit = Value / 1000;
else if (Value < 100000)
     firstdigit = Value / 10000;
else if (Value < 1000000)
     firstdigit = Value / 100000;
else if (Value < 10000000)
     firstdigit = Value / 1000000;
else if (Value < 100000000)
     firstdigit = Value / 10000000;
else if (Value < 1000000000)
     firstdigit = Value / 100000000;
else
     firstdigit = Value / 1000000000; 
```

结果：

```
1,421,659 ticks 
```

## 展开和优化的循环

```
if (i >= 100000000) i /= 100000000;
if (i >= 10000) i /= 10000;
if (i >= 100) i /= 100;
if (i >= 10) i /= 10; 
```

结果：

```
1,399,788 ticks 
```

**笔记：**

每个测试调用`Random.Next()`以获得下一个`int`

* * *

## 回答 #2

> 赞同：128
> 
> 时间：2009-03-31T14:50:26.050

就是这样

```
int i = Math.Abs(386792);
while(i >= 10)
    i /= 10; 
```

并将`i`包含您需要的内容

* * *

## 回答 #3

> 赞同：31
> 
> 时间：2009-03-31T14:49:57.517

试试这个

```
public int GetFirstDigit(int number) {
  if ( number < 10 ) {
    return number;
  }
  return GetFirstDigit ( (number - (number % 10)) / 10);
} 
```

**编辑**

有几个人要求循环版本

```
public static int GetFirstDigitLoop(int number)
{
    while (number >= 10)
    {
        number = (number - (number % 10)) / 10;
    }
    return number;
} 
```

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2009-03-31T14:50:16.270

我能想到的最好的是：

```
int numberOfDigits = Convert.ToInt32(Math.Floor( Math.Log10( value ) ) );

int firstDigit = value / Math.Pow( 10, numberOfDigits ); 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2009-03-31T15:10:04.067

安东答案的变化：

```
 // cut down the number of divisions (assuming i is positive & 32 bits)
if (i >= 100000000) i /= 100000000;
if (i >= 10000) i /= 10000;
if (i >= 100) i /= 100;
if (i >= 10) i /= 10; 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-31T14:48:24.307

```
int myNumber = 8383;
char firstDigit = myNumber.ToString()[0];
// char = '8' 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-03-31T15:07:42.420

和Lennaert有同样的想法

```
int start = number == 0 ? 0 : number / (int) Math.Pow(10,Math.Floor(Math.Log10(Math.Abs(number)))); 
```

这也适用于负数。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-03-31T17:52:06.190

如果您认为 Keltex 的答案很丑，试试这个，它真的很丑，甚至更快。它进行展开的二进制搜索以确定长度。

```
 ... leading code along the same lines
/* i<10000 */
if (i >= 100){
  if (i >= 1000){
    return i/1000;
  }
  else /* i<1000 */{
    return i/100;
  }
}
else /* i<100*/ {
  if (i >= 10){
    return i/10;
  }
  else /* i<10 */{
    return i;
  }
} 
```

PS MartinStettner 也有同样的想法。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2009-03-31T14:51:04.630

```
int temp = i;
while (temp >= 10)
{
    temp /= 10;
} 
```

导致`temp`

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2009-03-31T14:59:42.517

一个明显但缓慢的数学方法是：

```
int firstDigit = (int)(i / Math.Pow(10, (int)Math.Log10(i)))); 
```

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2009-03-31T19:21:15.277

我知道这不是 C#，但令人惊讶的是，在 python 中“获取数字的字符串表示的第一个字符”更快！

*编辑*：不，我犯了一个错误，我忘了再次构造 int，对不起。展开版本是最快的。

```
$ cat first_digit.py
def loop(n):
    while n >= 10:
        n /= 10
    return n

def unrolled(n):
    while n >= 100000000: # yea... unlimited size int supported :)
        n /= 100000000
    if n >= 10000:
        n /= 10000
    if n >= 100:
        n /= 100
    if n >= 10:
        n /= 10
    return n

def string(n):
    return int(str(n)[0])
$ python -mtimeit -s 'from first_digit import loop as test' \
    'for n in xrange(0, 100000000, 1000): test(n)'
10 loops, best of 3: 275 msec per loop
$ python -mtimeit -s 'from first_digit import unrolled as test' \
    'for n in xrange(0, 100000000, 1000): test(n)'
10 loops, best of 3: 149 msec per loop
$ python -mtimeit -s 'from first_digit import string as test' \
    'for n in xrange(0, 100000000, 1000): test(n)'
10 loops, best of 3: 284 msec per loop
$ 
```

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2011-06-01T23:25:43.430

我只是偶然发现了这个老问题，并倾向于提出另一个建议，因为到目前为止，其他答案都没有为***所有***可能的输入值返回正确的结果，并且仍然可以更快：

```
public static int GetFirstDigit( int i )
{
    if( i < 0 && ( i = -i ) < 0 ) return 2;
    return ( i < 100 ) ? ( i < 1 ) ? 0 : ( i < 10 )
            ? i : i / 10 : ( i < 1000000 ) ? ( i < 10000 )
            ? ( i < 1000 ) ? i / 100 : i / 1000 : ( i < 100000 )
            ? i / 10000 : i / 100000 : ( i < 100000000 )
            ? ( i < 10000000 ) ? i / 1000000 : i / 10000000
            : ( i < 1000000000 ) ? i / 100000000 : i / 1000000000;
} 
```

这适用于所有有符号整数值，包括`-2147483648`最小的有符号整数并且没有正对应物。`Math.Abs( -2147483648 )`触发 a`System.OverflowException`并`- -2147483648`计算到`-2147483648`。

该实现可以看作是迄今为止两种最快实现的优点的组合。它使用二分搜索并避免多余的划分。具有 100,000,000 次迭代的循环索引的快速基准测试表明，它的速度是当前最快实现的两倍。

它在**2,829,581 个**刻度后完成。

为了比较，我还测量了当前最快实现的修正变体，它需要**5,664,627 个**滴答声。

```
public static int GetFirstDigitX( int i )
{
    if( i < 0 && ( i = -i ) < 0 ) return 2;
    if( i >= 100000000 ) i /= 100000000;
    if( i >= 10000 ) i /= 10000;
    if( i >= 100 ) i /= 100;
    if( i >= 10 ) i /= 10;
    return i;
} 
```

在我的计算机上进行此测试时，接受的具有相同修正的答案需要**16,561,929 个滴答声。**

```
public static int GetFirstDigitY( int i )
{
    if( i < 0 && ( i = -i ) < 0 ) return 2;
    while( i >= 10 )
        i /= 10;
    return i;
} 
```

像这样的简单函数可以很容易地证明其正确性，因为在当前硬件上迭代所有可能的整数值不会超过几秒钟。这意味着以非常易读的方式实现它们并不那么重要，因为以后根本不需要修复它们内部的错误。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-03-31T14:47:44.137

非常简单（而且可能很快，因为它只涉及比较和一个除法）：

```
if(i<10)
   firstdigit = i;
else if (i<100)
   firstdigit = i/10;
else if (i<1000)
   firstdigit = i/100;
else if (i<10000)
   firstdigit = i/1000;
else if (i<100000)
   firstdigit = i/10000;
else (etc... all the way up to 1000000000) 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-04-22T12:03:01.663

在这里与我的一位同事进行了一些测试，发现大多数解决方案不适用于 0 以下的数字。

```
 public int GetFirstDigit(int number)
    {
        number = Math.Abs(number); <- makes sure you really get the digit!

        if (number < 10)
        {
            return number;
        }
        return GetFirstDigit((number - (number % 10)) / 10);
    } 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2014-06-23T13:24:39.813

使用下面的所有示例来获取此代码：

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Diagnostics;

namespace Benfords
{
    class Program
    {
        static int FirstDigit1(int value)
        {
            return Convert.ToInt32(value.ToString().Substring(0, 1));
        }

        static int FirstDigit2(int value)
        {
            while (value >= 10) value /= 10;
            return value;
        }

        static int FirstDigit3(int value)
        {
            return (int)(value.ToString()[0]) - 48;
        }

        static int FirstDigit4(int value)
        {
            return (int)(value / Math.Pow(10, (int)Math.Floor(Math.Log10(value))));
        }

        static int FirstDigit5(int value)
        {
            if (value < 10) return value;
            if (value < 100) return value / 10;
            if (value < 1000) return value / 100;
            if (value < 10000) return value / 1000;
            if (value < 100000) return value / 10000;
            if (value < 1000000) return value / 100000;
            if (value < 10000000) return value / 1000000;
            if (value < 100000000) return value / 10000000;
            if (value < 1000000000) return value / 100000000;
            return value / 1000000000;
        }

        static int FirstDigit6(int value)
        {
            if (value >= 100000000) value /= 100000000;
            if (value >= 10000) value /= 10000;
            if (value >= 100) value /= 100;
            if (value >= 10) value /= 10;
            return value;
        }

        const int mcTests = 1000000;

        static void Main(string[] args)
        {
            Stopwatch lswWatch = new Stopwatch();
            Random lrRandom = new Random();

            int liCounter;

            lswWatch.Start();
            for (liCounter = 0; liCounter < mcTests; liCounter++)
                FirstDigit1(lrRandom.Next());
            lswWatch.Stop();
            Console.WriteLine("Test {0} = {1} ticks", 1, lswWatch.ElapsedTicks);

            lswWatch.Reset();
            lswWatch.Start();
            for (liCounter = 0; liCounter < mcTests; liCounter++)
                FirstDigit2(lrRandom.Next());
            lswWatch.Stop();
            Console.WriteLine("Test {0} = {1} ticks", 2, lswWatch.ElapsedTicks);

            lswWatch.Reset();
            lswWatch.Start();
            for (liCounter = 0; liCounter < mcTests; liCounter++)
                FirstDigit3(lrRandom.Next());
            lswWatch.Stop();
            Console.WriteLine("Test {0} = {1} ticks", 3, lswWatch.ElapsedTicks);

            lswWatch.Reset();
            lswWatch.Start();
            for (liCounter = 0; liCounter < mcTests; liCounter++)
                FirstDigit4(lrRandom.Next());
            lswWatch.Stop();
            Console.WriteLine("Test {0} = {1} ticks", 4, lswWatch.ElapsedTicks);

            lswWatch.Reset();
            lswWatch.Start();
            for (liCounter = 0; liCounter < mcTests; liCounter++)
                FirstDigit5(lrRandom.Next());
            lswWatch.Stop();
            Console.WriteLine("Test {0} = {1} ticks", 5, lswWatch.ElapsedTicks);

            lswWatch.Reset();
            lswWatch.Start();
            for (liCounter = 0; liCounter < mcTests; liCounter++)
                FirstDigit6(lrRandom.Next());
            lswWatch.Stop();
            Console.WriteLine("Test {0} = {1} ticks", 6, lswWatch.ElapsedTicks);

            Console.ReadLine();
        }
    }
} 
```

我在 AMD Ahtlon 64 X2 Dual Core 4200+ (2.2 GHz) 上得到这些结果：

```
Test 1 = 2352048 ticks
Test 2 = 614550 ticks
Test 3 = 1354784 ticks
Test 4 = 844519 ticks
Test 5 = 150021 ticks
Test 6 = 192303 ticks 
```

但是在 AMD FX 8350 八核 (4.00 GHz) 上获得这些

```
Test 1 = 3917354 ticks
Test 2 = 811727 ticks
Test 3 = 2187388 ticks
Test 4 = 1790292 ticks
Test 5 = 241150 ticks
Test 6 = 227738 ticks 
```

所以方法5或6是否更快取决于CPU，我只能推测这是因为CPU的命令处理器中的分支预测在新处理器上更智能，但我不确定。

我没有任何英特尔 CPU，也许有人可以为我们测试一下？

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2019-04-17T19:40:42.447

也检查一下：

```
int get1digit(Int64 myVal)
{
    string q12 = myVal.ToString()[0].ToString();
    int i = int.Parse(q12);
    return i;
} 
```

如果您想要多个数字也很好：

```
int get3digit(Int64 myVal) //Int64 or whatever numerical data you have
{
    char mg1 = myVal.ToString()[0];
    char mg2 = myVal.ToString()[1];
    char mg3 = myVal.ToString()[2];
    char[] chars = { mg1, mg2, mg3 };
    string q12= new string(chars);
    int i = int.Parse(q12);
    return i;
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-31T14:51:52.067

只是为了给您一个替代方案，您可以重复将整数除以 10，然后在达到零时回滚一个值。由于字符串操作通常很慢，这可能比字符串操作更快，但绝不是优雅的。

像这样的东西：

```
while(curr>=10)
     curr /= 10; 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-31T14:52:13.957

```
while (i > 10)
{
   i = (Int32)Math.Floor((Decimal)i / 10);
}
// i is now the first int 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-31T14:52:41.207

```
start = getFirstDigit(start);   
public int getFirstDigit(final int start){
    int number = Math.abs(start);
    while(number > 10){
        number /= 10;
    }
    return number;
} 
```

或者

```
public int getFirstDigit(final int start){
  return getFirstDigit(Math.abs(start), true);
}
private int getFirstDigit(final int start, final boolean recurse){
  if(start < 10){
    return start;
  }
  return getFirstDigit(start / 10, recurse);
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-03-31T14:55:31.653

```
int start = curr;
while (start >= 10)
  start /= 10; 
```

这比 ToString() 方法更有效，ToString() 方法在内部必须实现类似的循环，并且必须在途中构造（和解析）一个字符串对象......

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-03-31T14:58:21.040

非迭代公式：

```
public static int GetHighestDigit(int num)
{
    if (num <= 0)
       return 0; 

    return (int)((double)num / Math.Pow(10f, Math.Floor(Math.Log10(num))));
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2010-04-24T17:11:09.233

获取最后一位数字的非常简单的方法：

```
int myInt = 1821;

int lastDigit = myInt - ((myInt/10)*10); // 1821 - 1820 = 1 
```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2015-07-12T09:40:54.913

这是我通常做的，请参考我下面的功能：

此函数可以从您可以修改的任何字符串中提取第一次出现的数字，并根据您的使用情况使用此函数

```
 public static int GetFirstNumber(this string strInsput)
    {
        int number = 0;
        string strNumber = "";
        bool bIsContNo = true;
        bool bNoOccued = false;

        try
        {
            var arry = strInsput.ToCharArray(0, strInsput.Length - 1);

            foreach (char item in arry)
            {
                if (char.IsNumber(item))
                {
                    strNumber = strNumber + item.ToString();

                    bIsContNo = true;

                    bNoOccued = true;
                }
                else
                {
                    bIsContNo = false;
                }

                if (bNoOccued && !bIsContNo)
                {
                    break;
                }

            }

            number = Convert.ToInt32(strNumber);

        }
        catch (Exception ex)
        {

            return 0;
        }

        return number;

    } 
```

* * *

## 回答 #24

> 赞同：-1
> 
> 时间：2010-07-01T03:33:05.720

```
int i = 4567789;
int digit1 = int.Parse(i.ToString()[0].ToString()); 
```

* * *

## 回答 #25

> 赞同：-2
> 
> 时间：2009-03-31T14:57:43.677

这是一种不涉及循环的更简单的方法

```
int number = 1234
int firstDigit = Math.Floor(number/(Math.Pow(10, number.ToString().length - 1)) 
```

这将给我们 1234/Math.Pow(10, 4 - 1) = 1234/1000 = 1

# html - 表格单元格和边框在 IE/Chrome 和 Firefox/Opera 中显示不同

> ID：701332
> 
> 赞同：6
> 
> 时间：2009-03-31T14:47:03.623
> 
> 标签：html, css, html-table, border

经过几个小时的挫折，我终于转向互联网寻求答案。想象一下这段极其简单的代码：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
    <head>
        <title>AARRRRRRGH</title>
    </head>
    <body>
        <table>
            <tr>
                <td style="width: 100px; height: 100px; background: #000000; padding: 0px; border: 6px solid #FF0000;"></td>
            </tr>
        </table>
    </body>
</html> 
```

现在这看起来很简单，创建一个 100 像素宽和 100 像素高的表格单元格，边框为 6 像素。尽管看起来很简单，但它在不同的浏览器中看起来不同。在 IE8 和 google chrome 中，表格单元格为 112 x 112 像素（因此内部为 100 像素，外部为 6 像素）。在 Firefox 3 和 Opera 中，表格是 112 x 100 像素（因此由于某种原因，边框被添加到表格宽度而不是表格高度）。

说真的，什么给了？以及如何使每个浏览器上的渲染相同（在这种情况下，我不能使用 div 我需要使用表格）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-31T18:31:51.617

> 说真的，什么给了？

是的...表格单元格高度和垂直边框在 CSS 2.1 规范中的定义非常不明确。没有什么可以完全解释它们是如何交互的，标准块模型也没有完全涵盖它。第 17.6.1 节中的图明确地演示了宽度的定义，但并未涵盖高度。

FWIW 我认为 Mozilla/Opera 的解释没有任何意义，但我不能说它是彻头彻尾的错误。

> 如何使每个浏览器上的渲染都相同（在这种情况下，我不能使用 div 我需要使用表格）。

表格内的 div 怎么样？

```
<td style="width: 100px; background: black; padding: 0; border: 6px solid red;">
    <div style="height: 100px;">...</div>
</td> 
```

现在很清楚“100px”指的是哪个测量值。这对我有用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T15:00:54.900

您是否尝试过其他 DOCTYPES？我很幸运：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T16:15:53.987

我把它弄乱了一点，有几件事放在一起，使它们在 IE7 和 Firefox 2 中对我来说看起来一样。我必须做的两件事是：

a) 添加`display:block`；表格单元格的样式（使 Firefox 以与 IE 相同的方式呈现单元格高度）；

b) 为单元格添加了一个不间断的空格（否则 IE 不显示边框）。

我没有加载 IE8 或 Firefox 3，但你可以试一试。不确定将显示更改为阻止是否有任何副作用，但它确实解决了问题。

# iframe - 调整 iframe 大小以适应其内容

> ID：701339
> 
> 赞同：7
> 
> 时间：2009-03-31T14:47:40.877
> 
> 标签：iframe, resize

> **可能重复：**
> [根据内容调整 iframe 的大小](https://stackoverflow.com/questions/153152/resizing-an-iframe-based-on-content)

我有一个 iframe，其中 src 是一个 HTML 文件，这个 iframe 放在用户控件中：

```
<iframe frameborder="0" src="CName.htm" align="left" width="730" height="1100" ></iframe> 
```

我需要 iframe 根据内容调整大小，以便根据 HTML 文件的高度设置它的高度，我不需要使用滚动属性。你有什么主意吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2011-01-03T14:03:22.900

我使用以下 jQuery 代码来执行此操作：

```
$('#iframe_id').load(function () {
    $(this).height($(this).contents().height());
    $(this).width($(this).contents().width());
}); 
```

不过，如果 iframe 内容是跨域的，我认为这不会起作用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T14:53:06.543

您可以计算出框架内内容的高度和宽度，然后调用框架所有者上的函数来设置 iframe 元素的高度和宽度。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-06-03T15:31:23.780

有一种方法！它在 jquery 中，它太简单了。有点哈克..

```
$('iframe').contents().find('body').css({"min-height": "100", "overflow" : "hidden"});
setInterval( "$('iframe').height($('iframe').contents().find('body').height() + 20)", 1 ); 
```

给你！

干杯! :)

# c# - 创建新线程或获得更多线程工作

> ID：701353
> 
> 赞同：0
> 
> 时间：2009-03-31T14:50:19.590
> 
> 标签：c#, multithreading, context-switch

我有一个正在创建的程序（在 C# 中），我看到了两种方法..

1) 等待任意数量的 X 线程完成的作业管理器，完成后它会获得下一个工作块并创建一个新线程并将该块交给它

或者

2）我们创建X个线程来启动，给它们每个工作块，当一个线程完成一个块时，它会要求作业管理器做更多的工作。如果没有更多的工作，它会睡觉，然后再次询问，睡眠时间会越来越长。

该程序将运行并完成，但我可以看到它变成了一项不断寻找更多工作的服务。

每个块将包含许多数据 id，调用数据库以获取一些信息或对数据 id 执行操作，然后将数据 id 上的信息写入数据库。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T14:54:23.467

假设您知道在处理多线程数据库操作时需要采取的额外预防措施，听起来您正在描述两种不同的场景。首先，你有几个线程在运行，一旦它们全部完成，它就会寻找新的工作。在第二种情况下，您有几个线程正在运行，并且它们的操作是完全并行的。您的环境将决定采取的正确方法；如果在几个线程中的所有工作都捆绑在一起，而在所有线程完成之前无法继续进行其他工作，则使用前者。如果它们对彼此没有太大影响，请选择后者。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:56:49.497

第二个选项并不正确，因为使睡眠时间逐渐变长意味着您将不必要地保持这些线程被阻塞。

相反，您应该像第二个选项一样拥有一组线程池，但它们使用 WaitHandles 来等待工作并使用生产者/消费者模式。基本上，当生产者指示有工作时，它会向消费者发送一个信号（将有一个管理器来确定哪个线程将获得工作，然后向该线程发出信号），消费者将唤醒并开始工作。

您可能想查看并行任务库。它现在处于测试阶段，但如果你可以使用它并且对它感到满意，我会推荐它，因为它会为你管理很多事情（而且更好，考虑到机器上的核心数量，最佳线程数等）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T14:57:15.457

如果工作单元足够大，前一种解决方案（为每个新工作生成一个线程）更容易编码，而且还不错。

第二种解决方案（线程池，带有工作队列），代码更复杂，但支持更小的工作单元。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-31T14:55:44.650

您应该查看`ThreadPool`.NET 框架中的类，而不是滚动您自己的解决方案。您可以使用该[`QueueUserWorkItem`](http://msdn.microsoft.com/en-us/library/kbf0f1ct.aspx)方法。它应该完全符合您的要求。

# asp.net - ASP.NET 网站安装/更新

> ID：701354
> 
> 赞同：3
> 
> 时间：2009-03-31T14:50:22.227
> 
> 标签：asp.net

我正在寻找一些关于如何为我的 ASP.NET 网站提供安装包的想法。我需要做的一些事情是读/写注册表项，获取数据库信息并测试连接，我必须能够在不卸载的情况下覆盖现有网站并在新版本上更新 Web 配置。我不想卸载该网站并重新安装它。我希望升级时的停机时间最短。我想我将不得不实现一个自定义解决方案，如果这是真的，我如何将我的 Web 应用程序的所有输出包含到我的自定义解决方案中？

编辑：我没有在我自己的系统上安装它。这是为了分发给将安装/升级网站的其他客户。重要的是我能够在不卸载的情况下升级到最新的 asp.net 网站。理想情况下，它会覆盖现有站点并更新 web.config 文件。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T14:56:38.187

## 选项 1\. 创建 Web 应用程序安装包

使用**Web 安装项目**创建 Web 应用程序安装包 (.msi)

在 MSDN[创建或添加安装项目](http://msdn.microsoft.com/en-us/library/19x10e5c(VS.71).aspx)

如果应用程序已经安装在他或她的机器上，您可以创建您的安装，它将为用户提供应用程序的**升级选项。**这不是问题。

**Web Setup Project 的替代方案**（它们都可以处理升级方案）：

*   [智慧安装工作室](http://www.wise.com/Products/Installations/WiseInstallationStudio.aspx)
*   [安装盾牌](http://www.acresso.com/products/is/installshield-overview.htm)
*   [Nullsoft Scriptable Install System](http://nsis.sourceforge.net/) - 这个是免费和开源的

## Optoin 2\. 在服务器上部署 Web 应用程序

您可以使用**[NAnt](http://nant.sourceforge.net/)**或**[MSBuild](http://msdn.microsoft.com/en-us/library/wea2sca5.aspx)**或**[IIS Web 部署工具](http://www.iis.net/extensions/WebDeploymentTool)**来实现这些任务的自动化。

例如，使用 MSBuild 的 NAnt，您可以指定如下任务：

*   从源存储库获取项目文件
*   如果需要，更新 .config 文件和其他一些文件
*   编译你的网络应用程序
*   更新服务器上的注册表设置
*   更新服务器上的数据库架构
*   在构建文件夹与 IIS Web 文件夹之间同步文件（x-copy）

[网络部署博客](http://blogs.iis.net/msdeploy/)

## 选项 3\. 通过 Web Plafrom 安装程序分发您的 Web 应用程序。

[http://www.microsoft.com/web/](http://www.microsoft.com/web/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:58:42.690

您是否研究过[Web 部署项目](http://www.microsoft.com/downloads/details.aspx?FamilyId=0AA30AE8-C73B-4BDD-BB1B-FE697256C459&displaylang=en)或[IIS Web 部署工具](http://learn.iis.net/page.aspx/346/web-deployment-tool)？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T14:54:04.620

我认为您可以将 asp.net 应用程序构建到 .msi 包中并安装它。那是你要找的吗？然后，您可以将所有自定义构建到部署前和部署后脚本中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T14:55:56.443

我将 NAnt 和 NSIS 与一些小型控制台应用程序一起使用，它们无法轻松完成我需要的一些操作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T15:07:15.947

您是否尝试过新的[Microsoft Web 平台安装程序（新！2.0 beta）](http://weblogs.asp.net/scottgu/archive/2009/06/02/microsoft-web-platform-installer.aspx)？

![Microsoft Web 平台安装程序](https://scottguimages.s3.amazonaws.com/webpi2.PNG)

# sql-server - 具有大量表的 SQL Server 数据库

> ID：701359
> 
> 赞同：2
> 
> 时间：2009-03-31T14:51:04.003
> 
> 标签：sql-server, sql-server-2005, performance

我被要求解决 SQL Server 2005 数据库中的性能问题。

挑战不是海量数据，而是海量表。单个数据库中有 30,000 多个表。总数据大小约为 650 GB。

我无法控制创建所有这些表的应用程序。该应用程序在拥有 10-15 个部门的大公司中每个“部门”使用大约 2,500 个表。

您甚至如何开始检查性能问题？您在 VLDB (Very Large DB) 上找到的所有文章都是关于数据量的，而不是表的数量。

有任何想法吗？指针？提示？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-31T14:54:30.860

像任何其他类型的性能调整一样开始。除其他事项外，您不应假设大量表会构成性能问题。这可能是一个红鲱鱼。

相反，问用户“什么是慢的”？即使您测量了性能（也许使用 Profiler），您的数字也可能与感知的性能问题不匹配。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-31T15:09:52.947

正如其他人所指出的那样，表的数量可能表明设计不佳，但它远非扣篮，它是性能问题的根源。

对于任何性能优化，我能给您的最佳建议是*停止猜测问题的根源并去寻找它*。最重要的是，*在确定问题的根源之前不要开始优化*。

我首先在数据库上**运行一些跟踪**并确定性能不佳的查询。这也将告诉您应用程序最常使用哪些表。这些表中的大量很可能是： A) 剩余的临时表；B) 不再使用；或 C) 有人没有清理的工作台。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T01:05:22.170

将糟糕的数据库设计放在一边，如果没有用户报告响应时间缓慢，那么您*目前*没有性能问题。

如果您确实有性能问题：

1）检查碎片（`dbcc showcontig`）

2) 检查硬件规格、RAID/驱动器/文件位置。检查 SQL 服务器错误日志。如果硬件似乎未指定或设计不佳，请运行性能计数器（请参阅 PAL 工具）

3）在正常查询工作负载期间收集跟踪数据并识别昂贵的查询（请参阅此 SO 答案：[我如何记录和查找最昂贵的查询？](https://stackoverflow.com/questions/257906/ms-sql-server-2008-how-can-i-log-and-find-the-most-expensive-queries)）

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-31T15:09:40.340

软件是否创建了所有这些表？如果是这样，也许相同的错误会一遍又一遍地重复。所有表都有主键吗？它们都有聚集索引吗？是否存在所有必要的非聚集索引（那些用于过滤和连接的列）等等等等。

升级 SQL Server 2008 是一种选择吗？如果是这样，您可以利用新的[基于策略的管理](http://msdn.microsoft.com/en-us/library/bb510667.aspx)功能来为大量表实施最佳实践。

现在开始调优，我会使用分析器来查找那些持续时间最长的语句，然后看看你可以做些什么来改进它们（添加索引通常是最简单的方法）。

# json - JSON 发布，我将 JSON 推得太远了吗？

> ID：701362
> 
> 赞同：2
> 
> 时间：2009-03-31T14:51:40.290
> 
> 标签：json

我只是想知道我是否将 JSON 推得太远了？如果有人以前打过这个？

我有一个 xml 文件：

```
<?xml version="1.0" encoding="UTF-8"?>
<customermodel:Customer xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:customermodel="http://customermodel" xmlns:personal="http://customermodel/personal" id="1" age="1" name="Joe">
<bankAccounts xsi:type="customermodel:BankAccount" accountNo="10" bankName="HSBC" testBoolean="true" testDate="2006-10-23" testDateTime="2006-10-23T22:15:01+08:00" testDecimal="20.2" testTime="22:15:01+08:00">
    <count>0</count>
    <bankAddressLine>HSBC</bankAddressLine>
    <bankAddressLine>London</bankAddressLine>
    <bankAddressLine>31 florence</bankAddressLine>
    <bankAddressLine>Swindon</bankAddressLine>
  </bankAccounts>
</customermodel:Customer> 
```

其中包含元素和属性....

当我转换为 JSON 时，它给了我：

```
{"customermodel:Customer":{"id":"1","name":"Joe","age":"1","xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","bankAccounts":{"testDate":"2006-10-23","testDecimal":"20.2","count":"0","testDateTime":"2006-10-23T22:15:01+08:00","bankAddressLine":["HSBC","London","31 florence","Swindon"],"testBoolean":"true","bankName":"HSBC","accountNo":"10","xsi:type":"customermodel:BankAccount","testTime":"22:15:01+08:00"},"xmlns:personal":"http://customermodel/personal","xmlns:customermodel":"http://customermodel"}} 
```

所以然后我把这个也发送给客户端..它转换为 js 对象（或其他）编辑一些值（元素），然后将其发送回服务器。

所以我得到了 JSON 字符串，并将其转换回 XML：

```
<customermodel:Customer>
    <id>1</id>
    <age>1</age>
    <name>Joe</name>
    <xmlns:xsi>http://www.w3.org/2001/XMLSchema-instance</xmlns:xsi>
    <bankAccounts>
        <testDate>2006-10-23</testDate>
        <testDecimal>20.2</testDecimal>
        <testDateTime>2006-10-23T22:15:01+08:00</testDateTime>
        <count>0</count>
        <bankAddressLine>HSBC</bankAddressLine>
        <bankAddressLine>London</bankAddressLine>
        <bankAddressLine>31 florence</bankAddressLine>
        <bankAddressLine>Swindon</bankAddressLine>
        <accountNo>10</accountNo>
        <bankName>HSBC</bankName>
        <testBoolean>true</testBoolean>
        <xsi:type>customermodel:BankAccount</xsi:type>
        <testTime>22:15:01+08:00</testTime>
    </bankAccounts>
    <xmlns:personal>http://customermodel/personal</xmlns:personal>
    <xmlns:customermodel>http://customermodel</xmlns:customermodel>
</customermodel:Customer> 
```

还有一个问题，似乎不知道元素/属性之间的区别，所以我不能检查 XSD 来检查这现在是否有效？

有针对这个的解决方法吗？

我不能成为第一个遇到这个问题的人吗？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-31T15:02:30.217

JSON 作为 XML 编码没有意义，不。如果您想使用和操作 XML，那么就使用和操作 XML。

JSON 适用于当您需要更轻量、更易于解析、更易于编写和阅读的内容时。它有一个相当简单的结构，既不比 XML 好也不差，只是不同而已。它有列表、关联、字符串和数字，而 XML 有嵌套的元素、属性和实体。虽然您可以精确地对彼此进行编码，但您必须问自己为什么要这样做；如果你想要 JSON 使用 JSON，如果你想要 XML 使用 XML。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T14:56:16.427

我不会在 json 字符串中编码 xml 模式信息——这似乎有点倒退。如果您要向他们发送 JSON，他们不应该有任何暗示这不是 JSON。额外的 xml 会混淆并让您的界面看起来“漏水”。

您甚至可以考虑只使用 xml 并避免额外的抽象层。当您知道至少有一方实际上在使用 javascript 时，JSON 最有意义。如果不是这种情况，它仍然可以像任何其他传输格式一样工作。但是，如果您已经有一个 xml 表示形式，那就有点过分了。

另一方面，*如果*您的客户真的在使用 javascript，这将使他们更容易使用数据。唯一关心的是回程，一旦它在 JSON 中，您更信任谁来正确地转换回 xml？您可能更有资格这样做，因为它是*您的*架构。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-04-03T06:07:56.470

[JsonML](http://jsonml.org/)从 XML<->JSON 提供了一个经过深思熟虑的标准映射。如果您使用它，您将获得您在客户端上寻找的易于操作的好处，而不会损失元素/属性的保真度。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T15:00:11.050

为此，您需要在您的序列化/反序列化方法中构建额外的逻辑/数据 - 可能创建诸如“属性”和“数据”之类的东西来保存不同的部分：

```
{"customermodel:Customer":
 { 
   "attributes": {"xmlns:xsi":"...", "xmlns:customermodel":"..."},
   "data":
   {
     "bankAccounts":
     {
       "attributes": { ... }
       "data" : 
       {
         "count":0,
         "bankAddressLine":"..."
       }
     }
   }
 } 
```

# c# - 字符串比较、.NET 和非中断空间

> ID：701369
> 
> 赞同：17
> 
> 时间：2009-03-31T14:53:20.940
> 
> 标签：c#, string, character-encoding

我有一个用 C# 编写的应用程序，它可以进行很多字符串比较。这些字符串是从各种来源（包括用户输入）中提取出来的，然后进行比较。但是，在将空间“32”与非破坏空间“160”进行比较时，我遇到了问题。对于用户来说，它们看起来相同，因此他们期望匹配。但是当应用程序进行比较时，没有匹配项。

解决此问题的最佳方法是什么？我是否将不得不去执行字符串比较并手动将不间断空格标准化为空格的所有代码部分？.NET 是否提供任何帮助？（我已经尝试了所有比较选项，但似乎没有任何帮助。）

有人建议我在收到时对字符串进行规范化，然后让字符串比较方法简单地比较规范化的字符串。我不确定这样做是否直接，因为首先什么是标准化字符串。我也要把它标准化什么？当然，现在我可以将非中断空间转换为中断空间。但是还能出现什么？这些规则可能有很多吗？他们甚至可能会发生冲突。（在一种情况下我想使用规则，而在另一种情况下我不想。）

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-06-22T19:27:05.213

我经历了很多痛苦才能找到这个简单的答案。下面的代码使用正则表达式将非中断空格替换为普通空格。

```
string cellText = "String with non breaking spaces.";
cellText = Regex.Replace(cellText, @"\u00A0", " "); 
```

希望这会有所帮助，丹

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2018-03-14T06:27:50.163

它需要是

```
text.Replace('\u00A0',' ') 
```

`\u00A0`非破坏空间在哪里

这将用普通空间替换非破坏空间。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-03-31T14:57:49.933

如果是我，我会在“拉入”时将琴弦“标准化”；可能带有 string.Replace()。然后，您无需在其他任何地方更改您的比较。

**编辑**：马克，这是一个艰难的。至于什么是“规范化”字符串，这完全取决于您或您的客户。我遇到过类似的情况，客户要求这样的字符串：

```
我有 4 个苹果。
我有四个苹果。

```

实际上是平等的。对于不同的情况，您可能需要单独的规范器。无论哪种方式，我仍然会在检索原始字符串时进行规范化。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2016-08-22T15:42:11.063

我建议创建自己的字符串比较器来扩展原始比较器之一——在那里进行“规范化”（用常规空间替换不间断空间）。除了实例方法之外，还有一个带有比较器`Equals`的静态方法。`String.Equals`

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2018-01-12T14:34:41.747

没有正则表达式也是如此，主要是在我以后需要它时为我自己：

`text.Replace('\u00A0', ' ')`

# asp.net - 使用 ASP.Net 的 Facebook 墙功能

> ID：701387
> 
> 赞同：3
> 
> 时间：2009-03-31T14:56:10.327
> 
> 标签：asp.net, sql, blogs, facebook-wall

我想在我的社交网站上创建类似于 facebook 墙的东西。我想将帖子存储在 sql 数据库中，这应该很简单。我正在寻找的是显示帖子的好方法？我想我什至不知道从哪里开始，因为我只能想到使用循环来显示`asp:textboxes`. 这显然是不正确的。

我希望页面上显示多个帖子，其中应包括：

*   发帖的用户，
*   发布的文字，
*   发布日期，
*   如果我想发疯……删除/编辑帖子的方法。

我真的不知道如何实现这个概念，所以任何想法都会有很大帮助。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T15:00:55.870

要开始使用，请查看[asp.net](http://www.asp.net/)上关于[Repeater 控件](http://www.asp.net/learn/data-access/tutorial-01-cs.aspx)的这篇文章，或者[这篇很棒的文章。](http://www.beansoftware.com/ASP.NET-Tutorials/Repeater-Control.aspx)

Repeater 控件让您可以将数据绑定到对象列表，然后为该对象的显示方式定义一个模板。然后，ASP.NET 将根据需要处理多次显示它。您可以编写用于处理删除和编辑的代码隐藏，就好像页面上只有一个实例一样。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T15:00:44.277

继续使用 jquery，使用大量的 ajax。对于标记，使用带有所有干净 html 标记的中继器控件（而不是服务器端控件，这会生成大量不必要的标记，从而快速产生性能问题）

仅在初始加载时填充 x 个项目，然后根据用户操作根据需要使用 jquery 提取数据。您可以通过 json 提供此数据，使用 jquery 在客户端解码 json 并执行一个循环，将此 json 转换为适当的 html 并将其注入正确的 html 元素

应该很简单;-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T14:59:05.437

ASP.NET 为您提供了很多方法来做到这一点。A [Repeater](http://msdn.microsoft.com/en-us/library/c012haty(vs.71).aspx)， DataGrid ，[GridView](http://msdn.microsoft.com/en-us/library/c012haty(vs.71).aspx)是第一个想到的。如果您更愿意使用 ASP.NET MVC，那么总是有很好的旧`foreach`循环。

此外，也请查看[ListView](http://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)。

# c++ - VS2008 中的断言，但 VS2005 中没有

> ID：701390
> 
> 赞同：1
> 
> 时间：2009-03-31T14:56:28.187
> 
> 标签：c++, visual-studio, mfc, assertions

从 VS2005 切换到 VS2008 SP1 后，我发现了一个我无法解释的问题。
一个程序在 VS2005 下在发布和调试模式下都能正常工作。在 VS2008 下，当进入调试器时，会引发一个断言。
如果我让程序运行（在调试或发布模式下），则根本没有断言。

我花了将近两天的时间，我不明白我做错了什么。

**程序描述：** 我有一个基于 MFC 对话框的程序，它创建一个用户线程 (CWinThread)，该线程创建应用程序的主对话框。
工作线程无限循环并每秒向对话框发布一条消息。消息在 gui 线程中处理。

**我的代码的某些部分：**

gui线程的InitInstance：

```
BOOL CGraphicalThread::InitInstance()
{
    CGUIThreadDlg* pDlg = new CGUIThreadDlg();
    pDlg->Create(CGUIThreadDlg::IDD);
    m_pMainWnd = pDlg;
    AfxGetApp()->m_pMainWnd = pDlg;
    return TRUE;
} 
```

工作线程：

```
UINT ThreadProc(LPVOID pVoid)
{
    do
    {
        AfxGetApp()->m_pMainWnd->PostMessage(WM_APP+1, (WPARAM)new CString("Hello"), NULL);
        Sleep(1000);
    }
    while(!bStopThread);

    return 0;
} 
```

对话消息处理程序是这样的：

```
LRESULT CGUIThreadDlg::OnMsg(WPARAM wp, LPARAM lp)
{
    CListBox* pList = (CListBox*)GetDlgItem(IDC_LIST1);
    CString* ps = (CString*)wp;
    pList->InsertString(-1, *ps);
    delete ps;
    return 1L;
} 
```

这与 VS2005 完美配合。但是使用VS2008，但只要下一个断点并进入调试模式，我就会提出一个断言？？？
wincore.cpp 第 906 行

```
CObject* p=NULL;
if(pMap)
{
      ASSERT( (p = pMap->LookupPermanent(m_hWnd)) != NULL ||
              (p = pMap->LookupTemporary(m_hWnd)) != NULL);
}
ASSERT((CWnd*)p == this);   // must be us
// Note: if either of the above asserts fire and you are
// writing a multithreaded application, it is likely that
// you have passed a C++ object from one thread to another
// and have used that object in a way that was not intended.
// (only simple inline wrapper functions should be used)
//
// In general, CWnd objects should be passed by HWND from
// one thread to another.  The receiving thread can wrap
// the HWND with a CWnd object by using CWnd::FromHandle.
//
// It is dangerous to pass C++ objects from one thread to
// another, unless the objects are designed to be used in
// such a manner. 
```

如果我删除 GUI 线程并将对话框创建到 CWinApp 线程中，则问题不再发生。

有人知道吗？
难道我做错了什么？

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T15:15:25.133

```
// Note: if either of the above asserts fire and you are
// writing a multithreaded application, it is likely that
// you have passed a C++ object from one thread to another
// and have used that object in a way that was not intended.
// (only simple inline wrapper functions should be used)
//
// In general, CWnd objects should be passed by HWND from
// one thread to another.  The receiving thread can wrap
// the HWND with a CWnd object by using CWnd::FromHandle.
//
// It is dangerous to pass C++ objects from one thread to
// another, unless the objects are designed to be used in
// such a manner. 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T08:34:12.967

@Ismael：我已经尝试过断言仍然被解雇。我发现删除断言的唯一方法是在 CWinApp 线程中创建对话框。但这并不能解释会发生什么，因为仍然有工作线程每秒发布到对话框。总之感谢。

@daanish.rumani：我检查了 wincore.cpp 和 CWnd::AssertValid() 完全相同（但其余文件有很多差异）。

我会接受一段代码适用于 VS2005 而不是 VS2008，但是

1.  我看不出我做错了什么。如果我做错了什么，正确的方法是什么？
2.  为什么只有在遇到断点并且我跳过 Sleep 调用时才会触发断言？我可以很好地运行程序，即使它在调试模式下编译，只要我不进入调试器。这可能是调试器中的错误吗？

# authentication - SSL 和客户端证书

> ID：701394
> 
> 赞同：3
> 
> 时间：2009-03-31T14:57:14.880
> 
> 标签：authentication, ssl, digital-certificate

一个独立于我自己的内部团队表示，他们更喜欢基于客户端证书进行传入身份验证。这对我来说听起来不错，除了我以前没有搞砸过它们并且不太确定从哪里开始研究（维基百科直接进入了很多细节，我不确定是否与我需要找出的内容相关）。如果我有一个带有在 AD 用户帐户下运行的 Web 应用程序的 IIS6 服务器，我应该采取哪些步骤来最终通过 .NET 触发从该 Web 应用程序到远程服务器的请求（我猜是 HttpWebRequest）？我确实看到我们有一个内部受信任的证书颁发机构等等。远程服务器在 Linux 机器上运行 Apache。

我基本上处于学习模式，不一定要寻找需要发生的事情的详细清单（尽管如果我可以在学习如何做的同时了解它是如何工作的，那也很好:) .. .**你有什么我可以开始研究的资源，以便弄清楚如何通过 SSL 与这个远程服务器安全地进行身份验证并通过客户端证书与它通信？**可能从创建客户端证书开始，尽管我想更全面地了解它首先是如何工作的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2011-01-19T05:45:41.163

这是一个链接 - [http://support.microsoft.com/kb/315588](http://support.microsoft.com/kb/315588)。希望这对您正在寻找的内容有所帮助。

# python - 从目录中选择随机文件的最佳方法

> ID：701402
> 
> 赞同：52
> 
> 时间：2009-03-31T14:58:41.273
> 
> 标签：python, file, random

从 Python 目录中选择随机文件的最佳方法是什么？

*编辑：*这是我正在做的事情：

```
import os
import random
import dircache

dir = 'some/directory'
filename = random.choice(dircache.listdir(dir))
path = os.path.join(dir, filename) 
```

这是特别糟糕，还是有特别好的方法？

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2009-03-31T15:02:21.887

```
import os, random
random.choice(os.listdir("C:\\")) #change dir name to whatever 
```

* * *

关于您编辑的问题：首先，我假设您知道使用 a 的风险`dircache`，以及它[自 2.6 以来已被弃用并在 3.0 中删除](http://docs.python.org/library/dircache.html)的事实。

其次，我看不到这里存在任何竞争条件。您的`dircache`对象基本上是不可变的（目录列表被缓存后，它不再被读取），因此从它的并发读取中没有害处。

除此之外，我不明白为什么您认为此解决方案有任何问题。没事。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-31T15:10:40.587

如果你想包含目录，Yuval A 的回答。除此以外：

```
import os, random

random.choice([x for x in os.listdir("C:\\") if os.path.isfile(os.path.join("C:\\", x))]) 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2017-01-28T16:10:51.170

给出的大多数解决方案的问题是将所有输入加载到内存中，这可能成为大型输入/层次结构的问题。这是一个改编自Tom Christiansen 和 Nat Torkington[的 Perl Cookbook的解决方案。](http://docstore.mik.ua/orelly/perl/cookbook/ch08_07.htm)要在目录下的任意位置获取随机文件：

```
#! /usr/bin/env python
import os, random
n=0
random.seed();
for root, dirs, files in os.walk('/tmp/foo'):
  for name in files:
    n += 1
    if random.uniform(0, n) < 1:
        rfile=os.path.join(root, name)
print rfile 
```

概括一下就可以得到一个方便的脚本：

```
$ cat /tmp/randy.py
#! /usr/bin/env python
import sys, random
random.seed()
n = 1
for line in sys.stdin:
  if random.uniform(0, n) < 1:
      rline=line
  n += 1
sys.stdout.write(rline)

$ /tmp/randy.py < /usr/share/dict/words 
chrysochlore

$ find /tmp/foo -type f | /tmp/randy.py
/tmp/foo/bar 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2018-10-01T07:22:37.227

最简单的解决方案是使用**os.listdir**和**random.choice**方法

```
random_file=random.choice(os.listdir("Folder_Destination")) 
```

* * *

让我们一步一步来看看它：-

> 1} **os.listdir**方法返回包含指定路径中条目（文件）名称的列表。
> 
> 2} 然后将该列表作为参数传递给**random.choice**方法，该方法从列表中返回一个随机文件名。
> 
> 3} 文件名存储在**random_file**变量中。

* * *

***考虑实时应用***

*这是一个示例 python 代码，它将随机文件从一个目录移动到另一个目录*

```
import os, random, shutil

#Prompting user to enter number of files to select randomly along with directory
source=input("Enter the Source Directory : ")
dest=input("Enter the Destination Directory : ")
no_of_files=int(input("Enter The Number of Files To Select : "))

print("%"*25+"{ Details Of Transfer }"+"%"*25)
print("\n\nList of Files Moved to %s :-"%(dest))

#Using for loop to randomly choose multiple files
for i in range(no_of_files):
    #Variable random_file stores the name of the random file chosen
    random_file=random.choice(os.listdir(source))
    print("%d} %s"%(i+1,random_file))
    source_file="%s\%s"%(source,random_file)
    dest_file=dest
    #"shutil.move" function moves file from one directory to another
    shutil.move(source_file,dest_file)

print("\n\n"+"$"*33+"[ Files Moved Successfully ]"+"$"*33) 
```

***[您可以在 github Random File Picker](https://github.com/THE-PHOENIX-777-TDW/Random-File-Picker.git)***上查看整个项目

* * *

有关**os.listdir**和**random.choice**方法的其他参考，您可以参考*tutorialspoint learn python*

os.listdir :- [Python listdir() 方法](https://www.tutorialspoint.com/python/os_listdir.htm)

random.choice :- [Python 选择() 方法](https://www.tutorialspoint.com/python/number_choice.htm)

* * *

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-31T15:04:36.920

语言不可知的解决方案：

1) 获取总数。指定目录中的文件。

2）从0到[总数]中选择一个随机数。文件 - 1]。

3）获取文件名列表作为适当索引的集合等。

4) 选择第 n 个元素，其中 n 是随机数。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-31T15:01:49.813

与使用的语言无关，您可以将目录中文件的所有引用读入像数组这样的数据结构（类似于“listFiles”），获取数组的长度。计算 '0' 到 'arrayLength-1' 范围内的随机数并访问特定索引处的文件。这应该有效，不仅在 python 中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-31T15:02:11.903

如果您事先不知道那里有哪些文件，则需要获取一个列表，然后在列表中选择一个随机索引。

这是一个尝试：

```
import os
import random

def getRandomFile(path):
  """
  Returns a random filename, chosen among the files of the given path.
  """
  files = os.listdir(path)
  index = random.randrange(0, len(files))
  return files[index] 
```

**编辑**：现在的问题提到了对“竞争条件”的恐惧，我只能假设这是在您尝试选择随机文件的过程中添加/删除文件的典型问题。

除了记住任何 I/O 操作本质上是“不安全的”（即它可能失败）之外，我认为没有办法解决这个问题。因此，在给定目录中打开随机选择的文件的算法应该：

*   实际上`open()`选择的文件，并处理失败，因为文件可能不再存在
*   可能将自己限制在一定的尝试次数内，因此如果目录为空或没有文件可读，它不会死

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2020-12-22T12:56:44.693

Python 3 有[pathlib](https://docs.python.org/3/library/pathlib.html)模块，可用于以更面向对象的方式推理文件和目录：

```
from random import choice
from pathlib import Path

path: Path = Path()
# The Path.iterdir method returns a generator, so we must convert it to a list
# before passing it to random.choice, which expects an iterable.
random_path = choice(list(path.iterdir())) 
```

# sharepoint - 改变 MOSS 2007 DropDown 导航菜单的外观

> ID：701409
> 
> 赞同：2
> 
> 时间：2009-03-31T14:59:58.430
> 
> 标签：sharepoint, moss

如何完全改变 SharePoint 2007 中 TopNavigation 下拉菜单的外观？

基本上我需要更改显示的 div 弹出窗口的外观。我需要使用 Javascript 来执行此操作，因此仅更改菜单的 CSS 是行不通的。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T20:02:00.013

[获取 MS 团队发布的MossMenu](http://blogs.msdn.com/ecm/archive/2006/12/02/customizing-the-wss-3-0-moss-2007-menu-control-mossmenu-source-code-released.aspx)代码的副本，使用您自己的代码实现并覆盖渲染。豌豆

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T20:21:26.237

请查看 Heather Solomon 的[MOSS 2007 CSS 参考](http://www.heathersolomon.com/content/sp07cssreference.htm)博客。你很可能会得到你想要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T15:13:35.090

Telerik 有几个页面向您展示如何使用他们的控件而不是 MOSS 中的下拉菜单。方向从这里开始[http://www.telerik.com/help/aspnet-ajax/moss-overview.html](http://www.telerik.com/help/aspnet-ajax/moss-overview.html)

# html - 标题

> ID：701410
> 
> 赞同：0
> 
> 时间：2009-03-31T15:00:07.930
> 
> 标签：html, css

我有多个无序列表，h2 按主题为每个列表命名。

这是html

```
<h2>Early Childhood Education</h2>
<ul class="course-list">    
    <li><a href="/academics/courses/child_growth_and_development/" title="Child Growth and Development">Child Growth and Development</a></li>
    <li><a href="/academics/courses/curriculum_and_methods_in_teaching_early_childhood_education/" title="Curriculum and Methods in Teaching Early Childhood Education">Curriculum and Methods in Teaching Early Childhood Education</a></li>
    <li><a href="/academics/courses/introduction_to_early_childhood_education/" title="Introduction to Early Childhood Education">Introduction to Early Childhood Education</a></li>
    <li><a href="/academics/courses/introduction_to_education/" title="Introduction to Education">Introduction to Education</a></li>
    <li><a href="/academics/courses/practicum_i_early_childhood/" title="Practicum I: Early Childhood">Practicum I: Early Childhood</a></li>
    <li><a href="/academics/courses/practicum_ii_early_childhood/" title="Practicum II: Early Childhood">Practicum II: Early Childhood</a></li>
    <li><a href="/academics/courses/practicum_in_education/" title="Practicum in Education">Practicum in Education</a></li>
</ul>

<h2>Emergency Medical Technician</h2>
<ul class="course-list">    
    <li><a href="/academics/courses/emergency_medical_technician_emt_basic/" title="Emergency Medical Technician (EMT) – Basic">Emergency Medical Technician (EMT) – Basic</a></li>
    <li><a href="/academics/courses/emergency_medical_technician_emt_paramedic_i/" title="Emergency Medical Technician (EMT) – Paramedic I">Emergency Medical Technician (EMT) – Paramedic I</a></li>
    <li><a href="/academics/courses/emergency_medical_technician_emt_paramedic_ii_field_internship_part_i/" title="Emergency Medical Technician (EMT) – Paramedic II (Field Internship – Part I)">Emergency Medical Technician (EMT) – Paramedic II (Field Internship – Part I)</a></li>
    <li><a href="/academics/courses/emergency_medical_technician_emt_paramedic_iii/" title="Emergency Medical Technician (EMT) – Paramedic III">Emergency Medical Technician (EMT) – Paramedic III</a></li>
    <li><a href="/academics/courses/emergency_medical_technician_emt_paramedic_iv_field_internship_part_ii/" title="Emergency Medical Technician (EMT) – Paramedic IV (Field Internship – Part II)">Emergency Medical Technician (EMT) – Paramedic IV (Field Internship – Part II)</a></li>
    <li><a href="/academics/courses/emt_basic_fieldwork/" title="EMT-Basic Fieldwork">EMT-Basic Fieldwork</a></li>
    <li><a href="/academics/courses/report_writing_for_healthcare_professionals/" title="Report Writing for Healthcare Professionals">Report Writing for Healthcare Professionals</a></li>
</ul>

<h2>English</h2>
<ul class="course-list">
    <li><a href="/academics/courses/african_american_literature/" title="African American Literature">African American Literature</a></li>
    <li><a href="/academics/courses/basic_acting_technique/" title="Basic Acting Technique">Basic Acting Technique</a></li>
    <li><a href="/academics/courses/contemporary_american_poetry/" title="Contemporary American Poetry">Contemporary American Poetry</a></li>
    <li><a href="/academics/courses/english_i_college_writing/" title="English I: College Writing">English I: College Writing</a></li>
    <li><a href="/academics/courses/english_ii_introduction_to_literature/" title="English II: Introduction to Literature">English II: Introduction to Literature</a></li>
    <li><a href="/academics/courses/essentials_of_english/" title="Essentials of English">Essentials of English</a> *</li>
    <li><a href="/academics/courses/interpersonal_communication/" title="Interpersonal Communication">Interpersonal Communication</a></li>
    <li><a href="/academics/courses/interviewing_practices_and_principles/" title="Interviewing Practices and Principles">Interviewing Practices and Principles</a></li>
    <li><a href="/academics/courses/introduction_to_drama_study/" title="Introduction to Drama Study">Introduction to Drama Study</a></li>
    <li><a href="/academics/courses/introduction_to_poetry/" title="Introduction to Poetry">Introduction to Poetry</a></li>
    <li><a href="/academics/courses/introduction_to_technical_writing/" title="Introduction to Technical Writing">Introduction to Technical Writing</a></li>
    <li><a href="/academics/courses/journalism/" title="Journalism">Journalism</a></li>
    <li><a href="/academics/courses/journalism_ii/" title="Journalism II">Journalism II</a></li>
    <li><a href="/academics/courses/literature_for_children/" title="Literature for Children">Literature for Children</a></li>
    <li><a href="/academics/courses/literature_of_the_western_world/" title="Literature of the Western World">Literature of the Western World</a></li>
    <li><a href="/academics/courses/major_american_writers/" title="Major American Writers">Major American Writers</a></li>
    <li><a href="/academics/courses/major_english_writers/" title="Major English Writers">Major English Writers</a></li>
    <li><a href="/academics/courses/modern_american_novel/" title="Modern American Novel">Modern American Novel</a></li>
    <li><a href="/academics/courses/nonfiction_literature/" title="Nonfiction Literature">Nonfiction Literature</a></li>
    <li><a href="/academics/courses/public_speaking/" title="Public Speaking">Public Speaking</a></li>
    <li><a href="/academics/courses/science_fiction/" title="Science Fiction">Science Fiction</a></li>
    <li><a href="/academics/courses/service_learning_volunteer_project/" title="Service Learning – Volunteer Project">Service Learning – Volunteer Project</a></li>
    <li><a href="/academics/courses/shakespeare/" title="Shakespeare">Shakespeare</a></li>
    <li><a href="/academics/courses/storytelling/" title="Storytelling">Storytelling</a></li>
    <li><a href="/academics/courses/the_short_story/" title="The Short Story">The Short Story</a></li>
    <li><a href="/academics/courses/voice_and_diction/" title="Voice and Diction">Voice and Diction</a></li>
    <li><a href="/academics/courses/western_mythology/" title="Western Mythology">Western Mythology</a></li>
    <li><a href="/academics/courses/women_in_literature/" title="Women in Literature">Women in Literature</a></li>
    <li><a href="/academics/courses/writing_workshop_i/" title="Writing Workshop I">Writing Workshop I</a></li>
</ul> 
```

这是CSS

```
.col-middle .course-list li {
    width:50%;
    float:left;
} 
```

这是它的屏幕截图：http: [//i40.tinypic.com/2141nd3.png](http://i40.tinypic.com/2141nd3.png)

您在屏幕截图中看到的问题是，如果 h2 标记中的文本在其上方的列表之后有一些空格，则会向上浮动一行。

我通过设置溢出来解决这个问题：自动；在 ul 风格中，但这使得列表的左半部分消失（如您在此处看到的：http: [//i39.tinypic.com/2i8y62r.png](http://i39.tinypic.com/2i8y62r.png)）

另外，我想在 ul 列表的底部和 h2 标题之间创建一些间距。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T15:04:28.373

您可以将每个 h2/ul 对包装在一个 div 中。这甚至对语义也有好处，因为两者是相关的，因此可以说是逻辑划分的一部分。然后你可以浮动整个 div 并保持元素分组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T15:06:51.657

请尝试本[教程](http://www.alistapart.com/articles/multicolumnlists)以获取多列列表

顺便说一句，花车是邪恶的。;)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T15:10:52.490

h2 标签是否应该在每个无序列表之上？也许您应该做的是在 h2 定义中添加一个 clear:both...

```
h2 { clear: both; } 
```

# asp.net - 如何在转发器页眉或页脚中查找控件

> ID：701412
> 
> 赞同：120
> 
> 时间：2009-03-31T15:00:12.767
> 
> 标签：asp.net, controls, repeater, findcontrol

我想知道如何在 Asp.Net Repeater 控件的 HeaderTemplate 或 FooterTemplate 中找到控件。

我可以在 ItemDataBound 事件上访问它们，但我想知道如何在之后获取它们（例如在页眉/页脚中检索输入的值）。

注意：我在找到答案后在这里发布了这个问题，以便我记住它（也许其他人可能会觉得这很有用）。

* * *

## 回答 #1

> 赞同：175
> 
> 时间：2009-03-31T15:01:40.517

如评论中所述，这仅在您对中继器进行数据绑定后才有效。

在**标题**中查找控件：

```
lblControl = repeater1.Controls[0].Controls[0].FindControl("lblControl"); 
```

要在**页脚**中查找控件：

```
lblControl = repeater1.Controls[repeater1.Controls.Count - 1].Controls[0].FindControl("lblControl"); 
```

* * *

## 使用扩展方法

```
public static class RepeaterExtensionMethods
{
    public static Control FindControlInHeader(this Repeater repeater, string controlName)
    {
        return repeater.Controls[0].Controls[0].FindControl(controlName);
    }

    public static Control FindControlInFooter(this Repeater repeater, string controlName)
    {
        return repeater.Controls[repeater.Controls.Count - 1].Controls[0].FindControl(controlName);
    }
} 
```

* * *

## 回答 #2

> 赞同：54
> 
> 时间：2011-02-21T03:13:35.720

更好的解决方案

您可以在 ItemCreated 事件中检查项目类型：

```
protected void rptSummary_ItemCreated(Object sender, RepeaterItemEventArgs e) {
    if (e.Item.ItemType == ListItemType.Footer) {
        e.Item.FindControl(ctrl);
    }
    if (e.Item.ItemType == ListItemType.Header) {
        e.Item.FindControl(ctrl);
    }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2010-08-10T12:56:41.083

您可以在 ItemCreated 事件上对控件进行引用，然后再使用它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2011-04-12T14:43:11.687

在Repeater中找到控件（页眉、项目、页脚）

```
public static class FindControlInRepeater
{
    public static Control FindControl(this Repeater repeater, string controlName)
    {
        for (int i = 0; i < repeater.Controls.Count; i++)
            if (repeater.Controls[i].Controls[0].FindControl(controlName) != null)
                return repeater.Controls[i].Controls[0].FindControl(controlName);
        return null;
    }
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-02-22T23:16:01.557

这是在 VB.NET 中，如果需要，只需转换为 C#：

```
<Extension()>
Public Function FindControlInRepeaterHeader(Of T As Control)(obj As Repeater, ControlName As String) As T
    Dim ctrl As T = TryCast((From item As RepeaterItem In obj.Controls
                   Where item.ItemType = ListItemType.Header).SingleOrDefault.FindControl(ControlName),T)
    Return ctrl
End Function 
```

并轻松使用：

```
Dim txt as string = rptrComentarios.FindControlInRepeaterHeader(Of Label)("lblVerTodosComentarios").Text 
```

尝试使其与页脚和项目控件一起使用 =)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-04-15T09:25:47.410

最好和最干净的方法是在 Item_Created 事件中：

```
 protected void rptSummary_ItemCreated(Object sender, RepeaterItemEventArgs e)
        {
            switch (e.Item.ItemType)
            {
                case ListItemType.AlternatingItem:
                    break;
                case ListItemType.EditItem:
                    break;
                case ListItemType.Footer:
                    e.Item.FindControl(ctrl);
                    break;
                case ListItemType.Header:
                    break;
                case ListItemType.Item:
                    break;
                case ListItemType.Pager:
                    break;
                case ListItemType.SelectedItem:
                    break;
                case ListItemType.Separator:
                    break;
                default:
                    break;
            }
    } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2018-06-29T11:28:03.930

```
private T GetHeaderControl<T>(Repeater rp, string id) where T : Control
{
    T returnValue = null;
    if (rp != null && !String.IsNullOrWhiteSpace(id))
    {
        returnValue = rp.Controls.Cast<RepeaterItem>().Where(i => i.ItemType == ListItemType.Header).Select(h => h.FindControl(id) as T).Where(c => c != null).FirstOrDefault();
    }
    return returnValue;
} 
```

查找并转换控件。（基于 Piyey 的 VB 答案）

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-02-01T11:54:30.580

对于 ItemDataBound

```
protected void Repeater1_ItemDataBound(object sender, RepeaterItemEventArgs e)
{
    if (e.Item.ItemType == ListItemType.Header)//header
    {
            Control ctrl = e.Item.FindControl("ctrlID");
    }
    else if (e.Item.ItemType == ListItemType.Footer)//footer
    {
            Control ctrl = e.Item.FindControl("ctrlID");
    }
} 
```

# .net - 如何保持 datetime2 列插入唯一

> ID：701419
> 
> 赞同：3
> 
> 时间：2009-03-31T15:01:25.510
> 
> 标签：.net, sql-server, datetime

我有一个在 sql server 2008 中存储股票报价的表。它以符号列和 datecolumn 为键，它是 datetime2。在 ac# 中，应用程序插入以高速率发送到表中。目前，使用符号和 DateTime.Now 创建一行，然后插入。有时会出现相同符号的 2 个刻度出现的情况，并且 datetime.now 将返回相同的时间，精确到毫秒。我的问题是如何确保我的插入不会对给定符号使用相同的时间。我想我可以在数据库中使用另一个唯一键，如 rowver 或某种自动编号作为一种解决方案，但即使插入成功，我也不希望给定符号有重复的时间。我还考虑过存储最后一次插入时间，如果相等，只需添加一毫秒即可。一世' 我不确定解决这个问题的最佳方法。此外 datetime2 接缝比.net datetime 更精确，所以不知道我是否应该尝试在服务器或客户端上解决这个问题。

谢谢

无论如何，我都想保留每个插入，并且出于性能原因，我不想检查先前的值，所以我将采用的解决方案是一个标识列。这将允许我保留插入的顺序，同时允许在 datetime2 中重复。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T15:44:28.120

不要在密钥中使用日期时间。

使用标识列作为主键，只需在刻度+日期时间上放置一个索引（如果需要，可以聚集）。我不确定你想要这些 dups 做什么，但这样你就可以记录它们发生了......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T15:07:59.237

我认为这个问题的答案将取决于如果一个符号确实在同一时间出现，你想做什么？

您可以在符号和日期时间列上创建唯一索引 - 但这会导致两个实例之一的唯一键违规。如果您正在为性能而设计，这可能是一项昂贵的工作。

另一种选择是有一个时间戳列，这将确保即使您恰好同时获得两个相同的符号，您的插入也不会失败。

真正的问题是——你想用第二个相同的符号做什么？你能负担得起在写入之前检查表中是否已经存在相同的符号和日期时间的费用吗？那么您可以记录并丢弃重复项吗？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-08T22:41:13.703

不要使用 C# DateTime.Now，即使 DateTime.Now 是线程安全的，它也可以返回两个相同的值。您最好使用 Datetime2 列的自动生成属性。

编辑：...通过将自动生成的属性设置为 SYSDATETIME()

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T15:11:25.920

您的数据库插入线程安全吗？即是否有可能两个插入可能同时发生并且彼此不知道？在这种情况下，存储最高值并添加毫秒是行不通的。

在发生碰撞的情况下，您可能必须有一个常规程序来执行并增加时间。

# asp.net - ASP.NET HttpRequest 可以为空吗？CurrentExecutionFilePath 怎么样？

> ID：701426
> 
> 赞同：3
> 
> 时间：2009-03-31T15:01:54.667
> 
> 标签：asp.net, null, httprequest

我们在生产服务器中遇到了一个奇怪的错误。我们有一个堆栈跟踪，但没有行号，所以我知道错误所在的方法，但不知道确切的行。它抱怨“对象引用未设置为对象的实例”。有些东西是空的。

查看代码后，我能看到的唯一两个潜在罪魁祸首是连续两行：

```
string currentPath = this.Request.CurrentExecutionFilePath;
string[] parts = currentPath.Split('/'); 
```

如果 Request 为 null，或者 Request 的 CurrentExecutionFilePath 为 null，则会抛出。我不太清楚何时（或什至）会发生这种情况。我在这里吠错树了吗？（此代码似乎在页面生命周期的加载部分运行）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T15:56:11.337

如果您从第一个线程启动线程，则请求和/或 HttpContext 可以为空。（异步处理等）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T15:15:17.817

奇怪的是，我在生产服务器上多次看到 null HttpRequest 错误，但始终无法找出原因。

我知道这对你没有任何用处，但我只是出于团结而写作:)

我记得一半的潜在事情是与 IIS 不将根映射到 /Default.aspx 相关，但同样，这都是很久以前的事了，所以请不要太注意这些潜在的无用的杂谈！！！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-31T15:15:53.507

您是否为发布版本启用了 PDB 输出？

如果这样做，您只需将 pdb 部署到生产服务器即可在堆栈跟踪中获取行号。

（pdb 和 dll 必须匹配）

# python - 用于绘制三元/三角形图的库/工具

> ID：701429
> 
> 赞同：16
> 
> 时间：2009-03-31T15:02:14.897
> 
> 标签：python, r, plot, gnuplot

我需要绘制表示各种物质/混合物（*x* + *y* + *z* = 1）的摩尔分数（*x*、*y*、*z ）的*[三元/三角形图。](http://en.wikipedia.org/wiki/Ternary_plot)每个图代表等值物质，例如具有相同熔点的物质。这些图需要用不同的颜色/符号绘制在同一个三角形上，如果我也可以连接这些点，那就太好了。

 ***我看过 matplotlib、R 和 gnuplot，但他们似乎无法画出这种情节。R的第 3 方[ade4](http://cran.r-project.org/web/packages/ade4/)包似乎能够绘制它，但我不确定是否可以在同一个三角形上绘制多个图。

我需要在 Linux 或 Windows 下运行的东西。我愿意接受任何建议，包括其他语言的库，例如 Perl、PHP、Ruby、C# 和 Java。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2011-05-20T18:14:57.457

创建了一个非常基本的脚本来生成三元（或更多）图。没有网格线或刻度线，但使用“基础”数组中的向量添加这些不会太难。

![在此处输入图像描述](https://i.stack.imgur.com/HN4N4.png)

```
from pylab import *

def ternaryPlot(
            data,

            # Scale data for ternary plot (i.e. a + b + c = 1)
            scaling=True,

            # Direction of first vertex.
            start_angle=90,

            # Orient labels perpendicular to vertices.
            rotate_labels=True,

            # Labels for vertices.
            labels=('one','two','three'),

            # Can accomodate more than 3 dimensions if desired.
            sides=3,

            # Offset for label from vertex (percent of distance from origin).
            label_offset=0.10,

            # Any matplotlib keyword args for plots.
            edge_args={'color':'black','linewidth':2},

            # Any matplotlib keyword args for figures.
            fig_args = {'figsize':(8,8),'facecolor':'white','edgecolor':'white'},
        ):
    '''
    This will create a basic "ternary" plot (or quaternary, etc.)
    '''
    basis = array(
                    [
                        [
                            cos(2*_*pi/sides + start_angle*pi/180),
                            sin(2*_*pi/sides + start_angle*pi/180)
                        ] 
                        for _ in range(sides)
                    ]
                )

    # If data is Nxsides, newdata is Nx2.
    if scaling:
        # Scales data for you.
        newdata = dot((data.T / data.sum(-1)).T,basis)
    else:
        # Assumes data already sums to 1.
        newdata = dot(data,basis)

    fig = figure(**fig_args)
    ax = fig.add_subplot(111)

    for i,l in enumerate(labels):
        if i >= sides:
            break
        x = basis[i,0]
        y = basis[i,1]
        if rotate_labels:
            angle = 180*arctan(y/x)/pi + 90
            if angle > 90 and angle <= 270:
                angle = mod(angle + 180,360)
        else:
            angle = 0
        ax.text(
                x*(1 + label_offset),
                y*(1 + label_offset),
                l,
                horizontalalignment='center',
                verticalalignment='center',
                rotation=angle
            )

    # Clear normal matplotlib axes graphics.
    ax.set_xticks(())
    ax.set_yticks(())
    ax.set_frame_on(False)

    # Plot border
    ax.plot(
        [basis[_,0] for _ in range(sides) + [0,]],
        [basis[_,1] for _ in range(sides) + [0,]],
        **edge_args
    )

    return newdata,ax

if __name__ == '__main__':
    k = 0.5
    s = 1000

    data = vstack((
        array([k,0,0]) + rand(s,3), 
        array([0,k,0]) + rand(s,3), 
        array([0,0,k]) + rand(s,3)
    ))
    color = array([[1,0,0]]*s + [[0,1,0]]*s + [[0,0,1]]*s)

    newdata,ax = ternaryPlot(data)

    ax.scatter(
        newdata[:,0],
        newdata[:,1],
        s=2,
        alpha=0.5,
        color=color
        )
    show() 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2010-01-10T01:06:36.963

[R 有一个名为VCD](http://www.math.yorku.ca/SCS/vcd/)的外部包，它应该可以满足您的需求。

文档非常好（122 页手册随包分发）；还有一本同名的书，*Visual Display of Quantitative Information*，作者是包的作者（Michael Friendly 教授）。

**要使用vcd**创建三元图，只需调用***ternaryplot()***并传入一个 mx 3 矩阵，即具有三列的矩阵。

方法签名非常简单；只需要一个参数（mx 3 数据矩阵）；并且所有关键字参数都与绘图的美感有关，除了比例尺，当设置为 1 时，按列规范化数据。

为了在三元图上绘制数据点，给定点的坐标被计算为*质点的重心*，其中包含数据矩阵的每个特征值都是一个单独的*权重*，因此点的坐标 V(a, b, c) 是

```
V(b, c/2, c * (3^.5)/2 
```

为了生成下图，我刚刚创建了一些假数据来表示四种不同的化学混合物，每一种都由三种物质（x、y、z）的不同比例组成。我缩放了输入（所以 x + y + z = 1）但是如果您为其“缩放”参数传入一个值，该函数将为您完成（实际上，默认值为 1，我相信这是您的问题要求）。我使用不同的颜色和符号来表示四个数据点，但您也可以只使用单一颜色/符号并标记每个点（通过“id”参数）。

[![](https://i.stack.imgur.com/MujXH.png)](https://i.stack.imgur.com/MujXH.png)

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2013-12-19T01:22:40.400

我在 R 中编写的一个包*刚刚*被 CRAN 接受，网页是[www.ggtern.com](http://www.ggtern.com)：

它基于我用作平台的**ggplot2 。**对我来说，驱动力是希望在我的工作中保持一致性，并且由于我大量使用 ggplot2，因此该软件包的开发是一个合乎逻辑的进展。

对于那些使用 ggplot2 的人来说，使用 ggtern 应该是轻而易举的事，这里有几个演示可以实现什么。

![长石](https://i.stack.imgur.com/cMjIw.png)

**使用以下代码生成：**

```
# Load data
data(Feldspar)

# Sort it by decreasing pressure 
# (so small grobs sit on top of large grobs
Feldspar <- Feldspar[with(Feldspar, order(-P.Gpa)), ]

# Build and Render the Plot
ggtern(data = Feldspar, aes(x = An, y = Ab, z = Or)) + 
#the layer
geom_point(aes(fill = T.C, 
               size = P.Gpa, 
               shape = Feldspar)) + 
#scales
scale_shape_manual(values = c(21, 24)) + 
scale_size_continuous(range = c(2.5, 7.5)) + 
scale_fill_gradient(low = "green", high = "red") + 

#theme tweaks
theme_tern_bw()  + 
theme(legend.position      = c(0, 1), 
      legend.justification = c(0, 1), 
      legend.box.just      = "left") + 

#tweak guides
guides(shape= guide_legend(order   =1,
                           override.aes=list(size=5)),
       size = guide_legend(order   =2),
       fill = guide_colourbar(order=3)) +

#labels and title
labs(size = "Pressure/GPa", 
     fill = "Temperature/C") + 
ggtitle("Feldspar - Elkins and Grove 1990") 
```

* * *

等值线图也已针对三元环境进行了修补，并且包含了一个新几何图形，用于通过*马氏距离*表示置信区间。

![轮廓](https://i.stack.imgur.com/EuCN2.png)

**使用以下代码生成：**

```
ggtern(data=Feldspar,aes(An,Ab,Or)) +
  geom_confidence(aes(group=Feldspar,
                      fill=..level..,
                      alpha=1-..level..),
                      n=2000,
                  breaks=c(0.01,0.02,0.03,0.04,
                           seq(0.05,0.95,by=0.1),
                           0.99,0.995,0.9995),
                  color=NA,linetype=1) +
  geom_density2d(aes(color=..level..)) + 
  geom_point(fill="white",aes(shape=Feldspar),size=5) +  
  theme_tern_bw() + 
  theme_tern_nogrid() + 
  theme(ternary.options=element_ternary(padding=0.2),
                        legend.position=c(0,1),
                        legend.justification=c(0,1),
                        legend.box.just="left") +
  labs(color="Density",fill="Confidence",
   title="Feldspar - Elkins and Grove 1990 + Confidence Levels + Density") +
  scale_color_gradient(low="gray",high="magenta") +
  scale_fill_gradient2(low="red",mid="orange",high="green",
                       midpoint=0.8) +
  scale_shape_manual(values=c(21,24)) + 
  guides(shape= guide_legend(order   =1,
                             override.aes=list(size=5)),
         size = guide_legend(order   =2),
         fill = guide_colourbar(order=3),
         color= guide_colourbar(order=4),
         alpha= "none") 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2013-07-16T13:55:10.630

[Veusz](http://home.gna.org/veusz/)支持三元图。这是[文档](http://home.gna.org/veusz/examples/#ternary)中的一个示例：![示例图](https://i.stack.imgur.com/Tzsv5.png)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-01-11T14:30:16.210

Chloë Lewis 开发*了一个三角形图通用类，旨在* 使用 Python 和 Matplotlib 支持土壤纹理三角形。它可以在这里~~http://nature.berkeley.edu/~chlewis/Sourcecode.html~~ [https://github.com/chlewissoil/TernaryPlotPy](https://github.com/chlewissoil/TernaryPlotPy)

Chloe 编辑添加：将其移至更可靠的主机！此外，它是一个公共 repo，所以如果你想请求库化，你可以添加一个问题。希望它对某人有用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-31T15:18:28.870

gnuplot 中 似乎有一个实现[[：（](http://warmada.staff.ugm.ac.id/Graphics/gnuplot/images/pearce.gif)][来源：][ugm.ac.id](http://warmada.staff.ugm.ac.id/Graphics/gnuplot/petclass/pearce.html) [）][![三元情节](https://i.stack.imgur.com/kOY8m.gif)](https://i.stack.imgur.com/kOY8m.gif)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-10-13T21:19:32.250

我刚刚发现了一个使用 Python/Matplotlib 生成名为 wxTernary 的三元图的工具。它可以通过[http://wxternary.sourceforge.net/](http://wxternary.sourceforge.net/)获得——我第一次尝试就成功地生成了一个三元图。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-31T15:16:53.490

如果找不到更简单的方法，请查找矢量绘图库并从头开始绘制。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-10-14T12:09:05.280

有一个名为[soiltexture](http://cran.r-project.org/web/packages/soiltexture/index.html)的 R 包。它针对土壤质地三角形图，但可以针对某些方面进行定制。

# javascript - 如何从 Javascript 中的域中剥离子域和 .com/.org 等？

> ID：701432
> 
> 赞同：4
> 
> 时间：2009-03-31T15:02:30.763
> 
> 标签：javascript, dns

我想从 javascript 域中获取域名（雅虎、谷歌、stackoverflow）。我怎样才能轻松地将其拉出并删除任何子域和任何扩展名？

请参阅评论，如果可能的话，我需要它适用于任何域。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T15:28:09.033

查看[如何从 URL 获取域名](https://stackoverflow.com/questions/569137/how-to-get-domain-name-from-url)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T15:05:14.033

试试这个功能：

```
"www.google.com".match(/\.?([^.]+)\.[^.]+.?$/)[1] 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T15:07:15.947

```
var domain = 'http://www.google.com/';
var parts = domain.toString().split('.'.toString());
parts[parts.length - 2]; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-10-09T19:30:22.043

我需要这样做并制作一些简单的东西来解释我的用例

```
function stripSubDomainAndTLD (domain) {
    return domain.replace(/^(?:[a-z0-9\-\.]+\.)??([a-z0-9\-]+)(?:\.com|\.net|\.org|\.biz|\.ws|\.in|\.me|\.co\.uk|\.co|\.org\.uk|\.ltd\.uk|\.plc\.uk|\.me\.uk|\.edu|\.mil|\.br\.com|\.cn\.com|\.eu\.com|\.hu\.com|\.no\.com|\.qc\.com|\.sa\.com|\.se\.com|\.se\.net|\.us\.com|\.uy\.com|\.ac|\.co\.ac|\.gv\.ac|\.or\.ac|\.ac\.ac|\.af|\.am|\.as|\.at|\.ac\.at|\.co\.at|\.gv\.at|\.or\.at|\.asn\.au|\.com\.au|\.edu\.au|\.org\.au|\.net\.au|\.id\.au|\.be|\.ac\.be|\.adm\.br|\.adv\.br|\.am\.br|\.arq\.br|\.art\.br|\.bio\.br|\.cng\.br|\.cnt\.br|\.com\.br|\.ecn\.br|\.eng\.br|\.esp\.br|\.etc\.br|\.eti\.br|\.fm\.br|\.fot\.br|\.fst\.br|\.g12\.br|\.gov\.br|\.ind\.br|\.inf\.br|\.jor\.br|\.lel\.br|\.med\.br|\.mil\.br|\.net\.br|\.nom\.br|\.ntr\.br|\.odo\.br|\.org\.br|\.ppg\.br|\.pro\.br|\.psc\.br|\.psi\.br|\.rec\.br|\.slg\.br|\.tmp\.br|\.tur\.br|\.tv\.br|\.vet\.br|\.zlg\.br|\.br|\.ab\.ca|\.bc\.ca|\.mb\.ca|\.nb\.ca|\.nf\.ca|\.ns\.ca|\.nt\.ca|\.on\.ca|\.pe\.ca|\.qc\.ca|\.sk\.ca|\.yk\.ca|\.ca|\.cc|\.ac\.cn|\.com\.cn|\.edu\.cn|\.gov\.cn|\.org\.cn|\.bj\.cn|\.sh\.cn|\.tj\.cn|\.cq\.cn|\.he\.cn|\.nm\.cn|\.ln\.cn|\.jl\.cn|\.hl\.cn|\.js\.cn|\.zj\.cn|\.ah\.cn|\.gd\.cn|\.gx\.cn|\.hi\.cn|\.sc\.cn|\.gz\.cn|\.yn\.cn|\.xz\.cn|\.sn\.cn|\.gs\.cn|\.qh\.cn|\.nx\.cn|\.xj\.cn|\.tw\.cn|\.hk\.cn|\.mo\.cn|\.cn|\.cx|\.cz|\.de|\.dk|\.fo|\.com\.ec|\.tm\.fr|\.com\.fr|\.asso\.fr|\.presse\.fr|\.fr|\.gf|\.gs|\.co\.il|\.net\.il|\.ac\.il|\.k12\.il|\.gov\.il|\.muni\.il|\.ac\.in|\.co\.in|\.org\.in|\.ernet\.in|\.gov\.in|\.net\.in|\.res\.in|\.is|\.it|\.ac\.jp|\.co\.jp|\.go\.jp|\.or\.jp|\.ne\.jp|\.ac\.kr|\.co\.kr|\.go\.kr|\.ne\.kr|\.nm\.kr|\.or\.kr|\.li|\.lt|\.lu|\.asso\.mc|\.tm\.mc|\.com\.mm|\.org\.mm|\.net\.mm|\.edu\.mm|\.gov\.mm|\.ms|\.nl|\.no|\.nu|\.pl|\.ro|\.org\.ro|\.store\.ro|\.tm\.ro|\.firm\.ro|\.www\.ro|\.arts\.ro|\.rec\.ro|\.info\.ro|\.nom\.ro|\.nt\.ro|\.se|\.si|\.com\.sg|\.org\.sg|\.net\.sg|\.gov\.sg|\.sk|\.st|\.tf|\.ac\.th|\.co\.th|\.go\.th|\.mi\.th|\.net\.th|\.or\.th|\.tm|\.to|\.com\.tr|\.edu\.tr|\.gov\.tr|\.k12\.tr|\.net\.tr|\.org\.tr|\.com\.tw|\.org\.tw|\.net\.tw|\.ac\.uk|\.uk\.com|\.uk\.net|\.gb\.com|\.gb\.net|\.vg|\.sh|\.kz|\.ch|\.info|\.ua|\.gov|\.name|\.pro|\.ie|\.hk|\.com\.hk|\.org\.hk|\.net\.hk|\.edu\.hk|\.us|\.tk|\.cd|\.by|\.ad|\.lv|\.eu\.lv|\.bz|\.es|\.jp|\.cl|\.ag|\.mobi|\.eu|\.co\.nz|\.org\.nz|\.net\.nz|\.maori\.nz|\.iwi\.nz|\.io|\.la|\.md|\.sc|\.sg|\.vc|\.tw|\.travel|\.my|\.se|\.tv|\.pt|\.com\.pt|\.edu\.pt|\.asia|\.fi|\.com\.ve|\.net\.ve|\.fi|\.org\.ve|\.web\.ve|\.info\.ve|\.co\.ve|\.tel|\.im|\.gr|\.ru|\.net\.ru|\.org\.ru|\.hr|\.com\.hr)$/, '$1');
} 
```

主要是我只是想删除所有子域，不幸的是，对于一些新的顶级域名来说，这不是 100%，但它工作得很好，你总是可以添加到正则表达式中。

[http://jsfiddle.net/icodeforlove/TzjJE/2/](http://jsfiddle.net/icodeforlove/TzjJE/2/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-06-22T20:03:03.590

只需扩展 window.location 对象以支持 MLD（中级域）。

```
window.location.mld = function() {
    return window.location.hostname.split('.').reverse()[1];
}(); 
```

像这样使用它： `window.location.mld`

`google`如果你在，哪个会输出`www.google.com`

# asp.net - 使用 Javascript ASP.Net 1.1 添加和检索添加到 DataGrid 的行

> ID：701435
> 
> 赞同：0
> 
> 时间：2009-03-31T15:02:53.883
> 
> 标签：asp.net, javascript, datagrid

我可以使用 javascript DOM cloneNode 方法添加一行，现在我想读取服务器端 dataGrid 的所有行。

任何帮助，将不胜感激

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T18:10:55.227

更深入地了解您要完成的工作可能会有所帮助。Ali 已经提到了您的代码可以工作的一种方式。您可以让代码向隐藏的表单字段添加值，同时在屏幕上添加行。这将允许您在浏览器级别添加行，而无需回发。当然，这样做的缺点是在服务器端代码可以处理任何添加之前，您仍然需要刷新页面。

您的第二个选项是在页面上实现某种 AJAX 行为。这将允许您的服务器端代码在添加新行值时访问它们，而无需整个页面刷新。由于您使用的是 .NET 1.1，因此您不能使用 Microsoft 的 AJAX 工具包，但您可以尝试[Anthem.NET](http://anthem-dot-net.sourceforge.net/)。从来没有自己尝试过，但它比你自己的手卷更好......

[http://anthem-dot-net.sourceforge.net](http://anthem-dot-net.sourceforge.net/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T17:03:12.550

如果不使用表单中的隐藏字段来存储新添加的行，就无法做到这一点。这是因为您添加到数据网格的行的值不会回发到服务器。您需要将行值存储到将被回发的隐藏表单字段中，您可以访问服务器端的值并将其解析为行并对其执行任何操作。

# .net - .NET 为什么可以将字符串 [] 作为 IEnumerable 传递 范围？

> ID：701438
> 
> 赞同：4
> 
> 时间：2009-03-31T15:03:22.697
> 
> 标签：.net, arrays, type-conversion

这是有效的代码：

```
void func(IEnumerable<string> strings){
    foreach(string s in strings){
        Console.WriteLine(s);
    }
}

string[] ss = new string[]{"asdf", "fdsa"};
func(ss); 
```

我想知道的是，隐式转换是如何`string[] -> IEnumerable<string>`工作的？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-31T15:07:46.227

来自：[msdn 数组类](http://msdn.microsoft.com/en-us/library/system.array.aspx)

> 在 .NET Framework 2.0 版中，**Array 类**实现了
> 
> *   `IList<T>`,
> *   `ICollection<T>`， 和
> *   `IEnumerable<T>`
> 
> 通用接口。这些实现**在运行时提供给数组**，因此对文档构建工具不可见。因此，泛型接口不会出现在 Array 类的声明语法中，并且没有接口成员的参考主题，只能通过将数组转换为泛型接口类型（显式接口实现）才能访问这些成员。将数组强制转换为这些接口之一时要注意的关键是添加、插入或删除元素的成员 throw `NotSupportedException`。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-31T15:06:55.323

`Array`类，这是一个非常奇怪的野兽，编译器和 JIT 对其进行了非常特殊的处理（我猜，在 Richter 和 Don Box 的书中有更多内容），实现`IEnumerable<T>`.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-31T15:07:35.603

数组实现 IEnumerable，因此对于任何 T[]，都存在到 IEnumerable<T> 的转换。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-31T15:10:04.177

> 隐式转换 string[] -> IEnumerable 是如何工作的？

那种错失了重点，因为**没有转换。** 数组实现（你几乎可以说“继承自”，如果这对你更有意义的话）IEnumerable，所以 string[]*已经是*一个 IEnumerable——没有什么可以转换的

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T15:07:58.973

这是一个标准的接口转换；作为要求，数组 ( `T[]`) 实现`IEnumerable`和`IEnumerable<T>`. 所以 a`string[]`与 100% 兼容`IEnumerable<T>`。该实现由编译器提供（在 .NET 泛型存在之前，数组基本上是泛型的）。

根据规范（ECMA 334 v4） - 这是 13.1.4 的结果：

*   从一维数组类型`S[]`到`System.Collections.Generic.IList<S>`该接口的基础接口。
*   从一维数组类型`S[]`到此`System.Collections.Generic.IList<T>`接口的基接口，前提是存在从`S`to的隐式引用转换`T`。

回想一下`IList<T> : IEnumerable<T>`

# objective-c - git DAG 的增量线性化

> ID：701439
> 
> 赞同：12
> 
> 时间：2009-03-31T15:03:50.497
> 
> 标签：objective-c, git, visualization, directed-acyclic-graphs

我是[GitX](http://gitx.frim.nl "GitX")的作者。GitX 的功能之一是分支的可视化，可以在[这里](http://ss.frim.nl/==967)看到。

这种可视化当前是通过读取从 git 以正确顺序发出的提交来完成的。对于每个提交，父母都是已知的，因此以正确的方式建立通道相当容易。

我想通过使用我自己的提交池并自己线性化提交来加快这个过程。这允许我重用现有的已加载提交并允许 git 更快地发出提交，因为它不必以正确的顺序发出它们。

但是，我不确定使用什么算法来实现这一点。重要的是构建是增量的，因为提交的加载可能需要很长时间（100,000 次提交超过 5 秒，应该全部显示）。

Gitk 也是如此，[这里](http://repo.or.cz/w/git.git?a=commitdiff;h=7fcc92bff4f75b69d61d8d32a5326395c20ff587 "Gitk补丁")有一个补丁说明了它是如何实现的，但是我的 TCL 技能很弱，而且补丁的注释不是很彻底，而且有点难以理解。

我还希望这个算法高效，因为它必须处理数十万次提交。它还必须显示在表格中，因此快速访问特定行很重要。

我将描述到目前为止的输入、我想要的输出和一些观察结果。

输入：

*   我有一个哈希表形式的当前提交池，将提交 ID 映射到提交对象。此池不必是完整的（具有所有必要的提交）
*   我在 git 的新提交中加载了一个单独的线程，每次加载新提交时都可以调用一个回调。没有保证提交的顺序，但在大多数情况下，下一个提交是前一个提交的父级。
*   一个提交对象有自己的修订 id 和所有其父对象的修订 id
*   我有一个应该列出的分支负责人列表。也就是说，没有应该显示的 DAG 的单个“顶部”。也不必有单个图根。

输出：

*   我需要按拓扑顺序线性化这些提交。也就是说，一个提交在其父项被列出之后不能被列出。
*   我还需要可以在上面的屏幕截图中看到的“分支线”。这些可能需要预先计算，因为它们中的大多数依赖于他们的孩子。

几点说明：

*   有必要重新定位提交列表。例如，我们可能必须提交不相关的提交（分支头），直到出现使一个头成为另一个头的祖先的提交。
*   必须显示多个分支提示
*   重要的是这个过程是增量的，以便在数据仍在加载时至少有部分视图可用。这意味着必须在中途插入新数据并且必须重新调整分支线。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-03T02:46:01.893

标准的[拓扑排序](http://en.wikipedia.org/wiki/Topological_sorting)是 O(n)（OK，O(V+E)），即您应该能够在几分之一秒内对内存中的一百万次提交进行排序。不需要像 Tcl 中那样的增量 hack。

顺便说一句，我每天都使用 GitX（在 OS X 上看起来比 Gitk 好得多）并且没有任何问题（可能是因为我的存储库中没有那些疯狂的合并）:)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-04T22:09:11.463

好的，所以我在阅读整个补丁时也遇到了同样的困难，但让我们看看我是否可以根据我的想法把它拼凑起来。

首先，gitk 通过将一串提交压缩成一个弧来简化事情，其中​​包含一系列提交，每个提交只有一个父节点和一个子节点。除了其他任何事情之外，这样做应该会大大减少您必须为排序考虑的节点数量，这将有助于您使用的任何算法。作为奖励，相关的提交最终将组合在一起。

当您阅读新提交时，这确实会在查找弧方面引入一些复杂性。有几种情况：

*   新的提交有一个单亲，或者没有双亲。它延伸了一个（可能是空的）弧。大多数情况下，您只需扩展最近的弧。有几个有趣的子案例：
    *   如果它的父级已经有一个子级，它可能会导致现有的弧被分割（即，它的父级结果是一个分支点，我猜你不知道提前知道）。
    *   它可能是将两条弧线连接在一起的“缺失环节”。
    *   你可能已经知道这个提交有多个孩子
*   新提交有多个父项（合并提交）。

您可能希望在弧中包含多子或多父提交，或者将它们分开可能更有意义。无论哪种方式，逐步建立这组弧应该不会太难。

一旦你有了这些弧线，你仍然需要尝试将它们线性化。在您的情况下，上述[维基百科页面](http://en.wikipedia.org/wiki/Topological%5Fsorting)上描述的第一个算法听起来很有用，因为您有一组已知的分支点可用作您的初始集合 S。

其他注意事项：

*   重定位提交应该是可管理的。首先，你只需要在连接两条弧时关心，要么通过新的合并提交，新发现的分支点，要么将两条弧合二为一。任何给定的弧都可以轻松地维持其当前的行号范围（假设您可以将弧放在连续的行上），因此遍历树检查所有新祖先是否稍后出现应该很快。
*   关于绘制图形线我知道的不多，但我想它与您现在所做的不会有太大不同。

无论如何，我希望这会有所帮助。至少想想很有趣。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T11:36:23.317

你真的需要一次显示 100k 提交吗？什么样的用户可以吸收这种信息？

你有没有考虑分页？即只计算〜100次提交或其他东西。如果分支线返回（页外），您可以使用 Github 的反向箭头之类的东西来显示。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-03-31T18:17:18.907

我没有使用 GitX，所以也许我遗漏了一些东西，但似乎你可以从每个当前分支的头部从孩子走到父母，直到你可以绘制几个屏幕的图表。

这可能不会为您提供较早扎根的分支的最佳视觉布局。但似乎响应能力比等待绘制具有最少交叉点的图表更重要，因为大多数用户可能对最近的活动感兴趣。

# linq - 当翻译成 linq 时，这个 sql 查询（w count 和 group by）会是什么样子？

> ID：701440
> 
> 赞同：0
> 
> 时间：2009-03-31T15:04:02.290
> 
> 标签：linq, linq-to-objects, llblgenpro

将以下 sql 查询翻译为 linq 时的外观如何？

```
SELECT
    myId, Count(myId) 
FROM MyTable 
GROUP BY myId 
```

我尝试了以下方法：

```
var q = from a in db.MyTable
group a by a.Id into g
let count = g.Count()
select new
{
  Count = Id,
  Key= g.Key
}; 
```

但它在枚举时引发异常，表明没有名为“Key”的映射的 db 函数。我在这个特定的应用程序上使用 LLBLGen，我怀疑这就是问题的根源。我想在开始挖掘之前验证我的 linq 语法是否正确。有人看出有什么不对吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T15:07:05.713

试试这个：

```
var q = from a in db.MyTable
        group a by a.Id into g
        select new { Id=g.Key, Count=g.Count() }; 
```

这与您的几乎相同，但是您`Count`的获得方式不同，这在我看来是错误的。

如果 LLBLGen 不明白`IGrouping.Key`，那可能会很棘手......

要检查您的 LINQ 语法是否正确，我建议您构建一个非常简单的内存列表以用作您的表。这是一个例子：

```
using System;
using System.Collections.Generic;
using System.Linq;

class Test
{
    static void Main()
    {
        var data = new[] {
            new { Id="X", Name="Jon" },
            new { Id="Y", Name="Marc" },
            new { Id="X", Name="Holly" },
        };

        var query = from a in data
                    group a by a.Id into g
                    select new { Id=g.Key, Count=g.Count() };

        foreach (var entry in query)
        {
            Console.WriteLine(entry);
        }
    }
} 
```

这看起来给了我正确的结果。

# sql - 如何在 MySQL 中创建行生成器？

> ID：701444
> 
> 赞同：29
> 
> 时间：2009-03-31T15:04:14.940
> 
> 标签：sql, mysql, generator

有没有一种方法可以生成任意数量的行，这些行可以在类似于 Oracle 语法的 JOIN 中使用：

```
SELECT LEVEL FROM DUAL CONNECT BY LEVEL<=10 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-01T15:24:17.867

讨厌这么说，但`MySQL`它是`RDBMS`四大中唯一没有此功能的。

在`Oracle`：

```
SELECT  *
FROM    dual
CONNECT BY
        level < n 
```

在`MS SQL`（最多`100`行）：

```
WITH hier(row) AS
        (
        SELECT  1
        UNION ALL
        SELECT  row + 1
        FROM    hier
        WHERE   row < n
        )
SELECT  *
FROM    hier 
```

或使用提示`32768`

```
WITH hier(row) AS
        (
        SELECT  1
        UNION ALL
        SELECT  row + 1
        FROM    hier
        WHERE   row < 32768
        )
SELECT  *
FROM    hier
OPTION (MAXRECURSION 32767) -- 32767 is the maximum value of the hint 
```

在`PostgreSQL`：

```
SELECT  *
FROM    generate_series (1, n) 
```

在`MySQL`，什么都没有。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2013-09-29T20:24:46.517

在 MySql 中，据我了解，您可以使用没有表（或 DUAL）的 SELECT 获得多行。

因此，要获得多行，您*确实*需要一个至少具有所需行数的真实表或临时表。

但是，*您不需要构建临时表*，因为您可以使用至少具有所需行数的*任何现有表。*因此，如果您的表至少具有所需的行数，请使用：

```
SELECT  @curRow := @curRow + 1 AS row_number
FROM    sometable 
JOIN    (SELECT @curRow := 0) r
WHERE   @curRow<100; 
```

只需将“sometable”替换为您的任何表的名称，至少具有所需的行数。

PS：“r”是表“别名”：我可以使用“AS r”。FROM 或 JOIN 子句中的任何子查询都会创建一个“派生表”，与所有表一样，该表必须具有名称或别名。（见 MySql 手册：13.2.9.8\. FROM 子句中的子查询）

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2018-03-23T09:26:15.497

由于这是目前 Google 中“mysql 行生成器”的首批结果之一，因此我将添加一个更新。

如果你喜欢的 MySQL 恰好是 MariaDB，那么它们就有这个特性。它被称为[“序列存储引擎”](https://mariadb.com/kb/en/library/sequence-storage-engine/)，它的使用方式如下：

```
select * from seq_1_to_10; 
```

结果：

```
+-----+
| seq |
+-----+
|   1 |
|   2 |
|   3 |
|   4 |
|   5 |
|   6 |
|   7 |
|   8 |
|   9 |
|  10 |
+-----+
10 rows in set (0.00 sec) 
```

在 10.0 版本之前，它是一个需要显式安装的单独插件，但从 10.0 开始，它是内置的。享受吧！

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2020-04-12T09:41:51.597

### MySQL 8.0

在 MySQL 8.0、MariaDB 10.2 和更高版本中，您可以使用递归 CTE：

```
WITH RECURSIVE sequence AS (
    SELECT 1 AS level
    UNION ALL
    SELECT level + 1 AS value
    FROM sequence
    WHERE sequence.level < 10
)
SELECT level
FROM sequence; 
```

请注意，CTE[`cte_max_recursion_depth`](https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_cte_max_recursion_depth)在 MySQL 中受（默认 1000，最大 4,294,967,295 (2³²−1)）和[`max_recursive_iterations`](https://mariadb.com/kb/en/server-system-variables/#max_recursive_iterations)MariaDB 中（默认 4,294,967,295）的限制。

您可以通过执行来增加限制：

```
SET cte_max_recursion_depth = 4294967295; 
```

它只会影响您当前的会话并且不会被持久化。

### MySQL 5.7、5.6 及更低版本

对于 8.0 之前的 MySQL 版本，您可以使用以下[Markus Winand](https://stackoverflow.com/users/312881/markus-winand)的巧妙技巧：

```
CREATE OR REPLACE VIEW generator_16
AS SELECT 0 n UNION ALL SELECT 1  UNION ALL SELECT 2  UNION ALL
   SELECT 3   UNION ALL SELECT 4  UNION ALL SELECT 5  UNION ALL
   SELECT 6   UNION ALL SELECT 7  UNION ALL SELECT 8  UNION ALL
   SELECT 9   UNION ALL SELECT 10 UNION ALL SELECT 11 UNION ALL
   SELECT 12  UNION ALL SELECT 13 UNION ALL SELECT 14 UNION ALL
   SELECT 15;

CREATE OR REPLACE VIEW generator_256
AS SELECT ( ( hi.n << 4 ) | lo.n ) AS n
   FROM generator_16 lo, generator_16 hi;

CREATE OR REPLACE VIEW generator_4k
AS SELECT ( ( hi.n << 8 ) | lo.n ) AS n
   FROM generator_256 lo, generator_16 hi;

CREATE OR REPLACE VIEW generator_64k
AS SELECT ( ( hi.n << 8 ) | lo.n ) AS n
   FROM generator_256 lo, generator_256 hi;

CREATE OR REPLACE VIEW generator_1m
AS SELECT ( ( hi.n << 16 ) | lo.n ) AS n
   FROM generator_64k lo, generator_16 hi;

CREATE OR REPLACE VIEW generator_16m
AS SELECT ( ( hi.n << 16 ) | lo.n ) AS n
   FROM generator_64k lo, generator_256 hi;

CREATE OR REPLACE VIEW generator_4b
AS SELECT ( ( hi.n << 16 ) | lo.n ) AS n
   FROM generator_64k lo, generator_64k hi; 
```

进而：

```
SELECT n FROM generator_4b limit 10; 
```

在我的笔记本电脑上创建 even 只需要大约 20 毫秒`generator_4b`，其中包含超过 40 亿行。上面所有的生成器视图加起来只占用 28 KB 的存储空间。

如果你想知道它是如何工作的，你可以在他的[博文](https://use-the-index-luke.com/blog/2011-07-30/mysql-row-generator#mysql_generator_code)中找到详细的解释。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2015-10-21T20:08:33.933

`c5`我有一个包含数字 x的列 ( ) 的表，我需要一个重复相同行 x 次的 SQL 表达式。

我的表 A 包含：

```
c1  c2  c3  c4  c5
16  1   2   16  3
16  1   2   17  2 
16  1   2   18  1 
```

我需要：

```
c1  c2  c3  c4  c5  n
16  1   2   16  3   1
16  1   2   16  3   2
16  1   2   16  3   3
16  1   2   17  2   1
16  1   2   17  2   2
16  1   2   18  1   1 
```

我用表达式解决了这个问题：

```
SELECT
    c1, c2, c3, c4, c5, row_number AS n
FROM
    (
        SELECT
            @curRow := @curRow + 1 AS row_number
        FROM
            tablea
        JOIN (SELECT @curRow := 0) r
        WHERE
            @curRow < (
                SELECT
                    max(field1)
                FROM
                    tablea
            )
    ) AS vwtable2
LEFT JOIN tablea d ON vwtable2.row_number <= tablea.field1; 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-02T00:14:30.087

如果我理解你，你想要一个连续数字的列表吗？

只需列出清单：

```
create table artificial_range (id int not null primary key auto_increment, idn int);
insert into artificial_range (idn) values (0); --first row
insert into artificial_range(idn) select idn from artificial_range; --2nd
insert into artificial_range(idn) select idn from artificial_range; -- now 4 rows
insert into artificial_range(idn) select idn from artificial_range; --8
insert into artificial_range(idn) select idn from artificial_range; --16
insert into artificial_range(idn) select idn from artificial_range; --32
insert into artificial_range(idn) select idn from artificial_range; --64
insert into artificial_range(idn) select idn from artificial_range; --128 
```

...等等，直到你有，比如说，1024。

```
update artificial_range set idn = id - 1 ; 
```

-- 现在你有一个从 1 (id) 开始的系列和一个从 0 开始的系列

现在加入它，或加入它的转换：

```
 create view days_this_century as 
select date_add('2000-01-01', interval a.idn day) as cdate 
from artificial_range; 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-01T15:19:38.627

我不知道这是否有帮助，但您可以使用 sth 对每个 select 语句中的行进行编号。像：

> 设置@NUM = 0；
> 
> SELECT @NUM:=@NUM+1 行号，* FROM ...

后来加入他们的行列。在大型数据库中，这可能非常慢。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-02-08T14:34:47.740

要生成 10 行：

`SELECT a AS a UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9 from dual`

您可以生成 100 行与另外 10 行进行连接：

`select t2.a*10 + t1.a from (SELECT 0 AS a UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9) t1, (SELECT 0 AS a UNION ALL SELECT 1 UNION ALL SELECT 2 UNION ALL SELECT 3 UNION ALL SELECT 4 UNION ALL SELECT 5 UNION ALL SELECT 6 UNION ALL SELECT 7 UNION ALL SELECT 8 UNION ALL SELECT 9) t2`

然后 1000 行与另一个连接，...

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-03-11T05:46:23.690

可以，但是有点麻烦

这里是：

```
mysql> create table t(inc bigint primary key auto_increment);
Query OK, 0 rows affected (0.03 sec)

mysql> insert into t values(0);
Query OK, 1 row affected (0.01 sec)

mysql> insert into t select 0 from t;
Query OK, 1 row affected (0.02 sec)
Records: 1  Duplicates: 0  Warnings: 0

mysql> insert into t select 0 from t;
Query OK, 2 rows affected (0.02 sec)
Records: 2  Duplicates: 0  Warnings: 0

mysql> insert into t select 0 from t;
Query OK, 4 rows affected (0.00 sec)
Records: 4  Duplicates: 0  Warnings: 0

mysql> insert into t select 0 from t;
Query OK, 8 rows affected (0.01 sec)
Records: 8  Duplicates: 0  Warnings: 0

mysql> select count(inc), max(inc) from t;
+------------+----------+
| count(inc) | max(inc) |
+------------+----------+
|         16 |       20 |
+------------+----------+
1 row in set (0.00 sec)

mysql> select row_number() over w as inc from t window w as (order by inc);
+-----+
| inc |
+-----+
|   1 |
|   2 |
|   3 |
|   4 |
|   5 |
|   6 |
|   7 |
|   8 |
|   9 |
|  10 |
|  11 |
|  12 |
|  13 |
|  14 |
|  15 |
|  16 |
+-----+
16 rows in set (0.00 sec) 
```

您可以通过发出语句将生成的行数加倍

```
insert into t select 0 from t; 
```

尽可能多的。

另请注意，默认情况下**auto_increment**会产生一些间隙，这就是使用**row_number()**的原因。

# visual-studio - Sharepoint List 添加到 Create -> Custom Lists on Feature deployment

> ID：701449
> 
> 赞同：1
> 
> 时间：2009-03-31T15:04:41.023
> 
> 标签：visual-studio, sharepoint, sharepoint-2007, caml

我正在构建一个 SharePoint 功能以在“Web”范围内部署一个简单的 WebPart 和一个自定义列表。

1.  部署解决方案后，我的列表立即在站点操作 -> 站点设置 -> 自定义列表中可用。
2.  如果您尝试创建列表的一个实例，我会收到“找不到文件”
3.  如果您激活该功能，则会将列表模板的第二个副本添加到“自定义列表”标题中。
4.  不能使用相同的“找不到文件”错误创建这两个列表
5.  在停用该功能时，一个列表模板会消失
6.  在收回解决方案时，最后一个列表模板消失

涉及文件：

*   schema.xml 有 5000 行长
*   feature.xml 如下

```
<?xml version="1.0" encoding="utf-8" ?>
<Feature Id="78a8eaad-2160-434c-81c2-6c5f7ce94ade" Title="WeekWidget" Description="Displays A, B or H based upon a configurable SharePoint List." Version="1.0.0.0" Creator="Cardinal Newman Catholic School // Richard Slater" Scope="Web" ImageUrl="WeekWidget\WeekWidgetLogo.jpg" xmlns="http://schemas.microsoft.com/sharepoint/" DefaultResourceFile="core">
  <ElementManifests>
    <ElementManifest Location="ListTemplates\WeekCalendar.xml" />
    <ElementFile Location="WeekCalendar\Schema.xml" />
  </ElementManifests>
</Feature> 
```

*   WeekCalendar.xml 如下

```
<?xml version="1.0" encoding="utf-8" ?>
<Elements xmlns="http://schemas.microsoft.com/sharepoint/">
  <ListTemplate Name="WeekCalendar" DisplayName="Week Calendar" Description="List of Weeks." BaseType="0" Type="100" OnQuickLaunch="TRUE" SecurityBits="11" Sequence="410" Image="/_layouts/images/itgen.gif" />
</Elements> 
```

我认为“未找到文件”错误是另一个问题的征兆，但是在解决方案部署中不应添加列表模板。我究竟做错了什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-05T09:20:18.247

您是自己连接所有功能文件还是使用工具？通常，404 表示配置文件中的“魔术字符串”之一已关闭。此外，此处指定的目录结构看起来很可疑：

```
<ElementManifests>
  <ElementManifest Location="ListTemplates\WeekCalendar.xml" />
  <ElementFile Location="WeekCalendar\Schema.xml" />
</ElementManifests> 
```

您应该尝试将所有功能支持文件部署到同一目录。您是否在 ULS 日志 (<12 hive>/LOGS) 中找到了错误？这也可能提供一些线索。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-30T00:56:49.067

我认为问题可能与单独的目录结构有关——我通常将所有列表文件部署到同一个文件夹（在您的情况下，schema.xml 和 weekcalendar.xml；将 feature.xml 保留在列表目录之外）。

打开详细日志记录并检查 12-hive 日志以查看未找到的文件。

检查 schema.xml 并确保列表元素上的 name 属性与包含您的功能的文件夹的名称相匹配。还要注意这个元素的 Url 属性...VSeWSS 会将 URL 设置为被反向工程的列表的名称，因此我将其更改为“pages\viewpage.axp”。

在 schema.xml 中的默认视图元素上，尝试添加 SetupPath="pages\viewpage.aspx"。确保那里也有一个 WebPartZoneId="Main" 属性。

# c++ - 使用 boost::shared_ptr 时有哪些潜在危险？

> ID：701456
> 
> 赞同：49
> 
> 时间：2009-03-31T15:05:57.010
> 
> 标签：c++, boost, pointers, shared-ptr

有哪些方法可以在使用时射中自己的脚[`boost::shared_ptr`](http://www.boost.org/doc/libs/release/libs/smart_ptr/shared_ptr.htm)？换句话说，我在使用时必须避免哪些陷阱[`boost::shared_ptr`](http://www.boost.org/doc/libs/release/libs/smart_ptr/shared_ptr.htm)？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-03-31T15:55:41.137

循环引用：a指向对原始对象`shared_ptr<>`具有 a 的东西。`shared_ptr<>`当然，你可以用它`weak_ptr<>`来打破这个循环。

* * *

我添加以下内容作为我在评论中谈论的示例。

```
class node : public enable_shared_from_this<node> {
public :
    void set_parent(shared_ptr<node> parent) { parent_ = parent; }
    void add_child(shared_ptr<node> child) {
        children_.push_back(child);
        child->set_parent(shared_from_this());
    }

    void frob() {
        do_frob();
        if (parent_) parent_->frob();
    }

private :
    void do_frob();
    shared_ptr<node> parent_;
    vector< shared_ptr<node> > children_;
}; 
```

在这个例子中，你有一个节点树，每个节点都有一个指向其父节点的指针。frob() 成员函数，无论出于何种原因，都会在树中向上波动。（这并不完全古怪；一些 GUI 框架以这种方式工作）。

问题是，如果你失去了对最顶层节点的引用，那么最顶层节点仍然持有对其子节点的强引用，并且它的所有子节点也持有对其父节点的强引用。这意味着存在循环引用使所有实例无法自行清理，而无法从代码中实际到达树，这会导致内存泄漏。

```
class node : public enable_shared_from_this<node> {
public :
    void set_parent(shared_ptr<node> parent) { parent_ = parent; }
    void add_child(shared_ptr<node> child) {
        children_.push_back(child);
        child->set_parent(shared_from_this());
    }

    void frob() {
        do_frob();
        shared_ptr<node> parent = parent_.lock(); // Note: parent_.lock()
        if (parent) parent->frob();
    }

private :
    void do_frob();
    weak_ptr<node> parent_; // Note: now a weak_ptr<>
    vector< shared_ptr<node> > children_;
}; 
```

在这里，父节点已被弱指针替换。它不再对它所指的节点的生命周期有发言权。因此，如果最上面的节点超出了前面示例中的范围，那么虽然它持有对其子节点的强引用，但它的子节点并不持有对其父节点的强引用。因此没有对该对象的强引用，它会自行清理。反过来，这会导致孩子们失去他们的一个强参考，这导致他们清理，等等。简而言之，这不会泄漏。只需战略性地将 shared_ptr<> 替换为 weak_ptr<>。

注意：上述内容同样适用于 std::shared_ptr<> 和 std::weak_ptr<>，就像它适用于 boost::shared_ptr<> 和 boost::weak_ptr<> 一样。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-03-31T15:28:03.587

`shared_ptr`为同一个对象创建多个不相关的 's：

```
#include <stdio.h>
#include "boost/shared_ptr.hpp"

class foo
{
public:
    foo() { printf( "foo()\n"); }

    ~foo() { printf( "~foo()\n"); }
};

typedef boost::shared_ptr<foo> pFoo_t;

void doSomething( pFoo_t p)
{
    printf( "doing something...\n");
}

void doSomethingElse( pFoo_t p)
{
    printf( "doing something else...\n");
}

int main() {
    foo* pFoo = new foo;

    doSomething( pFoo_t( pFoo));
    doSomethingElse( pFoo_t( pFoo));

    return 0;
} 
```

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2009-04-04T00:33:31.627

构造一个匿名临时共享指针，例如在函数调用的参数中：

```
f(shared_ptr<Foo>(new Foo()), g()); 
```

这是因为允许`new Foo()`执行，然后`g()`调用并`g()`抛出异常，而无需`shared_ptr`设置，因此`shared_ptr`没有机会清理`Foo`对象。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-03T23:47:20.097

小心制作两个指向同一个对象的指针。

```
boost::shared_ptr<Base> b( new Derived() );
{
  boost::shared_ptr<Derived> d( b.get() );
} // d goes out of scope here, deletes pointer

b->doSomething(); // crashes 
```

而是使用这个

```
boost::shared_ptr<Base> b( new Derived() );
{
  boost::shared_ptr<Derived> d = 
    boost::dynamic_pointer_cast<Derived,Base>( b );
} // d goes out of scope here, refcount--

b->doSomething(); // no crash 
```

此外，任何持有 shared_ptrs 的类都应该定义复制构造函数和赋值运算符。

不要尝试在构造函数中使用 shared_from_this() ——它不起作用。而是创建一个静态方法来创建类并让它返回一个 shared_ptr。

我已经毫无问题地传递了对 shared_ptrs 的引用。只要确保它在保存之前被复制（即，没有作为类成员的引用）。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2009-03-31T15:07:44.947

这里有两件事要避免：

*   调用该`get()`函数以获取原始指针并在指向的对象超出范围后使用它。

*   将 a 的引用或原始指针传递给 a`shared_ptr`也应该是危险的，因为它不会增加有助于保持对象存活的内部计数。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2009-03-31T15:21:09.580

我们调试了几个星期的奇怪行为。

**原因是：**
我们将 'this' 传递给了一些线程工作者，而不是 'shared_from_this'。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-08-07T08:53:11.337

不完全是一支足球枪，但肯定是令人沮丧的根源，直到您围绕如何以 C++0x 方式进行操作：您所知道和喜爱的大多数谓词`<functional>`都不能很好地与`shared_ptr`. 令人高兴的是，`std::tr1::mem_fn`它可以与对象、指针和s 一起使用，`shared_ptr`替换`std::mem_fun`，但如果您想使用`std::negate`,或任何与 的老朋友，请准备好适应并可能使用参数占位符。实际上，这实际上要通用得多，因为现在您基本上最终都会使用每个函数对象适配器，但是如果您已经熟悉 STL 的便利函数，则需要一些时间来适应。`std::not1``std::plus``shared_ptr``std::tr1::bind``bind`

[这篇 DDJ 文章](http://www.ddj.com/cpp/184401949)涉及该主题，并提供了大量示例代码。几年前，当我第一次不得不弄清楚如何做时，我也在[博客上写过它。](http://maradydd.livejournal.com/357001.html)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2010-03-22T23:46:43.540

如果堆上有很多小对象但它们并不是真正“共享”的，那么使用`shared_ptr`非常小的对象（如）可能会产生开销。为它在 g++ 4.4.3 和带有 Boost 1.42 的 VS2008 上创建的每个新引用计数分配 16 个字节。分配 20 个字节。现在，如果您有一百万个不同，这意味着您的内存中有 2000 万字节只保留了 count=1。更不用说间接成本和内存碎片了。在您最喜欢的平台上尝试以下操作。`char` `short``boost::shared_ptr``std::tr1::shared_ptr``shared_ptr<char>`

```
void * operator new (size_t size) {
  std::cout << "size = " << size << std::endl;
  void *ptr = malloc(size);
  if(!ptr) throw std::bad_alloc();
  return ptr;
}
void operator delete (void *p) {
  free(p);
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-03T15:23:08.313

在类定义中为此提供 shared_ptr< T > 也是危险的。请改用 enabled_shared_from_this。

[在此处](https://stackoverflow.com/questions/712279/what-is-the-usefulness-of-enablesharedfromthis)查看以下帖子

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-04T10:21:43.757

`shared_ptr`在多线程代码中使用时需要小心。`shared_ptr`当几个s 指向同一个内存，被不同的线程使用时，就比较容易陷入这种情况。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-08-07T08:21:33.443

shared_ptr 的流行广泛使用几乎不可避免地会导致不必要的和看不见的内存占用。

循环引用是众所周知的原因，其中一些可能是间接的且难以发现，尤其是在由多个程序员编写的复杂代码中；程序员可能决定一个对象需要引用另一个对象作为快速修复，并且没有时间检查所有代码以查看他是否正在关闭一个循环。这种危险被大大低估了。

不太为人所知的是未发布参考的问题。如果一个对象被共享给许多 shared_ptrs，那么它不会被销毁，直到它们中的每一个都归零或超出范围。很容易忽略其中一个引用，并最终得到潜伏在内存中看不见的对象，而你认为​​你已经完成了。

虽然严格来说这些不是内存泄漏（它将在程序退出之前全部释放），但它们同样有害且更难检测。

这些问题是权宜之计错误声明的后果： 1\. 将您真正想要的单一所有权声明为 shared_ptr。scoped_ptr 是正确的，但是对该对象的任何其他引用都必须是原始指针，它可能会悬空。2\. 将你真正想要的被动观察引用声明为 shared_ptr。weak_ptr 是正确的，但是每次你想使用它时，你都会很麻烦地将它转换为 share_ptr。

我怀疑你的项目是这种做法会给你带来的麻烦的一个很好的例子。

如果您有一个内存密集型应用程序，您确实需要单一所有权，以便您的设计可以明确控制对象的生命周期。

单一所有权 opObject=NULL; 肯定会删除该对象，它现在会这样做。

共享所有权 spObject=NULL; ........谁知道？......

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-04-04T00:20:50.703

如果您有共享对象的注册表（例如，所有活动实例的列表），则这些对象将永远不会被释放。解决方案：在循环依赖结构的情况下（参见 Kaz Dragon 的回答），酌情使用weak_ptr。

* * *

## 回答 #13

> 赞同：-5
> 
> 时间：2011-10-09T02:42:54.460

# 智能指针不是万能的，原始指针不能被淘汰

可能最严重的危险是，既然`shared_ptr`是一个有用的工具，人们就会开始把它放在任何地方。由于普通指针可能被滥用，同样的人会寻找原始指针并尝试用字符串、容器或智能指针替换它们，即使它没有意义。原始指针的合法使用将变得可疑。会有指针警察。

这不仅可能是最严重的危险，而且可能是唯一的严重危险。所有最严重的滥用都`shared_ptr`将是智能指针优于原始指针（无论这意味着什么）的想法的直接后果，并且将智能指针放在任何地方将使 C++ 编程“更安全”。

当然，智能指针需要转换为原始指针才能使用这一事实驳斥了智能指针邪教的这种说法，但原始指针访问是“隐式” in `operator*`，`operator->`（或显式 in `get()`）这一事实，但是在隐式转换中没有隐式，足以给人这样的印象，即这不是真正的转换，并且这种非转换产生的原始指针是无害的临时性。

# C++ 不能成为“安全语言”，C++ 的任何有用子集都不是“安全的”

当然，对 C++ 的安全子集（严格意义上的“内存安全”的“安全”，如 LISP、Haskell、Java...）的追求注定是无止境的和不满足的，因为 C++ 的安全子集很小而且几乎没用，因为不安全的原语是规则而不是例外。C++ 中严格的内存安全意味着没有指针，*只有自动存储类的引用*。但是在**程序员被定义信任**的语言中，有些人会坚持使用一些（原则上）防白痴的“智能指针”，即使与原始指针相比没有其他优势，即*一种特定*的方式来破坏程序状态被避免。

# perl - 如果使用 Perl 不存在目录，如何创建目录？

> ID：701458
> 
> 赞同：12
> 
> 时间：2009-03-31T15:06:47.850
> 
> 标签：perl, directory

目前，我的 Perl 输出被硬编码以转储到以下 Unix 目录中：

```
my $stat_dir = "/home/courses/" . **NEED DIR VAR HERE**; 
```

文件名是这样构建的：

```
$stat_file = $stat_dir . "/" . $sess.substr($yr, 2, 2) . "_COURSES.csv"; 
```

我需要一种类似的方法来构建 Unix 目录，但我需要在创建它们之前先检查它们是否存在。

如何对 $stat_file 进行自动编号（修订），以便当这些文件被泵入同一目录时，它们不会覆盖或附加到目录中的现有文件？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-03-31T15:11:26.733

嗯…… `mkdir $stat_dir unless -d $stat_dir`？

嵌入这样的“额外”问题似乎不是一个好主意。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-31T15:11:04.783

使用`-d`运算符和[File::Path](http://perldoc.perl.org/File/Path.html)。

```
use File::Path qw(make_path);
eval { make_path($dir) };
if ($@) {
  print "Couldn't create $dir: $@";
} 
```

`make_path`的优势`mkdir`在于它可以创建任意深度的树。

并用于`-e`检查文件是否存在

```
my $fileSuffix = 0;
while (-e $filename) {
    $filename = $filePrefix . ++$fileSuffix . $fileExtension;
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-31T15:26:57.600

记住目录的`-d`存在并不意味着`-w`可写。但是假设您在个人区域中，则`mkdir($dir) unless(-d $dir)`可以正常工作。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-31T15:13:54.120

Perl 有一个内置函数`mkdir`

看看 perldoc perlfunc 或[Perl Power Tools](http://www.metacpan.org/module/PerlPowerTools)的 mkdir 程序。

我相信创建一个已经存在的目录是安全的，看看文档。

# c# - 检查 TCP 连接是否处于活动状态的最佳方法

> ID：701462
> 
> 赞同：4
> 
> 时间：2009-03-31T15:07:02.110
> 
> 标签：c#, .net, tcp, connection, ip-address

给定一个 IP 地址列表，我如何以编程方式检查本地计算机是否仍有与这些 IP 地址的活动 TCP 连接？我正在使用 C#。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-31T15:13:02.953

```
using System.Net.NetworkInformation    

IPGlobalProperties properties = IPGlobalProperties.GetIPGlobalProperties();
TcpConnectionInformation[] tcpInfoList = properties.GetActiveTcpConnections(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T15:12:06.217

调用[GetExtendedTcpTable](http://www.pinvoke.net/default.aspx/iphlpapi/GetExtendedTcpTable.html)并检查列表中的目标地址

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T15:15:50.623

我不完全理解问题，但如果你有一个地址列表和一个监听某些端口的软件，请尝试使用例如连接那里。插座类：

```
Socket m_Socket = new Socket(AddressFamily.InterNetwork, SocketType.Stream, ProtocolType.Tcp);
m_Socket.Connect(serverEndPoint); 
```

并最终尝试捕获异常...

如果您的代码中已经建立了连接，则可以检查 m_Socket.Connected 属性。

# python - python中的嵌套try语句？

> ID：701466
> 
> 赞同：32
> 
> 时间：2009-03-31T15:07:16.027
> 
> 标签：python, try-catch

是否有更好的方法来执行以下操作：

```
try:
    a.method1()
except AttributeError:
    try:
        a.method2()
    except AttributeError:
        try:
            a.method3()
        except AttributeError:
            raise 
```

它看起来很讨厌，我宁愿不这样做：

```
if hasattr(a, 'method1'):
    a.method1()
else if hasattr(a, 'method2'):
    a.method2()
else if hasattr(a, 'method3'):
    a.method3()
else:
    raise AttributeError 
```

以保持最高效率。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-31T15:50:14.267

对第二个稍作改动看起来非常漂亮和简单。我真的怀疑你会注意到两者之间的任何性能差异，这比嵌套的 try/excepts 好一点

```
def something(a):
    for methodname in ['method1', 'method2', 'method3']:
        try:
            m = getattr(a, methodname)
        except AttributeError:
            pass
        else:
            return m()
    raise AttributeError 
```

另一种非常易读的方法是做..

```
def something(a):
    try:
        return a.method1()
    except:
        pass

    try:
        return a.method2()
    except:
        pass

    try:
        return a.method3()
    except:
        pass

    raise AttributeError 
```

虽然很长，但函数在做什么是非常明显的。性能真的不应该是一个问题（如果一些 try/except 语句显着减慢你的脚本，脚本结构可能存在更大的问题）

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-03-31T15:19:15.543

也许你可以尝试这样的事情：

```
def call_attrs(obj, attrs_list, *args):
    for attr in attrs_list:
        if hasattr(obj, attr):
            bound_method = getattr(obj, attr)
            return bound_method(*args)

    raise AttributeError 
```

你可以这样称呼它：

```
call_attrs(a, ['method1', 'method2', 'method3']) 
```

这将尝试按照它们在列表中的顺序调用方法。如果你想传递任何参数，你可以像这样在列表之后传递它们：

```
call_attrs(a, ['method1', 'method2', 'method3'], arg1, arg2) 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2011-11-01T18:53:37.190

```
method = (
        getattr(a, 'method1', None) or
        getattr(a, 'method2', None) or
        getattr(a, 'method3')
        )
method() 
```

这将首先查找`method1`，然后`method2`，然后`method3`。一旦找到其中一个，搜索将立即停止。如果没有找到任何方法，最后一个`getattr`将引发异常。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-31T15:17:52.037

将调用封装在一个函数中怎么样？

```
def method_1_2_or_3():
    try:
        a.method1()
        return
    except AttributeError:
        pass
    try:
        a.method2()
        return
    except AttributeError:
        pass
    try:
        a.method3()
    except AttributeError:
        raise 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2011-03-10T07:07:14.807

紧凑的解决方案：

```
getattr(a, 'method1',
    getattr(a, 'method2',
        getattr(a, 'method3')))() 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-31T15:21:54.977

如果您使用的是新式对象：

```
methods = ('method1','method2','method3')
for method in methods:
    try:
        b = a.__getattribute__(method)
    except AttributeError:
        continue
    else:
        b()
        break
else:
    # re-raise the AttributeError if nothing has worked
    raise AttributeError 
```

当然，如果您不使用新样式的对象，您可以尝试`__dict__`使用`__getattribute__`.

编辑：这段代码可能被证明是一团糟。如果`__getattribute__`或未`__dict__`找到，请大胆猜测会引发什么样的错误。

# javascript - 表中的jQuery隐藏字段

> ID：701470
> 
> 赞同：1
> 
> 时间：2009-03-31T15:07:43.293
> 
> 标签：javascript, jquery, row, html-table, hidden-field

我想知道是否有人知道使用 jquery 在表行中访问隐藏字段（通过客户端 ID）的方法。

```
$("#tblOne").find("tr").click(function() {
            var worker = $(this).find(":input").val();
        }); 
```

我发现上述方法适用于只有一个输入的行，但我需要一些帮助来找出一种通过输入名称获取值的方法。

这是表格行的示例。我如何通过他们的 id 访问这两个字段？

```
<table id="tblOne">
<tr>
<td>
    <asp:HiddenField id="hdnfld_Id" Text='<% Eval("ID") %>'></asp:HiddenField>
</td>
<td>
    <asp:HiddenField id="hdnfld_Id2" Text='<% Eval("ID2") %>'></asp:HiddenField>
</td>
</tr> 
</table> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-11-10T15:48:33.007

我通常使用正向查找来匹配 id，这种方法避免需要客户端 id

(id 包含 foo) $(this).find("input[id*='foo']").val();

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T15:17:04.427

你可以这样做：

```
 $("#tblOne").find("tr").click(function() {
        var election = $(this).find("td").eq(0).html();
        var worker = $(this).find('input[name=theName]').val();
    }); 
```

通读本杰明·斯特林（Benjamin Sterling）的这篇出色的文章[“如何使用 jQuery 获得你想要的东西”。](http://benjaminsterling.com/jquery-select-what-you-want-part-1/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-31T17:57:29.347

使用您现在设置的方式，您可以执行以下操作：

```
$('tr td', '#tblOne').eq(0).find(':input').val(); // find input in 1st TD
$('tr td', '#tblOne').eq(1).find(':input').val(); // find input in 2nd TD 
```

使用它，您不必担心输入的 ClientID。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-08-26T13:27:29.747

你为什么不简单地使用这个：

```
jQuery("#<%=hdnfld_Id.ClientID%>") 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-31T17:53:20.087

`<asp:HiddenField id="foo">`生成一个`<input type="hidden" id="foo"/>`不是吗？你为什么不做

```
$("#foo").val() 
```

?

我认为您需要解释一下您要做得更好的事情。如果你发现

```
$(this).find(":input").val(); 
```

...仅当您有一个输入时才有效，也许您正在寻找的是：

```
$(this).find(":input").each(function() {
  // Prints the value of each input.
  alert($(this).val());
} 
```

但就目前而言，你的问题不是很清楚。尝试编辑您的问题，并花时间准确地解释您想要什么。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-12-22T02:46:04.553

不是答案，但我在从表格单元格中提取隐藏字段值时遇到了难以置信的困难（当然使用该表格上的 tablesorter），所以我很高兴找到这行代码：

$(this).find(":input").val();

而且效果很好。

我也使用“.live”函数，所以它甚至可以在大桌子上使用。

谢谢你！！！

HLR

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-02-01T20:32:13.847

我有三个选项卡，每个选项卡都有一个提交按钮，导致回发。在提交按钮的单击事件之后，我希望当前选项卡保持不变。

第1步。

在标签 div 中添加了一个**asp:HiddenField**（“标签” div 包含所有三个包含我的标签内容的 div）。

```
<asp:HiddenField ID="sel_tab" Value="" runat="server" /> 
```

第2步。

使用导致回发的每个按钮的单击事件更新了**sel_tab**的值。

```
protected void cmdSaveDailyMeasure_Click(object sender, EventArgs e)
{
    sel_tab.Value = "0";
}
protected void cmdSaveWeeklyMeasure_Click(object sender, EventArgs e)
{
    sel_tab.Value = "1";
}
protected void cmdSaveMonthlyMeasure_Click(object sender, EventArgs e)
{
    sel_tab.Value = "2";
} 
```

第 3 步。在我的**.js**文件中，我有以下代码

```
// Tabs
$(document).ready(function() {
    var iSelectedTab = $(this).find("input[id*='sel_tab']").val();
    if (iSelectedTab == null)
        iSelectedTab = 0;    
    $('[id$=tabs]').tabs({ selected: iSelectedTab });
}); 
```

即使您使用母版页（我是），这也有效。不需要 <%=foo.ClientID%> 部分。

# asp.net - Google 地图信息窗口中的 ASP.NET 代码

> ID：701479
> 
> 赞同：1
> 
> 时间：2009-03-31T15:09:16.050
> 
> 标签：asp.net, google-maps

**澄清：**

简而言之，我想在 Google Maps 的信息窗口中放置一个 ASP.NET UpdatePanel。这意味着用户可以在信息窗口中与我的应用程序交互，而无需刷新页面，也无需关闭当前打开的信息窗口。

有谁知道这是否可能？

* * *

**更新：**

感谢所有到目前为止做出回应的人。非常感谢。

我从答案中了解到的是：

*   更新面板有它自己的“神秘机制”，这可能会导致 UpdatePanel 在 InfoWindow 中无法正常工作。使用 JQuery 对简单的 Web 服务进行 ajax 调用这一更直接的路线应该消除 UpdatePanel 隐藏的复杂性并启用我想要的功能。

我仍然对为什么 UpdatePanel 方法不起作用以及为什么使用 UpdatePanel 方法会“破坏 Google Maps 的模型”很感兴趣，而 UpdatePanel 肯定只是呈现为 HTML 和 javascript 并带有指向 XMLHttpRequest 对象的链接。

* * *

是否可以将 ASP.NET 代码放置在 Google 地图信息窗口中？

我想在信息窗口内放置一个带有一些 AJAXified asp:Button 的 UpdatePanel。

AFAICT 您只需提供 HTML 作为字符串放置在信息窗口中，因此正在考虑将 UserControl 呈现为字符串并将该字符串放置在信息窗口中以供浏览器呈现。有谁知道这是否可行？

如果这在谷歌地图中是不可能的，有没有人知道这样的实现是否可以通过相应的虚拟地球技术实现？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-21T12:40:43.943

VirtualEarth 与 SilverLight 紧密集成，这意味着您将对 Web 地图应用程序拥有更大的 .NET 控制。对于我们已经完成的大多数 Google 地图实现，我们通常只使用纯 HTML/JavaScript/CSS 解决方案来创建 AJAX 功能。因此，我们会将 HTML/javascript 注入 InfoWindow 类，以实现我们需要的任何自定义功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-22T08:43:53.957

何塞·巴西利奥是对的。取而代之的是，使用 $jquery Live Events 并将常规 HTML 放入信息窗口中，然后使用带有 jQ​​uery 的 Ajax 调用来获得您想要的交互性。重新定义问题。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-27T04:47:40.353

考虑另一种方法和可能。您真正需要的是能够响应服务器端事件。如果您确实需要响应服务器端事件，可能会出现这样的情况。

[http://windyroad.org/2006/07/25/event-driven-ajax-part-1-pushing-server-side-events/](http://windyroad.org/2006/07/25/event-driven-ajax-part-1-pushing-server-side-events/)

一旦你在 javascript 中处理客户端上的事件，你就可以对地图做任何你喜欢的事情

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-22T14:00:17.580

我不确定我是否会采用这种方法，但如果您想在信息窗口中获取 ASP.NET 代码，您可以使用 iframe。

或者，您是否考虑过像[GoogleMap Control](http://www.codeplex.com/googlemap)这样的 ASP.NET 控件，它可以为您处理所有集成？

富有的

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-27T04:52:20.820

更新面板！= AJAX。看看使用 jQuery 进行 Ajax 调用 ($.ajax) 并创建简单的 Web 服务/等。去实现你所追求的。虽然从技术上讲，您可以以某种方式将 UpdatePanel 摆动到那里，但这并不值得。

[在此处](http://encosia.com/2009/04/07/using-complex-types-to-make-calling-services-less-complex/)查看有关使用 jQuery 调用 AJAX/web 方法的优秀示例。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-29T19:29:33.170

你看过[ExtInfoWindow](http://gmaps-utility-library.googlecode.com/svn/trunk/extinfowindow/release/docs/reference.html)控件吗？由于你没有说明你的问题，我不能说它是否是一个解决方案，但似乎应该在这里提到它。

# c# - 将代码 C# 转换为 VB - 函数引用

> ID：701501
> 
> 赞同：0
> 
> 时间：2009-03-31T15:12:02.130
> 
> 标签：c#, vb.net

我有一些 C# 代码正在尝试转换为 VB.NET。我在每个项目中都引用了一些外部依赖项。C# 行是

```
TWriteFileCommand writeFile = (TWriteFileCommand)CommunicationLink.CreateCommand(TOPKernel.TCommand.CommandType.WriteFile); 
```

我真的不明白等号后括号中的 TWriteFileCommand 在该语句中是什么意思。当我尝试在 VB.NET 中执行此操作时，我不断收到错误，因为我无法获得对 CreateCommand 函数的引用。我得到的最接近的是：

```
Dim MyAppBase As OPSupport.App.AppBase
Dim writeFile As TWriteFileCommand
writeFile = MyAppBase.CommunicationLink.CreateCommand(TOPKernel.TCommand.CommandType.WriteFile) 
```

但是，我在等号 @MyAppBase 之后有一个绿色下划线，它标记了一个错误“变量 MyAppBase 在被赋值之前被使用。在运行时可能会导致空引用异常。”

我错过了什么？为什么在 C# 代码中实例很好，我需要什么才能在 VB.NET 中获取等效实例？请指教。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T15:14:33.700

那是一个演员；如果`CreateCommand`返回`object`,`CommandBase`或类似的东西 - 它会对`TWriteFileCommand`.

如果您有编译 C# 代码 - 您可以使用反射器进行翻译吗？这向您展示了 C# 和等效的 VB 在下拉列表中的翻转。

我不确定`MyAppBase`它在做什么；C# 中不存在的 - 为什么将它添加到 VB 中？

**编辑**我不“做”VB，但我在反射器中查找了它；`(Foo)bar`变成`DirectCast(bar, Foo)`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-31T15:15:46.300

它看起来像是类型`CreateCommand`中的静态方法`CommunicationLink`。要么，要么有一个名为 的属性`CommunicationLink`，并且它的类型有一个`CreateCommand`方法。

= 之后括号中的位是强制转换。使用`CType`或`DirectCast`在 VB.NET 中执行此操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T15:14:58.907

这`()`是 C# 从一种类型转换为另一种类型的方法之一。VB 等价物是`CType()`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T15:27:34.977

直接等价物是：

```
Dim writeFile As TWriteFileCommand 
writeFile = DirectCast(CommunicationLink.CreateCommand(TOPKernel.TCommand.CommandType.WriteFile), TWriteFileCommand) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T15:15:17.207

CommunicationLink 变量在 C# 代码中贴标*和实例化的位置在哪里？*您需要确保 VB 代码对该对象使用相同的源。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-31T15:15:44.587

我真的看不出它是`Dim MyAppBase As OPSupport.App.AppBase`从哪里来的。

就`(TWriteFileCommand)`目前而言，这是一种类型转换。`DirectCast`具有（几乎？）相同的功能。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-31T15:17:22.803

这是因为您没有将变量值分配给 MyAppBase :-)

```
Dim MyAppBase As OPSupport.App.AppBase = new OPSupport.App.AppBase()
Dim writeFile As TWriteFileCommand
writeFile = MyAppBase.CommunicationLink.CreateCommand(TOPKernel.TCommand.CommandType.WriteFile) 
```

?

# java - 透视投影：确定 3D 空间 (x,y,z) 中点的 2D 屏幕坐标 (x,y)

> ID：701504
> 
> 赞同：16
> 
> 时间：2009-03-31T15:12:31.863
> 
> 标签：java, opengl, projection

我希望确定 3D 空间 (x,y,z) 中点的 2D 屏幕坐标 (x,y)。

我希望投影的点是由 GPS 坐标和海拔高度表示的真实世界点。

例如：点（纬度：49.291882，经度：-123.131676，高度：14m）

相机位置和高度也可以确定为 ax,y,z 点。我还有相机的航向（罗盘度数），它的倾斜度（高于/低于地平线）和滚动（围绕 z 轴）。

我没有 3D 编程的经验，因此，我阅读了透视投影的主题，并了解到它需要矩阵、变换等知识——所有这些目前都让我感到困惑。

有人告诉我，OpenGL 可用于构建真实世界点的 3D 模型、设置相机方向并检索 3D 点的 2D 坐标。

但是，我不确定使用 OpenGL 是否是解决此问题的最佳方法，即使我不知道如何创建模型、设置相机等

有人可以建议解决我的问题的最佳方法吗？如果 OpenGL 是一个可行的解决方案，我将不得不使用 OpenGL ES，如果这有什么不同的话。哦，无论我选择什么解决方案，它都必须快速执行。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-31T16:50:01.037

这是一个非常笼统的答案。假设相机在 (Xc, Yc, Zc) 并且您要投影的点是 P = (X, Y, Z)。从相机到您要投影到的 2D 平面的距离为 F（因此平面方程为 Z-Zc=F）。P 投影到平面上的二维坐标为 (X', Y')。

然后，非常简单：

X' =​​ ((X - Xc) * (F/Z)) + Xc

Y' = ((Y - Yc) * (F/Z)) + Yc

如果您的相机是原点，那么这将简化为：

X' =​​ X * (F/Z)

Y' = Y * (F/Z)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-31T15:36:21.010

您确实需要[透视投影](http://en.wikipedia.org/wiki/Perspective_projection#Perspective_projection)，并且[矩阵运算](http://en.wikipedia.org/wiki/Transformation_matrix)大大简化了这样做。我假设您已经知道您的[球坐标](http://en.wikipedia.org/wiki/Spherical_coordinates)必须转换为[笛卡尔坐标](http://en.wikipedia.org/wiki/Cartesian_coordinate_system)才能进行这些计算。

[与滚动您自己的软件光栅化器相比](http://en.wikipedia.org/wiki/Rasterisation)，使用[OpenGL](http://www.opengl.org/documentation/)可能会为您节省大量工作。所以，我建议先[尝试一下](http://nehe.gamedev.net/)。您可以在 PC 上对您的系统进行原型设计，因为只要您保持简单，OpenGL ES 并没有太大的不同。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-31T15:42:00.420

如果只需要计算一些点的坐标，你应该只需要一些代数技能，而不是使用 openGL 进行 3D 编程。

此外**，openGL 不处理地理坐标**

首先获取一些关于[WGS84](http://en.wikipedia.org/wiki/WGS84)和测地坐标的文档，您必须首先将 GPS 数据转换为笛卡尔坐标系（例如定义为 WGS84 椭球的地心笛卡尔坐标系）。

然后可以进行矩阵计算。转换链大致是：

*   WGS84
*   地心坐标
*   一些局部框架
*   相机框架
*   二维投影

对于第一次转换，请参见[最后](http://en.wikipedia.org/wiki/Geodetic_system#Conversion) 一个涉及投影矩阵其他只是坐标旋转和平移。“某个局部框架”是局部笛卡尔框架，其原点是与椭圆体相切的相机位置。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-31T16:41:32.960

我推荐 Eric Lengyel 的“3D 游戏编程和计算机图形学的数学”。它涵盖了矩阵、变换、视锥、透视投影等。

The OpenGL Programming Guide（红皮书）中还有一个很好的章节，介绍了查看转换和设置相机（包括如何使用 gluLookAt）。

如果您对显示 3D 场景不感兴趣并且仅限于使用 OpenGL ES，那么最好只编写自己的代码来进行从 3D 到 2D 窗口坐标的映射。作为起点，您可以下载[Mesa 3D](http://www.mesa3d.org)，一个 OpenGL 的开源实现，以了解它们如何实现 gluPerspective（设置投影矩阵）、gluLookAt（设置相机变换）和 gluProject（将 3D 点投影到 2D 窗口坐标）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-08-01T01:49:06.687

```
return [((fol/v[2])*v[0]+x),((fol/v[2])*v[1]+y)]; 
```

[0,0,1] 处的点将是 x=0 和 y=0，除非您添加中心屏幕 xy - 它不是相机 xy。fol 是焦距，来自 fov 角度和屏幕宽度 - 三角形（切线）有多高。此方法将不匹配three.js 透视矩阵，这就是我寻找它的原因。

我不应该寻找它。我在openGL上匹配了xy，就像超级胶水一样！但我无法让它在java中正常工作。完美的比赛随之而来。

```
var pmat = [0,0,0,0,0,0,0,0,0,0,
(farclip + nearclip) / (nearclip - farclip),-1,0,0,
2*farclip*nearclip / (nearclip - farclip),0 ];

void setpmat() {
  double fl; // = tan(dtor(90-fovx/aspect/2)); /// UNIT focal length
  fl = 1/tan(dtor(fov/Aspect/2)); ///  same number
  pmat[0]  = fl/Aspect;
  pmat[5]  = fl;
}
void fovmat(double v[],double p[]) {
  int cx = (int)(_Width/2),cy = (int)(_Height/2);
  double pnt2[4], pnt[4] = { 0,0,0,1 } ;
  COPYVECTOR(pnt,p);NORMALIZE(pnt);
  popmatrix4(pnt2,pmat,pnt);
  COPYVECTOR(v,pnt2);
  v[0] *= -cx; v[1] *= -cy;
  v[0] += cx; v[1] += cy;
}  // world to screen matrix
void w2sm(int xy[],double p[]) {
    double v[3]; fovmat(v,p);
    xy[0] = (int)v[0];
    xy[1] = (int)v[1];
} 
```

我还有另一种方法来匹配three.js xy，直到我得到矩阵工作，只有一个条件。必须以 Aspect of 2 运行

```
function w2s(fol,v,x,y) {
    var a = width / height;
    var b =  height/width ;
    /// b = .5 // a = 2
    var f = 1/Math.tan(dtor(_fov/a)) * x * b;
    return [intr((f/v[2])*v[0]+x),intr((f/v[2])*v[1]+y)];
} 
```

将它与倒置相机矩阵一起使用，您将需要 invert_matrix()。

```
 v = orbital(i);
    v = subv(v,campos);
    v3 = popmatrix(wmatrix,v); //inverted mat
    if (v3[2] > 0) {
    xy = w2s(flen,v3,cx,cy); 
```

终于到了，（现在每个人都应该知道）无矩阵匹配，任何方面。

```
function angle2fol(deg,centerx) {
    var b = width / height;
    var a = dtor(90 - (clamp(deg,0.0001,174.0) / 2));
    return asa_sin(PI_5,centerx,a) / b;
}
function asa_sin(a,s,b) {
    return Math.sin(b) * (s / Math.sin(PI-(a+b)));
} // ASA solve opposing side of angle2 (b)
function w2s(fol,v,x,y) {
    return [intr((fol/v[2])*v[0]+x),intr((fol/v[2])*v[1]+y)];
} 
```

更新了证明的图像。输入 _fov 得到 1.5，“大约”。要正确查看 FOV 读数，请使用新焦距重做三角形。

```
function afov(deg,centerx) {
    var f = angle2fol(deg,centerx);
    return rtod(2 * sss_cos(f,centerx,sas_cos(f,PI_5,centerx)));
}
function sas_cos(s,a,ss) {
    return Math.sqrt((Math.pow(s,2)+Math.pow(ss,2))-(2*s*ss*Math.cos(a)));
} // Side Angle Side - solve length of missing side
function sss_cos(a,b,c) {
    with (Math) {
        return acos((pow(a,2)+pow(c,2)-pow(b,2))/(2*a*c));
    }
} // SSS solve angle opposite side2 (b) 
```

星库确认了视角，那么就可以测量VIEW了！[http://innerbeing.epizy.com/cwebgl/perspective.jpg](http://innerbeing.epizy.com/cwebgl/perspective.jpg)

我可以用一个词岁差来解释月球北极90度的校正。那么当前的向上向量是多少。点？拉德克？

```
function ininorths() {
    if (0) {
        var c = ctime;
        var v = LunarPos(jdm(c));
        c += secday();
        var vv = LunarPos(jdm(c));
        vv = crossprod(v,vv);
        v = eyeradec(vv);
        echo(v,vv);
        v = [266.86-90,65.64]; //old
    }
    var v = [282.6425,65.8873]; /// new.
    // ...
} 
```

我还没有解释两组向量：Three.milkyway.matrix 和 3D 到 2D 绘图。他们是：

```
function drawmilkyway() {
  var v2 = radec2pos(dtor(192.8595), dtor(27.1283),75000000);
  // gcenter 266.4168 -29.0078
  var v3 = radec2pos(dtor(266.4168), dtor(-29.0078),75000000);
 // ...
}
function initmwmat() {
    var r,u,e;
    e = radec2pos(dtor(156.35), dtor(12.7),1);
    u = radec2pos(dtor(60.1533), dtor(25.5935),1);
    r = normaliz(crossprod(u,e));
    u = normaliz(crossprod(e,r));
    e = normaliz(crossprod(r,u));
    var m = MilkyWayMatrix;
    m[0]=r[0];m[1]=r[1];m[2]=r[2];m[3]=0.0;
    m[4]=u[0];m[5]=u[1];m[6]=u[2];m[7]=0.0;
    m[8]=e[0];m[9]=e[1];m[10]=e[2];m[11]=0.0;
    m[12]=0.0;m[13]=0.0;m[14]=0.0;m[15]=1.0;
}
/// draw vectors and matrix were the same in C !
void initmwmat(double m[16]) {
  double r[3], u[3], e[3];
  radec2pos(e,dtor(192.8595), dtor(27.1283),1); //up
  radec2pos(u,dtor(266.4051), dtor(-28.9362),-1); //eye
} 
```

# bash - 从 shell 脚本中的目录中选择随机文件的最佳方法

> ID：701505
> 
> 赞同：53
> 
> 时间：2009-03-31T15:12:36.497
> 
> 标签：bash, file, shell, random

从 shell 脚本中的目录中选择随机文件的最佳方法是什么？

这是我在 Bash 中的解决方案，但我对在 Unix 上使用的更便携（非 GNU）版本非常感兴趣。

```
dir='some/directory'
file=`/bin/ls -1 "$dir" | sort --random-sort | head -1`
path=`readlink --canonicalize "$dir/$file"` # Converts to full path
echo "The randomly-selected file is: $path" 
```

有人有其他想法吗？

**编辑：** lhunath 对 parsing 提出了一个很好的观点`ls`。我想这取决于你是否想要便携。如果你有 GNU findutils 和 coreutils 那么你可以这样做：

```
find "$dir" -maxdepth 1 -mindepth 1 -type f -print0 \
  | sort --zero-terminated --random-sort \
  | sed 's/\d000.*//g/' 
```

唷，这很有趣！由于我说的是“随机文件”，它也更符合我的问题。老实说，现在很难想象一个 Unix 系统部署在那里安装了 GNU 但没有安装 Perl 5。

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-03-31T16:49:26.233

```
files=(/my/dir/*)
printf "%s\n" "${files[RANDOM % ${#files[@]}]}" 
```

并且**不要解析 ls**。读[http://mywiki.wooledge.org/ParsingLs](http://mywiki.wooledge.org/ParsingLs)

编辑：祝你好运找到一个`bash`可靠的非解决方案。大多数文件名会因某些类型的文件名而中断，例如带有空格或换行符或破折号的文件名（这在 pure 中几乎是不可能的`sh`）。要在没有. `bash`_`awk``perl``python`

* * *

## 回答 #2

> 赞同：35
> 
> 时间：2013-04-02T01:57:06.987

“shuf”不是便携的吗？

```
shuf -n1 -e /path/to/files/* 
```

或查找文件是否比一个目录更深：

```
find /path/to/files/ -type f | shuf -n1 
```

它是 coreutils 的一部分，但您需要 6.4 或更高版本才能获得它……所以 RH/CentOS 不包含它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-31T15:22:38.767

就像是：

```
let x="$RANDOM % ${#file}"
echo "The randomly-selected file is ${path[$x]}" 
```

`$RANDOM`在 bash 中是一个返回随机数的特殊变量，然后我使用模除法来获取有效索引，然后在数组中引用该索引。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-11-06T11:31:03.873

```
# ******************************************************************
# ******************************************************************
function randomFile {
  tmpFile=$(mktemp)

  files=$(find . -type f > $tmpFile)
  total=$(cat "$tmpFile"|wc -l)
  randomNumber=$(($RANDOM%$total))

  i=0
  while read line;  do
    if [ "$i" -eq "$randomNumber" ];then
      # Do stuff with file
      amarok $line
      break
    fi
    i=$[$i+1]
  done < $tmpFile
  rm $tmpFile
} 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-31T15:26:31.813

这归结为：如何以可移植的方式在 Unix 脚本中创建随机数？

因为如果你有一个介于 1 和 N 之间的随机数，你可以用`head -$N | tail`它在中间的某个地方切。不幸的是，我不知道仅使用外壳就可以做到这一点的便携方法。如果你有 Python 或 Perl，你可以很容易地使用它们的随机支持，但是 AFAIK，没有标准`rand(1)`命令。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-31T17:37:44.573

我认为 awk 是获取随机数的好工具。根据[Advanced Bash Guide](http://www.faqs.org/docs/abs/HTML/randomvar.html)，Awk 是一个很好的随机数替代品`$RANDOM`。

这是您的脚本的一个版本，它避免了 Bash-isms 和 GNU 工具。

```
#! /bin/sh

dir='some/directory'
n_files=`/bin/ls -1 "$dir" | wc -l | cut -f1`
rand_num=`awk "BEGIN{srand();print int($n_files * rand()) + 1;}"`
file=`/bin/ls -1 "$dir" | sed -ne "${rand_num}p"`
path=`cd $dir && echo "$PWD/$file"` # Converts to full path.  
echo "The randomly-selected file is: $path" 
```

如果文件包含换行符，它继承了其他答案提到的问题。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-06-26T12:15:14.890

可以通过在 Bash 中执行以下操作来避免文件名中的换行：

```
#!/bin/sh

OLDIFS=$IFS
IFS=$(echo -en "\n\b")

DIR="/home/user"

for file in $(ls -1 $DIR)
do
    echo $file
done

IFS=$OLDIFS 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-07-19T12:55:09.383

这是一个仅依赖于 POSIX 功能并处理任意文件名的 shell 片段（但从选择中省略了点文件）。随机选择使用 awk，因为这就是您在 POSIX 中获得的全部内容。这是一个非常糟糕的随机数生成器，因为 awk 的 RNG 是以秒为单位的当前时间播种的（所以它很容易预测，如果你每秒调用多次，它会返回相同的选择）。

```
set -- *
n=$(echo $# | awk '{srand(); print int(rand()*$0) + 1}')
eval "file=\$$n"
echo "Processing $file" 
```

如果您不想忽略点文件，则`set -- *`需要将文件名生成代码 ( ) 替换为更复杂的内容。

```
set -- *; [ -e "$1" ] || shift
set .[!.]* "$@"; [ -e "$1" ] || shift
set ..?* "$@"; [ -e "$1" ] || shift
if [ $# -eq 0]; then echo 1>&2 "empty directory"; exit 1; fi 
```

如果您有可用的 OpenSSL，则可以使用它来生成随机字节。如果您没有，但您的系统有`/dev/urandom`，请替换对`openssl`by的调用`dd if=/dev/urandom bs=3 count=1 2>/dev/null`。这是一个设置`n`为 1 和 之间的随机值的片段，`$#`注意不要引入偏差。此片段假定`$#`最多为 2^23-1。

```
while
  n=$(($(openssl rand 3 | od -An -t u4) + 1))
  [ $n -gt $((16777216 / $# * $#)) ]
do :; done
n=$((n % $#)) 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2015-04-08T17:04:46.797

BusyBox（用于嵌入式设备）通常配置为支持`$RANDOM`，但它没有 bash 样式的数组或`sort --random-sort`or `shuf`。因此如下：

```
#!/bin/sh
FILES="/usr/bin/*"
for f in $FILES; do  echo "$RANDOM $f" ; done | sort -n | head -n1 | cut -d' ' -f2- 
```

注意后面的“-” `cut -f2-`；这是避免截断包含空格（或您要使用的任何分隔符）的文件所必需的。

它不会正确处理带有嵌入换行符的文件名。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-02-16T10:44:56.643

将命令“ls”的每一行输出放入一个名为 line 的关联数组中，然后选择其中一个...

```
ls | awk '{ line[NR]=$0 } END { print line[(int(rand()*NR+1))]}' 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2018-11-23T16:33:50.470

我的 2 美分，当存在带有特殊字符的文件名时，该版本不应中断：

```
#!/bin/bash --
dir='some/directory'

let number_of_files=$(find "${dir}" -type f -print0 | grep -zc .)
let rand_index=$((1+(RANDOM % number_of_files)))

printf "the randomly-selected file is: "
find "${dir}" -type f -print0 | head -z -n "${rand_index}" | tail -z -n 1
printf "\n" 
```

# c# - 禁止 Outlook 字段打印

> ID：701508
> 
> 赞同：4
> 
> 时间：2009-03-31T15:13:09.647
> 
> 标签：c#, outlook

我们为 Outlook 编写了一个插件，可以将电子邮件归档到我们的 CRM 系统中。在此过程中，它将 Outlook 邮件 ID 保存为邮件本身的 UserField。

例如。

```
currentUserProperty = Constants.APPLICATION_NAME + "EntryID";
mailItem.UserProperties.Add(currentUserProperty,
       Microsoft.Office.Interop.Outlook.OlUserPropertyType.olText,
       Missing.Value,
       Missing.Value).Value = entryId; 
```

不幸的是，这是一个 HUUUGGEE 号码，很像：

**“00000000D502D779150E2F4580B1AADDF04ECDA6070097EF5A1237597748A4B4F9BFF540020800000006E9E4000068BB5B6DFC36924FAEC709A17D056583000002DE0E30”**

问题是，当用户打印消息时，Outlook 坚持包含此字段（在 From/To 下方），并且由于它没有空格，因此无法包装 ID 并压缩 A4 页面，直到它可以水平放置。这会产生很小的电子邮件打印输出。

有什么办法可以纠正这个吗？我曾想过用空格分隔的字段覆盖 OriginalEntryID （这是导致问题的那个），但我从 COM 层得到一个异常。我的下一站是尝试在 Outlook 固定设备上抑制此字段和其他用户定义字段的输出。

有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2011-06-23T17:16:53.813

您必须使用**.NET Reflection**来解决此问题（*按照 Microsoft 支持的建议*）。希望这将在未来版本的 VSTO SDK 中得到修复。

### 禁止 Outlook 用户字段打印

```
static void SuppressUserPropertyPrinting(Outlook.MailItem message)
{
    try
    {   // Late Binding in .NET: https://support.microsoft.com/en-us/kb/302902
        Type userPropertyType;
        long dispidMember = 107;
        long ulPropPrintable = 0x4; // removes PDO_PRINT_SAVEAS
        string dispMemberName = String.Format("[DispID={0}]", dispidMember);
        object[] dispParams;

        if (message.UserProperties.Count == 0) return; // no props found (exit)

        // marks all user properties as suppressed
        foreach (Outlook.UserProperty userProperty in message.UserProperties.Cast<Outlook.UserProperty>())
        {
            if (userProperty == null) continue; // no prop found (go to next)
            userPropertyType = userProperty.GetType(); // user property type

            // Call IDispatch::Invoke to get the current flags
            object flags = userPropertyType.InvokeMember(dispMemberName, BindingFlags.GetProperty, null, userProperty, null);
            long lFlags = long.Parse(flags.ToString()); // default is 45 - PDO_IS_CUSTOM|PDO_PRINT_SAVEAS|PDO_PRINT_SAVEAS_DEF (ref: http://msdn.microsoft.com/en-us/library/ee415114.aspx)

            // Remove the hidden property Printable flag
            lFlags &= ~ulPropPrintable; // change to 41 - // PDO_IS_CUSTOM|PDO_PRINT_SAVEAS_DEF (ref: http://msdn.microsoft.com/en-us/library/ee415114.aspx)

            // Place the new flags property into an argument array
            dispParams = new object[] { lFlags };

            // Call IDispatch::Invoke to set the current flags
            userPropertyType.InvokeMember(dispMemberName, BindingFlags.SetProperty, null, userProperty, dispParams);
        }
    }
    catch { } // safely ignore if property suppression doesn't work
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T16:24:41.417

我认为这可能对我有帮助：

[http://www.add-in-express.com/forum/read.php?FID=5&TID=5071#postform](http://www.add-in-express.com/forum/read.php?FID=5&TID=5071#postform)

# c# - 在 n 列之间划分内容的最佳方法是什么？

> ID：701509
> 
> 赞同：1
> 
> 时间：2009-03-31T15:13:34.777
> 
> 标签：c#, asp.net, html, css

我已经阅读了这篇出色[的多列列表文章](http://www.alistapart.com/articles/multicolumnlists)，以及[关于 SO 的这个问题](https://stackoverflow.com/questions/486349/dividing-long-list-of-li-tags-into-columns)。我得出的结论是，没有跨浏览器的方法可以将一个长的无序列表变成*n*列等长。到目前为止，我已经简化为这样的多 ul 解决方案：

```
//Three columns.
string col1 = string.Empty;
string col2 = string.Empty;
string col3 = string.Empty;
int currItem = 0;
int collectionCount = myItemCollection.Count;

foreach item in myItemCollection {
  currItem++;
  if (currItem < collectionCount * .33)
  {
    col1 = col1 + item.someProperty
  } 
  else if (currItem < collectionCount * .67)  
  {
    col2 = col2 + item.someProperty
  } 
  else
  {
    col3 = col3 + item.someProperty
  }
}

string allColumns = @"<ul>" + col1 + "</ul><ul>"
                      col2 + "</ul><ul>" + col3 + "</ul>";

Response.Write(allColumns); 
```

有没有一种更简单的方法可以将我的列表分成三组，或者更好的是，当元素是“第三”中的最后一项时，只需编写适当的结束/开始 ul 标记？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T15:37:57.247

这就是我个人选择实现它的方式。

```
const int numColumns = 3;
const int numColumns = 3;
var columnLength = (int)Math.Ceiling((double)myItemCollection.Count / 3);

for (int i = 0; i < myItemCollection.Count; i++)
{
    if (i % columnLength == 0)
    {
        if (i > 0)
            Response.Write("</ul>");
        Response.Write("<ul>");
    }
    Response.Write(myItemCollection[i].SomeProperty);
}

if (i % columnLength == 0)
    Response.Write("</ul>"); 
```

您完全避免了字符串连接（当您只是写入流时确实没有必要，如果您不想 xse `StringBuilder`）以及那些可能导致长列表不准确的讨厌的浮点操作（至少它们是不必要的）。

无论如何，希望对您有所帮助...

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T18:04:19.577

这为时已晚，但 Response.Write 将在不可预测的地方输出，很可能在所有其他输出之前。

“正确”的代码应该在 CreateChildren、Page_Load 或任何其他地方构建控件：

```
List<string> items = new List<string>() { "aaa", "bbb", "ccc", "ddd", "eee" };
int colSize = (int)Math.Ceiling(items.Count / 3.0);

HtmlGenericControl ul = null;
for (int i = 0; i < items.Count; i++)
{
    if (i % colSize == 0)
    {
        ul = new HtmlGenericControl("ul");
        Page.Form.Controls.Add(ul);
    }

    HtmlGenericControl li = new HtmlGenericControl("li");
    li.InnerText = items[i];
    ul.Controls.Add(li);
} 
```

这样您就无需担心呈现和跟踪打开/关闭标签。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T15:29:51.040

如果它是一个无序列表，你可以将 <li> 向左浮动，并给它一个略小于 (100 / n)% 的宽度

# .net - .net 代码将电子邮件读入 sql 数据库

> ID：701512
> 
> 赞同：2
> 
> 时间：2009-03-31T15:14:17.863
> 
> 标签：.net, asp.net, email

我正在寻找一些链接和/或代码片段，这些链接和/或代码片段将允许一个 asp.net 网页（或者一个 Outlook 加载项）允许我阅读发送到特定电子邮件地址的电子邮件，然后解析电子邮件将消息分成组成部分（即主题、正文、附件等）并保存到我的数据库中。

基本的主题行和内容是最重要的，但我也希望能够遍历附件和任何内嵌图像，然后解构这些片段并保存到 sql 数据库中，以便可以重建消息。

我本质上想要完成的是将某些“重要”电子邮件转发到非人类电子邮件地址的方法，让我的应用程序挑选这些部分，然后保存到 SQL Server 数据库，然后将它们重新发布到网站- 用于存档目的。

有什么图书馆或链接可以让这一切变得尽可能轻松，并让我不再重新发明这个轮子吗？

编辑：我使用的电子邮件是一个普通的 pop3 帐户，而不是交换，如果这有区别的话。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T15:24:23.520

我也听说过关于[mime4net的好消息](http://www.mime4.net/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T15:20:15.400

Chilkat 做了一个您可能会觉得有用的 POP3 组件：http: [//www.chilkatsoft.com/email-dotnet.asp](http://www.chilkatsoft.com/email-dotnet.asp)

如果您对 Visual Studio Tools for Microsoft Office [http://www.add-in-express.com/感到不够勇敢，Addin-Express 会对 Outlook 进行出色的包装](http://www.add-in-express.com/)

# c - 使用 time.h 在 C 中获取当前小时

> ID：701524
> 
> 赞同：6
> 
> 时间：2009-03-31T15:15:19.767
> 
> 标签：c, time

新手问题在这里；我提前道歉。

假设我有一个用 C 语言编写的守护程序，它每五分钟左右唤醒一次，如果它的输入队列中有任何内容，它会进行一些处理，然后重新进入睡眠状态。现在假设有一些处理只需要在某个（可配置的）时间之后进行——比如说，下午 2 点（午夜之前）。

在 C 中，将当前时间的小时数转换为 int 变量的最快、最好的方法是什么，以便可以轻松地检查它——以确定实际上是否是在今天下午 2 点之后？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-31T15:16:11.073

当地时间。见[http://linux.die.net/man/3/localtime](http://linux.die.net/man/3/localtime)

```
time_t now = time(NULL);
struct tm *tm_struct = localtime(&now);

int hour = tm_struct->tm_hour; 
```

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2014-02-26T03:19:09.483

电话`localtime(time(NULL))`永远不会奏效。的返回值`time()`是 a `time_t`，localtime 的第一个参数是 a `time_t*`。既不是公认的答案，也不是 printf 正确的答案。

```
time_t now;
struct tm *now_tm;
int hour;

now = time(NULL);
now_tm = localtime(&now);
hour = now_tm->tm_hour; 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-31T15:19:53.407

```
printf("the hour is %d\n", localtime(time(NULL))->tm_hour); 
```

`localtime()`这依赖于返回指向静态存储的指针这一事实。

# asp.net - 用于asp.net的rbac？

> ID：701536
> 
> 赞同：2
> 
> 时间：2009-03-31T15:17:43.037
> 
> 标签：asp.net, rbac

是否有用于 asp.net 的开放式 rbac 框架？Rails 有一些解决方案，但我找不到用于 asp.net 的简单 rbac 系统。有什么可以使用和扩展的吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T15:21:30.517

[这篇文章](http://www.developerdotstar.com/community/node/482)看起来是一个不错的起点（最好深入了解作者引用的链接以获取更多信息，但请确保您也阅读了这篇文章）：

> **在 .Net 上实现 RBAC**：
> 
> 最近我在 .Net 中研究 RBAC（基于角色的访问控制）实现。关于这个主题的全面工作由 Mark Strembeck XoRBAC 主页 RBAC 概念的详细信息可以在 NIST RBAC 找到
> 
> 虽然 Strembeck 工作中给出的设计方法足够全面，可以在 .Net 上实现，但默认实现（在 XoTcl 上完成）使用了该语言的广泛模式（例如，将对象用作类的能力！），因此可以快速移植在我当前的项目中，要完成设计的完整 .Net 实现将需要付出一些努力。好吧，我没有实施该解决方案，而是选择了 MS 授权管理器（我知道人们会说，Dah ......那本来就很简单）。这是 Windows 2003 和 2000 上提供的小型库和管理控制台，可实现大部分 RBAC 要求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T15:20:40.500

也许我在这里错过了重点，但是 ASP.NET 附带了一个非常强大的角色提供程序框架——如果你真的不想使用它附带的实现，它应该很容易找到许多开源实现。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-07-30T07:25:48.570

[在RBAC Wikipedia](https://en.wikipedia.org/wiki/Role-based_access_control)上找到了一篇关于 RBAC 的综合文章。我没有研究如何实现文章中提到的功能，而是试图找到允许像我这样的非技术人员在 asp.net 应用程序上应用安全性的安全框架，并找到了以下框架：

1.  传送门卫士
2.  视觉卫士
3.  会员保护

# performance - 每秒请求数和响应时间之间的相关性？

> ID：701537
> 
> 赞同：3
> 
> 时间：2009-03-31T15:17:44.207
> 
> 标签：performance, web-applications

有人可以解释每秒请求数和响应时间之间的相关性吗？你一开始想改进哪个？如果您的竞争对手在其最常用的功能上提供的“每秒请求数”少于您，那么您的应用程序在最终用户性能方面的表现是否更好？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-31T15:29:28.280

> 有人可以解释每秒请求数和响应时间之间的相关性吗？

**把这种情况想象成一个加油站。**汽车以不同的间隔到达并占用一个泵；他们花了一些时间填满，然后离开。

*   每一辆到达并占用一个泵的汽车都是一个请求。
*   填满所需的时间是您的响应时间。

您可以通过两种方式改进：

*   *如果您添加更多泵，*您可以一次为更多的汽车提供服务，因为容量会更大。
*   *如果你让所有的泵更快，*随着时间的推移，你可以用相同数量的泵为更多的汽车提供服务，因为每辆车都会更快地完成。

> 你一开始想改进哪个？

那要看。您是想更快地为人们服务（改善他们的体验，同时让其他人等待），从而总体上为更多的人服务，还是想一次为更多的人服务（可能会花费请求时间）？理想情况下，让这两个指标尽可能好。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T15:24:08.700

这完全取决于您的系统将承受什么样的负载。

如果您有数百万用户，那么您可能需要以牺牲响应时间为代价每秒处理更多请求，否则用户可能无法在需要时连接。

但是，如果您只有 30 个用户，那么对他们来说，您的系统响应速度比每秒处理一千个请求更重要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T15:26:03.780

每秒的请求可能很高，同时提供了糟糕的用户体验。您可能有很多用户每秒购买数千张音乐会门票，但每个用户的响应时间超过 30 秒。

对于一个高性能、令人愉快的网站，您需要每秒有大量的请求**和**最长的响应时间。作为用户，我喜欢 5 秒或更短的时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T15:24:36.123

> 如果您的竞争对手在其最常用的功能上提供的“每秒请求数”少于您，那么您的应用程序在最终用户性能方面的表现是否更好？

我不会同意的。看看谷歌。他们每秒发出数千个请求——见鬼，我认为这大约是每天 1 亿个，每月 30 亿个。

要回答您的问题，我认为响应时间比每秒请求数更重要。当然，您可以优化/最小化发出的请求数量，但如果您的产品可以扩展以处理无限的请求（只需在问题上投入更多硬件），那么我认为这更有价值。

# list - 如何删除/计算 s3 存储桶中的对象？

> ID：701545
> 
> 赞同：9
> 
> 时间：2009-03-31T15:20:07.977
> 
> 标签：list, amazon-s3, bucket

所以我知道这是一个常见问题，但似乎没有任何好的答案。

我有一个带有 gobs（我不知道有多少）文件的桶。它们都在2k以内。

1）我如何弄清楚我有多少这些文件**而不列出**它们？我使用了 s3cmd.rb、aws/s3 和 jets3t 的东西，我能找到的最好的方法是计算前 1000 条记录的命令（真正对它们执行GETS）。

我也一直在使用 jets3t 的小程序，因为它非常好用，但即使我无法列出所有对象，因为我的堆空间用完了。（大概是因为它正在对所有这些执行GETS并将它们保存在内存中）

2）我怎样才能删除一个桶？我见过的最好的事情是并行删除循环，它有问题，有时它会尝试删除同一个文件。这就是我遇到的所有“删除所有”命令的作用。

你们那些吹嘘托管数百万张图片/txt的人做了什么？当你想删除它时会发生什么？

3）最后，是否有其他答案？所有这些文件都是 txt/xml 文件，所以我什至不确定 S3 是否值得关注——也许我应该将其移至各种文档数据库？

归结为，亚马逊 S3 API 直接缺少 2 个非常重要的操作—— COUNT 和 DEL_BUCKET。（实际上有一个删除桶命令，但它只在桶为空时才有效）如果有人想出一种不糟糕的方法来执行这两个操作，我很乐意放弃很多赏金。

**更新**

只是为了回答几个问题。我问这个的原因是我在过去一年左右一直在存储数十万，更像是数百万个 2k txt 和 xml 文档。上一次，几个月前，我希望删除它确实需要 DAYS 天才能删除的存储桶，因为存储桶必须是空的，然后才能删除它。在没有 API 支持的情况下，我担心再次这样做是一件非常痛苦的事情。

**更新**

这把房子震撼了！

**[http://github.com/SFEley/s3nuke/](http://github.com/SFEley/s3nuke/)**

我在几分钟内就获得了价值 1-2k 文件的好几场演出。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-07-16T12:33:01.893

我肯定不是那些“吹嘘拥有数百万张图片/txt”的人之一，因为我只有几千张，这可能不是您要寻找的答案，但我看了一会儿背部。

据我记得，有一个名为 HEAD 的 API 命令获取有关对象的信息，而不是检索 GET 所做的完整对象，这可能有助于计算对象。

至于删除Buckets，我当时看的时候，API明确说bucket必须是空的，所以你需要先删除所有的对象。

但是，我从未使用过这些命令中的任何一个，因为我使用 S3 作为备份，最后我编写了一些例程将我想要的文件上传到 S3（所以这部分是自动化的），但从不打扰恢复/等式的删除/文件管理方面。为此，使用 Bucket Explorer 完成了我所需要的一切。就我而言，花 50 美元就可以得到一个满足我所有需要的程序，这不值得花时间。可能还有其他人做同样的事情（例如 CloudBerry）

在您的情况下，使用 Bucket Explorer，您可以右键单击存储桶并选择删除或右键单击并选择属性，它将计算对象的数量和它们占用的大小。它当然不会下载整个对象。（例如，我查看的最后一个存储桶是 12Gb 和大约 500 个文件，下载 12GB 需要几个小时，而大小和计数在一两秒内返回）。如果有限制，那么肯定不是 1000。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-22T06:28:30.223

“列表”不会检索数据。我使用 s3cmd（一个 python 脚本），我会做这样的事情：

```
s3cmd ls s3://foo | awk '{print $4}' | split -a 5 -l 10000 bucketfiles_
for i in bucketfiles_*; do xargs -n 1 s3cmd rm < $i & done 
```

但首先检查您获得了多少个 bucketfiles_ 文件。每个文件将运行一个 s3cmd。

这需要一段时间，但不是几天。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-22T08:02:09.457

从存储桶中删除数十万个文件时，我遇到了同样的问题。启动 EC2 实例以运行并行删除可能是值得的，因为 S3 的延迟很低。我认为托管一堆 EC2 服务器并向人们收取快速删除存储桶的费用是可以赚到钱的。（至少在亚马逊开始改变 API 之前）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-02-15T23:09:06.330

旧线程，但仍然相关，因为我一直在寻找答案，直到我弄清楚这一点。我想要使​​用基于 GUI 的工具（即无代码）的文件计数。我碰巧已经使用了一个名为 3Hub 的工具来进行与 S3 之间的拖放传输。*我想知道我在特定存储桶中*有多少文件（我不认为计费会按存储桶分解）。

```
So, using 3Hub, 
- list the contents of the bucket (looks basically like a finder or explorer window)
- go to the bottom of the list, click 'show all'
- select all (ctrl+a)
- choose copy URLs from right-click menu
- paste the list into a text file (I use TextWrangler for Mac) 
- look at the line count 
```

**我在存储桶中有 20521 个文件，并且在不到一分钟的时间内完成了文件计数。**

我想知道是否有人找到了更好的方法，因为这需要花费一些时间处理数十万个文件。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-16T12:34:03.920

1）关于您的第一个问题，您可以列出存储桶中的项目，而无需实际检索它们。您可以使用[SOAP](http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?SOAPListBucket.html)和[REST](http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?RESTBucketGET.html) API 来做到这一点。如您所见，您可以定义要列出的最大项目数以及开始列出的位置（标记）。[在此处](http://docs.amazonwebservices.com/AmazonS3/2006-03-01/index.html?ListingKeys.html)阅读更多相关信息。

我不知道分页的任何实现，但特别是对于 REST 接口，用任何语言实现它都非常容易。

2）我相信删除存储桶的唯一方法是首先从所有项目中清空它。另请参阅此[问题](https://stackoverflow.com/questions/27267/delete-amazon-s3-buckets)。

3) 我会说 S3 非常适合存储大量文件。然而，这取决于你想做什么。您是否还打算存储二进制文件？您是否需要执行任何查询或仅列出文件就足够了？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-06-17T15:55:48.313

To count objects in an S3 bucket:

Go to AWS Billing, then reports, then AWS Usage reports. Select Amazon Simple Storage Service, then Operation StandardStorage. Download a CSV file that includes a UsageType of StorageObjectCount that lists the item count for each bucket.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2021-03-20T15:41:26.953

# 数数

```
aws s3 ls s3://mybucket/ --recursive | wc -l 
```

[从这个帖子](https://stackoverflow.com/questions/2862617/how-can-i-tell-how-many-objects-ive-stored-in-an-s3-bucket)

# 删除

```
aws s3 rm --recursive s3://mybucket/ && aws s3 rb s3://mybucket/ 
```

这将删除每个项目，然后是存储桶。

# c# - 使用 LINQ 将 XML 标记的集合连接到字符串

> ID：701550
> 
> 赞同：1
> 
> 时间：2009-03-31T15:20:51.220
> 
> 标签：c#, linq, linq-to-xml

我坚持使用我无法控制的 Web 服务，并试图将该服务返回的 XML 解析为标准对象。

XML 结构的一部分如下所示

```
<NO>
   <L>Some text here </L>
   <L>Some additional text here </L>
   <L>Still more text here </L>
</NO> 
```

最后，我想得到一个字符串属性，它看起来像**“这里有一些文本，这里有一些附加文本，这里还有更多文本”**

我的初始通行证如下。我认为我走在正确的轨道上，但还没有：

```
XElement source = \\Output from the Webservice
List<IndexEntry> result;

result = (from indexentry in source.Elements(entryLevel)
    select new IndexEntry()
    {
        EtiologyCode = indexentry.Element("IE") == null ? null : indexentry.Element("IE").Value,
        //some code to set other properties in this object
        Note = (from l in indexentry.Elements("NO").Descendants
                select l.value)  //This is where I stop
                               // and don't know where to go
    } 
```

我知道我可以在该查询的末尾添加一个 ToList() 运算符来返回集合。是否有一种操作或技术可以让我将该集合的串联内联到单个字符串？

如果不清楚，请随时询问更多信息。

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-31T15:25:28.320

LINQ to XML 确实是这里的方式：

```
var textArray = topElement.Elements("L")
                          .Select(x => x.Value)
                          .ToArray();

var text = string.Join(" ", textArray); 
```

编辑：根据评论，您似乎只需要一种表达方式即可。这很容易，虽然有点难看：

```
result = (from indexentry in source.Elements(entryLevel)
    select new IndexEntry
    {
        EtiologyCode = indexentry.Element("IE") == null 
                           ? null 
                           : indexentry.Element("IE").Value,
        //some code to set other properties in this object
        Note = string.Join(" ", indexentry.Elements("NO")
                                          .Descendants()
                                          .Select(x => x.Value)
                                          .ToArray())
    }; 
```

另一种选择是将其提取到单独的扩展方法中（它必须在顶级静态类中）：

```
public static string ConcatenateTextNodes(
    this IEnumerable<XElement> elements)
{
    string[] values = elements.Select(x => x.Value).ToArray();
    // You could parameterise the delimiter here if you wanted
    return string.Join(" ", values);
} 
```

然后将您的代码更改为：

```
result = (from indexentry in source.Elements(entryLevel)
    select new IndexEntry
    {
        EtiologyCode = indexentry.Element("IE") == null 
                           ? null 
                           : indexentry.Element("IE").Value,
        //some code to set other properties in this object
        Note = indexentry.Elements("NO")
                         .Descendants()
                         .ConcatenateTextNodes()
    } 
```

**编辑：关于效率的说明**

其他答案建议以`StringBuilder`效率的名义使用。在使用它之前，我会检查这是正确的方法的证据。如果您考虑一下`StringBuilder`并`ToArray`做类似的事情-他们会创建一个比所需更大的缓冲区，向其中添加数据，在必要时调整其大小，最后得出结果。希望您不需要经常调整大小。

和here之间的*区别*在于缓冲的内容-它是您迄今为止构建的字符串的全部内容。它只是参考*。*换句话说，调整用于 的内部缓冲区的大小可能比调整用于 的缓冲区的大小便宜，*尤其*是在单个字符串很长的情况下。`StringBuilder``ToArray``StringBuilder``ToArray`*`ToArray``StringBuilder`*

 **在 中进行缓冲之后`ToArray`，`string.Join`效率非常高：它可以从一开始就查看*所有*字符串，*准确*计算要分配多少空间，然后将其连接起来，而无需复制实际的字符数据。

这[与我之前给出的答案形成鲜明对比](https://stackoverflow.com/questions/585860/string-join-vs-stringbuilder-which-is-faster/585897#585897)——但不幸的是，我认为我从来没有写过基准。

我当然不希望`ToArray`会明显变慢，而且我认为它使这里的代码更简单 - 不需要使用副作用等，聚合等。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T15:29:20.823

另一种选择是使用 Aggregate()

```
var q = topelement.Elements("L")
                  .Select(x => x.Value)
                  .Aggregate(new StringBuilder(), 
                             (sb, x) => return sb.Append(x).Append(" "),
                             sb => sb.ToString().Trim()); 
```

**编辑**： Aggregate 中的第一个 lambda 是*累加器*。这是获取您所有的价值并从中创造一个价值。在这种情况下，它使用您想要的文本创建一个 StringBuilder。第二个 lambda 是*结果选择器*。这使您可以将累积值转换为您想要的结果。在这种情况下，将 StringBuilder 更改为 String。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T15:23:33.413

我自己没有这方面的经验，但令我震惊的是[LINQ to XML](http://msdn.microsoft.com/en-us/library/bb387061.aspx)可以极大地简化您的代码。选择 XML 文档，然后遍历它并使用 StringBuilder 将 L 元素附加到某个字符串。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T18:28:37.367

我和其他人一样喜欢 LINQ，但你在这里重新发明了轮子。该`XmlElement.InnerText`物业完全符合要求。

试试这个：

```
using System.Xml;

class Program
{
    static void Main(string[] args)
    {
        XmlDocument d = new XmlDocument();
        string xml =
            @"<NO>
  <L>Some text here </L>
  <L>Some additional text here </L>
  <L>Still more text here </L>
</NO>";
        d.LoadXml(xml);
        Console.WriteLine(d.DocumentElement.InnerText);
        Console.ReadLine();
    }
} 
```

# sql-server - SQL Server 2005：如何在查询中自动包含数据库名称和括号

> ID：701560
> 
> 赞同：0
> 
> 时间：2009-03-31T15:22:54.177
> 
> 标签：sql-server, sql-server-2005, ssms

再会，

在 SQL Server 2005 中，当我编写新查询时，我喜欢从对象资源管理器中拖放表名和列名。但是，当我拖放表格时，有没有办法自动包含数据库名称？

（例如：当我在查询设计器中拖放表 Table1 时，我希望拥有 Database1.dbo.Table1 而不仅仅是 Table1）

另外，有没有办法在列名和表名周围自动包含“[”和“]”？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T15:53:33.777

抱歉，不是从对象资源管理器中拖放。

此问题中建议的工具之一可能会有所帮助：

[需要一个工具来自动缩进和格式化 SQL Server 存储过程](https://stackoverflow.com/questions/686394/686416)

# visual-studio - 如何以这种方式设置断点？

> ID：701561
> 
> 赞同：1
> 
> 时间：2009-03-31T15:23:00.403
> 
> 标签：visual-studio, debugging, breakpoints

我想设置一个断点，并希望在一块内存（开始地址和长度已知）发生更改时触发它。我正在使用 Windows Server 2003 x64 平台。Windbg 中的解决方案或 Visual Studio 中的解决方案都可以。我的目的是监视内存内容何时发生变化。

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T15:24:11.477

尝试[设置数据断点](http://msdn.microsoft.com/en-us/library/350dyxd0(VS.80).aspx)。

在 Visual Studio 中：

*   转到调试>>新断点>>新数据断点
*   输入您要查看的地址（或计算结果为地址的表达式；例如 &foo）
*   输入要在该地址观看的字节数
*   单击确定，在调试器中运行您的程序，然后等待！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T15:30:36.173

这也可以在 GDB 中完成。在 GDB 中，这是对特定地址的监视（我已经成功地以这种方式在 C++ 对象成员的地址上设置监视）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T15:25:02.550

不确定VS，但是使用windbg可以使用以下命令

> ba w 大小地址

将 size 替换为内存的长度，将 address 替换为内存的起始地址。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T15:28:50.170

您可以[设置数据断点](http://msdn.microsoft.com/en-us/library/350dyxd0%28VS.80%29.aspx)，但您需要知道您感兴趣的内存位置的地址，然后才能设置这样的断点。通常，我要么在程序的开头设置断点，要么让调试器在附加时挂起，这样我就可以找到要监视的变量的内存地址，然后设置数据断点。

# sql - NHibernate 意外的 ORDER BY 语句

> ID：701570
> 
> 赞同：0
> 
> 时间：2009-03-31T15:24:28.697
> 
> 标签：sql, nhibernate, sql-order-by

我正在使用 NHibernate 2.0，当我提交请求返回前 2 条记录的请求时，我的 SQL 中出现了一些 ORDER BY 子句。当我取出 Max 结果时，查询看起来很好（没有 ORDER BY 语句）。为什么 NHibernate 在我查找记录子集时会自动添加它？提前致谢

请参阅下面的 SQL 语句：

**意外订购**

```
执行 sp_executesql
N' SELECT TOP 2 Person1_36_0_、LastReco2_36_0_、SSN3_36_0_、
 FirstName4_36_0_、LastName5_36_0_、MiddleIn6_36_0_、Title7_36_0_、Suffix8_36_0_、
DateOfBi9_36_0_, IsDeceased10_36_0_, Decease11_36_0_, Contact12_36_0_, MailHol13_36_0_,
MailHol14_36_0_, MailHol15_36_0_, Preferr16_36_0_, CreatedBy17_36_0_, Created18_36_0_,
ModifiedBy19_36_0_, Modifie20_36_0_
FROM (SELECT ROW_NUMBER() OVER(ORDER BY __hibernate_sort_expr_0__) 作为行，
query.Person1_36_0_，query.LastReco2_36_0_，query.SSN3_36_0_，query.FirstName4_36_0_，
query.LastName5_36_0_，query.MiddleIn6_36_0_，query.Title7_36_0_，query.Suffix8_36_0_，
query.DateOfBi9_36_0_, query.IsDeceased10_36_0_, query.DateOfBi9_36_0_,
query.Contact12_36_0_，query.MailHol13_36_0_，query.MailHol14_36_0_，query.MailHol15_36_0_，
query.Preferr16_36_0_，query.CreatedBy17_36_0_，query.Created18_36_0_，
query.ModifiedBy19_36_0_，query.Modifie20_36_0_，query.__hibernate_sort_expr_0__
从
（选择 this_.Person_id 作为 Person1_36_0_，this_.[LastRecordVersion] 作为 LastReco2_36_0_，
this_.[SSN] 作为 SSN3_36_0_，this_.[FirstName] 作为 FirstName4_36_0_，this_.[LastName] 作为
LastName5_36_0_, this_.[MiddleInitial] 作为 MiddleIn6_36_0_, this_.[Title] 作为 Title7_36_0_,
this_.[Suffix] as Suffix8_36_0_, this_.[DateOfBirth] as DateOfBi9_36_0_, this_.[IsDeceased]
作为 IsDeceased10_36_0_, this_.[DeceasedDate] as Decease11_36_0_, this_.[ContactMethod_id] as
Contact12_36_0_, this_.[MailHoldReason_id] as MailHol13_36_0_, this_.[MailHoldStartDate] as
MailHol14_36_0_, this_.[MailHoldEndDate] as MailHol15_36_0_, this_.[PreferredName] as
Preferr16_36_0_, this_.[CreatedBy] as CreatedBy17_36_0_, this_.[CreatedDate] as
Created18_36_0_, this_.[ModifiedBy] as ModifiedBy19_36_0_, this_.[ModifiedDate] as
修改 20_36_0_, CURRENT_TIMESTAMP 为 __hibernate_sort_expr_0__
FROM MC_Person this_
WHERE this_.[SSN] = @p0) 查询）页面
WHERE **page.row > 0 ORDER BY __hibernate_sort_expr_0__**',
N'@p0 nvarchar(9)',@p0=N'123456789'

```

**正确的 SQL（没有获得 Top 2 记录）**

```
执行 sp_executesql
N'SELECT this_.Person_id as Person1_36_0_, this_.[LastRecordVersion] as LastReco2_36_0_,
this_.[SSN] 作为 SSN3_36_0_，this_.[FirstName] 作为 FirstName4_36_0_，this_.[LastName] 作为
LastName5_36_0_, this_.[MiddleInitial] 作为 MiddleIn6_36_0_, this_.[Title] 作为 Title7_36_0_,
this_.[Suffix] as Suffix8_36_0_, this_.[DateOfBirth] as DateOfBi9_36_0_, this_.[IsDeceased]
作为 IsDeceased10_36_0_, this_.[DeceasedDate] as Decease11_36_0_, this_.[ContactMethod_id] as
Contact12_36_0_, this_.[MailHoldReason_id] as MailHol13_36_0_, this_.[MailHoldStartDate] as
MailHol14_36_0_, this_.[MailHoldEndDate] as MailHol15_36_0_, this_.[PreferredName] as
Preferr16_36_0_, this_.[CreatedBy] as CreatedBy17_36_0_, this_.[CreatedDate] as
Created18_36_0_, this_.[ModifiedBy] as ModifiedBy19_36_0_, this_.[ModifiedDate] as
修改20_36_0_
FROM MC_Person this_
在哪里 this_.[SSN] = @p0',
N'@p0 nvarchar(9)',@p0=N'123456789'

```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T15:29:27.813

这是实现分页的方式。所以没有特殊情况只取前 n 个元素，因为例如 Oracle 不支持这种结构。

因此，任何设置了分页限制的任何事情都是以这种方式完成的。

你得到正确的结果了吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T15:33:33.730

如果没有排序，顶级选择没有多大意义，因为排序可能会因数据库表的维护而改变。

难道你不以某种方式定义你想要的前两个结果吗？因此顺序？

# php - 如何允许我的用户插入 HTML 代码而没有风险？（不仅是技术风险）

> ID：701580
> 
> 赞同：11
> 
> 时间：2009-03-31T15:26:31.953
> 
> 标签：php, javascript, html, security, xss

我开发了一个 Web 应用程序，它允许我的用户在 LAMP 环境（debian、apache、php、mysql）中动态管理网站的某些方面（是的，某种 cms）

好吧，例如，他们在我的服务器上的私人区域创建新闻，然后通过 cURL 请求（或通过 ajax）在他们的网站上发布。

新闻是使用 WYSIWYG 编辑器创建的（目前为 fck，未来可能为 tinyMCE）。

所以，我不能禁止 html 标签，但我怎样才能安全呢？我必须删除什么样的标签（javascripts？）？这意味着服务器安全..但是如何“合法”安全？如果用户使用我的应用程序制作 xss，我会遇到一些法律问题吗？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-31T15:40:19.877

如果您使用的是 php，一个很好的解决方案是使用[HTMLPurifier](http://htmlpurifier.org/)。它有很多过滤掉坏东西的选项，并且作为一个副作用，保证了格式良好的 html 输出。我用它来查看可能是敌对环境的垃圾邮件。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-31T15:32:34.390

您要删除的内容并不重要，总会有人找到绕过它的方法。作为参考，请查看此[XSS 备忘单](http://ha.ckers.org/xss.html)。

例如，您将如何删除这个有效的 XSS 攻击：

```
<IMG SRC=&#x6A&#x61&#x76&#x61&#x73&#x63&#x72&#x69&#x70&#x74&#x3A&#x61&#x6C&#x65&#x72&#x74&#x28&#x27&#x58&#x53&#x53&#x27&#x29> 
```

您最好的选择是只允许一部分可接受的标签并删除其他任何内容。这种做法被称为[白名单](http://en.wikipedia.org/wiki/Whitelist)，是防止 XSS（除了禁止 HTML）的最佳方法。

在你的测试中也使用备忘单；在您的网站上尽可能多地触发并尝试找到一些执行 XSS 的方法。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-31T15:31:57.713

这里的一般最佳策略是将您认为安全的特定标签和属性列入白名单，然后转义/删除其他所有内容。例如，一个合理的白名单可能是`<p>, <ul>, <ol>, <li>, <strong>, <em>, <pre>, <code>, <blockquote>, <cite>`. 或者，考虑使用对人类友好的标记，例如可以轻松转换为安全 HTML的**[Textile](http://en.wikipedia.org/wiki/Textile_(markup_language))**或**[Markdown 。](http://en.wikipedia.org/wiki/Markdown)**

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-31T15:31:17.573

除了允许 HTML，您应该有一些可以转换为 HTML 的其他标记。例如，试图从用户输入中去除恶意 HTML 几乎是不可能的

```
<scr<script>ipt etc="..."> 
```

从中删除将离开

```
<script etc="..."> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-31T15:42:19.903

有关[stackoverflow](http://stackoverflow.com)使用的白名单方法的 C# 示例，您可以查看[此页面](https://web.archive.org/web/20090318053325/http://refactormycode.com/codes/333-sanitize-html)。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-09T01:21:16.240

[Kohana 的安全助手](http://docs.kohanaphp.com/helpers/security)很不错。据我记得，它取自另一个项目。

但是我测试了

```
<IMG SRC=&#x6A&#x61&#x76&#x61&#x73&#x63&#x72&#x69&#x70&#x74&#x3A&#x61&#x6C&#x65&#x72&#x74&#x28&#x27&#x58&#x53&#x53&#x27&#x29> 
```

从[LFSR Consulting 的回答](https://stackoverflow.com/questions/701580/how-can-i-allow-my-user-to-insert-html-code-without-risks-not-only-technical-r/701609#701609)中，它正确地逃脱了它。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-31T15:38:05.530

如果删除标签太困难，您可以拒绝整个 html 数据，直到用户输入有效的。如果它包含以下标签，我会拒绝 html：

框架集,框架,iframe,脚本,对象,嵌入,小程序。

您想要禁止的标签还有：head（和子标签）、body、html，因为您想自己提供它们并且您不希望用户操作您的元数据。

但一般来说，允许用户提供自己的 html 代码总是会带来一些安全问题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-31T15:41:41.217

您可能想要考虑，而不是完全允许 ​​HTML，实现一些 HTML 的替代品，如 BBCode 或 Markdown。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2018-01-10T17:39:58.483

我使用这个 php strip_tags 函数，因为我希望用户可以安全地发布，并且我只允许一些可以在帖子中使用的标签，没有人可以通过脚本注入来破解你的网站，所以我认为 strip_tags 是最好的选择

[Clich here 获取此 php 函数的代码](https://i.stack.imgur.com/yyfZz.png)

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2018-01-10T17:05:16.453

![我应该复制/粘贴而不是截图的代码](https://i.stack.imgur.com/JSyNN.png)

这是php中非常好的功能，您可以使用它

```
$string = strip_tags($_POST['comment'], "<b>"); 
```

# iis - 在 IIS 中更新 Web 应用程序 - 最佳实践

> ID：701583
> 
> 赞同：2
> 
> 时间：2009-03-31T15:27:11.860
> 
> 标签：iis, deployment, web-applications

在 IIS 中更新 Web 应用程序的最佳做法是什么？

当您访问我们的应用程序时，您看到的第一页是登录页面。

我想要实现的是将访问者重定向到说明应用程序正在更新的页面。对于具有管理员角色的用户能够成功登录（检查一切是否正常）

在 web.config 中，我们跟踪应用程序是否正在更新（更新 = [true|false] 然后在 authentication_event 上：

```
if (updating) 
{

   if (User.IsInRole("admin"))

   {

      redirect to main web app...

   }
   else
   {     

     redirect to web being updated page....

   }

}
else 
{

   redirect to main web app..

} 
```

任何建议将不胜感激..

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-23T07:38:54.927

我在本地测试所有内容，然后在生产服务器上使用内置的 app_offline.html 文件。当此文件存在时，它将提供给客户，同时我正在上传新内容。完成后，将 app_offline.html 重命名为不同的名称，新的应用程序就会启动。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T15:38:03.563

而不是通过 web.config 执行此操作，您应该将更新标志保存在其他一些 xml 文件或数据库中，因为每次更新 web.config 文件时，您的应用程序都会重新启动，从而使当前的应用程序变量、缓存等无效

除此之外，您的其他逻辑是正确的。但尽可能避免接触 web.config - 我个人只将连接字符串保存在 web.config 中，因为它几乎不会改变

但其余经常更改的键值对，我将它们保存在 sql 数据库表中。这样我就永远不必重新启动应用程序，除非我的连接字符串发生变化:-)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T15:31:31.647

看来你已经想通了。

```
if (WebConfigurationManager.AppSettings["updating"]=="true") 
   if (User.IsInRole("admin"))
       Response.Redirect("~/Main.aspx");
   else
       Response.Redirect("~/Updating.aspx");
else
   Response.Redirect("~/Main.aspx"); 
```

# vba - 在 VBA 中获取当前内存配置的最佳方法

> ID：701587
> 
> 赞同：3
> 
> 时间：2009-03-31T15:28:45.193
> 
> 标签：vba, configuration, hardware, windows-scripting

我正在尝试获取当前用户的 RAM 配置。我想使用 VBA 进行查找，然后将其存储在表格中。我需要芯片的数量以及每个芯片上的 RAM 数量。这可以使用 VBA 以编程方式查找吗？我需要使用 Windows 脚本宿主吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T15:38:38.057

您可以使用[WMI](http://msdn.microsoft.com/en-us/library/aa394554(VS.85).aspx)执行此操作：

```
Dim devlist as object
Dim dev as object
Dim totalRAM as long
Dim numChips as long
Set devlist = GetObject("winmgmts:{impersonationLevel=impersonate}").ExecQuery("SELECT * FROM Win32_LogicalMemoryConfiguration")
numChips = 0
For Each dev In devlist
    numChips = numChips + 1
    totalRAM = totalRAM + CLng(dev.TotalPhysicalMemory)
Next
devlist = Nothing
MsgBox "RAM: NumChips = " & numChips & ", Total = " & (totalRAM / 1024) & "MB" 
```

# user-interface - 最先进的错误和异常处理策略应该包括什么？

> ID：701596
> 
> 赞同：22
> 
> 时间：2009-03-31T15:31:03.503
> 
> 标签：user-interface, error-handling

我知道这是一个非常广泛的问题，但不会接受简短的“视情况而定”的答案。策略的诞生是为了处理广泛的问题。

1.  应用程序设计人员在设计错误和异常处理策略时应该考虑哪些问题？

2.  策略将如何根据软件类型（COTS、内部业务应用程序、咨询软件、游戏、托管 Web 应用程序、嵌入式等）而有所不同？软件类型重要吗？

3.  伦理、政治和法律问题？

4.  关于错误处理的各种观点（用户、开发人员、业务支持、管理）。

我会探索的一些想法：

*   各种错误报告途径（即 UI、日志记录、自动管理员通知）。

*   [深度防御](http://en.wikipedia.org/wiki/Defense_in_depth_%28computing%29)和稳健性（故障转移应急和故障安全机制，针对未知问题的恢复）。

*   公平对待用户和客户（即尽量减少对软件用户和软件服务的其他人的影响）。

我正在寻找类似的想法和概念列表。

如果我需要进一步澄清问题，请使用评论指出我，并感谢大家的贡献！

* * *

常问问题

*开发平台（Java、.NET、移动）* ——从开发人员的角度来看，肯定会对策略​​的最终实现细节产生一些影响，但从用户的角度来看，影响较小。

*愚人节*肯定不是。我被要求处理的大多数遗留系统都没有明确的错误处理策略。

*这可以成为社区维基吗？* 不。这似乎是一个好问题，而且很难提出好问题。

*你说的策略是什么意思？*为错误和异常处理提供方向、重点、一致性和协调性的长期计划。如果有一个更大的团队从事软件工作，则可以制定策略并以书面形式分发。

*这似乎是重复的问题（请参阅Java 或 C中[异常管理的最佳实践](https://stackoverflow.com/questions/409563/best-practices-for-exception-management-in-java-or-c)[以及您喜欢异常或返回代码](https://stackoverflow.com/questions/99683/which-and-why-do-you-prefer-exceptions-or-return-codes)的最佳实践）*这些问题涉及错误处理的某个角度（主要是开发人员），我想学习更多关于其他观点以及它们如何为整体战略做出贡献。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-31T16:00:07.457

这里有很多可能的答案，但我会尝试一下。

*应用程序设计人员在设计错误和异常处理策略时应该考虑哪些问题？*

1.  当您有多个开发人员时，应该很容易“挂钩”您的错误处理框架，否则人们不会使用它。
2.  明智地使用事务来保持数据一致性。我总是看到应用程序可能在流程中途发生故障并导致奇怪的数据不一致，因为整个操作没有正确回滚。
3.  处理异常时考虑重要性。例如，如果您有一个在线订购系统，并且该工作流程的一部分是向网站所有者发送一封电子邮件，让他们知道已下了新订单。如果发送该电子邮件失败，用户是否会收到错误消息并取消整个订单？

*策略将如何根据软件类型（COTS、内部业务应用程序、咨询软件、游戏、托管 Web 应用程序、嵌入式等）而有所不同？软件类型重要吗？*

1.  对于桌面类型或嵌入式应用程序，记录有关环境的信息（操作系统版本、硬件、正在运行的其他应用程序等）在调查错误报告时非常有用。
2.  对于企业应用程序和 Web 应用程序，电子邮件错误通知、SMS 消息传递以及与 ECO 工具（例如 Tivoli）的集成变得非常有用。

*伦理、政治和法律问题？*

我在这里唯一能想到的就是桌面应用程序——“电话回家”类型的应用程序通常不受欢迎，尤其是当它们提交有关用户机器的敏感信息时。

*关于错误处理的各种观点（用户、开发人员、业务支持、管理）。*

1.  从用户的角度来看，尽量通过设计界面来避免错误，使他们难以出错。不要问用户可能无法回答的问题（中止、重试、失败？）

2.  从开发人员的角度来看，您需要尽可能多的信息来帮助诊断发生的事情——堆栈跟踪、环境信息等。

3.  从业务支持和管理的角度来看，他们会想知道如何处理错误（主要是在企业环境中）——谁负责应用程序（我应该给谁打电话/页面/等等？）以及关键性以及任何可能的副作用（例如，如果此批处理作业失败，会影响哪些业务流程？）。书面文档是您的朋友。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-06T18:23:54.593

我来自 Java 背景，但我的回答也应该适用于 .Net。

经验法则：

1.  编写快速失败的代码：[Hunt & Thomas](https://rads.stackoverflow.com/amzn/click/com/020161622X)；提示 33
2.  使用参数检查库测试所有参数 - 这些不是例外情况。它们是对（记录在案的）API 的滥用。示例：[谷歌集合谓词](http://google-collections.googlecode.com/svn/trunk/javadoc/com/google/common/base/Predicate.html)
3.  在异常情况下使用异常：[Hunt & Thomas]；提示 34\. 不应将异常用作返回码。
4.  测试异常条件：异常是方法调用的后置条件。如果您无法通过测试到达那里，则不应声明异常。
5.  （对于 Java）遵循[Josh Bloch 的建议](http://java.sun.com/docs/books/effective/)（第 9 章的全部内容）。一些重要提示： 5a。抛出适合抽象的异常。5b。力求失败的原子性。5c。在详细消息中包含失败捕获信息（或将其封装在异常本身中）。5d。不要忽略异常。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-10T04:18:26.780

我在工作中遇到了其中的一些问题——不过并没有真正有机会在那里进行探索。我的想法：

*应用程序设计人员在设计错误和异常处理策略时应该考虑哪些问题？*

理想的异常处理策略是完全恢复和记录错误。catch-22 - 如果你能做这样的事情，你不会一开始就写在代码中吗？因此，它本身并不是真正的“例外”，而且您的实现复杂性呈指数级增长。另一方面是自主系统和“自我修复软件”方法的领域。我相信最现实的策略是始终尝试强制系统进入一致状态（即最小损坏）。您将始终被迫权衡某些事情 - 丢失或损坏的数据、资源丢失导致性能下降等；但是，处于一致状态会增加您在容量减少的情况下保持运营的机会，而不是面临完全关闭的情况。

*策略将如何根据软件类型（COTS、内部业务应用程序、咨询软件、游戏、托管 Web 应用程序、嵌入式等）而有所不同？软件类型重要吗？*

我认为每种类型的软件都有不同的审计和 QoS 要求，这反映在与停机时间和/或数据损坏相关的成本上；但是，总体策略是相同的。对于嵌入式，策略是尽量减少问题对用户的影响并创建日志。您可以通过安静地重新启动软件（即重置状态）来实现这一点。使用托管 Web 应用程序，可以转储来自崩溃的会话数据以供以后分析，并且用户会获得一个新会话。对于游戏（尤其是 MMORPG 之类的游戏），您需要投资维护快照数据，以防止游戏玩家在服务器故障时丢失进度。服务器集群和故障转移技术在这些实现中也非常重要。

*伦理、政治和法律问题？*

透明度可能是错误和异常处理中最重要的部分，它将以维护审计的形式出现。这些问题的最终结果是证明系统故障（如果发生任何附带损害）是设计人员无法合理预见的不可预测的事件链的结果。同样重要的是要证明任何处理机制都可以通过减少损害等来产生积极影响。在面对灾难性故障时让用户保持循环也很重要（例如，“我的魔兽世界服务器去了哪里？？？？” )，但我的主要观点是透明度应该应用于有纪律的审计，以重建失败。

*关于错误处理的各种观点（用户、开发人员、业务支持、管理）。*

作为用户，错误处理应该是完全不可见的。如果服务器崩溃，我仍然希望我的银行交易按计划完成，而无需致电银行并重新运行交易。

作为开发人员，错误处理是应用程序设计中最困难的部分。由人和技术因素造成的可能出错的事情的数量，以及如何将它们分类为我们可以编写代码来处理的情况是非常困难的。我们依靠项目预算和管理来指导这些决策，但最终，它仍然像玩俄罗斯轮盘游戏。

对于业务支持和管理，我认为错误处理就像在软件开发阶段支付的保险一样，可以减少因软件故障而遇到不便或中断的客户必须赔偿的发生率。它也是软件质量和责任的衡量标准（即他们想知道哪个部门/小组/开发人员负责）。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-12T06:12:25.337

尽可能多地向开发团队获取有关正在发生的错误的信息是很重要的。在没有用户体验错误情况并且您可以确定有人正在检查日志文件的情况下，日志文件是很好的。自动电子邮件非常适合基于服务器的应用程序。警报消息是有问题的，因为用户从不阅读它们。对我有用的一个技巧是将详细的错误跟踪复制到剪贴板，同时显示用户友好的错误，然后训练用户将错误跟踪粘贴到电子邮件错误报告中。Web 等效项是显示友好消息，同时从服务器向开发团队发送电子邮件中的详细错误。

应该有一个万不得已的日志，换句话说，当写入日志文件导致错误时会发生什么？还应该内置针对“魔法师的学徒”类型问题的保护，其中错误处理本身会锁定系统。在桌面系统上，草率的错误处理代码可能会导致无休止的消息框级联，除了杀死应用程序之外别无选择，可能会在此过程中丢失数据。如果错误处理代码触发异常，可能会导致类似的问题。如果没有更好的选择，错误处理框架应该检测错误处理错误并停止报告错误。

对于重要的批处理过程，没有什么比主动通知成功更重要的了。如果“批处理完成”电子邮件没有到达，用户就知道发生了什么事，即使错误处理是 fubar。

应在边界处捕获异常。所有事件处理程序、公共组件函数和服务方法都应该捕获所有发生的异常。在某些情况下，重新抛出异常是有意义的；例如，当 Web 服务方法中捕获到异常时，应该抛出 SOAP 异常。但是让异常自动渗透到组件边界是一个坏主意。

相反，在类的私有方法或嵌套在组件的复杂内部进程中间的方法中捕获异常通常是一个坏主意。在这种情况下处理异常是没有意义的，除非您可以从异常中恢复。此内部代码必须结构化，以便在出现异常时释放所有资源并回滚数据库事务。每个方法中的 catch 块是混乱的标志， using 和 finally 块是一个健全的错误处理框架的标志。

请记住，异常是异常的（如果您期望它们，它们不会被称为异常！）与其试图预测何时可能发生错误，不如专注于支撑您的组件边界。即使是不可能遇到错误的琐碎代码，如果它位于边界上，也应该有一个 catch 块。这样，当以后以意想不到的方式修改代码时，架构仍将保持不变。

每个组件边界可能需要不同的报告机制。对于设计为在不同上下文中运行的组件，请提供一个错误处理接口，客户端代码可以使用该接口来捕获错误消息。如果有人忘记挂钩错误处理接口，请不要忘记最后的日志。

总结一下：

1.  可靠地将详细的错误信息反馈给开发团队。

2.  始终在组件边界处捕获错误，并且仅在组件边界处捕获错误。

3.  使所有代码异常安全。

4.  不要让错误处理框架成为问题的一部分。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-13T03:38:02.860

我不打算赢得赏金，但这里有一些我已经使用并受到好评的策略：

1.  从子组件中提取信息并将它们映射到功能单元有助于我们的业务分析师和最终用户更好地理解错误

2.  根据您正在运营的领域，分配业务优先级将有所帮助。

3.  单独的错误查看器应用程序帮助我们在报告错误之前查看错误，以便我的团队可以开始修复它们。

4.  系统级异常在没有被弄乱时会更好。

5.  错误的异步日志记录将对整体策略和设计有很大帮助。

6.  创建领域驱动的错误策略：意味着错误对应于某些业务逻辑的失败。当然，大部分应该由开发人员处理，但是如果您在交易引擎中处理各个企业之间的消息路由等，您可能会遇到某些场景

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-01-29T02:34:04.860

`<opening my mind to new concepts>`

*   **通过模拟纸带**或地震监测卷打印机绘制出现的错误流图，检查一周的进度并将其与历史数据、使用数据进行比较，并将其与预设目标进行比较。临时把长长的印刷长图贴在墙上，并召集节目组一起审查。您购买他们的饮料，同时解释您的问题，这一次非常具体，以便程序员确切地知道您需要什么策略。我敢打赌，一次咖啡休息会为您的问题提供有效且令人满意的战略答案。

`<closing my mind to new contepts>`

# c# - 从 Microsoft Word 中提取数据的最佳方法

> ID：701602
> 
> 赞同：1
> 
> 时间：2009-03-31T15:31:34.593
> 
> 标签：c#, ms-word, office-interop

软件的发行说明有一些我想在每个发行版中提取的重要数据。有没有办法从 Microsoft Word 中提取某些信息？

我正在考虑的应用程序将用 C# 编写，但如果它是任何其他解决方案，我可以。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T15:41:23.773

[所有 MS Office 产品（Word、Office 等）在内部（使用 VBA）和外部（通过OLE 自动化](http://en.wikipedia.org/wiki/OLE_Automation)，也称为 ActiveX；实际上，VBA 使用通过 OLE 公开的界面）都是完全可编写脚本的。

我的建议是在您的语言中寻找支持此功能的库。 [这](http://www.xav.com/perl/site/lib/Win32/OLE.html)是一个 Perl 模块的链接`Win32::OLE`，它确实如此：如您所见，它非常易于使用且功能强大。其他语言的界面应该类似。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T16:08:43.867

几年前我经历过这个。你可以：

1.  使用 Word 将文件转换为其他格式，ASCII、RTF、XML 等。

2.  使用某些第三方应用程序转换为另一种格式，例如 ASCII。

3.  通过 OLE 访问 Word API 并直接提取信息。

我找不到任何通用库来读取 Word 文件，当时所有读取 Word 文件的应用程序只适用于一个子集。词的变化太频繁了，以至于他们很难跟上。

有一些文档列出了旧 Word 文件格式的细节，底层文件结构异常复杂。如果没有大量资源，就很难使代码与文件格式保持同步。

最初，我使用 Perl 驱动 Word 并创建新文档，但解决方案太脆弱了。后来我将整个应用程序改为使用 PDF，并放弃了 Word。

保罗。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-05-06T18:51:05.980

可能不是最优雅的解决方案，但这似乎是最简单的方法：使用 Cscript。

刚刚在一个示例 word doc(2003) 上尝试过它，它工作得很好。

更多信息：[http ://www.gregthatcher.com/Papers/VBScript/WordExtractScript.aspx](http://www.gregthatcher.com/Papers/VBScript/WordExtractScript.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T15:38:17.743

我用 VSTO（Visual Studio Tools for Office）工具做了很多 excel 编程，我想你将能够使用 VSTO API 来阅读 word 文档。你应该能够使用 C#

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T15:39:55.027

您可以编写一个[IFilter](http://www.sqljunkies.ddj.com/Article/C4AC6E97-8D84-411D-8551-08CE63EC99B6.scuk)来从 word 文件中提取文本。无需安装 Word。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T22:57:50.630

您可以在 Word（VBA、VSTO）内部或外部工作。

从外部来看，自动化是一种方法。

另一个是完全避免使用 Word。如果文档是 .docx，您可以使用任何可以操作 Open XML 文件的东西。Microsoft 有其 Open XML SDK，在 Java 世界中，您可以使用 docx4j 或 POI。

# javascript - 我应该使用什么 JavaScript 来输入网页中的电话号码？

> ID：701606
> 
> 赞同：1
> 
> 时间：2009-03-31T15:32:13.530
> 
> 标签：javascript, html, user-input

我有三个用于在网页上输入电话号码的输入框：

```
 XXX XXX XXXX 
```

我需要在您键入时在框之间移动用户的 JavaScript。在第三个字符之后，它会将您移动到第二个框，等等...

过去，我在退格方面遇到了麻烦。当我从第二个框中单击退格键时，它使我进入第一个，但随后又将我射回第二个。

做这个的最好方式是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T15:47:02.873

你应该使用**jQuery** [AutoTab](http://www.lousyllama.com/sandbox/jquery-autotab)

**像这样的示例**代码

```
 <div><strong>Phone Number:</strong></div>
 <input type="text" name="area_code" id="area_code" maxlength="3" size="3" /> -
 <input type="text" name="number1" id="number1" maxlength="3" size="3" /> -
 <input type="text" name="number2" id="number2" maxlength="4" size="5" />

 <script type="text/javascript">
 $(document).ready(function() {
 $('#area_code').autotab({ target: 'number1', format: 'numeric' });
 $('#number1').autotab({ target: 'number2', format: 'numeric', previous: 'area_code'     });
 $('#number2').autotab({ previous: 'number1', format: 'numeric' });
});
</script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T15:36:44.317

就个人而言，我几乎接受*任何东西*并担心在服务器端重新格式化它。我不得不使用这么多糟糕的 javascript 电话格式化程序，所以我不是一个大粉丝。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T15:48:09.000

我建议使用这个一盒解决方案而不是三个。它减轻了许多令人头疼的问题和在盒子之间弹跳的边缘情况，让第一个盒子做 a `.select()`，然后用户点击删除，并擦除他们的条目。好恶心。

[http://javascript.internet.com/forms/format-phone-number.html](http://javascript.internet.com/forms/format-phone-number.html)

您可能想要的所有自动格式化。当然，这是北美标准，您必须针对 RestOfTheWorld 进行修改。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2009-03-31T15:48:52.697

当第一个字段具有焦点时，我会使用一个键侦听器来检查输入，计算已经输入的字符数，如果输入了足够多的字符，则将焦点移到第二个字段，依此类推。

希望这可以帮助，

尤瓦尔=8-)

# c# - 列表视图控件中的分页

> ID：701616
> 
> 赞同：2
> 
> 时间：2009-03-31T15:34:58.580
> 
> 标签：c#, asp.net

我可以有一些在 asp.net listview 控件中使用 datapager 的教程/示例代码吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T15:37:59.570

**当然可以**

Rick Strahl 的[ListView 和 DataPager](http://www.west-wind.com/WebLog/posts/127340.aspx)网络博客应该会有所帮助

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T15:57:48.383

scott gu 的博客是我最喜欢的 asp.net 资源之一。

他在[这里完成了关于 listview 和 datapager 的优秀教程](http://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)

# ms-word - 寻找如何在 MOSS 2007 中实现文档转换

> ID：701617
> 
> 赞同：0
> 
> 时间：2009-03-31T15:35:00.357
> 
> 标签：ms-word, sharepoint-2007, pdf-generation, document

我们的任务是创建一个 MOSS 工作流程，在它的最后一步将文档（最有可能来自 word 2003 或 2007）转换为 PDF 并在其上加上当前日期的水印。

到目前为止，我还没有看到一个明确的方法来做到这一点。已经研究过使用 MS Word Interop dll，但我们不会将 Word（或 Office）安装到服务器上 - 所以这确实不可行。我看过的另一个选项是使用 Aspose dll 库进行转换。

从拓扑的角度来看，想知道使用一台服务器专门用于文档转换是否是实现这一点的好方法。（我已经阅读了一些信息，这些信息向大型组织推荐了这种方法）。

如果有人 - 更喜欢做这种事情，可以给我一些建议或最佳实践，我真的很感激。

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-07T18:59:16.857

我认为从一台服务器开始是最好的方法。然后，只需监控机器上的工作量，如果它对一个人来说太多了，就在那里弹出另一个。这就是MOSS的美妙之处。

# unicode - Big Endian 和 Little Endian 字节顺序的区别

> ID：701624
> 
> 赞同：71
> 
> 时间：2009-03-31T15:37:48.247
> 
> 标签：unicode, utf-16, endianness

Big Endian 和 Little Endian Byte order 有什么区别？

这两者似乎都与 Unicode 和 UTF16 有关。我们究竟在哪里使用它？

* * *

## 回答 #1

> 赞同：121
> 
> 时间：2009-03-31T15:41:43.930

Big-Endian (BE) / Little-Endian (LE) 是组织多字节字的两种方式。例如，在 UTF-16 中使用两个字节表示一个字符时，有两种方法可以将字符表示`0x1234`为一个字节串（0x00-0xFF）：

```
Byte Index:      0  1
---------------------
Big-Endian:     12 34
Little-Endian:  34 12 
```

为了决定一个文本是使用 UTF-16BE 还是 UTF-16LE，规范建议在字符串前面加上一个**字节顺序标记**(BOM)，表示字符 U+FEFF。因此，如果 UTF-16 编码文本文件的前两个字节是`FE`, `FF`，则编码为 UTF-16BE。对于`FF`, `FE`，它是 UTF-16LE。

一个视觉示例：不同编码中的“示例”一词（带有 BOM 的 UTF-16）：

```
Byte Index:   0  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15
------------------------------------------------------------
ASCII:       45 78 61 6d 70 6c 65
UTF-16BE:    FE FF 00 45 00 78 00 61 00 6d 00 70 00 6c 00 65
UTF-16LE:    FF FE 45 00 78 00 61 00 6d 00 70 00 6c 00 65 00 
```

有关更多信息，请阅读[Endianness](http://en.wikipedia.org/wiki/Endianness)和/或[UTF-16](http://en.wikipedia.org/wiki/UTF-16/UCS-2)的 Wikipedia 页面。

* * *

## 回答 #2

> 赞同：33
> 
> 时间：2009-07-24T08:30:13.297

费迪南德（和其他人）的回答是正确的，但不完整。

Big Endian (BE) / Little Endian (LE) 与 UTF-16 或 UTF-32 无关。它们在 Unicode 之前就存在了，并且会影响数字字节在计算机内存中的存储方式。它们取决于处理器。

如果您有一个带有该值的数字，`0x12345678`那么在内存中它将表示为`12 34 56 78`(BE) 或`78 56 34 12`(LE)。

UTF-16 和 UTF-32 恰好分别在 2 个和 4 个字节上表示，因此字节的顺序尊重任何数字在该平台上遵循的顺序。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-03-31T15:44:23.033

UTF-16 将 Unicode 编码为 16 位值。大多数现代文件系统在 8 位字节上运行。因此，例如，要将 UTF-16 编码文件保存到磁盘，您必须决定 16 位值的哪一部分进入第一个字节，哪些进入第二个字节。

[维基百科](http://en.wikipedia.org/wiki/Utf-16#Byte_order_encoding_schemes)有更完整的解释。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2010-05-04T15:37:25.077

**小端：adj.**

描述了一种计算机体系结构，其中在给定的 16 位或 32 位字中，较低地址的字节具有较低的重要性（该字以“小端优先”的方式存储）。PDP-11 和 VAX 系列计算机和 Intel 微处理器以及许多通信和网络硬件都是 little-endian。该术语有时用于描述字节以外的单位的顺序；最常见的是一个字节内的位。

**大端：形容词。**

[常见的; 摘自 Swift 的《格列佛游记》，来自丹尼·科恩 (Danny Cohen) 的著名论文《圣战与和平恳求》，USC/ISI IEN 137，1980 年 4 月 1 日]

描述了一种计算机体系结构，在该体系结构中，在给定的多字节数字表示中，最高有效字节具有最低地址（该字存储为“大端优先”）。大多数处理器，包括 IBM 370 系列、PDP-10、摩托罗拉微处理器系列，以及大多数各种 RISC 设计都是大端的。Big-endian 字节顺序有时也称为网络顺序。

---来自行话文件：[http ://catb.org/~esr/jargon/html/index.html](http://catb.org/~esr/jargon/html/index.html)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2015-02-18T06:01:18.340

Big-endian 和 little-endian 是描述字节序列在计算机内存中存储顺序的术语。

1.  Big-endian 是“大端”（序列中最重要的值）首先存储（在最低存储地址）的顺序。
2.  Little-endian 是“小端”（序列中最不重要的值）首先存储的顺序。

例如

在大端计算机中，十六进制数所需的两个字节`4F52`将存储`4F52`在 storage 中`(if 4F is stored at storage address 1000, for example, 52 will be at address 1001).`

在小端系统中，它将被存储为`524F (52 at address 1000, 4F at 1001).`

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-31T15:45:41.470

[需要为 Unicode/UTF-16 编码指定字节字节序](http://en.wikipedia.org/wiki/Endianness)（大或小），因为对于使用多个单个字节的字符代码，可以选择是先读/写[最高有效字节](http://en.wikipedia.org/wiki/Most_significant_byte)还是最后读/写最高有效字节。Unicode/UTF-16，因为它们是可变长度编码（即每个字符可以用一个或多个字节表示），所以需要指定。（但请注意，UTF-8“字”的长度始终为 8 位/一个字节[尽管字符可以是多个点]，因此字节序没有问题。）如果表示 Unicode 文本的字节流的编码器和解码器未就使用的约定达成一致，可能会解释错误的字符代码。出于这个原因，要么事先知道字节顺序的约定，要么更常见的是[字节顺序标记](http://en.wikipedia.org/wiki/Byte_Order_Mark)通常在任何 Unicode 文本文件/流的开头指定，以指示使用的是大端还是小端。

# c++ - 从 C++ 程序创建 XML 文件

> ID：701648
> 
> 赞同：7
> 
> 时间：2009-03-31T15:43:26.983
> 
> 标签：c++

我有这个变量，一个双指针向量，如：

```
vector<double*> myIntersections; 
```

其中包含一个向量，其元素都是双精度的二维向量。我想创建一个 XML 文件（例如称为 myfile.axl - 具有此特定扩展名），其中文件的每一行都由向量的每个元素给出（因此在每一行上，必须至少有元素 vector[i ][0], vector[i][1]) 和 XML 文件的标签是 .. 等（所以用户定义）。该文件将 XML 应该是这样的：

```
<point name="intersectPoints" size="4" color="rgb">
  -2.68 1.82 0.0 255 0 0
  -2.63 1.03 0.0 255 0 0
</point> 
```

其中 vector[0][0]=-2.68, vector[0][1]=1.82 依此类推（0.0 255 0 0 始终相同）我知道如何用 C++ 编写文件（我正在考虑使用 fstream库），但我不知道如何创建 XML 标记（除了以这种方式使用字符串之外，它们将通过字符串）所以我有点迷失了。

任何建议都非常受欢迎。谢谢你的时间，马达琳娜

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-31T15:52:31.813

请。请不要自行创建 XML。

使用将生成有效且正确的 XML 文件的库。
同样的事情与阅读 XML 有关。您不会使用 ifstream 来读取 XML，是吗？所以如果你有 XML 库来读取 XML 文件，我很确定这个库允许创建 XML。

这是[tinyxml的示例代码](http://sourceforge.net/projects/tinyxml/)

```
int main()
{
    VertexList vl;

    vl.push_back( Vertex( Point3d( -2.68, 1.82, 0.0 ), RGB( 255, 0, 0 )));
    vl.push_back( Vertex( Point3d( -2.63, 1.03, 0.0 ), RGB( 255, 0, 0 )));

    std::ostringstream ss;
    std::for_each( vl.begin(), vl.end(), VertexPrint( ss ) );

    // write xml
    TiXmlDocument doc;
    TiXmlDeclaration decl( "1.0", "", "" );  
    doc.InsertEndChild( decl );  

    TiXmlElement point( "point" );  

    TiXmlComment comment( "My Points" );
    point.InsertEndChild( comment );  

    point.SetAttribute("name", "intersectPoints");
    point.SetAttribute("size", vl.size());
    point.SetAttribute("color", "rgb");

    TiXmlText values( ss.str() );
    point.InsertEndChild( values );  

    doc.InsertEndChild( point );  
    doc.SaveFile( "out.xml" );  
} 
```

在哪里`Vertex`

```
struct Point3d
{
    Point3d( double x, double y, double z ):
        x_(x), y_(y), z_(z)
    {}
    double x_;
    double y_;
    double z_;
};
struct RGB
{
    RGB( int r, int g, int b ):
        r_(r), g_(g), b_(b)
    {}
    int r_;
    int g_;
    int b_;
};
struct Vertex
{
    Vertex( const Point3d& coord, const RGB& color ):
        coord_( coord ), color_( color )
    {}
    Point3d coord_;
    RGB color_;
};
typedef std::vector< Vertex > VertexList; 
```

并且`VertexPrint`是

```
struct VertexPrint
{
    VertexPrint( std::ostringstream& result ):
        result_( result )
    {}
    void operator() ( const Vertex& v )
    {
        result_ << v.coord_.x_ <<" "<< v.coord_.y_ <<" "<< v.coord_.z_ <<" "
                << v.color_.r_ <<" "<< v.color_.b_ <<" "<< v.color_.b_ <<";";
    }
    std::ostringstream& result_;
}; 
```

您还可以考虑[提升 XML 序列化](http://www.boost.org/doc/libs/1_38_0/libs/serialization/example/demo_xml.cpp)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-31T15:47:04.057

查看[TinyXml](http://sourceforge.net/projects/tinyxml)。它非常轻巧。从文档中：

> TinyXML 使用文档对象模型 (DOM)，这意味着 XML 数据被解析为可以浏览和操作的 C++ 对象，然后写入磁盘或其他输出流。您还可以使用 C++ 对象从头开始构建 XML 文档，并将其写入磁盘或其他输出流。

我在自己的项目中使用过 TinyXml，使用起来很愉快。

编辑：除了 TinyXML，我还使用[了 ticpp](http://code.google.com/p/ticpp/) (TinyXml++)，它在库之上引入了 C++ 的更多特性（异常、模板、迭代器等）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T19:14:00.487

我使用 xerces 生成 XML 文件，它在内存和 CPU 使用方面非常昂贵。我最终在尝试生成只有几十万行 XML 的文件时遇到了“内存不足”异常。如果您可以像其他一些答案所建议的那样直接生成它，并且正如您的问题所暗示的那样，我会走那条路。读取和解析是另一回事，但使用 xerces 生成 XML 是多余的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T16:09:46.967

如果您只是在编写 XML，那么一个成熟的解析器就太过分了。最好看看像[Genx这样的东西](http://www.tbray.org/ongoing/genx/docs/Guide.html)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T15:46:51.000

假设您在 Windows 上并使用 Visual Studio，您可以使用[MSXML](http://msdn.microsoft.com/en-us/library/ms763742.aspx)或其他 3rd 方库。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-31T15:47:02.747

看一个黑客...

```
cout << "<point name=\"intersectPoints\" size=\"4\" color=\"rgb\">"<<endl;
cout << "  "<<-2.68<<" "<<1.82<<" "<<0.0<<" "<<255<<" "<<0<<" "<<0<<""; 
```

这就是我以很少的开销编写xml文件的方式，只需将原始xml保存到文件中。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-31T15:53:27.413

要读取和写入 xml 文件，您通常会使用[xml 解析器（基于 sax 或 dom）](http://en.wikipedia.org/wiki/Xml_parser#Processing_files)

我使用的是一个名为[xerces的 sax 解析器](http://xerces.apache.org/xerces-c/)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-31T16:01:02.777

我现在正在看 TinyXml。我已经下载了，希望可以安装。我使用 MacOSX，我可以看到适用于 Linux 的 Makefile 也已成功针对 MacOSX 进行了测试，因此我将尝试安装它，如果成功安装，则可以使用它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-31T16:06:06.913

对于像这样简单的事情，直接编写标签不会很复杂：

```
void WriteToFile(fstream& file, vector<double *> intersections)
{
    file << "<point";
    file << " name=\"intersectPoints\"";
    file << " size=\"" << intersections.size() "\"";
    file << " color=\"rgb\""
    file << ">\n"

    vector<double *>::iterator it;
    for (it=intersections.begin(); it != intersections.end(); it++)
    {
        file << (*it)[0] << " " << (*it)[1] << " " << (*it)[2] << " ";
        file << "255 0 0\n";
    }

    file << "</point>" << endl;
} 
```

# hibernate - 具有对现有表/POJO 的依赖关系的休眠映射文件

> ID：701649
> 
> 赞同：1
> 
> 时间：2009-03-31T15:43:28.793
> 
> 标签：hibernate, nhibernate-mapping, mapping

我们有一个从 hbm 映射文件创建的现有和工作数据库。

我们想为可选功能创建一些新表。

一种选择是这些新表始终存在，但我们希望表和 POJO 仅在请求时创建。

我的问题是这些表/POJO 依赖于现有的表/POJO。我已经创建了一个映射文件，但只有当它为现有表和新表以及它们的 POJO 创建创建/删除命令时，我才能让它工作。

我可以避免这个现有的表/POJO for Group 出现在创建脚本中吗？

在下面的示例中，Group 是一个现有的表/POJO。

```
 <id name="id" type="java.lang.Long">
        <column name="ID" not-null="true" />
    </id>

    <many-to-one name="group"
        class="uk.co.foo.domain.dfwv.Group"
        foreign-key="GROUP_FK" lazy="false" not-found="ignore">
        <meta attribute="use-in-tostring">false</meta>
        <column name="GROUP_NAME"
             not-null="true" />
    </many-to-one>
</class> 
```

生成它的 ant 目标如下，并且仅在列出依赖对象时才有效：

```
 <fileset dir="${dfwv.mappings.dir}">
                <include name="**/groups.hbm.xml" />
            </fileset>
        </configuration>
        <hbmtemplate exporterclass="uk.co.foo.hibernateutils.tools.Exporter" templateprefix="config/foopojo/" template="config/foopojo/Pojo.ftl">
            <property key="jdk5" value="true" />
            <property key="ejb3" value="false" />
        </hbmtemplate>
    </hibernatetool>
</target> 
```

如果没有对 Group 的依赖引用，我会收到错误消息：

构建失败 C:\projects\foo\db-build.xml:187：架构文本失败：来自表 DISCON_TEST 的关联引用了未映射的类：uk.co.foo.domain.dfwv.Group

**休眠版本：3.1.2**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-02T19:20:26.830

在您真正需要它们之前，您不能只注释掉映射吗？hibernate 需要提供的实体的完整元模型，不能只为其中一些实体创建“存根”

# asp.net - ASP.NET 2.0 PageComplete 事件问题和文件下载

> ID：701654
> 
> 赞同：0
> 
> 时间：2009-03-31T15:44:30.117
> 
> 标签：asp.net, download, page-lifecycle

我试图在整个 .aspx 页面显示后执行操作。“action”是一个使用 Response 对象向用户发送文件的函数。

**更多详细信息：**
我正在尝试从侧边栏复制页面上链接的行为。IE 我在主页上有一个导出操作的链接，它工作正常——因为该页面在用户单击它之前已经显示。但是当用户在侧边栏上单击链接时，它应该将他们带回此主页，然后在文件显示后发送文件。

我做了一些研究，并认为使用 PageComplete 事件非常适合这个，所以我创建了我的事件处理程序并将调用放在我的 PageComplete 中的导出代码（从侧边栏加载时它关闭查询字符串）事件处理程序。但它的行为方式相同 - 弹出浏览器下载框，并且该页面从未在之前或之后加载。

如果有助于理解我在这里所做的是用于将列表发送给用户的代码片段。

```
Response.Clear();
Response.BufferOutput = true;
Response.ContentType = "application/ms-excel";
Response.AppendHeader("content-disposition", "attachment;filename=MyList.xls");
Response.Write(listManager.ExportLists(mycode));
Response.End(); 
```

我更喜欢一种使用页面事件来加载页面的方法，而不是修补这个逻辑。但是，如果有一种干净且更简单的方法来发送文件，并且它允许加载页面然后发送文件，那也很好。

除了 PageComplete 之外，我还可以使用另一个 Page 事件，还是我可能遗漏了什么？

编辑：对冗长感到抱歉。我意识到我无法改变 HTTP 请求的工作方式——我只是在寻找一种可接受的解决方案，它可以实现或多或少相同的结果。似乎要走的路是在几秒钟后强制刷新页面（从而确保在执行文件下载代码之前加载它）——所以我正在寻找一种方法来作为第一个答案建议 - 刷新下载。（也不必延迟，如果有无需等待即可刷新的方法）

* * *

为什么这段代码不起作用？

```
 private void Page_LoadComplete(object sender, System.EventArgs e)
    {
        if (Request.QueryString["action"] != null)
        {
            if (Request.QueryString["action"] == "export")
            {
                Response.Redirect("MyHome.aspx?action=exportnow", false); 
            }

            if (Request.QueryString["action"] == "exportnow")
            {
                ExportMasterList();
            }
        }
    } 
```

它应该做什么：页面加载完成后，执行 Response.Redirect，使用不同的查询字符串重新加载自身。当它再次到达Page LoadComplete 事件时，第二次将触发写出文件的函数。

它实际上做了什么：显然重复了两次同样的问题......它又回到了同样的问题，页面加载后如何执行操作，或者等到页面完全加载完成，然后触发刷新，将执行行动？没有用户单击某些东西，ASP.NET 就没有办法自己做某事吗？

如果是这种情况，那么 2 秒后的自动刷新也是可以接受的……但我不知道该怎么做。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T15:46:53.857

服务器只能向用户返回一个对象，一个文件下载或一个页面。您可以管理的最好方法是将用户返回到刷新到文件下载的页面。

# performance - 从程序访问远程视频

> ID：701655
> 
> 赞同：0
> 
> 时间：2009-03-31T15:45:00.397
> 
> 标签：performance, video, streaming, testing

我想对我的内容管理网站进行压力/性能测试，尤其是托管流式视频部分。我正在使用 IIS 来托管视频。更具体地说，我使用的是新的 Windows Server 2008 x64 和 IIS 7.0。

困惑是，

1.  我打算编写代码来启动很多线程，并且在每个线程中我将向视频 URL 发送 Web 请求，并从服务器读取响应流，但我不确定这样是否与真实用户的行为相同使用播放器渲染视频（在我的代码中，我只是读取流，没有真正播放或写入任何地方）。我想尽可能地测试类似于真实场景的测试；

2.  我还计划使用真正的媒体播放器来渲染视频（或任何媒体播放器），但我担心如果我在我的测试机器上启动多个媒体播放器，因为媒体播放器将使用一些硬件或其他一些资源（显卡特定内存？）解码/渲染视频（不确定，需要大师帮助检查和确认），如果我启动多个播放器，播放器之间是否存在任何潜在的硬件或资源争用？如果存在争用，也不是实际的 ens 用户场景，即少数用户会在他/她的机器上启动 100 个播放器。:-)

有人对我有什么建议吗？

顺便说一句：我更喜欢使用任何基于 .Net 的解决方案，但不是必须的。

提前谢谢，乔治

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-03T12:47:02.447

你应该使用[mplayer](http://www.mplayerhq.hu/design7/dload.html)。它有很多命令行选项。我不知道所有这些选项在 Windows 下是如何可用的，但在 linux 下是可能的：

```
mplayer some_url -dump-video -dump-file=some_file 
```

我认为它的行为与“普通”播放器相同，并且您的测试机器不需要处理数百个解压缩线程，因此它符合您的需求 1 和 2

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-06-14T03:56:27.497

如果您知道视频流的比特率，您可以调整下载请求以模拟视频播放器客户端。码率可以根据流中携带的信息来计算，但是稍微复杂一些。也有对视频服务器进行压力测试的软件，比如这个[IP Video Monitor](http://www.mocomsoft.com/en-US/products/IPTVMonitoring.aspx)。

# distributed-cache - 分布式缓存中的“真实”对象引用？

> ID：701656
> 
> 赞同：1
> 
> 时间：2009-03-31T15:45:27.040
> 
> 标签：distributed-cache

我个人致力于 .net 分布式缓存解决方案，但我认为这个问题在所有平台上都很有趣。

是否有一个分布式缓存解决方案（或通用策略）允许在缓存中存储对象同时保持它们之间引用的完整性？

举例说明 - 假设我有一个`Foo foo`引用一个对象的对象`Bar bar`，并且还有一个引用`Foo foo2`该对象的对象`Bar bar`。如果我加载`foo`到缓存中，副本将`bar`与它一起存储。如果我也加载`foo2`到缓存中，`bar`则会同时存储一个单独的副本。如果我`foo.bar`在缓存中更改，更改不会影响`foo2.bar`:(

是否有现有的分布式缓存解决方案可以让我在维护引用的同时加载`foo`,`foo2`并`bar`进入缓存？`foo.bar` `foo2.bar`

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T16:05:11.830

**首先也是最重要的**

我不知道任何分布式系统，并且我不假装构建一个。这篇文章解释了如何使用带有可序列化对象的 IObjectReference 接口在 .NET 和 C# 中模拟这种行为。

**现在，让我们继续表演**

我不知道这样的分布式系统，但是您可以使用 .NET 使用[IObjectReference](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.iobjectreference.aspx)接口轻松实现这一目标。您的[ISerializable.GetObjectData](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.iserializable.getobjectdata.aspx)实现需要调用[SerializationInfo.SetType](http://msdn.microsoft.com/en-us/library/system.runtime.serialization.serializationinfo.settype.aspx)来指出一个实现 IObjectReference 的代理类，并且能够（在您的 GetObjectData 方法提供的数据的帮助下）获得对应该使用的真实对象的引用.

示例代码：

```
[Serializable]
internal sealed class SerializationProxy<TOwner, TKey> : ISerializable, IObjectReference {
    private const string KeyName = "Key";
    private const string InstantiatorName = "Instantiator";
    private static readonly Type thisType = typeof(SerializationProxy<TOwner, TKey>);
    private static readonly Type keyType = typeof(TKey);

    private static readonly Type instantiatorType = typeof(Func<TKey, TOwner>);
    private readonly Func<TKey, TOwner> _instantiator;
    private readonly TKey _key;

    private SerializationProxy() {
    }

    private SerializationProxy(SerializationInfo info, StreamingContext context) {
        if (info == null) throw new ArgumentNullException("info");

        _key = (TKey)info.GetValue(KeyName, keyType);
        _instantiator = (Func<TKey, TOwner>)info.GetValue(InstantiatorName, instantiatorType);
    }

    void ISerializable.GetObjectData(SerializationInfo info, StreamingContext context) {
        throw new NotSupportedException("This type should never be serialized.");
    }

    object IObjectReference.GetRealObject(StreamingContext context) {
        return _instantiator(_key);
    }

    internal static void PrepareSerialization(SerializationInfo info, TKey key, Func<TKey, TOwner> instantiator) {
        if (info == null) throw new ArgumentNullException("info");
        if (instantiator == null) throw new ArgumentNullException("instantiator");

        info.SetType(thisType);
        info.AddValue(KeyName, key, keyType);
        info.AddValue(InstantiatorName, instantiator, instantiatorType);
    }
} 
```

将从您的 GetObjectData 方法中使用 SerializationProxy.PrepareSerialization(info, myKey, myKey => LoadedInstances.GetById(myKey)) 调用此代码，并且您的 LoadedInstances.GetById 应该从 Dictionary<TKey, WeakReference> 返回实例或从缓存/数据库（如果尚未加载）。

编辑：

我写了一些示例代码来说明我的意思。

```
public static class Program {
    public static void Main() {
        // Create an item and serialize it.
        // Pretend that the bytes are stored in some magical
        // domain where everyone lives happily ever after.
        var item = new Item { Name = "Bleh" };
        var bytes = Serialize(item);

        {
            // Deserialize those bytes back into the cruel world.
            var loadedItem1 = Deserialize<Item>(bytes);
            var loadedItem2 = Deserialize<Item>(bytes);

            // This should work since we've deserialized identical
            // data twice.
            Debug.Assert(loadedItem1.Id == loadedItem2.Id);
            Debug.Assert(loadedItem1.Name == loadedItem2.Name);

            // Notice that both variables refer to the same object.
            Debug.Assert(ReferenceEquals(loadedItem1, loadedItem2));

            loadedItem1.Name = "Bluh";
            Debug.Assert(loadedItem1.Name == loadedItem2.Name);
        }

        {
            // Deserialize those bytes back into the cruel world. (Once again.)
            var loadedItem1 = Deserialize<Item>(bytes);

            // Notice that we got the same item that we messed
            // around with earlier.
            Debug.Assert(loadedItem1.Name == "Bluh");

            // Once again, force the peaceful object to hide its
            // identity, and take on a fake name.
            loadedItem1.Name = "Blargh";

            var loadedItem2 = Deserialize<Item>(bytes);
            Debug.Assert(loadedItem1.Name == loadedItem2.Name);
        }
    }

    #region Serialization helpers
    private static readonly IFormatter _formatter
        = new BinaryFormatter();

    public static byte[] Serialize(ISerializable item) {
        using (var stream = new MemoryStream()) {
            _formatter.Serialize(stream, item);
            return stream.ToArray();
        }
    }

    public static T Deserialize<T>(Byte[] bytes) {
        using (var stream = new MemoryStream(bytes)) {
            return (T)_formatter.Deserialize(stream);
        }
    }
    #endregion
}

// Supercalifragilisticexpialidocious interface.
public interface IDomainObject {
    Guid Id { get; }
}

// Holds all loaded instances using weak references, allowing
// the almighty garbage collector to grab our stuff at any time.
// I have no real data to lend on here, but I _presume_ that this
// wont be to overly evil since we use weak references.
public static class LoadedInstances<T>
    where T : class, IDomainObject {

    private static readonly Dictionary<Guid, WeakReference> _items
        = new Dictionary<Guid, WeakReference>();

    public static void Set(T item) {
        var itemId = item.Id;
        if (_items.ContainsKey(itemId))
            _items.Remove(itemId);

        _items.Add(itemId, new WeakReference(item));
    }

    public static T Get(Guid id) {
        if (_items.ContainsKey(id)) {
            var itemRef = _items[id];
            return (T)itemRef.Target;
        }

        return null;
    }
}

[DebuggerDisplay("{Id} {Name}")]
[Serializable]
public class Item : IDomainObject, ISerializable {
    public Guid Id { get; private set; }
    public String Name { get; set; }

    // This constructor can be avoided if you have a 
    // static Create method that creates and saves new items.
    public Item() {
        Id = Guid.NewGuid();
        LoadedInstances<Item>.Set(this);
    }

    #region ISerializable Members
    public void GetObjectData(SerializationInfo info, StreamingContext context) {
        // We're calling SerializationProxy to call GetById(this.Id)
        // when we should be deserialized. Notice that we have no
        // deserialization constructor. Fxcop will hate us for that.
        SerializationProxy<Item, Guid>.PrepareSerialization(info, Id, GetById);
    }
    #endregion

    public static Item GetById(Guid id) {
        var alreadyLoaded = LoadedInstances<Item>.Get(id);
        if (alreadyLoaded != null)
            return alreadyLoaded;

        // TODO: Load from storage container (database, cache).
        // TODO: The item we load should be passed to LoadedInstances<Item>.Set
        return null;
    }
} 
```

# php - 如何访问/转义名称中带有 $ 字符的 PHP 对象成员？

> ID：701663
> 
> 赞同：3
> 
> 时间：2009-03-31T15:46:39.177
> 
> 标签：php

我正在使用 json_decode 解码一些 JSON（来自 Youtube 数据 API），它给了我一个在 var_dump() ed 时看起来像这样的对象：

```
object(stdClass)[29]
  public 'type' => string 'text' (length=4)
  public '$t' => string 'Miley and Mandy! KCA VIDEO WINNERS' (length=34) 
```

如何访问 $t 成员？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-31T15:52:19.630

尝试

```
$member = '$t';
$obj->$member 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T15:54:41.027

您可以使用 json_decode 的第二个参数

```
$data = json_decode($text, true);
echo $data['$t']; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T18:43:38.110

仅当在引号之外或在双引号 ("$t") 内使用时，$t 才会被解释为变量引用。用单引号 ('$t') 括起来的字符串不会被解析为变量引用。

```
echo $data['$t']; 
```

会做你想做的事。

# php - 如何在 PHP 中对事件进行排序以将文件上传到亚马逊 S3

> ID：701667
> 
> 赞同：1
> 
> 时间：2009-03-31T15:46:57.507
> 
> 标签：php, amazon-ec2, amazon-s3, detect

我编写的一些 PHP 代码将文件上传到 S3，然后调用 EC2 实例对上传的文件执行操作，我得到了不同的结果。

这是我做事的顺序-

1）使用S3类放文件

```
$result = s3 -> putObjectFile($uploadDIR, $bucket, $name, S3::ACL) 
```

2) 检查 $result

```
if($result == "1") {
//file made it to s3 
```

3) 使用 cURL 调用 EC2 实例并对 S3 中的文件执行操作

我将它与视频文件一起使用，当我上传一个小视频文件时它可以正常工作（例如 3MB），但对于较大的视频（例如 80MB），代码似乎没有超过第 1 步。文件被移动到 s3 好的，但我猜是一段时间后 PHP 放弃等待查看 $result == 1 ，因此不执行其余代码。

处理此类事情的最佳方法是什么？如何检测文件已上传到 S3，然后运行一些代码？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T16:00:55.303

对于大文件，上传它们所需的时间可能会高于脚本的[max_execution_time](http://pt.php.net/manual/en/info.configuration.php#ini.max-execution-time)。

您可以只使用 set_time_limit() 函数，但对于网页来说它可能仍然不是一个好主意，因为脚本只会“挂”在那里而没有任何用户反馈（输出到浏览器）。

这可能会更好：

1.  使用 set_time_limit() 所以脚本不会死。
2.  将文件名存储在临时位置（数据库、会话等）并为其获取唯一 ID
3.  输出带有一些 AJAX 代码的页面，以（重复）查询第二个脚本以获取文件的状态（已完成、已失败、未定义？）
4.  在原始脚本上，等待操作完成并使用结果更新数据库。

# java - RMI 的动态代理存根实现

> ID：701672
> 
> 赞同：1
> 
> 时间：2009-03-31T15:48:17.767
> 
> 标签：java, rmi, dynamic-proxy

我想了解动态代理存根实现实际上是如何在幕后完成的。根据我阅读的内容，如果没有找到预先生成的存根类，则在导出远程对象时，RMI 运行时将生成一个动态代理来充当存根。然后将该存根绑定到 RMI 注册表，然后由某些 RMI 客户端访问。

问题是：既然存根实际上是一个动态生成的代理，它的类定义在客户端是不可用的，那么为什么客户端仍然能够从 RMI Registry 中检索存根呢？幕后是否发生了某种动态类加载，或者 RMI 是否使用另一种技术来解决这个问题？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2010-11-19T11:34:49.020

Java.lang.reflect.Proxy 是可序列化的，它在 ObjectOutputStream 和 ObjectInputStream 中有特殊的支持。基本上只是实现的接口和调用处理程序被序列化，并且在反序列化期间从中构造一个新的动态代理。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-03-31T16:19:26.460

RMI 确实使用动态类加载——类路径与调用一起作为客户端加载类的“类路径注释”发送。您可以查看 RMI 实现以获取更多信息 - 它作为 JDK 源代码的一部分提供。具体来说，ObjectOutputStream 和 RMIClassloader 类。

更新：RMI 不会启动 HTTP 服务器 - 事实上，您需要为此定制解决方案。您提到的其中一个可以是您运行的 HTTP 服务器，通过服务器使类可用，并在您的存根中使用 HTTP 服务器的地址/端口传递代码库，以便您的客户端可以下载它们。

# sql - Npgsql & Postgresql：错误：XX001：无法读取关系的块 2354

> ID：701679
> 
> 赞同：0
> 
> 时间：2009-03-31T15:49:48.637
> 
> 标签：sql, postgresql, npgsql

我有一项服务正在运行并插入数据（大量数据）。有时，这只是大约几周，我收到此错误：

```
ERROR: XX001: could not read block 2354 of relation 1663/17633/17925: read only 0 of 8192 bytes. 
```

此错误来自 PostGresql 的 Npgsql 连接器：

```
Exception trace:    at Npgsql.NpgsqlConnector.CheckErrors()
at Npgsql.NpgsqlConnector.CheckErrorsAndNotifications()
at Npgsql.NpgsqlCommand.ExecuteCommand()
at Npgsql.NpgsqlCommand.ExecuteNonQuery() 
```

如果我在 PGAdmin 中执行创建该错误的查询，我也会遇到此错误。任何人都知道为什么这个没有什么特别之处的插入查询会出现这个错误？这个表有一个主键但没有外键，我已经手动验证过，这个表不包含主键。

我该如何解决该错误？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T16:34:59.123

鉴于错误“XX001”被[列为](http://www.postgresql.org/docs/current/static/errcodes-appendix.html)“数据损坏”，您可能需要进行备份。

# c# - 如何将网页保存为图像

> ID：701680
> 
> 赞同：3
> 
> 时间：2009-03-31T15:49:55.797
> 
> 标签：c#, .net, winforms, webbrowser-control, mshtml

我有一个 WebBrowser 控件，我想将查看的整个页面保存为图像（任何网页）。我尝试使用 IHTMLElementRender 界面，但它不适用于所有网页。也许我做错了什么，因为有时快照包括滚动条，有时它只是部分的。你有一个可以将整个网页保存到图像的工作示例吗？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T16:08:57.077

有一篇[很棒的 CodeProject 文章](http://www.codeproject.com/KB/graphics/IECapture.aspx)展示了如何使用 IE 引擎完成这项任务。如果您更喜欢使用其他浏览器的渲染引擎，这是一个开始学习的好地方。Firefox也有[一个插件](https://addons.mozilla.org/en-US/firefox/addon/1146)可以做到这一点，你可以深入了解它的内部结构，以深入了解如何在 Firefox 中实现这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-10-26T09:45:47.760

如果网页在 JS 上很重，例如地图应用程序，则提供的解决方案将无法很好地工作。

发现此代码与 Webbrowser 控件一起使用更高效，在缺乏更好的...

```
private void waitTillLoad(WebBrowser webBrowser1)
{
   WebBrowserReadyState loadStatus;

   //wait till beginning of loading next page 
   int waittime = 100000;
   int counter = 0;
   while (true)
   {
       loadStatus = webBrowser1.ReadyState;
       Application.DoEvents();

       if ((counter > waittime) || (loadStatus == WebBrowserReadyState.Uninitialized) || (loadStatus == WebBrowserReadyState.Loading) || (loadStatus == WebBrowserReadyState.Interactive))
       {
           break;
       }
       counter++;
   }

   //wait till the page get loaded.
   counter = 0;
   while (true)
   {
       loadStatus = webBrowser1.ReadyState;
       Application.DoEvents();

       if (loadStatus == WebBrowserReadyState.Complete)
       {
           break;
       }
       counter++;

   }
} 
```

[归功于http://qualitypoint.blogspot.com/2009/03/c-webbrowser-control-synchronization.html](http://qualitypoint.blogspot.com/2009/03/c-webbrowser-control-synchronization.html)上的 QualityPoint Technologies

！

问候， byte_slave

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T11:41:39.117

您可以使用这些家伙[http://webthumb.bluga.net/home](http://webthumb.bluga.net/home)和以下代码。如果您只需要每月生成几张图像，它是免费的，但它们会收取更多费用。

（我与他们没有任何关系，我过去只是使用过这个）

```
public enum OutputType
    {
        Png,
        Jpg
    }

    public interface IWebThumbAPI
    {
        int Delay { get; set; }
        int Width { get; set; }
        int Height { get; set; }
        OutputType OutputType { get; set; }
        WebThumbAPI Get(string url);
        WebThumbAPI Get(string url, int x, int y, int width, int height);
        System.Drawing.Image SaveSize(WebThumbSize webThumbSize);
    }

    public class WebThumbAPI : IWebThumbAPI
    {
        private readonly string apiKey;
        private IList<WebThumbResponse> webThumbResponse;
        private string jobId;
        private string ApiUrl { get; set; }
        public int Delay { get; set; }
        public int Width { get; set; }
        public int Height { get; set; }
        public OutputType OutputType { get; set; }

        public WebThumbAPI(string apiKey)
            : this(apiKey, "")
        {
        }

        public WebThumbAPI(string apiKey, string jobId)
        {
            this.apiKey = apiKey;
            OutputType = OutputType.Png;
            Width = 1024;
            Height = 768;
            Delay = 5;
            ApiUrl = "http://webthumb.bluga.net/api.php";
            this.jobId = jobId;
        }

        public WebThumbAPI Get(string url)
        {
            return Get(url, 0, 0, 400, 200);
        }

        public WebThumbAPI Get(string url, int x, int y, int width, int height)
        {
            var outputType = OutputType == OutputType.Jpg ? "jpg" : "png";

            var doc = new XDocument(
                new XElement("webthumb",
                            new XElement("apikey", apiKey),
                             new XElement("request",
                                                 new XElement("url", url),
                                                 new XElement("outputType", outputType),
                                                 new XElement("width", Width),
                                                 new XElement("height", Height),
                                                 new XElement("delay", Delay),
                                                 new XElement("excerpt",
                                                     new XElement("x", x),
                                                     new XElement("y", y),
                                                     new XElement("width", width),
                                                     new XElement("height", height)))
                    )
                );

            var request = getRequest(doc.ToString());
            var webResponse = (HttpWebResponse)request.GetResponse();
            if (webResponse.ContentType == "text/xml")
            {
                var stream = webResponse.GetResponseStream();
                var response = XDocument.Load(XmlReader.Create(stream));
                webThumbResponse = (from xml in response.Descendants("job")
                                    select new WebThumbResponse
                                    {
                                        Estimate = (int)xml.Attribute("estimate"),
                                        Time = (DateTime)xml.Attribute("time"),
                                        Url = (string)xml.Attribute("url"),
                                        Cost = (int)xml.Attribute("cost"),
                                        Job = (string)xml.Value
                                    }).ToList();
                stream.Close();
                if (webThumbResponse.Count == 0)
                    jobId = "-1";
                else
                {
                    jobId = webThumbResponse[0].Job;
                    Thread.Sleep(webThumbResponse[0].Estimate * 1000);
                }

            }
            else
            {
                throw new InvalidOperationException("Failed request");
            }
            return this;
        }

        public System.Drawing.Image SaveSize(WebThumbSize webThumbSize)
        {
            if (jobId == "-1")
                return defaultImage(webThumbSize);
            var doc = new XDocument(
                new XElement("webthumb",
                            new XElement("apikey", apiKey),
                             new XElement("fetch",
                                                 new XElement("job", jobId),
                                                 new XElement("size", Enum.GetName(typeof(WebThumbSize), webThumbSize).ToLower())
                                                 )
                    )
                );
            var request = getRequest(doc.ToString());
            var webResponse = (HttpWebResponse)request.GetResponse();
            var stream = webResponse.GetResponseStream();

            Image image = null;
            try
            {
                image = System.Drawing.Image.FromStream(stream);
            }
            catch
            {
                image = defaultImage(webThumbSize);

            }
            return image;
        }

        private Image defaultImage(WebThumbSize webThumbSize)
        {
            var s = getSize(webThumbSize);
            var b = new Bitmap(s.Width, s.Height);
            var im = Image.FromHbitmap(b.GetHbitmap());
            var gr = System.Drawing.Graphics.FromImage(im);
            gr.Clear(Color.White);
            gr.Dispose();
            return im;
        }

        private static System.Drawing.Size getSize(WebThumbSize size)
        {
            switch (size)
            {
                case WebThumbSize.Small:
                    return new Size(80, 60);
                case WebThumbSize.Excerpt:
                    return new Size(400, 200);
                default:
                    return new Size(1, 1);
            }
        }

        private HttpWebRequest getRequest(string xml)
        {
            var request = (HttpWebRequest)WebRequest.Create(ApiUrl);
            request.Method = "POST";
            request.Timeout = 20000;
            request.ContentType = "text/xml";
            request.UserAgent = @"Mozilla/5.0 (Macintosh; U; PPC Mac OS X; en) AppleWebKit/418.8 (KHTML, like Gecko) Safari/419.3";
            request.KeepAlive = false;
            request.Pipelined = false;

            Stream newStream = request.GetRequestStream();
            var encoding = new ASCIIEncoding();
            byte[] data = encoding.GetBytes(xml);
            newStream.Write(data, 0, data.Length);
            newStream.Close();
            return request;
        }
    }

    public class WebThumbResponse
    {
        public DateTime Time;
        public string Job;
        public string Url;
        public int Cost;
        public int Estimate { get; set; }
    }

    public enum WebThumbSize
    {
        Small,
        Medium,
        Medium2,
        Large,
        Excerpt
    } 
```

# java - 如何读取 HttpServletReponses 输出流？

> ID：701681
> 
> 赞同：26
> 
> 时间：2009-03-31T15:49:56.093
> 
> 标签：java, http, servlets

我想制作一个 Servlet 过滤器，它会在处理和完成响应内容后读取它的内容，并以 XML 或 PDF 或其他格式返回该信息。但我不确定如何从 HttpServletResponse 对象中获取任何信息。我怎样才能获得这些信息？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-31T18:20:00.057

将此添加到过滤器 java 文件中。

```
static class MyHttpServletResponseWrapper 
  extends HttpServletResponseWrapper {

  private StringWriter sw = new StringWriter(BUFFER_SIZE);

  public MyHttpServletResponseWrapper(HttpServletResponse response) {
    super(response);
  }

  public PrintWriter getWriter() throws IOException {
    return new PrintWriter(sw);
  }

  public ServletOutputStream getOutputStream() throws IOException {
    throw new UnsupportedOperationException();
  }

  public String toString() {
    return sw.toString();
  }
} 
```

使用以下代码：

```
HttpServletResponse httpResponse = (HttpServletResponse) response;
MyHttpServletResponseWrapper wrapper = 
  new MyHttpServletResponseWrapper(httpResponse);

chain.doFilter(request, wrapper);

String content = wrapper.toString(); 
```

内容变量现在具有输出流。您也可以对二进制内容执行此操作。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2017-04-14T09:49:41.740

Spring now has feature for it . All you need to do is use [ContentCachingResponseWrapper], which has method public byte[] getContentAsByteArray() .

I Suggest to make WrapperFactory which will allow to make it configurable, whether to use default ResponseWrapper or ContentCachingResponseWrapper.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T15:58:27.837

我不太了解您可以从 HttpServletResponse 对象中获取数据。构建您的应用程序可能更有意义，以便将请求代理到适当的处理程序并与数据传输对象一起传递，您可以从中构建适当的最终响应。以这种方式，您永远不会修改多个响应对象或需要从中读取。

我知道，这不是一个直接的答案，但这就是我提出问题的方式。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T17:10:07.617

我认为您不一定可以这样做，因为写入输出流可能会导致数据在填充后调用任何 servlet 过滤器之前被刷新到客户端。正如*iftrue*所暗示的，建议使用不同的架构来生成您的 XML（比如说），然后以您想要的任何输出格式重新生成。

编辑：阅读您对*iftrue*帖子的回复后，如果您*真的*不能干扰当前的处理，也许您需要一个 servlet 来代理您的请求，从原始输出中捕获输出，然后酌情处理。非常讨厌，但是:-(

# c# - 从 .Net 2.0 标准 ASMX Web 服务客户端调用 .Net 3.5 WCF 服务

> ID：701684
> 
> 赞同：5
> 
> 时间：2009-03-31T15:51:06.280
> 
> 标签：c#, wcf, .net-3.5, .net-2.0, asmx

我创建了一个托管在安装了 .Net 3.5 的服务器上的服务，我需要从仅安装了 .Net 2.0 的客户端调用此服务。

有没有办法我可以做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-31T15:57:27.497

如果您的 WCF 服务使用 basicHttpBinding 公开一个端点，那么 .NET 2.0 客户端应该可以使用它。正如马克所说，“没问题”。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-31T17:51:48.640

是的，你可以做到。但是，有一些警告：

您必须使用匹配的协议。标准 .NET 2.0 库不支持许多安全 Web 服务功能；事实上，如果您想被默认安装的 .NET 2.0 使用，您几乎只能在 WCF 服务上使用 basicHttpBinding。这在许多企业场景中是一个严重的限制。但是，这可能就是您所需要的。

如果您需要更高的安全性但仍在使用 .NET 2.0，还有其他选择。同样，您的 WCF 服务必须适应您的 .NET 2.0 客户端，但您的 .NET 2.0 客户端还需要利用外部库。具体来说，您需要Microsoft 推出的[Web 服务增强功能。](http://www.microsoft.com/downloads/details.aspx?FamilyID=018a09fd-3a74-43c5-8ec1-8d789091255d&displaylang=en)但是请记住，这些库实现了一些 SOAP 协议的*beta*版本，而 WCF（在许多方面是 WSE 的继承者）默认实现了这些标准。由于协议中有一些重大更改（特别是 WS-Addressing），因此您必须在 WCF 服务上提供一个[customBinding](http://msdn.microsoft.com/en-us/library/ms731377.aspx)端点来适应。

不幸的是，我无法告诉您将使用哪种协议，因为这取决于您希望在服务上采用哪种协议，但您的大部分问题都可以通过更改自定义绑定的[textMessageEncoding的 messageVersion 来解决。](http://msdn.microsoft.com/en-us/library/ms731787.aspx)这不是最好的方案，但如果您尝试集成客户端，它可以为您带来一些好处。

归根结底，要让 .NET 2.0 客户端与 WCF 服务对话以获取除 basicHttpBinding 之外的任何内容，还有很多工作要做。在许多情况下，basicHttpBinding 可能就足够了。对于许多企业场景，它不会。我不能说哪个对你有帮助，但*有*可能让它发挥作用——我已经成功地做到了。

但这是一个很大的痛苦。如果可以，请寻找替代方案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-31T15:55:57.173

当然可以——托管在 .NET 3.5 上的服务不需要客户端上具有相同版本的 .NET 框架。哎呀——你甚至可以从 Java 或 PHP 调用这样的服务！这就是面向服务架构的全部*要点！*:-)

你需要定义你的服务契约（服务叫什么；可以调用什么方法）并且你需要决定如何托管它，例如你可以在什么地址调用这个服务，以及需要什么参数（例如HTTP 与 TCP，安全或不安全等） - 即使在 WCF 中也是如此。

这是 WCF 的三篇介绍性文章 - 查看它们！

*   [MSDN](http://msdn.microsoft.com/en-us/library/aa480190.aspx)
*   [代码项目](http://www.codeproject.com/KB/webservices/Programming_WCF.aspx)
*   [Dennis van der Stelt 的博客](http://bloggingabout.net/blogs/dennis/archive/2006/10/18/WCF-Part-0-_3A00_-Introduction.aspx)

但是从 .NET 2.0 客户端调用该服务绝对没问题！

马克

# sql-server - 遍历行集，获取与参数匹配的字段，然后从该行获取另一个字段

> ID：701687
> 
> 赞同：0
> 
> 时间：2009-03-31T15:51:22.567
> 
> 标签：sql-server, sql-server-2005, tsql

我有一个存储过程，它必须从我的用户表中获取密码。

我使用用户名作为参数。获取用户名字段内容与用户名参数匹配的行的最佳方法是什么，然后是密码（因为这是一个用户的用户名/密码对）。

游标是遍历行集的一种方法，但这些是不可取的。

我目前正在阅读一些 TSQL 书籍，但还没有遇到过此类问题。对 TSQL 书籍有什么好的建议吗？我在 Sql Server 2005 上。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T15:56:31.803

听起来您只需要一个标准`SELECT`查询：

```
SELECT username_column, password_column
FROM your_table
WHERE username_column = @usernameparam 
```

（还是我误解了这个问题？）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T16:07:55.707

> 从我的用户表中获取密码

这是您的第一个问题： ***永远不要***将真实密码存储在数据库中。查看 HashBytes() 函数并将其用于密码匹配。如果你认为你需要保留一个真实的密码，也许是为了让用户恢复丢失的密码，去[reddit](http://blog.moertel.com/articles/2006/12/15/never-store-passwords-in-a-database)上与人们交谈。

> 遍历行集的方法

这是你的第二个问题。您正在考虑自己迭代行。这称为命令式编程。虽然命令式代码非常适合您的普通客户端代码，但当您使用数据库时，它是倒退的。相反，您想开始使用声明式编程并以集合的形式思考：您编写一些代码向数据库声明您需要返回的记录集合：

```
SELECT [password] /*shudder*/ FROM [table] WHERE [username] = @username 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T15:57:50.413

从表中选择密码 WHERE 用户名 = @username

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T15:59:02.703

假设您的 users 表具有 UserName 和 Password 列，那么 SELECT 就可以正常工作。

选择用户名，密码来自用户 WHERE 用户名 = @username

但是，以这种方式存储密码可能不是最好的安全方式。

# javascript - 用 DHTML 做控制台的更好方法是什么？

> ID：701689
> 
> 赞同：0
> 
> 时间：2009-03-31T15:51:52.127
> 
> 标签：javascript, html, dom

我想找到一种将控制台消息输出到 HTML 页面的更好方法。这种方法似乎很慢。

```
<html>
<title>Logging test</title>
<head>
<SCRIPT LANGUAGE="JavaScript" TYPE="text/javascript">
<!--

function log(s) {
    if(!log.start) {
        var date = new Date();
        log.count = 0;
        _log("0", "log() started at " + date);
        log.start = date.valueOf();
    }
    _log(new Date().valueOf() - log.start, s);
}

function _log(header, s) {
    var logMessages = document.getElementById("logMessages");
    if(!logMessages) {
        alert(logMessages);
        return;
    }
    var message = document.createElement("div");
    message.className = "logMessage";
    var content = "";
    content += "<span class=\"time\">" + header + "</span>";
    content += "<span class=\"line\">" + (log.count++) + "</span>";
    content += "<span class=\"level\">" + "" + "</span>";
    content += "<span class=\"msg\">" + s.replace(/ /g, "&nbsp;").replace(/\n/g, "<BR />") + "</span>";
    message.innerHTML = content;
    logMessages.appendChild(message);
    setTimeout(function(){message.scrollIntoView(true)},1);
}

function main(e) {
    if(window.confirm("Would you like to display logging?")) {
        for(var i=0;i<5000;i++) {
            log("Hello World " + i);
        }
    }
}
//-->
</SCRIPT>

<style>
.logMessage {
    border-bottom: 1px black solid;
    font-size: 8pt;
    font-family: Lucida Console;
}

.logMessage .line, .logMessage .time {
    width: 30px;
}

.logMessage .level {
    display: none;
}

.logMessage .msg {
}

#logMessages {
    overflow: auto;
}
</style>

</head>
<body onload="main()">
<div id="logMessages"></div>
</body>

</html> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T16:49:51.910

Firebug 很好的是您正在使用 Firefox 来测试您的工作（假设您想要记录消息以进行调试）。如果您正在测试其他浏览器，您还可以使用[Firebug Lite](http://getfirebug.com/lite.html)，它在其他浏览器中模仿 Firebug 的功能。这样你就不必重新发明轮子了。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T16:03:08.387

这里的用例是什么？对于调试，Firebug 的[console.log](http://getfirebug.com/console.html)是我所能想象的。对于您的特定情况，如果您真的希望它进入页面并发现您当前的解决方案太慢，我肯定会用更有效的东西替换所有字符串连接（将字符串推入数组并将它们加入最后，或者抽象出来的 StringBuffer），因为 Javascript 中的字符串操作在[某些浏览器中是](http://www.sitepen.com/blog/2008/05/09/string-performance-an-analysis/)[臭名昭著的糟糕](http://ajaxian.com/archives/string-performance-in-ie-arrayjoin-vs-continued)（我在看着你，雷德蒙德！）

# asp.net - 如何：实现 n 级嵌套网格视图？

> ID：701691
> 
> 赞同：0
> 
> 时间：2009-03-31T15:52:31.097
> 
> 标签：asp.net, wcf, data-binding, nested-controls

在实施 UX 方面，我并不是最出色的。我在互联网上四处寻找嵌套网格视图或嵌套中继器控件的实现。大多数演示使用 sql 数据源对象。现在我没有看到任何人使用 sqldatasource。在我的场景中，我将使用对象数据源或手动进行数据绑定。数据源是 wsHttpBinding 上的 WCF 服务。

如果有人可以为我提供一些解决此问题的提示/网络资源，我将不胜感激。

提前致谢！！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T16:01:35.537

Telerik 做了一个可以使用 WCF 填充的出色网格（我使用它，它速度很快）： [http ://demos.telerik.com/aspnet-ajax/grid/examples/clientbinding/defaultcs.aspx](http://demos.telerik.com/aspnet-ajax/grid/examples/clientbinding/defaultcs.aspx)

...和层次结构： http: [//demos.telerik.com/aspnet-ajax/grid/examples/hierarchy/hierarchyloadmodeclient/defaultcs.aspx](http://demos.telerik.com/aspnet-ajax/grid/examples/hierarchy/hierarchyloadmodeclient/defaultcs.aspx)

还没有将两者结合起来，但看看对象模型，我相信它可以完成。

# vb.net - 将 Office 从 2003 升级到 2007 会破坏通过 COM 互操作使用 Excel 的 VB 程序吗？

> ID：701693
> 
> 赞同：2
> 
> 时间：2009-03-31T15:52:31.987
> 
> 标签：vb.net, excel, com, interop

假设 Office 2003 的所有痕迹都将从计算机中删除。

更新：

我知道我仍然可以使用 .xls 文件。我问的是通过 Excel 外部的 COM 互操作来自动化 Excel。当我向 VB 项目添加对 Excel 的引用时，它为我提供了不同版本的 Excel 的不同版本的 dll。如果一个程序是参考 Office 2003 的 dll 编译的，是否需要为 Office 2007 重新编译？是否需要更新代码才能使用新的 dll？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T16:45:56.023

您的代码破解应该没有问题。在我过去的经验中，即使我引用了旧版本的互操作程序集，新版本的 Excel 也能够处理这些调用。

现在，对于尝试将新版本的互操作程序集与旧版本的 Excel 一起使用，情况就不同了……

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T16:00:41.730

如果版本之间有许多重大变化，那将是非常令人惊讶的。据我了解，微软有许多使用 Office 的客户，他们不喜欢大量的重大更改。

在我看来，以上实际上是分析许多此类问题的有效方法：“ *x*可能发生”大致相当于“如果微软做了*x*会发生什么”。如果答案是“会发生一些非常糟糕的事情”，那么微软很可能提前发现了这一点。

当然，这不是 100% 有效的。“微软能否从 Visual Studio 2005 中删除 Web 应用程序项目”是一个反例。

# version-control - 分支很重要的 CVS 的替代品

> ID：701695
> 
> 赞同：2
> 
> 时间：2009-03-31T15:52:47.210
> 
> 标签：version-control

为我的雇主寻找更新/更好的 SCC 系统时遇到了一些困难。我个人的宠儿是 SVN，因为它兼容大量机器并且速度相对较快，但根据过去/现在的经验，它并不那么友好/容易进行分支。

需求评估如下：

1.  必须易于使用（CVS 被认为是简单的）
2.  分支机构必须是一等公民
3.  更喜欢 SVN 的存储库外部属性之类的机制
4.  必须对多个操作系统友好（linux、unix、Mac、MS Windows）
5.  专有/商业可能没问题，具体取决于许可费用

Git 作为一个选项退出了，因为一些机器正在运行 Vista，而让任何开发人员工具在该操作系统上以某种稳定感运行是一场噩梦。

我也在关注 Mercurial，但不确定它是否适合公司的运营方式。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-02T14:24:57.063

我在这里有偏见，但看看[Plastic SCM](http://www.plasticscm.com)。它易于使用（比 CVS 容易得多），而且完全是**关于分支**的。

如果您正在查看 Mercurial 或 GIT，也许您对分布式感兴趣，不是吗？如果是这样，塑料仍然是一种选择，因为 AFAIK 是唯一与 BitKeeper 一起分布式商业的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T16:04:14.547

既然已经实现了 mergeinfo 属性（从 v1.5 开始），SVN 的分支就更容易了。您只需分支并合并即可，它会记住哪些分支的哪些修订已在哪里合并。

显然我有点厌烦，但如果分支是你的主要问题，它确实让 svn 值得再看看。您不再需要在文本文件中保留注释，说明您已将哪些主干修订合并到您的分支中。你只是说“合并主干”。然后，您可以自动“重新集成”一个分支

虽然值得注意的是，您需要将 svn 服务器升级到 1.5 才能正常工作，但客户端向后兼容旧服务器，但您不会获得新功能。显然，在升级之前备份您的存储库。

哦，我相信 1.6 现在已经发布了，所以你不妨直接跳过它。当然 TortoiseSVN（以及 Visual Studio 用户的 VisualSVN）也随之而来。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T16:17:13.890

我的公司使用[Perforce](http://perforce.com)，我在分支机构和整合分支机构之间的变化方面度过了一段合理的时间。如果您绝对坚持，它甚至可以让您在不共享相同根目录的文件之间进行集成。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T18:22:10.143

使用 TortoiseSVN（可能还有许多其他我没有经验的客户端），创建分支是小菜一碟，将它们与其他分支合并或回到主干中只是稍微困难一些。如果您从 1.5 开始还没有尝试过分支/合并，那么 SVN 绝对值得一看！

# c# - 需要使用 win32 api 在 c# 中复制文件 - 我该怎么做？

> ID：701697
> 
> 赞同：3
> 
> 时间：2009-03-31T15:52:52.110
> 
> 标签：c#, .net, winapi

我正在尝试复制一些文件，有时名称的长度超过了 System.IO.File.Copy 方法可以接受的长度（根据抛出的异常，为 260 个字符）

根据我所做的研究，我应该能够将 win32 api 的文件方法与路径前的 \?\ 结合使用以获得 32,000 个字符的限制，但我不确定我需要导入的巫术方法。

有人可以帮我弄这个吗？我正在寻找类似的东西（显然是一个不同的功能，但你明白了）：

```
[DllImport("kernel32.dll", SetLastError = true, CharSet = CharSet.Unicode)]
    static extern SafeFileHandle CreateFileW(string lpFileName, uint dwDesiredAccess,
                                          uint dwShareMode, IntPtr lpSecurityAttributes, uint dwCreationDisposition,
                                          uint dwFlagsAndAttributes, IntPtr hTemplateFile); 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T15:57:34.407

```
[DllImport("kernel32.dll",
           CharSet = CharSet.Unicode,
           CallingConvention = CallingConvention.StdCall,
           SetLastError = true)]
[return: MarshalAs(UnmanagedType.Bool)]
static extern bool CopyFile(
                   [MarshalAs(UnmanagedType.LPWStr)] string lpExistingFileName,
                   [MarshalAs(UnmanagedType.LPWStr)] string lpNewFileName,
                   [MarshalAs(UnmanagedType.Bool)] bool bFailIfExists); 
```

[http://www.pinvoke.net/default.aspx/kernel32/CopyFile.html](http://www.pinvoke.net/default.aspx/kernel32/CopyFile.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T15:57:41.240

尝试使用[CopyFile](http://msdn.microsoft.com/en-us/library/aa363851(VS.85).aspx)。

对于 PInvoke 语法，您可以查看[pinvoke.net](http://pinvoke.net/default.aspx/kernel32/CopyFile.html)。

# wpf - WPF：更改给定容器中所有控件的字体

> ID：701698
> 
> 赞同：13
> 
> 时间：2009-03-31T15:53:04.433
> 
> 标签：wpf, formatting

如何更改容器中所有子控件的字体，例如 Canvas？我想要一个滑块，这样用户就可以一次控制屏幕上所有内容的字体大小。

谢谢

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-31T16:20:03.247

容器的 FontSize 属性应由子控件继承，除非它们显式覆盖该属性。

```
<Canvas TextElement.FontSize="20">
    <TextBlock>Sample Text</TextBlock>
</Canvas> 
```

但是，某些控件不遵循正常的继承机制。ListBox 和 Button 不从父级继承其背景设置，尽管它们确实继承了字体属性。

# c++ - 分配给临时（如 5 = 10，但用于用户定义的类型）

> ID：701699
> 
> 赞同：2
> 
> 时间：2009-03-31T15:53:09.003
> 
> 标签：c++

在为此链接做了一些测试代码之后：
[调用临时对象的方法是否安全？](https://stackoverflow.com/questions/701313/is-it-safe-to-call-temporary-objects-methods)
我发现了 c++ 语言的一个相当奇怪的特性，我不确定它是如何工作的：

```
struct Test{
    int i;
    Test(int ii):i(ii){}
    Test& operator=(int ii){
        i = ii;
        return *this;
    }
    Test operator+(const Test& rhs){
        return Test(i + rhs.i);
    }
    void non_const_function(){
        i *= i;
    }
};

int main(){
        //code below gives errors, builtin types don't allow evil code
        //int i = 5+5 = 8;
        //int& iRef = 5+5;
        //int* iPtr = &(5+5);
        //5 = 10;

        Test x = Test(5) + Test(5) = 8;//assign to a temporary
        Test& xRef = Test(5) + Test(5);//reference to a temporary
        Test* xPtr = &(Test(5) + Test(5));//address of a temporary
        Test(5) = Test(10);//assign to a temporary
        Test(8).non_const_function();//call a non-const function
        return 0;
} 
```

xRef 和 xPtr 都是工作指针，具有预期值。
当然，我不会在真正的项目中编写这样的代码，但我仍然对它的工作原理/原因感兴趣。
我在谷歌上找到的唯一信息是“如果您创建对临时的引用，则临时生命周期与引用的生命周期相关联”

注意：
- 并非所有编译器都如此宽容，例如 Metrowerks ARM（它使用 GCC 吗？）只允许 const 对临时对象的引用。
编辑：
- 在 VC++ 2008 中增加对 W4 的警告显示了很多错误 - 很高兴知道。

编辑2：
谢谢大家的帮助。我回来工作了，修复了 100 条警告。
结论：从一开始就使用最高警告（由于/G4，我什至发现了一个真正的错误）

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-31T16:06:20.487

让我们逐行进行：

```
 Test x = Test(5) + Test(5) = 8;//assign to a temporary 
```

这里没什么大不了的。临时对象仍然只是普通对象，因此赋值运算符对它们的工作就像对其他任何事物一样。

```
 Test& xRef = Test(5) + Test(5);//reference to a temporary 
```

像 Metroworks 一样，我的 GCC 不允许对临时对象进行非常量引用。

```
 Test* xPtr = &(Test(5) + Test(5));//address of a temporary 
```

此外，出于显而易见的原因，GCC 警告不要使用临时地址。

```
 Test(5) = Test(10);//assign to a temporary 
```

同样，这只是分配，正如我上面解释的，这没什么大不了的。

```
 Test(8).non_const_function();//call a non-const function 
```

临时对象不是恒定的。没有什么能阻止他们调用非常量函数。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-31T16:02:23.630

这种事情在许多面向对象的编程语言中无处不在，尤其是那些具有对象重载的语言。

如果写了第一个语句

```
Text x = Test(5).add(Test(5)).set(8); 
```

其中 .add 和 .set 返回具有预期值的左侧 Test 实例，您还会感到困惑吗？

为了分解这个例子，你要创建一个值为 5 的 Test 对象，然后添加另一个值为 5 的 Test 对象，并返回第一个 Test 对象，现在值为 10。然后你将它的值设置为 8，并将该对象分配给 x（实际上它不是分配，您再次创建一个名为 x 的测试对象，然后将其值设置为临时值）。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-31T16:26:52.357

关于第一种情况，分配给一个临时的，我记得从我的 Effective C++ 中，声明你的操作符是一个好习惯

```
const Test operator+(const Test&) const 
```

至少在这方面，这将使对象表现得像内置类型。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T15:58:28.837

赋值运算符只是一个名字很有趣的函数。如果你可以在一个临时对象上调用一个函数（你可以），那么你可以分配给一个临时对象，给定一个合适的 operator=()。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-31T16:07:50.217

我对您的问题的阅读告诉我，您对临时工的寿命比其他任何事情都感到困惑。我认为如果你在`cout`下面放几个 s 会有所帮助：

```
struct Test{
    int i;
    Test(int ii):i(ii){ std::cout << "new object\n"; }
    Test& operator=(int ii){
        i = ii;
        return *this;
    }
    Test operator+(const Test& rhs){
        return Test(i + rhs.i);
    }
    void non_const_function(){
        i *= i;
    }
    ~Test() { std::cout << "deleting ...\n"; }
}; 
```

现在运行，您应该能够看到引擎盖下到底发生了什么。（风格检查：不检查自我分配不是一件好事。）

如果您参考标准也会有所帮助：它讨论了与您发布的内容类似的内容：

> **12.2 临时对象**
> 
> 4 有两种情况，其中临时对象在与完整表达式结尾不同的点被销毁。第一个上下文是调用默认构造函数来初始化数组元素时。如果构造函数有一个或多个默认参数，则在默认参数表达式中创建的每个临时变量的销毁将在构造下一个数组元素（如果有）之前进行排序。
> 
> 5 第二个上下文是引用绑定到临时的。引用绑定到的临时对象或作为引用绑定到的子对象的完整对象的临时对象将在引用的生命周期内持续存在，除非下面指定。临时绑定到构造函数的 ctor-initializer (12.6.2) 中的引用成员将持续存在，直到构造函数退出。临时绑定到函数调用 (5.2.2) 中的引用参数将持续存在，直到包含调用的完整表达式完成。在函数返回语句 (6.6.3) 中对返回值的临时绑定将持续存在，直到函数退出。临时绑定到 new-initializer (5.3.4) 中的引用将持续到包含 new-initializer 的完整表达式完成为止。

```
 struct S { int mi; const std::pair<int,int>& mp; };
 S a { 1, {2,3} };
 S* p = new S{ 1, {2,3} }; // Creates dangling reference 
```

> [注意：这可能会引入悬空引用，鼓励实现在这种情况下发出警告。—尾注] 其生命周期未通过绑定到引用而延长的临时对象的销毁在销毁之前在同一个完整表达式中构造的每个临时对象之前进行排序。如果引用绑定到的两个或多个临时对象的生命周期在同一点结束，则这些临时对象在该点以与它们的构造完成相反的顺序被销毁。此外，绑定到引用的临时对象的销毁应考虑具有静态、线程或自动存储持续时间（3.7.1、3.7.2、3.7.3）的对象的销毁顺序；也就是说，如果`obj1`是一个与临时对象具有相同存储期限的对象，并且在创建临时对象之前创建，临时对象应在销毁之前`obj1`销毁；如果`obj2`是一个与临时对象具有相同存储期限并且在创建临时对象之后创建的对象，则临时对象应在销毁后`obj2`销毁。*例子：*

```
 struct S {
    S();
    S(int);
    friend S operator+(const S&, const S&);
    ~S();
 };
 S obj1;
 const S& cr = S(16)+S(23);
 S obj2; 
```

> 该表达式`C(16)+C(23)`创建了三个临时对象。第一个临时`T1`保存表达式的结果`C(16)`，第二个临时`T2`保存表达式的结果，`C(23)`第三个临时`T3`保存这两个表达式相加的结果。然后将临时`T3`绑定到引用`cr`。未指定是否先创建`T1`或`T2`先创建。`T1`在之前创建的实现上`T2`，保证`T2`之前被销毁`T1`。临时变量`T1`和`T2`绑定到 的参考参数`operator+`；这些临时对象在包含调用的完整表达式结束时被销毁`operator+`。临时的`T3`绑定到引用的对象在 的生命周期`cr`结束时被销毁`cr`，即在程序结束时。另外，`T3`销毁的顺序考虑了其他具有静态存储时长的对象的销毁顺序。也就是因为`obj1`是在之前构造`T3`，并且`T3`在之前构造`obj2`，所以保证了`obj2`在之前被销毁`T3`，并且`T3`在之前被销毁`obj1`。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-31T16:47:59.777

看看[GotW #4](http://www.gotw.ca/gotw/004.htm)，它讨论了创建用户定义类的机制，该类最接近内置算术类型。如果您接受他的建议，您的 Test 结构将看起来更像这样：

```
struct Test{
    ...
    Test& operator+=( const Test& other ) {
        i += other.i;
        return *this;
    }
    ...
};

const Test operator+( const Test& lhs, const Test& rhs ) {
    Test ret( lhs );
    ret += rhs;
    return ret;
} 
```

现在 Test 在添加情况下表现得更好（第 1、2 和 3 行编译失败）。这是返回 const 副本实际上有用的少数情况之一，

# python - 将 HTML 实体转换为 Unicode，反之亦然

> ID：701704
> 
> 赞同：74
> 
> 时间：2009-03-31T15:54:25.287
> 
> 标签：python, html, html-entities

如何在 Python 中将 HTML 实体转换为 Unicode，反之亦然？

* * *

## 回答 #1

> 赞同：106
> 
> 时间：2010-04-17T06:13:38.070

至于“反之亦然”（我需要自己，导致我找到这个没有帮助的问题，然后是[另一个有答案的网站](http://www.megasolutions.net/python/Unicode-to-HTML-entities-78703.aspx)）：

```
u'some string'.encode('ascii', 'xmlcharrefreplace') 
```

将返回一个纯字符串，其中任何非 ascii 字符都转换为 XML (HTML) 实体。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-03-31T15:57:56.340

你需要有[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)。

```
from BeautifulSoup import BeautifulStoneSoup
import cgi

def HTMLEntitiesToUnicode(text):
    """Converts HTML entities to unicode.  For example '&amp;' becomes '&'."""
    text = unicode(BeautifulStoneSoup(text, convertEntities=BeautifulStoneSoup.ALL_ENTITIES))
    return text

def unicodeToHTMLEntities(text):
    """Converts unicode to HTML entities.  For example '&' becomes '&amp;'."""
    text = cgi.escape(text).encode('ascii', 'xmlcharrefreplace')
    return text

text = "&amp;, &reg;, &lt;, &gt;, &cent;, &pound;, &yen;, &euro;, &sect;, &copy;"

uni = HTMLEntitiesToUnicode(text)
htmlent = unicodeToHTMLEntities(uni)

print uni
print htmlent
# &, ®, <, >, ¢, £, ¥, €, §, ©
# &amp;, &#174;, &lt;, &gt;, &#162;, &#163;, &#165;, &#8364;, &#167;, &#169; 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2015-03-03T08:43:24.993

Python 2.7 和 BeautifulSoup4 的更新

Unescape -- Unicode HTML to unicode with `htmlparser`(Python 2.7 standard lib):

```
>>> escaped = u'Monsieur le Cur&eacute; of the &laquo;Notre-Dame-de-Gr&acirc;ce&raquo; neighborhood'
>>> from HTMLParser import HTMLParser
>>> htmlparser = HTMLParser()
>>> unescaped = htmlparser.unescape(escaped)
>>> unescaped
u'Monsieur le Cur\xe9 of the \xabNotre-Dame-de-Gr\xe2ce\xbb neighborhood'
>>> print unescaped
Monsieur le Curé of the «Notre-Dame-de-Grâce» neighborhood 
```

Unescape -- Unicode HTML 到 unicode `bs4`(BeautifulSoup4)：

```
>>> html = '''<p>Monsieur le Cur&eacute; of the &laquo;Notre-Dame-de-Gr&acirc;ce&raquo; neighborhood</p>'''
>>> from bs4 import BeautifulSoup
>>> soup = BeautifulSoup(html)
>>> soup.text
u'Monsieur le Cur\xe9 of the \xabNotre-Dame-de-Gr\xe2ce\xbb neighborhood'
>>> print soup.text
Monsieur le Curé of the «Notre-Dame-de-Grâce» neighborhood 
```

`bs4`转义 -- 使用(BeautifulSoup4)对 HTML 进行 Unicode 编码：

```
>>> unescaped = u'Monsieur le Curé of the «Notre-Dame-de-Grâce» neighborhood'
>>> from bs4.dammit import EntitySubstitution
>>> escaper = EntitySubstitution()
>>> escaped = escaper.substitute_html(unescaped)
>>> escaped
u'Monsieur le Cur&eacute; of the &laquo;Notre-Dame-de-Gr&acirc;ce&raquo; neighborhood' 
```

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2014-07-09T00:02:40.287

正如*hekevintran*回答所暗示的那样，您可以使用`cgi.escape(s)`编码字符串，但请注意，该函数中的引号编码默认为 false，并且将`quote=True`关键字参数与字符串一起传递可能是个好主意。但即使通过`quote=True`，该函数也不会转义单引号 ( `"'"`) （由于这些问题，该函数自 3.2 版以来已被[弃用）](https://docs.python.org/dev/library/cgi.html#cgi.escape)

建议使用`html.escape(s)`而不是`cgi.escape(s)`. （版本 3.2 中的新功能）

`html.unescape(s)`在 3.4 版本中也[引入了](https://docs.python.org/dev/library/html.html#html.unescape)。

所以在 python 3.4 中你可以：

*   用于`html.escape(text).encode('ascii', 'xmlcharrefreplace').decode()`将特殊字符转换为 HTML 实体。
*   并将`html.unescape(text)`HTML 实体转换回纯文本表示。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2019-10-08T17:24:02.353

```
$ python3 -c "
> import html
> print(
>     html.unescape('&amp;&#169;&#x2014;')
> )"
&©—

$ python3 -c "
> import html
> print(
>     html.escape('&©—')
> )"
&amp;©—

$ python2 -c "
> from HTMLParser import HTMLParser
> print(
>     HTMLParser().unescape('&amp;&#169;&#x2014;')
> )"
&©—

$ python2 -c "
> import cgi
> print(
>     cgi.escape('&©—')
> )"
&amp;©— 
```

HTML 仅严格要求`&`(&) 和`<`(左尖括号/小于号) 进行转义。[https://html.spec.whatwg.org/multipage/parsing.html#data-state](https://html.spec.whatwg.org/multipage/parsing.html#data-state)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2020-05-06T23:22:20.613

`python3`使用`html.unescape()`：_

```
import html
s = "&amp;"
decoded = html.unescape(s)
# & 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-02-08T15:14:15.913

如果像我这样的人想知道为什么某些实体编号（代码）`&#153; (for trademark symbol), &#128; (for euro symbol)`没有正确编码，原因是在 ISO-8859-1（又名 Windows-1252）中没有定义这些字符。

另请注意，html5 的默认字符集是 utf-8，它是 html4 的 ISO-8859-1

所以，我们将不得不以某种方式解决（首先找到并替换那些）

Mozilla 文档中的参考（起点）

[https://developer.mozilla.org/en-US/docs/Web/Guide/Localizations_and_character_encodings](https://developer.mozilla.org/en-US/docs/Web/Guide/Localizations_and_character_encodings)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-05-17T14:18:29.923

我使用以下函数将从 xls 文件中提取的 unicode 转换为 html 文件，同时保留 xls 文件中的特殊字符：

```
def html_wr(f, dat):
    ''' write dat to file f as html
        . file is assumed to be opened in binary format
        . if dat is nul it is replaced with non breakable space
        . non-ascii characters are translated to xml       
    '''
    if not dat:
        dat = '&nbsp;'
    try:
        f.write(dat.encode('ascii'))
    except:
        f.write(html.escape(dat).encode('ascii', 'xmlcharrefreplace')) 
```

希望这对某人有用

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-04-16T15:17:21.560

```
#!/usr/bin/env python3
import fileinput
import html

for line in fileinput.input():
    print(html.unescape(line.rstrip('\n'))) 
```

# asp.net - JQuery/Javascript：asp.net 数据网格输出的客户端修改以允许表排序器工作

> ID：701706
> 
> 赞同：4
> 
> 时间：2009-03-31T15:55:11.697
> 
> 标签：asp.net, javascript, jquery, tablesorter

asp.net 数据网格的输出不包括 jquery tablesorter 工作所需的 thead 和 tbody 元素。

例如，它看起来像这样：

```
 <table>
        <tr>this is my header row</tr>
        <tr>content row 1</tr>
        <tr>content row 2</tr>
        <tr>content row 3</tr>
        ...
        <tr>content row n</tr>
    </table> 
```

它需要看起来像这样：

```
 <table>
        <thead>
            <tr>this is my header row</tr>
        </thead>
        <tbody>
            <tr>content row 1</tr>
            <tr>content row 2</tr>
            <tr>content row 3</tr>
            ...
            <tr>content row n</tr>
        </tbody>
    </table> 
```

我敲了以下 javascript 来动态插入它们，但表格仍然不可排序。我已经确认，如果我手动将 thead 和 tbody 标签直接插入到输出 html 中，表格是可排序的，但是当我尝试使用 DOM 进行排序时，它似乎不起作用。

我错过了什么？

```
 $(document).ready(function() 
        { 
            var tbl = document.getElementById('mytableid');

            // new header and body elements to be inserted
            var tblHead = document.createElement('thead');
            var tblBody = document.createElement('tbody');
            // get the first row and the remainder
            var headerRow = $(tbl).find('tr:first')
            var bodyRows  = $(tbl).find('tr:not(:first)');

            // remove the original rows
            headerRow.remove();
            bodyRows.remove();

            // add the rows to the header and body respectively
            $(tblHead).append(headerRow);
            $(tblBody).append(bodyRows);

            // add the head and body into the table
            $(tbl).append(tblHead);
            $(tbl).append(tblBody);

            // apply the tablesorter
            $(tbl).tablesorter(); 
        } 
    ); 
```

编辑：我实际上在发布问题之前解决了这个问题，但我想我还是会继续发布它，因为它可能对其他人有用......请参阅下面的答案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T15:55:32.867

显然，输出中出现了一个幻像 <tbody> 元素。诀窍是确保在添加生成的之前将其删除......希望这对某人有用！

```
 $(document).ready(function() 
        { 
            var tbl = document.getElementById('mytableid');

            // new header and body elements to be inserted
            var tblHead = document.createElement('thead');
            var tblBody = document.createElement('tbody');
            // get the first row and the remainder
            var headerRow = $(tbl).find('tr:first')
            var bodyRows  = $(tbl).find('tr:not(:first)');

            // remove the original rows
            headerRow.remove();
            bodyRows.remove();

            // SOLUTION HERE: 
            // remove any existing thead/tbody elements
            $(tbl).find('tbody').remove();
            $(tbl).find('thead').remove();

            // add the rows to the header and body respectively
            $(tblHead).append(headerRow);
            $(tblBody).append(bodyRows);

            // add the head and body into the table
            $(tbl).append(tblHead);
            $(tbl).append(tblBody);

            // apply the tablesorter
            $(tbl).tablesorter(); 
        } 
    ); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-02T16:55:50.467

上面的代码仍然没有解决标题中的单元格。要将它们从标签转换为标签，您可以添加以下内容：

`$('thead tr td').each(function(i) { $(this).replaceWith("<th>" + $(this).html() + "<\/th>"); });`

# c# - 如何从 int[][] 中删除重复项

> ID：701707
> 
> 赞同：1
> 
> 时间：2009-03-31T15:55:13.803
> 
> 标签：c#, .net, arrays, duplicates

我有一个数组数组-有关使用 VSTO 在 Excel 中进行选择的信息，其中每个元素表示开始和结束选择位置。

例如，

```
int[][] selection = {
new int[] { 1 }, // column A
new int[] { 6 }, // column F
new int[] { 6 }, // column F
new int[] { 8, 9 } // columns H:I
new int[] { 8, 9 } // columns H:I
new int[] { 12, 15 } // columns L:O
}; 
```

你能帮我找到一种方法，也许使用 LINQ 或扩展方法，来删除重复的元素吗？我的意思是：`F`和`F`，`H:I`和`H:I`，等等。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T16:19:04.153

如果您想使用纯 LINQ/扩展方法解决方案，那么您需要`IEqualityComparer`为数组/序列定义自己的实现。（除非我遗漏了一些明显的东西，否则 BCL 中没有预先存在的数组或序列比较器）。然而，这并不难——这是一个应该很好地完成工作的例子：

```
public class SequenceEqualityComparer<T> : IEqualityComparer<IEnumerable<T>>
{
    public bool Equals(IEnumerable<T> x, IEnumerable<T> y)
    {
        return Enumerable.SequenceEqual(x, y);
    }

    // Probably not the best hash function for an ordered list, but it should do the job in most cases.
    public int GetHashCode(IEnumerable<T> obj)
    {
        int hash = 0;
        int i = 0;
        foreach (var element in obj)
            hash = unchecked((hash * 37 + hash) + (element.GetHashCode() << (i++ % 16)));
        return hash;
    }
} 
```

这样做的好处是您可以简单地调用以下命令来删除任何重复的数组。

```
var result = selection.Distinct(new SequenceEqualityComparer<int>()).ToArray(); 
```

希望有帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T16:27:47.347

首先，您需要一种比较整数数组的方法。要将它与框架中的类一起使用，您可以通过创建 EquailtyComparer 来实现。如果数组总是排序的，那很容易实现：

```
public class IntArrayComparer : IEqualityComparer<int[]> {

    public bool Equals(int[] x, int[] y) {
        if (x.Length != y.Length) return false;
        for (int i = 0; i < x.Length; i++) {
            if (x[i] != y[i]) return false;
        }
        return true;
    }

    public int GetHashCode(int[] obj) {
        int code = 0;
        foreach (int value in obj) code ^= value;
        return code;
    }

} 
```

现在您可以使用整数数组作为 HashSet 中的键来获取唯一数组：

```
int[][] selection = {
    new int[] { 1 }, // column A
    new int[] { 6 }, // column F
    new int[] { 6 }, // column F
    new int[] { 8, 9 }, // columns H:I
    new int[] { 8, 9 }, // columns H:I
    new int[] { 12, 15 } // columns L:O
};

HashSet<int[]> arrays = new HashSet<int[]>(new IntArrayComparer());
foreach (int[] array in selection) {
    arrays.Add(array);
} 
```

HashSet 只是丢弃了重复值，因此它现在包含四个整数数组。

# linux - 操作系统调度算法

> ID：701721
> 
> 赞同：3
> 
> 时间：2009-03-31T15:57:55.263
> 
> 标签：linux, multithreading, kernel, scheduling, bsd

用于调度支持 10K 并发线程且 I/O 繁重但 CPU 使用率低的应用程序的最佳算法是什么？论文链接表示赞赏。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T16:08:17.453

为什么不使用 SCHED_RR？你自己说的：**低CPU使用率**。当您期望执行一些繁重的 I/O 时，您甚至可以对进程进行优化，这样您的调度频率就会低于其他进程。

不过，总的来说，为什么不让操作系统做它最擅长的事情，而只担心编写高效的代码呢？操作系统会知道您正在执行阻塞 I/O 调用，并将您的线程/任务放在等待队列中并选择另一个任务来运行。您无需担心这些细节。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T17:11:21.280

实际上，我相信没有调度机制可以完美地处理这么多线程，因为内核中的管理表会变得非常大。

如果可能的话，我建议重写应用程序以在您选择的操作系统上使用异步 I/O、select() 或类似的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-01T05:24:26.340

为此，您可能需要 SCHED_RR。您可能有兴趣阅读有关[SCHED_FIFO 和 SCHED_RR 之间区别](https://stackoverflow.com/questions/405246/on-linux-schedfifo-and-schedrr)的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-15T09:53:09.853

您的问题与 I/O 调度比线程调度更相关。linux 内核提供了各种 I/O 调度器实现。[您可以在本期](http://lwn.net/Articles/308809/)LWN中找到有关此主题的好文章。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-01T05:50:50.473

正如 grover 所建议的那样，您还可以使用一些线程池机制，这些机制占用的资源较少，并且至少可以在一定程度上解决您的目的，如果不能完全解决的话

# xml - 从 XSL 中的 CDATA 标记内呈现 HTML 标记

> ID：701723
> 
> 赞同：12
> 
> 时间：2009-03-31T15:58:10.410
> 
> 标签：xml, xslt, cdata

我的 XML 代码中有一个 CDATA 标记，其中包含一些超链接。

```
<smartText><![CDATA[
Among individual stocks, the top percentage gainers in the S.&P. 500 are
<a href ='http://investing.domain.com/research/stocks/snapshot
/snapshot.asp?ric=LNC'>Lincoln National Corp</a> and 
<a href ='http://investing.domain.com/research/stocks/snapshot
/snapshot.asp?ric=PLD'>ProLogis</a>.]]>
</smartText> 
```

我正在尝试将其转换为 HTML 页面，如下所示...

```
<p class="smartText">
    <xsl:copy-of select="marketSummaryModuleData/smartText"/>                                    
</p> 
```

不幸的是，页面上的输出显示为纯文本，而不是 html。

```
Among individual stocks, the top percentage gainers in the S.&P. 500 are <a href ='http://investing.businessweek.com/research/stocks/snapshot/snapshot.asp?ric=PLD'>ProLogis</a> and <a href ='http://investing.businessweek.com/research/stocks/snapshot/snapshot.asp?ric=LNC'>Lincoln National Corp</a>. 
```

CDATA 部分是从经典的 ASP 页创建的，因此实际的 XML 输出不包含 CDATA 部分。这可能是问题的一部分吗？我似乎无法获得要在页面上呈现的信息。我尝试过 Google 搜索提供的多种解决方案，例如 disable-escape-tags、xsl:copy-of、xsl:value-of 等。

谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-03-31T16:07:03.807

```
<p class="smartText">
  <xsl:value-of 
    select="marketSummaryModuleData/smartText" 
    disable-output-escaping="yes"
  />
</p> 
```

编辑：正如@Randell 在评论中指出的那样，`disable-output-escaping`并非所有 XSLT 处理器中都存在。例如，Firefox 中的那个不支持此属性。以上不适用于这些处理器。不过，我所知道的所有*独立XSLT 处理器都支持它。*

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-31T16:09:58.043

**您必须更正 XML，以便所需的 HTML（并且它需要是格式良好的 XML）不包含在 CDATA 部分**中。

任何 CDATA 部分都只是 text() 节点的一部分，XSLT 处理器将其视为这样。

在 CDATA 中添加标记被普遍认为是不好的做法，报告的问题是一个典型的结果。

DOE（禁用输出转义）是 XSLT 中的一个可选功能，不保证在不同的 XSLT 处理器上实现并产生相同的预期结果。

引用[**W3C XSLT 规范**](http://www.w3.org/TR/xslt#disable-output-escaping)：

`"An XSLT processor is not required to support disabling output escaping. If an xsl:value-of or xsl:text specifies that output escaping should be disabled and the XSLT processor does not support this, the XSLT processor may signal an error; if it does not signal an error, it must recover by not disabling output escaping. "`

和：

`"Since disabling output escaping may not work with all XSLT processors and can result in XML that is not well-formed, it should be used only when there is no alternative."`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-10-22T09:12:11.737

```
<xsl:for-each select="marketSummaryModuleData/smartText">
    <xsl:copy-of select="node()"/>
</xsl:for-each>

<smartText>
Among individual stocks, the top percentage gainers in the S.&P. 500 are
<a href ='http://investing.domain.com/research/stocks/snapshot
/snapshot.asp?ric=LNC'>Lincoln National Corp</a> and 
<a href ='http://investing.domain.com/research/stocks/snapshot
/snapshot.asp?ric=PLD'>ProLogis</a>.
</smartText> 
```

# oop - 什么是了解语言 OO 特性和结构的好例子？

> ID：701727
> 
> 赞同：0
> 
> 时间：2009-03-31T15:59:01.143
> 
> 标签：oop

我一直在寻找*简短*而好的例子来展示一种语言的 OO 特性，作为对其他程序员的介绍。我的意思是“好”，它们可以运行并输出一些相当有意义的东西，而不是 foobar 的东西。

例如，您可以通过 mandelbrot 集示例演示大多数控制流构造，或者通过合并排序示例演示功能方面。但是我还没有找到 OO 构造的好例子。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T16:25:38.257

一个非常容易理解的“真实世界”示例是 java.io.InputStream 类，它是子类。这是一个很好的多态性示例：如果您编写代码以了解如何使用 InputStream，那么底层类如何工作并不重要，只要它符合 InputStream 强加的合同即可。所以，你可以在某个类中有一个方法

```
public void dump(InputStream in) throws IOException {
  int b;
  while((b = in.read()) >= 0) {
    System.out.println(b);
  }
} 
```

此方法不关心数据来自何处。

现在，如果您想对文件中的数据使用转储方法，您可以调用

```
dump(new FileInputStream("file")); 
```

或者，如果您想将转储与来自套接字的数据一起使用，

```
dump(socket.getInputStream()); 
```

或者，如果你有一个字节数组，你可以调用

```
dump(new ByteArrayInputStream(theArray)); 
```

如果 InputStream 包装其他 InputStreams，则有一些实现。例如，SequenceInputStream 允许您将多个 InputStream 合并为一个：

```
dump(new SequenceInputStream(new FileInputStream("file1"), 
                             new FileInputStream("file2")); 
```

如果要创建自己的自定义 InputStream，可以扩展 InputStream 类，并覆盖 int read() 方法：

```
public class ZerosInputStream extends InputStream {
  protected int howManyZeros;
  protected int index = 0;
  public ZerosInputStream(int howManyZeros) {
      this.howManyZeros = howManyZeros;
  }

  @Override
  public int read() throws IOException {
    if(index < howManyZeros) {
        index++;
        return 0;
    } else {
        return -1;
    }
  } 
```

然后你可以在你的转储调用中使用*它：*

```
 dump(new ZerosInputStream(500)); 
```

# c# - 在数据绑定列表框中设置选定项

> ID：701729
> 
> 赞同：1
> 
> 时间：2009-03-31T15:59:09.240
> 
> 标签：c#, wpf

我有一个绑定到数据表的 wpf 列表框。有时，我想以编程方式更改列表框的选择。我知道我要选择的项目的文本。但是将listbox1.SelectedItem设置为我想要的文本不起作用，因为SelectedItem的类型是System.Data.DataRowView。

如果我有要选择的文本和要选择的 DataRow，那么在列表框中选择关联行的最简单方法是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T16:19:23.107

搜索您的`DataSet`并找到合适的`DataRow`. 然后设置`SelectedItem`为`DataRow`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T16:32:02.500

如果您知道文本，那么它将是：

```
ListBox1.SelectedValue = ListBox1.Items.FindByText("Two").Value; 
```

您还可以使用 SelectedIndex 属性通过从 0 开始的索引来设置选定值。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T16:20:06.473

ListBox 控件（在 Forms 和 WebControls 中）具有 SelectedValue 属性，该属性：

> “获取列表控件中选定项的值，或选择列表控件中包含指定值的项。”

您可以使用它根据其值（通常是唯一键）选择项目。

来自 MSDN 的更多信息：

[System.Windows.Forms.ListControl.SelectedValue](http://msdn.microsoft.com/en-us/library/system.windows.forms.listcontrol.selectedvalue.aspx)

[System.Web.UI.WebControls.ListControl.SelectedValue](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.listcontrol.selectedvalue.aspx)

# solaris - 在 Solaris 中复制符号链接

> ID：701730
> 
> 赞同：3
> 
> 时间：2009-03-31T15:59:30.347
> 
> 标签：solaris, symlink, copying

我试图在 Solaris OS 上复制一个链接，但发现它并没有简单地复制链接，而是复制链接指向的目录/文件的全部内容？这在 AIX、HP-UX、Linux 等其他操作系统中是没有的。

这是 Solaris OS 的正常行为吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-31T17:04:36.290

查理很接近，你想要`-L`,`-H`或`-P`带有标志的`-R`标志（可能只是`-R -P`）。`chmod(1)`和存在类似的标志`chgrp(1)`。我从下面的手册页中粘贴了一段摘录。

例子：

```
$ touch x
$ ln -s x y 
$ ls -l x y 
-rw-r--r--   1 mjc      mjc            0 Mar 31 18:58 x
lrwxrwxrwx   1 mjc      mjc            1 Mar 31 18:58 y -> x
$ cp -R -P y z
$ ls -l z
lrwxrwxrwx   1 mjc      mjc            1 Mar 31 18:58 z -> x
$ 
```

或者，默认情况下，普通的旧 tar 将愉快地使用符号链接，即使是 Solaris 附带的古老版本：

```
tar -cf foo | ( cd bar && tar -xf - ) 
```

（其中 foo 是符号链接或包含符号链接的目录）。

```
 /usr/bin/cp -r | -R [-H | -L | -P] [-fip@] source_dir... target

 ...

 -H    Takes actions based on the type and  contents  of  the
       file  referenced  by  any symbolic link specified as a
       source_file operand.

       If the source_file operand is a symbolic link, then cp
       copies  the  file  referenced by the symbolic link for
       the source_file  operand.  All  other  symbolic  links
       encountered  during  traversal of a file hierarchy are
       preserved.

 -L    Takes actions based on the type and  contents  of  the
       file  referenced  by  any symbolic link specified as a
       source_file operand or any symbolic links  encountered
       during traversal of a file hierarchy.

       Copies files referenced by  symbolic  links.  Symbolic
       links encountered during traversal of a file hierarchy
       are not preserved.

 -P    Takes actions on any  symbolic  link  specified  as  a
       source_file  operand  or any symbolic link encountered
       during traversal of a file hierarchy.

       Copies symbolic links. Symbolic links encountered dur-
       ing traversal of a file hierarchy are preserved. 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T16:10:36.870

您希望`cp -P`我相信（查看手册页，因为我现在手头没有 solaris 框。）我隐约怀疑这是 System V-ism，但不会发誓。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T16:10:04.643

cpio 会为您解决问题吗？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-21T03:11:18.997

听起来您正在尝试复制单个符号链接。

您可能只想这样做：

```
 link_destination=`/bin/ls -l /opt/standard_perl/link|awk '{print $10}'`
ln -s $link_destination /opt/standard_perl/link_new 
```

如果您尝试复制目录层次结构，通常在没有 GNU 工具（或 rsync）的情况下很难做到这一点。虽然有一些解决方案通常有效，但没有一种解决方案适用于您可能遇到的每种文件名的每个“标准”unix。如果您打算经常这样做，您应该安装 GNU coreutils、find、cpio 和 tar，以及 rsync。

# html - CSS中带斜线的字体大小

> ID：701732
> 
> 赞同：144
> 
> 时间：2009-03-31T16:00:06.443
> 
> 标签：html, css, size

斜线在这里是什么意思：

```
font: 100%/120%; 
```

* * *

## 回答 #1

> 赞同：207
> 
> 时间：2009-03-31T16:01:38.907

这实际上设置了两个属性，相当于：

```
font-size: 100%;
line-height: 120%; 
```

引用[官方文档](http://www.w3.org/TR/css3-fonts/#propdef-font)：

> 此属性的语法基于传统的印刷简写符号来设置与字体相关的多个属性。

正如 David M 在评论中所说，它反映了将字体大小指定为“<em>x pt on *y*  pt”的排版传统，以表示行高上的字形大小。

但是您问题中的示例实际上是错误的，并且会被浏览器忽略：您只能将这两个属性组合成`font`简写符号，并且您*必须*至少指定字体大小和系列。因此，仅仅写作`font: 100%/120%;`是不够的；您可以添加一个通用姓氏以使其有效，例如：

```
font: 100%/120% serif; 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-03-31T16:06:35.307

Konrad 得到了这个，但是有很多这样的[CSS 速记](http://www.webcredible.co.uk/user-friendly-resources/css/css-shorthand-properties.shtml)属性可以用来缩短样式表。如果你不知道它们中的一些看起来有点神秘。

# .net - 表操作.net库

> ID：701739
> 
> 赞同：0
> 
> 时间：2009-03-31T16:01:11.840
> 
> 标签：.net, sorting, memory, filtering

在我拥有的一些网页中，我必须在内存中加入一些数据表，然后将结果用作网格视图的数据源。这种内存连接是唯一的解决方案，我已经编写了一个方法来处理它。

我想知道是否有任何库可以执行此类操作和其他表操作，例如排序和过滤。我知道数据视图排序和数据表上的选择方法，但我正在寻找返回数据表作为结果的东西。

此外，从性能的角度来看，我不相信我编写的代码是最好的，所以我想至少将它与第三方实现进行比较。由于应用程序必须在 .Net 2.0 上运行，因此 Linq 不是替代方案。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T16:06:04.557

你听说过 LINQ 吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T16:20:52.510

为什么需要数据表？网格视图将毫无怨言地获取数据视图。

如果你在 .NET 3.5 上，那么 Linq 绝对是你的人选。

# objective-c - 在 Cocoa/Interface Builder 中，单击按钮后如何清除文本字段中的文本

> ID：701743
> 
> 赞同：5
> 
> 时间：2009-03-31T16:01:49.903
> 
> 标签：objective-c, cocoa, button, interface-builder

我正在使用[MGTwitterEngine制作一个简单的 Twitter 更新应用程序](http://mattgemmell.com/2008/02/22/mgtwitterengine-twitter-from-cocoa)

在他们单击“更新”按钮后，我似乎无法让 Interface Builder 中的 TextField 清除文本。有没有一种简单的方法可以做到这一点，或者在 Interface Builder 中做些什么？

非常感谢！

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-31T16:05:55.650

```
IBOutlet NSTextField *textField;

[textField setStringValue:@""];
[textField display]; 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-01T05:18:43.497

我认为您还需要定义一个 IBAction 方法，例如：

```
- (IBAction) clearText:(id) sender {
    [textField setStringValue:@""];
    [textField display];
} 
```

您现在可以为该操作分配一个按钮事件（例如按钮按下）。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-01T05:11:50.910

请注意，可能不是在按下按钮时清除 NSTextField，而是在上传推文时。

否则，如果由于某种原因无法发送推文，您就有丢失推文的风险。

[不是直接问题的解决方案，而是后续问题的解决方案……]

# mysql - 如何轻松地从 MySQL 迁移到 PostgreSQL？

> ID：701744
> 
> 赞同：3
> 
> 时间：2009-03-31T16:01:50.840
> 
> 标签：mysql, postgresql, migration, rdbms

我想在它变得更大之前将现有的 MySQL 数据库（大约 40 个表，400mb 数据）迁移到 Postgres。我在网上搜索并尝试了一些迁移脚本（其中一些可以在[这里](http://wiki.postgresql.org/wiki/Converting_from_other_Databases_to_PostgreSQL)找到）。它们都不能无缝地工作——如果只是我必须手动修复的一些小故障，那不会是问题，但由此产生的转储看起来根本不像有效的 PostgreSQL。

有没有人在不使用完整工作日的情况下成功迁移生产表 - 有没有*简单的解决方案*来解决这个问题？

*注意：我也会考虑商业产品（只要定价仍然可行）。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T16:15:48.623

尽管 SQL 是一种标准，但如果没有每个服务器软件都实现扩展，它的功能还不够完整。从 MySQL 到 PostgreSQL 的转换并不简单，除非你的模式是微不足道的。自动翻译脚本只会让你到目前为止。

最好的方法是手动转换模式，然后为数据本身编写自己的传输脚本。您还应该编写验证脚本以确保架构和数据正确传递。

这不是一个逃避的答案。如果您的数据库足够重要，可以迁移，那么花一些时间在自己身上就足够重要了。最后，与自动迁移脚本所导致的问题相比，您花费的时间至少与自己迁移数据所花费的时间一样多。但是自己动手，你就有机会利用 PostgreSQL 中不存在于 MySQL 中的特性，也有机会做出那些只有第二次做某事才能获得的改进。

咬紧牙关去做。

# .net - 如何强制 Web 浏览器控件始终在同一窗口中打开网页？

> ID：701746
> 
> 赞同：9
> 
> 时间：2009-03-31T16:02:44.923
> 
> 标签：.net, winforms, webbrowser-control

我需要在我的应用程序中使用 Web 浏览器，因为它保留了员工的重复性任务，但是 javascript 存在问题，在单击锚点后会在 IE 中打开一个新窗口。如何告诉 Web 浏览器控件在我希望打开的位置“打开新窗口”？例如在其他网络浏览器控件中？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2012-07-09T18:37:35.283

我找到了一个有效的简单解决方案。

```
private void WebBrowser1_NewWindow(object sender, System.ComponentModel.CancelEventArgs e) {
    e.Cancel = true;
    WebBrowser1.Navigate(WebBrowser1.StatusText);
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-31T16:28:23.460

查看：使用源代码[的 .NET System.Windows.Forms.WebBrowser 模块的概念验证](http://dotbrowser.svn.sourceforge.net/viewvc/dotbrowser/trunk/Browser.cs?view=markup)

* * *

我对这些控件的经验让我看到了这个问题可以在接下来的步骤中尝试解决：

1.  总是取消[NewWindow](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.newwindow.aspx)事件

2.  抓住[所有链接](http://msdn.microsoft.com/en-us/library/system.windows.forms.htmldocument.links.aspx)点击

3.  但并非所有链接都可以通过这种方式缓存，所以我决定在[文档加载完成](http://msdn.microsoft.com/en-us/library/system.windows.forms.webbrowser.documentcompleted.aspx)`<a>`时手动解析所有标签

4.  总的来说，这种控制很差，是微软故意这样设计的。[尽管Webbrowser.Document.HtmlDocument](http://msdn.microsoft.com/en-us/library/system.windows.forms.htmldocument.domdocument.aspx)和命名空间[MSHTML](http://go.microsoft.com/fwlink/?LinkId=128638)周围有强大的工具集

5.  它使用的一个例子是[HtmlElement.DomElement](http://msdn.microsoft.com/en-us/library/system.windows.forms.htmlelement.domelement.aspx)

    ```
    foreach(HtmlElement tag in webBrowser.Document.All)        
    {
      switch (tag.TagName.ToUpper)
      {
        case "A":
        {
          tag.MouseUp += new HtmlElementEventHandler(link_MouseUp);
          break;
        }
      }
    }

    void link_MouseUp(object sender, HtmlElementEventArgs e)
    {
      HtmlElement link = (HtmlElement)sender;
      mshtml.HTMLAnchorElementClass a = (mshtml.HTMLAnchorElementClass)link.DomElement;
      switch (e.MouseButtonsPressed)
      {
        case MouseButtons.Left:
        {
          if ((a.target != null && a.target.ToLower() == "_blank") ||
              e.ShiftKeyPressed ||
              e.MouseButtonsPressed == MouseButtons.Middle)
          {
            // add new tab
          }
          else
          {
            // open in current tab
          }
          break;
        }
        case MouseButtons.Right:
        {
          // show context menu
          break;
        }
      }
    } 
    ```

在第一个链接中查看更多内容，这是主窗口的源代码，那里有很多不同的操作！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-29T12:04:52.643

为什么这么复杂的答案伙计们？Abatischev，我很想看看你的大脑，应该很有趣......

试试这个：

```
Private Sub WB1_NewWindow(ByVal sender As System.Object, ByVal e As System.ComponentModel.CancelEventArgs) Handles WB1.NewWindow
    newUrl = WB1.Url.ToString

    e.Cancel = True
    WB1.Navigate(newUrl)
End Sub 
```

现在您可以在任何 OWN 表单中将第二行更改为 WB2 或任何其他 WebBrowser 组件。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-02-05T01:28:18.943

案例中有一个错误`MouseBUttons.Left`：

> 错误 1 ​​控件不能从一个案例标签 ('case 1048576:') 到另一个 C:\Documents and Settings\ever\My Documents\Visual Studio 2005\Projects\Desarrollo\wApp_SurverMonkey\wApp_SurverMonkey\frmNetcare.cs 64 17 wApp_SurverMonkey

# c# - 监视控制以确定被触发的事件？

> ID：701762
> 
> 赞同：8
> 
> 时间：2009-03-31T16:05:28.397
> 
> 标签：c#, winforms, events

有没有办法在不为每个可能的事件显式创建处理程序的情况下列出特定 WinForms 控件的所有触发事件？例如，我可能想查看在各种数据绑定操作期间在 DataGridView 和 BindingSource 之间触发的事件序列。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-31T16:17:42.143

您可以使用反射，但由于涉及到各种事件处理程序签名，它会有点棘手。基本上，您必须获取`EventInfo`类型中的每个事件，并使用该[`EventHandlerType`](http://msdn.microsoft.com/en-us/library/system.reflection.eventinfo.eventhandlertype.aspx)属性在调用之前确定要创建的委托类型[`AddEventHandler`](http://msdn.microsoft.com/en-us/library/system.reflection.eventinfo.addeventhandler.aspx)。`Delegate.CreateDelegate`虽然适用于遵循正常事件处理程序模式的所有内容......

这是一个示例应用程序。请注意，它没有做任何检查——如果你给它一个“非标准”事件的东西，它会抛出一个异常。您也可以相当容易地使用反射来打印出事件参数。

```
using System;
using System.Drawing;
using System.Windows.Forms;
using System.Reflection;

namespace ConsoleApp
{
    class Program
    {
        [STAThread]
        static void Main(string[] args)
        {
            Form form = new Form { Size = new Size(400, 200) };
            Button button = new Button { Text = "Click me" };
            form.Controls.Add(button);
            EventSubscriber.SubscribeAll(button);
            Application.Run(form);
        }
    }

    class EventSubscriber
    {
        private static readonly MethodInfo HandleMethod = 
            typeof(EventSubscriber)
                .GetMethod("HandleEvent", 
                           BindingFlags.Instance | 
                           BindingFlags.NonPublic);

        private readonly EventInfo evt;

        private EventSubscriber(EventInfo evt)
        {
            this.evt = evt;
        }

        private void HandleEvent(object sender, EventArgs args)
        {
            Console.WriteLine("Event {0} fired", evt.Name);
        }

        private void Subscribe(object target)
        {
            Delegate handler = Delegate.CreateDelegate(
                evt.EventHandlerType, this, HandleMethod);
            evt.AddEventHandler(target, handler);
        }

        public static void SubscribeAll(object target)
        {
            foreach (EventInfo evt in target.GetType().GetEvents())
            {
                EventSubscriber subscriber = new EventSubscriber(evt);
                subscriber.Subscribe(target);
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T16:07:08.610

我认为你可以使用反射来做到这一点。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T16:08:42.227

这是无法做到的。如果您使用 Reflector 查看大量框架的类，您会发现触发事件时的常见模式：

```
// fire event
if (EventDelegate != null)
   EventDelegate(eventArgs); 
```

因此，如果没有人订阅它，甚至不会触发该事件

# tsql - 使用左连接和表变量删除

> ID：701767
> 
> 赞同：1
> 
> 时间：2009-03-31T16:06:17.850
> 
> 标签：tsql, left-join, table-variable

也许我缺少一个括号或其他东西，但我很难从我要加入的表变量中删除行并寻找我要加入的键。如果它有价值，那么我就摆脱它。问题是我无法解析查询。有任何想法吗？

```
declare @MrTemp 
(
    key1 int
   ,key2 int
)

insert into @MrTemp
select key1, key2 from ASourceTable

delete  
from @MrTemp mt
left join ARealTable art on mt.key1 = art.key1 and mt.key2 = art.key2 
where art.key1 is not null and art.key2 is not null 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T16:09:40.820

```
DELETE @MrTemp
FROM @MrTemp mt LEFT JOIN ... 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T16:09:50.993

您需要在删除之后但在要从中删除的表的 from 之前引用别名

```
delete art 
from @MrTemp mt left join ARealTable art on 
mt.key1 = art.key1 and mt.key2 = art.key2 
where art.key1 is not null and art.key2 is not null 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T16:15:58.810

您一次只能从一个表中删除：

从@MrTemp 中删除[ARealTable 中有匹配记录]

```
delete mt
from @MrTemp mt left join ARealTable art on mt.key1 = art.key1 and mt.key2 = art.key2 where art.key1 is not null and art.key2 is not nu 
```

二

或者。从 ARealTable 中删除 [再次在 ARealTable 中有相应记录的记录]

```
delete art
from @MrTemp mt left join ARealTable art on mt.key1 = art.key1 and mt.key2 = art.key2 where art.key1 is not null and art.key2 is not null 
```

# flash - 用于网络的有损图像压缩和透明度？

> ID：701769
> 
> 赞同：8
> 
> 时间：2009-03-31T16:06:31.797
> 
> 标签：flash, png, transparency

PNG 的一个优点是完全 alpha 透明度，它允许您在网页设计中拥有平滑的边缘和阴影。主要缺点是它只支持无损压缩，这对于复杂的图像意味着非常大的文件大小。

另一方面，JPEG 为复杂图像提供了很好的可压缩性，但没有透明度。

最后，我看到 Flash 元素（[此处为示例](http://www.uca.edu/futurestudents/)）具有高度压缩的图像，这些图像也具有平滑的边缘和阴影。我对 Flash 了解不多，也不知道这是如何实现的。这基本上是我希望能够做到的效果 - 具有透明和/或阴影边缘的大型复杂图像。

我的问题是：

### 具有透明度的有损压缩如何在 Flash 中工作？

这里是否使用了 Flash 特定的分层技巧？阴影是否像我对 PNG 所做的那样生成或光栅化到图像中。

### 是否有任何 SWF 或 SWF 生成脚本可以用有损压缩版本替换 PNG 图像？

我正在考虑逐步增强以提高某些设计元素的加载速度。如果这不存在，写它是否可行？

### 是否有任何格式允许透明的有损压缩

我很难找到这方面的具体信息。DjVu 可能是候选人？我们是否应该推动浏览器制造商支持另一种格式？

### 这个问题还有其他解决方案吗？

在 Flash 中做所有事情或接受巨大的文件大小是当前的选择。其他一些可能性：

*   SVG 和画布可能能够应用边缘，但 IE 不支持。
*   您可以沿扫描线切割 PNG 并使用 JPEG 压缩它们，将边缘保留为 PNG。这在源代码上会很讨厌，但它适用于所有浏览器。听起来像一个有趣的项目，我会在早上写。:)
*   您可以编写一个有损图像过滤器，它可以降低 PNG 算法扫描线的颜色复杂性，以提高 PNG 格式的压缩率。我只*知道*它必须存在，但我找不到它。有人知道吗？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-31T16:15:13.460

> PNG 的一个优点是完全 alpha 透明度，它允许您在网页设计中拥有平滑的边缘和阴影。主要缺点是它只支持无损压缩，这对于复杂的图像意味着非常大的文件大小。

你错了。您可以使用带有有损压缩（8 位索引颜色）和 alpha 透明度的 PNG。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-03-19T16:50:13.980

我正在开发[pngquant](http://pngquant.org)，它会生成*带有完整 alpha*的调色板 PNG 。

向调色板的转换非常接近于有损压缩，并且提供了类似的良好结果——您通常可以将图像尺寸减小 60-70%，而几乎没有质量损失。

I've also created [Mac GUI for it](http://pngmini.com) which includes lossy filter for PNGs (posterization with appropriately selected levels). 该技术将图像减少了大约 30%，但适用于 24 位图像。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-31T16:43:19.117

> 这里是否使用了 Flash 特定的分层技巧？

可能。可以在 ActionScript 中操作位图，因此您可以从没有颜色数据的简单透明 PNG 中获取 Alpha 层，并将其与 JPEG 中的像素数据相结合。

> 是否有任何格式允许透明的有损压缩

是的，[JPEG 2000](http://en.wikipedia.org/wiki/JPEG_2000)和 Microsoft 的[高清照片](http://en.wikipedia.org/wiki/HD_Photo)。不过，不要屏住呼吸以获得浏览器支持！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T16:41:09.950

您可以在后端使用[ming](http://www.libming.org/)并动态创建闪存，这是一个 PHP 示例，显示了[屏蔽 jpgs](http://www.gazbming.com/getexample.php?id=78)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-31T18:03:26.600

如果您指的是通过屏蔽完成的网站上弹出的学生。要制作复杂的蒙版，您必须自己在 Flash 中绘制，或者如果您有 Illustrator，您可以实时跟踪您的图像以获得轮廓的非常好的矢量近似值。Flash 也有跟踪位图功能，但 Illustrator 版本功能更强大。

Flash CS4 允许您将阴影和模糊等滤镜效果应用于在运行时呈现的 MovieClip 和文本。

所以基本上：

1.  获取图像
2.  获取图像的矢量轮廓
3.  将矢量轮廓放在图像上方的图层上并应用蒙版。你现在应该只剩下你的图像，所有的空白都被删除了。
4.  如果您想要阴影将矢量轮廓复制到 JPEG 下方的图层上，请将其与蒙版对齐，然后在“属性”>“过滤器”中将阴影应用到该底层。确保它是一个影片剪辑，否则您将无法在其上放置阴影。

如果您需要更多说明或需要示例文件，请发送电子邮件至 jcullinan (at) pinnaclegfx (dot) com

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-12T21:01:58.833

我看到了一些有趣的答案。也许我可以补充一下，因为我遇到了同样的问题。

> 具有透明度的有损压缩如何在 Flash 中工作？

效果很好，就像一个透明的 jpg :)

> 是否有任何 SWF 或 SWF 生成脚本可以用有损压缩版本替换 PNG 图像？

是的，有：

查看[Durej 的 Images 2 SWF](http://durej.com/?p=15) 和[mr.doob 的 png2swf](http://www.mrdoob.com/blog/post/641)

希望能帮助到你。祝你好运！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-07-10T00:37:35.963

还有这个研究

[http://membled.com/work/apps/lossy_png/](http://membled.com/work/apps/lossy_png/)

和

[http://www.theopavlidis.com/software/pack4png/expages/exindex.htm](http://www.theopavlidis.com/software/pack4png/expages/exindex.htm)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-06-18T14:08:53.380

您可以使用 JPEG 和蒙版。掩码可以是位图（应该很好地无损压缩为 PNG 或 GIF）或矢量。

对于大多数网络使用，将它们打包为 SVG - [http://peterhrynkow.com/how-to-compress-a-png-like-a-jpeg/](http://peterhrynkow.com/how-to-compress-a-png-like-a-jpeg/)

对于某些应用程序，您可能会单独使用它们。当您具有相同的形状但不同的纹理时，它允许您重复使用蒙版。它也可能对您选择的工作流程或框架更好。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-01-05T08:28:38.757

PNG确实支持有损压缩，但与JPEG相比它很糟糕。例如，下面是使用 PNG 和 JPEG 压缩到 100kb 的图像的一部分：

[![PNG 与 JPEG 有损压缩到 100kb](https://i.stack.imgur.com/dBisd.jpg)](https://i.stack.imgur.com/dBisd.jpg)

所以你可以看到PNG文件不能很好地处理细微的渐变。他们不是为此而设计的。

看起来近期最好的选择是等待[WebP 支持](https://caniuse.com/webp)，它实际上已经在所有主要浏览器中可用，但仅在最近版本的 Safari 中（截至撰写时）。

新的[AVIF](https://jakearchibald.com/2020/avif-has-landed/)也是有损透明空间的竞争者，但在撰写本文时[仅在 Chrome、Opera 和 Firefox](https://caniuse.com/avif)（Firefox 86 及更高版本）中受支持。希望其他浏览器尽快添加对此的支持，因为它对于高压缩比具有非常好的感知特性。

# python - 是否有实现 AWS 身份验证协议双方的 python 库？

> ID：701789
> 
> 赞同：4
> 
> 时间：2009-03-31T16:09:48.557
> 
> 标签：python, amazon-web-services

我正在用 python 和 django 编写一个 REST 服务，并想使用亚马逊的 AWS 身份验证协议。我想知道是否有人知道一个 python 库，它实现了发送标头的形成和接收标头的验证？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-03T03:20:12.873

试试这个库。我认为这是您正在寻找的图书馆..

[加州网](https://calnet.berkeley.edu/developers/downloads/CalNetAwsPython.html)

[你可以在这里](https://calnet.berkeley.edu/news/entry/2005/11/10/01.html)找到一些 Python 代码示例

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-03T07:09:18.717

[boto](http://code.google.com/p/boto/)是 AWS 的 Python 库。但是，我不知道它是否支持您的要求。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-05T09:00:05.453

我认为这段[代码](http://staff.science.uva.nl/~otsur/code/AWS_SignatureGenerator.py)完全符合您的要求：) 如果需要，我很乐意获得改进意见。

# .net - 我应该费心学习 Windows 工作流吗？

> ID：701792
> 
> 赞同：4
> 
> 时间：2009-03-31T16:09:53.723
> 
> 标签：.net, workflow

好的，所以我已经学习了 WPF 和 WCF，这很棒。我没有打扰 CardSpace，因为它可能不会起飞。

我应该打扰工作流程吗，..值得吗？有什么大不了的？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-31T19:16:29.453

看过[Leon Bambric 关于工作流软件的帖子](http://www.bwebcentral.com/blog/3/758)吗？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-31T19:15:04.073

值得学习或至少了解WF。WF 为构建应用程序提供了一种不同的范式，这种范式在未来*可能会成为主流。*企业？是的，也许今天。但长期的 WF 或至少是它所倡导的范式，可能会变得无处不在和普遍。使用工作流来描述程序，今天可能处于 OO 和 C++ 的阶段，20 年前。

学习新事物可以拓宽你的思维。例如，即使您在日常工作中使用 C# 或 Java，了解 Lisp 也有助于拓宽您对如何解决问题的思考。国际海事组织。WF也是一样。

第二个想法是像投资者一样思考。如果你想提高你作为程序员的价值，是否学习 WF 将取决于你所在的市场或工作。你所在领域或公司的 WF 技能可能值得你付出额外的努力，也可能不值得。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-31T16:34:51.057

Windows 工作流可用于多种不同类型的应用程序。如果您不写其中之一，则无需费心学习它。

1.  人工工作流程 - 显而易见
2.  它对于复杂的 UI 导航很有用
3.  作为并行处理多个操作的一种方式，它非常有用。这是进行异步处理的一种非常简单的方法。
4.  由多个步骤组成的长时间运行的操作
5.  基于规则的处理
6.  任何需要允许客户自定义行为的情况。您可以发布与您的应用程序相关的自定义活动，然后客户可以组合和参数化它们。

但是，如果您不需要任何这些，为什么还要麻烦呢？只需阅读一些白皮书，或查看一些视频，看看其中是否有任何有趣的内容。

一件不明显的有趣事情：工作流设计器和规则设计器都可以托管在任意 Windows 窗体应用程序中。这允许它们在您自己的应用程序中重用，例如，如果您需要一种自定义条件处理的方法。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-31T17:12:36.473

我认为对当前 Windows 工作流程的普遍共识是，该产品还没有为黄金时段做好准备。如果您想用当前框架完成一些琐碎的事情，您可能需要编写一些自定义任务来填补功能空白。当工作流程的复杂性开始堆积时，我也遇到了设计师崩溃的问题。

根据我听到/阅读的有关 Windows Workflow 的内容，下一个版本 (v4.0) 是一个完全重写的版本，它修复了当前版本中的许多问题。他们声称与 v3/3.5 工作流向后兼容，但您可能必须非常了解该框架才能知道发生了什么变化以及如果它不能立即工作如何修复它。

除非您今天有一个绝对需要此功能的项目，否则您最好等到新的位发货。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-31T17:07:30.993

就像保罗说的，这取决于你工作的环境。就我个人而言，因为我永远不知道生活会带我去哪里（企业发展、创业等），所以当我有机会时，我会尽我所能去学习。

我的建议是，如果你有时间、直觉和开发环境……学习它。你永远不知道它什么时候会在未来的某个时候派上用场。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-01T08:21:31.517

感谢所有提供意见的人。Cheeso 得到了答案，因为他得到了最多的选票，但所有意见都受到赞赏。我想我会接受 Scroll Lock 的建议，等到 v4.0 之后再认真看看。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-12T18:30:49.543

我最初真的很喜欢工作流的概念，但最后我想我会使用无状态或滚动我自己的状态机之类的东西，并使用数据库进行持久化。我现在最大的问题是工作流运行时似乎仍然存在巨大的内存泄漏。让我有点紧张。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-03-31T16:21:47.920

这取决于您构建的软件类型。WPF 很整洁。WCF 有它的用途。不过，Windows Workflow 是相当“企业”的。它需要更多设置并且可能变得复杂。

除非您构建可以从可定义的工作流程中受益的企业软件，否则我不会为它费心。

# javascript - 如何截取网页的屏幕截图？

> ID：701798
> 
> 赞同：15
> 
> 时间：2009-03-31T16:11:19.880
> 
> 标签：javascript, screen, capture

我想在我们的一个网站上添加一个按钮，允许用户使用我们的错误跟踪系统提交错误。

其中一项功能要求是发送相关页面的屏幕截图。

如果不在最终用户的机器上安装一些东西，我该怎么做？javascript是否有某种屏幕帽api？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-31T16:21:45.660

您可以抓取`innerHTML`页面，然后在服务器上处理它：

```
document.getElementsByTagName('html')[0].innerHTML;
// this would also be interactive (i.e. if you've
// modified the DOM, that would be included) 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-31T16:18:21.797

不，javascript 没有这样的东西。

恐怕这会很困难。如果不安装在用户计算机上，我想不出任何可以做到这一点的东西。

我想被证明是错误的，但至少这是你的答案。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-31T17:35:42.097

尽可能多地获取有关使用 jQuery 的用户环境的信息。（jQuery.support）/用户代理/cookies/表单输入值，url（用于获取参数并知道哪个页面有错误）

发送 Moff 提到的页面来源。尝试像现在一样序列化 DOM，以便您可以比较与原始页面的不同之处。

如果您出于历史目的需要保留页面的来源，发送它也很有用，因为当您更新页面时，它会变得不同。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-31T17:18:03.073

我建议与**[FireShot](https://addons.mozilla.org/en-US/firefox/addon/5648)**进行某种集成，这是一个免费的 Firefox/IE 插件。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-31T16:29:44.423

我同意其他答案 - 没有骰子。

但是，有一个 firefox 插件，[Pearl Crescent Page Saver](http://pearlcrescent.com/products/pagesaver/)，可能值得研究相关任务。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-31T16:44:47.040

看看[pagecrop](http://hasin.wordpress.com/2009/03/17/cropping-any-part-of-any-website-thats-fun/)（用jQuery + jCrop插件实现）

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-03-31T17:22:19.023

我一定是错过了什么，但你不能...

按键盘上的 PrtScr 并粘贴到电子邮件中。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-31T16:19:10.253

看到[这个问题](https://stackoverflow.com/questions/60455/take-a-screenshot-of-a-webpage-with-javascript)。基本上，不，不是用javascript。也许使用 ActiveX，但这又回到了在客户的 PC 上安装东西的问题。

考虑编写一个完全重复用户请求的服务器端脚本（假设它不是在 POST 之后）并存储生成的 html 文件。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-31T16:28:24.223

您可能会考虑使用基于 Web 的解决方案，例如[Super Screenshot 提供的解决方案！](http://www.superscreenshot.com/)或[WebShotsPro.com](http://www.webshotspro.com/)。根据您的需求，例如页面特定区域的屏幕截图，或外部世界无法访问的页面，它可能不适合您，但这是一个想法。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-12-13T13:49:18.230

Chrome 插件 [https://chrome.google.com/extensions/detail/ckibcdccnfeookdmbahgiakhnjcddpki](https://chrome.google.com/extensions/detail/ckibcdccnfeookdmbahgiakhnjcddpki)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-01-24T23:46:15.907

你还可以看看 Evernote 是如何进行屏幕捕捉的，也许你可以与之相关或创建自己的 chrome 扩展。[https://chrome.google.com/webstore/detail/evernote-web-clipper/pioclpoplcdbaefihamjohnefbikjilc?hl=en](https://chrome.google.com/webstore/detail/evernote-web-clipper/pioclpoplcdbaefihamjohnefbikjilc?hl=en)

# security - 如何判断网站是否以纯文本形式存储密码

> ID：701801
> 
> 赞同：10
> 
> 时间：2009-03-31T16:12:14.247
> 
> 标签：security, passwords

前几天在网站注册时，他们的密码要求之一是不能包含任何特殊字符，例如**'" = : ; < > ( )**

虽然仅此一项并不表示他们不会散列密码，但这是一个强有力的指标吗？如果对密码进行哈希处理，这些特殊字符会被翻译成别的东西，任何[有害的 SQL](http://xkcd.com/327/)都会变成随机字符。由于他们不允许这些字符，这是否意味着密码将被放入数据库而不被散列？

我还在另一个网站上注册，该网站似乎具有严密的安全性并有良好的客户评价。但是，一旦我完成注册并收到他们的欢迎电子邮件，它就会以纯文本形式包含我的密码，这是一个令人不快的惊喜。

没有人宣传他们的安全性差，但有哪些警告信号表明您的密码可能未加密？通常，您不知道站点的安全性有多差，直到发生入侵或大量数据盗窃，并且站点上的普通人无法判断他们的数据发生了什么。

有人应该创建一个网站，您可以在其中突出显示安全性较差的网站，以引导客户远离或羞辱这些网站以更改其政策。我知道您必须对第三方网站有一定的信任，但是哪些警告标志会让您关闭网站？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-31T16:16:36.140

通常，您只会在收到帐户确认电子邮件或要求“发送新密码”并且您以纯文本形式而不是随机密码或密码重置链接时才知道。

我不认为任何关于什么可以和不能在密码中的愚蠢规则是强有力的指标。您最好的选择是对所有内容使用强大的唯一密码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-31T16:16:09.353

我想到了两件事。

答：仅仅因为您收到一封带有纯文本密码的电子邮件并不意味着它是以纯文本形式存储的。我们加密，并以纯文本发送电子邮件，这是一种不好的做法，但比纯文本更上一层楼。

B：如果您担心这类事情，请使用密码管理器。您无法控制其他人的密码不良做法，您可以控制的是您的良好做法以及如果您的密码之一被泄露所造成的损害。

我自己使用[KeePass](http://keepass.info/)。它有一个密码生成器，您可以修改规则，以便您可以拥有`YhdyLa1PJSftp7`特定于站点标准的超级晦涩密码（例如：）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-31T16:21:00.293

最糟糕的迹象是他们是否可以通过电子邮件将您的密码以纯文本形式发送给您。

无法保证他们以纯文本形式存储它，但如果他们使用的加密是可逆的，那么该网站的大多数开发人员都会知道密码是如何加密/解密的，并且可能会读取它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T16:18:20.830

不幸的是，一般来说，无法确定网站是否存储了您未散列的密码。

> 虽然仅此一项并不表示他们不会散列密码，但这是一个强有力的指标吗？如果对密码进行哈希处理，这些特殊字符会被翻译成别的东西，任何有害的 SQL 都会变成随机字符。由于他们不允许这些字符，这是否意味着密码将被放入数据库而不被散列？

不，这并不一定是这个意思。p -> q （即允许特殊字符 -> 密码散列（除非它们的安全性非常糟糕））不允许您得出结论 ~p -> ~q （即不允许特殊字符 -> 密码未散列）。换句话说，他们可能不允许这些字符，但仍然会散列您的密码。

> 我还在另一个网站上注册，该网站似乎具有严密的安全性并有良好的客户评价。但是，一旦我完成注册并收到他们的欢迎电子邮件，它就会以纯文本形式包含我的密码，这是一个令人不快的惊喜。

他们可能在密码在内存中时生成了电子邮件，但只存储了一个哈希值。正如您所说，尽管通过电子邮件发送明文密码并不是良好的安全做法。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-31T16:48:23.630

如果您收到一封电子邮件，告诉您他们正在切换到密码限制比当前系统更短的新系统，并且他们会自动为您截断密码，那么他们正在存储密码是一个死的赠品。

最近在我的网上银行帐户上发生了这种情况。你会认为他们会更清楚。

顺便说一句，这并没有告诉你它们是以明文形式存储的。它们很可能已被加密。但是，从安全的角度来看，这并不比以明文形式存储它们更好。实际密码永远不应以*任何*形式存储。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-31T16:52:44.320

> 由于他们不允许这些字符，这是否意味着密码将被放入数据库而不被散列？

不。如果某些字符被禁止使用，这通常是一个不好的信号（如果您有一个使用标点符号组成密码的系统，这会令人非常恼火），但这本身并不是一个危险信号。有时还有其他技术原因不允许某些字符（*），而且通常是愚蠢的管理政策原因不允许。

（*：特别是，HTTP 基本身份验证不能可靠地在用户名中包含“：”字符，或在用户名或密码中包含任何非 ASCII 字符。）

> 但是，一旦我完成注册并收到他们的欢迎电子邮件，它就会以纯文本形式包含我的密码，这是一个令人不快的惊喜。

是的。不好，但这并不一定意味着它们以明文形式*存储；*他们可能会发送邮件，然后对其进行散列处理。

（虽然可能不是啊！）

> 有哪些警告信号表明您的密码可能未加密？

如果存在“恢复密码”设施，可以在注册后将密码邮寄给您。

> 有人应该创建一个网站，您可以在其中突出显示安全性差的网站以引导客户离开

那会很好，但那样的话，有人会不断地受到技术上毫无头绪但乐于诉讼的公司的骚扰。而当大多数商业网站仍然容易受到简单的 XSS 或 XSRF 攻击时，“安全性差的网站”列表将比“安全性好的网站”长得多。

# python - 如何在 Python 中执行包含 Python 代码的字符串？

> ID：701802
> 
> 赞同：451
> 
> 时间：2009-03-31T16:12:20.033
> 
> 标签：python, string, exec

如何在 Python 中执行包含 Python 代码的字符串？

* * *

## 回答 #1

> 赞同：423
> 
> 时间：2009-03-31T16:15:24.567

对于语句，请使用[`exec(string)`](https://docs.python.org/library/functions.html#exec)(Python 2/3) 或[`exec string`](https://docs.python.org/2/reference/simple_stmts.html#grammar-token-exec_stmt)(Python 2)：

```
>>> mycode = 'print "hello world"'
>>> exec(mycode)
Hello world 
```

当您需要表达式的值时，请使用[`eval(string)`](http://docs.python.org/library/functions.html#eval)：

```
>>> x = eval("2+2")
>>> x
4 
```

但是，第一步应该是问问自己是否真的需要。执行代码通常应该是不得已的位置：如果它可以包含用户输入的代码，它会变得缓慢、丑陋和危险。您应该始终首先查看替代方案，例如高阶函数，看看它们是否能更好地满足您的需求。

* * *

## 回答 #2

> 赞同：82
> 
> 时间：2009-03-31T16:14:38.343

在示例中，使用 exec 函数将字符串作为代码执行。

```
import sys
import StringIO

# create file-like string to capture output
codeOut = StringIO.StringIO()
codeErr = StringIO.StringIO()

code = """
def f(x):
    x = x + 1
    return x

print 'This is my output.'
"""

# capture output and errors
sys.stdout = codeOut
sys.stderr = codeErr

exec code

# restore stdout and stderr
sys.stdout = sys.__stdout__
sys.stderr = sys.__stderr__

print f(4)

s = codeErr.getvalue()

print "error:\n%s\n" % s

s = codeOut.getvalue()

print "output:\n%s" % s

codeOut.close()
codeErr.close() 
```

* * *

## 回答 #3

> 赞同：34
> 
> 时间：2013-02-17T21:44:32.323

`eval`并且`exec`是正确的解决方案，它们可以以*更安全*的方式使用。

正如[Python 参考手册中讨论的和](http://docs.python.org/2/reference/simple_stmts.html#exec "Python的参考手册")[本](http://lybniz2.sourceforge.net/safeeval.html "这")教程中明确解释的那样， `eval`and`exec`函数采用两个额外的参数，允许用户指定可用的全局和局部函数和变量。

例如：

```
public_variable = 10

private_variable = 2

def public_function():
    return "public information"

def private_function():
    return "super sensitive information"

# make a list of safe functions
safe_list = ['public_variable', 'public_function']
safe_dict = dict([ (k, locals().get(k, None)) for k in safe_list ])
# add any needed builtins back in
safe_dict['len'] = len

>>> eval("public_variable+2", {"__builtins__" : None }, safe_dict)
12

>>> eval("private_variable+2", {"__builtins__" : None }, safe_dict)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<string>", line 1, in <module>
NameError: name 'private_variable' is not defined

>>> exec("print \"'%s' has %i characters\" % (public_function(), len(public_function()))", {"__builtins__" : None}, safe_dict)
'public information' has 18 characters

>>> exec("print \"'%s' has %i characters\" % (private_function(), len(private_function()))", {"__builtins__" : None}, safe_dict)
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "<string>", line 1, in <module>
NameError: name 'private_function' is not defined 
```

本质上，您正在定义将在其中执行代码的命名空间。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2013-06-29T08:49:04.557

请记住，从版本 3 开始`exec`是一个函数！
所以总是使用`exec(mystring)`而不是`exec mystring`.

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2016-02-29T19:01:54.950

# 避免`exec`和`eval`

## 在 Python 中使用`exec`and`eval`是非常不受欢迎的。

### 有更好的选择

从最佳答案（强调我的）：

> 对于语句，使用`exec`.
> 
> 当您需要表达式的值时，请使用`eval`.
> 
> 但是，第一步应该是问问自己是否真的需要。**执行代码通常应该是不得已的位置**：如果它可以包含用户输入的代码，那就是缓慢、丑陋和危险的。您应该始终首先查看**替代方案，例如高阶函数**，看看它们是否能更好地满足您的需求。

从[exec/eval 的替代方案？](https://stackoverflow.com/questions/16768195/alternatives-to-exec-eval)

> 使用字符串中的名称设置和获取变量的值
> 
> [虽然`eval`] 会起作用，但通常不建议使用对程序本身有意义的变量名。
> 
> 相反，最好使用字典。

### 这不是惯用语

来自[http://lucumr.pocoo.org/2011/2/1/exec-in-python/](http://lucumr.pocoo.org/2011/2/1/exec-in-python/)（强调我的）

> ### Python 不是 PHP
> 
> 不要试图绕过 Python 习语，因为其他一些语言的做法不同。命名空间出现在 Python 中是有原因的，**仅仅因为它为您提供了工具`exec`，并不意味着您应该使用该工具。**

### 有危险

来自[http://nedbatchelder.com/blog/201206/eval_really_is_dangerous.html](http://nedbatchelder.com/blog/201206/eval_really_is_dangerous.html)（强调我的）

> 所以 eval 是不安全的，即使你删除了所有的全局变量和内置函数！
> 
> 所有这些**保护 eval() 的尝试的问题在于它们是黑名单**。他们明确地删除了可能是危险的东西。这是一场失败的战斗，因为**如果列表中只剩下一个项目，您就可以攻击系统**。
> 
> 那么，可以使 eval 安全吗？很难说。在这一点上，我最好的猜测是，如果你不能使用任何双下划线，你就不会造成任何伤害，所以如果你排除任何带有双下划线的字符串，你是安全的。也许...

### 很难阅读和理解

来自[http://stupidpythonideas.blogspot.it/2013/05/why-evalexec-is-bad.html](http://stupidpythonideas.blogspot.it/2013/05/why-evalexec-is-bad.html)（强调我的）：

> 首先，**`exec`使人们更难阅读您的代码**。为了弄清楚发生了什么，我不仅要阅读你的代码，**我还必须阅读你的代码，弄清楚它将生成什么字符串，然后阅读那个虚拟代码。**所以，如果你在一个团队中工作，或者发布开源软件，或者在 StackOverflow 之类的地方寻求帮助，你会让其他人更难帮助你。而且，如果您有任何机会在 6 个月后调试或扩展此代码，那么您将直接让自己变得更加困难。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2010-11-25T16:03:11.053

`eval()`仅用于表达式，例如，虽然`eval('x+1')`有效，`eval('x=1')`但不起作用。在这种情况下，最好使用`exec`，甚至更好：尝试找到更好的解决方案:)

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2012-07-18T22:51:49.133

您可以使用 exec 完成代码的执行，如以下 IDLE 会话：

```
>>> kw = {}
>>> exec( "ret = 4" ) in kw
>>> kw['ret']

4 
```

* * *

## 回答 #8

> 赞同：9
> 
> 时间：2018-01-02T00:42:18.963

值得一提的是，如果要调用python文件，那`exec`兄弟也存在。`execfile`如果您正在使用包含糟糕 IDE 的第三方包并且您想在其包之外进行编码，这有时会很好。

**例子：**

`execfile('/path/to/source.py)'`

**或者：**

`exec(open("/path/to/source.py").read())`

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2018-11-19T18:29:49.617

正如其他人提到的，它是“执行” ..

但是，如果您的代码包含变量，您可以使用“全局”来访问它，也可以防止编译器引发以下错误：

> NameError：名称“p_variable”未定义

```
exec('p_variable = [1,2,3,4]')
global p_variable
print(p_variable) 
```

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-03-31T16:13:49.127

使用[eval](http://docs.python.org/library/functions.html)。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-03-31T16:14:05.770

查看[eval](http://docs.python.org/library/functions.html#eval)：

```
x = 1
print eval('x+1')
->2 
```

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2020-05-19T08:36:04.830

我尝试了很多东西，但唯一有效的是以下内容：

```
temp_dict = {}
exec("temp_dict['val'] = 10") 
print(temp_dict['val']) 
```

输出：

`10`

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-31T16:15:10.510

最合乎逻辑的解决方案是使用内置的[eval()](http://docs.python.org/library/functions.html#eval)函数。另一种解决方案是将该字符串写入临时 python 文件并执行它。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2017-04-12T13:00:15.600

好的..我知道这不完全是一个答案，但可能是给像我一样看这个的人的注释。我想为不同的用户/客户执行特定的代码，但也想避免 exec/eval。我最初希望为每个用户将代码存储在数据库中并执行上述操作。

我最终在“customer_filters”文件夹中的文件系统上创建文件并使用“imp”模块，如果没有为该客户应用过滤器，它就会继续

```
import imp

def get_customer_module(customerName='default', name='filter'):
    lm = None
    try:
        module_name = customerName+"_"+name;
        m = imp.find_module(module_name, ['customer_filters'])
        lm = imp.load_module(module_name, m[0], m[1], m[2])
    except:
        ''
        #ignore, if no module is found, 
    return lm

m = get_customer_module(customerName, "filter")
if m is not None:
    m.apply_address_filter(myobj) 
```

所以 customerName = "jj" 将从 customer_filters\jj_filter.py 文件中执行 apply_address_filter

# javascript - jQuery 事件选择器

> ID：701803
> 
> 赞同：0
> 
> 时间：2009-03-31T16:12:36.383
> 
> 标签：javascript, jquery, events, selector

假设我有 10 个小图像，我想用作工具提示。我为他们分配了同一个班级，'.helper'

我选择助手，然后打电话

```
mouseenter(function() { $(".helper").stop(false,true).fadeIn(); }) 
```

然后我想要一个 div 弹出，包含一些文本。如果页面上只有一个工具提示，这很好用，但是一旦有多个工具提示，每当我将鼠标悬停在一个上时，它们都会同时出现。

我有什么根本上的错误吗？

评论赞赏。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T16:18:08.210

`this`再次用作内部选择器而不是选择`.helper`器：

```
$('.helper').mouseenter(function() {
    // "this" now refers to the image that is being hovered...
    $(this).stop(false, true).fadeIn();
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T17:16:19.803

如果您想知道问题出在哪里，那就是您打电话时

```
 $(".helper") 
```

在您的函数中，您将使用类助手获取所有元素，而不仅仅是您想要的单个元素。

# c# - 从分层架构更新数据库：最好的方法？

> ID：701804
> 
> 赞同：1
> 
> 时间：2009-03-31T16:12:40.987
> 
> 标签：c#, database, data-access-layer

我已经构建了一个基本的 DAL，它可以使用这个 DAL 检索数据和一个包含多个对象的业务层。一旦我将数据映射到业务对象并对其进行了处理，我还想将数据写回数据库。一些业务对象有很多属性，因此将业务对象的每个值作为参数传递给相应数据服务的方法是不可能的。

我一直在考虑的其他方式：

1.  将业务对象传递给相应的数据服务，在那里执行一个将所有值作为参数的 SP。- 糟透了，因为我必须将一个业务对象传递给 DAL（违反分离）并且可能最终得到具有 >50 个参数的 SP

2.  在业务对象中创建一个空 (?) 数据集，用业务对象中的值填充它，将该数据集传递给数据服务并通过数据适配器更新数据库。我想用“... WHERE 0”-SQL 字符串创建一个空数据集。那会是一个好习惯吗？

这是我第一次做这样的事情。后者对我来说听起来更好，但也许还有其他更好的方法？或者由于某些我不知道的原因，第一个更好？

非常感谢你！

[编辑：] 我不能使用 LinQ2SQL，因为我使用 C# Express（它只支持查询本地数据库，而我的是远程数据库）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T16:26:14.103

将您的对象传递到您的 DAL。如果您手动编写 DAL 层，您的 DAL 层应该知道如何获取实体并将其持久保存到数据库，以及如何从数据库返回实体。DAL 是关于您的实体对非易失性介质的持久性。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T16:21:38.937

您还没有提到使用 LINQ。那是因为您还没有使用 .NET 3.5 吗？

此外，您不必使您的 DAL 通用。DAL 的调用者不会尝试更新业务对象的所有属性，是吗？他们可能想要更新其中的一部分，因此您应该提供一个执行此操作的 API。例如，他们可能只想将地址添加到联系人对象，或者甚至可能更新电话号码。您需要在执行调用者真正尝试执行的操作与执行此操作所需的单独方法的数量之间进行权衡。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T16:47:39.170

DAL 应该是关于您的业务对象和特定数据表示之间的映射。这就是为什么使用域对象的存储库模式允许您切换到不同的持久性实现，甚至可能不是数据库。

您担心需要向 DAL 的方法传递太多参数，然后举一个示例，您只需要传递 2 或 3 个值。如果是这种情况，将其作为方法的参数传递是合理的。如果要传递更多值，实现它的一种方法是定义一个包含要保存的值子集的接口。这样，您就可以清楚地指定该方法将处理的信息。

不管上述情况如何，不要让方法过于具体，因为你最终会得到很多组合，这会使维护变得更加困难。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T16:21:13.757

为什么您认为将业务对象传递给 DAL 时违反了分离。也许您应该考虑将业务对象分离到另一层。

你也可以尝试 linq2SQL，这样你就可以忘记参数，这将减少你的 SP 的数量。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T16:24:43.327

除非您的数据访问层非常通用，否则传递业务对象会很糟糕吗？

我喜欢序列化对象并将 XML 传递给存储过程，但我可能是少数。

# asp.net - 没有 Reporting Services 的 Web 报告解决方案？

> ID：701809
> 
> 赞同：3
> 
> 时间：2009-03-31T16:14:19.577
> 
> 标签：asp.net, sql-server, reporting

我正在研究一种在 Web 应用程序中创建报表的解决方案，但没有预算或人员来管理 SQL Server Reporting Services 安装。考虑到这些限制，我有什么选择？

我在 SQL Server 2005 上使用 ASP.NET 3.5。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T16:23:35.530

您可以使用 SSRS，但在本地模式下不是服务器模式。据我了解，当使用此方法呈现报告时，您不需要 SSRS。您还需要编写更多代码来支持报告。

然后其他选项包括查看其他报告包。Crystal Reports 是一种可能性，但如果您无法管理 SSRS，我猜 CR 是不可能的。

无论如何，这里有一些本地模式下 SSRS 的链接：

[http://www.vbdotnetheaven.com/UploadFile/justinsaraceno/Main11132006012727AM/Main.aspx](http://www.vbdotnetheaven.com/UploadFile/justinsaraceno/Main11132006012727AM/Main.aspx) [http://aspalliance.com/1318_Using_Local_Microsoft_SQL_Server_Reporting_Services_in_ASPNET](http://aspalliance.com/1318_Using_Local_Microsoft_SQL_Server_Reporting_Services_in_ASPNET)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-01T00:15:20.373

也许你可以使用 Jasper：http: [//jasperforge.org/](http://jasperforge.org/)

我相信有一个 jTDS 驱动程序可以连接到 sql server。

我不知道这是否可行或受支持，只是一个想法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-06-10T01:09:09.950

HTML 是一个报告层。你需要另一个吗？

# asp.net - Safari 4 beta 中的焦点选择内容

> ID：701818
> 
> 赞同：0
> 
> 时间：2009-03-31T16:16:01.103
> 
> 标签：asp.net, jquery, webforms, focus

我想在 ASP.Net 中的表单上使用 defaultfocus 属性，因此我将此属性设置为文本框。这在 IE 上按预期工作，但在 Safari 4 beta 中，文本框的内容也被选中。如何在 Safari 上按预期工作？

我也尝试了一些 jquery 调用，问题也存在：

$("input:visible:enabled:first").focus();

在 Safari 中，它看起来像是调用 select() 而不是焦点。有没有人可以解决这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T07:35:13.610

似乎您必须设置文本框的值才能在字段中而不是选择中获得焦点：

```
 var firstInput = $("input:text:first");
    firstInput.focus();
    firstInput.val(firstInput.val()); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T16:49:46.327

我相信 .net 的东西与 Safari/其他浏览器没有的特定于 IE 的 defaultfocus 属性挂钩。

我认为这会自动聚焦特定领域？

# php - 如何处理“有时”的继承？

> ID：701825
> 
> 赞同：1
> 
> 时间：2009-03-31T16:16:47.933
> 
> 标签：php, zend-framework, oop, domain-driven-design, orm

我有一种利用类表继承的情况，其中基础对象（抽象的）由对象的特定类型扩展。

例如，人员 --> 用户 --> 潜在客户

但是，在某些情况下，例如 Prospect，有时它会扩展 User，有时则不会。我无法扭转这种关系，因为 User !== Prospect 所以我想知道如何最好地处理这些对象有时会扩展而有时不会扩展的场景。

另外，我知道在这种情况下有人会建议组合而不是继承，但这确实不可行，因为我依赖于扩展父功能和填充成员属性的能力，以便以完全相同的方式访问所有属性。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T16:25:53.573

我闻[到了装饰图案](http://www.phppatterns.com/docs/design/decorator_pattern)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T17:08:50.197

数据库中的继承通常意味着子表的primary_key是父表的primary_key的foreign_key。
但你提到孩子可能是孤儿。在这种情况下，父级是一个可选关系。（通常通过组合解决）

您可以创建两个类，一个扩展用户，一个不扩展。

（但这可能不适合您尝试做的事情）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T17:12:01.763

遵循[装饰者模式](http://www.dofactory.com/Patterns/PatternDecorator.aspx)将是你最好的选择。不确定您使用的是什么语言，但这是 .NET 实现的另一个链接。

[http://www.dofactory.com/Patterns/PatternDecorator.aspx](http://www.dofactory.com/Patterns/PatternDecorator.aspx)

# iphone - iPhone Cocoa 混合模式数学基本错误

> ID：701832
> 
> 赞同：1
> 
> 时间：2009-03-31T16:17:51.707
> 
> 标签：iphone, c, math, floating-point

刚刚意识到，如果我在模拟器上的 iPhone SDK 中将整数与浮点数混合，我会在简单的数学运算上遇到错误。两个例子：

```
float testVal1 = 10 + 5/10; 
//evaluates to 10 instead of 10.5 unless I use explicit 10.0f..

// Problem Code mixed float int 
NSUInteger jvalue = 2312345;

NSInteger testVal2 = (jvalue - 2512345); // evaluates correctly
float testVal3 = (jvalue - 2512345); // fails with some huge bogus value 
```

我认为在混合模式表达式中它将转换为浮点值。使用浮动时似乎是全部或全部，没有混合

这里出了什么问题？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T16:23:31.660

没有任何问题；这就是操作的工作方式。看看你的例子：

```
float testVal1 = 10 + 5/10; //evaluates to 10 
```

这是这里的操作顺序：

1.  分析5：整数字面量
    *   分析 10：整数字面量
    *   5/10：整数除法，结果为 0
    *   10 + [0]：整数加法，结果为 10
    *   将结果分配给浮点数

要使这项工作以您想要的方式工作，至少有一个除法操作数必须是浮点数。结果现在将更像这样：

1.  分析5：整数字面量
    *   分析 10.0f：**浮点**字面量
    *   5/10.0f：**浮点**除法，结果 0.5
    *   10 + [0.5]：**浮点**加法，结果 10.5
    *   将结果分配给浮点数

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T16:23:54.250

这与 iPhone 或模拟器没有任何关系，它与 Objective-C 和 C 执行算术的方式有关。编译器将 5/10 的操作数解释为整数，根据定义，整数除法不能产生小数结果。因此，10 + 5/10 == 10 + 0 == 10。您可以尝试：

```
float testVal1 = 10.0f + 5.0f/10.0f; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T16:24:41.610

子表达式中的默认数据类型`5 / 10`为整数，直到其中一个操作数另有说明。但是`(5 / 10) = 0`由于整数除法。

在表达式`NSInteger testVal2 = (jvalue - 2512345);`中，子表达式的默认类型是无符号整数；您的否定结果会导致下溢和虚假值。

# version-control - 错误跟踪系统的源代码集成有什么好处？

> ID：701833
> 
> 赞同：3
> 
> 时间：2009-03-31T16:18:07.650
> 
> 标签：version-control, bug-tracking

我正在为我们的项目选择一个错误/问题跟踪系统。 [这个问题](https://stackoverflow.com/questions/12328/what-bug-tracking-software-do-you-use)和[这个问题](https://stackoverflow.com/questions/101774/what-is-your-bug-task-tracking-tool)有助于系统评估。但是，通过查看提供的各种产品，我提出了一个问题。

一些系统将源代码控制系统集成作为一项功能进行推广。这不是我以前使用过的东西，查看各种工具的网站，我找不到任何关于此集成提供的确切内容的详细信息。是不是通过我用来引发错误的同一个 Web 界面浏览我的存储库？

那么这种集成有什么好处呢？它将如何节省我的时间或使我们的产品更好？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-31T16:27:41.993

[Jira](http://www.atlassian.com/software/jira/)与[FishEye](http://www.atlassian.com/software/fisheye/default2.jsp)（SCM 浏览器）一起，当您提交带有 Jira 问题键（例如“PROJ-123”）的日志消息的变更集时，将链接插入到相应的 Jira 问题中，Jira 将显示一个链接在 PROJ-123 中提到该问题的变更集。

Jira 还可以与[Hudson](http://hudson-ci.org/)集成，因此当执行包含修复（即变更集）的构建时，该提交的日志消息中提到的 Jira 问题将获得有关构建状态的评论。

由于问题跟踪器用于跟踪源代码的问题，因此可以在集成的问题/源代码控制管理系统中想象大量功能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T16:25:44.183

我使用 Visual Studio Team Foundation Server 完成了这项工作，它不仅与源代码管理集成，还与数据仓库集成。例如，这允许它跟踪哪些错误是由哪些代码段引起的，显示哪些代码段需要更多的 QA。2010 版中即将推出的功能更加引人注目。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T16:22:28.450

主要优点是您可以针对源代码的特定修订提出错误。这仅有助于在发现错误时识别代码库的状态。我认为这个领域的一个流行产品是[Trac](http://trac.edgewall.org/)，它与 SVN 集成。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-02T14:31:28.983

好吧，我想说这里有一个重要的原因，那就是你可以以一种**面向任务/问题的**方式工作。

我是说：

*   您所做的每一次代码更改（从小的快速修复到大的新功能）都将成为您喜欢的[Jira](http://www.atlassian.com/software/jira/)或[Rally](http://www.rallydev.com/)或 Bugzilla、Trac、Mantis 中的一个问题。

*   这意味着问题/任务跟踪系统必须易于使用、快速、简单等，否则开发人员会讨厌它

*   然后将每个更改与问题相关联，您就完成了。您可以获得完整的可追溯性（非常适合差异调试，如果没有它，您会错过它）、更好的项目跟踪、更好的发布管理等等。

您可以将每个变更集/提交（取决于您的 scm 行话）链接到一个任务，或者，如果您的 scm 可以做到，则为每个错误修复创建一个分支，这样会更好。

基本上你得到的很简单：每一个变化都会被记录下来，或者至少与正确的问题/任务相关联。

如果您使用分支，您可以促进以下内容：始终在稳定的基线上工作，减少主线损坏（或使其原始，如果您愿意），决定哪些任务集成以及哪些任务保留到下一个版本，单独运行测试之前的更改合并等等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-03-16T13:45:15.413

[Github](https://github.com)基本上是相反的：与其说是包含源代码版本控制的错误/问题跟踪系统，而是插入了一些错误/问题跟踪的源代码版本控制。我不敢相信这里没有人提到它，因为这些天这种方式更常见。

但它非常强大，您基本上可以在问题中引用 git 提供的所有内容：提交、分支、拉取请求。Github 甚至安装了一些“自动”，将 PR 与“修复问题 #23”之类的内容合并，将自动关闭问题 #23。

Github 也非常方便，因为现在使用的大多数开源软件也托管在那里，您也可以在自己的问题/拉取请求等中引用所有这些库。此外，大多数围绕软件开发的典型现代商业基础设施也将与 Github 集成：[Travis](https://travis-ci.org)或[Codeship](https://codeship.com)会告诉你构建的情况，甚至自动部署它们，[Hound](https://houndci.com)或[Rubocop](http://batsov.com/rubocop/)会告诉你代码的外观，[Usersnap](https://usersnap.com)或[Trackduck](https://www.trackduck.com)会推送如果您不想使用他们的软件，请向您的 Github 问题报告错误。

如果您将其与 Github 进行比较，这里的答案中提到的 Trac 感觉*真的很老。*

# iphone - 用于编码的 iPhone 屏幕尺寸是多少？

> ID：701837
> 
> 赞同：1
> 
> 时间：2009-03-31T16:18:31.097
> 
> 标签：iphone

iPhone 中图像视图的可用区域是多少像素？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-31T16:21:35.113

如果需要，您可以通过以下方式访问完整的 480x320 屏幕：

```
[[UIApplication sharedApplication] setStatusBarHidden:YES animated:NO];
self.navigationController.view.bounds = CGRectMake(0,0,320,480);
self.navigationController.navigationBar.hidden = YES; 
```

您还会发现我在这篇文章中找到的有用[信息](http://forums.ilounge.com/archive/index.php/t-224401.html)：

[状态栏](http://developer.apple.com/iphone/library/documentation/UserExperience/Conceptual/MobileHIG/art/ui_statusbartypes.jpg)：20 像素 [导航栏](http://developer.apple.com/iphone/library/documentation/UserExperience/Conceptual/MobileHIG/art/ui_navbarnonavigation.jpg)：44 像素 [标签栏](http://developer.apple.com/iphone/library/documentation/UserExperience/Conceptual/MobileHIG/art/ui_selecteditemmodeswitcher.jpg)：49 像素 [工具栏](http://developer.apple.com/iphone/library/documentation/UserExperience/Conceptual/MobileHIG/art/ui_taskstyletoolbar.jpg)：44 像素

希望能帮助到你。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-03-01T09:50:26.377

这是Pablo 提到的特定元素的尺寸的[可视化表示](http://www.idev101.com/code/User_Interface/sizes.html)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T16:20:37.567

谷歌是你的朋友： [http ://www.google.com/search?hl=en&q=iphone+screen+resolution&btnG=Google+Search&aq=0&oq=iphone+screen+res](http://www.google.com/search?hl=en&q=iphone+screen+resolution&btnG=Google+Search&aq=0&oq=iphone+screen+res)

（简短回答：480 x 320）

# java - 基于角色或购物车样式的 Java bean 绑定？

> ID：701850
> 
> 赞同：0
> 
> 时间：2009-03-31T16:20:32.620
> 
> 标签：java, jaxb

我有一个 POJO，我想将它作为 XML 从 Web 服务公开，最好使用 JAX-B。

需要在 XML 中公开的字段取决于发出请求的用户类型。例如，我们有一个人力资源和财务用户的角色。用户可能被定义为：

@XmlRootElement

公共类用户{

@XmlElement public String someHumanResourceData;

@XmlElement public String someFinanceData;

}

我希望 HR 用户可以看到 HR 数据，而 Finance 可以看到 Finance 数据，但仅此而已。HR 不应查看财务数据。

有没有推荐的方法来做到这一点？我可以使用哪些搜索词在 Web 上查找更多信息？

一些我觉得没有吸引力的想法：1）我可以使用子类化来公开仅具有相关数据的 FinanceUser 和 HumanResourceUser，以及具有共享数据的父 User。但是，这很脆弱，可能适用于一个小例子，我觉得我需要一种更灵活、更组合的生产方法。2) 一位同事推荐了一种“购物车”方法，在这种方法中，客户在每个请求中请求他/她想要的字段。我没有找到一种标准的方法来做到这一点，甚至没有找到许多其他人已经做过这种方法。对我来说，这听起来真的是本土的和劳动密集型的。

还有其他想法吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-31T16:32:00.690

为什么不检查用户在服务器端 Web 服务实现中的角色？

你的网络服务接口是什么？

```
public interface DarcysWebService {
    public HumanResourceResponse getHumanResourceData(Authentication a, HumanResourceRequest req);
    public FinanceResponse getFinanceData(Authentication a, FinanceRequest req);
} 
```

然后，我将根据您的用户数据库（uuid、用户名、密码、角色）检查提供的身份验证数据（用户名、密码），然后使用角色来确定响应是否是一条消息“错误 - 你没有访问权限”或用请求的数据实际填充响应中的数据字段/对象。

# iphone - 是否可以创建一个在 iPhone 上提供摄像头功能的应用程序，但仍然可以在没有摄像头功能的 iPod touch 上运行？

> ID：701859
> 
> 赞同：1
> 
> 时间：2009-03-31T16:21:36.360
> 
> 标签：iphone

如果用户有 iPhone，我想制作一个可以使用 cam 为用户照片拍摄快照的应用程序。如果他有 iPod touch，他可能会选择标准头像，但该应用程序应该仍然可以在 iPod touch 上运行。那可能吗？

还是苹果不允许以编程方式区分“是的，他有 iPhone”和“是的，他有 iPod touch”？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T16:43:38.930

绝对地！

当您打开图像选择器时，您可以指定从哪里获取图像 - 相机、以前的相机照片或只是相册。

您可以通过在 UIImagePickerController 中调用 isSourceTypeAvailable 来检测这些是否可用 - 例如`[UIImagePicker isSourceTypeAvailable:UIImagePickerControllerSourceTypeCamera]`

大多数应用程序都会显示一个带有可用选项（和取消）按钮的警报表，并让用户选择。在 iPod Touch 上，“相机”按钮不会出现（除非 Apple 推出带有相机的未来触控型号！）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-01T01:24:06.357

这里有一些关于如何检测您的代码运行在什么设备上的示例代码：

[http://iphonedevelopment.blogspot.com/2009/05/device-detection.html](http://iphonedevelopment.blogspot.com/2009/05/device-detection.html)

主要功能是：

```
 NSString *model= [[UIDevice currentDevice] model]; 
```

# architecture - Memcached 的缓存策略？

> ID：701863
> 
> 赞同：7
> 
> 时间：2009-03-31T16:22:07.733
> 
> 标签：architecture, memcached, scalability

我是在大型网站上使用 Memcached 等分布式缓存解决方案的新手，我有几个问题，请有经验的人发表评论。

1.  显然，我可以放入缓存的数据量取决于服务器 RAM。假设我有足够大的服务器场和 RAM，在我开始看到性能下降之前，我可以放入 memcached 的最大对象数量吗？我问的原因是，我认为如果我将数百万个对象放入 memcached 中，索引和查找对象是否需要更长的时间？这里有没有可以画的线。

2.  我应该在 memcached 中缓存更小但更多的对象，还是更大但更少的对象？较小的对象确实涉及到 DB 的更多往返来获取它们，但它更灵活且更易于编程。

非常感谢，

射线。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-04T17:05:35.063

Memcached 在内部使用哈希进行 O(1) 查找 - 它旨在尽可能少地做复杂的工作。

至于要缓存的内容，无论大小，它实际上是关于您需要存储什么可以节省您的精力（请记住，它是一个大而愚蠢的缓存，如果您更改一个也被提及的部分，您必须帮助它保持同步到别处）。在它为 Livejournal.com 编写的原始网站上，有意义的最大块是一个完整的日记条目 - 作为允许查看该特定帖子的任何人都可以使用的完成的 HTML。

我已经将它用于一些非常小的条目——实际上是一个针对成员 ID 的单个数字，但我正在使用单个数据库查询而不是根据需要一次生成数千个这样的条目。

如果您知道您将只存储非常大或非常小的项目，您可以稍微优化守护程序，但是对于许多小条目，它有足够的智能将空的大块内存分成更小的块以供使用。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-31T16:32:14.200

> 假设我有足够大的服务器场和 RAM，在我开始看到性能下降之前，我可以放入 memcached 的最大对象数量吗？

理想情况下，您的缓存应始终 100% 满。memcached 使用散列算法来查找键，据我所知，存储更多键不应该有性能损失。

> 我应该在 memcached 中缓存更小但更多的对象，还是更大但更少的对象？

我想更大但更少的对象会更好地减少数据库和缓存查找的时间，但你应该根据具体情况来考虑。除非您知道性能差异会很大，否则我建议您先从最简单的开始，如果这还不够，则从那里开始工作。

# rest - 关于为现有 Web 应用程序设计 RESTful API 的问题

> ID：701866
> 
> 赞同：2
> 
> 时间：2009-03-31T16:22:53.643
> 
> 标签：rest

我们有一个可以为论文评分的现有网络应用程序。

用户可以开始对文章进行新的修订、保存、恢复或提交（用于评分）。提交修订后，它会被标记为 COMPLETE，以后不会更改。如果用户开始一个新的修订，先前的响应将被复制到当前的修订。如果用户恢复修订 - 他使用当前修订（即 IN PROGRESS）。已保存但未提交的修订处于“进行中”状态。

我们需要设计一个允许在客户端应用程序中执行相同操作的 API。

作为第一步，我们需要获取文章的最新版本（它可能正在进行中或已完成或尚不存在（因此只返回一个模板））。

```
获取用户/{userid}/revisions/mostrecent
```

修订的格式是这样的

```
 <revision>
     <id> </id>
     <response> </response>
     <status> </status>
 </revision> 
```

稍后，客户端应用程序应发送更改的修订版。

但是我不确定如何处理论文修订的不同状态（'IN PROGRESS'，'COMPLETE'），即客户端应用程序是否应该根据修订状态执行不同的 PUT/POST 操作，或者它应该只是 POST 某事和一切应该在服务器端处理（我相信它不是 RESTful API）？

我认为发送新修订版将是：

```
POST 用户/{userid}/revisions
```

并更新当前版本：

```
PUT 用户/{userid}/revisions/{id}
```

但是如何区分修订应该只保存而不是提交（通过将状态设置为'INPROGRESS'）？

以及如何防止创建多个 IN PROGRESS 修订（如果已经有“INPROGRESS”修订，则不会执行 POST）？

如何防止更新以前的版本（如果 status = COMPLETE 则禁止 PUT？）

感谢您的任何提示或建议。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-07-20T22:38:14.560

指定诸如“GET user/{userid}/revisions/mostrecent”之类的 URI 命名约定违反了 RESTful 架构的约束之一。如果您想将其称为 RESTful，则不能将资源的 URI 或 URI 模板定义为 API 的一部分。

有关详细信息，请参阅[http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven](http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T18:51:59.497

您是否考虑过使用带有[版本控制的](https://www.rfc-editor.org/rfc/rfc3253)[WebDAV](https://www.rfc-editor.org/rfc/rfc4918.html)来完成这项任务？我认为这比在 HTTP 之上滚动你自己的协议要强大得多。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T17:52:07.157

感谢您的回答。

所以我知道要模仿我们的网络应用程序的行为，客户端也应该有一个逻辑。对于所有情况，只有一个通用命令（如 POST/PUT 修订版）是不够的（开始一个新修订版，恢复前一个修订版）。如果修订是 IN PROGRESS，客户应该区分这种情况，它可以保存/提交，但如果它是 COMPLETE（和所有其他情况）则不能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T16:37:47.727

> 但是如何区分修订应该只保存而不是提交（通过将状态设置为'INPROGRESS'）？

如果您将 id 作为参数传递，这是否本身就推断应该保存修订版？{Id} 是论文还是修订版？如果是为了文章，那么只需为修订创建一个 id（或者甚至可能只是一个日期时间戳），然后在 restful URI 中传递它......

PUT 用户/{userid}/essays/{id}/revisions/{revisionId}

您可以在文章上使用[锁定](http://msdn.microsoft.com/en-us/library/c5kehkcz(VS.71).aspx)机制来防止并发修订（如果您使用的是 Sql Server，则可以使用[数据库锁定](http://www.sqlteam.com/article/introduction-to-locking-in-sql-server)），并且“已完成”标志对我来说听起来是一个好主意，以防止更新以前的修订。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-31T16:56:10.553

您可以在提供状态的 PUT/POST 请求中发送数据。必要的是这样的情况，或者在某种意义上修改记录而不“提交”它的任何其他情况。事实上，您实际上在做的是一个 RESTful 事务。

您的其他问题需要应用程序中的业务逻辑。REST 仅告诉您返回适当的状态代码以响应请求；它没有规定您应该如何以及是否应该根据数据状态处理请求。

话虽这么说，你问的松散逻辑是：

```
if is_new_revision() and old_revision_is_pending():
  return "409 Conflict"
if revision_id != most_recent_revision_id:
  return "403 Forbidden" 
```

# asp.net - Asp.Net Search，发现按键变化

> ID：701876
> 
> 赞同：1
> 
> 时间：2009-03-31T16:25:24.747
> 
> 标签：asp.net, search, autocomplete, autosuggest

我正在尝试在 Asp.Net 中实现一个搜索栏，每次按键都会改变结果。我希望搜索栏包含与他们迄今为止输入的内容有关的可用结果的下拉列表。

因此，如果您正在搜索状态，并且您输入了 M，它会列出所有以 M 开头的状态，但是如果您在其中添加一个 i……它会将结果截断为仅以 Mi 开头的那些状态。

现在我只有一个文本框，它在文本更改时调用一个方法。问题是只有重新加载页面才能看到结果。我可以在该方法中重新加载页面，但这似乎是错误的。

有没有更简单的方法来做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T16:28:25.457

试试 AjaxControl Toolkit 的 AutoComplete..

[http://www.asp.net/AJAX/AjaxControlToolkit/Samples/AutoComplete/AutoComplete.aspx](http://www.asp.net/AJAX/AjaxControlToolkit/Samples/AutoComplete/AutoComplete.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T16:47:46.597

我会使用 jQuery 和它的 $.autocomplete 方法，因为它更可定制。

更多信息和演示[在这里](http://docs.jquery.com/Plugins/Autocomplete)。

# character-encoding - 什么是 ANSI 格式？

> ID：701882
> 
> 赞同：253
> 
> 时间：2009-03-31T16:26:45.320
> 
> 标签：character-encoding, ascii, ansi, codepages

什么是ANSI编码格式？它是系统默认格式吗？它与 ASCII 有什么不同？

* * *

## 回答 #1

> 赞同：289
> 
> 时间：2009-03-31T16:34:15.957

ANSI 编码是一个稍微通用的术语，用于指代系统上的标准代码页，通常是 Windows。在西方/美国系统上，它更恰当地称为[Windows-1252 。](http://en.wikipedia.org/wiki/Windows-1252)（它可以表示其他系统上的某些其他[Windows 代码页](http://en.wikipedia.org/wiki/Windows_code_page)。）这本质[上是 ASCII 字符集的扩展，](http://en.wikipedia.org/wiki/Extended_ASCII)因为它包括所有 ASCII 字符以及额外的 128 个字符代码。这种差异是由于“ANSI”编码是 8 位而不是 ASCII 的 7 位（如今 ASCII 几乎总是编码为[MSB](https://en.wikipedia.org/wiki/Most_significant_bit)设置为 0 的 8 位字节）。请参阅文章以了解为什么此编码通常称为 ANSI。

“ANSI”这个名字用词不当，因为它不符合任何实际的 ANSI 标准，但这个名字一直存在。ANSI 与 UTF-8 不同。

* * *

## 回答 #2

> 赞同：65
> 
> 时间：2009-03-31T19:10:09.840

从技术上讲，ANSI 应该与 US-ASCII 相同。它指的是 ANSI X3.4 标准，它只是[ANSI](http://www.ansi.org/)组织批准的 ASCII 版本。ASCII/ANSI 中没有定义高位集字符的使用，因为它是一个 7 位字符集。

然而，多年来 DOS 和随后的 Windows 社区对该术语的误用已使其实际含义成为“正在使用的任何机器的系统代码页”。系统代码页有时也称为“mbcs”，因为在东亚系统上，它可以是每个字符多字节的编码。一些代码页甚至可以使用高位清除字节作为多字节序列中的尾随字节，因此它甚至不与纯 ASCII 严格兼容……但即便如此，它仍然被称为“ANSI”。

在美国和西欧的默认设置中，“ANSI”映射到 Windows 代码页 1252。这与 ISO-8859-1 不同（尽管非常相似）。在其他机器上，它可能是其他任何东西。这使得“ANSI”作为外部编码标识符完全无用。

* * *

## 回答 #3

> 赞同：41
> 
> 时间：2009-03-31T16:58:32.997

严格来说，不存在 ANSI 编码之类的东西。通俗地说，术语 ANSI 用于几种不同的编码：

1.  ISO 8859-1
2.  视窗 CP1252
3.  Windows 机器上的当前系统编码（在 Win32 API 术语中）。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2014-09-22T08:41:58.350

曾几何时，微软和其他所有人一样，使用 7 位字符集，并在适合他们的时候发明了自己的字符集，尽管他们将 ASCII 作为核心子集。然后他们意识到世界已经转向 8 位编码，并且周围有国际标准，例如 ISO-8859 系列。在那个年代，如果你想获得一个国际标准并且你住在美国，你从美国国家标准协会 (ANSI) 那里购买它，它以自己的品牌和编号重新发布国际标准（那是因为美国政府想要符合美国标准，而非国际标准）。所以微软的 ISO-8859 副本在封面上写着“ANSI”。而且因为当时微软还不太习惯标准，所以他们没有 没有意识到 ANSI 还发布了许多其他标准。因此，他们通过封面上的名称“ANSI”引用了 ISO-8859 系列中的标准（以及他们发明的变体，因为当时他们并不真正了解标准），并且它进入了微软用户文档，从而进入用户社区。那是大约 30 年前的事了，但今天你仍然有时会听到这个名字。

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2009-03-31T16:33:47.970

[ASCII](http://en.wikipedia.org/wiki/ASCII)只是定义了一个包含 128 个符号的 7 位代码页。ANSI 将其扩展到 8 位，符号 128 到 255 有几个不同的代码页。

命名 ANSI 是不正确的，因为它实际上是定义此代码页的 ISO/IEC 8859 规范。请参阅[ISO/IEC 8859](http://en.wikipedia.org/wiki/ISO/IEC_8859)以供参考。ISO/IEC 8859-1 到 ISO/IEC 8859-16 共有 16 个代码页。

[Windows-1252](http://en.wikipedia.org/wiki/Windows-1252)再次基于 ISO/IEC 8859-1，主要在 128 到 159 范围内的[C1 控制](http://en.wikipedia.org/wiki/C0_and_C1_control_codes)范围内进行了一些修改。维基百科指出 Windows-1252 也称为 ISO-8859-1，第二个ISO 和 8859 之间的连字符。（难以置信！谁会这样做？！？）

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-31T17:02:49.587

基本上，“ANSI”指的是 Windows 上的旧代码页。另请参阅[Raymond Chen](https://devblogs.microsoft.com/oldnewthing/20040531-00/?p=39103 "为什么默认的 8 位代码页称为“ANSI”？")关于此主题的文章：

> 其根源在于 Windows 代码页 1252 最初基于 ANSI 草案，该草案成为 ISO 标准 8859-1。

在大多数代码页中，前 127 个字符与 ASCII 相同，但上面的字符有所不同。

但是，ANSI 并不*自动*表示 CP1252 或拉丁语 1。

尽管您现在应该简单地避免此类问题并使用Unicode，但所有的混乱。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2015-03-25T14:55:18.600

万一您的 PC 不是“西方”PC，并且您不知道使用哪个代码页，您可以查看此页面：[国家语言支持 (NLS) API 参考](https://www.microsoft.com/resources/msdn/goglobal/default.mspx)

*[Microsoft 删除了此参考，取自 web-archive [National Language Support (NLS) API Reference](https://web.archive.org/web/20171015144140/https://www.microsoft.com/resources/msdn/goglobal/default.mspx)*

或者您可以查询您的注册表：

```
C:\>reg query HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Nls\CodePage /f ACP

HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Nls\CodePage
    ACP    REG_SZ    1252

End of search: 1 match(es) found.

C:\> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-31T16:33:35.490

使用单字节字符时，ASCII 格式定义前 127 个字符。128-255 的扩展字符由各种 ANSI 代码页定义，以允许对其他语言的有限支持。为了理解 ANSI 编码的字符串，您需要知道它使用哪个代码页。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-31T17:10:22.860

我记得当“ANSI”文本提到伪 VT-100 转义码时，可通过 ANSI.SYS 驱动程序在 DOS 中使用以改变流文本的流[...... //en.wikipedia.org/wiki/ANSI_escape_code](http://en.wikipedia.org/wiki/ANSI_escape_code)

* * *

## 回答 #10

> 赞同：-4
> 
> 时间：2009-03-31T16:32:21.873

**ANSI**（又名 Windows-1252/WinLatin1）是拉丁字母的字符编码，与[ISO-8859-1](http://en.wikipedia.org/wiki/ISO-8859-1)非常相似。您可能想[在 Wikipedia 上查看它](http://en.wikipedia.org/wiki/Windows-1252)。

# c# - 我应该遵循内部事件的事件模式吗？

> ID：701884
> 
> 赞同：0
> 
> 时间：2009-03-31T16:27:13.367
> 
> 标签：c#, .net

我了解使用 EventHandler/EventArgs 模式处理事件的优点，但是它确实增加了很多开销。

```
public class FooBarEventArgs : EventArgs
{
  public int Arg1 { get; set; }
  public string Arg2 { get; set; }
}

public event EventHandler<FooBarEventArgs> FooBar; 
```

你会打破内部事件的事件模式吗？

```
internal event Action<int, string> FooBar; 
```

还是直接公开代表会更好？

```
internal Action<int, string> FooBar; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T16:43:56.777

我认为坚持通用模式始终是最好的选择。即使它引入了开销，将来也更容易理解和维护代码。你永远不知道谁最终会维护你的代码，你会通过不使用这样的“快捷方式”来帮他/她一个忙。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T17:13:23.337

考虑到它实际上并没有那么多开销。另请注意，属性名称将为调用者提供额外的信息，这是您在使用这样的 Action 委托时所没有的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T16:36:55.030

这取决于很多事情。

*   粒度：这些内部事件是否与外部事件具有相同的规模，还是更小/更原始/更频繁？
*   混溶性：这些内部事件是否与外部事件是同一类事物，以便在概念上将它们混合在一起是有意义的？
*   支持：您是否使用事件循环的任何支持功能（日志记录、撤消等）也希望应用于内部事件？

如您所见，没有明确的正确答案；这取决于您的意图是什么，以及它们如何适应整个应用程序。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-31T17:07:24.287

我相信不遵循常规事件和事件处理模式（使用 EventHandler/EventHandler）会引发 FxCop/StyleCop 违规。如果静态代码分析、可读性和代码质量对您/您的项目很重要，您应该坚持使用常规事件模式。

# video - 有哪些技术可用于程序化视频编辑？

> ID：701885
> 
> 赞同：3
> 
> 时间：2009-03-31T16:27:41.947
> 
> 标签：video, video-capture

问题：

用户应该能够从在其系统上运行的应用程序（胖客户端）中上传高分辨率视频剪辑。在这个应用程序中，我需要一个能够将视频转换为低分辨率版本的框架或库。

另一方面，我需要能够立即从图像构建视频的东西，并以看起来像视频的方式对它们进行动画处理。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-28T19:44:10.307

我会推荐以下内容：

## 视窗

*   [DirectShow SDK](http://msdn.microsoft.com/en-us/library/dd375454%28VS.85%29.aspx)
*   [媒体基础 SDK](http://msdn.microsoft.com/en-us/library/ms696274(VS.85).aspx)
*   [快速时间 SDK](http://developer.apple.com/quicktime/download/)

## 苹果电脑

*   [QTKit 框架](http://developer.apple.com/quicktime/qtkit.html)

## Linux

*   [GStreamer](http://gstreamer.freedesktop.org)

如果您需要跨平台解决方案，我会推荐商业[MainConcept CodecSDK](http://www.mainconcept.com)，它有一些最好的视频编解码器实现。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T17:00:21.620

你没有说哪个系统，所以我从 Linux 的答案开始：看看[phonon](http://phonon.kde.org/)和[gstreamer](http://www.gstreamer.net/)。如果您不介意命令行界面，请查看[avidemux](http://avidemux.org/)和 mencoder（[MPlayer](http://www.mplayerhq.hu/)的一部分）。

请注意，phonon 在 Windows 和 Mac 上也可用。

# c# - 如何在 Vista 上设置 smtp 以便可以使用 System.Net.Mail？

> ID：701887
> 
> 赞同：8
> 
> 时间：2009-03-31T16:27:43.727
> 
> 标签：c#, .net, email, windows-vista, smtp

据我了解，Vista 上的 IIS 中没有 SMTP 服务器。我正在做一个需要我发送电子邮件的项目。我想从运行 Vista Ultimate 的开发盒上的一些简单原型开始。我没有连接到可以在某个地方使用交换服务器的公司网络。

我意识到我可以安装几个 smtp 服务器，但是我不确定安装一个后该怎么做。我知道如何编写代码来发送电子邮件，但我不知道需要做什么样的配置才能使用 smtp 服务器。

我想要的是一个清晰的描述，一旦我在我的 Vista 机器上安装了一个 smtp 服务器，该做什么。

谢谢！

更新：我下载了这个 smtp 服务器：[http ://softstack.com/freesmtp.html](http://softstack.com/freesmtp.html)

这是我的代码的样子：

```
class Program
{
    static void Main(string[] args)
    {
        MailMessage message = new MailMessage();    
        message.From = new MailAddress("tad@myconsoleapp.com");    
        message.To.Add(new MailAddress("terry.donaghe@gmail.com"));               
        //message.To.Add(new MailAddress("recipient3@foo.bar.com"));    
        //message.CC.Add(new MailAddress("carboncopy@foo.bar.com"));    
        message.Subject = "This is my subject";    
        message.Body = "This is the content";    
        SmtpClient client = new SmtpClient("localhost");    
        client.Send(message);    
        Console.ReadLine();     
    }
} 
```

当我运行这个 smtp 服务器并执行我的控制台应用程序时，它会处理 client.send 行。smtp 服务器如下所示：

[http://screencast.com/t/2B7jv0bE14](http://screencast.com/t/2B7jv0bE14)

一段时间后，client.send 超时。

任何想法现在出了什么问题？

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-31T16:35:40.087

如您所知，SMTP 不再随 Vista 一起提供（这是我对 Vista 最大的抱怨之一）。正如您已经知道的那样，那里有很多选择，如果您找到一个不错的免费选项，请发布指向它的链接。您如何配置它可能取决于您安装的服务器。

我使用了一些试用 smtp 服务器，我使用的所有服务器都开始在环回 IP 地址上的标准 SMTP 端口上侦听。我相信这是默认的 MailSettings，不需要任何更改。

我不再有任何 SMTP 服务器，并且正在使用 Pickup Directory 模式。这会导致邮件库输出一个文件，然后我可以检查该文件。

要对此进行配置，请在配置文件中使用以下内容：

```
<system.net>
    <mailSettings>
        <smtp deliveryMethod="SpecifiedPickupDirectory">
            <specifiedPickupDirectory
              pickupDirectoryLocation="c:\maildrop"/>
        </smtp>
    </mailSettings>
</system.net> 
```

如果您想将其配置为连接到本地主机上的端口 25，您可以在 SMTP 部分这样做：

```
<smtp deliveryMethod="Network">
   <network defaultCredentials="true" host="localhost" port="25"/>
</smtp> 
```

# 编辑

特里问了一个关于使用放置位置的好问题。我只将它用于测试，因为我们的生产服务器有一个我连接到的 SMTP 服务器，并通过它发送电子邮件；但是，可以将一些 SMTP 服务器配置为监视目录，并在其中接收和邮寄任何内容。

我不认为此功能仅用于测试，但效果很好。生成的文件可以在各种邮件客户端中打开，这样您就可以看到它们将如何呈现它们。我相信他们是 .eml 文件，但我不记得了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T16:53:18.423

`C# .NET`您可以在[stickymailserver](http://stickymailserver.codeplex.com/)中找到一个非常基本的 SMTP 服务器：

> Sticky Mail Server 是一种低交互 SMTP 蜜罐，旨在模拟开放的 SMTP 中继。它捕获和记录探测消息和群发邮件，并保存它们以供以后分析。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-01T03:55:10.237

您可以使用外部托管的 SMTP 服务器。我发现如果原始 SMTP 服务器位于动态 IP 地址后面（如大多数住宅系统），许多电子邮件系统将阻止访问。

我最近不得不这样做。

```
 SmtpClient smtp = new SmtpClient("smtp.myserver.com");
 smtp.DeliveryMethod = SmtpDeliveryMethod.Network;
 smtp.Credentials = new System.Net.NetworkCredential("Username", "Password"); 
```

使用“SendCompleted”事件，您可以在后台发送电子邮件而不会延迟应用程序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-08-10T14:01:47.040

@乔什伯克

我尝试使用以下选项，但收到“无法获取 IIS 拾取目录”。我知道我指向一个现有目录，是否需要在该目录上设置权限？

```
<smtp deliveryMethod="SpecifiedPickupDirectory">
     <specifiedPickupDirectory pickupDirectoryLocation="c:\maildrop"/>
</smtp> 
```

# windows - Cygwin/Windows 的最佳终端环境？

> ID：701895
> 
> 赞同：53
> 
> 时间：2009-03-31T16:28:29.497
> 
> 标签：windows, cygwin, rxvt

`rxvt`今天我使用以下启动行运行 Cygwin ：

```
`rxvt -bg black -sl 8192 -fg white -sr -g 150x56 -fn "Fixedsys" -e /usr/bin/bash --login -i` 
```

`这给了我一个可调整大小的原生 Windows 窗口，它比默认`cygwin.bat`提供的标准“DOS 框”要好得多。`

 `但是，当前配置确实存在几个问题：

1.  我无法在终端窗口中输入非 ASCII 字符（即 æ、ø、å 和 Æ、Ø、Å，我经常使用它们。事实上，当我将它们粘贴到终端时，终端甚至不会接受它们如果我粘贴一个像“bølle”（挪威语中“bulley”的意思）这样的字符串，我得到的只是“blle”。
2.  我无法渲染 UTF-8 字符，它们只显示为？，即使它们受字体支持（即在 ISO-8859-1 中渲染相同的字符时，它们显示得很好。）。

我正在运行英语 Windows Vista，语言环境和键盘布局设置为挪威语（ISO-8859-1 字符集？），但我在 Windows 2000 和 XP 上遇到了完全相同的问题。

任何人都知道如何解决这个问题（即配置 rxvt 的更好方法）？

除了上面提到的问题，我很满意`rxvt`，所以如果我找到解决它们的方法，我想继续使用它。但是，如果问题不是（容易）解决的，那么 Cygwin 是否还有其他好的终端解决方案？

**更新**

Andy 和 Mattias 提供的解决方案（编辑`.inputrc`文件）确实解决了输入问题，但输出渲染仍然是一个问题。当我在 ISO-8859-1 中渲染时输出很好，但是当使用 UTF-8 时我只得到 ? 对于非 ASCII 字符。这种行为在`rxvt`, `urxvt`（在 Cygwin XFree X Server 下）`mintty`和 PuttyCyg 之间是一致的。

是否有类似的配置文件可以设置输出编码（即相当于在 Linux 系统上设置输出语言环境）？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-31T16:41:02.040

minTTY 也不错。您可以在 cygwin 的设置中找到它。支持调整大小、粘贴和透明度。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-03-31T16:34:58.590

我目前正在使用 PuttyCyg ( [http://code.google.com/p/puttycyg/](http://code.google.com/p/puttycyg/) )。我不确定它是否包含您需要的修复程序，但它还有其他几个很酷的功能，例如存储到典型 putty 配置文件的配置，可以像这样调用：putty -load mycygwin1。这样的配置文件可以配置如下：

*   将会话记录到文件中，
*   delete、home 和其他键的字符序列，
*   窗口颜色和字体。

**编辑：**可以输入您提到的字符。还提供了 UTF-8 支持（必须在配置中打开）。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-01T11:07:52.490

将以下两行添加到 readline 配置文件 ~/.inputrc

```
set convert-meta off
set output-meta on 
```

应该在 rxvt 和 mintty 中都可以使用。更多在这里：

[http://www.gnu.org/software/bash/manual/bashref.html#Readline-Init-File-Syntax](http://www.gnu.org/software/bash/manual/bashref.html#Readline-Init-File-Syntax)

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-01T11:32:48.733

我也在使用[控制台](http://sourceforge.net/projects/console/)。控制台允许您自定义字体、背景等，并且还有一个选项卡式界面（如果您一次使用多个终端窗口，那就太好了）。

为了能够使用非 ASCII 字符，我在主目录的 .inputrc 文件中添加了以下内容：

```
set meta-flag on
set convert-meta off
set output-meta on
set completion-ignore-case on 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2013-09-23T03:33:08.313

在撰写本文时，已经四岁了，问题的核心已经消失：默认的 Cygwin 终端现在可以在没有形式的情况下粘贴和渲染非 Ascii 字符，至少对我来说是这样。Cygwin 的默认终端现在是 mintty 并且 Cygwin 现在默认使用 UTF-8 运行。（例如，/etc/profile.d/lang.sh 现在默认设置 UTF-8 字符集编码。）现在有 64 位版本的 Cygwin 但是，根据[http://www.cygwin.com/ml/ cygwin/2013-09/msg00029.html](http://www.cygwin.com/ml/cygwin/2013-09/msg00029.html)，没有 rxvt 的 64 位端口。

甚至标题中的问题也没有以前那么重要了，因为 mintty 不像旧的 Windows 命令控制台子系统窗口那样令人讨厌。不过，我将插入我共同维护的项目：[https](https://github.com/software-jessies-org/jessies/wiki/Terminator) ://github.com/software-jessies-org/jessies/wiki/Terminator ，它是为 UTF-8 编写的，可能从第一天开始，虽然它的主要卖点点，imo，是查找功能。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-05-28T08:48:12.737

您可能需要设置代码页。

检查您的当前：

```
$ set | grep CYGWIN
CYGWIN='codepage:oem nodosfilewarning' 
```

如果您没有代码页，请添加到您的 ~/.bashrc 文件中：

```
CYGWIN='codepage:oem nodosfilewarning' 
```

通过快捷方式启动的 Cygwin 批处理 (Cygwin.bat) 文件的内容是：

```
start C:\cygwin\bin\rxvt.exe -sb -sl 3000 -fg gray -bg black -fn "Lucida Console-14" -e /bin/bash --login -i 
```

请注意，对于 CYGWIN 环境变量，您可以有多个项目，每个项目由一个空格分隔。其他可以使用的项目：{ tty binmode title }。

更多信息可以在这里阅读： [http ://www.cygwin.com/cygwin-ug-net/setup-env.html](http://www.cygwin.com/cygwin-ug-net/setup-env.html)

相关说明：您也可以将 mrxvt 用于 Cygwin。它需要一个 X 服务器，一个不错的可靠/轻量级解决方案是使用 Xming。我编译了 mrxvt 并安装了它——这并不难，而且效果很好。

我使用 rxvt 作为初始窗口，然后使用别名命令将 mrxvt 作为与 rxvt 的单独进程启动，然后关闭 rxvt。这使得 mrxvt 成为自己的父进程，并且没有附加 cmd 会话。

我为此做了一个别名：

```
alias mrx='export DISPLAY="127.0.0.1:0.0"; $(/usr/local/bin/mrxvt &); echo -e "\033c"' 
```

为方便起见，我创建了一个批处理文件来启动 Xming 和 rxvt：

```
@echo off
start C:\cygwin\bin\rxvt.exe -sb -sl 3000 -fg gray -bg black -fn "Lucida Console-14" -e /bin/bash --login -i
start C:\Xming\Xming.exe :0 -clipboard -multiwindow -trayicon
exit 
```

此批处理文件由 Windows 快捷方式启动。这对我来说效果很好。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-01T11:16:57.913

我一直在使用[控制台](http://sourceforge.net/projects/console/)，它与 Cygwin（以及 PowerShell 和普通的旧 cmd.exe）配合得很好。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-01T11:21:30.507

当我在 Windows 上进行开发时，我发现[Poderosa](http://poderosa.sourceforge.net/)是 Cygwin 的一个不错的选择。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-01T13:17:27.017

带有 xterm 的标准 Cygwin/X 对我来说已经足够了。安装 Cygwin X.org 包，然后运行脚本`C:\cygwin\bin\startxwin.bat`（假设默认安装路径）。它将启动 X，然后启动 xterm。

我`.Xdefaults`用这些选项更新了我的选项以获得更好的可用性：

```
*VT100*scrollbar.width:         14
*VT100*scrollbar.background:    gray60
*VT100*scrollbar.foreground:    rgb:a/5/5
*VT100*scrollbar.borderWidth:   0
*VT100*scrollbar.displayList:\
foreground      gray90;\
lines           1,-1,-1,-1,-1,1;\
foreground      gray60;\
lines           -1,1,1,1,1,-1
*VT100*rightScrollBar: true
*VT100*scrollBar: true
*VT100*scrollLines: 1000
xterm*toolBar: false 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-01-21T07:12:58.740

如果您使用带有某些 arg 的 ls，它会显示文件名 好的，我建议您在 /etc/profile 中放置一个 ls 别名：

`alias ls='ls -F --color=auto --show-control-chars'`

在 WinXP 上的 msys 中为我工作。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-11-08T10:09:52.943

我会在 Windows 中设置您的国家（控制面板-> 区域设置-> 最后一个选项卡（控制）-> unicode 不兼容语言的语言-> 您的选择（挪威语））。重启后开始 Start->Cyqwin->rxvt-native。对于俄语，它可以工作（无需编辑 .bashrc 或其他）。

它甚至（我猜）将软件的输出转换为 utf-8，因为默认编码是 C.UTF-8。要检查它，请键入“echo $LANG”。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-10-04T10:12:39.657

关于 cygwin 的替代终端仿真器的主题-查看[Console2](http://sourceforge.net/projects/console/)；它具有您需要的所有功能。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-06-28T13:12:27.137

rxvt 无法使用 unicode，因此如果您登录使用 UTF-8 进行编码的机器，则无法使其正常工作。您可以将 rxvt 用于 iso-8859-1/15，但现在大多数机器都是 UTF-8。

Cygwin中rxvt的unicode替换是urxvt，Cygwin下的包名是rxvt-unicode-X。urxvt 还具有其他不错的功能，例如许多可下载的插件 - 包括一个为每个窗口提供多个选项卡的插件，以及一个客户端/服务器架构，如果您有很多窗口 ( `urxvtc`/ `urxvtd`)，它可以使用更少的资源。

您可能还需要确保您的 readline 变量指定您的 shell 应该通过 8 位字符，即将它添加到您的`$HOME/.bashrc`or `$HOME/.profile`：

```
关闭转换元
设置输出元
设置输入元

```

您必须在 中设置正确的资源`$HOME/.Xdefaults`：特别是您需要一种具有所需字符的字体。urxvt 的资源组名称是`URxvt`。*注意大小写，很重要！*

```
URxvt.font: xft:Lucida Console:size=8:style=normal:weight=50:antialias=true:hinting=true:minspace=true
URxvt.boldFont: xft:Lucida Console:size=8:style=bold:weight=100:antialias=true:hinting=true:minspace=true

```

我还建议设置：

```
URxvt*termName: xterm

```

此资源决定`$TERM`环境变量的值。除非设置正确，否则无法找到正确的 termcap 文件，导致程序喜欢`less`发出以下样式的警告：`WARNING: terminal is not fully functional`. 不幸的是，默认的 termName`rxvt-unicode`在许多 Linux 发行版中是未知的，所以如果你经常 ssh 到远程机器，你会遇到问题。解决方案是设置`termName`为更常见的内容（如`xterm`），或者将 rxvt-unicode 的 termcap 文件上传到您登录的所有服务器。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2016-04-01T12:55:59.830

由于标题具有某种误导性，并且搜索结果多次将我带到这里，所以我将回答阅读标题。

我喜欢在 Windows 上使用[Babun](http://babun.github.io/)作为 Cygwin 环境，它对我来说几乎是完美的。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2017-05-12T06:58:12.823

请尝试 ConEmu，它是一个带有选项卡的开源控制台模拟器，它将多个控制台和简单的 GUI 应用程序表示为一个可定制的 GUI 窗口。

[https://conemu.github.io/](https://conemu.github.io/)

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-03-31T01:17:55.017

**xfce4-terminal**（可从 Cygwin 获得`setup.exe`）对我来说是最好的，因为它看起来很棒（易于阅读），如果从 XLaunch（也可从 获得`setup.exe`）开始，我可以从中启动其他 cygwin GUI 应用程序。出于某种原因，我无法从`mintty`. 我发现这个线程正在寻找一个不那么丑陋的终端`xterm`（它可以很好地启动 GUI 应用程序）。最后，我通过在 setup.exe 中的终端搜索找到了最好的（`xfce4-terminal`）。**xfce4-terminal** 7 年多来一直是我在 Linux 上的最爱之一。

**Guake**也可以在 中使用`setup.exe`，但我必须从另一个终端启动它并单击另一个终端，然后才能使用击键来关闭 Guake。所以，这不像在 Linux 上那么实用。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-31T16:40:54.147

与 emg-2 类似，Lifehacker 最近有一篇关于[MinTTY](http://lifehacker.com/5185647/mintty-gives-cygwin-a-native-windows-interface)的文章，不确定它是否包含您需要的修复程序。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-03-31T16:46:06.833

如果您只满足于运行 Cygwin 应用程序，那么 rxvt 应该可以正常工作。Rxvt 应该支持 UTF-8。您是否尝试在谷歌上搜索解决方案？

如果您还需要运行本机 Windows 应用程序，那么除非您在 Windows 控制台中运行 bash，否则您将不走运。有两个问题我不相信（甚至可以）解决：

*   Ctrl-C 不能正常工作。如果您从 rxvt（或 xterm）内部运行本机 Windows 应用程序，按 Ctrl-C 会给您一个提示，但它不会中断程序，通常让它在后台运行。
*   终端输出缓冲不起作用。本机 Windows 应用程序的输出不会在打印时显示，而是在某些内部缓冲区已满时显示。

这两个问题与我尝试过的所有终端仿真器（rxvt、xterm、Emacs 和其他一些）相同。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-31T16:51:13.420

除了完全可调整大小之外，rxvt 还为您提供了哪些 Windows 控制台窗口没有的功能？您是否查看过内存使用量的差异 - rxvt 是一头猪。我使用 rxvt 几个星期，然后切换回 Windows 控制台窗口，没有遗憾。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2012-12-23T05:20:06.853

是的，mintty 看起来更舒服、轻便、快速，但是有一个特性它没有，而默认（windows）控制台有，那就是搜索功能： 从默认控制台，你可以搜索控制台上显示的字符串， 乐趣 ？

到目前为止，我还没有发现任何其他控制台具有此功能...我知道，告诉我，我真的不喜欢默认控制台。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2013-12-05T13:39:12.730

我使用过几个终端，例如 putty、console、rxvt、mintty、teraterm。最好的是teraterm。它是免费的，完全兼容 lang 和 tty，完全可配置宏、快捷方式，并为 Cygwin 提供 cygterm。

但是，如果您是轻量级用户，则只需使用 mintty 或 rxvt，这是目前的默认术语。

# memory - 使用 WMI 获取在远程计算机上运行的进程的当前内存利用率

> ID：701904
> 
> 赞同：1
> 
> 时间：2009-03-31T16:31:30.347
> 
> 标签：memory, vbscript, wmi

我想编写一个 VB 脚本，它将返回远程机器上进程的当前内存利用率。

我目前正在通过 greping pslist.exe 的输出来获取信息，但这并不理想。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T16:52:27.893

你能用[Win32_Process](http://msdn.microsoft.com/en-us/library/aa394372(VS.85).aspx)吗？工作集大小？

```
Set objWMI = GetObject("winmgmts:\\.\root\cimv2")
Set colObjects = objWMI.ExecQuery("Select * From Win32_Process")

For Each Item in colObjects
    WScript.Echo Item.Name & " - " & Item.WorkingSetSize
Next 
```

当我在本地系统上运行它时，WorkingSetSize 看起来等同于内存使用的字节数。所以你要除以 1024 得到 Kb。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T16:46:41.513

也许您可以使用 WMI 远程读取远程计算机上的性能。

[http://msdn.microsoft.com/en-us/library/aa392397(VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa392397(VS.85).aspx)

# asp.net - 谷歌将奇怪的目录名称添加到站点链接

> ID：701906
> 
> 赞同：2
> 
> 时间：2009-03-31T16:31:46.557
> 
> 标签：asp.net, url, seo

我刚刚被要求找出为什么客户网站以一种有趣的方式在谷歌中列出。一些链接有一个带有（看似）随机名称的额外目录。

网址。 [http://www.servicedofficecompany.co.uk/resources/](http://www.servicedofficecompany.co.uk/resources/)

被谷歌列为。 [http://www.servicedofficecompany.co.uk/(A(khbmZF83yQEkAAAAZGQ1OThhMmQtNzA4Zi00NmVmLWI4ZDUtMTA4ZmRmYjgzZWVmjkz4KVF6yNl_4UvHnUcR51UunJw1)S(sbkd2nyztm23yk555lbbtgzl)/resource](http://www.servicedofficecompany.co.uk/(A(khbmZF83yQEkAAAAZGQ1OThhMmQtNzA4Zi00NmVmLWI4ZDUtMTA4ZmRmYjgzZWVmjkz4KVF6yNl_4UvHnUcR51UunJw1)S(sbkd2nyztm23yk555lbbtgzl))/resources/)

并非所有页面都发生这种情况，但您可以使用以下 Google 查询查看示例。任何人有任何想法？

网站：servicedofficecompany.co.uk

干杯

史蒂夫

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T16:45:43.667

您的网站似乎检测到 googlebot 不支持 cookie，因此将其重定向到包含会话 ID 的 URL。

有关 ASP.NET 无 cookie 会话支持的信息，请参见例如[这篇文章](http://msdn.microsoft.com/en-us/library/aa479314.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T17:30:02.033

谢谢乔纳斯，我记得我以前在哪里见过这样的 URL。更多的 .NET 聪明让我发疯。

# projects - 什么是阅读/帮助的好 VCS 存储库？

> ID：701908
> 
> 赞同：1
> 
> 时间：2009-03-31T16:32:02.093
> 
> 标签：projects, repository

很长一段时间以来，我一直在编写代码，主要是专有代码。意大利面条代码之类的。不过，我离开了这个行业几年，感觉自己错过了一些巨大的东西。我花了一些时间学习书籍，但我想让我的手有点脏 - 所以我问，什么是一个好的 VCS 存储库来阅读/参与其中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T16:34:25.193

[Git](http://git-scm.com/)似乎很热。

# sql-server - 如何保证 SQL Server 2005 中的事务完整性

> ID：701919
> 
> 赞同：2
> 
> 时间：2009-03-31T16:34:14.677
> 
> 标签：sql-server, sql-server-2005, concurrency, locking, transactions

乍一看，我有一个非常简单的问题。我希望能够获得带有前缀的唯一键值。我有一个包含“前缀”和“Next_Value”列的表。

所以你会认为你只是开始一个事务，从这个表中获取下一个值，增加表中的下一个值并提交，将前缀连接到值，并且你会得到一系列唯一的字母数字键。

然而，在负载下，随着各种服务器通过 ADO.NET 访问这个存储过程，我发现它有时会向不同的客户端返回相同的密钥。当该键用作主键时，这当然会导致错误！

我天真地假设 BEGIN TRAN...COMMIT TRAN 确保了范围内数据访问的原子性。在调查这一点时，我发现了事务隔离级别并将 SERIALIZABLE 添加为最具限制性的 - 没有任何乐趣。

```
 Create proc [dbo].[sp_get_key] 
  @prefix nvarchar(3)
  as
  set tran isolation level SERIALIZABLE
  declare       @result nvarchar(32)  

  BEGIN TRY
      begin tran

      if (select count(*) from key_generation_table where prefix = @prefix) = 0 begin
         insert into key_generation_table (prefix, next_value) values (@prefix,1)
      end

      declare @next_value int

      select @next_value = next_value
      from key_generation_table
      where prefix = @prefix

      update key_generation_table
      set next_value = next_value + 1 
      where prefix = @prefix

      declare @string_next_value nvarchar(32)
      select @string_next_value = convert(nvarchar(32),@next_value)

      commit tran

      select @result = @prefix + substring('000000000000000000000000000000',1,10-len(@string_next_value)) + @string_next_value

      select @result

  END TRY
   BEGIN CATCH
        IF @@TRANCOUNT > 0 ROLLBACK TRAN

        DECLARE @ErrorMessage NVARCHAR(400);
        DECLARE @ErrorNumber INT;
        DECLARE @ErrorSeverity INT;
        DECLARE @ErrorState INT;
        DECLARE @ErrorLine INT;

        SELECT @ErrorMessage = N'{' + convert(nvarchar(32),ERROR_NUMBER()) + N'} ' + N'%d, Line %d, Text: ' + ERROR_MESSAGE();
        SELECT @ErrorNumber = ERROR_NUMBER();
        SELECT @ErrorSeverity = ERROR_SEVERITY();
        SELECT @ErrorState = ERROR_STATE();
        SELECT @ErrorLine = ERROR_LINE();
        RAISERROR (@ErrorMessage, @ErrorSeverity, @ErrorState, @ErrorNumber,@ErrorLine)

    END CATCH 
```

这是密钥生成表...

```
CREATE TABLE [dbo].[Key_Generation_Table](
        [prefix] [nvarchar](3) NOT NULL,
       [next_value] [int] NULL,
  CONSTRAINT [PK__Key_Generation_T__236943A5] PRIMARY KEY CLUSTERED 
  (
    [prefix] ASC
  )WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF,      
      ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
  ) ON [PRIMARY] 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-31T16:48:52.990

有几件事你的 if 块上有竞争条件。两个请求同时进入一个新的前缀，都可以通过 if 块。您应该将其更改为始终插入到表中，但在插入的 where 子句中进行检查以确保它不存在。另外我建议使用 Exists 而不是 count(*)=0。使用 Exists 一旦 sql 找到一行它就可以停止查找。

您的选择也会发生同样的事情，您可以让两个线程都选择相同的值，然后一个线程在等待更新时被阻塞，但是当它返回时它将返回旧的 id。

修改您的逻辑以首先更新该行，然后获取您更新的值

```
 update key_generation_table          
     set next_value = next_value + 1
     where   prefix = @prefix

       select @next_value = next_value -1         
       from key_generation_table          
       where prefix = @prefix 
```

我还会考虑使用输出语句而不是进行第二次选择。

# 编辑

我可能会更改它以使用 SQL2005 上的 yoru 以来的输出：

```
declare @keyTable as table  (next_value int)

UPDATE key_generation_Table
set next_value=next_value+1
OUTPUT DELETED.next_value into @keyTable(next_value)
WHERE prefix=@prefix

/* Update the following to use your formating */
select next_value from @keyTable 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-31T16:50:11.487

尝试使用[UPDLOCK](http://msdn.microsoft.com/en-us/library/ms187373.aspx)进行提示。

```
 select @next_value = next_value
      from key_generation_table WITH(UPDLOCK)
      where prefix = @prefix 
```

理想情况下，key_generation_table 仅与此特定存储过程一起使用。否则UPDLOCK会增加死锁的概率。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T16:41:06.487

跳出框框思考，您是否可以将一行添加到具有 AUTO_INCREMENT id 的表中，然后使用该 id？这保证在负载下是唯一的。然后，您可以删除该行（以免表无休止地增长）。

要回答您关于正在发生的事情的问题，[事务不是关键区域](http://www.mssqlcity.com/Articles/Adm/SQL70Locks.htm)。

> **可序列化**
> 
> 最严格的隔离级别。使用时，不会出现幻像值。它可以防止其他用户在事务完成之前更新或将行插入数据集中。

该机制旨在防止的问题与您遇到的问题不同。

如果您想采用上述方法，您应该获得关键区域的排他锁。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T17:07:37.453

Serializable 持有锁，但允许读取。因此，如果并行调用非常快的 proc，则在负载下的中间选择/更新可能会给出相同的结果。我认为...

如果你这样做，使用有效的语法，你可以结合 2\. tabblock 确保整个表被锁定。这与可序列化的并发不同。tabblock 是粒度。此外，您假设密钥在那里.. 如果需要，请在后面添加缺少的前缀。

```
update
    key_generation_table WITH (TABLOCK)
set
    @next_value = next_value, next_value = next_value + 1 
where
    prefix = @prefix

if @@ROWCOUNT = 0
begin
    set @next_value  = 1
    insert into key_generation_table (prefix, next_value) values (@prefix, 1)
end
select @string_next_value = convert(nvarchar(32),@next_value) 
```

# iphone - iPhone：基于视图的应用程序的起点在哪里？

> ID：701930
> 
> 赞同：1
> 
> 时间：2009-03-31T16:37:41.940
> 
> 标签：iphone

我找不到它。实际上，我正在寻找可以尝试的部分：

```
[[UIApplication sharedApplication] setStatusBarHidden:YES animated:NO];
self.navigationController.view.bounds = CGRectMake(0,0,320,480);
self.navigationController.navigationBar.hidden = YES; 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-31T16:42:53.550

起点是您的 App 委托，即 applicationDidFinishLaunching 方法。当您创建一个新应用程序时，x-code 应该为您创建一个。

```
- (void)applicationDidFinishLaunching:(UIApplication *)application {    
    // Do your thing here.
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T21:37:47.350

正如另一个答案所说， applicationDidFinishLaunching 是应用程序本身的一个很好的着陆点。但是，如果您想在视图控制器（或导航控制器，视情况而定）的范围内执行操作，您需要进入控制器的实现文件（.m 文件）并查找viewDidLoad。

```
- (void)viewDidLoad {
   [super viewDidLoad];
   // go nuts
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-25T15:56:19.630

当您的 RootViewController 连接到 NIB 文件中的主窗口时，RootViewController 的 viewDidLoad 方法实际上在 ApplicationDelegate 的 applicationDidFinishLaunching: 方法**之前被调用。**（至少这是我的经验。）

如果您想在 RootViewController 甚至开始加载其内容之前设置默认值或进行其他工作，这将是有问题的。

解决方案是覆盖 ApplicationDelegate 中的 -(void)awakeFromNib。这是我所知道的基于 NIB 的应用程序中最早的入口点（ApplicationDelegate 的 +init 方法除外）。

这是一个很好的参考：[http ://cocoawithlove.com/2008/03/cocoa-application-startup.html](http://cocoawithlove.com/2008/03/cocoa-application-startup.html)

# sql - 如何使用存储过程从行中选择数据并将其显示为列？

> ID：701931
> 
> 赞同：2
> 
> 时间：2009-03-31T16:37:43.390
> 
> 标签：sql, sql-server, sql-server-2005, csv

我有一个表，其中包含这样的数据：

```
Cars:
id | name
----------
1  | Buick
2  | Honda
3  | Toyota 
```

我想在存储过程中做的是得到这样的结果：

```
Temp Table:
Buick | Honda | Toyota
---------------------- 
```

我意识到它没有价值，但我只想先得到这部分。

我猜这将涉及某种临时表。

使用 MS SQL 2005。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-31T16:42:19.727

您在寻找[枢轴](http://msdn.microsoft.com/en-us/library/ms177410.aspx)吗？

这是一个基于为您的示例修改的 MSDN 示例的（略微做作的）示例：

```
SELECT 'Count' AS Header,
    [Toyota], [Buick], [Honda]
FROM (SELECT id, Name FROM Cars) AS SourceTable
    PIVOT( COUNT(ID) FOR Name IN ([Toyota], [Buick], [Honda])) AS PivotTable 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T16:42:54.000

你想要字符串连接，还是上面建议的 PIVOT？问题不明确，您希望行值变成列（PIVOT）还是输出？

就像 1 小时前在[MSDN 论坛](http://social.msdn.microsoft.com/Forums/en-US/transactsql/thread/bf43ff28-1110-4f98-a1b6-3522ad9532f4)上读到的一样 使用 FOR XML

```
SELECT 
STUFF(
(
SELECT ' ' + name
FROM @table
FOR XML PATH('')
), 1, 1, '') as concatenated_string 
```

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-03-31T16:48:44.377

您可以创建一个临时表，然后为 Cars 表中的选择创建一个游标，并为每一行动态创建并执行一个 SQL 查询，将一个字段添加到临时表中。

但是你为什么要尝试做这样的事情呢？您将数据与元数据混合在一起，这并不是一个好主意。用数据填充临时表的代码将比创建它的代码更糟糕。

我认为您过于专注于从存储过程中获取输出，而不是看起来像您将如何显示它。相反，试着弄清楚应该如何安排数据以便于使用。

# wcf - 在异步模式下调用服务时出错

> ID：701938
> 
> 赞同：0
> 
> 时间：2009-03-31T16:40:21.417
> 
> 标签：wcf, idictionary, asynchronous-wcf-call

Stackoverflow 绝对是最快的论坛，所以在 WCF 论坛上发布这个问题后，我决定来这里。

我有一个 wcf 服务，它返回一个字典（IDictionary）并且工作得很好。现在我想添加在异步模式下调用该服务的功能，但是当 BeginMethod 被执行时，我得到以下异常：

> 类型 System.Collections.Generic.Dictionary`2[[System.String, mscorlib, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089],[TransferProp, Contracts, Version=10.1.0.0, Culture=neutral, PublicKeyToken =6f5bf81c27b6b8aa]] 不受支持，因为它实现了 IDictionary。

那是怎么回事？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-31T18:23:05.010

[这个 (CodeIdol) 博客](http://codeidol.com/csharp/wcf/Data-Contracts/Collections/)讨论了派生您自己的[CollectionDataContract](http://msdn.microsoft.com/en-us/library/aa347850.aspx)集合并返回它。这有帮助吗？

```
[CollectionDataContract]
public class MyDictionary : Dictionary<int,Contact>
{}

[ServiceContract]
interface IContactManager
{
   ...
   [OperationContract]
   MyDictionary GetContacts( );
} 
```

# c# - CompiledQuery 与普通 Linq SQL 生成

> ID：701946
> 
> 赞同：2
> 
> 时间：2009-03-31T16:42:52.830
> 
> 标签：c#, entity-framework, linq-to-entities

所以我正在对访问我的 SQLServer 数据库的不同方法进行一些分析。我做了 vanilla TSQL、CompiledQuery 和非编译的 Linq 语句。

正如预期的那样，性能以相同的顺序进行，但在分析后两者时我注意到了一些奇怪的东西。

CompiledQuery 生成的 SQL 比普通的旧语句生成的要好得多。

本地 SQLExpress 数据库；表称为'foreignTable'，ColumnA是int，主键（索引）；ColumnB 是一个随机整数。

```
Func<testingDatabaseEntities1, int, int> GetByPK = CompiledQuery.Compile((testingDatabaseEntities1 ft, int key) 
  => (ft.foreignTable.Where(x => x.ColumnA == key).FirstOrDefault().ColumnB)); 
```

生成

```
SELECT 
[Project1].[ColumnB] AS [ColumnB]
FROM   ( SELECT cast(1 as bit) AS X ) AS [SingleRowTable1]
LEFT OUTER JOIN  (SELECT TOP (1) 
    [Extent1].[ColumnB] AS [ColumnB]
    FROM [dbo].[foreignTable] AS [Extent1]
    WHERE [Extent1].[ColumnA] = @p__linq__1 ) AS [Project1] ON 1 = 1 
```

对于生成的代码，这真的不算*太*糟糕。

但是当我做简单的 Linq 语句时：

```
entity.foreignTable.Where(x => x.ColumnA == searchForMe).FirstOrDefault().ColumnB 
```

它生成：

```
SELECT 
[Limit1].[C1] AS [C1], 
[Limit1].[ColumnA] AS [ColumnA], 
[Limit1].[ColumnB] AS [ColumnB], 
[Limit1].[FKColumn] AS [FKColumn]
FROM ( SELECT TOP (1) 
    [Extent1].[ColumnA] AS [ColumnA], 
    [Extent1].[ColumnB] AS [ColumnB], 
    [Extent2].[FKColumn] AS [FKColumn], 
    1 AS [C1]
    FROM  [dbo].[foreignTable] AS [Extent1]
    LEFT OUTER JOIN (SELECT 
      [Table_2].[FKColumn] AS [FKColumn], 
      [Table_2].[SomeText] AS [SomeText]
      FROM [dbo].[Table_2] AS [Table_2]) AS [Extent2] ON [Extent1].[ColumnA] = [Extent2].[FKColumn]
    WHERE [Extent1].[ColumnA] = @p__linq__7
)  AS [Limit1] 
```

这太糟糕了。

所以我想问题是：是否可以为实体提供与 CompiledQuery 相同数量的 SQL 吸力的常规 Linq？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-31T17:43:24.277

您正在比较的查询不一样。第一个已编译的查询返回一个属性，没有其他任何内容。它永远不会返回任何不同的东西。第二个返回您取消引用然后访问其属性的实体实例。当查询执行时，它无法知道您打算只查看一个属性。

您可能能够从非编译查询中获得相同 SQL 的一种方法（未经测试）是投影到匿名类型中：

```
var b = (from e in entity.foreignTable.
         where ColumnA == searchForMe
         select new 
         {
            ColumnB = e.ColumnB
         }).FirstOrDefault().ColumnB; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-31T17:07:53.333

编译后的查询正在做额外的工作，因为预计您将多次使用该查询。如果这就是您所追求的，那么只需坚持编译查询。

在这种特定情况下，您想要执行以下操作：

```
entity.foreignTable
    .Where(x => x.ColumnA == searchForMe)
    .Select(x=>x.ColumnB)
    .FirstOrDefault(); 
```

这并不完全相同，但它肯定会使查询更加符合您的预期（仅检索 ColumnB）。执行 FirstOrDefault 将为您提供实例，因此 .ColumnB 在 linq2sql 查询之后发生。这也会导致行为上的差异，因为您的版本会因为空引用而失败，而这个新查询将给出 ColumnB 的默认值（空值或特定值，具体取决于 ColumnB 定义）。

# asp.net-mvc - 在 MVC 控制器中添加 linq-entities 关联

> ID：701949
> 
> 赞同：1
> 
> 时间：2009-03-31T16:43:10.333
> 
> 标签：asp.net-mvc, entity-framework

在这个[MVC 教程](http://www.asp.net/learn/mvc/tutorial-38-cs.aspx)中，它展示了如何使用存储库和服务层将控制器与数据库逻辑分离。然而，这个例子是一个非常简单的纯属性模型。协会呢？

假设`Product`模型通过*所有者*`Users`关联与表有关联。控制器调用服务或存储库获取用户列表，将其传递给 View，View 将用户显示为下拉列表。

 *然后在标准 POST：product/Create 上，控制器需要获取选择的用户 ID，然后获取该 ID 的用户实体，并将其与要创建的产品相关联。

```
 if (!String.IsNullOrEmpty(Request["SelectedUserId"]))
        {
            int selectedUserId = Convert.ToInt16(Request["SelectedUserId"]);
            newProduct.Owner = _productService.GetUserById(ownerId);
        }

  _productService.AddProduct(newProduct); 
```

但是这个过程使控制器逻辑复杂化。更糟糕的是，如果我们需要验证关联（因为关联不会有 OnChanging 事件，我们无法在 Model 部分类中执行此操作）。

我的问题是，有没有更好的方法来处理关联？将请求参数也传递给服务层并在那里做所有事情会更好吗？验证呢？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-31T16:52:15.523

**更新：（**在评论它不是 linq2sql 之后）

在您的特定场景中（基于您的 desc + 您发布的代码），我肯定会将负载移至服务层。这并不意味着将请求向下移动。我会重构为：

```
string userIdStr = Request["SelectedUserId"];
var userId = !String.IsNullOrEmpty(userIdStr) ? 
     Convert.ToInt16(userIdStr) : 
     default(int?);
_productService.AddProduct(userId, newProduct); 
```

我通常也有一个像 T 这样的扩展方法`oNullable<int>()`，这使得它：

```
var userId = Request["SelectedUserId"].ToNullable<int>();
_productService.AddProduct(userId, newProduct); 
```

根据您对模型的重视程度，您可以拥有包含这两个字段的内容，例如 CustomerProduct。

* * *

如果您坚持使用 linq2sql，则不需要让用户在这种情况下执行此操作。Linq2sql 将生成一个 OwnerId 属性，您可以使用它而无需去 db 获取它。

在处理复杂模型时，将模型绑定到不同的子系统并不总是最好的方法。如果系统的某些部分适合它们自己的有界上下文，则这一点更为重要。在这种情况下，上述内容更加重要，因为您希望有非常清晰和具体的位置来集成 2 个有界上下文。

除了上述之外，有时还需要为这些类型的工艺准备一些额外的胶水。考虑添加一个服务类来帮助你。这并不意味着一切都需要通过服务类或域对象没有逻辑，它只是针对特定场景，您需要不适合域对象或的额外操作控制器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-31T17:01:37.873

[这是一本完美的书](https://rads.stackoverflow.com/amzn/click/com/1430216468)，您应该阅读有关如何正确建模（MVC 中的“M”）存储库、模型，并且包括直接的 Linq 关联。作为奖励，他解决了如何将所有自定义控制器与他们期望的存储库自动连接。是的，它是为 4 个旧版本（发布之前）的 ASP.NET MVC 版本编写的，但这些概念与您保持一致。该信息适用于所有 MVC（或任何带有 Linq 的 DDD 项目）项目。

简而言之，本书介绍了 DDD 概念，以将存储库注入到您的自定义控制器中。

```
public class ContentController : Controller
{
  IContentRepository _repository;
  public ContentController(IContentRepository repo)
  {
    _repository = repo;
  }

  public ActionResult Add(Content c)
  {
    _repository.Add(c);
    _repository.SubmitChanges();

    return View(c);
  }
} 
```

请注意这里使用的依赖注入概念，方法是将存储库强制放入构造函数中。现在，您可以在没有构造函数的情况下自行连接它。但是，当您进入一个大型项目（50 多个存储库）时，使用控制反转容器有助于为您创建这些对象，例如 Castle Windsor（同样，所有内容都在上面那本 100 页的书中）。

对于您的用例，您可以从用户存储库中简单地访问 User 对象，然后让其余部分跟进。

这本书介绍了如何使用带有 EntityRef 和 EntitySet 的 LinqToSql 来建模，比如您的用户和产品实体，因此您的所有关联都得到了尊重。这里写的代码太多了。基本上，通过 UserID 将 User() 对象链接到您的 Product() 对象，并使用 Linq 属性装饰每个实体：

```
[Table(Name="ut_Content")]
public class Content : EntityBase
{
  [Column(IsPrimaryKey = true
      , IsDbGenerated = true
      , AutoSync = AutoSync.OnInsert)]
  public int ContentID { get; set; }

  [Column(CanBeNull = false)]
  public string ContentKey { get; set; }

  [Column(CanBeNull = false)]
  public string Title { get; set; }

  [Column]
  public string Description { get; set; }

  [Column]
  public string Body { get; set; }

  [Column]
  public string BodyFormatted { get; set; }
} 
```

他处理了不同的 LinqToSql 用例，并说明了为什么“首先创建模型，不要使用模式生成的 Linq 对象”在这里有效。

而且，我想一个存储库示例可以很好地衡量：

```
public class ContentRepository : IContentRepository
{
  private Table<Content> _contents;

  public ContentRepository(string connectionString)
  {
    DataContext db = new DataContext(connectionString);
    _contents = db.GetTable<Content>();
  }

  public void Add(Content entity)
  {
    _contents.InsertOnSubmit(entity);
  }
} 
```

请记住，Linq 最好的地方之一就是它的延迟执行功能。您不是在此处对整个 Linq 表进行操作。您的查询被推迟，因此您可以使用 Where 和 Joins 过滤您的 IQueryable 并按顺序排序。只有当您请求 .ToList() 或类似方法时才会执行查询。

## 使用 DDD 服务

最后，为了解决您最初的“获得用户，然后添加产品”的问题，DDD（领域驱动设计）剧本有一个完美的解决方案：服务。

您将在您的域中创建一个 UserProductService() 类，该类与您在上面所做的完全一样。但它具有将业务逻辑抽象到您的域中的优势，因此其他位置可以访问和使用相同的业务规则。

```
public class UserProductService
{
  private IProductRepository _productRepository;
  private IUserRepository _userRepository;
  public UserProductService()
  {
    // this is where CastleWindsor can really help
    _productRepository = new ProductRepository();
    _userRepository = new UserRepository();
  }

  public void AddProduct(int userID, Product product)
  {
    User user = userRepository.GetUserByID(userID);

    // your logic above, abstracted into a service
    if (user.IsValid && product.IsValid)
    {
      product.Owner = user.UserID;        
      _productRepository.AddProduct(product);
    }  
  }
} 
```

服务的 DDD 规则是：当您有两个实体，但需要对两者执行共同操作时，请使用服务对这两个实体执行操作。

# flash - 在 Flash CS4 中使用炼金术生成的 swc

> ID：701965
> 
> 赞同：0
> 
> 时间：2009-03-31T16:47:37.500
> 
> 标签：flash, actionscript-3, alchemy

我已经阅读了[Alchemy 快速入门指南](http://labs.adobe.com/wiki/index.php/Alchemy:Documentation:Getting_Started#Macintosh)并成功导出了我的`stringecho.swc`，但我不想在 Flex 中编译。我只是不了解 Flex，而且我也不是很热衷于突然学习它。相反，考虑到它们都在 AS3 上运行，我尝试在 Flash 中开展业务。他们作为示例提供的 Flex 代码是

```
package
{
    import flash.display.Sprite;
    import cmodule.stringecho.CLibInit;

    public class EchoTest extends Sprite
    {
        public function EchoTest()
        {
            var loader:CLibInit = new CLibInit;
            var lib:Object = loader.init();
            trace(lib.echo("foo"));
        }
    }
} 
```

我在 Flash CS4 选项中添加了我的 swc，并认为我可以将 Flex 代码转换为以下 AS3 Flash 代码，写在时间轴中：

```
import cmodule.stringecho.CLibInit;

var loader:CLibInit = new CLibInit;
var lib:Object = loader.init();
trace(lib.echo("foo")); 
```

但是，唉，我在运行时收到以下错误：`ReferenceError: Error #1065: Variable MainTimeline is not defined.`

我对 Flex 没有足够的经验，但对 Flash 有很多经验，但那个错误根本没有告诉我任何信息。我还没有听说过舞台对象或 MainTimeline 的任何属性。有人可以告诉我为什么我会收到错误，或者为什么我所做的只是愚蠢的吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T16:52:56.677

没关系，我让它工作了。在 Profile->Edit->SWF Settings 下，我选中了“Export SWC”。不知道为什么它会起作用，也许有人仍然可以给我一个合乎逻辑的解释......

# sql - SQL Server：从存储模式创建表？

> ID：701972
> 
> 赞同：0
> 
> 时间：2009-03-31T16:48:50.757
> 
> 标签：sql, sql-server, schema

我想创建一个以表名作为参数的存储过程，然后根据存储在某处的模式创建该表（如果它不存在）。

这可能吗——我可以存储一个模式并使用它作为模板来创建表吗？或者我必须在存储过程本身中对 CREATE TABLE 及其方案进行硬编码吗？

这里的想法是能够在不更改存储过程（关注点分离）的情况下更改架构，因为我可能会扩展该过程来做更多事情。

据我所知，我不知道是否只是对存储过程中的表的模式进行硬编码，或者我是否可以以某种方式存储和提取该模式。

```
CREATE PROCEDURE GenerateTable 
    @tableName as nvarchar(128)
AS
BEGIN
    IF OBJECT_ID(@tableName,'U') IS NULL
        CREATE TABLE @tableName ????????
    ENDIF
END 
GO 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-31T17:06:38.703

我将从一个警告开始 - 以编程方式更改数据库架构通常是一个坏主意。

也就是说，您现在只需要创建一个字符串并执行它；例如：

```
DECLARE @CreateString VARCHAR(200)
SELECT @CreateString = 'CREATE TABLE ' + @tableName + ''
EXEC (@CreateString) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-01T01:10:54.840

是的，你可以这样做。事实上，微软在其系统存储过程中做到了这一点。您可以查找它们并查看该代码。另外，我过去做过类似的事情，但创建的是存储过程，而不是表。思路基本一样，可以参考我的代码。

```
CREATE procedure [dbo].[ScriptAbm]
@tabla varchar(50)
AS

set nocount on

if object_id(@tabla) is null begin
    select 'no existe la tabla'
    return
end

select identity(int, 1,1) as idcolumna, c.name AS Columna, t.name AS Tipo, 
    case when t.name in ('varchar', 'char') then cast(c.length as varchar)
    else null end as Longitud, ',' as coma
into #t
from syscolumns c
inner join systypes t on c.xtype = t.xtype
where c.id = object_id(@tabla)

declare @max int
select @max = max(idcolumna) from #t

update #t set coma = '' where idcolumna = @max

select  texto from (

    select 0 as orden, 1 idcolumna, 'CREATE PROCEDURE Actualizar' + @tabla texto

    union

    select 1, idcolumna, '@' + columna + ' ' + tipo
        + case when longitud is not null then ' (' + longitud + ')' else '' end 
        + coma
    from #t

    union

    select 2, 1, 'AS'

    union 

    select 3, 1, 
        CHAR(13) + CHAR(10) + 
        '-- =================================================================' + 
        CHAR(13) + CHAR(10) + 
        '-- Fecha: ' + convert(varchar, getdate(), 103) + 
        CHAR(13) + CHAR(10) + 
        '-- Autor: Leonardo Arias Paz ' +
        CHAR(13) + CHAR(10) + 
        '-- Descripción: Alta y modificación de la tabla ' + @tabla +
        CHAR(13) + CHAR(10) + 
        '-- =================================================================' +
        CHAR(13) + CHAR(10) + CHAR(13) + CHAR(10)

    union

    select 3 as orden, 1, 'SET NOCOUNT ON' + CHAR(13) + CHAR(10) + CHAR(13) + CHAR(10)

    union 

    select 3, 2, 'IF @' + (SELECT columna from #t where idcolumna = 1) + ' = 0 BEGIN'

    union

    select 4, 1, char(9) + char(9) + 'INSERT INTO ' + @tabla + ' ('

    union 

    select 5, idcolumna, char(9) + char(9) + char(9) + columna + coma
    from #t

    union 

    select 6, 1, char(9) + char(9) + ')'

    union

    select 7, 1, char(9) + char(9) + 'VALUES ('

    union

    select 8, idcolumna, char(9) + char(9) + char(9) + '@' + columna + coma
    from #t

    union

    select 9, 1, char(9) + char(9) + ')'

    union

    select 9, 2, 'END ELSE BEGIN'

    union

    select 9, 3, char(9) + char(9) + 'UPDATE ' + @tabla + ' SET '

    union

    select 10, idcolumna, char(9) + char(9) + char(9) + columna + char(9) + ' = @' + columna + coma
    from #t
    where idcolumna > 1

    union

    select 11, idcolumna, char(9) + char(9) + 'WHERE ' + columna + ' = ' + '@' + columna
    from #t
    where idcolumna = 1

    union

    select 12, 1, 'END' 

    union

    select 13, 1, CHAR(13) + CHAR(10) + 'SET NOCOUNT OFF' 

    union

    select 13, 2, CHAR(13) + CHAR(10) + 'GO'

) q
order by orden, idcolumna

set nocount off 
```

笔记：

当我拥有我需要的所有代码时，我将其打印出来，您应该使用

```
EXEC sp_executesql @code 
```

其中 @code 是一个 nvarchar 变量，用于存储您生成的代码。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-31T17:01:29.697

如果您想存储模式并按需生成表，我建议您查看[Information_Schema.Columns](http://msdn.microsoft.com/en-us/library/ms188348(SQL.90).aspx)的模式，它存储了足够的信息，您可以为给定的表（结构但不是约束）生成创建语句。就我个人而言，我认为基于它们将与之交互的表的模式编写/重写存储过程的开销较小，类似于[本文中描述的内容](https://stackoverflow.com/questions/422847/are-there-any-free-tools-to-generate-insert-into-scripts-in-ms-sql-server)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-31T18:02:27.600

是的，这种事情是可以做到的；我们公司开发了一种工具来做到这一点，这对我们来说非常有价值。不幸的是，我无法与您分享它，但它非常符合您在问题中描述的方式。

# ruby - （Ruby）如果数组交集运算符（ & ）效率低下，为什么它可用？

> ID：701980
> 
> 赞同：2
> 
> 时间：2009-03-31T16:50:13.453
> 
> 标签：ruby, arrays, intersection

昨天我问了一个关于比较重叠范围的[问题](https://stackoverflow.com/questions/699448/ruby-how-do-you-check-whether-a-range-contains-a-subset-of-another-range)，从那以后它一直卡在我的喉咙里。

共识似乎是我的首选答案涉及使用数组交集运算符 (&)，效率低下，因为比较数组的成本很高。

那么我想知道，为什么这个功能在语言中？难道语言的创造者认为有时你需要一种优雅的方式来实现解决方案，即使这样做很昂贵？比较数组的成本是否如此高，以至于您应该尽可能避免它？Ruby 对我的全部吸引力在于关注语法优雅而不是过早优化。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-31T17:06:10.153

`&`不是特别低效的方法。我认为您误解了对已接受答案的批评。

您首选的解决方案效率低下，因为它将范围转换为数组。

诸如范围之类`1..10000`的内存占用相对较小 - 它仅存储起点和终点。但是，如果将其转换为数组，则会为所有 10,000 个条目分配内存。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-31T17:00:31.680

昨天问题的措辞听起来像是在计算二进制条件：这些范围是否重叠？给出的答案可以在恒定时间内计算出来，因此如果它们对您有用，那么坚持使用它们是有意义的。

如果您需要知道重叠的**程度**，则 & 运算符将是合适的，但这不是您要问的。

至于它为什么存在，我只能推测：它不仅增加了便利性，而且不难想象语言环境可以优化数组联合操作的方式——即使它的计算可能仍然需要线性或在最坏的情况下为 n*log(n) 时间。（如果每个操作都必须有一个恒定时间的结果，我们就必须摆脱很多方法！）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-31T17:12:24.477

Ruby 中的数组是无类型的：它们可以包含多种类型，包括哈希、其他数组、符号等。在类型化数组中，排序和比较要简单得多。比较无类型集合（尤其是包含集合的集合）本质上成本更高。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-26T00:13:48.490

就测试而言，这似乎并不算太​​糟糕。机器是i7（2.0Ghz双核）

```
#!/bin/ruby
require 'benchmark'
n = []
1.upto(10_000_000) do |i|
  n << i
end

m = Array.new(1000000){ rand(10_000_000)+1 }

Benchmark.bm(10) do |x|
  x.report('array_intersection'){ n & m }
end 
```

* * *

```
 user     system      total        real
array_intersection  2.870000   0.040000   2.910000 (  2.895202) 
```

# wpf - WPF TextBlock 动态粗体和斜体部分

> ID：701983
> 
> 赞同：5
> 
> 时间：2009-03-31T16:50:22.610
> 
> 标签：wpf, mvvm, binding

我正在使用 MVVM 模式，并且我的 ModelView 中有字符串类型属性。

该字符串可能包含以下 HTML 标记：

```
<b>, </b>, <i>, </i> 
```

我需要将 TextBlock 中的某些文本部分设为正常、粗体或斜体。

目前我已经创建了解决方法，一个像这样工作的辅助方法：

1.  将 HTML 字符串分成几部分

2.  创建 Run 类的实例

3.  根据标签，设置 FontWeight 或 FontStyle 属性

4.  将 Run 类的实例添加到 TextBlock 的 Inlines 集合

此解决方案有效，但与 MVVM 模式不兼容。

我正在考虑使用转换器，但我不确定我应该绑定到 TextBlock 的哪个属性。

你怎么看，这个问题怎么解决？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-31T17:43:07.040

我过去做过的事情是使用 ContentControl，将 Content 属性绑定到带有返回动态创建的 TextBlock 的 ValueConverter 的字符串。其他解决方案可以在这里找到，包括[这个](http://code.logos.com/blog/2008/01/data_binding_in_a_flowdocument.html)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-02T15:15:06.087

我为这个问题找到的最简单的解决方案。

是使用 BindableRichTextBox，可以在[http://www.shawnduggan.com/?p=54找到](http://www.shawnduggan.com/?p=54)

1.  使用转换器将 HTML 字符串转换为 XAML，然后将其转换为 FlowDocument 对象

2.  将文档绑定到 BindableRichTextBox

3.  使 RichTextBox 看起来像 TextBlock (Focusable="False", BorderThinkness="0", BorderBrush="White"....等)

# video - 1 小时高清视频的 H.264 文件大小

> ID：701991
> 
> 赞同：15
> 
> 时间：2009-03-31T16:52:27.363
> 
> 标签：video, h.264, filesize

我正在寻找从 HDV（MiniDV 磁带上的高清）转码的 1 小时 H.264 编码高清视频的预期磁盘文件大小的数量级估计。我想归档大约 100 小时的此类内容，并想弄清楚我正在查看的是大硬盘驱动器、Drobo 之类的多驱动器单元，还是企业级存储系统。

**编辑**

为了从几个好的评论中澄清，我正在开发将使用此存档视频的软件，还将管理从 HDV 到压缩格式的转码（在 OS X 上使用 QuickTime）。此问题用于收集硬件要求。视频来自 HDV，转码不必实时进行。我不会流式传输视频，因此我正在寻找能够从 HDV 内容中保留尽可能多信息的压缩。原始 HDV 视频是隔行扫描的，但如果这有助于 H264 压缩输出的文件大小或质量，我可以对其进行去隔行扫描。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-31T17:48:14.267

如果您知道比特率，它只是比特率（每秒位数）乘以秒数。假设 HDV 为 25 Mbit/s，一小时有 3,600 秒，未转码为：

```
25 Mbit/s * 3,600 s/hr  =  3.125 MB/s * 3,600 s/hr  =  11,250 MB/hr  ≈  11 GB/hr 
```

[谷歌的计算器可以确认](https://www.google.com.au/search?q=25+Mbit%2Fs+*+1+hour)

这同样适用于 H.264 素材，尽管上述内容可能不那么准确（可变比特率等）。

> *我想归档大约 100 小时的此类内容，并想弄清楚我正在查看的是大硬盘驱动器、Drobo 之类的多驱动器单元，还是企业级存储系统。*

首先，不要购买“企业级”存储系统（考虑到成本，您几乎可以肯定不需要热插拔驱动器和相同级别的支持）。

我建议购买两个大驱动器：一个是您的主驱动器，另一个在 USB 外壳中，并且将每天连接并镜像主系统（作为备份）。

驱动器非常便宜，使用上述约 11 GB/小时的计算，这只有 1.1 TB 的数据（100 小时，未压缩）。您现在可以购买 2 TB 驱动器。

Drobo 或带有几个驱动器和软件 RAID 的机器是一种选择，但单个大驱动器加上备份会更简单。

存储现在几乎不是问题，但编码时间仍然是一个问题。编码 H.264 非常耗费资源。在四核 ~2.5 GHz Xeon 上，我想我将标准清晰度 (DVD) 编码为 H.264 的速度约为 60 fps（相比之下，MPEG 4 的速度约为 300 fps）。我想这只有大约 50 个小时，但这是值得考虑的事情。此外，假设 HDV 在磁带上，它的捕获时间是 1:1，所以这是 150 小时的直接处理，更不用说诸如更换磁带、输入元数据以及一般延迟（睡眠）和错误（“opps，错误磁带”之类的事情） ）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-31T17:00:30.340

它是您想要的任何尺寸，唯一改变的是质量。如果您打算在非 PC 设备（或速度较慢的 PC）上播放它，您可能需要遵守某个配置文件（确保固定设备可以播放内容的标准化压缩设置集）。

[您可以在Wikipedia](http://en.wikipedia.org/wiki/H.264#Levels)上查看主要的 H.264 配置文件

虽然它是高度主观的（并且高度依赖于被压缩的内容），但据称 H.264 可以使用一半的比特率达到与 DVD MPEG2 相同的质量。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-31T17:01:24.987

这将是每小时几场演出。

MPEG-4（H.264 是其中的一个子部分）将高质量定义为大约 4Mbps。这将是每小时 1.8GB。

这可能因视频类型和使用的压缩类型而异。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-12-31T02:22:11.063

我是保留原始文件的朋友，这样当旧的转码过期时，您仍然可以使用存档的原始文件并从这些新文件中进行新的编码。例如。将它们从以前转码的 mpeg2-hd 迁移到 mpeg4-hd（可能在某个时候从 mpeg4-hd 迁移到其继任者）。但所有这些都应该从原件开始。任何压缩步骤都会导致质量下降。再次重做需要一些时间，但在我看来，这是值得的。

因此，如果您想保留原件，您可以使用磁带的运行时间（以秒为单位）乘以 hdv 的最大数据速率（我认为是常数 27mbit/s）来获得所需的存储容量

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-11-02T14:16:35.883

这实际上取决于许多设置，包括音频和视频方面。如果您遵循[此视频](https://stackoverflow.com/questions/6676658/share-link-on-google/7915158#7915158)的压缩设置，则大约为每小时 3GB。如果你有一台 Mac，我肯定会推荐使用“Compressor”，因为它相当容易使用并且完美无瑕。

就存储而言，如果你看的是 100 小时 / 300GB，我肯定会选择外置硬盘。视频文件非常大，以至于它们（即使它们没有完全填满您的硬盘）确实会混淆您的计算机。确保花一些时间来压缩整个内容，因为这需要数小时、数小时和数小时……对于 100 小时的镜头，需要数天。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-03-31T16:58:50.127

对于 1060i 的高质量 x264 编码，由计算机而不是移动设备完成，不是实时的，您可以使用大约 5 MBps 的比特率。这意味着 2250 MB/小时的编码材料。建议您对素材进行去隔行并压缩为渐进式。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-31T16:58:04.183

大约 4gb/hr 很常见。

# 64-bit - 在 64 位 Windows 2003 中运行 32 位 ASP.NEt 3.5 应用程序

> ID：701997
> 
> 赞同：0
> 
> 时间：2009-03-31T16:53:08.267
> 
> 标签：64-bit, windows-server-2003, 32-bit

我已经设法让我的 32 位应用程序在 64 位 Windows Server 2003 的 IIS 上运行，但我想知道这样做是否会遇到任何其他问题。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-01T00:40:27.207

IIS6 的一个问题（但在 IIS7 中已修复）是​​您无法使用 32 位或 64 位 ASP.NET 工作进程。请参阅[http://blogs.msdn.com/rakkimk/archive/2007/11/03/iis7-running-32-bit-and-64-bit-asp-net-versions-at-the-same-time-on -不同的工人进程.aspx](http://blogs.msdn.com/rakkimk/archive/2007/11/03/iis7-running-32-bit-and-64-bit-asp-net-versions-at-the-same-time-on-different-worker-processes.aspx) ...

但是，如果您确实需要在 ASP.NET 应用程序中访问 32 位 DLL，那么 32 位工作进程将满足您的需求。这就是您首先切换到 32 位 ASP.NET 的原因吗？如[http://codebetter.com/blogs/brendan.tompkins/archive/2005/10/13/133121.aspx](http://codebetter.com/blogs/brendan.tompkins/archive/2005/10/13/133121.aspx)中所述...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T14:35:20.437

实际上，如果您使用 AppPool 隔离（托管多个客户端），建议使用 32 位模式以减少占用空间。请参阅[http://learn.iis.net/page.aspx/291/general-iis7-questions/](http://learn.iis.net/page.aspx/291/general-iis7-questions/)*`*****`