# StackOverflow 问答 000778000-000778999

# asp.net - 创建弹出窗口 也就是传递参数

> ID：778000
> 
> 赞同：1
> 
> 时间：2009-04-22T16:05:58.803
> 
> 标签：asp.net, javascript, parameters

此`HyperLink`语法无法将参数传递给一个小的 PopUp 窗口：

```
<asp:HyperLink ID="HyperLink2" runat="server" Text="Manage Related Items"
    NavigateUrl='<%# "editRelatedItems.aspx?" + "ProductSID=" + Eval("ProductSID") + "&CollectionTypeID=" + Eval("CollectionTypeID")+ "&ProductTypeID=" + Eval("ProductTypeID") %>'
    onclick="window.open('editRelatedItems.aspx?','name','height=550, width=790,toolbar=no,directories=no,status=no, menubar=no,scrollbars=yes,resizable=no'); return false;)
    target="_blank" /> 
```

看起来`<asp:HyperLink>`标签不带`"onclick"`. 关于如何获得可以获取这些参数的弹出窗口的任何想法？我正在使用 C#，所以也许有一种方法可以`NavigateURL`在后面的代码中构建字符串？

感谢您提供的任何见解。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T16:11:18.167

从服务器端代码你可以做

```
HyperLink2.Attributes.Add("OnClick", "yourstuffhere"); 
```

这将允许您指定 OnClick 项目。

如果需要，您还可以将其设置`NavigateUrl`为类似“javascript: window.open ...”的内容，同样，可以从后面的代码中完成。

*还*

鉴于超链接只是磨房锚标记的标准运行，如果您在后面的代码中进行所有这些处理，那么您自己构建整个链接可能会更容易以节省一些麻烦。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T16:15:07.127

你需要服务器端的超链接控件吗？如果没有，我建议只使用标准的 HTML 锚标记，或者如果您需要它动态显示，只需使用文字标记在后端生成它并将标记写入该标记（包括 onclick）。你需要问自己的问题是“你觉得幸运吗？” 和“我需要服务器控制吗？”

如果不熟悉，请研究一下 ItemDataBound 事件。

放入 DataList 的 ItemDataBound 事件的关键代码：

```
Dim lit as Literal = CType(e.Item.FindControl("Literal1"), Literal)

lit.Text = "<a onclick='YOURJAVASCRIPT' href='#'>YOUR TEXT</a>" 
```

***这绝不是您应该在事件中放入的全部代码，就像我说的那样，研究事件可以提供什么并从那里开始。***

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T18:03:33.153

您在代码中对 onclick 的使用缺少结束引号`"`，并且有一个额外的括号`)`。那可能是你的问题。

```
onclick="window.open('editRelatedItems.aspx?','name','height=550, width=790,toolbar=no,directories=no,status=no, menubar=no,scrollbars=yes,resizable=no'); return false;" 
```

我发现 javascript 弹出窗口不能很好地使用`ASP:HyperLink`; 尝试通过普通的锚标签创建链接：

```
<a id="HyperLink2" 
     runat="server" 
     NavigateUrl='<%# "editRelatedItems.aspx?ProductSID=" + Eval("ProductSID") + "&CollectionTypeID=" + Eval("CollectionTypeID")+ "&ProductTypeID=" + Eval("ProductTypeID") %>'  
     onclick="window.open('editRelatedItems.aspx?','name','height=550, width=790,toolbar=no,directories=no,status=no, menubar=no,scrollbars=yes,resizable=no'); return false;" 
     Target="_blank">
Manage Related Items
</a> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T18:23:55.290

```
<asp:HyperLink 
     ID="HyperLink2" 
     runat="server" 
     Text="Manage Related Items"
     NavigateUrl="#"
     onClick='<%# "window.open('editRelatedItems.aspx" + 
                  "?ProductSID=" + Eval("ProductSID") + 
                  "&CollectionTypeID=" + Eval("CollectionTypeID")+ 
                  "&ProductTypeID=" + Eval("ProductTypeID") + 
                  ",'name','height=550, width=790,toolbar=no,
                  directories=no,status=no,
                  menubar=no,scrollbars=yes,resizable=no'); 
                  return false;%>'  
     Target="_blank" /> 
```

这应该可行，但我真的会创建一个 javascript 方法来调用它会打开窗口。

```
<script type="text/javascript">
   function openRelatedItems(productSID, collectionTypeId, productTypeId) { 

       window.open('editRelatedItems.aspx" + 
                  "?ProductSID=" + productSID + 
                  "&CollectionTypeID=" + collectionTypeID + 
                  "&ProductTypeID=" + productTypeID + 
                  ",'name','height=550, width=790,toolbar=no,
                  directories=no,status=no,
                  menubar=no,scrollbars=yes,resizable=no'); 

   }
</script> 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T16:11:51.410

NavigateUrl 会覆盖“a”标签的 onclick 事件。

您要设置目标属性并删除 onclick

[http://www.w3schools.com/tags/tag_a.asp](http://www.w3schools.com/tags/tag_a.asp)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-22T17:53:12.507

使用`OnClientClick`而不是`OnClick`.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2013-11-26T06:55:29.203

```
<asp:HyperLink 
     ID="HyperLink2" 
     runat="server" 
     Text="Manage Related Items"
     NavigateUrl="#"
     onClick='<%# "window.open('editRelatedItems.aspx" + 
                  "?ProductSID=" + Eval("ProductSID") + 
                  "&CollectionTypeID=" + Eval("CollectionTypeID")+ 
                  "&ProductTypeID=" + Eval("ProductTypeID") + 
                  ",'name','height=550, width=790,toolbar=no,
                  directories=no,status=no,
                  menubar=no,scrollbars=yes,resizable=no'); 
                  return false;%>'  
     Target="_blank" /> 
```

启动 url 值后关闭“的位置。此代码显示错误，服务器标签不受欢迎

# customization - 何时使用业务规则引擎

> ID：778007
> 
> 赞同：13
> 
> 时间：2009-04-22T16:07:14.133
> 
> 标签：customization, enterprise, rule-engine, business-rules

何时使用业务规则引擎？

业务规则引擎和脚本/配置/定制有什么区别

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-07-28T00:54:44.890

当您尝试在代码中实施决策时，应使用业务规则引擎或业务规则管理系统。但不仅仅是任何决定。一项决定：

*   涉及很多规则
*   有经常变化的规则
*   具有复杂的规则或以复杂的方式交互的规则（否则认为有很多嵌套的 IF）
*   具有只有具有领域知识的人才能理解/验证的规则
*   是商务人士真正希望在没有您帮助的情况下能够改变的一种
*   涉及使用预测分析/分数作为决策的一部分

这些是使用业务规则管理系统获得回报的决策类型。不要从规则开始，从决定开始。

业务规则很冗长（因此业务人员发现它们更易于阅读）、声明性而非程序性和原子性（因此它们可以像数据库中的数据一样存储、管理和重用）。

更多关于为什么在这篇文章中使用业务规则，[我为什么相信业务规则](http://jtonedm.com/2008/08/01/believe-in-business-rules-i-do/)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-22T19:32:48.463

业务规则引擎通常用于为应用程序提供可定制的“IF some-condtion THEN do-something”类型的逻辑。这些类型的业务规则可以触发某些工作流来执行或将事件知识冒泡到更高级别的规则，从而对其进行评估。

使用规则引擎还可以通过从代码中删除业务逻辑来更轻松地分离关注点。今天的规则引擎通常还提供一个前端，用户可以在其中添加新规则，而无需修改应用程序内的脚本。

规则引擎实现了诸如 Rete（根据 Drools 的经验）之类的算法，这些算法使评估规则的任务更快。规则引擎还提供规则的前向链接、后向链接、混合链接等。然而，这些也可以用脚本语言来实现。你可以用这两种方法实现一些相同的事情，但我相信这取决于你应该选择哪种途径的规则的复杂性和数量。

看看 Jess 项目中的这个链接：http: [//www.jessrules.com/guidelines.shtml](http://www.jessrules.com/guidelines.shtml)

它提供了要问自己的问题的逐步演练，以确定规则引擎是否满足您的需求，或者是否过大。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-05-02T22:29:53.807

规则引擎可以进行正向和反向链接以及推理。查看 Fair Isaac Blaze、Drools 或 iLog 的实现。

# .net - 如何在 WinXP 计算机上静默注册 COM 程序集

> ID：778014
> 
> 赞同：1
> 
> 时间：2009-04-22T16:08:35.037
> 
> 标签：.net, com, dll

我有一个 C++ 控制台应用程序，我想要一个 Windows 窗体。我不想使用 MFC，因为我不知道如何使用。相反，我使用 C# 创建 COM dll（类库）。当我将应用程序和 dll 分发到目标计算机时，我需要注册 dll 以便应用程序可以看到 COM 接口并使用我在 dll 中创建的类。

我知道有几种方法可以做到这一点：

1.  让我的应用程序的安装程序使用 regasm - 我不想使用它，因为有两个原因： A. 我不知道它在目标 PC 上的位置（即使它存在于某个地方，我也不想硬编码它的路径）和 B. 我可以使用安装程序重新分发 regasm，但我不确定 Microsoft 是否允许这样做。

2.  让我的应用程序的安装程序使用 gacutil - 与上面相同。

3.  在开发计算机上使用 regasm 创建一个 .reg 文件，然后让应用程序的安装程序执行 .reg 文件 - 这有两个问题：A. 在卸载的情况下我无法取消注册 dll 和 B. 执行 .reg调用 regedit 询问用户他/她是否确定他/她是否想将信息添加到注册表中——我希望这是一个沉默的“是”而不是让用户决定。regedit 没有 /silent 参数，所以我放弃了使用它。

4.  使用 Inno Setup 安装程序并注册 COM 库的 .tlb 文件（regtypelib 标志）——尝试过并且注册成功，但应用程序仍然无法创建该类的实例。

5.  使用 ClickOnce 部署应用程序 - 这不是一个选项，因为我希望我的应用程序驻留在磁盘上的某个文件夹中，而不是在用户的 Documents and Settings 文件夹下。

我应该提到我正在使用 C++ 和 C# Visual Studio 9.0 的 Express 版本。还有其他方法可以在 Windows XP 计算机上注册 COM 库吗？

**编辑 - 更新**：

我从这里[http://msdn.microsoft.com/en-us/library/ms973915.aspx](http://msdn.microsoft.com/en-us/library/ms973915.aspx)的示例中尝试了免注册 COM 引导自己。撇开清单上的问题不谈，我终于让应用程序“看到”了 COM dll（免注册）。清单现在正在工作。不幸的是，对 CoCreateInstance() 的调用现在返回 E_OUTOFMEMORY (0x8007000E)。值得一提的是，COM dll 有两个类，但我只为一个类创建了一个 COM 可见接口（另一个是表单的类，我希望它是私有的）。这可能是问题吗？这是一些代码：

```
#import "MyGUI_DLL.tlb" raw_interfaces_only named_guids
[…]
static MyGUI_DLL::MyGUI * g = NULL;
r = CoInitializeEx(NULL, COINIT_MULTITHREADED);
// r is S_OK here
r = CoCreateInstance(MyGUI_DLL::CLSID_MyGUIClass, NULL, CLSCTX_INPROC_SERVER, MyGUI_DLL::IID_MyGUI, reinterpret_cast<void**>(&g));
// r returns E_OUTOFMEMORY 
```

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T16:12:26.883

您应该改用免注册 com。这将避免您提到的每一个问题，但如果专门使用，也会阻止您的程序在 pre-winxp 机器上运行......这对您的情况无关紧要。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T16:14:31.590

在处理互操作程序集的场景中，您忽略了仍然必须正确安装 COM 组件的事实。

如果你想通过代码做到这一点，那么你需要通过 P/Invoke 层调用 LoadTypeLib API 函数。

但是，我认为最好的解决方案是免注册 COM。这里有一篇很好的文章：

[http://msdn.microsoft.com/en-us/magazine/cc188708.aspx](http://msdn.microsoft.com/en-us/magazine/cc188708.aspx)

# seo - 如何在 Joomla 中自定义 Last-Modified Header？

> ID：778017
> 
> 赞同：0
> 
> 时间：2009-04-22T16:09:15.097
> 
> 标签：seo, joomla, http-headers, last-modified

即使在最新的 Joomla 1.5 Last-Modified Header 中也是不可定制的并返回当前日期，这对 seo-basics 是恕我直言。有谁知道如何（或组件）使 Joomla 1.5 根据上次修改的文章返回 Last-Modified 标头？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T17:11:21.390

`JResponse::setHeader( 'Last-Modified', $yourDateHere );`应该管用。但是，如果您想在不修改的情况下添加它，则`com_content`需要构建一个插件来检测何时`com_content`被调用，然后从数据库中检索文章以获取文章的修改日期。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2019-05-17T12:06:00.850

**@All** 随意下载和测试插件“ [Last-Modified Any Content Lite](https://www.yunoshev.com/11-last-modified-any-content-lite) ”的精简版。这个允许您发送有关页面最后修改日期的正确标题信息，以供搜索机器人增加索引您的网站。

# sifr - 确定 sifr 何时完成？

> ID：778019
> 
> 赞同：1
> 
> 时间：2009-04-22T16:09:43.160
> 
> 标签：sifr

如何确定 sifr 已完成运行？我需要知道页面加载时存在 sifr 文本的元素的高度，但是当我检查高度时，sifr 尚未完成并且我得到的值不正确（应用 sifr 之前元素的高度）。而且我绝对希望避免在查找高度时任意延迟。有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T21:59:09.903

您可以使用`onReplacement`回调，每次替换元素时都会调用该回调。它被指定为 的参数`sIFR.replace()`，更多信息请参见：[http](http://wiki.novemberborn.net/sifr3/JavaScript+Methods) ://wiki.novemberborn.net/sifr3/JavaScript+Methods 。

从那里开始，您将使用[`FlashInteractor`](http://wiki.novemberborn.net/sifr3/FlashInteractor)作为第一个参数传递的对象来获取被替换的元素。

请注意，当页面调整大小时，文本可能会换行，从而改变 Flash 影片的高度。没有回调。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-20T14:51:07.920

我花了很多时间在这上面，最后想出了一个跨浏览器的 jQuery 解决方案。我希望这可以帮助一群处于类似情况的人：

```
<script src="/path_to_jquery/jquery.js" type="text/javascript" language="javascript1.2"></script>
<script language="javascript">
    function setEqualHeight(columns) 
    {
        var tallestcolumn = 0;
        columns.each(
        function() 
         {
              currentHeight = $(this).height();
              if(currentHeight > tallestcolumn) 
              {
                    tallestcolumn = currentHeight;
              }
        }
        );
        columns.height(tallestcolumn);
    }

    $(window).load(function(){
        var dlay = setInterval(function(){
        if(jQuery('.sIFR-replaced').length>=sIFR.replacements.length){
            setEqualHeight($(".jqueryheight"));
            clearInterval(dlay);
        };
        },100);                   
    });                   
</script> 
```

# c# - 我可以在 C# 中的另一个 XmlDocument 的节点中添加一个 XmlDocument 吗？

> ID：778025
> 
> 赞同：3
> 
> 时间：2009-04-22T16:10:29.603
> 
> 标签：c#, xml

我有两个 XmlDocument。就像是：

```
<document1>
  <inner />
</document1> 
```

和

```
<document2>
  <stuff/>
</document2> 
```

我想将 document2 放在 document1 的内部节点中，以便最终得到一个包含以下内容的文档：

```
<document1>
  <inner>
    <document2>
      <stuff/>
    </document2>
  </inner>
</document1> 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-22T16:14:38.437

这是代码...

```
XmlDocument document1, document2;
// Load the documents...
XmlElement xmlInner = (XmlElement)document1.SelectSingleNode("/document1/inner");
xmlInner.AppendChild(document1.ImportNode(document2.DocumentElement, true)); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T16:14:03.337

您可以，但实际上会创建一个副本。您必须使用`XmlNode node = document1.ImportNode(document2.RootElement)`，找到节点并添加`node`为子元素。

msdn 上的示例：http: [//msdn.microsoft.com/en-us/library/system.xml.xmldocument.importnode.aspx](http://msdn.microsoft.com/en-us/library/system.xml.xmldocument.importnode.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T16:14:11.730

不可以。您只能在 XML DOM 中拥有 XmlDocument。您要做的是获取与 document2 关联的 DocumentElement，并将该 XmlElement 作为子项附加到 XmlElement。

# tomcat - Tomcat消耗高CPU

> ID：778041
> 
> 赞同：14
> 
> 时间：2009-04-22T16:12:27.540
> 
> 标签：tomcat, cpu-usage, tomcat5.5

Tomcat.exe 占用了 75% 的 CPU。有谁知道为什么会发生这种情况以及如何减少这种情况？

我正在使用 Tomcat5.5 & J2SDK v 1.4.2_12

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-22T16:20:24.367

如果您正在使用 75% 的 CPU 并且不明白为什么，我建议您向 tomcat 进程发出 kill -3 （如果您有控制台，则按 ctrl-break）以获取线程转储（当负载很高时！）。根据我的经验，大多数线程应该处于空闲状态或处于 io-wait 状态。查找在堆栈跟踪中重复出现的任何单个代码分支，这可能是您的罪魁祸首（非 io 等待！）。这是“穷人的分析器”，它通常是解决这些问题的最佳和最有效的方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-11-02T05:18:34.117

我的日志充满了 Tomcat 日志。我删除了所有这些，CPU使用率急剧下降。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-22T16:19:32.437

要了解发生了什么，您应该尝试在分析器下运行它。试试 YourKit ( [http://www.yourkit.com/](http://www.yourkit.com/) ) 或 Netbeans ( [http://profiler.netbeans.org/docs/help/5.5/profile_j2ee_profileproject.html](http://profiler.netbeans.org/docs/help/5.5/profile_j2ee_profileproject.html) )。

YourKit 与 tomcat 有更好的集成。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-22T16:27:40.280

[Lambda Probe](http://www.lambdaprobe.org/d/index.htm)是一个非常方便的监控 Tomcat 的工具。

您使用的是四核 CPU 系统吗？可能 Tomcat 在其中 3 个中运行 100%。我会首先在应用程序中测试无限循环或类似的东西。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-06-28T12:19:53.843

首先（这适用于所有 Java 应用程序）您必须确定哪个线程正在使用 CPU。这在 JDK 1.6 中是可能的。它是通过使用 java.lang.management.ManagementFactory.getThreadMXBean() 来完成的。这是示例用法（JSP）：

```
<%@ page import="java.lang.management.*, java.util.*" %>
<%!
    Map cpuTimes = new HashMap();
    Map cpuTimeFetch = new HashMap();
%><%
long cpus = Runtime.getRuntime().availableProcessors();
ThreadMXBean threads = ManagementFactory.getThreadMXBean();
long now = System.currentTimeMillis();
ThreadInfo[] t = threads.dumpAllThreads(false, false);
for (int i = 0; i < t.length; i++) {
    long id = t[i].getThreadId();
    Long idid = new Long(id);
    long current = 0;
    if (cpuTimes.get(idid) != null) {
        long prev = ((Long) cpuTimes.get(idid)).longValue();
        current = threads.getThreadCpuTime(t[i].getThreadId());
        long catchTime = ((Long) cpuTimeFetch.get(idid)).longValue();
        double percent = (current - prev) / ((now - catchTime) * cpus * 10000);
        if (percent > 0 && prev > 0) {
            out.println("<li>" + t[i].getThreadName() + " " + percent + " (" + prev + ", " + current + ")");    
        }
    }
    cpuTimes.put(idid, new Long(current));  
    cpuTimeFetch.put(idid, new Long(now));
}
%> 
```

之后，您可以获取线程转储并分析该线程中的代码以修复过多的 CPU 使用率。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2018-12-04T09:50:44.703

我们刚刚解决了一个问题，我们的 tomcat 实例在 CPU 使用率非常高的情况下运行，每隔几秒就会达到 100% 甚至更多，然后又短暂地再次下降。无论服务器是否在执行任何工作，这种情况都会整天整夜发生。我们正在使用 java 8 运行 tomcat 8。

我们没有在网络搜索中找到我们的解决方案，所以我将其发布在这里，希望能帮助其他人。

我们在 tomcat/conf/Catalina/localhost 目录中使用了配置选项，在该目录中，我们将 tomcat 指向了另一个目录，而不是它自己的 webapps 目录。此目录中的 xml 文件如下所示：

```
<?xml version='1.0'?>
<Context
docBase="/opt/dspace/amaddev/dspace-6.3/webapps/jspui"
reloadable="true"
cachingAllowed="false"/> 
```

这很有效，tomcat 使用这些目录中的代码而不是它自己的 webapps 目录运行。但是，我们遇到了不断增加 CPU 使用率的问题。

为了测试，我们从 conf/Catalina/localhost 目录中删除了 xml 文件，然后重新启动了 tomcat。突然间，我们又拥有了一只正常的、乖巧的 tomcat。为了将 tomcat 指向另一个目录（我们编译 dspace 代码的地方），我们只使用了 conf/server.xml 中的 Host 条目，并将 appBase 设置更改为我们的 dspace 目录：

```
<Host name="localhost"  appBase="/opt/dspace/amaddev/dspace-6.3/webapps"
        unpackWARs="true" autoDeploy="true"> 
```

现在，当服务器安静时，它以非常低的 cpu 使用率（低于 1%）实现了我们想要的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-22T16:25:49.473

所有答案都涵盖了如何进行精确诊断，此外，我还要补充一点，根据我的经验，您的一个应用程序中的无限循环可能是罪魁祸首。

正如 J-16 SDiZ 所说，最好的办法是运行分析器以将问题缩小到一个应用程序。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-02-01T14:48:50.043

就我而言，我刚刚使用默认设置安装了 Tomcat8。我不得不设置内存参数`-Xms -Xmx`。有一次，我增加了对 JVM 的内存分配，CPU 利用率急剧下降。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-22T16:16:31.443

这很可能是由您在 tomcat 上运行的应用程序引起的。当然，如果您的应用程序的流量非常高，这也可能是原因。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2020-03-07T21:32:57.507

我建议查看 Tomcat 日志文件，尤其是名为 catalina.out 的文件。在我的情况下，该文件正在快速扩展，并显示错误消息“没有读取文件夹 /var/lib/mysql 的权限”。我的应用程序包含一个监视文件夹 /var/lib/mysql 的监视服务。通过允许应用程序读取此文件夹，CPU 使用率急剧下降。在可以更改访问文件夹和文件的权限的系统更新后出现高 CPU 使用率。因此，CPU 使用率高的原因可能是 Web 应用程序外部的，也可能是 Tomcat 容器外部的。

# c# - 带有 SubSonic 的可过滤数据网格

> ID：778042
> 
> 赞同：4
> 
> 时间：2009-04-22T16:12:29.863
> 
> 标签：c#, subsonic

我的目标是创建一个使用 SubSonic 对象作为其数据源的 DataGrid。网格应具有数据库端分页和排序，以及可根据该列的数据类型智能过滤的列。

我实际上有一个相当先进的网格原型，它基本上可以满足它的需要。问题是，为了获得结果，我必须在我的解决方案中包含 SubSonic 源，更改数据对象的生成模板，并为可以服务于分页、排序和过滤的超级类型添加全新的模板类型化的集合。添加这些模板需要我还更改 SubCommander 代码。

我害怕升级 SubSonic——我所做的改变是可行的，但它们几乎是紧密耦合和脆弱的。

是否有更明智的方法来更改和添加生成模板？

或者，是否有针对我刚刚看过的 DataGrid 问题的开箱即用解决方案？

编辑：

尽管我很想使用较新的版本，但我正在处理遗留代码，但我不能。我需要 SubSonic 2.x 的解决方案

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T16:41:55.767

这更像是 Subsonic 3 解决方案，但是您是否看过 Rob 使用 Subsonic3、T4 和 jquery 网格的截屏来完成您上面所要求的大部分内容（分页、排序、过滤）

[http://blog.wekeroad.com/subsonic/putting-the-ldquo-m-rdquo-back-in-mvc/](http://blog.wekeroad.com/subsonic/putting-the-ldquo-m-rdquo-back-in-mvc/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T19:51:42.877

在我看来，您需要做的是使用 Subsonic.Select 。如果您在框架中创建一个接受所有过滤器和页码以及每页记录的方法，您可以添加所需的过滤器并设置页面和记录数。看看这个例子。 [http://subsonicproject.com/querying/select-queries/](http://subsonicproject.com/querying/select-queries/)

# function - 我们知道 log_add，但是如何做 log_subtract？

> ID：778047
> 
> 赞同：17
> 
> 时间：2009-04-22T16:13:29.830
> 
> 标签：function, math, numbers

*在日志空间中将两个数字*相乘意味着将它们相加：**

 *```
log_multiply(x, y) = log( exp(x) * exp(y) )
                   = x + y 
```

*在日志空间中添加*两个数字意味着您执行特殊的日志添加操作：

```
log_add(x, y) = log( exp(x) + exp(y) ) 
```

它在以下代码中实现，不需要我们采用两个指数（并失去运行时速度和精度）：

```
 double log_add(double x, double y) {
    if(x == neginf)
      return y;
    if(y == neginf)
      return x;
    return max(x, y) + log1p(exp( -fabs(x - y) ));
  } 
```

（[这](http://www.csee.usf.edu/~murphy/Temp/download/Toolboxes/Trulla%20Toolbox/Level%204/Example/trulla.smooth/include/evolution/core/math/MathUtils.hpp)是另一个。）

但这里有一个问题：

**减法也有技巧吗？**

```
log_subtract(x, y) = log( exp(x) - exp(y) ) 
```

不必取指数并失去精度？

```
 double log_subtract(double x, double y) {
    // ?
  } 
```

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-22T17:10:56.510

怎么样

```
double log_subtract(double x, double y) {
  if(x <= y)
    // error!! computing the log of a negative number
  if(y == neginf)
    return x;
  return x + log1p(-exp(y-x));
} 
```

这只是基于我做的一些快速数学......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-05-18T12:44:38.273

exp 和 log 的库函数会因极值而失去精度。log1p 让你成功了一半，但你需要一个函数来处理 log 和 exp 部分的错误。

见这篇文章：[http ://cran.r-project.org/web/packages/Rmpfr/vignettes/log1mexp-note.pdf](http://cran.r-project.org/web/packages/Rmpfr/vignettes/log1mexp-note.pdf)

标题是“准确计算日志（1 - exp（-|a|））”。

这篇文章讨论了如何无缝地合并不同的算法来为更大范围的输入创建良好的误差范围。

# windows-server-2003 - Windows Media Server 从数据库流式传输

> ID：778053
> 
> 赞同：1
> 
> 时间：2009-04-22T16:14:30.887
> 
> 标签：windows-server-2003, mms, windows-media-server, wms

是否有可能以某种方式设置 WMS 以仅使用 Windows Server 2003 标准版从数据库中流式传输内容？

我知道它可以使用自定义插件数据源来完成，但这仅在 Windows Server 2003 企业版中启用。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T08:57:30.517

很抱歉成为坏消息的承担者，但您最好的选择可能是：

1.  在数据库之外维护您的数据副本（我不知道您的设置的详细信息，因此这可能会破坏您尝试做的事情的目的）。基本上，保留要流式传输的内容的文件缓存并编写应用程序以使文件缓存与数据库保持同步。
2.  切换到 Windows Server 2008。2008 的 Web Server 和 Standard 版本支持自定义插件，并且应该比 Enterprise 版本更实惠（我相信 Web Server 版本低于 500 美元）。

也许其他人有一些聪明的解决方案，但这些是我知道的唯一选择。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-05-04T14:08:12.530

没有什么是[开箱即用的，](http://msdn.microsoft.com/library/ms753872.aspx)但 WMS 确实支持其他自定义插件。从性能的角度来看，您可能需要考虑为什么需要这样做。在我看来，最简单的方法是围绕数据库编写一个 HTTP 包装器，并使用内置的 HTTP 流数据源。编写 HTTP 包装器所需的知识和技能比编写 WMS 插件要丰富。如果您确实有这方面的用例，请考虑[SQL Server 2008 的文件流功能](http://technet.microsoft.com/library/bb933993.aspx)，因为它旨在为您[提供文件系统性能的关系能力](http://msdn.microsoft.com/library/cc949109.aspx)。

# sharepoint - 我可以在 Sharepoint 中以编程方式将一个 Web 部件替换为另一个 Web 部件吗？

> ID：778056
> 
> 赞同：0
> 
> 时间：2009-04-22T16:14:41.527
> 
> 标签：sharepoint, web-parts

**编辑：这是十年前的，所以很可能与任何人都无关，如果谷歌把你带到这里，我会对更现代的框架的内容持怀疑态度！**

我们有一个共享点网站，该网站使用开箱即用的内容编辑器 webpart 进行了大量的内容开发。当涉及到使用 IE 以外的任何其他浏览器时，这有点垃圾。

我们打算更新到免费的 Telerik 内容编辑器，但是我们希望为自己节省大量的复制和粘贴，以及单击并选择交换 Web 部件。

似乎没有官方的升级路径，但在我看来，必须可以使用代码 (tm) 的力量来获取原始 webpart 的内容，新建一个 telerik webpart 并将内容放入新的 webpart。 .. 然后删除旧的原始 Web 部件。

有没有人做过这种事情？如何最好地布置代码并实际运行将进行交换的代码（如果可能的话）。一个带有“交换”按钮的新 Web 部件？或更复杂的东西？

我还需要浏览每个页面和子站点（以及子站点中的页面）并查看每个 Web 部件。有没有这样做的最佳实践方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T19:11:39.277

我会为此编写一个控制台应用程序。

打开根网站并遍历其子网站。通过打开 WebPartManager 执行每个页面所需的工作。

这里有一些伪代码可以帮助您入门。

```
string SourceUrl = "http://ThisWeb";

using (SPSite sourceSite = new SPSite(SourceURL))
{
    using (SPWeb sourceWeb = sourceSite.OpenWeb(SourceURL))
    {
        IterateSubWebsProd(sourceWeb):
    }
}

private void IterateSubWebsProd(SPWeb sourceWeb)
{
    // This is the migration function
    DoThingyWithThisWeb(sourceWeb);

    foreach (SPWeb subWeb in sourceWeb.Webs)
    {
      IterateSubWebsProd(subWeb);
      subWeb.Dispose();
    }
}

private void DoThingyWithThisWeb(SPWeb sourceWeb)
{
    PublishingPage currentPage = null;

    string currentPageName = "<something>";
    // Find the pages that you want to modify, with a CAML query for example
    SPQuery query = new SPQuery();
    query.Query = string.Format("" +
    "<Where>" +
      "<Eq>" +
         "<FieldRef Name='FileLeafRef' />" +
         "<Value Type='File'>{0}</Value>" +
      "</Eq>" +
    "</Where>" +
    "", currentPageName);

     // This codesnippet is from a Publishing web example
     PublishingWeb publishingWeb = PublishingWeb.GetPublishingWeb(sourceWeb);
    PublishingPageCollection pageColl = publishingWeb.GetPublishingPages(query);
    if (pageColl.Count > 0)
    {
        currentPage = pageColl[0];
    }

    using (SPLimitedWebPartManager wpMan = currentPage.ListItem.File.GetLimitedWebPartManager(System.Web.UI.WebControls.WebParts.PersonalizationScope.Shared))
    {
        foreach (WebPart wp in wpMan.WebParts)
        {
            if (wp.GetType().Equals(typeof(Microsoft.SharePoint.WebPartPages.ContentEditorWebPart)))
            {
                Microsoft.SharePoint.WebPartPages.ContentEditorWebPart thisWebPart = wp as Microsoft.SharePoint.WebPartPages.ContentEditorWebPart;

                // This is just dummy code, here you will do your content migration 
                XmlDocument xmlDoc = new XmlDocument();
                XmlElement xmlElement = xmlDoc.CreateElement("RootElement");
                xmlElement.InnerText = sourceItem[SourceField].ToString();
                thisWebPart.Content = xmlElement;

                wpMan.SaveChanges(thisWebPart);
            }
        }
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T16:57:32.127

我对此不是 100% 确定的，但是如果您的内容作为单个字段保存到列表中，您能否将 Telerik 控件指向该内容的保存位置？这可能会导致 Telerik 控件在该内容的第一次编辑时有点惊慌失措，但他们应该可以重新格式化内容并恢复。

# vim - 如何使用 vim 更改文件的编码？

> ID：778069
> 
> 赞同：255
> 
> 时间：2009-04-22T16:16:35.203
> 
> 标签：vim, unicode

我习惯使用 vim 来修改文件的行尾：

```
$ file file
file: ASCII text, with CRLF line terminators
$ vim file
:set ff=mac
:wq
$ file file
file: ASCII text, with CR line terminators 
```

是否可以使用类似的过程来更改文件的 unicode 编码？我正在尝试以下方法，但不起作用：

```
$ file file.xml
file.xml: Unicode text, UTF-16, little-endian
$ vim file
:set encoding=utf-8
:wq
$ file file.xml
file.xml: Unicode text, UTF-16, little-endian 
```

我看到[有人说](http://www.linuxquestions.org/questions/solaris-opensolaris-20/converting-utf-16-files-to-another-encoding-such-as-utf-8-630588/)他可以“设置fileencoding=utf-8，然后更新并写入文件，它可以工作”，但我似乎遗漏了什么，否则他很困惑。我不知道他所说的“然后更新”是什么意思。

* * *

## 回答 #1

> 赞同：276
> 
> 时间：2009-04-22T16:25:33.000

从[文档](http://vimdoc.sourceforge.net/htmldoc/usr_45.html#45.4)：

> :write ++enc=utf-8 russian.txt

因此，您应该能够将编码更改为写入命令的一部分。

* * *

## 回答 #2

> 赞同：183
> 
> 时间：2009-09-22T11:51:17.653

请注意，两者之间存在差异

```
设置编码
```

和

```
设置文件编码
```

在第一种情况下，您将更改终端中显示的输出编码。在第二种情况下，您将更改所写入文件的输出编码。

* * *

## 回答 #3

> 赞同：84
> 
> 时间：2009-09-22T12:16:09.873

虽然使用 vim 是完全可能的，但为什么不简单地使用 iconv 呢？我的意思是 - 加载文本编辑器只是为了进行编码转换似乎使用太大的锤子太小钉子。

只是：

```
iconv -f utf-16 -t utf-8 file.xml > file.utf8.xml 
```

你完成了。

* * *

## 回答 #4

> 赞同：57
> 
> 时间：2009-05-01T07:18:53.257

就像您的步骤一样，设置文件编码应该可以工作。但是，我想添加一个“设置炸弹”来帮助编辑器将文件视为 UTF8。

```
$ vim file
:set bomb
:set fileencoding=utf-8
:wq 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2016-11-22T16:14:01.100

在读取文件之前仅在命令行上更改[编码](http://vimdoc.sourceforge.net/htmldoc/options.html#'encoding')可能很有用：

```
rem On MicroSoft Windows
vim --cmd "set encoding=utf-8" file.ext
# In *nix shell
vim --cmd 'set encoding=utf-8' file.ext 
```

见[开始](http://vimdoc.sourceforge.net/htmldoc/starting.html)，[`--cmd`](http://vimdoc.sourceforge.net/htmldoc/starting.html#--cmd)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-12-04T18:32:16.043

auto GUIEnter * set encoding=utf-8 应该有帮助

# .net - 从 Web.Config 检索时，如何将变量定义为 CONSTANT？

> ID：778074
> 
> 赞同：0
> 
> 时间：2009-04-22T16:17:42.270
> 
> 标签：.net, web-config, coding-style, constants

我在 AppSettings 中保留了很多设置，我想知道以大写字母命名它们是否被认为是一种好习惯。本质上，它们与常量相同，对吧？据我了解，如果您更改 Web.Config，应用程序会重新编译。

所以，我在想，您是否应该将 AppSettings 中的设置保留为大写（假设您将常量命名为全部大写。）

另外，从 AppSettings 获取值的变量是否应该大写？

例如。

```
String MY_SETTING = ConfigurationManager.AppSettings["MY_SETTING"]; 
```

处理这些并使它们看起来和感觉像常量的最佳方法是什么？这甚至是个好主意吗？我能想到的唯一方法是将其设为只读：

```
readonly String MY_SETTING = ConfigurationManager.AppSettings["MY_SETTING"]; 
```

但是我不知道你怎么能用一个int来做到这一点：

```
readonly String MAX_USERS_S = ConfigurationManager.AppSettings["MAX_USERS"];
readonly int MAX_USERS; // needs to be set here... won't compile
int.TryParse(MAX_USERS_S, out MAX_USERS); 
```

不知何故，我觉得将只读变量设置为看起来像常量很脏，但对我来说，web.config 中的东西基本上是常量。

建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T16:20:31.873

如果您觉得它们实际上是恒定的，并且它们是不可变类型（等）的只读变量，`int`那么一定`string`要使用相同的命名约定。确实，这就是这样[`String.Empty`](http://msdn.microsoft.com/en-us/library/system.string.empty.aspx)做的。但是，常量的[.NET 命名约定](http://msdn.microsoft.com/en-us/library/xzf533w0.aspx)不是. `SHOUTY_CAPS`，而是`PascalCase`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T16:19:40.423

[没有。.NET命名准则](http://msdn.microsoft.com/en-us/library/ms229002.aspx)中没有全大写命名的情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T16:24:41.003

如果你想让它们看起来和感觉像常量，我建议的第一个地方是用 Pascal-case 命名它们，所以 MY_SETTING（这不是一个真正类似于 C# 的名称）将是“MySetting”。您会在框架中看到很多公开公开的属性和常量。

readonly 是去这里的正确方法。对于实例字段，只能在声明或构造函数中设置。对于静态字段，只能在静态构造函数或声明中设置。

对于 TryParse 的调用，您可以在构造函数或静态构造函数中设置它，具体取决于它是实例还是静态字段：

```
static MyClass()
{
    // The value.
    int myUsers;

    // Try to parse.
    if (int.TryParse(MAX_USERS_S, out myUsers))
    {
        // Assign.
        MyUsers = myUsers;
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T16:36:41.473

> 据我了解，如果您更改 Web.Config，应用程序会重新编译。

没错，对 Web.Config 的任何更改都会重新编译应用程序。甚至小到换行符的变化。

* * *

忽略命名约定问题，您可以对示例执行以下操作：

```
readonly int MAX_USERS = 
    int.Parse(ConfigurationManager.AppSettings["MAX_USERS"]) 
```

显然，在不是 int 的情况下，这不是一种安全的方法，但似乎在无法设置`MAX_USERS`时抛出异常是正确的做法。`MAX_USERS`

# c# - 在 Windows Vista/XP 中重定向声音

> ID：778075
> 
> 赞同：1
> 
> 时间：2009-04-22T16:19:16.603
> 
> 标签：c#, audio, windows-vista, windows-xp

有没有办法将输出声音重定向回通过 C# 录制输入而不使用任何电缆来做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T16:25:45.277

我不知道是否有一种方法可以仅针对您的应用程序以编程方式执行此操作（可能有一些方法可以连接到媒体管道来执行此操作，但如何做到这一点超出了我的理解）。

但是，如果您不需要编程访问，则有单独的工具可以记录任何 Windows 音频输出。我听说过关于[Total Recorder](http://www.highcriteria.com/)的好消息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T16:29:45.453

大多数混音器驱动程序（声卡/外设具有内置软件控制的混音器）能够将扬声器输出路由到录音通道。我不知道 C# 中的声音库是否本机支持此功能，但您可以查看 DirectSound。

此功能对于在某些音频软件中变得普遍的回声和其他声音环回功能非常有用，因此硬件应该能够管理它，但如果您在 DirectSound 中找不到它，您可能需要深入研究晦涩难懂的 DLL 或类似的音频库。

-亚当

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T18:21:06.667

在 XP 中，我很幸运能够进入音量控制面板、属性、选择录制以调出录制输入，然后选择波形输出作为录制媒体。我相信这将取决于您的声卡。

这也可以在某些应用程序中专门设置，例如 Ventrilo。我认为它通常会让您选择声音输出作为麦克风，尽管可能适用相同的条件。这可能意味着在编程中有一些方法可以做到这一点，但很可能是通过 C++ P/Invoke 互操作而不是直接支持。

为了将来参考，您可能希望知道，在 Windows 7 中，这样做的能力已被完全删除，以防止我相信流式音频的录制/盗版。

# c# - 一对多上的 nHibernate Null 列表值

> ID：778076
> 
> 赞同：0
> 
> 时间：2009-04-22T16:19:18.613
> 
> 标签：c#, nhibernate, one-to-many

我有一个包含许多 OrderItems 的订单映射。当我只保存订单时，映射正确地将订单和订单项目保存到数据库中，但是当我重新加载该订单时，订单包含的订单项目列表填充了空值（对于所有其他订单项目表），直到它到达具有 Order 外键的 OrderItem。因此，空订单商品的总计数是 OrderItems 表的行数（不包括与订单相关的实际订单商品）。这是我的映射：

命令：

```
<list name="OrderItems" table="OrderItems" cascade="all" inverse="true" >
  <key column="OrderID"/>
  <index column="OrderItemID" />
  <one-to-many class="OrderItem" not-found="ignore" />
</list> 
```

订单项：

```
<many-to-one name="Order" class="Order" column="OrderID" not-null="true" /> 
```

这是 Order 的类实现：

```
public class Order : {
    private IList<OrderItem> orderItems = new List<OrderItem>(); 
```

我读到 nHibernate 不支持列表作为关系的许多部分，但保存工作正常，只是不支持加载。我是否必须将所有内容都转换为 Sets 才能使其正常工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T16:33:12.763

就在我头顶，我记得有问题

```
<list> 
```

并采取了

```
<bag> 
```

而是映射到 .NET IList 接口。不确定这是否能解决您的问题。

可能有帮助的是通过启用对 console.out 的日志记录来查看访问数据库的实际 SQL 与您的期望有何不同（[请参阅此博客](http://www.davesquared.net/2008/01/viewing-sql-generated-by-nhibernate.html)）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T16:45:36.633

这不是因为您的 OrderItems 集合是延迟加载的吗？如果您在列表（或袋子）映射上指定了lazy=false，那么这种情况就不应该再出现了。

问题是，你想延迟加载 OrderItems，还是不想？:)

# sql - 将动态生成的数据透视表放入临时表

> ID：778079
> 
> 赞同：4
> 
> 时间：2009-04-22T16:20:03.387
> 
> 标签：sql, sql-server, database, pivot

我见过[这个](https://stackoverflow.com/questions/159456/pivot-table-and-concatenate-columns-sql-problem#159803)，所以我知道如何使用一组动态生成的字段创建数据透视表。我现在的问题是我想将结果放入一个临时表中。

我知道为了从**EXEC**语句中将结果集放入临时表中，您需要预定义临时表。在动态生成的数据透视表的情况下，没有办法事先知道这些字段。

我能想到的获得这种功能的唯一方法是使用动态 SQL 创建一个永久表。有没有更好的办法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2016-02-10T04:39:45.163

今天跑到这个问题上，并在我的[博客](https://knarfalingus.net/2016/02/09/database/mssql/dynamic-sql-pivot-into-temp-table/)上发布。解决方案的简短描述是创建一个包含一列的临时表，然后使用 sp_executesql 动态更改它。然后您可以将动态 PIVOT 的结果插入其中。下面的工作示例。

```
CREATE TABLE #Manufacturers
(
    ManufacturerID INT PRIMARY KEY,
    Name VARCHAR(128)
)

INSERT INTO #Manufacturers (ManufacturerID, Name)
VALUES (1,'Dell')
INSERT INTO #Manufacturers (ManufacturerID, Name)
VALUES (2,'Lenovo')
INSERT INTO #Manufacturers (ManufacturerID, Name)
VALUES (3,'HP')

CREATE TABLE #Years
(YearID INT, Description VARCHAR(128))
GO

INSERT INTO #Years (YearID, Description) VALUES (1, '2014')
INSERT INTO #Years (YearID, Description) VALUES (2, '2015')
GO

CREATE TABLE #Sales
(ManufacturerID INT, YearID INT,Revenue MONEY)
GO

INSERT INTO #Sales (ManufacturerID, YearID, Revenue) VALUES(1,2,59000000000)
INSERT INTO #Sales (ManufacturerID, YearID, Revenue) VALUES(2,2,46000000000)
INSERT INTO #Sales (ManufacturerID, YearID, Revenue) VALUES(3,2,111500000000)
INSERT INTO #Sales (ManufacturerID, YearID, Revenue) VALUES(1,1,55000000000)
INSERT INTO #Sales (ManufacturerID, YearID, Revenue) VALUES(2,1,42000000000)
INSERT INTO #Sales (ManufacturerID, YearID, Revenue) VALUES(3,1,101500000000)
GO

DECLARE @SQL AS NVARCHAR(MAX)
DECLARE @PivotColumnName AS NVARCHAR(MAX)
DECLARE @TempTableColumnName AS NVARCHAR(MAX)
DECLARE @AlterTempTable AS NVARCHAR(MAX)

--get delimited column names for various SQL statements below
SELECT 
    -- column names for pivot
    @PivotColumnName= ISNULL(@PivotColumnName + N',',N'') + QUOTENAME(CONVERT(NVARCHAR(10),YearID)),
    -- column names for insert into temp table
    @TempTableColumnName = ISNULL(@TempTableColumnName + N',',N'') + QUOTENAME('Y' + CONVERT(NVARCHAR(10),YearID)),
    -- column names for alteration of temp table
    @AlterTempTable = ISNULL(@AlterTempTable + N',',N'') + QUOTENAME('Y' + CONVERT(NVARCHAR(10),YearID)) + ' MONEY' 
FROM (SELECT DISTINCT [YearID] FROM #Sales) AS Sales

CREATE TABLE #Pivot
(
     ManufacturerID INT
)

-- Thats it! Because the following step will flesh it out.

SET @SQL = 'ALTER TABLE #Pivot ADD ' + @AlterTempTable
EXEC sp_executesql @SQL

--execute the dynamic PIVOT query into the temp table 
SET @SQL =  N'
    INSERT INTO #Pivot (ManufacturerID, ' + @TempTableColumnName + ')
    SELECT ManufacturerID, ' + @PivotColumnName + '
    FROM #Sales S
    PIVOT(SUM(Revenue) 
      FOR S.YearID IN (' + @PivotColumnName + ')) AS PivotTable'
EXEC sp_executesql @SQL

SELECT M.Name, P.*
FROM #Manufacturers M
INNER JOIN #Pivot P ON M.ManufacturerID = P.ManufacturerID 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T16:24:18.947

你可以这样做：

```
-- add 'loopback' linkedserver 
if exists (select * from master..sysservers where srvname = 'loopback')
    exec sp_dropserver 'loopback'
go
exec sp_addlinkedserver @server = N'loopback',
    @srvproduct = N'',
    @provider = N'SQLOLEDB', 
    @datasrc = @@servername
go

declare @myDynamicSQL varchar(max)
select @myDynamicSQL = 'exec sp_who'
exec('
    select * into #t from openquery(loopback, ''' + @myDynamicSQL + ''');
    select * from #t
    ') 
```

编辑：添加动态 sql 以接受参数到 openquery

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T17:41:08.200

让我试试这个 select into 的解释。我也在运行 SQL Server 2005。因为您有 PIVOT 表，所以我将假设相同或 2008 年。

```
select 
    o.*,
    OtherField1,
    OtherField2
INTO #temp
FROM
    OriginalOtherData as ood
PIVOT (
    MAX([Value])
    FOR Field in (OtherField1, OtherField2)
) as piv
RIGHT OUTER join
    Original o on o.OriginalSD = piv.OriginalSD

select * from #temp
Drop table #temp 
```

普通选择和选择进入之间的*唯一*区别是 INTO #table 部分。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-04-17T15:54:12.887

*   用于查询（从表名中选择 col1、col2、col3
*   col1 成为 rowlabels
*   col2 成为列标题
*   col3 是数据集

*   也摆脱了全局表

    ```
    if OBJECT_ID('tempdb..#3') is not null drop table #3
    if OBJECT_ID('tempdb..##3') is not null drop table ##3
    DECLARE @cols AS NVARCHAR(MAX),
        @query  AS NVARCHAR(MAX)
    select @cols = STUFF((SELECT distinct ',' + QUOTENAME(   col2    ) from    tablename    FOR XML PATH(''), col2).value('.', 'NVARCHAR(MAX)'),1,1,'')
    set @query = 'SELECT col1, ' + @cols + ' into ##3 from ( select col1, col2, col3 from tablename ) x  pivot (  max(col3)for col2 in (' + @cols + ')) p '
    execute(@query)   
    select * into #3 from ##3 if OBJECT_ID('tempdb..##3') -- is not null drop table ##3 
    ```

# sql - Linux上文本文件的SQL查询引擎？

> ID：778081
> 
> 赞同：7
> 
> 时间：2009-04-22T16:20:29.720
> 
> 标签：sql, command-line, text

我们一直在命令行使用 grep、cut、sort、uniq 和 join 来进行数据分析。他们工作得很好，虽然有缺点。例如，您必须为每个工具指定列号。我们经常有宽文件（许多列）和一个给出列名的列标题。事实上，我们的文件看起来很像 SQL 表。我确定有一个驱动程序（ODBC？）可以对分隔的文本文件进行操作，并且一些查询引擎将使用该驱动程序，所以我们可以只对我们的文本文件使用 SQL 查询。由于进行分析通常是临时的，因此查询新文件（只需使用我在此目录中指定的文件）而不是在某些配置中声明特定表必须是最小的设置。

实际上，什么是最简单的？也就是说，最容易设置和用于应用于文本文件的 SQL 引擎和驱动程序？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-24T19:24:43.693

[David Malcolm](http://dmalcolm.livejournal.com/1301.html)编写了一个名为“ [squeal](http://fedorahosted.org/squeal/) ”（以前称为“show”）的小工具，它允许您使用类似 SQL 的命令行语法来解析各种格式的文本文件，包括 CSV。

squeal 主页上的示例：

```
$ squeal "count(*)", source from /var/log/messages* group by source order by "count(*)" desc
count(*)|source              |
--------+--------------------+
1633    |kernel              |
1324    |NetworkManager      |
98      |ntpd                |
70      |avahi-daemon        |
63      |dhclient            |
48      |setroubleshoot      |
39      |dnsmasq             |
29      |nm-system-settings  |
27      |bluetoothd          |
14      |/usr/sbin/gpm       |
13      |acpid               |
10      |init                |
9       |pcscd               |
9       |pulseaudio          |
6       |gnome-keyring-ask   |
6       |gnome-keyring-daemon|
6       |gnome-session       |
6       |rsyslogd            |
5       |rpc.statd           |
4       |vpnc                |
3       |gdm-session-worker  |
2       |auditd              |
2       |console-kit-daemon  |
2       |libvirtd            |
2       |rpcbind             |
1       |nm-dispatcher.action|
1       |restorecond         | 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-04-08T18:16:36.370

q - 直接在 CSV 或 TSV 文件上运行 SQL：

[https://github.com/harelba/q](https://github.com/harelba/q)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-22T17:51:41.683

也许编写一个脚本来创建一个 SQLite 实例（可能在内存中），从文件/标准输入中导入您的数据（接受您的数据格式），运行查询，然后退出？

根据数据量，性能可能是可以接受的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-22T21:31:19.207

借鉴别人的建议，这里是 sqlite3 的 Python 脚本。有点冗长，但它有效。

我不喜欢完全复制文件以删除标题行，但我不知道如何说服 sqlite3 的 .import 跳过它。我可以创建 INSERT 语句，但这似乎同样糟糕，如果不是更糟的话。

示例调用：

```
$ sql.py --file foo --sql "从数据中选择计数(*)"

```

编码：

```
#!/usr/bin/env python

"""在文本文件上运行 SQL 语句"""

导入操作系统
导入系统
导入getopt
导入临时文件
重新进口

类用法（例外）：
    def __init__（自我，味精）：
        self.msg = 味精

def runCmd(cmd):
    如果 os.system(cmd):
        打印“错误运行”+ cmd
        系统退出（1）
        # TODO(dan): 返回实际退出代码

默认用法（）：
    print >>sys.stderr, "用法：sql.py --file 文件 --sql sql"

定义主（argv=无）：
    如果 argv 为无：
        argv = sys.argv

    尝试：
        尝试：
            选择，args = getopt.getopt(argv[1:], "h",
                                       ["帮助", "file=", "sql="])
        除了getopt.error，味精：
            提高用法（味精）
    除了用法，错误：
        打印 >>sys.stderr, err.msg
        print >>sys.stderr, "帮助使用 --help"
        返回 2

    文件名 = 无
    sql = 无
    for o, a in opts:
        如果 o in ("-h", "--help"):
            用法（）
            返回 0
        elif o in ("--file"):
            文件名 = 一个
        elif o in ("--sql"):
            sql = 一个
        别的：
            print "发现意外选项" + o

    如果不是文件名：
        print >>sys.stderr, "必须给 --file"
        系统退出（1）
    如果不是 sql：
        print >>sys.stderr, "必须给 --sql"
        系统退出（1）

    # 获取文件的第一行以创建 CREATE 语句
    #
    # 将其余行复制到一个新文件（数据文件）中，以便
    # sqlite3 可以导入不带header的数据。如果 sqlite3 可以跳过
    # .import 的第一行，这个副本是不必要的。
    foo = 打开（文件名）
    数据文件 = tempfile.NamedTemporaryFile()
    第一个 = 真
    对于 foo.readlines() 中的行：
        如果首先：
            标题 = line.rstrip().split()
            第一个 = 假
        别的：
            打印>>数据文件，行，
    数据文件.flush()
    #打印数据文件名
    #runCmd("cat %s" % datafile.name)
    # 创建具有 NUMERIC 亲和性的列，以便如果它们是数字，
    # SQL 查询会这样对待它们。
    create_statement = "创建表数据 (" + ",".join(
        map(lambda x: "`%s` NUMERIC" % x, headers)) + ");"

    cmdfile = tempfile.NamedTemporaryFile()
    #print cmdfile.name
    打印 >>cmdfile,create_statement
    打印 >>cmdfile,".separator ' '"
    打印 >>cmdfile,".import '" + datafile.name + "'data"
    打印 >>cmdfile, sql + ";"
    cmdfile.flush()
    #runCmd("cat %s" % cmdfile.name)
    runCmd("cat %s | sqlite3" % cmdfile.name)

如果 __name__ == "__main__":
    sys.exit(main())

```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-22T16:35:58.310

MySQL 有一个[CVS 存储引擎](http://dev.mysql.com/doc/refman/5.1/en/csv-storage-engine.html)，如果您的文件是 CSV 文件，它可能会满足您的需求。

否则，您可以使用 mysqlimport 将文本文件导入 MySQL。您可以围绕 mysqlimport 创建一个包装器，它计算出列等并创建必要的表。

您还可以使用[DBD::AnyData](http://search.cpan.org/~jzucker/DBD-AnyData-0.09/AnyData.pm)，这是一个 Perl 模块，可让您像访问数据库一样访问文本文件。

也就是说，听起来很像您应该真正考虑使用数据库。将面向表格的数据保存在文本文件中真的更容易吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-07-04T13:30:38.703

我已经使用 Microsoft LogParser 多次查询 csv 文件......它达到了目的。令人惊讶的是，M$ 提供了如此有用的工具，而且还免费！

# python - 如何在不知道约束类型的情况下查询任何约束的目标列表？

> ID：778083
> 
> 赞同：2
> 
> 时间：2009-04-22T16:20:35.630
> 
> 标签：python, 3d, constraints, maya, mel

在 Maya 中，我有一个由以下代码收集的约束列表。我想迭代约束并查询每个约束的目标：

```
cons = ls(type='constraint')
for con in cons:
    targets = constraint(query=True, targetList=True) 
```

问题是，没有通用`constraint`的命令来操作所有的约束。相反，每个约束都有自己独特的 MEL 命令与之关联。

有什么方法可以查询约束上的目标，而不必键入检查每个约束并繁琐地运行其各自的 MEL 命令？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T18:54:22.737

.target attr 上的 listConnections

梅尔的清理工作：

```
string $cons[] = `ls -type "constraint"`;
for ( $con in $cons ){
    string $targetAttrString = ( $con+ ".target" );
    string $connections[] = `listConnections $targetAttrString`;
    string $connectionsFlattened[] = stringArrayRemoveDuplicates($connections);
    for ( $f in $connectionsFlattened )
        if ( $f != $con )
            print ( $f+ " is a target\n" );
} 
```

# c++ - 如何在 Linux 中命名线程？

> ID：778085
> 
> 赞同：42
> 
> 时间：2009-04-22T16:21:02.463
> 
> 标签：c++, c, linux, multithreading

我有一个用 C/C++ 编写的多线程 Linux 应用程序。我[为我的线程选择了名称](https://stackoverflow.com/questions/149932/naming-conventions-for-threads)。为了帮助调试，我希望这些名称在 GDB、“top”等中可见。这可能吗？如果可以，怎么办？

（有很多[理由知道线程名称](https://stackoverflow.com/questions/763041/thread-names-when-do-you-need-to-know-them)。现在我想知道哪个线程占用了 50% 的 CPU（由 'top' 报告）。调试时我经常需要切换到不同的线程 - 目前我必须做“ `thread apply all bt`”然后查看回溯输出页面以找到正确的线程）。

Windows 解决方案在[这里](https://web.archive.org/web/20100322223513/http://msdn.microsoft.com/en-us/library/xcb2z8hs(VS.80).aspx)；Linux 是什么？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-04-22T16:32:53.543

Posix 线程？

这显然不会编译，但它会让你知道去哪里打猎。我什至不确定它是正确的`PR_`命令，但我认为它是。有一阵子了...

```
 #include <sys/prctl.h>
  prctl(PR_SET_NAME,"<null> terminated string",0,0,0) 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-22T16:57:03.047

如果您使用像[ACE](http://www.cs.wustl.edu/~schmidt/ACE.html)这样的库，则[Thread](http://www.dre.vanderbilt.edu/Doxygen/5.6.9/html/ace/a00565.html)可以在创建新线程时指定线程名称。

BSD Unix 也有一个[pthread_set_name_np](http://www.rootr.net/man/man/pthread_set_name_np/3)调用。

否则，您可以使用Fusspawn 提到的[prctl 。](http://manpages.courier-mta.org/htmlman2/prctl.2.html)

# silverlight - 引用 Silverlight 中控件的默认样式

> ID：778087
> 
> 赞同：0
> 
> 时间：2009-04-22T16:21:41.230
> 
> 标签：silverlight, custom-controls, silverlight-2.0

如何引用 generic.xaml 中出现的默认样式？

我正在尝试创建一个返回自定义控件的已知样式的静态类。我知道如何提取 App.xaml 中存在的样式，但我不确定如何获取通用样式。

```
public static class VehicleTypes
{
    public static readonly Style SportsCar = /*???Default style for VehicleIcon from generic.xaml*/;

    public static readonly Style Sedan = Application.Current.Resources["SedanStyle"] as Style;
    public static readonly Style Jeep = Application.Current.Resources["JeepStyle"] as Style;
    ...
} 
```

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-23T16:24:18.287

据我所知，您无法获得默认样式。

如果您使用一些技巧从 ResourceDictionary 获取私有成员 _dictionary 然后找到控件的所有样式，则可能是可能的。

您需要对默认样式做什么？也许还有另一种选择。

# python - pyExcelerator 或 xlrd - 如何为给定的几列数据查找/搜索一行？

> ID：778093
> 
> 赞同：2
> 
> 时间：2009-04-22T16:23:02.130
> 
> 标签：python, excel, search, pyexcelerator, xlrd

Python 与 EXCEL 通信......我需要找到一种方法，以便我可以找到/搜索给定列数据的行。现在，我一一扫描整行...如果有一些功能，例如 FIND/SEARCH/REPLACE .... 我在 pyExcelerator 或 xlrd 模块中看不到这些功能.. 我不想使用 win32com模块！它使我的工具基于窗口！

通过 Python 查找/搜索 Excel 行....任何想法，有人吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-06-06T03:12:29.693

@John Fouhy：[我是 xlwt 的维护者，也是 xlrd 的作者]

pyExcelerator 的电子表格阅读部分被严重弃用，以至于它完全从 xlwt 中消失了。要使用 Python 2.1+ 读取由 Excel 2.0 至 11.0 (Excel 2003) 或兼容软件创建的任何 XLS 文件，请使用[xlrd](http://pypi.python.org/pypi/xlrd)

xlrd 不需要“简单的优化”：

```
import xlrd
book = xlrd.open_workbook("foo.xls")
sheet = book.sheet_by_number(0) # alternatively: sheet_by_name("Budget")
for row_index in xrange(sheet.nrows): 
    for col_index in xrange(sheet.ncols): 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T20:22:54.253

你不能。这些工具不提供搜索功能。您必须循环遍历数据并自行搜索。对不起。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T17:12:38.703

“现在，我一一扫描整行”

那有什么问题？“搜索”——在电子表格上下文中——真的很复杂。搜索值？搜索公式？向下搜索行然后跨列搜索？仅搜索特定列？仅搜索特定行？

电子表格不是简单的文本——简单的文本处理设计模式不适用。

电子表格搜索很困难，而且您做得正确。没有比这更好的了，因为它很难。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T22:55:56.803

使用 pyExcelerator，您可以通过首先找到最大行和列索引（并存储它们）来进行简单的优化，以便您迭代`(row, i) for i in range(maxcol+1)`而不是迭代所有字典键。这可能是你得到的最好的，除非你想通过并建立一个字典映射值到一组键。

顺便说一句，如果您使用 pyExcelerator 编写电子表格，请注意它有一些错误。我遇到过一个涉及写入 2 **30 和 2** 32 （或大约）之间的整数的问题。这些天显然很难联系到原作者，因此`xlwt`修复（已知）错误的分支也是如此。对于编写电子表格，它是 pyExcelerator 的直接替代品；你可以做`import xlwt as pyExcelerator`任何改变。但是，它不读取电子表格。

# c# - Windows 窗体：使用 BackgroundImage 会减慢窗体控件的绘制速度

> ID：778095
> 
> 赞同：33
> 
> 时间：2009-04-22T16:23:32.893
> 
> 标签：c#, .net, winforms, performance

我有一个 Windows 窗体 (C# .NET 3.5)，上面有许多按钮和其他控件，所有这些都分配给跨越整个窗体的最顶层面板。例如，层次结构是：Form -> Panel -> 其他控件。

一旦我将 BackgroundImage 分配给面板，控件就会非常缓慢地绘制。如果我使用 Form 的 BackgroundImage 属性并将 Panel 的 BackgroundColor 设置为“透明”，我将获得相同的效果。看起来好像首先绘制了带有背景的窗口，然后每个控件一个接一个地添加，在绘制下一个控件之前有一点延迟。换句话说，您实际上可以按照将每个控件绘制到窗体的顺序。一旦所有控件都被绘制，一旦这种效果不再发生，但表单的响应速度仍然很慢。

在 Visual Studio 的设计器中，我得到了相同的效果，在移动控件时尤其明显。有时表单的绘制会完全停止一两秒，这使得在设计器和生成的应用程序中使用 BackgroundImage 成为一种完全的拖累。

当然，我尝试使用DoubleBuffered = true，并且我还使用反射将其设置在所有控件上，但没有效果。

另外，这里是表单加载代码，因为它有点不寻常。它将所有控件从另一个窗体复制到当前窗体。这样做是为了能够使用设计器分别编辑每个屏幕的视觉外观，同时共享通用表单和通用代码基础。我有一种预感，它可能是减速的原因，但它仍然不能解释为什么减速在设计师中已经很明显了。

```
private void LoadControls(Form form)
{
    this.SuspendLayout();

    this.DoubleBuffered = true;
    EnableDoubleBuffering(this.Controls);

    this.BackgroundImage = form.BackgroundImage;
    this.BackColor = form.BackColor;

    this.Controls.Clear();
    foreach (Control c in form.Controls)
    {
        this.Controls.Add(c);
    }

    this.ResumeLayout();
} 
```

如您所见，`SuspendLayout()`和`ResumeLayout()`用于避免不必要的重绘。

尽管如此，一旦使用了 BackgroundImage，表单仍然“慢得要命”。我什至尝试将其转换为 PNG、JPG 和 BMP，看看是否有什么不同。此外，图像大小为 1024x768，但较小的图像具有相同的减速效果（尽管略小）。

我应该怎么办？

* * *

## 回答 #1

> 赞同：47
> 
> 时间：2009-04-22T16:36:04.800

`SuspendLayout()`并且`ResumeLayout()`不暂停绘图，只进行布局操作。试一试这个人：

```
public static class ControlHelper
{
    #region Redraw Suspend/Resume
    [DllImport("user32.dll", EntryPoint = "SendMessageA", ExactSpelling = true, CharSet = CharSet.Ansi, SetLastError = true)]
    private static extern int SendMessage(IntPtr hwnd, int wMsg, int wParam, int lParam);
    private const int WM_SETREDRAW = 0xB;

    public static void SuspendDrawing(this Control target)
    {
        SendMessage(target.Handle, WM_SETREDRAW, 0, 0);
    }

    public static void ResumeDrawing(this Control target) { ResumeDrawing(target, true); }
    public static void ResumeDrawing(this Control target, bool redraw)
    {
        SendMessage(target.Handle, WM_SETREDRAW, 1, 0);

        if (redraw)
        {
            target.Refresh();
        }
    }
    #endregion
} 
```

用法应该是不言自明的，语法与`SuspendLayout()`and相同`ResumeLayout()`。这些是将显示在任何 Control 实例上的扩展方法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-11-22T07:44:29.480

我也遇到了同样的问题，可以通过降低背景图片的分辨率来解决。当您使用大尺寸（例如：1280X800）图片作为背景时，在窗体上绘制控件需要时间。最好以“Paint”打开图片，使其大小小于您的表单，然后以“bmp”格式保存。现在尝试将此图片添加为表单的背景。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-07-23T11:03:47.860

在添加控件时避免永久重绘的另一种非常简单的方法是在向其添加控件之前使父控件不可见。之后，您使父控件（例如，面板）可见，并且没有所有这些重绘。:-)

```
panelParent.visible = false;

for(...) {
    // Add your controls here:
    panelParent.Controls.Add(...);
}

panelParent.visible = true; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2017-04-15T17:51:28.657

我使用`PictureBox`. 只需添加`PictureBox`到您的容器中，选择“将其停靠在父容器中”（或 property `Dock`= `Fill`）并将其设置为 Image。它看起来就像父控件的 BackGroundImage。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-06-03T12:42:28.967

对我来说，*[如果添加背景图片](http://www.c-sharpcorner.com/Forums/ShowMessages.aspx?ThreadID=45434)*解决了问题，则表单加载速度很慢：

> 确保您的背景颜色未设置为“透明”。将其设置为“白色”以获得更好的性能。
> 
> 此外，将[BackgroundImageLayout](http://msdn.microsoft.com/en-us/library/system.windows.forms.control.backgroundimagelayout.aspx)设置为“Center”或“ [Stretch](http://msdn.microsoft.com/en-us/library/system.windows.forms.imagelayout.aspx) ”以提高性能。这将启用表单上的双缓冲区。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-03-21T02:40:05.313

我意识到这是一个旧线程，但我在搜索同一问题的信息时发现了它，所以如果它在某些时候对某人有用：

我的情况：我有一个 13 x 12 的面板网格，它有一个动态设置的背景图像，并根据用户的选择定期更改。每个面板还添加了一个文本标签控件。为了使文本覆盖背景图像，必须将其设置为透明（顺便说一句 - 我的经验是缩放、拉伸、中心的 BackgroundImageLayout 几乎没有效果。BackColor 设置为透明或白色也几乎没有效果）。

面板网格的每次绘制（包括调整大小）大约需要一秒钟 - 不错但非常明显，并且在较慢的机器上存在可用性问题。

我的图像不是很大，但有点过大。

我发现：通过在设置背景图像之前将我的图像集调整为精确的面板大小，绘制时间显着下降 - 大约 0.1 秒。由于我的程序会根据窗口大小动态调整面板大小，因此在设置 156 个面板的背景之前，我会在 windows resize 事件上动态调整图像集的大小。

事后看来，这是一个明显的优化......一次调整 8 张图像的大小，而不是重复 156 次。

# python - 打开文本文档时出现问题 - unicode 错误

> ID：778096
> 
> 赞同：2
> 
> 时间：2009-04-22T16:23:49.040
> 
> 标签：python, unicode

我可能有相当简单的问题。然而，我刚刚开始使用 python，它让我发疯。我按照一本书的说明，想打开一个简单的文本文件。我正在使用的代码：

```
import sys
try:
 d = open("p0901aus.txt" , "W")
except:
 print("Unsucessfull")
 sys.exit(0) 
```

我要么收到消息，即我打开文档失败，要么出现弹出消息：

（unicode 错误）“unicodeescape”编解码器无法解码位置 2-4 中的字节：截断 \UXXXXXXXX 转义

我不知道问题是什么。我试图用不同的代码保存文档，尝试了不同的路径......总是同样的问题

有人知道有什么帮助吗？

非常感谢你，

乔治 ps：我使用的是 windows vista

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T16:47:29.450

> （unicode 错误）“unicodeescape”编解码器无法解码位置 2-4 中的字节：截断 \UXXXXXXXX 转义

这可能意味着您尝试读取的文件不是 open() 期望的编码。显然 open() 需要一些 Unicode 编码（很可能是 UTF-8 或 UTF-16），但你的文件不是这样编码的。

通常不应该使用普通的 open() 来读取文本文件，因为如果不指定编码就不可能正确读取文本文件（除非它是纯 ASCII）。

改用编解码器：

```
import codecs
fileObj = codecs.open( "someFile", "r", "utf-8" )
u = fileObj.read() # Returns a Unicode string from the UTF-8 bytes in the file 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T16:27:56.957

将其更改为

```
# for Python 2.5+
import sys
try:
   d = open("p0901aus.txt","w")
except Exception, ex:
   print "Unsuccessful."
   print ex
   sys.exit(0)

# for Python 3
import sys
import codecs
try:
  d = codecs.open("p0901aus.txt","w","utf-8")
except Exception as ex:
  print("Unsuccessful.")
  print(ex)
  sys.exit(0) 
```

W 区分大小写。我不想一次用所有的 Python 语法来打击你，但知道如何显示引发的异常对你很有用，这是一种方法。

此外，您打开文件是为了写入，而不是读取。那是你想要的吗？

如果已经有一个名为 p0901aus.txt 的文档，并且您想阅读它，请执行以下操作：

```
#for Python 2.5+
import sys
try:
   d = open("p0901aus.txt","r")
   print "Awesome, I opened p0901aus.txt.  Here is what I found there:"
   for l in d:
      print l
except Exception, ex:
   print "Unsuccessful."
   print ex
   sys.exit(0)

#for Python 3+
import sys
import codecs
try:
   d = codecs.open("p0901aus.txt","r","utf-8")
   print "Awesome, I opened p0901aus.txt.  Here is what I found there:"
   for l in d:
      print(l)
except Exception, ex:
   print("Unsuccessful.")
   print(ex)
   sys.exit(0) 
```

当然，您也可以使用 Python 2.5 中的编解码器，如果您这样做，您的代码质量会更高（“正确”）。Python 3 似乎将字节顺序标记视为介于好奇心和线路噪音之间的东西，这很糟糕。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-03-04T13:29:10.040

```
import csv

data = csv.reader(open('c:\x\list.csv' ))

for row in data:

    print(row)

print('ready') 
```

调出“（unicode error）'unicodeescape'编解码器无法解码位置 2-4 中的字节：截断 \xXX 转义”

尝试`c:\\x\\list.csv`代替`c:\x\list.csv`

这是 Python 3 代码。

# visual-studio-2008 - 有没有办法在 Visual Studio 2008 中指定应用程序需要管理员？

> ID：778097
> 
> 赞同：0
> 
> 时间：2009-04-22T16:23:50.007
> 
> 标签：visual-studio-2008, uac, manifest

我看到很多关于如何嵌入清单文件以要求管理员的文章，但我发现的问题是我们自动增加版本号，所以静态清单文件似乎不起作用，因为我们' d 每次都必须更新版本号。

有什么方法可以让 VS 生成清单并自动嵌入它并使用 AssemblyInfo.cs 文件中的信息进行更新？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T16:25:29.457

我们在构建过程中使用 M4 来更新 Manifest 中的版本号。

看看：[http ://www.gnu.org/software/m4/](http://www.gnu.org/software/m4/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T16:55:44.313

您可以右键单击应用程序，然后选择“添加新项目”。然后选择“应用程序清单文件”。

app.manifest 将允许告诉窗口应用程序需要什么权限级别。

它非常容易。

[编辑]：我不确定您需要从 assemblyInfo.cs 文件更新什么。

# sql-server - 如何在 SQL Server 上设置检查？

> ID：778098
> 
> 赞同：1
> 
> 时间：2009-04-22T16:24:07.120
> 
> 标签：sql-server

我需要添加`group`一个名为的表，该表名为`code`

如何向列添加检查约束，使其仅允许以下字母字符（D、M、O、P 或 T）后跟 2 个数字字符。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T16:35:56.593

您只需要简单的检查约束

```
create table blatest(code char(3))

alter table blatest add  constraint ck_bla 
check (code like '[DMOPT][0-9][0-9]' )
GO 
```

测试

```
insert blatest values('a12') --fails
insert blatest values('M12')  --good
insert blatest values('D12') --good
insert blatest values('DA1') --fails 
```

如果您需要它区分大小写，那么您必须像这样创建约束

```
alter table blatest add  constraint ck_bla 
check (code like '[DMOPT][0-9][0-9]' COLLATE SQL_Latin1_General_CP1_CS_AS )
GO 
```

D12 会成功，但 d12 在这种情况下不会

# c# - 尝试调用 COM 库时服务引发异常

> ID：778104
> 
> 赞同：-1
> 
> 时间：2009-04-22T16:25:32.780
> 
> 标签：c#, .net, windows-services, error-handling

我正在编写一个使用 COM 库的应用程序。我有一个类库，它封装了对 COM 库的调用并添加了更多功能。最终这将作为 Windows 服务运行。现在我使用 Winforms 测试工具对其进行测试。

当测试工具创建类库时，一切似乎都工作正常。当我尝试将其作为服务运行时，问题就开始了。它创建正常，甚至对 COM 的第一次调用也正常。然后，COM 对象引发我处理的事件，并响应事件中的结果，我调用 COM 库中的另一个函数。在我从测试工具运行它但作为服务运行时抛出异常的情况下，该函数被成功调用：

> System.InvalidCastException 发生 Message="Unable to cast COM object of type '' to interface type ''。此操作失败，因为对具有 IID '{350ADD2A-18CB-4D9C-BE28-48D53F14E6FB} 的接口的 COM 组件调用 QueryInterface ' 由于以下错误而失败：应用程序调用了为不同线程编组的接口。（来自 HRESULT 的异常：0x8001010E (RPC_E_WRONG_THREAD)）。

我可以看到存在线程问题。在测试工具案例中，所有这些调用都发生在主线程上，而在 Windows 服务的情况下，Service OnStart 覆盖和 COM 事件处理程序都在不同的线程上。我一直在尝试不同的事情但没有成功。有什么建议么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T16:39:42.123

某些 COM 组件只能由 STA 线程访问。如果您的情况是这样，您可以在 STA 线程中进行 COM 工作，如下所示：

```
RunInSTAThread( () => com_object.DoSomething() );

private static void RunInSTAThread(ThreadStart thread_start)
        {
            Exception threadEx = null;
            ThreadStart wrapped_ts = () =>
                                         {
                                             try
                                             {
                                                 thread_start();
                                             }
                                             catch (Exception ex)
                                             {
                                                 MethodInfo preserveStackTrace =
                                                     typeof(Exception).GetMethod("InternalPreserveStackTrace",
                                                                                 BindingFlags.Instance | BindingFlags.NonPublic);
                                                 preserveStackTrace.Invoke(ex, null);
                                                 threadEx = ex;
                                             }
                                         };
            Thread thread = new Thread(wrapped_ts);
            thread.SetApartmentState(ApartmentState.STA);
            thread.Start();
            thread.Join();
            if (threadEx != null)
            {
                throw threadEx;
            }
        } 
```

对于您的情况，这可能不是线程（每次调用的新线程）的最佳用途，但它是一个起点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T10:56:16.213

现在已经解决了。我不得不重新安排线程。现在 COM 对象和对它的所有调用都在同一个线程上，并且没有线程间问题。在普通情况下如何处理它的问题仍然不清楚。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T06:51:33.917

Win 服务是否在与 Winforms 应用程序相同的用户帐户下运行？

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2011-12-19T05:08:43.493

我刚刚关闭了项目并再次打开它并解决了错误

# xslt - 操纵输出

> ID：778120
> 
> 赞同：0
> 
> 时间：2009-04-22T16:30:53.923
> 
> 标签：xslt, string

如何对 的输出进行字符串操作`<xsl:apply-templates>`？

我需要转义引号等，因为它最终被传递给 JavaScript 变量。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T16:41:34.800

好的和干净的方法是更改​​您的 XSLT，以便它的输出不需要任何额外的操作。

如果您的调用`<xsl:apply-templates>`产生了一个由于某种原因必须被操作的字符串，您需要首先将它捕获到一个变量中：

```
<xsl:variable name="temp">
  <xsl:apply-templates />
</xsl:variable>

<xsl:variable name="temp-manipulated">
  <xsl:call-template name="do-some-string-mainpulation">
    <xsl:with-param name="string" select="$temp" />
  </xsl:call-template>
</xsl:variable>

<xsl:value-of select="$temp-manipulated" /> 
```

或者，您可以将 集成`<xsl:apply-templates>`到 中`<xsl:with-param>`，这样可以省去一步：

```
<xsl:variable name="temp">
  <xsl:call-template name="do-some-string-mainpulation">
    <xsl:with-param name="string">
      <xsl:apply-templates />
    </xsl:with-param>
  </xsl:call-template>
</xsl:variable>

<xsl:value-of select="$temp" /> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T16:39:13.433

捕获一个变量，然后操纵该值以创建输出：

```
<xsl:variable name='temp'>
  <xsl:apply-templates ...>
</xsl:variable>

<xsl:value-of select='expression involving $temp' /> 
```

# device-driver - 访问 PCI 配置空间中寄存器的正确方法

> ID：778121
> 
> 赞同：3
> 
> 时间：2009-04-22T16:32:10.800
> 
> 标签：device-driver, bios, pci-bus

当您需要访问 PCI 配置空间中的寄存器时，您是否只需要使用内置的 BIOS 函数将 DWORD 读/写到配置空间中？

例如，如果我尝试使用 B0:D31:F1 上的 IDE 控制器，我是否继续使用该 BDF 作为 BIOS 函数的参数来读/写配置寄存器？因此，如果我想获取供应商 ID，我会读取给定 BDF 中的第一个 DWORD 吗？

或者我只是离基地很远？

编辑：

在 PCI BIOS 规范中，我一直在查看 BIOS 函数的定义，用于在配置空间中读取和写入字。我相信这意味着我可以在配置空间内的各种偏移量处写入寄存器。我想我的问题是，这是在这个级别访问这些寄存器的正确方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-01T00:23:25.517

阅读 PCI 规范后，我只需要通过给定的中断向量 (1Ah) 调用 PCI BIOS 函数。然而，这因必须事先进行的 PCI 配置而变得复杂。

PCI 配置空间似乎不使用显式地址进行访问，而是使用 BIOS 函数调用。

编辑：实际上，BIOS 做的比我知道的要多得多。我所要做的就是枚举 PCI 总线，直到找到 IDE 控制器的设备和供应商 ID。唯一需要的组件是输入/输出端口包装器。

```
 pci_dev_t dev = { 0xffffffff, 0xffffffff, 0xffffffff };

for ( bus = 0; bus < 0xffff; ++bus ) {
  for ( slot = 0; slot < 0xffff; ++slot ) {
    for ( func = 0; func < 0xff; ++func ) {
      uint16_t dev_id  = _pci_read_config_data( bus, slot, func, 0x00, PCI_READ_CONFIG_WORD );
      uint16_t vend_id = _pci_read_config_data( bus, slot, func, 0x02, PCI_READ_CONFIG_WORD );

      if ((vendor == vend_id) && (device == dev_id)) {
        dev.bus      = bus;
        dev.device   = slot;
        dev.function = func;

        return dev;
      }
    }
  }
} 
```

# c# - 用 C# 编写 USB 驱动器便携式应用程序

> ID：778123
> 
> 赞同：7
> 
> 时间：2009-04-22T16:32:50.343
> 
> 标签：c#, usb, portability

关于拥有 USB 闪存设备，我最喜欢的事情之一就是随身携带一堆有用的工具。我想写一些工具，让它们在这种环境下运行良好。我最了解 C#，而且我的工作效率很高，所以我可以用这种方式立即启动一个 Windows 窗体应用程序。

但是在制作便携式应用程序时我应该考虑哪些因素？我能想到的一些，但不知道答案：

1) 语言可移植性 - 好的，我知道我使用它的任何机器都需要安装 .NET 运行时。但是由于我只经常使用一些 Windows 机器，所以这应该不是问题。我可以使用另一种语言对其进行编码，但随后我会失去生产力，尤其是在简单的表单设计器方面。从闪存驱动器运行 .NET 应用程序是否还有其他问题？

2) 读/写周期 - 在 C# 中，我如何确保我的应用程序没有不必要地写入驱动器？我是否总是可以控制写入，或者是否有任何“隐藏的写入”需要考虑？

3）悬而未决的问题：是否还有其他与可移植应用程序相关的问题我应该注意，或者可能对具有良好 IDE 的其他语言的建议可以让我获得类似水平的生产力但更好的可移植性？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-22T16:41:45.347

*   1) 从闪存驱动器运行 .NET 应用程序应该没有任何问题。
*   2）您应该可以控制大多数写入。确保写入临时或硬盘驱动器上的其他位置，而不是闪存驱动器。但是写入周期应该不是问题——即使是中度到重度使用，大多数闪存驱动器的使用寿命也长达数年。
*   3) 就像任何具有 xcopy 样式部署的应用程序一样对待它，如果某些依赖项不在盒子上，请尝试考虑您的应用程序优雅地失败。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T16:53:31.123

如果您想使用 com 对象，请使用 reg-free com 并将 com 对象包含在您的程序中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T17:15:09.853

您应该始终控制您的写入。应用程序应在启动时加载到 RAM 中，然后在 RAM 中分配内存，因此不会将任何内容写入闪存驱动器。

对于可移植应用程序而言，最重要的是您的应用程序基本上不需要安装。您尤其不想依赖注册表值，因为您的应用程序不会“安装”在其他计算机上。

您可能会考虑的可移植应用程序的问题之一是数据持久性。通常，您写入用户的应用程序数据文件夹以保存数据。如果是这种情况，则保存的任何数据将仅适用于该计算机上的用户。如果您想要一些本地应用程序数据，您可能希望为您的设置创建一个 Seralized XML 文件并将其本地存储在您的应用程序目录中。然后，此文件写入可能是您需要担心的唯一写入操作。

对于您的 .NET 可移植性问题，您还可以用 C++ 编写一个小型入口程序，用于检查计算机是否安装了 .NET。.NET 具有注册表值，您可以检查以查看安装的版本，因此如果安装了 .NET，请运行您的应用程序，否则会显示一条消息，说明需要首先安装 .NET。

**编辑：**我想补充一点，我在 C# 3.0 中使用 XAML 为超声波机器进行应用程序开发。我编写的应用程序可以通过 USB 闪存驱动器完美运行，而所有用户设置都存储在本地 AppData 基础上，因此没有任何内容写入 USB。虽然可以通过 .exe 安装程序安装应用程序，但安装程序不会写入应用程序所依赖的任何注册表值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T16:40:35.270

我实际上没有这方面的任何经验，所以最好用一点盐来接受我所说的。但这是我的看法：

你不需要做任何特别的事情。

应用程序开发人员并没有真正考虑如何以及何时对驱动器进行写入，这是由操作系统更好地控制的事情。我知道 Windows 会缓存对 USB 驱动器的写入，所以我相信它会处理这个问题。

您唯一需要考虑的是不会安装您的应用程序。因此，您需要确保将其设计为在其部署到的目录中完全独立运行。您还可以选择对用户主目录进行一些写入，但这需要通过适当的环境变量来完成。

我会开始写作，看看操作系统无法处理的闪存驱动器是否有什么特别之处。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T16:41:25.020

对于#1 或#3，我真的没有答案。但对于#2，.NET CLR 不应写入应用程序的“安装”文件夹（即闪存驱动器），除非您的代码明确告诉它或正在使用和修改基于文件的设置（ini、xml 等）与应用程序一起生活。

如果您不只是为个人使用而写东西，那么第 1 号确实是最重要的。显然，在 U 盘上托管完整 CLR 的便携式副本是不可能的。但是有一些工具可以扫描程序集的依赖项并将它们打包成一个独立的 .exe，这样 CLR 就不必安装在目标系统上。

# sql - sql 通过多个 postgres 数据库选择

> ID：778128
> 
> 赞同：2
> 
> 时间：2009-04-22T16:35:19.777
> 
> 标签：sql, postgresql

有没有办法创建一个 select 语句，可以从 postgre 中的多个数据库中检索数据？

我在想它会是这样的：

select * from dbname1.table1, dbname2.table2 where dbname1.table1.column1 = dbname2.table2.column1

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T16:46:46.457

查看“ [dblink](http://www.postgresql.org/docs/current/static/dblink.html) ”贡献模块。

OTOH，您可能将 PostgreSQL 集群中的数据库视为等同于......假设 MySQL 中的数据库。这是不正确的 - PostgreSQL 数据库包含模式，这些模式与 MySQL 中的数据库等效。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T16:48:47.107

从[这里](http://www.postgresql.org/docs/8.3/static/manage-ag-overview.html)：

> 每个连接不能访问多个数据库。

更新：但请参阅[Milen 的回答](https://stackoverflow.com/questions/778128/sql-select-thru-multiple-postgres-databases/778183#778183)。

# windows - 如何在批处理文件中获得相当于 dirname() 的内容？

> ID：778135
> 
> 赞同：27
> 
> 时间：2009-04-22T16:36:36.513
> 
> 标签：windows, command-line, batch-file

我想从文件中获取文件的父目录`.bat`。所以，给定一个设置为 的变量`"C:\MyDir\MyFile.txt"`，我想得到`"C:\MyDir"`. 换句话说，相当于`dirname()`典型 UNIX 环境中的功能。这可能吗？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-22T16:38:42.687

```
for %%F in (%filename%) do set dirname=%%~dpF 
```

这将设置`%dirname%`为存储在 中的文件名的驱动器和目录`%filename%`。

不过要小心包含空格的文件名。要么必须用周围的引号设置它们：

```
set filename="C:\MyDir\MyFile with space.txt" 
```

或者您必须在`for`循环中的参数周围加上引号：

```
for %%F in ("%filename%") do set dirname=%%~dpF 
```

任何一种方法都可以，同时两种方法都不会:-)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-05-12T15:54:53.903

如果出于某种原因您不能使用 FOR（没有命令扩展等），您可能能够摆脱 ..\ hack：

```
set file=c:\dir\file.txt
set dir=%file%\..\ 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2014-06-17T16:08:41.593

for 循环的问题在于它将尾随 \ 留在字符串的末尾。如果您想多次获取目录名，这会导致问题。也许您需要获取包含文件的目录的祖父目录的名称，而不仅仅是父目录。简单地再次使用 for 循环技术将删除 \，并且不会获得祖父目录。

那就是您不能简单地执行以下操作。

```
set filename=c:\1\2\3\t.txt
for %%F in ("%filename%") do set dirname=%%~dpF
for %%F in ("%dirname%") do set dirname=%%~dpF 
```

这会将 dirname 设置为“c:\1\2\3”，而不是“c:\1\2”。

以下函数还通过删除尾随 \ 来解决该问题。

```
:dirname file varName
    setlocal ENABLEEXTENSIONS ENABLEDELAYEDEXPANSION
    SET _dir=%~dp1
    SET _dir=%_dir:~0,-1%
    endlocal & set %2=%_dir%
GOTO :EOF 
```

它被称为如下。

```
set filename=c:\1\2\3\t.txt
call :dirname "%filename%" _dirname
call :dirname "%_dirname%" _dirname 
```

# java - 使用 OCR 的 PDF 文本提取方法

> ID：778145
> 
> 赞同：6
> 
> 时间：2009-04-22T16:38:31.610
> 
> 标签：java, pdf, text-parsing

有没有人尝试使用 OCR 库和 Java 从 PDF 中提取文本？您发现什么是最可靠的文本提取库。我见过的大多数方法（tesseract、GOCR）都是需要编写一些 JNI 代码的 C 库。

我熟悉 pdfbox，它现在是 0.8.x 版本的 Apache 孵化器项目，但它的文本提取并不总是准确的。我正在寻找一种更可靠的替代方法。

在尝试的过程中，我还没有尝试过 Asprise JavaPDF，但想了解更多关于 OCR 方法的信息（如果可能的话）。

任何帮助，将不胜感激。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T18:58:28.217

如果您有基于文本的 PDF，我强烈推荐[PDFTextStream](http://snowtide.com/PDFTextStream)。它不是免费的，但许可是合理的，而且比 PDFBox 好得多。PDFBox 阻塞了许多由较新工具生成的 PDF 文件，并且对于它可以处理的 PDF 并不太一致。PDFTextStream 处理我扔给它的任何 PDF，包括带有嵌入 PNG 图像的 PDF，这是 PDFBox 无法做到的。

如果您质问 PDFTextStream 人员添加 OCR，他们可能会听。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2015-04-08T09:14:15.747

我们使用 ABBYY FineReader Engine 11。他们有 java 包装器。

**优点：**

*   它适用于所有语言（英语、俄语、乌兹别克语等）并进行真正的 OCR（即使您有没有 OCR 的 pdf，它们首先执行渲染和 OCRing）。

**缺点：**

*   它的成本。您必须购买开发人员许可证和最终用户许可证。

*   而且速度非常慢。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T16:53:47.953

如果您想从基于文本的 PDF 中提取 OCR，您可能必须先将其转换为图像。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-05-15T00:43:52.170

您可以使用 Tesseract 的 Java 包装器 - tesjeract 或 Tess4J - 来执行 OCR。但是，对于 PDF，您需要先转换为图像（PNG 或 TIFF），然后再将其提供给 OCR 引擎。

[VietOCR](http://vietocr.sf.net)调用 Tesseract 可执行文件来执行文本提取。它使用 GhostScript 进行 PDF 到图像的转换。

# lucene - Mediawiki + Lucene：如何剥离标记？

> ID：778166
> 
> 赞同：2
> 
> 时间：2009-04-22T16:42:19.637
> 
> 标签：lucene, mediawiki, markup

我的 Lucene 搜索扩展 ( [http://www.mediawiki.org/wiki/Extension_talk:Lucene-search](http://www.mediawiki.org/wiki/Extension_talk:Lucene-search) ) 与我的 mediawiki 安装集成。这一切都运行得非常好，但是 - lucene 似乎也索引了所有 mediawiki /html 标记，并且它显示在结果中。

即搜索“绿色”将返回带有标记的结果，例如 style="background:green; color:white

有没有办法去除所有标记的搜索结果？我相信维基百科使用相同的搜索插件，他们是怎么做的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-23T12:15:40.050

在使用 Lucene 对其进行索引之前，您可能必须转换原始 wiki 标记。在处理纯 XML 内容时，可以只使用 XSL 转换`<xsl:value-of select="text()"/>`来提取文本内容。

恐怕这不适用于 wiki 标记，但也许您可以捕获页面后 HTML 转换？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-11-15T01:42:32.020

我找到了部分问题的解决方案。以下更改将从搜索结果中删除 HTML 标记。我还不能删除 Wikitext 标记。对此的任何提示将不胜感激。请注意，我不使用 Lucene 搜索扩展。

*   打开 /includes/search/SearchEngine.php
*   在该文件中，定义了一个类 - SearchResult
*   SearchResult.getTextSnippet() 包含格式化搜索结果的代码
*   SearchResult->mText 包含来自搜索结果的文本简介 要解决此问题，只需进入 SearchEngine.php 并找到名为 getTextSnippet() 的方法，然后在“if”之前添加以下行：

$this->mText = strip_tags($this->mText);

我在这个随机 Wiki 上找到了这个解决方案：[http ://www.myrandomwiki.com/wiki/MediaWiki_Notes#Strip_HTML_From_Search_Results](http://www.myrandomwiki.com/wiki/MediaWiki_Notes#Strip_HTML_From_Search_Results)

# .net - 为什么调用 form.Hide() 会导致闪烁，但 form.Close() 不会？

> ID：778169
> 
> 赞同：1
> 
> 时间：2009-04-22T16:42:50.820
> 
> 标签：.net, winforms, modal-dialog

我有一个在 Excel 中创建的 .net 表单（我不知道这是否相关），当我调用 时`form.Hide()`，Excel 会短暂闪烁。如果我改为调用`form.Close()`，则闪烁不存在。

为什么`Hide()`版本会导致闪烁，而`Close()`版本不会？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T16:57:00.567

我想这是因为 Hide() 被迫重新绘制隐藏的窗口，并且 Close() 终止了进程，我相信在 Hide() 的情况下由操作系统而不是 .NET 处理

# vba - Excel 按名称打印工作表

> ID：778170
> 
> 赞同：2
> 
> 时间：2009-04-22T16:42:53.627
> 
> 标签：vba, excel, printing, worksheet

我有一个 Excel 2007 电子表格，我想编写一个 VBA 程序来按名称打印特定的工作表。我该怎么做呢？

`"FirstSheet","ThirdSheet",`例如，我想打印`"FourthSheet"`但不`"SecondSheet".`

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-11-25T22:36:07.320

如果您知道工作表名称，只需`PrintOut`像这样调用函数：

```
Sheets("Name").PrintOut 
```

对于少量的纸张，通过这种方式更容易！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T17:03:39.663

```
Public Sub PrintByName(Names As Variant)

  Dim s As Worksheet
  Dim i As Integer

  If IsArray(Names) Then
    For Each s In ActiveWorkbook.Worksheets
      For i = 0 To UBound(Names)
        If StrComp(s.Name, Names(i), vbTextCompare) = 0 Then
          s.PrintOut
        End If
      Next i
    Next s
  End If

End Sub 
```

像这样调用：

```
PrintByName Array("FirstSheet", "ThirdSheet", "FourthSheet") 
```

就运行时性能而言，嵌套循环并不是最佳的。由于 Excel 工作簿可以包含的工作表数量有限，我认为这可以忽略不计。但是，使用 a`Collection`来包含所需的工作表名称而不是 an`Array`会更好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-07-01T23:22:40.660

不需要循环执行此操作，一行代码就足够了：

```
Sheets(Array("FirstSheet", "ThirdSheet", "FourthSheet")).PrintOut Copies:=1 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T16:57:05.700

类似于以下内容的东西应该可以工作：

```
Dim sh As Worksheet
For Each sh In ActiveWorkbook.Worksheets
        If (sh.Name = "Sheet1") Then
           sh.PrintOut
        End If
Next sh 
```

# java - 通过 Spring JDBC 流式传输数据，长度未知

> ID：778173
> 
> 赞同：7
> 
> 时间：2009-04-22T16:44:06.683
> 
> 标签：java, spring, jdbc

我目前有一个应用程序，它通过使用 Spring JDBC [SqlLobValue] 将 byte[] 插入到我们的数据库中。问题是，这不是一种可扩展的数据接收方式，因为服务器在写入数据库之前会缓冲内存中的所有数据。我想从 HttpServletRequest Inputstream 流式传输数据，但是我可以为任何将 Inputstream 作为参数的类找到的所有构造函数也需要内容长度作为参数。在将数据发布到我的应用程序时，我不会也不会要求用户知道内容长度。有没有办法绕过这个限制？

我找不到关于如果我通过 -1 作为内容长度会发生什么的文档，但我猜它会抛出一个异常。我不确定为什么他们不能让流继续读取，直到 read(...) 返回 -1，这是 InputStream 所需的行为。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-22T18:05:22.947

我想你的意思是“InputStream”而不是“OutputStream”。我试过了，但我的 JDBC 驱动程序遇到了更大的问题，所以我不确定这是否真的有效。

```
InputStream inputStream = httpServletRequest.getInputStream();

int contentLength = -1; // fake, will be ignored anyway
SqlLobValue sqlLobValue = new SqlLobValue(
    inputStream,
    contentLength,
    new DefaultLobHandler() {
        public LobCreator getLobCreator() {
            return new DefaultLobHandler.DefaultLobCreator() {
                public void setBlobAsBinaryStream(PreparedStatement ps, int paramIndex, InputStream binaryStream, int contentLength) throws SQLException {
                    // The contentLength parameter should be the -1 we provided earlier.
                    // You now have direct access to the PreparedStatement.
                    // Simply avoid calling setBinaryStream(int, InputStream, int)
                    // in favor of setBinaryStream(int, InputStream).
                    ps.setBinaryStream(paramIndex, binaryStream);
                }
            };
        }
    }
);

jdbcTemplate.update(
    "INSERT INTO foo (bar) VALUES (?)",
    new Object[]{ sqlLobValue }
); 
```

# azure - 自从 ACE 模型消失后，用于使用 Sql 数据服务的 Azure SDK 示例是否仍然有效？

> ID：778174
> 
> 赞同：2
> 
> 时间：2009-04-22T16:45:09.817
> 
> 标签：azure, ssds

我刚刚对 sql 数据服务进行了一些研究，发现当前的 ACE 模型正在逐步淘汰，以换取更新的关系模型。2009 年 3 月 CTP 中的所有示例似乎都基于 ACE 模型（如 StorageClient 项目）。我想知道这些是否仍然相关——它们似乎都基于 ACE 方法，但我不确定它是否只是关系后端的 REST 接口。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T19:17:16.127

更正... Windows Azure SDK 中的示例根本不使用 SQL 数据服务。它们针对 Windows Azure 表存储运行（不会更改模型，并且仍然基于 ADO.NET 数据服务）。因此，您正在查看的样本是完全有效的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T17:06:01.013

并不真地。SDS所采取的新方向意味着ACE模型将被丢弃。它们将支持 REST 接口，您可以使用 ADO.Net 数据服务与其通信。

您可能已经阅读过此内容，但这是他们宣布更改[的帖子](http://blogs.msdn.com/ssds/archive/2009/03/10/9469228.aspx)

# project-management - 寻找关于欣赏软件开发人员的文章

> ID：778176
> 
> 赞同：1
> 
> 时间：2009-04-22T16:45:31.187
> 
> 标签：project-management

我很久以前读过一篇关于为什么经理应该欣赏开发人员的文章，并且有一个类比 7 武士电影：公司不能真正为工程师提供太多东西，而工程师*选择*提供帮助公司——就像武士帮助村民一样。

我以为是在 joelonsoftware.com 或 codinghorror.com 上；但搜索没有带来任何结果。它会给任何人敲响警钟吗？任何人？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T16:56:14.780

它来自 Joel 的书“ [Smart and Gets Things Done](http://www.amazon.co.uk/Smart-Gets-Things-Done-Spolsky%2527s/dp/1590598385/ref=sr_1_1?ie=UTF8&s=books&qid=1240419708&sr=8-1) ”。部分标题为“像武士一样对待他们”。

一个报价：

> 村庄是你的团队。武士是程序员，你希望他们会来解决你的问题，用他们的才能和专业知识来换取一碗米饭。您可能贫穷而绝望，但您肯定知道如何对将要拯救您的武士表示尊重。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T17:05:46.007

与 Samurai 无关，而是 Joel 的另外 3 篇与管理/开发人员关系相关的文章。

[开发人员现场指南](http://joelonsoftware.com/articles/FieldGuidetoDevelopers.html)

[开发抽象层](http://joelonsoftware.com/articles/DevelopmentAbstraction.html)

[两个故事](http://joelonsoftware.com/articles/TwoStories.html)

# templating - 插值和模板

> ID：778185
> 
> 赞同：2
> 
> 时间：2009-04-22T16:46:50.997
> 
> 标签：templating, string-interpolation

我正在尝试验证我对字符串插值和字符串模板的理解。

说这两个 Java 代码片段是模板的例子是否正确？

```
public class Person {
 //showing only relevant code
 public String toString() {
   return "Name: " + name + " salary: " + salary + " address: " + address;
 }
}

public String toString() {
  return String.format("name: %s salary: %d address: %s", name, salary, address);
} 
```

这个 Groovy 片段是字符串插值的示例：

```
public class Person {
  def name
  def salary
  def address

  //showing only relevant parts of the code
  public String toString() {
    return """ name: ${name} salary: ${salary} address: ${address}"""
  }
} 
```

说 Java 和 Python 支持模板但不支持插值是否正确，但 Groovy 确实支持插值。

# java - 获取包含 main 的 .class 文件的目录路径

> ID：778187
> 
> 赞同：13
> 
> 时间：2009-04-22T16:47:18.110
> 
> 标签：java, file, path

是否可以从 main 中获取包含我的 main 函数的 .class 文件的路径？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-22T17:02:29.073

```
URL main = Main.class.getResource("Main.class");
if (!"file".equalsIgnoreCase(main.getProtocol()))
  throw new IllegalStateException("Main class is not stored in a file.");
File path = new File(main.getPath()); 
```

请注意，大多数类文件都组装成 JAR 文件，因此这并非在所有情况下都有效（因此使用`IllegalStateException`. 但是，您可以使用此技术找到包含该类的 JAR，并且您可以通过调用 代替 来获取类文件的内容，`getResourceAsStream()`无论`getResource()`该类是在文件系统上还是在 JAR 中，这都将起作用.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T16:50:26.060

根据[http://www.cs.caltech.edu/courses/cs11/material/java/donnie/java-main.html](http://www.cs.caltech.edu/courses/cs11/material/java/donnie/java-main.html)，没有。但是，我建议[在 Java 中阅读 $0（程序名称）？发现主要课程？](https://stackoverflow.com/questions/41894/0-program-name-in-java-discover-main-class)，这至少为您提供了主要课程。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T17:03:25.123

你需要它做什么？如果您需要它来获取同一目录中的任何文件，这就是[Class.getResourceAsStream()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Class.html#getResourceAsStream(java.lang.String))的用途。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-30T19:39:55.590

对我来说，这更像是最终用户的问题。还要考虑可能需要运行任何给定应用程序的多个实例，阻止用户这样做将成为一个主要的烦恼。

如果问题是临时文件冲突，那么只需确保所有临时文件都有唯一的名称。据我了解，这是人们认为需要阻止其应用程序的多个实例运行的最常见原因。

PS：java.io.File.createTempFile() 方法非常适合防止临时文件冲突，因为它们会自动生成唯一的文件名。

# c# - 滚动文本更新问题

> ID：778189
> 
> 赞同：0
> 
> 时间：2009-04-22T16:47:39.827
> 
> 标签：c#, wpf, xaml, animation

我从[MSDN 上的这篇文章](http://social.msdn.microsoft.com/Forums/en-US/wpf/thread/7a391faa-8607-4c2b-84d4-4ee3bf55a679)修改了一些滚动文本动画。不过，我有两个问题。

首先是我需要能够定期更新文本。但是，当 OnTick() 触发时，我收到以下错误，“调用线程无法访问此对象，因为不同的线程拥有它。” 我尝试了一些不同的方法，并发布了我尝试过的一种方法。

第二，不是来回滚动，我真的需要文本表现得像一个真正的选框并朝一个方向移动，内容不断流动，没有间隙，即“abcdeabcde ...”而不是“abcd e”。这是否需要两个故事板与相同的文本串联运行，还是有其他方法可以实现？

```
 Storyboard storyboard = new Storyboard(); 
  Timer timer; 
  public void OnLoad(object sender, RoutedEventArgs e)
  {
      _presenter.OnViewReady();
      StartMarquee(); 
  }
  public MyControl()
  {
        InitializeComponent();
        Loaded += OnLoad;
        timer = new Timer(OnTick, null, 10000, 10000);
  }
  private void OnTick(object state)
  {
      storyboard.Stop(marqueeText);
      storyboard = new Storyboard();
      marqueeText.Text =
            "Fusce id massa sed tortor volutpat viverra. Mauris ut quam. Fusce iaculis magna at urna. In sed dui vitae quam faucibus ullamcorper. Donec hendrerit magna eget neque. Mauris sit amet risus dictum mauris ultricies ornare. Phasellus lectus leo, mattis eget, ultrices vel, suscipit eu, tellus. Integer ut enim. Suspendisse hendrerit mattis sem. Aenean interdum elementum libero. ";
      StartMarquee();
  }
  protected override void OnRenderSizeChanged(SizeChangedInfo sizeInfo)
  {
      base.OnRenderSizeChanged(sizeInfo);
      marqueeText.Text =
          "Is it possible to create a marquee or scrolling text in WPF?  Is it possible to create a marquee or scrolling text in WPF?  Is it possible to create a marquee or scrolling text in WPF? Is it possible to create a marquee or scrolling text in WPF?  Is it possible to create a marquee or scrolling text in WPF?  Is it possible to create a marquee or scrolling text in WPF?";
  } 
  private void StartMarquee() 
  {
      var canvas = CommonFunctions.FindVisualParent<Canvas>(marqueeText);
      if (marqueeText.ActualWidth < canvas.ActualWidth) return;
      var duration = new Duration(TimeSpan.FromSeconds(marqueeText.ActualWidth / 60));
      var animation = new DoubleAnimation(-marqueeText.ActualWidth, canvas.ActualWidth, duration); 
      animation.RepeatBehavior = RepeatBehavior.Forever; 
      Storyboard.SetTargetName(animation, "rtTTransform"); 
      animation.AutoReverse = false; 
      Storyboard.SetTargetProperty(animation, new PropertyPath(TranslateTransform.XProperty));

      storyboard.Children.Add(animation);
      storyboard.Begin(marqueeText);
  } 
```

在视图中，控件声明为

```
 <Canvas Grid.Column="1" HorizontalAlignment="Stretch" ClipToBounds="True" Margin="10,0">
            <TextBlock Canvas.Left="0" Canvas.Top="0" x:Name="marqueeText" TextWrapping="NoWrap" VerticalAlignment="Center"
                   Grid.Column="1" Foreground="{x:Static Brushes.White}" ClipToBounds="False" FontSize="16">   
                <TextBlock.RenderTransform>  
                    <TransformGroup>  
                        <ScaleTransform ScaleX="1" ScaleY="1"/>   
                        <SkewTransform AngleX="0" AngleY="0"/>   
                        <RotateTransform Angle="0"/>   
                        <TranslateTransform x:Name="rtTTransform"/>   
                    </TransformGroup>  
                </TextBlock.RenderTransform>
            </TextBlock>
        </Canvas> 
```

在此先感谢我仍在研究此问题，并将根据我发现的任何更改进行更新。

**[已编辑]**删除了 AutoReverse，让事情变得不那么混乱，更接近我想要完成的目标。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-24T16:39:33.013

我最终通过创建一个在后台运行的线程来解决问题，该线程每隔一段时间更新文本，当文本完成滚动时，拉出最新的文本。

包含完整的示例以防将来对其他人有所帮助。

```
 public Thread Updater;
    public MyControl()
    {
        InitializeComponent();
        Loaded += OnLoad;
        Updater = new Thread(ExecuteMarqueeUpdate);
        Updater.Name = "MARQUEEUPDATE";
        Updater.IsBackground = true;

        UpdateMarqueeInfo();
        marqueeText.Text = currentMarqueeText;
        StartMarquee();
    }
    public void ExecuteMarqueeUpdate()
    {
        while (true)
        {
            UpdateMarqueeInfo();
            Thread.Sleep(60000);
        }

    private string currentMarqueeText;

    public void UpdateMarqueeInfo()
    {
        Random r = new Random();
        int i = r.Next(5, 8);
        string s = "";
        for(int x = 0; x < i; x++)
        {
            s += "Is it possible to create a marquee or scrolling text in WPF? ";
        }
        currentMarqueeText = s;
    }

    public void StartMarquee()
    {
        var canvas = (Canvas)marqueeText.Parent;
        if (marqueeText.ActualWidth < canvas.ActualWidth) return;
        var duration = new Duration(TimeSpan.FromSeconds(marqueeText.ActualWidth / 60));
        var animation = new DoubleAnimation(canvas.ActualWidth, -marqueeText.ActualWidth, duration);
        Storyboard.SetTargetName(animation, "rtTTransform");
        Storyboard.SetTargetProperty(animation, new PropertyPath(TranslateTransform.XProperty));
        animation.Completed += OnMarqueeScrollComplete;

        storyboard.Children.Clear();
        storyboard.Children.Add(animation);
        storyboard.Begin(marqueeText);
    }

    private void OnMarqueeScrollComplete(object sender, EventArgs e)
    {
        if (!Updater.IsAlive)
        {
            Updater.Start();
        }

        // Stop the running animation then reset the text.
        // The data updates via the background thread, so just pull as available.
        storyboard.Stop();
        marqueeText.Text = currentMarqueeText;

        // Restart the marquee animation.
        StartMarquee();
    } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T18:09:07.287

对故事板动画了解不多，但我可以帮助解决“调用线程无法访问此对象”。

您的问题是计时器事件在计时器线程中触发，并且为了更新 UI，您必须在 UI 线程中运行。解决此问题的最简单方法是使用[DispatcherTimer](http://msdn.microsoft.com/en-us/library/system.windows.threading.dispatchertimer.aspx)。

# javascript - IE6/7 和类名 (JS/HTML)

> ID：778195
> 
> 赞同：1
> 
> 时间：2009-04-22T16:50:04.203
> 
> 标签：javascript, html, internet-explorer, xhtml, classname

我正在尝试使用 javascript 更改元素的类。到目前为止，我正在做：

```
var link = document.getElementById("play_link");
link.className = "play_button"; 
```

***编辑****：这是替换类名的实际代码*

在 HTML 中：

```
<a href="#play_link_<%=i%>" id="play_link_<%=i%>"onclick="changeCurrentTo(<%=i%>);return false;" class="play_button"></a> 
```

在 Javascript 函数中 changeCurrentTo(id){ activatePlayButton(current_track); current_track = id; inactivatePlayButton(current_track); }

```
function inactivatePlayButton(id){
    document.getElementById("recording_"+id).style.backgroundColor="#F7F2D1";
    var link = document.getElementById("play_link_"+id);
    link.className="stop_button";
    link.onclick = function(){stopPlaying();return false;};
}

function activatePlayButton(id){
    document.getElementById("recording_"+id).style.backgroundColor="";
    var link = document.getElementById("play_link_"+id);
    link.className = "play_button";
    var temp = id;
    link.onclick = function(){changeCurrentTo(temp);return false;};
} 
```

和

```
.play_button{
    background:url(/images/small_play_button.png) no-repeat;
    width:25px;
    height:24px;
    display:block;
} 
```

老班是

```
.stop_button{
    background:url(/images/small_stop_button.png) no-repeat;
    width:25px;
    height:24px;
    display:block;
} 
```

上下文是一个音乐播放器。当您单击播放按钮（三角形）时，它会变成一个停止按钮（正方形）并替换调用的函数。

问题是类发生了变化，但在 IE6 和 7 中，新背景（此处为 /images/small_play_button.png）不会立即显示。有时它甚至根本不显示。有时它不显示，但如果我稍微摇晃鼠标，它就会显示。

它在 FF、Chrome、Opera 和 Safari 中完美运行，所以它是一个 IE 错误。我知道很难从这些信息中立即分辨出来，但如果我能得到一些有用的指示和方向的话。

谢谢-

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T18:42:45.697

您应该创建*一个*宽度`50px`和高度为 的图像`24px`，您同时拥有播放部分和停止部分。然后你只需像这样调整背景位置：

```
 .button
{
    background-image: url(/images/small_buttons.png);
    bacground-repeat: no-repeat;
    width: 25px;
    height: 24px;
    display: block;
}

.play_button
{
    background-position: left top;
}

.stop_button
{
    background-position: right top;
}
```

然后您同时加载“两个图像”，当您更改图像的显示部分时不会发生延迟。

请注意，我创建了一个新的 CSS 类，这样您就不需要为不同的按钮重复 CSS。您现在需要在您的元素上应用两个类。例子：

```
<div class="button play_button"></div>
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T18:57:38.077

您需要在两个功能中使用 setAttribute 。试试这个：
`link.setAttribute((document.all ? "className" : "class"), "play_button");`
`link.setAttribute((document.all ? "className" : "class"), "stop_button");`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-31T19:43:41.787

如果没有看到确切的标记，很难说，但是 IE 中消失的背景图像问题可能通过向类和/或其 parent中添加`position: relative;`声明来解决。`.button``div`

# python - smtplib 和 gmail - python 脚本问题

> ID：778202
> 
> 赞同：25
> 
> 时间：2009-04-22T16:52:17.117
> 
> 标签：python, smtp, gmail, smtplib

这是我的脚本：

```
#!/usr/bin/python

import smtplib
msg = 'Hello world.'

server = smtplib.SMTP('smtp.gmail.com',587) #port 465 or 587
server.ehlo()
server.starttls()
server.ehlo()
server.login('myname@gmail.com','mypass')
server.sendmail('myname@gmail.com','somename@somewhere.com',msg)
server.close() 
```

我只是想从我的 gmail 帐户发送一封电子邮件。由于 gmail 的要求，该脚本使用 starttls。我已经在两个网络主机上尝试过这个，1and1 和 webfaction。1and1 给了我一个“连接被拒绝”的错误，webfaction 没有报告错误，但只是不发送电子邮件。我看不出脚本有什么问题，所以我认为它可能与网络主机有关。任何想法和意见将不胜感激。

编辑：我打开了调试模式。从输出来看，它似乎成功发送了消息......我只是从未收到它。

```
send: 'ehlo web65.webfaction.com\r\n'
reply: '250-mx.google.com at your service, [174.133.21.84]\r\n'
reply: '250-SIZE 35651584\r\n'
reply: '250-8BITMIME\r\n'
reply: '250-STARTTLS\r\n'
reply: '250-ENHANCEDSTATUSCODES\r\n'
reply: '250 PIPELINING\r\n'
reply: retcode (250); Msg: mx.google.com at your service, [174.133.21.84]
SIZE 35651584
8BITMIME
STARTTLS
ENHANCEDSTATUSCODES
PIPELINING
send: 'STARTTLS\r\n'
reply: '220 2.0.0 Ready to start TLS\r\n'
reply: retcode (220); Msg: 2.0.0 Ready to start TLS
send: 'ehlo web65.webfaction.com\r\n'
reply: '250-mx.google.com at your service, [174.133.21.84]\r\n'
reply: '250-SIZE 35651584\r\n'
reply: '250-8BITMIME\r\n'
reply: '250-AUTH LOGIN PLAIN\r\n'
reply: '250-ENHANCEDSTATUSCODES\r\n'
reply: '250 PIPELINING\r\n'
reply: retcode (250); Msg: mx.google.com at your service, [174.133.21.84]
SIZE 35651584
8BITMIME
AUTH LOGIN PLAIN
ENHANCEDSTATUSCODES
PIPELINING
send: 'AUTH PLAIN *****\r\n'
reply: '235 2.7.0 Accepted\r\n'
reply: retcode (235); Msg: 2.7.0 Accepted
send: 'mail FROM:<myname@gmail.com> size=12\r\n'
reply: '250 2.1.0 OK 4sm652580yxq.48\r\n'
reply: retcode (250); Msg: 2.1.0 OK 4sm652580yxq.48
send: 'rcpt TO:<myname@gmail.com>\r\n'
reply: '250 2.1.5 OK 4sm652580yxq.48\r\n'
reply: retcode (250); Msg: 2.1.5 OK 4sm652580yxq.48
send: 'data\r\n'
reply: '354  Go ahead 4sm652580yxq.48\r\n'
reply: retcode (354); Msg: Go ahead 4sm652580yxq.48
data: (354, 'Go ahead 4sm652580yxq.48')
send: 'Hello world.\r\n.\r\n'
reply: '250 2.0.0 OK 1240421143 4sm652580yxq.48\r\n'
reply: retcode (250); Msg: 2.0.0 OK 1240421143 4sm652580yxq.48
data: (250, '2.0.0 OK 1240421143 4sm652580yxq.48') 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2015-04-18T17:18:18.523

这里有些自我推销，但我觉得有道理。

从字面上看，您只需要此代码即可完全按照您的编写：

```
import yagmail
yag = yagmail.SMTP('myname@gmail.com')
yag.send('somename@somewhere.com', subject = None, contents = 'Hello') 
```

或者一个班轮：

```
yagmail.SMTP('myname@gmail.com').send('somename@somewhere.com', None, 'Hello world.') 
```

好的是我建议使用密钥环来存储您的密码，因此您永远不会有人们在您的脚本中看到您的密码的风险。

您可以通过在解释器中运行一次来​​设置它：

```
import yagmail
yagmail.register("my@gmail.com", "mypassword") 
```

并退出。然后你可以使用：

```
import yagmail
yagmail.SMTP("my@gmail.com") # without password 
```

如果您在主目录中添加带有“my@gmail.com”的 .yagmail，那么您可以这样做：`yagmail.SMTP()`，但现在这毫无意义。

警告：如果您认真对待发送大量消息，最好设置 OAuth2，yagmail 可以提供帮助。

```
yagmail.SMTP("my@gmail.com", oauth2_file="/path/to/save/creds.json") 
```

第一次运行时，它将引导您完成获取 OAuth2 凭据的过程并将它们存储在文件中，这样下次您就不需要对它做任何事情了。您是否怀疑有人找到了您的凭据？他们的权限有限，但您最好通过 gmail 使他们的凭据无效。

对于包/安装，请查看[git](https://github.com/kootenpv/yagmail)或[readthedocs](https://yagmail.readthedocs.io)，可用于 Python 2 和 3。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-23T06:33:55.470

您是否尝试过构建有效的消息？

```
from email.MIMEText import MIMEText

msg = MIMEText('body')
msg['Subject'] = 'subject'
msg['From'] = "..."
msg['Reply-to'] = "..."
msg['To'] = "..." 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2015-03-11T15:28:33.833

我不知道 OP 是否仍然关心这个答案，但是发现自己在这里努力解决类似问题，希望其他人可能会觉得这很有用。事实证明，谷歌已经改变了他们允许使用 SMTP 服务器的方式。您将需要检查几件事：

1.  您正在使用与“发件人”地址进行身份验证时相同的地址。如果我没记错的话，过去的情况是，您可以在 from 字段中放置您想要的任何内容，但出于安全目的，许多 SMTP 主机站点（包括 google）现在将其限制为已通过它们验证的地址。

2.  允许“不太安全的应用”（阅读：我们不从中产生收入的应用）访问您的帐户。为此，请登录您的帐户并在此处导航： [https ://www.google.com/settings/security/lesssecureapps](https://www.google.com/settings/security/lesssecureapps)

3.  将端口 587 与 tls 一起使用。不太清楚为什么，但我永远无法让端口 465 玩得很好。

希望这可以帮助其他人。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-22T16:57:05.340

我认为 GMail SMTP 服务器对您连接的 IP 地址进行反向 DNS 查找，如果找不到域，则拒绝连接。这是为了避免垃圾邮件发送者将他们的 SMTP 服务器用作开放中继。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2011-06-02T17:07:34.547

省去一些头痛并使用它：

[http://mynthon.net/howto/-/python/python%20-%20logging.SMTPHandler-how-to-use-gmail-smtp-server.txt](http://mynthon.net/howto/-/python/python%20-%20logging.SMTPHandler-how-to-use-gmail-smtp-server.txt)

[Python SMTPHandler 与 GMail](http://mynthon.net/howto/-/python/python%20-%20logging.SMTPHandler-how-to-use-gmail-smtp-server.txt)

不锈钢

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-08-17T12:12:20.283

您需要检查 GMail 中的“已发送”文件夹，因为从您的帐户发送到您的帐户的邮件很可能会出现在该文件夹中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2014-06-23T05:18:00.297

我去了上面提到的链接，有 3 个不同的地址要发送到，但我收到了三封相同地址的电子邮件，那是 #3 地址。

[http://mynthon.net/howto/-/python/python%20-%20logging.SMTPHandler-how-to-use-gmail-smtp-server.txt](http://mynthon.net/howto/-/python/python%20-%20logging.SMTPHandler-how-to-use-gmail-smtp-server.txt)

```
import logging
import logging.handlers

class TlsSMTPHandler(logging.handlers.SMTPHandler):
def emit(self, record):
    """
    Emit a record.

    Format the record and send it to the specified addressees.
    """
    try:
        import smtplib
        import string # for tls add this line
        try:
            from email.utils import formatdate
        except ImportError:
            formatdate = self.date_time
        port = self.mailport
        if not port:
            port = smtplib.SMTP_PORT
        smtp = smtplib.SMTP(self.mailhost, port)
        msg = self.format(record)
        msg = "From: %s\r\nTo: %s\r\nSubject: %s\r\nDate: %s\r\n\r\n%s" % (
                        self.fromaddr,
                        string.join(self.toaddrs, ","),
                        self.getSubject(record),
                        formatdate(), msg)
        if self.username:
            smtp.ehlo() # for tls add this line
            smtp.starttls() # for tls add this line
            smtp.ehlo() # for tls add this line
            smtp.login(self.username, self.password)
        smtp.sendmail(self.fromaddr, self.toaddrs, msg)
        smtp.quit()
    except (KeyboardInterrupt, SystemExit):
        raise
    except:
        self.handleError(record)

logger = logging.getLogger()

gm = TlsSMTPHandler(("smtp.gmail.com", 587), 'myusername@gmail.com', ['address1@gmail.com', 'address2@gmail.com', 'address3@gmail.com'], 'unable to find Error!', ('myusername@gmail.com', 'mypassword'))
gm.setLevel(logging.ERROR)

logger.addHandler(gm)

try:
    1/0
except:
    logger.exception('It NO work for me!!-') 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2018-08-15T17:49:30.947

其作品

```
'''
Created on 2017/11/27

@author: devuser
'''

import smtplib
from email.mime.text import MIMEText
from email.utils import formatdate

FROM_ADDRESS = 'sender@gmail.com'
MY_PASSWORD = 'password'
TO_ADDRESS = 'receiver@test.co.jp'
BCC = 'receiver2@test.net'
SUBJECT = 'GmailのSMTPサーバ経由'
BODY = 'pythonでメール送信'

def create_message(from_addr, to_addr, bcc_addrs, subject, body):
    msg = MIMEText(body)
    msg['Subject'] = subject
    msg['From'] = from_addr
    msg['To'] = to_addr
    msg['Bcc'] = bcc_addrs
    msg['Date'] = formatdate()
    return msg

def send(from_addr, to_addrs, msg):
    smtpobj = smtplib.SMTP('smtp.gmail.com', 587)
    smtpobj.ehlo()
    smtpobj.starttls()
    smtpobj.ehlo()
    smtpobj.login(FROM_ADDRESS, MY_PASSWORD)
    smtpobj.sendmail(from_addr, to_addrs, msg.as_string())
    smtpobj.close()

if __name__ == '__main__':

    to_addr = TO_ADDRESS
    subject = SUBJECT
    body = BODY

    msg = create_message(FROM_ADDRESS, to_addr, BCC, subject, body)
    send(FROM_ADDRESS, to_addr, msg) 
```

[https://qiita.com/okhrn/items/630a87ce1a44778bbeb1](https://qiita.com/okhrn/items/630a87ce1a44778bbeb1)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2021-02-07T01:36:49.010

我遇到了同样的问题，但在尝试了上述所有建议后，关闭 VPN 有所帮助。

# rest - REST API 是否有任何命名约定准则？

> ID：778203
> 
> 赞同：217
> 
> 时间：2009-04-22T16:52:39.050
> 
> 标签：rest, naming-conventions

在创建 REST API 时，API 内的命名约定是否有任何指南或事实上的标准（例如：URL 端点路径组件、查询字符串参数）？骆驼帽是常态还是下划线？其他的？

例如：

```
api.service.com/helloWorld/userId/x 
```

或者

```
api.service.com/hello_world/user_id/x 
```

注意：这不是 RESTful API 设计的问题，而是用于最终路径组件和/或使用的查询字符串参数的命名约定准则。

任何指导方针将不胜感激。

* * *

## 回答 #1

> 赞同：160
> 
> 时间：2009-04-24T13:15:38.963

我认为你应该避免戴骆驼帽。规范是使用小写字母。我也会避免使用下划线，而是使用破折号

所以你的网址应该是这样的（忽略你要求的设计问题:-)）

```
api.service.com/hello-world/user-id/x 
```

* * *

## 回答 #2

> 赞同：94
> 
> 时间：2012-01-05T06:26:58.590

[Dropbox](https://www.dropbox.com/developers-v1/core/docs)、[Twitter](https://dev.twitter.com/rest/public)、[Google Web Services](https://developers.google.com/maps/web-services/overview)和[Facebook](https://developers.facebook.com/docs/graph-api/reference/)的 REST API都使用下划线。

* * *

## 回答 #3

> 赞同：86
> 
> 时间：2009-04-22T17:24:49.300

仔细查看普通 Web 资源的 URI。这些是你的模板。想想目录树；使用简单的类似 Linux 的文件和目录名称。

`HelloWorld`不是一个非常好的资源类别。它似乎不是一个“东西”。它可能是，但它不是很像名词。A`greeting`是一个东西。

`user-id`可能是您要获取的名词。但是，您的请求结果是否只是一个 user_id 是值得怀疑的。请求的结果更有可能是用户。因此，`user`您要获取的名词是

```
www.example.com/greeting/user/x/ 
```

我感觉合理。专注于使您的 REST 请求成为一种名词短语——通过层次结构（或分类法或目录）的路径。尽可能使用最简单的名词，尽可能避免使用名词短语。

通常，复合名词短语通常意味着层次结构中的另一个步骤。所以你没有`/hello-world/user/`and `/hello-universe/user/`。你有`/hello/world/user/`和`hello/universe/user/`。或者可能`/world/hello/user/`和`/universe/hello/user/`。

关键是提供资源之间的导航路径。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2012-06-23T14:42:13.873

'UserId' 是完全错误的方法。动词（HTTP 方法）和名词方法是[Roy Fielding](http://en.wikipedia.org/wiki/Roy_Fielding)对[REST 架构的](http://www.ics.uci.edu/~fielding/pubs/dissertation/rest_arch_style.htm)意义所在。名词是：

1.  东西的*集合*
2.  一*件事*

一种好的命名约定是：

```
[POST or Create](To the *collection*)
sub.domain.tld/class_name.{media_type} 

[GET or Read](of *one* thing)
sub.domain.tld/class_name/id_value.{media_type}

[PUT or Update](of *one* thing)
sub.domain.tld/class_name/id_value.{media_type}

[DELETE](of *one* thing)
sub.domain.tld/class_name/id_value.{media_type}

[GET or Search](of a *collection*, FRIENDLY URL)
sub.domain.tld/class_name.{media_type}/{var}/{value}/{more-var-value-pairs}

[GET or Search](of a *collection*, Normal URL)
sub.domain.tld/class_name.{media_type}?var=value&more-var-value-pairs 
```

其中 {media_type} 是以下之一：json、xml、rss、pdf、png，甚至 html。

可以通过在末尾添加“s”来区分集合，例如：

```
'users.json' *collection of things*
'user/id_value.json' *single thing* 
```

但这意味着你必须跟踪你在哪里放了“s”，在哪里没有。再加上地球上一半的人（初学者是亚洲人）说的语言没有明确的复数形式，因此 URL 对他们不太友好。

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2009-07-20T22:31:07.163

不，REST 与 URI 命名约定无关。如果你将这些约定作为 API 的一部分，带外地，而不是仅仅通过超文本，那么你的 API 就不是 RESTful 的。

有关详细信息，请参阅[http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven](http://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven)

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-08-03T18:14:29.107

域名不区分大小写，但 URI 的其余部分当然可以。假设 URI 不区分大小写是一个很大的错误。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2012-10-05T09:27:57.907

我在[http://soaprobe.blogspot.co.uk/2012/10/soa-rest-service-naming-guideline.html](http://soaprobe.blogspot.co.uk/2012/10/soa-rest-service-naming-guideline.html)有一个我们在产品中使用的指南列表。指导方针总是有争议的......我认为一致性有时比让事情变得完美更重要（如果有这样的话）。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-22T16:55:42.163

我不认为骆驼案例是该示例中的问题，但我认为上述示例的更 RESTful 命名约定将是：

api.service.com/helloWorld/userId/x

而不是让 userId 成为查询参数（这是完全合法的），我的示例表示 IMO 中的资源是一种更 RESTful 的方式。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-06-07T19:02:43.683

如果您使用 Oauth2 对您的客户端进行身份验证，我认为您的至少两个参数名称需要下划线：

*   client_id
*   client_secret

我在我的（尚未发布的）REST API 中使用了 camelCase。在编写 API 文档时，我一直在考虑将所有内容都更改为 snake_case，因此我不必解释为什么 Oauth 参数是 snake_case 而其他参数不是。

见：[https ://www.rfc-editor.org/rfc/rfc6749](https://www.rfc-editor.org/rfc/rfc6749)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-22T17:01:03.757

我会说最好在 REST URL 中使用尽可能少的特殊字符。REST 的好处之一是它使服务的“界面”易于阅读。Camel 大小写或 Pascal 大小写可能适合资源名称（用户或用户）。我认为 REST 并没有真正的硬标准。

另外，我认为 Gandalf 是对的，在 REST 中不使用查询字符串参数通常更简洁，而是创建定义您要处理的资源的路径。

[http://api.example.com/HelloWorld/Users/12345/Order/3/etc](http://api.example.com/HelloWorld/Users/12345/Order/3/etc)

# jquery - jQuery fadeIn 在 IE7 中使文本不消除锯齿

> ID：778208
> 
> 赞同：20
> 
> 时间：2009-04-22T16:54:08.030
> 
> 标签：jquery, internet-explorer

为什么会这样？任何解决方法？

jQuery：

```
$（函数（）{
   $('p.quote').fadeIn(3000);
});

```

HTML：

```
<p>有人说：</p>
<p class="quote">“lorem ipsum”</p>
<p>别人说：</p>
<p class="quote" style="display: none;">“大宪章”</p>

```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-22T16:58:26.243

IE 和fadeIn/fadeOut 函数及其对文本元素的影响存在一个已知错误。在这里查看信息：

~~[http://blog.bmn.name/2008/03/jquery-fadeinfadeout-ie-cleartype-glitch/](http://blog.bmn.name/2008/03/jquery-fadeinfadeout-ie-cleartype-glitch/)~~

看起来我的原始链接已经死了。更新了与​​评论不同的解决方案：

[http://malsup.com/jquery/cycle/cleartype.html](http://malsup.com/jquery/cycle/cleartype.html)

解决方法是在fadeIn() 完成后在回调函数中删除元素的'filter' 属性。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-11-12T01:01:39.627

[我在http://jquery.malsup.com/fadetest.html](http://jquery.malsup.com/fadetest.html)找到了一个更好、更通用的解决方案。

我已将其改编为一个独立的 JavaScript 文件，以包含在使用 jQuery fade*() 方法的页面中。

```
//
//  jQuery IE Fade Fix
//
//  Adapted from code found at http://jquery.malsup.com/fadetest.html.
//
//  This is only needed for IE 7 and earlier, so this is best added to your page using IE's conditional comments
//  (http://msdn.microsoft.com/en-us/library/ms537512%28VS.85%29.aspx) as follows:
//      <!--[if lt IE 8]><script type="text/javascript" src="jquery-ie-fade-fix.js"></script><![endif]-->
//
(function($) {
    $.fn.fadeIn = function(speed, callback) {
        if ($.isFunction(speed) && callback == undefined) {
            callback = speed;
            speed = 'normal';
        }
        return this.animate({opacity: 'show'}, speed, function() {
            if ( $.browser.msie )
            {
                this.style.removeAttribute('filter');
            }
            if ( $.isFunction(callback) )
            {
                callback.call(this);
            }
        });
    };

    $.fn.fadeOut = function(speed, callback) {
        if ($.isFunction(speed) && callback == undefined) {
            callback = speed;
            speed = 'normal';
        }
        return this.animate({opacity: 'hide'}, speed, function() {
            if ( $.browser.msie )
            {
                this.style.removeAttribute('filter');
            }
            if ( $.isFunction(callback) )
            {
                callback.call(this);
            }
        });
    };

    $.fn.fadeTo = function(speed, to, callback) {
        if ($.isFunction(speed) && callback == undefined) {
            callback = speed;
            speed = 'normal';
        }
        return this.animate({opacity: to}, speed, function() {
            if ( to == 1 && $.browser.msie )
            {
                this.style.removeAttribute('filter');
            }
            if ( $.isFunction(callback) )
                {
                callback.call(this);
            }
        });
    };
})(jQuery); 
```

**编辑：**合并[joeformd](https://stackoverflow.com/users/54221/joeformd)对回调的修复。

**EDIT2：**为未定义速度但回调为 -Tomi 的极端情况添加了修复

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-22T16:58:52.357

据我记得，设置的过滤器属性会导致这种情况。在你的 fadeIn 完成后，从元素中删除 filter 属性。

```
$('p.quote').fadeIn(2000, removeFilter);

function removeFilter() {
  $('p.quote').removeAttr("filter");
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-12-09T22:27:22.150

只需将背景颜色应用于您正在褪色的确切元素..据我所知，如果您应用于父母，它将不适用于儿童，所以它必须在这个被别名的元素上。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-11-11T23:30:17.333

看起来接受的答案现在有一个死链接。我认为现在可以在[http://blog.wolffmyren.com/2009/05/28/jquery-fadeinfadeout-ie-cleartype-glitch/](http://blog.wolffmyren.com/2009/05/28/jquery-fadeinfadeout-ie-cleartype-glitch/)获得相同的信息。

为了保留 StackOverflow 中的信息，以下是该链接的内容：

> 感谢 Benjamin Michael Novakovic 的修复！
> 
> jQuery 淡入/淡出 IE cleartype 故障
> 
> 今天在工作中使用 jQuery javascript 库时，我注意到 IE7 下的一个小故障。在 jQuery 中使用 .fadeIn() 和 .fadeOut() 函数淡化 html 节点时，IE 会丢弃 windows Cleartype 渲染；这导致非常难看的文本。这个问题似乎很常见，但没有人能很好地解决这个问题。
> 
> 解决此问题的最常见方法是删除 filter CSS 属性。在普通的 javascript 中，它看起来像这样：
> 
> ```
> document.getElementById('node').style.removeAttribute('filter'); 
> ```
> 
> 在 jQuery 中，它看起来像这样：
> 
> ```
> $('#node').fadeOut('slow', function() {
>    this.style.removeAttribute('filter');
> }); 
> ```
> 
> 通过 Benjamin Michael Novakovic » jQuery fadeIn/fadeOut IE cleartype 故障。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-04-18T10:09:39.710

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> 
```

将此添加到您的 html 文档之上。它适用于 IE 8.07xxxx。我不确定这种技术是否适用于 IE 7。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-07-05T14:52:25.963

将此添加到您的 JS 中。它修复了错误并维护了正确的范围。添加到 jQuery 时，它仍然通过所有单元测试：

```
(function($){
    $.each(['fadeIn', 'fadeOut'], function(i, method){
        var _fn = $.fn[method];
        $.fn[method] = function(easing, callbackå, cancel) {
            if ($.isFunction(easing)) {
                callback = easing;
                easing = 'normal';
            }
            return _fn.call(this, easing, function(){
                jQuery.browser.msie && !cancel && this.style.removeAttribute('filter');
                (callback || $.noop).call(this);
            });
        }
    })
})(jQuery); 
```

我写的：）

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2011-08-25T20:56:47.847

这就是我在 IE 8 上摆脱丑陋的褪色文本的方法：改用`fadeTo`它并将其提升到 99%！

因此这对我有用：

```
$(function() {
   $('p.quote').fadeTo("slow",0.99);
}) 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-01-13T10:39:55.123

这些解决方案都不适合我使用 jQuery 的动画淡入 div，因为过滤器位于样式元素中。因此，我需要做的是：

```
$(div).animate({opacity: 1}, 800, function() {
   $(this).removeAttr('style');
}); 
```

显然，这将删除您可能拥有的任何其他内联样式。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-05-19T13:35:06.313

这些解决方案都不适合我，否则它们不适合，例如，我不想只为一个 IE 错误更改我的 HTML5 DTD 声明，并且我不能更改我的背景颜色，因为它正在用于另一个动画。

我也在使用 jQuery `.animate`，所以这可能有点离题，但完美运行的解决方案是[这个](http://coilmedia.com/post/2010/jquery-text-loses-antialiasing-when-animating-css-opacity-in-internet-explorer/)。这是一篇好文章，但核心代码是：

```
$('#sample').animate(
    {opacity:1.0},
    500,
    function() {
        $(this).css('filter','');
    }
); 
```

# tuples - 域和元组关系演算

> ID：778209
> 
> 赞同：3
> 
> 时间：2009-04-22T16:54:48.543
> 
> 标签：tuples, tuple-relational-calculus

以上两者之间有“真正的”区别吗？除了它们的语法之间最微小的差异之外？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-09-28T02:41:09.600

面向元组的演算使用元组变量，即，其唯一允许值是该关系的元组的变量。例如 QUEL 面向域的微积分具有域变量，即，范围在基础域而不是关系之上的变量。例如，ILL、DEDUCE....面向元组的演算使用元组变量，即，其唯一允许值是该关系的元组的变量。乙

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-03-17T13:29:39.007

两者在概念上有很大的区别。在元组关系演算的情况下，您对每个元组进行操作，但在域关系演算的情况下，您处理每个列或属性。这两种方法都可以用来获得任何结果。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T17:26:15.037

据我回忆，它们同样具有表达能力——也就是说，任何可以使用域关系代数表达的东西也可以使用元组关系演算来表达。有些人发现 DRA 更容易解释......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-30T14:20:00.447

域演算与元组演算的不同之处在于公式中使用的变量类型：

变量的范围不是元组，而是来自属性域的单个值。要为查询结果形成 n 次关系，我们必须有 n 个这些域变量——每个属性一个。

# wix - WiX - 试图找出安装顺序

> ID：778210
> 
> 赞同：5
> 
> 时间：2009-04-22T16:55:13.647
> 
> 标签：wix, windows-installer, install-sequence

我正在安装一个大型应用程序，其中一部分是一个名为“DbUpdateManager”的自定义编写工具，用于针对我们的目标数据库批量执行 SQL 脚本。

现在，WiX 2.x 安装工作正常——但它有一个缺陷：在安装过程中，我还安装了几个 Windows 服务，可以选择立即启动。但是，如果 DbUpdateManager 尚未运行，这些将失败。

所以我想要完成的是：

1.  从我的 MSI 安装 DbUpdateManager 和我的服务
2.  在任何服务启动*之前*运行 DbUpdateManager

我当前的 WiX 源代码如下所示：

```
<Directory Id='INSTALLDIR' Name='DbUpdMgr' LongName='DbUpdateManager' >
  <!-- DbUpdateManager component with the necessary files -->
  <Component Id='DbUpdateManagerComponent' Guid='...' DiskId='1'>
     <File Id='DbUpdateManagerFile' LongName='DbUpdateManager.Wizard.exe' 
           Name='DbUmWz.exe' src='DbUpdateManager.Wizard.exe'  KeyPath='no' />
  </Component>

  <!-- Component to install one of my Windows services -->
  <Component Id='InstallServiceComponent' Guid='...' DiskId='1'>
     <File Id='InstallServiceFile' LongName='MyService.exe' 
           Name='MyServic.exe' src='MyService.exe' KeyPath='yes'/>
     <ServiceInstall Id='InstallMyService' Name='MyService' 
                     Description='My Service' ErrorControl='normal' 
                     Start='auto' Type='ownProcess' Vital='yes' />
     <ServiceControl Id='UninstallMyService' Name='MyService' 
                     Remove='uninstall' Wait='yes' />
  </Component>

  <!-- Feature for the DbUpdateManager referencing the above component -->    
  <Feature Id='DbUpdateManager' ConfigurableDirectory='INSTALLDIR' 
           AllowAdvertise='no' Description='DbUpdateManager' Level='1' 
           Title='Database Update Manager'>
     <ComponentRef Id='DbUpdateManagerComponent'/>
  </Feature>

  <!-- Custom action for running DbUpdateManager -->    
  <CustomAction Id='RunDbUpdateManagerAction' FileKey='DbUpdateManagerFile' 
                ExeCommand='' Return='asyncWait' />

  <!-- Calling the custom action in the install sequence -->    
  <InstallExecuteSequence>
      <RemoveExistingProducts After='InstallInitialize' />
      <Custom Action='RunDbUpdateManagerAction' 
              After='InstallFinalize'>&amp;DbUpdateManager=3</Custom> 
```

我继承了这个 WIX，它可以工作 - 但正如我所说 - DbUpdateManager 在过程中被调用得太晚（只有“After = InstallFinalize”），因此服务一开始将无法正常启动（第二次运行正常在 DbUpdateManager 运行后手动重新启动它们时左右）。

我浏览了一下 MSI 文档，发现了一个名为“StartServices”的好步骤，所以我的直觉是将调用自定义操作更改为：

```
 <InstallExecuteSequence>
          <Custom Action='RunDbUpdateManagerAction' 
                  Before='StartServices'>&amp;DbUpdateManager=3</Custom> 
```

不幸的是，在这种情况下，什么都没有发生 - DbUpdateManager 永远不会被调用....

任何想法为什么？调试 MSI/WiX 的东西真的很棘手，而且我似乎再也见不到森林了......

谢谢！马克

编辑：“RunDbUpdateManagerAction”放置在我的 MSI 的 InstallExecuteSequence 表中的正确位置 - 就在 InstallServices 之后和 StartServices 之前 - 但它不起作用.... DbUpdateManager（一个 Winforms 实用程序）在期间*不*显示安装 ：-（

编辑 2：现在我的操作似乎在正确的时间执行了 - 不幸的是，我只是没有看到我的向导 :-( 我看到的是错误代码“返回值 1631”，这意味着类似于“MSI 服务”无法启动” - wtf ???

MSI (s) (2C:D8) [20:53:36:383]：执行操作：RunDbUpdateManagerAction 操作 20:53:36：RunDbUpdateManagerAction。操作于 20:53:36 开始：RunDbUpdateManagerAction。MSI (s) (2C:D8) [20:53:36:383]：执行操作：StartServices 操作 20:53:36：StartServices。服务正在启动 操作于 20:53:36 开始：StartServices。操作于 20:53:36 完成：RunDbUpdateManagerAction。返回值 1631。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-23T19:36:10.867

好吧，我终于让它工作了——在每个回复的人的帮助下，并通过咨询一些 WiX 教程和网络上的帮助页面。MSI 安装程序的东西不容易弄清楚和学习......

基本上，我将自定义操作的执行更改为“延迟”（如 Rob 建议的那样），并将执行顺序中的点移至“After=InstallFiles”。我还将 <Custom> 标记中的条件更改为“未安装”，这在我的场景中似乎工作得很好。

与 Rob 的担心相反，Db 更新管理器及其 UI 以这种方式呈现得非常好，并且更新我们的数据库的过程现在在我们的任何服务（依赖于数据库）开始之前完成。

期待 WiX 3.0（及其未来）的完整 RTM 版本！

感谢所有人——不幸的是，我只能接受一个答案——所有人都是应得的。

马克

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-23T04:39:38.727

您的 CustomAction 似乎取决于正在安装的“DbUpdateManagerFile”。这意味着您的 CustomAction 需要在InstallFiles 执行*后安排。*请记住，InstallExecuteSequence 有两次传递。首先，执行“立即”（或“预定”或“脚本生成”）操作以构建事务日志（又名：“安装脚本”）。其次，执行事务日志中的“延迟”操作。

现在您的 CustomAction 是“立即的”（默认值），因此它会在文件实际复制到机器*之前尝试运行。*InstallFiles 操作位于 CustomAction 之前的脚本中，但尚未执行。

因此，您需要将您的 CustomAction 标记为“延迟”，以使其在安装文件*后运行。*

注意：您可能无法显示延迟 CA 的 UI。我不确定你的这个工具是否应该显示 UI。

PS：对不起，如果我没有解释清楚，这是漫长的一天。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-22T17:34:30.603

尝试获取安装的日志文件，并在其中查找序列顺序和执行自定义操作的条件值

在命令行中使用：msiexec /i [msiname] /l*v [filename]

编辑：阅读您的评论后，请查看此页面[，](http://msdn.microsoft.com/en-us/library/aa368561(VS.85).aspx)您可以尝试在条件中添加未安装

EDIT2：我找到了这个[页面](http://www.installsite.org/pages/en/bugs_msi.htm)搜索你的错误号 1631

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-22T17:03:40.287

[您可以在Orca](http://msdn.microsoft.com/en-us/library/aa370557.aspx)中打开 .msi并查看 InstallExecuteSequence 表，以了解事情实际发生的顺序。这可以让您很好地了解实际发生的时间。

# c# - 是否有一个通用系统委托接受 2 种类型并返回第二种

> ID：778216
> 
> 赞同：2
> 
> 时间：2009-04-22T16:56:22.847
> 
> 标签：c#, generics, lambda

我正在寻找像 Action 这样的东西，但我希望它是

```
delegate U ReturnAction<T,U>(T param); 
```

是否已经有系统委托？我只是不想重新发明轮子。当我第一次需要谓词然后意识到它存在时，我做了同样的事情。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-22T16:58:38.473

我想你需要

```
Func<T, TRet> 
```

它有各种重载

```
Func<TRet>
Func<T, TRet>
Func<T1, T2, TRet>
Func<T1, T2, T3, TRet> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-22T16:58:56.990

看看 Func

```
delegate TReturn Func<T1,TReturn>(T1 arg1); 
```

3.5 框架包含几个 func 的重载。定义了 0 到 4 个参数。

# model-view-controller - 在领域驱动设计中，您可以在 UI 中使用您的领域实体吗？

> ID：778218
> 
> 赞同：13
> 
> 时间：2009-04-22T16:57:01.940
> 
> 标签：model-view-controller, domain-driven-design

在许多领先的 DDD 项目中，尤其是 MVC 风格，我看到 UI 使用镜像域实体的显示对象，而不是直接使用这些域对象。这种风格显然是为了解耦和分离关注点，我个人更喜欢这种风格。

但我不确定，这是否是 DDD 的严格原则，或者这只是不同开发人员对它的解释。

您能否直接在 UI 中使用您的领域对象，并且在该行为中仍然遵循 DDD 方法？

还是始终使用显示对象是 DDD 最佳实践？

注意：虽然我提到了 MVC，但我真正感兴趣的是是否必须在 DDD 项目中几乎所有与 DDD 兼容的 UI 模式中使用显示对象。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-09-06T20:52:50.457

在我开始关注 Greg Young 和 Udi Dahan（通过 Martin Fowler）的工作之前，我并没有真正开始理解为什么或如何将域模型与表示关注点分离。

他们一直在教授一种称为[命令和查询责任分离](http://codebetter.com/blogs/gregyoung/archive/2009/08/13/command-query-separation.aspx)(CQRS) 的原则。

我对 CQRS 的解释是，有两组职责可以将领域模型拉向不同的方向，从而导致模型在这两个方面都表现平平。这两个职责是命令（即会导致写入数据库的行为）和查询（即从数据库读取以获取数据以供 UI 使用）。一个示例是向您的实体添加 getter 和 setter 以支持 UI 中的数据绑定。如果您的模型具有 getter 和 setter，它可能无法对需要以事务方式发生的状态更改或封装业务逻辑进行建模。它也无法对状态更改的业务上下文进行建模（请参阅事件溯源）。

在 DDD 术语中，您可能会说域模型和表示模型通常位于单独的有界上下文中。

CQRS 规定的解决方案是为命令创建一个模型，为查询创建另一个模型。如果您当前的模型具有更改状态的方法（即模型中的行为），以及将状态暴露给 UI 以进行数据绑定的 getter，您可以将这两个职责重构为用于命令和查询的单独模型。查询模型不会映射到您的域实体，而是直接映射到数据库。如果您的数据库没有从您的域模型中捕获派生状态，请查看名为[Eager Read Derivation](http://www.martinfowler.com/bliki/EagerReadDerivation.html)的模式。

如果您的系统只是简单的 CRUD 并且没有任何行为，请尝试使用可以根据您的数据库架构自动构建的脚手架系统，例如 ASP.NET 动态数据

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-22T17:08:31.053

如果你在做 MVC 模式，你需要视图对象；DDD 只是您的模型。这并不意味着您*必须*始终使用 MVC；例如，可以将 DDD 构建为模拟器，您所看到的只是发出的日志消息。但是在 MVC 中，你真的应该有单独的视图对象。

现在，问问自己为什么会这样？答案是*视图*可以改变，即使商业模式*不会*。DDD 模型应该用业务术语表达对业务至关重要的内容。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-22T22:18:41.713

DDD 是设计软件时的一种思维方式，它从对领域建模开始。正如[网页](http://domaindrivendesign.org/resources/what_is_ddd)所说：

> 领域驱动设计不是一种技术或方法。它是一种思维方式和一组优先级，旨在加速必须处理复杂领域的软件项目。

从这种设计模式中自然得出的一件事是分层架构。正如[DDD 模式摘要中所说](http://domaindrivendesign.org/sites/default/files/discussion/PatternSummariesUnderCreativeCommons.doc)

> 将复杂的程序划分为 LAYERS。在每个 LAYER 中开发一个具有凝聚力的设计，并且只依赖于下面的层。遵循标准架构模式为上面的层提供松散耦合。将与领域模型相关的所有代码集中在一层，并将其与用户界面、应用程序和基础设施代码隔离开来。域对象无需承担显示自身、存储自身、管理应用程序任务等的责任，可以专注于表达域模型。这允许模型发展到足够丰富和清晰，以捕获基本的业务知识并将其投入使用。

您是否需要显示对象来做到这一点？这只是实现这一点的一种方式，但可能甚至不是提供松散耦合的最佳方式。举个例子：也许视图层只是一个webbrowser和xlt文件来可视化业务层发出的xml文件？如果有人有更合适的例子，请添加它们。我的观点是 DDD 强调分层架构，但并不将其限制为一种可能的解决方案。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-22T21:54:07.997

在 MVC 设计中，您通常会有一个从 Repository -> Domain Models 到 Domain Models -> View Models 的映射。不过，视图模型通常包含领域对象。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-20T16:17:04.557

答案很直接：

*   领域对象具有面向领域的设计和方法。
*   视图对象具有面向视图/控制的设计和方法。

如果您可以在视图中使用您的领域对象，那么它们可能不是完全面向领域的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2010-08-19T12:33:11.960

Domain objects are really the internal logic inside your business logic layer. They shouldn't be directly exposed to your clients (UI layer). Instead, encapsulate the usage of your domain model into application services. The application services can utilize lightweight DTOs and/or command objects to pass data and intent between the client and the domain model.

# java - 制作一个圆形按钮

> ID：778222
> 
> 赞同：9
> 
> 时间：2009-04-22T16:57:15.950
> 
> 标签：java, swing, jbutton, rounding

我正在尝试在 (150,210) 的 (x,y) 坐标处进行 JButton 循环。我希望按钮是大小为 (40,40) 的椭圆形。并且按钮背景颜色为红色。它不需要文本，所以我应该得到一个我想要的任何大小的按钮，对吧？

我正在使用面板，并将 setLayout 设置为 null：

```
setLayout(null) 
```

我查了谷歌，它把我带到了这里。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-22T17:07:10.450

JDC 技术提示：1999 年 8 月 26 日：[创建圆形摇摆按钮](http://java.sun.com/developer/TechTips/1999/tt0826.html)

```
import java.awt.*;
import java.awt.geom.*;
import javax.swing.*;

public class RoundButton extends JButton {
  public RoundButton(String label) {
    super(label);

// These statements enlarge the button so that it 
// becomes a circle rather than an oval.
    Dimension size = getPreferredSize();
    size.width = size.height = Math.max(size.width, 
      size.height);
    setPreferredSize(size);

// This call causes the JButton not to paint 
   // the background.
// This allows us to paint a round background.
    setContentAreaFilled(false);
  }

// Paint the round background and label.
  protected void paintComponent(Graphics g) {
    if (getModel().isArmed()) {
// You might want to make the highlight color 
   // a property of the RoundButton class.
      g.setColor(Color.lightGray);
    } else {
      g.setColor(getBackground());
    }
    g.fillOval(0, 0, getSize().width-1, 
      getSize().height-1);

// This call will paint the label and the 
   // focus rectangle.
    super.paintComponent(g);
  }

// Paint the border of the button using a simple stroke.
  protected void paintBorder(Graphics g) {
    g.setColor(getForeground());
    g.drawOval(0, 0, getSize().width-1, 
      getSize().height-1);
  }

// Hit detection.
  Shape shape;
  public boolean contains(int x, int y) {
// If the button has changed size, 
   // make a new shape object.
    if (shape == null || 
      !shape.getBounds().equals(getBounds())) {
      shape = new Ellipse2D.Float(0, 0, 
        getWidth(), getHeight());
    }
    return shape.contains(x, y);
  }

// Test routine.
  public static void main(String[] args) {
// Create a button with the label "Jackpot".
    JButton button = new RoundButton("Jackpot");
    button.setBackground(Color.green);

// Create a frame in which to show the button.
    JFrame frame = new JFrame();
    frame.getContentPane().setBackground(Color.yellow);
    frame.getContentPane().add(button);
    frame.getContentPane().setLayout(new FlowLayout());
    frame.setSize(150, 150);
    frame.setVisible(true);
  }
} 
```

# sql-server - MSSQL JOIN ON GROUP BY 太慢了

> ID：778237
> 
> 赞同：2
> 
> 时间：2009-04-22T16:59:33.883
> 
> 标签：sql-server, database, optimization, join, subquery

我在 MSSQL 中有以下查询

```
SELECT TOP 50 CustomerID FROM Ratings
WHERE CustomerID != 915
AND MovieID IN (SELECT DISTINCT MovieID FROM Ratings WHERE CustomerID = 915)
GROUP BY CustomerID
ORDER BY count(*) DESC 
```

它超级快。当我尝试在这样的子查询中使用它时。

```
SELECT * FROM Ratings
WHERE MovieID = 1 AND
CustomerID IN (SELECT TOP 50 CustomerID FROM Ratings
    WHERE CustomerID != 915
    AND MovieID IN (SELECT DISTINCT MovieID FROM Ratings WHERE CustomerID = 915)
    GROUP BY CustomerID
    ORDER BY count(*) DESC) 
```

关于为什么这么慢以及如何加快速度的任何想法？我的主键是 (MovieID-CustomerID) 我在 CustomerID 上添加了一个索引

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T17:08:16.110

您需要（按此顺序）创建一个额外的`UNIQUE`索引以改进此查询。`(CustomerID, MovieID)`

有关性能详细信息，请参阅我博客中的文章：

*   [**分级电影**](http://explainextended.com/2009/04/30/rating-movies/)

由于您的子查询返回`UNIQUE`值集，因此查询可以重写为`JOIN`：

```
SELECT  r2.*
FROM    (
        SELECT  TOP 50 CustomerID
        FROM    (
                SELECT  MovieID
                FROM    Ratings
                WHERE   CustomerID = 915
                ) q
        JOIN    Ratings r
        ON      r.MovieID = q.MovieID
                AND CustomerID <> 915
        GROUP BY
                CustomerID
        ORDER BY
                COUNT(*) DESC
        ) ro
JOIN    Ratings r2
ON      r2.MovieID = 1
        AND r2.CustomerID = ro.CustomerID 
```

要选择`TOP 50`已评分的客户`Movie 1`，请使用：

```
SELECT  r2.*
FROM    (
        SELECT  TOP 50 CustomerID
        FROM    (
                SELECT  MovieID
                FROM    Ratings
                WHERE   CustomerID = 915
                ) q
        JOIN    Ratings r
        ON      r.MovieID = q.MovieID
                AND CustomerID <> 915
                AND EXISTS
                (
                SELECT  1
                FROM    Ratings re
                WHERE   re.MovieID = 1
                        AND re.CustomerID = r.CustomerID
                )
        GROUP BY
                CustomerID
        ORDER BY
                COUNT(*) DESC
        ) ro
JOIN    Ratings r2
ON      r2.MovieID = 1
        AND r2.CustomerID = ro.CustomerID 
```

# sql - MySQL 子查询返回多于一行

> ID：778239
> 
> 赞同：18
> 
> 时间：2009-04-22T16:59:46.677
> 
> 标签：sql, mysql

我正在执行这个查询：

```
SELECT
    voterfile_county.Name,
    voterfile_precienct.PREC_ID,
    voterfile_precienct.Name,
    COUNT((SELECT voterfile_voter.ID
FROM voterfile_voter
JOIN voterfile_household
WHERE voterfile_voter.House_ID = voterfile_household.ID
AND voterfile_household.Precnum = voterfile_precienct.PREC_ID)) AS Voters
FROM voterfile_precienct JOIN voterfile_county
WHERE voterfile_precienct.County_ID = voterfile_County.ID; 
```

我试图让它返回这样的东西：

```
County_Name   Prec_ID   Prec_Name   Voters(Count of # of voters in that precienct) 
```

但是，我收到错误：

> #1242 - 子查询返回超过 1 行。

我尝试将`COUNT`语句放在子查询中，但出现无效的语法错误。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2010-08-06T12:39:30.113

如果您收到错误：错误号 1242 子查询返回多行，请尝试将 ANY 放在您的子查询之前。例如：

此查询返回错误：

```
SELECT * FROM t1 WHERE column1 = (SELECT column1 FROM t2); 
```

这是一个很好的查询：

```
SELECT * FROM t1 WHERE column1 = ANY (SELECT column1 FROM t2); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-22T18:35:10.097

您可以在没有子查询的情况下尝试它，通过一个简单的分组：

```
SELECT voterfile_county.Name, 
  voterfile_precienct.PREC_ID, 
  voterfile_precienct.Name, 
  count(voterfile_voter.ID)
FROM voterfile_county
JOIN voterfile_precienct 
  ON voterfile_precienct.County_ID = voterfile_County.ID
JOIN voterfile_household 
  ON voterfile_household.Precnum = voterfile_precienct.PREC_ID
JOIN voterfile_voter 
  ON voterfile_voter.House_ID = voterfile_household.ID 
GROUP BY voterfile_county.Name, 
  voterfile_precienct.PREC_ID, 
  voterfile_precienct.Name 
```

当您使用 GROUP BY 时，您未分组的任何列都必须有一个聚合子句（fe SUM 或 COUNT。）因此在这种情况下，您必须根据县名、precienct.id 和 precient.name 进行分组。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-22T17:03:51.457

试试这个

```
SELECT
voterfile_county.Name, voterfile_precienct.PREC_ID, 
voterfile_precienct.Name,
    (SELECT COUNT(voterfile_voter.ID) 
    FROM voterfile_voter JOIN voterfile_household
    WHERE voterfile_voter.House_ID = voterfile_household.ID
      AND voterfile_household.Precnum = voterfile_precienct.PREC_ID) as Voters
FROM voterfile_precienct JOIN voterfile_county 
ON voterfile_precienct.County_ID = voterfile_County.ID 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-05-18T07:55:30.480

请参阅以下示例并相应地修改您的查询。

```
select COUNT(ResultTPLAlias.id) from 
(select id from Table_name where .... ) ResultTPLAlias; 
```

# c# - 映射处理程序 url 的 IIS 7 默认文档设置

> ID：778240
> 
> 赞同：1
> 
> 时间：2009-04-22T17:00:10.933
> 
> 标签：c#, asp.net, httphandler

我有一个网站，从根目录只提供一个页面。该页面（称为 stuff.htm）由自定义处理程序生成，并且实际上并不存在于磁盘上。

我希望 stuff.htm 成为该站点的默认文档，但使其成为默认文档的标准配置方法失败，因为常规 ASP.Net DirectoryListingModule 正在尝试执行文件的 Server.Execute。（至少，这就是我可以推断正在发生的事情。）

我知道我可以通过 default.aspx 编写代码来满足我的需要，但我想避免为此编写代码。任何已知的配置技巧来取代默认处理程序行为而不必覆盖默认处理行为？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-24T20:35:04.227

ASP.NET 是否设置为处理您尝试提供的文件扩展名？如果是这样，我希望它能够正常工作；否则这里有一些“便宜又肮脏”的答案。

“便宜又脏”的答案是在根目录下创建一个名为 stuff.htm 的空文件，将其设置为默认页面，然后确保将 ASP.NET 映射为处理 .htm 文件扩展名（或您实际使用的任何文件扩展名）使用）。

第二个“便宜又脏”的答案是创建一个 default.htm 页面，然后将其设置为对 stuff.htm 的重定向。

# sql - ActiveRecord 模型中的复杂关联

> ID：778241
> 
> 赞同：1
> 
> 时间：2009-04-22T17:00:20.840
> 
> 标签：sql, ruby-on-rails, activerecord

我试图了解 ActiveRecord 如何处理比简单`has_many`,等更复杂的关联`belongs_to`。

例如，考虑一个用于录制音乐演出的应用程序。每个演出都有一个乐队，它有一个流派。每个 Gig 也有一个 Venue，它有一个 Region。

在 MS Access 的粗略符号中（我突然开始对它感到非常怀念），这些关系将像这样呈现

```
 1  ∞      1  ∞     ∞  1       ∞  1
Genre ---- Band ---- Gig ---- Venue ---- Region 
```

例如，我希望能够找出在某个地区演出过的所有乐队，或者拥有某种流派的所有场地。

理想情况下，我的模型将包含此代码

```
class Genre
  has_many :bands
  has_many :gigs, :through => bands
  has_many :venues, :through => :gigs, :uniq => true
  has_many :regions, :through => :venues, :uniq => true
end

class Band
  belongs_to :genre
  has_many :gigs
  has_many :venues, :through => :gigs, :uniq => true
  has_many :regions, :through => :venues, :uniq => true
end

class Gig
  belongs_to :genre, :through => :band
  belongs_to :band
  belongs_to :venue
  belongs_to :region, :through => :venue
end 
```

等等`Venue`和`Region`。

但是，似乎我必须制作类似的东西

```
class Genre
  has_many :bands
  has_many :gigs, :through => bands
  has_many :venues, :finder_sql => "SELECT DISTINCT venues.* FROM venues " +
    "INNER JOIN gigs ON venue.id = gig.venue_id " +
    "INNER JOIN bands ON band.id = gig.band_id " +
    "WHERE band.genre_id = #{id}"
  # something even yuckier for regions
end

class Band
  belongs_to :genre
  has_many :gigs
  has_many :venues, :through => :gigs, :uniq => true
  # some more sql for regions
end

class Gig
  delegate :genre, :to => :band
  belongs_to :band
  belongs_to :venue
  delegate :region, :to => :venue
end 
```

我有两个问题——一个是一般的，一个是特殊的。

一般：

我原以为我想做的事情会经常出现。我真的有最好的方法吗，还是有一些更简单的东西我忽略了？

特别之处：

我上面的内容实际上并不完全有效！第二种`#{id}`流派模型中的实际返回的是类的 id。（我认为）。然而，这似乎在[这里](http://api.rubyonrails.org/classes/ActiveRecord/Associations/ClassMethods.html#M001789)和[这里工作](https://stackoverflow.com/questions/198831/activerecord-association-question-getting-hasmany-through-to-work/198971#198971)

我意识到这是一个相当史诗般的问题，所以如果你已经走到了这一步，谢谢你。任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T18:34:14.890

关联被设计为可读**可写**。它们的很大一部分价值在于您可以执行以下操作：

```
@band.gigs << Gig.new(:venue => @venue) 
```

不过，这听起来像是您想要一些只读的东西。换句话说，你想将 Venues 和 Genres 关联起来，但你永远不会这样做：

```
@venue.genres << Genre.new("post-punk") 
```

因为这没有意义。只有当具有特定流派的乐队在那里有演出时，场地才具有流派。

关联对此不起作用，因为它们必须是可写的。这是我如何做只读关联：

```
class Genre
  has_many :bands 

  def gigs
    Gig.find(:all, :include => 'bands', 
             :conditions => ["band.genre_id = ?", self.id])
  end

  def venues 
    Venue.find(:all, :include => {:gigs => :band}, 
      :conditions => ["band.genre_id = ?", self.id])
  end
end 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T08:03:57.143

您可以将条件和参数添加到关联中。最新版本的 ActiveRecord 提供了**named_scopes**的功能，它也适用于关联的记录。

从当前项目

```
Folder has_many Pages
Page has_many Comments

# In Page
named_scope :commented,
  :include => "comments", 
  :conditions => ["comments.id IS NULL OR comments.id IS NOT NULL"], 
  :order => "comments.created_at DESC, pages.created_at DESC" 
```

使用这个我们可以说：

```
folder.pages.commented 
```

这将在相关记录的范围内，使用提供的参数做一个条件。

加！named_scopes 是可组合的。

以及更多范围：

```
named_scope :published, :conditions => ["forum_topics.status = ?", "published"] 
```

并将它们链接在一起：folder.pages.published.commented

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T04:58:16.357

听起来像是[nested_has_many_through](http://github.com/ianwhite/nested_has_many_through)的工作！很棒的插件，可以让你做嵌套`has_many :throughs`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T17:57:40.063

对于这样的关联，您最终将编写自定义 SQL —— 没有真正的方法可以处理这样的关联链而无需进行一些相当大量的连接，而且确实没有一种有效的方法内置查询生成器以单行方式处理它。

您也可以查看 ActiveRecord 的 :joins 参数——这可能会满足您的需求。

# visual-studio - 在 VS 解决方案中查找所有 .rpt 文件

> ID：778244
> 
> 赞同：0
> 
> 时间：2009-04-22T17:01:12.523
> 
> 标签：visual-studio, visual-studio-2008, search, projects-and-solutions

我想搜索我的 VS 2008 解决方案并返回所有 .rpt 文件。

如果可能的话，我希望它在代码中。我很想遍历这些文件。

（这是为了对我继承的解决方案进行一些维护，并且有很多我正在尝试清理的未引用代码）

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T17:11:40.593

我会使用 FileInfo 类，遍历所有文件夹和文件，并构建一个名称以 .rpt 结尾的所有文件的列表

# sql-server - 确定 SQL 故障转移群集中的活动节点

> ID：778245
> 
> 赞同：23
> 
> 时间：2009-04-22T17:02:06.857
> 
> 标签：sql-server, tsql, failover

有谁知道如何从 T-SQL 以编程方式确定 SQL 主动-被动故障转移群集的主动节点？

`@@SERVERNAME`只返回虚拟服务器名称，这在两个节点上是相同的。

我不打算根据数据做出任何决定——我相信故障转移会做它的事情——但我想将信息包含在事件日志中，这样我就可以知道事件发生时集群中的哪个节点处于活动状态，或帮助确定是否由于故障转移而出现异常。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-22T17:14:54.847

```
Select ServerProperty('ComputerNamePhysicalNetBIOS') 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2019-09-04T14:22:42.317

这适用于较新的版本：

```
SELECT * FROM fn_virtualservernodes(); 
```

[https://docs.microsoft.com/en-us/sql/relational-databases/system-functions/sys-fn-virtualservernodes-transact-sql?view=sql-server-2017](https://docs.microsoft.com/en-us/sql/relational-databases/system-functions/sys-fn-virtualservernodes-transact-sql?view=sql-server-2017)上的完整详细信息

```
SELECT * FROM sys.dm_os_cluster_nodes; 
```

完整的细节在[https://docs.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/sys-dm-os-cluster-nodes-transact-sql?view=sql-server -2017](https://docs.microsoft.com/en-us/sql/relational-databases/system-dynamic-management-views/sys-dm-os-cluster-nodes-transact-sql?view=sql-server-2017)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-09-19T17:56:39.883

试试这个，这会检查服务器是否是可用性组中的主服务器，然后根据这个条件做 X：

```
IF EXISTS (SELECT ars.role FROM sys.dm_hadr_availability_replica_states ars JOIN sys.availability_groups ag ON ars.group_id = ag.group_id WHERE ars.role_desc = 'PRIMARY')
    BEGIN
        SELECT 'PRIMARY' -- DO STUFF IF PRIMARY
    END
ELSE
    BEGIN
        SELECT 'NOT PRIMARY' --- DON'T DO STUFF
    END 
```

# c# - 如何获取类库上的当前目录？

> ID：778252
> 
> 赞同：29
> 
> 时间：2009-04-22T17:03:56.853
> 
> 标签：c#, asp.net, path, filepath, configuration-files

我一直在环顾四周，但没有找到解决这个问题的方法：我想创建一个类库，该类库在名为 Configuration 的子目录下有一个配置文件。我希望将该类库部署在任何地方，并且我希望它通过知道自己的位置来找到它的配置文件。

以前的尝试`Assembly.GetExecutingAssembly().Location`没有奏效。
它将返回临时位置，例如

`C:\Windows\Microsoft.NET\Framework\v2.0.50727\Temporary ASP.NET Files\root\7c00e0a3\38789d63\assembly\dl3\9c0a23ff\18fb5feb_6ac3c901`

而不是想要的

`bin/Configuration`小路。

所以：

1.  类库可以知道自己在磁盘上的位置吗？
2.  我将如何着手编写此功能的测试脚本，因为似乎目录会根据您运行应用程序的方式而变化（在 VS 中调试、在 IIS 上部署等）

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-22T17:10:46.353

这应该工作 -

```
string assemblyFile = (
    new System.Uri(Assembly.GetExecutingAssembly().CodeBase)
).AbsolutePath; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2020-03-19T14:05:31.763

下面的代码为我获取了类库文件中的图像文件夹的物理路径。

```
string fullFilePath = Path.Combine((new System.Uri(Assembly.GetExecutingAssembly().CodeBase)).AbsolutePath.Split(new string[] { "/bin" }, StringSplitOptions.None)[0]
                          , "@/Images/test.png"); 
```

我希望，它会帮助某人。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-11-03T18:19:13.877

老问题，但为新观众回答。只需访问该文件。我通过动态设置目录尝试了多种方法，但没有积极的结果。但另一方面，我看到它会自动访问其目录/子目录中的文件，而无需显式调用任何方法来获取当前目录。

[我的案例] 我不得不访问一个与类库一起存储的配置文件，我可以直接访问它而无需指定或设置地址。

# ms-access - Access 中的 ActiveX 依赖项

> ID：778255
> 
> 赞同：1
> 
> 时间：2009-04-22T17:05:21.343
> 
> 标签：ms-access, crystal-reports, activex, dependencies, dll

我在 Access 表单（版本 2007、2003 格式）中使用 Crystal Reports Viewer 11 ActiveX 控件。在我安装了 CRXI 的开发机器上一切正常。我将引用的 DLL 复制到客户端的机器上，但是当我尝试注册它时，它显示“找不到模块”（我对拼写进行了两次和三次检查），当我尝试打开表单时它告诉我“当代码尝试创建报表对象的新实例时，ActiveX 组件无法创建对象。我怀疑 DLL 需要更多的依赖文件，但我对哪些文件以及如何找出这些文件有点茫然。虽然我使用的是 CR 控件，但我认为这适用于任何引发此错误的 ActiveX 控件。谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T17:16:07.370

您的 Crystal 帮助文件中应该有一个运行时分发文档 - 根据过去的经验（Crystal 8.5），您必须分发和注册多个文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-27T13:28:49.173

我正在回答我自己的问题，以防将来有人通过搜索找到这个问题。我没有上面提到的 Access Package & Deploy 向导 David（好吧，我可能有它，但找不到它）但我认为它可能会满足我的需要，所以我建议任何人先尝试一下。相反，我能够创建一个设置来使用 Visual Studio 安装程序和 Crystal 合并模块安装所需的文件；请注意，虽然这并不困难，但也不愉快。

我从 MSDN下载并安装了[Visual Studio Installer 1.1 。](http://www.microsoft.com/downloads/details.aspx?familyid=5FBBC453-CD04-4562-A66E-5C21436E6F56&displaylang=en)这会在 Visual Studio 6.0（特别是，我使用 InterDev 6.0）中创建一个新的项目类型，它会创建一个 Windows Installer (*.msi) 安装文件。因为其中一个 Crystal 合并模块需要 Crystal 许可证密钥，而 VSI 不支持合并模块参数，所以我还必须使用 Orca，一个合并模块编辑器，可从[Microsoft Windows SDK](http://www.microsoft.com/downloads/details.aspx?FamilyID=4377F86D-C913-4B5C-B87E-EF72E5B4E065&displaylang=en)（也可在 Microsoft 下载站点上获得）中获得。我建议阅读 MSDN 上的 SDK 和 Orca 页面以获取更多信息。使用 Orca，我能够放置我的密钥代码并重新编译合并模块，因此我不必将我的密钥部署给我的用户，我的用户也不必输入一个。

同样，打包和部署向导可能是一个更好的选择，但是当面临使用合并模块时，就像使用 Crystal 一样，这种方法可以完成工作。

# iphone - iPhone数据导出

> ID：778259
> 
> 赞同：1
> 
> 时间：2009-04-22T17:07:00.717
> 
> 标签：iphone

我正在为 iPhone 编写一个数据收集应用程序，并且希望能够将我的数据导出到用户可以在其桌面上处理的文件。我会在 iPhone 上以 csv 或任何格式生成文件，然后用户会以某种方式将文件放到他们的桌面上。通过阅读此处和其他网络上的其他问题，我的选择似乎是：

1）在iPhone应用程序连接并发送数据的云中某处实现我自己的Web服务。然后我的服务器要么通过电子邮件将其发送给用户，要么以某种方式使其可供下载。

2) 编写 SMTP 代码或使用现成的库，这将要求用户输入自己的电子邮件服务器详细信息。然后将数据作为附件发送给用户。

3) 使用某种 bonjour 设置，我给用户一个应用程序以在他们的桌面上运行，iPhone 应用程序找到并与该桌面应用程序对话。

所有这三个似乎都很麻烦：#1 对我来说是因为我必须编写/维护服务器（包括检测/防止垃圾邮件/滥用等）。#2 和 #3 用于用户，因为有额外的配置、要运行的东西以及可能出错的东西。（更不用说要为我编写代码和测试的更多东西了，可能还有一堆桌面操作系统和配置。）

这些是人们正在使用的选项吗？我错过了吗？人们最喜欢哪个？

非常感谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T17:11:58.643

您可以在手机上运行一个 Web 服务器，并将用户指向该 IP 地址，然后提供一个 AJAXy 网页，他们可以将文件下载到他们的桌面。

不难，但他们必须输入 IP 地址或[http://myphone.local](http://myphone.local)类型地址...

# c# - Win API 中 DataGridView 的替代品

> ID：778261
> 
> 赞同：0
> 
> 时间：2009-04-22T17:07:56.313
> 
> 标签：c#, winforms, winapi

在网上某个博客上的某个地方，我读到一句话是“DataGridView 类似于波音 777，但是当我不知道如何飞行时，目标是什么。在我深入创建我的项目之前，我想知道 C# 中是否有 DataGridView 的替代方案. WEB api 中的 jQuery 之类的东西。我正在寻找的好处是易于使用，如果它可以成为免费软件并且看起来既时尚又现代。

最好的问候阿米尔

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T17:58:50.153

如果您想让一个人飞过城镇，您可以学习驾驶 Piper Cub。如果您想飞过数百个海洋，您需要学习驾驶 777。

在 WinForms 应用程序中显示数据的方式有很多种；哪一个最适合您取决于您​​要做什么。如果要显示固定的、不可编辑的、不可滚动的数据列表，可以使用 DataList；简单而有限。如果要添加滚动，可以将数据输出到滚动文本框。

如果要处理具有多个、可调整大小、可编辑的列的多行滚动网格，则需要移动到 DataGrid 或 DataGridView。

DataGridViews 有很多替代方案；更简单的控件提供更少的功能，而更多功能的控件则更复杂。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-05-27T14:09:53.687

我已经在使用 Visual Studio 2008 的 windows 窗体项目中将 datagridview 作为未绑定控件广泛实现。回想起来，实现这个控件已经消耗了大量时间，主要是因为它加载了应该修复的错误和特殊行为，而不是不仅仅是“记录在案”。良好的数据网格控制对于任何物质应用都是必不可少的。我建议从一家更感兴趣的公司那里寻找第三方替代品，而不是仅仅把东西拿出来。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T18:40:41.520

它`DataGridView`非常易于使用，无需太深。如果您只想在网格中显示数据，请创建一个`DataGridView`并关闭添加和编辑行等功能。事实上，它拥有所有这些极其复杂的功能，这实际上只是当您开始需要使用它们时才会出现的问题——在这种情况下，您会很高兴您正在使用它。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T17:37:20.673

DevExpress 有一个非常好的[gridview](http://devexpress.com/Products/NET/Controls/WinForms/Grid/)。

# git - 克隆 git 存储库时如何自动保留别名？

> ID：778262
> 
> 赞同：3
> 
> 时间：2009-04-22T17:08:02.100
> 
> 标签：git, clone, alias

我在我的 git 存储库的配置文件中设置了一堆方便的别名。我偶尔会克隆这个存储库（例如到我的笔记本电脑上），但克隆不包括我设置的任何别名，大概是因为克隆没有复制存储别名的 git config 文件。但是，我希望在使用克隆时可以使用这些别名，而不必手动重新设置它们。有没有人找到一个好的解决方案？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T18:45:09.777

您可以将别名放入您的 $HOME/.gitconfig 文件中，以使它们适用于单台机器上的所有存储库。（或一组共享主目录的机器）。那肯定是我所有的地方。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T17:31:05.947

别名：它们是针对您作为用户还是针对特定存储库定义的？

每个存储库都可以在 .git 目录（或您设置 $GIT_DIR 的任何位置）中拥有自己特定的 .gitconfig（只是配置文件）文件。

有关更多信息，请查看文档： http: [//git-scm.com/docs/git-config](http://git-scm.com/docs/git-config)（特别是 FILES 部分）

# javascript - 使用 javascript 聊天客户端 (jsjac) 连接到远程 jabber 服务器

> ID：778271
> 
> 赞同：1
> 
> 时间：2009-04-22T17:10:19.303
> 
> 标签：javascript, xmpp

这更像是一个概念问题。

我正在尝试创建一个可以安装在任意页面（在 x.com 和 y.com 上）的 Javascript jabber 客户端，并且我希望这个客户端能够与远程 jabber 服务器（chatserver.com ）。

根据我正在查看的一个javascript客户端的自述文件（jsjac），由于跨站点问题，它无法与远程服务器通信是javascript的固有限制。

我很高兴听到任何人关于如何克服这个障碍的消息。指向示例的指针将非常有帮助。

[更新] 我在这里假设我无法控制客户端服务器 x.com 和 y.com。Hab.la 的人似乎已经成功了，不知道是怎么做到的。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T17:20:04.787

解决此问题的最简单方法是通过托管客户端的服务器将来自 JavaScript 客户端的请求代理到远程服务器。

Apache 的 mod_proxy 扩展可以很好地处理这个问题。

# c# - 反序列化需要强制转换？

> ID：778274
> 
> 赞同：1
> 
> 时间：2009-04-22T17:11:16.260
> 
> 标签：c#, .net, xml, serialization

我正在阅读[这篇](http://www.devhood.com/Tutorials/tutorial_details.aspx?tutorial_id=236)文章，他们有以下代码：

```
// Serialization
XmlSerializer s = new XmlSerializer( typeof( ShoppingList ) );
TextWriter w = new StreamWriter( @"c:\list.xml" );
s.Serialize( w, myList );
w.Close();

// Deserialization
ShoppingList newList;
TextReader r = new StreamReader( "list.xml" );
newList = (ShoppingList)s.Deserialize( r ); 
```

最后一行是演员表吗？如果是这样，它不会降低序列化性能吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-22T17:14:49.247

是的，最后一行是演员表。铸造确实有与之相关的成本，但与序列化成本相比，它是微不足道的。我怀疑它甚至会出现在分析器上。

想想序列化涉及什么。

*   处理字节流
*   基于元数据信息创建类型
*   字节数组和数据类型之间的转换

这些操作中的任何一个都比单个演员操作要昂贵得多。

**编辑**至于为什么它需要铸造。

这里有几个原因。首先是反序列化 API 在检查字节流之前无法知道它的类型。因此，就元数据中的返回类型而言，API 的唯一选择是 Object。

其次，反序列化必须支持任何可序列化的类型。为了发挥作用，它必须为适用于所有可序列化类型的方法选择一个返回类型。满足该条件的唯一可用类型是对象。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-22T17:15:47.403

与反序列化成本本身相比，演员表非常便宜。反序列化的过程非常复杂 - 单个（工作）演员几乎不需要任何时间。

当然，如果您对快速、便携、紧凑的序列化以及良好的版本控制感兴趣，您应该查看 Protocol Buffers：

*   [Google 版本](http://code.google.com/p/protobuf/)（Java、Python、C++、良好的整体文档）
*   [我的 Java 版本的移植（有利于 Java 代码的可移植性）](http://code.google.com/p/protobuf-csharp-port/)
*   [Marc Gravell 的端口](http://code.google.com/p/protobuf-net/)（适用于 WCF，可以说是更惯用的 .NET）

（还有其他序列化框架，例如[Thrift](http://incubator.apache.org/thrift/)。）

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T17:18:05.807

Deserialize() 方法返回一个对象，并且必须“强制转换”为正确的类型。

转换主要是告诉编译器您知道对象类型是什么，因为编译器无法推断其类型。如果类型不是您指定的类型（或指定类型的子类型），运行时仍会生成 InvalidCast 异常。

铸造的实际成本是最低的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T17:17:09.457

反序列化返回一个对象类型，因此强制转换是将其放入正确的类中。

无论是否会对反序列化产生任何影响，您都希望它成为 ShoppingList 的一部分。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T17:25:38.643

如果您更改最后一行代码

```
newList = (ShoppingList)s.Deserialize( r ); 
```

至

```
newList = s.Deserialize( r ); 
```

编译器将添加回一个强制转换。我刚刚用 Red Gate 的 .NET Reflector 确认了这一点。因此，无论转换的成本如何，如果您想使用该类型的对象，您都必须这样做。

# iphone - 应用程序设计和 AppDelegate

> ID：778279
> 
> 赞同：5
> 
> 时间：2009-04-22T17:11:49.753
> 
> 标签：iphone, objective-c, cocoa-touch

我正在为我一直在从事的一些甜蜜的本科研究开发一个 iPhone 应用程序。可悲的是，我的学校不提供软件工程/设计课程，所以当谈到 OO 设计中的最佳实践问题时，我会阅读大量资料。

**我的困境：**

我的应用程序加载一个视图 (v1)，在用户单击按钮时，v1 的控制器类将执行一个操作方法。此操作方法应使用对象填充数组。之后，用户将再次执行该操作或单击不同的选项卡以加载另一个视图。应用程序中的其他视图将使用 v1 填充的数组。

那么，这个共享数组应该在哪里声明呢？现在，当我在没有 GUI 的情况下测试功能时，它就在 AppDelegate 类中。我应该抓住 AppDelegate 单例并将项目添加到 v1ViewController 中吗？它应该被声明为静态的吗？

谢谢您的帮助！

^布法罗

编辑：

后续问题：与单例交互时，与它交谈的更好方式是：

```
[[MyAwesomeSingleton sharedInstance] gimmeSomePizza]; 
```

或者

```
MySingleton *s = [MySingleton sharedInstance]; 
[s gimmeSomePizza]; 
```

我想我想知道的是，您是每次都调用 sharedInstance 方法还是定义一个指向 sharedInstance 的指针然后引用该指针？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T17:44:49.813

使用应用程序委托来存储在视图和视图控制器之间共享的数据是合理且适当的。

在我的应用程序中，我将应用程序委托视为 MVC 的控制器部分，UIViews 和视图控制器都是“视图”的一部分。我更喜欢使用称为[Passive View](http://www.martinfowler.com/eaaDev/PassiveScreen.html)的 MVC 变体，它使我的应用程序的模型和视图部分严格隔离，只有控制器连接它们。

我假设您存储的对象数组是您的应用程序的模型，因此将它们存储在您的应用程序委托上是有意义的。正如 Daniel D 所说，没有必要让它成为静态的。

应用程序委托确实是您程序的核心。您在`-applicationDidFinishLaunching:`方法中创建和初始化模型和视图，并将模型数据和视图状态保存在`-applicationWillTerminate:`. 当您的视图控制器接收到更改模型的事件时，您可以调用应用程序委托上的方法来进行这些更改。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T17:31:22.233

您可以将其存储在应用程序委托中的 ivar 中。您不需要将其设为静态，因为无论如何应用程序委托都是单例（永远不会超过 1 个实例）。

如果应用程序委托变得有点复杂，您可以将数据存储分解为单独的模型对象，或者使用 Core Data。

# class-design - 为什么将私有字段和方法放在类的顶部？

> ID：778281
> 
> 赞同：35
> 
> 时间：2009-04-22T17:12:06.413
> 
> 标签：class-design

我已经在许多地方以多种语言看到过这个事实上的标准，但我从来没有理解它——为什么将你的私有字段和方法放在类声明的顶部？隐喻看来，私有的东西应该位于底部（隐藏），而所有公共的东西都应该位于顶部，因此当您从上到下阅读类时，您首先会看到公共接口，然后是内部工作原理。

这背后的原因是什么？

编辑：澄清一下，我并不是说将所有成员声明在类的顶部，而是将私有成员/方法放在类声明的顶部，在任何公开之前。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-22T21:13:34.710

它源于您必须在使用它们之前声明所有内容（包括函数和变量）的日子。

内部（私有）变量和函数位于文件顶部，外部（公共）函数位于文件底部。这意味着公共函数可以引用内部函数。如果您有递归，则必须通过声明它的配置文件来转发引用该函数。

当语言允许代码跨越多个文件时，您必须将公共函数和变量声明放入头文件中，以便它们可以包含在项目的其他文件中 - 或者实际上是其他项目。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-22T17:15:21.663

它可能来自 C 的时代，当时所有变量都必须在顶部定义，作为初始化的一部分。此外，默认的访问说明符是，因此它可以在以后的类定义中为您`private`省去多余的东西。`private:`

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-04-22T17:16:31.940

就个人而言，当我试图阅读别人的代码并理解它时，我喜欢拥有私有字段提供的上下文。它让我快速了解了他们正在做的事情的类型以及我可以期待看到的内容。如果操作正确，它可以提供一个很好的预览，几乎就像是其余代码的目录。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-22T18:24:47.970

我同意它可能来自 C，但它也具有实用功能。

在所有你想学习的东西中，这些知识是需要的，比如在学习如何乘法之前学习如何加法。

在代码的情况下，您的公共函数通常会引用内部私有函数，而您的私有函数不太可能引用公共函数（尽管肯定存在重叠。）因此，了解您拥有哪些私有变量以及它们的用途在尝试了解公共方法对这些变量的作用时会很有用。

以这种方式，在阅读调用它们的公共方法之前了解私有方法的作用也很有用。

总的来说，我相信它是一种来自 C 和更早语言的风格，但是因为它在功能上更有用，所以我认为切换风格没有任何好处。

而且，与往常一样，除非有令人难以置信的令人信服的理由，否则打破一致性绝不是一个好主意。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-22T17:16:08.087

两个原因。

如果它们都在顶部，则它们很容易找到，并且在创建新事物时易于检查，以查看哪些命名约定在起作用以及哪些名称可用和不可用。

在 C 语言和 javascript 中，代码中的所有引用都必须在引用它们的地方声明和/或定义，因为引用的所有内容都必须是已知的。（是的，我知道，只有 JavaScript。）

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-22T20:45:41.780

在 OOP 中——有两件事——数据和行为

私有成员代表数据，公共方法代表行为。

你只能根据它所代表的数据来考虑行为所以——这就是为什么我想把我的数据元素放在最前面的原因。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-22T18:23:09.940

关于*fields*，将所有字段设为私有（封装等）是很常见的。而且它们很小。因为它们很小，所以把它们放在一起很好，也有可能，而且班级的顶部是一个很好、稳定的地方。我不知道这是否是它的历史理由——我认为 C 语言的根源可能更好地解释了这一点——但这可能是我们将它们保留在那里的一个原因。

就我自己而言，出于您建议的原因，我倾向于将私有*方法放在底部。*

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-22T18:13:29.247

我认为事实上的标准首先是公共方法！至少这是我写课程的方式。它帮助我为我的方法选择数据结构。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-22T17:17:43.497

估计是习惯了 您必须先声明函数和变量，然后才能使用它们，因此这是一致的。

另一方面，它是你不想让其他人阅读的东西，所以它属于底部。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-06-28T15:56:01.397

因为像@ChrisF 所说的那样的语言>> 例如解释性语言，Python 是一个突出的语言

* * *

## 回答 #11

> 赞同：-2
> 
> 时间：2009-04-22T17:17:08.053

他们在那里并不是什么秘密。您是否害怕有人会了解内部运作？如果他们有资源，他们可以了解他们需要了解的有关您的课程的所有信息。

将它们与其他人放在一起可以更容易地开发该类。您的所有类变量都在一个地方，您的方法也是如此。

# unicode - 如何使用 GNU diff 区分 utf-16 文件？

> ID：778291
> 
> 赞同：21
> 
> 时间：2009-04-22T17:15:41.303
> 
> 标签：unicode, diff, gnu

GNU diff 似乎不够聪明，无法检测和处理 UTF-16 文件，这让我感到惊讶。我错过了一个明显的命令行选项吗？有没有好的选择？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-11-13T11:32:04.030

`vimdiff`为此目的工作得很好。

我在阅读[这个 StackOverflow 答案](https://stackoverflow.com/questions/777949/can-i-make-git-recognize-a-utf-16-file-as-text)时发现了它。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-22T17:24:32.653

来自 GNU 差异文档：

> 处理多字节和可变宽度字符
> 
> diff、diff3 和 sdiff 将每一行输入视为一串单字节字符。在某些情况下，这可能会错误处理多字节字符。例如，当要求忽略空格时，diff 不会正确忽略多字节空格字符。
> 
> 此外，diff 目前假设每个字节为一列宽，并且这种假设在某些语言环境中是不正确的，例如，使用 UTF-8 编码的语言环境。这会导致 diff 的 -y 或 --side-by-side 选项出现问题。
> 
> 这些问题需要在不过度影响单字节环境中实用程序的性能的情况下进行修复。
> 
> IBM GNU/Linux 技术中心国际化团队提出了一些补丁来支持国际化差异 [http://oss.software.ibm.com/developer/opensource/linux/patches/i18n/diffutils-2.7.2-i18n-0.1.patch .gz](http://oss.software.ibm.com/developer/opensource/linux/patches/i18n/diffutils-2.7.2-i18n-0.1.patch.gz) _ 不幸的是，这些补丁是不完整的，并且是针对较旧版本的 diff，因此需要在这方面做更多的工作。

我自己从来没有意识到这一点。

如果非免费的非命令行工具可以完成这项工作，Guiffy 似乎可以胜任这项工作，但仍在寻找免费的命令行工具：

[http://www.guiffy.com/Diff-Tool.html](http://www.guiffy.com/Diff-Tool.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2019-01-17T13:08:12.180

安装支持 UTF-16 的[`ripgrep`实用程序](https://github.com/BurntSushi/ripgrep)，然后运行：

```
diff <(rg -N . file1.txt) <(rg -N . file2.txt) 
```

> `ripgrep`支持以 UTF-8 以外的文本编码搜索文件，例如 UTF-16、latin-1、GBK、EUC-JP、Shift_JIS 等。（提供了一些自动检测 UTF-16 的支持。其他文本编码必须用`-E`/专门指定`--encoding flag.`）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2019-02-02T18:46:20.680

使用重音符号或特殊字符时的错误补丁：

```
 diff --version
 diff (GNU diffutils) 3.6
 diff -Naur old_foo new_foo > foo.patch 
```

无论比较的文件/目录是否在 git 文件夹中，都能正确处理重音符号或特殊字符。

```
 git --version
 git version 2.17.1
 git diff --no-index old_foo new_foo > foo.patch 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-30T07:07:15.803

您也许可以使用出色的 chardet 在 python 中构建一些东西，然后将您的文件转换为 UTF-8 并将其发送到 GNU diff ？

[http://chardet.feedparser.org/](http://chardet.feedparser.org/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-02-10T19:47:12.200

在 Python 中，您可以使用 difflib.HtmlDiff 创建一个 HTML 表格，显示两个行序列之间的差异，并且它似乎可以很好地处理 Unicode 字符串（当然，前提是您使用适当的编解码器读取和写入它们）。

```
>>> hd = difflib.HtmlDiff()
>>> htmldiff = hd.make_file(codecs.open('file1', 'r', 'utf-16').readlines(), codecs.open('file2', 'r', 'utf-16').readlines())
>>> print >> codecs.open('diff.html', 'w', 'utf-16'), htmldiff 
```

# windows - 在 VIM 中模拟 Windows C-Del/C-Backspace 行为

> ID：778305
> 
> 赞同：3
> 
> 时间：2009-04-22T17:20:05.347
> 
> 标签：windows, vim, behavior

我喜欢在 VIM 中模拟 Windows 上 C-Del/C-Backspace 的正常行为。目前我正在使用：

```
imap <C-Del> <C-o>dw
imap <C-Backspace> <C-o>db 
```

这很接近但并不完美。例如，当试图从行尾删除它时

```
foo(1, 2) 
```

使用 C-Backspace，会发生这种情况：

```
foo(1, ) 
```

我该如何解决这个问题？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T17:39:19.500

您的 new`<C-Backspace>`与 internal 相同`<C-w>`。所以要解决你的问题，你可以

```
imap <C-Backspace> <C-w> 
```

# mysql - 我可以在 SQL UPDATE 中有一个内部 SELECT 吗？

> ID：778307
> 
> 赞同：1
> 
> 时间：2009-04-22T17:21:08.280
> 
> 标签：mysql, sql, sqlite, sql-update

我有一个数据库，例如：

表`foo`有列`id`，`name` 表`bar`有列`id`，`foo_id`

我有一个带有 a 的传入 HTTP 查询，我想在set 中适当`foo.name`地插入一行。因此，例如：`bar``bar.foo_id`

```
> SELECT * FROM foo;
id     name
------ -------
1      "Andrey"
(1 row)

> SELECT * FROM bar;
(0 rows) 
```

给定`"Andrey"`，我可以执行一个查询来获取：

```
> SELECT * FROM bar;
id     foo_id
------ -------
1      1
(1 row) 
```

我的思路是：

```
> UPDATE bar SET foo_id=(SELECT id FROM foo WHERE foo.name=?) 
```

但这似乎是错误的，因为 SELECT 的返回集，而不是值......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T17:23:42.080

你必须做

```
SELECT TOP 1 ID FROM foo where foo.name=? 
```

但除此之外，在更新中进行选择并没有错。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T17:27:20.277

如果子查询仅返回一个值（例如 MAX() 或 TOP 1），这将在 MS SQL Server 中工作

我不确定这种语法是否在 MySQL 中分叉，但你可以尝试一下......

```
UPDATE
  bar
SET
  bar.foo_id = foo.id
FROM
  bar
INNER JOIN
  foo
    ON foor.name = bar.name
ORDER BY
  foo.id 
```

在这种情况下，如果连接在 bar 中的每条记录返回多个结果，则将应用所有结果。通过确定应用它们的顺序来确定顺序，最后一个是持久的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T17:23:44.077

这至少适用于 sql server 和 oracle。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T17:29:04.423

尝试关注

UPDATE bAR SET foo_id = F.id FROM bar JOIN (SELECT id from foo where foo.name = @fooName) F

# c# - 带有字符串表的 Windows 窗体

> ID：778313
> 
> 赞同：0
> 
> 时间：2009-04-22T17:24:08.757
> 
> 标签：c#, user-interface, localization, string-table

我有普通的 Windows 窗体 (WinForm) C# (.Net 3.5) 应用程序，该应用程序具有带有文本和菜单等的标签……而且该应用程序有时会向用户显示消息框，并将一些信息写入文件。

我希望用户可以看到的所有信息（通过 GUI 或通过文件）都将由（一个，如果可能的话）字符串表管理。我的问题是我找不到如何将我所有的 GUI 控制器文本移动到资源文件中的字符串表中。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T17:29:17.760

您可以将标签的 Text 属性绑定到表单设计器的属性窗口中的应用程序设置或字符串资源。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T08:19:23.503

对于表单和其他 GUIO 组件，将其 Localizable 属性设置为 true。这将自动将文本移动到资源文件。

对于代码中的字符串文字，[资源重构工具](http://www.codeplex.com/ResourceRefactoring)是您的朋友

# c# - 我可以使用 C# 连接到 Java API 吗？

> ID：778316
> 
> 赞同：5
> 
> 时间：2009-04-22T17:24:36.350
> 
> 标签：c#, java, web-services, api

我的任务是编写一个连接到 DoubleClick DART API 并下载广告素材的应用程序。

该 API 目前仅支持 Java，但他们正在努力（最终）发布一个 SOAP 版本。

作为 C# 开发人员，我想用 C# 编写应用程序并访问 Java API，直到 SOAP API 可用。

我可以这样做吗？如果是这样，怎么做？

如果没有，我将学习 Java，编写应用程序，然后在 SOAP API 可用时重做，但这不是首选的做法。

谢谢您的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-17T14:43:29.130

[IKVM.NET](http://www.ikvm.net/)可能是您的解决方案。它是一个将 Java 字节码转换为 .NET IL 的 Java 虚拟机。

您可以做的是使用 ikvmc.exe 将 Java API（作为 jar 或源文件提供）编译为 .NET 程序集，然后从您的 C# 项目中引用该程序集。

IKVM 对 Java 用户界面 (AWT) 的支持有限，但因为它是一个 API，所以这不应该是相关的。

我自己没有尝试过，所以我不能保证这真的有效。

见[http://weblog.ikvm.net/story.aspx/faq](http://weblog.ikvm.net/story.aspx/faq)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T20:33:09.907

Yes, you can do this and we had to do something pretty similar a while back.

The Doubleclick API is Java based and is essentially a collection of methods to interrogate the database.

What you need to do is wrap these methods inside a web service using something like Axis2 and then deploy the web service to a Tomcat server (all of this is open source). That exposes the web service and you can then call the web service from anything you like.

So in your case, you add a web service reference inside Visual Studio and then your C# class will call the web service which invokes the Doubleclick Java method.

The actual Java code is minimal (aprox. 10 lines) since all it does is a call and then formats the output. It takes longer to deploy than it does to write the code!

Our Java development environment is Eclipse and I blogged about it [here](http://nzpcmad.blogspot.com/2008/12/java-tomcat-eclipse-and-axis2.html).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T17:56:22.093

顺便说一句，我是否可以建议以 RESTful 方式编写您的 Web 服务，而不是（或结合使用）SOAP？好处将是您将来可能想要使用您的服务的任何语言之间的互操作性，而不仅仅是那些可以基于 WSDL 生成代码的语言。只是一个想法。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-17T14:31:12.433

我会说使用 J# 层可能是一个不错的选择。我以前只用过一次，但它对我有用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-03T16:41:31.467

实际上，我们采用了一种稍微不同的方式来做到这一点。

1.  C# Web 服务现在使用 javaw.exe（使用 Process）调用 Java 类并传入一个 id (GUID)。
2.  GUID 用作由 java 类编写的 XML 文件的文件名。
3.  如果进程 (javaw) 没有错误地结束，则 Web 服务会打开 (GUID).xml 文件并检索数据。

虽然这不是最佳方法，但它在短期内适用于该过程，从长远来看，当 SOAP 解决方案可用时，Web 服务很容易更新。

# html - IE6中的下拉菜单“闪烁”

> ID：778324
> 
> 赞同：0
> 
> 时间：2009-04-22T17:26:21.557
> 
> 标签：html, css, internet-explorer-6

我正在尝试创建一个基于 Stu Nicholls 的下拉菜单：[http ://www.cssplay.co.uk/menus/pro_drop8.html](http://www.cssplay.co.uk/menus/pro_drop8.html)

我的需要检查*选择*下拉菜单并符合 IE6/7，所以这就是我使用所有这些 iFrame 废话的原因。更改 z-index 不会修复它，因为 IE 设置了一个无限的 zindex 值来选择下拉菜单。

所以我的问题是，如果我将下拉菜单从网站复制并粘贴（实际上，没有进行任何更改）到我的应用程序，它将在除 IE6 之外的所有内容中正常工作，它会“闪烁”。这意味着每次您将鼠标悬停在不同的菜单条目上时，它都会消失一小会儿，然后再次出现。我认为这是因为 IE6 认为您实际上不再悬停菜单。

我尝试了所有方法并浏览了几个小时的谷歌，但没有找到一个有效的下拉菜单。你知道什么可能导致这个问题（也许如何解决它）？

谢谢 -

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T17:29:47.383

[有时 IE 的haslayout](http://www.satzansatz.de/cssd/onhavinglayout.html)属性会出现问题。一个快速简单的解决方法是设置：

```
height: 1%; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T17:35:29.227

我讨厌成为建议您使用其他东西的“那个人”，所以如果您打算使用 Nicholls 的代码，请不要尝试这样做。但是，如果您不喜欢 Stu Nicholls 的下拉菜单，您可以查看[YUI 的菜单](http://developer.yahoo.com/yui/menu/)。我特别提到这些是因为我在 iframe-to-fix-ie6-bugs 支持方面取得了巨大成功。（至少，您可以使用他们的示例代码来查看 IE6 是否与其他人的下拉菜单表现得很好，或者它是否只是与 Nicholls 的某些东西。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-23T20:18:38.613

我不知道这是否是您所需要的，但[jQuery bgiframe 插件](http://plugins.jquery.com/project/bgiframe)可以非常干净地处理选择问题，因此您不必手动完成所有操作。

希望有帮助。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-28T19:24:54.177

好的，我找到了解决问题的方法。我正在使用 Chrome 下拉菜单：[http ://www.dynamicdrive.com/dynamicindex1/chrome/index.htm](http://www.dynamicdrive.com/dynamicindex1/chrome/index.htm)

代码简单、漂亮并且运行良好。我很难自定义它，但现在它完成了，我的生活好多了：

```
<div class="chromestyle" id="chromemenu">
<ul>
<li><a href="http://www.dynamicdrive.com">Home</a></li>
<li><a href="#" rel="dropmenu1">Resources</a></li>
<li><a href="#" rel="dropmenu2">News</a></li>
</ul>
</div>

<!--1st drop down menu --> 
<div id="dropmenu1" class="dropmenudiv">
<a href="http://www.dynamicdrive.com/">Dynamic Drive</a>
<a href="http://www.cssdrive.com">CSS Drive</a>
<a href="http://www.javascriptkit.com">JavaScript Kit</a>
</div>

<!--2nd drop down menu --> 
<div id="dropmenu2" class="dropmenudiv" style="width: 150px;">
<a href="http://www.cnn.com/">CNN</a>
<a href="http://www.msnbc.com">MSNBC</a>
<a href="http://news.bbc.co.uk">BBC News</a>
</div>

<script type="text/javascript">
cssdropdown.startchrome("chromemenu")
</script> 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2010-03-11T04:10:52.897

IE 使用与其他浏览器不同的事件触发器。尝试对鼠标执行此操作：

```
 //browser sniff
        if (navigator.appName == "Microsoft Internet Explorer") {
            document.getElementById('yourtriggerid').onmouseleave = function() {
                document.getElementById('themenuid').style.display = "none";
            };
        } else {
            document.getElementById('yourtriggerid').onmouseout = function() {
                document.getElementById('themenuid').style.display = "none";
            };
        } 
```

`'yourtriggerid'`是您要触发事件的任何内容，然后`'themenuid'`是您要隐藏和显示的菜单/绝对定位 div。

关键是`onmouseleave`为IE触发事件。希望这对某人有帮助！

# iphone - AVAudioPlayer 挂起整个应用程序

> ID：778330
> 
> 赞同：0
> 
> 时间：2009-04-22T17:27:48.153
> 
> 标签：iphone

我正在使用 AVAudioPlayer 在 iPhone 游戏中播放音效。这是我的代码的一部分：

```
AVAudioPlayer *player = [dict objectForKey:@"Player"];
if (player.playing) {
    player.currentTime = 0;
} else {
    [player play];
} 
```

一种可以重复且非常频繁地播放的声音，因为它是基于用户交互来播放的。当用户移动他的手指时，我反复调用这段代码。

如果这样做，应用程序将挂起，这是我在崩溃日志中得到的错误：

```
0   libSystem.B.dylib               0x3146bb18 semaphore_timedwait_signal_trap + 8
1   libSystem.B.dylib               0x3146297c semaphore_timedwait_signal + 8
2   libSystem.B.dylib               0x3145f0fe _pthread_cond_wait + 898
3   libSystem.B.dylib               0x3145f25a pthread_cond_timedwait_relative_np + 10
4   AudioToolbox                    0x348ddd50 CAGuard::WaitFor(unsigned long long) + 116
5   AudioToolbox                    0x3491b94c ClientAudioQueue::ServicePendingCallbacks() + 232
6   AudioToolbox                    0x3491ba60 AudioQueueReset + 44
7   AVFoundation                    0x34d16668 -[AVAudioPlayer setCurrentTime:] + 444 
```

在我看来，这就像 AVAudioPlayer 中的一个锁定问题，但我无法解决它。我尝试了不同的声音格式（CAFF 和 IMA4），但都以同样的方式失败。

任何指针？我真的很想坚持使用 AVAudioPlayer，因为它比音频队列更易于使用，但我需要播放声音而不会使我的应用程序崩溃。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-09-08T20:08:48.900

我找不到解决这个问题的方法。我通过使用 OpenAL 来解决我的声音需求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-28T13:47:59.503

您是否尝试过在重置 currentTime 之前调用 stop，然后调用 play？编辑您的示例：

```
if (player.playing) {
    [player stop];
    player.currentTime = 0;
    [player play];
} else {
    [player play];
} 
```

我不知道是否是这种情况，但也许在播放声音时重置 currentTime 可能会导致锁定问题。文档当然不会对此或任何事情发出警告。

# php - 使用 Zend 框架向多个订阅者发送电子邮件

> ID：778331
> 
> 赞同：3
> 
> 时间：2009-04-22T17:28:26.390
> 
> 标签：php, email, zend-framework, gmail, attachment

我想我一定是在这里做错了什么，因为我的代码只向表中的最后一个订阅者发送了一封电子邮件。当我记录订阅者数组时，很明显它试图发送给多个订阅者。我认为问题与尝试将它们批量处理有关......对我来说最好的方法是什么？我正在尝试创建一条带有附件的消息，然后分别发送每个地址，并将它们作为一个批处理过程全部发送出去。这是我的代码：

```
 $subscribersManager = new DD_Subscribers_Manager();
    $subscribers = $subscribersManager->getAllSubscribers();

    $subject = $form->getElement('subject')->getValue();
    $body = $form->getElement('body')->getValue();
    $filename = $form->getElement('bulletin')->getValue();
    $filepath = Zend_Registry::get('rootDir') . '/public/downloads/archive/' . $filename;

    $config = array('ssl' => 'tls', 'port' => 587, 'auth' => 'login', 'username' => 'fake@email.com', 'password' => 'password');
    $smtpConnection = new Zend_Mail_Transport_Smtp('smtp.gmail.com', $config);

    foreach ($subscribers as $subscriber) {
        $message = new Zend_Mail('utf-8');
        $message->setFrom('fake@email.com', 'My Fake Mailing List')
                ->addTo($subscriber->email)
                ->setSubject($subject)
                ->setBodyText($body);
        $attachment = $message->createAttachment(file_get_contents($filepath));
        $attachment->type = 'application/pdf';
        $attachment->filename = $filename;
    }
    $message->send($smtpConnection); 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T17:31:45.180

这看起来像一个范围问题：您在 foreach 循环中创建 $message 并且只发送最后一个（因为在 foreach 之后调用了 $message->send() 。

基本上，每次 foreach 循环迭代时，您都会覆盖 $message 的值。将 $message->send 移动到 foreach 循环中，每次迭代发送一封电子邮件。可能还有另一种方法可以创建一组消息并同时发送它们，但我不熟悉 ZendMail。

编辑：实际上，如果您阅读 Zend_Mail 上的文档，您可以调用 $message->addTo() 将其他收件人（超过 1 个）添加到单个消息中。您的代码可能会更改为：

```
$message = new Zend_Mail();
$message->setFrom('fake@email.com', 'My Fake Mailing List')
                                ->setSubject($subject)
                                ->setBodyText($body);

foreach($subscribers as $subscriber){

    $message->addTo($subscriber->email);
}
$message->send(); 
```

[Zend_Mail - 添加收件人](http://framework.zend.com/manual/en/zend.mail.adding-recipients.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T17:30:26.010

在我看来，您正在为每个订阅者创建一个对象，然后除了最后一个之外，没有对它们中的任何一个做任何事情。在循环内移动`$message->send`调用。`foreach`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-24T08:52:37.333

将“send”方法调用代码放入foreach循环`$message->send($smtpConnection);`
中，如下所示：

```
foreach ($subscribers as $subscriber) {
    $message = new Zend_Mail('utf-8');
    $message->setFrom('fake@email.com', 'My Fake Mailing List')
                     ->addTo($subscriber->email)
                     ->setSubject($subject)
                     ->setBodyText($body);
    $attachment = $message->createAttachment(file_get_contents($filepath));
    $attachment->type = 'application/pdf';
    $attachment->filename = $filename;
    $message->send($smtpConnection);
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-03-02T05:35:58.717

这不是真的。看看这个[http://framework.zend.com/manual/1.12/en/zend.mail.multiple-emails.html](http://framework.zend.com/manual/1.12/en/zend.mail.multiple-emails.html)。我也尝试过这样做，我可以向所有人发送邮件

# buffer-overflow - 内存入侵

> ID：778334
> 
> 赞同：1
> 
> 时间：2009-04-22T17:29:26.433
> 
> 标签：buffer-overflow

前段时间我听说内存入侵，当软件 A 的某些部分进入同一软件 A 的另一部分时，导致程序无法正常工作。

内存入侵真的存在吗？我的意思是，我一直在使用 C++，而且我知道数组可以无限增长，但是它们可以*在*其他结构上增长吗？如果数组不会生成 MI，那会是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T17:31:13.200

您正在描述[缓冲区溢出](http://en.wikipedia.org/wiki/Buffer_overflow)，是的，它们是软件安全问题的一大来源。如果有人可以用任意数据覆盖程序代码，并且该任意数据包含攻击者选择的可执行代码，那么他们基本上可以使用发生溢出的程序的特权级别执行机器代码。

当为未知数量的输入（来自键盘、网络、API 调用等）分配了固定数量的存储空间时，通常会发生此问题，并且输入量最终大于存储空间的大小。在不对数组访问执行边界检查的编程语言中，这可能会导致代码的可执行区域被覆盖。像[DEP](http://en.wikipedia.org/wiki/Data_Execution_Prevention)这样的技术可以通过写保护内存的可执行区域来降低这种风险。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T17:35:07.027

堆栈溢出也可能导致此问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T17:33:02.180

在不自动进行内存管理的语言中，这种情况并不少见。例如，[缓冲区溢出](http://en.wikipedia.org/wiki/Buffer_overflow)就是入侵的一个很好的例子。

有一些针对特定类型入侵的保护措施（例如，您经常会遇到堆栈溢出而不是查看其他材料），但是任何时候涉及指针，都很容易查看您不期望的内存或代码使用权。

Java 和 C# 等语言不允许您在低级别操作内存，因此可以降低风险。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T17:34:27.687

“内存入侵”称为缓冲区或堆栈溢出。它可能是您可以利用来查找安全漏洞的最重要的漏洞。

标准 C 库中充满了愉快地假设输入不会溢出分配的缓冲区空间的函数。当输入**大于**缓冲区时，缓冲区溢出到内存的其他部分。该程序不再正常工作，并且可能以微妙的方式损坏。

阅读：[http ://www.owasp.org/index.php/A5_2004_Buffer_Overflow](http://www.owasp.org/index.php/A5_2004_Buffer_Overflow)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T17:37:32.157

在 C++ 中，数组不能无限增长。你没有无限的记忆。内存入侵将由以下原因引起：

```
int foo[100];
foo[100]=5; // writing outside the array. This might cause some problems. 
```

# php - 将回声捕获到变量中

> ID：778336
> 
> 赞同：37
> 
> 时间：2009-04-22T17:29:47.307
> 
> 标签：php

我正在使用动态函数名称调用函数（类似这样）

```
$unsafeFunctionName = $_POST['function_name'];
$safeFunctionName   = safe($unsafeFunctionName); // custom safe() function 
```

然后我想在函数的返回值周围包装一些 xml（像这样）：

```
// xml header etc already created
$result = "<return_value>" . $safeFunctionName() . "</return_value>"; 
```

问题是，有时函数返回一个值，但有时，函数 echo 是一个值。我想要做的是将该回声捕获到一个变量中，但是，我编写的代码需要以任何一种方式工作（意思是，如果函数返回一个值，或者回声是一个字符串）。

不太确定从哪里开始〜有什么想法吗？

* * *

## 回答 #1

> 赞同：84
> 
> 时间：2009-04-22T17:31:50.530

让我先说：

小心那个自定义函数调用业务。我假设您知道这有多危险，这就是您以某种方式对其进行清洁的原因。

除此之外，您想要的是[输出缓冲](http://www.php.net/outcontrol)：

```
function hello() {
    print "Hello World";
}
ob_start();
hello();
$output = ob_get_clean();
print "--" . $output . "--"; 
```

（我添加了破折号以表明它一开始没有被打印）

以上将输出`--Hello World--`

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-22T17:36:52.623

[PHP: ob_get_contents](http://www.php.net/manual/en/function.ob-get-contents.php)

```
ob_start(); //Start output buffer
echo "abc123";
$output = ob_get_contents(); //Grab output
ob_end_clean(); //Discard output buffer 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T18:46:29.277

为了使用输出值（如果存在）或返回值（如果不存在），您可以像这样简单地修改代码：

```
ob_start();
$return_val = $safeFunctionName();
$echo_val = ob_get_clean();
$result = "<return_value>" . (strlen($echo_val) ? $echo_val : $return_val) . "</return_value>"; 
```

# .net - .Net\AJAX 列表框和更新面板问题

> ID：778338
> 
> 赞同：0
> 
> 时间：2009-04-22T17:29:59.943
> 
> 标签：.net, ajax, listbox

我在更新面板中有一个列表框（l1），它在更改更新面板中的下拉列表时填充。我在更新面板中有另一个列表框（l2），它可以通过 javascript 填充 l1。我在下拉列表中有 2 两个项目。项目 1 有 6 个与之相关的项目，而项目 2 则没有。当页面加载时，默认在下拉列表中选择第 1 项，并将其相关数据（6 项）加载到 l1 中。当我在下拉列表中选择 Item2 时，l2 为空，因为没有与 Item 2 相关的数据。当我在页面上单击保存时，l1.Items.count() = 6 并且保存例程将与 Item 1 相关的 6 个项目保存到第 2 项。如果我通过客户端脚本从 l2 更新 l1，一切都会正确保存。我确定这是否是由于更新面板而发生的，或者这只是列表框的问题。你知道是什么导致了这个问题吗？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-04-16T19:16:03.697

这是由您的更新面板引起的。

它可能是

更新模式

您可能需要为更新面板设置自定义触发器。

祝你好运！

# c# - 连接控制台应用程序以访问数据库问题

> ID：778350
> 
> 赞同：0
> 
> 时间：2009-04-22T17:32:45.693
> 
> 标签：c#, database, ms-access, console

我正在尝试将控制台应用程序连接到访问数据库。

这是我正在使用的查询：

“SELECT [Type], [Name], [Phone Number], [Start Time], [End Time], [IM Session File], [Notes] FROM [Call History] ​​WHERE [Start Time] >= ?”

问题是，由于某种原因，当我从 access 数据库中获取数据并将其放入 sql server 数据库时，日期被弄乱了，因为它们不是按年份顺序排列的。

所以我决定添加一个 order by 子句：

选择 [类型]、[姓名]、[电话号码]、[开始时间]、[结束时间]、[IM 会话文件]、[备注] FROM [通话记录] WHERE [开始时间] >= ? ORDER BY [通话记录].[开始日期]

command.Parameters.Add("@date", OleDbType.Date); command.Parameters["@date"].Value = calllogClient.getLastEntryInserted(ssid);

不断收到此异常：System.Data.OleDb.OleDbException：没有为一个或多个必需参数提供值。

我不知道如何使这项工作。任何的意见都将会有帮助。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T19:33:44.840

设置参数时，去掉@

command.Parameters["date"].Value = calllogClient.getLastEntryInserted(ssid);

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T17:56:43.483

我相信您的选择语句应该是这样的：

SELECT [Type], [Name], [Phone Number], [Start Time], [End Time], [IM Session File], [Notes] FROM [Call History] ​​WHERE [Start Time] >= @date ORDER BY [通话记录].[开始日期]

# sql - 当一个范围具有起始日期范围时比较两个日期范围

> ID：778353
> 
> 赞同：3
> 
> 时间：2009-04-22T17:33:05.397
> 
> 标签：sql, mysql, django, date

我从这个问题中解决了下一个问题：[比较日期范围](https://stackoverflow.com/questions/143552/comparing-date-ranges)

比较两个范围的解决方案是查询：

SELECT * FROM Period WHERE NOT (range_start > @check_period_end OR range_end < @check_period_start)

我有额外的问题。我允许人们进入一系列时期。准确地说，他们输入了一个持续时间（即 1 周）和一个开始日期范围（即 5 月的前 2 周），我必须找出他们指定的范围内是否有一个一周的时段。

天真的解决方案是在我的范围内每天运行上述查询。所以 - 要检查一个月范围内的 3 天时段，我必须运行 30 个查询。有没有更有效的方法？

对于奖励积分 - 我正在使用 Django。使用 Django ORM 有没有好的解决方案？

编辑 - 为了简化问题，我想我已经把它变成了一个不同的问题！我的实际问题是找到“自由间隙”。我认为这使下面的一些“纯 SQL”方法无效。我认为[开始一个新问题](https://stackoverflow.com/questions/781221/finding-free-slots-in-a-booking-system)而不是混淆这个问题是明智的。其他人可能会发现这个问题在当前形式中很有用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T17:41:41.223

这不是 SQL 的理想选择。

但是，在 Django 中，您可以摆脱许多 SQL 约束。

首先，在你的模型中定义一个方法函数来做你想做的事——在 Python 中。

例如

```
class MyThing( models.Model ):
    startDate = models.DateField(...)
    duration = models.IntegerField(...)
    def isInside( self, aDate, aDuration ):
        return aDate >= self.startDate and aDate+aDuration <= self.startDate+self.duration 
```

然后使用您的`isInside()`方法来限定对象。这将在 Python 中完成一些工作，在 Python 中它比在 SQL 中闲逛要简单得多。

为这样的复杂查询定义一个自定义管理器。您将扩展基本的 query_set 方法以包含与此类似的逻辑。

```
for thing in MyThing.objects.filter( startDate__gte=aDate, startDate__lte=aDate+duration ):
    if thing.isInside( aDate, duration ):
        return thing 
```

这将使用 SQL 来获取对象的子集，其日期应包括您要查找的时间间隔。然后，您可以从该列表中选择最终对象的间隔。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T19:33:17.383

这个问题比乍看起来要简单，因为用户没有直接在他们的标准中指定结束日期。

```
SELECT * FROM periods p
WHERE p.range_start >= @min_start
AND   p.range_start <= @max_start
AND   DATE_ADD(p.range_start, INTERVAL @duration DAY) <= p.range_end 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T20:04:52.707

您声明用户指定（例如）：

*   1周期间
*   开始日期（2009 年 5 月 1 日）
*   结束日期（2009 年 5 月 15 日）

然后，您声明您需要“*找出他们指定的范围内是否有一周的时间段*”。我不能 100% 确定如果我理解正确会发生什么，但这就是我从中得到的……

*   有一个“可用期间”表（按开始/结束日期描述）
*   您需要找到一个与用户的开始/结束日期重叠的“可用时段”
*   该重叠必须持续至少 1 周（或用户要求的任何持续时间）

如果是这样的话，我会按如下方式解决......

*   识别重叠的时期
*   确定第一个重叠日期
*   确定最后重叠日期
*   如果这些日期相隔 7 天，则匹配

我在 SQL 中的解决方案是......

```
SELECT
   *
FROM
   periods
WHERE 
   (range_start <= @check_end)
   AND (range_end >= @check_start)
   AND DATEDIFF(
          DAY,
          CASE WHEN range_start > @check_start THEN range_start ELSE @check_start END,
          CASE WHEN range_end   < @check_end   THEN range_end   ELSE @check_end   END
          )
       >= @required_duration-1 
```

**编辑**

这假设您的示例逻辑所暗示的开始和结束日期是包容性的。
（由“2009 年 1 月 1 日”->“2009 年 1 月 1 日”表示的一天期间）

我个人更喜欢开始日期包含，结束日期不包含。
（由“2009 年 1 月 1 日”->“2009 年 1 月 2 日”表示的一天期间）

原因是各种数学比较和操作变得更容易，还因为它不要求读者假设您正在工作的准确度级别。

*   如果按小时工作，“2009 年 1 月 1 日”->“2009 年 1 月 1 日”表示一小时。
*   但是，如果您知道结束日期是独占的，那么“2009 年 1 月 1 日”->“2009 年 1 月 2 日”始终是一天。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T23:46:43.577

在某些情况下，创建一个查询来获取您可能需要的所有数据，然后在测试之前使用业务逻辑语言过滤这些数据，结果证明要快几个数量级。

在我正在开发的应用程序中使用滚动平均值执行类似的操作时，它节省了 100 倍以上。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T18:13:13.223

这个怎么样。

创建一个日期表，每个日历日期一行。

```
 SELECT * FROM CalendarDates cd  
  LEFT JOIN period p 
      ON cd.caldate > p.end_date
      OR cd.caldate + duration < p.begin_date

  WHERE p.period_id IS NULL 
```

# oracle - oracle 什么时候开始支持 "top": select top ？来自 PRODUCT 的 p2_.PRODUCT_ID？

> ID：778355
> 
> 赞同：5
> 
> 时间：2009-04-22T17:34:20.150
> 
> 标签：oracle

oracle什么时候开始支持“top”的：

```
select top ? p2_.PRODUCT_ID from PRODUCT? 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-22T17:46:38.967

我不确定 ORACLE 是否有过 TOP 功能。您想使用 TOP-N 查询。

例如：

```
select  *
  from  (SELECT  *
           FROM  foo
          where  foo_id=[number]
       order by  foo_id desc)
 where  rownum <= 3 
```

这将为您提供前三个结果（因为我在子查询中按 desc 排序）

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T17:45:39.717

Oracle 不支持 TOP 关键字。查询

```
SELECT TOP 10 product_id
  FROM product 
```

将产生语法错误，因为 TOP 10 子句无法识别，至少通过 Oracle 11.1（当前生产版本）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T23:44:07.697

[`TOP`](http://technet.microsoft.com/en-us/library/ms176104.aspx)SQL Server 不支持 Oracle。不要与[FIRST_ROWS](http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/sql_elements006.htm#BABGCCFG)命中混淆，该命中是为了检索第一行的最佳计划，而不是在多个结果后停止。

正如其他人所说，Oracle 解决方案是使用[ROWNUM](http://download.oracle.com/docs/cd/B28359_01/server.111/b28286/pseudocolumns009.htm#SQLRF00255)伪列。

# firefox - 编写带有原生窗口界面的 Firefox XPCOM 插件？（如 ActiveX 控件）

> ID：778357
> 
> 赞同：1
> 
> 时间：2009-04-22T17:34:28.153
> 
> 标签：firefox, mozilla, xpcom, gecko, windowed

我有一个在 Internet Explorer 和 ActiveX 控件测试容器程序中运行良好的 ActiveX 控件。控件的实际行为分为两部分，其中一部分是与 OLE 主机接口的 ATL gunk，另一部分是真正的肉，它只接收窗口附加、调整大小、绘图和鼠标/键盘的回调事件。

现在，我想为 Firefox 插件编写 ATL gunk 的等价物（理想情况下在同一个二进制文件中，因此我不需要链接两个二进制文件，但我可以在这里灵活）。我已经下载并使用 Gecko SDK 构建了一个 XPCOM 组件，这似乎可行，但我不知道要实现哪些接口以使该组件可用作 Firefox 中的嵌入式本机 UI 组件。这与 Flash 播放器插件、PDF 查看器插件、QuickTime 播放器插件等的需求类似——javascript 和 XUL 还不够。

我在网上找了一些例子，但我能找到的唯一例子是基于看似古老的 NS_PluginInitialize() / NS_NewPluginInstance() 接口，它不是 XPCOM（但有其他名称？）。

有没有办法通过 XPCOM 实现同样的事情？如果是这样，怎么做？并且是否存在任何关于如何执行此操作的概述文档（不仅仅是界面成员列表）？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T17:51:21.700

Aaaand 答案刚刚在另一个网络搜索中弹出。好吧，至少一些绳子的开头，当拉得足够长时，可能会回答这个问题。

[https://developer.mozilla.org/en/Gecko_Plugin_API_Reference/Plug-in_Basics#Windowed_and_Windowless_Plug-ins](https://developer.mozilla.org/en/Gecko_Plugin_API_Reference/Plug-in_Basics#Windowed_and_Windowless_Plug-ins)

# c# - 带有复选框的文件夹浏览对话框？

> ID：778361
> 
> 赞同：8
> 
> 时间：2009-04-22T17:35:10.663
> 
> 标签：c#, winforms, treeview, checkbox, folderbrowserdialog

我正在寻找最简单的解决方案，以在我的（C#）WinForms 项目中的目录前面使用复选框来实现文件夹浏览对话框。

我在备份中心的Vista中看到了这种对话框。它就像一个普通的文件夹浏览对话框，但在每个文件夹前面都有一个复选框。如果您选中了一个文件夹，则其中的所有文件夹和文件也会被选中，而您之后仍然可以单独取消选择它们。

如果没有预制控件或其他任何东西，那么最简单的方法是： - 操作普通文件夹浏览对话框以包含复选框功能；或 - 操作 TreeView 控件以使用 Shell 图标作为路径（以便桌面、我的音乐、普通文件夹、文件等正确的*系统*图标），以便我自己构建一个？

注意：我希望对话框/控件同时显示文件*和*文件夹。

提前感谢任何提示和提示。=)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T18:00:07.343

从树vew开始。（不过，您必须自己处理动态获取孩子）。

如果您不关心资源管理器命名空间（即在我的电脑下方有控制面板，或者在下面有回收站、网络邻居和其他一些东西的桌面），并且只需要带有驱动器号的驱动器上的文件，您可以从枚举驱动器开始字母（使用 System.IO.Directory.GetLogicalDrives）。

您可以通过从 ManagedWinapi 库 ( [http://mwinapi.sourceforge.net/](http://mwinapi.sourceforge.net/) ) 调用 ExtendedFileInfo.GetIconForFilename 来获取 shell 图标，该库适用于文件和文件夹。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T17:48:45.187

实现此类功能的最简单方法是使用标准 TreeView 控件，并将 CheckBoxes 属性设置为 true。如果您想在每个节点旁边添加一个小文件夹图像，您还应该能够使用图像。

[有关详细信息，请参阅此 MSDN 文章。](http://msdn.microsoft.com/en-us/library/system.windows.forms.treeview.checkboxes.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-10T04:29:58.977

FolderBrowserDialog 不支持复选框。查看[FolderView](http://www.ssware.com/fldrview.htm)控件，它在文件夹和文件旁边显示多状态复选框。

# objective-c - 如果选中（可可），您将如何使复选框删除表中的一行？

> ID：778367
> 
> 赞同：0
> 
> 时间：2009-04-22T17:37:00.987
> 
> 标签：objective-c, cocoa, core-data

我的应用程序使用 Coredata 并在表格中显示数据，一列有一个复选框，一列有标题。**我想要它做的是，当复选框被选中时，它会删除该行**，而不是使用“删除/减号”按钮的人。我想要这个的原因是因为我的应用程序是一个任务管理应用程序。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T17:52:50.183

这听起来像是一个糟糕的用户界面设计。轻轻一按，任务就消失了。您应该做的是让复选框设置一个“已完成”标志，然后您的视图可以以不同的方式显示该任务（例如带有文本删除线或变灰）或为用户提供不显示带有标志集的条目的选项。

# visual-studio-2008 - VS 2008 Intellisense 右击挂起

> ID：778372
> 
> 赞同：5
> 
> 时间：2009-04-22T17:37:38.053
> 
> 标签：visual-studio-2008, intellisense, freeze

我在 Visual Studio 2008 SP1 中有一个相当大的 C++ 解决方案。当我右键单击时，我在状态栏中看到更新的智能感知，整个工作室冻结了几分钟。

右键单击在 2005 年运行良好。

任何解决方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T17:54:51.507

在大型项目上更新智能感知只会降低生产力 - Visual Assist 是一个更好的替代品。我认为虽然智能感知也与 VS 为设计器解析代码的方式有关，但一个更临时的测试解决方案是将 .ncb 文件替换为名为 [solution].ncb 的文件夹

我强烈推荐 Visual Assist

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T18:28:20.363

删除你的 ncb 文件，让它们重新生成。这就是我们通常在智能感知表现不佳时解决它的方法。它需要一点再生，但它是值得的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T17:42:25.903

众所周知，Intellisense 会扼杀大型 C++ 项目。我找到的唯一可靠的解决方案（尽管他们尝试修复）是通过删除/重命名来禁用 Intellisense `Program Files (x86)\Microsoft Visual Studio 9.0\VC\vcpackages\feacp.dll`。

幸运的是，我发现像 Visual Assist 这样的插件是 Intellisense 的绝佳替代品。

# javascript - 使用 Google 网站优化器测试动态页面

> ID：778374
> 
> 赞同：3
> 
> 时间：2009-04-22T17:39:18.377
> 
> 标签：javascript, testing, dynamic, quotes, ab-testing

假设我有一个显示有关餐馆信息的网站。所有的 url 都被命名为 /restaurants/some-dynamic-restaurant-name/ 例如.../restaurants/somename **1** /, /restaurants/somename **2** / etc... 如何使用 GWO 进行 IA/B 测试或多变量测试，一次实验中的所有餐厅页面？

更新：我在谷歌网站优化器论坛中创建了一个问题，这是我得到的答复：[http ://www.google.com/support/forum/p/websiteoptimizer/thread?tid=5c6ef8fab27cf719&hl=en&fid=5c6ef8fab27cf719000468877f441f7b](http://www.google.com/support/forum/p/websiteoptimizer/thread?tid=5c6ef8fab27cf719&hl=en&fid=5c6ef8fab27cf719000468877f441f7b)

更新：在[http://www.google.com/support/websiteoptimizer/bin/answer.py?hl=en&answer=61201](http://www.google.com/support/websiteoptimizer/bin/answer.py?hl=en&answer=61201)之后，我获取了一个示例网址 www.mysite.com/restaurants/dynamic_restaurant_name_here/。我在该页面中有一个显示餐厅名称的 h1 标题。我按照 GWO 规则将其作为一个部分包含在内。我使用 h2、h3 创建了它的变体。所以它应该为同一家餐厅的不同用户显示 h2 标头或 h3 标头。

相反，对于每个其他餐厅页面，它都显示相同（或仅一个）餐厅名称，因为它所知道的只是那个。但是您提供的链接向我保证我可以测试类似的场景（检查 GWO 链接内容的前几行），但这并没有发生。所以对于每个动态餐厅页面，我想检查不同的标题。这可能吗？我该怎么办？

更新：我发布了我自己问题的答案。但是有没有更好的方法呢？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-27T21:15:42.280

对于您的第一个问题，不，查询参数不会被剥离。实际上，在重定向到备用 URL 之前，原始页面的参数与备用 URL 的参数合并。

关于您的第二个问题，请参阅：

```
http://www.gwotricks.com/2009/02/advanced-ab-experiments.html 
```

这向您展示了如何控制访问者被重定向到的 URL。这将允许您测试所有餐厅页面。从本质上讲，您创建了一个多变量实验，挂钩重定向并构建访问者被重定向到的适当 URL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-28T08:46:56.373

我遵循了这个：[http](http://www.google.com/support/websiteoptimizer/bin/answer.py?hl=en&answer=61201) ://www.google.com/support/websiteoptimizer/bin/answer.py?hl=en&answer= 61201 我得到了我想要的。但后来我开始以大规模的方式使用相同的方法，这意味着，通过在 GWO 端翻转一个变量，我想翻转整个模板设计。即.. version=1 将加载layout1，version=2 将加载layout 2。所以我在javascript 中检索模板内容。这是它的样子：

```
<script type='text/javascript'>
if(version==1){
content_to_be_loaded = "<Two pane layout html content>"
}else{
content_to_be_loaded = "<Three pane layout html content>"
}
</script> 
```

这听起来不错。但是使用的双引号与 html 内容的双引号发生冲突。所以 javascript 无法计算变量“content_to_be_loaded”的值。我可以通过标准化模板文本以仅使用一种引号来解决这个问题。但这太荒谬了。有没有替代方法？

# c++ - 如何将位集数据写入文件？

> ID：778378
> 
> 赞同：4
> 
> 时间：2009-04-22T17:41:06.687
> 
> 标签：c++, fstream, bitset

我有一个 std::bitset 我想逐位写入文件，但是 fstream 的 write 函数当然不支持这个。除了使用字符串将每个 8 位组转换为 char 并编写它之外，我想不出另一种方法......

有谁知道好的方法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T17:46:21.277

尝试：

```
#include <bitset>
#include <fstream>

int main() {
    using namespace std;
    const bitset<12> x(2730ul); 
    cout << "x =      " << x << endl;

    ofstream ofs("C:\\test.txt"); // write as txt
    if (ofs) {
        // easy way, use the stream insertion operator
        ofs << x << endl;

        // using fstream::write()
        string s = x.to_string();
        ofs.write(s.c_str(), s.length()); 
    }
    return 0;
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T18:19:17.733

好吧，“一种”的做法是使用字符串作为您的序列化方法。有一个接受字符串参数的 bitset 构造函数，还有一个返回 1 的 to_string() 成员函数。还有 << 和 >> 辅助运算符使用构造函数和 to_string() 函数进行流插入和提取。根据您的要求，这可能对您有用。

在一个应用程序中这对我们来说不够紧凑，所以我们最终编写了一个看起来像 bitset 的类（具有相同的接口），但它也可以作为字节流序列化，这意味着它具有返回指向底层的指针的函数组成它的字节数组。如果您有几个实现的源代码可以查看，那么编写起来并不难。

# naming-conventions - 匿名类型的良好命名约定

> ID：778380
> 
> 赞同：-2
> 
> 时间：2009-04-22T17:41:30.680
> 
> 标签：naming-conventions, anonymous-types, notation, hungarian-notation

匿名类型可以被认为是“设置一次”`Object`类型，而普通的 old`Object`或 Variant 可以设置多次。对象或变体的寿命往往很短，而匿名类型的寿命预计会更长，因此*传达意图*很重要。

使用匿名类型时，您使用什么命名约定来*传达意图？*

我搜索了“命名约定”问题，但对于与对象或变体不同的匿名类型，答案仍然难以捉摸。

匈牙利符号就像舞会之夜的一个巨大的鼻子疙瘩，所以那里可能没有什么用处。

既然匿名类型一旦被实例化就不能改变，不应该根据它的意图来命名吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T17:54:11.383

当我在 Java Swing 应用程序中使用匿名类型时，我以下列方式使用它们：

```
private ActionListener [actionPerforming]Action = new ActionListener(){ /*Stuff Here*/}; 
```

这样就很清楚变量在做什么。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-02-04T13:41:27.970

Well, it may seem somewhat of an oxymoron but shouldn't you use whatever naming convention means the most to you, as the developer? Whatever appeals to you, makes you most comfortable..

Personally, I used to favour Hungarian Notation but I was recently converted to the camelCase (Microsoft?) method by the elegance of it. It's a matter of personal choice, really.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-04T13:46:33.420

查看匈牙利符号命名约定。 [http://en.wikipedia.org/wiki/Hungarian_notation](http://en.wikipedia.org/wiki/Hungarian_notation)

```
nSize : integer (systems) or count (application)
iSize : integer (systems) or index (application)    
bBusy : boolean
chInitial : char
cApples : count of items
dwLightYears : double word (systems)
fBusy : boolean (flag)
fpPrice: floating-point 
```

# python - 在 Django 中接受电子邮件地址作为用户名

> ID：778382
> 
> 赞同：84
> 
> 时间：2009-04-22T17:42:20.460
> 
> 标签：python, django, authentication

有没有在 Django 中执行此操作而无需滚动我自己的身份验证系统的好方法？我希望用户名是用户的电子邮件地址，而不是他们创建用户名。

请指教

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2012-02-03T20:20:55.520

对于其他想要这样做的人，我建议看一下[django-email-as-username](https://github.com/dabapps/django-email-as-username)，这是一个非常全面的解决方案，其中包括修补管理员和`createsuperuser`管理命令，以及其他一些零碎的东西。

**编辑**：从 Django 1.5 开始，您应该考虑使用[自定义用户模型](https://docs.djangoproject.com/en/dev/topics/auth/customizing/#auth-custom-user)而不是[django-email-as-username](https://github.com/dabapps/django-email-as-username)。

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-04-22T17:46:39.763

这就是我们所做的。它不是一个“完整”的解决方案，但它可以满足您的大部分需求。

```
from django import forms
from django.contrib import admin
from django.contrib.auth.admin import UserAdmin
from django.contrib.auth.models import User

class UserForm(forms.ModelForm):
    class Meta:
        model = User
        exclude = ('email',)
    username = forms.EmailField(max_length=64,
                                help_text="The person's email address.")
    def clean_email(self):
        email = self.cleaned_data['username']
        return email

class UserAdmin(UserAdmin):
    form = UserForm
    list_display = ('email', 'first_name', 'last_name', 'is_staff')
    list_filter = ('is_staff',)
    search_fields = ('email',)

admin.site.unregister(User)
admin.site.register(User, UserAdmin) 
```

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2014-08-13T04:39:42.820

这是一种方法，可以同时接受用户名和电子邮件：

```
from django.contrib.auth.forms import AuthenticationForm
from django.contrib.auth.models import User
from django.core.exceptions import ObjectDoesNotExist
from django.forms import ValidationError

class EmailAuthenticationForm(AuthenticationForm):
    def clean_username(self):
        username = self.data['username']
        if '@' in username:
            try:
                username = User.objects.get(email=username).username
            except ObjectDoesNotExist:
                raise ValidationError(
                    self.error_messages['invalid_login'],
                    code='invalid_login',
                    params={'username':self.username_field.verbose_name},
                )
        return username 
```

不知道是否有一些设置可以设置默认身份验证表单，但您也可以覆盖 urls.py 中的 url

```
url(r'^accounts/login/$', 'django.contrib.auth.views.login', { 'authentication_form': EmailAuthenticationForm }, name='login'), 
```

提交无效电子邮件时，提高 ValidationError 将防止 500 错误。使用超级用户对“invalid_login”的定义会使错误消息不明确（相对于特定的“未找到该电子邮件的用户”），这将是防止泄漏电子邮件地址是否已在您的服务上注册帐户所必需的。如果该信息在您的体系结构中不安全，则提供更多信息的错误消息可能更友好。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2014-10-13T08:57:09.277

Django 现在提供了一个带有管理员和表单的扩展身份验证系统的完整示例：[https ://docs.djangoproject.com/en/stable/topics/auth/customizing/#a-full-example](https://docs.djangoproject.com/en/stable/topics/auth/customizing/#a-full-example)

您基本上可以复制/粘贴它并进行调整（在我的情况下我不需要`date_of_birth`）。

它实际上是从 Django 1.5 开始可用的，并且现在仍然可用（django 1.7）。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2015-04-14T22:54:45.503

如果要扩展用户模型，则无论如何都必须实现自定义用户模型。

这是 Django 1.8 的示例。Django 1.7 需要更多的工作，主要是更改默认表单（只需查看`UserChangeForm`& `UserCreationForm`in `django.contrib.auth.forms`- 这就是您在 1.7 中需要的）。

用户管理器.py：

```
from django.contrib.auth.models import BaseUserManager
from django.utils import timezone

class SiteUserManager(BaseUserManager):
    def create_user(self, email, password=None, **extra_fields):
        today = timezone.now()

        if not email:
            raise ValueError('The given email address must be set')

        email = SiteUserManager.normalize_email(email)
        user  = self.model(email=email,
                          is_staff=False, is_active=True, **extra_fields)

        user.set_password(password)
        user.save(using=self._db)
        return user

    def create_superuser(self, email, password, **extra_fields):
        u = self.create_user(email, password, **extra_fields)
        u.is_staff = True
        u.is_active = True
        u.is_superuser = True
        u.save(using=self._db)
        return u 
```

模型.py：

```
from mainsite.user_manager import SiteUserManager

from django.contrib.auth.models import AbstractBaseUser
from django.contrib.auth.models import PermissionsMixin

class SiteUser(AbstractBaseUser, PermissionsMixin):
    email    = models.EmailField(unique=True, blank=False)

    is_active   = models.BooleanField(default=True)
    is_admin    = models.BooleanField(default=False)
    is_staff    = models.BooleanField(default=False)

    USERNAME_FIELD = 'email'

    objects = SiteUserManager()

    def get_full_name(self):
        return self.email

    def get_short_name(self):
        return self.email 
```

表格.py：

```
from django.contrib import admin
from django.contrib.auth.admin import UserAdmin
from django.contrib.auth.forms import UserChangeForm, UserCreationForm
from mainsite.models import SiteUser

class MyUserCreationForm(UserCreationForm):
    class Meta(UserCreationForm.Meta):
        model = SiteUser
        fields = ("email",)

class MyUserChangeForm(UserChangeForm):
    class Meta(UserChangeForm.Meta):
        model = SiteUser

class MyUserAdmin(UserAdmin):
    form = MyUserChangeForm
    add_form = MyUserCreationForm

    fieldsets = (
        (None,              {'fields': ('email', 'password',)}),
        ('Permissions',     {'fields': ('is_active', 'is_staff', 'is_superuser',)}),  
        ('Groups',          {'fields': ('groups', 'user_permissions',)}),
    )

    add_fieldsets = (
        (None, {
            'classes': ('wide',),
            'fields': ('email', 'password1', 'password2')}
        ),
    )

    list_display = ('email', )       
    list_filter = ('is_active', )    
    search_fields = ('email',)       
    ordering = ('email',)

admin.site.register(SiteUser, MyUserAdmin) 
```

设置.py：

```
AUTH_USER_MODEL = 'mainsite.SiteUser' 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2014-12-11T22:08:47.930

其他替代方案对我来说看起来太复杂了，所以我编写了一个片段，允许使用用户名、电子邮件或两者进行身份验证，并启用或禁用区分大小写。[我将它作为django-dual-authentication](https://github.com/Zeioth/django-dual-authentication)上传到 pip 。

```
from django.contrib.auth.backends import ModelBackend
from django.contrib.auth import get_user_model
from django.conf import settings

###################################
"""  DEFAULT SETTINGS + ALIAS   """
###################################

try:
    am = settings.AUTHENTICATION_METHOD
except:
    am = 'both'
try:
    cs = settings.AUTHENTICATION_CASE_SENSITIVE
except:
    cs = 'both'

#####################
"""   EXCEPTIONS  """
#####################

VALID_AM = ['username', 'email', 'both']
VALID_CS = ['username', 'email', 'both', 'none']

if (am not in VALID_AM):
    raise Exception("Invalid value for AUTHENTICATION_METHOD in project "
                    "settings. Use 'username','email', or 'both'.")

if (cs not in VALID_CS):
    raise Exception("Invalid value for AUTHENTICATION_CASE_SENSITIVE in project "
                    "settings. Use 'username','email', 'both' or 'none'.")

############################
"""  OVERRIDDEN METHODS  """
############################

class DualAuthentication(ModelBackend):
    """
    This is a ModelBacked that allows authentication
    with either a username or an email address.
    """

    def authenticate(self, username=None, password=None):
        UserModel = get_user_model()
        try:
            if ((am == 'email') or (am == 'both')):
                if ((cs == 'email') or cs == 'both'):
                    kwargs = {'email': username}
                else:
                    kwargs = {'email__iexact': username}

                user = UserModel.objects.get(**kwargs)
            else:
                raise
        except:
            if ((am == 'username') or (am == 'both')):
                if ((cs == 'username') or cs == 'both'):
                    kwargs = {'username': username}
                else:
                kwargs = {'username__iexact': username}

                user = UserModel.objects.get(**kwargs)
        finally:
            try:
                if user.check_password(password):
                    return user
            except:
                # Run the default password hasher once to reduce the timing
                # difference between an existing and a non-existing user.
                UserModel().set_password(password)
                return None

    def get_user(self, username):
        UserModel = get_user_model()
        try:
            return UserModel.objects.get(pk=username)
        except UserModel.DoesNotExist:
            return None 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2012-07-12T19:42:37.240

最新版本的 django-registration 允许一些不错的自定义，并且可以完成这项工作 - 此处的文档[https://bitbucket.org/ubernostrum/django-registration/src/fad7080fe769/docs/backend-api.rst](https://bitbucket.org/ubernostrum/django-registration/src/fad7080fe769/docs/backend-api.rst)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-09-06T04:36:30.487

```
 if user_form.is_valid():
        # Save the user's form data to a user object without committing.
        user = user_form.save(commit=False)
        user.set_password(user.password)
        #Set username of user as the email
        user.username = user.email
        #commit
        user.save() 
```

完美运行...对于 django 1.11.4

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-23T11:09:40.380

您还可以在以下链接中找到有关此主题的有趣讨论：

[http://groups.google.com/group/django-users/browse_thread/thread/c943ede66e6807c/2fbf2afeade397eb#2fbf2afeade397eb](http://groups.google.com/group/django-users/browse_thread/thread/c943ede66e6807c/2fbf2afeade397eb#2fbf2afeade397eb)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2014-06-05T23:07:08.477

最简单的方法是在登录视图中根据电子邮件查找用户名。这样，您就可以不理会其他所有内容：

```
from django.contrib.auth import authenticate, login as auth_login

def _is_valid_email(email):
    from django.core.validators import validate_email
    from django.core.exceptions import ValidationError
    try:
        validate_email(email)
        return True
    except ValidationError:
        return False

def login(request):

    next = request.GET.get('next', '/')

    if request.method == 'POST':
        username = request.POST['username'].lower()  # case insensitivity
        password = request.POST['password']

    if _is_valid_email(username):
        try:
            username = User.objects.filter(email=username).values_list('username', flat=True)
        except User.DoesNotExist:
            username = None
    kwargs = {'username': username, 'password': password}
    user = authenticate(**kwargs)

        if user is not None:
            if user.is_active:
                auth_login(request, user)
                return redirect(next or '/')
            else:
                messages.info(request, "<stvrong>Error</strong> User account has not been activated..")
        else:
            messages.info(request, "<strong>Error</strong> Username or password was incorrect.")

    return render_to_response('accounts/login.html', {}, context_instance=RequestContext(request)) 
```

在您的模板中相应地设置下一个变量，即

```
<form method="post" class="form-login" action="{% url 'login' %}?next={{ request.GET.next }}" accept-charset="UTF-8"> 
```

并给您的用户名/密码输入正确的名称，即用户名、密码。

**更新**：

或者， if _is_valid_email(email): 调用可以替换为用户名中的 if '@'。这样您就可以删除 _is_valid_email 函数。这实际上取决于您如何定义用户名。如果您在用户名中允许使用“@”字符，它将不起作用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2015-11-10T05:45:32.200

我认为最快的方法是创建一个表单继承自`UserCreateForm`，然后`username`用 覆盖该字段`forms.EmailField`。然后对于每个新注册用户，他们需要使用他们的电子邮件地址登录。

例如：

**网址.py**

```
...
urlpatterns += url(r'^signon/$', SignonView.as_view(), name="signon") 
```

**视图.py**

```
from django.contrib.auth.models import User
from django.contrib.auth.forms import UserCreationForm
from django import forms

class UserSignonForm(UserCreationForm):
    username = forms.EmailField()

class SignonView(CreateView):
    template_name = "registration/signon.html"
    model = User
    form_class = UserSignonForm 
```

**登录.html**

```
...
<form action="#" method="post">
    ...
    <input type="email" name="username" />
    ...
</form>
... 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2016-02-19T15:09:55.107

不确定人们是否正在尝试完成此操作，但我找到了一种很好（且干净）的方式，只要求输入电子邮件，然后在保存之前将用户名设置为视图中的电子邮件。

我的用户表单只需要电子邮件和密码：

```
class UserForm(forms.ModelForm):
    password = forms.CharField(widget=forms.PasswordInput())

    class Meta:
        model = User
        fields = ('email', 'password') 
```

然后在我看来，我添加了以下逻辑：

```
if user_form.is_valid():
            # Save the user's form data to a user object without committing.
            user = user_form.save(commit=False)

            user.set_password(user.password)
            #Set username of user as the email
            user.username = user.email
            #commit
            user.save() 
```

# ruby-on-rails - Rails POST、PUT、GET

> ID：778385
> 
> 赞同：58
> 
> 时间：2009-04-22T17:43:15.543
> 
> 标签：ruby-on-rails, ruby, web-services, http

在我生成一个脚手架后，Rails 让我能够 POST 到`items.xml`其中创建一个新的`item`. 一个 GET`items.xml`将简单地列出它们。根据我正在执行的操作类型，Rails 在哪里指定将调用控制器中的哪个方法（`create`或，分别）？`index`

更具体地说，POST 调用方法 A，但 GET 到相同的 URL 调用方法 B。这是在哪里指定的？Rails 在哪里决定调用`index`控制器的方法？

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-04-22T17:47:59.180

我相信它是由[REST](http://en.wikipedia.org/wiki/Representational_State_Transfer)指定的。这是给你的清单：

```
GET    /items        #=> index
GET    /items/1      #=> show
GET    /items/new    #=> new
GET    /items/1/edit #=> edit
PUT    /items/1      #=> update
POST   /items        #=> create
DELETE /items/1      #=> destroy 
```

**编辑添加**以获取所有这些路由，在 config/routes.rb 中，只需添加`map.resources :items`

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2009-04-22T19:51:48.447

Rails 按照惯例为 RESTful 资源定义了七种控制器方法。他们是：

```
动作 HTTP 方法 目的
-------------------------------------------------- ----------------------
index GET 显示资源集合
show GET 显示单个资源
new GET 显示用于创建新资源的表单
create POST 创建一个新资源（新提交到这个）
edit GET 显示用于编辑现有资源的表单
update PUT 更新现有资源（编辑提交至此）
destroy DELETE 销毁单个资源

```

请注意，由于 Web 浏览器通常只支持 GET 和 POST，Rails 使用隐藏字段将它们转换为适当的 PUT 和 DELETE 请求。

指定`map.resources :items`in`config/routes.rb`可以“免费”获得这七种方法。您可以随时通过`rake routes`在控制台中输入来列出应用程序中的所有路由。

*   有关详细信息，请参阅[从外向内的 Rails 路由](http://guides.rubyonrails.org/routing.html)。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-22T17:48:59.273

了解这一点的最佳地点是[路由指南](http://guides.rubyonrails.org/routing.html)。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2012-04-26T16:43:45.263

您想知道如何仅使用 POST 吗？这样做，例如：

```
resources :items, :only => [:create] 
```

..ETC。顺便说一下，这是针对 Rails 3 的，它将生成一个资源来 POST 创建。或者，如果您只需要 REST 集的一小部分，只需：

```
match 'items/:id' => "items#create', :via => :post 
```

等等等等

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-22T17:54:13.130

就像 Don Werve 说的，看看你的 routes.rb 文件。在那里你可能有这样的东西：

```
map.resources :items 
```

这是 rails 将 POST 和 GET 请求链接到某些操作的地方。要了解其工作原理，请查看其他答案中的链接。文档帮助了很多。

`rake routes`当您位于 rails 目录的根目录时，可以在命令提示符中键入所有路由以及它们链接到的操作。这将向您展示脚手架为您提供的所有内容（在路由方面）。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-22T19:14:23.513

这将有很大帮助，但这不是您问题的直接答案。以下命令将列出您的应用程序使用的映射，因此您不必记住所有细节或猜测。

```
$ rake routes 
```

为了更直接地回答，这是 rails 使用的约定。当您在您的 routes.rb 中放置类似以下内容时，您设置了此映射

```
map.resources :items 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-22T20:00:09.987

map.resources 是一种自动为您提供 REST 路由和路径助手的方法。如果您已经了解并了解 rails 的 restful 路由是如何工作的，这是一个很好的功能，但它也对学习 rails 有一点阻碍，因为隐藏了太多东西。

[Railsguides](http://guides.rubyonrails.org/)有一个不错的[路线指南](http://guides.rubyonrails.org/routing.html)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-04-25T14:57:37.840

老实说，Rails 网站上的路由文档不会出错。这有助于采取下一步措施，超越资源的舒适性（这对于大多数应用程序来说都很好），并真正确定了可用的可靠路由功能。

[http://guides.rubyonrails.org/routing.html](http://guides.rubyonrails.org/routing.html)

# language-agnostic - 需要帮助解决 Project Euler 问题 200

> ID：778387
> 
> 赞同：0
> 
> 时间：2009-04-22T17:43:20.207
> 
> 标签：language-agnostic

我正在尝试制定一种算法来解决[Project Euler's Problem 200](http://projecteuler.net/index.php?section=problems&id=200)。

> 我们将一个正方形定义为一个数，形式为*p ² q ³*，其中*p*和*q*是不同的素数。例如，200 = 5 ² 2 ³或 120072949 = 23 ² 61 ³。
> 
> 前五个方形是 72、108、200、392 和 500。
> 
> 有趣的是，200 也是第一个不能改变任何一位数来构成质数的数字。我们称这些数字为质数证明。下一个包含连续子字符串“200”的素数证明方格是 1992008。
> 
> 找到包含连续子字符串“200”的第 200 个质数证明方格。

有人可以指出我正确的方向来帮助我解决这个问题吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T18:14:22.987

我不确定这是一个很好的 SO 问题，但这至少应该让你开始。

从算法上讲，蛮力和无知的方法应该非常简单：

1.  从素数集 P 开始
2.  通过查看所有有序对 (p1,p2) 和 P 中的 p1,p2 来生成“squbes”
3.  订购此列表，调用集合 S（想想：你怎么能在生成它们时做到这一点）
4.  依次测试S中的每个s，寻找子串200
5.  如果 s 包含 "200" 测试 s 的每个一位数的修改，看看它是否是素数
6.  如果它们都不是质数，那么您已经找到了质数证明的方格。把它放在一个列表中，当你找到第 200 个时，你就完成了。

现在这里更有趣的是看看你是否可以做一些不那么蛮力和无知的事情。首先，以上内容是否实用（假设快速素性测试）？很容易估计squbes 的增长速度，但对于prime-proof 的squbes 或包含200 个squbes 的squbes 来说并没有那么快。你能看到任何捷径吗？

玩得开心！

# apache - 在 apache 2.2 中加载 FastCGI 模块时出错

> ID：778392
> 
> 赞同：1
> 
> 时间：2009-04-22T17:45:21.963
> 
> 标签：apache, cgi, fastcgi

我正在使用 apache 2.2（xampp 发行版的一部分），我试图使用 fastcgi 加载我用 lua 编写的脚本，所以我在 httpd.conf 中添加了这个：

LoadModule mod_fcgi 模块/mod_fcgid.so

现在，当我尝试启动 apache 时，出现以下错误：

/xampp/apache/conf/httpd.conf 的第 530 行语法错误：在文件 /xampp/apache/modules/mod_fcgid.so 中找不到 API 模块结构“mod_fcgi”：没有错误

该文件在那里并且路径正确，该错误消息是什么意思？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T21:00:08.877

我认为应该是

```
LoadModule fcgid_module modules/mod_fcgid.so 
```

Apache 模块结构通常称为 foo_module，用于名为 mod_foo.so 的库。这可能是有原因的，但我不知道它是什么:-)

# database - 什么是数组/有序查找数据库？

> ID：778396
> 
> 赞同：1
> 
> 时间：2009-04-22T17:46:12.993
> 
> 标签：database, performance, arrays, map, seek

我正在寻找支持以下功能的数据库：

1) 数据库中的记录就像 Python 字典或 Perl 哈希。例如，“购买”记录可能如下所示：

```
<purchase 5436> = { product: "BMX Bike", price: 99.50, city: "Springfield" } 
```

2) 记录存储在可变长度的数组中。数据库包含很多这样的数组。例如，购买表可能如下所示：

```
purchase array 1: [ <purchase 5436>, <purchase 54>, <purchase 112> ]
purchase array 2: [ <purchase 76>, <purchase 5984>, <purchase 1102>, <purchase 12> ]
...
purchase array 658: [ <purchase 10142>, <purchase 35>, <purchase 6458>, <purchase 23> ] 
```

3）我希望能够对这个数据库进行两种查询：

3a) 计算匹配各种标准的记录数。例如，有多少购买价值超过 50？我知道很多支持这一点的数据库。

3b) 计算记录按一定顺序出现的次数。例如，有多少个阵列购买了超过 50 个，然后在“Springfield”中进行了购买？我不知道您将使用哪种数据库来执行此操作。

编辑：对 Steve Haigh 的回应：我应该提到速度很重要，而且这个数据库需要支持千兆字节的数据。例如，可能有 1,000,000,000 个购买数组，我想计算其中有多少是在“Springfield”中购买，然后在“Hometown”中购买（注意顺序很重要）。也许我错了，但我认为关系数据库对于这个目的来说太慢了。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-10T08:24:58.063

> 例如，可能有 1,000,000,000 个购买数组，我想计算其中有多少在“Springfield”中购买，然后在“Hometown”中购买（注意顺序很重要）。也许我错了，但我认为关系数据库对于这个目的来说太慢了。

您所描述的是典型的[数据仓库](http://en.wikipedia.org/wiki/Data_warehouse)查询，而 AFAIK 这些通常是使用关系数据库实现的，尽管这些数据库针对报告而不是并发事务处理进行了优化。但是，如果您使用“常规”RDBMS，我认为速度差异不会太大。当然，如果你有足够的钱，你可以选择一个特殊的数据仓库 DBMS。

对速度最重要的影响是 1) 一种为查询基于磁盘的大型数据集而优化的技术——这正是所有“真正的”DMBS 所提供的，以及 2) 以正确的方式组织数据。

> 3b) 计算记录按一定顺序出现的次数。例如，有多少个阵列购买了超过 50 个，然后在“Springfield”中进行了购买？我不知道您将使用哪种数据库来执行此操作。

[您将使用具有旨在支持这种查询的模式](http://en.wikipedia.org/wiki/Star_schema)的关系数据库。您将不得不放弃对数据应如何表示的先入为主的观念。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T17:54:17.887

您确定不能使用链接或联结表对关系数据库执行此操作吗？

您将有一列订单、一列产品和一个表 order-products，其中每个订单的每个产品都有一行。

我认为这篇[文章](http://www.tomjewett.com/dbdesign/dbdesign.php?page=manymany.php)可能比我能表达得更好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-15T20:57:18.667

您实际上并不需要关系数据库，因为您只是将键-> 值对分组在集合中，您需要在两个表之间进行连接（一个用于记录，一个用于集合）以迭代集合中的记录并在你的案子不值得。

对于您的性能要求，您需要确保整个结构适合内存并且不需要访问磁盘。您可能需要多台服务器来执行此操作，以及将查找分派到其他服务器的主服务器（假设您的结构的大小大于现代服务器可以处理的合理内存量，并且您的速度要求如此大到你负担不起磁盘分页。

对于您提到的那种查询，您最好的选择是有一点数据冗余。在插入时，您将跟踪这些计数。数据冗余只会通过阅读名称来吓坏人们，但有时这是必要的。只是要非常小心你的实现，并在这里投入大量的单元测试。

但是，可能存在某种查询，您将永远无法在几毫秒内实时完成，并且关于查找具有一种条件的购买，然后是具有另一种条件的购买的查询似乎是这样的。要么您找到一种在插入/删除/修改时保持实时跟踪此数字的方法，要么您将不得不实际迭代数百万个数组，无法避免这种情况。您将需要考虑您的数据需要多长时间，并且可能每隔几个小时预先计算一次以生成这些统计信息，然后能够使用查找键在 O(1) 中访问它们。

简而言之，您的问题远远超出了您决定用来解决它的技术。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T17:49:55.057

我不确定我是否完全理解您在寻找什么，但是您看过[couchdb](http://couchdb.apache.org/)吗？. 其面向文档且无模式

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-09T14:39:06.390

您所描述的内容与[MUMPS](http://en.wikipedia.org/wiki/MUMPS)非常相似，即使我对定义数组中“记录”顺序可能的查询的能力有一些疑问。

看看这个链接，你会看到它还有当前的商业版本。

# html - 在网页中嵌入 IRC 客户端的最佳方式

> ID：778430
> 
> 赞同：12
> 
> 时间：2009-04-22T17:55:27.120
> 
> 标签：html, irc

我正在寻找一个好的、免费的、最好是开源的 IRC 客户端来嵌入到网页中。

支持大多数浏览器的明显要求是，如果需要一个插件，它应该是一个已经广泛部署的插件，并且它不应该对服务于页面的网络服务器造成太大的压力。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T17:59:54.987

不是一个真正的编程问题，但[Mibbit](http://mibbit.com/)非常有能力，我已经将它用于几个不同的应用程序，它总是运行良好。

请注意，如果您的频道位于[此处列出的支持 WEBIRC 的网络](http://mibbit.com/networks/)之一，则效果最佳。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-12-18T16:51:07.583

一个常用的开源平台是[QwebIRC](http://qwebirc.org/)。在带有 javascript 前端的 python 中，但有各种打包问题。[KiwiIRC](http://kiwiirc.com/)看起来很有趣，但我还没有尝试过，所以我不能保证。KiwiIRC 都是 javascript。两者都可以嵌入到 iframe 或类似的东西中。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-05-02T14:20:25.840

可以嵌入 iframe。 [http://webchat.freenode.net/?channels=channel_name](http://webchat.freenode.net/?channels=channel_name)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T18:01:33.347

我以前见过这些，但我从来没有真正喜欢过它们。我认为最好的整体是[Mibbit](http://www.mibbit.com/)。我认为最好的方法是要求用户安装客户端并使用 irc:// 链接语法来启动本机客户端。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T18:05:05.223

我假设一个java小程序会通过多平台/浏览器的要求？

[Pjirc](http://www.pjirc.com/) 它不是我个人使用过的，但我见过不少网站在使用它。

# c++ - 如何在 flex 和 bison 中使用 C++？

> ID：778431
> 
> 赞同：7
> 
> 时间：2009-04-22T17:55:28.507
> 
> 标签：c++, c, bison, flex-lexer

我有一个学校项目，我们需要使用 flex 和 bison。我想使用 C++，以便可以访问 STL 和我自己编写的类。我们获得了以下 Makefile：

```
CC = gcc 
CFLAGS = -g 

OBJs = parse.tab.o symtab.o attr.o lex.yy.o 

default: parser

parser: ${OBJs}
    ${CC} ${CFLAGS} ${OBJs} -o parser -lfl

lex.yy.c: scan.l parse.tab.h attr.h
    flex -i scan.l

parse.tab.c: parse.y attr.h symtab.h
    bison -dv parse.y

parse.tab.h: parse.tab.c

clean:
    rm -f parser lex.yy.c *.o parse.tab.[ch] parse.output

depend:
    makedepend -I. *.c 
```

scan.l 和 parse.y 有一些初始的 flex/bison 东西来生成扫描器和解析器。我需要将我自己的东西添加到这些文件中。symtab.{h, c} 应该是符号表的实现。attr.{h, c} 用于某些属性魔法。我想制作 symtab.ca .cc 文件，这样我就可以使用 STL。我还有其他想要使用 C++ 的原因。

我尝试使用 parse.ypp 文件，以便生成 .cpp 文件。但问题是我没有得到正确的 .h 文件。我将 Makefile 更改为如下所示：

```
CC = g++          # Change gcc to g++
CFLAGS = -g 

OBJs = lex.yy.o parse.tab.o symtab.o attr.o

default: lex.yy.c parser    # added lex.yy.c so I could just keep lex stuff in C since I don't really need C++ there

parser: ${OBJs}
    ${CC} ${CFLAGS} ${OBJs} -o parser -lfl

lex.yy.o: scan.l parse.tab.h attr.h      # added this rule to use gcc instead of g++
    gcc -c -o lex.yy.o lex.yy.c

lex.yy.c: scan.l parse.tab.h attr.h
    flex -i scan.l

parse.tab.cpp: parse.ypp attr.h symtab.h
    bison -dv parse.ypp

parse.tab.h: parse.tab.cpp      # I want a parse.tab.h but I get parse.tab.hpp

clean:
    rm -f parser lex.yy.c *.o parse.tab.cpp parse.tab.h parse.output

depend:
    makedepend -I. *.c 
```

有人可以告诉我需要添加什么或做什么才能使 C++ 正常工作吗？应该注意的是，我在 .y（或 .ypp）文件中添加了一些东西来处理从 C 到 C++ 的迁移。特别是，我不得不将一些东西声明为 extern。我的主要问题是，当我运行 make 时，scan.l 有一堆语法错误，它们似乎是因为它不能包含 parse.tab.h（因为它永远不会生成）。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-22T18:22:02.610

你不需要对 flex 或 bison 做任何事情来使用 C++，我已经做过很多次了。你只需要确保你使用的是 g++，而不是 gcc。

您的问题在于 Makefile，而不是代码。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-23T05:26:34.260

```
For using flex with C++:
 1: read the flex docs:
 2: use flex -+ -o file.cc parser.ll
 3: In the .ll file:

%option c++
%option yyclass="Your_class_name"
%option batch

 4: In your .hh file, derive Your_class_name from  public yyFlexLexer
 5: you can then use your_class_instance.yylex() 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T03:29:23.573

[您可以在此处](http://www.gnu.org/software/bison/manual/bison.html#C_002b_002b-Parsers)详细查看其中的一些差异 。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T18:01:49.927

使用 C 编译器或 C++ 编译器，但不能同时使用两者（直到您知道自己在做什么）。否则，您肯定会用双脚多次射击自己。混合 gcc 和 g++ 并不好。

这条线是可疑的：

```
lex.yy.o: scan.l parse.tab.h attr.h      # added this ...
gcc -c -o lex.yy.o lex.yy.c 
```

此外，您似乎没有在`CC`任何地方使用，使用它会使生活更轻松。

假设您不更改 C 代码的任何一行，您可能会遇到一些错误和相当多的警告（如已弃用的标头等）。您还必须修复它们。

* * *

## 回答 #5

> 赞同：-3
> 
> 时间：2009-04-22T18:54:03.377

如果您正在使用 C++ 进行解析器，我建议您查看[Boost Spirit](http://spirit.sourceforge.net/)。它比 bison/yacc 好用得多。

从[这里](http://spirit.sourceforge.net/distrib/spirit_1_8_5/libs/spirit/doc/introduction.html)：

> Spirit 是一个使用模板元编程技术实现的面向对象的递归下降解析器生成器框架。表达式模板允许我们在 C++ 中完全近似扩展巴科斯范式 (EBNF) 的语法。

# c# - WSDL 没有正确解释泛型

> ID：778436
> 
> 赞同：1
> 
> 时间：2009-04-22T17:56:50.877
> 
> 标签：c#, asp.net, web-services, generics

我正在设计一个在已经非常开发的应用程序中使用错误代码的框架。

有几个处理数据库交互的 Web 服务，然后是 UI。如果 Web 服务中发生错误，则需要将错误代码传递给 UI 并进行处理（以显示用户友好的错误消息或类似的东西）。

现在，Web 服务方法传递三种对象：整数、字符串和数据集

对于整数和字符串，很容易传递错误代码（整数可以是实际代码，字符串可以以某种方式将代码添加到它的末尾）。但是，使用数据集并不是那么简单。因此，这个想法被传递到使用通用容器并将数据集和错误代码放入其中。

这是问题所在：

当我创建通用容器并尝试使用它时，我收到以下错误：

```
(Lets assume my generic class is called ErrorHandler<DatasetType>)

"Cannot convert ErrorHandlerofDatasetType to type ErrorHandler<DatasetType>" 
```

我假设 WSDL 正在错误地解释类或其他东西。有人可以对此有所了解吗？

编辑：我可能应该提到这是针对 .NET 2.0 解决方案的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T18:09:57.037

您的 WSDL 没有任何问题。

WSDL 依赖于 XML Schema 来描述数据的形状。XML Schema 没有泛型的概念。

当 .NET 看到您创建 WSDL 的请求并看到您使用的是泛型类型时，它需要生成一个可以在 XML Schema 中使用的类型名称。这就是“ErrorHandlerOfDatasetType”的来源。

创建客户端代理代码时，会检查 WSDL 中的 XML 模式。代码生成器将看到一个名为 ErrorHandlerOfDatasetType 的 complexType，并且自然会生成一个名为 ErrorHandlerOfDatasetType 的类。

现在，您似乎正在尝试将此代理类强制转换为 ErrorHandler，但显然不是。如果您使用的是“Web Reference”（您没有说），那么您的客户端中不应该有任何服务器数据类型。ASMX Web 服务不是这样构建的。

如果您正在使用 WCF（并且您应该），那么您*可以*设置“添加服务引用”对话框以在客户端和服务之间共享类型。老实说，我认为这对泛型没有帮助，因为正如我所说，知道 ErrorHandlerOfDatasetType 真正意味着 ErrorHandler 的必要信息不存在。

请注意，即使在 WCF 中，使用服务器类型也会对​​服务器程序集的版本产生依赖性，这通常不是一个好主意。

# c# - Try/Catch 和线程

> ID：778437
> 
> 赞同：14
> 
> 时间：2009-04-22T17:57:06.837
> 
> 标签：c#, multithreading, try-catch

我知道为什么，但我想问一下是否有人很好地理解了为什么线程内引发的异常永远不会被启动它的代码捕获。这是一些非常简单的代码来演示我的意思：

```
using System;
using System.Collections.Generic;
using System.Threading;

namespace TestCrash
{
    class Program
    {
        private static void Crash(object control)
        {
            AutoResetEvent are = (AutoResetEvent)(((object[])control)[0]);
            are.Set();
            throw new Exception("Burn baby burn");
        }
        static void Main(string[] args)
        {
            try
            {
                List<WaitHandle> waitHandles = new List<WaitHandle>();
                for (int i = 0; i < 100; i++)
                {
                    AutoResetEvent are = new AutoResetEvent(false);
                    waitHandles.Add(are);
                    object[] procControl = new object[] { are };
                    ThreadPool.QueueUserWorkItem(Crash, procControl);
                    WaitHandle.WaitAll(waitHandles.ToArray());
                }
            }
            catch (Exception ex)
            {
                Console.WriteLine(ex.Message);
            }
        }
    }
} 
```

我天真地认为通过 try/catch 我会很安全，但我发现事实并非如此（它正在使我的一项服务崩溃）。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-22T17:59:39.607

好吧，一般来说，在新线程中引发异常时，您不知道原始线程将在哪里 - 为什么它会等待线程抛出异常？

想想所涉及的堆栈 - 当抛出异常时，它会向上堆栈直到到达适当的 catch 块。新线程与创建线程有一个完全独立的堆栈，因此它永远不会到达创建线程堆栈中的 catch 块。

编辑：当然，您可以设计您的系统，以便创建线程*确实*等待其他事情发生 - 有点像 Windows 窗体应用程序中的消息循环。然后，新线程可以捕获异常并向创建线程发送消息，然后该线程可以处理异常。这不是正常的设置——你必须明确地做这一切。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T18:00:34.487

正在运行的线程不会被您的 try/catch 语句捕获，因为它正在另一个线程中运行。Try/Catch 仅适用于当前线程。您需要做的是在线程运行的函数中使用 try/catch，并通过某种方式管理发生崩溃时发生的情况。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-22T18:23:23.417

您可能想要使用[EventGeneratingThread 包装器](http://www.deez.info/sengelha/2004/11/24/csharp-eventgeneratingthread/)- 这将让您捕获并处理从产生它们的进程中抛出的线程中的异常。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T17:59:54.690

做出假设是个坏主意，尤其是在涉及多个线程的情况下（你知道那句老话）。

为什么启动线程的代码*会*看到异常？抛出异常时，启动线程的代码甚至可能不存在。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-08-18T13:00:10.293

尝试在您的 DoWork Sub 之前添加它

```
<System.Diagnostics.DebuggerNonUserCodeAttribute()> _ 
```

我正在使用后台工作程序，并且循环中的所有 Try Catch 都可以按照您的预期工作。

# java - 在 log4j 中配置 SMTPAppender 的正确方法是什么？

> ID：778439
> 
> 赞同：4
> 
> 时间：2009-04-22T17:57:25.337
> 
> 标签：java, smtp, log4j

我正在尝试将 log4j 配置为使用，`SMTPAppender`但我不断收到中继访问被拒绝错误。在我的笔记本电脑上和直接从我的共享托管环境中执行我的代码时，我收到了这个错误。

这是相关的配置：

```
#CONFIGURE SMTP
log4j.appender.email=org.apache.log4j.net.SMTPAppender
log4j.appender.email.SMTPHost=mydomain.com
log4j.appender.email.SMTPUsername=myuser
log4j.appender.email.SMTPPassword=mypw
log4j.appender.email.From=myuser@mydomain.com
log4j.appender.email.BufferSize=1
log4j.appender.email.EvaluatorClass=TriggerLogEvent
log4j.appender.email.layout=org.apache.log4j.PatternLayout
log4j.appender.email.layout.ConversionPattern=%m 
```

如果我改为`log4j.appender.email.SMTPHost=mail.mydomain.com`改为使用身份验证错误。我的主机在 DreamHost 上，所以如果有人`SMTPAppender`使用 DreamHost 电子邮件帐户设置了 log4j，则可以加分。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T19:17:27.640

原来我只是把所有的属性都弄错了。应该：

```
#CONFIGURE SMTP
log4j.appender.email=org.apache.log4j.net.SMTPAppender
log4j.appender.email.SMTPHost=mail.mydomain.com
log4j.appender.email.SMTPUsername=myuser@mydomain.com
log4j.appender.email.SMTPPassword=mypw
log4j.appender.email.From=myuser@mydomain.com
log4j.appender.email.BufferSize=1
log4j.appender.email.EvaluatorClass=TriggerLogEvent
log4j.appender.email.layout=org.apache.log4j.PatternLayout
log4j.appender.email.layout.ConversionPattern=%m 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T18:03:24.747

SMTPHost 应该指向您的邮件服务器（因此，`mail.mydomain.com`对于 Dreamhost）。如果您 telnet 到端口 25 并手动传递凭据，您可以手动发送邮件吗？

# c# - 带有可选字段和值的 ASP.NET MVC 查询

> ID：778446
> 
> 赞同：0
> 
> 时间：2009-04-22T18:00:00.977
> 
> 标签：c#, .net, asp.net, sql, linq

我要做的是在表格上提供通用搜索功能。因此，用户会看到表格中的所有数据，他们输入一些文本进行过滤，瞧，表格现在已根据与该条目匹配的所有结果进行过滤。

我有这个与单个字段一起工作：

```
public ActionResult Index(string user_name)
{

    var dataContext = new PurchaseOrderDataContext();

    var orders = from o in dataContext.purchase_orders
                 where o.approved_by.display_name.StartsWith(user_name ?? "")
                 select o;

    if (Request.IsAjaxRequest())
    {
        return PartialView("list", orders);
    }
    else
    {
        return View(orders);
    }
} 
```

但我正在寻找的是让他们有一个下拉菜单的能力，允许他们在他们想要过滤的字段中传递。它想要这样的东西：

```
public ActionResult Index(string field, string query_value)
{

    var dataContext = new PurchaseOrderDataContext();

    var orders = from o in dataContext.purchase_orders
                 where o["field"].StartsWith(query_value ?? "")
                 select o;

    if (Request.IsAjaxRequest())
    {
        return PartialView("list", orders);
    }
    else
    {
        return View(orders);
    }
} 
```

...除了这`o["field"]`只是我对语法的愚蠢猜测（这不起作用）。

我想我只是感到困惑，因为虽然我使用的是这个很好的分类数据模型，但有时我想明确地按名称引用列。

我该怎么做呢？

如果这很明显，我很抱歉...

**编辑：**我想我现在要让它保持开放状态，看看是否有比下面建议的更整洁、更少黑客感觉的解决方案。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T18:30:20.437

执行此操作的唯一简单（取决于您对“简单”的定义）的方法是使用 Dynamic Linq API。看这里：

[http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx](http://weblogs.asp.net/scottgu/archive/2008/01/07/dynamic-linq-part-1-using-the-linq-dynamic-query-library.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T18:10:11.780

我这样做的方法是使用 switch 语句：

```
var orders = dataContext.purchase_orders;

if(!string.IsNullOrEmpty(query_value))
{
    switch(field)
    {
        case "firstname":
            orders = orders.Where(x => x.FirstName.StartsWith(query_value));
            return;
        case "company":
            orders = orders.Where(x => x.Company.StartsWith(query_value));
            return;
        // etc.
    }
} 
```

这也允许您验证`field`.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T18:11:37.923

不能只将字段名称作为类的属性名称的主要原因是因为 Linq 构建了一个表达式树。

现在你可以做的是拆分你如何通过做来构建你的表达式树。

```
var orders = from o in dataContext.purchase_orders
                 select o;

if (!string.IsNullOrEmpty(user_name)) {
     orders = orders.Where(x => x.StartsWith(user_name);
} 
```

并且只需添加更多 if 语句......呃......是的，它绝对不漂亮，并且有人可以通过制作 IDictionary<string, Func<Expression, string>> 而不是一堆 if 让它看起来更好声明，但它仍然感觉像一个黑客。

# oop - 代码气味与否？验证器和模型共享相同的层次结构

> ID：778449
> 
> 赞同：0
> 
> 时间：2009-04-22T18:00:23.113
> 
> 标签：oop

我们使用 spring 验证来验证我们的模型，然后再将它们填充到数据库中。所以例如一个

> 订单 --> 订单项

在将订单保存到数据库之前，它由 OrderValidator 验证

OrderValidator 验证 OrderItemValidator 的订单委托，以使用 Order 验证 OrderItem。所以这种情况下的层次结构或验证器看起来像

> OderValidator --> OrderItemValidator

验证器和模型中都存在关于 order 具有 orderItems 的知识。

我想知道这是否是隐式重复的迹象（类似于[并行继承层次结构](http://c2.com/cgi/wiki?ParallelInheritanceHierarchies)代码气味）。如果是，有什么方法可以避免？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T02:53:04.970

我会考虑将验证过程划分为一个与类无关的函数，以及每个类的参数，真实类可以与验证函数一起使用以基本上检查自身。这种方法的可行性需要比已经提供的更多的问题空间知识。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T02:57:05.273

以我的经验，验证器最好使用某种装饰器来实现。他们不应该继承*任何东西*，因为验证者之间没有理性的 is-a 关系。

验证器只查看模型附带的数据，而不是模型的行为，所以我认为任何层次结构都不合适。

# wpf - Xaml 继承的样式

> ID：778455
> 
> 赞同：4
> 
> 时间：2009-04-22T18:01:56.637
> 
> 标签：wpf, xaml, styles

XAML 中有没有办法设置适用于所有控件的样式？例如下面我想在我的所有控件上设置一个边距。我可以通过将 TargetType 更改为 Button、CheckBox 等来为每种类型添加样式。相反，我想像下面那样设置它，在其中设置从 Control 继承的所有类型的样式：

```
<UserControl x:Class="MyPanel"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:sys="clr-namespace:System;assembly=mscorlib"
    Height="300" Width="300">
    <UserControl.Resources>
        <Style TargetType="Control">
            <Setter Property="Margin" Value="3"/>
        </Style>
</UserControl.Resources>
    <StackPanel>
        <Button>My Button</Button>
        <CheckBox>My Checkbox</CheckBox>
    </StackPanel>
</UserControl> 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-22T18:21:35.577

没有办法做到这一点。但是，您可以定义基本样式并从中继承：

```
<Style x:Key="BaseStyle">
    <Setter Property="FrameworkElement.Margin" Value="3"/>
</Style>

<Style TargetType="Button" BasedOn="{StaticResource BaseStyle}">
</Style>

<Style TargetType="TextBox" BasedOn="{StaticResource BaseStyle}">
</Style> 
```

# functional-programming - 函数式编程应该在命令式编程之前教吗？

> ID：778461
> 
> 赞同：31
> 
> 时间：2009-04-22T18:04:16.100
> 
> 标签：functional-programming

在我看来，函数式编程是一件很棒的事情。它消除了状态并使自动使代码并行运行变得更加容易。

许多最初学习命令式编程风格的程序员发现学习函数式编程非常困难，因为它是如此不同。我开始怀疑，首先学习函数式编程的程序员是否会发现很难开始命令式编程。看起来它不会像反过来那样难，所以我认为如果更多的程序员首先学习函数式编程，那将是一件好事。

所以，我的问题是，函数式编程是否应该在学校教授命令式之前，如果是这样，为什么从它开始不更常见？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-22T18:18:36.567

实际上，有些学校已经这样做了。我在哪里学习（哥本哈根大学），他们在第一学期教授 SML，作为编程入门。然后他们随后教 Java，作为 OOP 的介绍。

我认为它工作得非常好，我同意你的看法，它比其他方式更好。对于（还）不是程序员的人来说，函数式编程是相当直观的。它更好地映射了我们在高中或更早时所学的数学，因此尚未接触过命令式编程的人通常会毫不费力地学习它。

事实上，有一种趋势是，刚接触编程的人在注册时学习 SML 的*速度*比那些已经学习过 Java 或 C++ 的人更快。

从命令式到函数式的转变似乎在概念上有很大的飞跃，但对大多数人来说，反过来似乎要容易得多。学生在学习 SML 后接触到 Java 时，通常不会觉得 Java 难。一旦您了解了编程的“纯”概念，就可以非常简单地了解副作用。但是，如果您对编程的全部理解都基于副作用，那么很难想象*没有*它们一切皆有可能。

我认为这种方法的一大好处是函数式编程原则成为你的编程工具箱的重要组成部分，而不是你想炫耀时可能使用的一些深奥的附加组件。即使使用命令式语言进行编程，我认为拥有函数式语言背景也是有好处的。即使在像 C 这样的低级编程中，考虑最小化状态和副作用以及习惯于高阶函数的概念也是有好处的（即使它们在语言中不可用）

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-22T18:19:49.790

许多学校教授函数式编程。他们中的一些人甚至先教它。我认为麻省理工学院长期以来一直在计算机编程课程的介绍中教授方案。

在我的学校，我们将 ML 作为“比较编程语言课程”的一部分，每个人都必须参加。

无论如何，我认为函数式编程对于来自命令式语言的人来说并不难学。至少它不适合我。

很多人认为像 Haskell 和 Scheme 这样的语言没有得到广泛采用的原因是人们被命令式编程“毁了”。那是胡说八道。

这些语言没有被广泛采用的真正原因是它们不使用花括号。严重地。

C/Algol 语法风格很流行，因为人们喜欢它的外观。

越来越多地采用函数式编程的关键不是谈论 Haskell 有多棒以及副作用有多邪恶，或者重复说“monad”这个词。相反，只需创建一种使用花括号和分号的函数式语言。人们会使用它。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-22T18:08:57.493

许多（大多数？）学校教授函数式编程。由于许多原因，很少有人先教它很难。

*   大多数函数式语言的开发环境都很糟糕，需要广泛的编程知识才能充分使用。这变得越来越不真实，但我们离 Visual Studio for Haskell 还很远。

*   更难跳入“华而不实的东西”。GUI 工具包和库不适合大多数功能语言。在屏幕上展示内容并奖励学生很重要。

*   由于历史原因，自学成才的程序员倾向于使用命令式/OO 语言。BASIC 在他们年轻时的可用性，知道他们最喜欢的游戏是用 C 或 C++ 编写的，你说出来。

*   函数式编程语言的简单资源和教程更难获得。将 C# 示例的数量与 Code Project 上的 Lisp 示例进行比较。请记住，Lisp 的历史超过了 5 倍。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-04-22T18:07:08.823

这可能是一个思想共享问题，因为大多数教师/教授可能也首先学习了命令式风格。

另外，我猜想有更多的工作可用于教授命令式风格。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-22T18:07:18.917

我只能假设 OOP 似乎是最受欢迎的流行语/风格，所以学校坚持这一点，

我从一开始就被教导 OOP 设计，直到最近我才开始自学函数式编程风格，我可以看到它有它的优势。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-22T18:07:21.663

**编辑：**以下内容反映了原标题“*为什么学校不教授函数式编程*”，学校有教师，而不是教授。教师不编写自己的教科书。

允许教师购买教材的教科书公司是最大的问题。教科书公司很快就开始关注“下一件大事”，即几年前的 OOP。函数式编程已经被淘汰了。许多教师不能或不允许在没有教科书的情况下教授课程，因此课程选择通常遵循大供应商提供的教科书。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-22T18:08:30.397

首先，我发现你的问题的基础有问题，因为我在学校教过函数式编程。（这不是我开始的，但我们确实做了一些函数式编程。）

其次，我质疑从函数式编码转换到命令式编码的难易程度。我不认为它会像你说的那么容易。

第三，编程（对大多数人来说）是一种工作技能。绝大多数商店都使用命令式编程。因此，对于未来的程序员来说，学习命令式编程是最有用的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-22T18:30:54.587

命令式编程的清晰控制流非常适合在教学环境中实现和分析算法。面向对象编程是对其的方便扩展，因此它自然是最常用的。另一方面，函数式编程（实际上是任何类型的声明式编程）是一个完全独立的范式，需要一套全新的考虑因素（性能和其他方面），如果您首先了解命令式编程，其中许多更容易可视化。毕竟，这一切最终都归结为一种命令式语言。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-22T18:40:53.437

对于学校的课程，必须有一个历史角度（显示我的年龄）。功能是我刚开始时必须学习的全部内容。

但撇开这一点不谈，你必须从某个地方开始，所以其中一个必须是第一个。如果你从命令式开始，那么当你学习函数式时，你会遇到一些你无法做到的事情，你将不得不习惯以不同的方式做事。如果您从函数式开始并转向命令式，那么您将不得不习惯学习新的概念/结构并记住它们在那里使用。

每当您进行编程时，您都在尝试解决问题。最好将两者都放在您的工具箱中以解决手头的问题。这就是为什么我认为最好从迭代式开始，然后学习函数式：如果你发现自己正在寻找不存在的东西，这表明选择了错误的工具来解决你的问题。

除此之外，我认为这是一个折腾。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-22T20:02:39.560

[实际上，我只是参加了开发Bootstrap](http://citizenschools.bizland.com/index_files/scheme/)（目前由 Citizen Schools 开设的编程课程）的人的演讲。他似乎认为函数式编程风格为代数提供了更好的背景，因为它触及了函数作为过程和对象（具有它们自己的属性）的概念。（当然，声明式编程语言也可以具有一流的功能，但重点不在于那么多。）

就个人而言，我认为首先教授函数式编程是值得的。声明式方法很早就在数学课上教授，因此函数式编程提供了一些声明式编程没有的新概念。我同意上面的许多海报，关于它“太难”的说法是一个神话，它已经完成了。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-22T18:09:54.357

> 所以，我的问题是，函数式编程是否应该在学校教授命令式之前，如果是这样，为什么从它开始不更常见？

虽然我没有幸从函数式语言开始，但我确实有同事这样做了。我还有一个学数学的朋友，他在学校学习的唯一语言是 Haskell！

实际上有两件事：计算机科学和计算机工程。尽管这条线很细，IMO，但这在很大程度上取决于课程（如上所述）和相关部门的重点领域，用哪种语言来磨牙。大多数工程学校从 C、C++ 或 Java 中的一种开始——它们具有潜在的巨大就业市场。其他的，可能从 Lisp、Haskell 等开始。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-22T18:10:26.570

大多数大学都教授函数式编程。高中没有教授它的部分原因可能是“函数式编程很难”的神话。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-22T18:12:29.233

在我的本科学习中不知道你的学校[ML](http://en.wikipedia.org/wiki/ML_(programming_language))是基本编程语言课程的重要组成部分，还有一门专门针对 Haskel 的额外课程。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-22T18:46:18.183

老实说，我认为这是一个错误的问题。

如果入门课程的目标是教授基本的计算机科学、算法、以编程方式解决问题，那么您的课程是基础课程，您可以根据清晰度、简单性和传达您的想法来选择一门课程。一些函数式语言将非常适合这一点。特别是如果学生以前很少或没有经验。

不过，通常这并不是许多入门课程的真正目标。他们可能需要某些技术或某些语言用于以后的课程。他们可能想要利用特定的库等。他们可能只需要匹配其他人的“功能”复选框列表。

所以我想你想把你的问题转过来。弄清楚课程实际上想要达到的目标，并为此目的选择最好的语言。在某些情况下，这可能是一种函数式语言。

如果您真正要问的是如何最好地教授入门级编程和计算机科学，那就另当别论了。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2010-05-26T08:06:20.090

我认为，应该，是的。

另外 - 没有控制台应用程序和“调色板混合器”，但首先进行单元测试。

只有当学生表现良好并编写覆盖率极高的测试用例时，才可以让他们快速了解如何从键盘读取字符。

在我看来，大多数糟糕的编码实践（代码异味、反模式）来自对理论和最佳实践的完全无知。

所以 - 首先教他们 F#，禁止使用控制台 i/o 和 GUI，只使用单元测试。

其次，在 OOP 环境中教授他们命令式/函数式混合风格，充分使用和解释设计模式。

然后 - 只有这样他们才能尝试将 clickybuttons 放在某个地方，也许作为奖励。但首先是理论和良好的编码实践。否则，我们将创建下一代“RAD”——甚至无法正确使用缩进并误将 ctrl+c / ctrl+v 用于软件开发的受害者。

# objective-c - NSArray 添加元素

> ID：778465
> 
> 赞同：41
> 
> 时间：2009-04-22T18:05:47.407
> 
> 标签：objective-c, nsarray

我必须创建一个动态 NSArray，也就是说，我不知道数组的大小或数组将包含哪些元素。元素需要动态添加到数组中。我查看了 NSArray 类参考。有一个名为arrayWithObjects 的方法，应该在初始化数组本身时使用。但我不知道如何实现我需要做的事情。

我需要做一些类似以下的事情：

```
NSArray *stringArray = [[NSArray init] alloc] ;  
for (int i = 0; i < data.size; i++){  
    stringArray.at(i) = getData(i);
} 
```

* * *

## 回答 #1

> 赞同：80
> 
> 时间：2009-04-22T18:12:36.017

如果您创建一个，`NSArray`您将无法向其添加元素，因为它是不可变的。您应该尝试`NSMutableArray`改用。

此外，您颠倒了`alloc`和的顺序`init`。`alloc`创建一个实例并`init`初始化它。

代码看起来像这样（假设`getData`是一个全局函数）：

```
NSMutableArray *stringArray = [[NSMutableArray alloc] init];
for(int i=0; i< data.size; i++){
   [stringArray addObject:getData(i)];
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2014-06-26T09:28:39.150

如果您使用不可变数组，这是另一种在数组中添加对象的方法。这是线程安全的。

你可以使用`arrayByAddingObject`方法。有时候会好很多。这是关于它的讨论：[NSMutableArray vs NSArray which is better](https://stackoverflow.com/questions/8207386/nsmutablearray-vs-nsarray-which-is-better)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2015-03-07T03:02:48.093

将您的 NSArray 转换为 NSMutableArray，然后您可以动态添加值：

```
NSMutableArray *mutableStringArray = [stringArray mutableCopy];
[mutableStringArray addObject:@"theNewElement"]; 
```

# iphone - iphone应用国际销售

> ID：778466
> 
> 赞同：1
> 
> 时间：2009-04-22T18:05:48.513
> 
> 标签：iphone, internationalization, translation

谁能提供一个“最佳实践”总结来创建一个面向国际的应用程序？

1.  如何准备翻译应用程序“西班牙语，英语，韩语，中文等）
2.  在审批过程中需要采取哪些措施？你提交一个APP还是几个？
3.  如何优化您的 iTunes 商店页面以跨不同语言工作。

一切顺利！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-05-06T12:36:09.940

这实际上是[由 Apple 很好地记录下来的](http://developer.apple.com/iphone/library/documentation/MacOSX/Conceptual/BPInternational/BPInternational.html)。基本上，您不会在程序中对字符串进行硬编码。您将它们放在单独的文件中（以特定格式）并`NSLocalisedString`在您的代码中使用。如果需要，您还可以本地化您的 NIB 文件。如果您使用正确的 API，日期处理几乎是自动的。

您提交一份申请。应用程序包可以包含许多本地化。

iTunes Connect 允许您在每种商店/语言中编写不同的页面。

我想，“最佳实践”是遵循 Apple 的指南。我要补充的唯一一条建议是不要依赖计算机翻译；如果你不能自己做，请找一个真正的人来做。谷歌很不错，但你不想让任何尴尬的事情溜走！

# eclipse-plugin - Eclipse Perforce 插件和默认文件类型修饰符以便更新版本

> ID：778467
> 
> 赞同：1
> 
> 时间：2009-04-22T18:06:25.580
> 
> 标签：eclipse-plugin, perforce, file-type

我们将版本控制系统从 CVS 迁移到 Perforce，我们的 Java 开发团队正在使用 Eclipse (Mac) 中的 Perforce 插件。该版本不再在添加/编辑时更新。我们在 javadoc 中使用了 $Revision 关键字。根据 Perforce 网站，您必须使用 +k 修饰符，有效地将文件类型从文本更改为 ktext。两个问题：

*   有没有办法在 Eclipse 中将文件类型默认为 ktext（或设置修饰符），而不是每次在提交（提交）到 Perforce 之前都必须这样做？（例如，鼠标右键单击文件并选择 Team > Change Attributes ...）

*   有没有办法配置 Perforce 以继续 CVS 停止的版本控制？示例：在迁移之前，一个文件设置为 1.34。在下一次 Peforce 提交时，我们希望文件设置为 1.35，而不是 #1。

非常感谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2014-01-30T04:39:51.207

如果其他人遇到这些问题，我收到了来自 Perforce 支持团队的有用回复：

关于默认文件类型：

*您可以使用“p4 typemap”命令在服务器端提供它。例如：*

*+k //depot/proj1/....java*

*将 +k 修饰符添加到 //depot/proj1 下的所有文件，扩展名为“.java”。*

关于版本控制：

*如果您使用完整的转换工具之一将 CVS 存储库迁移到 Perforce（例如 cvs2p4，它可以在我们的 Public Depot 的 public.perforce.com 中找到），它将带入 CVS 的所有修订，以便一个文件在 CVS 的 1.34 版本中，将是一个 Perforce 文件，版本为 #34（下一次提交 #35）。*

# python - 识别 C 项目中所有变量的类型

> ID：778468
> 
> 赞同：7
> 
> 时间：2009-04-22T18:06:50.477
> 
> 标签：python, c, variables, coding-style, code-analysis

我正在尝试编写一个程序来检查某些 C 源代码是否符合变量命名约定。为此，我需要分析源代码并识别所有局部和全局变量的类型。

最终结果几乎肯定会是一个 python 程序，但分析代码的工具可以是 python 模块，也可以是生成易于解析的报告的应用程序。或者（在下面详细介绍）它可能是从编译器中提取信息的一种方式（通过报告或类似方式）。如果这很有帮助，很可能是[Keil](http://www.keil.com) ARM 编译器。

我一直在尝试使用[ctags](http://ctags.sourceforge.net)，这对于查找所有 typedef 和宏定义等非常有用，但它没有提供查找变量类型的直接方法，尤其是当定义分布在多行时（其中我希望不会！）。

示例可能包括：

```
static volatile u8 var1; // should be flagged as static and volatile and a u8 (typedef of unsigned 8-bit integer)
volatile   /* comments */   
    static /* inserted just to make life */
        u8 /* difficult! */   var2 =
        (u8) 72
           ; // likewise (nasty syntax, but technically valid C)
const uint_16t *pointer1;  // flagged as a pointer to a constant uint_16t
int * const pointer2; // flagged as a constant pointer to an int
const char * const pointer3; // flagged as a constant pointer to a constant char
static MyTypedefTYPE var3; // flagged as a MyTypedefTYPE variable
u8 var4, var5, var6 = 72;
int *array1[SOME_LENGTH]; // flagged as an array of pointers to integers
char array2[FIRST_DIM][72]; // flagged as an array of arrays of type char 
```

等等等等

它还需要确定它们是本地变量还是全局/文件范围变量（ctags 可以这样做），如果它们是本地变量，我最好是在其中声明它们的函数的名称。

另外，我想对函数做类似的事情：识别返回类型，它们是否是静态的以及它们所有参数的类型和名称。

不幸的是，这对于 C 语法来说是相当困难的，因为参数顺序有一定的灵活性，并且参数之间允许的空白数量有很大的灵活性。我曾尝试过使用一些花哨的正则表达式来完成这项工作，但这远非理想，因为可以应用的情况太多了，因此正则表达式很快变得难以管理。我不禁认为编译器必须能够做到这一点（为了工作！），所以我想知道是否可以提取这些信息。Keil 编译器似乎为每个编译的源文件生成一个“.crf”文件，这似乎包含该文件中声明的所有变量，但它是二进制格式，我不能 找不到有关如何解析此文件的任何信息。或者，从 ctags 中获取信息的方法将是完美的。

任何人都可以为此提供任何帮助，我们将不胜感激。

谢谢，

铝

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T18:17:02.200

有许多 Python 解析器包可用于描述语法，然后它将生成 Python 代码来解析该语法。

Ned Batchelder 写了一个**[很好的总结](http://nedbatchelder.com/text/python-parsers.html)**

其中，Ply 用于解析 C 源代码的名为**[pycparser的项目中。](http://code.google.com/p/pycparser/)**我建议从这个开始。

其中一些其他解析器项目可能也有示例 C 解析器。

**编辑**：刚刚注意到 pycparser 甚至有一个示例 Python 脚本来[解析 C 类型声明](http://code.google.com/p/pycparser/source/browse/examples/cdecl.py)，就像旧的 cdecl 程序一样。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-22T22:20:22.380

从另一边完全接近它怎么样。您已经拥有一个完全理解 C 类型系统所有细微差别的解析器：编译器本身。因此，使用完整的调试支持编译项目，并深入了解调试数据。

对于基于[binutils](http://www.gnu.org/software/binutils/)支持的格式的系统，您需要的大部分细节都可以通过[BFD](http://sourceware.org/binutils/docs/bfd/index.html)库学习。

MSDN 上的库和文档（在某种程度上）支持 Microsoft 的调试格式，但我的 Google-fu 今天很弱，我不会将我知道存在链接到此处的文章放在手上。

Keil 8051 编译器（我在这里没有使用过他们的 ARM 编译器）使用 Intel OMF 或 OMF2 格式，并记录了调试符号适用于他们的调试器或“任何与 Intel 兼容的仿真器”。[Keil C51 使用的OMF](http://www.keil.com/support/docs/163.htm)规范可从[Keil](http://www.keil.com/)获得，所以我想类似的规范也可用于他们的其他编译器。

快速浏览 Keil 的网站似乎表明他们放弃了专有的 ARM 编译器，转而使用 ARM 的 RealView 编译器，它似乎使用带有 DWARF 格式调试信息的 ELF 对象。BFD 应该支持 Dwarf，并且应该为您提供验证类型和名称是否匹配所需的一切。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T18:22:03.000

查看 ANTLR。它是一个解析器生成器，带有 python 绑定。ANTLR 站点为常用语言提供了一大堆语法，包括 C。您可以下载 C 的语法并在适当的位置添加操作以收集您感兴趣的信息。甚至还有一个用于创建和调试语法的简洁图形工具。（我知道这看起来很古怪，但实际上很方便而且不讨厌）

*   ANTLR 主页：[http ://www.antlr.org](http://www.antlr.org/)
*   他们的语法页面：[http ://www.antlr.org/grammar/list](http://www.antlr.org/grammar/list)
*   ANSI C 语法：[http ://www.antlr.org/grammar/1153358328744/Cg](http://www.antlr.org/grammar/1153358328744/C.g)
*   ANTLR Python 目标信息：[http ://www.antlr.org/wiki/display/ANTLR3/Antlr3PythonTarget](http://www.antlr.org/wiki/display/ANTLR3/Antlr3PythonTarget)

我只是做了一些类似的事情，除了获取我的符号信息，我实际上是从 GDB 中提取它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T18:41:45.760

您正在尝试做的是一种轻量级的静态分析形式。[查看Wikipedia](http://en.wikipedia.org/wiki/List_of_tools_for_static_code_analysis#C)指出的工具，您可能会走运一些。

自己解析 C 代码对我来说听起来像是错误的方向：其中存在疯狂。如果您坚持，那么 [f]lex 和 yacc (bison) 可能是您的编译器编写者使用的工具。

或者，如果 ctags 或 cscope 可以帮助您完成 80% 的工作，那么两者的源代码都可以广泛使用。最后 20% 是简单的编程问题。:)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T18:21:51.003

我为几年前从事的一个项目做了类似的事情。我最终编写了 C 编译器的前半部分。不要对这种前景感到惊慌。它实际上比听起来要容易得多，特别是如果您只寻找某些标记（在这种情况下是变量定义）。

在线查找有关如何扫描 C 源代码、检测感兴趣的标记和解析结果的文档。一个很好的起点是[维基百科关于词法分析的文章](http://en.wikipedia.org/wiki/Lexical_analysis#Scanner)。

# asp.net - NHibernate ASP.NET 和加密连接字符串错误

> ID：778471
> 
> 赞同：0
> 
> 时间：2009-04-22T18:07:12.537
> 
> 标签：asp.net, nhibernate, connection-string

我收到一个错误：初始化字符串的格式不符合从索引 0 开始的规范

在 web.config 的 nhibernate 配置部分中，我将此设置为使用命名的连接字符串：MyConnectionString

当我尝试它时出现错误，现在这适用于未加密的连接字符串，我认为它适用于加密的连接字符串，但我现在猜测，因为我认为上述错误表明我的有问题连接字符串，但未加密它工作正常。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-28T18:20:53.113

问题是我永远猜不到的。加密连接字符串不是标准的加密连接字符串。它使用自定义加密模式进行加密，然后添加到配置文件中。所以我必须先创建一个帮手解密连接字符串，然后将其传递给 nhibernate 配置。

很痛苦，但 .NET 配置的标准加密机制似乎可以正常工作，很高兴知道。

自定义加密的原因对我说是“一直都是这样，嘿嘿，不是我写的！”

不错 =]

# apache-flex - Flex：模态弹出中的不确定ProgressBar？

> ID：778472
> 
> 赞同：1
> 
> 时间：2009-04-22T18:07:15.983
> 
> 标签：apache-flex, progress-bar, modal-dialog

每当我通过 PopUpManager 在模式弹出窗口中设置不确定的进度条时，都不会显示进度。如果我定期将相同的 ProgressBar 添加到父级或使弹出窗口非模态它可以工作。为什么它在模态弹出窗口中不起作用是有原因的吗？以及让它发挥作用的方法？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T13:25:20.990

我让其他一些开发人员看过这个，结果证明这是一个错误，但有一个变通方法..我将发布我的原始代码，然后为变通方法发布更改的代码：

原来的：

```
private function showLoading(e:Event = null):void
            {
                if(_progBar == null)
                {
                    _progBar = new ProgressBar();
                    _progBar.width = 200;
                    _progBar.indeterminate = true;
                    _progBar.labelPlacement = 'center';
                    _progBar.setStyle("removedEffect", fade);
                    _progBar.setStyle("addedEffect", fade);
                    _progBar.setStyle("color", 0xFFFFFF);
                    _progBar.setStyle("borderColor", 0x000000);
                    _progBar.setStyle("barColor", 0xf4b60f);
                    _progBar.label = "";
                }
                PopUpManager.addPopUp(_progBar,this,true);
                PopUpManager.centerPopUp(_progBar);
            } 
```

解决方法：

```
private function showLoading(e:Event = null):void
            {
                if(_progBar == null)
                {
                    _progBar = new ProgressBar();
                    _progBar.width = 200;
                    _progBar.indeterminate = true;
                    _progBar.labelPlacement = 'center';
                    _progBar.setStyle("removedEffect", fade);
                    _progBar.setStyle("addedEffect", fade);
                    _progBar.setStyle("color", 0xFFFFFF);
                    _progBar.setStyle("borderColor", 0x000000);
                    _progBar.setStyle("barColor", 0xf4b60f);
                    _progBar.label = "";
                    _progBar.mode = ProgressBarMode.MANUAL;
                }
                PopUpManager.addPopUp(_progBar,this,true);
                PopUpManager.centerPopUp(_progBar);
                 _progBar.setProgress(0, 0);
            } 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-28T08:59:17.803

我们可以通过使用containter.addChild(Pg) eg.Canvas 来做到这一点，然后使用PopUpManager。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-02-24T22:11:47.080

我遇到了同样的问题，但其他解决方案都没有帮助。以下是为我产生问题的代码：

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" applicationComplete="applicationComplete();">
    <mx:Script><![CDATA[
        import mx.controls.ProgressBar;
        import mx.managers.PopUpManager;
        private function applicationComplete():void
        {
            var progressBar:ProgressBar = new ProgressBar()
            progressBar.indeterminate = true;
            PopUpManager.addPopUp(progressBar, this, true);
            //this.addChild(progressBar);           including this line overrides the popup
            //progressBar.setProgress(0, 0);        including this line makes no difference
        }
    ]]></mx:Script>
    <mx:Label text="hello"/>
</mx:Application> 
```

这两条注释掉的行是我理解的其他建议的解决方案。我设法使用以下尴尬的解决方法解决了这个问题：

步骤 1：创建自定义 mxml 组件，保存为 Progress.mxml

```
<?xml version="1.0" encoding="utf-8"?>
<mx:TitleWindow xmlns:mx="http://www.adobe.com/2006/mxml">
    <mx:ProgressBar indeterminate="true" />
</mx:TitleWindow> 
```

第 2 步：在代码中使用自定义组件

```
<?xml version="1.0" encoding="utf-8"?>
<mx:Application xmlns:mx="http://www.adobe.com/2006/mxml" applicationComplete="applicationComplete();">
    <mx:Script><![CDATA[
        import mx.controls.ProgressBar;
        import mx.managers.PopUpManager;
        import Progress;
        private function applicationComplete():void
        {
            var progress:Progress =  new Progress();
            PopUpManager.addPopUp(progress, this, true);
            PopUpManager.centerPopUp(progress);
        }
    ]]></mx:Script>
    <mx:Label text="hello"/>
</mx:Application> 
```

似乎将 ProgressBar 放在 TitleWindow 内很重要。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-09-17T14:07:47.133

一旦我将 ProgressBar 放在 TitleWindow 中，它就对我有用。例如，这不起作用：

```
var waitingpopup:ProgressBar = new ProgressBar();
waitingpopup.indeterminate = true;
waitingpopup.label = "Please wait, loading...";    
PopUpManager.addPopUp(waitingpopup, this, true); 
```

这有效

```
var waitingpopup:TitleWindow = new TitleWindow();
waitingpopup.title = "Please Wait";
var pb:ProgressBar = new ProgressBar();
pb.indeterminate = true;
pb.label = "Loading...";
waitingpopup.addChild(pb);    
PopUpManager.addPopUp(waitingpopup, this, true); 
```

# c# - PInvoke 一个字节数组的数组

> ID：778475
> 
> 赞同：0
> 
> 时间：2009-04-22T18:07:22.100
> 
> 标签：c#, c++, pinvoke

我有以下 C 代码：

```
const BYTE* Items[3];
Items[0] = item1;
Items[1] = item2;
Items[2] = item3;
int result = Generalize(3, Items); 
```

具有 Generalize 的签名

```
int __stdcall Generalize(INT count, const BYTE * const * items); 
```

使用 PInvoke 拨打电话的最佳方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T00:01:09.613

由于 C++ 没有交错数组，只有多维数组并通过 using 访问元素`row * column`，因此您可以在调用之前尝试展平多维数组。

```
[DllImport("dllName.dll")]
private static extern int Generalize(int count, ref byte[] items);

public static int Generalize(int count, byte[,] items)
{
  return Generalize(count, ref items.Cast<byte>().ToArray());
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T18:42:17.583

我不能保证这是最好的方法，但这是我尝试的第一种方法。

```
 [DllImport("<unknown>", 
           EntryPoint="Generalize", 
           CallingConvention=CallingConvention.StdCall)]
    public static extern int Generalize(int count, IntPtr[] items);

    public static void CallGeneralize()
    {
        var itemCount = 3;
        var items = new IntPtr[itemCount];

        items[0] = item1; // where itemX is allocated by Marshal.AllocHGlobal(*)
        items[1] = item2;
        items[2] = item3;

        var result = Generalize(itemCount, items);
    } 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T18:54:02.703

为什么似乎有这么多人想要避免使用 C++/CLI？如果您必须询问如何使用 P/Invoke，那可能是使用 C++/CLI 的提示。

**JasonRShaver.h**中的以下内容

 **```
namespace StackOverflow
{
   public ref class JasonRShaver abstract sealed // "abstract sealed" -> "static"
   {
      public:
    static int Generalize(array<array<BYTE>^>^ items) {
        int count = items->Length;
        std::vector<const BYTE*> arrays(count);

        for each (array<BYTE>^ a in items)
        {
            BYTE* bytes = new BYTE[a->Length];
            for (int i=0; i<a->Length; i++)
                bytes[i] = a[i];
            arrays.push_back(bytes);
        }

        int retval = ::Generalize(count, &(arrays[0]));

        typedef std::vector<const BYTE*>::const_iterator it_t;
        for (it_t it = arrays.begin(); it != arrays.end(); ++it)
        {
            const BYTE* bytes = *it;
            delete[] bytes;
        }

        return retval;
    }

   };
} 
```

这不是生产质量的代码（例如，异常处理），并且您可能可以做得更好`pin_ptr<>`等等。但你得到了一般的想法。

# c - 统一认证库

> ID：778476
> 
> 赞同：1
> 
> 时间：2009-04-22T18:07:42.457
> 
> 标签：c, linux, security, authentication

像 PAM 这样的单一 API 背后的统一身份验证的想法对我来说非常有吸引力。然而，PAM 似乎更倾向于 shell 身份验证，并通过其 API 提供一组相当有限的功能，并且需要从文件中进行系统范围的配置。

我正在为使用 Radius 或 Postegresql 对用户进行身份验证的 CGI（C 语言）Web 界面寻找类似的东西。目前，一个或另一个使用不同的代码。将来，将这组身份验证机制扩展到 LDAP、windows 活动目录、mysql 等会很好，但是手动实现它们将是漫长而痛苦的。

所以 libpam 仍然是赢家，但主要问题是必须记录登录名、名称、密码或主目录以外的其他信息。此外，必须避免文件配置。最好，用户应该从程序自己的配置文件中配置所有内容。最后，占用空间小很重要，因为它适用于嵌入式应用程序，并且避免使用 perl、python、php 等高级语言。

你会怎么处理呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T18:25:28.827

我不确定这是否适用于您的问题，但是您是否考虑过使用[SASL](http://en.wikipedia.org/wiki/Simple_Authentication_and_Security_Layer)库？我对[Cyrus SASL](http://www.linuxfromscratch.org/blfs/view/svn/postlfs/cyrus-sasl.html)有很好的体验。

# sharepoint - SharePoint 记住更改的密码

> ID：778481
> 
> 赞同：3
> 
> 时间：2009-04-22T18:08:52.890
> 
> 标签：sharepoint, wss

在更改用户的 Active Directory 密码时，我目睹了 SharePoint 的一些奇怪行为。

我创建了一个自定义应用程序页面来更改 Active Directory 中的用户密码。该代码似乎运行良好，因为我可以在 Windows 中验证密码已更改。

然而，奇怪的是，密码更改后，SharePoint 将允许用户同时使用新更改**的密码和旧密码登录**。基本上允许他们使用两个不同的密码登录。

我确认这是 SharePoint 中的内容，因为我只能使用新更新的密码登录 Windows。

有谁知道为什么会发生这种情况？我似乎在 Web 上找不到任何有关 SharePoint 缓存凭据或任何内容的信息。任何想法将不胜感激。

提前致谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-29T09:02:15.597

这是预期的行为：http: [//support.microsoft.com/kb/906305](http://support.microsoft.com/kb/906305)

> Microsoft Windows Server 2003 Service Pack 1 (SP1) 修改了 NTLM 网络身份验证行为。安装 Windows Server 2003 SP1 后，域用户可以在更改密码后一小时内使用旧密码访问网络。设计为使用 Kerberos 进行身份验证的现有组件不受此更改的影响。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-16T07:33:19.173

您是否在浏览器中获得身份验证弹出窗口？还是配置为使用当前登录用户名登录？如果将其配置为使用当前登录用户名，则更改密码无关紧要。你试过IE以外的其他浏览器吗？

# sql-server - 如何将方括号括在已在 T-SQL 中设置为一个变量的值的变量中？

> ID：778484
> 
> 赞同：1
> 
> 时间：2009-04-22T18:09:20.410
> 
> 标签：sql-server, tsql

我从网上得到了一个脚本，它计算来自某个 SQL Server 实例的数据文件和事务日志文件的使用情况。如果没有带空格的数据库名称或不太长，则该脚本可以正常工作。但是，如果数据库名称包含空格或太长，我会收到错误消息“消息 911，级别 16，状态 1，第 1 行无法在 sysdatabases 中找到数据库“测试”的条目。找不到具有该名称的条目。使确保名称输入正确。” 在示例错误消息中，“Test”的完整数据库名称为“Test DB”，其中包含一个空格。请看下面的代码：

```
--Script to calculate information about the Data Files

SET QUOTED_IDENTIFIER OFF
SET NOCOUNT ON

DECLARE @dbname varchar(50)
declare @string varchar(250)
set @string = ''

create table #datafilestats
(   Fileid tinyint,
    FileGroup1 tinyint,
    TotalExtents1 dec (8, 2),
    UsedExtents1 dec (8, 2),
    [Name] varchar(50),
    [FileName] sysname )

create table #dbstats
(   dbname varchar(50),
    FileGroupId tinyint,
    FileGroupName varchar(25),
    TotalSizeinMB dec (8, 2),
    UsedSizeinMB dec (8, 2),
    FreeSizeinPercent dec (8, 2))

DECLARE dbnames_cursor CURSOR FOR SELECT name FROM master..sysdatabases
OPEN dbnames_cursor

FETCH NEXT FROM dbnames_cursor INTO @dbname

WHILE (@@fetch_status = 0)
BEGIN
    set @string = 'use ' + @dbname + ' DBCC SHOWFILESTATS'
    insert into #datafilestats  exec (@string)

    insert into #dbstats (dbname, FileGroupId, TotalSizeinMB, UsedSizeinMB)
    select @dbname, FileGroup1, sum(TotalExtents1)*64.0/1024.0,
sum(UsedExtents1)*64.0/1024.0
    from #datafilestats group by FileGroup1

set @string = 'use ' + @dbname + ' update #dbstats set FileGroupName =
sysfilegroups.groupname from #dbstats, sysfilegroups where
#dbstats.FileGroupId = sysfilegroups.groupid and #dbstats.dbname =''' + 
@dbname + ''''

    exec (@string)

    update  #dbstats set FreeSizeinPercent = (TotalSizeinMB - UsedSizeinMB)/TotalSizeinMB*100 where
dbname = @dbname

    truncate table #datafilestats

FETCH NEXT FROM dbnames_cursor INTO @dbname
END

CLOSE dbnames_cursor
DEALLOCATE dbnames_cursor

drop table #datafilestats
select * from #dbstats
drop table #dbstats

--Script to calculate information about the Transaction Log Files

create table #LogUsageInfo
( db_name varchar(50),
  log_size dec (8, 2),
  log_used_percent dec (8, 2),
  status dec (7, 1) )

insert #LogUsageInfo  exec ('dbcc sqlperf(logspace) with no_infomsgs')

select * from #LogUsageInfo

drop table #LogUsageInfo 
```

在我的分析中，当到达“set @string = 'use ' + @dbname + 'DBCC SHOWFILESTATS'”行时，错误消息开始出现。我确实尝试执行命令

```
use Test DB
DBCC SHOWFILESTATS 
```

我收到了上面提到的相同错误消息。但是如果我执行命令

```
use [Test DB]
DBCC SHOWFILESTATS 
```

它工作正常，我没有收到错误消息。

我的问题是脚本中有没有办法用方括号将变量 @dbname 括起来？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-22T18:13:36.047

是的，它被称为[QuoteName](http://msdn.microsoft.com/en-us/library/ms176114.aspx)

例子

```
select quotename('bb bb') 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T18:21:24.687

既然您正在构建字符串，那么为什么不说

```
set @string = 'use [' + @dbname + '] DBCC SHOWFILESTATS' 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T22:52:49.323

关于长数据库名称。看起来您必须声明 @dbname varchar(100) insted of varchar(50) 和 @string varchar(300) insted of @string varchar(250)。并且您需要在表定义（列 dbname）中进行类似的更改。

# jquery - 用于 CSV 验证的正则表达式 + jQuery

> ID：778485
> 
> 赞同：0
> 
> 时间：2009-04-22T18:09:23.170
> 
> 标签：jquery, regex, csv

使用 jQuery 验证插件，但它没有 CSV 验证。我对此进行了额外的验证，但无法正确使用 RegEx。

这是我所拥有的：

```
jQuery.validator.addMethod("csv", function(value, element) {
  return this.optional(element) || /([\w.$]+?(,[\w.]+)+)/.test(value);
}, "Must be comma separated if entering multiple values: value1,value2"); 
```

对 RegEx 有什么想法吗？

```
([\w.$]+?(,[\w.]+)+) 
```

我要做的是让用户输入一个值，该值可以是单个值或 CSV 格式的多个值。

示例 1：

> 价值1

示例 2：

> value1,value2,etc...没有限制

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T18:26:08.543

以乍得的示例为基础，如果您只需要单词字符，只需切换`[^,]`到。`\w`如果您实际上只需要字母和数字，则需要`[a-z0-9]`as`\w`包含下划线字符之类的内容。

根据您的评论，看看是否

```
/^([a-z0-9])+(,[a-z0-9]+)*$/ 
```

成功了。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T18:12:27.110

也许我不完全理解你需要什么，但似乎你可以用这个正则表达式捕获所有值：

```
/([^,]+),?/ 
```

这将允许值中包含空格和特殊字符，我不确定您是否想要，因为您的尝试似乎只允许单词字符。

如果您只是想检查他们输入的内容是否有效，我不确定您会认为什么是“无效的”。在我看来，几乎任何事情都是有效的。如果它没有任何逗号，则它是一个值。如果是这样，它是多个值。也许如果您提供有关您期望的数据的更多详细信息，我可以编写更好的验证表达式。

# c# - 如何将每个证书保存在证书链中

> ID：778493
> 
> 赞同：0
> 
> 时间：2009-04-22T18:12:17.390
> 
> 标签：c#, ssl

我正在寻找一种方法来检索目标服务器的证书链。我已经有代码可以让我获取连接时提供的服务器证书，但我还希望可以选择将链中的每个子证书一直拉到根目录。

这是我用来获取目标服务器公钥的代码。不幸的是，当我只知道 VB.NET 时，我写了这个，但我更喜欢 C# 示例......

```
Private Function openSSLStream(ByRef server As ServerEntry) As SslStream
    Dim sslStream As SslStream = Nothing
    Dim newClient As New System.Net.Sockets.TcpClient

    Try
        newClient = New TcpClient
        newClient.Connect(server.Name, server.Port)
        sslStream = New SslStream(newClient.GetStream(), False, New RemoteCertificateValidationCallback(AddressOf ValidateServerCertificate), Nothing)
        sslStream.AuthenticateAsClient(server.Name)
        Return sslStream
    Catch ex As Exception
        Debug.WriteLine(ex.Message)
        Return Nothing
    Finally
        If newClient.Connected Then newClient.Close()
    End Try
End Function

Private Sub GetDetails(ByRef Server As ServerEntry)
    Dim expcerdate As New Date
    Dim newSSLstream As SslStream = openSSLStream(Server)
    If Not newSSLstream Is Nothing Then
        Dim newCertificate As New X509Certificate
        Try
            newCertificate = newSSLstream.RemoteCertificate()
            expcerdate = CDate(newCertificate.GetExpirationDateString())
            Server.Subject = newCertificate.Subject
            newCertificate.GetPublicKeyString()
            Server.ValidFrom = newCertificate.GetEffectiveDateString()
            Server.ValidTo = newCertificate.GetExpirationDateString()
        Catch ex As Exception
            Server.Subject = ex.Message
        Finally
            newSSLstream = Nothing
            newCertificate = Nothing
            expcerdate = Nothing
        End Try
    End If
End Sub 
```

这样做的最终结果是我有一个可以保存到本地驱动器的公钥的本地副本。我想为链中的每个证书执行类似的任务，以便我拥有给定目标服务器的公共证书的完整列表。

要查看今天的完整应用程序，您可以[从我的站点下载它](http://www.dscoduc.com/file.axd?file=VerifySSL.zip)。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-23T20:54:24.580

我做了一些挖掘，在 X509Chain 和 X509Certificate2 调用中找到了我需要的答案。我不会发布整个代码，但这是最相关的部分：

```
Dim cert2 As X509Certificate2
Dim ch As New X509Chain()
ch.Build(cert2)

Dim element As X509ChainElement

For Each element In ch.ChainElements
    blob = element.Certificate.RawData()
Next Element 
```

# hadoop - org.apache.hadoop.mapred.Mapper 中的“key K1”有什么用？

> ID：778497
> 
> 赞同：0
> 
> 时间：2009-04-22T18:12:47.077
> 
> 标签：hadoop, mapreduce

我正在学习 Apache Hadoop，并且正在查看 WordCount 示例[org.apache.hadoop.examples.WordCount](https://svn.apache.org/repos/asf/hadoop/core/branches/branch-0.19/src/examples/org/apache/hadoop/examples/WordCount.java)。我已经理解这个例子，但是我可以看到变量**LongWritable 键**没有用于

```
(...)
public void map(LongWritable key, Text value, 
                    OutputCollector<Text, IntWritable> output, 
                    Reporter reporter) throws IOException {
      String line = value.toString();
      StringTokenizer itr = new StringTokenizer(line);
      while (itr.hasMoreTokens()) {
        word.set(itr.nextToken());
        output.collect(word, one);
      }
    }
(...) 
```

这个变量有什么用？有人可以给我一个简单的例子吗？谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T18:17:31.497

我可能是错的（我已经阅读了 map/reduce 教程，但还没有将它用于实际项目），但我认为一般来说它是输入条目的标识符；例如，元组（文件名，行号）。在这种特殊情况下，它应该是行号，并且对字数没有兴趣。如果想法是按行而不是按文件汇总字数（或者如果键确实包含该信息，则用于多个文件），则可以使用它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T22:06:08.703

当 InputFormat 为 TextInputFormat 时，Key 为从当前输入文件开头的字节偏移量。

值只是该偏移处的文本行。

如果使用 SequenceFileInputFormat，则 Key 将是填充到“记录”的 Key 位置的任何内容。价值也是一样。

底线是它们的键/值类型取决于输入类型（文本、序列文件等）。

ckw

# dotnetnuke - 需要用户友好的所见即所得 DotNetNuke 皮肤编辑器

> ID：778502
> 
> 赞同：3
> 
> 时间：2009-04-22T18:13:29.323
> 
> 标签：dotnetnuke, wysiwyg, skinning

客户想要编辑 DotNetNuke 皮肤，他不是程序员，所以我正在寻找一些所见即所得的皮肤编辑器。Web 或桌面解决方案都可以。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T20:36:42.193

Not a perfect solution for all skin tokens but this helped me when i was building skins [Skinning Objects in Dreamweaver](http://www.thinkofdesign.com/dotnetnuke-skinning-tools/ctl/articleview/mid/532/articleid/47/dnnskinobjects.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T18:16:06.057

嗯，这真的是一个艰难的过程。使用 HTML 皮肤时，您可以在 Dream weaver 之类的工具中进行皮肤设计，但您只需拥有令牌。

否则，您将需要使用 Visual Studio 等，并依赖各种皮肤对象的“设计时”支持。

总体而言，最好的选择是使用 Dream Weaver 进行编辑，并使用测试 DNN 安装来查看更改。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-11-13T17:55:09.497

我没有用过这个，但它可能有用。它是 DNN 皮肤的 Dreamweaver 扩展。从描述来看，它似乎知道 DNN 皮肤对象的语法，并在 Dreamweaver 中为您提供了一个很好的模板来添加这些对象。

DNN Skinning 的 Dreamweaver 扩展 - [http://www.thinkofdesign.com/dotnetnuke-skinning-tools/ctl/articleview/mid/532/articleid/47/dnnskinobjects.aspx](http://www.thinkofdesign.com/dotnetnuke-skinning-tools/ctl/articleview/mid/532/articleid/47/dnnskinobjects.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-13T12:21:43.410

当前版本的 Artisteer 使用起来相当简单，但是请注意，恕我直言，在它可以用作 DNN 的皮肤工具之前，它还有一些路要走。有一个你可以玩的演示版本，我建议你在花钱之前尝试一下，这样才能知道你得到了什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-12-10T02:23:15.380

查看 DrNuke 的 EasyMod 模块。它是一个非常好的编辑器，可以与他们的皮肤一起使用。

[http://www.drnuke.co.uk/Products/EasyMod/tabid/3362/language/en-US/Default.aspx](http://www.drnuke.co.uk/Products/EasyMod/tabid/3362/language/en-US/Default.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-29T14:16:30.023

这很难。根据您的客户想要做什么，我发现让他只使用 CSS 是最好的选择，因此管理员 -> 门户设置 -> CSS 样式表。或者，在您的客户端电脑/笔记本电脑上安装 dnn 环境。以我的经验，只有当他们真的有动力时，他们才会自己去做。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-22T18:28:16.340

我见过一些优秀设计师设计的皮肤，它们更容易使用不同的颜色和布局进行定制。我还看到皮肤的制作者在他们的主页上有一个所见即所得的编辑器，您可以在其中自定义外观，他们会通过电子邮件向您发送匹配的皮肤，但这与您将获得的一样接近。

如果我能记住皮肤制造商的名字，我会的。我知道你可以在[http://www.Snowcovered.com](http://www.Snowcovered.com)和市场上找到它们[http://www.dotnetnuke.com](http://www.dotnetnuke.com)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-22T18:32:40.773

客户的最佳选择将是

*   微软表达式
*   网络 Dreamweaver

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-03-16T16:39:50.927

我猜您的客户不需要能够编辑整个皮肤，他们只希望能够更改其中的一部分。您应该能够以具有所需灵活性的方式构建皮肤，并且他可以通过正确使用 SkinObjects 和 Modules 轻松修改这些部分。

# sharepoint - 将数据库 Blob 写入 SharePoint Document Libaray

> ID：778504
> 
> 赞同：2
> 
> 时间：2009-04-22T18:13:57.793
> 
> 标签：sharepoint

我正在将大量文档从旧文档管理系统移至 SharePoint (MOSS 2007)。原始系统将文档作为二进制数据存储在 SQL 服务器数据库的图像字段中。

我的想法是以编程方式创建多个文档库来对这些文档进行分组。然后，我计划将二进制数据读取到文件流中，然后使用该流将文件上传到 SharePoint。

有没有人做过类似的事情？有没有比我正在研究的更好的方法？此外，如果有人有任何从二进制数据库字段读取并写入 SharePoint 文档库的示例，我将不胜感激。谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T19:39:35.327

您可以轻松地以编程方式从字节数组创建文档。这是您可以构建的一些代码片段。

```
// If you have very large document, you might consider export the BLOBs to disk instead of in memory
string connstr = @”Data Source=.;Initial Catalog=AdventureWorks;Persist Security Info=True;User ID=sa;Password=sa”;

SqlConnection conn = new SqlConnection(connstr);
conn.Open();

SqlDataAdapter da = new SqlDataAdapter();
da.SelectCommand = new SqlCommand(“SELECT * FROM [dbo].[ImageStore]“, conn);
DataSet ds= new DataSet();
da.Fill(ds);

byte[] blob = (byte[])ds.Tables[0].Rows[0]["imageContent"];

using (SPSite destinationSite = new SPSite("http://YourSite"))
{
  using (SPWeb = destinationSite.OpenWeb("http://YourSite"))
  {
    SPList destinationDocuments = destinationWeb.Lists["Documents"];
    string fileName = "mydoc.jpg";
    string relativeDestinationUrl = destinationDocuments.RootFolder.Url + "/";
    stringfileName += sourceItem.File.Name;
    relativeDestinationUrl += fileName;

    SPFile destinationFile = ((SPDocumentLibrary)destinationDocuments).RootFolder.Files.Add(relativeDestinationUrl, blob, true);
    SPListItem item = destinationFile.Item;
    item.UpdateOverwriteVersion();
  }
} 
```

# emacs - Emacs：将主机名添加到模式行？

> ID：778508
> 
> 赞同：11
> 
> 时间：2009-04-22T18:15:15.653
> 
> 标签：emacs

我想在我的模式行的某处显示 (getenv "HOSTNAME") 的输出。我的显示时间模式设置为“t”，所以我已经在模式行中显示时间、负载级别和邮件标志。是否也有一种简单的方法可以在那里获取主机名？

我想要这个，因为我通过 ssh 连接到 3 台远程机器，所有这些机器都从一组通用的 init 文件运行 emacs，而且我想要一些快速简单且不显眼的方式来了解我正在使用哪台机器。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-22T19:58:36.263

要建立在 Sean Bright 的[答案](https://stackoverflow.com/questions/778508/emacs-add-hostname-to-mode-line/778533#778533)之上，具体来说，您可以这样做：

```
(let ((pos (memq 'mode-line-modes mode-line-format)))
  (setcdr pos (cons (getenv "HOSTNAME") (cdr pos)))) 
```

这假设它`'mode-line-modes`是你的一部分，`'mode-line-format`默认情况下它是。因为您正在修改变量指向的列表`'mode-line-format`，所以您不必设置默认值。如果您要设置变量本身，则必须执行以下操作：

```
(setq-default mode-line-format (build-list-that-contains-(getenv "HOSTNAME"))) 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2011-05-12T07:09:16.267

我尝试了上述答案并没有特别成功（我正在运行 emacs 23）。经过大量调查，我最终只`system-name`输入了`mode-line-format`以下内容：

```
;; Set the modeline to tell me the filename, hostname, etc..
(setq-default mode-line-format
  (list " "
        ; */% indicators if the file has been modified
        'mode-line-modified
        "--"
        ; the name of the buffer (i.e. filename)
        ; note this gets automatically highlighted
        'mode-line-buffer-identification
        "--"
        ; major and minor modes in effect
        'mode-line-modes
        ; if which-func-mode is in effect, display which
        ; function we are currently in.
        '(which-func-mode ("" which-func-format "--"))
        ; line, column, file %
        'mode-line-position
        "--"
        ; if vc-mode is in effect, display version control
        ; info here
        `(vc-mode vc-mode)
        "--"
        ; hostname
        'system-name
        ; dashes sufficient to fill rest of modeline.
        "-%-"
        )
) 
```

[我已经在我的网站上](http://www.hollenback.net/index.php/EmacsModeLine)的一篇文章中详细介绍了我发现的有关 emacs 模式行的其他内容。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-01-27T22:42:01.290

您还可以将垃圾附加到`global-mode-string`变量：

```
(defvar my-hostname (concat " " (system-name)))
(setq global-mode-string (append global-mode-string '(my-hostname))) 
```

对于像您的主机名这样的静态内容，这两行可能就足够了。

如果你有更动态的东西，你可以设置一个计时器`run-at-time`来更新字符串（`my-hostname`在这个例子中）。看`display-time-mode`一个很好的小例子的定义。

# c# - DSL 与方法调用：优缺点

> ID：778510
> 
> 赞同：2
> 
> 时间：2009-04-22T18:15:55.900
> 
> 标签：c#, .net, dsl

我必须使用一个相当特殊的数据源（实际上是会计应用程序的接口）。虽然它非常强大，但我必须跳过很多圈才能从中获取我想要的数据。例如，如果我想获取一个表的内容并指定它应该返回哪些列，我必须遍历 .Columns 集合并将 .SetVisible() 调用到我想要的那些。

目前我们有一个方法可以包装这个并允许我们以更简单的方式指定事物，但是该函数的参数列表正在快速增长，并且大多数时候我们只需要在调用它时指定其中的几个. 简而言之 - 这是一个不灵活的解决方案。

我想到的第一个解决方案是这样的：

```
DataTable result = DataSourceWrapper.StartQuery("TableName")
    .SetVisibleColumns("Col1", "Col2", "Col3")
    .SetCriteria("CriteriaName", "Param1Name", CriteriaParam1, "Param2Name", CriteriaParam2)
    .SetFilter("Col4 = ? AND Col5 = ?", FilterParam1, FilterParam2)
    .SetReportParams("Param1Name", ReportParam1, "Param2Name", ReportParam2)
    .Execute(); 
```

Criteria、Filters 和 ReportParams 是特定于应用程序的一些东西，我不会在这里讨论它们。但总体思路是这样的。它实际上类似于调用方法，除了您可以选择要指定的参数（通过调用特定方法）并获得更多 IntelliSense 帮助。您还可以使用方法调用的顺序。

请注意，`SetFilter()`有一个要解析的表达式。这是 DataSource 造成困难的另一件事 - 它可以很好地处理表达式，但是您必须将它们作为特殊对象树传递，这又是相当冗长的编写。在[上一个问题](https://stackoverflow.com/questions/776265/c-how-to-parse-arbitrary-strings-into-expression-trees)中，我寻求有关解析此类表达式的帮助。当前的 wrapper-method 有一个自制的表达式解析器，它可以解析简单的表达式，但我想使对它们的支持更完整。

在那个问题中，提出了[Irony](http://irony.codeplex.com/)项目。看完之后，我认为它确实适合这种需求。但过了一会儿，我突然意识到，它比那更强大。为什么不让我自己的查询语言完全适合这个任务呢？上面的内容看起来像：

```
DataTable result = DataSourceWrapper.Query(@"
    SELECT Col1, Col2, Col3
    FROM TableName
    WITH CRITERIA CriteriaName(Param1Name={0}, Param2Name={1})
    WITH REPORTPARAMS (Param1Name={2}, Param2Name={3}
    WHERE Col4 = {4} AND Col5 = {5}",
    CriteriaParam1, CriteriaParam2,
    ReportParam1, ReportParam2,
    FilterParam1, FilterParam2
); 
```

但是……这不是矫枉过正吗？两种方法的优缺点是什么？我看到的是：

专业 DSL：

*   查询更简洁；

专业方法：

*   更多智能感知支持；
*   方法名称/参数名称（和注释）减少了对文档的需求（必须彻底记录 DSL）；
*   可能会更快创建？我从来没有创建过自己的 DSL，所以我不知道有多少工作量。讽刺似乎从我肩上卸下了很多担子，但还剩下多少呢？

**补充：**为了澄清，这两种方法都只能由编码人员使用。外部人员和业务分析师不会使用它。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T18:39:16.860

您必须小心所谓的 DSL。请参阅[Martin Fowler 在 DSL 上的 Bliki 帖子](http://www.martinfowler.com/bliki/DomainSpecificLanguage.html)。您的方法链接示例非常接近内部 DSL。稍微修改一下，就是：

```
DataTable result = DataSourceWrapper.Query("TableName")
    .With(new Columns("Col1", "Col2", "Col3"))
    .Where(new AndCritera("CriteriaName",
        new Criterion("Param1Name", CriteriaParam1),
        new Criterion("Param2Name", CriteriaParam2))
    .Filter(
        new Filter("Col4").Equals(FilterParam1),
        new Filter("Col5").Equals(FilterParam2))
    .With(
        new ReportParam("Param1Name", ReportParam1),
        new ReportParam("Param2Name", ReportParam2)); 
```

话虽如此，这仍然在 C# 领域内，只有程序员才能编写这些查询。如果您的需求推动您向非程序员提供查询，那么您可能会考虑按照您在第二个示例中指定的那样创建外部 DSL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T18:35:06.883

我会选择 DSL 方法。

原因：1 更接近领域专家，从个人经验来看，BA 喜欢 DSL 形式的东西，它打破了有业务头脑的人和开发人员之间的沟通障碍，并且使编写技术规范变得更加容易 2 通过使用类似的工具讽刺的是，你的 DSL 将被很好地定义，并且是测试驱动开发的一个很好的候选人 3 实现 DSL 确实需要对开发人员进行一些初步学习（我使用了 javacc，它比 Irony 更不友好）但是一旦你掌握了这些想法，它变得容易，并且您的代码变得非常通用，因为您将逻辑卸载到 DSL 中。

# sql-server - 在 SQL Server 中有条件地创建用户

> ID：778518
> 
> 赞同：32
> 
> 时间：2009-04-22T18:18:44.163
> 
> 标签：sql-server, sql-server-2005

如果用户不存在，我想在数据库“mydb”中创建一个用户“foo”。目前我的脚本如下所示：

```
USE [mydb]
CREATE USER [foo] FOR LOGIN [foo]
GO 
```

但是，如果用户已经存在，则会失败并显示错误消息：

```
Msg 15023, Level 16, State 1, Line 2
User, group, or role 'jsrvpp' already exists in the current database. 
```

如何更改脚本以便仅在用户不存在时才创建用户？

谢谢！

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-22T18:28:23.390

您可以查阅两个系统目录[sys.server_principals](https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-server-principals-transact-sql?view=sql-server-ver15)以检查服务器登录，或查阅特定数据库中的[sys.database_principals](https://docs.microsoft.com/en-us/sql/relational-databases/system-catalog-views/sys-database-principals-transact-sql?view=sql-server-ver15)以查找数据库用户：

```
use myDB
GO

if not exists(select * from sys.database_principals where name = 'foo')
  -- create your database user

if not exists(select * from sys.server_principals where name = 'foo')
   -- you need to create a server login first 
```

马克

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2011-05-28T05:37:54.173

根据 Chris 的评论，基本上结合了[David 的 answer](https://stackoverflow.com/questions/778518/conditionally-create-user-in-sql-server/778542#778542)和[marc_s 的 answer 。](https://stackoverflow.com/questions/778518/conditionally-create-user-in-sql-server/778561#778561)

联机丛书说[sp_grantdbaccess](http://msdn.microsoft.com/en-us/library/ms178013.aspx)：

> 此功能将在 Microsoft SQL Server 的未来版本中删除。避免在新的开发工作中使用此功能，并计划修改当前使用此功能的应用程序。请改用 CREATE USER。

因此，仅在用户不存在时才创建用户，我会这样做：

```
/* Make sure User is created in the appropriate database. */
USE mydb
GO

/* Users are typically mapped to logins, as OP's question implies, 
so make sure an appropriate login exists. */
IF NOT EXISTS(SELECT principal_id FROM sys.server_principals WHERE name = 'foo') BEGIN
    /* Syntax for SQL server login.  See BOL for domain logins, etc. */
    CREATE LOGIN foo 
    WITH PASSWORD = 'sufficiently complex password'
END

/* Create the user for the specified login. */
IF NOT EXISTS(SELECT principal_id FROM sys.database_principals WHERE name = 'foo') BEGIN
    CREATE USER foo FOR LOGIN foo
END 
```

尽管已被弃用，但 sp_grantdbaccess 确实具有能够为用户/登录名使用参数或局部变量的优势，如 David 的回答所示。我能想到的与 CREATE USER 类似的第一个替代方法是使用动态 SQL。例如：

```
/* Make sure User is created in the appropriate database. */
USE mydb
GO

DECLARE @NewUserName sysname;
DECLARE @NewUsersLogin sysname;

SET @NewUserName = 'foo';
SET @NewUsersLogin = 'bar';

/* Users are typically mapped to logins, as OP's question implies, 
so make sure an appropriate login exists. */
IF NOT EXISTS(SELECT principal_id FROM sys.server_principals WHERE name = @NewUsersLogin) BEGIN
    /* Syntax for SQL server login.  See BOL for domain logins, etc. */
    DECLARE @LoginSQL as varchar(500);
    SET @LoginSQL = 'CREATE LOGIN '+ @NewUsersLogin + 
        ' WITH PASSWORD = ''sufficiently complex password''';
    EXEC (@LoginSQL);
END

/* Create the user for the specified login. */
IF NOT EXISTS(SELECT principal_id FROM sys.database_principals WHERE name = @NewUserName) BEGIN
    DECLARE @UserSQL as varchar(500);
    SET @UserSQL = 'CREATE USER ' + @NewUserName + ' FOR LOGIN ' + @NewUsersLogin;
    EXEC (@UserSQL);
END 
```

有趣的是，Books Online 还说`sp_grantdbaccess`实际调用`CREATE USER`，并且我在测试中注意到，如果您没有明确分配模式，`sp_grantdbaccess`则会创建一个以用户命名的模式，而`CREATE USER`默认情况下将使用 'dbo'。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-22T18:23:46.630

这就是我们所做的...

```
IF NOT EXISTS (SELECT * FROM DBO.SYSUSERS WHERE NAME = @usrName )
BEGIN
  PRINT 'Granting access to the current database to login ' + @usrName + '...'
  -- Grant access to our database
  EXEC SP_GRANTDBACCESS @usrName
END ELSE BEGIN  
  PRINT 'Login ' + @usrName + ' already granted access to current database.'  
END 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-10-31T04:51:14.467

```
USE [*Database_Name*];
GO

DECLARE @isUserExist int, @SQL NVARCHAR(max)
SELECT @isUserExist = COUNT(*) from sys.sysusers where name = *User_Name* 
--Checking for User Existence 
IF(@isUserExist = 0) 
BEGIN 
    SET @SQL = 'CREATE USER ' + QUOTENAME(*User_Name*) + ' FOR LOGIN ' + QUOTENAME(*User_Name*); 
    EXECUTE(@SQL); 
END 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-01-14T16:48:11.023

关于脚本运行时已经存在的 SQL 用户，我问了完全相同的问题——这个问题，这里有一些非常有用的答案：

[检查 SQL Server 登录是否已存在](https://stackoverflow.com/questions/1379437/checking-if-a-sql-server-user-already-exists)

希望这可以帮助。

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2014-09-11T14:19:38.427

```
USE MyDB
GO

BEGIN TRY
  CREATE USER [foo] FOR LOGIN [foo]
END TRY
BEGIN CATCH
 -- User exists - do nothing
END CATCH 
```

# mysql - MySQL ON DUPLICATE KEY - 最后插入ID？

> ID：778534
> 
> 赞同：148
> 
> 时间：2009-04-22T18:22:30.847
> 
> 标签：mysql, insert-id

我有以下查询：

```
INSERT INTO table (a) VALUES (0)
  ON DUPLICATE KEY UPDATE a=1 
```

我想要插入或更新的 ID。通常我会运行第二个查询以获得此信息，因为我相信 insert_id() 仅返回“插入”ID 而不是更新后的 ID。

有没有办法在不运行两个查询的情况下插入/更新并检索行的 ID？

* * *

## 回答 #1

> 赞同：197
> 
> 时间：2009-04-22T21:13:10.593

查看此页面：[https](http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html)
://web.archive.org/web/20150329004325/https://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html 在页面底部他们解释了如何通过将表达式传递给 MySQL 函数来使 LAST_INSERT_ID 对更新有意义。

从 MySQL 文档示例：

> 如果表包含 AUTO_INCREMENT 列并且 INSERT ... UPDATE 插入一行，则 LAST_INSERT_ID() 函数将返回 AUTO_INCREMENT 值。如果该语句改为更新一行，则 LAST_INSERT_ID() 没有意义。但是，您可以使用 LAST_INSERT_ID(expr) 解决此问题。假设 id 是 AUTO_INCREMENT 列。要使 LAST_INSERT_ID() 对更新有意义，请按如下方式插入行：

```
INSERT INTO table (a,b,c) VALUES (1,2,3)
  ON DUPLICATE KEY UPDATE id=LAST_INSERT_ID(id), c=3; 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2012-08-10T19:11:54.170

确切地说，如果这是原始查询：

```
INSERT INTO table (a) VALUES (0)
 ON DUPLICATE KEY UPDATE a=1 
```

'id' 是自动增量主键，而不是工作解决方案：

```
INSERT INTO table (a) VALUES (0)
  ON DUPLICATE KEY UPDATE id=LAST_INSERT_ID(id), a=1 
```

都在这里：[http ://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html](http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html)

> 如果表包含 AUTO_INCREMENT 列并且 INSERT ... UPDATE 插入一行，则 LAST_INSERT_ID() 函数将返回 AUTO_INCREMENT 值。如果该语句改为更新一行，则 LAST_INSERT_ID() 没有意义。但是，您可以使用 LAST_INSERT_ID(expr) 解决此问题。假设 id 是 AUTO_INCREMENT 列。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T18:40:41.957

您可能会查看 REPLACE，如果记录存在，它本质上是一个删除/插入。但这会改变自动增量字段（如果存在），这可能会破坏与其他数据的关系。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T21:02:49.540

我不知道你的 MySQL 版本是什么，但是使用 InnoDB，autoinc 存在错误

5.1.20 中的错误并在 5.1.23 中更正 [http://bugs.mysql.com/bug.php?id=27405](http://bugs.mysql.com/bug.php?id=27405)

5.1.31 中的错误并在 5.1.33 中更正 [http://bugs.mysql.com/bug.php?id=42714](http://bugs.mysql.com/bug.php?id=42714)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2019-11-26T12:50:49.733

我遇到了一个问题，当 ON DUPLICATE KEY UPDATE id=LAST_INSERT_ID(id) 将主键增加 1。所以会话中下一个输入的 id 将增加 2

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-11-05T15:03:58.383

值得注意的是，这可能很明显（但为了清楚起见，我还是会这么说），REPLACE 会在插入新数据之前清除现有的匹配行。ON DUPLICATE KEY UPDATE 只会更新您指定的列并保留该行。

从[手册](http://dev.mysql.com/doc/refman/5.0/en/replace.html)：

> REPLACE 的工作方式与 INSERT 完全相同，只是如果表中的旧行与 PRIMARY KEY 或 UNIQUE 索引的新行具有相同的值，则在插入新行之前删除旧行。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-06-02T00:24:02.797

如果您使用自动增量，现有的解决方案就可以工作。我有一种情况，用户可以定义一个前缀，它应该在 3000 处重新启动序列。由于这个不同的前缀，我不能使用自动增量，这使得 last_insert_id 为空插入。我用以下方法解决了它：

```
INSERT INTO seq_table (prefix, id) VALUES ('$user_prefix', LAST_INSERT_ID(3000)) ON DUPLICATE KEY UPDATE id = LAST_INSERT_ID(id + 1);
SELECT LAST_INSERT_ID(); 
```

如果前缀存在，它将增加它并填充 last_insert_id。如果前缀不存在，它将插入值为 3000 的前缀，并使用 3000 填充 last_insert_id。

# c - 客户端-服务器程序

> ID：778544
> 
> 赞同：0
> 
> 时间：2009-04-22T18:24:14.727
> 
> 标签：c

我们在 UNIX 环境中进行了简单的编程`client.c`。`server.c`我们使用它传输一个简单的文本文件，首先打开它，然后读取它并发送 using `open`、`read`和`send`系统调用；在客户端，我正在接收它，并通过在服务器机器上创建一个文件来编写它。传输进行得很顺利，但在客户端收到的文件与服务器端的文件并不完全相同。在可读字符之间有一些不可读的字符。你能告诉我这可能是什么原因吗？尽管文件的大部分内容相同，但只有一小部分之间存在一些差异。

代码可以在[这里](http://pastebin.com/m7a022388)看到。

谢谢！

服务器端循环：

```
do
{
    n=read(t,buf,100);
    write(1,buf,strlen(buf));
    send(connected, buf,strlen(buf), 0);    
} while(n!=0); 
```

在客户端

```
do
{
    bytes_recieved=recv(sock,recv_data,100,0);
    count=write(t,recv_data,strlen(recv_data));     
} while(bytes_recieved!=0); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T19:32:39.540

在第一种情况下，不要使用`strlen()`. 绝对不能保证文件流中的任何地方都会有一个 NUL 字节，事实上，对于文本文件，永远不应该有。

`strlen()`每次循环时，您都应该输出接收到的实际字节数，而不是缓冲区中可能有多少想法：

```
do
{
    bytes_received = recv(sock, recv_data, 100, 0);
    if (bytes_received < 0) {
        perror("read");
        break;
    } else if (bytes_received == 0) {
        break;
    } else {
        count = write(t, recv_data, bytes_received);
        // in theory - add error check here too!
    }
} while (count > 0); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T19:17:13.820

您应该检查您的 send() 以查看它们是否成功。您可能会发现在某些时候写入缓冲区（即套接字的输出缓冲区）已满并且发送失败。这是正常行为。Send 返回发送的字节数。如果您不发送多字节字符，这可能会表现为丢失数据而不是损坏数据。如果您丢失了一个两字节字符中的一个字节，则可能会导致损坏。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-22T18:28:22.407

MS Windows 系统使用回车换行作为换行符，linux 只使用换行符。

“不可读的字符”是 Ctrl-M，回车，字符编号 13。

# tdd - 模拟非虚拟事件（在 COM 互操作类中）

> ID：778546
> 
> 赞同：4
> 
> 时间：2009-04-22T18:24:43.447
> 
> 标签：tdd, moq, com-interop, typemock

编辑：语言/平台是 C# / .Net

我目前正试图填补我当前项目中的一个巨大的单元测试空白，并且诚然是 TDD 的新手，我发现自己对于如何去测试一些更关键的业务特性感到很困惑。

我选择了 Moq 并有足够的时间做简单的模拟，但是在我的应用程序的核心是一个相当大的、可怕的 COM 互操作层，我很难概念化如何适当地进行单元测试。COM 组件完全是第 3 方，因此无法修改，它实现了相当于处理电话呼叫的有限状态机。该组件通过一组**非虚拟事件**通知我的应用程序，我想以某些顺序对其进行测试以模拟状态更改，但是 Moq 不提供除虚拟事件之外的任何方法来执行此操作。

所以我对知识渊博的 TDDers/Mockists 的问题是：*你将如何测试这种东西？*

显然 TypeMock 支持这一点（以换取它自己的缺点），但我宁愿不使用它，原因是关于类型安全的各种原因以及我普遍认为它在我背后做一些狡猾的事情。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T18:37:13.930

你只能模拟虚拟/抽象方法，除非你使用像 TypeMock 这样的重型工具。

当您必须测试您无法控制的代码时，您将不得不打破对该代码的依赖。创建一个具有不可测试类的方法、属性和事件的外观。坚持使用您实际使用的那些；它会减少您必须编写的代码的大小。针对您控制的外观而不是您不控制的代码编写代码。

最后一件事是使用几种技术之一来访问允许您在测试期间替换模拟的外观。您可以使用配置文件、依赖注入框架、延迟实例化等。这样您就可以模拟出您的外观并将其用于单元测试。当然，您仍然需要进行一些集成测试，以确保您的外观与实际的 COM 互操作类正常工作。

如需一些灵感，请查看 System.Web.Abstractions。它包含许多包装 ASP.NET 核心类以使它们可模拟的类。

# wpf - WPF应用复杂皮肤

> ID：778548
> 
> 赞同：0
> 
> 时间：2009-04-22T18:24:51.620
> 
> 标签：wpf, skinning

我试图弄清楚如何用复杂的资源来皮肤应用程序。

我有一个`Canvas`包含复杂艺术品的皮肤文件。像这样：

```
<ResourceDictionary>
    <Style x:Key="MainBackground" TargetType="{x:Type Canvas}">
        <Setter Property="Canvas">
            <Setter.Value>
                <Canvas Width="1440.000" Height="900.000">
                <!-- complicated artwork here -->
                </Canvas>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary> 
```

如何将此皮肤加载到主应用程序中？我在想这样的事情：

```
<Window>
    <Canvas Style="{StaticResource MainBackground}"/>
</Window > 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-10-03T17:26:47.480

如果我正确理解了这个问题：您可以从导出的 XAML 文件的根视觉创建一个视觉画笔，并将其用作另一个画布的画笔。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T18:36:00.407

首先，不要使用 a`Canvas`显式布局控件。使用其他`Panel`类型（例如`Grid`和`DockPanel`）。

其次，您可以像这样导入`ResourceDictionary`：

```
<Window>
    <Window.Resources>
        <ResourceDictionary Source="YourDictionary.xaml"/>
    </Window.Resources>
</Window> 
```

或者你可以合并多个`ResourceDictionary`s，如下：

```
<Window>
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="YourDictionary.xaml"/>
                <ResourceDictionary Source="YourOtherDictionary.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>

        <SolidColorBrush x:Key="SomeLocalResource">Red</SolidColorBrush>
    </Window.Resources>
</Window> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-03-11T00:44:47.593

我知道这是一个老问题......但是有几种方法可以解决这个问题。希望这对谷歌搜索者有所帮助，我将分享两种方式。

**首先，您可以简单地在 Canvas 周围放置一个 Viewbox**（您从转换后的 .ai 文件中获得）。请注意，您可能必须使用 Stretch 和 alignment 属性来使其按您希望的方式运行……但很可能您会将 Stretch 设置为 UniformToFill 并将对齐属性设置为 Center：

```
<Window
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    x:Class="BackgroundSkin.MainWindow"
    x:Name="Window"
    Width="640"
    Height="480"
>
    <Grid x:Name="LayoutRoot">
        <Viewbox
            Stretch="UniformToFill"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
        >
            <!-- Replace the following Canvas with yours. -->
            <Canvas Background="White"/>
        </Viewbox>
    </Grid>
</Window> 
```

**其次，如果您希望有更多可共享的东西（这样您可以将其用作多个 Windows 上的背景），您可以从该作品中创建一个画笔。**有几种方法可以做到这一点。首先是简单地认识到您可以使用Expression Design 将.ai 文件转换为DrawingBrush（即Expression Design 可以通过两种主要方式导出：Canvas/Shape(s) 或ResourceDictionary/Brush(es)）。

如果您没有用于重新导出的原始 .ai/.design 文件，您可以从画布上创建一个 VisualBrush（正如@Ugar Turan 建议的那样）。请注意，这次您可能不得不再次在 VisualBrush 上使用 Stretch 属性（和其他属性）：

```
<Window
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    x:Class="BackgroundSkin.MainWindow"
    x:Name="Window"
    Width="640"
    Height="480"
    Background="{DynamicResource backgroundBrush}"    
>
    <Window.Resources>
        <!-- Replace the following Canvas with yours. -->
        <Canvas x:Key="backgroundCanvas"/>
        <VisualBrush
            x:Key="backgroundBrush"
            Visual="{DynamicResource backgroundCanvas}"
            Stretch="UniformToFill"
        />
    </Window.Resources>
</Window> 
```

# refactoring - 猜猜这个 goto 标签

> ID：778553
> 
> 赞同：0
> 
> 时间：2009-04-22T18:26:59.540
> 
> 标签：refactoring, label, goto

我正要重构以下 VB6 代码（由其他人编写）。

```
Public Function GetValue(ID As Long) As Boolean
    On Error GoTo eh

    '' ... DAL Logic...

eh_Exit:
  On Error GoTo 0
  Exit Function
eh:
  Resume eh_Exit
End Function 
```

您认为原作者对标签的意图是`eh`什么？

可能只是“呃，发生了什么事？”......

我想让它可读，而不必像现在一样思考它......

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-22T18:28:35.060

错误处理程序？不知道为什么那里没有任何*错误处理*。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T18:28:45.167

“***E***错误***H***andler”

我的第一份 C 工作，每个函数在底部附近都有一个名为“err_exit”的标签。检测到任何无法在本地处理的错误情况，并使用“if (error...) goto err_exit;”进行处理。此外，我们所有的函数都返回 0 表示状态良好，或返回 -1 表示错误。

理论上，err_exit 是用来做一些清理工作的，但实际上我们的大多数函数都像这样结束

```
 return 0;
err_exit:
  return -1; 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T18:31:17.470

“有趣”的设计。它看起来像是在调试期间放置断点的地方，但它创造性地令人困惑。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T18:36:36.427

我会冒险猜测它是一种模式，它允许函数的代码结束而不必跳过任何错误处理逻辑，而且如果函数编写器没有 Exit Function 语句，也可以优雅地终止。

因此，您可以将 eh_Exit 中的所有内容粘贴到任何函数中，而无需更改该函数中的剩余代码。

# php - 对象数组的PHPDoc类型提示？

> ID：778564
> 
> 赞同：443
> 
> 时间：2009-04-22T18:29:13.437
> 
> 标签：php, ide, phpdoc, var, hint

因此，在 PHPDoc 中，可以`@var`在成员变量声明上方指定以提示其类型。然后是 IDE，例如。PHPEd 将知道它正在使用什么类型的对象，并将能够为该变量提供代码洞察力。

```
<?php
  class Test
  {
    /** @var SomeObj */
    private $someObjInstance;
  }
?> 
```

这很有效，直到我需要对一组对象做同样的事情，以便以后在遍历这些对象时能够获得正确的提示。

那么，有没有办法声明一个PHPDoc标签来指定成员变量是一个`SomeObj`s的数组呢？`@var`例如，数组是不够的，而且`@var array(SomeObj)`似乎无效。

* * *

## 回答 #1

> 赞同：919
> 
> 时间：2009-11-19T13:50:37.600

在 JetBrains 的 PhpStorm IDE 中，您可以使用`/** @var SomeObj[] */`，例如：

```
/**
 * @return SomeObj[]
 */
function getSomeObjects() {...} 
```

phpdoc[文档](https://docs.phpdoc.org/3.0/guide/references/phpdoc/types.html)推荐这种方法：

> 指定包含单个类型，类型定义通知读者每个数组元素的类型。然后，只期望一个 Type 作为给定数组的元素。
> 
> 例子：`@return int[]`

* * *

## 回答 #2

> 赞同：379
> 
> 时间：2009-04-22T19:28:04.433

**采用：**

```
/* @var $objs Test[] */
foreach ($objs as $obj) {
    // Typehinting will occur after typing $obj->
} 
```

键入提示内联变量时，以及

```
class A {
    /** @var Test[] */
    private $items;
} 
```

对于类属性。

**09 年 PHPDoc（以及 Zend Studio 和 Netbeans 等 IDE）没有该选项时的先前答案：**

你能做的最好的就是说，

```
foreach ($Objs as $Obj)
{
    /* @var $Obj Test */
    // You should be able to get hinting after the preceding line if you type $Obj->
} 
```

我在 Zend Studio 中经常这样做。不知道其他编辑器，但它应该工作。

* * *

## 回答 #3

> 赞同：60
> 
> 时间：2015-05-02T06:38:31.057

Netbeans 提示：

`$users[0]->`您可以为`$this->`一组用户类获得代码完成。

```
/**
 * @var User[]
 */
var $users = array(); 
```

当您完成`$this->...`

* * *

## 回答 #4

> 赞同：32
> 
> 时间：2013-01-01T13:16:13.470

指定一个变量是一个对象数组：

```
$needles = getAllNeedles();
/* @var $needles Needle[] */
$needles[1]->...                        //codehinting works 
```

这适用于 Netbeans 7.2（我正在使用它）

也适用于：

```
$needles = getAllNeedles();
/* @var $needles Needle[] */
foreach ($needles as $needle) {
    $needle->...                        //codehinting works
} 
```

`foreach`因此，没有必要在内部使用声明。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2016-09-09T00:02:44.453

[PSR-5：PHPDoc](https://github.com/php-fig/fig-standards/blob/211063eed7f4d9b4514b728d7b1810d9b3379dd1/proposed/phpdoc.md#collections)提出了一种泛型风格的表示法。

# 句法

```
Type[]
Type<Type>
Type<Type[, Type]...>
Type<Type[|Type]...> 
```

集合中的值甚至可能是另一个数组甚至另一个集合。

```
Type<Type<Type>>
Type<Type<Type[, Type]...>>
Type<Type<Type[|Type]...>> 
```

# 例子

```
<?php

$x = [new Name()];
/* @var $x Name[] */

$y = new Collection([new Name()]);
/* @var $y Collection<Name> */

$a = new Collection(); 
$a[] = new Model_User(); 
$a->resetChanges(); 
$a[0]->name = "George"; 
$a->echoChanges();
/* @var $a Collection<Model_User> */ 
```

注意：如果您希望 IDE 进行代码辅助，那么 IDE 是否支持 PHPDoc Generic 样式的集合表示法是另一个问题。

从我对[这个问题](https://stackoverflow.com/a/39384337/934739)的回答。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2012-10-16T23:32:54.327

我更喜欢阅读和编写干净的代码 - 正如 Robert C. Martin 的“干净代码”中所述。当遵循他的信条时，您不应该要求开发人员（作为您的 API 的用户）知道您的数组的（内部）结构。

API 用户可能会问：这是一个只有一维的数组吗？对象是否分布在多维数组的所有级别上？我需要多少个嵌套循环（foreach 等）才能访问所有对象？该数组中“存储”了哪些类型的对象？

正如您概述的那样，您希望将该数组（包含对象）用作一维数组。

正如 Nishi 所述，您可以使用：

```
/**
 * @return SomeObj[]
 */ 
```

为了那个原因。

但同样：请注意 - 这不是标准的 docblock 表示法。这种表示法是由一些 IDE 生产者引入的。

好的，好的，作为开发人员，您知道“[]”与 PHP 中的数组相关联。但是在普通 PHP 上下文中，“something[]”是什么意思呢？“[]”表示：在“某物”中创建新元素。新元素可能就是一切。但是您要表达的是：具有相同类型的对象数组并且它的确切类型。如您所见，IDE 生产者引入了一个新的上下文。您必须学习的新环境。其他 PHP 开发人员必须学习的新环境（以了解您的文档块）。糟糕的风格（！）。

因为您的数组确实有一个维度，您可能想将该“对象数组”称为“列表”。请注意，“列表”在其他编程语言中具有非常特殊的含义。例如，将其称为“收藏”会更好。

请记住：您使用的编程语言可以实现 OOP 的所有选项。使用类而不是数组，并使您的类像数组一样可遍历。例如：

```
class orderCollection implements ArrayIterator 
```

或者，如果您想将内部对象存储在多维数组/对象结构中的不同级别：

```
class orderCollection implements RecursiveArrayIterator 
```

此解决方案将您的数组替换为“orderCollection”类型的对象，但目前尚未在您的 IDE 中启用代码完成。好的。下一步：

使用 docblocks 实现接口引入的方法 - 特别是：

```
/**
 * [...]
 * @return Order
 */
orderCollection::current()

/**
 * [...]
 * @return integer E.g. database identifier of the order
 */
orderCollection::key()

/**
 * [...]
 * @return Order
 */
orderCollection::offsetGet() 
```

不要忘记使用类型提示：

```
orderCollection::append(Order $order)
orderCollection::offsetSet(Order $order) 
```

该解决方案不再引入很多：

```
/** @var $key ... */
/** @var $value ... */ 
```

正如 Zahymaka 用她/他的回答确认的那样，遍布您的代码文件（例如循环内）。您的 API 用户不必引入该文档块来完成代码。让@return 只在一个地方尽可能减少冗余（@var）。撒上“带有@var 的docBlocks”会使你的代码可读性变差。

最后你完成了。看起来很难实现？看起来像拿大锤敲碎坚果？不是真的，因为您熟悉这些接口和干净的代码。请记住：您的源代码编写一次/多次阅读。

如果您的 IDE 的代码完成不适用于这种方法，请切换到更好的方法（例如 IntelliJ IDEA、PhpStorm、Netbeans）或在您的 IDE 生产者的问题跟踪器上提交功能请求。

感谢 Christian Weiss（来自德国）担任我的教练并教给我这么棒的东西。PS：在 XING 上认识我和他。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2013-02-06T14:01:12.103

在 NetBeans 7.0（也可能更低）中，您可以声明返回类型“带有文本对象的数组” `@return Text`，代码提示将起作用：

**编辑：**用@Bob Fanger 建议更新了示例

```
/**
 * get all Tests
 *
 * @return Test|Array $tests
 */
public function getAllTexts(){
    return array(new Test(), new Test());
} 
```

并使用它：

```
$tests =  $controller->getAllTests();
//$tests->         //codehinting works!
//$tests[0]->      //codehinting works!

foreach($tests as $text){
    //$test->      //codehinting works!
} 
```

它并不完美，但最好只是让它“混合”，这没有任何价值。

缺点是您可以将数组作为文本对象进行处理，这会引发错误。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2014-04-14T23:18:31.977

**`array[type]`在 Zend Studio 中使用。**

在 Zend Studio 中，`array[MyClass]`甚至`array[int]`可以`array[array[MyClass]]`很好地工作。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2014-10-30T03:56:29.610

正如 DanielaWaranie 在她的回答中提到的那样 - 当您迭代 $collectionObject 中的 $items 时，有一种方法可以指定 $item 的类型：添加`@return MyEntitiesClassName`到返回值的and -methods`current()`的其余部分。`Iterator``ArrayAccess`

**繁荣！**不需要`/** @var SomeObj[] $collectionObj */`over `foreach`，并且可以与集合对象一起使用，无需使用描述为的特定方法返回集合`@return SomeObj[]`。

我怀疑并非所有 IDE 都支持它，但它在 PhpStorm 中运行良好，这让我更开心。

**例子：**

```
class MyCollection implements Countable, Iterator, ArrayAccess {

    /**
     * @return User
     */
    public function current() {
        return $this->items[$this->cursor];
    }

    //... implement rest of the required `interface` methods and your custom
} 
```

## 我要添加发布此答案有什么用

在我的情况下`current()`，其余的`interface`-methods 是在`Abstract`-collection 类中实现的，我不知道最终将哪种实体存储在集合中。

所以这里是诀窍：不要在抽象类中指定返回类型，而是`@method`在特定集合类的描述中使用 PhpDoc 指令。

**例子：**

```
class User {

    function printLogin() {
        echo $this->login;
    }

}

abstract class MyCollection implements Countable, Iterator, ArrayAccess {

    protected $items = [];

    public function current() {
        return $this->items[$this->cursor];
    }

    //... implement rest of the required `interface` methods and your custom
    //... abstract methods which will be shared among child-classes
}

/**
 * @method User current()
 * ...rest of methods (for ArrayAccess) if needed
 */
class UserCollection extends MyCollection {

    function add(User $user) {
        $this->items[] = $user;
    }

    // User collection specific methods...

} 
```

现在，类的用法：

```
$collection = new UserCollection();
$collection->add(new User(1));
$collection->add(new User(2));
$collection->add(new User(3));

foreach ($collection as $user) {
    // IDE should `recognize` method `printLogin()` here!
    $user->printLogin();
} 
```

再一次：我怀疑并非所有 IDE 都支持它，但 PhpStorm 支持。试试你的，在评论中发布结果！

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2016-12-23T00:21:18.220

我知道我迟到了，但我最近一直在解决这个问题。我希望有人看到这一点，因为接受的答案虽然正确，但*并不是*您可以做到这一点的最佳方式。至少不在 PHPStorm 中，不过我还没有测试过 NetBeans。

最好的方法是扩展 ArrayIterator 类，而不是使用原生数组类型。这允许您在类级别而不是实例级别键入提示，这意味着您只需 PHPDoc 一次，而不是在整个代码中（这不仅混乱而且违反 DRY，而且在涉及重构 - PHPStorm 有重构时缺少 PHPDoc 的习惯）

请参见下面的代码：

```
class MyObj
{
    private $val;
    public function __construct($val) { $this->val = $val; }
    public function getter() { return $this->val; }
}

/**
 * @method MyObj current()
 */
class MyObjCollection extends ArrayIterator
{
    public function __construct(Array $array = [])
    {
        foreach($array as $object)
        {
            if(!is_a($object, MyObj::class))
            {
                throw new Exception('Invalid object passed to ' . __METHOD__ . ', expected type ' . MyObj::class);
            }
        }
        parent::__construct($array);
    }

    public function echoContents()
    {
        foreach($this as $key => $myObj)
        {
            echo $key . ': ' . $myObj->getter() . '<br>';
        }
    }
}

$myObjCollection = new MyObjCollection([
    new MyObj(1),
    new MyObj('foo'),
    new MyObj('blah'),
    new MyObj(23),
    new MyObj(array())
]);

$myObjCollection->echoContents(); 
```

这里的关键是 PHPDoc`@method MyObj current()`覆盖了从 ArrayIterator 继承的返回类型（即`mixed`）。包含这个 PHPDoc 意味着当我们使用 迭代类属性时`foreach($this as $myObj)`，我们会在引用变量时获得代码完成`$myObj->...`

对我来说，这是实现这一点的最巧妙方法（至少在 PHP 引入类型化数组之前，如果他们曾经这样做的话），因为我们在可迭代类中声明迭代器类型，而不是在散布在代码中的类的实例上声明。

我没有在这里展示扩展 ArrayIterator 的完整解决方案，所以如果你使用这种技术，你可能还想：

*   根据需要包括其他类级别的 PHPDoc，用于诸如`offsetGet($index)`和`next()`
*   将健全性检查`is_a($object, MyObj::class)`从构造函数移到私有方法中
*   从方法覆盖调用这个（现在是私有的）健全性检查，例如`offsetSet($index, $newval)`和`append($value)`

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-04-22T21:04:10.787

问题是它`@var`只能表示一种类型 - 不包含复杂的公式。如果您有“Foo 数组”的语法，为什么要停在那里而不添加“数组数组，包含 2 个 Foo 和 3 个 Bar”的语法？我知道元素列表可能比这更通用，但它是一个滑坡。

就个人而言，我有时用来`@var Foo[]`表示“Foo 的数组”，但 IDE 不支持它。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-06-27T21:29:11.443

```
<?php foreach($this->models as /** @var Model_Object_WheelModel */ $model): ?>
    <?php
    // Type hinting now works:
    $model->getImage();
    ?>
<?php endforeach; ?> 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2021-11-17T13:00:14.357

如果您使用 PHPStorm 2021.2+，您也可以使用以下语法（数组形状）：

```
@property array{name: string, content: string}[] $files 
```

或者

```
@var array{name: string, content: string}[] $files 
```

* * *

## 回答 #14

> 赞同：-5
> 
> 时间：2010-01-13T10:43:15.870

我发现了一些有效的方法，它可以挽救生命！

```
private $userList = array();
$userList = User::fetchAll(); // now $userList is an array of User objects
foreach ($userList as $user) {
   $user instanceof User;
   echo $user->getName();
} 
```

# sockets - btw 2 pc 使用共享内存进行通信？

> ID：778571
> 
> 赞同：0
> 
> 时间：2009-04-22T18:32:32.273
> 
> 标签：sockets, shared-memory

我必须建立一个概念来使用共享内存或 tcp 套接字编程概念在两台计算机之间进行通信。我该怎么做？是否可以在客户端服务器架构中实现共享内存？我该怎么做？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T18:35:18.617

您无法使用共享内存在两台计算机之间进行通信，因为它们不共享内存。

您应该使用 TCP 套接字。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-29T09:53:43.617

您**可以**与具有*共享内存的远程系统进行通信。* *远程 DMA*是较新的高性能网络接口控制器卡 (NIC) 的一项功能。

这是一篇评估[10 Gb 以太网](http://www.neteffect.com/documents/rait2006_neteffect_wsd_on_iwarp.pdf)RDMA 性能的论文。我知道 infinaband 也可以 RDMA，其他可能。802.11 XXX出来了不是很好吗？无线 RDMA？:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T18:48:55.057

我认为您正在寻找的不是共享内存，而是更恰当地称为“反射内存”之类的东西。

使用反射内存块，网络上的每台计算机都拥有一块内存。每个块都以高速在所有计算机之间的总线上运行。每台计算机从所有其他计算机获取内存副本以供读取，但通常只能写入自己的内存。

因此，每台计算机都可以“看到”其他每台计算机的内存状态。通常，您会在工业控制系统中看到这种架构，将控制权分布在物理上独立的机器上，并希望近乎实时地查看整体状态。

至于构建一个系统，你可以从 UDP 数据包开始，这些数据包只会爆出本地计算机的状态，并让所有其他计算机读取该数据。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T20:10:01.070

您可能想研究类似[memcached](http://www.danga.com/memcached/)的东西，一个分布式内存对象缓存系统。

当然，这仍然是通过 TCP 完成的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T19:11:21.757

尖刻的回答“你不能这样做，因为计算机不共享内存”是完全错误的。**单台计算机中的处理器不共享内存**，硬件和软件实现共享内存协议以提供共享内存的假象。

跨处理器的共享内存协议与跨计算机的共享内存协议非常相似，这是同样的问题。

搜索“分布式缓存”“元组空间”和[“分布式共享内存”](http://en.wikipedia.org/wiki/Distributed_shared_memory)可能会提供一些思考。[memcached](http://www.danga.com/memcached/)是一个非常流行的开源产品，你可以看看。

编辑：关于“缓存一致性架构”的评论。每个处理器都有自己的本地内存缓存（例如 L1 缓存）。有一大堆“东西”恰好使这个“缓存连贯”，因此看起来每个处理器都在读取和写入共享内存空间。处理器绝对不会直接写入单个共享内存空间。对于跨计算机的共享内存，这个问题在概念上是相同的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-29T10:02:24.427

我推荐[Beej 的网络编程指南](http://www.beej.us/guide/bgnet/)。

# iphone - 实时视频流，如何在 iPhone 上播放？

> ID：778574
> 
> 赞同：1
> 
> 时间：2009-04-22T18:34:00.303
> 
> 标签：iphone, video-streaming, live-streaming

我想知道有什么可以以开发人员的方式在我的 iPhone 上播放实时视频。很少有应用程序存在并播放实时流，例如：

> http://qik.com/
> http://www.ustream.tv
> http://orb.com/en/orblive

你知道他们是如何做到这一点的吗？

非常感谢。

蒂埃里

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T18:48:16.213

iPhone 3.0 软件包括用于视频流的新 API。不幸的是，它目前处于保密协议之下，所以没有人可以在这些论坛上真正谈论它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-08-22T11:02:52.447

我们必须将我们的直播流编码为 HLS 格式，例如 .m3u8、mp4 和 iOS 中的任何其他 HLS 支持格式。Apple 不批准没有 HLS 格式的直播。您可以使用 wowza 媒体服务器将您的服务器 url 编码为 HLS 格式在 iOS 中支持，然后您可以通过 iOS 中的 MPMoviePlayerController 播放它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-01-13T04:36:38.463

您可以将 ffmpeg & live555 迁移到 iOS 以在 iOS 上实现视频直播。

这是一个开源项目： [https ://github.com/dropcam/dropcam_for_iphone](https://github.com/dropcam/dropcam_for_iphone)

事实上，我已经尝试将 ffmpeg 0.6 和 live555 迁移到 iOS，并制作了一个简单的视频流应用程序。这是完全可行的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-22T09:06:39.630

我确实在直播视频流中工作。不幸的是，我对此没有任何解决方案。直到今天，苹果还没有在其 SDK 中包含 RTSP 流媒体支持。所以目前他们不是任何直播视频流的解决方案，也许我们将来可能会有一些。

# c# - 从 C++ 调用 C# 代码

> ID：778590
> 
> 赞同：57
> 
> 时间：2009-04-22T18:38:32.727
> 
> 标签：c#, c++-cli, interop

我需要能够从 C++ 调用任意 C# 函数。[http://www.infoq.com/articles/in-process-java-net-integration](http://www.infoq.com/articles/in-process-java-net-integration)建议使用 ICLRRuntimeHost::ExecuteInDefaultAppDomain() 但这仅允许我调用具有以下格式的方法：`int method(string arg)`

调用任意 C# 函数的最佳方法是什么？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2014-04-20T13:07:43.737

C++ 应用程序有多种方法可以调用 C# DLL 中的函数。

1.  使用 C++/CLI 作为中间 DLL
    *   [http://blogs.microsoft.co.il/sasha/2008/02/16/net-to-c-bridge/](http://blogs.microsoft.co.il/sasha/2008/02/16/net-to-c-bridge/)
2.  反向 P/Invoke
    *   [http://tigerang.blogspot.ca/2008/09/reverse-pinvoke.html](http://tigerang.blogspot.ca/2008/09/reverse-pinvoke.html)
    *   [http://blogs.msdn.com/b/junfeng/archive/2008/01/28/reverse-p-invoke-and-exception.aspx](http://blogs.msdn.com/b/junfeng/archive/2008/01/28/reverse-p-invoke-and-exception.aspx)
3.  使用 COM
    *   [http://msdn.microsoft.com/en-us/library/zsfww439.aspx](http://msdn.microsoft.com/en-us/library/zsfww439.aspx)
4.  使用 CLR 托管 ( `ICLRRuntimeHost::ExecuteInDefaultAppDomain()`)
    *   [http://msdn.microsoft.com/en-us/library/dd380850%28v=vs.110%29.aspx](http://msdn.microsoft.com/en-us/library/dd380850%28v=vs.110%29.aspx)
    *   [http://msdn.microsoft.com/en-us/library/ms164411%28v=vs.110%29.aspx](http://msdn.microsoft.com/en-us/library/ms164411%28v=vs.110%29.aspx)
    *   [https://stackoverflow.com/a/4283104/184528](https://stackoverflow.com/a/4283104/184528)
5.  进程间通信（IPC）
    *   [如何从 C# 应用程序远程调用另一个进程方法](https://stackoverflow.com/q/19999049/184528)
    *   [http://www.codeproject.com/Tips/420582/Inter-Process-Communication-between-Csharp-and-Cpl](http://www.codeproject.com/Tips/420582/Inter-Process-Communication-between-Csharp-and-Cpl)
6.  编辑：托管 HTTP 服务器并通过 HTTP 动词调用（例如 REST 样式 API）

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2009-04-22T19:02:15.227

**使用/clr**标志编译 C++ 代码。这样，您就可以相对轻松地调用任何 .NET 代码。

例如：

```
#include <tchar.h>
#include <stdio.h>

int _tmain(int argc, _TCHAR* argv[])
{
    System::DateTime now = System::DateTime::Now;
    printf("%d:%d:%d\n", now.Hour, now.Minute, now.Second);

    return 0;
} 
```

这算作“C++”吗？好吧，它显然不是*标准 C++* ...

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2019-08-17T09:06:00.280

请参阅[DllExport](https://github.com/3F/DllExport)。

**IOW：**与工作方式完全相反`DllImport`。

[https://github.com/3F/DllExport](https://github.com/3F/DllExport)

它支持 Windows，并正在开发跨平台支持。

C# 代码（我们从 C++ 中调用）：

```
[DllExport]
public static int _add(int a, int b)
{
    return a + b;
}

[DllExport]
public static bool saySomething()
{
    DialogResult dlgres = MessageBox.Show(
        "Hello from managed environment !",
        ".NET clr",
        MessageBoxButtons.OKCancel
    );

    return dlgres == DialogResult.OK;
} 
```

C++ 代码（调用之前的 C# 代码）：

```
typedef int(__cdecl *_add)(int a, int b);
typedef bool(__cdecl *saySomething)();

auto pAdd = (_add)GetProcAddress(lib, "_add");
int c = pAdd(5, 7);

auto pSaySomething = (saySomething)GetProcAddress(lib, "saySomething");
bool dlgres = pSaySomething(); 
```

[以及在Managed & Unmanaged](https://www.youtube.com/watch?v=9Hyg3_WE9Ks)上带有演示的 YouTube 视频；[调用；](https://www.youtube.com/watch?v=9Hyg3_WE9Ks)[[Conari 与 DllExport]](https://www.youtube.com/watch?v=9Hyg3_WE9Ks)。老实说，文档还不够完美，但不要让这让您失望：YouTube 视频非常棒。

该项目的灵感[来自 Robert Giesecke 的另一个项目，](https://sites.google.com/site/robertgiesecke/Home/uploads/unmanagedexports)该项目在 NuGet 上有[220,000 次下载](https://www.nuget.org/packages/UnmanagedExports)。

有趣的事实：一些 Python 库已经使用它来实现 C++ 和 C# 混合的功能。

最后，感谢 Robert Giesecke 和 Denis Kuzmin 的出色工作！

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-22T19:18:32.833

如果您不关心您的 C++ 程序（或其中的一部分）是否使用 /clr 编译，则可以使用 C++/CLI 简单地调用任何 .NET 代码（只要添加对它的引用）。 [试试这篇文章](http://msdn.microsoft.com/en-us/library/ms379617(VS.80).aspx)。

编辑：这是[一个很好的教程](http://www.functionx.com/cppcli/index.htm)

另一种方法是让您的 C# 代码公开为 COM。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-22T18:41:05.187

最简单的方法是使用 COM 互操作。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-22T19:23:45.020

您可以在编译成 DLL 的 C# 代码周围使用[COM 可调用包装器。](http://msdn.microsoft.com/en-us/library/f07c8z1c.aspx)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-22T21:18:38.223

作为一种替代方法，您可以使用[Lua](http://www.lua.org/about.html)来实例化 CLR 对象、执行并返回结果。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2019-08-17T09:16:48.967

来自 Microsoft：[编写自定义 .NET Core 主机以从您的本机代码控制 .NET 运行时](https://docs.microsoft.com/en-us/dotnet/core/tutorials/netcore-hosting)。

**IOW：**在 Windows 和 Linux 上从 C++ 调用 C#。

[GitHub 上](https://github.com/dotnet/samples/tree/master/core/hosting/HostWithMscoree)有示例代码。

此示例代码是跨平台的，它允许从 Linux 和 Windows 上的任何 C++ 应用程序调用 .NET Core 中的 C# 代码。

`DllExport`老实说，与其他答案相比，这个解决方案似乎相当复杂。C++ 代码在扫描资源和入口点等方面做了很多繁重的工作。这个答案的一个论点可能是它是跨平台的。但是，另一个`DllExport`答案也是跨平台的，并且使用起来更简单。

# firefox - Firebug 调试器在 Firefox 3.x 中不起作用？

> ID：778591
> 
> 赞同：0
> 
> 时间：2009-04-22T18:39:05.347
> 
> 标签：firefox, firebug, firefox-addon, firefox-3

我已经使用[Firebug](http://en.wikipedia.org/wiki/Firebug_%28software%29)一段时间了，在过去的一个月里，我无法让 JavaScript 调试器工作。我的意思是，它有时会起作用，但它在 80% 的时间里会做随机的事情。我不认为这只是我，因为我的一个朋友有同样的问题。

我已经用谷歌搜索了这个问题，但我无法找到一个有趣的答案。在[http://getfirebug.com/](http://getfirebug.com/)上也一样。

现在，我在 Windows XP 上安装了最新版本的 Firefox 3 和最新的 Firebug，但它自 1 月以来一直没有工作。

有没有开票之类的？那会很有帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T18:56:33.463

如果您使用的是 FF 3.0，请尝试删除 FireBug 插件并重新安装。您可能必须清除所有 FireBug 设置的 prefs.js 文件。

如果您使用的是 FF 3.1，那么目前确实没有好的解决方案，如果您需要使用 FireBug，我建议降级。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T18:40:32.487

通常当这种情况发生在我身上时，我会重新安装萤火虫。

此外，萤火虫不喜欢长的 javascript 文件。如果您可以对调试的文件大小做一些事情，请尝试调试一堆小文件而不是一个大文件。

# sharepoint - 如何修改 SharePoint 列表 Web 部件中的“摘要视图”？

> ID：778593
> 
> 赞同：3
> 
> 时间：2009-04-22T18:39:34.643
> 
> 标签：sharepoint, web-parts

我在团队网站上使用公告列表，并使用现成列表 Web 部件在页面上显示该列表。我喜欢摘要视图修剪每个列表项的正文的事实，但我想在摘要视图中显示一个附加列。有没有办法在不使用 SharePoint Designer 的情况下做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-31T03:18:20.660

您可以通过修改 Web 部件、单击“编辑当前视图”并添加附加列来显示附加信息。这将显示在您的正文下方。如果这不是您想要的位置.. 您将需要 SharePoint Designer。

# c# - How can I keep a Button/TextBox/etc in session?

> ID：778601
> 
> 赞同：0
> 
> 时间：2009-04-22T18:41:14.687
> 
> 标签：c#, silverlight

I have a canvas on my page and when i click a button i'm creating a new button dynamically on my canvas. So, i whant to keep my button somewhere where i can access anytime anywhere on my project( to change text for example, or to format it).Can someone give me a solution?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T18:48:17.837

This type of functionality is usually done via callbacks (delegates) on your page / form or tied to your control.

Have whatever you want to trigger the change, register to some event you have defined with your button/textbox/page.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T22:43:52.323

Silverlight runs completely on the client, inside the browser, so there's no need to worry about storing things in session state on the server. Well, unless you are posting back to the server from within your app, but there's no indication in your question that you're doing that.

If you create a button in Silverlight (from a page or control), it will be available to you in that page or control just like any regular old .NET variable. If it's declared as a field, you can get at it from anywhere.

```
public partial class MainControl : UserControl
{
    private Button myButtonToKeepAroundAllTheTime;

    protected void TriggerButton_Click(object sender, EventArgs e)
    {
        myButtonToKeepAroundAllTheTime = new Button()
        {
            Content = "Click Me",
            Height = 20
        };
    }
} 
```

# asp.net - ASP.NET 中的线程权限

> ID：778606
> 
> 赞同：0
> 
> 时间：2009-04-22T18:42:30.843
> 
> 标签：asp.net, multithreading, permissions

我正在 ASP.NET 页面的新线程上启动冗长的导入。

一切正常，*除了*当我尝试从工作线程写入日志文件时获得失败的 IO 权限，这在主线程中不是问题。

我正在使用没有模拟的 IIS7 集成模式，尽管在经典模式下模拟得到了相同的结果。

这个问题几乎与[这个](https://stackoverflow.com/questions/120404/problem-accessing-file-from-different-thread-in-asp-net)相同，只是我没有 Response.Redirect 并且在接受的答案中没有看到适用的修复。

**编辑：**我需要在不重新配置服务器权限的情况下解决这个问题。足够的权限已经到位，无论如何我都无法在目标机器上访问它。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T18:53:37.510

尝试让 IIS_WPG 组访问您的日志文件。

您的请求可能使用您为“匿名访问”定义的帐户运行，而工作线程作为“网络服务”运行。

# asp.net-mvc - ASP.NET MVC 中的 ReturnUrl

> ID：778607
> 
> 赞同：30
> 
> 时间：2009-04-22T18:42:35.167
> 
> 标签：asp.net-mvc

我目前在我的应用程序上有一个登录链接，看起来像这样：

```
<a href="/login?ReturnUrl=" + <%= Request.RawUrl %>>Login</a> 
```

我想在下面的控制器操作中处理登录页面上的 POST 命令：

```
[AcceptVerbs(HttpVerbs.Post)]
public ActionResult Login(string returnUrl)
{
    // Authenticate user

    return Redirect(returnUrl);
} 
```

这里的问题是，如果 RawUrl 是具有多个 url 参数的东西，例如“somepage?param1=1¶m2=2¶m3=3”，那么传递给 Login 操作的 returnUrl 在第一个＆符号之后被截断：“somepage?param1=1” .

我已经尝试过对 RawUrl 进行 UrlEncoding ，但这似乎有什么不同。似乎这里的 ASP.NET MVC 框架是在将 url 参数映射到控制器操作参数之前对它们进行 UrlDecoding，这最终剥离了我想在我的 returnUrl 参数中看到的其他 url 参数。

有没有办法解决？我知道我可以只使用 Request.Path 并解析出我需要的值，但我想我会先看看是否有更清洁的方法。

* * *

## 回答 #1

> 赞同：38
> 
> 时间：2009-04-22T18:47:43.390

您可能错误地对链接进行了编码。是的，它们确实需要编码。以下是我们的做法：

```
<a href="<%= Url.Action("Delete", "TimeRecord", 
    new RouteValueDictionary(new { id = timeRecord.AltId, 
    returnUrl=ViewContext.HttpContext.Request.Url.PathAndQuery }) ) %>"> 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-22T18:53:01.757

确保在使用 RawUrl 之前对它进行 URL 编码。

```
<%= Url.Encode(Request.RawUrl) %> 
```

这应该为你做。

# c# - 带有组合框的数据网格视图

> ID：778609
> 
> 赞同：0
> 
> 时间：2009-04-22T18:42:50.877
> 
> 标签：c#, .net, winforms

我创建了两个类：

```
public class Params : List<Param>
{

}

public class Param
{
    public enum enType
    {
        Integer,
        Double,
        String,
        DateTime
    }

    private string sName_m;
    public string Name
    {
        get { return sName_m; }
        set { sName_m = value; }
    }

    private string sValue_m;
    public string Value
    {
        get { return sValue_m; }
        set { sValue_m = value; }
    }

    private enType eType_m;
    public enType Type
    {
        get { return eType_m; }
        set { eType_m = value; }
    }
} 
```

现在我希望能够在 Windows 应用程序的 Grid 类型控件中显示 Params，所以我将 DataGridView 拖到我的表单上，并通过选择 Other Data Sources -> Project Data Source 来选择数据源，然后选择我的 Params类（frmMain+Params）。

现在，当我运行应用程序时，我可以添加/删除/编辑记录，并且网格会显示三列。我想要做的是让 Type 列成为下拉列表，让我在枚举中选择值。目前，我必须键入一个必须与枚举匹配的字符串。可能的？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T19:02:38.330

我永远无法获得自动数据绑定来正确设置[DataGridViewComboBoxCell / DataGridViewComboBoxColumn](http://msdn.microsoft.com/en-us/library/system.windows.forms.datagridviewcomboboxcolumn.aspx)（也不是 CheckBox 的），因此我将 AutoGenerateColumns 设置为 false 并手动设置列。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T19:27:45.727

您可以禁用列的自动生成并手动生成所需的正确列，或者您可以删除该列并在其位置添加一个新列。

```
var columns = dataGridView1.Columns;

var oldColumn = columns.Cast<DataGridViewColumn>()
                       .Single(c => c.DataPropertyName == "Type");
var index = columns.IndexOf(oldColumn);

var newColumn = new DataGridViewComboBoxColumn();
newColumn.Name = "Type";
newColumn.DataSource = Enum.GetValues(typeof(Param.enType));
newColumn.ValueType = typeof(Param.enType);

columns.RemoveAt(index);
columns.Insert(index, newColumn); 
```

# language-agnostic - 您如何避免文档注释中的冗余？

> ID：778611
> 
> 赞同：11
> 
> 时间：2009-04-22T18:43:06.180
> 
> 标签：language-agnostic, documentation, coding-style

我们刚开始使用 StyleCop，我遇到的一件事是文档要求。我不想讨论该工具的有用性，我只是想知道是否有人有任何指导方针或思考方法来记录使评论真正有用的方法。我发现我的评论经常包含很多重复只是为了满足 StyleCop 的要求，比如：

```
 /// <summary>
    /// Gets a dto of personal info.
    /// </summary>
    /// <param name="userId">
    /// The id of the user.
    /// </param>
    /// <returns>
    /// A dto containing personal info.
    /// </returns>
    public PersonalInfoDTO GetPersonalInfoDTO(int userId) {...} 
```

是否有标准的方式来表达摘要和退货描述？你在你的参数描述中放了什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-22T18:57:20.717

我试图通过在摘要中描述过程来避免重复。在参数中，您可以添加详细信息，例如有效范围，或用户期望如何获取此信息。对于返回，我还列出了任何错误条件，例如：

```
/// <summary>
/// Gets a dto of personal info by querying the current list of users (or active directory or SQL)
/// </summary>
/// <param name="userId">
/// The id of the user. Must be greater than 0\. The ID is stored in the application context or can be retrieved by a call to GetUserIdByName.
/// </param>
/// <returns>
/// A dto containing personal info. Returns null if the specified user information was not found.
/// </returns>
public PersonalInfoDTO GetPersonalInfoDTO(int userId) {...} 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-22T18:55:12.017

如果它是强加给你的，那么你可能只需要忍受一些重复，因为你已经使用了像智能命名这样的良好的自我记录技术。

您可以在文档中包含的其他好处是：1）格式化 - 对用户 ID 是否有任何限制，例如“所有低于 500 的用户都是管理员”或类似的东西？这些很好用参数评论。

2) 异常 - 如果您的方法要抛出或传递一个异常，请将其记录下来，以便使用它的人知道如何处理它。

3) 代码示例 - 展示如何使用您的方法

4) 特殊条件 - 返回对象是否会处于任何奇怪的状态？如果未找到用户 ID，您是否传回 null 或空白/错误 PersonalInfoDTO？

当然，在简单的方法上，似乎有很多冗余信息，但更复杂的代码可以从详尽的文档中受益匪浅。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-22T18:55:19.347

执行这个标准是有原因的，即使你觉得它有时是多余的信息。（即“userId -> 用户的ID”）该注释还隐含地包含该参数没有附加约束的信息。

所以，

```
...
///<param name="angle"> 
///The angle in degrees. Must be below 360 and above 0.
///</param>
... 
```

如果您不添加“必须低于 x 和高于 y”，那么您就是在声明对参数没有限制。

< 返回 > 标签也是如此。您可能认为返回值是不言自明的，但是 <returns> 标记是您应该告诉调用方这是否可以在错误时返回 null 的地方。或者如果它返回一个值，即使有一个可能的响应列表。

这种信息非常非常重要，stylecop 只是强制你添加它。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-22T18:59:12.067

贾杜布：

请记住，这些注释的*目的*是为您的代码创建文档。冗余是可以的，因为这些评论的不同部分可能在不同的场景中以不同的方式使用——在某些情况下，并非所有评论都可以使用。

尽管 XML doc 对于创建 MSDN 样式的帮助文件很有用，但它也广泛用于 Visual Studio 中的智能感知和工具提示。您的摘要将在某些时间可见，您的参数标签将在其他时间可见，您的退货标签将在其他时间可见。有时它们将一起可见，有时则不可见。

简而言之，冗余**是**有用的。当您使用它记录的方法或类时，它为您作为程序员在不同情况下提供帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T18:51:52.257

“记录使评论真正有用的方法。我发现我的评论经常包含很多重复只是为了满足 StyleCop 的要求”

有用和冗余无关。

您尚未在问题中定义“有用”。通常它的意思是“超过 stylecop 的要求”。如果你觉得需要写更多的东西，那么，写更多的东西。Stylecop 是最低要求；你可以自由地超越这些最小值。

在您的情况下，因为您正在编写一个功能很少的摘要。形式元素（参数和返回类型）和摘要会相互重复是很常见的。我不确定这种重复如何未能通过“有用”测试。也许如果*缺少*某些东西，您可以添加它。随意扩展和编写更多内容——没有什么能阻止您编写超过最低限度的“有用”文档。

冗余——虽然乏味——似乎并没有什么用处。

请记住，您的评论最终会创建索引以及纯文本页面。正式结构化的部分对于索引和格式化​​是必不可少的。

对于更复杂的类（和函数），总结是一个扩展细微差别的地方。例如“为什么？” 或“何时可以使用和不能使用”，“其他约束”和“代码示例”以及那些更有用的东西。

在任何时候，你都可以——而且应该——写得*超过*最低限度。但是，对于微不足道的函数，编写超过最小值没有意义。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-22T18:56:57.533

我倾向于非常怀疑那些强迫你在非常随意的地方添加评论的工具。

不要误会我的意思，我是评论的坚定拥护者。但是像您示例中的那些评论是纯粹的“噪音”：它们不会添加任何有用的信息，并且任何有意义的信息（如果有）都隐藏在绒毛后面。

如果评论可以由自动工具生成......那么人类首先没有必要编写它们。如果出于某些其他原因（例如生成外部文档）这是强制性的，您应该有某种形式的自动脚本来生成这些，并将结果放在不显眼的位置。

当然，关于这个函数的界面，你可以说很多有意义的事情。例如，参数的界限是什么。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-28T21:51:25.850

有很多重复 - 恕我直言，最糟糕的是属性，您应该在其中填写描述属性的 <value>，但智能感知只显示 <summary>，对于属性只能真正描述相同的东西，所以你最终把同样的话说了两次。

我尝试在摘要中简要总结属性/方法，但在 <param>、<value> 和 <returns> 字段中添加更详细的描述，以便它们提供一些真正更有用的信息。（例如它们是否可以作为 null 传入等）

我要做的第二件事是使用我编写的插件来自动生成和自动更新 Doc 注释，这样我就可以最大限度地减少记录代码所涉及的工作 - 如果自动化工具可以填写大部分对我来说详细信息，它最大限度地减少了维护此“重复”信息所涉及的工作量。它还自动格式化和自动换行评论以保持整洁。

有关更多信息和免费下载，请参见[http://www.atomineer.com/AtomineerUtils.html](http://www.atomineer.com/AtomineerUtils.html)。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-28T22:09:21.160

你可以让它变得有用：

```
/// <summary>
/// Gets the user's personal information.
/// </summary>
/// <remarks>
/// We need this data transfer object in order to bridge Backend.SubsystemA
/// and Backend.SubsystemB. The standard <see cref="PersonalInfo"/> won't
/// work.
/// </remarks>
/// <param name="userId">Integer representing the user's ID.</param>
/// <returns>
/// <see cref="PersonalInfoDTO"/> representing the user, or <c>null</c>
/// if not available.
/// </returns>
public PersonalInfoDTO GetPersonalInfoDTO(int userId) {...} 
```

对我来说，`summary`是高级的“此方法的目的是什么”信息，`remarks`用于进一步解释，并且`see`您可以轻松地在文档中移动。每一个都增加了价值。

感谢[ReSharper](http://haacked.com/archive/2006/07/19/ResharperCanPreviewXMLCommentsAsHTML.aspx) ，我真的很喜欢文档评论。我已将 QuickDoc 命令重新映射到`CTRL+SHIFT+Q`.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-28T22:10:08.850

如果您正在使用 Java，则必须注意完整的文档 - 文档越多，用户找到实际相关内容的机会就越小。添加额外的标记只会使情况变得更糟。

您可能只想考虑捕获“指令”或至少非常强烈地突出显示它们。

请参阅基于我的博士学位的关于[“编写出色 javadoc 的提示”的](https://stackoverflow.com/questions/398546/technical-tips-for-writing-great-javadoc/)详细回复。对此课题的研究。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-09-24T17:57:24.443

问题如下......

1.  对。没有人阻止你写评论，但它们变得更难维护。如果注释与代码不匹配，阅读代码的人可能会感到困惑。承认我们稍后都会更改代码并且忘记/没有时间更新它们。更换
2.  有些方法真的很简单，不需要任何注释。
3.  阅读 1000 行代码比阅读 100 行正确编写的代码更难。是的，即使使用视觉工作室着色
4.  注释代码中的每个方法都需要花费大量时间。
5.  如果您正在构建一个库，但不是为了一些不可重用的东西，这些评论是可以的..比如一个小的 silverlight 应用程序。

# xslt - XSL 变换间距

> ID：778612
> 
> 赞同：2
> 
> 时间：2009-04-22T18:43:58.220
> 
> 标签：xslt, whitespace

我正在使用 Xsl 转换将 Xml 数据显示为 Html。

```
<xsl:stylesheet version="1.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
 xmlns:ms="urn:schemas-microsoft-com:xslt"
 xmlns:util="urn:the-xml-files:xslt">
 <xsl:output method="xml" indent="yes"
  omit-xml-declaration="yes" encoding="utf-8"/>

 <xsl:template match="/">
     <xsl:for-each select="/Categories/Category">
       <li class="c">
         <a class="d">
          <xsl:attribute name="id">cat_<xsl:value-of select="categoryid"/></xsl:attribute>
         </a>
       </li>
     </xsl:for-each>
 </xsl:template>
</xsl:stylesheet> 
```

如果 li 元素的 id 属性的 select 不在一行中，XSL 处理器会用空格填充属性值，这完全破坏了前端的 javascript。

当然，Visual Studio 总是会在一行中重新格式化许多定义，所以如果我更改某些内容，我需要手动删除空格。

如何从元素中删除不必要的空格？我应该使用 xsl:strip-space 执行 xsl:copy，还是有更好的解决方案？:)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T19:04:11.307

**解决方案很简单**：

代替：

```
 <a class="d">
      <xsl:attribute name="id">cat_<xsl:value-of select="categoryid"/></xsl:attribute>
     </a> 
```

采用：

```
 <a class="d" id="cat_{categoryid}"/> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T19:12:50.337

除了 Dimitre 的优雅解决方案之外，还提供以下详细版本：

```
<a class="d">
   <xsl:attribute name="id">
      <xsl:text>cat_</xsl:text>
      <xsl:value-of select="categoryid"/>
   </xsl:attribute>
</a> 
```

我只提到这一点是因为`<xsl:text>`它经常被忽视并且非常有用。无论如何，XSL 是一种冗长的语言。

# jquery - 将变量从 html 文件传递 到外部 jQuery 函数

> ID：778617
> 
> 赞同：0
> 
> 时间：2009-04-22T18:45:16.063
> 
> 标签：jquery

我一直在互联网上搜索，试图找到一种使用 jQuery 来做到这一点的方法。我的情况是这样的，我在外部scripts.js文件中有一个tablesorter函数（使用jQuery插件tablesorter），如下所示：

```
$(function() {
     $(aTable).tablesorter({ 
        // Go through each column and sort data according to type of data in the column
    });
    }); 
```

在我的 html 文件中，我在脑海中声明如下

```
<script type="text/javascript" src="starterkit/jquery-1.3.2.js"></script>
<script type="text/javascript" src="starterkit/jquery.tablesorter.js"></script>
<script type="text/javascript" src="starterkit/scripts.js"></script>
<script type="text/javascript">
var aTable = $("#myTable");
var columns = $("#myTable tbody th:").length;
</script> 
```

我想要做的是将aTable和columns变量传递给外部函数，并使用for循环循环遍历每一列以确定**a）**是否应该对列进行排序以及**b）**如果要排序，是什么样的数据在列中？根据此数据添加特殊解析器，即如果列包含日期，添加日期解析器等。我完全卡住了，任何提示都表示赞赏。

**更新**

@Chad Bird，这是我最初为一个表实例提供的完整代码，我还包括了我正在使用的示例表：

```
$(function() {
     $(aTable).tablesorter({ 
        // pass the headers argument and passing a object 
        headers: {
            // place usLongDate parser in date column for proper sorting
            2 : { sorter: "usLongDate"  },
            // assign the fourth column (we start counting zero) 
            3: { 
                // disable it by setting the property sorter to false 
                sorter: false 
            }, 
            // assign the eighth column (we start counting zero) 
            7: { 
                // disable it by setting the property sorter to false 
                sorter: false 
            } 
        } 
    });
    }); 
```

样品表

```
<table id="myTable" summary="Table is used to list available workshops"  cellspacing="0">
            <thead>
                <tr>
                    <th><a rel = "Header" href="#" title="Sort column in decending order" class="sort-down">Title</a></th>
                    <th><a rel = "Header" href="#" title="Sort column in ascending order" class="sort-down">Instructor</a></th>
                    <th><a rel = "Header" href="#" title="Sort column in decending order" class="sort-up">Date</a></th>
                    <th id="1">Start/End</th>
                    <th><a rel = "Header" href="#" title="Sort column in decending order" class="sort-up">Seats Available</a></th>
                    <th><a rel = "Header" href="#" title="Sort column in decending order" class="sort-up">Enrolled</a></th>
                    <th><a rel = "Header" href="#" title="Sort column in decending order" class="sort-up">Pre-Requisites</a></th>
                    <th id="1">Workshop Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Basic Economics for CEOs</td>
                    <td>George Washington</td>
                    <td>March 2, 2009</td>
                    <td>9:00am - 11:00am</td>
                    <td>0 / 20</td>
                    <td></td>
                    <td></td>
                    <td>Details</td>
                </tr>
                <tr>
                    <td>Intro. to Psychology</td>
                    <td>Jimi hendrix</td>
                    <td>March 6, 2009</td>
                    <td>10:00am 12:00pm</td>
                    <td>11 / 15</td>
                    <td>Enrolled</td>
                    <td></td>
                    <td>Details</td>
                </tr>
<tr>
                    <td>Improving the Workplace</td>
                    <td>Dr. Manhattan</td>
                    <td>March 20, 2009</td>
                    <td>3:00pm - 4:30pm</td>
                    <td>12 / 18</td>
                    <td>Enrolled</td>
                    <td></td>
                    <td>Details</td>
                </tr>
                <tr>
                    <td>Music appreciation</td>
                    <td>Tupac Shakur</td>
                    <td>March 21, 2009</td>
                    <td>10:30am - 12:30pm</td>
                    <td>20 / 25</td>
                    <td></td>
                    <td></td>
                    <td>Details</td>
                </tr>
            </tbody>
        </table> 
```

基本上，我正在努力做到这一点，因此实现这一点的任何人只需要担心为所有表提供一致的名称，即所有表都被命名为“myTable”。该函数负责计算列数，确定（通过在表头中搜索 id="1"）是否将列设置为 sorter: false，或者，如果确实需要排序，则确定类型列中的数据，即如果列包含日期，则添加 usLongDate 解析器等。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T18:52:30.337

也许我误解了您要执行的操作，但我认为 tablesorter 已经具有您要创建的功能。您可以在初始化 tablesorter 时定义每个列的排序解析器，或者禁用某些列作为排序方法。如果您愿意，我可以添加一些代码示例，但您能先澄清一下这是否真的是您想要做的吗？

如果您只是尝试初始化 tablesorter，就像 skurpur 所说的那样，您只是按错误的顺序做事。您似乎还缺少几个`</script>`标签，但也许您只是在此处添加代码时从代码中删除了这些标签。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T18:50:59.887

如果您在内联 JavaScript*之后*`aTable`包含外部函数等，那么您应该已准备就绪。

# asp.net - 枚举中的VB括号？

> ID：778618
> 
> 赞同：2
> 
> 时间：2009-04-22T18:45:16.657
> 
> 标签：asp.net, vb.net, syntax, brackets

我在一些遗留代码中发现了这一点，只是好奇括号是干什么用的？

```
Public Enum myEnum
    none = 0
    abc = 2
    def = 4
    ghi= 6
    [jkl] = 8
    mno = 9
End Enum 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-22T18:49:14.837

在您提供的示例中不需要它们，我假设您已将其隐藏，但括号允许您为枚举项指定名称，否则该名称将与保留字冲突。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-22T18:47:31.003

当您想为变量、类名、函数名或通常不允许使用关键字的其他内容使用关键字时，通常会使用括号。这是[vb.net 关键字](https://docs.microsoft.com/en-us/dotnet/visual-basic/language-reference/keywords/)的列表。

# iphone - 我是否总是对 iPhone 操作系统调用 didReceiveMemoryWarning 负责？

> ID：778632
> 
> 赞同：1
> 
> 时间：2009-04-22T18:49:04.620
> 
> 标签：iphone, objective-c, cocoa-touch

我有一个关于如何以及何时调用 didReceiveMemoryWarning 的快速查询。我完全理解如何正确使用该方法。但是，我在文档中找不到的问题是，我为调用此方法管理内存占用的方式是否是我的错？

是否有可能我做的一切都很好并且 iPhone OS 需要内存，因此向我发送此通知，因为我是第三方应用程序？我一直在运行泄漏、ObjectAlloc 和任何可用的工具，以查看任何奇怪的行为。我的内存占用峰值最多为 2.2MB。我没有看到任何特别可怕的代码明智地完成。

现在它已经到了我将打开一些其他应用程序的地步，在这里和那里使用我的 iPhone——然后打开我正在开发的应用程序。这个视图最终是一个 UITableViewController，它显示了一个从远程 XML 提要构建的数据源。所以我可能做错了什么。但是在对我自己的代码进行任何指责之前，我需要更好地理解这种方法。

是否可以在管理内存的方式非常健康的应用程序上调用此方法？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T19:37:08.343

内存警告随时可能发生。有一些应用程序在后台运行，比如 Mail 和 Safari，它们在做谁知道什么。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T21:10:50.787

在许多方面，谁负责并不重要。苹果的代码确实泄露了；尤其是图像选择器和 HTTP 类（尽管后者不会严重泄漏）。无论导致警告的原因是什么，您是唯一可以编写代码从警告中恢复的人。

应用程序没有记录的内存占用（我知道），因此我认为此消息肯定有可能随时发送到应用程序。它肯定会在模拟器和手机上的不同时间发送。这意味着没有“安全足迹”可以保证永远不会收到内存警告。显然，保持低内存占用会降低它的可能性。

也许您应该发布一些示例代码，看看它是否泄漏了很多。您描述的应用程序听起来很简单，在正常使用时不会导致内存警告。

# asp.net - 子应用程序会从其父 web.config 继承吗？

> ID：778635
> 
> 赞同：9
> 
> 时间：2009-04-22T18:49:33.277
> 
> 标签：asp.net, iis-7, web-config

我从现有应用程序中设置了一个 IIS 应用程序。

父母 web.config 会被继承还是我必须明确设置？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-22T18:51:31.867

是的，它不会明确设置任何内容，而且我不知道有什么方法可以阻止它。

然而，许多配置部分将允许您清除从父文件继承的数据。

例如

```
<appSettings>
   <clear/>
   <add key=...>
</appSettings>

<connectionStrings>
   <clear/>
   <add ... />
</connectionStrings> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T19:11:36.890

您还可以使用`remove`标签来删除您不想要的东西或将所有东西放在一个位置并告诉它不要继承：

```
<remove name="FooBar" />

<location path="." inheritInChildApplications="false">
    <system.web>
        ...
    </system.web>
</location> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T19:09:19.563

子代继承父代的 web.config 文件。

此外，当`web.config`在子文件中创建新文件时，子`web.config`文件的设置会覆盖父`web.config`文件中的相同设置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-10-27T13:59:37.013

您所做的是更改父 .NET 4 应用程序的 web.config 以指示其设置不应流向子级

```
<location path="." inheritInChildApplications="false">
   <system.web>
    ...your system.web stuff goes here
   </system.web>
</location> 
```

有关详细信息，请参阅此处 [http://www.hanselman.com/blog/ChangingASPNETWebconfigInheritanceWhenMixingVersionsOfChildApplications.aspx](http://www.hanselman.com/blog/ChangingASPNETWebconfigInheritanceWhenMixingVersionsOfChildApplications.aspx)

# c# - 使用 Windows 自动启动时，ClickOnce 应用程序不记得设置

> ID：778637
> 
> 赞同：2
> 
> 时间：2009-04-22T18:50:23.633
> 
> 标签：c#, clickonce, settings

我有一个使用 ClickOnce 部署的应用程序，并且可以选择自动从 Windows 启动。但是，当我重新启动 Windows 时，我的应用程序成功启动，但无法找到设置（我只是使用内置的设置功能）。但是，如果我关闭自动启动的应用程序并使用桌面上的图标重新启动它，它就能找到它的设置。

要使用 Windows 自动启动，我使用以下代码：

```
Microsoft.Win32.RegistryKey key = Microsoft.Win32.Registry.CurrentUser.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run", true);
if (runOnStartup == true) 
    key.SetValue("AppName", Application.ExecutablePath.ToString());
else 
    key.DeleteValue("AppName"); 
```

我注意到桌面快捷方式并不直接指向一个 exe，而是一个像这样的 url：

`http://pathToApp.application#AppName.application, Culture=neutral, PublicKeyToken=c8c0a22ba65cb9f4, processorArchitecture=x86`

如何让我的自动启动应用程序以与快捷方式相同的方式工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-26T23:19:52.053

您无法控制 ClickOnce 应用程序的安装位置，并且它会在升级后随时移动，因此我不会将可以更改的设置存储在 app.config 文件中。相反，我将自己的设置文件（通常使用简单的 xml 序列化对象）创建到“已知”文件夹，例如 Environment.SpecialFolder.CommonApplicationData 或 Environment.SpecialFolder.LocalApplicationData

# vb.net - 同时复制多个工作表以保留图表参考

> ID：778643
> 
> 赞同：1
> 
> 时间：2009-04-22T18:51:43.723
> 
> 标签：vb.net, excel, interop, templates, worksheet

我在 Excel 中创建了一个包含两个工作表的模板 - 第一个工作表用于漂亮的图表，另一个工作表用于驱动这些图表的数据。我编写了一个 vb.net 2005 应用程序，它可以将我的所有数据转储到第二个工作表上，并且图表工作表完美更新。

我想在同一个工作簿中多次执行此报告。（因此选项卡将显示“Person1 - Chart”、“Person1 - Data”、“Person2 - Chart”、“Person2 - Data”等）

我的解决方案是，对于要为其运行此报告的每个人，复制图表模板，然后复制数据模板。问题是创建的每个图表模板都指向原始数据工作表。如何设置每个图表工作表指向的工作表？

有没有办法成对复制工作表，保持与自己的关系，而不是与父母的关系？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T19:04:46.937

是的，在使用复印功能之前[选择两张纸。](http://office.microsoft.com/en-gb/excel/HP052024921033.aspx)如果您是手动操作，请不要忘记事后取消选择，否则您将在两者中输入数据。

在 VBA 中：

```
Sheets(Array("Chart template", "Data template")).Select
ActiveWindow.SelectedSheets.Copy After:=Sheets("Data template") 
```

在互操作中：

```
App.ActiveWorkbook.Sheets(New String()
        {"Chart template", "Data template"}).Select()
App.ActiveWindow.SelectedSheets.Copy(After:=
        App.ActiveWorkbook.Sheets("Data template")) 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T18:58:33.553

我没有使用编程的应用程序来完成这项工作，但是如果您将数据带到同一张工作表并使用分页预览设置工作表以避免打印数据表，那么您可以复制并粘贴工作表并结束，您的图表参考将保持有效。

根据您使用的数据量，这可能不是一个理想的解决方案，但它是我处理这个问题的方式。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T19:04:27.720

您可以在复制后修复图表中的引用。

使用 SetSourceData 方法

```
ActiveChart.SetSourceData Source:=Sheets("Sheet1").Range("A3:D7") 
```

# wpf - 列表框超链接--调用 ICommands

> ID：778647
> 
> 赞同：1
> 
> 时间：2009-04-22T18:52:53.910
> 
> 标签：wpf, listbox, hyperlink

这类似于我几天前提出的一个问题。但是，我现在对这个问题有了更好的理解，所以我想再试一次。

我正在创建一个 MVVM 应用程序，该应用程序（除其他外）为用户显示一个带有警报的列表框。这些警报与必须定期执行的各种日常任务相关，并且每个警报都包含一个超链接，单击该超链接将打开执行与警报相关的任务所需的编辑器和记录。

当我尝试将这些超链接绑定到 ICommands 时，我的问题就出现了。应用程序的命令都是 ICommand 对象，并在视图模型中作为命令属性公开。所以通常，绑定到命令就像 Command="Foo" 一样简单，其中 Foo 是视图模型命令属性。

但这不适用于我的超链接。原因如下： ListBox 通过其 ItemsSource 属性绑定到视图模型中称为 Alerts 的集合属性。此集合由 Alert 对象组成，其中包含创建警报所需的信息及其关联的超链接。

但是，由于 ListBox 绑定到 Alerts 集合，它的元素只能访问该集合，而*不能访问视图模型的其余部分！*换句话说，我的超链接无权访问它们需要绑定的命令属性。Command=Foo 根本不起作用，因为 WPF 在 Alerts 集合上找不到 Foo 属性，即使视图模型具有具有该名称的命令属性。

我可以通过一个相当丑陋的 hack 来解决这个问题，其中涉及使用 IValueConverter 来实例化我需要的 ICommands。超链接绑定到它需要的 ICommand 的名称（来自 Alert 对象），并且 IValueConverter 将名称交换为 ICommand 本身的新实例。

我对这个解决方案并不满意。我一直在试图弄清楚如何从视图模型命令属性中创建资源，以便我可以像这样绑定超链接命令：

```
<Hyperlink Command={StaticResource Foo} />My Hyperlink</Hyperlink> 
```

但我不知道如何创建资源。

任何有关如何解决此问题的建议将不胜感激。谢谢你的帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T18:59:03.597

为什么不直接暴露`Command`from the`AlertViewModel`呢？即使它实际上是从父视图模型中获取的：

```
public class MainViewModel
{
    private ICollection<AlertViewModel> _alerts = ...;
    private ICommand _theCommand = ...;

    public ICommand TheCommand
    {
        get { return __theCommand; }
    }

    private void SomeMethod()
    {
        _alerts.Add(new AlertViewModel(this));
    }
}

public class AlertViewModel
{
    private readonly MainViewModel _mainViewModel;

    //ctor omitted

    public ICommand TheCommand
    {
        get { return _mainViewModel.TheCommand; }
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T13:23:51.757

我已经实现了 IValueConverter 方法。[该解决方案记录在 The Code Project 上](http://www.codeproject.com/KB/WPF/MvvmDynamicCommands.aspx)的演示项目中。希望它会帮助其他人。

# .net - 具有 AlternateViews 的 .NET SMTP SendAsync 引发已处理的异常

> ID：778649
> 
> 赞同：1
> 
> 时间：2009-04-22T18:53:30.490
> 
> 标签：.net, vb.net, smtp, sendasync, alternateview

我正在尝试异步发送电子邮件，只要电子邮件没有附加 AlternateView，它就可以正常工作。当有备用视图时，我收到以下错误：

```
Cannot access a disposed object. Object name: 'System.Net.Mail.AlternateView'
System.Net.Mail.SmtpException: Failure sending mail. ---> System.ObjectDisposedException: Cannot access a disposed object.

Object name: 'System.Net.Mail.AlternateView'.
   at System.Net.Mail.AlternateView.get_LinkedResources()
   at System.Net.Mail.MailMessage.SetContent()
   at System.Net.Mail.MailMessage.BeginSend(BaseWriter writer, Boolean sendEnvelope, AsyncCallback callback, Object state)
   at System.Net.Mail.SmtpClient.SendMailCallback(IAsyncResult result) 
```

这是一些示例代码：

```
Dim msg As New System.Net.Mail.MailMessage
msg.From = New System.Net.Mail.MailAddress("me@example.com", "My Name")
msg.Subject = "email subject goes here"

'add the message bodies to the mail message
Dim hAV As System.Net.Mail.AlternateView = System.Net.Mail.AlternateView.CreateAlternateViewFromString(textBody.ToString, Nothing, "text/plain")
hAV.TransferEncoding = Net.Mime.TransferEncoding.QuotedPrintable
msg.AlternateViews.Add(hAV)

Dim tAV As System.Net.Mail.AlternateView = System.Net.Mail.AlternateView.CreateAlternateViewFromString(htmlBody.ToString, Nothing, "text/html")
tAV.TransferEncoding = Net.Mime.TransferEncoding.QuotedPrintable
msg.AlternateViews.Add(tAV)

Dim userState As Object = msg
Dim smtp As New System.Net.Mail.SmtpClient("emailServer")

'wire up the event for when the Async send is completed
 AddHandler smtp.SendCompleted, AddressOf SmtpClient_OnCompleted

 Try
     smtp.SendAsync(msg, userState)
 Catch '.... perform exception handling, etc...
 End Try 
```

和回调......

```
 Public Sub SmtpClient_OnCompleted(ByVal sender As Object, ByVal e As AsyncCompletedEventArgs)
    If e.Cancelled Then
      'Log the cancelled error
    End If
    If Not IsNothing(e.Error) Then
        'Log a real error....
        ' this is where the error is getting picked up
    End If

    'dispose the message
    Dim msg As System.Net.Mail.MailMessage = DirectCast(e.UserState, System.Net.Mail.MailMessage)
    msg.Dispose()

End Sub 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-23T23:33:24.243

这不起作用的原因是因为您的 OnCompleted 处理程序在 SendAsync() 方法完成时被调用，但这似乎是在 SmtpClient 完成通过网络物理发送电子邮件之前（虽然这只会发生在网络传递中，文件传递本质上与 SendAsync()) 同步。

这几乎看起来像是 SmtpClient 中的一个错误，因为 OnCompleted 应该只在真正发送消息时才被调用。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-25T02:56:06.310

我有一个非常相似的问题。相同的错误消息，但代码结构略有不同。就我而言，我正在处理 main 函数中的 mailmessage 对象。到 OnCompleted 事件运行时，对象已经消失了。

在 SendAsync 之后查看您的代码，看看您是否正在释放 mailmessage 对象。例如，如果您在 using 语句中创建它，那么它将在异步事件运行之前被释放。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-07-27T06:56:22.787

如果你想在你的回调中访问它们，你应该把你的 dims 放在类级别。

```
private msg As System.Net.Mail.MailMessage
private hAV As System.Net.Mail.AlternateView 

private sub yoursub
  msg = new System.Net.Mail.MailMessage(..
  hAV = new ...
end sub 
```

我的猜测是 AlternateViews.Add 只是添加了 hAV 的引用，msg 对象需要处置，而 hAV 由 GC 自动处置。

干杯

# python - 如何使 GNOME 弹出通知居中？

> ID：778660
> 
> 赞同：4
> 
> 时间：2009-04-22T18:56:05.803
> 
> 标签：python, user-interface, gtk, pynotify

要在屏幕上的 (200,400) 处显示 GNOME 弹出通知（使用 Python）：

```
import pynotify

n = pynotify.Notification("This is my title", "This is my description")
n.set_hint('x', 200)
n.set_hint('y', 400)
n.show() 
```

我是个gtk菜鸟。如何使此通知显示在屏幕中央或屏幕底部中心？

也许我的问题应该是“什么 Python 片段让我获得了 Linux 屏幕尺寸？”，我将根据需要将它们插入 set_hint() 中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T23:29:26.647

由于您使用的是 GNOME，因此这是获取屏幕分辨率的 GTK 方法

```
import gtk.gdk
import pynotify

n = pynotify.Notification("This is my title", "This is my description")
n.set_hint('x', gtk.gdk.screen_width()/2.)
n.set_hint('y', gtk.gdk.screen_height()/2.)
n.show() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T19:43:02.650

有点破解，但这有效：

```
from Tkinter import *
r = Tk()
r.withdraw()
width, height = r.winfo_screenwidth(), r.winfo_screenheight() 
```

另一种选择是：

```
from commands import getstatusoutput
status, output = getstatusoutput("xwininfo -root")
width = re.compile(r"Width: (\d+)").findall(output)[0]
height = re.compile(r"Height: (\d+)").findall(output)[0] 
```

* * *

## 回答 #3

> 赞同：-4
> 
> 时间：2009-04-22T19:00:28.617

在窗户上，

```
 from win32api import GetSystemMetrics
      width = GetSystemMetrics (0)
      height = GetSystemMetrics (1)
      print "Screen resolution = %dx%d" % (width, height) 
```

我似乎无法找到它的 linux 版本。

# winapi - 用于 MaskBlt 的光栅运算符

> ID：778666
> 
> 赞同：0
> 
> 时间：2009-04-22T18:58:04.613
> 
> 标签：winapi, bitmap, gdi, mask

我正在尝试使用 GDI MaskBlt 命令绘制具有透明度的图像：http: [//msdn.microsoft.com/en-us/library/dd145047 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/dd145047(VS.85).aspx)

我似乎在文档中找不到任何关于在明显用例中使用什么光栅运算符的内容：一种`MAKEROP4(SRCCOPY, DSTCOPY)`- 在掩码为 1 的地方进行 blitting，在掩码为 0 的地方保持目标不变。 SRCCOPY 是一个有效的 ROP ，但是我应该用什么来代替我的虚构`DSTCOPY`？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T19:51:54.953

MSDN 页面“ [Ternary Raster Operations](http://msdn.microsoft.com/en-us/library/dd145130(VS.85).aspx) ”解释说正确的值是`0x00AA0029`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-23T01:04:13.330

避免使用 MaskBlt 并使用透明 Win32 api。

# moss - 如何更改 MOSS WebApp 的虚拟目录本地路径？

> ID：778668
> 
> 赞同：1
> 
> 时间：2009-04-22T18:58:32.773
> 
> 标签：moss, sharepoint-2007

我有一个 MOSS 网站，它的虚拟目录位于 IIS 中。该 VD 映射到 C: 盘中某个位置的文件夹。

我需要将该文件夹移动到同一位置但在 D: 磁盘中。

如果是普通的网络应用程序没问题，只需更改“本地路径”即可。但因为它是一个 MOSS 网站……我认为这会破坏那个 MOSS 网站。

**关于如何做到这一点的任何提示？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-21T10:47:21.677

[这里](http://www.mattjimison.com/blog/2009/02/26/how-to-change-the-iis-path-for-a-sharepoint-web-application/ "如何更改 SharePoint Web 应用程序的 IIS 路径")展示了如何在更改物理路径后更新 SharePoint Web 应用程序。

这样，您甚至可以将您的中央管理移动到另一个文件夹（就像我一样）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T20:21:04.413

我建议您在管理中心内对 Web 应用程序上的两个数据库进行备份。在新的虚拟目录路径上创建一个新的 Web 应用程序并在那里恢复该应用程序。

您可以在 Create New Web Applicaion 窗口中更改默认虚拟目录路径。

更改 IIs 中的默认虚拟路径以将其指向系统驱动器之外的另一个驱动器也是一个好习惯。

# .net - 将 WSE 示例代码转换为 WCF

> ID：778673
> 
> 赞同：5
> 
> 时间：2009-04-22T18:59:28.353
> 
> 标签：.net, web-services, wcf, wse

我是 WSE 和 WCF 的新手，我正在尝试使用 WCF 使用 Web 服务，但所有示例文档都是针对 VS2005 + WSE 的。此 Web 服务使用 WS-Security 1.0。我已经通过 Visual Studio 添加了一个服务参考，但我不知道如何在 WCF 中执行与以下代码等效的操作：

```
// 1\. Initialize the web service proxy
PartnerAPIWse integrationFramework = new PartnerAPIWse();

// 2\. Set the username/password. This is using the Username token of WS-Security 1.0
UsernameTokenProvider utp = new UsernameTokenProvider("username", "password");
integrationFramework.SetClientCredential<UsernameToken>(utp.GetToken());

// 3\. Declare the policy
Policy policy = new Policy(new UsernameOverTransportAssertion());
integrationFramework.SetPolicy(policy); 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-23T14:25:28.067

在花了一天的时间做了一些实验后，我想出了如何转换这段代码。关键是在 VS2008 正确建立的 WCF 代理上设置绑定。

1.  添加指向 WSDL 的服务引用
2.  打开 App.config / Web.config 并找到 system.serviceModel 部分。将默认soapbinding 上的安全模式更改为TransportWithMessageCredential。这是更改后我的文件的样子：

    ```
     <basicHttpBinding>
            <binding name="SoapBinding" closeTimeout="00:01:00" openTimeout="00:01:00"
                receiveTimeout="00:10:00" sendTimeout="00:10:00" allowCookies="false"
                bypassProxyOnLocal="false" hostNameComparisonMode="StrongWildcard"
                maxBufferSize="65536" maxBufferPoolSize="524288" maxReceivedMessageSize="65536"
                messageEncoding="Text" textEncoding="utf-8" transferMode="Buffered"
                useDefaultWebProxy="true">
                <readerQuotas maxDepth="32" maxStringContentLength="8192" maxArrayLength="16384"
                    maxBytesPerRead="4096" maxNameTableCharCount="16384" />
                <security mode="TransportWithMessageCredential">
                    <transport clientCredentialType="None" proxyCredentialType="None"
                        realm="" />
                    <message clientCredentialType="UserName" algorithmSuite="Default" />
                </security>
            </binding>
        </basicHttpBinding> 
    ```

3.  将上面的示例代码更改为如下所示

    ```
    Dim integrationFramework As New SoapClient()
    integrationFramework.ClientCredentials.UserName.UserName = "username"
    integrationFramework.ClientCredentials.UserName.Password = "password" 
    ```

TransportWithMessageCredential 相当于 WSE 3.0 下的 UsernameOverTransportAssertion 策略

# c# - 如何更改 C# .NET 3.5 中进度条的颜色？

> ID：778678
> 
> 赞同：103
> 
> 时间：2009-04-22T19:02:20.627
> 
> 标签：c#, .net, winforms, .net-3.5

我想在我的进度条上做两件事。

1.  将绿色更改为红色。
2.  删除块并使其成为一种颜色。

关于我想知道如何完成的这两件事的任何信息将不胜感激！

谢谢。

* * *

## 回答 #1

> 赞同：131
> 
> 时间：2012-03-17T20:08:49.337

好的，我花了一段时间阅读所有答案和链接。这是我从他们那里得到的：

**样本结果**

接受的答案会禁用视觉样式，它确实允许您将颜色设置为您想要的任何颜色，但结果看起来很简单：

![在此处输入图像描述](https://i.stack.imgur.com/j5XP8.png)

使用以下方法，您可以得到类似的东西：

![在此处输入图像描述](https://i.stack.imgur.com/4oLLe.png)

**如何**

首先，如果您没有，请包括：`using System.Runtime.InteropServices;`

其次，您可以创建这个新类，也可以将其代码放入现有的`static`非泛型类中：

```
public static class ModifyProgressBarColor
{
    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = false)]
    static extern IntPtr SendMessage(IntPtr hWnd, uint Msg, IntPtr w, IntPtr l);
    public static void SetState(this ProgressBar pBar, int state)
    {
        SendMessage(pBar.Handle, 1040, (IntPtr)state, IntPtr.Zero);
    }
} 
```

现在，要使用它，只需调用：

`progressBar1.SetState(2);`

注意SetState中的第二个参数，1 = normal（绿色）；2 = 错误（红色）；3 = 警告（黄色）。

希望能帮助到你！

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2009-04-22T19:42:06.363

由于以前的答案似乎不适用于视觉样式。您可能需要创建自己的类或扩展进度条：

```
public class NewProgressBar : ProgressBar
{
    public NewProgressBar()
    {
        this.SetStyle(ControlStyles.UserPaint, true);
    }

    protected override void OnPaint(PaintEventArgs e)
    {
        Rectangle rec = e.ClipRectangle;

        rec.Width = (int)(rec.Width * ((double)Value / Maximum)) - 4;
        if(ProgressBarRenderer.IsSupported)
           ProgressBarRenderer.DrawHorizontalBar(e.Graphics, e.ClipRectangle);
        rec.Height = rec.Height - 4;
        e.Graphics.FillRectangle(Brushes.Red, 2, 2, rec.Width, rec.Height);
    }
} 
```

编辑：更新代码以使进度条使用背景的视觉样式

* * *

## 回答 #3

> 赞同：38
> 
> 时间：2011-09-20T19:44:44.607

这是最受欢迎的代码的无闪烁版本，您可以找到它作为此问题的答案。所有这些都归功于那些惊人答案的海报。感谢 Dusty、Chris、Matt 和 Josh！

就像“Fueled”在其中一条评论中的要求一样，我还需要一个表现得更……专业的版本。此代码与之前的代码一样保持样式，但添加了屏幕外图像渲染和图形缓冲（并正确处理图形对象）。

结果：一切正常，没有闪烁。:)

```
public class NewProgressBar : ProgressBar
{
    public NewProgressBar()
    {
        this.SetStyle(ControlStyles.UserPaint, true);
    }

    protected override void OnPaintBackground(PaintEventArgs pevent)
    {
        // None... Helps control the flicker.
    }

    protected override void OnPaint(PaintEventArgs e)
    {
        const int inset = 2; // A single inset value to control teh sizing of the inner rect.

        using (Image offscreenImage = new Bitmap(this.Width, this.Height))
        {
            using (Graphics offscreen = Graphics.FromImage(offscreenImage))
            {
                Rectangle rect = new Rectangle(0, 0, this.Width, this.Height);

                if (ProgressBarRenderer.IsSupported)
                    ProgressBarRenderer.DrawHorizontalBar(offscreen, rect);

                rect.Inflate(new Size(-inset, -inset)); // Deflate inner rect.
                rect.Width = (int)(rect.Width * ((double)this.Value / this.Maximum));
                if (rect.Width == 0) rect.Width = 1; // Can't draw rec with width of 0.

                LinearGradientBrush brush = new LinearGradientBrush(rect, this.BackColor, this.ForeColor, LinearGradientMode.Vertical);
                offscreen.FillRectangle(brush, inset, inset, rect.Width, rect.Height);

                e.Graphics.DrawImage(offscreenImage, 0, 0);
            }
        }
    }
} 
```

* * *

## 回答 #4

> 赞同：30
> 
> 时间：2009-04-22T19:07:53.093

在设计器中，您只需将 ForeColor 属性设置为您想要的任何颜色。在红色的情况下，它有一个预定义的颜色。

要在代码 (C#) 中执行此操作：

```
pgs.ForeColor = Color.Red; 
```

**编辑**：哦，是的，还将样式设置为连续。在代码中，像这样：

```
pgs.Style = System.Windows.Forms.ProgressBarStyle.Continuous; 
```

**另一个编辑：**您还需要删除`Application.EnableVisualStyles()`从您的`Program.cs`（或类似的）读取的行。如果您因为希望应用程序的其余部分具有视觉样式而无法执行此操作，那么我建议您自己绘制控件或继续使用 WPF，因为使用 WPF 很容易做到这一点。[您可以找到有关所有者在 codeplex](http://www.codeproject.com/KB/cpp/VistaProgressBar.aspx)上绘制进度条的教程

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2011-04-11T14:18:19.703

使用 Matt Blaine 和 Chris Persichetti 的答案，我创建了一个进度条，它看起来更好一些，同时允许无限的颜色选择（基本上我在 Matt 的解决方案中更改了一行）：

### ProgressBarEx：

```
using System;
using System.Windows.Forms;
using System.Drawing;
using System.Drawing.Drawing2D;

namespace QuantumConcepts.Common.Forms.UI.Controls
{
    public class ProgressBarEx : ProgressBar
    {
        public ProgressBarEx()
        {
            this.SetStyle(ControlStyles.UserPaint, true);
        }

        protected override void OnPaint(PaintEventArgs e)
        {
            LinearGradientBrush brush = null;
            Rectangle rec = new Rectangle(0, 0, this.Width, this.Height);
            double scaleFactor = (((double)Value - (double)Minimum) / ((double)Maximum - (double)Minimum));

            if (ProgressBarRenderer.IsSupported)
                ProgressBarRenderer.DrawHorizontalBar(e.Graphics, rec);

            rec.Width = (int)((rec.Width * scaleFactor) - 4);
            rec.Height -= 4;
            brush = new LinearGradientBrush(rec, this.ForeColor, this.BackColor, LinearGradientMode.Vertical);
            e.Graphics.FillRectangle(brush, 2, 2, rec.Width, rec.Height);
        }
    }
} 
```

### 用法：

```
progressBar.ForeColor = Color.FromArgb(255, 0, 0);
progressBar.BackColor = Color.FromArgb(150, 0, 0); 
```

### 结果

![你可以使用任何你喜欢的渐变！](https://i.stack.imgur.com/3nfhg.png)

### 下载

[https://skydrive.live.com/?cid=0EDE5D21BDC5F270&id=EDE5D21BDC5F270%21160&sc=documents#](https://skydrive.live.com/?cid=0EDE5D21BDC5F270&id=EDE5D21BDC5F270%21160&sc=documents#)

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2010-03-23T06:41:35.697

修改dustyburwell的答案。（我没有足够的代表自己编辑它。）就像他的回答一样，它可以在启用“视觉样式”的情况下工作。您可以在任何表单的设计视图中设置进度条的 ForeColor 属性。

```
using System;
using System.Windows.Forms;
using System.Drawing;

public class ProgressBarEx : ProgressBar
{
    private SolidBrush brush = null;

    public ProgressBarEx()
    {
        this.SetStyle(ControlStyles.UserPaint, true);
    }

    protected override void OnPaint(PaintEventArgs e)
    {
        if (brush == null || brush.Color != this.ForeColor)
            brush = new SolidBrush(this.ForeColor);

        Rectangle rec = new Rectangle(0, 0, this.Width, this.Height);
        if (ProgressBarRenderer.IsSupported)
            ProgressBarRenderer.DrawHorizontalBar(e.Graphics, rec);
        rec.Width = (int)(rec.Width * ((double)Value / Maximum)) - 4;
        rec.Height = rec.Height - 4;
        e.Graphics.FillRectangle(brush, 2, 2, rec.Width, rec.Height);
    }
} 
```

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2010-05-31T14:22:23.537

我只是把它放到一个静态类中。

```
 const int WM_USER = 0x400;
  const int PBM_SETSTATE = WM_USER + 16;
  const int PBM_GETSTATE = WM_USER + 17;

  [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = false)]
  static extern IntPtr SendMessage(IntPtr hWnd, uint Msg, IntPtr wParam, IntPtr lParam);

  public enum ProgressBarStateEnum : int
  {
   Normal = 1,
   Error = 2,
   Paused = 3,
  }

  public static ProgressBarStateEnum GetState(this ProgressBar pBar)
  {
   return (ProgressBarStateEnum)(int)SendMessage(pBar.Handle, PBM_GETSTATE, IntPtr.Zero, IntPtr.Zero);
  }

  public static void SetState(this ProgressBar pBar, ProgressBarStateEnum state)
  {
   SendMessage(pBar.Handle, PBM_SETSTATE, (IntPtr)state, IntPtr.Zero);
  } 
```

希望能帮助到你，

马克

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-22T19:11:53.770

通常，进度条要么是主题，要么是尊重用户的颜色偏好。因此，要更改颜色，您需要关闭视觉样式并`ForeColor`自己设置或绘制控件。

至于连续样式而不是块，您可以设置`Style`属性：

```
pBar.Style = ProgressBarStyle.Continuous; 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-12-18T08:36:16.197

尝试使用消息 PBM_SETBARCOLOR，这应该可以使用 SendMessage

有关示例，请参见[http://www.vbforums.com/showthread.php?t=248721 。](http://www.vbforums.com/showthread.php?t=248721)

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-04-22T19:09:58.157

**编辑**

根据您使用的 XP 主题的声音，它具有基于绿色块的 prog-bar。尝试将您的 UI 样式翻转为 Windows 经典并再次测试，但您可能需要实现自己的 OnPaint 事件以使其在所有 UI 样式中执行您想要的操作

或者正如其他人指出的那样，为您的应用程序禁用 VisualStyles。

**原来的**

据我所知，进度条的呈现与您选择的 Windows 主题样式（win2K、xp、vista）内联发生

您可以通过设置属性来更改颜色

```
ProgressBar.ForeColor 
```

我不确定你可以做更多但是......

**做一些谷歌搜索**

这里有一篇来自 MS KB 的关于创建“平滑”进度条的文章

[http://support.microsoft.com/kb/323116](http://support.microsoft.com/kb/323116)

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2011-01-28T15:05:49.093

以防万一有人寻找另一个选项....您可以扩展一个面板，将其用作背景（白色或其他），在其中添加另一个面板作为前景（移动条）。然后您可以完全控制更改颜色等。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2014-10-27T02:44:27.337

所有这些方法都对我不起作用，但这种方法允许您将其更改为颜色字符串。

请注意，我在 StackOverflow 上的其他地方找到了这段代码，并对其进行了一些更改。从那以后，我忘记了在哪里找到此代码，因此我无法链接它，对此我感到非常抱歉。

但无论如何，我希望这段代码对它确实对我有帮助的人有所帮助。

```
private void ProgressBar_MouseDown(object sender, MouseButtonEventArgs e)
    {
        var converter = new System.Windows.Media.BrushConverter();
        var brush = (Brush)converter.ConvertFromString("#FFB6D301");
        ProgressBar.Foreground = brush;
    } 
```

使用名称“ProgressBar”的地方替换为您自己的进度条名称。您也可以使用其他参数触发此事件，只需确保它在某处的括号内。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2015-05-21T16:51:58.757

变化`Color`和`Value`（即时变化）

放在`using System.Runtime.InteropServices;`最上面...

打电话给`ColorBar.SetState(progressBar1, ColorBar.Color.Yellow, myValue);`

我注意到，如果您更改条形的值（它有多大），那么如果它的颜色不是默认的绿色，它就不会改变。我使用了 user1032613 的代码并添加了一个 Value 选项。

```
public static class ColorBar
{
    [DllImport("user32.dll", CharSet = CharSet.Auto, SetLastError = false)]
    static extern IntPtr SendMessage(IntPtr hWnd, uint Msg, IntPtr w, IntPtr l);
    public enum Color { None, Green, Red, Yellow }

    public static void SetState(this ProgressBar pBar, Color newColor, int newValue)
    {
        if (pBar.Value == pBar.Minimum)  // If it has not been painted yet, paint the whole thing using defualt color...
        {                                // Max move is instant and this keeps the initial move from going out slowly 
            pBar.Value = pBar.Maximum;   // in wrong color on first painting
            SendMessage(pBar.Handle, 1040, (IntPtr)(int)Color.Green, IntPtr.Zero);
        }
        pBar.Value = newValue;
        SendMessage(pBar.Handle, 1040, (IntPtr)(int)Color.Green, IntPtr.Zero);     // run it out to the correct spot in default
        SendMessage(pBar.Handle, 1040, (IntPtr)(int)newColor, IntPtr.Zero);        // now turn it the correct color
    }

} 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-09-26T00:12:17.243

只需在 Visual Basic 解决方案资源管理器（您的 vb 文件所在的位置）中右键单击您的项目，然后从菜单中选择属性。在弹出的窗口中取消选择“启用 XP 视觉样式”，现在当您设置前景色时，它现在应该可以工作了。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-10-10T20:44:00.460

垂直条 UP For Down 红色：

```
using System;
using System.Windows.Forms;
using System.Drawing;

public class VerticalProgressBar : ProgressBar
{

    protected override CreateParams CreateParams
    {
        get
        {
            CreateParams cp = base.CreateParams;
            cp.Style |= 0x04;
            return cp;

        }
    }
    private SolidBrush brush = null;

    public VerticalProgressBar()
    {
        this.SetStyle(ControlStyles.UserPaint, true);
    }

    protected override void OnPaint(PaintEventArgs e)
    {
        if (brush == null || brush.Color != this.ForeColor)
            brush = new SolidBrush(this.ForeColor);

        Rectangle rec = new Rectangle(0, 0, this.Width, this.Height);
        if (ProgressBarRenderer.IsSupported)
        ProgressBarRenderer.DrawVerticalBar(e.Graphics, rec);
        rec.Height = (int)(rec.Height * ((double)Value / Maximum)) - 4;
        rec.Width = rec.Width - 4;
        e.Graphics.FillRectangle(brush, 2, 2, rec.Width, rec.Height);

    } 
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2013-06-05T03:03:49.957

Јοеу: Quote: 通常进度条要么是主题要么是尊重用户的颜色偏好。因此，要更改颜色，您需要关闭视觉样式并`ForeColor`自己设置或绘制控件。

至于连续样式而不是块，您可以设置`Style`属性：

```
pBar.Style = ProgressBarStyle.Continuous; 
```

* * *

ProgressBarStyle.Continuous 与 Blocks 在启用 VisualStyles 的情况下毫无用处......

块只能在禁用视觉样式的情况下工作......这使得所有这些都成为一个有争议的点（关于自定义进度颜色）禁用视觉样式......进度条应该根据前景色着色。

我结合使用了 William Daniel 的答案（启用了视觉样式，因此 ForeColor 不会只是没有样式的平坦）和 Barry 的答案（进度条上的自定义文本）来自：[如何在 ProgressBar 上放置文本？](https://stackoverflow.com/questions/3529928/how-do-i-put-text-on-progressbar)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2013-10-28T16:26:45.207

尊重 WXP 视觉样式答案的 VB.Net 彩色进度条是......

我从 2012 年 3 月 17 日“user1032613”的答案开始。请注意，这现在是一个模块，而不是一个类。从那里我转换了代码，但还需要更多。特别是转换后的代码显示了一个 DirectCast 函数，用于将“状态”整数转换为无效的 IntPtr 类型。

```
Imports System.Runtime.InteropServices

Public Module ModifyProgressBarColor

    Private Declare Function SendMessage Lib "User32" Alias "SendMessageA" (ByVal hWnd As Long, ByVal wMsg As Long, ByVal wParam As Long, lParam As Long) As Long

    <DllImport("user32.dll", CharSet:=CharSet.Auto, SetLastError:=False)> _
    Private Function SendMessage(hWnd As IntPtr, Msg As UInteger, w As IntPtr, l As IntPtr) As IntPtr
    End Function

    <System.Runtime.CompilerServices.Extension()> _
    Public Sub SetState(pBar As ProgressBar, state As Integer)

        '-- Convert state as integer to type IntPtr
        Dim s As IntPtr
        Dim y As Integer = state
        s = IntPtr.op_Explicit(y)

        '-- Modify bar color
        SendMessage(pBar.Handle, 1040, s, IntPtr.Zero)

    End Sub

End Module 
```

再次在 using 代码中用这一行调用它：

```
Call ModifyProgressBarColor.SetState(prb, 2) 
```

顺便说一句 - 我尝试了其他颜色 - 0、4、5 - 它们都显示为绿色。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2016-12-03T08:09:02.260

我知道它太老了，现在无法回答.. 但是，为了纠正不显示零值进度条的问题，对@Daniel 的回答进行[了一个小调整。](https://stackoverflow.com/users/193811/william-daniel "丹尼尔")仅当发现内部矩形的宽度不为零时才绘制进度。

感谢所有的贡献者。

```
 public class ProgressBarEx : ProgressBar
        {
            public ProgressBarEx()
            {
                this.SetStyle(ControlStyles.UserPaint, true);
            }

            protected override void OnPaintBackground(PaintEventArgs pevent){}
                // None... Helps control the flicker.                

            protected override void OnPaint(PaintEventArgs e)
            {
                const int inset = 2; // A single inset value to control teh sizing of the inner rect.

                using (Image offscreenImage = new Bitmap(this.Width, this.Height))
                {
                    using (Graphics offscreen = Graphics.FromImage(offscreenImage))
                    {
                        Rectangle rect = new Rectangle(0, 0, this.Width, this.Height);

                        if (ProgressBarRenderer.IsSupported)
                            ProgressBarRenderer.DrawHorizontalBar(offscreen, rect);

                        rect.Inflate(new Size(-inset, -inset)); // Deflate inner rect.
                        rect.Width = (int)(rect.Width * ((double)this.Value / this.Maximum));

                        if (rect.Width != 0)
                        {
                            LinearGradientBrush brush = new LinearGradientBrush(rect, this.ForeColor, this.BackColor, LinearGradientMode.Vertical);
                            offscreen.FillRectangle(brush, inset, inset, rect.Width, rect.Height);
                            e.Graphics.DrawImage(offscreenImage, 0, 0);
                            offscreenImage.Dispose();
                        }
                    }
                }
            }
        } 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2019-04-10T14:26:26.253

我认为最简单的解决方案只是一个快速修复，但您可以从 Program.cs 中删除、注释 Application.EnableVisualStyles()，或者您可以为包含 Main 函数的部分命名。之后，您可以通过 progressBar.ForeColor = Color.TheColorYouDesire; 自由更改进度条的颜色。

```
static void Main()
        {
            //Application.EnableVisualStyles();
            Application.SetCompatibleTextRenderingDefault(false);
            Application.Run(new Form1());
         } 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2018-07-15T10:54:29.947

我发现这可以通过在进度条内绘制一个矩形来完成，并根据进度的当前值设置其宽度。我还添加了对从右到左进度的支持。这样您就不需要使用图像，并且由于 Rectnalge.Inflate 不被称为绘制的矩形更小。

```
public partial class CFProgressBar : ProgressBar
{
    public CFProgressBar()
    {
        InitializeComponent();
        this.SetStyle(ControlStyles.UserPaint, true);
    }

    protected override void OnPaintBackground(PaintEventArgs pevent) { }

    protected override void OnPaint(PaintEventArgs e)
    {
        double scaleFactor = (((double)Value - (double)Minimum) / ((double)Maximum - (double)Minimum));
        int currentWidth = (int)((double)Width * scaleFactor);
        Rectangle rect;
        if (this.RightToLeftLayout)
        {
            int currentX = Width - currentWidth;
            rect = new Rectangle(currentX, 0, this.Width, this.Height);
        }
        else
            rect = new Rectangle(0, 0, currentWidth, this.Height);

        if (rect.Width != 0)
        {
            SolidBrush sBrush = new SolidBrush(ForeColor);
            e.Graphics.FillRectangle(sBrush, rect);
        }
    }
} 
```

* * *

## 回答 #21

> 赞同：-5
> 
> 时间：2009-04-22T19:10:58.593

编辑：在两分钟内，我启动了 vs 并检查了我被击败的语法，得到了更好的响应。我喜欢这个网站。

```
 progressBar1 = new ProgressBar();
        progressBar1.ForeColor = Color.Red; 
```

# asp.net - ReportViewer 控件 - 高度问题

> ID：778688
> 
> 赞同：30
> 
> 时间：2009-04-22T19:04:46.890
> 
> 标签：asp.net, reporting-services, reportviewer

在我的 asp.net 应用程序中，我试图打开一个特定的报告。我将 ReportViewer 控件设置为宽度为 100%，高度为 100%。现在我希望这意味着该报告将占据整个页面。令我惊讶的是，事实并非如此。在 IE7 中，虽然它占据了页面的整个宽度，但它只占据了高度的一小部分。在 Firefox 中，宽度和高度都搞砸了。我让浏览器打开一个几乎占据整个屏幕的新页面。有任何想法吗？

谢谢！

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2010-07-09T03:26:31.350

这是我固定的方式，看看

```
<div style="Width:auto;"> 
<form id="form1" runat="server" style="width:100%; height:100%;">
    <asp:ScriptManager ID="ScriptManager1" runat="server">
    </asp:ScriptManager>
    <rsweb:ReportViewer ID="rptViewer" runat="server" Width="100%" Height="100%" AsyncRendering="False" SizeToReportContent="True">
    </rsweb:ReportViewer>
</form></div> 
```

神奇的是**AsyncRendering="False" SizeToReportContent="True"**其余的是基本的 HTML。报告将按照设计的方式显示。

可能有一些额外的代码，但看看它是否适合你。

希望能帮助到你

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-01-21T14:24:20.013

这是我修复它的方式，使用 javascript 动态设置高度，它适用于 IE 和 Firefox。也适用于大于最大窗口大小的报告。

```
<rsweb:ReportViewer ID="ReportViewer1" runat="server" Width="100%" ShowBackButton="True" ProcessingMode="Remote" />

<script language="javascript" type="text/javascript">
    ResizeReport();

    function ResizeReport() {
        var viewer = document.getElementById("<%= ReportViewer1.ClientID %>");
        var htmlheight = document.documentElement.clientHeight;
        viewer.style.height = (htmlheight - 30) + "px";
    }

    window.onresize = function resize() { ResizeReport(); }
</script> 
```

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2013-09-13T15:47:08.483

I had the same problem with ReportViewer 11.0 and what did the trick for me was to set

```
Height="100%" 
SizeToReportContent="true"

while keeping 

AsyncRendering="true" 
```

Eg

```
<rsweb:ReportViewer ID="reportControl" runat="server" Width="750" Height="100%" AsyncRendering="true" SizeToReportContent="true"> 
```

This actually generated a table with height="100%" for the control.

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-22T19:10:42.400

给它一个足以满足整个报告高度的静态高度。据我所知，100% 不会起作用，因为 ReportViewer 控件本质上是由一个大`div`标签包裹的。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2012-03-18T18:54:12.943

我知道这是一个古老的问题，但我最近仍然在努力解决这个问题。似乎以下内容在所有现代浏览器中运行良好（仅测试过 IE8/9、Firefox 和 Chrome）。对我来说最重要的是 doctype 和 html 元素高度。

```
<!DOCTYPE html>
<html>
<head>
    <style type="text/css">
        html, body, form { width: 100%; height: 100%; margin: 0; padding: 0 }
    </style>
</head>
<body>
  <form runat="server">
    <asp:scriptmanager runat="server" />
    <rsweb:ReportViewer ID="ReportViewerControl" Width="100%" Height="100%" runat="server" />
  </form>
</body>
</html> 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-03-19T18:05:43.280

Dan，这就是我们最终用一点 jQuery 魔法做的事情。

所有报告都使用相同的 Report.Master 作为母版页：

```
<%@ Master Language="VB" AutoEventWireup="false" CodeBehind="Report.master.vb" Inherits=".Report" %>
<html xmlns="http://www.w3.org/1999/xhtml">
<head id="Head1" runat="server">
     <style type="text/css">
        html, body
        {
            margin: 0;
            padding: 0;            
            border: none;
            background-color: #FFFFFF;     
            overflow: hidden;       
        }
    </style>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            setWindowSize();
        });

        $(window).resize(function () {
            setWindowSize();
        });

        function setWindowSize() {
            // http://www.howtocreate.co.uk/tutorials/javascript/browserwindow
            var myWidth = 0, myHeight = 0;
            if (typeof (window.innerWidth) == 'number') {
                //Non-IE
                myWidth = window.innerWidth;
                myHeight = window.innerHeight;
            } else if (document.documentElement && (document.documentElement.clientWidth || document.documentElement.clientHeight)) {
                //IE 6+ in 'standards compliant mode'
                myWidth = document.documentElement.clientWidth;
                myHeight = document.documentElement.clientHeight;
            } else if (document.body && (document.body.clientWidth || document.body.clientHeight)) {
                //IE 4 compatible
                myWidth = document.body.clientWidth;
                myHeight = document.body.clientHeight;
            }

            var r = $('div[id*="_report_"]:first');
            r.width(myWidth);
            r.height(myHeight - 32);
        }

    </script>
</head>
<body>
    <form id="form1" runat="server">    
        <asp:ScriptManager ID="rptScriptManager1" runat="server" />
        <asp:ContentPlaceHolder ID="report" runat="server"/>                
    </form>
</body>
</html> 
```

然后，每个报告页面都包含 ReportViewer 及其属性。

```
<%@ Page Title="This Cool Report" MasterPageFile="~/masterpages/Report.Master" Language="vb" AutoEventWireup="false" CodeBehind="viewmycoolreport.aspx.vb" Inherits=".viewmycoolreport" %>
<%@ Register Assembly="Microsoft.ReportViewer.WebForms, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" Namespace="Microsoft.Reporting.WebForms" TagPrefix="rsweb" %>

<asp:Content ID="reportContent" ContentPlaceHolderID="report" runat="server">    
    <rsweb:ReportViewer ID="rptCoolReport" runat="server" Width="100%" ProcessingMode="Remote" SizeToReportContent="True" />
</asp:Content> 
```

现在，当报表加载时，ReportViewer 控件最终会在准备好和调整窗口大小时将自身调整为内容窗口的大小。jQuery 选择器使用包含“_report_”的 ID 获取第一个 div（因为 ReportViewer 控件使用**ctl_report_<report_id>**的客户端 ID 呈现）。由于 ReportViewer 控件中的标题（用于分页、导出等），高度最终必须小于 32 像素。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-22T19:09:44.307

这是 XHTML 1.1 标准的问题。将您的页面文档类型更改为过渡，以获得 100% 的高度工作：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"/> 
```

或者，如果您仍然挣扎，请将其完全移除。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2014-07-23T09:53:43.940

**以下选项将修复 ASP.NET 页面中的 SSRS 报告加载问题。**

还有一个名为**ZoomMode="PageWidth"**的奇妙属性 ，可以将您的报告修复为整页。您也可以使用**ZoomMode="FullPage"**或**ZoomMode="Percent"**。所有这些属性都将解决您在 ASP.NET 页面中的页面加载问题。

```
<rsweb:ReportViewer ID="ReportViewer1" runat="server" Height="100%" Width="100%" ZoomMode="Percent"></rsweb:ReportViewer> 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2012-10-04T17:29:07.267

这段代码有点长，但它可以在我测试过的所有浏览器中使用和不使用异步渲染。最好的部分是在非异步模式下，它扩展到报告内容的大小。在异步模式下，它扩展到页面的大小（减去从顶部的偏移量）。我应该指出，这是特定于 VS2010 版本的 reportviewer。

```
<script type="text/javascript">
function ResizeReport(reportId){
        var rep = document.getElementById(reportId);
        var j = 0;

        for (var i = 0; i < rep.childNodes.length; i++) {
            var child = rep.childNodes[i];
            if (child.nodeName == "DIV") {
                j++;
                if (j == 2) {
                    child.firstChild.style.overflow = "";
                    while (child.nodeName == "DIV") {
                        child = child.firstChild;
                    }
                    child.style.width = "1px";
                    rep.style.width = (child.clientWidth) + "px";
                    rep.style.height = "";
                    return;
                }
            }
        }

        if (rep.style.height != '400px') // default value //
            return;
        ResizeReportHeight(reportId);
        window.onresize = function () { ResizeReportHeight(reportId); }
    }

    // Used to resize an async-report. Hand edit as needed.
    function ResizeReportHeight(reportId, offsetFromBot) {
        var rep = document.getElementById(reportId);
        var iFrame = rep.getElementsByTagName('iframe')[0];
        var htmlHeight = document.documentElement.clientHeight;
        var offTop = 0;
        var obj = iFrame;
        while (obj) {
            offTop += obj.offsetTop;
            obj = obj.offsetParent;
        }
        var newHeight = (htmlHeight - offTop)
        if (offsetFromBot)
            newHeight -= offsetFromBot;
        if (newHeight < 1)
            newHeight = 1;
        rep.style.height = "";
        iFrame.style.height =  newHeight + "px";
    }
</script>
<script type="text/javascript">
    window.onload = function () { ResizeReport("<%= reportviewer1.ClientID %>"); }
</script>
<rsweb:reportviewer ID="reportviewer1" runat="server" ProcessingMode="Remote" Width="100%" /> 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-02-28T04:38:37.390

我最近坐下来，`ReportViewer`在仍然允许的情况下，将控件扩展到报告内容的高度`.AsyncRendering = true`。这是我所做的，它需要 jQuery，并且仅使用 Report Viewer 2008 (9.0.0.0) 进行了测试。

```
<script type="text/javascript">

    $(function() {

        $('#<%= uxReportViewer.ClientID %> > iframe:eq(0)').bind('load', function() {
            ReportViewerResize(this);
        });

    });

    function ReportViewerResize(frame) {
        var container = $('#<%= uxReportViewer.ClientID %>');
        try {
            var reportFrame = $(frame).contents().find('html')[0].document.frames["report"].document;
            var reportHeight = $('div#oReportDiv > table > tbody > tr > td#oReportCell', reportFrame).height();
            $(container).css({ height: '' + (reportHeight + 10) + 'px' });
        } catch (e) { }
    }

</script> 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2013-11-22T19:13:05.467

这就是我解决身高问题的方法......没有我希望的那么优雅，但它有效。

```
function ResizeReport() {
    var htmlheight = document.documentElement.clientHeight - 110;
    var reportViewer = $('div[id^=VisibleReportContent<%= this.bddr_report.ClientID %>]').parent();
    reportViewer.css('height',htmlheight+'px');
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-11-20T12:15:37.030

至于我所经历的，如果 SizeToReportContent 设置为 false，则报表查看器控件默认以 400px 的高度呈现。
如果你想要一个动态的高度，你需要在报表查看器中添加一个 css 类和以下 css：

```
#reportViewerContainer > span
{
    display:block;
    height:100% !important;
}

.reportViewer
{
    height:100% !important;
} 
```

“reportViewerContainer”是报表查看器的父容器（div、body 等）。查看器呈现为高度为 0 的跨度，内部是所有内容。如果你改变它，一切都应该正常。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2015-07-16T15:35:24.797

这是修复它的解决方案，使用 javascript 动态设置高度，它适用于 IE 和 Firefox。

* * *

```
<script type="text/javascript">
var ReportViewerForMvc = ReportViewerForMvc || (new function () {

    var _iframeId = {};

    var resizeIframe = function (msg) {
        var height = 360;//here you specify the height if you want to put in 
                        // percent specify value in string like "100%"
        var width = 1255;// follow above

        $(ReportViewerForMvc.getIframeId()).height(height);
        $(ReportViewerForMvc.getIframeId()).width(width);
    }

    var addEvent = function (element, eventName, eventHandler) {
        if (element.addEventListener) {
            element.addEventListener(eventName, eventHandler);
        } else if (element.attachEvent) {
            element.attachEvent('on' + eventName, eventHandler);
        }
    }

    this.setIframeId = function (value) {
        _iframeId = '#' + value;
    };

    this.getIframeId = function () {
        return _iframeId;
    };

    this.setAutoSize = function () {
        addEvent(window, 'message', resizeIframe);
    }

}());

ReportViewerForMvc.setAutoSize();
</script>
```

*   请不要更改“.aspx”的以下代码

```
<asp:ScriptManager ID="ScriptManager1" runat="server">
 <Scripts>
  <asp:ScriptReference  Assembly="ReportViewerForMvc"          Name="ReportViewerForMvc.Scripts.PostMessage.js" />
   </Scripts>
</asp:ScriptManager>
```

在这里，我们将**ReportViewerForMvc.Scripts.PostMessage.js**显式替换为我们自己的**resizeIframe**，我们在其中指定*宽度*

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2021-02-05T02:13:14.230

对我来说最简单的方法是将报告控件的宽度和高度属性设置为 100%，**诀窍是**用 div 包围控件，并为该包装器提供高度设置为 100vh 的样式！

```
<div id="ssrsReportViewerWrapper" style="width: 100%; height: 100vh;">

        <rsweb:ReportViewer 
            ID="ssrsReportViewer" 
            runat="server" 
            Width="100%"
            Height="100%"
            EnableViewState="true"
            SizeToReportContent="false"
            ZoomMode="Percent" 
            ZoomPercent="100"
            ProcessingMode="Remote" 
            ShowExportControls="true" 
            ShowParameterPrompts="true" >

          <ServerReport ReportPath="" ReportServerUrl=""  />

        </rsweb:ReportViewer>

    </div> 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2021-12-23T17:47:12.943

这是解决此问题的另一种方法，仅使用 CSS 并在需要时在 ReportViewer 控件上方留出额外空间：

在 aspx 文档中，我做了：

```
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>Your page title</title>
    <style type="text/css">
        [id^=reportViewer1][role=document] {
            height: calc(100vh - 50px) !important;
        }
    </style>
</head>
<body style="height: 100vh; margin: 0;"> 
```

**这里的魔力是强制计算控件的文档**部分的高度。如果您在原始控件之上没有任何东西，则应该使用 50px。将主体设置为 100vh（查看者高度的 100%）也有助于确保它适合整个浏览器的文档区域而不显示滚动条。

在 ReportViewer 控件上，我执行以下操作：

```
<rsweb:ReportViewer ID="reportViewer1" runat="server" Width="100%" Height="100%" 
Font-Names="Verdana" Font-Size="8pt" AsyncRendering="True" SizeToReportContent="False">
</rsweb:ReportViewer> 
```

需要注意的是，CSS **calc**可能不适用于旧版浏览器。在这里，它在当前的 Chrome 和 Edge 浏览器上表现良好。

# assembly - 使用 esp 下面的堆栈是否安全？

> ID：778690
> 
> 赞同：4
> 
> 时间：2009-04-22T19:05:56.887
> 
> 标签：assembly, intel

我有一个从 ac 程序调用的简单汇编函数，我必须使用`FIDIV`需要内存操作数的指令 ()。

将值移动到`[esp - 2]`并在下一条指令中使用它是否安全，或者以这种方式使用堆栈永远不安全？

我知道有很多解决方法，我真的不再需要这个了，所以现在只是好奇。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-22T19:19:13.907

每当线程上的任何操作需要再次触及堆栈时，使用这样的偏移量肯定会暴露数据损坏。这可能在中断、APC、上下文切换、异常等期间发生。您要做的是实际在堆栈上保留空间并保存指向它的指针。

```
sub esp, 4        ; Allways move it 4 byte increments. x64 may need 8 bytes
mov eax, esp      ; EAX points to your 4 byte buffer
add esp, 4        ; Restore allocation. 
```

当然如果你只需要几个字节，push指令会快很多

```
push eax
mov  eax, esp     ; EAX points to a buffer properly alligned to system 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T19:09:04.573

这是不安全的 - 堆栈的一部分可能用于上下文切换、中断以及您的线程几乎或根本不知道或无法控制的其他事情。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T19:21:42.280

有点。只要您不调用另一个函数，或者（在 Unix 上）调用信号，它就是安全的。不过，它会非常容易坏，所以我不会这样做。可以先从 esp 中减去，然后使用该空间。

您*不必*担心中断或上下文切换；这些发生在内核堆栈上。如果您可以通过更改堆栈来搞砸这些，那么使内核崩溃是微不足道的。

# asp.net-mvc - 在数据库级别实施信誉系统？

> ID：778705
> 
> 赞同：1
> 
> 时间：2009-04-22T19:10:37.347
> 
> 标签：asp.net-mvc, database, entity-framework

我正在尝试为我正在使用 ASP MVC + 实体框架进行编码的网站设计/实现信誉系统，并且想知道将信誉系统的所有逻辑写入 StoredProcs 是否是一个好主意，以便进行编码进入应用模型。

就我个人而言，我尽量避免使用存储过程，但对于这种情况，我认为它们是最好的选择，加载所有实体只是为了增加 2 个字段的值似乎有点矫枉过正，特别是如果调用正在进行通过ajax制作。

对此有何普遍看法？有什么我应该考虑的吗？stackoverflow（DB级别或.Net级别）在哪里实现？

使用触发器而不是存储过程会是更好的选择吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T19:48:26.287

为什么需要加载所有实体？信誉不是为每个用户集中存储的吗？

不就是一次加载一次更新吗？

也可以从 .net 空间中运行查询，如下所示：http: [//msdn.microsoft.com/en-us/library/bb738521.aspx](http://msdn.microsoft.com/en-us/library/bb738521.aspx)

就我个人而言，我会尽可能地使用 ORM，然后如果我发现存在性能问题，则回退到 SPROC。

# java - 什么是对象序列化？（Java）

> ID：778707
> 
> 赞同：5
> 
> 时间：2009-04-22T19:10:42.913
> 
> 标签：java, serialization, object

以不那么技术的方式，什么是对象序列化及其目的？什么时候应该使用它？

欢迎任何类比和例子。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T19:12:45.513

对象序列化允许您将对象（数据结构）转换为二进制或其他自定义表示。这又可以用于通过线路发送这些二进制表示或将它们存储在文件系统上。

序列化可用于

*   通过网络发送对象
*   持久性
*   深拷贝对象树
*   ?

事实上，Java 对象序列化的有趣之处在于，您可以使用标准的序列化机制，将数据从对象转换为二进制表示，也可以通过实现 Serializable 接口中的方法来定制它。除此之外，您可以读取对象的数据并“手动”对其进行序列化，即读取值并将它们转换为您想要的任何格式以及您想要的任何格式。

看看以下资源：

*   [http://java.sun.com/j2se/1.5.0/docs/api/java/io/Serializable.html](http://java.sun.com/j2se/1.5.0/docs/api/java/io/Serializable.html)
*   [http://java.sun.com/j2se/1.5.0/docs/api/java/io/Externalizable.html](http://java.sun.com/j2se/1.5.0/docs/api/java/io/Externalizable.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T19:13:09.523

基本上，它是一种将存储在对象中的数据保存到磁盘或通过网络传输的方法。然后可以稍后重建对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T19:15:06.867

最简单的解释方法是：

序列化是一种获取应用程序中的对象并以某种永久格式（二进制、xml 等）描述它们的方法。

序列化后，您可以无限期地存储它们...通过网络发送它们...稍后再读回它们...发挥您的想象力。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T19:14:44.310

对象序列化是将对象的状态保存到字节序列的过程，以及在将来某个时间将这些字节重建为活动对象的过程。

这是一篇讨论[Java 序列化的秘密的文章](http://java.sun.com/developer/technicalArticles/Programming/serialization/)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T19:17:10.840

在另一个 Stack Overflow 问题中有一个[很好的总结。](https://stackoverflow.com/questions/447898/what-is-object-serialization)引用[接受的答案：](https://stackoverflow.com/questions/447898/what-is-object-serialization/447920#447920)

> 序列化是将对象转换为一系列字节，以便可以轻松地将对象保存到持久存储或通过通信链路流式传输。然后可以对字节流进行反序列化 - 转换为原始对象的副本。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-22T19:14:21.423

非技术性的：序列化是将基于内存的结构（如正常存在于主内存中的对象）流式传输到持久的、通常是硬盘的过程。因此，您可能将对象的结构映射到 XML 之类的东西中。

# tortoisesvn - 如何在 Tortoise Check-ins 中排除文件夹

> ID：778715
> 
> 赞同：5
> 
> 时间：2009-04-22T19:11:59.230
> 
> 标签：tortoisesvn

我在设置中看到您可以指定模式以从签入中排除文件。但是您将如何添加到包含文件夹 bin 和 obj 中？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-06-02T01:06:17.483

我使用设置\全局忽略模式。这是我添加到默认列表中的内容：

```
*.suo *.user bin obj Debug Release _UpgradeReport_Files *.dbmdl 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-22T19:15:02.513

在排除文件的同一位置添加：

*/bin */obj

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T19:18:00.760

svn:ignore 属性将忽略匹配的文件和文件夹。这就是我必须在 [Oo]bj 中排除 bin 和 obj 文件夹 [Bb] 确保选中“递归应用属性”

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T19:19:28.900

右键单击 bin 目录并选择 TortoiseSVN > Add to Ignore List > *FolderName*。然后对 obj 做同样的事情。

# emacs - 如何让 Emacs 启动更快？

> ID：778716
> 
> 赞同：73
> 
> 时间：2009-04-22T19:12:01.040
> 
> 标签：emacs, performance

我使用[Emacs](http://en.wikipedia.org/wiki/Emacs) v. 22（控制台版本，远程使用[PuTTY](http://en.wikipedia.org/wiki/PuTTY)或本地使用[Konsole](http://en.wikipedia.org/wiki/Konsole)）作为我在 Linux 上的主要文本编辑器。每次我启动它都需要一段时间来加载，可能差不多一秒钟，虽然我从来没有计时过。我经常打开和关闭 Emacs，因为我更习惯使用[Bash](http://en.wikipedia.org/wiki/Bash_%28Unix_shell%29)命令行进行文件/目录操作和编译。

如何加快启动时间？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-04-22T20:44:49.427

其他人已经涵盖了使用`gnuserve`and `emacsclient`，我建议在 emacs 中编译（能够跳转到编译错误是一个胜利）。

但是，具体加速 .emacs 可以通过以下方式完成：

1.  字节编译 .emacs 文件，您可以使用[这段代码自动完成](http://snipplr.com/view/14292/autocompiled-emacs-file/)

2.  [用自动加载](http://www.gnu.org/software/emacs/manual/html_node/elisp/Autoload.html)功能替换尽可能多的`(require 'package)`语句。这将延迟 lisp 的加载，直到实际需要它。使用这种技术，我可以将启动速度从 >6 秒加快到 <1。这需要一些工作，因为并非所有库都正确标记。`autoload`

3.  删除不再使用的代码/功能。

4.  尝试使用选项运行 emacs`--no-site-file`以避免在站点安装中加载不必要的包`site-start.el`。

5.  如果您真的很认真，您可以使用已经加载的您喜欢的功能来滚动您自己的 emacs。当然，这意味着对您的内容进行更改会更加复杂，`.emacs`因为它是二进制文件的一部分。按照链接获取有关如何使用的信息[`dump-emacs`](http://www.emacswiki.org/emacs/DumpingEmacs)。

6.  购买更快的计算机和/或更快的磁盘。

### 如何确定 .emacs 加载的内容

现在，你如何找出你的 .emacs 加载了什么？目标是删除功能，还是延迟它？检查您的**`*Messages*`**缓冲区，其中包含以下行：

```
正在加载 /home/tjackson/.emacs.tjackson.el（来源）...
正在加载/home/tjackson/installed/emacs/lisp/loaddefs.el（源代码）...完成
正在加载 /user/tjackson/.elisp/source/loaddefs.el (source)...完成
正在加载自动恢复...完成
正在加载 /home/tjackson/.emacs.tjackson.el（来源）...完成

```

如果您注意到，`Loading`语句可以嵌套：第一行`.emacs.tjackson.el`以 结尾，`...`最后一行显示`.emacs.tjackson.el`负载为`...done`. 所有这些其他文件都是从我的`.emacs.tjackson.el`文件中加载的。所有其他负载都是原子的。

*注意：*如果你有一个大的 .emacs，**`*Messages*`**缓冲区可能会丢失一些消息，因为它只保留固定数量的信息。您可以尽早将此设置添加到您的`.emacs`以保留所有消息：

```
(setq message-log-max t) 
```

*注意：*如果命令的第四个参数为非零，该[`'load`](http://www.gnu.org/software/emacs/elisp/html_node/How-Programs-Do-Loading.html)命令将禁止消息，因此请删除任何此类调用（或者，建议并强制第四个参数为）。`nomessage``'load``nil`

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-04-22T19:38:14.533

除了[Adam Rosenfield 的解决方案](https://stackoverflow.com/questions/778716/how-can-i-make-emacs-start-up-faster/778751#778751)，我推荐[在服务器模式下使用 Emacs](http://www.gnu.org/software/emacs/manual/html_node/emacs/Emacs-Server.html)。您可以添加`(server-start)`到您的 dotmacs，并运行`emacsclient`而不是`emacs`在您想在 Emacs 中打开文件时运行。这样你只需支付一次 Emacs 的加载成本，然后客户端立即弹出。

**编辑**

没错，v22 不会创建新框架。创建一个可以解决问题的 shell 脚本：

```
#!/bin/bash
# Argument: filename to open in new Emacs frame
/usr/bin/emacsclient -e '(let ((default-directory "`pwd`/")) (select-frame (make-frame)) (find-file "'$1'"))' 
```

**编辑 2**

在 v24+ 中，您可以`emacsclient -c`创建一个新框架。

* * *

## 回答 #3

> 赞同：30
> 
> 时间：2009-04-22T19:22:57.347

不要在每次要使用 shell 时关闭 Emacs。使用 Ctrl-Z 将 Emacs 移至后台，并使用`fg`Bash 中的命令将其移回前台。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2009-04-23T08:01:20.987

几个提示：

1.  使用自动加载

    使用自动加载可以使您免于加载库，直到您使用它们。例如：

    ```
    (if (locate-library "ediff-trees")
        (autoload 'ediff-trees "ediff-trees" "Start an tree ediff" t)) 
    ```

2.  编译你的 .emacs

    如果您使用版本控制并且您的 .emacs 比 .emacs.elc 更新，则会给您带来轻微的速度提升。一个常见的技巧是：

    ```
    (defun autocompile nil
      "compile itself if ~/.emacs"
      (interactive)
      (require 'bytecomp)
      (let ((dotemacs (file-truename user-init-file)))
        (if (string= (buffer-file-name) (file-chase-links dotemacs))
          (byte-compile-file dotemacs))))

    (add-hook 'after-save-hook 'autocompile) 
    ```

3.  学会爱上 emacs 服务器。

    将 emacs 作为服务器运行意味着永远不必关闭它。但是我注意到您仍在使用 emacs22。emacs23 支持多 tty，这使得在一个屏幕会话中运行 emacs 然后在另一个终端中打开新窗口变得更加容易。我使用 emacs 为我的邮件客户端 (mutt) 编辑邮件，而 emacsclient 非常适合这种快速编辑。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-04-22T20:46:05.103

之一

```
M-x shell
M-x eshell
M-x term
M-x ansi-term 
```

应该可以满足您在 Emacs 中的命令行需求。

您还可以使用`M-!`(aka `M-x shell-command`) 执行单行程序，而不会掉入 shell。

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-04-22T19:19:19.307

检查你的`.emacs`文件，看看你是否加载了不必要的包。加载包可能需要大量时间。例如，您可能只想`php-mode`在编辑 PHP 文件时加载包。你可以通过安装一个钩子程序来做到这一点，尽管我不确定细节。

还要确保您正在加载的任何包都已编译（`.elc`文件）。您可以通过运行编译`elisp`文件

```
emacs -batch -f batch-byte-compile thefile.el 
```

已编译的包加载速度比未编译的包快得多。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2009-04-22T19:33:10.893

“我经常打开和关闭 emacs，因为我更习惯使用 bash 命令行进行文件/目录操作和编译。”

您正在描述像 vim 这样的编辑器的使用方式。拍摄进出。Emacs 通常保持打开状态，并且大部分都是从“内部”完成的。hiena 已经回答了这里的正确方法。

* * *

## 回答 #8

> 赞同：13
> 
> 时间：2011-11-05T20:28:50.787

最快的方法是[分析您的 .emacs](http://www.emacswiki.org/emacs/ProfileDotEmacs)。在我发现 .emacs 中的 4 条特定行占用了超过 80% 的加载时间后，我在 5 分钟内将加载时间从 > 3 秒缩短到 1 秒。

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2009-04-28T17:17:28.007

`.emacs`除了`autoload`（正如其他人建议的那样）之外，帮助我减少加载时间的一件事是[eval-after-load](http://www.gnu.org/software/emacs/elisp/html_node/Hooks-for-Loading.html)。在下面的示例中，延迟调用可以使您`sql-set-product`不必加载，从而使现有的自动加载更有效。`sql``.emacs``sql`

```
（加载后评估“sql”
  '（预测
     (sql-set-product 'mysql)
     (setq sql-mysql-options '("-C" "-t" "-f" "-n"))
     (setq sql-sqlite-program "sqlite3")
     ))

```

当然，对于某些包，会有一个可用的[钩子](http://www.gnu.org/software/emacs/manual/html_node/emacs/Hooks.html)，你可以做同样的事情，但有时没有，否则这种方式更容易考虑。

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2009-04-22T19:44:25.580

Emacs 被设计为“一直”运行（或至少长时间运行），因此不建议在一天中多次启动和停止 Emacs。

我建议使用屏幕。Screen是一个终端多路复用器，在一个终端中为您提供无限的虚拟终端。

安装后只需在终端中写入“screen emacs”。Emacs 将照常启动，但按“ca c”（即按 ctrl-a 然后按 c）将打开一个新的虚拟终端。您可以通过按“ca ca”（即两次 ctrl-a）返回 emacs。

您甚至可以从正在运行的屏幕会话中分离，键序列是“ca d”。

通过发出“screen -R”重新连接到会话，您将回到您离开的地方。这使您能够在工作中启动 emacs 会话、分离、回家和在家重新连接。

我已经连续几个月像这样运行 Emacs。

这是官方网站：[http](http://www.gnu.org/software/screen/) : //www.gnu.org/software/screen/ 但尝试使用谷歌搜索屏幕教程和操作方法

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2014-05-02T11:05:36.760

你可以使用[benchmark-init](https://github.com/dholm/benchmark-init-el)来分析你的 Emacs 启动。它将跟踪正在加载哪些模块以及每个模块花费了多少时间。结果可以以表格或树的形式呈现。树可以更轻松地跟踪谁加载了什么，这在您加载具有大量依赖项的包时会很有帮助，并且表格形式可以帮助您快速找到大部分时间都花在了哪里。

一旦你得到这些结果，试着弄清楚是否所有的模块都必须一直加载，或者你是否可以按需加载其中的一些。例如，在我的配置中，我只加载特定于某些模式的 Emacs 扩展，当该模式实际激活时，因为大多数时候我只在会话中使用它们的一小部分。 [eval-after-load](http://www.gnu.org/software/emacs/manual/html_node/elisp/Hooks-for-Loading.html)和 mode 挂钩将成为您的朋友。

通过应用这种方法**，我的 Emacs 将在 3-4 秒内启动，**并且我安装了**近 200 个扩展**。大部分时间都花在加载 Helm 上，我总是加载它，因为它替换了始终需要的查找文件和其他核心功能，还有 CEDET，因为我使用的是最新版本，并且必须在 Emacs 尝试加载旧版本之前加载它内置版本。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-04-23T09:26:30.750

其他人没有提到的一件事是包含您使用的 elisp 库作为[转储 Emacs](http://www.gnu.org/software/emacs/elisp/html_node/Building-Emacs.html)的一部分，以将库加载时间从 Emacs 启动移动到 Emacs 构建。它不适合胆小的人，但是如果您在其中加载多个库，则可以为您`.emacs`赢得几秒钟的启动时间。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2015-03-16T21:22:34.083

尝试使用[https://github.com/jwiegley/use-package](https://github.com/jwiegley/use-package)宏来定义您的包加载和自定义。它为您处理包的延迟加载，即使在存在大量已配置包的情况下，也相对容易获得良好的启动时间。我的 .emacs 中引用了近 100 个包，但我的启动时间在 Linux 上不到 2 秒，在 Mac 上不到 2.2 秒。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2016-04-03T00:26:21.723

我有大约 120 秒的开始时间。我能够找到安装此修复程序：

[https://github.com/dholm/benchmark-init-el](https://github.com/dholm/benchmark-init-el) 放在您的**init.el 之上**

```
(let ((benchmark-init.el "~/.emacs.d/el-get/benchmark-init/benchmark-init.el"))
  (when (file-exists-p benchmark-init.el)
    (load benchmark-init.el))) 
```

然后一旦你的emacs启动，运行：

**Mx benchmark-init/show-durations-tree**

在我这边，问题是 tramp-loaddefs 中的 127 秒

我通过添加来修复它

```
127.0.0.1  host.does.not.exist 
```

到**/etc/hosts**这让我的启动速度很快

在这里查看更多信息：[https ://github.com/emacs-helm/helm/issues/1045](https://github.com/emacs-helm/helm/issues/1045)

另一件事可能对您有帮助：[https ://www.emacswiki.org/emacs/ProfileDotEmacs](https://www.emacswiki.org/emacs/ProfileDotEmacs)

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2009-04-22T19:21:41.390

*这不能回答问题，但有点相关*

我不知道如何让它启动得更快，但我可以建议一些事情：

*   对于您在命令行上执行的大多数操作，您可以在 emacs 中执行它们：

    *   compile：mx编译，然后输入你使用的命令
    *   我的经验仅适用于 C++，但使用 g++，您可以按 Cx ` 跳转到编译器抱怨的行
    *   运行 shell 命令：M-!，将输出转储到缓冲区
    *   交互式外壳：Mx外壳
*   或者，您可以像这样运行 emacs：

    *   `emacs file.ext &`
    *   它在后台打开emacs，因此您仍然可以使用shell（这最适合putty和X转发之类的Xming）

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2014-10-22T15:04:10.110

当我在这里遇到这个问题时，我试图解决同样的问题。我只是想补充一点，对我来说问题不是因为 emacs lisp 包的加载时间，而是主机没有完全解析的主机名这一事实

要检查您的包裹加载时间，请执行

```
M-x emacs-init-time 
```

对我来说是 0.3 秒，但加载时间非常长。正确更改我的主机名后，它解决了问题。

要配置完全解析的主机名，请编辑 /etc/hostname 和 /etc/hostsfile：

```
127.0.0.1       localhost localhost.localdomain
192.168.0.2   hostname hostname.domain 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-22T19:40:43.140

我必须检查我的定制，但有一个名为 gnuserve 或 emacsclient 的包。它迁移了很多，所以你必须用谷歌搜索它。

它在后台运行一个 emacs 会话。任何进一步的 emacs 会话本质上只是该会话的新框架。一个优点是您以后的会话的启动时间很快。

# random - 如何测试随机数？

> ID：778718
> 
> 赞同：20
> 
> 时间：2009-04-22T19:12:20.117
> 
> 标签：random, testing, numbers

我用matlab编写了一个程序，它可以生成0到1之间的随机数。我只用matlab中的runtest对其进行了测试，结果是序列是随机的。我也看过直方图，它们有一个 beta 分布。我想用其他测试来测试这个 rng，比如 diehard、ent 或 nist，但我不知道如何。有人可以解释如何使用它们，或者建议我进行其他一些随机性测试。谢谢你

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-22T19:20:00.130

对于大多数测试，您可以提供一个大的随机数文件（整数或浮点数）并在该示例文件上运行各种测试。如果我没记错的话，DIEHARD 就是这样工作的，其他一些人也是。如果你真的想看到你的生成器失败，你可以尝试使用Pierre L'Ecuyer 的[TestU01](http://www.iro.umontreal.ca/~simardr/testu01/tu01.html)，它有足够的测试让几乎每个生成器都至少失败一个测试:-)

尽管如此，对于大多数测试套件来说，都有大量的文档，至少我知道[DIEHARD](http://www.stat.fsu.edu/pub/diehard/cdrom/source/diehard.doc)，来自[NIST SP 800-22](http://csrc.nist.gov/publications/nistpubs/800-22-rev1/SP800-22rev1.pdf)以及[DieHarder](http://www.phy.duke.edu/~rgb/General/dieharder/dieharder.html)和[TestU01](http://www.iro.umontreal.ca/~simardr/testu01/guideshorttestu01.pdf)的测试套件（链接到文档）。提供随机数进行测试的方法通常不同，但在各自的文档中有所提及。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-11-26T23:30:54.700

可用的测试有：

顽固分子 - [http://www.phy.duke.edu/~rgb/General/dieharder.php](http://www.phy.duke.edu/~rgb/General/dieharder.php)

TestU01 - [http://simul.iro.umontreal.ca/testu01/tu01.html](http://simul.iro.umontreal.ca/testu01/tu01.html)

RaBiGeTe - [http://cristianopi.altervista.org/RaBiGeTe_MT/](http://cristianopi.altervista.org/RaBiGeTe_MT/)

NIST STS - [http://csrc.nist.gov/groups/ST/toolkit/rng/documentation_software.html](http://csrc.nist.gov/groups/ST/toolkit/rng/documentation_software.html)

PractRand - [http://pracrand.sourceforge.net/](http://pracrand.sourceforge.net/)

其中任何一个都可以测试文件中的位。一些（PractRand，Dieharder，不确定 TestU01）可以测试标准输入中的数据。有些还支持将您的 PRNG 直接链接到测试套件，动态地（只有 RaBiGeTe 真正支持动态地将您的 PRNG 链接到它）或静态地。

质量是不平等的。如果你有大量的 PRNG 输出，PractRand 可以最快地找到最广泛的偏差（完全披露：我写了 PractRand），其次是 TestU01。如果您没有足够的位，RaBiGeTe 可能会做得更好。NIST STS 和 Dieharder 通常表现不佳。

界面的便利性也不尽相同。PractRand 和 Dieharder 是为命令行自动化而设置的。在我看来，PractRand 和 TestU01 往往具有最容易解释的输出。在这方面，Dieharder 也不错。RaBiGeTe 和 NIST STS，嗯……他们都提倡在我看来过于复杂和无用的测试结果分布的可视化。

此外，NIST STS 和 Dieharder 都存在误报问题。

还有 ENT，目前找不到它的链接……它有一个相当方便的接口 IIRC，但不太擅长发现偏见。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-23T07:38:36.690

如果你想自己测试你的RNG，有很多东西需要测试。这里有一些基本特征可能会揭示您的数字序列不是真正随机的，或者可能与随机无法区分？

看一眼：

1.  *分布*- 你已经对你的分布做了一些分析。您希望每个可能的数字具有相同的发生概率。

2.  *循环行为*- 相同的序列会一遍又一遍地重复吗？重复序列可能很长。

3.  *重复的出现 (...CBBAF F...) ，三胞胎 (...CBAAA F...) 等。* 从统计上，在随机数序列中，您有一定的重复概率（相同的数字连续两次生成） )、三元组等。计算这个概率并检查你的伪随机数序列是否具有相同的重复发生概率？

请注意，对于大多数这些测试，您需要有相当长的随机数序列，以便能够从统计分析中获得合理和准确的结果。

我假设整数的伪随机数序列，这很容易通过将 [0, 1] 数字乘以适当的常数来修复。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-01-06T02:06:19.807

对于您的特定用例，我建议将您的 rng 生成的`0`和`1`数字作为字符写到文件中，然后将该文件用作测试套件程序的输入数据。

请注意，序列必须至少有 1000 个字符长才能由 STS 测试。

当你运行它时，不要忘记使用 flag `-F 'a'`，告诉程序输入文件是由 ASCII`0`和`1`字符组成的。

* * *

我还建议尝试[这个非官方版本](https://github.com/arcetri/STS)的 NIST 统计测试套件，我在其中修改了原始 NIST 源代码并尝试对其进行优化。

* * *

为了您的方便，这里是我建议您用来运行测试的命令（在从源代码编译程序之后`$ make`）：

```
$ ./sts -v 1 -i 32 -I 1 -w . -F 'a' /path/to/input/file 
```

您可能希望将测试的比特流数量（由`-i`标志指示）增加到更大的数量，以使用来自输入的更多数据。例如，您可以选择：

```
number of bitstreams = (number of 1 and 0 bits you generated) / 1048576 
```

运行完所有测试后，程序将在名为 的文件中生成报告`result.txt`，您可以使用该报告来评估 rng 的质量。

* * *

请注意，这个程序虽然不是 NIST 官方的。此外，我们的测试套件修改没有经过第 3 方测试；所以它是原样的，没有任何保证。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2011-02-07T11:27:53.840

我实际上正在寻找类似的测试，希望在这里找到它但没有。我会试试 math.stackoverflow.com，因为答案是统计的，所以我可能会问它。

我的统计知识足够温和，可以在无法提供确切细节的情况下知道您要查找的内容。

本质上，您正在执行回归测试，以确定您的数字是否符合均匀分布。所以我们可以创建一个卡方模型（我认为）。它将导致获得 t-stat 和 p-value。较高的 t-stat 和较低的 p 值意味着它不符合分布（因此我们拒绝原假设）。p 值将介于 0 和 1 之间。如果是 0.06，那么我们可以以 94% 的置信度拒绝原假设。

并回答那些说“我们不应该创建随机数”的人，也许不是实际的随机数，但我们可能会获取数据并希望测试它是否符合均匀分布，对于程序员，我们可能希望测试哈希-function 在我们正在散列的对象的大量随机实例中产生均匀分布。

至于 NIST 测试的一些代码，这里有一些：

[http://sourceforge.net/projects/randomanalysis/](http://sourceforge.net/projects/randomanalysis/)

这可能会给你你想要的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-08-08T04:46:34.867

去年我一直在研究这个问题，我得出的结论是，在现实世界中没有测试随机性的标准方法。我认为这只是让您感到舒适的原因。你不能证明一个序列是随机的，你也不能轻易地证明一个序列不是随机的。

（我排除了真正不是随机的随机序列，比如 0123456789...重复。）

user3535668 列出了一些广为人知的测试，以及它们的完整问题列表。我可以添加其他人。顽固 - 输入文件应该有多大，它应该只包含 32 位整数吗？ENT - 似乎只适用于严重错误，但 chi 测试很有用。NIST 用户手册超过 100 页——祝你好运。TestU01 - 相同的编译问题。一旦你把它硬塞进你的电脑，它运行正常吗？那么你怎么能相信输出呢？你怎么知道测试是否失败？什么水平的 p 或 KS 被认为过于极端？

我还要补充一点，您应该考虑相对于现实政治的随机性测试套件的开发。开发诋毁随机数生成器的测试符合学者的自身利益。毕竟，你不会得到任何资金来产生“一切正常，没有发现，不需要进一步研究”的结果。

读者会不同意这个前提，但我建议你考虑一下我们生活的现实世界中发生的事情，而不是学者的书架上发生的事情。没有标准的测试。考虑：-

Random.org - 使用本科生为论文进行了一些自制测试。并且基本上计算 1 和 0 的数量。耳鼻喉科类似。

Hotbits - 支持简单的 ENT，以及大多数人难以执行的黑客版本的 Dieharder，更不用说尝试理解无数的测试初始化​​程序了。

学术生成器论文 - 很大程度上依赖于 Knuth 的著作和朴素的技术。有些人使用上述一些工具。然后有些人接受这些套件中的许多测试失败。

到目前为止，我在这个人的世界中发现的唯一一个似乎可以承受任何实际重量的例子（即，如果它失败了，你会去监狱类型的重量）是英国赌博软件供应商 Playtech PLC 的认证。他们为一些最大的在线博彩公司提供真钱易手的服务。尽管如此，他们仍然使用自制测试和 Diehard 测试。

我个人喜欢：-

1.  将主题文件转换为位图查看
2.  在 Ultra 设置下用 7z 压缩它，看看它是否变小了
3.  对它进行顽固的奔跑并寻找愚蠢的ps和KS。

我认为如果一个文件通过了我个人的 1-3，你将很难证明不是这样。在我看来，这是一个很好的起点……

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-22T19:15:18.177

将结果限制在特定范围内（可能使用 mod 运算符），运行代码几百万次并计算您在该范围内看到每个数字的次数。确保计数大致相同，并且您对任何特定值都没有偏见。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-22T19:32:01.273

我可能会走的路线是对结果进行可视化分析。这个代码很简单，如下面的伪代码所示，基于[他的文章](http://www.boallen.com/random-numbers.html)。

```
1\. 创建一个 x x y 大小的图像
2\. 对于 ndx = 0 到 x
  3\. 对于 ndy = 0 到 y
    4\. 设 random 为 0 到 1 之间的随机数
    5.如果random = 1，设置图像点在ndx，ndy为黑色
6.显示生成的图像

```

此外，Random.org 有[更多](http://www.random.org/analysis/)关于算法统计分析的信息，但他们也使用上述文章作为视觉分析的示例。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2014-08-08T20:38:50.787

[@Anna](http://stat.fsu.edu/pub/diehard/)我和你有同样的问题，现在由于其他一些答案而发现了顽固分子。

我的 RNG 的情况是它创建 1 和 0 并将它们存储在 ASCII 文件中。尝试将此文件上传到在线随机性测试时，它失败了——很可能是因为数据需要采用二进制格式。

Diehard 的情况确实如此。如果您安装了 Diehard，您会发现一个名为的文件，它会`DIEHARD.DOC`告诉您如何将 ASCII 文件转换为所需的二进制文件的步骤（以及您可能需要对程序进行的一些其他更改）。

无论如何，这是我的第一步。希望这可以帮助某人。

# mysql - Windows 中 JDBC-MySQL 的命名管道与 TCP

> ID：778719
> 
> 赞同：1
> 
> 时间：2009-04-22T19:12:33.987
> 
> 标签：mysql, jdbc, named-pipes, c3p0

我的 Java (JPA+Hibernate+CommonsDBCP) 应用程序连接到 MySQL 之间一直存在许多连接问题。我已经完成了研究，使用验证查询、超时、X 之前的测试等调整了所有设置。

这条路径让我想到了另一个比较 DBCP 和 C3PO 的 StackOverflow 问题。从回复中，我决定肯定尝试 C3PO。

然而，一路走来，我发现了另一个选择：命名管道，因为应用服务器和 MySQL 都在同一台机器上运行。麻烦的是，我找不到有关此方法的许多详细信息。

所以这是我的问题：最**稳定**的选项是什么：命名管道或 TCP w/C3PO？任何故事或知识以及答案都将受到*欢迎。*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-08T03:42:13.903

好吧，这取决于您的情况：

谁在连接 MySQL？来自慢速 LAN 或 WAN 链接的客户端？还是本地主机？

TCP/IP 具有连接积压的好处，而命名管道则没有，因此对于慢速链接或 WAN，我会使用 TCP/IP；否则，命名管道。

此外，本地命名管道在内核模式下运行，因此它们会非常快。

尝试查看[http://msdn.microsoft.com/en-us/library/aa178138(SQL.80).aspx](http://msdn.microsoft.com/en-us/library/aa178138(SQL.80).aspx)

即使它谈到 MS SQL Server，在内核模式下运行的本地命名管道*仍应*适用。

# synchronization - 如何避免在服务器端和客户端重复验证？

> ID：778726
> 
> 赞同：14
> 
> 时间：2009-04-22T19:14:09.660
> 
> 标签：synchronization, server-side, client-side

如何避免在服务器端和客户端重复验证？是否有一个网络编程平台可以从另一个生成一个，所以我不必让两者保持同步？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T19:23:34.710

有些框架可以从服务器端验证配置生成客户端验证。

现在我不知道您使用的是什么语言或框架，但也许这篇文章可以提供帮助：[http ://www.emadibrahim.com/2008/09/08/client-server-side-validation-in-aspnet -MVC/](http://www.emadibrahim.com/2008/09/08/client-server-side-validation-in-aspnet-mvc/)

他将 Castle Validator Component 与 JQuery 一起使用，并添加了一些胶水来根据服务器端验证属性生成客户端验证。它适用于 asp.net mvc。

/阿斯格

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T20:12:31.003

我认为最好的方法是使用同时提供两者的组件。他们的代码已经过测试，你不需要维护它。我过去曾使用过[Peter Blum 的](http://www.peterblum.com/DES/ProfessionalValidation.aspx)控件并取得了巨大的成功。除此之外，我认为如果您想同时提供两个代码库，您将不得不维护两个代码库。有一个名为[Script#](http://projects.nikhilk.net/ScriptSharp/)的工具可以帮助将 C# 编译为 Javascript（它进行翻译，而不是真正的编译），但我不确定它在这种情况下的效果如何。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T19:17:32.413

大多数人放弃客户端脚本，现在只做服务器端。发送帖子时可以使用ajax，这样响应比重新加载整个页面要轻一些。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T19:28:03.137

正如其他人提到的那样，您应该保留重复，因为客户端验证是为了帮助应用程序更快地做出反应以帮助用户，但是，真正的验证是在服务器端，因为您永远不应该相信任何传入的东西，直到它已被验证。您可能会在服务器端进行更广泛的验证，尤其是如果需要检查数据源，例如，用户名在服务器端是否唯一，但用户名是否足够长，或者电子邮件地址，可以在客户端和服务器端完成。

当有重复时，我倾向于添加注释，特别是如果我使用正则表达式，以确保一个中的更改在另一个中发生了更改。

良好的单元测试将有助于确保这两者始终保持同步。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T19:21:07.053

需要服务器端验证只是因为可以禁用客户端验证。

不需要客户端验证，但它使您的应用程序在错误处理期间更具响应性，因为您不再需要向服务器提交表单并等待结果页面返回。

设计良好的应用程序同时使用两者。

附带说明一下，Ajax 可用于某些类型的验证，例如检查用户注册表单上的重复用户名。但是，基本验证，例如检查字段是否仅包含数字，应该在没有它的情况下完成。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-23T13:25:36.900

Asp.net Version 1 had validator controls to do what you are asking

[http://msdn.microsoft.com/en-us/library/yb52a4x0.aspx](http://msdn.microsoft.com/en-us/library/yb52a4x0.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-22T19:23:17.440

大多数情况下最好在服务器端进行验证。您有许多不同的选项来简化此操作，例如 Ajax 或在 PHP 中使用粘性表单。我个人倾向于在服务器端进行验证，因为用户可以选择关闭 JavaScript 并且他们无法关闭服务器上的验证.....

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-22T19:28:35.273

您可以做的是让服务器端验证逻辑由 Web 服务运行，您的客户端验证可以通过 AJAX 调用，也可以在您回发到服务器时调用。

# c# - 修改匿名类型的字段？

> ID：778730
> 
> 赞同：2
> 
> 时间：2009-04-22T19:14:57.927
> 
> 标签：c#, .net

在这个例子中：

```
var p1 = new {Name = "A", Price = 3}; 
```

**这转化为 IL：**

```
class __Anonymous1
{
   private string name ;
   private int price;
   public string Name{ get { return name; } set { name = value ; } }
   public int Price{ get { return price; } set { price= value ; } }
}
__Anonymous1 p1 = new __Anonymous1();
p1.Name = "A";
pt.Price =3 
```

根据 IL，它是**Allowed**，为什么会这样？背后的决定是什么？不应该是只读的吗？

谢谢

这是我的第一个问题，温柔点。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T19:19:37.183

让我把它转过来：为什么要限制它？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T19:29:46.083

编译器在编译源代码时生成类并命名它们。这些类具有读/写属性的原因是（如 IL 所示）编译器不会创建具有所有必要属性的构造函数，因此必须将属性设置为读/写以允许设置值。这也允许多个匿名类型使用相同的类，只要它们的属性相同。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T19:24:17.343

例如，如果我制作了一个匿名类型的列表，就像使用 LINQ 时发生的那样，那么您可能希望在获得其余信息后更改属性的值。

例如，如果您的匿名类型中有一个百分比字段，您可能无法计算它，直到您知道最大值或总数（取决于您希望如何定义百分比）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T20:03:54.423

我认为匿名类型不可变的原因是函数式语言对 LINQ 和 C# 3.0 的影响以及它们是解决一个非常具体的问题的方法。

如果要修改字段（属性），只需创建自己的类而不是使用匿名类。是否存在**必须**使用匿名类**并**能够修改属性的情况？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T19:51:20.210

这是编译器的实现细节，不应依赖。未来的编译器可以完全自由地使匿名类型接受构造函数参数并使所有属性只获取。出于所有意图和目的，匿名类型对象一旦被实例化就应该被认为是不可变的。（不过，属性本身可能会引用可变对象。）

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-22T19:20:56.290

我不确定我是否理解您的问题...为什么不允许这样做？...或者您希望不允许什么？

```
var p = new {Name = "A", Price = 3};
//Some Code Here
p.Name = "B";
//Some more code 
p.Price = 5; 
```

同样，如果我要创建第二个匿名变量，C# 编译器足够聪明，可以知道它们具有相同的结构，因此它将在后台生成一个匿名类。

```
var p = new {Name = "A", Price = 3};

//Some Time Later

var q = new {Name = "B", Price = 4};

//Only one anonymous class is generated in the IL 
```

# apache-flex - Flex 3：鼠标悬停在文本输入上时如何更改鼠标光标？

> ID：778735
> 
> 赞同：6
> 
> 时间：2009-04-22T19:15:39.003
> 
> 标签：apache-flex, cursors

在 Flex 中，默认情况下，当您将鼠标悬停在 Text Input 上时，鼠标光标会变为标准的 I 横杆。如何更改此光标以显示常规鼠标指针光标而不是 I 十字条？

更新：好吧，根据这篇博文，在 Flex 4 中这个过程似乎很简单：http: [//blog.flexexamples.com/2008/11/03/setting-mouse-cursors-in-flash-player-10/](http://blog.flexexamples.com/2008/11/03/setting-mouse-cursors-in-flash-player-10/)

由于我暂时坚持使用 Flex 3，我该如何做类似的事情？

更新2：此外，这个问题有点类似于这个问题： [避免光标更改在Flash CS3中的动态文本字段上](https://stackoverflow.com/questions/587252/avoiding-cursor-change-over-dynamic-text-fields-in-flash-cs3)

不过，我使用的是标准的 Flex Builder，而不是 Flash CS3。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2010-10-01T11:34:05.860

澄清一下 -在 Flash 10 上的 Flex 3 中也存在[MouseCursor](http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/ui/MouseCursor.html) 和[Mouse](http://help.adobe.com/en_US/FlashPlatform/reference/actionscript/3/flash/ui/Mouse.html)类。因此您可以挂钩 MOUSE_OVER 和 MOUSE_OUT 事件：

```
elem.addEventListener(MouseEvent.MOUSE_OVER, function(event:Event):void {
    Mouse.cursor = MouseCursor.BUTTON;
});

elem.addEventListener(MouseEvent.MOUSE_OUT, function(event:Event):void {
    Mouse.cursor = MouseCursor.ARROW;
}); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-03-30T21:27:51.333

必须修改三个属性 useHandCursor = true buttonMode = true mouseChildren = false

Leete 更多信息这篇文章[http://www.anujgakhar.com/2008/03/27/flex-how-to-display-hand-cursor-on-components/](http://www.anujgakhar.com/2008/03/27/flex-how-to-display-hand-cursor-on-components/)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T19:24:38.700

您必须使用 CursorManager：

```
import mx.managers.CursorManager;

protected function textMouseOverHandler(event:Event):void
{
    CursorManager.setCursor(yourCursor, yourPriority, xOffset, yOffset);
    // Rest of your handler
}

protected function textMouseOutHandler(event:Event):void
{
    // be sure to set the cursor back here
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-13T16:59:22.290

您可以使用带标签的 HBOX 而不是 TextInput。当鼠标悬停在标签上时，系统不会改变光标。如果您希望用户可以编辑文本，则需要做更多的工作。

```
public class MyTextInput extends HBox
{
public function  MyTextInput()
{
   super();
   var label:Label = new Label();
   label.text="some text";
   addChild(label);
   addEventListener(MouseEvent.CLICK, editProperties, true);
}
private function editProperties(event:MouseEvent)
{
  //do something to allow the user to edit the text e.g. PopupManager.createPopup
}
} 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-09-16T10:22:48.757

还有另一种方法是为您希望的任何组件将**buttonMode**属性设置为*true*。这带来了鼠标光标而不是文本光标。

# java - 使用 JRuby 连接到 MS SQL Server

> ID：778760
> 
> 赞同：2
> 
> 时间：2009-04-22T19:21:07.490
> 
> 标签：java, sql-server, ruby, jruby

我正在从事一个涉及一些脚本和数据存储的项目。我可以使用的数据库是 MS Sql Server，它位于 Windows 平台上。

尽管如此，我还是希望利用 Ruby 来编写脚本，特别是 JRuby。这有几个原因

1.  我想利用 Prawn 创建 pdf
2.  我只是喜欢鲁比
3.  JRuby 和 Rawr 将允许我捆绑依赖项，这样我就不必担心目标机器上有 ruby​​。

使用 Matz ruby​​ 时，我可以使用“win32ole”来轻松连接数据库。然而，由于显而易见的原因，这在 JRuby 中不起作用。从 JRuby/Java 连接到 MS Sql 以执行简单的 Select 和 Update 语句的最佳方法是什么？

提前致谢。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T19:32:18.527

MS SQL 应该有 JDBC 驱动程序；将其与 JRuby-JDBC 桥一起使用：[http ://wiki.jruby.org/wiki/JDBC](http://wiki.jruby.org/wiki/JDBC)

# php - Zend 框架 Zend_Form 装饰器：在按钮元素内部？

> ID：778770
> 
> 赞同：6
> 
> 时间：2009-04-22T19:23:48.703
> 
> 标签：php, zend-framework, zend-form

我有一个这样创建的按钮元素：

```
$submit = new Zend_Form_Element_Button('submit');
$submit->setLabel('My Button');
$submit->setDecorators(array(
    'ViewHelper',
     array('HtmlTag', array('tag' => 'li'))
));
$submit->setAttrib('type', 'submit'); 
```

这会生成以下 HTML：

```
<li>
    <label for="submit" class="optional">My Button</label> 
    <button name="submit" id="submit" type="submit">My Button</button>
</li> 
```

我想用 <span> 包裹按钮的内部，如下所示：

```
<button...><span>My Button</span></button> 
```

使用 Zend_Form 执行此操作的最佳方法是什么？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-01T13:58:23.170

我已经尝试过，但最终未能使用相同的方法自己实现这一目标。似乎最简单的方法是这样做：

```
...
$submit->setLabel('<span>My Button</span>');
... 
```

但是，跨度将被转义。完全可以关闭标签装饰器的转义，但是，添加标签装饰器会错误地呈现输出，例如：

```
$decorator = array(
    array('ViewHelper'),
    array('HtmlTag', array('tag' => 'li')),
    array('Label', array('escape' => false))
);

$submit = new Zend_Form_Element_Button('submit');
$submit->setLabel('<span>My Button</span>');
$submit->setDecorators($decorator);
$submit->setAttrib('type', 'submit'); 
```

...呈现：

```
<label for="submit" class="optional"><span>My Button</span></label>
<li>
    <button name="submit" id="submit" type="submit">&lt;span&gt;My Button&lt;/span&gt</button>
</li> 
```

...除了在语义上不正确（易于修复）之外，它仍在转义元素内的 span 标签。

**所以你会怎么做？**

好吧，我认为最好的方法（当涉及到对 Zend_Form 渲染的严格控制时，这是我的元建议）是使用[ViewScript](http://framework.zend.com/manual/en/zend.form.standardDecorators.html#zend.form.standardDecorators.viewScript)装饰器。

```
$submit = new Zend_Form_Element_Button('submit');
$submit->setLabel('My Button');
$submit->setDecorators(array(array('ViewScript', array('viewScript' => '_submitButton.phtml'))));
$submit->setAttrib('type', 'submit'); 
```

...然后在*_submitButton.phtml*中定义以下内容：

```
<li>
    <?= $this->formLabel($this->element->getName(), $this->element->getLabel()); ?>
    <button 
    <?php 

    $attribs = $this->element->getAttribs();

    echo
    ' name="' . $this->escape($this->element->getName()) . '"' .
    ' id="' . $this->escape($this->element->getId()) . '"' . 
    ' type="' . $this->escape($attribs['type']) . '"';
    ?>
    <?php

    $value = $this->element->getValue();

    if(!empty($value))
    {
        echo ' value="' . $this->escape($this->element->getValue()) . '"';
    }
    ?>
    >
    <span>
    <?= $this->escape($this->element->getLabel()); ?>
    </span>
    </button>
</li> 
```

_submitButton.phtml文件需要位于视图脚本目录中（您最好使用 为您的表单装饰器添加一个特定的目录*）*`$view->addScriptPath('/path/to/my/form/decorators')`。

这应该呈现您正在寻找的内容。由于我在工作中遇到的灵活性问题，我才刚刚开始研究 ViewScript 装饰器。您会注意到我的脚本不是那么灵活，而且肯定不在 BNF 中，因为元素对象上可以填充所有成员。也就是说，这是一个开始，它可以解决您的问题。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-03-14T19:21:17.590

你可以这样做：

```
$this->addElement(new Zend_Form_Element_Button(
            'send',
            array(
                'label' => '<span>registrieren</span>',
                'class' => 'button-red',
                'type' => 'submit',
                'escape' => false,
                'required' => false,
                'ignore' => false,
            )
 )); 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-07-06T07:30:21.697

只是逃避标签工作正常。只有当有人开始弄乱标签装饰器时它才会中断（通常在自定义标签时发生）

您可以使用 Zend_Form 函数*setElementDecorators()*并从样式中排除一些元素。阅读[**Zend_Form 手册**](http://framework.zend.com/manual/en/zend.form.forms.html)中的**示例 #3 为某些元素设置装饰器**（包括注释！）以获取更多详细信息。[](http://framework.zend.com/manual/en/zend.form.forms.html)

 **对于那些仍然感到困惑的人，这里有一个示例代码，可以将表单设置为表格，并有一个包含在双跨度中的按钮：

```
//(...)putting some other elements in the form first

//now add submit button 
$form       ->addElement('button', 'submit', array(
                        'label'     => '<span><span>SUBMIT</span></span>', 
                        'value'     => 'submit'
            ));

$form
            //set decorators for non-button elements
            ->setElementDecorators(array(
                    'ViewHelper',
                    'Errors',
                    array(array('data' => 'HtmlTag'), array('tag' => 'td', 'class' => 'element')),
                    array('Label', array('tag' => 'td')),
                    array(array('row' => 'HtmlTag'), array('tag' => 'tr'))), array('submit'), false)
            //and then for button elements only
            ->setElementDecorators(array(
                    'ViewHelper',
                    'Errors',
                    array(array('data' => 'HtmlTag'), array('tag' => 'td', 'class' => 'element')),
                    array(array('row' => 'HtmlTag'), array('tag' => 'tr'))), array('submit'), true)
            //and finally for the form
            ->setDecorators(array(
                    'FormElements',
                    array('HtmlTag', array('tag' => 'table')),
                    'Form'
            )); 
```

其中*$form*是 Zend_Form 元素。希望这可以帮助！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T00:03:20.433

我会为按钮添加一个类，然后在你的 CSS 中定义该类以使其像一个跨度。我敢肯定，你想做的不仅仅是坚持下去。

只需再添加一个 setAttrib() 调用：

```
$submit->setAttrib('class', 'submitButton'); 
```

然后在你的 CSS 中：

```
.submitButton {
   display:inline;
   font-weight:bold; /* Or whatever you're wanting to do */
} 
```

我添加了 display:inline 因为这将使按钮像一个跨度。这至少应该让你开始。当然，您也可以将 CSS 建立在按钮的 id 上，只需使用 display:inline 即可获得跨度行为。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-23T11:28:51.480

尝试

```
$element->addDecorator('Label', array('tag' => 'span', 'class' => 'aClass')) 
```

# asp.net-mvc - 如何对控制器方法的 HandleError 属性的行为进行单元测试？

> ID：778772
> 
> 赞同：7
> 
> 时间：2009-04-22T19:24:05.690
> 
> 标签：asp.net-mvc, nunit, selenium

当发生意外错误时，我正在尝试验证我的 ASP.Net MVC 应用程序的行为。具体来说，我正在尝试验证用户是否被定向到我为我的应用程序定义的错误页面。我遇到的问题是我无法按预期验证控制器方法的行为。

对于我的正常行为测试，我创建了一个模拟业务规则对象并将其传递给我的控制器，然后从我要测试的控制器方法中验证 ViewResult。当事情按预期工作时，这对我的目的来说很好。**但是**，当我从业务规则方法抛出异常时，异常是*通过控制器方法结果*进行的，而不是由控制器处理（控制器方法具有“HandleError”属性），以便为我的错误页面提供适当的 ViewResult被退回。

有没有办法以这种方式验证 HandleError 属性的行为？还是我完全错了？我意识到我可以使用 Selenium（会访问实际服务器的浏览器内测试）来验证实际浏览器中的行为，但是模拟这些测试让我可以更快地完成这项工作，而且开销要少得多......

示例测试代码：

```
// WidgetController.Index() makes a call to GetWidgets to retrieve a 
//  List<Widget> instance.

// this works as expected since the appropriate ViewResult is returned 
//  by the controller
public void TestWidgetControllerIndex_NoResultsFound()
{
    var mockBR = new Mock<IBusinessRules> { CallBase = true };
    mockBR.Setup(br=>fr.GetWidgets()).Returns(new List<Widget>());    
    WidgetController controller = new WidgetController(mockBR.Object);
    ViewResult result = (ViewResult)controller.Index();
    Assert.AreEqual("Index", result.ViewName);
    Assert.AreEqual(0, 
        ((WidgetIndexViewData)result.ViewData.Model).Widgets.Count);
}

// this test is unable to reach the assertion statements due to the problem 
//  outlined above. WidgetController.Index has the HandleError attribute 
//  properly applied and the behaviour via the interface is as expected
public void TestWidgetControllerIndex_BusinessRulesExceptionEncountered()
{
    var mockBR = new Mock<IBusinessRules> { CallBase = true };
    mockBR.Setup(br=>fr.GetWidgets()).Throws<ApplicationException>();    
    WidgetController controller = new WidgetController(mockBR.Object);
    ViewResult result = (ViewResult)controller.Index();
    // The ApplicationException thrown by the business rules object bubbles 
    //  up to the test through the line above. I was expecting this to be 
    //  caught and handled by the HandleError filter (which would then let  
    //  me verify the behaviour results via the assertion below)..
    Assert.AreEqual("Error", result.ViewName);
} 
```

我很感激任何关于我可能做错了什么的建议，或者我是否只是从完全错误的方向来解决这个问题。我假设在控制器方法级别进行测试是合适的方式，因为这是应用 HandleError 属性的地方。（如果我确实需要在应用程序级别进行测试，是否可以通过类似的方式进行测试实例化对象而不是使用像 Selenium 这样的东西？）

*更新* 我得出的结论是，我不应该在每个控制器操作上测试与 HandleError 属性相关的功能。我实际上并不关心它的作用，我只是想确保错误得到处理（从我的测试角度来看，它的自定义代码或 MVC 库是否没有区别，这是我想要验证的功能）。

我最终所做的是将我的控制器操作包装在 try/catch 块中，以强制错误视图作为方法的结果返回（而不是 ErrorHandler 属性在离开方法时捕获错误）。这样我就可以在我的单元测试中断言错误已通过适当的反馈得到正确处理。我对这给我的控制器方法增加的额外长度不太满意，但它确实让我向用户提供了友好的、具体的错误消息（我正在使用扩展方法来显示反馈并执行日志记录）。（所以肯定有 try/catch 方法的优点和缺点..）

我不是 100% 肯定这是最干净的方法，但它实现了我的目标，即能够验证错误是否通过控制器单元测试（快速）而不是必须在浏览器中执行测试（慢） . 所以基本上它现在已经*足够好了*，直到我能找到一个更清洁的解决方案。如果有人遇到类似问题并找到更好的解决方案，我决定提供赏金。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T21:44:49.190

我认为你不能对此进行单元测试。你也不想。您可以测试控制器方法是否引发了预期的异常。使用反射，您可以测试操作或控制器是否具有您期望它具有的属性，并且该属性具有某些预期的属性值。但是，拦截异常和执行属性的工作是框架的行为，而不是您的代码。一般来说，您不应该测试不属于您的代码（框架）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-30T18:36:47.863

是的，我同意蒂姆的观点。您所描述的是集成测试。HandleErrorAttribute 的行为取决于底层的 ASP.NET 行为，例如您是否在 web.config 中打开或关闭了自定义错误。

对于您的单元测试，您可以简单地使用反射来验证属性是否存在。
MVC 团队对 HandleErrorAttribute 进行了单元测试，因此您无需编写这些。:) 然后只需手动测试您的操作以确保这是您想要的行为。只要您从不更改/删除属性，行为就不应该改变。

如果您想自动化集成测试，您可以使用 Watin 或 Selenium 来自动化实际的浏览器请求，以确保您的应用程序行为不会改变。

# c# - 公开受保护字段的最佳方式

> ID：778773
> 
> 赞同：4
> 
> 时间：2009-04-22T19:24:08.793
> 
> 标签：c#, properties, field

我有一个这样的基类：

```
 public class BaseModalCommand
 {

    protected object m_commandArgument;
    protected int m_commandID;
    protected int m_enableUIFlags;

    public virtual void OnIdle()
    {
    }

    public virtual void OnResume()
    {
    }

    public virtual void OnStart(int commandID, object argument)
    {
    }

    public virtual void OnStop()
    {
    }

    public virtual int EnableUIFlags
    {
        get
        {
            return this.m_enableUIFlags;
        }
    }
} 
```

虚拟方法将在派生类型中被覆盖。如果我通过 FxCop 运行它，它会抱怨没有声明可见的实例字段，并建议将其更改为私有并将其公开为受保护的属性。

有什么想法吗？我认为可以忽略此消息。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-22T19:32:05.343

对于任何类，客户端代码都有两种用途：引用您的类的代码和继承您的类的代码。人们普遍认为第二种使用是迄今为止最紧密耦合的。你班级的变化直接影响他们的内部机制。像这样暴露受保护的成员意味着基类中的更改将影响派生类的工作方式，如果不比较每个基类和派生类的代码，则无法预测。同样糟糕的是，您的派生类可以修改基类的内部结构。

如果您真的想像这样公开内部数据成员，请将私有数据成员包装在受保护的属性中（如 gisresearch 建议的那样）。这些属性（以及任何受保护的方法）构成了类的**继承接口**。与暴露给外部客户端的任何接口一样（无论是通过定义公共方法和属性，还是通过显式接口实现），这个接口是您需要管理的，尤其是在较大的代码库中。界面可以更改，但应作为有意识的决定进行更改。

如果直接使用受保护的数据成员，则对基类和派生类之间的依赖关系的控制要少得多。相信我：甚至无法确定更改可能产生的影响可能是一件非常不愉快的事情。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-22T19:31:43.083

作为最佳实践，您的类字段应标记为私有并包含在 getter/setter 属性中

所以而不是

```
protected object m_commandArgument; 
```

采用

```
private object m_commandArgument;

protected object CommandArgument {get; set;} 
```

这样做有几个优点，但一个简单的用法是在你的 setter 中进行异常处理/验证。

例如

```
private string _email;
protected string Email
{ 
   get { return _email; }
   set 
   {
       if(value.IndexOf("@") > 0)
           _email = value;
       else
            throw new ArgumentException("Not a valid Email");
   }
} 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-22T19:27:14.217

FxCop 的建议是合理的。您不想将受保护的字段直接暴露给派生类。由基类管理的状态应该由基类管理——决不能被任何派生类直接修改。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T19:30:51.930

使用属性。将成员变量更改为私有，然后为每个成员变量设置受保护的属性。

问候，
弗兰克

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T19:30:21.917

基本上，FxCop 建议您应该这样做

```
private object m_commandArgument;

protected object CommandArgument
{
   get { return m_commandArgument; }
   set { m_commandArgument =value}
} 
```

这是基于 OO 封装规则（三个 OO 规则之一）。您可能希望在分配**之前**检查该值，并且您希望确保这不是由派生类直接操作的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-22T19:32:12.287

Paul Alexander 是正确的，FxCop 也是如此。

您希望将字段设为私有并通过属性公开它们，以防止派生类自行更改变量。强制它们通过属性使基类有机会验证和/或拒绝任何修改。

# php - 是否可以使用自定义模式拆分文件内容？

> ID：778776
> 
> 赞同：2
> 
> 时间：2009-04-22T19:24:30.387
> 
> 标签：php, regex, parsing, file-get-contents

是否可以将文件的内容拆分为具有特定模式的部分？

这就是我想要实现的目标：

*   使用 file_get_contents 读取文件
*   只读类似评论区域之间的内容。

我不确定这有多复杂，但基本上如果我正在解析一个大的 html 文件并且只想向浏览器显示特定的小部件（模式是注释边界），如下所示：

样本：

```
<html>
<head>
   <title>test</title>
</head>
<body>
 this content should not be parsed.. ignored
 <!-- widget -->
 this is the widget. i want to parse this content only from the file
 <!-- widget -->
</body>
</html> 
```

是否可以使用 php 和 regex 或任何东西来解析边界之间的内容？

我很抱歉，但我试图尽可能多地解释我想要实现的目标。希望有人帮助我。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-22T19:28:22.077

这当然是可能的，但实际上并不需要使用正则表达式来完成。我可能会做这样的事情：

```
$file = file_get_contents('http://example.com/');
$widgets = explode('<!-- widget -->', $file); 
```

`$widget`现在(等)的奇数元素`[1], [3], [5]`包含这些边界之间的内容。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T19:32:39.397

您可以使用正则表达式实现您想要的（或者如果您只是拆分，您可能只使用它）。检查文档。使用explode() 的另一个答案可能也会起作用。

```
$text = file_get_contents('/path/to/your/file');
$array = split('<!-- widget -->', $text); 
```

第一个条目将是第一次出现之前的所有内容`<!-- widget -->`，最后一个元素将是最后一个之后的所有内容`<!-- widget -->`。每个奇数元素都是您要寻找的。

[php拆分函数文档](http://us3.php.net/split)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T19:39:17.010

```
$pattern = "/<!-- widget -->([\s\S]+)<!-- widget -->/";
$match = preg_match_all($pattern,$string,$match_array);

var_dump($match_array); 
```

# linux - 多个进程的文件

> ID：778779
> 
> 赞同：5
> 
> 时间：2009-04-22T19:25:20.477
> 
> 标签：linux, file, operating-system, process

如果我的一个进程打开一个文件，比如说只读，操作系统是否保证在我阅读时没有其他进程会在它上面写，可能会留下旧文件版本的第一部分和第二部分的读取过程较新的文件版本，使数据完整性成问题？

我不是在谈论没有搜索的管道，而是在常规文件上，带有搜索选项（至少在只有一个进程打开时）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T19:34:30.597

不，其他进程可以在您阅读文件时更改文件内容。尝试运行“man fcntl”并**忽略**“advisory”锁部分；这些是“可选”的锁，进程只有在需要时才需要注意。相反，寻找（唉，非POSIX）“强制”锁。**这些**将保护您免受其他程序的侵害。试试读锁。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T19:29:02.637

不，如果您打开一个文件，其他进程可以写入它，除非您使用锁。

在 Linux 上，您可以在文件上添加咨询锁：

```
#include <sys/file.h>

...

flock(file_descriptor,LOCK_EX); // apply an advisory exclusive lock 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-23T12:40:35.760

任何可以打开文件进行写入的进程都可以对其进行写入。写入可以与您自己的写入同时发生，从而导致（可能）不确定的状态。

作为应用程序编写者，您有责任确保不发生坏事。在我看来，强制锁定不是一个好主意。

一个更好的主意是不要授予对您不想写入文件的进程的写入权限。

如果多个进程打开一个文件，它们将拥有独立的文件指针，因此它们可以 seek() 并且不会相互影响。

如果文件由线程程序（或与另一个共享文件描述符的任务，更一般地）打开，文件指针也是共享的，因此您需要使用另一种方法来访问文件以避免竞争条件导致混乱 -通常是 pread、pwrite 或 scatter/gather 函数 readv 和 writev。

# ajax - 我可以将 Orbited 用作动态内容的 HTTP 服务器吗？

> ID：778783
> 
> 赞同：0
> 
> 时间：2009-04-22T19:27:45.633
> 
> 标签：ajax, dynamic, comet, orbited

*Comet Server Orbited 可以从[static]*部分下的配置文件中指定的路径提供静态文件。我想知道是否可以通过轨道提供动态内容？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-30T12:01:21.120

答案是不。

这就是为什么 orbited 通常与 Web 框架（django、rails 等）和标准 Web 服务器配对使用。

# java - javax.comm：设备断开连接时出错

> ID：778789
> 
> 赞同：2
> 
> 时间：2009-04-22T19:28:32.870
> 
> 标签：java, error-handling, javax.comm

我有一个使用 javax.comm 从 com 端口读取数据的应用程序。

我遇到的问题是，如果我正在读取的设备意外断开连接，我会在控制台中收到一条错误消息，显示“WaitCommEvent：错误 5”

我环顾四周，找不到任何有用的信息。我已将所有 notifyOn* 方法设置为 true，所以我认为我应该接收所有事件，但我没有捕捉到这个事件。

打印出来的错误消息不是来自我的代码中的任何地方，因此它必须在 javax.comm 包中的某个地方。谁能告诉我如何处理此错误，以便在发生此错误时可以正确关闭 com 端口？

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-23T14:15:51.180

如果有人对此感兴趣，我找到了解决方案。我使用的是 javax.comm api，但为了解决这个问题，我用 rxtx api ( [http://rxtx.qbang.org/wiki/index.php/Main_Page](http://rxtx.qbang.org/wiki/index.php/Main_Page) ) 替换了它。无需更改代码，但现在当设备断开连接时，我收到一个 IOException 消息“基础输入流返回零字节”。我处理该消息并启动一个新线程。在新线程中，我调用 port.close() 和 port.removeEventListener()。这两个调用必须在新线程中完成，否则应用程序将挂起。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-12-08T16:31:19.997

我们花了很多时间让 javax.comm 工作，并发现在我们的例子中是 COM 驱动程序导致了问题（在几台 Windows 7 计算机上）。如果驱动程序也是您的问题，并且您使用的是 Windows 7 或可能是 Vista（并且您使用的是 Prolific/Logilink 串行电缆），那么这可能是解决方案 :) [http://www.akosta.dk/category/技术说明/](http://www.akosta.dk/category/technical-notes/)

希望你让它工作！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-03-05T15:44:52.430

这个问题已经有将近 2 年的历史了，但也许另一个问题需要一个可能的解决方案：

我对 java.comm 有同样的问题：“WaitCommEvent: Error 5” 如果 COM 端口已断开连接，但 SerialPort 对象未关闭，此消息会出现多次。

我的解决方案是如果 SerialPort 的 IO 流的读/写引发异常，则关闭 SerialPort 对象。

# powershell - 类型化的属性如何显示在 PowerShell 的非类型化 DataTable 中？

> ID：778792
> 
> 赞同：3
> 
> 时间：2009-04-22T19:29:16.160
> 
> 标签：powershell, dataset

以下 PowerShell 代码将 SQL 结果加载到数据集中：

```
$sqlCommand = "SELECT A, B FROM TestTable"
$connection = New-Object System.Data.OleDb.OleDbConnection $connectionString
$command = New-Object System.Data.OleDb.OleDbCommand $sqlCommand,$connection
$connection.Open()
$adapter = New-Object System.Data.OleDb.OleDbDataAdapter $command
$dataset = New-Object System.Data.DataSet
[void] $adapter.Fill($dataSet) 
```

我很惊讶地发现 $dataset.Tables[0].Rows[0].A 有效！我尝试通过管道将该行传递给 Get-Member，并且确实 A 和 B 被列为对象的属性。有谁知道为什么这有效？DataSet 不是从 XSD 生成的。我尝试在 C# 中编写相同的代码行并使用调试器我看不到属性 A 和 B。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T19:41:42.293

这是 PowerShell 扩展类型系统的一部分。对于许多已知类型，例如数据集、XML 文档、COM、AD 和 WMI 对象，PowerShell 会将底层本机对象包装在 PSObject 中，该对象具有非常受欢迎的附加属性。

# c# - 在动画完成时移除 FrameworkElements

> ID：778795
> 
> 赞同：1
> 
> 时间：2009-04-22T19:29:48.983
> 
> 标签：c#, wpf, animation, storyboard, frameworkelement

我一直在通过 Sells/Griffiths 的“Programming WPF”自学 WPF，我发现它是一个很好的资源，但我正在尝试采用他们向我介绍的一些概念并更进一步，我遇到了一个关于如何将各个部分组合在一起以完成我想要做的事情的概念障碍。

在本练习中，我尝试创建自终止动画；`FrameworkElement`由事件创建的 s，执行动画，然后删除自己。我在弄清楚如何`FrameworkElement`从 animation.Completed 事件中回调父级时遇到问题。

我最初只是使用`DoubleAnimation`未包含且不属于`Storyboard`. 从那以后，我添加了`Storyboard`, 并制作了`Storyboard`和 rectangle 资源，以便可以轻松地重用它们。

这是我到目前为止所拥有的：
.xaml：

```
<Window.Resources>
    <Storyboard x:Key="GrowSquare" x:Shared="False">
        <DoubleAnimation Storyboard.TargetProperty="(Canvas.Top)" By="-50" Duration="0:0:2"/>
        <DoubleAnimation Storyboard.TargetProperty="(Canvas.Left)" By="-50" Duration="0:0:2"/>
        <DoubleAnimation Storyboard.TargetProperty="(Ellipse.Width)" By="100" Duration="0:0:2"/>
        <DoubleAnimation Storyboard.TargetProperty="(Ellipse.Height)" By="100" Duration="0:0:2"/>
    </Storyboard>
    <Rectangle x:Key="MyRect" x:Shared="False" Width="20" Height="20">
    </Rectangle>
</Window.Resources>
<Canvas x:Name="myCanvas" MouseMove="myCanvas_MouseMove" Background="White"/> 
```

。CS：

```
public partial class Window1 : Window
    {
        public Window1()
        {
            InitializeComponent();
            lastFire = DateTime.Now;
        }

        DateTime lastFire;

        private void myCanvas_MouseMove(object sender, MouseEventArgs e)
        {
            DateTime nowTime = DateTime.Now;
            TimeSpan T = nowTime.Subtract(lastFire);

            if (T.TotalMilliseconds > 200)
            {
                lastFire = nowTime;
                Random Rand = new Random();

                Rectangle myRect = (Rectangle)FindResource("MyRect");
                myRect.Fill = new SolidColorBrush(Color.FromRgb((byte)Rand.Next(256), (byte)Rand.Next(256), (byte)Rand.Next(256)));
                Point myLoc = e.GetPosition(myCanvas);
                Canvas.SetLeft(myRect, myLoc.X - 10);
                Canvas.SetTop(myRect, myLoc.Y - 10);
                myCanvas.Children.Add(myRect);

                Storyboard SB = (Storyboard)FindResource("GrowSquare");
                SB.Completed += new EventHandler(SB_Completed);
                SB.Begin(myRect);
            }

        }

        void SB_Completed(object sender, EventArgs e)
        {
            myCanvas.Children.RemoveAt(0);
        }
    } 
```

这有效，但不是我想要的方式。由于画布是空的，并且所有动画的长度都相同，因此当动画完成时，它将始终是在画布的第一个子节点上调用的动画。

但是，我想实现花费随机时间的动画，这意味着动画不会总是以相同的顺序开始和结束。不知何故，在 SB_Completed 事件中，我想访问它被调用的控件，但我似乎无法找到它的路径。

有没有办法从调用 SB_Completed 事件的 Media.Animation.ClockGroup 到调用动画的控件？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-28T18:17:17.020

将分配事件处理程序的行更改为此：

```
SB.Completed += (s,e) => myCanvas.Children.Remove(myRect); 
```

# php - 可以删除 php 页面上的扩展名吗？

> ID：778799
> 
> 赞同：2
> 
> 时间：2009-04-22T19:30:25.113
> 
> 标签：php, webpage

当我去一些网站时，我注意到页面上没有文件扩展名。实际上，这个网站就是一个很好的例子。有人知道这是怎么做到的吗？:]

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-22T19:32:05.500

这通常通过[URL 重写](http://www.addedbytes.com/apache/url-rewriting-for-beginners/)来完成（链接到一个很棒的介绍性教程）。

在最简单的情况下，重写规则只是通过在 url 末尾添加“.php”（或任何其他文件扩展名）来重定向每个地址。因此，如果有人试图访问`http://www.yoursite.com/about-me`，他们实际上是在查看来自文件的内容`about-me.php`。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-22T19:39:43.577

这也可以是一个 MVC 框架。（在这里搜索，有很多 php，一个著名的 .NET，我相信很多语言都有很多框架。

这个站点有一个根文件，我们称它为 index.aspx（它不是，但跟我一起去吧），那个文件有特殊的代码来读取更多的 URL。如前所述，与 URL 重写结合使用时，该特殊文件接收通常是路径信息的内容并将其视为变量输入。

[可以删除 php 页面上的扩展名吗？](https://stackoverflow.com/questions/778799/possible-to-remove-extentions-on-php-pages)

是这样的

[https://stackoverflow.com/index.aspx/questions/778799/possible-to-remove-extentions-on-php-pages](https://stackoverflow.com/) **_** _

index.aspx 是通过 URL 重写隐藏的文件。 Questions 是指示控制器的参数， 778799 是参数，其他文本是最终参数。（这被忽略了）

更多见

[http://www.asp.net/mvc/](http://www.asp.net/mvc/)

[http://codeigniter.com/](http://www.codeigniter.com)

[http://en.wikipedia.org/wiki/Model-view-controller](http://en.wikipedia.org/wiki/Model-view-controller)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-22T19:34:08.613

除了 URL 重写之外，您还可以更改 apache 的配置以支持替代文件扩展名，从而允许您执行诸如 MyPHPPage.html 之类的操作。

问候，
弗兰克

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-23T06:38:01.140

使用 mod_rewrite。只需将这样的代码放在根目录下名为 .htaccess 的文件中：

```
RewriteEngine on
RewriteRule ^([^/\.]+)/?([^/\.]+)/?$ index.php?resource_type=$1&id=$2 [QSA,L] 
```

注意 $1 和 $2 如何访问正则表达式括号部分中的两个数量。从这里扩展代码似乎很容易

# embedded - “嵌入式硬件系统”的最佳描述是什么？

> ID：778800
> 
> 赞同：4
> 
> 时间：2009-04-22T19:30:26.627
> 
> 标签：embedded

当我听到这个时，我总是想到移动设备。但为什么硬件“嵌入”在那里？整个设备不就是硬件吗？为什么个人电脑没有嵌入式硬件系统？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T19:33:14.187

在当今世界，嵌入式只是指具有以下一种或多种特征的系统：

*   单一用途（即，不是通用计算机，如您的台式机）
*   固件而不是软件 - 仍然是软件，但不那么容易更新（闪存等）
*   硬件和软件作为一个单元一起设计
*   不同的，也许更严格的测试，因为不需要软件更新
*   实时计算
*   CPU 上集成的内存
*   微控制器而不是微处理器
*   预期的高可靠性（您不必重新启动洗碗机或微波炉）

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-22T19:36:27.080

如果它运行一个程序，但看起来不像一台计算机，那么它就是一个嵌入式系统。

这是我对朋友和家人的标准答案。有太多不同类型的嵌入式系统无法更具体。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-22T19:33:55.260

我在“嵌入式​​”领域工作了一段时间，我们考虑了必须为要嵌入的硬件编写自定义代码的任何事情。

如果您必须解决内存结构，请编写自定义设备驱动程序，并且“直接在金属上”的任何东西通常都是“嵌入的”。

如果您通过串行端口对其进行调试 - 它是嵌入式的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T20:21:27.957

它被称为“嵌入式”，因为计算机是作为更大设备的一部分嵌入的。

嵌入式系统的范围非常广泛。

低端是 8 针 PIC，例如这些[二极管灯中有一个](http://www.ikea.com/us/en/catalog/products/50119407)[12F629](http://www.microchip.com/wwwproducts/Devices.aspx?dDocName=en010113)。这些成本美分，而且内存很少。

LEGO 的 NXT 包含两个控制器，一个相对较大的 AT91SAM7S256 具有 32 位 ARM 内核、256KB 闪存 ROM 和 64KB 的 RAM，以及一个较小的 8 位 ATmega48 和 4KB 闪存。

目前我正在研究用于火车的嵌入式系统，这些系统通常有一个具有数百 MHz 时钟的 PowerPC，大约 100 MB 的 RAM，运行 VxWorks 或 Linux，并通过以太网连接。

我认为还有更强大的电信嵌入式系统，但我还没有研究过这些。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T20:14:56.317

根据维基百科：

> 嵌入式系统是一种 **专用计算机**系统，旨在**执行一个或几个专用功能**，通常具有实时计算约束。它通常作为包括硬件和机械部件在内的完整设备的一部分嵌入。相比之下，通用计算机，例如个人计算机，可以根据编程执行许多不同的任务。
> 
> *   嵌入式系统旨在完成某些特定任务，而不是成为执行多项任务的通用计算机。出于安全性和可用性等原因，有些还具有必须满足的实时性能限制；其他的可能对性能的要求很低或没有，从而可以简化系统硬件以降低成本。
>     
>     
> *   嵌入式系统并不总是独立的设备。许多嵌入式系统由大型设备内的小型计算机化部件组成，用于更通用的用途。例如，Gibson 机器人吉他具有用于调整琴弦的嵌入式系统，但机器人吉他的总体用途当然是播放音乐。 [2] 同样，汽车中的嵌入式系统作为汽车本身的子系统提供特定功能。
>     
>     
> *   为嵌入式系统编写的程序指令称为固件，存储在只读存储器或闪存芯片中。它们在有限的计算机硬件资源下运行：内存小、键盘和/或屏幕小或不存在。

从个人经验来看，如果它是“无头的”（即没有像 VDU 这样的输出设备并依赖于 LED 之类的东西），如果有一个主要用于调试和记录的串行端口，如果你经常使用逻辑分析仪调试，它是嵌入式的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-22T20:49:44.703

“嵌入式”已成为一个非常多样化的术语。

我看过并参与过以下设计：

*   以固定间隔简单地切换离散 I/O（包括 LED）
*   硬件解决方案的驱动程序（例如网络摄像头、无线 com）
*   用作板级 I/O (SPI<->I2C<->Rs232<->USB) 的通信转换器
*   [在此处插入大量设备]
*   人为控制的电子设备（计算器式、电话式）
*   系统级设备来协调其他设备的操作。

我也喜欢上面[Dour-High-Arch](https://stackoverflow.com/users/22437/dour-high-arch)的[评论](https://stackoverflow.com/questions/778800/whats-the-best-description-for-embedded-hardware-system/778819#778819)：

> “另一个重要的区别是嵌入式应用程序可以在没有干预的情况下运行多年......”

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-23T12:53:21.597

“嵌入式系统”是一个非常宽泛的术语，我认为很难有一个单一的定义。“嵌入式”这个词实际上是指一个行业，而不是一个“硬件系统”。多年来，嵌入式系统的描述发生了变化，而且未来肯定也会发生变化。

早期人们会说嵌入式系统只用汇编编程，但现在 C 语言很常见，也许将来也会使用其他语言。CPU 变得越来越大，一直在使用外部存储器，并且它们是许多被认为是嵌入式的设备，它们并不专用于单一任务，可以将应用程序添加到其中，并且可以轻松更新软件。手表、小工具、家用电器、汽车设备、PLC、电机控制器、气象站、系统监控设备都被认为是嵌入式的。很难单独定义它们。

# c++ - 声明类和方法但不声明成员的 C++ 头文件？

> ID：778802
> 
> 赞同：20
> 
> 时间：2009-04-22T19:30:38.793
> 
> 标签：c++, file, class, header, encapsulation

是否可以创建一个 C++ 头文件 (.h) 来声明一个类及其公共方法，但不定义该类中的私有成员？我发现有[几页](http://www.eventhelix.com/realtimemantra/HeaderFileIncludePatterns.htm)说您应该在头文件中声明该类及其所有成员，然后在您的 cpp 文件中单独定义方法。我问是因为我想要一个在 Win32 DLL 中定义的类，并且我希望它被正确封装：该类的内部实现可能会更改，包括其成员，但这些更改不应影响使用该类的代码.

我想如果我有这个，那么编译器就不可能提前知道我的对象的大小。但这应该没问题，只要编译器足够聪明，可以使用构造函数，并且只传递指向内存中存储对象的位置的指针，并且永远不要让我运行“sizeof(MyClass)”。

**更新：** 感谢所有回答的人！似乎 pimpl 成语是实现我所说的一个好方法。我要做类似的事情：

我的 Win32 DLL 文件将有一堆单独的函数，如下所示：

```
void * __stdcall DogCreate();
int __stdcall DogGetWeight(void * this);
void __stdcall DogSetWeight(void * this, int weight); 
```

这是微软编写 DLL 文件的典型方式，所以我认为这可能是有充分理由的。

但我想利用 C++ 对类的良好语法，所以我将编写一个包装类来包装所有这些函数。它将有一个成员，即“void * pimpl”。这个包装类将非常简单，我不妨声明它并在头文件中定义它。但据我所知，这个包装类除了让 C++ 代码看起来很漂亮之外真的没有其他目的。

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-04-22T19:42:42.370

我认为您正在寻找的是一种叫做“pimpl idiom”的东西。要了解这是如何工作的，您需要了解在 C++ 中您可以转发声明类似的内容。

```
class CWidget; // Widget will exist sometime in the future
CWidget* aWidget;  // An address (integer) to something that 
                   // isn't defined *yet*

// later on define CWidget to be something concrete
class CWidget
{
     // methods and such 
}; 
```

因此，前向声明意味着承诺稍后完全声明一个类型。它的说法是“我保证会有一个叫做 CWidget 的东西。我稍后会告诉你更多关于它的信息。”。

前向声明的规则说，您可以定义一个指针或对已前向声明的东西的引用。这是因为指针和引用实际上只是地址——这个尚未定义的东西所在的数字。能够在不完全声明的情况下声明指向某事物的指针很方便，原因有很多。

它在这里很有用，因为您可以使用它来隐藏使用“pimpl”方法的类的一些内部结构。Pimpl 的意思是“指向实现的指针”。因此，您有一个实际实现的类，而不是“小部件”。您在标题中声明的类只是对 CImpl 类的传递。以下是它的工作原理：

```
// Thing.h

class CThing
{
public:
    // CThings methods and constructors...
    CThing();
    void DoSomething();
    int GetSomething();
    ~CThing();
private:
    // CThing store's a pointer to some implementation class to 
    // be defined later
    class CImpl;      // forward declaration to CImpl
    CImpl* m_pimpl;  // pointer to my implementation
}; 
```

Thing.cpp 将 CThing 的方法定义为对 impl 的传递：

```
// Fully define Impl
class CThing::CImpl
{
private:
     // all  variables
public:
     // methods inlined
     CImpl()
     {
          // constructor
     }

     void DoSomething()
     {
          // actual code that does something
     }
     //etc for all methods     
};

// CThing methods are just pass-throughs
CThing::CThing() : m_pimpl(new CThing::CImpl());
{
}  

CThing::~CThing()
{
    delete m_pimpl;
}

int CThing::GetSomething()
{
    return m_pimpl->GetSomething();
}

void CThing::DoSomething()
{
    m_impl->DoSomething();
} 
```

多田！你已经在你的 cpp 中隐藏了所有的细节，你的头文件是一个非常整洁的方法列表。这是一件很棒的事情。您可能会看到与上面的模板唯一不同的是人们可能会使用 boost::shared_ptr<> 或其他智能指针来实现 impl。自我删除的东西。

另外，请记住，这种方法会带来一些烦恼。调试可能有点烦人（额外的重定向级别以逐步执行）。创建一个类也有很多开销。如果你为每节课都这样做，你会厌倦所有的打字:)。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-04-22T19:35:37.707

使用[**pimpl**](http://www.gotw.ca/gotw/024.htm)成语。[](http://www.gotw.ca/gotw/024.htm)

 *** * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-22T21:53:49.090

pimpl[习惯用法](http://www.gotw.ca/gotw/024.htm)为你的类添加了一个 void* 私有数据成员，如果你需要一些快速和肮脏的东西，这是一种有用的技术。然而，它有它的缺点。其中主要是它使得在抽象类型上使用多态变得困难。有时您可能需要一个抽象基类和该基类的子类，收集指向向量中所有不同类型的指针并调用它们的方法。此外，如果 pimpl 习惯用法的目的是隐藏类的实现细节，那么它**几乎**成功了：指针本身就是一个实现细节。也许是一个不透明的实现细节。但仍然是一个实现细节。

存在 pimpl 习惯用法的替代方法，可用于从接口中删除所有实现细节，同时提供可在需要时多态使用的基本类型。

在您的 DLL 的头文件（客户端代码中的#included）中创建一个抽象类，其中只有公共方法和概念，这些方法和概念指示如何实例化该类（例如，公共工厂方法和克隆方法）：

**狗窝**

```
/****************************************************************
 ***
 ***    The declaration of the kennel namespace & its members
 ***    would typically be in a header file.
 ***/

// Provide an abstract interface class which clients will have pointers to.
// Do not permit client code to instantiate this class directly.

namespace kennel
{
    class Animal
    {
    public:
        // factory method
        static Animal* createDog(); // factory method
        static Animal* createCat(); // factory method

        virtual Animal* clone() const = 0;  // creates a duplicate object
        virtual string speak() const = 0;   // says something this animal might say
        virtual unsigned long serialNumber() const = 0; // returns a bit of state data
        virtual string name() const = 0;    // retuyrns this animal's name
        virtual string type() const = 0; // returns the type of animal this is

        virtual ~Animal() {};   // ensures the correct subclass' dtor is called when deleteing an Animal*
    };
}; 
```

...Animal 是一个[抽象基类](http://www.parashift.com/c++-faq-lite/abcs.html)，因此无法实例化；不需要声明私有 ctor。虚拟 dtor 的存在确保如果有人`delete`s an `Animal*`，也会调用正确的子类的 dtor。

为了实现基类型的不同子类（例如狗和猫），您将在 DLL 中声明实现级类。这些类最终派生自您在头文件中声明的抽象基类，工厂方法实际上会实例化这些子类之一。

**dll.cpp：**

```
/****************************************************************
 ***
 ***    The code that follows implements the interface
 ***    declared above, and would typically be in a cc
 ***    file.
 ***/   

// Implementation of the Animal abstract interface
// this implementation includes several features 
// found in real code:
//      Each animal type has it's own properties/behavior (speak)
//      Each instance has it's own member data (name)
//      All Animals share some common properties/data (serial number)
//

namespace
{
    // AnimalImpl provides properties & data that are shared by
    // all Animals (serial number, clone)
    class AnimalImpl : public kennel::Animal    
    {
    public:
        unsigned long serialNumber() const;
        string type() const;

    protected:
        AnimalImpl();
        AnimalImpl(const AnimalImpl& rhs);
        virtual ~AnimalImpl();
    private:
        unsigned long serial_;              // each Animal has its own serial number
        static unsigned long lastSerial_;   // this increments every time an AnimalImpl is created
    };

    class Dog : public AnimalImpl
    {
    public:
        kennel::Animal* clone() const { Dog* copy = new Dog(*this); return copy;}
        std::string speak() const { return "Woof!"; }
        std::string name() const { return name_; }

        Dog(const char* name) : name_(name) {};
        virtual ~Dog() { cout << type() << " #" << serialNumber() << " is napping..." << endl; }
    protected:
        Dog(const Dog& rhs) : AnimalImpl(rhs), name_(rhs.name_) {};

    private:
        std::string name_;
    };

    class Cat : public AnimalImpl
    {
    public:
        kennel::Animal* clone() const { Cat* copy = new Cat(*this); return copy;}
        std::string speak() const { return "Meow!"; }
        std::string name() const { return name_; }

        Cat(const char* name) : name_(name) {};
        virtual ~Cat() { cout << type() << " #" << serialNumber() << " escaped!" << endl; }
    protected:
        Cat(const Cat& rhs) : AnimalImpl(rhs), name_(rhs.name_) {};

    private:
        std::string name_;
    };
};

unsigned long AnimalImpl::lastSerial_ = 0;

// Implementation of interface-level functions
//  In this case, just the factory functions.
kennel::Animal* kennel::Animal::createDog()
{
    static const char* name [] = {"Kita", "Duffy", "Fido", "Bowser", "Spot", "Snoopy", "Smkoky"};
    static const size_t numNames = sizeof(name)/sizeof(name[0]);

    size_t ix = rand()/(RAND_MAX/numNames);

    Dog* ret = new Dog(name[ix]);
    return ret;
}

kennel::Animal* kennel::Animal::createCat()
{
    static const char* name [] = {"Murpyhy", "Jasmine", "Spike", "Heathcliff", "Jerry", "Garfield"};
    static const size_t numNames = sizeof(name)/sizeof(name[0]);

    size_t ix = rand()/(RAND_MAX/numNames);

    Cat* ret = new Cat(name[ix]);
    return ret;
}

// Implementation of base implementation class
AnimalImpl::AnimalImpl() 
: serial_(++lastSerial_) 
{
};

AnimalImpl::AnimalImpl(const AnimalImpl& rhs) 
: serial_(rhs.serial_) 
{
};

AnimalImpl::~AnimalImpl() 
{
};

unsigned long AnimalImpl::serialNumber() const 
{ 
    return serial_; 
}

string AnimalImpl::type() const
{
    if( dynamic_cast<const Dog*>(this) )
        return "Dog";
    if( dynamic_cast<const Cat*>(this) )
        return "Cat";
    else
        return "Alien";
} 
```

现在您已经在标头中定义了接口，并且实现细节完全分开，客户端代码根本看不到它。您可以通过从链接到 DLL 的代码调用头文件中声明的方法来使用它。这是一个示例驱动程序：

**主.cpp：**

```
std::string dump(const kennel::Animal* animal)
{
    stringstream ss;
    ss << animal->type() << " #" << animal->serialNumber() << " says '" << animal->speak() << "'" << endl;
    return ss.str();
}

template<class T> void del_ptr(T* p)
{
    delete p;
}

int main()
{
    srand((unsigned) time(0));

    // start up a new farm
    typedef vector<kennel::Animal*> Animals;
    Animals farm;

    // add 20 animals to the farm
    for( size_t n = 0; n < 20; ++n )
    {
        bool makeDog = rand()/(RAND_MAX/2) != 0;
        if( makeDog )
            farm.push_back(kennel::Animal::createDog());
        else
            farm.push_back(kennel::Animal::createCat());
    }

    // list all the animals in the farm to the console
    transform(farm.begin(), farm.end(), ostream_iterator<string>(cout, ""), dump);

    // deallocate all the animals in the farm
    for_each( farm.begin(), farm.end(), del_ptr<kennel::Animal>);

    return 0;
} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-22T19:34:54.587

谷歌“疙瘩成语”或“处理 C++”。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-22T19:35:35.367

是的，这可能是一件值得做的事情。一种简单的方法是使实现类从头文件中定义的类派生。

缺点是编译器不知道如何构造你的类，所以你需要某种工厂方法来获取类的实例。堆栈上不可能有本地实例。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-23T22:19:01.163

您必须在标头中声明所有成员，以便编译器知道对象有多大等等。

但是你可以通过使用一个接口来解决这个问题：

分机：

```
class ExtClass
{
public:
  virtual void func1(int xy) = 0;
  virtual int func2(XYClass &param) = 0;
}; 
```

诠释.h：

```
class ExtClassImpl : public ExtClass
{
public:
  void func1(int xy);
  int func2(XYClass&param);
}; 
```

诠释.cpp：

```
 void ExtClassImpl::func1(int xy)
  {
    ...
  }
  int ExtClassImpl::func2(XYClass&param)
  {
    ...
  } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-22T19:38:03.643

> 是否可以创建一个 C++ 头文件 (.h) 来声明一个类及其公共方法，但不声明该类中的私有成员？

最接近的答案是 PIMPL 成语。

请参阅Herb Sutter[的 The Fast Pimpl Idiom](http://www.gotw.ca/gotw/028.htm)。

IMO Pimpl 在开发的初始阶段非常有用，您的头文件将多次更改。Pimpl 有它的成本，因为它在堆上分配\释放内部对象。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2009-04-22T19:38:00.120

查看C++ 中的[The Handle-Body Idiom 类](http://www.cs.helsinki.fi/u/vihavain/s00/cpp/idioms.html#handle)

# jquery - jquery $.post 获取方法返回的字符串

> ID：778808
> 
> 赞同：2
> 
> 时间：2009-04-22T19:32:01.193
> 
> 标签：jquery, asp.net-mvc, ajax

我的页面上有一个简单的表单，带有一个调用此 javascript 方法的文本框和按钮

```
onclick="Create();" 
```

这是运行的功能...

```
function Create() {
    var txt = document.getElementById("longTxt").value;

    if (txt == "Insert Name") {
        alert("You must provide a name");
        return;
    }

    var data = { Name: txt };
    $.post("/Home/Create", data, null, "json");
} 
```

调用的操作将名称插入数据库并返回一个字符串。

该方法有效，它将发布的名称添加到我的数据库中，但是我如何使用我的方法返回的字符串在我的文本框中显示返回的字符串。

编辑：

我的方法是什么假设看起来像我有类似的东西

```
 [AcceptVerbs(HttpVerbs.Post)]
    public JsonResult Create(string name)
    {
        string hash = repo.addName(name);
        return new JsonResult()
        {
            Data = new { data = hash }
        };

    } 
```

当我添加断点并检查它看起来它正在工作时它确实添加了名称。使用回调函数是因为我替换了

```
$("#longUrl").val(json.PropertyReturned); 
```

带有警报（json.PropertyReturned）；看看是否有任何事情发生，我得到了文本框，但它说“未定义”

我对这一切真的很陌生，也许我只是在做这个方法并返回错误。在键入“json”后弹出时，intelisense 也不会显示“json.PropertyReturned”作为选项。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T19:38:55.297

提供一个回调作为 post 调用的第三个参数，它将获取从方法返回的值并将其放入您的文本框中。

```
$.post("/Home/Create", data, function(json,textStatus) {
    $("#longTxt").val( json.data );
},"json"); 
```

如果你还需要处理错误，你可能想看看使用 $.ajax()。

**编辑**：您可能应该使用控制器的 Json 方法，而不是使用默认构造函数构造结果。它更方便。

```
return Json( new { data = hash } ); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T19:39:25.200

我认为第三个参数是回调函数。而不是一个空值，在那里传递一个函数名。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T19:39:43.530

```
$.post("/Home/Create", data, function(data) {
    $("#textboxid").val(data.PropertyName);}, "json") 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-23T04:03:45.503

提供回调，或将异步设置为 false。

# c# - 如何确定我的应用程序的先前实例是否正在运行？

> ID：778817
> 
> 赞同：27
> 
> 时间：2009-04-22T19:32:55.967
> 
> 标签：c#, .net

我有一个 C# 控制台应用程序，我在其中运行各种神秘的自动化任务。我很清楚这应该是真正的**Windows 服务**，因为它需要连续运行，但我**现在不想**这样做。（所以，不要建议作为答案）。

同时，我需要一些示例 C# 代码来确定是否已经有一个应用程序实例正在运行。

在旧的 VB6.0 时代，我会使用`App.PrevInstance()`

我希望能够在我的 Main 方法中执行此操作：

```
static void Main()
{
  if(!MyApp.IsAlreadyRunning())
  {
    while(true)
    {
      RockAndRollAllNightAndPartyEveryDay();
    }
  }
} 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2010-03-10T09:12:43.427

为此目的使用互斥锁的正确方法：

```
private static Mutex mutex;

static void Main()
{
    // STEP 1: Create and/or check mutex existence in a race-free way
    bool created;
    mutex = new Mutex(false, "YourAppName-{add-your-random-chars}", out created);
    if (!created)
    {
        MessageBox.Show("Another instance of this application is already running");
        return;
    }

    // STEP 2: Run whatever the app needs to do
    Application.Run(new Form1());

    // No need to release the mutex because it was never acquired
} 
```

以上方法不适用于检测同一台机器上的多个用户是否在不同的用户帐户下运行该应用程序。类似的情况是一个进程既可以在服务主机下运行*，*也*可以*独立运行。要使这些工作，请按如下方式创建互斥锁：

```
 var sid = new SecurityIdentifier(WellKnownSidType.WorldSid, null);
        var mutexsecurity = new MutexSecurity();
        mutexsecurity.AddAccessRule(new MutexAccessRule(sid, MutexRights.FullControl, AccessControlType.Allow));
        mutexsecurity.AddAccessRule(new MutexAccessRule(sid, MutexRights.ChangePermissions, AccessControlType.Deny));
        mutexsecurity.AddAccessRule(new MutexAccessRule(sid, MutexRights.Delete, AccessControlType.Deny));
        _mutex = new Mutex(false, "Global\\YourAppName-{add-your-random-chars}", out created, mutexsecurity); 
```

这里有两个区别 - 首先，需要使用允许其他用户帐户打开/获取它的安全权限来创建互斥锁。其次，如果服务运行在服务主机下（不确定其他用户在同一台​​机器上本地运行） ，名称*必须以“全局”为前缀。*

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-22T19:55:45.740

Jeroen 已经回答了这个问题，但到目前为止最好的方法是使用互斥锁......而不是通过进程。这是带有代码的更完整的答案。

在看到一些关于竞争条件的评论后，我更新了这个答案，通过使用[Mutex 构造函数来解决这个问题](https://docs.microsoft.com/en-us/dotnet/api/system.threading.mutex.-ctor?view=net-5.0#System_Threading_Mutex__ctor_System_Boolean_System_String_System_Boolean__)

```
Boolean createdNew;
Mutex mutex;

try
{      
   mutex = new Mutex(false, "SINGLEINSTANCE" out createdNew);
   if (createdNew == false)
   {
      Console.WriteLine("Error : Only 1 instance of this application can run at a time");
      Application.Exit();
   }

   // Run your application
}
catch (Exception e)
{
    // Unable to open the mutex for various reasons
}
finally 
{
    // If this instance created the mutex, ensure that
    // it's cleaned up, otherwise we can't restart the
    // application
    if (mutex && createdNew) 
    {
        mutex.ReleaseMutex();
        mutex.Dispose();
    }
} 
```

注意`try{} finally{}`块。如果您的应用程序崩溃或干净退出，但您没有释放 Mutex，那么您以后可能无法再次重新启动它。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-22T19:39:36.980

最简单（也是最可靠）的方法是使用互斥锁。使用 Mutex 类的 WaitOne 方法等待互斥锁可用。一个额外的优势，这不需要任何无限循环

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T19:39:07.463

您可以搜索现有系统进程的进程名称。示例代码，[请参阅此博客文章。](http://rajeshkm.blogspot.com/2006/07/previous-instance-of-application-in-c.html)

您还可以使用命名系统 Mutex 来查看您的进程是否已经在运行。
[这是一些示例代码。](http://kristofverbiest.blogspot.com/2008/11/creating-single-instance-application.html) 根据我的经验，这往往更可靠，并且代码更简单、更易于理解。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-22T19:41:31.343

这篇文章谈论它：[防止第二个流程实例运行](http://www.devx.com/vb2themax/Tip/18770)。它在 VB.net 中，但您可以转换它。

> 编写一个检查当前应用程序是否已经运行的通用函数的问题来自于**Process 对象的 ProcessName 属性似乎被限制为 15 个字符**，因此较长的进程名称被截断。

> **检索进程名称的更安全方法**是获取其主模块的文件名并删除扩展名。以下可重用例程使用此方法：

```
 Function AppIsAlreadyRunning() As Boolean
    ' get the filename of the main module
    Dim moduleName As String = Process.GetCurrentProcess.MainModule.ModuleName

    ' discard the extension to get the process name
    Dim procName As String = System.IO.Path.GetFileNameWithoutExtension(moduleName)

    ' return true if there are 2 or more processes with that name
    If Process.GetProcessesByName(procName).Length > 1 Then
        Return True
    End If
End Function 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-22T20:23:01.523

```
 // Allow running single instance
    string processName = Process.GetCurrentProcess().ProcessName;
    Process[] instances = Process.GetProcessesByName(processName);

    if (instances.Length > 1)
    {
        MessageBox.Show("Application already Running", "Error 1001 - Application Running");
        return;
    } 
```

如果应用程序已经在运行，则使用消息框优雅地退出应用程序，如上所示

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-22T19:38:30.523

您可以`Process.GetProcessesByName("MyProcessName");`在`System.Diagnostics`命名空间中使用来检查您的进程的实例是否正在运行。

编辑：评论中的观察非常好！这是一种（非常）简单的方法，当然不会涵盖所有基础。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-23T15:54:48.763

使用内核对象是在 Windows 中实现单实例保护的唯一正确方法。

这个说法：

mutex = Mutex.OpenExisting("SINGLEINSTANCE");

如果其他人从 Stackoverflow 复制这一行并在您的程序之前运行他们的程序，则将无法工作，因为其他人在您之前抓住了“SINGLEINSTANCE”。您想在互斥锁名称中包含 GUID：

mutex = Mutex.OpenExisting("MyApp{AD52DAF0-C3CF-4cc7-9EDD-03812F82557E}");

这种技术将阻止当前用户运行您的程序的多个实例，但不会阻止另一个用户这样做。

要确保只有一个应用程序实例可以在本地计算机上运行，​​您需要执行以下操作：

mutex = Mutex.OpenExisting("Global\MyApp{AD52DAF0-C3CF-4cc7-9EDD-03812F82557E}");

请参阅 CreateMutex api 的帮助。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-22T19:46:48.443

在我的一个项目中，我使用[了 SingleInstance Component](http://www.codeproject.com/KB/dialog/SingleInstanceComponent.aspx)

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2009-04-22T20:23:52.333

另一种方法是绑定到本地机器上的地址（就像 TCP 侦听器一样）。一次只有一个进程可以绑定到端口/地址组合。因此，在环回适配器上选择一个端口并使用它。

这有很好的副作用：

*   即使有人重命名可执行文件也能工作
*   应用程序崩溃时自行重置
*   该技术可跨其他操作系统移植

不利的一面是，如果有另一个应用程序绑定到该特定端口，它可能会失败。

* * *

根据要求，下面是一些绑定到地址/端口的代码。这是从别的东西上扯下来的。它不完整，但必要的位在这里。

```
using System.Net;
using System.Net.Sockets;

[...]

// Make up a number that's currently unused by you, or any 
// well-known service. i.e. 80 for http, 22 for ssh, etc..
int portNum = 2001;  

// This binds to any (meaning all) adapters on this system 
IPAddress ipAddress = IPAddress.Any;
IPEndPoint localEndPoint = new IPEndPoint(ipAddress, portNum);
Socket listener = new Socket(AddressFamily.InterNetwork,
    SocketType.Stream, ProtocolType.Tcp );

// The next statement will throw an exception if anyone has done this Bind!
listener.Bind(localEndPoint); 
```

只要侦听器没有被垃圾收集（超出范围）或程序没有终止：该适配器上的端口是您的，并且只有您的。如果发生任何事情，`listener`那么它就可以供其他人使用。出于锁定的目的，您可能应该`listener`在某处是静态的。

# javascript - jQuery 插件事件只触发一次

> ID：778858
> 
> 赞同：1
> 
> 时间：2009-04-22T19:40:13.030
> 
> 标签：javascript, jquery, plugins

我正在使用 jQuery 为网站制作一个非常简约的日历插件。我对它没有太多经验，所以我正在关注插件教程。我有两个`<a>`链接应该更改月份，但不幸的是它们只更改了一次，然后它们都停止工作。我怀疑我把事件放到了错误的地方。

很抱歉代码非常混乱，这只是一个蓝图。

这是javascript。

```
(function($){    
    $.fn.extend({
        jSimpleCalendar : function(currentDate)
        {

            return this.each(
                function()
                {               

                    obj = $(this);

                    result = renderCalendar(currentDate);   

                    obj.html(result);

                                        // Event handlers
                    $('#JQSCMonthPrev').click(function ()
                    {
                        currentDate.setMonth(currentDate.getMonth() - 1);
                        result = renderCalendar(currentDate);

                        obj.html(result);

                    });
                                        $('#JQSCMonthNext').click(function ()
                    {
                        currentDate.setMonth(currentDate.getMonth() + 1);
                        result = renderCalendar(currentDate);

                        obj.html(result);

                    });

                });

            function renderCalendar(date)
            {
                // Get the calendar
                calendar = createMonthArray(date);

                // Build xhtml
                var result = '<table class="jQSCTable">';               

                result += '<thead><tr><td colspan=4><a href="#" id="JQSCMonthPrev">&lt;</a> <a href="">' + getMonthNames()[date.getMonth()] + '</a> <a href="#" id="JQSCMonthNext">&gt;</a></td>';
                result += '<td colspan=3><a href="#" id="JQSCYearPrev">&lt;</a> <a href="">' + date.getFullYear() + '</a> <a href="#" id="JQSCYearNext" >&gt;</a></td></tr></thead><tbody>';

                for(i=0;i<(calendar.length);i++)
                {
                    result += '<tr>';
                    for (a=1; a<=7; a++)
                    {
                        result += '<td>';
                        if(calendar[i][a]!='N')
                        {
                            result += '<a id="JQSCLink' + calendar[i][a] + '">' + calendar[i][a] + '</a>';
                        }
                        result += '</td>';
                    }
                    result += '</tr>';
                }
                result += '</tbody></table>';   

                return result;          

            };  

            function createMonthArray(date)
            {
                // Get first day of month
                date.setDate(1);

                // Make callendar
                var calendar = new Array();

                // Fill empty shit from previous month
                for(i=0;i<date.getDay()-1;i++)
                    calendar.push('N');

                // Get number of days
                var numberOfDays = getNumberOfDaysMonth(date);

                //Fill the rest
                for(i=1;i<numberOfDays+1;i++)
                    calendar.push(i);               

                // Get number of end days
                var endDays = calendar.length % 7 - 1;

                //Fill the empty stuff at the end
                for(i=0;i<7-endDays;i++)
                    calendar.push('N');         

                //Slice to seven pieces
                var slicedCalendar = new Array();
                var week = 0;
                slicedCalendar[0] = new Array();
                for(i=1;i<calendar.length;i++)
                {
                    slicedCalendar[week][i-week*7] = calendar[i-1];
                    if (((i%7)==0)&&(i!=0))
                    {
                        week++;
                        slicedCalendar[week] = new Array();
                    }
                }
                return slicedCalendar.splice(0, week);

            };      

            function getNumberOfDaysMonth(date)
            {
                var minDays = 28;
                var dateFound = false;          
                var oldMonth = date.getMonth();
                var workDate = new Date(date.getYear(), date.getMonth(), 1);

                while (!dateFound)
                {
                    workDate.setDate(minDays+1);                
                    var newMonth = workDate.getMonth();//new month date 

                    if (newMonth != oldMonth)//if the month has changed
                        dateFound = true;
                    else
                        minDays++;
                }

                return minDays;         

            }   

            // Month names
            function getMonthNames()    
            {
                var month = Array();
                month[0] = 'January';
                month[1] = 'February';
                month[2] = 'March';
                month[3] = 'April';
                month[4] = 'May';
                month[5] = 'June';
                month[6] = 'July';
                month[7] = 'August';
                month[8] = 'September';
                month[9] = 'Octorber';
                month[10] = 'November';
                month[11] = 'December';

                return month;
            }       

        }
    });         
})(jQuery); 
```

这是html测试。

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
   "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <script type="text/javascript" src="js/jquery-1.3.2.min.js"></script>
        <script type="text/javascript" src="js/jSimpleCalendar.js"></script>
        <script type="text/javascript">
            $(document).ready(function(){
                $("#calendar").jSimpleCalendar(new Date());
            });
        </script>
    </head>
    <body>
        <div id="calendar">
        </div>      
    </body>
</html> 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-22T19:55:11.060

似乎正在发生的事情是当您第一次单击时正在重写 HTML。发生这种情况时，点击事件不再绑定到 href，因为旧元素已从 DOM 中删除。

您可以将点击事件放入它自己的函数中，并在重建日历或使用事件委托后调用该函数。为此，在#calendar div 上附加点击事件并跟踪点击了哪个元素。

[http://www.learningjquery.com/2008/03/working-with-events-part-1](http://www.learningjquery.com/2008/03/working-with-events-part-1)

# c# - 如何覆盖列表 .IsReadOnly 在 C# 中

> ID：778860
> 
> 赞同：0
> 
> 时间：2009-04-22T19:40:31.877
> 
> 标签：c#, properties, overriding, readonly

我试图从 List 派生并有选择地打开和关闭*IsReadOnly*属性。我希望 Add/Remove/[] 函数会尊重这个属性，但他们没有。这样做的正确方法是什么？

我的派生类有一些额外的属性，所以很遗憾我不能将列表包装在 ReadOnlyCollection 中。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T19:43:39.467

在这种情况下使用封装而不是继承。

你应该让你的类实现 IList<T>，并有一个私有的 List<T> 变量。

你可以通过任何你想要的函数，也可以完全覆盖它们，改变行为等。这给了你完全的控制权（代价是有很多方法除了调用 this.List.method(...) 之外什么都不做） .

一般来说，我认为在任何情况下从 BCL 集合类继承都不是一个好主意。我更喜欢让它们成为我班级内部的实现细节。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T19:42:34.523

您可以调用 list 上的“AsReadOnly”方法，该方法应该返回给您一个 IList 实例，该实例应该尊重它是...错误...只读的。

...好吧，我刚刚读了你的最后一句话，我的错。在这种情况下，您可能只想实现 IList 接口或任何朋友，并将大部分接口路由到您在内部保留的列表。然后你可以建立这种行为。即便如此，我会做一个类似的模式，提供一些“AsReadOnly”方法，明确地给你一些只读的东西。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T19:43:56.157

List<T> 根据定义是可变类型。没有办法让它只读。

如果您正在创建派生类，则可能应该直接实现 IList<T> 而不是子类化 List<T> 。这将使您可以完全控制实施，如果您愿意，可以将其设为只读。

# java - 将对象转换为 HashMap

> ID：778862
> 
> 赞同：1
> 
> 时间：2009-04-22T19:40:57.287
> 
> 标签：java, object, hashmap

我无法弄清楚如何计算 HashMap 中的值实例。我已经看到 Object 类附加了一些方法，它们看起来好像可以帮助我，所以我试图将它们投入使用，但我一定在某处做错了。

如果有更简单的方法，我还没有找到。*注意：图书馆是我的 HashMap。*

```
public void borrowBooks(String id, String name, String sid, String sname) {
    if((getKeyFromValue(Books, name).equals(id))&&(getKeyFromValue(Students, sname).equals(sid))){
        if((Object)Library.countValues(sid)!=5){
            Library.put(id, sid);
        }
        else{
            System.out.println("You have exceeded your quota. Return a book before you take one out." );
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T19:50:41.383

你在看哪个文档？Hashmap的[Javadoc](http://java.sun.com/javase/6/docs/api/java/util/HashMap.html)没有指定 countValues() 方法。

我认为您想要一个`HashMap<String, List<String>>`，因此您可以存储每个学生的书籍列表（如果我正确阅读了您的代码）。

您必须为每个学生创建一个列表并将其放入 HashMap，然后您可以使用 List.size() 简单地计算列表中的条目。

例如

```
if (Library.get(id) == null) {
   Library.put(id, new ArrayList<String>());
}
List<String> books = Library.get(id);
int number = books.size() // gives you the size 
```

忽略线程等。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-22T19:54:32.480

**第一：（**几乎[）]向`Object`. 由于一切都 extends `Object`，您可以随时访问方法而无需强制转换。

**第二：**您投射的方式实际上是投射返回值，而不是库。如果你正在做一个真正必要的演员表，你将需要一组额外的括号：

```
if(((Object)Library).countValues(sid) != 5) 
```

**第三：** or中没有`countValues`方法。你必须自己做。`HashMap``Object`

这是使用的一般算法（我很犹豫发布代码，因为这看起来像家庭作业）：

```
initialize count to 0
for each entry in Library:
    if the value is what you want:
        increment the count 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T20:00:22.843

```
int count = 0;

for(String str : Library.values())
{
    if(str == sid)
        count++;
    if(count == 5)
        break;
}

if(count < 5)
    Library.put(id, sid);
else
    System.out.println("You have exceeded your quota. Return a book before you take one out." ); 
```

# sql - SQL连接字符串？

> ID：778863
> 
> 赞同：2
> 
> 时间：2009-04-22T19:41:10.610
> 
> 标签：sql, sql-server

我有一个查询，它接受最终用户的输入并将其分别与 2 列进行比较，并将两列连接起来。

```
SELECT f_name, l_name, (f_name + ' ' + l_name) AS full_name
FROM users_table
WHERE f_name = user-input
   OR l_name = user-input
   OR 'full_name' = user-input 
```

请原谅大量语法失败，但我向您保证它在程序中是正确的。

它是用 PHP 编写的，用于查询 SQL SERVER 2005 数据库，并且不区分大小写。

键入一个名称（名字或姓氏）将返回正确的结果，但首先键入，然后是空格，然后是最后一个，返回一个空集。

有任何想法吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-22T19:44:59.977

那是因为 'full_name' 是文字而不是列名，它在 WHERE 子句级别不存在

你需要添加

```
OR f_name + ' ' + l_name = user-input 
```

而不是 OR 'full_name' = 用户输入

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-22T19:54:14.197

在“授人以渔”的理论下...

您不能在 where 或 group by 子句中使用列别名。您可以在 order by 子句中使用它。要以您想要的方式使用列别名，您必须执行类似...

```
SELECT [Full Name] FROM
  (SELECT f_name, l_name, f_name + ' ' + l_name AS [Full Name]
   FROM users_table)
  WHERE [Full_Name] = @paramVal 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T19:45:53.017

'full_name' 是文字字符串而不是列...

(f_name + ' ' + l_name) = 用户输入

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T19:47:21.237

尝试：

```
SELECT f_name, 
       l_name, 
       (f_name + ' ' + l_name) AS full_name
FROM users_table
WHERE f_name = user-input
   OR l_name = user-input
   OR f_name + ' ' + l_name = user-input 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T19:54:23.683

这将起作用：

```
SELECT *
FROM users_table
WHERE CONCAT(first_name,' ',last_name) = user-input; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-22T19:45:02.020

对于初学者，请删除最后一个 where 条件中 full_name 周围的单引号。现在将用户输入与字符串文字“full_name”进行比较。

连接部分应该是好的！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-22T19:46:09.087

问题出在这一行：

```
OR 'full_name' = user-input 
```

如果这实际上是您写下的内容，您正在将*文字字符串“full_name”*与提供的输入进行比较。在某事物周围加上单引号会将其视为文字。尝试以下操作：

```
SELECT f_name, l_name, (f_name + ' ' + l_name) AS full_name
FROM users_table
   WHERE f_name = user-input
   OR l_name = user-input
   OR full_name = user-input 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-09-13T20:10:44.323

确保用户输入“full_name”（不带引号）作为用户输入，并且数据库将返回一些行。

# asp.net - 不要在 ASP.NET 中发布特定文件夹

> ID：778872
> 
> 赞同：2
> 
> 时间：2009-04-22T19:43:19.387
> 
> 标签：asp.net, visual-studio-2008, build, publish

是否可以将 Web 项目中的文件夹排除在发布之外？我们有一些包含在特定项目文件夹中的文档和脚本，并被添加到项目中，但是当我进行 VS 发布时，我不希望它们进入生产服务器。

我知道他们不应该出现在项目中，但我想在我试图说服所有者修改他做事的方式之前找到一种解决方法。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-08-06T14:43:42.350

老问题，但我发现如果我将文件夹标记为`hidden`在 Windows 资源管理器中，它不会在您的解决方案中显示/发布。

例如，这有助于阻止原始 Photoshop 图像包含在未使用且较大的上传中。尽管您可能想要编写自己的发布工具，但任何更复杂的东西。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T20:12:37.493

这并不能完全回答您的问题，但我的感觉是，除非您是发布到服务器的单个开发人员，否则最好使用 MSBuild（或其他一些构建和部署解决方案）在专用工作站或服务器上进行构建直接（从而能够非常精细地控制生产中的内容）。MSBuild 不仅可以构建，而且使用一些扩展（包括开源类型），它也可以部署。微软有一款名为 MSDeploy 的产品处于测试阶段，这可能是一个更好的选择，但没有使用它的经验，我不能肯定地说。

在我们的情况下，我们有一个虚拟工作站作为构建框，我们所要做的就是双击启动 MSBuild 项目的批处理文件。它使用 VSS 标记所有代码，获取最新版本，构建解决方案，然后将其部署到两台服务器。我们准确地部署我们想要部署的东西，仅此而已。我们对此非常满意。

唯一的缺点，如果它可以被认为是一个缺点，是我们中的至少一个人必须学习如何使用 MSBuild。VS 本身使用 MSBuild。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T20:06:19.257

对于您不想去的文件，循环属性并将“复制到输出目录”设置为“不复制”

但是，此选项不适用于目录。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T19:45:29.930

您能否通过 Visual Studio 将它们排除在项目之外以阻止它们被发布。它们仍将存在于文件系统中

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T19:59:33.000

据我所知，您可以做到这一点的唯一方法是将其从项目中排除，进行发布，然后将其重新包含在项目中。这可能是个问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-22T20:50:49.180

可能有更好的方法来解决这个问题，但是当我们为我们的开发服务器发布构建时，我们将在构建完成后运行一个批处理文件以删除不需要的文件夹和 web.configs（所以我们不需要覆盖那些已经部署的）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-27T15:01:52.677

根据[http://www.mahinupta.com/mahinupta/blog/post/2009/12/04/AspNet-website-Exclude-folder-from-compilation.aspx](http://www.mahingupta.com/mahingupta/blog/post/2009/12/04/AspNet-website-Exclude-folder-from-compilation.aspx)你可以在windows中给文件夹“隐藏”属性资源管理器，它不会发布。我对此进行了测试，它对我有用。

对于快速和肮脏的目的来说，这似乎是一个简单的解决方案，但我认为它不会通过我们的版本控制（mercurial）进行。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2014-08-09T02:52:35.873

选择所有不应发布的文件。

转到属性集构建操作-> 无

![在此处输入图像描述](https://i.stack.imgur.com/g6DVT.png)

必须对每个子目录重复该过程。

# c# - 在 C# 中引用多个 Web 服务时解决类型歧义

> ID：778877
> 
> 赞同：4
> 
> 时间：2009-04-22T19:44:20.790
> 
> 标签：c#, .net, web-services

我目前正在开发一个基于 c# 的 webapp，它调用一些 web 服务。我已从提供程序将三个不同的 WSDL 导入到我的 WebApplication3 项目中（引用 -> 添加 Web 引用）。在类查看器中，它们显示为：

WebApplication3.com.provider.webservices1
WebApplication3.com.provider.webservices2
WebApplication3.Properties

显然第一个和第二个 WSDL 具有重复的功能（这是正确的名称吗？）
如果我添加到我的 Default.aspx .cs 以下使用：

使用 WebApplication3.com.sabre.webservices1；
使用 WebApplication3.com.sabre.webservices2；
使用 WebApplication3.Properties；

然后尝试使用：

MessageHeader msgHeader = new MessageHeader();
在我的 WebApplication3 命名空间中，我收到错误

“WebApplication3.com.provider.webservices1 和 WebApplication3.com.provider.webservices2 之间的引用不明确”

我猜这是因为它在两个 WSDL 中都声明了？我该如何解决这个问题以便我可以使用它？

谢谢，如果问题很愚蠢，对不起！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-22T19:50:39.073

尝试使用 MessageHeader 的完整命名空间来引用它。例如。

```
WebApplication3.com.provider.webservices1.MessageHeader msgHeader = new 
WebApplication3.com.provider.webservices1.MessageHeader() 
```

为简洁起见，您可以尝试

```
using MessageHeader = WebApplication3.com.provider.webservices1.MessageHeader 
```

这会让你使用

```
MessageHeader msgHeader = new MessageHeader() 
```

其中 MessageHeader 来自 webservices1 命名空间

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T19:50:09.077

看起来好像您已经两次导入了相同的 WSDL —— 或者至少两者使用的某些类型是相同的。您可以在不导入两个 Web 引用命名空间或使用命名空间别名的情况下消除两个同名类型之间的歧义。

您能否发布实际的代码片段并指出您使用“添加 Web 引用”导入的 URL？另外，您使用的是什么版本的 Visual Studio 以及您的目标是什么版本的 .Net Framework？

**编辑——根据彼得在评论中提供的信息进行跟进**

我检查了您发布的两个 URL，只是想提供一点背景知识。实际上，您第一次看到错误的原因是两个 WSDL 导入都指定使用相同的类型，即*MessageHeader*。检查每个 WSDL 文件的顶部：

[http://webservices.sabre.com/wsdl/sabreXML1.0.00/usg/SessionCreateRQ.wsdl](http://webservices.sabre.com/wsdl/sabreXML1.0.00/usg/SessionCreateRQ.wsdl)

```
<definitions targetNamespace="https://webservices.sabre.com/websvc">
  <types>
    <xsd:schema>
    <xsd:import namespace="http://www.opentravel.org/OTA/2002/11" schemaLocation="SessionCreateRQRS.xsd"/>
    <xsd:import namespace="http://www.ebxml.org/namespaces/messageHeader" schemaLocation="msg-header-2_0.xsd"/>
    ... 
```

[http://webservices.sabre.com/wsdl/sabreXML1.0.00/tpf/OTA_AirAvailLLS1.1.1RQ.wsdl](http://webservices.sabre.com/wsdl/sabreXML1.0.00/tpf/OTA_AirAvailLLS1.1.1RQ.wsdl)

```
<definitions targetNamespace="https://webservices.sabre.com/websvc">
  <types>
  <xsd:schema>
    <xsd:import namespace="http://webservices.sabre.com/sabreXML/2003/07" schemaLocation="OTA_AirAvailLLS1.1.1RQRS.xsd"/>
    <xsd:import namespace="http://www.ebxml.org/namespaces/messageHeader" schemaLocation="msg-header-2_0.xsd"/>
    ... 
```

每个 WSDL 文件的最后一行显示了类型名称冲突的原因——每个 WSDL 文件都导入了相同的 XSD 文件，显然是因为它们都使用相同的类型。创建对每个 WSDL 文件的 Web 引用时，Visual Studio 会检查 WSDL 并生成与导入的*msg-header-2_0.xsd*架构匹配的类。

不幸的是，Visual Studio 无法判断每个单独的 WSDSL 引用中的模式是否真的是同一类型，因此它会尽职尽责地导入每个引用并为每个引用生成一个单独的类。尽管生成的每个类都共享相同的名称，但每个类都在其自己的与每个 WSDL 文件相关的唯一名称空间中定义。

因此，这就是您为问题接受的解决方案有效的原因——或者指定*一种*类型的全名有效，或者使用特定命名空间之一中的*一种**类型*的别名。

另一种解决方案是修复两个 Web 引用以共享一个 MessageHeader 类型。这可以手动完成，但是，每次刷新 Web 服务引用时都必须重新进行手动编辑，所以我不建议这样做。*此外，使用为每个服务定义的正确MessageHeader*类型可能是一个更好的主意，尽管它们是相同的。因此，如果您假设要从同一个源文件调用这两个服务，我将*使用别名创建两个：*

```
using MessageHeader1 = WebApplication3.com.sabre.webservices1.MessageHeader;
using MessageHeader2 = WebApplication3.com.sabre.webservices2.MessageHeader; 
```

我会将 MessageHeader1 与您在命名空间*WebApplication3.com.sabre.webservices1*下引用的任何服务一起使用，同样，MessageHeader2 与另一个服务一起使用。

祝你好运！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T19:52:37.243

使用命名空间完全限定类名。

```
WebApplication3.com.sabre.webservices1.MessageHeader msgHeader = new WebApplication3.com.sabre.webservices1.MessageHeader(); 
```

# c# - 如何在 WPF 中为常见对话框启用视觉样式？

> ID：778879
> 
> 赞同：7
> 
> 时间：2009-04-22T19:44:27.827
> 
> 标签：c#, wpf, dialog, styles

当使用我的应用程序的 wpf 元素时，一切都符合操作系统的风格，但是当我使用 OpenDialog 或 MessageBox 时，它会呈现旧的 Windows 9X 方式。有没有更简单的方法可以执行 Application.EnableVisualStyles() 等效调用以使消息框和对话框看起来与应用程序的其余部分相同？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-22T19:58:00.757

您需要向程序集添加清单。您可以通过添加新项目-->常规-->应用程序清单文件来执行此操作。

然后在清单文件的 asmv1 标记内的某处添加以下内容：

```
<dependency>
    <dependentAssembly>
        <assemblyIdentity name="Microsoft.Windows.Common-Controls" version="6.0.0.0" type="win32" processorArchitecture="*" publicKeyToken="6595b64144ccf1df" language="*" />
    </dependentAssembly>
</dependency> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-22T19:50:22.290

这篇博文可能值得一看：
[为什么 WPF 中的 OpenFileDialog 看起来如此“1999”，我该如何解决？](http://learnwpf.com/post/2007/01/05/Why-does-the-OpenFileDialog-in-WPF-look-so-e2809c1999e2809d-and-how-can-I-fix-it.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-21T09:38:15.473

我在 WPF 中使用过 Winforms 控件的情况下，然后应用 EnableVisualStyles()...

# sql-server - 如何为默认约束指定列名？

> ID：778886
> 
> 赞同：0
> 
> 时间：2009-04-22T19:46:12.360
> 
> 标签：sql-server

我知道我可以像这样内联指定它：

```
CREATE TABLE dbo.MyTable
(
    Id INT NOT NULL CONSTRAINT PK_MyTable_Id PRIMARY KEY IDENTITY,
    Created DATETIME NOT NULL CONSTRAINT DF_MyTable_Created DEFAULT GETDATE()
) 
```

但我想把我所有的约束放在表定义的末尾，以保持它们分开。如果我把它放在表定义的末尾，我似乎无法找到如何命名默认约束的列。我可以使用主键/外键和唯一约束来做到这一点，但不知道如何使用默认约束来指定列名。

```
CREATE TABLE dbo.MyTable
(
    Id INT NOT NULL IDENTITY,
    Created DATETIME NOT NULL,
    CONSTRAINT PK_MyTable_Id PRIMARY KEY( Id ),
    CONSTRAINT DF_MyTable_Created DEFAULT GETDATE()
) 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T19:49:47.203

用 ALTER TABLE ADD..... 语法分开

像这样

```
CREATE TABLE dbo.MyTable
(
    Id INT NOT NULL IDENTITY,
    Created DATETIME NOT NULL

)
GO

ALTER TABLE dbo.MyTable ADD CONSTRAINT PK_MyTable_Id PRIMARY KEY( Id ),
CONSTRAINT DF_MyTable_Created DEFAULT GETDATE() FOR Created
GO 
```

# c# - 哪个 OO 概念是“Base b = new Derived()”的一个例子？

> ID：778888
> 
> 赞同：10
> 
> 时间：2009-04-22T19:47:03.187
> 
> 标签：c#, c++, oop

我在通过测试时遇到了一个问题，我们没有与同事达成一致意见。

**С++**

```
 1 class Base {};
  2 class Derived : public Base {};
  3 class Foo
  4 {
  5 public:
  6     Foo()
  7     {
 -8-         Base* b = new Derived(); // Concept name is?
  9     }
 10 }; 
```

**C＃**

```
 1 abstract class Base{}
  2 public class Derived : Base{}
  3
  4 public class Foo
  5 {
  6    public Foo
  7    {
 -8-        Base b = new Derived(); // Concept name is?
  9    }
 10 } 
```

问题是：上面的第 8 行是以下 oo 概念的示例

1.  多态性
2.  聚合
3.  封装
4.  抽象
5.  遗产

请附上知识来源答案的链接。

PS 测试是 breinbench 上的“OO 概念”。这是免费的。

**更新：** 

从捍卫**多态性的答案之一**

> “简单来说，多态性是一种类型 A 能够像另一种类型 B 一样出现和使用。在强类型语言中，这通常意味着类型 A 以某种方式派生自类型 B，或者类型 A 实现了一个接口代表B型。”

来自捍卫**继承的维基百科**

> 继承有时也称为泛化，因为**is-a** 关系表示对象类之间的层次结构。

和

> 因此，继承有另一种观点，即对偶，称为多态，它描述了许多由共享控制代码控制的代码。

所以`Base = new Derived()`显示'是'（**继承**）。其结果是**多态性**。

所以我怀疑什么是对的？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-04-22T21:09:03.410

这个问题很简单……它是**多态性**。

多态行为是由于继承而实现的。您可以将 Derived 的实例视为 Base，因为 Derived 继承自 Base。这是应用于 OO 语言中的类型时的多态性的定义......

[http://en.wikipedia.org/wiki/Polymorphism_(computer_science)](http://en.wikipedia.org/wiki/Polymorphism_(computer_science))

**[更新，更新]**

我希望这是足够明确的......这些都是说同一件事的不同方式。

[多态性（C# 编程指南）](http://msdn.microsoft.com/en-us/library/ms173152(VS.80).aspx)

> “通过继承，一个类可以用作多个类型；它可以用作自己的类型、任何基类型，或者如果它实现了接口，则可以用作任何接口类型。这称为多态。”

**[更新]**

鉴于评论我将尝试更具体...我并不是说因为 Derived 从 Base 继承该行是多态行为的一个示例，我是说将实例分配给它的类型的变量派生自是多态行为的一个例子。引用我附加的链接的第一句话......

> “在计算机科学中，多态性是一种编程语言特性，它允许使用统一接口处理不同数据类型的值”

这意味着我可以将 Derived 的实例视为 Base 的实例，这表现出多态行为。这不依赖于类上是否存在虚拟方法。

[以及来自不同来源](http://en.wikipedia.org/wiki/Polymorphism_in_object-oriented_programming)的另一个报价...

> “简单来说，多态性是一种类型 A 能够像另一种类型 B 一样出现和使用。在强类型语言中，这通常意味着类型 A 以某种方式派生自类型 B，或者类型 A 实现了一个接口代表B型。”

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-22T21:25:34.853

真正的答案是：一个格式不正确，因此毫无意义的问题。

这应该是一个标准化的多项选择题，但您有多年经验的人没有达成共识。唯一应该得出的结论是，作为知识的衡量标准，它是无用的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-22T19:48:26.223

这个片段是关于[继承的](http://en.wikipedia.org./wiki/Inheritance_(computer_science))

### 概念的粗略总结

**抽象**是关于根据对象建模现实世界概念的整个想法，而不是考虑函数调用或其他东西。它基本上将对象视为单独的实体。

**封装**是将对象的实现隐藏在定义良好的接口后面的行为。

> **继承**是派生类和基类之间的关系以及概念的分类。它定义了实体之间的“is-a”关系，增加了在需要基类的地方使用派生类的能力。

**多态性**意味着两个对象在接口上相似但行为方式不同（想想`virtual`方法）。

**聚合**定义了两个概念之间的“具有”关系。意味着一个对象是由另一个实体组成的。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-22T21:27:22.977

我认为答案的多样性表明这是一个结构不佳的问题。

如果你拿枪指着我的脑袋，我可能会选择**继承**，因为这个模型既然 Derived 继承了 Base，那么 Derived 可以在需要 Base 的地方使用（例如被 Base * 指向），但我可以想象一个为任何答案辩护。

如果我正在做出招聘决定，我会更感兴趣的是听听候选人如何为她选择的答案辩护，而不是她选择的答案。但是使用这样的测试的公司可能没有，或者没有员工能够评估该级别的技能。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-22T20:29:09.013

我会说**Polymorphism**，因为这些类型可以相互分配，并且可以被视为相同。您正在使用父接口来处理子类型的实例。

继承更多地与从父类到子类（也称为基类到派生类，超类到子类，抽象类到具体类）的继承成员和/或成员实现有关。

我认为将虚函数解析为具体实现是多态性的一个特征，因此不会因为示例中没有虚函数解析而被推迟。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-22T22:56:56.490

**答案是多态性。**

见[`http://en.wikipedia.org/wiki/Polymorphism_in_object-oriented_programming`](http://en.wikipedia.org/wiki/Polymorphism_in_object-oriented_programming)。

这里的许多答案都放弃了这个答案，因为没有虚函数调用。但这只是多态性的**一个**例子（也是最常见的）。但这不是唯一的一个。

维基百科文章很好地总结了最简单的多态性定义：

> 简单来说，多态是一种类型 A 能够像另一种类型 B 一样出现和使用。在强类型语言中，这通常意味着类型 A 以某种方式派生自类型 B，或者类型 A 实现了一个接口代表B型。

**当然，第 8 行是一个看起来**是类型`Base`但实际上是类型的对象的示例`Derived`

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-22T19:53:34.217

1.  多态性

    *   不，因为我们不调用任何虚方法——也不以任何其他方式使用多态行为
2.  聚合

    *   不，因为 Base* b 不是成员
3.  封装

    *   看不到我们封装了什么..除了构造函数的实现
4.  **抽象**

    *   我认为 - 是的 - 我们将使用更多的抽象类然后创建
5.  遗产

    *   基数和派生数之间的关系是继承-但您询问了分配行

**编辑**

> 抽象是通过对适合问题的类建模来简化复杂的现实，并针对问题的给定方面在最合适的继承级别上工作。

来自维基百科的定义 - [http://en.wikipedia.org/wiki/Object_orient](http://en.wikipedia.org/wiki/Object_oriented)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-04-23T01:28:59.137

```
6\. None of the above. 
```

这是协方差的一个例子。
[http://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science)](http://en.wikipedia.org/wiki/Covariance_and_contravariance_(computer_science))
另见，Liskov 可替代性原则：
[http ://en.wikipedia.org/wiki/Liskov_substitution_principle](http://en.wikipedia.org/wiki/Liskov_substitution_principle)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-22T21:55:26.967

我认为这里的简单代码最好描述为**子类型**的示例（[http://en.wikipedia.org/wiki/Subtype](http://en.wikipedia.org/wiki/Subtype)）。在面向对象的编程术语中，**多态性**是指子类改变或专门化基类中定义的行为的能力（[http://en.wikipedia.org/wiki/Polymorphism_in_object-orientated_programming](http://en.wikipedia.org/wiki/Polymorphism_in_object-oriented_programming)）。这个例子并没有真正表明这一点。

在brainbench 上列出的选择中，我认为**继承**最有意义，因为它最模糊。

* * *

## 回答 #10

> 赞同：-1
> 
> 时间：2009-04-22T22:31:41.417

它不是直接给出的任何选择。

它与多态性无关，因为代码不是通过基指针调用虚方法或删除指向基类的指针。

它不是直接关于继承，因为突出显示的代码不做任何继承。第 2 行是关于继承的。

它当然与抽象、封装或聚合无关，因为它与这些东西不相上下。

这个概念最直接地说明了一个自动演员表。

# jquery - 非（X）HTML 属性...有什么缺点吗？

> ID：778894
> 
> 赞同：6
> 
> 时间：2009-04-22T19:49:12.463
> 
> 标签：jquery, html, xml, xhtml, namespaces

在编写 Javascript 时，我通常会尝试使用仅限 DOM 的属性。现在我已经从 Prototype 切换到 jQuery，我可以通过将我自己的属性添加到各种 DOM 元素中获得一些重要的成果，主要是在能够设置一个非常易读的编码约定来处理 AJAX 请求的领域。

作为一个简短的例子，这意味着我会做类似的事情

```
<div type="book" app_id="13">
    <a href="#" action="delete">delete</a>
</div> 
```

然后我可以设置代码来查找所有`<a>`带有`action`属性的标签，找到带有`type`and的父`app_id`级，然后执行 CRUD 操作……所有这些都无需我编写额外的代码。

是否有任何我应该注意的陷阱（除了不是严格的 XHTML 投诉），和/或我应该效仿的任何好习惯？设置我自己的属性命名空间的标准方法怎么样？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-22T20:10:53.190

根据[这个问题](https://stackoverflow.com/questions/581279/xhtml-validation-custom-namespaces-and-attributes)，在 XHTML 1.0 中使用 XML 命名空间是无效的。将您自己的属性添加到同一个名称空间对我来说似乎更糟，因为它们肯定是无效的，即使就 XML 而言也是如此。

如果我这样做，我会得到我的里程`class`和`rel`属性。例如：

```
<div class="book" id="book_13">
   <a href="http://example.com/url/to/delete/non/ajaxily" class="delete">delete</a>
</div> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-23T04:10:44.473

[我可以像数据库记录一样在 HTML DOM 中存储自定义属性吗？](https://stackoverflow.com/questions/779832/can-i-store-custom-attributes-in-html-dom-like-a-database-record/780080#780080)

您可能正在寻找新的 HTML 5 数据属性。

[http://ejohn.org/blog/html-5-data-attributes/](http://ejohn.org/blog/html-5-data-attributes/)

[http://dev.w3.org/html5/spec/Overview.html#custom](http://dev.w3.org/html5/spec/Overview.html#custom)

我知道它不是“XHTML”，但至少它是某些标准的一部分；）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T20:15:54.210

我认为这种方法没有任何问题。实际上，我已经看到了很多这样的例子，我自己在许多应用程序中都使用了这种方法，除了验证问题之外没有遇到任何障碍。所以我认为你可以自由了 =)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-22T21:00:27.737

我认为添加无效属性没有任何问题，除非有人使用某种超级严格的未知浏览器并且在任何非标准的东西上都失败了。这可能会发生，我想……但这是值得怀疑的……

不过，一个不错的选择是使用[jQuery Metadata Plugin](http://docs.jquery.com/Plugins/Metadata)从属性内部存储易于访问的键->值对。

# sql - 在sql中将前导0添加到int的最有效方法

> ID：778909
> 
> 赞同：12
> 
> 时间：2009-04-22T19:52:18.087
> 
> 标签：sql, sql-server

我需要从连接为“field1-field2”的数据库中返回两个字段。第二个字段是一个 int，但需要以 5 的固定长度返回，并以 0 开头。我使用的方法是：

```
SELECT Field1 + '-' + RIGHT('0000' + CAST(Field2 AS varchar),5) FROM ... 
```

有没有更有效的方法来做到这一点？

* * *

## 回答 #1

> 赞同：34
> 
> 时间：2009-04-22T19:55:09.530

差不多就是这样：[向整数值添加前导零](http://wiki.lessthandot.com/index.php/Adding_Leading_Zeros_To_Integer_Values)

因此，要保存链接，查询如下所示，`#Numbers`表在哪里`Num`，列在哪里：

```
 SELECT RIGHT('000000000' + CONVERT(VARCHAR(8),Num), 8) FROM #Numbers 
```

对于负值或正值

```
declare @v varchar(6)
select @v = -5

SELECT case  when @v < 0 
then '-' else '' end + RIGHT('00000' + replace(@v,'-',''), 5) 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-22T20:43:41.070

另一种方式（没有 CAST 或 CONVERT）：

```
SELECT RIGHT(REPLACE(STR(@NUM),' ','0'),5) 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T20:01:08.720

如果您负担得起/想要在您的数据库中拥有一个功能，您可以使用类似的东西：

```
CREATE FUNCTION LEFTPAD
           (@SourceString VARCHAR(MAX),
            @FinalLength  INT,
            @PadChar      CHAR(1)) 
RETURNS VARCHAR(MAX)
AS
BEGIN
  RETURN
    (SELECT Replicate(@PadChar, @FinalLength - Len(@SourceString)) + @SourceString)
END 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T19:55:57.657

我会这样做。

```
SELECT RIGHT(REPLICATE('0', 5) + CAST(Field2 AS VARCHAR(5),5) 
```

不一定所有“更容易”或更高效，但更好读。可以优化以消除对“RIGHT”的需求

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-03-06T05:18:11.797

如果你想通过添加不同数量的零在最终结果中获得一致数量的总字符串，这里有一点修改（对于 vsql）

```
SELECT 
  CONCAT(
    REPEAT('0', 9-length(TO_CHAR(var1))), 
    CAST(var1 AS VARCHAR(9))
  ) as var1 
```

您可以根据需要将 9 替换为任意数字！

BRD

# .net - .NET XML 文档中的引用前缀

> ID：778929
> 
> 赞同：2
> 
> 时间：2009-04-22T19:57:14.410
> 
> 标签：.net, documentation, xml-comments, xml-documentation

我一直在尝试使用 XML 注释来完整记录类库的所有类型、方法、属性等，但遇到了涉及`cref`属性的奇怪效果（`see`例如，由标签使用）。[按照这个 MSDN 页面](http://msdn.microsoft.com/en-us/library/fsbx0t7x.aspx)的建议以及 MSDN 和其他网站上的各种其他示例，似乎每当使用`cref`标签指定参考值时，它必须以某个标记为前缀，该标记对参考进行分类（例如 ' T:' 表示类型，'M:' 表示方法）。

但是，使用 Microsoft Sandcastle 时，我观察到缺少这些前缀会影响生成的文档（在这种情况下为 CHM 帮助文件）。包括前缀（在我相信的所有情况下），引用在页面上呈现为粗体文本......但不包括前缀，引用被呈现为 API 参考中相应页面的锚（链接）。对我来说似乎很奇怪，推荐的前缀（全部？）引用方法给出的结果最不有用 - 为什么引用在一种情况下呈现为粗体并在另一种情况下链接？如果有人能对此有所了解，我将不胜感激。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-25T11:01:11.650

这似乎是[沙堡中的一个错误](http://social.msdn.microsoft.com/Forums/en-US/devdocs/thread/ce31c044-3e92-4423-a59a-d4ef23eb4b34)

你用的是什么版本的沙堡？

也就是说，[最近的讨论](http://shfb.codeplex.com/Thread/View.aspx?ThreadId=51125)似乎表明，至少对于系统类型，建议的方法实际上是避免使用限定名称，因为该答案中提出的示例完全放弃了 T: 和 M: 因此您的混淆并不意外或不常见。

[该文档](http://msdn.microsoft.com/en-us/library/cc837134.aspx)强烈暗示编译器可以发现您指向的类型/方法/常量为您插入前缀。您是否在 xml 中验证了这一点？

# c# - 使用 ILIST 铸造接口

> ID：778931
> 
> 赞同：4
> 
> 时间：2009-04-22T19:57:45.483
> 
> 标签：c#, interface

我有类型的字段 X`ILIST <ITopics>`

我正在尝试这样做：

```
Object.X= AListOfSometypeThatInheretsITopics; 
```

如何正确地将列表转换为 Object.X？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-22T20:01:14.477

这需要[泛型变量](http://msdn.microsoft.com/en-us/library/ms228359(VS.80).aspx)，不幸的是这是不可能的，`IList<T>`因为它表达了一个可变列表接口。您最好的选择是使用非泛型`IList`或泛型`IEnumerable<T>`（从 C# 4 开始可以变化）作为字段/属性类型，或者通过诸如

```
x = inputList.OfType<ITopics>().ToList(); 
```

获取适当风味的列表。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T20:02:15.210

尝试

```
object.x = IList<ITopics>.ofType<ITopics>().ToList() 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T20:07:37.800

您可以使用`IEnumerable<T>`扩展方法 Cast

```
Object.X = yourList.Cast<ITopics>().ToList(); 
```

# java - 通过 JVM 参数进行 log4j 配置？

> ID：778933
> 
> 赞同：146
> 
> 时间：2009-04-22T19:58:21.397
> 
> 标签：java, logging, log4j

我必须设置/传递哪些变量作为 JVM 的参数才能使 log4j 正常运行？正确地说，我的意思是不要抱怨并打印到控制台。我能看一个典型的例子吗？

注意：我需要避免在应用程序中创建 log4j.properties 文件。

* * *

## 回答 #1

> 赞同：180
> 
> 时间：2009-04-22T20:03:26.533

你有 log4j 配置文件吗？只需使用它来引用它

```
-Dlog4j.configuration={path to file} 
```

其中 {path to file} 应以`file:`

**编辑：**如果您正在使用 log4j2，则需要使用

```
-Dlog4j.configurationFile={path to file} 
```

取自答案[https://stackoverflow.com/a/34001970/552525](https://stackoverflow.com/a/34001970/552525)

* * *

## 回答 #2

> 赞同：168
> 
> 时间：2011-10-28T09:12:26.297

解决方案是使用以下 JVM 参数：

```
-Dlog4j.configuration={path to file} 
```

如果文件不在类路径中（在`WEB-INF/classes`Tomcat 的情况下）但在磁盘的某个位置，请使用`file:`，例如

```
-Dlog4j.configuration=file:C:\Users\me\log4j.xml 
```

更多信息和示例在这里： http: [//logging.apache.org/log4j/1.2/manual.html](http://logging.apache.org/log4j/1.2/manual.html)

* * *

## 回答 #3

> 赞同：44
> 
> 时间：2015-11-30T15:23:30.393

这似乎已更改（可能使用 log4j2）为：

```
-Dlog4j.configurationFile=file:C:\Users\me\log4j.xml 
```

请参阅：[https ://logging.apache.org/log4j/2.x/manual/configuration.html](https://logging.apache.org/log4j/2.x/manual/configuration.html)

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2010-02-15T09:17:26.807

我知道这已经回答了，但是因为你说，这不是你正在寻找的，我想指出以下替代方案：

您还可以使用配置类而不是属性或 xml 文件。

```
-Dlog4j.configuratorClass=com.foo.BarConfigurator 
```

有关详细信息，请参阅[http://logging.apache.org/log4j/1.2/manual.html](http://logging.apache.org/log4j/1.2/manual.html)。

* * *

## 回答 #5

> 赞同：12
> 
> 时间：2017-11-02T06:07:41.200

自 2015 年以来，Log4J 1.x 迟到了，已达到[EOL](http://logging.apache.org/log4j/1.2/manual.html)。

Log4J 2.x 以后的[JVM 选项](https://logging.apache.org/log4j/2.x/manual/configuration.html#AutomaticConfiguration)应该是`-Dlog4j.configurationFile=<filename>`

* * *

*PS`<filename>`可能是相对于类路径的文件，而**没有**`file:`其他答案中建议的。*

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-04-23T03:03:43.620

通常，只要您的 log4j.properties 文件位于类路径中，Log4j 就应该在 JVM 启动时自动获取它。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2018-07-26T08:18:30.757

相对路径也可以：

```
java -Dlog4j.configuration=file:".\log4j.properties" -jar com.your-1.0-SNAPSHOT.jar 
```

或者

```
java -Dlog4j.configuration=file:".\log4j.xml" -jar com.your-1.0-SNAPSHOT.jar 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-12-28T10:04:21.470

如果你正在使用 gradle。您可以应用“应用程序”插件并使用以下命令

```
 applicationDefaultJvmArgs = [
             "-Dlog4j.configurationFile=your.xml",
                              ] 
```

# c# - 重载 +/- 一元运算符

> ID：778939
> 
> 赞同：3
> 
> 时间：2009-04-22T20:00:15.510
> 
> 标签：c#, .net, operators

当您重载 - 一元运算符时，对于不可变类型，您可以这样编写：

```
public static Point3 operator - (Point3 p)
{
    return new Point3 (-p.X, -p.Y, -p.Z);
} 
```

但是对于+一元运算符，应该如何实现呢？像这样：

```
public static Point3 operator + (Point3 p)
{
    return p;
} 
```

或像这样：

```
public static Point3 operator + (Point3 p)
{
    return new Point3 (p);
} 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T20:03:53.300

无论哪种方式都很好。您没有在这两种方法中的任何一种中改变原始对象。

如果您调用`string.substring(0, string.length())`，则没有理由无法返回原始字符串。

您签署的唯一具有不变性的合同是，一旦创建了一个对象，它就不会改变。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-22T20:40:29.017

在我看来，这取决于 Point3.Equals() 的实现。

考虑以下代码：

```
Dictionary<Point3, string> cache;
Point3 pointA = new Point3(1, 2, 3);
Point3 pointB = new Point3(1, 2, 3);
cached[pointA] = "Value Aaa";
cached[pointB] = "Value Bbb";
Console.WriteLine(cached[pointA]);
Console.WriteLine(cached[pointB]); 
```

如果 Point3 具有引用语义（当它们是同一个对象时，pointA.Equals(pointB)），这将输出：

```
Value Aaa
Value Bbb 
```

如果 Point3 具有值语义（当它们的 x、y 和 z 值相等时，pointA.Equals(pointB)），这将输出：

```
Value Bbb
Value Bbb 
```

使用值语义，是否创建新对象并不重要。您可能只返回相同的内容以避免产生垃圾。

如果您的类型具有引用语义，您可能希望一元加号创建一个新对象，以便它的行为方式与其他运算符相同。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T20:07:48.970

如果结构是不可变的，你可以选择，我会返回原始值。

如果可变，则返回一个新的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T20:08:32.557

我无法想象它会对不可变类型产生影响的情况。最好只是返回`p`，[原则上最不意外](http://en.wikipedia.org/wiki/Principle_of_least_astonishment)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T20:02:30.327

我更喜欢第二种方法（虽然它会更慢），但假设`Point3`是一个 3D 点，它可能应该是 a `struct`not a `class`.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-22T20:47:33.773

嗯……

```
public static Point3 operator - (Point3 p)
{
    return new Point3 (-p);
} 
```

如果我错了，请纠正我，但这不会设置无限递归吗？您在一元 (-) 运算符方法中调用一元 (-) 运算符。

在我看来，你会想要这样做：

```
public static Point3 operator - (Point3 p)
{
    return new Point3 (-(p.X), -(p.Y), -(p.Z)); 
    // EDIT: Added parens for the sake of explicity. I don't recall the operator precedence in this case. 

} 
```

假设您的 Point3 类上有这样的构造函数和属性。

# couchdb - 开始使用 CouchDB

> ID：778942
> 
> 赞同：9
> 
> 时间：2009-04-22T20:00:49.563
> 
> 标签：couchdb

您是如何开始使用 CouchDB 的？推荐资源？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-22T20:08:38.047

CouchDB [wiki](http://wiki.apache.org/couchdb/)是权威的信息来源。完成中的 CouchDB[书籍](http://books.couchdb.org/relax/)可能会取代它，成为最好的入门资源。对于大多数人来说，CouchDB 最难理解的部分似乎是 map/reduce 范式。Mu Dynamics的交互式 CouchDB[模拟器](http://labs.mudynamics.com/wp-content/uploads/2009/04/icouch.html)是一个很棒的学习工具，用于理解 CouchDB 中的 map/reduce 范例。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-02-08T07:12:08.560

除了上述之外，我还建议您通过获取[TurnKeyVM 映像以最小的努力启动并运行 CouchDB 服务器](http://www.turnkeylinux.org/couchdb)

仅供参考 - 我现在也刚刚开始调查它......非常兴奋，希望它能做我认为它可以为我做的事情！

# html - 我可以阻止表单操作将用户重定向到另一个页面吗？

> ID：778946
> 
> 赞同：1
> 
> 时间：2009-04-22T20:01:23.823
> 
> 标签：html, cgi

我有这个表格：

```
<form name="input" action="http://s164074194.onlinehome.us/mail.py" method="POST">
Username:
<input type="text" name="email" />
<input type="submit" value="Submit" />
</form> 
```

提交时，调用 mail.py 脚本并将用户重定向到其输出...

我希望用户只停留在与表单相同的页面上，现在当我单击表单上的提交时，我被重定向到另一个站点上的 mail.py。是否可以禁用此重定向操作而只调用脚本？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T20:05:06.433

通过 AJAX 提交。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T20:09:00.480

正如@josh 提到的，您可能希望通过 AJAX 提交表单，但如果脚本在另一个站点上，那么我认为您将无法做到这一点。

可能你最好的选择是有一个隐藏的 iframe 和提交的真实表单，当用户点击可见表单上的按钮时，一些 javascript 将字段值复制到隐藏表单，并提交它。

您也可以只在表单上指定一个目标作为隐藏的 iframe，而不必担心 javascript 部分，但我还没有尝试过。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-22T20:45:40.627

一种解决方案是让 mail.py 在完成对表单数据的任何功能运行后将浏览器重定向到不同的页面。

我不确定您的情况，但如果您无权编辑 mail.py，那么如果可能的话，也许您可​​以获得它的本地副本。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-09-10T12:55:33.773

如果可能，然后写一个同名的名字`"action='current_filename'"`

```
<form name="input" action="current_file_name" method="POST">
Username:
<input type="text" name="email" />
<input type="submit" value="Submit" />
</form> 
```

# c# - “控件集合无法修改，因为控件包含代码块”

> ID：778952
> 
> 赞同：389
> 
> 时间：2009-04-22T20:02:46.097
> 
> 标签：c#, asp.net, user-controls

我正在尝试创建一个简单的用户控件，它是一个滑块。当我将 AjaxToolkit SliderExtender 添加到用户控件时，我得到这个 (*&$#()@# 错误：

```
Server Error in '/' Application. The Controls collection cannot be modified because the control contains code blocks (i.e. `<% ... %>`). Description: An unhandled exception occurred during the execution of the current web request. Please review the stack trace for more information about the error and where it originated in the code.

Exception Details: System.Web.HttpException: The Controls collection cannot be modified because the control contains code blocks (i.e. `<% ... %>`).

Source Error:

An unhandled exception was generated during the execution of the current web request. Information regarding the origin and location of the exception can be identified using the exception stack trace below.

Stack Trace:

[HttpException (0x80004005): The Controls collection cannot be modified because the control contains code blocks (i.e. `<% ... %>`).]    System.Web.UI.ControlCollection.Add(Control child) +8677431    AjaxControlToolkit.ScriptObjectBuilder.RegisterCssReferences(Control control) in d:\E\AjaxTk-AjaxControlToolkit\Release\AjaxControlToolkit\ExtenderBase\ScriptObjectBuilder.cs:293 AjaxControlToolkit.ExtenderControlBase.OnLoad(EventArgs e) in d:\E\AjaxTk-AjaxControlToolkit\Release\AjaxControlToolkit\ExtenderBase\ExtenderControlBase.cs:306 System.Web.UI.Control.LoadRecursive()
+50    System.Web.UI.Control.LoadRecursive()
+141    System.Web.UI.Control.LoadRecursive()
+141    System.Web.UI.Control.LoadRecursive()
+141    System.Web.UI.Control.LoadRecursive()             
+141    System.Web.UI.Control.LoadRecursive()
+141    System.Web.UI.Control.LoadRecursive()
+141    System.Web.UI.Page.ProcessRequestMain(Boolean includeStagesBeforeAsyncPoint, Boolean includeStagesAfterAsyncPoint) +627

Version Information: Microsoft .NET Framework Version:2.0.50727.3074; ASP.NET Version:2.0.50727.3074 
```

我尝试在用户控件中放置一个占位符，并以编程方式将文本框和滑块扩展器添加到占位符中，但仍然出现错误。

这是简单的代码：

```
<table cellpadding="0" cellspacing="0" style="width:100%">
    <tbody>
        <tr>
            <td></td>
            <td>
                <asp:Label ID="lblMaxValue" runat="server" Text="Maximum" CssClass="float_right" />
                <asp:Label ID="lblMinValue" runat="server" Text="Minimum" />
            </td>
        </tr>
        <tr>
            <td style="width:60%;">
                <asp:CheckBox ID="chkOn" runat="server" />
                <asp:Label ID="lblPrefix" runat="server" />:&nbsp;
                <asp:Label ID="lblSliderValue" runat="server" />&nbsp;
                <asp:Label ID="lblSuffix" runat="server" />
            </td>
            <td style="text-align:right;width:40%;">                

                    <asp:TextBox ID="txtSlider" runat="server" Text="50" style="display:none;" />
                    <ajaxToolkit:SliderExtender ID="seSlider" runat="server" 
                        BehaviorID="seSlider" 
                        TargetControlID="txtSlider" 
                        BoundControlID="lblSliderValue" 
                        Orientation="Horizontal" 
                        EnableHandleAnimation="true" 
                        Length="200" 
                        Minimum="0" 
                        Maximum="100" 
                        Steps="1" />

            </td>
        </tr>
    </tbody>
</table> 
```

问题是什么？

* * *

## 回答 #1

> 赞同：511
> 
> 时间：2009-07-24T10:08:02.693

首先，使用 <%# 而不是 <%= 开始代码块：

```
<head id="head1" runat="server">
  <title>My Page</title>
  <link href="css/common.css" rel="stylesheet" type="text/css" />
  <script type="text/javascript" src="<%# ResolveUrl("~/javascript/leesUtils.js") %>"></script>
</head> 
```

这会将代码块从 Response.Write 代码块更改为数据绑定表达式。
由于`<%# ... %>`数据绑定表达式不是代码块，CLR 不会抱怨。然后在母版页的代码中，添加以下内容：

```
protected void Page_Load(object sender, EventArgs e)
{
  Page.Header.DataBind();    
} 
```

* * *

## 回答 #2

> 赞同：277
> 
> 时间：2011-04-20T09:12:43.337

我也遇到了这个问题，但找到了另一个解决方案。

我发现用 asp:PlaceHolder-tag 包装代码块可以解决问题。

```
<asp:PlaceHolder runat="server">
  <meta name="ROBOTS" content="<%= this.ViewData["RobotsMeta"] %>" />
</asp:PlaceHolder> 
```

（我正在使用的 CMS 是从一些代码插入到 head-section 中，这限制了我添加带有各种信息（如元标记等）的自定义控制块，所以这是它对我有用的唯一方法。）

* * *

## 回答 #3

> 赞同：59
> 
> 时间：2010-06-23T08:24:23.210

我可以确认将带有`<% %>`标签的javascript从头部移动到表单标签可以修复这个错误

[http://italez.wordpress.com/2010/06/22/ajaxcontroltoolkit-calendarextender-e-strana-eccezione/](http://italez.wordpress.com/2010/06/22/ajaxcontroltoolkit-calendarextender-e-strana-eccezione/)

* * *

## 回答 #4

> 赞同：33
> 
> 时间：2011-01-14T07:34:46.920

将 javascript 放在 div 标签下。

```
<div runat="server"> //div tag must have runat server
  //Your Jave script code goes here....
</div> 
```

它会工作的！

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2010-09-21T06:53:20.517

如果您在页面中使用脚本管理器，则可以执行相同的功能。你必须像这样注册脚本

```
<asp:ScriptManager ID="ScriptManager1" runat="server" LoadScriptsBeforeUI="true"   EnablePageMethods="true">  
<Scripts>
      <asp:ScriptReference Path="~/Styles/javascript/jquery.min.js" />
</Scripts>
</asp:ScriptManager> 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-05-11T16:03:11.353

我尝试使用`<%# %>`没有成功。然后我将`Page.Header.DataBind();`我的代码更改为`this.Header.DataBind();`，它工作正常。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-05-14T19:21:53.990

我在用户控件中遇到了同样的问题。我托管控件的页面在 head 标记中有评论，我删除了这些评论，之后一切正常。一些帖子还建议从头部删除脚本并将它们放置在正文中。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2011-06-01T05:41:41.413

就我而言，我已替换`<%= %>`为`<%# %>`，并且有效！

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-08-16T06:25:49.867

将 java 脚本代码保留在 body 标记内

```
<body> 
   <script type="text/javascript">
   </script>
</body> 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2013-03-29T02:48:18.133

"<%#" 数据绑定技术不能直接在 <head> 标记中的 <link> 标记内工作：

```
<head runat="server">

  <link rel="stylesheet" type="text/css" 
        href="css/style.css?v=<%# My.Constants.CSS_VERSION %>" />

</head> 
```

上面的代码将评估为

```
<head>

  <link rel="stylesheet" type="text/css" 
        href="css/style.css?v=&lt;%# My.Constants.CSS_VERSION %>" />

</head> 
```

相反，您应该执行以下操作（注意里面的两个双引号）：

```
<head runat="server">

  <link rel="stylesheet" type="text/css" 
        href="css/style.css?v=<%# "" + My.Constants.CSS_VERSION %>" />

</head> 
```

你会得到想要的结果：

```
<head>

  <link rel="stylesheet" type="text/css" href="css/style.css?v=1.5" />

</head> 
```

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2016-09-05T23:19:47.897

我有这个问题，但不是通过标题。我的占位符在体内。所以我把所有的都`<%=`换成`<%#`了

```
protected void Page_Load(object sender, EventArgs e)
{
    Page.Header.DataBind();    
} 
```

它奏效了。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-10-07T22:51:37.247

另一种方法是让另一个 .aspx 页面充当您要链接到的页面。

这是 Masterpage 的标题的样子：

```
<head runat="server">
    <asp:ContentPlaceHolder ID="head" runat="server">
    </asp:ContentPlaceHolder>
    <link href="CSS/AccordionStyles.aspx" rel="stylesheet" type="text/css" />
</head> 
```

引用的 .aspx 表单包含您的内容：

```
<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="AccordionStyles.aspx.cs" Inherits="IntranetConnectCMS.CSS.AccordionStyles" %>
.AccordionHeader
{
    cursor: pointer;
    background-image: url(<%=ResolveUrl("~/Images/Backgrounds/AccordionPaneHeaderClosed.png") %>);
    background-repeat: no-repeat;
}

.AccordionHeaderSelected
{
    cursor: pointer;
    background-image: url(<%=ResolveUrl("~/Images/Backgrounds/AccordionPaneHeaderOpen.png") %>);
    background-repeat: no-repeat;
}
.AccordionContent
{
    background-image: url(<%=ResolveUrl("~/Images/Backgrounds/AccordionPaneContent.png") %>);
    background-repeat: no-repeat;
} 
```

最后，您需要 .aspx 页面告诉浏览器您正在发送 CSS 内容：

```
protected void Page_Load(object sender, EventArgs e)
{
    Response.ContentType = "text/css";
} 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2013-01-22T15:31:01.793

我有同样的问题，但它与 JavaScript 没有任何关系。考虑这段代码：

```
<input id="hdnTest" type="hidden" value='<%= hdnValue %>' />
<asp:PlaceHolder ID="phWrapper" runat="server"></asp:PlaceHolder>
<asp:PlaceHolder ID="phContent" runat="server" Visible="false">
    <b>test content</b>
</asp:PlaceHolder> 
```

在这种情况下，即使 PlaceHolders 没有任何有害的代码块，您也会收到相同的错误，这是因为非服务器控件 hdnTest 使用了代码块。

只需将 runat=server 添加到 hdnTest 即可解决问题。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2013-02-19T09:33:52.907

我也面临同样的问题。我找到了如下解决方案。

**解决方案 1：** 我将脚本标签保留在正文中。

```
<body>
   <form> . . . .  </form>
    <script type="text/javascript" src="<%= My.Working.Common.Util.GetSiteLocation()%>Scripts/Common.js"></script> </body> 
```

现在关于标签的冲突将得到解决。

**解决方案2：**

我们也可以解决上述解决方案之一，例如**将代码块替换为 <%# 而不是 <%=**但问题是它只会给出**相对路径**。如果您想要真正的**绝对路径**，它将行不通。

解决方案 1 对我有用。接下来是你的选择。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2013-12-09T09:35:12.543

我解决了一个类似的错误，方法是把`<script>`里面 a`contentplaceholder`放在里面，`<head>`而不是把`<script>`外面说`contentplaceholder`里面`<head>`

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2018-02-06T19:11:21.407

我在不同的情况下遇到了同样的问题。
我在 body 标签中有简单的元素。
解决方案是：

```
<asp:PlaceHolder ID="container" runat="server">
    <a id="child" href="<%# variable %>">Change me</a>
</asp:PlaceHolder> 
```

```
protected new void Page_Load(object sender, EventArgs e)
{    
    Page.Form.DataBind(); // I neded to Call DataBind on Form not on Header
    container.InnerHtml = "Simple text";
} 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2018-07-05T05:27:44.173

我的系统也遇到了同样的问题，我从页面中删除了 JavaScript 代码，并在关闭 body 标记之前将其放在 body

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2011-12-21T06:57:52.350

在某些情况下，ResolveUrl 和 ResolveClientUrl 有效，但并非总是如此，尤其是在 js 脚本文件的情况下。发生的情况是它适用于某些页面，但是当您导航到其他一些页面时，由于该特定页面的相对路径，它可能无法正常工作。

因此，最后我的建议是始终对您的网站页面进行全面的重新检查，以了解您的所有 javascript 引用是否正常。在谷歌浏览器中打开你的网站 -> 右键点击页面 -> 点击查看源页面 -> 出现 HTML -> 现在点击你的 JS 超链接；如果它工作正常，它应该在另一个浏览器窗口中打开 js 文件，否则它不会打开。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2014-02-05T04:23:23.267

尝试在 head 标记之外编写您的 java 脚本代码，它肯定会起作用。当我将我的 Java 脚本代码复制并粘贴到页面底部时，它就解决了。在以前它放置在 HEAD 标记中，现在就在关闭表单标记之前。

```
 </div>
        <script>
                    function validate() {
                        try {

                        var username = document.getElementById("<%=txtUserName.ClientID%>").value;
                        var password = document.getElementById("<%=txtPWD.ClientID%>").value;

                            if (username == "" && password == "")
                                alert("Enter Username and Passowrd");
                            else {
                                if (username == "")
                                    alert("Enter Username");
                                else if (password == "")
                                    alert("Enter Password");
                            }

                        }

                    catch (err) {
                    }
                }
                </script>
</form> 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2014-07-15T04:31:40.597

如果要从后面的代码中添加动态控件，请删除具有服务器标签的部分并将其放置在其他位置

我从页面的头部删除了我的 JavaScript 并将其添加到页面的正文并让它工作

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2016-03-17T17:02:05.770

就我而言，我收到此错误是因为我错误地将 InnerText 设置为其中包含 html 的 div。

例子：

```
SuccessMessagesContainer.InnerText = "";

   <div class="SuccessMessages ui-state-success" style="height: 25px; display: none;" id="SuccessMessagesContainer" runat="server">
      <table>
         <tr>
            <td style="width: 80px; vertical-align: middle; height: 18px; text-align: center;">
               <img src="<%=Image_success_icn %>" style="margin: 0 auto; height: 18px;
                  width: 18px;" />
            </td>
            <td id="SuccessMessage" style="vertical-align: middle;" class="SuccessMessage" runat="server" >
            </td>
         </tr>
      </table>
   </div> 
```

* * *

## 回答 #22

> 赞同：-1
> 
> 时间：2013-10-07T14:59:31.617

标签`<%= %>`不适用于带有`runat="server"`. 将您的代码与`<%= %>`into移动`runat="server"`到另一个标记 ( `body`, `head`, ...)，或`runat="server"`从容器中删除。

# c# - StackOverflowException 没有递归或无限循环？

> ID：778963
> 
> 赞同：8
> 
> 时间：2009-04-22T20:05:50.347
> 
> 标签：c#, datagridview, recursion, stack-overflow

### 背景

我有一个`DataGridView`正在使用的控件，我在下面添加了我的处理程序到`DataGridView.CellFormatting`事件中，以便可以使某些单元格中的值更易于阅读。这个事件处理程序一直工作得很好，格式化所有值都没有问题。

然而，最近，我发现一个非常罕见的情况会导致一个不寻常的错误。我`DataGridView`的项目到期日的列总是有一个`int`值。`0`表示事件永远不会到期，任何其他值都是到期日的 UTC 时间戳。对应的 MySQL db 列不允许空值。当用户从`DataGridView`具有截止日期的一行移动到具有截止日期的另一`DataGridView`行时（此时一切仍然正常），然后按下一个按钮，从数据库中重新加载数据（不发送更新，本质上是调用`DataAdapter.Fill()`)，程序生成一个`StackOverflowException`**。

### 没有递归？

对我来说如此不寻常的是，我看不到递归或无限循环在哪里。我添加`int cellFormatCallCount`为类成员，并在每次调用期间递增它，但在引发异常时，调试器将其值显示`int`为 1，这是我所期望的，因为我没有受到印象并且递归正在发生。

有人可以帮助我吗？

如何查看堆栈跟踪？在 VS2008 中它说： `{Cannot evaluate expression because the current thread is in a stack overflow state.}`

最好的祝福，

罗宾逊

```
private int cellFormatCallCount = 0;
private void myDataGridView_CellFormatting(object sender, DataGridViewCellFormattingEventArgs e)  {
    try {
        // to format the cell, we will need to know its value and which column its in
        string value = "";
        string column = "";

        // the event is sometimes called where the value property is null
        if (e.Value != null) {
            cellFormatCallCount++; // here is my test for recursion, this class member will increment each call

            // This is the line that throws the StackOverflowException
            /* ********************* */
            value = e.Value.ToString();
            /* ********************* */

            column = actionsDataGridView.Columns[e.ColumnIndex].Name;
        } else {
            return; // null values cannont be formatted, so return
        }

        if (column == "id") {
            // different code for formatting each column
        } else if (column == "title") {
            // ...
        } else {
            // ...
        }
    } finally {
        cellFormatCallCount = 0; // after we are done with the formatting, reset our recursion counter
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-23T03:43:01.543

显然 e.Value.ToString() 再次调用 CellFormatting 事件。这似乎有些合乎逻辑。使用调试器应该很容易找到。

但是实际的递归可能是在其他地方引起的，例如您省略的每列格式。

您的递归检查不可靠，因为 Value==null 也会重置它，并且它似乎由所有列共享。使其围绕 e.Value.ToString() 更紧密：

```
if (e.Value != null) 
{
   cellFormatCallCount++; 
   System.Diagnostics.Debug.Assert(cellFormatCallCount <= 1, "Recursion");
   value = e.Value.ToString();
   cellFormatCallCount--; 
   ...
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T20:11:48.027

完全随机猜测（没有堆栈跟踪，这是我所能做的）......

您是否尝试显示/格式化具有潜在递归的类型`ToString()`？

```
public string ToString()
{
   return ... this.ToString() ...
   // or
   return String.Format("The value is {0}", this);
} 
```

像这样的错字/错误可能会导致`StackOverflowException`...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T20:16:55.033

@Daniel：如果这是问题所在，它是否已经在该行中引发了异常：

```
if (e.Value != null) { 
```

@gnirts：您也可以发布完整的方法和堆栈跟踪吗？

@BCS（下）：我认为可能是这样，但它可能很容易出现在发布的 deo 中未显示的一些代码中。

PS。对不起，这应该是一个评论，但我没有足够的代表:-D

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-22T20:18:22.923

鉴于这是一个事件，它可能会触发它自己吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-22T20:24:43.377

尝试将 cellFormatCallCount 变量设为静态，以便类的所有实例共享它。我怀疑事件以某种方式触发了自己，但您没有看到它，因为 cellFormatCallCount 仅对处理事件的类的每个实例都是本地的，因此永远不会增加超过 1。如果是这种情况，那么 stackoverflow 的实际触发器(recursion) 可以在方法中的任何位置，并且恰好在该行用完堆栈空间。

将变量设为静态后，当它超过某个（小）值（如 2）时，您可能会引发异常。该异常应留下可见的堆栈跟踪。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-22T20:14:17.770

它与问题无关，但实际上你可以完全`StackOverflowException`没有递归：

```
throw new StackOverflowException(); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-01-11T13:24:38.497

我刚刚遇到了类似的 stackoverflow 问题，没有跟踪详细信息。

我的问题是由于不应该实例化的对象实例造成的。我删除了有问题的新对象，一切都很好。

在上面没有看到任何代码的情况下，请确保不会使用 =- 触发多个事件以相应地取消事件。

我希望这可以帮助某人。

# python - 在 Google App Engine 中生成唯一且不透明的用户 ID

> ID：778965
> 
> 赞同：9
> 
> 时间：2009-04-22T20:06:21.953
> 
> 标签：python, google-app-engine, guid, uniqueidentifier

我正在开发一个应用程序，它允许注册用户创建或上传内容，并允许匿名用户查看该内容并浏览注册用户的页面以查找该内容 - 这与 Flickr 等网站非常相似，例如，允许人们浏览其用户的页面。

为此，我需要一种方法来识别匿名 HTTP GET 请求中的用户。用户应该能够输入`http://myapplication.com/browse/<userid>/<contentid>`并进入正确的页面 - 应该是唯一的，但出于隐私原因，不能是用户的电子邮件地址。

通过 Google App Engine，我可以获得与用户关联的电子邮件地址，但就像我说的，我不想使用它。我可以让我的应用程序的用户在注册时选择一个唯一的用户名，但如果可能的话，我想将其设为可选，以便注册过程尽可能短。

另一种选择是在注册过程中生成一些随机 cookie（GUID？），并使用它，我没有看到一种明显的方法来保证这种 cookie 的唯一性而无需访问数据库。

在给定 App Engine 用户对象的情况下，有没有办法为该对象获取可以以这种方式使用的唯一标识符？

我正在寻找 Python 解决方案 - 我忘记了 GAE 现在也支持 Java。尽管如此，我希望这些技术是相似的，无论语言如何。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-23T07:15:00.677

您的时机无可挑剔：就在昨天，新版本的 SDK 发布了，支持[唯一的永久用户 ID](http://code.google.com/appengine/docs/python/users/userclass.html#User_user_id)。它们符合您指定的所有标准。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-22T22:56:35.600

我认为您应该区分两种类型的用户：

1) 已通过 Google 帐户登录或已使用非 Google 电子邮件地址在您的网站上注册的用户

2) 首次打开您的网站且未以任何方式登录的用户

`uuid.uuid4()`对于第二种情况，除了生成一些随机字符串（例如，通过或从此用户的会话 cookie 密钥）之外，我看不到其他方法，因为匿名用户自己不携带任何唯一信息。

但是，对于已登录的用户，您已经有了一个唯一标识符——他们的电子邮件地址。我同意您的隐私问题——您不应将其用作标识符。相反，如何生成一个*看似*随机但实际上是从电子邮件地址生成的字符串？散列函数非常适合此目的。例子：

```
>>> import hashlib

>>> email = 'user@host.com'
>>> salt = 'SomeLongStringThatWillBeAppendedToEachEmail'

>>> key = hashlib.sha1('%s$%s' % (email, salt)).hexdigest()
>>> print key
f6cd3459f9a39c97635c652884b3e328f05be0f7 
```

由于`hashlib.sha1`不是随机函数，但对于给定的数据返回的结果始终相同，但事实证明它实际上是不可逆的，因此您可以安全地在网站上显示散列密钥，而不会影响用户的电子邮件地址。此外，您可以放心地假设不同电子邮件的两个哈希值不会相同（它们可以相同，但发生的概率非常非常小）。有关散列函数的更多信息，请参阅[Wikipedia 条目](http://en.wikipedia.org/wiki/Cryptographic_hash_function)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T20:21:23.900

你的意思是[会话 cookie](http://en.wikipedia.org/wiki/HTTP_cookie)吗？

试试[http://code.google.com/p/gaeutilities/](http://code.google.com/p/gaeutilities/)

* * *

DzinX 所说的。创建可以在没有数据库往返的情况下进行身份验证的不透明密钥的唯一方法是使用加密或加密哈希。

给用户一个随机数并对其进行散列或使用私钥对其进行加密。您仍然存在（微小的）冲突风险，但您可以通过在创建密钥时触摸数据库来避免这种情况，在发生冲突时更改随机数。确保随机数是加密的，并添加一个长的服务器端随机数以防止选择明文攻击。

您最终会得到一个类似于 Google Docs 密钥的令牌，基本上是证明用户已通过身份验证的签名，无需接触数据库即可对其进行验证。

但是，考虑到 GAE 的定价和 bigtable 的速度，如果您真的不能使用 Google 自己的身份验证，您可能最好使用会话 ID。

# python - 用于解析 SQL 语句的正则表达式

> ID：778969
> 
> 赞同：6
> 
> 时间：2009-04-22T20:07:38.970
> 
> 标签：python, regex

我有一个 IronPython 脚本，它针对 SQL Server 数据库执行一堆 SQL 语句。这些语句是实际上包含多个语句的大字符串，由“GO”关键字分隔。当它们从 sql management studio 和其他一些工具运行时有效，但在 ADO 中无效。所以我使用 2.5 "re" 模块拆分字符串，如下所示：

```
splitter = re.compile(r'\bGO\b', re.IGNORECASE)
for script in splitter.split(scriptBlob):
    if(script):
        [... execute the query ...] 
```

这在评论或字符串中有“go”这个词的罕见情况下会中断。我该怎么解决这个问题？即正确地将这个字符串解析成两个脚本：

```
-- this is a great database script!  go team go!
INSERT INTO myTable(stringColumn) VALUES ('go away!')
/*
  here are some comments that go with this script.
*/
GO
INSERT INTO myTable(stringColumn) VALUES ('this is the next script') 
```

* * *

**编辑：**

我搜索了更多，发现了这个 SQL 文档：http: [//msdn.microsoft.com/en-us/library/ms188037 (SQL.90).aspx](http://msdn.microsoft.com/en-us/library/ms188037(SQL.90).aspx)

事实证明，正如一些答案所建议的那样，GO 必须独树一帜。但是，它后面可以跟一个“计数”整数，它实际上会执行多次语句批处理（以前有人实际使用过吗？？），它后面可以跟同一行上的单行注释（但不是多行，我对此进行了测试。）所以神奇的正则表达式看起来像：

```
"(?m)^\s*GO\s*\d*\s*$" 
```

除了这不考虑：

*   一个可能的单行注释（`"--"`后跟除换行符以外的任何字符）。
*   整行位于较大的多行注释内。

我不关心捕获“计数”参数并使用它。现在我有了一些技术文档，我非常接近于编写这个“规范”并且再也不用担心它了。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-22T20:31:40.350

“GO”总是在一条线上吗？您可以在“^GO$”上拆分。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-22T20:25:35.510

因为您可以在评论中添加评论、嵌套评论、在查询中添加评论等，所以没有理智的方法可以使用正则表达式来做到这一点。

想象一下下面的脚本：

```
INSERT INTO table (name) VALUES (
-- GO NOW GO
'GO to GO /* GO */ GO' +
/* some comment 'go go go'
-- */ 'GO GO' /*
GO */
) 
```

那不用说：

```
INSERT INTO table (go) values ('xxx') GO 
```

唯一的方法是构建一个有状态的解析器。一次读取一个字符，并且有一个标志，当它在注释/引号分隔的字符串/等内时将被设置并在结束时重置，因此代码可以在其中忽略“GO”实例。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-22T20:31:28.023

如果 GO 总是单独一行，你可以像这样使用 split ：

```
#!/usr/bin/python

import re

sql = """-- this is a great database script!  go team go!
INSERT INTO myTable(stringColumn) VALUES ('go away!')
/*
  here are some comments that go with this script.
*/
GO 5 --this is a test
INSERT INTO myTable(stringColumn) VALUES ('this is the next script')"""

statements = re.split("(?m)^\s*GO\s*(?:[0-9]+)?\s*(?:--.*)?$", sql)

for statement in statements:
    print "the statement is\n%s\n" % (statement) 
```

*   `(?m)`打开多行匹配，即匹配行的开头和结尾（而不是字符串的开头和结尾）`^`。`$`
*   `^`在行首匹配
*   `\s*`匹配零个或多个空格（空格、制表符等）
*   `GO`匹配文字 GO
*   `\s*`和以前一样匹配
*   `(?:[0-9]+)?`匹配一个可选的整数（可能有前导零）
*   `\s*`和以前一样匹配
*   `(?:--.*)?`匹配可选的行尾注释
*   `$`在行尾匹配

拆分将消耗 GO 行，因此您不必担心。这将为您留下一个陈述列表。

这个修改后的拆分有一个问题：它不会在 GO 之后给你返回数字，如果这很重要，我会说是时候转移到某种形式的解析器了。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-22T20:33:41.437

~~这不会检测是否`GO`曾经在某些语句中用作变量名，但应该注意注释或字符串中的那些。~~

**编辑：**如果它是语句的一部分，这现在可以工作`GO`，只要它不在它自己的行中。

```
import re

line_comment = r'(?:--|#).*$'
block_comment = r'/\*[\S\s]*?\*/'
singe_quote_string = r"'(?:\\.|[^'\\])*'"
double_quote_string = r'"(?:\\.|[^"\\])*"'
go_word = r'^[^\S\n]*(?P<GO>GO)[^\S\n]*\d*[^\S\n]*(?:(?:--|#).*)?$'

full_pattern = re.compile(r'|'.join((
    line_comment,
    block_comment,
    singe_quote_string,
    double_quote_string,
    go_word,
)), re.IGNORECASE | re.MULTILINE)

def split_sql_statements(statement_string):
    last_end = 0
    for match in full_pattern.finditer(statement_string):
        if match.group('GO'):
            yield statement_string[last_end:match.start()]
            last_end = match.end()
    yield statement_string[last_end:] 
```

示例用法：

```
statement_string = r"""
-- this is a great database script!  go team go!
INSERT INTO go(go) VALUES ('go away!')
go 7 -- foo
INSERT INTO go(go) VALUES (
    'I have to GO " with a /* comment to GO inside a /* GO string /*'
)
/*
  here are some comments that go with this script.
  */
  GO
  INSERT INTO go(go) VALUES ('this is the next script')
"""

for statement in split_sql_statements(statement_string):
    print '======='
    print statement 
```

输出：

```
=======

-- this is a great database script!  go team go!
INSERT INTO go(go) VALUES ('go away!')

=======

INSERT INTO go(go) VALUES (
    'I have to GO " with a /* comment to GO inside a /* GO string /*'
)
/*
  here are some comments that go with this script.
  */

=======

  INSERT INTO go(go) VALUES ('this is the next script') 
```

# trac - 基于版本控制/跟踪/票证统计的收入系统

> ID：778978
> 
> 赞同：1
> 
> 时间：2009-04-22T20:09:49.933
> 
> 标签：trac

最近我有了一个想法，可以将像 stackoverflow 之类的徽章系统应用于 trac（或任何系统），以刺激您的开发人员处理票证、错误等。天真的方法很容易受到滥用（显然）。

问题是：是否有类似的系统应用于工作流程（非社区）。它甚至可能与金钱利益有关。

我不确定这是否是正确的做法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-22T20:19:49.847

确保您首先阅读[缺陷黑市](http://thedailywtf.com/Articles/The-Defect-Black-Market.aspx)。:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T20:17:00.633

虽然略有不同，但您可能需要查看[Hudson 插件的持续集成游戏](http://wiki.hudson-ci.org/display/HUDSON/The+Continuous+Integration+Game+plugin)。用户通过完成某些任务（如完成任务、修复测试等）获得积分，您可以自定义积分。

Hudson 也有一个[trac 插件](http://wiki.hudson-ci.org/display/HUDSON/Trac+Plugin)，也许你可以把它们放在一起做一些很棒的东西。

# python - 如何将原始 Python 包上传到 PyPI？

> ID：778980
> 
> 赞同：10
> 
> 时间：2009-04-22T20:10:03.880
> 
> 标签：python, packaging, pypi

将包上传到 PyPI的神奇“ `python setup.py some_incantation_here`”命令是什么，可以下载以获取原始包的原始格式？

我有一个包含一些源代码和一些图像文件（如 package_data）的包。如果我执行“ `setup.py sdist register upload`”，则 .tar.gz 会排除图像文件。如果我这样做“ `setup.py bdist_egg register upload`”，则鸡蛋包含图像但不包括 setup.py 文件。我希望能够上传一个文件，这只是我的整个项目——也就是“ `setup.py the_whole_freaking_thing register upload`”。

也许最好的方法是手动 tar.gz 我的项目目录并使用 PyPI Web 界面上传它？

警告：我试图避免将我刚刚创建的简单项目存储在我的 SVN 存储库和 PyPI 中——在两个地方跟踪其历史和文件似乎是浪费工作。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-23T00:15:17.020

当您执行“sdist”命令时，控制包含文件列表的是位于“setup.py”旁边的“MANIFEST.in”文件，而不是“package_data”中列出的任何内容。这与当今 Python 打包解决方案的精神分裂性质有关。“sdist”由标准库中的[distutils](http://docs.python.org/distutils/index.html#distutils-index)提供支持，而“bdist_egg”由[setuptools](http://peak.telecommunity.com/DevCenter/setuptools)模块控制。

要解决此问题，请尝试在 setup.py 文件旁边创建一个 MANIFEST.in，并为其提供如下内容：

```
include *.jpg 
```

当然，我认为您的“映像文件”是实际图片，而不是磁盘映像或 ISO 映像或其他东西；如果我猜错了，您可能需要调整上面的行！但是请查看 distutils 文档的[指定要分发的文件](http://docs.python.org/distutils/sourcedist.html#specifying-the-files-to-distribute)部分，看看您是否无法让这些文件出现在您的 .tar.gz 源代码分发中！祝你好运。

# regioninfo - 如何从 Windows 注册表中找到世界地区（或国家）或语言？

> ID：778981
> 
> 赞同：1
> 
> 时间：2009-04-22T20:10:35.593
> 
> 标签：regioninfo

我正在使用一个非常旧的安装程序，它可以读取注册表项，但执行 Windows API 时遇到困难（复杂）。

我正在尝试检测正在安装的 PC 是否在澳大利亚。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-23T02:37:35.803

从我的测试和下面的 MSDN 页面来看，这将起作用：

HKEY_CURRENT_USER\Control Panel\International\sCountry ="澳大利亚"

这对应于区域选项中的设置（“选择一个项目以匹配它的首选项”。

[http://support.microsoft.com/kb/102978](http://support.microsoft.com/kb/102978)

这样做的好处是也可以从非管理员帐户中读取。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-22T20:25:37.413

这把钥匙：

**HKEY_USERS.DEFAULT\键盘布局\预加载**

设置登录屏幕的默认语言

此处列出了不同的国家/地区代码：

[http://www.windowsitpro.com/Article/ArticleID/14867/14867.html](http://www.windowsitpro.com/Article/ArticleID/14867/14867.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2018-03-22T09:08:20.200

补充：“HKEY_CURRENT_USER\Control Panel\International\sCountry”仅用于表示格式。你也可以使用。“HKEY_CURRENT_USER\Control Panel\International\Locale”并将其链接到一个表。

符号交叉表：

[https://msdn.microsoft.com/en-us/library/ee825488(v=cs.20).aspx](https://msdn.microsoft.com/en-us/library/ee825488(v=cs.20).aspx) [https://www.science.co.il/language/Locale-codes.php](https://www.science.co.il/language/Locale-codes.php)

当前位置存储在“HKEY_CURRENT_USER\Control Panel\International\Geo\Nation”中

位置交叉表：

[https://msdn.microsoft.com/en-us/library/windows/desktop/dd374073%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396](https://msdn.microsoft.com/en-us/library/windows/desktop/dd374073%28v=vs.85%29.aspx?f=255&MSPPError=-2147217396)

# javascript - 检测 IE 操作中止问题的原因

> ID：778983
> 
> 赞同：6
> 
> 时间：2009-04-22T20:11:07.590
> 
> 标签：javascript, internet-explorer

我的网站遇到了[Operation Aborted 错误](http://support.microsoft.com/kb/927917)。我觉得奇怪的是，在我的情况下，错误只是有时会发生。该网站已经运行了三个月，然后今天它开始发生，但并非每次都发生。

发生这种情况的页面相当大，有很多第三方控件。我想要的是一个可以查明故障发生位置的工具。似乎我能做的最好的事情就是找到操作中止后发生的第一个 javascript 错误；但是，这并没有多大帮助。这个失败是因为 dom 的一个元素不可用，这是我所期望的，因为 IE 停止解析 HTML。

有人有任何想法或技巧来缩小范围吗？

# 编辑

我很欣赏解决问题的其他方法；但是，我正在寻找的是一种确定哪个脚本导致问题的方法。

# 最终编辑

切换到 IE8 后，我能够确定原因是 AjaxControl Toolkit 的模式弹出对话框。没有具体的方法来确定这令人失望，但调试器让我看到它失败的地方，这是非常一致的。由于控件中没有办法告诉它移动其初始化，我禁用了它，并让脚本在我的文档加载事件处理程序中创建客户端控件。

这个问题不是控件的错，它发生是因为弹出窗口的内容实际上是第二种形式。坦率地说，我很惊讶它曾经奏效。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T20:14:55.957

您是否有任何操纵 DOM 的 javascript，如[http://support.microsoft.com/kb/927917#more_information](http://support.microsoft.com/kb/927917#more_information)中所述的情况？

尝试将所有脚本块移动到页面的最底部，就在`</body>`标记之前，并且不要尝试设置 body 标记本身的 innerHTML 属性。

如果问题是在 DOM 完全构建之前执行 javascript，请尝试将任何初始化调用移动到仅在页面完全加载后才运行的函数中。所以，而不是这样的事情：

```
<div class="myWidgetControl"/>
<script type="text/javascript">
  initializeWidgets();
</script> 
```

尝试这样的事情：

```
<div class="myWidgetControl"/>
<script type="text/javascript">
  $(document).ready(
    function () { initializeWidgets(); }
  );
</script> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-04-21T08:46:09.747

您可以使用 IE 博客提供的脚本来调查问题。请参阅：http: [//blogs.msdn.com/ie/archive/2009/09/03/preventing-operation-aborted-scenarios.aspx](http://blogs.msdn.com/ie/archive/2009/09/03/preventing-operation-aborted-scenarios.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T20:22:25.910

这是我使用的一个绝妙技巧（基于下面 JS 评论中的链接），它完全避免了 Op Ab 错误，而不会影响其他浏览器的性能。您首先将您正在执行的任何可能导致错误的脚本（例如，加载/实例化第 3 方小部件）包装在一个函数中，然后在该函数中调用该`delayExecutionForIE`函数 - 请注意，调用`myFunction`两次，一次用于 IE，一次用于漂亮的浏览器。

您的 3rd-party 脚本可能会阻止此工作，具体取决于它的作用以及它预期的加载方式，但绝对值得一试。

```
function delayExecutionForIE() {
      if ( typeof document.all == "object" && 
           (document.readyState != "loaded" 
           && document.readyState != "complete") 
         ) {
            try {
                  //If IE is used, use the trick by Diego Perini
                  //http://javascript.nwbox.com/IEContentLoaded/
                  document.documentElement.doScroll("left");
                  myFunction();
            } catch(error) {
                  setTimeout(delayExecutionForIE, 200);
            }
      } else {
            myFunction();
      }
}

function myFunction() {
    //this is your function that manipulates the DOM
}

delayExecutionForIE(); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-01-31T16:55:34.493

在大多数情况下，这是 JS 中的 DOM 问题。

```
$( element ).append( someHtml ); 
```

所以在 IE 中，只有当它有结束标签时，你才能向对象添加内容

例如下面的代码将导致 IE7 带来消息“操作中止”

```
<div id="o">

...
$(o).appendChild();
...

</div> 
```

和正确的方式

```
<div id="o">

...

</div>

$(o).appendChild(); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-22T23:06:19.697

尽管 IE8 将不再导致该错误完全“崩溃”渲染，而是记录错误，但不幸的是，新开发者工具中的 JavaScript 调试器没有捕捉到该错误，并且错误消息不会告诉您错误的真正位置发生了。

一种解决方法，当然很乏味，但可以定位问题，是使用 IE8 的调试器在运行的第一段 JavaScript 代码上放置一个断点，然后继续点击“Step”按钮，直到弹出错误图标在浏览器的左下角。发生这种情况时，您知道导致错误的代码行是在您单击 step 之前突出显示的代码行。不过，您可能会逐步执行大量代码，但我想不出其他任何东西（好吧，除了联系该第 3 方代码的供应商并查看他们是否有任何可能相关的更新）。

当然，您可以只告诉您的用户升级到 IE8。;)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-23T02:52:19.623

微软**确实**建议升级到 IE8！

# c# - 动态设置 WCF baseAddressPrefixFilters

> ID：778989
> 
> 赞同：2
> 
> 时间：2009-04-22T20:13:04.263
> 
> 标签：c#, asp.net, wcf, wcf-binding

我有一个在共享托管环境中部署的 WCF 服务。因此，我必须指定[baseAddressPrefixFilters](http://msdn.microsoft.com/en-us/library/bb924481.aspx)（请参阅[此处](https://stackoverflow.com/questions/506634/wcf-config-element-baseaddressprefixfilters)的答案以了解为什么这是必要的）。设置基地址前缀过滤器发生在 web.config 中，如下所示......

```
<serviceHostingEnvironment>
  <baseAddressPrefixFilters>
    <add prefix="http://example.com"/>
  </baseAddressPrefixFilters>
</serviceHostingEnvironment> 
```

问题是我有多个使用自己的 url 以这种方式配置的环境（即 dev、test、prod）

我尝试了以下没有运气...

```
<serviceHostingEnvironment>
  <baseAddressPrefixFilters>
    <add prefix="http://dev.example.com"/>
    <add prefix="http://test.example.com"/>
    <add prefix="http://example.com"/>
  </baseAddressPrefixFilters>
</serviceHostingEnvironment> 
```

所以问题是如何在运行时动态设置 baseAddressPrefixFilter ？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T20:59:34.383

如果您在 IIS7 下运行，这是一个很好的问题和解决方案演练。如果没有，WCF 方面的信息仍然是您解决问题所需要知道的。

[http://keithelder.net/2008/04/28/configuring-wcf-and-iis-7-with-http-bindings-and-multiple/](http://keithelder.net/2008/04/28/configuring-wcf-and-iis-7-with-http-bindings-and-multiple/)

你看过 ServiceHostFactory 吗？我们在 3.0 服务中使用它来处理不同的主机头。

[http://blogs.msdn.com/rampo/archive/2007/06/15/supporting-multiple-iis-bindings-per-site.aspx](http://blogs.msdn.com/rampo/archive/2007/06/15/supporting-multiple-iis-bindings-per-site.aspx)

# c# - 在 C# 中对 Active Directory 的通用身份验证调用

> ID：778990
> 
> 赞同：0
> 
> 时间：2009-04-22T20:13:29.410
> 
> 标签：c#, authentication, active-directory

我想要一个从 Active Directory 进行身份验证的干净 C# 类。

它应该很简单，它只需要询问凭据并检查它是否符合 AD 的预期。

我负责许多 C# 应用程序，我希望它们都使用同一个类。

有人可以提供这样一个类的干净代码示例吗？它应该具有良好的错误处理能力，得到很好的评论，并且特别要求提供凭据，而不是尝试读取用户是否已经登录到 AD 以使用另一个应用程序。（这是一个安全要求，因为某些应用程序用于共享计算机的区域：具有多个角色和不同权限级别的人可能使用同一台计算机而忘记在会话之间注销）

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-22T20:20:31.530

[http://support.microsoft.com/kb/316748](http://support.microsoft.com/kb/316748)

```
public bool IsAuthenticated(String domain, String username, String pwd)
{
  String domainAndUsername = domain + "\\" + username;
  DirectoryEntry entry = new DirectoryEntry(_path, domainAndUsername, pwd);

  try
  { //Bind to the native AdsObject to force authentication.         
     Object obj = entry.NativeObject;

     DirectorySearcher search = new DirectorySearcher(entry);

     search.Filter = "(SAMAccountName=" + username + ")";
     search.PropertiesToLoad.Add("cn");
     SearchResult result = search.FindOne();

     if(null == result)
     {
         return false;
     }

     //Update the new path to the user in the directory.
     _path = result.Path;
     _filterAttribute = (String)result.Properties["cn"][0];
  }
  catch (Exception ex)
  {
     throw new Exception("Error authenticating user. " + ex.Message);
  }

     return true;
 } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-22T20:21:23.837

诚然，我没有针对 AD 进行编程的经验，但下面的链接似乎可以解决您的问题。

[http://www.codeproject.com/KB/system/everythingInAD.aspx#35](http://www.codeproject.com/KB/system/everythingInAD.aspx#35)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-22T20:19:12.530

有一些原因你不能使用[Windows 集成身份验证](http://en.wikipedia.org/wiki/Integrated_Windows_Authentication)，并且不打扰用户输入他们的姓名和密码？在可能的情况下，这同时也是最有用和最安全的解决方案。

# .net - 密码检查样板

> ID：778991
> 
> 赞同：0
> 
> 时间：2009-04-22T20:13:29.533
> 
> 标签：.net, security, boilerplate

我有一些服务器端代码需要检查用户名/密码对。我正在寻找一种既好又简单的方法，就像拥有一个带有用户名/MD5 哈希对的文本文件一样。我希望代码看起来像这样：

```
if(!PasswordChecker.ValidLogin("passwords.dat", username, password)
   throw new Exception("Invalid username or password"); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-22T20:20:43.090

我会考虑使用 ASP.NET Forms Authentication 项。

您可以调用`Membership.ValidateUser("MyUsername", "MyPassword")`以验证登录。

您可以将用户名/密码对存储在 web.config 文件中。这将在与此类似的部分中进行。

```
<credentials passwordFormat="MD5">
<user name="username" password="hashedpasswordhere"/>
<user name="username2" password="hashedpasswordhere"/>
</credentials> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-22T20:22:41.477

使用 .config 文件很好，因为可以轻松访问信息。但是，如果您选择不这样做，请确保您制作的文件类型无法下载。

# asp.net - 什么时候在 ASMX 中实例化 SoapHeader 字段？

> ID：778992
> 
> 赞同：0
> 
> 时间：2009-04-22T20:14:10.780
> 
> 标签：asp.net, soap, asmx

考虑以下：

```
public MyCustomHeader MyHeader;

public New()
{
    //MyHeader is NOT instantiated
}

[SoapHeader("MyHeader")]
[WebMethod()]
public bool MyFunction()
{
    //MyHeader is instantiated, but when was it instantiated?
} 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-22T20:26:01.003

在您的示例中，它将在方法执行之前被实例化`MyFunction`。因为需要 Header 才能执行 MyFunction 的操作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-08-02T10:50:19.923

```
how to convert this part and attach to XML in android?
POST /SharingpointCheckBarcode.asmx HTTP/1.1
Host: awc.test.trin-it.nl
Content-Type: text/xml; charset=utf-8
Content-Length: length
SOAPAction: "http://tempuri.org/checkBarcode" 
```

# c# - iphone：从 XML 文档中的数据制作新的 UIImage

> ID：778995
> 
> 赞同：0
> 
> 时间：2009-04-22T20:14:40.297
> 
> 标签：c#, iphone, xml, streaming

我正在为 iphone 制作一个视频流客户端原型，该客户端从用 C# 编写的网络服务器获取内容。

服务器输出一个 XML 文档，其中图像的 jpg 数据存储在其中一个标签 () 中。它使用 WriteBase64 将其写出。

在 iPhone 上，我使用 libxml 来解析 xml 并将图像的字节存储在 NSString 中。

下一步是使用数据创建一个 NSData 对象，然后使用它的 +initWithData 方法创建一个新的 UIImage。

但是，每次我尝试创建一个新图像时，结果都是一个表示失败的 nil 对象。我最好的猜测是，我需要做一些事情才能以某种方式将 NSString 转换回来。

请帮忙！！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-22T20:18:49.320

您是否正确地从 XML 中对字符串进行 base64 解码？我知道在 Objective-C 中没有本地方法可以做到这一点，但是关于如何在此处推出自己的方法进行了很好的讨论：http: [//www.cocoadev.com/index.pl?BaseSixtyFour](http://www.cocoadev.com/index.pl?BaseSixtyFour)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-23T07:14:39.350

另一种方法是直接在 XML 流之后附加图像二进制数据并自己解析它 - base64 编码确实扩展了您正在传输的图像的大小。*******