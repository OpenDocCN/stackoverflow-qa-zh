# StackOverflow 问答 000342000-000342999

# windows - 有没有可以在 Windows 下使用的 GTK 终端组件？

> ID：342008
> 
> 赞同：5
> 
> 时间：2008-12-04T20:47:27.990
> 
> 标签：windows, gtk

我需要构建一个类似终端的应用程序，该应用程序需要在我通常的 Ubuntu 安装下使用，但也需要在 Windows 下使用。我一直在寻找一个接受命令并能够显示某种命令历史记录和输出的终端组件。

gnome-terminal 中使用了一个名为 VTE 的组件，但我无法在 Windows 下编译它，因为它依赖于一些 Unix 特定的函数（看起来）。您是否知道任何其他可以在 Windows 下构建的类似终端的 GTK 组件或以某种方式构建 VTE？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T01:26:18.973

也许您想查看名为 zvt 的旧 GNOME 小部件，它可能已被移植到 Win32。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T00:53:52.487

Gnuplot wxt 提供了一个终端，它在 X 上使用 GTK 编译，并在 windows 上使用 win32 API。它使用 WxWindows 接口编译到两种环境中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-04-08T01:38:04.097

不，仍然没有，即使是多年后。

# .net - .Net SQL Server 数据库监控 - 插入、更新、删除

> ID：342031
> 
> 赞同：6
> 
> 时间：2008-12-04T20:55:45.243
> 
> 标签：.net, sql-server, database, monitoring

有谁知道从 .Net 应用程序监视 SQL Server（2005 或 2008）数据库中表记录更改的方法？它需要能够同时支持多个客户端。每个客户端将在启动时“订阅”，并在退出时“取消订阅”。多个用户可能同时访问系统，我想将他们的更改反映在其他用户的客户端上。然后，当客户端处理更改事件时，它可以更新表示该记录的本地对象。有点类似于 Access 更新被修改的记录如何反映在引用它的每个表单中。

我知道微软有用于与 SQL Server 交互的 Microsoft.SqlServer 库。但我不确定哪个概念适用于我想做的事情（或者什么可以适用于我想做的事情）。听起来可能有用的是管理或复制。

预料到有人会问，“为什么不偶尔重新查询表以查找新信息？” 我有大量的表要监控，这会让人头疼。另外，如果我正在寻找更优雅的东西。

我愿意接受建议...

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-05-21T21:35:29.370

要在 SQL 2005+ 中监视对 SQL 表或记录的更改，您可以使用 SqlDependency 类。

它的目标是在 ASP.NET 或中间层服务中使用，其中单个服务器正在管理针对数据库的活动订阅，而不是由数百个客户端管理订阅。根据您所指的客户端的最大数量，您可能希望构建一个缓存池服务，该服务可以管理针对您的客户端的 SQL 通知订阅。

在它内部使用使用服务代理的 SqlNotificationRequest，而不是通知服务。因此，这应该适用于 SQL 2008 等。

[SqlDependency 的 MSDN](http://msdn.microsoft.com/en-us/library/system.data.sqlclient.sqldependency.aspx)

```
void Initialization()
{
    // Create a dependency connection.
    SqlDependency.Start(connectionString, queueName);
}

void SomeMethod()
{
  // Assume connection is an open SqlConnection.

  // Create a new SqlCommand object.
  SqlCommand command=new SqlCommand(
    "SELECT ShipperID, CompanyName, Phone FROM dbo.Shippers", 
    connection);

  // Create a dependency and associate it with the SqlCommand.
  SqlDependency dependency=new SqlDependency(command);
  // Maintain the refence in a class member.

  // Subscribe to the SqlDependency event.
  dependency.OnChange+=new OnChangeEventHandler(OnDependencyChange);

  // Execute the command.
  command.ExecuteReader();
  // Process the DataReader.
}

// Handler method
void OnDependencyChange(object sender, 
   SqlNotificationsEventArgs e )
{
  // Handle the event (for example, invalidate this cache entry).
}

void Termination()
{
    // Release the dependency.
    SqlDependency.Stop(connectionString, queueName);
} 
```

“ [Using and Monitoring SQL 2005 Query Notifications](http://www.simple-talk.com/sql/sql-server-2005/using-and-monitoring-sql-2005-query-notification/) ” 文章介绍了在代码中设置它的步骤（以 Web 应用程序为例）以及订阅 Service Broker 所需的适当 SQL 权限等。

[ASP.NET（Web 缓存）](http://msdn.microsoft.com/en-us/library/system.web.caching.sqlcachedependency.aspx)类也可用于 Web 场景。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T09:03:21.280

在 SQL Server 2008 中，您有更改跟踪，您可以在插入、更新或删除发生时进行跟踪。这将跟踪事件已经发生，它是哪条记录以及可选的哪些列被更改，但不是值（之前和之后）。这通常用于对已知的已更改数据执行批量处理。

在更改跟踪中，您可以设置**保留**期来保存更改，通常是确保跟踪表的任何处理都在保留期内的时间段。

或者，您有（同样，在 SQL 2008 中）更改数据捕获，它更细化并记录实际更改。但是，这只是企业功能。

您可以轻松创建 .NET 应用程序来运行**更改跟踪**或**更改数据捕获** 查询。

这是有关两者的更多信息的链接

[更改跟踪](http://blogs.msdn.com/synchronizer/archive/2008/01/25/change-tracking-for-the-masses.aspx)

[变更数据捕获](http://msdn.microsoft.com/en-us/library/bb522489.aspx)

在大多数情况下，更改跟踪可能是最好的选择——而且它适用于所有版本的 SQL Server 2008。

如果您想在 2005 年或以下实现这一目标，您基本上可以为要跟踪的每个表创建表，并在插入、更新、删除时将值插入到跟踪表中。然后有一个过程来清除它。这基本上就是变更跟踪为您所做的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T11:57:14.487

我想我误读了这个问题。

听起来这是一个带有锁定控制的标准多用户应用程序。用户登录然后访问服务器上的数据（订阅）。用户注销（取消订阅）。

或者这是您想要同步更改的断开连接的应用程序？

对于断开连接的应用程序，您可以使用 SQL Server 的同步服务。

除此之外，只需使用 LINQ to Entities，您就可以在保存对象更改时处理冲突。为确保 LINQ 生成的查询是高性能的，您可以向每个表添加一个 TIMESTAMP 列，但这不是必需的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T21:12:07.143

我没有亲自使用过，但听起来Notification Services值得一看

[更多这里...](http://www.microsoft.com/sqlserver/2005/en/us/notification-services.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-04T21:14:31.493

这种情况通常不能很好地扩展......您可以查看 SQL 通知服务，但这也有同样的问题。

在一个系统中，我通过使用触发器来编写对（单个）增量表的更改的简短摘要，包括表、更改类型和行 ID。每个客户端都维护一个“我读过的地方”，并简单地询问所有 id > 这个数字的增量记录。问题是你需要做一些聪明的事情来清理表格而不破坏任何单个客户端的更改历史......即跟踪注销，假设他们在给定的时间之后已经死亡，并在他们完全刷新时记录。

绝对可行，但工作量很大。

# asp.net - 从 div 标签引发回发事件

> ID：342032
> 
> 赞同：2
> 
> 时间：2008-12-04T20:55:46.677
> 
> 标签：asp.net

我试图通过 div 标签引发回发事件。我不知道该怎么做。AL 我能想到的是 javascript，但这不是我想要的。我需要在事件处理程序中调用类的函数。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T21:59:26.910

你必须使用javascript：

```
<div id="foo" onclick="__doPostBack('foo','')">
Clicky!
</div> 
```

部分困难在于您无法轻松通过事件目标。有更好的方法来做你想做的事，但你需要详细说明你的需求。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T21:51:52.807

You need to do this with javascript. Panel renders as a div, but it doesn't have any client initiated events for you to hook into.

You can look here [http://geekswithblogs.net/mnf/archive/2005/11/04/59081.aspx](http://geekswithblogs.net/mnf/archive/2005/11/04/59081.aspx) (and follow the links) to see how to actually fire a postback for a control via javascript manually, although this is very kloodgy.

My guess is that if you give us some more information on what it is you want to do, we could suggest a better way to do it then programmatically cause a postback.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T21:01:29.570

什么会触发回发？

如果您的意思是单击 div，那么您所能做的就是使用 javascript 触发回发事件。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-04T20:58:42.990

如果我没记错的话，是为了进行回发，控件需要有“runat=server”。尝试将 id 添加到 div 标签和 runat。

# c++ - 测试类

> ID：342037
> 
> 赞同：4
> 
> 时间：2008-12-04T20:57:16.487
> 
> 标签：c++, unit-testing

我昨天安排了一个班级来做一些有用的任务。我开始了 alpha 测试，并在某个时候意识到我正在向类本身添加 alpha 测试相关的方法。我觉得他们不属于那里。经过一番摸索，我从基类派生了一个测试类，它也可以访问受保护的成员。我把所有与测试相关的方法，在测试类中设置和拆除，让基类像老话说的那样精益求精。

在这里浏览了一段时间后，我发现一条评论建议通过让测试类成为真实类的朋友来使用这种技术。

回想起来，这两种技术对我来说都应该是显而易见的。

**我正在寻找的是专门用于 alpha 测试/单元测试类的技术，而不会增加被测试类的权重。**

**您个人使用过哪些技术，并推荐过哪些技术？**

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-04T21:06:04.847

单元测试的目标之一是验证类的*接口*。这意味着，一般来说，你不应该测试你班级的肮脏内脏。单元测试应该与您的类的公共输入和输出进行交互，并验证行为是否符合预期。因此，您可以更改类的内部实现，而不会影响依赖它的所有其他对象。显然，我不知道你的情况的细节，但我会说，作为一般规则，如果你的单元测试试图找出课程的私人细节，那么你做错了什么。

**编辑：**另请参阅：[这个 SO question](https://stackoverflow.com/questions/34571/whats-the-best-way-of-unit-testing-private-methods)。请注意，它可以做到（最佳答案），但也请注意，第二名的答案（差一点）说的或多或少与我上面提到的相同。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T22:01:10.913

听起来您不想要单元测试，这正确地验证了一个类的接口是否有效。您根本不必为了进行单元测试而更改您的课程。如果您正在寻找一种方法来验证对象的内部状态以使其保持一致，则应查看[按契约设计的](http://en.wikipedia.org/wiki/Design_by_contract)方法，该方法可以从对象内部验证内部状态。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T21:06:09.420

那些很好。我通常还希望测试类不仅与原始类分开，而且在完全不同的 DLL/EXE 中，以及从它被编译成的“真实”DLL/EXE 中测试“真实”编译类.

我发现的另一种技术是在测试工具中重新定义类。准确复制类定义，但要公开所有内容。这允许测试工具对类进行“白盒”访问，但实际实现仍然来自真实的类代码。

IE

```
class myClass
{
private:
    int foo;
public:
    myClass() { foo = 0; }
} 
```

进而：

```
class test_myClass
{
public:
    int foo;
public:
    test_myClass();
};

void test()
{
    myClass *c = new myClass();
    test_myClass *t = (test_myClass*)c;
    // All methods are called on c.
    // White-box access is available through t.
}; 
```

哦... DevStudio 2008 现在有一些非常酷的单元测试功能，包括声明“朋友”*程序集*的能力，它允许白盒访问正在测试的程序集中的所有内部类。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T21:06:11.383

我做了很多框架构建——基本上是调用我想测试的类/接口。课堂上没有额外的工作。

我还构建了几次使公共方法虚拟化的类。我从这些派生并制作了测试类/对象。测试对象方法称为父（真实类）方法，并记录所有调用和结果。这更多的是用于记录而不是测试，但它也很有效。

上面的方法是我在单元测试之类的所有炒作之前所做的。（大约在 1990 年代后期）

那时它对我来说效果很好，但我对 Junit/nunit 的东西并没有做太多，我渴望真正让他们在实际项目中试一试。

一种方法的样本

类的东西

{...

公共：虚拟DoStuff（）；. .. };

类 ThingTest : 公共事物

{

虚拟 DoStuff()

{

//记录调用和参数。

// 调用父级

// 记录返回值

// 返回返回值

}

};

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-04T21:08:48.960

eJames 是对的 单元测试需要关注类的输入产生正确输出的接口。任何私有或友元变量都是实现的一部分，没有经过专门测试。

如果您在班级的私人例程中犯了错误，那么它将显示不正确的输出。

# sql - 简单的 SQL 代码避开了我.. 合并两个不匹配的表

> ID：342044
> 
> 赞同：1
> 
> 时间：2008-12-04T20:59:55.187
> 
> 标签：sql, join, union, sql-update

我从 1 个表中选择 1 个字段并将其存储到临时表中。

有时该表以 0 行结束。

我想将该字段添加到另一个具有 20 多个字段的表中

由于字段 # 不匹配，常规联合对我不起作用。外部对我不起作用，因为没有什么可比较的。NVL 不适用于第一个临时表。

有人知道该怎么做吗？

**更新：**

我没有提到......当检索 1 个字段的表在其他情况下找到匹配项时，我现在使用的这段代码可以工作......

```
SELECT DISTINCT reqhead_rec.resp_name<br>
FROM reqhead_rec, biglist<br>
WHERE reqhead_rec.req_no = biglist.req_no
 AND reqhead_rec.frm = biglist.req_frm<br>
INTO TEMP grabname with no log;

SELECT biglist.*, grabname.resp_name<br>
FROM biglist, grabname<br>
ORDER BY prnt_item, account_amt<br>
INTO TEMP xxx with no log; 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T21:06:17.220

听起来您确实想要加入，而不是工会。

您无需比较任何内容即可进行连接。如果您不指定连接条件，您最终会得到一个叉积：

```
SELECT t20.*, t1.*
FROM table_with_20_columns AS t20
  LEFT OUTER JOIN temp_table_with_1_column AS t1 ON (1=1); 
```

当临时表中的行数为零时，将在上述查询的结果中报告为 NULL。

但是，如果临时表中有多行，您将获得与第一个表的叉积。我无法从你的问题中看出你想要什么。

**编辑：**`ON` or子句中表达的连接条件`USING`根据 SQL 标准应该是可选的，但至少在我在 MySQL 5.0 中测试它时，省略该子句是语法错误。但是你可以使用`ON (1=1)`.

**编辑：**在评论中回答您的问题：

```
SELECT COALESCE(reqhead_rec.resp_name, dflt.resp_name) AS resp_name
FROM (SELECT 'default name' AS resp_name) dflt
  LEFT OUTER JOIN reqhead_rec ON (1=1)
WHERE reqhead_rec.req_no = biglist.req_no AND reqhead_rec.frm = biglist.req_frm 
INTO TEMP grabname WITH NO LOG; 
```

实际上，您可以完全跳过临时表。只需将您的主表左连接到`reahead_rec`. 将这些条件放入`ON`连接的子句中，而不是`WHERE`子句中。然后`COALESCE()`在该查询的选择列表中使用，以在另一个表中找不到默认名称时给出默认名称。

```
SELECT b.*, COALESCE(r.resp_name, 'default name') AS resp_name
FROM biglist AS b
  LEFT OUTER JOIN reqhead_rec AS r
    ON (b.req_no = r.req_no AND r.frm = b.req_frm)
INTO TEMP xxx WITH NO LOG; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-04T21:10:41.967

它会匹配什么领域？顺便说一句，这是排列它们的方法：

```
SELECT NULL, NULL, NULL, NULL, MySingleField, NULL, NULL, NULL... FROM #temp
UNION ALL
SELECT Col1, Col2, Col3, Col4, Col5, Col6,... FROM OtherTable 
```

更新：

好的，在阅读了您的更新之后...我认为您根本不想要一个 UNION，而是非常简单的 SUBSELECT

```
SELECT
    *,
    (SELECT TOP 1 Name FROM Blah WHERE Blah.SomeID = MyTable.SomeID) AS ExtraCol
FROM
    MyTable 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-11-26T04:27:43.447

尝试选择`nvl(NULL,NULL)`缺失值

# friendly-url - When is it OK to intentionally obfuscate URLs?

> ID：342048
> 
> 赞同：2
> 
> 时间：2008-12-04T21:01:07.197
> 
> 标签：friendly-url

Having friendly URLs is generally a good thing. However, there are sometimes when it seems like a bad idea. What is your rule of thumb?

For instance, consider a situation where I want to show a Registration Success page. I want all of the underlying logic to be the same. However, depending on how they registered, I may want to display a different message for someone who registered under a certain type of role.

Here are a few, off-the-cuff examples of ["hackable"](http://www.useit.com/alertbox/990321.html) (as described in link) URLs:

*   [http://www.example.com/RegistrationSuccess.aspx?IsCertainRole=true](http://www.example.com/RegistrationSuccess.aspx?IsCertainRole=true)
*   [http://www.example.com/RegistrationSuccess.aspx?role=CertainRole](http://www.example.com/RegistrationSuccess.aspx?role=CertainRole)
*   [http://www.example.com/RegistrationSuccess.aspx?r=2876](http://www.example.com/RegistrationSuccess.aspx?r=2876)

All of these seem bad since I don't want the URLs to be discoverable. On the other hand, I hate to do something more complex just to modify the success message slightly.

**How would you handle this?**

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-04T21:14:08.747

Bear in mind that obfuscating URLs is **NOT** a security measure. You should never trust outside input - filter, sanitize and implement restrictive logic. No matter how clever you believe your obfuscation scheme to be, people have cracked much more complicated security schemes with relative ease.

As a general rule of thumb - there is no good reason to obfuscate URLs intentionally. Use URLs to communicate read operations (a path to a resource). Use POST requests to communicate write operations (adding/modifying data). If a user isn't supposed to be able to do something through the URL, it should be regulated server side and through the request method.

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-04T21:11:05.837

You can either POST the data, or, if that's not an option, set the value in a Session variable and then read the value in the success page. The actual complexity of code using the Session is about the same as using the query string.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-04T21:27:23.730

Ok, if you don't think this is a security issue since you are only displaying a different message, then why do you care if its hackable or not?

Most users won't wouldn't notice the url is editable, so why obfuscate? The "elite hackers" will get a slightly different message, big deal.

The general answer to, "Should I obfuscate...?" is **no**. If its for security, **hell no**, otherwise why are you obfuscating? Most likely, you are wasting time.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-04T22:21:45.927

URL's are for uniquely referencing content. When the contents are the results of a process that involves several steps of dialogue, these contents can't really have a URL, because the URL does not reproduce the process.

I would forward them to RegistrationSuccess.aspx and present contents there based on the state of the session.

If somebody comes to that URL without the suitable session state, I would forward them to the front page after 5 seconds of looking at a friendly message explaining that there is nothing to see.

A better choice yet, may be to forward them to MyRegistration.aspx which is something they would perhaps like to make a favourite out of. Coming from the Registration process, it may have a box explaining that they have successfully registered. If they not coming there from the Registration process, this box is not presented. The rest of the page is the summary of all earlier Registration processes for that user.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-04T21:04:30.263

With a post submission?

If you don't want information in the URL, don't put it in the URL.

It's not always easy to do...

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-04T21:06:23.490

I would say that pages that you want to be easily indexed by the search engines use URL Routing. This includes high traffic pages.

For other pages where the users will only visit few times a month or year you can leave those to be normal urls.

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-04T21:10:18.413

If you must absolutely use the URL for private/personalized data, you'd probably be better off generating a random unique identifier on the server and using that in your URL. Kind of like confirmation e-mails where you have to click a link.

Otherwise, if there's any other way to *not* include data in the URL, you shouldn't. In the case of a successful registration, either the person just registered and you should be in a current session, or you should require them to login before they see the customized page.

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-04T21:10:35.680

Why not make "registration success" message be a last step, but not change pages?

You can use Ajax or [Server.Transfer()](http://msdn.microsoft.com/en-us/library/ms525800.aspx) to do that.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-04T21:20:23.697

I could check from a whitelist of referring URLs so that they can't just type in a different URL. That might eliminate obvious "hack" from a passerby.

(Obviously, you can get around this if you're a nerd.)

* * *

## 回答 #10

> 赞同：-2
> 
> 时间：2008-12-04T21:14:41.150

You could make some sort of checksum or hash on the querystring items, so if they mess around with the URL, the checksum fails and it kicks them out to the main page.

# sharepoint - 如何安装 Reporting Services 报表查看器 WebPart？

> ID：342051
> 
> 赞同：0
> 
> 时间：2008-12-04T21:02:09.987
> 
> 标签：sharepoint, reporting-services

我正在尝试将 Reporting Services 报表查看器 WebPart 与我正在处理的项目一起使用，但我似乎无法清楚地了解它的确切来源（或者我可能只是不明白？）。 [此页面](http://msdn.microsoft.com/en-us/library/bb326422(SQL.90).aspx)表明它是“由 SharePoint 技术的 Reporting Services 加载项安装的”。但是，我似乎无法确切地弄清楚那是哪里/是什么。

有人可以指出我正确的方向吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T21:09:20.490

实际上，我想我刚刚[找到它](http://www.microsoft.com/downloads/details.aspx?familyid=1E53F882-0C16-4847-B331-132274AE8C84&displaylang=en)！

# java - 如何通过所有可能性增加java字符串？

> ID：342052
> 
> 赞同：18
> 
> 时间：2008-12-04T21:02:24.323
> 
> 标签：java, string

我需要通过字母表将java中的字符串从“aaaaaaaa”增加到“aaaaaaab”到“aaaaaac”，然后最终增加到“aaaaaaaba”到“aaaaaabb”等等。

这有什么诀窍吗？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-12-04T21:15:01.943

您基本上是在实施带有前导“零”（“a”）的[Base 26 数字系统。](http://en.wikipedia.org/wiki/Base_26)

您执行此操作的方式与将 int 转换为 base-2 或 base-10 字符串相同，但不是使用 2 或 10，而是使用 26，而不是使用“0”作为基数，而是使用“a”。

在 Java 中，您可以轻松地使用它：

```
public static String base26(int num) {
  if (num < 0) {
    throw new IllegalArgumentException("Only positive numbers are supported");
  }
  StringBuilder s = new StringBuilder("aaaaaaa");
  for (int pos = 6; pos >= 0 && num > 0 ; pos--) {
    char digit = (char) ('a' + num % 26);
    s.setCharAt(pos, digit);
    num = num / 26;
  }
  return s.toString();
} 
```

基本思想是不存储字符串，而只存储一些计数器（int an int 或 long，取决于您的要求）并根据需要将其转换为 String。这样您就可以轻松地增加/减少/修改您的计数器，而无需解析和重新创建字符串。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2010-02-25T23:25:16.173

以下代码使用递归方法来获取下一个字符串（例如，从“aaaa”到“aaab”等等），而不需要生成所有先前的组合，因此它相当快并且不限于给定的最大值字符串长度。

```
public class StringInc {
 public static void main(String[] args) {
   System.out.println(next("aaa")); // Prints aab

   System.out.println(next("abcdzz")); // Prints abceaa

   System.out.println(next("zzz")); // Prints aaaa
 }

 public static String next(String s) {
   int length = s.length();
   char c = s.charAt(length - 1);

   if(c == 'z')
     return length > 1 ? next(s.substring(0, length - 1)) + 'a' : "aa";

   return s.substring(0, length - 1) + ++c;
 }
} 
```

正如一些人指出的那样，这是尾递归，因此您可以重新制定它，用循环替换递归。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-04T21:15:47.027

递增最后一个字符，如果达到 Z，则将其重置为 A 并移动到前一个字符。重复直到找到不是 Z 的字符。因为字符串是不可变的，我建议使用字符数组来避免分配大量新对象。

```
public static void incrementString(char[] str)
{
    for(int pos = str.length - 1; pos >= 0; pos--)
    {
        if(Character.toUpperCase(str[pos]) != 'Z')
        {
            str[pos]++;
            break;
        }
        else
            str[pos] = 'a';
    }
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T00:06:18.883

您可以使用大整数的 toString(radix) 方法，例如：

```
import java.math.BigInteger;
public class Strings {
    Strings(final int digits,final int radix) {
        this(digits,radix,BigInteger.ZERO);
    }
    Strings(final int digits,final int radix,final BigInteger number) {
        this.digits=digits;
        this.radix=radix;
        this.number=number;
    }
    void addOne() {
        number=number.add(BigInteger.ONE);
    }
    public String toString() {
        String s=number.toString(radix);
        while(s.length()<digits)
            s='0'+s;
        return s;
    }
    public char convert(final char c) {
        if('0'<=c&&c<='9')
            return (char)('a'+(c-'0'));
        else if('a'<=c&&c<='p')
            return (char)(c+10);
        else throw new RuntimeException("more logic required for radix: "+radix);
    }
    public char convertInverse(final char c) {
        if('a'<=c&&c<='j')
            return (char)('0'+(c-'a'));
        else if('k'<=c&&c<='z')
            return (char)(c-10);
        else throw new RuntimeException("more logic required for radix: "+radix);
    }
    void testFix() {
        for(int i=0;i<radix;i++)
            if(convert(convertInverse((char)('a'+i)))!='a'+i)
                throw new RuntimeException("testFix fails for "+i);
    }
    public String toMyString() {
        String s=toString(),t="";
        for(int i=0;i<s.length();i++)
            t+=convert(s.charAt(i));
        return t;
    }
    public static void main(String[] arguments) {
        Strings strings=new Strings(8,26);
        strings.testFix();
        System.out.println(strings.number.toString()+' '+strings+' '+strings.toMyString());
        for(int i=0;i<Math.pow(strings.radix,3);i++)
            try {
                strings.addOne();
                if(Math.abs(i-i/strings.radix*strings.radix)<2)
                    System.out.println(strings.number.toString()+' '+strings+' '+strings.toMyString());
            } catch(Exception e) {
                System.out.println(""+i+' '+strings+" failed!");
            }
    }
    final int digits,radix;
    BigInteger number;
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-05T01:37:06.220

如果您只想要最终结果，我必须同意@saua 的方法，但如果您想要每个结果，这里会有一些细微的变化。

请注意，由于有 26^8（或 208827064576）个不同的可能字符串，我怀疑您是否想要全部。也就是说，我的代码将它们打印出来，而不是只将一个存储在 String Builder 中。（不过，这并不重要。）

```
 public static void base26(int maxLength) {
    buildWord(maxLength, "");
  }
  public static void buildWord(int remaining, String word)
  {
    if (remaining == 0)
    {
      System.out.println(word);
    }
    else
    {
      for (char letter = 'A'; letter <= 'Z'; ++letter)
      {
        buildWord(remaining-1, word + letter);
      }
    }
  }

  public static void main(String[] args)
  {
    base26(8);
  } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-04T21:12:15.037

我会创建一个字符数组并单独增加字符。字符串在 Java 中是不可变的，因此每次更改都会在堆上创建一个新位置，从而导致内存不断增长。

使用字符数组，你不应该有这个问题......

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-04T21:13:55.113

有一个包含 ascii 值的字节数组，并有循环在进行结转时增加最右边的数字。

然后使用创建字符串

```
public String(byte[] bytes, String charsetName) 
```

确保将字符集作为 US-ASCII 或 UTF-8 传递以明确。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-04T23:04:58.837

只是扩展示例，至于实现，考虑将其放入一个类中......每次调用该类的 toString 时，它都会返回下一个值：

```
public class Permutator {

    private int permutation;

    private int permutations; 

    private StringBuilder stringbuilder;

    public Permutator(final int LETTERS) {

        if (LETTERS < 1) {
            throw new IllegalArgumentException("Usage: Permutator( \"1 or Greater Required\" \)");
        }

        this.permutation = 0;

        // MAGIC NUMBER : 26 = Number of Letters in the English Alphabet 
        this.permutations = (int) Math.pow(26, LETTERS);

        this.stringbuilder = new StringBuilder();

        for (int i = 0; i < LETTERS; ++i) {
            this.stringbuilder.append('a');
        }
    }

    public String getCount() {

        return String.format("Permutation: %s of %s Permutations.", this.permutation, this.permutations);
    }

    public int getPermutation() {

        return this.permutation;
    }

    public int getPermutations() {

        return this.permutations;
    }

    private void permutate() {

        // TODO: Implement Utilising one of the Examples Posted.
    } 

    public String toString() {

        this.permutate();

        return this.stringbuilder.toString();
    }
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-01-21T09:47:10.370

在@cyberz 的解决方案的基础上，以下代码是一个示例，说明如何编写递归调用，该调用可由支持[Tail Recursion](https://stackoverflow.com/a/37010/2504224)的编译器进行优化。

代码是用 Groovy 编写的，因为它运行在 JVM 上，它的语法非常类似于 Java，它的编译器支持尾递归优化

```
static String next(String input) {
    return doNext(input, "")
}

@TailRecursive
@CompileStatic
static String doNext(String input, String result) {
    if(!self) {
        return result
    }

    final String last = input[-1]
    final String nonLast = self.substring(0, input.size()-1)
    if('z' == last) {
        return doNext(nonLast, (nonLast ? 'a' : 'aa') + result)
    }

    return doNext('', nonLast + (((last as Character) + 1) as Character).toString() + result)
} 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-02-27T07:38:13.350

由于没有一个答案对我有用，我编写了自己的代码：

```
/**
 * Increases the given String value by one. Examples (with min 'a' and max 'z'): <p>
 * 
 * - "aaa" -> "aab" <br>
 * - "aab" -> "aac" <br>
 * - "aaz" -> "aba" <br>
 * - "zzz" -> "aaaa" <br>
 * 
 * @param s
 * @param min lowest char (a zero)
 * @param max highest char (e.g. a 9, in a decimal system)
 * @return increased String by 1
 */
public static String incString(String s, char min, char max) {
    char last = s.charAt(s.length() - 1);
    if (++last > max)
        return s.length() > 1 ? incString(s.substring(0, s.length()-1), min, max) + min : "" + min + min;
    else
        return s.substring(0, s.length()-1) + last;
} 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-10-29T14:53:00.257

```
public static String incrementString(String string)
{
    if(string.length()==1)
    {
        if(string.equals("z"))
            return "aa";
        else if(string.equals("Z"))
            return "Aa";
        else
            return (char)(string.charAt(0)+1)+"";
    }   
    if(string.charAt(string.length()-1)!='z')
    {
        return string.substring(0, string.length()-1)+(char)(string.charAt(string.length()-1)+1);
    }
    return incrementString(string.substring(0, string.length()-1))+"a";
} 
```

适用于所有包含字母的标准字符串

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2021-01-30T08:59:42.573

我有使用 for 循环的方法，这很容易理解。基于[答案]：[https:](https://stackoverflow.com/a/2338415/9675605) //stackoverflow.com/a/2338415/9675605 cyberz 答案。这也使用 org.apache.commons.lang3.ArrayUtils。在第一个位置插入字母。您可以为它创建自己的实用程序。如果有人觉得有帮助。

```
import org.apache.commons.lang3.ArrayUtils;
public class StringInc {
 public static void main(String[] args) {
   System.out.println(next("aaa")); // Prints aab

   System.out.println(next("abcdzz")); // Prints abceaa

   System.out.println(next("zzz")); // Prints aaaa
 }

 public static String next(String str) {
    boolean increment = true;
    char[] arr = str.toCharArray();
    for (int i = arr.length - 1; i >= 0 && increment; i--) {
      char letter = arr[i];
      if (letter != 'z') {
        letter++;
        increment = false;
      } else {
        letter = 'a';
      }
      arr[i] = letter;
    }
    if (increment) {
      arr = ArrayUtils.insert(0, arr, 'a');
    }
    return new String(arr);
} 
```

* * *

## 回答 #13

> 赞同：-3
> 
> 时间：2008-12-04T21:15:56.340

这不是什么“技巧”，但这适用于 4 字符字符串。显然，更长的字符串会变得更丑，但想法是一样的。

```
char array[] = new char[4];
for (char c0 = 'a'; c0 <= 'z'; c0++) {
  array[0] = c0;
  for (char c1 = 'a'; c1 <= 'z'; c1++) {
    array[1] = c1;
    for (char c2 = 'a'; c2 <= 'z'; c2++) {
      array[2] = c2;
      for (char c3 = 'a'; c3 <= 'z'; c3++) {
        array[3] = c3;
        String s = new String(array);
        System.out.println(s);
      }
    }
  }
} 
```

# filesystems - 读取引导磁盘上的扇区

> ID：342057
> 
> 赞同：4
> 
> 时间：2008-12-04T21:03:26.820
> 
> 标签：filesystems, dd, sector

这是我关于[阅读 superblock](https://stackoverflow.com/questions/339795/reading-the-superblock)的问题的延续。

假设我想针对 Mac OS X 中的 HFS+ 文件系统。我如何读取引导盘的第 2 扇区？据我所知，Unix 只提供系统调用来读取文件，这些文件永远不会存储在那个位置。

这是否需要 1) 程序运行内核模式，或 2) 程序以汇编语言编写？我宁愿避免这些限制中的任何一个，尤其是后者。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T17:58:47.110

我自己在 Mac 上完成了这项工作，请参阅我的磁盘编辑器工具：[http ://apps.tempel.org/iBored](http://apps.tempel.org/iBored)

您可以使用 /dev/diskN 或 /dev/rdiskN 打开驱动器（N 是从 0 开始的磁盘索引号）。然后您可以使用 lseek（确保使用 64 位范围的版本！）并对打开的文件进行读/写调用。

此外，使用 shell 命令“ls /dev/disk*”查看当前存在哪些驱动器。请注意，驱动器也存在“sM”扩展名，其中 M 是分区号。这样，也可以直接读取分区。

或者，您可以只使用 shell 工具“xxd”或“dd”来读取数据，然后使用它们的输出。可能会更容易。

但是，除非您以 root 身份运行，否则您将无法读取您的根磁盘和其他内部磁盘。只要用户安装了其他驱动器，或者禁用了它们的权限，您就可以访问其他驱动器。但您可能还需要先卸载驱动器的卷。在 shell 命令“diskutil”中查找卸载命令。

希望这可以帮助。

2017 年更新：在 OS X 10.11 及更高版本上，[SIP](https://stackoverflow.com/q/30768087/43615)也可能会阻止您直接访问磁盘扇区。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-04T21:10:29.380

在 Linux 中，您可以从特殊设备文件中读取`/dev/sda`，假设您要读取的硬盘是第一个。您需要是 root 才能读取此文件。要读取扇区 2，您只需寻求偏移`2*SECTOR_SIZE`并以`SECTOR_SIZE`字节为单位读取。

我不知道这个设备文件在 OS X 上是否可用。检查下有趣命名的文件，`/dev`例如`/dev/sda`或`/dev/hda`。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-04T21:38:01.680

我还建议点击卷的 /dev/ 设备文件，但您可能想联系 Amit Singh，他编写了一个[hfsdebug 实用程序](http://osxbook.com/software/hfsdebug/)并且可能已经完成了您想做的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T04:08:07.367

这在权限方面是如何工作的？从 /dev/... 读取不会不安全，因为如果您阅读得足够远，您将能够读取您没有读取权限的文件？

# c# - 读取和更新文件流

> ID：342080
> 
> 赞同：0
> 
> 时间：2008-12-04T21:10:51.203
> 
> 标签：c#, .net, filereader, filewriter

我有一个小实用程序可以搜索多个文件。我不得不创建它，因为 Google 和 Windows 桌面搜索都没有在文件中找到合适的行。搜索工作正常（我愿意改进它），但我想添加到我的实用程序中的一件事是批量查找/替换。

那么如何从文件中读取一行，将其与搜索词进行比较，如果它通过，然后更新该行，并继续浏览文件的其余部分，那么最好的方法是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T21:14:31.803

我会为每个文件执行以下操作：

*   像往常一样进行搜索。还要检查要替换的令牌。看到它后，请重新启动该文件。如果您没有看到要替换的令牌，那么您就完成了。
*   当您重新开始时，创建一个新文件并复制从输入文件中读取的每一行，随时进行替换。
*   完成文件后：
    *   将当前文件移动到备份文件名
    *   将新文件移动到原始文件名
    *   删除备份文件

请注意不要在二进制文件等上执行此操作 - 对二进制文件进行文本搜索和替换的后果通常是可怕的！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-07T15:13:19.940

如果 PowerShell 是一个选项，则下面定义的函数可用于跨文件执行查找和替换。例如，要`'a string'`在当前目录中的文本文件中查找，您可以：

```
dir *.txt | FindReplace 'a string' 
```

要替换`'a string'`为另一个值，只需在末尾添加新值：

```
dir *.txt | FindReplace 'a string' 'replacement string' 
```

您也可以使用`FindReplace -path MyFile.txt 'a string'`.

```
function FindReplace( [string]$search, [string]$replace, [string[]]$path ) {
  # Include paths from pipeline input.
  $path += @($input)

  # Find all matches in the specified files.
  $matches = Select-String -path $path -pattern $search -simpleMatch

  # If replacement value was given, perform replacements.
  if( $replace ) {
    # Group matches by file path.
    $matches | group -property Path | % {
      $content = Get-Content $_.Name

      # Replace all matching lines in current file.
      foreach( $match in $_.Group ) {
        $index = $match.LineNumber - 1
        $line = $content[$index]
        $updatedLine = $line -replace $search,$replace
        $content[$index] = $updatedLine

        # Update match with new line value.
        $match | Add-Member NoteProperty UpdatedLine $updatedLine
      }

      # Update file content.
      Set-Content $_.Name $content
    }
  }

  # Return matches.
  $matches
} 
```

请注意，它`Select-String`也支持正则表达式匹配，但为了简单起见，仅限于简单匹配；）您还可以像[Jon](https://stackoverflow.com/questions/342080/read-update-filestream#342099)建议的那样执行更强大的替换，而不仅仅是用新内容覆盖文件。

# cocoa - 在 Interface Builder 中调整控件大小以适合其容器

> ID：342082
> 
> 赞同：2
> 
> 时间：2008-12-04T21:11:04.167
> 
> 标签：cocoa, interface-builder

假设我有一个拆分视图，我想用表格视图填充其中的一半（我认为这是一个相当常见的用例）。有没有办法告诉表格视图调整自己的大小以适应拆分视图，还是我真的必须手动调整它的大小？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-06T01:09:57.117

我已经这样做了，就像 Jon Hess 首先提到的那样。假设您使用的是 Interface Builder 版本 3：

1.  拖动并调整您的 GUI（我理解的表格视图？）组件的大小，以按照您想要的方式放入封闭区域。

2.  单击它以选择它。

3.  按 Command-Shift-I 打开此 GUI 组件的检查器窗口。检查器窗口现在应该实际显示您选择了“滚动视图”。

4.  单击“标尺”标题可以设置大小。您将在右侧看到您的 GUI 组件在其封闭的 GUI 组件中的行为方式的动画表示，在左侧看到另一个相同的表示，没有动画，但有四个弹簧和两个支柱，您可以打开或关闭.

5.  打开所有六件事，使它们变成红色。

瞧 :-)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-06T02:35:48.410

首先创建子视图通常更容易，然后使用 Layout/Embed Objects In/Split View 菜单项围绕它们创建拆分视图。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-04T21:21:12.650

据我所知，手动操作是唯一的方法。但是，如果您打开“对齐可可指南”，则内部视图将在您向其拖动时对齐到封闭视图的边缘。这比手动将边缘鼠标定位到位或手动编辑尺寸以匹配更容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-06T00:47:19.783

您可以在尺寸检查器中将表格视图的所有弹簧和支柱设置为“打开”，这将导致表格视图填充拆分视图。或者，您可以使用主文档窗口中的大纲视图将 tableview 的封闭滚动视图直接放入 splitview 而不是中间自定义视图中。

# c# - 无需登录即可在 Intranet 上获取 Web 应用程序的域\用户名

> ID：342088
> 
> 赞同：4
> 
> 时间：2008-12-04T21:13:04.180
> 
> 标签：c#, asp.net

我在我们的 Intranet 上有一个 Web 应用程序（VS 2005）。有几个页面不需要用户登录到应用程序（反馈和默认页面）。我正在尝试获取域和用户名以显示和/或发送反馈。有没有办法在不需要用户登录的情况下做到这一点？我试过`this.Request.ServerVariables["LOGON_USER"]`and `this.User.Identity.Name`，但他们都没有工作。

编辑：
我应该提到大多数用户在他们的机器上安装了 Windows 2000。它适用于我的开发机器（XP），但不适用于生产网络（我有 2000 台）。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T21:19:31.543

Theresa, I think this is what you're looking for...

```
AppDomain.CurrentDomain.SetPrincipalPolicy(PrincipalPolicy.WindowsPrincipal);

WindowsPrincipal principal = (WindowsPrincipal)Thread.CurrentPrincipal;
WindowsIdentity identity = (WindowsIdentity)principal.Identity;

String userName= principal.Identity.Name; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-01-16T13:36:34.937

假设您已在 IIS 中为您的站点打开 Windows 身份验证：

```
public string user_Name
{
    get
    {
        string x = Page.User.Identity.Name;

        x = x.Replace("YOURDOMAIN\\", "");

        return x;
    }
} 
```

x = x.Replace("DOMAIN\", ""); 删除用户帐户的 DOMAIN 部分，例如 NISSAN\rmcdonough

# bash - PS1 line-wrapping with colours problem

> ID：342093
> 
> 赞同：42
> 
> 时间：2008-12-04T21:14:10.400
> 
> 标签：bash, profile, environment

Here's my PS1 variable:

```
PS1='\u:\W$(__git_ps1 "\e[32m\][%s]\e[0m\]")$ ' 
```

Works great for picking up my Git branch, but it has the unfortunate side-effect of wrapping the lines when the colours are active, so that they overlap when you use long commands.

Can anyone with magic PS1 skills help me out to fix this?

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2008-12-04T21:24:31.893

Got it, needed to escape the colours properly.

Fix:

```
PS1='\u:\W$(__git_ps1 "\[\e[32m\][%s]\[\e[0m\]")$ ' 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-11-09T20:29:06.833

May I suggest the following method for colors in Bash, it makes the code much more readable and alot harder for you to miss an escape or two.

Put the following in your ~/.bashrc

```
BLACK=$(tput setaf 0)
RED=$(tput setaf 1)
GREEN=$(tput setaf 2)
LIME_YELLOW=$(tput setaf 190)
YELLOW=$(tput setaf 3)
POWDER_BLUE=$(tput setaf 153)
BLUE=$(tput setaf 4)
MAGENTA=$(tput setaf 5)
CYAN=$(tput setaf 6)
WHITE=$(tput setaf 7)
BRIGHT=$(tput bold)
NORMAL=$(tput sgr0)
BLINK=$(tput blink)
REVERSE=$(tput smso)
UNDERLINE=$(tput smul) 
```

A sample PS1 (or really anything that prints to the screen) would be:

```
 PS1="\[${WHITE}\](\[${YELLOW}\]\u@\h\[${WHITE}\])\[${NORMAL}\]$ " 
```

You need only put \[ \] around the color words.

If you have a 256-color terminal, you can experiment with other numerical values to 'tput setaf' all the way up to 255.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2011-07-13T07:06:09.603

These are the color functions I use regularly... wrote them years ago and have gotten so used to them that they're a regular part of my scripting. Just stick this code block into your .bashrc file, start a new session, and you're set!

I use these as colorful/stylish printf replacements:

```
## ∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞ ##
## ∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞ [ Aesthir's Color Functions ] ∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞ ##
## ∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞ ##
Normal () { printf '\e[m'"$*"; }                  ; Tblack () { printf '\e[0;30m'"$*"'\e[m'; }
TNormal () { printf '\e[m'"$*"; }                 ; Tred () { printf '\e[0;31m'"$*"'\e[m'; }
Bold () { printf '\e[1m'"$*"'\e[m'; }             ; Tgreen () { printf '\e[0;32m'"$*"'\e[m'; }
TBold () { printf '\e[1m'"$*"'\e[m'; }            ; Tbrown () { printf '\e[0;33m'"$*"'\e[m'; }
Underline () { printf '\e[4m'"$*"'\e[m'; }        ; Tyellow () { printf '\e[0;33m'"$*"'\e[m'; }
TUnderline () { printf '\e[4m'"$*"'\e[m'; }       ; Tblue () { printf '\e[0;34m'"$*"'\e[m'; }
Flash () { printf '\e[5m'"$*"'\e[m'; }            ; Tmagenta () { printf '\e[0;35m'"$*"'\e[m'; }
TFlash () { printf '\e[5m'"$*"'\e[m'; }           ; Tpurple () { printf '\e[0;35m'"$*"'\e[m'; }
Invert () { printf '\e[7m'"$*"'\e[m'; }           ; Taqua () { printf '\e[0;36m'"$*"'\e[m'; }
TInvert () { printf '\e[7m'"$*"'\e[m'; }          ; Tcyan () { printf '\e[0;36m'"$*"'\e[m'; }
Invisible () { printf '\e[8m'"$*"'\e[m'; }        ; Tgrey () { printf '\e[0;37m'"$*"'\e[m'; }
TInvisible () { printf '\e[8m'"$*"'\e[m'; }       ; Twhite () { printf '\e[0;37m'"$*"'\e[m'; }
## ∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞ Bold Color Text ∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞ ## ∞∞∞∞∞∞∞∞∞∞∞∞ Underlined Color Text ∞∞∞∞∞∞∞∞∞∞∞∞∞ ##
TblackB () { printf '\e[1;30m'"$*"'\e[m'; }       ; TblackU () { printf '\e[4;30m'"$*"'\e[m'; }
TgreyB () { printf '\e[1;30m'"$*"'\e[m'; }        ; TredU () { printf '\e[4;31m'"$*"'\e[m'; }
TredB () { printf '\e[1;31m'"$*"'\e[m'; }         ; TgreenU () { printf '\e[4;32m'"$*"'\e[m'; }
TgreenB () { printf '\e[1;32m'"$*"'\e[m'; }       ; TbrownU () { printf '\e[4;33m'"$*"'\e[m'; }
TbrownB () { printf '\e[1;33m'"$*"'\e[m'; }       ; TyellowU () { printf '\e[4;33m'"$*"'\e[m'; }
TyellowB () { printf '\e[1;33m'"$*"'\e[m'; }      ; TblueU () { printf '\e[4;34m'"$*"'\e[m'; }
TblueB () { printf '\e[1;34m'"$*"'\e[m'; }        ; TmagentaU () { printf '\e[4;35m'"$*"'\e[m'; }
TmagentaB () { printf '\e[1;35m'"$*"'\e[m'; }     ; TpurpleU () { printf '\e[4;35m'"$*"'\e[m'; }
TpurpleB () { printf '\e[1;35m'"$*"'\e[m'; }      ; TaquaU () { printf '\e[4;36m'"$*"'\e[m'; }
TaquaB () { printf '\e[1;36m'"$*"'\e[m'; }        ; TcyanU () { printf '\e[4;36m'"$*"'\e[m'; }
TcyanB () { printf '\e[1;36m'"$*"'\e[m'; }        ; TgreyU () { printf '\e[4;37m'"$*"'\e[m'; }
TwhiteB () { printf '\e[1;37m'"$*"'\e[m'; }       ; TwhiteU () { printf '\e[4;37m'"$*"'\e[m'; }
## ∞∞∞∞∞∞∞∞∞∞∞∞∞ Flashing Color Text ∞∞∞∞∞∞∞∞∞∞∞∞∞∞ ## ∞∞∞∞∞∞∞∞∞∞∞∞∞ Inverted Color Text ∞∞∞∞∞∞∞∞∞∞∞∞∞∞ ##
TblackF () { printf '\e[5;30m'"$*"'\e[m'; }       ; TblackI () { printf '\e[7;40m'"$*"'\e[m'; }
TredF () { printf '\e[5;31m'"$*"'\e[m'; }         ; TredI () { printf '\e[7;41m'"$*"'\e[m'; }
TgreenF () { printf '\e[5;32m'"$*"'\e[m'; }       ; TgreenI () { printf '\e[7;42m'"$*"'\e[m'; }
TbrownF () { printf '\e[5;33m'"$*"'\e[m'; }       ; TbrownI () { printf '\e[7;43m'"$*"'\e[m'; }
TyellowF () { printf '\e[5;33m'"$*"'\e[m'; }      ; TyellowI () { printf '\e[7;43m'"$*"'\e[m'; }
TblueF () { printf '\e[5;34m'"$*"'\e[m'; }        ; TblueI () { printf '\e[7;44m'"$*"'\e[m'; }
TmagentaF () { printf '\e[5;35m'"$*"'\e[m'; }     ; TmagentaI () { printf '\e[7;45m'"$*"'\e[m'; }
TpurpleF () { printf '\e[5;35m'"$*"'\e[m'; }      ; TpurpleI () { printf '\e[7;45m'"$*"'\e[m'; }
TaquaF () { printf '\e[5;36m'"$*"'\e[m'; }        ; TaquaI () { printf '\e[7;46m'"$*"'\e[m'; }
TcyanF () { printf '\e[5;36m'"$*"'\e[m'; }        ; TcyanI () { printf '\e[7;46m'"$*"'\e[m'; }
TgreyF () { printf '\e[5;37m'"$*"'\e[m'; }        ; TgreyI () { printf '\e[7;47m'"$*"'\e[m'; }
TwhiteF () { printf '\e[5;37m'"$*"'\e[m'; }       ; TwhiteI () { printf '\e[7;47m'"$*"'\e[m'; }
## ∞∞∞∞∞∞∞∞∞∞∞∞∞ Invisible Color Text ∞∞∞∞∞∞∞∞∞∞∞∞∞ ## ∞∞∞∞∞∞∞∞ Plain Text on Color Background ∞∞∞∞∞∞∞∞ ##
TblackV () { printf '\e[8;30m'"$*"'\e[m'; }       ; Bblack () { printf '\e[m'"$*"'\e[m'; }
TredV () { printf '\e[8;31m'"$*"'\e[m'; }         ; Bred () { printf '\e[0;41m'"$*"'\e[m'; }
TgreenV () { printf '\e[8;32m'"$*"'\e[m'; }       ; Bgreen () { printf '\e[0;42m'"$*"'\e[m'; }
TbrownV () { printf '\e[8;33m'"$*"'\e[m'; }       ; Bbrown () { printf '\e[0;43m'"$*"'\e[m'; }
TyellowV () { printf '\e[8;33m'"$*"'\e[m'; }      ; Byellow () { printf '\e[0;43m'"$*"'\e[m'; }
TblueV () { printf '\e[8;34m'"$*"'\e[m'; }        ; Bblue () { printf '\e[0;44m'"$*"'\e[m'; }
TmagentaV () { printf '\e[8;35m'"$*"'\e[m'; }     ; Bmagenta () { printf '\e[0;45m'"$*"'\e[m'; }
TpurpleV () { printf '\e[8;35m'"$*"'\e[m'; }      ; Bpurple () { printf '\e[0;45m'"$*"'\e[m'; }
TaquaV () { printf '\e[8;36m'"$*"'\e[m'; }        ; Baqua () { printf '\e[0;46m'"$*"'\e[m'; }
TcyanV () { printf '\e[8;36m'"$*"'\e[m'; }        ; Bcyan () { printf '\e[0;46m'"$*"'\e[m'; }
TgreyV () { printf '\e[8;37m'"$*"'\e[m'; }        ; Bgrey () { printf '\e[0;47m'"$*"'\e[m'; }
TwhiteV () { printf '\e[8;37m'"$*"'\e[m'; }       ; Bwhite () { printf '\e[0;47m'"$*"'\e[m'; }
## ∞∞∞∞∞∞∞∞∞ Bold Text on Color Background ∞∞∞∞∞∞∞∞ ## ∞∞∞∞∞∞ Underlined Text on Color Background ∞∞∞∞∞ ##
BblackB () { printf '\e[1;40m'"$*"'\e[m'; }       ; BblackU () { printf '\e[4;40m'"$*"'\e[m'; }
BredB () { printf '\e[1;41m'"$*"'\e[m'; }         ; BredU () { printf '\e[4;41m'"$*"'\e[m'; }
BgreenB () { printf '\e[1;42m'"$*"'\e[m'; }       ; BgreenU () { printf '\e[4;42m'"$*"'\e[m'; }
BbrownB () { printf '\e[1;43m'"$*"'\e[m'; }       ; BbrownU () { printf '\e[4;43m'"$*"'\e[m'; }
ByellowB () { printf '\e[1;43m'"$*"'\e[m'; }      ; ByellowU () { printf '\e[4;43m'"$*"'\e[m'; }
BblueB () { printf '\e[1;44m'"$*"'\e[m'; }        ; BblueU () { printf '\e[4;44m'"$*"'\e[m'; }
BmagentaB () { printf '\e[1;45m'"$*"'\e[m'; }     ; BmagentaU () { printf '\e[4;45m'"$*"'\e[m'; }
BpurpleB () { printf '\e[1;45m'"$*"'\e[m'; }      ; BpurpleU () { printf '\e[4;45m'"$*"'\e[m'; }
BaquaB () { printf '\e[1;46m'"$*"'\e[m'; }        ; BaquaU () { printf '\e[4;46m'"$*"'\e[m'; }
BcyanB () { printf '\e[1;46m'"$*"'\e[m'; }        ; BcyanU () { printf '\e[4;46m'"$*"'\e[m'; }
BgreyB () { printf '\e[1;47m'"$*"'\e[m'; }        ; BgreyU () { printf '\e[4;47m'"$*"'\e[m'; }
BwhiteB () { printf '\e[1;47m'"$*"'\e[m'; }       ; BwhiteU () { printf '\e[4;47m'"$*"'\e[m'; }
## ∞∞∞∞∞∞∞ Flashing Text on Color Background ∞∞∞∞∞∞ ## ∞∞∞∞∞∞∞ Inverted Text on Color Background ∞∞∞∞∞∞ ##
BblackF () { printf '\e[5;40m'"$*"'\e[m'; }       ; BblackI () { printf '\e[7;30m'"$*"'\e[m'; }
BredF () { printf '\e[5;41m'"$*"'\e[m'; }         ; BredI () { printf '\e[7;31m'"$*"'\e[m'; }
BgreenF () { printf '\e[5;42m'"$*"'\e[m'; }       ; BgreenI () { printf '\e[7;32m'"$*"'\e[m'; }
BbrownF () { printf '\e[5;43m'"$*"'\e[m'; }       ; BbrownI () { printf '\e[7;33m'"$*"'\e[m'; }
ByellowF () { printf '\e[5;43m'"$*"'\e[m'; }      ; ByellowI () { printf '\e[7;33m'"$*"'\e[m'; }
BblueF () { printf '\e[5;44m'"$*"'\e[m'; }        ; BblueI () { printf '\e[7;34m'"$*"'\e[m'; }
BmagentaF () { printf '\e[5;45m'"$*"'\e[m'; }     ; BmagentaI () { printf '\e[7;35m'"$*"'\e[m'; }
BpurpleF () { printf '\e[5;45m'"$*"'\e[m'; }      ; BpurpleI () { printf '\e[7;35m'"$*"'\e[m'; }
BaquaF () { printf '\e[5;46m'"$*"'\e[m'; }        ; BaquaI () { printf '\e[7;36m'"$*"'\e[m'; }
BcyanF () { printf '\e[5;46m'"$*"'\e[m'; }        ; BcyanI () { printf '\e[7;36m'"$*"'\e[m'; }
BgreyF () { printf '\e[5;47m'"$*"'\e[m'; }        ; BgreyI () { printf '\e[7;37m'"$*"'\e[m'; }
BwhiteF () { printf '\e[5;47m'"$*"'\e[m'; }       ; BwhiteI () { printf '\e[7;37m'"$*"'\e[m'; }
## ∞∞∞∞∞∞ Invisible Text on Color Background ∞∞∞∞∞∞ ## ∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞ Color Code Notes ∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞ ##
BblackV () { printf '\e[8;40m'"$*"'\e[m'; }     ## Unless I missed something or made a mistake, I   ##
BredV () { printf '\e[8;41m'"$*"'\e[m'; }       ## calculate a total of 7681 different color codes, ##
BgreenV () { printf '\e[8;42m'"$*"'\e[m'; }     ## none of which produce a duplicate result.        ##
BbrownV () { printf '\e[8;43m'"$*"'\e[m'; }     ##                      These will be fine for now. ##
ByellowV () { printf '\e[8;43m'"$*"'\e[m'; }
BblueV () { printf '\e[8;44m'"$*"'\e[m'; }
BmagentaV () { printf '\e[8;45m'"$*"'\e[m'; }
BpurpleV () { printf '\e[8;45m'"$*"'\e[m'; }
BaquaV () { printf '\e[8;46m'"$*"'\e[m'; }
BcyanV () { printf '\e[8;46m'"$*"'\e[m'; }
BgreyV () { printf '\e[8;47m'"$*"'\e[m'; }
BwhiteV () { printf '\e[8;47m'"$*"'\e[m'; }
## ∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞∞ ##
``
```

The only thing to keep in mind is when wanting a `%` percent sign or a `\` backslash, you need to double them up inside:
like: `printf "$(Tblue "%%s")\n" 'hi'`
but not for `Tblue "%s\n" 'hi'`
or `printf "$(Tblue "%s" 'hi')\n"`

Since these use printf, you can do stuff like:

```
 printf "hi $(Tred there) man $(BaquaI "%c" '!') $(Bold 'This \\t is %%s') %s\n" "$(BgreenB 'super')" "$(Bblue mega Colorful)"
```

or in an echo:

```
 echo "hi $(Tred there) man $(BaquaI "%c" '!') $(Bold 'This \\t is %s' "$(BblackB 'super')") $(Bblue mega Colorful)"
```

A more useful example:

```
printf "\t%s Volume \"%s\" is not connected.\n" "$(TwhiteB [)$(TredB Error)$(TwhiteB \]:)" "$(Tbrown $Volume)"
```

Or with other commands:

```
eval "echo 'This is OSX' | sed 's:OSX:$(Invert [)$(TaquaF OSX)$(Invert ]):'"
```

Or something with a bit more swank:

```
find . -exec stat -f "Name: $(Tbrown %%N)%t%t$(Tpurple "->")%tPermissions: $(Tgreen %%Sp)" {} \;
```

Use your imagination! Feel free all to use these... the only thing I ask is if someone out there types up more of them, mix/matching them, like TcyanBgreenUI, or make up your own names... can you please post them for me and let me know about the post? or email them to me at aesth1r@me.com. I'm too lazy to type up *all* possibilities.

Enjoy!

-- ***Aesthir***

# asp.net - 为什么 Guid.NewGuid() 会生成一个空的 guid？

> ID：342100
> 
> 赞同：3
> 
> 时间：2008-12-04T21:14:32.180
> 
> 标签：asp.net, vb.net, guid

我有一个正在创建空 Guid 的 Guid.NewGuid() 调用。

什么会导致这样的问题，我该如何解决？

**编辑：**代码：

```
<WebMethod()> _
Public Function CreateRow(rowValue As String) as String
    Dim rowPointer As Guid = System.Guid.NewGuid()
    Dim rowPointerValue As String = rowPointer.ToString()

    Try
        Dim result as Integer = SqlHelper.ExecuteNonQuery(ConnectionString, "Sproc_Name", rowValue, rowPointer)

        Return result
    Catch ex as Exception
        Throw ex
    End Try
End Function 
```

**编辑：**原来 rowPointer 最初是传递给 SqlHelper 而不是 rowPointerValue - 正如答案中所指出的，这当然是作为空传递的。将其更改为 rowPointerValue/rowPointer.ToString() 解决了问题。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-22T22:14:10.843

这是 VB.NET 中的一个老问题。只有调试可视化器损坏了。

[http://www.thesoftwaredevotional.com/2008/12/guid-visualizer-broken-in-vbnet.html](http://www.thesoftwaredevotional.com/2008/12/guid-visualizer-broken-in-vbnet.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-04T21:32:14.903

我有同样的事情。Guid.NeGuid() 的调试显示它是空的。调用 .ToString() 解决了这种情况。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-04T21:33:39.333

我在VS2008中测试了这段代码，结果不是我预期的。似乎在调用 toString 方法之前不会创建新的 guid。单步执行代码后，rowPointerValue 确实保存了 guid 的字符串表示形式。

它似乎正在使用延迟执行？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-02-16T17:31:55.973

我只在 VB.NET 中并且仅在调试时遇到过这个问题。感谢 48494 提供该信息。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-14T16:49:51.633

试试这个

```
Dim g As New Guid();

Dim whereDoYouWantToSeeIt As String = g.ToString(); 
```

# c# - 如何通过反射访问 Generic.List 的索引？

> ID：342101
> 
> 赞同：0
> 
> 时间：2008-12-04T21:14:40.227
> 
> 标签：c#, .net, reflection, list, generics

好的，我有一个类，我将一个对象作为属性传递。

我通过的对象是`List<X>`

在我的课堂上，我试图通过反射访问对象索引，但我不能！！！

例子：

这门课有效我刚刚写下了我想给你看的部分，我需要帮助。

```
class MyClass
{
    private object _recordSet;
    public object RecordSet
    {
        get { return _recordSet; }
        set { _recordSet = value; }
    }

    public string Draw()
    {
        system.reflection.Assembly asem = system.reflection.Assembly.getAssembly(_dataSource.GetType());

        object instance;

        instance = asem.CreateInstance(_dataSource.GetType().UnderlyingSystemType.FullName);

        //to access de Count of my List
        int recordcount = int.Parse(_dataSource.GetType().GetProperty("Count").GetValue(_dataSource,null));

        //i need to do a 
        for(int cont = 0; cont < recordCount; cont++)
        {
            _dataSource[cont].Name; // <-- THIS PART IS NOT WORKING!!! because i cant access the Index Directly.... WHAT TO DO!! ???
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-04T21:16:30.660

如果您正在使用反射（因此有很多`object`），为什么不直接转换为`IList`（非泛型）呢？

IE

```
IList list = (IList)actualList;
object foo = list[17]; 
```

另外-对于您的原始代码`Count`，您并不是说`int.Parse`-您应该只强制转换（因为我们希望`Count`成为`int`）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T21:17:55.790

只需先将您的对象投射到列表中，这里不需要反射。

# reporting-services - 抑制组中的重复值，SSRS 报告

> ID：342103
> 
> 赞同：6
> 
> 时间：2008-12-04T21:14:49.340
> 
> 标签：reporting-services, duplicate-data, suppression

我有一个 SSRS 报告，其中日期应按项目类别分组该类别中的项目代码在组内重复我如何抑制该值

请帮我想出一个主意。

谢谢，布里吉特

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-06-01T13:09:18.980

您还可以通过在 Hidden 属性中放置一个表达式来隐藏字段，如下所示：

```
=Fields!ProductCode.Value = Previous(Fields!ProductCode.Value) 
```

所以如果上一条记录中的值与这条记录相同，它将隐藏该字段。您必须正确排序数据集才能使其正常工作。在您的情况下，我认为排序将是日期、产品类别、产品代码。

过去，我经常将它与字段边界的表达式一起使用，以直观地对输出进行分组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-02-13T08:26:11.417

我认为有一个选项可以隐藏 ssrs 属性中的重复项。因此您将在项目类别组下签入该选项。这样您就可以隐藏重复的值并获得唯一的记录。首先，您在字段属性中根据项目类别创建一个组，然后签入该组下的隐藏重复选项。每当您签入该选项时，它都会突出显示一个下拉列表，其中包含您选择创建的组或数据集。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-02-27T10:49:41.827

这对你来说有点晚了，但我所做的是编辑该字段的文本框属性，在字体选项卡中输入颜色的表达式，如下所示：

```
=IIf(Fields!ProductCode.Value = Previous(Fields!ProductCode.Value), "White", "Black") 
```

...假设您的背景是白色的，这将有效地满足您的需求。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-11-04T16:42:27.277

我认为这可能是关于您对日期进行分组的方式的问题。您是否也对它们进行了分组，但抑制了输出中的时间？

例如：

12-5-2010 12:00:00

12-5-2010 13:00:00

如果你把时间从你看待他们的方式上去掉，而不是你如何对他们进行分组，他们就会被骗。

# .net - 以编程方式使用 Gmail 接收电子邮件？

> ID：342106
> 
> 赞同：5
> 
> 时间：2008-12-04T21:15:09.447
> 
> 标签：.net, smtp, gmail, imap, pop3

我想使用 C# 程序来轮询 gmail 帐户并自动下载新邮件。我知道您可以将 gmail 用作出站 SMTP 服务器，但有什么方法可以访问发送到该帐户的新邮件？

**编辑：**感谢您的快速反馈....所以我有两个选择，POP 或 IMAP。

我应该使用哪一个？为什么？

**编辑#2：**看起来 IMAP 让我不必轮询。看起来像要走的路。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-04T21:17:37.773

将[Gmail 与 IMAP 结合](http://mail.google.com/support/bin/answer.py?answer=75725&topic=12891)使用。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-04T21:16:45.700

您可以[配置 GMail 以让您使用 POP3 客户端获取邮件](http://mail.google.com/support/bin/answer.py?hl=en&answer=13273)。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-04T22:05:13.073

您可以获得[GMAIL 的 Atom Feed](https://mail.google.com/mail/feed/atom)，它可以通过常规 Web 请求获取，并解析为常规 XML 文档。我制作了一个可以通过手机访问的 PHP 页面（它不支持 Atom Feed，或像 Google Mobile 一样高级的页面），以向我显示新电子邮件列表。

# delphi - 我可以使用 Delphi 或 C++Builder 进行 Windows Mobile 6.1 开发吗？

> ID：342111
> 
> 赞同：2
> 
> 时间：2008-12-04T21:16:01.380
> 
> 标签：delphi, c++builder, delphi-2009, mobile-devices, c++builder-2009

我很好奇为移动设备（Windows Mobile 6.1）编程需要什么，以及是否可以使用我们已经习惯的 IDE（RAD Studio 2009）。

是否有一个移动开发社区可供 Delphi 或 C++Builder 用户学习？

开发技术是否存在差异，例如：驱动程序、内存限制、设备特定注意事项等？

文档和教程的链接总是很棒！

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T21:42:07.193

您可以在 Delphi.NET（Prism？）中进行 Compact Framework 开发，但不能在 2009 年进行本机开发。

几年前，当我参与其中时，这是社区中的一个热门话题，它基本上归结为资源、实施成本和潜在的许可费用，这使得 Borland 不值得这样做（就像当时那样）。

现在可能已经改变了，但是阅读 2009 年的功能表似乎没有……

编辑：Prism 中似乎没有对 CF 的设计器支持。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2014-06-15T07:54:04.977

如果您更喜欢使用 Pascal，您可以使用 FreePascal 为 Windows Mobile 6.1 开发

# c# - 在 WPF 视图框中对齐内容

> ID：342116
> 
> 赞同：13
> 
> 时间：2008-12-04T21:16:46.387
> 
> 标签：c#, wpf, xaml, viewbox

`Stretch=Uniform`为了不扭曲内容，我有一个 Viewbox 。但是，当框架窗口比内容更宽或更高时，Viewbox 内容总是居中。

我似乎在 Viewbox 上找不到任何内容对齐选项。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-05T00:37:25.420

尝试`VerticalAlignment="Top"`并`HorizontalAlignment="Left"`在您的视图框上。它将导致它被锚定到顶部和左侧。

```
<Grid>
    <Viewbox VerticalAlignment="Top" HorizontalAlignment="Left">
    ...
    </Viewbox>
</Grid> 
```

如果您希望它完全填充（但保持均匀），您可以使用`Stretch="UniformToFill"`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T21:26:58.207

根据[MSDN](http://msdn.microsoft.com/en-us/library/ms741838.aspx)，Viewbox 用于拉伸子元素。由于子元素会被拉伸，因此您必须设置子元素的内容对齐方式。

您可能想查看有关 Viewbox 的更多信息：[如何在 WPF 中保持可缩放、可滚动内容的纵横比？](https://stackoverflow.com/questions/288954/how-do-i-keep-aspect-ratio-on-scalable-scrollable-content-in-wpf)

# asp.net-membership - 泛型和 ASP.Net 成员资格提供程序

> ID：342119
> 
> 赞同：4
> 
> 时间：2008-12-04T21:17:29.753
> 
> 标签：asp.net-membership

我正在尝试使用通用列表作为用户配置文件的属性。我承认这可能只是让我的生活变得比它需要的更艰难，但我不想仅仅因为数据存储困难而改变编程模型。

我的 web.config 中有这个

```
 </providers>
        <properties>
            .....
            <add name="AListProperty" type="System.Collections.Generic.List`1[[System.Int32]]"/>
            <add name="AnotherListProperty" type="System.Collections.Generic.List`1[[MyNamespace.Web.UI.MyReallySimpleClass]]">
                        </properties>
    </profile> 
```

第一个属性“AListProperty”工作正常。第二个会根据我在 web.config 中的 delcare 方式引发各种异常。MyReallySimpleClass 是公共的，可序列化的，由 2 个公共字段组成（目前）

所以，我的问题是 1\. 有谁知道在 web.config 中声明这些类型的格式记录在哪里。2\. 我做错了什么？看起来不错，我看不出两个声明之间有任何语义差异。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T21:37:28.670

如果您还可以提供有关您遇到的异常类型和消息的一些详细信息，将会有所帮助。否则我的猜测是您可能需要`MyNamespace.Web.UI.MyReallySimpleClass`使用类型所在的程序集来限定，例如`MyNamespace.Web.UI.MyReallySimpleClass, MyAssembly`. 除非类型位于配置部分中列出的组件之一中，`mscorlib`否则不需要组件限定。`System.Int32``App_Code``system.web/compilation/assemblies`

> 1.  有谁知道在 web.config 中声明这些类型的格式记录在哪里。

请参阅MSDN 中的[指定完全限定类型名称](http://msdn.microsoft.com/en-us/library/yfsftwz6.aspx)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-04T21:40:30.643

尝试指定YourReallySimpleClass的程序集：

```
...type="System.Collections.Generic.List`1[[MyNamespace.Web.UI.MyReallySimpleClass, MyAssemblyName]]" 
```

# java - 命名 ant 目标的最佳实践是什么？

> ID：342122
> 
> 赞同：9
> 
> 时间：2008-12-04T21:18:57.317
> 
> 标签：java, ant, naming-conventions

命名 ant 目标的最佳实践是什么？

例如，您希望目标“测试”运行什么？所有单元测试？所有功能测试？两个都？

用于运行不同类型测试（单元/功能/全部）的标准名称是什么？在 J2SE 中部署软件的目标名称是否有标准？在 J2EE 中？

我的项目将 ant 用于带有 junit、Swing 应用程序和 J2EE 应用程序的 java 项目。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2011-09-23T09:48:15.057

请参阅此页面上的[**“命名约定”**部分：](http://wiki.apache.org/ant/TheElementsOfAntStyle#Naming_conventions) [Ant 样式的元素](http://wiki.apache.org/ant/TheElementsOfAntStyle)

> 以下目标对于许多构建都是通用的。始终避免更改众所周知的目标名称的行为。您不需要在单个项目中实现所有这些。

```
all               Build and test everything; create a distribution, optionally install. 
clean             Delete all generated files and directories. 
deploy            Deploy the code, usually to a remote server. 
dist              Produce the distributables. 
distclean         Clean up the distribution files only. 
docs              Generate all documentation. 
init              Initialize the build: create directories, call <tstamp> and other common actions. 
install           Perform a local installation. 
javadocs          Generate the Javadoc pages. 
printerdocs       Generate printable documents. 
test              Run the unit tests. 
uninstall         Remove a local installation. 
```

此页面还提供了其他良好的指导方针。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-09T17:06:10.980

对于我的 java 项目，我使用在[maven 默认生命周期](http://maven.apache.org/guides/introduction/introduction-to-the-lifecycle.html#Lifecycle_Reference)中定义的名称作为基础。对于其他项目，我也使用了[GNU autoconf 标准目标](http://www.gnu.org/software/autoconf/manual/make/Standard-Targets.html)。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-05T09:55:47.103

有一个标准被合理地广泛使用。任何以 - 字符开头的目标名称都不能从命令行调用，因此肯定不能直接执行。有时，这被称为[隐藏目标](http://www.sitepoint.com/article/apache-ant-demystified/3/)。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-04T22:00:05.037

只要它们在您的整个项目中是可以理解和一致的，您如何命名它们就取决于您了。简单、简短的动词通常是常态，目标应该在逻辑上分解。

您可以走 Matt B 建议的路线，按类型命名您的测试目标：

*   测试单元
*   测试功能
*   测试所有

或者您可以按工具命名，例如，如果您有 Junit、Selenium 和 Webtest 功能测试：

*   测试-junit
*   测试硒
*   测试网络测试
*   测试所有

如果您对要向构建项目的任何人公开的目标使用描述属性，用户可以执行`ant -p`列出可用目标并选择他们想要的目标。这里有用的描述对于用户来说可能比目标的实际名称更重要和更有价值。

从[蚂蚁手册](http://ant.apache.org/manual/using.html)：

> 可选的描述属性可用于提供此目标的单行描述，由 -projecthelp 命令行选项打印。没有这种描述的目标被认为是内部的并且不会被列出，除非使用了 -verbose 或 -debug 选项。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-05T05:13:42.743

我们在使用依赖于其他单个任务的简短目标名称方面取得了良好的经验。AFAIK 通用标准集是

*   在里面
*   干净的
*   编译
*   距离
*   测试
*   报告

（虽然找不到链接）

这对我们来说非常有效。

当我们必须区分测试类型时，我们将它们命名为“test.data”和“test.nondata”以分隔测试类型，它们中的每一个都被“测试”任务视为依赖。也许您应该像另一个用户建议的那样使用“java方法命名约定”，但恕我直言，这并不重要。

如果您在本地机器上手动运行 ant 脚本（我这样做是为了测试我是否破坏了构建脚本），如果您只需键入

```
ant dist
ant test report 
```

代替

```
ant compile create.distribution
ant test.data test.nondata report.junit.generate report ..... 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-04T21:32:47.850

我认为这完全是个人喜好，但我会使用

*   `test`- 用于单元测试
*   `test-integration`- 用于集成测试
*   `dbtest`- 用于数据库测试（如果它们包含在上述项目中）
*   `test-all`运行以上所有

此外，我不知道使用`test`或复数形式`tests`，我可能在不同的项目中都做过。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-04T22:11:28.443

ant 目标的命名约定应该与 Java 方法的命名约定非常相似：即，简单且描述目标的功能。

[以下是Sun 方法命名标准](http://java.sun.com/docs/books/tutorial/java/javaOO/methods.html)的摘录：

> **命名方法**
> 
> 尽管方法名可以是任何合法标识符，但代码约定限制了方法名。按照惯例，方法名称应该是小写动词或以小写动词开头的多词名称，后跟形容词、名词等。在多词名称中，第二个和后续单词的首字母应该大写。这里有些例子：
> 
> ```
> run
> runFast
> getBackground
> getFinalData
> compareTo
> setX
> isEmpty 
> ```

可能最大的不同是 ant 目标的样式，它应该是所有小写字母，单词之间用破折号分隔。

例如，以下目标对我来说似乎很合适：

*   `run-all-tests`
*   `build`
*   `clean`
*   `test-and-release`
*   `deploy`
*   `run-code-coverage-metrics`

最后，尽量使用与命名方法时相同的良好判断。如果你的目标清晰、描述性强且易于理解，那么你的状态就很好。

有关该主题的更多详细信息，请查看Ant wiki 上的[The Elements of Ant Style 。](http://wiki.apache.org/ant/TheElementsOfAntStyle)

# unit-testing - OSS 项目的最小 NUnit 二进制文件

> ID：342128
> 
> 赞同：6
> 
> 时间：2008-12-04T21:22:59.713
> 
> 标签：unit-testing, nunit

附带基于 NUnit 的单元测试的开源项目通常也附带 NUnit 运行器和随附的二进制文件。对于 NUnit 2.4.8，将其`bin`目录与实际项目逐字分发相当于 46 个文件和一个空白`addins`目录。如果一个人想要的只是分发 GUI 和控制台运行器以及`nunit.framework.dll`编写测试所需的基础（并且没有模拟基础设施），那么所需的最少文件集是多少？

作为参考，NUnit 2.4.8 目​​录`bin`如下所示：

*   插件/
*   clr.bat
*   失败.jpg
*   适合.dll
*   忽略.jpg
*   loadtest-assembly.dll
*   模拟程序集.dll
*   无命名空间程序集.dll
*   notefixtures-assembly.dll
*   nunit.core.dll
*   nunit.core.extensions.dll
*   nunit.core.interfaces.dll
*   nunit.core.tests.dll
*   nunit.exe
*   nunit.exe.config
*   nunit.extensions.tests.dll
*   nunit.fixtures.dll
*   nunit.fixtures.tests.dll
*   nunit.framework.dll
*   nunit.framework.extensions.dll
*   nunit.framework.tests.dll
*   nunit.framework.xml
*   nunit.mocks.dll
*   nunit.mocks.tests.dll
*   nunit.uikit.dll
*   nunit.uikit.tests.dll
*   nunit.util.dll
*   nunit.util.tests.dll
*   nunit-console.exe
*   nunit-console.exe.config
*   nunit-console.tests.dll
*   nunit-console-runner.dll
*   nunit-console-x86.exe
*   nunit-console-x86.exe.config
*   NUnitFitTests.html
*   nunit-gui.tests.dll
*   nunit-gui-runner.dll
*   NUnitTests.config
*   NUnitTests.nunit
*   nunit-x86.exe
*   nunit-x86.exe.config
*   运行文件.exe
*   运行文件.exe.config
*   成功.jpg
*   测试程序集.dll
*   测试实用程序.dll
*   计时-tests.dll

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-12-11T07:13:19.390

仅存在以下 6 个 NUnit 文件，我就可以成功运行测试：

*   nunit.core.dll
*   nunit.core.interfaces.dll
*   nunit.framework.dll
*   nunit.util.dll
*   nunit.console-runner.dll
*   nunit-console.exe

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-04T21:51:55.833

经过一些研究，以下文件似乎没有必要，因为它们代表了 NUnit 本身和 FIT 的测试程序集：

*   插件/
*   clr.bat
*   失败.jpg
*   ~~适合.dll~~
*   忽略.jpg
*   loadtest-assembly.dll
*   模拟程序集.dll
*   无命名空间程序集.dll
*   notefixtures-assembly.dll
*   nunit.core.dll
*   nunit.core.extensions.dll
*   nunit.core.interfaces.dll
*   ~~nunit.core.tests.dll~~
*   nunit.exe
*   nunit.exe.config
*   ~~nunit.extensions.tests.dll~~
*   nunit.fixtures.dll
*   ~~nunit.fixtures.tests.dll~~
*   nunit.framework.dll
*   nunit.framework.extensions.dll
*   ~~nunit.framework.tests.dll~~
*   nunit.framework.xml
*   nunit.mocks.dll
*   ~~nunit.mocks.tests.dll~~
*   nunit.uikit.dll
*   ~~nunit.uikit.tests.dll~~
*   nunit.util.dll
*   ~~nunit.util.tests.dll~~
*   nunit-console.exe
*   nunit-console.exe.config
*   ~~nunit-console.tests.dll~~
*   nunit-console-runner.dll
*   nunit-console-x86.exe
*   nunit-console-x86.exe.config
*   ~~NUnitFitTests.html~~
*   ~~nunit-gui.tests.dll~~
*   nunit-gui-runner.dll
*   ~~NUnitTests.config~~
*   ~~NUnitTests.nunit~~
*   nunit-x86.exe
*   nunit-x86.exe.config
*   ~~运行文件.exe~~
*   ~~运行文件.exe.config~~
*   成功.jpg
*   测试程序集.dll
*   测试实用程序.dll
*   计时-tests.dll

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-07-16T17:29:21.323

对于 2.6，除了 Mooki 的列表之外，我还必须添加：

*   nunit-agent.exe

# batch-file - 当从批处理运行的应用程序与标准输入混淆时，如何将标准输入提供给批处理文件？

> ID：342130
> 
> 赞同：3
> 
> 时间：2008-12-04T21:23:24.970
> 
> 标签：batch-file, stdin, dos

这是一个最小的批处理文件`demo.bat`，来说明我的问题：

```
@ECHO off

set /p foo=Enter foo:
echo.
echo you typed "%foo%"

sqlcmd -?

set /p bar=Enter bar:
echo.
echo you typed "%bar%" 
```

`foo.txt`我有一个看起来像这样的输入文件：

```
foo_value
bar_value

```

我将批处理文件作为`demo.bat < foo.txt`. 输出是：

```
输入 foo：
你输入了“foo_value”
Microsoft (R) SQL Server 命令行工具
版本 9.00.3042.00 NT 英特尔 X86
版权所有 (c) 微软公司。版权所有。

用法：sqlcmd [-U登录id] [-P密码]
  （...ETC...）

输入栏：
你输入了“foo_value”

```

如果我删除`sqlcmd -?`, 那么 bar 被“键入”为`bar_value`，这是我最初所期望的。

所以，在我看来，`sqlcmd`使用不适合它的标准输入以某种方式表现不佳。有人对我如何解决它有任何好主意吗？在一个完美的世界中，该解决方案不会涉及更改原始批处理文件，或涉及安装第三方包来驱动交互（例如，Expect）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T22:14:58.140

我不知道它是否有帮助，但是您可以尝试将其他内容通过管道传输到 sqlcmd，例如：

```
echo. | sqlcmd -? 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T12:34:34.880

您还可以将 NUL 重定向到 sqlcmd：

```
sqlcmd -? < NUL 
```

但这也需要更改批处理脚本。

# c# - Verbatim strings and Visual Studio

> ID：342131
> 
> 赞同：4
> 
> 时间：2008-12-04T21:23:45.640
> 
> 标签：c#, visual-studio

Is there a way to get Visual Studio to display strings as verbatim strings (prefixed with '@')? I'd like to easily cut strings containing file paths from Visual Studio into Explorer or other apps.

Clarification: when VS displays a string in the auto, watch, immediate, etc. window, I'd like it to be formatted as as verbatim string so that I can simple copy it for use elsewhere.

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-04T21:49:26.790

You can click on the magnifier in VS 2008 debugger variable display and select "Text Visualizer" which will give you the text in an unmassaged format.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-01-16T10:23:58.843

下面是关于如何实际构建逐字字符串的讨论： [Can I convert a C# string value to a string literal](https://stackoverflow.com/questions/323640/can-i-convert-a-c-string-value-to-a-string-literal#323670)。

将其插入调试 vizualiser 是另一回事...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T21:35:09.110

You may need to clarify your question. My first thought was that you just need to prefix the string with '@' to make them verbatim, but you already know that.

```
string s = @"c:\my folder\"; 
```

What exactly are you trying to do with the string?

# c++-cli - 如何在 C++/CLI 的静态变量上使用 System::Threading::Interlocked::Increment？

> ID：342140
> 
> 赞同：1
> 
> 时间：2008-12-04T21:25:39.207
> 
> 标签：c++-cli

我想在垃圾收集类中保留一个静态计数器并使用 Interlocked::Increment 递增它。执行此操作的 C++/CLI 语法是什么？

我一直在尝试以下变化，但到目前为止没有运气：

```
ref class Foo
{
   static __int64 _counter;

   __int64 Next()
   {
      return System::Threading::Interlocked::Increment( &_counter );
   }

}; 
```

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-04T22:11:07.120

您需要使用% [tracking](http://msdn.microsoft.com/en-us/library/8903062a(VS.80).aspx) reference 表示法对您的`_int64`值使用跟踪引用：

```
ref class Bar
{
    static __int64 _counter;

    __int64 Next()
    {
        __int64 %trackRefCounter = _counter;
        return System::Threading::Interlocked::Increment(trackRefCounter);
    }
}; 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-07-18T19:59:18.000

只需删除地址操作符：

```
return System::Threading::Interlocked::Increment( _counter ); 
```

在 C++/CLI 中，与 C++ 一样，没有用于通过引用传递的特殊符号。

或者您可以使用本机函数[`InterlockedIncrement64`](http://msdn.microsoft.com/en-us/library/ms683615%28v=vs.85%29.aspx)( `#include <windows.h>`)

```
return ::InterlockedIncrement64(&_counter); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-08-12T04:32:35.293

使用本**机函数/宏**（即`InterlockedExchangePointer`，等等......加上很多我不知道的很酷的，例如`InterlockedXor64`）的建议受到严重阻碍，因为这样做会导致内在（至少在默认编译器设置）被放入您的托管`C++/CLI`函数中。发生这种情况时，您的整个函数将被编译为本机。

并且托管版本也很好，因为如果目标位于 GC 对象中，则`Interlocked::*`不必这样做。`pin_ptr`但是，正如本页所述，找到正确的咒语以使其正常工作可能会非常痛苦，尤其是当您想要交换（即）本机指针本身时。就是这样：

```
int i1 = 1, i2 = 2;

int *pi1 = &i1, *pi2 = &i2, *pi3;

pi3 = (int*)Interlocked::Exchange((IntPtr%)pi1, IntPtr(pi2)).ToPointer(); 
```

我验证了这确实可以正常工作，尽管指针上缺少地址获取 ( `&`)令人怀疑地令人不安。`pi1`但这是有道理的，当您考虑它时，因为如果目标在 GC 主机中移动，您不会希望`**`通过抓取`&`指针本身的（本机）地址来做通常的事情。

# arrays - pdksh（公共域 kornShell）是否支持关联数组？

> ID：342147
> 
> 赞同：0
> 
> 时间：2008-12-04T21:29:14.457
> 
> 标签：arrays, shell, cygwin, ksh, pdksh

我最近在做一些 bash shell 编程时碰壁，而关联数组可以解决我的问题。我在 Google 上搜索了 KornShell (ksh) 的功能，了解到它支持关联数组，因此我安装了 Cygwin 的 pdksh（公共域 KornShell）。

但是，当尝试以规定的方式（typeset -A varName）创建关联数组时，我收到以下错误，因此我开始怀疑 pdksh 不支持关联数组。

```
./find_actions.ksh: line 2: typeset: -A: invalid option
typeset: usage: typeset [-afFirtx] [-p] name[=value] ... 
```

我想我会考虑使用 Perl，但我真的想要一个很好的借口来学习一门新的方言/语言。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T21:48:26.870

看看 ksh93，它支持关联数组并且是更完整/正确的 ksh 实现。

参见：[kornshell.com](http://kornshell.com/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-09-17T21:27:20.577

pdksh 不支持关联数组；这是它的继任者 mksh 的一个有计划且明确的功能（一旦我开始实际实施它，那就是……对不起，它的速度很慢）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T21:48:09.600

为什么不直接使用 bash？它可能没有明确的关联数组，但您可以[伪造它们](http://linuxshellaccount.blogspot.com/2008/05/how-to-fake-associative-arrays-in-bash.html)。

或者，zsh 具有[出色的关联数组支持](http://zsh.dotsrc.org/Doc/Release/zsh_14.html#SEC72)。

# xml - Flex - databinding from a Tree to a Repeater

> ID：342149
> 
> 赞同：1
> 
> 时间：2008-12-04T21:31:13.237
> 
> 标签：xml, apache-flex, data-binding, tree, repeater

I'm trying to make an XML questions editor in flash. Basically I load in the XML into a Tree component - XML like so:

```
<questions>
<question id="1" type="radio" text="This is question 1" isBranch="true">
  <option id="1.1" correct="false" text="This is option 1" />
  <option id="1.2" correct="false" text="This is option 2" />
  <option id="1.1" correct="false" text="This is option 1" />
  <option id="1.2" correct="false" text="This is option 2" />
  <option id="1.3" correct="true" text="This is option 3" />
  <option id="1.4" correct="false" text="This is option 4" />
</question>
<question id="2" type="check" text="This is question 2" isBranch="true">
  <option id="2.1" correct="true" text="This is option 1" />
  <option id="2.2" correct="false" text="This is option 2" />
  <option id="2.3" correct="true" text="This is option 3" />
</question>
</questions> 
```

So that goes into the tree. On change I get a list of the options for the selected question (item..option) - and that XMLList is passed into a (custom) component. That component (not sure if this is the best way to go about it but still...) - has a couple of Repeater controls - one which is bound to the XMLList for a radio question, the other bound to the XMLList of a cheque box question. Each repeater loops the number of options, placing a TextInput in (to edit the option text) and either a radio or cheque box (depending on the question type)

So - what I am after is when the text is edited for an option, the XML in that TextInput is bound to the XML which is the dataProvider for the tree. So for example if "This is option 1" is changed to "This is option Foo" - the Tree updates with that.

So far my repeater (eg. for the radios) is like this

```
<mx:Repeater id="repeaterRadio" dataProvider="{optionsListRadio}">      
  <mx:TextInput width="359" id="radioText"
     editable="true" enabled="true" text="{repeaterRadio.currentItem.@text}"/>
  <mx:RadioButton id="radioArray"
    data="{repeaterRadio.currentItem.@id}"
    selected="{repeaterRadio.currentItem.@correct=='true'}"/>
</mx:Repeater> 
```

No binding works - all I get here is warnings like:

```
warning: unable to bind to property 'text' on class 'XML' (class is not an IEventDispatcher) 
```

I sort of get why this is the case, but am at a loss how to go about binding the data the user can edit back to the source xml. I know I can make the tree itself editable but that's not really an option here.

So any pointers or ideas would be very appreciated!

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-04T23:15:51.013

我认为有两个类可以帮助将 XML 转换为可绑定对象，然后在用户完成后重新转换回 XML，[mx.rpc.xml.SimpleXMLDecoder](http://livedocs.adobe.com/flex/3/langref/mx/rpc/xml/SimpleXMLDecoder.html)和[mx.rpc.xml.SimpleXMLEncoder](http://livedocs.adobe.com/flex/3/langref/mx/rpc/xml/SimpleXMLEncoder.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-10-06T12:40:52.693

只需替换`repeaterRadio.currentItem.@text`为`XML(repeaterRadio.currentItem).@text`.

# java - Java File I/O Performance Decreases Over Time

> ID：342151
> 
> 赞同：2
> 
> 时间：2008-12-04T21:31:51.973
> 
> 标签：java, windows, performance, file, io

I'm trying to perform a once-through read of a large file (~4GB) using Java 5.0 x64 (on Windows XP).

Initially the file read rate is very fast, but gradually the throughput slows down substantially, and my machine seems very unresponsive as time goes on.

I've used ProcessExplorer to monitor the File I/O statistics, and it looks like the process initially reads 500MB/sec, but this rate gradually drops to around 20MB/sec.

Any ideas on the the best way to maintain File I/O rates, especially with reading large files using Java?

Here's some test code that shows the "interval time" continuing to increase. Just pass Main a file that's at least 500MB.

```
import java.io.File;
import java.io.RandomAccessFile;

public class MultiFileReader {

public static void main(String[] args) throws Exception {
    MultiFileReader mfr = new MultiFileReader();
    mfr.go(new File(args[0]));
}

public void go(final File file) throws Exception {
    RandomAccessFile raf = new RandomAccessFile(file, "r");
    long fileLength = raf.length();
    System.out.println("fileLen: " + fileLength);
    raf.close();

    long startTime = System.currentTimeMillis();
    doChunk(0, file, 0, fileLength);
    System.out.println((System.currentTimeMillis() - startTime) + " ms");
}

public void doChunk(int threadNum, File file, long start, long end) throws Exception {
    System.out.println("Starting partition " + start + " to " + end);
    RandomAccessFile raf = new RandomAccessFile(file, "r");
    raf.seek(start);

    long cur = start;
    byte buf[] = new byte[1000];
    int lastPercentPrinted = 0;
    long intervalStartTime = System.currentTimeMillis();
    while (true) {
        int numRead = raf.read(buf);
        if (numRead == -1) {
            break;
        }
        cur += numRead;
        if (cur >= end) {
            break;
        }

        int percentDone = (int)(100.0 * (cur - start) / (end - start));
        if (percentDone % 5 == 0) {
            if (lastPercentPrinted != percentDone) {
                lastPercentPrinted = percentDone;
                System.out.println("Thread" + threadNum + " Percent done: " + percentDone + " Interval time: " + (System.currentTimeMillis() - intervalStartTime));
                intervalStartTime = System.currentTimeMillis();
            }
        }
    }
    raf.close();
}
} 
```

Thanks!

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-04T21:37:27.110

I very much doubt that you're *really* getting 500MB per second from your disk. Chances are the data is cached by the operating system - and that the 20MB per second is what happens when it *really* hits the disk.

This will quite possibly be visible in the disk section of the Vista Resource Manager - and a low-tech way to tell is to listen to the disk drive :)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T15:23:10.047

Java 垃圾收集器可能是这里的瓶颈。

我会让缓冲区更大并且对类来说是私有的，这样它就可以被重用，而不是在每次调用 doChunk() 时分配。

```
public class MultiFileReader {

   private byte buf[] = new byte[256*1024];

   ...

} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-04T21:58:55.880

根据您的特定硬件和其他情况，您可能需要相当努力地工作以实现超过 20MB/秒的速度。

我想也许你真的不知道 500MB/秒是多么的不合时宜……

您希望什么，您是否检查过您的特定驱动器在理论上是否能够实现？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T21:43:06.600

You could use JConsole to monitor your app, including memory usage. The 500 MB/sec sounds to good to be true.

Some more information about the implementation and VM arguments used would be helpful.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T14:55:39.477

检查 static void read3() throws IOException {

```
 // read from the file with buffering
        // and with direct access to the buffer

        MyTimer mt = new MyTimer();
        FileInputStream fis = 
                     new FileInputStream(TESTFILE);
        cnt3 = 0;
        final int BUFSIZE = 1024;
        byte buf[] = new byte[BUFSIZE];
        int len;
        while ((len = fis.read(buf)) != -1) {
            for (int i = 0; i < len; i++) {
                if (buf[i] == 'A') {
                    cnt3++;
                }
            }
        }
        fis.close();
        System.out.println("read3 time = " 
                                + mt.getElapsed());
    } 
```

来自[http://java.sun.com/developer/JDCTechTips/2002/tt0305.html](http://java.sun.com/developer/JDCTechTips/2002/tt0305.html)

最佳缓冲区大小可能取决于操作系统。你的可能很小。

# c++ - 为什么变量名不能以数字开头？

> ID：342152
> 
> 赞同：153
> 
> 时间：2008-12-04T21:32:07.043
> 
> 标签：c++, variables, programming-languages, language-design, variable-names

不久前，我和一位新的 C++ 开发人员一起工作时，他问了一个问题：“为什么变量名不能以数字开头？”

除了某些数字中可以包含文本（123456L、123456U）之外，我无法给出答案，如果编译器认为带有一定数量字母字符的所有内容都是变量名，那将是不可能的。

那是正确的答案吗？还有其他原因吗？

```
string 2BeOrNot2Be = "that is the question"; // Why won't this compile? 
```

* * *

## 回答 #1

> 赞同：129
> 
> 时间：2008-12-04T21:43:22.447

因为这样一串数字将是一个有效的标识符以及一个有效的数字。

```
int 17 = 497;
int 42 = 6 * 9;
String 1111 = "Totally text"; 
```

* * *

## 回答 #2

> 赞同：127
> 
> 时间：2008-12-04T21:38:01.727

好好想想这个：

```
int 2d = 42;
double a = 2d; 
```

什么是一个？2.0？还是42？

提示，如果你不明白，数字后的 d 表示它之前的数字是双字面量

* * *

## 回答 #3

> 赞同：62
> 
> 时间：2011-04-26T16:58:10.790

现在这是一个惯例，但它最初是作为一项技术要求。

在过去，FORTRAN 或 BASIC 等语言的解析器不需要使用空格。因此，基本上，以下内容是相同的：

```
10 V1=100
20 PRINT V1 
```

和

```
10V1=100
20PRINTV1 
```

现在假设允许使用数字前缀。你会如何解释这个？

```
101V=100 
```

作为

```
10 1V = 100 
```

或作为

```
101 V = 100 
```

或作为

```
1 01V = 100 
```

所以，这被定为非法。

* * *

## 回答 #4

> 赞同：44
> 
> 时间：2014-10-13T11:16:51.317

因为在编译时在词法分析中避免了回溯。像这样的变量：

```
Apple; 
```

当它遇到字母'A'时，编译器会立即知道它是一个标识符。

然而，像这样的变量：

```
123apple; 
```

编译器在命中“a”之前无法确定它是数字还是标识符，因此需要回溯。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-12-04T21:43:56.767

编译器/解析器/词法分析器对我来说是很久很久以前的事了，但我想我记得很难明确地确定编译单元中的数字字符是代表文字还是标识符。

由于这个原因，空间不重要的语言（如 ALGOL 和原始 FORTRAN，如果我没记错的话）不能接受数字来开始标识符。

这可以追溯到 - 在表示存储或数字基数的特殊符号之前。

* * *

## 回答 #6

> 赞同：11
> 
> 时间：2009-05-25T22:29:19.457

我同意允许标识符以数字开头会很方便。一两个人提到你可以通过在你的标识符前加一个下划线来绕过这个限制，但这真的很难看。

我认为问题的一部分来自数字文字，例如 0xdeadbeef，这使得很难为可以以数字开头的标识符制定易于记忆的规则。一种方法可能是允许任何与 [A-Za-z_]+ 匹配的不是关键字或数字文字的内容。问题是它会导致奇怪的事情，比如 0xdeadpork 被允许，而不是 0xdeadbeef。最终，我认为我们应该对所有肉类都公平：P。

当我第一次学习 C 时，我记得感觉变量名的规则是任意的和限制性的。最糟糕的是，它们很难记住，所以我放弃了学习它们。我只是做了感觉正确的事情，而且效果很好。现在我学到了很多东西，它似乎并没有那么糟糕，我终于开始学习它了。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-12-04T21:50:02.107

这可能是出于几个原因做出的决定，当您解析令牌时，您只需查看第一个字符以确定它是标识符还是文字，然后将其发送到正确的函数进行处理。所以这是一个性能优化。

另一种选择是检查它是否不是文字并将标识符的域保留为全域减去文字。但要做到这一点，您必须检查每个标记的每个字符才能知道如何对其进行分类。

还有文体含义标识符应该是助记符，因此单词比数字更容易记住。当许多原始语言被编写为接下来的几十年设置样式时，他们并没有考虑用“2”代替“to”。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2013-01-13T23:56:30.367

变量名不能以数字开头，因为它可能会导致一些问题，如下所示：

```
int a = 2;
int 2 = 5;
int c = 2 * a; 
```

c的值是多少？是4，还是10！

另一个例子：

```
float 5 = 25;
float b = 5.5; 
```

前 5 是一个数字，还是一个对象（. 运算符） 第二个 5 也有类似的问题。

也许，还有其他一些原因。所以，我们不应该在变量名的开头使用任何数字。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2012-01-12T05:04:58.977

限制是任意的。各种 Lisp 允许符号名称以数字开头。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2008-12-04T21:55:18.727

使用数字开始变量名会使编译或交互过程中的错误检查变得更加复杂。

允许使用以数字开头的变量名可能会给语言设计者带来巨大的问题。在源代码解析过程中，每当编译器/解释器遇到一个以数字开头的标记时，它需要一个变量名，它必须搜索大量复杂的规则来确定该标记是真正的变量还是错误. 语言解析器增加的复杂性可能无法证明此功能的合理性。

回想起我的记忆（大约 40 年），我认为我从未使用过一种允许使用数字来开始变量名的语言。我确信这至少完成了一次。也许，这里有人真的在什么地方看到过这个。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2008-12-04T22:26:22.113

正如一些人所注意到的，关于变量名的有效格式有很多历史包袱。语言设计者在创造新语言时总是受到他们所知道的影响。

也就是说，几乎所有语言都不允许变量名以数字开头，因为这是语言设计的规则。通常是因为这样一个简单的规则使语言的解析和词法分析变得更加容易。不过，并非所有语言设计者都知道这是真正的原因。现代词法工具会有所帮助，因为如果您尝试将其定义为允许的，它们会给您解析冲突。

OTOH，如果您的语言具有唯一可识别的字符来预示变量名称，则可以将其设置为以数字开头。类似的规则变体也可用于在变量名中允许空格。但由此产生的语言很可能与任何流行的传统语言都不太相似，如果有的话。

有关允许变量以数字开头并嵌入空格的相当简单的 HTML 模板语言的示例，请查看[Qompose](http://yceran.org/qompose/)。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2011-04-26T16:57:05.713

因为如果您允许关键字和标识符以数字字符开头，则词法分析器（编译器的一部分）无法轻易区分数字文字和关键字的开头，而不会变得更复杂（并且更慢）。

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2014-12-14T11:10:10.667

COBOL 允许变量以数字开头。

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-12-04T22:42:22.517

C++ 不能拥有它，因为语言设计者将其定为规则。如果您要创建自己的语言，您当然可以允许它，但您可能会遇到与他们相同的问题并决定不允许它。会导致问题的变量名称示例：

0x, 2d, 5555

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2009-11-05T21:46:36.620

放松句法约定的关键问题之一是它在编码过程中引入了认知失调。您对代码的看法可能会受到这将引入的缺乏清晰度的深刻影响。

Dykstra 不是说过“任何工具最重要的方面是它对用户的影响”吗？

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2018-08-05T07:08:58.253

编译器有7个阶段如下：

1.  词法分析
2.  语法分析
3.  语义分析
4.  中间代码生成
5.  代码优化
6.  代码生成
7.  符号表

在编译这段代码时，在词法分析阶段避免了回溯。像Apple这样的变量，编译器在词法分析阶段遇到字母'A'字符时会立即知道它的标识符。但是，对于像 123apple 这样的变量，编译器将无法确定它是数字还是标识符，直到它命中“a”并且它需要回溯才能进入词法分析阶段以识别它是一个变量。但是编译器不支持它。

当您解析令牌时，您只需查看第一个字符以确定它是标识符还是文字，然后将其发送到正确的函数进行处理。所以这是一个性能优化。

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-05-01T21:20:55.837

可能是因为它使人类更容易分辨它是数字还是标识符，并且因为传统。具有可以以数字开头的标识符不会使词汇扫描变得那么复杂。

并非所有语言都禁止使用以数字开头的标识符。在 Forth 中，它们可以是数字，小整数通常被定义为 Forth 字（本质上是标识符），因为读取“2”作为例程将 2 压入堆栈比将“2”识别为数字更快其值为 2。（在处理来自程序员或磁盘块的输入时，Forth 系统会根据空格分割输入。它会尝试在字典中查找标记以查看它是否是已定义的单词，并且if not 将尝试将其转换为数字，如果 not 将标记错误。）

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2009-05-20T19:54:08.940

假设您确实允许符号名称以数字开头。现在假设您想命名一个变量 12345foobar。您如何将其与 12345 区分开来？使用正则表达式实际上并不难。问题实际上是性能之一。我无法真正解释为什么这是非常详细的，但它基本上归结为将 12345foobar 与 12345 区分开来需要回溯的事实。这使得正则表达式不确定。

[这里](http://www.regular-expressions.info/catastrophic.html)有一个更好的解释。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2013-11-22T23:35:13.313

编译器很容易在内存位置上使用 ASCII 而不是数字来识别变量。

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2008-12-04T21:54:57.493

我认为简单的答案是可以，限制是基于语言的。在 C++ 和许多其他语言中它不能，因为该语言不支持它。它没有内置到允许这样做的规则中。

这个问题类似于问为什么国王不能在国际象棋中一次移动四个空格？这是因为在国际象棋中这是非法的举动。可以确定在另一场比赛中。这仅取决于正在播放的规则。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2012-02-22T21:21:53.430

最初只是因为将变量名称作为字符串而不是数字更容易记住（您可以赋予它更多含义），尽管数字可以包含在字符串中以增强字符串的含义或允许使用相同的变量名称，但将其指定为具有单独但密切的含义或上下文。例如 loop1、loop2 等总是让你知道你在一个循环中和/或循环 2 是 loop1 中的一个循环。您更喜欢哪个（更有意义）作为变量：地址还是 1121298？哪个更容易记住？但是，如果语言使用某些东西来表示它不仅仅是文本或数字（例如 $address 中的 $），它真的不应该有所作为，因为这会告诉编译器接下来的内容将被视为变量（在这种情况下）。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2015-04-08T13:38:52.293

编译器在编译期间也可以将变量视为一个值，因此该值可以递归地一次又一次地调用该值

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2018-04-23T16:10:35.983

**在编译这段代码时，在词法分析阶段避免了回溯**。苹果之类的变量；，编译器在词法分析阶段遇到字母'A'字符时会立即知道它的标识符。但是，像 123apple 这样的变量；，编译器将无法确定它是数字还是标识符，直到它命中'a'并且它需要回溯才能进入词法分析阶段以识别它是一个变量。但是编译器不支持它。

[参考](https://www.geeksforgeeks.org/variable-name-not-start-numbers-c/)

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2018-08-05T07:24:41.643

在声明变量时可能没有任何问题。但是当它尝试在其他地方使用该变量时会出现一些歧义，如下所示：

让 1 =“你好世界！” 打印(1) 打印(1)

print 是一个接受所有类型变量的通用方法。所以在那种情况下编译器不知道程序员指的是哪个（1）：整数值的1或存储字符串值的1。在这种情况下，编译器可能更好地允许定义类似的东西，但是当尝试使用这种模棱两可的东西时，会带来一个具有纠正能力的错误，以解决如何修复该错误并清除这种歧义。

# entity-framework - 实体框架，基于标准构建查询

> ID：342158
> 
> 赞同：2
> 
> 时间：2008-12-04T21:34:03.293
> 
> 标签：entity-framework, linq-to-entities, repository-pattern

我想知道是否有人对如何做到这一点有更好的想法。自动取款机返回对我`IQueryable<Member>`来说`ObjectQuery<Member>`似乎很脏。

```
namespace Falcon.Business.Repositories
{
    using System;
    using System.Data.Objects;
    using System.Linq;
    using Falcon.Business.Criteria;
    using Falcon.Business.Entities;
    using Falcon.Business.Enums;
    using Falcon.Business.Extensions;
    using Falcon.Business.Repositories.Interfaces;
    using Falcon.Business.Services;
    using Falcon.Business.Services.Interfaces;
    using Falcon.Core.Extensions;

    public class MemberRepository : LinqRepository<Member>, IMemberRepository
    {
        public Member Fetch(MemberCriteria criteria)
        {
            ObjectQuery<Member> query = base.CreateQuery();

            query = this.AddRelations(query);
            query = this.AddCriteria(query, criteria);
            query = this.AddCriteriaOrder(query, criteria);

            return query.FirstOrDefault();
        }

        public IPagerService<Member> FetchAll(MemberCriteria criteria)
        {
            int page = (criteria.Page.HasValue) ? criteria.Page.Value : 1;
            int limit = criteria.Limit;
            int start = (page * limit) - limit;
            int total = this.Count(criteria);

            ObjectQuery<Member> query = base.CreateQuery();

            query = this.AddRelations(query);
            query = this.AddCriteria(query, criteria);
            query = this.AddCriteriaOrder(query, criteria);

            return new PagerService<Member>(query.Skip(start).Take(limit).ToList(), page, limit, total);
        }

        public int Count(MemberCriteria criteria)
        {
            ObjectQuery<Member> query = base.CreateQuery();

            query = this.AddCriteria(query, criteria);

            return query.Count();
        }

        public ObjectQuery<Member> AddCriteria(IQueryable<Member> query, MemberCriteria criteria)
        {
            if (criteria.Title.HasValue())
            {
                query = query.Where(q => q.Title == criteria.Title);
            }

            if (criteria.TitleUrl.HasValue())
            {
                query = query.Where(q => q.TitleUrl == criteria.TitleUrl);
            }

            if (criteria.EmailAddress.HasValue())
            {
                query = query.Where(q => q.EmailAddress == criteria.EmailAddress);
            }

            if (criteria.HostAddress.HasValue())
            {
                query = query.Where(q => q.HostAddress == criteria.HostAddress);
            }

            query = query.Where(q => q.Status == criteria.Status);

            return query as ObjectQuery<Member>;
        }

        public ObjectQuery<Member> AddCriteriaOrder(IQueryable<Member> query, MemberCriteria criteria)
        {
            if (criteria.Sort == SortMember.ID)
            {
                query = criteria.Order == SortOrder.Asc
                    ? query.OrderBy(q => q.ID)
                    : query.OrderByDescending(q => q.ID);
            }
            else if (criteria.Sort == SortMember.Posts)
            {
                query = criteria.Order == SortOrder.Asc
                    ? query.OrderBy(q => q.Posts)
                    : query.OrderByDescending(q => q.Posts);
            }
            else if (criteria.Sort == SortMember.Title)
            {
                query = criteria.Order == SortOrder.Asc
                    ? query.OrderBy(q => q.Title)
                    : query.OrderByDescending(q => q.Title);
            }
            else if (criteria.Sort == SortMember.LastLogin)
            {
                query = criteria.Order == SortOrder.Asc
                    ? query.OrderBy(q => q.LastLogin)
                    : query.OrderByDescending(q => q.LastLogin);
            }
            else if (criteria.Sort == SortMember.LastVisit)
            {
                query = criteria.Order == SortOrder.Asc
                    ? query.OrderBy(q => q.LastVisit)
                    : query.OrderByDescending(q => q.LastVisit);
            }
            else
            {
                query = criteria.Order == SortOrder.Asc
                    ? query.OrderBy(q => q.Created)
                    : query.OrderByDescending(q => q.Created);
            }

            return query as ObjectQuery<Member>;
        }

        private ObjectQuery<Member> AddRelations(ObjectQuery<Member> query)
        {
            query = query.Include(x => x.Country);
            query = query.Include(x => x.TimeZone);
            query = query.Include(x => x.Profile);

            return query;
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-14T12:01:01.653

我也不喜欢返回一个对象查询，因为这样做会让你非常依赖实体框架。了解 Microsoft 他们可能会在版本 2 中进行大量更改，因此您不想这样做。

NHibernate 使用标准，有点像你建议的，但它们的实现更加通用。我比你的例子更喜欢更通用的实现，因为你不需要为每个对象建立标准。另一方面，你的实现是有类型的，这也很整洁。如果您想要两者兼得，一个更通用的类型化实现，您可能想看看 NHibernate 实现，但不要使用字符串，而是使用 lambda 函数和 .Net 泛型。我可以发布一个如何执行此操作的示例，但我目前不在我自己的机器上。

# wpf - 验证事件 - WPF

> ID：342159
> 
> 赞同：1
> 
> 时间：2008-12-04T21:34:12.887
> 
> 标签：wpf, validation

我正在考虑为 WPF 开发一个简单的验证框架（IDataErrorInfo 方法没有提供足够的信息来满足我的需求），并且想知道是否有办法在属性要验证时得到通知？请注意，我需要知道任何时候尝试验证，而不是仅在出现错误时才知道（因此 NotifyOnValidationError 不会削减它）

或者，我的最终目标只是将更多信息而不只是错误字符串打包到我的验证中（错误有多严重，更多信息的链接等），同时仍然允许验证由数据对象驱动（IDataErrorInfo 风格） . 如果有人能指出我这样做的方法，那么我也会非常高兴。:)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T22:12:38.317

您将遇到的问题是 WPF 数据绑定和验证与 IDataErrorInfo 接口相关联。绑定根据绑定的 UpdateSourceTrigger 属性检查验证。因此，如果您的绑定具有“UpdateSourceTrigger=PropertyChanged”，那么每次属性更改时，它都会调用 item["MyProperty"]，您将在此处返回有关您的属性是否有效的信息。如果它设置为“LostFocus”，那么它会检查控件何时失去焦点。绑定还需要“ValidatesOnDataErrors=True”才能强制对绑定的实体进行验证。

我认为您最好的选择是创建一个实现 IDataErrorInfo 的类，然后根据错误的严重性提供更详细的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-10T09:59:45.220

您需要考虑从 ValidationRule 继承，然后将新规则添加到所有绑定对象。

# c++ - 键盘挂钩...没有得到小写或大写字符

> ID：342167
> 
> 赞同：1
> 
> 时间：2008-12-04T21:35:29.390
> 
> 标签：c++, winapi, keyboard-hook, hook

下面的函数正在记录“0”、“z”和“1” ok...但它没有捕获“Z”（shift-z）...任何帮助将不胜感激...

```
__declspec(dllexport)
LRESULT CALLBACK HookProc (UINT nCode, WPARAM wParam, LPARAM lParam)
{
    if ((nCode == HC_ACTION) && (wParam == WM_KEYUP))
    {
        // This Struct gets infos on typed key
        KBDLLHOOKSTRUCT hookstruct = *((KBDLLHOOKSTRUCT*)lParam);

        // Bytes written counter for WriteFile()
        DWORD Counter;

        wchar_t Logger[1];

        switch (hookstruct.vkCode)
        {
        case 060: Logger[0] = L'0'; break;
        case 061: Logger[0] = L'1'; break;
        case 90: Logger[0] = L'z'; break;
        case 116: Logger[0] = L'Z'; break;
        }

        // Opening of a logfile. Creating it if it does not exists
        HANDLE  hFile = CreateFile(L"C:\\logfile.txt", GENERIC_WRITE,
            FILE_SHARE_READ, NULL,OPEN_ALWAYS, FILE_ATTRIBUTE_NORMAL, NULL);

        // put the file pointer to the end
        SetFilePointer(hFile,NULL,NULL,FILE_END);

        // Write the hFile typed in logfile
        WriteFile(hFile,&Logger,sizeof(Logger),&Counter,NULL);

        //WriteFile(hFile,&hookstruct.vkCode,sizeof(hookstruct.vkCode),&Counter,NULL);
        // Close the file
        CloseHandle(hFile);
    }
} 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-04T22:02:47.637

键盘不发送*字符*。它发送*密钥*。无论您是输入*z*还是*Z*，您仍然按同一个键，并且该键两次具有相同的 VK 代码。

您还应该在按下或释放 Shift 键时收到通知。您可以使用这些通知将击键转换为字符。大写锁定状态也与此相关。您可能还担心死键。

您可以检查是否按下了 Shift 键。`GetAsyncKeyState`将*立即告诉您密钥的*状态，`GetKeyState`并将告诉您从消息队列中删除的最后一条消息时的密钥状态。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-04T21:49:25.430

Z 没有虚拟键码。试试这样的方法：

```
 case 90:
                 if(GetKeyState(VK_LSHIFT|VK_RSHIFT)
                     Logger[0] = L'Z'; break;
                 else
                     Logger[0] = L'z'; break; 
```

# c++ - 多个 CComboBox 共享相同的数据

> ID：342171
> 
> 赞同：0
> 
> 时间：2008-12-04T21:37:22.850
> 
> 标签：c++, mfc

我有一个 MFC 对话框，上面有 32 个 CComboBoxes，它们在列表框中都有相同的数据。它需要一段时间才能出现，看起来延迟的一部分是我需要花费时间使用 InsertString() 将所有数据添加到 32 个控件。如何子类化 CComboBox 以便 32 个实例共享相同的数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T22:47:47.683

填充组合时关闭窗口重绘。例如：

```
m_wndCombo.SetRedraw(FALSE);
// Fill combo here
...
m_wndCombo.SetRedraw(TRUE);
m_wndCombo.Invalidate(); 
```

这可能会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T22:48:03.550

我要尝试的第一件事是调用“InitStorage”为字符串预分配内部存储器。来自 MSDN：

`// Initialize the storage of the combo box to be 256 strings with // about 10 characters per string, performance improvement.`

`int n = pmyComboBox->InitStorage(256, 10);`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T23:16:29.873

除了已经说过的内容之外，您还可以在组合框中关闭排序并在插入数据之前对其进行预排序。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T03:37:53.200

按照您的要求，一种方法是由所有者绘制 - 您将编写相当多的代码，但您不必将数据添加到所有代码中。" [CComboBox::DrawItem](http://msdn.microsoft.com/en-us/library/y5hb5f9t.aspx) "

Support.microsoft 有这篇关于子类化组合框的文章，这可能也很有趣“[如何在 CComboBox 中对 CListBox 和 Cedit 进行子类化](http://support.microsoft.com/default.aspx?scid=kb;en-us;Q174667)”

真的有人要问是否值得付出努力，这在很大程度上取决于诸如

*   列表中的条目数
*   对话框显示的次数
*   组合内容的可变性
*   在其他地方进行优化
    *   在屏幕完成之前不绘制
    *   只构建一次对话框并重新显示它。
    *   使用一个组合，但在不同时间在不同位置显示它

# iphone - 在 UITextField 中验证货币输入的最佳方法是什么？

> ID：342181
> 
> 赞同：18
> 
> 时间：2008-12-04T21:40:08.773
> 
> 标签：iphone, cocoa-touch

我的应用程序允许用户在控件中输入数值（货币）`UITextField`，但不幸的是，我希望可用的键盘布局不是内置选项之一，所以我不得不选择“数字和标点符号”选项界面生成器。这是 IB 中相应的对话框窗口：

[![在此处输入图像描述](https://i.stack.imgur.com/FbnvH.png)](https://i.stack.imgur.com/FbnvH.png)

因此，当我的应用程序要求用户输入时，它会显示以下内容：

[![在此处输入图像描述](https://i.stack.imgur.com/u9tbB.png)](https://i.stack.imgur.com/u9tbB.png)

这很好，但请查看用户可用的所有额外键！可以轻松输入“12;56！” 在文本字段中，我假设我必须以某种方式验证它。

所以我的问题是：如何验证输入的货币值`UITextField`？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2011-01-31T12:40:40.817

我有回答的冲动，因为这是我在谷歌上看到的第一个条目，排名最高的答案不允许我输入货币。
我是德国人，在德国（以及许多其他国家/地区）我们使用`,`小数分隔符。

我刚刚写了一个类似的方法，这就是我现在所拥有的。

```
- (BOOL) textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string {
    static NSString *numbers = @"0123456789";
    static NSString *numbersPeriod = @"01234567890.";
    static NSString *numbersComma = @"0123456789,";

    //NSLog(@"%d %d %@", range.location, range.length, string);
    if (range.length > 0 && [string length] == 0) {
        // enable delete
        return YES;
    }

    NSString *symbol = [[NSLocale currentLocale] objectForKey:NSLocaleDecimalSeparator];
    if (range.location == 0 && [string isEqualToString:symbol]) {
        // decimalseparator should not be first
        return NO;
    }
    NSCharacterSet *characterSet;
    NSRange separatorRange = [textField.text rangeOfString:symbol];
    if (separatorRange.location == NSNotFound) {
        if ([symbol isEqualToString:@"."]) {
            characterSet = [[NSCharacterSet characterSetWithCharactersInString:numbersPeriod] invertedSet];
        }
        else {
            characterSet = [[NSCharacterSet characterSetWithCharactersInString:numbersComma] invertedSet];              
        }
    }
    else {
        // allow 2 characters after the decimal separator
        if (range.location > (separatorRange.location + 2)) {
            return NO;
        }
        characterSet = [[NSCharacterSet characterSetWithCharactersInString:numbers] invertedSet];               
    }
    return ([[string stringByTrimmingCharactersInSet:characterSet] length] > 0);
} 
```

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2009-06-19T14:20:46.837

虽然您可以在 NSNumberFormatter 中放置，但我发现只筛选除 0-9 和 .

这对我来说效果很好：

```
 - (BOOL) textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string
{
    NSCharacterSet *nonNumberSet = [[NSCharacterSet characterSetWithCharactersInString:@"0123456789."] invertedSet];

```
return ([string stringByTrimmingCharactersInSet:nonNumberSet].length > 0); 
```

} 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-09-06T04:50:14.437

我发现这是一种相对干净的方法。我没有用非美国货币测试它，但由于它使用 NSNumberFormatter 的属性，我相信它应该正确处理它们。

首先在某个地方设置格式化程序：

```
 formatter = [NSNumberFormatter new];
    [formatter setNumberStyle: NSNumberFormatterCurrencyStyle];
    [formatter setLenient:YES];
    [formatter setGeneratesDecimalNumbers:YES]; 
```

使用格式化程序来解析和重新格式化他们的输入。它还处理在添加和删除数字时移动数字。

```
-(BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string
{
    NSString *replaced = [textField.text stringByReplacingCharactersInRange:range withString:string];
    NSDecimalNumber *amount = (NSDecimalNumber*) [formatter numberFromString:replaced];
    if (amount == nil) {
        // Something screwed up the parsing. Probably an alpha character.
        return NO;
    }
    // If the field is empty (the initial case) the number should be shifted to
    // start in the right most decimal place.
    short powerOf10 = 0;
    if ([textField.text isEqualToString:@""]) {
        powerOf10 = -formatter.maximumFractionDigits;
    }
    // If the edit point is to the right of the decimal point we need to do
    // some shifting.
    else if (range.location + formatter.maximumFractionDigits >= textField.text.length) {
        // If there's a range of text selected, it'll delete part of the number
        // so shift it back to the right.
        if (range.length) {
            powerOf10 = -range.length;
        }
        // Otherwise they're adding this many characters so shift left.
        else {
            powerOf10 = [string length];
        }
    }
    amount = [amount decimalNumberByMultiplyingByPowerOf10:powerOf10];

    // Replace the value and then cancel this change.
    textField.text = [formatter stringFromNumber:amount];
    return NO;
} 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-04T21:54:36.823

也许您可以**`UITextFieldDelegate`**在控件上附加 a 并让它实现**`textField:shouldChangeCharactersInRange:replacementString:`** 这样，如果它在该字段中看到您不想要的任何字符，它可以拒绝它们。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-12-04T22:59:11.517

结合`textField:shouldChangeCharactersInRange:replacementString:`Marc 提出的建议，您应该通过`NSNumberFormatter`using an传递文本`NSNumberFormatterCurrencyStyle`。这将处理货币格式的怪癖并处理特定于语言环境的选项。

如果您搜索它，iPhone 文档中有一个“可可数据格式化编程指南”部分。遗憾的是，这里的大部分 UI 信息都是特定于 Mac OS X 的（不适用于 iPhone），但它会向您展示如何使用格式化程序类。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-02-10T05:44:44.883

我发现 shouldChangeCharactersInRange 也搞砸了弹出式键盘、退格键和“完成”按钮。我发现如果我处理长度为 0 的字符串并允许控制字符，它工作得很好。

我不喜欢使用 NSNumberFormatter，因为它坚持认为数字在用户编辑时的所有阶段都是格式正确的，如果你想在数字中有两个小数点直到你删除，这可能会令人愤怒在错误位置的那个。

这是我使用的代码：

```
- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string
{
    if ([string length] < 1)    // non-visible characters are okay
        return YES;
    if ([string stringByTrimmingCharactersInSet:[NSCharacterSet controlCharacterSet]].length == 0)
        return YES;
    return ([string stringByTrimmingCharactersInSet:[self.characterSet invertedSet]].length > 0);
} 
```

self.characterSet 包含可接受的字符，我使用此方法为货币创建它：

```
- (NSCharacterSet *)createCurrencyCharacterSet
{
    NSLocale *locale = [NSLocale currentLocale];
    NSMutableCharacterSet *currencySet = [NSMutableCharacterSet decimalDigitCharacterSet];

    [currencySet addCharactersInString:@"-"];       // negative symbol, can't find a localised version
    [currencySet addCharactersInString:[locale objectForKey:NSLocaleCurrencySymbol]];
    [currencySet addCharactersInString:[locale objectForKey:NSLocaleGroupingSeparator]];
    [currencySet addCharactersInString:[locale objectForKey:NSLocaleDecimalSeparator]];

    return [[currencySet copy] autorelease];
} 
```

有点不愉快的代码`[[currencySet copy] autorelease]`返回一个不可变的 NSCharacterSet。

使用`[NSCharacterSet decimalDigitCharacterSet]`还包括印度语和阿拉伯语的等效字符，这希望这意味着使用这些语言的人们可以使用他们的字母数字输入数字。

仍然需要检查 NSNumberFormatter 是否可以解析用户的输入，如果不能则发出警报；尽管如此，当只能输入合法字符时，它会带来更好的体验。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2011-05-11T20:41:03.660

我一直看到人们在实现 shouldChangeCharactersInRange 时不知道如何正确确定结果字符串。

如果您返回 YES，以下是获取将输入的新文本的方法：

```
NSString *newText = [textField.text stringByReplacingCharactersInRange:range withString:string]; 
```

一旦有了这个新文本，就很容易检查该文本是否是有效数字，并相应地返回 YES 或 NO。

请记住，如果用户尝试使用带有光标键的蓝牙键盘或使用高级编辑功能（选择、剪切、粘贴）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-06-19T14:33:49.773

如果您希望他们只能输入数字 - 您也可以考虑使用数字键盘

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-10-22T01:19:32.097

在找到处理美国货币的堆栈溢出的快速解决方案后，我重写了该函数以安全地处理国际货币。此解决方案将动态验证来自 UITextField 的用户输入，并在他们键入时进行更正。

```
- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string {      

   NSNumberFormatter *nf = [[NSNumberFormatter alloc] init];

   [numberFormatter setFormatterBehavior:NSNumberFormatterBehavior10_4];
   [numberFormatter setNumberStyle:NSNumberFormatterCurrencyStyle];
   [numberFormatter setMaximumFractionDigits:2];
   [numberFormatter setMinimumFractionDigits:0];

    // Grab the contents of the text field
    NSString *text = [textField text];  

    // the appropriate decimalSeperator and currencySymbol for the current locale
    // can be found with help of the
    // NSNumberFormatter and NSLocale classes.
    NSString *decimalSeperator = numberFormatter.decimalSeparator;  
    NSString *currencySymbol = numberFormatter.currencySymbol;

    NSString *replacementText = [text stringByReplacingCharactersInRange:range withString:string];
    NSMutableString *newReplacement = [[ NSMutableString alloc ] initWithString:replacementText];

    // whenever a decimalSeperator or currencySymobol is entered, we'll just update the textField.
    // whenever other chars are entered, we'll calculate the new number and update the textField accordingly.
    // If the number can't be computed, we ignore the new input.
    NSRange decimalRange = [text rangeOfString:decimalSeperator];
    if ([string isEqualToString:decimalSeperator] == YES && 
        [text rangeOfString:decimalSeperator].length == 0) {
        [textField setText:newReplacement];
    } else if([string isEqualToString:currencySymbol] == YES&& 
              [text rangeOfString:currencySymbol].length == 0) {
        [textField setText:newReplacement];        
    } else if([newReplacement isEqualToString:currencySymbol] == YES) {
        return YES;
    }else {

        NSString *currencyGroupingSeparator = numberFormatter.currencyGroupingSeparator;

        [newReplacement replaceOccurrencesOfString:currencyGroupingSeparator withString:@"" options:NSBackwardsSearch range:NSMakeRange(0, [newReplacement length])];        
        [numberFormatter setNumberStyle:NSNumberFormatterCurrencyStyle];

        NSNumber *number = [numberFormatter numberFromString:newReplacement];

        if([newReplacement length] == 1) {
            [numberFormatter setNumberStyle:NSNumberFormatterDecimalStyle];
            number = [numberFormatter numberFromString:newReplacement];
        }

        if (number == nil) { 
            [newReplacement release];
            return NO;
        }
        [numberFormatter setNumberStyle:NSNumberFormatterCurrencyStyle];    
        text = [numberFormatter stringFromNumber:number];
        [textField setText:text];       
    }

    [newReplacement release];

    return NO; // we return NO because we have manually edited the textField contents.
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-05T00:11:18.857

使用 NSNumberFormatter 是正确的答案。它将处理验证并将字符串转换为正确的对象类型。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-10-21T00:05:00.677

您还可以使用 Gamma-Point 解决方案并评估 *aNumber 是否为 Nil，如果为 Nil，则表示不是 0-9 的字符。或 , 已输入，这样您就可以只验证数字，如果输入任何无数字字符，它将为零。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2012-01-17T08:43:00.063

我找不到货币验证的适当实现。这是我的变体：

```
- (BOOL)textField:(UITextField *)textField shouldChangeCharactersInRange:(NSRange)range replacementString:(NSString *)string {

   NSString* proposedString = [textField.text stringByReplacingCharactersInRange:range withString:string];

   //if there is empty string return YES
   if([proposedString length] == 0) {
       return YES;
   }

   //create inverted set for appripriate symbols
   NSCharacterSet *nonNumberSet = [[NSCharacterSet characterSetWithCharactersInString:@"0123456789.,"] invertedSet];

   //if side symbols is trimmed by nonNumberSet - return NO
   if([proposedString stringByTrimmingCharactersInSet:nonNumberSet].length != [proposedString length]) {
       return NO;
   }

   //if there is more than 1 symbol of '.' or ',' return NO
   if([[proposedString componentsSeparatedByCharactersInSet:[NSCharacterSet characterSetWithCharactersInString:@".,"]] count] > 2) {
      return NO;
   }

   //finally check is ok, return YES
   return YES;
} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-09-04T21:21:49.483

由于退格按钮不起作用，使用 shouldChangeCharactersInRange 会搞砸弹出键盘。

数字格式化程序是要走的路。这是我用来查找正小数的示例。我在验证检查期间调用它——例如当用户单击保存按钮时。

```
 -(BOOL) isPositiveNumber: (NSString *) numberString {

    NSNumberFormatter *numberFormatter = [[NSNumberFormatter alloc] init];
    [numberFormatter setNumberStyle:NSNumberFormatterDecimalStyle];

    NSNumber *aNumber  =  [numberFormatter numberFromString:numberString];
    [numberFormatter release];

    if ([aNumber floatValue] > 0) {
        NSLog( @"Found positive number %4.2f",[aNumber floatValue] );

        return YES;
    }
    else {
        return NO;
    }
} 
```

# fitnesse - Fitnesse - Can I make an existing wiki page a subwiki?

> ID：342183
> 
> 赞同：0
> 
> 时间：2008-12-04T21:41:27.897
> 
> 标签：fitnesse

I am trying to create a test suite of some of the existing pages I have developed using fitnesse. Does the tool support to change or refactor the pages to sub-wikis to make a part of newly created test suite?

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T22:42:50.660

不确定我是否完全理解你的问题。

您可以重构一个测试套件以“重新定位”到另一个 wiki。只需转到页面并选择“重构”按钮。在文本框中，选择“MyWiki.MySubPage.EtcEtc”形式的新父页面路径。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-10-02T12:20:35.867

您可以为此使用符号链接。

单击侧边栏上的属性，然后在底部您可以将您的页面从其他套件符号链接到套件中。

此功能还可用于运行具有不同设置/拆卸变化的测试。

# language-agnostic - 如何将重力应用到我的弹跳球应用程序？

> ID：342189
> 
> 赞同：11
> 
> 时间：2008-12-04T21:42:31.933
> 
> 标签：language-agnostic, physics, gravity

我编写了一个相当简单的 Java 应用程序，它允许您拖动鼠标，并根据您所做的鼠标拖动长度，它会朝那个方向射一个球，并在它移动时从墙壁上反弹。

这是一个快速的屏幕截图：
[alt text http://img222.imageshack.us/img222/3179/ballbouncemf9.png](http://img222.imageshack.us/img222/3179/ballbouncemf9.png)

屏幕上的每个圆圈都是一个 Ball 对象。球的运动被分解为一个 x 和 y 向量；

```
public class Ball {
    public int xPos;
    public int yPos;
    public int xVector;
    public int yVector;

    public Ball(int xPos, int yPos, int xVector, int yVector) {
        this.xPos = xPos;
        this.yPos = yPos;
        this.xVector = xVector;
        this.yVector = yVector;
    }

    public void step()
    {
        posX += xVector;
        posY += yVector;

        checkCollisions();
    }

    public void checkCollisions()
    {
        // Check if we have collided with a wall
        // If we have, take the negative of the appropriate vector
        // Depending on which wall you hit
    }

    public void draw()
    {
        // draw our circle at it's position
    }
} 
```

这很好用。所有的球都从一堵墙反弹到另一堵墙。

但是，我已经决定我希望能够包括重力的影响。我知道物体以 9.8m/s 的速度向地球加速，但我不直接知道这应该如何转化为代码。我意识到 yVector 会受到影响，但我对此的实验并没有达到我想要的效果。

理想情况下，***我希望能够为这个程序添加一些重力效果，并让球在落到“地面”之前反弹几次。***

我怎样才能创建这种弹跳有弹性的重力效果？我必须如何在每一步操纵球的速度矢量？当它撞到“地面”时必须做什么，以便我可以让它再次弹起，但比上次短一些？

任何帮助都可以为我指明正确的方向。

* * *

谢谢大家的评论！它已经很好用了！

在我的 step() 中，我向我的 yVector 添加了一个重力常数，就像人们建议的那样，这是我的 checkCollision()：

```
public void checkCollision()
{
    if (posX - radius < 0)              // Left Wall?
    {
        posX = radius;              // Place ball against edge
        xVector = -(xVector * friction);
    }
    else if (posX + radius > rightBound) // Right Wall?
    {
        posX = rightBound - radius;     // Place ball against edge
        xVector = -(xVector * friction);
    }

    // Same for posY and yVector here.
} 
```

但是，球将继续在地板上滑动/滚动。我认为这是因为我只是在每次反弹时仅取其向量的百分比（90%），而且它永远不会真正为零。我是否应该添加一个检查，如果 xVector 变为某个绝对值，我应该将其更改为零？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-12-04T21:47:14.530

你需要做的是不断地从你的 yVector 中减去一个小常数（代表你的 9.8 m/s）。当球向下时（yVector 已经是负数），这会使它跑得更快。当它上升时（yVector 为正），它会减慢速度。

这不会解释摩擦，所以事情应该永远反弹。

编辑1：考虑到摩擦，每当它反转（并且你反转符号）时，将绝对数字降低一点。就像它在 yVector=-500 处命中一样，当您反转符号时，将其设为 +480 而不是 +500。您可能应该对 xVector 做同样的事情来阻止它左右弹跳。

编辑2：另外，如果你想让它对“空气摩擦”做出反应，每次调整都会将两个向量减少一个非常小的量。

编辑3：关于永远在底部滚动的东西——根据你的数字有多高，它可能是两件事之一。要么你的数字很大，而且似乎需要很长时间才能完成，要么你正在四舍五入，你的向量总是 5 或其他东西。（5 的 90% 是 4.5，所以它可能会四舍五入到 5）。

我会打印出一个调试语句，看看向量编号是什么样的。如果它们到达 5 左右并停留在那里，那么你可以使用一个函数将你的分数截断为 4 而不是四舍五入回到 5。如果它继续下降并最终停止，那么你可能不得不提高你的摩擦系数.

如果你找不到一个简单的“舍入”函数，你可以使用 (0.9 * Vector) - 1，从现有方程中减去 1 应该做同样的事情。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-12-05T17:45:54.220

当球在地面上滚动时，是的，检查速度是否低于某个最小值，如果是，则将其设置为零。如果您查看这种理想化运动背后的物理原理并与现实世界中发生的情况进行比较，您会发现无法使用单个方程来解释真实球停止运动的事实。

顺便说一句，您所做的称为数值积分的欧拉方法。它是这样的：

*   从运动学方程开始：
    x(t) = x0 + vx*t + 0.5*ax *t^2
    y(t) = y0 + vy* t + 0.5*ay *t^2
    vx(t) = vx0 + ax* t
    vy(t) = vy0 + ay*t
    其中 x 和 y 是位置，vx 和 vy 是速度，ax 和 ay 是加速度，t 是时间。x0、y0、vx0 和 vy0 是初始值。这描述了在没有任何外力的情况下物体的运动。

*   现在应用重力：
    ay = -9.8 m/s^2
    至此，没有必要做任何棘手的事情。我们可以随时使用这个方程求解每个球的位置。

*   现在添加空气摩擦：由于它是一个球形球，我们可以假设它的摩擦系数为 c。对于如何模拟空气摩擦，通常有两种选择。它可以与速度或速度的平方成正比。让我们使用平方：
    ax = -c *vx^2
    ay = -c* vy^2 - 9.8
    因为加速度现在取决于速度，它不是恒定的，我们必须积分。这很糟糕，因为没有办法手动解决这个问题。我们必须在数字上进行整合。

*   我们采用离散时间步长 dt。对于欧拉方法，我们只需将上述方程中所有出现的 t 替换为 dt，并使用前一个时间步的值代替初始值 x0、y0 等。所以现在我们的方程看起来像这样（在伪代码中） :

    // 保存以前的值
    xold = x;
    yold = y;
    vxold = vx;
    vyold = vy;

    // 更新加速度
    ax = -c *vxold^2;
    ay = -c* vyold^2 - 9.8;

    // 更新速度
    vx = vxold + ax *dt;
    vy = vyold + ay* dt;

    // 更新位置
    x = xold + vxold*dt + 0.5*ax *dt^2;
    y = yold + vyold* dt + 0.5*ay*dt^2;

这是一个近似值，所以它不会完全正确，但看起来还不错。问题是对于更大的时间步长，误差会增加，所以如果我们想要准确地模拟一个真实球的移动方式，我们必须使用非常小的 dt 值，这会导致计算机的准确性问题。为了解决这个问题，有更复杂的技术。但是如果你只是想同时看到看起来像重力和摩擦的行为，那么欧拉的方法是可以的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-04T21:54:00.553

每次切片时，您都必须通过向下加速球来施加重力的影响。正如比尔 K 建议的那样，这就像从“yVector”中减去一样简单。当球击中底部时，yVector = -yVector，所以现在它向上移动但仍在向下加速。如果你想让球最终停止弹跳，你需要使碰撞稍微缺乏弹性，基本上是通过在 y 向上移除一些速度，可能不是“yVector = -yVector”，而是让它成为“yVector = -0.9 * y向量”。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-04T21:54:57.683

```
public void step()
{
    posX += xVector;
    posY += yVector;

    yVector += g //some constant representing 9.8

    checkCollisions();
} 
```

在 checkCollisions() 中，当 yVector 在地面上反弹时，您应该将 yVector 反转并乘以 0 到 1 之间的数字。这应该会给你想要的效果

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-05T05:10:48.090

这是一种弹道运动。所以你在 x 轴上有一个线性运动，在 y 轴上有一个匀速加速运动。

基本思想是 y 轴将遵循以下等式：

```
y = y0 + v0 * t + (0.5)*a*t^2 
```

或者，在 C 代码中，例如：

```
float speed = 10.0f, acceleration = -9.8f, y = [whatever position];

y += speed*t + 0.5f*acceleration*t^2; 
```

我在这里使用 tiem 参数化。但是你可以使用 Torricelli：

```
v = sqrt(v0^2 + 2*acceleration*(y-y0)); 
```

而且，在这个模型上，您必须保持 v 和 y 的最后一个值。

最后，我使用第一个模型做了类似的事情，其中​​ dt（时间差）固定为 1/60 秒（60 FPS）。

好吧，这两个模型都给出了很好的真实结果，但是例如 sqrt() 是昂贵的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-04T21:55:00.553

你真的想模拟重力的作用——它所做的只是产生随时间变化的力来改变物体的速度。每次你迈出一步，你都会稍微改变你的球的速度，以便将它“拉”向小部件的底部。

为了解决无摩擦/弹跳球的解决问题，您需要使“地面”碰撞产生与严格反射不同的效果 - 它应该从球中移除一些能量，使其反弹回来撞击地面后的速度比其他情况下要小。

在这些类型的弹性可视化中，您通常想要做的另一件事是也给地面一些侧向摩擦力，这样当它一直撞击地面时，它最终会滚动停止。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-04T21:55:07.603

我同意“Bill K”所说的话，并补充说，如果您希望他们“解决”，您将需要随着时间的推移减少 x 和 y 向量（施加阻力）。这一次必须是非常小的数量，因此您可能必须将向量从 int 更改为浮点类型，或者每隔几秒将它们减少 1。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-04T21:55:34.233

您要做的是更改 xVector 和 yVector 的值以模拟重力和摩擦力。这真的很简单。（需要将所有变量更改为浮点数。当需要绘制时，只需围绕浮点数。）

在您的 step 函数中，更新球的位置后，您应该执行以下操作：

```
yVector *= 0.95;
xVector *= 0.95;
yVector -= 2.0; 
```

这会稍微降低 X 和 Y 速度，让您的球最终停止移动，然后对 Y 值应用一个恒定的向下“加速度”，这将比“减速”更快地累积并导致球下落。

这是您真正想做的近似值。你真正想要的是保留一个代表你的球的加速度的向量。然后，您将每一步都将该向量与恒定的重力向量进行点积，以稍微改变球的加速度。但我认为我比你想得到的更复杂，除非你正在寻找更真实的物理模拟。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-04T22:37:05.820

> 当它撞到“地面”时必须做什么，这样我才能让它再次弹起

如果你假设一个完美的碰撞（即所有的能量都是守恒的），你所要做的就是反转速度标量之一的符号，这取决于被撞到的墙。

例如，如果球击中右侧或左侧墙壁，则修改 x 标量分量并保持 y 标量分量相同：

```
 this.xVector = -this.xVector; 
```

如果球撞击顶部或底部墙壁，则反转 y 标量分量并保持 x 标量分量相同：

```
 this.yVector = -this.yVector; 
```

> 但比上次短一些？

在这种情况下，一些能量会在与墙壁的碰撞中损失掉，所以只需添加一个损失因子以在每次撞到墙壁时获取一些速度：

```
 double loss_factor = 0.99;
 this.xVector = -(loss_factor * this.xVector);
 this.yVector = -(loss_factor * this.yVector; 
```

# visual-studio - 将 Visual Studio 的 Find in Files 默认设置为项目目录？

> ID：342193
> 
> 赞同：1
> 
> 时间：2008-12-04T21:43:31.200
> 
> 标签：visual-studio, findinfiles

我的开发机器上有许多不同的相同项目代码的分支/结帐。除了我在每个项目中进行的各种维护错误修复或改进之外，每一个几乎都是相同的。

当我在 Visual Studio 中使用 Find in Files 来搜索我的代码时，问题就出现了。VS2005 存储了在其“在文件中查找”对话框中使用的最后一个搜索目录……这可能是也可能不是我正在处理的项目目录。由于我的项目非常相似，很容易意外搜索到类似的项目，更改一些代码，然后才意识到我编辑了错误的项目。（啊！！）

有没有办法让 VS 将其在文件中的查找默认搜索到项目目录？显然，属性设置会很棒，但加载项也可以。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T21:59:02.243

这也让我发疯。但是在文件 dlg 中查找的“查找：”下拉列表中，您将找到解决方案和项目的项目。我认为这应该对你有用。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2008-12-04T21:50:00.500

在 VS2008 中，没有打开文件，当我选择“当前项目”时，它会搜索解决方案资源管理器中当前选择的任何项目。当我在不同项目中的文件之间切换时，它会正确搜索当前所选文件的项目。我没有看到任何改变这种行为的选择。

# email - 如何从网页/网络表单发送电子邮件？

> ID：342218
> 
> 赞同：1
> 
> 时间：2008-12-04T21:50:19.393
> 
> 标签：email

有哪些技术可用于通过网页或网页上的表单发送电子邮件？

我有一些背景想法，您将表单数据发布到脚本，但我真的不知道 cgi 脚本是什么（我很想知道这是否是建议的方法！）或者当前的做法是什么是。

这只是为用户提供一些联系运营商的方式。页面内表单对用户来说似乎比要求他们打开邮件客户端更容易。我还担心机器人会获取联系电子邮件地址（在 mailto: 链接的情况下）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T11:36:09.240

当您提交表单时，该表单中的数据会发送到服务器端脚本。例如，在 PHP 中，您使用数组访问该数据`$_POST`，`<input name="">`成为数组索引.. 例如..

```
// <form action="mailer.php">[..]<input name="subject" [..]><input name="content" [..]></form>
echo("The subject is: ". $_POST['subject']);
echo("The content is:" . $_POST['content']); 
```

在最基本的层面上，您所要做的就是使用内置于邮件功能的编程语言。同样，在 PHP 中这很简单[`mail()`](http://php.net/manual/en/function.mail.php)：

```
mail($to, $subject, $message); 
```

您只需设置`$to`您的电子邮件地址（*不允许*用户设置此地址，否则他们能够以“您”的身份向任何人发送邮件 - “垃圾邮件”..），`$subject`并将`$message`设置为`$_POST[]`

在你有一个 HTML 文件进入脚本之前`mail("me@example.com", $_POST['subject'], $_POST['content']);`，想想如果有人重新加载该页面 200 次会发生什么。你*必须*有某种安全性，可能是验证码和/或速率限制。

有一件事曾经困扰过我——记住“联系我们的表格”*不能*代替提供实际的电子邮件地址！例如，我的邮件客户端保留了我发送的所有邮件的副本，并且我可以附加文件，并且在熟悉的邮件客户端中编写比使用表单更好`<textarea>`（尤其是当我不小心点击“返回”并且表单决定清除时）本身）！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T21:53:12.960

对于大多数 unix/bsd/linux 系统，大多数语言都提供了 Mail 命令的编程包装。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T21:51:54.177

如果您使用的是 ASP.NET 2.0，则可以使用 System.Net.Mail 命名空间。 [更多信息在这里](http://www.systemnetmail.com/default.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T21:54:31.083

当今用于 Web 开发的语言通常具有用于发送电子邮件的库。这取决于您使用哪种语言，但您会在您的语言文档中找到它。这很简单，您语言中的库通常封装并提供您使用的“smtp 客户端”行为。您提供带有发件人和收件人的邮件消息，以及连接到您的 SMTP 服务器的数据。

或者，您有时可以在您的 Web 服务器所在的机器上使用 SMTP 功能（如果这些功能可用）。我不确定收件人服务器上的电子邮件是否会变得更糟，因为您的服务器可能不会被识别为域的邮件服务器......有更多经验的人可能会对此发表评论。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-04T21:56:11.517

好吧，这是不应该做的事情：

```
<a href="mailto:someperson@someaddress.com">Please spam me, kthx</a> 
```

让用户提交表单、清理输入并按照您认为合适的方式对其进行格式化，然后以您选择的语言将数据传递给邮件功能，这是一种更好的代码模式。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-05T00:14:41.487

发送邮件应该在服务器端完成——具体情况会根据您的服务器端语言、操作系统以及服务器对 SMTP 服务器的访问权限而有所不同。

如果您正在寻找一种将联系表添加到博客或公共网站的轻量级方法，请尝试[Wufoo](http://wufoo.com/) - 您可以添加一个可以非常轻松地向您发送电子邮件的联系表（最多免费提供 3 个表单）。我不隶属于他们，我只是觉得他们很酷。

# sql - 简单的 T-SQL 连接问题

> ID：342219
> 
> 赞同：2
> 
> 时间：2008-12-04T21:50:27.940
> 
> 标签：sql, sql-server, tsql, join

我试图通过加入 table2 并在 WHERE 语句中使用 table2 列来从 table1 中选择一条记录。table1 中的 Col1 和 Col2 可以存储在 table2 的 col1 中。我需要将 table2 的 col1 与 table1 中 col1 或 col2 的值连接起来

这是我创建的sql语句（伪）：

```
SELECT
   t1.Col1,
   t1.Col2,
   t1.Col3,
   t1.Col4
FROM
   table1 t1
JOIN table2 t2 on t2.Col1 = t1.Col1 or t2.Col1 = t1.Col2 
```

解决这个问题的最佳方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-04T21:56:56.477

那应该没问题。相同条件的另一种写法如下：

```
... JOIN table2 t2 on t2.Col1 IN (t1.Col1, t1.Col2) 
```

在这种情况下，您采用哪种方式并不重要。做你觉得更具可读性的事情。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T21:57:59.110

如果我正确理解了您的问题，那么您的 SQL 查询就很好了。

# continuous-integration - TeamCity 4 和 VisualSVN 服务器 1.6

> ID：342227
> 
> 赞同：2
> 
> 时间：2008-12-04T21:53:35.377
> 
> 标签：continuous-integration, teamcity, visualsvn-server

视窗服务器 2008 / IIS 7...

我正在尝试使用 TeamCity 4 设置和 CI 环境。到目前为止一切顺利，VisualSVN Server / Subversion 存储库已设置完毕，TeamCity 正在监视它，并启动构建。我可以通过 http:localhost:8080 毫无问题地使用 TeamCity Webapp。我的问题是我无法从我的开发机器远程访问 TeamCity webapp。我觉得这是 Apache / Tomcat 配置的问题，但甚至不知道从哪里开始。有人有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T22:50:59.817

我在 Windows 2008 服务器上安装了 TeamCity 3.2.x，远程访问它时没有遇到任何问题，但您可能需要检查防火墙以查看它是否在端口 8080 上打开。Windows 防火墙 > 入站规则 > 按端口排序，并查看是否为本地端口 8080 定义了规则。如果没有，请添加它。

IIS 管理器可能也值得研究...（开始 > 键入 IIS 管理器）并查看 TeamCity 的站点设置

也有可能，如果 IIS 运行正常，您将能够在端口 80 上本地访问计算机，只是为了确认一般连接。

# asp.net-mvc - MS MVC 预览 2 和 .NET 3.5 sp1

> ID：342228
> 
> 赞同：0
> 
> 时间：2008-12-04T21:53:56.233
> 
> 标签：asp.net-mvc, .net-3.5

我有一个使用 MVC Preview 2 构建的站点，但还没有升级到最新版本，主要是因为需要进行大量更改，而且我没有时间。无论如何，昨晚我的主机安装了 .NET 3.5 sp1，它杀死了我的网站。[这是本网站http://haacked.com/archive/2008/05/12/sp1-beta-and-its-effect-on-mvc.aspx](http://haacked.com/archive/2008/05/12/sp1-beta-and-its-effect-on-mvc.aspx)上的一个已识别问题（这就是您使用 pre betas 所得到的）和它说去这个网站解决[http://www.asp.net/downloads/3.5-SP1/Readme/default.aspx](http://www.asp.net/downloads/3.5-SP1/Readme/default.aspx)。

不幸的是，周围的工作似乎已被取消。任何人都可以阐明它所说的内容以及解决方法是什么。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T14:58:44.947

也许这个说明很有用，它们是将 mvc preview 2 上的站点迁移到 mvc preview 3。由于 preview 3 站点不受 beta sp1 的影响，我希望它有所帮助：

**将现有 Preview2 应用程序升级到 Preview 3** 本节中的信息描述了您必须进行的更改，以修改使用 Preview 2 版本创建的 ASP.NET MVC 应用程序，以便它与 Preview 3 版本一起使用。

**代码更改** 更新对以下程序集的引用以指向新的 Preview 3 版本的程序集：

```
System.Web.Abstractions 
System.Web.Routing 
System.Web.Mvc 
```

默认情况下，这些程序集位于以下文件夹中：

```
%ProgramFiles%\Microsoft ASP.NET\ASP.NET MVC Preview 3 
```

对于所有现有的操作方法，将返回类型从 void 更改为 ActionResult。在任何地方调用 RenderView，将其更改为调用返回 View。您可以搜索`RenderView(`并将其替换为`return View(`.

在您调用的任何地方`RedirectToAction`，在调用前加上 return 关键字。搜索`RedirectToAction(`并将其替换为`return RedirectToAction(`.

如果您使用强类型页面，请替换`<%= ViewData.PropertyName %>`为`<%= ViewData.Model.PropertyName %>`. MVC 框架现在没有将 ViewData 对象替换为您的强类型对象，而是将 Model 属性设置为您提供的实例。

在 Global.asax 文件中，删除 Default.aspx 的路由定义。在默认的 Preview 2 模板中，路由类似于以下示例：

```
routes.Add(new Route("Default.aspx", new MvcRouteHandler())
{

  Defaults = new RouteValueDictionary(new { controller = "Home", action = "Index", id = "" }),

}); 
```

在 Global.asax 文件中，找到以下默认 MVC 路由：

```
routes.Add(new Route("{controller}/{action}/{id}", new MvcRouteHandler())
{

  Defaults = new RouteValueDictionary(new { action = "Index", id = "" }),

}); 
```

将其替换为以下路线：

```
routes.MapRoute(
    "Default",                                      // Route name

    "{controller}/{action}/{id}",                   // URL with parameters

    new { controller = "Home", action = "Index", id = "" }  // Parameter defaults

); 
```

在 RegisterRoutes 方法的最开始添加以下行：

```
routes.IgnoreRoute("{resource}.axd/{*pathInfo}"); 
```

编辑 Default.aspx 文件并添加以下行：

```
<% Response.Redirect("~/Home") %> 
```

对于 IIS 7，此重定向不是必需的。这是针对 Visual Studio（ASP.NET 开发服务器）中内置的 Web 服务器如何与路由一起工作的问题的解决方法。

**配置更改** 在 Web.config 文件中，您必须将 UrlRoutingHandler 部分中 httpHandler 条目的 type 属性更改为 System.Web.HttpForbiddenHandler。

为此，请在文件中搜索以下字符串：

```
path="UrlRouting.axd" type="System.Web.Routing.UrlRoutingHandler, System.Web.Routing, Version=3.5.0.0, Culture=neutral, PublicKeyToken=31BF3856AD364E35" 
```

将其替换为以下字符串：

```
path="UrlRouting.axd" type="System.Web.HttpForbiddenHandler, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a" 
```

由于 System.Web.Abstractions 和 System.Web.Routing 程序集的版本号已更改为 0.0.0.0，因此您必须更新 Web.config 文件中的版本信息。在 Web.config 文件中，搜索以下字符串：

```
System.Web.Routing, Version=3.5.0.0 
```

将其替换为以下字符串：

```
System.Web.Routing, Version=0.0.0.0 
```

搜索以下字符串：

```
System.Web.Abstractions, Version=3.5.0.0 
```

将其替换为以下字符串：

```
System.Web.Abstractions, Version=0.0.0.0 
```

# asp.net - asp.net viewstate 加密

> ID：342245
> 
> 赞同：10
> 
> 时间：2008-12-04T21:58:19.983
> 
> 标签：asp.net, encryption, viewstate

我有几个关于在 asp.net 3.5 中何时以及如何加密视图状态的问题。例如，如果我的 web.config 中有一个机器密钥条目，例如：decryptionKey="AutoGenerate,IsolateApps" validation="AES" decryption="Auto" />

此时视图状态是否加密？或者我还需要在页面部分中指定 viewStateEncryptionMode 吗？

此外，是否可以加密表单身份验证 cookie，但不能同时加密视图状态？

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-12-04T22:12:18.770

页面上的控件可以请求对 ViewState 使用加密，但即使此请求也可以被页面设置覆盖。

ViewStateEncryptionMode 枚举具有三个值：Auto、Always 和 Never。默认值为自动。

**ViewStateEncryptionMode.Auto**

在这种模式下，如果页面上的任何控件请求它，ASP.NET 将加密页面的 ViewState。请注意，这意味着所有 ViewState 都已加密，而不仅仅是请求它的控件的 ViewState。与加密相关的大部分性能成本都在开销中。因此，如果多个控件发出请求，则加密整个 ViewState 比执行单独的加密操作更快。

**ViewStateEncryptionMode.Never**

如您所料，在这种模式下 ASP.NET 不会加密 ViewState，即使应用程序设置为加密并且页面上的控件已请求它。如果您知道页面中涉及的任何数据都不需要加密，那么将模式设置为从不可能是安全的。但是，此时有关控件的文档很少会披露保存在 ViewState 中的内容，因此如果有可能暴露敏感数据，您将需要小心。

**ViewStateEncryptionMode.Always**

在这种模式下，ASP.NET 不会等待页面中的控件请求加密。ViewState 始终是加密的。处理敏感数据时，最好使用加密。

来源：http: [//msdn.microsoft.com/en-us/library/aa479501.aspx](http://msdn.microsoft.com/en-us/library/aa479501.aspx)

# c# - ASP.NET HttpHandler 可以处理 http 400 - 错误请求吗？

> ID：342247
> 
> 赞同：9
> 
> 时间：2008-12-04T21:58:43.337
> 
> 标签：c#, asp.net, http, iis-7, httphandler

我们有一个 HttpHandler，它直接处理来自自定义客户端软件的 HTTP 上的二进制帖子。客户端软件偶尔会发送导致 IIS 7 响应 400 - 错误请求的数据。由于“400 Bad Request”的特殊之处在于 HTTP.SYS 在内核模式下透明地处理它而不通知用户模式任何内容，因此不会引发任何错误以在 ASP.NET 中处理。是否可以在 ASP.NET 中捕获此 http 400，以便在这些场景中将特定数据写入响应流？重定向到另一个页面不是一个选项，因为它需要在当前请求/响应中。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T11:21:02.343

如果您知道导致 400 的原因，那么您可以通过注册表自定义 http.sys 的行为来处理它：

[http://support.microsoft.com/kb/820129](http://support.microsoft.com/kb/820129)

但是，您应该意识到这样做可能会对安全性和性能产生影响。

另一种选择是在 IIS 之前使用过滤代理，从而在请求继续之前捕获请求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-29T15:35:24.170

相反，我会要求他们修复自定义客户端软件。给他们一份显示失败请求的报告。如果可以，请运行 Wireshark 之类的嗅探器，如果他们不认为问题出在他们的软件上，则将数据包发送给他们。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T13:36:12.587

如果您的自定义客户端导致 IIS 触发 HTTP 400，则它可能存在缺陷并且未根据标准提交有效的 HTTP 请求。如果您可以更改客户端，那将是正确的做法。否则，您使用的不是 HTTP，而 IIS 旨在处理 HTTP 请求。因此，您应该为您自己的协议运行自定义服务器（这是一种非标准的 HTTP 之类的东西）。

不建议使用 IIS/ASP.NET 来处理这样的请求，因为它可能会导致一些奇怪的意外事情发生。

# java - 在 Ant 中读取属性值

> ID：342250
> 
> 赞同：2
> 
> 时间：2008-12-04T21:59:06.177
> 
> 标签：java, ant

我需要从 Ant 脚本中的文件中读取属性的值并去掉前几个字符。有问题的财产是

```
path=file:C:/tmp/templates 
```

此属性存储在一个文件中，我可以通过 ant 脚本访问该文件

```
<property file="${web.inf.dir}/config.properties"/> 
```

我有两个问题：

1.  如何从加载的属性文件中读取单个“路径”属性？
2.  如何从属性值中删除前导“文件：”？

最终，我希望能够访问 Ant 脚本中的以下名称-值对：

```
path=C:/tmp/templates 
```

干杯，唐

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T23:10:09.513

在 Ant 1.6 或更高版本中，您可以使用`LoadProperties`嵌套`FilterChain`

```
<loadproperties srcFile="${property.file.name}">
  <filterchain>
    <tokenfilter>
      <containsstring contains="path=file:"/>
      <replaceregex pattern="path=file:" replace="path=" flags=""/>
    </tokenfilter>
  </filterchain>
</loadproperties> 
```

这应该会导致一个`path`属性被加载，字符串“file:”被剥离。

未经测试，请自告奋勇...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-09-24T13:43:17.597

只是更改属性文件，以便您可以访问完整路径和简单路径，怎么样？

```
path=C:/tmp/templates
fullpath=file:${path} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-04T22:09:34.750

我使用 Ant Contrib 的propertyregex[任务](http://ant-contrib.sourceforge.net/)[来做](http://ant-contrib.sourceforge.net/tasks/tasks/propertyregex.html)类似的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T22:12:29.050

您可能可以使用 ant 的 exec 任务和系统命令。

我很快写了这个来测试这个概念：

```
<target name="foo">
  <property name="my.property" value="file:C:/foo/bar"/>
  <exec executable="/bin/cut" inputstring="${my.property}" outputproperty="new.property">
    <arg line="-d':' -f2-"/>
  </exec>
  <echo message="FOO: ${new.property}"/>
</target> 
```

不幸的是，这仅在您可以使用 /bin/cut 或您可以使用的某种可执行文件在系统上构建时才有效。

# c# - 如何设置行距 Graphics.DrawString

> ID：342254
> 
> 赞同：12
> 
> 时间：2008-12-04T21:59:55.847
> 
> 标签：c#, graphics

我到达时要在 retangle 内的多行上输出一个字符串，但还没有找到减小或扩大行距的方法。怎么做？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-04T22:09:47.090

[这个 MSDN](http://msdn.microsoft.com/en-us/library/xwf9s90b.aspx)应该可以帮助你。行间距是您使用的字体的结果。如果您需要自定义行距，您可能需要将 DrawString 命令拆分为多个调用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T00:32:05.960

此 Microsoft 论坛帖子可能会有所帮助：

[http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=1507414&SiteID=1](http://forums.microsoft.com/MSDN/ShowPost.aspx?PostID=1507414&SiteID=1)

这显示了如何使用 MeasureString 来确定每行可以容纳多少文本，然后使用它逐行逐步渲染整个矩形的内容。不幸的是，我认为没有内置的行距属性，因此您必须采用手动方法。帖子的作者使用字体的高度 * 1.5。

还值得研究 StringFormatFlags - 您需要确保 DrawString 和 MeasureString 调用都使用相同的 StringFormat，以便渲染和测量是一致的：

[http://msdn.microsoft.com/en-us/library/system.drawing.stringformatflags.aspx](http://msdn.microsoft.com/en-us/library/system.drawing.stringformatflags.aspx)

# java - 从 Clojure 调用 Java

> ID：342263
> 
> 赞同：6
> 
> 时间：2008-12-04T22:03:03.843
> 
> 标签：java, clojure, language-interoperability

当我尝试在 Clojure 中运行以下代码（来自 REPL）时：

```
(dotimes [i 5]
  (.start
   (Thread.
    (fn []
      (Thread/sleep (rand 1000))
      (println (format "Finished %d on %s" i (Thread/currentThread))))))) 
```

我收到以下错误：

```
java.lang.Exception: Unable to resolve symbol: i in this context
clojure.lang.Compiler$CompilerException: NO_SOURCE_FILE:6: Unable to resolve symbol: i in this context
        at clojure.lang.Compiler.analyze(Compiler.java:3713) 
```

我在这里做错了什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-04T23:35:31.253

您的代码使用最新的 SVN (1144) 对我有用。

```
user> (dotimes [i 5] (.start (Thread. (fn [] (Thread/sleep (rand 1000)) (println (format "Finished %d on %s" i (Thread/currentThread)))))))

Finished 0 on Thread[Thread-16,5,main]
Finished 4 on Thread[Thread-20,5,main]
Finished 3 on Thread[Thread-19,5,main]
Finished 1 on Thread[Thread-17,5,main]
Finished 2 on Thread[Thread-18,5,main] 
```

您使用的是 9 月 16 日发布的版本吗？您几乎必须使用 SVN 版本的 Clojure。变化太快了

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T00:03:12.713

我认为您的意思是“从 Clojure 调用 Java”。他们仍在[摆弄语法](http://clojure.org/java_interop#toc14)。

# groovy - groovy webtest 在 url 调用中阻塞上下文根

> ID：342264
> 
> 赞同：1
> 
> 时间：2008-12-04T22:03:13.110
> 
> 标签：groovy, webtest, contextroot, canoo

我正试图围绕 canoo webtest

我设置了一个简单的 groovy webtest。我什至制作并运行了等效的 xml，当它尝试对 url 进行编码时，我得到了同样的错误。

使用上下文根时出现错误。当我只使用没有上下文根的 url 时，我没有收到错误。 `ie."http://somesite.com"`

除了有额外的字母之外，还有另一个斜线，但显然愚蠢的字节码解码器可以处理带有 http:// 部分的斜线......为什么不像目录这样简单

我认为 webtest 将能够处理像站点内的目录或上下文根目录这样简单的事情，或者至少能够正确地检测和编码数据。如果您正在编写一个名为“Web”测试的应用程序，那么加载任何类型的 url 都至关重要。

```
invoke(url: "http://somesite.com/CONTEXTRoot", description: "Load dev java site")
verifyTitle("Title to check") 
```

或者

```
<?xml version="1.0" ?>
<!DOCTYPE project SYSTEM "../dtd/Project.dtd">
<project default="test">
    <target name="test">
        <webtest name="check login and welcome page load and work">
            <invoke description="Go to dev site" 
                    url="http://devsite.com/CONTEXTRoot/" />                
            <clickButton label="Enter Application" />
        </webtest>
    </target>
</project> 
```

堆栈跟踪：

```
E:\canoo\WebSiteFunctionalTests\tests\WebSiteWebTest.xml:11: Unexpected exception caught: sun.io.MalformedInputException
at com.canoo.webtest.steps.StepUtil.handleException(StepUtil.java:120)
at com.canoo.webtest.steps.Step.handleException(Step.java:379)
at com.canoo.webtest.steps.Step.execute(Step.java:110)
at org.apache.tools.ant.UnknownElement.execute(UnknownElement.java:288)
    ...
  Caused by: sun.io.MalformedInputException
    at sun.io.ByteToCharUTF8.convert(ByteToCharUTF8.java:262)
    at sun.nio.cs.StreamDecoder$ConverterSD.convertInto(StreamDecoder.java:314)
    at sun.nio.cs.StreamDecoder$ConverterSD.implRead(StreamDecoder.java:364)
    at sun.nio.cs.StreamDecoder.read(StreamDecoder.java:250)
    at java.io.InputStreamReader.read(InputStreamReader.java:212)
    at org.cyberneko.html.HTMLScanner.load(HTMLScanner.java:1166)
    at org.cyberneko.html.HTMLScanner.read(HTMLScanner.java:1127)
    at org.cyberneko.html.HTMLScanner$ContentScanner.scan(HTMLScanner.java:1913)
    at org.cyberneko.html.HTMLScanner.scanDocument(HTMLScanner.java:893)
    at org.cyberneko.html.HTMLConfiguration.parse(HTMLConfiguration.java:495)
    at org.cyberneko.html.HTMLConfiguration.parse(HTMLConfiguration.java:448)
    at org.apache.xerces.parsers.XMLParser.parse(Unknown Source)
    at com.gargoylesoftware.htmlunit.html.HTMLParser$HtmlUnitDOMBuilder.parse(HTMLParser.java:680)
    at com.gargoylesoftware.htmlunit.html.HTMLParser.parse(HTMLParser.java:240)
    at com.gargoylesoftware.htmlunit.DefaultPageCreator.createHtmlPage(DefaultPageCreator.java:127)
    at com.gargoylesoftware.htmlunit.DefaultPageCreator.createPage(DefaultPageCreator.java:101)
    at com.canoo.webtest.engine.Configuration$2.createPage(Configuration.java:655) 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-09T17:19:50.370

当我在我的 jsp 中更改元和页面标记时，我让它在调用上工作

从

```
<%@ page language="java" contentType="text/html; charset=ISO-8859-1" pageEncoding="ISO-8859-1"%>
<META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"> 
```

到

```
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8"> 
```

我提交了一个关于此的 JIRA 错误，因为该错误仅在调用期间发生，而不是在表单提交和链接点击时发生。

# vb.net - 仅在使用 OpenFileDialog 时返回 FileName

> ID：342268
> 
> 赞同：24
> 
> 时间：2008-12-04T22:05:24.137
> 
> 标签：vb.net

我正在使用以下方法浏览文件：

```
 OpenFileDialog.ShowDialog()
    PictureNameTextEdit.Text = OpenFileDialog.FileName 
```

有没有办法只得到文件名？

**FileName**方法返回完整的路径和文件名。

即我想要 Foo.txt 而不是 C:\SomeDirectory\Foo.txt

* * *

## 回答 #1

> 赞同：50
> 
> 时间：2008-12-04T22:07:30.433

用于[`Path.GetFileName(fullPath)`](http://msdn.microsoft.com/en-us/library/system.io.path.getfilename.aspx)仅获取文件名部分，如下所示：

```
OpenFileDialog.ShowDialog()
PictureNameTextEdit.Text = System.IO.Path.GetFileName(OpenFileDialog.FileName) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2012-06-26T01:42:19.590

```
OpenFileDialog.ShowDialog()
PictureNameTextEdit.Text = System.IO.Path.GetFileName(OpenFileDialog.FileName) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2017-05-11T13:51:55.800

在 OpenFileDialog 中获取文件名和完整路径的 C++ 代码：

`textBox1->Text = OpenFileDialog1->FileName; //complete path textBox1->Text = System::IO::Path::GetFileName(OpenFileDialog1->FileName); //filename`

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-07-10T21:26:40.207

假设我确实选择了名为“MyFileName.docx”的 word2010 文件

这仅适用于选定的文件扩展名“包括点标记，fe (.docx)”

```
MsgBox(System.IO.Path.GetExtension(Opendlg.FileName)) 
```

这对于所选的不带扩展名的文件名：（MyFileName）

```
MsgBox(System.IO.Path.GetFileNameWithoutExtension(Opendlg.FileName)) 
```

您可以尝试“PATH 类”的其他选项，例如：GetFullPath、GetDirectoryName ...等等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2017-07-06T18:55:49.147

如果您只想选择没有扩展名的名称，您可以尝试此代码

```
Imports System.IO

PictureNameTextEdit.Text = Path.GetFileNameWithoutExtension(OpenFileDialog1.Fi‌​leName) 
```

谢谢

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-07-16T09:43:49.673

```
//Following code return file name only 

string[] FileFullPath;
string FileName;
objOpenFileDialog.Title = "Select Center Logo";
objOpenFileDialog.ShowDialog();

FileFullPath = objOpenFileDialog.FileNames[0].ToString().Split('\\');
FileName = FileFullPath[FileFullPath.Length - 1]; //return only File Name

//Use following code if u want save other folder , 
// following code save file to CenterLogo  folder which inside bin folder//

System.IO.File.Copy(OFD.FileName, Application.StartupPath + 
"/CenterLogo/" + FileName, true); 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2014-12-13T08:11:54.603

使用 SafeFileName 而不是 FileName，它将返回一个没有路径的名称（和扩展名）。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2015-11-11T14:43:04.973

使用此代码将文件名放入 PictureNameTextEdit：

```
OpenFileDialog.ShowDialog()
PictureNameTextEdit.Text = OpenFileDialog.SafeFileName 
```

# c# - 生成协议缓冲区定义

> ID：342270
> 
> 赞同：2
> 
> 时间：2008-12-04T22:06:38.203
> 
> 标签：c#, .net, protocol-buffers

我有大量专有模式的 XML 文件 - XML 文件定义二进制通信协议（消息结构）。

我想利用 Google 的协议缓冲区技术。

我正在使用现有代码将 XML 文件加载到对象模型中（在内存中）。我想从该对象模型生成一个 .proto 文件。

所以基本上我正在寻找的是代码/库（在 C#/.NET 中），它将 .proto 文件格式表示为对象模型，并且可以将该对象模型保存到 .proto 文件中。

我看了一下 Jon Skeet 的 dotnet-protobufs，我想我明白它的作用（根据 .proto 文件生成 c# 代码）

但是，我不知道我是否可以将它用于我的项目（它可能有 .proto 格式的对象模型，但可能只有代码可以解析这种格式而不是写出来）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T22:34:26.463

我的代码只能序列化和反序列化为二进制和文本。但是，我相信[Marc Gravell 的项目](http://code.google.com/p/protobuf-net/)具有 XML 功能。事实上，我相信他生成 C# 代码的基础是加载 .proto 文件的二进制版本（它本身被编码为 protobuf），将其写为 XML，然后将 XSLT 应用于它......

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-04T23:33:11.913

protobuf-net（我在 .NET 中的协议缓冲区版本）对生成 proto 文件具有*原始*支持，但填补空白并不难。我首先专注于核心引擎，然后是从 proto 生成 C#。编写一个 xslt 从对象模型生成一个原型不会有太大的不同。不过这需要几天时间……（我现在时间有限）。

如果这有用，请告诉我。

对于信息，protobuf-net 引擎与大多数`XmlSerializer`类（和`DataContractSerializer`，和最近`BinaryFormatter`）兼容 - 所以如果您的代码当前作为 xml 工作，我们可能可以让它在 protobuf-net 中工作。没有保证，当然...

# algorithm - 生成摊销时间表

> ID：342281
> 
> 赞同：2
> 
> 时间：2008-12-04T22:10:44.967
> 
> 标签：algorithm, language-agnostic, amortization

我的任务是创建一个可以生成摊销计划的程序。到目前为止，我只做了一点研究，但我需要计算付款、每次付款的利息和每次付款的本金。任何人都可以指出我正确的方向来解决这个问题吗？虽然我将在 RPG 中编写这个，但我相信其他人将来可以使用这个算法。

（更新）好的，那么我如何根据一年 365 天计算？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-04T22:33:34.250

当我最近购买我的第一套房子时，我写了一个 JavaScript 应用程序供我个人使用。

这是我的代码的修改片段，用于确定每月付款：

```
var balance = 200000; // for example
var periods = 360; // 30 years
var monthlyRate = (0.065)/12;  // 0.065= APR of 6.5% as decimal
var monthyPayment = (monthlyRate /(1-(Math.pow((1+monthlyRate),-(periods)))))*balance;

for (var i=0; i<360; i++) {
  var interestForMonth = balance * monthlyRate;
  var principalForMonth = monthlyPayment - interestForMonth;
  balance -= monthlyPayment; // probably should be -= principalForMonth see comments below
  // output as necessary.
} 
```

之后很容易制作摊销表。（正如其他人所提到的，请注意舍入错误，我在实施中没有充分处理这个问题。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-04T22:16:04.643

有很多网站提供这些公式。一个如下： http: [//www.math4finance.com/financial-formulas.php](http://www.math4finance.com/financial-formulas.php)

不需要花哨的算法，因为公式通常很简单。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-05-03T22:28:23.200

C# 中的摊销计划公式

```
 numerator = i * principle * (Math.Pow(1 + i, n));
            denominator = (Math.Pow(1 + i, n) - 1);

            /* Calculation of Amortization Payment Amount  */
            payment = numerator / denominator; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T22:29:23.853

布赖恩是对的。公式很简单。

如果您希望您的解决方案是一个好的解决方案，您将注意舍入误差。如果您只是让舍入误差累积并传播，您可以在计划结束时减少几美分。通过仔细编程，您将最大限度地减少错误。

此外，如果您的计算机上有 MS Excel，您可以从 MS Office 在线下载摊销模板。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-31T20:40:56.893

这是我最终创建的。我已经发布了整个测试程序。它是用 RPG 编写的，但对于任何其他语言都应该很容易理解。

```
 H ActGrp(*caller) BndDir('MODULES') DftActGrp(*no)
   //*********************************************************************
   // Program . . . . . AMORT
   //*********************************************************************
   // Printer/Display Files
 FAMORTDF   CF   E             WORKSTN sfile(SFL01:rrn01)
   //*********************************************************************
   // Named Constants
  /copy modules/qcopysrc,statuscopy

   // Named Indicators
 D indicatorPtr    S               *   Inz(%Addr(*IN))
 D                 DS                  Based(IndicatorPtr)
  /copy modules/qcopysrc,scrncopy

   // Subfile  Fields
 D rrn01           S              4P 0 inz(0)

   //*********************************************************************
   // Misc Fields
 D* Monthly Payment
 D m               S             12P 2        
 D* Principal
 D p               S             12P 2                                      
 D* Interest
 D i               S              5P 3                                      
 D* Length (in Years)
 D l               S              3P 0                                      
 D* Monthly Interest
 D j               S             10P10                                      
 D* # of Months
 D n               S              5P 0                                      
 D* Current Monthly Int.
 D h               S             12P 2                                      
 D* Current Principal
 D c               S             12P 2                                      
 D* New Balance
 D q               S             12P 2                                      

   //*********************************************************************
   // External Program Procedures

   // Internal Subprocedures
 D Init            PR
 D Main            PR
 D SubfileFilled   PR              N
 D ClearScreen     PR
 D IsValidData     PR              N
 D LoanPayment     PR            12P 2
 D  principal                    12P 2
 D  interest                      5P 3
 D  loanPeriod                    3P 0
 D  paymentsYear                  3P 0

   // External Subprocedures
   ///copy modules/qsrvsrc,p.string

   //*********************************************************************
   // Entry Parms
 D AMORT           PR                  extpgm('AMORT')
 D AMORT           PI
   //*********************************************************************
  /free
   Init();
   Main();

   *inlr = *on;
  /end-free

 P*--------------------------------------------------
 P* Procedure name: Init
 P* Purpose:
 P* Returns:
 P*--------------------------------------------------
 P Init            B
 D Init            PI

  /free

   pgm = 'AMORT';
   sflDsp = *off;

   return;

  /end-free
 P Init            E

 P*--------------------------------------------------
 P* Procedure name: Main
 P* Purpose:
 P* Returns:
 P*--------------------------------------------------
 P Main            B
 D Main            PI

  /free

   dow (not F3) and (not F12);

     write OVR01;
     exfmt CTL01;
     ClearScreen();

     if (IsValidData()) and (not F3) and (not F12);

       // Fill the header information
       dPayment = LoanPayment(dLoanAmt:dIntRate:dLoanPrd:dPayYear);
       dNumPaymnt = dLoanPrd * dPayYear;
       m = dPayment + dExtraPay;
       p = dLoanAmt;
       q = p;

       // Fill the table
       if (SubfileFilled());
         sflDsp = *on;
       endif;
     endif;

   enddo;

   return;

  /end-free
 P Main            E

 P*--------------------------------------------------
 P* Procedure name: SubfileFilled
 P* Purpose: Fill the subfile
 P* Returns:
 P*--------------------------------------------------
 P SubfileFilled   B
 D SubfileFilled   PI              N

 D isFilled        S               N
 D x               S              4P 0
 D intCume         S             12P 2
 D extraPayCume    S             12P 2
 D payDate         S               D
 D payment         S             12P 2
 D extraPayment    S             12P 2

  /free

   isFilled = *on;

   sflClear = *on;
   write CTL01;
   sflClear = *off;
   rrn01 = 0;
   x = 0;

   // Setup the work fields
   payment = dPayment;
   extraPayment = dExtraPay;
   payDate = dStartDate;

   // Create records until there is a zero balance
   dow (q > 0);

     x += 1;
     eval(h) h = p * j; // Monthly Interest

     // Adjust for final payment
     if (p < m);
       m = p + h;
       payment = p;
       extraPayment = h;
     endif;

     // Calulate Principal
     c = m - h;
     // Calulate the new balance
     q = p - c;

     // Accumulate the interest and extra payments
     intCume += h;
     extraPayCume += extraPayment;

     // Determine the next pay date
     select;
       when dTerms = '1'; //Yearly
         payDate += %years(1);
       when dTerms = '2'; //Semi-Annual
         payDate += %months(6);
       when dTerms = '3'; //Quarterly
         payDate += %months(3);
       when dTerms = '4'; //Monthly
         payDate += %months(1);
       when dTerms = '5'; //Bi-Weekly
         payDate += %days(14);
     endsl;

     // Fill the subfile
     sPayNum = x;
     sPayDate = payDate;
     sBegBal = p;
     sSchedPay = payment;
     sExtraPay = extraPayment;
     sTotPay = m;
     sInterest = h;
     sPrincipal = c;
     sEndBal = q;
     sCumeInt = intCume;

     // Move the End balance to the beginning balance
     p = q;

     rrn01 += 1;
     write SFL01;

   enddo;

   // Return the calculated information to the header
   dActPaymnt = x;
   dTotInt = intCume;
   dTotEPay = extraPayCume;

   if (rrn01 < 1);
     isFilled = *off;
   endif;

   return isFilled;

  /end-free
 P SubfileFilled   E

 P*--------------------------------------------------
 P* Procedure name: ClearScreen
 P* Purpose:
 P* Returns:
 P*--------------------------------------------------
 P ClearScreen     B
 D ClearScreen     PI

  /free

   c = 0;
   h = 0;
   i = 0;
   j = 0;
   l = 0;
   m = 0;
   n = 0;
   p = 0;
   q = 0;
   dPayment = 0;
   dNumPaymnt = 0;
   dActPaymnt = 0;
   dTotEPay = 0;
   dTotInt = 0;

   return;

  /end-free
 P ClearScreen     E

 P*--------------------------------------------------
 P* Procedure name: IsValidData
 P* Purpose: Validate the data on the screen
 P* Returns: True or False
 P*--------------------------------------------------
 P IsValidData     B
 D IsValidData     PI              N

 D isValid         S               N

  /free

   if (dLoanAmt <> 0) and (dIntRate <> 0) and (dLoanPrd <> 0) and
      (dPayYear <> 0) and (dStartDate <> %date('0001-01-01'));
     isValid = *on;
   else;
     isValid = *off;
   endif;

   return isValid;

  /end-free
 P IsValidData     E

 P*--------------------------------------------------
 P* Procedure name: LoanPayment
 P* Purpose: Calculates the payment
 P* Returns:
 P*--------------------------------------------------
 P LoanPayment     B
 D LoanPayment     PI            12P 2
 D  principal                    12P 2
 D  interest                      5P 3
 D  loanPeriod                    3P 0
 D  paymentsYear                  3P 0

 D retMonthlyPayment...
 D                 S             12P 2

  /free

   eval(h) n = loanPeriod * paymentsYear;
   eval(h) j = interest / (paymentsYear * 100);

   eval(h) m = principal * (j / (1 - (1 + j) ** -n));

   return m;

  /end-free
 P LoanPayment     E 
```

此代码已针对我们的贷款计算器进行了测试。如果 test vs. Excel，200,000 美元的贷款减少了大约 32 美分。我相信这对四舍五入的问题是有用的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2015-02-20T04:26:32.897

```
var annuity =  P * (i + i / (Math.pow(1+i,n) -1));

//P: principal, I: periodic interest rate, N: number of periods 
```

# xml - 将 SQL 2005 中的 XML 数据类型转换为关系结果集

> ID：342285
> 
> 赞同：2
> 
> 时间：2008-12-04T22:11:36.197
> 
> 标签：xml, sql-server-2005, types

我在 SQL 2005 数据库中有一个表，其中包含定义为 xml 数据类型的列。我正在尝试编写查询 xml 并从 select 语句返回结果集的存储过程。我已经看到了返回标量值或 xml 的示例，但没有看到如何返回结果集。

我将不得不使用 openxml 还是有其他解决方案？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T22:22:13.120

xml 数据类型有自己的一组方法，您可以使用这些方法来处理列中的数据。在这种情况下，你可能会使用这样的东西：

```
select xmlColumnName.value('XpathExpression', 'outputSqlType') from dataTable 
```

例如，

```
select xmlColumnName.value('/root/node[@name="myname"]', 'varchar(60)') 
```

这些方法是 query()、value()、exist()、modify() 和 nodes()，您可以在 Books Online 中阅读更多关于它们的信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T22:32:35.127

您可以使用 xml 数据类型或 OPENXML。另一个海报给出了一个 xml 数据类型的例子，所以这里是一个 OPENXML 例子。

它确实取决于 XML 模式。SQL Server 可能不太喜欢您的架构。如果您对架构有任何控制权，那么它会有所帮助。您最终可能不得不使用表变量并通过多次调用 OPENXML 来构建数据来查询所有内容。

例如，可以按如下方式处理 XML 输入：

```
DECLARE @idoc int
DECLARE @doc nvarchar(max)

SET @doc = '
<xml>
    <Entry Type="Error" Start="2008-11-19 02:16:00" End="2008-11-20 04:55:00" />
    <Entry Type="Success" Start="2008-11-25 12:45:00" End="2008-11-25 13:01:00" />
</xml>'

EXEC sp_xml_preparedocument @idoc OUTPUT, @xml

SELECT   [EventType]
        ,[EventStart]
        ,[EventEnd]
FROM    OPENXML (@idoc, '//Event',1)
        WITH    ([Type]         varchar(30)
                ,[Start]        varchar(30)
                ,[End]          varchar(30)
) 
```

我面临的挑战之一是解析 XML 日期（带有“T”和可能时区的 ISO8601）。我最终用一行代码创建了一个 .NET 程序集，将其转换为 SQL 喜欢的日期时间。

# sql - 用于检测 java jdbc 代码中的非参数化 sql 的工具

> ID：342290
> 
> 赞同：1
> 
> 时间：2008-12-04T22:12:45.370
> 
> 标签：sql, jdbc, refactoring, p6spy, parameterization

我希望检查 Java/jdbc 代码中的 SQL 语句，以确保要执行的 SQL 具有可接受的质量。PMD 和 Findbugs 似乎都没有 JDBC 或 sql 规则。我可以使用 p6spy 记录 SQL 并以这种方式查看，但这是手动的。

我想知道使用 PMD/Findbugs/etc 的策略是否创建一个规则，即任何传递给 PreparedStatement 的有“=”或“in”的字符串在比较端只有参数化的变量。

有人做过吗？还是通过其他方式做到这一点？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T22:24:29.587

这是一个棘手的问题。比较运算符喜欢`=`和`IN()`是一些情况，但也有： `!= <> < <= > >= LIKE`。

您如何发现在表达式中将应用程序变量插入为文字的情况？

```
String sql = "SELECT *, " + someJavaVar + " AS constant_column FROM mytable"; 
```

您可以搜索包含字符串分隔符的 SQL，但 SQL 注入不仅仅来自插入字符串文字。

您如何发现将应用程序变量内插为数据值以外的事物的情况？

```
String sql = "SELECT * FROM mytable ORDER BY " + columnname; 
```

我不知道任何自动检测 SQL 注入缺陷的方法。代码审查是发现它们的更有效方法。在每个包含插值应用程序变量的 SQL 语句中，您必须确认应用程序变量是“安全的”，并且您的应用程序已明确验证它们或对其进行转换，以便它们不包含危险的有效负载。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-06-04T13:39:06.153

您是否有能力使用连接的调试器对应用程序进行全面测试？

在您的 JDBC 驱动程序的 Connection.createStatement() 实现中设置断点，然后运行应用程序...（或者如果使用您没有源代码的驱动程序，请编写一个仅将调用委托给真实驱动程序的假驱动程序, 并记录 createStatement()) 的所有实例

# sql-server - 每月 SQL Server 存储过程进程的“重新编译”有什么缺点吗？

> ID：342293
> 
> 赞同：2
> 
> 时间：2008-12-04T22:13:33.057
> 
> 标签：sql-server, sql-server-2005, stored-procedures

我认为这个问题说明了一切。我在存储过程中有几个月度进程，需要一分钟到一小时不等。如果我声明它们`WITH RECOMPILE`，每次都会生成一个执行计划。

如果 DBA 更改了基础索引或统计信息或视图，我不希望任何人都必须进入并使用 ALTER 或其他方式强制重新编译 SP。

这有什么缺点吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T22:17:49.103

在这种情况下，这将是完全无害的，而且可能是个好主意。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T22:22:56.487

据我了解，如果需要，应该自动重新编译 SP。因此，您对潜在变化的关注并不重要。

但是，服务器会尝试缓存已编译的 SP 计划。Using`WITH RECOMPILE`将释放用于缓存已编译过程的内存（至少直到下一次缓存被清除）。由于它们仅每月运行一次，这似乎是个好主意。

此外，由于其他原因，您可能希望查看这篇文章以使用该指令：
[https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-5662581。 html](https://web.archive.org/web/1/http://articles.techrepublic%2ecom%2ecom/5100-10878_11-5662581.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-04T22:34:01.363

如果每个存储过程每个月只运行一次，那么编译过的过程不太可能仍然在过程缓存中。实际上它无论如何都会重新编译。

即使您在报告日运行相同的存储过程 100 次，每次编译也只需要 0-2 秒（取决于存储过程的复杂性），因此开销并不大。在这些存储过程上设置 WITH RECOMPILE 我会感觉很舒服。

# performance - JSP Struts 性能/内存技巧

> ID：342311
> 
> 赞同：1
> 
> 时间：2008-12-04T22:20:00.907
> 
> 标签：performance, jsp, jakarta-ee, struts

我正在开发一个基于 Struts 的基本应用程序，该应用程序在内存中会出现重大峰值。我们有一个监控工具，它会注意到每个用户的一个请求会增加 3MB 到 JVM 堆内存。是否有任何提示可以鼓励早期进行垃圾收集、释放内存或提高性能？

该应用程序是一个基本的 Struts 应用程序，但 JSP 报告中有很多行，因此可能创建了很多对象。但它不是你以前没见过的东西。

1.  执行一组数据库查询。
2.  创建一个序列化的 POJO 对象 bean。这代表一行。
3.  在数组列表中添加一行。
4.  调用操作时，将数组列表设置为表单对象。
5.  JSP 逻辑将从 ActionForm 遍历列表并将数据显示给用户。

注意：
1\. 表单在会话范围内，可能是数据数组列表（也许这是一个问题）。
2\. POJO bean 包含 20 个左右的字段，`String`或`BigDecimal`数据的混合。

报告可以有 300 到 1200 左右的行。因此，至少创建了那么多对象。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T22:37:19.093

鉴于您提供的信息，我估计您通常会为结果加载 1 到 2 兆字节的数据：750 行 * 20 个字段 * 每个字段 100 个字节 = 1.4 Mb。现在考虑数据库和最终标记之间所需的所有临时对象。3 Mb 不足为奇。

我只会担心那个内存似乎已经泄漏了。即，年轻代空间的下一次垃圾收集不会收集所有这些对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-26T04:18:48.703

1.  项目清单

在设计要在 Web 应用程序中呈现的报告时，请考虑从数据库中获取的记录数。

如果记录数较多且整个记录集占用大量内存，则考虑使用报表分页。

尽可能不要显式调用垃圾收集器。之所以如此，是因为两个原因：

1.  垃圾收集是一个代价高昂的过程，因为它会扫描整个内存。

2.  大多数生产服务器将在 JVM 级别进行调整，以避免显式垃圾收集

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-27T15:27:39.573

我认为问题在于 ActionForm 中的数组列表需要分配大量内存空间。我会将查询结果直接写入响应：从结果集中读取行，写入响应，读取下一行，写入等。也许它不是 MVC，但它对你的堆会更好:-)

ActionForms 对于 CRUD 操作很好，但对于报告......我不这么认为。

注意：如果 ActionForm 的 scope=session 实例将是活动的（与巨大的数组列表一起），直到会话过期。如果 scope=request 实例将可用于 GC。

# c# - C# 版本的 optparse？

> ID：342318
> 
> 赞同：6
> 
> 时间：2008-12-04T22:22:22.197
> 
> 标签：c#, command-line

[在某些OSI 批准的许可](http://www.opensource.org/licenses/alphabetical)下，是否有来自 Python的[optparse（命令行选项解析器）](http://www.python.org/doc/2.5.2/lib/module-optparse.html)模块的 C# 端口？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T22:38:52.087

你已经看过[http://cshapoptparse.sourceforge.net/](http://csharpoptparse.sourceforge.net/)了吗？我没有阅读许可，但由于它在 sourceforge 上，我猜它是 OSI 批准的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-04-29T20:48:27.847

CSharpOptParse 主页说它是 Perl 的 GetOpt 的一个端口，而不是 Python 的 optparse 的一个端口。无论如何，我看起来很糟糕，取消原来的 optparse ：/

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-07-29T23:05:15.843

[在https://github.com/charlescook/noptfunc](https://github.com/charlescook/noptfunc)检查 NOptFunc

作者在开始时在这里写了博客。 [http://cookcomputing.com/blog/archives/000599.html](http://cookcomputing.com/blog/archives/000599.html)

# c# - 根据应用选择的控件启用/禁用按钮

> ID：342320
> 
> 赞同：1
> 
> 时间：2008-12-04T22:24:16.250
> 
> 标签：c#, winforms

我有一个非常复杂的 .NET 应用程序，其中包含剪切/复制/粘贴功能。我想根据所选控件/内容启用/禁用剪切/复制/粘贴按钮。该应用程序有许多用户控件。实现这一目标的最佳方法是什么？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T22:38:41.727

您是在谈论捕获控件的焦点还是在其中执行此操作的设计模式？

我可能会使用它所依赖的控件注册每个要启用/禁用的控件。然后，当依赖控件被选中/聚焦时，旋转控件并启用/禁用每个控件。这几乎就是[观察者模式](http://en.wikipedia.org/wiki/Observer_pattern)。

例如：

在 OnInit 中：

```
selectedControl1.AddObserver(button1);
selectedControl1.AddObserver(button2);
selectedControl1.AddObserver(textBox1);

selectedControl2.AddObserver(button1);
selectedControl2.AddObserver(textbox3); 
```

在 OnFocused 中：

```
foreach(Control ctl in selectedControl1.Observers)
{
  ctl.Enabled = true;
} 
```

那样的东西...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T22:41:44.297

看看使用标签和 LINQ

您可以使用标记对象来保存信息，然后使用 LINQ 查询该表单/应用程序的控件。根据您的结果，您可以根据需要设置属性。这可能是比观察者模型更好的方法，因为如果不对其进行管理，它可能会导致内存泄漏和性能下降。

只是一个建议。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T22:43:11.563

一种方法：创建一个[ExtenderProvider](http://msdn.microsoft.com/en-us/library/f6b055wc(VS.71).aspx)以将属性 Cut、Copy 和 Paste 添加到每个控件。为每个控件的 GotFocus 事件添加一个委托，并根据扩展属性值启用/禁用委托中的每个按钮。

另一种方法：使用 Form_Load 中的递归函数将 GotFocus 事件的委托添加到表单中的每个控件，并根据控件类型启用/禁用每个按钮。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T14:25:56.260

Create an Interface IControlMyForm

Add a method called DisableCutCopyPaste

Add a method called EnableCutCopyPaste

Have the form implement the Interface.

Create a UI_Controller class

Create a property of type IControlMyForm

Create a disable and a enable method for the Cut Copy Paste button

On startup creat an instance of UI_Controller

On startup have the Form set itself to the property.

Using the OnFocus event (or Click, etc) of the various control have a call to the right method of the UI_Controller Class.

This is overkill if all you are doing is enabling and disabling cut copy and paste. But if your form is that complex then you would be better off defining a interface and putting some of the more complex interactions (whatever they are) in a UI_Controller class. This way you clearly see what doing what. Also refactoring your form becomes a lot easier.

If you feel this is overkill then just create a EnableCutCopyPaste routine and a DisableCutCopyPaste routine and place the calls in the OnFocus event (or Click, etc).

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-04T22:32:52.597

一种方法：

为您希望监视的每个控件添加一个代理到适当的事件。

例如： `textBox.GotFocus += myFunctionalityEnabler;`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-04T23:34:58.340

您可以在复制/粘贴按钮的 OnClick 事件中检查 Form.ActiveControl 属性。

您可以在 Tag 字段中放置一个可以检查的标志，或者您可以只检查它是 TextBox 还是您所做的任何事情。

这将允许您在选择错误控件时使按钮不执行任何操作。如果您想实际禁用按钮，您可以执行相同的检查，但在窗体的 MouseDown/KeyPress 事件中或在每个控件上为 GotFocus/LostFocus 设置事件处理程序。

如果您想要检查控件是否是 TextBox 或类似的东西，并且您有很多控件并且您不想手动在每个控件上设置处理程序，您可以在 Form.Controls 上的 foreach 中添加处理程序在 FormLoad 事件中。

# c# - 为什么在 Postback 后复制 innerHTML 时要插入逗号？

> ID：342325
> 
> 赞同：4
> 
> 时间：2008-12-04T22:26:27.947
> 
> 标签：c#, asp.net, javascript

这个案子听起来很复杂，但也没有那么糟糕。这段代码末尾的 javascript*似乎*是正确的。

编辑：这是在实时服务器上运行的页面。第一个示例没有在打开和关闭之间交替，因为我删除了很多代码以尽可能地缩小示例范围。

[http://69.64.80.239/tmp/borked2.aspx](http://69.64.80.239/tmp/borked2.aspx)

以下客户端代码中列出了两种情况。第一种情况在单击图像按钮时回传，并使用图像按钮的 clientid 作为参数添加对大型 javascript 函数的调用。

第二种情况只是使用 onClientClick，并在没有回发的情况下执行 javascript。

这两种方法都完成了应该出现的文本框的显示和隐藏。但是，使用回发方法，每次来回时都会插入逗号 - 首先是 1，然后是 3，然后是 7，然后是 7，然后是 15，然后是 31。这种奇怪的行为不会发生在案例 #2 中，这让我相信这种情况下的 javascript是健全的。

当回发发生时，我的文本框中会出现一个以前不存在的 'value=","' 属性。越来越多的逗号适合新添加的属性。

为了有效地突出问题，本案被极度精简。最终，这导致了一个详细信息视图，我正在执行相同的副本以在它提交的每个表单值的开头添加一个逗号。

我完全被难住了，所以我只是尽可能地发布代码！任何想法，将不胜感激！

```
<h5>CASE 1: Using Serverside postback to insert Javascript into a Literal</h5>
<table><tr><td>

    <asp:ImageButton id="CollapseExpand" runat="server" ImageUrl="/images/plus.gif" src="/images/plus.gif"
        AlternateText="Hide Tasks" Width="12" Height="12"  onclick="CollapseExpand_Click"
        />

     <div style="display:none">
     <asp:TextBox runat="server" ID="Textbox1"></asp:TextBox>
     <asp:Button runat="server" ID="btnSubmit1" Text="Submit 1" />
     </div>

    <asp:Literal runat="server" ID="ScriptAnchorTest"></asp:Literal>     

</td></tr></table> 
```

案例 1 代码隐藏

```
protected void CollapseExpand_Click(object sender, ImageClickEventArgs e)
{

    Literal l = (Literal)this.ScriptAnchorTest;
    l.Text = "<script type=\"text/javascript\">Expand(document.getElementById('" + this.CollapseExpand.ClientID + "'));</script>";

} 
```

案例2：直接执行Javascript客户端

```
 <asp:ImageButton id="CollapseExpand2" runat="server" src="/images/plus.gif" 
        AlternateText="Hide Tasks" Width="12" Height="12"  onClientClick="Expand(this); return false;"
        />

     <div style="display:none">
     <asp:TextBox runat="server" ID="TextBox2"></asp:TextBox>
     <asp:Button runat="server" ID="btnSubmit2" Text="Submit 2" />
     </div>

</td></tr></table> 
```

// Javascript Function function Expand(image, index) { // 获取图片的来源 var src = image.getAttribute("src");

```
 // if src is currently "plus.", then toggle it to "minus.png"    
    if (src.indexOf("plus") > 0) {

        //  toggle the  image
        image.src = image.src.replace("plus", "minus");

        var tr = image.parentNode.parentNode;
        // Get a reference to the next row from where the image is
        var next_tr = tr.nextSibling;

        // Get a refernece to the <tbody> tag of the grid
        var tbody = tr.parentNode;

        // Get a reference to the image's column
        var td = image.parentNode;
        var detailnode

        //loop through the content of the image's column. if hidden div is found, get a reference
        for (var j = 0; j < td.childNodes.length; j++) {
            if (td.childNodes[j].nodeType == 1) {
                if (td.childNodes[j].nodeName.toLowerCase() == 'div') {
                    detailnode = td.childNodes[j].cloneNode(true);
                }
            }
        }

        // Create a new table row for "Expand"  
        var newtr = document.createElement('tr');
        var newtd = document.createElement('td');
        var newfirsttd = newtd.cloneNode(true);

        /* insert an empty cell first */
        newtr.appendChild(newfirsttd);
        newtd.colSpan = 8;

        // insert the  hidden div's content  into the new row
        newtd.innerHTML = detailnode.innerHTML;

        newtr.appendChild(newtd);
        tbody.insertBefore(newtr, next_tr);

        tr.className = "selected";
    }

    else {
        image.src = src.replace("minus", "plus");
        var row = image.parentNode.parentNode;
        var rowsibling = row.nextSibling;
        var rowparent = row.parentNode;
        rowparent.removeChild(rowsibling);
    } 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T08:00:58.787

我没有时间阅读您的整个代码，但请注意以下几点：您可能正在复制 HTML 块并在您的代码中创建它的克隆。这样，您实际上得到了两个具有相同 ID 的文本框，尽管您只看到其中一个。在回发时，浏览器将值连接为逗号分隔的列表。例如，如果您分别在文本框中输入“Test1”和“Test2”，然后提交，则两个文本框的值都会加倍。现在，如果您只扩展其中一个（假设是第一个）并提交，则只有扩展后的会再次翻倍，而未扩展的则在回发时保持不变。

对于解决方案，如果您只需要显示或隐藏一个 div，最好的方法是从 javascript、客户端通过更改该 div 的样式（可见性）而不是克隆它来完成。这样，您的功能可以减少到一行代码。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-05T14:36:06.413

Sergiu 是对的，您正在创建两个具有相同 ID“Textbox1”的 html 输入，正如您在使用 Firebug 捕获的屏幕截图中看到的那样

[![堆栈溢出答案](https://farm4.static.flickr.com/3150/3084894874_29bdbe62a6.jpg)](http://www.flickr.com/photos/eduardo-molteni/3084894874/ "Stackoverflow Answer por edddy, en Flickr")

这最终连接了用逗号分隔的两个值。

# asp.net - ASP.NET：如何更改每行使用的 itemTemplate ?

> ID：342330
> 
> 赞同：4
> 
> 时间：2008-12-04T22:29:49.437
> 
> 标签：asp.net

*现有*代码正在使用`asp:repeater`来构建 HTML 表格。（强调现有设计）。这是生成表格的部分伪代码：

```
<asp:repeater OnItemDataBound="ItemDataBound" ... >

   <headertemplate>
      <table>
         <thead>
            <tr>
               <td>Date</td>
               <td>Type</td>
               <td>Action</td>
            </tr>
         </thread>
   </headertemplate>

   <itemtemplate>
      <tr>
         <td><%# GetTextForThis((MyItem)Container.DataItem) %></td>
         <td><%# GetTextForThat((MyItem)Container.DataItem) %></td>
         <td><%# GetTextForTheOther((MyItem)Container.DataItem) %></td>
      </tr>
   </itemtemplate>

   <footertemplate>
         </tbody>
      </table>
   </footertemplate>

</asp:repeater> 
```

但是现在需要（某些）项目以不同的方式显示，并且需要使用 a 来完成`COLSPAN=3`，并且整个项目将是一个单元格：

```
 <itemtemplate>
      <tr>
         <td colspan="3">
            <img src="<%# GetImageSrcForFoo((MyItem)Container.DataItem) %>
            <a href="<%# GetHrefForFoo((MyItem)Container.DataItem) %>
         </td>
      </tr>
   </itemtemplate> 
```

鉴于：

*   页面使用转发器构建 HTML 表格
*   该设计需要一些表格行来跨越列

我怎样才能做到这一点？

我**希望**得到类似的东西：

```
 <itemtemplate id="thisThatTheOtherItemTemplate">
      <tr>
         <td><%# GetTextForThis((MyItem)Container.DataItem) %></td>
         <td><%# GetTextForThat((MyItem)Container.DataItem) %></td>
         <td><%# GetTextForTheOther((MyItem)Container.DataItem) %></td>
      </tr>
   </itemtemplate>

   <itemtemplate id="fooItemTemplate">
      <tr>
         <td colspan="3">
            <img src="<%# GetImageSrcForFoo((MyItem)Container.DataItem) %>
            <a href="<%# GetHrefForFoo((MyItem)Container.DataItem) %>
         </td>
      </tr>
   </itemtemplate> 
```

并且神奇地能够让 OnDataBind 事件告诉转发器使用哪个模板。这可能吗？

## 回答

虽然这两个答案都是正确和好的，但我宁愿使用第一个建议；这涉及在 aspx 文件中显示代码，而不是在代码隐藏中手动构建 HTML。（我不想再次在代码中构建 HTML）

```
 <itemtemplate>
      <asp:PlaceHolder ID="thing1" runat="server">
         <tr>
            <td><%# GetTextForThis((MyItem)Container.DataItem) %></td>
            <td><%# GetTextForThat((MyItem)Container.DataItem) %></td>
            <td><%# GetTextForTheOther((MyItem)Container.DataItem) %></td>
         </tr>
      </asp:PlaceHolder>

      <asp:PlaceHolder ID="thing2" visible="false" runat="server">
         <tr>
            <td colspan="3">
               <img src="<%# GetImageSrcForFoo((MyItem)Container.DataItem) %>
               <a href="<%# GetHrefForFoo((MyItem)Container.DataItem) %>
            </td>
         </tr>
   </itemtemplate> 
```

在代码隐藏中：

```
protected void myRepeater_ItemDataBound(object sender, RepeaterItemEventArgs e)
{
   // if the data bound item is an item or alternating item (not the header etc)
   if (e.Item.ItemType == ListItemType.Item || e.Item.ItemType == ListItemType.AlternatingItem)
   {
      // get the associated object
      Object item = .Item.DataItem;
      if (item == null)
         return;

      Control thing1 = e.Item.FindControl("thing1");
      Control thing2 = e.Item.FindControl("thing2");

      if (item is MyClassThatICreated)
      {
         thing1.Visible = false;
         thing2.Visible = true;
      }
      else
      {
         thing1.Visible = true;
         thing2.Visible = false;
      }
      ...
} 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-04T22:34:31.720

在项目模板中放置两个 ASP:Placeholder 控件。在代码隐藏中，在 ItemDataBound 事件上，确定要显示的样式，并隐藏一个占位符。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T00:44:12.550

Jonathan 建议的替代方案是在 ItemDataBound 事件中在后端动态构建项目，有些人发现这更容易使用，而不是切换可见性。

在这种情况下，我个人只会在 mode="Passthrough" 中输入一个文字，并将其构建在后端。

# assembly - 装配资源

> ID：342332
> 
> 赞同：0
> 
> 时间：2008-12-04T22:30:13.367
> 
> 标签：assembly

您能否为有关 Windows 的 C/C++ 嵌入式程序集的良好资源（书籍、在线教程）提供一些指导？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T22:39:25.393

我相信您要问的是内联汇编程序，而不是嵌入式。您可以在 C/C++ 中使用 __asm 关键字包含内联汇编代码。有关一些信息，请参阅[MSDN 内联汇编器文章](http://msdn.microsoft.com/en-us/library/4ks26t93(VS.80).aspx)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T00:34:15.567

这是最好的 win32 组装网站之一：[http ://win32assembly.online.fr/](http://win32assembly.online.fr/)

# ruby-on-rails - "class << anObject" 和 anObject.class_eval 的区别

> ID：342333
> 
> 赞同：0
> 
> 时间：2008-12-04T22:30:45.207
> 
> 标签：ruby-on-rails, ruby, metaprogramming

我在 attribute_fu 插件中看到以下代码：

```
module AttributeFu
    module Associations #:nodoc:                                                                                                                                                
        def self.included(base) #:nodoc:                                                                                                                                          
            base.class_eval do
                extend ClassMethods
                class << self; alias_method_chain :has_many, :association_option; end

                class_inheritable_accessor  :managed_association_attributes
                write_inheritable_attribute :managed_association_attributes, []

                after_update :save_managed_associations
            end
        end

        ...
    end
end 
```

当我尝试更换

```
class << self; alias_method_chain :has_many, :association_option; end 
```

与：别名方法链：has_many，：association_option？

我收到以下错误

```
/usr/lib/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/core_ext/module/aliasing.rb:31:in `alias_method': undefined method `has_many' for class `ActiveRecord::Base' (NameError)
        from /usr/lib/ruby/gems/1.8/gems/activesupport-2.1.1/lib/active_support/core_ext/module/aliasing.rb:31:in `alias_method_chain'
        from /home/twong/git/physpace/vendor/plugins/attribute_fu/lib/attribute_fu/associations.rb:9:in `included' 
```

我认为这两行会做同样的事情，但看起来我错了。有人可以解释我的错误吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T19:27:03.127

```
# init.rb
ActiveRecord::Base.class_eval { include AttributeFu::Associations }

module AttributeFu
    module Associations
        def self.included(base)
            # base == ActiveRecord::Base (the class)
            base.class_eval do
                # class_eval makes self == ActiveRecord::Base, and makes def define instance methods.
                extend ClassMethods

                # If has_many were an instance method, we could do this
                #   alias_method_chain :has_many, :association_option; end
                # but it's a class method, so we have to do the alias_method_chain on
                # the meta-class for ActiveRecord::Base, which is what class << self does.
                class << self; alias_method_chain :has_many, :association_option; end
            end
        end
    end
end 
```

另一种解决方法是将其放入 IRB：

```
class A ; end
A.class_eval { puts self.inspect ; class << self ; puts self.inspect ; end } 
```

也可以看看

*   [类中的 class_eval 与 instance_eval](http://briancarper.net/2007/06/19/class_eval-vs-instance_eval-in-classes/)
*   [instance_eval 方法](http://www.ruby-doc.org/core/classes/Object.html#M000336)
*   [class_eval 方法](http://www.ruby-doc.org/core/classes/Module.html#M001673)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T22:34:22.283

在那种情况下，`self`并不意味着 anObject，它更像是一个糖构造。

```
class << self
  ...
end 
```

定义封闭对象的类方法。方法`alias_method_chain`是一种方法，即给事物起别名。在这种情况下，它别名`has_many`为`has_many_without_association_options`和`has_many_with_association_options`with `has_many`。在您的情况下，它是类方法的别名，因此，您必须在类方法范围内使用它。它允许扩展方法而没有太多麻烦。

类方法被称为，比如：

```
SomeThing.bar_method 
```

而实例方法在类的实例上调用：

```
assoc = SomeThing.new
assoc.foo_method 
```

相应的代码是：

```
class SomeThing
  def foo_method
    ...
  end
  class << self
    def bar_method
      ...
    end
  end
end 
```

在你的情况下，你有模块`AttributeFu::Associations`。当包含在类 Foo 中时，它运行 Foo.class_eval，它在 Foo 中定义了一些实例属性，并`alias_method_chain`在类方法范围 ( `class << self`) 内启动一个方法。

还有一个`extends ClassMethods`必须定义：

```
def self.has_many_with_association_options
    ...
end 
```

或者

```
class << self
  def has_many_with_association_options
    ...
  end
end 
```

# javascript - Javascript 文件中的相对图像 URL - ASP.net MVC 和 IIS 7

> ID：342364
> 
> 赞同：4
> 
> 时间：2008-12-04T22:44:28.957
> 
> 标签：javascript, asp.net-mvc, iis-7

我正在开发一个 Asp.net mvc 应用程序，在 ASP.net 开发服务器中一切正常，但是当我尝试在 IIS 7 上托管它时。我遇到了与 URL 解析相关的问题。我在 Javascript 中使用了相对路径来提供图像。脚本文件位于 ~/Scripts/ 文件夹中，图像文件位于 ~/Content/images/ 文件夹中。现在在 javascript 文件中，我试图通过给出像 http://localhost/WebApp1/controller1/action1/ 这样的相对路径来使用给定，它试图在[http://localhost/controller1/action1/](http://localhost/controller1/action1/)找到它并且不能；t找到文件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T00:22:00.693

如果我的阅读方式是正确的，那么您现在正在从 IIS7 的域根目录运行 WebApp，而不是从您的开发环境中运行 WebApp1？

所以，如果我的假设是正确的，那么***~/***现在应该解析为***[http://localhost/](http://localhost/)***而不是***[http://localhost/WebApp1/](http://localhost/WebApp1/)***

如果这一切仍然正确，那么您的文件夹结构已经与绝对路径中的 ~/scripts 文件夹一起上移了一级：

[http://localhost/脚本/](http://localhost/Scripts/)

和您的图像文件夹为：

[http://localhost/内容/图像/](http://localhost/Content/Images/)

为了从脚本中访问图像，您可以使用多种方法。最简单的是使用脚本目录中的相对路径：*“../Content/Images/MyImage.jpg”*

或者您可以使用 document.location.host 在 javascript 中构建完全限定的路径名​​：*document.location.host + "/Content/Images/MyImage.jpg"*

另一种方法是让 ASP.NET 动态构建这部分脚本，以便注入完全限定的路径名​​。您可以使用*ScriptManager.RegisterStartupScript*或*ScriptManager.RegisterScriptBlock*

真的有很多方法可以给这只猫剥皮，它们只是我能想到的前 3 种。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T22:54:21.587

尝试：

<a href="~/controller1/action1/" id="testLnk" runat="server">

runat 属性应确保框架解析它。您还可以使用 ResolveUrl 方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-02-16T16:54:54.613

我遇到了同样的问题，并找到了 David Banister 的元素解决方案。问题在于 MVC 控制器的 index 操作以（www.mysite.com/viewName，而不是 www.mysite.com/viewName/index）的形式返回一个 URL，Web 浏览器稍后在尝试引用 css 时会失败或使用相对路径语法 (../../) 的 js 文件。

他的解决方案对我很有效。希望这可以帮助某人。祝你好运。

[http://blog.davidbanister.com/2010/09/28/mvc-fixes-relative-path-issues-in-asp-net-mvc-2/](http://blog.davidbanister.com/2010/09/28/mvc-fixes-relative-path-issues-in-asp-net-mvc-2/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-04T18:25:22.720

我过去遇到过这个问题，请尝试使用波浪号

> ~/controller1/action1/

# language-agnostic - 编码指南应该做什么，有什么好的指南例子吗？

> ID：342365
> 
> 赞同：8
> 
> 时间：2008-12-04T22:45:43.633
> 
> 标签：language-agnostic, user-interface, coding-style

有哪些编码指南的好例子。我并不是真的在寻找任何特定于单一语言的东西。

但是，当我编写编码指南时，我应该做什么/评估什么？例如指南应该有多灵活，以及应该将多少决定留给程序员或其他人，甚至由指南预先决定。

我正在研究的这套指南应该涵盖广泛的主题：评论、数据库设计，甚至一些用户界面指南。

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2008-12-05T02:01:40.400

编码标准一般有三个目的：

*   减少错误的可能性
*   减少分析其他人编写的代码所需的时间
*   给某人一次动力之旅

显然，第三个是浪费其他人的时间，但你确实需要考虑它，特别是这样你*就不会*走那条路。

话虽如此，我注意到了一些明确的注意事项：

*   强制使用一致的空格。制表符、2 个空格、4 个空格都没有关系。保持一致，这样缩进级别就不会被使用不同编辑器的人搞砸。我见过由于维护程序员误解了代码块的嵌套级别而犯的错误。
*   执行一致的日志记录方法。如果支持人员不能浏览日志，这会极大地浪费他们的时间，因为每个人的模块日志都有不同的原因，每个人对信息、警告和错误的定义也不同。
*   强制执行一致的错误处理。如果模块 A 抛出异常，模块 B 返回错误代码，而模块 C 只是记录并继续前进，那么在不让错误漏掉的情况下集成它们会很痛苦。
*   尽量避免一些琐碎的事情，比如放置花括号。这会让很多人争论他们喜欢的风格，最后，它对代码的可读性并没有太大的影响。另一方面，强制括号的*存在*可以产生影响。
*   在集成不同的代码库时，不要试图更改每个人的变量命名约定以匹配黄金标准。您可能有一个前进的标准，但最重要的是，任何已经存在的本地化标准都得到一致的保留。如果一个模块使用`m_member`，维护程序员应该使用`m_member2`而不是应用任何其他标准（例如`member2_`或`m_lpcstrMember2`或其他）。本地一致性是王道。
*   文件系统布局很重要。保持一致。使某人可以轻松地跳入库源库并立即知道标头、Makefile、源代码等在哪里。如果您正在使用 Java 或 Python，这很容易，因为包系统会强制执行它。如果您使用 C、C++ 或任何其他无数的脚本语言，您需要自己设计一个标准布局并坚持下去。
*   不要为小东西出汗。变量命名约定、括号或关键字或函数名称之间的空格......大部分都无关紧要，因为它不会减少出错的可能性。你设定的每条规则都应该有一个具体的理由，如果你发现它造成的悲伤超过了它的价值，你不应该害怕改变或删除它。
*   不要到处强制执行无偿评论块。它们最终会成为一种浪费，并且大多数注释最好在代码本身中表达（例如，作为变量或函数名称）。

最后，最重要的是在同行之间定期进行代码审查。鼓励人们在看到“代码气味”时说出来。还要确保人们意识到，建设性的代码批评并不意味着是个人的——源由团队中的每个人共享，它不只是属于原作者。根据我的经验，最令人发指的问题是任何编码指南都无法解决的设计问题。软件设计仍然是一种艺术形式（无论是好是坏），而且一群大脑比一个大脑要好得多。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-04T23:08:50.467

```
if( !codingGuidelines.Followed)
{
   reason = programmer.WhyNot();
   if( reason.Acceptable)
   {
      codingGuidelines.Integrate( reason);
   }
   else
   {
      team.GiveAssKicking(programmer);
   }
} 
```

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2008-12-04T22:56:38.807

这是一个相当开放的问题，答案同样开放：

**每个指南的实施成本都应该低于它带来的好处。**

小心，因为等式的每一边都有一些隐藏的部分。

实施成本可能包括排除完美的替代方案、扼杀创造力和创新，以及鼓励代码审查退化为突出显示风格的轻微违规行为，而不是解决实际问题。

对于忙碌的开发人员来说，收益的价值可能是无形的（因此令人沮丧），但可能会导致您的组织品牌更强大或更快地将新员工带入项目 - 这可能会超过遵从的少量增量成本.

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-04T23:17:46.890

作为开发人员，我通常更喜欢提供基本指导的指南，但不要太严格以至于我无法按照自己喜欢的方式编写代码……例如，如果指南告诉我必须使用哪些编码模式，而不是允许我使用做出我自己的专业判断，那就太紧了：

例如，这些是我可能希望看到的类型：

*   变量名称的样式，即匈牙利符号（不是我严格使用那些）
*   方法应该用它们的一般用途来注释，包括它们返回的内容（如果有的话）
*   类应该用特定的布局来定义：即所有私有字段在顶部，然后是事件、公共方法、私有方法，它们是否应该按字母顺序排列
*   命名空间、类、方法、事件和属性等的命名约定

你得到图片。我不应该局限于以下内容：

*   您应该使用 If 表示法而不是 int a = (blah)? 真假;

编码风格显然需要在整个团队中通用，以使开发人员能够有效地一起工作。你不能让一个人在左侧领域使用团队中其他人无法理解的复杂数学算法，而在右侧领域有另一种方式，他们几乎无法理解接口的实现。因此，根据经验，它们应该旨在帮助您的团队保持团结，同时不会降低生产力和创造力。

从您的整个开发团队那里获得一些输入，以便“内部”标准可以包含它应该包含的所有内容，而不是包含一堆它不应该包含的东西。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-04T23:13:05.217

编码指南可以让其他人轻松阅读您的代码。即使您是为自己编写代码并且是唯一的开发人员，找到一套行业普遍接受的准则并坚持下去也可能很有用。这将使您更容易阅读其他人的代码，并让您在以后适应更大的团队。

如果使用 .net，请查看 StyleCop。默认情况下，它包含 MS 自己使用并用于设计 .net 框架的标准。你可以从这里得到它：

[http://code.msdn.microsoft.com/sourceanalysis](http://code.msdn.microsoft.com/sourceanalysis)

您可以禁用您不喜欢的规则并添加您自己的规则。它甚至可以编写脚本以在签入代码时强制执行规则。它的好处是，如果您对这类东西真的很陌生，它会准确地告诉您您做错了什么。如果您想更进一步，请查看 Resharper。这是同一类事情，但在您键入时会实时执行（尽管默认情况下它使用稍微不同的标准。

如果你不喜欢 c#，我相信其他语言也有类似的实用程序！

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-04T23:37:43.420

我想要一份编码标准文档来解决团队的宗教争论。

对于有多个有价值的答案的问题，并且人们有长时间争论的倾向，我们希望在整个项目中保持一致性，避免花太多时间讨论它们。

很好的例子是“TAB 与空格”和“K&R 与 ANSI 大括号放置”。在团队中进行民意调查，做出决定并写下来。一次将决定应用于所有现有代码，然后自行检入。永远不要再讨论它。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-04T22:52:30.030

一般来说，我希望指南能够回答您通常会问但需要很长时间才能回答的问题，如果您只是单独编码，那可能是“个人偏好”。通常他们会指定一些简洁的东西，例如数据库命名约定和空格与制表符（以及多少个空格）以及注释/文档注释样式。

UI 指南与我认为的其他指南不同。

我最喜欢的编码风格指南示例之一是[Linux 内核编码风格](http://pantransit.reptiles.org/prog/CodingStyle.html)，尽管它没有涉及我在其他指南中看到的细节。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-04T23:23:32.917

[Juval Lowy 的 C# 编码指南](http://www.idesign.net/idesign/download/IDesign%20CSharp%20Coding%20Standard.zip)是正确指南的一个很好的例子。我有几件事我会改变它，但在大多数情况下它太棒了。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-05T00:55:02.950

我也喜欢编码风格的想法，它可以帮助开发人员直观地识别坏/错误的代码。例如，如果有人不小心将 int 赋值为浮点值或类似的东西，在其名称中包含变量的类型会有所帮助。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-12-05T16:50:48.293

[Code Complete](http://cc2e.com/)是一本关于通用编程最佳实践和指南的优秀书籍，可以应用于任何语言。

它涵盖了编程的所有方面，对于希望以“最佳”方式解决遇到的每个问题的实际程序员来说，它是必读的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-04T23:12:34.560

编码指南是团队成员的行为规则，因此您可以轻松阅读彼此的代码。

它还可以在您的代码审查会议上消除“换行符或同一行的括号”讨论，从而节省大量时间；-)

在编写代码指南时，请确保它们的存在是有原因的，并且它们实际上可以帮助您的团队编写更具可读性的代码。

# ruby-on-rails - Ruby 的 MySQL 驱动程序找不到所需的库

> ID：342371
> 
> 赞同：2
> 
> 时间：2008-12-04T22:47:44.877
> 
> 标签：ruby-on-rails, ruby, rubygems

Linux 2.6.18-92.el5、ruby 1.8.7、Rails 2.2.2、mysql gem 2.7

我在 /usr/local 下安装了 MySQL 二进制发行版，然后像这样安装了 mysql gem：

```
gem install mysql --no-rdoc --no-ri \
  -- --with-mysql-include=/usr/local/mysql/include \
  --with-mysql-lib=/usr/local/mysql/lib \
  --with-mysql-config=/usr/local/mysql/bin/mysql_config 
```

当我运行时，`irb> require 'mysql'`我收到如下所示的错误：

```
irb(main):001:0> require 'rubygems'
=> true
irb(main):002:0> require 'mysql'
LoadError: libmysqlclient.so.16: cannot open shared object file:
  No such file or directory - 
    /usr/local/lib/ruby/gems/1.8/gems/mysql-2.7/lib/mysql.so
  from /usr/local/lib/ruby/gems/1.8/gems/mysql-2.7/lib/mysql.so
  from /usr/local/lib/ruby/site_ruby/1.8/rubygems/
  custom_require.rb:36:in `require' from (irb):2 
```

经过一番谷歌搜索后，我发现我可以`ldconfig`用来配置 mysql.so 以供整个系统使用。一旦我将“/usr/local/mysql/lib”添加到/etc/ld.so.conf并运行ldconfig，它就可以正常工作了：

```
irb(main):002:0> require 'rubygems'
=> true
irb(main):003:0> require 'mysql'
=> true 
```

好的，所以我开始工作了。但我的问题是，为什么我会收到这个错误？你曾经能够做到这`gem install mysql`一点，它会奏效。有没有其他人遇到过同样的错误？使用`ldconfig`似乎有点脆弱且不可维护。有更好的解决方案吗？

任何见解将不胜感激。

谢谢，

伊森

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-09T17:28:53.550

我也遇到了问题（在 Mac OS X 上），并且很沮丧，`gem install mysql`因为它不像以前那么简单了。

短视的答案是 mysql gem 需要构建本机扩展，为此，它需要一些有关 MySQL 库的路径信息（特定于您的系统）。获取该信息的最可靠方法是由您提供。

更大的答案是这是 gem 系统中的一个设计错误。当几乎所有其他 gem 安装时`gem install foo`，系统和 gem 提交者需要为用户提供一些关于重要异常情况的指令——即使它只是反馈错误消息，告诉你必须提供更多信息来安装这个 gem ，以及该信息是什么。

一番谷歌搜索最终让我找到了答案，但让我看到了更多其他人被一个简单的过程蒙蔽了双眼，这个过程在没有警告的情况下变得复杂。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T22:57:29.553

可能与安装mysql时使用的前缀有关？--with-mysql-lib=/usr/local/mysql/lib

据推测，如果那是 /usr/local/lib（或某个 ldconfig 已经设置为查看）和/或如果您刚刚使用了 /usr/local 之类的顶级前缀，那么您可能没有遇到问题（ ?)

# security - 跨域登录 - 如何在从一个域转移到另一个域时自动登录用户

> ID：342378
> 
> 赞同：55
> 
> 时间：2008-12-04T22:53:19.920
> 
> 标签：security, authentication, dns, single-sign-on

我们提供多种在线服务。`domain1.com`如果用户从一项服务 (on ) 转移到另一项服务 (on )，我们需要开发一个为用户提供快速/简单体验的系统`domain2.com`。

用户转移到新服务后，是否有一种安全可靠的方式自动登录？

如果以下解决方案完全不安全/错误，请对我大喊大叫。

我们正在考虑一个类似于许多在线服务提供的用于密码恢复的系统——通过电子邮件向他们发送一个带有唯一哈希值的链接，该哈希值过期，允许他们更改密码。

该`domain1.com`站点将生成一个唯一的散列并将其存储在一个数据库中，该散列与一个用户链接以及一个过期日期时间字段。

用户将被转移到`domain2.com/auto/?hash=d41d8cd98f00b204e9800998ecf8427e`

`domain2.com`接下来将使用哈希发出请求以`domain1.com`获取有关用户的信息。`domain1.com`然后将从数据库中删除哈希。`domain2.com`将登录用户并设置cookie等。

基于 OpenID 或 OAuth 的东西能达到同样的效果吗？

* * *

## 回答 #1

> 赞同：138
> 
> 时间：2008-12-05T00:08:50.423

**单点登录**(SSO) 在概念上非常简单。

*   用户点击`domain1.com`。
*   `domain1.com`看到没有会话 cookie。
*   `domain1.com`重定向到`sso.com`
*   `sso.com`显示登录页面，并获取凭据
*   `sso.com`为用户设置会话 cookie
*   `sso.com`然后重定向回`domain1`一个特殊的网址（如`domain1.com/ssologin`）
*   URL 包含一个`ssologin`基本上由`sso.com`. 它可以像使用共享密钥加密登录 ID 的 base64 一样简单。
*   `domain1.com`获取加密的令牌，对其进行解密，使用新的登录 ID 登录用户。
*   `domain1`为用户设置会话 cookie。

现在，下一个案例。

*   用户点击`domain2.com`，跟随`domain1`并重定向到`sso.com`
*   `sso.com`已经有用户的 cookie，所以不显示登录页面
*   `sso.com``domain2.com`使用加密信息重定向回
*   `domain2.com`登录用户。

这就是它如何工作的基本原理。您可以使其更健壮，功能更丰富（例如，这是**SSOn**，但不是**SSOff**，用户可以“注销” `domain1`，但仍然可以登录`domain2`）。您可以使用**公钥**签署凭证，您可以请求从 SSO 服务器传输更多信息（如授权等）。您可以进行更密切的集成，例如域定期检查用户是否仍然拥有来自 SSO 服务器的权限。

但是通过浏览器使用重定向的**cookie 握手**是所有这些 SSO 解决方案所基于的关键基础。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-04T22:57:43.093

如果有人能够扮演中间人并抓住那个哈希，他们是否能够窃取跨域传输？显然，它需要在客户需要使用它之前生成并发送给他们。比如说：

我在扮演中间监视杰克的人。Jack 访问`domain1.com`会导致准备好哈希并将其发送给他，以便当他访问时，`domain2.com`他可以发送该哈希作为身份验证。当他访问`domain1.com`时，他的请求来自我，你返回页面，我获取哈希并让他继续。我`domain2.com`使用哈希访问，你现在让我进入`domain2.com`并删除了哈希。在他尝试登录`domain2.com`并被告知他的凭据不再有效之前，他一点也不聪明。

你如何克服它？

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-11-30T12:25:34.997

除非您在整个会话中使用 SSL，否则使用 SSL 进行跨域登录没有任何意义。窃取会话 cookie 就像在 url 中使用哈希一样容易。如果会话的其余部分不安全，那么在 SSL 中隐藏哈希有什么意义。

顶部给出的方法几乎是标准方法。是否选择使用安全协议完全是另一回事，但只加密部分会话是没有意义的。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-12-04T23:53:25.197

这是一个很好的解决方案。这里有两点需要考虑：

您使用术语“散列”，但不清楚您将散列哪些数据。相反，使用“nonce”：由加密质量 RNG 生成的大（128 位）数字。

此外，您没有指定这一点，但用户与两个域之间以及域本身之间的通信必须是安全的。使用 SSL 对服务器进行身份验证并保持 nonce 的机密性。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-09-17T18:14:09.310

What about SEO? It looks like every request before succesfull login is redirected to other domain and back. I would tell that this is very ugly. What headers should you send? 301 to SSO and then back 301 to original page? So search bot is "requested" to change his index for that page twice?

# iphone - 处理 UITableViewCell 的更好方法

> ID：342381
> 
> 赞同：1
> 
> 时间：2008-12-04T22:53:55.550
> 
> 标签：iphone, objective-c, cocoa-touch

我有一张大约有 10 个单元格、4 种不同类型的表格。我将 UITextViewCell 子类化，因为我希望将 IBOutlet 用于标签和 UITextField。不确定这是否是处理它的最佳方法，但到目前为止它有效。接下来，我有一个用于性别的单元格，所以我认为不是子类化 UITableViewCell，而是使用 UILabel 和 UITextField 获取已经子类化的单元格，并编写以下代码：

```
NSArray *buttonNames = [NSArray arrayWithObjects:@"Male", @"Female", nil];
UISegmentedControl* segmentedControl = [[UISegmentedControl alloc] initWithItems:buttonNames];
segmentedControl.momentary = YES;               
segmentedControl.autoresizingMask = UIViewAutoresizingFlexibleWidth;
segmentedControl.segmentedControlStyle = UISegmentedControlStyleBar;
segmentedControl.frame = CGRectMake(75, 5, 130, 30);
[segmentedControl addTarget:self action:@selector(segmentAction:) forControlEvents:UIControlEventValueChanged];
for (UIView *oneView in cell.contentView.subviews) {
    if ([oneView isMemberOfClass:[UITextField class]]) {
        [cell.contentView insertSubview:segmentedControl aboveSubview:oneView];
        [oneView removeFromSuperview];
    }
}
[segmentedControl release]; 
```

这样做有多可怕？我应该为一个复杂的 tableView 将 UITableViewCell 子类化 5 次吗？在以下情况下是否可以处理它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-17T20:56:03.163

我实际上会进行子类化。子类化很便宜。单元格有不同的类型，您现在正在做的是遍历所有子视图并检查每个视图的类成员资格 - 这很慢！子类将清理您的代码并同时使其更快。不要试图将太多的东西塞进一个容器中，事实上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T03:56:10.307

If this is the only table where these cells will be used, I'd go ahead and configure them on the fly in the tableView:cellForRowAtIndexPath: method. Don't worry so much about subclassing.

And make sure you tag each subview (the labels, for example). That way, you can reference the label by using viewWithTag:

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T00:51:33.770

您总是可以将控件添加到您的子类中，但将其隐藏。然后，根据行，设置单元格的“模式”。模式设置器可以隐藏/取消隐藏与该行相关的控件。如果性能是一个问题，可以使用多个单元 ID 以便缓存视图。

# iphone - 在 iphone 应用程序启动期间播放电影文件（即在应用程序加载期间）

> ID：342383
> 
> 赞同：2
> 
> 时间：2008-12-04T22:56:35.170
> 
> 标签：iphone, splash-screen

我想播放电影文件或任何动画文件，直到时间应用程序未完全加载。
有什么简单的方法吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-07-07T20:50:07.983

告诉其他人他们想做什么是有问题的。我的客户想要播放一部电影，而这只是一部 3 秒的电影。这叫做品牌，如果他的用户不喜欢它，他们会告诉他。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-09-04T21:31:46.657

你们中有人看过 Storm 8 的 iPhone 应用吗？他们在启动时播放电影，而且非常流畅。事实上，很多游戏都是这样做的。这不是一个不合理的问题，我也想知道该怎么做。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T00:06:22.003

如果你真的想这样做，你必须仔细考虑。在硬件受限的设备上，加载电影会增加加载时间，而不是像您的目标那样减少加载时间。甚至 Default.png 方法也是一种指示应用程序正在加载并减少用户感知加载时间的方法；它不是作为启动画面或眼睛糖果。

如果您的应用程序在加载期间确实有很长的操作，而在显示功能 UI 之前您绝对无法避免，我认为最好的选择可能是使用 Core Animation 层快速“加载”动画。也许有更好的方法可以做到这一点，但根据我的经验，加载电影播放器​​需要时间。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T23:00:13.853

取决于你的意思。

在您的代码获得任何控制权之前，iPhone 会在应用程序加载时显示静止图像 (Default.png)。

一旦您的代码获得控制权，您就可以使用 MPMoviePlayer 播放视频。您可以启动一个单独的线程来做任何需要很长时间才能将其隐藏在视频后面的事情......

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-12-05T04:05:20.010

播放电影的唯一方法是使用 MPMoviePlayer。这将接管 UI 并且是全屏的——在电影关闭之前，您的应用程序都不会显示。

虽然在应用程序加载时播放电影听起来很酷，但在 iPhone 上，这真的不实用。这不是你想做的事情。

# java - unicode字符首（U+9996）是怎么回事，java/mysql如何处理它及其朋友？

> ID：342392
> 
> 赞同：4
> 
> 时间：2008-12-04T23:00:15.833
> 
> 标签：java, mysql, eclipse, unicode, console

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T23:18:27.420

您是否验证了存储在数据库中的值实际上是 U+003f（问号）？关于如何显示所选字体中不存在的字符并将它们显示为？相当普遍。

所以最有可能的是，字符被正确存储，并且无论出于何种原因，都只是显示为“？”。基本上，忽略它是如何呈现的，并查看哪些代码点存储在数据库中。是 U+9996 还是 U+003f （或完全是其他东西）？不要盲目地假设仅仅因为它被呈现为一个问号，它实际上是一个存储在数据库中的问号。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-04T23:04:08.743

我不知道这些问题，但它[绝对是一个有效的 Unicode 字符](http://unicode.org/cgi-bin/GetUnihanData.pl?codepoint=9996)（从 Unicode 1.1 开始就是这样）。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-04T23:08:38.877

1.  这是在什么操作系统上运行的？
2.  什么是控制台应用程序，即（xterm、cmd.exe 等？）
3.  控制台应用程序是否设置为 UTF-8 输出？

关于上面的 3，这可能是重要的，我已经看到类似的问题，例如使用 PuTTY 与 Linux 机器对话，Linux 机器认为我使用的是 UTF-8，但 PuTTY 会话本身设置为 ISO-Latin -1 (8859-1)

# outlook - 用于会议的 Outlook VSTO 插件

> ID：342398
> 
> 赞同：2
> 
> 时间：2008-12-04T23:02:55.987
> 
> 标签：outlook, vsto, visual-studio-addins

我们为 Outlook 会议创建了一个 VSTO 插件。

作为其中的一部分，我们捕获事件`SendEvent`的消息`FormRegionShowing`：

```
_apptEvents.Send += new Microsoft.Office.Interop.Outlook.ItemEvents_SendEventHandler(_apptEvents_Send); 
```

然后该方法`_apptEvents_Send`测试几个属性并在适当的地方退出。

```
private void _apptEvents_Send(ref bool Cancel)
{
    if (!_Qualified)
    {
        MessageBox.Show("Meeting has not been qualified", "Not Qualified Meeting", MessageBoxButtons.OK, MessageBoxIcon.Information);
        chkQualified.Focus();
        Cancel = true;
    }
} 
```

我们遇到的问题是某些用户的消息被发送了两次。一次是在发送会议时，第二次是在用户重新打开 Outlook 时。

我一直在寻找内存泄漏，认为某些东西可能没有被正确处理，并在所有 finally 调用中添加了显式对象处理，以尝试确保资源得到管理，但仍然在整个组织中不一致地获得功能。即我在开发过程中从未遇到过问题，在测试期间也没有其他开发人员遇到过。所有用户都是最新的框架 (3.5 SP1) 和 Outlook 修补程序。

有没有人对可能导致这种情况的原因有任何想法？

任何人可能有的任何想法都将不胜感激。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-15T16:11:37.073

为什么要使用`Microsoft.Office.Interop.Outlook.ApplicationEvents_10.Send Event`而不是一遍又一遍地添加给定的处理程序。

在您的 vsto 插件的启动方法上，只需添加：

```
((MSOutlook.ApplicationEvents_10_Event)_OutlookApp).ItemSend += new Microsoft.Office.Interop.Outlook.ApplicationEvents_10_ItemSendEventHandler(Utils_ItemSend);

void Utils_ItemSend(object Item, ref bool Cancel)
{
    //Do your operation here.
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-12T14:27:48.507

我不是专业人士，但由于人们的发送邮件设置，我过去在进行 Outlook 自动化时遇到了麻烦。

例如，我的邮件仅在我强制发送/接收周期时发送。大多数人都可以立即发送前景，我记得当有人第一次要求真正简单的自动化脚本时有些头疼。

看看这是否是所有开发人员的共同点，而用户的设置可能不同。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-07-14T09:35:47.657

你做的是小错误。更改您的代码如下

```
 private void _apptEvents_Send(ref bool Cancel)
 {
    if (!_Qualified)
    {
    MessageBox.Show("Meeting has not been qualified", "Not Qualified Meeting", 
    MessageBoxButtons.OK, MessageBoxIcon.Information);
    chkQualified.Focus();
    Cancel = true;
    return; // need to add this one line
  }
} 
```

# c - 如何在 C 中进行 base64 编码（解码）？

> ID：342409
> 
> 赞同：151
> 
> 时间：2008-12-04T23:08:51.573
> 
> 标签：c, base64

我在 unsigned char 变量中有二进制数据。我需要在 c 中将它们转换为 PEM base64。我查看了 openssl 库，但找不到任何功能。有没有人有任何想法？

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2011-07-21T20:40:25.413

这是我正在使用的一个：

```
#include <stdint.h>
#include <stdlib.h>

static char encoding_table[] = {'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',
                                'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
                                'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',
                                'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
                                'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',
                                'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
                                'w', 'x', 'y', 'z', '0', '1', '2', '3',
                                '4', '5', '6', '7', '8', '9', '+', '/'};
static char *decoding_table = NULL;
static int mod_table[] = {0, 2, 1};

char *base64_encode(const unsigned char *data,
                    size_t input_length,
                    size_t *output_length) {

    *output_length = 4 * ((input_length + 2) / 3);

    char *encoded_data = malloc(*output_length);
    if (encoded_data == NULL) return NULL;

    for (int i = 0, j = 0; i < input_length;) {

        uint32_t octet_a = i < input_length ? (unsigned char)data[i++] : 0;
        uint32_t octet_b = i < input_length ? (unsigned char)data[i++] : 0;
        uint32_t octet_c = i < input_length ? (unsigned char)data[i++] : 0;

        uint32_t triple = (octet_a << 0x10) + (octet_b << 0x08) + octet_c;

        encoded_data[j++] = encoding_table[(triple >> 3 * 6) & 0x3F];
        encoded_data[j++] = encoding_table[(triple >> 2 * 6) & 0x3F];
        encoded_data[j++] = encoding_table[(triple >> 1 * 6) & 0x3F];
        encoded_data[j++] = encoding_table[(triple >> 0 * 6) & 0x3F];
    }

    for (int i = 0; i < mod_table[input_length % 3]; i++)
        encoded_data[*output_length - 1 - i] = '=';

    return encoded_data;
}

unsigned char *base64_decode(const char *data,
                             size_t input_length,
                             size_t *output_length) {

    if (decoding_table == NULL) build_decoding_table();

    if (input_length % 4 != 0) return NULL;

    *output_length = input_length / 4 * 3;
    if (data[input_length - 1] == '=') (*output_length)--;
    if (data[input_length - 2] == '=') (*output_length)--;

    unsigned char *decoded_data = malloc(*output_length);
    if (decoded_data == NULL) return NULL;

    for (int i = 0, j = 0; i < input_length;) {

        uint32_t sextet_a = data[i] == '=' ? 0 & i++ : decoding_table[data[i++]];
        uint32_t sextet_b = data[i] == '=' ? 0 & i++ : decoding_table[data[i++]];
        uint32_t sextet_c = data[i] == '=' ? 0 & i++ : decoding_table[data[i++]];
        uint32_t sextet_d = data[i] == '=' ? 0 & i++ : decoding_table[data[i++]];

        uint32_t triple = (sextet_a << 3 * 6)
        + (sextet_b << 2 * 6)
        + (sextet_c << 1 * 6)
        + (sextet_d << 0 * 6);

        if (j < *output_length) decoded_data[j++] = (triple >> 2 * 8) & 0xFF;
        if (j < *output_length) decoded_data[j++] = (triple >> 1 * 8) & 0xFF;
        if (j < *output_length) decoded_data[j++] = (triple >> 0 * 8) & 0xFF;
    }

    return decoded_data;
}

void build_decoding_table() {

    decoding_table = malloc(256);

    for (int i = 0; i < 64; i++)
        decoding_table[(unsigned char) encoding_table[i]] = i;
}

void base64_cleanup() {
    free(decoding_table);
} 
```

请记住，这在解码时不会进行任何错误检查 - 将处理非 base 64 编码数据。

* * *

## 回答 #2

> 赞同：91
> 
> 时间：2016-12-12T05:35:16.057

我知道这个问题已经很老了，但是我对提供的解决方案的数量感到困惑——每个解决方案都声称更快更好。我在github上整理了一个项目来比较base64编码器和解码器：[https ://github.com/gaspardpetit/base64/](https://github.com/gaspardpetit/base64/)

在这一点上，我并没有限制自己使用 C 算法 - 如果一个实现在 C++ 中表现良好，它可以很容易地向后移植到 C。还使用 Visual Studio 2015 进行了测试。如果有人想用 clang/ 的结果更新这个答案gcc，做我的客人。

**最快的编码器：** 我发现的两个最快的编码器实现是[http://web.mit.edu/freebsd/head/contrib/wpa/src/utils/base64.c上的 Jouni Malinen 和](http://web.mit.edu/freebsd/head/contrib/wpa/src/utils/base64.c)[https://opensource.apple](https://opensource.apple.com/source/QuickTimeStreamingServer/QuickTimeStreamingServer-452/CommonUtilitiesLib/base64.c)上的 Apache [.com/source/QuickTimeStreamingServer/QuickTimeStreamingServer-452/CommonUtilitiesLib/base64.c](https://opensource.apple.com/source/QuickTimeStreamingServer/QuickTimeStreamingServer-452/CommonUtilitiesLib/base64.c)。

这是使用我迄今为止测试过的不同算法对 32K 数据进行编码的时间（以微秒为单位）：

```
jounimalinen                25.1544
apache                      25.5309
NibbleAndAHalf              38.4165
internetsoftwareconsortium  48.2879
polfosol                    48.7955
wikibooks_org_c             51.9659
gnome                       74.8188
elegantdice                 118.899
libb64                      120.601
manuelmartinez              120.801
arduino                     126.262
daedalusalpha               126.473
CppCodec                    151.866
wikibooks_org_cpp           343.2
adp_gmbh                    381.523
LihO                        406.693
libcurl                     3246.39
user152949                  4828.21 
```

（René Nyffenegger 的解决方案，在此问题的另一个答案中得到认可，在此列为 adp_gmbh）。

这是来自 Jouni Malinen 的一个，我稍作修改以返回 std::string：

```
/*
* Base64 encoding/decoding (RFC1341)
* Copyright (c) 2005-2011, Jouni Malinen <j@w1.fi>
*
* This software may be distributed under the terms of the BSD license.
* See README for more details.
*/

// 2016-12-12 - Gaspard Petit : Slightly modified to return a std::string 
// instead of a buffer allocated with malloc.

#include <string>

static const unsigned char base64_table[65] =
    "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";

/**
* base64_encode - Base64 encode
* @src: Data to be encoded
* @len: Length of the data to be encoded
* @out_len: Pointer to output length variable, or %NULL if not used
* Returns: Allocated buffer of out_len bytes of encoded data,
* or empty string on failure
*/
std::string base64_encode(const unsigned char *src, size_t len)
{
    unsigned char *out, *pos;
    const unsigned char *end, *in;

    size_t olen;

    olen = 4*((len + 2) / 3); /* 3-byte blocks to 4-byte */

    if (olen < len)
        return std::string(); /* integer overflow */

    std::string outStr;
    outStr.resize(olen);
    out = (unsigned char*)&outStr[0];

    end = src + len;
    in = src;
    pos = out;
    while (end - in >= 3) {
        *pos++ = base64_table[in[0] >> 2];
        *pos++ = base64_table[((in[0] & 0x03) << 4) | (in[1] >> 4)];
        *pos++ = base64_table[((in[1] & 0x0f) << 2) | (in[2] >> 6)];
        *pos++ = base64_table[in[2] & 0x3f];
        in += 3;
    }

    if (end - in) {
        *pos++ = base64_table[in[0] >> 2];
        if (end - in == 1) {
            *pos++ = base64_table[(in[0] & 0x03) << 4];
            *pos++ = '=';
        }
        else {
            *pos++ = base64_table[((in[0] & 0x03) << 4) |
                (in[1] >> 4)];
            *pos++ = base64_table[(in[1] & 0x0f) << 2];
        }
        *pos++ = '=';
    }

    return outStr;
} 
```

**最快的解码器：**这是解码结果，我必须承认我有点惊讶：

```
polfosol                    45.2335
wikibooks_org_c             74.7347
apache                      77.1438
libb64                      100.332
gnome                       114.511
manuelmartinez              126.579
elegantdice                 138.514
daedalusalpha               151.561
jounimalinen                206.163
arduino                     335.95
wikibooks_org_cpp           350.437
CppCodec                    526.187
internetsoftwareconsortium  862.833
libcurl                     1280.27
LihO                        1852.4
adp_gmbh                    1934.43
user152949                  5332.87 
```

Polfosol 的来自[c++ 中 base64 解码片段](https://stackoverflow.com/questions/180947/base64-decode-snippet-in-c/13935718)的片段是最快的，几乎是 2 倍。

为了完整起见，这里是代码：

```
static const int B64index[256] = { 0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0,
0,  0,  0,  0,  0,  0,  0,  0,  0,  0,  0, 62, 63, 62, 62, 63, 52, 53, 54, 55,
56, 57, 58, 59, 60, 61,  0,  0,  0,  0,  0,  0,  0,  0,  1,  2,  3,  4,  5,  6,
7,  8,  9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25,  0,
0,  0,  0, 63,  0, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51 };

std::string b64decode(const void* data, const size_t len)
{
    unsigned char* p = (unsigned char*)data;
    int pad = len > 0 && (len % 4 || p[len - 1] == '=');
    const size_t L = ((len + 3) / 4 - pad) * 4;
    std::string str(L / 4 * 3 + pad, '\0');

    for (size_t i = 0, j = 0; i < L; i += 4)
    {
        int n = B64index[p[i]] << 18 | B64index[p[i + 1]] << 12 | B64index[p[i + 2]] << 6 | B64index[p[i + 3]];
        str[j++] = n >> 16;
        str[j++] = n >> 8 & 0xFF;
        str[j++] = n & 0xFF;
    }
    if (pad)
    {
        int n = B64index[p[L]] << 18 | B64index[p[L + 1]] << 12;
        str[str.size() - 1] = n >> 16;

        if (len > L + 2 && p[L + 2] != '=')
        {
            n |= B64index[p[L + 2]] << 6;
            str.push_back(n >> 8 & 0xFF);
        }
    }
    return str;
} 
```

* * *

## 回答 #3

> 赞同：35
> 
> 时间：2008-12-04T23:28:26.713

但是你也可以在openssl中做（`openssl enc`command do it....），看看[`BIO_f_base64()`](http://www.openssl.org/docs/crypto/BIO_f_base64.html)函数

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2013-05-12T19:14:44.620

这是我使用 OpenSSL 的解决方案。

```
/* A BASE-64 ENCODER AND DECODER USING OPENSSL */
#include <openssl/pem.h>
#include <string.h> //Only needed for strlen().

char *base64encode (const void *b64_encode_this, int encode_this_many_bytes){
    BIO *b64_bio, *mem_bio;      //Declares two OpenSSL BIOs: a base64 filter and a memory BIO.
    BUF_MEM *mem_bio_mem_ptr;    //Pointer to a "memory BIO" structure holding our base64 data.
    b64_bio = BIO_new(BIO_f_base64());                      //Initialize our base64 filter BIO.
    mem_bio = BIO_new(BIO_s_mem());                           //Initialize our memory sink BIO.
    BIO_push(b64_bio, mem_bio);            //Link the BIOs by creating a filter-sink BIO chain.
    BIO_set_flags(b64_bio, BIO_FLAGS_BASE64_NO_NL);  //No newlines every 64 characters or less.
    BIO_write(b64_bio, b64_encode_this, encode_this_many_bytes); //Records base64 encoded data.
    BIO_flush(b64_bio);   //Flush data.  Necessary for b64 encoding, because of pad characters.
    BIO_get_mem_ptr(mem_bio, &mem_bio_mem_ptr);  //Store address of mem_bio's memory structure.
    BIO_set_close(mem_bio, BIO_NOCLOSE);   //Permit access to mem_ptr after BIOs are destroyed.
    BIO_free_all(b64_bio);  //Destroys all BIOs in chain, starting with b64 (i.e. the 1st one).
    BUF_MEM_grow(mem_bio_mem_ptr, (*mem_bio_mem_ptr).length + 1);   //Makes space for end null.
    (*mem_bio_mem_ptr).data[(*mem_bio_mem_ptr).length] = '\0';  //Adds null-terminator to tail.
    return (*mem_bio_mem_ptr).data; //Returns base-64 encoded data. (See: "buf_mem_st" struct).
}

char *base64decode (const void *b64_decode_this, int decode_this_many_bytes){
    BIO *b64_bio, *mem_bio;      //Declares two OpenSSL BIOs: a base64 filter and a memory BIO.
    char *base64_decoded = calloc( (decode_this_many_bytes*3)/4+1, sizeof(char) ); //+1 = null.
    b64_bio = BIO_new(BIO_f_base64());                      //Initialize our base64 filter BIO.
    mem_bio = BIO_new(BIO_s_mem());                         //Initialize our memory source BIO.
    BIO_write(mem_bio, b64_decode_this, decode_this_many_bytes); //Base64 data saved in source.
    BIO_push(b64_bio, mem_bio);          //Link the BIOs by creating a filter-source BIO chain.
    BIO_set_flags(b64_bio, BIO_FLAGS_BASE64_NO_NL);          //Don't require trailing newlines.
    int decoded_byte_index = 0;   //Index where the next base64_decoded byte should be written.
    while ( 0 < BIO_read(b64_bio, base64_decoded+decoded_byte_index, 1) ){ //Read byte-by-byte.
        decoded_byte_index++; //Increment the index until read of BIO decoded data is complete.
    } //Once we're done reading decoded data, BIO_read returns -1 even though there's no error.
    BIO_free_all(b64_bio);  //Destroys all BIOs in chain, starting with b64 (i.e. the 1st one).
    return base64_decoded;        //Returns base-64 decoded data with trailing null terminator.
}

/*Here's one way to base64 encode/decode using the base64encode() and base64decode functions.*/
int main(void){
    char data_to_encode[] = "Base64 encode this string!";  //The string we will base-64 encode.

    int bytes_to_encode = strlen(data_to_encode); //Number of bytes in string to base64 encode.
    char *base64_encoded = base64encode(data_to_encode, bytes_to_encode);   //Base-64 encoding.

    int bytes_to_decode = strlen(base64_encoded); //Number of bytes in string to base64 decode.
    char *base64_decoded = base64decode(base64_encoded, bytes_to_decode);   //Base-64 decoding.

    printf("Original character string is: %s\n", data_to_encode);  //Prints our initial string.
    printf("Base-64 encoded string is: %s\n", base64_encoded);  //Prints base64 encoded string.
    printf("Base-64 decoded string is: %s\n", base64_decoded);  //Prints base64 decoded string.

    free(base64_encoded);                //Frees up the memory holding our base64 encoded data.
    free(base64_decoded);                //Frees up the memory holding our base64 decoded data.
} 
```

* * *

## 回答 #5

> 赞同：18
> 
> 时间：2008-12-04T23:11:27.543

glib 具有 base64 编码功能：[https ://developer.gnome.org/glib/stable/glib-Base64-Encoding.html](https://developer.gnome.org/glib/stable/glib-Base64-Encoding.html)

* * *

## 回答 #6

> 赞同：18
> 
> 时间：2011-12-21T16:22:03.857

[libb64](http://libb64.sourceforge.net/)同时具有 C 和 C++ API。它是轻量级的，也许是最快的公开实现。它也是一个专用的独立 base64 编码库，如果您不需要使用更大的库（如 OpenSSL 或 glib）获得的所有其他东西，它会很好。

* * *

## 回答 #7

> 赞同：15
> 
> 时间：2013-04-08T13:14:21.720

我需要在**std::string上工作的****C++**实现。没有一个答案能满足我的需求，我需要简单的编码和解码的双功能解决方案，但是我懒得写自己的代码，所以我发现了这个：

 **[http://www.adp-gmbh.ch/cpp/common/base64.html](http://www.adp-gmbh.ch/cpp/common/base64.html)

代码致谢 René Nyffenegger。

将代码放在下面以防网站出现故障：

**base64.cpp**

```
/* 
   base64.cpp and base64.h

   Copyright (C) 2004-2008 René Nyffenegger

   This source code is provided 'as-is', without any express or implied
   warranty. In no event will the author be held liable for any damages
   arising from the use of this software.

   Permission is granted to anyone to use this software for any purpose,
   including commercial applications, and to alter it and redistribute it
   freely, subject to the following restrictions:

   1\. The origin of this source code must not be misrepresented; you must not
      claim that you wrote the original source code. If you use this source code
      in a product, an acknowledgment in the product documentation would be
      appreciated but is not required.

   2\. Altered source versions must be plainly marked as such, and must not be
      misrepresented as being the original source code.

   3\. This notice may not be removed or altered from any source distribution.

   René Nyffenegger rene.nyffenegger@adp-gmbh.ch

*/

#include "base64.h"
#include <iostream>

static const std::string base64_chars = 
             "ABCDEFGHIJKLMNOPQRSTUVWXYZ"
             "abcdefghijklmnopqrstuvwxyz"
             "0123456789+/";

static inline bool is_base64(unsigned char c) {
  return (isalnum(c) || (c == '+') || (c == '/'));
}

std::string base64_encode(unsigned char const* bytes_to_encode, unsigned int in_len) {
  std::string ret;
  int i = 0;
  int j = 0;
  unsigned char char_array_3[3];
  unsigned char char_array_4[4];

  while (in_len--) {
    char_array_3[i++] = *(bytes_to_encode++);
    if (i == 3) {
      char_array_4[0] = (char_array_3[0] & 0xfc) >> 2;
      char_array_4[1] = ((char_array_3[0] & 0x03) << 4) + ((char_array_3[1] & 0xf0) >> 4);
      char_array_4[2] = ((char_array_3[1] & 0x0f) << 2) + ((char_array_3[2] & 0xc0) >> 6);
      char_array_4[3] = char_array_3[2] & 0x3f;

      for(i = 0; (i <4) ; i++)
        ret += base64_chars[char_array_4[i]];
      i = 0;
    }
  }

  if (i)
  {
    for(j = i; j < 3; j++)
      char_array_3[j] = '\0';

    char_array_4[0] = (char_array_3[0] & 0xfc) >> 2;
    char_array_4[1] = ((char_array_3[0] & 0x03) << 4) + ((char_array_3[1] & 0xf0) >> 4);
    char_array_4[2] = ((char_array_3[1] & 0x0f) << 2) + ((char_array_3[2] & 0xc0) >> 6);
    char_array_4[3] = char_array_3[2] & 0x3f;

    for (j = 0; (j < i + 1); j++)
      ret += base64_chars[char_array_4[j]];

    while((i++ < 3))
      ret += '=';

  }

  return ret;

}

std::string base64_decode(std::string const& encoded_string) {
  int in_len = encoded_string.size();
  int i = 0;
  int j = 0;
  int in_ = 0;
  unsigned char char_array_4[4], char_array_3[3];
  std::string ret;

  while (in_len-- && ( encoded_string[in_] != '=') && is_base64(encoded_string[in_])) {
    char_array_4[i++] = encoded_string[in_]; in_++;
    if (i ==4) {
      for (i = 0; i <4; i++)
        char_array_4[i] = base64_chars.find(char_array_4[i]);

      char_array_3[0] = (char_array_4[0] << 2) + ((char_array_4[1] & 0x30) >> 4);
      char_array_3[1] = ((char_array_4[1] & 0xf) << 4) + ((char_array_4[2] & 0x3c) >> 2);
      char_array_3[2] = ((char_array_4[2] & 0x3) << 6) + char_array_4[3];

      for (i = 0; (i < 3); i++)
        ret += char_array_3[i];
      i = 0;
    }
  }

  if (i) {
    for (j = i; j <4; j++)
      char_array_4[j] = 0;

    for (j = 0; j <4; j++)
      char_array_4[j] = base64_chars.find(char_array_4[j]);

    char_array_3[0] = (char_array_4[0] << 2) + ((char_array_4[1] & 0x30) >> 4);
    char_array_3[1] = ((char_array_4[1] & 0xf) << 4) + ((char_array_4[2] & 0x3c) >> 2);
    char_array_3[2] = ((char_array_4[2] & 0x3) << 6) + char_array_4[3];

    for (j = 0; (j < i - 1); j++) ret += char_array_3[j];
  }

  return ret;
} 
```

**base64.h**

```
#include <string>

std::string base64_encode(unsigned char const* , unsigned int len);
std::string base64_decode(std::string const& s); 
```

**用法**

```
const std::string s = "test";
std::string encoded = base64_encode(reinterpret_cast<const unsigned char*>(s.c_str()), s.length());
  std::string decoded = base64_decode(encoded); 
```

* * *

## 回答 #8

> 赞同：15
> 
> 时间：2008-12-05T02:37:53.710

[GNU coreutils](http://www.gnu.org/software/coreutils/)在 lib/base64 中有它。它有点臃肿，但处理像 EBCDIC 这样的东西。你也可以自己玩，例如，

```
char base64_digit (n) unsigned n; {
  if (n < 10) return n - '0';
  else if (n < 10 + 26) return n - 'a';
  else if (n < 10 + 26 + 26) return n - 'A';
  else assert(0);
  return 0;
}

unsigned char base64_decode_digit(char c) {
  switch (c) {
    case '=' : return 62;
    case '.' : return 63;
    default  :
      if (isdigit(c)) return c - '0';
      else if (islower(c)) return c - 'a' + 10;
      else if (isupper(c)) return c - 'A' + 10 + 26;
      else assert(0);
  }
  return 0xff;
}

unsigned base64_decode(char *s) {
  char *p;
  unsigned n = 0;

  for (p = s; *p; p++)
    n = 64 * n + base64_decode_digit(*p);

  return n;
} 
```

通过这些礼物了解所有人，您不应该将“独自玩耍”与“实施标准”混为一谈。是的。

* * *

## 回答 #9

> 赞同：9
> 
> 时间：2009-01-08T23:31:19.340

这是我多年来一直使用的解码器...

```
 static const char  table[] = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
    static const int   BASE64_INPUT_SIZE = 57;

    BOOL isbase64(char c)
    {
       return c && strchr(table, c) != NULL;
    }

    inline char value(char c)
    {
       const char *p = strchr(table, c);
       if(p) {
          return p-table;
       } else {
          return 0;
       }
    }

    int UnBase64(unsigned char *dest, const unsigned char *src, int srclen)
    {
       *dest = 0;
       if(*src == 0) 
       {
          return 0;
       }
       unsigned char *p = dest;
       do
       {

          char a = value(src[0]);
          char b = value(src[1]);
          char c = value(src[2]);
          char d = value(src[3]);
          *p++ = (a << 2) | (b >> 4);
          *p++ = (b << 4) | (c >> 2);
          *p++ = (c << 6) | d;
          if(!isbase64(src[1])) 
          {
             p -= 2;
             break;
          } 
          else if(!isbase64(src[2])) 
          {
             p -= 2;
             break;
          } 
          else if(!isbase64(src[3])) 
          {
             p--;
             break;
          }
          src += 4;
          while(*src && (*src == 13 || *src == 10)) src++;
       }
       while(srclen-= 4);
       *p = 0;
       return p-dest;
    } 
```

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2020-03-07T18:49:15.633

和[函数](https://www.openssl.org/docs/man1.0.2/man3/EVP_EncodeBlock.html)使它变得非常简单[`EVP_EncodeBlock`：`EVP_DecodeBlock`](https://www.openssl.org/docs/man1.0.2/man3/EVP_EncodeBlock.html)

```
#include <stdio.h>
#include <stdlib.h>
#include <openssl/evp.h>

char *base64(const unsigned char *input, int length) {
  const int pl = 4*((length+2)/3);
  char *output = calloc(pl+1, 1); //+1 for the terminating null that EVP_EncodeBlock adds on
  const int ol = EVP_EncodeBlock(output, input, length);
  if (ol != pl) { fprintf(stderr, "Whoops, encode predicted %d but we got %d\n", pl, ol); }
  return output;
}

unsigned char *decode64(const char *input, int length) {
  const int pl = 3*length/4;
  unsigned char *output = calloc(pl+1, 1);
  const int ol = EVP_DecodeBlock(output, input, length);
  if (pl != ol) { fprintf(stderr, "Whoops, decode predicted %d but we got %d\n", pl, ol); }
  return output;
} 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2011-01-21T20:46:34.180

我写了一个用于 C++ 的，它非常快，适用于流，免费且开源：

[https://tmplusplus.svn.sourceforge.net/svnroot/tmplusplus/trunk/src/](https://tmplusplus.svn.sourceforge.net/svnroot/tmplusplus/trunk/src/)

如果它符合您的目的，请随意使用它。

**编辑：按要求添加内联代码。**

性能提升是通过使用查找表进行编码和解码来实现的。在大多数操作系统上`_UINT8`都是一个。`unsigned char`

```
/** Static Base64 character encoding lookup table */
const char CBase64::encodeCharacterTable[65] = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";

/** Static Base64 character decoding lookup table */
const char CBase64::decodeCharacterTable[256] = {
    -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1
    ,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21
    ,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1,
    -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
    -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1
    ,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,
    -1,-1,-1}; 

/*!
\brief Encodes binary data to base 64 character data
\param in The data to encode
\param out The encoded data as characters
*/
void CBase64::Encode(std::istream &in, std::ostringstream &out)
{
    char buff1[3];
    char buff2[4];
    _UINT8 i=0, j;
    while(in.readsome(&buff1[i++], 1))
        if (i==3)
        {
            out << encodeCharacterTable[(buff1[0] & 0xfc) >> 2];
            out << encodeCharacterTable[((buff1[0] & 0x03) << 4) + ((buff1[1] & 0xf0) >> 4)];
            out << encodeCharacterTable[((buff1[1] & 0x0f) << 2) + ((buff1[2] & 0xc0) >> 6)];
            out << encodeCharacterTable[buff1[2] & 0x3f];
            i=0;
        }

    if (--i)
    {
        for(j=i;j<3;j++) buff1[j] = '\0';

        buff2[0] = (buff1[0] & 0xfc) >> 2;
        buff2[1] = ((buff1[0] & 0x03) << 4) + ((buff1[1] & 0xf0) >> 4);
        buff2[2] = ((buff1[1] & 0x0f) << 2) + ((buff1[2] & 0xc0) >> 6);
        buff2[3] = buff1[2] & 0x3f;

        for (j=0;j<(i+1);j++) out << encodeCharacterTable[buff2[j]];

        while(i++<3) out << '=';
    }

}

/*!
\brief Decodes base 64 character data to binary data
\param in The character data to decode
\param out The decoded data
*/
void CBase64::Decode(std::istringstream &in, std::ostream &out)
{
    char buff1[4];
    char buff2[4];
    _UINT8 i=0, j;

    while(in.readsome(&buff2[i], 1) && buff2[i] != '=')
    {
        if (++i==4)
        {
            for (i=0;i!=4;i++)
                buff2[i] = decodeCharacterTable[buff2[i]];

            out << (char)((buff2[0] << 2) + ((buff2[1] & 0x30) >> 4));
            out << (char)(((buff2[1] & 0xf) << 4) + ((buff2[2] & 0x3c) >> 2));
            out << (char)(((buff2[2] & 0x3) << 6) + buff2[3]);

            i=0;
        }
    }

    if (i) 
    {
        for (j=i;j<4;j++) buff2[j] = '\0';
        for (j=0;j<4;j++) buff2[j] = decodeCharacterTable[buff2[j]];

        buff1[0] = (buff2[0] << 2) + ((buff2[1] & 0x30) >> 4);
        buff1[1] = ((buff2[1] & 0xf) << 4) + ((buff2[2] & 0x3c) >> 2);
        buff1[2] = ((buff2[2] & 0x3) << 6) + buff2[3];

        for (j=0;j<(i-1); j++) out << (char)buff1[j];
    }
} 
```

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2014-01-16T09:48:52.643

如果人们需要 c++ 解决方案，我将这个 OpenSSL 解决方案放在一起（用于编码和解码）。您需要链接“加密”库（即 OpenSSL）。这已经用 valgrind 检查了泄漏（尽管您可以添加一些额外的错误检查代码以使其更好一些 - 我知道至少 write 函数应该检查返回值）。

```
#include <openssl/bio.h>
#include <openssl/evp.h>
#include <stdlib.h>

string base64_encode( const string &str ){

    BIO *base64_filter = BIO_new( BIO_f_base64() );
    BIO_set_flags( base64_filter, BIO_FLAGS_BASE64_NO_NL );

    BIO *bio = BIO_new( BIO_s_mem() );
    BIO_set_flags( bio, BIO_FLAGS_BASE64_NO_NL );

    bio = BIO_push( base64_filter, bio );

    BIO_write( bio, str.c_str(), str.length() );

    BIO_flush( bio );

    char *new_data;

    long bytes_written = BIO_get_mem_data( bio, &new_data );

    string result( new_data, bytes_written );
    BIO_free_all( bio );

    return result;

}

string base64_decode( const string &str ){

    BIO *bio, *base64_filter, *bio_out;
    char inbuf[512];
    int inlen;
    base64_filter = BIO_new( BIO_f_base64() );
    BIO_set_flags( base64_filter, BIO_FLAGS_BASE64_NO_NL );

    bio = BIO_new_mem_buf( (void*)str.c_str(), str.length() );

    bio = BIO_push( base64_filter, bio );

    bio_out = BIO_new( BIO_s_mem() );

    while( (inlen = BIO_read(bio, inbuf, 512)) > 0 ){
        BIO_write( bio_out, inbuf, inlen );
    }

    BIO_flush( bio_out );

    char *new_data;
    long bytes_written = BIO_get_mem_data( bio_out, &new_data );

    string result( new_data, bytes_written );

    BIO_free_all( bio );
    BIO_free_all( bio_out );

    return result;

} 
```

* * *

## 回答 #13

> 赞同：4
> 
> 时间：2018-02-16T00:44:38.713

ryyst（得票最多）对代码的小改进是不使用动态分配的解码表，而是使用静态 const 预计算表。这消除了指针的使用和表的初始化，并且还避免了如果忘记使用 base64_cleanup() 清理解码表的内存泄漏（顺便说一下，在 base64_cleanup() 中，调用 free(decoding_table) 后，应该有decode_table=NULL，否则在 base64_cleanup() 之后意外调用 base64_decode 会崩溃或导致未确定的行为）。另一种解决方案可能是使用 std::unique_ptr ......但我很满意只是在堆栈上有 const char[256] 并避免一起使用指针 - 这样代码看起来更简洁更短。

解码表计算如下：

```
const char encoding_table[] = { 
    'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',
    'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
    'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',
    'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
    'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',
    'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
    'w', 'x', 'y', 'z', '0', '1', '2', '3',
    '4', '5', '6', '7', '8', '9', '+', '/' };

unsigned char decoding_table[256];

for (int i = 0; i < 256; i++)
    decoding_table[i] = '\0';

for (int i = 0; i < 64; i++)
    decoding_table[(unsigned char)encoding_table[i]] = i;

for (int i = 0; i < 256; i++)
    cout << "0x" << (int(decoding_table[i]) < 16 ? "0" : "") << hex << int(decoding_table[i]) << (i != 255 ? "," : "") << ((i+1) % 16 == 0 ? '\n' : '\0');

cin.ignore(); 
```

我正在使用的修改后的代码是：

```
 static const char encoding_table[] = { 
            'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',
            'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
            'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',
            'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
            'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',
            'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
            'w', 'x', 'y', 'z', '0', '1', '2', '3',
            '4', '5', '6', '7', '8', '9', '+', '/' };

        static const unsigned char decoding_table[256] = {
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00, 0x3f,
            0x34, 0x35, 0x36, 0x37, 0x38, 0x39, 0x3a, 0x3b, 0x3c, 0x3d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0a, 0x0b, 0x0c, 0x0d, 0x0e,
            0x0f, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x1a, 0x1b, 0x1c, 0x1d, 0x1e, 0x1f, 0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27, 0x28,
            0x29, 0x2a, 0x2b, 0x2c, 0x2d, 0x2e, 0x2f, 0x30, 0x31, 0x32, 0x33, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
            0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

        char* base64_encode(const unsigned char *data, size_t input_length, size_t &output_length) {

            const int mod_table[] = { 0, 2, 1 };

            output_length = 4 * ((input_length + 2) / 3);

            char *encoded_data = (char*)malloc(output_length);

            if (encoded_data == nullptr)
                return nullptr;

            for (int i = 0, j = 0; i < input_length;) {

                uint32_t octet_a = i < input_length ? (unsigned char)data[i++] : 0;
                uint32_t octet_b = i < input_length ? (unsigned char)data[i++] : 0;
                uint32_t octet_c = i < input_length ? (unsigned char)data[i++] : 0;

                uint32_t triple = (octet_a << 0x10) + (octet_b << 0x08) + octet_c;

                encoded_data[j++] = encoding_table[(triple >> 3 * 6) & 0x3F];
                encoded_data[j++] = encoding_table[(triple >> 2 * 6) & 0x3F];
                encoded_data[j++] = encoding_table[(triple >> 1 * 6) & 0x3F];
                encoded_data[j++] = encoding_table[(triple >> 0 * 6) & 0x3F];

            }

            for (int i = 0; i < mod_table[input_length % 3]; i++)
                encoded_data[output_length - 1 - i] = '=';

            return encoded_data;

        };

        unsigned char* base64_decode(const char *data, size_t input_length, size_t &output_length) {        

            if (input_length % 4 != 0)
                return nullptr;

            output_length = input_length / 4 * 3;

            if (data[input_length - 1] == '=') (output_length)--;
            if (data[input_length - 2] == '=') (output_length)--;

            unsigned char* decoded_data = (unsigned char*)malloc(output_length);

            if (decoded_data == nullptr)
                return nullptr;

            for (int i = 0, j = 0; i < input_length;) {

                uint32_t sextet_a = data[i] == '=' ? 0 & i++ : decoding_table[data[i++]];
                uint32_t sextet_b = data[i] == '=' ? 0 & i++ : decoding_table[data[i++]];
                uint32_t sextet_c = data[i] == '=' ? 0 & i++ : decoding_table[data[i++]];
                uint32_t sextet_d = data[i] == '=' ? 0 & i++ : decoding_table[data[i++]];

                uint32_t triple = (sextet_a << 3 * 6)
                    + (sextet_b << 2 * 6)
                    + (sextet_c << 1 * 6)
                    + (sextet_d << 0 * 6);

                if (j < output_length) decoded_data[j++] = (triple >> 2 * 8) & 0xFF;
                if (j < output_length) decoded_data[j++] = (triple >> 1 * 8) & 0xFF;
                if (j < output_length) decoded_data[j++] = (triple >> 0 * 8) & 0xFF;

            }

            return decoded_data;

        }; 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2019-09-01T06:48:17.913

这是一个专门编写的解码器，通过直接写入 putchar 函数来避免需要缓冲区。这是基于 wikibook 的实现[https://en.wikibooks.org/wiki/Algorithm_Implementation/Miscellaneous/Base64#C](https://en.wikibooks.org/wiki/Algorithm_Implementation/Miscellaneous/Base64#C)

这不像上面的其他选项那样容易使用。但是，它可以在嵌入式系统中使用，您想要转储一个大文件而不分配另一个大缓冲区来存储生成的 base64 datauri 字符串。（很遗憾 datauri 不允许您指定文件名）。

```
void datauriBase64EncodeBufferless(int (*putchar_fcptr)(int), const char* type_strptr, const void* data_buf, const size_t dataLength)
{
  const char base64chars[] = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";
  const uint8_t *data = (const uint8_t *)data_buf;
  size_t x = 0;
  uint32_t n = 0;
  int padCount = dataLength % 3;
  uint8_t n0, n1, n2, n3;

  size_t outcount = 0;
  size_t line = 0;

  putchar_fcptr((int)'d');
  putchar_fcptr((int)'a');
  putchar_fcptr((int)'t');
  putchar_fcptr((int)'a');
  putchar_fcptr((int)':');
  outcount += 5;

  while (*type_strptr != '\0')
  {
    putchar_fcptr((int)*type_strptr);
    type_strptr++;
    outcount++;
  }

  putchar_fcptr((int)';');
  putchar_fcptr((int)'b');
  putchar_fcptr((int)'a');
  putchar_fcptr((int)'s');
  putchar_fcptr((int)'e');
  putchar_fcptr((int)'6');
  putchar_fcptr((int)'4');
  putchar_fcptr((int)',');
  outcount += 8;

  /* increment over the length of the string, three characters at a time */
  for (x = 0; x < dataLength; x += 3)
  {
    /* these three 8-bit (ASCII) characters become one 24-bit number */
    n = ((uint32_t)data[x]) << 16; //parenthesis needed, compiler depending on flags can do the shifting before conversion to uint32_t, resulting to 0

    if((x+1) < dataLength)
       n += ((uint32_t)data[x+1]) << 8;//parenthesis needed, compiler depending on flags can do the shifting before conversion to uint32_t, resulting to 0

    if((x+2) < dataLength)
       n += data[x+2];

    /* this 24-bit number gets separated into four 6-bit numbers */
    n0 = (uint8_t)(n >> 18) & 63;
    n1 = (uint8_t)(n >> 12) & 63;
    n2 = (uint8_t)(n >> 6) & 63;
    n3 = (uint8_t)n & 63;

    /*
     * if we have one byte available, then its encoding is spread
     * out over two characters
     */

    putchar_fcptr((int)base64chars[n0]);
    putchar_fcptr((int)base64chars[n1]);
    outcount += 2;

    /*
     * if we have only two bytes available, then their encoding is
     * spread out over three chars
     */
    if((x+1) < dataLength)
    {
      putchar_fcptr((int)base64chars[n2]);
      outcount += 1;
    }

    /*
     * if we have all three bytes available, then their encoding is spread
     * out over four characters
     */
    if((x+2) < dataLength)
    {
      putchar_fcptr((int)base64chars[n3]);
      outcount += 1;
    }

    /* Breaking up the line so it's easier to copy and paste */
    int curr_line = (outcount/80);
    if( curr_line != line )
    {
      line = curr_line;
      putchar_fcptr((int)'\r');
      putchar_fcptr((int)'\n');
    }
  }

  /*
  * create and add padding that is required if we did not have a multiple of 3
  * number of characters available
  */
  if (padCount > 0)
  {
    for (; padCount < 3; padCount++)
    {
      putchar_fcptr((int)'=');
    }
  }

  putchar_fcptr((int)'\r');
  putchar_fcptr((int)'\n');
} 
```

这是测试

```
#include <stdio.h>
#include <stdint.h>
#include <string.h>

int main(void)
{
  char str[] = "test";
  datauriBase64EncodeBufferless(putchar, "text/plain;charset=utf-8", str, strlen(str));
  return 0;
} 
```

预期输出：`data:text/plain;charset=utf-8;base64,dGVzdA==`

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2020-12-07T01:58:12.783

如果你想找到一个可行的 C 解决方案，我相信你需要[这个](https://github.com/littlstar/b64.c).
[https://github.com/littlstar/b64.c](https://github.com/littlstar/b64.c)

```
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include "b64.h"

int
main (void) {
  unsigned char *str = "brian the monkey and bradley the kinkajou are friends";
  char *enc = b64_encode(str, strlen(str));

  printf("%s\n", enc); // YnJpYW4gdGhlIG1vbmtleSBhbmQgYnJhZGxleSB0aGUga2lua2Fqb3UgYXJlIGZyaWVuZHM=

  char *dec = b64_decode(enc, strlen(enc));

  printf("%s\n", dec); // brian the monkey and bradley the kinkajou are friends
  free(enc);
  free(dec);
  return 0;
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2020-11-16T10:40:57.067

我修复了@ryyst 答案的错误，这是一个 url 安全版本：

```
 #include <stdio.h>
#include <stdint.h>
#include <stdlib.h>
#include <string.h>

static char encoding_table[] = {'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H',
                                'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P',
                                'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X',
                                'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f',
                                'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n',
                                'o', 'p', 'q', 'r', 's', 't', 'u', 'v',
                                'w', 'x', 'y', 'z', '0', '1', '2', '3',
                                '4', '5', '6', '7', '8', '9', '-', '_'};
static char *decoding_table = NULL;
static int mod_table[] = {0, 2, 1};

void build_decoding_table() {

    decoding_table = malloc(256);

    for (int i = 0; i < 64; i++)
        decoding_table[(unsigned char) encoding_table[i]] = i;
}

void base64_cleanup() {
    free(decoding_table);
} 

char *base64_encode(const char *data,
                    size_t input_length,
                    size_t *output_length) {

    *output_length = 4 * ((input_length + 2) / 3);

    char *encoded_data = malloc(*output_length);
    if (encoded_data == NULL) return NULL;

    for (int i = 0, j = 0; i < input_length;) {

        uint32_t octet_a = i < input_length ? (unsigned char)data[i++] : 0;
        uint32_t octet_b = i < input_length ? (unsigned char)data[i++] : 0;
        uint32_t octet_c = i < input_length ? (unsigned char)data[i++] : 0;

        uint32_t triple = (octet_a << 0x10) + (octet_b << 0x08) + octet_c;

        encoded_data[j++] = encoding_table[(triple >> 3 * 6) & 0x3F];
        encoded_data[j++] = encoding_table[(triple >> 2 * 6) & 0x3F];
        encoded_data[j++] = encoding_table[(triple >> 1 * 6) & 0x3F];
        encoded_data[j++] = encoding_table[(triple >> 0 * 6) & 0x3F];
    }

    //int i=0;
    for (int i = 0; i < mod_table[input_length % 3]; i++)
        encoded_data[*output_length - 1 - i] = '=';

    *output_length  = *output_length -2 + mod_table[input_length % 3];
    encoded_data[*output_length] =0;

    return encoded_data;
}

unsigned char *base64_decode(const char *data,
                             size_t input_length,
                             size_t *output_length) {

    if (decoding_table == NULL) build_decoding_table();

    if (input_length % 4 != 0) return NULL;

    *output_length = input_length / 4 * 3;
    if (data[input_length - 1] == '=') (*output_length)--;
    if (data[input_length - 2] == '=') (*output_length)--;

    unsigned char *decoded_data = malloc(*output_length);
    if (decoded_data == NULL) return NULL;

    for (int i = 0, j = 0; i < input_length;) {

        uint32_t sextet_a = data[i] == '=' ? 0 & i++ : decoding_table[data[i++]];
        uint32_t sextet_b = data[i] == '=' ? 0 & i++ : decoding_table[data[i++]];
        uint32_t sextet_c = data[i] == '=' ? 0 & i++ : decoding_table[data[i++]];
        uint32_t sextet_d = data[i] == '=' ? 0 & i++ : decoding_table[data[i++]];

        uint32_t triple = (sextet_a << 3 * 6)
        + (sextet_b << 2 * 6)
        + (sextet_c << 1 * 6)
        + (sextet_d << 0 * 6);

        if (j < *output_length) decoded_data[j++] = (triple >> 2 * 8) & 0xFF;
        if (j < *output_length) decoded_data[j++] = (triple >> 1 * 8) & 0xFF;
        if (j < *output_length) decoded_data[j++] = (triple >> 0 * 8) & 0xFF;
    }

    return decoded_data;
}

int main(){

    const char * data = "Hello World! 您好！世界！";
    size_t input_size = strlen(data);
    printf("Input size: %ld \n",input_size);
    char * encoded_data = base64_encode(data, input_size, &input_size);
    printf("After size: %ld \n",input_size);
    printf("Encoded Data is: %s \n",encoded_data);

    size_t decode_size = strlen(encoded_data);
    printf("Output size: %ld \n",decode_size);
    unsigned char * decoded_data = base64_decode(encoded_data, decode_size, &decode_size);
    printf("After size: %ld \n",decode_size);
    printf("Decoded Data is: %s \n",decoded_data);
    return 0;
} 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2022-01-26T01:30:43.287

根据 GaspardP 的回答，这里是 Jouni Malinen 的 C 编码器的简化版本，我为我正在参与的项目制作：

```
/* Character list for url-safe base64 encoding */
//char cl[]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";

/* Character list for url-unsafe base64 encoding */
char cl[]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";

/**
 * @brief Encodes s_in into base64 and writes it to s_out.
 *    @param s_in  Pointer to input buffer.
 *    @param s_out Pointer to output buffer.
 * @return Pointer to end of output buffer
 * @usage b64e("ABC",buf);
 */
char *b64e(char *s_in, char *s_out){
   int i=0;
   if (s_in[i]==0) return s_out;
   if (s_in[i+1]==0 || s_in[i+2]==0) {
      *s_out++= b64_cl[ s_in[i] >> 2 ];
      if (s_in[i+1]==0) {
         *s_out++ = b64_cl[ ( ( s_in[i]   & 0b000011 ) << 4 ) ];
      } else
      if (s_in[i+2]==0) {
         *s_out++ = b64_cl[ ( ( s_in[i]   & 0b000011 ) << 4 ) + ( ( s_in[i+1] >> 4 ) & 0b001111 ) ];
         *s_out++ = b64_cl[ ( ( s_in[i+1] & 0b001111 ) << 2 ) ];
      }
      return s_out;
   }
   *s_out++ = b64_cl[    s_in[i] >> 2 ];
   *s_out++ = b64_cl[ ( (s_in[i]   & 0b000011 ) << 4 ) + ( (s_in[i+1] >> 4) & 0b001111 ) ];
   *s_out++ = b64_cl[ ( (s_in[i+1] & 0b001111 ) << 2 ) + ( (s_in[i+2] >> 6) & 0b000011 ) ];
   *s_out++ = b64_cl[ (  s_in[i+2] & 0b111111 ) ];
   return b64e( s_in+3, s_out );
} 
```

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2015-12-10T11:51:17.987

该解决方案基于 schulwitz 答案（使用 OpenSSL 进行编码/解码），但它适用于 C++（好吧，最初的问题是关于 C，但这里已经有另一个 C++ 答案）并且它使用错误检查（因此使用起来更安全） ：

```
#include <openssl/bio.h>

std::string base64_encode(const std::string &input)
{
    BIO *p_bio_b64 = nullptr;
    BIO *p_bio_mem = nullptr;

    try
    {
        // make chain: p_bio_b64 <--> p_bio_mem
        p_bio_b64 = BIO_new(BIO_f_base64());
        if (!p_bio_b64) { throw std::runtime_error("BIO_new failed"); }
        BIO_set_flags(p_bio_b64, BIO_FLAGS_BASE64_NO_NL); //No newlines every 64 characters or less

        p_bio_mem = BIO_new(BIO_s_mem());
        if (!p_bio_mem) { throw std::runtime_error("BIO_new failed"); }
        BIO_push(p_bio_b64, p_bio_mem);

        // write input to chain
        // write sequence: input -->> p_bio_b64 -->> p_bio_mem
        if (BIO_write(p_bio_b64, input.c_str(), input.size()) <= 0)
            { throw std::runtime_error("BIO_write failed"); }

        if (BIO_flush(p_bio_b64) <= 0)
            { throw std::runtime_error("BIO_flush failed"); }

        // get result
        char *p_encoded_data = nullptr;
        auto  encoded_len    = BIO_get_mem_data(p_bio_mem, &p_encoded_data);
        if (!p_encoded_data) { throw std::runtime_error("BIO_get_mem_data failed"); }

        std::string result(p_encoded_data, encoded_len);

        // clean
        BIO_free_all(p_bio_b64);

        return result;
    }
    catch (...)
    {
        if (p_bio_b64) { BIO_free_all(p_bio_b64); }
        throw;
    }
}

std::string base64_decode(const std::string &input)
{
    BIO *p_bio_mem = nullptr;
    BIO *p_bio_b64 = nullptr;

    try
    {
        // make chain: p_bio_b64 <--> p_bio_mem
        p_bio_b64 = BIO_new(BIO_f_base64());
        if (!p_bio_b64) { throw std::runtime_error("BIO_new failed"); }
        BIO_set_flags(p_bio_b64, BIO_FLAGS_BASE64_NO_NL); //Don't require trailing newlines

        p_bio_mem = BIO_new_mem_buf((void*)input.c_str(), input.length());
        if (!p_bio_mem) { throw std::runtime_error("BIO_new failed"); }
        BIO_push(p_bio_b64, p_bio_mem);

        // read result from chain
        // read sequence (reverse to write): buf <<-- p_bio_b64 <<-- p_bio_mem
        std::vector<char> buf((input.size()*3/4)+1);
        std::string result;
        for (;;)
        {
            auto nread = BIO_read(p_bio_b64, buf.data(), buf.size());
            if (nread  < 0) { throw std::runtime_error("BIO_read failed"); }
            if (nread == 0) { break; } // eof

            result.append(buf.data(), nread);
        }

        // clean
        BIO_free_all(p_bio_b64);

        return result;
    }
    catch (...)
    {
        if (p_bio_b64) { BIO_free_all(p_bio_b64); }
        throw;
    }
} 
```

请注意，如果输入的 base64 序列不正确，则 base64_decode 返回空字符串（openssl 以这种方式工作）。

* * *

## 回答 #19

> 赞同：-2
> 
> 时间：2013-07-29T11:42:18.193

这是已接受答案的编码器的优化版本，它还支持 MIME 和其他协议的换行（类似的优化可以应用于解码器）：

```
 char *base64_encode(const unsigned char *data,
                    size_t input_length,
                    size_t *output_length,
                    bool addLineBreaks)

    *output_length = 4 * ((input_length + 2) / 3);
    if (addLineBreaks) *output_length += *output_length / 38; //  CRLF after each 76 chars

    char *encoded_data = malloc(*output_length);
    if (encoded_data == NULL) return NULL;

    UInt32 octet_a;
    UInt32 octet_b;
    UInt32 octet_c;
    UInt32 triple;
    int lineCount = 0;
    int sizeMod = size - (size % 3); // check if there is a partial triplet
    // adding all octet triplets, before partial last triplet
    for (; offset < sizeMod; ) 
    {
        octet_a = data[offset++];
        octet_b = data[offset++];
        octet_c = data[offset++];

        triple = (octet_a << 0x10) + (octet_b << 0x08) + octet_c;

        encoded_data[mBufferPos++] = encoding_table[(triple >> 3 * 6) & 0x3F];
        encoded_data[mBufferPos++] = encoding_table[(triple >> 2 * 6) & 0x3F];
        encoded_data[mBufferPos++] = encoding_table[(triple >> 1 * 6) & 0x3F];
        encoded_data[mBufferPos++] = encoding_table[(triple >> 0 * 6) & 0x3F];
        if (addLineBreaks)
        {
            if (++lineCount == 19)
            {
                encoded_data[mBufferPos++] = 13;
                encoded_data[mBufferPos++] = 10;
                lineCount = 0;
            }
        }
    }

    // last bytes
    if (sizeMod < size)
    {
        octet_a = data[offset++]; // first octect always added
        octet_b = offset < size ? data[offset++] : (UInt32)0; // conditional 2nd octet
        octet_c = (UInt32)0; // last character is definitely padded

        triple = (octet_a << 0x10) + (octet_b << 0x08) + octet_c;

        encoded_data[mBufferPos++] = encoding_table[(triple >> 3 * 6) & 0x3F];
        encoded_data[mBufferPos++] = encoding_table[(triple >> 2 * 6) & 0x3F];
        encoded_data[mBufferPos++] = encoding_table[(triple >> 1 * 6) & 0x3F];
        encoded_data[mBufferPos++] = encoding_table[(triple >> 0 * 6) & 0x3F];

        // add padding '='
        sizeMod = size % 3; 
        // last character is definitely padded
        encoded_data[mBufferPos - 1] = (byte)'=';
        if (sizeMod == 1) encoded_data[mBufferPos - 2] = (byte)'=';
    }
 } 
```

# javascript - 将 URL 值缩短为 Javascript 变量

> ID：342410
> 
> 赞同：1
> 
> 时间：2008-12-04T23:09:01.683
> 
> 标签：javascript, jquery, regex, treeview

我正在使用[jQuery](http://jquery.com/) [Treeview](http://bassistance.de/jquery-plugins/jquery-plugin-treeview/)插件在具有嵌套类别级别的站点上进行导航。在每个类别中都有产品，每个产品都有一个或多个信息类型。

所以我的网址可以是：

1.  foo.com/view/cat_id/
2.  foo.com/view/cat_id/prod_id/
3.  foo.com/view/cat_id/prod_id/info_id/

麻烦的是，产品的导航与类别分开，这意味着 Treeview 仅“知道”（因此标记为“活动”）案例 1。案例 2 和 3 意味着树已折叠，而我希望树在所有情况下都对 cat_id 开放。

（我对任何事情都持开放态度，但是）我认为解决方案是一些 Javascript 技巧，可以从 URL 中删除 cat_id/ 之后的任何内容，以便我可以将结果传递给 Treeview，但不是我可以使用 Javascript不知道该怎么做。

注意：我正在寻求有关 Javascript 正则表达式的帮助，而不是 Treeview，尽管如果有人知道现成的解决方案，我当然会全神贯注。

TIA。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T04:48:24.260

在朋友的帮助下（感谢 Sawks），我将给出我自己问题的答案，以防其他人发现自己在同一条船上。

我将 jquery.treeview.js 中从 206 开始的行更改为：

```
case "location":
    var current = this.find("a").filter(function() { return this.href.toLowerCase() == location.href.toLowerCase(); });
    if ( current.length ) {
        current.addClass("selected").parents("ul, li").add( current.next() ).show();
    }
    break;
} 
```

到：

```
case "location":
    var current_location = location.href.toLowerCase();
    var current_base = current_location.split('/').slice(0,5).join('/')+'/';
    var current = this.find("a").filter(function() { return this.href.toLowerCase() == current_base; });
    if ( current.length ) {
        current.addClass("selected").parents("ul, li").add( current.next() ).show();
    }
    break;
} 
```

# wpf - wpf列表框将单个项目更改为粗体

> ID：342411
> 
> 赞同：5
> 
> 时间：2008-12-04T23:09:15.363
> 
> 标签：wpf, text, listbox, templates, bold

我希望根据要放入列表框中的对象的属性，将某些项目变为粗体。

我认为您可以通过更改模板来做到这一点，但似乎找不到示例。

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-04T23:39:05.477

您可以使用 DataTriggers 执行此操作。有关使用 DataTrigger 的简单示例，您可以查看[http://manicprogrammer.com/cs/blogs/willeke/archive/2007/04/25/datatriggers-are-very-cool.aspx](http://manicprogrammer.com/cs/blogs/willeke/archive/2007/04/25/datatriggers-are-very-cool.aspx)

这是一个使用 ListView 的示例，但同样的事情也适用于 Listbox。

```
<ListView x:Name="Notes" Margin="4,4,4,4" 
   ItemsSource="{Binding Path=CurrentCustomer.CustomerNotes}"
   ItemTemplate="{DynamicResource CustomerNotesDataTemplate}" 
   Style="{DynamicResource ListViewStyle1}" /> 
```

然后 ItemTemplate 在我的窗口资源中：

```
 <DataTemplate x:Key="CustomerNotesDataTemplate">
            <Grid MinWidth="400" Style="{DynamicResource NotesRowTriggers}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="74"/>
                    <ColumnDefinition Width="400"/>
                    <ColumnDefinition Width="125"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock HorizontalAlignment="Stretch" VerticalAlignment="Top" Text="{Binding Path=NoteDate, Converter={StaticResource ShortDateConverter}}" Margin="0,0,4,0" />
                <TextBlock Text="{Binding Path=FreeNote}" Grid.Column="1" HorizontalAlignment="Stretch" Margin="4,0,0,0" Grid.ColumnSpan="1" TextWrapping="Wrap" />
                <TextBlock HorizontalAlignment="Left" VerticalAlignment="Top" Text="{Binding Path=NoteUser}" Grid.Column="2" Width="110" d:LayoutOverrides="Width" Margin="4,0,0,0" Grid.ColumnSpan="1" />
                <CheckBox HorizontalAlignment="Left" IsChecked="{Binding Path=Highlight}" VerticalAlignment="Top" Content="Important" Grid.Column="3" Margin="4,0,4,0"/>
                <CheckBox HorizontalAlignment="Left" IsChecked="{Binding Path=Important}" VerticalAlignment="Top" Content="Alert" Grid.Column="4" Margin="4,0,4,0"/>
            </Grid>
       </DataTemplate> 
```

最后，带有 DataTriggers 的样式也在我的窗口资源中。

```
<Style x:Key="NotesRowTriggers" TargetType="{x:Type Grid}">
    <Style.Triggers>
        <DataTrigger Binding="{Binding Path=Important}" Value="True">
            <Setter Property="Background">
                <Setter.Value>
                    <SolidColorBrush Color="Red" Opacity="0.3" />
                </Setter.Value>
            </Setter>
        </DataTrigger>
        <DataTrigger Binding="{Binding Path=Highlight}" Value="True">
            <Setter Property="Background">
                <Setter.Value>
                    <SolidColorBrush Color="Red" Opacity="0.6" />
                </Setter.Value>
            </Setter>
        </DataTrigger>
    </Style.Triggers>
</Style> 
```

我的示例可能比它需要的详细得多，但我只是直接从我的一个应用程序中提取它。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-05T00:13:28.760

如果您使用转换器（例如，IntToFontWeightConverter），您可以做的比这更简单。

设置项目模板：

```
 <DataTemplate x:Key="BoldTemplate">
    <TextBlock
        FontWeight="{Binding Path=Position, Converter={StaticResource IntToFontWeightConverter}}"
        Text="{Binding Path=Name}" 
        />
</DataTemplate> 
```

其中 Name 是您要显示的内容， Position 是您基于粗体/正常的属性。

创建您的转换器（取决于您基于粗体的属性的类型）。

```
class IntToFontWeightConverter :IValueConverter 
{
    #region IValueConverter Members

    public object Convert(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        if ((int)value == 1)
        {
            return FontWeights.Bold;
        }

        return FontWeights.Normal;
    }

    public object ConvertBack(object value, Type targetType, object parameter, System.Globalization.CultureInfo culture)
    {
        throw new NotImplementedException();
    }

    #endregion
} 
```

# model-view-controller - Spring MVC SimpleFormController

> ID：342413
> 
> 赞同：0
> 
> 时间：2008-12-04T23:10:10.620
> 
> 标签：model-view-controller, spring

我有一个**SimpleFormController**， doSubmit() 什么都不做，只是填充一个命令对象（称之为 bar，一个简单的 POJO，它有一个字段，比如 id）。所以，successView 正在被调用。successView 是“redirect:/foo.html”，而 foo.html 的 bean def 是：

我将这个 bean 映射到一个简单的 jsp，称为 foo.jsp。jsp 很好。我的问题是我希望 foo.jsp 显示`${bar.id}`，它没有显示。当我不进行重定向时，`${bar.id}`显示效果很好。我需要做什么才能让它在“重定向”情况下工作？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-04T23:14:23.730

缺少 bean 定义：

```
<bean name="/foo.html"class=".....UrlFilenameViewController"/> 
```

# .net - 在 .NET CF 2.0 中，全局键盘挂钩是否会干扰需要按键的 P/Invokes？

> ID：342420
> 
> 赞同：2
> 
> 时间：2008-12-04T23:13:35.247
> 
> 标签：.net, winapi, compact-framework, pinvoke, windows-ce

我的详细信息：运行 Windows CE 4.2、Compact Framework 2.0 SP1 的定制移动设备。到目前为止，C# 应用程序充分利用了 P/Invokes，没有任何问题。

我写了一个低级键盘钩子（类似于，但不完全相同，[这个 CodeProject 帖子](https://secure.codeproject.com/KB/cs/CSLLKeyboardHook.aspx?display=PrintAll&fid=423705&df=90&mpp=25&noise=3&sort=Position&view=Quick&select=2068536&fr=26)），它的工作非常好，但有一个例外。我们的软件所做的一件事是允许访问 Windows CE 的屏幕校准功能。这是您需要点击一系列目标的屏幕，最后按 Esc 取消或 Enter 接受。我们[通过 P/Invoke](http://msdn.microsoft.com/en-us/library/aa908613.aspx)调用这个功能，我认为这个 Win32 API 函数内部发生的按键被我的键盘钩子干扰了。

我的键盘钩子没有做任何密集的事情，也没有改变执行流程，但我认为两者的使用可能从根本上不兼容。当我在运行此屏幕后退出调试器时，当程序关闭时，所有的 Enter 键按下我都尝试一次全部“击中”（此设备会发出咔哒声）。这让我认为钩子没有正确地将按键传递给 Win32 API 函数，就像它正确传递给 .NET 应用程序一样。有什么想法吗？

您是否认为：
a）键盘钩子和需要键盘的 P/Invokes 不兼容，或者
b）我的键盘钩子实现是罪魁祸首，或者
c）它是否完全取决于硬件制造商、驱动程序等？

谢谢你的帮助！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T23:30:55.883

a) 不，它们完全兼容。键盘挂钩发生在 kenel 级别，因此任何使用键盘消息的内容都将通过它，无论它来自本机代码还是托管代码。

b）很难说，因为我们看不到您的实施

c）这是可能的（任何事情都是因为 CE 中的几乎所有东西都是 OEM 可更改的）但不太可能。大多数原始设备制造商对 GWES（这就是它所在的地方）并不多，因为它开箱即用。

现在，我假设您正在查看的特定部分来自对 TouchCalibrate 的调用，对吗？最好的办法是专门查看 TouchCalibrate 源代码 - 它带有 Platform Builder（包括 eval 版本）。

我的猜测是它正在“拦截”或至少阻止消息被发送。我在那里已经有一段时间了，那是在做触摸板驱动程序的时候，所以我没有过多关注键盘处理，但它在做什么将控制权传递给 GWES 子系统以查看原始触摸板点 -它没有运行 Windows 应用程序。因此，处理发送这些按键的应用程序消息泵很可能什么都不做（有点像当你抛出一个模态对话框时）。

我真的需要更好地解释到底发生了什么。您说“在运行此屏幕后退出调试器时”，但我不清楚这意味着什么。你的意思是你在代码中调用 TouchCalibrate，然后停止调试，然后发送消息，或者一旦 TouchCalibrate 本身屏幕关闭，它们就会被发送？

Remote Spy++ 或 Kernel Tracker 也可能对正在发生的事情提供一些见解。

# python - 在应用程序之间共享/管理我们内部 python 库的最佳方式

> ID：342425
> 
> 赞同：4
> 
> 时间：2008-12-04T23:16:44.117
> 
> 标签：python, deployment, shared-libraries, projects-and-solutions

我们公司 (xyz) 正在将我们的大量 Flash 代码迁移到 Python。

在 Flash 中，我们的 Flash 应用程序之间有一个共享库 - 包 xyz。我们可以对包进行更改，而不必担心在部署其他应用程序时会破坏它们，因为 Flash 会编译它们的代码并包含库的内容。我们通过 RPM 部署最终的 SWF，我们就完成了。App1 和 App2 的更新永远不会破坏 App3。

您将如何在共享库依赖项 Python 中处理此问题。

*App1、App2 和 App3 都可能需要 xyz-lib.rpm，并且都使用相同的库文件，但是每次*有新库时，都必须针对 App1、2、3 显式测试更新的 xyz-lib.rpm ，这只是繁重的。

我目前最喜欢的解决方案——我可以让 app1.rpm 包含打包时的库——实际上是库的某种静态链接。然而，这感觉很不雅。（虽然唯一的额外成本是硬盘空间==便宜。）

我知道共享库的可靠管理可能是最好的解决方案，但我一直在努力考虑到所有开发人员都是人类，并且会犯错误。我们会犯错误，我不希望 app1 的部署破坏 app2 和 app3 - 它只是要测试和调试更多。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-04T23:30:12.170

“每次有一个新库时都针对 App1,2,3 进行明确测试”实际上并没有那么繁重。

两件事情。

*   您需要库*必须*通过的一组正式的 API 单元测试。这只是 API，而不是功能的每一个细微差别。如果这通过了，那么您的更改就可以开始了。如果失败，您的更改会破坏 API。

*   您还需要一组独立于 API 的功能单元测试。这更大，可能被归类为“繁重”。

一旦你开始单元测试，你就会上瘾。一旦你合理地完成了测试，这个问题就很容易解决。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-04T23:34:10.993

我已经使用这个[食谱条目](http://code.activestate.com/recipes/497000/)的变体来分发 python 应用程序。基本上它涉及将所有 python 源压缩到一个 zip 文件中，然后将其与 shell 脚本连接以导入源文件。

如果您需要为应用程序提供自己的库版本，这会很有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T11:41:39.867

我也赞成将所有东西打包在一起并将对操作系统库的依赖限制到最小的解决方案（glibc 就是这样）。硬盘便宜，客户和支持时间不便宜。

在 Windows 上，使用 py2exe + InnoSetup 很简单。

在 Linux 上，看起来[bbfreeze](http://pypi.python.org/pypi/bbfreeze/0.95.4)是处理这个问题的正确方法。引用主页，它提供：

*   zip/egg 文件导入跟踪：bbfreeze 跟踪从 zip 文件的导入，如果从 eggfile 中使用某些模块，则包括整个 egg 文件。使用 setuputils 的 pkg_resources 模块的包现在可以工作（0.95.0 中的新功能）
*   二进制依赖跟踪：bbfreeze 将跟踪二进制依赖，并将包括冻结程序所需的 DLL 和共享库。

# controls - Silverlight 垂直滑动面板

> ID：342430
> 
> 赞同：1
> 
> 时间：2008-12-04T23:21:01.237
> 
> 标签：controls, silverlight-2.0

谁能推荐一个好的 Silverlight 2.0 滑动面板，它将未知数量的用户控件作为子控件，并允许用户在子列表中上下滚动。

与[http://www.thejamesbondmovies.com/](http://www.thejamesbondmovies.com/)类似，但垂直且不仅限于图像。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-05T12:25:30.577

环顾[Rob](http://www.robertjantuit.nl/index.php/2008/09/13/storyboard-animation-for-the-scrollviewer-animationhelpercontrol/ "抢")有一个很好的起点。他的示例使用了改编 ScrollViewer 控件，隐藏了默认滚动条并添加了左右滚动的按钮。他还添加了一个故事板来为 ScrollToHorizo​​ntalOffset 设置动画。这可以很容易地适应使用垂直方向。

还有其他人看到其他垂直工作的实现并且已经更新了默认样式以创建类似于上面的詹姆斯邦德电影链接的体验吗？

# python - Django 中的 Python 日志记录

> ID：342434
> 
> 赞同：41
> 
> 时间：2008-12-04T23:24:26.567
> 
> 标签：python, django, logging

我正在开发一个 Django 应用程序，并且我正在尝试使用 Python 的日志记录模块进行错误/跟踪日志记录。理想情况下，我希望为站点的不同区域配置不同的记录器。到目前为止，我已经完成了所有这些工作，但有一件事让我摸不着头脑。

我让根记录器转到 sys.stderr，并且我已经配置了另一个记录器来写入文件。这是在我的 settings.py 文件中：

```
sviewlog = logging.getLogger('MyApp.views.scans')
view_log_handler = logging.FileHandler('C:\\MyApp\\logs\\scan_log.log')
view_log_handler.setLevel(logging.INFO)
view_log_handler.setFormatter(logging.Formatter('%(asctime)s %(name)-12s %(levelname)-8s %(message)s'))
sviewlog.addHandler(view_log_handler) 
```

看起来很简单。但是，问题出在：我写到 sviewlog 的任何内容都会被写入日志文件两次。根记录器只打印一次。就像 addHandler() 被调用了两次。当我将代码通过调试器时，这正是我所看到的。settings.py 中的代码被执行了两次，因此创建了两个 FileHandler 并将其添加到同一个记录器实例中。但为什么？我该如何解决这个问题？

谁能告诉我这里发生了什么？我已经尝试将 sviewlog 记录器/处理程序实例化代码移动到使用它的文件中（因为这对我来说实际上似乎是合适的位置），但我在那里遇到了同样的问题。我在网上看到的大多数示例只使用根记录器，我更喜欢拥有多个记录器。

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-12-06T01:06:01.913

请允许我回答我自己的问题。这里的根本问题是 settings.py 被导入两次，甚至更多（见[这里](http://www.mail-archive.com/django-users@googlegroups.com/msg39059.html)）。（我仍然不明白为什么会这样。也许一些 Django 专家可以向我解释。）其他一些模块似乎也是如此。在这一点上，我认为假设 settings.py 将被导入多少次是不明智的。就此而言，这样的假设通常是不安全的。我在 settings.py 以外的地方有过这段代码，结果是相似的。

你必须围绕这个进行编码。也就是说，您必须在向其添加其他处理程序之前检查您的记录器是否存在现有处理程序。这有点难看，因为将多个处理程序（即使是同一类型）附加到一个记录器是完全合理的。有一些解决方案可以解决这个问题。一种是检查 logger 对象的 handlers 属性。如果您只想要一个处理程序并且您的长度 > 0，则不要添加它。就我个人而言，我不喜欢这个解决方案，因为它会因为更多的处理程序而变得混乱。

我更喜欢这样的东西（感谢 Thomas Guettler）：

```
# file logconfig.py
if not hasattr(logging, "set_up_done"):
    logging.set_up_done=False

def set_up(myhome):
    if logging.set_up_done:
        return
    # set up your logging here
    # ...
    logging.set_up_done=True 
```

我必须说，我希望 Django 多次导入 settings.py 的事实得到更好的记录。而且我会想象我的配置以某种方式导致了这种多次导入，但是我无法找出导致问题的原因和原因。也许我只是在他们的文档中找不到这一点，但我认为这是您需要警告用户的事情。

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2010-10-20T23:23:54.437

从 1.3 版开始，Django 使用标准 python 日志记录，并使用`LOGGING`设置进行配置（在此处记录：[1.3](http://docs.djangoproject.com/en/1.3/ref/settings/#std:setting-LOGGING)，[dev](http://docs.djangoproject.com/en/dev/ref/settings/#std:setting-LOGGING)）。

Django 日志记录参考：[1.3](http://docs.djangoproject.com/en/1.3/topics/logging/)，[dev](http://docs.djangoproject.com/en/dev/topics/logging/)。

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2008-12-05T11:35:08.620

很难评论你的具体情况。如果 settings.py 执行了两次，那么对于每个发送的日志，您会得到两行是正常的。

我们遇到了同样的问题，所以我们在项目中设置了一个专门用于日志记录的模块。该模块具有“模块单例”模式，因此我们只执行一次有趣的代码。

它看起来像这样：

```
def init_logging():
    stdoutHandler = logging.StreamHandler( sys.stdout )
    stdoutHandler.setLevel( DEBUG )
    stdoutHandler.setFormatter( logging.Formatter( LOG_FORMAT_WITH_TIME ) )
    logging.getLogger( LOG_AREA1 ).addHandler( stdoutHandler )

logInitDone=False #global variable controlling the singleton.
if not logInitDone:
    logInitDone = True
    init_logging() 
```

第一次导入 log.py 将正确配置日志记录。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2011-05-04T21:09:10.060

[恢复一个旧线程，但我在使用 Django 1.3 Python logging 和dictConfig 格式](http://docs.python.org/library/logging.config.html#configuration-dictionary-schema)时遇到重复消息。

消除了多个 settings.py 加载的`disable_existing_loggers`重复处理程序/日志记录问题，但如果您没有`propagate`在特定的`logger`. 即，确保`propagate=False`为子记录器设置。例如，

```
'loggers': {
    'django': {
        'handlers':['null'],
        'propagate': True,
        'level':'INFO',
    },
    'django.request': {
        'handlers': ['console'],
        'level': 'ERROR',
        'propagate': False,
    },
    'project': {
        'handlers': ['console', 'project-log-file'],
        'level': 'DEBUG',
        'propagate': True,
    },
    'project.customapp': {
        'handlers': ['console', 'customapp-log-file'],
        'level': 'DEBUG',
        'propagate': False,
    },
} 
```

在这里，`project.customapp`设置`propagate=False`它也不会被`project`记录器捕获。[Django 日志记录文档](http://docs.djangoproject.com/en/dev/topics/logging/)一如既往地出色。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2010-04-17T06:12:37.450

> 要回答关于“Django 多次导入 settings.py”的问题：它没有。

实际上，它确实被导入了两次（跳过第一个代码块直接进入它，但如果你有时间的话，请好好阅读）：

[http://blog.dscpl.com.au/2010/03/improved-wsgi-script-for-use-with.html](http://blog.dscpl.com.au/2010/03/improved-wsgi-script-for-use-with.html)

PS–抱歉恢复旧线程。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2008-12-06T16:55:42.247

您可以通过在执行初始化时检查处理程序的数量来解决您的问题。

```
def init_logging():
    stdoutHandler = logging.StreamHandler( sys.stdout )
    stdoutHandler.setLevel( DEBUG )
    stdoutHandler.setFormatter( logging.Formatter( LOG_FORMAT_WITH_TIME ) )
    logger = logging.getLogger( LOG_AREA1 )
    if len(logger.handlers) < 1:
        logger.addHandler( stdoutHandler ) 
```

我不认为这是处理它的好方法。就个人而言，为了使用 python 日志记录模块登录 django，我在 views.py 中为我感兴趣的每个应用程序创建一个记录器，然后在每个视图函数中获取记录器。

```
from django.http import HttpResponse
from magic import makeLogger
from magic import getLogger

makeLogger('myLogName', '/path/to/myLogName.log')
def testLogger(request):
    logger = getLogger('myLogName')
    logger.debug('this worked')
    return HttpResponse('TEXT, HTML or WHATEVER') 
```

这是一篇关于调试 django 的非常好的文章，涵盖了一些日志记录： [http ://simonwillison.net/2008/May/22/debugging/](http://simonwillison.net/2008/May/22/debugging/)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-07-08T16:05:30.617

要回答关于“Django 多次导入 settings.py”的问题：它没有。

您可能正在运行一个多进程/多线程 Web 服务器，它创建了几个 python 子解释器，其中每个子解释器从您的 django 应用程序中导入代码一次。

在 django 测试服务器上进行测试，您应该会看到设置没有多次导入。

前段时间，我用我的第一个 django/apache 应用程序设计了一个不错的单例（python borg idiom 版本更准确），然后我很快意识到是的，我创建了多个单例实例......

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2011-02-08T12:43:34.453

您还可以使用一次性中间件来获得类似的效果，而无需私有变量。请注意，这只会配置 web 请求的日志记录 - 如果您想登录 shell 或命令运行，则需要找到不同的解决方案。

```
from django.conf import settings
from django.core.exceptions import MiddlewareNotUsed
import logging
import logging.handlers
import logging.config

__all__ = ('LoggingConfigMiddleware',)

class LoggingConfigMiddleware:
    def __init__(self):
        '''Initialise the logging setup from settings, called on first request.'''
        if hasattr(settings, 'LOGGING'):
            logging.config.dictConfig(settings.LOGGING)
        elif getattr(settings, 'DEBUG', False):
            print 'No logging configured.'
        raise MiddlewareNotUsed('Logging setup only.') 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-05T00:21:05.187

为什么使用 python 记录器而不是 django-logging？试试看，它可能只是解决你的问题。

[http://code.google.com/p/django-logging/wiki/Overview](http://code.google.com/p/django-logging/wiki/Overview)

目前它只允许查看根记录器，但您可以确保写入多个记录器。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-05T12:42:52.630

一种骇人听闻的方式，但您可以尝试将日志记录代码放在 admin.py 中。它应该只导入一次。

或者; 您可以先检查`MyApp.views.scans`日志是否存在吗？如果它存在（可能引发错误），您可以简单地跳过创建（因此不再添加处理程序）。一种更清洁的方法，但我还没有尝试过。

此外，必须有一个更合适的位置来放置此代码（`__init__.py`？）。`settings.py`用于设置。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2011-10-05T08:52:58.963

要添加到**A Lee**帖子中，python 日志记录文档说明了有关传播的内容：

> **记录器传播**
> 
> 如果计算结果为 false，则此记录器或其子记录器不会将记录消息传递给更高级别（祖先）记录器的处理程序。构造函数将此属性设置为 1。

这意味着如果`propagate == False`然后**子记录器**将不会将记录消息传递给**其父记录器**

# java - Java：在单独的进程中运行 Callable

> ID：342435
> 
> 赞同：3
> 
> 时间：2008-12-04T23:25:08.857
> 
> 标签：java, multithreading, process, stdout, stdin

给定一个实例`x`，`Callable<T>`如何`x`在单独的进程中运行，以便可以重定向进程的标准输入和输出？例如，有没有办法`Process`从 a 构建 a `Callable`？是否有`Executor`控制输入和输出的标准？

`Callable`[更新]在新进程中执行而不是在新线程中执行并不重要。我想要的是把`Callable`实例放在“线束”中，这样​​我就可以控制它的标准输入/标准输出。AFAIK，这需要一个新的过程。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-04T23:53:07.880

更普遍：

> 给定一个使用全局变量 A 和 B 的 Callable 实例 x，我如何同时运行 x 以使 x 看到 A 和 B 的自定义值，而不是 A 和 B 的“原始”值？

最好的答案是，不要使用全局变量。依赖注入之类的东西。扩展 Callable 并添加方法 setStdIn、setStdOut（如果需要，还可以添加 setStdErr）。

我知道这不是您要寻找的答案，但是我为此看到的解决方案都需要一个新流程，而将 Callable 放入新流程的唯一方法是更改​​ Callable 的代码它是可序列化的，或提供类名或其他一些技巧，因此不要进行会给您带来讨厌的、脆弱的解决方案的更改，只要做对*

* “正确”是使用广泛接受的依赖注入模式来提供松散耦合。YMMV

更新：回应评论 1。这是您的新界面：

```
import java.io.InputStream;
import java.io.PrintStream;
import java.util.concurrent.Callable;

public interface MyCallable<V> extends Callable<V> {
  void setStdIn(InputStream in);
  void setStdOut(PrintStream out);  
} 
```

你的任务看起来像：

```
import java.io.InputStream;
import java.io.PrintStream;

public class CallableTask implements MyCallable<Object> {

    private InputStream in = System.in;
    private PrintStream out = System.out;

    public void setStdIn(InputStream in) {
        this.in = in;
    }

    public void setStdOut(PrintStream out) {
        this.out = out;
    }

    public Object call() throws Exception {
        out.write(in.read());
        return null;
    } 
```

}

不需要过程。几乎可以肯定，任何解决方案（甚至是使用进程的解决方案）都需要以某种方式对 Callables 进行代码更改。这是最简单的（只需将 System.out 替换为 this.out）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T00:47:19.020

stdin/stdout 可以重定向到整个系统，但我不确定它是否可以重定向到单个线程——你总是只是从 System. （不过，您可以让 System.out 转到另一个流，在有一种方法可以将跟踪作为字符串获取之前，我已经使用它来捕获堆栈跟踪）

您可以重定向标准输入/标准输出，运行可调用然后将其重定向回来，但如果其他任何东西在重定向时使用 System.out，那也将转到您的新文件。

如果您想走那条路线，方法将是 System.setIn() 和 System.setOut()（和 System.setErr()）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T11:52:42.420

努力使用上面的参数化、依赖注入或任何你想调用的方法来构造你的代码。避免静态，即使是那些装扮成单身人士或隐藏在糟糕图书馆中的人。

如果您不想删除对您的使用，`System.in/out/err`那么您很幸运。这些可以用 全局设置`System.set(In/Out/Err)`。为了能够为各个线程进行不同的流式传输，请设置一个`ThreadLocal`用于查找要委托的目标的实现。线程局部变量通常是邪恶的，但在不幸的情况下可能很有用。

从澄清来看，原始发布者似乎不需要创建单独的过程。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-04T23:34:37.623

看一下 ProcessBuilder 类，它为您提供了捕获它启动的进程的标准输出和标准错误的选项。

您可以创建一个运行 Callable 的 Main 类，然后将其作为另一个带有 ProcessBuilder 的 jvm 启动。Main 类可以接受您的可调用对象的类名作为命令行输入参数，并使用 Class.forName() 和 Class.newInstance() 加载它。

如果您希望它运行特定的可调用实例，另一种方法是在启动另一个进程之前将实例序列化为文件（这将是两个进程之间通信的一种非常粗略的形式）。

问题是，你为什么要这样做？你不能在另一个线程中运行你的可调用对象吗？java.util.concurrent 有一些有用的线程池，仅此而已。

# python - 导入特定于版本的 python 模块的最佳方法

> ID：342437
> 
> 赞同：14
> 
> 时间：2008-12-04T23:28:10.490
> 
> 标签：python, migration, module, code-migration

哪种方法最适合在 python 中导入特定于版本的模块？我的用例是我正在编写将部署到 python 2.3 环境中并在几个月内升级到 python 2.5 的代码。这：

```
if sys.version_info[:2] >= (2, 5):
    from string import Template
else:
    from our.compat.string import Template 
```

或这个

```
try:
    from string import Template
except ImportError:
    from our.compat.string import Template 
```

我知道这两种情况都同样正确并且可以正常工作，但哪种情况更可取？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-04T23:57:33.737

总是第二种方式——你永远不知道会安装什么不同的 Python 安装。`Template`是一个不太重要的特定情况，但是当您测试功能而不是版本控制时，您总是更健壮。

这就是我使[Testoob](http://www.testoob.org)支持 Python 2.2 - 2.6 的方式：我尝试以不同的方式导入模块，直到它工作为止。它也与 3rd-party 库有关。

这是一个极端情况 - 支持 ElementTree 出现的不同选项：

```
try: import elementtree.ElementTree as ET
except ImportError:
    try: import cElementTree as ET
    except ImportError:
        try: import lxml.etree as ET
        except ImportError:
            import xml.etree.ElementTree as ET # Python 2.5 and up 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-04T23:40:20.840

我可能会争辩说第二个更可取。有时，您可以将模块从较新版本的 python 安装到较旧版本中。例如，wsgiref 随 Python 2.5 一起提供，但将其安装到旧版本中并不少见（我认为它将与 python 2.3 一起使用）。

# php - 跟踪php代码

> ID：342438
> 
> 赞同：-2
> 
> 时间：2008-12-04T23:28:23.407
> 
> 标签：php, compiler-construction

我有很多要求和包括，我想知道是否有什么可以帮助我在加载网页时查看整个 php 代码。我要问的原因是，在摆弄了一些代码之后，我不能再放置任何 php 代码，因为编译器不会“感知”它。就像我在 php 标签内放任何东西一样

它不会给我一个错误，说该功能不存在。感谢任何花时间阅读本文的人。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-04T23:39:19.813

不完全确定你在追求什么...

get_included_files 函数可以让您查看 php 已加载的所有文件的列表。

您可能还会发现使用 grep 或编辑器中的“在文件中查找”功能（如果有的话）可以帮助您在您知道的代码中找到任何找不到的内容。

最后，错误的事情 - 在脚本顶部调用以下函数以确保输出错误：

```
error_reporting(E_ALL);
ini_set('display_errors', 1); 
```

这仍然不会捕获解析错误。

请不要在实时系统中使用它们，仅在开发中使用 - 向用户显示错误消息是不好的，它们包含的信息可能会帮助任何希望破坏您的系统的人。

所以....不确定这个问题，但我已经回答了我认为可能的问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-04T23:39:27.393

您无法在浏览器中检查 PHP 代码，因为它在服务器端执行，然后简单地将输出显示到浏览器。您必须通过 echo 语句或可能记录信息手动添加查看代码中发生了什么的功能。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-04T23:47:47.673

为了跟踪和了解您的代码所做的一切，以及它消耗了多少资源，我建议您使用分析器，对于 PHP I，[xDebug Profiler](http://www.xdebug.org/docs/profiler)，还有其他选项，如[APD](http://php.net/apd)和[Benchmark Profiler](http://pear.php.net/package/Benchmark)。

![xDebug Profiler 正在运行...](https://www.xdebug.org/images/docs/kc-profile.png)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-15T21:22:08.560

您无法查看未在您的计算机上运行的 PHP 代码。这个想法是 PHP 标记 ( `<?php ?>`) 中的代码被弹出、运行，然后无论输出是什么，都被偷偷放回标记在最终版本发送到您的计算机之前的位置。因此，您无法在您的机器上看到代码。

您需要做的是让 FTP 客户端通过 FTP 进入服务器以查看代码。

# sql-server - 如何在 SQL Server 中存储无符号 64 位整数？

> ID：342443
> 
> 赞同：8
> 
> 时间：2008-12-04T23:30:38.050
> 
> 标签：sql-server, unsigned

我使用一个使用相当大的数字的应用程序，我需要将数据存储为无符号的 64 位整数。我更喜欢只存储它而不用担心位操作或类似的事情，因此不同的程序可以以不同的方式使用数据。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-04T23:42:20.307

您可以将值存储在`NUMERIC`a 为 0 的类型`scale`中，这将保留`integer`所需的语义。该`NUMERIC`类型将允许负数，尽管您可以设置约束以要求正整数。

最大值`precision`为`NUMERIC`38 位十进制数字。`2**64`大约是 18 或 19 位十进制数字，因此`NUMERIC(19,0)`对于这些数据可能工作得很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-04T23:35:00.617

AFAIK，您必须创建一个自定义类型。尽管那篇[文章](http://www.julian-kuiters.id.au/article.php/sqlserver2005-unsigned-integer)更多地用于限制负数...

# c# - C# .NET 使用 HttpWebRequest 将文件上传到 Web 表单

> ID：342453
> 
> 赞同：2
> 
> 时间：2008-12-04T23:35:30.803
> 
> 标签：c#, .net, httpwebrequest

有没有人有一个使用 C# 中的 HttpWebRequest 将文件从本地驱动器提交到 multipart/form-data Web 表单的工作示例？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-05T00:35:37.717

使用 WebClient 更容易做到这一点

```
string url = "http://myserver/myapp/upload.aspx";
string file = "c:\\files\\test.jpg";
WebClient wc = new WebClient();
wc.UploadFile(url,"post",file); 
```

如果它需要是 httpwebrequest 我可以为你整理一些东西（这是可能的），但它更像是 50 行然后 5

# .net - PowerShell Outlook 发送电子邮件

> ID：342455
> 
> 赞同：0
> 
> 时间：2008-12-04T23:35:33.330
> 
> 标签：.net, powershell, interop, outlook

我正在开发一个脚本，其中涉及创建电子邮件联系人并将邮件转发给该联系人。脚本的最后一部分是自动向该地址发送一封测试电子邮件，以确保转发工作正常。

所以我使用以下代码：

```
[void] [Reflection.Assembly]::LoadWithPartialName("Microsoft.Office.Core")
[void] [Reflection.Assembly]::LoadWithPartialName("Microsoft.Office.Interop.Outlook")

$olApp = New-Object Microsoft.Office.Interop.Outlook.ApplicationClass
$msg = $olApp.CreateItem(0)
$msg.Recipients.Add("me@example.com")  
$msg.Subject = "test"  
$msg.Body = "test"  
$msg.Send() 
```

第 6 行出现错误：`"You cannot call a method on a null-valued expression."`

我在家里运行代码，它工作得很好。区别：在工作域上，在工作时使用 Exchange Server，在工作时使用域帐户。

我在两台机器上使用相同版本的 Powershell 和 Outlook。最好使用 Outlook 发送邮件，因为我已经打开了 Outlook，这样邮件就会显示在我的已发送邮件文件夹中。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2016-07-22T22:02:01.330

我遇到了类似的问题，其中一些 COM 对象似乎没有完全填充（似乎与公司 Outlook 设置有关 - 也许是防病毒措施？）。但是，如果您注释掉该`$msg.Recipients.Add("me@example.com")`行并添加`$msg.Display()`，您可以添加收件人并从那里发送。不是一个很好的解决方案。

对于我的问题，我被指向 Exchange Web Service (EWS)，因此我下载了[EWS API 2.2](https://www.microsoft.com/en-us/download/details.aspx?id=42951 "EWS API 2.2")并使用了以下内容：

```
Add-Type -LiteralPath "C:\Program Files\Microsoft\Exchange\Web Services\2.2\Microsoft.Exchange.WebServices.dll"
$service = New-Object Microsoft.Exchange.WebServices.Data.ExchangeService -ArgumentList Exchange2010_SP1
$service.AutodiscoverUrl(‘me@mydomain.com’, {$true})

$msg = New-Object Microsoft.Exchange.WebServices.Data.EmailMessage($service)
$msg.Subject = "Sent from Powershell EWS"
$msg.Body = "<html><body><h1>TESTING</h1><p>This is a test message sent from Powershell!</p></body></html>"
$msg.ToRecipients.Add("me@mydomain.com")
$msg.SendAndSaveCopy() 
```

这似乎工作得很好，并将消息保存到我发送的文件夹中。

如果您不需要将项目保存在您的已发送项目文件夹中（例如将您自己添加为收件人），则使用“NT AUTHORITY\ANONYMOUS LOGON”可能更容易使用 Send-MailMessage：

```
$emptySecStr = New-Object System.Security.SecureString
$creds = New-Object -TypeName System.Management.Automation.PSCredential -ArgumentList "NT AUTHORITY\ANONYMOUS LOGON", $emptySecStr
Send-MailMessage -SmtpServer $smtpServerName -Credential $creds -From $sendingAddr -to $sendToArray -Cc $sendCCArray -BodyAsHtml -body $htmlBody -Subject $subject 
```

我从[这里](http://powershell.com/cs/forums/t/11843.aspx)的一个很棒的讨论中得到了这种技术。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T00:37:04.580

如果您改变了使用 Outlook 的想法，请查看 CodePlex 上的 PowerShell 社区扩展（免费）。他们提供了一个 cmdlet 来发送 SMTP 电子邮件，这足以测试新创建的地址。不确定在您的已发送项目中进行测试是否有价值？特别是如果您批量执行这些操作 - 直接使用 SMTP 会比使用 Outlook 快得多。

# vb.net - VB.NET 静态代码分析

> ID：342456
> 
> 赞同：5
> 
> 时间：2008-12-04T23:36:25.183
> 
> 标签：vb.net, static-analysis

有谁知道用于 vb.net 的好的代码静态代码分析器？

我已经看到很多 c#，我认为 VS 2008 内置了一些。但我们目前只使用 vs 2005 ......

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-04T23:43:32.127

[FxCop](http://en.wikipedia.org/wiki/FxCop)就是这样做的。

VB.NET 特有的是[Project Analyzer](http://en.wikipedia.org/wiki/Project_Analyzer)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T00:17:42.137

根据您要查找的内容，Fortify 是另一个可以很好地分析代码的应用程序，但它不是特定于 VB 的，适用于所有 .net

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-18T16:21:47.287

您可以使用工具[NDepend](http://www.NDepend.com)分析所有 .NET 代码（C#、VB.NET、F#...）。对于 VB.NET 代码，您将错过关于源代码注释和源代码圈复杂度的 2 个指标（但您仍然可以从 IL 代码计算 CC）。

在此处查看 NDepend 的所有功能[http://www.ndepend.com/Features.aspx](http://www.ndepend.com/Features.aspx) :
- LINQ 上的代码查询和规则 (CQLinq)
- 比较构建
- 82 个代码指标
- 管理复杂性和依赖关系
- 检测依赖循环
- 利用测试覆盖数据
- 实施不变性和纯度
- 关于构建过程健康状况的警告
- 从构建过程生成自定义报告
- 图表
- 应对现实环境的设施

# linq - 是否可以在不同的 LINQ 提供程序之上进行 LINQ 查询？

> ID：342458
> 
> 赞同：0
> 
> 时间：2008-12-04T23:37:27.680
> 
> 标签：linq, entity-framework, linq-to-entities, linq-to-objects

我目前正在考虑我的数据对象的存储库模式，其中`IQueryable<>`可以将多个实例注册为数据源，但让它运行似乎并不容易。

使用 LINQ to 实体和 LINQ To Objects 运行简单的 LINQ 查询不起作用。你认为这通常是可能的吗？也许唯一的解决方案是编写一个指定的提供者？

在我的存储库中，我调用`.Union<>()`了所有 IQueryable 实例，然后最后使用 LINQ 对生成的单个`IQueryable`. 结果是一个`IQueryable`被完全忽略了。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-04T23:53:21.343

好吧，我在列表上使用 LINQ 查询，收集一大堆东西。我在 SQL 表上使用非常相似的查询。我从来没有遇到任何问题。我听说有人在 LINQ to 对象上使用 LINQ 查询时遇到一些问题，但我认为它们通常被认为是 LINQ 错误，而不是由于 LINQ to 对象、LINQ to XML 和 LINQ to SQL 工作方式的设计差异。在我安装 VS 2008 SP1 之前的几天里，我确实遇到了一些 LINQ 问题，但这些问题已经得到解决。

只要您考虑到查询返回的内容，它就应该可以正常工作。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2008-12-04T23:59:43.640

我绝对没有文档来支持这一点，但我确实记得在发布前几天关于 Linq to SQL 中内置的优化的一些讨论，这些优化将试图在 Linq to SQL IQueryable 上执行操作时消除对数据库的多次调用<> 对象和 Linq to Object IQueryable<> 对象。这与 IQueryable 接口的整体架构相结合，让我认为在不同的提供者上操作应该没有问题。但是，交互的能力似乎可能基于提供者的特定实现。

我知道我已经对 Linq to Object 和 Linq to XML 集合的组合进行了操作，没​​有问题。

# performance - 使用 mod_perl 时，如何仅在编译时执行低效代码？

> ID：342468
> 
> 赞同：9
> 
> 时间：2008-12-04T23:42:29.667
> 
> 标签：performance, perl, mod-perl

我一直在对我用 Perl 编写的框架的性能进行基准测试，与我们现有的代码库相比，每秒请求数减少了 50%（有些命中是可以理解的，因为我们正在从程序化的意大利面条代码变为OOP MVC 框架）。

该应用程序在 mod_perl 下运行，我已将[Moose](http://search.cpan.org/dist/Moose/)和我所有的框架代码添加到[startup.pl 脚本](http://perl.apache.org/docs/2.0/user/config/config.html#C_PerlPostConfigRequire_)中，这本身使我每秒的请求量增加了一倍。我希望进一步提高这个数字，使其尽可能接近现有数量。有人认为这是过早的优化，但是我想解决一些明显的低效率问题，看看它是如何影响性能的。

像大多数框架一样，我有一个配置文件和一个调度程序。配置部分由[Config::General](http://search.cpan.org/dist/Config-General/)处理，因此需要进行一些 IO 和解析才能将我的配置文件加载到应用程序中。我在这里看到的最大问题是我正在为每一个进来的请求做这个！

在我的应用程序上运行 Devel::Dprof 指向 Config::General::BEGIN 和一堆相关的 IO 模块作为不是 Moose 的主要慢点之一。所以我想做的，事后看来更有意义的是利用 mod_perl 的持久性和 startup.pl 编译的东西，只做一次加载配置文件的工作 - 当服务器启动时。

问题是我不太熟悉它是如何工作的。

目前每个项目都有一个 PerlHandler 引导类，它非常精简，看起来像这样：

```
use MyApp; 
MyApp->new(config_file => '/path/to/site.config')->run(); 
```

MyApp.pm 继承自框架 Project 模块，该模块具有以下代码：

```
my $config = Config::General->new(
                -ConfigFile => $self->config_file,
                -InterPolateVars => 1,
             );    

$self->config({$config->getall}); 
```

仅在编译时执行此操作，我的引导程序和项目基础模块都必须更改（我认为），但我非常不确定要进行哪些更改并且仍然保持代码的美观和精简。谁能在这里指出我正确的方向？

**更新**

我在每个项目模块方法中尝试了 BEGIN BLOCK，如 ysth 在他的回答中所述。所以我现在有：

```
package MyApp::bootstrap;
use MyApp;

my $config;
BEGIN
{
    $config = {Config::General->new(...)->getall};        
}

sub handler { ..etc.
    MyApp->new(config => $config)->run(); 
```

仅这一快速更改就让我每秒的请求数增加了**50% ，这证实了我的想法，即配置文件是一个值得修复的主要瓶颈。**我们古怪的旧开发机器上的基准数字是 60rps，仅此更改，我的框架就从 30rps 变为 45rps。对于那些说 Moose 很慢并且编译时间很短的人。在启动时编译所有 Moose 代码时，我得到了与预编译我的配置文件时相同（50%）的增长。

我现在唯一的问题是这违反了 DRY 原则，因为相同的 Config::General->new 代码在每个 BEGIN 块中，只有配置文件的路径不同。我有一些不同的策略来限制这一点，但我只是想发布这种变化的结果。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-04T23:55:28.860

假设您的应用程序根本不更改配置，请将其移动到开始块中：

```
# this code goes at file scope
my $config;
BEGIN {
    $config = { Config::General->new( ... )->getall }
}

# when creating a new instance
$self->config( $config ); 
```

并确保所有模块都在 startup.pl 中编译。

你可以变得更漂亮，让一个单例类提供配置哈希，但你不需要。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-05T13:13:51.007

如果你可以让你的 Moose 类[不可变](http://search.cpan.org/dist/Moose/lib/Moose/Cookbook/Basics/Recipe7.pod)，那可能会给你另一个减速带。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-07-16T16:14:29.413

模块的[import sub](http://perldoc.perl.org/perlmod.html#Perl-Modules)在编译时执行，因此我们可以使用它来减少/消除[ysth 的 answer](https://stackoverflow.com/questions/342468/how-can-i-execute-inefficient-code-only-at-compile-time-when-using-modperl/342482#342482)的 DRY 。

在下面的示例中，我们使用导入方法来读取具有给定参数的配置文件，然后将该配置推送到调用包中。

警告是调用包中的任何`$config`变量都将被此消除。

```
package Foo_Config;
use English qw(-no_match_vars);
sub import {
   my ($self, @cfg) = @ARG;
   my $call_pkg     = caller;
   my $config       = {Config::General->new(@cfg)->getall};
   do{ # this will create the $config variable in the calling package.
       no strict 'refs';
       ${$call_pkg . '::config'} = $config;
   };
   return;
}

package MyApp;
# will execute Foo_Config->import('/path/to/site.config') at compile time.
use Foo_Config '/path/to/site.config'; 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T00:54:33.653

我在 HTML::Mason 框架安装中遇到了同样的问题，并且发现它工作得很好：在 httpd.conf 中：

```
PerlRequire handler.pl
<FilesMatch "\.mhtml$">
  SetHandler perl-script
  PerlHandler YourModule::Mason
</FilesMatch> 
```

在您的 handler.pl 文件中，您定义了所有静态项目，例如配置、数据库句柄等。这将它们定义在 YourModule::Mason 的范围内，该范围是在 apache 线程启动时编译的（新线程显然具有固有的高架）。YourModule::Mason 然后有一个`handler`处理请求的方法。

我承认 HTML::Mason 中可能发生了一些神奇的事情，可以帮助我解决这个问题，但它对我有用，也许对你有用？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-22T15:31:09.973

一种通过少量更改来加速此类事情的常用方法是在同一 Apache 进程的调用之间简单地使用全局变量和缓存状态：

```
use vars qw ($config);
# ...
$config = Config::General->new( ... )->getall
    unless blessed($config); # add more suitable test here 
```

它不是很干净，并且可能导致模糊的错误（尽管根据我的经验，“我的 $var”会导致更多错误）并且有时会占用大量内存，但是可以通过这种方式避免许多（重复的）昂贵的初始化语句。与使用 BEGIN{} 相比的优势；仅代码是您也可以根据其他事件重新初始化，而无需重新启动 apache 或终止您的进程（例如，通过在上面的测试中包含磁盘上文件的时间戳）。

但请注意陷阱：[一种简单的闯入方法](http://perl.apache.org/docs/1.0/guide/porting.html#An_Easy_Break_in)

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2008-12-05T13:24:56.650

JackM 的想法是正确的。

*通过在“ Mother* ”Apache 进程中加载​​所有类并实例化应用程序级对象（在您的情况下为配置），您不必在每次产生新工作者时都编译它们，因为它们已经可用并在记忆中。我们当中非常细心的人为他们的应用程序经常使用的每个模块添加了一个“使用”行。如果您不在母舰中加载包和模块，每个工作人员不仅会受到加载模块的性能影响，而且不会获得现代操作系统提供的内存共享的好处。

这确实是 mod_perl 和 CGI​​ 之间差异的另一半。前半部分是 mod_perl 的持久 perl 引擎与 CGI 每次调用的重生 perl。

# php - PHP：处理 CSV 或 XLS 文件

> ID：342488
> 
> 赞同：3
> 
> 时间：2008-12-05T00:03:14.023
> 
> 标签：php, csv, xls

我需要让用户从他们的文件系统中选择一个 CSV 或 XLS 文件，然后按提交并让 PHP 打开它，查看它，确定它是否有效，然后将数据放入 MySQL。

我对服务器如何获取他们从桌面选择的文件感到困惑？

我是否必须将他们选择的文件上传到临时目录？

我可以复制一份并在内存中检查吗？

建议将不胜感激！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T00:10:28.750

阅读PHP 文档中的[处理文件上传](http://www.php.net/manual/en/features.file-upload.php)。这将涵盖如何将其发送到服务器。您确实使用 POST 将文件上传到服务器上的临时目录（为您相当无缝地处理），然后您只需获取它为您提供的文件名并打开该文件。

# network-scan - 爬取、爬取、获取数据

> ID：342497
> 
> 赞同：-1
> 
> 时间：2008-12-05T00:08:46.850
> 
> 标签：network-scan

我想写一个爬虫来做一些基础设施（路由器、WAPS、系统等）的清单

所以我理解爬虫，实现是另一回事。

所以我有一个应用程序位于服务器上，我该如何部署它。爬虫如何开始寻找？假设我想清点未知子网等？

爬虫如何发回数据？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-05T01:23:10.617

只有一个可以执行您所说的程序的程序是来自 insecure.org 的 nmap（如果我没记错的话，作者是 fyodor。）适用于多个平台。从数十到数百个可用的网络和基础设施扫描仪中的一个开始，以了解您可以做什么以及如何做可能会很有用。

# sql - 每个页面加载 20 个 SQL 查询真的被认为很多吗？

> ID：342504
> 
> 赞同：36
> 
> 时间：2008-12-05T00:13:56.077
> 
> 标签：sql, optimization

我正在阅读 Jeff Atwood 在[Behold WordPress，Destroyer of CPUs](http://www.codinghorror.com/blog/archives/001105.html)上的博客，看到那里的许多人认为每个页面加载 20 个 SQL 查询已经很多了。现在，对于具有自动建议、自动刷新数据、自定义页面和厨房水槽的高度动态页面，每页的平均查询量是多少？

举个简单的例子，A​​mazon.com 实际上用他们认为我会买的东西来定制我的主页。对我来说，这看起来并不只是对首页使用 5 个或更少的查询。

我仍然是数据库的新手，所以如果我遗漏了一些明显的东西，请告诉我。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-12-05T00:20:35.703

您通常可以在两个或三个大查询中而不是二十个小查询中带来所有数据。最小化查询量与编写优化查询以最大化性能一样重要，如果不是最重要的话。

当然，您应该始终分析查询计划并瞄准最佳查询，无论它们大小。

问题是设计糟糕的网页会执行许多查询，每个小任务一个，可以很容易地分组到一个查询中。

例如，一个**设计糟糕的 stackoverflow 可能会**执行查询以获取它将显示在主页上的所有问题 ID，然后对每个问题执行一次查询以获取摘要和投票。然后你很容易有 20 个无用的查询。一个设计良好的将执行一个查询，获取有关它将显示的所有问题的所有信息。

当然，通过良好的缓存可以减少这一切的影响，这是所有大型网站所做的，这样您实际上可以进行大量查询并且仍然可以获得不错的性能。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-12-05T00:36:19.853

它更多的是关于缓存。

如果您获得大量并发页面视图，并且每个页面视图执行大量查询，那么**每次都访问数据库没有多大意义。单身的。时间。**尤其是当返回的大量数据将通过仅不时更改的半动态参考数据（与始终在更改的会话或实时数据相反）时。

您也可以使用 memcached 或类似的东西缓存这些数据库结果。您不一定需要缓存整个页面（尽管这是大多数 Wordpress 缓存插件所做的），因为这会破坏交互性，但您可以逐个数据地缓存。

还有优化查询的问题。*尤其要避免可怕的 N+1 情况，即您对父记录执行一次查询，然后对其每个*子记录执行一次额外查询。仅往返于数据库的往返延迟就会降低您的页面渲染性能，更不用说对数据库本身造成影响了。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-04-23T05:48:57.630

我在聚会上总是迟到，这有点晚了5年……

但对这个问题的直截了当的回答是，查询的数量少于查询所用的总时间。

如果具有多个连接和子查询的大型查询需要 20 秒才能执行，那么（我认为）20 个小查询总共需要 0.20 秒会好得多。

我发现管理较小的查询要容易得多，这主要是因为我缓存了每个查询，并且我可以一次又一次地重用来自该单个查询的数据......

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-05T00:26:02.353

答案实际上取决于几个关键因素： - 站点的流量 - 用于支持的 IT 预算 - 站点的复杂性和优化所需的资源

如果您的网站每天点击数次，那么谁会在意 20 个查询。另一方面，如果您是亚马逊，那么您将以高昂的基础设施成本提供所需的内容。

世界上几乎所有其他人都介于这两个极端之间，必须根据自己的资源进行平衡。

我要说的唯一另一件事是缓存是你的朋友。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-12-11T14:26:07.343

It depends on the type of application you are building, the complexity of the queries and the things your database engine and server lets you do.

If your database service only allows you to make simple SQL queries, less than 20 queries would be fine for a small, common webpage, but if it's the webpage for your university or a decision taking support application, 60 may not be enough.

If you have the privileges and your DBMS is capable (Oracle and such, compared to older versions of MySql for example), more than 20 queries asks that you start creating stored procedures, functions and triggers for the heavy tasks. In many cases you can't, so the number of queries naturally grows and you start using cache to ease the pressure on the server.

Some heavy tasks can be achieved in less queries using subqueries for example, but they are really heavy on the database engine. They aren't really recomended in some cases and should be used with care if they involve thousands of records.

The example up there from Vinko may be true for small, 1 week development "projects", but if you ask about Amazon, they don't use your common PHP / MySQL development package; behind the frontdoor lies a complex system of distributed computing and data-mining algorytms. If you're a newbie you shouldn't take big brothers like that for a reference...

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-05T02:02:40.320

如果你必须做 20 次查询，那就这样吧，但如果它是头版，我会有点紧张。

尽可能组合查询会有所帮助，但考虑缓存是最重要的部分。

我目前正在升级一个站点，其中每天查询数千次每年更改 5 或 6 次的数据，使用一些非常讨厌的 SQL 将其制成树，但可以在大约 200k 的 RAM 中保存为树结构。（首页也有 700k 的视图状态，但那是另一回事了……）这些都是无缘无故地削弱网站的东西。

因此，对于您应该或不应该执行多少个查询并没有一个神奇的数字，但请考虑其中的每一个，即使您将其中一些仅缓存 5 分钟，如果您点击digg 的首页。

当您的网站处于压力之下时，仅 1 个查询 5 分钟的缓存就可以消除数千个数据库命中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-05T02:13:20.500

鉴于没有使用 Ajax，每个页面都是原子的，我发现在 3 个或更少的查询中生成相当复杂的页面并不难。从概念上讲，典型的页面集包括：

1.  上下文信息（与会话和其他全局状态相关）；
2.  标头（以及相关的 1:0-1 连接）；
3.  细节（1：M 从 2）。

这需要提前计划；但另一方面，在大多数情况下，它是一个简单的重构练习。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-12-05T03:51:38.400

The number of queries isn't so important all the time. It's really how you handle connections. If you have connection pooling then it really doesn't matter and the physical location of the servers matters. If your servers are next to eachother in a data center setting up a connection is probably really fast. Most of the time your website spends loading if it's a database driven site is going to be spent waiting for connections to open and for the data to be fetched. Figure to open a connection it takes 100 - 300ms. So if you have to open 20 connections for each database access, that's 4 - 6 seconds just opening and closing connections.

Since Jeff Atwood is using LINQ, I'm assuming he's only opening a single connection, executing his 20 queries and then closing the connection. It all probably happens pretty quick.

Also, Jeff's database runs on the same physical machine and uses internal machine communication to communicate with the database and not a network so there really isn't any delay you'd associate with the TCP type connection opening. (He talked about this on the Hanselminutes podcast a few weeks ago.)

I have a similar configuration for one of my sites using LINQ and with the database on the same box. When I run the site on my local machine hitting the database on the server in another state, it takes up to 6 seconds to load a couple of the data heavy pages. When I run the site on the server, the page loads in less than a second because everything is local to the server.

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-05T00:20:49.587

我的经验法则是尽可能将首页减少到 5 到 7 个以下，具体取决于站点的类型。

内页，根据他们的需要可能会有更多，但我会尽我所能将其保持在 20 以内。

但是，与此同时，根据您要执行的操作以及您使用该信息执行的缓存类型，如果其中 15 个被大量缓存，则 20 可能还不错......

# powershell - quest powershell：你如何运行计划任务？

> ID：342507
> 
> 赞同：2
> 
> 时间：2008-12-05T00:15:27.650
> 
> 标签：powershell, quest

如何使用 Quest powershell 管理单元运行计划任务？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T00:39:05.543

您将安排 PowerShell.exe，并使用其命令行参数之一来指定要运行的脚本。在该脚本的开头，添加：

添加-PSSnapin Quest.ActiveRoles.ADManagement

这将加载该脚本的管理单元，然后执行脚本中的任何其他内容。

（顺便说一句，任何需要一个或多个额外管理单元的脚本都是这种情况。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T03:07:24.573

另一种选择是创建一个控制台文件（使用 Export-Console - 这将创建一个 *.psc1 ）并将 -PSConsoleFile YourConsole.psc1 添加到您的 powershell.exe 命令行。

# php - 在 .htaccess 中获取 PHP 会话变量

> ID：342509
> 
> 赞同：12
> 
> 时间：2008-12-05T00:15:44.590
> 
> 标签：php, apache, session, .htaccess

是否可以在 Apache 的 .htaccess 文件中读取 php $_SESSION 数组中的数据？所以说我有以下内容：

```
$_SESSION['foo'] = 'bar'; 
```

然后我可以在 .htaccess 中执行以下操作吗：

```
RewriteRule bla.png folder/{the php session var foo}/file.png 
```

那可能吗？

我已经有一个可行的解决方法，但如果可能的话，它会更好。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2014-08-13T12:37:18.397

# 回答主要问题：

**不，**至少不像你想象的那样。调用该文件是`.ht`***`access`***因为它们是*“分布式配置文件”*，当然配置和***访问***处理必须首先发生 - 因此您无法获得“PHP会话变量”，因为它只是在处理`.htaccess`

我将在下面向您展示一些解决方法，但在此之前 - 您应该**注意这一点：**

# 这真的有必要吗？- 建议的解决方案：

如果您只想通过登录用户重定向文件路径**/ -** **.htaccess 不是方式**- 仅用`bla.php`作地址，然后在 php 文件中执行重定向 - 如下所示：

```
<?php
   session_start();
   header("Location: folder/".$_SESSION['foo']."/file.png");
   exit();
?> 
```

但是，如果您无法更改源 URL，则首先必须重定向`bla.png`到，`bla.php`但我想您知道该怎么做 :-)

在使用 MPV/MVC 模型的框架中，出于某种原因，通常会有用于“路由”的脚本——例如这个。
或者，您可以从这个脚本中创建一个“php-router”，在使用时添加一些其他依赖 PHP 的重定向，`if/elseif/else`或者`case`选择将发生什么 - 重定向将去哪里。

### 或者

无论如何，您可能正在使用会话 - 那么为什么不直接在 PHP 中生成 url，例如：
`$url = "example.com/bla.png?foo=".$_SESSION['foo'];`+ regexp in`.htaccess`甚至：
`$url = "example.com/folder/".$_SESSION['foo']."/file.png";`
无论如何，我猜您正在重定向，因为您不能（出于某种原因）这样做。:-)

# 解决方法

如果您仍然认为必须在 .htaccess 文件中执行此操作，这里有一些解决方法

## 1) 使用cookies

在现代 cookie 经常可用，因此如果您“信任”客户端的 cookie，则可以基于`HTTP_COOKIE`服务器变量制定重定向规则 - 假设您之前存储了名为“ `foo`”的 cookie：

```
RewriteCond %{HTTP_COOKIE} ^(.*)foo=([-_a-zA-Z0-9]+)(.*)$ [NC]        
RewriteRule ^bla.png$ /folder/%2/file.png [R=307,NC,L] 
#possibly use 302 if you like dinosaurs 
```

如您所见，诀窍是`HTTP_COOKIE`为某些条件创建条件检查服务器变量。它基本上说：

> 是否有一个名为“foo”的 COOKIE 只包含“-、_、小写或大写字母或数字”？
> 如果是这样 - 将*example.com/bla.png*重定向到*example.com/folder/CURRENT_FOO_VALUE/file.png*
> 
> **[flags]**：[307 重定向](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html)（R=307），不要介意字母大小写（NC），不要应用其他规则 (L)

好的一点是`HTTP_COOKIE`服务器变量的结构是这样的：

```
name=value; name2=value2 
```

## 2) 不推荐 - 其他解决方法：

### a)`HTTP_SESSION`使用 mod_session 将会话读取到环境变量

有关如何将会话读入env的更多信息，请参阅[mod_session 的 apache 手册。](http://httpd.apache.org/docs/current/mod/mod_session.html)`HTTP_SESSION`多变的。然后该方法将与“COOKIE-workaround”相同。

### b）将所需信息存储在文本文件中，并`RewriteMap`按照@Chris 的建议使用指令读取

但是再次，您将不得不以某种方式检测它可能是哪个“foo”`SSL_SESSION_ID`或其他一些`$_GET/$_POST`参数？

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-12-05T00:30:32.547

我不知道这是可能的。

但我可以想到一些涉及重写 PHP 脚本的解决方法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T09:29:53.787

我不认为这是你可以轻易做到的事情。您可以在 .htaccess 中使用 %{HTTP_COOKIE} 之类的内容来读取 PHPSESSID，但是为了访问会话中的实际数据，PHP 需要做很多额外的工作，因此您必须以某种方式重新实现它（即从存储数据的任何地方读取数据，反序列化等）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-03T05:57:16.773

我不确定这是否适用于您的特定问题，但 RewriteMap 是一个非常有用且经常被忽视的 mod_rewrite 指令。

[http://httpd.apache.org/docs/2.0/mod/mod_rewrite.html#rewritemap](http://httpd.apache.org/docs/2.0/mod/mod_rewrite.html#rewritemap)

如果您可以预先计算会话变量或将它们存储到文本文件（可能在设置它们时），则可以根据任何可用的请求详细信息轻松检索映射条目。

否则，您可以组合一个简单的外部映射器（可能是最简单的 PHP 脚本），它使用 sessionid 来确定会话变量的值并返回正确的 URL 以供重写规则使用。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2008-12-05T00:58:06.533

你不能按照你想要的方式去做。

如果您真的在使用 $_SESSION 变量，那么您可以使用一个 Apache 环境变量，它的值与 $_SESSION 变量的值相同。

查看以下列表，看看它们是否有帮助：
[http ://www.zytrax.com/tech/web/env_var.htm](http://www.zytrax.com/tech/web/env_var.htm)

你必须像这样使用它：

> RewriteRule bla.png 文件夹/%{VAR_NAME}/file.png

# windows - 通过自动脚本重新格式化 Windows lnk 文件

> ID：342518
> 
> 赞同：3
> 
> 时间：2008-12-05T00:21:24.487
> 
> 标签：windows, shortcut, symlink, lnk

*问题：* C盘上有一堆.lnk文件指向J:盘，但是J:盘不见了，取而代之的是P:盘。已经采取了各种技巧来让 .lnk 文件仍然可以正常工作，但这变得很烦人，是时候修复这些问题了。

使用 Ruby、Python、WSH.JScript 或 Perl，您能否遍历 .lnk 文件的整个目录树并将它们更改为指向 p:/* 而不是 j:/*？你会怎么做？

*注意：*这对我来说并不是一个完全未知的问题，但我还是会问这个问题，因为以我迄今为止发现的方式管理 .lnk 文件的 API 似乎过于繁琐，无法成为最知名的方式。这是那些“必须有更好的方法”类型的问题之一。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T00:33:51.323

在 WindowsNT Resource Kit 中有一个名为 Shortcut.exe 的命令行实用程序，据我所知，它也可以在 XP/2000/2003 下运行。您可以使用各种命令行开关来修改现有的 LNK 文件以指向新的快捷方式。

我在这里找到了有关它的信息： [http ://www.ss64.com/nt/shortcut.html](http://www.ss64.com/nt/shortcut.html)

我敢说在 Microsoft 网站上搜索 WindowsNT 资源工具包并提取它不会太难。它是一个命令行实用程序，因此您应该能够批处理它以循环遍历所有 LNK 文件并修改它们以使其正确。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-31T10:40:51.377

我们发现这个 VB 脚本运行良好。

[http://www.enterpriseitplanet.com/resources/scripts_win/article.php/3081941](http://www.enterpriseitplanet.com/resources/scripts_win/article.php/3081941)

一些警告：

小心！它从驱动器的根目录运行。如果您在自己的机器上测试它，您可能会重新映射所有 Windows 快捷方式 - 例如。开始菜单上的那些！我们稍微编辑了脚本以获得更多控制（在 Main() 方法中）：

```
 dim onlyFolder
    Set onlyFolder =fso.GetFolder("C:\") 
    SearchFolder onlyFolder

'   for each aDrive in fso.Drives       
'       if aDrive.DriveType = 2 then
'           SearchFolder aDrive.RootFolder
'       end if
'   next 
```

fixlinks.ini 文件不喜欢空行，它必须是偶数行。

它在后台运行，可能会弹出困难目录的权限错误。很难说它什么时候完成，除了最后的确认窗口。可能最好在 Process Explorer 中密切关注它，并在 Vista/etc 上以管理员身份从命令 shell 运行它。

除此之外，工作得很好！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-11-08T08:44:21.537

*只需在JAFAT Archive of Forensics Analysis Tools 项目中*使用 lnk 文件解析器。

[请参阅http://jafat.sourceforge.net](http://jafat.sourceforge.net)上的 lnk-parse-1.0.pl

似乎没有没有依赖关系（尤其是不糟糕的 Windows 材料）。语法很简单，链接文件在标准输出中变成了一个简单的文本。

# xml - 具有枚举和属性的类型的 XML 模式结构

> ID：342523
> 
> 赞同：1
> 
> 时间：2008-12-05T00:25:15.443
> 
> 标签：xml, xsd, schema

我正在尝试在 XML 模式中创建一个类型以强制使用两者的元素：

*   单一属性；和
*   与枚举匹配的简单内容。

在 XML 文档中，元素可能如下所示：

```
<Operator Permutation="true">
  Equals
</Operator> 
```

其中“等于”将是枚举之一。

这可能吗？如果是这样，怎么做？

我试过在 XMLSpy 中做，但没有成功。如果我做一个简单的类型，它只允许没有属性的内容枚举。如果我创建一个复杂类型，它只允许没有内容枚举的属性。

编辑：谢谢，大卫。这很好用，但我只是在限制中添加了这个，所以验证会忽略换行符：

```
<xs:whiteSpace value="collapse"/>
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T00:58:58.403

怎么样

```
 <xs:element name="Operator" type="MixedElement" />

  <xs:complexType name="MixedElement">
    <xs:simpleContent>
      <xs:extension base="EnumType">
        <xs:attribute name="Permutation" type="xs:boolean">
        </xs:attribute>
      </xs:extension>
    </xs:simpleContent>
  </xs:complexType>

  <xs:simpleType name="EnumType">
    <xs:restriction base="xs:string">
      <xs:enumeration value="Equals"/>
      <xs:enumeration value="NotEquals"/>
    </xs:restriction>
  </xs:simpleType> 
```

# c# - 对数据网格列进行排序，我有代码，它有点工作

> ID：342527
> 
> 赞同：0
> 
> 时间：2008-12-05T00:28:19.387
> 
> 标签：c#, datagrid

我正在尝试对数据网格 A 到 Z 的列进行排序，下面的代码除了我在“A”之间得到一个以“c”开头的列（例如，a、a、a、a、c、a、 a,b,b,b)，这发生在我第一次运行代码时。如果我然后使用 columnNames.Reverse(); （Z 到 A）然后重新运行 columnNames.Sort() （A 到 Z）它正确排序。为什么会这样？

```
 List<string> columnNames = new List<string>();
 foreach (DataGridViewColumn col in dataGridView1.Columns)
 columnNames.Add(col.HeaderText);
 columnNames.Sort();
 foreach (DataGridViewColumn col in dataGridView1.Columns)
     col.DisplayIndex = columnNames.IndexOf(col.HeaderText); 
```

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T01:51:53.430

在您的示例中（“（a，a，a，a，c，a，a，b，b，b）”），列名不是唯一的。因此，在名称的排序列表中，“a”的（第一个）索引将为 0，“b”的（第一个）索引将为 5，“c”的（第一个）索引将为 8。

因此，当您遍历列时，您将反复将带有文本“a”的列设置为索引“0”。第二次执行此操作时，该位置的第一列将被移动以腾出空间。结果更像是洗牌而不是排序，最终的顺序取决于原始顺序。这就是为什么第二次排序工作正常的原因——在你的第一次通过时，你将元素排列得“足够接近”以使第二次尝试成功。

像下面这样的东西呢？它将唯一地分配索引，并且它也将更有效。（每次调用 IndexOf 都是 O(N)，所以你的原始代码是 O(N^2) - 这只是 O(N log N)，至少假设列集合在设置索引时不会重新排列太多.)

```
List<DataGridViewColumn> columns = new List<DataGridViewColumn>(dataGridView1.Columns);
columns.Sort( delegate(DataGridViewColumn a, DataGridViewColumn b) {
               return String.Compare( a.HeaderText, b.HeaderText ); }
int n = 0;
foreach( DataGridViewColumn col in columns )
   col.DisplayIndex = n++; 
```

# c# - 所有 .NET 异常都可序列化吗？

> ID：342528
> 
> 赞同：33
> 
> 时间：2008-12-05T00:28:27.560
> 
> 标签：c#, .net, exception

所有 .NET 异常对象都可以序列化吗？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2008-12-05T01:10:03.763

是和不是。正如 Jeff 和其他人所指出的，所有异常类都应该并且几乎总是可序列化的。如果您遇到不可序列化的特定异常类，则很可能是一个错误。

但是在考虑可序列化时，您需要同时考虑直接类和属于该类型成员的所有类型（这是一个递归过程）。异常基类有一个IDictionary 类型的[Data](http://msdn.microsoft.com/en-us/library/system.exception.data.aspx)属性。这是有问题的，因为它允许您或其他任何人将任何对象添加到异常中。如果此对象不可序列化，则异常的序列化将失败。

Data 属性的默认实现会进行一些基本检查，以确保添加的对象是可序列化的。但它在几个方面存在缺陷

*   仅对类型的可序列化性进行顶级检查，并且此检查仅通过检查 Type.IsSerializable （不是 100% 可靠检查）来完成。 
*   该属性是虚拟的。派生的异常类型可以覆盖并使用执行 0 检查的 Hashtable。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-12-05T00:34:40.107

是的，但从历史上看（没有双关语）例外。

换句话说，**所有的异常都应该是可序列化**的，但是来自第三方代码的一些自定义异常可能*不是*，这取决于它们是如何实现的。

例如，在 .NET 1.0 时代，来自官方 Microsoft Oracle 数据库提供商的异常由于代码中的错误而无法序列化。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2012-12-05T21:11:19.820

这个问题已经得到了充分的回答，但是对于刚接触 C# 或序列化的程序员来说，我认为指出一般来说异常是**不可**序列化的，这实际上很有帮助！

这听起来可能有点挑衅，但让我解释一下。

确实，所有异常都实现了 ISerializable 接口，但这只是表明它*应该*是可序列化的。但是实现接口不会使对象可序列化（在这种情况下，这意味着异常可以被序列化*和*反序列化）。

正如其他人指出的那样，对这个问题的最准确答案是**.Net 框架**中的许多但肯定不是所有例外都是可序列化的。但是，如果问题是在更广泛的范围内使用术语“.Net Exception”，例如从 System.Exception*派生*的 Exception ，那么就最佳实践和避免错误而言，更好和更有帮助的答案是我在上面所做的断言，一般来说异常是不可序列化的。

原因如下：如前所述，要使 Exception 真正可序列化，它必须具有正确的构造函数`ctor(SerializationInfo, StreamingContext)`，并且必须使用正确的属性进行修饰。重要的是，如果省略这些约束，它们都不会导致编译器错误！

这意味着从 Exception 派生的任何类都是可序列化的，除非采取这些额外的、可选的（从编译器的角度来看）步骤**。**

即，任何获得如下新异常的未经验/不了解的编码人员刚刚创建了一个不可序列化的异常。

```
class MyNewException : Exception { } 
```

Visual Studio 有一个很棒的“异常”片段，可以让您非常快速地生成新的可序列化异常。但即使在这种情况下，也没有什么可以提醒或帮助程序员实际序列化对象属性。例如，即使下面的类具有适当的构造函数和属性，`MyNewField`如果没有构造函数和 GetObjectData 中的附加代码，该属性也不会被序列化。

```
class MyNewException : Exception 
{
    public MyNewField { get; set; }
} 
```

因此，这里的重点是，如果您出于某种原因必须依赖正确的异常序列化和反序列化，则应该完全意识到，当涉及到任何自定义代码或程序集时，并不能保证它会起作用。此外，由于所需的构造函数通常受到保护，因此您不一定能够轻松验证它是否存在（无需反射）。

在我自己的项目中，我在某些时候创建了异常“代理”，它可以存储来自自身不可序列化的异常的一些信息（例如消息等）。这些可用于序列化某些信息，或者反序列化由没有适当构造函数的异常写入的数据。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-12-05T00:35:14.490

`System.Exception`实现`ISerializable`，但如果后代没有使用签名实现正确的重载构造函数，他们可能不会反序列化`(SerializationInfo,StreamingContext)`。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-05T00:30:46.930

`System.Exception`实现`ISerializable`，它是所有异常的基类，所以是的。

请参阅：http: [//msdn.microsoft.com/en-us/library/system.exception.aspx](http://msdn.microsoft.com/en-us/library/system.exception.aspx)

# silverlight - 安装表达式 web 2 时出错 (-2147024873)

> ID：342529
> 
> 赞同：2
> 
> 时间：2008-12-05T00:28:38.637
> 
> 标签：silverlight, microsoft-expression-web

尝试安装 Microsoft Expression Web 2 或 Microsoft Expression Studio 时，有人遇到过“安装“Microsoft Expression Web 2”产品报告以下错误：-2147024873..”错误吗？这是我遇到的错误，但我无法弄清楚问题所在。我没有安装 beta 或 RC 或 pre beta 软件。我正在使用 office 2003，已经安装了 silverlight 和 .net 1 ,2 3, 3.5 框架。我还有 3.6g 高清可用空间。

我在日志文件中发现的错误如下：

```
LIS: wait for package "{90120000-0115-0409-0000-0000000FF1CE}" to complete caching<br>
LIS failed to cache download "{90120000-0115-0409-0000-0000000FF1CE}-C" resource "Setup.xml". Cache Error 0x80070017<br>
Source Resolution aborted<br>
  LIS: start caching file "Setup.xml"<br>
LIS failed to cache download "{90120000-0115-0409-0000-0000000FF1CE}-C" resource "branding.xml". Cache Error 0x80070017<br>
Source Resolution aborted<br>
  LIS: start caching file "branding.xml"<br>
LIS failed to cache download "{90120000-0115-0409-0000-0000000FF1CE}-C" resource "ShellUI.MST". Cache Error 0x80070017<br>
Source Resolution aborted<br>
  LIS: start caching file "ShellUI.MST"<br>
LIS failed to cache download "{90120000-0115-0409-0000-0000000FF1CE}-C" resource "osetupui.dll". Cache Error 0x80070017<br>
Source Resolution aborted<br>
  LIS: start caching file "osetupui.dll"
LIS failed to cache download "{90120000-0115-0409-0000-0000000FF1CE}-C" resource "Setup.xml". Cache Error 0x80070017<br>
Source Resolution aborted<br>
Log level changed from: Standard to: Verbose<br>
Error: LIS: Failed to cache download "{90120000-0115-0409-0000-0000000FF1CE}-C" resource "Setup.xml". HResult: 0x80070017\. <br>
Rolling back chain<br>
12/04/2008 16:11:48 Rolling back package: OfficeMUI.en-us<br>
There appears to be no rollback work to do for package: OfficeMUI.en-us path: C:\Documents and Settings\chaj17\Local Settings\Temp\XSetup_Web_2008_12_4_16_1_21\438d1ac8_d88e_46eb_ba69_11fef34cce74\Office.en-us\OfficeMUI.MSI<br>
Stopping running ose<br>
LIS: start uncaching for download "{90120000-0010-0409-0000-0000000FF1CE}-C"<br>
LIS: finished uncaching for download "{90120000-0010-0409-0000-0000000FF1CE}-C"<br>
LIS: start uncaching for download "{90120000-002C-0409-0000-0000000FF1CE}-C"<br>
LIS: finished uncaching for download "{90120000-002C-0409-0000-0000000FF1CE}-C"<br>
LIS: start uncaching for download "{90120000-0045-0000-0000-0000000FF1CE}-C"<br>
LIS: finished uncaching for download "{90120000-0045-0000-0000-0000000FF1CE}-C"<br>
LIS: start uncaching for download "{90120000-0045-0409-0000-0000000FF1CE}-C"<br>
LIS: finished uncaching for download "{90120000-0045-0409-0000-0000000FF1CE}-C"<br>
LIS: start uncaching for download "{90120000-0115-0409-0000-0000000FF1CE}-C"<br>
LIS: finished uncaching for download "{90120000-0115-0409-0000-0000000FF1CE}-C"<br>
Stopping running ose<br>
Not showing completion dialog because it was not requested.<br>
Catalyst execution finished: 12/04/2008 16:11:52\.  Return code: -2147024873.<br>
PERF: TickCount=3954562 Name=RunSetup Description=End function<br>
=========================================================================<br>
Error: Installation of the "Microsoft Expression Web 2" product has reported the following error: -2147024873.<br>
Info: Config_Products_InstallNew: End installation of new product: Microsoft Expression Web 2<br>
Error: Config_Products_Install: Installation of Product Microsoft Expression Web 2 (failed): Installation of the "Microsoft Expression Web 2" product has reported the following error: -2147024873\. Stack:    at XSetup.OfficePackage.ConfigureNewInstall(Product product)    at XSetup.Product.ConfigureNewProduct()<br>
Info: Config_Products_InstallNew: End installation of new product: Microsoft Expression Web 2<br>
Info: Expecting to find local release notes at 'http://go.microsoft.com/fwlink/?LinkId=114830'.<br>
Error: XSetup_DoTasks:: Installation of the "Microsoft Expression Web 2" product has reported the following error: Installation of the "Microsoft Expression Web 2" product has reported the following error: -2147024873.. Stack:    at XSetup.XSetupSession.OnDoTasksThreadDoWork(Object sender, DoWorkEventArgs e)<br>
Error: Installation of the "Microsoft Expression Web 2" product has reported the following error: Installation of the "Microsoft Expression Web 2" product has reported the following error: -2147024873..<br>
Info: End Setup session<br>
-------------------------------------------------------------------------------------------------<br>
Error: XSetup_DoTasks:: Installation of the "Microsoft Expression Web 2" product has reported the following error: Installation of the "Microsoft Expression Web 2" product has reported the following error: -2147024873.. Stack:    at XSetup.XSetupSession.OnDoTasksThreadDoWork(Object sender, DoWorkEventArgs e)      at System.ComponentModel.BackgroundWorker.OnDoWork(DoWorkEventArgs e)       at System.ComponentModel.BackgroundWorker.WorkerThreadStart(Object argument)<br> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2008-12-18T20:52:13.637

如果您已安装 Office 2007，请尝试将其卸载。否则，请按照[http://support.microsoft.com/KB/928218](http://support.microsoft.com/KB/928218)上的说明手动卸载它。

然后重新安装 Office 2007 并安装 Expression Web。然后，它应该工作。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-22T08:21:45.860

这里的错误码（-2147024873）对应十六进制的0x80070017，其实就是HRESULT_FROM_WIN32(ERROR_CRC)：

```
Data error (cyclic redundancy check) 
```

我不确定您是从 DVD 还是从您下载的安装程序安装此应用程序，但可能安装源已损坏？如果此页面上的其他建议似乎没有帮助，您可能会考虑重新下载安装二进制文件并重试。不确定它是否能解决您的问题，但如果所有其他方法都失败了，那么值得一试......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-23T18:31:03.463

我在安装 blend 时遇到了类似的问题。我只是将提取的安装文件从临时文件夹复制到“发送错误报告”屏幕之前的另一个位置。我使用 Blend_en.msi 开始设置。就这样，安装成功。:) 。

# javascript - 如何在保持 jQuery 透明度的同时向下滑动？

> ID：342532
> 
> 赞同：2
> 
> 时间：2008-12-05T00:30:23.920
> 
> 标签：javascript, jquery, animation

我正在尝试使用 jQuery 为块级元素设置动画。页面加载样式为 的元素`display: none`。我喜欢它`slideDown`虽然透明，然后`fadeIn`使用回调的内容，但是`slideDown`似乎在`fadeIn`调用之前将可见性设置为完全，导致内容在`slideDown`动画期间可见。

有谁知道实现这一目标的方法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T00:55:14.107

您的代码可能存在一些问题：您是否在开始时也将内容设置为隐藏？你`fadeIn`在`slideDown`回调期间打电话吗？

这是一些示例 HTML/代码，将`fadeIn`在`slideDown`

```
$('div').hide(); // make sure you hide both container/content

$('#container').slideDown('slow', function() {
    $('#content').fadeIn('slow');    // fade in of content happens after slidedown
}); 
```

html:

```
<div id="container">
    <div id="content">stuff</div>
</div> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T00:53:45.713

怎么样：

```
$('#hiddenElement').css("opacity", 0).slideDown().animate({opacity:1}) 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T08:28:47.560

你的描述听起来像是[这个](http://dev.jquery.com/ticket/2423)问题的一个变种，前几天我不得不处理这个问题。

它只发生在 IE 中，并且仅在您以 quirks 模式呈现时才会发生。因此，简单的解决方案是切换到标准模式。您可以在[此处](http://hsivonen.iki.fi/doctype/)找到使 IE 以标准模式呈现的文档类型表。

但是如果你和我的情况一样，那不是一个选项，那么你可以为你的 jQuery 库应用一个补丁，你可以在[这里](http://dev.jquery.com/attachment/ticket/1726/1726.diff)找到。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-02-16T20:30:18.600

我需要将 a 添加`li`到 a`ul`并希望它`slideDown`首先添加，然后`fadeIn`.

以下对我有用。我必须首先`.hide()`设置内容，然后将不透明度设置为 0，然后附加内容，然后`slideDown()`将不透明度设置为 1。

在下面的代码中，“内容”是`li`，#ListItems 是`ul`

```
$(content).hide().css("opacity", 0).appendTo("#ListItems").slideDown(500, function () { $(this).animate({ "opacity": 1 }, { queue: false, duration: 500 }); }); 
```

# c# - 在 .net 中使用 PrintDialog 和 PrintPreviewDialog 时 GUI 锁定

> ID：342543
> 
> 赞同：6
> 
> 时间：2008-12-05T00:36:14.550
> 
> 标签：c#, .net, multithreading, user-interface, printing

我正在使用 .net 的 PrintPreviewDialog ，每当它生成预览时，它都会在后台锁定我的 GUI 并让它看起来像是崩溃了，直到预览完成。看到弹出的.net页面进度窗口不是对话框，可以选择背景，然后以半画的方式回到前面，锁定方式。当用户单击预览对话框上的实际“打印”按钮以及我刚刚运行 PrintDocument.Print() 时，也会发生这种情况。当用户等待 .net 绘制打印页面时，是否有一种简单的方法可以修改以下代码以阻止 GUI 挂起：

```
//just showing a preview, hangs up background GUI on generating the preview
// and when user prints straight from the preview
this.printPreviewDialog.ShowDialog(this);

//just trying to print a .net PrintDocument class, GUI hangs in background
// when .net is drawing the pages
this.printDocument.Print(); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-17T01:52:30.117

另一种选择是启动一个新的 UI 线程：

```
ThreadStart ts = () =>
{
    printDocument.Print();

    // Start the message loop to prevent the thread from finishing straight away.
    System.Windows.Forms.Application.Run();
};
Thread t = new Thread(ts);
t.SetApartmentState(ApartmentState.STA);
t.Start(); 
```

请记住，此代码未经测试，可能需要一些调整（尤其是消息循环部分） - 您可能还需要记住，您将需要在某个时间关闭线程 - 所以也许您可能需要一个类处理交互和生命周期管理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-11T11:35:44.527

ShowDialog 方法创建一个模式窗口，它阻塞了主线程。Show 方法创建一个非模态窗口，它不会阻塞主线程。

你打电话时

> this.printDocument.Print();

它再次在主线程中工作。

要在后台线程中执行此操作，您可以尝试类似（在我的脑海中）

> ThreadPool.QueueUserWorkItem ( (obj) => this.printDocument.Print() );

它使用一个新线程来打印文档，而不是主 GUI 线程。

如果你想知道更多，你必须研究线程

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T00:47:00.020

如果它们需要很长时间，您可能应该在不同的线程中调用这些方法。调查使用[BackgroundWorker](http://msdn.microsoft.com/en-us/library/ms233672(VS.80).aspx)来帮助你。

此外，这可能是因为 Windows 打印机而不是您的代码（您是否使用网络打印机？如果是，请更改为虚拟打印机，看看是否有任何改变）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-24T02:56:30.383

[Dot Net Rocks TV (dnrtv) 在第 16 集中](http://www.dnrtv.com/default.aspx?showNum=16)介绍了如何在后台线程中运行以保持 GUI 线程空闲。

# c# - 在 C# 中合并配置文件（或 XML）

> ID：342546
> 
> 赞同：3
> 
> 时间：2008-12-05T00:36:47.667
> 
> 标签：c#, xml, merge

合并2个XML文件的最快方法是什么，所以我会在第一个中找到一个节点，清空它，从第二个XML中的同一标记（同一节点）中获取所有子节点并将其放入第一个。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T03:20:59.897

您可以将两个文件加载到两个`XElement`对象中，在两个对象中定位目标节点并进行切换。

这是一个示例：

```
var nodes1 = XDocument.Parse(file1).Element("test").Element("nodes");
var nodes2 = XDocument.Parse(file2).Element("test").Element("nodes");

nodes1.Nodes().Remove();
nodes1.Add(nodes2.Nodes()); 
```

这是我尝试过的 XML 片段：

```
<测试>
    <节点>
        <node id="1">
            你好
        </节点>
        <node id="2">
            你好，我们又见面了
        </节点>
        <node id="3">
            再一次嗨
        </节点>
    </节点>
</测试>

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T00:50:41.570

查看 MSDN 上的这篇文章：[文章](http://support.microsoft.com/kb/311530)

我认为这是您正在寻找的代码：

```
try
{
    XmlTextReader xmlreader1 = new XmlTextReader("C:\\Books1.xml");
    XmlTextReader xmlreader2 = new XmlTextReader("C:\\Books2.xml");

    DataSet ds = new DataSet();
    ds.ReadXml(xmlreader1);
    DataSet ds2 = new DataSet();
    ds2.ReadXml(xmlreader2);
    ds.Merge(ds2);
    ds.WriteXml("C:\\Books.xml");
    Console.WriteLine("Completed merging XML documents");
}
catch (System.Exception ex)
{
    Console.Write(ex.Message);
}
Console.Read(); 
```

希望有帮助！

# unit-testing - 我的代码与其环境有很强的交互作用。我应该费心进行单元测试吗？

> ID：342553
> 
> 赞同：2
> 
> 时间：2008-12-05T00:42:02.837
> 
> 标签：unit-testing

我正在处理的代码从操作系统收集性能数据（例如 CPU 使用率）。我想知道我是否应该费心尝试对这段代码进行单元测试。似乎要对代码进行单元测试，您需要设计隔离为单元的代码。我的代码与操作系统紧密相关，如果我将与操作系统交互的代码隔离到一个我可以模拟出来的包装器中，那么就没有太多需要测试的东西了。

所以，我认为单元测试在这里不起作用。我是否误解了我应该如何使用单元测试？我读过的博客中的每个人都宣扬它们很好，但我不确定它们是否对所有应用程序领域都有用。

例如，如果我将此代码移动到不同版本的操作系统，我肯定会有很多错误，但我看不出单元测试如何帮助我找到它们。

你有没有发现同样的问题？我什至应该尝试为此编写单元测试吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-05T00:45:18.993

你有任何业务逻辑吗？计算？还是您只是抓取和显示数据？

单元测试对于测试单元很有用。换句话说，您的应用程序的任何部分都可以独立工作吗？如果没有，那么实际上没有任何东西可以进行单元测试。

功能测试是另一回事......

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T01:45:13.067

我很难相信任何人都可以在不使用过程或方法或可以转换为过程或方法的代码块的情况下编写代码。如果你能做到这一点，那么你可以为这些方法编写测试。编写这些测试的过程几乎会迫使您编写比其他方式更清晰、更解耦的代码。如果您的方法与内核数据结构相关联，那么为您的方法编写测试将迫使您为逻辑从这些数据结构中抽象出来，并围绕它们编写薄包装器。您可能无法达到对代码的每一点都进行全面测试的程度，但我认为您会发现——特别是如果您按照@Wambie 的建议首先编写测试开始——您将能够测试比您更多的东西认为可能，你的代码会更好。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T00:59:55.017

您的应用程序的结果是性能测量，但您确定性能指标得到正确测量吗？这就是测试驱动开发大放异彩的地方。你被迫编写你知道逻辑工作的代码，然后当你运行应用程序时，如果你之前所有的测试都通过了，你可以更加确信你的测量是正确的。

测试驱动开发 TDD 正在快速增长，并且是 XP（敏捷）的组成部分之一，似乎正在加速发展。它值得研究。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T01:00:18.387

听起来您可以从一些基本测试中受益，例如：“当我将它移植到另一个操作系统时，整个模块是否会喷出任何数据？”，但除此之外，要务实。

如果这样做实际上对您没有帮助，请不要这样做。为测试而进行的测试是一种浪费时间却无济于事的简单方法。

# outlook - 如何在 Outlook 签名中嵌入图像？

> ID：342554
> 
> 赞同：14
> 
> 时间：2008-12-05T00:42:54.193
> 
> 标签：outlook, signature

是否可以为**Outlook 2003**或更高版本创建不引用外部图像的 HTML 电子邮件签名？

也就是说，使用那些特殊的“cid”引用，但将图像本身嵌入到签名中，而不是在文件系统或网络上。

这适用于基于用户的各种输入生成“标准”电子邮件签名的 Web 应用程序。到目前为止，它使用单个“嵌入式”图像运行良好。但是一项新功能可能需要添加多个小图像。

让用户将一个电子邮件签名模板和一张图像保存到用户的机器上，这大约是我希望对用户提出的要求的限制。但在我看来，强迫用户保存多张图像似乎有点过分了。

所以我的问题是尝试将图像嵌入其中，而不必先通过多次下载给用户带来不便。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T09:12:27.907

如果您使用`file:///`URI 引用图像，Outlook 会自动将其更改为`cid:`URI，并在插入时将图像添加为附件。

BTW：这和编程有什么关系？

**编辑**：好的，考虑到您对问题的更新：恐怕这是不可能的。不过，这不是特定于签名或 Outlook 的限制。这正是 HTML 的工作方式。如果您想要 HTML 文档中的图像，这些图像必须是分开的。如果没有专有格式，这是无法解决的，Outlook 不会接受这些格式作为签名。

但是，如果这是用于 Intranet 应用程序，您可以将图像放在网络共享上并通过 UNC 引用，例如

```
<img src="file://///ServerName/ShareName/FileName.png" /> 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-03-16T22:20:58.067

是否可以对图像进行base64编码？

```
<a href="http://www.britblog.com/">
    <img
        src="data:image/gif;base64,R0lGODlhUAAPAKIAAAsLav///88PD9WqsYmApmZmZtZfYmdakyH5BAQUAP8ALAAAAABQAA8AAAPbWLrc/jDKSVe4OOvNu/9gqA /..../NcV9/j5+g4JADs="
        alt="Signature" width="80" height="15">
</a> 
```

只是一个想法

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2020-06-11T15:56:56.143

所有outlook版本的方式

只需在同一目录中写入带有 img 文件的 .html，用 chrome 打开它，选择并复制签名。打开 Outlook 并转到新帖子 => 签名 => 新签名 => 将其命名 将您的签名粘贴到字段上，然后按保存。工作完成。

PS：请记住只使用 table、tr、td、img、a 标签以避免 Outlook 出现问题。永远不要使用 p div 标签。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T00:59:45.860

如果图像足够小，那么您可以使用[数据 URI](http://en.wikipedia.org/wiki/Data_Uri)做一些事情。

# python - Python 2.6 multiprocessing.Queue 与线程兼容？

> ID：342556
> 
> 赞同：7
> 
> 时间：2008-12-05T00:45:04.517
> 
> 标签：python, multiprocessing, python-2.6

我正在试验 Python 2.6 中的新多处理模块。我正在创建几个进程，每个进程都有自己的 multiprocessor.JoinableQueue 实例。每个进程产生一个或多个工作线程（threading.Thread 的子类），它们共享 JoinableQueue 实例（通过每个线程的`__init__`方法传入）。它似乎通常可以工作，但偶尔会出现无法预料的失败并出现以下错误：

```
 File "C:\Documents and Settings\Brian\Desktop\testscript.py", line 49, in run
    self.queue.task_done()
  File "C:\Python26\lib\multiprocessing\queues.py", line 293, in task_done
    raise ValueError('task_done() called too many times')
ValueError: task_done() called too many times 
```

我的 Queue get() 和 task_done() 调用紧随其后，因此它们应该相等。有趣的是，这似乎只有在 get() 和 task_done() 之间完成的工作非常快时才会发生。插入一个小的`time.sleep(0.01)`似乎可以缓解这个问题。

有什么想法吗？我可以使用带线程的多处理器队列而不是更传统的（Queue.Queue）吗？

谢谢！

-布赖恩

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T02:08:18.530

我还没有在 2.6 中尝试过多处理，但是我玩了很多 pyprocessing（因为它在 2.5 中被调用）。

我可以看到您正在寻找多个进程，每个进程分别产生一组线程。

由于您使用的是多处理模块，因此我建议您使用多进程而不是多线程方法，这样您会遇到更少的问题，例如死锁等。

创建一个队列对象。[http://pyprocessing.berlios.de/doc/queue-objects.html](http://pyprocessing.berlios.de/doc/queue-objects.html)

要创建多进程环境，请使用池：[http](http://pyprocessing.berlios.de/doc/pool-objects.html) ://pyprocessing.berlios.de/doc/pool-objects.html它将为您管理工作进程。然后，您可以将异步/同步应用到工作人员，如果需要，还可以为每个工作人员添加回调。但请记住回调是一个常见的代码块，它应该立即返回（如文档中所述）

一些附加信息：如果需要，创建一个管理器[http://pyprocessing.berlios.de/doc/manager-objects.html](http://pyprocessing.berlios.de/doc/manager-objects.html)来管理对队列对象的访问。您必须为此共享队列对象。但好处是，一旦共享和管理，您可以通过创建代理对象在整个网络上访问这个共享队列。这将使您能够将集中式共享队列对象的方法调用为（显然）任何网络节点上的本机方法。

**这是文档中的代码示例**

*可以在一台机器上运行管理服务器并让客户端从其他机器使用它（假设所涉及的防火墙允许它）。运行以下命令为远程客户端可以使用的共享队列创建服务器：*

```
>>> from processing.managers import BaseManager, CreatorMethod
>>> import Queue
>>> queue = Queue.Queue()
>>> class QueueManager(BaseManager):
...     get_proxy = CreatorMethod(callable=lambda:queue, typeid='get_proxy')
...
>>> m = QueueManager(address=('foo.bar.org', 50000), authkey='none')
>>> m.serve_forever() 
```

*一个客户端可以访问服务器，如下所示：*

```
>>> from processing.managers import BaseManager, CreatorMethod
>>> class QueueManager(BaseManager):
...     get_proxy = CreatorMethod(typeid='get_proxy')
...
>>> m = QueueManager.from_address(address=('foo.bar.org', 50000), authkey='none')
>>> queue = m.get_proxy()
>>> queue.put('hello') 
```

如果您坚持使用安全线程的东西，PEP371（多处理）引用此[http://code.google.com/p/python-safethread/](http://code.google.com/p/python-safethread/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T00:59:29.853

您应该将 Queue 对象作为目标的参数传递。

[多处理文档中的](http://docs.python.org/library/multiprocessing.html)示例：

```
from multiprocessing import Process, Queue

def f(q):
    q.put([42, None, 'hello'])

 if __name__ == '__main__':
     q = Queue()
     p = Process(target=f, args=(q,))
     p.start()
     print q.get()    # prints "[42, None, 'hello']"
     p.join() 
```

> 队列是线程和进程安全的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-02-07T19:43:37.820

你可能会遇到这个错误：

[http://bugs.python.org/issue4660](http://bugs.python.org/issue4660)

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-12-05T01:12:12.683

感谢您及时的回复。正如您所说明的，我将 multiprocessing.Queue 实例作为参数传递给每个 Process 。故障似乎发生在线程中。我通过子类化 threading.Thread 并将队列传递给每个线程实例的“ **init ”方法来创建它们。**这似乎是将队列传递给线程子类的公认方式。我唯一认为多处理队列可能与线程不兼容（尽管它们应该是线程安全的）。

# sql - 示例 [英文] 用于填充表的字典 SQL 脚本？

> ID：342567
> 
> 赞同：5
> 
> 时间：2008-12-05T00:52:47.153
> 
> 标签：sql, dictionary, scripting, spell-checking

有谁知道网络上包含示例英语词典单词脚本的参考链接，可用于填充 SQL Server 中的词典表？

我可以处理 .txt 或 .csv 文件，或类似的文件。

或者，我正在向我的网络应用程序添加自定义拼写检查功能......但我不想集成标准组件。如果在构建字典单词检查器方面有很好的参考资料（带有示例），我也会喜欢的！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T00:58:40.183

[可下载的字典](http://www.dicts.info/uddl.php)

[国际协作英语词典 (XML) 的 GNU 版本](http://www.ibiblio.org/webster/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T01:11:35.350

我实际上要求错误的东西，但我喜欢到目前为止的答案。我真的想要一个用于拼写检查应用程序的英文单词列表，我可以用它来填充 SQL Server 中的表。

这是我终于找到的一个，还可以： [英文单词表](http://pages.prodigy.net/daleharris/speller.htm)
这个更好：[另一个英文单词表](http://www.sil.org/linguistics/wordlists/english/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T02:01:41.193

在[Debian](http://packages.debian.org/changelogs/pool/main/s/scowl/scowl_6-2.3/wamerican-large.copyright)和[Ubuntu](http://changelogs.ubuntu.com/changelogs/pool/main/s/scowl/scowl_6-2.1/wbritish.copyright)上使用：

[SCOWL (Spell Checker Oriented Word Lists)](http://wordlist.sourceforge.net/)是由 Kevin Atkinson 维护的英语单词列表集合...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-07-18T03:17:25.720

您可以使用的一本词典是[http://wordnet.princeton.edu/wordnet/download/提供的 wordnet 词典](http://wordnet.princeton.edu/wordnet/download/)

# cardspace - 替换 MS Cardspace UI

> ID：342570
> 
> 赞同：1
> 
> 时间：2008-12-05T00:53:48.850
> 
> 标签：cardspace

是否可以用您自己的替换 Microsoft Cardspace UI？或者在没有任何 UI 的情况下使用 Cardspace？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-31T16:22:28.823

Google for Chuck Mortimer，他为 Firefox 编写了 Cardspace UI。

# .net - 您知道 Compact 和 Full Framework 代码之间的运行时差异吗？

> ID：342576
> 
> 赞同：15
> 
> 时间：2008-12-05T00:55:36.600
> 
> 标签：.net, compact-framework

这两个 .NET 版本之间的兼容代码存在许多运行时差异。

以下是迄今为止的差异列表：

*   Graphics.DrawRectangle - 相差 1 个像素
*   Graphics.DrawString - 如果与两个 StringAlignments 都设置为 Center 的 StringFormat 一起使用，则会丢失换行。
*   大多数文件操作 - 紧凑框架需要完整路径
*   [BeginAccept 之后的套接字状态](http://blog.opennetcf.com/ctacke/CommentView,guid,80a1fabe-e206-4b93-a0e1-25bfc2185959.aspx)
*   （至少在 WinCE 5 中）您不能使用套接字在超时的情况下同步发送数据（没有也可以，但您有挂起的风险）
*   位图（实际上是所有图像派生类）在[清理资源的](http://blog.opennetcf.com/ctacke/2006/08/22/BitmapsInTheCompactFramework.aspx)方式上表现不同。- 克塔克
*   CF 中标签和树视图的默认字体更大 - Darwyn
*   当一个标签在 CF 中被禁用时，它只是变灰（完整的 .net 框架用另一种颜色勾勒出文本） - Darwyn
*   组装路径在桌面上以与 System.Reflection.Assembly.GetExecutingAssembly().GetName().CodeBase 不同的格式返回 - Qwertie

我们还有什么要补充的吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-05T00:58:14.053

根据您要查找的内容，MSDN 上有一篇[.NET Compact Framework 和 .NET Framework 之间的差异](http://msdn.microsoft.com/en-us/library/2weec7k5.aspx)文章。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-24T17:53:05.097

从 Mitchel Sellers 的列表中，这些是使 Compact 编程……有趣的一些特征。

.NET Compact Framework 的公共语言运行时大约是完整的 .NET Framework 公共语言运行时大小的 12%。

当前目录的功能在 Windows Embedded CE 操作系统中不存在。

Windows Embedded CE 将在没有路径信息的情况下指定的文件名解析为位于设备的根目录中，而不是位于应用程序目录中。

.NET Compact Framework 处理以 file:// 为前缀的统一资源标识符 (URI) 字符串与完整的 .NET Framework 不同。

由于大小和性能方面的考虑，.NET Compact Framework 不支持使用 BinaryFormatter 的二进制序列化或使用 SoapFormatter 的 SOAP 序列化。

并非所有套接字选项都受支持。

由于设备 I/O 发生在 RAM 中，因此无法设置或访问文件和目录属性。

* * *

控制台仅由硬件供应商选择提供。

只有 .NET Framework 的 12%。我巧妙地发现这意味着 88% 的缺失。你可能会想要一些。

非常了不起，因为它不适合几百 MB，所以被省略或扭曲了；与传统移动设备的通常小于 10 MB 相比。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-14T09:52:35.810

当我不得不将 CF 应用程序移植到完整的 .net 框架时，我注意到了一些差异。

*   CF 中标签和树视图的默认字体较大

*   当标签在 CF 中被禁用时，它只是变灰（完整的 .net 框架用另一种颜色勾勒出文本）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-14T15:50:48.037

位图（实际上是所有图像派生类）在[清理资源的](http://blog.opennetcf.com/ctacke/2006/08/22/BitmapsInTheCompactFramework.aspx)方式上表现不同。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-24T17:32:11.943

组装路径在桌面上以不同的格式返回

```
System.Reflection.Assembly.GetExecutingAssembly().GetName().CodeBase 
```

这会返回 Win CE 下的正常路径，但会在桌面框架上提供 URL（file:///c:/...）。该物业

```
System.Reflection.Assembly.GetExecutingAssembly().Location 
```

在桌面框架中返回正常路径 (C:...)，但在 Compact Framework 中根本不可用。

这是一个返回应用程序所在文件夹的属性：

```
public static string AppFolder
{
    get {
        #if !WindowsCE && !PocketPC
        string exeFile = System.Reflection.Assembly.GetExecutingAssembly().Location;
        #else
        // This returns a normal path under CE, but gives a URL (file:/...) on the desktop
        string exeFile = System.Reflection.Assembly.GetExecutingAssembly().GetName().CodeBase;
        if (exeFile.StartsWith("file:///"))
            exeFile = exeFile.Substring("file:///".Length);
        #endif
        return System.IO.Path.GetDirectoryName(exeFile);
    }
} 
```

# objective-c - 如何从 NSString 中获取每一行？

> ID：342577
> 
> 赞同：7
> 
> 时间：2008-12-05T00:56:02.200
> 
> 标签：objective-c, cocoa, macos

如果我有一个带有文本文件的 NSString，如何获得一个 NSString 的 NSArray，每个 NSString 都包含一行文件。

在 10.5 中，我这样做了：

```
NSArray* lines = [str componentsSeparatedByCharactersInSet: [NSCharacterSet newlineCharacterSet]]; 
```

但这在 10.4 中不起作用，我的程序需要在 10.4 中运行。

同样，它需要使用 \r、\n 和 \r\n 行尾。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-05T01:04:30.077

以下代码直接来自[Apple 关于段落和换行符的文档](http://developer.apple.com/documentation/Cocoa/Conceptual/Strings/Articles/stringsParagraphBreaks.html)：

```
unsigned length = [string length];
unsigned paraStart = 0, paraEnd = 0, contentsEnd = 0;
NSMutableArray *array = [NSMutableArray array];
NSRange currentRange;
while (paraEnd < length)
{
    [string getParagraphStart:&paraStart end:&paraEnd
    contentsEnd:&contentsEnd forRange:NSMakeRange(paraEnd, 0)];
    currentRange = NSMakeRange(paraStart, contentsEnd - paraStart);
    [array addObject:[string substringWithRange:currentRange]];
} 
```

我不是 100% 确定它是否适用于 10.4

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2015-12-11T06:28:00.220

使用枚举字符串中的所有行`enumerateLinesUsingBlock:`

```
[yourString enumerateLinesUsingBlock:^(NSString * _Nonnull line, BOOL * _Nonnull stop) {
    //line
}]; 
```

> **宣言**
> 
> ```
> - (void)enumerateLinesUsingBlock:(void (^)(NSString *line,
>                                    BOOL *stop))block 
> ```
> 
> **参数**
> 
> `block`为枚举执行的块。
> 
> 该块有两个参数：
> 
> `line`被枚举的字符串的当前行。该行仅包含行的内容，不包含行终止符。
> 
> `stop`通过设置 *stop = YES; 块可以用来停止枚举的布尔值的引用；它不应该触摸 *stop 否则。
> 
> **可用性**在`OS 10.6`及 `iOS 4.0`以后可用。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-05T01:46:43.363

我将首先将所有替换`\r`为`\n`，然后将所有替换`\n\n`为`\n`，然后执行一个`componentsSeparatedByString:@"\n"`.

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-05T01:40:20.300

直接来自我的一个项目：

```
 NSString * fileContents = [NSString stringWithContentsOfFile:pathToFile encoding:NSUTF8StringEncoding error:nil];
 NSMutableArray * fileLines = [[NSMutableArray alloc] initWithArray:[fileContents componentsSeparatedByString:@"\r\n"] copyItems: YES]; 
```

我不确定如何让它自动与任何以 10.4 结尾的行一起工作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-05T01:04:27.707

根据[NSString 类参考](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html)，NSString 消息[componentsSeparatedByCharactersInSet:](http://developer.apple.com/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/instm/NSString/componentsSeparatedByCharactersInSet:)在 OS X 10.5 或更高版本中可用。您需要使用 componentsSeparatedByString:。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-04-20T00:14:06.723

您也可以`enumerateSubstringsInRange:`使用`NSStringEnumerationByLines`和/或`NSStringEnumerationByParagraphs`选项。

这样做的好处是可以获得每个子字符串的 NSRange，并且还可以设置要枚举的字符串的初始范围。

```
[myString enumerateSubstringsInRange:NSMakeRange(0, myString.length) options:NSStringEnumerationByLines | NSStringEnumerationByParagraphs usingBlock:^(NSString * _Nullable substring, NSRange substringRange, NSRange enclosingRange, BOOL * _Nonnull stop) {

}]; 
```

# vb.net - 如何将 OpenFileDialog 视图菜单设置为详细视图？

> ID：342578
> 
> 赞同：1
> 
> 时间：2008-12-05T00:56:11.450
> 
> 标签：vb.net

如何将 OpenFileDialog 视图菜单设置为详细视图？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T01:14:49.090

有人在[这里](http://www.codeproject.com/KB/dialog/OpenFileDialogEx.aspx)用win32 api做到了

```
DefaultViewMode:

This property lets you choose which view the OpenFileDialog should 
start in; by default, it opens using the “Details view”. Here you 
can specify a different default view like Icons, List, Thumbnail, Detail, etc 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-26T16:10:51.500

根本不要使用 Senkeys 命令。特别是如果您的程序在 Windows Vista 中运行。

不建议使用 SendKeys，因为您不能完全确定按键是否会发送到正确的位置，因为它们将被发送到出现的第一个可以接受它们的窗口。在这种情况下，风险可能很小，但如果可以的话，通常应该避免使用 SendKeys。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T01:13:07.220

快速谷歌搜索揭示了这一点：

[http://forums.microsoft.com/Forums/ShowPost.aspx?PostID=3843682&SiteID=1](http://forums.microsoft.com/Forums/ShowPost.aspx?PostID=3843682&SiteID=1)

它特别建议：

```
Dim OpenFileDialog1 As New OpenFileDialog
SendKeys.Send("{tab}{tab}{tab}{tab}{tab}{right}{right}{down}{up}{enter}")
OpenFileDialog1.ShowDialog() 
```

哪个不好。它进一步建议找到该对话框的句柄并将按键直接发送到该对话框。您还需要注意，该解决方案很可能会在不同版本的 Windows 中中断。

根据您的情况，它可能会很有用（尽管我确实觉得发布这个很糟糕！）

# css - CSS 单元测试

> ID：342579
> 
> 赞同：68
> 
> 时间：2008-12-05T00:56:55.927
> 
> 标签：css, unit-testing

一些快速搜索发现我显然[不是](http://morethanseven.net/2008/10/13/unit-testing-css-looking-solution/) [第一个](http://www.thoughtballoon.co.uk/blog/2008/11/11/example-css-style-guide-unit-testing-for-css)想到**“我可以对我的 CSS 进行单元测试吗？”的人。**.

我想知道这里是否有人成功地进行了 CSS 单元测试？如果您尝试过但失败了，或者只是有自己的理论，请告诉我为什么（显然）还没有完成？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-12-05T01:18:30.393

您可以使用 Selenium，它是一个 Web 测试框架。通过这种方式，您可以断言要对 DOM 中的元素应用哪些样式等。

[硒](http://docs.seleniumhq.org/)

否则，不确定您的目标是什么。顾名思义，单元测试是测试“单元”，对我来说，这仅对代码有意义，而不是 css。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2014-10-21T18:48:29.533

有一个名为[Quixote](https://github.com/jamesshore/quixote)的新 css 单元测试库。它不是在视觉上比较图像，而是查看代码。与 Selenium 不同，您不必断言特定样式，而是可以说“它应该居中”或“左侧应该比其他元素的右侧更远 10px”。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2014-03-12T02:01:12.860

我不明白为什么我们不能或不应该对 CSS 进行单元测试。这是我想到的场景：

我有一个由多个模块化 CSS 文件组成的 CSS 框架，可以驱动我的 5 个网站。

```
Ex : base.css / form.css / article.css etc. 
```

想象一下，我对 base.css 进行了更改，以满足仅适用于站点 #1 的要求 => 我可能会破坏站点 #2 的样式。

`LESS`如果我的 CSS 框架构建在or之上，那么 CSS 单元测试将更加相关`SASS`：宏中的更改可能会破坏所有样式。.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2014-07-21T15:38:09.293

我认为可以在浏览器（客户端）中“单元测试”CSS。它更像是一个自动检查器，而不是单元测试：

1.  评估我们希望为特定 CSS 类或 ID（结果）保留的最终 CSS 属性条件。
2.  我们需要一个测试文档 HTML 来呈现静态内容和 CSS。所有元素都应包含在单独容器中的内容中。
3.  渲染后，使用 javascript 检查所选目标的最终或结果最终属性并输出不匹配的元素。

单元测试用例：

DOM 选择器：

```
.test1
.test2
#test3 
```

这应该始终是最终属性：

```
CSSAttribute1, CSSFinalValue1
CSSAttribute2, CSSFinalValue2
CSSAttribute3, CSSFinalValue3 
```

在 JS 中设置测试规则的函数可以是：

```
addCSSUnitTest(".test1, .test2, #test3", "margin-left: 4px; font-size: 8px"); 
```

然后我们检查 DOM 元素是否具有这个最终属性。

渲染后全部在javascript中完成。但无论如何，这是不切实际的，因为您将不得不构建许多单元测试用例，这将显着增加您的代码。

此外，您应该始终拥有一个用于跨浏览器“兼容性”的 reset.css。

另一种**方法**是指定您知道应该保留其全部属性的 CSS 类。创建一个 DOM 选择器列表。使用 jQuery 获取 CSS 类属性（直接从 CSS 类）并检查它们是否保留在目标 DOM 元素中。最后一种方法几乎可以完全自动化，但需要更复杂的 javascript 检查器。最后一个不会检查 ID 选择器的 CSS（例如“#test3”），只检查类（例如“.test1”）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2013-11-22T09:04:08.337

您可以使用 PhantomCSS 进行自动视觉比较。然后您可以创建 CSS 模块单元测试页面，该页面仅加载基本 CSS 样式并显示组件的所有状态，但不加载来自其他组件的 CSS。然后你可以将它与加载了所有模块的完整 CSS 文件进行比较。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2016-05-14T09:17:28.163

我们已经在一个大型的、UI 繁重的项目上设置了单元测试，并且效果非常好！它也比看起来容易得多。

[`getBoundingClientRect`](http://devdocs.io/dom/element/getboundingclientrect)使用or之类的简单工具[`getComputedStyle`](http://devdocs.io/dom/window/getcomputedstyle)，将其与[*超脚本配对*](https://git.io/hyperscript)以创建快速的临时 DOM 树，一切顺利。我们编写了[*tape-css以在使用*](https://git.io/tape-css)[*tape*](https://git.io/tape)进行测试时减少样板文件，但堆栈在任何测试设置中都是相似的。

昨天我发表了一篇详细的博客文章，其中包含一个简单的教程和关于我们的新工作流程以及它如何提高我们的生产力的实时示例：[*CSS 单元测试如何帮助我们快速行动*](http://tomek.wiszniewski.cc/how-css-unit-tests-helped-us-move-fast/)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2014-07-25T09:32:22.803

有一种我从未尝试过的有趣方法，但可能会奏效：

1.  您创建提供所有组件等的示例页面（à la [https://getboostrap.com ）。](https://getboostrap.com)
2.  你和[赫胥黎一起测试](https://github.com/facebook/huxley)

等等瞧 :)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-09-11T07:39:04.670

单元测试 CSS，取决于你的框架和你的 CSS 方法。

要问的问题：

测试 CSS 中的给定类，例如 Assert.IsNotNull

获取 CSS 属性并验证其属性。

首先，我会确定是否存在 CSS 文件，然后查找特定类，然后在指定类中查找属性。

我在回归测试期间经历了一个缺失的课程，并设法根据之前的发现立即修复它。

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2008-12-05T15:29:38.347

目前，了解 CSS 是否正常工作是通过视觉确定的。到目前为止，最好的测试方法是在你的开发机器上安装多个浏览器。开始在 Firefox 上使用 Firebug 和 Web Developer 等工具，忘记对 CSS 进行单元测试，直到它完成图灵。:-)

# java - 对域名进行排序

> ID：342590
> 
> 赞同：1
> 
> 时间：2008-12-05T01:00:35.857
> 
> 标签：java, javascript, dns, fqdn

有没有人实现对域名列表进行排序？

我已经看到一些应用程序将它们排序为扁平字符串，但问题是您最终将所有相关主机分散在域中：

a.me.com a.you.com b.me.com b.you.com

所以，我想出的基本逻辑是把标签的顺序倒过来，然后排序。

一个标签的 FQDN 应被视为主机名，并且可能单独排序，可能位于顶部。

理想情况下，我正在寻找 javascript 和 java 版本。

我也不知道这种设计是否适用于较新的国际化域名。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T01:38:23.957

我不特别了解 Java 和 Javascript，但是许多语言提供了某种可以按字典顺序排序的数组数据结构。所以，就像你说的，将“a.example.com”转换成{“com”，“example”，“a”}，然后让默认的排序规则运行。然后，字典排序将完全按照您的意愿进行。

如果您有本地域和 FQDN 的列表，我同意您希望将它们分开。任何没有句号的东西都可以先被过滤掉。或者，您可以将这些全部解析为 FQDN，然后对整个列表进行排序。

一些执行此操作的 Python 代码（应该非常接近地映射到 Javascript）：

```
hosts = ["a.foo.com", "b.foo.com", "foo.com", "c.bar.com"]

split_hosts = []
for h in hosts:
    segments = h.split('.')
    segments.reverse()
    split_hosts.append(segments)

split_hosts.sort()
for segments in split_hosts:
    segments.reverse()
    print ".".join(segments) 
```

这打印：

```
c.bar.com
foo.com
a.foo.com
b.foo.com 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T02:50:55.603

根据[汤姆的回答](https://stackoverflow.com/questions/342590/sorting-domain-names#342667)...

```
 hosts = new Array( "a.foo.com", "b.foo.com", "foo.com", "c.bar.com" );

//print("Unsorted:");
//for (host in hosts )
//     print(hosts[host]);

sorted_hosts = new Array();
split_hosts = new Array();

for(h in hosts)
{
    segments = hosts[h].split('.');
    segments.reverse(); 
    split_hosts.push(segments);
}

split_hosts.sort()

for(h in split_hosts)
{
    split_hosts[h].reverse()
    sorted_hosts.push(split_hosts[h].join("."))
}

//print("Sorted:");
//for (host in sorted_hosts )
//     print(sorted_hosts[host]); 
```

打印语句在[SquareFree JavaScript 开发环境](https://www.squarefree.com/jsenv/)中工作（未注释时），这是一个测试 javascript 片段的方便场所......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T01:31:07.840

这是 80 年代初的 big-endian vs little-endian 战争的结果，little-endian 团队获胜。在英国，域名最初的排序类似于（假设的）“uk.ac.leeds”，用于英国“学术”（University of Leeds）。这是大端排序 - 让您的排序更容易。这也使得在 URL 中欺骗互联网站点变得更加困难。当然，现在的顺序是 little-endian，假设的 URL 是“leeds.ac.uk”。

要将相关域名合理地排序在一起，您必须先实现按最右边的组件（.com、.uk、.org）排序的效果，然后再下一个左边，然后重复......换句话说（如@Bala说），您将不得不做一些类似于拆分名称并从右到左排序的事情。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-01-24T19:02:28.140

这是在 Perl 中的实现方式：

```
#!/usr/bin/perl -w
use strict;

my @hosts = qw(
 bar.org
 a.foo.com
 b.foo.com
 foo.com
 c.bar.com
);

print join("\n", sort {
 $a = lc($a);
 $b = lc($b);
 if ($a eq $b) {
  return 0;
 }
 my @a = reverse(split(/\./, $a));
 my @b = reverse(split(/\./, $b));
 my $max = (scalar(@a), scalar(@b))[@a < @b];
 for (my $i=0; $i < $max; $i++) {
  if (($i < @a) && ($i < @b)) {
   if (my $c = $a[$i] cmp $b[$i]) {
    return $c;
   }
  }
  else {
   return scalar(@a) <=> scalar(@b);
  }
 }
 return 0;
} @hosts) . "\n"; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T01:24:00.583

您可以将域名拆分为单独的字段并进行连续排序。您可以创建一个包含三个字段的域名对象，并创建一个要排序的域名列表。对三个字段中的每一个进行排序。最后，您将获得一个包含相关主机的域名排序列表。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-05-18T17:05:56.850

我想出了这个利用 Array.prototype.sort() 和 ES6 生成器的解决方案：

```
function* reverseIterateParts(domain) {
    let currentEnd = domain.length;
    for (let index = currentEnd-1; index >= -1; index--) {
        if (index == -1 || domain[index] == '.') {
            yield domain.substring(index + 1, currentEnd);
            currentEnd = index;
        }
    }
}

arrayOfDomainNames.sort((domainA, domainB) => {
    let partsOfA = reverseIterateParts(domainA);
    let partsOfB = reverseIterateParts(domainB);
    while (true) {
        let partA = partsOfA.next();
        let partB = partsOfB.next();

        if (partA.done) {
            if (partB.done) {
                return 0;
            }
            return -1;
        }
        if (partB.done) {
            return 1;
        }
        if (partA.value > partB.value) {
            return 1;
        }
        if (partA.value < partB.value) {
            return -1;
        }
    }
}); 
```

# linq-to-sql - Linq2Sql 不能按匿名类型排序？

> ID：342591
> 
> 赞同：1
> 
> 时间：2008-12-05T01:01:17.743
> 
> 标签：linq-to-sql

我有一些按 case 语句排序的 SQL。它工作正常。我无法将其复制为 Linq2Sql。

这是我制作的 SQL 的快速破解版本，经过简化并且非常简单。请忽略 sql 试图做什么（业务逻辑明智），因为我提出了这个问题。

```
SELECT      
    u.Id,
    u.Name
FROM Users u
ORDER BY CASE 
            WHEN u.Name IS NULL THEN 1
            WHEN LEN(u.Name) < 3 THEN 2
            WHEN LEN(u.Name) < 10 THEN 3
            WHEN LEN(u.Name) < 5555 THEN 4
            ELSE 5
        END ASC 
```

当我在一些 Linq2Sql 中尝试这个时 .. 我得到一个匿名错误。

这是 Linq2Sql 代码：_

```
from u in db.User
orderby new {
            UserNameType = (u.Name == null ? 1 :
                            u.Name.Length < 3 ? 2 :
                            u.Name.Length < 10 ? 3 :
                            u.Name.Length < 5555 ? 4 :
                            5)
             }
select u; 
```

有什么帮助我可以通过案例陈述订购吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T01:34:58.953

不要构造匿名类型，只需直接对对象执行条件即可。

```
orderby (u.Name == null ? 1 :
         u.Name.Length < 3 ? 2 :
         u.Name.Length < 10 ? 3 :
         u.Name.Length < 5555 ? 4 :
         5) 
```

# mysql - MySQL中的两列主键

> ID：342596
> 
> 赞同：5
> 
> 时间：2008-12-05T01:04:55.287
> 
> 标签：mysql, indexing, constraints

我有一个非常简单的问题和一个可行的解决方案，但我正在寻找一个更简单的解决方案。

当多个值等于现有值时，我想防止将行添加到数据库中。例如，如果 a2=a1 AND b2=b1 则数据将被拒绝。如果仅 a2=a1 或仅 b2=b1 则允许。基本上我希望它像一个需要两个值匹配的主键。

我知道我可以在写入数据库之前通过验证来做到这一点——例如。选择 * where a='a2' and b='b2' 然后在我得到结果时避免写入新数据。我宁愿做的是启用一个 MySQL 设置，比如主键，它会自动阻止这样的数据。

除了基本功能之外，我对 MySQL 不是很熟悉，所以如果这很简单，我很抱歉。谷歌搜索围绕唯一索引和主键的各种事情并没有帮助。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-05T01:12:09.173

为您希望唯一的列创建唯一索引。

例如：

```
CREATE UNIQUE INDEX index_name ON table(col1, col2); 
```

请参阅 MySQL[创建索引手册](http://dev.mysql.com/doc/refman/5.0/en/create-index.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T01:13:45.863

您想`CONSTRAINT`在创建表（或更改现有表）时使用 MySQL 语法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T02:17:43.237

除了 gcores 所说的之外，我想补充一点，您的替代建议，即在应用程序层进行验证，是一件坏事。如果两个应用程序试图插入相同的数据，并且它们是交错的，会发生什么？他们可能都检查，看到数据不存在，然后都插入。如果使用唯一索引，有两个好处：

*   用户不必再检查该值是否存在。他们只是尝试操作，如果失败，则表示该值已经存在。这会稍微减少数据库的负载，并使应用程序逻辑更简单。
*   数据库将始终有效，因为它自己执行规则。当您可以推断出快速规则时，使用数据库会容易得多，而不是“我们预计不会有重复，但技术上可能……”这样的废话。

# flash - Flash 程序员：你如何让你的代码反编译证明？

> ID：342603
> 
> 赞同：4
> 
> 时间：2008-12-05T01:09:23.313
> 
> 标签：flash, actionscript-3, decompiling, obfuscation

到目前为止，我已经参与了几个 Flash 项目。我熟悉 AS3，但我也开始对其他 flash 程序是如何编写的感到好奇，因此我反编译了一些 swf 文件以查看它们是如何制作的。（我也通读了开源项目，但我没有这么说，因为我对反编译 swf 文件或任何东西感到内疚。）通过研究这些项目，我学到了很多东西。但是有些项目我根本无法理解代码。看起来它们不可能是人类写的！

也许他们被混淆了，对吧？这让我想到：越来越多的网站提供 Flash/Flex 应用程序作为他们的主要服务。我想到的是 Scribd，Sproutbuilder，但你可以想到其他人。这些站点对保护其 Flash 平台中的代码非常感兴趣。

所以这让我想到了我的问题：闪存程序员使用什么样的工具或技术来使您的代码防反编译？

编辑：在发布这个之后，我看到[了查尔斯米勒](https://stackoverflow.com/questions/29399/is-obfuscator-javascript-enough#29471)关于混淆的徒劳的这篇有趣的帖子。他提出了一个公平的观点。软件是对时间的投资，最终有人会投入足够的时间进行逆向工程，即使是最令人生畏的软件工程项目。（提示，提示：Mac OS、Windows、iPhone，应有尽有。）但这并不意味着混淆不会（在短时间内）为率先进入市场的公司提供物质利益和竞争优势. 我是对还是错？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-12-05T01:41:35.133

SWFEncrypt 是我团队中许多人成功使用的一种。显然，直到最近才支持 AS3，但已确认可在 5.0.4+ 中工作

[http://www.amayeta.com/software/swfencrypt/](http://www.amayeta.com/software/swfencrypt/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T09:51:23.180

据我所知，像 swfencrypt 这样的混淆工具更适用于 ActionScript 2，因为它具有 eval() 函数，这是隐藏代码的好方法。但是，我仍然建议使用类似的东西，更重要的是，您在服务器上放置尽可能多的逻辑，它是安全的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T01:39:02.410

有几个商业和免费的动作脚本混淆器，[谷歌搜索](http://www.google.com/search?q=actionscript+obfuscator)出现了几个。我不能保证任何特定的，但我确信它们仍然可以在某种程度上进行逆向工程。

IMO，如果混淆器通过将变量、函数和类重命名为无意义/随机字符而使您的代码不可读，那通常会让想要阅读您的代码或将任何东西拼凑起来而不是琐碎的程序的人灰心丧气.

# database - 在数据库中存储“投票”

> ID：342609
> 
> 赞同：14
> 
> 时间：2008-12-05T01:12:35.753
> 
> 标签：database, vote

我正在编写一个将成为 Intranet 应用程序的东西，其功能之一大致类似于内容投票 - 与 SO、Amazon 和许多其他网站所做的没有什么不同。

假设每个可投票的内容都有一个唯一的 ID，并且每个用户（他们已经过身份验证）都有一个唯一的 ID，最简单的方法似乎是有一个“投票”表......

```
ContentID int
UserID int
VoteValue int 
```

但这会在每次投票中创建一行 - 拥有数百万条内容和数万用户，该表格将非常巨大。这是最好的方法吗？我的意思是，如果一个 int 占用 4 个字节，则每行占用 12 个字节。如果一百万条内容获得一百票，那就是 400MB+ 的存储空间，是吗？似乎......很多:)。即使 VoteValue 是一个 tinyint（这可能很好）并且只有 1 个字节，表中仍然有几百兆字节。我的意思是嘘。

有没有更聪明的方法？我是否应该将此“投票”表存储在单独的数据库中（忽略潜在的数据完整性问题），以便在存储和性能方面将其与“主要”数据分区？

（我确实意识到，在当今世界 400MB 并不是一吨——但存储选票似乎很多，是吗？）

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-05T01:19:04.587

嗯，是的，但你需要看大局。拥有一百万条内容：

（内容大小）>>（投票大小）：其中“>>”表示“更大”。

如果您有一百万条内容，那么这可能是 TB 的数据，而投票数为 400MB。大不了吧？

我还要补充一点，如果您担心可扩展性，请查看此博客：

[http://highscalability.com/](http://highscalability.com/)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-05T01:15:27.700

就个人而言，只要您有良好的索引，您就会以正确的方式进行。根据您的使用情况，为了提高性能，您可能会尝试通过存储辅助计数信息来避免触及投票表，但总体而言，如果您必须跟踪 WHO 投票了某事，则需要按照您列出的方式进行。

我不会费心移动到另一个数据库，如果你真的关心 SQL Server，你可以创建一个单独的文件组来保存它......但很可能没有必要。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-05T01:19:52.433

如果您需要跟踪用户是否为某个特定项目投票，并且如果有不同的投票值（例如 1 星到 5 星），那么这将尽可能紧凑。

不要忘记，为了获得合理的访问速度，您需要索引数据（可能有两个索引 - 一个以 ContentID 作为前导列，一个以 userID 作为前导列）。

您需要确定是否有理由不将该表与其他表分开存储。这意味着什么取决于您使用的 DBMS - 对于 Informix，表将在同一个数据库中但存储在不同的*dbspace*中，并且您可能将索引存储在另外两个不同的 dbspace 中。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-05T03:25:46.767

您可能还需要表格中内容作者的 ID，以便更轻松地检测投票滥用。（是的，这可能是多余的信息。另一种方法是定期构建汇总表以查看谁在对谁投票。）

对于它的价值，perlmonks 投票表如下所示：

```
 `vote_id` int(11) NOT NULL default '0',
 `voter_user` int(11) NOT NULL default '0',
 `voted_user` int(11) default NULL,
 `weight` int(11) NOT NULL default '0',
 `votetime` datetime NOT NULL default '0000-00-00 00:00:00',
 `ip` varchar(16) default NULL,
 PRIMARY KEY  (`vote_id`,`voter_user`),
 KEY `voter_user_idx` (`voter_user`,`votetime`),
 KEY `voted_user_idx` (`voted_user`,`votetime`) 
```

（vote_id 是内容 id，ip 是 IP 地址。）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-06-26T08:41:18.270

我想说你需要弄清楚这些投票将如何被使用，并首先为你的数据模型设计特定的查询。这不一定是 SQL 模型。如果您来自 SQL 世界，通过官方 MongoDB 教程有助于在开始时清除头脑。

例如，如果您只需要存储和显示单个问题页面的投票，则将投票存储在问题的单个字符串字段中可能会很方便，如下所示`id1:id2:id3:`。假设所有 id 的长度相同，则有一些有趣的属性：

1.  计算该问题的所有选票：

    `len(issue.votes)/len(id)`

2.  查找我在该问题上投票

    `myid in issue.votes`

3.  查找您投票的所有问题：

    `select issue.id from issues where issue.votes contains(myid)`

4.  查找投票最多的问题

    `select issue.id from issues order by len(issue.votes) desc limit 10`

这种架构可以避免在这些特定情况下进行昂贵的读取计算，但更新`issue.votes`投票可能比在表中添加一行更昂贵。在这种情况下，每个 id + 分隔符 4 字节的 100 票是 500 字节的字符串。在您提议的变体中，100 票是 800 字节。

免责声明：我从来没有实现过这样的东西，这只是一个想法。

# asp.net - 连接管理 ASP.net

> ID：342613
> 
> 赞同：3
> 
> 时间：2008-12-05T01:13:26.207
> 
> 标签：asp.net, ado.net

您如何管理 ASP.Net 应用程序中的数据库连接？

我的理解告诉我，“最好”的方法是打开连接、进行查询、关闭连接——并多次这样做，因为连接池使成本可以忽略不计。

当我有一个 DAL 时，问题就来了，其中每个方法都照顾自己的连接。例如

```
用户 x = DAL.GetUserDetails();
客户 y = DAL.GetCustomer();

```

这很好，直到我们开始谈论 TransactionScope

```
使用 (TransactionScope t....
{
DAL.UpdateCustomer(y);
DAL.UpdateUser(x);
t.Complete();
}

```

ASP.Net 现在想要使用 DTC，因为（我猜）涉及多个连接。

有人会说“在某处缓存连接”，但由于我管理安全性的方式（执行为/还原），我需要显式销毁连接，并且我不想在每个页面上都进行调用那是因为有人会忘记拨打电话。我也可以将连接传递给每个方法，但这并不理想，因为页面必须管理连接。

我有道理还是我错过了一些基本的东西？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T01:23:41.210

我在某处阅读，我不记得微软将在哪里解决当你有两个连接到同一个数据库时，它们不会升级到 DTC，这会使这个问题消失。

在那之前，我们所做的是开发我们的 TransactionScope，然后我们的 DAL 会向 TS 请求新的连接，当我们释放 TS 时，它会关闭连接。

连接存储在 LogicalCallContext 中，尽管我会考虑使用 HTTP 上下文。我在应用程序上线之前离开了公司，但据我所知，他们没有遇到任何问题。

所以你会有

```
using (CustomTS.New())
{
 CustomerDal.Update()
 userDal.Update()
} 
```

CustomTS 有一个静态方法可以获取当前事务和连接。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T02:43:08.613

以关于 TransactionContext 如何工作的类似想法来实现它。

我开始写如何做到这一点，但我认为一个例子更清楚：

```
public class MyConnectionManager : IDisposable
{
    [ThreadStatic] // static per thread
    private static SqlConnection con;

    public static SqlConnection Connection
    {
        get
        {
            if (con == null)
            {
                con = new SqlConnection();
                con.Open();
            }
            return con;
        }
    }

    public void Dispose()
    {
        if (con != null)
        {
            con.Close();
        }
    }
}

public class Program
{
    public void Run()
    {
        using(new MyConnectionManager())
        {
            MakeCall();
            MakeCall();
        } // Disposal happens here
    }

    public void MakeCall()
    {
        // The property can be accessed from anywhere
        SqlCommand cmd = new SqlCommand("SELECT 1", MyConnectionManager.Connection);
    }
} 
```

这将导致 using 语句范围内的任何调用都使用相同的连接，只要它们都在同一线程上运行。您也可以在其中抛出事务上下文。

警告：在 ASP.NET WebPages 场景中，线程可以在连接和 page_load 之间更改。[请参阅这篇文章了解更多信息](http://piers7.blogspot.com/2005/11/threadstatic-callcontext-and_02.html)。线程也被重复使用。但是，如果您正在开发在应用程序之间共享的 DAL，则可能无法使用 HttpContext，如前所述，因为没有。

# asp.net - 是否有开源的 Asp.net 会员管理 GUI（如 netwebadmin，但可以在线工作）？

> ID：342614
> 
> 赞同：5
> 
> 时间：2008-12-05T01:13:33.007
> 
> 标签：asp.net, sqlmembershipprovider

Visual Studio 2005 附带一个项目，允许您使用 asp.net 成员资格提供程序来查找、添加、编辑和删除用户和角色。不幸的是，它不能在线使用，并且为了在您的站点中拥有一个管理区域，您似乎必须编写自己的管理界面。

有没有具有netwebadmin功能但可以在线使用的开源或免费项目？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T01:33:03.593

您可能想在 codeplex [http://www.codeplex.com/AspNetWSAT](http://www.codeplex.com/AspNetWSAT)上查看这个项目，它有一个您可以使用的管理界面。我认为周围还有其他一些类似的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-02-09T18:59:35.617

我也一直在寻找这些表的 GUI。如此常见的东西应该有一个开源参考来实现。

这是我的搜索发现的一些东西：

[http://msadminse.codeplex.com/](http://msadminse.codeplex.com/)

此链接包含另一个指向更“高级”版本的链接。我使用这段代码没有取得太大的成功，但我可能会抓住一些 UI 元素在我的解决方案中使用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T01:17:07.867

我不知道有任何现成的东西，虽然我有一个通用的解决方案，我一直在考虑打包并作为一般免费赠品提供，但我发现大多数时候需求并不多无论如何都是特定的实现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-26T10:30:25.997

遗憾的是，该项目现已从 codeplex 中删除。有一次计划将其全部重构为控件 iirc。如果有人有任何其他想法，我个人只想要一个快速而肮脏的会员管理部分。

# java - 使用 Rome Java API 访问元数据字段

> ID：342619
> 
> 赞同：3
> 
> 时间：2008-12-05T01:14:55.220
> 
> 标签：java, xml, rome

我一直在使用 Rome API 非常成功地解析来自 XML 提要的数据，但是遇到了一些障碍。

给定以下 XML 片段：

<entry>
<id>uniqueId</id>
<updated>2008-11-05T01:32:35Z</updated>
<mm:status xmlns:mm=" [http://contentprovider.com](http://contentprovider.com&quot) " ; available="true"/ >
<title>标题</title>
...
...
</entry>

使用 SyndEntryImpl 类，我可以使用它的标准方法（getTitle、getPublishedDate 等）来提取标题、id、更新日期等，但还没有找到获取元数据标签的方法（<mm:status .. .)。

获取提要条目的字符串表示将是一个可接受的解决方案，因为我能够使用字符串函数来检索信息，但即使这样我也没有找到一个简单的方法。

过去有没有人遇到过这种情况？

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-18T07:18:22.537

这是我们代码中的原始类，没有太多解释（但这里已经很晚了！）。这会解析元素：

```
import com.sun.syndication.io.ModuleGenerator;
import com.sun.syndication.io.impl.DateParser;
import com.sun.syndication.feed.module.Module;

import java.util.Collections;
import java.util.Set;
import java.util.HashSet;

import org.jdom.Element;
import org.jdom.Namespace;

/**
 * Generates mp content in atom.
 */
public class ModuleGenerator implements ModuleGenerator {

    private static final Namespace NAMESPACE = Namespace.getNamespace("mp", Module.URI);
    private static final Set<Namespace> NAMESPACES;

    static {
        Set<Namespace> namespaces = new HashSet<Namespace>();
        namespaces.add(NAMESPACE);
        NAMESPACES = Collections.unmodifiableSet(namespaces);
    }

    public String getNamespaceUri() {
        return Module.URI;
    }

    public Set<Namespace> getNamespaces() {
        return NAMESPACES;
    }

    public void generate(Module module, Element element) {
        Module myModule = (Module) module;
        if (myModule.getStartDate() != null) {
            Element myElement = new Element("startDate", NAMESPACE);
            myElement.setText(DateParser.formatW3CDateTime(myModule.getStartDate()));
            element.addContent(myElement);
        }
        if (myModule.getEndDate() != null) {
            Element myElement = new Element("endDate", NAMESPACE);
            myElement.setText(DateParser.formatW3CDateTime(myModule.getEndDate()));
            element.addContent(myElement);
        }
    }
}

import com.sun.syndication.feed.module.Module;

import java.util.Date;

/**
 * Module for mp atom extension.
 */
public interface Module extends Module {
    public static final String URI = "http://www.mp.com/namespace";

    public Date getStartDate();
    public void setStartDate(Date date);

    public Date getEndDate();
    public void setEndDate(Date date);
}

public class ModuleImpl extends ModuleImpl implements Module {

    private Date startDate;
    private Date endDate;

    public ModuleImpl() {
        super(Module.class, Module.URI);
    }

    @Override
    public Class getInterface() {
        return Module.class;
    }

    @Override
    public void copyFrom(Object obj) {
        Module module = (Module) obj;
        setStartDate(module.getStartDate());
        setEndDate(module.getEndDate());
    }

    @Override
    public Date getStartDate() {
        return startDate;
    }

    @Override
    public void setStartDate(Date date) {
        startDate = date;
    }

    @Override
    public Date getEndDate() {
        return endDate;
    }

    @Override
    public void setEndDate(Date date) {
        endDate = date;
    }

    @Override
    public String toString() {
        return "ModuleImpl{" +
                "startDate=" + startDate +
                ", endDate=" + endDate +
                '}';
    }
}

package com.mp.core.iomanagement.contentanalyzers.modules;

import java.util.Date;

import org.jdom.Element;
import org.jdom.Namespace;

import com.sun.syndication.feed.module.Module;
import com.sun.syndication.io.ModuleParser;
import com.sun.syndication.io.impl.DateParser;

/**
 * Parses mp content from atom.
 */
public class ModuleParser implements ModuleParser {

    public String getNamespaceUri() {
        return Module.URI;
    }

    public Module parse(Element element) {
        Namespace myNamespace = Namespace.getNamespace(Module.URI);
        Module module = null;
        Date start = null;
        Date end = null;
        final Element startChild = element.getChild("startDate", myNamespace);
        if (startChild!=null) {
            start = DateParser.parseDate(startChild.getText());
        }
        final Element endChild = element.getChild("endDate", myNamespace);
        if (endChild!=null) {
            end = DateParser.parseDate(endChild.getText());
        }

        if (start!=null || end!=null) {
            module = new ModuleImpl();
            module.setStartDate(start);
            module.setEndDate(end);
        }
        return module;
    }
} 
```

罗马属性：

```
atom_1.0.item.ModuleParser.classes=\
com.mp.core.iomanagement.contentanalyzers.modules.ModuleParser

atom_1.0.item.ModuleGenerator.classes=\
com.mp.core.iomanagement.contentanalyzers.modules.ModuleGenerator 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-06-14T21:16:17.097

我只是无法使模块方法起作用。只是模块对象不存在。无论是在提要还是入门级别。幸运的是，方法 feed/entry .getForeignMarkup() 确实对我有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T22:20:52.590

如果您还没有使用它，[v1.0RC1](http://wiki.java.net/bin/view/Javawsxml/RomeChangesLog##RomeV10RC1)有几个解析修复。也许尝试升级？

# c - K&R 书中的 C 编程练习

> ID：342632
> 
> 赞同：7
> 
> 时间：2008-12-05T01:20:35.193
> 
> 标签：c, kernighan-and-ritchie

知道为什么以下代码不打印输入中的字符数吗？我直接从 K&R 书中得到了这个。目前正在学习 C，这真的很令人困惑，在我看来，我永远不会达到 EOF。如果是这样，那为什么要用这个作为例子呢？

```
#include <stdio.h>

main()
{
    double nc;

    for (nc = 0; getchar() != EOF; ++nc)
        ;
    printf("%d\n", nc);
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-05T01:26:38.097

该程序看起来正确，您的问题是您必须`EOF`在输入后将（文件结尾）发送到命令行，因为标准输入被视为文件。我认为在 linux 终端中，您可以按 Ctrl+D 发送`EOF`...我不确定如何在其他操作系统中执行此操作。要测试此程序，您可能需要更改`EOF`为`'\n'`哪个会导致它在您按 Enter 时停止。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-05T01:25:53.200

程序一直读取数据，`stdin`直到`EOF`收到数据，这是通过在 Unix 控制台上的行首按 Ctrl-D 或在 Windows 控制台的行首按 Ctrl-Z 来完成的。`EOF`以这种方式发出信号后，`printf`将执行显示读取的字符数的函数。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-12-05T01:39:20.973

Your `nc`is a double — 用于**`printf("%lf", nc)`**打印双打。

试试这个

```
#include <stdio.h>

int main(void)
{
    int nc;

    for (nc = 0; getchar() != EOF; ++nc)
        ;
    printf("%d\n", nc);

    return 0;
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-12-05T02:46:40.853

我想澄清到目前为止给出的答案，因为它们似乎使用“发送 EOF”、“收到 EOF”、“EOF 字符”等短语。根据对此答案的评论（感谢），“发送 EOF”和“received EOF”是合法的术语，但请不要认为它是一个字符。

EOF 根本不是一个字符。如果流位于“文件末尾”或发生读取错误，则它是 getchar()（或 fgetc/getc）返回的值。它只是 getchar() 将返回的字符值范围之外的特殊值，它指示错误或文件结束的**条件**。

它被 C 标准定义为负数，而 getchar 将字符作为转换为 int 的无符号字符返回。

编辑：在做一些我应该在我曾经写过的段落之前做的研究时，我意识到我的一些假设是完全错误的。感谢评论者指出这一点。

一旦流（例如标准输入）处于文件结束状态，可以使用 clearerr() 再次清除此状态，并且 getchar() 可以从标准输入读取更多数据。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-05T01:24:46.650

此代码从标准输入中读取字符。当你正常运行这个程序时，标准输入来自用户。在这种情况下，没有办法向程序发送 EOF。

如果您将文件重定向到 (./myprogram < tempfile.txt) 中的标准，此代码将起作用。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-05T06:55:09.277

首先，如前所述，您需要 %lf 而不是 %d 来显示双精度数，否则它将一直显示为零（d 是有符号整数）。然后，如果您想在基于 Windows 的操作系统上手动测试，输入某些字符，请按 Enter，然后在下一行单独按 CtrlZ（这将模拟 EOF）。打印结果将比字符数多一（包括 CtrlZ）。同样，正如 SoapBox 在寻找 EOF 时所指出的那样，当时的想法通常是 Unix，您可以通过标准输入将文件通过管道传输到程序中，这也可以。

# java - Java 字符串参数

> ID：342638
> 
> 赞同：2
> 
> 时间：2008-12-05T01:24:42.110
> 
> 标签：java, parameters, string, idioms

我来自.net 背景，想知道创建返回布尔值并修改通过参数传入的字符串的方法的公认方式。我知道字符串在 Java 中是不可变的，所以下面的代码片段总是会产生一个空字符串。我只能返回布尔值。不能抛出异常。如果我需要将 String 类包装在 StringHolder 中，我可以在哪个包中找到它。

```
public static void DoStuff()
{
    String msg = "";
    if (GetMessage(msg))
    {
       System.out.println(msg);
    }
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-05T01:28:07.143

使用 java.lang.StringBuilder - 基本上是一个可变字符串。但是，返回修改后的字符串会更安全、更“Java 风格”。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-05T12:18:07.907

我强烈建议你不要使用 StringBuilder、holder 或类似的东西。他们是黑客。您想使用字符串，而不是构建器。

最明显的方法是返回一个包含您要返回的数据的对象。David 的 [bombe.livejournal.com's] 解决方案涵盖了这一点，所以我不会重复。但是，我建议不要尝试使其成为通用数据球，而是使其具体化。让它像一个物体，也许它甚至可以成长为真正的行为。（如果你真的想去镇上，隐藏构造函数并给它一个静态创建方法。）

第二种方法，在 Java 中没有得到很好的支持，是反转调用。不是返回结果，而是告诉回调结果。

（更重要的）使用代码将类似于（它看起来有点奇怪，因为它不是特定的，也不是通用的）：

```
String userMessage = thing.doStuff(new StuffHandler<String>() {
    public String stuff(boolean success, String message) {
        return message+" was "+(success ? "succesful" : "unsuccesful");
    }
}); 
```

实现类似于：

```
public interface StuffHandler<T> {
    T stuff(boolean success, String message);
}

[...]

    public <T> T doStuff(StuffHandler<T> handler) {
        handler.stuff(isSuccess(), getMessage());
    } 
```

第三种方法是简单地将方法一分为二。这可能可行，也可能不可行。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-12-05T11:37:35.697

首先，我可能不会有这些要求。我相信他们可以解决。如果您不想这样做，我建议为您的两个结果返回一个容器对象：

```
public class ResultContainer {
    private final boolean success;
    private final String result;
    public ResultContainer(boolean success, String result) {
        this.success = success;
        this.result = result;
    }
    public boolean isSuccess() { return success; }
    public String getResult() { return result; }
} 
```

在您的主要代码中：

```
ResultContainer resultContainer = GetMessage(message);
if (resultContainer.isSuccess()) {
    System.out.println(resultContainer.getResult());
} 
```

`GetMessage()`显然会创建一个 a 的新实例`ResultContainer`并返回它，并用返回值填充。

（使用泛型`ResultContainer`作为练习留给读者。）

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-05T04:55:50.267

通过使用泛型，可以为任何类型的对象重用一个更优雅的持有者类：

```
public class Holder<T> {
  T item;
  public Holder( T item) { set( item);}
  public T get( ) { return item;}
  public void set( T item) { this.item = item;}
} 
```

`DoStuff( )`然后看起来像：

```
public static void DoStuff( ) {
  String msg = "";
  Holder<String> holder = new Holder<String>( msg);
  if ( getMessage( holder)) { System.out.println( holder.get( ));}
} 
```

并且`GetMessage( )`必须打电话给`holder.set( a_string)`.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-05T12:43:27.637

Java 是一种基于类的面向对象语言，因此它的习惯用法倾向于创建类来封装数据及其周围的行为。

你有一个数据 - 消息 - 以某种方式获得，然后如果满足某些条件，则对其进行其他操作。使该行为成为外部控制对象中的一系列获取、ifs 和其他操作通常表明程序员还没有理解 OOP。

> 我只能返回布尔值。不能抛出异常。

我可以建议您使用 Fortran 或 C 而不是 Java 吗？过程语言通常具有变异和返回标志的习惯用法，这非常适合该范例（在没有自动内存管理的情况下，调用者创建并传入一个填充的缓冲区；这允许缓冲区在以下情况下安全释放调用者完成了它；Java 不需要这样做，所以如果您查看说 Map.get() 它返回一个字符串，如果失败则返回 null - 无需管理调用者中的内存）。至少，不要费心试图在惯用的 Java 中找到公认的方法——有了这些限制，它就不会了，而且强迫它们的人做出了错误的选择，这意味着你要么有黑客，或者以试图制作非hacky解决方案的冗长代码结束。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-05T01:28:44.287

您不能使用字符串作为输出参数。这样做的方法是使用 StringBuilder 类，或者返回 null 以表示失败。

[在这里讨论](http://www.javapractices.com/topic/TopicAction.do?Id=37)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-05T01:29:38.577

字符串是不可变的，所以是的，您需要将字符串包装在 StringHolder 中。你可以写你自己的，就像

```
 class StringHolder
  {
     String msg;
  }

  StringHolder sMsg = new StringHolder();
  sMsg.msg = "";
  if (GetMessage(sMsg))
  {
     System.out.println(sMsg.msg);
  } 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-05T02:20:11.267

一个平凡的 StringHolder 将是一个 String[1]。

```
 bool GetMessage(String[] output)
{
     if(output.length < 1)
          throw new Exception("Output must be a String[1]");
     output[0] = "You win!";
}

public static void DoStuff()
{
      String[] msg = new String[1];
      if(GetMessage(msg))
      {
          System.out.println(msg[0]);
      }
} 
```

不过，StringBuilder 可能是执行此操作的规范方法。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-05T03:00:07.863

这是一个奇怪的要求。

为什么不以正确的方式（或至少以 java 方式）？就像试图从一个函数中获得两个结果。就像减法（ 2 , 2 ）返回 0 和“早上好先生”一样。

无论如何，您可以尝试这两个选项。

第一个。*StringBuilder*不是最好用的东西，因为你不是在“构建”一个字符串。

```
public static void doStuff(){
    String msg = "";
    StringBuilder sb = new StringBuilder();
    if ( getMessage( sb ) ) {
        System.out.println( sb );
    }
}

public static boolean getMessage( StringBuilder sb ) {
    if ( "".equals( sb.toString() )) {
        sb.delete( 0, sb.length() );
        sb.append("It was empty");
        return true;
    } else {
        return false;
    }
} 
```

第二个*StringHolder*（任何持有者）也不是太 java 风格，但做的工作。这将是我认识的大多数 java 开发人员使用的。

```
public static void doStuff(){
    String msg = "";
    String [] holder = { msg };
    if ( getMessage( holder ) ){
        System.out.println( holder[0]  );
    }
}
public static boolean getMessage( String [] holder ) {
    if ( "".equals(  holder[0] )) {
        holder[0] = "It was empty";
        return true;
    } else {
        return false;
    }
} 
```

第三。选项。不是你问什么，而是我会做什么。不幸的是违反了“返回布尔”条件。

```
public void doStuff() { 
    String msg = "";
    String result = getMessage( msg );
    if ( result != msg ) {
        System.out.println( result );
    }
}
public static String getMessage( String msg ) {
    if ( "".equals(msg){
        return "It was empty";
    }
    return msg
} 
```

选一个。

*笔记*

虽然不是每个人都喜欢这个（Jon Skeet 会说“不被普遍接受”），但请看一下我正在使用的 java 编码风格（方法以小写开头，大括号在同一行中）。有时尊重你正在编码的平台很重要。至少我在 C# 中编码时就是这样做的（顺便说一句很少）

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-20T01:43:22.513

`public boolean doStuff(String msg) { boolean boolTest = false; msg += "Appending something to msg"; int msgLength = msg.length(); if ( msgLength > 80 ) { boolTest = true; return boolTest; } return boolTest; }`

这就是你要找的吗？我假设布尔测试类似于测试更改的消息是否太长而无法显示（大于 80 长度）或类似的东西，并且您不需要调用其他方法来更改 doStuff 内部的消息字符串()。

不过，这里可能完全不在基地。:-)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-20T02:18:28.420

首先，你编写程序并用这样的代码制作它们：

```
Process p = Runtime.exec("java GetMessage.class " + String); 
```

给你的提示： Runtime.exec 应该在任何地方使用。然后你可以制作很多程序。

然后你等待取回这样的状态码：

```
if (p.returnCode() = 1) 
  Out.printWord("1 made back"):
else 
  {
  Out.printWord("B Made back");
  } 
```

这样你就可以在这个程序之外使用其他程序。使代码可重用是件好事。把它从我这里拿走，我已经参与了很多年。这就是专业人士编写代码的方式。

# php - PHP 的 Mailparse pecl 扩展的任何好的文档/教程

> ID：342641
> 
> 赞同：4
> 
> 时间：2008-12-05T01:25:39.613
> 
> 标签：php, email, attachment, pecl

我正在寻找有关如何使用 PHP 的 Mailparse pecl 扩展的指导。PHP 网站上的[文档](http://us2.php.net/manual/en/book.mailparse.php)不是很有帮助。

有没有人有这方面的经验并愿意分享一些建议？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-18T15:42:37.070

您可以联系 PECL [mailparse 包维护者](http://pecl.php.net/package/mailparse)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-05-11T01:25:18.090

[扩展附带](http://blucel.co.uk/a/mailparse-2.1.5/README)的 README 文件中有补充文档，包括以下 OO 示例，我发现它很有帮助。

```
<?php
$file = "/path/to/rfc822/compliant/message";
// parse the message in $file.
// The file MUST remain in existence until you are finished using
// the object, as mailparse does not cache the file in memory.
// You can also use two alternative syntaxes:
// 
// Read the message from a variable:
//   $msg =& new MimeMessage("var", $message);
//
// Read the message from a stream (from fopen).
// The stream MUST be seekable, or things will not work correctly.
// Also, you MUST NOT fclose the stream until you have finished
// using the message object (or any child objects it returns).
//   $msg =& new MimeMessage("stream", $fp);
//
$msg =& new MimeMessage("file", $file);

// Process the message.
display_part_info("message", $msg);

// Little function to display things
function display_part_info($caption, &$msgpart)
{
echo "Message part: $caption\n";

// The data member corresponds to the information
// available from the mailparse_msg_get_part_data function.
// You can access a particular header like this:
//   $subject = $msgpart->data["headers"]["subject"];
var_dump($msgpart->data);

echo "The headers are:\n";
// Display the headers (in raw format) to the browser output.
// You can also use:
//   $msgpart->extract_headers(MAILPARSE_EXTRACT_STREAM, $fp);
//     to write the headers to the supplied stream at it's current
//     position.
//
//   $var = $msgpart->extract_headers(MAILPARSE_EXTRACT_RETURN);
//     to return the headers in a variable.
$msgpart->extract_headers(MAILPARSE_EXTRACT_OUTPUT);

// Display the body if this part is intended to be displayed:
$n = $msgpart->get_child_count();

if ($n == 0) {
    // Return the body as a string (the MAILPARSE_EXTRACT parameter
    // acts just as it does in extract_headers method.
    $body = $msgpart->extract_body(MAILPARSE_EXTRACT_RETURN);
    echo htmlentities($body);

    // This function tells you about any uuencoded attachments
    // that are present in this part.
    $uue = $msgpart->enum_uue();
    if ($uue !== false) {
        var_dump($uue);
        foreach($uue as $index => $data) {
            // $data => array("filename" => "original filename",
            //                "filesize" => "size of extracted file",
            //               );

            printf("UUE[%d] %s (%d bytes)\n",
                $index, $data["filename"],
                $data["filesize"]);

            // Display the extracted part to the output.
            $msgpart->extract_uue($index, MAILPARSE_EXTRACT_OUTPUT);

        }
    }

} else {
    // Recurse and show children of that part
    for ($i = 0; $i < $n; $i++) {
        $part =& $msgpart->get_child($i);
        display_part_info("$caption child $i", $part);
    }
}
}

?> 
```

# sql - SQL“SELECT IN（Value1，Value2 ...）”将值变量传递到GridView

> ID：342655
> 
> 赞同：4
> 
> 时间：2008-12-05T01:30:59.150
> 
> 标签：sql, gridview, select, session-variables

在使用`SELECT..WHERE..<field> IN (value1, val2...)`.

在“配置数据源”选项卡中，如果我对值进行硬编码`SELECT .... WHERE field1 in ('AAA', 'BBB', 'CCC')`，则系统运行良好。

但是，如果我定义一个新参数并使用变量传递一个串联的值字符串；无论是@session、Control 还是查询字符串；例如`SELECT .... WHERE field1 in @SESSION`结果总是空的。

我做了另一个实验，将参数内容减少到只有一个值，效果很好。

简而言之，如果我对一串值进行硬编码，它就可以工作，如果我只传递一个具有单个值的变量，它就可以工作，但是如果我传递一个具有两个值的变量；它失败了。

请告知我是否犯了任何错误或者这是一个已知的错误。

BR SDIGI

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2012-10-01T03:44:20.610

这行得通。不确定它的效率如何。

```
CREATE PROCEDURE [dbo].[get_bars_in_foo]
    @bars varchar(255)
AS
BEGIN
    DECLARE @query AS varchar(MAX)
    SET @query = 'SELECT * FROM [foo] WHERE bar IN (' + @bars + ')'
    exec(@query)
END

-- exec [get_bars_in_foo] '1,2,3,4' 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T01:35:12.153

看看这个问题的答案（和你的很相似）

[参数化 SQL IN 子句](https://stackoverflow.com/questions/337704/parameterizing-a-sql-in-clause)

最终（通过复杂的路线）链接到这个明确的答案：

[http://www.sommarskog.se/arrays-in-sql.html](http://www.sommarskog.se/arrays-in-sql.html)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T01:52:02.290

如果你使用存储过程，你可以使用[这个方法](http://www.mitchelsellers.com/blogs/articletype/articleview/articleid/232/pageid/119.aspx)，我讨论过如何在 SQL 中做到这一点。

# windows-vista - 设置（个人）可执行/代码时间戳服务需要什么？

> ID：342665
> 
> 赞同：3
> 
> 时间：2008-12-05T01:36:28.593
> 
> 标签：windows-vista, code-signing, trusted-timestamp

我们目前正在使用威瑞信的时间戳服务，但时间戳服务器每隔一段时间就会变得不可用 - 主要是由于我们的 ISP 失败。

我们现在为我们构建的所有内容添加时间戳，甚至是简单的开发构建，因为我们在 Vista 无法正确运行未签名/未标记文件时遇到了很多麻烦。

我们可以设置一个时间戳服务来做同样的事情吗？我环顾四周，并没有真正找到任何以我目前的知识水平告诉我可以或不可以做到的信息。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-05-30T20:05:06.340

我一直在寻找同样的东西，到目前为止，我们正在使用带有免费 VeriSign 时间戳的 Thawte 代码签名证书。Wikipedia 上的[Trusted timestamping](http://en.wikipedia.org/wiki/Trusted_timestamping)文章有 2 张很好的图片来说明其工作原理以及底部的一些外部链接，包括指向 RFC 和 ANSI ASC 的链接。其中一个链接指向 digistamp.com，他们在那里提供大量服务，还出售 SecureTime 服务器和许可证。目前的标价是 30,000 美元，外加 4,500 美元的年度维护和审计费用，远远超过我们支付的费用。

我仍然不清楚的一件事是需要多久联系一次时间戳服务。如果它只需要在签名期间联系服务一次，那没关系，但如果每次访问证书时都需要联系服务，最好有我们自己的。我在开源社区中还没有看到过这样的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-07T07:22:56.830

“我们可以设置一个时间戳服务来做同样的事情吗？”

使用[http://www.opentsa.org/](http://www.opentsa.org/)

# windows - 如何使用带有完成例程的 ReadDirectoryChangesW() 方法？

> ID：342668
> 
> 赞同：12
> 
> 时间：2008-12-05T01:38:33.487
> 
> 标签：windows, asynchronous, readdirectorychangesw

我想`ReadDirectoryChangesW()`在提供 I/O 完成例程的异步模式下使用函数。

问题是我不知道如何检索有关完成例程（`CALLBACK`函数）中更改的确切信息。完成例程定义如下：

```
VOID CALLBACK FileIOCompletionRoutine(
  [in]                 DWORD dwErrorCode,
  [in]                 DWORD dwNumberOfBytesTransfered,
  [in]                 LPOVERLAPPED lpOverlapped
); 
```

我想知道信息是否包含在`LPOVERLAPPED`结构中。但我不知道如何得到它。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2015-10-03T23:57:05.147

好问题！已经晚了 7 年，但这里有一个答案，或者更重要的是，**如何找到它**。因此，ReadDirectoryChangesW 的文档：

[https://msdn.microsoft.com/en-us/library/windows/desktop/aa365465%28v=vs.85%29.aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365465%28v=vs.85%29.aspx)

在参数部分给出了 FileIOCompletionRoutine 的链接：

[https://msdn.microsoft.com/en-us/library/windows/desktop/aa364052%28v=vs.85%29.aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/aa364052%28v=vs.85%29.aspx)

在示例部分中提供了使用完成例程的命名管道服务器的链接：

[https://msdn.microsoft.com/en-us/library/windows/desktop/aa365601%28v=vs.85%29.aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365601%28v=vs.85%29.aspx)

信不信由你甚至不使用ReadDirectoryChangesW，但实际上给出了一个使用ReadFileEx的例子，它*也*使用了FileIOCompletionRoutine：

[https://msdn.microsoft.com/en-us/library/windows/desktop/aa365468%28v=vs.85%29.aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365468%28v=vs.85%29.aspx)

您可以在这段代码中看到使用这两个函数（ReadFileEx 和 CompletedReadRoutine（这是应用程序定义的回调函数 FileIOCompletionRoutine 的实现））的示例：

```
// CompletedWriteRoutine(DWORD, DWORD, LPOVERLAPPED) 
// This routine is called as a completion routine after writing to 
// the pipe, or when a new client has connected to a pipe instance.
// It starts another read operation. 

VOID WINAPI CompletedWriteRoutine(DWORD dwErr, DWORD cbWritten, 
    LPOVERLAPPED lpOverLap) 
{ 
    LPPIPEINST lpPipeInst; 
    BOOL fRead = FALSE; 

// lpOverlap points to storage for this instance. 

    lpPipeInst = (LPPIPEINST) lpOverLap; 

// The write operation has finished, so read the next request (if 
// there is no error). 

    if ((dwErr == 0) && (cbWritten == lpPipeInst->cbToWrite)) 
        fRead = ReadFileEx( 
            lpPipeInst->hPipeInst, 
            lpPipeInst->chRequest, 
            BUFSIZE*sizeof(TCHAR), 
            (LPOVERLAPPED) lpPipeInst, 
            (LPOVERLAPPED_COMPLETION_ROUTINE) CompletedReadRoutine); 

// Disconnect if an error occurred. 

    if (! fRead) 
        DisconnectAndClose(lpPipeInst); 
} 

// CompletedReadRoutine(DWORD, DWORD, LPOVERLAPPED) 
// This routine is called as an I/O completion routine after reading 
// a request from the client. It gets data and writes it to the pipe. 

VOID WINAPI CompletedReadRoutine(DWORD dwErr, DWORD cbBytesRead, 
    LPOVERLAPPED lpOverLap) 
{ 
    LPPIPEINST lpPipeInst; 
    BOOL fWrite = FALSE; 

// lpOverlap points to storage for this instance. 

    lpPipeInst = (LPPIPEINST) lpOverLap; 

// The read operation has finished, so write a response (if no 
// error occurred). 

    if ((dwErr == 0) && (cbBytesRead != 0)) 
    { 
        GetAnswerToRequest(lpPipeInst); 

        fWrite = WriteFileEx( 
            lpPipeInst->hPipeInst, 
            lpPipeInst->chReply, 
            lpPipeInst->cbToWrite, 
            (LPOVERLAPPED) lpPipeInst, 
            (LPOVERLAPPED_COMPLETION_ROUTINE) CompletedWriteRoutine); 
    } 

// Disconnect if an error occurred. 

    if (! fWrite) 
        DisconnectAndClose(lpPipeInst); 
} 
```

这不是一个很好的答案（我只是在探索我是否想使用这些功能，我自己），但它应该可以帮助人们入门。

也可以看看：

[https://msdn.microsoft.com/en-us/library/windows/desktop/aa365261%28v=vs.85%29.aspx](https://msdn.microsoft.com/en-us/library/windows/desktop/aa365261%28v=vs.85%29.aspx)

# c# - 使用泛型封装常用方法工作

> ID：342675
> 
> 赞同：4
> 
> 时间：2008-12-05T01:41:47.507
> 
> 标签：c#, generics

我有许多 WebService 方法，它们都包括一些非常样板的代码，这些代码将实际工作包装在 try/catch/finally 中，并在 catch/finally 中执行相同的任务。因此，作为封装所有共享 catch/finally 内容的一种方式，我编写了一个简单的泛型。

这很有效，确实消除了一堆重复的代码，但感觉很笨拙，语法也很迟钝。每次我回到这个问题时，我的大脑都会变得扭曲，试图弄清楚（一个明显的迹象，它不是一个好的设计）。我正在寻找有关这是否是一件疯狂的事情以及是否有更好的方法来处理它的反馈。

这是我的模板：

```
public delegate T2 RestfulServiceRequest<T1, T2>(T1 req);

static class RestfulService
{
    public static T2 ExceptionHandler<T1, T2>(RestfulServiceRequest<T1, T2> serviceCall, T1 req)
    {
        if (req == null)
           throw new BadRequestException(new ArgumentNullException("Invalid or missing request object"));

        try
        {
            return serviceCall(req);
        }
        catch (RestfulException e)
        {
            // log it and rethrow
            Logger.Write(e);
            throw;
        }
        catch (Exception e)
        {
            Logger.Error(e);

            // wrap in a consistent exception for propagation back to caller
            throw new InternalServerException(e);
        }
        finally
        {
            Logger.Debug("Complete");
        }
    }
} 
```

}

这是它的用法：

```
public class Initialization : IInitialization
{
    // MyMethod thas uses the template
    public ApplianceInitResp CreateApplianceServer(ApplianceInitReq req)
    {
        return RestfulService.ExceptionHandler<ApplianceInitReq, ApplianceInitResp>(delegate(ApplianceInitReq x)
        {
            // do some work
            return new ApplianceInitResp();
        }, req);
    }
} 
```

}

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T05:41:50.533

我会改变

```
public static T2 ExceptionHandler<T1, T2>(RestfulServiceRequest<T1, T2> serviceCall, T1 req) 
```

到

```
public static T2 Invoke<T1, T2>( this T1 req, RestfulServiceRequest<T1, T2> serviceCall) 
```

这会将调用更改为

```
public class Initialization :IInitialization {
    public ApplianceInitResp CreateApplianceServer( ApplianceInitReq req ) {
        return req.Invoke( r => {
            // do some work
            return new ApplianceInitResp();
        });
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T02:06:25.193

使它更简洁的一件事是定义您的请求/响应对象实现的接口。然后，您可以摆脱泛型以支持接口。还要注意，我认为更能描述您真正想要做的事情的名称更改。

```
public interface IServiceResponse { ... }
public class ApplianceInitResp : IServiceResponse { ... }
public interface IServiceRequest { ... }
public class ApplianceInitReq : IServiceRequest { ... }

public delegate IServiceResponse RestfulServiceRequest( IServiceRequest req );

static class RestfulService
{
    public static IServiceResponse
        Invoke( RestfulServiceRequest serviceCall, IServiceRequest req)        
    {
        if (req == null)
            throw new BadRequestException( ...inner-exception... );
         try
         {
            return serviceCall(req);
         }
         catch (RestfulException e)
         {
            Logger.Write(e);
            throw;               
         }
         catch (Exception e)
         {
             Logger.Error(e);
             throw new InternalServerException(e);
         }
         finally
         {
             Logger.Debug("Complete");
         }
    }
}

public class Initialization : IInitialization
{
     // MyMethod thas uses the template 
     public ApplianceInitResp CreateApplianceServer(ApplianceInitReq req) 
     {
          return RestfulService.Invoke(
                    delegate(ApplianceInitReq x)
                    {
                        // do some work
                        return new ApplianceInitResp();
                    },
                    req );
     }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T02:07:49.090

我建议您寻找提供 AOP 功能的框架（如 Spring.NET、Unity）。这些将帮助您减少对 CreateApplianceServer() 的调用

```
public ApplianceInitResp CreateApplianceServer(ApplianceInitReq req)
{
    // Do some work
    return new ApplianceInitResp();
} 
```

通过处理方面的入口/出口和异常日志记录。可能，如果您有一些公共参数，您也可以将参数验证插入方面。

当然，会有学习曲线税，但是，相信我，结果值得。您将大大减少方法中的样板代码量。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T01:47:47.370

我同意这感觉有点笨拙，但是，我并没有马上看到“完美”的方式来重新工作以尽量减少重复。

我唯一在想的是，如果你能以某种方式使用接口或将其分解一下，我不确定我会怎么做，但我可以说，对于正在进行的更改，我认为我不会会留下这个，至少在没有非常好的文档的情况下不会。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T02:13:48.190

我认为你正在做的很好。这种编码在脚本语言中很常见——但它不那么冗长，因为它们是动态类型的。它在函数式语言中也很常见——但它不那么冗长，因为它们有很好的类型推断！在 C# 中，您会受到类型推断系统当前限制的阻碍，但在版本 4 中会变得更好。

另一种方法是使用大量的接口或类来封装您的工作。执行此操作时，调用点的类型名称会减少，但整体代码会更多。

# layout - 实现类似 Wordle 的词云的算法

> ID：342687
> 
> 赞同：211
> 
> 时间：2008-12-05T01:50:23.573
> 
> 标签：layout, fonts, typography, tag-cloud, wordle

## 语境

*   看看 Wordle：[http ://www.wordle.net/](http://www.wordle.net/)
*   它比我见过的任何其他词云生成器都好看
*   注意：源不可用 - 阅读常见问题解答：[http ://www.wordle.net/faq#code](http://www.wordle.net/faq#code)

## 我的问题

*   是否有可用的算法可以完成 Wordle 的工作？
*   如果不是，有哪些替代方案可以产生类似的输出？

## 为什么我要问

*   只是好奇
*   想学

* * *

## 回答 #1

> 赞同：499
> 
> 时间：2009-09-25T16:33:41.170

我是 Wordle 的创造者。以下是 Wordle 的实际工作方式：

数单词，扔掉无聊的单词，按计数排序，降序排列。保留一些 N 的前 N ​​个单词。为每个单词分配与其数量成正比的字体大小。使用 Java2D API 为每个单词生成一个 Java2D 形状。

每个单词“想要”在某个地方，例如“在垂直中心的某个随机 x 位置”。按照频率降序，对每个单词执行以下操作：

```
place the word where it wants to be
while it intersects any of the previously placed words
    move it one step along an ever-increasing spiral 
```

就是这样。**困难**的部分是有效地进行交叉测试，为此我使用了最后一次命中缓存、分层边界框和四叉树空间索引（所有这些你都可以通过一些勤奋的谷歌搜索了解更多信息）。

编辑：正如 Reto Aebersold 指出的那样，现在有一个免费的书籍章节，涵盖了同样的领域：[美丽的可视化，第 3 章：Wordle](http://static.mrfeinberg.com/bv_ch03.pdf)

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2012-05-08T22:14:06.803

这是 Jason Davies 使用 d3 的一个非常好的 javascript。你甚至可以使用 webfonts。

演示： [http ://www.jasondavies.com/wordcloud/](http://www.jasondavies.com/wordcloud/)

Github： [https ://github.com/jasondavies/d3-cloud](https://github.com/jasondavies/d3-cloud)

* * *

## 回答 #3

> 赞同：32
> 
> 时间：2010-08-03T07:57:17.487

我已经使用 python 实现了 Jonathan Feinberg 描述的算法来创建标签云。它与 wordle.net 的美丽云相去甚远，但它让您了解如何做到这一点。

[您可以在此处](https://github.com/atizo/PyTagCloud)找到该项目。

* * *

## 回答 #4

> 赞同：31
> 
> 时间：2011-07-29T17:26:19.327

我创建了一个 Silverlight 组件，该组件使用 Jonathan 在此处建议的算法。源代码和示例项目都可以在我的博客上找到：

[http://whydoidoit.com](http://whydoidoit.com)

![颜色词云](https://i.stack.imgur.com/bLhfg.png)

我的云可以让你根据不同的权重对单词进行颜色和大小，它支持单词选择（从坐标）和选定的单词突出显示。来源是你认为合适的使用。

![示例词云](https://i.stack.imgur.com/eoJEd.png)

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2011-04-02T21:21:09.607

我正在研究[WordCram](http://wordcram.org)，这是一个用于制作词云的处理库。它深受 Wordle 的影响，并受到与上面链接的同一个 PDF aeby 的影响。它为您处理碰撞检测，并让您专注于您希望文字的布局、着色、旋转等方式。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2008-12-23T23:33:03.227

[http://code.google.com/apis/visualization/documentation/gallery.html](http://code.google.com/apis/visualization/documentation/gallery.html)

查看词云可视化。不像 wordle.net 那样花哨，但很容易添加到您的网站。

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2011-06-15T19:30:13.233

我正在寻找一种类似于 wordle 的可视化，它允许分配与其他数据相关的字符串的颜色、初始位置和大小，例如文本中的相关性 - 没有找到任何东西，但感谢我在这里找到的信息（尤其是乔纳森的解释和 aeby 的链接），我终于可以实现“ [Cloudio](https://github.com/sschwieb/Cloudio) ”，它相对接近 wordle（至少我认为是这样......）并提供了我正在寻找的功能。

它是用 SWT 和 JFace 实现的，我尝试将它集成到 JFace 的 MVC 模型中，这样您就可以设置内容和标签提供者来修改云的布局并将其添加到其他 Eclipse 插件或 RCP应用。您还可以修改计算字符串初始位置的方式，这样不难将其用于集群可视化或其他方面。它的文档仍然很差并且在某些方面受到限制（我在几个小时前进行了初始上传，所以它可能仍然有点错误），但如果您有兴趣，这里是链接：

这是一些创建的云的链接，以防您想要快速印象：[https ://github.com/sschwieb/Cloudio/wiki/Example-Clouds](https://github.com/sschwieb/Cloudio/wiki/Example-Clouds)

干杯，斯蒂芬

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2011-07-19T10:44:08.050

在这里看一下我对 Wordle like cloud 的实现。它使用相同的螺旋算法和四叉树数据结构。

[http://sourcecodecloud.codeplex.com](http://sourcecodecloud.codeplex.com)

或者

[http://www.codeproject.com/Articles/224231/Word-Cloud-Tag-Cloud-Generator-Control-for-NET-Win](http://www.codeproject.com/Articles/224231/Word-Cloud-Tag-Cloud-Generator-Control-for-NET-Win)

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2015-08-04T20:42:52.470

Lion and Lamb 是一款开源 iOS 应用程序，它使用所选圣经书中最常用的词创建词云。

它基于 Jonathan Feinberg 所描述的算法。命中测试确实使用四叉树，但边界框基于字形的边界矩形。我想将字形分解为许多较小的边界矩形，以在字形的边界框中启用单词放置。

GitHub：[https ://github.com/PetahChristian/LionAndLamb](https://github.com/PetahChristian/LionAndLamb)

[![圣经启示录的词云](https://i.stack.imgur.com/1E3qo.png)](https://i.stack.imgur.com/1E3qo.png)

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2011-06-10T17:33:09.907

我在这里有一个标签云生成器，我称之为**Disorganizer** :)

来源[TagCloudService](https://github.com/chandru9279/zasz.me/blob/master/zasz.me/Services/TagCloud/TagCloudService.cs) 和[razor 标记控件](https://github.com/chandru9279/zasz.me/blob/master/zasz.me/Views/Blog/TagCloudControl.cshtml) 以及[用于测试目的的 WinForm](https://github.com/chandru9279/Disorganizer/blob/master/Disorganizer/TagCloud.cs) ，您可以将其放入您的博客、个人资料等，并在其周围加上一点包装。它大量使用 C# 4.0 和 System.Drawing 命名空间。

我创建它是因为使用其他云生成器您无法单击标签进行导航，也无法创建悬停动画以显示它们是可点击的。由于在 HTML 中显示悬停动画对我来说是必要的（我正在使用覆盖的、绝对定位的`<a>`标签来执行此操作）我还没有开发任何角度的文字显示——它们要么是垂直的，要么是水平的。

警告：以上链接可能会在几个月后失效，我打算慢慢将其从周边项目中解开，成为一个单独的项目。

[您可以在此示例博客文章](https://web.archive.org/web/20150905182715/http://www.zasz.me/Blog/Post/moving-the-master-boot-record)中看到一个工作演示，但它不完整，并且位于不完整的站点中。如果有人想贡献，请与我联系，我会尽快将其分离出来。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2019-04-27T16:49:50.543

**这是Python 3**中 wordle 的另一个**端到端**实现，主要基于 Jonathan Feinberg 的初始大纲（QuadTrees、spirals 等）。

 **该代码（已注释，带有详细的自述文件）可在此[Github 存储库](https://github.com/hayk314/visualization)中免费获得，这是使用该代码创建的示例 wordle。

[![麦克白](https://i.stack.imgur.com/QayDP.png)](https://i.stack.imgur.com/QayDP.png)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-06-17T20:03:17.897

Tim Dream 制作了一个非常不错的 JavaScript 小库：

[https://github.com/timdream/wordcloud2.js/blob/gh-pages/API.md](https://github.com/timdream/wordcloud2.js/blob/gh-pages/API.md)

它可以在画布上创建文字云，也可以使用带有许多选项的 HTML 标签来修改结果。它非常接近 wordle 的输出。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2021-04-25T09:12:47.843

我用 Julia 语言实现了一个名为[**WordCloud.jl的词云生成器。**](https://github.com/guo-yong-zhi/WordCloud.jl)可以在[此处](https://github.com/guo-yong-zhi/WordCloud.jl#algorithm-description)找到有关其算法的简要说明。
与大多数其他实现不同，我基于梯度优化来设计它。这是一种非贪心算法，其中单词可以在定位后进一步[移动](https://raw.githubusercontent.com/guo-yong-zhi/WordCloud.jl/master/res/animation.gif)。这意味着不需要缩小字，因此可以在调整过程中保持字长不变。通过这个实现，我们还可以做一些花哨的工作：
[奥巴马和特朗普就职演说的比较](https://github.com/guo-yong-zhi/WordCloud.jl/blob/master/examples/compare2.jl)
[![比较词云](https://i.stack.imgur.com/WFFOU.png)](https://github.com/guo-yong-zhi/WordCloud-Gallery#compare2)

# .net - 单元测试旧版 ASP.NET Webforms 应用程序

> ID：342693
> 
> 赞同：13
> 
> 时间：2008-12-05T01:52:21.417
> 
> 标签：.net, asp.net, unit-testing, legacy

我继承了一个没有单元测试的遗留 Web 应用程序。我想添加一些，但不知道从哪里开始。我应该将它们添加到旧代码中吗？或者只是新的代码？如果该代码与遗留代码交互怎么办？你有什么建议？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-05T02:06:47.113

首先，我建议对未来的所有更改进行单元测试，我想大多数人都会同意这是回归的好主意。

但是，对于现有代码，这是您需要查看您愿意或允许将多少风险引入产品的情况之一。问题在于，当您开始对现有代码库进行单元测试时，您将很快意识到重构和设计改进的许多机会。

听我说，如果你是一个优秀设计的坚持者，但你没有被授权做出激烈的重构决定，那么当你尝试为遗留部分编写测试时，你只会心碎- 是的，如果它没有现有的测试套件，它需要重构。如果不允许您对生产应用程序进行重大更改，那么您最终将实现我们喜欢称之为“垃圾适配器模式”的东西。祝你好运！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T07:45:48.973

我建议获取一份[有效地使用旧代码](https://rads.stackoverflow.com/amzn/click/com/0131177052)的副本。

我们在一个学习小组中浏览了这本书。这很痛苦，但很有用。

主题包括：

*   了解软件变更的机制：添加功能、修复错误、改进设计、优化性能
*   将遗留代码放入测试工具
*   编写测试以防止引入新问题
*   可用于任何语言或平台的技术，包括 Java、C++、C 和 C# 中的示例
*   准确识别需要更改代码的位置
*   处理非面向对象的遗留系统
*   处理似乎没有任何结构的应用程序

[您可以在http://www.objectmentor.com/resources/articles/WorkingEffectivelyWithLegacyCode.pdf](http://www.objectmentor.com/resources/articles/WorkingEffectivelyWithLegacyCode.pdf)看到对此的简短介绍

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-12-05T01:56:34.170

旧版应用程序是分层的吗？

如果是这样，首先将单元测试添加到后端/业务层

如果没有，则将单元测试添加到新代码中，并在发现错误时（用于回归测试）

如果您有时间/雄心对整个事物进行单元测试（最终），请开始列出功能（首先是关键功能）并为这些功能添加单元测试，一次几个

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-05T02:01:26.577

如果它是您继承的代码，大概您必须开始阅读它并了解它做什么和不做什么。我建议您编写反映您对代码库不断增长的理解的单元测试。最终，您将建立关于遗留应用程序的知识体系，即“这些函数是通过这些测试的函数”，而不是“这些函数是具有这些实现的函数”。然后，您将有更多的自由和信心在不破坏事物的情况下进行更改。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-12-05T02:20:55.493

我不会仅仅为了进行测试而编写任何测试。我只会在发现错误或添加新功能时编写测试。然后编写测试来装箱您需要更改/实现的代码，以定义它当前的功能。在出现错误的情况下，编写测试以证明错误已得到修复。在新代码的情况下，它应该做什么。现在去实现修复/新功能。如果你发现你很想触碰你的测试“盒子”之外的代码——写一些更多的测试来盒子那个区域（或者重新考虑你想要做的改变）。根据需要逐步引入新的测试，以最大限度地提高您在测试中的投资。编写测试来证明工作代码有效似乎毫无意义，直到它被证明被破坏。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-05T07:01:14.943

如果 Web 应用程序没有经过单元测试，那么它也可能不容易进行单元测试。将其置于单元测试下可能会有风险，因为您没有 [单元] 测试，是的，鸡和蛋。此外，这需要时间并且不会为应用程序带来太多价值。

[我的目标是使用Selenium](http://selenium.openqa.org/)、[Watir](http://en.wikipedia.org/wiki/Watir)、 HtmlUnit 或 HttpUnit 、 YMMV 为应用程序的遗留部分编写端到端自动测试。这些测试（[特征测试](http://en.wikipedia.org/wiki/Characterization_Test)）将确定您当前的应用程序行为，就像单元测试一样，但是从外部，允许您通过检测不希望的副作用的能力进行更改。

为新代码编写单元测试，以及在更改遗留代码时，无论是为了解决问题还是添加新功能。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-07T15:39:58.247

在应用程序的已知“痛点”编写测试。经常中断或通常具有较高风险的代码是一个很好的起点，因为它有助于在该领域建立第一道防线，并使团队接触到该应用程序中单元测试的范围。

每次针对应用程序打开缺陷时，继续尝试编写单元测试以公开此行为。它会在修复时通知您，并希望防止将来再次引入它。

此外，寻找需要重构的代码。任何重构工作都应该以创建单元测试为开头。这有助于确保它在您进行更改之前和之后都能正常工作。重构一开始可能会很困难，因为存在“涟漪效应”的风险，其中一个破损可能会以意想不到的方式对整个应用程序造成严重破坏。

# installation - Inno Setup 中的函数指针

> ID：342696
> 
> 赞同：3
> 
> 时间：2008-12-05T01:55:19.227
> 
> 标签：installation, inno-setup, pascalscript

Inno Setup 是否支持函数指针？我在文档中找不到任何内容。我知道 Delphi/Pascal 支持它们，并且 Inno Setup 脚本引擎基于它，我希望它得到支持。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-12-05T08:49:14.197

我只是做了一些测试，函数指针确实有效。以下`[Code]`部分编译并正常工作：

```
type
  TStrProc =  procedure (const AStr: String);

procedure Call(const AProc: TStrProc; const AStr: String);
begin
  AProc(AStr);
end;

procedure ShowStr(const AStr: String);
begin
  MsgBox(AStr, mbInformation, MB_OK);
end;

function InitializeSetup(): Boolean;
begin
  Call(@ShowStr, 'Hello World!');
end; 
```

顺便说一句：Inno Setup 使用[来自 RemObjects 的 Pascal 脚本引擎](http://www.remobjects.com/ps.aspx)。也许你可以在那里找到更多信息。

# project-organization - 从头开始项目：如何以及何时分配工作量？

> ID：342699
> 
> 赞同：0
> 
> 时间：2008-12-05T01:59:13.010
> 
> 标签：project-organization

我和我的朋友打算开发一个新的商业网络项目。我们有一份文档，列出了我们想要拥有的所有东西，我们想知道实际开始编码的最佳方式是什么。问题是我们过去常常以单人模式开发软件，或者加入一些处于开发过程中的项目，并且职责很容易在团队成员之间分配。现在我们从头开始，显然有诸如数据库设计或一些基本功能开发之类的东西，如果没有这些东西对我们俩来说都是一个障碍。我们之间也有七个小时的时差。

**同样，我们知道团队合作是如何运作的，我们拥有所需的所有工具，并且我们知道在完成所有基础工作后如何分散工作量，但是当一切都取决于基础工作的结果时，如何在分布式团队中开始基础工作? 如果没有数据库，我的团队如何开始使用用户仪表板功能？**

那么，你们将如何开始这样的开发过程呢？什么时候可以轻松开始在团队成员之间分配工作量？

我想知道 Joel 和 Jeff 是否可以分享他们在这个主题上的经验，因为 Stack Overflow 是由分布式团队在很短的时间内开发的。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T02:04:59.143

尝试收听[Stack Overflow 播客](https://blog.stackoverflow.com/category/podcasts/)的前几集，以深入了解 SO 开发流程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T02:21:20.967

另外，看看极限编程。不是所有的细节都适合这个，但是有一种技术对你很有好处：将项目组织成小的“用户故事”，描述一点点端到端功能，定义一个“验收测试”，告诉当一个用户故事完成后，你就可以一次处理一个用户故事，或者每个一个。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T02:25:51.630

[听从查理·马丁](https://stackoverflow.com/questions/342699/starting-project-from-scratch-how-and-when-to-distribute-the-workload#342731)的智慧，但在完成和商业化的责任和承诺上，你们两人之间*至少要有*君子协定。

说“是的，我会帮你写 whizbang.com 网站”是一回事，但承诺维护它、在财务上支持它、营销它并使它作为一项业务运作是另一回事

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T06:24:28.370

我之前曾与分布式团队合作过，你需要拥有的最重要的事情是明确你的目标、里程碑和职责。网上有很多工具可以帮助你完成这个项目：

*   Google 代码 <您可以将其用作您的代码存储库。
*   查看 37signals.com 上的工具，他们有一些很好的协作工具，基本版本是免费的
*   您可以使用 crossloop 共享您的屏幕来解决问题并进行讨论。

# binary-tree - 使用二叉搜索树作为拼写检查器

> ID：342708
> 
> 赞同：4
> 
> 时间：2008-12-05T02:05:39.173
> 
> 标签：binary-tree, binary-search-tree

想知道将二叉搜索树变成拼写检查器的最有效方法，方法是读入 1000 个单词的字典文件，然后让它检查另一个文档，说有几个段落。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-05T02:22:19.593

三叉树树[会](http://en.wikipedia.org/wiki/Ternary_search_trie)更有效

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T03:34:11.087

您是否对使用二叉搜索树一无所知？[布隆过滤器](http://www.codecommit.com/blog/scala/bloom-filters-in-scala)可能是一种更有效的数据结构。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-06-12T03:07:19.873

[该](http://www.snippets.24bytes.com/2011/03/approximate-search-or-spell-check-using.html)站点应该可以帮助您在 java 中实现。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T03:16:24.663

如果您只是想查看字典中是否存在特定单词（即拼写正确），那么我认为二叉搜索树不是您所追求的。存储该信息的更好方法是采用树形样式，其中树上的每个连续节点都是一个字符，读取到末端节点的路径可以为您提供该单词的拼写。您还需要添加一个标记来指示词尾。

例如：假设你的字典中有这些词：car、cart、cat、cup、cut

```
- C
  - A
    - R
      - end
      - T
    - T
      - end
  - U
    - P
      - end
    - T
      - end 
```

检查一个单词是否存在是一个单独查看每个字母的问题，以及它是否存在于当前节点的子节点中。

```
Check for "cat"
Does "C" exist at the root level? Yes, move to the next letter.
Does "A" exist underneath C? Yes, move on.
Does "T" exist underneath A? Yes, move on.
Is there a word ending after the T? Yes. Word exists.

Check for "cu"
Does "C" exist at the root level? Yes, move to the next letter.
Does "U" exist at the root level? Yes, move to the next letter.
Is there a word ending after the U? No. Word does not exist. 
```

如何存储这些信息取决于您。正如 Steven 所指出的，[三元搜索树](http://en.wikipedia.org/wiki/Ternary_search_trie)可能是要走的路：每个节点将有 27 个可能的子节点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T02:26:26.917

如果您还需要进行自动建议/前缀搜索，那么帕特里夏树或基数树值得一看。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-05T02:55:11.040

对于您给出的示例，性能可能无关紧要，因为在 PC 上，如果您不使用完全愚蠢的算法，整个操作将花费用户读取您显示的第一个结果所需时间的大约 1% . 但是，我仍然认为问题足够大，以至于性能是一个问题。

如果字典文件是预先排序的（大多数都是），并且如果文本相对于您所描述的字典很小，那么我会非常想对文本进行排序，也许会删除重复项，然后并排遍历两个列表-side 使用与合并排序相同的过程，除了您报告每个文本单词是否在字典中而不是输出合并列表。

这在大约 M log M 次比较中完成了这项工作，加上最多 N + M 次迭代比较，（可能更少，但不是更复杂）。这非常接近一次性操作的最佳复杂性：要摆脱 N 中的线性项，您需要找到根本不从磁盘读取整个字典的方法。我很确定可以搜索文件，特别是考虑到单词很短，但是对于小 N 来说，任何人都猜测寻找该位置是否实际上会比串行访问数据更快。

它具有以下特点：

*   您不必将字典保存在内存中，只需保存文本即可。
*   不过，您只需要遍历字典文件一次。
*   您不需要对字典进行任何昂贵的处理。

当然，如果字典文件没有预先排序，那么这是行不通的，并且如果您可以将字典保留在内存中以进行下一次拼写检查操作，那么您可以摊销 I/O 的成本并将其处理成跨越多个不同文本的树，从长远来看，这将是一个胜利。

如果字典真的很大，那么您可能会受益于以预处理形式将其存储在磁盘上，该预处理形式相当于根据您的语言中各种单词的相对频率加权的不平衡树。然后，您可以对小文本进行少于 O(N) 的磁盘访问，并且在大多数操作系统上根本不需要将其加载到内存中，只需 mmap 文件并让操作系统担心它。对于一个大字典，包含以“二甲基”开头的单词的整个簇永远不需要被触及。

另一个考虑因素是字典的展开树。当您在其中查找内容时，展开树会使其自身失衡，以便更快地找到常用值。大多数文本重复使用少量单词，因此如果文本足够长以证明开销是合理的，那么最终将获胜。

以上两者都取决于 Steven A Lowe 的观点，即对于字符串，特里树胜过普通树。不过，不知道您是否会找到现成的 splay trie。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2011-04-20T20:27:55.200

看到这是一个家庭作业问题，我将假设您必须使用普通的旧二叉树（没有红黑树、AVL 树、基数树等）。答案是在从单词列表构建树时尝试保持树的平衡。一种方法是在读入之前随机化列表，这会产生合理的结果。但是，如果您对输入序列进行排序（使用与树使用相同的比较），然后递归细分返回中点的输入，直到没有元素剩余，您可以获得更好的结果。结果是一棵平衡的树。

我在 C# 中找到了三种不同的方法：

```
private static IEnumerable<T> BinaryTreeOrder<T>(IList<T> range, int first, int last)
{
  if (first > last)
  {
    yield break;
  }

  int mid = (first + last) / 2;
  yield return range[mid];
  foreach (var item in BinaryTreeOrder(range, first, mid - 1))
  {
    yield return item;
  }
  foreach (var item in BinaryTreeOrder(range, mid + 1, last))
  {
    yield return item;
  }    
}

private static void BinaryTreeOrder<T>(IList<T> range, int first, int last, 
                                       ref IList<T> outList)
{
  if (first > last)
  {
    return;
  }

  int mid = (first + last) / 2;
  outList.Add(range[mid]);
  BinaryTreeOrder(range, first, mid - 1, ref outList);
  BinaryTreeOrder(range, mid + 1, last, ref outList);
}

private static void BinaryTreeOrder<T>(IList<T> range, int first, int last, 
                                       ref BinaryTree<T> tree) where T : IComparable<T>
{
  if (first > last)
  {
    return;
  }

  int mid = (first + last) / 2;
  tree.Add(range[mid]);
  BinaryTreeOrder(range, first, mid - 1, ref tree);
  BinaryTreeOrder(range, mid + 1, last, ref tree);
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2011-12-15T21:26:08.783

正如建议的那样，trie 比二叉树更有效，但您可以使用 hashmap 并对每个单词进行哈希处理。你有一个小字典（1000 个条目）。遍历文档时，检查单词是否在哈希图中。如果不是，则假定该词拼写错误。

这不会让您更正拼写错误的单词。它只是告诉你是或否（正确与否）。

如果您需要不正确单词的拼写建议，您可以从文件中的单词开始，然后生成 1 个编辑距离以外的所有单词并将它们添加为初始单词的子项。这样您就可以构建图表。深入 2 个级别以获得最大速度与准确性。如果您生成字典中的单词节点，您可以将其添加到可能的建议列表中。最后，返回可能的建议列表。

为了更好地进行拼写检查，还可以尝试添加语音匹配。

> sea yuh -> 再见

这种方法（创建字符串图 1 编辑）是“慢”的。但这是一个很好的学术练习。运行时间为 O(n^branches)。

如果对这里感兴趣的是我自己构建的一个链接（为了好玩）：[https ://github.com/eamocanu/spellcheck.graph](https://github.com/eamocanu/spellcheck.graph)

一些示例图：[https ://github.com/eamocanu/spellcheck.graph/tree/master/graph%20photos](https://github.com/eamocanu/spellcheck.graph/tree/master/graph%20photos)

我还添加了一个 UI 组件来生成图表。这是一个外部库。

# php - 如何获取 PHP 脚本以从已运行的进程发送和接收数据？

> ID：342714
> 
> 赞同：1
> 
> 时间：2008-12-05T02:09:08.760
> 
> 标签：php, ajax, process, telnet

我正在尝试为 Web 创建一个简单的 AJAX 到 Telnet 客户端。我这样做可能是在重新发明轮子，但这对我自己来说是一个学习项目。目前我还没有写任何东西，我只是想把这个想法包裹在我的脑海里。它不一定是 PHP。

如果我有一个支持多个连接的 telnet 客户端已经在它自己的进程中运行，我如何获得一个 PHP 脚本，当客户端浏览器要求能够与客户端通信时触发？

例如，我希望 PHP 脚本能够告诉已经运行的进程它是哪个客户端，并从 telnet 进程接收任何新数据。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T02:50:57.413

对于 PHP，您谈论的是通过 shell 进行接口吗？这完全取决于您尝试连接的 telnet 客户端，以及它支持的 CLI 选项。为此打开一个流可能需要让每个 telnet 会话将其 STDIO 输出到文本文件，然后让 PHP 读取该文本文件并显示“差异”。

使用 PHP 中的 Fsockopen()，您实际上不需要与其他程序交互，您可以直接在 PHP 中运行套接字命令并在那里获取结果。

[PHP:Fsockopen](http://us3.php.net/manual/en/function.fsockopen.php#79160)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T03:05:38.023

我将创建一个作为守护进程运行的 telnet 客户端。它将负责创建和维护 telnet 会话并缓冲任何接收到的数据。

然后，您的 PHP 脚本可以使用 TCP 连接或 Unix 套接字使用 PHP[套接字 API](http://au2.php.net/manual/en/intro.sockets.php)与您的 telnet 客户端守护进程通信。

吉姆。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T02:52:30.000

即使连接需要持久化？

编辑：没关系，我想我有一个想法。

我将自己编写客户端部分，但如果它也可以充当 PHP 通过连接到它并提供相关数据来调用它的服务器，以便它可以找出用户需要哪个连接......乔治一世想我明白了！

编辑2：这就是吉姆所说的。谢谢吉姆。

# html - 谁在修改我的 DOM？

> ID：342718
> 
> 赞同：1
> 
> 时间：2008-12-05T02:12:14.853
> 
> 标签：html, forms, dom, client-side

浏览器收到响应后，网页的 DOM 可能会发生什么变化？

我在包含一次性表单标记的隐藏输入元素的值中看到了这种行为。

当我在浏览器中“查看源代码”时，我看到了服务器写出的正确值。当我提交表单、查看 DOM 的当前状态或只是将元素更改为文本输入时，我看到了不同的字符串。因此，当需要回发到服务器时，输入保持的值与服务器最初发送的值不同。

禁用javascript后问题仍然存在。向元素添加只读属性也无济于事。

新信息：我又摆弄了一些，不管你信不信，在 Firefox 中关闭图像可以让这个问题消失。

为什么会发生这种情况？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T02:28:49.050

如果浏览器具有“保存表单数据”功能，则它可能会使用先前提交的值预先填充数据。

（我希望流行的浏览器足够聪明，不会填充隐藏字段，但这是我可以建议的来源之一......）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T06:43:44.573

**将readonly="readonly"和****autocomplete="off"**放在字段标签中 可能会有一些运气。

不确定浏览器自动完成是否会这样做，但它是合理的，也可以尝试在您的测试浏览器中禁用自动完成，看看是否会改变任何东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-28T17:39:32.360

我对正在发生的事情的解释是不正确的。我想这是一件好事，因为我认为我所看到的不应该发生！无论如何，这是我现在理解的情况：

此处的表单令牌是一次性使用的，因此仅对单页加载有效。页面上的其他地方是一个没有 src 属性的 img 标签，这导致浏览器尝试从 / 加载图像。由于索引页面是一个 php 页面，因此令牌被循环了。

I believed the DOM changed, I think, because some implementations of 'view source' (I was testing in several browsers) seemed to cause a page reload, as well...

Thanks for all of the suggestions.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T06:26:27.867

*“当我提交表单时，查看 DOM 的当前状态”是*什么意思？

如果您提交表单，它会向服务器发送请求吗？您是在谈论服务器发回的结果页面上的 DOM 状态吗？

在不涉及客户端脚本的情况下，您的 DOM 不可能在客户端发生更改。

另一方面，如果您提交到服务器并取回一个全新的 DOM，那么，服务器更改了它。

# python - 我应该如何学习在 Python 中使用 Windows API？

> ID：342729
> 
> 赞同：23
> 
> 时间：2008-12-05T02:20:30.360
> 
> 标签：python, winapi

我几乎没有为 Windows 构建软件的经验，并且使用 Windows API 的经验为零，但我对 Python 相当熟悉。我应该如何开始学习在 Python 中使用 Windows API？

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2008-12-05T02:26:44.000

老实说，没有。Windows API 是一个重达 800 磅的怪物，身上长满了头发。 [查理·佩佐德（Charlie Petzold）的 15 磅书](http://www.charlespetzold.com/faq.html)曾是经典参考书。

也就是说，[Windows 用户的 Python](http://python.net/crew/mhammond/win32/)有一些很好的材料。微软有[完整的 API 在线](http://msdn.microsoft.com/en-us/library/aa383749(VS.85).aspx)，包括一些示例代码等。维基[百科的文章](http://en.wikipedia.org/wiki/Win32)是一个很好的概述。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-12-08T16:53:44.120

大约 4 年前，我开始真正了解 Windows API。当时我正在使用 C# 进行编码，但我觉得该框架将我从 API 中抽象了太多（确实如此）。所以我改用 Delphi（C++ 或 C 也是不错的选择）。

在我看来，重要的是您开始使用一种语言来创建本机代码并直接与 Windows API 对话，并让您关心 Windows 直接使用的缓冲区、指针、结构和实际构造。C# 是一门很棒的语言，但不是学习 Windows API 的最佳选择。

接下来，购买 Mark Russinovich 的书“Windows Internals”[亚马逊链接](http://amzn.to/xdu4Br)。这是第 5 版。第 6 版将于 2012 年 4 月发布，并添加了有关 Server 2008 R2 和 Windows 7 的信息。

## 现在，对于学习 Win32 API 的最重要（也是最好的）资源：

免费提供Mark Russinovich 的[Windows 操作系统内部课程](http://www.microsoft.com/resources/sharedsource/windowsacademic/curriculumresourcekit.mspx)。

它旨在供教师用来教学生。我经历了它，这太棒了。充满了例子、历史和详细的解释。在我看来，这是学习 Windows API 的理想方式。

Mark Russinovich 是 Microsoft 技术研究员（包括 C# 的创建者在内，MS 只有 14 人）。在将 Winternals 卖给 MS 之前，他曾经拥有 Winternals，他拥有卡内基梅隆大学的计算机工程博士学位，他经常在微软会议上发表演讲（甚至在他为这些会议工作之前），而且他非常聪明。他的演讲是我每年参加 Microsoft TechEd 的主要原因之一。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-05T04:01:34.167

我强烈推荐[Forger 的 Win32 API 教程](http://www.winprog.org/tutorial/)。它是一个 C 教程，但他几乎握着你的手，向你展示了基础知识。它也很短，在教程中很好。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2008-12-05T13:19:43.570

避免教程（由孩子们编写，为孩子们，新手级别）阅读 Petzold、Richter、Pietrek、Russinovich 和 Adv。Win32 api 新闻组 news://comp.os.ms-windows.programmer.win32

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-12-05T03:34:01.210

学习 Win32 API 是对概念和使用的模式的初步理解的 5% 和 RTFM 的 95%。

对于最初的 5%，Petzold 的书非常好，但我怀疑应该有一些在线教程，你可以在谷歌上找到我能找到的最好的。

真的，一旦你掌握了窍门，就可以做任何事情。一旦你到达那里，可能是时候转向像 QT 这样更好的东西了，再也不要接触 Win32 API。现在没有人真正使用裸 Win32 API 来做任何比微不足道的事情，因为它涉及的开销很大并且极度缺乏舒适性。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-12-05T06:06:53.273

既然你问过 Python，为什么需要 Win32 API？它用于编写小型、快速的 C/C++ 程序。如果您的工具是 Python，只需下载 wxPython，它在 Windows 上运行得非常好，并以 1% 的代码和工作量生成时尚的原生 GUI。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-12-05T10:02:57.977

" > 学习如何使用 windows API 的免费资源（最好使用 python）

1.  您可以参考[Mark Hammond 和 Andy Robinson 的 Python Programming on Win32](http://books.google.co.in/books?id=ns1WMyLVnRMC)以及[pywin32](http://sourceforge.net/projects/pywin32/)。

2.  如果您对使用[pywin32](http://sourceforge.net/projects/pywin32/)不感兴趣，可以使用[ctypes — Python 的外来函数库](http://docs.python.org/library/ctypes.html)和[Forger 的 Win32 API 编程教程](http://www.winprog.org/tutorial/)。

3.  请参阅[示例代码：使用 Mutex 共享内存（pywin32 和 ctypes）](http://mail.python.org/pipermail/python-list/2005-April/315719.html)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-05T03:43:44.500

正如[查理](https://stackoverflow.com/questions/342729/learning-the-win32-api#342740) 所说：“这个 Api 是一个 800 磅重的怪物，上面覆盖着头发”。

考虑使用 Visual Studio for vb 或 c# ( [http://www.microsoft.com/express/](http://www.microsoft.com/express/) ) 的 express 版本 (免费) 以及 msdn 库 ( [http://msdn.microsoft.com/en-us/library /default.aspx](http://msdn.microsoft.com/en-us/library/default.aspx)）。这将使您尽可能多地接触 api。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-08T17:02:05.897

嗯……很多人都本末倒置。我要问你的问题是：你为什么要学习Win32？

如果您想学习它以便构建 Windows 用户界面，或许可以考虑使用 wxPython。如果您只打算调用非可视化 Win32 API，那么 Petzold 的书可能不是最好的。有像[SWIG](http://www.swig.org/)这样的工具，可以更轻松地从 Python 等语言调用 Win32 等库。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-12-05T03:51:10.320

曾几何时，我在[www.relisoft.com上阅读了一些 Win32 API 教程](http://www.relisoft.com)

他们是反 MFC 和支持 Win32 API 的商店，并且有各种各样的宣言，解释了原因的实际原因。

他们也有一个通用的 C++ 教程。99% 的时间我都喜欢他们的编程风格，因为它物有所值。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2008-12-05T03:54:35.897

您所需要的一切在 MSDN.COM 上完全免费。Win32 很容易使用 C/C++、C# 和 Visual Basic 进行编程。我推荐 C/C++。[您可以在此处](http://www.microsoft.com/express/product/default.aspx)下载 Visual Studio Express 版本。

所有文档（不是缩写形式）都在[此处](http://msdn.microsoft.com/en-us/library/aa139672.aspx)的网络上。

请注意，Win32 通常用于表示“Windows 的所有编程接口”。更规范地说，它是用户模式应用程序的基本原生 API 集。有一组类似的用于驱动程序和内核组件的 API。[你可以在这里](http://www.microsoft.com/whdc/devtools/WDK/default.mspx)了解。

Microsoft 也有许多其他 Windows 编程接口：[Common Language Run time 和 .NET 框架](http://msdn.microsoft.com/en-us/library/w0x726c2.aspx)是 Windows 之上的管理层。还有许多其他 API 系列，例如[DX9 和 DX10 （](http://msdn.microsoft.com/en-us/library/bb219737(VS.85).aspx)[此处](http://blogs.msdn.com/coding4fun/archive/2006/11/02/938703.aspx)是游戏编程的良好链接）。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-02T19:04:10.097

你必须从这两本书开始。

[Petzold](http://www.charlespetzold.com/faq.html)书：非常适合学习消息和消息泵、GDI 和 User32 的东西。

[Richter](https://rads.stackoverflow.com/amzn/click/com/0735624240)书：Windows 基础服务，即。进程、内存、线程和 dll

# email - 绝对与相对链接？

> ID：342737
> 
> 赞同：5
> 
> 时间：2008-12-05T02:24:39.387
> 
> 标签：email, hyperlink

在为基于 html 的电子邮件创建链接时，使用绝对链接有多重要？另外，一般来说使用相对链接有什么好处？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-12-05T02:29:31.950

相对链接允许您使用更少的代码来遍历您的结构，并且它们允许您移动域而无需做任何额外的工作。您只需将目录结构复制到新域，它就可以工作。

作为次要考虑，绝对链接不会让您担心文档相对于其他文档的位置——虽然这不是“难以”克服的，但它增加了您必须认识到的额外思考层。

幸运的是，[圣战](http://www.search-this.com/2008/01/16/2-minute-seo-tip-absolute-vs-relative-links/)没有其他[编程圣战](http://www.google.com/search?hl=en&q=Programmer+Holy+wars&btnG=Google+Search&aq=f&oq=)那么大。

对于电子邮件，您唯一真正的选择是绝对链接。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-05T02:30:37.563

电子邮件？我认为除了绝对链接之外没有其他选择。这将保证您无论谁以及如何阅读您的电子邮件，您的链接都将指向您需要的地方。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-05T02:35:23.670

对于基于 html 的电子邮件，绝对链接至关重要，因为它们没有网站的上下文来使相对链接起作用。有一些机制可以设置文档的 BASE，但请尝试将其提供给 lotus notes...

就个人而言，在网站上，我大部分时间都尝试使用至少根绝对链接 /foo/yada.htm，因为它们更容易测试，而且我从不使用父路径链接，除非将某些东西放在 CD 上，比如出于安全原因，它们在 Web 服务器上关闭。

我主要使用 CMS/数据驱动的网站，所以没有手工操作的痛苦。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-05T02:32:46.560

我认为当您发送基于 html 的邮件时，您应该始终使用绝对链接，记住邮件将在用户的电子邮件客户端程序中读取，除非您指定[BASE](http://www.w3schools.com/TAGS/tag_base.asp)标记，否则相对链接将毫无用处。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-05T02:35:20.423

绝对链接总是从根网站开始

```
/portal/images/myImage.png 
```

相对链接总是从该页面的位置开始

```
../images/myImage.png 
```

使用这种方法时，一切都与您有关，因为我喜欢将漏洞 Web 应用程序从服务器复制/粘贴到服务器，有时将其放置在其他子文件夹中，我倾向于使用相对链接而不是绝对链接。

在一个域根目录中，我总是有几个子文件夹和一些默认文件，例如：

*   /网站
*   /门户网站
*   /邮件
*   /苹果手机
*   默认.aspx
*   机器人.txt
*   站点地图.xml

在我拥有的每个人里面

*   /css
*   /js
*   /图片
*   文件.aspx

例如，与其在包含所有子应用程序的所有 CSS 文件的根文件夹中放置一个 css，我总是更喜欢将所有文件都放在一个地方，最好将它移到其他地方。

如果您倾向于在那个地方构建一个永久的 Web 应用程序，那么使用绝对路径并不受欢迎，这是一个品味问题，而不是最佳实践。

**电子邮件中的 HTML**

这是您需要拥有完整路径的地方 [http://www.mydomin.com/images/myImage.png](http://www.mydomin.com/images/myImage.png)

希望能帮助到你 ：）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-05T02:38:05.740

我喜欢为我的顶级域使用一个常量，然后将其他部分添加到链接中。这以防万一我更改了我最顶级的域名，但想保持内容/链接完好无损。

例如：

COMPLETE_SITE_NAME = " [http://www.mysite.com/](http://www.mysite.com/) "; 链接 = COMPLETE_SITE_NAME 。“pagetoContent.html”；

稍微慢一点，但更灵活一点。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2014-08-08T19:50:31.527

我不得不同意balexandre。虽然使用绝对链接有好处，比如搜索引擎搞砸的可能性较小等，但使用相对链接的优势对我来说更大，因为如果我将网站的整个部分复制到另一个站点，甚至将来更改域名。

因此，对于像我这样拥有 8000 多个页面的复杂大型网站，我使用相对链接。

对于少于 50 页的小型网站，绝对链接稍好一些。（如果更好的话）

# networking - 无法通过主机名看到win2k8服务器，但可以通过IP看到它

> ID：342757
> 
> 赞同：1
> 
> 时间：2008-12-05T02:40:18.603
> 
> 标签：networking, windows-server-2008

在我的家庭网络上，我安装了 Windows Server 2008，由于某种原因，网络上的 windows vista 工作站只能通过服务器的 IP 地址而不是主机名通过远程桌面连接到服务器。连接到服务器上的 SQL Server 2008 实例也是如此，只能通过 IP 工作，而不是通过主机名工作。

然而，我在同一台服务器上有一些文件共享，工作站可以使用服务器的主机名很好地看到它们。

服务器/工作站位于同一专用网络上，并具有相同的工作组名称。

知道为什么在上述情况下我似乎无法通过主机名找到服务器吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T03:01:12.727

文件共享可能通过 NETBIOS 处理，RDP 和 SQL 连接可能使用 DNS。您是否已将服务器添加到您的 Vista 系统的[主机文件中](http://en.wikipedia.org/wiki/Hosts_file)？我假设由于它们位于私有网络上，因此您没有运行自己的 DNS，因此要通过使用 IP 名称的协议获取它们，您需要手动将条目放入主机中。

# iphone - 你将如何实现一个检测水平滑动以允许分页的 UITableView？

> ID：342758
> 
> 赞同：6
> 
> 时间：2008-12-05T02:41:34.670
> 
> 标签：iphone, cocoa-touch

我想实现一个 UITableView，它一次显示 20 行。但考虑到我实际上可能要展示 120 个项目，我想使用某种分页来处理这个问题：

使用前 20 个项目填充表。当用户从右向左滑动时，使用接下来的 20 个项目重新加载 UITableView。从左到右滑动将显示前 20 个项目。

我认为继承 UITableView 和处理 UITouches 是可行的，但我不确定如何正确处理触摸以免干扰标准事件处理。

例如。如果用户只是触摸（单击）一行，我希望该行突出显示（选中），然后切换到显示与所选行对应的数据的详细视图。但是，如果用户进行水平滑动，我不希望滑动下方的行被突出显示（因此被选中），相反，我想触发我的 loadprevious 页面/loadnext 页面处理，这将使用相应的重新加载表20 个上一个或下一个项目，具体取决于滑动方向。

有什么建议么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-12-05T03:58:59.600

A horizontal swipe on a table row is already a standard UI behavior that causes that row to be deleted. Don't go changing standard UI paradigms -- it confuses users and makes them dislike your app.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-30T20:06:01.010

使用 UITableView 的部分索引作为替代方案怎么样？

覆盖以下内容：

```
- (NSArray *)sectionIndexTitlesForTableView:(UITableView *)tableView;

- (NSInteger)tableView:(UITableView *)tableView sectionForSectionIndexTitle:(NSString *)title atIndex:(NSInteger)index; 
```

这将为您提供 tableview 右侧的索引栏，让用户快速跳转到表格底部（如果您不知道我的意思，请参阅 iPod 应用程序以获取参考。）您不必将每个部分都包含在索引中，这样您就可以避免使用 100 个部分使其超载。

我使用度数符号作为索引，因为我的表格部分不是字母。

如果支持数据结构仍然是一个大列表，则需要将其分解为多个部分。（您不必为部分显示标题，因此它可以看起来与现有表格相同）

至于偏离标准的 UI 行为......偶尔在尝试发布应用更新时，您可能会遇到一个脾气暴躁的评论者，他们会拒绝您的更新，因为该更新存在于应用程序的早期版本中。只是一个警告，当你试图解决一个重要的问题时，这是世界上最令人恼火的事情。 *向苹果挥拳*

至于性能，我在最多 900 个项目的表上的滚动性能不高。如果它变得粗大，需要注意的事项... 1) 确保在对单元进行出队时正确使用重用标识符。2) 具有复杂控件的自定义表格单元格。（如果您必须将自己的子视图添加到表格单元格，UILabels 是最快的，没有透明度） 3）避免非标准高度的表格单元格（又名不是 40）。（一个公认的苹果性能错误，虽然我还没有验证这确实是一个问题。）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-05-07T22:04:12.813

这里要问的主要问题是“为什么”：你认为用户为什么想要去项目#527？他如何知道他想要的项目在第 6 页上？在第 17 页？

您正确指出滚动浏览 1000 个项目很奇怪，但分页浏览 1000 个项目同样奇怪。您可能希望改进应用程序的过滤或排序功能。滚动浏览数千个项目是疯狂的，除非您希望用户阅读/扫描每个项目，在这种情况下，线性列表不是问题。

UITableView 在右侧有一个部分索引，它可能会根据上下文解决您的问题。它确实解决了联系人列表的问题：即使您有 2000 个联系人，您只需在选择起始字母后滚动浏览其中的大约 100 个。（性能不是问题，因为 UITableView 永远不会创建或请求比屏幕上可见的行更多的行。）

最后，我使用了一个执行类似分页+表格视图的应用程序，我讨厌这种体验。感觉完全不是iPhonish。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-05T03:18:18.730

这是一个非常不标准的 UI 范例。您肯定会向上/向下滚动 120 个项目，就像（比如说）联系人应用程序一样。你让自己的生活变得更加复杂——而且你冒着这个应用程序因为奇怪的 UI 而被 Apple 拒绝的严重风险。

[http://forums.macrumors.com/showthread.php?t=532573](http://forums.macrumors.com/showthread.php?t=532573)中描述了您实现此功能的实际方法

我已经阅读了那里的代码，它看起来很明智，但我发现您可能还需要处理 touchUpInside，而不是调用 [super touchUpInside] 以避免在水平滑动时选择单元格。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-24T00:33:53.123

[实际上，我在http://forums.macrumors.com/showthread.php?t=532573](http://forums.macrumors.com/showthread.php?t=532573)上编写了 Airsource Ltd 提到的代码，所以将我指向我自己的代码并没有多大帮助，无论如何，我的错，但是，嘿，谁不在不同的论坛上使用不同的昵称？;-)

无论如何，它在提交到应用商店后被批准，恕我直言，它在处理长列表时非常有用。分页是网络上常用的东西，我不想强​​迫用户向下/向上滚动一个包含 500+ 行的列表（我说 500+ 行吗？1000+ 行呢？）。

我同意列表上的水平滑动应该/将使用户能够删除/编辑一行作为默认行为。但这不是特定于上下文的吗？

如果我作为用户是数据的“所有者”，我希望能够删除行。但我是否希望能够删除 AppStore 中的应用程序列表或亚马逊应用程序中的书籍列表中的行？

列表上的水平滑动只是一种手势，根据上下文，它应该符合用户的期望。

给定一个包含 500 多行的列表的场景，你会怎么做？使用“显示更多”-页脚显示前 25 行？-> 那么你会有 50 行吗？等等？最后，你会有 527 行？除非你去硬核绘制你的单元格，否则表格也会在它上面画出波涛汹涌的。但是即使平滑滚动，这也不能解决向上/向下滚动 2000 英里像素的问题。

或者放置一个带有“上一页/下一页”的页眉/页脚 - 按钮，因此一次只显示 25 行？然后，您将强制用户滚动到顶部或底部以切换到上一页或下一页......

我愿意接受任何建议。在我看来，向左或向右滑动具有“上一个/下一个”内容的东西就像一个自然的手势。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-16T23:07:35.713

如果我真的想这样做，我会继承 UITableView 并将它的多个副本添加到 UIScrollView。解开事件将是可怕的，我认为 UI 不值得付出努力。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-16T15:36:19.247

只需在此处调用触摸取消方法即可检查是否发生滑动而不是触摸点。然后执行您的功能

# dns - DNS记录中的非最左边通配符？

> ID：342767
> 
> 赞同：1
> 
> 时间：2008-12-05T02:50:37.647
> 
> 标签：dns, wildcard-subdomain

假设情况：

假设我经营一家托管公司，在那里我为人们托管子域。您可以注册并每月给我几美元，我会给您 yourname.mycompany.com。

现在，假设我希望 mail.*.mycompany.com 指向一台服务器，而 www.*.mycompany.com 指向另一台服务器。

这可能吗？RFC 似乎不这么认为，[Wikipedia](http://en.wikipedia.org/wiki/Wildcard_DNS_record)似乎也不这么认为，但是是什么阻止了 DNS 服务器有足够的逻辑来返回正确的东西？

如果是这样，是否有 DNS 托管服务提供商可以为我执行此操作，这样我就不必运行自己的 DNS？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T04:03:51.150

You need to write your own DNS server to support this AFAIK. Nothing stopping you from doing so though. Easy enough to respond to DNS requests however you'd like!

No hosting company I know of supports wildcarded DNS mid entry.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T02:56:15.577

我对这个确切问题的解决方案是运行我自己的 dns，当以编程方式添加客户端时，将记录添加到 dns，这也允许我确定哪个 www 服务器使用最少并正确分配客户端。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T03:08:12.463

您可以开发自己的 DNS 使用不符合标准的内部存储机制，但您仍然需要使用与其他服务器相同的协议。此外，您通常必须有一个非本地备份服务器，这无疑会不愿意采用您的 DNS 服务器，并且您仍然必须以标准格式为所有订阅公司生成全名。

# c++ - 将 lptstr 转换为 char*

> ID：342772
> 
> 赞同：15
> 
> 时间：2008-12-05T02:52:25.583
> 
> 标签：c++, char, lptstr

有人会碰巧知道如何将类型转换`LPTSTR`为`char *`C++ 吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-12-05T03:03:08.357

取决于它是否显示为 Unicode。如果不是 Unicode，LPTSTR 是 char*，如果是，则为 w_char*。

[在这里讨论得更好](http://social.msdn.microsoft.com/Forums/en-US/vclanguage/thread/1b994ff3-da28-46a8-90ef-6c7fab8dcd21/)（接受的答案值得阅读）

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-05T03:02:56.593

这里有很多方法可以做到这一点。MFC 或 ATL 的 CString、ATL 宏或 Win32 API。

```
LPTSTR szString = _T("Testing");
char* pBuffer; 
```

您可以使用 ATL 宏来转换：

```
USES_CONVERSION;
pBuffer = T2A(szString); 
```

字符串：

```
CStringA cstrText(szString); 
```

或 Win32 API （`WideCharToMultiByte`如果`UNICODE`已定义）。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2011-03-08T14:17:26.703

如果您的编译器 Character Setting 设置为**Unicode Character Set**，则**LPTSTR**将被解释为**wchar_t***。在这种情况下，需要 Unicode 到多字节字符的转换。
（在 Visual Studio 中，设置位于 Project Properties\Configuration Properties\General\Character Set）

下面的示例代码应该给出一个想法：

```
#include <windows.h>

/* string consisting of several Asian characters */
LPTSTR wcsString = L"\u9580\u961c\u9640\u963f\u963b\u9644";
//LPTSTR wcsString = L"OnlyAsciiCharacters";

char* encode(const wchar_t* wstr, unsigned int codePage)
{
    int sizeNeeded = WideCharToMultiByte(codePage, 0, wstr, -1, NULL, 0, NULL, NULL);
    char* encodedStr = new char[sizeNeeded];
    WideCharToMultiByte(codePage, 0, wstr, -1, encodedStr, sizeNeeded, NULL, NULL);
    return encodedStr;
}

wchar_t* decode(const char* encodedStr, unsigned int codePage)
{
   int sizeNeeded = MultiByteToWideChar(codePage, 0, encodedStr, -1, NULL, 0);
   wchar_t* decodedStr = new wchar_t[sizeNeeded ];
   MultiByteToWideChar(codePage, 0, encodedStr, -1, decodedStr, sizeNeeded );
   return decodedStr;
}

int main(int argc, char* argv[])
{
   char* str = encode(wcsString, CP_UTF8); //UTF-8 encoding
   wchar_t* wstr = decode(str, CP_UTF8);
   //If the wcsString is UTF-8 encodable, then this comparison will result to true.
   //(As i remember some of the Chinese dialects cannot be UTF-8 encoded 
   bool ok = memcmp(wstr, wcsString, sizeof(wchar_t) * wcslen(wcsString)) == 0; 
   delete str;
   delete wstr;

   str = encode(wcsString, 20127); //US-ASCII (7-bit) encoding
   wstr = decode(str, 20127);
   //If there were non-ascii characters existing on wcsString, 
   //we cannot return back, since some of the data is lost
   ok = memcmp(wstr, wcsString, sizeof(wchar_t) * wcslen(wcsString)) == 0; 
   delete str;
   delete wstr;
} 
```

另一方面，如果您的编译器字符设置设置为多字节，则**LPTSTR**将被解释为**char***。

在这种情况下：

```
LPTSTR x = "test";
char* y;
y = x; 
```

另见：

关于 wchar_t 转换的另一个讨论：[如何正确使用 WideCharToMultiByte](https://stackoverflow.com/questions/215963/how-do-you-properly-use-widechartomultibyte)
MSDN 文章： http: [//msdn.microsoft.com/en-us/library/dd374130](http://msdn.microsoft.com/en-us/library/dd374130(v=vs.85).aspx)
(v=vs.85).aspx 有效代码页标识符：[http:// msdn.microsoft.com/en-us/library/dd317756(v=vs.85).aspx](http://msdn.microsoft.com/en-us/library/dd317756(v=vs.85).aspx)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-05T06:18:25.840

```
char * pCopy = NULL;
if (sizeof(TCHAR) == sizeof(char))
{
    size_t size = strlen(pOriginal);
    pCopy = new char[size + 1];
    strcpy(pCopy, pOriginal);
}
else
{
    size_t size = wcstombs(NULL, pOriginal, 0);
    pCopy = new char[size + 1];
    wcstombs(pCopy, pOriginal, size + 1);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2014-02-24T20:33:13.827

好的，假设您必须使用 Unicode。你使用了一些像 LookupAccountSid 这样的函数，这些函数是你的程序运行所必需的——但它们会返回 LPTSTR 以获得你需要作为字符串处理的重要信息（无论出于何种原因——它正在编程，会发生这样的事情）

现在，如果您使用多字节 - 这将不是问题。但是有一种方法可以解决它。这是我的方法，诚然是草率的。但尽管如此，您应该能够看到它是如何工作的。

```
const std::wstring &wstring = AcctName; // AcctName being my LPTSTR string
int size_needed = WideCharToMultiByte(CP_UTF8, 0, &wstring[0], (int)wstring.size(), NULL, 0, NULL, NULL);
std::string strTo(size_needed, 0);

WideCharToMultiByte(CP_UTF8, 0, & wstring[0], (int)wstring[0], &strTo[0], size_needed, NULL, NULL);

char* charUserName = new char[strTo.size() + 1];

// Set charUserName via copying
std::copy(strTo.begin(), strTo.end(), charUserName);
charUserName[strTo.size()] = '\0';

SetUPI(charUserName); // charUserName being my converted char * - 
// You don't need this last part - but this is an example of passing to method
// that takes a string 
```

任何问题都可以问。我意识到这是一个旧帖子 - 但我喜欢为未来的人发帖。（像我这样的人）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-02-03T21:19:37.770

我希望这对某人有所帮助，因为我花了一段时间才弄清楚如何去做。

首先，`LPTSTR`是指针类型，它基本上等价于`TCHAR*`（假设`<tchar.h>`包括在内）。请注意，大小`TCHAR`因字符编码类型而异。即，如果定义了 unicode，`TCHAR`则等于`wchar_t`，否则为`char`。

自然，如果将宽字符转换为普通字符`char`，则只能保留 LSB，可能会丢失一些数据。这对我来说有点恼火。所以我写了下面的代码。它的主要优点是在不丢失任何数据的情况下进行转换。

顺便说一句，如果您对数据丢失没问题，那么[`wcstombs`](http://en.cppreference.com/w/cpp/string/multibyte/wcstombs)就可以完成这项工作。

```
#include <cstring>
#include <algorithm>
#include <tchar.h>

void lptstr2str(LPTSTR tch, char* &pch) // or (TCHAR* tch, char* &pch)
{
#ifndef UNICODE
    std::memcpy(pch, tch, strlen(tch) + 1);
#else
    size_t n =
        sizeof(TCHAR) / sizeof(char)* wcsnlen(tch, std::string::npos);
    pch = new char[n + 1];
    std::memcpy(pch, tch, n + 1);
    int len = n - std::count(pch, pch + n, NULL);
    std::remove(pch, pch + n, NULL);
    pch[len] = NULL;
#endif
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-10-10T14:51:52.023

我错过了一些简单的例子，所以这里是：

（对我来说 char* 与 char[] 相同）

```
LPCTSTR myLPCTSTR = getLPCTSTR();
TCHAR myT[500];
wcscpy(myT,myLPCTSTR);
char myC[500];
sprintf(myC, "%S", myT); 
```

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2013-04-28T19:25:04.330

毫无疑问，许多人（例如，我们的 unix 人）会害怕发疯的 Microserf 双语 - “如果你的编译器处于 Unicode 模式，请使用 LPWSTR 或在它前面加上一个“T_”，但前提是它是静态的字符串，与“L”相同，或者如果使用 ATL，则使用 T2A()，但现在已经过时，或者使用 VARIANT，但如果与 COM/OLE 链接则不使用"...)。

此页面上列出的“if (sizeof(TCHAR) == sizeof(char))”是一个很好的解决方案的合乎逻辑的尝试，但它不会编译 - if-true 不会编译或 if-false 不会' 编译，取决于你的编译器标志（Aaargh！）。对于写后忘记的便携式解决方案，您需要求助于 [too-generic named] UNICODE 宏。我提供了对先前代码的这种改编：

```
string mfc_to_zstring (CString &sref)
{
    char nojoy[65536];
    char *ptr, *psin = NULL;
    string sot;
    LPCTSTR p = sref;

#if UNICODE
    if (sizeof(TCHAR) != sizeof(char))
    {
        size_t n = wcstombs(NULL, p, 0);
        if (n > 65530)
        {
            psin = new char[n + 1];
            wcstombs(psin, p, n + 1);
            ptr = psin;
        }
        else
        {
            wcstombs(nojoy, p, n + 1);
            ptr = nojoy;
        }

        sot = ptr;
        if (psin != NULL)
            delete psin;
    }
    else
        { std::cerr << "Aaargh! Microsoft horror.\n"; exit(1); }
#else
    if (sizeof(TCHAR) == sizeof(char))
    {
        const char *ptr = p;
        sot = ptr;
    }
    else
      { std::cerr << "Aaargh! You should never see this line\n"; exit(1); }
#endif

    return sot;
} 
```

# c# - 如何使用 C# 流式传输网络摄像头视频？

> ID：342774
> 
> 赞同：56
> 
> 时间：2008-12-05T02:54:17.860
> 
> 标签：c#, video, streaming, webcam

我想制作一个简单的服务器应用程序，人们可以使用基于浏览器的客户端（我稍后会制作）连接以观看流式视频。我想使用 C#。

我需要什么才能通过网络摄像头捕捉视频或快速图像并通过网络发送？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2008-12-05T22:48:52.127

如果您想要一个“盒子中的捕获/流媒体”组件，正如其他人所提到的那样，那里有几个。

如果您想对这一切进行低级控制，则需要使用 DirectShow，正如 thealliedhacker 指出的那样。在 C# 中使用 DirectShow 的最佳方式是通过[DirectShow.Net](http://directshownet.sourceforge.net/)库 - 它包含所有 DirectShow COM API 并包含许多有用的快捷功能。

除了捕获和流式传输之外，您还可以进行录制、音频和视频格式转换、音频和视频实时过滤器以及很多东西。

微软声称 DirectShow 正在消失，但他们还没有发布一个新的库或 API 来完成 DirectShow 提供的所有功能。我怀疑他们发布的许多最新内容仍然是 DirectShow。由于它在 Microsoft 的地位，除了 MSDN 和您可以在论坛上找到的内容之外，没有太多关于它的书籍或参考资料。去年，当我们使用它开始一个项目时，关于这个主题的最好的书 -[*微软 DirectShow 编程*](https://rads.stackoverflow.com/amzn/click/com/0735618216)- 已经绝版，二手书的价格约为 350 美元！

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-12-05T22:20:46.083

通常的 API 是 DirectShow。

您可以使用 P/Invoke 导入 C++ API，但我认为已经有一些项目可以做到这一点。

[http://channel9.msdn.com/forums/TechOff/93476-Programatically-Using-A-Webcam-In-C/](http://channel9.msdn.com/forums/TechOff/93476-Programatically-Using-A-Webcam-In-C/)

[http://www.codeproject.com/KB/directx/DirXVidStrm.aspx](http://www.codeproject.com/KB/directx/DirXVidStrm.aspx)

要获得流式传输部分，您可能希望使用 DirectShow 应用压缩编解码器以减少延迟，然后您可以获得 Stream 并传输它。您可以考虑使用多播来减少网络负载。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-04T17:22:21.583

你可以只使用[VideoLAN](http://www.videolan.org/)。VideoLAN 将用作服务器（或者您可以将自己的 C# 应用程序包装在它周围以获得更多控制）。您还可以使用查看器的 .NET 包装器，从而将其嵌入到 C# 客户端中。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-05T08:16:19.393

我在我们的项目中使用了[VideoCapX](http://www.fathsoft.com/videocapx.html)。它将以 MMS/ASF 流的形式流出，可由媒体播放器打开。然后，您可以将媒体播放器嵌入到您的网页中。

如果您不需要太多控制，或者如果您想在不编写代码的情况下尝试 VideoCapX，请尝试[U-Broadcast](http://www.uticasoft.com/products/ubroadcast.htm)，他们在幕后使用 VideoCapX。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2016-12-06T16:08:12.547

将图像从网络摄像头流式传输到浏览器的另一种选择是通过 mjpeg。这只是大多数现代浏览器支持作为标签一部分的一系列 jpeg 图像。这是一个用 c# 编写的示例服务器：

[https://www.codeproject.com/articles/371955/motion-jpeg-streaming-server](https://www.codeproject.com/articles/371955/motion-jpeg-streaming-server)

This works well over a LAN, but not as well over the internet as mjpeg is not as effcient as other video codecs (h264, VP8 etc..)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-03-27T21:05:45.913

如果您想从网络浏览器中录制视频，我认为您唯一的选择是 Flash。我们正在寻求做同样的事情。我们也主要是 .NET 公司，我看不到使用 .NET 捕获网络摄像头 _from_within_the_browser_ 的方法。如果您乐于使用桌面应用程序，这里提到的所有其他解决方案都可能会很好用

# php - Zend_Paginator 模糊 MVC 行

> ID：342777
> 
> 赞同：6
> 
> 时间：2008-12-05T02:55:58.200
> 
> 标签：php, model-view-controller, zend-framework, zend-paginator

我正在开发一个 Zend Framework (1.7) 项目，其结构松散地基于快速启动应用程序的结构 - 前端控制器、动作控制器、视图和模型，它们使用 Zend_Db_Table 访问数据库。我的一个主要模型依赖于一些昂贵的连接来提取它的主要列表，所以我正在研究使用 Zend_Paginator 来减少从数据库中返回的行数。我的问题是 Zend_Paginator 只带有 4 个适配器，它们似乎都不适合我。

*   **数组**：构建数组以提供给 ZP 将涉及获取所有记录，这是我试图避免的
*   **迭代器**：愚蠢的迭代器会出现与数组相同的问题，而聪明的迭代器会觉得它不适合模型
*   **DbSelect**：将 DbSelect 对象添加到 Controller 会使 Controller 与我的 DB 的内部工作方式联系起来很不自在（更不用说生成原始结果行而不是封装对象了）
*   **DbTableSelect**：与 DbSelect 相同
*   **空适配器**：手动来回传递所有细节。

将分页器传递给模型感觉也违反了 MVC 分离。问题是我错误地构建了我的模型，是我在维护 MVC 分离方面过于教条，还是我错过了一种将所有移动部件粘在一起的干净、优雅的方式？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T18:12:41.747

您可以在模型上提供一个接口，该接口接受`$current_page`和`$per_page`参数化并返回当前页面的数据集以及分页器对象。

这样，您的所有分页代码都包含在模型中，您可以自由使用 Db 适配器，而不会觉得您已经破坏了这个概念。

另外，无论如何，控制器确实不应该设置寻呼机，因为您正确地将其绑定到数据（模型用于数据，而不仅仅是数据库连接）。

```
class Model
{
    //...
    /**
     * @return array Array in the form: array( 'paginator' => obj, 'resultset' => obj )
     */
    public function getAll( $where = array(), $current_page = null, $per_page = null );
    //...
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-02-23T19:55:45.987

Zend_Paginator 现在有一个 setFilter 方法，它允许您将数据从行对象加载到您想要的任何模型对象：

```
class Model_UserDataMapper {
    public function getUsers($select, $page) {
        $pager = Zend_Paginator::factory($select);
        $pager->setItemCountPerPage(10)
                    >setCurrentPageNumber($page)
                    ->setFilter(new Zend_Filter_Callback(array($this,'getUserObjects')));
    }

    public function getUserObjects($rows) {
        $users = array();

        foreach($rows as $row) {
            $user  = new Model_User($row->toArray());

            $users[] = $user;
        }

        return $users;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-12-30T05:06:28.810

我***真的***需要一个解决方案，在其中我可以使用 Zend_Db_Table 类方法作为我的分页器适配器的资源，而不是数组或 Zend_Db_Select 对象。

这种高级建模与 Zend_Paginator 的标准适配器不兼容。我继续为每个迫切需要答案的人解决了这个问题，就像我一样。

```
<?php

    /* /zend/Paginator/Adapter/DbTableMethod.php */    
    class Zend_Paginator_Adapter_DbTableMethod implements Zend_Paginator_Adapter_Interface {

        protected $_class;
        protected $_method;
        protected $_parameters;
        protected $_rowCount = null;

        public function __construct($class, $method, array $parameters = array()){

        $reflectionClass = new ReflectionClass($class);
        $reflectionMethod = $reflectionClass->getMethod($method);
        $reflectionParameters = $reflectionMethod->getParameters();

        $_parameters = array();

        foreach ($reflectionParameters as $reflectionParameter){

            $_parameters[$reflectionParameter->name] = ($reflectionParameter->isDefaultValueAvailable()) ? $reflectionParameter->getDefaultValue() : null;

        }       

        foreach ($parameters as $parameterName => $parameterValue){

            if (array_key_exists($parameterName, $_parameters)) $_parameters[$parameterName] = $parameterValue;

        }

        $this->_class = $class;
        $this->_method = $method;
        $this->_parameters = $_parameters;

        }

        public function count(){

            if (is_null($this->_rowCount)){

                $parameters = $this->_parameters;
                $parameters['count'] = true;

                $this->_rowCount = call_user_func_array(array($this->_class, $this->_method), $parameters);

            }       

            return $this->_rowCount;

        }

        public function getItems($offset, $itemCountPerPage){

            $parameters = $this->_parameters;
            $parameters['limit'] = $itemCountPerPage;
            $parameters['offset'] = $offset;

            $items = call_user_func_array(array($this->_class, $this->_method), $parameters);

            return $items;
        }

    }

?> 
```

这是它在您的控制器中的工作方式：

```
 <?php

    class StoreController extends Zend_Controller_Action {

        public function storeCustomersAction(){

            $model = new Default_Model_Store();
            $method = 'getStoreCustomers';
            $parameters = array('storeId' => 1);

            $paginator = new Zend_Paginator(new Site_Paginator_Adapter_DbTableMethod($model, $method, $parameters));
            $paginator->setCurrentPageNumber($this->_request->getParam('page', 1));
            $paginator->setItemCountPerPage(20);

            $this->view->paginator = $paginator;

        }

    }

?> 
```

这个适配器工作的唯一要求是在你的模型方法参数列表中列出以下参数（以任何顺序[适配器将通过反射检测方法签名）：

**$limit = 0, $offset = 0, $count = false**

分页器将使用 $limit、$offset 和 $count 参数的适当值调用您的方法。就是这样！

例子：

```
 <?php

        class Default_Model_Store extends Zend_Db_Table {

        public function getStoreCustomers($storeId, $includeCustomerOrders = false, $limit = 0, $offset = 0, $count = false){

if ($count) /* return SELECT COUNT(*) ... */  

                /* ... run primary query, get result */
               $select = $this->_db->select(...)->limit($limit, $offset);

               $rows = $this->_db->fetchAll($select);

               if ($includeCustomerOrders){

                  foreach ($rows as &$row){

                      $customerId = $row['id'];
                      $row['orders'] = $this->getCustomerOrders($customerId);

                   }

               }

               return $rows;    

            }

        }

    ?> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T04:23:32.250

好吧，我无法回答您对使用 DbSelect 的担忧，但我确实遇到了与减少提取行数问题有关的这段代码（在 ibuildings 博客的评论中）。可能对一些读者有用。

```
$select = $db->from('users')->order('name');    
$paginator = new Zend_Paginator(new Zend_Paginator_Adapter_DbSelect($select));
$paginator->setCurrentPageNumber($this->_getParam('page', 1));
$paginator->setItemCountPerPage(25);
$this->view->paginator = $paginator; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T19:01:58.263

使用 MVC 时要考虑的一个重要考虑因素是模型适用于所有域逻辑，而控制器适用于业务逻辑。一般的经验法则是模型不应该知道接口（控制器或视图），但它们不必是简单的数据库访问器。为了尽可能地便携，他们也不应该对格式或显示属性一无所知（除非这是域逻辑的一部分）。

事实上，所有操作域逻辑的逻辑都应该在模型中，而不是在控制器中。控制器应该从界面传递信息，根据需要将其转换到模型，并选择要显示/更新的视图。如果它与接口没有任何关系，它可能会更好地在模型中表示而不是在控制器中表示，因为如果您决定稍后更换控制器/视图配对，它将允许更多的代码重用。

理想情况下，您的模型应该提供一个接口来访问您需要的信息。只要模型不知道 MVC 的 VC 部分，如何在该接口后面实现它就不是 MVC 关心的问题。如果这意味着传递一个分页器对象，那并不直接违反 MVC 原则，但如果分页器与渲染本身有任何关系（对不起，我不知道 Zend），最好传递一个接口将其放入（即缺少渲染方法），让模型对其进行操作/填充，然后将其传回。这样您就不会从模型生成渲染代码，并且如果您决定稍后将应用程序变成控制台应用程序（或添加某种 API 接口），则可以替换分页器实现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-12-06T22:14:14.443

如果您使用 DbSelect 适配器，您可以简单地传递结果集，这对于保持一些分离大有帮助。所以在你的控制器中：

```
$items = new Items();//setup model as usual in controller
$this->view->paginator = Zend_Paginator::factory($items->getAll()); //initialize the pagination in the view NB getAll is just a custom function to encapsulate my query in the model that returns a Zend_Db_Table_Rowset
$this->view->paginator->setCurrentPageNumber($page); //$page is just the page number that could be passed in as a param in the request
$this->view->paginator->setView($this->view); 
```

在视图中，您可以通过分页器访问数据

```
<?php foreach($this->paginator as $item):?>
 <?=$item->someProperty?>
<?php endforeach;?> 
```

这是一个简化的示例（我还在引导程序中设置了默认滚动样式和默认视图部分），但我认为在控制器中设置它并不错，因为从模型中检索到的数据由控制器放入视图中无论如何，这个实现使用结果集而不是模型。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-02-24T06:08:20.043

您也可以直接实现 Zend_Paginator_Adapter_Interface 或在任何需要支持分页的模型中扩展 Zend_Paginator_Adapter_DbSelect。

这样，模型就不会直接知道关于 View、Controller 甚至 Zend_Paginator 的任何信息，但可以在任何最有意义的地方直接与 Zend_Paginator 一起使用。

```
class ModelSet extends Zend_Paginator_Adapter_DbSelect
{
    public function __construct( ... )
    {
        // Create a new Zend_Db_Select ($select) representing the desired
        // data set using incoming criteria
        parent::__construct($select);
    }
    ...
} 
```

有了这样的东西，您可以在最有意义的任何地方使用此类的实例直接实例化寻呼机：

```
$modelSet = new ModelSet( ... );
...
$pager = new Zend_Paginator( $modelSet );
$pager->setItemCountPerPage( ... );
$pager->setCurrentPageNumber( ... );
...
// The first time the record set is actually retrieved will be at the beginning
// of the first traversal
foreach ($pager as $record)
{
    // ... do stuff with the record ...
} 
```

现在，您可以将此类用作任何“模型”集合的基类。

# sql-server - 如何登录到 SQL Server 2000 中的表？

> ID：342789
> 
> 赞同：2
> 
> 时间：2008-12-05T03:04:36.963
> 
> 标签：sql-server, logging, log4net

我正在写入一个日志文件，但我想在我的数据库中登录一个名为“Log”的表。

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T03:22:12.047

log4net 有一个[AdoNetAppender](http://logging.apache.org/log4net/release/sdk/log4net.Appender.AdoNetAppender.html)和一个[示例配置](http://logging.apache.org/log4net/release/config-examples.html)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T03:11:59.447

查看 logging.apache.org 以获取适合您使用的语言的 log4X。我知道他们有 log4j (Java) 和 log4net (C#/.Net)。他们还提供了有关如何配置日志记录框架以记录到数据库表而不是文件的示例。

# wpf - 如何从数据绑定的 ItemsControl 中获取模板化项目的实例？(WPF)

> ID：342790
> 
> 赞同：2
> 
> 时间：2008-12-05T03:04:49.350
> 
> 标签：wpf, data-binding, datatemplate, itemscontrol, contentpresenter

我有一个`<ItemsControl>`带有自定义的`<DataTemplate>`（还有一个`<ItemsPanelTemplate>`只是 a的自定义`WrapPanel`），通过绑定`ItemsSource`到一个简单的可观察字符串集合。

`DataTemplate`仅包含一个自定义实例，其`UserControl`属性通过 绑定到字符串`{Binding}`。

问题是因为我的数据项只是字符串，我需要`UserControl`直接以编程方式访问我的实例，但我似乎无法弄清楚如何！

我试过了：

```
var item = tagBar.Items[ tagBar.Items.Count - 1 ]; 
```

...但这只是返回字符串。还：

```
var item2 = tagBar.ItemContainerGenerator.ContainerFromIndex( tagBar.Items.Count - 1 ); 
```

...返回 a `ContentPresenter`，我不知道如何处理`ContentPresenter`以获取 my 的实例`UserControl`。

??

这类似于[这个问题](https://stackoverflow.com/questions/283943/find-ui-element-corresponding-to-an-item-in-a-silverlight-itemscontrol)，但它从未得到正确回答，并且也是 Silverlight 特有的，而这是 WPF。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T03:10:55.890

我[在此处](https://stackoverflow.com/questions/329556/focus-on-textbox-in-datatemplate#329571)发布的答案涉及将元素集中在 DataTemplate 中，但它应该提供您需要的代码。它涉及使用 DataTemplate 上的 FindName 方法在其中查找控件。如果你给你的 UserControl 一个名字，你应该是对的。

# asp.net - 显示重写而不是原始 URL 的 IIS 日志文件

> ID：342822
> 
> 赞同：3
> 
> 时间：2008-12-05T03:24:45.550
> 
> 标签：asp.net, iis, url-rewriting, logfiles

我有一个问题，改变我在 Asp.Net 应用程序中进行 Url 重写的方式已经改变了 IIS 日志文件，看起来像这样：

/page/ 80 等等.. /page/anotherpage/ 80 等等...

至

default.aspx page=1 80 等... default.aspx page=2 80 等...

我有点困惑这是怎么发生的。是否有我缺少的设置（Win 2008，ASP.NET 2.0） 中的“runAllManagedRequests”设置也已打开。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-01-07T17:36:17.890

URL 重写是否由模块完成？如果是，那么重写模块可能在日志模块之前运行。您可以更改模块在 IIS 管理器中运行的顺序。进入IIS 管理器中的**模块并选择****查看有序列表...**；然后你可以按照你想要的顺序上下移动模块。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T12:42:54.613

我不知道您使用什么方法来重写 URL，但我知道使用 Apache（以及 Windows 上的 ISAPI_Rewrite）您必须在 .htaccess 文件（或等效文件）中的每个规则中添加一个标志以告诉它记录重写的 URL，而不是原始 URL。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-17T18:36:25.403

这个问题是[重复](https://stackoverflow.com/questions/353541/iis7-rewritepath-and-iis-log-files)的。

我遇到了完全相同的问题。解决此问题的一种方法是使用 Server.Transfer 而不是 Context.RewritePath。Server.Transfer 不会重新启动整个页面生命周期，因此仍会记录原始 URL。确保为“preserveForm”参数传递“true”，以便 QueryString 和 Form 集合可用于第二页。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T15:40:46.080

据我所知，这将是设计使然，因为 IIS 只接收重写的 URL 而不是原始 URL，因为重写的 URL 被发送到 .Net 应用程序及其进行转换的应用程序。

# wpf - WPF - 用户控件中的动画，学习，试图理解，但感觉很糟糕

> ID：342829
> 
> 赞同：1
> 
> 时间：2008-12-05T03:33:16.377
> 
> 标签：wpf, animation, user-controls

好的，因为我搞砸了，所以我正在重做。:) 这是xaml。

```
<Window
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    x:Class="ucWaitIndicator.Window1"
    x:Name="Window"
    Title="Window1"
    Width="640" Height="480">
    <Window.Resources>
        <Storyboard x:Key="OnLoaded1">
            <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Storyboard.TargetName="path" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[2].(RotateTransform.Angle)" RepeatBehavior="Forever">
                <SplineDoubleKeyFrame KeyTime="00:00:00.5000000" Value="360"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>
    </Window.Resources>
    <Window.Triggers>
        <EventTrigger RoutedEvent="FrameworkElement.Loaded">
            <BeginStoryboard Storyboard="{StaticResource OnLoaded1}"/>
        </EventTrigger>
    </Window.Triggers>

    <Grid x:Name="LayoutRoot">
        <Path Data="M180.99244,64C116.37543,64 63.992443,116.38299 63.992443,181 63.992443,245.61742 116.37549,298 180.99244,298 245.60981,298 297.99244,245.61737 297.99244,181 297.99244,116.38304 245.60986,64 180.99244,64z M180.99244,0.5C205.91427,0.5 229.65641,5.5507355 251.25119,14.684582 256.64987,16.968037 261.91435,19.506668 267.02946,22.285378 307.95065,44.515015 339.31398,82.108706 353.37751,127.32482 356.89353,138.6289 359.32811,150.40922 360.56053,162.54492 361.79308,174.68071 361.79307,187.31935 360.56053,199.45508 355.63085,247.99793 331.46539,290.85483 295.8072,320.28259 277.97817,334.9964 257.2756,346.35331 234.66763,353.38507 223.36361,356.90106 211.58325,359.33566 199.44752,360.56808 187.31179,361.80063 174.67315,361.80063 162.53737,360.56808 113.99482,355.63844 71.137715,331.47319 41.70987,295.81476 26.995966,277.98571 15.63918,257.28314 8.6073667,234.67519 5.0914601,223.37117 2.6567941,211.59082 1.4243458,199.45508 0.19188775,187.31935 0.19188165,174.68071 1.4243458,162.54492 6.3541056,114.00227 30.519295,71.145355 66.177677,41.717426 84.006863,27.003489 104.70924,15.646738 127.31726,8.6149235 138.62133,5.0989907 150.40165,2.6643478 162.53737,1.4319025 168.60525,0.81567122 174.76199,0.5 180.99244,0.5z" Margin="10,10,0,0" x:Name="path" RenderTransformOrigin="0.5,0.5" Stretch="Fill" Stroke="Black" Height="77" HorizontalAlignment="Left" VerticalAlignment="Top" Width="77" MouseLeftButtonDown="path_MouseLeftButtonDown" MouseRightButtonDown="path_MouseRightButtonDown">
            <Path.RenderTransform>
                <TransformGroup>
                    <ScaleTransform ScaleX="1" ScaleY="1" />
                    <SkewTransform AngleX="0" AngleY="0" />
                    <RotateTransform Angle="0" />
                    <TranslateTransform X="0" Y="0" />
                </TransformGroup>
            </Path.RenderTransform>
            <Path.Fill>
                <LinearGradientBrush EndPoint="0.5,1" StartPoint="0.5,0">
                    <GradientStop Color="Black" Offset="0" />
                    <GradientStop Color="#FF7E7E7E" Offset="1" />
                </LinearGradientBrush>
            </Path.Fill>
        </Path>
    </Grid>
</Window> 
```

这是一个连续的动画。在代码隐藏中，我有以下内容：

```
public partial class Window1 : Window
{
public Storyboard myStoryboard;

public Window1()
    {
        this.InitializeComponent();

        // Insert code required on object creation below this point.
    myStoryboard = (Storyboard)TryFindResource("OnLoaded1");
    myStoryboard.Begin();
}

private void path_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
{
    myStoryboard.Begin();
}

private void path_MouseRightButtonDown(object sender, MouseButtonEventArgs e)
{
    myStoryboard.Stop();

}

} 
```

使用 start 和 stop 方法，我得到了非常零星的控制。有时停止有效，但前提是我先完成了右键单击启动。我不明白为什么 STOP 没有停止它，而 start 没有启动它？

多谢你们。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T04:11:11.247

您想在 XAML 中还是在后面的 c# 代码中执行此操作？

这两种方法都可以为您的动画提供很大的灵活性。

这是 XAML 故事板解决方案，如果您想要纯 c# 版本，请告诉我。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Shapes;
using System.Media.Animation;
using System.Windows.Resources;
using System.Windows.Markup;
// Make sure to include this reference to use Storyboard Class
using System.Windows.Media.Animation;

namespace StoryboardSample
{
    public partial class Window1 : Window
 {
        // Set up the Storyboard variable
        public Storyboard myStoryboard;
        public Window1()
  {
   this.InitializeComponent();

   // Assign the Storyboard to the variable.
            myStoryboard = (Storyboard)TryFindResource("myStoryboard");
            myFunction();

  }
        public void myFunction()
        {
            // Begin the Animation
            myStoryboard.Begin();
        }
 }
}

<Window
 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
 x:Class="StoryboardSample.Window1"
 x:Name="Window"
 Title="Window1"
 Width="640" Height="480">
 <Window.Resources>
  <Storyboard x:Key="myStoryboard">
   <DoubleAnimationUsingKeyFrames BeginTime="00:00:00" Storyboard.TargetName="myRect" Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[3].(TranslateTransform.Y)">
    <SplineDoubleKeyFrame KeyTime="00:00:00" Value="0"/>
    <SplineDoubleKeyFrame KeyTime="00:00:01" Value="-71"/>
   </DoubleAnimationUsingKeyFrames>
  </Storyboard>
 </Window.Resources>
 <Grid x:Name="LayoutRoot">
 <Rectangle x:Name="myRect" Fill="Black" Width="300" Height="150" RenderTransformOrigin="0.5,0.5" >
  <Rectangle.RenderTransform>
   <TransformGroup>
    <ScaleTransform ScaleX="1" ScaleY="1"/>
    <SkewTransform AngleX="0" AngleY="0"/>
    <RotateTransform Angle="0"/>
    <TranslateTransform X="0" Y="0"/>
   </TransformGroup>
  </Rectangle.RenderTransform>
 </Rectangle>
 </Grid>
</Window> 
```

我在[我的博客](http://www.ryancdavidson.com/personal/2008/10/access-wpf-storyboard-in-xaml-from-code.html)上有一篇文章，其中包含有关此代码的更多详细信息。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-08T16:44:21.707

这完全符合我的预期。如果您需要有关我所做工作的更多信息，请告诉我。它归结为 XAML 故事板的行为方式。起初它们可能有点棘手，因为开始/停止/暂停/恢复行为并不十分明显。除非它已经在运行，否则您不能暂停/恢复，并且（在 Silverlight 中）您不能再次开始情节提要，除非您实际上已经停止它。所以循环函数有这两行

```
// Silverlight ONLY    
storyboard.Stop(); 
storyboard.Begin(); 
```

幸运的是 WPF 不会让你这样做。

```
public partial class Window1 : Window
    {
        public Storyboard myStoryboard;

        public Window1()
        {
            this.InitializeComponent();

            // Insert code required on object creation below this point.
            myStoryboard = (Storyboard)TryFindResource("OnLoaded1");
            // This will loop your storyboard endlessly so you can use the Pause/Resume functions
            myStoryboard.Completed += new EventHandler(myStoryboard_Completed);
            // Begin the animation and immediately Pause it.
            myStoryboard.Begin();
            myStoryboard.Pause();
        }

        void myStoryboard_Completed(object sender, EventArgs e)
        {
            myStoryboard.Begin();

        }

        private void path_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
        {
           // Start the spinning again 
           myStoryboard.Resume();
        }

        private void path_MouseRightButtonDown(object sender, MouseButtonEventArgs e)
        {
           // Pause the Spinning.
            myStoryboard.Pause();

        }

    } 
```

您还需要删除事件触发器，并从代码后面启动情节提要。

```
 <Window.Triggers>
        <EventTrigger RoutedEvent="FrameworkElement.Loaded">
            <!-- REMOVE THIS LINE
                   <BeginStoryboard Storyboard="{StaticResource OnLoaded1}"/>
                    -->
        </EventTrigger>
    </Window.Triggers> 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T04:02:09.767

你还没有任何东西可以开始或停止。你需要一个故事板。从这个[动画概述开始 (msdn)](http://msdn.microsoft.com/en-us/library/ms752312.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T04:16:37.070

[查看Chris Anderson 的](http://chrisa.wordpress.com/) [Silverlight 2 应用程序](http://www.silverlightshow.net/items/Building-a-Silverlight-Line-Of-Business-Application-Part-4.aspx)中的等待指示器：（链接中提供了完整源代码和现场演示。）

```
<!-- Created by Chris Anderson: http://chrisa.wordpress.com -->
<UserControl x:Class="SilverlightLOBFramework.Controls.Layout.WaitIndicator"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    Width="30" Height="30">

    <UserControl.Resources>
        <Storyboard x:Name="IndicatorStoryboard">
            <ColorAnimationUsingKeyFrames 
                                  Storyboard.TargetName="Ellipse1"
                                  Storyboard.TargetProperty="(Fill).(SolidBrush.Color)"
                                  BeginTime="0" RepeatBehavior="Forever">

                <LinearColorKeyFrame Value="#CCFFFFFF" KeyTime="00:00:00" />
                <LinearColorKeyFrame Value="#9CFFFFFF" KeyTime="00:00:00.15" />
                <LinearColorKeyFrame Value="#6DFFFFFF" KeyTime="00:00:00.3" />
                <LinearColorKeyFrame Value="#3EFFFFFF" KeyTime="00:00:00.45" />
                <LinearColorKeyFrame Value="#2EFFFFFF" KeyTime="00:00:00.60" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.75" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.90" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:01.05" />
            </ColorAnimationUsingKeyFrames>

            <ColorAnimationUsingKeyFrames 
                                  Storyboard.TargetName="Ellipse2"
                                  Storyboard.TargetProperty="(Fill).(SolidBrush.Color)"
                                  BeginTime="0" RepeatBehavior="Forever">

                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00" />
                <LinearColorKeyFrame Value="#CCFFFFFF" KeyTime="00:00:00.15" />
                <LinearColorKeyFrame Value="#9CFFFFFF" KeyTime="00:00:00.3" />
                <LinearColorKeyFrame Value="#6DFFFFFF" KeyTime="00:00:00.45" />
                <LinearColorKeyFrame Value="#3EFFFFFF" KeyTime="00:00:00.60" />
                <LinearColorKeyFrame Value="#2EFFFFFF" KeyTime="00:00:00.75" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.90" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:01.05" />
            </ColorAnimationUsingKeyFrames>

            <ColorAnimationUsingKeyFrames 
                                  Storyboard.TargetName="Ellipse3"
                                  Storyboard.TargetProperty="(Fill).(SolidBrush.Color)"
                                  BeginTime="0" RepeatBehavior="Forever">

                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.15" />
                <LinearColorKeyFrame Value="#CCFFFFFF" KeyTime="00:00:00.3" />
                <LinearColorKeyFrame Value="#9CFFFFFF" KeyTime="00:00:00.45" />
                <LinearColorKeyFrame Value="#6DFFFFFF" KeyTime="00:00:00.60" />
                <LinearColorKeyFrame Value="#3EFFFFFF" KeyTime="00:00:00.75" />
                <LinearColorKeyFrame Value="#2EFFFFFF" KeyTime="00:00:00.90" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:01.05" />
            </ColorAnimationUsingKeyFrames>

            <ColorAnimationUsingKeyFrames 
                                  Storyboard.TargetName="Ellipse4"
                                  Storyboard.TargetProperty="(Fill).(SolidBrush.Color)"
                                  BeginTime="0" RepeatBehavior="Forever">

                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.15" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.3" />
                <LinearColorKeyFrame Value="#CCFFFFFF" KeyTime="00:00:00.45" />
                <LinearColorKeyFrame Value="#9CFFFFFF" KeyTime="00:00:00.60" />
                <LinearColorKeyFrame Value="#6DFFFFFF" KeyTime="00:00:00.75" />
                <LinearColorKeyFrame Value="#3EFFFFFF" KeyTime="00:00:00.90" />
                <LinearColorKeyFrame Value="#2EFFFFFF" KeyTime="00:00:01.05" />
            </ColorAnimationUsingKeyFrames>

            <ColorAnimationUsingKeyFrames 
                                  Storyboard.TargetName="Ellipse5"
                                  Storyboard.TargetProperty="(Fill).(SolidBrush.Color)"
                                  BeginTime="0" RepeatBehavior="Forever">

                <LinearColorKeyFrame Value="#2EFFFFFF" KeyTime="00:00:00" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.15" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.3" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.45" />
                <LinearColorKeyFrame Value="#CCFFFFFF" KeyTime="00:00:00.60" />
                <LinearColorKeyFrame Value="#9CFFFFFF" KeyTime="00:00:00.75" />
                <LinearColorKeyFrame Value="#6DFFFFFF" KeyTime="00:00:00.90" />
                <LinearColorKeyFrame Value="#3EFFFFFF" KeyTime="00:00:01.05" />
            </ColorAnimationUsingKeyFrames>

            <ColorAnimationUsingKeyFrames 
                                  Storyboard.TargetName="Ellipse6"
                                  Storyboard.TargetProperty="(Fill).(SolidBrush.Color)"
                                  BeginTime="0" RepeatBehavior="Forever">

                <LinearColorKeyFrame Value="#3EFFFFFF" KeyTime="00:00:00" />
                <LinearColorKeyFrame Value="#2EFFFFFF" KeyTime="00:00:00.15" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.3" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.45" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.60" />
                <LinearColorKeyFrame Value="#CCFFFFFF" KeyTime="00:00:00.75" />
                <LinearColorKeyFrame Value="#9CFFFFFF" KeyTime="00:00:00.90" />
                <LinearColorKeyFrame Value="#6DFFFFFF" KeyTime="00:00:01.05" />
            </ColorAnimationUsingKeyFrames>

            <ColorAnimationUsingKeyFrames 
                                  Storyboard.TargetName="Ellipse7"
                                  Storyboard.TargetProperty="(Fill).(SolidBrush.Color)"
                                  BeginTime="0" RepeatBehavior="Forever">

                <LinearColorKeyFrame Value="#6DFFFFFF" KeyTime="00:00:00" />
                <LinearColorKeyFrame Value="#3EFFFFFF" KeyTime="00:00:00.15" />
                <LinearColorKeyFrame Value="#2EFFFFFF" KeyTime="00:00:00.3" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.45" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.60" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.75" />
                <LinearColorKeyFrame Value="#CCFFFFFF" KeyTime="00:00:00.90" />
                <LinearColorKeyFrame Value="#9CFFFFFF" KeyTime="00:00:01.05" />
            </ColorAnimationUsingKeyFrames>

            <ColorAnimationUsingKeyFrames 
                                  Storyboard.TargetName="Ellipse8"
                                  Storyboard.TargetProperty="(Fill).(SolidBrush.Color)"
                                  BeginTime="0" RepeatBehavior="Forever">

                <LinearColorKeyFrame Value="#9CFFFFFF" KeyTime="00:00:00" />
                <LinearColorKeyFrame Value="#6DFFFFFF" KeyTime="00:00:00.15" />
                <LinearColorKeyFrame Value="#3EFFFFFF" KeyTime="00:00:00.3" />
                <LinearColorKeyFrame Value="#2EFFFFFF" KeyTime="00:00:00.45" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.60" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.75" />
                <LinearColorKeyFrame Value="#1EFFFFFF" KeyTime="00:00:00.90" />
                <LinearColorKeyFrame Value="#CCFFFFFF" KeyTime="00:00:01.05" />
            </ColorAnimationUsingKeyFrames>
        </Storyboard>
    </UserControl.Resources>

    <Canvas x:Name="LayoutRoot">
        <Ellipse x:Name="Ellipse1" Fill="#1EFFFFFF" Canvas.Left="0" Canvas.Top="11" Height="8" Width="8"></Ellipse>
        <Ellipse x:Name="Ellipse2" Fill="#1EFFFFFF" Canvas.Left="3" Canvas.Top="3" Height="8" Width="8"></Ellipse>
        <Ellipse x:Name="Ellipse3" Fill="#1EFFFFFF" Canvas.Left="11" Canvas.Top="0" Height="8" Width="8"></Ellipse>
        <Ellipse x:Name="Ellipse4" Fill="#2EFFFFFF" Canvas.Left="19" Canvas.Top="3" Height="8" Width="8"></Ellipse>
        <Ellipse x:Name="Ellipse5" Fill="#3EFFFFFF" Canvas.Left="22" Canvas.Top="11" Height="8" Width="8"></Ellipse>
        <Ellipse x:Name="Ellipse6" Fill="#6DFFFFFF" Canvas.Left="19" Canvas.Top="19" Height="8" Width="8"></Ellipse>
        <Ellipse x:Name="Ellipse7" Fill="#9CFFFFFF" Canvas.Left="11" Canvas.Top="22" Height="8" Width="8"></Ellipse>
        <Ellipse x:Name="Ellipse8" Fill="#CCFFFFFF" Canvas.Left="3" Canvas.Top="19" Height="8" Width="8"></Ellipse>
    </Canvas>
</UserControl> 
```

* * *

```
using System.Windows;
using System.Windows.Controls;

namespace SilverlightLOBFramework.Controls.Layout
{
    public partial class WaitIndicator : UserControl
    {
        #region Constructor
        public WaitIndicator()
        {
            InitializeComponent();

            if (!System.ComponentModel.DesignerProperties.GetIsInDesignMode(this))
                LayoutRoot.Visibility = Visibility.Collapsed;
        } 
        #endregion

        #region Public Functions
        public void Start()
        {
            LayoutRoot.Visibility = Visibility.Visible;
            IndicatorStoryboard.Begin();
        }

        public void Stop()
        {
            LayoutRoot.Visibility = Visibility.Collapsed;
            IndicatorStoryboard.Stop();
        } 
        #endregion
    }
} 
```

# c++ - SDL_DisplayFormatAlpha (c++) 的问题

> ID：342839
> 
> 赞同：0
> 
> 时间：2008-12-05T03:38:43.807
> 
> 标签：c++, sdl, alpha-transparency

正如我在[这个问题](https://stackoverflow.com/questions/341192/segmentation-fault-using-sdl-with-c-trying-to-blit-images)中所说，我正在将 SDL 用于我正在开发的一个小游戏。现在我遇到了 SDL_DisplayFormatAlpha 的问题。我正在尝试从 PNG 图像创建一个带有 alpha 通道的表面。它以前可以工作，但现在我做了一些轻微的重构，有些东西坏了。我把它缩小到这个构造函数：

```
 Surface::Surface( tfilename file ) {
    // initialize the surface data member to the image indicated by filename
    SDL_Surface *tempSurface;
    tempSurface = IMG_Load( file.c_str() );
    if ( !tempSurface ) {
        surface = NULL;
        exit(1);
    }
    else {
        surface = SDL_DisplayFormatAlpha( tempSurface );
        //surface = tempSurface;
    }
    SDL_FreeSurface( tempSurface );
} 
```

这编译得很好，但是当我运行它时，我得到一个分段错误。gdb报错：

```
程序收到信号 SIGSEGV，分段错误。
[切换到线程 0xb79c16c0 (LWP 8089)]
来自 /usr/lib/libSDL-1.2.so.0 的 SDL_DisplayFormatAlpha () 中的 0xb7e8b9a3

```

堆栈跟踪如下：

```
#0 0xb7e8b9a3 in SDL_DisplayFormatAlpha () from /usr/lib/libSDL-1.2.so.0
#1 0x0804987e 在 Surface (this=0x804d060, file=@0xbfb20760) 在 Surface.cpp:16
#2 图像中的 0x0804a159 (this=0x804d038, x=0, y=0, file=@0xbfb207a0)
    在 Image.cpp:16
#3 0x0804a3de in Object (this=0x804d028, imageFile=@0xbfb207dc)
    在 Object.cpp:4
#4 0x080491cb in Application (this=0xbfb20810) at Application.cpp:8
#5 0x08048e0d in main () at main.cpp:5

```

如果我像这样评论`surface = SDL_DisplayFormatAlpha( tempSurface );` 和`SDL_FreeSurface( tempSurface );`取消评论`surface = tempSurface;`：

```
 Surface::Surface( tfilename file ) {
    // initialize the surface data member to the image indicated by filename
    SDL_Surface *tempSurface;
    tempSurface = IMG_Load( file.c_str() );
    if ( !tempSurface ) {
        surface = NULL;
        exit(1);
    }
    else {
        //surface = SDL_DisplayFormatAlpha( tempSurface );
        surface = tempSurface;
    }
    //SDL_FreeSurface( tempSurface );
}
```

然后它似乎工作得很好。谁能告诉我发生了什么事？实际上，当我注释掉 SDL_DisplayFormatAlpha 时，透明度似乎也有效。该功能是否仅适用于尚未具有 Alpha 通道的图像？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-05T03:56:11.587

IMG_Load 应该自动处理透明 PNG，作为您的帖子说明的结尾。抛出的实际异常/错误是什么？您的堆栈跟踪没有显示这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T07:24:23.790

如果您阅读此处的链接（相关功能）：

[SDL_DisplayFormat](http://sdl.beuc.net/sdl.wiki/SDL_DisplayFormat)

“您必须在使用 SDL_DisplayFormat 函数之前调用 SDL_Init。如果不这样做，您的程序将因访问冲突而崩溃。”

那会是你的问题吗？

# math - 如何计算百分比？

> ID：342843
> 
> 赞同：22
> 
> 时间：2008-12-05T03:40:15.940
> 
> 标签：math

我想计算 $total 的 $x 百分比是多少。$x 可以是 15%、20% 等，而 $total 可以是 1000、2000 等。例如，我想要 1000 的 15%。

计算这个的公式是什么？（我知道这不*完全是*一个编码问题，但我正在编码这个功能并且需要帮助！

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-05T03:45:19.097

```
(actual / available) * 100 = percent // start

actual / available = percent / 100

actual = (percent / 100) * available // finish 
```

例如 1000 的 15%

```
actual = (15 / 100) * 1000
actual = 0.15 * 1000
actual = 150 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-05T03:43:42.080

公式：

```
percentage = partialAmount / totalAmount
totalAmount = partialAmount / percentage
partialAmount = percentage * totalAmount 
```

请注意，百分比通常是 0 到 1 之间的十进制数

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-05T03:43:23.610

给定 X 和 Y，Y 的 X% 是 X * Y/100。如果使用整数运算，请确保使用 (X * Y)/100，而不是 (X / 100) * Y。

1000 的 15% 是 (15*1000)/100，也就是 150。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T03:43:53.377

不知道我是否在这里遗漏了一些东西，但如果你只是想要一个数字的百分比，只需将它乘以百分比并除以 100：

新总计 = 总计 * 百分比 / 100

IE：

新总计 = 1000 * 15/100

或者

新总计 = 1000 * 0.15

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-03-14T12:45:55.170

您是在寻找值的百分比还是值的百分比？

不同的是，百分比是基于原始值，而百分比中的百分比假设总数已经包括您的百分比，并且基数相应较低。

例如，百分比计算将是：“如果我以 15% 的利率投资 1000 美元，一年后我会收到多少？” 答案当然是 150 美元——按百分比计算，“我有这 15% 的投资一年，现在价值 1000 美元。我一开始是多少？” 答案不是人们可能天真地期望的 850 美元。

既然你提到了总数，我怀疑你正在寻找总数中的百分比。要推导出它的公式，您必须从 DaEagle 的公式向后工作：

他的版本是：

新价值 = 1000 美元 * 15%

因此总数为：

总计 = 1000 美元 * (1 + 0.15)

对于百分比计算，您知道总数，但您不知道起始值：

1000 美元 = 起始值 * (1 + 0.15)

解决 StartValue 的问题：

起始值 = $1000/(1 + 0.15)

起始值 = 869.57 美元

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2013-09-15T20:43:37.693

```
$x = 15;
$total = 1000;
$answer = $total * $x / 100 
```

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2015-02-11T20:13:39.570

您必须考虑 totalAmount 为零的情况，否则您将面临运行时错误（除以零）的风险。而且，您可能希望对答案进行四舍五入。

```
#A Perl one liner to to do this is:
$pc=$tot>0 ? sprintf('%.0f', $x/$tot*100 ).'%' : 'N/A'; 
```

# email - 电子邮件中的简单表格...有可能吗？

> ID：342844
> 
> 赞同：1
> 
> 时间：2008-12-05T03:40:59.963
> 
> 标签：email, forms

我正在为假日艺术市场设计一个 html 电子邮件。该请求仅用于图形设计，使其漂亮 - 放置日期/时间等，但我想知道我是否也可以在电子邮件中实现 RSVP 表单：你来吗，是还是不？这可以通过电子邮件完成，还是我需要重定向到网站？如果可以，怎么做？

再次感谢 SOF 社区！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T03:48:42.943

最简单的解决方案 - 如果您只需要一个是或否的答案 - 是嵌入两个链接，一个代表是，一个代表否，在链接的查询字符串参数中已经有标识信息，例如

```
http://www.yourdomain.com/rsvp.aspx?by=email@receiver.com&response=no

http://www.yourdomain.com/rsvp.aspx?by=email@receiver.com&response=yes 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T03:48:29.310

上次我尝试过（大约在 2001 年）它工作得很好。只需确保表单标签的 action= 属性包含绝对 URL。

吉姆。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T04:13:55.687

我不会在电子邮件中添加它。人们会有充分的理由对此保持警惕——没有简单的方法可以判断“动作”指向哪里；并且客户在单击提交按钮后不会在不知情的情况下被重定向到网站。

我*强烈*建议链接到一个网站。或者 - 甚至更好 - 使用他们的电子邮件地址和查询字符串中的答案生成两个链接。IE

```
<a href = "www.yoursite.com/submit?from={$SenderEmailAddress}&answer=yes">Yes</a>

<a href = "www.yoursite.com/submit?from={$SenderEmailAddress}&answer=no">No</a> 
```

这样，您可以确保人们在没有收到邀请时不会意外回答两次或回答。

# php - Refactoring a massive function into many files

> ID：342862
> 
> 赞同：1
> 
> 时间：2008-12-05T03:50:08.667
> 
> 标签：php, xml, refactoring, include

I've been trying to refactor a "bit" of code that I'd previously developed. Basically, the project was my response to not knowing how to use XSLT effectively, so I developed an XML transformation system in PHP. The program reads through the tags of an XML file and does something along these lines to convert it to HTML:

```
private function getTemplate(...) {
    switch ($nodeName) {
        case "a" :
            // code here to generate a link tag
            break;
        case "box" :
            // code here to generate the divs and whatnot to create a box
            break;
        case "ref" :
            // look up an external reference file and include a bibliography
            break;
        default :
            // do the default thing
    }
} 
```

That was all working great, except that I ended up with 26 branches to my switch, and that once switch block was over 1000 lines of code. Needless to say, it made maintenance slightly more difficult.

What I've done now is to pull the code of each branch out into its own file (named "a.php", "box.php", "ref.php" ...) and `include` that file each time:

```
if (file_exists("templates/$nodeName.php")) {
    include "templates/$nodeName.php";
} else {
    // do the default thing
} 
```

Again, this works, but benchmarking it shows that it has slowed down processing times by 50%. I'm assuming that this is because there's now up to 4000 `include`s being done now.

What I was considering was to put the code for each template into a function, and if the function hasn't been declared then include the file, and then run the function - the only problem with that is that the existing code has been written in the scope of the original function, using `$this`, etc.

Given that this code is not run in real time (eg: it merely processes the XML into static HTML files which are stored - it's not done on the fly), do you have any advice for me here?

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-12-05T04:01:47.350

caveat: i don't know PHP, but I can [google](http://us3.php.net/manual/en/functions.variable-functions.php) and i like function pointers better than huge switch statements, so if you can't just use XSLT...

...one option would be to adopt a naming convention for your 'worker' functions that incorporated the html node's tag name, e.g. <tagname>_converter, include all the functions, and replace your switch statement with something like:

```
private function getTemplate(...) 
{
    $func = $nodeName + "_converter";
    if (function_exists($func))    //see if function is defined, somehow...
    {
        $func();    //call conversion function (pass whatever is needed)
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T04:43:50.273

尝试这样的事情：

```
//utils.php
函数句柄框（$节点）
{
//...
}

函数句柄链接（$节点）
{
//....
}
?\>

```

然后：

```
require_once '模板/utils.php';

函数获取模板（）
{
  开关（$节点）
  {
      案例“一”：
        handle_link($node,$otherParams);
      休息;
  }
}

}

```

基本上，这会将每个节点的所有功能重构为自己的功能。从这里您可以研究更通用的解决方案。它与您原来的非常相似，但 switch/case 语句将更易于管理，而其中没有大量代码。然后，如果您认为有必要，您可以考虑实现[Stratgy 设计模式。](http://en.wikipedia.org/wiki/Strategy_pattern)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T12:04:12.617

无需深入研究 XSLT 本身并专注于重构问题：您已经考虑了相当多的不同策略。我将针对您已经尝试过的一种方法以及另一种可能对您有用的方法提供优化技巧。

当你说依赖很多文件时性能下降了 50%。我认为您没有启用 PHP 操作码缓存。你这样做了，那 50% 的损失应该会消失。

在另一种方法上，我建议创建一个基类`NodeProcessor`左右。然后为每个节点创建一个新类`ANodeProcessor`，`RefNodeProcessor`...等。

或者，您只能创建一个`NodeProcessor`包含以下形式的方法的类：`processTag`. 然后：

1.  你可以打电话`$this->processNode($tag);`
2.  在那个方法中：`$name = 'process'. $tag;`
3.  然后：`return $this->nodeProcessor->{$name};`
4.  `NodeProcessor`应该有一种方法来为未定义方法`__call()`的标签执行“默认操作” 。`processTag`

同样，不要忘记添加操作码缓存。

# frameworks - 使用哪个 .net Web 应用程序框架？

> ID：342878
> 
> 赞同：2
> 
> 时间：2008-12-05T04:02:08.363
> 
> 标签：frameworks

我正在寻找一个可靠且易于使用的 .NET Web 应用程序框架，以供公司范围内的开发使用。我正在考虑 DotNetNuke。好吗 ？你还能推荐什么？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T04:33:55.287

如果您想要 .NET 中的“Web 应用程序”框架，那么您的选择可以归结为 ASP.NET 或 ASP.NET MVC（均来自 Microsoft），或者诸如 Castle Monorail 之类的开源替代方案。

如果您想最大限度地使用供应商控件，并且您正在将基于表单的小型应用程序放在一起，那么 ASP.NET 将是您的最佳选择。

对于任何更大或更复杂的事情，如果您可以在没有供应商控制的情况下进行操作，那么 ASP.NET MVC 或 Castle Monorail 将为您提供更好的结果，因为它们会迫使您进行更好的实践。

但是，如果您正在寻找一个现有的 Web 应用程序作为定制的基础，那么您的出发点需要是告诉我们更多关于您想要实现的目标的细节。

根据您的要求，Dotnetnuke 可能非常适合您的需求，也可能是一个非常糟糕的选择。没有更多信息，我们无法判断。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-12-05T04:10:24.600

DotNetNuke 是一个内容管理系统。那里有很多，而且供应商的解决方案比你能动摇的要多。这完全取决于您需要/想要什么，以及成本是否是一个问题。更多信息会有所帮助。这更像是一个面向 wiki 的项目吗？内网网站？两者兼而有之？24/7 支持是个问题吗？

您在寻找[框架](http://en.wikipedia.org/wiki/Web_application_framework)吗？还是[内容管理系统](http://en.wikipedia.org/wiki/Content_Management_System)？

[内容管理系统列表](http://cmscritic.com/)。还有一些商业的，比如[SharePoint](http://www.microsoft.com/sharepoint/default.mspx)，以及大量的自定义供应商解决方案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-09-25T11:05:55.037

对于任何复杂的应用程序，ASP.NET 网络表单更好，因为您只需要处理 C# 并且事件驱动编程更容易。管理大型 ASP.NET MVC 应用程序只是一场噩梦。不要被 MVC 中的单元测试所吸引。

如果您使用网络表单，您将专注于应用程序而不是编码复杂性。+ 你有这么多的网络控制，让你的工作更轻松。

您可能会使用一些框架，例如用于日志记录的框架或 Microsft Enterprise Framework，以使应用程序更具可配置性。

也访问 Ext.NET。他们有一些专门用于 ASP.NET Web 表单的控件，可以使您的应用程序看起来更好。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T04:36:23.817

SharePoint 是一个选项，但我不推荐它。我一直想尝试 DotNetNuke。它有一个强大的社区和大量的增长。

在我们放弃它之前，我们的团队在 SharePoint 功能上工作了 5 个月。部署和调试是糟糕的经历。我们不得不求助于 Visual Studio 中冗长的构建脚本，并且我们使用了一些开源工具（[WspBuilder](http://www.codeplex.com/wspbuilder)、[SharePoint Installer](http://www.codeplex.com/sharepointinstaller)等），只是为了使过程中途易于管理。

也许有一天 SharePoint 会长大并获得真正的 Visual Studio 集成（我听说这是 VS 2010 的计划）。到那时，实在是太麻烦了。学习曲线很陡峭，您将不得不花费*大量*时间搜索 XML 配置文件以跟踪问题。SharePoint 可能会让你鄙视 XML 配置！

**更新：** Sharepoint 在 VS2010 中得到了一些非常需要的关注。见：[http://www.cmswire.com/cms/enterpr...](http://www.cmswire.com/cms/enterprise-cms/new-sharepoint-developer-tools-in-visual-studio-2010-004050.php)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-12-05T06:08:41.850

最后，您将需要多个框架。仅用一个很难支持任何复杂的业务环境。听起来您对 .NET 很感兴趣，所以我会坚持使用 ASP.NET 或 ASP.NET MVC。将 ASP.NET MVC 用于需要域驱动开发和测试的大型应用程序。将 ASP.NET 用于与您的 SQL 模式非常匹配的数据驱动应用程序（快速而复杂的应用程序，没有太多复杂性）。假设您使用 MS SQL 进行持久性。我还会考虑最新版本的 SharePoint。它现在基于 ASP.NET 2.0，比过去更容易处理。如果您的许多业务需求都很简单，那么您可以使用 SharePoint 开箱即用地提供大量功能。当然，使用 SharePoint，您将需要优秀的支持人员来进行备份、维护和恢复。

# java - Java Timer class says "Timer tasks should complete quickly" , how do we define quickly?

> ID：342896
> 
> 赞同：4
> 
> 时间：2008-12-05T04:14:55.573
> 
> 标签：java, timer

I am planning to use this to poll a database which can take close to 10-15 minutes or more, so should I be using timers for this.

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-12-05T04:26:54.787

If you want the task to complete quickly but what you need to do actually takes longer, you could split it up into two pieces. Have one that runs when the Timer fires, so you get things happening at the right time, but then defer the serious processing to another function (say, in a different thread) that can take as long as it needs. From the API, the problem with Timer tasks taking too long is that they hog the thread, possibly delaying subsequent tasks, so moving the time-consuming processing to another thread should avoid that problem. To answer the question in your title, "quickly" would mean "it should finish before the Timer needs to fire again".

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-12-05T04:20:38.073

I'm assuming you talking about the java.util.Timer, not the Swing specific ones?

If I remember correctly, that timer simply defers execution to a single background thread that essentially serves every timer instance in the JVM, so the problem could be that one timer hogs that thread for every other timer.

So quickly would depend on the rest of your application and whether you use other timers.

Generally, I avoid using it for anything serious, or I just have it spawn a new thread.

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-12-05T04:37:44.267

尽管如果您从计时器任务中生成一个线程来完成工作，请注意时间触发速度比线程完成速度更快的情况，从而导致工作量不断下降。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T13:07:09.913

`java.util.concurrent.ScheduledThreadPoolExecutor`是“新`java.util.Timer`”。您可以拥有多个（一个池）线程，因此您可以容纳长时间运行的任务。即便如此，您可能需要考虑检查是否重叠太多。

当然，您可以拥有多个`Timer`s，并`TimerTask`适当地分配您的 s。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-12-05T04:24:48.783

The timer TASK should execute quickly, the polling interval is irrelevant to its usage. Make sure you aren't confusing the two.

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-05T11:29:37.383

在这种情况下，这意味着您必须在下一个计时器事件发生之前完成您的工作，否则将不会处理下一个事件。由于计时器类是全局的，因此您永远无法确定还有谁在使用它（例如，您的数据库驱动程序可能正在使用它来实现超时）。

如果您必须做长时间的工作，请使用计时器“启动”另一个线程（将项目添加到工作队列或在计时器事件处理程序中启动第二个线程）。这将快速释放下一个事件的计时器。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-12-05T14:32:27.683

The answer is, it depends. If you are only going to have this one polling task run, and the interval is more than sufficient for each run to finish before the next one begins, then this solutions will work fine.

The problem is when there is more than one TimeTask on the same Timer, since they execute sequentially on the same thread. Therefore a long running task would cause the other tasks to wait for long periods of time, which defeats the purpose of creating timed tasks.

There are better solutions for the more complex scenario in the java.util.concurrent package as well as other libraries like Quartz.

# iphone - Application crashes on iPhone OS 2.2, works fine on 2.1

> ID：342910
> 
> 赞同：0
> 
> 时间：2008-12-05T04:20:46.217
> 
> 标签：iphone, cocoa-touch, instruments

This is the trace of my app,when I updated my device to 2.2.

any idea to get rid of this leak? because I think that's the culprit who keep crashing my application.
This is trace when I run my application in os2.2,see the image which show the part which might be generating leak,and if you can give me some hints to resolve it, will be greatly appreciated.

[alt text http://origindata.wapfly.com.au/extra/Picture%204.png](http://origindata.wapfly.com.au/extra/Picture%204.png)

[alt text http://origindata.wapfly.com.au/extra/Picture%203.png](http://origindata.wapfly.com.au/extra/Picture%203.png) This is trace when I run my application in os2.1.it's very wired issue. [alt text http://origindata.wapfly.com.au/extra/Picture%205.png](http://origindata.wapfly.com.au/extra/Picture%205.png)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-12-06T07:06:32.030

如果不访问代码，该跟踪就毫无意义。我的建议是下载并安装 Clang 静态分析器并针对它运行代码以确定泄漏的位置。它可以在[http://clang.llvm.org/StaticAnalysis.html](http://clang.llvm.org/StaticAnalysis.html)找到- 要使用它，请将 .tar.gz 文件的内容复制到 /usr/bin 然后 cd 到您的 Xcode 项目并运行`scan-build xcodebuild`. 此时，您将获得指示您复制和粘贴类似于`scan-view /tmp/logs/...` That 的行的输出，这应该会给您一些指示。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-01-29T20:55:21.467

您需要点击 Instruments 右上角的“查看”按钮并选择“Extended Detail”，然后点击上面选择的行项目，然后点击 Extended Details 右侧栏中的详细信息，它将打开XCode 中出错的代码行

# c++ - Simple Asynchronous Multi-Threaded HTTP request library for C++

> ID：342918
> 
> 赞同：3
> 
> 时间：2008-12-05T04:29:02.613
> 
> 标签：c++, multithreading, asynchronous, client-server

I'll be quick and honest: I'm currently trying to write a client/server for an online game. Since I'm poor and limited on resources, I'll be testing the bare basics of the server using a PHP backend, with the eventual goal being to rebuild the server end in C++.

I'm looking for a C++ library for Windows (XP and Vista preferably) that will let me use a finite number of threads, one dedicated to each piece of the networking problem. As an example, I want to use a thread to report the positional information of the player to the server (and to receive responses about positional information of the other players) but I want a different thread to background download in the 3D artwork for the area/players, and a different thread for the built in chat system, etc. These all need to be fairly independent of one another.

I know what I want to *do* with the library, I've got the design bit figured out, I just feel a bit silly re-inventing the wheel, since I know that a good library for this exact purpose probably already exists. So, what are your suggestions? I need to be able to send data to a server, and accept responses. Ideally, the request needs to trigger an Event when its done (so I can immediately grab the data and do something with it) and I need to be able to handle multiple transactions simultaneously. HTTP is a nice bonus, but I can handle HTTP protocol myself if necessary, especially considering that I plan on dropping it in the long run.

Thanks!

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T04:35:28.827

[Boost.Asio](http://www.boost.org/doc/libs/1_37_0/doc/html/boost_asio.html)

ASIO 有简单的 Web 服务器示例。

[Boost.Thread](http://www.boost.org/doc/libs/1_37_0/doc/html/thread.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-12-05T05:12:52.103

你可以试试[POCO](http://pocoproject.org/poco/info/)库。它有一个多线程 TCP 服务器和一个 HTTP 服务器。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T04:31:33.310

Check out the [Boost](http://www.boost.org/) libraries, in particular, Boost [Threads](http://www.boost.org/doc/libs/1_37_0/doc/html/thread.html).

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-03T17:48:18.880

你可以试试我的[CSocksetServer](http://networkdls.com/Software.Asp?Review=23)类。它可以在单独的线程中处理许多连接，并为您提供许多不同的事件。虽然它没有原生 HTTP 功能，但我已经用它构建了 Web 服务器。

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2009-06-26T22:04:24.037

您应该只使用带有多手柄的[cUrl](http://curl.haxx.se/)。它比你设计的任何东西都更适合做你想做的事。

# iphone - 为什么 navigationItem.titleView 不工作？

> ID：342933
> 
> 赞同：12
> 
> 时间：2008-12-05T04:37:34.140
> 
> 标签：iphone, cocoa-touch

我想在导航栏的中心放置一个 UIButton。根据文档，看来我需要设置标题视图，并确保 leftBarButtonItem 为零。但这对我不起作用。这是代码。

```
UIButton *btn = [UIButton buttonWithType:UIButtonTypeRoundedRect];
[btn setTitle:@"List" forState:UIControlStateNormal];
self.navigationItem.leftBarButtonItem = nil;
[self.navigationItem.titleView addSubview:btn]; 
```

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2008-12-06T07:03:46.903

如果您检查您的按钮，您会发现通过使用便捷方法对其进行初始化，您会留下一个 0x0 按钮，该按钮位于要添加到的视图边界内的 0,0 处。在执行此操作之前，您必须定义`frame`按钮属性的内容。请看下面的代码：

```
UIButton *btn = [UIButton buttonWithType:UIButtonTypeRoundedRect];
btn.frame = CGRectMake(0, 0, 400, kCustomButtonHeight);
[btn setTitle:@"list" forState:UIControlStateNormal];
self.navigationItem.titleView = btn; 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2015-02-26T12:55:48.213

在我的情况下，我试图在子视图控制器中设置它，这修复了它

```
self.parentViewController.navigationItem.titleView = titleView; 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-12-05T04:58:48.233

navigationItem 的视图默认设置为 nil。

你需要使用

```
self.navigationItem.titleView = btn; 
```

# lucene.net - 最大升压系数

> ID：342937
> 
> 赞同：3
> 
> 时间：2008-12-05T04:43:38.263
> 
> 标签：lucene.net

Lucene.Net 中单词的最大提升因子值是多少？我相信默认值是 1.0f

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T07:33:23.287

它可以是任何正数。当然，如果您选择一个不合理的数字，例如 Float.POSITIVE_INFINITY（或 .NET 等价物），您最终会得到一些疯狂的分数。通常，您希望以百分比来查看您的提升：1.0F 是 100%，这意味着没有提升或下降。1.2F是120%，稍微提升一点；0.5 是 50%，这是一个相当显着的下降。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T04:50:39.200

我在谷歌上找到了至少 4 的证据……但我找不到关于上限是多少的更多信息。一些文档重要性描述以 4 为例，这就是我得出结论的地方。

然而，用户文档定义它必须是一个可能小于 1 的正数（大概，给定一些示例，它也可能不小于 1）。

随心所欲地从中汲取灵感。

# .net - 使用 ADO.NET 管理数据库连接

> ID：342946
> 
> 赞同：2
> 
> 时间：2008-12-05T04:54:00.987
> 
> 标签：.net, ado.net, timeout

我们有一个基于 ADO.NET 构建的应用程序。我们遵循一些简单的最佳实践，使我们能够利用连接池。例如，使用数据库的代码块可能如下所示：

> ```
> using( DbConnection dbConnection = GetDatabaseConnection() ) {   
>     doWork();
> } 
> ```

FWIW，GetDatabaseConnection 没有什么特别之处。它与运行 MSSQL Server 2000 的数据库建立连接。实际上，它的内容如下：

> ```
> DbConnection GetDatabaseConnection() {
>     return GetConnection(MyConnectionString);
> }
> 
> DbConnection GetConnection(String connectionString)
> {
>   try {
>       SqlConnection dbConnection = new SqlConnection(connectionString);
>       dbConnection.Open();
>       return dbConnection;
>   } catch( InvalidOperationException ex ) {
>       handleError(ex);
>       throw;
>   } catch( DbException ex ) {
>       handleError(ex);
>   }
> } 
> ```

因此，我们的连接在块作用域的末尾被处理掉了。然而，当我们开始测试应用程序时，我们遇到了一个小故障。我们发现我们的应用程序非常突发，这意味着有时它会变得非常健谈，然后会沉默一段时间。结果是我们可以同时拥有多个线程来获取连接。

所以假设你有 10 个线程。一批工作（请不要试图改写这批工作）到达并被分割成几个线程。然后每个线程都尝试获得连接和繁荣，我遇到了 InvalidOperationException。我已经调整了 ConnectTimeout，所做的只是延长时间，直到我遇到一系列异常。一旦我通过了“结束”阶段，应用程序就很好了。然后它再次停顿，连接“消失”并且该过程再次开始。

我也尝试过调整 LoadBalanceTimeout 但异常继续出现。你们中有人见过这个问题吗？任何想法......我会扔掉我自己的几个。

*   持续保持一些连接“热”
*   尝试再次打开连接，最多尝试 # 次
*   实现我自己的连接池（哎呀，对重新发明轮子不感兴趣）

编辑：

我读过的大多数论坛都不鼓励增加连接池的大小。默认情况下，连接池的上限为 50 个连接（这绰绰有余——如果我必须增加它，其他地方就会出现根本问题）。我注意到的是，当 ConnectTimeout 较低时，会发生 InvalidOperationException。就好像连接的启动时间太长并且待处理的连接都超时了。

MARS 当然是一个选项... InvalidOperationException.Message 的文本是：

超时已过。在从池中获取连接之前超时时间已过。这可能是因为所有池连接都在使用中并且达到了最大池大小。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T20:50:23.410

从 MSDN ( [http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx](http://msdn.microsoft.com/en-us/library/8xx3tyca.aspx) )：

*当请求 SqlConnection 对象时，如果可用连接可用，则从池中获取该对象。为了可用，连接必须未被使用，**具有匹配的事务上下文或与任何事务上下文无关**，并且具有到服务器的有效链接。

连接池程序通过在连接释放回池时重新分配连接来满足连接请求。如果已达到最大池大小并且没有可用的连接可用，则将请求排队。然后，池程序尝试回收任何连接，直到达到超时（默认值为 15 秒）。如果 pooler 在连接超时之前无法满足请求，**则会抛出异常**。*

**翻译：** 检查您的事务上下文...如果您的池大小为 10 个连接，并且在不同的事务下创建了 10 个连接，那么您就完蛋了。

***请注意，只有在尝试与服务器通信后才能检测到断开的连接****。如果发现不再连接到服务器的连接，则将其标记为无效。无效连接仅在关闭或回收时才会从连接池中删除。

如果存在与已消失的服务器的**连接，即使连接池程序没有检测到断开的连接**并将其标记为无效，也可以从池中提取此连接。之所以出现这种情况，是因为检查连接是否仍然有效的开销会通过导致发生与服务器的另一次往返来消除拥有池化程序的好处。发生这种情况时，**第一次尝试使用连接会检测到连接被切断，并抛出异常**。*

**翻译：** 你真的不能靠一个连接来连接吗？这篇文章并没有真正解释如何处理这个......

您可以尝试偶尔使用 ClearAllPools 和 ClearPool 手动清除池，但这对我来说仍然像是创可贴，让我畏缩。

该文章还讨论了安全上下文，说：
*通过调用 sp_setapprole 系统存储过程激活 SQL Server 应用程序角色后，无法重置该连接的安全上下文。但是，如果启用了池化，则将连接返回到池中，并且在重新使用池化连接时会发生错误。*

我开始想知道为什么我使用连接池......

最后：
***由于集成安全*** *性导致 的池碎片连接根据连接字符串和用户身份进行池化。因此，如果您在网站上使用基本身份验证或 Windows 身份验证以及集成的安全登录，您将获得每个用户一个池。尽管这提高了单个用户后续数据库请求的性能，但该用户无法利用其他用户建立的连接。它还导致每个用户至少有一个到数据库服务器的连接。*

因此，如果您在 Web 应用程序上使用集成安全性，如果您有足够的用户，您可以填满您的连接池。

在不了解您的应用程序的更多细节的情况下，很难放大可能会绊倒您的事情，但希望这可以为您提供一些想法。

高温高压

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-12-05T04:58:30.697

您可以尝试将“最大池大小”设置得更高。此外，您可能想尝试在连接上显式调用“关闭”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T05:29:36.377

问题 1：您的 GetDatabaseConnection() 方法是否会派生一个新线程来生成数据库连接并将其返回给主线程......或者是多个线程试图访问该方法的这个实例......或者这个方法是仅从池中获取连接的共享/静态方法？

问题 2：您的数据库服务器是什么品牌和型号？SQL 服务器？甲骨文？PostgreSQL？

问题 3：您是否需要在不同的连接上完成所有工作，或者如果所有工作都可以在一个连接上完成，这就足够了吗？如果是 SQL Server，那么 MARS 可能允许单个连接上的多个记录集可能会有所帮助，但对于您的应用程序可能不可行。

问题4：返回的异常中的细节是什么？

只是想清楚地了解您的应用程序架构是如何工作的......

（PS有谁知道我如何将“答案”标记为“不是答案，而是要求进一步澄清”......即这个“答案”）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T08:49:54.037

根据 MSDN，如果您尚未指定数据源或服务器，或者连接已打开，则 SqlConnection.Open 会引发 InvalidOperationException。

您确定在“doWork”方法中没有对 SqlConnection.Open 的任何调用吗？

此外，您在 GetConnection 方法中的代码会吞下 DbException。

# .net - 开始解耦对象的最佳位置

> ID：342949
> 
> 赞同：2
> 
> 时间：2008-12-05T04:56:32.887
> 
> 标签：.net, language-agnostic, oop, decoupling

这是一个 C# 问题，但实际上可能与语言无关

我继承了一个大型对象模型（100 多种类型），其对象层次结构“拥有”0..n 个其他类型对象，这些对象都共享一个基础（其中存在“相对”严格的类型层次结构）。

我想开始通过继承来解耦这些对象，以组合一个基于 IoC 的系统，以开始实施一些比目前更深入的单元测试。

最好的起点是哪里？

我可以从层次结构的顶部开始，这很简单，但最初的好处最少，并且在我进一步深入链条之前会非常死记硬背，但这需要我在基础对象上实现一些重载函数签名以接受基本接口，直到我得到完全覆盖。

我可以从层次结构的底部开始，这会更棘手，因为那里的类之间有更多的交互，但会“迫使”我们对重构采取更全面的看法。

我也可以从 Base 对象（所有对象都继承自的对象）开始，这将在逻辑点启动进程，但几乎肯定会创建一个不可编译的应用程序，直到我们交换所有对象继承和函数调用.

有什么想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T05:05:13.057

如果你能在合理的时间内完成整个过程，那就从基础开始，把整个事情都走一遍；该应用程序将被破坏，直到您完成

如果您必须同时保持应用程序正常运行，请从顶部开始，一次完成几门课程

我也会考虑自下而上的观点，但怀疑这是否是一种实用的实施方式，因为它可能会破坏一切并且比其他两种方法花费更长的时间，但你的里程可能会有所不同;-)

基本问题是：

*   每种方法需要多长时间？
*   每种策略最终会产生相同的最终代码吗？
*   在转换完成时保持应用程序正常工作有多重要？
*   你有足够的单元测试来信任大规模的重构吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T05:05:45.457

这可能有点太学术了，但是在九十年代中期有很多关于如何自动重构大型类层次结构的研究，例如通过找出常用的接口等。虽然这可能无法解决您的问题，它可能会给你一个很好的选择，让你从哪里开始，或者至少对这些问题有一些有趣的看法。

该链中的第一篇论文是 Godin 和 Mili 的“使用 Galois Lattices 构建和维护分析级类层次结构”（谷歌，你会找到 PDF），还有一系列后续论文（参见引用此的论文）不同的技巧。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T05:06:29.853

从顶部开始创建更小的层次结构，向下移动时使用委托而不是继承。使用策略模式从层次结构中的类中删除行为。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-12-05T06:44:53.103

我会说

*   *好好看看现有的设计......制定一个方法......让一台电脑尝试一下。*（Kent Beck 的指导方针.. 任何设计讨论都不应超出它的范围...... 30 分钟。一旦你遇到障碍，抓住一台机器，对其进行编码，看看它是否有效。）
*   经过一个小时的时间框（或更多根据口味），如果你觉得你正在取得进步......坚持。否则回到绘图板。

刚开始...而不是花费 BDUF 时间试图找出路..它会清除的**。**当然，拥有一个由良好 AT 组成的安全网至关重要。

# haskell - Haskell 函数应用

> ID：342954
> 
> 赞同：21
> 
> 时间：2008-12-05T05:01:27.960
> 
> 标签：haskell, function

有点像 Haskell 新手的问题，但我在 Haskell 的[教程示例中遇到了这个示例](http://www.haskell.org/haskellwiki/99_questions/1_to_10)。对于“查找列表的最后一个元素”，有一些明显的版本，比如

```
last' [x] = x
last' (_:xs) = last' xs 
```

但我无法理解呈现的替代版本：

```
myLast' = foldr1 (const id) 
```

因此，为了理解 id 函数的应用程序在做什么，我在 ghci 中进行了尝试：

```
const id 1 2 -> gives 2 
```

这像这样绑定：

```
(const id) 1 2 -> gives 2 
```

而不是这样：

```
 const (id 1) 2 -> gives 1 
```

但我不明白这一点。`(const id)`应该翻译成类似的东西

```
`(\x y->x) (\x->x)` 
```

这不应该返回一个简单地返回其第一个元素的 id 的函数吗？或者，函数顺序生成 (const id) 的行为与 const 有何不同？

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2008-12-05T06:16:06.750

的定义`const`是

```
const x = \_ -> x 
```

因此，`(const id)`是一个函数，它接受一个参数并始终返回`id`并且

```
const id 1 2 = (\_ -> id) 1 2
             = id 2
             = 2 
```

的定义`foldr1`是

```
foldr1 f [x] = x
foldr1 f (x:xs) = f x (foldr1 f xs) 
```

如果我们有

```
myLast' = foldr1 (const id) 
```

然后

```
myLast' [x] = foldr1 (const id) [x]
              {- definition of foldr1 -}
            = x 
```

和

```
myLast' (x:xs) = foldr1 (const id) (x:xs)
                 {- definition of foldr1 -}
               = (const id) x (foldr1 (const id) xs)
                 {- definition of const -}  
               = (\_ -> id) x (foldr1 (const id) xs)
                 {- function application -}  
               = id (foldr1 (const id) xs)
                 {- definition of id -}  
               = foldr1 (const id) xs
                 {- definition of myLast' -}  
               = myLast' xs 
```

与 的定义一致`last'`。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-12-07T20:49:58.497

`:t`在尝试理解 Haskell 时，我非常依赖。在这种情况下：

```
Prelude> :t const id
const id :: b -> a -> a
```

可能会帮助您了解发生了什么。

# tfs - 创建一个新的 TFS 团队项目并使用现有的源代码管理文件夹

> ID：342957
> 
> 赞同：2
> 
> 时间：2008-12-05T05:05:24.583
> 
> 标签：tfs, tfsbuild

我目前在 TFS 中有一个包含我所有源代码的源代码控制文件夹。是否可以创建一个**新**的团队项目并使用现有的源代码管理文件夹？

我可以选择创建一个新的源代码管理文件夹、创建一个新分支或根本不创建一个。但是有没有办法使用现有的文件夹？

[编辑]澄清一下：我以前有一个名为 ProjectA 和 $/ProjectA 的团队项目和源代码管理文件夹。如果我删除了团队项目但保留了源代码管理文件夹 $/ProjectA，然后想用新模板重新创建一个名为 ProjectA 的团队项目，我可以重新附加现有的源代码管理文件夹 $/ProjectA 吗？

听起来我可能做不到？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-12-05T10:10:19.460

不 - 恐怕您的团队项目的源代码管理中必须有一个文件夹。

在后台，Team Project 的一些设置实际上存储在版本控制系统中的“$/TeamProject”文件夹中，因此 TFS 具有与 Team Project 名称匹配的版本控制文件夹的依赖项。

我能问一下你为什么要创建一个这样的新团队项目吗？可能还有另一种方法可以实现您想要的，或者如果没有，无论如何这对 Microsoft 团队来说都是有价值的反馈。

# html - 格式丰富的内容用什么标记语言？

> ID：342961
> 
> 赞同：12
> 
> 时间：2008-12-05T05:08:57.667
> 
> 标签：html, formatting, markdown, markup, bbcode

当您开发基于 Web 的应用程序并希望允许来自用户的格式丰富的文本时，您必须选择如何允许该输入。已经创建了许多不同的标记语言，因为可以说清理 HTML 更加困难。

各种不同的标记语言有哪些优缺点，例如：

*   [HTML](http://en.wikipedia.org/wiki/HTML)
*   [降价](http://daringfireball.net/projects/markdown/)
*   [BB码](http://en.wikipedia.org/wiki/BBCode)
*   [纺织品](http://www.textism.com/tools/textile/)
*   [MediaWiki 标记](http://www.mediawiki.org/)
*   [其他](http://en.wikipedia.org/wiki/Lightweight_markup_language)

或者换一种说法，您在选择使用特定标记语言时会考虑哪些因素。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-12-05T05:25:44.637

Markdown、BBCode、Textile、MediaWiki 标记基本上都是相同的通用概念，所以我真的只是将其归为两类：HTML 和纯文本标记。

### HTML

与 HTML 的处理是内容已经是 Web 内容的“可呈现”形式。这很棒，节省了处理时间，而且它是一种易于解析的语言。几乎任何语言都有几十个库来处理 HTML 内容，将 HTML 转换为/从 HTML 转换为其他格式等。主要的缺点是，由于早期网络时代的松散标准，HTML 可能会非常多变，你可以在接受来自用户的 HTML 时，并不总是依赖于理智的输入。正如所指出的，整理或净化 HTML 通常是非常困难的，尤其是因为它无法像 XML 那样遵循正常的标记规则（即不正确的闭合标签很常见）。

### 纯文本标记

由于以下原因，经常使用此类别：

*   易于从一个来源解析为多种形式 - PDF、HTML、RTF
*   如果以后需要，内容存储在可读的纯文本中（通常比原始 HTML 更容易阅读），而不是需要从 HTML 中提取
*   遵循特定的定义规则，其中 HTML 可能是令人讨厌的变量和非结构化
*   允许您强制使用在许多情况下更合适的内容格式子集，而不是简单地允许完整的 HTML
*   除了强制使用 HTML 子集之外，还可以轻松清理输入并防止跨站点脚本问题等。
*   以抽象格式保存“原始”数据意味着在以后，例如，如果您想将您的网站从 HTML 4 转换为 XHTML，您只需要更改解析代码。使用 HTML 格式的用户输入，您现在不得不将所有 HTML 单独转换为 XHTML，正如 HTML Tidy 所示，这并不总是一项简单的任务。同样，如果在某个时候出现了一种新的标记语言，或者您需要迁移到另一种格式（RTF、PDF、TeX），那么文本格式选项的抽象受限子集会使这项任务变得更加简单。

底线是用户输入的用途。如果您打算保留数据并且可能需要改组格式等，那么使用谨慎的抽象格式来存储信息是有意义的。如果您出于任何原因需要手动处理原始数据，那么如果该格式易于人类阅读，则可以加分。如果您只在网页（或用于报告的 HTML 文档等）中显示内容，并且您不担心对其进行转换或对其进行未来验证，那么将其存储在 HTML 中是一种合理的做法。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-12-05T05:34:04.043

Jeff讨论了codinghorror.com 上的[一些利弊，当时他们还处于整合 SO 的初始阶段。](http://www.codinghorror.com/blog/archives/001116.html)我认为这是一本值得一读的书。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2013-07-14T14:45:18.077

@netrox 数据库不是问题，浏览器输出才是。

唯一需要担心的是最终呈现可能会被用户插入的 HTML 破坏。例如，用户可以打开一个`<li>`标签但从不关闭它，这取决于页面的结构，可能会破坏随后的整个布局。或者另一个例子打开一个`<strong>`标签而不关闭它，使所有剩余的内容变为粗体。

因此，不仅必须验证允许的标签，而且您究竟如何允许某些标签而不是其他标签？因为使用 PHP 方法很容易阻止所有 HTML 标签的解析[`htmlspecialchars()`](http://php.net/manual/en/function.htmlspecialchars.php)，但是当涉及到允许某些标签时，您将不得不寻找其他方法。有一个[`strip_tags()`](http://th1.php.net/strip_tags)PHP 函数可以删除（完全删除）不允许的标签，但这意味着以一种不好的方式改变用户的内容，例如阻止用户发布简单的代码（共享/显示的代码，而不是处理的代码） .

除了破坏布局外，您还必须考虑 XSS 攻击，例如将 javascript 插入链接的 href 属性，例如可以将用户重定向到另一个站点。查看这个可能的 XSS 攻击的长列表：[https ://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet](https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet)

如您所见，防止所有 HTML 标记被解释非常容易，但仅防止某些标记要复杂得多。要理解这一点，你可以看看巨大的“ [HTML Purifier](http://htmlpurifier.org/doxygen/html/annotated.html) ”框架，它的唯一目的是允许一些 HTML 标签并确保输出的 HTML 是有效的（即不会破坏页面）并且没有 XSS 攻击。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2010-10-21T18:15:26.783

“已经创建了许多不同的标记语言，因为可以说清理 HTML 更加困难。”

真的吗？有多难？有一些功能可以删除潜在危险的属性或标签，并在将 HTML 输入数据库或文件之前对其进行验证。你能给我举例说明清理 HTML 有多困难吗？

# c# - 从实现类中的接口继承注释？

> ID：342964
> 
> 赞同：113
> 
> 时间：2008-12-05T05:12:57.313
> 
> 标签：c#, inheritance, comments

假设我有这个界面

```
public interface IFoo
{
    ///<summary>
    /// Foo method
    ///</summary>
    void Foo();

    ///<summary>
    /// Bar method
    ///</summary>
    void Bar();

    ///<summary>
    /// Situation normal
    ///</summary>
    void Snafu();
} 
```

而这堂课

```
public class Foo : IFoo
{
    public void Foo() { ... }
    public void Bar() { ... }
    public void Snafu() { ... }
} 
```

有没有办法，或者有没有工具可以让我自动将每个成员的注释放入基类或接口中？

因为我讨厌为每个派生子类重写相同的注释！

* * *

## 回答 #1

> 赞同：188
> 
> 时间：2011-09-27T15:22:10.613

您始终可以使用`<inheritdoc />`标签：

```
public class Foo : IFoo
{
    /// <inheritdoc />
    public void Foo() { ... }
    /// <inheritdoc />
    public void Bar() { ... }
    /// <inheritdoc />
    public void Snafu() { ... }
} 
```

使用该`cref`属性，您甚至可以在完全不同的类或命名空间中引用完全不同的成员！

```
public class Foo
{
    /// <inheritdoc cref="System.String.IndexOf" />
    public void Bar() { ... } // this method will now have the documentation of System.String.IndexOf
} 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-12-05T06:48:25.077

`/// <inheritdoc/>`如果您想要继承，请使用。避免使用 GhostDoc 或类似的东西。

我同意评论没有被继承是很烦人的。如果有人有时间（我希望我这样做），这将是一个相当简单的插件。

也就是说，在我们的代码库中，我们只在接口上放置 XML 注释，并向类添加额外的实现注释。这对我们有用，因为我们的类是私有/内部的，只有接口是公共的。每当我们通过接口使用对象时，我们都会在智能中显示完整的评论。

~~GhostDoc 是一个好的开始，它使编写评论的过程更容易。当您添加/删除参数、重新运行 GhostDoc 并且它将更新描述时，保持评论最新特别有用。~~

* * *

## 回答 #3

> 赞同：18
> 
> 时间：2008-12-05T05:15:00.413

[GhostDoc](http://www.roland-weigelt.de/ghostdoc/)正是这样做的。对于未继承的方法，它会尝试根据名称创建描述。

`FlingThing()` 变成`"Flings the Thing"`

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2010-10-11T22:43:58.283

Java 有这个，我一直在使用它。做就是了：

```
/**
 * {@inheritDoc}
 */ 
```

Javadoc 工具可以解决这个问题。

C# 有类似的标记：

```
<inheritDoc/> 
```

你可以在这里阅读更多：

[http://www.ewoodruff.us/shfbdocs/html/79897974-ffc9-4b84-91a5-e50c66a0221d.htm](http://www.ewoodruff.us/shfbdocs/html/79897974-ffc9-4b84-91a5-e50c66a0221d.htm)

* * *

## 回答 #5

> 赞同：14
> 
> 时间：2018-09-19T06:33:49.063

我会说直接使用

```
/// <inheritdoc cref="YourClass.YourMethod"/>  --> For methods inheritance 
```

和

```
/// <inheritdoc cref="YourClass"/>  --> For directly class inheritance 
```

您必须将此评论放在您的课​​程/方法的上一行

例如，这将从您记录的界面中获取您的评论信息，例如：

```
 /// <summary>
    /// This method is awesome!
    /// </summary>
    /// <param name="awesomeParam">The awesome parameter of the month!.</param>
    /// <returns>A <see cref="AwesomeObject"/> that is also awesome...</returns>
    AwesomeObject CreateAwesome(WhateverObject awesomeParam); 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2011-04-21T17:16:32.137

ReSharper 可以选择从基类或接口复制注释。

* * *

## 回答 #7

> 赞同：9
> 
> 时间：2017-01-30T13:56:20.277

另一种方法是使用`<see />`XML 文档标记。这是一些额外的努力，但开箱即用......

这里有些例子：

```
/// <summary>
/// Implementation of <see cref="IFoo"/>.
/// </summary>
public class Foo : IFoo
{
    /// <summary>
    /// See <see cref="IFoo"/>.
    /// </summary>
    public void Foo() { ... }

    /// <summary>
    /// See <see cref="IFoo.Bar"/>
    /// </summary>
    public void Bar() { ... }

    /// <summary>
    /// This implementation of <see cref="IFoo.Snafu"/> uses the a caching algorithm for performance optimization.
    /// </summary>
    public void Snafu() { ... }
} 
```

**更新：**

我现在更喜欢使用`/// <inheritdoc/>`ReSharper 现在支持的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-12-20T06:23:45.013

我最终创建了一个工具来对 XML 文档文件进行后处理，以添加对替换`<inheritdoc/>`XML 文档文件本身中的标记的支持。可在[www.inheritdoc.io 获得](https://www.inheritdoc.io)（提供免费版本）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2019-08-12T20:36:42.953

嗯，有一种原生解决方案，我为 .NET Core 2.2 找到的

这个想法是使用`<include>`标签。

您可以添加`<GenerateDocumentationFile>true</GenerateDocumentationFile>`您`.csproj`的文件。

你可能有一个界面：

```
namespace YourNamespace
{
    /// <summary>
    /// Represents interface for a type.
    /// </summary>
    public interface IType
    {
        /// <summary>
        /// Executes an action in read access mode.
        /// </summary>
        void ExecuteAction();
    }
} 
```

以及从中继承的东西：

```
using System;

namespace YourNamespace
{
    /// <summary>
    /// A type inherited from <see cref="IType"/> interface.
    /// </summary>
    public class InheritedType : IType
    {
        /// <include file='bin\Release\netstandard2.0\YourNamespace.xml' path='doc/members/member[@name="M:YourNamespace.IType.ExecuteAction()"]/*'/>
        public void ExecuteAction() => Console.WriteLine("Action is executed.");
    }
} 
```

好吧，这有点吓人，但它确实将预期的元素添加到`YourNamespace.xml`.

如果您构建配置，您可以在标签的属性中进行交换`Debug`。`Release``Debug``file``include`

要找到正确`member`的`name`引用，只需打开生成的`Documentation.xml`文件。

我还假设这种方法需要至少构建两次项目或解决方案（第一次创建初始 XML 文件，第二次将元素从其中复制到自身）。

好的一面是 Visual Studio 验证复制的元素，因此更容易使文档和代码与接口/基类等保持同步（例如参数名称、类型参数名称等）。

在我的项目中，我最终得到了`<inheritdoc/>`（用于 DocFX）和`<include/>`（用于发布 NuGet 包并在 Visual Studio 中进行验证）：

```
 /// <inheritdoc />
        /// <include file='bin\Release\netstandard2.0\Platform.Threading.xml' path='doc/members/member[@name="M:Platform.Threading.Synchronization.ISynchronization.ExecuteReadOperation(System.Action)"]/*'/>
        public void ExecuteReadOperation(Action action) => action(); 
```

# lucene - 如何在 Lucene 搜索结果中进行分组？

> ID：342966
> 
> 赞同：8
> 
> 时间：2008-12-05T05:13:18.733
> 
> 标签：lucene

如何按字段（类似于 SQL Server）对 Lucene 返回的搜索结果进行分组？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-09-22T15:12:55.493

Lucene 3.4 现在支持分面搜索。在索引时，您指定一些补充内容，并在搜索时按查询和组搜索。

对于接下来的 3 个文档，您使用这些组进行索引

```
doc1: monday, 1pm,  3min    
doc2: monday, 1pm,  4min    
doc3: monday, 2pm,  3min 
```

您可以仅搜索第一个参数：星期一，并获取值：3，或者您可以向下钻取并搜索星期一/下午 1 点并获取值：2 或设置搜索深度 3 并获取

```
monday :3
monday/1pm :2
monday/1pm/3min :1
monday/1pm/4min :1
monday/2pm :1
monday/2pm/3min :1 
```

这是[源示例](https://svn.apache.org/repos/asf/lucene/dev/tags/lucene_solr_3_5_0/lucene/contrib/facet/src/examples/org/apache/lucene/facet/example/simple/)：

但最重要的是阅读[分面搜索](http://en.wikipedia.org/wiki/Faceted_search)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-09-06T15:35:10.820

Lucene 有一些补充库，其中一个是您需要的：[分组](http://lucene.apache.org/core/old_versioned_docs/versions/3_2_0/api/contrib-grouping/org/apache/lucene/search/grouping/package-summary.html)

您不能按函数查询值或任意查询（如 Solr 那样）分组，但可以按单值字段分组。

类似的东西（分面搜索）将在 Lucene 4.0 中实现

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-12-05T05:22:44.907

[https://issues.apache.org/jira/browse/LUCENE-1421](https://issues.apache.org/jira/browse/LUCENE-1421)

看来你不能。不过可能有一种解决方法：这里有一个线程，概述了其他人是如何做到的：[这里](http://markmail.org/message/uvrh3y5ogjgu4gfx#query:group%20lucene%20results%20by%20field+page:1+mid:tyh47sklenvkfcls+state:results)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T07:27:52.707

不清楚您是想要真正的类似于 SQL 的“GROUP BY”行为，还是仅仅想要“ORDER BY”行为。Lucene 中没有聚合函数，因此“GROUP BY”必须在您的应用程序中实现，在 Lucene 之上。

但是，按字段排序相当容易。确保对所需字段进行索引，并创建一个`org.apache.lucene.search.Sort`对象作为搜索条件的一部分传递；大多数搜索方法都有一个接受`Sort`实例的重载。

如果您要实现自己的“GROUP BY”逻辑，那么让结果“ORDERED BY”正确的字段是有用的第一步。

# git - 如何让 bash 完成以使用别名？

> ID：342969
> 
> 赞同：210
> 
> 时间：2008-12-05T05:17:09.693
> 
> 标签：git, bash, shell, unix, autocomplete

一个例子：

我是使用 bash v3.2.17 的 mac，我使用的是通过 macports 安装的带有 bash_completion 变体的 git。

当我键入`git checkout m<tab>`. 例如，我把它完成到`master`.

但是，我有 , 的`git checkout`别名`gco`。当我输入时`gco m<tab>`，我没有自动完成分支名称。

理想情况下，我希望自动完成功能可以神奇地适用于我的所有别名。是否可以？如果做不到这一点，我想为每个别名手动自定义它。那么，我该怎么做呢？

* * *

## 回答 #1

> 赞同：192
> 
> 时间：2013-02-21T18:25:48.963

正如上面评论中所说，

```
complete -o default -o nospace -F _git_checkout gco 
```

将不再工作。但是，`__git_complete`git-completion.bash 中有一个函数可用于为别名设置完成，如下所示：

```
__git_complete gco _git_checkout 
```

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-11-24T21:52:45.397

我也遇到了这个问题，并想出了这个代码片段。这将自动为您完成所有别名。在声明所有（或任何）别名后运行它。

```
# wrap_alias takes three arguments:
# $1: The name of the alias
# $2: The command used in the alias
# $3: The arguments in the alias all in one string
# Generate a wrapper completion function (completer) for an alias
# based on the command and the given arguments, if there is a
# completer for the command, and set the wrapper as the completer for
# the alias.
function wrap_alias() {
  [[ "$#" == 3 ]] || return 1

  local alias_name="$1"
  local aliased_command="$2"
  local alias_arguments="$3"
  local num_alias_arguments=$(echo "$alias_arguments" | wc -w)

  # The completion currently being used for the aliased command.
  local completion=$(complete -p $aliased_command 2> /dev/null)

  # Only a completer based on a function can be wrapped so look for -F
  # in the current completion. This check will also catch commands
  # with no completer for which $completion will be empty.
  echo $completion | grep -q -- -F || return 0

  local namespace=alias_completion::

  # Extract the name of the completion function from a string that
  # looks like: something -F function_name something
  # First strip the beginning of the string up to the function name by
  # removing "* -F " from the front.
  local completion_function=${completion##* -F }
  # Then strip " *" from the end, leaving only the function name.
  completion_function=${completion_function%% *}

  # Try to prevent an infinite loop by not wrapping a function
  # generated by this function. This can happen when the user runs
  # this twice for an alias like ls='ls --color=auto' or alias l='ls'
  # and alias ls='l foo'
  [[ "${completion_function#$namespace}" != $completion_function ]] && return 0

  local wrapper_name="${namespace}${alias_name}"

  eval "
function ${wrapper_name}() {
  let COMP_CWORD+=$num_alias_arguments
  args=( \"${alias_arguments}\" )
  COMP_WORDS=( $aliased_command \${args[@]} \${COMP_WORDS[@]:1} )
  $completion_function
  }
"

  # To create the new completion we use the old one with two
  # replacements:
  # 1) Replace the function with the wrapper.
  local new_completion=${completion/-F * /-F $wrapper_name }
  # 2) Replace the command being completed with the alias.
  new_completion="${new_completion% *} $alias_name"

  eval "$new_completion"
}

# For each defined alias, extract the necessary elements and use them
# to call wrap_alias.
eval "$(alias -p | sed -e 's/alias \([^=][^=]*\)='\''\([^ ][^ ]*\) *\(.*\)'\''/wrap_alias \1 \2 '\''\3'\'' /')"

unset wrap_alias 
```

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2008-12-05T05:55:56.090

`git-completion.bash`里面有一行：

```
complete -o default -o nospace -F _git git 
```

查看该行（和 _git 函数），您可以将此行添加到您的`.bash_profile`：

```
complete -o default -o nospace -F _git_checkout gco 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2016-12-24T07:15:13.630

> 理想情况下，我希望自动完成功能可以神奇地适用于我的所有别名。是否可以？

是的，[完全别名](https://github.com/cykerway/complete-alias)项目（在 Linux 上）是可能的。对 Mac 的支持是实验性的，但用户报告成功。

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2012-05-22T18:07:22.673

我给 g='git' 起了别名，并结合我的 git 别名，我输入了类似的东西

```
$ g co <branchname> 
```

对于我的特定用例，更简单的解决方法是在 git-completion 中添加一行。

在这条线的正下方：

```
__git_complete git _git 
```

我添加了这一行来处理我的单个“g”别名：

```
__git_complete g _git 
```

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2016-02-26T18:52:52.810

另一种选择是使用`~/.bash_completion`文件。要创建`gco`别名，`git checkout`只需将其放在那里：

```
_xfunc git __git_complete gco _git_checkout 
```

然后`~/.bashrc`你必须把别名本身：

```
alias gco='git checkout' 
```

两条线。就是这样。

**解释：**

`~/bash_completion`获取源在主 bash_completion 脚本的末尾。在 gentoo 中，我在`/usr/share/bash-completion/bash_completion`.

该`_xfunc git`位负责`git-completion`为您获取文件，因此您无需在`~/.bashrc`.

接受的答案要求您从我觉得蹩脚的文件中复制`.git-completion.sh`和获取它。`~/.bashrc`

* * *

PS：我仍在试图弄清楚如何不将整个`git-completion`脚本源到我的 bash 环境中。如果您找到方法，请发表评论或编辑。

* * *

## 回答 #7

> 赞同：6
> 
> 时间：2008-12-05T15:39:26.363

您也可以尝试使用 Git 别名。例如，在我的`~/.gitconfig`文件中，我有一个如下所示的部分：

```
[alias]
        co = checkout 
```

因此，您可以键入`git co m<TAB>`，并且应该扩展为`git co master`，这是`git checkout`命令。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2010-01-16T18:19:33.010

[这个论坛页面](http://ubuntuforums.org/showthread.php?t=733397)显示了一个解决方案。

将这些行放入您的`.bashrc`or中`.bash_profile`：

```
# Author.: Ole J
# Date...: 23.03.2008
# License: Whatever

# Wraps a completion function
# make-completion-wrapper <actual completion function> <name of new func.>
#                         <command name> <list supplied arguments>
# eg.
#   alias agi='apt-get install'
#   make-completion-wrapper _apt_get _apt_get_install apt-get install
# defines a function called _apt_get_install (that's $2) that will complete
# the 'agi' alias. (complete -F _apt_get_install agi)
#
function make-completion-wrapper () {
    local function_name="$2"
    local arg_count=$(($#-3))
    local comp_function_name="$1"
    shift 2
    local function="
function $function_name {
    ((COMP_CWORD+=$arg_count))
    COMP_WORDS=( "$@" \${COMP_WORDS[@]:1} )
    "$comp_function_name"
    return 0
}"
    eval "$function"
}

# and now the commands that are specific to this SO question

alias gco='git checkout'

# we create a _git_checkout_mine function that will do the completion for "gco"
# using the completion function "_git"
make-completion-wrapper _git _git_checkout_mine git checkout

# we tell bash to actually use _git_checkout_mine to complete "gco"
complete -o bashdefault -o default -o nospace -F _git_checkout_mine gco 
```

这个解决方案类似于[balshetzer 的脚本](https://stackoverflow.com/questions/342969/how-do-i-get-bash-completion-to-work-with-aliases/1793178#1793178)，但只有这个对我有用。（balshetzer 的脚本对我的一些别名有问题。）

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-11-07T11:07:37.803

您只需要找到该`complete`命令并复制具有别名的行即可。

我有`alias d-m="docker-machine"`。换句话说，`d-m`应该是 的别名`docker-machine`。

所以在 Mac 上（通过 brew），完成文件位于`cd `brew --prefix`/etc/bash_completion.d/`.
就我而言，我编辑了名为`docker-machine`.
一直在底部有：

```
complete -F _docker_machine docker-machine 
```

所以我只是用我的别名添加了另一行：

```
complete -F _docker_machine docker-machine
complete -F _docker_machine d-m 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2018-07-26T22:50:04.973

首先，查找原始完成命令。例子：

```
$ complete | grep git

complete -o bashdefault -o default -o nospace -F __git_wrap__git_main git 
```

现在将这些添加到您的启动脚本中（例如 ~/.bashrc）：

```
# copy the original statement, but replace the last command (git) with your alias (g)
complete -o bashdefault -o default -o nospace -F __git_wrap__git_main g

# load dynamically loaded completion functions (may not be required)
_completion_loader git 
```

该`_completion_loader`行可能不是必需的。但在某些情况下，补全功能只有在你输入命令并`TAB`第一次按下后才会动态加载。因此，如果您没有使用原始命令，并尝试使用别名 + `TAB`，您可能会收到类似“bash: completion: function '_docker' not found”的错误。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2019-03-19T12:35:14.523

这个问题有很多答案，像我自己一样，我敢打赌很多困惑的读者。对于我的情况，我还需要让我的点文件在具有不同版本 Git 的多个平台上工作。我也没有`alias g=git`，而是`g`定义为一个函数。

为了做到这一点，我不得不在这里将不同的答案整合到一个解决方案中。尽管这已经重申了答案，但我认为我船上的某个人可能会发现这个汇编很有用，就像我第一次遇到这个问题时一样。

这假设较旧和较新的 Git 完成、Ubuntu 默认设置和`brew install git`MacOS 上。在后一种情况下，bash 没有处理 brew 安装的完成（我稍后会诊断）。

```
# Alias g to git

g() {
  if [[ $# > 0 ]]; then
    git "$@"
  else
    git status -sb
  fi
}

# Preload git completion in Ubuntu which is normally lazy loaded but we need
# the __git_wrap__git_main function available for our completion.
if [[ -e /usr/share/bash-completion/completions/git ]]; then
  source /usr/share/bash-completion/completions/git
elif [[ -e /usr/local/etc/bash_completion.d/git-completion.bash ]]; then
  source /usr/local/etc/bash_completion.d/git-completion.bash
fi

if command_exists __git_complete; then
  __git_complete g _git
elif command_exists __git_wrap__git_main; then
  complete -o bashdefault -o default -o nospace -F __git_wrap__git_main g
fi 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2021-03-10T12:38:04.993

您可以绑定`Tab`到`alias-expand-line`和`complete`（其默认操作）在`~/.inputrc`. 为此，您首先需要将每个操作绑定到一个键，然后将它们链接在一起：

```
"\M-z":alias-expand-line
"\M-x":complete
TAB:"\M-z\M-x" 
```

您可以使用任何您喜欢的组合键，我使用 Meta 组合键，因为它是免费的。有关[`man 3 readline`](https://www.gnu.org/software/bash/manual/html_node/Readline-Interaction.html)更多信息，请参阅。

现在，如果您打开一个新终端并输入别名：

```
gco m<TAB> 
```

该行将转换为

```
git checkout master 
```

当然，`Tab`即使不涉及别名，它仍然会照常工作。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2019-04-17T18:55:20.727

如果您使用`alias g='git'`，我将这行代码添加到`.bash_aliases`

```
complete -o default -o nospace -F _git g 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-12-29T01:13:42.920

[Felipe Contreras](https://stackoverflow.com/users/10474/felipec)已经非常活跃于 Git 补全功能（请参阅[Git 2.30 中的 Zsh 补全](https://stackoverflow.com/a/64758130/6309)）提出（可能为 Git 2.31，2021 年第一季度）一个有助于别名自动补全的公共功能。

他的提议：

> [早在 2012 年，我就主张](https://lore.kernel.org/git/1334524814-13581-1-git-send-email-felipe.contreras@gmail.com/T/#u)引入一个帮助程序，允许用户指定别名，例如：
> 
> ```
> git_complete gf git_fetch 
> ```
> 
> 那时因为公共功能（`git_complete`vs `_git_complete`vs `_GIT_complete`）没有明确的指导方针而遭到抵制，而且一些别名实际上并没有起作用。
> 
> 快进到 2020 年，公共功能仍然没有指南，而且这些别名仍然不起作用（即使我发送了修复程序）。
> 
> 这并没有阻止人们使用显然需要设置自定义别名（此页面）的此功能，实际上这是推荐的方式。
> 
> 但是用户必须键入很麻烦：
> 
> ```
> __git_complete gf _git_fetch 
> ```
> 
> 或者更糟：
> 
> ```
> __git_complete gk __gitk_main 
> ```
> 
> 8年的时间，足以让你不再等待完美的到来；让我们定义一个实际上对用户友好的公共函数（同名）：
> 
> ```
> __git_complete gf git_fetch
> __git_complete gk gitk 
> ```
> 
> 同时还保持向后兼容性。
> 
> 逻辑是：
> 
> 1.  如果`$2`存在，直接使用
> 2.  如果不存在，请检查是否`__$2_main`存在
> 3.  如果不存在，请检查是否`_$2`存在
> 4.  如果没有，失败

# perl - 我可以用 Perl 编写 DSL 吗？

> ID：342973
> 
> 赞同：13
> 
> 时间：2008-12-05T05:18:27.863
> 
> 标签：perl, dsl

我们使用 Perl 进行 GUI 测试自动化。它非常成功。我们为 GUI 测试编写了一种非常轻量级的 DSL 语言。DSL 与对象模型非常相似。

例如，我们在根目录中有一个 Application 对象。应用程序中的每个属性表都是一个 View 对象。页面下的每个页面都称为 Page 对象本身。我们从 Perl 向 GUI 应用程序发送命令，GUI 解释命令并很好地响应命令。要发送命令，我们执行以下操作：

```
socket_object->send_command("App.View2.Page2.Activate()")
socket_object->send_command("App.View1.Page3.OKBtn.Click()") 
```

这不是很可读。相反，我想为 App、View 和 Page 编写 Perl DSL。Perl 是否提供某种 DSL 结构，我可以在其中执行以下操作？

```
App.View2.Page2.Activate();
App.View1.Page2.Click(); 
```

其中 App 应为 Application 类的实例。我必须在运行时获取 View2 的对象。

这样的东西怎么用？

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2008-12-05T06:30:48.467

你几乎可以在 Perl 中做任何事情。但是你必须做一些*奇怪*的事情才能让 Perl 使用不是 Perl 的语法来执行。

*   要准确处理那里的内容，您将不得不使用许多*高级*技巧，这些技巧根据定义并不那么可维护。你必须：

    *   [重载](http://perldoc.perl.org/overload.html)连接运算符 '.' （需要有福的参考）
    *   关闭[限制](http://perldoc.perl.org/strict)或创建[AUTOLOAD](http://perldoc.perl.org/perlsub.html#Autoloading) subs 以允许使用这些裸词 - 当然，您可以为所有要使用的单词编写 subs（或使用[barewords](http://search.cpan.org/search?module=barewords)模块）。
    *   可能，创建多个包，多个`AUTOLOAD`s
*   另一种方法是[源过滤器](http://perldoc.perl.org/perlfilter.html#WRITING-A-SOURCE-FILTER-IN-PERL)，我可能会因为*提及*此功能而投反对票。*因此，对于寻求*帮助的人，我不会完全推荐这种方法。但它就在那里。源过滤器（我已经完成了我的分享）只是您认为自己太聪明而不利于自己的那些领域之一。

    不过，如果您对将 Perl 作为 DSL“宿主”语言感兴趣，那么[源过滤器](http://perldoc.perl.org/perlfilter.html#WRITING-A-SOURCE-FILTER-IN-PERL)并不是完全不受限制的。但是，将其限制在您想要做的事情上，[Perl6::Attributes](http://search.cpan.org/search?q=Perl6-Attributes)可能会立即完成您需要的大部分工作。它将把`.`它们翻译成 Perl 可以理解的“->”。但是您仍然可以*查看*源过滤器以了解幕后*发生的事情。*

    我也不想离开这个话题，而不建议使用 Damian Conway 的[Filter::Simple](http://perldoc.perl.org/Filter/Simple.html)来缓解您在生成自己的源过滤器时可能遇到的很多挫折（我建议不要这样做） 。

*   最简单的事情是放弃'。运算符，而只是期望看起来像 Perl 的代码。

    ```
    App->View2->Page2->Activate(); 
    App->View1->Page2->Click(); 
    ```

    `App`将是一个包或一个子。在当前包中定义或导入，它返回一个对象被祝福到一个带有`View2`子（可能是一个[`AUTOLOAD`](http://perldoc.perl.org/perlsub.html#Autoloading)子）的包中，它返回一个包的名称或一个被祝福到包中的引用，它可以理解`Page2`，然后最后从那个返回会理解`Activate`或`Click`。（如果需要，请参阅[OO 教程。）](http://perldoc.perl.org/perltoot.html)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-12-05T15:13:14.543

我建议你放弃尝试做怪异的“DSL”的东西，只写 Perl 类来处理你想要管理的对象。我建议您考虑为此使用新的 Moose Perl 对象系统，尽管传统的 Perl OO 就可以了。深入研究 OO 教程的 Perl 文档；他们都是伟大的。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-12-05T06:10:19.883

perl5 中的方法调用使用`->`not `.`，所以它看起来像`App->View2->Page2->Activate()`or`$App->View2->Page2->Active()`除非你做了一些非常有趣的事情（例如，源过滤器）。假设没问题，您可以使用普通的 Perl OO 东西。

现在，您需要的下一部分是在运行时创建方法。这实际上相当简单：

```
sub _new_view {
    my ($view, $view_num);

    # ...
    # ... (code to create $view object)
    # ...

    my $sym = "App::View$view_num";
    *$sym = sub { return $view }; # can also use Symbol package
} 
```

或者，如果您只想在调用它们时创建方法，那就是`AUTOLOAD`这样。您还可以滥用自动加载来使所有方法调用成功（但要注意具有特殊含义的方法，例如 DESTROY）。

这将为您提供语法。让您的对象生成要传递的字符串`send_command`应该不是那么困难。

另外，我对它不太熟悉，但你可能想看看[Moose](http://search.cpan.org/dist/Moose/)。它可能有更简单的方法来实现这一点。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-12-05T23:03:46.903

### DSL 源过滤器

这是另一个尝试。skiphoppy 说得有道理，但再看一遍，我注意到（到目前为止）你并没有问太多复杂的问题。您只想获取每个命令并告诉远程服务器执行此操作。必须理解命令的不是*perl*，而是服务器。

因此，我删除了一些关于源过滤器的警告，并决定向您展示如何编写一个简单的过滤器。同样，您所做的并不那么复杂，我在下面的“过滤”非常简单。

```
package RemoteAppScript;
use Filter::Simple;    # The basis of many a sane source filter
use Smart::Comments;   # treat yourself and install this if you don't have 
                       # it... or just comment it out.

# Simple test sub
sub send_command { 
    my $cmd = shift;
    print qq(Command "$cmd" sent.\n);
    return;
}

# The list of commands
my @script_list;

# The interface to Filter::Simple's method of source filters.
FILTER { 
    # Save $_, because Filter::Simple doesn't like you reading more than once.
    my $mod = $_;

    # v-- Here a Smart::Comment.
    ### $mod

    # Allow for whole-line perl style comments in the script
    $mod =~ s/^\s*#.*$//m;

    # 1\. Break the package up into commands by split
    # 2\. Trim the strings, if needed
    # 3\. lose the entries that are just blank strings.
    @script_list 
        = grep { length } 
          map  { s/^\s+|\s+$//g; $_ } 
          split /;/, $mod
        ;
    ### @script_list

    # Replace the whole script with a command to run the steps.
    $_ = __PACKAGE__ . '::run_script();';
    # PBP.
    return;
};

# Here is the sub that performs each action.
sub run_script { 
    ### @script_list
    foreach my $command ( @script_list ) {
        #send_command( $command );
        socket_object->send_command( $command );
    }
}

1; 
```

你需要把它保存`RemoteAppScript.pm`在你的 perl 可以找到它的地方。（`perl -MData::Dumper -e 'print Dumper( \@INC ), "\n"'`如果您需要知道在哪里，请尝试。）

然后你可以创建一个“perl”文件，其中包含：

```
use RemoteAppScript;
App.View2.Page2.Activate();
App.View1.Page2.Click(); 
```

### 然而

没有真正的理由不能读取包含服务器命令的文件。那会打断`FILTER`电话。你将会拥有

```
App.View2.Page2.Activate();
App.View1.Page2.Click(); 
```

在你的脚本文件中，你的 perl 文件看起来更像这样：

```
#!/bin/perl -w 

my $script = do { 
    local $/;
    <ARGV>;
};

$script =~ s/^\s*#.*$//m;

foreach my $command ( 
    grep { length() } map  { s/^\s+|\s+$//g; $_ } split /;/, $script 
) { 
    socket_object->send_command( $command );
} 
```

并这样称呼它：

```
perl run_remote_script.pl remote_app_script.ras 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-10-21T14:50:47.973

[http://search.cpan.org/dist/Devel-Declare/](http://search.cpan.org/dist/Devel-Declare/)是源过滤器的现代替代品，可直接集成到 perl 解析器中，值得一看。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-10-21T17:21:00.100

`'.'`覆盖或使用语法的替代方法`->`可能是使用包语法 (::)，即在创建 View2 / Page 2 时创建 App::View2 和 App::View2::Page2 等包，将 AUTOLOAD 子添加到委托的包中到 App::View::Page 或 App::View 方法，如下所示：

在您的 App/DSL.pm 中：

```
package App::DSL;
use strict; 
use warnings;
# use to avoid *{"App::View::$view::method"} = \&sub and friends
use Package::Stash;

sub new_view(%);
our %views;

# use App::DSL (View1 => {attr1 => 'foo', attr2 => 'bar'}); 
sub import {
    my $class = shift;
    my %new_views = @_ or die 'No view specified';

    foreach my $view (keys %new_views) {
            my $stash = Package::Stash->new("App::View::$view");
        # In our AUTOLOAD we create a closure over the right
        # App::View object and call the right method on it
        # for this example I just used _api_\L$method as the
        # internal method name (Activate => _api_activate)
        $stash->add_package_symbol('&AUTOLOAD' =>  
            sub {  
                our $AUTOLOAD;
                my ($method) = 
                   $AUTOLOAD =~ m{App::View::\Q$view\E::(.*)};
                my $api_method = "_api_\L$method";
                die "Invalid method $method on App::View::$view"
                   unless my $view_sub = App::View->can($api_method);
                my $view_obj = $views{$view}
                    or die "Invalid View $view";
                my $sub = sub {
                        $view_obj->$view_sub();
                };
                     # add the function to the package, so that AUTOLOAD
                     # won't need to be called for this method again
                $stash->add_package_symbol("\&$method" => $sub);
                goto $sub;
            });
        $views{$view} = bless $new_views{$view}, 'App::View';
    }
}

package App::View;

# API Method App::View::ViewName::Activate;
sub _api_activate {
    my $self = shift;
    # do something with $self here, which is the view 
    # object created by App::DSL
    warn $self->{attr1};
}

1; 
```

在你的脚本中：

```
use strict;
use warnings;
# Create App::View::View1 and App::View::View2
use App::DSL (View1 => {attr1 => 'hello'}, View2 => {attr1 => 'bye'});
App::View::View1::Activate();
App::View::View2::Activate();
App::View::View1::Activate(); 
```

# java - 如何在图像中捕获可执行文件的输出？

> ID：342974
> 
> 赞同：-1
> 
> 时间：2008-12-05T05:22:18.183
> 
> 标签：java, windows, screen, capture

我想将 exe 文件的输出捕获为 png 或 jpg 图像，我的意思是该 exe 的显示。Windows上是否有任何命令可以捕获并保存为exe输出的图像或我可以做到这一点的任何其他想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-12-05T05:43:25.710

Java中总是有[Robot](http://java.sun.com/j2se/1.5.0/docs/api/java/awt/Robot.html)类。这可能会有所帮助。看看[这个稍微相关的问题](https://stackoverflow.com/questions/58305/java-is-there-a-way-to-take-a-screenshot-using-java-and-save-it-to-some-sort-of)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-12-05T05:26:55.930

Alt+PrtSc 组合键将拍摄当前窗口的快照并将其保存到剪贴板。然后您可以将其粘贴到您选择的绘图程序中（如果没有其他可用的，MS Paint 会这样做），并将其保存到磁盘。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-12-05T05:27:22.527

Alt-PRTSC，然后打开图像编辑器并粘贴。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T05:28:16.333

按键盘上的 Alt + PrintScreen 组合将捕获活动的应用程序窗口并将其作为图像放在剪贴板上。然后，您可以将其粘贴到 Paint 或任何其他应用程序中。

# .net - Rhino Mocks - 为非虚拟方法设置结果

> ID：342989
> 
> 赞同：1
> 
> 时间：2008-12-05T05:33:05.917
> 
> 标签：.net, mocking, rhino-mocks

我正在玩 Rhino Mocks，并试图在我的模拟对象上设置一些虚拟结果，所以当它们在我的工厂方法中被调用时，我不必担心数据。

但是我遇到了一个障碍，我想要获得虚拟结果的方法会导致异常，因为它们不是*virtual*。

我有这样的代码：

```
using(mock.Record()){
  SetupResult.For(service.SomeMethod()).Return("hello world");
} 
```

该`SomeMethod`方法是否必须是虚拟的才能获得模拟结果？

`SetupResult.For`另外，和有什么区别`Expect.Call`？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-12-05T05:57:06.820

Rhino Mocks 使用 DynamicProxy2 来发挥它的魔力，因此您将无法在非虚拟方法上设置期望/结果。

至于 之间的区别`SetupResult.For`，`Expect.Call`如果您希望您的测试在未调用方法时验证失败，请使用`Expect.Call`. 如果您只想提供模拟对象的结果，并且不想在未调用时验证失败，请使用`SetupResult.For`

所以以下将失败：

```
using(mock.Record()){
    Expect.Call(service.SomeMethod()).Return("you have to run me");
}

using(mock.Replay()){
    // Some code that never calls service.SomeMethod()
} 
```

这个测试不会：

```
using(mock.Record()){
    SetupResult.For(service.SomeMethod()).Return("you don't have to run me");
}

using(mock.Replay()) {
    // Some code that never calls service.SomeMethod()
} 
```

那有意义吗？

# java - 在 GUI 面板中创建 Java 控制台

> ID：342990
> 
> 赞同：44
> 
> 时间：2008-12-05T05:33:35.103
> 
> 标签：java, user-interface, console, output, panel

如何在 GUI 面板内创建 Java 控制台的实例？

* * *

## 回答 #1

> 赞同：71
> 
> 时间：2008-12-05T05:47:35.090

这是一个正常运行的类。您可以使用以下方法将其实例安装到系统中并出错：

```
PrintStream con=new PrintStream(new TextAreaOutputStream(...));
System.setOut(con);
System.setErr(con); 
```

**2014-02-19 更新**：使用 EventQueue.invokeLater() 来避免 GUI 线程问题，这些问题很少会出现在原始版本中。

**2014-02-27 更新**：更好的实施

**更新于 2014-03-25**：正确记录和删除文本区域中的行，`run()`以避免在控制台被输出淹没时可能发生的追加和删除之间的竞争条件。最终结果对我来说似乎也更干净。

```
import java.awt.*;
import java.io.*;
import java.util.*;
import java.util.List;
import javax.swing.*;

public class TextAreaOutputStream
extends OutputStream
{

// *************************************************************************************************
// INSTANCE MEMBERS
// *************************************************************************************************

private byte[]                          oneByte;                                                    // array for write(int val);
private Appender                        appender;                                                   // most recent action

public TextAreaOutputStream(JTextArea txtara) {
    this(txtara,1000);
    }

public TextAreaOutputStream(JTextArea txtara, int maxlin) {
    if(maxlin<1) { throw new IllegalArgumentException("TextAreaOutputStream maximum lines must be positive (value="+maxlin+")"); }
    oneByte=new byte[1];
    appender=new Appender(txtara,maxlin);
    }

/** Clear the current console text area. */
public synchronized void clear() {
    if(appender!=null) { appender.clear(); }
    }

public synchronized void close() {
    appender=null;
    }

public synchronized void flush() {
    }

public synchronized void write(int val) {
    oneByte[0]=(byte)val;
    write(oneByte,0,1);
    }

public synchronized void write(byte[] ba) {
    write(ba,0,ba.length);
    }

public synchronized void write(byte[] ba,int str,int len) {
    if(appender!=null) { appender.append(bytesToString(ba,str,len)); }
    }

@edu.umd.cs.findbugs.annotations.SuppressWarnings("DM_DEFAULT_ENCODING")
static private String bytesToString(byte[] ba, int str, int len) {
    try { return new String(ba,str,len,"UTF-8"); } catch(UnsupportedEncodingException thr) { return new String(ba,str,len); } // all JVMs are required to support UTF-8
    }

// *************************************************************************************************
// STATIC MEMBERS
// *************************************************************************************************

    static class Appender
    implements Runnable
    {
    private final JTextArea             textArea;
    private final int                   maxLines;                                                   // maximum lines allowed in text area
    private final LinkedList<Integer>   lengths;                                                    // length of lines within text area
    private final List<String>          values;                                                     // values waiting to be appended

    private int                         curLength;                                                  // length of current line
    private boolean                     clear;
    private boolean                     queue;

    Appender(JTextArea txtara, int maxlin) {
        textArea =txtara;
        maxLines =maxlin;
        lengths  =new LinkedList<Integer>();
        values   =new ArrayList<String>();

        curLength=0;
        clear    =false;
        queue    =true;
        }

    synchronized void append(String val) {
        values.add(val);
        if(queue) { queue=false; EventQueue.invokeLater(this); }
        }

    synchronized void clear() {
        clear=true;
        curLength=0;
        lengths.clear();
        values.clear();
        if(queue) { queue=false; EventQueue.invokeLater(this); }
        }

    // MUST BE THE ONLY METHOD THAT TOUCHES textArea!
    public synchronized void run() {
        if(clear) { textArea.setText(""); }
        for(String val: values) {
            curLength+=val.length();
            if(val.endsWith(EOL1) || val.endsWith(EOL2)) {
                if(lengths.size()>=maxLines) { textArea.replaceRange("",0,lengths.removeFirst()); }
                lengths.addLast(curLength);
                curLength=0;
                }
            textArea.append(val);
            }
        values.clear();
        clear =false;
        queue =true;
        }

    static private final String         EOL1="\n";
    static private final String         EOL2=System.getProperty("line.separator",EOL1);
    }

} /* END PUBLIC CLASS */ 
```

这是它的截图：

![在此处输入图像描述](https://i.stack.imgur.com/Eq20j.png)

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2008-12-05T07:01:18.390

@软件猴子：

有用！:)

```
import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.io.*;

public class Main{
    public static void main( String [] args ) throws InterruptedException  {
        JFrame frame = new JFrame();
        frame.add( new JLabel(" Outout" ), BorderLayout.NORTH );

        JTextArea ta = new JTextArea();
        TextAreaOutputStream taos = new TextAreaOutputStream( ta, 60 );
        PrintStream ps = new PrintStream( taos );
        System.setOut( ps );
        System.setErr( ps );

        frame.add( new JScrollPane( ta )  );

        frame.pack();
        frame.setVisible( true );
        frame.setSize(800,600);

        for( int i = 0 ; i < 100 ; i++ ) {
            System.out.println( i );
            Thread.sleep( 500 );
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2012-10-17T16:17:51.620

我知道这是一个旧线程，但我在试图找出一种好的方法时发现它的事实意味着其他人可能也会这样做。

这是一种（可能）更清洁的方式来做软件猴子发布的内容：

```
import java.io.IOException;
import java.io.OutputStream;
import java.util.ArrayList;

import javax.swing.JTextArea;

/**
 * Represents a console viewable through a <code>JTextArea</code>.
 * 
 * <p>
 *  Implementation:
 *  <code>
 *      System.setOut(new PrintStream(new Console( ... )));
 *  </code>
 *  </p>
 * 
 * @author Derive McNeill
 *
 */
public class Console extends OutputStream {

    /**
     * Represents the data written to the stream.
     */
    ArrayList <Byte> data = new ArrayList <Byte> ();

    /**
     * Represents the text area that will be showing the written data.
     */
    private JTextArea output;

    /**
     * Creates a console context.
     * @param output
     *      The text area to output the consoles text.
     */
    public Console(JTextArea output) {
        this.output = output;
    }

    /**
     * Called when data has been written to the console.
     */
    private void fireDataWritten() {

        // First we loop through our written data counting the lines.
        int lines = 0;
        for (int i = 0; i < data.size(); i++) {
            byte b = data.get(i);

            // Specifically we look for 10 which represents "\n".
            if (b == 10) {
                lines++;
            }

            // If the line count exceeds 250 we remove older lines.
            if (lines >= 250) {
                data = (ArrayList<Byte>) data.subList(i, data.size());
            }
        }

        // We then create a string builder to append our text data.
        StringBuilder bldr = new StringBuilder();

        // We loop through the text data appending it to the string builder.
        for (byte b : data) {
            bldr.append((char) b);
        }

        // Finally we set the outputs text to our built string.
        output.setText(bldr.toString());
    }

    @Override
    public void write(int i) throws IOException {

        // Append the piece of data to our array of data.
        data.add((byte) i);

        // Indicate that data has just been written.
        fireDataWritten();
    }

} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-11-10T11:05:00.820

[ByteArrayOutputStream](http://docs.oracle.com/javase/6/docs/api/java/io/ByteArrayOutputStream.html)可用于省略缓冲内容。

```
private void redirectConsoleTo(final JTextArea textarea) {
    PrintStream out = new PrintStream(new ByteArrayOutputStream() {
        public synchronized void flush() throws IOException {
            textarea.setText(toString());
        }
    }, true);

    System.setErr(out);
    System.setOut(out);
} 
```

[您可以将ByteArrayOutputStream#reset()](http://docs.oracle.com/javase/6/docs/api/java/io/ByteArrayOutputStream.html#reset%28%29)绑定到某个按钮，而不是限制行数。

```
private void redirectConsoleWithClearButton(final JTextArea textarea, JButton clearButton) {
    final ByteArrayOutputStream bytes = new ByteArrayOutputStream() {
        public synchronized void flush() throws IOException {
            textarea.setText(toString());
        }
    };

    clearButton.addActionListener(new ActionListener() {
        public void actionPerformed(ActionEvent e) {
            bytes.reset();
        }
    });

    PrintStream out = new PrintStream(bytes, true);

    System.setErr(out);
    System.setOut(out);
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-01-02T04:13:55.790

我最近在我的一个项目中使用了[Lawrence Dol](https://stackoverflow.com/a/343007/363573)提供的[优秀代码](https://stackoverflow.com/a/343007/363573)。

但是，在我的情况下，代码消耗了太多内存。我设法通过替换`JTextarea`为`JLabel`.

我的内存节省搜索表明，`JTextarea`内部代码往往会占用太多时间发送的实际文本。因此，所有这些文本都不能被垃圾收集。

这是初始代码的灵活版本（线程同步被锁取代）。

## JComponentOutputStream.java

```
import java.awt.EventQueue;
import java.io.OutputStream;
import java.io.UnsupportedEncodingException;
import java.util.ArrayList;
import java.util.LinkedList;
import java.util.List;
import java.util.concurrent.locks.Lock;
import java.util.concurrent.locks.ReentrantLock;

import javax.swing.JComponent;

public class JComponentOutputStream extends OutputStream {

    // *************************************************************************************************
    // INSTANCE MEMBERS
    // *************************************************************************************************

    private byte[] oneByte; // array for write(int val);
    private Appender appender; // most recent action

    private Lock jcosLock = new ReentrantLock();

    public JComponentOutputStream(JComponent txtara, JComponentHandler handler) {
        this(txtara, 1000, handler);
    }

    public JComponentOutputStream(JComponent txtara, int maxlin, JComponentHandler handler) {
        if (maxlin < 1) {
            throw new IllegalArgumentException("JComponentOutputStream maximum lines must be positive (value=" + maxlin + ")");
        }
        oneByte = new byte[1];
        appender = new Appender(txtara, maxlin, handler);
    }

    /** Clear the current console text area. */
    public void clear() {
        jcosLock.lock();
        try {
            if (appender != null) {
                appender.clear();
            }
        } finally {
            jcosLock.unlock();
        }
    }

    public void close() {
        jcosLock.lock();
        try {
            appender = null;
        } finally {
            jcosLock.unlock();
        }
    }

    public void flush() {
        // sstosLock.lock();
        // try {
        // // TODO: Add necessary code here...
        // } finally {
        // sstosLock.unlock();
        // }
    }

    public void write(int val) {
        jcosLock.lock();
        try {
            oneByte[0] = (byte) val;
            write(oneByte, 0, 1);
        } finally {
            jcosLock.unlock();
        }
    }

    public void write(byte[] ba) {
        jcosLock.lock();
        try {
            write(ba, 0, ba.length);
        } finally {
            jcosLock.unlock();
        }
    }

    public void write(byte[] ba, int str, int len) {
        jcosLock.lock();
        try {
            if (appender != null) {
                appender.append(bytesToString(ba, str, len));
            }
        } finally {
            jcosLock.unlock();
        }
    }

    static private String bytesToString(byte[] ba, int str, int len) {
        try {
            return new String(ba, str, len, "UTF-8");
        } catch (UnsupportedEncodingException thr) {
            return new String(ba, str, len);
        } // all JVMs are required to support UTF-8
    }

    // *************************************************************************************************
    // STATIC MEMBERS
    // *************************************************************************************************

    static class Appender implements Runnable {
        private final JComponent swingComponent;
        private final int maxLines; // maximum lines allowed in text area
        private final LinkedList<Integer> lengths; // length of lines within
                                                    // text area
        private final List<String> values; // values waiting to be appended

        private int curLength; // length of current line
        private boolean clear;
        private boolean queue;

        private Lock appenderLock;

        private JComponentHandler handler;

        Appender(JComponent cpt, int maxlin, JComponentHandler hndlr) {
            appenderLock = new ReentrantLock();

            swingComponent = cpt;
            maxLines = maxlin;
            lengths = new LinkedList<Integer>();
            values = new ArrayList<String>();

            curLength = 0;
            clear = false;
            queue = true;

            handler = hndlr;
        }

        void append(String val) {
            appenderLock.lock();
            try {
                values.add(val);
                if (queue) {
                    queue = false;
                    EventQueue.invokeLater(this);
                }
            } finally {
                appenderLock.unlock();
            }
        }

        void clear() {
            appenderLock.lock();
            try {

                clear = true;
                curLength = 0;
                lengths.clear();
                values.clear();
                if (queue) {
                    queue = false;
                    EventQueue.invokeLater(this);
                }
            } finally {
                appenderLock.unlock();
            }
        }

        // MUST BE THE ONLY METHOD THAT TOUCHES the JComponent!
        public void run() {
            appenderLock.lock();
            try {
                if (clear) {
                    handler.setText(swingComponent, "");
                }
                for (String val : values) {
                    curLength += val.length();
                    if (val.endsWith(EOL1) || val.endsWith(EOL2)) {
                        if (lengths.size() >= maxLines) {
                            handler.replaceRange(swingComponent, "", 0, lengths.removeFirst());
                        }
                        lengths.addLast(curLength);
                        curLength = 0;
                    }
                    handler.append(swingComponent, val);
                }

                values.clear();
                clear = false;
                queue = true;
            } finally {
                appenderLock.unlock();
            }
        }

        static private final String EOL1 = "\n";
        static private final String EOL2 = System.getProperty("line.separator", EOL1);
    }

    public interface JComponentHandler {
        void setText(JComponent swingComponent, String text);

        void replaceRange(JComponent swingComponent, String text, int start, int end);

        void append(JComponent swingComponent, String text);
    }

} /* END PUBLIC CLASS */ 
```

* * *

## 示例使用

```
JLabel console = new JLabel();
JComponentOutputStream consoleOutputStream = new JComponentOutputStream(console, new JComponentHandler() {
    private StringBuilder sb = new StringBuilder();

    @Override
    public void setText(JComponent swingComponent, String text) {
        sb.delete(0, sb.length());
        append(swingComponent, text);
    }

    @Override
    public void replaceRange(JComponent swingComponent, String text, int start, int end) {
        sb.replace(start, end, text);
        redrawTextOf(swingComponent);
    }

    @Override
    public void append(JComponent swingComponent, String text) {
        sb.append(text);
        redrawTextOf(swingComponent);
    }

    private void redrawTextOf(JComponent swingComponent) {
        ((JLabel)swingComponent).setText("<html><pre>" + sb.toString() + "</pre></html>");
    }
});

PrintStream con = new PrintStream(consoleOutputStream);
System.setOut(con);
System.setErr(con);    

// Optional: add a scrollpane around the console for having scrolling bars
JScrollPane sp = new JScrollPane( //
        console, //
        ScrollPaneConstants.VERTICAL_SCROLLBAR_AS_NEEDED, //
        ScrollPaneConstants.HORIZONTAL_SCROLLBAR_AS_NEEDED //
);
myPanel.add(sp); 
```

# apache-flex - 使用 Adob e AIR 下载文件

> ID：342994
> 
> 赞同：18
> 
> 时间：2008-12-05T05:34:57.333
> 
> 标签：apache-flex, actionscript, air

如何在基于 Flex 的 AIR 应用程序中从 Internet 下载文件。

我尝试使用将 url 设置为地址的文件，但是当我尝试保存文件时出现文件不存在错误。在这个问题上谷歌真的很难寻求帮助。

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2008-12-06T00:05:52.893

您想从 2 个 api 组合中进行选择来完成此操作。

版本 1 是 URLLoader 和 FileStream

使用这种类组合，您可以通过 URLLoader 对象将文件从服务器加载到空中。这会将文件下载到内存中，然后在下载完成时通知您。确保使用 URLLoaderDataFormat.BINARY 的 dataFormat 启动下载。然后，您将启动一个 Filestream 对象并使用 writeBytes() 将其写入磁盘。

版本 2 是 URLStream 和 FileStream

URLStream 与 URLLoader 非常相似，但不是在使用结果之前等待文件完全下载，而是在下载期间为您提供数据。此方法适用于大文件，因为您不必等待完整下载开始将其保存到磁盘，并且您还可以节省内存，因为一旦播放器将其交给您，它就可以释放与该数据相关的内存. 您将以完全相同的方式使用文件流，您最终只会在文件流入时对文件的每个块执行 writeBytes()。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-11-26T20:16:23.663

我使用了 seanalltogether 的答案，并编写了这个类来处理文件下载。

这很简单。创建一个`var downloader = new FileDownloader("url", "Local/Path");`并调用`downloader.load()`以开始下载。

它还支持设置完成时调用的函数，以及下载时的点。向 onProgress 函数传递已下载的字节数。（我不知道如何得到一个分数，因为我不知道如何在下载文件之前查询文件的大小）

```
package com.alex{
import flash.filesystem.File;
import flash.filesystem.FileMode;
import flash.filesystem.FileStream;
import flash.net.URLRequest;
import flash.net.URLStream;
import flash.utils.ByteArray;

public class FileDownloader
{

    // Class to download files from the internet

    // Function called every time data arrives
    //      called with an argument of how much has been downloaded
    public var onProgress :Function = function(t:uint):void{};
    public var onComplete :Function = function():void{};
    public var remotePath :String = "";
    public var localFile :File = null; 

    private var stream :URLStream;
    private var fileAccess :FileStream;

    public function FileDownloader( remotePath :String = "" , localFile :File = null ) {

        this.remotePath = remotePath;
        this.localFile = localFile;
    }

    public function load() :void {
        if( !stream || !stream.connected ) {
            stream = new URLStream();
            fileAccess = new FileStream();

            var requester :URLRequest = new URLRequest( remotePath );
            var currentPosition :uint = 0;
            var downloadCompleteFlag :Boolean = false;

            // Function to call oncomplete, once the download finishes and
            //      all data has been written to disc               
            fileAccess.addEventListener( "outputProgress", function ( result ) :void {
                if( result.bytesPending == 0 && downloadCompleteFlag ) {

                    stream.close();
                    fileAccess.close();
                    onComplete();
                }
            });

            fileAccess.openAsync( localFile, FileMode.WRITE );

            stream.addEventListener( "progress" , function () :void {

                var bytes :ByteArray = new ByteArray();
                var thisStart :uint = currentPosition;
                currentPosition += stream.bytesAvailable;
                // ^^  Makes sure that asyncronicity does not break anything

                stream.readBytes( bytes, thisStart );
                fileAccess.writeBytes( bytes, thisStart );

                onProgress( currentPosition );                      
            });

            stream.addEventListener( "complete", function () :void {
                downloadCompleteFlag = true;
            });

            stream.load( requester );

        } else {
            // Do something unspeakable
        }
    }
}} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-01-05T19:33:51.477

为了建立 seanaltogether 的第二个想法，这里有一个函数应该从互联网上下载文件，并将其保存到磁盘（在桌面上指定的文件名中）：

```
downloadFile: function (url, fileName) {
    var urlStream = new air.URLStream();
    var request = new air.URLRequest(url);
    var fileStream = new air.FileStream();
    // write 50k from the urlstream to the filestream, unless
    // the writeAll flag is true, when you write everything in the buffer
    function writeFile(writeAll) {
        if (urlStream.bytesAvailable > 51200 || writeAll) {
            alert("got some");
            var dataBuffer = new air.ByteArray();
            urlStream.readBytes(dataBuffer, 0, urlStream.bytesAvailable);
            fileStream.writeBytes(dataBuffer, 0, dataBuffer.length);
        }
        // do clean up:
        if (writeAll) {
            alert("done");
            fileStream.close();
            urlStream.close();
            // set up the next download
            setTimeout(this.downloadNextFile.bind(this), 0);
        }
    }

    urlStream.addEventListener(air.Event.COMPLETE, writeFile.bind(this, true));
    urlStream.addEventListener(air.ProgressEvent.PROGRESS, writeFile.bind(this, false));

    var file = air.File.desktopDirectory.resolvePath(fileName);
    fileStream.openAsync(file, air.FileMode.WRITE);

    urlStream.load(request);

} 
```

注意：此解决方案使用 Prototype 和 AIRAliases.js。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-12-05T11:39:07.300

查看`flash.net.URLRequest`将帮助您下载文件的课程。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-05-18T12:53:47.507

还请检查 URLLoader 类以下载文件。一个很好的例子在这里： http: [//www.adobe.com/devnet/air/flex/articles/exploring_file_capabilities.html](http://www.adobe.com/devnet/air/flex/articles/exploring_file_capabilities.html)

这对我来说非常快，与 URLStream 类相比，它需要很长时间，并且需要大量 CPU 来下载文件。****