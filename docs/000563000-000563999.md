# StackOverflow 问答 000563000-000563999

# c++ - 优化会影响使用其 PDB 调试 VC++ 应用程序的能力吗？

> ID：563000
> 
> 赞同：5
> 
> 时间：2009-02-18T21:54:13.593
> 
> 标签：c++, visual-studio, optimization, pdb-files

为了能够正确调试发布版本，需要一个 PDB 文件。当编译器使用不同类型的优化（FPO、PGO、内在函数、内联等）时，PDB 文件是否会变得不那么可用？如果是这样，优化的影响是严重的还是仅仅导致相邻的代码行混淆？

*（我使用的是 VC2005，并且总是会选择可调试性而不是优化性能 - 但问题很笼统）*

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-20T00:47:46.273

是的，优化后的代码不易调试。不仅缺少一些信息，而且一些信息会非常具有误导性。

我认为最大的问题是局部变量。编译器可以使用相同的堆栈地址或在整个函数中为多个变量注册。正如其他海报所提到的，有时甚至弄清楚“this”指针是什么可能需要一些时间。在调试优化代码时，您可能会看到当前行在单步执行时跳来跳去，因为编译器重新组织了生成的代码。如果您使用 PGO，这种跳跃可能会变得更糟。

如果您有一个 PDB，FPO 不应过多影响可调试性，因为 PDB 包含展开 FPO 帧堆栈所需的所有信息。当使用需要在没有符号的情况下进行堆栈跟踪的工具时，FPO 可能会成为问题。对于许多项目而言，如今 FPO 的性能优势并没有超过对可诊断性的影响。因此，MS 决定不使用 FPO 优化构建 Windows Vista ( [http://blogs.msdn.com/larryosterman/archive/2007/03/12/fpo.aspx](http://blogs.msdn.com/larryosterman/archive/2007/03/12/fpo.aspx) )。

我更喜欢调试未优化的代码，但这并不总是可能的 - 一些问题只能用优化的代码重现，客户故障转储来自已发布的构建，并且有时无法进行调试私有部署。通常在调试优化代码时，我使用反汇编视图——反汇编永远不会说谎。

这一切都适用于windbg，因为我使用它进行所有本机代码调试。Visual Studio 的调试器可能会更好地处理其中一些情况。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T21:56:09.890

是的。有时它可能很严重，尽管这通常更多是代码内联或重新排序的结果。

局部变量也可能无法准确显示在监视窗口中，因为它们可能仅存在于寄存器中，并且在切换堆栈帧时可能无法正确显示。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T21:59:28.277

优化会严重影响任何平台上的调试（不仅仅是 VC 的 PDB 文件）。

正是由于您提到的原因，函数内联在某些情况下可能会完全混淆哪些指令属于哪个函数（因为有时它们属于两者）。

还有一个常见的优化是执行“脏”堆栈帧（GCC 中的 -fomit-frame-pointer），这会导致代码不跟踪堆栈顶部。这很好，它为其他操作释放了一个额外的寄存器（x86 上的 ebp）。但这使得展开堆栈以查看实际情况几乎是不可能的。这也使得在堆栈上找到局部变量和函数参数几乎是不可能的。

一般来说：不要期望从“发布”版本中获得有用的调试信息。如果调试很重要，即使在发布时，那么您应该改为“发布”调试版本。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T22:09:46.787

除了局部变量之外，“this”指针通常在优化构建中被优化掉。有时可以通过在调用堆栈中上升到对象指针或引用作为未优化变量存在的点来解决此问题。

一般来说。优化构建中的单步通常或多或少地工作，并让人们看到代码做出了哪些逻辑决策。检查这些决策所依据的数据通常要复杂得多。

# chm - HTML 帮助关键字查找

> ID：563012
> 
> 赞同：1
> 
> 时间：2009-02-18T21:56:26.147
> 
> 标签：chm

我无法弄清楚如何让关键字查找 ( [`HH_KEYWORD_LOOKUP`](http://msdn.microsoft.com/en-us/library/ms670091(VS.85).aspx)) 在 HTML 帮助中工作。如果我有一个显示如下的索引：

```
Machine
    Add
    Edit
    Selection 
```

如何指定显示机器选择的关键字搜索？“机器；选择”调出机器关键字；“选择”和“机器选择”根本不起作用；“机器，选择”也没有，即使如果用户手动选择适当的主题，HTML 帮助查看器的“索引”选项卡中显示的内容也是如此。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-11-22T12:51:56.257

我想我读到（在我的许多谷歌搜索中）HH_KEYWORD_LOOKUP 在 HTML 帮助中被破坏了，叹息。所以 Ie 想出了这个解决方案来进行搜索。它将调出 chm 文件并在搜索框中输入关键字，然后按 ENTER 键手动进行搜索。

```
procedure PostKey(aKey: Word; const aShift: TShiftState; aSpeciaKey: Boolean);
type
  TShiftKeyInfo = record
    shift: Byte;
    vkey: Byte;
  end;
  byteset = set of 0..7;
const
  shiftkeys: array [1..3] of TShiftKeyInfo =
    ((shift: Ord(ssCtrl); vkey: VK_CONTROL),
    (shift: Ord(ssShift); vkey: VK_SHIFT),
    (shift: Ord(ssAlt); vkey: VK_MENU));
var
  flag: DWORD;
  bShift: ByteSet absolute aShift;
  i: Integer;
begin
  for i := 1 to 3 do
  begin
    if shiftkeys[i].shift in bShift then
      keybd_event(shiftkeys[i].vkey, MapVirtualKey(shiftkeys[i].vkey, 0), 0, 0);
  end; { For }
  if aSpeciaKey then
    flag := KEYEVENTF_EXTENDEDKEY
  else
    flag := 0;
  keybd_event(aKey, MapvirtualKey(aKey, 0), flag, 0);
  flag := flag or KEYEVENTF_KEYUP;
  keybd_event(aKey, MapvirtualKey(aKey, 0), flag, 0);
  for i := 3 downto 1 do
  begin
    if shiftkeys[i].shift in bShift then
      keybd_event(shiftkeys[i].vkey, MapVirtualKey(shiftkeys[i].vkey, 0),
        KEYEVENTF_KEYUP, 0);
  end; { For }
end;

procedure CHMSearch(aCHMFilename, aSearch: string);
var
  cfn: string;
  qry: THHFtsQuery;
  hnd: HWND;

  procedure DoSearch(aMsg: string);
  var
    i,n: Integer;
    c: Char;
    shift: TShiftState;
  begin
    if hnd = 0 then Exit;
    Windows.SetFocus(hnd);
    n := Length(aMsg);
    if n > 0 then
    begin
      for i := 1 to n do
      begin
        c := aMsg[i];
        shift := [];
        case c of
          'a'..'z': shift := [];
          'A'..'Z': shift := [ssShift];
          '_': // underscore key
          begin
            keybd_event(VK_SHIFT, 0, 0, 0);
            keybd_event(VK_OEM_MINUS, 0, 0, 0);
            keybd_event(VK_OEM_MINUS, 0, KEYEVENTF_KEYUP, 0);
            keybd_event(VK_SHIFT, 0, KEYEVENTF_KEYUP, 0);
            continue;
          end;
          '$': // $ key
          begin
            PostKey(Ord('4'), [ssShift], False);
            continue;
          end;

        end;
        PostKey(Ord(UpCase(c)), shift, False);
      end;
      PostKey(VK_RETURN, [], False);
      PostKey(VK_RETURN, [], False);
    end;
  end;

begin
  cfn := ChangeFileExt(aCHMFilename, '.chm');
  FillChar(qry, SizeOf(qry), 0);
  qry.cbStruct := SizeOf(THHFtsQuery);
  qry.fExecute := TRUE;
  HH.HtmlHelpA(GetDesktopWindow, PAnsiChar(AnsiString(cfn)), HH_DISPLAY_TOC, 0);
  hnd := HH.HtmlHelpA(GetDesktopWindow, PAnsiChar(AnsiString(cfn)), HH_DISPLAY_SEARCH,
    Cardinal(@qry));
  DoSearch(aSearch);
end; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-12-20T09:39:44.160

啊啊啊！！！

经过一个小时的打字和尝试，我发现一级关键字和二级关键字之间需要两个空格，最后需要一个“Enter”键才能显示从二级关键字链接的主题！！！！

记住，正好是两个空格！一三个都不行。诀窍是，在输入第二个空格和第二个关键字时，关键字列表中会突出显示其他一些关键字，这会让您认为您已经犯了一个错误，并且不会继续输入第二个关键字！这是微软工程师的恶作剧吗？

然而，虽然手动工作，但似乎软件 API 不能立即与两个空间一起工作。如果我在按下 F1 键时在 C# 中调用以下 API（我必须在这里使用“空格”来表示一个空格，因为如果我使用真实空间，这个网站会将两个空格修剪为一个）：

System.Windows.Forms.Help.ShowHelp(this, "file:///C:/apps/MyHelpContentNew/QACT.chm", System.Windows.Forms.HelpNavigator.KeywordIndex, "key2'space''space'x_subkey_of_key2" );

它没有显示从 x_subkey_of_key2 链接的主题。但它几乎就在那里，帮助窗口显示正确的两个级别的关键字放在搜索文本框中，只缺少一个“汽车返回”！

然后我尝试像这样添加汽车返回：

System.Windows.Forms.Help.ShowHelp(this, "file:///C:/apps/MyHelpContentNew/QACT.chm", System.Windows.Forms.HelpNavigator.KeywordIndex, "key2'space''space'x_subkey_of_key2\ n");

它也不起作用。所以我想我需要通过编程向帮助窗口发送一个回车键。如果我实施它会发布。

# python - 导入和提供可选功能的 Python 良好做法是什么？

> ID：563022
> 
> 赞同：42
> 
> 时间：2009-02-18T21:58:01.040
> 
> 标签：python, python-import

我正在 github 上写一个软件。它基本上是一个带有一些额外功能的托盘图标。我想提供一段工作代码，而实际上不必让用户安装本质上是可选功能的依赖项，而且我实际上不想导入我不会使用的东西，所以我认为这样的代码将是“好的解决方案”：

```
---- IN LOADING FUNCTION ----
features = []

for path in sys.path:
       if os.path.exists(os.path.join(path, 'pynotify')):
              features.append('pynotify')
       if os.path.exists(os.path.join(path, 'gnomekeyring.so')):
              features.append('gnome-keyring')

#user dialog to ask for stuff
#notifications available, do you want them enabled?
dlg = ConfigDialog(features)

if not dlg.get_notifications():
    features.remove('pynotify')

service_start(features ...)

---- SOMEWHERE ELSE ------

def service_start(features, other_config):

        if 'pynotify' in features:
               import pynotify
               #use pynotify... 
```

不过也有一些问题。如果用户格式化他的机器并安装他的操作系统的最新版本并重新部署这个应用程序，功能会突然消失而没有警告。解决方案是在配置窗口中显示：

```
if 'pynotify' in features:
    #gtk checkbox
else:
    #gtk label reading "Get pynotify and enjoy notification pop ups!" 
```

但是，如果这是一个 mac，我怎么知道我没有让用户去寻找他们永远无法填补的依赖项？

第二个问题是：

```
if os.path.exists(os.path.join(path, 'gnomekeyring.so')): 
```

问题。我可以确定该文件在所有 Linux 发行版中始终称为 gnomekeyring.so 吗？

其他人如何测试这些功能？基本问题

```
try:
    import pynotify
except:
    pynotify = disabled 
```

是代码是全球性的，这些可能会乱七八糟，即使用户不想要 pynotify....无论如何它都已加载。

那么人们认为解决这个问题的最好方法是什么？

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-02-18T22:05:59.867

该`try:`方法不需要是全局的——它可以在任何范围内使用，因此模块可以在运行时“延迟加载”。例如：

```
def foo():
    try:
        import external_module
    except ImportError:
        external_module = None 

    if external_module:
        external_module.some_whizzy_feature()
    else:
        print("You could be using a whizzy feature right now, if you had external_module.") 
```

当您的脚本运行时，不会尝试加载`external_module`. 第一次`foo()`被调用，`external_module`被（如果可用）加载并插入到函数的本地范围内。随后调用`foo()`重新`external_module`插入其范围，而无需重新加载模块。

一般来说，最好让 Python 处理导入逻辑——它已经这样做了一段时间。:-)

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-18T22:09:38.830

您可能想看看[imp 模块](http://docs.python.org/library/imp.html)，它基本上可以完成您在上面手动执行的操作。因此，您可以首先查找一个模块，`find_module()`然后通过`load_module()`或简单地导入它来加载它（在检查配置之后）。

顺便说一句，如果使用 except: 我总是会向它添加特定的异常（这里是 ImportError），以免意外捕获不相关的错误。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2020-08-06T17:32:05.440

不确定这是否是一种好习惯，但我创建了一个执行可选导入（使用`importlib`）和错误处理的函数：

```
def _optional_import(module: str, name: str = None, package: str = None):
    import importlib
    try:
        module = importlib.import_module(module)
        return module if name is None else getattr(module, name)
    except ImportError as e:
        if package is None:
            package = module
        msg = f"install the '{package}' package to make use of this feature"
        raise ValueError(msg) from e 
```

如果可选模块不可用，用户至少会知道该怎么做。例如

```
# code ...

if file.endswith('.json'):
    from json import load
elif file.endswith('.yaml'):
    # equivalent to 'from yaml import safe_load as load'
    load = _optional_import('yaml', 'safe_load', package='pyyaml')

# code using load ... 
```

这种方法的主要缺点是您的导入必须在线完成，并且并非全部位于文件的顶部。因此，使用此函数的轻微改编可能被认为是更好的做法（假设您正在导入一个函数等）：

```
def _optional_import_(module: str, name: str = None, package: str = None):
    import importlib
    try:
        module = importlib.import_module(module)
        return module if name is None else getattr(module, name)
    except ImportError as e:
        if package is None:
            package = module
        msg = f"install the '{package}' package to make use of this feature"
        import_error = e

        def _failed_import(*args):
            raise ValueError(msg) from import_error

        return _failed_import 
```

现在，您可以使用其余的导入进行导入，并且只有在实际使用导入失败的函数时才会引发错误。例如

```
from utils import _optional_import_  # let's assume we import the function
from json import load as json_load
yaml_load = _optional_import_('yaml', 'safe_load', package='pyyaml')

# unimportant code ...

with open('test.txt', 'r') as fp:
    result = yaml_load(fp)    # will raise a value error if import was not successful 
```

PS：抱歉回复晚了！

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2009-02-19T12:49:09.357

处理不同特性的不同依赖关系问题的一种方法是将可选特性实现为插件。这样，用户可以控制在应用程序中激活了哪些功能，但不负责自己跟踪依赖项。然后在每个插件安装时处理该任务。

# windows - 映射网络驱动器的脚本

> ID：563028
> 
> 赞同：9
> 
> 时间：2009-02-18T21:59:56.433
> 
> 标签：windows, language-agnostic, scripting

我希望能够从我的笔记本电脑连接到（wifi）网络硬盘，但只是偶尔。如果我在 WinXP 资源管理器中使用“映射网络驱动器”命令，我必须输入驱动器的 IP 地址和名称，然后是路由器名称及其密码。太多记不住了！

我正在寻找一种编写此活动脚本的方法（以任何语言），例如：

```
map Z: \\10.0.1.1\DRIVENAME "ROUTERNAME\PW" 
```

我并不特别关心脚本是用什么语言编写的。顺便说一句，我知道 DOS 的“subst”命令，但由于密码保护，我认为在这种情况下我不能使用它。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-02-18T22:02:28.130

使用`net use`命令：

```
net use Z: \\10.0.1.1\DRIVENAME 
```

**编辑1：**另外，我认为应该简单地附加密码：

```
net use Z: \\10.0.1.1\DRIVENAME PASSWORD 
```

您可以通过以下方式了解有关此命令及其参数的更多信息：

```
net use ? 
```

**编辑 2：**正如 Tomalak 在评论中提到的，您可以稍后通过取消映射它

```
net use Z: \delete 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-18T22:04:23.180

这不起作用（假设“ROUTERNAME”是路由器期望的用户名）？

```
网络使用 Z: "\\10.0.1.1\DRIVENAME" /user:"ROUTERNAME" "PW"

```

或者，您可以使用一个小的 VBScript：

```
Option Explicit
Dim u, p, s, l
Dim Network: Set Network= CreateObject("WScript.Network")

l = "Z:"
s = "\\10.0.1.1\DRIVENAME"

u = "ROUTERNAME"
p = "PW"

Network.MapNetworkDrive l, s, False, u, p 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-06-22T22:28:14.507

[Tomalak 的](https://stackoverflow.com/questions/563028/script-to-map-network-drive/563046#563046)回答对我很有用（+1）

我只需要为了我的目的稍微改变它，我不需要密码——它是用于公司域的：

```
Option Explicit
Dim l: l = "Z:"
Dim s: s = "\\10.10.10.1\share"
Dim Network: Set Network = CreateObject("WScript.Network")
Dim CheckDrive: Set CheckDrive = Network.EnumNetworkDrives()
Dim DriveExists: DriveExists = False
Dim i

For i = 0 to CheckDrive.Count - 1
  If CheckDrive.Item(i) = l Then
    DriveExists = True
  End If
Next

If DriveExists = False Then
  Network.MapNetworkDrive l, s, False
Else
  MsgBox l + " Drive already mapped"
End If
```

或者，如果您想断开驱动器：

```
For i = 0 to CheckDrive.Count - 1
  If CheckDrive.Item(i) = l Then 
    WshNetwork.RemoveNetworkDrive CheckDrive.Item(i)
  End If
Next
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-18T22:14:58.113

为什么不映射网络驱动器但取消选择“登录时重新连接”？驱动器只会在您尝试访问它时连接。请注意，如果某些应用程序指向它，它们将失败，但如果您直接通过 Windows 资源管理器访问文件，则效果很好。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-02-18T22:03:50.043

试试[net use](http://www.cezeo.com/tips-and-tricks/net-use-command/)命令

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2015-04-09T20:20:36.100

[这是JohnB](https://stackoverflow.com/users/287311/johnb)[答案](https://stackoverflow.com/a/3097624/117347)的JScript 变体

```
// Below the MSDN page for MapNetworkDrive Method with link and in case if Microsoft breaks it like every now and then the path to the documentation of now.
// https://msdn.microsoft.com/en-us/library/8kst88h6(v=vs.84).aspx
// MSDN Library -> Web Development -> Scripting -> JScript and VBScript -> Windows Scripting -> Windows Script Host -> Reference (Windows Script Host) -> Methods (Windows Script Host) -> MapNetworkDrive Method

var WshNetwork = WScript.CreateObject('WScript.Network');
function localNameInUse(localName) {
    var driveIterator = WshNetwork.EnumNetworkDrives();
    for (var i=0, l=driveIterator.length; i < l; i += 2) {
        if (driveIterator.Item(i) == localName) {
            return true;
        }
    }
    return false;
}

function mount(localName, remoteName) {
    if (localNameInUse(localName)) {
        WScript.Echo('"' + localName + '" drive letter already in use.');
    } else {
        WshNetwork.MapNetworkDrive(localName, remoteName);
    }
}

function unmount(localName) {
    if (localNameInUse(localName)) {
        WshNetwork.RemoveNetworkDrive(localName);
    }
} 
```

# .net - 在哪里可以找到好的 NHibernate 和 ASP.NET MVC 参考应用程序

> ID：563030
> 
> 赞同：16
> 
> 时间：2009-02-18T22:00:07.200
> 
> 标签：.net, asp.net, asp.net-mvc, nhibernate, reference-application

我在哪里可以找到好的 NHibernate 和 ASP.NET MVC 参考应用程序？我下载了 S#arp，这似乎比我需要的要多得多（通过 T4 的 IOC 和 CodeGen）。稍后我可能会努力做到这一点，但一开始我需要一些更小的东西。

有什么简单的例子吗？我只想了解 NHibernate 会话处理在 ASP.NET MVC 中的工作原理。也许一些简单的查询场景是如何工作的。仍然试图掌握如何在 NHibernate 中完成[SELECT DISTINCT](https://stackoverflow.com/questions/558974/nhibernate-select-distinct-equivalent-for-a-page-filter-northwind)并通过 ViewData 到达视图。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-18T23:19:42.500

我会尝试独立解决它们。

在 Billy McCafferty 写出他写的sharp-architecture 之前，我认为这是关于NHibernate 最佳实践的[codeproject上必读的一本书。](http://www.codeproject.com/KB/architecture/NHibernateBestPractices.aspx)另外，我刚刚在 MVC 标签下发现了一些非常好的[DimeCasts](http://dimecasts.net/Casts/ByTag/MVC)（由 Kyle Baley 编写）。

[Rob Conery](http://blog.wekeroad.com/)创建了 ASP.NET [MVC Storefront](http://www.asp.net/learn/mvc-videos/)视频系列，他介绍了许多模式和实践。编写的后端使用 Linq to SQL，但可以使用[LinQ to NHibernate](http://ayende.com/Blog/archive/2007/03/16/Linq-for-NHibernate.aspx)进行调整。最近，他还与[Ayende Rahien一起制作了一个关于](http://ayende.com/blog/)[TekPub](http://tekpub.com/preview/nhibernate) -NHibernate的视频系列。最后（对于 NHibernate）有 NHibernate 的[夏天](http://www.summerofnhibernate.com/)

[S# 拱源](http://code.google.com/p/sharp-architecture/)本身现在也带有一个示例项目。

最后，还有使用 MVC.Net 和 NHibernate 构建的[**Code Camp 服务器**](http://code.google.com/p/codecampserver/)，它使用了几乎所有你能想到的开源工具......

*边注*

如果您有兴趣在使用 NHibernate 时摆脱那些烦人的 XML 文件，您可能还想看看[fluent](http://nhforge.org/blogs/nhibernate/archive/2008/09/02/a-fluent-interface-to-nhibernate-part-1.aspx) .

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T00:13:41.730

[代码营服务器](http://code.google.com/p/codecampserver/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T22:34:57.787

它不是一个完整的示例应用程序或任何东西，但它是一个围绕 DDD/nHibernate 等编写的精心设计的 ASP.NET MVC 项目框架。

[http://code.google.com/p/sharp-architecture/](http://code.google.com/p/sharp-architecture/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-02-21T12:23:00.037

你可以查看这些网站

[http://nhibernateasp.codeplex.com](http://nhibernateasp.codeplex.com)

[http://blog.bobcravens.com/2010/07/using-nhibernate-in-asp-net-mvc/](http://blog.bobcravens.com/2010/07/using-nhibernate-in-asp-net-mvc/)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-22T21:49:20.960

这是另一个：

[http://dataguidance.codeplex.com/](http://dataguidance.codeplex.com/)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-08-08T17:51:03.477

BuddyJoe，你能找到一个很好的 NHibernate 和 ASP.NET MVC 参考应用程序 NHibernate Mvc 代码[nhibernatetutorial.com](http://nhibernatetutorial.com)

# http-headers - 我可以在 HTTP 标头中传递自定义数据吗？

> ID：563035
> 
> 赞同：20
> 
> 时间：2009-02-18T22:01:13.717
> 
> 标签：http-headers

我有一大堆网络服务，每个服务都有几个网络方法。这些服务的消费者多种多样。我想用一个额外的可选参数（Int64 或 Int32）来扩充这些 Web 方法中的每一个，但是使用这个额外的（可选参数）添加新方法需要做很多工作，并且让客户端使用新方法将更加耗时.

所以我想知道我是否可以允许想要利用此参数提供的新功能的客户端可以在 HTTP 标头或其他方式中传递此 Int。

所以第一个问题是我可以在 HTTP 标头中传递一个 int 吗？如果是这样，如何在 C#/ASP.NET 中做到这一点？

否则，您对解决这个问题有什么其他建议？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-02-18T22:11:54.813

它有点不正统，我相信一些纯粹主义者会对这个想法感到不安（标题应该只用于消息的传输，并且不应该包含消息的语义）。

实际上它是可行的，但是您要确保所有客户都可以添加这些标头。如果您的客户使用工具来调用 Web 方法，而不是自己生成 HTTP 请求（我希望是这种情况），那么这很有可能是一个问题。

为什么添加这些额外的方法重载如此困难？

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-18T22:34:15.027

是的，这是允许的——但请注意，它可能会切断使用代理的能力，有时还会切断使用 http 感知防火墙的能力（它们倾向于检查和重写标头）。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-19T02:38:35.377

```
Request.Headers.Add("headername", "headervalue");
Response.Headers.Add("headername", "headervalue"); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T02:48:46.910

我曾经使用过这个概念来处理 Intranet Web 应用程序中 ajax 调用的注销重定向（与 Web 服务无关）。

这是我手头最好的解决方案，但正如其他人所说，这取决于您是否可以将约束推送给客户以出于您的目的处理这些标题。

绝对不是您默认想要做的事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T22:05:52.270

你可以，但你必须定义一个 Header，然后设置它的值。就像在[HttpWebRequest](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.headers.aspx)中一样，您可以添加任何标头，只要它不是保留的标头之一。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-18T22:16:30.967

请注意，虽然可以在 ASP.NET 中使用自定义标头，但并不总是可以在 ASP.NET 中生成自定义标头。只有在运行 ASP.NET 集成模式（即 IIS 7.0）时才能执行此操作。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-18T22:26:00.740

可以，但这首先违背了使用 Web 服务的全部目的。类似于科普书中每个公式减少一半受众的说法，每一个增加界面复杂度的快速破解都意味着未来会遇到很多麻烦。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2021-06-17T16:43:17.780

**来自 RFC！**

你真的可以，现在它得到了新的[RFC Standards](https://datatracker.ietf.org/doc/html/rfc6648)的支持，

当你想从你的 API 获取但仍然想要 GET 纯粹的诞生（GET 中没有正文）时真的很有帮助

如需简化阅读，请查看[Mozilla 说明](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers)

# c# - 使用自定义 ClientCredentials 进行 WCF 身份验证：要使用的 clientCredentialType 是什么？

> ID：563037
> 
> 赞同：25
> 
> 时间：2009-02-18T22:02:03.670
> 
> 标签：c#, wcf, web-services, authentication, token

我不得不放弃基本的 WCF UserName/Pwd 安全性并实现我自己的自定义客户端凭据，以保存超出默认提供的更多信息。

我完成了[这篇 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms730868.aspx)，但我遗漏了一些东西，因为它不起作用。

首先，我有一些提供自定义 ClientCredentialsSecurityTokenManager 的自定义 ClientCredentials：

```
public class CentralAuthCredentials : ClientCredentials
{
    public override System.IdentityModel.Selectors.SecurityTokenManager CreateSecurityTokenManager()
    {
        return new CentralAuthTokenManager(this);
    }
}

public class CentralAuthTokenManager : ClientCredentialsSecurityTokenManager
{
    private CentralAuthCredentials credentials;

    public CentralAuthTokenManager(CentralAuthCredentials creds) : base(creds)
    {
        this.credentials = creds;
    }

    public override SecurityTokenProvider CreateSecurityTokenProvider(SecurityTokenRequirement tokenRequirement)
    {
        if (this.IsIssuedSecurityTokenRequirement(tokenRequirement) || tokenRequirement.TokenType == CentralAuthToken.TOKEN_TYPE)
            return new CentralAuthTokenProvider(credentials.UserId, credentials.UserPassword, credentials.ImpersonateId, credentials.LoginType);
        else
            return base.CreateSecurityTokenProvider(tokenRequirement);
    }

    public override SecurityTokenAuthenticator CreateSecurityTokenAuthenticator(SecurityTokenRequirement tokenRequirement, out SecurityTokenResolver outOfBandTokenResolver)
    {
        outOfBandTokenResolver = null;
        if (this.IsIssuedSecurityTokenRequirement(tokenRequirement) || tokenRequirement.TokenType == CentralAuthToken.TOKEN_TYPE)
            return new CentralAuthTokenAuthenticator();
        else
            return base.CreateSecurityTokenAuthenticator(tokenRequirement, out outOfBandTokenResolver);
    }

    public override SecurityTokenSerializer CreateSecurityTokenSerializer(SecurityTokenVersion version)
    {
        return new CentralAuthTokenSerializer();
    }
} 
```

现在，当我运行该应用程序时，我的自定义凭据和令牌管理器确实被创建了。但是，在方法中：

```
CreateSecurityTokenProvider(SecurityTokenRequirement tokenRequirement)
{
    ...
} 
```

tokenRequirement.TokenType 不是我的自定义令牌。这提出了我的**第一个问题**：WCF 到底是如何知道令牌要求是什么？

还有，方法：

```
public override SecurityTokenSerializer CreateSecurityTokenSerializer(SecurityTokenVersion version)
{
    return new CentralAuthTokenSerializer();
} 
```

客户端会调用一次，但返回的令牌序列化程序上的任何方法都不会被调用。这向我表明自定义令牌永远不会通过网络发送。我认为这是因为对 CreateSecurityTokenProvider() 的调用从未返回我的自定义令牌提供程序，因为 SecurityTokenRequirement 从未传入，表明需要我的自定义令牌。

在客户端，我有：

```
public class CentralAuthorizationManagerClient : ClientBase<ICentralAuthorizationManager>, ICentralAuthorizationManager, IDisposable
{
    public PFPrincipal GenerateToken()
    {
        if (!this.ChannelFactory.Endpoint.Behaviors.Contains(typeof(CentralAuthCredentials)))
            throw new ArgumentException("Must set CentralAuthCredentials before calling this method.");
        return base.Channel.GenerateToken();
    }

    public PFPrincipal GenerateToken(CentralAuthToken token)
    {
        this.ChannelFactory.Endpoint.Behaviors.Remove<ClientCredentials>();
        this.ChannelFactory.Endpoint.Behaviors.Add(new CentralAuthCredentials(token));
        return this.GenerateToken();
    } 
```

这些方法基本上应该从端点中删除默认凭据并附加我的自定义 CentralAuthCredentials 的新实例。（我从某处的 MSDN 文章中获取了这个 Remove/Add 组合）。

在配置中：

```
 <behaviors>
        <endpointBehaviors>
            <behavior name="Server2ServerEndpointBehavior">
                <clientCredentials type="MyApp.Security.CentralAuthCredentials, MyApp">
                    <clientCertificate findValue="localhost" x509FindType="FindBySubjectName" storeLocation="CurrentUser" storeName="My" />
                    <serviceCertificate>
                        <authentication certificateValidationMode="None" revocationMode="NoCheck" />
                    </serviceCertificate>
                </clientCredentials>
            </behavior>
        </endpointBehaviors>
    </behaviors>

    <bindings>
        <wsHttpBinding>
            <binding name="wsHttpServer2Server">
                <security mode="Message">
                    <message clientCredentialType="UserName" />
                </security>
            </binding>
        </wsHttpBinding>
    </bindings> 
```

请注意，行为的 clientCredentials 类型设置为我的自定义客户端凭据。但是，目前我仍然将绑定的 clientCredentialType 设置为“UserName”。这提出了我的**第二个问题**：clientCredentialType=" 到底应该怎么做？" 如果我使用自定义凭据，设置为？根据 MSDN，*消息*安全的可用值是：*None*、*Windows*、*UserName*、*Certificate*和*IssuedToken*。

有任何想法吗？希望我只是缺少一些简单的东西？整个实现还有 6 个类，但我试图只包含了解情况所需的部分......

* * *

**更新＃1：**

我整天都在做这个，感谢一些消息来源，我意识到我缺少的部分是[此页面](http://msdn.microsoft.com/en-us/library/ms731872.aspx)上的最后一步，即将 TokenParameters 添加到绑定中，以便绑定知道什么令牌看起来像。这就是我最初的第一个问题的答案；“到底是什么设置了令牌要求？” 答案：分配给绑定的 TokenParameters。

所以现在我添加了以下扩展，它在绑定上设置了 TokenParameters：

```
public sealed class CentralAuthTokenBindingExtension : BindingElementExtensionElement
{
    public CentralAuthTokenBindingExtension()
        : base()
    {
    }

    public override Type BindingElementType
    {
        get { return typeof(SymmetricSecurityBindingElement); }
    }

    protected override System.ServiceModel.Channels.BindingElement CreateBindingElement()
    {
        X509SecurityTokenParameters protectionParams = new X509SecurityTokenParameters();
        protectionParams.InclusionMode = SecurityTokenInclusionMode.Never;

        SymmetricSecurityBindingElement innerBindingElement = new SymmetricSecurityBindingElement();
        innerBindingElement.EndpointSupportingTokenParameters.SignedEncrypted.Add(new CentralAuthTokenParameters());
        //innerBindingElement.MessageProtectionOrder = MessageProtectionOrder.SignBeforeEncrypt;
        innerBindingElement.ProtectionTokenParameters = protectionParams;

        return innerBindingElement;
    }
}

    <extensions>
        <bindingElementExtensions>
            <add name="CentralAuthCreds" type="MyApp.Security.Configuration.CentralAuthTokenBindingExtension, MyApp, Version=1.0.0.0, Culture=neutral, PublicKeyToken=null" />
        </bindingElementExtensions>
    </extensions>

    <bindings>
        <customBinding>
            <binding name="wsHttpServer2Server">
                <CentralAuthCreds />
                <binaryMessageEncoding />
                <httpTransport />
            </binding>
        </customBinding>
    </bindings> 
```

好吧，这让我更进一步。现在我在服务器上得到一个新的异常：

```
"The security token manager cannot create a token authenticator for requirement ..." 
```

看起来 WCF 正在使用一些默认令牌管理器来尝试处理我的自定义令牌，而不是我的自定义令牌处理程序（我的自定义令牌处理程序的构造函数从未被调用）。我*认为*这是因为对于*客户端*，我有这个配置：

```
<endpointBehaviors>
    <behavior name="Server2ServerEndpointBehavior">
        <clientCredentials type="MyApp.Security.CentralAuthCredentials, MyApp"> 
```

但是在*服务器*上，我没有任何等价物可以让它知道自定义客户端凭据。所以，**新问题**：在服务器的配置中，我应该告诉它自定义 ClientCredentials 是什么？

* * *

**更新#2：**

好吧，我终于想出了更多的谜题。我只实现了一个 ClientCredentials 实现，认为客户端发送凭据，仅此而已。客户端不对服务进行身份验证，因此我不需要自定义 ServiceCredentials。好吧，我错了。指定的 ServiceCredentials 对来自 ClientCredentials 的令牌进行身份验证，反之亦然。所以我只需要添加一个自定义的 ServiceCredentials 实现，它传递了相同的 TokenSerializer 和 TokenAuthenticator 类。

关于下一个问题：WCF 现在忽略了我在配置中指定的 x509 证书，这些证书与 UserName auth 一起工作正常。我将为这个问题打开一个全新的问题！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T09:59:33.710

我正在使用的应用程序遇到类似问题，不幸的是我放弃了，因为我无法让自定义凭据正常工作。我现在使用用户名/密码（客户端凭据）和证书（服务凭据），并在服务调用中添加了自定义加密的soap标头以传递其他信息，例如用户ID等。

# c - 有人可以解释 Solaris 中“dirent”结构的定义吗？

> ID：563045
> 
> 赞同：6
> 
> 时间：2009-02-18T22:04:15.207
> 
> 标签：c, unix, struct, solaris

最近我正在查看“dirent”结构（在 dirent.h 中），对它的定义有点困惑。

注意：这个头文件来自我学校的一台 Solaris 机器。

```
 typedef struct dirent {
    ino_t       d_ino;
    off_t       d_off;
    unsigned short  d_reclen;
    char        d_name[1];
} dirent_t; 
```

特别是 d_name 字段。这将如何在操作系统中工作？如果您需要存储一个以空结尾的字符串，那么单个字符的数组有什么用？我知道您可以通过数组的第一个元素获取数组的地址，但我仍然感到困惑。显然发生了什么事，但我不知道是什么。在我家里的 Fedora Linux 系统上，这个字段被简单地定义为：

```
char d_name[256]; 
```

现在，由于显而易见的原因，这更有意义。有人可以解释为什么 Solaris 头文件定义结构吗？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T23:58:47.727

正如其他人指出的那样，结构的最后一个成员没有任何设置大小。然而，该数组很长，实现决定它需要容纳它想要放入其中的字符。它通过为结构动态分配内存来做到这一点，例如 with `malloc`。

`dirent`不过，将成员声明为大小为 1 很方便，因为很容易确定任何变量占用了多少内存`d`：

```
sizeof(dirent) + strlen(d.d_name) 
```

使用 size 1 也会阻止此类结构值的接收者尝试将自己的名称存储在其中，而不是分配自己的`dirent`值。使用 Linux 定义，可以合理地假设您拥有的任何`dirent`值都将接受 255 个字符的字符串，但 Solaris 不保证其`dirent`值将存储超出其需要的任何字符。

我认为是 C 99 为结构的最后一个成员引入了一种特殊情况。结构体可以这样声明：

```
typedef struct dirent {
  ino_t d_ino;
  off_t d_off;
  unsigned short d_reclen;
  char d_name[];
} dirent_t; 
```

该数组没有声明的大小。这称为*灵活数组成员*。它完成了与 Solaris 版本相同的事情，只是不存在结构本身可以拥有*任何*名称的错觉。你看它就知道它还有更多。

使用“灵活”声明，占用的内存量将调整如下：

```
sizeof(dirent) + strlen(d.d_name) + 1 
```

这是因为灵活的数组成员不考虑结构的大小。

您没有经常看到这样的灵活声明的原因，尤其是在 OS 库代码中，可能是为了与不支持该功能的旧编译器兼容。它也是为了与针对当前定义而编写的代码兼容，如果结构的大小发生这样的变化，这将破坏。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-18T22:10:25.270

dirent 结构将立即在内存中跟随一个包含名称其余部分的内存块，并且可以通过 d_name 字段访问该内存。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-18T22:11:09.793

这是 C 语言中用于指示结构末尾的任意长度数组的模式。C 中的数组没有内置的边界检查，因此当您的代码尝试访问从 d_name 开始的字符串时，它将继续超过结构的末尾。这依赖于`readdir()`将分配足够的内存来保存整个字符串加上终止的 nul。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T22:12:38.777

对我来说，它看起来像是一个微优化。名称通常很短，所以为什么要分配您知道将不会使用的空间。此外，Solaris 可能支持超过 255 个字符的名称。要使用这样的结构，您只需分配所需的空间并忽略*假定*的数组大小。

# css - CSS 表单样式，一行上有多个控件

> ID：563047
> 
> 赞同：2
> 
> 时间：2009-02-18T22:04:30.463
> 
> 标签：css, forms, multiline

我想在一行上制作一个带有多个文本框/标签组合的 CSS 表单。我看到的大多数示例都显示每一行都有一个单独的表单字段。

例如，我想在一行中使用姓氏和名字文本框，在第二行中使用电话号码。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T22:09:31.763

您可以使用与此相关的 CSS，但这并不是 CSS 问题。像这样简单的东西应该可以工作：

```
<label for="last_name">Last Name:</label> <input type="text" id="last_name" name="last_name" />
<label for="first_name">First Name:</label> <input type="text" id="first_name" name="first_name" />
<br />
<label for="phone">Phone Number:</label> <input type="text" id="phone" name="phone" /> 
```

正如我所说，CSS 可能是相关的，例如，如果您将输入或标签定义为 display:block 而不是 display:inline，则会添加换行符，但默认情况下不应发生。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T22:11:31.900

有很多方法可以做到这一点。乍得展示了一个。这是另一个：

### HTML：

```
<label id="LNameField" for="LName">Last Name 
   <input id="LName" type="text">
</label>
<label id="FNameField" for="FName">First Name 
   <input id="FName" type="text">
</label>
<label id="PhoneField" for="Phone">Phone Number 
   <input id="Phone" type="text">
</label> 
```

### CSS：

```
label
{
   display: block;
   float: left;
}

#PhoneField { clear: both; } 
```

# frameworks - 从概念到网站的最快方式是什么？

> ID：563050
> 
> 赞同：4
> 
> 时间：2009-02-18T22:04:47.267
> 
> 标签：frameworks, web

我有一堆网站创意，我想知道从一个非常全面的概念定义（创意思维导图、用例、架构图）到一个工作网站的最快方法是什么。唯一的一点是获得功能性的东西，而不是担心性能。这个想法是拿出一些东西来展示一个功能性的网站，然后在必要时担心微调或重写部分。

我熟悉很多来自开源和专有世界的 Web 框架，但到目前为止，我还没有找到可以让你快速从概念到工作站点的 Web 开发环境的瑞士军刀。我有点想知道是否有这样的东西，免费或非免费

期待您的建议...

更新：对于这个网站的好心读者来说，这个问题可能有点太隐喻了，但我现在觉得实现细节正在扼杀我的创造力......也许你会笑，或者你会感到被冒犯，我只是想知道是否有人可以给我一个有用的提示..

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T22:39:06.420

首先，选择动态脚本语言。静态类型和编译会减慢开发速度。PHP 是一个不错的选择，因为您可以下载像 xampp 这样的 LAMP 包并立即启动。

接下来，尽可能使用 CMS。如果您需要灵活的前端设计，请选择以模板为中心的 CMS，例如 Expression Engine。如果您的网站看起来相对一般，那么请使用 Drupal 之类的东西。

如果你需要一个框架的灵活性，你能花多少时间去学习它？您将快速掌握 CodeIgniter 或 Kohana。其他框架可以通过幕后魔术节省时间，但您可能会失去灵活性并且学习曲线非常~~昂贵~~。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T23:32:07.913

假设您的网站足够独特以至于无法使用现成的东西（CMS、博客、开源等）来完成，那么让网站快速完成的下一个最佳选择是使用诸如 asp.net 之类的编程框架， RoR，姜戈，检票口。您提到了 Coldfusion，这也是一种可能性。

您使用哪种框架取决于您。在许多情况下，框架将通过为您提供控件/函数中的功能或为您生成代码来缩短开发时间。asp.net 有一个类似动态数据脚手架的功能，它将为您的数据库构建一个通用的“管理”界面。

加快开发时间的另一种方法是使用带有 GUI 的 IDE 来构建您的站点。像这样的一些 IDE 包括 Dreamweaver 和 Visual Studio.net（或 Visual Web Developer）。使用这些 IDE，您几乎可以在不接触任何代码的情况下构建您的网站。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T22:56:53.427

IMO，从概念到站点的最快方式是实际构建它（请继续阅读）。选择一个想法并围绕它建立一个简单的网站。在构建它时，请记住其他站点，这将有望帮助您编写高度可重用的代码。实际上，有很多东西可以重复使用：用户登录系统、数据访问层（当然，在一定程度上）和其他“通用”部分。一旦您编写或购买了其中一些东西，下一个站点就会变得容易得多。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T23:33:29.533

从 asp.net 开发人员的角度来看，并不想煽动圣战，Visual Studio 中的 Web 表单设计师，并不是真正的自由。

使用像 SubSonic（或类似的）这样的 ORM 来生成 DAL，然后您可以使用表单设计器快速拖放到功能性的概念证明，使用将涵盖 80% 的任务的工具包可能会遇到。

生成的标记可能会非常难看，并且该站点的性能可能比您想要的生产性能稍差，但 pplz 将能够单击内容并观看 dem 闪烁灯。

如果这个想法浮出水面，那么您可以调整并可能重用您的 DAL，并且可能将站点移植到 MVC 或其他使标记更精简的东西。

随着时间的推移，您最终会收集到相当多的常用物品，并且您的原型在引擎盖下并不那么丑陋，因此它们需要更少的时间来投入生产。

所以，这是一种观点，但如果您从未使用过 .net，那么最初的学习曲线可能会让这变得不那么快。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-22T10:19:29.740

结帐[谷歌应用引擎](http://code.google.com/appengine/)。严重地。我是一个没有 Python 经验的 .Net 开发人员，尽管我过去曾经写过很多 PHP。我也很难快速制作 Web 应用程序的原型，因为它们突然出现在我的脑海中，但今天早上我决定试一试应用程序引擎，并设法在几个小时内为一个简单的 mashup 获得一个工作原型。它摇摆不定。使用它创建数据驱动的应用程序非常容易，并且非常简单。

非常感动。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T22:13:51.423

无论如何，如果您的网站是功能性的，而不仅仅是华丽的（如个人资料或电影网站），您将不得不自己编写代码以使其正常工作。但是，为了快速开发网站的视觉部分，我建议使用以下软件：* [NVU](http://www.net2.com/nvu/) * [Dreamweaver](http://www.adobe.com/products/dreamweaver/) * [ImageMagick](http://www.imagemagick.org/script/index.php) * [GIMP](http://www.gimp.org/) * [Photoshop](http://www.adobe.com/products/photoshop/family/) * 等。

对于剩下的部分，您将需要一些可以帮助您以您选择的任何语言进行编程的东西。就个人而言，我更喜欢 apache/PHP/MySQL 服务器设置，因为它快速且易于操作，而且您几乎可以使用任何东西来创建 PHP 文件（vim/nano）。对于 Windows，我会推荐[Notepad++](http://notepad-plus.sourceforge.net/uk/site.htm)或[Programmers Notepad](http://www.pnotepad.org/)。

但是请注意，即使您使用这些工具，也不能保证您能够快速创建站点。

希望这可以帮助。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T22:18:26.860

确实没有快速的方法来做到这一点。如果您正在寻找投资者或在该网站上工作的人，则必须提供详细的规格。如果您需要更多，那么您将不得不开始编写真实的站点。在这种情况下，您需要使用您所知道的任何东西来快速创建一个站点。框架本身远没有您使用它的经验重要。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T23:54:43.443

外包。转到rentacoder.com 或类似网站。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T00:23:31.723

到目前为止，其他海报还没有提到的是首先勾勒出界面。设计您的主屏幕的外观，以及链接将带您到哪里。在深入研究您的问题之前进行计划总是一个好主意。

# objective-c - makeObjectsPerformSelector：

> ID：563051
> 
> 赞同：17
> 
> 时间：2009-02-18T22:04:56.517
> 
> 标签：objective-c, arrays, cocoa, nsarray

我想让数组中的所有对象都执行选择器。我发现了适当命名的`makeObjectsPerformSelector:`方法，但我有一个问题。如果我在数组上使用它，它会更改现有数组还是返回一个新数组？如果它修改了现有对象，那么在应用了选择器的情况下返回一个新数组的最简单方法是什么？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-02-18T22:18:31.820

makeObjectsPerformSelector: 将对数组中的每个对象运行该选择器。如果这些对象被选择器修改，它们将被修改。它不返回任何东西。现在，有一个问题，默认情况下 Cocoa 中的大多数副本都是浅副本，这意味着您获得了一个新数组，但它指向的底层对象是相同的对象。您将需要使用 initWithArray:copyItems 使其也复制根级别的项目。如果您想要一个包含更改对象的新数组以及旧数组，请执行以下操作：

```
NSArray *newArray = [[NSArray alloc] initWithArray:oldArray copyItems:YES];
[newArray makeObjectsPerformSelector:@selector(doSomethingToObject)]; 
```

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2009-02-18T23:21:31.730

> 如果我在数组上使用它，它会更改现有数组还是返回一个新数组？

不。

首先，阅读签名：

```
- (void)makeObjectsPerformSelector:(SEL)aSelector 
```

`void`，后面没有星号，表示“不返回任何内容”。

其次，注意这是 NSArray 的一个方法，它是一个不可变的类。因此，`makeObjectsPerformSelector:`不改变接收数组，因为那是不可能的。

有 NSMutableArray，因为它是 NSArray 的子类，所以它继承了`makeObjectsPerformSelector:`. 但是，如果 NSMutableArray 改变了该方法的行为，它的文档将有自己的方法列表（请参阅`init`各种类文档中的许多定义）。没有这样的列表，因此您可以安全（且正确）推断其`-[NSMutableArray makeObjectsPerformSelector:]`工作方式与`-[NSArray makeObjectsPerformSelector:]`.

对象可以修改自己以响应您的消息，但数组本身将包含与`makeObjectsPerformSelector:`之前相同的对象。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-19T10:59:47.433

除了其他答案，如果您*确实*想使用调用方法的结果创建一个新数组，您可以这样做：

```
NSArray *derivedArray = [originalArray valueForKey:@"foo"]; 
```

这**仅**在您的对象可以处理 '-valueForKey:@"foo"' 消息时才有效，并且显然仅适用于不带参数并返回非零值的方法。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-18T22:25:09.540

我希望我能正确解释这一点......

如果您执行 [myArray makeObjectsPerformSelector:someSelector]，您实际上只是在遍历 myArray 并将选择器消息发送到每个对象。该数组未更改，因为不允许 makeObjectsPerformSelector 更改其内容。

所以最后，你得到了具有相同对象的相同数组。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-10-19T13:22:14.680

在下面的示例中，您可以看到`superView`创建了一个并添加了 10 个子视图，然后向它们中的每一个发送`removeFromSuperView`（类中存在的方法`view`），结果是 中的零子视图`superView`。

如果您熟悉 JavaScript 并尝试`map`在 JavaScript 中找到类似的东西，那么情况并非如此。`map`对数组的每个元素运行一个函数并将其替换为结果，但这里`makeObjectsPerformSelector`运行一个存在于数组的每个对象中的方法。

```
UIView* superView = [[UIView alloc] initWithFrame:CGRectZero];

for(int i = 0; i < 10; i++){
    UIView* view = [[UIView alloc] initWithFrame:CGRectZero];
    [superView addSubview:view];
}

NSLog(@"count = %lu", (unsigned long)[superView.subviews count]); // 10
[superView.subviews makeObjectsPerformSelector:@selector(removeFromSuperview)]; // removeFromSuperview is exist in `view`, you can call [view removeFromSuperview];
NSLog(@"count = %lu", (unsigned long)[superView.subviews count]); // 0 
```

# php - 调度和夏令时

> ID：563053
> 
> 赞同：8
> 
> 时间：2009-02-18T22:05:14.440
> 
> 标签：php, time, calendar, timezone, utc

我正在用 PHP 编写日历/日程安排应用程序。现在，我会选择您希望事件发生的星期几和时间。我还询问时区并进行相应调整以获取 GMT 的事件时间。

然后我将该时间存储为演出当天午夜的偏移量。这很好，效果很好，但是当我达到夏令时时会发生什么？我不知道发生这种情况时该怎么办。另一个问题是并非所有国家都有夏令时，所以我在那里有点束缚。

我在日历上显示这些事件，所以时间很重要。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T22:47:08.473

处理 DST 真的很痛苦。

对于未来的事件，您应该存储事件发生的位置和本地时间，而不是 GMT 时间。这是因为有时政府会在 DST 开始和停止时发生变化（去年刚刚在美国发生过），然后事件会在 GMT 时发生变化，但不会在当地时间发生变化。

然后，如果您需要在事件发生时通知，请每天收集接下来 24-48 小时的事件，然后将其时间转换为 GMT。为此，您需要一个像[这样](http://www.twinsun.com/tz/tz-link.htm)的位置时区数据库。获取事件发生时每个位置的 GMT 偏移量，并使用它将时间转换为 GMT，然后您就可以准确地知道事件何时发生。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T20:23:27.927

我认为您在 GMT (UTC) 上走在正确的轨道上。*每当您在特定时间点*发生（或已经发生）某些事件时，使用 UTC 作为您的规范时间戳表示。UTC 不受 DST 规则的影响，因此它是一个很好的、明确的时间点表示。

一旦您制定了明确表示事件日期/时间的策略，那么您就可以很容易地根据哪个时区最容易从您的用户那里接受（或向他们显示）来解决*本地化日期/时间的问题。*您可能还需要知道并存储事件的时区，但是，因为您以 UTC 格式存储实际的事件日期/时间，如果这更相关，您可以很容易地将其本地化到用户的时区在任何给定的用例中给他们。

这种本地化通常使用您的 SDK 提供的时区库（例如 Java 有 java.util.Calendar）或作为第三方扩展（例如 Python 有 pytz）来执行。我确信 PHP 有一个等价物，但我不熟悉它的库。

这些库通常构建在规则数据库之上，例如[Olson Zoneinfo DB](http://en.wikipedia.org/wiki/Zoneinfo)。这些规则可能会经常更改，因此您必须随时了解底层数据库的更新，尤其是在您开发真正的全球应用程序时。但是，它们在将晦涩难懂的时区规则外部化方面做得很好，这样您就可以（理论上）更新规则数据库，而无需在 DST 规则在特定区域的变化。

这不是世界上最简单的问题，而且我们必须这样做，但一旦你完成了几次并理解了存储精确时间点表示与本地化关注之间的关注点分离，那么它成为第二天性。

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-02-22T09:00:48.150

为什么不把责任转嫁给用户。我认为他们需要注册才能使用该应用程序。

让他们在他们的个人资料中说明他们的时间偏移量是多少。像 GMT + 2、GMT - 8 等。他们会知道他们的 DST 设置何时更改并相应地更新他们的个人资料。

当然，这取决于您的用户群。他们可能接受或不接受这种方法。

# linq-to-sql - 带有 GridView 的 ObjectDataSource 中的 Linq to SQL：IEnumerable 手动排序与 DataTable 自动排序？

> ID：563063
> 
> 赞同：1
> 
> 时间：2009-02-18T22:06:51.537
> 
> 标签：linq-to-sql, asp.net-3.5

**设置：**

我将 Linq to Sql 用于我的 DAL，并扩展类以封装我的 BLL 的 CRUD 方法（创建、读取、更新、删除）。

我不只是使用 LinqDataSource，因为每当我执行正常的 CRUD 操作时，我通常都必须运行一些其他子例程（我知道，这是非常标准的），所以我使用 ObjectDataSource 控件来填充我的 GridViews。

**困境：**

考虑到当您的 ObjectDataSource 是 IEnumerable 等时 GridViews 不排序，从 Linq 查询中为我的所有 SelectMethods 填充一个 DataTable 会更好吗？这将使我免于手动编写一堆排序代码，我想可能会节省开销，因为我可以杀死大的 IEnumerable(of Entity) 并只使用我实际使用的列的轻型 DataTable。

**问题：**

两种方式的优点/缺点是什么：

方式#1：只需将 IEnumerbable(of Entity) 与手动排序代码一起使用

方式 #2：使用 GridView 所需的内容从 Linq 查询填充 DataTable 并使用自动排序。

蒂亚！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-11-02T13:43:44.240

我正在使用 Telerik Rad AJAX 控件，我发现如果我对 RadGrid 使用 NeedDataSource 方法，则无需大量额外的自定义代码即可使用排序。

# vb6 - 这些额外的错误日志文件是如何创建的？

> ID：563074
> 
> 赞同：0
> 
> 时间：2009-02-18T22:09:38.207
> 
> 标签：vb6, networking

我们的一位客户最近遇到了很多网络问题。当我在他们的服务器计算机上检索错误文本文件时，我发现了大约十几个文件，其中一个是正确命名的文件

“错误.txt”

但其他人的名字像

“错误（*计算机*名A v1）.txt”

“错误（*计算机*名A v2）.txt”

“错误（*computernameB* v1）.txt”等

我们的软件绝对不会创建具有这些名称的文件，尽管它正在创建它们的内容。

网络中断显然会在客户端应用程序的很多地方引发错误。处理所有错误的一部分是将它们记录到服务器计算机。执行此操作的例程首先尝试查找错误文件，如果找不到，则尝试创建它。其中一些其他错误文件包含许多错误，表明当网络在一段不小的时间段内关闭时，error.txt 的本地“影子”被用于连续错误？然后一旦网络再次备份，这将被放到服务器上并重命名，以免与现有文件名发生冲突

有人可以解释一下这里发生了什么以及什么软件在做吗？

编辑

响应对相关代码的请求

```
170   On Error Resume Next
      Dim fs
180    Set fs = CreateObject("Scripting.FileSystemObject")
       Dim Item1 As String
       Dim Item2 As String
190    Item1 = strErrorFolder
200    If fs.FolderExists(strErrorFolder) <> True Then
210           MkDir Item1
220    End If

230    Item1 = strErrorFolder & "\Errors.txt"
240    If fs.FileExists(Item1) <> True Then
250    Item2 = App.Path & "Blank.txt"
260           FileCopy Item2, Item1
270           Item2 = ""
280           SetAttr Item1, vbNormal
290           Open Item1 For Output As #1
300           Write #1, "ErrorDateTime", "ErrorUser", "DatabaseAddress", "ProgramVersion", "Module", "SubRoutine", "LineNumber", "ErrorCode", "ErrorDescription"
310           Close #1
320    End If

330    Open Item1 For Append As #1
340           Write #1, ErrorDateTime, ErrorUser, Left(PANDATABASE, 1), ProgramVersion, Module, SubRoutine, LineNumber, ErrorCode, ErrorDescription
350           Close #1

360   On Error GoTo 0

End Sub 'errorhandled not 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T22:28:26.600

在机器上运行[FileMon](http://technet.microsoft.com/en-us/sysinternals/bb896642.aspx)然后导致错误情况。检查 FileMon 日志以查看创建文件的内容。

正如 divo 指出的那样，您可能需要改用[ProcMon](http://technet.microsoft.com/en-us/sysinternals/bb896645.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T12:33:59.063

这是在黑暗中刺伤。尝试更换

```
Item1 = strErrorFolder & "\Errors.txt"
Item2 = App.Path & "Blank.txt" 
```

和

```
Item1 = fs.BuildPath(strErrorFolder, "\Errors.txt")
Item2 = fs.BuildPath(App.Path,"Blank.txt") 
```

另一种调试形式为软件添加了一个配置选项，允许您唯一标识软件的每次安装。将其合并到错误文件名中。这样您就可以看到每个错误文件的来源。

# sql - 表名两边的引号到底有什么作用？

> ID：563090
> 
> 赞同：54
> 
> 时间：2009-02-18T22:12:14.503
> 
> 标签：sql, oracle

我认为引号 (") 只是一种分组标记，但我正在调试一些 NHibernate 代码并注意到虽然

```
SELECT * FROM site WHERE site_id = 3; 
```

工作正常

```
SELECT * FROM "site" WHERE site_id = 3; 
```

因表或视图不存在错误而失败。

是什么赋予了？

* * *

## 回答 #1

> 赞同：101
> 
> 时间：2009-02-18T22:24:14.660

在 Oracle 中为标识符加上双引号会导致 Oracle 将该标识符视为区分大小写，而不是使用默认的不区分大小写。如果您创建一个名称周围带有双引号的表（或列），则必须始终使用双引号引用标识符并正确指定大小写（所有大写标识符除外，其中双引号没有意义）。

在幕后，Oracle 总是进行区分大小写的标识符匹配。但它总是在进行匹配之前将未双引号的标识符转换为大写。如果在标识符周围加上双引号，Oracle 会跳过转换为大写。

所以如果你做类似的事情

```
CREATE TABLE my_table( 
  col1 number,
  col2 number
) 
```

你可以

```
SELECT * FROM my_table
SELECT * FROM MY_TABLE
SELECT * FROM My_Table
SELECT * FROM "MY_TABLE" 
```

但类似的东西

```
SELECT * FROM "my_table" 
```

将失败。

另一方面，如果你做类似的事情

```
CREATE TABLE "my_other_table"( 
  col1 number,
  col2 number
) 
```

你不能做

```
SELECT * FROM my_other_table
SELECT * FROM MY_OTHER_TABLE
SELECT * FROM My_Other_Table
SELECT * FROM "MY_OTHER_TABLE" 
```

但是这个

```
SELECT * FROM "my_other_table" 
```

将工作

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-02-19T12:33:51.653

需要补充的是，引号中的标识符可能包含特殊字符，例如“ab cd”是一个有效的标识符。

# regex - 正则表达式在字符上拆分字符串，不包含在 () 中

> ID：563099
> 
> 赞同：0
> 
> 时间：2009-02-18T22:14:29.787
> 
> 标签：regex

我正在尝试在 a 上拆分一个字符串，其中该字符不包含在 () 中。

示例字符串：

```
`table1`.`lname`,`table1`.`fname`,if(foo is not null,foo,if(bar is not null,bar,table3.baz)),`table3`.`shu` 
```

我想把它分成一个看起来像的数组

```
(
  0=>`table1`.`lname`
  1=>`table1`.`fname`
  2=>if(foo is not null,foo,if(bar is not null,bar,table3.baz))
  3=>`table3`.`shu`
) 
```

关于如何解决这个问题的任何想法？

——戴夫

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T22:17:09.450

一般来说，你不能用正则表达式来做到这一点。您通常需要一个递归后代解析器（或类似的东西）来匹配可能嵌套到任意深度的括号。

我想以前这里也有过类似的问题，但我很难找到它们。 [然而，这个答案](https://stackoverflow.com/questions/408570/regular-expression-to-parse-an-array-of-json-objects/408641#408641)应该有助于解释。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T22:20:31.440

我会查看您最喜欢的语言，看看是否有用于处理 CSV 文件的特定模块。Ruby 有 CSV（在最近的版本中被[FasterCSV取代）可以很好地处理你的问题。](http://fastercsv.rubyforge.org/)

它比单个正则表达式更复杂，但可以完成工作。

Perl 有[这个 Parse::CSV](http://search.cpan.org/~adamk/Parse-CSV-1.00/lib/Parse/CSV.pm)模块。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T22:24:14.443

正则表达式在这方面不是很好。考虑以下代码段：

> (a)b(c(d)e)

其中每个字母代表一个逗号（您的搜索目标）。根据您的问题，您只想匹配 comma `b`。诀窍是表达式通常要么贪婪要么不贪婪，没有中间立场。

一个贪婪的表达式会`(`在段的开头看到 the ，在最后看到 the`)`并取走其中的*所有内容*，而不管其他地方是否有右括号。*什么*都不会匹​​配。

一个不贪婪的表达式将只取最小的集合，从一开始就开始。它将匹配 comma `b`，但也将此段视为一个单元：`(c(d)`然后继续匹配 comma `e`。

有一些引擎可以让您计算嵌套级别，但表达式通常很难看且难以维护：除非您真正理解它，否则最好避免使用该功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T22:26:13.157

如果您知道您只会收到**一**对括号，那么这可能会起作用：

```
/(([^,]*\(.*\))|[^,]*)/g 
```

请记住，如果您有`)`杂项，或者您有多个需要解析的括号，这将失败。

# java - 将刚收到的变量作为参数转换的最优雅的方法是什么？

> ID：563109
> 
> 赞同：1
> 
> 时间：2009-02-18T22:17:44.740
> 
> 标签：java, graphics

更具体地说，在 paint() 调用中将 Graphics 对象转换为 Graphics2D 对象的最优雅方法是什么？

```
public void paint(Graphics g) {
    // How do I convert/cast/etc the g variable to a Graphics2D object?
} 
```

还是我错过了这里的重点？一般来说，有没有更好的方法来处理这个问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T22:21:28.707

```
Graphics2D g2 = (Graphics2D)g; 
```

没有必要幻想它。

您将始终在绘制方法中收到 G2D。

我什至喜欢调用`Graphics`参数`g2`，然后转换为`Graphics2D`命名`g`以使其使用更简单。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T22:23:52.960

据我所知，在这种情况下你无能为力。您可以在强制转换之前验证您是否确实获得了 Graphics2D 对象。但是，据我所知，无论如何你都可以得到任何东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T22:26:59.833

我个人喜欢

```
Graphics2D g2 = g as Graphics2D;
if (g2 == null)
//do stuff 
```

但如前所述，没有理由让它变得更复杂：P

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T22:30:53.473

它不直接相关，但在 Scala 中，他们认识到这种“不愉快” - 并鼓励您使用模式匹配来处理正确的类而不是强制转换：

```
g match { 
     case Graphics2D(g2d) => //code goes here !
     case _ => Nothing //or throw exception etc
} 
```

他们积极劝阻强制转换（没有特殊的强制转换语法，只有一种方法）。

与您不完全相关，但认为值得注意的是，其他人因困扰您的事情而烦恼；）

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-18T22:22:23.947

```
Graphics2D g2 = Graphics2D.class.cast(g); 
```

# jquery - 使用 JQuery 调用 WebMethod

> ID：563133
> 
> 赞同：11
> 
> 时间：2009-02-18T22:26:52.703
> 
> 标签：jquery, web-services, asmx

我无法从我的 JQuery 调用中进入我的 Search WebMethod。也许有人可以帮助我指出正确的方向。

我还将所有内容打包成一个 zip 文件，以防有人想仔细查看。

[http://www.filedropper.com/jsonexample](http://www.filedropper.com/jsonexample)

谢谢瑞恩

```
 <%@ Page Language="VB" AutoEventWireup="false" CodeFile="Default.aspx.vb" Inherits="_Default" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>JSON Example</title>
    <script type="text/javascript" language="JavaScript" src="jquery-1.3.1.min.js"></script>

<script type="text/javascript" language="javascript">

function Search() {
    var search = $("#searchbox").val();
    var options = {
        type: "POST",
        url: "Default.aspx/Search",
        data: "{text:" + search + "}",
        contentType: "application/json; charset=utf-8",
        dataType: "json",
        success: function(msg) {
            alert('Success!');
        }
    };
    $.ajax(options);
}
</script>

</head>
<body>
    <form id="form1" runat="server">
        <input type="text" id="searchbox" size="40" />
        <a href="#" onclick="Search()" id="goSearch">Search</a>
        <br />        
        <div id="Load" />
    </form>
</body>
</html> 
```

这是 default.aspx 背后的代码

```
 Imports System.Data
    Imports System.Web.Services
    Imports System.Web.Script.Serialization

    Partial Class _Default
        Inherits System.Web.UI.Page

        <WebMethod()> _
        Public Shared Function Search(ByVal text As String) As IEnumerable
            Return "test"
        End Function

    End Class 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-18T23:02:30.357

要解决这样的问题，首先要做的是在 Firebug 中观看。

如果您单击“搜索”链接并在 Firebug 的控制台中观看 POST 请求/响应，您会看到它抛出 500 服务器错误：无效的 JSON 基元。

原因是因为您的“数据”JSON 文字中的键/值标识符没有被引用。第 17 行应该是：

```
data: "{'text':'" + search + "'}", 
```

然后，一切都会按预期工作。

**注意：** 建议的数据 { test: search } 将*不起作用*。如果您为 jQuery 提供实际的 JSON 文字而不是字符串，它会将其转换为 test=search 和 POST 的键/值对而不是 JSON。这也将导致 ASP.NET AJAX ScriptService 或 PageMethod 引发 Invalid JSON Primitive 错误。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T22:38:31.053

您需要执行以下操作（C#）：

*   WebMethod 必须是`public static`
*   它必须用`[WebMethod]`属性装饰
*   您的 .aspx 页面上需要一个 ScriptManager
*   设置 ScriptManager 的`EnablePageMethods="true"`

这是一些示例 javascript：

```
$().ready(function() {
    $(yourDropDownList).change(LoadValues);
});

function LoadValues() {
    PageMethods.YourMethod(arg1, CallSuccess, CallFailed);
}

function CallFailed(result) {
    alert('AJAX Error:' + result.get_message());
}

function CallSuccess(result) {
    //do whatever you need with the result
} 
```

# .net - 我们如何在 64 位 Windows 服务器上运行 .NET 32 位应用程序？

> ID：563135
> 
> 赞同：3
> 
> 时间：2009-02-18T22:27:17.757
> 
> 标签：.net, web-applications, .net-2.0

我们正在我们的一台 64 位 Windows 服务器中安装第三方应用程序。该应用程序显然是使用设置为在运行时选择平台的编译器选项构建的。当我们运行应用程序时，它会给我们一个错误：

```
System.BadImageFormatException: is not a valid Win32 application. 
```

我在 MSDN 论坛上看到，为了修复这个错误，我必须将应用程序设置为 32 位，这样它就可以在 64 位服务器上正常运行。我查看其他 StackOverflow 链接[Other Posts](https://stackoverflow.com/questions/437271/running-c-app-32-bit-on-64-bit-machine)。

如何解决这种情况？对于所有想了解更多信息的人：

1.  该应用程序在 32 位测试服务器中运行良好。
2.  IIS 版本 6
3.  使用 SQL Server Express 2005
4.  在 Web 服务扩展上有两个 Framework64\v2.0.50727\aspnet_isapi.dll
5.  和 Framework\v2.0.50727\aspnet_isapi.dll

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T22:31:17.873

一种可能性是应用程序依赖于需要在 32 位模式下运行的非托管 DLL。由于默认的“AnyCPU”.NET 构建会自动检查平台，因此程序的 .NET 部分以 64 位模式启动。这将导致对仅 32 位非托管 DLL 的调用失败。

要修复它，您需要创建一个清单文件来告诉应用程序以 32 位模式运行。我自己从来不需要这样做，所以我无法提供说明，而且快速的谷歌搜索还没有（还）发现任何东西。

[更新]
看看这个链接是否有帮助：http:
[//msdn.microsoft.com/en-us/library/aa374191.aspx](http://msdn.microsoft.com/en-us/library/aa374191.aspx)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T22:31:35.127

我不确定这会有所帮助，但请查看：http:
[//msdn.microsoft.com/en-us/library/ms164699 (VS.80).aspx](http://msdn.microsoft.com/en-us/library/ms164699(VS.80).aspx)

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-18T22:35:08.567

The details of the question is a little confusing but I'll take a punt.

You need to the version aspnet_regiis.exe found in the Framework\v2.0.50727\ folder against the web site where this code is running

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-18T23:21:12.073

One thing that might work is making sure the .Net application is flagged as a true 32 bit application by changing the target CPU details.

In the *Visual Studio 2005* you can do this by going to the project *Properties* and in the *Build* section set the *Platform Target* to *x86* and not *Any APU* which is the default.

# c# - 将重复小数格式化为分数

> ID：563137
> 
> 赞同：2
> 
> 时间：2009-02-18T22:27:29.053
> 
> 标签：c#, string, formatting

我需要将十进制值转换为它们的小数等价物，类似于上[一个问题](https://stackoverflow.com/questions/379176/format-double-as-fraction)。

我使用答案之一中发布的代码作为起点，因为它主要完成我需要它做的事情。

```
string ToMixedFraction(decimal x) {
int whole = (int) x;
int denominator = 64;
int numerator = (int)( (x - whole) * denominator );

if (numerator == 0) 
{
    return whole.ToString();
}
while ( numerator % 2 == 0 ) // simplify fraction
{
    numerator /= 2;
    denominator /=2;
}
return string.Format("{0} {1}/{2}", whole, numerator, denominator);
} 
```

正如我所说，这段代码在大多数情况下都可以正常工作，但我需要采用常见的重复十进制值 (.3333333) 并将其显示为 1/3。

有谁碰巧知道这怎么可能？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-18T22:34:09.083

来自[http://mathforum.org/library/drmath/view/61579.html](http://mathforum.org/library/drmath/view/61579.html)

以重复部分的位数为分子，以相同位数重复9次并减少分数。

例如，0.3 重复与 3/9 相同。通过将两边除以 gcd（在本例中为 3）来减少，得到 1/3。

如果您可以从终止小数中提取重复小数，例如 0.133333333，您将需要做一些额外的数学运算。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T22:38:09.480

我在中学学到的技术：

```
x = 0.33333
10 x = 3.33333

10x - x = 3.3333 - .3333

9x = 3

x = 3 / 9

Reduce 3/9 to 1/3. 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T22:33:21.737

这是一个将浮点数转换为给定分母限制的最接近分数的配方：http: [//code.activestate.com/recipes/52317/](http://code.activestate.com/recipes/52317/)

# java - Log4J - 在调用 LogManager.getLogger() 时明确指定类名有什么意义吗？

> ID：563144
> 
> 赞同：2
> 
> 时间：2009-02-18T22:31:37.450
> 
> 标签：java, log4j

我正在处理一些遗留代码，其中包含很多代码，例如

```
private final Logger logger = LogManager.getLogger(ThisClassName.class); 
```

我想知道输入“ThisClassName.class”是否有任何优势，而不是

```
LogManager.getLogger(getClass()); 
```

据我所知，没有，但我想知道使用 getClass() 是否有任何负面影响。谢谢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-18T22:35:28.003

如果您正在制作`Logger` `static`，则无法使用`getClass()`。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T22:41:21.717

此外，如果存在实际调用该方法的子类，则 getClass() 将掩盖实际的类。例如，假设在类 A 的方法 X 中，您调用 log.debug() 并且类 B 扩展类 A，覆盖方法 X，但在某些时候调用 super.X。日志文件将显示 B 类，而不是 A 类。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T22:37:13.663

getClass() 在静态上下文中不起作用。ThisClassName.class 适用于静态和实例变量。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T23:17:39.307

我通常会使用`getClass()`带有实例变量的版本`Logger`（您没有*创建*另一个记录器实例，只是查找一个）。

这样做的原因是，在类层次结构中，了解您正在处理的事物的实际类型是很有用的，即使日志记录是在超类的方法中发生的。

通常一个简单的文本搜索会给你确切的日志语句被调用，所以我没有发现它在实践中令人困惑。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T10:13:22.943

其他发帖者已经评论说，如果你想定义一个 Logger，getClass 将不起作用`static`——并且为每个实例定义一个效率低下。

如果您想在运行时推断出正确的类，并且您至少使用 Java 5，请查看[log5j](http://code.google.com/p/log5j/)，它将 log4j 包装在 Java 5 API 中。

这使您可以编写如下内容：

```
private static final Logger log = Logger.getLogger(); 
```

乃至：

```
log.debug( "This thing broke: %s due to bar: %s on this thing: %s", foo, bar, car ); 
```

# .htaccess - 为什么我的 .htaccess 是 www。强制导致外部表单在没有 www. 的情况下失败。

> ID：563148
> 
> 赞同：1
> 
> 时间：2009-02-18T22:32:58.260
> 
> 标签：.htaccess, forms, submit, rewrite

由于奇怪的跨域 AJAX 问题，导致 AJAX 请求在不使用 www 时失败。（与请求通信的 PHP 处理程序是在相对路径中给出的，所以它不可能是地址问题或其他什么 - 这就是这个问题大约虽然），我已经强迫 www。使用 .htaccess ：

```
#enable rewrite engine and set options
Options +FollowSymLinks
RewriteEngine on

#only www.
RewriteCond %{HTTP_HOST} !^www.domain.com$
RewriteRule ^(.*)$ http://www.domain.com/$1 [R=301] 
```

这很好用。但是，我想允许其他网站管理员在他们的网站上发布我的表单之一，在他们的表单操作属性中使用我的表单 URL。这总是有效的，但是在我的 .htaccess 更改之后，表单仅在网站管理员添加 www 时提交。到动作值。没有万维网。该表格将不会被提交。

我应该如何更改我的 .htaccess 文件以确保在没有 www. 的情况下也提交这些表单？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T22:56:58.327

大多数浏览器在 301 Redirected 时不会转发 POST 数据...因此您会将这些请求视为您的操作 url 的 GET。

[这种行为在技术上是不合规的](http://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html#sec10.3.2)，但似乎是普遍接受的方法。

（参见[http://www.lassosoft.com/Documentation/TotW/index.lasso?9083](http://www.lassosoft.com/Documentation/TotW/index.lasso?9083)，[http://www.nkuttler.de/2008/11/09/mailman-and-301-redirects/](http://www.nkuttler.de/2008/11/09/mailman-and-301-redirects/)。）

也许为您的表单尝试 307 临时重定向？307具体指示浏览器重新POST数据。[http://en.wikipedia.org/wiki/List_of_HTTP_status_codes#3xx_Redirection](http://en.wikipedia.org/wiki/List_of_HTTP_status_codes#3xx_Redirection)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T00:15:45.860

你可以使用

```
RewriteCond %{REQUEST_METHOD} ^GET$ 
```

这将只重写 GET 请求，而使 POST 请求保持原样。

# c# - 如何解决 WMI 请求的“提供程序加载失败”？

> ID：563150
> 
> 赞同：9
> 
> 时间：2009-02-18T22:33:03.953
> 
> 标签：c#, .net, wmi

我正在使用 WMI 收集系统信息。它在我测试过的每个系统上都能正常工作，但我有一两个用户报告了问题。调试日志显示 WMI 代码正在引发“提供程序加载失败”异常。我无法复制这个问题。

用户已验证 WMI 服务正在自动模式下运行。

这是一个例外：

```
System.Management.ManagementException: Provider load failure 
   at System.Management.ManagementException.ThrowWithExtendedInfo(ManagementStatus errorCode)
   at System.Management.ManagementObjectCollection.ManagementObjectEnumerator.MoveNext() 
```

关于如何解决和解决此问题的任何想法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2013-02-25T15:09:41.627

可能追查问题根本原因的一种方法是使用[WBEMTest](http://technet.microsoft.com/en-us/library/cc180684.aspx)一种工具，MS Scripting Guys 说这是最简单的方法之一

> “要查找 WMI 类的提供者……”

脚本专家：[使用 PowerShell 解决“提供程序加载失败”</a>](http://blogs.technet.com/b/heyscriptingguy/archive/2012/09/12/use-powershell-to-troubleshoot-provider-load-failure.aspx)

[](http://blogs.technet.com/b/heyscriptingguy/archive/2012/09/12/use-powershell-to-troubleshoot-provider-load-failure.aspx)

[特定于 Win32_NetworkAdapter 的高级步骤在 infoSupport 的 Mark Wolzak 的这篇](http://blogs.technet.com/b/heyscriptingguy/archive/2012/09/12/use-powershell-to-troubleshoot-provider-load-failure.aspx)[Win32_network 适配器“提供程序加载失败”](http://blogs.infosupport.com/win32_network-adapter-provider-load-failure/)帖子中进行了描述。

*   点击开始>>运行>> wbemtest
*   单击“连接...”以连接到命名空间
*   执行查询'Select * From MSFT_WmiSelfEvent'
*   向下滚动到底部并跟踪以下 WMI 事件
*   查看导致问题的 dll 的任何 Msft_WmiProvider_InitializationOperationFailureEvent 或 Msft_WmiProvider_LoadOperationFailureEvent 的详细信息

感谢Richard Siddaway 博客上的[WMI–Provider Load Failure帖子向我指出了这个工具和具体的方法。](http://msmvps.com/blogs/richardsiddaway/archive/2011/03/13/wmi-provider-load-failure.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-03-02T21:51:24.373

在具有用户帐户控制的操作系统上关闭 UAC。

就我而言：罗斯的回答没有解决。我可以加载一些 WMI 提供程序（逻辑磁盘），但不能加载其他（IIS）。WMI 资源管理器工具（如 PowerGui）将显示提供程序。这表明安全策略可以阻止加载 WMI 提供程序。关闭 UAC 后，所有 WMI 提供程序都已正确加载。

当然，您可能希望打开 UAC。如果我找到所需的具体政策，我会更新这个答案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-08-06T18:37:04.010

所以，我知道这很旧，但我遇到了上面描述的确切问题。我真的很难弄清楚，所以我想我会做出回应，希望它可以帮助别人。

我试图加载 IIS WMI 提供程序并收到“提供程序加载失败”错误。我可以通过使用 wbemtest.exe 程序运行我的 WMI 查询来重现该问题。

我启动了 procmon.exe 以显示正在加载的内容（或在我的情况下无法加载），果然，wmiprvse.exe 正在加载一个注册表项，它说 inetsrv 位于 C:\windows 目录中 - 它没有存在于我的机器上（C:\windows 已被 c:\winnt 取代）

更新密钥解决了我的问题，但更重要的一点是，我有一段时间试图弄清楚为什么会出现此错误，并且在执行 WMI 查询时运行 procmon 将我指出了问题所在。希望它也适合你。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T23:02:08.877

您可能想要确认所有 dll 都已正确注册（请参阅[http://msdn.microsoft.com/en-us/library/bb961987.aspx](http://msdn.microsoft.com/en-us/library/bb961987.aspx)）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T15:28:43.553

WMI 注册全部在 WMI（静态类。

WMI CIM Studio（MS，IIRC 的 WMI 工具的一部分）对于探索这些类很有用（当然比编写大量查询更容易）。

# php - socket_create 与 fsockopen php

> ID：563153
> 
> 赞同：16
> 
> 时间：2009-02-18T22:33:34.857
> 
> 标签：php, sockets, udp

我目前使用的托管服务不允许我使用套接字，这可能是出于他们的充分理由。但是，他们确实让我使用*fsockopen*。我想知道有什么区别，因为某些与*socket_create*甚至*stream_socket_server*一起使用的脚本不能与*fsockopen*一起使用。也就是说，如果*fsockopen*应该工作，我的代码在下面列出。它的作用是在自己的 IP 地址上侦听传入的 udp 数据包并读取它们。

谢谢

```
$sock = fsockopen("udp://x.x.x.x", $port);
while(1)
{
    $buf = fread($sock, 200);
    flush();
    ob_flush();
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-02-18T22:44:13.990

[fsockopen](http://ca.php.net/manual/en/function.fsockopen.php)创建到主机的连接，而不是侦听套接字。

fsockopen($address) ~== [socket_connect](http://ca.php.net/manual/en/function.socket-connect.php) ( [socket_create](http://ca.php.net/manual/en/function.socket-create.php) (), $address)

您的托管服务提供商不希望您监听备用端口/协议。

如果你有什么工作，我不会指望它总是工作，因为这将是一个错误。

# c# - 您如何指定特定的 Group 3 tiff 压缩？

> ID：563156
> 
> 赞同：6
> 
> 时间：2009-02-18T22:34:22.360
> 
> 标签：c#, drawing, tiff, imaging

第 3 组压缩有 2 种变化（第 3 组 1D 和第 3 组 2D）。以 Tiff 格式保存图像时，EncoderValue 枚举中的 Group 3 只有一个选项。是否有一个单独的参数来控制它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-19T18:04:55.353

是的。第 3 组压缩（更准确地说是 CCITT T.4）最常见的用途是用于传真图像。在这种情况下，图像定义为双层（1 位）图像，预计会进行 1D 压缩。因此，如果您除了将压缩值（标签 259）设置为“2”（对于双层图像）之外什么都不做，那么它被理解为 G3 1 维（修改后的霍夫曼）编码。唯一的其他选项是无压缩 (1) 和打包位 (32773)。*基线阅读器应该*支持所有三种编码类型，但根据我的经验，许多阅读器不能正确支持 Group III 压缩，尤其是 G32D。

G31D 比 G32D 更容易实现，但效率不高。G31D 单独存储每条扫描线，而 G32D 存储扫描线之间的差异。这可能会对定义图像所需的数据量产生巨大影响，例如典型的传真图像，其中大部分图像是空白白纸。

如果要使用 G3 二维编码，则必须在标签中更具体。您必须使用 CCITT 编码来指示 T4 压缩编码（CCITT T.4 是“Group 3”编码标准的“真实”名称）。要表明这一点，请设置标签 259 == 3。然后设置 T4 选项以指定二维编码。与标准压缩 (259) 标签等简单标签相比，T4 选项标签（标签 292）有点棘手。它是用作一组 32 位标志的 LONG 类型。如果您将所有位设置为零，则默认情况下会理解一维编码（与不包括此标签没有什么不同）。

对于二维编码，您必须将第 0 位（低位）设置为 1。（如果您使用多个条带，则每个条带显然必须以一维扫描线开始。）只有在以下情况下才将第 1 位设置为 1使用未压缩模式。位 2 用于指示您是否使用填充位将 EOL 保持在字节边界上（如果为真，则设置为 1）。所有其他位默认为零。

请记住，大多数读者无法理解 TIFF 中可用的所有选项。它是一种非常强大的格式，但是在基线 TIFF（可能处理 90% 以上的 TIFF 图像）之外实现起来很棘手。如果您使用第 3 组 2 维编码，您可以预期大多数专门支持传真图像和医学图像* 的阅读器都能正确解码图像。我不希望有更多。

（*TIFF 不是标准的医学图像格式，但根据我的经验，支持 DICOM 图像和 TIFF 图像的读者通常支持完整的 TIFF 标准*）

这个答案比我预期的要长。如果我仍然没有回答您的问题，请在您的原始帖子中澄清，我将编辑我的答案。

编辑：您可以在 Adob​​e 开发人员网站上找到 TIFF 标准和其他支持文档。[http://partners.adobe.com/public/developer/tiff/index.html](http://partners.adobe.com/public/developer/tiff/index.html)

# c# - System.Web.Services.Protocols.SoapException：服务器无法处理请求。---> System.ArgumentNullException

> ID：563162
> 
> 赞同：3
> 
> 时间：2009-02-18T22:35:45.443
> 
> 标签：c#, web-services

我一直收到错误：

System.Web.Services.Protocols.SoapException：服务器无法处理请求。---> System.ArgumentNullException

当我尝试使用以下代码调用我的网络服务时：

```
{
//Create an echoSync request - set the services.
ServiceNameType sourceService = new ServiceNameType {Service = "echoSync", OnBehalfOf = "Source"};
ServiceNameType destService = new ServiceNameType {Service = "echoSync", OnBehalfOf = "Destination"};

//Create the request.
SDD2RequestType request = new SDD2RequestType
                  {
                      AppId = "echoSync",
                      SourceService = sourceService,
                      DestService = destService,
                      RequestId = "1",
                      RequestBody = "Ping"
                  };

//Create the originator.
originator originator = new originator {id = "123456789"};

//Create the transport.
SDD2Transport transport = new SDD2Transport {originatorValue = originator};

//Send the request.
SDD2ResponseType response = null;
response = transport.SDD2TransportOp(request);

//Write out the response.
System.Console.WriteLine(response.ResponseBody.ToString());
} 
```

我的 webservice 方法很简单，看起来像这样：

```
 [System.Web.Services.Protocols.SoapHeaderAttribute("originatorValue", Direction = System.Web.Services.Protocols.SoapHeaderDirection.InOut)]
    [System.Web.Services.WebMethodAttribute()]
    [System.Web.Services.Protocols.SoapDocumentMethodAttribute("http://memberdirect.net/SDD2/Transport", RequestElementName = "SDD2Transport", RequestNamespace = "http://cucbc.com/sdd2/transport/", ResponseElementName = "SDD2TransportResponse", ResponseNamespace = "http://cucbc.com/sdd2/transport/", Use = System.Web.Services.Description.SoapBindingUse.Literal, ParameterStyle = System.Web.Services.Protocols.SoapParameterStyle.Default)]
    [return: System.Xml.Serialization.XmlElementAttribute("SDD2Response", Namespace = "http://cucbc.com/sdd2/")]
    public override SDD2ResponseType SDD2TransportOp(SDD2RequestType SDD2Request)
    {
        if (SDD2Request == null) throw new ArgumentNullException("SDD2Request");
        var response = new SDD2ResponseType();

        switch (SDD2Request.AppId)
        {
            case "echoSync":
                response.AppId = SDD2Request.AppId;
                response.ProcessingStatus = ProcessingStatusType.Complete;
                response.RequestId = SDD2Request.RequestId;
                response.ResponseBody = "Pong";
                break;
            default:
                throw new System.NotImplementedException();
                break;
        }

        return response;
    } 
```

当我拨打电话时，我知道请求不是 NULL，但是当它到达 web 服务时，它总是被接收为 null。我使用 wsdl.exe 实用程序从 WSDL 生成了 Web 服务，显然我不了解我应该了解的 SOAP 的所有细节。有没有其他人遇到过这个问题？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T22:50:22.337

我不知道是什么原因造成的，所以这不是您问题的答案，而只是对进一步研究问题的方法的建议

尝试使用嗅探器查看机器之间发送的实际数据，并找出问题出在哪一边。我曾经成功使用过一次[Wireshark](http://www.wireshark.org/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-11-26T09:07:31.763

I had the same problem, although the cause might be different. When I stepped through my code in the debugger, the method argument went from being an instance to a null.

For the record it was caused by the RequestElementName being different to the method name. There may be other influencing factors but when I either removed the RequestElementName attribute from the method definition or I made it the same as the method name, the problem with the null argument disappeared.

For example, your code has RequestElementName = "SDD2Transport" and method name SDD2TransportOp.

Now I don't know why this should be a problem, especially as you also have: ParameterStyle = System.Web.Services.Protocols.SoapParameterStyle.Default, not Wrapped, which implies that the ElementName will not be used anyway.

I wonder if this is a bug in the .NET SOAP client protocol class because what happens is that although the correct method is called in the web service (because it is identified in the SOAP Action header), the arguments do not get deserialized.

In my case I had to edit the generated C# class every time I recreated it in order to remove the RequestElementName attributes. Note that I had no control over the source WSDL as it was supplied by a 3rd party.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T23:16:27.500

我没有机会按照 Configurator 的建议使用 Wireshark，但我能够通过在解决方案资源管理器中更新 Web 参考来解决此问题。

在与它搏斗了一个多小时后，我找到了一个如此简单的解决方案，我有点懊恼，但我希望这篇文章能帮助那里的人。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T13:43:46.010

“参数被接收为空”几乎总是意味着服务器期望的限定名称与客户端发送的限定名称之间存在差异。XML 限定名称由名称空间和本地名称组成。这通常意味着命名空间在客户端是不正确的，尽管我已经看到一个关于名称不同的报告。

无论如何，您已经找到了该问题的#1 解决方案 - “更新 Web 参考”。

# linux - VPS托管和root访问

> ID：563163
> 
> 赞同：1
> 
> 时间：2009-02-18T22:35:50.593
> 
> 标签：linux, hosting, virtualization, vps

我对 *nix 虚拟化功能知之甚少，并试图澄清一件事。如果一个人在主机上拥有 root 权限，是否总是意味着他在该主机的所有虚拟机上都拥有 root 权限？如果是，那么是否存在不正确的虚假设置？

我在问，因为我从两个不同的管理员那里听到了对该问题的两个不同的答案。一个人说他对一切都有根，另一个人声称他没有，他需要我的密码。

请分享您与 VPS 托管服务提供商的经验，他们是否与您的环境有渊源？

* * *

不是我害怕丢失数据，只是想对谷歌有一些见解和文字;-) 谢谢大家！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T22:51:48.090

最终，在 VM 主机上拥有 root 权限与对普通机器进行物理访问是一样的。他们不能只是以 root 身份“登录”到 VM（嗯，你可以使用一些虚拟化技术，如 OpenVZ），但他们可以进入 VM 的文件系统，更改 root 密码（或安装一些东西来捕获密码）然后从那里。

您需要对您的 VPS 托管服务提供商拥有与您的托管服务提供商完全相同的信任，因为它们具有完全相同的访问级别和对您的服务做坏事的能力。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T08:50:15.513

对于使用基于 OpenVZ 的 Virtuozzo 的 VPS 提供商，主机的根目录确实可以访问整个文件系统（甚至是访客的）。并使用一个简单的命令，例如

```
vzctl 输入 <VM_ID>
```

他们获得了根，几乎可以做任何他们喜欢的事情。

我同意 womble 提到的信任。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-03-08T11:21:28.343

在 vps 托管或简单 vps 中，它们为您提供了一个界面，您可以在其中监控您的 vps，并有一些选项，如重新启动、关闭、安装 windows。这取决于您购买的公司。您几乎可以访问您的 vps，只需打开 putty并通过提供 vps 的 IP 地址连接到 vps 并准备就绪

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T23:01:41.670

您似乎对虚拟化的工作原理有些困惑。考虑您的问题是否如下：

“如果我让某人坐在我的电脑前，他们有 root 访问权限吗？”

虚拟机基本上只是“代表”该机器的图像。从概念上讲，这与您拥有由托管服务提供商控制的自己的物理机没有什么不同。

一种例外情况可能取决于提供商的设置过程。他们是否要求您提供初始 root 密码来设置您的 VPS？如果是这样，他们可以记录下来，但是一旦您第一次登录到您的环境，如果您更改它，他们应该不再了解它。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-18T22:44:44.503

1.  如果您更改了 root 密码并且不将其提供给任何人，那么您是唯一可以以 root 身份登录的人。

2.  如果有人曾经有过您的 root 密码，那么很难（几乎不可能）知道他们没有在系统上放置某种后门来允许他们通过任意数量的机制重新获得权限。那个“某人”可能是您主机上设置您的 VPS 的技术人员，也可能是其他任何人。

3.  仅仅因为某人拥有主机的 root 密码，并不意味着他们拥有您的虚拟机的 root 密码 - 但是，这可能确实意味着他们可以以各种痛苦的创造性方式对您做出卑鄙的、讨厌的事情（更改你的文件系统的内容......大概他们甚至可以将你的root密码更改为他们知道的东西。）

# c++ - 在 Linux 中监控程序的内存使用情况

> ID：563168
> 
> 赞同：12
> 
> 时间：2009-02-18T22:37:56.420
> 
> 标签：c++, linux, memory

Linux 中是否有可用的工具以图形或文本方式显示程序的内存使用情况？例如，如果我编写一个 C++ 程序并想验证对象是否在内存中正确分配和解除分配，是否有可用的应用程序可以直观地显示正在实例化和删除的对象？当我过去在 Visual Studio 中编程时，我记得单步执行程序并使用调试窗格来监视内存使用情况，并且正在寻找与 Linux 中类似的东西。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T22:41:07.320

这不完全是您正在寻找的，但看看[Valgrind](http://valgrind.org/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-18T22:42:44.600

我通常运行**top**以关注整体内存使用情况。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-03-24T18:48:02.590

```
while (/proc/<pid>/status)
 echo "VMSize: `ps -p <pid> -o vsize=`" >> ! mem.out
 pstack <pid> >> mem.out
 sleep 10
end 
```

`grep VMSize mem.out | awk -F':' '{print $2}' | sort -r -n | head -1`会给你峰值记忆。

还可以使用 mem.out 查看内存占用和当前堆栈相关性。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-20T08:22:38.833

在支持虚拟内存的操作系统上，很难计算出一个进程正在使用多少内存。

问题不在于它使用了多少内存，而在于其中有多少是私有的，有多少是共享的。

您可以查看 /proc/pid/maps 或 /proc/pid/smaps （也许）。这些文件只会告诉您进程映射到其地址空间的内存量，而不是它正在使用的内存量，绝对不会告诉您与系统中的其他进程共享多少内存。

甚至“私有”映射也可以共享，因为 fork() 确实会在写入时复制，因此私有页面仍然可以与其他一些（相关的 - 通常是父级或兄弟级）进程共享。此外，已映射但从未使用过的页面根本不会占用空间。

可以看到每个映射的 RSS（驻留集大小），但这仅告诉您驻留的数量（在 RAM 中，而不是换出到交换文件中，尚未分配，或尚未从映射中按需加载）文件），现在共享多少以及与什么共享。

我想你最好的选择是计算私人匿名内存的数量，在某些情况下这可能没问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-10-19T14:22:55.787

1) 第一次运行

```
ps -u <your user id> 
```

2) 从 1) 的输出中获取要监控的进程的 et pid

3）然后运行

```
top -p <the pid of the process you want to monitor> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T23:26:11.627

conky ( [screenshots](http://conky.sourceforge.net/screenshots.html) ) 是一个很棒的简单计算机资源查看器，可以在桌面墙纸上发布。我密切关注内存使用和特定程序的使用。

# php - WAMP 上 phpThumb 的配置问题

> ID：563174
> 
> 赞同：0
> 
> 时间：2009-02-18T22:40:41.050
> 
> 标签：php, image, wamp, phpthumb

我无法让 phpThumb 在 WAMP 上生成缩略图。问题似乎是源图像的路径构造不正确，如以下调试信息所示：

> 调试 phpThumb：ResolveFilenameToAbsolute() 将 $this->config_document_root (C:\Projects\WordPressTest\Site\wp-content\plugins\yet-another-photoblog) 附加到 $filename (/wordpresstest/wp-content/uploads/2009/02 /valentine-2-010.jpg) 导致 ($AbsoluteFilename = "C:\Projects\WordPressTest\Site\wp-content\plugins\yet-another-photoblog/wordpresstest/wp-content/uploads/2009/02/valentine -2-010.jpg") 在第 1023 行的文件“phpthumb.class.php”中

正确的路径是：

```
C:\Projects\WordPressTest\Site\wp-content\uploads\2009\02\valentine-2-010.jpg 
```

我怀疑这与 phpThumb 的配置有关。任何人都可以帮忙吗？

谢谢，

缺口

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-24T20:48:07.620

我在一个项目中经历过类似的事情，并找到了使用所有 '/' -vs- '\' 的解决方案（我不知道为什么或如何......但解决了我的问题）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-22T12:28:44.420

显然 phpThumb 不喜欢在 Windows 上以别名运行。为了解决这个问题，我改为在文档根目录中运行我的网站。

# python - 使用 MySQLdb 从 Python 中的 MySQL 存储过程获取返回值

> ID：563182
> 
> 赞同：7
> 
> 时间：2009-02-18T22:42:25.083
> 
> 标签：python, mysql

我在 MySQL 数据库中有一个存储过程，它只是更新日期列并返回前一个日期。如果我从 MySQL 客户端调用这个存储过程，它可以正常工作，但是当我尝试使用 MySQLdb 从 Python 调用存储过程时，我似乎无法让它给我返回值。

这是存储过程的代码：

```
CREATE PROCEDURE test_stuff.get_lastpoll()
BEGIN
    DECLARE POLLTIME TIMESTAMP DEFAULT NULL;
    START TRANSACTION;

    SELECT poll_date_time
      FROM test_stuff.poll_table
      LIMIT 1 
      INTO POLLTIME
    FOR UPDATE;

    IF POLLTIME IS NULL THEN
        INSERT INTO 
               test_stuff.poll_table 
               (poll_date_time)
        VALUES 
               ( UTC_TIMESTAMP() );

        COMMIT;
        SELECT NULL as POLL_DATE_TIME;
    ELSE
        UPDATE test_stuff.poll_table SET poll_date_time = UTC_TIMESTAMP();
        COMMIT;
        SELECT DATE_FORMAT(POLLTIME, '%Y-%m-%d %H:%i:%s') as POLL_DATE_TIME;
    END IF;
END 
```

我用来尝试调用存储过程的代码类似于：

```
#!/usr/bin/python

import sys
import MySQLdb

try:
    mysql = MySQLdb.connect(user=User,passwd=Passwd,db="test_stuff")
    mysql_cursor = mysql.cursor()

    results=mysql_cursor.callproc( "get_lastpoll", () )
    print results

    mysql_cursor.close()
    mysql.close()

except MySQLdb.Error, e:
    print "MySQL Error %d:  %s" % ( e.args[0], e.args[1] )
    sys.exit(1) 
```

我知道你可以做 IN 和 OUT 参数，但是从我可以从 MySQLdb 文档中确定的，这对于 MySQLdb 是不可能的。有谁知道我如何获得存储过程的结果？

如果我从 SQL 工具运行它，输出如下：

```
POLL_DATE_TIME       
-------------------  
2009-02-18 22:27:07 
```

如果我运行 Python 脚本，它会返回一个空集，如下所示：

```
() 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-19T17:11:44.107

我要做的是修改 Python 代码以使用 execute() 而不是 callproc()，然后使用 fetchone() 来获取结果。我自己回答，因为 mluebke 的回答并不完全完整（尽管它很有帮助！）。

```
mysql_cursor.execute( "call get_lastpoll();" )
results=mysql_cursor.fetchone()
print results[0] 
```

这给了我正确的输出：

```
2009-02-19 17:10:42 
```

有关, 等的高级用法，请参阅[https://stackoverflow.com/a/52715128/2391795 。](https://stackoverflow.com/a/52715128/2391795)`fetchone``fetchall`

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-06-19T20:19:55.027

`callproc`也可以正常工作，您不需要使用`execute`：

```
mysql_cursor.callproc( "get_lastpoll", () )
result = mysql_cursor.fetchone() 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-02-18T23:05:57.087

您仍然需要获取结果。

```
results = cursor.fetchone() 
```

或者

```
results = cursor.fetchall() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-10-13T04:53:55.667

来自`MySQLdb`库的 API 文档。您需要先调用`cursor_obj.nextset()`，然后才能看到存储过程返回的结果集。这是因为对存储过程的调用会创建一个结果集。存储过程返回的结果集如下。

[更多信息](http://mysql-python.sourceforge.net/MySQLdb-1.2.2/public/MySQLdb.cursors.BaseCursor-class.html#callproc)

# c# - C# 管理窗口事件

> ID：563185
> 
> 赞同：1
> 
> 时间：2009-02-18T22:42:44.630
> 
> 标签：c#, windows

我想使用 C# 从 Windows 事件日志中删除一个事件。

谁能指出我如何实现这一目标的正确方向？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T00:10:11.753

简单的 ：）。
但是删除看起来像**从数组中删除项目**，您需要复制所有数组，除了您需要删除的项目。
有一个例子，如何“从日志中删除每个项目，其中项目具有非偶数索引”。

```
using System;
using System.Collections;
using System.Diagnostics;
using System.Threading;

class EventLogEntryCollection_Item
{
    /// <summary>
    /// Prints all.
    /// </summary>
    /// <param name="myEventLogEntryCollection">My event log entry collection.</param>
    private static void PrintAll(EventLogEntryCollection myEventLogEntryCollection)
    {
        for (int i = 0; i < myEventLogEntryCollection.Count; i++)
        {
            Console.WriteLine("The Message of the EventLog is :"
               + myEventLogEntryCollection[i].Message);
        }
    }

    /// <summary>
    /// Creates the new log message.
    /// </summary>
    /// <param name="LogName">Name of the log.</param>
    /// <param name="message">The message.</param>
    private static void CreateNewLogMessage(string LogName, string message)
    {
        EventLog myEventLog = new EventLog();
        myEventLog.Source = LogName;
        myEventLog.WriteEntry(message);
        myEventLog.Close();
    }

    /// <summary>
    /// Mains this instance.
    /// </summary>
    public static void Main()
    {
        try
        {

            // Check if the source exists.
            if (!EventLog.SourceExists("MySource"))
            {
                // Create the source.
                // An event log source should not be created and immediately used.
                // There is a latency time to enable the source, it should be created
                // prior to executing the application that uses the source.
                EventLog.CreateEventSource("MySource", "MySource");
                Console.WriteLine("Creating EventSource");
                Console.WriteLine("Exiting, execute the application a second time to use the source.");
                Thread.Sleep(2000);
                // The source is created.  sleep to allow it to be registered.
            }

            string myLogName = EventLog.LogNameFromSourceName("MySource", ".");

            // Create a new EventLog object.
            EventLog myEventLog1 = new EventLog();
            myEventLog1.Log = myLogName;

            //Create test messages.
            myEventLog1.Clear();
            for (int i = 0; i < 20; i++)
            {
                CreateNewLogMessage("MySource", "The entry number is " + i);
            }

            // Obtain the Log Entries of "MyNewLog".
            EventLogEntryCollection myEventLogEntryCollection =
               myEventLog1.Entries;
            //myEventLog1.Close();
            Console.WriteLine("The number of entries in 'MyNewLog' = "
               + myEventLogEntryCollection.Count);

            // Copy the EventLog entries to Array of type EventLogEntry.
            EventLogEntry[] myEventLogEntryArray =
               new EventLogEntry[myEventLogEntryCollection.Count];
            myEventLogEntryCollection.CopyTo(myEventLogEntryArray, 0);

            Console.WriteLine("before deleting");
            // Display the 'Message' property of EventLogEntry.
            PrintAll(myEventLogEntryCollection);

            myEventLog1.Clear();

            Console.WriteLine("process deleting");
            foreach (EventLogEntry myEventLogEntry in myEventLogEntryArray)
            {
                //Console.WriteLine("The LocalTime the Event is generated is "
                // + myEventLogEntry.TimeGenerated + " ; " + myEventLogEntry.Message);
                if (myEventLogEntry.Index % 2 == 0)
                {
                    CreateNewLogMessage("MySource", myEventLogEntry.Message);
                }
            }

            Console.WriteLine("after deleting");
            PrintAll(myEventLogEntryCollection);

            myEventLog1.Close();
        }
        catch (Exception e)
        {
            Console.WriteLine("Exception:{0}", e.Message);
        }
        Console.ReadKey();
    }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T22:44:41.693

我不相信您可以从事件日志中删除一个特定事件。要么全有，要么全无。如果你想摆脱一个，你必须清除整个日志。

编辑：你唯一能做的就是[清除日志](http://msdn.microsoft.com/en-us/library/system.diagnostics.eventlog.clear.aspx)。好吧，你可以从计算机中删除整个日志，如果它不是安全、应用程序或系统，但你绝对不能删除一个条目。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T22:48:01.780

我不认为这是可能的。查看[System.Diagnostics](http://msdn.microsoft.com/en-us/library/system.diagnostics.aspx)命名空间和 EventLog* 类以获取更多文档。

# objective-c - 在 Objective-C 2.0 截屏视频中编码？

> ID：563188
> 
> 赞同：4
> 
> 时间：2009-02-18T22:44:07.530
> 
> 标签：objective-c

有没有人在 Objective-C 2.0 中使用 Pragmatic Programmers 截屏系列[编码](http://pragprog.com/screencasts/v-bdobjc/coding-in-objective-c-2-0)？

它们看起来不错，但我不知道我是否可以从教科书或其他网络链接中获得同样多的价值。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T03:40:30.547

我买了两个屏幕演员。我既不是一个挨饿的学生，也不是一个饿死的开发者，所以 5 美元实际上是免费的。

屏幕演员可以相当快地覆盖材料，因为没有必要停下来描述正在发生的事情。观众可以看到每一步。书中没有你发现必须用文字来详细描述每一步的尴尬。

所以是的，我发现它们值 5 美元，我会买更多的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T23:44:00.617

5.00 美元的视频，你不会找到“从教科书中获得同样多的价值”的书籍，但会涵盖更多信息。

编辑：

我没有看过屏幕截图，但如果你有编程经验，买一本书（甚至是他们的书？）将是我推荐的。只看所涵盖的主题和给定的时间，我看不到屏幕投射（我的意思是两个可用的）进入这么多细节

# sorting - 我可以有一个随机块和一个排序页面吗？

> ID：563189
> 
> 赞同：0
> 
> 时间：2009-02-18T22:44:08.607
> 
> 标签：sorting, drupal, drupal-views, drupal-blocks, drupal-5

我一直遇到同样的问题，我觉得我正在以笨拙的方式解决它。你有更好的解决方案吗？

我有一个内容类型为“Staff Bios”的网站。我创建了一个按字母顺序列出所有简历的视图页面。我想要一个只显示一个生物的块（如侧边栏预告片），并且我希望选择显示的生物是随机的。

我一直在创建 2 个单独的视图，一个带有 sort = node>title 的页面，一个带有 sort = random 的块。但这似乎很蹩脚。

想法？谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T22:56:25.143

不，这在 Drupal 5 / Views 1 中是不可能的[*]。

使用 Drupal 6 / Views 2，您可以选择创建多个视图“显示”，每个视图都可以自定义排序（除其他外）。

[*] 好吧，从技术上讲，你/可以/做到这一点，通过创建一个实现新“视图类型”的模块，该模块在显示它们之前随机化行（并为块选择它，为页面选择普通视图类型） ，但我鼓励您转而努力将您的网站升级到 Drupal 6。

# c# - 按 Enter 键绑定文本框

> ID：563195
> 
> 赞同：117
> 
> 时间：2009-02-18T22:44:51.380
> 
> 标签：c#, wpf, xaml, .net-3.5, textbox

默认的数据绑定`TextBox`是，它仅在失去焦点`TwoWay`时才将文本提交给属性。`TextBox`

`Enter`当我按下 ?上的键时，是否有任何简单的 XAML 方法可以使数据绑定发生`TextBox`。我知道在后面的代码中很容易做到，但想象一下，如果这`TextBox`是在一些复杂`DataTemplate`的 .

* * *

## 回答 #1

> 赞同：148
> 
> 时间：2009-02-19T10:26:15.300

您可以通过创建[附加行为](http://www.codeproject.com/KB/WPF/AttachedBehaviors.aspx)使自己成为纯 XAML 方法。

像这样的东西：

```
public static class InputBindingsManager
{

    public static readonly DependencyProperty UpdatePropertySourceWhenEnterPressedProperty = DependencyProperty.RegisterAttached(
            "UpdatePropertySourceWhenEnterPressed", typeof(DependencyProperty), typeof(InputBindingsManager), new PropertyMetadata(null, OnUpdatePropertySourceWhenEnterPressedPropertyChanged));

    static InputBindingsManager()
    {

    }

    public static void SetUpdatePropertySourceWhenEnterPressed(DependencyObject dp, DependencyProperty value)
    {
        dp.SetValue(UpdatePropertySourceWhenEnterPressedProperty, value);
    }

    public static DependencyProperty GetUpdatePropertySourceWhenEnterPressed(DependencyObject dp)
    {
        return (DependencyProperty)dp.GetValue(UpdatePropertySourceWhenEnterPressedProperty);
    }

    private static void OnUpdatePropertySourceWhenEnterPressedPropertyChanged(DependencyObject dp, DependencyPropertyChangedEventArgs e)
    {
        UIElement element = dp as UIElement;

        if (element == null)
        {
            return;
        }

        if (e.OldValue != null)
        {
            element.PreviewKeyDown -= HandlePreviewKeyDown;
        }

        if (e.NewValue != null)
        {
            element.PreviewKeyDown += new KeyEventHandler(HandlePreviewKeyDown);
        }
    }

    static void HandlePreviewKeyDown(object sender, KeyEventArgs e)
    {
        if (e.Key == Key.Enter)
        {
            DoUpdateSource(e.Source);
        }
    }

    static void DoUpdateSource(object source)
    {
        DependencyProperty property =
            GetUpdatePropertySourceWhenEnterPressed(source as DependencyObject);

        if (property == null)
        {
            return;
        }

        UIElement elt = source as UIElement;

        if (elt == null)
        {
            return;
        }

        BindingExpression binding = BindingOperations.GetBindingExpression(elt, property);

        if (binding != null)
        {
            binding.UpdateSource();
        }
    }
} 
```

然后在您的 XAML 中将`InputBindingsManager.UpdatePropertySourceWhenEnterPressedProperty`属性设置为您想要在`Enter`按下键时更新的属性。像这样

```
<TextBox Name="itemNameTextBox"
         Text="{Binding Path=ItemName, UpdateSourceTrigger=PropertyChanged}"
         b:InputBindingsManager.UpdatePropertySourceWhenEnterPressed="TextBox.Text"/> 
```

（您只需要确保在 XAML 文件的根元素中包含“b”的 xmlns clr-namespace 引用，指向您将 InputBindingsManager 放入的任何命名空间）。

* * *

## 回答 #2

> 赞同：62
> 
> 时间：2012-11-08T12:26:37.530

这就是我解决这个问题的方法。我创建了一个特殊的事件处理程序，它进入了后面的代码：

```
private void TextBox_KeyEnterUpdate(object sender, KeyEventArgs e)
{
    if (e.Key == Key.Enter)
    {
        TextBox tBox = (TextBox)sender;
        DependencyProperty prop = TextBox.TextProperty;

        BindingExpression binding = BindingOperations.GetBindingExpression(tBox, prop);
        if (binding != null) { binding.UpdateSource(); }
    }
} 
```

然后我只是将其添加为 XAML 中的 KeyUp 事件处理程序：

```
<TextBox Text="{Binding TextValue1}" KeyUp="TextBox_KeyEnterUpdate" />
<TextBox Text="{Binding TextValue2}" KeyUp="TextBox_KeyEnterUpdate" /> 
```

事件处理程序使用它的`sender`引用来更新它自己的绑定。由于事件处理程序是自包含的，因此它应该在复杂的 DataTemplate 中工作。现在可以将这一事件处理程序添加到需要此功能的所有文本框中。

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2009-02-18T22:55:20.670

我不相信有任何“纯 XAML”方式来做你所描述的事情。您可以通过设置[UpdateSourceTrigger](http://msdn.microsoft.com/en-us/library/system.windows.data.binding.updatesourcetrigger.aspx)属性设置绑定，以便在 TextBox 中的文本更改时（而不是在 TextBox 失去焦点时）进行更新，如下所示：

```
<TextBox Name="itemNameTextBox"
    Text="{Binding Path=ItemName, UpdateSourceTrigger=PropertyChanged}" /> 
```

如果您将 UpdateSourceTrigger 设置为“Explicit”，然后处理 TextBox 的 PreviewKeyDown 事件（查找 Enter 键），那么您可以实现您想要的，但它需要代码隐藏。也许某种附加属性（类似于我的[EnterKeyTraversal](http://www.madprops.org/blog/enter-to-tab-as-an-attached-property/)属性）会为您工作。

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2009-06-10T19:58:08.950

您可以轻松地创建自己的继承自 TextBox 的控件，并在整个项目中重用它。

与此类似的东西应该可以工作：

```
public class SubmitTextBox : TextBox
{
    public SubmitTextBox()
        : base()
    {
        PreviewKeyDown += new KeyEventHandler(SubmitTextBox_PreviewKeyDown);
    }

    void SubmitTextBox_PreviewKeyDown(object sender, KeyEventArgs e)
    {
        if (e.Key == Key.Enter)
        {
            BindingExpression be = GetBindingExpression(TextBox.TextProperty);
            if (be != null)
            {
                be.UpdateSource();
            }
        }
    }
} 
```

可能有一种方法可以绕过这一步，但否则你应该像这样绑定（使用显式）：

```
<custom:SubmitTextBox
    Text="{Binding Path=BoundProperty, UpdateSourceTrigger=Explicit}" /> 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2014-11-06T10:57:51.733

如果你将 Ben 和 ausadmin 的解决方案结合起来，你最终会得到一个非常 MVVM 友好的解决方案：

```
<TextBox Text="{Binding Txt1, Mode=TwoWay, UpdateSourceTrigger=Explicit}">
    <TextBox.InputBindings>
        <KeyBinding Gesture="Enter" 
                    Command="{Binding UpdateTextBoxBindingOnEnterCommand}"
                    CommandParameter="{Binding RelativeSource={RelativeSource FindAncestor,AncestorType={x:Type TextBox}}}" />
    </TextBox.InputBindings>
</TextBox> 
```

...这意味着您将`TextBox`自身作为参数传递给`Command`.

这导致您`Command`看起来像这样（如果您`DelegateCommand`在 VM 中使用 -style 实现）：

```
 public bool CanExecuteUpdateTextBoxBindingOnEnterCommand(object parameter)
    {
        return true;
    }

    public void ExecuteUpdateTextBoxBindingOnEnterCommand(object parameter)
    {
        TextBox tBox = parameter as TextBox;
        if (tBox != null)
        {
            DependencyProperty prop = TextBox.TextProperty;
            BindingExpression binding = BindingOperations.GetBindingExpression(tBox, prop);
            if (binding != null) 
                binding.UpdateSource();
        }
    } 
```

尽管您可能希望将其放在它自己的类中，但此`Command`实现可用于代码隐藏中的任何代码，并且最好不要使用任何代码，因此在您的 VM`TextBox`中没有依赖关系。`System.Windows.Controls`这取决于您的代码指南有多严格。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-11-15T04:09:57.803

这是一种对我来说似乎非常简单的方法，并且比添加 AttachedBehaviour 更容易（这也是一个有效的解决方案）。我们使用默认的UpdateSourceTrigger（TextBox为LostFocus），然后在Enter Key上添加一个InputBinding，绑定到一个命令。

xml如下

```
 <TextBox Grid.Row="0" Text="{Binding Txt1}" Height="30" Width="150">
        <TextBox.InputBindings>
            <KeyBinding Gesture="Enter" 
                        Command="{Binding UpdateText1Command}"
                        CommandParameter="{Binding RelativeSource={RelativeSource FindAncestor,AncestorType={x:Type TextBox}},Path=Text}" />
        </TextBox.InputBindings>
    </TextBox> 
```

然后命令方法是

```
Private Function CanExecuteUpdateText1(ByVal param As Object) As Boolean
    Return True
End Function
Private Sub ExecuteUpdateText1(ByVal param As Object)

    If TypeOf param Is String Then
        Txt1 = CType(param, String)
    End If
End Sub 
```

并且 TextBox 绑定到属性

```
 Public Property Txt1 As String
    Get
        Return _txt1
    End Get
    Set(value As String)
        _txt1 = value
        OnPropertyChanged("Txt1")
    End Set
End Property 
```

到目前为止，这似乎运作良好，并在 TextBox 中捕获了 Enter Key 事件。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2018-03-02T03:27:32.287

这不是对原始问题的答案，而是@Samuel Jack[接受的答案的扩展。](https://stackoverflow.com/a/564659/7159784)我在自己的应用程序中执行了以下操作，并且对 Samuel 解决方案的优雅感到敬畏。它非常干净，而且非常可重复使用，因为它可以用于任何控件，而不仅仅是`TextBox`. 我认为这应该与社区分享。

如果您有一个包含一千个`TextBoxes`都需要在 Enter 上更新绑定源的窗口，您可以通过将下面的 XAML 包含到您的`Window` `Resources`而不是将其附加到每个 TextBox 来将此行为附加到所有这些窗口。首先，您当然必须按照[Samuel 的帖子](https://stackoverflow.com/a/564659/7159784)实现附加的行为。

```
<Window.Resources>
    <Style TargetType="{x:Type TextBox}" BasedOn="{StaticResource {x:Type TextBox}}">
        <Style.Setters>
            <Setter Property="b:InputBindingsManager.UpdatePropertySourceWhenEnterPressed" Value="TextBox.Text"/>
        </Style.Setters>
    </Style>
</Window.Resources> 
```

如果需要，您始终可以通过将 Style 放入`Grid`包含目标 TextBox 的 Window 子元素（即 a ）之一的 Resources 来限制范围。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2016-06-09T16:42:59.310

这对我有用：

```
 <TextBox                 
            Text="{Binding Path=UserInput, UpdateSourceTrigger=PropertyChanged}">
            <TextBox.InputBindings>
                <KeyBinding Key="Return" 
                            Command="{Binding Ok}"/>
            </TextBox.InputBindings>
        </TextBox> 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2011-09-28T16:11:56.193

如果您在 TextBox 中使用 MultiBinding，则需要使用`BindingOperations.GetMultiBindingExpression`method 而不是`BindingOperations.GetBindingExpression`.

```
// Get the correct binding expression based on type of binding
//(simple binding or multi binding.
BindingExpressionBase binding = 
  BindingOperations.GetBindingExpression(element, prop);
if (binding == null)
{
    binding = BindingOperations.GetMultiBindingExpression(element, prop);
}

if (binding != null)
{
     object value = element.GetValue(prop);
     if (string.IsNullOrEmpty(value.ToString()) == true)
     {
         binding.UpdateTarget();
     }
     else
     {
          binding.UpdateSource();
     }
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2016-08-30T18:38:17.270

在这里使用附加行为非常优雅地回答，这是我对几乎任何事情的首选方法。

[WPF如何让文本框在点击回车后失去焦点](https://stackoverflow.com/a/23613757/570206)

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2018-05-03T15:14:24.117

我个人认为拥有标记扩展是一种更清洁的方法。

```
public class UpdatePropertySourceWhenEnterPressedExtension : MarkupExtension
{
    public override object ProvideValue(IServiceProvider serviceProvider)
    {
        return new DelegateCommand<TextBox>(textbox => textbox.GetBindingExpression(TextBox.TextProperty).UpdateSource());
    }
} 
```

```
<TextBox x:Name="TextBox"
             Text="{Binding Text}">
        <TextBox.InputBindings>
            <KeyBinding Key="Enter"
                        Command="{markupExtensions:UpdatePropertySourceWhenEnterPressed}" 
                        CommandParameter="{Binding ElementName=TextBox}"/>
        </TextBox.InputBindings>
</TextBox> 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2020-04-28T06:22:28.577

一个不同的解决方案（不使用 xaml，但我认为仍然很干净）。

```
class ReturnKeyTextBox : TextBox
{
    protected override void OnKeyUp(KeyEventArgs e)
    {
        base.OnKeyUp(e);
        if (e.Key == Key.Return)
            GetBindingExpression(TextProperty).UpdateSource();
    }
} 
```

# geometry - 你如何检测两条线段相交的位置？

> ID：563198
> 
> 赞同：517
> 
> 时间：2009-02-18T22:47:18.427
> 
> 标签：geometry, line-intersection

如何确定两条线是否相交，如果相交，在什么 x,y 点？

* * *

## 回答 #1

> 赞同：658
> 
> 时间：2009-02-19T13:24:36.073

有一个很好的方法来解决这个问题，它使用向量叉积。将二维向量叉积**v**  ×  **w**定义为**v** [x]  **w** [y]  − <strong>v [y]  **w** [x]。

假设两条线段从**p**到**p**  +  **r**和从**q**到**q**  +  **s**。那么第一行上的任何点都可以表示为**p**  +  *t*  **r**（对于标量参数 *t*），第二行上的任何点都可以表示为**q**  +  *u*  **s**（对于标量参数 *u*）。

![两条相交的线段](https://i.stack.imgur.com/vD4g5.png)

如果我们可以找到*t*和*u*，那么两条线相交：

> **p** + *t*  **r** = **q** + *u*  **s**

![交点的公式](https://i.stack.imgur.com/EQRWj.png)

两边用**s**交叉，得到

> ( **p** + *t*  **r** ) × **s** = ( **q** + *u*  **s** ) × **s**

由于**s**  ×  **s** = 0，这意味着

> *t*  ( **r** × **s** ) = ( **q** - **p** ) × **s**

因此，求解*t*：

> *t* = ( **q** - **p** ) × **s** / ( **r** × **s** )

同样，我们可以求解*u*：

> ( **p** + *t*  **r** ) × **r** = ( **q** + *u*  **s** ) × **r**
> 
> *u*  ( **s** × **r** ) = ( **p** - **q** ) × **r**
> 
> *u* = ( **p** - **q** ) × **r** / ( **s** × **r** )

为了减少计算步骤的数量，将其重写如下（记住**s**  ×  **r** = − <strong>r ×  **s**）很方便：

> *u* = ( **q** - **p** ) × **r** / ( **r** × **s** )

现在有四种情况：

1.  如果**r**  ×  **s**  = 0 且 ( **q**  − <strong>p) ×  **r**  = 0，则两条线共线。

    在这种情况下，用第一条线段的方程 ( **p** + *t* **r** )表示第二条线段的端点 ( **q**和**q**  +  **s** )：

     *****> *t* [0] = ( **q** - **p** ) ·  **r** / ( **r**  ·  **r** )
    > 
    > *t* [1] = ( **q** + **s** - **p** ) ·  **r** / ( **r**  ·  **r** ) = *t* [0] + **s**  ·  **r** / ( **r**  ·  **r** )

    如果*t* [0]和*t* [1]之间的区间与区间 [0, 1] 相交，则线段共线且重叠；否则它们是共线且不相交的。

    请注意，如果**s**和**r**指向相反的方向，则**s**  ·  **r** < 0，因此要检查的区间是 [ *t* [1] , *t* [0] ] 而不是 [ *t* [0] , *t* [1] ]。***** 
******   如果**r**  ×  **s**  = 0 且 ( **q**  − <strong>p) ×  **r**  ≠ 0，则两条线平行且不相交。

    *   如果**r**  ×  **s**  ≠ 0 且 0 ≤ <em>t ≤ 1 且 0 ≤ <em>u ≤ 1，则两条线段在点**p** + *t*  **r** = **q** + *u*  **s**处相交。

    *   否则，两条线段不平行但不相交。***** 

 ******学分：此方法是 Ronald Goldman 发表于Graphics Gems*第 304 页的文章“三空间中两条线的交点”中 3D 线相交算法的二维特化。在三维中，通常的情况是这些线是倾斜的（既不平行也不相交），在这种情况下，该方法给出了两条线最接近的点。

* * *

## 回答 #2

> 赞同：230
> 
> 时间：2009-12-28T07:16:45.873

FWIW，以下函数（在 C 中）都检测线交点并确定交点。它基于 Andre LeMothe 的“ [Windows 游戏编程大师技巧](https://rads.stackoverflow.com/amzn/click/com/0672323699)”中的算法。它与其他答案中的某些算法（例如 Gareth 的）没有什么不同。LeMothe 然后使用克莱默规则（不要问我）来解方程本身。

我可以证明它在我微弱的小行星克隆中有效，并且似乎可以正确处理 Elemental、Dan 和 Wodzu 的其他答案中描述的边缘情况。它也可能比 KingNestor 发布的代码更快，因为它都是乘法和除法，没有平方根！

我想那里有一些被零除的可能性，尽管在我的情况下这不是问题。很容易修改以避免崩溃。

```
// Returns 1 if the lines intersect, otherwise 0\. In addition, if the lines 
// intersect the intersection point may be stored in the floats i_x and i_y.
char get_line_intersection(float p0_x, float p0_y, float p1_x, float p1_y, 
    float p2_x, float p2_y, float p3_x, float p3_y, float *i_x, float *i_y)
{
    float s1_x, s1_y, s2_x, s2_y;
    s1_x = p1_x - p0_x;     s1_y = p1_y - p0_y;
    s2_x = p3_x - p2_x;     s2_y = p3_y - p2_y;

    float s, t;
    s = (-s1_y * (p0_x - p2_x) + s1_x * (p0_y - p2_y)) / (-s2_x * s1_y + s1_x * s2_y);
    t = ( s2_x * (p0_y - p2_y) - s2_y * (p0_x - p2_x)) / (-s2_x * s1_y + s1_x * s2_y);

    if (s >= 0 && s <= 1 && t >= 0 && t <= 1)
    {
        // Collision detected
        if (i_x != NULL)
            *i_x = p0_x + (t * s1_x);
        if (i_y != NULL)
            *i_y = p0_y + (t * s1_y);
        return 1;
    }

    return 0; // No collision
} 
```

顺便说一句，我必须说，在 LeMothe 的书中，尽管他显然得到了正确的算法，但他展示的具体示例插入了错误的数字并进行了错误的计算。例如：

> (4 * (4 - 1) + 12 * (7 - 1)) / (17 * 4 + 12 * 10)
> 
> = 844/0.88
> 
> = 0.44

这让我困惑了好*几个小时*。:(

* * *

## 回答 #3

> 赞同：63
> 
> 时间：2009-02-18T23:09:18.547

问题归结为这个问题：从 A 到 B 和从 C 到 D 的两条线是否相交？然后你可以问它四次（在直线和矩形的四个边之间）。

这是执行此操作的矢量数学。我假设从 A 到 B 的线是有问题的线，从 C 到 D 的线是矩形线之一。我的符号是`Ax`“A 的 x 坐标”和`Cy`“C 的 y 坐标”。并且“ `*`”表示点积，例如`A*B = Ax*Bx + Ay*By`。

```
E = B-A = ( Bx-Ax, By-Ay )
F = D-C = ( Dx-Cx, Dy-Cy ) 
P = ( -Ey, Ex )
h = ( (A-C) * P ) / ( F * P ) 
```

这个`h`数字是关键。如果在和`h`之间，则线相交，否则不相交。如果为零，您当然无法进行计算，但在这种情况下，线是平行的，因此仅在明显的情况下相交。`0``1``F*P`

确切的交点是`C + F*h`。

**更多乐趣：**

如果`h`恰好*是* `0`或`1`线在端点处接触。您可以将其视为“交叉点”，也可以不视为您认为合适的。

具体来说，`h`就是你必须乘以线的长度才能准确地接触另一条线。

因此，如果`h<0`，则表示矩形线在给定线的“后面”（“方向”为“从 A 到 B”），如果`h>1`矩形线在给定线的“前面”。

**推导：**

A 和 C 是指向行首的向量；E 和 F 是形成直线的 A 和 C 末端的向量。

对于平面上的任何两条不平行的线，必须恰好有一对标量`g`，并且`h`使得这个方程成立：

```
A + E*g = C + F*h 
```

为什么？因为两条非平行线必须相交，这意味着您可以将两条线分别缩放一定量并相互接触。

（**起初，这看起来像是一个有两个未知数的单一方程！** 但当你认为这是一个二维向量方程时，它并不是，这意味着这实际上是`x`和中的一对方程`y`。）

我们必须消除这些变量之一。一个简单的方法是将`E`术语设为零。为此，请使用一个向量对等式两边进行点积，该向量将与 E 点到零。我`P`在上面调用的那个向量，我对 E 做了明显的变换。

你现在有：

```
A*P = C*P + F*P*h
(A-C)*P = (F*P)*h
( (A-C)*P ) / (F*P) = h 
```

* * *

## 回答 #4

> 赞同：46
> 
> 时间：2009-07-29T16:05:54.133

我试图实现上面 Jason 如此优雅地描述的算法；不幸的是，在调试数学时，我发现许多情况下它不起作用。

例如，考虑点 A(10,10) B(20,20) C(10,1) D(1,10) 给出 h=.5，但通过检查可以清楚地看出这些段在每个段附近都没有其他。

用图表可以清楚地看出，0 < h < 1 标准仅表明如果存在，截点将位于 CD 上，但没有说明该点是否位于 AB 上。为确保存在交叉点，您必须对变量 g 进行对称计算，截距要求为：0 < g < 1 AND 0 < h < 1

* * *

## 回答 #5

> 赞同：45
> 
> 时间：2013-02-10T06:56:51.403

这是对加文答案的改进。marcp 的解决方案也类似，但都没有推迟除法。

这实际上也是 Gareth Rees 答案的实际应用，因为叉积在 2D 中的等价物是 perp-dot-product，这是这​​段代码使用的三个。切换到 3D 并使用叉积，在最后插入 s 和 t，得到 3D 中线之间的两个最近点。无论如何，二维解决方案：

```
int get_line_intersection(float p0_x, float p0_y, float p1_x, float p1_y, 
    float p2_x, float p2_y, float p3_x, float p3_y, float *i_x, float *i_y)
{
    float s02_x, s02_y, s10_x, s10_y, s32_x, s32_y, s_numer, t_numer, denom, t;
    s10_x = p1_x - p0_x;
    s10_y = p1_y - p0_y;
    s32_x = p3_x - p2_x;
    s32_y = p3_y - p2_y;

    denom = s10_x * s32_y - s32_x * s10_y;
    if (denom == 0)
        return 0; // Collinear
    bool denomPositive = denom > 0;

    s02_x = p0_x - p2_x;
    s02_y = p0_y - p2_y;
    s_numer = s10_x * s02_y - s10_y * s02_x;
    if ((s_numer < 0) == denomPositive)
        return 0; // No collision

    t_numer = s32_x * s02_y - s32_y * s02_x;
    if ((t_numer < 0) == denomPositive)
        return 0; // No collision

    if (((s_numer > denom) == denomPositive) || ((t_numer > denom) == denomPositive))
        return 0; // No collision
    // Collision detected
    t = t_numer / denom;
    if (i_x != NULL)
        *i_x = p0_x + (t * s10_x);
    if (i_y != NULL)
        *i_y = p0_y + (t * s10_y);

    return 1;
} 
```

基本上它将划分推迟到最后一刻，并将大部分测试移动到完成某些计算之前，从而增加了提前退出。最后，它还避免了线平行时发生的除以零的情况。

您可能还需要考虑使用 epsilon 测试而不是与零进行比较。非常接近平行的线会产生略微偏离的结果。这不是错误，而是浮点数学的限制。

* * *

## 回答 #6

> 赞同：40
> 
> 时间：2013-02-21T11:31:22.977

# 问题 C：如何检测两条线段是否相交？

我搜索了相同的主题，但我对答案不满意。所以我写了一篇文章，非常详细地解释了[如何检查两条线段是否](http://martin-thoma.com/how-to-check-if-two-line-segments-intersect/)与大量图像相交。有完整的（和经过测试的）Java 代码。

这是文章，裁剪到最重要的部分：

检查线段 a 是否与线段 b 相交的算法如下所示：

![在此处输入图像描述](https://i.stack.imgur.com/X1eBo.png)

什么是边界框？这是两个线段的两个边界框：

![在此处输入图像描述](https://i.stack.imgur.com/Smig7.png)

如果两个边界框都有交点，则移动线段 a 以使一个点位于 (0|0) 处。现在你有一条通过 a 定义的原点的线。现在以同样的方式移动线段 b 并检查线段 b 的新点是否在线 a 的不同侧。如果是这种情况，请反过来检查。如果也是这种情况，则线段相交。如果不是，它们不会相交。

# 问题 A：两条线段在哪里相交？

你知道两条线段 a 和 b 相交。如果您不知道，请使用我在“问题 C”中提供的工具进行检查。

现在您可以通过一些案例并通过 7 年级数学获得解决方案（参见[代码和交互式示例](http://martin-thoma.com/how-to-check-if-two-line-segments-intersect/#Where_do_two_line_segments_intersect)）。

# 问题 B：如何检测两条线是否相交？

假设你的观点，`A = (x1, y1)`观点`B = (x2, y2)`，，`C = (x_3, y_3)`。`D = (x_4, y_4)`您的第一行由 AB 定义（使用 A ！= B），第二行由 CD 定义（使用 C ！= D）。

```
function doLinesIntersect(AB, CD) {
    if (x1 == x2) {
        return !(x3 == x4 && x1 != x3);
    } else if (x3 == x4) {
        return true;
    } else {
        // Both lines are not parallel to the y-axis
        m1 = (y1-y2)/(x1-x2);
        m2 = (y3-y4)/(x3-x4);
        return m1 != m2;
    }
} 
```

# 问题 D：两条线在哪里相交？

如果它们完全相交，请检查问题 B。

线 a 和 b 由每条线的两个点定义。您基本上可以应用问题 A 中使用的相同逻辑。

* * *

## 回答 #7

> 赞同：21
> 
> 时间：2009-04-04T00:26:13.593

曾经在这里接受的答案是不正确的（此后一直未被接受，所以万岁！）。它不能正确消除所有非交叉点。微不足道，它可能看起来有效，但可能会失败，尤其是在 0 和 1 被认为对 h 有效的情况下。

考虑以下情况：

(4,1)-(5,1) 和 (0,0)-(0,2) 处的行

这些是明显不重叠的垂直线。

A=(4,1)
B=(5,1)
C=(0,0)
D=(0,2)
E=(5,1)-(4,1)=(-1,0)
F= (0,2)-(0,0)=(0,-2)
P=(0,1)
h=((4,1)-(0,0)) 点 (0,1) / ((0 ,-2) 点 (0,1)) = 0

根据上述答案，这两条线段在端点处相交（值 0 和 1）。该端点将是：

(0,0)+(0,-2)*0=(0,0)

因此，显然两条线段在 (0,0) 处相交，在 CD 线上，但不在 AB 线上。那么出了什么问题呢？答案是 0 和 1 的值是无效的，只是有时会发生正确预测端点相交的情况。当一条线（而不是另一条）的延长线与线段相交时，算法会预测线段的交点，但这是不正确的。我想通过从 AB 与 CD 开始进行测试，然后再用 CD 与 AB 进行测试，这个问题将被消除。只有当两者都落在 0 和 1 之间时，才能说它们相交。

如果您必须预测端点，我建议使用向量叉积方法。

-担

* * *

## 回答 #8

> 赞同：14
> 
> 时间：2013-10-23T19:42:10.013

iMalc 答案的 Python 版本：

```
def find_intersection( p0, p1, p2, p3 ) :

    s10_x = p1[0] - p0[0]
    s10_y = p1[1] - p0[1]
    s32_x = p3[0] - p2[0]
    s32_y = p3[1] - p2[1]

    denom = s10_x * s32_y - s32_x * s10_y

    if denom == 0 : return None # collinear

    denom_is_positive = denom > 0

    s02_x = p0[0] - p2[0]
    s02_y = p0[1] - p2[1]

    s_numer = s10_x * s02_y - s10_y * s02_x

    if (s_numer < 0) == denom_is_positive : return None # no collision

    t_numer = s32_x * s02_y - s32_y * s02_x

    if (t_numer < 0) == denom_is_positive : return None # no collision

    if (s_numer > denom) == denom_is_positive or (t_numer > denom) == denom_is_positive : return None # no collision

    # collision detected

    t = t_numer / denom

    intersection_point = [ p0[0] + (t * s10_x), p0[1] + (t * s10_y) ]

    return intersection_point 
```

* * *

## 回答 #9

> 赞同：11
> 
> 时间：2016-06-30T01:41:01.267

找到两条线段的正确交点是一项具有大量边缘情况的非平凡任务。这是一个文档齐全、工作良好且经过测试的 Java 解决方案。

本质上，在找到两条线段的交点时会发生三件事：

1.  线段不相交

2.  有一个独特的交点

3.  交叉口是另一段

**注意**：在代码中，我假设 x1 = x2 和 y1 = y2 的线段 (x1, y1), (x2, y2) 是有效的线段。从数学上讲，线段由不同的点组成，但为了完整起见，我允许线段在此实现中成为点。

代码取自我的[github 仓库](https://github.com/williamfiset/Algorithms)

```
/**
 * This snippet finds the intersection of two line segments.
 * The intersection may either be empty, a single point or the
 * intersection is a subsegment there's an overlap.
 */

import static java.lang.Math.abs;
import static java.lang.Math.max;
import static java.lang.Math.min;

import java.util.ArrayList;
import java.util.List;

public class LineSegmentLineSegmentIntersection {

  // Small epsilon used for double value comparison.
  private static final double EPS = 1e-5;

  // 2D Point class.
  public static class Pt {
    double x, y;
    public Pt(double x, double y) {
      this.x = x; 
      this.y = y;
    }
    public boolean equals(Pt pt) {
      return abs(x - pt.x) < EPS && abs(y - pt.y) < EPS;
    }
  }

  // Finds the orientation of point 'c' relative to the line segment (a, b)
  // Returns  0 if all three points are collinear.
  // Returns -1 if 'c' is clockwise to segment (a, b), i.e right of line formed by the segment.
  // Returns +1 if 'c' is counter clockwise to segment (a, b), i.e left of line
  // formed by the segment.
  public static int orientation(Pt a, Pt b, Pt c) {
    double value = (b.y - a.y) * (c.x - b.x) - 
                   (b.x - a.x) * (c.y - b.y);
    if (abs(value) < EPS) return 0;
    return (value > 0) ? -1 : +1;
  }

  // Tests whether point 'c' is on the line segment (a, b).
  // Ensure first that point c is collinear to segment (a, b) and
  // then check whether c is within the rectangle formed by (a, b)
  public static boolean pointOnLine(Pt a, Pt b, Pt c) {
    return orientation(a, b, c) == 0 && 
           min(a.x, b.x) <= c.x && c.x <= max(a.x, b.x) && 
           min(a.y, b.y) <= c.y && c.y <= max(a.y, b.y);
  }

  // Determines whether two segments intersect.
  public static boolean segmentsIntersect(Pt p1, Pt p2, Pt p3, Pt p4) {

    // Get the orientation of points p3 and p4 in relation
    // to the line segment (p1, p2)
    int o1 = orientation(p1, p2, p3);
    int o2 = orientation(p1, p2, p4);
    int o3 = orientation(p3, p4, p1);
    int o4 = orientation(p3, p4, p2);

    // If the points p1, p2 are on opposite sides of the infinite
    // line formed by (p3, p4) and conversly p3, p4 are on opposite
    // sides of the infinite line formed by (p1, p2) then there is
    // an intersection.
    if (o1 != o2 && o3 != o4) return true;

    // Collinear special cases (perhaps these if checks can be simplified?)
    if (o1 == 0 && pointOnLine(p1, p2, p3)) return true;
    if (o2 == 0 && pointOnLine(p1, p2, p4)) return true;
    if (o3 == 0 && pointOnLine(p3, p4, p1)) return true;
    if (o4 == 0 && pointOnLine(p3, p4, p2)) return true;

    return false;
  }

  public static List<Pt> getCommonEndpoints(Pt p1, Pt p2, Pt p3, Pt p4) {

    List<Pt> points = new ArrayList<>();

    if (p1.equals(p3)) {
      points.add(p1);
      if (p2.equals(p4)) points.add(p2);

    } else if (p1.equals(p4)) {
      points.add(p1);
      if (p2.equals(p3)) points.add(p2);

    } else if (p2.equals(p3)) {
      points.add(p2);
      if (p1.equals(p4)) points.add(p1);

    } else if (p2.equals(p4)) {
      points.add(p2);
      if (p1.equals(p3)) points.add(p1);
    }

    return points;
  }

  // Finds the intersection point(s) of two line segments. Unlike regular line 
  // segments, segments which are points (x1 = x2 and y1 = y2) are allowed.
  public static Pt[] lineSegmentLineSegmentIntersection(Pt p1, Pt p2, Pt p3, Pt p4) {

    // No intersection.
    if (!segmentsIntersect(p1, p2, p3, p4)) return new Pt[]{};

    // Both segments are a single point.
    if (p1.equals(p2) && p2.equals(p3) && p3.equals(p4))
      return new Pt[]{p1};

    List<Pt> endpoints = getCommonEndpoints(p1, p2, p3, p4);
    int n = endpoints.size();

    // One of the line segments is an intersecting single point.
    // NOTE: checking only n == 1 is insufficient to return early
    // because the solution might be a sub segment.
    boolean singleton = p1.equals(p2) || p3.equals(p4);
    if (n == 1 && singleton) return new Pt[]{endpoints.get(0)};

    // Segments are equal.
    if (n == 2) return new Pt[]{endpoints.get(0), endpoints.get(1)};

    boolean collinearSegments = (orientation(p1, p2, p3) == 0) && 
                                (orientation(p1, p2, p4) == 0);

    // The intersection will be a sub-segment of the two
    // segments since they overlap each other.
    if (collinearSegments) {

      // Segment #2 is enclosed in segment #1
      if (pointOnLine(p1, p2, p3) && pointOnLine(p1, p2, p4))
        return new Pt[]{p3, p4};

      // Segment #1 is enclosed in segment #2
      if (pointOnLine(p3, p4, p1) && pointOnLine(p3, p4, p2))
        return new Pt[]{p1, p2};

      // The subsegment is part of segment #1 and part of segment #2.
      // Find the middle points which correspond to this segment.
      Pt midPoint1 = pointOnLine(p1, p2, p3) ? p3 : p4;
      Pt midPoint2 = pointOnLine(p3, p4, p1) ? p1 : p2;

      // There is actually only one middle point!
      if (midPoint1.equals(midPoint2)) return new Pt[]{midPoint1};

      return new Pt[]{midPoint1, midPoint2};
    }

    /* Beyond this point there is a unique intersection point. */

    // Segment #1 is a vertical line.
    if (abs(p1.x - p2.x) < EPS) {
      double m = (p4.y - p3.y) / (p4.x - p3.x);
      double b = p3.y - m * p3.x;
      return new Pt[]{new Pt(p1.x, m * p1.x + b)};
    }

    // Segment #2 is a vertical line.
    if (abs(p3.x - p4.x) < EPS) {
      double m = (p2.y - p1.y) / (p2.x - p1.x);
      double b = p1.y - m * p1.x;
      return new Pt[]{new Pt(p3.x, m * p3.x + b)};
    }

    double m1 = (p2.y - p1.y) / (p2.x - p1.x);
    double m2 = (p4.y - p3.y) / (p4.x - p3.x);
    double b1 = p1.y - m1 * p1.x;
    double b2 = p3.y - m2 * p3.x;
    double x = (b2 - b1) / (m1 - m2);
    double y = (m1 * b2 - m2 * b1) / (m1 - m2);

    return new Pt[]{new Pt(x, y)};
  }

} 
```

这是一个简单的使用示例：

```
 public static void main(String[] args) {

    // Segment #1 is (p1, p2), segment #2 is (p3, p4)
    Pt p1, p2, p3, p4;

    p1 = new Pt(-2, 4); p2 = new Pt(3, 3);
    p3 = new Pt(0, 0);  p4 = new Pt(2, 4);
    Pt[] points = lineSegmentLineSegmentIntersection(p1, p2, p3, p4);
    Pt point = points[0];

    // Prints: (1.636, 3.273)
    System.out.printf("(%.3f, %.3f)\n", point.x, point.y);

    p1 = new Pt(-10, 0); p2 = new Pt(+10, 0);
    p3 = new Pt(-5, 0);  p4 = new Pt(+5, 0);
    points = lineSegmentLineSegmentIntersection(p1, p2, p3, p4);
    Pt point1 = points[0], point2 = points[1];

    // Prints: (-5.000, 0.000) (5.000, 0.000)
    System.out.printf("(%.3f, %.3f) (%.3f, %.3f)\n", point1.x, point1.y, point2.x, point2.y);
  } 
```

* * *

## 回答 #10

> 赞同：8
> 
> 时间：2014-04-25T21:38:36.060

上面有很多解决方案，但我认为下面的解决方案非常简单易懂。

两个线段向量 AB 和向量 CD 相交当且仅当

1.  端点 a 和 b 位于段 CD 的相对两侧。
2.  端点 c 和 d 位于线段 AB 的相对侧。

更具体地说，当且仅当两个三元组 a、c、d 和 b、c、d 中的一个恰好是逆时针顺序时，a 和 b 位于段 CD 的相对侧。

```
Intersect(a, b, c, d)
 if CCW(a, c, d) == CCW(b, c, d)
    return false;
 else if CCW(a, b, c) == CCW(a, b, d)
    return false;
 else
    return true; 
```

这里 CCW 表示逆时针方向，它根据点的方向返回真/假。

资料来源：[http](http://compgeom.cs.uiuc.edu/~jeffe/teaching/373/notes/x06-sweepline.pdf) ://compgeom.cs.uiuc.edu/~jeffe/teaching/373/notes/x06-sweepline.pdf 第2页

* * *

## 回答 #11

> 赞同：8
> 
> 时间：2013-02-20T18:37:41.200

## C 和 Objective-C

基于加雷斯里斯的回答

```
const AGKLine AGKLineZero = (AGKLine){(CGPoint){0.0, 0.0}, (CGPoint){0.0, 0.0}};

AGKLine AGKLineMake(CGPoint start, CGPoint end)
{
    return (AGKLine){start, end};
}

double AGKLineLength(AGKLine l)
{
    return CGPointLengthBetween_AGK(l.start, l.end);
}

BOOL AGKLineIntersection(AGKLine l1, AGKLine l2, CGPoint *out_pointOfIntersection)
{
    // http://stackoverflow.com/a/565282/202451

    CGPoint p = l1.start;
    CGPoint q = l2.start;
    CGPoint r = CGPointSubtract_AGK(l1.end, l1.start);
    CGPoint s = CGPointSubtract_AGK(l2.end, l2.start);

    double s_r_crossProduct = CGPointCrossProductZComponent_AGK(r, s);
    double t = CGPointCrossProductZComponent_AGK(CGPointSubtract_AGK(q, p), s) / s_r_crossProduct;
    double u = CGPointCrossProductZComponent_AGK(CGPointSubtract_AGK(q, p), r) / s_r_crossProduct;

    if(t < 0 || t > 1.0 || u < 0 || u > 1.0)
    {
        if(out_pointOfIntersection != NULL)
        {
            *out_pointOfIntersection = CGPointZero;
        }
        return NO;
    }
    else
    {
        if(out_pointOfIntersection != NULL)
        {
            CGPoint i = CGPointAdd_AGK(p, CGPointMultiply_AGK(r, t));
            *out_pointOfIntersection = i;
        }
        return YES;
    }
}

CGFloat CGPointCrossProductZComponent_AGK(CGPoint v1, CGPoint v2)
{
    return v1.x * v2.y - v1.y * v2.x;
}

CGPoint CGPointSubtract_AGK(CGPoint p1, CGPoint p2)
{
    return (CGPoint){p1.x - p2.x, p1.y - p2.y};
}

CGPoint CGPointAdd_AGK(CGPoint p1, CGPoint p2)
{
    return (CGPoint){p1.x + p2.x, p1.y + p2.y};
}

CGFloat CGPointCrossProductZComponent_AGK(CGPoint v1, CGPoint v2)
{
    return v1.x * v2.y - v1.y * v2.x;
}

CGPoint CGPointMultiply_AGK(CGPoint p1, CGFloat factor)
{
    return (CGPoint){p1.x * factor, p1.y * factor};
} 
```

许多函数和结构都是私有的，但你应该很容易知道发生了什么。这是在这个 repo 上公开的[https://github.com/hfossli/AGGeometryKit/](https://github.com/hfossli/AGGeometryKit/)

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2013-01-03T17:11:50.693

只是想提一下，可以在数字食谱系列中找到一个很好的解释和明确的解决方案。我有第 3 版，答案在第 1117 页，第 21.4 节。[在 Marina Gavrilova Reliable Line Section Intersection Testing](http://www.cpsc.ucalgary.ca/~marina/papers/Segment_intersection.ps)的论文中可以找到另一种具有不同命名法的解决方案。在我看来，她的解决方案要简单一些。

我的实现如下：

```
bool NuGeometry::IsBetween(const double& x0, const double& x, const double& x1){
   return (x >= x0) && (x <= x1);
}

bool NuGeometry::FindIntersection(const double& x0, const double& y0, 
     const double& x1, const double& y1,
     const double& a0, const double& b0, 
     const double& a1, const double& b1, 
     double& xy, double& ab) {
   // four endpoints are x0, y0 & x1,y1 & a0,b0 & a1,b1
   // returned values xy and ab are the fractional distance along xy and ab
   // and are only defined when the result is true

   bool partial = false;
   double denom = (b0 - b1) * (x0 - x1) - (y0 - y1) * (a0 - a1);
   if (denom == 0) {
      xy = -1;
      ab = -1;
   } else {
      xy = (a0 * (y1 - b1) + a1 * (b0 - y1) + x1 * (b1 - b0)) / denom;
      partial = NuGeometry::IsBetween(0, xy, 1);
      if (partial) {
         // no point calculating this unless xy is between 0 & 1
         ab = (y1 * (x0 - a1) + b1 * (x1 - x0) + y0 * (a1 - x1)) / denom; 
      }
   }
   if ( partial && NuGeometry::IsBetween(0, ab, 1)) {
      ab = 1-ab;
      xy = 1-xy;
      return true;
   }  else return false;
} 
```

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2009-02-19T10:03:58.067

这对我来说效果很好。取自[这里](http://workshop.evolutionzone.com/2007/09/10/code-2d-line-intersection/)。

```
 // calculates intersection and checks for parallel lines.  
 // also checks that the intersection point is actually on  
 // the line segment p1-p2  
 Point findIntersection(Point p1,Point p2,  
   Point p3,Point p4) {  
   float xD1,yD1,xD2,yD2,xD3,yD3;  
   float dot,deg,len1,len2;  
   float segmentLen1,segmentLen2;  
   float ua,ub,div;  

   // calculate differences  
   xD1=p2.x-p1.x;  
   xD2=p4.x-p3.x;  
   yD1=p2.y-p1.y;  
   yD2=p4.y-p3.y;  
   xD3=p1.x-p3.x;  
   yD3=p1.y-p3.y;    

   // calculate the lengths of the two lines  
   len1=sqrt(xD1*xD1+yD1*yD1);  
   len2=sqrt(xD2*xD2+yD2*yD2);  

   // calculate angle between the two lines.  
   dot=(xD1*xD2+yD1*yD2); // dot product  
   deg=dot/(len1*len2);  

   // if abs(angle)==1 then the lines are parallell,  
   // so no intersection is possible  
   if(abs(deg)==1) return null;  

   // find intersection Pt between two lines  
   Point pt=new Point(0,0);  
   div=yD2*xD1-xD2*yD1;  
   ua=(xD2*yD3-yD2*xD3)/div;  
   ub=(xD1*yD3-yD1*xD3)/div;  
   pt.x=p1.x+ua*xD1;  
   pt.y=p1.y+ua*yD1;  

   // calculate the combined length of the two segments  
   // between Pt-p1 and Pt-p2  
   xD1=pt.x-p1.x;  
   xD2=pt.x-p2.x;  
   yD1=pt.y-p1.y;  
   yD2=pt.y-p2.y;  
   segmentLen1=sqrt(xD1*xD1+yD1*yD1)+sqrt(xD2*xD2+yD2*yD2);  

   // calculate the combined length of the two segments  
   // between Pt-p3 and Pt-p4  
   xD1=pt.x-p3.x;  
   xD2=pt.x-p4.x;  
   yD1=pt.y-p3.y;  
   yD2=pt.y-p4.y;  
   segmentLen2=sqrt(xD1*xD1+yD1*yD1)+sqrt(xD2*xD2+yD2*yD2);  

   // if the lengths of both sets of segments are the same as  
   // the lenghts of the two lines the point is actually  
   // on the line segment.  

   // if the point isn’t on the line, return null  
   if(abs(len1-segmentLen1)>0.01 || abs(len2-segmentLen2)>0.01)  
     return null;  

   // return the valid intersection  
   return pt;  
 }  

 class Point{  
   float x,y;  
   Point(float x, float y){  
     this.x = x;  
     this.y = y;  
   }  

   void set(float x, float y){  
     this.x = x;  
     this.y = y;  
   }  
 } 
```

* * *

## 回答 #14

> 赞同：6
> 
> 时间：2010-07-31T10:32:49.377

我尝试了其中一些答案，但它们对我不起作用（对不起，伙计们）；经过更多的网络搜索后，我发现[了这个](http://alienryderflex.com/intersect/)。

对他的代码稍作修改，我现在有了这个函数，它将返回交点，或者如果没有找到交点，它将返回-1，-1。

```
 Public Function intercetion(ByVal ax As Integer, ByVal ay As Integer, ByVal bx As Integer, ByVal by As Integer, ByVal cx As Integer, ByVal cy As Integer, ByVal dx As Integer, ByVal dy As Integer) As Point
    '//  Determines the intersection point of the line segment defined by points A and B
    '//  with the line segment defined by points C and D.
    '//
    '//  Returns YES if the intersection point was found, and stores that point in X,Y.
    '//  Returns NO if there is no determinable intersection point, in which case X,Y will
    '//  be unmodified.

    Dim distAB, theCos, theSin, newX, ABpos As Double

    '//  Fail if either line segment is zero-length.
    If ax = bx And ay = by Or cx = dx And cy = dy Then Return New Point(-1, -1)

    '//  Fail if the segments share an end-point.
    If ax = cx And ay = cy Or bx = cx And by = cy Or ax = dx And ay = dy Or bx = dx And by = dy Then Return New Point(-1, -1)

    '//  (1) Translate the system so that point A is on the origin.
    bx -= ax
    by -= ay
    cx -= ax
    cy -= ay
    dx -= ax
    dy -= ay

    '//  Discover the length of segment A-B.
    distAB = Math.Sqrt(bx * bx + by * by)

    '//  (2) Rotate the system so that point B is on the positive X axis.
    theCos = bx / distAB
    theSin = by / distAB
    newX = cx * theCos + cy * theSin
    cy = cy * theCos - cx * theSin
    cx = newX
    newX = dx * theCos + dy * theSin
    dy = dy * theCos - dx * theSin
    dx = newX

    '//  Fail if segment C-D doesn't cross line A-B.
    If cy < 0 And dy < 0 Or cy >= 0 And dy >= 0 Then Return New Point(-1, -1)

    '//  (3) Discover the position of the intersection point along line A-B.
    ABpos = dx + (cx - dx) * dy / (dy - cy)

    '//  Fail if segment C-D crosses line A-B outside of segment A-B.
    If ABpos < 0 Or ABpos > distAB Then Return New Point(-1, -1)

    '//  (4) Apply the discovered position to line A-B in the original coordinate system.
    '*X=Ax+ABpos*theCos
    '*Y=Ay+ABpos*theSin

    '//  Success.
    Return New Point(ax + ABpos * theCos, ay + ABpos * theSin)
End Function 
```

* * *

## 回答 #15

> 赞同：6
> 
> 时间：2016-02-17T12:52:21.060

[Gavin 的回答](https://stackoverflow.com/questions/563198/how-do-you-detect-where-two-line-segments-intersect/1968345#1968345)似乎引起了一些兴趣，cortijon 在[评论](https://stackoverflow.com/questions/563198/how-do-you-detect-where-two-line-segments-intersect/1968345#comment-19248344)中提出了一个 javascript 版本，而 iMalc 提供了一个[计算量略少](https://stackoverflow.com/questions/563198/how-do-you-detect-where-two-line-segments-intersect#14795484)的版本。一些人指出了各种代码提案的缺点，而其他人则评论了一些代码提案的效率。

iMalc 通过 Gavin 的回答提供的算法是我目前在 javascript 项目中使用的算法，如果它可以帮助任何人，我只想在这里提供一个清理后的版本。

```
// Some variables for reuse, others may do this differently
var p0x, p1x, p2x, p3x, ix,
    p0y, p1y, p2y, p3y, iy,
    collisionDetected;

// do stuff, call other functions, set endpoints...

// note: for my purpose I use |t| < |d| as opposed to
// |t| <= |d| which is equivalent to 0 <= t < 1 rather than
// 0 <= t <= 1 as in Gavin's answer - results may vary

var lineSegmentIntersection = function(){
    var d, dx1, dx2, dx3, dy1, dy2, dy3, s, t;

    dx1 = p1x - p0x;      dy1 = p1y - p0y;
    dx2 = p3x - p2x;      dy2 = p3y - p2y;
    dx3 = p0x - p2x;      dy3 = p0y - p2y;

    collisionDetected = 0;

    d = dx1 * dy2 - dx2 * dy1;

    if(d !== 0){
        s = dx1 * dy3 - dx3 * dy1;
        if((s <= 0 && d < 0 && s >= d) || (s >= 0 && d > 0 && s <= d)){
            t = dx2 * dy3 - dx3 * dy2;
            if((t <= 0 && d < 0 && t > d) || (t >= 0 && d > 0 && t < d)){
                t = t / d;
                collisionDetected = 1;
                ix = p0x + t * dx1;
                iy = p0y + t * dy1;
            }
        }
    }
}; 
```

* * *

## 回答 #16

> 赞同：5
> 
> 时间：2014-09-24T20:19:40.297

我认为这个问题有一个更简单的解决方案。我今天想出了另一个想法，它似乎工作得很好（至少现在是 2D 的）。您所要做的就是计算两条线之间的交点，然后检查计算出的交点是否在两条线段的边界框内。如果是，则线段相交。而已。

编辑：

这就是我计算交集的方式（我不知道我在哪里找到了这个代码片段）

```
Point3D 
```

来自

```
System.Windows.Media.Media3D

public static Point3D? Intersection(Point3D start1, Point3D end1, Point3D start2, Point3D end2) {

        double a1 = end1.Y - start1.Y;
        double b1 = start1.X - end1.X;
        double c1 = a1 * start1.X + b1 * start1.Y;

        double a2 = end2.Y - start2.Y;
        double b2 = start2.X - end2.X;
        double c2 = a2 * start2.X + b2 * start2.Y;

        double det = a1 * b2 - a2 * b1;
        if (det == 0) { // lines are parallel
            return null;
        }

        double x = (b2 * c1 - b1 * c2) / det;
        double y = (a1 * c2 - a2 * c1) / det;

        return new Point3D(x, y, 0.0);
    } 
```

这是我的（为回答目的而简化）BoundingBox 类：

```
public class BoundingBox {
    private Point3D min = new Point3D();
    private Point3D max = new Point3D();

    public BoundingBox(Point3D point) {
        min = point;
        max = point;
    }

    public Point3D Min {
        get { return min; }
        set { min = value; }
    }

    public Point3D Max {
        get { return max; }
        set { max = value; }
    }

    public bool Contains(BoundingBox box) {
        bool contains =
            min.X <= box.min.X && max.X >= box.max.X &&
            min.Y <= box.min.Y && max.Y >= box.max.Y &&
            min.Z <= box.min.Z && max.Z >= box.max.Z;
        return contains;
    }

    public bool Contains(Point3D point) {
        return Contains(new BoundingBox(point));
    }

} 
```

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2014-08-11T09:28:03.383

此解决方案可能会有所帮助

```
public static float GetLineYIntesept(PointF p, float slope)
    {
        return p.Y - slope * p.X;
    }

    public static PointF FindIntersection(PointF line1Start, PointF line1End, PointF line2Start, PointF line2End)
    {

        float slope1 = (line1End.Y - line1Start.Y) / (line1End.X - line1Start.X);
        float slope2 = (line2End.Y - line2Start.Y) / (line2End.X - line2Start.X);

        float yinter1 = GetLineYIntesept(line1Start, slope1);
        float yinter2 = GetLineYIntesept(line2Start, slope2);

        if (slope1 == slope2 && yinter1 != yinter2)
            return PointF.Empty;

        float x = (yinter2 - yinter1) / (slope1 - slope2);

        float y = slope1 * x + yinter1;

        return new PointF(x, y);
    } 
```

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2015-05-11T03:19:50.870

我将 Kris 的上述答案移植到了 JavaScript。在尝试了许多不同的答案后，他提供了正确的观点。我以为我疯了，我没有得到我需要的分数。

```
function getLineLineCollision(p0, p1, p2, p3) {
    var s1, s2;
    s1 = {x: p1.x - p0.x, y: p1.y - p0.y};
    s2 = {x: p3.x - p2.x, y: p3.y - p2.y};

    var s10_x = p1.x - p0.x;
    var s10_y = p1.y - p0.y;
    var s32_x = p3.x - p2.x;
    var s32_y = p3.y - p2.y;

    var denom = s10_x * s32_y - s32_x * s10_y;

    if(denom == 0) {
        return false;
    }

    var denom_positive = denom > 0;

    var s02_x = p0.x - p2.x;
    var s02_y = p0.y - p2.y;

    var s_numer = s10_x * s02_y - s10_y * s02_x;

    if((s_numer < 0) == denom_positive) {
        return false;
    }

    var t_numer = s32_x * s02_y - s32_y * s02_x;

    if((t_numer < 0) == denom_positive) {
        return false;
    }

    if((s_numer > denom) == denom_positive || (t_numer > denom) == denom_positive) {
        return false;
    }

    var t = t_numer / denom;

    var p = {x: p0.x + (t * s10_x), y: p0.y + (t * s10_y)};
    return p;
} 
```

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2014-05-08T19:55:59.217

这基于 Gareth Ree 的回答。如果确实如此，它还会返回线段的重叠。V 用 C++ 编码，是一个简单的向量类。其中 2D 中两个向量的叉积返回单个标量。经我校自动测试系统测试通过。

```
//Required input point must be colinear with the line
bool on_segment(const V& p, const LineSegment& l)
{
    //If a point is on the line, the sum of the vectors formed by the point to the line endpoints must be equal
    V va = p - l.pa;
    V vb = p - l.pb;
    R ma = va.magnitude();
    R mb = vb.magnitude();
    R ml = (l.pb - l.pa).magnitude();
    R s = ma + mb;
    bool r = s <= ml + epsilon;
    return r;
}

//Compute using vector math
// Returns 0 points if the lines do not intersect or overlap
// Returns 1 point if the lines intersect
//  Returns 2 points if the lines overlap, contain the points where overlapping start starts and stop
std::vector<V> intersect(const LineSegment& la, const LineSegment& lb)
{
    std::vector<V> r;

    //http://stackoverflow.com/questions/563198/how-do-you-detect-where-two-line-segments-intersect
    V oa, ob, da, db; //Origin and direction vectors
    R sa, sb; //Scalar values
    oa = la.pa;
    da = la.pb - la.pa;
    ob = lb.pa;
    db = lb.pb - lb.pa;

    if (da.cross(db) == 0 && (ob - oa).cross(da) == 0) //If colinear
    {
        if (on_segment(lb.pa, la) && on_segment(lb.pb, la))
        {
            r.push_back(lb.pa);
            r.push_back(lb.pb);
            dprintf("colinear, overlapping\n");
            return r;
        }

        if (on_segment(la.pa, lb) && on_segment(la.pb, lb))
        {
            r.push_back(la.pa);
            r.push_back(la.pb);
            dprintf("colinear, overlapping\n");
            return r;
        }

        if (on_segment(la.pa, lb))
            r.push_back(la.pa);

        if (on_segment(la.pb, lb))
            r.push_back(la.pb);

        if (on_segment(lb.pa, la))
            r.push_back(lb.pa);

        if (on_segment(lb.pb, la))
            r.push_back(lb.pb);

        if (r.size() == 0)
            dprintf("colinear, non-overlapping\n");
        else
            dprintf("colinear, overlapping\n");

        return r;
    }

    if (da.cross(db) == 0 && (ob - oa).cross(da) != 0)
    {
        dprintf("parallel non-intersecting\n");
        return r;
    }

    //Math trick db cross db == 0, which is a single scalar in 2D.
    //Crossing both sides with vector db gives:
    sa = (ob - oa).cross(db) / da.cross(db);

    //Crossing both sides with vector da gives
    sb = (oa - ob).cross(da) / db.cross(da);

    if (0 <= sa && sa <= 1 && 0 <= sb && sb <= 1)
    {
        dprintf("intersecting\n");
        r.push_back(oa + da * sa);
        return r;
    }

    dprintf("non-intersecting, non-parallel, non-colinear, non-overlapping\n");
    return r;
} 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2013-05-03T20:48:16.070

我尝试了很多方法，然后我决定自己写。所以这里是：

```
bool IsBetween (float x, float b1, float b2)
{
   return ( ((x >= (b1 - 0.1f)) && 
        (x <= (b2 + 0.1f))) || 
        ((x >= (b2 - 0.1f)) &&
        (x <= (b1 + 0.1f))));
}

bool IsSegmentsColliding(   POINTFLOAT lineA,
                POINTFLOAT lineB,
                POINTFLOAT line2A,
                POINTFLOAT line2B)
{
    float deltaX1 = lineB.x - lineA.x;
    float deltaX2 = line2B.x - line2A.x;
    float deltaY1 = lineB.y - lineA.y;
    float deltaY2 = line2B.y - line2A.y;

    if (abs(deltaX1) < 0.01f && 
        abs(deltaX2) < 0.01f) // Both are vertical lines
        return false;
    if (abs((deltaY1 / deltaX1) -
        (deltaY2 / deltaX2)) < 0.001f) // Two parallel line
        return false;

    float xCol = (  (   (deltaX1 * deltaX2) * 
                        (line2A.y - lineA.y)) - 
                    (line2A.x * deltaY2 * deltaX1) + 
                    (lineA.x * deltaY1 * deltaX2)) / 
                 ((deltaY1 * deltaX2) - (deltaY2 * deltaX1));
    float yCol = 0;
    if (deltaX1 < 0.01f) // L1 is a vertical line
        yCol = ((xCol * deltaY2) + 
                (line2A.y * deltaX2) - 
                (line2A.x * deltaY2)) / deltaX2;
    else // L1 is acceptable
        yCol = ((xCol * deltaY1) +
                (lineA.y * deltaX1) -
                (lineA.x * deltaY1)) / deltaX1;

    bool isCol =    IsBetween(xCol, lineA.x, lineB.x) &&
            IsBetween(yCol, lineA.y, lineB.y) &&
            IsBetween(xCol, line2A.x, line2B.x) &&
            IsBetween(yCol, line2A.y, line2B.y);
    return isCol;
} 
```

基于这两个公式：（我从线方程和其他公式中简化了它们）

![x 的公式](https://i.stack.imgur.com/2LlDi.gif)

![y 的公式](https://i.stack.imgur.com/epU5A.gif)

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2016-05-24T07:18:22.693

这是 C# 中线段的基本实现，以及相应的交叉点检测代码。它需要一个名为 的 2D 矢量/点结构`Vector2f`，但您可以将其替换为具有 X/Y 属性的任何其他类型。如果更适合您的需求，您也可以替换`float`为。`double`

此代码在我的 .NET 物理库[Boing](https://github.com/drewnoakes/boing)中使用。

```
public struct LineSegment2f
{
    public Vector2f From { get; }
    public Vector2f To { get; }

    public LineSegment2f(Vector2f @from, Vector2f to)
    {
        From = @from;
        To = to;
    }

    public Vector2f Delta => new Vector2f(To.X - From.X, To.Y - From.Y);

    /// <summary>
    /// Attempt to intersect two line segments.
    /// </summary>
    /// <remarks>
    /// Even if the line segments do not intersect, <paramref name="t"/> and <paramref name="u"/> will be set.
    /// If the lines are parallel, <paramref name="t"/> and <paramref name="u"/> are set to <see cref="float.NaN"/>.
    /// </remarks>
    /// <param name="other">The line to attempt intersection of this line with.</param>
    /// <param name="intersectionPoint">The point of intersection if within the line segments, or empty..</param>
    /// <param name="t">The distance along this line at which intersection would occur, or NaN if lines are collinear/parallel.</param>
    /// <param name="u">The distance along the other line at which intersection would occur, or NaN if lines are collinear/parallel.</param>
    /// <returns><c>true</c> if the line segments intersect, otherwise <c>false</c>.</returns>
    public bool TryIntersect(LineSegment2f other, out Vector2f intersectionPoint, out float t, out float u)
    {
        var p = From;
        var q = other.From;
        var r = Delta;
        var s = other.Delta;

        // t = (q − p) × s / (r × s)
        // u = (q − p) × r / (r × s)

        var denom = Fake2DCross(r, s);

        if (denom == 0)
        {
            // lines are collinear or parallel
            t = float.NaN;
            u = float.NaN;
            intersectionPoint = default(Vector2f);
            return false;
        }

        var tNumer = Fake2DCross(q - p, s);
        var uNumer = Fake2DCross(q - p, r);

        t = tNumer / denom;
        u = uNumer / denom;

        if (t < 0 || t > 1 || u < 0 || u > 1)
        {
            // line segments do not intersect within their ranges
            intersectionPoint = default(Vector2f);
            return false;
        }

        intersectionPoint = p + r * t;
        return true;
    }

    private static float Fake2DCross(Vector2f a, Vector2f b)
    {
        return a.X * b.Y - a.Y * b.X;
    }
} 
```

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2015-02-08T05:32:34.097

**用于检查两个给定线段是否相交的 C++ 程序**

```
#include <iostream>
using namespace std;

struct Point
{
    int x;
    int y;
};

// Given three colinear points p, q, r, the function checks if
// point q lies on line segment 'pr'
bool onSegment(Point p, Point q, Point r)
{
    if (q.x <= max(p.x, r.x) && q.x >= min(p.x, r.x) &&
        q.y <= max(p.y, r.y) && q.y >= min(p.y, r.y))
       return true;

    return false;
}

// To find orientation of ordered triplet (p, q, r).
// The function returns following values
// 0 --> p, q and r are colinear
// 1 --> Clockwise
// 2 --> Counterclockwise
int orientation(Point p, Point q, Point r)
{
    // See 10th slides from following link for derivation of the formula
    // http://www.dcs.gla.ac.uk/~pat/52233/slides/Geometry1x1.pdf
    int val = (q.y - p.y) * (r.x - q.x) -
              (q.x - p.x) * (r.y - q.y);

    if (val == 0) return 0;  // colinear

    return (val > 0)? 1: 2; // clock or counterclock wise
}

// The main function that returns true if line segment 'p1q1'
// and 'p2q2' intersect.
bool doIntersect(Point p1, Point q1, Point p2, Point q2)
{
    // Find the four orientations needed for general and
    // special cases
    int o1 = orientation(p1, q1, p2);
    int o2 = orientation(p1, q1, q2);
    int o3 = orientation(p2, q2, p1);
    int o4 = orientation(p2, q2, q1);

    // General case
    if (o1 != o2 && o3 != o4)
        return true;

    // Special Cases
    // p1, q1 and p2 are colinear and p2 lies on segment p1q1
    if (o1 == 0 && onSegment(p1, p2, q1)) return true;

    // p1, q1 and p2 are colinear and q2 lies on segment p1q1
    if (o2 == 0 && onSegment(p1, q2, q1)) return true;

    // p2, q2 and p1 are colinear and p1 lies on segment p2q2
    if (o3 == 0 && onSegment(p2, p1, q2)) return true;

     // p2, q2 and q1 are colinear and q1 lies on segment p2q2
    if (o4 == 0 && onSegment(p2, q1, q2)) return true;

    return false; // Doesn't fall in any of the above cases
}

// Driver program to test above functions
int main()
{
    struct Point p1 = {1, 1}, q1 = {10, 1};
    struct Point p2 = {1, 2}, q2 = {10, 2};

    doIntersect(p1, q1, p2, q2)? cout << "Yes\n": cout << "No\n";

    p1 = {10, 0}, q1 = {0, 10};
    p2 = {0, 0}, q2 = {10, 10};
    doIntersect(p1, q1, p2, q2)? cout << "Yes\n": cout << "No\n";

    p1 = {-5, -5}, q1 = {0, 0};
    p2 = {1, 1}, q2 = {10, 10};
    doIntersect(p1, q1, p2, q2)? cout << "Yes\n": cout << "No\n";

    return 0;
} 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2016-04-05T02:52:47.243

基于@Gareth Rees 的回答，Python 版本：

```
import numpy as np

def np_perp( a ) :
    b = np.empty_like(a)
    b[0] = a[1]
    b[1] = -a[0]
    return b

def np_cross_product(a, b):
    return np.dot(a, np_perp(b))

def np_seg_intersect(a, b, considerCollinearOverlapAsIntersect = False):
    # https://stackoverflow.com/questions/563198/how-do-you-detect-where-two-line-segments-intersect/565282#565282
    # http://www.codeproject.com/Tips/862988/Find-the-intersection-point-of-two-line-segments
    r = a[1] - a[0]
    s = b[1] - b[0]
    v = b[0] - a[0]
    num = np_cross_product(v, r)
    denom = np_cross_product(r, s)
    # If r x s = 0 and (q - p) x r = 0, then the two lines are collinear.
    if np.isclose(denom, 0) and np.isclose(num, 0):
        # 1\. If either  0 <= (q - p) * r <= r * r or 0 <= (p - q) * s <= * s
        # then the two lines are overlapping,
        if(considerCollinearOverlapAsIntersect):
            vDotR = np.dot(v, r)
            aDotS = np.dot(-v, s)
            if (0 <= vDotR  and vDotR <= np.dot(r,r)) or (0 <= aDotS  and aDotS <= np.dot(s,s)):
                return True
        # 2\. If neither 0 <= (q - p) * r = r * r nor 0 <= (p - q) * s <= s * s
        # then the two lines are collinear but disjoint.
        # No need to implement this expression, as it follows from the expression above.
        return None
    if np.isclose(denom, 0) and not np.isclose(num, 0):
        # Parallel and non intersecting
        return None
    u = num / denom
    t = np_cross_product(v, s) / denom
    if u >= 0 and u <= 1 and t >= 0 and t <= 1:
        res = b[0] + (s*u)
        return res
    # Otherwise, the two line segments are not parallel but do not intersect.
    return None 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-02-18T22:53:00.050

如果矩形的每一边都是一条线段，而用户绘制的部分是一条线段，那么您只需检查用户绘制的线段是否与四个边线段相交。考虑到每个段的起点和终点，这应该是一个相当简单的练习。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2014-09-26T15:22:04.650

基于 t3chb0t 的回答：

```
int intersezione_linee(int x1, int y1, int x2, int y2, int x3, int y3, int x4, int y4, int& p_x, int& p_y)
{
   //L1: estremi (x1,y1)(x2,y2) L2: estremi (x3,y3)(x3,y3)
   int d;
   d = (x1-x2)*(y3-y4) - (y1-y2)*(x3-x4);
   if(!d)
       return 0;
   p_x = ((x1*y2-y1*x2)*(x3-x4) - (x1-x2)*(x3*y4-y3*x4))/d;
   p_y = ((x1*y2-y1*x2)*(y3-y4) - (y1-y2)*(x3*y4-y3*x4))/d;
   return 1;
}

int in_bounding_box(int x1, int y1, int x2, int y2, int p_x, int p_y)
{
    return p_x>=x1 && p_x<=x2 && p_y>=y1 && p_y<=y2;

}

int intersezione_segmenti(int x1, int y1, int x2, int y2, int x3, int y3, int x4, int y4, int& p_x, int& p_y)
{
    if (!intersezione_linee(x1,y1,x2,y2,x3,y3,x4,y4,p_x,p_y))
        return 0;

    return in_bounding_box(x1,y1,x2,y2,p_x,p_y) && in_bounding_box(x3,y3,x4,y4,p_x,p_y);
} 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2016-04-20T21:14:45.280

许多答案已将所有计算都包含在一个函数中。如果您需要计算直线斜率、y 轴截距或 x 轴截距以在代码中的其他位置使用，那么您将冗余地进行这些计算。我已经分离出各自的函数，使用了明显的变量名，并注释了我的代码以使其更容易理解。我需要知道线是否无限相交超出其端点，所以在 JavaScript 中：

[http://jsfiddle.net/skibulk/evmqq00u/](http://jsfiddle.net/skibulk/evmqq00u/)

```
var point_a = {x:0, y:10},
    point_b = {x:12, y:12},
    point_c = {x:10, y:0},
    point_d = {x:0, y:0},
    slope_ab = slope(point_a, point_b),
    slope_bc = slope(point_b, point_c),
    slope_cd = slope(point_c, point_d),
    slope_da = slope(point_d, point_a),
    yint_ab = y_intercept(point_a, slope_ab),
    yint_bc = y_intercept(point_b, slope_bc),
    yint_cd = y_intercept(point_c, slope_cd),
    yint_da = y_intercept(point_d, slope_da),
    xint_ab = x_intercept(point_a, slope_ab, yint_ab),
    xint_bc = x_intercept(point_b, slope_bc, yint_bc),
    xint_cd = x_intercept(point_c, slope_cd, yint_cd),
    xint_da = x_intercept(point_d, slope_da, yint_da),
    point_aa = intersect(slope_da, yint_da, xint_da, slope_ab, yint_ab, xint_ab),
    point_bb = intersect(slope_ab, yint_ab, xint_ab, slope_bc, yint_bc, xint_bc),
    point_cc = intersect(slope_bc, yint_bc, xint_bc, slope_cd, yint_cd, xint_cd),
    point_dd = intersect(slope_cd, yint_cd, xint_cd, slope_da, yint_da, xint_da);

console.log(point_a, point_b, point_c, point_d);
console.log(slope_ab, slope_bc, slope_cd, slope_da);
console.log(yint_ab, yint_bc, yint_cd, yint_da);
console.log(xint_ab, xint_bc, xint_cd, xint_da);
console.log(point_aa, point_bb, point_cc, point_dd);

function slope(point_a, point_b) {
  var i = (point_b.y - point_a.y) / (point_b.x - point_a.x);
  if (i === -Infinity) return Infinity;
  if (i === -0) return 0;
  return i;
}

function y_intercept(point, slope) {
    // Horizontal Line
    if (slope == 0) return point.y;
  // Vertical Line
    if (slope == Infinity)
  {
    // THE Y-Axis
    if (point.x == 0) return Infinity;
    // No Intercept
    return null;
  }
  // Angled Line
  return point.y - (slope * point.x);
}

function x_intercept(point, slope, yint) {
    // Vertical Line
    if (slope == Infinity) return point.x;
  // Horizontal Line
    if (slope == 0)
  {
    // THE X-Axis
    if (point.y == 0) return Infinity;
    // No Intercept
    return null;
  }
  // Angled Line
  return -yint / slope;
}

// Intersection of two infinite lines
function intersect(slope_a, yint_a, xint_a, slope_b, yint_b, xint_b) {
  if (slope_a == slope_b)
  {
    // Equal Lines
    if (yint_a == yint_b && xint_a == xint_b) return Infinity;
    // Parallel Lines
    return null;
  }
  // First Line Vertical
    if (slope_a == Infinity)
  {
    return {
        x: xint_a,
      y: (slope_b * xint_a) + yint_b
    };
  }
  // Second Line Vertical
    if (slope_b == Infinity)
  {
    return {
        x: xint_b,
      y: (slope_a * xint_b) + yint_a
    };
  }
  // Not Equal, Not Parallel, Not Vertical
  var i = (yint_b - yint_a) / (slope_a - slope_b);
  return {
    x: i,
    y: (slope_a * i) + yint_a
  };
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2015-09-08T18:15:44.603

我从“多视图几何”一书中阅读了这些算法

以下文字使用

' 作为转置符号

* 作为点积

x 作为叉积，当用作运算符时

### 1.线定义

一个点 x_vec = (x, y)' 位于 ax + by + c = 0 线上

我们将 L = (a, b, c)' 表示为 (x, y, 1)' 的点为齐次坐标

线方程可以写成

(x, y, 1)(a, b, c)' = 0 或 x' * L = 0

### 2\. 线的交点

我们有两条线 L1=(a1, b1, c1)', L2=(a2, b2, c2)'

假设 x 是一个点、一个向量，并且 x = L1 x L2（L1 叉积 L2）。

请注意，x 始终是 2D 点，如果您对 (L1xL2) 是三元素向量感到困惑，请阅读齐次坐标，而 x 是 2D 坐标。

根据三重产品，我们知道

L1 * ( L1 x L2 ) = 0，并且 L2 * (L1 x L2) = 0，因为 L1,L2 共平面

我们将 (L1xL2) 替换为向量 x，然后我们有 L1*x=0，L2*x=0，这意味着 x 位于 L1 和 L2 上，x 是交点。

注意，这里x是齐次坐标，如果x的最后一个元素为零，则表示L1和L2平行。

# javascript - 是否可以确定命名窗口是否在 JavaScript 中打开？

> ID：563199
> 
> 赞同：5
> 
> 时间：2009-02-18T22:47:43.903
> 
> 标签：javascript

我正在处理一个站点间单点登录项目，并且在我的腿上遇到了一个很小的问题。当用户退出“父”站点时，需要在包含“子”站点的弹出窗口中加载特定页面。但是，我无法存储对 的返回值的引用`window.open(…)`，因为必须允许用户在注销之前在每个站点上导航到他们喜欢的任何位置。

如果我可以假设子站点始终处于打开状态，这将很容易，因为另一个`window.open(…)`同名窗口会更改其 URL。但是，如果弹出窗口尚未打开（并非所有用户都可以访问子站点），则无法显示**弹出窗口。**

我认为这给了我两个相互矛盾的场景。当用户访问子站点时：

1.  用户登录到父站点。
2.  用户点击子站点的链接
3.  子站点出现在名为“child_popup”的窗口中。
4.  用户在父站点中广泛浏览，忘记了子窗口的存在。
5.  用户从父站点注销。
6.  子弹出窗口被重定向到子站点的注销页面。

当用户不访问或无法访问子站点时：

1.  用户登录到父站点。
2.  用户在父站点中广泛浏览。
3.  用户从父站点注销。
4.  不应出现弹出窗口！

所以我的限制是：

*   我无法在 JS 中存储对窗口的引用，因为用户可以在访问子站点和注销之间导航到任意数量的页面。
*   我对子站点的内容的控制**为零（我的雇主运行父站点）。**
*   无法将父站点转换为框架以提供“全局”JS 范围。:-)

我无法在 Google 或 SO 上找到任何相关资源。有没有办法做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T00:24:03.063

是的，您可以，但要遵守一项重要限制。

它取决于以下行为：

1.  window.open 的前 2 个参数是 URL 和窗口名称
2.  window.open 返回对窗口的引用
3.  如果已使用指定名称打开一个窗口，则返回对该窗口的引用而不是对新窗口的引用
4.  ***如果 URL 为 NULL，现有窗口将不会导航到新页面***

这意味着您可以获得对现有窗口的引用，而不会丢失该窗口已打开的页面。*但是，如果不*存在具有该名称的窗口，*它将*被打开。

[我们在http://carbonlogic.co.uk/](http://carbonlogic.co.uk/)上使用了这种方法，但由于 Flash Player 问题，弹出窗口的内容目前无法正常工作

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-26T01:21:49.263

我们无法找到检测子站点窗口是否*仍然*打开的方法，但我们想出了一个解决方法，可以满足我们的业务需求：

1.  启动子弹出窗口时从父站点设置 cookie A。
2.  在每次页面加载时从子站点设置 cookie B。
3.  *在每个未*加载的页面上从子站点清除 cookie B。
4.  退出父站点时：
    1.  如果设置了 cookie A，请将其清除并关闭与子站点的本地连接。
    2.  如果设置了 cookie B，请将其清除并在弹出窗口中打开子注销页面。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T23:23:42.507

使用会话来存储弹出窗口的状态。

当用户单击链接打开子站点时，您需要对记录该用户已打开子站点窗口的父服务器进行异步 javascript 调用。或者让链接打开一个页面，该页面存储以下会话信息并返回 Location: 标头。

（注意我使用的是 php，$_SESSION[...] 是存储在请求之间的用户特定的数据数组）

```
$_SESSION['inChildSite'] = true; 
```

当用户从父站点注销时，会再次检查此值，或者通过异步 javascript 调用，或者通过注销脚本。

```
if ($_SESSION['inChildSite'] ==true ) 
     echo "<script>window.open(...)</script>" 
```

然后显示注销子窗口。确保在注销发生时取消设置会话变量。

瞧，利润。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T02:55:55.520

听起来您可以控制子窗口的内容...如果是这样，您可以在第一次加载子窗口时尝试设置“window.opener.some_attr = true”。

因此，您在父窗口中的代码可以执行“if (window.some_attr) window.open(...)”或相反的“if (!window.some_attr) alert('no access')...”

# javascript - 使用 Prototype 读取特定表列

> ID：563201
> 
> 赞同：1
> 
> 时间：2009-02-18T22:49:03.947
> 
> 标签：javascript, prototypejs

我需要读取 HTML 表的第一列的所有值，并且我不想使用 DOM 方法。我想要一个使用 Prototype 或 YUI 的更简单的解决方案。

注意：表格是由外部团队提供的网格小部件生成的。这就是为什么我们不能确定使用了哪些 ID 或类名。

简而言之，我想要类似的东西：

```
For each row in table XXX
   value = row.column[1].value
   do something with value ...
End For 
```

提前致谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T15:24:26.467

您应该能够执行 $$('tr td:first-child') 之类的操作，它应该从每个 tr 中获取第一个 td。然后，您应该能够使用 .innerHTML 来获取值。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T22:54:19.597

可能`$$('tr')`会起作用。[它根据 CSS 规则](http://www.prototypejs.org/api/utility/dollar-dollar)返回一个元素数组。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-20T22:45:51.537

使用原型

```
$('thetable').childElements()[0].childElements().invoke('firstDescendant'); 
```

这一切都是级联的。第一个 $('thetable') 获取表格。我知道您想要最小的 DOM，但显然您需要识别表。

第二个将所有 childElements 作为一个数组获取并获取第一个作为 tbody 项的元素。

接下来它会抓取这些元素的子元素，这些子元素提供了一组表格行。

最后一个调用 invoke() 对该数组中的每个元素调用一个函数。在这种情况下，firstDescendant。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-20T23:01:44.057

这将为您提供第一列中所有文本值的数组

```
var arr = $$('tr:first-child').pluck('innerText'); 
```

[采摘](http://www.prototypejs.org/api/enumerable/pluck)

[$$](http://www.prototypejs.org/api/utility/dollar-dollar)

# asp.net - 有谁知道 RenderAction HtmlHelper 在 RC1 的 ASP.NET MVC 中的位置

> ID：563203
> 
> 赞同：4
> 
> 时间：2009-02-18T22:50:11.323
> 
> 标签：asp.net, asp.net-mvc

有没有人可以替代 RenderAction HtmlHelper 看到它在 RC1 中消失了。

我需要呈现用户控件，但使用不同的控制器来填充用户控件视图。

这现在如何运作？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-18T23:01:31.467

使用位于[http://www.codeplex.com/aspnet/Release/ProjectReleases.aspx?ReleaseId=22359](http://www.codeplex.com/aspnet/Release/ProjectReleases.aspx?ReleaseId=22359)`Microsoft.Web.Mvc`的命名空间（称为 MVC Futures）

它包括一个 HtmlHelper 方法 ( `Html.RenderAction`)，该方法调用不同控制器上的操作。

# trac - 有人知道 trac 的插件（或服务）电子邮件自动回复器吗？

> ID：563205
> 
> 赞同：0
> 
> 时间：2009-02-18T22:50:42.040
> 
> 标签：trac, issue-tracking, auto-responder

Eric Willis 对这个问题的回答：

[https://stackoverflow.com/questions/563041/receive-emails-in-a-net-service-c](https://stackoverflow.com/questions/563041/receive-emails-in-a-net-service-c)

促使我开始考虑创建一个通用的（最初仅用于 trac）自动回复器和问题创建者，它会监听一些“支持”电子邮件帐户，在您的问题跟踪器中创建问题并使用问题 ID 回复客户。（我喜欢fogbugz的实现，但我有其他项目买不起许可证）

我正在考虑开源这个，所以如果还有其他工作/项目，请告诉我。

目标是使这个通用性能够使用许多不同的输入（现在流行电子邮件）和许多不同的问题跟踪器（现在是 trac）

我还认为让它像 bugzilla 和其他人那样做“抱怨”（每周/定期发送电子邮件，用于开放分配的任务）——或者这可能只是另一种共享代码的服务......

所以，我认为问题是：有人知道现有的开源项目吗？如果没有，我想我会开始一个。我可能会在 .NET/Mono 中执行此操作，但我不确定作为服务运行的含义以及非 Win32 操作系统的含义...

我怀疑最大的问题将是：

*   垃圾邮件以及如何/在哪里处理它
*   外发电子邮件集成 - 从您的支持发送给客户的电子邮件并与问题集成（CC 字段有效，但并不理想）
*   将电子邮件解析到支持地址，以便仅添加新信息而不是现有信息 - 特别是当电子邮件与问题/响应混合时......

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T22:52:19.570

它已经存在于 trac 中。它被称为[email2trac](https://subtrac.sara.nl/oss/email2trac/)

我刚刚查看了来自 email2trac 的票证电子邮件，票号在主题行中。

# sharepoint - 使用来自内容类型的图像的 CQWP 的 Sharepoint ItemStyle.xsl

> ID：563215
> 
> 赞同：5
> 
> 时间：2009-02-18T22:54:47.147
> 
> 标签：sharepoint, xslt, cqwp

我正在构建一个自定义内容查询 Web 部件来显示来自员工内容类型的汇总信息。此内容类型有一个名为 EmpPhoto 的发布图像网站栏。我的 CQWP 运行良好，我需要的所有网站栏都可用。

我现在正在创建一个自定义 xsl 模板以正确呈现信息，但使用 EmpPhoto 图像时卡住了。

如果我使用代码：

```
<xsl:value-of select="@EmpPhoto" disable-output-escaping="yes" /> 
```

...我得到了一个正确渲染的图像，这很棒。但是我想为这个图像构建一个 onmouseover 事件，这种方法不起作用。

我想创建一个 xsl 变量来获取实际的图像 URL，然后构建我自己的 html img 并将 onmouseover 写入其中，例如

```
<xsl:variable name="EmpPhotoUrl">
    <xsl:call-template name="OuterTemplate.GetSafeStaticUrl">
        <xsl:with-param name="UrlColumnName" select="@EmpPhoto"/>
    </xsl:call-template>
</xsl:variable> 
```

...

```
<img src="{$EmpPhotoUrl}" onmouseover="" alt="test" /> 
```

但是，这不会从 EmpPhoto 站点列中获取 URL。我是 xsl 的新手，所以我很可能会错过一个明显的解决方案！

非常感谢任何帮助，

强尼

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T06:03:17.770

这是作弊......它正在对 src 属性做出假设。但在这里！

```
<xsl:variable name="EmpPhotoUrl" select="substring-before(substring-after(@EmpPhoto, 'src=&quot;'), '&quot;')" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-18T23:00:53.713

鉴于 @EmpPhoto 值只是一个表示 html 图像标签的字符串，您可以将鼠标悬停脚本“注入”到该值中，例如

```
<xsl:variable name="EmpPhoto"><xsl:value-of select=sub-string(@EmpPhoto) />[and some other code to add the mouseover etc]</xsl:variable>

<xsl:value-of select="$EmpPhoto" /> 
```

# javascript - Jslint“换行错误”

> ID：563218
> 
> 赞同：7
> 
> 时间：2009-02-18T22:55:51.137
> 
> 标签：javascript, jslint

此代码段的 JSLint 验证

```
1: function foo() {}
2: 
3: foo(1
4: );
5: 
6: foo(
7: ); 
```

给出这个错误：

```
错误：

第 3 行字符 5 处的问题：换行错误 ')'。

富（1

```

这是一个 JSLint 错误吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-18T23:14:11.420

这不是一个错误。JSLint 不仅仅是语法检查：它强制执行某些编码约定。如果您在启用“容忍马虎换行”选项的情况下重新验证​​，您将不会收到错误消息。

来自[JSLint 文档](http://www.jslint.com/lint.html)：

> **换行**
> 
> 作为对分号插入机制的进一步防御，JSLint 期望长语句仅在以下标点字符或运算符之一之后被破坏：
> 
> , . ; : { } ( [ = < > ? ! + - * / % ~ ^ | & == != <= >= += -= *= /= %= ^= |= &= << >> || && === !== <<= >>= >>> >>>=
> 
> JSLint 不希望在标识符、字符串、数字、更接近或后缀运算符之后看到长语句中断：
> 
> ) ] ++ --
> 
> JSLint 允许您打开 Tolerate sloppy line break (laxbreak) 选项。
> 
> 分号插入可以掩盖复制/粘贴错误。如果你总是在运算符后面换行，那么 JSLint 可以更好地找到它们。

# c++ - C++ 中是否存在隐式默认构造函数？

> ID：563221
> 
> 赞同：64
> 
> 时间：2009-02-18T22:56:47.593
> 
> 标签：c++, constructor

在我目前正在阅读的书中（[C++ without Fear](https://rads.stackoverflow.com/amzn/click/com/0321246950)）中说，如果您不为类声明默认构造函数，编译器会为您提供一个，它“将每个数据成员清零”。我已经对此进行了实验，但没有看到任何归零行为。我在谷歌上也找不到任何提到这一点的东西。这只是特定编译器的错误还是怪癖？

* * *

## 回答 #1

> 赞同：68
> 
> 时间：2009-02-18T23:21:36.020

如果你不定义构造函数，编译器会为你定义一个默认构造函数。

## 建造

这个的实施

### 默认构造函数是：

*   默认构造基类（如果基类没有默认构造函数，这是编译失败）
*   default 按照声明的顺序构造每个成员变量。（如果成员没有默认构造函数，这是编译失败）。

注意：
POD 数据（int、float、pointer 等）没有显式构造函数，但默认操作是什么都不做（在 C++ 哲学的风向标中；除非我们明确要求，否则我们不想为某事付费它）。

## 复制

如果没有定义析构函数/复制构造函数/复制赋值运算符，编译器会为您构建其中一个（因此一个类总是有一个析构函数/复制构造函数/赋值运算符（除非您作弊并明确声明一个但没有定义它）） .
默认实现是：

### 析构函数：

*   如果定义了用户定义的析构函数，则执行提供的代码。
*   以声明的相反顺序调用每个成员的析构函数
*   调用基类的析构函数。

### 复制构造函数：

*   调用基类复制构造函数。
*   按声明顺序调用每个成员变量的复制构造函数。

### 复制赋值运算符：

*   调用基类赋值运算符
*   按声明顺序调用每个成员变量的复制赋值运算符。
*   返回对此的引用。

注意 POD Data 的复制构造/赋值运算符只是复制数据（因此与 RAW 指针相关的浅拷贝问题）。

## 移动

如果没有定义析构函数/复制构造函数/复制赋值/移动构造函数/移动赋值运算符，编译器会为您构建移动运算符之一。
默认实现是：

隐式声明的移动构造函数如果没有为类类型（结构、类或联合）提供用户定义的移动构造函数，并且以下所有情况都为真：

### 移动构造函数：

*   调用基类复制构造函数。
*   按声明顺序为每个成员变量调用移动构造函数。

### 移动赋值运算符：

*   调用基类赋值运算符
*   按声明顺序调用每个成员变量的移动赋值运算符。
*   返回对此的引用。

* * *

## 回答 #2

> 赞同：42
> 
> 时间：2009-02-19T00:10:02.003

我认为值得指出的是，如果您不提供**任何构造函数**，则默认构造函数只会由编译器创建。这意味着如果您只提供一个带参数的构造函数，编译器将**不会**为您创建默认的无参数构造函数。

您的书中谈到的归零行为可能特定于特定的编译器。我一直认为它可能会有所不同，并且您应该明确初始化任何数据成员。

* * *

## 回答 #3

> 赞同：39
> 
> 时间：2011-02-13T05:59:20.490

> *   编译器会自动生成默认构造函数吗？
> *   隐式生成的默认构造函数是否执行零初始化？

如果您从法律上分析 2003 标准的语言，那么答案是**yes**和**no**。然而，**这并不是全部**，因为与用户定义的默认构造函数不同，从头开始创建对象时**并不总是使用隐式定义的默认构造函数——还有其他两种情况：***无构造*和*成员值初始化*.

“无构造”情况实际上只是一种技术性，因为它在功能上与调用*平凡*的默认构造函数没有什么不同。另一种情况更有趣：使用“()”调用成员值初始化[就像显式调用没有参数的构造函数一样]，**它绕过了技术上称为默认构造函数*的***东西。相反，它递归地对每个数据成员执行值初始化，对于原始数据类型，这最终解析**为零初始化**。

所以实际上，**编译器提供了两种不同的隐式定义的默认构造函数**。其中一个执行原始成员数据的零初始化，而另一个*不执行。*以下是如何调用每种类型的构造函数的一些示例：

```
 MyClass a; // default-construction or no construction
    MyClass b = MyClass(); // member-wise value-initialization 
```

和

```
 new MyClass; // default-construction or no construction
    new MyClass(); // member-wise value-initialization 
```

注意：如果*确实存在***用户声明的**默认构造函数，则成员值初始化只需调用它并停止。

 ** * *

以下是该标准对此内容的详细说明...

*   如果不声明构造函数，编译器会隐式创建默认构造函数 [12.1-5]

*   默认构造函数**不**初始化原始类型 [12.1-7]

    ```
     MyClass() {} // implicitly defined constructor 
    ```

*   如果使用“()”初始化对象，则不会直接调用默认构造函数。相反，它引发了一长串称为*值初始化*的规则[8.5-7]

*   值初始化的最终结果是**隐式声明的默认构造函数永远不会被调用**。相反，调用递归的成员值初始化，这将最终**对任何原始成员进行零初始化**，并在具有用户声明的构造函数的任何成员上调用默认构造函数 [8.5-5]

*   值初始化甚至适用于原始类型——它们将被零初始化。[8.5-5]

    ```
     int a = int(); // equivalent to int a = 0; 
    ```

* * *

对于大多数目的而言，所有这些都没有实际意义。类的编写者通常不能假设数据成员将在隐式初始化序列期间清零——因此，如果任何自管理类具有任何需要初始化的原始数据成员，则应定义其自己的构造函数。

那么这在什么时候重要呢？

*   可能存在泛型代码想要强制初始化未知类型的情况。值初始化提供了一种方法来做到这一点。请记住，如果用户提供了构造函数，则不会发生隐式零初始化。

*   默认情况下，std::vector 包含的数据是值初始化的。这可以防止内存调试器识别与否则未初始化的内存缓冲区相关的逻辑错误。

    ```
     vector::resize( size_type sz, T c=T() ); // default c is "value-initialized" 
    ```

*   原始类型或“plain-old-data”（POD）类型结构的整个数组可以使用值初始化语法进行零初始化。

    ```
     new int[100](); 
    ```

* * *

[这篇文章](https://stackoverflow.com/questions/1613341/what-do-the-following-phrases-mean-in-c-zero-default-and-value-initializati/1613578#1613578)有更多关于标准版本之间变化的详细信息，它还指出了标准在主要编译器中应用不同的情况。

* * *

## 回答 #4

> 赞同：22
> 
> 时间：2009-02-18T22:58:28.713

C++ 确实会生成一个默认构造函数，但前提是您不提供自己的构造函数。该标准没有说明将数据成员归零。默认情况下，当您第一次构造任何对象时，它们是未定义的。

这可能会令人困惑，因为大多数 C++ 原始类型都具有将它们初始化为零的默认“构造函数”（int()、bool()、double()、long()*等*），但编译器不会调用他们像对对象成员一样初始化 POD 成员。

值得注意的是，STL**确实**使用这些构造函数来默认构造包含原始类型的容器的内容。您可以查看[这个问题](https://stackoverflow.com/questions/507971/does-stl-map-initializes-primitive-types-on-insert/508010#508010)，了解有关 STL 容器中的事物如何被初始化的更多详细信息。

* * *

## 回答 #5

> 赞同：11
> 
> 时间：2009-02-18T23:20:48.877

为类创建的默认构造函数不会初始化内置类型，但会在所有用户定义的成员上调用默认构造函数：

```
class Foo
{
public:
     int x;
     Foo() : x(1) {}
};

class Bar
{
public:
     int y;
     Foo f;
     Foo *fp;
};

int main()
{

    Bar b1; 
    ASSERT(b1.f.x == 1); 
    // We know nothing about what b1.y is set to, or what b1.fp is set to.

    // The class members' initialization parallels normal stack initialization.
    int y;  
    Foo f; 
    Foo *fp; 
    ASSERT(f.x == 1);
    // We know nothing about what y is set to, or what fp is set to.

} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-02-18T23:03:00.510

如果不存在用户创建的构造函数和析构函数，编译器将生成默认构造函数和析构函数。这些不会修改任何数据成员的状态。

在 C++（和 C）中，不保证任何分配数据的内容。在调试配置中，一些平台会将其设置为已知值（例如 0xFEFEFEFE）以帮助识别错误，但不应依赖此值。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-02-18T22:58:17.527

C++ 不*保证*将内存清零。Java 和 C# 可以（从某种意义上说）。

一些编译器可能会，但不依赖于此。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2009-02-18T23:07:57.410

清零仅发生在全局变量中。因此，如果您的对象在全局范围内声明，则其成员将被清零：

```
class Blah
{
public:
    int x;
    int y;
};

Blah global;

int main(int argc, char **argv) {
    Blah local;
    cout<<global.x<<endl;  // will be 0
    cout<<local.x<<endl;   // will be random
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2016-01-12T23:15:11.447

在 C++11 中，编译器生成的默认构造函数被标记为 deleted ，如果：

*   该类有一个参考字段
*   或没有用户定义的默认构造函数的 const 字段
*   或没有默认初始化程序的字段，带有已删除的默认构造函数

[http://en.cppreference.com/w/cpp/language/default_constructor](http://en.cppreference.com/w/cpp/language/default_constructor)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-02-18T23:00:21.063

C++ 生成一个默认构造函数。如果需要（我相信在编译时确定），它还将生成一个默认的复制构造函数和一个默认的赋值构造函数。不过，我还没有听说过任何关于内存归零的保证。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-10-30T08:58:05.113

默认情况下，编译器不会生成默认构造函数，除非实现不需要一个 . 所以，基本上构造函数必须是一个**非平凡的构造函数**。

要使构造函数成为非平凡的构造函数，以下是任何一个都可以满足的条件：

1）类有一个虚成员函数。2) 类成员子对象或基类具有非平凡的构造函数。3) 一个类具有虚拟继承层次结构。

# objective-c - Code linting for Objective C

> ID：563225
> 
> 赞同：18
> 
> 时间：2009-02-18T22:57:28.293
> 
> 标签：objective-c, static-analysis

Are there any code linting tools for ObjectiveC?

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-18T23:06:20.673

Have a look at the [**LLVM/Clang Static Analyzer**](https://clang.llvm.org/docs/UsersManual.html#controlling-static-analyzer-diagnostics)

The LLVM/Clang static analyzer is a standalone tool that find bugs in C and Objective-C programs and it is very early in development.

A static analyzer based on **clang**. The goal of the Clang project is to create a new C, C++, Objective C and Objective C++ front-end for the LLVM compiler.

## Edit

Clang has now been integrated into Xcode and can easily be run as a menu option "Build & Analyse"

![alt text](https://clang-analyzer.llvm.org/images/analyzer_xcode.png)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2012-04-23T08:10:01.360

It's worth mentioning [OCLint](http://oclint.org/) too. It covers some things not touched by the Clang analyser, such as:

*   Complicated code - high cyclomatic complexity and NPath complexity
*   Code smells - long method, long parameter list, redundant code

Check out the [home page](http://oclint.org/) for more details.

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2015-12-01T16:16:58.703

I know it is an old question, but I will add another one static analysis tool here for the sake of completeness, **Infer, from Facebook**

You can see their [home page](http://fbinfer.com/), works with iOS and Android projects, and spare Obj-C/Java/C files

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2018-03-19T11:31:21.283

There is also the commercial tool [FauxPas](http://fauxpasapp.com), which catches a lot of code smells, but also stuff like unused graphics, translation format argument mismatch, etc.

It’s not super cheap, but I‘m a happy user. There's a time-limited trial version available, which is fully functional, as far as I know.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2019-05-24T10:22:16.603

For simple syntax stuff like enforcing number of line breaks, sorting imports, etc., also have a look at [Clang Format](https://clang.llvm.org/docs/ClangFormat.html). The easiest way to install is probably via [Homebrew](https://formulae.brew.sh/formula/clang-format).

# ruby-on-rails - 如何修复运行 Test::Unit 测试时产生的这个警告

> ID：563231
> 
> 赞同：2
> 
> 时间：2009-02-18T22:58:46.310
> 
> 标签：ruby-on-rails, ruby, forms

我在 Test::Unit 输出中收到此警告...

```
/usr/local/bin/ruby -I.:lib:test -rtest/unit -e "%w[test/functional/sessions_controller_test.rb].each { |f| require f }" | unit_diff -u
Loaded suite -e
Started
.../Users/ethan/project/mtc/contactdb/app/views/sessions/new.html.haml:30: warning: multiple values for a block parameter (0 for 1)
    from /usr/local/lib/ruby/gems/1.8/gems/haml-2.0.8/lib/haml/helpers/action_view_mods.rb:142
[...repeated eight times...] 
```

我认为相关的部分是：

```
/contactdb/app/views/sessions/new.html.haml:30: warning: 
  multiple values for a block parameter (0 for 1) 
```

查看我的 Haml 文件，我将其范围缩小到这个片段（我认为）......

```
- form_tag( recover_login_path, :method => 'get') do |f|
  %p
    = text_field_tag :email, '', { :size => '35', :maxlength => '255' } 
```

`recover_login`是一条命名路线。

我查看了 API 文档`form_tag`。似乎我的代码遵循了示例中的内容。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T23:13:23.433

`form_tag``|f|`仅当您使用模型对象时才传入表单构建器对象。

```
form_tag @user, :method => :get do |f|
  f.text_field :first_name
end 
```

但是在没有传入模型对象的情况下构建自己的表单路径，不会传入或使用块参数。

```
form_tag user_path(@user.id), :method => :get do
  text_field :user, :first_name
end 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-18T23:02:00.077

该`form_tag`块不接受任何参数。所以删除`|f|`和警告应该消失。

# deployment - 要安装多少个 wiki 实例？

> ID：563232
> 
> 赞同：2
> 
> 时间：2009-02-18T22:59:05.310
> 
> 标签：deployment, wiki, mediawiki

我被要求安装 Mediawiki 来存放公司 Intranet 的文档。此外，我被要求安装**几个**实例 - 每个贡献组一个：非技术用户安装一个，开发人员一个，管理一个，等等。这个想法是为每个组提供单独的 Web 空间。有没有办法在一个实例中实现分离？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-18T23:10:20.323

我认为您已经有一个强有力的论点：维护多个实例将是一件痛苦的事情。另外，如果所有用户都可以读/写他们所有人，那么在他们之间协调一个登录系统将是一件很痛苦的事情。

您也许可以说服您的主管，您真正需要的是一个使用多个类别的 wiki，因为这听起来更像是他真正想要的。类别可以使条目保持井井有条。您甚至可以为每个类别编写一个单独的门户页面（这肯定比为每个组维护一个新实例要少得多！）。

虽然我不建议这样做，但您可以将您的服务器设置为具有指向同一个站点的多个入口点......（即，wiki/dev、wiki/qa 都指向同一个站点）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T04:25:31.890

可以将几个 MediaWiki 作为[“wiki 家族”](http://www.mediawiki.org/wiki/Manual:Wiki_family)或“wiki 农场”连接在一起。但是，我必须同意其他评论者的观点，即如果每个人都可以访问所有内容，这将是矫枉过正，而且这不是一个庞大的群体。

[命名空间](http://www.mediawiki.org/wiki/Manual:Namespace) *“可以被认为是同一 wiki 中不同类型信息的分区，并将“真实”内容与用户配置文件、帮助页面等分开。”* 您可能有命名空间“Testing:”、“Dev:”、“Mgmt:”、“Users:”。然后你可以从这些不同的角度来写每个主题。所以页面“测试：登录”，“开发：登录”，“管理：登录”，“用户：登录”等。

然而，当你在 MediaWiki 中创建 [[links]] 时，你总是必须明确地放置命名空间（如果没有明确的命名空间，它是没有前缀的“主”命名空间）。因此，您必须教导每个小组始终将名称空间放入他们的链接和搜索中。这很烦人。如果您坚持使用命名空间之类的方法，我会推荐 PmWiki。它的“命名空间”功能称为[WikiGroups](http://www.pmwiki.org/wiki/PmWiki/WikiGroup)。创建一个“命名空间”就像创建一个链接一样简单，更重要的是，如果你在一个特定名称的页面上，默认情况下你到其他页面的链接将在同一个命名空间中。如果要链接到不同命名空间中的页面，则必须明确放置。所以这对用户来说是一个很大的优势。

但是您当然不需要去命名空间来组织 MediaWiki 中的内容。您可以使用[类别](http://www.mediawiki.org/wiki/Categories)和/或[模板](http://www.mediawiki.org/wiki/Templates)对内容进行分组。但是，如果您可能有多个小组在同一主题上写作，那么您很可能会遇到页面名称冲突。你可以让每个人都写在同一个页面上，按部分分隔不同的作者组，例如 ==Users== ==Testing== ==Dev== ==Management==。

老实说，根据您的描述，我真的只会使用 PmWiki。它非常简单有效。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-18T23:09:43.443

虽然呼唤你的主管可能会很有趣......我不得不认为部署一个单一的 Wiki 是最简单的，就像你建议的那样，在 Wiki 中使用不同的类别或部门。

此外，鉴于当前的经济状况，管理 5 或 6 个 Wiki 实施可能会增加一些工作保障......

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T23:09:37.267

命名空间的存在是有原因的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T03:04:47.340

如果您最终使用一个具有多个命名空间的 wiki，请确保在本地设置中包含[$wgNamespacesToBeSearchedDefault](http://www.mediawiki.org/wiki/Manual:$wgNamespacesToBeSearchedDefault)，以便在创建新用户帐户时默认设置为自动搜索新命名空间。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T01:22:21.847

我正在使用基于 wiki 的 trac。
（假设您的 wiki 类似于我正在使用的 wiki。）
我认为您可以安装更多的 wiki，因为它们易于维护。

当然，您可以向您的老板建议，从一个包含多个类别的 wiki 开始。
**建议：**

1.  一个 wiki 是一个更灵活的备份和恢复项目
2.  防止文档重复
3.  从一个开始（比如说，对于开发人员），然后添加其他 wiki。（当开发人员开始在wiki上工作时，您可以使用“类别版本”再次尝试，您将确切知道很多wiki的成本是多少）
4.  他对 Mediawiki 有过担忧吗？[wiki选择向导](http://www.wikimatrix.org/wizard.php)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-07-05T08:43:58.477

我建议询问任何要求你这样做的人**为什么**。这可能是为了“安全”。但是 wiki 都是关于协作的——那是它们蓬勃发展的时候。过分热心的安全考虑会扼杀维基。

我建议您为 wiki 争取一个命名空间，然后为“安全的东西”分离 wiki（或命名空间，甚至是带有内容管理的 Word 文档）。

请注意，您还可以跟踪页面浏览量。如果这被公开，它将降低安全泄漏的机会。

# php - PHP 函数 pt_register

> ID：563233
> 
> 赞同：0
> 
> 时间：2009-02-18T22:59:07.040
> 
> 标签：php

我是 PHP 的初学者，我接触过处理过的 HTML 表单，我正在学习如何使用它来做越来越多的事情......

我正在使用这个功能（并且基于谷歌所以很多人）但我真的很想了解它在做什么......

```
function pt_register()
{
  $num_args = func_num_args();
   $vars = array();

   if ($num_args >= 2) {
       $method = strtoupper(func_get_arg(0));

       if (($method != 'SESSION') && ($method != 'GET') && ($method != 'POST') && ($method != 'SERVER') && ($method != 'COOKIE') && ($method != 'ENV')) {
           die('The first argument of pt_register must be one of the following: GET, POST, SESSION, SERVER, COOKIE, or ENV');
     }

       $varname = "HTTP_{$method}_VARS";
      global ${$varname};

       for ($i = 1; $i < $num_args; $i++) {
           $parameter = func_get_arg($i);

           if (isset(${$varname}[$parameter])) {
               global $$parameter;
               $$parameter = ${$varname}[$parameter];
          }

       }

   } else {
       die('You must specify at least two arguments');
   }

} 
```

谁能帮我用英文讲解一下？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-18T23:07:00.797

看起来它正试图成为 register_globals 的替代品

```
function pt_register()
{
  // Look at the arguments passed in...
  $num_args = func_num_args();
   $vars = array();

   // .. we need at least 2 arguments
   if ($num_args >= 2) {

        // $method is the middle part of name of one of PHPs old-style variables
       $method = strtoupper(func_get_arg(0));

       if (($method != 'SESSION') && ($method != 'GET') && ($method != 'POST') && ($method != 'SERVER') && ($method != 'COOKIE') && ($method != 'ENV')) {
           die('The first argument of pt_register must be one of the following: GET, POST, SESSION, SERVER, COOKIE, or ENV');
     }

      // $varname is the whole name of the variable
       $varname = "HTTP_{$method}_VARS";

      // Make the global variable (for example HTTP_SESSION_VARS) accessible from this function
      // ${$varname} is using a technique called "variable variables"
      // If $varname == "HTTP_SESSION_VARS" then $$varname (or ${$varname}) is the same as $HTTP_SESSION_VARS
      global ${$varname};

       // For each argument after the method
       for ($i = 1; $i < $num_args; $i++) {
           $parameter = func_get_arg($i);

           // If the parameter exists in the global variable...
           if (isset(${$varname}[$parameter])) {
               // .. make it global...
               global $$parameter;
               // ... and set its value
               $$parameter = ${$varname}[$parameter];
          }

       }

   } else {
       die('You must specify at least two arguments');
   }

} 
```

因此，例如：`pt_register('SESSION', 'foo');`确实，实际上

```
function example()
{
    global $HTTP_SESSION_VARS;
    global $foo;
    $foo = $HTTP_SESSION_VARS['foo'];
} 
```

恕我直言，这个脚本已经过时且邪恶！超全局变量 $_SESSION 等意味着你不应该这样做

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-18T23:09:25.473

哦，我的，
这看起来像是一段代码被剪掉了，它取代了不推荐使用的[register_globals](http://www.php.net/register_globals)设置。

回到 PHP4，所有类型的用户生成的参数都直接在您的正常变量范围内创建为变量。
用简单的英语来说，这意味着调用 to`index.php?test=helloWorld`会导致

```
<?php
  echo "$test<br/>";
?> 
```

输出：

```
helloWorld<br/> 
```

这被认为是程序员自取其辱的市长机会。它已被废除。并且有充分的理由。

考虑以下代码：

```
<?php

if ( isAuthorised($userId, $sessionId) ) {
   $hasAccess = true;
}
// some lines
// of code...

if ( $hasAccess ) {
    echo 'sensitive information';
}

?> 
```

如果你用它来调用它会发生什么`index.php?hasAccess=1`
没错，调用你的脚本的邪恶的人刚刚获得了对仅供授权用户使用的部分的访问权限。

**总结**
这是一个模仿不再使用的功能行为的函数（自 PHP5 起），因为它被认为是*主要*的安全风险。

而不是使用上面的代码，您应该访问用户提供的参数，例如

```
<?php
    echo $_GET['test'].'<br />';
?> 
```

希望这可以帮助 ：）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T01:33:49.633

那些说它是寄存器全局变量的替代品的人是在正确的轨道上，但这并不是正在发生的事情。

早在恐龙在互联网上漫游的时候，PHP 还没有 $_POST、$_GET、$_COOKIE、$_SESSION、$_SERVER、$_ETC 超级全局变量。相反（除了臭名昭著的寄存器全局变量）有一些常规的全局数组命名

```
$HTTP_GET_VARS
$HTTP_POST_VARS
$HTTP_SERVER_VARS
etc.. 
```

这些数组除了具有笨拙的长名称外，还需要在使用之前声明为全局的（即，它们不是“超级/自动全局变量，如 $_POST、$_GET 等）。

pt_regsiter 所做的是允许您将**单个**变量从这些数组之一导出到全局范围。所以不要写

```
global      $HTTP_SERVER_VARS
global      $php_self;
$php_self   = $HTTP_SERVER_VARS['PHP_SELF'] 
```

你可以写。

```
pt_register('SERVER','PHP_SELF'); 
```

你会在全局范围内有一个 $php_self 变量。

其他人已经评论了具体的机制，所以我会说今天使用这个功能会很愚蠢。

然而，看起来它起源[于 2002 年](http://www.google.com/codesearch/p?hl=en#6eZ1uU6Ob5Q/phptest-0.6.3/HACKING&q=%22function%20pt_register%22)的一些 GNU 代码。鉴于 PHP3 仍在广泛使用（人们正在过渡到 PHP4），这个功能实际上是有意义的。

当时围绕 PHP 的大多数编码模式都非常依赖全局命名空间来完成工作。这个函数实际上帮助了 LIMIT 的 register_globals 问题。根据上面链接中的注释，作者希望您关闭 register_globals，并使用此功能仅导出您需要的那些项目。

邪恶的？不。在这个时代使用起来非常愚蠢？是的

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T23:08:03.870

看起来它正在提取存储在 $_POST 和 $_GET 等数组中的变量并使它们成为全局变量`$_POST['var']`，因此您可以使用`$var`. 这样做并没有很好的理由，如果您忘记正确清理输入，它会打开不必要的安全漏洞。例如：

```
if (/* some condition */)
  $admin = true;

...

if ($admin)
{
  //do powerful stuff here
} 
```

这可能会被恶意用户以类似的方式调用页面破坏

```
page.php?admin=1 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-18T23:09:39.497

我完全不知道为什么要使用此功能。它基本上将变量从会话、请求或环境复制到全局命名空间。

你如何使用它？如果要访问表单字段，请使用 $_POST：

```
$value = $_POST['value']; 
```

代替：

```
pt_register('POST', 'value'); 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-18T23:12:00.943

基本上，这是一个从预定义的全局数组 $_SESSION、$_GET、$_POST、$_SERVER、$_COOKIE 和 $_ENV 中取出变量并将它们移动到具有相同名称的全局变量中的函数。

例如，如果您加载页面“test.php?value=5”，您通常会通过 $_GET['value'] 访问它。但是，您可以致电：

```
pt_register('GET', 'value'); 
```

这将创建一个名为 $value 设置为 5 的全局变量。它接受来自同一全局数组的任意数量的参数，因此对于页面 "test.php?value=5&another_value=6&yet_another_value=7" 你可以这样做：

```
pt_register('GET', 'value', 'another_value', 'yet_another_value'); 
```

让 $value、$another_value 和 $yet_another_value 全部创建并分配给它们在 URL 中给出的值。

正如 RoBorg 所说，它所做的工作与旧的 register_globals 类似，但它让您可以更好地控制设置哪些变量。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-18T23:21:16.490

```
function pt_register()
{
  $num_args = func_num_args(); // Get the number of arguments passed to this function
   $vars = array();

   if ($num_args >= 2) {
       $method = strtoupper(func_get_arg(0)); 
       // if the number of arguments is larger than or equal to 2, get the first one and make it uppercase, assign it to the varible $method

       if (($method != 'SESSION') && ($method != 'GET') && ($method != 'POST') && ($method != 'SERVER') && ($method != 'COOKIE') && ($method != 'ENV')) {
           die('The first argument of pt_register must be one of the following: GET, POST, SESSION, SERVER, COOKIE, or ENV');
     }
       // check if $method = GET, POST, SESSION, SERVER, COOKIE, or ENV' if not, die and kill the script 

       $varname = "HTTP_{$method}_VARS";
       /* assign the method to the var name
       * i.e. HTTP_GET_VARS, HTTP_POST_VARS etc
       */

      global ${$varname};
       // put the varible into the global varibles

       for ($i = 1; $i < $num_args; $i++) { // iterate through the arguments
           $parameter = func_get_arg($i);   // assign to parameter

           if (isset(${$varname}[$parameter])) { 
               // check if a parameter is set in the HTTP var array
               // i.e HTTP_GET_VARS[$parameter]
               global $$parameter;
               //assign the varible name of parameter to the varible name
               // say parameter was 'content', create a varible named 'content' and make it global
               $$parameter = ${$varname}[$parameter];
               // update the parameter to match its value in the HTTP vars array
               // i.e $content = HTTP_GET_VARS['content'];
          }

       }

   } else {
       die('You must specify at least two arguments');
   }

} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-18T23:32:59.690

太多有用的答案无法评论所有这些，所以我会非常感谢地回答我自己的问题。

在我较新的表单中，我使用费迪南德建议的格式编写了自己的处理脚本。

$value = $_POST['value'];

我正在查看一些仍在使用的旧东西，并试图弄清楚它做了什么以及为什么，以确定我是否在我的新代码中采用了不安全的快捷方式。事实上，情况正好相反，我需要更新旧代码以使用与我现在使用的方法相同的方法......并且任何中断都需要以其他方式修复。Globals 的安全问题对我来说并没有丢失。

令人惊讶的是，在“pt_register”的 20 页谷歌搜索结果中，我发现很多人使用完全相同的功能（我想知道它最初来自哪里），并且没有提及它的固有风险/邪恶。

感谢大家的即时答案和有用的信息。这个网站有一个新粉丝。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-08-29T11:31:28.023

它最初可能来自其他地方，但它包含在 phpFormGenerator 生成的代码中。

不确定最新版本是否使用不同的代码，但是（很多？）托管公司仍然通过 Fantastico 提供对旧版本的访问，这就是它仍然被广泛发现的原因。

# linux - Linux：如何强制使用特定的网络接口？

> ID：563235
> 
> 赞同：20
> 
> 时间：2009-02-18T23:00:24.603
> 
> 标签：linux, sockets

[这可以被认为是这个早期 SO question](https://stackoverflow.com/questions/335607/how-do-i-make-an-outgoing-socket-to-a-specific-network-interface)的延续。

理想情况下，无论如何，我都想限制一个进程只使用某个接口。它将建立 TCP 连接，发送 UDP 数据报，并监听 UDP 广播。目前，我正在做的是：

1.  确定要使用的接口的 IP。
2.  创建 IP 策略规则以将来自接口的所有数据包路由到该 IP
3.  创建另一个 IP 策略规则以将来自该 IP 的所有数据包路由到该接口
4.  为每个规则设置默认路由表

现在，这主要是可行的，但客户端进程也必须愿意配合。也就是需要绑定到它要使用的接口的具体IP，我想我也需要设置一下`SO_BINDTODEVICE`。（但是，我一直在阅读有关在使用 TCP 或 UDP 时是否实际工作的相互矛盾的信息`SO_BINDTODEVICE`。）幸运的是，客户端应用程序是 Python，我可以扩展套接字类以透明地完成所有这些工作。但我不确定它是否是一个完整的解决方案，尤其是在接收广播方面。

我的问题是：

1.  在这里做`SO_BINDTODEVICE`我想做的事吗？还是仅对原始套接字有效？有人评论说，“`SO_BINDTODEVICE`在套接字上并不能保证套接字只会接收到达该物理接口的电线/天线上的数据包。” 如果这确实是真的，那*会* `SO_BINDTODEVICE`做什么呢？

2.  有没有办法做到这一点，使得本地 IP 不必是唯一的？除了一个接口上的 DHCP 服务器可能会为其分配一个由另一个接口使用的 IP，从而混淆路由表这一事实之外，这不会成为问题。

3.  如何仅从特定接口接收广播？绑定到特定 IP 似乎使它忽略广播，这是有道理的，但并不是我想要的。

我在带有 Linux 内核 2.6.26 的 Ubuntu 8.04 上运行。能够同时通过两个不同的接口访问两个不同网络上的同一个子网是一个不可协商的要求，因此它（大部分）不受“不要那样做”的影响。:)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T16:00:11.363

至于我的一般问题，似乎有几种方法可以做到：

*   涉及路由表变化的复杂方式以及各个进程的协作。这就是我上面描述的方式。它的一个优点是它可以在用户空间工作。我在上面写了一些额外的注释，并在下面回答了我的具体问题。

*   编写一个完全忽略路由表的自定义内核模型（如果`SO_BINDTODEVICE`已设置）。但是，仍然需要客户端进程调用`setsockopt(SOL_SOCKET, SO_BINDTODEVICE, dev)`。这个选项绝对不适合胆小的人。

*   虚拟化流程。这可能不适合很多人，并且会带来一系列令人头疼的问题，主要是配置问题。但值得一提。

选项 1 和 2 要求流程按照我们的意愿选择加入。这可以通过创建一个动态库来部分缓解，该库劫持 socket() 调用以创建套接字，然后在返回描述符之前立即将其绑定到设备。[这在此处](http://tuxology.net/tag/interface/)进行了更详细的描述。

在做了一些研究和大量谷歌搜索之后，我可以得出一些关于 Linux 内核 2.6.26 的行为的结论。请注意，这些可能都是特定于实现的行为，甚至可能是特定于内核的行为。在决定基于我的单点数据实现功能之前测试您自己的平台。

1.  `SO_BINDTODEVICE`确实做到了它所说的，至少对于UDP。

2.  每个接口的唯一 IP 似乎是必要的，因为我们正在使用路由表。自定义内核模块可以绕过此限制。

3.  要在特定接口上接收广播，首先使用绑定到设备`SO_BINDTODEVICE`，然后使用通常的 bind() 调用绑定到广播地址。设备绑定需要在其他任何事情之前完成。然后，套接字将只接收到达该接口的广播。

我首先创建了一个套接字来测试它。然后我使用`setsockopt(SOL_SOCKET, SO_BINDTODEVICE, dev)`. 最后，我将它绑定到广播地址。我从另一台计算机发送了一个广播，该广播将通过非绑定接口接收。设备绑定套接字没有收到此广播，这是有道理的。删除`setsockopt(SOL_SOCKET, SO_BINDTODEVICE, dev)`呼叫，将收到广播。

还应该提到的是，您也可以`setsockopt(SOL_SOCKET, SO_REUSEADDR, 1)`在此处使用。请注意，语义`SO_REUSEADDR`随着广播地址的变化而变化。具体来说，如果它们都已`SO_REUSEADDR`设置，则将两个套接字绑定到广播地址和同一台机器上的相同端口是合法的。

更新：`SO_BINDTODEVICE`广播似乎充满了危险，特别是广播帧的接收。我正在观察在一个接口上接收到的广播帧，但同时在另一个接口上消失了。它们似乎受本地路由表的影响，但不受 IP 策略规则的影响。但是，我对此不是 100% 确定的，如果您想继续，我只是将其作为调查点提及。所有这一切都在说：使用风险自负。由于时间关系，我在接口上打开了一个原始套接字，并自己解析了以太网和 IP 头。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-23T17:35:16.063

经过一个艰苦的周末，我很高兴提出一个解决方案，它可以解决我之前讨论过的大部分问题，几乎零麻烦。

有一个名为 net.ipv4.conf.all.rp_filter 的 sysctl 可以设置为 0 以禁用源验证：

```
    rp_filter - 整数
         2 - 通过反向路径进行源验证，如 RFC1812 中所述
             单宿主主机和存根网络的推荐选项
             路由器。可能会导致复杂的麻烦（不是无循环）
             运行缓慢不可靠协议（类似于 RIP）的网络，
             或使用静态路由。

         1 - （默认）较弱的 RP 过滤形式：丢弃所有数据包
             看起来来自直接连接的接口，但是
             是从另一个界面输入的。

         0 - 无源验证。

```

这也可以使用 /proc/sys/net/ipv4/conf/ `<interface>`/rp_filter 在每个接口的基础上进行设置。

正如一位发帖人所解释的那样，它使 IP 路由“不确定性降低”，因为不能保证来自一个子网的数据包总是从同一个接口发出。在这种情况下，这正是它所需要的。请做更多的研究以确定这是否真的是你想要的。

由于我不明白的原因，广播仍然存在问题，但我终于对这个问题感到满意，我希望它可以帮助其他人。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-20T17:09:27.600

不是对您的问题的直接回答，而只是仅供参考。正如您在上面提到的，对于您需要/想要做的事情，这个解决方案可能太多了。

我个人喜欢创建一个允许我这样做的网络堆栈挂钩内核模块的想法。这样我就可以完全控制来自用户空间的多播和单播帧。您必须使用诸如[**netlink 套接字**](http://people.redhat.com/nhorman/papers/netlink.pdf)之类的东西来向驱动程序和用户空间应用程序发送/接收数据，但它工作得非常好并且速度非常快。

您还可以通过这种方式连接到堆栈的任何级别……以太网或 IP。因此可以完全控制您发送/接收的内容。

这是一篇关于挂钩到 netfilter 堆栈 的示例[**文章。**](http://sts.synflood.de/dump/doc/p61-0x0d_Hacking_the_Linux_Kernel_Network_Stack.txt)
**注意：**这篇文章挂钩到 IP 堆栈，而且它也很旧。我知道 API 发生了变化，但是这篇文章的很多内容在实践和理论上仍然适用。如果你想挂接到桥接层，你会使用类似的机制，但指定

```
BR_LOCAL_IN instead of NF_IP_LOCAL_IN 
```

注意：这与在接口上打开原始套接字非常相似。您必须自己构建框架。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-07-19T16:09:10.200

您可以尝试将进程的网络命名空间限制为一个接口。您需要一个带有 CONFIG_NETNS（现代发行版的大多数内核）的内核构建和一些脚本来为您完成分配。[示例配置](http://lxc.sourceforge.net/index.php/about/kernel-namespaces/network/configuration/)

# installation - MSI 安装程序的自定义“修复”和“卸载”功能（从控制面板调用时）

> ID：563236
> 
> 赞同：1
> 
> 时间：2009-02-18T23:00:42.717
> 
> 标签：installation, windows-installer, controlpanel

*添加/删除程序*（或*程序和功能*）控制面板小程序通常允许卸载或修复程序。

对于非 MSI 安装，当用户单击“更改”或“卸载”按钮时，很容易定义应该发生的情况。只需在注册表 ( `HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\<AppName>`) 中设置适当的键。

我的问题是如果使用 MSI 安装，如何使“更改”、“修复”和“卸载”按钮按我的方式工作（例如启动自定义程序）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T02:44:17.313

如果您使用的是 MSI，请使用 MSI 方式。

如果您想做一些不同的事情，请不要使用 MSI。您会给自己带来很多很多的麻烦，并首先失去使用 MSI 的好处。

如果您需要在卸载过程中运行自己的 EXE，[请参阅我对这个问题的回答](https://stackoverflow.com/questions/537584/how-to-execute-custom-action-only-in-install-not-uninstall)并简单地否定条件。

安装 MSI 时您必须记住的一件事是用户界面是*可选*的，您不能指望它在安装或卸载期间显示。用户可能会删除应用程序`MSIEXEC /X`而不是单击 ARP 中的按钮

如果您真的想“按照自己的方式做”，那么我建议为 MSI 创建一个引导程序，让 MSI 安装[隐藏在 Add/Remove Programs](https://stackoverflow.com/questions/463030/hide-the-uninstaller-in-add-remove-programs/463564#463564)中，然后使用注册表项为您的自定义安装程序手动添加一个 ARP 条目您已在上面指定。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T23:09:04.367

在 MSI 的说法中，这将启动自定义操作（可以是 .EXE）。Windows 安装程序的学习曲线非常陡峭......通常试图让它“按我的方式工作”是很多挫折的捷径。

如果你走这条路，你应该看看 Wix.sourceforge.net。它有一个非常活跃的用户社区，对 Windows 安装程序非常了解。

# java - 为什么我的 RenderingHints 键在应用于 Graphics2D 对象时不被使用？

> ID：563237
> 
> 赞同：0
> 
> 时间：2009-02-18T23:00:49.503
> 
> 标签：java, graphics

当使用 Graphics2D 对象和 1.0f 的 BasicStroke 绘制各种东西时，我似乎无法让 g2d 对象遵守我的 RenderingHints 设置。特别是*KEY_ANTIALIASING*设置为*VALUE_ANTIALIAS_ON*。

```
public void paint(Graphics g) {
    Graphics2D g2d = (Graphics2D)g;

    g2d.setStroke(new BasicStroke(1.0f));
    g2d.setRenderingHint(
        RenderingHints.KEY_ANTIALIASING,
        RenderingHints.VALUE_ANTIALIAS_ON
    );

    // draw stuff...
} 
```

还有其他我应该使用的键吗？我没有在适当的地方应用密钥吗？以上述方式使用它会导致绘制正常的像素化形状。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T23:37:15.360

如果您正在抚摸（因为看起来您来自您的片段），您可能还想尝试：

```
g2.setRenderingHint(RenderingHints.KEY_STROKE_CONTROL, RenderingHints.VALUE_STROKE_PURE); 
```

# nhibernate - NHibernate Eager 加载多级子对象

> ID：563250
> 
> 赞同：26
> 
> 时间：2009-02-18T23:03:22.133
> 
> 标签：nhibernate, fluent-nhibernate

我有一个对象层次结构，订单，联系人，地址：

```
public class Order {
     public virtual Contact BillingContact { get; set; }
}

public class Contact {
     public virtual Address Address { get; set; }
} 
```

我想通过 id 查询订单，并急切地加载 billingcontact 及其地址。

```
var criteria = DetachedCriteria.For<Order>()
     .SetFetchMode("BillingContact", FetchMode.Eager) 
```

这个标准急切地加载了 BillingContact，但可以理解的是不加载 BillingContact 的地址。如果我添加：

```
 .SetFetchMode("BillingContact.Address", FetchMode.Eager) 
```

这无济于事。

另请注意，这些关系是单向的：

```
public OrderMap()
{
    References(x => x.BillingContact)
        .Not.Nullable()
        .Cascade.All();
}

public ContactMap()
{
    HasOne(x => x.Address)
        .Cascade.All()
        .FetchType.Join();
}

public AddressMap()
{
    Map(x => x.Address1);
} 
```

如何构造一个将加载孩子的孩子的标准对象？这些关系映射看起来正确吗？

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-02-19T14:01:33.520

我相信您可能需要向 BillingContact 添加别名以允许您访问它的地址。

就像是：

```
var criteria = DetachedCriteria.For<Order>()
  .CreateAlias("BillingContact", "bc")
  .SetFetchMode("BillingContact", FetchMode.Eager)
  .SetFetchMode("bc.Address", FetchMode.Eager) 
```

# c# - C#中的uniq

> ID：563251
> 
> 赞同：4
> 
> 时间：2009-02-18T23:03:34.817
> 
> 标签：c#, list, unique

有没有一种简单的方法可以只从 C# 中的字符串列表中获取唯一值？我的 google-fu 今天让我失望了。

（我知道我可以将它们放在另一个结构中并再次将它们拉出。我正在寻找愚蠢的简单方法，例如 Ruby 的 .uniq 方法。C# 其他一切都很好，所以我可能只是使用了错误的同义词。）

具体来说，这是来自 Linq，所以如果 Linq 有一个内置的方法来只选择唯一的字符串，那就更酷了。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-18T23:04:50.787

```
List<string> strings = new string[] { "Hello", "Hello", "World" }.ToList();

strings = strings.Distinct().ToList(); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T23:06:32.920

在 .net 3.5 中：-

```
var strings = new List<string> { "one", "two", "two", "three" };
var distinctStrings = strings.Distinct(); // IEnumerable<string>
var listDistinctStrings = distinctStrings.ToList(); // List<string> 
```

轰沙卡拉卡！

# silverlight - 如何在 Silverlight 中使用 DataTemplate 显示单个项目？

> ID：563252
> 
> 赞同：15
> 
> 时间：2009-02-18T23:04:10.773
> 
> 标签：silverlight, data-binding, datatemplate

我正在尝试使用 DataTemplate 显示单个项目（不包含在集合中）。这是我到目前为止所得到的，没有显示任何内容。替换`ItemsControl`为`ListBox`显示一个空的列表框（所以我知道元素在那里）。

```
 <ItemsControl
            ItemsSource="{Binding Session}"
            ItemTemplate="{StaticResource SessionHeaderDataTemplate}"
            /> 
```

`Session`是单个对象。我想使用 DataTemplate，因为我在我的应用程序的其他地方显示相同的信息，并且希望将演示样式定义为一种资源，以便我可以在一个地方更新它。

有什么想法，还是应该在我的 ViewModel 中创建一个 1 元素集合并绑定到它？

*编辑：这就是我最终要做的，尽管下面的答案也是一个解决方案。我非常喜欢我`DataTemplates`的东西，所以将这样的东西推送到另一个 XAML 文件时感觉不舒服。*

XAML：

```
 <ItemsControl
            DataContext="{Binding}"
            ItemsSource="{Binding Session_ListSource}"
            ItemTemplate="{StaticResource SessionHeaderDataTemplate}" /> 
```

视图模型：

```
 private Session m_Session;
    public Session Session
    {
        get { return m_Session; }
        set
        {
            if (m_Session != value)
            {
                m_Session = value;
                OnPropertyChanged("Session");

                // Added these two lines 
                Session_ListSource.Clear();
                Session_ListSource.Add(this.Session);
            }
        }
    }

    // Added this property.
    private ObservableCollection<Session> m_Session_ListSource = new ObservableCollection<Session>();
    public ObservableCollection<Session> Session_ListSource
    {
        get { return m_Session_ListSource; }
        set
        {
            if (m_Session_ListSource != value)
            {
                m_Session_ListSource = value;
                OnPropertyChanged("Session_ListSource");
            }
        }
    } 
```

* * *

## 回答 #1

> 赞同：32
> 
> 时间：2009-07-21T21:16:13.297

坚持使用您的数据模板来获得简单的视图，而无需创建另一个用户控件。使用 ContentControl 显示单个项目的 DataTemplate。

```
 <ContentControl 
      ContentTemplate="{StaticResource SessionHeaderDataTemplate}" 
      Content="{Binding Path=Session}" /> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T00:37:36.807

您不需要使用 ItemsControl 来执行此操作，只需创建一个自定义用户控件，然后绑定到该控件，例如

```
<TestProject:myControl DataContext="{Binding Session}" /> 
```

自定义控件可以有它自己的 xaml 文件，因此它可以看起来像你想要的那样。

# c# - C# 通用复制构造函数

> ID：563253
> 
> 赞同：5
> 
> 时间：2009-02-18T23:04:30.040
> 
> 标签：c#, interface, clone, generics

我有一个接口和两个实现该接口的类。这些类具有泛型类型。我想从一个类的实例克隆到另一个类。

```
interface IFoo
{
    // stuff
}

class Foo<T> : IFoo
{
    // foo stuff
    // ifoo implementation
}

class Bar<T> : IFoo
{
    // bar stuff
    // ifoo implementation
} 
```

我有一个 Foo 并且想要一个 Bar。Bar 有一个带有 IFoo 参数的复制构造函数。我创建了一个扩展方法来实现克隆：

```
public static Bar<T> Clone<T>(this IFoo foo) 
{
    return new Bar<T>(foo);
} 
```

调用该方法需要类型：

```
someFoo.Clone<T> ... 
```

有没有办法通过修改扩展方法或任何其他方式在调用方法时省略声明类型，以允许只传入实例而不关心其底层类型？

**更新** 以下是如何使用它来更好地说明情况。

在一个方法中，我迭代一个集合并返回一个 IFoo 的枚举。在该方法中，我查看源集合的属性并确定 Foo 的类型。

```
IFoo foo = null;

string type = element.Attribute("Type").Value;
switch (type)
{
    case "int":
        foo = new Foo<int>();
        break;

    case "string":
        foo = new Foo<string>();
        break;

    // etc
}
// other stuff

yield return foo; 
```

调用方法有一个 List。后来我从这个列表中选择了单个项目以供使用，此时我想要一个 Bar 而不是 Foo。从列表中选择时，实例的类型为 IFoo，因为它们只能看到“this IFoo foo”的扩展方法。我不想将 IFoo 强制转换为 Foo，这需要重新声明 T 的类型。我只想让 Foo 告诉 Bar 它是什么。这可能吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T04:41:15.580

所以你一切都好，但你希望能够使用语法

```
someFoo.Clone() 
```

代替

```
someFoo.Clone<int>() 
```

你希望 int 被暗示而不是明确地把它放在那里？

您在代码示例中不能这样做的原因是 IFoo 没有引用您创建所需的泛型类型 T `Bar<T>`。

我建议你真的需要另一个接口：`IFoo<T>`

如果你有，你的扩展方法如下所示：

```
public static Bar<T> Clone<T>(this IFoo<T> foo) 
{
    return new Bar<T>(foo);
} 
```

那么你将没有问题使用

```
IFoo<int> someFoo = new Foo<int>();
Bar<int> someBar = someFoo.Clone(); 
```

希望有帮助

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T23:11:12.003

这对灵感有帮助吗？：[你会如何改进这个浅拷贝课程？](https://stackoverflow.com/questions/469982/how-would-you-improve-this-shallow-copying-class)

本质上它是一种通用的基于反射的属性复制方法。试试看。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T23:30:35.703

如果它适用于您的场景，您可以拥有一个`IFoo<T>`. 此外，如果您不介意使用特定的扩展方法，您可以只收到一个`Foo<T>`. 您确实需要传递引用 T 的内容，以便编译器可以推断出适当的类型。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-18T23:38:34.217

当您需要完全控制您的深拷贝克隆时，这种模式非常好：

```
public class FooBase
{
    private int x;

    public FooBase() { /* standard contructor */ }

    protected FooBase(FooBase clone)
    {
        this.x = clone.x;
    }

    public FooBase Clone() { return new FooBase(this); }
}

public class Foo : FooBase
{
    private int y;

    public Foo() { /* standard contructor */ }

    protected Foo(Foo clone) : base(clone)
    {
        this.y = clone.y;
    }

    public Foo Clone() { return new Foo(this); }
} 
```

为克隆定义受保护的构造函数 - 因此派生类可以克隆基类中的值。此模式必须手工编写（或借助良好的 T4 模板生成），但非常适合深度克隆。

**更新**：我想我误解了这个问题并且已经实施了克隆。Freddy 是对的——编译器必须知道它应该推断出哪种类型，而它不能从 IFoo 类型中推断出来。它可以在**(this Foo< T > foo)**中做到这一点。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T00:56:26.493

尝试这样定义方法

```
public static Bar<T> Clone<T>(this Foo<T> foo)
{
    return new Bar<T>(foo);
} 
```

这样，参数将具有泛型类型，并且编译器将具有用于推断类型的源。

# wpf - XAML 用于反射效果

> ID：563255
> 
> 赞同：1
> 
> 时间：2009-02-18T23:04:50.490
> 
> 标签：wpf, text, effects

我是 XAML/WPF 新手，我想我会编写一个闹钟应用程序来进入它。我想了解基本的文本框、下拉菜单等，一旦你掌握了布局模型，这些就相当简单了，但我想进入图形方面。

我想在黑色背景上显示闹钟数字，但重要的是闹钟数字具有反射效果，就像它们站在一块玻璃上一样（就像苹果营销经常实施的方式一样）。

我该如何开始呢？我正在查看 Charles Petzold 的作品以寻找灵感，但有点挣扎。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T23:23:06.843

实际上，我认为这可能很容易从图像适应文本：

[http://www.codeproject.com/KB/WPF/WPFImageEffects.aspx](http://www.codeproject.com/KB/WPF/WPFImageEffects.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T23:31:03.220

查看[WindowsClient.net上的](http://windowsclient.net/)[XAML 反射](http://windowsclient.net/downloads/folders/wpfsamples/entry3741.aspx)示例。

如果您需要更多示例，WindowsClient 站点还有一个包含有用片段列表的[控制库](http://windowsclient.net/downloads/folders/controlgallery/default.aspx)、工具 sna dsytle 以及您可以下载和研究的[WPF 示例的完整列表。](http://windowsclient.net/downloads/folders/wpfsamples/default.aspx)

# javascript - jquery/javascript 等待函数完成

> ID：563283
> 
> 赞同：1
> 
> 时间：2009-02-18T23:10:27.967
> 
> 标签：javascript, jquery

我有从 DOM 操作执行的脚本，以改变 div 的外观。应用程序的方式是，当页面加载时，div 以其原始状态呈现，函数操作 DIV。问题是它在渲染更改的 div 之前渲染原始 div。

我试过了：

```
//Make div invisible

//Call function to change the DIV

//Make div visible 
```

这不起作用

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T23:22:00.420

您是否使用了可见性属性？

```
<div id="divy" style="display:none;">Wee</div> 
```

或在 .css 文件中设置样式

```
$(document).ready(function(){
   $("#divy").css("color", "#424242");
   $("#divy").show();
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T03:28:37.610

如果您不希望它立即显示，您应该使用 CSS（而不是 JS）隐藏它。然后你运行你的更改功能并显示它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T23:13:40.407

```
$('div').hide(function(){
 $(this).css('font-size', '5em');
 $(this).find('h1').css('color','red');
 $(this).show();
}) 
```

这必须有效；）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T06:23:00.407

您是否只是想保持 div 可见，同时防止看到更改？您可以通过克隆 div 来实现它，在克隆的 div 上进行更改，然后用克隆的、更改的 div 替换原始 div。就像是：

```
var changed_cloned_div = make_changes( $('#original_div').clone() );
$('#original_div').replaceWith( changed_cloned_div ); 
```

# css - 删除“除尘我选择器”以外的未使用的 CSS 选择器？

> ID：563286
> 
> 赞同：8
> 
> 时间：2009-02-18T23:10:43.393
> 
> 标签：css, css-selectors

我想从一个通用 CSS 文件中删除所有未使用的 CSS 选择器。虽然 Firefox 扩展“Dust Me Selectors”运行良好，但它只适用于每页。它报告一个页面未使用的选择器，但有些可以在其他页面上使用。

有没有一种工具可以遍历文件夹，扫描所有文件并显示一个未在任何地方使用的选择器列表？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T23:19:37.867

我不知道为什么你不能使用 Dust Me 选择器，你可以右键单击该符号并选择“Spider Sitemap”来一次完成整个网站。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-02-22T15:46:52.883

在我看来，Dust-Me 并不是真正的“蜘蛛”，它只遵循站点地图中给出的链接；它不会通过跟踪这些页面中包含的下一级链接来继续。所以你的站点地图必须是完整的。我还担心 Dust-Me 只关心 HTML 中未使用的选择器。我正在开发一个项目，其中 CSS 中的一些选择器在 Javascript 中使用，但在 HTML 中没有直接提及。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-09-11T08:08:30.383

老问题，但人们也可以在 Firefox 中使用[CSS Usage](https://addons.mozilla.org/en-US/firefox/addon/css-usage/) for Firebug。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-11-21T19:17:00.993

现在有[purifycss](https://github.com/purifycss/purifycss)选项，它有一个 CLI 并且可以在 NodeJs 中使用。

没有找到作为 IDE 扩展，但对 npm 友好，这不是问题。

# java - 使用 OSGi 时是否可以进行字节码操作？

> ID：563305
> 
> 赞同：9
> 
> 时间：2009-02-18T23:18:19.710
> 
> 标签：java, aop, osgi, bytecode-manipulation

我正在制作[一个应用程序服务器](http://dimdwarf.sourceforge.net/)，在其中我需要使用一些字节码操作（例如，将自定义`equals`和`hashCode`方法插入到带有注释的类中`@Entity`）。现在我给 JVM 一个 Java 代理（[-javaagent](http://javahowto.blogspot.com/2006/07/javaagent-option.html)选项），它使用[ASM](http://asm.objectweb.org/)进行字节码转换。

我一直在考虑使用[OSGi](http://en.wikipedia.org/wiki/OSGi)，但我不知道它是否允许我进行必要的字节码操作。

1.  使用 OSGi 时是否可以进行字节码操作？如何？
2.  捆绑包是否可以声明自己，它需要一些字节码操作才能工作？例如，应用程序服务器要求对它自己的一些核心类进行操作。
3.  是否可以指定某个其他捆绑包需要一些字节码操作，而该捆绑包不知道它？例如，所有在服务器上运行的应用程序都必须被操纵，但应用程序不需要知道它。
4.  捆绑包是否可以声明自己，所有依赖于它的捆绑包都必须进行字节码操作？这将使我很容易声明所有依赖于包含`@Entity`注释的 API 包的人都必须被操纵。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-10-25T19:55:59.227

OSGI 4.3 添加了[WeavingHook](https://osgi.org/specification/osgi.core/7.0.0/framework.weavinghooks.html)，它允许您使用您选择的字节码操纵器进行字节码操纵。我在我的一个项目中将它与 JavaAssist 一起使用，效果很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T02:48:36.927

1) 是的，可以在 OSGi 中进行字节码操作。如何与标准 java 有点不同，您需要使用此处描述的扩展器模式[http://www.osgi.org/blog/2007/02/osgi-extender-model.html](http://www.osgi.org/blog/2007/02/osgi-extender-model.html)。我相信 Eclipse 在他们的Equinox方面项目中使用了它：http: [//www.eclipse.org/equinox/incubator/aspects/](http://www.eclipse.org/equinox/incubator/aspects/)。[Spring DM](http://www.springsource.org/osgi)肯定是使用这种模式来自动配置 osgi dm 模块。

2）这取决于您使用的扩展器模式。这就是spring扩展器的工作方式，在平台启动之前在bundle的META-INF/spring文件夹中查找配置文件。

3) 同样，这取决于您定义的扩展器。

4）我相信这是可能的，因为在启动包之前，它必须解决并启动依赖项，然后您的扩展程序可以分析包依赖项并启动字节码操作。

# asp.net-mvc - 如何在 ASP.NET MVC 应用程序中实现搜索功能

> ID：563308
> 
> 赞同：21
> 
> 时间：2009-02-18T23:19:42.170
> 
> 标签：asp.net-mvc, design-patterns, search

我可以想象在 ASP.NET MVC 应用程序中实现搜索功能的许多方法，但由于我找不到太多文档，我想知道您是否有任何通用模式、技术或通用方法来在 ASP.NET MVC 应用程序中实现搜索功能（类似于stackoverflow）。我想到的一些技术是：

*   SQL Server 全文搜索
*   外部搜索引擎（如 Search Server 2008）
*   Lucene.NET

...但是将它们与 ASP.NET MVC 集成的最佳方法是什么？

想法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T13:29:33.890

您具体要问什么并不完全清楚，但总的来说：

1.  编写返回搜索表单的视图助手或部分视图。在您需要显示搜索框的其他页面中调用它。使表单操作 GET，而不是 POST。
2.  对于站点搜索，您可能需要一个搜索控制器。为了在一种特定类型的数据中进行搜索，您可以将操作添加到现有控制器或将参数添加到现有操作。在大多数情况下，我们唯一需要添加的是针对特定数据类型的通用“列表”操作的参数。搜索表单调用“List”并使用搜索查询字符串设置参数。
3.  实际搜索是在您的存储库中完成的。这是应用程序中唯一知道 SQL Server 或 Lucene 之类的东西的部分。对于琐碎的情况，控制器可以将 .Where 附加到存储库返回的 IQueryable<T>。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T23:56:35.983

我相信在他的一篇博文中，Jeff Atwood 谈到了他如何使用[站点地图](http://www.codinghorror.com/blog/archives/001174.html)来让谷歌处理堆栈溢出时的大部分搜索功能。当人们无论如何都可能只是使用谷歌时，为什么还要编写自己的搜索算法呢？

# ribbon - MS Ribbon/Office UI 许可证值得担心吗？

> ID：563312
> 
> 赞同：6
> 
> 时间：2009-02-18T23:19:59.020
> 
> 标签：ribbon, mfc-feature-pack

想象一下，我想使用 VS2008 中的 C++ 和 MFC Feature Pack 创建一个与 MS Word 2007 非常相似的应用程序。对于功能区，我可以使用 3 个选项：

1.  **无需获取许可证即可使用 MFC Feature Pack 中的功能区。**
    从长远来看，可能是狡猾的。在您的产品获得全球成功之前，您一切都好，此时 MS Legal 会派出重头戏。但他们真的能做些什么吗？

2.  **使用 MFC Feature Pack 中的功能区，但尝试获取许可证。**
    我相信如果我应该尝试注册[Office UI License](http://msdn.microsoft.com/en-us/office/aa973809.aspx)，我很有可能会因为它是竞争产品而被拒绝：

    > *该许可证适用于任何平台上的应用程序，但与当前具有新 UI 的五个 Office 应用程序（Microsoft Word、Excel、PowerPoint、Outlook 和 Access）直接竞争的应用程序除外。*

3.  **使用第 3 方功能区控件。**
    如果我以大约 500 英镑的价格从[BCGSoft](http://www.bcgsoft.com)购买 BCGControlBar 库的许可证——MS在 MFC 功能包中使用了它的功能区栏——那么我可以毫无问题地在我的应用程序中使用功能区。

除非绝对必要，否则我不想花任何钱。如果我使用选项#1 直到我对此感到麻烦，我可以放弃它并选择#3 怎么样？会不会太晚了？

当然以上都是假设的......;）

* * *

***注意：****我不关心与我的产品和 Word 之间的相似性相关的任何专利或版权，这只是一个示例。这个问题只涉及功能区许可方面。*

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T23:28:53.100

我知道你说你不关心专利问题，但这确实是唯一的问题。即使您要获得第 3 方功能区控件，Microsoft 也拥有其专利，并且可能会因您违反它们而追究您的责任。他们明确表示人们可以将其用于非竞争产品。

Office UI 许可限制是针对功能区的概念，而不仅仅是 MFC 的具体实现。 [请参阅此页面了解更多信息。](http://blogs.msdn.com/jensenh/archive/2006/11/21/licensing-the-2007-microsoft-office-user-interface.aspx)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T23:27:46.800

IMO，如果您说您可能会因为产品相似性而被特别拒绝许可，那么如果微软听到它的风声，无论如何*在没有许可的情况下继续进行可能对您来说不会有好处。*

为了安全起见，我会选择选项 3。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-23T19:36:35.897

我想真正归结为我是否是 MS 的直接竞争对手。任何产品都可以使用色带，只要它不是“竞争产品”，无论这意味着什么。

在我的理论问题的背景下，我肯定会成为竞争对手，所以我会说使用任何一种丝带都太冒险了。

当然，在现实生活中，你是否是竞争对手并不是那么非黑即白。对于 OpenOffice 以外的任何产品，我可能会选择选项 #2。

* * *

**编辑**
我观看了[这段](http://channel9.msdn.com/posts/Rory/Office-UI-New-Licensing-Story/)视频，这里引用了 MS 律师的一段话：

> “该许可证不适用于与 当前在办公室拥有功能区的 5 个应用程序具有相同*主要功能的应用程序。即 Word、Excel、Powerpoint、Outlook 和 Access。”*

*主要*一词给人的印象是，包含富文本编辑器的产品上可以有一个功能区栏，只要该产品的主要用途与 Word 不同。例如，允许在签入时进行富文本注释的版本控制系统可能会很好。（我猜）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-23T19:47:13.063

即使您使用来自 3rd 方控件的功能区，您是否仍然需要获得许可才能在您的应用程序中使用它？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-23T20:14:47.240

如果您有兴趣探索第三方组件路线，我在下面链接的 CodeProject 上的文章有一个功能区，它看起来很像 Microsoft 的功能区，并且可以免费获得（尽管您必须感谢作者）。

[您将使用的专业功能区（现在使用 orb！）](http://www.codeproject.com/KB/toolbars/WinFormsRibbon.aspx)

我还没有尝试过，但这篇文章的评价很高（FWTW）。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-09-01T13:16:06.420

或者不要使用功能区。

知道微软它甚至可能不会出现在下一个版本的 Office 中......

节省您的金钱（和声誉！）

要有创意，但也要提出用户想要的东西。功能区是设计的噩梦。不要犯同样的错误！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-23T20:33:46.087

如果微软决定追随你，你就死定了。不管案件是非曲直，你都将被迫和解，只是为了避免因律师费流血而死。他们的财力比你深得多。

请记住，至少在美国，如果专利侵权能够证明您知道该专利并故意违反该专利，那么他们对专利侵权造成的损失要大得多。我认为，在公共论坛上发帖就足够了。

# c# - 在 c# 中填充树结构的优雅且可维护的方式

> ID：563328
> 
> 赞同：2
> 
> 时间：2009-02-18T23:23:58.667
> 
> 标签：c#, design-guidelines

我有一棵树。

```
class TreeNode {
    public TreeNode(string name, string description) {
        Name = name;
        Description = description;
    }
    string Name { get; set; }
    string Description { get; set; }
    public List<TreeNode> Children = new List<TreeNode>();
} 
```

我想填充一个大的用于单元测试目的。我真的很想保持干燥。

出于说明目的说我的树具有以下结构

```
父级，说明
  孩子 1，描述 1
    孙子 1, desc1
  孩子 2，描述 2

```

您将如何以优雅且可维护的方式填充树？

我发现这段代码非常重复且容易出错：

```
var parent = new TreeNode("Parent", "desc");
var child1 = new TreeNode("Child 1", "desc1");
var child2 = new TreeNode("Child 2", "desc2");
var grandchild1 = new TreeNode("Grandchild 1", "desc1");

parent.Children.Add(child1);
parent.Children.Add(child2);

child1.Children.Add(grandchild1); 
```

**编辑**

我最终采用了 DSL 方法：

这里有一个演示[测试](http://github.com/SamSaffron/media-library/blob/8e7d4582ddb2ae25bc9fc8fcdb82d38da54ed4a6/MediaLibraryTests/TestMockLocations.cs)。

实施在[这里](http://github.com/SamSaffron/media-library/blob/8e7d4582ddb2ae25bc9fc8fcdb82d38da54ed4a6/MediaLibraryTests/MockFolderMediaLocation.cs)。

它使用一个构建器和一个简单的 DSL。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-18T23:32:58.147

您可以编写一个带有状态的“TreeBuilder”来保存一些连接混乱：

```
TreeBuilder builder = new TreeBuilder();

builder.AddNode("Parent", "desc"); // Adds a node, and sets the cursor to it
builder.AddLeaf("Child 1", "desc1"); // Adds a node and leaves the cursor at the Parent
builder.AddNode("Child 2", "desc2");
builder.AddLeaf("Grandchild 1", "desc1");
builder.Up(); // Moves the cursor to the parent
builder.AddNode("Child 3", "desc3");

root = builder.GetRoot() 
```

另一种方法是用一些简单的格式发明一个简单的配置文件/字符串。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T23:43:43.020

嵌套构造在这里可能是一个不错的选择。不要暴露孩子名单是个好主意。

```
class Program
{
    static void Main(string[] args)
    {
        var parent = 
            new TreeNode( "Parent", "desc", new TreeNode[] { 
                new TreeNode( "Child 1", "desc1", new TreeNode[] { 
                    new TreeNode( "Grandchild 1", "desc1" ) } ),
                new TreeNode( "Child 2", "desc2" ) } );
    }
}

class TreeNode
{
    public TreeNode(string name, string description, IEnumerable<TreeNode> children)
        : this(name, description)
    {
        _children.AddRange(children);
    }

    public TreeNode(string name, string description)
    {
        Name = name;
        Description = description;
    }

    public string Name { get; set; }
    public string Description { get; set; }

    public IEnumerable<TreeNode> Children
    {
        get
        {
            return _children.AsReadOnly();
        }

        set
        {
            _children.Clear();
            _children.AddRange(value);
        }
    }

    private List<TreeNode> _children = new List<TreeNode>();
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T00:16:58.227

*   理想情况下，您需要一种将语言扩展到**自定义类型文字的方法**。C# 没有这个，所以你必须找到另一种方法。

*   您可以制作**内部 DSL**，通常具有**流畅的界面**。

*   [**以功能**](http://msdn.microsoft.com/en-us/library/bb387019.aspx)构造[`XElement`为例](http://msdn.microsoft.com/en-us/library/bb387019.aspx)**。**

***   使用自定义解析器创建**外部 DSL 。**如果您仔细设计语言，解析器会很容易。

    *   使用**XML**。基本上这是一种创建外部 DSL 并免费获取解析器的方法。** 

 **外部 DSL 选项很好，因为当您阅读它们时，您知道*只有 data*，并且不必担心代码结构的意义。另外，数据就是文件，文件就是数据。这使得通过更改文件来交换数据变得容易，并且更容易准备好文件更改历史记录。最后，当非程序员提供数据时，外部 DSL 很好。

这里的权衡是时间与价值。**您将拥有多少数据/多久更改一次/谁将更改它**是您必须回答的问题。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-18T23:36:04.067

您可以使用填充树的简单解析器编写树内容的简单 XML 表示。以下将给出您在上面指定的结构。

```
<Node description="desc">
    Parent
    <Node description="desc1">
        Child 1
        <Node description="desc1">
            Grandchild 1
        </Node>
    </Node>
    <Node description="desc2">
        Child 2
    </Node>
</Node> 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T00:39:46.923

我会将实现拆分为 TreeClass 和 TreeNodeClass

树类将具有成员变量

```
TreeNodeClass root 
```

用方法

```
TreeNodeClass addAtRoot(data) 
```

返回他们刚刚创建的节点

TreeNodeClass 还需要一个 AddChild() 方法，该方法还将返回它刚刚添加的节点。

然后你可以做类似的事情

```
addAtRoot(rootData).AddChild(childData).AddChild(grandchildData); 
```

或者

使用类似这样的东西随机生成一棵树

```
AddRecursively(TreeNodeClass root)
{
    numChildren = SomeRandomNumber;
    While(numChildren > 0)
    {
       CTreeNodeClass newnode = root.AddChild(SomeRandomData);
       AddRecursively(newnode);
    }
} 
```

主要思想是您想要返回刚刚添加到树中的节点。

您可能还想让孩子知道它的父母，因为这有时会很方便。

# iphone - 如何在 PowerPC Mac 上为 iPhone 正确开发？

> ID：563332
> 
> 赞同：4
> 
> 时间：2009-02-18T23:25:41.160
> 
> 标签：iphone, xcode, powerpc

我正在 PowerPC Mac 上进行 iPhone 开发。如何让代码签名正常工作，以便我可以构建到我的 iPhone？

iPhone SDK 官方并不支持PowerPC，不过稍微折腾一下就可以安装了。见[这里](http://www.tbradford.org/2008/03/iphone-sdk-beta-2-possible-ppc-fix.html)。我已经在 Xcode 中安装并运行良好的 SDK，并且 iPhone 模拟器运行良好。

但是，我无法在 Xcode 中构建到我的 iPhone —— 代码签名是 fubar。一些聪明的人在[这里](http://discussions.apple.com/thread.jspa?threadID=1455699&tstart=0)创造了变通方法。也就是说，我使用了 Tiku 发布的代码设计脚本以及一些更正。这帮助我取得了一些进展。代码现在可以编译，但在尝试部署时我仍然收到 0xE800003A 错误。

我认为我的所有密钥和配置文件都已正确设置。我的 iPhone 已注册开发，我已经创建了配置文件。开发门户中列出的 AppID 显示为 MagicNumber.com.website.*，在我的项目中，我将 Bundle ID 设置为 com.website.${PRODUCT_NAME:identifier}。在项目设置中，产品名称为HelloWord，代码签名身份为我的开发者证书。

iPhone 的控制台日志显示： Wed Feb 18 14:57:55 unknown afcd[180] : user mobile has uid 501

2 月 18 日星期三 14:57:55 未知 afcd[180]：模式为 0x41e8 2 月 18 日星期三 14:57:55 未知 mobile_installation_proxy[182]：install_embedded_profile：跳过嵌入配置文件的安装 2 月 18 日星期三 14:57:55 未知 mobile_installation_proxy [182]：verify_executable：无法验证签名：e800800e 2 月 18 日星期三 14:57:55 未知 mobile_installation_proxy[182]：preflight_application_install：无法验证 /var/tmp/install_staging.QNk2sD/HelloWorld.app/HelloWorld 2 月 18 日星期三： 57:55 未知 mobile_installation_proxy[182]：install_application：无法预检应用程序安装 2 月 18 日星期三 14:57:55 未知 mobile_installation_proxy[182]：handle_install：安装失败

任何帮助表示赞赏！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T03:18:08.760

你的代码设计脚本是什么样的？我以前在做G4的时候用过这个：（原来的“/usr/bin/codesign”应该改名为“/usr/bin/codesign.orig”，然后把这个脚本保存为“/usr/bin/ codesign”。你必须用“sudo”来做。如果你的路径名中有空格，这个脚本也不起作用。）

```
#!/usr/bin/perl 
#
$appDir=$ARGV[$#ARGV];
@tmpAry=split(/\//,$appDir);
$baseAppName=$tmpAry[$#tmpAry];
$baseAppName=~s/\.app$//;
$realAppName="$appDir"."/$baseAppName";

$sign=0;
for($b=0;$b<$#ARGV;$b++) {
if($ARGV[$b] eq "-s") {
$sign=1;
}
}

$mums=`file $realAppName`;
if($sign==1 && $mums=~/executable arm/) {
#print "Signing armv6..\n"; 
$dev="/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin/";
$tmp="$appDir"."/tmpbin";
`$dev/lipo -create $realAppName -output $tmp`;
`mv $tmp $realAppName`;
system("/usr/bin/codesign.orig",@ARGV);
`$dev/lipo -thin armv6 $realAppName -output $tmp`;
`mv $tmp $realAppName`;
system("rm $appDir"."/CodeResources");
system("cp $appDir"."/_CodeSignature/CodeResources $appDir"."/CodeResources");
exit 0;
} else {
exec '/usr/bin/codesign.orig',@ARGV;
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-20T13:12:06.457

我遇到了和你一样的问题——我可以在 iPhone 上交叉编译和安装应用程序，但它总是会因为安全违规而失败。

为了解决这个问题，我不得不越狱我的手机并安装一个修补过的 MobileInstaller（我相信 Cydia 应用程序现在有一个名为 Installous 的软件包，它可以修补你的 MobileInstaller。不幸的是，我认为 Installous 也用于盗版应用程序）。然后在你项目的 Info.plist 中，你需要添加以下内容：

```
<key>SignerIdentity</key>
<string>Apple iPhone OS Application Signing</string> 
```

这将允许您的手机运行未签名的二进制文件，这是我能够从我的 ppc mac 开发的唯一方法。

我仍然可以从应用商店购买应用并让它们正常运行。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T00:11:45.767

截至 2009 年 4 月 12 日，iPhone Os 2.2.1 的脚本修复程序在我的 iBook G4 上完美运行。

无论如何，花了一天的大部分时间在谷歌上搜索修复程序后，我发现有很多人仍然有问题。

确保您正确复制/粘贴，因为如果您在脚本中遇到错误并且失败，则代码设计 Xcode 不会注意到，它会尝试以未签名状态安装应用程序，在部署时给您一个错误（而不是在构建时） . 就我而言，我将文本粘贴在一个小终端窗口中，破坏了一些代码行，我花了一天时间才找到错误。至少现在我对证书、代码签名和 Xcode 有了深刻的了解……

如果您仍然遇到问题，可能是由于捆绑标识符/appId 不匹配，其中有大量帖子。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-05T22:51:22.153

还可能值得记住的是，XCode 在证书、签名和设备上安装时可能有点不稳定（可能只是在 PPC 上，还没有在 Intel mac 上尝试过）。

我发现以下步骤通常会在以前工作的配置突然停止工作时解决问题：

1.  清理 XCode 中的所有目标
2.  从您的设备中删除任何已安装的应用程序版本（通常的应用程序卸载过程，单击小“x”）
3.  完全退出 XCode，然后重新启动

如果您从未成功签署过您的应用程序，则可能存在实际的配置问题，但一旦它正常工作，请确保您在担心出现问题之前尝试上述方法 :)

希望有帮助。

# c# - 如何加入字符串数组中的最后 X 个条目？

> ID：563339
> 
> 赞同：1
> 
> 时间：2009-02-18T23:27:57.940
> 
> 标签：c#, linq, arrays

我有一个这样的数组：

```
string[] parts = line.Split(',');

string store = parts[0];
string sku = parts[1];
string subcatcode = parts[2];
string price = parts[3];
string date = parts[4];
string desc = parts[5]; 
```

我希望描述等于索引为 5 或更高的所有部分的连接值。这会起作用还是有更好的方法来做到这一点？

```
string desc = string.Join(",", parts.Skip(5).ToArray()); 
```

问题是我正在解析的 CSV 的最后一部分可以包含逗号（保证第 0-4 部分不包含）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-18T23:37:15.170

为什么不在调用时指定最大计数[Split](http://msdn.microsoft.com/en-us/library/c1bs0eda.aspx)？

```
string[] parts = line.Split(','.ToCharArray(), 6); 
```

最后一个元素（您将分配给描述）将包括其他所有内容，包括逗号。

对于这样的数据`"1,2,3,4,5,6,7,8"`会给你`{ "1", "2", "3", "4", "5", "6,7,8" }`

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-18T23:34:14.850

当然，这应该可以正常工作。如果你想去掉结尾的逗号，你可以先 .TrimEnd() 你的字符串。

# php - 致命错误：调用未定义的函数 imagefilter()

> ID：563355
> 
> 赞同：0
> 
> 时间：2009-02-18T23:34:41.590
> 
> 标签：php, image-processing, gd, imagefilter

是什么导致了这个错误？

```
致命错误：在第 5 行的 /var/www/polaroid.php 中调用未定义的函数 imagefilter()

```

```
 1 <?PHP
  2   $img_addr = $_GET['image_address'];
  3   $img = imagecreatefromjpeg($img_addr);
  4
      /* everything works as expected without this line */
  5   imagefilter($img, IMG_FILTER_GRAYSCALE);  
  6
  7   if ($img)
  8   {
        /* I moved the header function here so I can see errors in the browser. 
           If I leave it at the top of the file, the browser expects an image 
           and doesn't print the error messages. */
  9     header('Content-type: image/jpeg');
 10     imagejpeg($img);
 11   }
 12 ?>
 13 
```

这是我使用的网址：

```
http://localhost/polaroid.php?image_address=http://mattnelsoninfo.files.wordpress.com/2008/04/ceiling_cat1.jpg

```

注意：gd 列在 phpinfo() 的输出中。

## 编辑：我正在使用 PHP 版本 5.2.6-2ubuntu4.1

## 另一个编辑：

phpinfo() 在 gd 部分产生这个

```
gd
GD Support  enabled
GD Version  2.0 or higher
FreeType Support    enabled
FreeType Linkage    with freetype
FreeType Version    2.3.7
T1Lib Support   enabled
GIF Read Support    enabled
GIF Create Support  enabled
JPG Support     enabled
PNG Support     enabled
WBMP Support    enabled 
```

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-02-07T20:22:32.607

imagefilter 似乎只有在 PHP 被编译为捆绑的 GD 库时才可用，在您的情况下它不是（这是捆绑和启用之间的区别）。由于您使用的是 Ubuntu，因此您在存储库中找到的 php 版本没有捆绑 GD。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-18T23:41:41.150

您使用的是什么版本的 PHP？看起来 imagefilter 是一个 PHP5 函数... [http://us3.php.net/manual/en/function.imagefilter.php](http://us3.php.net/manual/en/function.imagefilter.php)

编辑：您的代码适用于我的 PHP 版本。作为参考，这是我的phpinfo：

```
gd
GD Support  enabled
**GD Version    bundled (2.0.34 compatible)**
FreeType Support    enabled
FreeType Linkage    with freetype
FreeType Version    2.1.9
T1Lib Support   enabled
GIF Read Support    enabled
GIF Create Support  enabled
JPG Support     enabled
PNG Support     enabled
WBMP Support    enabled
XBM Support     enabled 
```

您可能需要确保捆绑了 GD 版本。我看到安装说启用了 GD 支持但未捆绑。不确定这是否会有所作为。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-01-07T15:43:41.160

[http://www.php.net/manual/en/function.imagefilter.php](http://www.php.net/manual/en/function.imagefilter.php)有一个通知：

> **注意**：此功能仅在 PHP 与 GD 库的捆绑版本编译时可用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2016-11-19T08:16:33.620

就像 2016 年的更新一样，PHP 5.3 允许使用外部 GD，但由于某种原因，这在 lucid/precise 中不起作用。trusty，使用 PHP 5.5，除了 imageantialias 之外，所有这些图像功能都可以工作，来源[https://bugs.launchpad.net/ubuntu/+source/php5/+bug/74647/comments/61](https://bugs.launchpad.net/ubuntu/+source/php5/+bug/74647/comments/61)（和以前的评论）。

# lisp - 我应该学习哪种 Lisp？

> ID：563356
> 
> 赞同：72
> 
> 时间：2009-02-18T23:35:40.497
> 
> 标签：lisp, clojure, scheme

### 我应该学习哪种 Lisp（方言），为什么？

CL 和 Scheme 之间的碎片化减慢了吸收（至少对我而言！）。

所以，请给我“真正的答案”！

我试图阅读功能比较，它们似乎陷入了深奥（我不完全理解），比如方言是否完全尾递归等等。我希望你们所有人（集体）能够清楚地说明不透明的差异。

### 我喜欢的东西

良好的库支持、良好的环境和 Unicode 支持。

### 我不喜欢的东西

火焰战争。一开始很有用，但会干扰长期学习的功能。

* * *

### 更新

1.  一旦我获得了 readline 支持，我一直在使用 MzScheme，我很享受。我不在 Unix 上运行 GUI，所以它对我来说似乎是一个很好的环境选择。

2.  我也很高兴 Clojure 有一个易于在 debian 上安装的 .deb 包，因此它更易于使用。这是一个很大的胜利。尽管下面有一些相当容易激怒的敌意，但进入门槛低是一种胜利。我喜欢被勺子喂。

3.  在阅读了更多的[SICP 之后](http://mitpress.mit.edu/sicp/)，我确实更好地理解了尾递归的问题。

* * *

## 回答 #1

> 赞同：64
> 
> 时间：2009-02-18T23:59:05.773

[Clojure](http://clojure.org)是一种积极发展的现代 Lisp 方言。它基于 JVM，因此所有 Java 库都可以立即使用，因此也支持 Unicode。

这是一种选择，而不是唯一的真实答案。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-02-19T05:17:06.400

如果您想避免激战并且喜欢库，请选择 Clojure。它很小，速度很快，而且社区乐于助人且不教条。这是 Lisp 减去 1980 年代荒谬的废话。它有一个 BDFL，如果你有一个好主意，那么它很有可能会被实现到语言中。

我玩弄了 Common Lisp，这是一件很美好的事情。我已经完成了 DrScheme 中 SICP 的前 3 章和 Metacircular Evaluator，这也是一件很美好的事情。当然，你会从学习这些中受益匪浅。

但是，随着时间的流逝，我开始珍视小语言。我不会撒谎，我喜欢 Javascript 并且我喜欢 C（如果每种语言的核心都没有 C 核心，那该死的），因为它们很小。

Clojure 很小。它很优雅。它是我们时代的语言。

* * *

## 回答 #3

> 赞同：22
> 
> 时间：2009-02-18T23:36:17.840

随便挑一个，学习一下。当你弄清楚差异时，如果你第一次选择错误，你将可以再次选择。

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2009-02-20T03:49:21.640

[**Clojure**](http://clojure.org)是一种很棒的 LISP 方言，它促进了函数式编程。它在 JVM 上运行，因此您可以访问您可能习惯使用的任何 Java 库。该网站有很好的文档和[截屏视频](http://clojure.blip.tv/)来帮助你学习。另一个优点是它真的很容易安装，不像很多其他方言。

如果您只是想了解[**Emacs**](http://www.gnu.org/software/emacs/)（特别是 EmacsLISP）的概念，则是另一种选择。它带有令人难以置信的文档、教程和大量代码示例。截屏视频也很容易找到。Emacs 的一大好处就是编辑器是用 LISP 编写的，所以编辑器自然对 LISP 的运行、​​编辑和调试有很好的支持。此外，您可以扩展编辑器，让您在学习 LISP 的*同时更轻松地完成日常文本编辑需求。*

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-02-19T01:43:37.100

Contra Chuck，Common Lisp 的一个优点是它有一个实现坚持和努力的标准，这样您就可以使用 SBCL（它具有出色的类型检查和推理）进行主要开发，然后，例如，部署为与C 库（使用 ECL 或其他）或作为 .jar 使用 Java 库（使用 ABCL），或使用 Mac 或 Windows 原生 GUI（Clozure，两者）。Common Lisp 具有惊人的跨架构、跨实现和跨时间的可移植性，Common Lispers 在语言的支持下努力保持这种方式。例如，非标准化行为的一个愚蠢分歧是“这是一个特殊变量吗？”这个问题。所以我在我使用的实现中回答了这个问题：

```
#-abcl
(defun special-variable-p (symbol)
  #+ecl(si:specialp symbol)
  #+ccl(proclaimed-special-p symbol)
  #+sbcl(equal '(:special t)
               (multiple-value-list-int:info :variable :kind symbol))) 
```

这在读取时将 ABCL 上的任何内容（它已经有）减少到`(defun special-variable-p (symbol) (si:specialp symbol))`ECL 上，等等。所以我可以把它放在我的 .rc 文件中，并在 REPL 中使用通用函数。但这不是很重要：这不是[线程](http://common-lisp.net/project/bordeaux-threads/)或[各种支持的网络](http://www.cliki.net/IOlib)或[通信顺序进程库](http://www.cliki.net/csp)。最后一个示例只有一个`#+sbcl/#-sbcl`，即使它在五个实现上运行。因为它依赖于经过仔细移植的代码。

但是，允许这种（和其他）优势的因素也对学习者提出了挑战：Common Lisp 是一种非常大的语言。这不是你可以在一两个星期内啜饮的东西，就像我做 Clojure 一样（但我的 Clojure 已经随着即将推出的重大更改而衰落——这种语言虽然有其自身的优点，但通过对比提醒我很多我喜欢 Common Lisp 的地方。）所以你应该阅读[这个页面](http://www.cliki.net/document)的很多内容，并让 HyperSpec 远离按键（对我来说，`M-x hyperspec RET do-symbols RET`足够接近圣经了。），并考虑买几本书。我有[Practical Common Lisp](http://gigamonkeys.com/book/)，刚刚得到[Let Over Lambda](http://letoverlambda.com/)，现在很快就会真正购买[PAIP 。](https://rads.stackoverflow.com/amzn/click/com/1558601910)

但是，即使 Common Lisp 是**真正的答案**，你也不会完全浪费你的时间来“选择”一些看似华丽的替代品（——“欺骗性”，因为普通的 CL 并没有向你展示它的宏可以做的所有事情，而且它[宏的种类](http://gist.github.com/62946)比任何人都多。通常的比较是糟糕的 CL 和语法优化的替代方案 X)。您仍然会学习基础知识，您仍然可以使用在 SICP、On Lisp、[The Little Schemer](http://books.google.com/books?id=xyO-KLexVnMC)等中可以阅读的大部分内容。lisp，即使是错误的 lisp，仍然比非 lisp 好。（但是你会花一些时间在错误的 lisp 中实现正确的 lisp 的某些部分。Meta-Greenspun。）

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-02-19T00:20:09.313

Lisp 最大的问题是没有每个人都坚持的压倒一切的标准。您不必在 Common Lisp 和 Scheme 之间进行选择；您必须在 Common Lisp 的几个不兼容的实现和 Scheme 的几个不兼容的实现之间进行选择，以及 Arc 和 Clojure 等其他小东西。

我建议从[MzScheme](http://www.plt-scheme.org/software/mzscheme/)开始。它很受欢迎，它正在积极开发，它有许多提供现代编程环境特性的库，而且 Scheme 比 Common Lisp 更简单（不是说更好，只是更简单）。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2009-02-19T01:45:13.337

学习 elisp，以便您可以扩展 Emacs。

* * *

## 回答 #8

> 赞同：6
> 
> 时间：2009-02-20T12:28:08.603

使用 Clojure。这是一种了不起的语言，可以完全访问任何 Java 库。它已经开发了 2 年多，已经有 3 个 IDE 插件在开发中，并且在 4 月出版了一本关于它的书。它非常快，非常优雅和美丽。Clojure 不会出错。

* * *

## 回答 #9

> 赞同：5
> 
> 时间：2009-02-19T00:14:17.733

对我来说，Scheme 的基础理论更有说服力。PLTScheme（现在称为 Racket）是迄今为止我发现的最积极开发的 LISP。不幸的是，它的大量输入掩盖了 Lisp 的美丽。

我很想看到 arc 之类的成功，但似乎不太可能。

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2009-02-19T00:27:46.453

看看[IronScheme](http://www.codeproject.com/KB/net-languages/PlayingWithIronScheme.aspx)。

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2009-02-20T02:49:07.247

猜想：在学习你的第一个 lisp 时，不要学习一个你最终会用于最终开发的 lisp。

引理：学习 Arc。这是 lisp 中所有“难以理解”的东西——闭包、宏、延续，没有 Clojure 的 Java 互操作复杂性、CL 的命名空间混乱或 Scheme 的名称碎片。如果你很专注，你可以在一个周末学习所有这些东西。如果你敏锐而专注，一夜之间。

它会让学习所有其他的lisp*变得*容易得多。

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-05-31T03:49:47.997

我不知道 Lisp，但这就是为什么我认为 PLT Scheme（现在称为 Racket）是一个不错的选择：

1.  非常好的文档
    [http://download.plt-scheme.org/doc/html/](http://download.plt-scheme.org/doc/html/)

2.  DrScheme
    DrScheme 是一个了不起的编程环境，它带有编译器、步进器、语法检查器、REPL、多种语言支持并且是可扩展的。这使整个体验变得有趣。看一些[截图](http://plt-scheme.org/screenshots/)

3.  来自社区的良好支持。
    社区对他们的语言非常热情，也非常支持。如果您有任何问题，可以使用邮件列表、群组和论坛。即使是作者也非常容易接近。

4.  继续研究
    PLT 非常活跃，并继续使他们的工具越来越好。您可以期待实验室的许多创新。例如。我对使用它感到非常兴奋：http: [//blog.plt-scheme.org/2009/05/typed-scheme-20.html](http://blog.plt-scheme.org/2009/05/typed-scheme-20.html)

5.  免费书籍和有趣的教程让您入门。
    [http://www.htdp.org/](http://www.htdp.org/)
    [http://world.cs.brown.edu/](http://world.cs.brown.edu/)

6.  好的模块和广泛的库。
    [http://www.cs.utah.edu/plt/develop/](http://www.cs.utah.edu/plt/develop/)
    [http://planet.plt-scheme.org/](http://planet.plt-scheme.org/) 另见[文档](http://docs.plt-scheme.org/)

如果你正在学习 Scheme，试试[DrScheme 。](http://download.plt-scheme.org/)

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-05-31T03:19:38.647

你知道...当我对 Lisp 产生兴趣时，我也认为我必须做出选择。然后，在阅读和询问了很多之后，我最终选择了 Common Lisp。不是因为它在绝对意义上比 Scheme“更好”，而是因为它具有我知道我可能会在未来 2-3 年内在我的项目中使用的功能：

*   一个非常高效的数值计算编译器（SBCL），
*   条件系统和...
*   不得不承认，SLIME 在这个决定中也扮演了重要的角色。:-)

所以如果我是你，我会开始学习每种语言的一点点，并找出每种语言的*相对*优势和劣势（我的意思是，那些与你最需要/最想做的事情有关）所以你我可以挑一个。你可能会发现你以后也会学习另一个（发生在我身上——我在学习了一年 Common Lisp 后不得不学习更多的 Scheme）

至于 Arc、Clojure 和 Lush，不知道这些。我想同样的论点也适用于它们......我不想在它们上投入太多的原因是：Arc 似乎对数值计算并不感兴趣，而且 P. Graham 似乎对代码大小很着迷（到使他的代码不可读的点）；Clojure 看起来不错，但我不喜欢 JVM。还有 Lush……嗯，除了使用动态作用域之外，语言的编译和解释版本*非常*不同——而且你不能编译递归函数。所以，对我来说，它要么是 Scheme，要么是 Common Lisp。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2009-07-14T22:13:59.420

选择除 Clojure 之外的任何东西，随它去吧，您将在以后进行评估时处于更好的位置。

您将这个问题表述为哪种 Lisp 是学习 Lisp 的最佳媒介，对我来说，这必须包含一个由低级原语构建的 Lisp，而 Clojure 的大部分是用 Java 编写的。

如果您曾将这个问题表述为哪个是启动新项目的最佳 Lisp，那么 Clojure 可能是最佳选择。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2009-02-19T10:50:52.383

我认为您要么想要 Common Lisp 要么想要 PLT Scheme（现在称为 Racket）。

前者有很多自由和力量（一开始可能会让你不知所措），后者有一堆库、匹配的教程和一个集成良好的 IDE。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-02-20T03:53:59.743

我是Scheme的粉丝，但是自从我对Scheme做任何事情以来已经有10多年了。

就像其他人所说的 - 只需选择一个就可以了。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-02-20T10:03:27.657

那里很少有真正的选择，无论是 SBCL、Clojure 还是 PLTScheme。

# objective-c - NSThread 和对象保留计数问题

> ID：563365
> 
> 赞同：4
> 
> 时间：2009-02-18T23:39:29.957
> 
> 标签：objective-c, cocoa-touch, design-patterns

我希望能够在新线程上调用对象的方法；但是，我对如何管理保留计数感到困惑（或者即使这是一个问题）。

在非线程场景中，我会这样做：

```
MyObject *newObject = [[MyObject alloc] init];
[newObject doSomething];
[newObject release]; 
```

在这种情况下，一切都很好。但是，我的问题是以下线程版本是否有问题：

```
MyObject *newObject = [[MyObject alloc] init];
[NSThread detachNewThreadSelector:@selector(doSomething)
                         toTarget:newObject
                       withObject:nil];
[newObject release]; 
```

在这种情况下，我是否需要担心`newObject`在处理过程中被释放`-doSomething`？`-doSomething`如果答案是肯定的，那么保留似乎很混乱`self`。

这是一个问题吗？如果是这样，正确的解决方案是什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-18T23:43:27.403

来自 Xcode API 文档：

> 对象 aTarget 和 anArgument 在分离线程执行期间被保留，然后被释放。一旦 aTarget 完成执行 aSelector 方法，分离的线程就会退出（使用 exit 类方法）。

所以，你编码的方式很好。你可以而且应该释放 newObject。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T10:55:19.240

正如其他人所说，您的代码很好，因为`+detachNewThreadSelector:toTarget:withObject:`保留了目标。但是，我应该指出您的术语中的一个问题。你不应该担心在线程期间“newObject”被“释放”（只要调用是平衡的，框架可以自由地保留和释放任何对象），而是担心它被“释放”。您的代码几乎肯定**会**在线程运行时释放“newObject”，但它不会被释放。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-18T23:42:53.300

detachNewThreadSelector 在线程执行时同时保留aTarget（上面的newObject）和anArgument（上面的nil），然后在退出线程之前释放它们。

# core-animation - 为多个 CALayer 设置动画，但不在同一时间空间中

> ID：563366
> 
> 赞同：9
> 
> 时间：2009-02-18T23:39:37.083
> 
> 标签：core-animation

我有几个`CALayers`我试图将动画制作成一个新`zPosition`的，每一层都稍微延迟了其他层。

每个动画应该花费 0.25 秒，并在前一个动画开始后 0.05 秒开始。在每个动画结束时，该层将从层树中移除。

我已经成功地使用`-animationDidStop:finished:`委托方法在它们完成时删除我的图层，但我无法正确排序动画。

是否可以以这种方式安排动画，以及如何安排？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-02-19T00:28:20.807

我仍然想听听其他人的建议，但我想我已经解决了这个问题。

我现在正在创建特定`CAAnimation`对象并指定它们的`beginTime`属性。我早先这样做了，但没有用，我终于意识到，要获得`beginTime`属性，必须将动画添加到`CAAnimationGroup`.

所以，我的代码如下所示：

```
NSArray *layers = /* layers to be animated away */
CGFloat startOffset = 0.01;

for (NSInteger index = 0; index < layers.count; index++) {
    CALayer *layer = [layers objectAtIndex:index];

    CABasicAnimation *zoomOut = [CABasicAnimation animationWithKeyPath:@"zPosition"];
    zoomOut.toValue = [NSNumber numberWithDouble:400.0];
    zoomOut.beginTime = index * startOffset;

    CAAnimationGroup *group = [CAAnimationGroup animation];
    group.animations = [NSArray arrayWithObject:zoomOut];
    group.delegate = self;

    [layer addAnimation:group forKey:@"zoomAway"];
} 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2012-05-07T09:01:00.260

我发现如果您将 BeginTime 属性的值作为 QuartzCore 的 CACurrentMediaTime() 函数返回的值的增量作为基础，那么 BeginTime 属性确实可以工作，而无需将动画放入组中。

例如`anim.beginTime = CACurrentMediaTime() + 0.05;`

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-03-06T18:29:05.723

我希望我有代表发表评论，但是其他一些文档揭示了将 anim.beginTime 设置为 CACurrentMediaTime() 的原因：

AVCoreAnimationBeginTimeAtZero 使用此常量将 CoreAnimation 的动画 beginTime 属性设置为时间 0。该常量是一个小的非零正值，可防止 CoreAnimation 将 0.0 替换为 CACurrentMediaTime。在 iOS 4.0 及更高版本中可用。在 AVAnimation.h 中声明。

因此，将 beginTime 正常设置为 0 是将其设置为 CACurrentMediaTime() 的简写。因此，您可以使用 来错开各个组的开始。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2017-07-30T18:19:49.990

**斯威夫特 3**

事实证明，您可以通过执行以下操作相对简单地做到这一点：

```
var timeOffset:Double = 0 
let delay:Double = 0.1
for layer in layers {
    let a = CABasicAnimation(keyPath: "path"
    a.fromValue = layer.ovalPathSmall.cgPath
    a.toValue = layer.ovalPathLarge.cgPath
    a.fillMode = kCAFillModeForwards
    a.beginTime = CACurrentMediaTime() + timeOffset
    a.duration = 0.3
    a.isRemovedOnCompletion = true
    layer.add(a, forKey: nil)

    timeOffset += 0.3 + delay
} 
```

所有的层都是 CALayer 或 CAShapeLayer，如果你想知道什么是 obalPathSmall 和 obalPathLarge：

```
ovalPathSmall = UIBezierPath(arcCenter: position, radius: smallRadius, startAngle: 0, endAngle: 2 * .pi, clockwise: true)
ovalPathLarge = UIBezierPath(arcCenter: position, radius: largeRadius, startAngle: 0, endAngle: 2 * .pi, clockwise: true) 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-07-02T17:41:22.657

感谢您分享您的结果，我还发现如果没有组使用 BeginTime 属性将不起作用。

在我的例子中，如果在 CABasicAnimation 上设置了一些设置，如 BeginTime 和 Duration，则会被忽略，但如果直接设置 CAAnimationGroup，则可以。

# django - 模型中 _set 的 Django 管理器

> ID：563367
> 
> 赞同：4
> 
> 时间：2009-02-18T23:40:14.743
> 
> 标签：django, django-models

我目前正在学习 Django，但我不知道如何自己解决这个问题。我正在阅读*Developers Library - Python Web Development With Django*一书，在一章中，您构建了一个简单的 CMS 系统，其中包含两个模型（故事和类别）、一些通用视图和自定义视图以及视图模板。

本书只包含列出故事、故事细节和搜索的代码。我想对此进行扩展并构建一个包含类别和故事的嵌套列表的页面。

```
- Category1
-- Story1
-- Story2
- Category2
- Story3 etc. 
```

我设法弄清楚如何为类别列表添加我自己的通用 object_list 视图。我的问题是，如果 Story 是否公开，Story 模型具有 STATUS_CHOICES，并且默认情况下只会获取公共 Stories 的自定义管理器。我不知道如何告诉我的通用类别列表视图也使用自定义管理器并且只获取公共故事。除了那个小问题，一切正常。我可以为所有类别创建一个列表，并在单个页面上为该类别中的所有故事创建一个子列表，唯一的问题是该列表包含非公开故事。

我不知道我是否在正确的轨道上。我的 urls.py 包含一个通用视图，它获取所有 Category 对象，在我的模板中，我使用*category.story_set.all*来获取该类别的所有 Story 对象，然后循环遍历。

我认为可以在模板中添加一个 if 语句并使用我的模型文件中的 VIEWABLE_STATUS 来检查它是否应该被列出。该解决方案的问题在于它不是非常兼容 DRY。

是否也可以为 Category 模型添加某种管理器，仅在使用 category 上的 story_set 时才会获取公共 Story 对象？

或者这是攻击我的问题的错误方法？

**相关代码**

urls.py（仅类别列表视图）：

```
urlpatterns += patterns('django.views.generic.list_detail',
    url(r'^categories/$', 'object_list', {'queryset': Category.objects.all(),
                                          'template_object_name': 'category'
                                         }, name='cms-categories'), 
```

模型.py：

```
from markdown import markdown
import datetime
from django.db import models
from django.db.models import permalink
from django.contrib.auth.models import User

VIEWABLE_STATUS = [3, 4]

class ViewableManager(models.Manager):
    def get_query_set(self):
        default_queryset = super(ViewableManager, self).get_query_set()
        return default_queryset.filter(status__in=VIEWABLE_STATUS)

class Category(models.Model):
    """A content category"""
    label = models.CharField(blank=True, max_length=50)
    slug = models.SlugField()

    class Meta:
        verbose_name_plural = "categories"

    def __unicode__(self):
        return self.label

    @permalink
    def get_absolute_url(self):
        return ('cms-category', (), {'slug': self.slug})

class Story(models.Model):
    """A hunk of content for our site, generally corresponding to a page"""

    STATUS_CHOICES = (
        (1, "Needs Edit"),
        (2, "Needs Approval"),
        (3, "Published"),
        (4, "Archived"),
    )

    title = models.CharField(max_length=100)
    slug = models.SlugField()
    category = models.ForeignKey(Category)
    markdown_content = models.TextField()
    html_content = models.TextField(editable=False)
    owner = models.ForeignKey(User)
    status = models.IntegerField(choices=STATUS_CHOICES, default=1)
    created = models.DateTimeField(default=datetime.datetime.now)
    modified = models.DateTimeField(default=datetime.datetime.now)

    class Meta:
        ordering = ['modified']
        verbose_name_plural = "stories"

    def __unicode__(self):
        return self.title

    @permalink
    def get_absolute_url(self):
        return ("cms-story", (), {'slug': self.slug})

    def save(self):
        self.html_content = markdown(self.markdown_content)
        self.modified = datetime.datetime.now()
        super(Story, self).save()

    admin_objects = models.Manager()
    objects = ViewableManager() 
```

category_list.html（相关模板）：

```
{% extends "cms/base.html" %}
{% block content %}
    <h1>Categories</h1>
    {% if category_list %}
        <ul id="category-list">
        {% for category in category_list %}
            <li><a href="{{ category.get_absolute_url }}">{{ category.label }}</a></li>
            {% if category.story_set %}
                <ul>
                    {% for story in category.story_set.all %}
                        <li><a href="{{ story.get_absolute_url }}">{{ story.title }}</a></li>
                    {% endfor %}
                </ul>
            {% endif %}
        {% endfor %}
        </ul>
    {% else %}
        <p>
            Sorry, no categories at the moment.
        </p>
    {% endif %}
{% endblock %} 
```

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-19T15:08:48.863

我发现文档有点不清楚，但该属性可能是您正在寻找的。当您尝试它时，请注意[此功能使用](http://code.djangoproject.com/browser/django/trunk/django/db/models/fields/related.py#L247)，它将始终指向在 Model 类中声明的第一个 Manager，无论它被赋予什么属性名称。您始终可以通过覆盖适当类中的方法来自定义管理站点中可编辑的项目。[`use_for_related_fields`](http://docs.djangoproject.com/en/dev/topics/db/managers/#using-managers-for-related-object-access) `Manager`[`_default_manager`](http://code.djangoproject.com/browser/django/trunk/django/db/models/fields/related.py#L247)`queryset``ModelAdmin`

做不到...

```
class Category(models.Model):
    def public_stories(self):
        return Story.objects.filter(category=self) 
```

...和...

```
{% for story in category.public_stories %} 
```

这至少避免了重复确定哪些故事是可见的逻辑。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-10-10T18:29:44.877

如果您想要一个特定于模板的解决方案，您可以创建一个自定义过滤器。这样你就可以避免接触你的模型类

这将是您的过滤器：

```
from django import template

register = template.Library()

@register.filter
def viewable(queryset):
    return queryset.filter(status__in=VIEWABLE_STATUS) 
```

你可以在你的模板中使用它

```
{% category.story_set|viewable %} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T15:21:12.910

要详细说明@insin 的答案，您应该添加`use_for_related_fields = True`到`ViewableManager`课程中。这样，`Category.story_set`将返回自定义管理器的实例，该实例具有`get_query_set`您需要的方法。您的模板标签看起来像

```
{% category.story_set.get_query_set %} 
```

**编辑**：@insin 的答案要好得多，我会使用它。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-03-13T01:04:55.287

只需更改经理声明的位置即可。

从

```
admin_objects = models.Manager()
objects = ViewableManager() 
```

到

```
objects = ViewableManager()
admin_objects = models.Manager() 
```

根据[文档](http://docs.djangoproject.com/en/dev/topics/db/managers/#custom-managers-and-model-inheritance)：

> 类的默认管理器是在该类上声明的第一个管理器（如果存在），或者是父层次结构中第一个抽象基类的默认管理器（如果存在）。如果没有显式声明默认管理器，则使用 Django 的正常默认管理器。

# asp.net - 如何为 Windows 身份验证/IIS 添加用户

> ID：563368
> 
> 赞同：1
> 
> 时间：2009-02-18T23:40:27.800
> 
> 标签：asp.net

我正在将一个旧的（阅读古老的）.asp 应用程序移植到新服务器以进行备份。它使用此代码来确定用户：

sLogonUser = LCase(Request.ServerVariables("LOGON_USER"))

我相信为了填充这个字段，我必须使用 IIS 管理器打开“Windows 集成身份验证”。我已经这样做了，但现在我收到一条错误消息，指出“无法显示该网站”。我认为这一定与身份验证有关，因为即使是简单的“hello.asp”也有同样的问题。

这让我相信有效的 Windows 用户必须在新服务器上注册。这是“活动目录”吗？添加用户的最佳方式是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-18T23:52:01.330

我相信要使此工作正常，Web 服务器必须与访问 Web 服务器的客户端位于同一域中，并且在域活动目录模式中创建用户。

客户端必须使用 IE 才能将 LOGON_USER 自动发送到服务器

如果您使用的是 IE，则可能值得关闭友好的 http 错误消息，以查看服务器是否正在发送 IE 正在屏蔽的任何更详细的信息。

这可以通过访问来完成；

*   工具 -> Internet 选项
*   选择高级选项卡
*   取消选中“显示友好的 http 错误消息”选项

现在重新加载页面。如果有更多详细信息，如果您用谷歌搜索“http 状态代码”替换显示的代码，将会有一个 HTTP 状态代码（很可能是 403.x），您应该找到有关该问题的更多信息。

高温高压

# oop - Scala 的模式匹配是否违反了开放/封闭原则？

> ID：563369
> 
> 赞同：14
> 
> 时间：2009-02-18T23:41:21.933
> 
> 标签：oop, scala, pattern-matching, design-principles

如果我添加一个新的案例类，这是否意味着我需要搜索所有模式匹配代码并找出需要处理新类的位置？我最近一直在学习这门语言，当我读到一些支持和反对模式匹配的论点时，我一直对应该在哪里使用它感到困惑。请参阅以下内容：

专业版： [Odersky1](http://www.artima.com/weblogs/viewpost.jsp?thread=166742)和 [Odersky2](http://www.artima.com/weblogs/viewpost.jsp?thread=168839)

缺点： [比斯特](http://beust.com/weblog/archives/000490.html)

每种情况下的评论也都很好。那么模式匹配是令人兴奋的东西还是我应该避免使用的东西？实际上，我想答案是“这取决于您何时使用它”，但是它有哪些积极的用例，哪些是消极的用例？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-19T09:17:52.110

杰夫，我认为你有正确的直觉：这取决于。

当您有一组相对固定的方法需要实现时，具有虚拟方法分派的面向对象的类层次结构很好，但是许多潜在的子类可能从层次结构的根继承并实现这些方法。在这样的设置中，添加新子类相对容易（只需实现所有方法），但添加新方法相对困难（您必须修改所有子类以确保它们正确实现新方法）。

当您拥有一组相对固定的属于某个数据类型的类时，具有基于模式匹配功能的数据类型是很好的，但有许多潜在的函数对该数据类型进行操作。在这样的设置中，为数据类型添加新功能相对容易（只需对其所有类进行模式匹配），但添加作为数据类型一部分的新类相对困难（您必须修改所有匹配的函数数据类型以确保它们正确支持新类）。

OO 方法的典型示例是 GUI 编程。GUI 元素需要支持非常少的功能（在屏幕上绘制自己是最低限度的），但新的 GUI 元素一直在添加（按钮、表格、图表、滑块等）。模式匹配方法的典型示例是编译器。编程语言通常具有相对固定的语法，因此语法树的元素很少更改（如果有的话），但不断添加对语法树的新操作（更快的优化，更彻底的类型分析等）。

幸运的是，Scala 允许您将这两种方法结合起来。案例类既可以进行模式匹配，也可以支持虚拟方法分派。常规类支持虚拟方法分派，并且可以通过在相应的伴随对象中定义提取器来进行模式匹配。由程序员决定何时每种方法都合适，但我认为这两种方法都是有用的。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-02-19T03:01:36.693

虽然我尊重塞德里克，但他在这个问题上完全错了。Scala 的模式匹配可以在需要时从类更改中完全封装。*虽然对案例类*的更改确实需要更改任何相应的模式匹配实例，但这只是在以幼稚的方式使用此类类时。

Scala 的模式匹配*总是*委托给类的伴随对象的解构器。使用案例类，这个解构器是自动生成的（连同伴随对象中的工厂方法），尽管仍然可以覆盖这个自动生成的版本。在任何时候，您都可以断言对模式匹配过程的完全控制，从而将任何模式与类本身的潜在变化隔离开来。因此，模式匹配只是通过封装的安全过滤器访问类数据的另一种方式，就像任何其他方法一样。

因此，Odersky 博士的观点在这里值得信赖，特别是考虑到他在面向对象编程和设计领域进行的大量研究。

至于用在什么地方，完全看个人口味。如果它使您的代码更简洁和可维护，请使用它！否则，不要。对于大多数面向对象的程序，模式匹配是不必要的。但是，一旦您开始集成更多功能性惯用语（`Option`、`List`等），我想您会发现模式匹配将显着减少句法开销并提高类型系统提供的安全性。一般来说，任何时候你想提取数据同时测试一些条件（例如从 中提取一个值`Some`），模式匹配可能会很有用。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T07:08:38.533

如果你在做函数式编程，模式匹配绝对是好的。在 OO 的情况下，在某些情况下它是好的。在 Cedric 的示例本身中，这取决于您从概念上如何看待该`print()`方法。它是每个`Term`对象的行为吗？还是它之外的东西？我会说它在外面，并且进行模式匹配是有意义的。另一方面，如果您有一个`Employee`具有各种子类的类，那么在基类中对它的属性（比如名称）进行模式匹配是一个糟糕的设计选择。

模式匹配也提供了一种解包类成员的优雅方式。

# javascript - jQuery parents() 和 parent().parent() 只看到上一级？

> ID：563375
> 
> 赞同：0
> 
> 时间：2009-02-18T23:42:52.490
> 
> 标签：javascript, jquery, dom

我在使用 jQuery 获取元素的父级列表时遇到了一些问题。

也许我遗漏了一些东西，但我在几个嵌套的 div 中有一个链接，并且正在尝试获取父级父级的兄弟姐妹列表。

不过，我似乎只能从链接上一级，所以我不能

HTML如下：

```
<div class="alertcontainer">
   <div id="alertnode_1" class="alertnode">
      <div class="alertnodeheader">Escalate to Level 1</div>
      <div class="alertnodebody">
         <div class="bold">Alert these people:</div><br/>
         <div class="alertnodebodycontactlist">
            <div class="alertnodebodycontact">187   
               <a id="d0.9659762698410487" 
                  onclick="RemoveNode(this, 187)" 
                  href="#">Remove Me...</a>
            </div>
            <div class="alertnodebodycontact">185   
               <a id="d0.6609632486132389" 
                  onclick="RemoveNode(this, 185)" 
                  href="#">Remove Me...</a>
            </div>
            <div class="alertnodebodycontact">184   
               <a id="d0.13180038199138278" 
                  onclick="RemoveNode(this, 184)" 
                  href="#">Remove Me...</a>
            </div>
            <div class="alertnodebodycontact">186   
               <a id="d0.6364304467227213" 
                  onclick="RemoveNode(this, 186)" 
                  href="#">Remove Me...</a>
            </div>
            <select class="esccontactlist" id="esc_contact_list_1">
               <option>Also alert...</option>
            </select>
         </div>
         <br/>
      </div>
   </div>
</div> 
```

JS/jQuery 如下：

```
function RemoveNode(e, id)
{
   // Remove the contact
   $(e).parents().filter('.alertnodebodycontact').remove();

   // Add it back into the list.
   for ( var i = 0; i < ContactList.length; i++) 
   {
      if ( id == ContactList[i]["ContactID"] )
      {
         $('#esc_contact_list_1')
            .append("<option value='"
               +ContactList[i]["ContactID"]
               +"'>&nbsp;&nbsp;"
               +ContactList[i]["ContactName"]
               +" ("
               +ContactList[i]["PrimaryEmail"]
               +")</option>");
      }

      // Here, I want to count the number of '.alertnodebodycontact' divs.
      // However, $(e).parents() only returns a single item, which is the 
      // '.alertnodebodycontact'  that the link is in.  
      //  Likewise, $(e).parent().parent() returns nothing.

      // Anyone have any idea why the outer divs aren't being returned?

   }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-18T23:55:27.233

没关系...我在删除它后尝试访问它。只需要重新排序我的任务。

# .net - 适用于 .NET WinForms 的优质免费 Gridview

> ID：563383
> 
> 赞同：5
> 
> 时间：2009-02-18T23:46:44.650
> 
> 标签：.net, winforms, gridview

.NET WinForms 是否有高质量的免费 G​​ridview？Xceed 数据网格（速成版）很可爱，但适用于 WPF。它既好又简单，在功能部门中并没有压倒性的，并且单击按钮看起来很棒。我正在为 WinForms 寻找类似的东西。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T00:18:03.590

DevAge [SourceGrid](http://www.codeplex.com/sourcegrid/)看起来不错。我所见过的所有很棒或时尚的东西都只出售。

# python - 测试大量格式正确的 URL 有效性的最快方法是什么

> ID：563384
> 
> 赞同：2
> 
> 时间：2009-02-18T23:46:48.487
> 
> 标签：python, http

我的项目需要我验证大量的 Web URL。这些 URL 是由我无法控制的非常不可靠的过程捕获的。所有 URL 都已经过正则表达式验证，并且已知格式正确。我也知道他们都有有效的 TLD

我希望能够快速过滤这些 URL，以确定其中哪些是不正确的。在这一点上，我不在乎页面上有什么内容——我只想尽快知道哪些页面是不可访问的（例如产生 404 错误）。

鉴于其中有很多我不想下载整个页面，只是 HTTP 标头，然后从标头的内容中很好地猜测该页面是否可能存在。

可以做到吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-18T23:59:04.433

要真正做到这一点，您还可以使用使用非阻塞 IO 的[eventlet来加快速度。](http://pypi.python.org/pypi/eventlet)

您可以使用这样的头部请求：

```
from eventlet import httpc
try:
    res = httpc.head(url)
except httpc.NotFound:
    # handle 404 
```

然后，您可以将其放入一些简单的脚本[中，例如此处的示例脚本](http://wiki.secondlife.com/wiki/Eventlet/Examples)。有了这个，你应该通过使用协程池来获得相当多的并发性。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-18T23:56:34.393

我假设您想根据您的标签在 Python 中执行此操作。在这种情况下，我会使用 httplib。或者，以某种方式按主机对 URL 进行分组，以便您可以在一个连接中为具有相同主机的那些 URL 发出多个请求。使用 HEAD 请求。

```
conn = httplib.HTTPConnection("example.com")
conn.request("HEAD", "/index.html")
resp = conn.getresponse()
print resp.status 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T00:00:00.750

使用[httplib](http://docs.python.org/library/httplib.html)和[urlparse](http://docs.python.org/library/urlparse.html)：

```
def checkURL(url):
    import httplib
    import urlparse

    protocol, host, path, query, fragment = urlparse.urlsplit(url)

    if protocol == "http":
        conntype = httplib.HTTPConnection
    elif protocol == "https":
        conntype = httplib.HTTPSConnection
    else:
        raise ValueError("unsupported protocol: " + protocol)

    conn = conntype(host)
    conn.request("HEAD", path)
    resp = conn.getresponse()
    conn.close()

    if resp.status < 400:
        return true

    return false 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-18T23:54:51.697

[只需发送 HTTP HEAD 请求，如该问题](https://stackoverflow.com/questions/107405/how-do-you-send-a-head-http-request-in-python)的已接受答案所示。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-18T23:59:55.617

您可以尝试发送 HTTP HEAD 请求，而不是为每个 URL 发送 HTTP GET 请求。它们在[本文档](http://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.4)中进行了描述。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T01:30:44.277

这是[twisted](http://twistedmatrix.com/)的一个小例子。您可以使用几种并发工具来减慢它的速度，否则，它几乎可以一次完成所有操作。

Twisted 绝对是我最喜欢的关于 python 的东西。:)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-24T19:34:30.963

这可能会帮助您开始。文件 sitelist.txt 包含一个 URI 列表。您可能必须安装 httplib2，强烈推荐。我在每个请求之间设置了一个睡眠，因此如果您在同一个站点上有许多 URI，您的客户端将不会因滥用资源而被列入黑名单。

```
 import httplib2
   import time

   h = httplib2.Http(".cache")

   f = open("sitelist.txt", "r")
   urllist = f.readlines()
   f.close()

   for url in urllist:
      # wait 10 seconds before the next request - be nice with the site
      time.sleep(10)
      resp= {}
      urlrequest = url.strip()
      try:
         resp, content = h.request(urlrequest, "HEAD")
         if resp['status'] == "200":
            print url, "200 - Good"
         else:
            print url, resp['status'], " you might want to double check"
      except:
         pass 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-26T13:21:16.070

执行类似工作的 Python 程序（对于存储在[del.icio.us](http://del.icio.us/)的 URL 列表）是[灾难性](http://www.bortzmeyer.org/disastrous.html)的。

而且，是的，它使用 HEAD 而不是 GET，但请注意一些（不是 HTTP 标准）服务器为 HEAD 和 GET 发送不同的结果：Python 环境 Zope 是典型的罪魁祸首。（此外，在某些情况下，网络问题，例如阻止 ICMP 的隧道 + 损坏的防火墙，阻止大数据包通过，因此 HEAD 工作而不是 GET。）

# vim - 在 vim 中通过 netrw 编辑远程文件时创建本地备份

> ID：563385
> 
> 赞同：6
> 
> 时间：2009-02-18T23:47:40.060
> 
> 标签：vim, backup, scp, netrw

我使用 vim 和 netrw 插件远程处理许多文件。我还通过更改`&backupext`（在[文档](http://vimdoc.sourceforge.net/htmldoc/options.html#%27backupext%27)中找到）来保留时间戳备份。

在处理远程文件 (scp://server//folder/file.txt) 时，我注意到当我保存它时，甚至没有进行备份。

有没有一种方法可以在每次保存远程文件时自动在本地进行备份（根据 vim 备份设置）？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T02:41:40.830

我不认为有一个简单的设置可以切换。不过，您可以尝试编写一些脚本 - 添加您自己的`BufWriteCmd`自动命令来编写备份。尝试使用`set verbose=9`调试（并查看 netrw 是如何做到的）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-07-18T21:58:48.847

*我曾经为这个问题的一个变体而苦苦挣扎：在一台*远程机器 上保存我对*单个*源树所做的更改的本地记录。

 *我维护了整个源代码树的本地副本和一个本地 svn 存储库来对文件进行版本控制。我没有使用 netrw 并寻找一种在本地保存备份的方法，而是在本地编辑了所有内容，并且需要一种自动将我的更改传播到远程机器的方法。

解决方案 1：使用 BufWritePost 自动命令调用 scp 以在文件写入后复制文件。如果系统允许进程共享文件描述符，这可以足够有效地工作，因为可以运行到远程机器的主 ssh 会话并为后续会话共享连接。如果您不太幸运（当时我正在使用 Windows 机器），为每个文件协商新连接所花费的时间可能会很痛苦

解决方案 2：对于 Windows，使用[WinSCP](http://winscp.net/)，它具有“保持远程计算机更新”模式，在该模式下，它监视目录及其所有子目录的更改，然后根据一组规则自动传播更改（要忽略的模式，转移不同文件类型的模式等）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-14T17:42:11.107

[好吧，从您的 scp 协议使用情况来看，使用fuse sshfs](http://en.wikipedia.org/wiki/SSHFS)似乎对您来说要容易得多，这将使您能够拥有正常的文件系统行为来支持您，而不仅仅是推/拉类型的 CRUD 接口。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-20T08:40:26.033

netrw 插件完全绕过了`:write`命令，恢复“备份”功能的唯一方法是使用自动命令自己完成。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-07-20T15:01:28.987

我意识到这不是对原始问题的直接答案-但是，您正在做的事情看起来很像伪装的简单 VCS-因此，您是否有理由不制作远程文件，例如 git 存储库，然后在本地克隆该存储库并在编辑后推送更改？

# visual-studio - 获取一个糟糕的应用程序的 GUI！

> ID：563394
> 
> 赞同：1
> 
> 时间：2009-02-18T23:54:22.447
> 
> 标签：visual-studio

今天我的 Visual Studio 消失了。我可以在任务管理器的“进程”选项卡中看到 devenv.exe，但在“应用程序”选项卡中看不到。我有未保存的更改。有没有办法“恢复” VS 以便保存更改？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T00:00:24.257

有时我发现 Windows GUI 应用程序仍然可以运行，但不会出现在任务栏或应用程序窗格中。首先要检查的是你是否可以 Alt+Tab 到它？如果是，则问题已解决，但如果不是，请尝试 Process Explorer。右键单击 devenv 并查看 Window -> Bring to Front 是否有效。由于它在单个分层视图中列出了所有进程，因此它可能能够“复活”VS。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T00:04:12.953

我知道这不是一个解决方案，但是 VS 如果意外终止（任务管理器结束进程）通常会在您重新打开它时恢复打开的未保存文件，只需确保直接打开它而不是双击 sln 文件即可。

我只会将此作为最后的手段，以防它无法恢复文件。

高温高压

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T00:01:11.853

听起来你是吐司。

但是某些版本的 Visual Studio（我指的是更高版本）将保存打开文档的当前副本，您可能会发现当您再次打开它时，它会询问您是否要恢复它们。

除此以外。不，我想他们已经走了。

# css - 将一个类添加到 li 元素或 a?

> ID：563395
> 
> 赞同：2
> 
> 时间：2009-02-18T23:54:29.233
> 
> 标签：css

我有一个标准的链接列表：

```
<li><a href="">one</a></li>
<li><a href="">two</a></li> 
```

如果我想向其中一个列表项添加一个额外的类，我应该将该类添加到**li**还是**a**元素？什么是最佳实践？

非常感谢！

卡梅伦

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-18T23:58:44.277

如果您正在设置列表项的样式，例如在创建菜单时，则将类添加到列表项中。如果要更改链接的外观，请将其添加到锚标记。

真的没有一个正确的答案。您应该设置在语义上最有意义的样式。在许多情况下，您可能需要同时设置列表项**和**锚点的样式，在这种情况下，您应该将类​​添加到 li 标签并为两者定义样式。

```
li.myclass {
    /* li styles */
}

li.myclass a {
    /* link styles */
} 
```

这几乎就是[亚历克斯](https://stackoverflow.com/questions/563395/add-a-class-to-the-li-element-or-the-a/563426#563426)所建议的。第二种样式仅针对包含在类的列表项中的那些链接。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T00:03:21.100

我通常会将它添加到列表项中。这使您可以灵活地使用 CSS 定位列表项或它包含的锚标记

```
li.class-name {
    /* target li class */

}

li.class-name a {
    /*target it's anchor */
} 
```

但是，在生产中，您最好在引用类名时将初始的 li 从类名中删除。这是不必要的（除非你的记忆力很差）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-18T23:57:13.970

您要设置什么样式，列表项或锚点。您可能想要设置锚的样式，因此将其添加到

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T17:35:14.940

如果您只想为列表中的一个链接分配样式，请使用 id 而不是类。像这样。

`<li id="new_style"><a href="">one</a></li>`

并像这样设计它：

`#new_style {` `margin: 1em;` `font-weight: 600;` `}`

# cocoa-touch - UIImage imageNamed 第二次给出 EXC_BAD_ACCESS

> ID：563397
> 
> 赞同：3
> 
> 时间：2009-02-18T23:54:43.443
> 
> 标签：cocoa-touch, core-graphics

我正在开发一个包含一堆迷你游戏的游戏。在一个游戏视图中，我有以下代码：

```
UIImage* img = [UIImage imageNamed:@"foo.png"];
someImage = CGImageRetain(img.CGImage);
[img release]; 
```

someImage 是 CGImageRef 类型，第一次没有问题。在用户失去迷你游戏（或退出）后，游戏和一切似乎都被正确地释放了。然后，如果他们回到迷你游戏中，并且游戏再次构建，则行：

```
someImage = CGImageRetain(img.CGImage); 
```

导致某种错误......几乎就像我的 UIImage 对象已经发布一样。我知道使用 [UIImage imageNamed] 有一些怪癖，但我根本无法追踪到这一点。任何帮助将不胜感激 ：）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-02-19T00:03:19.150

这条线是你的问题；

```
[img release]; 
```

在 Cocoa 中，一般约定是，如果一个函数返回一个对象并且不包含单词 copy 或 alloc，那么您不必释放它。

返回对象的函数通常将它们添加到自动释放池中。如果您打算保留该对象，那么您应该保留（并稍后发布）它。如果没有，那么它将自动被释放。

如果您尝试释放其中一个对象，则会导致不良后果。在这种情况下，我怀疑它正在释放操作系统认为它仍然拥有的资源。

[该线程](https://stackoverflow.com/questions/106627/memory-management-in-objective-c)包含有关 Cocoa 下内存管理的更多详细信息。

# javascript - 如何将日期添加到日期？

> ID：563406
> 
> 赞同：1462
> 
> 时间：2009-02-18T23:57:20.757
> 
> 标签：javascript, date

如何`Date`使用 JavaScript 为当前添加天数？JavaScript 是否有像 .NET 那样的内置函数`AddDay()`？

* * *

## 回答 #1

> 赞同：1536
> 
> 时间：2009-02-19T00:10:35.403

您可以使用以下方法创建一个：-

```
Date.prototype.addDays = function(days) {
    var date = new Date(this.valueOf());
    date.setDate(date.getDate() + days);
    return date;
}

var date = new Date();

console.log(date.addDays(5));
```

如果需要，这会自动增加月份。例如：

**8/31** + 1 天将变为**9/1**。

直接使用的问题`setDate`是它是一个突变体，最好避免这种事情。ECMA 认为适合将其`Date`视为可变类而不是不可变结构。

* * *

## 回答 #2

> 赞同：941
> 
> 时间：2013-10-30T18:55:16.080

**正确答案**：

```
function addDays(date, days) {
  var result = new Date(date);
  result.setDate(result.getDate() + days);
  return result;
} 
```

**错误答案**：

这个答案*有时会*提供正确的结果，但通常会返回错误的年份和月份。此答案唯一有效的时间是您添加天数的日期恰好是当前年份和月份。

```
// Don't do it this way!
function addDaysWRONG(date, days) {
  var result = new Date();
  result.setDate(date.getDate() + days);
  return result;
} 
```

**证明/例子**

[检查这个 JsFiddle](http://jsfiddle.net/sparebytes/XrWzq/)

```
// Correct
function addDays(date, days) {
    var result = new Date(date);
    result.setDate(result.getDate() + days);
    return result;
}

// Bad Year/Month
function addDaysWRONG(date, days) {
    var result = new Date();
    result.setDate(date.getDate() + days);
    return result;
}

// Bad during DST
function addDaysDstFail(date, days) {
    var dayms = (days * 24 * 60 * 60 * 1000);
    return new Date(date.getTime() + dayms);    
}

// TEST
function formatDate(date) {
    return (date.getMonth() + 1) + '/' + date.getDate() + '/' + date.getFullYear();
}

$('tbody tr td:first-child').each(function () {
    var $in = $(this);
    var $out = $('<td/>').insertAfter($in).addClass("answer");
    var $outFail = $('<td/>').insertAfter($out);
    var $outDstFail = $('<td/>').insertAfter($outFail);
    var date = new Date($in.text());
    var correctDate = formatDate(addDays(date, 1));
    var failDate = formatDate(addDaysWRONG(date, 1));
    var failDstDate = formatDate(addDaysDstFail(date, 1));

    $out.text(correctDate);
    $outFail.text(failDate);
    $outDstFail.text(failDstDate);
    $outFail.addClass(correctDate == failDate ? "right" : "wrong");
    $outDstFail.addClass(correctDate == failDstDate ? "right" : "wrong");
});
```

```
body {
    font-size: 14px;
}

table {
    border-collapse:collapse;
}
table, td, th {
    border:1px solid black;
}
td {
    padding: 2px;
}

.wrong {
    color: red;
}
.right {
    color: green;
}
.answer {
    font-weight: bold;
}
```

```
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
<table>
    <tbody>
        <tr>
            <th colspan="4">DST Dates</th>
        </tr>
        <tr>
            <th>Input</th>
            <th>+1 Day</th>
            <th>+1 Day Fail</th>
            <th>+1 Day DST Fail</th>
        </tr>
        <tr><td>03/10/2013</td></tr>
        <tr><td>11/03/2013</td></tr>
        <tr><td>03/09/2014</td></tr>
        <tr><td>11/02/2014</td></tr>
        <tr><td>03/08/2015</td></tr>
        <tr><td>11/01/2015</td></tr>
        <tr>
            <th colspan="4">2013</th>
        </tr>
        <tr>
            <th>Input</th>
            <th>+1 Day</th>
            <th>+1 Day Fail</th>
            <th>+1 Day DST Fail</th>
        </tr>
        <tr><td>01/01/2013</td></tr>
        <tr><td>02/01/2013</td></tr>
        <tr><td>03/01/2013</td></tr>
        <tr><td>04/01/2013</td></tr>
        <tr><td>05/01/2013</td></tr>
        <tr><td>06/01/2013</td></tr>
        <tr><td>07/01/2013</td></tr>
        <tr><td>08/01/2013</td></tr>
        <tr><td>09/01/2013</td></tr>
        <tr><td>10/01/2013</td></tr>
        <tr><td>11/01/2013</td></tr>
        <tr><td>12/01/2013</td></tr>
        <tr>
            <th colspan="4">2014</th>
        </tr>
        <tr>
            <th>Input</th>
            <th>+1 Day</th>
            <th>+1 Day Fail</th>
            <th>+1 Day DST Fail</th>
        </tr>
        <tr><td>01/01/2014</td></tr>
        <tr><td>02/01/2014</td></tr>
        <tr><td>03/01/2014</td></tr>
        <tr><td>04/01/2014</td></tr>
        <tr><td>05/01/2014</td></tr>
        <tr><td>06/01/2014</td></tr>
        <tr><td>07/01/2014</td></tr>
        <tr><td>08/01/2014</td></tr>
        <tr><td>09/01/2014</td></tr>
        <tr><td>10/01/2014</td></tr>
        <tr><td>11/01/2014</td></tr>
        <tr><td>12/01/2014</td></tr>
        <tr>
            <th colspan="4">2015</th>
        </tr>
        <tr>
            <th>Input</th>
            <th>+1 Day</th>
            <th>+1 Day Fail</th>
            <th>+1 Day DST Fail</th>
        </tr>
        <tr><td>01/01/2015</td></tr>
        <tr><td>02/01/2015</td></tr>
        <tr><td>03/01/2015</td></tr>
        <tr><td>04/01/2015</td></tr>
        <tr><td>05/01/2015</td></tr>
        <tr><td>06/01/2015</td></tr>
        <tr><td>07/01/2015</td></tr>
        <tr><td>08/01/2015</td></tr>
        <tr><td>09/01/2015</td></tr>
        <tr><td>10/01/2015</td></tr>
        <tr><td>11/01/2015</td></tr>
        <tr><td>12/01/2015</td></tr>
    </tbody>
</table>
```

* * *

## 回答 #3

> 赞同：267
> 
> 时间：2009-02-19T00:01:28.530

```
var today = new Date();
var tomorrow = new Date();
tomorrow.setDate(today.getDate()+1); 
```

要小心，因为这可能很棘手。设置`tomorrow`时，它只起作用，因为它的当前值与年和月匹配`today`。但是，设置为像“32”这样的日期数字通常仍然可以很好地将其移至下个月。

* * *

## 回答 #4

> 赞同：145
> 
> 时间：2012-12-03T23:42:01.133

我的简单解决方案是：

```
nextday=new Date(oldDate.getFullYear(),oldDate.getMonth(),oldDate.getDate()+1); 
```

此解决方案没有夏令时问题。此外，您可以添加/减少年、月、日等的任何偏移量。

```
day=new Date(oldDate.getFullYear()-2,oldDate.getMonth()+22,oldDate.getDate()+61); 
```

是正确的代码。

* * *

## 回答 #5

> 赞同：140
> 
> 时间：2012-02-15T03:56:27.210

这些答案让我感到困惑，我更喜欢：

```
var ms = new Date().getTime() + 86400000;
var tomorrow = new Date(ms); 
```

getTime() 为我们提供自 1970 年以来的毫秒数，而 86400000 是一天中的毫秒数。因此， ms 包含所需日期的毫秒数。

使用毫秒构造函数给出所需的日期对象。

* * *

## 回答 #6

> 赞同：56
> 
> 时间：2012-05-02T10:01:45.477

Try

```
var someDate = new Date();
var duration = 2; //In Days
someDate.setTime(someDate.getTime() +  (duration * 24 * 60 * 60 * 1000)); 
```

Using setDate() to add a date wont solve your problem, try adding some days to a Feb month, if you try to add new days to it, it wont result in what you expected.

* * *

## 回答 #7

> 赞同：56
> 
> 时间：2020-09-14T08:20:16.513

这是用于在 Javascript 中为特定日期添加日、月和年的方法。

```
// To add Days
var d = new Date();
d.setDate(d.getDate() + 5);

// To add Months
var m = new Date();
m.setMonth(m.getMonth() + 5);

// To add Years
var y = new Date();
y.setFullYear(y.getFullYear() + 5); 
```

* * *

## 回答 #8

> 赞同：49
> 
> 时间：2013-02-14T04:15:07.210

在遵循下面的主要示例时，只是花了很长时间试图弄清楚一年没有添加的交易是什么。

如果您只想简单地将 n 天添加到您拥有的日期，您最好只是去：

> myDate.setDate(myDate.getDate() + n);

或冗长的版本

```
var theDate = new Date(2013, 11, 15);
var myNewDate = new Date(theDate);
myNewDate.setDate(myNewDate.getDate() + 30);
console.log(myNewDate); 
```

今天/明天的事情令人困惑。通过将当前日期设置为新的日期变量，您将弄乱年份值。如果您从原始日期开始工作，则不会。

* * *

## 回答 #9

> 赞同：33
> 
> 时间：2020-07-07T07:12:25.923

The simplest approach that I have implemented is to use Date() itself. `

```
const days = 15; 
// Date.now() gives the epoch date value (in milliseconds) of current date 
nextDate = new Date( Date.now() + days * 24 * 60 * 60 * 1000) 
```

`

* * *

## 回答 #10

> 赞同：31
> 
> 时间：2015-12-01T10:03:00.480

```
int days = 1;
var newDate = new Date(Date.now() + days * 24*60*60*1000); 
```

[代码笔](http://codepen.io/anon/pen/MaRjxy?editors=001)

```
var days = 2;
var newDate = new Date(Date.now() + days * 24*60*60*1000);

document.write('Today: <em>');
document.write(new Date());
document.write('</em><br/> New: <strong>');
document.write(newDate);
```

* * *

## 回答 #11

> 赞同：28
> 
> 时间：2013-12-22T04:46:24.473

如果可以，请使用[moment.js](http://momentjs.com/)。JavaScript 没有很好的原生日期/时间方法。以下是 Moment 的语法示例：

```
var nextWeek = moment().add(7, 'days');
alert(nextWeek);
```

```
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.17.1/moment-with-locales.min.js"></script>
```

参考： http: [//momentjs.com/docs/#/manipulating/add/](http://momentjs.com/docs/#/manipulating/add/)

* * *

## 回答 #12

> 赞同：20
> 
> 时间：2013-04-05T03:15:13.947

我昨晚创建了这些扩展：
您可以传递正值或负值；

例子：

```
var someDate = new Date();
var expirationDate = someDate.addDays(10);
var previous = someDate.addDays(-5);

Date.prototype.addDays = function (num) {
    var value = this.valueOf();
    value += 86400000 * num;
    return new Date(value);
}

Date.prototype.addSeconds = function (num) {
    var value = this.valueOf();
    value += 1000 * num;
    return new Date(value);
}

Date.prototype.addMinutes = function (num) {
    var value = this.valueOf();
    value += 60000 * num;
    return new Date(value);
}

Date.prototype.addHours = function (num) {
    var value = this.valueOf();
    value += 3600000 * num;
    return new Date(value);
}

Date.prototype.addMonths = function (num) {
    var value = new Date(this.valueOf());

    var mo = this.getMonth();
    var yr = this.getYear();

    mo = (mo + num) % 12;
    if (0 > mo) {
        yr += (this.getMonth() + num - mo - 12) / 12;
        mo += 12;
    }
    else
        yr += ((this.getMonth() + num - mo) / 12);

    value.setMonth(mo);
    value.setYear(yr);
    return value;
} 
```

* * *

## 回答 #13

> 赞同：18
> 
> 时间：2020-01-15T12:25:18.530

专为[管道运营商](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/Pipeline_operator)设计的解决方案：

```
const addDays = days => date => {
  const result = new Date(date);

  result.setDate(result.getDate() + days);

  return result;
}; 
```

用法：

```
// Without the pipeline operator...
addDays(7)(new Date());

// And with the pipeline operator...
new Date() |> addDays(7); 
```

如果您需要更多功能，我建议您查看[date-fns](https://github.com/date-fns/date-fns)库。

* * *

## 回答 #14

> 赞同：18
> 
> 时间：2020-11-13T16:46:42.033

最简单的答案是，假设需要在当前日期上增加 1 天：

```
var currentDate = new Date();
var numberOfDayToAdd = 1;
currentDate.setDate(currentDate.getDate() + numberOfDayToAdd ); 
```

逐行向您解释这段代码的作用：

1.  创建名为 currentDate的**当前日期变量。**默认情况下，“new Date()”会自动将当前日期分配给变量。
2.  创建一个变量来保存**要添加**到日期的天数（您可以跳过此变量并直接使用第三行中的值）
3.  **通过提供相同的值 + 您想要的数字来更改 Date 的值**（因为 Date 是保存在对象中的月份的天数）。自动切换到下个月

* * *

## 回答 #15

> 赞同：16
> 
> 时间：2019-04-04T05:05:08.203

在不使用第二个变量的情况下，您可以将 7 替换为接下来的 x 天：

```
let d=new Date(new Date().getTime() + (7 * 24 * 60 * 60 * 1000)); 
```

* * *

## 回答 #16

> 赞同：15
> 
> 时间：2019-05-07T18:00:41.050

减去**30**天使用 (24h=86400000ms)

```
new Date(+yourDate - 30 *86400000) 
```

```
var yourDate=new Date();
var d = new Date(+yourDate - 30 *86400000) 

console.log(d)
```

* * *

## 回答 #17

> 赞同：14
> 
> 时间：2016-06-17T11:29:50.590

最简单的解决方案。

```
 Date.prototype.addDays = function(days) {
   this.setDate(this.getDate() + parseInt(days));
   return this;
 };

 // and then call

 var newDate = new Date().addDays(2); //+2 days
 console.log(newDate);

 // or

 var newDate1 = new Date().addDays(-2); //-2 days
 console.log(newDate1);
```

* * *

## 回答 #18

> 赞同：12
> 
> 时间：2014-10-03T14:54:01.160

派对迟到了，~~但如果你使用，`jQuery`那么~~有一个很棒的插件叫做 Moment：

[http://momentjs.com/](http://momentjs.com/)

```
var myDateOfNowPlusThreeDays = moment().add(3, "days").toDate(); 
```

[http://momentjs.com/docs/#/manipulating/](http://momentjs.com/docs/#/manipulating/)

还有很多其他的好东西！

编辑：由于 aikeru 的评论删除了 jQuery 参考

* * *

## 回答 #19

> 赞同：12
> 
> 时间：2019-08-12T09:02:41.767

就这么简单：

```
new Date((new Date()).getTime() + (60*60*24*1000)); 
```

* * *

## 回答 #20

> 赞同：12
> 
> 时间：2018-07-14T07:19:40.767

您可以使用 JavaScript，不需要 jQuery：

```
var someDate = new Date();
var numberOfDaysToAdd = 6;
someDate.setDate(someDate.getDate() + numberOfDaysToAdd); 
Formatting to dd/mm/yyyy :

var dd = someDate.getDate();
var mm = someDate.getMonth() + 1;
var y = someDate.getFullYear();

var someFormattedDate = dd + '/'+ mm + '/'+ y; 
```

* * *

## 回答 #21

> 赞同：11
> 
> 时间：2012-09-04T16:16:28.780

感谢 Jason 您的回答按预期工作，这是您的代码和 AnthonyWJones 的方便格式的混合：

```
Date.prototype.addDays = function(days){
    var ms = new Date().getTime() + (86400000 * days);
    var added = new Date(ms);
    return added;
} 
```

* * *

## 回答 #22

> 赞同：11
> 
> 时间：2014-12-12T22:10:45.620

老我知道，但有时我喜欢这样：

```
function addDays(days) {
    return new Date(Date.now() + 864e5 * days);
} 
```

* * *

## 回答 #23

> 赞同：10
> 
> 时间：2020-05-26T10:33:52.090

为什么这么复杂？

假设您将要添加的天数存储在名为 days_to_add 的变量中。

那么这个简短的应该做到这一点：

```
calc_date = new Date(Date.now() +(days_to_add * 86400000)); 
```

使用 Date.now() 您可以获得实际的 unix 时间戳，以毫秒为单位，然后添加任意多的毫秒数，以添加天数。一天是 24h *60min* 60s*1000ms = 86400000 ms 或 864E5。

* * *

## 回答 #24

> 赞同：10
> 
> 时间：2016-11-25T13:23:23.563

我在建议的解决方案中遇到了夏令时问题。

通过使用`getUTCDate`/`setUTCDate`代替，我解决了我的问题。

```
// Curried, so that I can create helper functions like `add1Day`
const addDays = num => date => {
  // Make a working copy so we don't mutate the supplied date.
  const d = new Date(date);

  d.setUTCDate(d.getUTCDate() + num);

  return d;
} 
```

* * *

## 回答 #25

> 赞同：10
> 
> 时间：2016-05-13T16:11:24.327

不，javascript没有内置函数，但你可以使用简单的代码行

```
timeObject.setDate(timeObject.getDate() + countOfDays); 
```

* * *

## 回答 #26

> 赞同：9
> 
> 时间：2018-11-26T17:10:15.300

没有变量的通用原型，它适用于现有的 Date 值：

```
Date.prototype.addDays = function (days) {
    return new Date(this.valueOf() + days * 864e5);
} 
```

* * *

## 回答 #27

> 赞同：8
> 
> 时间：2012-09-28T20:11:48.037

setDate() 的 mozilla 文档并未表明它将处理月末方案。请参阅[https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Date](https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Date/setDate)

设置日期（）

*   根据本地时间设置指定日期的月份日期 (1-31)。

这就是我需要添加天数时使用 setTime() 的原因。

* * *

## 回答 #28

> 赞同：8
> 
> 时间：2014-10-15T19:06:05.547

我想我也会给出一个答案：就
个人而言，我喜欢尝试避免无缘无故的变量声明、方法调用和构造函数调用，因为它们在性能上都很昂贵。（当然，在合理范围内）
我打算在@AnthonyWJones 给出的答案下发表评论，但想得更好。

```
// Prototype usage...
Date.prototype.addDays = Date.prototype.addDays || function( days ) {
    return this.setTime( 864E5 * days + this.valueOf() ) && this;
};

// Namespace usage...
namespace.addDaysToDate = function( date, days ) {
    return date.setTime( 864E5 * days + date.valueOf() ) && date;
};

// Basic Function declaration...
function addDaysToDate( date, days ) {
    return date.setTime( 864E5 * days + date.valueOf() ) && date;
}; 
```

以上将尊重夏令时。这意味着如果您添加跨 DST 的天数，则显示的时间（小时）将改变以反映这一点。
示例：
2014 年 11 月 2 日 02:00 是夏令时结束。

```
var dt = new Date( 2014, 10, 1, 10, 30, 0 );
console.log( dt );                  // Sat Nov 01 2014 10:30:00
console.log( dt.addDays( 10 ) );    // Tue Nov 11 2014 09:30:00 
```

如果您希望保留整个 DST 的时间（所以 10:30 仍然是 10:30）...

```
// Prototype usage...
Date.prototype.addDays = Date.prototype.addDays || function( days ) {
    return this.setDate( this.getDate() + days ) && this;
};

// Namespace usage...
namespace.addDaysToDate = function( date, days ) {
    return date.setDate( date.getDate() + days ) && date;
};

// Basic Function declaration...
function addDaysToDate( date, days ) {
    return date.setDate( date.getDate() + days ) && date;
}; 
```

所以，现在你有...

```
var dt = new Date( 2014, 10, 1, 10, 30, 0 );
console.log( dt );                  // Sat Nov 01 2014 10:30:00
console.log( dt.addDays( 10 ) );    // Tue Nov 11 2014 10:30:00 
```

* * *

## 回答 #29

> 赞同：7
> 
> 时间：2021-09-30T09:59:34.897

短的：

```
function addDays(date, number) {
    const newDate = new Date(date);
    return new Date(newDate.setDate(newDate.getDate() + number));
}

console.log({
    tomorrow: addDays(new Date(), 1)
}); 
```

进步：

```
 function addDays(date, number) {
    const newDate = new Date(date);
    return new Date(newDate.setDate(date.getDate() + number));
}

function addMonths(date, number) {
    const newDate = new Date(date);
    return new Date(newDate.setMonth(newDate.getMonth() + number));
}

function addYears(date, number) {
    const newDate = new Date(date);
    return new Date(newDate.setFullYear(newDate.getFullYear() + number));
}

function getNewDate(dateTime) {
    let date = new Date();
    let number = parseInt(dateTime.match(/\d+/)[0]);

    if (dateTime.indexOf('-') != -1)
        number = (- number);

    if (dateTime.indexOf('day') != -1)
        date = addDays(date, number);

    else if (dateTime.indexOf('month') != -1)
        date = addMonths(date, number);

    else if (dateTime.indexOf('year') != -1)
        date = addYears(date, number);

    return date;
}

console.log({
    tomorrow: getNewDate('+1day'),
    yesterday: getNewDate('-1day'),
    nextMonth: getNewDate('+1month'),
    nextYear: getNewDate('+1year'),
}); 
```

通过[jperl提供的修复](https://stackoverflow.com/users/11758901/jperl)

* * *

## 回答 #30

> 赞同：6
> 
> 时间：2014-06-05T10:05:33.467

我使用类似的东西：

```
new Date(dateObject.getTime() + amountOfDays * 24 * 60 * 60 * 1000) 
```

与日节省时间一起使用：

```
new Date(new Date(2014, 2, 29, 20, 0, 0).getTime() + 1 * 24 * 60 * 60 * 1000) 
```

适用于新年：

```
new Date(new Date(2014, 11, 31, 20, 0, 0).getTime() + 1 * 24 * 60 * 60 * 1000) 
```

它可以参数化：

```
function DateAdd(source, amount, step) {
  var factor = 1;
  if (step == "day") factor = 24 * 60 * 60 * 1000;
  else if (step == "hour") factor = 60 * 60 * 1000;
  ...
  new Date(source.getTime() + amount * factor);
} 
```

* * *

## 回答 #31

> 赞同：6
> 
> 时间：2015-04-09T08:13:52.610

**编辑：** 而不是`setTime()`（或`setHours()`）你可以这样做：

```
Date.prototype.addDays= function(d){
  this.setDate(this.getDate() + d);
  return this;
};

var tomorrow = new Date().addDays(1); 
```

**老的：**

而不是使用`setTime()`你可以使用`setHours()`：

```
Date.prototype.addDays= function(d){
    this.setHours(this.getHours() + d * 24);
    return this;
};

var tomorrow = new Date().addDays(1); 
```

请参阅[JSFiddle](https://jsfiddle.net/xepscvta/) ...

* * *

## 回答 #32

> 赞同：6
> 
> 时间：2019-11-28T15:42:38.567

在 javascript 中扩展原型[可能不是一个好主意](https://www.reddit.com/r/javascript/comments/5ch66r/why_is_extending_native_objects_such_as_string/)，尤其是在专业代码库中。

你想要做的是扩展原生`Date`类：

```
class MyCustomDate extends Date {

  addDays(days) {
    const date = new MyCustomDate(this.valueOf());
    date.setDate(date.getDate() + days);
    return date;
  }

}

const today = new MyCustomDate();

const nextWeek = today.addDays(7)

console.log(nextWeek)
```

这样，如果有一天 Javascript 实现了一个本地`addDays`方法，你就不会破坏任何东西。

* * *

## 回答 #33

> 赞同：5
> 
> 时间：2016-09-21T06:04:28.030

在 java 脚本中添加日期的非常简单的代码。

```
var d = new Date();
d.setDate(d.getDate() + prompt('how many days you want to add write here'));
alert(d);
```

* * *

## 回答 #34

> 赞同：5
> 
> 时间：2021-10-02T01:50:56.613

你可以试试：

```
var days = 50;

const d = new Date();

d.setDate(d.getDate() + days) 
```

这应该运作良好。

* * *

## 回答 #35

> 赞同：5
> 
> 时间：2018-04-16T08:59:26.580

有一个[**setDate**](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/setDate)和一个[**getDate**](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Date/getDate)方法，可以让你做这样的事情：

```
var newDate = aDate.setDate(aDate.getDate() + numberOfDays); 
```

如果您想减去天数并以人类可读的格式格式化您的日期，您应该考虑创建一个`DateHelper`看起来像这样的自定义对象：

```
var DateHelper = {
    addDays : function(aDate, numberOfDays) {
        aDate.setDate(aDate.getDate() + numberOfDays); // Add numberOfDays
        return aDate;                                  // Return the date
    },
    format : function format(date) {
        return [
           ("0" + date.getDate()).slice(-2),           // Get day and pad it with zeroes
           ("0" + (date.getMonth()+1)).slice(-2),      // Get month and pad it with zeroes
           date.getFullYear()                          // Get full year
        ].join('/');                                   // Glue the pieces together
    }
}

// With this helper, you can now just use one line of readable code to :
// ---------------------------------------------------------------------
// 1\. Get the current date
// 2\. Add 20 days
// 3\. Format it
// 4\. Output it
// ---------------------------------------------------------------------
document.body.innerHTML = DateHelper.format(DateHelper.addDays(new Date(), 20));
```

（另见[**这个小提琴**](https://jsfiddle.net/9fpzcghg/22/)）

* * *

## 回答 #36

> 赞同：4
> 
> 时间：2015-01-27T12:13:36.397

我正在使用以下解决方案。

```
var msInDay = 86400000;
var daysToAdd = 5;
var now = new Date();
var milliseconds = now.getTime();
var newMillisecods = milliseconds + msInDay * daysToAdd;
var newDate = new Date(newMillisecods);
//or now.setTime(newMillisecods); 
```

Date 有一个接受 int 的构造函数。此参数表示 1970 年 1 月 1 日之前/之后的总毫秒数。它还有一个方法 setTime，它在不创建新 Date 对象的情况下执行相同的操作。

我们在这里所做的是将天转换为毫秒，并将此值添加到 getTime 提供的值中。最后，我们将结果提供给 Date(milliseconds) 构造函数或 setTime(milliseconds) 方法。

* * *

## 回答 #37

> 赞同：3
> 
> 时间：2017-06-06T20:58:30.157

我们的团队认为[date-fns](https://date-fns.org/)是这个领域最好的库。它将日期视为**不可变**的（[Moment.js 可能永远不会采用不可变性](https://maggiepint.com/2016/06/24/why-moment-js-isnt-immutable-yet/)），它更快，并且可以模块化加载。

```
const newDate = DateFns.addDays(oldDate, 2); 
```

* * *

## 回答 #38

> 赞同：3
> 
> 时间：2021-05-12T20:12:48.930

这类函数有问题，我用 parseInt() 解决

```
Date.prototype.addDays = function(dias) {

    var date = new Date(this.valueOf());
    date.setDate(parseInt(date.getDate()) + parseInt(dias));
    return date;
}

Date.prototype.addMonths = function(months) {
    var date = new Date(this.valueOf());
    date.setMonth(parseInt(date.getMonth()) + parseInt(months));
    return date;
}

Date.prototype.addYears = function(years) {
    var date = new Date(this.valueOf());
    date.setFullYear(parseInt(date.getFullYear()) + parseInt(years));
    return date;
} 
```

* * *

## 回答 #39

> 赞同：2
> 
> 时间：2013-12-28T15:59:43.390

```
 //the_day is 2013-12-31
    var the_day = Date.UTC(2013, 11, 31); 
    // Now, the_day will be "1388448000000" in UTC+8; 
    var the_next_day = new Date(the_day + 24 * 60 * 60 * 1000);
    // Now, the_next_day will be "Wed Jan 01 2014 08:00:00 GMT+0800" 
```

* * *

## 回答 #40

> 赞同：2
> 
> 时间：2015-07-02T10:18:03.013

对于那些使用 Angular 的人：

做就是了：

```
$scope.booking.totTijd.setMinutes($scope.booking.totTijd.getMinutes()+15);
$scope.booking.totTijd.setDate($scope.booking.totTijd.getDate() + 1); 
```

* * *

## 回答 #41

> 赞同：2
> 
> 时间：2017-02-25T09:35:01.277

您可以在此处创建自定义帮助函数

```
function plusToDate(currentDate, unit, howMuch) {

    var config = {
        second: 1000, // 1000 miliseconds
        minute: 60000,
        hour: 3600000,
        day: 86400000,
        week: 604800000,
        month: 2592000000, // Assuming 30 days in a month
        year: 31536000000 // Assuming 365 days in year
    };

    var now = new Date(currentDate);

    return new Date(now + config[unit] * howMuch);
}

var today = new Date();
var theDayAfterTommorow = plusToDate(today, 'day', 2); 
```

顺便说一句，这是添加秒、分钟或天的通用解决方案。

* * *

## 回答 #42

> 赞同：1
> 
> 时间：2014-08-17T09:31:41.493

我不敢相信**5 年后在这个线程中没有剪切粘贴解决方案！**
SO：无论夏季干扰如何，都要获得相同的时间：

```
Date.prototype.addDays = function(days)
    {
    var dat = new Date( this.valueOf() )

    var hour1 = dat.getHours()
    dat.setTime( dat.getTime() + days * 86400000) // 24*60*60*1000 = 24 hours
    var hour2 = dat.getHours()

    if (hour1 != hour2) // summertime occured +/- a WHOLE number of hours thank god!
        dat.setTime( dat.getTime() + (hour1 - hour2) * 3600000) // 60*60*1000 = 1 hour

    return dat
or
    this.setTime( dat.getTime() ) // to modify the object directly
    } 
```

那里。完毕！

* * *

## 回答 #43

> 赞同：1
> 
> 时间：2013-12-22T04:31:44.287

我已经使用这种方法在一行中获得了正确的日期，以便在人们上面所说的之后得到时间加上一天。

```
((new Date()).setDate((new Date()).getDate()+1)) 
```

我只是想我会建立一个正常的`(new Date())`：

```
(new Date()).getDate()
> 21 
```

使用上面的代码，我现在可以在`Date()`in 中设置所有这些，`(new Date())`并且它的行为正常。

```
(new Date(((new Date()).setDate((new Date()).getDate()+1)))).getDate()
> 22 
```

或获取`Date`对象：

```
(new Date(((new Date()).setDate((new Date()).getDate()+1)))) 
```

* * *

## 回答 #44

> 赞同：1
> 
> 时间：2018-06-23T14:11:04.047

完成这项工作的最简单方法是使用**date-fns**库。

```
var addDays = require('date-fns/add_days')
addDays(date, amount) 
```

文档可在[此处](https://date-fns.org/v1.29.0/docs/addDays)的此链接中找到。您也可以使用**moment.js**完成此操作。参考链接在[这里](https://momentjs.com/docs/#/manipulating/add/)

希望能帮助到你！

* * *

## 回答 #45

> 赞同：1
> 
> 时间：2017-08-20T13:05:12.707

```
function addDays(n){
    var t = new Date();
    t.setDate(t.getDate() + n); 
    var month = "0"+(t.getMonth()+1);
    var date = "0"+t.getDate();
    month = month.slice(-2);
    date = date.slice(-2);
     var date = date +"/"+month +"/"+t.getFullYear();
    alert(date);
}

addDays(5); 
```

* * *

## 回答 #46

> 赞同：1
> 
> 时间：2019-10-15T16:44:32.257

一些扩展日期的实现 [https://gist.github.com/netstart/c92e09730f3675ba8fb33be48520a86d](https://gist.github.com/netstart/c92e09730f3675ba8fb33be48520a86d)

```
/**
 * just import, like
 *
 * import './../shared/utils/date.prototype.extendions.ts';
 */
declare global {
  interface Date {
    addDays(days: number, useThis?: boolean): Date;

    addSeconds(seconds: number): Date;

    addMinutes(minutes: number): Date;

    addHours(hours: number): Date;

    addMonths(months: number): Date;

    isToday(): boolean;

    clone(): Date;

    isAnotherMonth(date: Date): boolean;

    isWeekend(): boolean;

    isSameDate(date: Date): boolean;

    getStringDate(): string;
  }
}

Date.prototype.addDays = function(days: number): Date {
  if (!days) {
    return this;
  }
  this.setDate(this.getDate() + days);
  return this;
};

Date.prototype.addSeconds = function(seconds: number) {
  let value = this.valueOf();
  value += 1000 * seconds;
  return new Date(value);
};

Date.prototype.addMinutes = function(minutes: number) {
  let value = this.valueOf();
  value += 60000 * minutes;
  return new Date(value);
};

Date.prototype.addHours = function(hours: number) {
  let value = this.valueOf();
  value += 3600000 * hours;
  return new Date(value);
};

Date.prototype.addMonths = function(months: number) {
  const value = new Date(this.valueOf());

  let mo = this.getMonth();
  let yr = this.getYear();

  mo = (mo + months) % 12;
  if (0 > mo) {
    yr += (this.getMonth() + months - mo - 12) / 12;
    mo += 12;
  } else {
    yr += ((this.getMonth() + months - mo) / 12);
  }

  value.setMonth(mo);
  value.setFullYear(yr);
  return value;
};

Date.prototype.isToday = function(): boolean {
  const today = new Date();
  return this.isSameDate(today);
};

Date.prototype.clone = function(): Date {
  return new Date(+this);
};

Date.prototype.isAnotherMonth = function(date: Date): boolean {
  return date && this.getMonth() !== date.getMonth();
};

Date.prototype.isWeekend = function(): boolean {
  return this.getDay() === 0 || this.getDay() === 6;
};

Date.prototype.isSameDate = function(date: Date): boolean {
  return date && this.getFullYear() === date.getFullYear() && this.getMonth() === date.getMonth() && this.getDate() === date.getDate();
};

Date.prototype.getStringDate = function(): string {
  // Month names in Brazilian Portuguese
  const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
  // Month names in English
  // let monthNames = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];
  const today = new Date();
  if (this.getMonth() === today.getMonth() && this.getDay() === today.getDay()) {
    return 'Hoje';
    // return "Today";
  } else if (this.getMonth() === today.getMonth() && this.getDay() === today.getDay() + 1) {
    return 'Amanhã';
    // return "Tomorrow";
  } else if (this.getMonth() === today.getMonth() && this.getDay() === today.getDay() - 1) {
    return 'Ontem';
    // return "Yesterday";
  } else {
    return this.getDay() + ' de ' + this.monthNames[this.getMonth()] + ' de ' + this.getFullYear();
    // return this.monthNames[this.getMonth()] + ' ' + this.getDay() + ', ' +  this.getFullYear();
  }
};

export {}; 
```

* * *

## 回答 #47

> 赞同：0
> 
> 时间：2016-05-03T22:40:26.837

2.39KB 缩小。一份文件。[https://github.com/rhroyston/clock-js](https://github.com/rhroyston/clock-js)

```
console.log(clock.what.weekday(clock.now + clock.unit.days)); //"wednesday"
console.log(clock.what.weekday(clock.now + (clock.unit.days * 2))); //"thursday"
console.log(clock.what.weekday(clock.now + (clock.unit.days * 3))); //"friday"
```

```
<script src="https://raw.githubusercontent.com/rhroyston/clock-js/master/clock.min.js"></script>
```

* * *

## 回答 #48

> 赞同：0
> 
> 时间：2017-11-22T14:12:13.277

尝试这个

```
function addDays(date,days) {        
      var one_day=1000*60*60*24; 
      return new Date(date.getTime()+(days*one_day)).toLocaleDateString(); 
    } 
```

* * *

## 回答 #49

> 赞同：0
> 
> 时间：2021-09-01T11:19:38.657

我试图解决类似的问题，我更喜欢 getTime 方法，但有一些奇怪的基于时区的副作用。

ofc 将“今天”替换为您需要的任何日期，并将时间也传递进去。关键是获取 UTC 时间，然后使用毫秒来进行添加以绕过这些副作用。

```
var now = new Date(Date.now());
var today = new Date(Date.UTC(now.getFullYear(), now.getMonth(), now.getDate()));

const dayInMs = 86400000; //24 hours
const tomorrow = new Date(today.getTime() + dayInMs); 
```

* * *

## 回答 #50

> 赞同：0
> 
> 时间：2019-07-17T15:24:19.460

使用[js-joda](https://github.com/js-joda/js-joda)。**它是一个很棒的javascript**不可变日期和时间库。这是其备忘单的摘录。

到今天再增加 17 天

```
LocalDate.now().plusDays(17); 
```

您还可以从现在开始一次构建所需的日期多个操作。

```
LocalDate.now()
  .plusMonths(1)
  .withDayOfMonth(1)
  .minusDays(17); 
```

或者：

```
var d = LocalDate.parse('2019-02-23'); 
d.minus(Period.ofMonths(3).plusDays(3)); // '2018-11-20' 
```

* * *

## 回答 #51

> 赞同：0
> 
> 时间：2020-09-10T20:30:57.697

我的测试示例可以在同一日期对象实例中添加减号。

```
Date.prototype.reset = function()
{
    let newDate = new Date(this.timeStamp)
    this.setFullYear        (newDate.getFullYear())
    this.setMonth           (newDate.getMonth())
    this.setDate            (newDate.getDate())
    this.setHours           (newDate.getHours())
    this.setMinutes     (newDate.getMinutes())
    this.setSeconds     (newDate.getSeconds())
    this.setMilliseconds    (newDate.getMilliseconds())
}

Date.prototype.addDays = function(days)
{
      this.timeStamp = this[Symbol.toPrimitive]('number')
      let daysInMiliseconds = (days * (1000 * 60 * 60 * 24))
      this.timeStamp = this.timeStamp + daysInMiliseconds
      this.reset()
}

Date.prototype.minusDays = function(days)
{
      this.timeStamp = this[Symbol.toPrimitive]('number')
      let daysInMiliseconds = (days * (1000 * 60 * 60 * 24))
      if(daysInMiliseconds <= this.timeStamp)
      {
          this.timeStamp = this.timeStamp - daysInMiliseconds
          this.reset()
      }

}

var temp = new Date(Date.now())// from now time

console.log(temp.toDateString())
temp.addDays(31)
console.log(temp.toDateString())
temp.minusDays(5)
console.log(temp.toDateString())
```

* * *

## 回答 #52

> 赞同：-1
> 
> 时间：2014-07-29T02:52:08.410

我总结了小时和天...

```
Date.prototype.addDays = function(days){
    days = parseInt(days, 10)
    this.setDate(this.getUTCDate() + days);
    return this;
}

Date.prototype.addHours = function(hrs){
    var hr = this.getUTCHours() + parseInt(hrs  , 10);
    while(hr > 24){
      hr = hr - 24;
      this.addDays(1);
    }

    this.setHours(hr);
    return this;
} 
```

* * *

## 回答 #53

> 赞同：-3
> 
> 时间：2021-06-24T13:33:31.287

对于不知道如何使它工作的每个人：有一个完整的工作代码，它并不完美，但你可以复制它并且它正在工作。

在 InDesign`.jsx`中的启动脚本文件夹中创建一个`"Program Files\Adobe\Adobe InDesign 2021\Scripts\startup scripts"`.

您可以使用 Creative Cloud 中的 Extendscript Toolkit CC 制作并粘贴：

重新启动 indesign 和`jjmmyyyy`+30 应该在 texte 变量中。这将显示像这样的日期`jj/m/yyyy`idk 如何让它显示`24/07/2021`insted`24/7/2021`但对我来说足够好。

```
 #targetengine 'usernameVariable'
    function addVariables(openEvent) 
    {  
    var doc = openEvent.parent;  
    while ( doc.constructor.name != "Document" )  
      {  
    if ( doc.constructor.name == "Application" ){ return; }  
        doc = doc.parent;  
      }  
    // from http://stackoverflow.com/questions/563406/add-days-to-datetime

    var someDate = new Date();
    var numberOfDaysToAdd = 30;
    someDate.setDate(someDate.getDate() + numberOfDaysToAdd); 

    var dd = someDate.getDate();
    var mm = someDate.getMonth() + 1;
    var y = someDate.getFullYear();

    var someFormattedDate = dd + '/'+ mm + '/'+ y;  

      createTextVariable(doc, "jjmmyyyy+30", someFormattedDate);  
    }
    function createTextVariable(target, variableName, variableContents)  
    {  
    var usernameVariable = target.textVariables.itemByName(variableName);  
    if (!usernameVariable.isValid)  
      {  
        usernameVariable = target.textVariables.add();  
        usernameVariable.variableType = VariableTypes.CUSTOM_TEXT_TYPE;  
        usernameVariable.name = variableName;  
      }  
      usernameVariable.variableOptions.contents = variableContents;  
    }  
    app.addEventListener('afterOpen', addVariables); 
```

* * *

## 回答 #54

> 赞同：-8
> 
> 时间：2012-10-05T16:26:18.510

# 相同的答案： [如何将天数添加到今天的日期？](https://stackoverflow.com/questions/3818193/how-to-add-number-of-days-to-todays-date)

```
 function DaysOfMonth(nYear, nMonth) {
        switch (nMonth) {
            case 0:     // January
                return 31; break;
            case 1:     // February
                if ((nYear % 4) == 0) {
                    return 29;
                }
                else {
                    return 28;
                };
                break;
            case 2:     // March
                return 31; break;
            case 3:     // April
                return 30; break;
            case 4:     // May
                return 31; break;
            case 5:     // June
                return 30; break;
            case 6:     // July
                return 31; break;
            case 7:     // August
                return 31; break;
            case 8:     // September
                return 30; break;
            case 9:     // October
                return 31; break;
            case 10:     // November
                return 30; break;
            case 11:     // December
                return 31; break;
        }
    };

    function SkipDate(dDate, skipDays) {
        var nYear = dDate.getFullYear();
        var nMonth = dDate.getMonth();
        var nDate = dDate.getDate();
        var remainDays = skipDays;
        var dRunDate = dDate;

        while (remainDays > 0) {
            remainDays_month = DaysOfMonth(nYear, nMonth) - nDate;
            if (remainDays > remainDays_month) {
                remainDays = remainDays - remainDays_month - 1;
                nDate = 1;
                if (nMonth < 11) { nMonth = nMonth + 1; }
                else {
                    nMonth = 0;
                    nYear = nYear + 1;
                };
            }
            else {
                nDate = nDate + remainDays;
                remainDays = 0;
            };
            dRunDate = Date(nYear, nMonth, nDate);
        }
        return new Date(nYear, nMonth, nDate);
    }; 
```

# silverlight - Silverlight 中经常被误解的概念是什么？

> ID：563408
> 
> 赞同：1
> 
> 时间：2009-02-18T23:58:02.593
> 
> 标签：silverlight, silverlight-2.0

Silverlight 2.0 已经推出了一段时间。您经常看到错误使用或认为被误解的概念有哪些？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T00:13:26.177

我认为早期还没有建立足够多的“用法”实例来确定那些可以说是“经常”被误解的概念。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T09:09:19.540

我认为这是对控件的数据绑定。我觉得很难理解。

**[编辑]** 我是 Web 开发人员，我开发了许多 Web 应用程序。数据绑定在 asp.net 中非常简单。在 Silverlight 中，数据绑定相当复杂。用于数据绑定的Web服务在Silverlight项目之外的其他项目中，它在开发过程中产生了很多问题我不喜欢Silverlight的另一件事是我们必须为silverlight控制创建一个单独的项目。我想创建 Silverlight 页面/控件，就像创建另一个 Web 控件一样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T09:04:12.407

我只会将 var 关键字用于 LINQ 查询。返回的类型可以变化，因此使用类型 var。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-19T08:55:32.647

就个人而言，我不明白**var**关键字的使用，或者我们为什么要使用它而不是真正的类型标识符。

*例子：*

```
var t = new TextBox(); 
```

代替

```
TextBox t = new TextBox(); 
```

# c++ - 如何在 C++ 中调试大量模板化的代码？

> ID：563414
> 
> 赞同：24
> 
> 时间：2009-02-18T23:59:49.783
> 
> 标签：c++, debugging, templates, metaprogramming

我发现在使用 C++ 模板元编程时很难弄清楚我的代码有什么问题。可能是我不太擅长理解错误消息，但据我所知，我不能求助于放入打印语句或断点来弄清楚发生了什么。

除了手动挑选代码并希望它会来找我之外，当你试图弄清楚为什么某些东西没有编译时，你能提供什么提示或建议？

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-02-19T00:12:05.510

对于 STL，至少有一些工具可以输出更人性化的错误消息。见[http://www.bdsoft.com/tools/stlfilt.html](http://www.bdsoft.com/tools/stlfilt.html)

对于非 STL 模板，您只需了解错误的含义。在你看过他们十几次之后，你就更容易猜出问题出在哪里了。如果您将它们发布在这里，也许有人可以帮助您弄清楚。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T00:11:29.160

您可以尝试使用更新的编译器。如果您使用的是 Visual C++ 6.0，请切换到 9.0，您会发现编译器错误的帮助有了巨大的飞跃。

否则，我的技术通常是测试尽可能少的代码部分，直到找出错误为止。这可能是模板系统最大的失败——没有合理的方法来调试它们。

在您自己的代码中，自由使用[编译时断言](http://www.boost.org/doc/libs/1_38_0/doc/html/boost_staticassert.html)以使使用问题更容易诊断。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-02-19T03:27:28.690

如果您使用的是 gcc，我发现[colorgcc](http://schlueters.de/colorgcc.html)可以提供一点帮助。颜色编码可以更容易地在心理上解析出警告、错误和上下文信息。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-19T07:18:56.327

在元编程语言中做一些复杂的事情时，我多次使用 BOOST_MPL_ASSERT 宏，检查元执行的每一步的结果。Boost.MPL 库对此非常有用。我建议您尽可能多地使用那里的代码，因为它很可能不会包含错误。

当我不太确定正在使用某个类的正确特化时，我倾向于在命名空间中隔离正确的特化。一旦你确定专业化是有效的，你必须确保它被选中。如果不是，您必须找出选择哪一个来代替它。然后我建议使用 Boost.EnableIf 从选择过程中排除这种错误接受的专业化。

最后但并非最不重要的一点是，STLfilt 非常有用，您可以自己修改它，使其尽可能适合您的需求。

但最重要的是尽量不要*到处*使用元编程。*它很复杂，所以只有在真正*需要时才使用它。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-19T00:12:42.590

我认为这应该对您有所帮助。

[http://www.bdsoft.com/tools/stlfilt.html](http://www.bdsoft.com/tools/stlfilt.html)

我自己没用过；但是，它可能会对您有所帮助。我还可以告诉你，随着你对模板和元程序有更多的经验，你会习惯错误消息。有时它们可​​能有点难以阅读；但是，他们的疯狂是有逻辑的。只要让你的终端尽可能大，并在你阅读它时尝试翻译它在你脑海中所说的内容。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-19T00:17:20.067

您使用的是哪个编译器？VC8 和 9 实际上在输出可读的错误信息方面相当不错。仍然需要一点耐心才能完成，但可以完成，并且它们本质上显示了调用堆栈的编译时等价物。从底部开始，哪个模板实例化导致了错误，模板参数是什么？下一级显示它被实例化的模板等等，一直到顶层。当然，这仅在“输出”选项卡中可见，而不是在编译失败后通常显示的“错误”选项卡中。

GCC 中的原理类似，尽管我上次尝试过，至少格式的可读性有点差。但实际上，您只需要跟踪实例化堆栈，并在每个级别验证它是否使用您期望的类型实例化，直到找到引入错误的类型。

这很痛苦，但可以做到，而且只需要耐心和愿意阅读错误消息即可。:)

此外，通过提供健全性检查，自由使用 static_assert（或 BOOST_STATIC_ASSERT）可以提供很大帮助

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2019-09-11T20:14:13.060

对于调试，通常它有助于在某个点停止元程序并显示某种类型计算的结果。这可以这样实现：

```
template <class T>
struct mp_debug : T::MP_DEBUG_FORCE_COMPILE_FAILURE {};

using Foo = int; // type to be inspected

// usage at namespace scope
template struct mp_debug<Foo>;

// usage at function scope
int main() {
  mp_debug<Foo>{};
} 
```

这会导致编译器打印一个编译时错误，显示 mp_debug 的评估类型参数。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-02-19T01:44:30.107

随着时间的流逝，您会习惯它，不幸的是，如果您打算使用 C++，则必须这样做。因为，像 VC9 这样的一些库有很好的错误消息，但是一旦你说 GCC 或其他编译器，这些消息就消失了。当你在别人写的某个库中出现错误时，甚至 VC9 也对你没有多大帮助，或者你自己在深夜写的错误，甚至一些 Boost 库也不是那么友好。仅仅是因为并非每个作者都在发生错误时不厌其烦地把事情弄清楚，这在新库中更为常见（往往有最多的错误和较少的帮助）。

此外，您必须记住，您可能会在代码中到处找到漂亮的 STATIC_ERRORS，它们是由作者放置在事情通常会中断的地方，并且总会有可怕的极端情况，这是作者没有想到的，这将产生 400 行错误消息，例如，您在某处错过了 const。

使用工具一开始会帮助你，但从长远来看会伤害你。而且由于这个问题是 C++ 固有的，所以它不会很快消失。在不再使用 C++ 之前，这些错误之墙可能会一直存在。因此，当您需要它们生存时，工具只会割伤您的牙齿。如果你打算很快离开 C++，那么请随意使用它们。现在我通常可以一眼看懂那些 400 行错误信息，所以它们对我来说是一清二楚，但这不是因为任何工具。

与所有事物一样，尤其是 C++，它需要经验和培训。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-02-21T10:55:53.967

正如答案已经说明的那样，模板代码基本上有两种困难：1.让它编译，并找到编译器错误的原因 2.让它在运行时做正确的事情

我通常尝试将编译时类型魔法与运行时逻辑分开，这有助于找到问题的原因（类型 1 或 2）。实现这一点的一种方法是使用一种模板类型来实现类型魔法，并使用尽可能少的运行时功能，以及使用模板类型的运行时逻辑的一种普通类型。

如果你然后按照其他回复的建议，特别是关于 compile_time asserts 的建议，将更容易找到问题的根源。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-12-12T04:44:36.780

[Templight](http://plc.inf.elte.hu/templight/)：C++ 模板元程序调试器和探查器

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-03-13T17:34:38.740

[Metashell](https://metashell.readthedocs.io/en/latest/)是一个很好的模板调试工具。带联机模式！

# xcode - 如何在 OS X 10.4x 上试验 Xcode

> ID：563421
> 
> 赞同：2
> 
> 时间：2009-02-19T00:01:39.777
> 
> 标签：xcode, osx-tiger

我想开始尝试 Cocoa、Objective-C 和 Xcode，但我拥有的唯一一台 Apple 计算机是一台安装了 OS X 10.4.7 的旧 PowerBook，据我所知，我必须购买并安装 OS X 10.5（我认为是 Leopard）只是为了能够安装 Xcode 3.2 - 当前可用的版本。问题是我是一名 Windows 开发人员，我不想为了玩 Xcode 而升级这台几乎没有功能的 Mac 笔记本电脑。所以，我想知道有什么方法可以下载一些可以在 OS X 10.4.7 上运行的旧 2.x 版本的 Xcode？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T00:16:49.727

[在http://connect.apple.com](http://connect.apple.com)上的 Apple Developer Connection 创建一个免费帐户（如果您还没有），在下载的开发者工具小节（大约一半）中，您会发现：

> Xcode 2.5 开发者工具
> 
> Xcode 2.5 是 Xcode 开发人员工具的更新版本，提供了对 Xcode 2.4.1 的错误修复。Xcode 2.5 可以安装在 Tiger (Mac OS X 10.4) ...

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T00:08:19.077

您的 Tiger DVD 上有 XCode 吗？我知道 Leopard DVD 包含当时最新版本的 XCode。

您还可以从 developer.apple.com 上的 ADC 部分下载 XCode 2.1 工具。ADC -> 下载 -> Mac OS X。

您必须创建一个帐户，但基本帐户是免费的。

# apache-flex - Flex AdvancedDataGrid with Grouping，如果第二个 GroupingField 为空，我如何让对象出现在第一个 GroupingField 下？

> ID：563448
> 
> 赞同：0
> 
> 时间：2009-02-19T00:13:07.660
> 
> 标签：apache-flex, advanceddatagrid

我正在使用带有两个 GroupingFields 的 AdvancedDataGrid。dataProvider 有一个包含这两个字段值的对象列表，但有时第二个字段值可能为空。加载时，AdvancedDataGrid UI 有一个根文件夹（第一个 GroupingField）和一些额外的子文件夹（第二个 GroupingField）。这一切都很好。但是，对于第二个 GroupingField 具有空值的对象，只会被放置在没有标签的子文件夹中。

我希望第二个 GroupingField 值为空的对象显示为根文件夹（第一个 GroupingField）下的叶节点减去空白子文件夹。

描绘这一点的一个好方法是文件资源管理器。有没有好的方法来做到这一点？通过actionscript扩展此节点后，可能使文件夹图标消失？

```
ParentFolder
   SubFolder
      Leaf Object
      Leaf Object
   SubFolder
      Leaf Object
   Leaf Object
   Leaf Object 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-03-17T23:57:33.110

您可能需要考虑将分层数据传递到 ADG，而不是对平面数据使用 GroupingCollection。对于分层数据，具有子节点的节点将表示为文件夹，没有子节点的节点将显示为叶子（就像 Tree 控件的行为一样）。

就像这样：[http ://www.flex-blog.com/tree-in-advanced-datagrid-example/](http://www.flex-blog.com/tree-in-advanced-datagrid-example/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2013-12-10T05:08:49.940

您可以先从对象列表中删除空白对象（使用循环或过滤器功能），然后将其设置为数据网格的数据提供者。

# .net - 停止异步 HttpWebRequest

> ID：563457
> 
> 赞同：1
> 
> 时间：2009-02-19T00:15:11.413
> 
> 标签：.net, asynchronous, httpwebrequest

我有一个应用程序使用 HttpWebRequest 异步向 Web 资源发出多个并发请求。尽管我已将 HttpWebRequest 实例的超时属性设置为 5 秒，但有时当异步调用 BeginGetRequestStream 时，获取流可能需要比这更长的时间，并且导致引用混乱。有没有办法限制它请求流的时间？此外，如果我得到流并决定我想通过从不实际调用 BeginGetResponse 完全放弃请求，那么该操作过程是否有任何后果？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2015-11-19T15:47:13.277

你可以用这个

```
ManualResetEvent allDone = new ManualResetEvent(false);
bool isRequestFnishedInCorrectTime=allDone.WaitOne(5000);
if(isRequestFnishedInCorrectTime==false)
    request.Abort();
else
    //request success 
```

得到回复后的重点是你必须设置这个：

```
allDone.Set(); 
```

如果请求无法在 5 秒内完成，请求将中止。

# sharepoint - SharePoint 2007：如何在事务中执行一系列操作？

> ID：563465
> 
> 赞同：6
> 
> 时间：2009-02-19T00:18:02.407
> 
> 标签：sharepoint, transactions, moss, wss, transactionscope

我很想知道如何在事务中的 SharePoint 上下文中执行一系列操作。例如，我希望能够执行以下操作：

```
context.BeginTransaction();
listItemA.Update();
listItemB.Update();
context.CommitTransaction(); 
```

我知道这对于 OOTB API 是不可能的，但必须有人想出如何做到这一点。是否可以获得对数据库连接的引用以处理事务？还是有其他想法？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-02-19T00:23:30.880

尽管 SharePoint 在技术上使用 SQL 作为存储支持，但我们不应将其视为基于数据库的应用程序。SP 创建了各种各样的虚假文件系统，这是我们通过 API 与之交互的。因此，从开发人员的角度来看，Sharepoint 几乎没有事务。

不幸的是，这就是它的全部内容了 :) 即使*考虑*尝试直接参与数据库也会导致旧约的痛苦。撕裂衣服，哭泣和咬牙切齿；）

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-02-10T14:36:12.327

只需使用 Recycle()。在 GUID[] 中跟踪 GUID。如果一个失败打开 de RecycleBin 并通过 GUID 恢复/删除所有

```
GUID[] guids = new GUID[];
SPWeb web;
SPListItem item;
SPList list;

try
{
    foreach item in list

    GUID current = item.Recycle()
    guids.add(current);

    item.Delete();
}
catch{
    if one fails : web.RecycleBin.Restore(guids);
}

if all succeed : web.RecycleBin.Delete(guids): 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-26T21:01:51.813

如果您使用版本控制，您可以尝试签出项目、执行更新和签入的解决方案。如果需要回滚，只需撤消签出。

也许可以工作？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-29T09:07:49.607

Another option is to use workflow, [mentioned here](http://prjsoft.ru/blog/?p=9). As stated in [How Windows SharePoint Services Processes Workflow Activities](http://msdn.microsoft.com/en-us/library/ms442249.aspx):

> Windows SharePoint Services runs the workflow until it reaches a point where it cannot proceed because it is waiting for some event to occur: for example, a user must designate a task as completed. Only at this "commit point" does Windows SharePoint Services commit the changes made in the previous Windows SharePoint Services-specific workflow activities. Those changes are batched into a single SQL transaction.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-01-05T16:15:56.503

Sharepoint 不提供开箱即用的事务支持。[这是为 SharePoint 构建 System.Transactions 资源管理器的](http://www.loisandclark.eu/Pages/transactions.aspx)一个很好的资源， 尽管我会节省工作量并将任何关键数据直接存储到 RDB 中。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-11-20T10:47:48.110

没有 Sharepoint 不提供类似 SQL 服务器的事务功能。

正如 Rutger Hemrika 所发布的那样，这是一种比我迄今为止看到的任何其他方法都要好的方法。

# php - 如何从 PHP 网站开始？

> ID：563480
> 
> 赞同：1
> 
> 时间：2009-02-19T00:25:29.703
> 
> 标签：php

对于一个学校项目，我必须使用 PHP 制作一个网站，允许用户在那里生成自己的文章或评论新闻或其他文章。我想知道如何最好地使用 GET 函数来显示包含文件中的内容，并将 get 函数用于其他包含文件，例如登录页面和开发人员（我）添加到网站而不是作为文章的其他内容但作为链接等。任何人都可以发布任何建议或好的教程。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T01:00:40.820

车轮已被发明、测试、滚动一百万英里：[**WordPress**](http://wordpress.org/)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T01:07:02.040

在包含文件之前，您肯定希望对通过 GET 参数传入的任何内容进行清理。您通常通过检查有效字符来执行此操作，并且由于它直接从文件系统调用文件，因此我通常手动输入有效的导航操作。这不是最优雅的解决方案，但对于小型应用程序来说通常是最简单和最安全的。

我通常为此使用大小写开关，但我也看到人们也使用花哨的正则表达式。

类似于以下内容：

```
if (isset($_GET['nav'])) {
    switch ($_GET['nav']) {
        case 'login':
        case 'logout':
        case 'article':
             include($_GET['nav'] . '.php');
             break;
        default:
             die('Invalid nav parameter');
             break;
    }
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T01:45:31.603

这是我用的...

```
 function safeIncludeFile($path) 
   {

        $regex = '/[a-z0-9\-_]+/i'; // match only a to z, 0 to 9 and the minus and unscore character. case insensitive. adjust to accommodate your file naming schema.

        return preg_match($regex, $path); 

   } 
```

然后做这样的事情

```
if (isset($_GET['page']) && safeIncludeFile($_GET['page'])) {
   require PATH_TO_INCLUDES . $_GET['page'] . '.inc.php';

} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-10-06T11:05:58.687

您还可以拥有一个充当白名单的数组

```
$allowedIncludes = array('home', 'about', 'news'); 
```

然后检查请求的页面是否在那里

```
if(in_array($_GET['page'], $allowedIncludes)){
  include $_GET['page'].'.php';
}else{
  die('Forbidden!');
} 
```

因此，您不必在每次添加某些内容时都在交换机上添加“案例”。

# attributes - 我可以在不使用属性的情况下创建 WCF 服务吗？

> ID：563483
> 
> 赞同：2
> 
> 时间：2009-02-19T00:27:15.100
> 
> 标签：attributes, wcf, ironruby

您似乎声明 WCF 服务的方式是在 C# 或 VB 中创建一个接口，然后`ServiceContractAttribute`用`OperationContractAttribute`.

问题是，我想尝试从 IronRuby 或 IronPython 创建一个（据我所知）不支持属性。

这可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T01:09:17.370

AFAIK 你还不能在 IronRuby 中。在处理语言兼容性时，它是那些被搁置的互操作事物之一。关于如何做到这一点仍然需要进行大量讨论......但这是我们这些从事 IronRuby 工作的人希望看到的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T09:24:28.210

您可以只使用[System.ServiceModel.Description](http://msdn.microsoft.com/en-us/library/system.servicemodel.description.aspx)命名空间中的对象模型（例如 ContractDescription）来新建正确的描述对象，将它们插入[服务的 description](http://msdn.microsoft.com/en-us/library/system.servicemodel.servicehostbase.description.aspx)的端点，然后打开主机。但这是非常重要的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T00:36:49.927

好吧，虽然我不会（只是偏好，没必要激怒我），但你可以使用像 Boo 这样的语言：

[http://boo.codehaus.org/](http://boo.codehaus.org/)

另一种选择是在 C# 中构建一个片段来为您进行这种通信，然后从 IronyRuby 或您想要使用的任何语言中调用它。

# flash - 防止mp3的渐进式下载？

> ID：563494
> 
> 赞同：3
> 
> 时间：2009-02-19T00:38:33.557
> 
> 标签：flash, streaming, rtmp, flash-media-server

我正在寻找一些在 Flash 中创建 mp3 播放器的解决方案；一种使用流媒体或某种混淆来阻止用户下载源 mp3 的软件。如果我使用使用 RMTP: 协议的服务器/解决方案，那会阻止下载吗？是否有可能使用 Amazon S3 服务器来提供文件但隐藏文件的实际 URL？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T00:49:24.657

不，RTMP 不会阻止直接下载——如果用户可以找到直接 URL，那么他们仍然可以下载文件。我不了解 S3，但我使用过像 Red5 这样的流媒体服务器，并且知道可以从中直接下载 MP3 内容，因此谨慎保护您的服务器以防止人们查看索引等。

正如您所建议的，混淆 URL 是一种可能性，就像即时重命名一样。您可以将 GUID 传递给客户端，然后在服务器上，将 MP3 复制到与该 GUID 名称相同的目录中。客户端从该位置下载，然后删除副本。这当然会在服务器上施加更高的磁盘负载，但我只是为了集思广益而将这个想法抛在脑后。:)

简而言之，如果用户有足够的积极性，AFAIK 可以直接通过 RTMP 获取 MP3 内容，所以与其玩猫捉老鼠，你应该使用少量的劝阻来防止人们滥用你的网站，但不要阻止您完成其他工作以赢得这样的军备竞赛。

**编辑**：再想一想，这可能在某些流媒体服务器上是可能的……也许只是像 Red5 这样的服务器允许用户在知道 URL 的情况下也下载内容。尽管如此，斯科特也有一个好点……你传送的任何东西都可能被截获。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T00:57:20.347

我敢打赌，无论您想出什么解决方案，我都可以将其捕获并保存为 MP3。这假设您希望我真正听一些东西。

所以答案是，如果你给你的用户数据，你就不能隐藏数据。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T00:51:22.030

jw 媒体播放器支持这一点。

[http://www.longtailvideo.com/players/jw-flv-player/](http://www.longtailvideo.com/players/jw-flv-player/)

# bash - 哪些 UNIX 命令支持彩色输出？

> ID：563500
> 
> 赞同：11
> 
> 时间：2009-02-19T00:43:21.067
> 
> 标签：bash, unix, shell, colors, ls-colors

我喜欢使用支持彩色输出的 UNIX/bash 命令。因此，我定义了一些别名，它们会自动启用我知道支持此选项的命令的彩色输出。但是，我确信那里有数百个支持彩色输出的命令——我想知道它们是什么。

我`~/.bash_aliases`文件中的那些是：

```
ls --color=auto
grep --color
phpunit --ansi 
```

那里还有什么？是否有支持彩色输出的所有命令的列表？或者更好的是，一些命令用于搜索我的本地手册页并提取适当的命令名称。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-19T00:47:35.220

你为什么不试试：

```
man -K color 
```

这应该在您的所有手册页（内容，而不仅仅是标题）中搜索单词颜色。

对于每个手册页，它都会询问您是否要打开和查看该页面：

```
$ man -K color
/usr/share/man/mann/Widget.n.gz? [ynq] y
/usr/share/man/mann/usual.n.gz? [ynq] y
/usr/share/man/mann/Toplevel.n.gz? [ynq] n
/usr/share/man/mann/itk.n.gz? [ynq] n
/usr/share/man/mann/Archetype.n.gz? [ynq] n
/usr/share/man/man8/squid.8.gz? [ynq] n
/usr/share/man/man7/Xprint.7.gz? [ynq]
/usr/share/man/man7/X.7.gz? [ynq]
/usr/share/man/man7/urxvt.7.gz? [ynq]
/usr/share/man/man7/term.7.gz? [ynq] q

$ 
```

在每个单独的手册页中，您可以使用常规搜索方法（例如`/color<ENTER>`）来查找文本。完成手册页后，只需退出，它将继续搜索。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-02-19T01:00:50.400

快速搜索一下 google 也会显示[`grc`](http://manpages.ubuntu.com/manpages/gutsy/man1/grc.1.html)和[`grcat`](http://manpages.ubuntu.com/manpages/gutsy/man1/grcat.1.html)，它可用于为任意文本或命令着色。但不确定它们的工作情况如何。既然我找到了它们，我肯定会尝试一下。

啊，我们走吧。`grc`使用该`/etc/grc.conf`文件根据它匹配的正则表达式为给定命令着色。我（Ubuntu 8.10）的快速 grep`/etc/grc.conf`显示它目前支持：

```
[~]$ less /etc/grc.conf | grep '^#'
# anything to do with irc
# log file
# ping command
# traceroute command
# gcc command
# make command
# netstat command
# diff command
# last command
# ldap tools
# cvs command 
```

但我相信你可以为你感兴趣的其他程序添加你自己的。

要使用`grc`，只需将它放在要着色的命令之前（比如说`diff`）：

```
grc diff foo.txt bar.txt 
```

您当然`alias diff='grc diff'`可以`diff`默认设置为彩色。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T00:56:09.240

我很喜欢给我的提示上色，让它脱颖而出。[在这里](http://www.ibm.com/developerworks/linux/library/l-tip-prompt/)可以找到关于这类事情的有用文章。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-21T01:14:26.437

查看日志时，您可能会喜欢`tail -f /var/log/messages | loco`彩色输出。

在[loco](http://www.zjuul.net/~jules/loco)网站上有一个[屏幕截图，在](http://www.zjuul.net/~jules/loco/screenshot.html)[http://www.linuxhaxor.net/2008/01/02/perl-script-to-add-nice-colors-to-your-varlogmessages-file](http://www.linuxhaxor.net/2008/01/02/perl-script-to-add-nice-colors-to-your-varlogmessages-file)上有更多示例

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T01:21:03.893

这个演示 bash 脚本在大多数终端中将目录涂成红色 - 当然可以在 Windows 下的 xterms 和 cygwin 中使用。您可以通过摆弄转义码来调整颜色 - Google for LS_COLOR 获取颜色代码列表：

```
#!/bin/bash

color_red()
{
    echo -e "\033[01;31m$1\033[00m"
}

for FILE in $*
do
    if test -d $FILE
    then
        color_red $FILE
    else
        echo $FILE
    fi
done 
```

# .net - 反转 ResourceManager

> ID：563506
> 
> 赞同：3
> 
> 时间：2009-02-19T00:45:25.180
> 
> 标签：.net, localization, .net-2.0

如果执行 ResourceManager.GetString(Key)，则可以获取资源中某项的值。有没有办法进行反向查找以从给定值的资源中获取密钥（本质上是反翻译）？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T01:33:29.353

您应该能够获取 ResourceSet 并迭代它的值并在它们相等时返回键。请记住，您需要比较值，而不是参考。这些方面的东西（未编译和测试，但类似的东西）

```
 System.Resources.ResourceManager rm = 
     new System.Resources.ResourceManager("MyAssembly.MyResources",
         System.Reflection.Assembly.GetExecutingAssembly());
  System.Resources.ResourceSet rs = 
     rm.GetResourceSet(System.Globalization.CultureInfo.CurrentCulture, 
         false, false);
  System.Collections.IDictionaryEnumerator ide = rs.GetEnumerator();
  while(ide.MoveNext())
  {
      if (ide.Value == val)
          return ide.Key;
  } 
```

# gps - 使用 GPS 测量面积

> ID：563510
> 
> 赞同：0
> 
> 时间：2009-02-19T00:48:43.440
> 
> 标签：gps, distance

嘿伙计们，我正在为我的一个参与道路建设的朋友研究一些东西。他需要某种设备来测量点之间的距离或面积。我过去做过一些 GPS 编程，但对于移动设备，我对准确性并没有太大印象。那是几年前的事了，我认为技术已经改进，但是我不确定我应该使用什么设备作为接收器。由于移动设备可能是不可能的，因为我需要能够在其上运行我的自定义应用程序，通过 USB 端口连接的东西可能会起作用吗？我发现 u-blox PCI 很难与笔记本电脑和 PC 配合使用。这里有没有人有过这方面的经验？也许还有其他我需要研究的设备？

我很感激我能得到的任何帮助。谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T00:58:44.260

您可以使用具有 GPS 并能够运行您的自定义软件的移动设备，如 iphone、谷歌手机，可能还有很多其他智能手机。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T01:15:25.047

如果你真的需要嵌入你自己的定制软件，你可以自己动手，走 Arduino 路线：

[http://www.ladyada.net/make/gpsshield/](http://www.ladyada.net/make/gpsshield/)

如果稍后处理数据是一种选择，我发现 AMOD AGL3080 对您的降压数据记录器来说是一个很好的选择。预热后准确性非常好，它像磁盘一样安装在 Linux、OS X 和 Windows 上，您可以在其中拉出日志并进行处理。您可以使用 GPSBabel 将它们转换为您需要的任何格式，但默认为 NMEA。

如果其他人有更好的解决方案，我也很想知道——程序员的负担得起的 GPS 玩具似乎很难买到！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-25T19:43:30.747

就硬件而言，我对这个有很好的体验（这只是[一个](http://www.solidsignal.com/prod_display.asp?PROD=0100032100)模型的链接，我没有从他们那里买过，所以您所在地区的价格可能会有很大差异）（与您的朋友类似的设备）。当然，关于准确性，您需要谈论确切的数字。如果标准 gps 精度对你来说不够好，也许差分 gps 可以为你做更多（建议你谷歌“dgps”）。

就软件而言，我使用终端去获取原始数据，然后使用我自己的程序，分析并绘制它。不知道你到底需要什么，告诉更多。

（ps 这个模型很粗糙，不仅仅是从移动的汽车顶部掉下来，它仍然可以工作:)

# asp.net - asp.net 中 User.Identity 中的 Ticket.UserData 有多安全

> ID：563511
> 
> 赞同：4
> 
> 时间：2009-02-19T00:49:12.097
> 
> 标签：asp.net, cookies, forms-authentication

我的网站使用 ASP.NET 的表单身份验证，并且我将用户特定信息插入到身份验证票证/cookie 的 UserData 部分。由于 UserData 在身份验证票内，因此像这样加密

```
authCookie.Value = FormsAuthentication.Encrypt(newTicket); 
```

现在我不太担心此时数据被泄露，因为它是加密的。但我注意到数据以这样的未加密形式提供

```
FormsIdentity fid = User.Identity as FormsIdentity;
string plainTextUserData = fid.Ticket.UserData; 
```

数据本身并不太重要。即使其他人可以看到，我仍然可以。但我不能让人们劫持这些信息并开始将其用作自己的信息。例如，我不希望一个用户假装是另一个用户登录（基于 UserData 中包含的用户 ID

这是我必须担心的事情吗？

### 编辑1：

我想这样做的原因是我可以停止使用会话，只使用 cookie 和 Ticket.UserData

### 编辑2：

Ticket.UserData 中的数据没有变化。一旦用户登录，它就会保持不变。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T02:03:53.167

> 根据用户的操作，我需要在某些页面上提供更多数据。现在我正在使用会话，但现在我想将所有内容移到 cookie 中。这不是很多数据，所以我想我可以将所有内容搭载到身份验证票/cookie中

@jorsh1 基于您对@Portman 的推荐，Ticket.UserData 不是存储变化数据的地方。从一页转到另一页时，您不希望一直重新创建身份验证票证。

将 Session 数据与*Session Service*或*Sql Server*一起使用。如果您不希望会话中的数据，并且数据很小且不敏感，则使用 cookie。(*)

使用 UserData 的 MS 规范示例是存储角色列表之类的内容，以便您可以说“我认为此用户是管理员吗”之类的内容，但如果它类似于管理员角色，您可能会点击数据库进行检查在您暗中信任 cookie 中的内容之前。

> string plainTextUserData = fid.Ticket.UserData;

这仅在您的应用程序中有效，因为 Asp.Net 已经为您解密了票证。但是，如果要设置数据 IIRC，则需要重新创建并重新附加表单身份验证 cookie。

```
FormsAuthenticationTicket ticket = new FormsAuthenticationTicket(
    currentTicket.Version + 1,
    currentUser.UserName,
    now,
    now.Add(formsAuthentication.Timeout),
    false,
    "new user data string",
    FormsAuthentication.FormsCookiePath);

string hash = FormsAuthentication.Encrypt(ticket);
HttpCookie cookie = new HttpCookie(
    FormsAuthentication.FormsCookieName,
    hash);

Response.Cookies.Add(cookie); 
```

除非它知道解密密钥或者它是暴力破解的，否则另一个应用程序无法解码此票证。如果您对应用程序进行负载平衡或使用网络花园，[您甚至需要保持密钥同步。](http://msmvps.com/blogs/omar/archive/2006/08/20/forms-authentication-failed-for-the-request-reason-the-ticket-supplied-was-invalid-solution.aspx)

* 我不支持在会话中存储东西。通常还有另一种方法来持久化这些数据。

* * *

[编辑] 我使用会话的目的：

我经常发现自己做的唯一一件事就是在基于会话服务器的会话中存储用户关键数据的精简版。然而，我们让它透明加载，并确保不要复制票证中的内容。

这样我们就不会在 cookie 中暴露任何敏感信息，也不会依赖 session。我们还设置了积极的会话回收。结合 session 中存储的少量数据，session 不会给我们带来问题，并且由于只有 1 段代码知道 session 中的内容，我们可以轻松地对其进行重构。

对于其他任何事情，会话都是邪恶的。我更喜欢在需要它的页面中维护视图状态，或者只是将临时状态保留在数据库中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T01:18:38.953

它与身份验证票证一样安全。由于您将它用于相同的目的，请不要担心。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T01:14:24.500

你**可能**不需要担心。

如果数据是敏感数据（例如，美国的社会安全号码），那么您可能应该避免使用 FormsAuth 票证发送它，即使它是加密的，因为作恶者总是会制造新的攻击。

但是，我不得不问：您已经可以为每张票（用户名）存储一个标识符，那么为什么不将所有其他数据保存在数据库中呢？

# reporting-services - MS Reporting Services - 在 1 个报告输出中多次运行子报告

> ID：563519
> 
> 赞同：2
> 
> 时间：2009-02-19T00:55:29.600
> 
> 标签：reporting-services, report

我有 2 个报告，第一个是授权表，第二个打印 RMA 标签，运行这些报告所需的只是 RMA #

使用第三个报告，以便我可以有 2 个子报告（一个用于 Auth 表单，一个用于标签），以便他们可以运行 1 个报告并在 1 个位置获取他们需要的所有数据。此报告有一个 RMA # 作为参数并将其传递给 2 个子报告。

一切正常，但我想提供接受以逗号分隔的 RMA # 值的功能，然后为每个 RMA # 运行 Auth Form/RMA Tag 子报告组合，我不确定如何为主报表以及如何从主报表多次调用子报表。

我希望我已经解释得足够好。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T16:39:48.400

我建议尝试将子报告放在一个分组中，以获得可以区分新子报告的值...

# static - 使用共享静态 WCF 代理客户端有哪些陷阱？

> ID：563525
> 
> 赞同：3
> 
> 时间：2009-02-19T00:58:53.277
> 
> 标签：static, client, shared, wcf-proxy

我正在考虑将共享（读取静态）WCF 代理客户端用于高吞吐量应用程序。我相信这样做可以提高性能，但我还没有对此进行基准测试。

这个想法有一些严重的缺陷吗？

根据我的研究，我可以看到存在处理故障状态的问题，尚不清楚该状态对其他待处理请求的影响是什么。

有没有人有从故障状态恢复 WCF 代理的经验？

提前致谢！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T01:13:46.517

一旦通道处于故障状态，它将保持这种状态。所以是的，我认为静态客户端会有问题。我也是以这种方式开始的，但最终为每次通话创建并打开了一个新频道。似乎没有太多的性能权衡。

作为参考，我在来自另一台四核机器的四核机器上执行大约 30-60 个请求，每个请求每秒大约 5K-30K。到目前为止，WCF 一直保持得很好。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-23T01:18:02.937

我刚刚发现在执行 [OperationContract(IsOneWay = true)] 的单向操作调用时，在代理上调用 Close() 会阻塞。这也会改变流程。

# java - dbunit 测试用例抛出 NoSuchTableException

> ID：563531
> 
> 赞同：0
> 
> 时间：2009-02-19T01:04:27.333
> 
> 标签：java, exception, dbunit

我正在尝试修复一个项目的测试套件，该项目是我从另一个程序员那里继承的一些 java 数据库代码。项目本身使用hibernate 和MySQL 作为数据库的东西，但为了测试用例的目的，正在使用dbunit。我可以正确加载和初始化hibernate的会话工厂，但是当我尝试在Eclipse中运行我的测试时，我不断收到异常，即“org.dbunit.dataset.NoSuchTableException：mytablename”。

我知道所有文件都在正确的位置，并且我传递给 dbunit 的实际 XML 文件是可以的（我使用的是 FlatXmlDataSet 类型）。我在数据库测试用例基类中的 setUp() 方法如下所示：

```
@Override
protected void setUp() throws Exception {
    super.setUp();
    IDataSet dataSet = new FlatXmlDataSet(new File(mDataFile));

    Session session = HibernateUtil.getSessionFactory().getCurrentSession();
    session.beginTransaction();

    IDatabaseConnection connection = new DatabaseConnection(session.connection());

    DatabaseConfig config = connection.getConfig();
    config.setProperty(DatabaseConfig.PROPERTY_DATATYPE_FACTORY, new HsqldbDataTypeFactory());

    DatabaseOperation.CLEAN_INSERT.execute(connection, dataSet);

    session.getTransaction().commit();
} 
```

在 CLEAN_INSERT 数据库操作之后，立即抛出异常，抱怨**我的 XML 文件中的最后一个表**，无论这是哪个表。我已经手动和使用 Eclipse 验证了 DTD 和 XML 模式，甚至到了确保两个文件中表的顺序匹配的地步。我宁愿不将这些文件粘贴到此处（因为它会涉及大量搜索替换），但请相信我，我已经查看了 dbunit 示例并确保语法匹配。

关于什么可能是错误的任何想法？我已经在谷歌上搜索了几个小时，但找不到任何有用的东西。

**编辑：**我忘记提及的一件事是，当我在抛出的行上放置一个断点时，我可以查看 dataSet 的结构并看到我的所有表以及所有测试数据实际上都在那里。所以至少那部分似乎工作正常。

@Bogdan：嗯……好主意。我将尝试使用常规 INSERT 加载数据。@sleske：也是一个很好的建议。感谢您的提示；希望这将使我走上解决此问题的正确道路。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T02:10:28.097

`DatabaseOperation.CLEAN_INSERT`本质上是和`DatabaseOperation.DELETE_ALL`的组合`DatabaseOperation.INSERT`。由于`DatabaseOperation.DELETE_ALL`以相反的顺序清除表，我怀疑在清除最后一个表时它不会失败，但在清除第一个表时。

您确定您的数据集中的表确实存在于您在测试时使用的数据库中吗？您得到的错误表明他们没有。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T03:08:27.020

需要更多信息来解决这个问题。

你试过调试这个吗？您可以将 DBUnit 的源代码作为一个单独的项目放入您的 Eclipse 工作区。然后配置测试的“构建路径”以使用 DBUnit 项目而不是 dbunit.jar。这样您就可以调试 DBUnit 的代码。然后你会希望看到它为什么会抛出异常。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-24T09:25:43.550

sleske 确实是对的——需要更多信息来解决这个问题，这意味着我没有问对正确的问题。虽然这里的两个建议都很有帮助，但我会觉得将其中一个标记为正确答案很糟糕，因为我没有问正确的问题，所以我将在这里记录我为使其正常工作所做的工作。

基本上，问题是由其他类型的架构不匹配引起的。测试数据库的 DTD 和 XML 匹配，但 DTD 不再匹配 hbm.xml 文件中列出的**实际**模式（即我们在生产数据库中使用的模式），并且 XML 文件中的测试数据库缺少某些列后来被标记为 NOT NULL。此外，XML 包含没有 .hbm.xml 配置文件的表，因为该代码的原始作者从未开始编写将使用这些表的功能。因此，即使在 DTD 中指定了它们，缺少相应的 HBM 映射也会导致问题。

此外，我不得不根据我[在这篇关于同时使用 hibernate 和 dbunit 的博客文章中](http://bill.dudney.net/roller/bill/date/20040521)发现的内容重写我们的一些数据库测试用例基类代码。

Finally, I needed to fix our build process so that a "hibernate-test.cfg.xml" file was used in place of the real configuration, and then everything worked fine. Now I just need to figure out why some of the test cases are throwing exceptions. :)

# java - java位操作

> ID：563544
> 
> 赞同：10
> 
> 时间：2009-02-19T01:08:43.860
> 
> 标签：java, bit-manipulation, byte

```
byte x = -1;
for(int i = 0; i < 8; i++)
{
    x = (byte) (x >>> 1);
    System.out.println("X: " + x);
} 
```

据我了解，java将数据存储在二进制补码中，意思是-1 = 11111111（根据维基百科）。

此外，来自 java 文档：“位模式由左侧操作数给出，而要移位的位置数由右侧操作数给出。无符号右移位运算符 >>>”将零移到最左边位置，而“>>”后最左边的位置取决于符号扩展。”

这意味着 >>> 每次都会将 0 移到最左边。所以我希望这段代码是

迭代：x的位表示

0：11111111

1：01111111

2：00111111

3：00011111

...很快

但是，我的输出始终是 X: -1，这意味着（我猜）>>> 将符号位放在最左边的位置。所以我然后尝试>>，结果相同。

这是怎么回事？我希望我的输出是：X：-1，x：127，x：63，等等。

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-02-19T01:16:34.137

那些认为在发明 Java 时应该对字节进行签名的人应该取出并用一根湿芹菜棒殴打直到他们哭泣:-)

您可以通过强制转换为 int 并确保您永远不会将 1 移到最高位来做您想做的事情，如下所示：

```
byte x = -1;
int x2 = ((int)x) & 0xff;
for(int i = 0; i < 8; i++)
{
    x2 = (x2 >>> 1);
    System.out.println("X: " + x2);
} 
```

您的特殊问题是因为 >>> 正在转换为 int 来进行转换，然后您将其转换回字节，如下所示：

```
byte x = -1;
int x2 = ((int)x) & 0xff;
int x3;
int x4 = x2;
for(int i = 0; i < 8; i++)
{
    x2 = (x2 >>> 1);
    System.out.println("X2: " + x2);
    x3 = (x >>> 1);
    x = (byte)x3;
    x4 = (x4 >>> 1);
    System.out.println("X: " + x3 + " " + x + " " + x4);
} 
```

哪个输出：

```
X2: 127
X: 2147483647 -1 127
X2: 63
X: 2147483647 -1 63
X2: 31
X: 2147483647 -1 31
X2: 15
X: 2147483647 -1 15
X2: 7
X: 2147483647 -1 7
X2: 3
X: 2147483647 -1 3
X2: 1
X: 2147483647 -1 1
X2: 0
X: 2147483647 -1 0 
```

您可以清楚地看到 x 和 x3 不起作用（即使 x3 正确移动，将其转换回 x 中的字节也会再次将其设置为 -1）。x4 完美运行。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-02-19T03:25:10.850

请记住：

*   **按位运算**的操作数总是**被提升为至少一个 int**！
*   强制转换总是涉及**符号扩展**。

因此，当您执行 (x >>> n) 时，即使您将 x 定义为字节，出于移位的目的，它也会首先转换为 int。如果要转换的字节为负数，则添加到 int 的所有“额外位”（因此，结果 int 的最左边 24 位）将设置为 1。或者换一种方式，如果原始byte 是 -1，你实际移动的东西是 -1 作为*int*，即所有 32 位设置为 1 的 32 位数字。将这个右移 1-8 位仍然会导致底部 8 位全部设置为 1，因此当您转换回一个字节时，您最终会得到一个所有 8 位都设置为 1 的字节，或者换句话说，一个字节值为 -1。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T01:16:17.680

我不确定。但是，我的猜测是

```
x >>> 1 
```

从字节提升为 int，因为文字“1”是一个 int。那么你所观察的东西是有道理的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T01:27:03.613

我不知道为什么它不起作用，但是清除最高位的一种简单方法是与（二进制）0111111 一起使用：

```
x = (byte) (x >>> 1) & 0x7F; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-11-24T20:02:24.273

问题是，如前所述（很久以前），x 在进行移位之前被向上转换为 int（符号扩展）。
进行“位到位”转换应该会有所帮助：

```
byte x = -1;
for(int i = 0; i < 8; i++)
{
    x = (byte) ((x & 0xFF) >>> 1);
    System.out.println("X: " + x);
} 
```

# c# - C#：如何在运行时向对象添加属性？

> ID：563548
> 
> 赞同：12
> 
> 时间：2009-02-19T01:11:00.953
> 
> 标签：c#, .net, attributes

作为一个实体类，我想在运行时添加一个属性，我该怎么做？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-19T04:14:38.110

需要看什么属性？如果是数据绑定等，`TypeDescriptor`应该可以工作：

```
TypeDescriptor.AddAttributes(type, attribs);
TypeDescriptor.AddAttributes(instance, attribs); 
```

这只会影响`System.ComponentModel`使用（不是直接反射），但这通常就足够了 - 例如，您可以`TypeConverter`通过上述关联 a 。

如果“属性”是指“属性”，那么（再次，就数据绑定而言）`TypeDescriptor`在那里也有潜力——但它并不重要；您需要`ICustomTypeDescriptor`在对象上实现，或者为类型编写一个`CustomTypeDescriptor`- 在任何一种情况下，您都需要编写自己的`PropertyDescriptor`实现（通常与每个实例的字典等对话）。这将被任何使用的东西使用：

```
// only works if you use TypeDescriptionProvider
PropertyDescriptorCollection typeProps = TypeDescriptor.GetProperties(type);
// works via TypeDescriptionProvider or ICustomTypeDescriptor
PropertyDescriptorCollection objProps = TypeDescriptor.GetProperties(obj); 
```

同样，这涵盖了广泛的数据绑定和类似场景。有关这方面的一个示例，[请参见此处](http://groups.google.com/group/microsoft.public.dotnet.languages.csharp/msg/55ea254ad3c6abf6)- 然而，这远非微不足道。示例用法（来自链接）在运行时添加了两个属性：

```
Bag.AddProperty<int>("TestProp", new DefaultValueAttribute(5)); 
Bag.AddProperty<string>("Name"); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T01:13:32.787

**编辑：**请澄清一下，您是在谈论[c# 属性](http://msdn.microsoft.com/en-us/library/aa287992(VS.71).aspx)还是您班级的成员？

添加 c# 属性的唯一方法是生成具有附加属性的全新类，编译新程序集并将其加载到现有 AppDomain。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T01:14:24.440

使用哈希表来存储您的属性。

如果您想要更多的运行时灵活性，您可以尝试 Ruby 或其他一些解释型语言。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T01:57:47.487

看看动态语言运行时。您还可以考虑使用 IronRuby 或 IronPython 等动态语言。

你想解决什么问题？

[http://en.wikipedia.org/wiki/Dynamic_Language_Runtime](http://en.wikipedia.org/wiki/Dynamic_Language_Runtime)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T05:09:11.380

我会选择[PostSharp](http://www.postsharp.org/)，一个非常优雅的[AOP 框架](http://en.wikipedia.org/wiki/Aspect-oriented_programming)（或*Policy Injection*）。

PostSharp[允许您注入自定义属性](http://www.postsharp.org/forum/application-proposal/add-fields-and-custom-attributes-using-postsharp-core-t560.html)。
帖子中提到的博客条目有一些代码，您可以下载以实现您的目标。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T01:44:12.357

属性是一种类型的元数据的一部分，因此它们在编译的程序集中被硬编码（这也是为什么只允许在属性中使用一些原始类型而不是任意数据的原因）。

结果是您不能在运行时向类型添加任何属性。但是有各种替代技术。您可以使用简单的字典或更强大的东西，例如[附加的依赖属性](http://msdn.microsoft.com/en-us/library/ms749011.aspx)。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-11-22T19:58:06.010

这篇文章为我回答了这个问题：

[在运行时动态创建类型](http://mironabramson.com/blog/post/2008/06/Create-you-own-new-Type-and-use-it-on-run-time-%28C%29.aspx)

# c# - 事件和委托及其各自应用程序之间的区别

> ID：563549
> 
> 赞同：110
> 
> 时间：2009-02-19T01:11:05.227
> 
> 标签：c#, events, delegates

除了作为语法糖之外，我没有看到使用事件优于委托的优势。也许我误解了，但似乎事件只是代表的占位符。

您能向我解释一下差异以及何时使用哪个吗？有什么优点和缺点？我们的代码深深植根于事件，我想深入了解它。

你什么时候会在事件上使用委托，反之亦然？请在生产代码中说明您对两者的真实体验。

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2009-02-19T01:56:02.687

关键字`event`是多播委托的范围修饰符。这与仅声明多播委托之间的实际区别如下：

*   您可以`event`在界面中使用。
*   对多播委托的调用访问仅限于声明类。这种行为就好像委托是私有的，可以调用。出于赋值的目的，访问权限由显式访问修饰符（例如`public event`）指定。

有趣的是，您可以将`+`和`-`应用于多播委托，这是将委托组合分配给事件的`+=`and语法的基础。`-=`这三个片段是等价的：

```
B = new EventHandler(this.MethodB);
C = new EventHandler(this.MethodC);
A = B + C; 
```

示例二，说明直接分配和组合分配。

```
B = new EventHandler(this.MethodB);
C = new EventHandler(this.MethodC);
A = B;
A += C; 
```

示例三：更熟悉的语法。您可能熟悉分配 null 以删除所有处理程序。

```
B = new EventHandler(this.MethodB);
C = new EventHandler(this.MethodC);
A = null;
A += B;
A += C; 
```

像属性一样，事件也有一个没有人使用过的完整语法。这：

```
class myExample 
{
  internal EventHandler eh;

  public event EventHandler OnSubmit 
  { 
    add 
    {
      eh = Delegate.Combine(eh, value) as EventHandler;
    }
    remove
    {
      eh = Delegate.Remove(eh, value) as EventHandler;
    }
  }

  ...
} 
```

...与此*完全相同*：

```
class myExample 
{
  public event EventHandler OnSubmit;
} 
```

add 和 remove 方法在 VB.NET 使用的相当生硬的语法中更加显眼（没有运算符重载）。

* * *

## 回答 #2

> 赞同：49
> 
> 时间：2009-02-19T01:50:48.190

从技术角度来看，其他答案已经解决了这些差异。

从语义的角度来看，事件是对象在满足某些条件时引发的动作。例如，我的 Stock 类有一个名为 Limit 的属性，当股票价格达到 Limit 时它会引发一个事件。此通知是通过事件完成的。是否有人真正关心这个事件并订阅它超出了所有者类的关注。

委托是一个更通用的术语，用于描述类似于 C/C++ 术语中的指针的构造。.Net 中的所有代表都是多播代表。从语义的角度来看，它们通常用作一种输入。特别是，它们是实现[策略模式](http://en.wikipedia.org/wiki/Strategy_pattern)的完美方式。例如，如果我想对一个对象列表进行排序，我可以为该方法提供一个 Comparator 策略来告诉实现如何比较两个对象。

我在生产代码中使用了这两种方法。当满足某些属性时，我的大量数据对象会发出通知。最基本的示例，每当属性更改时，都会引发 PropertyChanged 事件（请参阅 INotifyPropertyChanged 接口）。我在代码中使用了委托来提供将某些对象转换为字符串的不同策略。这个特定示例是一个美化的 ToString() 实现列表，用于特定对象类型以将其显示给用户。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-19T01:29:52.327

事件是语法糖。它们很美味。当我看到一个事件时，我知道该怎么做。当我看到一个代表时，我不太确定。

将事件与界面（更多的糖）结合起来可以制作令人垂涎的小吃。委托和纯虚拟抽象类的吸引力要小得多。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-19T01:48:30.207

事件在元数据中被标记为这样。这允许诸如 Windows 窗体或 ASP.NET 设计器之类的事物将事件与单纯的委托类型属性区分开来，并为它们提供适当的支持（特别是在“属性”窗口的“事件”选项卡上显示它们）。

与委托类型的属性的另一个区别是用户只能添加和删除事件处理程序，而使用委托类型的属性他们可以设置值：

```
someObj.SomeCallback = MyCallback;  // okay, replaces any existing callback
someObj.SomeEvent = MyHandler;  // not okay, must use += instead 
```

这有助于隔离事件订阅者：我可以将我的处理程序添加到一个事件中，您可以将您的处理程序添加到同一个事件中，并且您不会意外覆盖我的处理程序。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-19T02:30:02.167

> **编辑#1** *你什么时候会在事件上使用委托，反之亦然？请在生产代码中说明您对两者的真实体验。*

当我设计自己的 API 时，我定义了作为参数传递给方法或类的构造函数的委托：

*   这样一个方法就可以实现一个简单的“模板方法”模式（例如，`Predicate`和`Action`委托被传递给 .Net 通用集合类）
*   或者这样该类可以执行“回调”（通常是对创建它的类的方法的回调）。

这些**委托在运行时通常是非可选**的（即不能是`null`）。

我倾向于不使用事件；但是在我确实使用事件的地方，我使用它们来**选择性地向****零个、一个或多个****可能**感兴趣的客户端发送事件信号，即当一个类（例如`System.Windows.Form`类）应该存在并运行时，无论是否有任何客户端都有为其事件添加了一个事件处理程序（例如，表单的“鼠标按下”事件存在，但任何外部客户端是否有兴趣在该事件上安装事件处理程序是**可选的）。**

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2010-12-07T23:50:47.140

尽管事件通常使用多播委托来实现，但并不要求以这种方式使用它们。如果一个类公开事件，这意味着该类公开了两个方法。它们的含义本质上是：

1.  这是一个代表。请在发生有趣的事情时调用它。
2.  这是一个代表。您应该尽快销毁对它的所有引用（不再调用它）。

类处理它公开的事件的最常见方法是定义多播委托，并添加/删除传递给上述方法的任何委托，但不要求它们以这种方式工作。不幸的是，事件架构未能做一些可以使替代方法更清洁的事情（例如，让订阅方法返回一个 MethodInvoker，它将由订阅者保留；取消订阅事件，只需调用返回的方法）所以多播委托是迄今为止最常见的方法。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2014-07-12T11:14:39.603

要了解差异，您可以查看这 2 个示例

带有委托的示例（在这种情况下，操作是一种不返回值的委托）

```
public class Animal
{
    public Action Run {get; set;}

    public void RaiseEvent()
    {
        if (Run != null)
        {
            Run();
        }
    }
} 
```

要使用委托，你应该做这样的事情

```
Animale animal= new Animal();
animal.Run += () => Console.WriteLine("I'm running");
animal.Run += () => Console.WriteLine("I'm still running") ;
animal.RaiseEvent(); 
```

此代码运行良好，但您可能有一些弱点。

例如，如果我写这个

```
animal.Run += () => Console.WriteLine("I'm running");
animal.Run += () => Console.WriteLine("I'm still running");
animal.Run = () => Console.WriteLine("I'm sleeping") ; 
```

使用最后一行代码，我已经覆盖了以前的行为，只是缺少一个`+`（我使用`+`了代替`+=`）

另一个弱点是每个使用你的类的`Animal`类都可以`RaiseEvent`调用它`animal.RaiseEvent()`。

为了避免这个弱点，您可以`events`在 c# 中使用。

您的 Animal 课程将以这种方式改变

```
public class ArgsSpecial :EventArgs
   {
        public ArgsSpecial (string val)
        {
            Operation=val;
        }

        public string Operation {get; set;}
   } 

 public class Animal
    {
       public event EventHandler<ArgsSpecial> Run = delegate{} //empty delegate. In this way you are sure that value is always != null because no one outside of the class can change it

       public void RaiseEvent()
       {  
          Run(this, new ArgsSpecial("Run faster"));
       }
    } 
```

调用事件

```
 Animale animal= new Animal();
 animal.Run += (sender, e) => Console.WriteLine("I'm running. My value is {0}", e.Operation);
 animal.RaiseEvent(); 
```

差异：

1.  您没有使用公共属性，而是使用公共字段（编译器通过事件保护您的字段免受不必要的访问）
2.  不能直接分配事件。在这种情况下，您无法执行我在覆盖行为时显示的先前错误。
3.  你班以外的任何人都不能提出这个事件。
4.  事件可以包含在接口声明中，而字段不能

笔记

EventHandler 被声明为以下委托：

```
public delegate void EventHandler (object sender, EventArgs e) 
```

它需要一个发送者（对象类型）和事件参数。如果发送者来自静态方法，则发送者为空。

您也可以使用`EventHAndler`这个使用的示例`EventHandler<ArgsSpecial>`

有关 EventHandler 的文档，请参阅[此处](http://msdn.microsoft.com/it-it/library/db0etb8x(v=vs.110).aspx)

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2009-02-19T02:02:29.207

虽然我没有技术原因，但我在 UI 样式代码中使用事件，换句话说，在代码的更高级别中，并为代码中更深层次的逻辑使用委托。正如我所说，您可以使用其中任何一种，但我发现这种使用模式在逻辑上是合理的，如果没有别的，它也有助于记录回调的类型及其层次结构。

* * *

编辑：我认为我使用模式的不同之处在于，我发现忽略事件是完全可以接受的，它们是钩子/存根，如果您需要了解事件，请听它们，如果您不关心该事件只是忽略它。这就是为什么我将它们用于 UI，一种 Javascript/浏览器事件样式。但是，当我有委托时，我希望有人能够处理委托的任务，如果不处理则抛出异常。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2017-08-25T15:02:12.963

活动和代表之间的区别比我以前想象的要小很多。我刚刚发布了一个关于这个主题的超短 YouTube 视频： [https ://www.youtube.com/watch?v=el-kKK-7SBU](https://www.youtube.com/watch?v=el-kKK-7SBU)

希望这可以帮助！

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2018-06-17T18:33:22.907

> 如果我们只使用委托代替事件，那么订阅者就有机会克隆（），调用（）委托本身，如下图所示。这是不对的。

[![在此处输入图像描述](https://i.stack.imgur.com/aOt7E.png)](https://i.stack.imgur.com/aOt7E.png)

> 这是黑白事件和委托的主要区别。订阅者只有一项权利，即收听事件
> 
> ConsoleLog 类通过 EventLogHandler 订阅日志事件

```
public class ConsoleLog
{
    public ConsoleLog(Operation operation)
    {
        operation.EventLogHandler += print;
    }

    public void print(string str)
    {
        Console.WriteLine("write on console : " + str);
    }
} 
```

> FileLog 类通过 EventLogHandler 订阅日志事件

```
public class FileLog
{
    public FileLog(Operation operation)
    {
        operation.EventLogHandler += print;
    }

    public void print(string str)
    {
        Console.WriteLine("write in File : " + str);
    }
} 
```

> 操作类正在发布日志事件

```
public delegate void logDelegate(string str);
public class Operation
{
    public event logDelegate EventLogHandler;
    public Operation()
    {
        new FileLog(this);
        new ConsoleLog(this);
    }

    public void DoWork()
    {
        EventLogHandler.Invoke("somthing is working");
    }
} 
```

# html - HTML 编码 mailto 标签是否会阻止垃圾邮件发送者

> ID：563571
> 
> 赞同：2
> 
> 时间：2009-02-19T01:22:53.250
> 
> 标签：html, email-spam

我认为这些天在您的网页中不包含 mailto: 标记是相当普遍的做法。我也意识到一个更好的解决方案是有一个联系我们的表格。

最近我看到了一些包含 HTML 编码的电子邮件地址的 mailto 标签。这是阻止垃圾邮件发送者攻击电子邮件地址的有效方法吗？

例子：

```
<a href="mailto:&#110;&#101;&#119;&#098;&#105;...">email me</a> 
```

另外，还有其他我遗漏的技术吗？哪种方法最好？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T01:25:29.403

据我所知，这将有助于减少垃圾邮件的涌入，但不会完全阻止它。少数（目前）电子邮件地址收集机器人足够聪明，可以应用解码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T01:37:07.583

另一种技术是使用一些 Javascript 在页面加载时动态生成 mailto 标记。为了让垃圾邮件发送者抓取这些地址，他们需要在他们的网络蜘蛛中安装一个完整的 Javascript 处理器。

一些垃圾邮件发送者可能已经这样做了。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T01:37:16.600

对于我的个人主页，我以图形形式提供了电子邮件地址。然后我为没有将其设为链接而道歉。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T01:39:58.480

我通常使用[Hivelogic Enkoder](http://hivelogic.com/enkoder)。它有助于对整个链接元素进行编码，而不仅仅是 mailto。

*然而，从令人讨厌的方式中学到的一个教训是用编码之前*的原始元素的样子来注释你的代码。我不小心把`<a>`标签上的课程忘了几次。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T01:58:32.087

在不让您的某些用户感到困难的情况下，您只能阻止懒惰的垃圾邮件发送者——因为您不提前知道您正在查看的内容。因此，如果您向合法用户提供易于访问的内容，那么您就是在向垃圾邮件发送者提供易于访问的内容。

如果您要将您的地址放在网上，我最好的建议是获得一个非常好的垃圾邮件过滤器。再多的href 混淆也无济于事。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-03-18T11:49:34.957

就我个人而言，我鼓励使用表格，因为这将使您更好地控制如何处理任何潜在的垃圾邮件。（我个人不喜欢 CAPTCHA 等“前端”解决方案，因为它们很少对用户友好 - 如果它给您的用户带来任何不便/额外工作，我通常想看看是否有更好的方法）

使用表单还有一个额外的好处，就是使您能够从具有某种结构的联系人那里获取数据。（即，它降低了有人与您联系并提出问题的风险，但没有提供足够的信息（甚至可能是他们的名字），这可能有助于您为他们提供可能的最佳回复。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T01:46:07.373

多年来，我一直在使用简单的 Javascript 字符串连接和子字符串操作来混淆多个网站上的电子邮件地址。这似乎运作良好，因为我在这些地址上收到的垃圾邮件最少。这并不意味着它在未来仍然有效。

# language-agnostic - 跟踪对页面的唯一访问的最佳方式是什么？

> ID：563577
> 
> 赞同：1
> 
> 时间：2009-02-19T01:26:02.850
> 
> 标签：language-agnostic

我想记录对我网站上特定页面的独特访问。什么是一种非常准确但简单的方法来做到这一点？只是通过IP？建议？

让我澄清一下：

我的网站上有一个文章列表。每篇文章实际上都是同一个页面，如 article.aspx。但是，内容会根据您正在查看的文章而有所不同。我想跟踪特定文章的独特观点。

谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T01:40:16.577

所有方法都有其缺点。浏览器中可能未启用 Cookie，IP 地址可能由于 NAT 而重复（我知道在我们的工作中，到外部世界的所有流量看起来都来自一个 IP 地址）或由于 DHCP 而重复使用。

这取决于您要使用这些信息的目的。如果您想知道有多少独特的**人**正在查看您的网站，这非常困难，因为很多人可能使用一个浏览器或 IP 地址。

我认为大多数人都对进行了多少有用的访问感兴趣。这意味着，即使同一 IP 地址在一周后再次出现，也应该重新计算。

我们已经使用了那个精确的系统（并确保我们的客户意识到它是一个不完美的系统）。将 IP 地址以及访问的第一个和最后一个日期存储在一个表中。

如果是新添加的 IP 地址，则添加一个命中并存储 IP/日期。如果它是已经存在的 IP，请更新最后日期。每晚进行一次扫描以删除最后日期超过 7 天或第一次日期超过 14 天的 IP（均可配置）。

这样你就可以捕捉到有用的访问：

*   假设连续访问的人每两周有一次有用的访问。
*   访问然后消失一年并再次访问的人有两个有用的访问权限。
*   曾经访问过的人有一个有用的访问权限。

只要了解不足之处，就可以对其进行管理。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T01:55:24.263

为什么不使用像 Google Analytics 这样的分析包？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T01:30:35.460

饼干。检查唯一的 cookie 值。如果它已经存在，则用户已经访问过您的站点。如果没有，请跟踪唯一访问并分配 cookie。

或者，您还可以使用 cookie 上的到期日期来确保它每 n 秒/分钟/小时/天仅发生一次，等等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T01:34:08.637

使用 cookie 和 IP 地址的组合。如果您仅使用 cookie，则关闭 cookie 的用户（或机器人）可以提高您的页面浏览量。如果您只使用 IP，那么您将阻止代理上的所有计算机。

# svn - svnsync：PROPFIND 请求失败

> ID：563580
> 
> 赞同：0
> 
> 时间：2009-02-19T01:27:16.077
> 
> 标签：svn, svnsync

我拼命地尝试备份我的谷歌代码仓库，但由于我对 SVN 不太熟悉，我无法让 svnsync 工作。我认为将你的 repo 备份到另一个 repo 或转储文件是一件容易的事，但我错了吗？我真的很感激如何做到这一点的提示..

我正在尝试做的事情：

*@shell:~$ svnsync 初始化[http://www](http://www)。*.org/svn/ http: *//.goo​glecode.com/svn/trun​k svnsync：PROPFIND 请求在“/svn”上失败 svnsync：“/svn”的 PROPFIND：301 永久移动（[http://www](http://www) .* .org)

这意味着什么？是否有可能修复它？

[http://www](http://www) .*.org/svn/ 是使用 svnadmin create, ofc 创建的。

提前致谢！=)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T01:48:53.793

我会在评论中提出这个问题，但我还没有评论的要点。看起来您的问题至少有一部分是您的网址可能不正确。301 告诉您您希望在那里找到的资源实际上并不存在，因此我首先通过对其执行 svn ls 来检查该 URL。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-12T02:02:30.443

另一个问题是您尝试仅同步主干。我不相信这是支持 - svnsync 旨在制作整个 repo 的镜像。您需要省略 /trunk 部分。但首先你需要让你自己的回购功能。

# html-parsing - 从网页中提取意义的全部内容

> ID：563581
> 
> 赞同：2
> 
> 时间：2009-02-19T01:27:57.340
> 
> 标签：html-parsing, web-crawler, text-mining

我正在通过使用我的爬虫挖掘网页内容来进行一些分析。网页通常在文章正文周围包含杂乱无章的内容（例如广告、不必要的图像和无关链接），这会分散用户对实际内容的注意力。

考虑到没有标准来定义新闻故事/博客文章/论坛评论/文章在网页中的实际位置，据我了解，提取有意义的内容是一个难题。

我可以找到一些像这样的开源解决方案：[https ://metacpan.org/pod/HTML::ContentExtractor](https://metacpan.org/pod/HTML::ContentExtractor)

但我很好奇是否有人处理过这个问题并获得了合理的成功率。这似乎是一个相当普遍的问题，我相信很多专家都在那里。我更喜欢基于 JAVA 的解决方案，但这不是硬性规定。请提供一些意见。我将深深感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T01:57:06.613

理想情况下，您会寻找 RSS 提要来获取原始内容。

这不是 HTML 中整体结构和含义的标准。作者在他们的页面中定义了不同的元素。搜索引擎在这一领域投入了大量资金，他们有自己的秘诀来索引内容并从中获得某种意义和结构以进行搜索排名。

在我们拥有早已预言的“语义网”之前，我们只能对任意 HTML 页面的结构和含义做出有根据的猜测。

但是，理论上：

寻找标题标签。这些应该为您提供从哪里开始阅读的线索，并希望为内容的重要性顺序提供一个大纲。

寻找常见的元素 id 和类。一个结构良好的网站可能有类似`<div id="content">`and之类的东西`<div class="article">`，这与如今的语义一样。还要了解常见 CMS 平台使用的标准元素名称，如 WordPress（“post”）或 Drupal（“node”）。通常这些将用于标记内容。

最后但同样重要的是，寻找[微格式](http://microformats.org/)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-02-14T16:00:40.340

现在有[许多项目](https://www.quora.com/Whats-the-best-method-to-extract-article-text-from-HTML-documents)以这项任务为主要目标。

NPM 包[WCE](https://www.npmjs.com/package/wce) (Javascript) 很有趣，因为它在底层使用了许多其他内容提取模块。

对不起，我本来想早点回答这个问题，但我很忙。

# c# - 没有代码的 ASP.net 页面

> ID：563585
> 
> 赞同：66
> 
> 时间：2009-02-19T01:29:09.427
> 
> 标签：c#, .net, asp.net, sharepoint, code-behind

我有一个带有 C# 代码的 ASP.Net 页面。

但是，我被要求不要使用背后的代码 - 这样会更容易在 SharePoint 中部署。

有没有办法在 ASP.Net 页面中包含 C# 代码，而不使用单独的代码隐藏文件？

* * *

## 回答 #1

> 赞同：98
> 
> 时间：2009-02-19T01:36:45.213

默认情况下，Sharepoint 不允许在 ASPX 文件中执行服务器端代码。有关如何解决该问题，[请参阅此内容。](http://mysharepointblog.com/post/2008/01/Running-Code-Blocks-In-Your-SharePoint-ASPX-Pages.aspx)

但是，我会提出，在 Sharepoint 中部署代码隐藏并不一定很困难（我们广泛这样做） - 只需将您的代码隐藏类编译到程序集中并使用[解决方案](http://msdn.microsoft.com/en-us/library/aa543214.aspx)部署它。

如果仍然没有，您可以将通常放置在代码隐藏中的所有代码包括在内，如下所示：

```
<script language="c#" runat="server">
public void Page_Load(object sender, EventArgs e)
{
  //hello, world!
}
</script> 
```

* * *

## 回答 #2

> 赞同：26
> 
> 时间：2009-02-19T01:33:03.117

您实际上可以在 aspx 页面中拥有所有代码。正如[这里](https://blog.codinghorror.com/code-behind-vs-inline-code/)所解释的。

[来自这里](http://support.microsoft.com/kb/303247)的样本：

```
<%@ Language=C# %>
<HTML>
   <script runat="server" language="C#">
   void MyButton_OnClick(Object sender, EventArgs e)
   {
      MyLabel.Text = MyTextbox.Text.ToString();
   }
   </script>
   <body>
      <form id="MyForm" runat="server">
         <asp:textbox id="MyTextbox" text="Hello World" runat="server"></asp:textbox>
         <asp:button id="MyButton" text="Echo Input" OnClick="MyButton_OnClick" runat="server"></asp:button>
         <asp:label id="MyLabel" runat="server"></asp:label>
      </form>
   </body>
</HTML> 
```

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-02-19T01:33:40.617

是的，在您的 aspx 页面上包含一个带有 runat=server 的脚本标记

```
<script language="c#" runat="server">

public void Page_Load(object sender, EventArgs e)
{
  // some load code
}
</script> 
```

您还可以使用经典的 ASP 语法

```
<% if (this.MyTextBox.Visible) { %>
<span>Only show when myTextBox is visible</span>
<% } %> 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-02-19T15:47:41.773

SharePoint 中有两种截然不同的页面：应用程序页面和网站页面。

如果您打算将您的页面用作应用程序页面，您可以安全地在页面中使用内联代码或代码隐藏，因为应用程序页面存在于文件系统中。

如果它将是一个站点页面，您可以安全地编写内联代码，只要您在初始部署中拥有这样的代码。但是，如果您的站点页面将在将来的某个时间进行定制，则内联代码将不再起作用，因为定制的站点页面存在于数据库中并在 asp.net 的“无编译”模式下执行。

底线是 - 您可以使用内联代码编写 aspx 页面。唯一的问题是自定义站点页面......它不再关心您的内联代码。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2017-02-09T01:48:38.153

文件：logdate.aspx

```
<%@ Page Language="c#" %>
<%@ Import namespace="System.IO"%>
<%

StreamWriter tsw = File.AppendText(@Server.MapPath("./test.txt"));
tsw.WriteLine("--------------------------------");
tsw.WriteLine(DateTime.Now.ToString());

tsw.Close();
%>

Done 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-02-19T01:44:57.907

我认为只要 DLL 在您的 bin 中，您就可以只部署没有 .aspx.cs 的 .aspx 页面。这里的部分问题是visual studio .net 如何与.aspx 页面一起工作。

在此处查看： [在 Visual Studio .NET 中使用单文件 Web 表单页面](http://msdn.microsoft.com/en-us/library/aa290385(VS.71).aspx)

我确信带有 asp.net MVC RC 的 VS2008 没有用于视图的代码隐藏文件。

# oracle - Oracle Forms 应用方向

> ID：563589
> 
> 赞同：1
> 
> 时间：2009-02-19T01:30:08.690
> 
> 标签：oracle, migration, oracleforms

我们有一个大型 Oracle Forms 10 应用程序，并且一直在思考未来的方向。选择似乎是：

*   继续使用 Forms 进行开发（Oracle 已表示将继续支持）。
*   使用 Oracle 应用程序开发框架 (ADF) 和 Oracle JDeveloper 进行未来开发。这可以与表单共存。
*   将整个应用程序迁移到 Java MVC 模型。有各种工具可以促进这一点。这里最大的优势是 Java 开发人员很容易找到，并且它允许我们通过例如 Web 服务进行高级接口访问。

这种变化的驱动问题之一是表单开发人员越来越难找到。

根据以前的经验，对最佳方式有什么建议或意见吗？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-27T20:46:46.740

如果你问 Oracle，方法是使用 ADF 和 JDeveloper。这就是 Oracle 的所有精力和编程工作的发展方向。您想查看“Oracle Fusion”，这是他们的完整界面。原因是 Fusion 是 Oracle 用于电子商务套件（又名 Oracle 应用程序，大型运行您的跨国公司软件）的东西。

ADF 是 java，您可以使用所有您想要的 Java 开发人员。ADF 是一个界面设计工具，它包括所有数据库交互层以及 UI。我已经使用了一些，一旦你克服了一些概念上的障碍，你的团队就会非常有效率地使用它。

如果您有一个较小的 Forms 应用程序，我的另一个建议是查看 Oracle Application Express (APEX)。它是一种使用网页设计工具（即您使用的唯一工具是 APEX 界面）构建 Web 应用程序的工具。它使用 PL/SQL 编写代码，并使用许多模板使您的应用程序看起来很棒。我也用它来构建应用程序，没问题我在几天内就构建了外观漂亮、执行速度快的应用程序。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-25T11:46:10.307

虽然我同意 Thomas Jones-Low 的大部分回应，但根据我的经验，我发现这取决于您在 Oracle 中与**谁**交谈，以了解 Oracle Forms 迁移的最佳途径。

与 Forms 产品经理（也是 ADF 的产品经理）交谈，您会被告知 ADF 是迁移 Oracle Forms 应用程序的正确选择。

与 Apex 产品经理交谈，您将确信 Apex 不仅适用于“小型”Oracle 表单迁移。事实上，Apex 处理大型表单迁移的能力也得到了 SO 成员[博客文章的](http://tonyandrews.blogspot.com/2010/08/fame-at-last-for-my-biggest-apex.html?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed%3A+TonyAndrewsOnOracleAndDatabases+%28Tony+Andrews+on+Oracle+and+Databases%29)支持。

我要说明的一点是，用于从 Forms 迁移的 Oracle 解决方案充其量似乎是“模糊的”，而这种“模糊”似乎是由来自 Oracle 的混合消息引起的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-08-25T11:08:55.300

不，ORACLE 说，Forms 至少会支持到 2017 年。我认为，他们在 2007 年就说过这一点，他们不会提前 10 多年发布支持声明。因此，Forms 很有可能会得到更长时间的支持。

# c# - 取消 Socket.xxxxAsync 调用

> ID：563593
> 
> 赞同：13
> 
> 时间：2009-02-19T01:31:21.513
> 
> 标签：c#, .net, sockets

调用 Socket.Shutdown、Socket.Close 和 Socket.Disconnect 后，Socket.ReceiveAsync 似乎没有中止。尝试重用 ReceiveAsync 调用中使用的 SocketAsycEventArgs 对象（在文档中建议作为最佳实践）会导致错误：

> 已使用此 SocketAsyncEventArgs 实例进行异步套接字操作

我必须做些什么才能让 ReceiveAsync 释放它对这个 SocketAsyncEventArgs 实例的控制？

编辑：我通过标记待处理的接收并且在接收到来之前不进行任何清理（即调度完成）来解决这个问题。不过感觉不太好。不能像 WebRequest API 那样中止它吗？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T05:04:25.323

似乎没有办法中止异步接收。

当套接字关闭时，这会强制接收完成，并且回调方法的 SocketAsyncEventArgs 参数的 SocketError 属性的值为`SocketError.OperationAborted`. 当遇到这种情况时，您可以将 SocketAsyncEventArgs 对象返回到可重用池。

[这在此处](http://msdn.microsoft.com/en-us/library/system.net.sockets.socketasynceventargs.aspx)显示的示例中得到了证明。具体看 ProcessReceive() 方法，它在`e.BytesTransferred == 0`或时调用 CloseClientSocket() 方法`e.SocketError != SocketError.Success`。CloseClientSocket() 方法是将 SocketAsyncEventArgs 对象返回到池的位置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-10-16T22:58:31.387

最可能的原因是重用您正在调用的 SocketAsyncEventArgs 时：

SAE.Completed += new EventHandler(SocketEventArg_Completed);

这样做会导致你的回调被多次调用！！！

确保只设置 Completed 处理程序一次。

# c# - AutoEventWireup 和 base.OnLoad(e) 调用 Self 导致堆栈溢出

> ID：563594
> 
> 赞同：4
> 
> 时间：2009-02-19T01:31:58.390
> 
> 标签：c#, asp.net, autoeventwireup

使用 VS2008，C#。何时`AutoEventWireup`设置为 true 并且在我调用的网络表单中`base.OnLoad(e)`：

```
protected void Page_Load(object sender, EventArgs e)
{
    base.OnLoad(e);
} 
```

最终`base.OnLoad(e)`调用`Page_Load`（调用自身）。这最终导致堆栈溢出错误。我已经能够通过设置`AutoEventWireup`为 false 和覆盖来解决它`OnLoad`：

```
protected override void OnLoad(EventArgs e)
{
    base.OnLoad(e);
} 
```

这按我的预期工作（没有堆栈溢出）。但是谁能解释为什么在第一个示例中`base.OnLoad(e)`调用相同的加载事件（调用自身）而不是调用`OnLoad`基类（`System.Web.UI.Page`）中的事件？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T02:43:42.273

`Page.OnLoad`里面有以下伪代码

```
protected virtual void OnLoad() {
    // some stuff

    if (Load != null)
        Load(this, new EventArgs());
} 
```

如果你重写这个`OnLoad`函数，会发生什么：你`OnLoad`发生了，然后它调用`base.OnLoad()`，然后调用（空）`Load`事件。

如果你实现`Load`事件并调用`base.OnLoad()`，会发生这样的事情：`base.OnLoad()`调用`Load`事件。然后`Load`事件调用`base.OnLoad()`. 然后，`base.OnLoad()`调用`Load`事件。剩下的就是，正如他们所说，要理解递归，你必须首先理解递归。

希望我说清楚了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T01:46:38.403

OnLoad 不调用自身，它调用 Load 事件。Page.OnLoad 方法仅包装对附加事件的调用。不应从 Load 事件处理程序调用 base.OnLoad，否则将导致无限循环。

# syntax - 我可以让“&&”或“-and”在 PowerShell 中工作吗？

> ID：563600
> 
> 赞同：245
> 
> 时间：2009-02-19T01:34:04.690
> 
> 标签：syntax, powershell

`&&`众所周知，在 Google 搜索上很难搜索，但我发现最好的是[这篇文章](http://www.microsoft.com/technet/scriptcenter/webcasts/psweek/day4qanda.mspx)，它说使用`-and`.

不幸的是，它没有提供更多信息，而且我找不到我应该做什么`-and`（同样，这是一个众所周知的难以搜索的事情）。

我试图在其中使用它的上下文是“执行 cmd1，如果成功，则执行 cmd2”，基本上是这样的：

```
csc /t:exe /out:a.exe SomeFile.cs && a.exe 
```

* * *

如果您只想在一行上运行多个命令并且您不在乎第一个命令是否失败，您可以使用`;`对于我的大多数目的来说这很好。

例如：`kill -n myapp; ./myapp.exe`。

* * *

## 回答 #1

> 赞同：265
> 
> 时间：2009-02-19T05:51:30.093

在 CMD 中，'&&' 表示“执行命令 1，如果成功，则执行命令 2”。我用它来做以下事情：

```
build && run_tests 
```

在 PowerShell 中，您可以做的最接近的事情是：

```
(build) -and (run_tests) 
```

它具有相同的逻辑，但是命令的输出文本丢失了。不过，也许它对你来说已经足够好了。

如果您在脚本中执行此操作，则最好将语句分开，如下所示：

```
build
if ($?) {
    run_tests
} 
```

**2019/11/27** : 该`&&`运算符现在可用于[PowerShell 7 Preview 5+](https://github.com/PowerShell/PowerShell#get-powershell) :

```
PS > echo "Hello!" && echo "World!"
Hello!
World! 
```

* * *

## 回答 #2

> 赞同：30
> 
> 时间：2009-02-21T16:13:12.330

&& 和 || 在要实施的事情列表中（仍然是），但没有作为下一个最有用的添加内容弹出。原因是我们有 -AND 和 -OR。如果您认为这很重要，请在 Connect 上提出建议，我们会考虑将其用于 V3。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2014-10-08T16:56:28.953

试试这个：

```
$errorActionPreference='Stop'; csc /t:exe /out:a.exe SomeFile.cs; a.exe 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2018-10-25T04:27:25.950

如果您的命令在 cmd.exe 中可用（类似`python ./script.py`，但不是类似 PowerShell 命令`ii .`（这意味着通过[Windows Explorer](https://en.wikipedia.org/wiki/File_Explorer)打开当前目录）），您可以在 PowerShell 中运行 cmd.exe。语法是这样的：

```
cmd /c "command1 && command2" 
```

在这里，`&&`由[本问题](https://stackoverflow.com/questions/13719174/how-to-execute-multiple-commands-in-a-single-line)中描述的 cmd 语法提供。

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2017-10-11T19:35:22.883

## 我在 PowerShell 中尝试了以下命令序列：

### 第一次测试

```
PS C:\> $MyVar = "C:\MyTxt.txt"
PS C:\> ($MyVar -ne $null) -and (Get-Content $MyVar)
True 
```

`($MyVar -ne $null)`返回**true**也`(Get-Content $MyVar)`返回**true**。

### 第二次测试

```
PS C:\> $MyVar = $null
PS C:\> ($MyVar -ne $null) -and (Get-Content $MyVar)
False 
```

`($MyVar -ne $null)`返回**false**，到目前为止我必须假设`(Get-Content $MyVar)`也返回**false**。

### 第三次测试证明第二个条件甚至没有被分析。

```
PS C:\> ($MyVar -ne $null) -and (Get-Content "C:\MyTxt.txt")
False 
```

`($MyVar -ne $null)`返回**false**并通过在整个命令上返回**false**来证明第二个条件`(Get-Content "C:\MyTxt.txt")`从未运行过。

 *** * *

## 回答 #6

> 赞同：4
> 
> 时间：2019-06-30T19:12:23.623

非常老的问题，但对于新手来说：也许问题正在寻找的 PowerShell 版本（类似但*不等价*`-and`）是使用如下：

`(build_command) -and (run_tests_command)`

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2020-10-21T10:12:14.470

只需安装 PowerShell 7（[转到此处](https://github.com/PowerShell/PowerShell/releases)，滚动并展开资产部分）。[此版本](https://docs.microsoft.com/en-us/powershell/scripting/whats-new/what-s-new-in-powershell-70?view=powershell-7)实现了管道链运算符。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2018-12-17T02:35:45.940

一个详细的等价物是结合`$LASTEXITCODE`and `-eq 0`：

```
msbuild.exe args; if ($LASTEXITCODE -eq 0) { echo 'it built'; } else { echo 'it failed'; } 
```

我不知道为什么`if ($?)`对我不起作用，但是这个起作用了。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2015-05-08T20:53:00.033

采用：

```
if (start-process filename1.exe) {} else {start-process filename2.exe} 
```

它比“&&”长一点，但它无需编写脚本就可以完成同样的事情，而且不难记住。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-11-17T19:36:31.597

我认为一个简单的`if`语句就可以做到这一点。一旦我看到 mkelement0 的最后一个退出状态存储在 $? 中的响应，我将以下内容放在一起：

```
# Set the first command to a variable
$a=somecommand

# Temporary variable to store exit status of the last command (since we can't write to "$?")
$test=$?

# Run the test
if ($test=$true) { 2nd-command } 
```

因此，对于 OP 的示例，它将是：

```
a=(csc /t:exe /out:a.exe SomeFile.cs); $test = $?; if ($test=$true) { a.exe } 
```

* * *

## 回答 #11

> 赞同：-1
> 
> 时间：2009-02-19T01:42:43.107

这取决于上下文，但这里有一个“-and”的例子：

```
get-childitem | where-object { $_.Name.StartsWith("f") -and $_.Length -gt 10kb } 
```

这样就可以在文件名以“f”开头的目录中获取所有大于 10kb 的文件。

* * *

## 回答 #12

> 赞同：-2
> 
> 时间：2017-01-21T16:46:51.913

我们可以试试这个命令，而不是使用 && 方法：

```
try {hostname; if ($lastexitcode -eq 0) {ipconfig /all | findstr /i bios}} catch {echo err} finally {} 
```

# silverlight - Silverlight MediaElement 可以从客户端打开视频吗？

> ID：563603
> 
> 赞同：1
> 
> 时间：2009-02-19T01:34:54.750
> 
> 标签：silverlight

从打开的文件对话框中选择 Silverlight MediaElement 后，能否从客户端打开并播放视频？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T02:03:53.820

答案是不。您只能获取 Uri，但不能获取 file:// ，因为您无法读取本地文件夹信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T08:20:46.583

否则，您可以将客户端文件上传到服务器，然后通过其 url 将其用作视频源。

# vim - Vim 和 Ctags 提示和技巧

> ID：563616
> 
> 赞同：485
> 
> 时间：2009-02-19T01:37:11.233
> 
> 标签：vim, ctags, vim-macros

我刚刚用我的 Vim（或者更确切地说是 gVim）安装了[Ctags](http://en.wikipedia.org/wiki/Ctags)（以帮助 C++ 开发），并想找出你最喜欢的命令、宏、快捷方式、伴随它的提示......

分享你最好的武器库。对于 Vim 开发中的 C++，您会推荐哪些其他 Vim 附加组件？

**编辑**您将与 Ctags 一起使用哪些其他附加组件？

**EDIT2**你使用什么版本的 gVim 和标签？这有什么不同吗？

**EDIT3**您如何增强您对大型和小型项目的编程体验？

* * *

## 回答 #1

> 赞同：394
> 
> 时间：2009-02-19T04:54:36.517

`Ctrl`+ `]`- 转到定义
`Ctrl`+ `T`- 从定义跳回。
`Ctrl`+ `W` `Ctrl`+ `]`- 在水平拆分中打开定义

在 vimrc 中添加这些行
`map <C-\> :tab split<CR>:exec("tag ".expand("<cword>"))<CR>`
`map <A-]> :vsp <CR>:exec("tag ".expand("<cword>"))<CR>`

`Ctrl`+ `\`- 在新选项卡中打开定义
`Alt`+ `]`- 在垂直拆分中打开定义

生成标签后。您可以使用以下键标记进入和标记出函数：

`Ctrl`+ `Left MouseClick`- 转到定义
`Ctrl`+ `Right MouseClick`- 从定义跳回

* * *

## 回答 #2

> 赞同：176
> 
> 时间：2009-04-12T08:58:36.403

我的 .vimrc 中总是有一行：

```
set tags=./tags;/ 
```

这将在当前目录中查找“标签”，然后将树向上移动到根目录，直到找到一个。IOW，您可以在源代码树中的任何位置，而不仅仅是它的根。

* * *

## 回答 #3

> 赞同：45
> 
> 时间：2009-02-19T15:40:48.993

另一个对 C 开发有用的插件是[cscope](http://cscope.sourceforge.net/) 就像 Ctags 让你跳转到定义一样，Cscope 跳转到*调用*函数。

如果您的 ~/bin/ 目录中有 cscope，请将以下内容添加到您的 .vimrc 并使用 g^​​] 转到调用函数（参见 :help cscope）。

```
if has("cscope")
    set csprg=~/bin/cscope
    set csto=0
    set cst
    set nocsverb
    " add any database in current directory
    if filereadable("cscope.out")
        cs add cscope.out
        " else add database pointed to by environment
    elseif $CSCOPE_DB != ""
        cs add $CSCOPE_DB
    endif
endif 
```

差点忘了...就像 ctags - 您必须生成（并定期更新）数据库。我使用以下脚本

```
select_files > cscope.files
ctags -L cscope.files
ctags -e -L cscope.files
cscope -ub -i cscope.files 
```

其中 'select_files' 是另一个从 Makefile 中提取 C 和头文件列表的脚本。这样我只索引项目实际使用的文件。

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2009-02-19T01:41:54.997

您可以将目录添加到您的 ctags 查找中。例如，我有一个为 Qt4 构建的 ctags 索引，并且在我的 .vimrc 中有这个：

```
set tags+=/usr/local/share/ctags/qt4 
```

* * *

## 回答 #5

> 赞同：23
> 
> 时间：2009-03-05T19:45:51.550

以上所有和...

code_complete ：函数参数完成，代码片段等等。

*   [http://www.vim.org/scripts/script.php?script_id=1764](http://www.vim.org/scripts/script.php?script_id=1764)

taglist.vim : 源码浏览器 (支持 C/C++, java, perl, python, tcl, sql, php等)

*   [http://www.vim.org/scripts/script.php?script_id=273](http://www.vim.org/scripts/script.php?script_id=273)

* * *

## 回答 #6

> 赞同：16
> 
> 时间：2009-02-19T01:40:35.063

我使用 ALT-left 和 ALT-right 从/向标签堆栈弹出/推送。

```
" Alt-right/left to navigate forward/backward in the tags stack
map <M-Left> <C-T>
map <M-Right> <C-]> 
```

如果您`hjkl`用于移动，则可以映射`<M-h>`而`<M-l>`不是。

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2010-04-22T19:06:43.110

**同名的几个定义**

`<C-w>g<C-]>`在拆分中打开定义，但也`:tjump`可以转到定义，或者如果有多个定义，则为您提供一个可供选择的定义列表。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-02-19T01:45:25.083

我使用最多的命令是 C-] ，它跳转到光标下函数的定义。您可以更频繁地使用它来跟踪更多电话。之后，Co会带你回到一个层次，Ci再更深。

* * *

## 回答 #9

> 赞同：6
> 
> 时间：2009-02-21T09:52:25.367

我发现[taglist](http://vim-taglist.sourceforge.net/)插件是必备的。它在一个单独的窗口中列出了它知道的所有标签（您打开的文件），并且可以很容易地浏览更大的文件。

我主要将它用于 Python 开发，但它只能更好地用于 C/C++。

* * *

## 回答 #10

> 赞同：5
> 
> 时间：2009-02-19T15:03:22.667

我已经将标签操作封装在我的一个[实验性插件](http://code.google.com/p/lh-vim/source/browse/#svn/tags/trunk)中。

关于 vim 中的 C++ 开发，我已经回答[了](https://stackoverflow.com/questions/149558/recommended-vim-plugins-for-c-coding/152448#152448)：我使用自己的套件和其他一些插件。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2009-03-05T10:50:56.280

两年来我一直在调整我的 vim 插件以支持足够大的 c++ 项目。你可以看看他们。

他们使用 ctags 和 cscsope。

[http://www.vim.org/scripts/script.php?script_id=1638](http://www.vim.org/scripts/script.php?script_id=1638)
[http://www.vim.org/scripts/script.php?script_id=2507](http://www.vim.org/scripts/script.php?script_id=2507)

* * *

## 回答 #12

> 赞同：4
> 
> 时间：2009-04-17T23:22:01.137

我将以下内容放在我的 .gvimrc 文件中，该文件在 gvim 启动时从任意点向上搜索标签文件：

```
function SetTags()
    let curdir = getcwd()

    while !filereadable("tags") && getcwd() != "/"
        cd ..
    endwhile

    if filereadable("tags")
        execute "set tags=" . getcwd() . "/tags"
    endif

    execute "cd " . curdir
endfunction

call SetTags() 
```

然后，我会定期在源代码树的顶部重新生成一个标签文件，其脚本如下所示：

```
#!/bin/bash

find . -regex ".*\.\(c\|h\|hpp\|cc\|cpp\)" -print | ctags --totals --recurse --extra="+qf" --fields="+i" -L - 
```

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2010-12-27T06:11:09.170

我在macos中使用vim，原来的ctags不好用，所以我下载最新的并配置make make install。我在 /usr/local/bin/ctags 中安装了 ctgas（以保留原始文件）

```
"taglist
let Tlist_Ctags_Cmd = "/usr/local/bin/ctags"
let Tlist_WinWidth = 50
map <leader>ta :TlistToggle<cr>
map <leader>bta :!/usr/local/bin/ctags -R .<CR>
set tags=tags;/
map <M-j> <C-]>
map <M-k> <C-T> 
```

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2011-05-04T18:50:34.420

我调整了上面的 SetTags() 搜索函数（应该由等效的 替换`set tags+=./tags;/`）来为 cscope 工作。似乎工作！

```
"cscope file-searching alternative
function SetCscope()
    let curdir = getcwd()

    while !filereadable("cscope.out") && getcwd() != "/"
            cd ..
                endwhile

    if filereadable("cscope.out")
            execute "cs add " . getcwd() . "/cscope.out"
                endif

    execute "cd " . curdir
    endfunction

call SetCscope() 
```

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2011-06-13T16:53:19.567

上面的 SetCscope() 函数的另一个迭代。这将 cscope 预路径设置为在不位于“cscope.out”所在的目录上的情况下获取匹配项：

```
function s:FindFile(file)
    let curdir = getcwd()
    let found = curdir
    while !filereadable(a:file) && found != "/"
        cd ..
        let found = getcwd()
    endwhile
    execute "cd " . curdir
    return found
endfunction

if has('cscope')    
    let $CSCOPE_DIR=s:FindFile("cscope.out")
    let $CSCOPE_DB=$CSCOPE_DIR."/cscope.out"
    if filereadable($CSCOPE_DB)
        cscope add $CSCOPE_DB $CSCOPE_DIR
    endif

    command -nargs=0 Cscope !cscope -ub -R &
endif 
```

# cocoa-touch - 带有地址簿选择器的导航控制器策略

> ID：563621
> 
> 赞同：0
> 
> 时间：2009-02-19T01:39:24.863
> 
> 标签：cocoa-touch, addressbook

所以我想让用户使用人员选择器选择一个联系人，然后在成功选择联系人后输入一些自定义数据。很简单。

我的问题是我的 <ABPeoplePickerNavigationControllerDelegate> 的最佳位置在哪里？我应该把它放在 RootViewController 中，它是视图的委托，带有将启动此过程的按钮？然后，一旦选择了地址簿联系人，然后将该 ABRecordID 传递到我的下一个视图控制器 (AddPersonViewController)，该控制器更了解我的 Person 类中的额外好东西，并将处理添加我想与所述地址簿联系人关联的自定义数据...

或者，是否认为启动 AddPersonViewController 更好，但在它显示之前立即将模态 ABPeoplePickerNavigationController 也扔到堆栈上

想知道是否有人对此有任何明智的建议，无论是赞成还是反对？谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T02:01:34.513

前者。

按照您将使用它们的顺序创建视图和控制器。当完成一个过渡到下一个时。

# sharepoint - 安装 Windows SharePoint Services 3.0 Service Pack 1 后，声明性工作流不会自动启动

> ID：563630
> 
> 赞同：3
> 
> 时间：2009-02-19T01:42:41.470
> 
> 标签：sharepoint, workflow

[这实际上是kb947284](http://support.microsoft.com/kb/947284)的标题。最近我参与了一个 Sharepoint 项目。我遇到了这个问题，**我的工作流程没有自动启动**。如果我**手动运行工作流程，那很好**。我找到[了 kb947284](http://support.microsoft.com/kb/947284)。显然这个问题的原因是安装了**WSS 3 SP1**。我按照解决方案部分所说的做了，但没有用。

该决议表示**将应用程序池帐户设置为使用不同的用户帐户**。**有什么不同是什么意思？什么样的用户帐户可以使用？**我更改了用户帐户，但旧帐户和新帐户都在安装 SP 的服务器的同一管理员组中。

哦！我还找到了 kb947284 的副本，并且有一条评论说已经有一个修补程序 ( [kb956057](http://support.microsoft.com/default.aspx/kb/956057) )。我已阅读已修复的问题，但在任何地方都找不到有关此工作流程问题的信息。

谁能告诉我应该怎么做？提前致谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T04:25:43.497

从知识库：

出现此问题的原因是 Windows SharePoint Services 3.0 SP1 中的安全修复程序阻止声明性工作流在系统帐户下自动启动。安装 Windows SharePoint Services 3.0 SP1 后，如果满足以下条件，声明性工作流不会自动启动：

1.  Windows SharePoint Services Web 应用程序在用户的域帐户下运行。
2.  用户使用此域帐户登录。
3.  该站点将用户名显示为系统帐户。回到顶部

我的问题是：您是否安装了 WSS SP1？

是否满足上述3个条件？

如果是这样，应将应用程序池标识更改为登录 SharePoint 的人员不使用的标识。

# open-source - 您如何平衡为谋生而工作和为开源项目做出贡献？

> ID：563632
> 
> 赞同：1
> 
> 时间：2009-02-19T01:43:04.853
> 
> 标签：open-source, time-management

自世纪之交以来，我一直是一名工作程序员，我一直对开源世界着迷。我一直想为这些项目做出贡献，但我发现很难找到我认为这些项目需要的时间。

我发现专业软件开发需要花费大量时间。几乎我从事的每一个项目都有一个熟悉的一连串僵硬的截止日期，以及不可避免的全天候最后一分钟的推动，这会吞噬你的夜晚和周末以及眼前的一切。即使在没有这个的项目中 - 典型的工作日是 10 到 12 小时，然后有跑腿和家务，阅读最新的东西等等......

由于这种情况经常发生——我对加入项目犹豫不决，因为我不能保证每周投入固定的小时数。

我的问题是你们是怎么做到的？
你在开源公司工作吗？我是否夸大了我需要花费的时间（我每天想几个小时）？我是不是离基地太远了，根本没有有效地管理我的时间？你如何管理你的时间？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T01:45:00.840

我目前通过利用失业救济金来做到这一点。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T02:03:11.203

每天做一点。到目前为止，坚持不懈是完成副项目的最大决定因素。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T01:47:00.647

停止工作 12 小时，开始吧。（咧嘴笑）你不需要预先承诺任何特定的时间来开始从事一些你感兴趣的开源项目——即使是每周一个小时对你和项目都有好处。你会发现，随着时间的推移，你对某事越来越感兴趣，你花时间在一个项目上的愿望会增加，你会重新确定生活中的事情的优先级，就像对待你喜欢做的任何其他爱好一样。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T01:53:37.247

首先，找一份新工作。;) 其次，因为开源是所有志愿者，你不必承诺任何具体的时间表。我会说每天几个小时就足够为任何开源项目做出重大贡献了。我倾向于在周末做大部分开源工作。我一周平均大约 3 小时，周末额外增加 5-6 小时。

顺便说一句，开源工作是“跟上”新事物的最佳方式之一；）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T01:59:32.177

我目前是一名学生，正在从事一个开源项目。我为它贡献了我的空闲时间，但这没关系，因为这对我来说也是一种爱好。你想花多少时间取决于你计划做的工作。在开源项目中有许多不同的工作要做，例如除了普通编码之外，还有文档、用户支持、票证分类等。

邮件列表可以很好地介绍项目及其工作方式。开始关注开发邮件列表并观察开发人员如何交互。许多开发人员并非每天都在项目上工作，但可能会将他们的贡献限制在周末。此外，大多数开发人员都明白什么时候现实生活对您来说比项目工作更重要。

还可以查看他们的错误跟踪器。可能只有一些不需要太多工作的功能请求，但没有人有时间解决它们。在这种情况下，请随意实施它并将其附加到报告中。这是为项目做出贡献的好机会。每个贡献都很重要，您不必制定大计划，小贡献也可以。

毕竟，不要仅仅因为担心会花费大量时间就进入开源项目。期待很快在任何开源软件中看到你的一些补丁；-)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T02:00:10.133

如果您每天工作 12 小时，那么您的公司及其开发时间的方法就存在很大问题。我们按照每天 7 小时工作的原则工作，但上班时间为 8-9。这允许开发人员参加会议、吃饭、互相帮助等。然后客户可以有一个更现实的截止日期，即 70小时项目将需要 10 天才能完成，而不是 8.5 天。

这样就可以腾出时间来处理外部项目。为此，我将每周花 3 到 5 个晚上在我的开源项目上。

试着给自己设定目标和截止日期。这意味着你知道你想去哪里，什么时候应该到达那里。

我也尝试每月休息一两天来处理我自己的项目。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-19T04:11:07.900

花更少的时间在 stackoverflow.com 上，更多的时间和家人在一起

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T01:48:34.780

我认为最好的方法是编写一点代码，或者尽可能多地编写代码。在你认为你已经完成了足够多的事情之前，不要真正给他们你的代码。当然它很慢，但它是开源的，实际上并没有最后期限。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T01:52:21.523

当我工作时，我保持简单，我在工作，当我不工作时，我可以处理开源的东西。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-19T01:53:13.410

1) 访问[http://code.google.com/](http://code.google.com/) 或类似网站 2) 找到一些你喜欢的项目并给所有者发电子邮件 3) 每周花一些时间，比如 5-10 小时。4）玩得开心

# php - 用 PHP 读取 Excel 文件

> ID：563670
> 
> 赞同：109
> 
> 时间：2009-02-19T01:53:33.627
> 
> 标签：php, import-from-excel

我正在尝试读取 Excel 文件（Office 2003）。有一个 Excel 文件需要上传并解析其内容。

通过谷歌，我只能找到这些相关（且不足）的主题的答案：生成 Excel 文件、读取 Excel XML 文件、读取 Excel CSV 文件或不完整的废弃项目。我拥有 Office 2003，所以如果我需要那里的任何文件，它们都是可用的。它安装在我的盒子上，但没有也不能安装在我的共享主机上。

**编辑：**到目前为止，所有答案都指向[PHP-ExcelReader](https://sourceforge.net/projects/phpexcelreader/)和/或[这篇](https://devzone.zend.com/27/reading-and-writing-spreadsheets-with-php/)关于如何使用它的附加文章。

* * *

## 回答 #1

> 赞同：62
> 
> 时间：2009-02-19T01:57:19.920

据我所知，您有两个选择：

1.  [Spreadsheet_Excel_Reader](http://sourceforge.net/projects/phpexcelreader/)，它知道 Office 2003 二进制格式
2.  [PHPExcel](https://github.com/PHPOffice/PHPExcel)，它知道 Office 2003 和 Excel 2007 (XML)。（点击链接，您会看到他们将此库升级为[PHPSpreadSheet](https://github.com/PHPOffice/PhpSpreadsheet)）

PHPExcel 将 Spreadsheet_Excel_Reader 用于 Office 2003 格式。

更新：我曾经不得不阅读一些 Excel 文件，但我使用 Office 2003 XML 格式来阅读它们，并告诉使用该应用程序的人只保存和上传该类型的 Excel 文件。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-02-19T03:07:02.593

我使用[PHP-ExcelReader](http://sourceforge.net/projects/phpexcelreader/)读取 xls 文件，效果很好。

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2018-12-28T17:56:03.830

阅读 XLSX (Excel 2003+)
[https://github.com/shuchkin/simplexlsx](https://github.com/shuchkin/simplexlsx)

```
if ( $xlsx = SimpleXLSX::parse('book.xlsx') ) {
    print_r( $xlsx->rows() );
} else {
    echo SimpleXLSX::parseError();
} 
```

输出

```
大批 （
    [0] => 数组
        (
            [0] => 国际标准书号
            [1] => 标题
            [2] => 作者
            [3] => 出版商
            [4] => 尝试
        )
    [1] => 数组
        (
            [0] => 618260307
            [1] => 霍比特人
            [2] => JRR 托尔金
            [3] => 霍顿米夫林
            [4] => 美国
       )

)

```

阅读 XLS (Excel 97-2003)
[https://github.com/shuchkin/simplexls](https://github.com/shuchkin/simplexls)

```
if ( $xls = SimpleXLS::parse('book.xls') ) {
    print_r( $xls->rows() );
} else {
    echo SimpleXLS::parseError();
} 
```

CSV php 阅读器
[https://github.com/shuchkin/simplecsv](https://github.com/shuchkin/simplecsv)

```
if ( $csv = SimpleCSV::import('book.csv') ) {
    print_r( $csv );
} 
```

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2013-04-21T21:09:46.020

这取决于您希望如何使用 excel 文件中的数据。如果要将其导入 mysql，只需将其保存为 CSV 格式的文件，然后使用[fgetcsv](http://php.net/manual/en/function.fgetcsv.php)解析即可。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2015-07-04T11:42:00.893

试试这个...

我使用以下代码阅读“xls 和 xlsx”

```
 <?php
    include 'excel_reader.php';       // include the class
    $excel = new PhpExcelReader;      // creates object instance of the class
    $excel->read('excel_file.xls');   // reads and stores the excel file data

    // Test to see the excel data stored in $sheets property
    echo '<pre>';
    var_export($excel->sheets);

    echo '</pre>';

    or 

 echo '<pre>';
    print_r($excel->sheets);

    echo '</pre>'; 
```

参考：[http ://coursesweb.net/php-mysql/read-excel-file-data-php_pc](http://coursesweb.net/php-mysql/read-excel-file-data-php_pc)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-09-30T23:40:01.387

```
// Here is the simple code using COM object in PHP
class Excel_ReadWrite{

    private $XLSHandle;
    private $WrkBksHandle;
    private $xlBook;

    function __construct() {
        $this->XLSHandle = new COM("excel.application") or die("ERROR: Unable to instantaniate COM!\r\n"); 
    }

    function __destruct(){
        //if already existing file is opened
        if($this->WrkBksHandle != null)
        {   
            $this->WrkBksHandle->Close(True);
            unset($this->WrkBksHandle);
            $this->XLSHandle->Workbooks->Close();
        }
        //if created new xls file
        if($this->xlBook != null)
        {
            $this->xlBook->Close(True);
            unset($this->xlBook);
        }
        //Quit Excel Application
        $this->XLSHandle->Quit();
        unset($this->XLSHandle);
    }

    public function OpenFile($FilePath)
    {
        $this->WrkBksHandle = $this->XLSHandle->Workbooks->Open($FilePath);
    }

    public function ReadData($RowNo, $ClmNo)
    {
       $Value = $this->XLSHandle->ActiveSheet->Cells($RowNo, $ClmNo)->Value;
       return $Value;
    }  

    public function SaveOpenedFile()
    {
        $this->WrkBksHandle->Save(); 
    }  

    /***********************************************************************************
    * Function Name:- WriteToXlsFile() will write data based on row and column numbers
    * @Param:- $CellData- cell data
    * @Param:- $RowNumber- xlsx file row number
    * @Param:- $ColumnNumber- xlsx file column numbers
   ************************************************************************************/
   function WriteToXlsFile($CellData, $RowNumber, $ColumnNumber)
   {
       try{
               $this->XLSHandle->ActiveSheet->Cells($RowNumber,$ColumnNumber)->Value = $CellData;
           }
       catch(Exception $e){
               throw new Exception("Error:- Unable to write data to xlsx sheet");
           }
   }

   /****************************************************************************************
    * Function Name:- CreateXlsFileWithClmName() will initialize xls file with column Names
    * @Param:- $XlsColumnNames- Array of columns data
    * @Param:- $XlsColumnWidth- Array of columns width
   *******************************************************************************************/
   function CreateXlsFileWithClmNameAndWidth($WorkSheetName = "Raman", $XlsColumnNames = null, $XlsColumnWidth = null)
   {
       //Hide MS Excel application window
       $this->XLSHandle->Visible = 0;
       //Create new document
       $this->xlBook = $this->XLSHandle->Workbooks->Add();

       //Create Sheet 1
       $this->xlBook->Worksheets(1)->Name = $WorkSheetName;
       $this->xlBook->Worksheets(1)->Select;

       if($XlsColumnWidth != null)
       {
           //$XlsColumnWidth = array("A1"=>15,"B1"=>20);
           foreach($XlsColumnWidth as $Clm=>$Width)
           {
               //Set Columns Width
               $this->XLSHandle->ActiveSheet->Range($Clm.":".$Clm)->ColumnWidth = $Width;
           }    
       }
       if($XlsColumnNames != null)
       {
           //$XlsColumnNames = array("FirstColumnName"=>1, "SecondColumnName"=>2);
           foreach($XlsColumnNames as $ClmName=>$ClmNumber)
           {
               // Cells(Row,Column)
               $this->XLSHandle->ActiveSheet->Cells(1,$ClmNumber)->Value = $ClmName;
               $this->XLSHandle->ActiveSheet->Cells(1,$ClmNumber)->Font->Bold = True;
               $this->XLSHandle->ActiveSheet->Cells(1,$ClmNumber)->Interior->ColorIndex = "15";
           }
       }
   }
   //56 is for xls 8
    public function SaveCreatedFile($FileName, $FileFormat = 56)
    {
        $this->xlBook->SaveAs($FileName, $FileFormat);
    }

    public function MakeFileVisible()
    {
       //Hide MS Excel application window`enter code here`
       $this->XLSHandle->Visible = 1;
    }
}//end of EXCEL class 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2019-11-05T18:45:41.460

我正在使用以下 excel 文件网址：[https ://github.com/inventorbala/Sample-Excel-files/blob/master/sample-excel-files.xlsx](https://github.com/inventorbala/Sample-Excel-files/blob/master/sample-excel-files.xlsx)

输出：

```
Array
    (
        [0] => Array
            (
                [store_id] => 3716
                [employee_uid] => 664368
                [opus_id] => zh901j
                [item_description] => PRE ATT $75 PNLS 90EXP
                [opus_transaction_date] => 2019-10-18
                [opus_transaction_num] => X2MBV1DJKSLQW
                [opus_invoice_num] => O3716IN3409
                [customer_name] => BILL PHILLIPS
                [mobile_num] => 4052380136
                [opus_amount] => 75
                [rq4_amount] => 0
                [difference] => -75
                [ocomment] => Re-Upload: We need RQ4 transaction for October.  If you're unable to provide the October invoice, it will be counted as EPin shortage.
                [mark_delete] => 0
                [upload_date] => 2019-10-20
            )

        [1] => Array
            (
                [store_id] => 2710
                [employee_uid] => 75899
                [opus_id] => dc288t
                [item_description] => PRE ATT $50 PNLS 90EXP
                [opus_transaction_date] => 2019-10-18
                [opus_transaction_num] => XJ90419JKT9R9
                [opus_invoice_num] => M2710IN868
                [customer_name] => CALEB MENDEZ
                [mobile_num] => 6517672079
                [opus_amount] => 50
                [rq4_amount] => 0
                [difference] => -50
                [ocomment] => No Response.  Re-Upload
                [mark_delete] => 0
                [upload_date] => 2019-10-20
            )

        [2] => Array
            (
                [store_id] => 0136
                [employee_uid] => 70167
                [opus_id] => fv766x
                [item_description] => PRE ATT $50 PNLS 90EXP
                [opus_transaction_date] => 2019-10-18
                [opus_transaction_num] => XQ57316JKST1V
                [opus_invoice_num] => GONZABP25622
                [customer_name] => FAUSTINA CASTILLO
                [mobile_num] => 8302638628
                [opus_amount] => 100
                [rq4_amount] => 50
                [difference] => -50
                [ocomment] => Re-Upload: We have been charged in opus for $100\. Provide RQ4 invoice number for remaining amount
                [mark_delete] => 0
                [upload_date] => 2019-10-20
            )

        [3] => Array
            (
                [store_id] => 3264
                [employee_uid] => 23723
                [opus_id] => aa297h
                [item_description] => PRE ATT $25 PNLS 90EXP
                [opus_transaction_date] => 2019-10-19
                [opus_transaction_num] => XR1181HJKW9MP
                [opus_invoice_num] => C3264IN1588
                [customer_name] => SOPHAT VANN
                [mobile_num] => 9494668372
                [opus_amount] => 70
                [rq4_amount] => 25
                [difference] => -45
                [ocomment] => No Response.  Re-Upload
                [mark_delete] => 0
                [upload_date] => 2019-10-20
            )

        [4] => Array
            (
                [store_id] => 4166
                [employee_uid] => 568494
                [opus_id] => ab7598
                [item_description] => PRE ATT $40 RTR
                [opus_transaction_date] => 2019-10-20
                [opus_transaction_num] => X8F58P3JL2RFU
                [opus_invoice_num] => I4166IN2481
                [customer_name] => KELLY MC GUIRE
                [mobile_num] => 6189468180
                [opus_amount] => 40
                [rq4_amount] => 0
                [difference] => -40
                [ocomment] => Re-Upload: The invoice number that you provided (I4166IN2481) belongs to September transaction.  We need RQ4 transaction for October.  If you're unable to provide the October invoice, it will be counted as EPin shortage.
                [mark_delete] => 0
                [upload_date] => 2019-10-21
            )

        [5] => Array
            (
                [store_id] => 4508
                [employee_uid] => 552502
                [opus_id] => ec850x
                [item_description] => $30 RTR
                [opus_transaction_date] => 2019-10-20
                [opus_transaction_num] => XPL7M1BJL1W5D
                [opus_invoice_num] => M4508IN6024
                [customer_name] => PREPAID CUSTOMER
                [mobile_num] => 6019109730
                [opus_amount] => 30
                [rq4_amount] => 0
                [difference] => -30
                [ocomment] => Re-Upload: The invoice number you provided (M4508IN7217) belongs to a different phone number.  We need RQ4 transaction for the phone number in question.  If you're unable to provide the RQ4 invoice for this transaction, it will be counted as EPin shortage.
                [mark_delete] => 0
                [upload_date] => 2019-10-21
            )

        [6] => Array
            (
                [store_id] => 3904
                [employee_uid] => 35818
                [opus_id] => tj539j
                [item_description] => PRE $45 PAYG PINLESS REFILL
                [opus_transaction_date] => 2019-10-20
                [opus_transaction_num] => XM1PZQSJL215F
                [opus_invoice_num] => N3904IN1410
                [customer_name] => DORTHY JONES
                [mobile_num] => 3365982631
                [opus_amount] => 90
                [rq4_amount] => 45
                [difference] => -45
                [ocomment] => Re-Upload: Please email the details to Treasury and confirm
                [mark_delete] => 0
                [upload_date] => 2019-10-21
            )

        [7] => Array
            (
                [store_id] => 1820
                [employee_uid] => 59883
                [opus_id] => cb9406
                [item_description] => PRE ATT $25 PNLS 90EXP
                [opus_transaction_date] => 2019-10-20
                [opus_transaction_num] => XTBJO14JL25OE
                [opus_invoice_num] => SEVIEIN19013
                [customer_name] => RON NELSON
                [mobile_num] => 8653821076
                [opus_amount] => 25
                [rq4_amount] => 5
                [difference] => -20
                [ocomment] => Re-Upload: We have been charged in opus for $25\. Provide RQ4 invoice number for remaining amount
                [mark_delete] => 0
                [upload_date] => 2019-10-21
            )

        [8] => Array
            (
                [store_id] => 0178
                [employee_uid] => 572547
                [opus_id] => ms5674
                [item_description] => PRE $45 PAYG PINLESS REFILL
                [opus_transaction_date] => 2019-10-21
                [opus_transaction_num] => XT29916JL4S69
                [opus_invoice_num] => T0178BP1590
                [customer_name] => GABRIEL LONGORIA JR
                [mobile_num] => 4322133450
                [opus_amount] => 45
                [rq4_amount] => 0
                [difference] => -45
                [ocomment] => Re-Upload: Please email the details to Treasury and confirm
                [mark_delete] => 0
                [upload_date] => 2019-10-22
            )

        [9] => Array
            (
                [store_id] => 2180
                [employee_uid] => 7842
                [opus_id] => lm854y
                [item_description] => $30 RTR
                [opus_transaction_date] => 2019-10-21
                [opus_transaction_num] => XC9U712JL4LA4
                [opus_invoice_num] => KETERIN1836
                [customer_name] => PETE JABLONSKI
                [mobile_num] => 9374092680
                [opus_amount] => 30
                [rq4_amount] => 40
                [difference] => 10
                [ocomment] => Re-Upload: Credit the remaining balance to customers account in OPUS and email confirmation to Treasury
                [mark_delete] => 0
                [upload_date] => 2019-10-22
            )

      .
      .
      .
 [63] => Array
            (
                [store_id] => 0175
                [employee_uid] => 33738
                [opus_id] => ph5953
                [item_description] => PRE ATT $40 RTR
                [opus_transaction_date] => 2019-10-21
                [opus_transaction_num] => XE5N31DJL51RA
                [opus_invoice_num] => T0175IN4563
                [customer_name] => WILLIE TAYLOR
                [mobile_num] => 6822701188
                [opus_amount] => 40
                [rq4_amount] => 50
                [difference] => 10
                [ocomment] => Re-Upload: Credit the remaining balance to customers account in OPUS and email confirmation to Treasury
                [mark_delete] => 0
                [upload_date] => 2019-10-22
            ) 

    ) 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-11-05T18:41:23.890

**我使用以下代码阅读“xls and xlsx”：**

```
 include 'PHPExcel/IOFactory.php';

    $location='sample-excel-files.xlsx';

    $objPHPExcel = PHPExcel_IOFactory::load($location);
    $sheet = $objPHPExcel->getSheet(0);
    $total_rows = $sheet->getHighestRow();
    $total_columns = $sheet->getHighestColumn();
    $set_excel_query_all=array();
    for($row =2; $row <= $total_rows; $row++) {
        $singlerow = $sheet->rangeToArray('A' . $row . ':' . $total_columns . $row, NULL, TRUE, FALSE);
        $single_row=$singlerow[0];
        $set_excel_query['store_id']=$single_row[0];
        $set_excel_query['employee_uid']=$single_row[1];
        $set_excel_query['opus_id']=$single_row[2];
        $set_excel_query['item_description']=$single_row[3];
        if($single_row[4])
        {
            $set_excel_query['opus_transaction_date']= date('Y-m-d', PHPExcel_Shared_Date::ExcelToPHP($single_row[4]));
        }
        $set_excel_query['opus_transaction_num']=$single_row[5];
        $set_excel_query['opus_invoice_num']=$single_row[6];
        $set_excel_query['customer_name']=$single_row[7];
        $set_excel_query['mobile_num']=$single_row[8];
        $set_excel_query['opus_amount']=$single_row[9];
        $set_excel_query['rq4_amount']=$single_row[10];
        $set_excel_query['difference']=$single_row[11];
        $set_excel_query['ocomment']=$single_row[12];
        $set_excel_query['mark_delete']=$single_row[13];
        if($single_row[14])
        {
            $set_excel_query['upload_date']= date('Y-m-d', PHPExcel_Shared_Date::ExcelToPHP($single_row[14]));
        }
        $set_excel_query_all[]=$set_excel_query;
    }

   print_r($set_excel_query_all); 
```

# ironpython - 在应用程序路径中引用程序集

> ID：563673
> 
> 赞同：1
> 
> 时间：2009-02-19T01:55:51.580
> 
> 标签：ironpython, system.data.sqlite, assembly-reference-path

我正在尝试引用位​​于应用程序路径中的[System.Data.SQLite](http://sqlite.phxsoftware.com/)，以便我可以将其与应用程序打包。我尝试了几种不同的方法，包括：

```
#1
clr.AddReferenceToFile("System.Data.SQLite.DLL")

#2
clr.AddReferenceToFileAndPath("C:\\Path\\To\\System.Data.SQLite.DLL")

#3
sys.path.append(os.getcwd())
clr.AddReferenceToFile("System.Data.SQLite.DLL") 
```

每次它都会给我一个错误：“无法加载程序集 System.Data.SQLite”或找不到指定的文件。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-20T18:16:43.197

我们一般在工作中添加引用的方式如下：

```
import sys
import clr
# forward slashes work fine here and don't need to be escaped
sys.path.append('c:/path/to/directory/containing/dll')
clr.AddReference('System.Data.SQLite') # note lack of .dll 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-27T18:01:38.247

确保 sqlite3.dll 在您的路径中，或者您正在使用嵌入了 sqlite3.dll 的 SDSQLite 版本。

# c# - toString() 仅对调试有用吗？

> ID：563676
> 
> 赞同：10
> 
> 时间：2009-02-19T01:56:11.187
> 
> 标签：c#, java, tostring

当然，除了它们与原语一起使用。我看到的大多数（如果不是全部）实现仅从程序员的角度来看是有用的。

* * *

*编辑*：我知道我应该覆盖默认行为，这就是我提到实现的原因:)。而且我确实得到了在一些需要在 GUI 中使用字符串表示的组件中覆盖它的价值。但是，至少在 JDK 中，我看到*许多*仅在需要调试对象实例时才使用的实现。

为什么它植根于 Object 类，因为它似乎只对 GUI/调试有用？还有其他我不知道的用途吗？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-02-19T02:02:10.127

不，关键是您应该覆盖的默认实现`ToString()`以使其有用。`ToString()`可以将某些东西的值输出回 UI 的好方法。

一个简单的例子是，如果您有一个包含三个字符串（First、Middle、Last）的 Name 类。您可以使用一种`ToString()`方法为 UI 设置格式：例如“Last, First Middle”。

或存储数学运算的类（值 Left=2、Right=3、Result=6 和运算符 enum=Multiply）。调用`ToString()`以获得“2 * 3 = 6”。

*但是*，拥有各种不同的`To<qualifier>String()`方法可能更常见，例如 .NET`DateTime`类。( `ToShortDateString()`, `ToLongDateString()`, `ToLongTimeString()`, ...)

编辑：至于为什么它植根于`Object`班级，这仅仅是因为`ToString()`is a valid operation for *anything*。

此外，字符串可能是数据类型或数据使用者之间编组的好方法，因为它（实际上）保证是可解析的并且不需要额外的编码或照顾。

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2009-02-19T03:39:03.530

我个人的偏好是 toString()**不**应该用于调试以外的任何事情。如果要为对象生成字符串，请提供一个单独的方法来清楚地记录您的意图（getName()、getDescription() 等）。永远不要依赖 toString() 的实现。

问题是许多开发人员将 toString() 视为调试级别的字符串，并没有考虑更改它（例如添加或删除新字段时）。哎呀，一些自动 toString() 构建器使用反射从字段生成 toString() 。

多年来，我发现这种偏好对我很有帮助。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-02-19T02:08:33.263

当你想要一个对象的字符串表示时，toString() 很有用。当然，这是出于调试目的，但也可以有效地将操作结果输出给用户。

例如，假设您有一个处理复数的 Complex 类。*如果您想以3 + 2i*之类的格式将它们打印给用户，如果他们定义 toString() 会很方便，因为您不必每次都编写格式并且输出将是一致的。如果您想更改该表示，例如更改为*3 + 2j*，您只需触摸 Complex 类中的 toString() 方法。

所以 toString() 也不是用于调试目的，而是获得对象的一致字符串表示的好方法。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-02-19T04:57:04.967

我只能说，当我更改类的 toString 以显示一些额外的调试信息时，我遇到了代码中断。

有问题的代码是一个 GUI 库，它决定将 toString 的值用作一些内部事物（这是几年前的事了……我忘记了它到底是什么）。最终结果是我不再使用那个库了。

我想说，由于一大群人将 toString 视为用于调试（无论您认为它应该用于什么），因此使用从它返回的值来执行任何程序化操作都是有问题的（比如解析它）或将其显示给用户。

如果您 100% 控制 toString 方法，那么一定要按照您的意愿行事。

所以，回答这个问题，no toString 不仅对调试有用，你可以用它做任何你想做的事情。但是，如果 toString 的变化使您不高兴，请不要感到惊讶。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-02-19T15:24:44.187

根据我的经验， toString() 在调试和日志记录之外几乎没有价值。随着时间的推移，您不能依赖它的格式或内容，因此除了人类可读之外，除了最简单的对象（例如原始对象类型）之外，不要依赖它。如果有多个数据成员，预计它们的类型或数量可能会随着时间而改变，toString() 的输出也会随之改变。

我想强烈提出的另一点。不要在 toString() 中调用其他方法。没有什么比在调试器中检查断点上的变量内容更糟糕的了，然后由于 toString() 中的方法调用而执行了更多代码。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-02-19T20:41:52.180

我认为重要的是要指出回答提到“toString”的人注意到小写“t”通常是在谈论Java，而回答提到“ToString”的人通常是指C#。当然，这并不适用于所有响应。

在我自己的观察中（我每天都使用），鼓励 C# 中的程序员重写“ToString”以显示有用的文本表示。然而，在 Java 中，我几乎没有看到这一点。事实上，我很少看到这种情况。

-J.P

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-02-19T05:44:36.117

首先，该`toString`方法应该返回对象的人类可读的文本表示。

这个问题在[Effective Java](http://java.sun.com/docs/books/effective/)中作为**第 10 条提出：始终覆盖`toString`**。

它引用了该方法的[Java API 规范](http://java.sun.com/javase/6/docs/api/)[`Object.toString`](http://java.sun.com/javase/6/docs/api/java/lang/Object.html#toString())：

> 结果应该是一个简洁但信息丰富的表示，易于人们阅读。

除了调试之外，在将对象添加到 a或 a`toString`时，覆盖类的方法可能很有用，默认情况下将使用该方法将对象显示为列表或表格中的文本形式。[`JList`](http://java.sun.com/javase/6/docs/api/javax/swing/JList.html)[`JTable`](http://java.sun.com/javase/6/docs/api/javax/swing/JTable.html)`toString`

例如，在我的例子中，我重写了`toString`添加到 a 的对象的方法，`JList`以便用户能够通过 GUI 在列表中查看有关项目的信息。

因此，确实存在该`toString`方法对调试以外的情况有用的情况。关键是让该`toString`方法返回对人们实际有用的信息，而不是默认`Object.toString`实现，其中对象的内存位置用于其文本表示。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-19T02:18:49.353

对...有用

1.  Gui（使用 PropertyGrid 时的复杂属性，表单标题文本）
2.  DataBinding（这就是它的工作方式）

以及任何其他字符串输出。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T02:06:58.480

在将任何对象打印到字符串时，.NET Framework 也会隐式调用 ToString()。

```
Console.WriteLine("My Object is" + object.ToString()); 
```

相当于

```
Console.WriteLine("My Object is" + object); 
```

因为 ToString() 被隐式调用。

我相信，尽管不确定，它被调试器用于对象的“值”。这可以相当方便，虽然有限。在大多数情况下，编写自己的调试器可视化工具会是一个更好的主意。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-19T02:12:58.043

在 AS3 上，我必须将 2D 数组转换为 1D 数组。最快（运行速度）和最简单（编码时间）的解决方案是：

```
var new1DArray:Array = the2DArray.toString().split(","); 
```

感到惊讶，但它实际上也按预期工作并且非常快！

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-02-19T04:03:38.073

我大量使用 ToString() 来处理日期时间格式。

[http://hunterconcepts.com/content/tools/formats/](http://hunterconcepts.com/content/tools/formats/)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-19T04:11:14.687

除了其他人已经说过的，覆盖 ToString() 在使用调用它的控件时也很有用。例如，一个组合框：

```
myComboBox.Items.Add(new MyClass());
// now, whatever ToString() returns is shown in the
// ComboBox, but you can get the object back by through
// the SlectedItem property. 
```

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-02-19T03:33:38.177

它可能不是“有意的”用途，但我已将其用于数据序列化

```
storeToHardDrive(studentList.ToString()); 
```

# c# - 找出包含在 DLL 中的类正在使用的 C# 应用程序的类型

> ID：563677
> 
> 赞同：3
> 
> 时间：2009-02-19T01:56:11.953
> 
> 标签：c#, .net, dll, assemblies, types

有什么方法可以在 C# 中知道正在运行的应用程序的类型。

Windows 服务 ASP.NET Windows 窗体控制台

我想对应用程序类型做出反应，但找不到确定它的方法。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T03:01:00.500

您应该让客户端代码告诉您的代码上下文是什么，然后从中工作。充其量，您将能够根据外部因素进行猜测。

如果您必须猜测，这就是我要寻找的：

*   对于 ASP.NET，我会寻找 HttpContext.Current
*   对于 Windows 窗体，我查看 Application 类上的静态 OpenForms 集合中是否有任何项目。
*   对于 Windows Presentation Foundation，请查看 Application 类的静态 Current 属性是否不为空。
*   对于服务，实际上没有办法确定这一点，因为服务不必注册进程句柄、线程句柄等。
*   For console windows, if none of the above is true, then I would assume this is a console.

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T02:36:23.743

尝试检查[`Application.MessageLoop`](http://msdn.microsoft.com/en-us/library/system.windows.forms.application.messageloop.aspx)。对于 Windows 窗体应用程序（具有 WinForms 消息循环）*应该*是 true ，对于 Windows 服务应该是 false。我不知道它会为 ASP.NET 返回什么。

至于控制台应用程序，它们将没有消息循环，因此它们将返回 false。您可以使用[`Console`](http://msdn.microsoft.com/en-us/library/system.console_members.aspx)类中的大多数属性进行检查，但我警告您这是一个 HACK。如果你*必须*，我会选择：

```
bool isConsole = Console.In != StreamReader.Null; 
```

请注意，控制台应用程序仍然可以调用`Console.SetIn(StreamReader.Null)`或 Windows 应用程序可以调用`Console.SetIn(something else`)，所以这很容易被欺骗。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T02:50:03.303

ASP.NET，检查 HttpContext.Current 是否为空

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2017-04-03T07:48:04.543

To check for a *Forms*, *WPF*, *WCF* or *Console* application:

```
if (System.Windows.Forms.Application.OpenForms.Count > 0)
{
    return ApplicationType.WindowsForms;
}

if (System.Windows.Application.Current != null)
{
    return ApplicationType.Wpf;
}

if (System.ServiceModel.OperationContext.Current != null)
{
    return ApplicationType.Wcf;
}

try
{
    int windowHeight = Console.WindowHeight; // an exception could occur
    return ApplicationType.Console;
}
catch (IOException)
{
}

return ApplicationType.Unknown; 
```

# sql-server - SQL Server“最大服务器内存”-似乎对虚拟大小没有影响

> ID：563681
> 
> 赞同：1
> 
> 时间：2009-02-19T01:57:57.690
> 
> 标签：sql-server, sql-server-2005

在 32 位 windows xp、sql server express 上，我将 SQL Server“最大服务器内存”设置为 200 MB，但是一旦我启动它，在 Sysinternals Process Explorer 中我仍然看到消耗了 1.5 GB 的虚拟大小。

现在我知道如果 Virtual Size 很小这没什么大不了的，但是当其他应用程序最大化物理内存（Internet Explorer*咳嗽*）时，我会得到 windows“虚拟内存太小”的错误，所以我认为它确实变成了问题。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T02:31:38.590

根据[http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=377495](http://connect.microsoft.com/SQLServer/feedback/ViewFeedback.aspx?FeedbackID=377495)设计的行为。内存被保留，但未提交。

# asp.net - 存储word文档

> ID：563697
> 
> 赞同：5
> 
> 时间：2009-02-19T02:04:02.073
> 
> 标签：asp.net

我正在工作网站（使用 asp.net 3.5），用户可以在其中上传一份或多份简历。数据库是 sql server 2005。关于存储这些文档的建议是什么？我应该将它作为 blob 存储在数据库中还是仅将路径存储在数据库中并将文档保存在物理文件夹中？有人可以提一下每种 wrt 性能和可扩展性的优缺点吗？

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T02:11:28.843

将文件存储在数据库中可为您提供：

(+) 更容易管理，磁盘上没有孤立文件

(+) 一致的编程和访问模型（授权）

(-) 数据库过度增长，这将增加备份时间和用于保存备份文件的磁盘空间

我不认为任何一个选项都比另一个更好。如果您期望有大量文档，您将达到目录中文件数量的限制（作为绝对限制，或者因为目录查找在某个点开始执行非常糟糕）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T04:05:12.437

我负责一些管理许多 TB 图像的应用程序。我认为这个应用程序的相似之处在于它存储的文件相对于典型的数据库行来说相对较大。我们发现在数据库中存储文件路径是最好的。

有几个问题：

*   数据库存储通常比文件系统存储更昂贵。
*   您可以使用标准的现成产品加速/分发文件系统访问。
*   Web 服务器等东西不需要特殊的编码或处理来访问文件系统中的图像。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T04:26:48.207

我建议将其存储在数据库中以保持一致。

在数据库中存储时要考虑的另一点是 SQL 数据库可以由多个文件组成。我的建议是在此数据库上创建第二个文件 (.ndf)，其中包含包含 BLOB 数据的表。

这提供了一些关键优势，因为它可以 (1) 在需求增加时在单独的磁盘阵列上运行。(2)可以单独备份和恢复。(3) 不会使您的主 OLTP 数据库文件膨胀。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T04:52:14.120

我会为每项工作使用最好的工具：

*   用于存储和查询数据的最佳数据库类型是关系数据库。
*   管理文件的最佳数据库是文件系统。

使用文件系统将允许您使用正确的工具来管理文件：您可以使用操作系统的压缩功能、使用增量备份工具等，而不会因有时可能包含大图像的结构不佳的 Word 文档而使您的数据库膨胀。

随着文件的数量越来越大，从文件系统的角度来看问题很容易解决：将文件存储到相对路径目录中，这样您就可以控制每个目录的文件数量（例如，创建每周文件夹或当文件数超过一定限制时创建一个新文件夹）。
那么你只需要在数据库中保留文件的相对路径即可。

我还会在提交时规范化文件名以保持一致，例如`20090219-001.doc`.

正如其他建议的那样，您可以解析 doc 文件以提取纯文本信息并将其存储在数据库中以获得文本搜索的好处。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T02:18:58.293

将数据保存在数据库中将使日期管理变得更加容易。您不必确保数据库中的数据与文件系统上的数据（文件路径）同步。

话虽如此，重要的是要意识到在数据库中存储大 blob 时可能会影响性能。幸运的是，已经在该领域进行了一些研究以调查可能的情况。我建议你看看微软研究院关于这个主题的[这篇论文](http://research.microsoft.com/apps/pubs/default.aspx?id=64525)。希望有帮助。

此外，我应该提到，Microsoft SharePoint 将其 Word 文档（以及其他文件）作为 blob 存储在 SQL Server 数据库中。[您可以在此处](http://blogs.technet.com/josebda/archive/2007/10/25/the-legend-of-the-single-multi-terabyte-replicating-sharepoint-database.aspx)阅读有关此内容的更多信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T02:40:18.820

没有什么可以说你不能两者都做 - 解析文档并将重要的元信息（如联系信息、常用词等）存储到索引列中，存储文档的路径。这就是我为高可用性（每月最多 2100 万次展示）数据库所做的，但我们正在提供媒体文件，但文件大小和主体大致相同。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T02:44:15.487

您可以尝试将文档文件存储在单独的数据库中并使用简单恢复模型。然后，您可以轻松地备份文档数据库，而不必担心您的备份会膨胀。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-02-19T02:44:53.457

我有两个将文件存储在文件夹中的系统——当我们在一个文件夹中存储大约 20K 文件时，它们的扩展性都很差。可以通过使用子文件夹（例如 2008-01、2008-02）来解决，但正如其他人所说，您有同步问题。

数据库允许您存档/删除旧的简历并且没有同步问题。只要您不想全文搜索数据，就可以在存储/检索时压缩/解压缩文本。假设一个 10-20K 的文件，您可能会压缩到 1-2K。没那么大。

# asp.net-mvc - 如何在 ASP.NET MVC 中创建轮播广告块？

> ID：563706
> 
> 赞同：20
> 
> 时间：2009-02-19T02:15:28.647
> 
> 标签：asp.net-mvc

您将如何使用 ASP.NET MVC 在每次页面刷新时实现旋转广告块，类似于 SO 所做的？

您是否认为他们有一个会话变量，其中包含我们当前正在查看的广告索引并在每个请求或其他内容中循环它？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-25T13:51:24.243

我会使用[OpenX](https://www.openx.com/)、[DART](http://www.doubleclick.com/products/dfp/index.aspx)、[Google Ad Manager](https://www.google.com/admanager)、[RightMedia](http://www.rightmedia.com/)、[Rubicon](http://rubiconproject.com/)或其他一些广告管理器。

但是，如果我想自己构建它作为练习，我会：

1.  创建广告数据库表
2.  在我的基本控制器中，选择一个随机广告到 ViewData
3.  向母版页添加部分视图以呈现广告
4.  [最重要] 使用 Phil Haack 的 MVC 风格版本的“[甜甜圈缓存](http://haacked.com/archive/2008/11/05/donut-caching-in-asp.net-mvc.aspx)”

这与您用于显示循环引用、随机推荐用户或您希望在每个页面上显示的任何其他随机内容的方法相同。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T12:03:47.840

我不知道 MVC，但有什么阻止你使用 AdRotator 控件吗？

[http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.adrotator.aspx](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.adrotator.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T10:00:00.527

您可以只生成一个随机数并将其用作要显示的广告的数组键，但您无法确保均匀曝光，并且在兑换货币时会引起很多问题。为此目的而构建的应用程序是[OpenX](https://www.openx.com/)。这提供了真正深入的统计数据，它还允许您设置每个广告需要显示多少等。它非常强大，许多商业网站使用它来管理他们的广告。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-02T22:36:55.423

我不得不在 MVC 中为加权广告控件编写一些东西，如果可能的话，它不会连续两次显示相同的广告，并且在我匆忙中，我最终得到了一段糟糕的代码，可能会给你带来灵感。

我确信有很多更好的方法可以做到这一点（而且我已经知道在不应该重复的情况下允许重复通过的情况），但在我花在它上面的很短的时间里，它完成了这项工作。

```
 public List<Ad> GetRandomWeightedAds()
    {
        /* Generate random order list of ads with duplicates for ViewsPerRotation */
        List<Ad> returnList = GetAllAds().SelectMany(s => Enumerable.Repeat(s, s.ViewsPerRotation)).OrderBy(s => Guid.NewGuid()).ToList();
        for (int i = 0; i < returnList.Count - 1; i++) /* Compare all but the last element against subsequent element */
        {
            if (returnList[i].Id == returnList[i + 1].Id)
            {
                /* If next to an identical element try and find a new spot for the subsequent element */
                for (int j = 0; j < returnList.Count; j++)  
                {
                    if (returnList[j].Id != returnList[i].Id /* Don't switch identical element back into same pos*/
                        && (j<i || j == 0 || j-1 == i || returnList[i].Id != returnList[j - 1].Id) /* When moving before current 'i', don't move into a place after an identical element */
                        && (j<i || j == returnList.Count - 1 || j + 1 == i || returnList[i].Id != returnList[j + 1].Id)) /* When moving before current 'i', don't move into a place before an identical element */
                    {
                        returnList[i] = returnList[j];
                        returnList[j] = returnList[i+1]; /* returnList[i+1] == returnList[i] */
                        break;
                    }
                }
            }
        }
        return returnList;
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-03-16T14:15:13.063

以下博客将为您提供有关 Ad Rotator 实施的良好提示。

1) 以下是在 ASP.NET 中，但仍然完全基于 Jquery 且简单。

[http://dongavipul.blogspot.in/2011/02/jquery-adrotator-like-aspnet-adrotator.html](http://dongavipul.blogspot.in/2011/02/jquery-adrotator-like-aspnet-adrotator.html)

2) 下面给出了广告轮播的 Helper 方法实现。

[http://weblogs.asp.net/rashid/archive/2009/04/20/adrotator-for-asp-net-mvc.aspx](http://weblogs.asp.net/rashid/archive/2009/04/20/adrotator-for-asp-net-mvc.aspx)

# wcf - 带有 .NET 后端的 ExtJS

> ID：563707
> 
> 赞同：1
> 
> 时间：2009-02-19T02:18:33.053
> 
> 标签：wcf, .net-3.5, extjs

我最好的选择是什么（使用 .NET 框架中的最新版本）来创建一个带有完整 ExtJS 前端的 webapp（所有服务器交互都通过 AJAX 和 XML 或 JSON 进行）？使用 WCF 有什么问题吗？以下（假的，但有趣的）O'Reilly 书籍封面似乎暗示了这一点。

[http://www.oreillymaker.com/link/14746/extjswcf/](http://www.oreillymaker.com/link/14746/extjswcf/)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-02-19T02:39:55.653

你看过[http://www.coolite.com/](http://www.coolite.com/)吗？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T02:57:13.443

我已经成功地将 ExtJS 与“旧”.NET JSON Web 服务一起使用。我尝试使用 WCF DataContracts 和所有这些，但涉及的摩擦太多。

一个问题是，当序列化为 JSON 时，所有响应都包含在“.d”属性中。您需要重写 Ext JsonReader 类来读取 .d 属性作为响应。

见：[http ://extjs.com/forum/showthread.php?t=59903](http://extjs.com/forum/showthread.php?t=59903)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-23T19:23:48.580

Causas ( [http://www.coolite.com/](http://www.coolite.com/) ) 提到的 Coolite 正在迅速成熟，并且已经能够“开箱即用”地完成大多数 ExtJS 的事情。

您可以想到的大多数“标准”场景都会处理数据处理。

如果您有任何 ExtJS 经验，您也可以手动进入并在需要时亲自处理 javascript 本身。

对于一个相当复杂的应用程序，我还没有找到任何我不能用它做的事情。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-11-21T07:09:35.477

这是一篇关于带有 WCF 的 EXTJS 的好文章 [http://dotnetkeeda.blogspot.in/2013/11/working-with-sencha-extjs-and-wcf.html](http://dotnetkeeda.blogspot.in/2013/11/working-with-sencha-extjs-and-wcf.html)

# .net - 加密配置文件以进行部署

> ID：563717
> 
> 赞同：1
> 
> 时间：2009-02-19T02:24:50.883
> 
> 标签：.net, encryption, app-config

我有一个从 app.config 读取的 Windows 服务。

我希望对某些设置进行加密，但是，我不想使用 .NET 中提供的 ProtectedConfigurationProvider 类，因为它们基于使用 DPAPI 运行的机器来加密文件。

我想要的是一种让我们的管理员将已经加密的配置文件部署到多台机器并让每台机器在需要时解密它们的方法。

我也不想将密码硬编码到程序集中，所以我不确定我该怎么做。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-02-19T02:37:11.447

将问题简化为最简单的形式：

*   你有一个程序
*   将获得一个加密文件
*   你想解密文件
*   无需对密钥进行硬编码

显而易见的解决方案是在需要时向受信任的第三方索取密钥

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T02:43:14.070

一种可能的方法是在文件的开头包含解密密钥，并且该密钥已以某种方式进行了重新处理，您可以从该密钥中确定该方式。一种可能性是选择，比如说十六个不同的东西，比如，0 表示将前两个字节旋转到末尾；1 将最后两个字节旋转到前面；2 每个字节加 1；等等 14 个附加功能。现在将此值添加到键前面作为“重新处理标志”。

然后，密钥的第一个字节将成为 16 个不同例程之一的分支表，以说明如何处理密钥。请注意，重新处理标志不必是第一个字节，它可以是密钥中的任何字节，只要您记得在处理密钥时丢弃该字节即可。

然后根据您将使用的任何解密算法处理密钥。

现在，考虑到这个重新处理标志——特别是如果整个密钥是十六进制的——需要有人按照逻辑来确定你的代码执行了 16 个不同函数中的哪一个，然后找出解密方法。它不会阻止每个人，但它可能会做得很好，除了最坚定的人之外，它会驱走所有人。

# oop - OO 中的 2x 一对多关系

> ID：563724
> 
> 赞同：2
> 
> 时间：2009-02-19T02:30:58.187
> 
> 标签：oop, orm, entity-relationship

想象一下这些关系：

*   1 A 有很多 B
*   1B有很多C...

相反：

*   C有1个B
*   B有1A
*   通过传递性，C 有 1 A

为了在 DB 中建模这种关系，我们有：

```
TableA
a_id

TableB
b_id
a_id (fk to TableA)

TableC
c_id
b_id (fk to TableB) 
```

为了在 OO 中建模这种关系，我们有：

```
objA
objB
objC 
```

并且... - objB 引用了 objA - objC 引用了 objB

如果objC有一个方法需要调用objA的一个方法，你会怎么做？

**选项1。**

```
b.getA().runMethodX() 
```

我知道很多人会这样做，但我也知道这不好，因为 getA() 不是纯面向对象意义上的 B 行为。这样做就像进行过程编程一样。同意不同意？

**选项 2。**

*让objC通过构造函数注入/setter直接引用objA和objB*

这是一个好主意吗？但随后 objC 引用的 objB 也引用了 objA。这个可以吗？或者只要不是循环对象引用的情况，就可以接受？

**选项 3。**

*将有问题的方法移动到objA，并通过参数传入objC。*

我不确定这是否是一种选择。我认为它不会在所有情况下都有效。让 objC 中的方法减少到仅适用于其状态的最低限度，并让 objA 做 objA 之前或之后需要做的任何事情。

**选项 4.** （代表团）

将 runMethodXinA() 添加到 B，它调用

```
a.runMethodX() 
```

C 调用

```
b.runMethodXinA() 
```

我之前尝试过这种方法，但是 B 很可能最终会拥有与 A 一样多的方法，并且 B 和 A 中没有 1 个方法违反 DRY？

你的虽然是什么？还有其他选择吗？评论？建议？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T03:42:14.053

选项 2 是一种相当危险的信息重复，此外，根据您的环境，参考图的形状可能会出现任何问题。

如果方法在某种意义上依赖于 objA 的类型，选项 3 可能有意义，作为一种双重调度。

选项 1 违反了得墨忒耳法则，但听起来它是最不具侵入性的选项。

您可能还需要考虑 objB 上的转发方法，该方法将调用传递给 objA。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T02:48:51.793

从您的选择列表中，选择是选项 4，因为它遵守得[墨忒耳法则](http://en.wikipedia.org/wiki/Law_of_Demeter)

*   选项 1 违反得墨忒耳定律
*   选项 2 引入了冗余引用*并*间接违反了得墨忒耳定律
*   选项 3 用对象 C 的知识污染对象 A，这也可以说违反了得墨忒耳定律（相反）

剩下选项4

可能有一个选项 5，但这超出了原始问题的范围；-)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T02:50:48.530

我认为问题是你想要什么样的模型。如果您要使用一个关系模型，您可以提前知道整个结构并且它不会改变，那么选项 1 是可以接受的。也就是说，C 需要*特定组织模式中 A 中的数据/方法。*

选项 2 似乎是个好主意。但是您实际上是在保存对同一对象的两个引用。现在，如果 B 被映射到不同的 A，B 也必须通知 C 更改其引用。不好。

然而，选项 4 似乎是采用真正 OO 方法的正确方法。关键是A可以改变它的结构，你只需要适应B——直接的孩子。C 不知道也不关心 A 是如何实现的，只要 A 存在并且 B 知道如何处理它就足够了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T03:24:47.620

你真的需要从 C 到 B 到 A 的反向指针，还是只有它们才能从 C 访问 A？也许 A 应该负责创建 B 和 C 并管理他们的关系。在这种情况下，A 可以在创建 C 时将自己插入到 C 中（例如，C 可能有一个接受 A 的构造函数）。

您还可以在 A 上隔离 C 需要的函数并为其创建接口。接口（而不是 A）将在构造时传递给 C。这将使 C 与 A 分离。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T13:14:21.697

1号或4号视情况而定。在我的金属切削软件中，我们有很多需要知道对象的父/源的实例。例如，我们在配件上有一个路径集合，每个路径都有一个配件属性，该属性返回创建它的配件。

但是，如果一个连接的对象只是因为它帮助原始对象实现其目的（如数学支持）而存在，那么委派可能是更好的方法。

如果连接的对象修改了原始对象，那么您最好使用访问者模式。

唯一需要注意的是，在大多数 OOP 中，您必须小心双重链接对象。对于具有相互连接的父子链接的对象，垃圾收集通常会失败。忘记清理父子链接是一个常见的错误。

使用支持创建和使用事件的 OOP，您可以解决此问题。通过使用代理。父母将交给孩子一个代理对象而不是自己。当孩子需要父母时，它将从代理对象获得引用。代理对象反过来作为一个事件引发，导致父对象返回自身。没有硬链接，因此减轻了程序员或垃圾收集器不清理的问题。

# ruby - 迭代相同大小的子字符串

> ID：563727
> 
> 赞同：0
> 
> 时间：2009-02-19T02:31:44.037
> 
> 标签：ruby, string, slice

我想将我的 String 对象转换为其 1 大小的子字符串（不是字符）的 Enumerable，如何在 Ruby 中有效地做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T02:42:43.057

```
"xyzzy".split(//) => ["x", "y", "z", "z", "y"] 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T03:01:36.740

在 Ruby 1.9（和 1.8.7）中，您可以使用 each_char 可靠地迭代字符串的字符，包括正确处理多字节字符和其他内容。在早期版本中，each_char 不存在，索引将返回字节代码而不是单个字符字符串。在这种情况下，您可以使用

```
"abcdefg".split(//u) 
```

这将以 UTF-8 感知方式拆分字符串。

[这里](http://billsix.blogspot.com/2007/11/iteration-over-strings-in-ruby.html)有一些很好的讨论。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T02:40:41.020

也许我不明白你的问题，但是Ruby中的一个字符和一个1字符的字符串没有区别。

```
'hello world'.each_char {|c| puts "substring is #{c}"} 
```

# jquery - JQuery - 如何为每个最后一个列表项添加一个类？

> ID：563740
> 
> 赞同：15
> 
> 时间：2009-02-19T02:40:03.843
> 
> 标签：jquery, css, class, each

这里有一些不起作用的代码：

```
$("#sidebar ul li:last").each(function(){
      $(this).addClass("last");
}); 
```

基本上我有 3 个列表，并且想为每个无序列表中最后出现的每个项目添加一个类（最后一个）。

```
<ul>
      <li>Item 1</li>
      <li>Item 2</li>
      <li class="last">Item 3</li>
</ul> 
```

希望这是有道理的，干杯！

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2009-02-19T02:46:17.527

容易犯错误。试试这个：

```
$("#sidebar ul li:last-child").addClass("last"); 
```

基本上 :last 并没有完全按照你的想法做。它只匹配文档中的最后一个，而不是每个列表中的最后一个。这就是 :last-child 的用途。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-03-21T10:37:58.393

用jquery添加这个

```
$("ul li").last().addClass('last'); 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T02:54:14.183

不起作用的原因是因为`:last`只匹配一个元素。来自 jQuery 文档：

> 匹配最后选择的元素。

因此，您的代码正在做的是获取 a 中所有`<li>`元素的集合`<ul>`，然后从该集合中获取最后一个值。例子：

```
 <ul>
   <li>1</li>
   <li>2</li>
 </ul>
 <ul>
   <li>3</li>
   <li>4</li>
 </ul>
 <ul>
   <li>5</li>
   <li>6</li>
 </ul> 
```

您的代码将返回元素`<li>6</li>`。（在内部，它会收集`<li>1</li>`到`<li>6</li>`最后一个，然后剪掉最后一个并返回）。

您正在寻找的是这里的其他答案所说的：`:last-child`.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T15:20:27.537

或者您可以给您的列表一个 id 并将其用作 jquery-call 的上下文。

```
<ul id="myList">
  <li>Item</li>
  <li>Item</li>
  <li>Item</li>
  <li>Item</li>
</ul>

<ul id="anotherList">
  <li>Item</li>
  <li>Item</li>
  <li>Item</li>
  <li>Item</li>
</ul> 
```

然后你可以这样做：

```
jQuery("li:last", "ul#myList").addClass("lastItem"); 
```

现在第一个列表中的最后一个 li 将具有类“lastItem”。

编辑：对不起，误读了这个问题。请忽略这个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-12-05T15:36:07.927

如果您需要将类添加到 3 个单独的列表中，您可以为它们分配一个类并使用“每个”：

```
$('#sidebar ul.class li:last-child').each(function(e){
    $(this).addClass("last");
}); 
```

这应该完全按照您的预期工作。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-19T02:44:09.607

你可以试试

```
$('#sidebar ul li:last').addClass('last'); 
```

# apache-flex - Flex 中的异步函数调用

> ID：563747
> 
> 赞同：15
> 
> 时间：2009-02-19T02:42:23.870
> 
> 标签：apache-flex, actionscript-3, actionscript, asynchronous

是否可以在 Flex 中异步调用函数？我想定期解析文件而不阻塞应用程序的其余部分，推荐的方法是什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-02-19T04:48:04.363

Actionscript 不支持多线程，我认为这是您在这里真正要问的。

虽然该功能不是 actionscript（或 Flex）所固有的，但您可以使用事件和计时器设置模拟系统。

我对你的确切问题有点不清楚，所以我将给出两个答案：

**1）您希望每隔几秒钟处理一次文件以对任何更改采取行动。**

在这种情况下，您需要做的就是设置一个计时器来定期检查文件：

```
var fileTimer:Timer = new Timer(5000);
fileTimer.addEventListener(TimerEvent.TIMER, checkFile);

...

private function checkFile(event:TimerEvent):void {
  // read the file and do whatever you need to do.
} 
```

**2）您想解析一个非常大的文件，但不希望应用程序在执行此操作时挂起。**

如果您想在后台处理文件，同时保持主应用程序响应，那么我可能会创建一个函数来解析文件的几行，然后发送一个事件并返回。侦听该事件并启动一个计时器，该计时器将等待几毫秒，然后再次调用该函数以解析下一组行。

这将中断对大文件的解析，并有足够的停机时间来保持应用程序的其余部分平稳运行。您必须使用计时器间隔和一次解析的行数，以在响应性和解析文件所需的时间之间取得良好的平衡。

希望这是有道理的！

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-19T04:48:48.917

最简单的答案是使用`callLater`例程 - 请参阅[此处](http://livedocs.adobe.com/flex/3/html/help.html?content=layoutperformance_12.html)的一些文档。

```
callLater( parseFile, [filename] );

...

public function parseFile( filename : String ) : void
{
    // parse the file
} 
```

另一种方法是使用包[`setTimeout`](http://livedocs.adobe.com/flex/3/langref/flash/utils/package.html#setTimeout())中定义的调用`flash.utils`。这个允许您在经过指定的时间后调用例程。使用此例程，您可以将`parseFile`函数设置为重复调用自身，从而为您提供所需的定期间隔：

```
parseFile( filename );

...

public function parseFile( filename : String ) : void
{
    // parse the file

    // call this function again in 5 seconds
    setTimeout( parseFile, 5000, filename );
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T11:59:46.243

有趣的是，就在昨天，我在回答[另一个问题时](https://stackoverflow.com/questions/560474/flex-equivalent-of-processmessages-and-unresponsive-ui-during-long-loops)[描述了这个问题的解决方案](https://stackoverflow.com/questions/560474/flex-equivalent-of-processmessages-and-unresponsive-ui-during-long-loops/561505#561505)。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-22T12:44:31.747

您需要的是一个名为[Green threads](http://en.wikipedia.org/wiki/Green_threads)的概念。那里有一个[绿色线程库](http://blog.generalrelativity.org/?p=29)，但我没有使用它。

我为导入过程（1 - 5 分钟）所做的实现实际上跟踪了执行所花费的时间，并允许每个周期可配置的时间量。这使您可以选择丢弃的帧数（我们只是在更新模态进度条）。我还使用一个通过 IViewCursor 的 ICollectionView 运行的版本对其进行子类化，并使用每个项目触发事件。

I cannot supply the source code due to it's connection with a commercial product, but the concept is quite simple to implement.

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T07:29:15.817

还有一个`setInterval`函数会定期调用一个函数，这可能很有用。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-20T21:53:03.863

setTimeout 和 setInterval 都已弃用。

Timer 类不仅允许延迟，还允许 repeatCount：它会抛出多少次 TIMER 事件并重新开始倒计时。据推测，在做任何你想做的事情之前，你会在事件中调用 myTimer.stop() ，然后在完成后调用 myTimer.start() 。

```
private function newLinesToParse() : void
{
    myTimer = new Timer(30000, 9999);
    myTimer.addEventListener(Timer.TIMER, myTimerTick);
    myTimer.start(); 
}

private function myTimerTick(event : Event) : void
{
    myTimer.stop();    // or (event.currentTarget as Timer).stop();

    // do a few lines

    if (anyMoreLines)  
        myTimer.start();
    else
        myTimer = null;
} 
```

干杯

# wcf - WCF 服务最大方法数

> ID：563771
> 
> 赞同：5
> 
> 时间：2009-02-19T02:51:20.603
> 
> 标签：wcf, web-services

可以通过单个 WCF 服务合同公开的最大方法/操作数是多少？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T09:37:02.530

虽然没有最大值，但您可能会遇到`Metadata Exchange`- 和以下配置值的问题，它是默认值：`maxNameTableCharCount`.

在尝试向现有功能添加新功能时`WCF Service`，我在尝试“*更新服务参考*”时遇到错误 - 与默认值`maxNameTableCharCount`太小而无法处理`mex`传输大小有关。

可以通过在服务器配置中`Metadata Exchange`添加自定义来覆盖默认值。`mex binding`

如果超出配置值，当您尝试添加或更新服务参考时，您可能会看到如下错误消息：

> 读取 XML 数据时已超出最大可命名字符计数配额 (16384)。nametable 是一种数据结构，用于存储在 XML 处理过程中遇到的字符串 - 具有不重复元素名称、属性名称和属性值的长 XML 文档可能会触发此配额。可以通过更改创建 XML 阅读器时使用的 XmlDictionaryReaderQuotas 对象的 MaxNameTableCharCount 属性来增加此配额。第 1 行，位置 332845。

服务器 Mex 端点应指定如下：

```
<endpoint address="mex" 
          binding="customBinding" 
          contract="IMetadataExchange" 
          name="" 
          bindingConfiguration="customMex" 
          listenUriMode="Explicit" /> 
```

使用如下指定的自定义绑定块：

```
<customBinding>
    <binding name="customMex">
        <textMessageEncoding>
        <readerQuotas maxDepth="2147483647" maxStringContentLength="2147483647" 
                      maxArrayLength="2147483647" maxBytesPerRead="2147483647" 
                      maxNameTableCharCount="2147483647" />
        </textMessageEncoding>
        <httpTransport transferMode="Buffered" maxReceivedMessageSize="2147483647" 
                       maxBufferSize="2147483647"/>
    </binding>
</customBinding> 
```

如果您在服务上遇到许多方法的问题，这可能会有所帮助。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T03:05:12.287

没有最大值。AFAIK，您想拥有多少就拥有多少。

但是，实用与否是另外一回事。如果您在单个合约上有太多方法，它将变得非常笨拙。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T16:20:19.673

实际限制可能不超过 10-12 种方法。除此之外，您可能不再描述单个组件的操作。我会非常努力地将具有数十个操作的任何组件重构为多个组件。

就是说，我敢肯定也有例外！

# javascript - “function(){return false;}”是否有 JavaScript（或 jQuery）快捷方式？

> ID：563774
> 
> 赞同：2
> 
> 时间：2009-02-19T02:52:46.123
> 
> 标签：javascript, jquery

为了防止动作发生，我经常输入

```
function(){return false;} 
```

有捷径吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T03:26:45.323

您可以像这样声明一个命名函数：

```
function always_false() { return false; } 
```

然后`always_false()`在您之前创建匿名函数的任何地方使用。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T04:18:50.847

我经常在我的常用 js 文件的顶部定义一个[“无操作”函数：](http://en.wikipedia.org/wiki/NOP)

```
function nop() { return false } 
```

每当我需要“什么都不做”或“取消事件”处理程序（例如`div.oncontextmenu = nop`）时，我都会使用它。在 IE 中，这具有额外的好处，即在动态创建类似的 [匿名] 函数并将它们分配给事件处理程序时，内存不会泄漏。至少[IE Drip](http://www.outofhanwell.com/ieleak/index.php?title=Main_Page)是这么告诉我的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-11-27T12:46:33.590

快捷方式（*ECMAScript 2015*）：

```
_ => false 
```

或者，只需按 5 个键：

```
_=>!1 
```

但我宁愿建议您将以下内容用于非 jQuery*事件*处理程序。

```
event => event.preventDefault() 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T02:55:14.820

您可以使用 preventDefault 方法取消事件默认操作：

```
$("form").bind("submit", function(event){ 
  event.preventDefault(); 
}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T03:19:08.180

你真的觉得打字太多了吗？

为什么不将名为`f`set 的全局变量设置为`false`, 并使用`function() {return f;}`

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T11:16:32.837

只需将事件处理程序设置为 null。这比分配给“return false”函数 IMO 更干净，因为它完全删除了事件处理程序。

myButton.onclick = null;

# orm - ORM 与手工编码的数据访问层

> ID：563775
> 
> 赞同：19
> 
> 时间：2009-02-19T02:52:51.440
> 
> 标签：orm, data-access

我有点害怕问这个问题，因为它可能会引发一场宗教战争，所以我想非常清楚我在寻找什么。我正在寻找您为什么会或已经以某种方式跳跃的原因，以及要添加到我列表中的项目。我正在寻找大票，大爆炸物品。此外，如果它们确实相关，则可能是特定于产品的项目。在这一点上，我正在尝试评估 ORM 与手动，而不是产品 A 与产品 B。

ORM的优势

```
- 快速编码和低维护（在某些/大多数情况下）
 - “免费”的附加功能（无需开发人员的努力）

```

手工编码的优势

```
- 更高效（在运行时，也许不是在开发时？）
 - 更少的复杂层
 - 大多数 ORMS 似乎都在为仅限于存储过程而苦苦挣扎

```

为了全面披露，我真的不喜欢在我认为合适的情况下对*我*无法直接修改的数据库执行代码的“东西”的想法，但我可以看到 ORM 潜在的大量开发时间优势。

它可能也值得注意我在一个.Net世界

[编辑]（[Using an ORM or plain SQL?](https://stackoverflow.com/questions/494816/using-an-orm-or-plain-sql)中的问题似乎回答了许多问题并强化了关于性能的观点）

所以，稍微改变我的问题

有没有人在早期使用 ORM 构建应用程序，然后逐渐用手工编码的 DAL 代替？这种方法的缺陷是什么？

[进一步编辑——现在解决问题的核心]让一个网站能够对我的数据库执行任何 SQL 是可怕的。如果所有访问都是通过 sprocs 进行的，那么我的数据库将处于良好、安全、舒适的隔离状态。仅使用 sprocs 可以消除很多（如果不是全部）SQL 注入攻击向量。对此有何评论？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-19T03:15:15.380

我们最初使用 JPA 编写了一个应用程序，自从它投入生产之日起我们就后悔了。ORM 进行的数据库调用量是天文数字，因此我们现在已经开始使用 Spring 的 JDBC 帮助程序类使用良好的老式 JDBC 逐步重写应用程序的过程。从 ORM 开始的缺陷是我们花了很多时间学习 JPA，最终我们必须用 JDBC 替换它，这样我们的应用程序就可以更具可扩展性，而无需向我们的 Oracle RAC 添加 3 个其他节点。因此，如果您平衡它，JDBC 的控制和精度值得您编写额外的代码行。此外，大多数人不理解 SQL 不是可以生成和预期执行的东西。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-02-19T03:48:33.057

我在几个大型项目中使用过 Subsonic。我不提倡使用一个 ORM 而不是另一个，但如果没有一个，我不会做另一个与数据库相关的项目。每当我更改数据库结构时重新生成整个数据库访问层的能力，在一个地方添加影响整个数据库层的功能的能力。

问题是您必须了解它如何与数据库交互，否则您将面临编写（严重）性能不佳的代码的风险。您的 ORM 工具可能会为您提供一个很好的面向对象的数据视图，但您可能会发现您正在将整个表流式传输到客户端以进行简单的处理。该数据库擅长关联和过滤数据，因此请确保它仍然具有该工作。具有讽刺意味的是，Subsonic 缺少连接（在我使用的版本中）对此有所帮助，因为它迫使我创建数据库视图以在需要的地方组合数据。

我的一个朋友和一个开发了内部 ORM 工具的人一起工作。它有一个很好的特性，即通过遍历外键来本地缓存您可能想要从数据库中获取的所有内容。缺点是从数据库中的一行读取一列会导致超过 11,000 个选择语句。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-02-19T03:16:20.170

我已经编写和维护自己的 ORM 8 年了。它从 Java 开始，然后翻译成 C#。我无法想象没有它编写任何数据库支持的系统。它比 NHibernate 简单得多，并且没有它的所有功能，但它完成了工作，即使它广泛使用反射，它也相当快，因为​​它用 DAO 类定义上的反射替换了 XML 配置。

我对此很满意，并且不会使用任何其他方法。

编辑：关于 SQL 注入攻击：我最近使用这个 ORM 开发的一个系统经过了广泛的审计，绝对不允许注入。原因很简单：它动态生成 SQL 并*始终*使用参数，没有字符串连接。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-02-19T03:06:55.060

几周前，我开始开发一个新项目。我可以完全控制我可以使用的工具。我从 db40 开始，因为我想完全消除这个问题；我只是想直接持久化我的对象，忘记 ADO.NET 或 OR/M。但是 db40 有问题所以我不得不放弃它。

我的下一个选择是 ADO.NET，因为我认为它既快速又简单。但是我不得不编写太多代码，使用太多“字符串 sql”，这完全是一件苦差事。我的意思是，这是一个皇家 PITA，在用它编写了两个存储库后，我想割腕。

我的第三个选择是 NHibernate。在我需要使用断开连接的对象的情况下，我以前遇到过 NHibernate 的问题（这次也是这种情况，因此我花了三次尝试才达到它）。但那是 NHibernate 1.2。这次我获得了 2.0 二进制文件，并且在更新断开连接的对象时遇到了零问题。我还必须编写更少的代码行，当我需要重构事物时，它非常简单，这可能是最重要的，因为我的设计变化很快。

我现在在 NHibernate 上出售。它似乎也高度优化。老实说，我找不到它的负面影响。并且没有存储过程。

我知道这是我未来的 OR/M 选择，我再也不会直接写 ADO.NET。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-02-19T03:03:44.287

我已经为此苦苦挣扎了几年。看了很多东西。并且在过去的 3 个月中意识到“我为什么要在这上面浪费这么多时间”。我认为 ORM 是一个已解决的问题。我宁愿相信一些完全专注于 ORM 的团队来编写 ORM 层，而不是我。在精神上，我已经准备好迎接新的挑战了。

我的选择是 NHibernate。我现在真的是新手。但我也喜欢使用 Fluent NHibernate 或 Castle ACtiveRecord 的潜力。这似乎是心灵共享的地方。

但不确定在“一切都是存储过程”的世界中我会做什么。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-07-30T06:26:46.477

你试过红豆吗？在开发阶段，它流畅且易于使用，而在生产模式（冻结）中，它的速度很快。 [http://redbeanphp.com](http://redbeanphp.com)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-07-04T09:24:16.403

我认为 ORM 只是在一开始就“快速编码”，特别是如果您没有现有的已安装模式。一旦您需要开始从系统中榨取更多性能，您将需要一个可以“快速处理”的 ORM。

我发现它们是一罐蠕虫。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-19T03:49:34.333

存储过程不会消除 sql 注入的风险。可能在代码中连接查询的人很可能在存储过程中这样做。并且任何好的 ORM 都不做字符串连接，所以没有问题。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-02-19T04:08:18.093

我继承了一个使用 NHib 和 MyGeneration 创建的网络应用程序，遗憾的是没有获得 svn 存储库，并且不再具有初始模板 (arrggg)。

为创建/更新/删除后端的东西保持休眠状态，但前端（只读）有点愚蠢地实现，像一条两条腿的狗一样运行，现在正在用普通的旧 ADO.NET 重写，并且上升快 10 倍。

我并不是说这是由于 NHibernate，而是由于开发人员不知道他们通过网络发送了多少垃圾，并假设盲目使用工具意味着他们不必考虑它。

出于只读查询的目的，您通常可以使它们更有效地手动编写。

对于必须写入数据库的东西，让一个像样的 ORM 来做通常更容易，而且不会慢得多。

我个人偏爱 SubSonic，我发现它在中型项目中表现相当不错，如果你发现瓶颈，你可以手动解决它。

工具很棒，任何能给我更多周末的东西都很棒，但没有什么可以替代你耳朵之间的工具。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-27T02:59:14.910

评论您的存储过程问题。无论功能如何编写，DAL、ORM、存储过程，都会涉及到 SQL。如果您使用存储过程，您可以在里面编写 SQL，并且构建有用的抽象相对容易。如果使用 DAL，则编写 SQL，但在实践中，它更有可能是未抽象的 SQL，并增加了注入的风险。如果您使用 ORM，该工具会编写 SQL（但您最终要对它负责 - 包括可注入性）。恕我直言，移动部件（尤其是您知道和理解的部件）越少越好。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-01-13T16:29:12.653

我不得不重写使用对象数据库的生产应用程序的 DAL。我们希望同时支持对象 DB 和 sql 数据库。一些我真的不想自己实现的功能已经存在的功能

*   具有查询覆盖的透明延迟加载
*   实体身份（始终获得相同实体的相同引用）
*   插入/更新批处理
*   选择批处理（NHibernate 中的期货）
*   身份生成
*   将查询 API 转换为 sql（由于查询 API 的模块化特性，标准是完美的）

这就是为什么我选择 NHibernate 作为我很满意的 ORM。我免费获得了一些不错的功能。

*   类的自动映射（总共 3 页代码来生成整个映射）
*   LINQ 支持（曾经尝试过自己实现 LINQ-provider？）
*   免费广泛的日志记录
*   使用 inmemory sqlite 进行更轻松的单元测试
*   支持不同的数据库提供者
*   模式生成超级容易（不必为不同的数据库提供者维护任何生成脚本）
*   乐观并发
*   N/Hibernate 的文档是关系技术的一个很好的学习资源

我无法想象如何手工编写比 NHibernate 生成的性能更好的 sql。反对的一些论据：

*   当只需要很少的属性时加载整个对象 --> 总是投影到 DTO 或在 C# 3.0 中到匿名类型 (SetProjection() / Select())
*   许多选择而不是连接 -> 在需要的地方使用急切加载（SetFetchMode（）/ Fetch（））
*   调整后的 sql 总是比生成的性能更高 --> 架构优化 >> 微优化，使用 ORM 重构架构要容易得多，因为代码更少，重复逻辑更少（尝试将一对多更改为多对-许多手写的dal）

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-02-19T03:07:35.150

您不需要放弃 SPROC 或使用 nHibernate 等良好 ORM 手工制作的 SQL。

事实上，我已经替换了我的 ORM 数据访问方法，这并不难，它是两全其美的。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-02-19T03:45:37.150

我已经将 Castle Project 的 Active Record 实现与 NHibernate 一起用于个人项目。该项目从未部署，部分原因是我无法使用我所做的 ORM 选择。

我决定使用 ORM 的原因是因为我希望能够在不更改代码的情况下从 SQL Server 切换到 MYSQL。在实际项目中，我已经决定使用 SQL Server，当您知道数据库不会更改时，以传统的 3 层方式编写数据层会更容易。但对于个人项目，我使用共享主机，而 MySQL 是一个更便宜的解决方案。

我选择 Castle 的原因是它非常易于使用。使用 Visual Studio 的 activewriter 插件，我能够使用设计器（有点像 linq to SQL 设计器）生成我的类和数据库，并且它似乎很适合我关于 ORM 应该如何决定你的应用程序架构的心智模型.

我对那个 ORM 的问题是我无法找到有关如何正确优化它的信息。它正在对数据库进行非常大的调用。（当我登录时，为获取用户而生成的 SQL 查询是 1mb 的文本。）

因此，我使用 ORM，为自己节省了很多前期工作，但是当我试图解决框架生成过多 SQL 的问题时，我遇到了麻烦。（我仍在慢慢工作）。

即使我没有找到完美的解决方案，我仍然会为其他个人项目尝试 ORM，因为只有我一个人，我想把我的项目时间花在有趣的代码上，而不是数据层上。

然而，在工作中，在我成为专家之前（也许在我完成了几个正在工作的个人项目之后），我可能不会很快建议我们使用 ORM。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-04-27T02:43:37.787

好问题和好答案。我也刚刚涉足这些问题。我更喜欢像 SubSonic 这样的 ORM 来手动编码 DAL。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-04-27T03:06:42.990

好的，这是针对 PHP 应用程序，而不是 .net 应用程序，但我认为相同的品质很重要。

几年前，我重新编写了一个基于数据库的 PHP Intranet 应用程序。与许多“刚刚成长”的 PHP 应用程序一样，它没有使用任何类型的 ORM，并且有很多重复的代码，其中大部分以不同的方式组装相似的查询。

我粗略地看了一些 ORM 框架，但它们都有一个大问题：它们需要自定义它们才能在我们的结构中工作。最大的缺失组件是数据库的可扩展性。所以我写了自己的处理程序。然后继续构建我们自己的基于对象的数据层是一件简单的事情。我们也必须实现我们想要的功能，这也是我们需要的。

回想起来，这对我来说是一个非常有用的练习。这意味着我现在知道 ORM 层是如何工作的以及它们必须如何工作。它也与大量数据库扩展的趋势背道而驰，因为它把问题带到了应用程序中，即有关数据的知识所在的地方。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-07-10T21:21:13.067

只需在.Net 中使用数据集，我就非常成功。我们有一个 SOAP 端点，它将首先使用 .XSD 验证输入。然后，您可以使用规则引擎进行一些验证。然后...

如果请求是插入数据：

*   使用 DataSet 上的 GetXml() 将其转换为 XML。
*   将 XML 发送到在 SQL Server中使用[OPENXML的存储过程。](http://msdn.microsoft.com/en-us/library/aa276847(SQL.80).aspx)

如果请求是选择数据：

*   编写一个存储过程以使用多个 SELECT 语句吐出数据。
*   将该数据加载到 DataSet 中（确保在需要的地方建立“嵌套”关系）。
*   在 DataSet 上使用 GetXml() 以转换为 SOAP 中使用的 XML。

我已经在几个生产环境中成功地使用了这个过程。如果您知道您只会使用 SQL Server，它会快速而简单。

# .net - 为什么 Thread.Sleep(0) 可以解决我的问题，以及如何避免它？

> ID：563780
> 
> 赞同：9
> 
> 时间：2009-02-19T02:55:19.050
> 
> 标签：.net, multithreading

我正在开发客户端服务器应用程序。在某些时候，在某些机器上，当有超过 5 个客户端请求数据时，它似乎会达到死锁。如果我介入调试问题，那么程序似乎正在处理。只需在我知道程序正在执行的地方设置一个断点，并使其多次到达断点即可完成。如果我在代码中的某些点插入 Thread.Sleep(0)，主要是围绕一些 CPU 密集型循环，它似乎几乎可以完全解决问题。我现在遇到的一个问题是，如果我过多地调用 Thread.Sleep(0)，它会减慢代码的速度。如果我调用的不够多，代码似乎陷入了僵局。虽然我可以验证它没有陷入死锁，因为如果我进入代码，它会导致问题消失，仅仅是因为我'

有没有一种好方法可以准确追踪导致这种情况的原因。似乎它只发生在运行 Vista 的笔记本电脑上，而不会发生在运行 Windows XP 的桌面上。然而，调试是不可能的，因为仅仅单步执行代码就会导致问题消失。我读过一些评论说调用 Thread.Sleep(0) 是一种不好的做法，不应该是必要的，而且我不喜欢将巫术类型代码放入我不明白为什么必须存在的应用程序中. 任何指针将不胜感激。

[编辑]我还可以验证代码在“死锁”时是否仍在运行，因为如果我将其放置足够长的时间，它将完成，只是所需的时间要高出许多数量级。我的意思是，当它处于这种“死锁”模式时，它实际上至少慢了 100 倍。CPU 固定在 80-95%，所以它正在工作，尽管它正在做的事情超出了我的范围，因为完成任务需要很长时间。

[更多信息] 只是因为这里的每个人都坚持认为这是一个死锁，所以我删除了所有执行任何锁定的代码。只有几行代码可以进行任何锁定。线程在大多数情况下完全独立工作，因此完全移除锁定并没有太多工作。问题仍然存在。我的代码中没有更多的同步锁，没有更多的互斥锁，我看到的其他东西会导致死锁，但问题仍然存在。而且它没有陷入僵局。尽管它正在消耗所有处理器资源，但它运行起来很慢。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-02-19T03:03:34.303

Thread.Sleep(0) 是一个产量。我猜这会重新安排你打电话的方式以避免一些问题。我认为如果你发布带有 yield 的代码并在 1000 台机器上运行它，你会收到很多错误报告。我猜您需要某种类型的锁/关键部分来避免死锁，因为您的代码在某些地方不是线程安全的。那可能在您正在调用的库中。

1.  **添加日志记录，看看问题是否仍然存在。**希望你能找出导致死锁的函数
2.  **添加一些关键部分。**使用分而治之的方法，您应该能够缩小问题发生的范围。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-19T03:04:04.817

如果不查看整个代码库，这是不可能回答的。

调用 Thread.Sleep 是一种**可怕**的做法，你不应该这样做。您基本上是在改变导致死锁的代码时间，而不是从一开始就实际解决死锁条件。

调试没有显示问题的原因是，当调试器停止时，代码中的所有线程都停止了，所以这也扭曲了程序执行的时间。

您在这里要做的是在此处插入日志代码以跟踪代码在不同线程上的执行路径，并据此确定死锁在哪里。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T03:40:11.470

那个循环里面是什么？如果您将检查循环中的某些字段以同步多个线程，则可能会出现类似的问题：

```
while (_field); // waiting for _field change in another thread 
```

该解决方案运行速度非常慢，调用 Thread.Sleep(0) 不是解决方案，但在某些情况下可能是一种黑客攻击。[如果您通过调用某个同步对象（例如ManualResetEvent](http://www.google.ru/url?sa=t&source=web&ct=res&cd=2&url=http%3A%2F%2Fmsdn.microsoft.com%2Fen-us%2Flibrary%2Fsystem.threading.manualresetevent.aspx&ei=YdScSc7_AYfa0AXQ4cTZBQ&usg=AFQjCNFRYq8kgjOFEkY9pZD0JQcQQtm3GA&sig2=3c7Rn6-MAV5aUu7mvp0cWg) ）的 WaitHandle.WaitOne() 方法来更改同步循环并将信号放置在另一个线程中，则可以正确修复此问题。也许你的问题是这样的？请提供您的代码的一部分。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-02-19T04:13:27.817

当它陷入困境时，有多少并发线程正在运行？如果线程太多，CPU 可能会花费所有时间进行上下文切换。另外，您将在每个线程中咀嚼 1+ MB 的内存。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T03:44:17.277

您肯定有需要解决的线程问题。调用 thread.Sleep(0) 会导致调度程序启动。这可能使每个线程都有机会运行足够的时间以使事情正常进行。我不会把睡眠留在那儿，因为这些东西可以工作一段时间，然后一个完全不相关的变化最终会破坏事情。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-02-19T03:51:50.940

除非硬件强迫你这样做，否则你永远不应该使用 sleep()。

尝试以不同的方式思考问题。考虑需要在线程之间共享哪些数据，并考虑将数据（IE，复制它）发送给相关方而不是共享访问权限的方法。如果你做对了，你可能实际上不需要任何互斥锁......

请记住，局部变量存在于不同的堆栈中，但函数中的静态变量本质上是全局变量（当然，您需要仔细查看全局变量）。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-02-19T03:05:16.670

我认为是时候让你离开电脑，走向白板了。仔细分析每个元素是如何锁定的，以及它在什么条件下释放锁定。五个线程可能是一个难题，所以也许看看是否只有两个线程会导致相同的情况。有些东西没有正确锁定，你需要找到哪里。

除非您的代码不值得这么多努力，否则请将 Thread.sleep() 留在其中，因为从总体上看，它并不会真正损害您的性能。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-02-19T03:00:42.123

每次锁定互斥锁时尝试打印一行，解锁时打印另一行。请记住在打印时包含函数名称和线程 ID。应该让您了解它何时锁定。似乎调用 sleep(0) 的竞争条件仍会导致 CPU 使用循环处理对函数的调用。因此导致固有的睡眠。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-02-19T03:56:40.367

也许尝试使用像[Typemock Racer](http://typemock.com/learn_about_typemock_racer.html)这样的工具？

免责声明：我以前从未使用过该工具。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-02-19T04:25:37.600

是的，您可能遇到了调度程序过载。

我真诚地希望不会。

# .net - 安全、可移植的加密配置值——可能吗？

> ID：563805
> 
> 赞同：4
> 
> 时间：2009-02-19T03:07:28.100
> 
> 标签：.net, encryption, distributed, app-config

我只是好奇是否有人对此有任何好主意。

我们有很多 C# windows 服务。每个应用程序都安装在多台机器上（从 2 到 80 个，取决于应用程序。）

由于网络的安全设置，我们不能（始终）对 SQL 服务器使用 Windows 身份验证，因此我们的连接字符串和凭据具有实际的用户名和密码。

我们的基础架构人员希望在部署软件时能够做到以下几点： 1) 编辑一次配置——为各种数据库连接设置适当的服务器、用户和密码。2) 将连接字符串（至少）加密或以其他方式肉眼无法读取 3) 将该配置文件复制到特定软件的所有安装。这意味着加密不能绑定到特定的机器。

DPAPI 可以做到这一点吗？可以在所有目标上安装一组密钥以允许解密通用配置文件吗？在这种情况下如何编辑配置？您如何防止其他用户以相同的方式查看加密配置？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T03:23:54.783

DPAPI 加密将`<machineKey>`用作私钥。

选项 1）您可以在每台服务器的 machine.config 中更新它并设置`machineKey`为相同。这对服务器有广泛的影响，例如依赖于 machineKey 的无关应用程序。

选项 2）您可以覆盖`<machineKey>`web.config 中的更窄范围。

会话和加密的视图状态验证也依赖于`<machineKey>`，因此通过在服务器之间使用相同的密钥，会话和视图状态将是相互可读的。对于具有相同服务器和集中式会话存储的网络场，这可能是需要的，但这超出了原始问题的范围。

[如何：在 ASP.NET 2.0 中配置 MachineKey](http://msdn.microsoft.com/en-us/library/ms998288.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T03:16:26.767

我可以评论您问题的至少一个方面，因为我们在我工作的地方以这种方式配置了一项服务。

在编辑/创建配置时，我们将一个特殊的标记作为第一个字符：

```
<value>:secret_password</value> 
```

冒号是特殊标记。当服务启动并读取配置时，它通过查找令牌找到所有未加密的值，对它们进行加密，然后用加密的值覆盖纯文本。

因此，这允许编辑文件，同时保密。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T04:17:07.213

这听起来像是[X509 证书](http://en.wikipedia.org/wiki/X.509)的工作。

# asp.net - 即使未设置destinationpageurl，ASP.NET 登录控件也会重定向到default.aspx

> ID：563811
> 
> 赞同：2
> 
> 时间：2009-02-19T03:11:34.313
> 
> 标签：asp.net, login

我们在名为 login.aspx 的页面上有一个登录控件，该页面设置为网站的起始页。一旦用户登录，它会重定向到 default.aspx，尽管我们的destinationpageurl 没有设置为任何值。

如果我们将destinationpageurl设置为somepage.aspx，它可以正常重定向，但是如果没有设置destinationpageurl，为什么默认重定向到default.aspx。

感谢您的帮助，Animesh

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-05-13T11:23:19.530

web.config 中 authentication 标签下的[defaultUrl](http://msdn.microsoft.com/en-us/library/system.web.security.formsauthentication.defaulturl%28v=vs.110%29.aspx)自动重定向到 default.aspx 的原因。

```
<authentication mode="Forms">
  <forms 
  name="401kApp" 
  loginUrl="/login.aspx"
  cookieless="AutoDetect"
  **defaultUrl="myCustomLogin.aspx">**
  <credentials passwordFormat = "SHA1">   
     <user name="UserName" 
     password="07B7F3EE06F278DB966BE960E7CBBD103DF30CA6"/>
  </credentials>   
  </forms> 
```

如果您想重定向到其他页面而不是 default.aspx，请更改此设置。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T05:27:48.323

它只是重定向到 / 并且它实际上是基于默认文档设置服务 default.aspx 的 IIS？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T10:37:01.560

设置 cookie 需要重定向。要在 cookie 中写入任何内容（会话或任何内容），需要执行一个操作。最简单的动作是重定向。在执行重定向时，它会写入身份验证信息。

# code-generation - LLBLGen 类似于 codesmith 吗？

> ID：563815
> 
> 赞同：0
> 
> 时间：2009-02-19T03:16:04.083
> 
> 标签：code-generation

llblgen 和 codesmith 一样吗？

是否有任何工具可以为您创建所有 CRUD 管道？以及所有可以按主键过滤的表查询（如按 ID 获取用户）或按外键（如果地址表中有用户 ID，则按用户 ID 获取用户地址）等。

代码生成器做的比上述更多吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-10-24T14:18:42.347

我知道这是一个旧帖子，但以防万一其他人来这里。无论如何，不​​，它们只是不同的东西。LLBLGen 是一个对象关系映射器 (ORM)，CodeSmith 是一个代码生成工具。两者都有生成一些代码的模板，即使您可以使用 codesmith 编写 OR 映射器，它也没有 LLBLGen 具有的所有支持类。

LLBLGen 实际上是一个可以为 NHibernate、Entity Framework 或它自己的 ORM 的 LLBLGen Pro 框架生成代码的设计器。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-02-19T03:22:30.263

“llblgen 和 codesmith 一样吗？” : 在很多方面，是的。[Frans Bouma 在 SO 上很活跃，我相信他会有一些意见]

[MyGeneration](http://www.mygenerationsoftware.com/portal/default.aspx)是一个免费工具，可以创建所有 CRUD 管道。

* * *

## 回答 #3

> 赞同：-3
> 
> 时间：2009-09-02T03:13:34.607

不，不是。

CodeSmith 是一个生成工具。您仍然需要编写模板，关于它将如何生成，然后是与查询/加入/更新/插入/等相关的所有相关（和实质性）代码。

CodeSmith + NetTiers 是一个常见的“DAL”，但不是一个伟大的，恕我直言。

LLBLGen 很漂亮，而且绝对物有所值，恕我直言。

# django - 通过 login_required 装饰器转发 POST 参数的建议方法？

> ID：563819
> 
> 赞同：2
> 
> 时间：2009-02-19T03:17:37.857
> 
> 标签：django, django-forms

我目前遇到的问题是，当我在我的任何视图上使用来自 django.contrib.auth.decorators 的 login_required 装饰器时，只要装饰器重定向（到登录页面）并返回，我的 POST 参数就不会到达受保护的视图再次进入受保护的视图。关于如何解决这个问题的建议（最好保持 login_required 装饰器和 POST 方法的便利性）感谢！

[这个页面](http://code.djangoproject.com/ticket/849)似乎是关于此事的有争议的 Django 票。尽管错误/增强是根据模板与视图逻辑来构建的，而不是仅仅使视图可以访问参数，这是我的问题。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T19:44:10.930

我使用我认为可以接受的会话开发了以下解决方案。处理重定向和替换视图很棘手，这种方法似乎是在获得所需功能的同时不摆弄框架和不对抗 HTTP 协议的最佳平衡。此方法的不利方面是每个受保护视图检查会话变量所需的额外工作。

1.  创建一个自定义装饰器（`login_required2`下面的），如果用户通过身份验证，则返回请求的视图，否则返回项目的登录视图。
2.  登录视图：
    1.  将原始`POST`参数存储在会话变量中。
    2.  将原始数据存储`HTTP_REFERER`在会话变量中
    3.  如果用户正确验证，则返回与请求路径对应的视图（请求路径在整个登录过程中保持相同，并且与用户最初通过登录视图时请求的路径相同。）
3.  因此，任何受保护的视图都必须在使用请求`POST`或`META['HTTP_REFERER']`

代码如下：

```
def login_view(request):    
    from django.conf import settings
    from django.core.urlresolvers import resolve

    USERNAME_FIELD_KEY = 'username'
    PASSWORD_FIELD_KEY = 'password'

    message = '' #A message to display to the user
    error_message = '' #An error message to display to the user

    #If the request's path is not the login URL, the user did not explicitly request 
    # the login page and we assume this view is protecting another.
    protecting_a_view = request.path != settings.LOGIN_URL

    post_params_present = bool(request.POST)

    #Any POST with username and password is considered a login attempt, regardless off what other POST parameters there may be
    login_attempt = request.POST and request.POST.has_key(USERNAME_FIELD_KEY) and request.POST.has_key(PASSWORD_FIELD_KEY)

    if protecting_a_view:
        message = 'You must login for access.'
        if not request.session.has_key(ACTUAL_REFERER_KEY):
            #Store the HTTP_REFERER if not already
            request.session[ACTUAL_REFERER_KEY] = request.META.get(HTTP_REFERER_KEY)

    if protecting_a_view and post_params_present and not login_attempt: 
        #Store the POST parameters for the protected view
        request.session[FORWARDED_POST_PARAMS_KEY] = request.POST

    if login_attempt:
        form = LoginForm(request.POST)
        if form.is_valid():
            username = form.cleaned_data[USERNAME_FIELD_KEY]
            password = form.cleaned_data[PASSWORD_FIELD_KEY]
            user = auth.authenticate(username=username, password=password)
            if user is not None:
                if user.is_active:
                    auth.login(request, user)
                    if protecting_a_view:
                        actual_view, actual_args, actual_kwargs = resolve(request.path) #request.path refers to the protected view
                        return actual_view(request, *actual_args, **actual_kwargs)
                    else:
                        HttpResponseRedirect('/')
                else:
                    message = 'That account is inactive.'
            else:
                error_message = 'That username or password is incorrect.'
    else:
        form = LoginForm()

    context_dict = {
        'form': form,
        'message': message,
        'error_message': error_message,
    }
    return render_to_response2('my_app/login.html', context_dict)

@login_required2
def protected_view(request):
    post_params = {}

    if request.POST:
        post_params = request.POST
    elif request.session.has_key(FORWARDED_POST_PARAMS_KEY):
        post_params = request.session[FORWARDED_POST_PARAMS_KEY]
        del request.session[FORWARDED_POST_PARAMS_KEY]
    if post_params:
        #Process post_params as if it were request.POST here:
        pass

    #assuming this view ends with a redirect.  Otherwise could render view normally
    if request.session.has_key(ACTUAL_REFERER_KEY):
        redirect_location = request.session.get(ACTUAL_REFERER_KEY)
    elif request.META.get(HTTP_REFERER_KEY) != request.path:
        redirect_location = request.META.get(HTTP_REFERER_KEY)
    else:
        redirect_location = ROOT_PATH
    return HttpResponseRedirect(redirect_location)

def login_required2(view_func):
    """
    A decorator that checks if the request has an authenticated user.
    If so it passes the request to the view.
    Otherwise, it passes the request to the login view, which is responsible
    for recognizing that the request was originally for another page and forwarding
    state along (GET, POST).

    See django.contrib.auth.decorators for how Django's auth decorators mesh 
    using _CheckLogin.  This decorator bypasses that for my ease of creation.
    """
    def login_required_decoration(request, *args, **kwargs):
        if request.user.is_authenticated():
            return view_func(request, *args, **kwargs)
        else:
            from django.conf import settings
            from django.core.urlresolvers import resolve

            login_url = settings.LOGIN_URL
            login_view, login_args, login_kwargs = resolve(login_url)
            #Here the user gets a login view instad of the view they requested
            return login_view(request, *login_args, **login_kwargs)
    return login_required_decoration 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T03:45:12.563

没有简单的方法可以做到这一点，更不用说您想使用“login_required”装饰器这一事实。您可以执行自己的视图来检查 is_authenticated 方法并执行正确的操作，例如序列化 POST 数据并传递，但这很容易出错。

简单的解决方法是将表单更改为执行 GET 而不是 POST。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2020-03-20T17:52:45.983

这是一个相当古老的问题，但今天仍然存在需求。

根据先前答案中提供的提示，我为基于类的视图制作了以下 mixin：

```
from urllib.parse import urlparse, urlencode

from django.http import QueryDict, HttpRequest
from django.contrib.auth.mixins import AccessMixin

class loginRequiredOnPostMixin (AccessMixin):
    """
    Lets a CBV be freely accessible on GET requests, but requires login on POST.
    On redirect for unauthenticated POST requests, the POST parameters are stored in the session.
    Once the user authenticated and is redirected to the page as GET, the POST parameters are retrieved so the request can complete.
    """
    SESSION_REFERER_KEY = None
    SESSION_POST_PARAMS_KEY = None

    def get_session_referer_key(self):
        return self.SESSION_REFERER_KEY or 'POST_REDIRECT_REFERER'

    def get_session_post_params_key(self):
        return self.SESSION_POST_PARAMS_KEY or 'POST_PARAMS'

    def dispatch(self, request, *args, **kwargs):
        referer_key = self.get_session_referer_key()
        post_params_key = self.get_session_post_params_key()

        if request.method == 'POST' and bool(request.POST) and not request.user.is_authenticated:
            # save the referer url to match it later in case of GET to the same page (after login)
            if not request.session.has_key(referer_key): # so we don't overwrite previous values)
                parsed_url = urlparse(request.META.get('HTTP_REFERER'))
                request.session[referer_key] = parsed_url.path
                # save the POST params in the session
                request.session[post_params_key] = request.POST
            #redirect to login View
            return self.handle_no_permission()

        elif request.method == 'POST' and request.user.is_authenticated:
            # user logged in and rePOSTed... clean up and let the magic work on its on
            if request.session.has_key(referer_key):
                del request.session[referer_key]
            if request.session.has_key(post_params_key):
                del request.session[post_params_key]

        elif request.method == 'GET' and request.user.is_authenticated:
            print ("dispatch: GET authenticated")
            if request.session.has_key(referer_key):
                if request.session[referer_key] == request.get_full_path():
                    newRequest = HttpRequest()
                    newRequest.COOKIES = request.COOKIES
                    newRequest.META = request.META
                    newRequest.FILES = request.FILES
                    newRequest.path = request.path
                    newRequest.path_info = request.path_info
                    newRequest.method = 'POST'
                    newRequest.resolver_match = request.resolver_match
                    newRequest.content_type = request.content_type
                    newRequest.content_params = request.content_params
                    q = QueryDict(urlencode(request.session[post_params_key]))
                    newRequest.POST = q
                    newRequest.session = request.session
                    newRequest.user = request.user
                    self.request = newRequest
                    del request.session[referer_key]
                    del request.session[post_params_key]
                    return super().dispatch(newRequest, *args, **kwargs)
                # we clean up as it seems the user has moved on.
                del request.session[referer_key]
                del request.session[post_params_key]
        return super().dispatch(request, *args, **kwargs) 
```

成功登录后，它实际上会重新创建 HttpRequest 对象并将其转换为 POST 请求，然后再调用`super().dispatch(...)`

如果在 a 中使用`FormView`，请确保使用足够的 POST 数据重新创建表单，如下所示：

```
 def post(self, request, *args, **kwargs):
        form_class = self.get_form_class()
        form = self.get_form(form_class)
        return super().post(request, *args, **kwargs) 
```

为我工作。享受！

# nhibernate - 为什么我不能在 Hibernate/NHibernate 中创建子对象 - 棘手的映射问题

> ID：563822
> 
> 赞同：1
> 
> 时间：2009-02-19T03:18:36.497
> 
> 标签：nhibernate, hibernate

我想我已经尝试了一切来让它工作，但无济于事。非常感谢任何提示/帮助。

以下父子关系在创建父时导致以下错误。

无法插入：[Kanpeki.Domain.CalEvtCategory][SQL: INSERT INTO tb_calEvent_catergory（categoryID，parentID，categoryType，categoryLabel，id）值（？，？，？，？，？）]

2个对象映射如下：

父 = CalEvent

```
 <id name="id" column="id">
  <generator class="hilo"/>
</id>

<bag name="catergories" table="tb_calEvent_catergory"  lazy="false" cascade="all">
  <key column="parentID" foreign-key="id"/>
  <one-to-many class="CalEvtCatergory"/>
</bag> 
```

孩子 = CalEvtCategory

```
 <class name="CalendarCatergory" table="tb_calendar_catergory" lazy="false" >

<id name="id" column="id">
  <generator class="hilo"/>
</id>

<property name="parentID" />
snip.... 
```

它似乎没有将 calEvent 的 (parentID) id 应用于 CalendarCategory

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T22:02:19.587

听起来它可能正在尝试将 NULL 插入到子表上标记为非空的 parent_id 列中。您应该做两件事来（可能）解决您的问题。一、改变

```
<property name="parentID" /> 
```

到

```
<many-to-one name="parentID" column="parent_id_column_name_here" not-null="true" /> 
```

然后，通过将 inverse="true" 添加到父级的包中，将关系标记为反向（即子级通过 parentID 属性管理关系的状态），例如：

```
<bag name="catergories" table="tb_calEvent_catergory" inverse="true" lazy="false" cascade="all">
  <key column="parentID" foreign-key="id"/>
  <one-to-many class="CalEvtCatergory"/>
</bag> 
```

另外，我不确定包映射是否正确。具体来说，外键属性。我在文档中找不到这个。NHibernate 可能只是忽略它，但我会摆脱它。一般来说，双向的一对多映射应该如下所示：

```
<!-- Parent Table Mapping -->
...
<set name="Children" inverse="true" [(optional)cascade="all|save-update|etc"]>
    <key column="parent_id" />
    <one-to-many class="Child" />
</set>
...

<!-- Child Table Mapping -->
...
<many-to-one name="Parent" column="parent_id" not-null="true"/>
... 
```

如果不指定级联，则必须单独保存每个对象。

# python - 如何阻止 Tkinter Frame 缩小以适应其内容？

> ID：563827
> 
> 赞同：48
> 
> 时间：2009-02-19T03:21:07.833
> 
> 标签：python, label, tkinter, frame

这是给我带来麻烦的代码。

```
f = Frame(root, width=1000, bg="blue")
f.pack(fill=X, expand=True)

l = Label(f, text="hi", width=10, bg="red", fg="white")
l.pack() 
```

如果我用标签注释掉这些行，则框架以正确的宽度显示。但是，添加标签似乎会将框架缩小到标签的大小。有没有办法防止这种情况发生？

* * *

## 回答 #1

> 赞同：73
> 
> 时间：2009-02-19T19:42:43.647

默认情况下，`pack`缩小`grid`或放大小部件以适应其内容，这在 99.9% 的情况下都是您想要的。描述此功能的术语是*几何传播*。`pack`使用( `pack_propagate`) 和`grid`( )时，有一个命令可以打开或关闭几何传播`grid_propagate`。

由于您使用`pack`的语法是：

```
f.pack_propagate(0) 
```

或者`root.pack_propagate(0)`，取决于您实际想要影响的小部件。但是，由于您没有给出框架高度，它的默认高度是 1 个像素，因此您仍然可能看不到内部小部件。为了获得你想要的全部效果，你需要给包含框架一个宽度和一个高度。

话虽如此，绝大多数时候你应该让 Tkinter 计算大小。当您关闭几何传播时，您的 GUI 将无法很好地响应分辨率的变化、字体的变化等。Tkinter 的几何管理器（`pack`和`place`）`grid`非常强大。你应该学会通过使用正确的工具来利用这种力量。

# sql - 数据库字段的默认大小

> ID：563829
> 
> 赞同：8
> 
> 时间：2009-02-19T03:21:38.533
> 
> 标签：sql, database, database-design, field

您用于常见数据库字段（如名字、姓氏、电子邮件、密码等）的大小是多少？我在很多博客、论坛、电子商务等数据库中都看到了这些公共字段。但我不知道这些公共字段的大小是否有一些参考或默认值。所以，我想知道您用于选择常见字段大小的方法/参考/基础。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-19T03:31:01.443

部分取决于您的 DBMS。有些，比如 MySQL 5，关心 VARCHAR(n) 列的长度，而不是无限长度的 TEXT 列；其他人，如 PostgreSQL，认为 TEXT 和 VARCHAR(n) 在内部是相同的，除了在 VARCHAR(n) 列上检查长度。在 PostgreSQL 中写类似 VARCHAR(65536) 的东西是愚蠢的；如果您想要一个无限长度的列，请选择 TEXT 并完成它。

当然，有时尝试存储太长的值会破坏您的布局，或者允许某人通过选择没有空格的长名称来滥用系统（例如）。通常我对这样的用户名字段所做的只是选择一个较大的长度，这样任何想要更长用户名的人都会试图造成麻烦；64 个字符是一个不错的整数值，而且看起来效果很好。对于真实姓名和地址（不像用户名那样经常向用户显示），您需要使用更长的时间。您需要一个足够大的值，它可以接受任何有效的输入，但又不能大到有人可以在字段中塞入一个千兆字节长的字符串来攻击您的系统。1024 个字符是相当合理的：1k 是一个足够小的文本，可以轻松使用，是一个整数，并且比任何正常的地址行或名称都大。

~~根据我现在懒得查的相关 RFC，电子邮件地址可以不超过 320 个字符。所以有你的电子邮件字段长度。~~结果证明 SMTP 将字段长度限制为 256 个字符；由于电子邮件地址必须用括号括起来，因此最长的有效电子邮件地址实际上是 254 个字符。（[此页面](http://www.eph.co.uk/resources/email-address-length-faq/)更详细。）所以*这是*您的电子邮件字段长度。

密码***永远不***应该以明文形式存储，因此您的密码字段应该是一个字节数组或 BLOB 类型，其长度应足以存储您正在使用的哈希函数的输出（或正在使用的加密组的最大元素，对于更高级的方案，例如SRP-6a)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T03:38:23.797

我倾向于做的是考虑一个字段的值可能有多长，然后将其加倍以确保安全。

例如名称：varchar(70) 电子邮件：varchar(200)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T04:05:49.940

我喜欢 16、32、64、128 或 256

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T04:31:55.993

将您的估计翻倍。然后将它们加倍以适应 unicode。

具有 varchars 的数据库（几乎所有）都会对旨在保存更长值但不保存的字段产生非常小的惩罚。你可以利用它来发挥你的优势。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T04:36:51.973

试着反过来想一想：我已经使用现有数据来获得合理的字段长度。假设您可以访问一个充满真实数据的大型数据库，一个快速查询如下：

```
SELECT MAX(LEN(lastname)) FROM dbo.MyDatabase 
```

会给你你需要的一切。

更新：不要使用你得到的确切数字。显然，除非您有一个非常大的样本集，否则根据您的不确定性将其填充一点。

# c++ - pselect() 无法识别具有任何 IO 活动的套接字

> ID：563837
> 
> 赞同：1
> 
> 时间：2009-02-19T03:26:21.843
> 
> 标签：c++, c, sockets, posix

以下面的代码片段为例，创建套接字、侦听和接受新套接字都可以正常工作。非阻塞模式也可以工作，但是 pselect（甚至用 select 替换）没有识别 FDset 上准备好的任何 IO 请求。所以返回值总是0（超时）。

我想知道在进入 pselect() 之前是否需要进一步设置任何其他内容，以便它识别 IO 活动。

```
.....
 // Create the socket
        *m_pSockFD = socket(AF_INET, SOCK_STREAM, 0);
        if( *this->m_pSockFD == -1 ){
            throw ....
        }

        // Set the socket address information
        m_pSockAddr->sin_family = AF_INET;
        m_pSockAddr->sin_port =  htons( 6001 );
        m_pSockAddr->sin_addr.s_addr = INADDR_ANY;

        if( bind(*m_pSockFD, (struct sockaddr *) m_pSockAddr, sizeof(*m_pSockAddr) ) != 0 ){
                .....
        }

        // Listen on this socket using a block queue of 5 - default Block Size
        if( listen( *m_pSockFD, 5) != 0 )
                ........

        // change function control to non blocking file descritor for I/O operations
        long fcntlArg;
        if( (fcntlArg = fcntl( *m_pSockFD, F_GETFL, NULL ) ) < 0 ){
               ...........
        }

        fcntlArg |= O_NONBLOCK;
        if( fcntl( *m_pSockFD, F_SETFL, fcntlArg ) <0 ){
              ...........
        }

        //.........

        int newFD = -1;
        socklen_t salen = sizeof(*m_pSockAddr);

        // loop selecting for a I/O operation ready on the file descriptor then go into accept mode
        struct timespec timeOut;
        timeOut.tv_sec = 1;
        timeOut.tv_nsec = 0;

        fd_set fdset;
        FD_SET( *this->m_pSockFD, &fdset );

        while( !m_bShutDownFinished ){

            // TODO pselect is not registering the activity on the socket
            if( pselect( *this->m_pSockFD, &fdset, NULL , NULL , &timeOut,  NULL ) > 0 ){
                cout << "hello client" << endl;
                break;
            }

            // re-initialize the time struct
            timeOut.tv_sec = 1;
            timeOut.tv_nsec = 0;
        }

        // application is shutting down do not try to accept a new socket
        if( m_bShutDownFinished ) return -1;

        newFD = accept(*m_pSockFD, (struct sockaddr *) m_pSockAddr, &salen);
        if( newFD > -1 ){
            ................
        }

        return newFD; 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-02-19T05:32:20.903

您必须在每次调用之前重新初始化 fdset 参数`select()`。

`readfds`、`writefds`和中的每`exceptfds`一个都是输入/输出参数。在返回时，它们已被修改为仅用于 fds，它们分别是可读的、可写的或具有某种异常情况的。

```
for (;;) {
    fd_set rfds;
    FD_ZERO(&rfds);
    FD_SET(sock, &rfds);
    /* code to set up timeout omitted */
    n = select(sock + 1, &rfds, 0, 0, &timeout);
    /* check n, and if sock is present in rfds */
} 
```

按照您编写代码的方式，只有在第一次调用`pselect()`. 此外，鉴于您没有使用 的`sigmask`参数`pselect()`，您不妨调用`select()`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T03:59:29.770

pselect 的第一个参数应该是`*this->m_pSockFD + 1`，不是吗？

# python - 如何检查 iPython 中对象的内存使用情况？

> ID：563840
> 
> 赞同：41
> 
> 时间：2009-02-19T03:27:34.400
> 
> 标签：python, memory, ipython

我正在使用 iPython 来运行我的代码。我想知道是否有任何模块或命令可以让我检查对象的内存使用情况。例如：

```
In [1]: a = range(10000)
In [2]: %memusage a
Out[2]: 1MB 
```

类似`%memusage <object>`并返回对象使用的内存。

**复制**

> [找出 Python 中的对象正在使用多少内存](https://stackoverflow.com/questions/33978/find-out-how-much-memory-is-being-used-by-an-object-in-python)

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-02-19T13:50:09.897

不幸的是，这是不可能的，但是有很多方法可以近似答案：

1.  对于或多或少表示为简单 C 语言类型的非常简单的对象（例如整数、字符串、浮点数、双精度数），您可以像[John Mulder 的解决方案](https://stackoverflow.com/a/563921/1922357)一样简单地计算字节数。

2.  对于更复杂的对象，一个很好的近似方法是使用 cPickle.dumps 将对象序列化为字符串。字符串的长度很好地近似于存储对象所需的内存量。

解决方案 2 有一个很大的障碍，即对象通常包含对其他对象的引用。例如，字典包含字符串键和其他对象作为值。那些其他对象可能是共享的。由于pickle总是试图对对象进行完整的序列化，它总是会高估存储对象所需的内存量。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2013-03-23T19:30:46.750

如果您使用的是[numpy array](http://docs.scipy.org/doc/numpy/reference/arrays.ndarray.html)，那么您可以使用该属性`ndarray.nbytes`来评估其在内存中的大小：

```
from pylab import *   
d = array([2,3,4,5])   
d.nbytes
#Output: 32 
```

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2009-02-19T04:07:23.133

更新：这是[另一个](http://code.activestate.com/recipes/544288/)估计 python 对象大小的可能更彻底的方法。

这是一个解决类似问题 的[线程](http://mail.python.org/pipermail/python-list/2008-January/472683.html)

提出的解决方案是编写自己的...使用对已知原语大小、python 的对象开销和内置容器类型大小的一些估计。

由于代码不长，这里直接复制：

```
def sizeof(obj):
    """APPROXIMATE memory taken by some Python objects in 
    the current 32-bit CPython implementation.

    Excludes the space used by items in containers; does not
    take into account overhead of memory allocation from the
    operating system, or over-allocation by lists and dicts.
    """
    T = type(obj)
    if T is int:
        kind = "fixed"
        container = False
        size = 4
    elif T is list or T is tuple:
        kind = "variable"
        container = True
        size = 4*len(obj)
    elif T is dict:
        kind = "variable"
        container = True
        size = 144
        if len(obj) > 8:
            size += 12*(len(obj)-8)
    elif T is str:
        kind = "variable"
        container = False
        size = len(obj) + 1
    else:
        raise TypeError("don't know about this kind of object")
    if kind == "fixed":
        overhead = 8
    else: # "variable"
        overhead = 12
    if container:
        garbage_collector = 8
    else:
        garbage_collector = 0
    malloc = 8 # in most cases
    size = size + overhead + garbage_collector + malloc
    # Round to nearest multiple of 8 bytes
    x = size % 8
    if x != 0:
        size += 8-x
        size = (size + 8)
    return size 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2019-10-13T10:18:34.830

我试图弄清楚如何为自己做到这一点。我在此页面和其他页面上尝试了几种解决方案。然后我做了一些搜索，发现了[https://ipython-books.github.io/44-profiling-the-memory-usage-of-your-code-with-memory_profiler/](https://ipython-books.github.io/44-profiling-the-memory-usage-of-your-code-with-memory_profiler/)，这似乎提供了另一种解决方案。解决方案的要点：`%mprun`在 ipython 中使用。

1.  首先，安装 memory_profiler：`pip install memory_profiler`
2.  启动 ipython 并加载 memory_profiler：%load_ext memory_profiler
3.  例如，在物理文件中创建一个函数`myfunc.py`（重要：**%mprun 只能用于物理文件中定义的函数**）。在函数中创建有问题的对象，例如：

```
# myfunc.py
def myfunc():
    # create the object, e.g.
    a = [*range(10000)] 
```

4.  跑

```
from myfunc import myfunc
%mprun -T mprof -f myfunc myfunc() 
```

生成文件 mprof. 内容也显示：

```
Line #    Mem usage    Increment   Line Contents
================================================
     1     49.1 MiB     49.1 MiB   def myfunc():
     2                                 # create the object, e.g.
     3     49.4 MiB      0.3 MiB       a = [*range(10000)] 
```

根据第 3 行的内容，我们知道所使用的内存`a`为 0.3 MiB。

让我们试试`a = [*range(100000)]`：

```
# myfunc1.py
def myfunc1():
    # create the object, e.g.
    a = [*range(100000)] 
```

跑

```
from myfunc1 import myfunc1
%mprun -T mprof1 -f myfunc1 myfunc1()

Line #    Mem usage    Increment   Line Contents
================================================
     1     49.2 MiB     49.2 MiB   def myfunc1():
     2                                 # create the object, e.g.
     3     52.3 MiB      3.0 MiB       a = [*range(100000)] 
```

似乎符合我们的预期。

# html - 如何在不破坏包含元素高度的情况下在 div 中使用“float:left”？

> ID：563844
> 
> 赞同：5
> 
> 时间：2009-02-19T03:30:15.207
> 
> 标签：html, css, css-float

浮动的 HTML 元素似乎不会扩展其容器的高度。例如，考虑以下代码：

```
.portfoliosite {
    background: #777;
    padding: 10px;
    width: 550px;
}
.portfoliothumbnail {
    background: red;
    margin: 0 10px 10px 0;
    float: left;
    height: 150px;
    width: 150px;
}
```

```
<div class="portfoliosite">
    <div class="portfoliothumbnail"><!-- Img tag goes here --></div>        
    <p class="portfoliotitle">AwesomeSite.Com</p>
    <p class="portfoliodescription">An awesome site I did. It launched on Jan 1, 2009</p>        
</div>
```

注意灰色背景的包含 div 比红色 div 短，红色 div 延伸到容器边界之外。我希望包含元素扩展到其内容的大小，包括浮动元素。

是否有一个优雅的解决方案来完成这一点，最好是不涉及设置固定高度或使用 JavaScript 的解决方案？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-19T13:29:55.513

添加`overflow: auto`包含元素：

```
.portfoliosite {
    background: #777;
    padding: 10px;
    width: 550px;
    overflow: auto;
}
.portfoliothumbnail {
    background: red;
    margin: 0 10px 10px 0;
    float: left;
    height: 150px;
    width: 150px;
}
```

```
<div class="portfoliosite">
    <div class="portfoliothumbnail"><!-- Img tag goes here --></div>        
    <p class="portfoliotitle">AwesomeSite.Com</p>
    <p class="portfoliodescription">An awesome site I did. It launched on Jan 1, 2009</p>        
</div>
```

见：[http ://www.sitepoint.com/blogs/2005/02/26/simple-clearing-of-floats](http://www.sitepoint.com/blogs/2005/02/26/simple-clearing-of-floats)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-19T03:37:52.363

是的。您应该在 div 关闭时清除浮动。

```
<div>
  <div style="float:left">Floated Div</div>
  <div style="clear:both;" />
</div> 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-02-19T03:33:04.153

您需要清除浮动，这会使文档流恢复正常。在应该重置流的最后一个元素上使用`clear:left`（或右，或两者，如果需要清除此类浮动）。还阅读了[**ClearFix**](http://www.positioniseverything.net/easyclearing.html)。应该注意的是，ClearFix 在 IE 上可能会有点粘……如果你可以控制标记，有时使用传统的 clear 会更安全。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T03:33:24.963

您需要清除浮动 [清除修复](http://snipplr.com/view/489/clearfix/)

[更多信息](http://www.positioniseverything.net/easyclearing.html)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T22:43:38.287

我强烈建议不要使用像 ClearFix 这样的黑客。如果您尝试保存 <div class="clear"></div> 因为它不是“语义的”，那么您将给自己带来麻烦。最好，如果你知道你的布局不会改变，或者你可以确定下一个元素是什么，你可以使用下一个元素来清除以前的“浮动”。如果你需要一些模块化的东西，比如一段可以插入到不同地方的 HTML，那么总是添加清除 DIV。

另外关于大卫的评论：

```
<div style="clear:both;" /> 
```

请小心，因为这不是有效的 HTML 或 XHTML。尽管从 XML 的角度来看它似乎是有效的，但它不尊重文档定义（无论它被称为什么，由 DOCTYPE 标记引用）。换句话说，DIV 被定义为一个可以打开和关闭的元素，并使用单独的结束标记。例如，与 <BR/> 相反，它允许“自动关闭”。当然，Firebug 和可能的其他 Web 开发工具有时会以这种方式显示 DIV，但这就是它们显示它的方式。

PPS：在我的工作中，我发现这在某些布局中效果很好，可以在清除 IE6 和其他浏览器中的 DIV 时修复元素之间不一致的垂直间距：

跨浏览器清除：

```
div.clear { clear:both; overflow:hidden; height:0; }

<div class="clear"></div> 
```

Don't use an inline style for this, ever. First you will need it often, and second, as yo ucan see above, it may come in handy to change the clear rule to fix some cross browser troubles.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T03:34:39.750

在 Vista 上的 IE7 中渲染良好。您使用的是什么版本的 IE 和什么平台？

# asp.net-mvc - ASP.NET MVC 复杂视图

> ID：563845
> 
> 赞同：3
> 
> 时间：2009-02-19T03:31:00.727
> 
> 标签：asp.net-mvc

我对 ASP.NET MVC 中的复杂视图有疑问。我在哪里可以找到关于复杂视图以及如何在 ASP.NET MVC 中最好地创建它们的优秀示例或最佳实践信息。我知道基础知识，但是在 HTML 中添加复杂的动态 HTML 和/或 jQuery 似乎很混乱。

任何指向企业最佳实践或经验示例的链接将不胜感激。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T04:40:21.480

为了降低页面的复杂性，我发现自己正在开发 ViewUserControls 来封装包含在多个页面中的可重用功能。有时这些是通用的（如 GridControl），有时是特定的（如一组基于角色的菜单项，仅在用户授权时才包含在内）。我使用母版页来设置页面的基本轮廓，因此它对所有页面都是通用的——这包括登录/注销控件和菜单。然后，每个视图通过 RenderPartial HtmlHelper 扩展包含它需要的其他 ViewUserControl。

我注意到的另一件事是，我并没有尝试像在 WebForms 应用程序中那样对每个视图做更多的事情——动作和视图比我的许多旧 WebForms 页面更小更简单。例如，我将有一个 New 和一个 Edit 视图，每个视图都包括一个公共 ViewUserControl，其中包含表单的输入，以及一个单独的 Show 视图，它没有输入，仅与内容跨越。实际视图将相当简单，并且仅包含您会注意到的表单之间的差异。在 WebForm 中，我将拥有一个模板化的 DetailsView 控件并在一个表单中完成所有操作。

由于我正在开发我的第一个 MVC 应用程序——它是一个 Intranet 应用程序，尚未投入生产——我无法真正分享链接。我还在边走边学，但这似乎是这个应用程序的自然方向。到目前为止，我还没有真正发现标记比我开发的 WebForm 应用程序更复杂。

# iphone - 如何读取 CGBitmapContextData？（在 iPhone 上）

> ID：563850
> 
> 赞同：1
> 
> 时间：2009-02-19T03:34:02.777
> 
> 标签：iphone, image-processing, bitmap

我正在努力从图像中获取 ARGB 等位图数据。

一种）。我为图像创建了一个位图上下文：

```
context = CGBitmapContextCreate(void * data, size_t width, size_t height, size_t bitsPerComponent, size_t bytesPerRow, CGColorSpaceRef colorspace, CGBitmapInfo bitmapInfo)
```

乙）。我将图像绘制到上下文中：

```
CGContextDrawImage(context, rect, imageRef);
```

C）。然后我从位图上下文中获取数据：

```
void * data = CGBitmapContextGetData(context);
```

d)。无效...不可读？

我发现它只返回一个指向图像上下文数据的 void 指针，这意味着无法获取上下文的数据（只写）。还有其他方法可以从上下文数据中返回值吗？

PS：如果我创建一个无符号字符指针 * 数据，它将为 RGB 返回 240，为 alpha 返回 255，这不是正确的颜色分量。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-01-15T08:20:12.107

即使它的类型是 void，指针仍然可以指向图像数据。我在 iPhone 上发布了另一个相关主题： [如何从 BitmapContext 中提取 ARGB 组件？](https://stackoverflow.com/questions/561663/how-to-pull-out-the-argb-component-from-bitmapcontext-on-iphone)

而且问题已经解决了。

# java - 我应该在学习 JavaFx 之前学习 Swing 吗？

> ID：563868
> 
> 赞同：7
> 
> 时间：2009-02-19T03:45:08.790
> 
> 标签：java, javafx

如果我没有任何 UI 编程背景，那么开始学习 JavaFx 是否有意义？先学习 Swing 然后再学习 JavaFx 是否更可取？

我在 Netbeans 的 JavaFx 网站上尝试了[入门教程，代码对我来说看起来非常复杂。](http://javafx.com/docs/gettingstarted/javafx/)我想知道对于初学者 GUI 开发人员来说，JavaFx 是否太先进了。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-19T04:08:37.750

看着 JavaFX 教程，我会说：

1.  您无需了解 Swing 即可使用 JavaFX
2.  如果您发现 JavaFX 教程很难学习 Swing 将不会更容易

如果您根本没有编程背景，那么从任何语言开始都是一个挑战。如果你懂一点编程语言，那么这仍然是一个挑战。

我的建议是潜入并努力工作。一个快速的谷歌搜索（JavaFX Hello World）有很多点击...我快速浏览了[这个](http://www.dieajax.com/2007/08/23/10-minute-tutorial-javafx-hello-world/)，我会说从它开始。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T03:58:58.770

我认为知道 swing 不会让您在 JavaFX 方面占上风。JavaFX 看起来更像是脚本而不是实际的 Java 编程。您无需摇摆就可以很好地学习 JavaFX。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-06-16T10:21:23.197

据我了解，JavaFX 库没有那么多合适的 UI 组件，但由于 JavaFX 允许您使用任何 Swing 组件，因此了解 Swing 可能很有用。随着 JavaFX 的成熟，这可能会变得不那么真实。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-01-11T18:58:00.457

嗯，至少有相当多的相似之处......舞台例如相当于Java中的JFrame，场景相当于JPanel......绑定机制类似于（嗯，有点） Java中的监听器概念...

哦，JavaFX 对程序员来说不应该太复杂，因为它主要针对 Web 开发人员^^。

# javascript - 为什么jQuery在一开始就有一个“window=this”并说它会加速对window的引用？

> ID：563875
> 
> 赞同：3
> 
> 时间：2009-02-19T03:47:01.593
> 
> 标签：javascript, jquery, lexical-scope

当我打开 jQuery 的源代码时，我找到了这一行。

```
var 
// Will speed up references to window, and allows munging its name.
window = this 
```

这条线路为何以及如何加速？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-02-19T04:11:39.537

1.  [javascript函数具有词法范围](http://blogs.msdn.com/kartikb/archive/2009/01/15/lexical-scoping.aspx)
2.  jQuery 将其整个实现包装在一个[匿名函数中](http://yuiblog.com/blog/2007/06/12/module-pattern/)
3.  当所述函数开始执行时，它正在“全局”范围内执行（即`this`== `window`）。

`"window = this;"`只需在该范围内创建一个本地标识符，以便对它的引用不必在本地范围之外“冒泡”来解析。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T03:48:23.057

`this``window`与必须解析为 window 对象相比，javascript 引用会更快。

# .net - Dotnet 升级 - 2.0 到 3.5 - 性能

> ID：563881
> 
> 赞同：4
> 
> 时间：2009-02-19T03:48:52.180
> 
> 标签：.net, winforms

我们有许多用 dotnet 2.0 编写的 winforms 应用程序。在过渡到 3.5 运行时时，我们会期待任何性能升级吗？除了语言功能之外，我们还会获得什么特别的好处？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T03:51:37.447

可能会有一些小的性能改进和错误修复，但最大的好处是您可以从新语言功能中获得的改进。您还可以为您的客户端应用程序安装 .NET 客户端配置文件，它本质上是 .NET Framework 的一个子集，其中包括与客户端客户端应用程序最相关的位，这意味着下载/安装的大小更小。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-02-19T03:57:44.000

appdomain 启动时间（程序集加载）、网络、绘图和演示以及线程等等都有性能增强。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T04:03:02.193

我编写的一个简单应用程序在绘图表面上大量使用 GetPixel()，性能提高了大约 10 倍。我不能确定它是框架，因为比较是在两台机器上进行的，但它们是相似的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T04:47:30.213

实际的 3.5 框架不会对性能产生太大影响。在许多方面，它只是另一个图书馆。

不同之处在于 3.5 框架需要 CLR 2.0 SP1。SP1 有许多会影响您的应用程序的性能改进。或 2.0 SP2，如果您选择使用 3.5 SP1。

这是关于 CLR 2.0 SP2 中的一些性能改进的博客条目：http: [//blogs.msdn.com/clrcodegeneration/archive/2007/11/02/how-are-value-types-implemented-in-the- 32-bit-clr-what-has-been-done-to-improve-their-performance.aspx](http://blogs.msdn.com/clrcodegeneration/archive/2007/11/02/how-are-value-types-implemented-in-the-32-bit-clr-what-has-been-done-to-improve-their-performance.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T03:58:12.440

据我了解，从 .NET 2.0 到 3.5 的更改主要集中在 .NET 2.0 库的添加上，有点像插件包而不是新的框架版本（不是为了减少您收到的许多附加功能）。因此，我假设您只会看到极少的速度提升，可能来自对框架的微小更新。这一切都假设您坚持使用 winforms 和您当前的代码库。与往常一样，更改代码会导致完全不同的球赛！

祝你好运！

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-02-19T04:02:09.917

3.0 和 3.5 语言功能在核心 .NET 2.0 运行时上运行。它们本质上是库升级。您应该注意到性能没有差异。

# silverlight - Silverlight 3 类库

> ID：563884
> 
> 赞同：3
> 
> 时间：2009-02-19T03:49:26.343
> 
> 标签：silverlight

我目前正在从事一个 UI 开发项目，并决定在 Silvelight 中实现它。我了解 Microsoft 开发人员试图最小化分发的大小，这就是为什么不包括常规 .NET Framework 中的一些（很多）类的原因。Silverlight 3 库中是否会包含更多类？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T04:33:10.017

顺便说一句，您始终可以在核心 .NET Framework 库上使用 Reflector，以获取一些缺少的代码形式的“好有”。

这是 redgate 的反射器：[http ://www.red-gate.com/products/reflector/](http://www.red-gate.com/products/reflector/)

这是我提取和修改的[HttpUtility.ParseQueryString](http://msdn.microsoft.com/en-us/library/system.web.httputility.parsequerystring.aspx)版本的代码：

```
public IDictionary<string, string> ParseParams(string paramsString)
{
    if (string.IsNullOrEmpty(paramsString))
        throw new ArgumentNullException("paramsString");

    // convert to dictionary
    var dict = new Dictionary<string, string>();

    // remove the leading ?
    if (paramsString.StartsWith("?"))
        paramsString = paramsString.Substring(1);

    var length = paramsString.Length;

    for (var i = 0; i < length; i++) {
        var startIndex = i;
        var pivotIndex = -1;

        while (i < length) {
            char ch = paramsString[i];
            if (ch == '=') {
                if (pivotIndex < 0) {
                    pivotIndex = i;
                }
            } else if (ch == '&') {
                break;
            }
            i++;
        }

        string name;
        string value;
        if (pivotIndex >= 0) {
            name = paramsString.Substring(startIndex, pivotIndex - startIndex);
            value = paramsString.Substring(pivotIndex + 1, (i - pivotIndex) - 1);
        } else {
            name = paramsString.Substring(startIndex, i - startIndex);
            value = null;
        }

        dict.Add(UrlDecode(name), UrlDecode(value));

        // if string ends with ampersand, add another empty token
        if ((i == (length - 1)) && (paramsString[i] == '&'))
            dict.Add(null, string.Empty);
    }

    return dict;
} 
```

这只是一个示例，但正如您所见，.. 如果您真正需要的已经在 .NET BCL 中了...那么为什么要重新实现它呢？只需反编译该事物并在 Silverlight 中重新实现它。

IMO 您将要反编译的大部分内容可能是 Silverlight 中缺少的基本原版东西“非常有用”，因此我认为这不会引起任何法律问题。

当然，您可以自己重新实现查询字符串解析逻辑，但正如您所看到的那样，您可能会错过所有的小细节，更不用说性能问题了。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T04:17:26.823

我希望不会，我对此表示怀疑。

显然为微软负责该项目的 Scott Guthrie 公开表示，他不想将“nice to haves”放入其中，以防未来“必须拥有”没有空间。

我认为他们的平衡是正确的——他们没有遗漏很多你不能自己写的东西。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T04:29:21.257

Silverlight 3 无疑会扩大规模。Silverlight 3 将面向移动设备，因此毫无疑问，它的封装仍然很小。但是，人们要求很多新功能：打印、WCF 添加、3D、麦克风支持、硬件加速……毫无疑问，它会不断增长。这只是他们将其集成到核心中还是您的 XAP 文件必须变得更大的问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T03:53:37.287

.NET 框架包含大量在 Silverlight 等沙盒环境中几乎没有用处或没有用处的东西。

我不希望看到更多的标准 .NET 框架包含在 Core CLR 中，但是会有很多东西从 WPF 进入 Silverlight3。

# javascript - 有没有办法在 JavaScript 中模拟点击警报？

> ID：563890
> 
> 赞同：10
> 
> 时间：2009-02-19T03:52:50.160
> 
> 标签：javascript, alerts

我有一个带有 iframe 的页面，其源页面位于单独的域中。源页面有时会生成警报。当它这样做时，它会停止它正在做的事情，直到用户单击“确定”来发出警报。

我想做的是以编程方式在此警报上单击“确定”，以便源页面可以恢复使用。这可能吗？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-02-19T04:01:22.667

JavaScript 是单线程的，这意味着当你调用一个函数时，它会阻塞直到它返回。当您调用 alert() 时，它会将控制权传递给决定如何处理它的浏览器。弹出 UI 对话框的不是 Javascript，而是浏览器。在浏览器收到“OK”事件并返回控制权之前，alert() 不会返回。javascript 线程停止，直到发生这种情况。

因此，出于以上段落中所述的至少两个不同的原因，答案是**否定**的:)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-02-19T03:56:45.237

我很确定这是不可能的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-02-19T04:01:51.667

如果您在代码中使用 no-op 覆盖警报会发生什么？

例如

```
<script>
// uncomment next line to swallow alerts
//  function alert(nope) { return; }
<script>
<script>
  $(document).ready(function() { alert("Hello, world!"); });
</script> 
```

注释掉该行后，会出现警报。带有注释的行，警报不会出现。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-02-19T05:08:48.730

如果您知道警报的文本并且不介意弄脏，那么您应该没有问题。

你可以用你自己的覆盖 iframe 窗口的警报，并做一些事情来影响..

```
document.getElementById("InnerFrameName").contentWindow.alert = function(){
    if (arguments[0].toLowerCase() == "innerframe alert text")
        return; //supress
    else
        alert(arguments[0]);
}; 
```

编辑：我用代理处理程序做了一个小测试（它在 asp.net/c# 中，但你应该明白）......

我的测试中的外部页面是一个 w3 页面，带有一个显示警报的按钮，警报现在通过用户定义的函数传递。

我敢肯定这比你想得到的要脏得多。

页：

```
<%@ Page Language="C#" AutoEventWireup="true"  CodeFile="Default.aspx.cs" Inherits="_Default" %>

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
    <title>Hello From MyPage</title>
    <script type="text/javascript">
        function frameLoaded() {
            document.getElementById("InnerFrameName").contentWindow.alert = function() {
                if (arguments[0].toLowerCase() == "i am an alert box!!") {
                    alert("MESSAGES WOULD BE SUPRESSED: " + arguments[0]);
                    return; //supress
                } else {
                    alert(arguments[0]);
                }
            };
        }
        </script>
</head>
<body onload="alert('Hello from an unsupressed top level frame message!');">
    <form id="form1" runat="server">
            <div>
                <h1>Internal Page (Top Level)</h1>
                <hr />
                <iframe id="InnerFrameName" onload="frameLoaded();" src="PageProxy.ashx?externalURI=http://www.w3schools.com/JS/tryit_view.asp?filename=tryjs_alert"
                    style="width: 800px; height: 600px;">Derp!...</iframe>
            </div>
    </form>
</body>
</html> 
```

代理处理程序：

```
<%@ WebHandler Language="C#" Class="PageProxy" %>

using System;
using System.Web;

public class PageProxy : IHttpHandler {

    public void ProcessRequest (HttpContext context) {
            byte[] externalPage = new System.Net.WebClient().DownloadData(context.Request["externalURI"]);
            context.Response.OutputStream.Write(externalPage, 0, externalPage.Length);
            context.Response.End();
    }

    public bool IsReusable {
        get {
            return false;
        }
    }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T03:59:52.623

我对此表示高度怀疑。如果通过单独的域，您是指您无法控制的域吗？

如果您确实有控制权，则可以将警报更改为您可以控制的模态 Javascript 框。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T05:06:42.900

解决烦人的 JavaScript 问题的最佳选择是使用[Greasemonkey](http://www.greasespot.net/)之类的客户端脚本工具覆盖它。

# xml - 如何处理 XML 节点名称（硬编码值）？

> ID：563891
> 
> 赞同：0
> 
> 时间：2009-02-19T03:53:25.320
> 
> 标签：xml, language-agnostic, configuration, magic-numbers

我最近一直在使用 xml。并且注意到了一些现象（对世界其他地方来说可能没什么大不了的，但对我来说确实如此）。也许，我是个新手。但是不应该将大多数硬编码或幻数分解为配置文件吗？例如，

```
 string url = "http://www.domain.com/aDocument.xml";        
    XmlDocument feed = new XmlDocument();
    feed.Load(url);

    XmlNode errorsNode = feed.SelectSingleNode("Errors");

    if (errorsNode != null)
    {
        XmlNode error = errorsNode.FirstChild;
        lblError.Text = "Error: " + error.SelectSingleNode("Code").InnerText;
    } 
```

这是xml文档：

```
 <Errors>
    <Error>
        <Code>AWS.MissingParameters</Code>
        <Message>You are missing an parameter</Message>
    </Error>
 </Errors> 
```

如果没有硬编码“代码”或“消息”，你将如何解析它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T03:58:05.403

就像我对数字一样。我将声明具有要获取的元素名称的字符串类型的常量，然后将其传递给我的 XML 工具上的方法。

但是，您可能需要考虑从 XML 文档（或架构，如果有的话）创建一个对象表示，它将为您处理所有这些。这样，您只需将 XML 文档加载到代码中，它就会为您解析为对象表示。

然后，如果 XML 更改，您将修改生成的代码以使用新元素名称。

您想为此使用 XSD.EXE 工具。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T03:58:27.540

我不知道这是否是*最好*的选择，但我通常看到这种事情是通过使用一组字符串常量来处理的。至少，如果您在多个地方处理相同的 XML 模式，那么您的魔术字符串都定义在一个地方。我认为除非架构经常更改，否则将其降级为配置文件将是矫枉过正。

# asp.net - 如何使用 C# 代码制作一个 ASP.Net 页面，该页面将在 Sharepoint 中工作

> ID：563904
> 
> 赞同：2
> 
> 时间：2009-02-19T03:59:56.553
> 
> 标签：asp.net, sharepoint

我需要为 Sharepoint 开发一个页面。

基本上，这是一个 3 步过程，需要一些输入，获取一些数据并显示它的预览，然后允许将数据附加到电子邮件中发送出去。

我知道 ASP.Net 和 C#.Net，使用 ASP.Net 页面和 C# 代码应该很容易解决这个问题。

但是，我以前从未使用过 Sharepoint，而且我不知道要使页面“在 Sharepoint 中工作”需要什么。

**有什么特别的事情需要做才能让它在 Sharepoint 中工作吗？**ASPX 页面是解决此类问题的正确方法吗？

（我正在使用 Visual Studio 2008 在 XP 机器上进行开发。）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T04:08:25.830

您可以通过将 ASPX 页面放在 12 _layout 目录中并对 DLL 进行 GAC 来创建一个带有代码隐藏的 ASPX 页面。这不是很有趣:)

编辑：教程... [http://www.codeproject.com/KB/sharepoint/SharePoint2.aspx](http://www.codeproject.com/KB/sharepoint/SharePoint2.aspx)

再次编辑：注意到你说的是 Windows XP。SharePoint 2007 只能在 Server 2003 上运行。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T04:04:43.470

答案在这里：

[没有代码隐藏的 ASP.net 页面](https://stackoverflow.com/questions/563585/asp-net-page-without-a-codebehind)

在这里有你的答案。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T04:09:48.463

这是一个非常复杂的问题，答案很长。任何简短的回答可能只会产生更多问题。你需要[买一本像这样的书](https://rads.stackoverflow.com/amzn/click/com/0470117567)，然后从头到尾读完。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T05:07:02.663

几天前，我写了一篇文章，其中包括如何使用代码隐藏 C# 文件[在 SharePoint 中制作自定义应用程序页面。](http://furuknap.blogspot.com/2009/02/find-number-of-users-currently-logged.html)如果您只需要启动并运行该页面，请向下滚动到文章中的管理页面。

此外，[了解 SharePoint 日记的第一期涵盖了 CodePlex](http://www.understandingsharepoint.com/journal/volume-1/issue-1) [SPCurrentUsers](http://www.codeplex.com/SPCurrentUsers)项目中使用的更详细的示例。

.b

# html - HTML无序列表在IE7中很烂

> ID：563940
> 
> 赞同：0
> 
> 时间：2009-02-19T04:17:29.460
> 
> 标签：html, css

我创建了一个 HTML 有序列表，它在 FF 中看起来不错，但在 IE 中非常糟糕。我对 IE 显示列表的方式的具体问题是：

1.  缺少列表标记
2.  列表项之间的垂直间距非常不均匀

似乎上标是（2）的原因，但我不确定如何解决这个问题（不删除上标）。

**编辑：**我放弃了我的单列表梦想，并将列表分成 3 个单独的列表。我已经从上面的文字中删除了链接，以避免让未来的读者感到困惑。

谢谢，唐

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T09:27:22.413

这是 IE5、IE6 和 IE 7 中的一个已知错误。

IE 8 Beta 2 和最新的 IE 8 RC1 将正确显示您的网页。

但这些是 IE 8 之前的列表项错误列表：

[http://www.gtalbot.org/BrowserBugsSection/MSIE7Bugs/](http://www.gtalbot.org/BrowserBugsSection/MSIE7Bugs/)

[http://gtwebdev.com/workshop/gaps/white-space-bug.php](http://gtwebdev.com/workshop/gaps/white-space-bug.php)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T04:25:26.367

如果它是页面底部的列表，那么您的列表标签中有一堆空白。我不知道这是否会导致问题，但您可能想尝试消除它，看看是否有帮助。上标也可能把东西扔掉。尝试给列表本身一个 2em（或更多）的行高，看看这是否能使事情变得平衡。

**编辑**：您可能还想在列表项上使用左侧填充/边距并增加它以查看是否会带回列表标记。我不得不使用基于列表的菜单来做到这一点，以使我的菜单项以正确的对齐方式显示。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T04:27:50.887

我可以肯定地说上标是改变行高的原因。如果要强制使用常规行高，则必须将所有内容包装在表格中以防止基于流的布局。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T04:32:28.660

你能设置li elments的高度来解释上标吗？可能最好在 CSS 中做到这一点。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-02-19T04:50:36.230

正如其他人提到的那样，高度是由于上标文字。

至于子弹浮动列表项在 IE 中效果不佳。如果您打算进行三列布局，请尝试这样的操作。

```
<style type="text/css">
ul {  
  float:left;
  padding:2em;
  width:14em;
}
</style>

<ul>
 <li>col1 - item1</li>
 <li>col1 - item2</li>
 <li>col1 - item3</li>
</ul>

<ul>
 <li>col2 - item1</li>
 <li>col2 - item2</li>
 <li>col2 - item3</li>
</ul>

<ul>
 <li>col3 - item1</li>
 <li>col3 - item2</li>
 <li>col3 - item3</li>
</ul> 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-02-19T04:23:24.530

您可能会看到子弹是否正在消失，因为您将左浮动与填充耦合 - 不确定 IE 如何将子弹计数为尺寸计算的一部分。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-02-19T14:26:44.330

尝试为您的 LI 执行此操作

```
<li>text</li><li>text</li><li>text</li><li>text</li><li>text</li><li>text</li> 
```

不要添加任何换行符。这可能会解决它是愚蠢的，但这是真的。

# java - 在 Java 中，当一个接口扩展另一个接口时，为什么要在子接口中重新声明一个方法？

> ID：563952
> 
> 赞同：9
> 
> 时间：2009-02-19T04:28:48.480
> 
> 标签：java, interface

我一直在查看来自 J2EE 的 JMS API 并发现了一个奇怪的行为，其中在接口中声明的某些方法（例如，会话中的 createQueue）在子接口（例如 QueueSession）中再次声明，并且具有相同的文档。

由于子接口“继承”了它所继承的接口的所有方法声明，并且由于 JavaDoc 工具可以毫无问题地整理出子接口的 JavaDocs 并创建“继承的操作”列表，所以我无法弄清楚这实现了什么。

唯一想到的是，最初调用是在 Session 中，然后在创建特定子类时移到 QueueSession，尽管那时我希望在上层类的文档中看到一些东西。但这只是猜测。

所以问题是：在子接口中重新声明方法是否有令人信服的理由？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-02-19T05:24:52.293

在为 Sun 工作时偶尔会看到这种情况，我可以告诉你它通常是如何发生的。有人用一些方法定义了一个接口，比如说 Alice；许多开发人员实现了该接口。

一段时间后，他们意识到他们需要一些其他接口，称为 Bob，它具有 Alice 的方法的子集，以便允许它作为*另一个*接口 Clara 的基本接口。

如果将 Alice 的方法移到 Bob 中，就会破坏所有实现 Alice 的代码；您必须返回并至少重新编译一大堆代码，其中一些您可能不拥有，并且出于政治原因不能破坏。

所以你没有。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-02-19T23:00:15.097

在 Java 5 中，您可以通过使其更具体来更改覆盖方法的返回类型。更常见的是文档不同，因此必须再次声明该方法。

但是，如果方法和文档相同，则不需要它。但是，您会看到大量并非严格需要的代码。有可能它曾经被需要，但有些东西被改变了，所以不再需要它。很可能从来不需要它，而是因为开发人员认为需要做某事，而实际上并没有很好的基础。

顺便说一句：不同的人对需要什么或方便拥有或更好地明确表达有不同的看法。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-02-19T04:43:53.280

我从来没有看到一个很好的理由。我见过的最好的是：

*   它可以清楚地表明它是什么，而无需看到父母
*   它使更改类扩展的内容变得更容易，而无需弄清楚它应该实现哪些接口

我不喜欢这两个建议。我认为可能的原因是，在编写代码时，接口是在抽象类之前编写的，开发人员没有费心去删除重复的实现。

永远不要低估开发人员的懒惰:-)

最后，除了在类加载时，加载具有重复接口的类可能需要一段不明显的时间之外，没有造成任何伤害。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T06:25:26.610

我会说不，没有理由这样做。不过，我可以想象在某些代码的演变过程中可能会以几种方式发生这种情况。采用现有接口并从中拉出较小的超级接口的情况并不少见。在这种情况下，我可以想象离开现有的界面，而只是将其更改为从新界面扩展。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-02-19T05:12:22.497

我知道的唯一原因是扩大方法的可见性（即从受保护的克隆到公共），但这里似乎并非如此。

# wpf - 设置 IsCheckable 似乎可以防止子菜单出现

> ID：563954
> 
> 赞同：0
> 
> 时间：2009-02-19T04:30:10.677
> 
> 标签：wpf, data-binding, xaml

我正在尝试将 IsChecked 绑定到我正在显示的对象上的 Selected DependancyProperty，此代码似乎可以工作，但如果我使用它，子菜单不会显示。这是正确的方法吗？我该如何解决这个问题？

```
<MenuItem Header="Window" Name="windowMenu" ItemsSource="{Binding}">
    <MenuItem.ItemContainerStyle>
        <Style>
             <Setter Property="MenuItem.IsChecked" Value="{Binding Path=Selected}" />
             <Setter Property="MenuItem.IsCheckable" Value="true" />
        </Style>
    </MenuItem.ItemContainerStyle>
</MenuItem> 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-02-19T04:37:27.337

快速测试表明，如果 MenuItem 的 IsCheckable 属性设置为 True，它将不会显示其子项。

```
 <Menu>
        <MenuItem Header="File">
            <MenuItem Header="Exit" />
        </MenuItem>
        <MenuItem Header="Tools">
            <MenuItem Header="Options" IsCheckable="True">
                <MenuItem Header="one" IsCheckable="True" />
                <MenuItem Header="two" IsCheckable="True" />
            </MenuItem>
        </MenuItem>
    </Menu> 
```

在上面的示例中，Options 将没有子项显示。

编辑：这种情况的原因是，从用户体验的角度来看，这不是一个真正有意义的案例。我能想到的唯一情况是检查一个检查其所有子项目的项目，但我想你最好使用复选框。

重新定义 ControlTemplate 无疑是一种选择。Blend 通常可以告诉你它的默认控件模板是什么，你可以从那里开始。

# iphone - iPhone + CGAffineTransFormRotate(pi/2) + statusBarHidden:YES + presentModalViewController = 20 像素的空白

> ID：563956
> 
> 赞同：2
> 
> 时间：2009-02-19T04:31:17.227
> 
> 标签：iphone, cocoa-touch, core-graphics

我认为标题非常具有描述性：

我在一个视图上执行了所有这 3 个操作，结果是屏幕左侧有 20 个像素的空白区域（如果拿着 iPhone 是 LandscapeLeft）。

我试图通过执行 CGAffineTransFormTranslate(transform, -20, 0) 来修复它

这只是将视图“滑动”到空白下方。

这开始感觉像一个错误，其他人有这个问题吗？

为了澄清，我没有轮换任何观点。我正在感应设备的方向：

```
[[UIDevice currentDevice] orientation] 
```

如果设备（不是界面）是横向的，那么：

```
[navigationController presentModalViewController:NewView animated:NO] 
```

转换是在显示之前将我的视图（在 IB 中创建）旋转到横向。

我的转换代码：

```
 CGRect myFrame = CGRectMake(0, 0, 480, 320);
    CGAffineTransform transform = [[self.myPeriodicTableViewController view] transform];
    transform = CGAffineTransformRotate(transform, degreesToRadians(rotationDirection * 90));
    transform =  CGAffineTransformTranslate(transform, -20, 0);
    [[self.myPeriodicTableViewController view] setFrame: myFrame];
    CGPoint center = CGPointMake(myFrame.size.height/2.0, myFrame.size.width/2.0);
    [[self.myPeriodicTableViewController view] setTransform: transform];
    [[self.myPeriodicTableViewController view] setCenter: center]; 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T05:08:44.250

我认为您可能需要重新调整您的中心：

```
// Set the center point of the view to the center point of the window's content area.      
self.view.center = CGPointMake(160.0, 240.0); 
```

这是我用于横向视图的整个初始化方法，并且没有问题。只需确保将您的笔尖也设置为正确的尺寸。

```
// Implement viewDidLoad to do additional setup after loading the view.
- (void)viewDidLoad {
  [super viewDidLoad];

  // Rotate to landscape
  self.view.frame = CGRectMake(0, 0, 480.0, 320.0);
  if ([[UIApplication sharedApplication] statusBarOrientation] == UIInterfaceOrientationLandscapeRight) {
    CGAffineTransform transform = self.view.transform;

    // Set the center point of the view to the center point of the window's content area.      
    self.view.center = CGPointMake(160.0, 240.0);

    // Rotate the view 90 degrees around its new center point.
    transform = CGAffineTransformRotate(transform, (M_PI / 2.0));
    self.view.transform = transform;
  }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-20T03:29:40.800

好的，我想通了。像往常一样，这是多于 1 个问题的结果。这些问题都发生在我推送模态视图之前：

首先，在我的代码中，我正在调整视图的大小，如下所示：

```
[self.view setFrame: [[UIScreen mainScreen] applicationFrame]]; 
```

隐藏状态栏后，applicationFrame STILL 返回一个 320x460 矩形（不是 320x480）。不知道为什么，但以下解决了它：

```
[self.view setFrame: [[UIScreen mainScreen] bounds]]; 
```

这得到了我从中提取的整个屏幕：

[全屏 UIView，顶部有状态栏和导航栏覆盖](https://stackoverflow.com/questions/373791/fullscreen-uiview-with-status-bar-and-navigation-bar-overlay-on-the-top)

其次，在同一行代码中，我不是在与正确的 viewController 交谈。由于我在一个基于导航的应用程序中，我必须与 NavigationController 交谈。如果没有，导航栏永远不会收到消息移动到屏幕顶部以覆盖状态栏留下的空间（这导致了我的空白）。所以对这行代码再做一次更正：

```
 [[self.navigationController view] setFrame: [[UIScreen mainScreen] bounds]]; 
```

最后，在这一切之后，我可以自信地推动我的模态视图。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-09-24T20:50:22.917

这些都不适合我。DID 工作如下：我在 ViewController.h 文件中声明了一个（全局）变量

```
CGRect                  contentRect; 
```

在我的 ViewController.m 中的 viewDidLoad 方法中，我像这样初始化它：

```
contentRect = self.view.frame; 
```

然后，要解雇选择器，我使用

```
 [self dismissModalViewControllerAnimated:YES]; // Or any other command 
  [self.view setFrame:contentRect]; // ta-da! all set back to normal. 
```

# .net - Fluent NHibernate：如何将 db 整数映射到日期时间列？

> ID：563969
> 
> 赞同：0
> 
> 时间：2009-02-19T04:38:31.203
> 
> 标签：.net, nhibernate, fluent-nhibernate

我有一堂课

```
public class Site {
  public DateTime SiteMonth {get; set;}
} 
```

在数据库中，SiteMonth 表示为 yyyymm 格式的整数。

有没有办法在 NHibernate 中映射它而不在我的 Site 类上引入新属性？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T05:27:45.640

是的 - 制作一个简单`IUserType`的整数格式和日期时间之间的映射。然后将元素`type`上的属性设置为该用户类型的。`property``AssemblyQualifiedName`

Ayende 有一个关于如何实现用户类型的[示例。](http://ayende.com/Blog/archive/2008/07/31/Entities-dependencies-best-practices.aspx)

哦，是的，如果您使用 Fluent NHibernate 进行映射，您可以这样做：

```
Map(d => d.MyFunkyWeirdLegacyDateTime)
    .SetAttribute("type", typeof(MyCustomDateTime).AssemblyQualifiedName); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T06:53:24.110

我刚刚在 Fluent NHibernate Wiki 中遇到了[这个](http://wiki.fluentnhibernate.org/show/AutoMappingTypeConventions)，它在 AutoMapping 约定中，但在 Fluent Mapping Conventions 部分中提到 AutoMapping Conventions 也适用于 Fluent Mapping。

# svn - 如何从我的 SVN 存储库中提取一个子树到一个新的？

> ID：563970
> 
> 赞同：8
> 
> 时间：2009-02-19T04:38:43.857
> 
> 标签：svn, system-administration

我们有一个 Subversion 存储库，其中一个目录是：

*   真的不需要超出 RCS 能力的版本控制
*   未与存储库中的任何其他内容一起进行版本控制
*   修改频率大约是存储库其余部分的六倍

虽然我知道高修订号不是问题，但我还是想将这个单一目录从我的主存储库中拉出，并放入第二个，理想情况下是新的。

最好的过程是什么？如果有所不同，SVN 存储库托管在（...检查...）FreeBSD 机器上。

值得注意的是，虽然我需要在新存储库中保留版本历史记录，但无需删除旧存储库中的内容；它可以坐在那里，我只关心它。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-02-19T05:38:13.870

你可以使用*svnadmin dump*和*svnadmin load*从原来的仓库创建一个新的仓库；然后将不适合您的方案的目录复制到更好的位置，然后删除其他所有内容。在原始存储库中，您只需删除不合适的目录。这样可以保持所有历史记录完好无损，您最终会得到两个存储库。

可能有一种方法可以随后从历史中无用的部分（*svndumpfilter*）中清除两个存储库，但由于硬盘空间非常便宜，我认为这没有必要。无论如何，[SVN 文档](http://svnbook.red-bean.com/en/1.1/ch05s03.html#svn-ch-5-sect-3.5)有关于它的所有信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2018-04-30T21:04:28.577

推荐的方法是使用，然后使用该工具`svnadmin dump`过滤转储文件（请参阅[svnbook](http://svnbook.red-bean.com/en/1.7/svn.reposadmin.maint.html#svn.reposadmin.maint.filtering)）。`svndumpfilter`

例如，我有一个名为“Model”的顶级目录的仓库，我想将其移至自己的仓库：

```
svnadmin dump my_orig_repo | svndumpfilter include --drop-empty-revs --renumber-revs Model >model_only.svndump
svnadmin load my_model_repo < model_only.svndump 
```

这将创建仅包含 Model 子目录的新存储库。

要从原始存储库中删除它，您只需执行`svn rm`. 这将从最新版本的 repo 中删除它，并且是最简单的方法。

但是，如果我的示例中的 Model 目录非常大，那么我可能希望将其完全从原始目录中删除。我可以通过重复该过程来创建另一个过滤的 svn 转储文件来*排除*它。然后我会用没有排除目录的新目录替换原来的目录。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-02-19T04:54:05.253

我会导出（而不是签出）目录，将其导入新的存储库，然后将其从原始存储库中删除（当然，日志消息会指示它的去向；-)。

这可能是也可能不是“最好”的方法......

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-02-19T06:04:57.330

我不知道我是否理解正确，但有一个很好的解决方案。如果您的原始存储库位于 svn://domain，并且您经常使用的文件夹称为“文件夹”，我相信您可以简单地执行以下命令：`svn co svn://domain/folder`仅签出该文件夹。

# mysql - MySQL操作有速度差异吗？

> ID：563971
> 
> 赞同：1
> 
> 时间：2009-02-19T04:39:04.713
> 
> 标签：mysql

我在讨论 MySQL 语句的速度，有人问我：在 SELECT、INSERT、UPDATE 和 DELETE 之间，哪个更快，为什么？

我不知道答案。有谁知道一个是否比另一个快，如果是，为什么？还是它们通常都具有相同的速度？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-02-19T05:16:28.647

主要是“这取决于”。

例如，如果数据库为大量并发用户提供服务，那么锁定表的时间量将比查询总时间量更重要。

根据经验，我会说：

INSERT 通常最快，因为它只添加数据并且不需要锁定表，因为没有修改现有数据。不过，许多索引可能会减慢它的速度。

SELECT 可能非常快或非常慢。这取决于查询。它有可能是最快的，而且它不会锁表。但是 SELECT 操作通常比其他操作复杂得多，从多个表中获取数据，或者更全面地排序或使用索引。

DELETE 比较慢。需要锁定表（或取决于存储引擎，受影响的行）。索引需要更新。

UPDATE 通常是最慢的。需要锁定表（或取决于存储引擎，受影响的行），需要更新索引，并且它比 DELETE 稍微复杂一些。

但正如我所说，这都是经验法则，而且很大程度上取决于具体情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-19T04:47:05.177

我不确定每个命令是否单独，但很大程度上取决于实际语句。在表上拥有索引需要在插入、更新和删除时修改索引。虽然索引可能会使选择更快，但它会减慢任何数据修改语句。除此之外，查询的复杂性、列的数据类型、任何 sql 函数（如聚合）都会改变查询的性能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-02-19T05:19:10.683

你没有问正确的问题。例如，SELECT 必须以某种方式计算与选择匹配的所有行的集合，然后通过某种机制返回它们，这些机制可能是来自像 sqlite 之类的大屁股动态数组中的任何东西（因为它在内存中并在同一过程中）通过互联网远程传递的数据。

因此，例如，`SELECT * FROM USERDATA`在本地返回 10 行可能需要几微秒，但如果它通过 WAN 返回 10,000,000 行则需要几分钟。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-02-19T05:24:50.983

假设简单的查询和常见的使用场景和配置，SELECT 将是最快的，因为它们最容易被缓存（通过 CPU、磁盘、操作系统、MySQL 内存和 MySQL 查询缓存）和最频繁执行（允许所述缓存有用）。

所有其他操作都是写入，这更耗时且无法缓存。即使是简单的写入查询的运行时间通常也高度依赖于服务器的读取负载（SELECT 查询）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T05:41:55.233

数据库查询的速度只能真正衡量为**相对于彼此**。对于大多数*简单*的查询，它只是以毫秒为单位的名义差异。

更好的问题应该从“你影响了多少事情？”的角度来看。

*   查询可以采用多种形式，但如果您从 3 个表中进行选择，它可能会比 2 个表慢。
*   使用 LIMIT 将有助于在所有情况下更快地执行查询
*   如果正确使用索引，则可以帮助查询
*   更新索引需要时间
*   更大的桌子需要更多的时间来完成

清单还在继续，但通常我会在事后建立并处理慢点。无论如何，大多数人并没有真正努力推动他们的数据库:)

# vba - 使用 VBA 将控件添加到 Excel 用户窗体中的框架

> ID：563972
> 
> 赞同：14
> 
> 时间：2009-02-19T04:39:39.157
> 
> 标签：vba, excel, userform

我需要动态创建标签和按钮，然后将它们添加到用户窗体中的框架中。我该怎么做呢？似乎它*应该*比实际上更容易。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-02-25T18:33:16.923

以下代码演示了如何使用控件动态填充用户窗体中的框架...

在我使用的表单中，我有一个名为 Frame1 的框架控件，因此在 UserForm_Initialize 中调用 Frame1.Controls.Add 以在框架中嵌入一个控件。您可以设置返回到您在 UserForm 代码模块中定义的 WithEvents 控件变量的控件，以便您可以响应任何您想要的控件上的事件...

因此，使用这种方法，您需要为您创建的任何控件预先编写所需的任何事件代码......

另请注意，即使 top、left、width 和 height 属性不一定出现在智能感知中，您也可以定位和调整控件的大小......

```
Private WithEvents Cmd As MSForms.CommandButton
Private WithEvents Lbl As MSForms.Label

Private Sub UserForm_Initialize()
    Set Lbl = Frame1.Controls.Add("Forms.Label.1", "lbl1")
    Lbl.Caption = "Foo"
    Set Cmd = Frame1.Controls.Add("Forms.CommandButton.1", "cmd1")
End Sub

Private Sub Cmd_Click()
    Cmd.Top = Cmd.Top + 5
End Sub

Private Sub Lbl_Click()
    Lbl.Top = Lbl.Top + 5
End Sub 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-08-06T10:15:53.783

我对上述主题的变体。不过，这仅适用于 4x4 按钮阵列。创建一个用户表单并将其添加到其代码中。您的标签可以使用相同的概念（或参见上一个答案）：

```
Private cmdLots(20) As MSForms.CommandButton

Private Sub UserForm_Initialize()
For i = 1 To 4
For j = 1 To 4
    k = i + (4 * j)
    Set cmdLots(k) = UserForm2.Controls.Add("Forms.CommandButton.1", "cmd1")
    With cmdLots(k)
        .Top = i * 25
        .Left = (j * 80) - 50
        .BackColor = RGB(50 * i, 50 * j, 0)
        .Caption = "i= " & i & "  j= " & j
    End With
Next j
Next i
End Sub 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2020-11-10T20:22:56.077

## `Add`方法_

要将控件添加到用户窗体或框架，请使用该[`add`](https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/add-method-microsoft-forms)方法。

`SetControl = object.Add(ProgID [, Name [, Visible ]] )`

第一个参数将引用您要添加的控件类型，它`ProgID`被定义为

> 程序化标识符。标识对象类的不带空格的文本字符串。ProgID 的标准语法是... ProgID 映射到类标识符 (CLSID)。

## 功能性解决方案

为了使这个过程更容易，让我们使用枚举来帮助我们管理各种控件。

```
' List of all the MSForms Controls.
Public Enum MSFormControls
    CheckBox
    ComboBox
    CommandButton
    Frame
    Image
    Label
    ListBox
    MultiPage
    OptionButton
    ScrollBar
    SpinButton
    TabStrip
    TextBox
    ToggleButton
End Enum 
```

有了这个枚举，我们现在可以轻松地创建一个函数来获取所有控件的 ProgID 字符串。

```
' Gets the ProgID for each individual control. Used to create controls using `Object.add` method.
' @see https://docs.microsoft.com/en-us/office/vba/language/reference/user-interface-help/add-method-microsoft-forms
Public Function GetMSFormsProgID(control As MSFormControls) As String
    Select Case control
      Case MSFormControls.CheckBox:       GetMSFormsProgID = "Forms.CheckBox.1"
      Case MSFormControls.ComboBox:       GetMSFormsProgID = "Forms.ComboBox.1"
      Case MSFormControls.CommandButton:  GetMSFormsProgID = "Forms.CommandButton.1"
      Case MSFormControls.Frame:          GetMSFormsProgID = "Forms.Frame.1"
      Case MSFormControls.Image:          GetMSFormsProgID = "Forms.Image.1"
      Case MSFormControls.Label:          GetMSFormsProgID = "Forms.Label.1"
      Case MSFormControls.ListBox:        GetMSFormsProgID = "Forms.ListBox.1"
      Case MSFormControls.MultiPage:      GetMSFormsProgID = "Forms.MultiPage.1"
      Case MSFormControls.OptionButton:   GetMSFormsProgID = "Forms.OptionButton.1"
      Case MSFormControls.ScrollBar:      GetMSFormsProgID = "Forms.ScrollBar.1"
      Case MSFormControls.SpinButton:     GetMSFormsProgID = "Forms.SpinButton.1"
      Case MSFormControls.TabStrip:       GetMSFormsProgID = "Forms.TabStrip.1"
      Case MSFormControls.TextBox:        GetMSFormsProgID = "Forms.TextBox.1"
      Case MSFormControls.ToggleButton:   GetMSFormsProgID = "Forms.ToggleButton.1"
    End Select
End Function 
```

最后，让我们创建一个使用我们的新函数添加到表单或框架的函数。

```
' Easly add control to userform or a frame.
' @returns {MSForms.control} The control that was created
Public Function AddControl(userformOrFrame As Object _
                         , control As MSFormControls _
                         , Optional name As String = vbNullString _
                         , Optional visable As Boolean = True _
                        ) As MSForms.control
    Set AddControl = userformOrFrame.Controls.Add(GetMSFormsProgID(control), name, visable)
End Function 
```

像这样使用枚举的美妙之处在于，我们现在对所有控件都有了智能感知，而不必全部记住它们。

[![演示智能感知](https://i.stack.imgur.com/RN1hn.png)](https://i.stack.imgur.com/RN1hn.png)

## 演示

为了演示它，我们可以通过循环枚举将每个控件添加到空白用户窗体。

```
Private Sub UserForm_Initialize()
    demoAddingControlsToUserform
End Sub

Private Sub demoAddingControlsToUserform()
    ' Offset used to prevent controls
    ' overlapping as well as provide
    ' a height for the scrollbars
    Dim offsetHeight As Double

    ' Add each control to the userform
    ' and set top to make sure they are not overlapping
    ' (Although this looks odd, you can actually loop enums this way.)
    Dim control As MSFormControls
    For control = CheckBox To ToggleButton
        With AddControl(Me, control)
            .Top = offsetHeight
            offsetHeight = offsetHeight + .Height
        End With
    Next

    ' Show scrollbars and adjust the height to show
    ' all the added controls.
    With Me
        .ScrollBars = fmScrollBarsVertical
        .ScrollHeight = offsetHeight + 20
    End With
End Sub 
```

[![带有所有控件的演示用户表单](https://i.stack.imgur.com/j3qRj.png)](https://i.stack.imgur.com/j3qRj.png)

# sharepoint - 如何以编程方式从 SharePoint 网站检索以前版本的母版页？

> ID：563975
> 
> 赞同：1
> 
> 时间：2009-02-19T04:42:05.703
> 
> 标签：sharepoint, wss, sharepoint-2007

在 SharePoint 网站中，当您签出/修改/签入母版页时，以前版本的母版页会保留在 SharePoint 中，并且您可以在母版页库中看到以前版本的*列表*。在我看来，查看以前版本*内容*的唯一方法是恢复该版本 - 然而，这将在版本历史记录中创建一个额外的条目，这不是一个真正的新版本，而只是一个人工制品*查看*以前的版本。

`stsadm`我最终找到了一种使用该实用程序查看以前版本的蛮力方法：

```
stsadm -o export -url http://site -fileneme export.cab -versions 4 
```

然后在`manifest.xml`cab中查找文件，然后在cab中找到指向相关`.dat`文件的指针，以查看所需的先前版本。现在这种“解决方案”对于大型网站来说显然是有问题的，因为导出操作会导出整个网站内容。

所以这是我的问题......如果`stsadm -o export`可以提取以前版本的文件，我猜有一些方法可以通过 SharePoint API 以编程方式执行此操作。有谁知道这是否/如何可能。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T07:16:04.833

也许您在[SPFileVersion](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.spfileversion.aspx)类之后。来自 SPFile 对象的版本属性。

另请参见[SPListItemVersion](http://msdn.microsoft.com/en-us/library/microsoft.sharepoint.splistitemversion.aspx)类。

您应该能够像获得任何其他列表一样获得母版页画廊。

```
SPList masterPageGal = myWeb.Site.RootWeb.Lists["Master Page Gallery"]; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T05:03:03.057

`SPFileVersion`课堂确实是前进的方向。这是一段代码，它将把以前版本的 default.master 页面导出到文件系统。不过要注意的一件事是导出`versions[0]`不起作用-尝试调用时会产生异常`ver.OpenBinary`。我怀疑这与 SharePoint 中的整个重影/非重影问题有关，即文件的原始版本与后续版本的存储方式不同。*为添加*到母版页库的其他文件运行此代码，在检索`versions[0]`. 这似乎只是原始未自定义 SharePoint 网站中的文件的问题。

```
 SPFile file;
    SPFileVersionCollection versions;
    SPFileVersion ver;
    byte[] content;
    FileStream fs;
    SPSite site = new SPSite("http://localhost:6000");

    file = site.RootWeb.GetFile("_catalogs/masterpage/default.master");
    Console.WriteLine(file.Url + ", " + file.Length);
    versions = file.Versions;
    Console.WriteLine(versions.Count);

    for (int i = 1; i < versions.Count; i++)
    {
        ver = versions[i];
        Console.WriteLine(ver.VersionLabel + ", " + ver.Size);
        content = ver.OpenBinary();
        fs = new FileStream("c:\\temp\\" + ver.VersionLabel + "-default.master",FileMode.Create);
        fs.Write(content, 0, content.Length);
        fs.Close();
    } 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-08-15T04:37:52.693

如果有人感兴趣，这是上面代码的 powershell 版本：

```
function ExportVersions([string] $webUrl, [string]$spfilepath, [string]$filePath)
{
  $web = $null
  try
  {
    $web = get-spweb $webUrl
    $file = $web.GetFile($spfilepath)
    Write-host "Url: " $file.Url 
    Write-host "length: " $file.Length
    Write-host "Number of versions: " $file.Versions.Count
    Write-host
    foreach ($version in $file.Versions)
    {
        Write-Host "Version: " $version.VersionLabel
        Write-Host "Size: " $version.Size
        $content = $version.OpenBinary()
        $spFileName = [System.IO.Path]::GetFileName($spfilepath)
        $outFileName = $filePath + $version.VersionLabel + "-$spFileName"
        $fs = new-object System.IO.FileStream($outFileName,[System.IO.FileMode]::Create)
        $fs.Write($content,0,$content.Length)
        $fs.Close()
    }

    $out = "Finished exporting versions for: " + $spfilepath
    Write-Host $out
    Write-Host

  }
  catch
  {
    throw $_
  }
  finally
  {
    # Clean up
    $web.Close()
  }
} 
```

# asp.net-mvc - 我的 JSON 字符串在我的 Action 中应该是什么样的？

> ID：563981
> 
> 赞同：2
> 
> 时间：2009-02-19T04:48:21.587
> 
> 标签：asp.net-mvc, json, actionresult

在 .NET MVC 中，我的操作如下所示：

```
public ActionResult TestAjax(string testID)
{

    return Content(@"{first: ""1"", second : ""2""}");
} 
```

在我的 JavaScript 中，我正在做：

```
function(data)
{
      alert(data.first);
} 
```

我得到`[object Object]`了输出，这是为什么呢？

我的 JSON 字符串错了吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T04:52:27.677

让系统处理它怎么样：

```
 public ActionResult TestAjax(string testID)
    {
        return Json(new {first = 1, second = 2});
    } 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-02-19T04:52:05.757

你想用 Json 而不是 Content 做一个回报

```
return Json(new { first = "1", second ="2" }); 
```

# c# - 使用属性来避免无效的输入参数

> ID：563989
> 
> 赞同：1
> 
> 时间：2009-02-19T04:52:18.613
> 
> 标签：c#, attributes

我有一个将 Int 作为输入的方法

公共无效GetMonth（int Month）{}

现在，当我调用此方法时，我想确保当有人输入不在 1-12 之间的数字时，编译器会生成错误消息。

例如

obj.GetMonth(14)--这里应该报错，不编译

可能吗 ？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-02-19T04:55:22.130

这将是 4.0 中的一个功能，这要归功于[code-contracts](http://blogs.msdn.com/bclteam/archive/2008/11/11/introduction-to-code-contracts-melitta-andersen.aspx)，它允许您准确地声明它。但尚未。您需要在运行时有验证代码：

```
if(month < 1 || month > 12) throw new ArgumentOutOfRangeException("month"); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-02-20T00:01:34.013

也许通过使用[**Microsoft.Build.Utilities.Task**](http://msdn.microsoft.com/en-us/library/microsoft.build.utilities.task.aspx)但这听起来像是艰巨的任务。
此类可以帮助**生成构建时错误**。
但真正**困难的部分是进行代码分析**以决定何时需要停止构建。

# c++ - 用于 DOM 的 Gecko API

> ID：563996
> 
> 赞同：4
> 
> 时间：2009-02-19T04:57:16.183
> 
> 标签：c++, browser, webbrowser-control, gecko

Gecko 是否公开了直接使用其 DOM 的 API？我正在寻找一个像 HtmlElement 这样的类，它可以用来构建/遍历 HTML 内容的树。

我正在尝试将 Gecko 作为桌面应用程序中的 Web 浏览器控件托管，并且更喜欢直接 API 而不是通过 COM。谢谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-02-19T17:18:46.320

是的，几乎所有与 DOM 相关的类都[通过 XPCOM 公开](http://www.xulplanet.com/references/xpcomref/)。事实上，我相信 Gecko 的全部功能都是通过这种方式暴露出来的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-10-09T19:20:04.840

grayfade：虽然您的答案在技术上是正确的，但我发现壁虎 DOM API 非常难以找到，因为所有基于 javascript 的答案都以更高的优先级不断出现！

XPCOM 也很难理解，因为它在功能上与 COM 几乎 90% 相同。

你真的很想进入 mozilla 开发平台新闻组并问这个问题：你更有可能从那里得到答案，因为实际上从 c++ 使用 XPCOM 的人往往会聚集在该新闻组周围。

l.

# c++ - 用于 DOM 的 WebKit API

> ID：563997
> 
> 赞同：10
> 
> 时间：2009-02-19T04:58:25.087
> 
> 标签：c++, browser, webkit, webbrowser-control

WebKit 是否公开了直接使用其 DOM 的 API？我正在寻找一个像 HtmlElement 这样的类，它可以用来构建/遍历 HTML 内容的树。

我正在尝试将 WebKit 作为桌面应用程序中的 Web 浏览器控件托管，并且更喜欢直接 API 而不是通过 COM。谢谢！

谢谢！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-12-10T21:54:44.767

使用 QT/WebKit（至少 4.6 版）现在可以访问已加载文档的 DOM。

[QtWebKit 模块参考](http://qt-project.org/doc/qt-4.8/qtwebkit.html)

[DOM 遍历示例](http://qt-project.org/doc/qt-4.8/webkit-domtraversal.html)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-02-19T09:26:48.670

以下 URL 为您提供了一些有趣的答案。

[WebKIT API 在哪里？](http://ubuntuforums.org/showthread.php?t=901305)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-10-09T18:50:37.153

通过各种 DOM 包装器，您的选项数量有限。PyWebkitQt 真的很垃圾；Objective-C 仅在 MacOSX 上可用（并且再次受限且不完整）；COM 仅在 Windows 上可用；GObject one*仍在*开发中，尽管 2008 年创建的第一个版本比现在 webkit 主线源代码中的实际版本更好，功能更完整；还有一些 c++ 绑定，但我没有评估它们。然后当然还有 Javascript 绑定和 google V8 javascript 绑定（是的，它们是分开的），但这些仅在“浏览器内”可用。

这几乎让 pythonwebkit 项目 - [http://www.gnu.org/software/pythonwebkit](http://www.gnu.org/software/pythonwebkit) - 作为唯一的非基于 javascript 的 DOM 操作 API，它实际上旨在完全符合事实上的标准，使 python 真正成为涉及 DOM 操作的 JavaScript。

# c# - 在 xml 文件中搜索数据的最佳方法？

> ID：563998
> 
> 赞同：2
> 
> 时间：2009-02-19T04:59:10.827
> 
> 标签：c#, asp.net, xml, search, .net-2.0

在我们的新项目中，我们必须提供搜索功能来从数百个 xml 文件中检索数据。我在下面简要介绍了我们目前的计划，我想知道您对此的建议/改进。

这些 xml 文件包含个人信息，搜索基于其中的 10 个元素，例如姓氏、名字、电子邮件等。我们当前的计划是创建一个包含所有可搜索数据和实际文件密钥的主 XmlDocument。这样当用户搜索数据时，我们首先查看主文件并获得结果。我们还将缓存来自最近搜索的实际 xml 文件，以便以后可以快速处理类似的搜索。

我们的应用程序是一个 .net 2.0 Web 应用程序。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-02-19T05:02:29.413

第一：xml文件有多大？`XmlDocument`不能扩展到“巨大”......但可以处理“大”OK。

第二：您是否可以将数据放入常规数据库结构（可能是 SQL Server Express Edition）中，对其进行索引，并通过常规 TSQL 进行访问？这通常会胜过 xpath 搜索。同样，如果它是结构化的，SQL Server 2005 及更高版本支持`xml`数据类型，它会*分解*数据 - 这允许您在数据库中索引和查询 xml 数据，而无需将整个 DOM 放在内存中（它将 xpath 转换为关系查询）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-02-19T05:02:45.420

如果您可以将数据存储在 SQL Server 数据库中，那么您可以在内置的 XPath 查询功能中使用 SQL Server。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-02-19T05:03:42.767

嗯，听起来您在 Xml 之上构建了一个数据库，为了提高性能，我会将这些文件读入您​​选择的数据库，并让它处理索引和搜索。如果这不是一个选项，请真正使用 XPath，或者使用 XmlReader 滚动您自己的详尽搜索。

Xml 并不是所有问题的答案，无论它看起来多么干净，性能都会很糟糕。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-02-19T15:26:13.613

索引您的 XML 文件。查看[http://incubator.apache.org/lucene.net/](http://incubator.apache.org/lucene.net/)

我最近在我以前的工作中使用它来缓存我们的 SQL 数据库，以实现快速搜索和很少的开销。

它提供了对 xml 文件中内容的快速搜索（完全取决于您组织缓存的方式）。

使用起来非常简单直接。

比尝试遍历一堆文件要容易得多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-02-19T05:04:51.343

为什么不将可搜索数据存储在带有实际文件密钥的数据库表中？所以你的搜索将在数据库表而不是 xml 文件上。我想这会更快，因为您可以索引表以便更快地搜索。***********