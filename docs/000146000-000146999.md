# StackOverflow 问答 000146000-000146999

# java - 使 Eclipse 表现得像 Visual Studio

> ID：146020
> 
> 赞同：59
> 
> 时间：2008-09-28T14:53:56.990
> 
> 标签：java, android, eclipse, visual-studio, ide

我正在做一些 Android 开发，我更喜欢 Visual Studio，但我必须使用*Eclipse*。

有没有人制作了一个可以让*Eclipse*看起来和行为更像 Visual Studio 的工具？我主要无法忍受它关于我应该如何编程的**clippyesqe**建议（是的，我知道我还没有使用那个私有字段！感谢 Eclipse！），或者它令人难以置信的糟糕**intellisense**。

例如，在 Eclipse 中，如果我不`this`先键入，它的**智能感知**将不会意识到我要查找本地范围的成员。此外，完成 VS 约定的 TAB 已深入我的脑海，而*Eclipse*是 ENTER 完成，我可以手动切换所有内容，但这需要几个小时，我希望有人有某种主题或已经完成它的东西.

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-28T15:27:02.043

Java IDE 还有其他选择。您显然已经找到了 Eclipse，但您可能还想查看[IntelliJ](http://www.jetbrains.com/idea/index.html)和[NetBeans](http://www.netbeans.org/)。IntelliJ 不是免费的，但有 30 天的评估期和 Visual Studio 键映射 :)

货比三家，找到一个你喜欢的并开始大量使用它。它们都是非常好的 IDE，我敢肯定，一旦您使用了一段时间，您就会对它感到满意。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2008-09-28T15:14:18.673

您是否尝试过使用 Eclipse Ganymede (3.4) 中可用的 Visual Studio 键绑定？

（您可能想知道“IntelliSense”是 Visual Studio 的一个术语，没有 Visual Studio 经验的任何人都可能不知道。“自动完成”可能是一个更广泛使用的术语。）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-28T17:49:47.567

如果您开始键入在当前范围内可见的任何类/变量的名称并按 Ctrl+Space，它将关闭自动完成功能。

默认情况下，tab 用于移动自动完成的函数调用参数。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-12-16T22:59:17.610

我要在这里扮演魔鬼代言人，并说强迫你使用`this.myString`实际上比仅仅安全得多`myString`。`myString`可以在本地（在方法中）或在类中定义为私有成员。我有时认为 Visual Studio 对此有点漫不经心。在您提到的示例中（我看到了视频，但它难以辨认）`myString`范围在哪里？

# objective-c - 为什么我编译的（小）Objective-C 文件的一半是一大块零？

> ID：146025
> 
> 赞同：3
> 
> 时间：2008-09-28T14:55:04.493
> 
> 标签：objective-c, file-format

我在文本编辑器中打开了我编译的 Hello World Obj-C 应用程序，令我惊讶的是，我发现了大约 8 KB 的 00 00 00 00 00 00 00 00 ...。

这些为什么会在这里？有没有办法清除这些零（我怀疑它有*太多*功能）？

显然它在*这个*文件中并不那么重要，因为它开始只有 16kB，但我还是想知道。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-28T15:05:38.587

它很可能是您使用的可执行格式的代码、数据、重定位或其他部分之间的填充。

链接器喜欢在 4k 或 8k 边界上填充这些部分。这以一些内存浪费为代价提高了加载时间。

对于一个简单的 hello world，它很重要，但对于大型应用程序，用于填充的额外内存可以忽略不计。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-28T14:56:46.360

Objective-C 是否支持增量链接？这可以解释为什么有很多填充空间。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T14:57:38.357

一些编译器或链接器需要一些文件大小的整数。您可以看到，当您添加一些代码时，文件大小并没有增加。我想这就是你看到的零。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2008-09-28T19:04:35.343

也许它是一个静态变量？我知道在许多类 C 语言中，声明为静态的变量的初始值嵌入在编译器发出的代码中。在运行时，这个初始值被映射到进程的内存。也许您（或您包含或链接的某些代码）定义了一个 8 KB 的零初始化数组。

# algorithm - 近排序算法 - 何时使用？

> ID：146038
> 
> 赞同：8
> 
> 时间：2008-09-28T15:02:52.163
> 
> 标签：algorithm, language-agnostic, sorting

我不时浏览网络并寻找有趣的算法和数据结构来放入我的技巧包中。一年前，我遇到了[Soft Heap](http://en.wikipedia.org/wiki/Soft_heap)数据结构并了解了近似排序。

这背后的想法是，如果您可以接受排序算法作弊的事实，则可以打破基于比较的排序的 O(n log n) 障碍。你得到一个几乎排序的列表，但你也必须忍受一些错误。

我在测试环境中玩弄了这些算法，但从未找到它们的用途。

所以问题是：有没有人在实践中使用过近似排序？如果是在哪种应用程序中？你能想出一个用例，其中接近排序是正确的做法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-28T17:18:48.767

这是一个完全的猜测，但考虑到对搜索结果进行排序时“相关性”度量的固有主观性，我敢说它们是否被完美排序并不重要。建议也是如此。如果您可以以某种方式将这些算法的其他所有部分安排为 O(n)，那么您可能会避免排序。

还要注意，在最坏的情况下，您的“接近排序”数据*不*符合“接近排序”的一种可能的直观概念，即它只有少量反转。这样做的原因只是，如果您的数据只有 O(n) 次反转，那么您可以使用插入排序或鸡尾酒排序（即双向冒泡排序）在 O(n) 时间内完成对它的排序。因此，您不可能在 O(n) 时间内（使用比较）从完全未排序的情况下达到这一点。因此，您正在寻找对大部分数据子集进行排序而其余数据分散的应用程序，*而不是*要求每个元素都靠近其正确位置的应用程序。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-29T05:00:28.890

有很多“贪婪”启发式方法，您可以定期选择一组中的最小值。贪心启发式并不完美，因此即使您选择最小值，也不能保证获得最佳最终答案。实际上，在[GRASP](http://en.wikipedia.org/wiki/Grasp)元启发式算法中，您有意引入随机误差，以便获得多个最终解决方案并选择最佳的一个。在这种情况下，在您的排序例程中引入一些错误以换取速度将是一个很好的权衡。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-29T03:11:30.883

只是在这里推测，但我想象的一件事是数据库查询优化。

使用诸如 SQL 之类的声明性语言的数据库查询必须被翻译成称为“执行计划”的分步程序。一个 SQL 查询通常可以转换为许多这样的执行计划，它们都给出相同的结果，但性能可能会有很大差异。查询优化器必须找到最快的，或者至少是相当快的。

基于成本的查询优化器有一个“成本函数”，他们用它来估计给定计划的执行时间。详尽的优化器遍历所有可能的计划（对于“所有可能”的某些值）并选择最快的计划。对于复杂的查询，可能的计划数量可能非常大，导致优化时间过长（甚至在您开始在数据库中搜索之前！）所以也有非详尽的优化器。他们只看一些计划，可能在选择哪些计划时带有随机因素。这是可行的，因为通常有大量的“好”计划，而找到绝对最佳的计划可能并不那么重要——选择一个 5 秒的计划而不是最佳的 2 秒计划可能会更好,

一些优化算法使用“有希望”（部分）计划的排序队列。如果您找到绝对最佳的计划并不重要，也许您可​​以使用几乎排序的队列？

另一个想法（我仍然只是推测）是分时系统中进程或线程的调度程序，如果某个进程或线程比严格按优先级排序晚几毫秒获得它的时隙，这可能并不重要.

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-05-27T04:46:29.793

近似排序的一个常见应用是当人类进行成对比较并且您不想问他们很多问题时。

假设您有很多项目希望人类通过成对比较进行排序。如果您愿意接受排序不准确，则可以大大减少需要他们进行的比较次数。例如，您可能不关心相邻的项目是否已交换，只要首选项目位于顶部即可。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T03:27:58.520

任何地方

1.  你应该快速反应，
2.  您没有向客户承诺确切的行为，
3.  但在内部你有一些规则

你可以使用它。“不那么严格”的基于规则的优先级队列怎么样？这在哪里有用？也许是线程/进程/资源调度。在线程/进程调度中，您真的不保证任何一个线程会先行、第二行或最后一行，但通常您希望给每个人一些机会。你可能想强制执行宽松的规则，所以它是先发制人的，优先的，blabla ..

资源计划示例是响应披萨交付或向人们运送书箱等。您不能在预期结果确定的情况下使用它，但在现实生活中存在很多事情不是那么确定/可预测的示例。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2011-04-28T07:05:52.837

O(n log n) 已经非常快了。我认为没有人会*开始*使用近似排序算法。您将从只进行完整排序的代码开始（因为您选择的编程语言可能提供`sort`函数而不是`nearsort`函数），当您凭经验发现排序花费的时间太长时，您会开始质疑您的数据是否*确实*需要完全排序，并考虑使用近似排序。

Basically, you would never even consider using a near sort unless you first discovered sorting to be a severe bottleneck in your program.

# emacs - Emacs：您如何将用户提供的最后一个参数存储为默认值？

> ID：146081
> 
> 赞同：8
> 
> 时间：2008-09-28T15:22:46.953
> 
> 标签：emacs, lisp, elisp

我正在编写一个交互式函数，我想记住用户提供的最后一个参数并将其用作默认值。

```
(defun run-rake (param)
  (interactive "sTask: ")
  (shell-command (format "rake %s" task))) 
```

第一次调用该函数时，我希望它记住用户提供的参数，以便下次他们调用该函数时，他们只需按 Enter 键，它将使用他们上次提供的值。

我似乎在文档中找不到这个 - 你如何在 elisp 中做到这一点？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-29T19:52:57.623

```
read-from-minibuffer 
```

是你想要使用的。它有一个历史变量的位置。

这是一些示例代码：

```
(defvar run-rake-history nil "History for run-rake")
(defun run-rake (cmd)
(interactive (list (read-from-minibuffer "Task: " (car run-rake-history) nil nil 'run-rake-history)))
  (shell-command (format "rake %s " cmd))) 
```

显然可以根据您的需求进行定制。'run-rake-history 只是一个变量，用于存储此调用 'read-from-minibuffer 的历史记录。另一种选择是使用 'completing-read - 但假设您有一个要限制用户使用的选项列表（对于类似 shell 的命令通常不是这种情况）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-09-28T16:22:15.717

您可以看到该`compile`命令是如何执行此操作的。用 调出编译命令的帮助文本`C-h f compile`，将光标移到包含函数的文件名上，然后点击`RETURN`。这将调出`compile`.

基本上，有一个动态/全局变量`compile-command`保存最后一个编译命令。Emacs 是一个单用户、单线程系统，所以真的不需要更多。还要记住，Elisp 是一个非常古老的 Lisp，变量具有动态（调用堆栈）范围，而不是词法范围。在这种系统中，很自然地：

```
(let ((compile-command "gcc -o foo foo.c frobnicate.c"))
     ...
     (compile)
     ...) 
```

说到`compile`命令，你有没有试过用它来代替你自己的`run-rake`函数？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T15:55:14.067

我想出了如何使用 defvar（全局）手动执行此操作，但这感觉就像核心库应该已经提供的那种东西（有点像方案的 make-parameter）。这看起来像是更多的代码，并且比它应该的更多手动：

```
(defvar *editconf-ruby-run-rake-last-rake-task* nil)

(defun editconf-ruby-run-rake-last-rake-task (&optional new-val)
  (when new-val
    (setf *editconf-ruby-run-rake-last-rake-task* new-val))
  *editconf-ruby-run-rake-last-rake-task*)

(defun editconf-ruby-run-rake (task-name)
  "Execute rake `task-name'.  See                                                                                            
`krb-ruby-get-rakefile-path-for-current-buffer' for how the                                                                  
Rakefile is located.."
  (interactive
   (let* ((rakefile (krb-ruby-get-rakefile-path-for-current-buffer))
          (rake-tasks (krb-ruby-get-rake-tasks rakefile))
          (default-task (or (editconf-ruby-run-rake-last-rake-task)
                            (editconf-ruby-run-rake-last-rake-task (car rake-tasks)))))
     (list
      (read-string (format "Task [%s|%s]: "
                           rake-tasks
                           default-task)
                   nil nil default-task))))
  (editconf-ruby-run-rake-last-rake-task task-name)
  (let ((cmd (format "cd %s; rake %s"
                     (krb-lisp-strip-path-suffix rakefile 1)
                     task-name)))
    (message "editconf-ruby-run-rake: cmd='%s'" cmd)
    (shell-command cmd))) 
```

# database - 在 RDBMS 中存储完整的图

> ID：146093
> 
> 赞同：1
> 
> 时间：2008-09-28T15:30:44.657
> 
> 标签：database, graph-theory

我有几种类型的实体，每种都有自己的字段，它们存储在单独的表中。
这种表中的每条记录可以连接到不同表中的零个或多个记录，即链接到来自不同实体类型的记录。
如果我使用查找表，我会得到 (m(m-1))/2=O(m^2) 需要初始化的单独查找表。
虽然对于 6 或 7 种不同的实体类型仍然可行，但它仍然适用于 50 多种此类类型吗？
特别是，给定的记录需要与大多数其他实体类型有链接，所以从理论上讲，我将处理一个几乎完整的、无向的 n 边图。
任何人都可以阐明如何将这种结构存储在关系 DBMS 中吗？
（如果重要的话，我正在使用 Postgresql，但其他 DBMS 的任何解决方案都同样有帮助）。
感谢您的时间！

尤瓦尔

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-28T15:33:02.717

这是对象关系映射，一个经典的难题。你真的需要一个 ORM 工具来正确地做到这一点，否则它会让你发疯。

您提到的连接问题是陷阱之一，它需要非常仔细的优化和查询调整，否则会影响性能（例如 N+1 SELECT 问题）。

在不知道您的应用程序平台是什么的情况下，我无法更具体 - 实际使用的 DBMS 与问题并不真正相关。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-28T16:05:44.120

您可以为所有实体类型使用一个通用的基本类型，并通过该基本类型处理关系——这几乎是任何 ORM 工具都可以使用鉴别器列和外键关系来完成的事情（不过，我不熟悉 CLSA）。

这种方法只为您留下一个关系表。

*编辑：* 这就是你设置它的方式：

```
CREATE TABLE base (
  id int(10) unsigned NOT NULL auto_increment,
  type enum('type1','type2') NOT NULL,
  PRIMARY KEY  (id)
);

CREATE TABLE type1 (
  id int(10) unsigned NOT NULL,
  PRIMARY KEY  (id),
  CONSTRAINT FK_type1_1 FOREIGN KEY (id) REFERENCES base (id)
);

CREATE TABLE type2 (
  id int(10) unsigned NOT NULL,
  PRIMARY KEY  (id),
  CONSTRAINT FK_type2_1 FOREIGN KEY (id) REFERENCES base (id)
);

CREATE TABLE x_relations (
  from_id int(10) unsigned NOT NULL,
  to_id int(10) unsigned NOT NULL,
  PRIMARY KEY  (from_id,to_id),
  KEY FK_x_relations_2 (to_id),
  CONSTRAINT FK_x_relations_1 FOREIGN KEY (from_id) REFERENCES base (id),
  CONSTRAINT FK_x_relations_2 FOREIGN KEY (to_id) REFERENCES base (id) 
  ON DELETE CASCADE ON UPDATE CASCADE
); 
```

请注意鉴别器列 ( `type`)，它将帮助您的 ORM 解决方案为行 (`type1`或`type2`) 找到正确的子类型。ORM 文档应该有一节介绍如何使用基表映射多态性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T15:39:05.057

另一种选择是使用[面向对象的数据库](http://en.wikipedia.org/wiki/Comparison_of_object_database_management_systems)，例如 db40 或 Cache。如果性能不是一个大问题并且您决定存储整个对象图，它可能会对此进行研究。

# web-services - 用于序列化 Web 服务调用的 Weblogic 插件

> ID：146097
> 
> 赞同：0
> 
> 时间：2008-09-28T15:32:37.180
> 
> 标签：web-services, weblogic

是否有一个预构建的工具可以与 BEA/Oracle Weblogic 10.0 集成并在数据库表上跟踪对服务器公开的 Web 服务的每次调用？

更新：目标**不是**调试 Web 服务（它们运行良好）。目标是使用现有的附加组件**跟踪表上的每个调用。**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-11-06T15:19:47.307

不确定是否有附加组件，但您可以编写一个处理程序（从 javax.xml.rpc.handler.GenericHandler 扩展），您可以在其中编写逻辑来检查（如果您愿意，还可以操作）请求、响应和故障（如果发生）。您可以检测远程 ip、远程用户等，然后对它们做任何您想做的事情（即将它们记录到磁盘、控制台、数据库等）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T15:40:30.140

是的，一个远程调试器，几乎与任何现代 IDE 一样。将其附加到正在运行的应用程序服务器，在 web 服务入口点处设置断点，然后执行它。

# windows - 是否可以以编程方式更改用户的屏幕保护程序和/或桌面背景？

> ID：146100
> 
> 赞同：8
> 
> 时间：2008-09-28T15:35:11.027
> 
> 标签：windows, wallpaper

我被要求对公司中每个人使用的屏幕保护程序和桌面背景进行标准化，除了单独访问每台 PC 之外，我还在寻找一种程序化的方式来实现这一点。我不是系统管理员，所以以前从未跨过这座桥。还值得注意的是，大多数 PC 运行的是 Windows XP，但有些是 Windows Server 2003，有些是 Vista。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-28T15:39:49.737

为什么不只使用[组策略](http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/prork/prdb_cdk_ugxd.mspx?mfr=true)？

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-28T15:37:56.323

[在 C# 中更改屏幕保护程序](http://www.codeproject.com/KB/cs/ScreenSaverControl.aspx)

[在 VB.net 中更改桌面](http://www.dotnetspider.com/resources/19517-change-wallpaper-using-vb-net.aspx)

# css - 我应该如何组织我的 CSS 文件的内容？

> ID：146106
> 
> 赞同：84
> 
> 时间：2008-09-28T15:37:51.677
> 
> 标签：css

这个问题是关于在 .css 文件中组织实际的 CSS 指令本身。在开发一个新页面或一组页面时，我通常只是手动将指令添加到 .css 文件中，并在可能的情况下尝试重构。一段时间后，我有数百（或数千）行，并且在调整布局时很难找到我需要的东西。

有人对如何组织指令有建议吗？

*   我应该尝试自顶向下组织，模仿 DOM 吗？
*   我是否应该在功能上进行组织，将支持 UI 相同部分的元素指令放在一起？
*   我应该按选择器按字母顺序对所有内容进行排序吗？
*   这些方法的某种组合？

此外，在将其拆分为单独的文件之前，我应该在一个文件中保留多少 CSS 是否有限制？比如说，1000 行？或者将整个东西放在一个地方总是一个好主意？

相关问题：[组织 CSS 规则的最佳方式是什么？](http://web.archive.org/web/20170119044450/http://stackoverflow.com:80/questions/72911/whats-the-best-way-to-organize-css-rules)

* * *

## 回答 #1

> 赞同：55
> 
> 时间：2008-09-28T20:39:38.440

看看这三个幻灯片演示开始：

*   [漂亮的可维护 CSS](http://www.slideshare.net/lachlanhardy/beautiful-maintainable-css)
*   [可维护的 CSS](http://www.slideshare.net/stephenhay/maintainable-css-presentation)
*   [高效、可维护、模块化的 CSS](http://www.slideshare.net/maxdesign/efficient-maintainable-css-presentation)

首先，也是最重要的，记录你的 CSS。无论你用什么方法来组织你的 CSS，都要保持一致并记录下来。在每个文件的顶部描述该文件中的内容，可能提供目录，可能引用易于搜索的唯一标签，以便您在编辑器中轻松跳转到这些部分。

如果您想将 CSS 拆分为多个文件，请务必这样做。Oli 已经提到额外的 HTTP 请求可能很昂贵，但您可以两全其美。使用某种构建脚本将您的文档齐全的模块化 CSS 发布到压缩的单个 CSS 文件中。[YUI Compressor](https://yui.github.io/yuicompressor/)可以帮助压缩。

与迄今为止其他人所说的相比，我更喜欢将每个属性写在单独的行上，并使用缩进来对相关规则进行分组。例如，按照 Oli 的示例：

```
#content {
    /* css */
}
    #content div {
        /* css */
    }
    #content span {
        /* css */
    }
    #content etc {
        /* css */
    }

#header {
    /* css */
}
    #header etc {
        /* css */
    } 
```

这使得遵循文件结构变得容易，特别是在组之间有足够的空白和清晰标记的注释，（尽管不那么容易快速浏览）并且易于编辑（因为您不必费力地阅读单行长 CSS每个规则）。

理解并使用[级联](http://reference.sitepoint.com/css/cascade)和[特异性](http://www.stuffandnonsense.co.uk/archives/css_specificity_wars.html)（因此按字母顺序对选择器进行排序是正确的）。

我是否将我的 CSS 拆分为多个文件，以及在哪些文件中取决于站点和 CSS 的大小和复杂性。我总是至少有一个[`reset.css`](https://meyerweb.com/eric/tools/css/reset/). 如果站点导航菜单变得有点复杂，并且如果我有大量的 CSS 来设置表单样式，那么这往往伴随着`layout.css`一般的页面布局。除此之外，我自己也在想办法。我可能需要分离颜色/图形和排版，为所有 HTML 标签提供完整的基本样式......`nav.css``forms.css``colors.css``type.css/fonts.css``base.css`

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2008-09-28T17:39:03.427

我倾向于像这样组织我的CSS：

1.  重置.css
2.  base.css：我设置页面主要部分的布局
    1.  一般风格
    2.  标题
    3.  导航
    4.  内容
    5.  页脚
3.  附加-[页面名称].css：仅在一页中使用的类

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2013-04-09T11:34:46.340

有许多公认的格式化 CSS 的方法。最终取决于你自己觉得写什么最舒服，但这些将有助于管理你的 CSS 以应对更大更复杂的项目。*这并不重要，但我倾向于结合使用 BEM 和 SMACSS。*

# [BEM（块、元素、修改器）](http://getbem.com/)

BEM 是一种非常有用、强大且简单的命名约定，它使您的前端代码更易于阅读和理解、更易于使用、更易于扩展、更健壮、更明确且更严格。

### 堵塞

本身就有意义的独立实体，例如：

```
header, container, menu, checkbox, input 
```

### 元素

块的一部分，没有独立的意义。它们在语义上与其块相关：

```
menu item, list item, checkbox caption, header title 
```

### 修饰符

块或元素上的标志。使用它们来改变外观或行为：

```
disabled, highlighted, checked, fixed, size big, color yellow 
```

* * *

# [OOCSS](https://www.smashingmagazine.com/2011/12/an-introduction-to-object-oriented-css-oocss/)

> OOCSS 的目的是鼓励代码重用，并最终促进更容易添加和维护的更快、更高效的样式表。

OOCSS 基于两个主要原则：

1.  **结构与皮肤分离**

> 这意味着将重复的视觉特征（如背景和边框样式）定义为单独的“皮肤”，您可以将其与各种对象混合搭配，无需太多代码即可实现大量视觉变化。查看模块对象及其外观。

2.  **容器和内容的分离**

> 本质上，这意味着“很少使用与位置相关的样式”。一个物体无论放在哪里都应该是一样的。因此，不要使用 .myObject h2 {...} 设置特定的样式，而是创建并应用一个描述相关问题的类，例如 . 这使您可以保证：（1）所有未分类的 s 看起来都一样；(2) 类别类（称为 mixin）的所有元素看起来都一样；和 3) 当您确实希望 .myObject h2 看起来像正常的 .myObject h2 时，您不需要为这种情况创建覆盖样式。

* * *

# [SMACSS](http://www.smacss.com)

> SMACSS 是一种检查您的设计过程的方法，也是一种将这些刚性框架融入灵活思维过程的方法。它试图记录使用 CSS 时网站开发的一致方法。
> 
> SMACSS 的核心是分类。通过对 CSS 规则进行分类，我们开始看到模式，并且可以围绕这些模式中的每一个定义更好的实践。

有五种类别：

```
/* Base */

/* Layout */

/* Modules */

/* State */

/* Theme */ 
```

**Base** 包含重置和默认元素样式。它还可以具有控件的基本样式，例如按钮、网格等，稍后在特定情况下可以在文档中覆盖这些样式。

**布局** 将包含所有导航、面包屑、站点地图等。

**模块** 包含特定区域的样式，例如联系表格样式、主页图块、产品列表等。

**State** 包含状态类，例如 isSelected、isActive、hasError、wasSuccessful 等。

**主题** 包含与主题相关的任何样式。

* * *

这里有太多需要详细说明的内容，但也请查看其他内容：

*   [西装CSS](http://suitcss.github.io/)
*   [AtomicCSS](http://acss.io/)（非原子设计）
*   [oCSS](http://krasimir.github.io/organic-css/)（有机 CSS）

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-28T15:45:27.257

但是，您发现它最容易阅读！

说真的，你会得到十亿零五个建议，但你只会喜欢几种方法。

不过有些话我要说：

*   将 CSS 文件分成块确实可以帮助您在脑海中组织它，但这意味着来自浏览器的更多请求，这最终会导致运行速度较慢的服务器（更多请求）并且浏览器需要更长的时间来显示页面。记住这一点。
*   仅仅因为它是任意数量的行就分解一个文件是愚蠢的（除了你有一个糟糕的编辑器 - 在这种情况下，得到一个新的）

就我个人而言，我这样编写我的 CSS：

```
* { /* css */ }
body { /* css */ }
#wrapper { /* css */ }
#innerwrapper { /* css */ }

#content { /* css */ }
#content div { /* css */ }
#content span { /* css */ }
#content etc { /* css */ }

#header { /* css */ }
#header etc { /* css */ }

#footer { /* css */ }
#footer etc { /* css */ }

.class1 { /* css */ }
.class2 { /* css */ }
.class3 { /* css */ }
.classn { /* css */ } 
```

将规则保持在一行可以让我非常快速地浏览文件并查看其中的规则。当它们被扩展时，我发现这太像试图找出正在应用的规则的艰苦工作。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-28T15:40:39.967

我尝试了很多不同的策略，我总是回到这种风格：

```
.class {border: 1px solid #000; padding: 0; margin: 0;} 
```

当涉及大量声明时，这是最友好的。

[Snook 先生差不多四年前写过这个：）](http://snook.ca/archives/html_and_css/top_css_tips/)。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-28T17:25:15.100

我按照这个顺序去：

1.  通用样式规则，通常应用于裸元素（a、ul、ol 等），但它们也可以是通用类（.button、.error）
2.  适用于大多数/所有页面的页面布局规则
3.  单独的页面布局规则

对于适用于单个页面或小型分组页面的任何样式规则，我会将正文设置为 id 和类，以便轻松定位特定页面。id 是文件的基名，class 是文件所在的目录名。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-28T16:36:24.467

排除常见的样式。不是碰巧相同的样式，而是*打算*相同的样式 - 更改一个选择器的样式可能意味着您也想更改另一个选择器。我在另一篇文章中放置了这种样式的示例： [在 CSS 文件中创建一个变量以在该 CSS 文件中使用](https://stackoverflow.com/questions/47487/create-a-variable-in-css-file-for-use-within-that-css-file#47508)。

除此之外，将相关规则组合在一起。并将您的规则拆分为多个文件......除非*每个*页面实际上都需要*每个*规则。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-28T17:48:53.093

CSS 文件缓存在客户端上。因此，最好将所有样式保存在一个文件中。但是在开发时，我发现根据域来构建我的 CSS 很有用。

例如：`reset.css`、`design.css`等`text.css`。当我发布最终产品时，我会将所有样式混合到一个文件中。

另一个有用的技巧是将可读性集中在规则上，而不是样式上。

尽管：

```
ul li
{
    margin-left: 10px;
    padding: 0;
} 
```

看起来不错，当你有 100 行代码时，要找到规则并不容易。

相反，我使用这种格式：

```
rule { property: value; property: value; }

rule { property: value; property: value; } 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-09-28T16:06:18.720

由于实际排序是如何应用 CSS 的重要组成部分，因此继续使用“按字母顺序”的建议似乎有点愚蠢。

通常，您希望按项目影响的页面区域将项目组合在一起。例如，影响一切的主要样式首先出现，然后是页眉和页脚样式，然后是导航样式，然后是主要内容样式，然后是次要内容样式。

此时我会避免分成多个文件，因为它可能更难以维护。（当您打开六个 CSS 文件时，很难在脑海中保持级联顺序）。但是，如果样式仅适用于页面子集，我肯定会开始将样式移动到不同的文件，例如，表单样式仅在页面实际包含表单时才链接到页面。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2008-09-28T18:59:06.417

这就是我所做的。我有一个没有指令的 CSS 索引页面，它调用不同的文件。这是一个简短的示例：

```
@import url("stylesheet-name/complete-reset.css");
@import url("stylesheet-name/colors.css");
@import url("stylesheet-name/structure.css");
@import url("stylesheet-name/html-tags.css");
@import url("stylesheet-name/menu-items.css");
@import url("stylesheet-name/portfolio.css");
@import url("stylesheet-name/error-messages.css"); 
```

它从完全重置开始。下一个文件定义了调色板以便于参考。然后我设置`<div/>`确定布局、页眉、页脚、列数、它们适合的位置等的 main 样式... html 标签定义`<body/>`、`<h1/>`、`<p/>`、 t 等... 接下来是网站的特定部分。

它非常可扩展且非常清晰。查找要更改的代码和添加新部分更加友好。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-30T07:11:22.157

我曾经一直担心这个问题，但 Firebug 来救援了。

如今，通过 Firebug 查看您的样式如何相互关联并从中找出需要做的事情要容易得多。

当然，一定要确保有一个合理的结构将相关样式组合在一起，但不要过火。Firebug 使事情变得更容易跟踪，您不必担心预先制作完美的 css 结构。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2017-03-30T14:18:31.687

# [ITCSS](https://www.xfive.co/blog/itcss-scalable-maintainable-css-architecture/)

作者：Harry Roberts（CSS 巫术）

定义全局命名空间和级联，并帮助保持选择器的低特异性。

**结构**

前两个仅适用于您使用预处理器的情况。

1.  （设置）
2.  （工具）
3.  泛型
4.  元素
5.  对象
6.  组件
7.  特朗普

* * *

## 回答 #13

> 赞同：-2
> 
> 时间：2017-09-28T12:33:26.370

通常我这样做：

1.  `<link rel="stylesheet" href="css/style.css">`
2.  在 style.css 我 @import 以下内容：

    ```
    @import url(colors.css);
    @import url(grid.css);
    @import url(custom.css); + some more files (if needed) 
    ```

3.  在`colors.css`我`@import`下面（使用 CSS 自定义属性时）：

    ```
    @import url(root/variable.css); 
    ```

一切都井井有条，易于编辑代码的任何部分。如果它以某种方式有所帮助，我会很高兴。

# refactoring - 重构的局限性是什么？

> ID：146124
> 
> 赞同：0
> 
> 时间：2008-09-28T15:46:16.537
> 
> 标签：refactoring

我正在研究重构对改进现有软件架构的限制，我很想听听您的经验，您发现重构不足以或仍然太不成熟而无法实现您的目标。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-28T15:58:04.857

重构可能有风险

重构通常很困难，因为重构者通常与原始设计者不是同一个人。因此，他或她在系统和原始设计背后的决策方面没有相同的背景。您总是冒着原始设计中避免的错误可能会在新设计中蔓延的风险。

当一个新的或年轻的团队成员对这个系统没有完全的经验，决定将新的酷wizbang技术或想法注入一个稳定的系统时，尤其如此。通常，当新的团队成员没有很好地融入团队并且没有得到足够的指导时，他们可能会开始迫使项目朝着整个团队意想不到的方向发展。

这只是一个风险，然而，也有可能团队是错误的，如果新的团队成员负责并被允许做他或她的事情，实际上会做出重大改进。

这些问题经常出现在处理遗留系统的团队中。通常没有计划改变世界的增强功能，因此团队对其设计持保守态度。他们的目标是防止新的错误被注入，并通过添加一些额外的功能来修复旧的错误。一个新的团队成员可能会出现并通过坚持重写代码的某些子系统来破坏苹果车。创建了新的错误，并且相当稳定的产品的用户感到不安，因为从那里的角度来看，软件变得越来越糟糕。

因此，如果您的目标是在没有重大功能更改的情况下保持长期稳定性，那么重大重构通常不是您想要的。

但是，如果您在 pike 中有较大的功能更改，并且有一个用户群期望您的产品尚未完全成熟（即您处于某种测试阶段），那么考虑进行认真的重构是一个更好的情况，因为卓越设计的长期利益将得到回报，并且您不太可能破坏庞大的用户群。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-28T16:09:22.300

重构没有相应单元测试套件的代码可能会有风险。如果项目已经建立了单元测试套件，那么只要您保持 TDD 方法，就应该没有什么担心的理由。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-28T18:51:27.247

我不太确定你的问题是否有效。您在询问重构的局限性。但是，重构涉及代码的重写。你重写的内容怎么会有限制？在大规模重构过程中，您可以逐段替换旧代码。实际上，您可以在没有原始代码的单个字符的情况下结束重构，尽管这无疑是极端的。考虑到重构可能性的尽头，你怎么能假设会有任何限制呢？如果所有最终代码都可能是全新的，那么与从头开始编写最终代码相比，您没有更多的限制。但是，从头开始编写相同的结果代码会给您带来更少的基础，更少的迭代开发机会，因此我必须回答一个反问：

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-28T17:52:34.720

并非所有经理都喜欢重构的想法。在他们看来，重构所花费的时间并没有用于添加新功能。因此，您需要让您的经理相信它是必需的，或者您可以在添加功能时隐藏它。

所以风险是花费太多时间来重构。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-28T17:59:49.010

当您无法更改类的外部接口时，就会出现重构问题。在这些情况下，您可以重构的内容非常非常有限。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-30T03:03:46.587

对于 Kev 的出色回答 - Michael Feathers 的“有效地使用遗留代码”应该是从事软件工程工作的人必读的。

# c# - 如何从路径和文件名中删除非法字符？

> ID：146134
> 
> 赞同：533
> 
> 时间：2008-09-28T15:52:10.580
> 
> 标签：c#, string, path, directory

我需要一种强大而简单的方法来从简单的字符串中删除非法路径和文件字符。我使用了下面的代码，但它似乎没有做任何事情，我错过了什么？

```
using System;
using System.IO;

namespace ConsoleApplication1
{
    class Program
    {
        static void Main(string[] args)
        {
            string illegal = "\"M<>\"\\a/ry/ h**ad:>> a\\/:*?\"<>| li*tt|le|| la\"mb.?";

            illegal = illegal.Trim(Path.GetInvalidFileNameChars());
            illegal = illegal.Trim(Path.GetInvalidPathChars());

            Console.WriteLine(illegal);
            Console.ReadLine();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：534
> 
> 时间：2008-09-28T16:03:37.247

试试这样的东西；

```
string illegal = "\"M\"\\a/ry/ h**ad:>> a\\/:*?\"| li*tt|le|| la\"mb.?";
string invalid = new string(Path.GetInvalidFileNameChars()) + new string(Path.GetInvalidPathChars());

foreach (char c in invalid)
{
    illegal = illegal.Replace(c.ToString(), ""); 
} 
```

但我必须同意这些评论，我可能会尝试处理非法路径的来源，而不是试图将非法路径改造成合法但可能是无意的路径。

编辑：或者使用正则表达式的可能“更好”的解决方案。

```
string illegal = "\"M\"\\a/ry/ h**ad:>> a\\/:*?\"| li*tt|le|| la\"mb.?";
string regexSearch = new string(Path.GetInvalidFileNameChars()) + new string(Path.GetInvalidPathChars());
Regex r = new Regex(string.Format("[{0}]", Regex.Escape(regexSearch)));
illegal = r.Replace(illegal, ""); 
```

尽管如此，还是要问一个问题，为什么您首先要这样做。

* * *

## 回答 #2

> 赞同：479
> 
> 时间：2014-04-20T13:06:22.840

原始问题要求“删除非法字符”：

```
public string RemoveInvalidChars(string filename)
{
    return string.Concat(filename.Split(Path.GetInvalidFileNameChars()));
} 
```

您可能想要替换它们：

```
public string ReplaceInvalidChars(string filename)
{
    return string.Join("_", filename.Split(Path.GetInvalidFileNameChars()));    
} 
```

[这个答案在 Ceres 的另一个帖子上](https://stackoverflow.com/a/12800424/512365)，我真的很喜欢它简洁明了。

* * *

## 回答 #3

> 赞同：216
> 
> 时间：2011-09-12T20:38:10.900

我使用 Linq 来清理文件名。您也可以轻松扩展它以检查有效路径。

```
private static string CleanFileName(string fileName)
{
    return Path.GetInvalidFileNameChars().Aggregate(fileName, (current, c) => current.Replace(c.ToString(), string.Empty));
} 
```

### 更新

一些评论表明此方法不适用于他们，因此我提供了指向 DotNetFiddle 片段的链接，以便您可以验证该方法。

[https://dotnetfiddle.net/nw1SWY](https://dotnetfiddle.net/nw1SWY)

* * *

## 回答 #4

> 赞同：93
> 
> 时间：2010-11-24T19:41:50.817

您可以像这样使用 Linq 删除非法字符：

```
var invalidChars = Path.GetInvalidFileNameChars();

var invalidCharsRemoved = stringWithInvalidChars
.Where(x => !invalidChars.Contains(x))
.ToArray(); 
```

**编辑**
这是评论中提到的所需编辑的外观：

```
var invalidChars = Path.GetInvalidFileNameChars();

string invalidCharsRemoved = new string(stringWithInvalidChars
  .Where(x => !invalidChars.Contains(x))
  .ToArray()); 
```

* * *

## 回答 #5

> 赞同：35
> 
> 时间：2014-02-11T02:36:30.980

对于文件名：

```
var cleanFileName = string.Join("", fileName.Split(Path.GetInvalidFileNameChars())); 
```

对于完整路径：

```
var cleanPath = string.Join("", path.Split(Path.GetInvalidPathChars())); 
```

请注意，如果您打算将此用作安全功能，则更可靠的方法是扩展所有路径，然后验证用户提供的路径确实是用户应该有权访问的目录的子目录。

* * *

## 回答 #6

> 赞同：29
> 
> 时间：2011-11-16T13:22:36.687

这些都是很好的解决方案，但它们都依赖于`Path.GetInvalidFileNameChars`，这可能不像你想象的那么可靠。请注意 MSDN 文档中的以下注释[`Path.GetInvalidFileNameChars`](http://msdn.microsoft.com/en-us/library/system.io.path.getinvalidfilenamechars.aspx)：

> 不保证从此方法返回的数组**包含文件和目录名称中无效的完整字符集。**完整的无效字符集可能因文件系统而异。例如，在基于 Windows 的桌面平台上，无效路径字符可能包括 ASCII/Unicode 字符 1 到 31，以及引号 (")、小于 (<)、大于 (>)、竖线 (|)、退格 ( \b)、空 (\0) 和制表符 (\t)。

方法也好不到哪里去[`Path.GetInvalidPathChars`](http://msdn.microsoft.com/en-us/library/system.io.path.getinvalidpathchars.aspx)。它包含完全相同的注释。

* * *

## 回答 #7

> 赞同：20
> 
> 时间：2013-09-28T06:35:51.617

从用户输入中删除非法字符的最佳方法是使用 Regex 类替换非法字符，在代码中创建方法，或者使用正则表达式控件在客户端进行验证。

```
public string RemoveSpecialCharacters(string str)
{
    return Regex.Replace(str, "[^a-zA-Z0-9_]+", "_", RegexOptions.Compiled);
} 
```

**或者**

```
<asp:RegularExpressionValidator ID="regxFolderName" 
                                runat="server" 
                                ErrorMessage="Enter folder name with  a-z A-Z0-9_" 
                                ControlToValidate="txtFolderName" 
                                Display="Dynamic" 
                                ValidationExpression="^[a-zA-Z0-9_]*$" 
                                ForeColor="Red"> 
```

* * *

## 回答 #8

> 赞同：18
> 
> 时间：2008-09-28T15:56:35.437

对于初学者，[Trim 仅删除字符串开头或结尾的字符](http://msdn.microsoft.com/en-us/library/system.string.trim.aspx)。其次，您应该评估您是否真的想删除令人反感的字符，或者快速失败并让用户知道他们的文件名无效。我的选择是后者，但我的回答至少应该向您展示如何以正确和错误的方式做事：

[StackOverflow 问题显示如何检查给定字符串是否为有效文件名](https://stackoverflow.com/questions/62771/how-check-if-given-string-is-legal-allowed-file-name-under-windows)。请注意，您可以使用此问题中的正则表达式来删除带有正则表达式替换的字符（如果您确实需要这样做）。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-09-28T18:45:24.453

我使用正则表达式来实现这一点。首先，我动态构建正则表达式。

```
string regex = string.Format(
                   "[{0}]",
                   Regex.Escape(new string(Path.GetInvalidFileNameChars())));
Regex removeInvalidChars = new Regex(regex, RegexOptions.Singleline | RegexOptions.Compiled | RegexOptions.CultureInvariant); 
```

然后我只需调用 removeInvalidChars.Replace 来进行查找和替换。这显然也可以扩展到覆盖路径字符。

* * *

## 回答 #10

> 赞同：13
> 
> 时间：2011-02-15T14:21:46.727

我绝对喜欢 Jeff Yates 的想法。如果您稍微修改它，它将完美地工作：

```
string regex = String.Format("[{0}]", Regex.Escape(new string(Path.GetInvalidFileNameChars())));
Regex removeInvalidChars = new Regex(regex, RegexOptions.Singleline | RegexOptions.Compiled | RegexOptions.CultureInvariant); 
```

改进只是为了逃避自动生成的正则表达式。

* * *

## 回答 #11

> 赞同：12
> 
> 时间：2010-10-19T16:33:56.250

这是一个对 .NET 3 及更高版本有帮助的代码片段。

```
using System.IO;
using System.Text.RegularExpressions;

public static class PathValidation
{
    private static string pathValidatorExpression = "^[^" + string.Join("", Array.ConvertAll(Path.GetInvalidPathChars(), x => Regex.Escape(x.ToString()))) + "]+$";
    private static Regex pathValidator = new Regex(pathValidatorExpression, RegexOptions.Compiled);

    private static string fileNameValidatorExpression = "^[^" + string.Join("", Array.ConvertAll(Path.GetInvalidFileNameChars(), x => Regex.Escape(x.ToString()))) + "]+$";
    private static Regex fileNameValidator = new Regex(fileNameValidatorExpression, RegexOptions.Compiled);

    private static string pathCleanerExpression = "[" + string.Join("", Array.ConvertAll(Path.GetInvalidPathChars(), x => Regex.Escape(x.ToString()))) + "]";
    private static Regex pathCleaner = new Regex(pathCleanerExpression, RegexOptions.Compiled);

    private static string fileNameCleanerExpression = "[" + string.Join("", Array.ConvertAll(Path.GetInvalidFileNameChars(), x => Regex.Escape(x.ToString()))) + "]";
    private static Regex fileNameCleaner = new Regex(fileNameCleanerExpression, RegexOptions.Compiled);

    public static bool ValidatePath(string path)
    {
        return pathValidator.IsMatch(path);
    }

    public static bool ValidateFileName(string fileName)
    {
        return fileNameValidator.IsMatch(fileName);
    }

    public static string CleanPath(string path)
    {
        return pathCleaner.Replace(path, "");
    }

    public static string CleanFileName(string fileName)
    {
        return fileNameCleaner.Replace(fileName, "");
    }
} 
```

* * *

## 回答 #12

> 赞同：8
> 
> 时间：2012-06-19T12:16:01.630

上面的大多数解决方案都结合了错误的路径和文件名的非法字符（即使两个调用当前返回相同的字符集）。我会首先将路径+文件名拆分为路径和文件名，然后将适当的设置应用于它们中的任何一个，然后再次将两者结合起来。

wvd_vegt

* * *

## 回答 #13

> 赞同：6
> 
> 时间：2014-10-01T18:40:46.680

如果您删除或用单个字符替换无效字符，则可能会发生冲突：

```
<abc -> abc
>abc -> abc 
```

这是避免这种情况的简单方法：

```
public static string ReplaceInvalidFileNameChars(string s)
{
    char[] invalidFileNameChars = System.IO.Path.GetInvalidFileNameChars();
    foreach (char c in invalidFileNameChars)
        s = s.Replace(c.ToString(), "[" + Array.IndexOf(invalidFileNameChars, c) + "]");
    return s;
} 
```

结果：

```
 <abc -> [1]abc
 >abc -> [2]abc 
```

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2009-03-12T16:14:16.197

抛出异常。

```
if ( fileName.IndexOfAny(Path.GetInvalidFileNameChars()) > -1 )
            {
                throw new ArgumentException();
            } 
```

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2013-12-07T13:21:54.267

我写这个怪物是为了好玩，它可以让你往返：

```
public static class FileUtility
{
    private const char PrefixChar = '%';
    private static readonly int MaxLength;
    private static readonly Dictionary<char,char[]> Illegals;
    static FileUtility()
    {
        List<char> illegal = new List<char> { PrefixChar };
        illegal.AddRange(Path.GetInvalidFileNameChars());
        MaxLength = illegal.Select(x => ((int)x).ToString().Length).Max();
        Illegals = illegal.ToDictionary(x => x, x => ((int)x).ToString("D" + MaxLength).ToCharArray());
    }

    public static string FilenameEncode(string s)
    {
        var builder = new StringBuilder();
        char[] replacement;
        using (var reader = new StringReader(s))
        {
            while (true)
            {
                int read = reader.Read();
                if (read == -1)
                    break;
                char c = (char)read;
                if(Illegals.TryGetValue(c,out replacement))
                {
                    builder.Append(PrefixChar);
                    builder.Append(replacement);
                }
                else
                {
                    builder.Append(c);
                }
            }
        }
        return builder.ToString();
    }

    public static string FilenameDecode(string s)
    {
        var builder = new StringBuilder();
        char[] buffer = new char[MaxLength];
        using (var reader = new StringReader(s))
        {
            while (true)
            {
                int read = reader.Read();
                if (read == -1)
                    break;
                char c = (char)read;
                if (c == PrefixChar)
                {
                    reader.Read(buffer, 0, MaxLength);
                    var encoded =(char) ParseCharArray(buffer);
                    builder.Append(encoded);
                }
                else
                {
                    builder.Append(c);
                }
            }
        }
        return builder.ToString();
    }

    public static int ParseCharArray(char[] buffer)
    {
        int result = 0;
        foreach (char t in buffer)
        {
            int digit = t - '0';
            if ((digit < 0) || (digit > 9))
            {
                throw new ArgumentException("Input string was not in the correct format");
            }
            result *= 10;
            result += digit;
        }
        return result;
    }
} 
```

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2015-02-09T21:19:41.127

这似乎是 O(n) 并且不会在字符串上花费太多内存：

```
 private static readonly HashSet<char> invalidFileNameChars = new HashSet<char>(Path.GetInvalidFileNameChars());

    public static string RemoveInvalidFileNameChars(string name)
    {
        if (!name.Any(c => invalidFileNameChars.Contains(c))) {
            return name;
        }

        return new string(name.Where(c => !invalidFileNameChars.Contains(c)).ToArray());
    } 
```

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2018-07-25T12:14:08.250

文件名不能包含来自`Path.GetInvalidPathChars()`、`+`和`#`符号的字符以及其他特定名称。我们将所有检查合并为一个类：

```
public static class FileNameExtensions
{
    private static readonly Lazy<string[]> InvalidFileNameChars =
        new Lazy<string[]>(() => Path.GetInvalidPathChars()
            .Union(Path.GetInvalidFileNameChars()
            .Union(new[] { '+', '#' })).Select(c => c.ToString(CultureInfo.InvariantCulture)).ToArray());

    private static readonly HashSet<string> ProhibitedNames = new HashSet<string>
    {
        @"aux",
        @"con",
        @"clock$",
        @"nul",
        @"prn",

        @"com1",
        @"com2",
        @"com3",
        @"com4",
        @"com5",
        @"com6",
        @"com7",
        @"com8",
        @"com9",

        @"lpt1",
        @"lpt2",
        @"lpt3",
        @"lpt4",
        @"lpt5",
        @"lpt6",
        @"lpt7",
        @"lpt8",
        @"lpt9"
    };

    public static bool IsValidFileName(string fileName)
    {
        return !string.IsNullOrWhiteSpace(fileName)
            && fileName.All(o => !IsInvalidFileNameChar(o))
            && !IsProhibitedName(fileName);
    }

    public static bool IsProhibitedName(string fileName)
    {
        return ProhibitedNames.Contains(fileName.ToLower(CultureInfo.InvariantCulture));
    }

    private static string ReplaceInvalidFileNameSymbols([CanBeNull] this string value, string replacementValue)
    {
        if (value == null)
        {
            return null;
        }

        return InvalidFileNameChars.Value.Aggregate(new StringBuilder(value),
            (sb, currentChar) => sb.Replace(currentChar, replacementValue)).ToString();
    }

    public static bool IsInvalidFileNameChar(char value)
    {
        return InvalidFileNameChars.Value.Contains(value.ToString(CultureInfo.InvariantCulture));
    }

    public static string GetValidFileName([NotNull] this string value)
    {
        return GetValidFileName(value, @"_");
    }

    public static string GetValidFileName([NotNull] this string value, string replacementValue)
    {
        if (string.IsNullOrWhiteSpace(value))
        {
            throw new ArgumentException(@"value should be non empty", nameof(value));
        }

        if (IsProhibitedName(value))
        {
            return (string.IsNullOrWhiteSpace(replacementValue) ? @"_" : replacementValue) + value; 
        }

        return ReplaceInvalidFileNameSymbols(value, replacementValue);
    }

    public static string GetFileNameError(string fileName)
    {
        if (string.IsNullOrWhiteSpace(fileName))
        {
            return CommonResources.SelectReportNameError;
        }

        if (IsProhibitedName(fileName))
        {
            return CommonResources.FileNameIsProhibited;
        }

        var invalidChars = fileName.Where(IsInvalidFileNameChar).Distinct().ToArray();

        if(invalidChars.Length > 0)
        {
            return string.Format(CultureInfo.CurrentCulture,
                invalidChars.Length == 1 ? CommonResources.InvalidCharacter : CommonResources.InvalidCharacters,
                StringExtensions.JoinQuoted(@",", @"'", invalidChars.Select(c => c.ToString(CultureInfo.CurrentCulture))));
        }

        return string.Empty;
    }
} 
```

方法`GetValidFileName`将所有不正确的数据替换为`_`.

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2008-09-28T16:07:56.627

我认为使用正则表达式验证并指定允许的字符要容易得多，而不是尝试检查所有坏字符。请参阅以下链接： [http ://www.c-sharpcorner.com/UploadFile/prasad_1/RegExpPSD12062005021717AM/RegExpPSD.aspx](http://www.c-sharpcorner.com/UploadFile/prasad_1/RegExpPSD12062005021717AM/RegExpPSD.aspx) [http://www.windowsdevcenter.com/pub/a/oreilly/windows/news/csharp_0101.html](http://www.windowsdevcenter.com/pub/a/oreilly/windows/news/csharp_0101.html)

另外，搜索“正则表达式编辑器”，它们有很大帮助。有一些甚至可以为您输出 c# 中的代码。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2017-09-08T00:14:09.793

扫描这里的答案，他们都**似乎涉及使用无效文件名字符的 char 数组。

诚然，这可能是微优化 - 但为了任何可能希望检查大量值是否为有效文件名的人的利益，值得注意的是，构建无效字符的哈希集将带来明显更好的性能。

过去，我非常惊讶（震惊）哈希集（或字典）在迭代列表上的速度有多快。对于字符串，这是一个非常低的数字（大约 5-7 项来自内存）。对于大多数其他简单数据（对象引用、数字等），神奇的交叉似乎是 20 项左右。

Path.InvalidFileNameChars“列表”中有 40 个无效字符。今天进行了搜索，StackOverflow 上有一个很好的基准，显示哈希集将花费 40 个项目的数组/列表的一半多一点时间：[https ://stackoverflow.com/a/10762995/949129](https://stackoverflow.com/a/10762995/949129)

这是我用于清理路径的辅助类。我现在忘记了为什么我有花哨的替换选项，但它是一个可爱的奖励。

额外的奖励方法“IsValidLocalPath”也是:)

(**那些不使用正则表达式的)

```
public static class PathExtensions
{
    private static HashSet<char> _invalidFilenameChars;
    private static HashSet<char> InvalidFilenameChars
    {
        get { return _invalidFilenameChars ?? (_invalidFilenameChars = new HashSet<char>(Path.GetInvalidFileNameChars())); }
    }

    /// <summary>Replaces characters in <c>text</c> that are not allowed in file names with the 
    /// specified replacement character.</summary>
    /// <param name="text">Text to make into a valid filename. The same string is returned if 
    /// it is valid already.</param>
    /// <param name="replacement">Replacement character, or NULL to remove bad characters.</param>
    /// <param name="fancyReplacements">TRUE to replace quotes and slashes with the non-ASCII characters ” and ⁄.</param>
    /// <returns>A string that can be used as a filename. If the output string would otherwise be empty, "_" is returned.</returns>
    public static string ToValidFilename(this string text, char? replacement = '_', bool fancyReplacements = false)
    {
        StringBuilder sb = new StringBuilder(text.Length);
        HashSet<char> invalids = InvalidFilenameChars;
        bool changed = false;

        for (int i = 0; i < text.Length; i++)
        {
            char c = text[i];
            if (invalids.Contains(c))
            {
                changed = true;
                char repl = replacement ?? '\0';
                if (fancyReplacements)
                {
                    if (c == '"') repl = '”'; // U+201D right double quotation mark
                    else if (c == '\'') repl = '’'; // U+2019 right single quotation mark
                    else if (c == '/') repl = '⁄'; // U+2044 fraction slash
                }
                if (repl != '\0')
                    sb.Append(repl);
            }
            else
                sb.Append(c);
        }

        if (sb.Length == 0)
            return "_";

        return changed ? sb.ToString() : text;
    }

    /// <summary>
    /// Returns TRUE if the specified path is a valid, local filesystem path.
    /// </summary>
    /// <param name="pathString"></param>
    /// <returns></returns>
    public static bool IsValidLocalPath(this string pathString)
    {
        // From solution at https://stackoverflow.com/a/11636052/949129
        Uri pathUri;
        Boolean isValidUri = Uri.TryCreate(pathString, UriKind.Absolute, out pathUri);
        return isValidUri && pathUri != null && pathUri.IsLoopback;
    }
} 
```

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2018-02-22T11:25:19.497

```
public static class StringExtensions
      {
        public static string RemoveUnnecessary(this string source)
        {
            string result = string.Empty;
            string regex = new string(Path.GetInvalidFileNameChars()) + new string(Path.GetInvalidPathChars());
            Regex reg = new Regex(string.Format("[{0}]", Regex.Escape(regex)));
            result = reg.Replace(source, "");
            return result;
        }
    } 
```

你可以清楚地使用方法。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2018-12-02T01:49:39.763

用于从 Windows 文件命名的任何非法字符中清除字符串的一个衬垫：

```
public static string CleanIllegalName(string p_testName) => new Regex(string.Format("[{0}]", Regex.Escape(new string(Path.GetInvalidFileNameChars()) + new string(Path.GetInvalidPathChars())))).Replace(p_testName, ""); 
```

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2020-09-29T14:06:26.857

这是我的小贡献。一种在同一字符串中替换而不创建新字符串或字符串构建器的方法。它快速、易于理解，是本文中所有提及的一个很好的替代方案。

```
private static HashSet<char> _invalidCharsHash;
private static HashSet<char> InvalidCharsHash
{
  get { return _invalidCharsHash ?? (_invalidCharsHash = new HashSet<char>(Path.GetInvalidFileNameChars())); }
}

private static string ReplaceInvalidChars(string fileName, string newValue)
{
  char newChar = newValue[0];

  char[] chars = fileName.ToCharArray();
  for (int i = 0; i < chars.Length; i++)
  {
    char c = chars[i];
    if (InvalidCharsHash.Contains(c))
      chars[i] = newChar;
  }

  return new string(chars);
} 
```

你可以这样称呼它：

```
string illegal = "\"M<>\"\\a/ry/ h**ad:>> a\\/:*?\"<>| li*tt|le|| la\"mb.?";
string legal = ReplaceInvalidChars(illegal); 
```

并返回：

```
_M ____a_ry_ h__ad___ a_________ li_tt_le__ la_mb._ 
```

值得注意的是，此方法将始终将无效字符替换为给定值，但不会删除它们。如果你想删除无效字符，这个替代方法可以解决问题：

```
private static string RemoveInvalidChars(string fileName, string newValue)
{
  char newChar = string.IsNullOrEmpty(newValue) ? char.MinValue : newValue[0];
  bool remove = newChar == char.MinValue;

  char[] chars = fileName.ToCharArray();
  char[] newChars = new char[chars.Length];
  int i2 = 0;
  for (int i = 0; i < chars.Length; i++)
  {
    char c = chars[i];
    if (InvalidCharsHash.Contains(c))
    {
      if (!remove)
        newChars[i2++] = newChar;
    }
    else
      newChars[i2++] = c;

  }

  return new string(newChars, 0, i2);
} 
```

**基准**

如果性能是您所追求的，我会使用本文中的大多数方法执行定时测试运行。其中一些方法不会用给定的字符替换，因为 OP 要求清理字符串。我添加了用给定字符替换的测试，如果您的预期场景只需要删除不需要的字符，则其他一些替换为空字符。用于此基准测试的代码在最后，因此您可以运行自己的测试。

注意：方法`Test1`和`Test2`都在这篇文章中提出。

**首轮**

`replacing with '_', 1000000 iterations`

**结果：**

```
============Test1===============
Elapsed=00:00:01.6665595
Result=_M ____a_ry_ h__ad___ a_________ li_tt_le__ la_mb._

============Test2===============
Elapsed=00:00:01.7526835
Result=_M ____a_ry_ h__ad___ a_________ li_tt_le__ la_mb._

============Test3===============
Elapsed=00:00:05.2306227
Result=_M ____a_ry_ h__ad___ a_________ li_tt_le__ la_mb._

============Test4===============
Elapsed=00:00:14.8203696
Result=_M ____a_ry_ h__ad___ a_________ li_tt_le__ la_mb._

============Test5===============
Elapsed=00:00:01.8273760
Result=_M ____a_ry_ h__ad___ a_________ li_tt_le__ la_mb._

============Test6===============
Elapsed=00:00:05.4249985
Result=_M ____a_ry_ h__ad___ a_________ li_tt_le__ la_mb._

============Test7===============
Elapsed=00:00:07.5653833
Result=_M ____a_ry_ h__ad___ a_________ li_tt_le__ la_mb._

============Test8===============
Elapsed=00:12:23.1410106
Result=_M ____a_ry_ h__ad___ a_________ li_tt_le__ la_mb._

============Test9===============
Elapsed=00:00:02.1016708
Result=_M ____a_ry_ h__ad___ a_________ li_tt_le__ la_mb._

============Test10===============
Elapsed=00:00:05.0987225
Result=M ary had a little lamb.

============Test11===============
Elapsed=00:00:06.8004289
Result=M ary had a little lamb. 
```

**第二轮**

`removing invalid chars, 1000000 iterations`

注意：Test1 不会删除，只会替换。

**结果：**

```
============Test1===============
Elapsed=00:00:01.6945352
Result= M     a ry  h  ad    a          li tt le   la mb.

============Test2===============
Elapsed=00:00:01.4798049
Result=M ary had a little lamb.

============Test3===============
Elapsed=00:00:04.0415688
Result=M ary had a little lamb.

============Test4===============
Elapsed=00:00:14.3397960
Result=M ary had a little lamb.

============Test5===============
Elapsed=00:00:01.6782505
Result=M ary had a little lamb.

============Test6===============
Elapsed=00:00:04.9251707
Result=M ary had a little lamb.

============Test7===============
Elapsed=00:00:07.9562379
Result=M ary had a little lamb.

============Test8===============
Elapsed=00:12:16.2918943
Result=M ary had a little lamb.

============Test9===============
Elapsed=00:00:02.0770277
Result=M ary had a little lamb.

============Test10===============
Elapsed=00:00:05.2721232
Result=M ary had a little lamb.

============Test11===============
Elapsed=00:00:05.2802903
Result=M ary had a little lamb. 
```

**基准结果**

方法`Test1`，`Test2`并且`Test5`是最快的。方法`Test8`是最慢的。

**代码**

这是基准测试的完整代码：

```
private static HashSet<char> _invalidCharsHash;
private static HashSet<char> InvalidCharsHash
{
  get { return _invalidCharsHash ?? (_invalidCharsHash = new HashSet<char>(Path.GetInvalidFileNameChars())); }
}

private static string _invalidCharsValue;
private static string InvalidCharsValue
{
  get { return _invalidCharsValue ?? (_invalidCharsValue = new string(Path.GetInvalidFileNameChars())); }
}

private static char[] _invalidChars;
private static char[] InvalidChars
{
  get { return _invalidChars ?? (_invalidChars = Path.GetInvalidFileNameChars()); }
}

static void Main(string[] args)
{
  string testPath = "\"M <>\"\\a/ry/ h**ad:>> a\\/:*?\"<>| li*tt|le|| la\"mb.?";

  int max = 1000000;
  string newValue = "";

  TimeBenchmark(max, Test1, testPath, newValue);
  TimeBenchmark(max, Test2, testPath, newValue);
  TimeBenchmark(max, Test3, testPath, newValue);
  TimeBenchmark(max, Test4, testPath, newValue);
  TimeBenchmark(max, Test5, testPath, newValue);
  TimeBenchmark(max, Test6, testPath, newValue);
  TimeBenchmark(max, Test7, testPath, newValue);
  TimeBenchmark(max, Test8, testPath, newValue);
  TimeBenchmark(max, Test9, testPath, newValue);
  TimeBenchmark(max, Test10, testPath, newValue);
  TimeBenchmark(max, Test11, testPath, newValue);

  Console.Read();
}

private static void TimeBenchmark(int maxLoop, Func<string, string, string> func, string testString, string newValue)
{
  var sw = new Stopwatch();
  sw.Start();
  string result = string.Empty;

  for (int i = 0; i < maxLoop; i++)
    result = func?.Invoke(testString, newValue);

  sw.Stop();

  Console.WriteLine($"============{func.Method.Name}===============");
  Console.WriteLine("Elapsed={0}", sw.Elapsed);
  Console.WriteLine("Result={0}", result);
  Console.WriteLine("");
}

private static string Test1(string fileName, string newValue)
{
  char newChar = string.IsNullOrEmpty(newValue) ? char.MinValue : newValue[0];

  char[] chars = fileName.ToCharArray();
  for (int i = 0; i < chars.Length; i++)
  {
    if (InvalidCharsHash.Contains(chars[i]))
      chars[i] = newChar;
  }

  return new string(chars);
}

private static string Test2(string fileName, string newValue)
{
  char newChar = string.IsNullOrEmpty(newValue) ? char.MinValue : newValue[0];
  bool remove = newChar == char.MinValue;

  char[] chars = fileName.ToCharArray();
  char[] newChars = new char[chars.Length];
  int i2 = 0;
  for (int i = 0; i < chars.Length; i++)
  {
    char c = chars[i];
    if (InvalidCharsHash.Contains(c))
    {
      if (!remove)
        newChars[i2++] = newChar;
    }
    else
      newChars[i2++] = c;

  }

  return new string(newChars, 0, i2);
}

private static string Test3(string filename, string newValue)
{
  foreach (char c in InvalidCharsValue)
  {
    filename = filename.Replace(c.ToString(), newValue);
  }

  return filename;
}

private static string Test4(string filename, string newValue)
{
  Regex r = new Regex(string.Format("[{0}]", Regex.Escape(InvalidCharsValue)));
  filename = r.Replace(filename, newValue);
  return filename;
}

private static string Test5(string filename, string newValue)
{
  return string.Join(newValue, filename.Split(InvalidChars));
}

private static string Test6(string fileName, string newValue)
{
  return InvalidChars.Aggregate(fileName, (current, c) => current.Replace(c.ToString(), newValue));
}

private static string Test7(string fileName, string newValue)
{
  string regex = string.Format("[{0}]", Regex.Escape(InvalidCharsValue));
  return Regex.Replace(fileName, regex, newValue, RegexOptions.Compiled);
}

private static string Test8(string fileName, string newValue)
{
  string regex = string.Format("[{0}]", Regex.Escape(InvalidCharsValue));
  Regex removeInvalidChars = new Regex(regex, RegexOptions.Singleline | RegexOptions.Compiled | RegexOptions.CultureInvariant);
  return removeInvalidChars.Replace(fileName, newValue);
}

private static string Test9(string fileName, string newValue)
{
  StringBuilder sb = new StringBuilder(fileName.Length);
  bool changed = false;

  for (int i = 0; i < fileName.Length; i++)
  {
    char c = fileName[i];
    if (InvalidCharsHash.Contains(c))
    {
      changed = true;
      sb.Append(newValue);
    }
    else
      sb.Append(c);
  }

  if (sb.Length == 0)
    return newValue;

  return changed ? sb.ToString() : fileName;
}

private static string Test10(string fileName, string newValue)
{
  if (!fileName.Any(c => InvalidChars.Contains(c)))
  {
    return fileName;
  }

  return new string(fileName.Where(c => !InvalidChars.Contains(c)).ToArray());
}

private static string Test11(string fileName, string newValue)
{
  string invalidCharsRemoved = new string(fileName
    .Where(x => !InvalidChars.Contains(x))
    .ToArray());

  return invalidCharsRemoved;
} 
```

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2013-11-18T13:28:53.887

```
public static bool IsValidFilename(string testName)
{
    return !new Regex("[" + Regex.Escape(new String(System.IO.Path.GetInvalidFileNameChars())) + "]").IsMatch(testName);
} 
```

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2020-10-23T07:29:35.857

我推出了自己的方法，这似乎比这里发布的其他方法要快得多（尤其是正则表达式，它是如此的慢），但我没有测试所有发布的方法。

[https://dotnetfiddle.net/haIXiY](https://dotnetfiddle.net/haIXiY)

第一种方法（我的）和第二种方法（也是我的，但旧的）也对反斜杠进行了额外的检查，所以基准并不完美，但无论如何它只是给你一个想法。

我的笔记本电脑上的结果（100 000 次迭代）：

```
StringHelper.RemoveInvalidCharacters 1: 451 ms  
StringHelper.RemoveInvalidCharacters 2: 7139 ms  
StringHelper.RemoveInvalidCharacters 3: 2447 ms  
StringHelper.RemoveInvalidCharacters 4: 3733 ms  
StringHelper.RemoveInvalidCharacters 5: 11689 ms  (==> Regex!) 
```

最快的方法：

```
public static string RemoveInvalidCharacters(string content, char replace = '_', bool doNotReplaceBackslashes = false)
{
    if (string.IsNullOrEmpty(content))
        return content;

    var idx = content.IndexOfAny(InvalidCharacters);
    if (idx >= 0)
    {
        var sb = new StringBuilder(content);
        while (idx >= 0)
        {
            if (sb[idx] != '\\' || !doNotReplaceBackslashes)
                sb[idx] = replace;
            idx = content.IndexOfAny(InvalidCharacters, idx+1);
        }
        return sb.ToString();
    }
    return content;
} 
```

方法不会“按原样”编译`InvalidCharacters`属性，请检查小提琴以获取完整代码

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2014-09-19T15:04:57.723

这将是你想要的，并避免碰撞

```
 static string SanitiseFilename(string key)
    {
        var invalidChars = Path.GetInvalidFileNameChars();
        var sb = new StringBuilder();
        foreach (var c in key)
        {
            var invalidCharIndex = -1;
            for (var i = 0; i < invalidChars.Length; i++)
            {
                if (c == invalidChars[i])
                {
                    invalidCharIndex = i;
                }
            }
            if (invalidCharIndex > -1)
            {
                sb.Append("_").Append(invalidCharIndex);
                continue;
            }

            if (c == '_')
            {
                sb.Append("__");
                continue;
            }

            sb.Append(c);
        }
        return sb.ToString();

    } 
```

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2015-07-07T09:37:09.437

我认为这个问题还没有完全回答......答案只描述了干净的文件名或路径......而不是两者。这是我的解决方案：

```
private static string CleanPath(string path)
{
    string regexSearch = new string(Path.GetInvalidFileNameChars()) + new string(Path.GetInvalidPathChars());
    Regex r = new Regex(string.Format("[{0}]", Regex.Escape(regexSearch)));
    List<string> split = path.Split('\\').ToList();
    string returnValue = split.Aggregate(string.Empty, (current, s) => current + (r.Replace(s, "") + @"\"));
    returnValue = returnValue.TrimEnd('\\');
    return returnValue;
} 
```

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2018-06-14T07:11:53.080

我创建了一个扩展方法，它结合了几个建议：

1.  在哈希集中保存非法字符
2.  过滤掉 ascii 127 以下的字符。由于 Path.GetInvalidFileNameChars 不包括所有可能使用 0 到 255 的 ascii 代码的无效字符。[请参见此处](https://stackoverflow.com/questions/27253394/getinvalidfilenamechars-doesnt-contain-all-illegal-chars)和[MSDN](https://technet.microsoft.com/en-us/library/system.io.path.getinvalidpathchars(v=vs.85).aspx?cs-save-lang=1&cs-lang=vb#Anchor_1)
3.  定义替换字符的可能性

来源：

```
public static class FileNameCorrector
{
    private static HashSet<char> invalid = new HashSet<char>(Path.GetInvalidFileNameChars());

    public static string ToValidFileName(this string name, char replacement = '\0')
    {
        var builder = new StringBuilder();
        foreach (var cur in name)
        {
            if (cur > 31 && cur < 128 && !invalid.Contains(cur))
            {
                builder.Append(cur);
            }
            else if (replacement != '\0')
            {
                builder.Append(replacement);
            }
        }

        return builder.ToString();
    }
} 
```

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2020-05-14T12:58:28.690

这是一个用替换字符替换文件名中所有非法字符的函数：

```
public static string ReplaceIllegalFileChars(string FileNameWithoutPath, char ReplacementChar)
{
  const string IllegalFileChars = "*?/\\:<>|\"";
  StringBuilder sb = new StringBuilder(FileNameWithoutPath.Length);
  char c;

  for (int i = 0; i < FileNameWithoutPath.Length; i++)
  {
    c = FileNameWithoutPath[i];
    if (IllegalFileChars.IndexOf(c) >= 0)
    {
      c = ReplacementChar;
    }
    sb.Append(c);
  }
  return (sb.ToString());
} 
```

例如下划线可以用作替换字符：

```
NewFileName = ReplaceIllegalFileChars(FileName, '_'); 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2021-02-04T20:01:10.757

如果您必须在项目中的许多地方使用该方法，您还可以制作一个扩展方法并在项目中的任何位置调用它以获得字符串。

```
 public static class StringExtension
    {
        public static string RemoveInvalidChars(this string originalString)
        {            
            string finalString=string.Empty;
            if (!string.IsNullOrEmpty(originalString))
            {
                return string.Concat(originalString.Split(Path.GetInvalidFileNameChars()));
            }
            return finalString;            
        }
    } 
```

您可以将上述扩展方法称为：

```
string illegal = "\"M<>\"\\a/ry/ h**ad:>> a\\/:*?\"<>| li*tt|le|| la\"mb.?";
string afterIllegalChars = illegal.RemoveInvalidChars(); 
```

* * *

## 回答 #30

> 赞同：-6
> 
> 时间：2014-01-15T21:24:52.693

或者你可以做

```
[YOUR STRING].Replace('\\', ' ').Replace('/', ' ').Replace('"', ' ').Replace('*', ' ').Replace(':', ' ').Replace('?', ' ').Replace('<', ' ').Replace('>', ' ').Replace('|', ' ').Trim(); 
```

# opengl - OpenGL：如何在不更改目标 alpha 的情况下进行 RGBA->RGBA 位图

> ID：146140
> 
> 赞同：2
> 
> 时间：2008-09-28T15:55:56.997
> 
> 标签：opengl, alphablending

我有一个 OpenGL RGBA 纹理，我使用帧缓冲区对象将另一个 RGBA 纹理粘贴到它上面。问题是，如果我使用通常的混合函数和 `glBlendFunc(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA),` 生成的 blit 会导致目标纹理 alpha 发生变化，使其对于之前 alpha 为 1 的地方稍微透明。我希望目标表面 alpha 永远不会改变，否则效果RGB 值应该与`GL_SRC_ALPHA`和完全一样`GL_ONE_MINUS_SRC_ALPHA`。所以混合因子函数应该是 (As,As,As,0) 和 (1-As,1-As,1-As,1)。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-09-28T16:03:13.533

您可以将 RGB 和 alpha 的混合模式设置为不同的方程式：

```
void glBlendFuncSeparate(
    GLenum srcRGB, 
    GLenum dstRGB, 
    GLenum srcAlpha, 
    GLenum dstAlpha); 
```

在您的情况下，您想使用以下枚举：

```
 glBlendFuncSeparate(GL_SRC_ALPHA, GL_ONE_MINUS_SRC_ALPHA, GL_ZERO, GL_ONE); 
```

请注意，您可能必须将 glBlendFuncSeparate 函数作为扩展导入。不过这样做是安全的。该功能存在了很长时间。它是 OpenGL 1.4 的一部分

另一种方法是使用 glColorMask 禁用对 alpha 通道的写入：

```
void glColorMask( GLboolean red,
                  GLboolean green,
                  GLboolean blue,
                  GLboolean alpha ) 
```

它**可能**比 glBlendFuncSeparate 慢很多，因为 OpenGL 驱动程序优化了最常用的函数，而 glColorMask 是很少使用的 OpenGL 函数之一。

如果你不走运，你甚至可能通过调用古怪的函数来进行软件渲染仿真:-)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T16:00:21.807

也许你可以使用[glColorMask](http://www.opengl.org/documentation/specs/man_pages/hardcopy/GL/html/gl/colormask.html) ()？它使您可以启用/禁用对四种颜色组件中的每一种的写入。

# http - 我的表单密码是否以明文形式传递？

> ID：146146
> 
> 赞同：7
> 
> 时间：2008-09-28T15:58:40.720
> 
> 标签：http, forms

这是我的浏览器在登录某个站点时发送的内容：

```
发布 http://www.some.site/login.php HTTP/1.0
用户代理：Opera/8.26（X2000；Linux i686；Z；en）
主持人：www.some.site
接受：text/html, application/xml;q=0.9, application/xhtml+xml, image/png, image/jpeg, image/gif, image/x-xbitmap, */*;q=0.1
接受语言：en-US,en;q=0.9
接受字符集：iso-8859-1, utf-8, utf-16, *;q=0.1
接受编码：放气，gzip，x-gzip，身份，*；q=0
推荐人：http://www.some.site/
代理连接：关闭
内容长度：123
内容类型：application/x-www-form-urlencoded

lots_of_stuff=这里&e2ad811= my_login_name &e327696= my_password &lots_of_stuff=这里

```

我可以声明任何人都可以嗅探我在该站点的登录名和密码吗？也许只是在我的局域网上？
如果是这样（即使只在 LAN 上）那么我很震惊。我以为使用

```
<输入类型="密码">
```

所做的不仅仅是让所有字符看起来像'*'

ps 如果重要的话，我使用 netcat（在 linux 上）并连接
浏览器 <=> netcat（在此处登录）<=> 代理 <=> remote_site

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2008-09-28T16:00:50.450

通过 http 连接发送的每个数据都可以被您通往服务器的路径中的某个人看到（中间人攻击）。

type="password" 只隐藏屏幕上的字符，甚至您计算机上的其他程序也可以读取数据。

保护数据的唯一方法是通过 SSL（HTTPS 而不是 HTTP）发送数据

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-28T16:00:11.917

type="password" 只隐藏屏幕上的字符。如果你想停止嗅探，你需要加密连接（即HTTPS）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-28T16:19:26.270

您可以通过 HTTPS 加密 HTTP 连接，或者在 JavaScript 中实现 MD5 和其他散列算法，可用于客户端在发送密码之前对客户端进行散列，从而阻止嗅探器读取您的密码。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-28T15:59:48.050

是的，您的凭据以明文形式传递，任何可以听到您的网络流量的人都可以嗅探它们。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T16:02:18.590

如果在非加密通道上传输，POST 正文的内容是可见的，即“明文”。如果您希望保护 HTTP 正文不被嗅探，您应该通过安全通道通过[HTTPS](http://en.wikipedia.org/wiki/Https)这样做。

# asp.net - 如何使用 javascript/ASP.NET/CSS 旋转和淡入淡出背景图像

> ID：146153
> 
> 赞同：4
> 
> 时间：2008-09-28T16:00:56.830
> 
> 标签：asp.net, javascript, css, image-manipulation

我需要随机淡入淡出背景图像。

这将是一个定时功能，例如每 5 秒一次。
我需要使用 ASP.NET、Javascript、CSS 或全部三者来完成。

请大家帮帮我。谢谢你。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-28T20:48:36.983

Cycle，一个jQuery插件，是一个非常灵活的图片旋转解决方案：http: [//malsup.com/jquery/cycle/](http://malsup.com/jquery/cycle/)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-28T16:12:24.477

**这就是答案：**没关系，伙计们，在谷歌上进行更精确的搜索之后。我找到了一个很好的解决方案。

```
<html>
<head>
<!--
This file retrieved from the JS-Examples archives
http://www.js-examples.com
1000s of free ready to use scripts, tutorials, forums.
Author: Steve S - http://jsmadeeasy.com/ 
-->

<style>
body
{
/*Remove below line to make bgimage NOT fixed*/
background-attachment:fixed;
background-repeat: no-repeat;
/*Use center center in place of 300 200 to center bg image*/
background-position: 300 200;
}
</style>

<script language="JavaScript1.2">
/* you must supply your own immages */
var bgimages=new Array()
bgimages[0]="http://js-examples.com/images/blue_ball0.gif"
bgimages[1]="http://js-examples.com/images/red_ball0.gif"
bgimages[2]="http://js-examples.com/images/green_ball0.gif"

//preload images
var pathToImg=new Array()
for (i=0;i<bgimages.length;i++)
{
  pathToImg[i]=new Image()
  pathToImg[i].src=bgimages[i]
}

var inc=-1

function bgSlide()
{
  if (inc<bgimages.length-1)
    inc++
  else
    inc=0
  document.body.background=pathToImg[inc].src
}

if (document.all||document.getElementById)
  window.onload=new Function('setInterval("bgSlide()",3000)')
</script>

</head>
<body>
<BR><center><a href='http://www.js-examples.com'>JS-Examples.com</a></center> 
</body>
</html> 
```

[在这里找到它](http://www.js-x.com/page/javascripts__example.html?view=1072)。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-12-01T17:59:58.243

[刚刚在... http://www.marcofolio.net/webdesign/advanced_jquery_background_image_slideshow.html](http://www.marcofolio.net/webdesign/advanced_jquery_background_image_slideshow.html)找到了有关如何使用 CSS 背景图像和 jQuery 执行此操作的教程

看起来相当有深度。打算尝试将它用于我目前正在进行的项目。将报告结果如何。

**编辑 1**

上面引用的 jQuery 似乎已经解决了 jQuery Cycle 插件无法解决的问题。以[http://egdata.com/baf/](http://egdata.com/baf/)为例。主要问题是幻灯片包含 1500 像素宽的幻灯片，页面宽度为 960 像素。

出于某种原因，jQuery Cycle 插件在显示当前幻灯片时为宽度添加了一个 css 样式属性。最初它看起来是正确的，但在调整浏览器窗口大小时失败。Cycle 似乎在加载时设置了幻灯片的宽度，在我的情况下，我需要宽度保持 100%，而不是窗口的实际像素宽度。[http://egdata.com/baf/index_cycle.html](http://egdata.com/baf/index_cycle.html)

# c# - 针对 csc.exe 中的特定框架版本

> ID：146155
> 
> 赞同：13
> 
> 时间：2008-09-28T16:01:25.177
> 
> 标签：c#

如何通过命令行调用为 csc.exe c# 编译器指定目标框架版本（例如，没有 .csproj 文件并且不通过 MSBUILD 引擎）？

例如，使用 C# 3.0 csc.exe 编译器，您如何编译为针对 2.0 .net 框架的 IL？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-28T16:06:21.637

在 C# 3 编译器的特定情况下，只要您不使用任何不在 .NET 2.0 中的程序集或类型，就没有问题 - IL 是相同的（而不是针对 1.1，对于实例）。

除此之外，您可以使用 /noconfig /nostdlib 然后显式引用 .NET 2.0 程序集（例如在 c:\Windows\Microsoft.NET\Framework\v2.0.50727 中）。看起来 /lib 命令行选项可以让您指定一个目录来查找引用，从而使这稍微容易一些，但我自己没有尝试过。

# c - 对于繁重的计算，Fortran 比 C 更容易优化吗？

> ID：146159
> 
> 赞同：440
> 
> 时间：2008-09-28T16:02:52.707
> 
> 标签：c, performance, fortran

我不时读到 Fortran 在繁重的计算中比 C 更快或可以更快。这是真的吗？我必须承认我几乎不了解 Fortran，但到目前为止我看到的 Fortran 代码并没有表明该语言具有 C 所没有的特性。

如果是真的，请告诉我为什么。请不要告诉我哪些语言或库对数字运算有好处，我不打算编写应用程序或库来做到这一点，我只是好奇。

* * *

## 回答 #1

> 赞同：476
> 
> 时间：2008-09-28T16:14:48.763

这些语言具有相似的功能集。性能差异来自这样一个事实，即 Fortran 表示不允许使用别名，除非使用 EQUIVALENCE 语句。任何具有别名的代码都不是有效的 Fortran，但由程序员而不是编译器来检测这些错误。因此 Fortran 编译器会忽略内存指针可能的别名，并允许它们生成更高效的代码。看一下 C 中的这个小例子：

```
void transform (float *output, float const * input, float const * matrix, int *n)
{
    int i;
    for (i=0; i<*n; i++)
    {
        float x = input[i*2+0];
        float y = input[i*2+1];
        output[i*2+0] = matrix[0] * x + matrix[1] * y;
        output[i*2+1] = matrix[2] * x + matrix[3] * y;
    }
} 
```

优化后，此函数的运行速度将比 Fortran 对应函数慢。为什么这样？如果将值写入输出数组，则可以更改矩阵的值。毕竟，指针可以重叠并指向同一块内存（包括`int`指针！）。C 编译器被迫从内存中重新加载四个矩阵值以进行所有计算。

在 Fortran 中，编译器可以加载一次矩阵值并将它们存储在寄存器中。它可以这样做是因为 Fortran 编译器假定指针/数组在内存中不重叠。

幸运的是，[`restrict`](https://en.wikipedia.org/wiki/Restrict)C99 标准中引入了关键字和严格别名来解决这个问题。如今，大多数 C++ 编译器也很好地支持它。关键字允许您给编译器一个提示，即程序员承诺一个指针不会与任何其他指针产生别名。严格别名意味着程序员承诺不同类型的指针永远不会重叠，例如 a`double*`不会与 an 重叠（除了可以与任何东西重叠`int*`的特定例外）。`char*``void*`

如果您使用它们，您将从 C 和 Fortran 获得相同的速度。但是，`restrict`仅将关键字用于性能关键函数的能力意味着 C（和 C++）程序更安全、更容易编写。例如，考虑无效的 Fortran 代码：`CALL TRANSFORM(A(1, 30), A(2, 31), A(3, 32), 30)`，大多数 Fortran 编译器会在没有任何警告的情况下愉快地编译它，但会引入一个仅在某些编译器、某些硬件和一些优化选项上出现的错误。

* * *

## 回答 #2

> 赞同：169
> 
> 时间：2008-10-05T23:23:40.803

## 是的，在 1980 年；在2008？依靠

当我开始专业编程时，Fortran 的速度优势正受到挑战。我记得[在 Dobbs 博士那里读到过](http://web.archive.org/web/20090401205830/http://ubiety.uwaterloo.ca/~tveldhui/papers/DrDobbs2/drdobbs2.html)这篇文章，并把这篇文章告诉了年长的程序员——他们笑了。

所以我对此有两种观点，理论和实践。*从理论上讲*，今天的 Fortran 对 C/C++ 甚至任何允许汇编代码的语言都没有内在优势。*在实践*中，今天的 Fortran 仍然享有围绕数字代码优化构建的历史和文化遗产的好处。

直到并包括 Fortran 77，语言设计考虑都将优化作为主要焦点。由于编译器理论和技术的现状，这通常意味着*限制*特性和功能，以便为编译器提供优化代码的最佳机会。一个很好的类比是将 Fortran 77 视为牺牲速度的专业赛车。这些天来，编译器在所有语言中都变得更好，并且程序员生产力的功能更受重视。但是，在科学计算中，人们主要关心速度的地方还是有的；这些人很可能从自己是 Fortran 程序员的人那里继承了代码、培训和文化。

当一个人开始谈论代码优化时，会有很多问题，而了解这一点的最佳方式是[潜伏在人们的工作所在的地方，他们的工作就是拥有快速的数字代码](http://www.physicsforums.com/showthread.php?t=169974)。但请记住，这种极其敏感的代码通常只占整个代码行的一小部分，而且非常专业：许多 Fortran 代码与其他语言中的许多其他代码一样“低效”，[甚至不应该进行优化此类代码的主要关注点](http://en.wikipedia.org/wiki/Optimization_%28computer_science%29#When_to_optimize)。

维基百科是了解 Fortran 历史和文化的一个很好的起点。[Fortran Wikipedia 条目](http://en.wikipedia.org/wiki/Fortran)非常棒，我非常感谢那些花时间和精力使其对 Fortran 社区有价值的人。

（这个答案的缩短版本将是**Nils**开始的优秀线程中的评论，但我没有业力这样做。实际上，我可能根本不会写任何东西，但因为这个线程有实际信息内容和分享，而不是火焰战争和语言偏见，这是我对这个主题的主要体验。我不知所措，不得不分享爱。）

* * *

## 回答 #3

> 赞同：67
> 
> 时间：2008-12-29T04:56:35.537

在某种程度上，Fortran 的设计考虑了编译器优化。该语言支持编译器可以利用并行性的整个数组操作（特别是在多核处理器上）。例如，

密集矩阵乘法很简单：

```
matmul(a,b) 
```

向量 x 的 L2 范数为：

```
sqrt(sum(x**2)) 
```

此外，诸如`FORALL`, `PURE`&`ELEMENTAL`过程等语句进一步有助于优化代码。由于这个简单的原因，即使是 Fortran 中的指针也不像 C 那样灵活。

即将推出的 Fortran 标准 (2008) 具有协同数组，可让您轻松编写并行代码。G95（开源）和 CRAY 的编译器已经支持它。

所以是的，Fortran 可以很快，因为编译器可以比 C/C++ 更好地优化/并行化它。但是就像生活中的其他一切一样，有好的编译器和坏的编译器。

* * *

## 回答 #4

> 赞同：41
> 
> 时间：2011-10-30T08:42:46.200

有趣的是，这里有很多不懂语言的答案。对于已经打开旧 FORTRAN 77 代码并讨论其弱点的 C/C++ 程序员来说尤其如此。

我想速度问题主要是 C/C++ 和 Fortran 之间的问题。在巨大的代码中，它总是取决于程序员。Fortran 语言的某些功能优于 C 语言的某些功能。所以，在 2011 年，没有人能真正说出哪一个更快。

关于语言本身，Fortran 现在支持完整的 OOP 功能，并且完全向后兼容。我已经彻底使用过 Fortran 2003，我会说使用它非常愉快。在某些方面，Fortran 2003 仍然落后于 C++，但让我们看看用法。Fortran 主要用于数值计算，由于速度原因，没有人使用花哨的 C++ OOP 功能。在高性能计算中，C++ 几乎无处可去（查看 MPI 标准，您会发现 C++ 已被弃用！）。

如今，您可以简单地使用 Fortran 和 C/C++ 进行混合语言编程。Fortran 中甚至还有 GTK+ 的接口。有免费的编译器（gfortran、g95）和许多优秀的商业编译器。

* * *

## 回答 #5

> 赞同：32
> 
> 时间：2008-09-28T16:41:08.310

Fortran 速度更快的原因有很多。然而，它们的重要性是如此无关紧要，或者无论如何都可以解决，这不重要。现在使用 Fortran 的主要原因是维护或扩展遗留应用程序。

*   函数上的 PURE 和 ELEMENTAL 关键字。这些是没有副作用的功能。这允许在编译器知道将使用相同值调用相同函数的某些情况下进行优化。*注意：GCC 实现“纯”作为语言的扩展。其他编译器也可以。模块间分析也可以执行这种优化，但很难。*

*   处理数组而不是单个元素的标准函数集。sin()、log()、sqrt() 之类的东西采用数组而不是标量。这使得优化例程变得更容易。*如果这些函数是内联的或内置的，则自动矢量化在大多数情况下会带来相同的好处*

*   内置复杂类型。从理论上讲，这可以允许编译器在某些情况下重新排序或消除某些指令，但您可能会看到与`struct { double re; double im; };`C 中使用的习语相同的好处。尽管运算符在 Fortran 中处理复杂类型，但它可以加快开发速度。

* * *

## 回答 #6

> 赞同：31
> 
> 时间：2008-09-28T18:13:52.487

我认为支持 Fortran 的关键在于它是一种更适合表达基于向量和数组的数学的语言。上面指出的指针分析问题在实践中是真实存在的，因为可移植代码不能真正假设您可以告诉编译器一些事情。以更接近域外观的方式表达计算总是有优势的。C 根本没有数组，如果你仔细观察，就会发现它的行为类似于它。Fortran 有真正的 arrawys。这使得编译某些类型的算法更容易，尤其是并行机器。

在运行时系统和调用约定等方面，C 和现代 Fortran 非常相似，很难看出有什么不同。请注意，这里的 C 实际上是基础 C：C++ 是一个完全不同的问题，具有非常不同的性能特征。

* * *

## 回答 #7

> 赞同：27
> 
> 时间：2008-10-30T13:37:28.317

没有一种语言比另一种更快，所以正确的答案是**no**。

您真正要问的是“使用 Fortran 编译器 X 编译的代码是否比使用 C 编译器 Y 编译的等效代码更快？” 这个问题的答案当然取决于您选择哪两个编译器。

人们可能会问的另一个问题是“考虑到在他们的编译器中进行优化的相同数量的努力，哪个编译器会产生更快的代码？” 答案实际上是*Fortran*。Fortran 编译器具有一定的优势：

*   在有些人发誓永远不会使用编译器的时代，Fortran 不得不与 Assembly 竞争，因此它是为速度而设计的。C被设计为灵活的。
*   Fortran 的利基市场一直是数字运算。在这个领域代码*永远*不够快。因此，要保持语言的效率总是有很大的压力。
*   大多数编译器优化研究都是由对加速 Fortran 数字处理代码感兴趣的人完成的，因此优化 Fortran 代码是一个比优化任何其他编译语言更广为人知的问题，并且新的创新首先出现在 Fortran 编译器中。
*   **Biggie**：C 比 Fortran 鼓励更多的指针使用。这极大地增加了 C 程序中任何数据项的潜在范围，这使得它们更难优化。请注意，Ada 在这个领域也比 C 好得多，并且是一种比常见的 Fortran77 更现代的 OO 语言。如果您想要一种可以生成比 C 更快的代码的 OO 语言，这是您的选择。
*   再次由于其数字运算的利基，Fortran 编译器的客户往往比 C 编译器的客户更关心优化。

然而，没有什么能阻止人们在 C 编译器的优化上投入大量精力，并使其生成比他们平台的 Fortran 编译器更好的代码。事实上，C 编译器产生的更大销量使这种情况非常可行

* * *

## 回答 #8

> 赞同：20
> 
> 时间：2008-10-30T13:04:47.370

Fortran 与 C 不同，还有一个项目可能更快。Fortran 比 C 有更好的优化规则。在 Fortran 中，表达式的求值顺序是没有定义的，这允许编译器对其进行优化——如果想要强制某个顺序，则必须使用括号。在 C 中，顺序要严格得多，但使用“-fast”选项时，它们会更加宽松，并且“(...)”也会被忽略。我认为 Fortran 有一种很好的方法。（嗯，IEEE 使实时变得更加困难，因为某些评估顺序更改要求不发生溢出，这要么必须被忽略，要么妨碍评估）。

另一个更智能的规则领域是复数。不仅 C 直到 C 99 才拥有它们，而且管理它们的规则在 Fortran 中也更好；由于 gfortran 的 Fortran 库部分用 C 编写，但实现了 Fortran 语义，因此 GCC 获得了选项（也可以与“普通”C 程序一起使用）：

> -fcx-fortran-rules 复数乘法和除法遵循 Fortran 规则。范围缩小是作为复数除法的一部分完成的，但没有检查复数乘法或除法的结果是否为“NaN + I*NaN”，试图挽救这种情况。

上面提到的别名规则是另一个好处，而且 - 至少在原则上 - 整个数组操作，如果编译器的优化器适当考虑，可以导致更快的代码。另一方面是某些操作需要更多时间，例如，如果对可分配数组进行分配，则需要进行大量检查（重新分配？[Fortran 2003 功能]，具有数组步幅等），这使得简单的操作在幕后更复杂 - 因此速度较慢，但​​使语言更强大。另一方面，具有灵活边界和跨步的数组操作使得编写代码更容易——而且编译器通常比用户更好地优化代码。

总的来说，我认为 C 和 Fortran 的速度差不多。选择应该更多是更喜欢哪种语言，或者使用 Fortran 的整个数组操作及其更好的可移植性是否更有用——或者更好地与 C 中的系统和图形用户界面库接口。

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2008-10-30T13:11:05.360

我将 Fortran、C 和 C++ 的速度与 netlib 中的经典 Levine-Callahan-Dongarra 基准进行了比较。带有 OpenMP 的多语言版本是 [http://sites.google.com/site/tprincesite/levine-callahan-dongarra-vectors](http://sites.google.com/site/tprincesite/levine-callahan-dongarra-vectors) C 更丑，因为它从自动翻译开始，加上某些限制和 pragma 的插入编译器。C++ 只是在适用的情况下带有 STL 模板的 C。在我看来，STL 是否能提高可维护性是好坏参半。

自动函数内联只需要很少的练习即可查看它在多大程度上改进了优化，因为这些示例基于传统的 Fortran 实践，几乎不依赖内联。

迄今为止使用最广泛的 C/C++ 编译器缺乏自动矢量化，这些基准测试严重依赖自动矢量化。

重新发布之前的帖子：有几个示例在 Fortran 中使用括号来指示更快或更准确的评估顺序。已知的 C 编译器没有选项来观察括号而不禁用更重要的优化。

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2008-09-28T16:09:06.903

Fortran 和 C 之间的任何速度差异将更多地取决于编译器优化和特定编译器使用的底层数学库。Fortran 本身没有任何东西可以使它比 C 更快。

无论如何，一个好的程序员可以用任何语言编写 Fortran。

* * *

## 回答 #11

> 赞同：14
> 
> 时间：2008-09-28T16:35:02.363

Fortran和 C*语言*在特定目的上比另一种更快。对于这些语言中的每一种，都有一些关于特定*编译器*的事情，这使得某些任务比其他语言更适合某些任务。

多年来，Fortran 编译器一直存在，它们可以对您的数字例程施展魔法，使许多重要的计算变得异常快速。当代的 C 编译器也做不到这一点。结果，在 Fortran 中出现了许多出色的代码库。如果您想使用这些经过良好测试、成熟、出色的库，您可以使用 Fortran 编译器。

我的非正式观察表明，如今人们用任何旧语言编写繁重的计算内容，如果需要一段时间，他们会在一些廉价的计算集群上找到时间。摩尔定律让我们所有人都傻了眼。

* * *

## 回答 #12

> 赞同：13
> 
> 时间：2015-11-06T11:17:46.483

我是一个业余程序员，我在两种语言上都“平均”。我发现编写快速的 Fortran 代码比编​​写 C（或 C++）代码更容易。Fortran 和 C 都是“历史”语言（按照今天的标准），被大量使用，并且有很好的免费和商业编译器支持。

我不知道这是否是一个历史事实，但 Fortran 感觉它是为并行/分布式/矢量化/whatever-many-cores-ized 而构建的。今天，当我们谈论速度时，它几乎是“标准指标”：“它可以扩展吗？”

对于纯 CPU 运算，我喜欢 Fortran。对于任何与 IO 相关的事情，我发现使用 C 更容易。（无论如何这两种情况都很难）。

当然，对于并行数学密集型代码，您可能希望使用 GPU。C 和 Fortran 都有很多或多或少集成良好的 CUDA/OpenCL 接口（现在是 OpenACC）。

我的客观答案是：如果你对这两种语言的了解同样好/很差，那么我认为 Fortran 更快，因为我发现用 Fortran 编写并行/分布式代码比 C 更容易。（一旦你明白你可以编写“自由格式”fortran 和不仅仅是严格的 F77 代码）

对于那些愿意对我投反对票的人，这是第二个答案，因为他们不喜欢第一个答案：两种语言都具有编写高性能代码所需的功能。因此，它取决于您正在实施的算法（cpu 密集型？io 密集型？内存密集型？），硬件（单 cpu ？多核？分布式超级计算机？GPGPU ？FPGA ？），您的技能以及最终的编译器本身。C 和 Fortran 都有很棒的编译器。（我对 Fortran 编译器的先进程度感到非常惊讶，但 C 编译器也是如此）。

PS：我很高兴你特别排除了库，因为我有很多关于 Fortran GUI 库的坏话要说。:)

* * *

## 回答 #13

> 赞同：13
> 
> 时间：2016-11-10T10:16:21.003

快速简单： **两者都同样快，但 Fortran 更简单。** 到底什么更快取决于算法，但无论如何速度没有相当大的差异。这是我 2015 年在德国斯图加德高性能计算中心的 Fortran 研讨会上学到的。我同时使用 Fortran 和 C 并分享这一观点。

**解释：**

C 旨在编写操作系统。因此，它比编写高性能代码所需的自由更多。一般来说，这没有问题，但如果不仔细编程，很容易减慢代码速度。

Fortran 专为科学编程而设计。出于这个原因，它支持以语法方式编写快速代码，因为这是 Fortran 的主要目的。与舆论相反，Fortran 并不是一种过时的编程语言。它的最新标准是 2010 年，并且会定期发布新的编译器，因为大多数高性能代码都是用 Fortran 编写的。[Fortran 进一步支持现代功能作为编译器指令（在 C 编译指示中）。](https://software.intel.com/en-us/articles/getting-started-with-intel-composer-xe-2013-compiler-pragmas-and-directives)

**示例：** *我们希望将一个大型结构作为函数的输入参数（fortran：子例程）。在函数内，参数不会改变。*

C 支持按引用调用和按值调用，这是一个方便的特性。在我们的例子中，程序员可能会不小心使用按值调用。这大大减慢了速度，因为需要首先将结构复制到内存中。

Fortran 仅使用按引用调用，如果程序员真的想要按值调用操作，这会强制程序员手动复制结构。在我们的例子中，fortran 将自动与 C 版本一样快，通过引用调用。

* * *

## 回答 #14

> 赞同：12
> 
> 时间：2010-07-29T20:01:46.097

几年来，我一直在用 FORTRAN 和 C 做一些广泛的数学。根据我自己的经验，我可以说 FORTRAN 有时确实比 C 更好，但不是因为它的速度（通过使用适当的编码风格可以使 C 的性能与 FORTRAN 一样快），而是因为 LAPACK 等优化得非常好的库，并且因为伟大的并行化。在我看来，FORTRAN 真的不好用，它的优点还不足以抵消这个缺点，所以现在我用 C+GSL 来做计算。

* * *

## 回答 #15

> 赞同：10
> 
> 时间：2008-09-28T16:25:57.083

我没有听说 Fortan 比 C 快得多，但可以想象在某些情况下它会更快。关键不在于存在的语言特征，而在于（通常）不存在的语言特征。

一个例子是 C 指针。C 指针几乎无处不在，但指针的问题是编译器通常无法判断它们是否指向同一个数组的不同部分。

例如，如果您编写了一个如下所示的 strcpy 例程：

```
strcpy(char *d, const char* s)
{
  while(*d++ = *s++);
} 
```

编译器必须在 d 和 s 可能是重叠数组的假设下工作。因此，当数组重叠时，它无法执行会产生不同结果的优化。正如您所料，这极大地限制了可以执行的优化类型。

[我应该注意到 C99 有一个“restrict”关键字，它明确告诉编译器指针不重叠。另请注意，Fortran 也有指针，其语义与 C 不同，但指针不像 C 中那样无处不在。]

但是回到 C 与 Fortran 的问题，可以想象 Fortran 编译器能够执行一些优化，而这些优化对于（直接编写的）C 程序来说可能是不可能的。所以我不会对这个说法感到太惊讶。但是，我确实希望性能差异不会那么大。[~5-10%]

* * *

## 回答 #16

> 赞同：8
> 
> 时间：2008-09-28T16:28:24.253

通常 FORTRAN 比 C 慢。C 可以使用允许程序员手动优化的硬件级指针。FORTRAN（在大多数情况下）无法访问硬件内存寻址黑客。（VAX FORTRAN 是另一回事。）自 70 年代以来，我一直在使用 FORTRAN。（真的。）

然而，从 90 年代开始，FORTRAN 已经发展到包含特定的语言结构，这些结构可以优化成固有的并行算法，*可以*真正在多核处理器上尖叫。例如，自动向量化允许多个处理器同时处理数据向量中的每个元素。16 个处理器——16 个元素向量——处理时间仅为 1/16。

在 C 语言中，您必须管理自己的线程并仔细设计算法以进行多处理，然后使用一堆 API 调用来确保并行性正确发生。

在 FORTRAN 中，您只需为多处理仔细设计算法。编译器和运行时可以为您处理其余部分。

您可以阅读一些有关[高性能 Fortran](http://www.hku.hk/cc/sp2/software/hpf/rice-hpf/hpf-tutorial.html)的信息，但您会发现很多死链接。您最好阅读有关并行编程（如[OpenMP.org](http://openmp.org/wp/)）以及 FORTRAN 如何支持它的信息。

* * *

## 回答 #17

> 赞同：5
> 
> 时间：2010-07-17T03:26:08.800

更快的代码实际上并不取决于语言，而是编译器，因此您可以看到 ms-vb“编译器”生成臃肿、缓慢和冗余的目标代码，这些代码在“.exe”中捆绑在一起，但 powerBasic 生成方式太更好的代码。由 C 和 C++ 编译器生成的目标代码在某些阶段（至少 2 个）生成，但根据设计，大多数 Fortran 编译器至少有 5 个阶段，包括高级优化，因此 Fortran 将始终具有生成高度优化代码的能力。所以最后是编译器不是你应该要求的语言，我知道的最好的编译器是英特尔 Fortran 编译器，因为你可以在 LINUX 和 Windows 上得到它，你可以使用 VS 作为 IDE，如果你正在寻找一个廉价紧凑的编译器，您可以随时在 OpenWatcom 上转发。

有关此的更多信息：http: [//ed-thelen.org/1401Project/1401-IBM-Systems-Journal-FORTRAN.html](http://ed-thelen.org/1401Project/1401-IBM-Systems-Journal-FORTRAN.html)

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2015-04-05T18:17:45.443

Fortran 具有更好的 I/O 例程，例如隐含的 do 工具提供了 C 标准库无法比拟的灵活性。

Fortran 编译器直接处理涉及的更复杂的语法，并且由于这种语法不能轻易地简化为参数传递形式，C 不能有效地实现它。

* * *

## 回答 #19

> 赞同：3
> 
> 时间：2016-12-19T17:00:01.273

使用现代标准和编译器，不！

这里的一些人建议 FORTRAN 更快，因为编译器不需要担心别名（因此可以在优化期间做出更多假设）。但是，自 C99（我认为）标准以来，这已在 C 中处理，并包含了 restrict 关键字。这基本上告诉编译器，在给定范围内，指针没有别名。此外，C 支持正确的指针算法，其中别名之类的东西在性能和资源分配方面非常有用。虽然我认为最新版本的 FORTRAN 可以使用“正确”指针。

对于现代实现，C 一般优于 FORTRAN（尽管它也非常快）。

[http://benchmarksgame.alioth.debian.org/u64q/fortran.html](http://benchmarksgame.alioth.debian.org/u64q/fortran.html)

编辑：

对此的公平批评似乎是基准测试可能存在偏见。这是另一个将结果放在更多上下文中的来源（相对于 C）：

[http://julialang.org/benchmarks/](http://julialang.org/benchmarks/)

您可以看到，在大多数情况下，C 通常优于 Fortran（再次参见下面的批评，也适用于此处）；正如其他人所说，基准测试是一门不精确的科学，可以轻松加载以偏爱一种语言而不是其他语言。但它确实说明了 Fortran 和 C 如何具有相似的性能。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2018-07-02T18:31:03.780

Fortran 可以非常方便地处理数组，尤其是多维数组。在 Fortran 中对多维数组的元素进行切片比在 C/C++ 中要容易得多。C++ 现在有库可以完成这项工作，例如 Boost 或 Eigen，但它们毕竟是外部库。在 Fortran 中，这些函数是固有的。

Fortran 是否更快或更方便开发主要取决于您需要完成的工作。作为地球物理学的科学计算人员，我在 Fortran 中进行了大部分计算（我的意思是现代 Fortran，>=F90）。

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2008-09-28T16:11:32.483

这有点主观，因为它涉及编译器的质量等等。但是，为了更直接地回答您的问题，从语言/编译器的角度来看，Fortran 与 C 相比没有任何东西可以使其固有地比 C 更快或更好。如果您正在进行繁重的数学运算，它将归结为编译器的质量，每种语言程序员的技能以及支持这些操作的内在数学支持库最终确定对于给定实现哪个更快。

编辑：@Nils 等其他人提出了关于在 C 中使用指针的差异以及可能使 C 中最幼稚的实现变慢的别名的可能性的好点。但是，在 C99 中有一些方法可以解决这个问题，通过编译器优化标志和/或 C 的实际编写方式。这在@Nils 的回答和他的回答之后的后续评论中得到了很好的介绍。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2009-07-20T03:00:57.263

大多数帖子已经提出了令人信服的论点，所以我只是将众所周知的 2 美分添加到不同的方面。

最终，在处理能力方面使 fortran 更快或更慢可能有其重要性，但如果在 Fortran 中开发某些东西需要多 5 倍的时间，因为：

*   对于与纯数字运算不同的任务，它缺少任何好的库
*   它缺乏任何像样的文档和单元测试工具
*   它是一种表达能力非常低的语言，代码行数猛增。
*   它对字符串的处理很差
*   它在不同的编译器和架构之间存在大量问题，让你发疯。
*   它有一个非常糟糕的 IO 策略（顺序文件的读/写。是的，随机访问文件存在，但你有没有看到它们被使用过？）
*   它不鼓励良好的开发实践、模块化。
*   实际上缺乏完全标准、完全兼容的开源编译器（gfortran 和 g95 都不支持所有内容）
*   与 C 的互操作性非常差（修改：一个下划线，两个下划线，没有下划线，通常一个下划线，但如果有另一个下划线，则两个下划线。不要深入研究 COMMON 块......）

那么这个问题就无关紧要了。如果某些东西很慢，大多数时候你无法将它改进到超出给定的限制。如果您想要更快的速度，请更改算法。最后，计算机时间很便宜。人类时间不是。重视减少人力时间的选择。如果它增加了计算机时间，无论如何它是具有成本效益的。

* * *

## 回答 #23

> 赞同：-3
> 
> 时间：2015-05-26T13:14:37.713

Fortran 传统上不设置诸如 -fp:strict 之类的选项（ifort 需要它来启用 USE IEEE_arithmetic 中的某些功能，这是 f2003 标准的一部分）。英特尔 C++ 也没有将 -fp:strict 设置为默认值，但这是处理 ERRNO 所必需的，例如，其他 C++ 编译器无法方便地关闭 ERRNO 或获得优化，例如减少 simd。gcc 和 g++ 要求我设置 Makefile 以避免使用危险的组合 -O3 -ffast-math -fopenmp -march=native。除了这些问题之外，这个关于相对性能的问题变得更加挑剔，并且依赖于有关编译器和选项选择的本地规则。

# iphone - 如何在 iPhone 应用程序的隐藏状态栏区域中获取触摸事件？

> ID：146164
> 
> 赞同：5
> 
> 时间：2008-09-28T16:04:06.573
> 
> 标签：iphone

我有一个隐藏状态栏的 iPhone 应用程序。但是，当我点击状态栏区域时，我的主视图没有收到任何触摸事件。我能做些什么来解决这个问题吗？

以下是我的应用设置的一些细节（以防万一）：

*   这是一个基于 OpenGL 的应用程序。
*   该应用程序以横向模式启动。但是，当我点击纵向模式区域“顶部”附近的区域时，触摸事件丢失了。（换句话说，当我将设备保持在横向时，我不会在左边缘获得触摸事件。）
*   我的 info.plist 将 UIStatusBarHidden 设置为 true，并且在我的应用程序委托的 applicationDidFinishLaunching 方法中我有“application.statusBarHidden = YES;”
*   主视图已将 ExclusiveTouch 设置为 YES。
*   当我点击屏幕上的任何其他位置时，将调用视图的 touchesBegan:withEvent 方法。
*   我的视图在状态栏区域内绘制得很好。

（请不要抱怨 NDA。谢谢。）

* * *

**更新：** 事实证明，这个问题只在 iPhone 模拟器上表现出来。当应用程序在真正的 iPhone 上运行时，到处都能检测到触摸。

我仍然很想知道是否有办法让它在模拟器上运行，但这没什么大不了的。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-29T00:28:22.337

找到了我自己的答案（各种）：

此行为仅发生在 iPhone 模拟器中。当我在实际的 iPhone 上运行该应用程序时，它运行良好。

我仍然很想知道是否有办法让它在模拟器上工作。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T16:14:20.027

我没有遇到过这个问题，但话又说回来，我没有使用 OpenGL 视图。当您在横向模式下启动时，您是否设置了相应 ViewController 的 StatusBarHidden 属性？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-01-12T06:00:40.653

这是模拟器中的错误。它在 iPhone 上运行良好。检查[http://gtekna.com/?p=140](http://gtekna.com/?p=140)

# c# - .NET 字典中的重复键？

> ID：146204
> 
> 赞同：278
> 
> 时间：2008-09-28T16:33:42.383
> 
> 标签：c#, .net, dictionary, multimap

.NET 基类库中是否有允许使用重复键的字典类？我发现的唯一解决方案是创建一个类，例如：

```
Dictionary<string, List<object>> 
```

但这对于实际使用来说是相当烦人的。在 Java 中，我相信 MultiMap 可以做到这一点，但在 .NET 中找不到类似物。

* * *

## 回答 #1

> 赞同：236
> 
> 时间：2008-09-28T16:46:37.970

如果您使用的是 .NET 3.5，请使用[`Lookup`](http://msdn.microsoft.com/en-us/library/bb460184.aspx)该类。

编辑：您通常创建一个`Lookup`using [`Enumerable.ToLookup`](http://msdn.microsoft.com/en-us/library/system.linq.enumerable.tolookup.aspx). 这确实假设您之后不需要更改它 - 但我通常发现这已经足够了。

如果这对您*不起作用*，我认为框架中没有任何帮助 - 并且使用字典尽可能好:(

* * *

## 回答 #2

> 赞同：185
> 
> 时间：2009-05-08T21:02:55.110

List 类实际上非常适用于包含重复项的键/值集合，您希望在其中迭代集合。例子：

```
List<KeyValuePair<string, string>> list = new List<KeyValuePair<string, string>>();

// add some values to the collection here

for (int i = 0;  i < list.Count;  i++)
{
    Print(list[i].Key, list[i].Value);
} 
```

* * *

## 回答 #3

> 赞同：43
> 
> 时间：2012-03-23T18:14:14.540

这是使用 List< KeyValuePair< string, string >> 执行此操作的一种方法

```
public class ListWithDuplicates : List<KeyValuePair<string, string>>
{
    public void Add(string key, string value)
    {
        var element = new KeyValuePair<string, string>(key, value);
        this.Add(element);
    }
}

var list = new ListWithDuplicates();
list.Add("k1", "v1");
list.Add("k1", "v2");
list.Add("k1", "v3");

foreach(var item in list)
{
    string x = string.format("{0}={1}, ", item.Key, item.Value);
} 
```

输出 k1=v1, k1=v2, k1=v3

* * *

## 回答 #4

> 赞同：25
> 
> 时间：2008-09-28T16:39:02.747

如果您将字符串用作键和值，则可以使用[System.Collections.Specialized.NameValueCollection](http://msdn.microsoft.com/en-us/library/system.collections.specialized.namevaluecollection.aspx)，它将通过 GetValues(string key) 方法返回一个字符串值数组。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2008-09-28T16:39:45.350

我刚刚遇到了[PowerCollections](http://www.codeplex.com/PowerCollections)库，其中包括一个名为 MultiDictionary 的类。这巧妙地包装了这种类型的功能。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-09-28T16:37:47.240

我认为类似的事情`List<KeyValuePair<object, object>>`会完成这项工作。

* * *

## 回答 #7

> 赞同：14
> 
> 时间：2008-09-28T20:24:24.327

关于使用 Lookup 的非常重要的注意事项：

`Lookup(TKey, TElement)`您可以通过调用`ToLookup`实现的对象来创建 a 的实例`IEnumerable(T)`

没有公共构造函数来创建 a 的新实例`Lookup(TKey, TElement)`。此外，`Lookup(TKey, TElement)`对象是不可变的，也就是说，您不能在`Lookup(TKey, TElement)`对象创建后添加或删除元素或键。

[（来自 MSDN）](http://msdn.microsoft.com/en-us/library/bb460184.aspx)

我认为这对于大多数用途来说都是一个阻碍。

* * *

## 回答 #8

> 赞同：11
> 
> 时间：2012-08-17T05:52:21.900

如果您使用 >= .NET 4，那么您可以使用`Tuple`Class：

```
// declaration
var list = new List<Tuple<string, List<object>>>();

// to add an item to the list
var item = Tuple<string, List<object>>("key", new List<object>);
list.Add(item);

// to iterate
foreach(var i in list)
{
    Console.WriteLine(i.Item1.ToString());
} 
```

* * *

## 回答 #9

> 赞同：8
> 
> 时间：2016-04-07T03:47:13.887

“滚动你自己的”版本的字典很容易，它允许“重复键”条目。这是一个粗略的简单实现。您可能需要考虑在`IDictionary<T>`.

```
public class MultiMap<TKey,TValue>
{
    private readonly Dictionary<TKey,IList<TValue>> storage;

    public MultiMap()
    {
        storage = new Dictionary<TKey,IList<TValue>>();
    }

    public void Add(TKey key, TValue value)
    {
        if (!storage.ContainsKey(key)) storage.Add(key, new List<TValue>());
        storage[key].Add(value);
    }

    public IEnumerable<TKey> Keys
    {
        get { return storage.Keys; }
    }

    public bool ContainsKey(TKey key)
    {
        return storage.ContainsKey(key);
    }

    public IList<TValue> this[TKey key]
    {
        get
        {
            if (!storage.ContainsKey(key))
                throw new KeyNotFoundException(
                    string.Format(
                        "The given key {0} was not found in the collection.", key));
            return storage[key];
        }
    }
} 
```

关于如何使用它的简单示例：

```
const string key = "supported_encodings";
var map = new MultiMap<string,Encoding>();
map.Add(key, Encoding.ASCII);
map.Add(key, Encoding.UTF8);
map.Add(key, Encoding.Unicode);

foreach (var existingKey in map.Keys)
{
    var values = map[existingKey];
    Console.WriteLine(string.Join(",", values));
} 
```

* * *

## 回答 #10

> 赞同：7
> 
> 时间：2019-11-26T16:50:26.593

由于新的 C#（我相信它来自 7.0），您还可以执行以下操作：

```
var duplicatedDictionaryExample = new List<(string Key, string Value)> { ("", "") ... } 
```

并且您将它用作标准列表，但有两个值命名为您想要的任何值

```
foreach(var entry in duplicatedDictionaryExample)
{ 
    // do something with the values
    entry.Key;
    entry.Value;
} 
```

* * *

## 回答 #11

> 赞同：4
> 
> 时间：2010-05-28T13:00:43.623

在回答原始问题。类似的东西`Dictionary<string, List<object>>`是在一个名为`MultiMap`The 的类中实现的`Code Project`。

您可以在以下链接中找到更多信息：http: [//www.codeproject.com/KB/cs/MultiKeyDictionary.aspx](http://www.codeproject.com/KB/cs/MultiKeyDictionary.aspx)

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2008-09-28T16:41:35.813

NameValueCollection 支持一个键下的多个字符串值（这也是一个字符串），但这是我知道的唯一示例。

当我遇到需要这种功能的情况时，我倾向于创建类似于您示例中的结构。

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2011-07-19T15:37:23.183

使用该`List<KeyValuePair<string, object>>`选项时，您可以使用 LINQ 进行搜索：

```
List<KeyValuePair<string, object>> myList = new List<KeyValuePair<string, object>>();
//fill it here
var q = from a in myList Where a.Key.Equals("somevalue") Select a.Value
if(q.Count() > 0){ //you've got your value } 
```

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2008-09-28T16:38:58.953

你的意思是一致的，而不是实际的重复？否则哈希表将无法工作。

一致意味着两个单独的键可以散列到等效值，但键不相等。

例如：假设您的哈希表的哈希函数只是 hashval = key mod 3。1 和 4 都映射到 1，但是是不同的值。这就是您对列表的想法发挥作用的地方。

当您需要查找 1 时，将该值散列为 1，遍历列表，直到找到 Key = 1。

如果您允许插入重复的键，您将无法区分哪些键映射到哪些值。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2012-04-07T17:59:52.160

我使用的方式只是一个

`Dictionary<string, List<string>>`

这样，您就有一个保存字符串列表的键。

例子：

```
List<string> value = new List<string>();
if (dictionary.Contains(key)) {
     value = dictionary[key];
}
value.Add(newValue); 
```

* * *

## 回答 #16

> 赞同：2
> 
> 时间：2019-10-26T14:51:36.017

您可以创建自己的字典包装器，就像这样，作为奖励，它支持空值作为键：

```
/// <summary>
/// Dictionary which supports duplicates and null entries
/// </summary>
/// <typeparam name="TKey">Type of key</typeparam>
/// <typeparam name="TValue">Type of items</typeparam>
public class OpenDictionary<TKey, TValue>
{
    private readonly Lazy<List<TValue>> _nullStorage = new Lazy<List<TValue>>(
        () => new List<TValue>());

    private readonly Dictionary<TKey, List<TValue>> _innerDictionary =
        new Dictionary<TKey, List<TValue>>();

    /// <summary>
    /// Get all entries
    /// </summary>
    public IEnumerable<TValue> Values =>
        _innerDictionary.Values
            .SelectMany(x => x)
            .Concat(_nullStorage.Value);

    /// <summary>
    /// Add an item
    /// </summary>
    public OpenDictionary<TKey, TValue> Add(TKey key, TValue item)
    {
        if (ReferenceEquals(key, null))
            _nullStorage.Value.Add(item);
        else
        {
            if (!_innerDictionary.ContainsKey(key))
                _innerDictionary.Add(key, new List<TValue>());

            _innerDictionary[key].Add(item);
        }

        return this;
    }

    /// <summary>
    /// Remove an entry by key
    /// </summary>
    public OpenDictionary<TKey, TValue> RemoveEntryByKey(TKey key, TValue entry)
    {
        if (ReferenceEquals(key, null))
        {
            int targetIdx = _nullStorage.Value.FindIndex(x => x.Equals(entry));
            if (targetIdx < 0)
                return this;

            _nullStorage.Value.RemoveAt(targetIdx);
        }
        else
        {
            if (!_innerDictionary.ContainsKey(key))
                return this;

            List<TValue> targetChain = _innerDictionary[key];
            if (targetChain.Count == 0)
                return this;

            int targetIdx = targetChain.FindIndex(x => x.Equals(entry));
            if (targetIdx < 0)
                return this;

            targetChain.RemoveAt(targetIdx);
        }

        return this;
    }

    /// <summary>
    /// Remove all entries by key
    /// </summary>
    public OpenDictionary<TKey, TValue> RemoveAllEntriesByKey(TKey key)
    {
        if (ReferenceEquals(key, null))
        {
            if (_nullStorage.IsValueCreated)
                _nullStorage.Value.Clear();
        }       
        else
        {
            if (_innerDictionary.ContainsKey(key))
                _innerDictionary[key].Clear();
        }

        return this;
    }

    /// <summary>
    /// Try get entries by key
    /// </summary>
    public bool TryGetEntries(TKey key, out IReadOnlyList<TValue> entries)
    {
        entries = null;

        if (ReferenceEquals(key, null))
        {
            if (_nullStorage.IsValueCreated)
            {
                entries = _nullStorage.Value;
                return true;
            }
            else return false;
        }
        else
        {
            if (_innerDictionary.ContainsKey(key))
            {
                entries = _innerDictionary[key];
                return true;
            }
            else return false;
        }
    }
} 
```

使用示例：

```
var dictionary = new OpenDictionary<string, int>();
dictionary.Add("1", 1); 
// The next line won't throw an exception; 
dictionary.Add("1", 2);

dictionary.TryGetEntries("1", out List<int> result); 
// result is { 1, 2 }

dictionary.Add(null, 42);
dictionary.Add(null, 24);
dictionary.TryGetEntries(null, out List<int> result); 
// result is { 42, 24 } 
```

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2011-05-23T16:11:43.410

我偶然发现了这篇文章以寻找相同的答案，但没有找到，所以我使用字典列表构建了一个简单的示例解决方案，覆盖 [] 运算符以在所有其他人都有一个新字典时添加一个给定键（set），并返回值列表（get）。
它丑陋且效率低下，它只能通过键获取/设置，并且它总是返回一个列表，但它可以工作：

```
 class DKD {
        List<Dictionary<string, string>> dictionaries;
        public DKD(){
            dictionaries = new List<Dictionary<string, string>>();}
        public object this[string key]{
             get{
                string temp;
                List<string> valueList = new List<string>();
                for (int i = 0; i < dictionaries.Count; i++){
                    dictionaries[i].TryGetValue(key, out temp);
                    if (temp == key){
                        valueList.Add(temp);}}
                return valueList;}
            set{
                for (int i = 0; i < dictionaries.Count; i++){
                    if (dictionaries[i].ContainsKey(key)){
                        continue;}
                    else{
                        dictionaries[i].Add(key,(string) value);
                        return;}}
                dictionaries.Add(new Dictionary<string, string>());
                dictionaries.Last()[key] =(string)value;
            }
        }
    } 
```

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2018-04-30T17:50:01.653

我将 @Hector Correa 的答案更改为具有泛型类型的扩展，并为其添加了自定义 TryGetValue。

```
 public static class ListWithDuplicateExtensions
  {
    public static void Add<TKey, TValue>(this List<KeyValuePair<TKey, TValue>> collection, TKey key, TValue value)
    {
      var element = new KeyValuePair<TKey, TValue>(key, value);
      collection.Add(element);
    }

    public static int TryGetValue<TKey, TValue>(this List<KeyValuePair<TKey, TValue>> collection, TKey key, out IEnumerable<TValue> values)
    {
      values = collection.Where(pair => pair.Key.Equals(key)).Select(pair => pair.Value);
      return values.Count();
    }
  } 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2017-11-28T10:18:11.817

这是一种双向并发字典，我认为这会对您有所帮助：

```
public class HashMapDictionary<T1, T2> : System.Collections.IEnumerable
{
    private System.Collections.Concurrent.ConcurrentDictionary<T1, List<T2>> _keyValue = new System.Collections.Concurrent.ConcurrentDictionary<T1, List<T2>>();
    private System.Collections.Concurrent.ConcurrentDictionary<T2, List<T1>> _valueKey = new System.Collections.Concurrent.ConcurrentDictionary<T2, List<T1>>();

    public ICollection<T1> Keys
    {
        get
        {
            return _keyValue.Keys;
        }
    }

    public ICollection<T2> Values
    {
        get
        {
            return _valueKey.Keys;
        }
    }

    public int Count
    {
        get
        {
            return _keyValue.Count;
        }
    }

    public bool IsReadOnly
    {
        get
        {
            return false;
        }
    }

    public List<T2> this[T1 index]
    {
        get { return _keyValue[index]; }
        set { _keyValue[index] = value; }
    }

    public List<T1> this[T2 index]
    {
        get { return _valueKey[index]; }
        set { _valueKey[index] = value; }
    }

    public void Add(T1 key, T2 value)
    {
        lock (this)
        {
            if (!_keyValue.TryGetValue(key, out List<T2> result))
                _keyValue.TryAdd(key, new List<T2>() { value });
            else if (!result.Contains(value))
                result.Add(value);

            if (!_valueKey.TryGetValue(value, out List<T1> result2))
                _valueKey.TryAdd(value, new List<T1>() { key });
            else if (!result2.Contains(key))
                result2.Add(key);
        }
    }

    public bool TryGetValues(T1 key, out List<T2> value)
    {
        return _keyValue.TryGetValue(key, out value);
    }

    public bool TryGetKeys(T2 value, out List<T1> key)
    {
        return _valueKey.TryGetValue(value, out key);
    }

    public bool ContainsKey(T1 key)
    {
        return _keyValue.ContainsKey(key);
    }

    public bool ContainsValue(T2 value)
    {
        return _valueKey.ContainsKey(value);
    }

    public void Remove(T1 key)
    {
        lock (this)
        {
            if (_keyValue.TryRemove(key, out List<T2> values))
            {
                foreach (var item in values)
                {
                    var remove2 = _valueKey.TryRemove(item, out List<T1> keys);
                }
            }
        }
    }

    public void Remove(T2 value)
    {
        lock (this)
        {
            if (_valueKey.TryRemove(value, out List<T1> keys))
            {
                foreach (var item in keys)
                {
                    var remove2 = _keyValue.TryRemove(item, out List<T2> values);
                }
            }
        }
    }

    public void Clear()
    {
        _keyValue.Clear();
        _valueKey.Clear();
    }

    IEnumerator IEnumerable.GetEnumerator()
    {
        return _keyValue.GetEnumerator();
    }
} 
```

例子：

```
public class TestA
{
    public int MyProperty { get; set; }
}

public class TestB
{
    public int MyProperty { get; set; }
}

            HashMapDictionary<TestA, TestB> hashMapDictionary = new HashMapDictionary<TestA, TestB>();

            var a = new TestA() { MyProperty = 9999 };
            var b = new TestB() { MyProperty = 60 };
            var b2 = new TestB() { MyProperty = 5 };
            hashMapDictionary.Add(a, b);
            hashMapDictionary.Add(a, b2);
            hashMapDictionary.TryGetValues(a, out List<TestB> result);
            foreach (var item in result)
            {
                //do something
            } 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2019-05-17T11:25:36.833

我使用这个简单的类：

```
public class ListMap<T,V> : List<KeyValuePair<T, V>>
{
    public void Add(T key, V value) {
        Add(new KeyValuePair<T, V>(key, value));
    }

    public List<V> Get(T key) {
        return FindAll(p => p.Key.Equals(key)).ConvertAll(p=> p.Value);
    }
} 
```

用法：

```
var fruits = new ListMap<int, string>();
fruits.Add(1, "apple");
fruits.Add(1, "orange");
var c = fruits.Get(1).Count; //c = 2; 
```

* * *

## 回答 #21

> 赞同：-1
> 
> 时间：2015-05-25T12:50:11.767

您可以定义一种方法来构建复合字符串键，每个您想使用字典的地方都必须使用此方法来构建您的键，例如：

```
private string keyBuilder(int key1, int key2)
{
    return string.Format("{0}/{1}", key1, key2);
} 
```

使用：

```
myDict.ContainsKey(keyBuilder(key1, key2)) 
```

* * *

## 回答 #22

> 赞同：-3
> 
> 时间：2008-09-28T16:38:09.253

重复的键会破坏 Dictionary 的整个合同。在字典中，每个键都是唯一的并映射到单个值。如果您想将一个对象链接到任意数量的其他对象，最好的选择可能是类似于 DataSet 的东西（通常的说法是表）。将您的键放在一列中，将您的值放在另一列中。这比字典慢得多，但这是您失去散列关键对象能力的权衡。

* * *

## 回答 #23

> 赞同：-4
> 
> 时间：2015-04-19T21:19:39.577

这也是可能的：

```
Dictionary<string, string[]> previousAnswers = null; 
```

这样，我们就可以拥有唯一的键。希望这对你有用。

* * *

## 回答 #24

> 赞同：-11
> 
> 时间：2015-01-15T23:07:15.317

您可以添加具有不同大小写的相同键，例如：

键1
键1
键1 键 1
键
1 键
1

我知道是虚拟答案，但对我有用。

# c++ - 你在 C++ 中使用什么来表示定点？

> ID：146207
> 
> 赞同：22
> 
> 时间：2008-09-28T16:36:00.863
> 
> 标签：c++, performance, math, fixed-point

我正在寻找用于财务数据的定点标准，您知道有什么值得尝试的吗？你对那个手工定点类的性能有什么经验吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-28T17:21:34.843

哎哟。金融系统很棘手，您的主要问题不是定点数学，而是舍入误差。

您可以拥有一个漂亮的电子表格，其中包含按客户类型和增值税计算的折扣。你做了一个总数，你把它提交给一个会计师，他说这些值都是错误的。原因：输出的格式可能只有 2 个小数位，但在内部，该值具有浮点数或双精度数的所有小数位。他们确实加起来了。

您需要了解您的财务状况并决定基值在哪里。这意味着会计师将检查哪些值（是的，它需要业务知识，提高“棘手”部分）。

在将值保存到持久形式（数据库、文件、内存......）之前，您会截断乘法和除法可能添加的额外小数位。

N个小数位的快速而肮脏的解决方案：((double)((int)(Value * N * 10.0)))/10.0

当然，您需要准确检查您的财务需要哪种四舍五入。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-28T16:40:40.230

Dr.Dobb's 有一篇关于 C++ 中定点算术类型的可能实现的文章。看看[这个](http://www.ddj.com/cpp/184401992)。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-28T18:35:51.497

我使用我的定点数学课。它旨在或多或少地替代浮动/双打。[http://codef00.com/coding](http://codef00.com/coding)

**编辑**：作为旁注，我个人不会为此目的使用定点类。相反，我只会存储美分的数量（或十分之一美分，或需要的百分之一美分）。A 直接用它做数学。然后我会在向用户显示时适当地缩放值。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-28T16:42:12.380

IBM 的[decNumber++](http://www.alphaworks.ibm.com/tech/decnumberplusplus?open&S_TACT=105AGX59&ca=dgr-lnxw03decnumberplusplus)

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2014-01-16T23:01:01.680

### 试图直接回答

Markus Trenkwalder 有一个支持一些数学函数的函数 - [http://www.trenki.net/content/view/17/1/](http://www.trenki.net/content/view/17/1/)：

> 该库包含用于处理定点数的各种函数（乘法、除法、求逆、sin、cos、sqrt、rsqrt）。它还包含一个 C++ 包装类，可用于大大简化使用定点数的工作。我将这个定点数类与我的 vector_math 库结合使用，以获得一个定点向量数学库。与浮点版本相比，这样做使 3D 计算快得多。

作者特意说他的平台不支持浮点，这就是他这样做的原因。另外，请注意，它是用于 3D 渲染的，问题是针对**财务数据**的，我们需要一个好的数学函数库......

### IEEE 754-2008 Decimal Floating-Point Arithmetic 规范，针对金融应用

这看起来像是一种处理财务数据的既定方法，得到了很好的支持（来自英特尔和 IEEE） - [http://software.intel.com/en-us/articles/intel-decimal-floating-point-math-library](http://software.intel.com/en-us/articles/intel-decimal-floating-point-math-library)

去引用：

> IEEE 754-2008 Decimal Floating-Point Arithmetic 规范，针对金融应用，特别是在法律要求必须使用十进制而不是二进制浮点算术的情况下（因为使用二进制浮点运算执行的计算可能会引入少量、但不可接受的错误）。

虽然它**不是**定点的，但我认为它对于寻求这个问题的答案的人来说非常有用。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2014-01-10T11:36:58.313

ISO 指定了 C 的十进制扩展名 TR 24732 和 C++ 的 TR 24733。它们可在[ISO 网站上](http://www.iso.org/)购买。它还不是任何已发布的 C++ 标准的一部分。GCC 提供了[内置类型](http://gcc.gnu.org/onlinedocs/gcc/Decimal-Float.html)和[它的库实现](http://gcc.gnu.org/onlinedocs/libstdc++/manual/status.html)。[英特尔提供了](http://software.intel.com/en-us/articles/intel-decimal-floating-point-math-library/)另一种实现方式 。将其包含在 C++ 中的最新推动是[在这里](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3407.html)。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2014-01-10T12:11:46.177

一个 64 位的 int 类型应该足以以美分表示所有财务价值。

对于正确的一些定义，您只需要小心正确地舍入*百分比*。

# asp.net - 在表中搜索并获取结果和结果数量的最佳方法（MySQL）

> ID：146212
> 
> 赞同：3
> 
> 时间：2008-09-28T16:37:18.070
> 
> 标签：asp.net, mysql, performance, search

我有一个“项目”表和一个“项目关键字”表。当用户搜索关键字时，我想给他一页结果加上结果总数。

我目前正在做的是（对于搜索“ab c”的用户：

```
SELECT DISTINCT {fields I want} FROM itemkeywords JOIN items   
    WHERE (keyword = 'a' or keyword='b' or keyword='c'
    ORDER BY "my magic criteria"
    LIMIT 20.10 
```

然后我用计数做同样的查询

```
SELECT COUNT(*) FROM itemkeywords JOIN items   
    WHERE (keyword = 'a' or keyword='b' or keyword='c' 
```

这可能会得到一张相当大的桌子，我认为这个解决方案非常糟糕......
但我想不出更好的办法。

避免命中 MySQL 两次的明显替代方法，即只执行第一个查询，没有 LIMIT 子句，然后导航到正确的记录以显示相应的页面，然后到记录集的末尾以计算结果似乎更糟糕...

有任何想法吗？

注意：我使用的是 ASP.Net 和 MySQL，而不是 PHP

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-28T16:47:00.307

在有限选择中的选择之后添加 SQL_CALC_FOUND_ROWS，然后在第一次选择完成后执行“SELECT FOUND_ROWS()”。

例子：

```
mysql> SELECT SQL_CALC_FOUND_ROWS * FROM tbl_name
    -> WHERE id > 100 LIMIT 10;
mysql> SELECT FOUND_ROWS(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-11-10T03:43:05.343

如果您真的担心性能并且最终需要进行两次查询，您可能需要考虑缓存匹配的总数，因为这不会随着用户浏览结果页面而改变。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T16:48:54.873

您有 2 个选项：

MySQL API 应该有一个返回行数的函数。使用较旧的 API 其 mysql_num_rows()。如果您使用的是无缓冲查询，这将不起作用。

更简单的方法可能是结合您的两个查询：

```
SELECT DISTINCT {fields I want}, count(*) as results 
       FROM itemkeywords JOIN items   
       WHERE (keyword = 'a' or keyword='b' or keyword='c'
       ORDER BY "my magic criteria"
       LIMIT 20.10 
```

我做了一些测试，count(*) 函数不受限制子句的影响。我会`DESCRIBE`先对此进行测试。我不知道这会对您的查询速度产生多大影响。只需要给出前 10 个结果的查询应该比必须找到计数的所有结果的查询要短，然后是前 10 个。但我在这里可能错了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-28T16:50:02.530

您可能会在第一条语句中查看 MySQL `SQL_CALC_FOUND_ROWS`，然后是第二条语句`SELECT FOUND_ROWS()`，这至少可以防止您执行 2 次数据查询，但仍倾向于执行一次整个表扫描。

请参阅[http://dev.mysql.com/doc/refman/5.0/en/select.html](http://dev.mysql.com/doc/refman/5.0/en/select.html)和 [http://dev.mysql.com/doc/refman/5.0/en/information-functions.html](http://dev.mysql.com/doc/refman/5.0/en/information-functions.html)

最好考虑一下：你*真的*需要这个功能吗？

# nant - nant：我可以提取路径中的最后一个目录吗？

> ID：146230
> 
> 赞同：1
> 
> 时间：2008-09-28T16:47:23.817
> 
> 标签：nant

在 Nant 中，我希望能够在路径中提取目录的姓氏。
例如，我们有路径 'c:\my_proj\source\test.my_dll\'

我想通过该路径并提取“test.my_dll”

有没有办法轻松做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2014-10-10T13:22:47.160

您实际上可以使用现有的 NAnt 字符串函数来实现。就是有点丑。。。

```
${string::substring(path, string::last-index-of(path, '\') + 1, string::get-length(path) - string::last-index-of(path, '\') - 1)} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2013-02-12T16:34:30.877

可以找到路径的父目录，然后使用字符串替换来查找您要查找的文件夹：

> ```
> <property name="some.dir" value="c:\my_proj\source\test.my_dll" />
> <property name="some.dir.parent" value="${directory::get-parent-directory(some.dir)}" />
> <property name="directory" value="${string::replace(some.dir, some.dir.parent + '\', '') }" /> 
> ```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2014-06-22T07:37:21.700

您可能想尝试添加到 nant 0.93 的新功能（尽管仍在夜间构建中）-

`directory::get-name(path)`

这将返回`path`.

参考[nant帮助](http://nant.sourceforge.net/nightly/latest/help/functions/directory.get-name%28System.String%29.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-28T17:10:30.687

查看[脚本](http://nant.sourceforge.net/release/0.85/help/tasks/script.html)任务。您可以使用 C# 或其他方式编写自定义代码，并返回一个可以分配给属性的值。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T17:13:25.690

不，您需要为类似的事情编写自定义任务。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-03-10T09:22:12.023

扩展史蒂夫 K：

```
<script language="C#" prefix="path" >
    <code>
        <![CDATA[
          [Function("get-dir-name")]
          public static string GetDirName(string path) {
              return System.IO.Path.GetFileName(path);
          }
        ]]>
    </code>
 </script>

<target name="build">
    <foreach item="Folder" in="." property="path">
        <echo message="${path::get-dir-name(path)}" />
    </foreach>
</target> 
```

# language-agnostic - 推还是拉？将按键转换为游戏车辆的速度

> ID：146250
> 
> 赞同：4
> 
> 时间：2008-09-28T16:58:25.523
> 
> 标签：language-agnostic

我应该在车辆被按下时将按键推到车辆上，还是车辆应该从发动机上拉出按键？

我有一个车辆对象，它具有位置、速度和加速度成员（除其他外）和一个更新方法，在此期间它根据其速度更新其位置，并根据其加速度更新其速度。

我有一个包含游戏循环的游戏对象，它调用车辆上的更新方法。

如果玩家用箭头键控制车辆，按键是否设置加速（推）和按键释放清除速度，或者车辆是否应该询问游戏引擎是否按下加速键（拉）？我认为推送意味着键盘控制模块需要了解车辆，而拉动意味着车辆需要了解特定的键盘控制。

我认为一个相关的问题是这样的：所有对象都应该知道所有其他对象，还是应该有严格的层次结构，所以对象可以向树上的其他对象询问/告诉其他对象，但不能向下（反之亦然)?

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-28T17:04:13.963

您应该尝试遵循[订阅/观察者](http://en.wikipedia.org/wiki/Observer_pattern)模式。您将所有关键捕获代码放入一个[单例](http://en.wikipedia.org/wiki/Singleton_pattern)InputManager 中，然后将需要对输入做出反应的每个对象都注册到管理器中。

管理器保存订阅对象的列表，并在按下/按下键时向它们发送事件。只是不要忘记在对象被删除或“失去焦点”时取消订阅。

这避免了轮询问题。很少有例外情况需要轮询解决方案。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-29T13:21:36.953

IMO，您的车辆不应该对键盘、鼠标或游戏手柄一无所知。您的输入处理代码也不应该对您的车辆有任何了解。输入处理代码应该读取每个玩家的输入，并将其翻译成某种特定于他们上下文的指令。例如，如果玩家一正在驾驶汽车，他的指令可能包括方向盘旋转、加速度和制动值。而驾驶飞机的玩家可能需要俯仰、偏航等。

通过将游戏手柄输入（或其他）转换为适当的指令类型，您可以将输入机制与游戏逻辑分离。这种级别的解耦可能会做的一件事是从网络输入创建一个“CarInstruction”。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T17:06:40.370

如果没有更深入地了解游戏引擎的工作原理，很难回答这个问题。话虽如此，我会尝试一下。“按下键盘”方法对我来说就像“事件”或“回调”策略。您在某处定义了一个函数，该函数看起来就像`def handle_key_event(name_of_key):`每当发生关键事件时都会调用该函数。这样做的好处是，从可读性的角度来看，您可以准确地知道关键事件的处理位置。不利的一面是，每次按键都需要被视为原子操作。如果您需要在其他键的状态周围保留大量状态变量以确定每次按下的内容，它可能会有点混乱。

另一方面，如果您按下按键，则会在捕捉按键时引入固有的延迟。你不会比你的滴答率/帧率更快地捕捉到关键事件。如果您的游戏运行得又快又好，这很好，但是当您的帧速率变慢时，您不希望 UI 变得完全跳动/滞后。

我猜只是深思熟虑。最重要的是，选择一个策略并坚持下去。例如，如果键盘事件是回调，请不要对鼠标事件使用“拉动”方法。在 IMO 中，一致性比正确性更重要。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T14:05:14.433

@Joel：我同意——车辆不应该知道具体的硬件控制，输入处理代码不应该知道任何关于车辆的信息。应该有一些从钥匙映射到车辆的中间类。感谢您的贡献！

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-10-02T06:47:01.933

你想投票：

```
void UpdateVehicleFromInput()
{
   if (InputSystem()->IsKeyDown(key))
      DoSomething();
} 
```

这当然是“你的更新循环中适合你设计的某个地方”如果你想把那个特定的地方称为“你的输入系统的一部分”或“你的游戏逻辑的一部分”或其他任何东西，那就把自己打晕。

这样你就知道你为什么做某事（因为钥匙被按下了），你可以简单地调整条件，你知道你正在做某事一次且恰好一次（并且你可以改变它而不会产生任何后果，特别是如果车辆没有' t 存在），并且你知道你什么时候在做某事（在你说之前或之后，对伤害做出反应，或者定位你的粒子效果，或者谁知道还有什么）。

如果您确实在进行跨平台开发，那么抽象输入系统可能是有效的。对于休闲开发来说，这是非常不必要的（但当你用完游戏设计想法来实现时，这是一种有趣的技术分心）。

Contrary to irrational popular belief, there's no downside to polling. Processors do > 1B things a second, one IF a frame is irrelevant (pretty much the only relevant cpu operations are N^2 where N>100 and blowing your l2 cache and of course busy waiting for disk access). Polling input is O(1).

# .net - 如果选中，则更改列表框项的 WPF DataTemplate

> ID：146269
> 
> 赞同：91
> 
> 时间：2008-09-28T17:10:39.207
> 
> 标签：.net, wpf

我需要根据是否选择项目来更改 ListBox 中项目的 DataTemplate（选择时显示不同/更多信息）。

单击有问题的 ListBox 项（仅通过选项卡）时，我没有在 DataTemplate（StackPanel）的最顶部元素上获得 GotFocus/LostFocus 事件，而且我没有想法。

* * *

## 回答 #1

> 赞同：187
> 
> 时间：2008-09-28T18:25:32.833

最简单的方法是为“ItemContainerStyle”而不是“ItemTemplate”属性提供模板。在下面的代码中，我创建了 2 个数据模板：一个用于“未选中”，一个用于“选中”状态。然后，我为“ItemContainerStyle”创建一个模板，该模板是包含该项目的实际“ListBoxItem”。我将默认的“ContentTemplate”设置为“未选择”状态，然后提供一个触发器，当“IsSelected”属性为真时交换模板。（注意：为简单起见，我将后面代码中的“ItemsSource”属性设置为字符串列表）

```
<Window.Resources>

<DataTemplate x:Key="ItemTemplate">
    <TextBlock Text="{Binding}" Foreground="Red" />
</DataTemplate>

<DataTemplate x:Key="SelectedTemplate">
    <TextBlock Text="{Binding}" Foreground="White" />
</DataTemplate>

<Style TargetType="{x:Type ListBoxItem}" x:Key="ContainerStyle">
    <Setter Property="ContentTemplate" Value="{StaticResource ItemTemplate}" />
    <Style.Triggers>
        <Trigger Property="IsSelected" Value="True">
            <Setter Property="ContentTemplate" Value="{StaticResource SelectedTemplate}" />
        </Trigger>
    </Style.Triggers>
</Style>

</Window.Resources>
<ListBox x:Name="lstItems" ItemContainerStyle="{StaticResource ContainerStyle}" /> 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2014-12-23T04:48:14.587

要在选择或不选择项目时设置样式，您需要做的就是检索您的`ListBoxItem`父项`<DataTemplate>`并在其更改时触发样式`IsSelected`更改。例如，下面的代码将创建一个`TextBlock`默认`Foreground`颜色为**green**。现在，如果该项目被选中，字体将变为**红色**，当鼠标悬停在该项目上时，该项目将变为**黄色**。这样，您就不需要像其他答案中建议的那样为您想要稍微更改的每个状态指定单独的数据模板。

```
<DataTemplate x:Key="SimpleDataTemplate">
    <TextBlock Text="{Binding}">
        <TextBlock.Style>
            <Style>
                <Setter Property="TextBlock.Foreground" Value="Green"/>
                <Style.Triggers>
                    <DataTrigger Binding="{Binding Path=IsSelected, RelativeSource={
                        RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBoxItem }}}"
                                 Value="True">
                        <Setter Property="TextBlock.Foreground" Value="Red"/>
                    </DataTrigger>
                    <DataTrigger Binding="{Binding Path=IsMouseOver, RelativeSource={
                        RelativeSource Mode=FindAncestor, AncestorType={x:Type ListBoxItem }}}"
                                 Value="True">
                        <Setter Property="TextBlock.Foreground" Value="Yellow"/>
                    </DataTrigger>
                </Style.Triggers>
            </Style>
        </TextBlock.Style>
    </TextBlock>
</DataTemplate> 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-28T21:05:51.090

还应该注意的是，stackpanel 是不可聚焦的，所以它永远不会获得焦点（如果你/真的/希望它集中，请设置 Focusable=True）。但是，在这种情况下要记住的关键是 Stackpanel 是TreeViewItem 的**子**项，在这种情况下是 ItemContainer。正如 Micah 所建议的，调整 itemcontainerstyle 是一个好方法。

您可能可以使用 DataTemplates 以及诸如使用 RelativeSouce 标记扩展来查找 listviewitem 的数据触发器之类的东西来做到这一点

# c++ - C++ 中的默认传递引用语义

> ID：146271
> 
> 赞同：7
> 
> 时间：2008-09-28T17:13:13.803
> 
> 标签：c++, programming-languages, syntax, semantics

**编辑：这个问题更多的是关于语言工程而不是 C++ 本身。我以 C++ 为例来展示我想要的东西，主要是因为我每天都在使用它。我不想知道它在 C++ 上是如何工作的，但我想就如何完成它展开*讨论*。**

这不是它现在的工作方式，这是我*希望*它可以完成的方式，这肯定会破坏 C 的兼容性，但这就是我认为 extern "C" 的全部意义所在。

我的意思是，在您现在声明的每个函数或方法中，您必须明确写入该对象将通过在其上加上引用运算符的引用发送。我希望每一个非 POD 类型都可以通过引用自动发送，因为我经常使用它，实际上对于大小超过 32 位的每个对象，这几乎是我的每个类。

让我们举例说明一下现在的情况，假设*a*，*b*和*c*是类：

```
类示例{
    上市：
        int just_use_a(const a &object);
        int use_and_mess_with_b(b &object);
        无效 do_nothing_on_c(c 对象);
};

```

现在我希望：

```
类示例{
    上市：
        int just_use_a(const a object);
        int use_and_mess_with_b(b 对象);
        extern "C" void do_nothing_on_c(c object);
};

```

现在，do_nothing_on_c() 可以像今天一样运行。

这至少对我来说会很有趣，感觉更清楚，而且如果你*知道*每个非 POD 参数都是通过引用来的，我相信如果你必须明确声明它，错误将是相同的。

这种变化的另一个观点，来自 C 的人，在我看来，引用运算符是一种获取变量*address*的方法，这就是我用来获取指针的方式。我的意思是，它是同一个运算符，但在不同的上下文中具有不同的语义，这对您来说是不是也有点不对劲？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-28T18:41:07.163

我猜你错过了 C++ 和 C++ 语义的重点。您错过了**C++ 通过值传递（几乎）所有内容是正确的事实，因为它是在 C 中完成的方式。 Always**。但不仅在 C 中，我将在下面向您展示...

## C上的参数语义

在 C 中，一切都是按值传递的。“primitives”和“PODs”通过复制它们的值来传递。在你的函数中修改它们，原来的不会被修改。尽管如此，复制一些 POD 的成本可能并不小。

当您使用指针表示法（*）时，您不会通过引用传递。您正在传递地址的副本。这或多或少是相同的，只有一个细微的区别：

```
typedef struct { int value ; } P ;

/* p is a pointer to P */
void doSomethingElse(P * p)
{
   p->value = 32 ;
   p = malloc(sizeof(P)) ; /* Don't bother with the leak */
   p->value = 45 ;
}

void doSomething()
{
   P * p = malloc(sizeof(P)) ;
   p->value = 25 ;

   doSomethingElse(p) ;

     int i = p->value ;
   /* Value of p ? 25 ? 32 ? 42 ? */
} 
```

p->value 的最终值是 32。因为 p 是通过复制地址的值来传递的。所以原来的 p 没有被修改（并且新的 p 被泄露了）。

## Java 和 C Sharp 上的参数语义

有些人可能会感到惊讶，但在 Java 中，所有内容也是按值复制的。上面的 C 示例将在 Java 中给出完全相同的结果。这几乎是您想要的，但您无法像在 C 中那样轻松地“通过引用/指针”传递原始数据。

在 C# 中，他们添加了“ref”关键字。它的工作方式或多或少类似于 C++ 中的参考。关键是，在 C# 中，您必须在函数声明和每次调用中都提及它。我想这又不是你想要的。

## C++ 上的参数语义

在 C++ 中，几乎所有内容都是通过复制值来传递的。当您只使用符号的类型时，您正在复制符号（就像在 C 中所做的那样）。这就是为什么当您使用 * 时，您传递的是符号地址的副本。

但是，当您使用 & 时，假设您传递的是真实对象（无论是结构、int、指针等）：引用。

很容易将其误认为是语法糖（即，在幕后，它像指针一样工作，生成的代码与用于指针的代码相同）。但...

事实是，引用不仅仅是语法糖。

*   与指针不同，它授权像在堆栈上一样操作对象。
*   Unline 指针，当与 const 关键字相关联时，它授权从一种类型到另一种类型的隐式提升（主要通过构造函数）。
*   与指针不同，符号不应为 NULL/无效。
*   与“按副本”不同，您不会花费无用的时间来复制对象
*   与“by-copy”不同，您可以将其用作 [out] 参数
*   与“by-copy”不同，您可以在 C++ 中使用全方位的 OOP（即，您将完整的对象传递给等待接口的函数）。

因此，引用具有两全其美的优点。

让我们看看 C 示例，但在 doSomethingElse 函数上有一个 C++ 变体：

```
struct P { int value ; } ;

// p is a reference to a pointer to P
void doSomethingElse(P * & p)
{
   p->value = 32 ;
   p = (P *) malloc(sizeof(P)) ; // Don't bother with the leak
   p->value = 45 ;
}

void doSomething()
{
   P * p = (P *) malloc(sizeof(P)) ;
   p->value = 25 ;

   doSomethingElse(p) ;

     int i = p->value ;
   // Value of p ? 25 ? 32 ? 42 ?
} 
```

结果是 42，旧的 p 被泄露，被新的 p 代替。因为，与 C 代码不同，我们传递的不是指针的副本，而是指针的引用，即指针本身。

使用 C++ 时，上面的示例必须非常清楚。如果不是，那么你错过了一些东西。

## 结论

**C++ 是按复制/值传递的，因为它是一切工作的方式，无论是在 C、C# 还是在 Java 中（甚至在 JavaScript 中...... :-p ...）。和 C# 一样，C++ 有一个引用运算符/关键字，*作为奖励*。**

现在，据我了解，您可能正在做我所说的半开玩笑的**C+**，即具有一些有限 C++ 功能的 C。

也许您的解决方案是使用 typedefs（不过，它会激怒您的 C++ 同事，看到代码被无用的 typedefs 污染......），但这样做只会混淆您确实在那里缺少 C++ 的事实。

正如在另一篇文章中所说，您应该将您的思维方式从 C 开发（无论什么）转变为 C++ 开发，或者您可能应该转向另一种语言。但是不要继续使用 C++ 特性以 C 方式编程，因为通过有意识地忽略/混淆您使用的习语的力量，您将生成次优代码。

注意：并且不要通过复制除原语之外的任何其他内容。你会从它的面向对象能力中阉割你的函数，而在 C++ 中，这不是你想要的。

## 编辑

*问题*有所*修改（请参阅[https://stackoverflow.com/revisions/146271/list](https://stackoverflow.com/revisions/146271/list)）。我让我原来的答案，并回答下面的新问题。*

**您如何看待 C++ 上的默认传递引用语义？**就像您说的那样，它会破坏兼容性，并且您将对原语（即内置类型，仍将通过副本传递）和结构/对象（将作为引用传递）进行不同的传递。您必须添加另一个运算符来表示“按值传递”（外部“C”非常糟糕，并且已经用于其他完全不同的东西）。不，我真的很喜欢今天用 C++ 完成的方式。

**[...] 在我看来，引用运算符是一种获取变量地址的方法，这就是我用来获取指针的方法。我的意思是，它是同一个运算符，但在不同的上下文中具有不同的语义，这对您来说是不是也有点不对劲？**是和不是。运算符 >> 在与 C++ 流一起使用时也改变了它的语义。然后，您可以使用运算符 += 替换 strcat。我猜运算符 & 之所以被使用是因为它的含义是“与指针相反”，并且因为他们不想使用另一个符号（ASCII 是有限的，范围运算符 :: 以及指针 -> 表明很少有其他符号可用）。但是现在，如果 & 困扰你，&& 真的会让你感到不安，因为他们在 C++0x 中添加了一个一元 && （一种超级引用......）。我自己还没消化...

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-28T17:31:27.457

完全改变一段代码含义的编译器选项对我来说听起来是个坏主意。要么习惯 C++ 语法，要么找到不同的语言。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-28T17:45:02.790

我宁愿不再通过使每个（非限定）参数成为引用来滥用引用。

将引用添加到 C++ 的主要原因是[支持运算符重载](http://www.research.att.com/~bs/bs_faq2.html#pointers-and-references)；如果你想要“按引用传递”语义，C 有一个非常合理的方法：指针。

使用指针可以清楚地表明您更改指向对象的值的意图，并且只需查看函数调用就可以看到这一点，您不必查看函数声明来查看它是否使用引用。

另见

> *我确实想更改参数，我应该使用指针还是应该使用引用？*我不知道一个强有力的逻辑原因。如果传递“不是对象”（例如空指针）是可以接受的，那么使用指针是有意义的。我个人的风格是在我想修改对象时使用指针，因为在某些情况下，这样更容易发现可以进行修改。

[来自同一个常见问题解答](http://www.research.att.com/~bs/bs_faq2.html#call-by-reference)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-28T17:20:22.677

老实说，我认为整个 C++ 中的值传递/引用传递思想具有误导性。 *一切*都是价值传递。你有三种情况：

1.  在哪里传递变量的本地副本

    ```
    void myFunct(int cantChangeMyValue) 
    ```

2.  将指针的本地副本传递给变量的位置

    ```
    void myFunct(int* cantChangeMyAddress) {
        *cantChangeMyAddress = 10;
    } 
    ```

3.  您传递“引用”的地方，但是通过编译器魔术，就好像您传递了一个指针并且每次都简单地取消引用它。

    ```
    void myFunct(int & hereBeMagic) {
        hereBeMagic = 10; // same as 2, without the dereference
    } 
    ```

我个人觉得记住一切都是按价值传递的，这不会令人困惑。在某些情况下，该值可能是一个地址，它允许您更改函数之外的内容。

您的建议不允许程序员做第一件事。我个人认为取消该选项是个坏主意。C/C++ 的一个主要优点是具有细粒度的内存管理。让一切都通过引用传递只是试图让 C++ 更像 Java。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-28T17:21:58.743

是的，我认为这是一个非常令人困惑的超载。

这是微软不得不说的情况：

> 不要将引用声明与地址操作符的使用混淆。当 & identifier 前面有一个类型（例如 int 或 char）时，则 identifier 被声明为对该类型的引用。当 & 标识符前面没有类型时，用法是地址运算符的用法。

我对 C 或 C++ 不是很擅长，但我更头疼的是在两种语言中整理 * 和 & 的各种用途，而不是在汇编程序中编码。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-28T17:34:57.527

最好的建议是养成思考你真正想要发生的事情的习惯。当您没有复制构造函数（或不想使用它）时，通过引用传递很好，并且对于大型对象来说更便宜。但是，然后在类之外感觉到参数的突变。您可以改为通过`const`引用传递 - 然后没有突变，但您不能进行本地修改。为在函数中应该是只读的廉价对象传递 const 按值，当您想要一个可以进行本地修改的副本时，传递非 const 按值。

每个排列（按值/按引用和 const/non-const）都具有绝对不等价的重要差异。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-28T17:42:51.080

当您按值传递时，您正在将数据复制到堆栈中。如果您为要传递的结构或类定义了 operator=，它将被执行。我知道没有编译器指令可以消除所提议的更改固有地导致的隐式语言混乱的繁琐。

一个常见的最佳实践是通过 const 引用传递值，而不仅仅是通过引用。这确保了在调用函数中不能更改值。这是 const 正确代码库的元素之一。

一个完全 const 正确的代码库更进一步，将 const 添加到原型的末尾。考虑：

```
void Foo::PrintStats( void ) const {
   /* Cannot modify Foo member variables */
}

void Foo::ChangeStats( void ) {
   /* Can modify foo member variables */
} 
```

如果要将 Foo 对象传递给以 const 为前缀的函数，则可以调用 PrintStats()。编译器会在调用 ChangeStats() 时出错。

```
void ManipulateFoo( const Foo &foo )
{
    foo.PrintStats();  // Works
    foo.ChangeStats(); // Oops; compile error
} 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-28T18:36:01.310

有什么不清楚的。当你说：

> int b(b ¶m);

你对第二个“b”有什么打算？你忘了介绍类型吗？您是否忘记对第一个“b”进行不同的书写？你不认为写这样的东西很清楚：

```
class B{/*something...*/};
int b(B& param); 
```

从现在开始，我想你的意思是我写的。

现在，您的问题是“您不认为编译器将非 POD 的每个按值传递视为传递引用会更好吗？”。第一个问题是它会破坏你的合同。我想你的意思是通过 CONST 引用，而不仅仅是通过引用。

您现在的问题已简化为：“您知道是否有一些编译器指令可以按值优化函数调用吗？”

现在的答案是“我不知道”。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T19:35:11.457

我认为如果你开始混合所有类型的可用参数以及它们的 const 变化，c++ 会变得非常混乱。

跟踪所有复制构造函数调用、所有重载的取消引用等等，它很快就会失控。

# c++ - 指向模板类成员函数的函数指针

> ID：146275
> 
> 赞同：3
> 
> 时间：2008-09-28T17:13:37.343
> 
> 标签：c++, templates, function, member

我有一个模板类（部分）定义为

```
template <class T> MyClass
{
public:
   void DoSomething(){}
}; 
```

如果我想从另一个类调用 DoSomething，但能够在同一个地方对多个“T”类型执行此操作，我会坚持一个想法，因为方法函数指针唯一地受限于类类型。当然，每个 MyClass 都是不同的类型，所以我不能以“多态”方式存储指向 MyClassDoSomething() 的函数指针。

我的用例是我想在一个持有类中存储一个指向“DoSomething”的函数指针向量，这样我就可以从一个地方发出对所有存储类的调用。

有人有什么建议吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-28T17:31:54.957

好的，所以仿函数解决方案不能按您的需要工作。也许您应该让您的模板类继承自一个通用的基础“接口”类。然后你使用这些向量。

像这样的东西：

```
class Base { 
public:
  virtual ~Base(){}
  virtual void DoSomething() = 0;
}

template <class T> class MyClass : public Base {
public:
    void DoSomething(){}
};

std::vector<Base *> objects;
objects.push_back(new MyClass<int>);
objects.push_back(new MyClass<char>); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-28T17:45:55.300

你知道，这正是我需要做的。奇怪的是，我很早就将其视为对我的用例有效的解决方案，因为现在我无法理解。我想我被我在同一个地方为编译时调度所做的一些元编程工作蒙蔽了双眼（即在我昏昏欲睡的大脑中混淆了编译时间和运行时）。

谢谢你的震动！

# c - 手册页 scandir() 原型怪异

> ID：146291
> 
> 赞同：6
> 
> 时间：2008-09-28T17:22:29.707
> 
> 标签：c, manpage

我对**scandir()**有疑问：联机帮助页包含此作为原型：

```
int scandir(const char *dir, struct dirent ***namelist,
  int (*filter)(const struct dirent *),
  int (*compar)(const struct dirent **, const struct dirent **)); 
```

因此我有这个：

```
static inline int
RubyCompare(const struct dirent **a,
  const struct dirent **b)
{
  return(strcmp((*a)->d_name, (*b)->d_name));
} 
```

这是电话：

```
num = scandir(buf, &entries, NULL, RubyCompare); 
```

最后编译器这样说：

```
warning: passing argument 4 of ‘scandir’ from incompatible pointer type 
```

编译器是**gcc-4.3.2**，我的 CFLAGS 如下：

```
-Wall -Wpointer-arith -Wstrict-prototypes -Wunused -Wshadow -std=gnu99 
```

这个警告的含义是什么？RubyCompare 的声明对我来说看起来是正确的，除了警告之外，代码完全可以工作。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-28T17:55:23.560

实际上，不存在不能将指针传递给内联函数的约束。inline 关键字仅用作提示编译器在可能的情况下内联调用。

问题是 scandir() 的手册页有点误导。第 4 个参数的原型实际上是 int (*cmp)(const void *, const void *)。

因此，您需要像这样更改代码：

```
static inline int RubyCompare(const void *a, const void *b)
{
    return(strcmp((*(struct dirent **)a)->d_name, 
                  (*(struct dirent **)b)->d_name));
} 
```

不过，我实际上不确定您为什么要编写此函数，因为您可以使用提供的 alphasort 比较函数：

```
num = scandir(buf, &entries, NULL, alphasort); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-09-14T21:48:46.867

这个原型在最近版本的 GNU libc 中实际上已经改变以反映 POSIX 标准。

如果您有要同时处理旧代码和新代码的代码，请使用 __GLIBC_PREREQ 宏，例如

```
#define USE_SCANDIR_VOIDPTR 
#if defined( __GLIBC_PREREQ  )
# if  __GLIBC_PREREQ(2,10)
#  undef USE_SCANDIR_VOIDPTR
# endif
#endif

#ifdef USE_SCANDIR_VOIDPTR
 static int RubyCompare(const void *a,  const void *b)
#else 
 static int RubyCompare(const struct dirent **a,  const struct dirent **b)
#endif 
```

...

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T17:32:08.810

你给它一个指向内联函数的指针？这没有意义，实际上我想知道它甚至只编译一个警告。

**编辑**：上面的克里斯是对的，当 inline 关键字没有意义/不适用时，它会被默默地忽略。

# objective-c - Xcode 的隐藏功能

> ID：146297
> 
> 赞同：338
> 
> 时间：2008-09-28T17:26:37.763
> 
> 标签：objective-c, xcode, macos, cocoa

随着大量新手涌入 Xcode，我确信有很多 Xcode 提示和技巧可以分享。

你的是什么？

* * *

## 回答 #1

> 赞同：343
> 
> 时间：2008-09-28T21:15:38.367

## 切换到头文件/源文件

> *   `Option ⌥</kbd> `Command ⌘</kbd> `Up Arrow ↑</kbd>```
>     
>     
> *   **查看**>**切换到头文件/源文件**

`.m`在和`.h`文件之间切换。

> *   在 Xcode 4 中，这是`ctrl` `Command ⌘</kbd> `Up Arrow ↑</kbd>``

* * *

## 回答 #2

> 赞同：158
> 
> 时间：2008-09-28T17:29:41.110

`⌘ Command`+ `Double-Click on a symbol`: 跳转到符号的定义。

`⌥ Option`+ `Double-Click on a symbol`：在符号的文档中查找文本。（仅当您安装了它们的符号的文档集时才有效。）

## 收藏栏：

收藏夹栏就像您在 Safari 中用于存储收藏夹一样。我经常用它来存储我现在正在使用的文件的快捷方式（你可以通过拖放来完成）。通常，当我处理大型或不熟悉的项目时，这更有用。

要显示收藏夹栏，请选择以下菜单选项：

*   `View`> `Layout`>`Show Favorites Bar`

* * *

## 回答 #3

> 赞同：127
> 
> 时间：2008-09-28T21:34:41.177

## 自动完成键盘快捷键

`Tab ⇥</kbd> OR `Control ⌃</kbd> `/`: Select the next auto-completion argument.``

`Shift ⇧</kbd> `Tab ⇥</kbd> OR `Shift ⇧</kbd> `Control ⌃</kbd> `/`: Select the previous auto-completion argument.````

`Escape ⎋</kbd>: Shows the auto completion pop-up list.`

* * *

## 回答 #4

> 赞同：119
> 
> 时间：2009-06-02T07:52:22.007

## 关闭“撤消最后一点”警告

保存后尝试撤消时，会出现以下提示：

> “您将要撤消此文件保存的最后一点。您要这样做吗？”

要消除此警告，请在终端窗口中输入以下内容：

```
defaults write com.apple.Xcode XCShowUndoPastSaveWarning NO 
```

* * *

## 更改模板文件中的公司名称

将此粘贴到终端应用程序中：

```
defaults write com.apple.Xcode PBXCustomTemplateMacroDefinitions '{"ORGANIZATIONNAME" = "Microsoft";}' 
```

* * *

## `com.yourcompanyname`在所有模板中更改“ ”：

1.  找到目录：`/Developer/Platforms/iPhoneOS.platform/Developer/Library/Xcode/Project Templates/Application`
2.  使用您最喜欢的多文件搜索和替换工具更改`com.yourcompany`为您通常用于为设备构建的任何值。打开整个目录后，我使用了 BBEdit 的多查找和替换功能。您应该替换所有`info.plist`文件中的值。我找到了 8 个要更改的文件。由于我忘记更改此字符串而导致构建失败的次数是荒谬的。

* * *

## 快速跳转到组和文件窗格中的组

> *   `Control ⌃</kbd> `Option ⌥</kbd> `Shift ⇧</kbd> + <First letter of a Group name>```

如果按住上面的三个键，您可以通过按组名称的第一个字母快速跳转到左侧（组和文件）页面中的组。例如，`Control ⌃</kbd>`Option ⌥</kbd>`Shift ⇧</kbd>`T` takes you to *Targets* and `Control ⌃</kbd>`Option ⌥</kbd>`Shift ⇧</kbd>`S` to *Source*. Press it again and it jumps to SCM. Sometimes it takes several tries for this to work (I don't know why).``````

* * *

## 在自动完成选项之间循环

> *   `Control ⌃</kbd> `.``
>     
>     
> *   `Shift ⇧</kbd> `Control ⌃</kbd> `.`: Cycles backwards between autocompletion choices.``

`Control ⌃</kbd>`.` (Control-Period) after a word automatically accepts the first choice from the autocompletion menu. Try typing `log` then `Control ⌃</kbd>`.` and you'll get a nice `NSLog` statement. Press it again to cycle through any choices. To see all the mutable choices, type `NSMu` then `Control ⌃</kbd>`.`.```

* * *

## 快速帮助

> *   `Control ⌃</kbd> `Command ⌘</kbd> `?` (While your cursor is in the symbol to look up)``
>     
>     
> *   `Option ⌥</kbd> + <Double-click a symbol>`
>     
>     
> *   帮助 > 快速帮助

要从“快速帮助”窗口访问文档，请单击右上角的书本图标。

* * *

## 有关符号，请参阅文档

> *   `Command ⌘</kbd> `Option ⌥</kbd> + <Double-click a symbol>``

将您直接带到完整的文档。

* * *

## 进行不相邻的文本选择

> *   `Command ⌘</kbd> `Control ⌃</kbd> + <Double-click in the editor>``

使用上面的快捷方式以一种奇怪的方式选择多个单词。您可以在完全不同的地方选择单词，然后一次删除或复制它们。不确定这是否有用。据我所知，它只是 Xcode。

* * *

## 使用 Emacs 键绑定浏览您的代码

这个技巧适用于 Mac 上的所有 Cocoa 应用程序（TextEdit、Mail 等），并且可能是最有用的知识之一。

> *   `Command ⌘</kbd> `Left Arrow` or `Command ⌘</kbd> `Right Arrow` Takes you to the beginning and end of a line.``
> *   `Control ^` `a`做`Control ^` `e`同样的事情
> *   `Control ^` `n`并将`Control ^` `p`光标向上或向下移动一行。
> *   `Control ^` `f`并将`Control ^` `b`光标向后或向前移动一格

紧迫`Shift ⇧</kbd> with any of these selects the text between move points. Put the cursor in the middle of a line and press `Shift ⇧</kbd> `Control ^` `e` and you can select to the end of the line.``

紧迫`Option ⌥</kbd> will let you navigate words with the keyboard. `Option ⌥</kbd> `Control ^` `f` skips to the end of the current word. `Option ⌥</kbd> `Control ^` `b` skips to the beginning of the current word. You can also use `Option ⌥</kbd> with the left and right arrow keys to move one-word-at-a-time.````

*   `Control ^` `Left Arrow`并`Control ^` `Right Arrow`在单词的驼峰式部分之间移动光标。

试试看`NSMutableArray`。您可以`NSArray`通过将光标放在 之后`NS`快速将其更改为`Shift ⇧</kbd> `Control ^` `Right Arrow` then `Delete`.`

* * *

## 回答 #5

> 赞同：99
> 
> 时间：2008-09-28T17:49:09.237

## 赶紧开...

> *   `Command ⌘</kbd> `Shift ⇧</kbd> `D```
>     
>     
> *   **文件**>**快速打开...**

我是**Open Quickly**功能的忠实拥护者，该功能在 Xcode 3.1 及更高版本中特别有用。当您要打开项目或框架中的文件或符号定义时，只需点击键盘快捷键，键入文件或符号的名称，使用`Up Arrow ↑</kbd> and `Down Arrow ↓</kbd> to pick to the right result (if need be), and then hit `Return ↩</kbd> to open the file or navigate to the symbol definition.```

在 Xcode 4 上：

> *   `Command ⌘</kbd> `Shift ⇧</kbd> `o```

* * *

## 快速打开使用当前单词作为搜索词

另外，直到两分钟前我才知道 Xcode（当[schwa](https://stackoverflow.com/users/23113/schwa)在评论中指出它时）是，如果在调用**Open Quickly**时编辑器的文本插入符号位于单词内，则该单词将用作**打开快速**搜索词。

* * *

## 回答 #6

> 赞同：78
> 
> 时间：2008-10-19T00:18:04.057

## 使用#pragma 进行组织

您可以使用：

```
#pragma mark Foo 
```

...作为在源文件中组织方法的一种方式。通过弹出菜单浏览符号时，您放置的任何内容都`Foo`将在列表中显示为粗体。

要显示分隔符（即水平线），请使用：

```
#pragma mark - 
```

它非常有用，尤其是对于将委托方法或其他方法组组合在一起时。

* * *

## 回答 #7

> 赞同：77
> 
> 时间：2009-06-01T09:39:09.667

## 1\. “objc_exception_throw”上的断点

您应该始终[在`objc_exception_throw`](https://stackoverflow.com/questions/1163981/how-to-add-a-breakpoint-to-objc-exception-throw).

## 2\. 调试“僵尸”变量的保留/释放问题

使用以下代码：

```
NSZombieEnabled = YES;
NSDeallocateZombies = NO; 
```

...调试保留和释放问题。[有关详细信息，请参阅Apple 调试应用程序文档](http://developer.apple.com/library/ios/#documentation/Xcode/Conceptual/iphone_development/130-Debugging_Applications/debugging_applications.html#//apple_ref/doc/uid/TP40007959-CH7-SW1)的“查找内存泄漏”部分。

## 3\. 从 Interface Builder 跳转到 Xcode 中的一个类

`Command ⌘</kbd> + `Double-click` on an object in Interface Builder's Document Window to jump to that class in Xcode. This is very handy with *File's Owner*.`

## 4.重用Interface Builder中的自定义对象

将自定义对象拖回 Interface Builder 的库以供以后重用。

## 5.在Interface Builder中选择重叠项

`Control ⌃</kbd> `Shift ⇧</kbd> + `Click` on an object in Interface Builder to see a menu of all of the objects under the mouse.``

## 6.界面生成器手势指南

[界面生成器手势指南](http://developer.apple.com/mac/library/documentation/DeveloperTools/Conceptual/IB_UserGuide/GestureGuide/GestureGuide.html)。

* * *

## 回答 #8

> 赞同：75
> 
> 时间：2008-11-19T22:15:18.253

`Ctrl`+ `2`：访问当前文件中方法和符号的弹出列表。

这非常有用，因为使用此快捷方式，您可以完全使用键盘浏览文件。当您到达列表时，开始输入字符，列表将选择您要查找的符号。

* * *

## 回答 #9

> 赞同：74
> 
> 时间：2008-09-28T21:42:01.487

## 放大编辑器

如果您的窗口同时显示详细视图和编辑器视图，您可以**放大编辑器**以将编辑器视图扩展到窗口的全高。（这很容易找到，但许多人似乎忽略了它。）

您可以使用以下方法之一来执行此操作：

> *   `Command ⌘</kbd> `Shift ⇧</kbd> `E```
>     
>     
> *   **视图**>**放大编辑器**
>     
>     
> *   向上拖动拆分器（在编辑器窗口和上面的文件列表之间）。

* * *

## 回答 #10

> 赞同：67
> 
> 时间：2008-10-02T10:57:09.710

获取[Colin Wheeler 的完整 Xcode 键盘快捷键列表](http://cocoasamurai.blogspot.com/2008/02/complete-xcode-keyboard-shortcut-list.html "完整的 Xcode 键盘快捷键列表")（以 PDF 或 PNG 格式提供）。将其打印并保存在可见的地方（我将它放在屏幕旁边的墙上）。

编辑： [Xcode 3.2 的更新版本](http://cocoasamurai.blogspot.com/2009/08/xcode-shortcuts-updated-for-xcode-32-on.html "Xcode Shortcuts 为 Mac OS X 10.6 Snow Leopard 上的 Xcode 3.2 更新")

编辑 2： [Xcode 4 的更新版本](http://cocoasamurai.blogspot.com/2011/03/xcode-4-keyboard-shortcuts-now.html "Xcode 4 键盘快捷键现已推出！")

* * *

## 回答 #11

> 赞同：52
> 
> 时间：2008-10-14T04:33:59.443

键盘快捷键不多，但源代码中的 TODO 注释显示在编辑器顶部的方法/函数下拉列表中。

例如：

```
// TODO: Some task that needs to be done. 
```

显示在方法和函数的下拉列表中，因此您可以直接跳转到它。

大多数 Java IDE 在滚动条中显示这些任务标记的标记，这样更好，但也可以。

* * *

## 回答 #12

> 赞同：51
> 
> 时间：2008-11-08T22:31:28.327

⌘-[ 和 ⌘-] 缩进和取消缩进选定的文本。使清理源代码*变得*更加容易。

* * *

## 回答 #13

> 赞同：43
> 
> 时间：2009-03-31T15:21:22.730

拆分窗口时按住 Option 以垂直拆分而不是水平拆分。

* * *

## 回答 #14

> 赞同：42
> 
> 时间：2009-01-15T20:25:34.120

双击方括号或小括号，即可获得括号和小括号的匹配。

* * *

## 回答 #15

> 赞同：36
> 
> 时间：2009-06-07T16:52:25.447

从命令行控制 Xcode 的文本编辑器：xed

```
> xed -x                # open a new untitled document
> xed -xc foo.txt       # create foo.txt and open it
> xed -l 2000 foo.txt   # open foo.txt and go to line 2000

# set Xcode to be your EDITOR for command line tools
# e.g. for subversion commit
> echo 'export EDITOR="xed -wcx"' >> ~/.profile

> man xed               # there's a man page, too 
```

* * *

## 回答 #16

> 赞同：31
> 
> 时间：2008-10-01T14:41:07.887

“Ctrl+左/右箭头”进行词内文本导航。我使用此功能将光标从变量中的一个“驼峰”跳转到下一个。

* * *

## 回答 #17

> 赞同：30
> 
> 时间：2008-10-01T07:56:03.040

Xcode 支持可以通过*Edit*菜单末尾的*Insert Text Macro*菜单调用的文本宏。也可以使用 Xcode 的代码完成技术 Code Sense 来调用它们。

 *例如，键入键序列`p i m control-period`将插入`#import "file"`到您的代码中，`file`作为可编辑的标记，就像代码完成一样。

* * *

## 回答 #18

> 赞同：30
> 
> 时间：2008-10-13T05:44:06.197

右键单击函数中的变量，然后单击范围内的全部编辑。自从我发现这一点以来一直在使用它。

`ctrl` `⌘</kbd> `T``

* * *

## 回答 #19

> 赞同：28
> 
> 时间：2008-09-30T18:25:53.110

你可以让 Xcode 在你的 Info.plist 文件上运行预处理器：

```
        <key>CFBundleShortVersionString</key>
    #ifdef 调试
        <string>1.0（调试）</string>
    ＃别的
        <string>1.0</string>
    ＃万一

```

有关详细信息，请参阅[http://developer.apple.com/technotes/tn2007/tn2175.html](http://developer.apple.com/technotes/tn2007/tn2175.html)。

* * *

## 回答 #20

> 赞同：27
> 
> 时间：2008-12-13T09:34:30.517

**调试——如何使用 GDB**

作为新手，我发现捕获和识别故障是一项相当艰巨的工作。控制台，尽管它是一个强大的工具，但通常不会产生非常直观的结果，并且知道您在调试器中查看的内容同样难以理解。在 Stack Overflow 上的一些人的帮助下，以及可在 [Cocoa With Love](http://cocoawithlove.com/2008/10/debugging-tips-for-objective-c.html)上找到的关于调试的好文章，它变得更加友好。

* * *

## 回答 #21

> 赞同：26
> 
> 时间：2008-10-01T16:30:27.513

Navigate among open files back and forth:
⌥⌘←
⌥⌘→

* * *

## 回答 #22

> 赞同：25
> 
> 时间：2009-05-16T07:57:12.497

从技术上讲，这是一个 Interface Builder 提示，但它们是一对书本，所以我不认为这是题外话......

Shift + 右键单击​​您的一个控件，您将获得一个不错的对象层次结构选择列表。没有更多的点击，点击，点击，沮丧！

* * *

## 回答 #23

> 赞同：22
> 
> 时间：2011-01-05T03:38:28.830

使用触控板：

*   三指向上滑动 - 在头文件和源文件之间切换，比`Cmd`+ `Opt`+更容易`Up`；
*   向下滑动三指 - 选择类或方法时在声明和定义之间切换，目前找到这两种；
*   向左滑动三指 - 返回（`Cmd`+ `Opt`+ `Left`）；
*   向右滑动三指 - 前进（`Cmd`+ `Opt`+ `Right`）；

使用 Xcode 3.2.5 测试。

* * *

## 回答 #24

> 赞同：21
> 
> 时间：2008-10-09T22:22:23.170

Xcode 中的**类浏览器！**按**`shift`+`⌘</kbd> + `c``**到达。您可以缩小范围以仅显示您的活动项目。只要您只想浏览类层次结构，它就会为您提供一个不那么杂乱的视图。

* * *

## 回答 #25

> 赞同：19
> 
> 时间：2010-03-22T21:37:13.633

## 用于`]`自动插入`[`正确位置

我来自 .NET 背景，所以我习惯于输入一个符号，然后输入其中一个方法名称。`[`所以在我开始输入对象名称之前，我总是忘记包括。通常这意味着我需要转到行首并`[`手动添加。我没有意识到我可以`]`在当前光标位置按一下，它会自动添加。

有几种方法可以使用它：在输入函数名称之后，或者在输入函数名称之前。

### 方法一：函数名后

`myObject testMethod``]`

...变成：

```
[myObject testMethod] 
```

...插入符号位于`]`.

### 方法二：在函数名前

`myObject``]`

...变成：

```
[myObject ] 
```

...插入符号位于*.*`]`

后者 (2) 的优点是代码完成将过滤对象的方法。而对于前者 (1)，如果您尝试在 之后立即调用代码完成`myObject`，它将不会被过滤。(2) 的另一个优点是它的行为更像其他使用点表示法的编程语言。您只需键入对象的名称即可，`]`而不是`.`访问方法。

* * *

## 回答 #26

> 赞同：17
> 
> 时间：2009-04-10T18:26:50.893

选择一个文本块并输入 cmd-/ 将其注释掉。再做一次以删除评论字符。

这在通过双击平衡字符（括号、大括号、方括号）与大括号匹配结合使用时特别有用。

* * *

## 回答 #27

> 赞同：16
> 
> 时间：2010-08-18T04:07:32.490

能够快速查看可以从超类覆盖的所有方法。例如，在扩展 UITableViewController 时，我只需输入我的实现：

```
- ta 
```

然后我点击 ESC 查看我的超类中所有以“ta”开头的方法，例如

```
- (UITableViewCell *) tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath 
```

这在采用协议时也有效。

* * *

## 回答 #28

> 赞同：14
> 
> 时间：2010-10-07T12:13:23.813

`Command ⌘</kbd> `alt ⌥</kbd> `shift` `T` : reveal the current edited file in the project tree.``

* * *

## 回答 #29

> 赞同：14
> 
> 时间：2008-12-03T01:42:31.843

`ctrl`+ `alt`+`⌘</kbd> + `r` to clear the log`

* * *

## 回答 #30

> 赞同：13
> 
> 时间：2008-10-01T07:59:39.740

将 Code Sense 与许多键盘一起使用时，使用`control`+`,`显示可用补全列表，使用`control`+`.`插入最有可能的补全，使用`control`+ `/`& `shift`+ `control`+`/`在占位符标记之间移动。按键都在主行下方的键盘上，这对肌肉记忆有好处。

* * *

## 回答 #31

> 赞同：13
> 
> 时间：2008-10-22T18:21:47.303

## 使用类浏览器显示继承的方法

Apple 的 API 参考文档没有显示从超类继承的方法。有时，虽然。能够查看一个类可用的全部功能是很有用的——包括您自己的自定义类。您可以使用类浏览器（从项目菜单中）显示与当前项目相关的所有类的平面或分层列表。浏览器窗口右侧的上窗格显示与在浏览器中选择的对象相关联的方法列表。您可以使用“配置选项”表选择“显示继承的成员”以显示继承的方法以及所选类本身定义的方法。您单击小书本符号以转到相应的文档。

* * *

## 回答 #32

> 赞同：12
> 
> 时间：2008-10-01T18:18:54.040

可能不言而喻，但如果您想使用词内导航，请确保更改 Spaces（在 Expose & Spaces 首选项窗格中）中的键预设（如果您使用它）。

我将 Spaces 切换为使用 Ctrl-Option Left/Right。

编辑：要将空格设置为 Ctrl-Option Left/Right，请选择“在空格之间切换：”弹出窗口并按住 Option 键。第一项将从 Ctrl 箭头键更改为 Ctrl-Option 箭头键。

* * *

## 回答 #33

> 赞同：10
> 
> 时间：2008-10-01T06:58:54.550

Cmd-/ 自动插入“//”作为注释。从技术上讲，击键次数相同，但感觉更快......

此外，默认的项目结构是将资源和类文件放在不同的位置。对于大量代码，请创建逻辑组并将相关代码和 xib 文件放在一起。在 XCode 中创建的组只是逻辑结构，不会更改文件在磁盘上的位置（尽管如果您愿意，可以将它们设置为复制真实的目录结构）

* * *

## 回答 #34

> 赞同：10
> 
> 时间：2009-03-20T05:52:25.387

打印[完整的 Xcode 键盘快捷键列表](http://cocoasamurai.blogspot.com/2008/02/complete-xcode-keyboard-shortcut-list.html)并将其放在显示器旁边。

* * *

## 回答 #35

> 赞同：10
> 
> 时间：2009-05-11T08:05:23.527

**语用标记**

例子：

```
#pragma mark === Initialization === 
```

在所有初始化方法上方写入这一行将在编辑器上方的下拉菜单中生成一个漂亮的标题。

**快速打开**

Shift + cmd + D 开始输入您要打开的文件名。如果您寻找框架标头，那就太酷了。他们也有很好的评论，有时会给文档附加信息。

**ESC键**

例如，当您的文本光标位于不完整的方法名称上时，请按 ESC。它将购买所有可能适合其中的东西，并且您可以快速完成非常大的方法名称。如果您不记得确切的方法名称，这也很好。只需按 ESC。

我认为这些是我迄今为止所知道的最好的。

（从 Stack Overflow 用户删除的问题中迁移，*[谢谢](https://stackoverflow.com/users/62553)*。）

* * *

## 回答 #36

> 赞同：9
> 
> 时间：2009-08-09T04:36:12.420

## 用于`^T`交换前两个字母

这适用于所有 Cocoa 应用程序，但我喜欢它，尤其是在编码时。使用`^T`(Control-T) 交换与插入符号相邻的两个字母，或者当插入符号位于末尾时，交换插入符号之前的两个字母。例如：

`fi``^T`

...变成：

`if`

...这是我经常犯的错字。

* * *

## 回答 #37

> 赞同：9
> 
> 时间：2009-09-04T05:52:13.770

### 无需重新编译的调试日志

[cdespinosa](https://stackoverflow.com/users/25972/cdespinosa)对 Stack Overflow 问题的回答*[How do I debug with NSLog(@“Inside of the iPhone Simulator”)？](https://stackoverflow.com/questions/558568/how-do-i-debug-with-nsloginside-of-the-iphone-simulator/566433#566433)*提供了一种不需要重新编译源代码的调试通过日志记录技术的方法。一个惊人的技巧，它可以让代码免于调试杂乱无章，快速周转，如果我早点知道它会为我省去无数麻烦。

### 待办事项评论

在评论前加上前缀`TODO:`会导致它出现在功能“快捷方式”下拉菜单中，例如：

```
int* p(0); // TODO: initialize me! 
```

* * *

## 回答 #38

> 赞同：8
> 
> 时间：2008-10-10T06:28:37.760

右键单击任何单词并选择“在 API 参考中查找选定文本”以在 API 中搜索该单词。如果您需要查找类的可用属性和/或方法，这将非常有用。无需前往 Apple.com 或 Google，您将看到您正在寻找的内容（或找到的内容）的弹出窗口。

* * *

## 回答 #39

> 赞同：8
> 
> 时间：2009-01-28T22:12:48.540

在[PyObjC](http://en.wikipedia.org/wiki/PyObjC)中，您可以`#pragma mark`对符号下拉列表执行等效操作：

`#MARK: Foo`

和

`#MARK: -`

* * *

## 回答 #40

> 赞同：8
> 
> 时间：2009-07-07T03:37:08.477

⌘` 正确格式化（重新缩进）你的代码

编辑：显然重新缩进功能（编辑>格式>重新缩进）没有默认快捷方式。我想我很久以前就分配了一个（在 Preferences > Key bindings 中），甚至不记得了。很抱歉误导了你。

* * *

## 回答 #41

> 赞同：8
> 
> 时间：2010-10-22T16:54:16.877

对我来说一直是：`Command ⌘</kbd> + `0`:`

在您调试或运行或任何操作之后，如果您退出 iPhone 模拟器或调试应用程序，您将留下调试器窗口。

当您使用“单窗口布局”时，必须通过单击工具栏中的单击来返回编辑器，这很烦人（而且您稍后需要“删除详细信息窗格”）。

上面的快捷方式做到了，让您*准备好编写代码*。

* * *

## 回答 #42

> 赞同：8
> 
> 时间：2009-10-22T21:39:01.623

建立成功/失败噪音；从术语：

```
defaults write com.apple.Xcode PBXBuildSuccessSound ~/Library/Sounds/metal\ stamp.wav
defaults write com.apple.Xcode PBXBuildFailureSound ~/Library/Sounds/Elephant 
```

* * *

## 回答 #43

> 赞同：7
> 
> 时间：2009-01-07T15:26:57.400

能够水平分割当前编辑器窗口，这对于宽屏显示器能够并排查看源文件和头文件非常有用。根据您使用的 Xcode 版本，有两种不同的方法。

在 Xcode 3.0 中，它位于该列表底部的 Preferences、Key Bindings、Text Key Bindings 下。

在 Xcode 2.5 中，它位于 Preferences、Key Bindings、Menu Key Bindings、View menu 下。

* * *

## 回答 #44

> 赞同：7
> 
> 时间：2011-01-25T22:42:59.673

我刚刚发现如何更改文本宏中使用的缩进行为：

例如，如果你和我一样不喜欢这样：

```
if (cond) {
  code;
} 
```

但更喜欢这个：

```
if (cond)
{
  code;
} 
```

然后您可以通过在终端中设置以下默认值来全局更改此设置（适用于所有语言）：

```
defaults write com.apple.Xcode XCCodeSenseFormattingOptions -dict-add BlockSeparator "\n" 
```

这多年来一直困扰着我，我希望它对其他人也有一些兴趣。

此功能的文档可以在[Xcode 用户默认参考中找到](http://developer.apple.com/library/mac/documentation/DeveloperTools/Reference/XcodeUserDefaultRef/100-Xcode_User_Defaults/UserDefaultRef.html#//apple_ref/doc/uid/TP40005535-CH3-SW57)

* * *

## 回答 #45

> 赞同：7
> 
> 时间：2008-12-11T11:13:34.400

1.  选择文本时按住选项以选择不连续的文本部分。
2.  按住选项同时单击符号名称下拉菜单以按名称而不是它们在文件中出现的顺序排序。

* * *

## 回答 #46

> 赞同：7
> 
> 时间：2010-06-23T10:59:16.520

`Cmd`++ /折叠所有函数或取消折叠它们`Ctrl`。`up``down`

* * *

## 回答 #47

> 赞同：7
> 
> 时间：2010-11-11T21:52:19.190

还有一个.. [Hex Color Picker](http://wafflesoftware.net/hexpicker/) ...它将十六进制选项卡添加到界面构建器的颜色面板中...所以现在您可以直接从界面构建器中使用十六进制颜色..

![替代文字](https://i.stack.imgur.com/iUojb.png)

* * *

## 回答 #48

> 赞同：7
> 
> 时间：2010-02-08T08:07:22.443

`⇧</kbd>`⌘</kbd>`A`. It will build and analyze, meaning that Xcode will warn you about possible leaks.``

* * *

## 回答 #49

> 赞同：7
> 
> 时间：2011-02-09T22:21:25.960

![在此处输入图像描述](https://i.stack.imgur.com/3CuLT.png)

1.  在调试器启动时打开调试窗口更改镜像中显示的调试首选项..

2.  要在每次应用运行时清除控制台日志，请选中自动清除调试控制台。

* * *

## 回答 #50

> 赞同：7
> 
> 时间：2010-12-28T06:50:58.040

**突出显示代码块（焦点跟随选择）**

从 View -> Code Folding -> Focus Follows Selection 或 激活“焦点跟随选择” `Control``Option``f`。

这也适用于 Python 代码，但一行中的前导空格会将其丢弃。要修复它，请安装[Google 的 Xcode 插件](http://code.google.com/p/google-toolbox-for-mac/wiki/GTMXcodePlugin)并在它安装的首选项中激活“保存时更正空白”。这将在您每次保存文件时清除尾随空格，因此如果突出显示搞砸了，您可以保存文件，它会再次工作。（看，这实际上是两个提示合二为一，因为插件的这个功能单独使用很有用）。

这是我刚刚编写的一些随机 Python 代码的示例。我正在使用 Midnight Xcode 语法着色主题。

![一些随机的 Python 代码。](https://i.stack.imgur.com/YaQ9P.png)

这对于代码的高度嵌套部分非常有用，可以跟踪代码的位置。另外，请注意左侧，就在行号的右侧，这些部分也是彩色的。那就是代码折叠栏。如果您将鼠标放在一边，它会突出显示鼠标下方的部分。并且这些彩色条中的任何一个都可以折叠，换句话说，突出显示的代码部分正是可以折叠的部分。

* * *

## 回答 #51

> 赞同：6
> 
> 时间：2009-06-10T16:38:59.227

If you have a multi-touch capable Mac - use [MultiClutch](http://wcrawford.org/2008/02/28/everytime-i-think-about-you-i-touch-my-cell/) to map some of the keystrokes described by mouse gestures.

I use three finger forward and back to go forward and back in file history (cmd-alt-.), and pinch to switch between `.h` and `.m`.

* * *

## 回答 #52

> 赞同：6
> 
> 时间：2008-12-11T11:39:22.210

The User Scripts menu has a lot of goodies in it, and it's relatively easy to add your own. For example, I added a shortcut and bound it to cmd-opt-- to insert a comment divider and a `#pragma mark` in my code to quickly break up a file.

```
 `#!/bin/sh
  echo -n "//================....================
  #pragma mark "` 
```

`When I hit cmd-opt--, these lines are inserted into my code and the cursor is pre-positioned to edit the pragma mark component, which shows up in the symbol popup.`

 `* * *

## 回答 #53

> 赞同：6
> 
> 时间：2008-09-29T17:15:34.023

当您在一个方法上使用代码完成并且它有多个参数时，使用 CTRL + / 移动到您需要填写的下一个参数。

* * *

## 回答 #54

> 赞同：6
> 
> 时间：2010-04-25T15:04:41.157

A different way to set the your company name in a project template is to:

*   Add a contact for yourself in Address Book
*   Edit Company field in your contact to your Company name
*   Now select your contact then go to menu and select Card -> Make This My Card
*   Your contact card should now be bold in address book to confirm this.

This should now add your company name to all your project templates as well as providing other applications with more autofill information!

* * *

## 回答 #55

> 赞同：6
> 
> 时间：2009-05-13T17:35:39.830

查看关于“在 Xcode 中变得高效”的精彩截屏视频：[becoming-productive-in-xcode](http://pragprog.com/screencasts/v-mcxcode/becoming-productive-in-xcode)

* * *

## 回答 #56

> 赞同：6
> 
> 时间：2009-07-16T15:58:43.987

使用[AppKiDo](http://homepage.mac.com/aglee/downloads/appkido.html "AppKiDo")浏览文档。

将[Accessorizer](http://www.kevincallahan.org/software/accessorizer.html "配饰")用于 Xcode 中的一堆平凡、重复的任务。

* * *

## 回答 #57

> 赞同：6
> 
> 时间：2010-08-11T09:14:59.417

要默认在弹出菜单中显示当前自动完成选项（无需先按`ESC`），请键入

```
defaults write com.apple.Xcode XCCodeSenseAutoSuggestionStyle List 
```

在终端中并重新启动 Xcode。

* * *

## 回答 #58

> 赞同：6
> 
> 时间：2010-09-16T15:33:41.490

Xcode 代码格式化...当您想让您的代码具有可读性和美观性时，您需要做的事情之一。

您可以自己进行代码格式化或使用脚本节省一些时间。

一种好方法是..使用[Uncrustify](http://sourceforge.net/projects/uncrustify/)。它*[在 Xcode 中的代码格式化中进行了](http://blog.carbonfive.com/2009/08/iphone/code-formatting-in-xcode)*说明。

* * *

## 回答 #59

> 赞同：5
> 
> 时间：2010-05-10T20:32:23.423

至于“**快速打开**”功能 - 很棒，但我一直错过TextMate用于浏览项目和文件（符号、方法等）**的 cmd-shift-t 。**

这就是为什么我发布了一个**Xcode 插件**来提供它。它被称为**Code Pilot**，您可能想看看它： http: [//macoscope.net/en/mac/codepilot/](http://macoscope.net/en/mac/codepilot/)

* * *

## 回答 #60

> 赞同：5
> 
> 时间：2008-09-28T21:07:10.743

## 链接新框架

（在“组和文件”窗格中，打开“目标”显示三角形以显示与您的项目关联的目标。）

1.  在 Groups and Files 窗格中，双击当前项目目标以显示 Target Info 面板。
2.  在“信息”面板中，选择“常规”选项卡。下部窗格显示当前链接的框架。
3.  通过按下面板左下角的 + 按钮并从出现的工作表中显示的列表中选择来添加新框架。（重要的是，工作表中的列表仅显示与目标相关的框架......）

（这在两年前是不可用的，但值得指出的是，它比在文件系统中查找框架并将其拖入项目中节省了大量时间......）

* * *

## 回答 #61

> 赞同：5
> 
> 时间：2009-12-06T19:24:47.723

## Xcode 动作的键绑定

我也喜欢“重新缩进”。确实没有默认快捷方式，但您可以从“键绑定”**首选项窗格的“****文本键绑定”选项卡**中添加一个。

 **这完全可以节省时间。只需查找您最喜欢的操作并添加/编辑键盘快捷键！

我觉得很方便的一组默认设置是 CMD+" 和 CMD+' 来添加/删除垂直分割。按住这些选项，现在你有相同的水平分割。但如果这些手势不适合你，你总是可以改变它们。

* * *

## 回答 #62

> 赞同：5
> 
> 时间：2009-10-12T09:08:45.087

Ctrl-left/Ctrl-right 在变量或方法名称中导航单词。没有这个就活不下去。

* * *

## 回答 #63

> 赞同：5
> 
> 时间：2010-04-24T15:26:15.007

键入方法时，按 ESC 键查看代码完成选项（毫无疑问，前面已经提到过）。我已经知道这一点，但今天我发现如果你按下代码完成窗口右下角的按钮（它将是“A”或 Pi），你可以在字母排序和什么之间切换似乎是按类层次结构排序的。

突然间，这个窗口很有用！

* * *

## 回答 #64

> 赞同：5
> 
> 时间：2010-08-11T09:22:11.073

选择一个文本块并使用

```
Command + '/' 
```

注释掉文本块。选择注释块并使用相同的快捷方式取消注释。

* * *

## 回答 #65

> 赞同：5
> 
> 时间：2010-06-10T19:41:26.423

Control+R 将所选文本作为 shell 脚本执行，该脚本会在选择后返回粘贴的输出！

* * *

## 回答 #66

> 赞同：5
> 
> 时间：2010-05-17T17:34:01.097

在 shell 构建阶段，您可以使用以下格式写入 stderr：

`<filename>:<linenumber>: error | warn | note : <message>\n`

它与 gcc 用于显示错误的格式相同。filename:linenumber 部分可以省略。根据模式（错误、警告、注释），Xcode 将用红色或黄色标记显示您的消息。

如果您包含绝对文件路径和行号（如果错误发生在文件中），则双击构建日志中的错误可以让 Xcode 打开文件并跳转到该行，即使它不是项目的一部分。非常便利。

* * *

## 回答 #67

> 赞同：4
> 
> 时间：2008-12-18T12:45:33.557

*[在Xcode 工具提示](http://www.meandmark.com/xcodetips.html)*中可以找到一些提示。

* * *

## 回答 #68

> 赞同：4
> 
> 时间：2008-10-14T04:13:20.357

使用 alt- 向后或向前移动一个完整的单词。使用 cmd-alt- 在历史记录中后退或前进文件。使用 cmd-alt- 在接口和实现之间切换。

使用 cmd-= 跳转到构建错误列表中的下一个错误。使用 cmd-shift-f 显示多个查找面板。使用 cmd-shift-e 切换完整的编辑器可见性。

使用 cmd-0 跳转到 Project 选项卡，使用 cmd-shift-b 跳转到 build 选项卡，使用 cmd-shift-y 跳转到 debug 选项卡（与操作的键命令相同，添加了 shift）。

* * *

## 回答 #69

> 赞同：4
> 
> 时间：2010-04-26T12:33:55.080

我已经创建了自己的文件模板`NSObject`，`UIView`因此`UIViewController`当我创建新类时，这些文件都设置了私有部分，并在 init 和 dealloc 中记录了类的地址。

示例（`NSObject`名为“test”的派生类将像这样开始）：

```
//=====================================================
// Private Interface
//=====================================================

@interface test (private)
@end

//=====================================================
// Public Implementation
//=====================================================

@implementation test

- (void)dealloc {
    NSLog(@">>> Dealloc: test [0x%X]", self);
    [super dealloc];
    NSLog(@"<<< Dealloc: test");
}

- (id) init
{
    self = [super init];
    if(self) {
        NSLog(@">>> Alloc: test [0x%X]", self);
    }
    return self;
}

@end

//=====================================================
// Private Implementation
//=====================================================

@implementation test (private)
@end 
```

有很多资源可用于此，例如*[Cocoa dev: Design your own Xcode project templates](http://arstechnica.com/apple/guides/2009/04/cocoa-dev-design-your-own-xcode-project-templates.ars)*。

* * *

## 回答 #70

> 赞同：4
> 
> 时间：2010-04-27T23:39:43.260

您可以对 Xcode 如何处理代码格式进行许多调整，但前提是您通过命令行更改设置。我整理了一个小程序，让您可以根据自己的喜好调整它们。享受 ：）

[Xcode 格式化选项](http://slightlysane.com/apps/Xcode_Formatting_Options.html "Xcode 格式化选项")

* * *

## 回答 #71

> 赞同：4
> 
> 时间：2010-04-02T21:58:19.367

通过选择 Group，然后选择 Edit > Sort By > Name，对 Xcode 的 Groups and Files 窗格中 Groups 的内容进行排序。

您可能希望在该组的上下文菜单中找到它，但它不存在。

信用：*[在 Xcode 中对文件进行排序](http://forums.macrumors.com/showthread.php?t=564590)*。

* * *

## 回答 #72

> 赞同：4
> 
> 时间：2010-12-21T07:03:43.517

`Cmd`+ `~`（波浪号 - 在按钮上看起来很奇怪......）

在任何打开的 Xcode 窗口之间切换 - 也可以在打开多个项目时进行。

* * *

## 回答 #73

> 赞同：3
> 
> 时间：2010-10-23T06:12:33.747

我最喜欢的必须是这些通用编辑器快捷方式：

*   **`⌘</kbd> + `0``**从调试模式返回您的编辑器。
*   **`⌘</kbd> + `Shift` + `R``**带您从调试模式到编辑器视图（项目模式）
*   **`⌘</kbd> + `Shift` + `E``**“最大化”编辑器（当您在编辑器上方显示构建结果等时，这非常有用，并且您只想让源代码编辑器更高）
*   **`Ctrl`+`2`**显示当前代码的大纲
*   **`⌘</kbd> + `Return``**运行应用程序
*   **`⌘</kbd> + `Shift` + `Return``**结束申请

* * *

## 回答 #74

> 赞同：3
> 
> 时间：2010-03-23T12:19:04.597

使用 xcodebuild 命令行在共享构建机器上进行干净构建：

```
cd project_directory
xcodebuild -configuration Release -alltargets clean
xcodebuild -configuration Release -alltargets 
```

* * *

## 回答 #75

> 赞同：3
> 
> 时间：2010-01-19T18:59:54.330

*   要“设置下一条语句”，只需将红色指令指针拖到下一行即可执行。[（资源）](http://osdir.com/ml/xcode-users/2009-09/msg00300.html)

* * *

## 回答 #76

> 赞同：3
> 
> 时间：2009-08-17T17:43:26.820

如果突出显示混乱，如果您的 ivars 没有突出显示或其他任何内容，只需执行 ⌘-A ⌘-X ⌘-V，它将全选、剪切和粘贴，所有突出显示都将被纠正。所以只需按住 ⌘ 并按 A，然后按 X，然后按 V。

* * *

## 回答 #77

> 赞同：3
> 
> 时间：2010-02-09T00:58:53.323

Alt-Left & Right 转到行尾/开始。这与 CTRL-Left & Right 一起移动到下一个大写字母或分词。这两个为我节省了很多时间

* * *

## 回答 #78

> 赞同：3
> 
> 时间：2010-11-10T15:07:42.187

按 ⌥⇧⌘D 激活“快速打开”，它使用所选文本将您导航到“快速打开”的第一个结果。如果所选文本的格式为`<filename:lineNumber>`，（带或不带 <>）“快速打开”会将您带到文件加上行号。

您可以将其与以下提示结合使用：

您可以使用此宏编写包含日志条目的文件名和行号的日志：（确保在目标调试配置中使用的 C 标志上定义 -DDEBUG=1）

```
#ifdef DEBUG
#define DLog(fmt, ...) NSLog((@"%s <%@:%d> " fmt), __PRETTY_FUNCTION__, [[NSString stringWithFormat:@"%s", __FILE__ ] lastPathComponent] ,__LINE__, ##__VA_ARGS__)
#else
#define DLog(format, ...)
#endif 
```

在您的 DLog() 输出中，双击“<”字符以选择`<filename:lineNumber>`并按 ⌥⇧⌘D 将打开源代码中日志所在的行。

* * *

## 回答 #79

> 赞同：3
> 
> 时间：2010-03-04T22:05:25.820

我不太喜欢 xcode 中内置的代码格式化/重新缩进功能，所以我发现使用 uncrustify 作为代码格式化程序非常有用。它可以用作用户脚本：[http ://hackertoys.com/2008/09/18/adding-a-code-beautifier-script-to-xcode/](http://hackertoys.com/2008/09/18/adding-a-code-beautifier-script-to-xcode/)

* * *

## 回答 #80

> 赞同：2
> 
> 时间：2009-12-27T06:34:57.943

我不知道是否每个人都已经知道这一点，但是当我了解到我可以使用“代码折叠”并通过单击最接近您想要的代码的灰色区域来隐藏我不想查看的嵌套函数时，我感到很高兴折叠。

很难解释 。. .

* * *

## 回答 #81

> 赞同：2
> 
> 时间：2009-10-02T18:26:04.667

整个快捷方式列表可以在这里找到：http: [//iphonehuston.blogspot.com/2009/08/shortcuts-for-xcode.html](http://iphonehuston.blogspot.com/2009/08/shortcuts-for-xcode.html)

* * *

## 回答 #82

> 赞同：2
> 
> 时间：2011-10-05T13:13:48.373

## Show chooser for open symbol

⌘ + ⌥ + ⇧ + click over a symbol

Shows

![enter image description here](https://i.stack.imgur.com/2wCyZ.png)

You can choose open the symbol in:

*   the current tab
*   in an existing tab
*   in a new one (with the **+** in the upper right corner)
*   in a vertical split (with the **+** in the right) or
*   in a new window (with the **+** in the left).

* * *

## 回答 #83

> 赞同：2
> 
> 时间：2009-10-22T21:45:04.343

事实上，我可以使用 Emacs 作为我的编辑器，使用 Xcode 作为我的构建器/调试器......在我看来，两全其美。

* * *

## 回答 #84

> 赞同：2
> 
> 时间：2010-12-06T06:32:22.750

如果您没有使用适当的版本控制系统，快照，文件>制作快照提供了一种快速保存项目修订版的方法。试验大型的、可能具有破坏性的变化的好方法。

* * *

## 回答 #85

> 赞同：2
> 
> 时间：2009-09-24T05:51:14.830

我发现使用构建/清理和运行项目的快捷方式确实为我节省了一些时间：

*   Cmd-R：构建并运行
*   Cmd-Y：构建和调试
*   Cmd-Shift-Enter：停止运行项目
*   Cmd-Shift-K：清理构建

* * *

## 回答 #86

> 赞同：2
> 
> 时间：2010-12-04T18:17:08.490

重命名多个项目共享的文件：

1.  打开所有项目。
2.  在一个项目中重命名文件。
3.  Xcode 会自动调整所有打开的项目以反映文件的新名称。

* * *

## 回答 #87

> 赞同：1
> 
> 时间：2010-12-10T13:53:45.783

[**代码完成**](http://www.mactech.com/articles/mactech/Vol.19/19.11/XcodeandCodeCompletion/index.html)

* * *

## 回答 #88

> 赞同：1
> 
> 时间：2011-01-26T07:32:20.877

1.  Cmd+Option+O 在单独的窗口中打开文件。
2.  可以将 Tab 配置为始终缩进。我经常用它来缩进整个文件。
3.  Ctrl+箭头键在驼峰式单词之间移动。如果您有 OneTwo，您可以使用 Ctrl+右箭头从一移动到二。
4.  您可以使用 emacs 绑定，甚至还有 kill ring！当我需要复制两段不同的文本时，我会同时使用 Ctrl+w 和 Cmd+C。
5.  在文档浏览器中，您可以将搜索限制在特定的库中，例如，仅 iOS 4.2 库。这有助于我专注于仅在特定 iOS/Mac 版本的 SDK 上可用的 API。
6.  Cmd+Shift+A 构建和分析。

* * *

## 回答 #89

> 赞同：-3
> 
> 时间：2011-02-11T08:45:40.077

我是从 Windows 世界（和许多其他人一样）进入 Xcode 的，我遇到的第一个怪癖之一是尝试使用 TAB 键“缩进选定的文本块”。

通常，在使用 Windows 编辑器时，您选择一个文本块，并且每当您按 TAB（或 shift TAB）键时，所选文本会向右/向左跳转。然后，一旦确定了文本的新位置，就停止按 TAB。

OK，在 Xcode 中，这完全不同，因为当你按下 TAB 时，整个文本块消失了，留下你一脸傻笑，内心有些愤怒……

但后来，偶然或直觉之类的，有一天我发现了一种解决方法，可以达到在适当的 Windows 编辑器下可能获得的相同效果。步骤应该是这些：

1.  像在 Windows 下一样选择文本块。
2.  与其按 TAB，不如离开你的直觉，然后“复制文本块”（通常是 CTRL+C（讨厌））。
3.  然后，在不取消选择文本的情况下（如果需要，请按 SHIFT），扩展选择的开头并将其放置在您希望新文本出现的位置。
4.  粘贴前面提到的文本（通常是 CTRL+V（再次糟糕））。
5.  结果：前一个文本块被“新”文本块（当然，它自己）替换，但是 Xcode 的“自动缩进”功能（或其他人，谁在乎）会自动将文本开始放置到我们的新位置在步骤 3 中选择。
6.  一个大大的笑容出现在你的脸上。

这有点棘手，但是当您习惯它时，您会发现自己经常使用它。

享受！！

# c# - 将类组织到命名空间中

> ID：146305
> 
> 赞同：4
> 
> 时间：2008-09-28T17:29:52.203
> 
> 标签：c#, .net, principles

将类组织到命名空间中是否有一些原则？

例如，如果命名空间 N 中的类依赖于 NX 中的类，是否可以？如果来自 NX 的类依赖于来自 N 的类？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-28T17:33:53.410

一般来说，如果你的包是“N.UI”和“N.Util”，这对你的例子来说应该没问题。我见过以两种通用方式使用的命名空间：

1) 系统的所有层都有一个命名空间（即数据库、网络、商务等）
2) 每个组件都有一个命名空间（即客户、发票）并在下面分层命名空间

无论哪种方式，子命名空间都将是更大命名空间中相互关联的包，因此您的 UI 代码可以完全依赖于您的域对象。

然而，虽然 NX 类依赖于 N 中的类会很好，但我认为 N 中的类依赖于 NX 中的类没有多大意义——听起来你可以在这种情况下使用一些重组。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-28T17:33:18.823

中的类`N.X`可以依赖于中的类`N`。但是 in 中的类`N`不应该依赖于`N.X`; 那是糟糕的设计。

一些命名空间指南：

*   [命名空间命名准则](https://docs.microsoft.com/en-us/previous-versions/dotnet/netframework-1.1/893ke618(v=vs.71))
*   [命名空间的名称](https://docs.microsoft.com/dotnet/standard/design-guidelines/names-of-namespaces)

# java - 不可变类应该是最终的？

> ID：146311
> 
> 赞同：21
> 
> 时间：2008-09-28T17:32:57.593
> 
> 标签：java, oop, final

它在[这篇文章](http://www.ibm.com/developerworks/java/library/j-jtp04223.html)中说：

> 因为它是不可变的，所以将其设为 final 是一个很好的理由。

我对此感到有些困惑......我知道从线程安全和简单的 POV 来看，不变性是一件好事，但似乎这些问题与可扩展性有些正交。那么，为什么不可变性是使类成为 final 的一个很好的理由呢？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2012-09-26T11:27:37.427

对此的解释在“Effective Java”一书中给出

考虑Java 中的`BigDecimal`和`BigInteger`类。

`BigInteger`不可变类在编写时必须是有效的 final并没有被广泛理解`BigDecimal`，因此它们的所有方法都可能被覆盖。不幸的是，在保持向后兼容性的同时，这在事后无法纠正。

**如果您编写的类的安全性取决于来自不受信任客户端的 BigInteger 或 BigDecimal 参数的不变性，则必须检查该参数是否是“真实的” BigInteger 或 BigDecimal，而不是不受信任的子类的实例. 如果是后者，您必须在假设它可能是可变的情况下防御性地复制它。**

```
 public static BigInteger safeInstance(BigInteger val) {

   if (val.getClass() != BigInteger.class)

    return new BigInteger(val.toByteArray());

       return val;

   } 
```

如果您允许子类化，它可能会破坏不可变对象的“纯度”。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2008-09-28T17:46:23.753

遵循 Liskov 替换原则，子类可以扩展但不能重新定义其父类的契约。如果基类是不可变的，那么很难找到可以在不违反约定的情况下有效扩展其功能的示例。

请注意，原则上可以扩展不可变类并更改基字段，例如，如果基类包含对数组的引用，则不能将数组中的元素声明为 final。显然，方法的语义也可以通过覆盖来改变。

我想您可以将所有字段声明为私有，将所有方法声明为 final，但是继承有什么用呢？

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-28T17:36:51.810

因为如果该类是最终的，则您无法扩展它并使其可变。

即使您将字段设置为最终字段，这仅意味着您不能重新分配引用，并不意味着您不能更改引用的对象。

我看不到在设计中也应该扩展的不可变类有很多用途，因此 final 有助于保持不变性完好无损。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-28T18:05:21.913

我认为主要是安全性。出于同样的原因，String 是最终的，任何与安全相关的代码想要视为不可变的任何东西都必须是最终的。

假设您有一个定义为不可变的类，将其命名为 MyUrlClass，但您没有将其标记为 final。

现在，有人可能会想编写这样的安全管理器代码；

```
void checkUrl(MyUrlClass testurl) throws SecurityException {
    if (illegalDomains.contains(testurl.getDomain())) throw new SecurityException();
} 
```

这是他们在 DoRequest(MyUrlClass url) 方法中放入的内容：

```
securitymanager.checkUrl(urltoconnect);
Socket sckt = opensocket(urltoconnect);
sendrequest(sckt);
getresponse(sckt); 
```

但他们不能这样做，因为你没有使 MyUrlClass 成为最终的。他们不能这样做的原因是，如果他们这样做了，代码可以通过覆盖 getDomain() 在第一次调用时返回“www.google.com”和“www.evilhackers.org”来避免安全管理器的限制第二个，并将他们类的一个对象传递给 DoRequest()。

顺便说一句，我对 evilhackers.org 没有任何反对意见，如果它存在的话......

在没有安全问题的情况下，一切都是为了避免编程错误，当然这取决于您如何做到这一点。子类必须遵守父类的契约，而不变性只是契约的一部分。但是，如果一个类的实例应该是不可变的，那么将其设为 final 是确保它们确实都是不可变的一种好方法（即，不存在子类的可变实例，它可以在父类的任何地方使用上课）。

我认为您引用的文章不应被视为“所有不可变类都必须是最终的”的说明，特别是如果您有充分的理由设计不可变类以进行继承。它的意思是保护不变性是 final 的一个正当理由，其中虚构的性能问题（这是它当时真正谈论的）是无效的。请注意，它给出了“一个不是为继承而设计的复杂类”作为同样有效的理由。可以公平地说，在复杂类中不考虑继承是应该避免的，就像在不可变类中不考虑继承一样。但如果你不能解释它，你至少可以通过阻止它来表明这个事实。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-01-27T10:54:16.813

出于性能原因，使类不可变也是一个好主意。以 Integer.valueOf 为例。当您调用此静态方法时，它不必返回新的 Integer 实例。它可以安全地返回一个先前创建的实例，因为它知道当它上次传递给您对该实例的引用时您没有修改它（我想从安全原因的角度来看这也是一个很好的推理）。

我同意 Effective Java 在这些问题上的观点——你应该设计你的类以实现可扩展性或使它们不可扩展。如果您打算使某些东西可扩展，则可以考虑使用接口或抽象类。

此外，您不必将课程定为最终课程。您可以将构造函数设为私有。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-05-27T12:21:01.093

**那么，为什么不可变性是使类成为 final 的一个很好的理由呢？**

如[oracle 文档](https://docs.oracle.com/javase/tutorial/essential/concurrency/imstrat.html)中所述，使类不可变基本上有 4 个步骤。

所以其中一点指出

**使类不可变类应标记为 final 或具有私有构造函数**

以下是使类不可变的 4 个步骤（直接来自 oracle 文档）

1.  不要提供“setter”方法——修改字段或字段引用的对象的方法。

2.  将所有字段设为最终字段和私有字段。

3.  不允许子类覆盖方法。最简单的方法是将类声明为 final。更复杂的方法是使构造函数私有并在工厂方法中构造实例。

4.  如果实例字段包含对可变对象的引用，则不允许更改这些对象：

    *   不要提供修改可变对象的方法。
    *   不要共享对可变对象的引用。永远不要存储对传递给构造函数的外部可变对象的引用；如有必要，创建副本并存储对副本的引用。同样，在必要时创建内部可变对象的副本以避免在方法中返回原始对象。

# c# - 每个命名空间分支的理想类数

> ID：146316
> 
> 赞同：11
> 
> 时间：2008-09-28T17:35:12.157
> 
> 标签：c#, namespaces, grouping

您认为每个命名空间“分支”有多少类是理想的？什么时候会决定将一个命名空间分解为多个命名空间？让我们不讨论类的逻辑分组（假设它们在逻辑上被正确分组），在这一点上，我专注于可维护与不可维护的类数量。

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2008-09-29T12:34:04.400

“42？不行，不行……”

好的，让我们发挥我们的编程能力，看看微软的意见是什么：

```
# IronPython
import System
exported_types = [
  (t.Namespace, t.Name)
  for t in System.Int32().GetType().Assembly.GetExportedTypes()]

import itertools
get_ns = lambda (ns, typename): ns
sorted_exported_types = sorted(exported_types, key=get_ns)
counts_per_ns = dict(
  (ns, len(list(typenames)))
  for ns, typenames
  in itertools.groupby(sorted_exported_types, get_ns))
counts = sorted(counts_per_ns.values())

print 'Min:', counts[0]
print 'Max:', counts[-1]
print 'Avg:', sum(counts) / len(counts)
print 'Med:',
if len(counts) % 2:
  print counts[len(counts) / 2]
else: # ignoring len == 1 case
  print (counts[len(counts) / 2 - 1] + counts[len(counts) / 2]) / 2 
```

这为我们提供了有关每个命名空间类型数量的以下统计信息：

```
C:\tools\nspop>ipy nspop.py
Min: 1
Max: 173
Avg: 27
Med: 15 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2008-09-28T17:38:43.943

使用现代 IDE 和其他开发工具，我会说如果所有类都属于一个命名空间，那么为了可维护性，你应该分解一个命名空间的任意数量是不存在的。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-28T19:09:22.400

我认为命名空间应该尽可能大。如果有合理的理由创建同级命名空间或子命名空间，那么就这样做。我认为将其拆分为命名空间的主要原因是为了简化开发，使开发人员更容易导航命名空间层次结构以找到他们需要的内容。

如果您有一个包含多种类型的名称空间，并且您觉得很难找到某些类型，那么请考虑将它们移至另一个名称空间。如果类型专门用于父命名空间类型，我将使用子命名空间，如果类型可以在没有原始命名空间类型的情况下使用或具有不同用途，我将使用同级命名空间。当然，这完全取决于您要创建的内容和目标受众。

如果命名空间的类型少于 20 种，则不太可能值得拆分。但是，您应该在设计期间考虑命名空间分配，以便在开发时预先知道哪些类型在哪些命名空间中。如果您在开发过程中进行命名空间分配，那么在您确定应该去哪里时，预计会进行大量重构。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-08-09T21:43:52.513

这里没有涉及的一件事，尽管它在某种程度上与 Chris 的观点有关，但命名空间的可学习性不仅仅与项目的数量有关。

（顺便说一下，这适用于最广泛意义上的“命名空间”——一个类本身就是一般意义上的命名空间，因为它包含某些名称，这些名称在该上下文中的含义与在另一个上下文中的含义不同，枚举是一个命名空间这种感觉也是）。

假设我遇到了一个带有*Element*类的 XML 相关名称空间。我对此有所了解，当我查看*Attribute*类时，我发现了一些相似之处。然后，当我看到一个*ProcessingInstruction*类时，我可以对它的工作原理做出合理的猜测（如果我猜完全错误，这可能是一个设计缺陷，充其量差异不仅需要记录，还需要解释）。我可以猜到在我看到之前有一个*Comment类。*我会去寻找你的*TextNode*类，并想知道这些是否都继承自*Node*而不必从文档中了解它们。我想知道您对*Lang采取了几种合理的方法中的哪一种*类，而不是想知道它是否在那里。

因为这一切都与我已经了解的领域有关，所以这七个类的概念“成本”比称为*Sheep*、*Television*、*FallOfSaigon*、*Enuii*、*AmandaPalmersSoloWork*、*ForArtsSakeQuotient*和*DueProcess*的七个类要少得多。

这与 Chirs 的观​​点有关，因为他说为了可用性，我们被建议减少选择的数量。但是，如果我们可以按字母顺序选择国家/地区，我们会立即浏览整个列表并立即选择我们需要的国家，因此减少选择的建议并不适用（实际上，一次选择几个选项可以同时不太有用且可能具有侮辱性）。

如果您的命名空间有 200 个名称，但您只需要**真正**学习半打就可以理解很多，那么与拥有十几个彼此几乎没有关系的名称相比，理解要容易得多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T17:39:19.450

我知道您不想讨论逻辑分组，但是要进行拆分，您需要能够对两个不同的命名空间进行分组。我会开始考虑在大约 30 个类中使用一个新的命名空间；但是我不会认为这是一个主要问题。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-26T17:16:19.330

我必须说，我发现以上所有内容都非常令人惊讶。

可用性专家告诉我们将菜单中的选项数量控制在有限的范围内，这样我们就可以立即看到所有选项。这同样适用于您组织工作的方式。

我通常期望命名空间中有 4-10 种类型。节省了很多寻找东西和上下滚动的时间。使用 resharper 移动东西是如此快速和容易，我看不出有什么理由不这样做。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-26T17:28:32.077

应该提到的另一件事是，将包含扩展方法的类放在它自己的命名空间中通常是值得的，这样您就可以使用`using`指令启用或禁用这些扩展方法。因此，如果命名空间中的事物是包含扩展方法的静态类，则答案是 1。

# performance - 提高实时系统的性能

> ID：146320
> 
> 赞同：0
> 
> 时间：2008-09-28T17:38:08.657
> 
> 标签：performance, real-time

首先，我想确定金融界实时系统可接受的端到端延迟小于 200 毫秒。好的，这就是我所追求的。在实时系统的设计中，有一些“设计模式”（或技术）可以提高性能（即减少处理时间、提高可伸缩性等）。

我所追求的一个例子是，使用 GUID 而不是序号来分配主键。GUID 的基本原理是处理程序拥有自己的主键生成器，而无需相互“协商”。这允许发生并行处理并允许缩放。

这里还有一些。我会尽量添加到列表中。

*   使用[事件驱动架构（EDA）](http://en.wikipedia.org/wiki/Event_Driven_Architecture)。
*   使用消息队列来支持 EDA。

我向社区的集体智慧低头。多谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-28T18:34:52.403

对于一般的实时系统工作，经典规则是追求可变性并杀死它。真正的硬实时意味着使用静态计划、简化的操作系统、高效的设备驱动程序和坚如磐石的优先级。如果您真的希望计算 X 在已知的时限 T 内结束，那么动态或自适应的东西是不可行的。

我猜你的意思在这方面并不是真正的实时，而且我猜这个系统比读取传感器、计算控制回路、激活执行器要复杂一些。更多细节会很高兴知道这里有哪些限制。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T18:53:06.120

您已经提到了事件驱动架构，我建议您看看分阶段事件驱动架构 (SEDA)。

阶段本质上是事件队列和对事件进行操作的函数。这种架构的“非常规”之处在于每个阶段都可以在自己的线程中运行，并且功能通常需要异步 I/O 等。以这种方式排列程序一开始很尴尬，但允许各种魔法 - 比如QoS，调整调度等。

参见威尔士的伯克利论文和他的[网站](http://www.eecs.harvard.edu/~mdw/proj/seda/)。您还可以查看 Minor Gordon 的项目（来自英国剑桥），称为[yield](http://code.google.com/p/yield/)。他取得了一些非常好的结果。看起来该项目一开始是面向 Python 的，但它也可以用于纯 c++。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T19:08:39.983

尽管听起来很基本，但大多数业务线应用程序都充满了冗余计算，消除它们。计算重构是优化模式的支柱。每次出现处理周期时，您都必须询问：

此周期内的计算结果与周期外的输出相同。作为一个基本示例：

```
for(int i=0;i< x/2; i++)
  //do something 
```

在这里，您可以安全地取 x/2 并在 cicle 之前计算它并重用该值（现代编译器现在负责这些琐碎的优化）

为了了解这个简单规则的影响，我可以给你一个应用于数据库查询的例子。为了避免两个表的 INNER JOIN 以获得高度重复的字段 requent，您可以违反规范化规则并将其复制到与具有该值的表相关的表上。这避免了重复的表连接处理，并且可以释放并行化，因为只有一个表需要锁定在事务上。例子：

客户表查询经常需要客户折扣，但折扣保存在客户类型表中。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-11-05T01:11:12.327

除非您确定它已“损坏”，否则不要“修复”任何东西。

我要做的第一件事是从必须快速运行的程序中调出火焰。我会使用我[最喜欢的技术](http://www.wikihow.com/Optimize-Your-Program%27s-Performance)。然后，很有可能，会有足够的回旋余地来玩弄建筑。

# visual-studio-2008 - VS2008 中的 C++ 代码片段

> ID：146328
> 
> 赞同：1
> 
> 时间：2008-09-28T17:41:09.710
> 
> 标签：visual-studio-2008, code-snippets

有人知道支持 C++ 片段的 VS2008 的任何端口吗？

VS2005 有一个不错的增强包：

[Microsoft Visual Studio 2005 IDE 增强功能](http://www.microsoft.com/downloads/details.aspx?FamilyID=cd7c6e48-e41b-48e3-881e-a0e6e97f9534&DisplayLang=en)

但是 VS2008 不支持 C++ 功能的片段。我已经尝试使用 SDK 重新实现它，但由于时间不足而放弃了，因为在 Babel 中有大量的语言细节需要了解。我很难相信现在没有人需要它并实现它，因为如果正确使用，片段可以成为最有效的生产加速器之一。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T00:39:25.697

我已经使用 Whole Tomato 的[Visual Assist X](http://www.wholetomato.com/)多年了，它内置了一个非常好的片段系统。使用视觉辅助 UI 定义片段非常简单，它还具有一些增强智能感知和代码导航的强大功能。虽然是 99 美元，但在我看来非常值得。

# php - 在 httpd.conf 中设置 PHP 变量？

> ID：146354
> 
> 赞同：25
> 
> 时间：2008-09-28T17:56:33.527
> 
> 标签：php, apache

我想在每个虚拟主机的基础上自动更改我的数据库连接设置，这样我就不必编辑任何 PHP 代码，因为它从暂存转移到实时并访问不同的数据库。这是在单个专用服务器上。

所以我想知道，我可以在 httpd.conf 中设置一个 PHP 变量或常量作为 vhost 定义的一部分，然后站点可以使用它来自动将自己指向测试数据库吗？

```
$database = 'live';
if (some staging environment variable is true) {
    $database = 'testing'; // and not live
} 
```

如果这不可能，我想在这种情况下我可以安全地检查我正在运行的主机名，但我想要一些不那么脆弱的东西

希望这是有道理的

非常感谢

伊恩

* * *

## 回答 #1

> 赞同：81
> 
> 时间：2008-09-28T18:08:04.560

是的......你可以这样做：

```
SetEnv DATABASE_NAME testing 
```

然后在 PHP 中：

```
$database = $_SERVER["DATABASE_NAME"]; 
```

或者

```
$database = getenv("DATABASE_NAME"); 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-28T18:08:41.577

您可以设置环境变量并使用 PHP 检索它。

在 httpd.conf 中：

```
SetEnv database testing 
```

在您的 PHP 中：

```
if (getenv('database') == 'testing') { 
```

或者

```
if ($_SERVER['database'] == 'testing') { 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2008-09-28T18:35:19.627

您是否尝试使用 .htaccess 文件？您可以使用它覆盖 php.ini 值。

只需将 .htaccess 文件放入您的 htdocs 目录：

```
php_value name value 
```

更多信息：

*   [https://php.net/manual/en/configuration.changes.php](https://php.net/manual/en/configuration.changes.php)
*   [https://php.net/manual/en/ini.php](https://php.net/manual/en/ini.php)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-28T19:56:05.097

我不会设置环境变量，因为这在默认脚本输出中也可见，例如 PhpInfo();

只需在 htdocs 文件夹上方的 .htaccess 中使用 php_value 就可以了，并且安全:)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-05-23T12:42:30.543

.htaccess 的问题在于它是代码库树的一部分。代码库树是 VC/SVN 的一部分。因此，本地/开发中的任何更改都会转移到生产中。在 httpd.conf 中保留 env 变量设置可以节省您小心不要意外覆盖服务器 vs dev 标志的工作。当然，除非您想使用 IP 地址或主机名，这两者都不是可扩展的方法。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-04-07T22:19:39.953

我也在研究这种类型的解决方案。我发现的是，在 Apache 下，您可以`SetEnv KeyName DataValue`在 http.conf 中使用，在 IIS 中，您可以使用 Fast CGI Settings >> Edit... >> Environment Variables >> ... 并添加`KeyName, DataValue`.

这反过来又允许在IIS 和 Apache 下一致`$var = $_SERVER["KeyName"];`地将 PHP 设置为并根据需要使用。`DataValue`

我知道这是一个奇怪的用例。我在工作中使用 WAMP，在家里使用 MAMP，所以能够以同样的方式工作真是太好了。

# c# - 在 .NET 中有效地合并字符串数组，保持不同的值

> ID：146358
> 
> 赞同：45
> 
> 时间：2008-09-28T17:59:01.087
> 
> 标签：c#, linq, arrays, merge, distinct

我正在使用.NET 3.5。我有两个字符串数组，它们可能共享一个或多个值：

```
string[] list1 = new string[] { "apple", "orange", "banana" };
string[] list2 = new string[] { "banana", "pear", "grape" }; 
```

我想要一种方法将它们合并到一个没有重复值的数组中：

```
{ "apple", "orange", "banana", "pear", "grape" } 
```

我可以用 LINQ 做到这一点：

```
string[] result = list1.Concat(list2).Distinct().ToArray(); 
```

但我想这对于大型阵列不是很有效。

有没有更好的办法？

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2008-09-29T01:04:37.117

```
string[] result = list1.Union(list2).ToArray(); 
```

来自[msdn](http://msdn.microsoft.com/en-us/library/bb341731.aspx)：“此方法从返回集中排除重复项。这与 Concat(TSource) 方法的行为不同，后者返回输入序列中的所有元素，包括重复项。”

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-28T18:27:36.917

为什么你认为它会是低效的？据我所知， Concat 和 Distinct 都是懒惰地评估的，在 Distinct 幕后使用 HashSet 来跟踪已经返回的元素。

我不确定您如何设法使其比一般方式更有效:)

编辑： Distinct 实际上使用 Set（一个内部类）而不是 HashSet，但要点仍然是正确的。这是一个很好的例子，说明 LINQ 是多么的简洁。最简单的答案几乎与您在没有更多领域知识的情况下所能达到的一样有效。

效果相当于：

```
public static IEnumerable<T> DistinctConcat<T>(IEnumerable<T> first, IEnumerable<T> second)
{
    HashSet<T> returned = new HashSet<T>();
    foreach (T element in first)
    {
        if (returned.Add(element))
        {
            yield return element;
        }
    }
    foreach (T element in second)
    {
        if (returned.Add(element))
        {
            yield return element;
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-28T18:22:27.910

.NET 3.5 引入了 HashSet 类，它可以做到这一点：

```
IEnumerable<string> mergedDistinctList = new HashSet<string>(list1).Union(list2); 
```

不确定性能，但它应该超过你给出的 Linq 示例。

编辑：我的立场得到纠正。Concat 和 Distinct 的惰性实现具有关键的内存和速度优势。Concat/Distinct 大约快 10%，并保存多个数据副本。

我通过代码确认：

```
Setting up arrays of 3000000 strings overlapping by 300000
Starting Hashset...
HashSet: 00:00:02.8237616
Starting Concat/Distinct...
Concat/Distinct: 00:00:02.5629681 
```

是输出：

```
 int num = 3000000;
        int num10Pct = (int)(num / 10);

        Console.WriteLine(String.Format("Setting up arrays of {0} strings overlapping by {1}", num, num10Pct));
        string[] list1 = Enumerable.Range(1, num).Select((a) => a.ToString()).ToArray();
        string[] list2 = Enumerable.Range(num - num10Pct, num + num10Pct).Select((a) => a.ToString()).ToArray();

        Console.WriteLine("Starting Hashset...");
        Stopwatch sw = new Stopwatch();
        sw.Start();
        string[] merged = new HashSet<string>(list1).Union(list2).ToArray();
        sw.Stop();
        Console.WriteLine("HashSet: " + sw.Elapsed);

        Console.WriteLine("Starting Concat/Distinct...");
        sw.Reset();
        sw.Start();
        string[] merged2 = list1.Concat(list2).Distinct().ToArray();
        sw.Stop();
        Console.WriteLine("Concat/Distinct: " + sw.Elapsed); 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-28T18:12:00.417

**免责声明**这是过早的优化。对于您的示例数组，请使用 3.5 扩展方法。在您知道您在该区域存在性能问题之前，您应该使用库代码。

* * *

如果您可以对数组进行排序，或者当您到达代码中的那一点时对它们进行排序，您可以使用以下方法。

这些将从两者中提取一个项目，并产生“最低”项目，然后从相应的源中获取一个新项目，直到两个源都用尽。如果从两个来源获取的当前项目相等，它将从第一个来源生成一个，并在两个来源中跳过它们。

```
private static IEnumerable<T> Merge<T>(IEnumerable<T> source1,
    IEnumerable<T> source2)
{
    return Merge(source1, source2, Comparer<T>.Default);
}

private static IEnumerable<T> Merge<T>(IEnumerable<T> source1,
    IEnumerable<T> source2, IComparer<T> comparer)
{
    #region Parameter Validation

    if (Object.ReferenceEquals(null, source1))
        throw new ArgumentNullException("source1");
    if (Object.ReferenceEquals(null, source2))
        throw new ArgumentNullException("source2");
    if (Object.ReferenceEquals(null, comparer))
        throw new ArgumentNullException("comparer");

    #endregion

    using (IEnumerator<T>
        enumerator1 = source1.GetEnumerator(),
        enumerator2 = source2.GetEnumerator())
    {
        Boolean more1 = enumerator1.MoveNext();
        Boolean more2 = enumerator2.MoveNext();

        while (more1 && more2)
        {
            Int32 comparisonResult = comparer.Compare(
                enumerator1.Current,
                enumerator2.Current);
            if (comparisonResult < 0)
            {
                // enumerator 1 has the "lowest" item
                yield return enumerator1.Current;
                more1 = enumerator1.MoveNext();
            }
            else if (comparisonResult > 0)
            {
                // enumerator 2 has the "lowest" item
                yield return enumerator2.Current;
                more2 = enumerator2.MoveNext();
            }
            else
            {
                // they're considered equivalent, only yield it once
                yield return enumerator1.Current;
                more1 = enumerator1.MoveNext();
                more2 = enumerator2.MoveNext();
            }
        }

        // Yield rest of values from non-exhausted source
        while (more1)
        {
            yield return enumerator1.Current;
            more1 = enumerator1.MoveNext();
        }
        while (more2)
        {
            yield return enumerator2.Current;
            more2 = enumerator2.MoveNext();
        }
    }
} 
```

请注意，如果其中一个源包含重复项，您可能会在输出中看到重复项。如果要删除已排序列表中的这些重复项，请使用以下方法：

```
private static IEnumerable<T> CheapDistinct<T>(IEnumerable<T> source)
{
    return CheapDistinct<T>(source, Comparer<T>.Default);
}

private static IEnumerable<T> CheapDistinct<T>(IEnumerable<T> source,
    IComparer<T> comparer)
{
    #region Parameter Validation

    if (Object.ReferenceEquals(null, source))
        throw new ArgumentNullException("source");
    if (Object.ReferenceEquals(null, comparer))
        throw new ArgumentNullException("comparer");

    #endregion

    using (IEnumerator<T> enumerator = source.GetEnumerator())
    {
        if (enumerator.MoveNext())
        {
            T item = enumerator.Current;

            // scan until different item found, then produce
            // the previous distinct item
            while (enumerator.MoveNext())
            {
                if (comparer.Compare(item, enumerator.Current) != 0)
                {
                    yield return item;
                    item = enumerator.Current;
                }
            }

            // produce last item that is left over from above loop
            yield return item;
        }
    }
} 
```

请注意，这些都不会在内部使用数据结构来保留数据的副本，因此如果输入已排序，它们将很便宜。如果您不能或不会保证，您应该使用您已经找到的 3.5 扩展方法。

下面是调用上述方法的示例代码：

```
String[] list_1 = { "apple", "orange", "apple", "banana" };
String[] list_2 = { "banana", "pear", "grape" };

Array.Sort(list_1);
Array.Sort(list_2);

IEnumerable<String> items = Merge(
    CheapDistinct(list_1),
    CheapDistinct(list_2));
foreach (String item in items)
    Console.Out.WriteLine(item); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-28T18:08:04.263

可能使用您的值作为键创建一个哈希表（仅添加那些不存在的键），然后将键转换为数组可能是一个可行的解决方案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-28T18:14:55.667

在您测量之前，您不知道哪种方法更快。LINQ 方式优雅且易于理解。

另一种方法是将集合实现为哈希数组（字典）并将两个数组的所有元素添加到集合中。然后使用 set.Keys.ToArray() 方法创建结果数组。

# python - Python范围：“UnboundLocalError：分配前引用的局部变量'c'”

> ID：146359
> 
> 赞同：41
> 
> 时间：2008-09-28T17:59:30.663
> 
> 标签：python, scope

我试图弄清楚这一点：

```
c = 1
def f(n):
    print c + n 
def g(n):
    c = c + n

f(1) # => 2
g(1) # => UnboundLocalError: local variable 'c' referenced before assignment 
```

谢谢！

* * *

## 回答 #1

> 赞同：52
> 
> 时间：2008-09-28T18:02:54.260

在函数中，分配给的变量默认被视为局部变量。要分配给全局变量，请使用以下[`global`](https://docs.python.org/3/reference/simple_stmts.html#the-global-statement)语句：

```
def g(n):
    global c
    c = c + n 
```

这是 Python 中从未真正让我满意的古怪领域之一。

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-09-28T19:33:23.497

全局状态是需要避免的，尤其是需要对其进行变异。考虑是否`g()`应该简单地采用两个参数，或者如果`f()`并且`g()`需要是具有`c`实例属性的公共类的方法

```
class A:
    c = 1
    def f(self, n):
        print self.c + n
    def g(self, n):
        self.c += n

a = A()
a.f(1)
a.g(1)
a.f(1) 
```

输出：

```
2
3 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2008-09-29T20:42:21.387

[Greg 帖子的](https://stackoverflow.com/questions/146359/python-scope#146365)勘误表：

*在它们被引用之前*应该没有。看一看：

```
`x = 1
def explode():
    print x # raises UnboundLocalError here
    x = 2` 
```

`它会爆炸，即使 x 在被引用后被分配。在 Python 中，变量可以是本地的，也可以是外部范围的，并且不能在一个函数中更改。`

 `* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-28T19:39:13.000

除了 Greg 所说的，在 Python 3.0 中，将有一条非本地语句来声明“这里有一些在封闭范围内定义的名称”。与全局不同，这些名称必须已经在当前范围之外定义。追踪名称和变量将很容易。如今，您无法确定“全局变量”的确切定义在哪里。

# .net - 您的小型 Web 开发公司设置是什么？

> ID：146361
> 
> 赞同：3
> 
> 时间：2008-09-28T17:59:50.227
> 
> 标签：.net, language-agnostic, development-environment

我为一家小型 Web 开发公司（只有 2 到 3 名开发人员）工作，该公司为不同的客户（从 CMS 到电子商务网站）开展广泛的项目。

通常我们在自己的项目上工作，但偶尔我们需要一起工作。我们使用 subversion 作为我们的源代码控制软件，并且网站是使用 VS 2008 和 SQL 2005 在 .NET 中开发的。

在阅读了大量有关单元测试和其他“企业”级编码实践的帖子后，我想知道其他开发人员为只需要最少维护且开发时间短的小型项目做了什么？

我特别在考虑诸如是否需要进行单元测试等事情。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-28T18:07:39.770

无论如何，单元测试都是必要的。如果您编写代码，则进行单元测试。我自己也经常工作。我还在测试。我不知道我之前是怎么写代码的。

这是我看待它的方式。你不一定需要像大男孩一样昂贵的工具，但如果你想变大，你就必须想得远。做同样的事情，遵循同样的做法。随着您的需求增长，获得更好的工具。例如，如果你做任何 UML 图表，你可能不需要任何安全软件。只是一张白板/纸。但仍然使用UML。当您的需求增长时，您可以考虑获取特殊软件。

甚至项目管理。只要您这样做，您就不一定需要昂贵的工具来跟踪项目。随着您的需求增长，您可以获得专门的软件。

简而言之，如果你更大，你会做同样的事情，但你不一定需要相同的工具。根据需要获取。

编辑：我应该提一下，尽管您所做的某些事情当然取决于您使用的方法/流程。例如，您是否进行敏捷开发？小你不一定需要做所有事情都完全相同。例如，我尝试变得敏捷，但我显然不配对程序:)。你只需要学会让它们适应对你有用的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T20:19:30.967

我认为您可能犯的最大错误是将某些东西视为“企业”级编码标准而忽略。尽管 CI、构建服务器、单元测试、编码标准（我想不出你还有什么意思）等东西可能会产生初始开销，但从长远来看，它们会带来红利。例如，如果您的项目现在和三年后一起被破解，您的客户想要添加一个功能，您会很高兴您现在花时间进行单元测试。（好吧，这可能会发生也可能不会发生，但是......如果您的客户将来让某人查看您的解决方案并且他们看到严重黑客攻击的代码，他们可能不会再次使用您）。

还要记住，你做的越多，它就会变得越快。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T18:33:12.300

我们的开发环境也很小。我们主要做 Java Web 开发（一些 php），而不是 .NET 或其他东西。我们将 Project locker 用于我们的 wiki、svn 和错误跟踪系统。对于代码开发，它在 Netbeans 6.1 和作为我们的数据库后端的 Eclipse 和 MySQL 之间有所不同。
我们已经将为我们的代码编写单元测试作为标准做法。它使我们的代码库在 4 个月后升级变得更加容易。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-28T20:26:21.263

问题是：如果您知道在部署这些东西之前至少单元测试运行良好，那么您晚上睡得更好。

# c# - Asp.Net MVC：如何让 Html.ActionLink 正确呈现整数值？

> ID：146367
> 
> 赞同：5
> 
> 时间：2008-09-28T18:03:13.637
> 
> 标签：c#, asp.net-mvc, routing

我有一个 asp.net mvc 应用程序，其路由类似于：

```
routes.MapRoute("Blog", 
    "{controller}/{action}/{year}/{month}/{day}/{friendlyName}",                          
    new { controller = "Blog", action = "Index", id = "", friendlyName="" }, 
    new { controller = @"[^\.]*", 
          year = @"\d{4}", 
          month = @"\d{2}", 
          day = @"\d{2}" }
); 
```

我的控制器操作方法签名如下所示：

```
public ActionResult Detail(int year, int month, int day, string friendlyName)
{ // Implementation... } 
```

在我看来，我正在做类似的事情：

```
<%= Html.ActionLink<BlogController>(item => item.Detail(blog.PostedOn.Year, blog.PostedOn.Month, blog.PostedOn.Day, blog.Slug), blog.Title) %> 
```

虽然使用 ActionLink 生成的 url 有效，但它使用查询字符串变量而不是 URL 重写。

例如，它将产生 /blog/detail/my-slug?year=2008&month=7&day=5 而不是 /blog/detail/2008/07/05/my-slug

有没有办法让 ActionLink 的通用版本正确填充整数值，以便 url 按预期显示？

谢谢

吉姆

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-28T18:22:45.727

您的参数是整数这一事实与您的问题无关。您要使用的路由定义实际上并未被使用，这就是生成的 URL 使用查询字符串参数而不是构建您想要的结构的原因。

路由是自上而下评估的，因此您可能有一个更通用的路由定义来满足您请求的 URL 生成。尝试将您在这篇文章中显示的路线移动到路线定义的顶部，您会看到生成的链接与您预期的一样。然后考虑修改您的路线定义以更具体，或者只是根据需要移动它们。

调试这些类型的场景可能是一个巨大的痛苦。我建议下载 Phil Haack 的[路由调试器](http://haacked.com/archive/2008/03/13/url-routing-debugger.aspx)，它会让你的生活轻松很多。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-28T18:15:23.263

我建议将年、月和日格式化为字符串。想一想：你会对这些“整数”做任何数学运算吗？可能不是，因此将它们设为整数确实没有意义。将它们作为字符串后，您可以强制使用前导零格式。

# assembly - 无法运行汇编程序

> ID：146368
> 
> 赞同：1
> 
> 时间：2008-09-28T18:03:16.443
> 
> 标签：assembly, nasm, x86

我刚刚开始阅读 80x86 汇编语言和计算机体系结构简介。我正在尝试使用 NASM 来运行第 3 章中显示的第一个示例，但没有成功。有人读过这本书并运行示例吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-28T20:04:35.170

根据 Google Books，您应该使用[MASM](http://www.masm32.com/)，而不是 NASM。试试看。

供参考的家伙，第 47 页[在这里](http://books.google.co.nz/books?id=TFw5vo-2ZYwC&dq=Introduction+to+80x86+Assembly+Language+and+Computer+Architecture&pg=PP1&ots=Q6BlvMLErg&sig=7mUshrWDXlJOZO5yhuB4CrKUZvA&hl=en&sa=X&oi=book_result&resnum=4&ct=result#PPA47,M1)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-10-30T08:56:11.207

我更喜欢 NASM 而不是 MASM。它们之间存在显着[差异](http://www.nasm.us/doc/nasmdoc2.html#section-2.2)，尤其是在变量和过程等方面（它们实际上并不是 NASM 方法的一部分）。您必须自己决定使用哪个。

# c++ - Visual Studio 是否支持新的 C/C++ 标准？

> ID：146381
> 
> 赞同：102
> 
> 时间：2008-09-28T18:08:19.067
> 
> 标签：c++, visual-studio, visual-c++, c++11, c99

我一直在阅读有关 C99 和 C++11 以及所有这些完全甜蜜的东西，它们被添加到语言标准中，将来可能会很好用。然而，我们目前在 Visual Studio 中编写 C++ 的土地上苦苦挣扎。

标准中的任何新内容是否会被添加到 Visual Studio 中，或者微软是否更有兴趣添加新的 C# 变体来做到这一点？

编辑：除了接受的答案之外，我还找到了 Visual C++ 团队博客：

[http://blogs.msdn.com/vcblog/](http://blogs.msdn.com/vcblog/)

具体来说，其中的这篇文章：

[https://web.archive.org/web/20190109064523/https://blogs.msdn.microsoft.com/vcblog/2008/02/22/tr1-slide-decks/](https://web.archive.org/web/20190109064523/https://blogs.msdn.microsoft.com/vcblog/2008/02/22/tr1-slide-decks/)

很有用。谢谢！

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2008-09-28T18:24:11.043

MS对此有一系列公开回复，其中大多数都指责他们的用户。像这个：

[https://devblogs.microsoft.com/cppblog/iso-c-standard-update/](https://devblogs.microsoft.com/cppblog/iso-c-standard-update/)

> 现在，Visual C++ 编译器团队偶尔会收到关于我们为什么没有实现 C99 的问题。它实际上是基于我们用户的兴趣。我们收到了许多对某些 C99 功能的请求，我们尝试实现它们（或类似物）。几个例子是可变参数宏、`long long`、`__pragma`、`__FUNCTION__`和`__restrict`。如果您发现其他 C99 功能对您的工作有用，请告诉我们！我们从 C 用户那里听到的消息不多，所以大声说出来，让自己听到

[http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=345360](http://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=345360)

> 嗨：不幸的是，我们从大多数用户那里得到的压倒性反馈是，他们更愿意我们专注于 C++-0x 而不是 C-99。我们已经“精心挑选”了某些流行的 C-99 特性（可变参数宏`long long`），但除此之外，我们不太可能在 C-99 领域做更多的事情（至少在短期内）。
> 
> 乔纳森洞穴
> 
> Visual C++ 编译器团队。

这是一种非常可悲的情况，但如果您怀疑 MS 想要锁定用户，这也是有道理的：将现代基于 gcc 的代码移植到 MSVC 中变得非常困难，至少我觉得这非常痛苦。

但是，存在一种解决方法：请注意，英特尔对此更加开明。英特尔 C 编译器可以处理 C99 代码，甚至具有与 gcc 相同的标志，从而更容易在平台之间移植代码。此外，英特尔编译器在 Visual Studio 中工作。因此，通过废弃 MS COMPILER，您仍然可以使用您认为具有某种价值的 MS IDE，并使用 C99 来满足您的需求。

老实说，一个更明智的方法是转移到 Intel CC 或 gcc，并在您的编程环境中使用 Eclipse。根据我的经验，跨 Windows-Linux-Solaris-AIX-etc 的代码可移植性通常很重要，不幸的是，MS 工具根本不支持这一点。

* * *

## 回答 #2

> 赞同：37
> 
> 时间：2008-09-28T19:34:15.367

Herb Sutter 是 C++ 标准化委员会的主席和非常活跃的成员，同时也是 Visual Studio for Microsoft 的软件架构师。

他是为 C++0x 标准化的新 C++ 内存模型的作者之一。例如以下论文：

[http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2669.htm](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2008/n2669.htm)
[http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007 /n2197.pdf](http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2007/n2197.pdf)

有他的名字。所以我想只要 H. Sutter 留在微软，C++0x 就可以包含在 Windows 上。

至于 C99 仅部分包含在 Visual Studio 中，我想这是一个优先级问题。

*   最有趣的 C99 功能已经存在于 C++ 中（内联、随处声明变量、// 注释等），并且可能已经在 Visual Studio 的 C 中可用（如果只在 C++ 编译器中编写 C 代码）。[有关 C++ 中 C99 功能的](https://stackoverflow.com/questions/3879636/what-can-be-done-in-c-but-not-c/3880281#3880281)更完整讨论，请参阅我的答案。
*   C99 通过添加 C++ 中已经存在的功能，但以不兼容的方式增加了 C 和 C++ 之间的差异（抱歉，C99 中的~~布尔~~复杂实现是可笑的，充其量是...参见[http://david.tribble.com/文本/cdiffs.htm](http://david.tribble.com/text/cdiffs.htm)了解更多信息）
*   Windows 上的 C 社区似乎不存在或不够重要以至于无法得到承认
*   Windows 上的 C++ 社区似乎太重要了，不容忽视
*   .NET 是微软希望人们在 Windows 上编程的方式。这意味着 C#、VB.NET，也许是 C++/CLI。

那么，我会是微软吗，当大多数人已经使用的社区活跃语言已经提供了相同的功能时，为什么我要实现很少人会使用的功能？

## 结论？

C++0x 将被包括在内，作为 VS 2008 的扩展，或在 Visual Studio 的下一代（几代？）中。

尚未实现的 C99 功能不会在未来几年内推出，除非发生一些戏剧性的事情（一个充满 C99 开发人员的国家突然出现？）

## 编辑 2011-04-14

显然，“充满C99开发者的国家”已经存在：http: [//blogs.msdn.com/vcblog/archive/2007/11/05/iso-c-standard-update.aspx#6415401](http://blogs.msdn.com/vcblog/archive/2007/11/05/iso-c-standard-update.aspx#6415401)
^_^

[不过，我猜，http: //blogs.msdn.com/vcblog/archive/2007/11/05/iso-c-standard-update.aspx#6828778](http://blogs.msdn.com/vcblog/archive/2007/11/05/iso-c-standard-update.aspx#6828778)上的最后一条评论已经足够清楚了。

## 编辑 2012-05-03

Herb Sutter 明确表示：

> 1.  我们的主要目标是支持“作为 ISO C++98/C++11 子集的大部分 C99/C11”。
> 2.  由于历史原因，我们还发布了一个 C90 编译器，它接受（仅）C90 而不是 C++
> 3.  我们不打算支持不属于 C90 或 ISO C++ 的 ISO C 功能。

博客文章为这些决定添加了链接和进一步的解释。

来源：[http ://herbsutter.com/2012/05/03/reader-qa-what-about-vc-and-c99/](http://herbsutter.com/2012/05/03/reader-qa-what-about-vc-and-c99/)

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2013-06-27T16:47:51.553

从[VC2013 preview 1](http://www.microsoft.com/visualstudio/eng/2013-downloads#d-2013-editions) , C99 开始，支持更多样化的 C++11 和一些新引入的 C++14 标准。查看官方博客了解更多详情：http: [//blogs.msdn.com/b/vcblog/archive/2013/06/27/what-s-new-for-visual-c-developers-in-vs2013-preview。 aspx](http://blogs.msdn.com/b/vcblog/archive/2013/06/27/what-s-new-for-visual-c-developers-in-vs2013-preview.aspx)

**更新：**

来自[https://news.ycombinator.com/item?id=9434483（Stephan](https://news.ycombinator.com/item?id=9434483) T Lavavej aka：STL 是 STL @VC 团队的维护者）：

> 具体来说，在 2015 年，我们的 C99 标准库实现已经完成，除了 tgmath.h（与 C++ 无关）和 CX_LIMITED_RANGE/FP_CONTRACT pragma 宏。

查看这篇文章了解详情：http: [//blogs.msdn.com/b/vcblog/archive/2015/04/29/c-11-14-17-features-in-vs-2015-rc.aspx](http://blogs.msdn.com/b/vcblog/archive/2015/04/29/c-11-14-17-features-in-vs-2015-rc.aspx)。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2008-09-29T12:19:12.580

我参与了 ISO C++ 工作（2000-2005 年），微软为该语言做出了重大贡献。毫无疑问，他们将在 C++0x 上工作，但他们需要比 Intel 更多的时间。Micosoft 必须处理经常使用其专有扩展的更大代码库。这只是使测试时间更长。然而，它们最终将支持大多数 C++0x（尽管导出仍然不受欢迎，或者我理解）。

谈到 ISO C，从事标准工作的人并不能代表微软的市场。如果微软的客户只是在寻找更好的 C，他们可以使用 C++98。那么微软为什么要在 C99 上花钱呢？当然，微软精心挑选了部分，但这是明智之举。他们无论如何都需要那些用于 C++0x 的，所以为什么要等呢？

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2008-09-28T19:45:42.437

不幸的是，MSVC 对 C 的支持非常缺乏。它仅支持作为 C++ 子集的 C99 部分……这意味着，例如，在 MSVC 中编译 ffmpeg 或其 libav* 库在物理上是不可能的，因为它们使用了许多 C99 特性，例如命名的结构元素。由于 libavcodec 还需要一个维护堆栈对齐的编译器，而 MSVC 不需要，这使情况变得更糟。

我在 x264 上工作，与 ffmpeg 不同，它*确实*努力支持 MSVC，尽管这样做本身就是一场噩梦。即使您通过显式的基于汇编的堆栈对齐函数显式传递最高函数调用，它也不会保持堆栈对齐，因此必须禁用所有需要对齐堆栈的函数。我也不能使用可变数组也很烦人；也许这是最好的，因为显然 GCC 在性能方面严重悲观它们。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2011-10-14T17:15:32.643

一篇关于 MSVC 对 MSVC 2010 和 2011 的 C++11 功能兼容性的更新文章[现已上线](http://blogs.msdn.com/b/vcblog/archive/2011/09/12/10209291.aspx)。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2008-09-28T18:12:57.497

微软从未表示过真正有兴趣跟上 c99 标准（现在已经过时了）。为 C 程序员感到难过，但我怀疑微软更关心 C++ 社区。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-28T18:19:13.083

Visual C++ 2008 SP1 至少包含 TR1 的部分内容，而且 Visual C++ 团队时不时地在博客或谈论 C++0x，所以我猜他们会在某个时候在该功能中支持它。虽然我没有读过任何官方的东西。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-11-10T20:05:20.927

这方面的更新信息：

现在（2008 年 11 月 10 日）有一个 VS2010 的“社区技术预览”（CTP），其中包含 VC10 的预览，其中实现了 C++0x 的*某些*部分（请注意，VC10 不会包含完整的 C++0x即使在 VC10 发布时也实现了更改）：

[http://www.microsoft.com/downloads/details.aspx?FamilyId=922B4655-93D0-4476-BDA4-94CF5F8D4814&displaylang=en](http://www.microsoft.com/downloads/details.aspx?FamilyId=922B4655-93D0-4476-BDA4-94CF5F8D4814&displaylang=en)

有关 VC10 CTP 中的新功能的一些详细信息：

*   [Visual Studio 2010 CTP 发布](http://blogs.msdn.com/vcblog/archive/2008/10/28/visual-studio-2010-ctp-released.aspx)
*   [Lambdas、auto 和 static_assert：VC10 中的 C++0x 特性，第 1 部分](http://blogs.msdn.com/vcblog/archive/2008/10/28/lambdas-auto-and-static-assert-c-0x-features-in-vc10-part-1.aspx)

如上文所述，“Microsoft Visual Studio 2010 年 9 月社区技术预览版 (CTP) 中的 Visual C++ 编译器包含对四种 C++0x 语言功能的支持，即：”

*   拉姆达，
*   汽车，
*   静态断言，
*   右值引用

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2008-09-28T18:55:47.907

Herb Sutter 是 ISO C++ 标准机构的主席，也为 Microsoft 工作。我不了解 Visual Studio C 标准——主要是因为我从不使用纯 C——但微软肯定会努力推动新的 C++ 标准向前发展。这方面的证据——就像提到的 OregonGhost 一样——包含在最新的 Visual Studio 服务版本中的 TR1。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2011-01-26T18:36:15.867

Visual C++ 团队确实在[http://blogs.msdn.com/b/vcblog/archive/2010/04/06/c-0x-core-language上发布了 2010 版支持的 C++0x 功能表-features-in-vc10-the-table.aspx](http://blogs.msdn.com/b/vcblog/archive/2010/04/06/c-0x-core-language-features-in-vc10-the-table.aspx)。由于规范和实现之间可能存在滞后时间，这似乎很合理。维基百科有一篇关于规范的好文章。在我写这篇文章的时候它还没有完成。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2013-06-28T03:03:30.660

Visual C++ Bloq 提供了很多关于在 VC++11 中支持 C++11 的几个有趣点的信息，包括几个表

*   C++11 核心语言特性
*   C++11 核心语言特性：并发
*   C++11 核心语言特性：C99
*   x86 容器大小（字节）
*   x64 容器大小（字节）

## [Visual C++ 团队博客，Visual C++ 11 中的 C++11 功能](http://blogs.msdn.com/b/vcblog/archive/2011/09/12/10209291.aspx)

# web-services - 服务器证书和客户端信任库

> ID：146385
> 
> 赞同：0
> 
> 时间：2008-09-28T18:09:47.987
> 
> 标签：web-services, ssl

我正在尝试使用 ssl 调用网络服务。我如何获得相关的服务器证书，以便我可以将其导入我的信任库？我知道从 main 方法使用属性 com.ibm.ssl.enableSignerExchangePrompt 但我会手动将服务器证书添加到我的信任库中。

我不想在我的任何 servlet 中设置此属性

非常感谢任何帮助谢谢 Damien

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-28T19:39:41.750

您可以通过实现自己的 X509TrustManager 以编程方式使用 Java 执行此操作。

```
 public class dummyTrustManager implements X509TrustManager {

        public void checkClientTrusted(X509Certificate[] chain, String authType) throws CertificateException {
            //do nothing
        }

        public void checkServerTrusted(X509Certificate[] chain, String authType) throws CertificateException {
            // do nothing
        }

        public X509Certificate[] getAcceptedIssuers() {
            //just return an empty issuer
            return new X509Certificate[0];
        }
    } 
```

然后你可以使用这个信任管理器来创建一个 SSL 套接字

```
 SSLContext context = SSLContext.getInstance("SSL");
context.init(null, new TrustManager[] { new dummyTrustManager() },
                            new java.security.SecureRandom());

SSLSocketFactory factory = context.getSocketFactory();
InetAddress addr = InetAddress.getByName(host_);
SSLSocket sock =  (SSLSocket)factory.createSocket(addr, port_); 
```

然后使用该套接字，您可以提取服务器证书（将其导入受信任的密钥库）

```
 SSLSession session = sock.getSession();
Certificate[] certchain = session.getPeerCertificates(); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-28T18:35:54.570

如果您在 Web 浏览器中浏览到该站点，您可以通过点击小挂锁图标来查看安全信息，然后在弹出的对话框中您可以保存证书。

**Chrome 的步骤**

1.  单击挂锁（在地址栏中）
2.  点击“证书信息”
3.  在“详细信息”选项卡下，您可以选择“复制到文件...”。

# c++ - 在 POSIX 上产生随机双精度的最佳方法是什么？

> ID：146387
> 
> 赞同：4
> 
> 时间：2008-09-28T18:09:49.593
> 
> 标签：c++, multithreading, random, posix

我想在 [0.0, 1.0) 范围内得到**均匀分布**

如果可能，请让实现使用来自**/dev/urandom 的随机字节。**

如果您的解决方案是**线程安全**的，那也很好。如果您不确定，请指出。

查看我在阅读其他答案后想到的[一些解决方案。](https://stackoverflow.com/questions/146387#149814)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T17:40:58.843

这似乎是一个很好的方法：

```
`unsigned short int r1, r2, r3;
// let r1, r2 and r3 hold random values
double result = ldexp(r1, -48) + ldexp(r2, -32) + ldexp(r3, -16);` 
```

`这是基于 NetBSD 的 drand48 实现。`

 `* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-29T01:13:40.557

**简单**：假设 IEEE，双精度为 52 位。所以生成一个 52 位（或更大）的无符号随机整数（例如通过从 dev/urandom 读取字节），将其转换为双精度数并将其除以 2^（它的位数）。

这给出了一个数值均匀的分布（因为一个值在给定范围内的概率与范围成正比）直到第 52 个二进制数字。

**复杂**：但是，在 [0,1) 范围内有很多上面无法生成的双精度值。具体来说，[0,0.5) 范围内的一半值（设置了最低有效位的值）不会出现。[0,0.25) 范围内的四分之三的值（设置了至少 2 位之一的值）不能发生，等等，一直到只有一个小于 2^-51 的正值是可能的，尽管 double 能够代表这种值的 squillions。所以不能说在指定范围内真正统一到全精度。

当然，我们不想以相等的概率选择其中一个双打，因为这样得到的数字平均来说太小了。我们仍然需要结果在给定范围内的概率与范围成正比，但在适用的范围上具有更高的精度。

我*认为*以下工作。我没有特别研究或测试过这个算法（正如你可能通过没有代码的方式知道的那样），而且我个人不会在没有找到表明它有效的适当参考资料的情况下使用它。但这里有：

*   从 52 开始指数并选择一个 52 位随机无符号整数（假设尾数为 52 位）。
*   如果整数的最高有效位为 0，则将指数加 1，将整数左移 1，并用新的随机位填充最低有效位。
*   重复直到你在最重要的地方打出 1，否则指数变得太大而不能让你的双倍（1023。或者可能是 1022）。
*   如果您找到 1，请将您的值除以 2^exponent。如果你全为零，则返回 0 （我知道，这实际上不是一个特殊情况，但它强调了 0 返回是多么不可能[编辑：实际上它可能是一个特殊情况 - 这取决于你是否想要生成denorms. 如果没有，那么一旦你连续有足够的 0，你就丢弃剩下的任何东西并返回 0。但实际上这不太可能可以忽略不计，除非随机源不是随机的）。

请注意，我不知道这种随机双精度是否真的有任何实际用途。您对随机的定义应在一定程度上取决于它的用途。但是，如果您可以从其所有 52 个有效位的随机性中受益，那么这实际上可能会有所帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T18:21:21.640

从文件读取是线程安全的 AFAIK，因此使用 fopen() 从 /dev/urandom 读取将产生“真正随机”的字节。

尽管可能存在潜在的陷阱，但我认为作为整数访问的任何此类字节集，除以该大小的最大整数，将产生一个介于 0 和 1 之间的浮点值，近似于该分布。

例如：

```
#include <limits.h>
#include <stdint.h>
#include <stdio.h>
...
FILE* f = fopen("/dev/urandom", "r");
uint32_t i;
fread(&i, sizeof(i), 1, f);  // check return value in real world code!!
fclose(f);
double theRandomValue = i / (double) (UINT32_MAX); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-28T18:19:17.980

```
#include <stdlib.h>
printf("%f\n", drand48()); 
```

## /开发/随机：

```
double c;
fd = open("/dev/random", O_RDONLY);
unsigned int a, b;
read(fd, &a, sizeof(a));
read(fd, &b, sizeof(b));
if (a > b)
   c = fabs((double)b / (double)a);
else
    c = fabs((double)a / (double)b); 
```

c 是你的随机值

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T18:25:45.327

诀窍是您需要一个满足您要求的 54 位随机发生器。几行带有联合的代码将这 54 位粘贴在尾数中，然后你就有了你的号码。诀窍不是双浮动，诀窍是您想要的随机化器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T18:02:43.223

/dev/urandom 不是 POSIX，通常不可用。

在 [0,1) 中均匀生成双精度的标准方法是在 [0,2^N) 范围内生成一个整数并除以 2^N。所以选择你最喜欢的随机数生成器并使用它。对于模拟，我的是[Mersenne Twister](http://en.wikipedia.org/wiki/Mersenne_Twister)，因为它非常快，但仍然没有很好的相关性。实际上，它可以为您做到这一点，甚至有一个版本可以为较小的数字提供更高的精度。通常你给它一个种子，这有助于调试的可重复性或向其他人展示你的结果。当然，如果未指定，您可以让您的代码从 /dev/urandom 中获取一个随机数作为种子。

出于加密目的，您应该使用其中的标准加密库之一，例如[openssl](http://www.openssl.org/)），它确实会在 /dev/urandom 可用时使用。

至于线程安全，大多数都不会，至少在标准接口中是这样，所以你需要在上面构建一个层，或者只在一个线程中使用它们。那些是线程安全的让你提供他们修改的状态，这样你就可以有效地运行多个非交互随机数生成器，这可能不是你想要的。

# asp.net - 什么是嵌入网站的好搜索引擎

> ID：146388
> 
> 赞同：8
> 
> 时间：2008-09-28T18:09:51.420
> 
> 标签：asp.net, search-engine

我正在考虑更改我的网站的本土搜索引擎。在我打破 Visual Studio 之前，我想知道是否有人可以提出一个替代方案来满足我的需求。这是：

*   适用于 ASP.NET 站点（是一个 .NET 项目）
*   创建基于文件的索引
*   快速搜索数百或数千页
*   执行词干以查找单词的变体
*   完全控制输出样式
*   便宜（或者更好的是，免费！）

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-28T18:11:54.130

在这方面，您真的无法击败[Google Site Search](http://www.google.com/sitesearch/)。它是完全可定制的 - 无需嵌入或维护。

编辑：找到了这个[ASP.NET 开源搜索引擎](http://www.codeproject.com/KB/IP/Searcharoo_4.aspx)，您可以使用并运行它，作为对您关于了解 google 做什么的评论的回应，这是[有据可查的，他们为您提供了大量的网站管理员工具](https://www.google.com/webmasters/tools/dashboard?pli=1)。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-28T20:21:42.117

.NET 版本的[Lucene](http://incubator.apache.org/lucene.net/)是我们一直在使用的。它符合您的所有标准。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-28T18:37:54.800

首先，我同意 Google Site Search。

但是，如果您想搜索 Google 可能看不到的条件（例如数据库中的内容等），那么您可以查看**[Lucene.net](http://incubator.apache.org/lucene.net/)**。它是 Java Lucene 项目的一个端口：

> Apache Lucene 是一个高性能、全功能的文本搜索引擎库，完全用~~Java~~ .Net 编写。它是一种适用于几乎所有需要全文搜索的应用程序的技术，尤其是跨平台的应用程序。

它在 Apache 许可下是免费的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-28T18:14:02.797

为什么你不能尝试[谷歌自定义搜索引擎](http://www.google.com/coop/cse/)？[如果您想最终控制索引，您可以使用lucene.net](http://incubator.apache.org/lucene.net/)创建自己的搜索引擎

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-28T18:26:02.317

从[我的问题“源代码和 SQL 脚本的内部全文搜索引擎”中](https://stackoverflow.com/questions/90300/in-house-full-text-search-engine-for-source-code-and-sql-scripts)：

> 我使用[Hyper Estraier](http://hyperestraier.sourceforge.net/)，但 [Namazu](http://www.namazu.org/index.html.en)也很有名。

还有[ht://Dig](http://www.htdig.org/)、[Lucene](http://lucene.apache.org/java/docs/)、[Xapian](http://xapian.org/)等。但我对它们了解不多。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-28T18:55:17.973

[http://www.dtsearch.com/](http://www.dtsearch.com/)上的DTSearch 引擎是一个易于开发的可靠引擎。虽然确实要花钱。

# java - 用于集合或数组的 Java printf 功能

> ID：146390
> 
> 赞同：3
> 
> 时间：2008-09-28T18:11:18.390
> 
> 标签：java, collections, printf

在 python 中，您可以在格式化的打印语句中使用元组，并且在格式化字符串中的指定位置使用元组值。例如：

```
>>> a = (1,"Hello",7.2)
>>> print "these are the values %d, %s, %f" % a
these are the values 1, Hello, 7.200000 
```

有没有办法以类似的方式在 java printf 语句中使用任何数组或集合？

我查看了[文档](http://java.sun.com/javase/6/docs/api/java/util/Formatter.html#syntax)，它似乎内置了对日历等某些类型的支持，但我没有看到任何集合。

如果在 java 中未提供此功能，是否有任何 java 习惯用法可用于在这种情况下填充集合，然后使用一种格式字符串（而不是仅嵌套循环）打印来自许多集合的值？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-28T18:18:25.313

printf 将有如下声明：

```
public PrintString printf(String format, Object... args); 
```

... 与 . 的意思大致相同`[]`。不同之处在于`...`允许调用者省略显式创建数组。所以考虑：

```
 out.printf("%s:%s", a, b); 
```

这相当于：

```
 out.printf("%s:%s", new Object[] { a, b }); 
```

所以，回到你的问题，对于一个数组，你可以写：

```
 out.printf("%s:%s", things); 
```

对于一个集合：

```
 out.printf("%s:%s", things.toArray()); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-28T21:03:06.713

您可能也对[MessageFormat](http://java.sun.com/j2se/1.5.0/docs/api/java/text/MessageFormat.html "java.text.MessageFormat")类感兴趣。

# java - 接口注释？

> ID：146391
> 
> 赞同：19
> 
> 时间：2008-09-28T18:11:21.963
> 
> 标签：java, annotations

我想不出能够在 Java 中注释接口的用例。

也许有人可以给我一个例子？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2008-09-28T18:25:12.520

我在 Spring 中使用它来注释应该应用于所有子类的接口。例如，假设您有一个 Service 接口，并且您可能有该接口的多个实现，但您希望应用安全注释而不考虑注释。在这种情况下，对接口进行注释是最有意义的。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2014-09-05T21:10:19.710

我正在使用的一个用例是 javax/hibernate bean 验证，我们使用接口来帮助我们避免在每个特定类上定义验证。

```
public interface IUser {
    @NotNull Long getUserId();
    ...
}

public class WebUser implements IUser {
    private Long userId;

    @Override
    public Long getUserId(){
        return userId;
    }
    ...
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-28T19:34:38.003

我广泛使用[findbugs](http://findbugs.sourceforge.net/)。我发现使用[注释](http://findbugs.sourceforge.net/manual/annotations.html)来指定 Nullity 约束非常有用。即使您实际上不使用 findbugs，它也会使代码的意图更加清晰。这些注释在接口和类上都有其位置。您可能会争辩说这是一种合同编程......

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2008-09-28T20:25:26.523

即使没有示例，也应该清楚地解释-接口描述行为，注释也可以，因此将它们放在一起是合乎逻辑的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-28T18:12:43.567

更多示例，但EJB3 中的[本地](http://java.sun.com/products/ejb/javadoc-3_0-fr/javax/ejb/Local.html)和[远程](http://java.sun.com/products/ejb/javadoc-3_0-fr/javax/ejb/Remote.html)注释。根据java文档，

> 在接口上使用时，将该接口指定为本地业务接口。

我想这里的用例是接口有一个特殊的功能，最好用注释来表示。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-28T20:21:35.223

我见过很多研究工具使用方法注解来让用户指定协议、限制等，方便以后自动检查。

由于注释并不规定您可以使用它们做什么，因此没有充分的理由不允许用户对接口进行注释。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-28T18:41:08.490

您可以将它用于合同风格的编程 - 比仅仅定义接口（类型和方法名称）更进一步，还可以定义一些语义（类型的内容、前置条件、后置条件）。

不过，我必须检查注释在 Java 中是如何工作的，但是这些东西可以很容易地用 Python 注释来完成......

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-10-23T10:59:33.373

在 JBoss 下部署应用程序时，您可以使用接口上的注释在 jmx-console 中导出服务。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2011-11-01T03:35:47.693

我在定义 REST 接口时使用过它。RESTeasy 允许您创建使用带注释接口的 REST 客户端（本例中为 RESTInterfaceV1）：

```
final RESTInterfaceV1 client = ProxyFactory.create(RESTInterfaceV1.class, "http://localhost:8080/rest"); 
```

尽管注释必须在实际实现 REST 接口的对象上复制，但接口本身可以单独分发给那些想要创建 Java REST 客户端的人。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-05-06T17:05:07.850

我用@Immutable 标记我的接口，以便向子类的开发人员清楚地表明实现该接口的类应该具有哪些可变性契约。正如 gehel 所说，按合同编程。

# bash - 如何使用 bash “就地”执行任何编辑其文件（参数）的命令？

> ID：146435
> 
> 赞同：111
> 
> 时间：2008-09-28T18:31:29.137
> 
> 标签：bash, command-line, sorting

我有一个文件 temp.txt，我想用`sort`bash 中的命令对其进行排序。

我希望排序结果替换原始文件。

例如，这不起作用（我得到一个空文件）：

```
sortx temp.txt > temp.txt 
```

这可以在一行中完成而无需复制到临时文件吗？

* * *

编辑：该`-o`选项对于`sort`. 我`sort`以我的问题为例。我在使用其他命令时遇到了同样的问题：

```
uniq temp.txt > temp.txt. 
```

有更好的通用解决方案吗？

* * *

## 回答 #1

> 赞同：170
> 
> 时间：2008-09-28T18:45:41.410

```
sort temp.txt -o temp.txt 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2008-09-29T07:40:28.537

A`sort`需要先查看所有输入，然后才能开始输出。因此，该`sort`程序可以轻松地提供就地修改文件的选项：

```
sort temp.txt -o temp.txt 
```

具体来说，[GNU 的文档`sort`](http://www.gnu.org/software/coreutils/manual/html_node/sort-invocation.html)说：

> 通常， sort 在打开输出文件之前读取所有输入，因此您可以使用 和 等命令安全地对文件进行`sort -o F F`排序`cat F | sort -o F`。但是，`sort`with `--merge`( `-m`) 可以在读取所有输入之前打开输出文件，因此类似命令`cat F | sort -m -o F - G`是不安全的，因为 sort 可能在读取完成`F`之前开始写入`cat`。

虽然 BSD 的文档`sort`说：

> 如果 [the] 输出文件是输入文件之一，则 sort 在排序之前将其复制到一个临时文件并将输出写入 [the] 输出文件。

诸如此类的命令`uniq`可以在完成读取输入之前开始写入输出。这些命令通常不支持就地编辑（它们更难支持此功能）。

您通常使用临时文件来解决此问题，或者如果您绝对希望避免使用中间文件，则可以使用缓冲区来存储完整的结果，然后再将其写出。例如，使用`perl`：

```
uniq temp.txt | perl -e 'undef $/; $_ = <>; open(OUT,">temp.txt"); print OUT;' 
```

`uniq`在这里，perl 部分从in 变量中读取完整的输出`$_`，然后用该数据覆盖原始文件。你可以用你选择的脚本语言做同样的事情，甚至可以用 Bash。但请注意，它需要足够的内存来存储整个文件，这在处理大文件时是不可取的。

* * *

## 回答 #3

> 赞同：19
> 
> 时间：2010-12-10T22:39:27.947

这是一种更通用的方法，适用于 uniq、sort 等。

```
{ rm file && uniq > file; } < file 
```

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2013-07-05T14:49:13.847

[东武对海绵的评论](https://stackoverflow.com/a/4413942/1175459)本身就是一个答案。

引用[moreutils](http://joeyh.name/code/moreutils/)主页：

> 到目前为止，moreutils 中最通用的工具可能是海绵（1），它可以让你做这样的事情：
> 
> ```
> % sed "s/root/toor/" /etc/passwd | grep -v joey | sponge /etc/passwd 
> ```

然而，[史蒂夫杰索普在这里评论](https://stackoverflow.com/a/146445/1175459)`sponge`同样的问题。如果之前管道中的任何命令失败，则将覆盖原始文件。`sponge`

```
$ mistyped_command my-important-file | sponge my-important-file
mistyped-command: command not found 
```

哦哦，`my-important-file`没了。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-28T18:35:10.390

给你，一行：

```
sort temp.txt > temp.txt.sort && mv temp.txt.sort temp.txt 
```

从技术上讲，没有复制到临时文件，“mv”命令应该是即时的。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-28T20:01:31.043

许多人提到了**-o**选项。这是手册页部分。

从手册页：

```
 -o output-file
          Write output to output-file instead of to the  standard  output.
          If  output-file  is  one of the input files, sort copies it to a
          temporary file before sorting and writing the output to  output-
          file. 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2013-07-11T21:22:10.527

我喜欢这个`sort file -o file`答案，但不想两次键入相同的文件名。

使用 BASH[历史扩展](https://www.gnu.org/software/bash/manual/bashref.html#History-Interaction)：

```
$ sort file -o !#^ 
```

当您按下 时，获取当前行的第一个参数`enter`。

独特的就地排序：

```
$ sort -u -o file !#$ 
```

获取当前行中的最后一个参数。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2008-09-29T13:40:27.907

这将受到高度内存限制，但您可以使用 awk 将中间数据存储在内存中，然后将其写回。

```
uniq temp.txt | awk '{line[i++] = $0}END{for(j=0;j<i;j++){print line[j]}}' > temp.txt 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2015-01-17T16:10:11.027

`sponge`更常见的替代方法`sed`：

```
sed -ni r<(command file) file 
```

它适用于任何命令（`sort`, `uniq`, `tac`, ...），并使用众所周知`sed`的 's[`-i`选项](http://www.grymoire.com/Unix/Sed.html#uh-62h)（就地编辑文件）。

**警告：**首先尝试`command file`，因为就地编辑文件本质上是不安全的。

* * *

### 解释

首先，您要告诉`sed`不要打印（原始）行（[`-n`选项](http://www.grymoire.com/Unix/Sed.html#uh-15)），并且在`sed`' [`r`command](http://www.grymoire.com/Unix/Sed.html#uh-37)和`bash`' [Process Substitution](https://www.gnu.org/software/bash/manual/bashref.html#Process-Substitution)的帮助下，生成的内容`<(command file)`将是保存**在原地**的输出。

* * *

### 让事情变得更容易

您可以将此解决方案包装成一个函数：

```
ip_cmd() { # in place command
    CMD=${1:?You must specify a command}
    FILE=${2:?You must specify a file}
    sed -ni r<("$CMD" "$FILE") "$FILE"
} 
```

* * *

### 例子

```
$ cat file
d
b
c
b
a

$ ip_cmd sort file
$ cat file
a
b
b
c
d

$ ip_cmd uniq file
$ cat file
a
b
c
d

$ ip_cmd tac file
$ cat file
d
c
b
a

$ ip_cmd
bash: 1: You must specify a command
$ ip_cmd uniq
bash: 2: You must specify a file 
```

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-28T18:33:38.570

阅读非交互式编辑器，[`ex`](http://pubs.opengroup.org/onlinepubs/9699919799/utilities/ex.html).

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-28T18:49:19.763

使用参数`--output=`或`-o`

刚刚在 FreeBSD 上试过：

```
sort temp.txt -otemp.txt 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2010-03-17T14:50:24.960

要添加该`uniq`功能，有哪些缺点：

```
sort inputfile | uniq | sort -o inputfile 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2008-09-28T18:49:35.210

如果您坚持使用该`sort`程序，则必须使用中间文件-我认为没有`sort`在内存中排序的选项。stdin/stdout 的任何其他技巧都将失败，除非您可以保证 sort 的 stdin 的缓冲区大小足以容纳整个文件。

编辑：对我感到羞耻。`sort temp.txt -o temp.txt`效果很好。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-07-27T10:49:15.570

另一种解决方案：

```
uniq file 1<> file 
```

# c# - 使用c#阻止程序启动的方法？

> ID：146439
> 
> 赞同：5
> 
> 时间：2008-09-28T18:33:03.453
> 
> 标签：c#, windows, service

这是想法，我想提供服务？这将寻找某个程序启动并禁止它，除非满足某些条件。

假设我有一个游戏我想阻止自己在一周内玩。因此，如果我在周五/周六/周日以外的任何一天启动它，它将拦截并取消。这可以用 C# 实现吗？

我正在寻找的主要是如何捕捉程序启动，休息应该很容易。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-28T18:46:22.703

好吧，您可以通过查找您想要的进程名称 (GetProcessesByName()) 并杀死它们来确定哪些程序正在运行。

```
Process[] processes = Process.GetProcessesByName(processName);
foreach(Process process in processes)
{
   process.Kill();
} 
```

您可以只列出您不想运行的列表，进行时间检查（或要满足的任何标准），然后遍历列表。我曾经做过一次这样的测试，效果很好。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-28T18:43:32.057

我在这里特别不了解 C#，但你可以做到这一点的一个原因（我认为这是一种危险的方式）是使用图像文件执行选项（[http://blogs.msdn.com/junfeng/archive /2004/04/28/121871.aspx](http://blogs.msdn.com/junfeng/archive/2004/04/28/121871.aspx)）在注册表中。对于您有兴趣拦截的任何可执行文件，您可以为其设置调试器选项，然后创建一个将在调试器上使用的小型应用程序，然后让它基本上过滤这些调用。如果您想让它运行，请启动该过程，否则请执行您喜欢的任何操作。我从来没有尝试过，但它似乎可以做你想做的事。

或者，如果您想对启动的流程做出反应，然后将其关闭，您可以使用 ProcessWatcher ( [http://weblogs.asp.net/whaggard/archive/2006/02/11/438006.aspx](http://weblogs.asp.net/whaggard/archive/2006/02/11/438006.aspx) ) 并订阅处理创建的事件，然后在需要时将其关闭。然而，这更像是一种被动的方法，而不是像第一种方法那样的主动方法。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T18:35:09.643

我不确定您是否可以在启动时捕捉到它，但您可以尝试在窗口列表中查找该程序（它是 ENUM_WINDOWS 吗？我不记得了）并在它出现后立即将其关闭。

你甚至可以在 AutoIt 中做到这一点！

拖出 Petzold 并在 Windows 上玩得开心...

**编辑：**查看 sysinternals 以获取有关如何列出活动进程的源代码 - 在循环中执行此操作，您可以在程序启动时捕获它。我不认为官方网站仍然有来源，但它一定会在某个地方......

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-28T18:39:41.003

Hrm，而不是拦截它的启动，也许您的服务可能会以某种方式破坏可执行文件（即弄脏权限，重命名EXE，用责骂你意志薄弱的东西替换EXE，等等）。

如果这还不够好，您可以尝试以下方法之一：

[http://www.codeproject.com/KB/system/win32processusingwmi.aspx](http://www.codeproject.com/KB/system/win32processusingwmi.aspx)

[http://msdn.microsoft.com/en-us/magazine/cc188966.aspx](http://msdn.microsoft.com/en-us/magazine/cc188966.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T18:50:32.163

总是有钩子。尽管 .net 库中不支持它，但您始终可以包装 win32 dll。这是一篇不错的文章：http: [//msdn.microsoft.com/sv-se/magazine/cc188966 (en-us).aspx](http://msdn.microsoft.com/sv-se/magazine/cc188966(en-us).aspx)

这是低级编程，如果您希望代码可移植，我不会使用钩子。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T10:57:11.733

这个应用程序将执行[Orange Lamp 的 Kill Process](http://orangelampsoftware.com/about_app.shtml)
我不是作者。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T11:43:15.817

您不一定需要拦截启动程序。您可以编写一个“程序启动管理器”应用程序来为您启动程序（如果它们被列入白名单）。编写应用程序后，您需要做的就是修改应用程序快捷方式以使用适当的参数指向您的启动管理器。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-07T00:57:54.397

如果您只需要禁用应用程序，您可以编辑注册表以尝试自动将调试器附加到该应用程序，如果调试器不存在，Windows 将抱怨并退出。

[HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options] 是关键，查看 MS 文章[http://support.microsoft.com/default.aspx?kbid=238788](http://support.microsoft.com/default.aspx?kbid=238788)了解更多信息。

# c++ - C++ 中的 POD 类型是什么？

> ID：146452
> 
> 赞同：1143
> 
> 时间：2008-09-28T18:36:09.563
> 
> 标签：c++, types, c++-faq

我曾多次遇到过 POD 类型这个术语。
这是什么意思？

* * *

## 回答 #1

> 赞同：795
> 
> 时间：2008-09-28T18:37:31.977

*POD*代表*Plain Old Data* - 即没有构造函数、析构函数和虚拟成员函数的类（无论是用关键字`struct`还是关键字定义）。[Wikipedia 关于 POD 的文章](http://en.wikipedia.org/wiki/Plain_Old_Data_Structures)更详细，并将其定义为：`class`

> C++ 中的普通旧数据结构是一个聚合类，它只包含 PODS 作为成员，没有用户定义的析构函数，没有用户定义的复制赋值运算符，也没有指向成员类型的非静态成员。

[可以在C++98/03 的这个答案](https://stackoverflow.com/a/4178176/734069)中找到更详细的信息。C++11 改变了围绕 POD 的规则，大大放宽了它们，因此[需要在此处进行后续回答](https://stackoverflow.com/a/7189821/734069)。

* * *

## 回答 #2

> 赞同：400
> 
> 时间：2008-09-28T19:48:33.443

### 非常不正式：

POD 是一种类型（包括类），其中 C++ 编译器保证结构中不会发生“魔法”：例如，指向 vtable 的隐藏指针、当地址转换为其他类型时应用于地址的偏移量（至少如果目标的 POD 也是如此）、构造函数或析构函数。粗略地说，当类型中唯一的东西是内置类型和它们的组合时，类型就是 POD。结果是“表现得像”C 类型的东西。

### 不那么正式：

*   `int`, `char`, `wchar_t`, `bool`, `float`,`double`是 POD，以及它们`long/short`的`signed/unsigned`版本。
*   指针（包括指向函数的指针和指向成员的指针）是 POD，
*   `enums`是 POD
*   a`const`或`volatile`POD 是一个 POD。
*   a `class`, `struct`or `union`of POD 是一个 POD，前提是所有非静态数据成员都是`public`，并且它没有基类，也没有构造函数、析构函数或虚拟方法。在此规则下，静态成员不会阻止某物成为 POD。此规则在 C++11 中已更改，并且允许某些私有成员：[具有所有私有成员的类可以是 POD 类吗？](https://stackoverflow.com/questions/4762788/can-a-class-with-all-private-members-be-a-pod-class/4762944#4762944)
*   Wikipedia 说 POD 不能具有指向成员类型的成员是错误的。或者更确切地说，它对于 C++98 的措辞是正确的，但是 TC1 明确指出指向成员的指针是 POD。

### 正式（C++03 标准）：

> **3.9(10)：** “算术类型 (3.9.1)、枚举类型、指针类型和指向成员类型的指针 (3.9.2) 和这些类型的 cv 限定版本 (3.9.3) 统称为调用者标量类型。标量类型、POD 结构类型、POD 联合类型（第 9 条）、此类类型的数组以及这些类型的 cv 限定版本（3.9.3）统称为 POD 类型”
> 
> **9(4)：** “POD 结构是一个聚合类，它没有非 POD 结构、非 POD 联合（或此类类型的数组）或引用类型的非静态数据成员，并且没有用户-定义复制运算符并且没有用户定义的析构函数。类似地，POD 联合是一个聚合联合，它没有非 POD 结构、非 POD 联合（或此类类型的数组）或引用类型的非静态数据成员，并且没有用户定义的复制操作符和用户定义的析构函数。
> 
> **8.5.1(1)：** “聚合是一个数组或类（第 9 条），没有用户声明的构造函数（12.1），没有私有或受保护的非静态数据成员（第 11 条），没有基类（第 10 条）并且没有虚拟功能（10.3）。”

* * *

## 回答 #3

> 赞同：26
> 
> 时间：2008-09-28T18:41:31.220

[普通旧数据](http://en.wikipedia.org/wiki/Plain_Old_Data_Structures)

简而言之，它是所有内置数据类型（例如`int`, `char`, `float`, `long`, `unsigned char`, `double`, 等）和 POD 数据的所有聚合。是的，这是一个递归定义。;)

更清楚地说，POD 就是我们所说的“结构”：一个单元或一组单元，只存储数据。

* * *

## 回答 #4

> 赞同：18
> 
> 时间：2018-11-29T18:17:25.967

> 为什么我们需要区分 POD 和非 POD？

C++ 作为 C 的扩展开始了它的生命。虽然现代 C++ 不再是 C 的严格超集，但人们仍然期望两者之间具有高度的兼容性。平台的“C ABI”也经常充当平台上其他语言的事实上的标准跨语言 ABI。

粗略地说，POD 类型是与 C 兼容的类型，也许同样重要的是与某些 ABI 优化兼容。

为了与 C 兼容，我们需要满足两个约束。

1.  布局必须与对应的 C 类型相同。
2.  类型必须以与对应的 C 类型相同的方式传递给函数和从函数返回。

某些 C++ 功能与此不兼容。

虚方法要求编译器插入一个或多个指向虚方法表的指针，这在 C 中是不存在的。

用户定义的复制构造函数、移动构造函数、复制赋值和析构函数对参数传递和返回都有影响。许多 C ABI 在寄存器中传递和返回小参数，但传递给用户定义的构造函数/赋值/析构函数的引用只能与内存位置一起使用。

因此，需要定义哪些类型可以预期是“C 兼容的”，哪些类型不能。C++03 在这方面有点过于严格，任何用户定义的构造函数都会禁用内置的构造函数，并且任何将它们添加回来的尝试都会导致它们是用户定义的，因此类型是非 pod。通过允许用户重新引入内置构造函数，C++11 打开了很多东西。

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2018-10-25T12:51:20.883

**`static_assert`具有从 C++11 到 C++17 和 POD 效果的所有非 POD 案例示例**

`std::is_pod`是在 C++11 中添加的，所以现在让我们考虑该标准。

`std::is_pod`将从 C++20 中删除，如[https://stackoverflow.com/a/48435532/895245](https://stackoverflow.com/a/48435532/895245)中所述，让我们更新它，因为对替换的支持到达。

随着标准的发展，POD 限制变得越来越宽松，我的目标是通过 ifdefs 涵盖示例中的所有放宽。

libstdc++ 在以下位置进行了少量测试：[https](https://github.com/gcc-mirror/gcc/blob/gcc-8_2_0-release/libstdc%2B%2B-v3/testsuite/20_util/is_pod/value.cc) ://github.com/gcc-mirror/gcc/blob/gcc-8_2_0-release/libstdc%2B%2B-v3/testsuite/20_util/is_pod/value.cc但它太少了。维护者：如果您阅读了这篇文章，请合并它。我懒得查看以下提到的所有 C++ 测试套件项目：[https ://softwareengineering.stackexchange.com/questions/199708/is-there-a-compliance-test-for-c-compilers](https://softwareengineering.stackexchange.com/questions/199708/is-there-a-compliance-test-for-c-compilers)

```
#include <type_traits>
#include <array>
#include <vector>

int main() {
#if __cplusplus >= 201103L
    // # Not POD
    //
    // Non-POD examples. Let's just walk all non-recursive non-POD branches of cppreference.
    {
        // Non-trivial implies non-POD.
        // https://en.cppreference.com/w/cpp/named_req/TrivialType
        {
            // Has one or more default constructors, all of which are either
            // trivial or deleted, and at least one of which is not deleted.
            {
                // Not trivial because we removed the default constructor
                // by using our own custom non-default constructor.
                {
                    struct C {
                        C(int) {}
                    };
                    static_assert(std::is_trivially_copyable<C>(), "");
                    static_assert(!std::is_trivial<C>(), "");
                    static_assert(!std::is_pod<C>(), "");
                }

                // No, this is not a default trivial constructor either:
                // https://en.cppreference.com/w/cpp/language/default_constructor
                //
                // The constructor is not user-provided (i.e., is implicitly-defined or
                // defaulted on its first declaration)
                {
                    struct C {
                        C() {}
                    };
                    static_assert(std::is_trivially_copyable<C>(), "");
                    static_assert(!std::is_trivial<C>(), "");
                    static_assert(!std::is_pod<C>(), "");
                }
            }

            // Not trivial because not trivially copyable.
            {
                struct C {
                    C(C&) {}
                };
                static_assert(!std::is_trivially_copyable<C>(), "");
                static_assert(!std::is_trivial<C>(), "");
                static_assert(!std::is_pod<C>(), "");
            }
        }

        // Non-standard layout implies non-POD.
        // https://en.cppreference.com/w/cpp/named_req/StandardLayoutType
        {
            // Non static members with different access control.
            {
                // i is public and j is private.
                {
                    struct C {
                        public:
                            int i;
                        private:
                            int j;
                    };
                    static_assert(!std::is_standard_layout<C>(), "");
                    static_assert(!std::is_pod<C>(), "");
                }

                // These have the same access control.
                {
                    struct C {
                        private:
                            int i;
                            int j;
                    };
                    static_assert(std::is_standard_layout<C>(), "");
                    static_assert(std::is_pod<C>(), "");

                    struct D {
                        public:
                            int i;
                            int j;
                    };
                    static_assert(std::is_standard_layout<D>(), "");
                    static_assert(std::is_pod<D>(), "");
                }
            }

            // Virtual function.
            {
                struct C {
                    virtual void f() = 0;
                };
                static_assert(!std::is_standard_layout<C>(), "");
                static_assert(!std::is_pod<C>(), "");
            }

            // Non-static member that is reference.
            {
                struct C {
                    int &i;
                };
                static_assert(!std::is_standard_layout<C>(), "");
                static_assert(!std::is_pod<C>(), "");
            }

            // Neither:
            //
            // - has no base classes with non-static data members, or
            // - has no non-static data members in the most derived class
            //   and at most one base class with non-static data members
            {
                // Non POD because has two base classes with non-static data members.
                {
                    struct Base1 {
                        int i;
                    };
                    struct Base2 {
                        int j;
                    };
                    struct C : Base1, Base2 {};
                    static_assert(!std::is_standard_layout<C>(), "");
                    static_assert(!std::is_pod<C>(), "");
                }

                // POD: has just one base class with non-static member.
                {
                    struct Base1 {
                        int i;
                    };
                    struct C : Base1 {};
                    static_assert(std::is_standard_layout<C>(), "");
                    static_assert(std::is_pod<C>(), "");
                }

                // Just one base class with non-static member: Base1, Base2 has none.
                {
                    struct Base1 {
                        int i;
                    };
                    struct Base2 {};
                    struct C : Base1, Base2 {};
                    static_assert(std::is_standard_layout<C>(), "");
                    static_assert(std::is_pod<C>(), "");
                }
            }

            // Base classes of the same type as the first non-static data member.
            // TODO failing on GCC 8.1 -std=c++11, 14 and 17.
            {
                struct C {};
                struct D : C {
                    C c;
                };
                //static_assert(!std::is_standard_layout<C>(), "");
                //static_assert(!std::is_pod<C>(), "");
            };

            // C++14 standard layout new rules, yay!
            {
                // Has two (possibly indirect) base class subobjects of the same type.
                // Here C has two base classes which are indirectly "Base".
                //
                // TODO failing on GCC 8.1 -std=c++11, 14 and 17.
                // even though the example was copy pasted from cppreference.
                {
                    struct Q {};
                    struct S : Q { };
                    struct T : Q { };
                    struct U : S, T { };  // not a standard-layout class: two base class subobjects of type Q
                    //static_assert(!std::is_standard_layout<U>(), "");
                    //static_assert(!std::is_pod<U>(), "");
                }

                // Has all non-static data members and bit-fields declared in the same class
                // (either all in the derived or all in some base).
                {
                    struct Base { int i; };
                    struct Middle : Base {};
                    struct C : Middle { int j; };
                    static_assert(!std::is_standard_layout<C>(), "");
                    static_assert(!std::is_pod<C>(), "");
                }

                // None of the base class subobjects has the same type as
                // for non-union types, as the first non-static data member
                //
                // TODO: similar to the C++11 for which we could not make a proper example,
                // but with recursivity added.

                // TODO come up with an example that is POD in C++14 but not in C++11.
            }
        }
    }

    // # POD
    //
    // POD examples. Everything that does not fall neatly in the non-POD examples.
    {
        // Can't get more POD than this.
        {
            struct C {};
            static_assert(std::is_pod<C>(), "");
            static_assert(std::is_pod<int>(), "");
        }

        // Array of POD is POD.
        {
            struct C {};
            static_assert(std::is_pod<C>(), "");
            static_assert(std::is_pod<C[]>(), "");
        }

        // Private member: became POD in C++11
        // https://stackoverflow.com/questions/4762788/can-a-class-with-all-private-members-be-a-pod-class/4762944#4762944
        {
            struct C {
                private:
                    int i;
            };
#if __cplusplus >= 201103L
            static_assert(std::is_pod<C>(), "");
#else
            static_assert(!std::is_pod<C>(), "");
#endif
        }

        // Most standard library containers are not POD because they are not trivial,
        // which can be seen directly from their interface definition in the standard.
        // https://stackoverflow.com/questions/27165436/pod-implications-for-a-struct-which-holds-an-standard-library-container
        {
            static_assert(!std::is_pod<std::vector<int>>(), "");
            static_assert(!std::is_trivially_copyable<std::vector<int>>(), "");
            // Some might be though:
            // https://stackoverflow.com/questions/3674247/is-stdarrayt-s-guaranteed-to-be-pod-if-t-is-pod
            static_assert(std::is_pod<std::array<int, 1>>(), "");
        }
    }

    // # POD effects
    //
    // Now let's verify what effects does PODness have.
    //
    // Note that this is not easy to do automatically, since many of the
    // failures are undefined behaviour.
    //
    // A good initial list can be found at:
    // https://stackoverflow.com/questions/4178175/what-are-aggregates-and-pods-and-how-why-are-they-special/4178176#4178176
    {
        struct Pod {
            uint32_t i;
            uint64_t j;
        };
        static_assert(std::is_pod<Pod>(), "");

        struct NotPod {
            NotPod(uint32_t i, uint64_t j) : i(i), j(j) {}
            uint32_t i;
            uint64_t j;
        };
        static_assert(!std::is_pod<NotPod>(), "");

        // __attribute__((packed)) only works for POD, and is ignored for non-POD, and emits a warning
        // https://stackoverflow.com/questions/35152877/ignoring-packed-attribute-because-of-unpacked-non-pod-field/52986680#52986680
        {
            struct C {
                int i;
            };

            struct D : C {
                int j;
            };

            struct E {
                D d;
            } /*__attribute__((packed))*/;

            static_assert(std::is_pod<C>(), "");
            static_assert(!std::is_pod<D>(), "");
            static_assert(!std::is_pod<E>(), "");
        }
    }
#endif
} 
```

[GitHub 上游](https://github.com/cirosantilli/cpp-cheat/blob/eb1b019bde11b8556fbb959f990c5c8bf132a0a5/cpp/pod.cpp).

经测试：

```
for std in 11 14 17; do echo $std; g++-8 -Wall -Werror -Wextra -pedantic -std=c++$std pod.cpp; done 
```

在 Ubuntu 18.04、GCC 8.2.0 上。

* * *

## 回答 #6

> 赞同：12
> 
> 时间：2013-12-07T21:38:41.640

据我了解 POD (PlainOldData) 只是一个原始数据 - 它不需要：

*   建造，
*   被摧毁，
*   有自定义运算符。
*   不能有虚函数，
*   并且不得覆盖运算符。

如何检查某物是否是 POD？好吧，有一个结构叫做`std::is_pod`：

```
namespace std {
// Could use is_standard_layout && is_trivial instead of the builtin.
template<typename _Tp>
  struct is_pod
  : public integral_constant<bool, __is_pod(_Tp)>
  { };
} 
```

（来自标题 type_traits）

参考：

*   [http://en.cppreference.com/w/cpp/types/is_pod](http://en.cppreference.com/w/cpp/types/is_pod)
*   [http://en.wikipedia.org/wiki/Plain_old_data_structure](http://en.wikipedia.org/wiki/Plain_old_data_structure)
*   [http://en.wikipedia.org/wiki/Plain_Old_C++_Object](http://en.wikipedia.org/wiki/Plain_Old_C++_Object)
*   文件类型_特征

* * *

## 回答 #7

> 赞同：10
> 
> 时间：2016-08-16T11:56:51.840

POD（普通旧数据）对象具有这些数据类型之一——基本类型、指针、联合、结构、数组或类——没有构造函数。相反，非 POD 对象是存在构造函数的对象。POD 对象的生命周期在它获得具有适合其类型的适当大小的存储时开始，它的生命周期在对象的存储被重用或释放时结束。

PlainOldData 类型也不能有任何：

*   虚函数（它们自己的或继承的）
*   虚拟基类（直接或间接）。

PlainOldData 更宽松的定义包括带有构造函数的对象；但不包括那些拥有虚拟任何东西的人。PlainOldData 类型的重要问题是它们是非多态的。继承可以用 POD 类型完成，但是它应该只用于 ImplementationInheritance（代码重用）而不是多态/子类型。

一个常见的（虽然不是严格正确的）定义是 PlainOldData 类型是没有 VeeTable 的任何东西。

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2018-01-25T04:09:04.327

POD 的概念和类型特征`std::is_pod`将在 C++20 中弃用。有关更多信息，请参阅[此](https://stackoverflow.com/questions/48225673/why-is-stdis-pod-deprecated-in-c20)问题。

* * *

## 回答 #9

> 赞同：-7
> 
> 时间：2008-09-28T20:14:11.963

对于 C++，Plain Old Data 不仅仅意味着 int、char 等是唯一使用的类型。普通旧数据实际上意味着您可以将 struct memcpy 从内存中的一个位置带到另一个位置，并且事情将完全按照您的预期工作（即不会爆炸）。如果您的类或您的类包含的任何类的成员是指针或引用或具有虚函数的类，则会中断。本质上，如果必须在某处涉及指针，则它不是普通的旧数据。

# homebrew - Wii 编程教程

> ID：146466
> 
> 赞同：72
> 
> 时间：2008-09-28T18:42:33.713
> 
> 标签：homebrew, wii, video-game-consoles, devkitpro

我有一个[Nintendo Wii](http://en.wikipedia.org/wiki/Wii)，并且我有[devkitpro](http://www.devkitpro.org/)工作以加载一些简单的程序。我能找到的示例源代码非常简单，例如绘制和旋转一个简单的形状。

我一直在寻找更深入的教程，但我找不到太多。[wiibrew](http://www.wiibrew.org)上可用的大多数应用程序都是开源的，所以我可以浏览一下。但是，我宁愿有一些更适合教授某些技术的东西，而不是必须浏览别人的代码才能找到答案。

有哪些好的教程？目前，我坚持只让 alpha（半透明）颜色工作，但我也对让照明和其他更高级的图形技术工作感兴趣。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-01-28T12:24:20.337

我将为您提供一些不错的链接：

*   ~~[入门](http://www.wii-boss.symbiote.org/files/Programming%20your%20wii-boss.pdf)~~（死）
*   ~~[Wii编程](http://swik.net/Wii+Programming)~~（死）
*   [Wii Wiki 关于 Homebrew](http://en.wikipedia.org/wiki/Wii_homebrew)
*   [一位谈论 Wii 编程的博主](http://www.codemii.com/category/wii-programming-tutorials/)
*   ~~[Wii开发的一大资源](http://www.wiili.org/index.php/Main_Page)~~（已死）

另一个很好的资源是[WiiBrew](http://wiibrew.org/wiki/Main_Page)，这里有一些开发特定的链接：

*   [教程](http://wiibrew.org/wiki/Tutorials)
*   [调试](http://wiibrew.org/wiki/Debugging)
*   [开发工具](http://wiibrew.org/wiki/Development_Tools,)
*   [DevkitPro](http://wiibrew.org/wiki/DevkitPro)
*   [开发入门](http://wiibrew.org/wiki/Development)
*   [开发者提示](http://wiibrew.org/wiki/Developer_Tips)

我知道你以前去过 WiiBrew，但它是一个非常好的资源，即使你想更进一步。祝你好运，为 Wii 编程玩得开心！（但请不要再制作健身游戏；））

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-28T19:05:59.693

[这个](http://www.codemii.com/category/wii-programming-tutorials/)呢？它没有涉及更高级的内容，但仍在添加新教程。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-01-28T07:15:49.600

[Gamedev.net](http://www.gamedev.net/)和[DCEmu](http://www.dcemu.co.uk)是两个很棒的自制游戏开发资源。

Gamedev.net 有很多很棒的文章和论坛。

DCEmu 最初是一个 Dreamcast Emulator 网站，但它强大的社区可能是目前所有游戏开发中最活跃的。

我相信您会在阅读这些网站及其论坛时获得很多乐趣，并且您肯定会在那里找到一些教程。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-28T12:35:49.563

我知道这不能回答您的问题，但认为它可能对其他对 Wii 开发感兴趣的人有用：

[http://unity3d.com/unity/features/wii-publishing](http://unity3d.com/unity/features/wii-publishing)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-01-27T18:09:22.073

一些朋友正在使用 Wii 和 Flash 编写游戏。我不知道，虽然:(

你在这里检查过这篇文章吗？[为 Nintendo Wii 编写游戏](https://stackoverflow.com/questions/29466/writing-a-game-for-the-nintendo-wii)

# c++ - 如何在 C++ 中获得 Mac OS X 中主显示器的分辨率？

> ID：146480
> 
> 赞同：4
> 
> 时间：2008-09-28T18:49:12.447
> 
> 标签：c++, macos, graphics, resolution

我有一个图形应用程序需要测试它在 Mac OS X 中启动的显示器的分辨率，以确保它不大于分辨率。这是在窗口本身初始化之前完成的。

如果有多个显示器，则它需要是主显示器。这是硬件加速 (OpenGL) 应用程序将以全屏模式启动的显示器，通常是顶部有菜单栏的显示器。

在 Windows 中，我可以成功使用 GetSystemMetrics()。我怎样才能在 OS X 上做到这一点？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-28T19:06:56.727

使用核心图形：

```
CGRect mainMonitor = CGDisplayBounds(CGMainDisplayID());
CGFloat monitorHeight = CGRectGetHeight(mainMonitor);
CGFloat monitorWidth = CGRectGetWidth(mainMonitor); 
```

更多信息，请参阅 Apple 的[Quartz Display Services Reference](http://developer.apple.com/documentation/GraphicsImaging/Reference/Quartz_Services_Ref/Reference/reference.html)。

# winapi - 什么是改变屏幕刷新率的windows API？

> ID：146484
> 
> 赞同：3
> 
> 时间：2008-09-28T18:51:19.777
> 
> 标签：winapi

有人可以指定windows API，为了能够以编程方式更改屏幕刷新率，需要使用吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-28T19:09:32.273

您可以如前所述使用 ChangeDisplaySettings。但是您应该使用 EnumDisplaySettings 来获取（颜色深度、宽度、高度、模式和频率）的有效组合列表。

示例代码（在 Delphi 中，但翻译应该很简单）

**获取有效的显示模式**

```
i := 0;
while EnumDisplaySettings(nil, i, dm) do begin
  Memo1.Lines.Add(Format('Color Depth: %d', [dm.dmBitsPerPel]));
  Memo1.Lines.Add(Format('Resolution: %d, %d', [dm.dmPelsWidth, dm.dmPelsHeight]));
  Memo1.Lines.Add(Format('Display mode: %d', [dm.dmDisplayFlags]));
  Memo1.Lines.Add(Format('Frequency: %d', [dm.dmDisplayFrequency]));
  Inc(i);
end; 
```

**设置显示模式**

```
// In this case i is an index in the list of valid display modes.
if EnumDisplaySettings(nil, i, dm) then begin
  // Sanity check!
  if ChangeDisplaySettings(dm, CDS_TEST) = 0) then
    ChangeDisplaySettings(dm, 0);  // Use CDS_UPDATEREGISTRY if this is the new default mode.
end; 
```

选择有效的组合非常重要！

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-28T18:54:43.730

我通过谷歌搜索找到了这个。希望对一些人有所帮助。

[http://www.codeproject.com/KB/winsdk/changerefresh.aspx](http://www.codeproject.com/KB/winsdk/changerefresh.aspx)

[http://msdn.microsoft.com/en-us/library/ms533260(VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms533260(VS.85).aspx)

# ruby-on-rails - 在 Amazon 的 EC2 上托管 Rails 应用程序的典型工具和资源是什么？

> ID：146486
> 
> 赞同：14
> 
> 时间：2008-09-28T18:51:33.770
> 
> 标签：ruby-on-rails, amazon-ec2, sysadmin

我在找：

*   文件
*   博客
*   图书
*   即用型预配置切片图像
*   服务
*   包装纸
*   图书馆
*   教程

...任何可以让开始使用 EC2 托管 Rails 应用程序变得更容易的东西。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-28T20:16:34.360

ElasticFox 是监控您的实例的必备实用程序 [http://developer.amazonwebservices.com/connect/entry.jspa?externalID=609](http://developer.amazonwebservices.com/connect/entry.jspa?externalID=609)

Capazon 是一个很棒的实用程序，可以将实例管理引入 Capistrano [http://soylentfoo.jnewland.com/articles/2007/03/27/capazon-capistrano-meets-amazon-ec2](http://soylentfoo.jnewland.com/articles/2007/03/27/capazon-capistrano-meets-amazon-ec2)（某处有更新的版本）

我喜欢这些 AMI（我喜欢 Ubuntu）[http://alestic.com/](http://alestic.com/)

如果您使用 Heroku 或 EngineYard（当今主要的云托管解决方案 - 它们构建在 Amazon EC2 之上），您还可以使用 git 来管理您的代码，Heroku 和 EngineYard 都有关于如何将 git 与它们集成的很好的说明：

Heroku：[http ://devcenter.heroku.com/articles/git](http://devcenter.heroku.com/articles/git)

引擎场：[http ://docs.engineyard.com/host-your-code-on-github.html](http://docs.engineyard.com/host-your-code-on-github.html)

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2008-10-01T20:00:12.503

在[http://ec2onrails.rubyforge.org/上有 EC2 的 Rails 映像](http://ec2onrails.rubyforge.org/)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-28T20:37:30.753

你看过亚马逊[入门](http://docs.amazonwebservices.com/AWSEC2/2008-05-05/GettingStartedGuide/)教程吗？将一个 ec2 实例放在一起就足够了。

我确实用它来设置一个带有 ruby​​-enterprise、rails 和乘客的 ubuntu 服务器（这部分与我使用的任何其他 ubuntu 服务器没有任何不同）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-30T01:44:51.363

我强烈推荐[Scott Chacone 的 Fuzed 和 EC2 演示](http://jointheconversation.org/2008/06/06/fuzed-and-ec2/)。其他人推荐[EC2 文档](http://docs.amazonwebservices.com/AmazonEC2/gsg/2006-06-26/running-an-instance.html)，我也会。一定要检查[fuzed code](http://github.com/KirinDave/fuzed)。表演很棒，但你最好带些钱来支持它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-02-06T01:28:35.617

不要忘记[SimpleDeployr](http://www.simpledeployr.com)，一键将 Ruby on Rails 部署到您的 EC2 帐户。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-07T04:46:08.343

以下是您可能想尝试使用 EC2 部署 Rails 应用程序的服务：[Morph AppSpace](http://www.mor.ph)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-05-16T00:03:52.697

我一直在使用 EC2onRails 及其相应的 ami 配置 Rails 应用程序以直接在 EC2 上运行。我在这里记录了我的进展，因为我发现那里缺少其他文档：

[http://www-cs-students.stanford.edu/~silver/ec2.html](http://www-cs-students.stanford.edu/~silver/ec2.html)

# java - JTable 列跨越

> ID：146498
> 
> 赞同：6
> 
> 时间：2008-09-28T19:00:05.980
> 
> 标签：java, swing, jtable

我正在尝试制作`JTable`具有可用列跨度的列。具体来说，我希望将 a 嵌套`JTable`在 another`JTable`中，当用户单击查看嵌套表时，它应该展开以向下推下面的行并填充空白空间。这类似于您在 MS Access 中看到的可以嵌套表格的内容，单击一行上的展开按钮将显示嵌套表格中的相应条目。

如果有人知道使用 执行列跨度的方法`JTable`，请您指出正确的方向吗？或者，如果您知道另一种方法来做到这一点，我愿意接受建议。该应用程序正在使用 Swing 构建。表中的元素，无论是高级别还是低级别，都必须在任何解决方案中都是可编辑的。使用 nested `JTable`s 这不会是一个问题，任何其他解决方案也必须考虑到这一点。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T03:38:05.140

作为正确方向的指针，请尝试SwingWiki 上的[这篇文章](http://www.swingwiki.org/howto:column_spanning)，该文章很好地解释了跨列的 TableUI 方法。在此之前，我还尝试了一些替代方法，例如覆盖 TableCellRenderer 绘制方法，但没有取得多大成功。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-28T19:36:13.833

您需要为主表编写自己的 TableUI。使用您自己的 TableModel 来保存额外的数据也很有帮助，例如是否展开了一行。但这是可选的。

我编写了一个等于 TableUI 来展开一行并显示一个文本编辑器。在 TableUI 中，您需要使用 table.setRowHeight(height) 动态更改行高。也有必要从 BaseTableUI 复制一些东西，因为你不能访问私有的东西。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-02-21T12:04:46.317

基于来自 Code-Guru 的代码：

```
/*
 *  (swing1.1beta3)
 * 
 * |-----------------------------------------------------|
 * |   1st  |      2nd    |      3rd         |
 * |-----------------------------------------------------|
 * |    |    |    |    |        |        |
 */
//package jp.gr.java_conf.tame.swing.examples;

import java.awt.*;
import java.awt.event.*;
import javax.swing.*;
import javax.swing.table.*;

import jp.gr.java_conf.tame.swing.table.*;

/**
 * @version 1.0 11/09/98
 */
public class MultiWidthHeaderExample extends JFrame {

  MultiWidthHeaderExample() {
    super( "Multi-Width Header Example" );

    DefaultTableModel dm = new DefaultTableModel();
    dm.setDataVector(new Object[][]{
      {"a","b","c","d","e","f"},
      {"A","B","C","D","E","F"}},
    new Object[]{"1 st","","","","",""});

    JTable table = new JTable( dm ) {
      protected JTableHeader createDefaultTableHeader() {
        return new GroupableTableHeader(columnModel);
      }
    };
    TableColumnModel cm = table.getColumnModel();
    ColumnGroup g_2nd = new ColumnGroup("2 nd");
    g_2nd.add(cm.getColumn(1));
    g_2nd.add(cm.getColumn(2));
    ColumnGroup g_3rd = new ColumnGroup("3 rd");
    g_3rd.add(cm.getColumn(3));
    g_3rd.add(cm.getColumn(4));
    g_3rd.add(cm.getColumn(5));
    GroupableTableHeader header = (GroupableTableHeader)table.getTableHeader();
    header.addColumnGroup(g_2nd);
    header.addColumnGroup(g_3rd);
    JScrollPane scroll = new JScrollPane( table );
    getContentPane().add( scroll );
    setSize( 400, 100 );  
    header.revalidate(); 
  }

  public static void main(String[] args) {
    MultiWidthHeaderExample frame = new MultiWidthHeaderExample();
    frame.addWindowListener( new WindowAdapter() {
      public void windowClosing( WindowEvent e ) {
        System.exit(0);
      }
    });
    frame.setVisible(true);
  }
} 
```

来源： http: [//www.codeguru.com/java/articles/125.shtml](http://www.codeguru.com/java/articles/125.shtml)（自 2012 年起不可用，现在在[网络存档](https://web.archive.org/web/20111201210527/http://www.codeguru.com/java/articles/125.shtml%20web-archive)中查看）

其他资源：

*   Java-6 更新来源：http: [//qoofast.blog76.fc2.com/blog-entry-2.html](http://qoofast.blog76.fc2.com/blog-entry-2.html) [（已翻译）](http://translate.google.ch/translate?hl=de&sl=ja&tl=en&u=http%3A%2F%2Fqoofast.blog76.fc2.com%2Fblog-entry-2.html&anno=2)
    *   [ColumnGroup.java](http://blog-imgs-46.fc2.com/q/o/o/qoofast/ColumnGroup.txt)
    *   [GroupableTableHeader.java](http://blog-imgs-46.fc2.com/q/o/o/qoofast/GroupableTableHeader.txt)
    *   [GroupableTableHeaderUI](http://blog-imgs-46.fc2.com/q/o/o/qoofast/GroupableTableHeaderUI.txt)

# conditional - 如何有条件地在 Infopath 中显示字段？

> ID：146504
> 
> 赞同：2
> 
> 时间：2008-09-28T19:03:14.677
> 
> 标签：conditional, infopath

我正在尝试在 infopath 中执行以下操作：我必须在 2 个选项（带项目符号）之间进行选择，并且根据这一点，如果我们选择 Option1，我需要显示一个文本字段以输入更多详细信息，但如果选择了 Option2 ，我不需要这个额外的字段。

我不确定如何输入规则来定义这个:-(
有人可以帮忙吗？
谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-05-01T16:09:54.890

在 2010 年，您使用“规则”（从 2007 年更改）来执行此操作。打开功能区中的主页选项卡，从那里打开管理规则。然后选择您的控件，并在规则窗格中为每个控件添加/编辑规则，以实现您想要做的事情。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-03T00:58:19.220

在 InfoPath 2007 中，您可以：

*   右键单击任何控件
*   选择条件格式
*   输入一个映射到选择的选项 2 的条件
*   单击“隐藏此控件”作为要应用的格式。

您可能希望将此和任何描述性字段文本放在一个部分中；并使用上述步骤隐藏/显示它。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-09-05T08:36:13.967

在 InfoPath 2013 中，您可以： 您可以使用格式规则隐藏条件基础上的控件。
1.点击控件
2.添加规则
3.选择格式
4.添加条件
5.勾选隐藏控件

# windows - 如何在 Windows 2000 上以编程方式模拟 XP 的“Windows 安全”开始菜单选项

> ID：146520
> 
> 赞同：0
> 
> 时间：2008-09-28T19:14:40.610
> 
> 标签：windows, security, rdp

我试图找到一种方法来调用我通过远程桌面连接到的 Windows 2000 计算机上的 Ctrl+Alt+Delete 对话框。Windows XP 和 2003 包含一个名为“Windows 安全性”的新开始菜单命令，可以执行此操作，但 Windows 2000 没有这样的选项。

似乎 Ctrl+Alt+End 会执行此操作，但它只会转到最外层的 RDP 窗口，因此如果您有多个连接深度，则无济于事。在这种情况下，我在计算机 A 上，连接到计算机 B。从计算机 B，我连接到计算机 C。按 Ctrl+Alt+End 在计算机 B 上打开 Ctrl+Alt+Delete 对话框，而不是计算机 C。

这里的目标是允许连接到计算机 C 的用户更改自己的密码。用户不是计算机上的管理员，因此他们无法访问管理员可能用来完成此操作的各种工具。

[编辑] 我忘了把它变成一个编程问题；我的意图是弄清楚如何从代码中做到这一点（尽管非代码方法也很有用）。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-28T19:57:52.127

我的同事找到了直接完成此任务的方法：开始 | 设置 | Windows 安全。如果它不存在，它可能已通过组策略 ( [Technet](http://www.microsoft.com/technet/prodtechnol/windows2000serv/reskit/gp/1.mspx?mfr=true) ) 禁用。

# python - 如何成功地将函数引用传递给 Django 的 reverse() 函数？

> ID：146522
> 
> 赞同：13
> 
> 时间：2008-09-28T19:15:15.227
> 
> 标签：python, django

我有一个全新的 Django 项目。我向 中添加了一个最小视图函数，向 中添加了`views.py`一个 URL 模式`urls.py`，通过函数引用而不是字符串传递视图：

```
# urls.py
# -------

# coding=utf-8

from django.conf.urls.defaults import *

from myapp import views

urlpatterns = patterns('',
    url(r'^myview/$', views.myview),
)

# views.py
----------

# coding=utf-8

from django.http import HttpResponse

def myview(request):
    return HttpResponse('MYVIEW LOL',  content_type="text/plain") 
```

我正在尝试`reverse()`通过向其传递函数引用来获取 URL。但是我没有得到匹配，尽管我确认我传递给 reverse 的视图函数与我在 URL 模式中放入的视图函数完全相同：

```
>>> from django.core.urlresolvers import reverse
>>> import urls
>>> from myapp import views

>>> urls.urlpatterns[0].callback is views.myview
True

>>> reverse(views.myview)
Traceback (most recent call last):
  File "<console>", line 1, in <module>
  File "/Library/Python/2.5/site-packages/django/core/urlresolvers.py", line 254, in reverse
    *args, **kwargs)))
  File "/Library/Python/2.5/site-packages/django/core/urlresolvers.py", line 243, in reverse
    "arguments '%s' not found." % (lookup_view, args, kwargs))
NoReverseMatch: Reverse for '<function myview at 0x6fe6b0>' with arguments '()' and keyword arguments '{}' not found. 
```

据我从文档中可以看出，函数引用在 URL 模式和`reverse()`.

*   [带有函数引用的 URL 模式](http://docs.djangoproject.com/en/dev/topics/http/urls/#passing-callable-objects-instead-of-strings)
*   [`reverse`带有函数引用](http://docs.djangoproject.com/en/dev/topics/http/urls/?from=olddocs#reverse)

我正在使用 Django 主干，修订版 9092。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2008-09-28T19:17:44.470

知道了！！问题是有些进口是 的`myproject.myapp.views`，有些只是 的`myapp.views`。这使 Python 模块系统非常混乱，以至于它不再将函数检测为同一个对象。这是因为您的 main`settings.py`可能有如下一行：

```
ROOT_URLCONF = `myproject.urls` 
```

要解决此问题，请尝试在您的 shell 会话中使用完全导入：

```
>>> from django.core.urlresolvers import reverse
>>> from myproject.myapp import views
>>> reverse(views.myview)
'/myview/' 
```

这是调试会话的日志，供任何感兴趣的未来读者使用：

```
>>> from django.core import urlresolvers
>>> from myapp import myview
>>> urlresolvers.get_resolver (None).reverse_dict
{None: ([(u'myview/', [])], 'myview/$'), <function myview at 0x845d17c>: ([(u'myview/', [])], 'myview/$')}
>>> v1 = urlresolvers.get_resolver (None).reverse_dict.items ()[1][0]
>>> reverse(v1)
'/myview/'
>>> v1 is myview
False
>>> v1.__module__
'testproject.myapp.views'
>>> myview.__module__
'myapp.views' 
```

如果将 URL 匹配更改为 会发生什么`r'^myview/$'`？

* * *

您是否尝试过使用视图名称？像`reverse ('myapp.myview')`什么？

是`urls.py`根 URLconf，还是在`myapp`应用程序中？需要有从根到要解析的视图的完整路径。如果是这样`myproject/myapp/urls.py`，那么`myproject/urls.py`您将需要这样的代码：

```
from django.conf.urls.defaults import patterns
urlpatterns = patterns ('',
    (r'^/', 'myapp.urls'),
) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T19:25:49.380

如果您的两个代码粘贴已完成，那么它看起来不像第二个，它会实际调用 reverse()，导入 urls 模块，因此如果实际实现了 url 映射。

# ruby - 获取 Ruby 文档的最快方法是什么？

> ID：146528
> 
> 赞同：3
> 
> 时间：2008-09-28T19:20:49.330
> 
> 标签：ruby, documentation

假设我正在编写一些 ruby​​ 代码，并且我想使用标准 Date 类型来获取当前日期。除了使用搜索引擎，有没有更快的方法来找到这个类的文档？我知道我可以通过键入来获取 Date 的方法`Date.methods`，但据我所知，这并没有提供有关参数类型或返回值的详细信息。

欢迎编辑特定的答案。我选择的编辑器是 Emacs。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-28T20:01:22.633

[为ruby​​ 核心文档添加](http://www.ruby-doc.org/core/)书签

使用您的网络浏览器的查找文本命令。

看起来可能出乎意料，我发现这实际上比 using 更快`ri`，由于某种原因，这似乎需要很长时间才能启动。

这也比`ri`HTML 页面在单个页面上列出所有方法的所有文档要好得多。通常方法与其他方法相关，在 2 之间切换`ri`很痛苦

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-28T19:25:17.433

在您的控制台上使用“ri”

```
ri Date 
```

这适用于所有课程。（例如 ri 字符串）要查看特定方法的文档，请使用以下命令：

```
ri Date#yourMethod 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T19:44:15.310

Ruby 文档的规范来源是[Ruby-doc](http://ruby-doc.org/) - 其中最受关注的两个链接是[core](http://www.ruby-doc.org/core/)和[standard library](http://ruby-doc.org/stdlib/)。你会得到一个 javadoc 样式的表示，它通常涵盖参数类型和返回值。您甚至可以使用[RDoc](http://rdoc.sourceforge.net/)自己制作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-04-04T03:42:28.637

对于那些想要从香草 IRB 中获取文档的人

1.  按照[这些](https://github.com/dadooda/ori/blob/master/README_RI_CORE.md)说明设置核心 RI 文档。在撰写本文时，步骤是

    ```
    $ cd ~/.rvm/src
    $ rvm docs generate-ri 
    ```

2.  现在，您可以使用该命令在命令行上查看特定方法的文档`ri`。要从 IRB 中调用它，请使用帮助命令：

    ```
    $ irb
    irb(main):001:0> help 'String#chomp' 
    ```

# mysql - 删除除 50 个最新行之外的所有行

> ID：146531
> 
> 赞同：2
> 
> 时间：2008-09-28T19:22:00.747
> 
> 标签：mysql, sql

我有一个带有新闻报道和 Unix 时间戳的 SQL 表。我只想保留 50 个最新的故事。我将如何编写 SQL 语句来删除任何数量的旧故事？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-28T19:25:02.003

块引用

```
delete from table where id not in (
    select id from table 
    order by id desc 
    limit 50
) 
```

您选择不想删除的数据的 ID，然后删除不在这些值中的所有内容...

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2008-09-28T20:15:18.730

我最终使用了两个查询，因为 MySQL5 还不支持子查询中的 LIMIT

```
SELECT unixTime FROM entries ORDER BY unixTime DESC LIMIT 49, 1;
DELETE FROM entries WHERE unixTime < $sqlResult; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-28T20:08:11.573

好吧，看起来你不能在一个查询中做到这一点——如果我错了，有人纠正我。我曾经能够做这种事情的唯一方法是首先弄清楚表中的行数。例如：

```
select count(*) from table; 
```

然后使用结果做

```
delete from table order by timestamp limit result - 50; 
```

你必须这样做有两个原因 -

1.  MySQL 5 不支持删除子查询的限制
2.  MySQL 5 不允许您从要从中删除的同一个表中选择子查询。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-28T20:10:35.763

如果您有很多行，最好将 50 行放在临时表中，然后使用**TRUNCATE TABLE**清空表。然后将 50 行放回原处。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2020-10-03T17:07:17.937

我刚刚这样做了：

`DELETE FROM `table` WHERE `datetime` < (SELECT `datetime` FROM `table` ORDER BY `datetime` DESC LIMIT 49,1);`

表在哪里`table`，`datetime`是一个日期时间字段。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-28T19:29:02.227

假设此查询选择要保留的行：

```
SELECT timestampcol FROM table ORDER BY timestampcol DESC LIMIT 49,1; 
```

然后你可以像这样使用子查询：

```
DELETE FROM table WHERE timestampcol < ( SELECT timestampcol FROM table ORDER BY timestampcol DSEC LIMIT 49,1 ) 
```

当然，在做任何具有潜在破坏性的事情之前，请确保您有备份。请注意，与提到的其他方法相比，使用`IN`，这将避免对要删除的每一行进行 50 次整数比较，使其（可能）快 50 倍 - 假设我的 SQL 是正确的。

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-28T19:27:23.370

也许不是最有效的，但这应该有效：

```
DELETE FROM _table_ 
WHERE _date_ NOT IN (SELECT _date_ FROM _table_ ORDER BY _date_ DESC LIMIT 50) 
```

# sql-server - 对我的 SQL Server 存储过程进行版本控制的最佳方法是什么？

> ID：146543
> 
> 赞同：63
> 
> 时间：2008-09-28T19:31:07.027
> 
> 标签：sql-server, visual-studio, svn, version-control, stored-procedures

对我的数据库对象进行版本控制的最佳方法是什么？我正在使用 Visual Studio 2005/2008 和 SQL Server 2005。我更喜欢可以与 SVN 一起使用的解决方案。

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2008-09-28T19:36:15.440

与您的其他代码相同，将“数据库项目”添加到您的应用程序解决方案中，并在其中保留用于构建数据库对象的 sql 文件。对这些代码文件使用与应用程序相同的版本控制。

* * *

## 回答 #2

> 赞同：15
> 
> 时间：2008-09-28T19:38:48.490

查看 RedGate 提供的工具。它们专门处理包括 SP 在内的 SQL Server 对象的备份/恢复/比较案例。或者我不确定，但我认为 Visual Studio 允许您将 sp 签入存储库。自己没试过。但我可以推荐 RedGate 工具。他们为我省去了很多麻烦

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-29T12:39:44.373

我将 SVN 用于我的所有表/存储过程/函数源代码控制。

我找不到任何满足我需要的东西，所以我最终编写了一个[实用程序](http://www.reluctantdba.com/dbas-and-programmers/sqltools/svnforsql2005.aspx)，允许我将代码转储到一个很好的目录结构中，以便与 SVN 一起使用。

对于那些感兴趣的人，现在可以在[svn://finsel.com/public/VS2005/GenerateSVNFilesForSQL2005](http://svn://finsel.com/public/VS2005/GenerateSVNFilesForSQL2005)获得源代码。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-28T20:58:33.137

我们使用 Subversion，我们所做的只是将 sql 代码保存在我们的 subversion 项目的目录中，然后在我们准备好时将代码提交到存储库，并在我们开始处理已经存在的内容之前从存储库更新。

真正的诀窍是说服开发人员这样做。我们的 dbas 通过定期删除任何不在 Subversion 中的存储过程（或其他数据库对象）来做到这一点。失去一次东西，几乎没有人再这样做了。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T12:44:12.223

最佳方式 - 一种适合您的方式。

最简单的方法 - 目前不存在的方法。

我们使用半手动方法（源代码控制下的脚本，能够将存储过程部署到生产服务器的*一小*部分人，对架构的更改应该反映在对底层签入文件的更改中）。

我们**应该**做的是实现某种源代码控制与纯文本模式转储差异......但它通常“对我们有用”，尽管它在大多数时候真的很糟糕。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-28T19:42:08.047

我不知道预打包的解决方案，对不起...

...但是您不能只是一个连接到数据库并将所有存储过程作为文本文件保存到磁盘的小脚本吗？然后脚本将通过对“svn add”进行系统调用将所有文本文件添加到 SVN 存储库。

然后您可能希望另一个脚本连接到数据库，删除所有存储过程并从磁盘加载所有存储库存储过程。每次运行“svn up”并有新的/更改的存储过程时，都需要运行此脚本。

我不确定这是否可以通过 MS SQL 完成，但我相当有信心 MySQL 会适应这一点。如果为此编写 SVN 扩展太复杂，[Capistrano](http://www.capify.org/)支持签入/签出脚本 IIRC。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-05-19T01:22:04.847

我同意，如果可能的话，您应该使用数据库项目来对您的数据库以及您的应用程序源进行版本控制。

但是，如果您在企业场景中，您还应该考虑使用工具来跟踪服务器上的更改，并对这些更改进行版本控制。仅仅因为数据库项目存在并不意味着某些管理员或开发人员不能更改服务器上的那些存储过程。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-28T19:35:02.243

我们将转储为纯文本并将它们保存在我们的 VCS 中。

您可以编写一个备份和提交脚本来做类似的事情。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-06-30T13:50:58.423

我正在使用来自[http://scriptdb.codeplex.com/的 scriptdb.exe](http://scriptdb.codeplex.com/)

使用 rails 方式可能会很有用：[http ://code.google.com/p/migratordotnet/wiki/GettingStarted](http://code.google.com/p/migratordotnet/wiki/GettingStarted)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-08-10T15:29:37.440

使用versaplex 转储您的架构：[http ://code.google.com/p/versaplex/](http://code.google.com/p/versaplex/)

Versaplex 带有 Schemamatic，它可以读取数据库模式（表、SP 等）和数据（数据被转储为 CSV）。我将它与 SVN 和 git 一起使用，它很棒 :) 如果您需要帮助，请告诉我，值得一试！ [http://github.com/eduardok/versaplex](http://github.com/eduardok/versaplex)

# python - 你在 Python 中使用“全局”语句吗？

> ID：146557
> 
> 赞同：63
> 
> 时间：2008-09-28T19:37:18.743
> 
> 标签：python, global

我正在阅读一个关于 Python*全局*语句（[“Python 范围”](https://stackoverflow.com/questions/146359/python-scope)）的问题，我想起了当我还是 Python 初学者时我使用这个语句的频率（我经常使用*全局*），以及多年后的今天，我是如何做到的永远不要使用它。我什至认为它有点“非pythonic”。

你在 Python 中使用这个语句吗？您对它的使用是否随着时间而改变？

* * *

## 回答 #1

> 赞同：58
> 
> 时间：2008-09-28T23:23:53.210

我在这样的上下文中使用“全局”：

```
_cached_result = None
def myComputationallyExpensiveFunction():
    global _cached_result
    if _cached_result:
       return _cached_result

    # ... figure out result

    _cached_result = result
    return result 
```

我使用“全局”是因为它是有意义的，并且函数的读者很清楚正在发生什么。我也知道有这种模式，它是等效的，但会给读者带来更多的认知负担：

```
def myComputationallyExpensiveFunction():
    if myComputationallyExpensiveFunction.cache:
        return myComputationallyExpensiveFunction.cache

    # ... figure out result

    myComputationallyExpensiveFunction.cache = result
    return result
myComputationallyExpensiveFunction.cache = None 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2008-09-28T19:39:09.303

在我专业使用 Python 的 3 年多和作为 Python 爱好者五年多的时间里，我从未在任何生产代码中合法使用过该语句。我需要更改的任何状态都驻留在类中，或者，如果有一些“全局”状态，它位于一些共享结构中，例如全局缓存。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2011-06-29T15:38:28.973

我在函数创建或设置将全局使用的变量的情况下使用它。这里有些例子：

```
discretes = 0
def use_discretes():
    #this global statement is a message to the parser to refer 
    #to the globally defined identifier "discretes"
    global discretes
    if using_real_hardware():
        discretes = 1
... 
```

或者

```
file1.py:
    def setup():
        global DISP1, DISP2, DISP3
        DISP1 = grab_handle('display_1')
        DISP2 = grab_handle('display_2')
        DISP3 = grab_handle('display_3')
        ...

file2.py:
    import file1

    file1.setup()
    #file1.DISP1 DOES NOT EXIST until after setup() is called.
    file1.DISP1.resolution = 1024, 768 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2008-09-28T20:33:00.843

在我看来，一旦你觉得需要在 python 代码中使用全局变量，现在是停下来重新重构代码的好时机。
如果你的截止日期很近，将`global`代码放入代码并延迟重构过程可能听起来很有希望，但是，相信我，除非你真的必须这样做，否则你不会回到这个并修复 - 就像你的代码停止工作一样奇怪的原因，你必须调试它，你遇到一些`global`变量，它们所做的只是把事情搞砸。

所以，老实说，即使它是允许的，我也会尽可能避免使用它。即使这意味着围绕您的代码构建一个简单的类。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2008-09-28T19:46:55.757

对象是具有非本地状态的首选方式，因此很少需要全局。我认为即将到来的非本地修饰符也不会被广泛使用，我认为它主要是为了让 lispers 停止抱怨:-)

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2011-01-05T23:43:21.877

我将它用于带有命令行脚本和“optparse”的全局选项：

我的 main() 解析参数并将它们传递给执行脚本工作的任何函数......但将提供的选项写入全局“opts”字典。

Shell 脚本选项经常调整“叶子”行为，并且通过每个参数列表将“选择”字典线程化是不方便的（并且不必要）。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-28T21:07:03.397

我避免使用它，我们甚至有一条[pylint](http://www.logilab.org/857)规则在我们的生产代码中禁止它。我实际上认为它根本不应该存在。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-29T00:53:25.630

很少。我还没有找到它的用途。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-29T14:58:33.477

它在线程中用于共享状态（周围有锁定机制）很有用。

但是，我很少使用它。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-10-10T01:28:27.507

我已经在快速而肮脏的一次性脚本中使用它来自动化一些一次性任务。任何比这更大的东西，或者需要重用的东西，我会找到一种更优雅的方式。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2008-09-28T19:40:27.707

一次或两次。但它始终是重构的好起点。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2008-09-28T19:43:53.470

如果我能避免它，不。而且，据我所知，总有办法避免它。但我也不是说它完全没用

# objective-c - 制作 .webloc 文件

> ID：146575
> 
> 赞同：19
> 
> 时间：2008-09-28T19:44:19.820
> 
> 标签：objective-c, cocoa, macos, macos-carbon

我正在编写一个程序（对于 Mac OS X，使用 Objective-C），我需要以编程方式创建一堆 .webloc 文件。

.webloc 文件是在您将 URL 从 Safari 的位置栏拖放到某个文件夹后创建的简单文件。

一般来说，我需要一种方法来在文件系统中创建指向 Web 中某个位置的项目。据我了解，应该在 Mac OS X 上使用 .webloc 文件。

那么，是否可以制作一个具有有效 url 和一些标题的 .webloc 文件？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2008-09-28T23:04:16.657

它鲜为人知 - 但也有一个简单的基于 plist 的 weblocs 文件格式。

创建 webloc 文件时，您不需要*使用*其他三张海报描述的资源方法来保存它们。你也可以写一个简单的plist：

```
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>URL</key>
    <string>http://apple.com</string>
</dict>
</plist> 
```

二进制资源格式仍在使用中，如果您想读取 plist 文件 - 那么请确保您需要读取这两种文件格式。但是在编写文件时 - 使用基于 plist 的格式 - 它要容易得多。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-28T20:15:19.607

文件的`.webloc`数据叉中没有任何内容；相反，它将它引用的 URL 作为资源存储在其资源分支中。[您可以使用DeRez(1)](http://developer.apple.com/documentation/Darwin/Reference/ManPages/man1/DeRez.1.html "DeRez(1) 手册页")工具在命令行上看到这一点

`.webloc`在这里，我针对这个问题从 Safari 地址栏中拖出的文件运行了它：

```
% DeRez "Desktop/Crafting .webloc file - Stack Overflow.webloc"
data 'drag' (128, "Crafting .webloc file -#1701953") {
    $"0000 0001 0000 0000 0000 0000 0000 0003"            /* ................ */
    $"5445 5854 0000 0100 0000 0000 0000 0000"            /* TEXT............ */
    $"7572 6C20 0000 0100 0000 0000 0000 0000"            /* url ............ */
    $"7572 6C6E 0000 0100 0000 0000 0000 0000"            /* urln............ */
};

data 'url ' (256, "Crafting .webloc file -#1701953") {
    $"6874 7470 3A2F 2F73 7461 636B 6F76 6572"            /* http://stackover */
    $"666C 6F77 2E63 6F6D 2F71 7565 7374 696F"            /* flow.com/questio */
    $"6E73 2F31 3436 3537 352F 6372 6166 7469"            /* ns/146575/crafti */
    $"6E67 2D77 6562 6C6F 632D 6669 6C65"                 /* ng-webloc-file */
};

data 'TEXT' (256, "Crafting .webloc file -#1701953") {
    $"6874 7470 3A2F 2F73 7461 636B 6F76 6572"            /* http://stackover */
    $"666C 6F77 2E63 6F6D 2F71 7565 7374 696F"            /* flow.com/questio */
    $"6E73 2F31 3436 3537 352F 6372 6166 7469"            /* ns/146575/crafti */
    $"6E67 2D77 6562 6C6F 632D 6669 6C65"                 /* ng-webloc-file */
};

data 'urln' (256, "Crafting .webloc file -#1701953") {
    $"4372 6166 7469 6E67 202E 7765 626C 6F63"            /* Crafting .webloc */
    $"2066 696C 6520 2D20 5374 6163 6B20 4F76"            /*  file - Stack Ov */
    $"6572 666C 6F77"                                     /* erflow */
}; 
```

唯一可能需要在其中的资源是 ID 256 的`'url '`和`'TEXT'`资源，这些资源可能也不需要资源名称。`'urln'`如果您还想包含 URL 指向的文档的标题，该资源可能会很方便。该`'drag'`资源告诉系统这是一个剪辑文件，但我不确定在这个时代是否需要它。

要使用资源和文件的资源分支，您可以使用资源管理器——Carbon 的底层部分之一，它可以追溯到原始 Mac。然而，资源管理器有几个 Cocoa 包装器，例如[Nathan Day 的 NDResourceFork](http://homepage.mac.com/nathan_day/pages/source.xml "Nathan Day 的源代码")。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2008-09-28T20:16:33.173

`.webloc`文件（更一般地，Internet 位置文件）以其定义可追溯到 Mac OS 8.x 的格式编写。它是基于资源的，源自您从拖动的对象（如文本或图像）创建文件时获得的剪辑格式。

写入的资源是存储 URL 的`'url '`256 和`'TEXT'`256，以及可选的 'urln' 256，包含与 URL 关联的文本。 `'drag'`128 指向其他两个（或三个）资源。

NTWeblocFile 是[Cocoatech 开源框架](http://www.cocoatech.com/opensource.php)CocoaTechFoundation（BSD 许可）的一部分，支持从 Objective-C 编写这些文件。如果您想为 URL 单独指定标题，则需要修改该类，以便它将 URL 以外的内容写入`'urln'`资源中。

在 Mac OS X 10.3 和更高版本中，URL 也被写入（也可能被写入）到文件数据分支的属性列表中。请参阅其他答案以了解其工作原理...

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2008-09-29T08:25:23.110

另一种制作“网络快捷方式”的方法是`.url`这里已经提到的文件。
内容看起来像（比基于 plist xml 的简单得多）：

```
[InternetShortcut]
URL=http://www.apple.com/ 
```

注意文件有 3 行，最后一行是空的。

[有关 .url 文件格式的更多信息](http://www.cyanwerks.com/file-format-url.html)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-28T20:02:12.320

它使用基于资源叉的二进制格式。

有效的解决方法：

*   让用户将 URL 从您的应用程序 (NSURLPboardType) 拖到 Finder。Finder 将为您创建一个 webloc。
*   创建 Windows Web 快捷方式（.URL 文件）。这些具有类似 INI 的基于数据分叉的格式，应该记录在 Internet 上的某个地方；操作系统支持它们，因为它支持 weblocs。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2012-09-05T14:28:32.970

以下是谷歌浏览器的做法：[WriteURLToNewWebLocFileResourceFork](http://code.google.com/p/chromium/source/search?q=WriteURLToNewWebLocFileResourceFork&origq=WriteURLToNewWebLocFileResourceFork&btnG=Search%20Trunk)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-09-05T09:53:42.933

这完成了基本任务，不需要任何第三方库。（警告：最小的错误检查。）

```
// data for 'drag' resource (it's always the same)
#define DRAG_DATA_LENGTH 64
static const unsigned char _dragData[DRAG_DATA_LENGTH]={
    0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03,
    0x54, 0x45, 0x58, 0x54, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x75, 0x72, 0x6C, 0x20, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x75, 0x72, 0x6C, 0x6E, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00};

static void _addData(NSData *data, ResType type, short resId, ResFileRefNum refNum)
{
    Handle handle;
    if (PtrToHand([data bytes], &handle, [data length])==noErr) {
        ResFileRefNum previousRefNum=CurResFile();
        UseResFile(refNum);

        HLock(handle);
        AddResource(handle, type, resId, "\p");
        HUnlock(handle);

        UseResFile(previousRefNum);
    }
}

void WeblocCreateFile(NSString *location, NSString *name, NSURL *fileUrl)
{
    NSString *contents=[NSString stringWithFormat:
                        @"<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n"
                        @"<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n"
                        @"<plist version=\"1.0\">\n"
                        @"<dict>\n"
                        @"<key>URL</key>\n"
                        @"<string>%@</string>\n"
                        @"</dict>\n"
                        @"</plist>\n", location];

    if ([[contents dataUsingEncoding:NSUTF8StringEncoding] writeToURL:fileUrl options:NSDataWritingAtomic error:nil])
    {        
        // split into parent and filename parts
        NSString *parentPath=[[fileUrl URLByDeletingLastPathComponent] path];
        NSString *fileName=[fileUrl lastPathComponent];

        FSRef parentRef;
        if(FSPathMakeRef((const UInt8 *)[parentPath fileSystemRepresentation], &parentRef, NULL)==noErr)
        {
            unichar fileNameBuffer[[fileName length]];
            [fileName getCharacters:fileNameBuffer];

            FSCreateResFile(&parentRef, [fileName length], fileNameBuffer, 0, NULL, NULL, NULL);
            if (ResError()==noErr)
            {
                FSRef fileRef;
                if(FSPathMakeRef((const UInt8 *)[[fileUrl path] fileSystemRepresentation], &fileRef, NULL)==noErr)
                {
                    ResFileRefNum resFileReference = FSOpenResFile(&fileRef, fsWrPerm);
                    if (resFileReference>0 && ResError()==noErr)
                    {
                        _addData([NSData dataWithBytes:_dragData length:DRAG_DATA_LENGTH], 'drag', 128, resFileReference);
                        _addData([location dataUsingEncoding:NSUTF8StringEncoding], 'url ', 256, resFileReference);
                        _addData([location dataUsingEncoding:NSUTF8StringEncoding], 'TEXT', 256, resFileReference);
                        _addData([name dataUsingEncoding:NSUTF8StringEncoding], 'urln', 256, resFileReference);
                        CloseResFile(resFileReference);
                    }
                }
            }
        }
    }
} 
```

# java - 为什么Java main 方法是静态的？

> ID：146576
> 
> 赞同：529
> 
> 时间：2008-09-28T19:45:34.810
> 
> 标签：java, static, main

Java`main`方法的方法签名是：

```
public static void main(String[] args) {
    ...
} 
```

**这种方法必须是静态的有什么原因吗？**

* * *

## 回答 #1

> 赞同：418
> 
> 时间：2008-09-30T03:32:18.703

这只是惯例。事实上，即使是 main() 的名称，以及传入的参数也是纯粹的约定俗成的。

当您运行 java.exe（或 Windows 上的 javaw.exe）时，真正发生的是几个 Java 本地接口 (JNI) 调用。这些调用加载真正是 JVM 的 DLL（没错 - java.exe 不是 JVM）。当我们必须连接虚拟机世界和 C、C++ 等世界时，JNI 是我们使用的工具……反过来也是如此——实际上不可能（至少据我所知） JVM 在不使用 JNI 的情况下运行。

基本上，java.exe 是一个超级简单的 C 应用程序，它解析命令行，在 JVM 中创建一个新的字符串数组来保存这些参数，解析出您指定为包含 main() 的类名，使用 JNI 调用来查找main() 方法本身，然后调用 main() 方法，将新创建的字符串数组作为参数传入。这非常非常类似于您在使用 Java 反射时所做的事情——它只是使用了命名混乱的本机函数调用。

编写自己的 java.exe 版本（源代码与 JDK 一起分发）并让它做一些完全不同的事情是完全合法的。事实上，这正是我们对所有基于 Java 的应用程序所做的事情。

我们的每个 Java 应用程序都有自己的启动器。我们主要这样做是为了获得自己的图标和进程名称，但它在我们想要做一些除了常规 main() 调用之外的其他事情来让事情顺利进行的其他情况下派上用场（例如，在一种情况下，我们正在做COM 互操作性，我们实际上将 COM 句柄传递给 main() 而不是字符串数组）。

所以，总而言之：它是静态的原因是 b/c 很方便。它被称为“main”的原因是它必须是某种东西，而 main() 是他们在 C 的旧时代所做的（在那些日子里，函数的名称*很*重要）。我想 java.exe 可以让你只指定一个完全限定的主方法名称，而不仅仅是类 (java com.mycompany.Foo.someSpecialMain) - 但这只会让 IDE 更难自动检测 '项目中的可启动类。

* * *

## 回答 #2

> 赞同：351
> 
> 时间：2008-09-28T20:28:34.377

该方法是静态的，否则会有歧义：应该调用哪个构造函数？特别是如果您的班级看起来像这样：

```
public class JavaClass{
  protected JavaClass(int x){}
  public void main(String[] args){
  }
} 
```

JVM应该调用`new JavaClass(int)`吗？它应该通过`x`什么？

如果不是，JVM 是否应该在`JavaClass`不运行任何构造方法的情况下进行实例化？我认为它不应该，因为这会使你的整个类成为特例——有时你有一个尚未初始化的实例，你必须在每个可以调用的方法中检查它。

对于 JVM 必须在调用入口点之前实例化一个类来说，有太多的边缘情况和歧义是有意义的。这就是为什么`main`是静态的。

我不知道为什么`main`总是被标记`public`。

* * *

## 回答 #3

> 赞同：192
> 
> 时间：2008-09-28T19:48:01.480

`main`C++、C#和Java中的方法是静态的。

这是因为它们可以被运行时引擎调用，**而无需**实例化任何对象，然后主体中的代码`main`将完成其余的工作。

* * *

## 回答 #4

> 赞同：40
> 
> 时间：2012-07-12T04:05:57.983

### 为什么是 public static void main(String[] args) ？

这就是 Java 语言的设计方式以及 Java 虚拟机的设计和编写方式。

### [Oracle Java 语言规范](http://docs.oracle.com/javase/specs/jls/se5.0/html/j3TOC.html)

查看[第 12 章执行 - 第 12.1.4 节调用 Test.main](http://docs.oracle.com/javase/specs/jls/se5.0/html/execution.html#12.1.4)：

> 最后，在完成类Test的初始化之后（在此期间可能发生了其他相应的加载、链接和初始化），调用Test的main方法。
> 
> 方法 main 必须声明为 public、static 和 void。它必须接受一个作为字符串数组的参数。此方法可以声明为
> 
> ```
> public static void main(String[] args) 
> ```
> 
> 或者
> 
> ```
> public static void main(String... args) 
> ```

### [Oracle Java 虚拟机规范](http://docs.oracle.com/javase/specs/jvms/se5.0/html/VMSpecTOC.doc.html)

查看[第 2 章 Java 编程语言概念 - 第 2.17 节执行](http://docs.oracle.com/javase/specs/jvms/se5.0/html/Concepts.doc.html#19042)：

> Java 虚拟机通过调用某个指定类的 main 方法并传递给它一个参数来开始执行，该参数是一个字符串数组。这会导致指定的类被加载（第 2.17.2 节）、链接（第 2.17.3 节）到它使用的其他类型，并被初始化（第 2.17.4 节）。方法 main 必须声明为 public、static 和 void。

### [Oracle OpenJDK 源代码](http://grepcode.com/snapshot/repository.grepcode.com/java/root/jdk/openjdk/6-b14/)

下载并解压源 jar 并查看 JVM 是如何编写的，检查一下`../launcher/java.c`，其中包含命令后面的本机 C 代码`java [-options] class [args...]`：

```
/*
 * Get the application's main class.
 * ... ...
 */
if (jarfile != 0) {
    mainClassName = GetMainClassName(env, jarfile);

... ...

    mainClass = LoadClass(env, classname);
    if(mainClass == NULL) { /* exception occured */

... ...

/* Get the application's main method */
mainID = (*env)->GetStaticMethodID(env, mainClass, "main",
                                   "([Ljava/lang/String;)V");

... ...

{    /* Make sure the main method is public */
    jint mods;
    jmethodID mid;
    jobject obj = (*env)->ToReflectedMethod(env, mainClass,
                                            mainID, JNI_TRUE);

... ...

/* Build argument array */
mainArgs = NewPlatformStringArray(env, argv, argc);
if (mainArgs == NULL) {
    ReportExceptionDescription(env);
    goto leave;
}

/* Invoke main method. */
(*env)->CallStaticVoidMethod(env, mainClass, mainID, mainArgs);

... ... 
```

* * *

## 回答 #5

> 赞同：40
> 
> 时间：2012-07-15T12:20:02.707

让我们简单地假设，这`static`不是应用程序入口点所必需的。

应用程序类将如下所示：

```
class MyApplication {
    public MyApplication(){
        // Some init code here
    }
    public void main(String[] args){
        // real application code here
    }
} 
```

构造函数代码和方法之间的区别`main`是必要的，因为在 OO 中，构造函数只应确保实例已正确*初始化*。初始化后，实例可用于预期的“服务”。将完整的应用程序代码放入构造函数会破坏这一点。

因此，这种方法会在应用程序上强制执行**三种**不同的合约：

*   *必须*有一个默认构造函数。否则，JVM 将不知道要调用哪个构造函数以及应该提供哪些参数。
*   *必须*有一个`main`方法¹。好吧，这并不奇怪。
*   类*不得*`abstract`。_ 否则，JVM 无法实例化它。

`static`另一方面，该方法只需要**一个**合同：

*   必须有一个`main`方法¹。

在这里`abstract`，多个构造函数都不重要。

由于 Java 被设计为一种简单*的用户语言，因此应用程序入口点也使用***一个**合约以简单的方式设计，而不是使用**三个**独立且易碎的合约以复杂的方式设计也就不足为奇了。

请注意：这个论点**不是**关于 JVM 内部或 JRE 内部的简单性。这个论点是关于**用户**的简单性。

* * *

¹此处完整的签名仅计为一份合同。

* * *

## 回答 #6

> 赞同：14
> 
> 时间：2008-09-28T19:51:03.953

如果不是，如果有多个构造函数，应该使用哪个构造函数？

[Java 语言规范](http://java.sun.com/docs/books/jls/third_edition/html/execution.html)中提供了有关 Java 程序的初始化和执行的更多信息。

* * *

## 回答 #7

> 赞同：12
> 
> 时间：2008-09-28T19:48:09.733

在调用 main 方法之前，不会实例化任何对象。拥有 static 关键字意味着可以在不首先创建任何对象的情况下调用该方法。

* * *

## 回答 #8

> 赞同：12
> 
> 时间：2008-09-28T19:48:30.090

因为否则，它需要一个要执行的对象的实例。但它必须从头开始调用，而不是首先构造对象，因为解析参数和构造对象通常是 main() 函数（引导程序）的任务，通常使用这些参数/程序参数。

* * *

## 回答 #9

> 赞同：12
> 
> 时间：2015-05-09T13:31:27.843

让我以更简单的方式解释这些事情：

```
public static void main(String args[]) 
```

除小程序外，所有 Java 应用程序都从`main()`.

关键字`public`是一个访问修饰符，它允许从类外部调用成员。

`static`使用它是因为它允许`main()`在不必实例化该类的特定实例的情况下被调用。

`void`表示`main()`不返回任何值。

* * *

## 回答 #10

> 赞同：10
> 
> 时间：2013-07-08T00:11:05.057

是什么意思`public static void main(String args[])`？

1.  `public`是访问说明符，意味着任何人都可以访问/调用它，例如 JVM（Java 虚拟机。
2.  `static`允许`main()`在创建类的对象之前调用。这是必需的，因为`main()`在创建任何对象之前由 JVM 调用。由于它是静态的，因此可以通过类直接调用。

    ```
    class demo {    
        private int length;
        private static int breadth;
        void output(){
            length=5;
            System.out.println(length);
        }

        static void staticOutput(){
            breadth=10; 
            System.out.println(breadth);
        }

        public static  void main(String args[]){
            demo d1=new demo();
            d1.output(); // Note here output() function is not static so here
            // we need to create object
            staticOutput(); // Note here staticOutput() function is  static so here
            // we needn't to create object Similar is the case with main
            /* Although:
            demo.staticOutput();  Works fine
            d1.staticOutput();  Works fine */
        }
    } 
    ```

    同样，我们有时对用户定义的方法使用静态，这样我们就不需要创建对象。

3.  `void`表示`main()`被声明的方法没有返回值。

4.  `String[] args`指定方法中的唯一参数`main()`。

    `args`- 包含类类型对象数组的参数`String`。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2008-09-28T19:47:36.130

这只是一个惯例，但可能比替代方案更方便。使用静态 main，调用 Java 程序所需要知道的只是类的名称和位置。如果它不是静态的，您还必须知道如何实例化该类，或者要求该类有一个空的构造函数。

* * *

## 回答 #12

> 赞同：6
> 
> 时间：2008-09-28T20:04:12.050

构建各种 Applet、midlets、servlet 和 bean，然后调用它们的生命周期方法。调用 main 是对主类所做的所有事情，因此不需要将状态保存在多次调用的对象中。将 main 固定在另一个类上是很正常的（尽管不是一个好主意），这会妨碍使用该类来创建主对象。

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2008-09-28T22:09:02.360

如果主方法不是静态的，则需要从程序外部创建主类的对象。你想怎么做？

* * *

## 回答 #14

> 赞同：5
> 
> 时间：2017-02-21T09:56:54.910

`java`当您使用该命令执行 Java 虚拟机 (JVM) 时，

```
java ClassName argument1 argument2 ... 
```

执行应用程序时，将其类名指定为 java 命令的参数，如上

JVM 尝试调用您指定的类的 main 方法

> ——此时，还没有创建类的对象。
> 
> 将 JVM声明`main`为静态以主要创建一个类。`allows``invoke``without``instance`

让我们回到命令

`ClassName`是`command-line argument`JVM 的一个，它告诉它要执行哪个类。在 ClassName 之后，您还可以指定一个`list of Strings`（由空格分隔）作为 JVM 将传递给您的应用程序的命令行参数。- 这样的参数可能用于指定选项（例如，文件名）来运行应用程序 - 这就是为什么`String[] args`在 main 中调用了一个参数

参考资料：[Java™ 如何编程（早期对象），第十版](https://www.safaribooksonline.com/library/view/javatm-how-to/9780133813036/ch06lev2sec4.html)

* * *

## 回答 #15

> 赞同：3
> 
> 时间：2008-09-28T20:15:22.570

这只是一个约定。如果按照惯例，JVM 当然可以处理非静态主要方法。毕竟，你可以在你的类上定义一个静态初始化器，并在你的 main() 方法之前实例化无数个对象。

* * *

## 回答 #16

> 赞同：3
> 
> 时间：2012-06-12T12:48:33.353

我认为关键字'static'使main方法成为类方法，而类方法只有一个副本，可以被所有人共享，而且它不需要引用对象。因此，当编译驱动程序类时，可以调用 main 方法。（我只是在java的字母级别，如果我错了，对不起）

* * *

## 回答 #17

> 赞同：3
> 
> 时间：2012-07-10T14:37:20.557

main() 是静态的，因为；在应用程序生命周期的那个时刻，应用程序堆栈本质上是程序化的，因为还没有实例化对象。

这是一张白纸。您的应用程序此时正在运行，即使没有声明任何对象（请记住，有过程和 OO 编码模式）。作为开发人员，您通过创建对象实例并依赖于其中编译的代码，将应用程序转变为面向对象的解决方案。

面向对象的伟大之处在于数百万个显而易见的原因。然而，大多数 VB 开发人员在其代码中经常使用诸如“goto”之类的关键字的日子已经一去不复返了。“goto”是 VB 中的一个过程命令，它被它的 OO 对应物所取代：方法调用。

您还可以将静态入口点（主要）视为纯粹的自由。如果 Java 足以实例化一个对象并在运行时只向您呈现该实例，那么您将别无选择，只能编写一个程序化应用程序。尽管对于 Java 来说这听起来难以想象，但可能有许多场景需要过程方法。

这可能是一个非常晦涩的回答。请记住，“类”只是相互关联的代码的集合。“实例”是该类的一个孤立的、活生生的、自主的一代。

* * *

## 回答 #18

> 赞同：3
> 
> 时间：2012-07-25T05:58:45.577

最近，Programmers.SE 也发布了类似的问题

*   [为什么在 Java 和 C# 中使用静态 main 方法，而不是构造函数？](https://softwareengineering.stackexchange.com/q/156336/31260)

    > 从主要或次要来源寻找明确的答案，以了解为什么（特别是）Java 和 C# 决定将静态方法作为其入口点——而不是通过`Application`类的实例来表示应用程序实例，入口点是合适的构造函数？

[TL;DR](http://en.wiktionary.org/wiki/TL;DR "这是什么？")部分接受的答案是，

> 在Java中，原因`public static void main(String[] args)`是
> 
> 1.  [高斯林](http://en.wikipedia.org/wiki/James_Gosling "那是谁？")通缉
> 2.  由有 C（不是 Java）经验的人编写的代码
> 3.  由习惯在[新闻](http://en.wikipedia.org/wiki/NeWS "网络化可扩展窗口系统")上运行[PostScript的人执行](http://en.wikipedia.org/wiki/PostScript "脚本")
> 
> > [![http://i.stack.imgur.com/qcmzP.png](https://i.stack.imgur.com/qcmzP.png)](http://www.infoq.com/presentations/gosling-jvm-lang-summit-keynote "重点说明")
> 
>  
> 对于 C#，可以说推理是*传递相似*的。语言设计者使来自 Java 的程序员熟悉的[程序入口点语法。](http://en.wikipedia.org/wiki/Main_function_(programming) "“主要”有什么？")正如 C# 架构师[Anders Hejlsberg 所说](http://windowsdevcenter.com/pub/a/oreilly/windows/news/hejlsberg_0800.html "O'Reilly 编辑 John Osborn 的采访")，
> 
> > ...我们使用 C# 的方法只是为 Java 程序员提供替代方案...
> 
> ...

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2011-04-30T11:39:29.057

`public`关键字是访问修饰符，它允许程序员控制类成员的可见性。当类成员前面有 时`public`，则该成员可以被声明它的类之外的代码访问。

`public`与is相反`private`，它防止成员被定义在其类之外的代码使用。

在这种情况下，`main()`必须声明为`public`，因为它必须在程序启动时由其类之外的代码调用。

关键字`static`允许 `main()`在不必实例化类的特定实例的情况下被调用。这是必要的，因为`main()`在生成任何对象之前由 Java 解释器调用。

关键字`void`只是告诉编译器`main()`不返回值。

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2012-07-10T22:43:24.320

任何应用程序的真正入口点是静态方法。如果 Java 语言支持将实例方法作为“入口点”，则运行时需要在内部将其实现为静态方法，该方法构造对象的实例，然后调用实例方法。

有了这个，我将研究选择以下三个选项中的一个特定选项的理由：

1.  `static void main()`就像我们今天看到的那样。
2.  `void main()`在新构造的对象上调用的实例方法。
3.  使用类型的构造函数作为入口点（例如，如果入口类被调用`Program`，那么执行将有效地由 组成`new Program()`）。

## 分解：

`static void main()`

1.  调用封闭类的静态构造函数。
2.  调用静态方法`main()`。

`void main()`

1.  调用封闭类的静态构造函数。
2.  通过有效调用构造封闭类的实例`new ClassName()`。
3.  调用实例方法`main()`。

`new ClassName()`

1.  调用封闭类的静态构造函数。
2.  构造一个类的实例（然后什么都不做，只是简单地返回）。

## 理由：

我将按相反的顺序进行此操作。

请记住，Java 的设计目标之一是强调（尽可能要求）良好的面向对象编程实践。在这种情况下，对象的构造函数*初始化*对象，但不应对对象的行为负责。因此，一个提供入口点的规范`new ClassName()`会通过强制在每个应用程序上设计一个“理想”构造函数的异常来混淆新 Java 开发人员的情况。

通过制作`main()`实例方法，上述问题肯定解决了。但是，它要求规范列出入口类的构造函数的签名以及`main()`方法的签名，从而增加了复杂性。

总之，**指定 a`static void main()`创建一个复杂度最低的规范，同时遵守将行为放入方法的原则**。考虑到实现一个自身构造类的实例并调用实例方法的方法是多么简单，指定为实例方法`main()`并没有真正的优势。`main()`

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2012-07-13T15:15:47.560

原型是[JLS](http://docs.oracle.com/javase/specs/jls/se7/html/jls-12.html#jls-12.1.4)`public static void main(String[])`中定义的约定：

> 方法 main 必须声明为 public、static 和 void。它必须指定一个声明类型为字符串数组的形式参数（第 8.4.1 节）。

在 JVM 规范[5.2\. 虚拟机启动](http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-5.html#jvms-5.2)我们可以阅读：

> Java 虚拟机通过使用引导类加载器（第 5.3.1 节）创建一个初始类来启动，该类以依赖于实现的方式指定。Java 虚拟机然后链接初始类，对其进行初始化，并调用**公共类方法 void main(String[])**。调用此方法会驱动所有进一步的执行。执行构成主要方法的 Java 虚拟机指令可能会导致附加类和接口的链接（并因此创建），以及调用附加方法。

有趣的是，在 JVM 规范中并没有提到 main 方法必须是静态的。但是规范还说 Java 虚拟机之前执行 2 个步骤：

*   链接初始类（[5.4.链接](http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-5.html#jvms-5.4)）
*   初始化它（[5.5.初始化](http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-5.html#jvms-5.5)）

> 类或接口的初始化包括执行其类或接口的初始化方法。

在[2.9 中。特殊方法](http://docs.oracle.com/javase/specs/jvms/se7/html/jvms-2.html#jvms-2.9)：

定义了一个**类或接口初始化方法**：

> 一个类或接口最多有一个类或接口初始化方法，并通过调用该方法进行初始化（第 5.5 节）。类或接口的初始化方法具有特殊名称`<clinit>`，不带参数，并且是无效的。

并且**类或接口初始化方法**与定义如下的**实例初始化方法**不同：

> 在 Java 虚拟机级别，用 Java 编程语言 (JLS §8.8) 编写的每个构造函数都显示为具有特殊名称的实例初始化方法`<init>`。

所以JVM初始化一个**类或接口的初始化方法**，而不是一个**实例初始化方法**，它实际上是一个构造函数。所以他们不需要提到在 JVM 规范中 main 方法必须是静态的，因为在调用 main 方法之前没有创建任何实例这一事实暗示了这一点。

* * *

## 回答 #22

> 赞同：1
> 
> 时间：2012-07-11T20:03:48.343

> *public static void 关键字表示Java虚拟机（JVM）解释器可以调用程序的main方法来启动程序（public），而不需要创建类的实例（static），并且程序不向Java VM解释器返回数据（无效）当它结束时。*

资料来源： [要点，第 1 部分，第 2 课：构建应用程序](http://java.sun.com/developer/onlineTraining/Programming/BasicJava1/prog.html)

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2015-06-03T19:16:51.610

我不知道JVM是否在实例化对象之前调用了main方法......但是main（）方法是静态的还有一个更强大的原因......当JVM调用类的main方法时（比如说， 人）。它通过“ **Person.main()** ”调用它。您会看到，JVM 通过类名调用它。这就是为什么 main() 方法应该是静态和公共的，以便 JVM 可以访问它。

希望它有所帮助。如果是这样，请通过评论告诉我。

* * *

## 回答 #24

> 赞同：1
> 
> 时间：2016-12-08T10:04:00.860

static - 当 JVM 调用 main 方法时，被调用的类不存在任何对象，因此它必须具有静态方法才能允许从类调用。

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2010-06-01T12:49:51.877

静态方法不需要任何对象。它直接运行，所以 main 直接运行。

* * *

## 回答 #26

> 赞同：0
> 
> 时间：2012-01-18T23:51:02.040

使用 main 方法中的 static 关键字是因为在 main 方法中没有发生任何实例化。但是对象是构造而不是调用，因此我们在 main 方法中使用了静态关键字。在 jvm 上下文中，当类加载到其中时会创建内存。并且所有静态成员都存在于该内存中。如果我们现在将 main 设为静态，它将在内存中并且 jvm (class.main(..)) 可以访问，因此我们可以调用 main 方法，甚至不需要创建堆。

* * *

## 回答 #27

> 赞同：0
> 
> 时间：2012-07-11T18:13:00.480

正如我们在这里看到的，这只是一个约定：

> 该方法**必须声明为 public 和 static**，它不能返回任何值，并且它必须接受 String 数组作为参数。默认情况下，第一个非选项参数是要调用的类的名称。应使用完全限定的类名。如果指定了 -jar 选项，则第一个非选项参数是包含应用程序的类和资源文件的 JAR 归档的名称，启动类由 Main-Class 清单头指示。

[http://docs.oracle.com/javase/1.4.2/docs/tooldocs/windows/java.html#description](http://docs.oracle.com/javase/1.4.2/docs/tooldocs/windows/java.html#description)

* * *

## 回答 #28

> 赞同：0
> 
> 时间：2012-07-12T12:43:15.647

来自[java.sun.com](http://java.sun.com/developer/onlineTraining/Programming/BasicJava1/prog.html)（网站上有更多信息）：

> main 方法是静态的，为 Java VM 解释器提供了一种启动类的方法，而无需先创建控制类的实例。程序启动后在main方法中创建控件类的实例。

我的理解一直很简单，就像任何静态方法一样，可以在不创建关联类的实例的情况下调用 main 方法，允许它在程序中的任何其他内容之前运行。如果它不是静态的，则必须在调用它之前实例化一个对象——这会产生“鸡和蛋”的问题，因为 main 方法通常是您在程序开始时用来实例化对象的方法。

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2015-01-22T22:02:01.960

在 Java 中声明为静态的任何方法都属于类本身。同样，特定类的静态方法只能通过引用类来访问，例如`Class_name.method_name();`

因此，在访问静态方法之前不需要实例化一个类。

因此 main() 方法被声明为`static`可以在不创建该类的对象的情况下访问它。

由于我们使用 main 方法所在的类的名称保存程序（或者程序应该从哪里开始执行，适用于没有`main()`方法（）的类（高级））。所以通过上面提到的方式：

```
Class_name.method_name(); 
```

可以访问main方法。

简而言之，当程序被编译时，它会搜索`main()`具有以下`String`参数的方法：`main(String args[])`在提到的类中（即通过程序的名称），并且由于一开始它没有实例化该类的范围，所以 main()方法被声明为静态。

* * *

## 回答 #30

> 赞同：0
> 
> 时间：2015-07-10T11:06:30.190

基本上，我们将那些不执行与对象相关的任何任务的数据成员和成员函数设为静态。在主方法的情况下，我们将其设为 STATIC，因为它与对象无关，因为无论我们是否创建对象，主方法总是运行。

* * *

## 回答 #31

> 赞同：0
> 
> 时间：2016-04-29T02:18:00.090

背后的原因很简单，因为对象不需要调用静态方法，如果是非静态方法，java虚拟机先创建对象然后调用main()方法，这会导致额外内存分配的问题。

* * *

## 回答 #32

> 赞同：0
> 
> 时间：2016-08-18T17:12:08.397

程序的**main 方法**有一个**保留字** **static**，这意味着它允许在静态上下文中使用。上下文与程序运行期间计算机内存的使用有关。当虚拟机加载程序时，它会为其创建静态上下文，分配**计算机内存**来存储程序及其数据等。**动态上下文**是稍后在运行期间进行的某种内存分配程序。如果不允许 main 方法在静态上下文中运行，程序将无法启动。

* * *

## 回答 #33

> 赞同：0
> 
> 时间：2018-10-14T16:27:52.317

main 方法总是需要是静态的，因为在运行时 JVM 不会创建任何对象来调用 main 方法，并且我们知道在 java 中静态方法是唯一可以使用类名调用的方法，因此 main 方法总是需要是静态的。

有关更多信息，请访问此视频：[https ://www.youtube.com/watch?v=Z7rPNwg-bfk&feature=youtu.be](https://www.youtube.com/watch?v=Z7rPNwg-bfk&feature=youtu.be)

* * *

## 回答 #34

> 赞同：-1
> 
> 时间：2009-11-05T07:00:20.687

static 表示该方法是类方法。调用时不需要任何类对象。

* * *

## 回答 #35

> 赞同：-1
> 
> 时间：2010-03-12T07:29:29.813

由于从 main() 开始执行程序，并且 java 是纯面向对象的程序，其中在 main() 中声明了对象，这意味着在创建对象之前调用 main()，因此如果 main() 将是非静态的，则调用它将需要一个对象，因为静态意味着不需要对象............

* * *

## 回答 #36

> 赞同：-1
> 
> 时间：2011-07-01T19:51:28.417

为什么 main() 在 Java 中是静态的，这是一个常见问题。

**答**：我们知道，在 Java 中，JVM 从 main() 开始执行。JVM 执行 main() 时，包含 main() 的类没有被实例化，所以我们不能在没有对象引用的情况下调用非静态方法。因此，为了调用它，我们将其设置为静态，因此类加载器将所有静态方法加载到 JVM 上下文内存空间中，JVM 可以从中直接调用它们。

* * *

## 回答 #37

> 赞同：-5
> 
> 时间：2009-01-12T12:15:50.867

因为，静态成员不是任何特定类和主方法的一部分，不需要创建它的对象，但仍然可以引用所有其他类。

# c# - 带有和不带有 .aspx 扩展名的链接

> ID：146582
> 
> 赞同：1
> 
> 时间：2008-09-28T19:47:46.083
> 
> 标签：c#, asp.net, vb.net, url-rewriting, iis-6

可以将服务器配置为允许使用带有和不使用 .aspx 扩展名的链接。

如果是，我该如何设置它。

我正在使用 umbraco 的客户网站上工作。我知道它内置了友好的 URL 功能。不幸的是，该网站已经上线并为所有链接打开了该功能。

问题是他们想要使用诸如 www.sitename.com/promotion 之类的促销网址，而不必附加 .aspx 扩展名。而且我们不想经历在网站范围内启用 url 重写和必须追踪所有损坏的链接的麻烦。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-28T19:54:16.113

Scott Guthrie 在这方面有一篇很好的文章。

[http://weblogs.asp.net/scottgu/archive/2007/02/26/tip-trick-url-rewriting-with-asp-net.aspx](http://weblogs.asp.net/scottgu/archive/2007/02/26/tip-trick-url-rewriting-with-asp-net.aspx)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T21:53:03.317

我之前通过编写一个简单的 HttpModule 来完成此操作，需要注意以下几点：

*   您需要将 IIS 中的 404 错误指向一个 aspx 页面，否则 IIS 将不会调用 ASP.NET 运行时并且 HTTPModule 将永远不会命中。
*   这最适合从虚 url 捕获和重定向，而不是作为功能齐全的 urlrewrite。

```
    公共类 UrlRewrite : IHttpModule
    {
        公共无效初始化（HttpApplication 应用程序）
        {
            application.BeginRequest += (new EventHandler(this.Application_BeginRequest));
        }

        私有无效 Application_BeginRequest（对象源，EventArgs e）
        {
            // RawUrl 看起来像：
            // http://domain.com/404.aspx;http://domain.com/Posts/SomePost/
            if (HttpContext.Current.Request.RawUrl.Contains(";")
                && HttpContext.Current.Request.RawUrl.Contains("404.aspx"))
            {
                // 这会将最初输入的 URL 放入 url[1]
                string[] url = HttpContext.Current.Request.RawUrl.ToString().Split(';');

                // 现在解析 URL 并重定向到你想去的地方，
                // 您可以使用 XML 文件来存储短 URL 和真实 URL 之间的映射。

                字符串 newUrl = parseYourUrl(url[1]);
                Response.Redirect(newUrl);
            }

            // 如果我们到达这里，那么 404.aspx 的实际内容将被加载。
        }

        公共无效处置（）
        {
            // 实现接口 IHttpModule 所需。
        }
    }

```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T20:06:55.677

**在完全控制 URI**部分的中途提供了链接和一些完成此操作的方法：http: [//blogs.msdn.com/bags/archive/2008/08/22/rest-in-wcf-part-ix -控制-uri.aspx](http://blogs.msdn.com/bags/archive/2008/08/22/rest-in-wcf-part-ix-controlling-the-uri.aspx)

# windows - 为 Windows 升级 DOS 批处理文件

> ID：146602
> 
> 赞同：6
> 
> 时间：2008-09-28T20:01:29.623
> 
> 标签：windows, automation, batch-file, dos

有没有人最近对在 Windows 机器上编写自动 DOS 批处理样式任务有任何要求？

我有一些自动化要做，如果有更好的方法来自动化这些任务，我宁愿不坐下来在记事本中写一堆 .BAT 文件：主要是在特定日期和时间条件下移动文件，以及在移动文件之前和之后触发 Windows 应用程序。

我正在考虑一个 IDE，它具有对编辑器“可用”的所有 DOS 命令，并具有正确的参数语法检查。那里有这样的东西，还是我应该用 .BAT 文件以外的东西来解决这个问题？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-28T20:07:17.720

对于 BAT 文件之外的简单 Windows 自动化，[VBScript](http://msdn.microsoft.com/en-us/library/sx7b3k7y(VS.85).aspx)和[Powershell](http://www.microsoft.com/technet/scriptcenter/hubs/msh.mspx)可能值得一看。如果您想知道从哪里开始，VBScript+Windows 任务计划程序将是我首先开始的地方。使用 VBS 复制文件可以很简单：

```
Dim objFSO

Set objFSO = CreateObject ("Scripting.FileSystemObject")
If objFSO.FileExists("C:\source\your_file.txt") Then
    objFSO.CopyFile "C:\source\your_file.txt", "C:\destination\your_file.txt"
EndIf 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-28T20:19:49.627

绝对是[PowerShell](http://www.microsoft.com/technet/scriptcenter/hubs/msh.mspx)。它是 Microsoft 的新外壳，具有许多有趣的可能性和出色的可扩展性。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-28T20:04:56.900

试试 Python。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-28T20:06:19.767

Windows 98SE 及更高版本内置了 Windows Script Host，它允许您使用 VBScript 自动执行任务（参见例如[http://www.windowsdevcenter.com/pub/a/oreilly/windows/news/vbscriptpr_0201.html](http://www.windowsdevcenter.com/pub/a/oreilly/windows/news/vbscriptpr_0201.html)）。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-29T05:38:47.003

我为此使用[AutoIt](http://www.autoitscript.com/autoit3/)，因为默认情况下 PowerShell 并非在所有机器上都可用。AutoIt 提供了一种简单的语言，其中包含许多可以重复使用的默认代码。AutoIt 可以编译为 .exe。

我不确定“在特定条件下移动文件”是什么，但我曾经编写过[Robocopy 控制器脚本](http://www.mackaaij.org/robocopy_controller_script.html)（使用 AutoIt），您可以通过该脚本设置一个复制脚本，将其填充到 Robocopy.exe（“强大的文件复制”-a可以从 Microsoft 下载的复制程序，默认情况下包含在 Windows Vista 中以替换 xcopy）。也许我的这个免费脚本可以提供帮助。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-28T20:40:26.767

这里有一个用于 Powershell 的 IDE：

[PowerGUI](http://powergui.org/index.jspa)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-28T20:14:43.163

我会推荐 Python 而不是 Ruby 作为 Windows 脚本语言。Python 的 windows 支持比 Ruby 成熟得多。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-28T20:21:00.293

我个人使用 Python 或[PowerShell](http://www.microsoft.com/windowsserver2003/technologies/management/powershell/default.mspx) 来完成此类任务。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-28T20:46:33.430

虽然这不是您正在寻找的，但我会选择 Perl。由于缺少 GUI，Perl 可以让您快速完成任务，而且它的“粘合”功能将有助于您将来可能完成的任务。此外，如果有一天您必须在另一个操作系统（不是 Windows）下做类似的事情，PowerShell 可能不可用，而您的 Perl 知识会派上用场。

除此之外——Perl 在 Windows 下最亲近的兄弟绝对是 PowerShell。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2008-09-28T20:10:53.470

vbscript/WSH 实际上是 Microsoft 希望您使用的 - 不幸的是，我已经写了其中一些，但并不令人愉快 -

我完全同意 Mikael - 如果您知道哪些系统将运行脚本并且您可以在它们上安装解释器，请使用 Python 或 Ruby 之类的脚本语言

当然，这取决于您需要执行哪种类型的自动化 - 如果您弄乱了操作系统或 Active Directory 设置，请使用 WSH - 但对于您的平均文件管理，请使用 Python 或 Ruby

# nhibernate - 为什么我的 NHibernate 包集合没有动态设置孩子的“父 ID”？

> ID：146604
> 
> 赞同：8
> 
> 时间：2008-09-28T20:01:44.007
> 
> 标签：nhibernate, mapping, parent-child

我有一个新对象，其中包含作为 IList 的某个属性的新对象集合。我通过sql profiler看到两个正在执行的插入查询..一个用于父级，它具有新的guid id，另一个用于子级，但是，引用父级的子级外键是一个空的guid。这是我在父级上的映射：

```
<id name="BackerId">
  <generator class="guid" />
</id>
<property name="Name" />
<property name="PostCardSizeId"  />
<property name="ItemNumber" />

<bag name="BackerEntries" table="BackerEntry" cascade="all" lazy="false" order-by="Priority">
  <key column="BackerId" />
  <one-to-many class="BackerEntry" />
</bag> 
```

在 Backer.cs 类上，我将 BackerEntries 属性定义为

```
IList<BackerEntry> 
```

当我尝试 SaveOrUpdate 传入的实体时，我在 sql profiler 中得到以下结果：

exec sp_executesql N'INSERT INTO Backer (Name, PostCardSizeId, ItemNumber, BackerId) VALUES (@p0, @p1, @p2, @p3)',N'@p0 nvarchar(3),@p1 uniqueidentifier,@p2 nvarchar(3 ),@p3 uniqueidentifier',@p0=N'qaa',@p1='BC95E7EB-5EE8-44B2-82FF30F5176684D',@p2=N'qaa',@p3='18FBF8CE-FD22-4D08-A3B1-63D6DFF426E5'

exec sp_executesql N'INSERT INTO BackerEntry (BackerId, BackerEntryTypeId, Name, Description, MaxLength, IsRequired, Priority, BackerEntryId) VALUES (@p0, @p1, @p2, @p3, @p4, @p5, @p6, @p7) ',N'@p0 uniqueidentifier,@p1 uniqueidentifier,@p2 nvarchar(5),@p3 nvarchar(5),@p4 int,@p5 bit,@p6 int,@p7 uniqueidentifier',@p0='00000000-0000 -0000-0000-000000000000',@p1='2C5BDD33-5DD3-42EC-AA0E-F1E548A5F6E4',@p2=N'qaadf',@p3=N'wasdf',@p4=0,@p5=1,@ p6=0,@p7='FE9C4A35-6211-4E17-A75A-60CCB526F1CA'

如您所见，它不会将孩子上 BackerId 的空 guid 重置为父母的新真实 guid。

最后，异常抛出是：

```
"NHibernate.Exceptions.GenericADOException: could not insert: [CB.ThePostcardCompany.MiddleTier.BackerEntry][SQL: INSERT INTO BackerEntry (BackerId, BackerEntryTypeId, Name, Description, MaxLength, IsRequired, Priority, BackerEntryId) VALUES (?, ?, ?, ?, ?, ?, ?, ?)] ---\u003e System.Data.SqlClient.SqlException: The INSERT statement conflicted with the FOREIGN KEY constraint 
```

编辑：解决了！下面的第一个答案为我指明了正确的方向。我需要在子映射和类上添加该反向引用。这允许它以纯粹的 .net 方式工作 - 但是，当接受 json 时，会出现断开连接，所以我不得不想出一些古怪的代码来“重新连接”孩子。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2008-09-28T20:20:44.037

您可能需要将 NOT-NULL="true" 添加到映射类：

```
<bag name="BackerEntries" table="BackerEntry" cascade="all" lazy="false" order-by="Priority">
  <key column="BackerId" not-null="true"/>
  <one-to-many class="BackerEntry" />
</bag> 
```

并确保您为子类定义了相反的映射：

```
<many-to-one name="parent" column="PARENT_ID" not-null="true"/> 
```

在我当前的父子关系项目中，我遇到了类似的休眠问题，这是解决方案的一部分。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-11-17T14:25:00.000

我遇到了这个问题，我花了很长时间才弄清楚。Child 表必须在其父外键上允许空值。NHibernate 喜欢在外键列中使用 NULL 保存子项，然后返回并使用正确的 ParentId 进行更新。

# regex - 我以犯罪效率低下的方式使用 Python 正则表达式

> ID：146607
> 
> 赞同：8
> 
> 时间：2008-09-28T20:03:14.017
> 
> 标签：regex, algorithm, optimization, python

我的目标是创建一个非常简单的模板语言。目前，我正在用一个值替换一个变量，如下所示：

这个输入：

> 网络

应该产生这个输出：

> Web 这是一个测试变量

我已经让它工作了。但是看看我的代码，我在相同的字符串上运行多个相同的正则表达式——这只是冒犯了我的效率感。必须有一种更好、更 Pythonic 的方式。（真正冒犯的是两个“while”循环。）

这确实通过了单元测试，所以如果这是愚蠢的过早优化，请告诉我——我愿意放手。一个文档中可能有几十个这样的变量定义和使用，但不会有数百个。但我怀疑（对其他人而言）有明显的改进方法，我很好奇 StackOverflow 人群会想出什么。

```
def stripMatchedQuotes(item):
    MatchedSingleQuotes = re.compile(r"'(.*)'", re.LOCALE)
    MatchedDoubleQuotes = re.compile(r'"(.*)"', re.LOCALE)
    item = MatchedSingleQuotes.sub(r'\1', item, 1)
    item = MatchedDoubleQuotes.sub(r'\1', item, 1)
    return item

def processVariables(item):
    VariableDefinition = re.compile(r'<%(.*?)=(.*?)%>', re.LOCALE)
    VariableUse = re.compile(r'<%(.*?)%>', re.LOCALE)
    Variables={}

    while VariableDefinition.search(item):
        VarName, VarDef = VariableDefinition.search(item).groups()
        VarName = stripMatchedQuotes(VarName).upper().strip()
        VarDef = stripMatchedQuotes(VarDef.strip())
        Variables[VarName] = VarDef
        item = VariableDefinition.sub('', item, 1)

    while VariableUse.search(item):
        VarName = stripMatchedQuotes(VariableUse.search(item).group(1).upper()).strip()
        item = VariableUse.sub(Variables[VarName], item, 1)

    return item 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2008-09-28T20:31:44.120

可以改进的第一件事是将 re.compile 移到函数之外。编译是缓存的，但是在检查它是否已编译时会降低速度。

另一种可能性是使用单个正则表达式，如下所示：

```
MatchedQuotes = re.compile(r"(['\"])(.*)\1", re.LOCALE)
item = MatchedQuotes.sub(r'\2', item, 1) 
```

最后，您可以将其组合到 processVariables 中的正则表达式中。采用[Torsten Marek 的](https://stackoverflow.com/questions/146607/im-using-python-regexes-in-a-criminally-inefficient-manner#146683)建议，使用 re.sub 函数，这极大地改进和简化了事情。

```
VariableDefinition = re.compile(r'<%(["\']?)(.*?)\1=(["\']?)(.*?)\3%>', re.LOCALE)
VarRepl = re.compile(r'<%(["\']?)(.*?)\1%>', re.LOCALE)

def processVariables(item):
    vars = {}
    def findVars(m):
        vars[m.group(2).upper()] = m.group(4)
        return ""

    item = VariableDefinition.sub(findVars, item)
    return VarRepl.sub(lambda m: vars[m.group(2).upper()], item)

print processVariables('<%"TITLE"="This Is A Test Variable"%>The Web <%"TITLE"%>') 
```

这是我运行 100000 次的时间：

```
Original       : 13.637
Global regexes : 12.771
Single regex   :  9.095
Final version  :  1.846 
```

[编辑] 添加缺少的非贪婪说明符

[Edit2] 添加了 .upper() 调用，因此像原始版本一样不区分大小写

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-28T20:36:43.703

[`sub`](http://docs.python.org/lib/node46.html)可以将可调用对象作为它的参数，而不是简单的字符串。使用它，您可以用一个函数调用替换所有变量：

```
>>> import re
>>> var_matcher = re.compile(r'<%(.*?)%>', re.LOCALE)
>>> string = '<%"TITLE"%> <%"SHMITLE"%>'
>>> values = {'"TITLE"': "I am a title.", '"SHMITLE"': "And I am a shmitle."}
>>> var_matcher.sub(lambda m: vars[m.group(1)], string)
'I am a title. And I am a shmitle. 
```

遵循 eduffy.myopenid.com 的建议并保留已编译的正则表达式。

相同的配方可以应用于第一个循环，只是您需要先存储变量的值，并始终`""`作为替换返回。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-28T20:19:40.220

永远不要创建自己的编程语言。曾经。（我曾经对这条规则有一个例外，但现在没有了。）

总有一种现有的语言可以更好地满足您的需求。如果您详细说明了用例，人们可能会帮助您选择合适的语言。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-28T21:05:37.987

创建模板语言固然很好，但模板语言的目标之一不应该是易于阅读和高效解析吗？你给出的例子似乎两者都不是。

正如 Jamie Zawinsky 的名言：

> 有些人在遇到问题时会想“我知道，我会使用正则表达式！” 现在他们有两个问题。

如果正则表达式是您创建的问题的解决方案，最好的办法不是编写更好的正则表达式，而是重新设计您的方法以完全消除它们的使用。正则表达式复杂、昂贵、极难维护，并且（理想情况下）只能用于解决其他人创建的问题。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-28T20:20:03.650

您可以一次性匹配两种引号`r"(\"|')(.*?)\1"`-`\1`指的是第一组，因此它只会匹配匹配的引号。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-28T20:23:40.507

您正在调用 re.compile 。这些的全局变量在这里不会受到伤害。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-09-28T20:47:53.847

如果一个正则表达式只包含一个 .* 通配符和文字，那么您可以使用 find 和 rfind 来定位开始和结束分隔符。

如果它只包含一系列 .*? 通配符和文字，那么您可以使用一系列查找来完成工作。

如果代码对时间要求很高，那么完全放弃正则表达式可能会提高一点速度。

此外，在我看来，这是一种[LL-parsable language](http://en.wikipedia.org/wiki/LL_parser)。您可以寻找一个已经可以为您解析此类内容的库。您还可以使用递归调用进行一次解析——例如，您可以实现您的 processVariables 函数以仅消耗第一个报价，然后调用一个报价匹配函数来消耗下一个报价等。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-09-28T22:07:43.983

为什么不使用[Mako](http://www.makotemplates.org/)？严重地。您需要 Mako 没有的哪些功能？也许您可以调整或扩展已经有效的东西。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-28T20:22:31.523

不要连续调用 search 两次（在循环条件中和循环中的第一个语句中）。在循环之前调用（并缓存结果）一次，然后在循环的最后一条语句中调用。

* * *

## 回答 #10

> 赞同：-3
> 
> 时间：2008-09-28T21:27:53.487

为什么不使用 XML 和 XSLT 而不是创建自己的模板语言？您想要做的事情在 XSLT 中非常简单。

# erlang - Erlang 中的 Eratosthenes 筛

> ID：146622
> 
> 赞同：17
> 
> 时间：2008-09-28T20:08:30.853
> 
> 标签：erlang, sieve-of-eratosthenes

我正在学习Erlang。作为练习，我学习了生成素数[的埃拉托色尼筛法。](http://en.wikipedia.org/wiki/Sieve_of_Eratosthenes)这是我的代码：

```
-module(seed2).
-export([get/1]).

get(N) -> WorkList = lists:duplicate(N, empty),
          get(2, N, WorkList, []).

get(thats_the_end, _N, _WorkList, ResultList) -> lists:reverse(ResultList);
get(CurrentPrime, N, WorkList, ResultList) -> ModWorkList = markAsPrime(CurrentPrime, N, WorkList),
                                              NextPrime = findNextPrime(CurrentPrime + 1, N, WorkList),
                                              get(NextPrime, N, ModWorkList, [CurrentPrime|ResultList]).

markAsPrime(CurrentPrime, N, WorkList) when CurrentPrime =< N -> WorkListMod = replace(CurrentPrime, WorkList, prime),
                                                                 markAllMultiples(CurrentPrime, N, 2*CurrentPrime, WorkListMod).

markAllMultiples(_ThePrime, N, TheCurentMark, WorkList) when TheCurentMark > N -> WorkList;
markAllMultiples(ThePrime, N, TheCurrentMark, WorkList) -> WorkListMod = replace(TheCurrentMark, WorkList, marked),
                                                           markAllMultiples(ThePrime, N, TheCurrentMark + ThePrime, WorkListMod).

findNextPrime(Iterator, N, _WorkList) when Iterator > N -> thats_the_end;
findNextPrime(Iterator, N, WorkList) -> I = lists:nth(Iterator, WorkList),
                                        if
                                          I =:= empty -> Iterator;
                                          true -> findNextPrime(Iterator + 1, N, WorkList)
                                        end.

replace(N, L, New)-> {L1, [_H|L2]} = lists:split(N - 1, L),
                     lists:append(L1, [New|L2]). 
```

这段代码实际上有效:)。问题是我觉得这不是最好的实现。

我的问题是实施“埃拉托色尼筛”的“erlangish”方式是什么

编辑：好的，安德烈亚斯解决方案非常好，但速度很慢。有什么想法可以改善吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-10-05T20:35:09.567

这是一个简单（但不是非常快）的筛子实现：

```
-module(primes).
-export([sieve/1]).
-include_lib("eunit/include/eunit.hrl").

sieve([]) ->
    [];
sieve([H|T]) ->          
    List = lists:filter(fun(N) -> N rem H /= 0 end, T),
    [H|sieve(List)];
sieve(N) ->
    sieve(lists:seq(2,N)). 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-03-01T00:42:16.993

这是我的筛子实现，它使用列表推导并尝试尾递归。我在最后反转列表，以便对素数进行排序：

```
primes(Prime, Max, Primes,Integers) when Prime > Max ->
    lists:reverse([Prime|Primes]) ++ Integers;
primes(Prime, Max, Primes, Integers) ->
    [NewPrime|NewIntegers] = [ X || X <- Integers, X rem Prime =/= 0 ],
    primes(NewPrime, Max, [Prime|Primes], NewIntegers).

primes(N) ->
    primes(2, round(math:sqrt(N)), [], lists:seq(3,N,2)). % skip odds 
```

在我的 2ghz mac 上计算高达 2 百万的素数大约需要 2.8 毫秒。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-28T20:14:22.570

我通过使用并发处理来解决这个问题。

[来源](http://web.archive.org/web/20080911213200/http://refactormycode.com/codes/471-experimental-prime-number-generator)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-12-20T00:56:20.800

我之前的帖子格式不正确。这是代码的重新发布。对不起，垃圾邮件...

```
 -module(test).

%%-export([sum_primes/1]).
-compile(export_all).

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%Sum of all primes below Max. Will use sieve of Eratosthenes 
sum_primes(Max) ->
    LastCheck = round(math:sqrt(Max)),
    All = lists:seq(3, Max, 2), %note are creating odd-only array
    %%Primes = sieve(noref,All, LastCheck),
    Primes = spawn_sieve(All, LastCheck),
    lists:sum(Primes) + 2\. %adding back the number 2 to the list

%%sieve of Eratosthenes
sieve(Ref,All, LastCheck) ->
    sieve(Ref,[], All, LastCheck).

sieve(noref,Primes, All = [Cur|_], LastCheck) when Cur > LastCheck ->
    lists:reverse(Primes, All); %all known primes and all remaining from list (not sieved) are prime    
sieve({Pid,Ref},Primes, All=[Cur|_], LastCheck) when Cur > LastCheck ->
    Pid ! {Ref,lists:reverse(Primes, All)}; 
sieve(Ref,Primes, [Cur|All2], LastCheck) ->
    %%All3 = lists:filter(fun(X) -> X rem Cur =/= 0 end, All2),
    All3 = lists_filter(Cur,All2),
    sieve(Ref,[Cur|Primes], All3,  LastCheck).

lists_filter(Cur,All2) ->
    lists_filter(Cur,All2,[]).

lists_filter(V,[H|T],L) ->
    case H rem V of
    0 ->
        lists_filter(V,T,L);
    _ ->
        lists_filter(V,T,[H|L])
    end;
lists_filter(_,[],L) ->
    lists:reverse(L).

%% This is a sloppy implementation ;)
spawn_sieve(All,Last) ->
    %% split the job
    {L1,L2} = lists:split(round(length(All)/2),All),
    Filters = filters(All,Last),
    L3 = lists:append(Filters,L2),
    Pid = self(),
    Ref1=make_ref(),
    Ref2=make_ref(),
    erlang:spawn(?MODULE,sieve,[{Pid,Ref1},L1,Last]),
    erlang:spawn(?MODULE,sieve,[{Pid,Ref2},L3,Last]),
    Res1=receive
         {Ref1,R1} ->
         {1,R1};
         {Ref2,R1} ->
         {2,R1}
     end,
    Res2= receive
          {Ref1,R2} ->
          {1,R2};
          {Ref2,R2} ->
          {2,R2}
      end,
    apnd(Filters,Res1,Res2).

filters([H|T],Last) when H 
    [H|filters(T,Last)];
filters([H|_],_) ->
    [H];
filters(_,_) ->
    [].

apnd(Filters,{1,N1},{2,N2}) ->
    lists:append(N1,subtract(N2,Filters));
apnd(Filters,{2,N2},{1,N1}) ->
    lists:append(N1,subtract(N2,Filters)).

subtract([H|L],[H|T]) ->
    subtract(L,T);
subtract(L=[A|_],[B|_]) when A > B ->
    L;
subtract(L,[_|T]) ->
    subtract(L,T);
subtract(L,[]) ->
    L. 

```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-11-14T16:52:24.337

我没有详细研究过这些，但我已经在下面测试了我的实现（我为 Project Euler 挑战编写的），它比上述两个实现快几个数量级。在我消除了一些自定义函数并转而寻找列表之前，它非常缓慢：可以执行相同操作的函数。吸取教训总是看看是否有一个你需要做的事情的库实现是很好的——它通常会更快！这可以在 2.8GHz iMac 上计算 3.6 秒内最多 200 万的素数总和...

```
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%Sum of all primes below Max. Will use sieve of Eratosthenes 
sum_primes(Max) ->
    LastCheck = round(math:sqrt(Max)),
    All = lists:seq(3, Max, 2), %note are creating odd-only array
    Primes = sieve(All, Max, LastCheck),
    %io:format("Primes: ~p~n", [Primes]),
    lists:sum(Primes) + 2\. %adding back the number 2 to the list

%sieve of Eratosthenes
sieve(All, Max, LastCheck) ->
    sieve([], All, Max, LastCheck).

sieve(Primes, All, Max, LastCheck) ->
    %swap the first element of All onto Primes 
    [Cur|All2] = All,
    Primes2 = [Cur|Primes],
    case Cur > LastCheck of 
        true ->
            lists:append(Primes2, All2); %all known primes and all remaining from list (not sieved) are prime
        false -> 
            All3 = lists:filter(fun(X) -> X rem Cur =/= 0 end, All2),
            sieve(Primes2, All3, Max, LastCheck)

    end. 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-12-20T00:44:06.020

我有点喜欢这个主题，即素数，所以我开始稍微修改 BarryE 的代码，并通过创建自己的 lists_filter 函数使其速度提高了大约 70%，并且可以利用我的两个 CPU。我还可以轻松地在两个版本之间进行切换。测试运行显示：

```
61>计时器：tc（测试，sum_primes，[2000000]）。
{2458537,142913970581}

```

代码：

```

-模块（测试）。

%%-export([sum_primes/1])。
-编译（export_all）。

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% %
%% 低于 Max 的所有素数的总和。将使用埃拉托色尼筛
sum_primes（最大值）->
    LastCheck = round(数学:sqrt(Max)),
    All = lists:seq(3, Max, 2), %note 正在创建奇数数组
    %%Primes = 筛子(noref,All, LastCheck),
    Primes = spawn_sieve(All, LastCheck),
    lists:sum(Primes) + 2\. %将数字 2 添加到列表中

%%埃拉托色尼筛
筛子（参考，全部，最后检查）->
    筛子（参考，[]，所有，LastCheck）。

sieve(noref,Primes, All = [Cur|_], LastCheck) 当 Cur > LastCheck ->
    列表：反向（素数，全部）；%所有已知素数和列表中剩余的所有素数（未筛选）都是素数    
sieve({Pid,Ref},Primes, All=[Cur|_], LastCheck) 当 Cur > LastCheck ->
    皮德！{Ref,lists:reverse(Primes, All)};
筛子（参考，质数，[Cur|All2]，LastCheck）->
    %%All3 = lists:filter(fun(X) -> X rem Cur =/= 0 end, All2),
    All3 = lists_filter(Cur,All2),
    筛子（参考，[Cur|Primes]，All3，LastCheck）。

列表过滤器（Cur，All2）->
    列表过滤器（Cur，All2，[]）。

列表过滤器（V，[H|T]，L）->
    案例 H rem V 的
    0 ->
        列表过滤器（V，T，L）；
    _ ->
        列表过滤器（V，T，[H|L]）
    结尾;
列表过滤器（_，[]，L）->
    列表：反向（L）。

%% 这是一个草率的实现；）
spawn_sieve（全部，最后一个）->
    %% 拆分工作
    {L1,L2} = 列表：拆分（圆形（长度（全部）/2），全部），
    过滤器 = 过滤器（全部，最后一个），
    %%io:format("F:~p~n",[过滤器]),
    L3 = 列表：追加（过滤器，L2），
    %%io:format("L1:~w~n",[L1]),
    %% io:format("L2:~w~n",[L3]),
    %%lists_filter(Cur,All2,[])。
    PID =自我（），
    Ref1=make_ref(),
    Ref2=make_ref(),
    erlang:spawn(?MODULE,sieve,[{Pid,Ref1},L1,Last]),
    erlang:spawn(?MODULE,sieve,[{Pid,Ref2},L3,Last]),
    Res1=接收
         {Ref1,R1} ->
         {1,R1};
         {Ref2,R1} ->
         {2,R1}
     结尾，
    Res2=接收
          {Ref1,R2} ->
          {1,R2};
          {Ref2,R2} ->
          {2,R2}
      结尾，
    apnd（过滤器，Res1，Res2）。

过滤器([H|T],Last) 当 H
    [H|过滤器(T,Last)];
过滤器（[H|_]，_）->
    [H];
过滤器（_，_）->
    []。

apnd(过滤器,{1,N1},{2,N2}) ->
    列表：追加（N1，减（N2，过滤器））；
apnd(过滤器,{2,N2},{1,N1}) ->
    列表：追加（N1，减去（N2，过滤器））。

减([H|L],[H|T]) ->
    减（L，T）；
减(L=[A|_],[B|_]) 当 A > B ->
    大号;
减去（L，[_|T]）->
    减（L，T）；
减法（L，[]）->
    L.

```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2008-12-23T18:13:16.180

你可以给你的老板看这个：[http](http://www.sics.se/~joe/apachevsyaws.html) ://www.sics.se/~joe/apachevsyaws.html 。其他一些（经典？）erlang参数是：

- 不间断操作，可以动态加载新代码。

- 易于调试，不再需要分析核心转储。

- 易于使用多核/CPU

- 易于使用集群可能吗？

-谁想处理指针和东西？这不是21世纪吗？;)

一些缺陷： - 写东西可能看起来简单快捷，但性能可能很差。如果我想快速做一些事情，我通常最终会编写相同功能的 2-4 个不同版本。通常，您需要对可能与使用的问题略有不同的问题采取鹰眼态度。

*   在列表中查找 > 大约 1000 个元素的内容很慢，请尝试使用 ets 表。

*   字符串“abc”占用的空间比 3 个字节多得多。所以尝试使用二进制文件，（这很痛苦）。

总而言之，我认为在用 erlang 编写东西时，性能问题始终是需要牢记的。Erlang 的家伙需要解决这个问题，我认为他们会的。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-01-16T03:32:21.450

在这里查看 4 种不同的实现，用于在 Erlang 中查找素数（其中两个是“真正的”筛子）和性能测量结果：

> [http://caylespandon.blogspot.com/2009/01/in-euler-problem-10-we-are-asked-to.html](http://caylespandon.blogspot.com/2009/01/in-euler-problem-10-we-are-asked-to.html)

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-06-05T10:27:17.767

足够简单，完全实现算法，并且不使用库函数（仅模式匹配和列表理解）。确实不是很强大。我只是试图让它尽可能简单。

```
-module(primes).
-export([primes/1, primes/2]).

primes(X) -> sieve(range(2, X)).
primes(X, Y) -> remove(primes(X), primes(Y)).

range(X, X) -> [X];
range(X, Y) -> [X | range(X + 1, Y)].

sieve([X]) -> [X];
sieve([H | T]) -> [H | sieve(remove([H * X || X <-[H | T]], T))].

remove(_, []) -> [];
remove([H | X], [H | Y]) -> remove(X, Y);
remove(X, [H | Y]) -> [H | remove(X, Y)]. 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-02-27T21:06:09.093

这是我的 Eratophenes 实施 C&C 的筛子：

```
 -module(sieve).
    -export([find/2,mark/2,primes/1]).

    primes(N) -> [2|lists:reverse(primes(lists:seq(2,N),2,[]))].

    primes(_,0,[_|T]) -> T;
    primes(L,P,Primes) -> NewList = mark(L,P),
        NewP = find(NewList,P),
        primes(NewList,NewP,[NewP|Primes]).

    find([],_) -> 0;
    find([H|_],P) when H > P -> H;
    find([_|T],P) -> find(T,P). 

    mark(L,P) -> lists:reverse(mark(L,P,2,[])).

    mark([],_,_,NewList) -> NewList;
    mark([_|T],P,Counter,NewList) when Counter rem P =:= 0 -> mark(T,P,Counter+1,[P|NewList]);
    mark([H|T],P,Counter,NewList) -> mark(T,P,Counter+1,[H|NewList]). 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-01-31T21:28:17.417

这是我的样本

```
S = lists:seq(2,100),
lists:foldl(fun(A,X) -> X--[A] end,S,[Y||X<-S,Y<-S,X<math:sqrt(Y)+1,Y rem X==0]). 
```

:-)

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2008-10-14T22:32:41.777

到目前为止，我最快的代码（比 Andrea 的更快）是使用数组：

```
-module(seed4).
-export([get/1]).

get(N) -> WorkList = array:new([{size, N}, {default, empty}]),
          get(2, N, WorkList, []).

get(thats_the_end, _N, _WorkList, ResultList) -> lists:reverse(ResultList);
get(CurrentPrime, N, WorkList, ResultList) -> ModWorkList = markAsPrime(CurrentPrime, N, WorkList),
                                              NextPrime = findNextPrime(CurrentPrime + 1, N, WorkList),
                                              get(NextPrime, N, ModWorkList, [CurrentPrime|ResultList]).

markAsPrime(CurrentPrime, N, WorkList) when CurrentPrime =< N -> WorkListMod = replace(CurrentPrime, WorkList, prime),
                                                                 markAllMultiples(CurrentPrime, N, 2*CurrentPrime, WorkListMod).

markAllMultiples(_ThePrime, N, TheCurentMark, WorkList) when TheCurentMark > N -> WorkList;
markAllMultiples(ThePrime, N, TheCurrentMark, WorkList) -> WorkListMod = replace(TheCurrentMark, WorkList, marked),
                                                           markAllMultiples(ThePrime, N, TheCurrentMark + ThePrime, WorkListMod).

findNextPrime(Iterator, N, _WorkList) when Iterator > N -> thats_the_end;
findNextPrime(Iterator, N, WorkList) -> I = array:get(Iterator - 1, WorkList),
                                        if
                                          I =:= empty -> Iterator;
                                          true -> findNextPrime(Iterator + 1, N, WorkList)
                                        end.

replace(N, L, New) -> array:set(N - 1, New, L). 
```

# c - C 头文件循环

> ID：146657
> 
> 赞同：12
> 
> 时间：2008-09-28T20:26:52.977
> 
> 标签：c, include-guards

我有几个头文件，归结为：

树.h：

```
#include "element.h"

typedef struct tree_
{
    struct *tree_ first_child;
    struct *tree_ next_sibling;
    int tag;
    element *obj;
    ....
} tree; 
```

和元素.h：

```
#include "tree.h"

typedef struct element_
{
    tree *tree_parent;
    char *name;
    ...
} element; 
```

问题是它们都相互引用，所以树需要包含元素，元素需要树包含。

这不起作用，因为要定义“树”结构，元素结构必须是已知的，但要定义元素结构，树结构必须是已知的。

如何解决这些类型的循环（我认为这可能与“前向声明”有关？）？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2008-09-28T20:39:24.727

我认为这里的问题不是缺少包含保护，而是两个结构在定义中需要彼此。所以这是一个类型定义 hann 和 egg 问题。

在 C 或 C++ 中解决这些问题的方法是对类型进行前向声明。如果您告诉编译器元素是某种结构，编译器就能够生成指向它的指针。

例如

内部树.h：

```
// tell the compiler that element is a structure typedef:
typedef struct element_ element;

typedef struct tree_ tree;
struct tree_
{
    tree *first_child;
    tree *next_sibling;
    int tag;

    // now you can declare pointers to the structure.
    element *obj;
}; 
```

这样你就不必再在 tree.h 中包含 element.h 了。

您还应该在头文件周围放置包含防护。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2008-09-28T20:38:49.113

这里的关键观察是元素不需要知道树的结构，因为它只保存一个指向它的指针。树也是一样。每个人都需要知道的是存在具有相关名称的类型，而不是其中的内容。

所以在 tree.h 中，而不是：

```
#include "element.h" 
```

做：

```
typedef struct element_ element; 
```

这“声明”了“element”和“struct element_”类型（说它们存在），但没有“定义”它们（说它们是什么）。您需要存储一个指向 blah 的指针是声明 blah，而不是定义它。只有当您想尊重它（例如阅读成员）时，您才需要定义。“.c”文件中的代码需要这样做，但在这种情况下，您的标题不需要。

有些人创建一个单独的头文件，它前向声明一组头文件中的所有类型，然后每个头文件都包含它，而不是确定它真正需要的类型。这既不是必要的，也不是完全愚蠢的。

关于包含守卫的答案是错误的——它们通常是一个好主意，你应该阅读它们并给自己一些，但它们并不能特别解决你的问题。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2008-09-28T20:31:15.370

正确的答案是使用包含守卫，并使用前向声明。

## 包括警卫

```
/* begin foo.h */
#ifndef _FOO_H
#define _FOO_H

// Your code here

#endif
/* end foo.h */ 
```

Visual C++ 还支持#pragma once。它是一个非标准的预处理器指令。作为编译器可移植性的交换，您可以减少预处理器名称冲突的可能性并提高可读性。

## 前向声明

转发声明你的结构。如果没有明确需要结构或类的成员，您可以在头文件的开头声明它们的存在。

```
struct tree;    /* element.h */
struct element; /* tree.h    */ 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-28T20:39:22.073

阅读[前向声明](http://en.wikipedia.org/wiki/Forward_declaration)。

IE。

```
 // tree.h:
#ifndef TREE_H
#define TREE_H
struct element;
struct tree
{
    struct element *obj;
    ....
};

#endif

// element.h:
#ifndef ELEMENT_H
#define ELEMENT_H
struct tree;
struct element
{
    struct tree *tree_parent;
    ...
};
#endif 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T20:30:12.517

这些被称为“once-only headers”。请参阅[http://developer.apple.com/DOCUMENTATION/DeveloperTools/gcc-4.0.1/cpp/Once_002dOnly-Headers.html#Once_002dOnly-Headers](http://developer.apple.com/DOCUMENTATION/DeveloperTools/gcc-4.0.1/cpp/Once_002dOnly-Headers.html#Once_002dOnly-Headers)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-28T20:41:40.587

包含守卫很有用，但不能解决发布者的问题，即对两个数据结构的递归依赖。

这里的解决方案是将树和/或元素声明为头文件中结构的指针，因此您不需要包含 .h

就像是：

```
struct element_;
typedef struct element_ element; 
```

在 tree.h 的顶部应该足以消除包含 element.h 的需要

使用这样的部分声明，您只能使用不需要编译器了解布局的元素指针来执行操作。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-28T20:46:12.743

恕我直言，最好的方法是避免这种循环，因为它们是应该避免的物理耦合的迹象。

例如（据我所知）[“面向对象的设计启发式”](https://rads.stackoverflow.com/amzn/click/com/020163385X)旨在避免包含守卫，因为它们只掩盖循环（物理）依赖关系。

另一种方法是预先声明这样的结构：

```
`element.h:
struct tree_;
struct element_
  {
    struct tree_ *tree_parent;
    char *name;
  };

tree.h:
struct element_;
struct tree_
  {
    struct tree_* first_child;
    struct tree_* next_sibling;
    int tag;
    struct element_ *obj;
  };` 
```

* * *

 `## 回答 #8

> 赞同：0
> 
> 时间：2009-10-06T11:15:58.637

前向声明是您可以保证会有一个稍后将定义的结构的方式。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-11-13T00:52:14.057

我不喜欢前向声明，因为它们是多余的和错误的。如果您希望所有声明都在同一个地方，那么您应该使用包含保护的包含和头文件。

您应该将包含视为复制粘贴，当 c 预处理器找到 #include 行时，只需将 myheader.h 的全部内容放在找到 #include 行的相同位置。

好吧，如果您编写包含守卫，则 myheader.h 的代码将仅在找到第一个 #include 的位置粘贴一次。

如果您的程序使用多个目标文件进行编译并且问题仍然存在，那么您应该在目标文件之间使用前向声明（就像使用 extern），以便只保留所有目标文件的类型声明（编译器将所有声明混合在同一个表中，并且标识符必须是独一无二的）。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2017-04-03T03:36:05.907

一个简单的解决方案是没有单独的头文件。毕竟，如果它们相互依赖，你永远不会在没有另一个的情况下使用一个，那么为什么要分开它们呢？您可以拥有单独的 .c 文件，它们都使用相同的标头但提供更集中的功能。

我知道这并不能回答如何正确使用所有花哨的东西的问题，但是当我在寻找类似问题的快速解决方案时，我发现它很有帮助。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-09-23T15:01:42.553

这里有很多答案都提到了“包括警卫”和“前向声明”，但他们都没有真正打算解决 OP 目前面临的问题。第三个“.h”文件绝对不是答案。如果使用得当，“包括守卫”可以打破“`#include`循环”并最终导致更清洁的项目结构。`typedef`如果您已经有两个，为什么还要为 s 创建另一个头文件？你的头文件应该是这样的：

```
/* a.h - dependency of b.h */
#ifndef _A_H
#define _A_H

#include "b.h"

typedef struct a_p {
    b_t *b;
} a_t;

#endif // _A_H 
```

```
/* b.h - dependency of a.h */
#ifndef _B_H
#define _B_H

typedef struct b_p b_t;

/** 
 * !!!
 * to avoid recursion, only include "a.h" 
 * when "a.h" isn't included before
 */
#ifndef _A_H
    #include "a.h"
    typedef struct b_p {
        a_t a;
    } b_t;
#endif

#endif // _B_H 
```

要使用这两个头文件，您只需要`include`一个，即无条件包含另一个头文件的那个（在本例中为`a.h`）。但如果你愿意，你也可以包括“bh”。但无论如何它不会有任何区别（由于前向声明）。

```
#include "a.h"

int main() {
    a_t aigh;

    return 0;
} 
```

瞧！就是这个！没有多余`include`的，什么都没有。我们得到了em bois！

# javascript - 如何让浮动页脚粘在 IE 6 的视口底部？

> ID：146659
> 
> 赞同：12
> 
> 时间：2008-09-28T20:27:55.597
> 
> 标签：javascript, css, internet-explorer-6, sticky-footer

我知道使用 position:fixed 这很容易，但不幸的是我坚持支持 IE 6。我该怎么做？我宁愿使用 CSS 干净，但如果我必须使用 Javascript，那不是世界末日。在我当前的实现中，我有一个“浮动页脚”，它浮动在主要内容区域上方并使用 Javascript 定位。即使使用 Javascript，我现在的实现也不是特别优雅，所以我的问题是：

1.  有没有办法在没有 Javascript 的情况下做到这一点？
2.  如果我必须使用 Javascript，这个浮动页脚问题有什么“好”的解决方案吗？我所说的“好”是指可以跨浏览器工作的东西，不会使浏览器的资源过载（因为它必须经常重新计算），并且优雅/易于使用（即编写类似的东西会很好`new FloatingFooter("floatingDiv")`）。

我猜想没有超级简单的解决方案可以满足上述所有内容，但我可以建立的东西会很棒。

最后，只是一个更一般的问题。我知道这个问题很难解决，那么除了在每个页面底部都有页脚内容之外，还有其他 UI 替代方案吗？在我的特定站点上，我使用它来显示步骤之间的转换。我还有其他方法可以做到这一点吗？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2008-09-29T01:07:09.340

这可能对你有用。它适用于我的 IE6 和 Firefox 2.0.0.17。试一试。我把页脚的高度设置得很高，只是为了效果。您显然会将其更改为您需要的。我希望这对你有用。

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title>Liquid Footer</title>
    <style type="text/css">
    .footer {
background-color: #cdcdcd;
height: 180px;
text-align: center;
font-size:10px;
color:#CC0000;
font-family:Verdana;
padding-top: 10px;
width: 100%;
position:fixed;
left: 0px;
bottom: 0px;
}
    </style>
    <!--[if lte IE 6]>
    <style type="text/css">
    body {height:100%; overflow-y:auto;}
    html {overflow-x:auto; overflow-y:hidden;}
    * html .footer {position:absolute;}
    </style>
    <![endif]-->
</head>

<body>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   This is to expand the content on the page<br>
   <div class="footer">-- This is your liquid footer --</div>
</body>
</html> 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-05-24T21:51:37.963

如果您确实不想使用条件注释，以便可以将 css 放在单独的文件中，请使用`!important`. 像这样的东西：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<html>
    <head>
        <style>
            html {
                overflow-x: auto;
                overflow-y: scroll !important;
                overflow-y: hidden; /* ie6 value b/c !important ignored */
            }

            body {
                padding:0;
                margin:0;
                height: 100%;
                overflow-y: hidden !important;
                overflow-y: scroll; /* ie6 value b/c !important ignored */
            }

            #bottom {
                background-color:#ddd;
                position: fixed !important;
                position: absolute; /* ie6 value b/c !important ignored */
                width: 100%;
                bottom: 0px;
                z-index: 5;
                height:100px;
            }
            #content {
                font-size: 50px;
            }
        </style>
    </head> 
    <body>
        <div id="bottom">
            keep this text in the viewport at all times
        </div>
        <div id="content">
            Let's create enough content to force scroll bar to appear.
            Then we can ensure this works when content overflows.
            One quick way to do this is to give this text a large font
            and throw on some extra line breaks.
            <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
            <br/><br/><br/><br/><br/><br/><br/><br/>    
        </div>  
    </body> 
</html> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-28T20:37:44.653

我过去曾使用 CSS 表达式完成此操作。

尝试这样的事情：

```
.footer {
    position: absolute;
    top: expression((document.body.clientHeight - myFooterheight) + "px");
} 
```

[在这里和这里](http://gadgetopia.com/post/2774)[阅读更多](http://archivist.incutio.com/viewlist/css-discuss/44263)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-10-31T07:10:20.947

```
$(function(){
    positionFooter(); 
    function positionFooter(){
        if($(document).height() < $(window).height()){//Without the body height conditional the footer will always stick to the bottom of the window, regardless of the body height, $(document).height() - could be main container/wrapper like $("#main").height() it depend on your code
            $("#footer").css({position: "absolute",top:($(window).scrollTop()+$(window).height()-$("#footer").height())+"px"})
        }   
    }

    $(window).scroll(positionFooter);
    $(window).resize(positionFooter);
}); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T21:53:10.877

如果你把`height`to`100%`和`overflow: auto`to `<html/>`and`<body/>`标签放在一起，任何具有绝对位置的东西都将变得固定。它最基本的是非常时髦，带有奇怪的滚动条，但可以调整到不错的结果。例子

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
    <head>
        <style>
            html, body
            {
                height: 100%;
                overflow: auto;
            }

            .fixed
            {
                position: absolute;
                bottom: 0px;
                height: 40px;
                background: blue;
                width: 100%;
            }
        </style>
    </head>
    <body>
        <div class="fixed"></div>
        overflow....<br />
        overflow....<br />
        overflow....<br />
        overflow....<br />
        overflow....<br />
        overflow....<br />
        overflow....<br />
        overflow....<br />
        overflow....<br /><!-- ... -->
    </body>
</html> 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2008-09-28T20:52:11.903

如果页脚有固定高度并且你知道它并且可以在 CSS 中对其进行硬编码，你可以这样做：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head>
        <style>
        .content
        {
            position : absolute;
            top : 0;
            left : 0;
            right : 0;
            bottom : 50px; /* that's the height of the footer */
            overflow : auto;
            background-color : blue;
        }
        .footer
        {
            position : absolute;
            left : 0;
            right : 0;
            bottom : 0px; /* that's the height of the footer */
    height : 50px;
            overflow : hidden;
            background-color : green;
        }
        </style>
    </head>
    <body>
        <div class="content">
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
             everything from the page goes here
        </div>
        <div class="footer">
             the footer
        </div>
    </body>
</html> 
```

# apache-flex - 如何使用 Maven 构建 Adob e Air 项目？

> ID：146661
> 
> 赞同：8
> 
> 时间：2008-09-28T20:28:33.177
> 
> 标签：apache-flex, maven-2, air, adobe

有人用 Maven 成功构建了 Adob​​e Air 应用程序吗？如果是这样，让它工作的步骤是什么？

我一直在尝试使用[flex-mojos](http://code.google.com/p/flex-mojos/)来构建一个 Air 应用程序。[当我按照DashboardSamplePom](http://code.google.com/p/flex-mojos/wiki/DashboardSamplePom)中的建议将包装类型设置为“aswf”时，Maven 抱怨 aswf 是未知的包装类型。我还找到了他们的[air-super-pom](http://svn.sonatype.org/flexmojos/repository/info/flex-mojos/air-super-pom/2.0-alpha4/air-super-pom-2.0-alpha4.pom)，但不知道如何将其引用为我的 POM 的父级。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-28T20:38:33.217

当一个插件声明一个新的封装类型时，比如'aswf'，你需要将它声明为一个扩展。在您的顶级 pom 中，将 extensions 元素添加到插件配置中。

```
<plugin>
  <groupId>...</groupId>
  <artifactId>...</artifactId>
  <extensions>true</extensions>
...
</plugin> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-08-20T20:51:25.977

mojos 网站 wiki 上有一篇名为[Building an AIR Application的文章。](https://docs.sonatype.org/display/FLEXMOJOS/Building+an+AIR+Application)它应该能够帮助你。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-26T01:18:49.300

我也一直在寻找这个问题的答案。有几个网站已经证明很有帮助，尽管我还没有完整的解决方案。

检查这些是否有可能的线索：

*   [http://blogs.citytechinc.com/bgloff/?p=17](http://blogs.citytechinc.com/bgloff/?p=17)
*   [http://jchristie.wordpress.com/2009/01/11/compiling-an-air-application-with-maven-and-flex-mojos/](http://jchristie.wordpress.com/2009/01/11/compiling-an-air-application-with-maven-and-flex-mojos/)

至于打包类型，我发现的大多数信息表明，您需要使用 swf，然后通过创建 exec tax 来调用 adt 将编译后的 swf 转换为您的 air 可执行文件，而不是使用 aswf 作为包类型.jar 上面的链接将向您展示如何做到这一点。

至于你找到的空气超级 pom，我认为有几个不同的......但是要使用任何超级 pom，你需要让你的 flex maven 项目将超级 pom 声明为父级，并带有类似于此的块：

```
<parent>
    <groupId>org.sonatype.flexmojos</groupId>
    <artifactId>flexmojos-air-super-pom</artifactId>
    <version>3.1-SNAPSHOT</version>
</parent> 
```

然而，仅仅扩展父 pom 可能不足以构建您的 swf - 再次，请参阅上面的链接以更详细地处理此问题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2014-12-14T10:23:27.707

我创建了一个 AIR Maven 模板，你可以在这个 github 项目中找到详细信息：[https](https://github.com/branscha/tmplt-airapp) ://github.com/branscha/tmplt-airapp 。这个问题已经很老了，所以我的解决方案中的版本/框架可能不再适合你了。在过去几年中，Flex/Air 的情况发生了很大变化。

我的解决方案的特点：

1.  我使用 Mavenized Apache SDK (13.0)，您可能应该为您的项目做同样的事情以独立于外部 Maven 存储库。mavenize SDK 的过程并不太难。
2.  Flexmojos 6.0.1
3.  hello-world 应用程序可以变成安卓应用程序。
4.  包装是“空气”（上面提到的iso aswf）

* * *

## 回答 #5

> 赞同：-2
> 
> 时间：2011-10-22T22:53:39.617

在我的例子中，我只是使用 org.graniteds.archetypes graniteds-tide-seam-jpa-hibernate 原型创建了一个新的 maven 项目并得到了这个错误。我对 flex 一无所知，只是想要一个使用 Seam 的示例项目。这似乎是一个不错的候选人。但我明白了

未知包装类型：swf

即使 <extensions>true<extensions> 存在于生成的 POM 文件的插件定义中。

我在其他地方读到这需要 Maven 的 beta 版本。为什么 sonatype 允许在其存储库中依赖于 maven Beta 版本的原型？

# ruby - 如何解析可能有前导零的字符串中的数字？

> ID：146668
> 
> 赞同：8
> 
> 时间：2008-09-28T20:30:35.717
> 
> 标签：ruby, string, date, types

在 ruby​​ 中，我正在解析以下格式的日期：24092008。我想将每个部分（年、月、日）转换为数字。

我使用生成三个字符串的正则表达式将它们拆分，我将它们传递给 Integer 构造函数。

```
 date =~ /^([\d]{2})([\d]{2})([\d]{4})/
  year = Integer($3)
  month = Integer($2)
  day = Integer($1) 
```

当它到达月线时，它崩溃如下：

```
`Integer': invalid value for Integer: "09" (ArgumentError) 
```

我花了一段时间才意识到它将前导零解释为八进制，而 09 不是有效的八进制数（它可以与“07”一起正常工作）。

有没有一个优雅的解决方案，或者我应该只测试小于 10 的数字并首先删除零？

谢谢。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2008-09-28T20:36:02.363

我不熟悉正则表达式，所以如果这个答案离题，请原谅我。我一直假设 $3、$2 和 $1 是字符串。这是我在 IRB 中复制问题的方法：

```
irb(main):003:0> Integer("04")
=> 4
irb(main):004:0> Integer("09")
ArgumentError: invalid value for Integer: "09"
    from (irb):4:in `Integer'
    from (irb):4
    from :0 
```

但看起来 .to_i 没有同样的问题：

```
irb(main):005:0> "04".to_i
=> 4
irb(main):006:0> "09".to_i
=> 9 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2015-07-22T14:40:08.387

# 指定基数 10

明确地告诉 Ruby 你想将字符串解释为以 10 为底的数字。

```
Integer("09", 10) # => 9 
```

这**比`.to_i`你想要严格**要好。

```
"123abc".to_i # => 123
Integer("123abc", 10) # => ArgumentError 
```

## 我是怎么想出来的

在`irb`，`method(:Integer)`返回`#<Method: Object(Kernel)#Integer>`。这告诉我`Kernel`拥有这个方法，我在内核上查找了文档。[方法签名](http://ruby-doc.org/core-2.2.2/Kernel.html#method-i-Integer)表明它需要一个基数作为第二个参数。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T20:52:03.370

也许`(0([\d])|([1-9][\d]))`代替`([\d]{2})` You 可能不得不使用 $2、$4 和 $5 代替 $1、$2、$3。

或者，如果您的正则表达式支持`(?:...)`，则使用`(?:0([\d])|([1-9][\d]))`

由于 ruby​​ 从 perl 中获取其正则表达式，因此后一个版本应该可以工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2022-02-09T08:12:49.130

而不是直接检查任何带有前导 0 的整数。例如：

`Integer("08016") #=> ArgumentError: invalid value for Integer(): "08016"`

创建一个方法来检查和救援前导 0：

```
def is_numeric(data)
  _is_numeric = true if Integer(data) rescue false

  # To deal with Integers with leading 0
  if !_is_numeric
    _is_numeric = data.split("").all?{|q| Integer(q.to_i).to_s == q }
  end

  _is_numeric
end 
```

> is_numeric("08016") #=> true is_numeric("A8016") #=> false

# deployment - Glassfish：在域中部署应用程序失败；加载部署描述符时出错 - 无效位长度重复

> ID：146700
> 
> 赞同：1
> 
> 时间：2008-09-28T20:42:55.217
> 
> 标签：deployment, glassfish, deployment-descriptor

我正在尝试通过服务器的 Web 界面部署 .war。使用 IDEA 将其部署为展开目录时出现相同的错误。这个问题的解决方案是什么？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-04-16T10:52:02.337

该消息指向 java.util.zip 中的一个异常，因此暗示了一个损坏的打包文件。也许您可以尝试重建war文件。

# lua - _VERSION 是 Lua 5.1 中唯一剩下的全局变量吗？

> ID：146704
> 
> 赞同：2
> 
> 时间：2008-09-28T20:44:28.677
> 
> 标签：lua

对 Lua 5.0 文档中对 , 等的引用感到困惑`_LOADED`（`LUA_PATH`我`_ALERT`无法在 Lua 5.1 中使用），我发现所有这些都已被删除，而功能则放在了别处。我认为 Lua 5.1 中剩下的唯一一个全局变量是正确的`_VERSION`吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-28T20:51:07.630

文档似乎认为情况**几乎**如此......

> _G 保存全局环境的全局变量（不是函数）（即 _G._G = _G）。Lua 本身不使用这个变量；更改其值不会影响任何环境，反之亦然。（使用 setfenv 改变环境。）

看起来也有 _PROMPT 和 _PROMPT2，但仅在交互使用独立 lua 时：

> 如果全局变量 _PROMPT 包含一个字符串，那么它的值将用作提示。同样，如果全局变量 _PROMPT2 包含一个字符串，则它的值用作辅助提示（在不完整的语句期间发出）。因此，可以直接在命令行上或在任何 Lua 程序中通过分配给 _PROMPT 来更改这两个提示。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-28T21:15:06.560

假设您不打开***任何***库，还有`_G`,和.`pairs``ipairs``newproxy`

# java - 使用 serialVersionUID 还是禁止警告？

> ID：146715
> 
> 赞同：72
> 
> 时间：2008-09-28T20:51:05.213
> 
> 标签：java, serialization, serialversionuid

我想创建一个类，例如，扩展 HttpServlet？我的编译器警告我，我的类应该有一个 serialVersionUID。如果我知道这个对象永远不会被序列化，我应该定义它还是添加注释来禁止这些警告？

你会做什么，为什么？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2008-09-28T21:12:12.807

我不知道 Java 的最佳实践，但我突然想到，如果你声称序列化永远不会发生，你可以添加一个 writeObject 方法来抛出。然后压制警告，安全地知道它不可能适用于你。

否则，将来有人可能会通过父类序列化您的对象，并以默认的序列化形式结束，其中：

*   该表单在您的代码的不同版本之间不兼容。
*   你已经压制了这种情况的警告。

添加一个 ID 听起来像是一个麻烦，因为你真正想要做的不是序列化。期望调用者不序列化您的对象意味着您期望他们“知道”他们的 HttpServlet 何时属于您的类。由于拥有一个不能序列化的可序列化对象，多态性的破坏就在你的头上，你至少可以确保粗心的调用者知道它。

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2008-09-28T20:58:12.450

如果您不打算序列化实例，请添加 SuppressWarning。

生成的序列号可能有点危险。它建议您故意给它一个序列号，并且可以保存序列化和反序列化。在更改了类的较新版本的应用程序中，很容易忘记更新序列号。如果类字段已更改，反序列化将失败。拥有 SuppressWarning 至少可以告诉读者您的代码您不打算序列化此类。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2008-09-28T21:35:23.343

我拒绝被 Eclipse 恐吓而使我的代码变得混乱！

我只是将 Eclipse 配置为在缺少 serialVersionUID 时不生成警告。

* * *

## 回答 #4

> 赞同：12
> 
> 时间：2010-05-14T03:24:32.910

感谢@Steve Jessop 对此的回答。这是 5 行代码......几乎没有什么麻烦。

我`@SuppressWarnings("serial")`在有问题的班级上方添加了。

我还添加了这个方法：

```
private void writeObject(ObjectOutputStream oos) throws IOException {
   throw new IOException("This class is NOT serializable.");
} 
```

希望这就是史蒂夫的意思:)

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2008-09-28T21:55:46.417

即使您知道该对象将被序列化，也无需生成 serialVersionUID，因为 java 会自动为您生成它并自动跟踪更改，因此您的序列化将始终正常工作。仅当您知道自己在做什么时才应该生成它（向后序列化兼容性、手动更改跟踪等）

所以我想说在大多数情况下抑制警告是最好和最安全的解决方案。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2008-09-29T14:02:31.990

最好为**每个**实现可序列化的类生成 SVUID。原因很简单。你**永远不**知道它什么时候会被你或某个第 3 方序列化。可以配置许多将序列化 servlet 的服务。对于每个 IDE 存在的插件，它生成一个或只使用模板并设置 svuid = 1L。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2008-09-28T21:29:06.323

这个警告让我发疯，因为每次你将 Swing 类子类化时，你*都知道*你永远不会序列化它，但是有那个愚蠢的警告。但是，是的，我让 Eclipse 生成一个。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2008-09-28T20:52:52.837

让 Eclipse 生成一个 ID。快捷方便。警告不容忽视。如果您遇到对象 /has/ 被序列化的地步，也可以为您节省很多麻烦。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2008-09-29T09:59:41.620

如果您遗漏了 serialVersionUID，java 将在编译时为该类生成一个（每次编译都会更改）。

反序列化对象时，将反序列化对象的 serialVersionUID 与 jvm 中的类进行比较。如果它们不同，则认为它们不兼容并抛出异常。例如，在升级程序和反序列化旧类之后，可能会发生这种情况。

我总是使用 1L 作为serialversionUID。它不会受到伤害（与默认生成的相比），并且它仍然保留稍后通过增加 id 来破坏兼容性的选项。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-06-08T02:48:21.517

这取决于。

如果您使用不同的编译器多次编译源代码，则编译后的代码可能具有不同的序列化 ID，这会破坏序列化。然后，您需要在代码中明确地坚持一个常量 serializationId。它必须是静态的、最终的和每个类（不可继承）。

但是，如果您总是使用特定的编译器编译您的代码，并且总是一次性将您的代码部署到您的所有 VM，您可能需要严格的版本检查，并希望确保任何时候只有一个版本的代码在运行，在在这种情况下，你应该压制警告。因此，如果 VM 未成功部署并且正在运行旧版本的代码，您可能希望在序列化期间出现异常，而不是怪异的反序列化对象。这恰好是我的情况，我们曾经有一个非常大的集群，我们需要严格的版本检查来找出任何部署问题。

无论如何，您可能应该尽可能避免序列化，因为与协议缓冲区或节俭相比，默认序列化非常慢，并且不支持跨语言互操作性。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-17T17:23:22.380

请点击此链接获取详细说明：[http ://technologiquepanorama.wordpress.com/2009/02/13/what-is-use-of-serialversioid/](http://technologiquepanorama.wordpress.com/2009/02/13/what-is-use-of-serialversiouid/)

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2015-12-15T11:01:44.243

如果您知道您的应用程序从不序列化事物，请在应用程序范围内抑制警告。这可以使用 javac 命令行参数来完成：

`javac -Xlint -Xlint:-serial *******`

这样，您将收到除“串行”之外的所有警告。IDE-s 和 Maven/SBT/Gradle 等构建工具可以正常工作。

# ergonomics - 使用平板电脑而非鼠标进行开发

> ID：146730
> 
> 赞同：3
> 
> 时间：2008-09-28T21:04:39.237
> 
> 标签：ergonomics

Lifehacker 几天前发布了一篇帖子，询问人们[你曾经拥有过的最好的鼠标](http://lifehacker.com/5054519/)，似乎有些人已经将鼠标换成了平板电脑。

我很好奇这里是否有人将鼠标换成平板电脑？它对开发有用吗？从尝试过或正在使用它的人那里寻找利弊。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-28T21:10:21.377

对于开发，我倾向于在用于打字和快捷键的键盘和用于指向事物的鼠标之间切换。鉴于这种情况：

我从每个使用它的人那里听到了对这种方法的赞誉。他们说戴在手腕上更轻松，感觉更自然，而且一旦习惯了，就不可能不错过它。足够强烈的赞美，我计划在接下来的两张薪水中转换。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T21:13:30.683

我赞同 Dan Udey 所说的话。我可以毫不费力地切换到平板电脑，而且在编程时我很少使用指针，这是一种祝福。一个简单的例子：通过拖动滚动条在长列表中滚动似乎比鼠标更自然。

作为一个额外的好处，当我在小项目上处于“图形艺术家”模式时，平板电脑是一个明显的胜利。

Spodi：我同意键盘的快捷键，所以我在鼠标或平板电脑上使用的唯一按钮是第一个和第二个，这两个按钮都可以在笔上使用；我不确定您通过查看平板电脑单击按钮是什么意思。至于拿到鼠标的速度，我把笔夹在右手的两根手指之间，所以它一直就在那儿。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T21:18:03.057

我非常爱他们，我的桌子上有 2 个。你根本不会出错，我唯一需要/使用鼠标的时间就是玩游戏，我希望我可以使用平板电脑。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-28T21:18:30.890

我非常不喜欢使用平板电脑进行编程。我什至有一台从我女朋友那里“永久借来”的平板笔记本电脑，甚至将它用于编程的任何方面的想法都让我感到畏缩。

我的左手总是在键盘上，而我的右手则在鼠标之间跳来跳去。因为左手一直在键盘上，所以它也是执行快捷键最合乎逻辑的手。由于笔，平板电脑缺乏“快速切换”的便利性。即使您不必使用笔，也不太可能达到切换到平板电脑的相同速度，轻微移动，然后切换回来，就像使用鼠标一样。

最后，即使您使用平板电脑的速度与使用鼠标一样快，按钮的位置也不太方便。点击按钮时谁在看他们的鼠标？我希望没有人。现在，谁在看他们的平板电脑？嗯，我看到更多的手在空中。

如果平板电脑适合您，那么当然，去吧。但是，您必须在鼠标方面做得很差，才能在平板电脑上做得更好。

如果您想要切换或已经切换的原因是为了舒适，要么买一个新鼠标，一个（通常是凝胶状的）腕托，要么重新定位自己。有解决不适的方法，它不是平板电脑的形式。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-28T21:41:59.787

几年来，我一直使用小型 Wacom 数位板作为我的主要“鼠标”。我发现这款平板电脑非常自然，甚至习惯了将手写笔夹在我的手指间打字。（无论如何，我都没有输入“正确的手指在本行”的方式，所以调整并不大）

我确实发现我在使用键盘进行大多数导航方面做得更好，因为当我放下手写笔时，我不想把它捡起来。

因为我有一个更便宜的平板电脑，经过几年的使用，保护性塑料有一个网格划痕，这使得精确的鼠标移动有时变得更加困难（作为一名网络开发人员，我已经完成了我的快速图形设计部分） . 最终，它到了我需要更换它的地步，而不是把钱花在新的平板电脑上，我买了一个新的光学鼠标，因为当时我非常喜欢 Counterstrike，并且无法证明购买一个只会让一个人受益的输入是合理的我的痴迷。

总的来说，我并没有真正注意到任何很大的好处或坏处。这只是使用计算机的一种不同方式。

对于批评点击平板电脑上的按钮..我使用的触控笔内置了点击/右键点击功能。什么都不找。。

# sql-server - 我应该使用 SSIS 还是多线程 C# 应用程序将平面文件加载到数据库中？

> ID：146732
> 
> 赞同：2
> 
> 时间：2008-09-28T21:05:22.527
> 
> 标签：sql-server, ssis, bulkinsert

在 SQL Server Integration Services (SSIS) 中，可以设置与可容纳数百万条记录的平面文件的连接，并将该数据推送到 SQL DB。此外，可以通过引用和使用 Microsoft.SqlServer.Dts.Runtime 命名空间从 C# 应用程序调用此过程。

最好使用 SSIS 运行具有数百万条记录的平面文件，还是集体“你”更喜欢具有多个工作线程的 ac# 应用程序（一个用于读取行并将行添加到变量，一个用于从该变量写入数据库） ，以及管理这些线程的“母亲”类？（开发盒有两个cpu）

我看过这个数据（[sql team blog](http://weblogs.sqlteam.com/mladenp/articles/10631.aspx)），说明对于一个有一百万行的平面文件，SSIS 是最快的：

```
Process                Duration (ms)
--------------------   -------------
SSIS - FastParse ON         7322 ms 
SSIS - FastParse OFF        8387 ms 
Bulk Insert                10534 ms 
OpenRowset                 10687 ms 
BCP                        14922 ms 
```

你怎么认为？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-28T21:16:02.657

我只能代表我自己和我的经历。我会选择 SSIS，因为这是您可能不必要地重新发明轮子的情况之一。这是 SSIS 已经解决的重复性任务。

我每天管理大约 57 个工作（DTS 和 SSIS 的组合）。其中四个通常处理 5 到 1 亿条记录的导出。我管理的数据库有大约 20 亿行。我使用了一个脚本任务来追加日期，精确到毫秒，这样我就可以一天运行几次作业。现在已经这样做了大约 22 个月。太棒了！

也可以安排 SSIS 作业。所以你可以设置它并忘记它。我每天都会监控一切，但文件处理部分从未发生过故障。

唯一一次我不得不求助于自定义 C# 程序，是当我需要将非常大的文件拆分成更小的块时。SSIS 对这类东西很慢。使用脚本任务拆分一个演出文本文件大约需要一小时。C# 自定义程序在 12 分钟内处理了这个问题。

最后，只使用你觉得舒服的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T21:13:29.903

SSIS 非常快。此外，如果需要重复发生某些事情，您可以设置一个代理以按时将其触发。自己编写是一回事，尝试使其多线程变得比最初看起来要复杂得多。

十次中有九次我会推荐 SSIS。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T21:16:39.550

在这种情况下，我看不出使用多线程如何提高性能。在传输大量数据时，主要瓶颈通常是磁盘 I/O。产生多个线程并不能解决这个问题，我猜这会使事情变得更糟，因为它会在访问数据库的多个进程之间引入锁定争用。

# php - PHP 中的闭包...它们究竟是什么以及何时需要使用它们？

> ID：146737
> 
> 赞同：87
> 
> 时间：2008-09-28T21:06:09.390
> 
> 标签：php, oop, closures

所以我正在以一种不错的、最新的、面向对象的方式进行编程。我经常使用 PHP 实现的 OOP 的各个方面，但我想知道什么时候需要使用闭包。有没有专家可以阐明何时实施闭包有用？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2008-09-30T14:41:40.093

PHP 将在 5.3 中原生支持闭包。当您想要一个仅用于一些小的、特定目的的本地函数时，闭包是很好的选择。闭包的[RFC](http://wiki.php.net/rfc/closures)给出了一个很好的例子：

```
function replace_spaces ($text) {
    $replacement = function ($matches) {
        return str_replace ($matches[1], ' ', '&nbsp;').' ';
    };
    return preg_replace_callback ('/( +) /', $replacement, $text);
} 
```

这使您可以`replacement`在内部本地定义函数`replace_spaces()`，这样就不会：
**1）**弄乱全局名称空间
**2）**让人们在三年后想知道为什么全局定义的函数只在另一个函数内部使用

它使事情井井有条。请注意函数本身没有名称，它只是被定义并分配为对`$replacement`.

但请记住，您必须等待 PHP 5.3 :)

您还可以使用关键字将其范围之外的变量访问到闭包中`use`。考虑这个例子。

```
// Set a multiplier  
 $multiplier = 3;

// Create a list of numbers  
 $numbers = array(1,2,3,4);

// Use array_walk to iterate  
 // through the list and multiply  
 array_walk($numbers, function($number) use($multiplier){  
 echo $number * $multiplier;  
 }); 
```

这里给出了一个很好的解释[什么是php lambdas和闭包](https://www.culttt.com/2013/03/25/what-are-php-lambdas-and-closures/)

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-28T21:23:06.183

当您将来需要一个功能来执行您现在决定的任务时。

例如，如果您读取一个配置文件并且其中一个参数告诉`hash_method`您算法的 是`multiply`而不是`square`，您可以创建一个闭包，该闭包将在您需要散列某些内容的任何地方使用。

可以在（例如）中创建闭包`config_parser()`；它创建一个`do_hash_method()`使用本地变量调用的函数`config_parser()`（来自配置文件）。每当`do_hash_method()`被调用时，它都可以访问本地范围内的变量，`config_parser()`即使它没有在该范围内被调用。

希望是一个很好的假设示例：

```
function config_parser()
{
    // Do some code here
    // $hash_method is in config_parser() local scope
    $hash_method = 'multiply';

    if ($hashing_enabled)
    {
        function do_hash_method($var)
        {
            // $hash_method is from the parent's local scope
            if ($hash_method == 'multiply')
                return $var * $var;
            else
                return $var ^ $var;
        }
    }
}

function hashme($val)
{
    // do_hash_method still knows about $hash_method
    // even though it's not in the local scope anymore
    $val = do_hash_method($val)
} 
```

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-28T22:22:09.817

除了技术细节之外，闭包是被称为面向函数编程的编程风格的基本先决条件。闭包的用途与在面向对象编程中使用对象大致相同。它将数据（变量）与一些代码（一个函数）绑定在一起，然后您可以将其传递到其他地方。因此，它们会影响您编写程序的方式，或者——如果你不改变编写程序的方式——它们根本没有任何影响。

在 PHP 的上下文中，它们有点奇怪，因为 PHP 已经很重基于类、面向对象的范式以及较旧的过程范式。通常，具有闭包的语言具有完整的词法范围。为了保持向后兼容性，PHP 不会实现这一点，这意味着这里的闭包将与其他语言有所不同。我认为我们还没有确切地看到它们将如何被使用。

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-29T00:44:24.047

我喜欢 troelskn 的帖子提供的上下文。当我想在 PHP 中做类似 Dan Udey 的示例时，我使用 OO 策略模式。在我看来，这比引入一个行为在运行时确定的新全局函数要好得多。

[http://en.wikipedia.org/wiki/Strategy_pattern](http://en.wikipedia.org/wiki/Strategy_pattern)

您还可以使用 PHP 中保存方法名称的变量来调用函数和方法，这很棒。所以对丹的例子的另一种看法是这样的：

```
class ConfigurableEncoder{
        private $algorithm = 'multiply';  //default is multiply

        public function encode($x){
                return call_user_func(array($this,$this->algorithm),$x);
        }

        public function multiply($x){
                return $x * 5;
        }

        public function add($x){
                return $x + 5;
        }

        public function setAlgorithm($algName){
                switch(strtolower($algName)){
                        case 'add':
                                $this->algorithm = 'add';
                                break;
                        case 'multiply':        //fall through
                        default:                //default is multiply
                                $this->algorithm = 'multiply';
                                break;
                }
        }
}

$raw = 5;
$encoder = new ConfigurableEncoder();                           // set to multiply
echo "raw: $raw\n";                                             // 5
echo "multiply: " . $encoder->encode($raw) . "\n";              // 25
$encoder->setAlgorithm('add');
echo "add: " . $encoder->encode($raw) . "\n";                   // 10 
```

当然，如果您希望它随处可用，您可以将所有内容都设为静态...

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2014-08-25T18:46:55.770

闭包基本上是一个函数，您在一个上下文中为其编写定义但在另一个上下文中运行。Javascript 在理解这些方面帮助了我很多，因为它们在 JavaScript 中无处不在。

在 PHP 中，由于函数内部“全局”（或“外部”）变量的范围和可访问性不同，它们不如 JavaScript 有效。然而，从 PHP 5.4 开始，闭包可以在对象内部运行时访问 $this 对象，这使得它们更加有效。

这就是闭包的意义所在，理解上面写的内容应该就足够了。

这意味着应该可以在某处编写函数定义，并在函数定义中使用 $this 变量，然后将函数定义分配给变量（其他人已经给出了语法示例），然后将此变量传递给对象并在对象上下文中调用它，然后该函数可以通过 $this 访问和操作对象，就好像它只是它的另一个方法一样，而实际上它不是在该对象的类定义中定义的，而是在其他地方定义的。

如果不是很清楚，请不要担心，一旦开始使用它们就会变得清晰。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2019-03-04T10:49:21.623

基本上，闭包是可以访问外部变量的内部函数，并用作匿名函数（没有任何名称的函数）的回调函数。

```
 <?php
      $param='ironman';
      function sayhello(){
          $param='captain';
          $func=function () use ($param){
                $param='spiderman';
          };
       $func();
       echo  $param;
       }
      sayhello();
?>

//output captain

//and if we pass variable as a reference as(&$param) then output would be spider man; 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2020-12-11T13:30:52.320

**闭包：**

MDN 对 IMO 有最好的解释：

> 闭包是捆绑在一起（封闭）的函数与对其周围状态（词法环境）的引用的组合。换句话说，闭包使您可以从内部函数访问外部函数的范围。

即闭包是一个可以访问父作用域中的变量的函数。闭包允许我们方便地动态创建函数，因为在某些情况下，函数只需要在一个地方（回调、可调用参数）。

**例子：**

```
$arr = [1,2,3,3];
$outersScopeNr = 2;

// The second arg in array_filter is a closure
// It would be inconvenient to have this function in global namespace
// The use keyword lets us access a variable in an outer scope
$newArr = array_filter($arr, function ($el) use ($outersScopeNr) {
    return $el === 3 || $el === $outersScopeNr;
});

var_dump($newArr);
// array (size=3)
//  1 => int 2
//  2 => int 3
//  3 => int 3 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2017-08-28T14:35:43.370

**以下是 php 中的闭包示例**

```
// Author: HishamDalal@gamil.com
// Publish on: 2017-08-28

class users
{
    private $users = null;
    private $i = 5;

    function __construct(){
        // Get users from database
        $this->users = array('a', 'b', 'c', 'd', 'e', 'f');
    }

    function displayUsers($callback){
        for($n=0; $n<=$this->i; $n++){
            echo  $callback($this->users[$n], $n);
        }
    }

    function showUsers($callback){
        return $callback($this->users);

    }

    function getUserByID($id, $callback){
        $user = isset($this->users[$id]) ? $this->users[$id] : null;
        return $callback($user);
    }

}

$u = new users();

$u->displayUsers(function($username, $userID){
    echo "$userID -> $username<br>";
});

$u->showUsers(function($users){
    foreach($users as $user){
        echo strtoupper($user).' ';
    }

});

$x = $u->getUserByID(2, function($user){

    return "<h1>$user</h1>";
});

echo ($x); 
```

**输出：**

```
0 -> a
1 -> b
2 -> c
3 -> d
4 -> e
5 -> f

A B C D E F 

c 
```

# cycle - 如何以编程方式循环路由器？

> ID：146741
> 
> 赞同：4
> 
> 时间：2008-09-28T21:09:09.913
> 
> 标签：cycle, router

我需要能够通过程序循环我的linksys路由器，我想这样做的原因很复杂，所以让我们假设没有更好的选择。

有没有办法做到这一点？我认为这是因为当我通过管理控制台将固件更新安装到路由器时，它会循环路由器。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-28T21:14:07.827

如果您可以在路由器的 Web 界面上找到执行此操作的功能，您可以通过合适的 HTTP 请求实现相同的功能。此外，您通常可以远程登录到路由器并通过其命令行界面重新启动它。以编程方式，您可以通过使用像[expect](http://en.wikipedia.org/wiki/Expect)这样的工具来实现相同的目标。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T21:17:09.723

如果您可以访问路由器的本地 Web 界面，您也许可以访问路由器的“重置”功能。您可以尝试通过 http 请求调用它，例如通过 wget。但这在很大程度上取决于路由器。一些路由器还支持 SNMP 或 telnet 接口。

另一种可能性是将路由器插入可以远程控制的以太网连接的电源板。这些电源板通常内置一个简单的 http 服务器，因此您可以单独打开和关闭连接的设备。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T21:18:55.380

如果是 Linksys WRT54G，我强烈推荐 DD-WRT。这是一个开源固件替代品，它内置了用于定时重启的此功能。使用 HTTP 请求以编程方式重新启动也应该很容易，因为重新启动功能可通过管理 GUI 使用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2018-11-24T21:14:07.823

[https://github.com/danielrussellLA/restart-linksys-EA2700-router](https://github.com/danielrussellLA/restart-linksys-EA2700-router)您可以尝试使用与此类似的守夜机器人通过浏览器 ui 以编程方式重新启动路由器。如果您的路由器没有您可以访问的命令行界面（通过 telnet、ssh 等），这将非常有效。这很hacky，但它完成了工作。

# .net - 如何将整数和布尔键值对存储在无序集合中？

> ID：146743
> 
> 赞同：1
> 
> 时间：2008-09-28T21:10:14.747
> 
> 标签：.net

我需要在.NET中存储（整数，布尔值）的键值对列表

当我使用字典时，它会重新排序。是否有一个内置的集合可以处理这个问题。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-28T21:12:49.920

```
 List<KeyValuePair<int, bool>> l = 
                        new List<KeyValuePair<int, bool>>();
    l.Add(new KeyValuePair<int, bool>(1, false)); 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-28T21:13:41.353

如果要保留插入顺序，为什么不使用队列？

[http://msdn.microsoft.com/en-us/library/6tc79sx1(VS.71).aspx](http://msdn.microsoft.com/en-us/library/6tc79sx1(VS.71).aspx)

字典对元素重新排序以便更快地查找。保留插入顺序会破坏该目的......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T21:14:39.963

您可以创建一个 KeyValuePairs 列表：

```
var myList = new List<KeyValuePair<int, bool>>(); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-28T21:42:22.547

[有序字典](http://msdn.microsoft.com/en-us/library/system.collections.specialized.ordereddictionary.aspx)允许按索引或键检索。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T21:59:33.753

OrderedDictionary 是要走的路。它提供 O(1) 检索和 O(n) 插入。有关更多详细信息，[请参阅代码项目](http://www.codeproject.com/KB/recipes/GenericOrderedDictionary.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-28T22:03:59.437

数组呢？

```
KeyValuePair<int, bool>[] pairs 
```

当您想在集合初始化后添加对时，列表可能更有用。

```
List<KeyValuePair<int, bool>> 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2008-09-28T21:19:35.987

字典应该对它们重新排序，地图本身没有顺序的概念。

.Net 中有一个类支持该概念：

```
SortedDictionary<Tkey, Tvalue> 
```

它要求 Tkey 类型实现 de IComparable 接口，以便知道如何对项目进行排序。这样，当您返回键或值时，它们应该按照 IComparable 实现指定的顺序。对于整数当然是微不足道的：

```
a < b 
```

# visual-studio-2008 - 为什么 Visual Studio 2008 无法识别用户创建的命名空间？

> ID：146745
> 
> 赞同：2
> 
> 时间：2008-09-28T21:11:36.567
> 
> 标签：visual-studio-2008

由于某种原因，当我在 Visual Studio 2008 中创建新命名空间时，它无法被识别。我正在使用asp.net mvc，我不知道这是否与它有关。

有没有人遇到过这个？...你如何解决它？还有一种方法可以强制 Visual Studio 重新检查新的命名空间吗？

**答：** 我发现了问题...[检查一下](https://stackoverflow.com/questions/146745/why-are-user-created-namespaces-not-being-recognized-by-visual-studio-2008#146883)。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-28T22:18:03.197

不知道这是怎么发生的，但这个类文件的构建属性设置为“内容”。编译器没有看到新的命名空间。一旦我将它设置为“编译”，它就可以正常工作。

奇怪的！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-28T21:54:58.430

问题：命名空间和类是不是在同一个项目中被拾取还是被引用？
这是 vb 还是 ac# 项目？- 我不记得哪一种方式（想想它的 c#），但其中一个将根命名空间默认为项目名称。如果您在根名称空间的同一级别创建一个名称空间，您可能会遇到问题或得到一个令人困惑的名称空间，例如 MyProject.MyProject。

几件事要尝试：

按 ctrl alt b 重建项目它是否选择了命名空间？
将新方法添加到正在运行的现有类中 - 是否被选中？

尝试创建一个完全不同的命名空间，例如

命名空间 StackOverflow.Test {

}

终于看到工作室在编译不正确时不会选择新的命名空间和方法。这可能是由于 NTFS 权限和只读权限造成的。检查 dll 的构建日期。您也可以尝试清除 ASP.net 临时文件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-03-21T08:21:17.603

请确保您的课程是私有的或公开的，因为当我们将课程添加到项目时，默认情况下私有且私有在其他项目中不可访问

# sql-server-2005 - 有什么理由在同一台机器上安装 SQL Server 2005 和 2008？

> ID：146750
> 
> 赞同：5
> 
> 时间：2008-09-28T21:12:35.927
> 
> 标签：sql-server-2005, sql-server-2008, installation, compatibility

我正在设置一个新的开发服务器并想安装最新版本的 SQL Server 2008 Express。

我们现有的 sql2005 数据库是否可以在不修改的情况下与 2008 一起使用？如果是这样，是否有任何理由将两个版本安装在同一台服务器上？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-28T21:23:26.900

我实际上并没有尝试将 2005 数据库迁移到 2008，但通常 SQL 可以干净利落地处理这个问题。最简单的方法是从 SQL 2005 备份您的数据库，然后使用 SQL 2008 恢复该备份。

如果您想保留 SQL 2005 副本并保持在线，直到您知道 2008 副本正在工作，您可能需要在将备份恢复到 2008 时移动数据库的数据/日志文件，因为旧数据文件将在到 2005 年使用。您可以使用 的`with move`选项执行此操作`restore database`，例如：

`RESTORE DATABASE mydb FROM disk = 'c:\backupfile.bak'
WITH MOVE 'maindatafile' to 'c:\newdatalocation.mdf',
MOVE 'mainlogfile' to 'c:\newloglocation.ldf'`

至于同时安装两者，您可能决定这样做的一个原因是简化针对两个版本测试代码的工作，如果您打算让您的软件支持与两个版本通信。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-28T21:18:09.797

您可以分离 2005 数据库并将其附加到 2008 服务器。我建议不要将两者安装在同一台机器上，除非你必须这样做（例如，你正在为第三方编写代码，而他们只使用 2005）。

我强烈推荐的是使用 windows server 2008 hyper-v 创建 2 台虚拟机，一台使用 2005 环境，另一台使用 2008。Hyper-v 虚拟机比 Virtual server 2007 快得令人难以置信。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T21:26:07.000

数据库应该（*应该！*）不加修改地工作。但是，对于开发而言，最好使用 sql2005 来测试您的脚本，除非您假设所有客户端也将升级到 2008，因为 2008 具有 SQL Server 2005 中不存在的功能。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-09-12T19:21:46.470

在开发和测试环境中，安装多个数据库服务器不是问题，并且可以减少所需的测试服务器数量。

在生产中，我不推荐它，因为多个缓冲池会相互竞争并扼杀你的性能。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-02-18T22:41:33.477

对我来说重要的是你会有 2005 数据库的产品实例吗？您是否必须支持仅具有 2005 版报告服务等的 prod 服务器上的报告服务报告？

如果是这样，您的开发机器上应该同时拥有 2005 和 2008 版本。我看到很多代码不得不被丢弃，因为开发人员在 2008 年工作，而 prod 是 2005 年。总是针对你在 prod 中拥有的软件版本进行开发。如果您要转换到 2008 年，但还没有在 prod 中，您需要两者，一个用于维护更改，一个用于未来的东西。

就我个人而言，我的机器上有 SQL Server 2000、2005 和 2008，因为我们还没有转换所有东西，而且我有一些只能在旧版本上完成的事情。我们发现维护多个版本的关键是以正确的顺序安装它们。如果您先安装 2008，然后再安装旧版本，这似乎很糟糕。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-02-18T22:47:32.137

有时您需要能够在多个版本上进行测试，或者您可能需要 2005 做一件事，而 2008 做另一件事。

有时您维护几个不同的应用程序，其中一些在一个上，一些在另一个上，而您还没有更新所有内容。有时您正在升级，并且需要在升级期间测试两个版本。有时您支持多个不同的客户，一些在一个版本上，一些在另一个版本上。有时您想升级内部应用程序，但您使用的软件包仅在旧版本上经过认证。

有很多原因。

# .net - 什么 .NET 的 SNMP 库使陷阱、设置或变得简单？

> ID：146766
> 
> 赞同：14
> 
> 时间：2008-09-28T21:18:16.053
> 
> 标签：.net, networking, network-protocols, snmp

与 .NET 一起使用的最佳 SNMP 库是什么？专门用于侦听陷阱或发送设置或获取请求。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-28T22:25:11.010

我正在使用[Sharp SNMP Suite (#SNMP)](http://www.codeplex.com/sharpsnmplib)：LGPL，兼容 Mono，用 C# 3.0 开发，具有非常好的 API。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-11-23T08:03:43.353

嗨，作为#SNMP 的作者，我尽力在这里保持公正:)

我在这里有一篇博文，是一份简单的评估报告。

[http://www.lextm.com/index.php/2007/12/product-review-snmp-libraries-for-net-evaluation-report/](http://www.lextm.com/index.php/2007/12/product-review-snmp-libraries-for-net-evaluation-report/)

在我看来，PowerSNMP 是领先的，具有完整的功能集和简单/自然的 API。有许多商业和开源产品，您可以自行评估，看看哪一种满足您的特殊需求。

哪一个是最好的？这取决于您需要哪些 SNMP 功能子集以及您的预算有多大。:)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T21:21:37.887

这是一个库和一些示例[http://www.c-sharpcorner.com/UploadFile/malcolmcrowe/SnmpLib11232005011613AM/SnmpLib.aspx](http://www.c-sharpcorner.com/UploadFile/malcolmcrowe/SnmpLib11232005011613AM/SnmpLib.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-07T08:37:30.733

我个人使用 Adventnet 的[.NET SNMP API](http://www.webnms.com/net-snmp/index.html)进行 snmp 工作。它现在已重命名为 WebNMS。我在几个地方都有基于此 API 运行的代码，这些代码刚刚工作并继续 24/7 工作。

推荐用于大量示例和稳定性。它也很快。似乎自从我上次使用 SNMP 以来还有其他几个 .NET SNMP 库可能值得一试。例如：#SNMP，已在其他回复中提及。

# oop - 您应该将接口相对于它们的实现者放在哪个命名空间中？

> ID：146777
> 
> 赞同：14
> 
> 时间：2008-09-28T21:23:55.713
> 
> 标签：oop, interface, namespaces

具体来说，当您创建一个接口/实现器对，并且没有压倒一切的组织问题（例如接口应该放在不同的程序集中，即按照 s# 架构的建议）时，您是否有一种默认的方式来组织它们？命名空间/命名方案？

这显然是一个更多基于意见的问题，但我认为有些人对此进行了更多思考，我们都可以从他们的结论中受益。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2008-09-28T21:55:21.907

答案取决于你的意图。

*   如果您希望命名空间的使用者在具体实现上使用接口，我建议您将接口放在顶级命名空间中，而实现在子命名空间中
*   如果消费者要同时使用两者，请将它们放在同一个命名空间中。
*   如果接口主要用于专门用途，例如创建新实现，请考虑将它们放在子命名空间中，例如 Design 或 ComponentModel。

我敢肯定还有其他选择，但与大多数命名空间问题一样，它归结为项目的用例，以及它包含的类和接口。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2008-09-28T21:28:19.383

我通常将接口保存在与具体类型相同的命名空间中。

但是，这只是我的看法，命名空间布局是非常主观的。

```
Animals
|
| - IAnimal
| - Dog
| - Cat
Plants
|
| - IPlant
| - Cactus 
```

将一两种类型移出主命名空间并没有真正获得任何好处，但确实添加了一个额外的 using 语句的要求。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2008-09-28T21:27:18.107

我通常做的是在我的层次结构的较高级别创建一个接口命名空间并将所有接口放在那里（我不会费心在其中嵌套其他命名空间，因为我最终会得到许多只包含一个接口的命名空间）。

```
Interfaces
|--IAnimal
|--IVegetable
|--IMineral
MineralImplementor
Organisms
|--AnimalImplementor
|--VegetableImplementor 
```

这正是我过去所做的方式，并且我没有遇到很多问题，尽管诚然，这可能会让其他坐下来处理我的项目的人感到困惑。我很好奇看看其他人是怎么做的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-28T22:28:55.773

我更喜欢将我的接口和实现类放在同一个命名空间中。如果可能，我会为实现类提供内部可见性并提供一个工厂（通常以静态工厂方法的形式委托给工作人员类，并提供一个内部方法，该方法允许在友元程序集中进行单元测试来替换另一个工作人员产生存根）。当然，如果具体类需要是公共的——例如，如果它是一个抽象基类，那也没关系；我看不出有任何理由将 ABC 放在自己的命名空间中。

附带说明一下，我非常不喜欢在接口名称前加上字母“I”的 .NET 约定。(I)Foo 接口模型的东西不是*ifoo*，它只是一个*foo*。那么为什么我不能直接称它为 Foo 呢？然后我具体命名实现类，例如 AbstractFoo、MemoryOptimizedFoo、SimpleFoo、StubFoo 等。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-28T22:04:10.937

(.Net) 我倾向于将接口保留在一个单独的“通用”程序集中，这样我就可以在多个应用程序中使用该接口，更常见的是，在我的应用程序的服务器组件中使用该接口。

关于名称空间，我将它们保存在 BusinessCommon.Interfaces 中。

我这样做是为了确保我和我的开发人员都不想直接引用这些实现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-28T22:22:43.183

以某种方式分离接口（Eclipse 中的项目等），以便只部署接口。这允许您在不提供实现的情况下提供外部 API。这允许依赖项目以最少的外部构建。显然，这更适用于大型项目，但这个概念在所有情况下都是好的。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T17:13:23.223

我通常将它们分成两个单独的程序集。接口的一个常见原因是让一系列对象在您的软件的某些子系统中看起来相同。例如，我的所有报表都实现了 IReport 接口。IReport 不仅用于打印，还用于预览和选择每个报告的单个选项。最后，我有一组 IReport 可在对话框中使用，用户可以在其中选择他们想要打印的报告（和配置选项）。

报表驻留在单独的程序集中，而 IReport、预览引擎、打印引擎、报表选择驻留在它们各自的核心程序集和/或 UI 程序集中。

如果您使用工厂类返回报表程序集中的可用报表列表，那么使用新报表更新软件只需在原始报表程序集上复制新报表程序集即可。您甚至可以使用反射 API 来扫描任何报告工厂的程序集列表并以这种方式构建您的报告列表。

您也可以将此技术应用于文件。我自己的软件运行金属切割机，因此我们将这个想法用于与我们的软件一起销售的形状和配件库。

同样，实现核心接口的类应该驻留在单独的程序集中，以便您可以与软件的其余部分分开更新它。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2012-09-02T22:08:18.163

我讨厌在同一个命名空间/程序集中找到接口和实现。请不要那样做，如果项目发展了，重构是一件很痛苦的事情。

当我引用一个接口时，我想实现它，而不是获取它的所有实现。

我可以接受的是将接口与其依赖类（~~引用接口的类~~）。

编辑：@Josh，我刚刚读了我的最后一句话，这令人困惑！当然，依赖类和实现它的类都引用了该接口。为了让自己清楚，我将举例说明：

**可接受：**

接口+实现：

```
namespace A;

   Interface IMyInterface
   {
       void MyMethod();
   }

namespace A;

   Interface MyDependentClass
   {
       private IMyInterface inject;

       public MyDependentClass(IMyInterface inject)
       {
           this.inject = inject;
       }

       public void DoJob()
       {
           //Bla bla
           inject.MyMethod();
       }
   } 
```

实现类：

```
namespace B;

   Interface MyImplementing : IMyInterface
   {
       public void MyMethod()
       {
           Console.WriteLine("hello world");
       }
   } 
```

**不能接受的：**

```
namespace A;

   Interface IMyInterface
   {
       void MyMethod();
   }

namespace A;

   Interface MyImplementing : IMyInterface
   {
       public void MyMethod()
       {
           Console.WriteLine("hello world");
       }
   } 
```

请不要为您的界面创建项目/垃圾！示例：ShittyProject.Interfaces。你错过了重点！

想象一下，您创建了一个为您的接口保留的 DLL (200 MB)。如果您必须使用两行代码添加一个界面，您的用户将不得不为两个愚蠢的签名更新 200 MB！

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2016-04-28T08:28:45.600

我给出了与其他答案相反的自己的经验。

我倾向于将我所有的接口放在它们所属的包中。这意味着，如果我在另一个项目中移动一个包，我将拥有运行包所需的所有东西，而无需进行任何更改。

对我来说，作为类功能一部分的任何辅助函数和操作符函数都应该与类进入相同的命名空间，因为它们构成了该命名空间的公共 API 的一部分。

如果您有在不同包中共享相同接口的通用实现，您可能需要重构您的项目。

有时我看到项目中有很多接口可以转换为抽象实现而不是接口。

所以，问问自己你是否真的在为类型或结构建模。

# python - 在 Django 中，放置 HTML 格式数据的简短片段的最佳位置在哪里？

> ID：146789
> 
> 赞同：9
> 
> 时间：2008-09-28T21:31:21.887
> 
> 标签：python, django, model-view-controller, design-patterns

这个问题与（但可能不完全相同）有关：

[Django 有 HTML 助手吗？](https://stackoverflow.com/questions/61451/does-django-have-html-helpers)

我的问题是：在 Django 中，我不断地复制低级数据库对象的基本格式。这是一个例子：

我有两个类，Person 和 Address。每个人有多个地址，设置类似（在他们各自的**models.py 中**）

```
class Person(models.Model):
  ...

class Address(models.Model):
  contact = models.ForeignKey(Person) 
```

现在，每当我查看一个人时，我都想查看他们的所有地址。所以假设**Persons/views.py**有类似的东西：

```
def detail(request, person_id):
   person = get_object_or_404( Person, pk=person_id )
   return render_to_response('persons/details.html',
      { 'title' : unicode(person), 'addresses': person.address_set.all() } ) 
```

而且，我有一个模板，**persons/details.html**，带有代码，例如，像这样：

```
{% extends "base.html" %}

{% for address in addresses %}
<b>{{ address.name }}</b>
  {{ address.type }} <br>
  {{ address.street_1 }}<br>
  {{ address.street_2 }}<br>
  {{ address.city }} {{ address.stateprov }} {{ address.postalcode }}<br>
  {{ address.country }}
  <hr>
{{ endfor }} 
```

我将这段代码重复了很多次，通常有细微的变化，例如当它在一个表中时，然后 <br> 必须由</td><td> 代替。其他时候，我不想显示 street_2（或它之后的 <br>）。总而言之，我想表达一个基本逻辑，即我更不愿意使用块复制！

我想要的是一个**persons/details.html**，例如，以下内容：

```
{% extends "base.html" %}
{% for address in addresses %} 
  {% address.as_html4 %}
{% endfor %} 
```

如果我想要内联表，类似的东西（我猜！）：

```
{% extends "base.html" %}
<table><tr>
{% for address in addresses %}
  <tr><td> {% address.as_html4 </td><td> %} </td></tr>
{% endfor %}
</table> 
```

那么问题来了：哪里是放置格式的最佳位置？逻辑？

Django 似乎有以下（合理的）选项：

1.  将格式放入models.py

2.  将逻辑/格式放入views.py

3.  将逻辑/格式放在 Person 或 Address 的其他子类中（即addresses/html4.py）

4.  创建自定义标签

帮助/洞察力非常感谢！

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2008-09-28T21:53:27.140

听起来您正在寻找[包含标签。](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#inclusion-tags)您可以为每个主要变体设置一个模板和标签，并根据需要使用标签的参数自定义每个模板的上下文。

基本标签定义：

```
@register.inclusion_tag('person/address.html')
def display_address(address):
    return {'address': address} 
```

在模板中使用（假设包含它的 templatetag 模块已经被`{% load %}`-ed）：

```
{% display_address address %} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-28T21:52:19.107

我会使用模板标签输出数据，使用模板 html-file aka[包含标签](http://docs.djangoproject.com/en/dev/howto/custom-template-tags/#inclusion-tags)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T13:26:16.297

我认为模板过滤器也会很有用。您可以在每个对象上传递过滤器，例如：

```
{{ value|linebreaks }} # standard django filter 
```

将产生：

```
If value is Joel\nis a slug, the output will be <p>Joel<br>is a slug</p>. 
```

请参阅[Django 内置模板标签和过滤器](http://docs.djangoproject.com/en/dev/ref/templates/builtins/#ref-templates-builtins-filters)完整参考。

# .net - 有什么方法可以取消注册 WPF 依赖属性？

> ID：146794
> 
> 赞同：9
> 
> 时间：2008-09-28T21:35:24.797
> 
> 标签：.net, wpf, dependency-properties

我在单元测试中遇到了一个不寻常的问题。我正在测试的类在运行时动态创建一个依赖属性，并且该依赖属性的类型可能会因环境而异。在编写单元测试时，我需要创建具有不同类型的依赖属性，这会导致错误，因为您无法重新定义现有的依赖属性。

那么有没有办法取消注册依赖属性或更改现有依赖属性的类型？

谢谢！

* * *

OverrideMetadata() 只允许您更改很少的内容，例如默认值，因此它没有帮助。AppDomain 方法是一个好主意，并且可能有效，但似乎比我真正想为了单元测试而深入研究的要复杂。

我从来没有找到取消注册依赖属性的方法，所以我小心翼翼地重新组织了我的单元测试以避免这个问题。我得到的测试覆盖率有所降低，但由于这个问题永远不会在实际应用程序中发生，而且只有在单元测试期间我才能忍受它。

谢谢您的帮助！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-09-11T17:13:56.540

我昨天在尝试测试我自己的 DependencyProperty 创建类时遇到了类似的问题。我遇到了这个问题，并注意到没有真正的解决方案来取消注册依赖属性。所以我使用[Red Gate .NET Reflector](http://www.red-gate.com/products/reflector/)进行了一些挖掘，看看我能想出什么。

看着`DependencyProperty.Register`过载，他们似乎都指向`DependencyProperty.RegisterCommon`。该方法有两个部分：

首先检查房产是否已经注册

```
FromNameKey key = new FromNameKey(name, ownerType);
lock (Synchronized)
{
  if (PropertyFromName.Contains(key))
  {
    throw new ArgumentException(SR.Get("PropertyAlreadyRegistered", 
      new object[] { name, ownerType.Name }));
  }
} 
```

二、注册DependencyProperty

```
DependencyProperty dp = 
  new DependencyProperty(name, propertyType, ownerType, 
    defaultMetadata, validateValueCallback);

defaultMetadata.Seal(dp, null);
//...Yada yada...
lock (Synchronized)
{
  PropertyFromName[key] = dp;
} 
```

两个部分都`DependencyProperty.PropertyFromName`以 HashTable 为中心。我还注意到 , `DependencyProperty.RegisteredPropertyList`，`ItemStructList<DependencyProperty>`但没有看到它在哪里使用。但是，为了安全起见，我想如果可能的话，我也会尝试从中删除。

所以我结束了下面的代码，它允许我“取消注册”一个依赖属性。

```
private void RemoveDependency(DependencyProperty prop)
{
  var registeredPropertyField = typeof(DependencyProperty).
    GetField("RegisteredPropertyList", BindingFlags.NonPublic | BindingFlags.Static);
  object list = registeredPropertyField.GetValue(null);
  var genericMeth = list.GetType().GetMethod("Remove");
  try
  {
    genericMeth.Invoke(list, new[] { prop });
  }
  catch (TargetInvocationException)
  {
    Console.WriteLine("Does not exist in list");
  }

  var propertyFromNameField = typeof(DependencyProperty).
    GetField("PropertyFromName", BindingFlags.NonPublic | BindingFlags.Static);
  var propertyFromName = (Hashtable)propertyFromNameField.GetValue(null);

  object keyToRemove = null;
  foreach (DictionaryEntry item in propertyFromName)
  {
    if (item.Value == prop)
      keyToRemove = item.Key;
  }
  if (keyToRemove != null)
  propertyFromName.Remove(keyToRemove);
} 
```

它工作得很好，我可以运行我的测试而不会出现“AlreadyRegistered”异常。但是，我强烈建议您**不要在任何类型的生产代码中使用它。**MSFT 选择不使用正式的方式来取消注册依赖项属性可能是有原因的，并且试图违背它只是自找麻烦。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-30T15:52:37.643

如果一切都失败了，您可以为每个测试创建一个新的 AppDomain。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T21:52:43.770

我不认为您可以取消注册依赖属性，但您可以通过覆盖元数据来重新定义它，如下所示：

```
MyDependencyProperty.OverrideMetadata(typeof(MyNewType), 
                     new PropertyMetadata()); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-14T19:30:56.033

如果我们为这样的标签注册名称：

```
Label myLabel = new Label();
this.RegisterName(myLabel.Name, myLabel); 
```

我们可以使用以下方法轻松注销名称：

```
this.UnregisterName(myLabel.Name); 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-11-24T02:24:03.527

我面临的情况是，我创建了一个继承自该控件的自定义控件，该控件`Selector`具有两个 ItemsSource 属性，`HorizontalItemsSource`并且`VerticalItemsSource`.

我什至不使用 ItemsControl 属性，也不希望用户能够访问它。

所以我读[了 statenjason 的好答案](https://stackoverflow.com/questions/146794/any-way-to-un-register-a-wpf-dependency-property/1412194#1412194)，它给了我一个关于如何删除 DP 的巨大观点。
但是，我的问题是，由于我声明了`ItemsSourceProperty`成员和`ItemsSource`as `Private Shadows`（`private new`在 C# 中），我无法在设计时加载它，因为 using`MyControlType.ItemsSourceProperty`将引用阴影变量。
此外，当使用上面提到的循环（`foreach DictionaryEntry`等）时，我抛出了一个异常，说集合在迭代期间发生了变化。

因此，我想出了一个稍微不同的方法，其中 DependencyProperty 在运行时被硬编码，并且集合被复制到数组中，所以它不会改变（VB.NET，抱歉）：

```
Dim dpType = GetType(DependencyProperty)
Dim bFlags = BindingFlags.NonPublic Or BindingFlags.Static

Dim FromName = 
  Function(name As String, ownerType As Type) DirectCast(dpType.GetMethod("FromName",
    bFlags).Invoke(Nothing, {name, ownerType}), DependencyProperty)

Dim PropertyFromName = DirectCast(dpType.GetField("PropertyFromName", bFlags).
  GetValue(Nothing), Hashtable)

Dim dp = FromName.Invoke("ItemsSource", GetType(DimensionalGrid))
Dim entries(PropertyFromName.Count - 1) As DictionaryEntry
PropertyFromName.CopyTo(entries, 0)
Dim entry = entries.Single(Function(e) e.Value Is dp)
PropertyFromName.Remove(entry.Key) 
```

**重要说明：**上面的代码都包含在自定义控件的共享构造函数中，我不必检查它是否已注册，因为我知道 Selcetor 的子类确实提供了该`ItemsSource`dp。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-02-09T15:10:26.137

具有不同数据模板的 ContentPresenter 存在问题，其中一个具有带有 PropertyChangedCallback 的 DependencyProperty 将 ContentPresenters 内容更改为另一个 DataTemplate 时，回调仍然存在。

在 UserControls Unloaded 事件中，我调用了：

```
BindingOperations.ClearAllBindings(this);
Dispatcher.CurrentDispatcher.Invoke(DispatcherPriority.Normal, new DispatcherOperationCallback(delegate { return null; }), null); 
```

这对我有用

# c++ - 如何从 INI 文件中读取配置文件条目

> ID：146795
> 
> 赞同：0
> 
> 时间：2008-09-28T21:35:25.480
> 
> 标签：c++, parsing, ini

我无法使用这些`Get*Profile`功能，因为我使用的是旧版本的 Windows CE 平台 SDK，它没有这些功能。它不必太笼统。

```
[section]
name = some string 
```

我只需要打开文件，检查“section”是否存在，以及与“name”关联的值。首选标准 C++。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-28T22:47:28.787

我想出了什么：

```
std::wifstream file(L"\\Windows\\myini.ini");
if (file)
{
  bool section=false;
  while (!file.eof())
  {
    WCHAR _line[256];
    file.getline(_line, ELEMENTS(_line));
    std::wstringstream lineStm(_line);
    std::wstring &line=lineStm.str();
    if (line.empty()) continue;

    switch (line[0])
    {
      // new header
      case L'[':
      {
        std::wstring header;
        for (size_t i=1; i<line.length(); i++)
        {
          if (line[i]!=L']')
            header.push_back(line[i]);
          else
            break;
        }
        if (header==L"Section")
          section=true;
        else
          section=false;
      }
  break;
      // comments
      case ';':
      case ' ':
      case '#':
      break;
      // var=value
      default:
      {
        if (!section) continue;

        std::wstring name, dummy, value;
        lineStm >> name >> dummy;
        ws(lineStm);
        WCHAR _value[256];
        lineStm.getline(_value, ELEMENTS(_value));
        value=_value;
      }
    }
  }
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-16T11:22:00.837

你应该看看[Boost.Program_options](http://www.boost.org/doc/html/program_options.html)。它有一个填充变量映射的 parse_config_file 函数。正是你需要的！

# sharepoint - 如何重命名 SharePoint 虚拟机

> ID：146801
> 
> 赞同：5
> 
> 时间：2008-09-28T21:39:52.070
> 
> 标签：sharepoint, moss, rename, virtual-machine

我正在使用虚拟机进行开发，但每次我需要一个新的虚拟机时，我都会复制文件并创建一个新的服务器，但我需要一个新的服务器名称才能将其添加到我们的网络中。

重命名服务器后，Sharepoint 站点出现许多错误并且无法运行。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-28T21:52:03.600

实际上，对于唯一的计算机 SID、SQL Server 等，您需要做很多事情。

这些链接将帮助您入门：

[http://paulhorsfall.co.uk/archive/2007/04/10/How-to-Create-a-Cloneable-SharePoint-Virtual-Machine.aspx](http://paulhorsfall.co.uk/archive/2007/04/10/How-to-Create-a-Cloneable-SharePoint-Virtual-Machine.aspx)

[http://msmvps.com/blogs/laflour/archive/2008/04/25/renaming-server-pc-with-sharepoint.aspx](http://msmvps.com/blogs/laflour/archive/2008/04/25/renaming-server-pc-with-sharepoint.aspx)

[http://dotnet.org.za/jpfouche/archive/2008/02/12/renaming-your-sharepoint-virtual-machine.aspx](http://dotnet.org.za/jpfouche/archive/2008/02/12/renaming-your-sharepoint-virtual-machine.aspx)

我希望这会有所帮助，享受。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T21:52:58.747

这是一篇可能有帮助的 Technet 文章：[http ://technet.microsoft.com/en-us/library/cc261986.aspx](http://technet.microsoft.com/en-us/library/cc261986.aspx)

如果您要卸载 SharePoint，请查看本文以获取有关 SQL Server 重命名的更多详细信息：[http ://technet.microsoft.com/en-us/library/ms143799.aspx](http://technet.microsoft.com/en-us/library/ms143799.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-30T09:35:46.910

这是另一个对我有很大帮助的链接：http: [//www.sharepointblogs.com/mirjam/archive/2007/08/06/renaming-a-moss-server.aspx](http://www.sharepointblogs.com/mirjam/archive/2007/08/06/renaming-a-moss-server.aspx)

# iframe - Googlebot + IFrames？

> ID：146805
> 
> 赞同：3
> 
> 时间：2008-09-28T21:40:29.790
> 
> 标签：iframe, seo

googlebot 如何处理 iframe？它是否像链接一样遵循 src 属性？是否将 iframe 内容作为包含它的页面的一部分进行分析？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2008-09-28T21:44:41.277

> IFrame 有时用于在网页上显示内容。**通过 iFrame 显示的内容可能不会被编入索引**并且无法显示在 Google 的搜索结果中。我们建议您避免使用 iFrame 来显示内容。如果您确实包含 iFrame，请确保**为其显示的内容提供其他基于文本的链接，以便 Googlebot 可以抓取此内容并将其编入索引。**

来自[Google 网站管理员指南](http://www.google.com/support/webmasters/bin/answer.py?answer=72746&query=iframe&topic=&type=)

iframe 内容不包含在原始页面中。如果您希望将内容编入索引，请尝试提供指向 src 页面的文本链接。如果您不想将其编入索引，请使用元机器人标签或 robots.txt 来限制文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-28T21:44:36.333

轶事证据表明它将其视为链接（因此您最终可以通过来自搜索引擎的链接自行加载一个设计为在框架内查看的页面）。

# pattern-recognition - 我怎么知道咖啡店里的电脑是什么类型的？

> ID：146807
> 
> 赞同：-2
> 
> 时间：2008-09-28T21:40:59.273
> 
> 标签：pattern-recognition

这更像是一个思想实验。

我想知道如何才能合法地检测到热点中关于笔记本电脑的所有信息。我的第一个想法是尽可能获取每个 MAC 地址并从前 24 位中提取制造商。

问题是这是否违法，我还能合法地清除什么，最好是被动地？

PS这构成了一个模式识别问题，所以它是编程......我认为。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-28T21:42:41.907

[nmap](http://nmap.org/)可以通过目标系统响应各种探测的方式来合理地猜测操作系统

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-28T21:41:46.027

对于脑死亡的答案：*停止打字并四处看看几分钟*:-D

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T21:43:37.520

我想最明显的方法是从他们的 HTTP 请求中嗅出用户代理。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-28T21:42:53.217

IIRC 有一些方法可以通过嗅探端口使用和序列号中的选择来检测正在使用的 TCP/IP 堆栈。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T21:45:12.633

为什么这很重要，其中 90% 将是苹果 ;-)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-10-15T04:10:02.453

戴着黑色高领毛衣的人将使用 Mac，其余的将使用 PC 和 Windows（除了那个使用 Linux 的长马尾的家伙）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-10-15T04:33:00.613

未经网络所有者同意，数据包嗅探是非法的。至少这是普遍遵循的先例。在法庭上对此进行的测试很少。但是你关于如何使用mac地址的想法会很好用。如果您正在寻找，Wireshark 是一个很好的数据包嗅探器。

* * *

## 回答 #8

> 赞同：-1
> 
> 时间：2008-09-28T21:57:26.350

[GFI Languard](http://www.gfi.com/lannetscan/)提供了很多这样的信息。一探究竟。

# struts2 - Struts2 无效字符的注解验证器

> ID：146815
> 
> 赞同：0
> 
> 时间：2008-09-28T21:43:07.553
> 
> 标签：struts2, annotations, validation, invalid-characters

在使用 Struts2 时，我使用了几个注释在 Model 类中的`set()`方法中进行验证，例如：

```
@RequiredStringValidator(message = "Name is required")
@StringLengthFieldValidator(message = "Name must be between 5 and 60 characters", 
                              minLength = "5", maxLength = "60")
public void setName(String name) {
    this.name = name;
} 
```

但我想如何进行验证以避免奇怪的字符，如`!`, `?`, `#`,`$`等等...

是否有任何现有的验证器我应该像 a 一样使用`@RestrictChars`，或者是否有某种方法可以使用`@StringRegexValidator`. 或者我应该写一个新的。任何提示或文档如何做到这一点都会很棒。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-29T02:25:57.607

我终于找到了：

只需添加已经存在的`@RegexFieldValidator`就给了我需要的验证器：

```
@RegexFieldValidator(message = "Use only Letters or numbers",
                       expression = "^[a-zA-Z0-9]+$") 
```

无论如何，谢谢你们！

# c - 高管家族

> ID：146835
> 
> 赞同：4
> 
> 时间：2008-09-28T21:53:50.210
> 
> 标签：c, process, exec

我有一个项目需要使用 exec 系列。我的项目包括制作一个交互式外壳。shell会实现一些基本的命令，比如cd、ls、echo等。我一直在研究exec的用法，但是还没有找到有用的站点。任何建议的链接都会有所帮助。

```
int ret;
ret = execl ("/bin/ls", "ls", "-1", (char *)0); 
```

我如何让这个操作的输出显示在屏幕上？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-28T22:19:43.877

正在做

```
int fd = 1;
dup(fd);
close(fd); 
```

获取屏幕的输出。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-28T22:25:17.967

您编写的代码在一个简单的测试程序中为我工作，它什么都不做。请记住，当您调用 execl 时，该进程会保留所有旧文件句柄。因此，无论您调用 execl 时的标准输出是什么，加载新的二进制文件时它都是相同的。如果您只想将输出发送到终端，只需确保 stdout 发送到终端即可。

如果你想用另一个程序做 I/O，popen 很适合这个（正如 mgb 提到的）。它将派生一个新进程，为您设置管道，调用 exec 的一些变体，并返回一个可用于通信的文件句柄。

# php - 全面的服务器端验证

> ID：146839
> 
> 赞同：3
> 
> 时间：2008-09-28T21:56:16.257
> 
> 标签：php, regex, validation, sql-injection, server-side

我目前有一个相当强大的服务器端验证系统，但我正在寻找一些反馈，以确保我已经涵盖了所有方面。以下是我目前正在做的事情的简要概述：

*   确保输入不为空或太长

*   转义查询字符串以防止 SQL 注入

*   使用正则表达式拒绝无效字符（这取决于提交的内容）

*   编码某些 html 标签，例如 <script> （所有标签在存储在数据库中时都会被编码，有些在被查询以在页面中呈现时被解码）

有什么我想念的吗？欢迎使用代码示例或正则表达式。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-28T22:06:48.993

您不需要“转义”查询字符串来防止 SQL 注入 - 您应该使用准备好的语句。

理想情况下，您的输入过滤将在任何其他处理之前发生，因此您知道它将始终被使用。因为否则你只需要错过一个地方就容易受到问题的影响。

不要忘记在输出时对 HTML 实体进行编码 - 以防止 XSS 攻击。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-28T21:57:45.473

您应该对每个 html 标签进行编码，而不仅仅是“无效”标签。这是一场激烈的争论，但基本上它归结为总会有一些无效的 HTML 组合，你会忘记正确处理（嵌套标签、一些浏览器“正确”解释的不匹配标签等等）。因此，我认为最安全的选择是将所有内容存储为 htmlentities，然后在输出时从内容中打印经过验证的 HTML 安全子集树（作为实体）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T21:58:43.303

在专用于该任务的库中运行所有服务器端验证，以便一个领域的改进影响您的所有应用程序。

此外还包括针对已知攻击的工作，例如目录遍历和尝试访问 shell。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-28T23:02:11.670

这个问题/答案有一些你正在寻找的好的答案
（*面向 PHP，但你又没有指定语言/平台，其中一些适用于 php 世界之外*）：

> [用 PHP 清理用户输入的最佳方法是什么？](https://stackoverflow.com/questions/129677/whats-the-best-method-for-sanitizing-user-input-with-php)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T07:41:57.257

您可以查看[过滤器扩展](http://us3.php.net/manual/en/book.filter.php)以进行数据过滤。它不能保证你是完全无懈可击的，但我个人感觉使用它会好很多，因为该代码有很多眼球在看着它。

此外，考虑附议准备好的陈述。在 SQL 查询中转义数据已成为过去。

# sharepoint - 为什么我的“开箱即用”SharePoint Navigation 看起来像是在泄漏内存

> ID：146841
> 
> 赞同：3
> 
> 时间：2008-09-28T21:57:11.717
> 
> 标签：sharepoint, memory-leaks, moss, navigation

我的网站有一个很深的导航结构，而且经常看起来开箱即用的导航正在泄漏内存，尤其是 SPWeb 对象。

日志消息看起来像

> 当前在线程 5 上未释放的 SPRequest 对象 (14) 可能过多。确保正确处置此对象或其父对象（例如 SPWeb 或 SPSite）。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-29T02:04:56.707

[Stefan Goßner 的](http://blogs.technet.com/stefan_gossner/archive/2008/05/07/troubleshooting-spsite-spweb-leaks-in-wss-v3-and-moss-2007.aspx)博客文章似乎回答了这个问题。问题不在于没有关闭 SPWeb 对象，而是一旦达到某个分配阈值（默认为 8），就会在日志中创建警告。根据您的站点结构，将创建的数量会有所不同。

# java - D 是 Java 和 C++ 的可靠替代品吗？

> ID：146850
> 
> 赞同：164
> 
> 时间：2008-09-28T22:00:33.470
> 
> 标签：java, c++, c, d

[D 语言](http://www.digitalmars.com/d/)是Java 和 C++ 的可靠替代品吗？成为可靠的替代品需要什么？我应该费心学习吗？它值得传福音吗？

我问的主要原因是，随着新的 C++ 标准 (c++0x) 几乎就在这里，我很清楚，对于任何理解它的人来说，该语言已经远远超过了不归路。我知道 C/C++ 永远不会消亡，但在某些时候我们需要继续前进。甚至 COBOL 也有它的日子，而 Java 在许多方面都取代了 C++。下一个是什么？D 填单吗？

* * *

## 回答 #1

> 赞同：128
> 
> 时间：2008-09-28T22:20:34.920

决定一种编程语言在实际软件开发中的成功和流行度仅部分与语言本身的质量有关。作为一门纯语言，D 可以说比 C++ 和 Java 有很多优势。至少它作为一种纯语言是一种可靠的替代方案，在所有其他条件相同的情况下。

然而，对于软件开发来说，其他的事情很重要——几乎比语言本身更重要：可移植性（它可以在多少平台上运行）、调试器支持、IDE 支持、标准库质量、动态库支持、通用 API 的绑定、文档、开发人员社区、动力和商业支持，仅举几例。在这些方面，D 都无可救药地落后于 Java、C++ 和 C#。事实上，我认为在这些方面它甚至落后于所谓的“脚本”语言，如 Python、Perl、PHP、Ruby 甚至 JavaScript。

坦率地说，你根本无法使用 D 构建大规模的跨平台应用程序。由于标准库不成熟，~~任何现代 IDE 都不支持~~（Visual Studio 和 Xamarin Studio/MonoDevelop 都有插件），有限动态/共享库支持，并且很少绑定到其他语言，D 今天根本不是一个选择。

如果你喜欢你对 D 的看法，那么一定要学习它——如果你已经了解 Java 和 C++，那应该不会花很长时间。我认为布道不会有帮助——在这一点上，如果 D 想要成功，它真正需要的是更多的人安静地使用它并解决它的主要缺点，比如标准库和 IDE 支持。

最后，就 C++ 而言，虽然大多数人都认为该语言过于复杂，但成千上万的公司正在成功地将 C++ 用作一种健康的语言组合的一部分，只允许该语言的一个较小的、定义良好的子集。当需要原始性能和小内存使用时，仍然很难击败 C++。

* * *

## 回答 #2

> 赞同：109
> 
> 时间：2008-11-07T13:17:16.323

只是为了添加我自己的经验：

大约一年前，我在一个持续 3 个月的小型游戏项目（3 个程序员）上工作，我们使用 D 作为我们的主要语言。我们选择它的部分原因是作为一个实验，部分原因是它已经绑定了 SDL 和我们正在使用的其他一些工具，而且主要是因为它的好处似乎超过了 C++。

我们喜欢使用它。它学起来很快，而且很容易写。它的许多特性被证明是无价的，我很想念它们回到 C++。

然而，以下几点使我们的生活更加困难：

1.  当时没有好的 IDE，这是一个主要问题。我们最终通过定制 Scite 制作了自己的作品。这工作正常，但并不理想。
2.  当时没有调试器。我们设法让 WINDBG 以偶然的方式工作，但它不可靠。在没有调试器的情况下调试代码有时会让生活变得糟糕透顶。
3.  当时有 2 个标准库可供选择（Tango 和 Phobos）。我们从一个开始，然后切换到另一个，并且确实需要两者的混合功能（Tangobos！）。这引起了头痛和一些代码重写。
4.  无法绑定到其他工具。最后，我们不得不切换到 DirectX（出于我不会深入讨论的原因）。没有可用的 DirectX 绑定，因此我们必须用 C++ 编写自己的绑定，将其构建为 .dll 并绑定到它。这是相当讨厌的工作，需要一些时间。

总的来说，我们喜欢写 D。它使实际编写代码变得容易，而且学起来很快。我提到的问题呼应了这个问题已被接受的答案——这是需要在 D 中解决的“额外”位，它的核心是坚实的。

* * *

## 回答 #3

> 赞同：61
> 
> 时间：2008-10-30T15:30:48.463

我同意 C++ 正在成为一种死胡同——在过去 17 年使用它之后，这么说让我很痛苦。

我认为 D 是 C++ 的正确继承者。从语言的角度来看，它“做所有正确的事情”（即使我不同意每分钟的决定）。我认为随着 C 和 C++ 的衰落，没有其他系统级语言可以真正做到它们所做的事情，同时在现代语言的世界中屹立不倒——除了 D！D 不仅担任这个角色 - 它擅长这个角色！看看 D1.x 应该足以让您相信这一点 - 但当您查看 D2.0 时，它会让您大吃一惊。我认为，在连接命令式和函数式编程范式方面，当今没有其他语言能像 D2.0 一样工作——这只会在未来几年变得更加重要。

缺乏主流接受度——甚至知名度——以及大规模、成熟的图书馆——当然*是*一个障碍。但是，我认为您不能因此而将其注销。我相信 D*将*在未来几年内成长为最重要的语言之一——那些现在认真对待它的人将在那个时候处于领先地位。

我认为差异将在很大程度上归功于 Andrei Alexandrescu 的参与。这并不是要以任何方式诋毁沃尔特·布莱特，他在将 D 带入世界方面做了重要的工作。但 Alexandrescu 无疑是 C++ 社区中一个重要且引人注目的人物 - 大多数潜在的 D 切换器将来自那里。他还在 D2.0 对函数式编程的支持方面做出了重大而重要的贡献。

事实可能仍然证明，D 注定要成为系统级语言的 Betamax ——但我的钱将在未来两年内转向它。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2008-09-29T04:56:44.640

我喜欢 D 是一个天才的作品，主要是一个头脑 - Walter Bright，他的 Zortech 编译器在当时非常出色。

相比之下，C++ 太多是由委员会设计的，即使 Bjarne 是一个影响者。太多的附加功能和奇怪的新语法。这种差异体现在易于学习和易于日常使用，错误更少。

更连贯的语言会带来更好的生产力和程序员的乐趣——但这是主观的和有争议的！（我想我应该投票给我自己的答案）

* * *

## 回答 #5

> 赞同：15
> 
> 时间：2008-09-28T22:10:13.463

D 是一门很好的语言[并且相当流行](http://www.tiobe.com/index.php/content/paperinfo/tpci/index.html)，但像所有语言一样，它只是另一种工具。使用哪种工具取决于你是什么样的人，你的想法，你工作的环境，应用程序的语言限制，最重要的是，程序本身。如果你有时间，我肯定会推荐学习 D。最坏的情况下，你永远不会使用它。您更有可能了解您最喜欢它的哪些方面，以及在什么条件下它最闪耀，并在制作新程序时利用这些优势。

我建议您查看[D 比较表](http://www.digitalmars.com/d/2.0/comparison.html)，了解该语言的功能，看看它是否适合您。

* * *

## 回答 #6

> 赞同：10
> 
> 时间：2011-04-05T20:47:19.347

D语言是现代的。没有语言是完美的，这一点是毫无疑问的。但是语言的诞生是为了让生活更轻松。就复杂性而言，与 C++ 相比，D 语言有很多好的特性。涉及许多其他语言组合专业，帮助编码人员更快地编码，并具有其他语言引入的 TOP 功能。另请参阅： [有关 D 和其他语言的更多详细信息](https://stackoverflow.com/q/5557863/285594)

*   D vs C++，是兼容性，其中涉及大量C++语言并且需要与D兼容。D已经允许与C 100％兼容，这仍然是一个很好的胜利。

*   D vs C++，我认为 C++ 是非常好的语言，但是它很难编码，而且耗时，需要越来越多的经验才能获得成功，但是 D 允许以简单的方式做同样的事情

*   D vs C++，我不确定 C++ 是否可以，但 D 确实允许使用“auto”进行无类型限制变量赋值，这对动态变量很有好处，当需要时你可以创建一个严格的类型

*   D vs C++，如果你有其他语言经验，你可以直接上手，它有简单的学习路线图，由经验丰富的团队和公司支持设计

*   D vs C++，我发现 D 的一个非常好的地方是代码风格，它的外观和感觉与 C/C++ 完全相同，而编码它提醒我正在做真正现代的 C/C++，称为 D

D语言有很多更好的理由，没有理由低估任何语言，它始终是用户的选择。

* * *

## 回答 #7

> 赞同：7
> 
> 时间：2008-09-30T12:19:20.450

这实际上取决于您的需求 - 用 D 编写的大型商业应用程序**确实**存在于服务器端，因此 D（通常使用 Tango/Mango）非常适合，您可能能够满足更多请求与任何其他语言/平台相比。

对于协议和交互性方面的更专业的解决方案（很多都是），您将在查找所需库时遇到更多问题，并且缺乏工具可能会对您产生更大的影响。

* * *

## 回答 #8

> 赞同：7
> 
> 时间：2010-10-01T22:57:48.070

D 令人印象深刻，Andrei 关于它的书写得很好。但正如其他人所说，您需要工具和平台支持。随着时间的推移，GDC 可能会成为这两者的答案。

你见过这个吗？

“GNU 调试器增加了 D 语言支持”： [http ://www.linux.com/news/enterprise/biz-enterprise/358956-gnu-debugger-adds-d-language-support](http://www.linux.com/news/enterprise/biz-enterprise/358956-gnu-debugger-adds-d-language-support)

此外，digitalmars 站点有讨论与 C 和 C++ 接口的页面（对于那些你不能没有的库）。我想知道是否有任何工具可以在给定 C 头文件的情况下尝试编写 D 原型。

就个人而言，此时我不会推动用 D 做一个大型项目，但我*会将*D 用于内部工具，获得使用它的经验并将其介绍给其他人。

最初的问题是 D 是否是 Java 和 C++ 的可靠替代品。我不认为 D 和 Java 在实践中真的会竞争太多。D 与 C++ 竞争，现在与 Go 竞争。其他问题解决了 D 和 Go 之间的差异，但 Go 通常被认为更易于使用。所以我怀疑 D 的未来在很大程度上取决于它在 C++（当前的山丘之王）和 Go（得到 Google 支持的更简单的替代方案）之间有多少喘息的空间。

更新：我刚刚发现[Andrei 的书中我最喜欢的章节，](http://www.informit.com/articles/article.aspx?p=1609144)关于并发的章节，可以在线免费获得。绝对值得一读！

这是[关于 Go 和 D 的相对优点/目标/方法的长期讨论](https://groups.google.com/forum/#!topic/golang-nuts/8k59RgkeJ6s)。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2008-11-18T12:50:15.773

作为一门语言，我一直觉得 D 比 C++ 更接近 C#。不在功能和库中，而是在“感觉”中。它更干净、更好……有趣（比 C++）。恕我直言，成为可靠替代品的最大障碍是工具、IDE 和调试器。如果 D 克服了广泛使用/采用的一些障碍，将会出现更多的工具和库。（如果有可用的 IDE 和调试器，我自己将返回 D。）

* * *

## 回答 #10

> 赞同：4
> 
> 时间：2011-04-05T01:01:08.217

看起来这个问题已经回答了。与 C++ 相比，D 是更好的语言。

出于实际目的，D 周围是否有更好的基础设施的问题是次要的。

简而言之，如果它们都是全新的语言，没有任何支持，那么 D 是更好的语言，因此它是更好的语言。

* * *

## 回答 #11

> 赞同：3
> 
> 时间：2008-09-29T04:48:01.400

非常适合我自己的宠物项目。我会将它用于雇主的项目，但不知道在我离开后他们很难找到人来接管源。至少在受支持的平台上，没有技术原因可以避免它。（敲木头）

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2009-01-28T04:15:14.177

它看起来像是一门设计得很好的语言；比 C - C++ - 目标 C 好得多。我可以在没有 IDE 或调试器的情况下生活一段时间，但不能没有一个好的、文档化的 D 2.0 库。

我会在 6 个月后复查...

* * *

## 回答 #13

> 赞同：3
> 
> 时间：2009-03-08T07:59:15.653

一种方法是搜索您所在地区的工作。找到你想做的工作，看看他们要求什么技能。如果他们要求 C++ 或 Ruby 或 Oracle 或 D，那么这就是主要帮助您获得所需工作的技能。

# c++ - TinyXML 的 UTF-8 支持如何工作？

> ID：146873
> 
> 赞同：12
> 
> 时间：2008-09-28T22:12:20.620
> 
> 标签：c++, unicode, utf-8, tinyxml

我正在使用[TinyXML](http://www.grinninglizard.com/tinyxml/)来解析/构建 XML 文件。现在，根据[文档](http://www.grinninglizard.com/tinyxmldocs/)，该库通过 UTF-8 支持多字节字符集。到目前为止，我认为很好。但是，该库提供的唯一 API（用于获取/设置元素名称、属性名称和值，......使用字符串的所有内容）是通过`std::string`or `const char*`。这让我怀疑自己对多字节字符集支持的理解。仅支持 8 位字符的字符串如何包含 16 位字符（除非它使用代码页，否则会否定“支持 Unicode”声明）？我了解您理论上可以采用 16 位代码点并将其拆分为 a 中的 2 个字符`std::string`，但这不会改变`std::string`对于“Unicode”字符串，它会使其在大多数用途中无效，并且在写入文件并被另一个程序读入时可能会意外工作。

那么，有人可以向我解释一个库如何提供“8 位接口”（`std::string`或`const char*`）并且仍然支持“Unicode”字符串吗？

（我可能在这里混淆了一些 Unicode 术语；对于由此产生的任何混淆，我深表歉意）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2008-09-28T23:49:50.633

首先，正如@quinmars 所说，utf-8 存储在 const char * 字符串中。而且它不仅是 7 位 ASCII 的超集（代码点 <= 127 总是像它们自己一样在单个字节中编码），而且还要小心的是，具有这些值的字节永远不会用作代码点的多字节值编码的一部分>= 128。因此，如果您看到一个字节 == 44，它是一个“<”字符等。XML 中的所有元字符都是 7 位 ASCII 格式。因此，可以只解析 XML，在元字符所说的地方分解字符串，将片段（可能包括非 ASCII 字符）粘贴到 char * 或 std::string 中，并且返回的片段仍然是有效的 UTF-8 字符串，即使解析器并不特别了解 UTF-8。

此外（不是特定于 XML，而是相当聪明），更复杂的事情通常也能正常工作（tm）。例如，如果您按字节按字典顺序对 UTF-8 进行排序，您会得到与按代码点按字典顺序排序相同的答案，尽管使用的字节数有所不同，因为前缀字节引入了更长（因此价值更高）的代码点在数值上大于较小值的点）。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-28T22:56:13.323

UTF-8 与 7 位 ASCII 码兼容。如果一个字节的值大于 127，这意味着一个多字节字符开始。根据第一个字节的值，您可以看到字符将占用多少字节，包括第一个字节在内可能是 2-4 个字节（技术上也可以是 5 或 6 个字节，但它们不是有效的 utf-8）。这是关于 UTF-8 的一个很好的资源：[UTF-8 和 Unicode 常见问题解答](http://www.cl.cam.ac.uk/~mgk25/unicode.html)，utf8 的 wiki 页面也提供了非常丰富的信息。由于 UTF-8 是基于字符且以 0 结尾的，因此您可以在大多数情况下使用标准字符串函数。唯一重要的是字符数可能与字节数不同。strlen() 之类的函数返回字节数，但不一定返回字符数。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T23:43:08.357

通过使用 1 到 4 个字符来编码一个 Unicode 代码点。

# java - 在 Linux 上使用 ANT、Javacc、JUnit 和编译 Java 类加快构建时间的技巧

> ID：146888
> 
> 赞同：5
> 
> 时间：2008-09-28T22:21:22.297
> 
> 标签：java, linux, ant, junit, javacc

我们有一个庞大的代码库，在开发人员机器上大约需要 12 分钟才能使用 JavaCC 自动生成一些 Java 5 类，然后编译所有类并运行单元测试。

该项目由多个可以分组构建的项目组成，但我们的目标是在 10 分钟内完成一个完整的构建

有什么技巧可以减少此构建时间？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-28T23:03:55.363

一种可能节省一些时间的快速修复方法是确保您使用服务器 JVM 运行 Ant（默认情况下它使用客户端 VM）。将 ANT_OPTS 设置为包括“-server”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-28T23:11:56.560

*   分析构建过程并查看瓶颈在哪里。这可以为您提供一些关于如何改进流程的想法。
*   尝试在多核/CPU 机器上并行构建独立项目。作为这个想法的扩展，您可能想四处寻找与 distcc 等效的 Java（不知道它是否存在），以将您的构建分发到多台机器上。
*   获得更好的机器。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-10-23T10:09:24.357

减少构建时间的一些技巧：

1.  **做更少的工作。** 例如删除不必要的日志记录/回显到文件和控制台

2.  **使您的构建“增量”**。编译只改变类。

3.  **消除重复劳动。** 说起来容易做起来难，但是如果你在调试模式下运行构建（“ant -debug”），你有时会看到冗余的任务或目标。

4.  **避免昂贵的操作。** 复制文件，以及将 jar 打包成 war 是发布所必需的。对 jar 进行签名很昂贵，并且只有在可能的情况下才应该为里程碑发布而不是每次构建都这样做

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-29T20:50:19.793

现在您已经更详细地解释了该过程，这里还有两个选项：

1.  专用机器/集群，其构建速度比普通工作站快得多。然后，开发人员将在提交之前运行一个脚本，在专用机器/集群上构建他们的代码。

2.  将分区更改为子项目，以便通过修改另一个项目来破坏一个项目更加困难。这应该会降低在每次提交之前进行完整构建的重要性。只有涉及敏感子项目或跨越多个项目的提交才需要通过完整构建进行“检查”。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2008-09-29T13:58:34.683

尝试受到务实程序员的启发。只编译必要的，有两个或更多的测试套件。一个用于快速测试，另一个用于完整测试。考虑是否真的需要每次都使用每个构建步骤。有必要尝试使用 jikes 编译器而不是 javac。在项目跨越数百个课程后，我改用 jikes 来提高速度。但请注意潜在的不兼容问题。不要忘记将一个多合一的目标包含在内，以通过完全重建和项目的全面测试来执行每一步。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T00:46:47.800

这在短期内可能无济于事，但我认为无论如何我都应该把它扔掉。

如果您的项目可以拆分为更小的项目（例如数据库子系统、日志记录等），您可能会对使用 maven 之类的东西来处理构建感兴趣。您可以将每个较小的部分作为单独的项目或模块运行，如果存在更改，maven 将能够维护需要构建的内容。在这种情况下，构建可以专注于项目的主要部分，并且不会花费那么长时间。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T02:13:35.437

所用时间的细分是什么：

1.  生成类
2.  编译类
3.  运行测试

根据您的项目，通过为 javac(memoryMaximumSize) 和 junit(maxmemory) 分配更大的堆大小，您可能会看到构建时间显着增加。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T17:17:40.810

*整个*构建持续时间少于 10 分钟非常重要吗？如果您使子项目彼此独立，您可以在已经编译其他子项目的同时处理一个子项目（想想 Maven 或 Ivy 来管理依赖项）。

另一种解决方案（如果您的模块相当稳定）是将您的子项目视为独立项目。然后，每个项目都将遵循自己的发布周期，并可从本地 Maven/Ivy 存储库中获得。如果至少项目的一部分相当稳定，这当然会很好。

# api - 有人成功使用 Commission Junction API 吗？

> ID：146890
> 
> 赞同：3
> 
> 时间：2008-09-28T22:22:38.050
> 
> 标签：api, cj, commission-junction

有人成功使用 CJ 网络服务吗？`java.lang.NullPointerException`即使我的应用程序是 .net （显然是他们的错误），我也会不断收到s 。CJ 支持甚至不知道 Web 服务是什么。我用谷歌搜索，发现很多人遇到这个或其他错误。问题是：这是一个暂时的问题，还是我注定要永远解析手动下载的报告？

我尝试使用的特定 API 是[每日发布者佣金服务](http://help.cj.com/en/web_services/Publisher_Commission_Service.htm)。[这](https://pubcommission.api.cj.com/wsdl/version2/publisherCommissionService.wsdl)是 WSDL。

链接：

*   [CJ 网络服务主页](http://webservices.cj.com/)
*   [API 参考](http://help.cj.com/en/web_services/web_services.htm)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-06-30T05:02:28.477

花了很多天后，这段代码对我有用。

```
$client = new SoapClient($cjCommissionUrl,

    array('trace' => 1,
    'soap_version' => SOAP_1_1,
    'style' => SOAP_DOCUMENT,
    'encoding' => SOAP_LITERAL
    ));

$date = '06/23/2010';
    $results = $client->findPublisherCommissions(array(
    "developerKey" => $cjDeveloperKey,
    "date" => $date,
    "dateType" => 'posting',
    "countries" => 'all',
)); 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-04T17:51:22.000

我已经成功地将 CJ 的 API 与 PHP 一起使用，但不是这个特定的 WSDL。我对缺乏文档感到非常困扰，甚至找不到任何认真的程序员使用它（所有业余爱好者基本上都在尝试复制粘贴）。如果您有更多经验，我们也许可以互相帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-12-23T07:24:24.623

例如创建一个页面 cjcall.php

粘贴此代码并根据您的要求进行操作，即关键字、设备 ID、每页记录

```
include('../../../../wp-load.php');

$stringkeyw=urlencode(get_option('cj_keyword'));
if(get_option('rm_num_products')==''){
$pperkeyword=50;
}else{
$pperkeyword= get_option('rm_num_products');
}//number of products against keyword

$ch = curl_init();

curl_setopt($ch, CURLOPT_URL, "https://product-search.api.cj.com/v2/product-search?website-id=".get_option('cj_siteid')."&keywords=".$stringkeyw."&records-per-page=".$pperkeyword."&serviceable-area=US");

curl_setopt($ch, CURLOPT_HEADER,false); 

curl_setopt($ch, CURLOPT_HTTPGET, true); 

curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);

curl_setopt($ch, CURLOPT_HTTPHEADER, array("Accept: application/xml",  "Authorization:".get_option('cj_devid').""));

$result = curl_exec($ch); 
```

创建另一个页面并粘贴以下代码以从该页面获取 xml：

```
$hurl= home_url();
$homepage = file_get_contents(''.$hurl.'/wp-content/plugins/rapid_monetizer/cronjob/cjcall.php');
$object = simplexml_load_string($homepage);

    foreach($object->products->product as $cjres)
    {
       //do your code with products coming in $cjres
         } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-03-08T06:44:59.430

我编写了一个 Python 库，用于从 CJ 检索佣金信息。这是代码：[https ://github.com/sidchilling/commissionjunction-python-lib](https://github.com/sidchilling/commissionjunction-python-lib)

为我工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-07T22:46:02.067

我可以为你做一个用户界面来解除你的诅咒！！！

使用每日出版商佣金报告服务！

如果您仍然需要帮助，请在这里告诉我。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-06-15T17:54:26.267

编辑：首先，如果没有佣金报告，您将不会得到任何结果。

我正在使用这些 API，我对任何 REST API 都没有问题，用于每日发布者佣金服务的 SOAP API 似乎无法正常工作。结果来自：

```
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:api="https://pubcommission.api.cj.com">
       <soapenv:Header/>
       <soapenv:Body>
          <api:findPublisherCommissions>
             <api:developerKey>*DEVKEY*</api:developerKey>
             <api:date>01/19/2007</api:date>
             <api:dateType>event</api:dateType>
             <api:advertiserIds></api:advertiserIds>
             <api:websiteIds>123456</api:websiteIds>
             <api:actionStatus>all</api:actionStatus>
             <api:actionTypes></api:actionTypes>
             <api:adIds></api:adIds>
             <api:countries></api:countries>
             <api:correctionStatus></api:correctionStatus>
             <api:sortBy>commissionAmount</api:sortBy>
             <api:sortOrder>desc</api:sortOrder>
          </api:findPublisherCommissions>
       </soapenv:Body>
    </soapenv:Envelope> 
```

这是完全有效和正确的，给了我一个 HTML 页面。您的错误可能与将页面解析为 XML 有关。

结果是：

```
<html>
<head>
<title>Web Services</title>
</head>

<body vlink="#333333" alink="#FFCC33" bgcolor="#FFFFFF" leftmargin="0" marginwidth="0" topmargin="0" marginheight="0">
    <table cellpadding="0" cellspacing="0" border="0" width="100%">
        <tr>
            <td background="images/header_bg.gif">
                <a href="http://webservices.cj.com"><img src="images/header.gif" width="600" height="63" border="0" alt="webservices.cj.com" /></a>
            </td>
        </tr>
    </table>

<h3>Latest WSDLs</h3>
<table width=70%><tr><td>
<ul>
  <li>ProductSearchServiceV2.0<a href="wsdl/version2/productSearchServiceV2.wsdl">[wsdl]</a><img src="images/new11.gif"  width="40" height="15"/></li>
  <li>LinkSearchServiceV2.0<a href="wsdl/version2/linkSearchServiceV2.wsdl">[wsdl]</a><img src="images/new11.gif"  width="40" height="15"/></</li>  
  <li>PublisherCommissionService and ItemDetails V2.0<a href="wsdl/version2/publisherCommissionServiceV2.wsdl">[wsdl]</a><img src="images/new11.gif"  width="40" height="15"/></</li>
  <li>RealTimeCommissionServiceV2.0<a href="wsdl/version2/realtimeCommissionServiceV2.wsdl">[wsdl]</a><img src="images/new11.gif"  width="40" height="15"/></</li>
  <li>AdvertiserSearchService<a href="wsdl/version2/advertiserSearchServiceV2.wsdl">[wsdl]</a></li>
  <li>FieldTypesSupportService<a href="wsdl/version2/supportServiceV2.wsdl">[wsdl]</a></li>
</ul>
</td></tr></table>

<h3>Previously Released WSDLs</h3>
For previous versions of the wsdls <a href="old_versions.jsp">click here.</a><p>

<h3>Sign Up</h3>
<ul>
  <li><a href="sign_up.cj">Sign Up</a></li>
</ul>

</body>
</html> 
```

我已经给他们发了一封电子邮件，期待今天的回复。我将与您确认此 API 仍然可用，它*可能*已被实时发布者佣金 API 完全取代。

# theory - 在大会中学习的关键概念

> ID：146893
> 
> 赞同：7
> 
> 时间：2008-09-28T22:25:00.137
> 
> 标签：theory, assembly

我坚信从学习一门新语言中获得的最重要的东西之一不是如何使用一门新语言，而是你从中获得的概念知识。我不是在问你认为 Assembly 有多重要或有用，我也不关心我是否从未在我​​的任何实际项目中使用它。

我想知道的是您认为对于任何普通程序员来说最重要的汇编概念是什么？它不必与 Assembly 直接相关——它也可能是您认为将所有时间都花在高级语言上的典型程序员无法理解或认为理所当然的东西，例如 CPU 缓存。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2008-10-01T03:46:21.953

## 注册分配和管理

汇编可以让您很好地了解 CPU 可以同时处理多少个变量（机器字大小的整数）。如果你可以分解你的循环，使它们只涉及几个临时变量，它们都可以放入寄存器中。如果没有，您的循环将随着事物被换出到内存而缓慢运行。

这确实帮助了我的 C 编码。我尽量让所有的循环都紧凑而简单，尽可能少的意大利面。

## x86 很笨

学习了几种汇编语言让我意识到 x86 指令集是多么的蹩脚。可变长度指令？难以预测的时机？非正交寻址模式？啊。

如果我们都运行 MIPS，我认为，甚至是 ARM 或 PowerPC，世界会更好 :-) 或者更确切地说，如果英特尔/AMD 采用他们的半导体专业知识并用它来制造多核、超快、超便宜的 MIPS处理器而不是具有所有这些可取之处的 x86 处理器。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2008-11-05T00:49:31.933

我认为汇编语言可以教你很多小东西，以及一些大概念。

我将在这里列出一些我能想到的东西，但没有什么可以替代学习和使用 x86 和 RISC 指令集。

您可能认为整数运算是最快的。如果您想找到整数的整数平方根（即 floor(sqrt(i))），最好使用仅整数近似例程，对吗？

不。数学协处理器（在 x86 上）有一条**fsqrt**指令。转换为浮点数、取平方根并再次转换为 int 比全整数算法更快。

还有一些事情，比如访问内存，你可以遵循，但不能正确理解，直到你深入研究汇编。假设您有一个链接列表，并且列表中的第一个元素包含一个您需要经常访问的变量。该列表很少重新排序。好吧，每次您需要访问该变量时，您都需要加载指向列表中第一个元素的指针，然后使用它加载变量（假设您不能在两次使用之间将变量的地址保存在寄存器中） . 如果您将变量存储在列表之外，则只需要一次加载操作。

当然，现在在这里节省几个周期通常并不重要。但是，如果您打算编写需要快速的代码，那么这种知识既可以应用于内联汇编，也可以应用于其他语言。

调用约定怎么样？（一些汇编程序会为您处理这个问题——真正的程序员不使用这些。）调用者或被调用者是否清理堆栈？你甚至使用堆栈吗？您可以在寄存器中传递值 - 但由于有趣的 x86 指令集，最好在某些寄存器中传递某些东西。哪些寄存器将被保留？C 编译器自己无法真正优化的一件事是调用。

有一些小技巧，比如 PUSH 一个返回地址，然后 JMP 进入一个过程；当程序返回时，它将转到 PUSHed 地址。这种对函数调用的通常思维方式的背离是另一种“启蒙状态”。如果你曾经设计过一种具有创新功能的编程语言，你应该知道硬件能够做的有趣的事情。

汇编语言知识可以教给您有关计算机安全的特定于体系结构的知识。您如何利用缓冲区溢出或闯入内核模式，以及如何防止此类攻击。

然后是自我修改代码的超级酷，以及作为相关问题的机制，例如重定位和对代码应用补丁（这也需要研究机器代码）。

但是所有这些事情都需要正确的心态。如果你是那种能把

```
while(x--)
{
  ...
} 
```

一旦你学会了它的作用，但发现自己很难弄清楚它的作用，那么汇编语言可能会浪费你的时间。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-09-28T22:48:00.907

了解汇编语言是很好的，这样可以更好地了解计算机“幕后”是如何工作的争取找出问题所在的机会。但是，尝试将低级知识应用于高级编程语言，例如尝试利用 CPU 缓存指令的方式，然后编写不稳定的高级代码来强制编译器生成超高效的机器代码，这可能是表明您正在尝试进行微优化。在大多数情况下，通常最好不要试图超越编译器，除非您需要提高性能，在这种情况下，您最好还是在汇编中编写这些位。

因此，为了更好地理解事物的工作原理，了解汇编是件好事，但获得的知识不一定直接适用于您如何用高级语言编写代码。然而，在这一点上，我发现学习函数调用如何在汇编代码级别工作（了解堆栈和相关寄存器，了解参数如何在堆栈上传递，了解自动存储的工作原理等）可以做到更容易理解我在高级代码中遇到的问题，例如“堆栈空间不足”错误和“无效调用约定”错误。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2008-09-29T01:21:02.880

最重要的概念是 SIMD，并创造性地使用它。正确使用 SIMD 可以在从字符串处理到视频处理再到矩阵数学的各种应用中带来巨大的性能优势。*与纯 C 代码*相比，您可以获得超过10 倍的性能提升——这就是为什么汇编在单纯的调试之外仍然有用的原因。

我从事的项目中的一些示例（所有数字都是 Core 2 上的时钟周期数）：

逆 8x8 H.264 DCT（频率变换）：

```
c: 1332
mmx: 187
sse2: 127 
```

8x8 色度运动补偿（双线性插值滤波器）：

```
c: 639
mmx: 144
sse2: 110
ssse3: 79 
```

4 16x16 Sum of Absolute Difference 运算（运动搜索）：

```
c: 3948
mmx: 278
sse2: 231
ssse3: 215 
```

（是的，没错——比 C 快 18 倍以上！）

16x16 块的均方误差：

```
c: 1013
mmx: 193
sse2: 131 
```

16x16 块的方差：

```
c: 783
mmx: 171
sse2: 106 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-28T22:33:21.490

内存、寄存器、跳转、循环、移位和可以在汇编程序中执行的各种操作。我不会怀念调试我的汇编语言类程序的日子——它们很痛苦！- 但它确实给了我一个很好的基础。

我们忘记了（或者永远不知道，也许）我们今天使用的所有这些花哨的东西（而且我喜欢！）最终归结为所有这些东西。

现在，我们当然可以在不了解汇编程序的情况下拥有一份富有成效和利润丰厚的职业，但我认为了解这些概念是件好事。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2008-09-29T01:32:01.077

我想说，在汇编中学习递归和循环教会了我很多东西。它让我理解了我正在使用的语言的编译器/解释器如何将事物推入堆栈并在需要时将它们弹出的基本概念。我还学会了如何利用臭名昭著的堆栈溢出。（在 C 中使用一些 get- 和 put- 命令仍然非常容易）。

除了在日常情况下使用 asm 之外，我认为我不会使用程序集教给我的任何概念。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-28T22:34:08.943

如今，x86 asm 不再是 CPU 内部的直接线路，而更像是一个 API。您编写的汇编器操作码本身被编译成完全不同的指令集，重新排列、重写、修复，并且通常被破坏得面目全非。

因此，学习汇编程序并不能让您对 CPU 内部发生的事情有一个基本的了解。恕我直言，比学习汇编程序更重要的是要很好地了解目标 CPU 和内存层次结构的工作原理。

[本](http://lwn.net/Articles/250967/)系列文章非常彻底地涵盖了后一个主题。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T01:10:05.933

我会说寻址模式非常重要。

我的母校把它发挥到了极致，因为 x86 没有足够的它们，我们在 PDP11 的模拟器上研究了所有东西，我记得至少有 7 个。回想起来，这是一个不错的选择。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-09-29T02:11:36.177

## 定时

快速执行：

*   并行处理
*   简单说明
*   查找表
*   分支预测，流水线

快速到慢速访问存储：

*   寄存器
*   缓存，以及各种级别的缓存
*   内存堆和栈
*   虚拟内存
*   外部输入/输出

# asp.net - 如何在不使用 Membership.GetUser() 的情况下访问 ASP.NET Membership 中的 UserId？

> ID：146896
> 
> 赞同：17
> 
> 时间：2008-09-28T22:25:27.467
> 
> 标签：asp.net, asp.net-membership, membership

如何在不使用ASP.NET Web 应用程序项目的情况下访问`UserId`ASP.NET Membership ？`Membership.GetUser(username)`

可以`UserId`包含在( )`Profile`旁边的命名空间中吗？`UserName``System.Web.Profile.ProfileBase`

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-01-06T14:27:53.230

试试这个：

```
MembershipUser CurrentUser = Membership.GetUser(User.Identity.Name);
Response.Write("CurrentUser ID :: " + CurrentUser.ProviderUserKey); 
```

* * *

## 回答 #2

> 赞同：13
> 
> 时间：2008-09-29T05:50:53.840

您是否每次需要 UserId 时都保存数据库调用？如果是这样，当我使用 ASP.NET MembershipProvider 时，我通常要么做一个允许我缓存该调用的自定义提供程序，要么做一个我可以缓存的实用程序方法。

如果您正在考虑将其放入配置文件中，我认为这样做没有太多理由，特别是因为它仍然需要数据库调用，除非您在那里使用自定义配置文件提供程序，否则它具有额外的处理解析出 UserId。

如果您想知道为什么他们没有实现 GetUserId 方法，那仅仅是因为您并不总是保证该用户 ID 将是包含的提供程序中的 GUID。

编辑：

请参阅[ScottGu 关于提供程序的文章，](http://weblogs.asp.net/scottgu/archive/2006/04/13/442772.aspx)该文章提供了[下载实际源代码的链接，即 SqlMembershipProvider](http://download.microsoft.com/download/a/b/3/ab3c284b-dc9a-473d-b7e3-33bacfcc8e98/ProviderToolkitSamples.msi)。

但最简单的做法是用户对象或实用程序类中的 GetUserId() 方法，如果存在，则从缓存/会话中获取 UserId，否则访问数据库，通过用户名缓存（或存储在会话中），并返回它。

更多需要考虑的事情（但由于 cookie 大小限制要非常小心）：[Forms Auth: Membership, Roles and Profile with no Providers and no Session](http://www.eggheadcafe.com/tutorials/aspnet/33d4018a-03cf-48aa-9b68-82ba27aa6af9/forms-auth-membership-r.aspx)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2008-10-02T08:10:21.577

我决定自己编写用户用户身份验证（非常简单但有效），我早就应该这样做了。

我最初的问题是关于 UserId 的，但无法从以下位置获得：

```
System.Web.HttpContext.Current.User.Identity.Name 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2013-04-15T23:40:19.763

尝试以下操作：

```
Membership.GetUser().ProviderUserKey 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2014-11-21T21:38:50.463

```
public string GetUserID()
            {
                MembershipUser _User;
                string _UserId = "";
                _User = Membership.GetUser();
                Guid UserId = (Guid)_User.ProviderUserKey;
                return _UserId = UserId.ToString();
            } 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T09:04:46.947

您在这里有两个选择：

1) 使用用户名作为用户数据表的主键，即：

```
select * from [dbo.User] where Username = 'andrew.myhre' 
```

2) 将 UserID 添加到配置文件中。

每种方法都有优点和缺点。我个人更喜欢第一个，因为这意味着我不一定需要设置开箱即用的配置文件提供程序，而且我更喜欢在我的系统中强制执行唯一的用户名。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-30T17:49:15.603

安德鲁：我会小心地做一个像你默认显示的查询，没有与之匹配的索引，所以你冒着全表扫描的风险。此外，如果您将用户数据库用于多个应用程序，则您没有包含应用程序 ID。

最接近的索引是 aspnet_Users_Index，它需要 ApplicationId 和 LoweredUserName。

编辑：

糟糕 - 重读 Andrew 的帖子，他没有在 aspnet_Users 表上选择 *，而是使用用户名作为主键的自定义配置文件/用户表。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-30T18:17:05.753

你试过使用`System.Web.HttpContext.Current.User.Identity.Name`吗？（确保首先验证它`User`并且`Identity`是非空的。）

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2008-12-07T03:29:55.117

```
{
MembershipUser m = Membership.GetUser();
Response.Write("ID: " + m.ProviderUserKey.ToString());
} 
```

将从 aspnet_Membership 表中为您提供当前用户的 UserID（唯一标识符） - 前提是当前用户已成功登录。如果您尝试 <%= %> 或在成功验证之前分配该值，您将收到错误“对象引用未设置为对象的实例”。

[http://www.tek-tips.com/viewthread.cfm?qid=1169200&page=1](http://www.tek-tips.com/viewthread.cfm?qid=1169200&page=1)

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2011-07-13T09:49:18.713

我遇到了这个问题，解决方案是在 web.config 配置中，尝试使用这些配置 web.config：

```
 <roleManager
             enabled="true"
             cacheRolesInCookie="true"
             defaultProvider="QuickStartRoleManagerSqlProvider"
             cookieName=".ASPXROLES"
             cookiePath="/"
             cookieTimeout="30"
             cookieRequireSSL="false"
             cookieSlidingExpiration="true"
             createPersistentCookie="false"
             cookieProtection="All">
  <providers>
    <add name="QuickStartRoleManagerSqlProvider"
        type="System.Web.Security.SqlRoleProvider, System.Web, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a"
        connectionStringName="ASPNETDB"
        applicationName="SecurityQuickStart"/>
  </providers>
</roleManager> 
```

# php - PHP中的bindParam覆盖错误

> ID：146897
> 
> 赞同：2
> 
> 时间：2008-09-28T22:25:27.747
> 
> 标签：php, pdo

这有点奇怪，我很可能完全错误地编写了这个代码 - 因此我在两天内两次在脚本的完全不同部分遇到了相同的错误。我正在使用的代码如下：

```
 public function findAll( $constraints = array() ) {

        // Select all records
        $SQL = 'SELECT * FROM ' . $this->tableName;

        // See if there's any constraints
        if( count( $constraints ) > 0 ) {
            $SQL .= ' WHERE ';

            foreach( $constraints as $field => $value ) {
                $SQL .= $field . ' = :' . $field . ' AND ';
            }

        }

        // Remove the final AND and prepare the statement
        $SQL = substr( $SQL, 0, -5 );       
        $PDOStatement = $this->PDO->prepare( $SQL );

        // Loop through constraints and bind parameters
        foreach( $constraints as $field => $value ) {
            print 'Binding ' . $field . ' to ' . $value . ' 
';
            $PDOStatement->bindParam( $field, $value );
        }

        $PDOStatement->execute();
        var_dump($PDOStatement);        

        while ( $results = $PDOStatement->fetch( PDO::FETCH_ASSOC ) ) {

            var_dump($results);

        }

    } 
```

我对使用 PDO 很陌生，但基本上我正在尝试传递一系列约束，例如

```
array( 'active' => 1, 'name' => 'James' )
```

并返回表中的所有行

```
WHERE active = 1 AND name = 'James'
```

如果我使用这个数组，则从第一个执行的 SQL

```
var_dump( )
```

是

```
SELECT * FROM {table} WHERE active = :active AND name = 'James'
```

——正如我所料。绑定参数打印“Binding active to 1”和“Binding name to James”——完全符合预期。这些行存在于数据库中，但第二个

```
var_dump()
```

调用 $results 不输出任何内容 - 即不返回任何行。

如果我传递单个约束的数组，例如

```
array( 'active' => 1 )
```

，这工作得很好。似乎只要通过了多个约束，它就会停止工作。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2008-09-28T22:43:30.623

那是因为[`bindParam`](http://docs.php.net/manual/en/pdostatement.bindparam.php)通过绑定到变量来工作，并且您正在将变量 ( `$value`) 重新用于多个值。尝试使用[`bindValue`](http://docs.php.net/manual/en/pdostatement.bindvalue.php)。

甚至更好；将值作为数组传递给[`execute`](http://docs.php.net/manual/en/pdostatement.execute.php)。这使得语句无状态，这在编程中通常是一件好事。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2014-12-26T05:48:15.650

如前所述，使用[`bindValue`](http://docs.php.net/manual/en/pdostatement.bindvalue.php)而不是[`bindParam`](http://docs.php.net/manual/en/pdostatement.bindparam.php)肯定会实现这一点。然而，在最近花了相当多的时间解决这个问题之后，我发现了一个替代解决方案。下面是如何使用 bindParam 在 foreach 循环中完成 PDO 变量绑定：

替换原始帖子中的以下行：

```
$PDOStatement->bindParam( $field, $value ); 
```

...有了这个：

```
$PDOStatement->bindParam( $field, $constraints[$field] ); 
```

代替绑定`$value`，使用`$array_name[$array_key]`. 这是有效的，因为您现在绑定到一个唯一变量，而不是在循环的每次传递中重复使用的变量。

然而，用作占位符的变量`$field`显然不需要是唯一变量。我尚未对此进行彻底研究，但即使使用 bindParam，用作占位符的变量似乎也会立即被解析（而不是被分配为变量引用）。

此外，由于您不再需要`$value`直接访问，您也可以替换它：

```
foreach( $constraints as $field => $value ) { 
```

... 有了这个：

```
foreach (array_keys($constraints) as $field) { 
```

这是可选的，因为没有此更改它可以正常工作。不过，在我看来，它看起来更干净，因为它可能会在稍后为什么`$value`被分配但从未使用过的问题上变得混乱。

# c# - 如何正确地将动态文件写入 FTP 服务器？

> ID：146901
> 
> 赞同：1
> 
> 时间：2008-09-28T22:28:29.643
> 
> 标签：c#, ftp

我正在使用 C#，并且我编写了一个本地安装的应用程序，它可以动态生成需要在 FTP 服务器上的文件。

我是否将它们生成到磁盘然后将它们上传到 FTP 服务器？或者有没有办法打开一个流到 FTP 服务器并直接写入文件？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-28T23:43:38.513

检查我在这个答案中给出的代码示例，不依赖于写入文件。它不是特定于 SQL 的，只是关于如何使用 SQL CLR 集成程序集将 sql 查询的输出上传到 FTP 服务器的建议。方法中的 for 循环只是为了演示写入 FTP 流。您应该能够根据需要进行返工：

[如何在不使用本地或临时文件的情况下将存储过程输出直接写入 FTP 上的文件？](https://stackoverflow.com/questions/20587/execute-stored-procedure-sql-2005-and-place-results-into-a-csv-file-on-a-ftp-lo#20689)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-28T22:38:10.963

你应该听课：

```
System.Net.FtpWebRequest 
```

您将看到它的参数是流，您可以从任何来源向它们发送数据。

在搜索 .Net 功能时，您应该了解 Visual Studio 的对象浏览器可在以下位置访问：

查看 > 其他窗口 > 对象浏览器

提供对所有已知程序集 .Net 对象的搜索。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-09T13:58:52.610

更好的方法是将文件保存在本地，然后再上传，因为上传过程可能会出现问题。

* * *

## 回答 #4

> 赞同：-2
> 
> 时间：2008-09-28T22:37:38.077

由于您使用的是 c#，我想您可能在 Windows 环境中。我对此知之甚少:)

如果您正在处理 unix 环境，您可以通过 SSH 管道输出您的输出，这也将处理加密开销。

# process - Top & httpd - 揭开实际运行的神秘面纱

> ID：146906
> 
> 赞同：4
> 
> 时间：2008-09-28T22:31:11.043
> 
> 标签：process, apache

我经常使用“top”命令来查看占用资源的内容。大多数情况下，它会提供一长串 Apache httpd 进程，这不是很有用。有什么办法可以看到类似的列表，但这样我就可以看到那些 httpd 进程实际运行的 PHP 脚本等？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-28T22:43:44.553

如果您担心长时间运行的进程（即执行时间超过一两秒的请求），您将能够使用 Apache 的 mod_status 了解它们。请参阅[文档](http://httpd.apache.org/docs/2.0/mod/mod_status.html)和[输出示例](http://www.apache.org/server-status)（来自 www.apache.org）。这不是 PHP 独有的，而是适用于在 apache 进程中运行的任何东西。

请注意，www.apache.org 状态输出是公开可用的，大概是出于演示目的——您希望限制对您的状态的访问，以便不是每个人都可以看到它。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-10-04T20:58:16.493

有一个类似于 top 的基于 ncurses 的实用程序，称为[apachetop](http://spork.qfe3.net/apachetop/)，它为 Apache 提供实时日志分析。不幸的是，该项目已被放弃并且代码存在一些错误，但它实际上非常有用。只是不要以 root 身份运行它，以任何有权访问 Web 服务器日志文件的用户身份运行它，你应该没问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-28T22:36:05.867

php 脚本发生得如此之快，顶部不会向您展示太多。或者它会很快通过。大多数网络请求都非常快。

我认为您最好的选择是拥有某种类型的实时日志处理器，它会密切关注您的访问日志并为您更新平均运行时间、内存使用情况等的统计信息。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-28T22:44:39.620

你可以让你的 PHP 页面自己计时，并将它们的路径和执行时间写入文件或数据库。请注意，这会在您监控时减慢一切，但它可以作为一种很好的测量方法。

不过，它不会那么互动。您可以从中获得每日或每周的结果，但很难在几分钟或几小时内看到有意义的东西。

# mysql - MySQL主要在做什么？

> ID：146914
> 
> 赞同：2
> 
> 时间：2008-09-28T22:36:55.537
> 
> 标签：mysql

有什么方法可以查看每天在 MySQL 上花费最多时间的查询类型的概述？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-28T22:47:36.337

是的，mysql可以创建慢查询日志。您需要从`mysqld`标志`--log-slow-queries`开始：

```
mysqld --log-slow-queries=/path/to/your.log 
```

然后您可以使用以下方法解析日志`mysqldumpslow`：

```
mysqldumpslow /path/to/your.log 
```

更多信息在这里（[http://dev.mysql.com/doc/refman/5.0/en/slow-query-log.html](http://dev.mysql.com/doc/refman/5.0/en/slow-query-log.html)）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T22:40:47.993

您始终可以按照此处所述设置查询日志记录：http:
[//dev.mysql.com/doc/refman/5.0/en/query-log.html](http://dev.mysql.com/doc/refman/5.0/en/query-log.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2015-04-09T22:33:06.233

这取决于您所说的“大多数时间”是什么意思。可能有数千个甚至数十万个查询，每个查询只需要很少的时间，但会消耗 90% 的 CPU/IO 带宽。或者可能有一些巨大的异常值。有用于性能监控和分析的工具，例如内置的 PERFORMANCE_SCHEMA、来自 Oracle/MySQL 团队的企业工具，以及可以跟踪整个应用程序堆栈性能的 newrelic 等在线服务。

# javascript - Javascript 事件：获取更改的通知控制值

> ID：146916
> 
> 赞同：8
> 
> 时间：2008-09-28T22:37:35.147
> 
> 标签：javascript, html, events

我有以下问题：

我有一个 HTML 文本框 ( `<input type="text">`)，其内容由我无法触摸的脚本修改（它是我的页面，但我正在使用外部组件）。

每次该文本框的值发生更改时，我都希望在我的脚本中得到通知，以便我可以对其做出反应。

我试过这个：

```
txtStartDate.observe('change', function() { alert('change' +  txtStartDate.value) }); 
```

哪个（可以预见）不起作用。仅当我自己使用键盘更改文本框值然后将焦点移至其他位置时才会执行它，但如果脚本更改值则不会执行它。

还有其他我不知道的事件我可以听吗？

我正在使用 Prototype 库，如果相关，修改文本框值的外部组件是 Basic Date Picker (www.basicdatepicker.com)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2008-09-28T22:44:41.663

正如您所暗示的，更改（和其他事件）仅在用户采取某些操作时触发。修改事物的脚本不会触发任何事件。您唯一的解决方案是在控件中找到一些可以连接到侦听器的挂钩。

这是我的做法：

```
basicDatePicker.selectDate = basicDatePicker.selectDate.wrap(function(orig,year,month,day,hide) {
  myListener(year,month,day);
  return orig(year,month,day,hide);
}); 
```

这是基于对 Firebug 的粗略了解（我不熟悉该组件）。如果还有其他选择日期的方法，那么您还需要包装这些方法。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T00:43:21.957

addEventListener(" [DOMControlValueChanged](http://www.whatwg.org/specs/web-forms/current-work/#the-domcontrolvaluechanged) " 将在控件的值更改时触发，即使它是由脚本执行的。

addEventListener(" [input](http://www.whatwg.org/specs/web-forms/current-work/#the-change) " 是用户直接发起的 DOMControlValueChanged 过滤版本。

不幸的是，目前只有 Opera 支持 DOMControlValueChanged，并且 webkit 中的输入事件支持被破坏了。input 事件在 Firefox 和 Opera 中也有各种错误。

这些东西可能很快就会在 HTML5 中被清除，fwiw。

更新：

截至 2012 年 9 月 8 日，DOMControlValueChanged 支持已从 Opera 中删除（因为它已从 HTML5 中删除），并且现在浏览器中的“输入”事件支持要好得多（包括更少的错误）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-28T23:37:37.403

IE 有一个可用于此目的的[onpropertychange事件。](http://msdn.microsoft.com/en-us/library/ms536956(VS.85).aspx)

对于真正的网络浏览器 (;))，有一个[DOMAttrModified 突变事件](http://www.w3.org/TR/2000/REC-DOM-Level-2-Events-20001113/events.html#Events-MutationEvent)，但是在 Firefox 中进行了几分钟的实验后，当值以编程方式更改时，我无法让它在文本输入上触发（或通过常规键盘输入），但如果我以编程方式更改输入的名称，它将触发。越来越好奇...

如果你不能让它可靠地工作，你总是可以定期轮询输入的值：

```
var value = someInput.value;

setInterval(function()
{
    if (someInput.value != value)
    {
        alert("Changed from " + value + " to " + someInput.value);
        value = someInput.value;
    }
}, 250); 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-28T23:23:30.730

根据外部 javascript 的编写方式，您始终可以在脚本中重新编写外部脚本的相关部分，并让它覆盖外部定义，以便触发更改事件。

以前我不得不用我无法控制的脚本来做这件事。

您只需要找到外部函数，将其全部复制为具有相同名称的新函数，然后重新编写脚本以执行您想要的操作。

当然，如果脚本是使用闭包正确编写的，您将无法轻易更改它......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T23:49:04.567

除了像 noah 解释的那样解决问题之外，您还可以创建一个每隔几百毫秒检查一次值的计时器。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T00:22:20.993

我不得不按照 Dan 建议的方式修改一次 YUI 数据分页器控件。这是蛮力，但它可以解决我的问题。也就是说，找到写入该字段的方法，复制其代码并添加触发更改事件的语句，然后在您的代码中处理该更改事件。你只需要用它的新版本覆盖原来的函数。轮询，虽然工作正常，但在我看来是一个更消耗资源的解决方案。

# c++ - 如何判断给定路径是目录还是文件？(C/C++)

> ID：146924
> 
> 赞同：40
> 
> 时间：2008-09-28T22:42:10.250
> 
> 标签：c++, c, winapi

我正在使用 C，有时我必须处理类似的路径

*   C:\随便
*   C:\随便\
*   C:\Whatever\Somefile

有没有办法检查给定路径是目录还是给定路径是文件？

* * *

## 回答 #1

> 赞同：117
> 
> 时间：2008-09-28T22:50:08.890

stat() 会告诉你这个。

```
struct stat s;
if( stat(path,&s) == 0 )
{
    if( s.st_mode & S_IFDIR )
    {
        //it's a directory
    }
    else if( s.st_mode & S_IFREG )
    {
        //it's a file
    }
    else
    {
        //something else
    }
}
else
{
    //error
} 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2008-09-28T22:47:41.890

调用[GetFileAttributes](http://msdn.microsoft.com/en-us/library/aa364944(VS.85).aspx)并检查 FILE_ATTRIBUTE_DIRECTORY 属性。

* * *

## 回答 #3

> 赞同：20
> 
> 时间：2017-04-07T15:04:51.327

[`is_directory()`](http://en.cppreference.com/w/cpp/filesystem/is_directory)使用 C++14/C++17 ，您可以独立于平台使用[`is_regular_file()`](http://en.cppreference.com/w/cpp/filesystem/is_regular_file)文件[系统库](http://en.cppreference.com/w/cpp/filesystem)。

```
#include <filesystem> // C++17
#include <iostream>
namespace fs = std::filesystem;

int main()
{
    const std::string pathString = "/my/path";
    const fs::path path(pathString); // Constructing the path from a string is possible.
    std::error_code ec; // For using the non-throwing overloads of functions below.
    if (fs::is_directory(path, ec))
    { 
        // Process a directory.
    }
    if (ec) // Optional handling of possible errors.
    {
        std::cerr << "Error in is_directory: " << ec.message();
    }
    if (fs::is_regular_file(path, ec))
    {
        // Process a regular file.
    }
    if (ec) // Optional handling of possible errors. Usage of the same ec object works since fs functions are calling ec.clear() if no errors occur.
    {
        std::cerr << "Error in is_regular_file: " << ec.message();
    }
} 
```

在 C++14 中使用[`std::experimental::filesystem`](http://en.cppreference.com/w/cpp/experimental/fs).

```
#include <experimental/filesystem> // C++14
namespace fs = std::experimental::filesystem; 
```

[“文件类型”部分](http://en.cppreference.com/w/cpp/filesystem)列出了其他实施的检查。

* * *

## 回答 #4

> 赞同：14
> 
> 时间：2008-09-28T22:56:40.823

在 Win32 中，我通常使用[PathIsDirectory](http://msdn.microsoft.com/en-us/library/bb773621(VS.85).aspx)及其姊妹函数。这适用于 Windows 98，而 GetFileAttributes 不适用（根据 MSDN 文档。）

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-28T22:46:08.243

在 Windows 上，您可以在[打开的句柄上使用](http://msdn.microsoft.com/en-us/library/aa363858(VS.85).aspx)[GetFileAttributes](http://msdn.microsoft.com/en-us/library/aa364944(VS.85).aspx)。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2021-01-05T20:58:20.190

这是使用[GetFileAttributesW](https://docs.microsoft.com/en-us/windows/win32/api/fileapi/nf-fileapi-getfileattributesw)函数检查路径是否为 Windows 上的目录的简单方法。如果接收到的路径必须是目录或文件路径，那么如果它不是目录路径，则可以假定它是文件路径。

```
bool IsDirectory(std::wstring path)
{
    DWORD attrib = GetFileAttributes(path.c_str());

    if ((attrib & FILE_ATTRIBUTE_DIRECTORY) != 0)
        return true;

    return false;
} 
```

* * *

## 回答 #7

> 赞同：-2
> 
> 时间：2015-09-14T11:49:27.850

如果你正在使用`CFile`你可以试试

```
CFileStatus status;
    if (CFile::GetStatus(fileName, status) && status.m_attribute == 0x10){
       //it's directory
} 
```

* * *

## 回答 #8

> 赞同：-4
> 
> 时间：2013-08-23T14:02:55.403

在 qt 中更容易尝试 FileInfo.isDir()

# java - 如果有很多类型，我不应该按对象类型进行子类化吗？

> ID：146931
> 
> 赞同：1
> 
> 时间：2008-09-28T22:46:52.923
> 
> 标签：java, design-patterns, inheritance

我正在处理一个事件日志，其中有大约 60 种不同“类型”的事件。每个事件共享大约 10 个属性，然后有共享各种额外属性的事件子类别。

我如何处理这些事件确实取决于它们的类型或它们实现的分类接口。

但这似乎导致代码膨胀。我在子类方法中有很多冗余，因为它们实现了一些相同的接口。

使用具有“类型”属性的单个事件类并编写检查类型并维护类型类别的某种组织的逻辑是否更合适（例如，类别 a 的事件类型列表，类别 b 的第二个列表， ETC）？还是在这种情况下子类设计更合适？

第一种方法：

```
public interface Category1 {}
public interface Category2 {}

public abstract class Event {
 private base properties...;
}

public class EventType1 extends Event implements Category1, Category2 {
 private extra properties ...;
}

public class EventType2 extends Event implements Category3, Category4 {
 private extra properties ...;
} 
```

第二种方法：

```
public enum EventType {TYPE1, TYPE2, TYPE3, ...}
public class Event {
 private union of all possible properties;
 private EventType type;
} 
```

我个人的看法是，似乎单个事件对象是合适的，因为，如果我正确地考虑它，就没有必要使用继承来表示模型，因为实际上只有行为和我的条件会改变基于类型。

我需要有执行以下操作的代码：

```
if(event instanceof Category1) {
  ...
} 
```

这在第一种方法中效果很好，因为我可以只调用事件上的方法并在每个适当的子类中实现“相同的代码”，而不是 instanceof。

但是第二种方法要简洁得多。然后我写了类似的东西：

```
if(CATEGORY1_TYPES.contains(event.getEventType()) {
 ...
} 
```

而且我所有的“处理逻辑”都可以组织成一个类，并且没有一个是冗余地分布在子类中的。那么这种情况是不是虽然 OO 看起来更合适，但最好不要呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-28T22:54:31.047

我会使用每个事件类型的对象解决方案，但我会将常用的​​接口组合分组在（可能是抽象的）类下，提供它们的**骨架实现**。这大大减少了由于拥有许多接口而产生的代码膨胀，但另一方面，增加了类的数量。但是，如果使用得当和合理，它会导致代码更干净。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T23:26:35.650

如果您决定扩展特定 Category 接口的抽象基类，继承可能会受到限制，因为您可能还需要实现另一个 Category。

因此，这里有一个建议的方法：假设您需要为特定的 Category 接口方法（不管 Event）提供相同的实现，您可以为每个 Category 接口编写一个实现类。

所以你会有：

```
public class Category1Impl implements Category1 {
    ...
}

public class Category2Impl implements Category2 {
    ...
} 
```

然后对于您的每个 Event 类，只需指定它实现的 Category 接口，并保留 Category 实现类的私有成员实例（因此您使用组合，而不是继承）。对于每个 Category 接口方法，只需将方法调用转发到 Category 实现类即可。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-10-06T14:30:59.583

由于我并没有真正得到我正在寻找的答案，因此我根据我不太理想的学习经验提供了我自己的最佳猜测。

事件本身实际上没有行为，只有事件的处理程序才有行为。事件仅代表数据模型。

我重写了代码，只将事件视为属性的对象数组，这样我就可以使用 Java 的新变量参数和自动装箱功能。

通过这个更改，我能够删除大约 100 个巨大的代码类，并在一个类中用大约 10 行代码完成大部分相同的逻辑。

经验教训：将 OO 范式应用于数据模型并不总是明智的。在处理大型可变域时，不要专注于通过 OO 提供完美的数据模型。OO 设计有时比模型更有利于控制器。也不要专注于前期优化，因为通常 10% 的性能损失是可以接受的，并且可以通过其他方式恢复。

基本上，我过度设计了这个问题。事实证明，在这种情况下，正确的 OO 设计过于矫枉过正，将一晚的项目变成了 3 个月的项目。当然，我必须努力学习！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2008-09-28T23:15:56.537

仅仅拥有大量 .java 文件并不一定是坏事。如果您可以有意义地提取少量（2-4 个左右）表示类契约的接口，然后将所有实现打包起来，那么您提供的 API 可以非常干净，即使有 60 个实现。

我可能还建议使用一些委托或抽象类来引入通用功能。委托和/或抽象助手都应该是包私有或类私有的，在您公开的 API 之外不可用。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-28T23:19:03.097

如果有相当多的行为混合和匹配，我会考虑使用其他对象的组合，然后让特定事件类型对象的构造函数创建这些对象，或者使用构建器来创建对象。

也许是这样的？

```
class EventType {

  protected EventPropertyHandler handler;

  public EventType(EventPropertyHandler h) {
     handler = h;
  }

  void handleEvent(map<String,String> properties) {
    handler.handle(properties);
  }
}

abstract class EventPropertyHandler {
   abstract void handle(map<String, String> properties);
}
class SomeHandler extends EventPropertyHandler {
   void handle(map<String, String> properties) {
      String value = properties.get("somekey");
      // do something with value..
   }
}

class EventBuilder {
   public static EventType buildSomeEventType() {
      // 
      EventType e = new EventType( new SomeHandler() );
   }
} 
```

可能会有一些改进，但这可能会让你开始。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T19:54:12.580

这取决于每种类型的事件是否固有地具有事件本身可以执行的不同行为。

您的 Event 对象是否需要每种类型行为不同的方法？如果是这样，请使用继承。

如果不是，请使用枚举对事件类型进行分类。

# refactoring - 您可以对对提高质量产生最大影响的遗留代码库做些什么？

> ID：146936
> 
> 赞同：39
> 
> 时间：2008-09-28T22:49:46.317
> 
> 标签：refactoring, legacy, legacy-code

当您在遗留代码库中工作时，随着时间的推移，什么会对提高代码库的质量产生最大的影响？

*   删除未使用的代码
*   删除重复代码
*   添加单元测试以提高覆盖率低的测试覆盖率
*   跨文件创建一致的格式
*   更新第 3 方软件
*   减少静态分析工具（即Findbugs）产生的警告

多年来，该代码库由许多具有不同专业水平的开发人员编写，其中许多领域未经测试，有些无法测试，而无需花费大量时间编写测试。

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2008-09-28T22:57:03.757

*   阅读 Michael Feather 的书[“有效地使用遗留代码”](https://rads.stackoverflow.com/amzn/click/com/0131177052)

这是一本很好的书。

如果您不喜欢这个答案，那么我能给出的最佳建议是：

*   首先，停止制作新的遗留代码[1]

[1]：遗留代码 = 没有单元测试的代码，因此未知

在没有自动化测试套件的情况下更改遗留代码是危险且不负责任的。如果没有良好的单元测试覆盖率，您不可能知道这些更改会产生什么影响。Feathers 推荐一种“扼杀”方法，您可以隔离需要更改的代码区域，编写一些基本测试来验证基本假设，在单元测试的支持下进行小的更改，然后从那里开始工作。

注意：我并不是说您需要停止一切并花费数周时间为所有内容编写测试。恰恰相反，只需围绕您需要测试和锻炼的区域进行测试。

Jimmy Bogard 和 Ray Houston 就与此非常相似的主题做了一个有趣的屏幕投射： [http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/05/06/pablotv-eliminating-static-dependencies-screencast。 aspx](http://www.lostechies.com/blogs/jimmy_bogard/archive/2008/05/06/pablotv-eliminating-static-dependencies-screencast.aspx)

* * *

## 回答 #2

> 赞同：21
> 
> 时间：2008-10-19T23:31:00.923

我使用由大约 50 名程序员编写和修改的遗留 1M LOC 应用程序。

```
* Remove unused code 
```

几乎没用……忽略它。您不会从中获得很大的投资回报 (ROI)。

```
* Remove duplicated code 
```

实际上，当我修复某些东西时，我总是搜索重复项。如果我发现了一些，我会放置一个通用函数或注释所有重复出现的代码（有时，放置一个通用函数的努力是不值得的）。主要思想是，我讨厌多次做同样的动作。另一个原因是因为总是有人（可能是我）忘记检查其他事件......

```
* Add unit tests to improve test coverage where coverage is low 
```

自动化单元测试很棒……但是如果你有大量的积压，除非你有稳定性问题，否则任务本身就很难推广。继续你正在研究的部分，并希望在几年内你有不错的报道。

```
* Create consistent formatting across files 
```

IMO 格式的差异是遗产的一部分。它会提示您编写代码的人或时间。这可以为您提供一些关于如何在该部分代码中表现的线索。进行重新格式化的工作并不有趣，也不会为您的客户带来任何价值。

```
* Update 3rd party software 
```

仅当有新的非常好的功能或新操作系统不支持您拥有的版本时才这样做。

```
* Reduce warnings generated by static analysis tools 
```

它可以是值得的。有时警告可以隐藏潜在的错误。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2008-09-28T22:55:09.253

我会说“删除重复的代码”几乎意味着您必须将代码提取并抽象出来，以便它可以在多个地方使用 - 从理论上讲，这使得错误更容易修复，因为您只需要修复一段代码，而不是许多代码，来修复其中的错误。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2008-09-28T23:06:57.837

添加单元测试以提高测试覆盖率。拥有良好的测试覆盖率将使您能够毫无畏惧地重构和改进功能。

CPPUnit 的作者写了一本很好的书，[有效地使用遗留代码](https://rads.stackoverflow.com/amzn/click/com/0131177052 "有效地使用遗留代码")。

向遗留代码添加测试肯定比从头开始创建更具挑战性。我从书中学到的最有用的概念是“接缝”的概念，Feathers 将其定义为

> “一个你可以改变程序中的行为而无需在那个地方进行编辑的地方。”

有时它值得重构以创建接缝，这将使未来的测试更容易（或首先可能）。[谷歌测试博客](http://googletesting.blogspot.com/)有几篇关于这个主题的有趣帖子，主要围绕[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)的过程。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2008-09-28T23:02:27.987

我可以与这个问题联系起来，因为我目前在我的膝上是“那些”旧学校代码库之一。它不是真正的遗产，但它肯定没有跟随这些年来的趋势。

我会告诉你我想在其中修复的东西，因为它们每天都会困扰我：

*   记录输入和输出变量
*   重构变量名，使它们实际上意味着其他东西和一些匈牙利符号前缀，后跟三个字母的首字母缩写词，含义模糊。CammelCase 是要走的路。
*   我害怕更改任何代码，因为它会影响数百个使用该软件的客户，即使是最模糊的副作用也会有人注意到。任何可重复的回归测试都将是一件幸事，因为现在为零。

剩下的真的是花生。这些是遗留代码库的主要问题，它们确实占用了大量时间。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2008-09-28T23:19:24.280

我想说这在很大程度上取决于你想对遗留代码做什么......

如果它将无限期地保持在维护模式并且工作正常，那么您最好什么也不做。“如果它没有坏，就不要修理它。”

如果它不能正常工作，删除未使用的代码并重构重复的代码将使调试更容易。但是，我只会对错误代码进行这些更改。

如果您计划使用 2.0 版，请添加单元测试并清理您将提出的代码

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2008-09-29T00:34:42.087

好的文档。作为必须维护和扩展遗留代码的人，这是第一个问题。更改您不理解的代码是很困难的，如果不是非常危险的话。即使您有幸获得了文档化代码，您有多确定文档是正确的？它涵盖了原作者的所有隐含知识？它说明了所有的“技巧”和边缘情况？

好的文档可以让原始作者以外的人理解、修复和扩展甚至是糟糕的代码。我将在一周中的任何一天使用那些我可以理解的被破解但有据可查的代码，而不是完美但难以理解的代码。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2008-12-08T00:59:19.553

我对必须使用的遗留代码所做的最大的一件事情就是围绕它构建一个真正的 API。这是一个 1970 年代风格的 COBOL API，我围绕它构建了一个 .NET 对象模型，因此所有不安全的代码都在一个地方，API 的本机数据类型和 .NET 数据类型之间的所有转换都在一个地方，主要方法返回和接受数据集，等等。

要做到这一点非常困难，而且我知道其中还有一些缺陷。它也不是非常有效，所有编组都在进行。但另一方面，我可以构建一个 DataGridView，将数据往返传输到一个有 15 年历史的应用程序，该应用程序在大约半小时内将其数据保存在 Btrieve (!) 中，并且它可以工作。当客户带着项目来找我时，我的估计是几天和几周，而不是几个月和几年。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2008-12-08T01:34:47.563

与 Josh Segall 所说的类似，我想说的是，该死的评论一下。我曾在几个非常大的遗留系统上工作过，这些系统被丢在我的腿上，我发现最大的问题是跟踪我已经了解的关于特定代码部分的内容。一旦我开始放置笔记，包括“待办事项”笔记，我就不再重新找出我已经弄清楚的东西。然后我可以专注于这些代码段是如何流动和交互的。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2011-07-15T00:37:27.303

我想说的是，大部分时间不要管它。如果它没有损坏，则不要修复它。如果它被破坏，那么继续修复和改进被破坏的代码部分及其周围的代码。您可以使用错误的痛苦或严重缺失的功能来证明改进该部分的努力和费用是合理的。

我不会推荐任何不以实际业务或最终用户需求为指导的大规模重写、重构、重新格式化或放入单元测试。

如果你确实有机会修复某些东西，那就把它做对（第一次做对的机会可能已经过去了，但既然你再次接触那个部分，不妨及时做对），这包括所有你提到的项目。

因此，总而言之，您不需要做任何一件或几件事情。你应该做这一切，但要以小部分和机会主义的方式。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2013-02-25T15:25:15.987

派对迟到了，但在经常使用或引用函数/方法的情况下，以下可能值得做：

*   局部变量在遗留代码中的命名往往很糟糕（通常是因为它们的范围在修改方法时扩展，并且没有更新以反映这一点）。根据实际目的重命名它们有助于澄清遗留代码。
*   即使只是稍微不同地布置方法也能产生奇迹——例如，将 an 的所有子句`if`放在一行上。
*   那里可能已经有陈旧/令人困惑的代码注释。如果不需要，请删除它们，或者如果您绝对需要，请修改它们。*（当然，我不主张删除有用的评论，只是那些有碍的评论。）*

这些可能不会产生您正在寻找的巨大的标题影响，但它们的风险很低，尤其是在代码无法进行单元测试的情况下。

# .net - NHibernate + JSON/Ajax 父/子关系？为什么这不起作用？

> ID：146942
> 
> 赞同：3
> 
> 时间：2008-09-28T22:52:41.147
> 
> 标签：.net, ajax, json, nhibernate

我有一个典型的*父母/子女*关系。写新闻`.NET`和添加孩子效果很好，`NHibernate`玩得很好，并增加了正确的关系。

但是，当将 a`JSON object`从客户端传递给将我的 JSON 序列化为 .NET 表示的某个方法时，NHibernate 似乎会感到困惑。它提出了正确的查询来添加父级（并为 ​​Id 分配一个新的 guid），但是，它不会将该父级 ID 与它尝试执行的 SQL 中的子级对象相关联。我想出了一个快速而肮脏的技巧，我在下面列出 - 但我想知道，这里有什么我遗漏的吗？

```
IList<BackerEntry> backersTemp = new List<BackerEntry>();
foreach (BackerEntry backerEntry in jsonBackerEntity.BackerEntries)
{
  backersTemp.Add(backerEntry);
}

jsonBackerEntity.BackerEntries.Clear();

foreach (BackerEntry backerEntry in backersTemp)
{
  jsonBackerEntity.AddChild(backerEntry);
} 
```

这样做是我似乎可以让 NHibernate 看到这些孩子真的属于这个父母的唯一方法。在我的 AddChild 方法内部看起来像这样：

```
public virtual void AddChild(BackerEntry backerEntry)
{
  if (backerEntry.Backer != null)
  {
    backerEntry.Backer.BackerEntries.Remove(backerEntry);
  }
  backerEntry.Backer = this;
  this.BackerEntries.Add(backerEntry);
} 
```

编辑：我想我可能刚刚意识到为什么 - 可能是因为我没有在 JSON 中发回孩子的 Parent 属性。由于两者的循环性质，我什至不确定这是否可能。孩子有父母（在json中有一个孩子，他是有父母的原始孩子，等等）......有什么想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2013-11-14T11:09:05.990

在使用 Hibernate 进行 saveOrUpdate 之前，您必须确保所有对象子对象都具有相同的内存对象父对象。查看映射并认为数据库中的每一行都是一个且只有一个内存对象，确保这对您来说是正确的，然后重置 ParentObjects 以适应它。

此外，您可以尝试使用更灵活的合并方法。

# c++ - 帮助改进此 INI 解析代码

> ID：146943
> 
> 赞同：1
> 
> 时间：2008-09-28T22:52:41.537
> 
> 标签：c++, stl, stream, ini

[这是我为这个问题](https://stackoverflow.com/questions/146795/how-to-read-config-file-entries-from-an-ini-file)想出的简单的东西。我对它并不完全满意，我认为这是一个帮助改进我对 STL 和基于流的编程的使用的机会。

```
std::wifstream file(L"\\Windows\\myini.ini");
if (file)
{
  bool section=false;
  while (!file.eof())
  {
    std::wstring line;
    std::getline(file, line);
    if (line.empty()) continue;

    switch (line[0])
    {
      // new header
      case L'[':
      {
        std::wstring header;
        size_t pos=line.find(L']');
        if (pos!=std::wstring::npos)
        {
          header=line.substr(1, pos);
          if (header==L"Section")
            section=true;
          else
            section=false;
        }
      }
  break;
      // comments
      case ';':
      case ' ':
      case '#':
      break;
      // var=value
      default:
      {
        if (!section) continue;

// what if the name = value does not have white space?
// what if the value is enclosed in quotes?
        std::wstring name, dummy, value;
        lineStm >> name >> dummy;
        ws(lineStm);
        WCHAR _value[256];
        lineStm.getline(_value, ELEMENTS(_value));
        value=_value;
      }
    }
  }
} 
```

您将如何改进这一点？请不要推荐替代库 - 我只想要一个简单的方法来从 INI 文件中解析出一些配置字符串。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T01:18:10.283

> // 如果 name = value 没有空格怎么办？
> // 如果值用引号括起来怎么办？

我会使用 boost::regex 来匹配每种不同类型的元素，例如：

```
boost::smatch matches;
boost::regex name_value("(\S+)\s*=\s*(\S+)");
if(boost::regex_match(line, matches, name_value))
{
    name = matches[1];
    value = matches[2];
} 
```

正则表达式可能需要一些调整。

我还将用 std::getline 替换 de stream.getline，摆脱静态 char 数组。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T23:32:38.197

这：

```
for (size_t i=1; i<line.length(); i++)
        {
          if (line[i]!=L']')
            header.push_back(line[i]);
          else
            break;
        } 
```

应该通过调用 wstrchr、wcschr、WSTRCHR 或其他东西来简化，具体取决于您所在的平台。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-29T00:26:41.280

> // 如何一次性将一行变成一个字符串？

使用标准字符串标头中的（非成员）[getline](http://www.cplusplus.com/reference/string/getline.html)函数。

# php - 我应该扩展这门课吗？(PHP)

> ID：146963
> 
> 赞同：2
> 
> 时间：2008-09-28T23:04:02.477
> 
> 标签：php, oop, orm, activerecord

我在 PHP 中创建了一个 ORM，我有一个类“ORM”，它基本上创建了一个与数据库表相对应的对象（我的目标是与 ActiveRecord 模式相似/相同的功能。）ORM 本身扩展了' Database'，用于建立数据库连接。

所以，我可以打电话：

```
`$c = new Customer();
$c->name = 'John Smith';
$c->save();`
```

`ORM 类提供此功能（设置类属性，提供 save()、find()、findAll() 等方法），Customer 扩展 ORM。但是，将来我可能希望向 Customer（或我创建的任何其他模型）添加额外的公共方法，那么这是否应该扩展 ORM？`

 `我知道我在这里没有提供太多信息，但希望这可以通过模糊的解释来理解，而不是发布 300 多行代码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2008-09-29T01:04:17.883

我同意这里的其他答案 - 将其他方法放入后代类中。不过，我还要为此添加一个星号：每次使用额外的方法扩展类时，请考虑通过扩展尝试实现的目标，并考虑是否可以将其泛化并返回到父类中. 例如：

```
// Customer.class.php
function getByName($name) {
    // SELECT * FROM `customer` WHERE `name` = $name
}

// ** this could instead be written as: **
// ORM.class.php
function getByField($field, $value) {
    // SELECT * FROM `$this->table` WHERE `$field` = $value
} 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2008-09-28T23:28:33.243

您肯定正确地考虑将您的业务逻辑放在您的“ORM”之外的一个新类中。对我来说，与其简单地扩展 ORM 类，我更愿意用一个新的值对象类来封装它，以便为您的数据库设计提供额外的自由度，让您可以将类视为纯业务对象。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-29T01:56:32.640

没有。您应该使用组合而不是继承。请参见以下示例：

```
class Customer {
    public $name;
    public function save() {
        $orm = new ORM('customers', 'id'); // table name and primary key
        $orm->name = $this->name;
        $orm->save();
    }
} 
```

并且`ORM`类不应该扩展`Database`。组合再次最适合此用例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2008-09-28T23:07:23.670

是的，将您的业务逻辑放在后代类中。这是在大多数数据访问层生成框架中看到的非常常见的模式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2008-09-29T00:10:10.477

您绝对应该扩展 ORM 类。不同的事物应该是不同类的对象。客户与产品有很大不同，在单个 ORM 类中同时支持两者将是不必要的膨胀，并完全违背了 OOP 的目的。

另一个不错的做法是为保存前、保存后等添加挂钩。随着您的 ORM 扩展类变得更加多样化，这些为您提供了更大的灵活性。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2008-09-29T00:14:01.683

鉴于我对 PHP 的了解有限，我不确定这是否相关，但如果您尝试创建许多业务对象，这可能是一个非常耗时的过程。也许您应该考虑像[CakePHP](http://cakephp.org/)和其他类似的框架。如果您仍在创建业务逻辑的过程中，这很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2008-09-29T06:39:38.277

我已经在我的[Pork.dbObject](http://www.schizofreend.nl/pork.dbObject/)中解决了这个问题。一定要检查一下并抓住我已经做过的一些脑力劳动：P

```
class Poll extends dbObject // dbObject is my ORM. Poll can extend it so it gets all properties.
{
        function __construct($ID=false)
        {
            $this->__setupDatabase('polls', // db table
                array('ID_Poll' => 'ID',    // db field => object property
                        'strPollQuestion' => 'strpollquestion', 
                        'datPublished' => 'datpublished', 
                        'datCloseDate' => 'datclosedate', 
                        'enmClosed' => 'enmclosed', 
                        'enmGoedgekeurd' => 'enmgoedgekeurd'),
                        'ID_Poll',  // primary db key 
                        $ID);   // primary key value
        $this->addRelation('Pollitem'); //Connect PollItem to Poll 1;1
        $this->addRelation('Pollvote', 'PollUser'); // connect pollVote via PollUser (many:many)

        }

function Display()
{

 // do your displayíng for poll here:
    $pollItems = $this->Find("PollItem"); // find all poll items
    $alreadyvoted = $this->Find("PollVote", array("IP"=>$_SERVER['REMOTE_ADDR'])); // find all votes for current ip
} 
```

请注意，通过这种方式，任何数据库或 ORM 功能都从 Poll 对象中抽象出来。它*不需要*知道。只是用于连接字段/映射的 setupdatabase。和 addRelation 连接到其他 dbObjects 的关系。

此外，即使是 dbObject 类也不太了解 SQL。选择/连接查询是由一个特殊的 QueryBuilder 对象构建的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2008-09-29T07:37:01.480

你肯定在这里沿着正确的路线思考继承。

如果您构建 ORM 只是为了构建一个（或者因为您不喜欢其他人处理事情的方式）而不是去做，否则您可能会查看一个可以直接生成大部分代码的预构建 ORM您的数据库架构。它将为您节省大量时间。[CoughPHP](http://www.coughphp.com)目前是我的最爱。

# sql-server-2005 - SQLExpress 2005 和 2008 可以毫无问题地安装在同一台机器上吗？

> ID：146970
> 
> 赞同：3
> 
> 时间：2008-09-28T23:08:22.560
> 
> 标签：sql-server-2005, sql-server-2008, installation

我想将 SQLExpress2005 安装为实例“SQLExpress”，并将 SQLExpresss2008 安装为“SQLExpress2008”实例。

在同一台机器上这样做有什么问题吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2008-09-28T23:14:58.190

只要你给它们起不同的名字，就不应该有任何问题。二进制文件存储在基于版本的目录中，您可以（并且应该）将它们的文件组指向不同的位置。这也应该适用于完整版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2008-09-28T23:14:07.507

我很确定你可以使用完整版的 SQL，但你需要通过安装命名实例来做到这一点。这可能是 SQL Express 的一个问题，它没有为您提供该选项。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2008-09-29T18:56:00.583

在我的机器上工作:) 避免实例冲突。最多有一个默认实例，并且命名实例应该是唯一的。

# powershell - 用于下载文件的 Powershell 脚本，无法设置安全连接

> ID：146973
> 
> 赞同：10
> 
> 时间：2008-09-28T23:10:03.663
> 
> 标签：powershell

我正在制作一个自动脚本来从发布最新编译代码的站点中读取列表。这是我已经弄清楚的部分。脚本的下一部分是从具有 Untrusted Cert 的服务器中获取编译后的代码。

这就是我要获取文件的方式：

```
$web = new-object System.Net.WebClient
$web.DownloadFile("https://uri/file.msi", "installer.msi") 
```

然后我收到以下错误：

> 使用“2”参数调用“DownloadFile”的异常：“底层连接已关闭：无法为 SSL/TLS 安全通道建立信任关系。”

我知道我遗漏了一些东西，但我无法找到正确的方法来搜索它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2008-09-28T23:42:58.747

Brad 是正确的，但请注意 PowerShell V1 并没有真正对委托提供本机支持，在这种特定情况下您将需要它。我相信这应该[可以让您绕过](http://blogs.msdn.com/powershell/archive/2006/07/25/678259.aspx)这个限制（实际上您描述的场景正是使用的示例之一）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2008-09-28T23:35:08.627

您需要为[ServicePointManager.ServerCertificateValidationCallback](http://msdn.microsoft.com/en-us/library/system.net.servicepointmanager.servercertificatevalidationcallback.aspx)编写回调处理程序。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2018-07-06T11:22:50.230

如果您使用的是 powershell 并遇到此错误。使用命令：

[Net.ServicePointManager]::SecurityProtocol = [System.Net.SecurityProtocolType]::Tls12

在下载软件包之前。它强制 PS 使用 TLS 1.2。

失败的原因可能是您尝试下载的网站禁用了对 PS 默认使用的 TLS 1.0 的支持。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2019-09-10T15:50:28.580

ServerCertificateValidationCallback 最简单的 PowerShell 实现是一个始终返回 true 的脚本块。这适用于 PowerShell 5.1 版；没有在其他版本上测试过。

```
[System.Net.ServicePointManager]::ServerCertificateValidationCallback = {$true} 
```

参见 Bhargav Shukla 的[博客](https://bhargavs.com/index.php/2014/03/17/ignoring-ssl-trust-in-powershell-using-system-net-webclient/)

# algorithm - 搜索引擎不精确计数（大约 xxx 个结果）

> ID：146980
> 
> 赞同：2
> 
> 时间：2008-09-28T23:19:02.737
> 
> 标签：algorithm, search-engine, information-retrieval, counting

当您在 Google 中搜索时（我几乎可以肯定 Altavista 做了同样的事情）它说“结果 1-10 of about xxxx”...

这一直让我感到惊讶......它是什么意思“关于”？
他们怎么能粗略计算呢？
我确实理解为什么他们无法在合理的时间内得出一个精确的数字，但他们是如何达到这个“近似”的呢？

我敢肯定，我错过了这个背后的很多理论......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2008-09-28T23:34:26.490

它很可能类似于大多数 SQL 系统在其查询计划中使用的估计行数。表中的行数（与上次收集统计数据时完全一致，但通常不是最新的）乘以估计的选择性（通常基于通过抽样一些小子集计算的一种统计分布模型行数）。

PostgreSQL 手册中有一个关于[规划](http://www.postgresql.org/docs/8.3/interactive/planner-stats.html)器使用的统计信息的部分，它提供了相当丰富的信息，至少如果您按照指向 pg_stats 和其他各个部分的链接进行操作。我敢肯定，这并不能真正描述谷歌所做的事情，但它至少显示了一个模型，您可以在其中获得前 N 行，并估计可能还有多少行。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2008-09-28T23:26:21.457

与您的问题无关，但让我想起了我的一个朋友在进行简单的自我搜索时开的一个小玩笑（不要告诉我您从未在 Google 上搜索过您的名字）。他说了类似的话

*“哇，大约 5,000 个结果在 0.22 秒内！现在，想象一下，一分钟、一小时、一天有多少结果！”*

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2008-09-28T23:33:38.847

我想估计是基于统计数据。他们不会计算所有相关的页面匹配，所以他们（我会）做的是根据一些启发式大致计算出与查询匹配的页面百分比，然后将其用作计数的基础.

一种启发式方法可能是进行样本计数 - 随机抽取 1000 页左右的样本，然后查看匹配的百分比。样本中不需要太多就可以获得具有统计意义的答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-01-05T15:13:55.150

尚未提及的一件事是重复数据删除。一些搜索引擎（我不确定谷歌具体是如何做到的）会使用启发式方法来尝试确定两个不同的 URL 是否包含相同（或极其相似）的内容，因此是重复的结果。

如果有 156 个唯一 URL，但其中 9 个已被标记为与其他结果的重复，则说“大约 150 个结果”而不是“156 个结果包含 147 个唯一结果和 9 个重复”之类的内容更简单。

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2008-09-28T23:30:08.980

返回确切数量的结果不值得准确计算的开销。由于知道有 1,004,345 个结果而不是“大约 1,000,000 个”并没有太大的附加值，因此从最终用户体验的角度来看，更快地返回结果而不是计算总数的额外时间更为重要。

来自谷歌自己： [“谷歌对搜索结果总数的计算是一个估计。我们知道一个大概的数字很有价值，通过提供一个估计而不是一个确切的帐户，我们可以更快地返回高质量的搜索结果。”](http://www.google.com/support/webmasters/bin/answer.py?hl=en&answer=70920)

# ios - 为 iPhone 编译时 Xcode 设置了什么#defines

> ID：146986
> 
> 赞同：67
> 
> 时间：2008-09-28T23:25:34.187
> 
> 标签：ios, xcode, macos, conditional-compilation

我正在编写一些半便携式代码，并希望能够检测我何时为 iPhone 编译。所以我想要类似的东西`#ifdef IPHONE_SDK...`。

大概Xcode定义了一些东西，但我在项目属性下看不到任何东西，谷歌也没有太大帮助。

* * *

## 回答 #1

> 赞同：116
> 
> 时间：2008-09-28T23:47:20.047

它位于“有条件地编译源代码”下的 SDK 文档中

相关的定义是TARGET_OS_IPHONE（他弃用了TARGET_IPHONE_SIMULATOR），在iOS框架内的/usr/include/TargetConditionals.h中定义。在工具链的早期版本中，您必须编写：

```
#include "TargetConditionals.h" 
```

但这在当前（xCode 6/iOS8）工具链上不再需要。

因此，例如，如果您在为设备构建时只想编译一段代码，那么您应该这样做

```
#if !(TARGET_OS_SIMULATOR)
...
#endif 
```

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2008-10-06T06:01:21.123

要查看所有定义的宏，请将其添加到构建配置的“其他 C 标志”中：

```
-g3 -save-temps -dD 
```

您会遇到一些构建错误，但编译器会将所有定义转储到项目根目录中的 .mi 文件中。您可以使用 grep 来查看它们，例如：

```
grep define main.mi 
```

完成后，不要忘记从构建设置中删除这些选项。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2017-09-14T20:13:48.590

这个问题的答案并不完全正确。平台和硬件与模拟器的问题是正交的。

**不要将架构用作平台或模拟器检测的捷径！**多年来，这种草率的想法让很多很多程序员都感到非常头疼和头痛。

这是条件句的 ASCII 图表。由于历史原因，这些名称不一定有意义：

```
+--------------------------------------+
|             TARGET_OS_MAC            |
| +---+  +---------------------------+ |
| |   |  |      TARGET_OS_IPHONE     | |
| |OSX|  | +-----+ +----+ +-------+  | |
| |   |  | | IOS | | TV | | WATCH |  | |
| |   |  | +-----+ +----+ +-------+  | |
| +---+  +---------------------------+ |
+--------------------------------------+

Devices:      TARGET_OS_EMBEDDED
Simulators:   TARGET_OS_SIMULATOR 
```

* * *

TARGET_OS_MAC 适用于所有 Apple 平台。

* * *

TARGET_OS_OSX 仅适用于 macOS

TARGET_OS_IPHONE 适用于 iOS、watchOS 和 tvOS（设备和模拟器）

* * *

TARGET_OS_IOS 仅适用于 iOS（设备和模拟器）

TARGET_OS_WATCH 仅适用于 watchOS（设备和模拟器）

TARGET_OS_TV 仅适用于 tvOS（设备和模拟器）

* * *

TARGET_OS_EMBEDDED 仅适用于 iOS/watchOS/tvOS 硬件

TARGET_OS_SIMULATOR 仅适用于模拟器。

* * *

我还要注意，您可以`xcconfig`按平台对文件中的设置进行条件化：

```
//macOS only
SOME_SETTING[sdk=macosx] = ...

//iOS (device & simulator)
SOME_SETTING[sdk=iphone*] = ...
//iOS (device)
SOME_SETTING[sdk=iphoneos*] = ...
//iOS (simulator)
SOME_SETTING[sdk=iphonesimulator*] = ...

//watchOS (device & simulator)
SOME_SETTING[sdk=watch*] = ...
//watchOS (device)
SOME_SETTING[sdk=watchos*] = ...
//watchOS (simulator)
SOME_SETTING[sdk=watchsimulator*] = ...

//tvOS (device & simulator)
SOME_SETTING[sdk=appletv*] = ...
//tvOS (device)
SOME_SETTING[sdk=appletvos*] = ...
//tvOS (simulator)
SOME_SETTING[sdk=appletvsimulator*] = ...

// iOS, tvOS, or watchOS Simulator
SOME_SETTING[sdk=embeddedsimulator*] = ... 
```

# java - 正在写“这个”。在实例变量和方法之前的好坏风格？

> ID：146989
> 
> 赞同：34
> 
> 时间：2008-09-28T23:27:17.787
> 
> 标签：java, c++, coding-style

我在 C++ 和 Java 中的一个讨厌的（？）编程习惯是总是在调用或访问成员之前使用`this`. 例如：`this.process(this.event)`。

我的一些学生对此发表了评论，我想知道我是否在教坏习惯。

我的理由是：

1.  使代码更具可读性——更容易区分字段和局部变量。
2.  更容易区分标准调用和静态调用（尤其是在 Java 中）
3.  让我记得这个调用（除非目标是最终的）可能最终在不同的目标上，例如在子类中的覆盖版本中。

显然，这对编译程序的影响为零，它只是可读性。那么我是让它或多或少地具有可读性吗？

注意：我把它变成了一个 CW，因为真的没有正确的答案。

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2008-09-28T23:30:59.057

我认为它的可读性较差，尤其是在字段突出显示与局部变量不同的环境中。我唯一想看到“this”的时候是需要它的时候，例如：

```
this.fieldName = fieldName 
```

分配字段时。

也就是说，如果您出于某种原因需要某种方式来区分字段，我更喜欢“this.fieldName”而不是其他约定，例如“m_fieldName”或“_fieldName”

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2008-09-28T23:33:05.403

这是一个非常主观的事情。Microsoft StyleCop 有一个规则要求**这个。**限定符（尽管它与 C# 相关）。有些人使用下划线，有些人使用奇怪的匈牙利符号。我个人有资格获得会员资格**。**即使没有明确要求避免混淆，因为在某些情况下它可以使代码更具可读性。

您可能还想查看这个问题：
[您对成员变量使用什么样的前缀？](https://stackoverflow.com/questions/111605/what-kind-of-prefix-do-you-use-for-member-variables)

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2008-09-29T11:06:04.690

I'd never seen this style until I joined my current employer. The first time I saw it I thought "this idiot has no idea and Java/OO languages generally are not his strong suit", but it turns out that it's a regularly-occurring affliction here and is mandatory style on a couple of projects, although these projects also use the

```
if (0 == someValue)
{
    ....
} 
```

approach to doing conditionals, i.e. placing the constant first in the test so that you don't run the risk of writing

```
if (someValue = 0) 
```

by accident - a common problem for C coders who ignore their compiler warnings. Thing is, in Java the above is simply invalid code and will be chucked out by the compiler, so they're actually making their code less intuitive for no benefit whatsoever.

For me, therefore, far from showing "the author is coding with a dedicated thought process", these things strike me as more likely to come from the kind of person who just sticks to the rules someone else told them once without questioning them or knowing the reasons for the rules in the first place (and therefore where the rules shouldn't apply).

The reasons I've heard mainly boil down to "it's best practice" usually citing Josh Bloch's ***Effective Java*** which has a huge influence here. In fact, however, Bloch doesn't even use it where even I think he probably should have to aid readability! Once again, it seems to be more the kind of thing being done by people who are told to do it and don't know why!

Personally, I'm inclined to agree more with what Bruce Eckel says in Thinking in Java (3rd and 4th editions):

* * *

'Some people will obsessively put **this** in front of every method call and field reference, arguing that it makes it "clearer and more explicit." Don't do it. There's a reason that we use high-level languages: They do things for us. If you put **this** in when it's not necessary, you will confuse and annoy everyone who reads your code, since all the rest of the code they've read *won't* use **this** everywhere. People expect **this** to be used only when it is necessary. Following a consistent and straightforward coding style saves time and money.'

* * *

*footnote, p169, Thinking in Java, 4th edition*

Quite. Less is more, people.

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2008-09-29T01:56:01.220

**3 个原因** （Nomex 套装**开启**）

1) 标准化

2) 可读性

3) 集成开发环境

**1) 大人物** **不是 Sun Java 代码风格的一部分。**

（Java 不需要任何其他样式。）

所以不要这样做（在Java中。）

这是蓝领 Java 的一部分：到处都是一样的。

**2) 可读性**

如果你想让 this.to 在每个 this.other this.word 前面都有 this.this；你真的 this.think 它提高了 this.readability 吗？

如果一个类中有太多的方法或变量，你不知道它是否是一个成员......重构。

Java 中只有**成员**变量，没有全局变量或函数。（在其他语言中，您也可以使用指针、数组溢出、未经检查的异常和全局变量；享受吧。）

如果您想知道该方法是否在您的类父类中...请记住将@Override 放在您的声明中，让编译器告诉您是否没有正确覆盖。super.xxxx() 是 Java 中的标准样式，如果*要*调用父方法，否则将其省略。

**3) IDE** 任何人在没有 IDE 的情况下编写代码，只要能理解语言并在侧边栏上给出大纲，都可以自己动手。意识到如果它对语言不敏感，那么您将被困在 1950 年代。没有 GUI：被困在 50 年代。

任何体面的 IDE 或编辑器都会告诉您函数/变量的来源。即使是原始的 VI (<64kb) 也可以使用 CTags 执行此操作。没有*理由*使用蹩脚的工具。好东西免费赠送！

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2008-09-28T23:36:55.377

有时我确实喜欢这样写课程：

```
class SomeClass{
    int x;
    int y;

    SomeClass(int x, int y){
        this.x = x
        this.y = y
    }
} 
```

这使得更容易分辨哪个参数正在设置哪个成员。

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2008-09-28T23:31:02.473

我认为更具可读性。我这样做是出于完全相同的原因。

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2008-09-29T01:41:20.320

我发现少即是多。代码中不必要的冗长垃圾越多，人们维护它的问题就越多。也就是说，具有清晰一致的行为也很重要。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2008-09-28T23:39:05.277

在我看来，你使它更具可读性。它让潜在的未来疑难解答人员知道您正在调用的函数在哪里。

其次，拥有一个与全局名称完全相同的函数或来自某个名称空间的函数并非不可能，这会使“使用”陷入冲突。因此，如果存在冲突，原始代码作者将确定他们正在调用哪个函数。

诚然，如果存在命名空间冲突，其他一些干净编码的规则就会被打破，但没有人是完美的。因此，我认为任何不妨碍生产力、有可能减少错误（尽管可能性很小）并且可以使未来的疑难解答目标更容易的规则都是一个很好的规则。

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2008-09-29T02:11:22.993

选择使用或避免使用有一个很好的技术理由`this`——两者并不总是等价的。

考虑以下代码：

```
int f();

template <typename T>
struct A
{
  int f();
};

template <typename T>
struct B : A<T>
{
  int g()
  {
    return f();
    return this->f();
  }
}; 
```

现在，有两个`f()`调用`B<T>::g()`。一个人会期望它调用`A<T>::f()`，但只有第二个会。第一个将调用`::f()`. 这背后的原因是因为`A<T>`是依赖于`T`，所以查找通常不会找到它。`this`, 作为指向 , 的指针`B<T>`也依赖于`T`，所以如果你使用它，查找将延迟到 after`B<T>`被实例化。

请注意，这种行为可能不会出现在某些不实现两阶段名称查找的编译器（特别是 MSVC）上，但它仍然是正确的行为。

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2008-09-29T01:05:33.307

Python 人一直都在这样做，而且几乎所有人都喜欢它。他们拼写为“self”而不是“this”。有一些方法可以将明确的“自我”放入其中，但共识是明确的“自我”对于理解类方法至关重要。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2008-09-29T01:17:35.760

我必须在这里加入“包括这个”阵营；我不会一直这样做，但从维护的角度来看，好处是显而易见的。如果维护者出于某种原因不使用 IDE，因此没有特别突出显示成员字段和方法，那么他们将陷入滚动痛苦的世界。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2008-09-29T18:39:23.273

我使用`this`至少有两个原因：

## 谬误原因

在使用 C++、C、Java、C# 或 JavaScript 进行编码时，我喜欢保持一致的代码风格。我一直使用相同的编码风格，主要是受 java 的启发，但受其他语言的启发。

我也喜欢用一种语言在我的代码中保持连贯性。我使用`typename`模板类型参数，而不是`class`，并且我从不使用这两者来玩混音器。这意味着我讨厌它不得不`this`在某一点添加，但完全避免它。

我的代码相当冗长。我的方法名称可以很长（也可以不长）。但他们总是使用全名，从不压缩名称（即`getNumber()`，not `getNbr()`）。

从技术角度来看，这些原因还不够好，但是，这仍然是我的编码方式，即使它们没有（很多）好处，也没有（很多）坏处。事实上，在我工作的代码库中，其他人编写的历史反模式已经足够多，足以让他们质疑我的编码风格。

等他们学会写“例外”或“班级”时，我会再想想这一切……

## 真正的原因

虽然我很欣赏编译器的工作，但有一些含糊不清的地方我想使联合国含糊不清。

例如，我（几乎）从不使用`using namespace MyNamespace`. 我要么使用完整的命名空间，要么使用三个字母的别名。我不喜欢模棱两可，也不喜欢当编译器突然告诉我有太多“打印”函数碰撞在一起时。

这就是我在 Win32 函数前面加上全局命名空间的原因，即总是写`::GetLastError()`而不是`GetLastError()`.

这对于`this`. 当我使用 时`this`，我有意识地限制编译器在没有找到真实符号时搜索替代符号的自由。这意味着方法以及成员变量。

这显然可以用作反对方法重载的论据，也许。但这只是显而易见的。如果我编写重载方法，我希望编译器在编译时解决歧义。如果 a 不写`this`关键字，那不是因为我想编译器使用另一个符号而不是我想到的符号（比如函数而不是方法，或其他）。

## 我的结论？

总而言之，这个问题主要是风格问题，并且有真正的技术原因。我不希望一个不写作的人死去`this`。

至于布鲁斯·埃克尔（Bruce Eckel）在他的“Thinking Java”中的引述……我对他在书中一直对 Java/C++ 进行的有偏见的比较（奇怪的是没有与 C# 进行比较）并没有给我留下深刻的印象，所以他的个人观点是`this`，在脚注中完成...嗯...

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2008-09-28T23:32:45.107

根本不是坏习惯。我自己不这样做，但是当我注意到其他人在代码审查中这样做时，这总是一个加分项。这是质量和可读性的标志，表明作者正在使用专门的思维过程进行编码，而不仅仅是破解。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2008-09-28T23:33:56.820

我认为最重要的是一致性。赞成和反对都有合理的论据，因此在考虑哪种方法时主要是个人喜好问题。

* * *

## 回答 #15

> 赞同：1
> 
> 时间：2008-09-29T01:36:23.873

“可读性”

我发现在不使用 IDE（小型快速程序）时使用“this”特别有用

我的类足够大，可以将一些方法委托给一个新类，用“otherRef”替换“this”，使用最简单的文本编辑器非常容易。

IE

```
//Before
this.calculateMass();
this.perfornmDengerAction();
this.var = ...
this.other = ... 
```

“重构”之后

```
// after
this.calculateMass();
riskDouble.calculateMass();
riskDouble.setVar(...);
this.other = ... 
```

当我使用 IDE 时，我通常不使用它。但我认为它让你以一种更面向对象的方式来做事，而不仅仅是使用该方法。

```
class Employee {

        void someMethod(){
             // "this" shows somethings odd here.
             this.openConnectino() ; // uh? Why an employee has a connection???
             // After refactor, time to delegate.
             this.database.connect(); // mmhh an employee might have a DB.. well.. 
         }
     ... etc....
} 
```

与往常一样，最重要的是，如果开发团队决定使用或不使用它，该决定将得到尊重。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2008-09-28T23:41:25.490

我以前总是用这个……然后一位同事向我指出，总的来说，我们努力减少不必要的代码，那么这条规则不应该在这里也适用吗？

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2008-09-28T23:32:42.750

从 .Net 的角度来看，我使用的一些代码分析工具看到了“this”并立即得出结论，该方法不可能是静态的。它可能需要用 Java 进行测试，但如果它在那里做同样的事情，你可能会错过一些性能增强。

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2008-09-29T00:46:15.040

如果您要删除添加**此内容的需要。**在成员变量前面，[checkstyle](http://checkstyle.sourceforge.net/)等静态分析工具对于检测成员变量隐藏字段的情况非常有用。通过删除此类案例，您可以首先消除使用它的需要。话虽如此，我更愿意在构造函数和设置器的情况下忽略这些警告，而不必为方法参数提出新名称:)。

关于静态变量，我发现大多数体面的 IDE 都会突出显示这些变量，以便您可以将它们区分开来。为静态常量之类的东西使用命名约定也是值得的。静态分析工具可以通过强制执行命名约定来提供帮助。

我发现与静态方法很少有任何混淆，因为方法签名通常不同到足以使任何进一步的区分变得不必要。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2008-09-29T01:55:19.710

我更喜欢上面描述的本地分配模式，但不适用于本地方法调用。我同意“一致性是最重要的方面”的观点。我发现 this.something 更具可读性，但我发现一致的编码更具可读性。

```
public void setFoo(String foo) {
    this.foo = foo; //member assignment
}

public doSomething() {
    doThat(); //member method
} 
```

我有同事喜欢：

```
public void setFoo(String foo) {
    _foo = foo;
} 
```

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-05-19T01:15:49.093

**除非您的学生当然像这里的学生一样在绿屏终端上，否则**可读性会降低……精英有语法高亮。****

 **我刚刚听说他们也有重构工具，这意味着你不需要“这个”。用于搜索和替换，他们可以通过一个按键删除那些讨厌的冗余thisses。显然，这些工具甚至可以拆分方法，因此它们在大多数情况下都像一开始就应该做的那样又好又短，甚至对于那些 vars 是字段的绿色筛选器来说也是显而易见的。

# image-processing - 图像处理服务器

> ID：146994
> 
> 赞同：12
> 
> 时间：2008-09-28T23:30:48.590
> 
> 标签：image-processing, image-manipulation

我正在寻找一个免费的、最好是开源的 http[图像处理服务器](http://en.wikipedia.org/wiki/Image_server)。即我会向它发送这样的请求：

```
http://myimageserver/rotate?url=http%3A%2F%2Fstackoverflow.com%2FContent%2FImg%2Fstackoverflow-logo-250.png&angle=90 
```

它会返回旋转的图像。想要的功能：

*   服务器端缓存
*   几种操作/效果（如缩放、水印等）。多多益善。
*   POST 支持提供图像（而不是服务器获取它）。
*   不同的输出格式（PNG、JPEG 等）。
*   批量操作

它会是[这样](http://leadtools.com/SDK/web-services/Image-Service/default.htm)的，但免费且 SOAPy 更少。有这样的事情还是我要求太多了？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-01-09T21:20:20.287

[ImageResizing.Net 库](http://imageresizing.net)既是.NET 库又是 IIS 模块。它是图像服务器或图像库，无论您喜欢哪个。

它是开源的，在[MIT 风格的许可](http://imageresizing.net/licenses/)下，并受插件支持。

它具有出色的性能，并支持 3 种管道：GDI+、Windows Imaging Components 和 FreeImage。WIC 是最快的，可以在 15ms 内完成一些操作。它支持磁盘缓存（最多可存储 100 万个文件），并且与 CDN 兼容（Amazon CloudFront 是理想的选择）。

它具有非常人性化的 URL 语法。前任。`image.jpg?width=100&height=100&mode=crop`.

它支持调整大小、裁剪、填充、旋转、PNG/GIF/JPG 输出、边框、水印、远程 URL、Amazon S3、MS SQL、Amazon CloudFront、批处理操作、图像过滤器、磁盘缓存和许多其他很酷的东西，比如缝雕。

它不支持图像的 POST 交付，但使用插件很容易做到这一点。而且您通常不想存储通过 POST 传递的图像，而不是仅仅用结果回复 POST 命令吗？

[披露：我是 ImageResizer 的作者]

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2008-09-29T00:37:17.917

Apache::ImageMagick，你安装它——还有 Apache 和 mod_perl。这是标准设置，检查文档，还有其他选择。这可能是交钥匙。

样本配置：

```
<Location /img>
PerlFixupHandler Apache::ImageMagick
PerlSetVar AIMCacheDir /tmp/your/cache/directory
</Location> 
```

您的请求可能如下所示： [http://domain/img/test.gif/Frame?color=red](http://domain/img/test.gif/Frame?color=red)

更多文档在[这里](http://search.cpan.org/~grichter/Apache-ImageMagick-2.0b7/ImageMagick.pm)！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2008-09-28T23:38:27.603

您可以使用[LibGD](http://libgd.org)或[ImageMagick](http://www.imagemagick.org)相当轻松地构建这样的服务。它们都有许多语言绑定。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2008-09-28T23:38:35.967

虽然不是开箱即用的解决方案，但请查看[ImageMagick](http://www.imagemagick.org/script/index.php)。它有一个 perl[接口](http://www.imagemagick.org/script/perl-magick.php)，所以将它与一些相当简单的 cgi 脚本或 mod_perl 结合起来，它应该可以解决问题。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2008-09-29T00:07:44.413

您可以使用 Google App Engine 来实现这一点——它们提供图像处理例程，并将在一定范围内免费托管。

这里有一些人们已经在做这样的事情的例子

[http://appgallery.appspot.com/results?q=image](http://appgallery.appspot.com/results?q=image)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-18T17:14:53.310

我找到[了这个产品](http://www.aspjpeg.com/)，它似乎符合我的要求

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2017-04-06T14:22:20.103

尝试[使用 OpenResty 和 Lua 的 Nginx 图像处理服务器](http://leafo.net/posts/creating_an_image_server.html)。它使用 ImageMagick C API。Openresty 带有[LuaJIT](http://luajit.org/)。它在速度方面具有惊人的表现。查看 LuaJIT 和 Openresty 的一些基准测试。**````**`*