# StackOverflow 问答 000739000-000739999

# c# - 面向 C# 开发人员的 Java 教程

> ID：739006
> 
> 赞同：4
> 
> 时间：2009-04-10T22:02:41.513
> 
> 标签：c#, java

> **可能重复：**
> [为 C# 人真正了解 Java 的最佳方式](https://stackoverflow.com/questions/90578/best-way-to-really-grok-java-for-a-c-guy)

我在 C# 上工作了几年，现在转向 Java。是否有适合 C# 开发人员的 Java 教程？

谢谢！

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T22:06:21.003

[这是一篇有用的文章](http://www.25hoursaday.com/CsharpVsJava.html)，用于比较语言语法和两者之间的一些差异。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T22:07:22.203

据我所知java有类似的语法；

无论如何看看[这里](http://it.toolbox.com/blogs/codesharp/java-for-c-developers-21248)这篇文章比较c#和java关键字

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T22:08:09.223

这本书并不是专门针对具有 C# 背景的人而编写的，但我仍然强烈推荐它。您将在阅读时自行与 C# 进行比较。它以电子形式免费提供。 [Bruce Eckel 的“用 Java 思考”](http://www.mindview.net/Books/TIJ/)

# java - 有没有办法在 Netbeans 或 Eclipse 中隐藏注释？

> ID：739009
> 
> 赞同：4
> 
> 时间：2009-04-10T22:05:28.447
> 
> 标签：java, eclipse, netbeans, annotations, code-folding

也许是一个愚蠢的问题，但如果在 Netbeans（或 Eclipse）中查看源代码时有一种方法可以隐藏或折叠 Java 注释，那就太好了。我没有找到选项，快速搜索也没有发现任何问题。

这是其中之一“你永远不想这样做，代码折叠是一种罪过！” 事物？

就我个人而言，我发现它对带注释的实体类很有用。所有的 hibernate / etc 注释都只是绒毛，一旦我的映射工作正常，我就永远不会看。真的很像进口。

（是的，我可以使用 XML 代替注释，我可能会开始这样做。但我只是想知道......）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-04-02T23:04:03.890

这是如何“隐藏”@Annotations 的一个很好的解决方案。使@Annotations 的颜色比其他颜色更浅，例如浅绿色。

**如何：** *首选项：Java> Editor> Syntax Coloring 在 Element 框中，选择 Annotations。单击颜色按钮。注释：浅绿色。我使用 RGB: 0, 240, 0 注释元素引用：浅绿色：RGB: 0, 170, 80*

这样，注释是可见的，但当您尝试阅读和编辑功能代码时，它们会分散注意力。如果您真的想不知道您的@Annotations，您可以使它们与背景颜色相同或非常接近，例如白色。然后只有 =values 会显示。佩罗布兰科？没有 es muy intelligente。胡安·雷扎-普里尔

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-12T17:19:44.047

只使用过 Eclipse 或 IDEA，我不知道隐藏注释的任何 IDE 选项，在我看来这是一件好事。

您的注释会影响代码的编译方式，通常还会影响代码的运行方式。在我看来，隐藏它们无异于在方法签名或语言的任何其他组件中隐藏//关键字`public`。他们的排除改变了他们周围环境的含义，因此改变了开发人员的期望。`protected``private`

# geometry - 查找多边形之间的共享顶点

> ID：739014
> 
> 赞同：2
> 
> 时间：2009-04-10T22:06:28.773
> 
> 标签：geometry

我很快就会遇到一个有趣的问题，我已经开始考虑算法。我想得越多，我就越害怕，因为我认为它会可怕地扩展 (O(n^4))，除非我能变得聪明。我很难对这个变得聪明。这是问题的简化描述。

我有 N 个多边形（其中 N 可以是巨大的 >10,000,000），它们存储为 M 个顶点的列表（其中 M 大约为 100）。我需要为每个多边形创建一个在其他多边形之间共享的任何顶点的列表（将多边形视为周围感兴趣的区域，有时是这些区域但彼此相对）。我看到这样的东西

```
Polygon i | Vertex | Polygon j | Vertex
   1          1         2          2
   1          2         2          3
   1          5         3          1
   1          6         3          2
   1          7         3          3 
```

这意味着多边形 1 中的顶点 1 与多边形 2 中的顶点 2 相同，多边形 1 中的顶点 2 与多边形 2 中的顶点 3 相同。同样，多边形 1 中的顶点 5 与多边形中的顶点 1 相同3....

为简单起见，我们可以假设多边形从不重叠，它们最接近的是在边缘接触，并且所有顶点都是整数（以便于测试等式）。

我现在唯一能做的就是对于每个多边形，我必须遍历所有多边形和顶点，给我一个 O(N^2*M^2) 的缩放比例，这在我的情况下会非常糟糕。我可以有非常大的多边形文件，所以我什至不能将它们全部存储在 RAM 中，这意味着要多次读取文件。

到目前为止，这是我的伪代码

```
for i=1 to N
  Pi=Polygon(i)
  for j = i+1 to N
    Pj=Polygon(j)
    for ii=1 to Pi.VertexCount()
      Vi=Pi.Vertex(ii)
      for jj=1 to Pj.VertexCount()
        Vj=Pj.Vertex(jj)
        if (Vi==Vj) AddToList(i,ii,j,jj)
      end for
    end for
  end for
end for 
```

我假设这已经出现在图形社区中（我没有花太多时间在那里，所以我不了解文献）。有任何想法吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T22:21:19.190

这是一个经典的迭代与内存问题。如果您将每个多边形与其他所有多边形进行比较，您将遇到 O(n^2) 解决方案。如果您在遍历所有多边形时构建一个表格，然后在表格中前进，您会得到一个很好的 O(2n) 解决方案。我在面试时问过类似的问题。

假设您有可用的内存，您希望创建一个多重映射（一个键，多个条目），其中每个顶点作为键，多边形作为条目。然后，您可以将每个多边形恰好走一次，将顶点和多边形插入到地图中。如果顶点已经存在，则将多边形作为附加条目添加到该顶点键。

一旦你击中了所有的多边形，你就可以遍历整个地图一次，然后对具有多个多边形条目的任何顶点做任何你需要做的事情。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T22:28:17.940

如果您有多边形/面数据，您甚至不需要查看顶点。

*   从 [0..M] 创建一个数组（其中 M 是顶点数）
*   遍历多边形并增加每个顶点索引的数组条目。

这为您提供了一个数组，该数组描述了每个顶点的使用次数。*

然后，您可以再次遍历多边形并检查每个顶点的条目。如果它 > 1，则您知道该顶点由另一个多边形共享。

如果您需要存储/查找其他信息，您可以进一步构建此策略。例如，您可以将多边形直接存储在数组中，而不是计数，从而获得使用给定顶点索引的所有面的列表。此时，您正在有效地创建一个以顶点索引为关键的地图。

（*此示例假设您没有退化的多边形，但可以轻松处理这些多边形）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T22:10:07.657

好吧，一个简单的优化是制作一个映射（可​​能是哈希表），将每个不同的顶点（由其坐标标识）映射到它所属的所有多边形的列表。这会将您的运行时间减少到 O(NM) 之类的东西 - 仍然很大，但我怀疑您是否可以做得更好，因为我无法想象有任何方法可以避免检查所有顶点。

# java - 如何使用默认电子邮件客户端从 Java 发送带有附件的电子邮件？

> ID：739016
> 
> 赞同：2
> 
> 时间：2009-04-10T22:06:38.383
> 
> 标签：java, email, attachment

我有一个生成 PDF 文件的 Java 程序。我希望用户单击一个按钮来打开默认电子邮件客户端，准备好将 PDF 作为附件发送。打开默认邮件客户端的两种标准方式都有问题：

1.  Java 6 似乎不允许在生成的消息中包含附件
2.  JDIC 有一个错误会阻止 Outlook 2007 正确发送消息：http: [//jdic.dev.java.net/issues/show_bug.cgi ?id=160](http://jdic.dev.java.net/issues/show_bug.cgi?id=160)

谁能建议一种方法来做到这一点？

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-03-28T19:58:42.443

[JDIC](http://java.net/projects/jdic/)提供了一些功能来做到这一点。尽管 JDIC 的大部分内容都被`java.awt.Desktop`Java 6 吸收了，但它不包括电子邮件组合位。不幸的是，随着[java.net 向 Kenai 平台的过渡，](http://www.java.net/forum/topic/glassfish/glassfish/kenai-migration-complete-documents-files-are-imported) JDIC 二进制文件消失了；我将我能找到的最新版本上传到项目[JIRA](http://java.net/jira/browse/JDIC-545)。

JDIC 在 OSGi 中表现不佳，因此我最近将相关的 MAPI 位提取到一个名为[jmapi](http://github.com/briandealwis/jmapi)的包中。

（我也将这个答案发布到[另一个问题](https://stackoverflow.com/questions/1564147/how-to-open-an-email-client-and-automatically-attach-file-in-java/5464318#5464318)。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T23:13:39.547

[javax.mail.internet.MimeMultipart](http://java.sun.com/products/javamail/javadocs/javax/mail/internet/MimeMultipart.html)消失了吗？这是设置附件的规范方式。

### 更新

好的，如果我直截了当，您想知道如何让您的应用程序在未指定的操作系统上使用未指定的电子邮件客户端来发送包含未定义附件的多部分 MIME 电子邮件，而不是通过自己构建 MIME 消息？

...好吧，好吧，我猜你提到了 Outlook，所以它一定是 Windows。但还是。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T23:45:54.760

您是否有特定的原因想要使用默认的电子邮件客户端，而不是使用电子邮件客户端 (JavaMail) 从 Java 发送？

您能否提供有关您尝试编写的应用程序类型的更多详细信息？我认为这是一个客户端 GUI 应用程序（Swing/SWT/AWT），但除此之外，我认为我们将需要更多细节。

# naming-conventions - x32 与 x64 的库名称

> ID：739023
> 
> 赞同：2
> 
> 时间：2009-04-10T22:09:28.347
> 
> 标签：naming-conventions

我有一个支持 x32 和 x64 平台的 C++ 静态库。

我的问题是：我应该根据哪个平台命名 .lib 文件吗？

即 MyLib32.lib 与 MyLib64.lib

英特尔数学库和 TBB 使用文件夹名称来处理此问题，以区分这 2 个库。

即 x32\Math.lib 与 x64\Math.lib

有没有比其他方法更好的方法？

我认为明确命名库以对应于预期的平台应该更好？这样我们不依赖于文件夹名称，并且 lib 是自记录的。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-10T22:14:29.270

善待您的用户，并按照您的建议在末尾添加 32 或 64。乍一看，绝对 100% 清楚这意味着什么，您永远不会混淆它们。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T23:47:12.947

我最近做了很多 32 位和 64 位的工作，而且我肯定更喜欢不同的名称。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T22:14:21.517

不，我不认为一种方法优于另一种方法，而且我认为您已经正确列举了每种方法的两个差异。

然而，根据我的经验，许多库具有相同的名称，但保存在单独的文件夹中，并分布在单独的 zip 文件中。

例如，sourceforge 上的 LPSolve 的二进制文件名称相同，而与平台无关。

> ID：739031
> 
> 赞同：
> 
> 时间：
> 
> 标签：

None

# java - 理智的设计替代品

> ID：739035
> 
> 赞同：0
> 
> 时间：2009-04-10T22:14:59.550
> 
> 标签：java, oop

我有一个（设计的）应用程序，基本上可以像这样工作：

Main 类、BusinessLogic 类、UserInterface 类

BusinessLogic 和 UserInterface 被设计为类库 - 不是持续开发，而是由开发人员在 Main 类中使用。

BusinessLogic 的构造函数还实例化了 UserInterface，它将显示基于文本的菜单并接受终端输入。基于该输入，它将通过调用其各自 BusinessLogic 对象的相关方法来执行相关功能。

但是，这是一个循环引用，并且 UserInterface 没有明显的方式来调用其各自的 BusinessLogic 对象（没有硬编码的 BusinessLogic 对象标识符，但这是更糟糕的做法！）。

这对我来说似乎是一个合乎逻辑的设计，但很难用编程术语来实现。

我考虑的一种替代方法是让 UI 将输入数据返回给 BusinessLogic 的构造函数，但我不希望 BusinessLogic 处理输入分析，UI 似乎是它的明智之选。

有任何想法吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T22:19:05.107

您应该尝试[Model-View-Controller 模式](http://en.wikipedia.org/wiki/Model%E2%80%93view%E2%80%93controller)。在您的情况下，模型和控制器可能最终相同。通过接口将您的类彼此隔离，然后在外部创建那些（在您的示例中从 Main ）将简化每个人的生活。

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-10T22:33:33.140

这听起来像是您可能想要使用模型-视图-控制器模式。

另外，如果你想减少部件之间的实例化依赖，你可能需要考虑使用[依赖注入](http://en.wikipedia.org/wiki/Dependency_injection)，就像使用[Spring](http://www.springsource.org/)一样。

# c++ - 为什么优先级队列大多使用 0 作为最重要的优先级？

> ID：739038
> 
> 赞同：6
> 
> 时间：2009-04-10T22:17:37.797
> 
> 标签：c++, algorithm, data-structures, queue

为什么大多数优先级/堆队列实现为 0 是最高优先级？我假设我错过了一些关键的数学原理。当我最近实现自己的优先级队列时，如果优先级随整数值上升，编写插入函数似乎更容易，但显然比我聪明的人认为它应该采用另一种方式。

有任何想法吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-10T22:19:40.083

大多数优先级队列都实现为[斐波那契堆](http://en.wikipedia.org/wiki/Fibonacci_heap)或类似的东西。该数据结构支持在恒定时间内提取最小值，这使得将 0 设为最高优先级并通过提取最小值将元素从队列中取出是很自然的。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-10T22:29:38.873

如果它一直在增加，你怎么能将任何东西设置为最高优先级？（+1 为 rossfab 的回答 :)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-09T02:42:15.737

通常是另一种方式的原因是优先级队列用于实现像 Dijkstra 和 A* 这样的算法，其中优先级是到节点的距离，并且您希望首先处理更近的节点。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-10T22:21:18.240

我认为没有任何设计原因。这可能只是因为大多数程序员习惯于将 0 视为第一个元素。另一个原因可能是因为枚举数从 0 开始，所以第一个定义的枚举“最高”整数值将是 0。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-11T08:10:04.033

作为一个反例，在最容易获得（如果不使用）的优先级队列实现之一，即 STL 中*，*`std::priority_queue`元素`top()`是根据. 当然，每个人都习惯了最低排序顺序排在队列前面的约定，所以这会在他们第一次使用它时吸引很多人。*`operator<`*

 ** * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-09T16:10:06.293

优先级队列本身并没有使 0 成为最高优先级的更好选择。然而，对于编写可重用实现的人来说，您必须选择一些东西，并且无论您使用哪种类型的整数或浮点值作为优先级，0 都是明确定义的。

即使在编写私有实现时，如果您决定只需要 256 个优先级并使用 unsigned char 作为您的优先级并将 255 作为您的最高优先级，那么如果您决定需要更多，则需要仔细查看所有代码水平。

# .net - LinqToSql - 多个子查询创建许多往返

> ID：739039
> 
> 赞同：1
> 
> 时间：2009-04-10T22:18:12.787
> 
> 标签：.net, linq, linq-to-sql

我有两个看起来像这样的表：

[替代文字 http://www.brettrobichaud.com/images/linq.png](http://www.brettrobichaud.com/images/linq.png)

我正在尝试从 ApplianceStatisticsLog 生成包含每个时期的两个特定 StatisticsNames 的查询。下面是我提出的 Linq 查询。它可以工作，但会为第一个子选择生成一个查询，然后为第二个子选择的每个记录生成一个额外的查询。哎呀，数据库往返正在杀死我。

我怎样才能重做这个以挤出单个 sql 查询？

```
from l in ApplianceStatisticsLogs
where l.ApplianceServerId > 1
orderby l.PeriodEndUtc ascending
select new
{
Time = l.PeriodEndUtc,
Stat1 = from s in ApplianceStatistics
        where s.ApplianceStatisticsLogId == l.ApplianceStatisticsLogId
          &&  s.ApplianceStatisticNameId == 2
        select s.Value,
Stat2 = from s in ApplianceStatistics
        where s.ApplianceStatisticsLogId == l.ApplianceStatisticsLogId
          &&  s.ApplianceStatisticNameId == 3
        select s.Value
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T22:28:39.797

**更新（基于关系）**：

```
select new
{
Time = l.PeriodEndUtc,
Stat1 = (from s in l.ApplianceStatistics
         where s.ApplianceStatisticNameId == 2
         select s.Value
       ).ToList(),
Stat2 = (from s in l.ApplianceStatistics
         where s.ApplianceStatisticNameId == 3
         select s.Value
       ).ToList()
} 
```

* * *

**尝试**：

```
select new
{
Time = l.PeriodEndUtc,
Stat1 = (from s in ApplianceStatistics
                where s.ApplianceStatisticsLogId == l.ApplianceStatisticsLogId
                  &&  s.ApplianceStatisticNameId == 2
                select s.Value
       ).ToList(),
Stat2 = (from s in ApplianceStatistics
                where s.ApplianceStatisticsLogId == l.ApplianceStatisticsLogId
                  &&  s.ApplianceStatisticNameId == 3
                select s.Value
       ).ToList()
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T17:57:58.423

弗雷迪走在了正确的轨道上，几乎成功了。解决方案最终是对每个子查询使用 First()。如：

```
from l in ApplianceStatisticsLogs
where l.ApplianceServerId > 1
orderby l.PeriodEndUtc ascending
select new
{
    Time = l.PeriodEndUtc,
    Stat1 = (from s in ApplianceStatistic
            where s.ApplianceStatisticsLogId == l.ApplianceStatisticsLogId
              &&  s.ApplianceStatisticNameId == 2
            select s.Value).First(),
    Stat2 = (from s in ApplianceStatistics
            where s.ApplianceStatisticsLogId == l.ApplianceStatisticsLogId
              &&  s.ApplianceStatisticNameId == 3
            select s.Value).First()
} 
```

我没有提到子查询中只有一条记录应该匹配。感谢弗雷迪的帮助！

# c++ - 如何在 16 位显示器上缩小原始 rgb 数据数组

> ID：739043
> 
> 赞同：2
> 
> 时间：2009-04-10T22:19:13.830
> 
> 标签：c++, c, linux

我在 16 位显示器上有一个原始 rgb 数据数组，尺寸为 320 * 480。数组的大小为 320*480*4 = 6144000。

我想知道如何在不损失图像质量的情况下缩小（80 * 120）？

我找到了这个关于在 2D 数组中缩放图像的链接，但是如何将它应用于我的 16 位显示器数组？它不是二维数组（因为它有 16 位颜色）。

[C/C++ 中的图像缩放和旋转](https://stackoverflow.com/questions/299267/image-scaling-and-rotating-in-cc)

谢谢你。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-10T22:29:31.213

如果您将大图像缩小为较小的图像，您将失去图像质量。

那么，问题是如何最小化这种损失。

有许多算法可以做到这一点，每种算法都有优点和缺点。

通常，您将对图像应用某种过滤器，例如双线性或最近邻。[这是](http://www.imagemagick.org/Usage/resize/#filter)在 ImageMagick 上下文中对此类过滤器的讨论。

此外，如果输出将小于每像素 16 位，则需要进行某种形式的[颜色量化](http://en.wikipedia.org/wiki/Color_quantization)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-10T22:51:41.223

我假设您的意思是 16 位 rgb 显示器，而不是每种颜色（红色、绿色和蓝色）为 16 位的显示器。我还假设您知道您的 r、g 和 b 值是如何在该 16 位空间中编码的，因为有[两种可能性](http://en.wikipedia.org/wiki/16_bit_color)。

因此，假设您知道如何分割色彩空间，您现在可以使用一系列字节数组来表示您的数据。变得棘手的决定是是否使用字节数组，因为您有一组算法已经可以在这些数组上完成工作，但每个字节会花费您可能无法花费的一些额外位，或者将所有内容都塞入该 16 位格式，然后对每个 16 位像素的适当位进行处理。只有你才能真正回答这个问题；如果您有内存，我会选择字节数组方法，因为它可能更快，并且您将获得一些额外的精度，以使图像最终看起来更平滑（呃）。

鉴于这些假设，这个问题真的可以通过您在设备上的时间来回答。如果你有一个非常快的设备，你可以实现一个[Lanczos 重采样](http://en.wikipedia.org/wiki/Lanczos_resampling)。如果您的设备速度较慢，[双三次插值](http://en.wikipedia.org/wiki/Bicubic_interpolation)也可以很好地工作。如果你有一个更慢的设备，[双线性插值](http://en.wikipedia.org/wiki/Bilinear_interpolation)是你的朋友。

如果你真的没有速度，我会在一些外部应用程序中重新缩放，比如 photoshop，并保存一系列你需要时加载的位图。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T22:26:49.630

缩小图像的方法有很多，但没有一种方法可以保证不损失“质量”。最终，信息在重新调整过程中丢失。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T22:37:41.147

由于您要缩小 4 倍，因此原始图像中的每个 4x4 像素块将对应于输出图像中的单个像素。然后，您可以遍历原始图像中的每个 4x4 块，然后将其缩小为单个像素。进行这种减少的一种简单方法（也许不是最好的方法）可能是取 RGB 分量的平均值或中值。

您应该注意，您不能在不损失图像质量的情况下进行图像缩放，除非对于原始图像中的所有块，每个像素都是完全相同的颜色（这不太可能）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T22:27:33.043

您有 16 位颜色 = 2 字节，但在您的计算中使用 4 乘数。
也许您不需要减小图像大小？

一般来说，在不损失质量的情况下缩放光栅图像是不可能的。一些算法使缩放几乎没有可见的质量损失。

# c# - RuntimeType:http://schemas.datacontract.org/2004/07/System' 不是预期的

> ID：739052
> 
> 赞同：7
> 
> 时间：2009-04-10T22:22:30.967
> 
> 标签：c#, datacontractserializer

好的，所以我让 DataContractSerializer 与我的对象图一起工作。有关更多信息，请参阅我以前的问题。

[树结构的序列化/反序列化](https://stackoverflow.com/questions/736568/serialization-derialization-of-a-tree-structure)

[反序列化器不知道映射到该合约的任何类型](https://stackoverflow.com/questions/736900/the-deserializer-has-no-knowlege-of-any-type-that-maps-to-this-contract)

但是，我的一个字段**_UserPropertyDefinitions**的定义如下所示。它定义了该用户可以添加到数据结构中的对象的自定义属性列表。字符串是标识属性的唯一键，Type 是属性的类型，它始终是原始类型，如 Bool、Int、String 等。

每个对象都有一个对应的**Dictionary(String key, Object value)**集合来存储它为任何“用户属性”设置的值

```
[DataMember]
private Dictionary<string, Type> _UserPropertyDefinitions; 
```

当这个属性是一个空集合时，我的对象图可以很好地序列化，但是一旦我向这个集合添加了一个自定义属性，我在尝试使用 DataContractSerializer 序列化时得到以下异常。

> 不应使用数据合同名称为“RuntimeType: [http://schemas.datacontract.org/2004/07/System](http://schemas.datacontract.org/2004/07/System) ”的类型“System.RuntimeType”。将任何静态未知的类型添加到已知类型列表中 - 例如，通过使用 KnownTypeAttribute 属性或将它们添加到传递给 DataContractSerializer 的已知类型列表中。

如果我删除该字段的 DataMember 属性，我可以序列化/反序列化而不会出现异常，但我当然会丢失我在该字段中创建的设置。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-10T22:25:43.797

我很确定它`Type`不会很好地序列化 - 并且可以说它无论如何都不属于数据合同，因为（特定于实现）它违背了数据合同的主要目标之一......

但是，我希望最好的方法是`Dictionary<string,string>`使用`Type`'s`AssemblyQualifiedName`或`FullName`.

# asp.net - 如何从 asp.net / jQuery.ajax POST 获取 URL 参数？

> ID：739067
> 
> 赞同：1
> 
> 时间：2009-04-10T22:29:38.483
> 
> 标签：asp.net, web-services, post, jquery

我试图弄清楚如何从我正在使用的 jQuery 插件中获取在 URL 中传递的参数。基本上，我正在向我的 Web 服务发送一个 POST ajax 请求并尝试使用 URL 参数，但它们总是返回为空。我假设这与我在 POST 中的事实有关。

任何人都可以为我提供一些关于如何实现这一点的见解吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T22:45:31.083

我不确定您为什么选择在 AJAX 调用中使用查询字符串参数。除非有非常特殊的原因，否则您应该将它们作为参数发布到您的 Web 服务方法中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T22:52:22.627

嗨，我正在使用 jQuery jqGrid 插件，默认情况下它会向 url 发布 5 或 6 个参数。我在获取这些参数时遇到了麻烦，通过查看一些 php 示例，它显示了从表单变量中获取参数的方法……我只是想看看是否有办法做到这一点。我会看看我能做些什么来将它们作为参数发布。. . 只是为了咯咯笑，有没有办法我会或可以做到这一点？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-03-03T16:09:16.507

对于 ASP.NET....

你可以得到`POST`参数`Request["paramName"];`

如果您使用`GET`带有查询字符串参数的请求，那么

```
Request.QueryString["paramName"]; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-01-12T21:58:56.613

我有一个类似的问题。

我正在使用 jQuery/json 并返回到 C#/Webservice。我不知道如何读取我创建的 json 变量。

这是客户端（在用户控件上）：

```
<script type="text/javascript" language="javascript">
    function DoLogin() 
    {
        var un = document.getElementById('UserNameText').value;
        var pw = document.getElementById('PasswordText').value;
        var info = "{ 'UserName':'" + un + "', 'Password':'" + pw + "'}";

        $.ajax(
        {
            type: "POST",
            url: "http://localhost:60876/Sitefinity/Services/Login/Login.asmx/LoginSpecial",
            dataType: 'json',
            data: info,
            contentType: "application/json; charset=utf-8",
            success: function (msg) { alert(msg.d); },
            error: function (msg) { alert(msg.responseText); }
        });
    }
</script> 
```

这是Web服务端：

```
 [WebService(Namespace = "http://tempuri.org/")]
    [WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
    [System.ComponentModel.ToolboxItem(false)]
    // To allow this Web Service to be called from script, using ASP.NET AJAX, uncomment the following line. 
     [System.Web.Script.Services.ScriptService]
    public class Login : System.Web.Services.WebService
    {
        [ScriptMethod(ResponseFormat = ResponseFormat.Json)]
        [WebMethod]
        public string LoginSpecial()
        {
            // read the json variables: UserName, Password.

            string un = HttpContext.Current.Request["UserName"] != null ? HttpContext.Current.Request["UserName"].ToString() : String.Empty;
            // the previous isn't working for some reason.

            return "Some message here";
        }
    } 
```

我正在访问网络服务，但我需要来自 json 的用户名/密码来进行一些验证。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-01-12T22:14:01.330

如果您使用的是 asp.net WebForms，我建议您使用 ScriptManager 为您的 Web 服务生成一个 javascript 代理，然后使用该 javascript 代理而不是手动执行 ajax 调用。下面是使用 ScriptManager 和 Web 服务的快速教程/演练：http: [//msdn.microsoft.com/en-us/magazine/cc163354.aspx](http://msdn.microsoft.com/en-us/magazine/cc163354.aspx)

大致是这样的：

```
// in html you have this
<script src="WebService.asmx/jsdebug" type="text/javascript"></script>

// csharp web-service like this
[WebMethod]
public int Add(int a, int b) { return a + b; } 

// further javascript to call it
function CallAdd()
{
    // method will return immediately
    // processing done asynchronously
    WebService.Add(0,6, OnMethodSucceeded, OnMethodFailed);
} 
```

这应该消除通过查询字符串发布参数的需要，这在soap 环境中通常不支持，因为服务需要格式良好的soap 消息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2016-11-09T10:56:17.353

```
string parameter = HttpUtility.ParseQueryString(HttpContext.Current.Request.UrlReferrer.Query).Get("param1"); 
```

# java - 为什么java找不到JUnit框架？

> ID：739076
> 
> 赞同：0
> 
> 时间：2009-04-10T22:33:55.477
> 
> 标签：java, compiler-construction, junit

我正在尝试使用 JUnit 编译一个测试类，但我不知道为什么它不能编译。

我在班级顶部有以下几行：

```
import java.util.*;
import org.junit.*; 
```

我得到的错误是

```
package org.junit does not exist 
```

JUnit.jar 当前位于 Program Files\JUnit\junit.jar 中，当前也位于我的类路径中。如果有帮助，我正在使用 Windows Vista。

关于如何用 JUnit 编译这个测试类的任何想法？

非常感谢，

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-10T22:35:59.997

您使用的是哪个版本的 JUnit？

我认为在 JUnit 3 之前，包是不同的：

```
 import junit.framework.*; 
```

此外，如果您使用的是 Eclipse，则可以选择要使用的 JUnit 框架。

# visual-studio - Visual Studio：默认设置

> ID：739077
> 
> 赞同：3
> 
> 时间：2009-04-10T22:34:09.223
> 
> 标签：visual-studio, installation

我们这里有很多开发人员使用 MSVC 2008，我想标准化 Visual Studio 设置和项目设置。

特别是，我想要：

1）工具->选项中的所有设置都相同（尤其是选项卡设置！）

2）我们有一个源存储库，其中有一个共享文件夹。共享文件夹包含我们在不同人开发的多个解决方案 (.sln) 中重复使用的头文件/代码。我希望创建的所有新 VC 项目自动包含 (/I) 目录并链接到该共享文件夹中的共享 .lib/dll。（注意：这个过程变得非常耗费人力，每次我们创建一个新的解决方案时，我们都必须一遍又一遍地重新输入这些包含/库名称）

有人可以拯救我们并指出正确的解决方案吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-10T22:50:16.173

对于#1，您可以轻松设置一个 Visual Studio 环境，然后使用导入/导出设置（在工具菜单下）保存一个可以加载到每个人的环境中的设置文件。

对于＃2，您可以[尝试创建一个项目模板](http://www.carlosag.net/Articles/createVSTemplate.aspx)，这样每当有人创建一个新项目时，他们就可以使用该模板，它会自动包含这些项目。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T22:48:30.607

对于选项卡设置等，您可以使用工具 -> 导入和导出设置来创建一个标准设置文件，您可以将其签入源代码管理。任何新开发人员都可以提取它并将其导入到他们的 Visual Studio 设置中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T00:37:23.247

1 一种新颖的方法是使用 Microsoft 的 Live Mesh [Sync VS Settings 和 Live Mesh](http://weblogs.asp.net/lduveau/archive/2008/06/30/sync-your-visual-studio-settings-with-live-mesh.aspx)。让所有开发人员使用相同的 VS 设置将是一种简单的方法，尽管我可以看到一旦个人开始根据自己的喜好进行定制就会导致问题。

# data-access-layer - 从业务对象中抽象出数据访问层

> ID：739078
> 
> 赞同：1
> 
> 时间：2009-04-10T22:34:35.820
> 
> 标签：data-access-layer, business-objects, separation-of-concerns

将数据访问代码与业务对象分离并不是什么新鲜事，但我一直在寻找实现某些目标的“最佳方式”。

我有以下课程：

橙色 - 这是我的业务对象。

OrangeList - 这是一个橘子列表。

用户将通过调用 OrangeList.Fetch(someCriteria) 从数据存储中获取 Orange 对象。因此，OrangeList 必须具有对数据访问层的引用 - 所以它具有属性：IDataProvider MyDataProvider。

这对我有用，但问题是我们不能单独获取一个橙色 - 我们总是必须通过 OrangeList。

Orange 和 OrangeList 中的任何一个或两者都必须来自一些持有 DataProvider 的公共对象。

这是一个问题，还是我的方法一开始就离题了？

任何提示/指针表示赞赏，谢谢。

***编辑：根据下面的讨论，我检查了存储库模式。***

但是对于我的项目，我认为将存储库与 DAL 进一步分开是个好主意。

所以....存储库是我获取橘子和保存橘子的方式，但仍然不知道如何。我将它委托给 IDataProvider，它可能是图中列出的一些。

澄清一下 - Orange 不知道如何获取/更新自己，对吧？这是一个纯粹的业务对象——这就是重点吗？

[替代文字 http://img22.imageshack.us/img22/2460/repositorya.jpg](http://img22.imageshack.us/img22/2460/repositorya.jpg)

如果你想知道，我的“LegacyDataProvider”是为了支持一个旧系统，它访问一个基于文件的数据库（FoxPro，eek）——但这让我可以把它包装起来，让它远离我的新代码。

在 .NET 程序集构造方面，为了防止循环引用，看起来我将拥有一个 Repository.DLL [OrangeRepo]、一个 DataProviderInterface.DLL [IDataProvider] 和一个 BusinessObjects.dll [Orange]。都好？

那我有没有关于存储库的想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T22:40:27.490

我建议[存储库模式](http://martinfowler.com/eaaCatalog/repository.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T22:44:15.127

我会（并且确实）从一个主 API 对象（OrangeCart？）中组合所有这些东西，该对象也构成数据访问层的接口对象。您的 Oranges 和 OrangeLists 知道它们属于 OrangeCart 并与它对话以进行 DAL 操作。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T23:18:01.473

而不是 OrangeList(someCriteria)，我有 Oranges.Criteria1List、Oranges.Criteria2List。对于单身人士，我有 Oranges.GetItem(orangeId)。

按照自己的方式进行操作，BusinessObject 最终需要从逻辑数据设计术语而不是概念术语中进行思考。

（存储库实现给我带来了同样的不适——它们通常只是在表上放置一个薄抽象厚代码层。我不希望 BL 被要求了解数据库实现细节，如数据类型和大小。解耦这些依赖关系通常很有用。）

# wpf - DataGrid：帮助访问在 Ce llEditingTemplate 中定义的控件

> ID：739084
> 
> 赞同：2
> 
> 时间：2009-04-10T22:37:21.180
> 
> 标签：wpf, datagrid, binding, datatemplate

我正在使用带有 DataGridTemplateColumn 的 WPF DataGrid。DataGridTemplateColumn.CellEditingTemplate 包含一个组合框，其中 IsEditable 设置为“true”。在我的 RowEditEnding 事件处理程序中，我想读取该 ComboBox 的 Text 属性 - 唯一的问题是我不知道如何在事件处理程序中检索 ComboBox 实例以获取 Text 属性。

作为参考，这是我的数据模板：

```
 <!-- ... -->
  <my:DataGridTemplateColumn.CellEditingTemplate>
      <DataTemplate>
          <ComboBox IsEditable="True" ItemsSource="{Binding Source={StaticResource ProductCategories}}" SelectedItem="{Binding Path=Name}" DisplayMemberPath="Name" />
      </DataTemplate>
  </my:DataGridTemplateColumn.CellEditingTemplate>
  <!-- ... --> 
```

我的代码：

```
 private void productsDataGrid_RowEditEnding(object sender, DataGridRowEditEndingEventArgs e)
    {
        // UH-OH! Where do I find the ComboBox instance?
    } 
```

我知道我可以使用 e.Row 到达当前受影响的行......也许解决方案涉及使用 e.Row 的东西？我尝试从 e.Row 递归地遍历视觉树，寻找 ComboBox 的实例，但没有骰子。我几乎肯定该解决方案很简单，但是，总的来说，我对 WPF 比较陌生。任何建议将不胜感激。

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-11T10:30:12.617

您可以使用此代码直接从 DataGrid 中获取 de Combobox Column

```
var cbx = (DataGridComboBoxColumn)productsDataGrid.Columns.First(a => a.Header.ToString() == "name of your column"); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-08-17T01:48:44.720

似乎只能在 DataGrid 中的 PreparingCellForEdit 事件期间访问 CellEditingTemplate。您可以在 DataGrid 上为该事件连接一个处理程序，并在处理程序上执行类似的操作以访问您的 ComboBox

```
private void _CounterGoalsGrid_PreparingCellForEdit(object sender, 
    DataGridPreparingCellForEditEventArgs e) 
    {
        ComboBox editCombo = (e.EditingElement.FindName("<your combobox name>") as ComboBox);
    } 
```

*   请记住在 xaml 中命名您的 ComboBox。

# multithreading - MS Access 中的 VBA + 线程

> ID：739089
> 
> 赞同：12
> 
> 时间：2009-04-10T22:41:46.550
> 
> 标签：multithreading, ms-access, vba

如何在 MS Access VBA 中创建在单独线程上运行的进程？我想创建一个只会坐下来等待消息的进程。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2012-12-03T15:03:00.170

您可能想查看此解决方法：[http ://www.excelhero.com/blog/2010/05/multi-threaded-vba.html](http://www.excelhero.com/blog/2010/05/multi-threaded-vba.html)

它是 Excel，但实际上应该是相同的。它通过构建 VBScript “代理”并让它们执行任务来工作。检查示例，这令人印象深刻

-维果

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-11T20:46:53.917

没有办法直接在 VBA 本身中执行此操作。 [这是一个 MSDN 论坛讨论](http://social.msdn.microsoft.com/Forums/en-US/vsto/thread/735c8f26-2129-4b46-8c1a-aad385cab2ed)，详细讨论了这一点。Office 从未公开任何用于多线程的 VBA 扩展。

但是，您可以通过调用 Windows API 或在 VBA（在其他地方编写）中创建您自己的 COM 对象来执行此操作，该对象为您执行多线程调用。只需确保以某种方式将所有内容编组回调用线程（可能轮询您的 COM 对象，或类似的东西）。

此外，您可能想查看 Bendewey 关于 COM 线程的链接，因为它与此非常相关。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-10T22:51:00.150

好问题，但我认为这是不可能的。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-06-07T09:23:11.617

使用 ShellOpen() 之类的东西来启动一个 shell 脚本怎么样？例如 Visual Basic Sc​​ript x 次，它会完成这项工作，通过文件与脚本通信（以及一个池机制来检测结果何时到达）？我认为这比编写 COM 组件更容易。此外，VB Script 与 VBA 非常相似。但是，不好的一面是相当多的 - 写入和读取文件比共享内存更耗时，池化可能会使 VBA 脚本看起来没有响应等等。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-10T23:02:24.520

我能想到的最快方法是创建一个表单并在其上放置一个现有的或自己动手做的控件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-07-16T06:32:28.867

您还可以使用让系统处理事件的 DoEvents 过程。只是不时调用这个子线程，主线程不应该冻结。

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-11T21:01:12.370

如果 MS Access VBA 允许您使用表单，请在表单上放置一个计时器并将延迟设置为非常低的值，例如 10 毫秒。然后将您的代码放在定时器事件函数中，它将在单独的线程中执行。

# python - 您如何自动化大型项目的启动/调试？

> ID：739090
> 
> 赞同：4
> 
> 时间：2009-04-10T22:43:55.063
> 
> 标签：python, debugging, gdb, subprocess, selinux

**设想：**

有一个复杂的软件，手动启动很烦人。我所做的是创建一个 python 脚本来启动可执行文件并附加*gdb*进行调试。

进程启动脚本：

*   确保设置了环境变量。
*   确保将本地构建目录添加到环境`LD_LIBRARY_PATH`变量中。
*   将当前工作目录更改为可执行文件期望的位置（不是我的设计）
*   使用配置文件启动可执行文件是唯一的命令行选项
*   将可执行文件的输出通过管道传输到第二个日志记录进程
*   记住可执行文件的 PID，然后启动并将 gdb 附加到正在运行的可执行文件。

该脚本有效，但有一个警告。**ctrl-c 不会中断被调试者并将控制权返回给 gdb。**因此，如果我在没有活动断点的情况下“继续”，我将永远无法再次停止该进程，它必须被另一个 shell 杀死/中断。顺便说一句，运行“kill -s SIGINT <pid>”，其中 <pid> 是被调试者的 pid，确实让我回到了 gdb 的提示符......但是必须以这种方式做事真的很烦人

起初我以为 Python 正在抓取 SIGINT 信号，但情况似乎并非如此，因为我设置了信号处理程序将信号转发给被调试者，但这并不能解决问题。

我已经尝试了对 python 脚本的各种配置（调用 os.spawn* 而不是子进程等）。似乎无论我怎么做，如果 python 启动子进程，SIGINT (ctrl-c) 信号不要路由到 gdb 或子进程。

**目前的思路**

*   这可能与被调试者和 gdb 需要一个单独的进程组 ID 相关......对此有任何信任吗？
*   SELinux 可能的错误？

**信息：**

*   数据库 6.8
*   Python 2.5.2（Python 2.6.1 也存在问题）
*   SELinux 环境（向进程传递信号的错误？）

**我考虑过的替代方案：**

*   设置一个 .gdbinit 文件来完成脚本所做的工作、环境变量和当前工作目录是这种方法的一个问题。
*   手动启动可执行文件并附加 gdb (yuck)

**问题：** 您如何自动化大型项目的启动/调试？

**更新：** 我在下面尝试了 Nicholas Riley 的示例，在我家里的 Macintosh 上，它们都允许 cntl-c 以不同的程度工作，在生产 boxen（我现在相信它可能正在运行 SELinux）上它们不...

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T01:41:29.397

您可以尝试忽略它，而不是将信号从 Python 转发给被调试者。以下对我有用：

```
import signal
signal.signal(signal.SIGINT, signal.SIG_IGN)

import subprocess
cat = subprocess.Popen(['cat'])
subprocess.call(['gdb', '--pid=%d' % cat.pid]) 
```

有了这个，我能够在 GDB 中重复 ^C 并毫无问题地中断被调试者，但是我确实看到了一些奇怪的行为。

顺便说一句，将信号转发到目标进程时我也没有问题。

```
import subprocess
cat = subprocess.Popen(['cat'])

import signal, os
signal.signal(signal.SIGINT,
              lambda signum, frame: os.kill(cat.pid, signum))

subprocess.call(['gdb', '--pid=%d' % cat.pid]) 
```

那么，也许您的情况还发生了其他事情？如果您发布了一些中断的代码，它可能会有所帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T02:52:24.043

您的评论指出您正在使用腻子...您有控制 tty 吗？使用 openssh 您可能想要添加 -T 选项，我不知道腻子如何/是否会按照您使用它的方式执行此操作。

另外：您可以尝试使用 cygwin 的 ssh 而不是 putty。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T21:05:18.487

如果您已经设置了一个当前脚本来执行此操作，但在自动化其中的一部分时遇到问题，也许您可​​以抓住 expect 并使用它来提供设置，然后回到交互模式以启动该过程。然后你仍然可以让你的 ctrl-c 可以中断。

# c++ - Win32 LB_GETTEXT 返回垃圾

> ID：739095
> 
> 赞同：5
> 
> 时间：2009-04-10T22:45:48.943
> 
> 标签：c++, string, winapi, listbox

我有一个问题很可能是一个简单的问题，但对我来说仍然是一个问题。我在 Win32 / C++ 中使用列表框，当从我的列表框中获取选定的文本时，返回的字符串只是垃圾。它是结构或类似的句柄吗？

下面是我得到的代码和示例。

```
std::string Listbox::GetSelected() {
int index = -1;
int count = 0;

count = SendMessage(control, LB_GETSELCOUNT, 0, 0);

if(count > 0) {
    index = SendMessage(control, LB_GETSEL, 0, 0);
}

return GetString(index);
}

std::string Listbox::GetString(int index) {
int count = 0;
int length = 0;
char * text;

if(index >= 0) {
    count = GetItemCount();

    if(index < count) {
        length = SendMessage(control, LB_GETTEXTLEN, (WPARAM)index, 0);
        text = new char[length + 1];

        SendMessage(control, LB_GETTEXT, (WPARAM)index, (LPARAM)text);
    }
}
std::string s(text);
delete[] text;

return s;
} 
```

GetItemCount 就是这样做的。它只是获取当前列表框中的项目数。

我从列表框中抓取的字符串是“测试字符串”，它返回了 ¨±é» Tzã

有任何帮助，谢谢。

好的，我将它缩小到我的 GetSelected 函数，因为 GetString 返回正确的字符串。

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-10T22:58:11.207

LB_GETSEL 消息不返回选定项的索引，它返回您在 WPARAM 中传递的 ITEM 的选定状态。

您还有一个严重的错误，如果没有选择任何项目，您将尝试检索索引 -1 处的项目字符串，这显然是错误的。检查这些 SendMessage 调用的返回值将有助于您诊断问题。

这是一个如何获取第一个选定项目的文本的示例；

```
// get the number of items in the box.
count = SendMessage(control, LB_GETCOUNT, 0, 0);

int iSelected = -1;

// go through the items and find the first selected one
for (int i = 0; i < count; i++)
{
  // check if this item is selected or not..
  if (SendMessage(control, LB_GETSEL, i, 0) > 0)
  {
    // yes, we only want the first selected so break.
    iSelected = i;
    break;
  }
}

// get the text of the selected item
if (iSelected != -1)
  SendMessage(control, LB_GETTEXT, (WPARAM)iSelected , (LPARAM)text); 
```

或者，您可以使用 LB_GETSELITEMS 来获取所选项目的列表。

# c# - 在 C# 中启动进程而不分散控制台窗口

> ID：739101
> 
> 赞同：62
> 
> 时间：2009-04-10T22:50:18.247
> 
> 标签：c#, process

我弄清楚如何启动一个进程。但我现在的问题是控制台窗口（在本例中为 7z）弹出最前面挡住了我的视线并移开我的注意力，打断我的句子，或者每隔几秒我就在做。它非常烦人，我该如何防止这种情况发生。我认为 CreateNoWindow 解决了这个问题，但它没有。

注意：有时控制台需要用户输入（是否替换文件）。所以完全隐藏它可能是一个问题。

这是我当前的代码。

```
void doSomething(...)
{
    myProcess.StartInfo.FileName = ...;
    myProcess.StartInfo.Arguments = ...;
    myProcess.StartInfo.CreateNoWindow = true;
    myProcess.Start();
    myProcess.WaitForExit();
} 
```

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2009-04-10T23:17:32.830

如果我没记错的话，这对我有用

```
Process process = new Process();

// Stop the process from opening a new window
process.StartInfo.RedirectStandardOutput = true;
process.StartInfo.UseShellExecute = false;
process.StartInfo.CreateNoWindow = true;

// Setup executable and parameters
process.StartInfo.FileName = @"c:\test.exe"
process.StartInfo.Arguments = "--test";

// Go
process.Start(); 
```

我一直在 C# 控制台应用程序中使用它来启动另一个进程，它会阻止应用程序在单独的窗口中启动它，而不是将所有内容都保存在同一个窗口中。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2010-07-08T22:30:48.320

@galets在你的建议中，窗口仍然被创建，只是它开始最小化。这对于实际做 acidzombie24 想要的事情会更好：

```
myProcess.StartInfo.WindowStyle = ProcessWindowStyle.Hidden; 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-10T22:54:09.143

尝试这个：

```
myProcess.StartInfo.WindowStyle = ProcessWindowStyle.Minimized; 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-10T23:06:20.847

我必须仔细检查，但我相信你还需要设置`UseShellExecute = false`. 这也让您可以捕获标准输出/错误流。

# c# - DataContractSerializer 创建的 XML 格式

> ID：739114
> 
> 赞同：56
> 
> 时间：2009-04-10T22:56:25.267
> 
> 标签：c#, xml, formatting, datacontractserializer

有没有一种简单的方法可以让 DataContractSerializer 吐出格式化的 XML 而不是一个长字符串？我不想以任何方式更改标签或内容，只需添加换行符和缩进以使 XML 更具可读性？

```
<tagA>
   <tagB>This is</tagB>   
   <tagC>Much</tagC>
   <tagD>
      <tagE>easier to read</tagE>
   </tagD>
</tagA>

<tagA><tagB>This is</tagB><tagC>Much</tagC><tagD><tagE>harder to read</tagE></tagD></tagA> 
```

* * *

## 回答 #1

> 赞同：93
> 
> 时间：2009-04-10T23:40:47.330

正如bendewey 所说， XmlWriterSettings 是您所需要的-例如

```
var ds = new DataContractSerializer(typeof(Foo));

var settings = new XmlWriterSettings { Indent = true };

using (var w = XmlWriter.Create("fooOutput.xml", settings))
    ds.WriteObject(w, someFoos); 
```

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-04-10T23:05:14.483

看一下楼盘的`Indent`属性[`XmlWriterSettings`](http://msdn.microsoft.com/en-us/library/system.xml.xmlwritersettings_properties.aspx)

**更新：**这是 MSDN 关于[如何：指定 XmlWriter 上的输出格式的一个很好的链接](http://msdn.microsoft.com/en-us/library/kbef2xz3(VS.80).aspx)

此外，这是一个示例：

```
class Program
{
    static void Main(string[] args)
    {
        var Mark = new Person()
        {
            Name = "Mark",
            Email = "mark@example.com"
        };

        var serializer = new DataContractSerializer(typeof(Person));

        var settings = new XmlWriterSettings()
        {
            Indent = true,
            IndentChars = "\t"
        };

        using (var writer = XmlWriter.Create(Console.Out, settings))
        {
            serializer.WriteObject(writer, Mark);
        }
        Console.ReadLine();
    }
}
public class Person
{
    public string Name { get; set; }
    public string Email { get; set; }
} 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2010-02-19T20:00:36.587

小心调整 XML 文档中的空格！调整空格将使 XML 对我们人类来说更具可读性，但它可能会干扰机器解析。

根据[XML 标准](http://www.w3.org/TR/REC-xml/#sec-white-space)，默认情况下空格很重要。换句话说，就 XML 而言，*空白就是内容*。

如果您将格式良好的 XML 输入 XML Document 对象，您将获得与其中没有空格或换行符的版本不同的结果。您将在已格式化的版本中添加额外的文本节点。

这篇关于[XML White Space](http://msdn.microsoft.com/en-us/library/ms256097.aspx)的 MSDN 文章有几个例子展示了空白是多么棘手。

如果您只是为了人类消费而格式化 XML，那没关系。但是，如果您尝试往返格式化文档，您可能会遇到麻烦。

由于使用 DataContractSerializer 的主要好处之一是能够*无缝地*序列化对象和反序列化 XML ，因此通常最好不要理会丑陋的输出。

我通常将输出粘贴到 NotePad++ 中，并在我想读取它以进行调试时在其上运行一个 XML-tidy 宏。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-11-16T08:47:04.317

```
 public static string SerializeEntity<T>(T source)
    {
        using (MemoryStream ms = new MemoryStream())
        {

                NetDataContractSerializer serializer = new NetDataContractSerializer();
                serializer.Serialize(ms, source);
                return System.Text.Encoding.ASCII.GetString(ms.ToArray());

        }
    }

    public static T DeSerializeEntity<T>(string xml)
    {
        using (MemoryStream ms = new MemoryStream(System.Text.Encoding.ASCII.GetBytes(xml)))
        {
                NetDataContractSerializer serializer = new NetDataContractSerializer();
                return (T)serializer.Deserialize(ms);
        }
    } 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-02-22T14:45:24.000

基于此处发布的使用 XmlWriter 的其他示例，这里有一个版本（来自[http://ClipFlair.codeplex.com](http://ClipFlair.codeplex.com)），它适用于流（以及特定的 Ionic.Zip 库），并且还显示了当您不使用时代码的情况t 应用格式（使用条件编译 - 只需注释掉 #define 以使其写入未格式化的 XML）

```
#define WRITE_FORMATTED_XML

using System.Xml;

namespace ClipFlair.Windows
{

  public partial class BaseWindow : FloatingWindow
  {

    //...

    #if WRITE_FORMATTED_XML
    private static XmlWriterSettings XML_WRITER_SETTINGS = new XmlWriterSettings() { Indent=true, IndentChars="  "};
    #endif

    //...

    public virtual void SaveOptions(ZipFile zip, string zipFolder = "") //THIS IS THE CORE SAVING LOGIC
    {
      if (SavingOptions != null) SavingOptions(this, null); //notify any listeners

      View.Busy = true;
      try
      {
        ZipEntry optionsXML = zip.AddEntry(zipFolder + "/" + View.GetType().FullName + ".options.xml",
          new WriteDelegate((entryName, stream) =>
          {
            DataContractSerializer serializer = new DataContractSerializer(View.GetType()); //assuming current View isn't null
            #if WRITE_FORMATTED_XML
            using (XmlWriter writer = XmlWriter.Create(stream, XML_WRITER_SETTINGS))
              serializer.WriteObject(writer, View);
            #else
            serializer.WriteObject(stream, View);
            #endif
          }));
      }
      catch (Exception e)
      {
        MessageBox.Show("ClipFlair options save failed: " + e.Message); //TODO: find the parent window
      }
      finally
      {
        View.Busy = false; //in any case (error or not) clear the Busy flag
      }

      if (SavedOptions != null) SavedOptions(this, null); //notify any listeners
    }

    //...

  }

} 
```

# documentation - 您如何使参考文档保持最新？

> ID：739119
> 
> 赞同：0
> 
> 时间：2009-04-10T23:02:13.507
> 
> 标签：documentation, maintenance

我正在做另一个 PHP 框架，因为它的乐趣和运动，我正在做第一轮文档。我打算编写一些代码，记录我编写的代码，再编写一些代码，调整文档以反映代码的新功能，然后重复。例如，目前配置非常手动且乏味，但我正在记录它，因为它需要像今天一样配置。一旦我将设置自动化，我计划重写这些部分，以反映当前状态。

我想知道的是，是否有任何启发式方法可以使参考文档保持最新？我不*只是*在谈论记录 API（PHPDoc 等免费提供的那种），还有更大的方案；教程，概述文章 - 一切。有什么好的方法可以最大程度地减少忘记更新特殊内容的机会吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T00:07:46.033

我们在我的第一份工作中做过类似的事情。

```
/*
<document>
    <version>x.y.z.g</version>
    <date>10.4.2009</version>
    <key>fff#ggg</key>
    <more...................../more>
</socument>
*/
int ggg(char x){
...
...
} 
```

记录器应用程序将测试日期差异（以及在更高版本中，针对我们的源代码控制），并在怀疑不匹配时发出警告标志。

在 PHP 中，构建一些东西来扫描代码注释应该不会太难，如果它们以预先知道的、方便的格式保存的话。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T23:13:25.680

由于非本地化，这是一个非常困难的问题：一个文档元素中的信息可能依赖或影响多个代码位置，当您查看代码位置时，您通常不知道文档。因此，代码的更改可能不会触发文档的更新，即使用户愿意这样做。

我认为在每个代码部分中包含某种形式的显式链接很重要，其中的更改会触发文档中的更改。让人们更新文本很费力，因此很难让他们找到可能受到影响的区域，尤其是对于更通用的材料（例如，API）

如果我要更新在多个位置提到的功能，我需要该列表至少知道在哪里寻找潜在的更新需求。

# language-agnostic - 对象之间的范围和通信

> ID：739128
> 
> 赞同：0
> 
> 时间：2009-04-10T23:09:41.977
> 
> 标签：language-agnostic, oop

我正在使用 Delphi（和 Delphi 术语），但我的问题是语言中立的。

假设您有一个类 TClient，它向另一个类 TFacade 发送消息。我假设 TClient 实例会有一个 TFacade 类型的私有引用变量。TClient 中某处的方法将创建 TFacade 的实例并将其分配给此私有变量。TClient 客户端类需要使用 TFacade 类。

同时，TFacade 与其他类（称它们为 WorkerClass1、WorkerClass2 和 WorkerClass3）一起工作。大概 TFacade 实例做同样的事情——它们有私有的 WorkerClass 变量，并创建 WorkerClasses 的实例（可能在 TFacade 构造函数中）。TFacade 类需要使用 WorkerClass 单元。

那么信息是如何从 WorkerClasses 传回 TClient 的呢？例如，如果 TClient 是一个表单，它可能会接收 TFacade 使用的用户输入，而 WorkerClasses 又会使用该用户输入。然而，在 WorkerClasses 操作或使用信息之后，它们需要将信息传回给 TClient（即，输出信息将显示在 TClient 表单中）。

我希望这很清楚。基本上我只是问Class1是否调用Class2中的方法，Class2调用Class3中的方法，Class3如何将信息发送回Class1？由于我是新手，不要害怕回答太简单或太具体。我能应付 ：-）

谢谢，一如既往 - Al C.

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T23:27:00.280

> 我希望这很清楚。基本上我只是问Class1是否调用Class2中的方法，Class2调用Class3中的方法，Class3如何将信息发送回Class1？

它没有，因为这太紧密地耦合了你设计中的claases。

相反，Class3 只与 Class2 通信。这样，Class1 不需要知道 Class3，*反之亦然*。这样，您可以交换 Class1 和 Class3，而无需更改 Class2 以外的任何内容。

还有其他更高级的习语，用于进一步减少耦合，但这足以让您开始。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T18:56:01.220

您有许多选项可供选择，需要权衡取舍。根据您想要实现的目标，某些选项可能不是“好”：

*   使用函数参数和返回值来移动数据位。
*   使用参考/输出参数来收集数据。
*   使用回调函数/委托。
*   使用事件（如果语言支持）。
*   使用一个收集所有有趣信息的常见实例。
*   让class1实现稳定的接口，class3可以使用。
*   使用中央存储，如公共内存、文件、数据库等。
*   检查设计模式。
*   检查平台中的成语。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T23:20:45.867

一种可能的方法是使用回调，请参阅[http://en.wikipedia.org/wiki/Callback_(computer_science)](http://en.wikipedia.org/wiki/Callback_(computer_science))。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T23:25:54.153

信息可以在函数参数中传递，也可以通过函数的返回值返回。

# php - 如何在我的 MySQL 表的列中找到最常见的结果

> ID：739143
> 
> 赞同：5
> 
> 时间：2009-04-10T23:21:42.570
> 
> 标签：php, mysql

使用 PHP 和 MySQL，我想查询我的用户发布的帖子表，以找到发布最多条目的人。

对此的正确查询是什么？

示例表结构：

```
[id] [用户 ID]
1 约翰尼特布莱克
2 约翰尼特布莱克
3 丹尼罗腾格
4 玛丽怀特
5 玛丽怀特
6 约翰尼特布莱克

```

我想看看“johnnietheblack”是最高的海报，“marywhite”是第二好的，“dannyrottenegg”是最少的

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-10T23:28:22.603

就像是：

```
SELECT COUNT(*) AS `Rows`, UserID
FROM `postings`
GROUP BY UserID
ORDER BY `Rows` DESC
LIMIT 1 
```

这将获取特定 ID 发布的行数，然后对计数进行排序以找到最高值，并输出它和该人的 ID。不过，您需要将“UserID”和“postings”替换为适当的列和字段。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T23:27:55.333

我相信这应该工作......

```
SELECT user_id, COUNT(*) FROM postings ORDER BY COUNT(*) GROUP BY user_id LIMIT 1 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T23:30:21.943

假设posting是一个元组（user_id，receiver_user_id），其中每一行代表一个posting，从user_id到recipient_user_id：

```
select user_id, count(*) as posts 
from postings
group by user_id
having count(*) = max(count(*)) ; 
```

# flash - 哪个actionscript/flash框架有最好的简单动画工具

> ID：739150
> 
> 赞同：1
> 
> 时间：2009-04-10T23:25:07.850
> 
> 标签：flash, actionscript

我正在将一些 Flex 转换为一个 Actionscript 项目，并且需要在一个轻量级框架上尽快加快速度，以执行基本动画。

这些组件可能有一些非常简单的数据访问——比如读取图像列表，但没有什么聪明的。

我真正想要的是相当于 Flex 的“AnimateProperty”或“Move”。是的很简单！

我只是不想太低级并开始`x+=`在`onEnterFrame()`事件处理程序中做。我只想用面向对象的脚本替换基于时间轴的动画。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T13:45:28.143

我喜欢`caurina`它易于使用但能够处理非常复杂的事情。可以在[这里](http://code.google.com/p/tweener/)找到。但最好的办法就是抓住一些并自己测试它们。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T23:50:07.807

**编辑：**改变了我对 gTween 的看法。请参阅下面/上面的其他帖子。

它仍处于测试阶段，但我喜欢[gTween的外观](http://www.gskinner.com/libraries/gtween/)

> GTween 是一个轻量级的面向实例的补间引擎。这意味着您为特定目的实例化补间，然后重用、更新或丢弃它们。这与集中式补间引擎不同，您可以使用全局对象“注册”补间。这为面向对象的程序员提供了一个更熟悉和有用的界面。

[该文档](http://www.gskinner.com/libraries/gtween/docs/com/gskinner/motion/GTween.html)实际上提供了比 gTween 主页面更好的概述。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T22:47:46.857

哎呀。看起来 gTween 已经停产[了，作者现在正在](http://blog.greensock.com/gskinnercollaboration/)与“ [TweenLite / TweenMax](http://blog.greensock.com/tweenliteas3/) ”的作者合作，它现在有一些很酷的基于伪时间线的动画能力。

我现在已经切换到那个了。

# javascript - 地图中的 Javascript 变量评估

> ID：739151
> 
> 赞同：14
> 
> 时间：2009-04-10T23:25:47.383
> 
> 标签：javascript, jquery

我试图通过 jQuery 传递一些数据，但`$.post()`我遇到了一些问题，我只能归类为数据映射中的变量评估。让我们开始吧：

```
var field = 'fooVar';
var value = 'barVar';
$.post('/path/to/url', { field:value, 'fooString':'barString' }); 
```

最终结果是具有以下值的 POST：

```
// Actual result
field = barVar
fooString = barString

// Expected result    
foo = barVar
fooString = barString 
```

我希望“字段”被评估为数据映射中的变量“foo”，但事实并非如此。我能够辨别的是“键”上的单引号是可选的，因此将它们排除在外不会导致变量被评估。

我还尝试了以下方法来获得幸运的笑声：

```
$.post('/path/to/url', { "'" + field + "'":value, 'fooString':'barString' });
$.post('/path/to/url', { eval(field):value, 'fooString':'barString' }); 
```

我难住了。感谢您提供的任何帮助，甚至只是一个坚定的“不”，这样我就可以继续我的生活，如果知道有人更精通我的支持，我将不胜感激。:)

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-10T23:42:21.290

```
var field = 'fooVar';
var value = 'barVar';
var postData = {};
postData[field] = value;
postData['fooString'] = 'barString';
$.post('/path/to/url', postData); 
```

即使确实存在一种构建此内联的方法（正如您在[此处](https://stackoverflow.com/questions/739151/javascript-variable-evaluation-in-a-map/739164#739164)所希望的那样），您最好通过预先构建对象来完成您所追求的 - 请参阅[这篇 Encosia 文章](http://encosia.com/2009/04/07/using-complex-types-to-make-calling-services-less-complex/)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-10T23:40:12.230

正确，Javascript“地图”（对象）不评估其键。如果您需要评估密钥，您可以这样做：

```
var key = 'name';
var value = 'john';
var options = {key: value}; // translates to "key=john"

options[key] = value; // translates to "name=john"

$.post('path', options); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-10T23:35:37.017

这是一个可能的答案。

```
var field = 'fooVar';
var value = 'barVar'

var data = { fooString:'barString' }
data[field] = value;

$.post('/path/to/url', data);

// Result
fooVar = barVar
fooString = barString 
```

不过，我仍然很好奇这是否可以内联完成（如在原始示例中）而不是事先构建地图。

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-11T00:13:29.717

如果您打算在单个表达式中执行此操作，则可以编写如下辅助函数（未经测试）：

```
function objectFromPairs() {
    var o = {};
    for (var i = 0; i < arguments.length; i += 2) {
        o[arguments[i]] = arguments[i+1];
    }
    return o;
}

$.post('/path/to/url', objectFromPairs(field, value, 'fooString', 'barString')); 
```

但就使用对象文字而言，不，没有办法将表达式的值用作键。属性必须以数字文字、字符串文字或有效标识符的形式给出（请参阅[ECMAscript 规范](http://www.ecma-international.org/publications/files/ECMA-ST/Ecma-262.pdf)的第 41-42 页）。

# performance - 对 Lucene 搜索结果进行分组并按类别计算频率

> ID：739165
> 
> 赞同：3
> 
> 时间：2009-04-10T23:37:53.670
> 
> 标签：performance, lucene, lucene.net

我正在使用 Lucene 开发商店搜索 API。

我需要在括号中显示每个城市、州组合的商店搜索结果及其频率......例如：

```
Los Angles,CA (450)
Atlanta,GA (212)
Boston, MA (78)
.
.
. 
```

到目前为止，如果用户说“显示所有商店”，我的搜索结果平均会返回大约 7000 个 Lucene 文档。在这个用例中，我最终显示了大约 800 个独特的 City,State 记录，如上所示。

我正在重写`HitCollector`类的`Collect`方法并检索向量，如下所示：

```
var vectors = _reader.GetTermFreqVectors(doc); 
```

然后我遍历这个集合并计算每个唯一城市、州组合的频率。

但这在性能上变得非常非常缓慢......有没有更好的方法来分组搜索结果和计算 Lucene 中的频率？一个代码片段会很有帮助

另外，请建议我是否可以使用任何其他技术/技巧来优化我的 Lucene 搜索代码....

谢谢阅读！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T04:46:54.363

我不相信您目前可以在 Lucene 中执行此 OOTB - 搜索此功能会产生此未解决的问题：

[Jira Lucene 功能请求](https://issues.apache.org/jira/browse/LUCENE-1421)

然而，该功能存在于 Solr 的 OOTB 中 - 它提供了一个刻面功能。如下查询：

[http://localhost:8983/solr/select?q=ipod&rows=0&facet=true&facet.limit=-1&facet.field=cat&facet.field=inStock](http://localhost:8983/solr/select?q=ipod&rows=0&facet=true&facet.limit=-1&facet.field=cat&facet.field=inStock)

将返回以下结果：

```
<response>
<responseHeader><status>0</status><QTime>2</QTime></responseHeader>
<result numFound="4" start="0"/>
<lst name="facet_counts">
 <lst name="facet_queries"/>
 <lst name="facet_fields">
  <lst name="cat">
        <int name="search">0</int>
        <int name="memory">0</int>
        <int name="graphics">0</int>
        <int name="card">0</int>
        <int name="music">1</int>
        <int name="software">0</int>
        <int name="electronics">3</int>
        <int name="copier">0</int>
        <int name="multifunction">0</int>
        <int name="camera">0</int>
        <int name="connector">2</int>
        <int name="hard">0</int>
        <int name="scanner">0</int>
        <int name="monitor">0</int>
        <int name="drive">0</int>
        <int name="printer">0</int>
  </lst>
  <lst name="inStock">
        <int name="false">3</int>
        <int name="true">1</int>
  </lst>
 </lst>
</lst>
</response> 
```

有关刻面的更多信息，请访问 Solr 网站：

[http://wiki.apache.org/solr/SimpleFacetParameters](http://wiki.apache.org/solr/SimpleFacetParameters)

**编辑：**如果您绝对不想采用 SOLR 方法进行刻面，您可以利用针对 Lucene 描述的此补丁中的功能：

[http://sujitpal.blogspot.com/2007/01/faceted-searching-with-lucene.html](http://sujitpal.blogspot.com/2007/01/faceted-searching-with-lucene.html)

它通过补丁在 Lucene 2.0 之上提供了 faceting 功能的实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T10:11:06.900

史蒂夫，我相信你想要[多面搜索](http://en.wikipedia.org/wiki/Faceted_browser)。它不是开箱即用的 Lucene。我建议您尝试使用[SOLR](http://lucene.apache.org/solr/)，它具有[刻面](http://www.lucidimagination.com/Community/Hear-from-the-Experts/Articles/Faceted-Search-Solr)作为主要且方便的功能。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T14:52:55.140

我不确定我理解您所说的“分组”是什么意思，但如果您只想计算每个类别的文档数量，您应该看看[这个问题](https://stackoverflow.com/questions/152127/using-lucene-to-count-results-in-categories)。

我的答案仍然存在，似乎没有人喜欢它足以支持我......

# java - 如何使用 JSTL 标签检查资源包键是否不存在？

> ID：739170
> 
> 赞同：10
> 
> 时间：2009-04-10T23:41:31.853
> 
> 标签：java, jsp, internationalization, jstl, resourcebundle

我有一个包含一些可选键的资源文件。如果可选资源键不存在，我设置一个默认值。似乎没有简单的方法来确定资源包中是否存在密钥。所以这就是我正在做的解决它。

```
<fmt:message var="title" key="login.reg.signup.${signupForm.regfrom}.title" />
<c:if test='${fn:startsWith(title, "??")}'>
    <fmt:message var="title" key="login.reg.signup.default.title" /> 
</c:if> 
```

有没有更好的办法？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-16T23:41:59.520

您可以编写自己的 JSP 标记来执行此操作，因此您可以这样做：

```
<my:message var="title" key="${form}.title" default="default.title"/> 
```

标记实现可以是您当前的 JSP 语法，也可以是 Java 类。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-06-01T18:13:29.193

您可以使用`#{messagesFactory.messages.containsKey('key')}`来检查。

# nested - 这个 IF 语句是否嵌套？

> ID：739182
> 
> 赞同：1
> 
> 时间：2009-04-10T23:47:18.733
> 
> 标签：nested, pseudocode

输入 X：

```
if (0 <= X and X < 49)
    output "abc"
else if (50 <= X and X < 70)
    output "def"
else if (70 <= X and X < 85)
    output "ghi"
else if (85 <= X and X < 100)
    output "jkl"
endif 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-10T23:56:54.187

你可以认为它在逻辑上等同于以下内容：

```
if(a) {
    // code
} else {
    if(b) {
        // code
    } else {
        // code
    }
} 
```

所以在这方面，你可以称之为嵌套。在 C 和类似语言中，这正是它的工作方式，因为没有可用的“elseif”语句。花括号是可选的，但我只是将它们包括在内以使其更清晰。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-11T00:11:55.523

它们是嵌套的，但格式与它们不是一样。

您的代码与以下内容相同：

```
if (0 <= X and X < 49)
    output "abc"
else
    if (50 <= X and X < 70)
        output "def"
    else
        if (70 <= X and X < 85)
            output "ghi"
        else
            if (85 <= X and X < 100)
                output "jkl"
            endif
        endif
    endif
endif 
```

这不是嵌套的：

```
if (0 <= X and X < 49)
    output "abc"
endif
if (50 <= X and X < 70)
    output "def"
endif
if (70 <= X and X < 85)
    output "ghi"
endif
if (85 <= X and X < 100)
    output "jkl"
endif 
```

这在所有具有 if 语句的 (?) 语言中都有效（忽略使用 {} 而不是 endif 之类的东西）

然而，一些语言有一个实际的“elseif”（或“elif”）命令，在这种情况下你**不会**嵌套，但写成“else if”你可以假设它只是一个不同格式的嵌套。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-11T00:17:15.823

这取决于实际的语言以及它的编写方式。

例如使用 VB，这些`If`语句不是嵌套的：

```
If 0 <= x And x < 49 Then
    output("abc")
ElseIf 50 <= x And x < 70 Then
    output("def")
ElseIf 70 <= x And x < 85 Then
    output("ghi")
ElseIf 85 <= x And x < 100 Then
    output("jkl")
End If 
```

虽然这些`If`语句是嵌套的：

```
If 0 <= x And x < 49 Then
    output("abc")
Else
    If 50 <= x And x < 70 Then
        output("def")
    Else
        If 70 <= x And x < 85 Then
            output("ghi")
        Else
            If 85 <= x And x < 100 Then
                output("jkl")
            End If
        End If
    End If
End If 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-11T00:20:38.950

我会说是的，它们是嵌套的。您的代码完全等同于

```
if (0 <= X and X < 49)
    output "abc"
else
    if (50 <= X and X < 70)
        output "def"
    else
        if (70 <= X and X < 85)
            output "ghi"
        else
            if (85 <= X and X < 100)
                output "jkl"
endif 
```

请注意，我只更改了空格。当一种语言评估`if...else if...else`子句时，它会测试每一个子句，直到找到真正的子句（或者它达到 final `else`）。嵌套`if`的 s 以完全相同的方式进行评估。`elsif`另请注意，如果存在显式关键字，则不一定是这种情况。

我注意到的另一件事是，以下内容**不等同**于您的代码：

```
if (0 <= X and X < 49)
    output "abc"

if (50 <= X and X < 70)
    output "def"

if (70 <= X and X < 85)
    output "ghi"

if (85 <= X and X < 100)
    output "jkl" 
```

当所有条件都为真时，嵌套对于防止输出所有文本是*必要的。*

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-11T00:45:49.717

鉴于显示的语法，我认为答案应该是“否”，这与其他答案的累积智慧相反。

你展示：

```
if (0 <= X and X < 49)
    output "abc"
else if (50 <= X and X < 70)
    output "def"
else if (70 <= X and X < 85)
    output "ghi"
else if (85 <= X and X < 100)
    output "jkl"
endif 
```

这显然是一个`if`...`endif`语句，因此没有嵌套。如果有多个`endif`语句，它将被嵌套：

```
if (0 <= X and X < 49)
    output "abc"
else
    if (50 <= X and X < 70)
        output "def"
    else
        if (70 <= X and X < 85)
            output "ghi"
        else
            if (85 <= X and X < 100)
                output "jkl"
            endif
        endif
    endif
endif 
```

因此，在您的语言中，关键字`elif`（由 Bourne shell 使用）和`elsif`（由 Perl 使用）和`ElseIf`（由 Visual Basic 使用）似乎拼写为`else if`.

如果没有明确`endif`标记语句的结尾，那么我会同意其他答案 -`if`语句（复数！）是嵌套的，尽管布局是完全明智和推荐的。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-11T01:50:17.487

这是一种毫无意义的语义游戏；这取决于所涉及语言的语法。

例如，在类似 C 的语法中，它们通常被认为嵌套在 else 子句中，省略大括号以掩盖这一事实。在这种情况下，特纳的例子是正确的。

在其他一些语言中，如 Python 和 VB，'else-if' 是它自己的原子构造。在那种情况下，'if'不能被认为是在'else'内部，所以它不能被称为“嵌套”。

```
if (0 <= X and X < 49)
    output "abc"
else if (50 <= X and X < 70)
    output "def"
endif 
```

你还没有充分定义你的伪代码的语法来肯定地说，但尾随的“endif”是可疑的。它的存在不符合省略 C 大括号的样式；而且只有其中一个而不是更多的事实——</p>

```
else
    if (50 <= X and X < 70)
        output "def"
    endif
endif 
```

— 表示它也不匹配带大括号（或开始/结束）模型。因此，根据该语法判断，我会将您的伪代码语言放在“原子 else-if”阵营中，并且相当武断地说：*不，您的 if 语句没有嵌套。*

（但您总是可以定义一种语言，其中 endifs 是可选的或依赖于空格。或者，您可能已经定义了一种语言，上面的程序打印“Hello world”然后删除所有文件。并且有一个内置的邮件阅读器。 )

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-11T00:11:41.610

它可能被实现为嵌套循环，具体取决于语言。但是，按照您逻辑上写出来的方式，它不会被视为一个。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-11T00:54:14.347

不它不是。

嵌套语句是出现在同一语句中的语句，例如 If ... If。If ... ElseIf 都在同一个“语句”中。

* * *

## 回答 #9

> 赞同：-1
> 
> 时间：2009-04-10T23:51:50.673

编辑时：没关系，我同意我在这个问题上是错误的。

不是，因为 no`if`在另一个经过测试的内部`if`进行了测试`true`。

特别是，您的示例：

```
if (0 <= X and X < 49) output "abc"

else if (50 <= X and X < 70) output "def"

else if (70 <= X and X < 85) output "ghi"

else if (85 <= X and X < 100) output "jkl"

endif 
```

可以改写为：

```
if (0 <= X and X < 49) output "abc"; return; end if

if (50 <= X and X < 70) output "def"; return; end if

if (70 <= X and X < 85) output "ghi"; return; end if

if (85 <= X and X < 100) output "jkl"; return; end if

// X < 0 or X >= 100 
```

评论：

> if 语句不必嵌套在另一个 if 中。它可以嵌套在 else -Bill the Lizard 中

取点；我同意我在这一点上错了。

# javascript - 存储隐藏的 ID，然后使用 ajax 提交它们，最佳实践？

> ID：739185
> 
> 赞同：0
> 
> 时间：2009-04-10T23:51:20.083
> 
> 标签：javascript, jquery, ajax

当用户从我只想访问 id 的任何特定消息发出 ajax 请求时，我有一个消息列表，其元素 id 为“message”+id（message1、message2 等）。我应该在提交之前从 jquery 中的消息 id 中删除 id 还是在服务器端执行？或者有没有更简单的方法来表示每条消息的网页上的 id？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T23:57:20.503

您可以将消息 ID 作为属性附加到 DOM 元素本身。在 mootools 中是

```
Elm.set('messageId',12);//12 is an arbitrary message id I chose for this example.
//get it
alert(Elm.get('messageId')); 
```

我 100% 确定在 JQuery 中有非常相似的东西。但是，使用 JS 从具有已知格式的字符串中剥离 id 本身并不难。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T23:57:46.213

用户必须点击某些东西，对吧？如果是链接，我会将 id 放在 onclick 函数调用中的某处；如果它是一个按钮，同样处理隐藏的表单输入。您使用 jQuery 完成这一切会使这一切变得更容易，但并不特别重要。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T00:06:06.833

根据页面其余部分的工作方式，您可以将每个元素包装在表单标签中，并为 id 使用隐藏字段。潜在地，与 jquery 表单插件 ( [http://www.malsup.com/jquery/form/](http://www.malsup.com/jquery/form/) ) 结合使用可以为您节省一些整体开发工作量。

只要您不担心在其中放置不合规的属性，向 dom 添加属性当然也可以。

无论如何，我绝对建议在您的 ajax 请求中向服务器发送一个 id 值，而不是从服务器上的字符串中删除该值。从关注点分离的角度来看，这更清晰、更好。

# python - 新 Django 项目中的“ImportError：没有名为 dummy 的模块”

> ID：739191
> 
> 赞同：1
> 
> 时间：2009-04-10T23:53:37.783
> 
> 标签：python, database, django, sqlite

我在 MacOS X 10.5.6 上通过 MacPorts 安装了以下内容：

```
py25-sqlite3 @2.5.4_0 (active)
python25 @2.5.4_1+darwin_9+macosx (active)
sqlite3 @3.6.12_0 (active) 
```

`python25`正确设置为我系统的默认 Python。

我下载了 Django 1.1 beta 的新副本（不过，我对 1.0 和 trunk 也有同样的问题）并用“ `sudo python setup.py install`”安装它。

事情似乎通过交互式解释器正确加载：

```
$ python
Python 2.5.4 (r254:67916, Apr 10 2009, 16:02:52) 
[GCC 4.0.1 (Apple Inc. build 5490)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
>>> import django
>>> import sqlite3
>>> ^D 
```

但：

```
$ django-admin.py startproject foo
$ cd foo/
$ python manage.py runserver
Validating models...
Unhandled exception in thread started by <function inner_run at 0x6c1e70>
Traceback (most recent call last):
  File "/opt/local/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/django/core/management/commands/runserver.py", line 48, in inner_run
    self.validate(display_num_errors=True)
  File "/opt/local/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/django/core/management/base.py", line 246, in validate
    num_errors = get_validation_errors(s, app)
  File "/opt/local/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/django/core/management/validation.py", line 22, in get_validation_errors
    from django.db import models, connection
  File "/opt/local/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/django/db/__init__.py", line 22, in <module>
    backend = __import__('%s.base' % settings.DATABASE_ENGINE, {}, {}, [''])
ImportError: No module named dummy.base 
```

如果我更改`DATABASE_ENGINE`为`settings.py`“ `sqlite3`”，我会得到以下看似相关的问题：

```
$ python manage.py runserver

Validating models...
Unhandled exception in thread started by <function inner_run at 0x6c1e70>
Traceback (most recent call last):
  File "/opt/local/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/django/core/management/commands/runserver.py", line 48, in inner_run
    self.validate(display_num_errors=True)
  File "/opt/local/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/django/core/management/base.py", line 246, in validate
    num_errors = get_validation_errors(s, app)
  File "/opt/local/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/django/core/management/validation.py", line 22, in get_validation_errors
    from django.db import models, connection
  File "/opt/local/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packages/django/db/__init__.py", line 22, in <module>
    backend = __import__('%s.base' % settings.DATABASE_ENGINE, {}, {}, [''])
ImportError: No module named base
^C$ 
```

我发誓这一切几天前都奏效了，我不记得在安装方面更改了与 Django 或 Python 相关的任何内容。

我的各种 Google 冒险都没有任何用处。所以...有什么想法吗？

编辑： ' `syncdb`' 引发相同的异常。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-15T01:39:36.917

我在 Django 用户组上找到了这个[线程：](http://groups.google.com/group/django-users/browse_thread/thread/ea60854ad2e00b98)

他们认为这与 MacPorts 安装 Python 的方式有关。我希望我有更多详细信息可以帮助您，但作为一种解决方法，我建议您使用 MacPorts 卸载此 Python 副本并尝试使用其他安装方法。如果您正在寻找快速简便的安装方式，您可能想尝试[MacPython](http://wiki.python.org/moin/MacPython/Leopard)。希望这可以帮助！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T00:46:36.500

你试过介绍文档吗？[文档链接](http://docs.djangoproject.com/en/dev/intro/tutorial01)

如果您遵循此文档，您至少可以说“在第 XXXX 步出现错误 YYY”。然后有一些经验的人（不是我）应该能够找到一个好的答案。此链接用于主干，顶部有 1.0 文档的链接。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T00:50:52.717

呃，我没在想。赶紧跑

```
python manage.py syncdb 
```

这将为您构建数据库，以便您可以运行服务器。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-11T12:31:40.427

重新检查您的 settings.py。在第二种情况下，看起来您的 DATABASE_ENGINE 设置为空字符串，而不是“sqlite3”。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-15T13:12:08.767

确切地说，这不是一个答案，但我会尝试删除 Django 的 MacPorts 安装并重新开始。然后尝试添加[easy_install](http://peak.telecommunity.com/DevCenter/EasyInstall)并使用它来安装所有内容。为了让事情更干净、更容易重新开始，您可能还想添加[virtualenv](http://pypi.python.org/pypi/virtualenv)，它可以让您设置多个独立的 Python 环境。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-16T16:01:10.737

如果您还没有 py25-hashlib 包，您也可以尝试安装它。[我在django bug tracking site](http://code.djangoproject.com/ticket/8489)上找到了这个描述。

通常，这个包是python的一部分，但根据我的阅读，它在macports版本中要么丢失要么错误。

[我在这里](http://py25-hashlib.darwinports.com/)找到了有关 py25-hashlib 的 macports 版本的更多信息。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-16T20:04:13.773

尝试使用 python 的完整路径以及检查模块路径

# java - Java方法：在给定已知属性值的数组列表中查找对象

> ID：739192
> 
> 赞同：21
> 
> 时间：2009-04-10T23:54:45.533
> 
> 标签：java, arraylist

我实际上有几个问题。

我有一个带有以下实例字段的**Dog类：**

```
private int id;
private int id_mother;
private int id_father;
private String name="";
private String owner="";
private String bDate=""; 
```

我还有一个类**Archive**，它可以实例化**Dog**并将 Dog 对象放入 ArrayList。

我正在尝试在**Archive**中编写一个方法，该方法将整数作为 ID 并查看 ArrayList，并返回包含该 ID 的对象。

```
private Dog getDog(int id){
    Dog dog = new Dog();
    int length=getSize();
    int i=0;

    dog=al.get(i);
    i++;

    while(dog.getId()!=id && i<length)
        dog=al.get(i);
        i++;

    if(dog.getId()!=id)
        dog=null;
    return dog;
}//end getDog 
```

这种方法有两个问题（我使用的其他方法有效）。首先它不起作用，我不明白为什么。我正在循环遍历（可能）arraylist中的所有对象，然后在循环完成后，检查循环是否完成，因为它用完了要搜索的对象，或者因为它找到了具有给定ID的对象. 其次，这似乎是一个非常耗时的过程。有什么方法可以加快速度吗？

* * *

## 回答 #1

> 赞同：44
> 
> 时间：2009-04-11T01:34:43.063

假设您已经为 Dog 正确编写了一个 equals 方法，该方法根据 Dog 的 id 进行比较，最简单的方法是返回列表中的项目，如下所示。

```
if (dogList.contains(dog)) {
   return dogList.get(dogList.indexOf(dog));
} 
```

与此处的其他方法相比，这对性能的要求较低。在这种情况下，您根本不需要循环。希望这可以帮助。

PS 你可以使用 Apache Commons Lang 为 Dog 编写一个简单的 equals 方法，如下所示：

```
@Override
public boolean equals(Object obj) {     
   EqualsBuilder builder = new EqualsBuilder().append(this.getId(), obj.getId());               
   return builder.isEquals();
} 
```

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-04-10T23:57:44.793

A`while`适用于 . 之后的表达式或块`while`。

你没有块，所以你的 while 以表达式结束`dog=al.get(i);`

```
while(dog.getId()!=id && i<length)
                dog=al.get(i); 
```

之后的一切都只发生一次。

没有理由养狗，因为你从来没有使用过你养的狗；您立即将数组中的 Dog 分配给您的狗引用。

如果你需要获取一个键的值，你应该使用 Map，而不是 Array。

编辑：这是 donwmodded 为什么？

来自OP的评论：

> 关于不必创建 Dog 的新实例的另一个问题。如果我只是从数组列表中取出对象的副本，那么如何在没有放入对象的情况下从数组列表中取出它？我也注意到我没有将while循环括起来。

Java 引用和它所引用的对象是不同的东西。它们非常像 C++ 引用和对象，尽管 Java 引用可以像 C++ 指针一样重新指向。

结果是，`Dog dog;`或者`Dog dog = null`给你一个不指向任何对象的引用。`new Dog()` *创建*一个可以指向的对象。

紧随其后的`dog = al.get(i)`是引用现在指向由返回的狗引用`al.get(i)`。理解，在 Java 中，永远不会返回对象，只会返回对对象的引用（这是对象在内存中的地址）。

您更新的 Dog 的指针/引用/地址现在丢失了，因为没有代码引用它，因为引用被替换为您从中获得的引用`al.get()`。最终，Java 垃圾收集器将销毁该对象；在 C++ 中，你会“泄露”内存。

结果是您确实需要创建一个可以引用 Dog 的变量；你不需要用`new`.

（实际上，您不需要创建引用，因为您真正应该做的是返回 Map 从其 get() 函数返回的内容。如果 Map 未在 Dog 上参数化，例如：`Map<Dog>`，那么您' 将需要从 get 转换返回值，但您不需要引用：`return (Dog) map.get(id);`或者如果 Map 是参数化的，则`return map.get(id)`. 一行就是您的整个函数，在大多数情况下它会比迭代数组更快。 )

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-04-11T00:21:37.357

为了提高操作的性能，如果您总是想通过某个唯一标识符查找对象，那么您可以考虑使用[`Map<Integer,Dog>`](http://java.sun.com/javase/6/docs/api/java/util/Map.html). 这将通过键提供恒定时间查找。您仍然可以使用 map 遍历对象本身`values()`。

快速入门的代码片段：

```
// Populate the map
Map<Integer,Dog> dogs = new HashMap<Integer,Dog>();
for( Dog dog : /* dog source */ ) {
    dogs.put( dog.getId(), dog );
}

// Perform a lookup
Dog dog = dogs.get( id ); 
```

如果您在列表中执行多个相同性质的查找，这将有助于加快速度。如果您只是进行一次查找，那么无论如何您都会产生相同的循环开销。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2009-04-11T00:00:10.747

你必须遍历整个数组，没有改变。但是，您可以轻松一点

```
for (Dog dog : list) {
  if (dog.getId() == id) {
    return dog; //gotcha!
  }
}
return null; // dog not found. 
```

或没有新的 for 循环

```
for (int i = 0; i < list.size(); i++) {
  if (list.get(i).getId() == id) {
    return list.get(i);
  }
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-11T00:51:54.383

我很感兴趣地看到原始海报使用了一种避免提前退出的风格。单次入境；Single Exit (SESE) 是一种有趣的风格，我还没有真正探索过。已经很晚了，我有一瓶苹果酒，所以我写了一个没有提前退出的解决方案（未经测试）。

我应该使用迭代器。不幸的是`java.util.Iterator`，get 方法有副作用。`Iterator`（由于其异常后果，我不喜欢该设计。）

```
private Dog findDog(int id) {
    int i = 0;
    for (; i!=dogs.length() && dogs.get(i).getID()!=id; ++i) {
        ;
    }

    return i!=dogs.length() ? dogs.get(i) : null;
} 
```

注意表达式的重复`i!=dogs.length()`（可以选择`dogs.get(i).getID()!=id`）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-05-05T22:27:40.333

如果您必须获取不是 ID 的属性。我会使用[CollectionUtils](http://commons.apache.org/proper/commons-collections/apidocs/org/apache/commons/collections/CollectionUtils.html)。

```
Dog someDog = new Dog();
Dog dog = CollectionUtils(dogList, new Predicate() {

@Override
public boolean evaluate(Object o)
{
    Dog d = (Dog)o;
    return someDog.getName().equals(d.getName());
}
}); 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2017-08-23T14:10:28.207

我使用 java 8 lambdas 解决了这个问题

```
int dogId = 2;

return dogList.stream().filter(dog-> dogId == dog.getId()).collect(Collectors.toList()).get(0); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-06-10T10:48:45.070

```
List<YourClass> list = ArrayList<YourClass>();

List<String> userNames = list.stream().map(m -> m.getUserName()).collect(Collectors.toList()); 
```

输出：[“约翰”，“亚历克斯”]

# perl - 如何输出用引号括起来的每个 Perl 数组元素？

> ID：739214
> 
> 赞同：7
> 
> 时间：2009-04-11T00:09:04.907
> 
> 标签：perl, arrays, string

我想在 Perl 中以特定格式输出数组的元素。

```
@myArray = ("A", "B", "C");
$text = something; 
```

应该是字符串' `"A" "B" "C"`'（用双引号括起来的每个元素）。

但是，如果`@myArray`是空的，那么`$text`应该也是。我想过使用`join()`，例如

```
$text = "\"" . join("\" \"", @myArray) . "\"";
if ($text eq "\"\"")
{
    $text = "";
} 
```

我认为这会奏效。但是，有没有更优雅的方法来做到这一点？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-11T00:19:13.183

使用[`map`](http://perldoc.perl.org/functions/map.html)：

```
#!/usr/bin/perl

use strict;
use warnings;

my @a    = qw/ A B C /;
my @b;
my $text = join ' ', map { qq/"$_"/ } @a;
print "text for (@a) is [$text]\n";

$text = join ' ', map { qq/"$_"/ } @b;
print "text for (@b) is [$text]\n"; 
```

此外，为了使代码更清晰，您可以使用[`qq//`](http://perldoc.perl.org/perlop.html#Quote-and-Quote-like-Operators)运算符（行为与 完全相同`""`，但您可以选择分隔符）以避免转义`"`s。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-11T04:08:53.707

查斯。有正确的答案，但有时我使用`$"`变量，它保存要放在数组元素之间进行插值的字符串：

```
my $text = do { local $" = q<" ">; qq<"@array"> }; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T07:29:49.060

我不确定是否使用“加入”。你想要一个带有引号元素的标量字符串还是只想要一个带有引号元素的数组？如果是后者，那么我怀疑以下会做到这一点

```
my @a = qw|a b c|;
@a = map {qq|"$_"|} @a; 
```

当然，这回避了元素是否最初被引用的测试。例如，如果您希望引用数组元素以使用 DBI 插入数据库，那么更合适的方法可能是：

```
@a = map{$dbh->quote($_)} @a; 
```

我希望这有帮助

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-11T00:55:05.607

它可能不完全符合您的要求，但我是 Data::Dumper 的忠实粉丝。

# google-app-engine - GQL 是否支持常用的 SQL 样式聚合？

> ID：739220
> 
> 赞同：7
> 
> 时间：2009-04-11T00:11:58.410
> 
> 标签：google-app-engine, aggregate-functions, gql, gqlquery

我正在寻找一个在 SQL 版本中广泛使用的简单聚合函数。

简单的事情喜欢`Select Count(*) from table1`更复杂的。

如果这些可用，是否有一些文件可以指点我？

谢谢 - 吉吉

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-12T14:25:24.480

SQL 聚合函数不可用。您想要做的是遵循分片计数器示例之类的模式：[http](http://code.google.com/appengine/articles/sharding_counters.html) ://code.google.com/appengine/articles/sharding_counters.html它解释说，您希望保持计数器最多，而不是聚合查询中的值插入、更新或删除值的日期。

该示例比仅仅维护聚合更进一步，因为它将解释如何制作它，以便您可以在高负载下更新计数器，而您只有有限的机会写入计数器 - 所以分片有帮助您将负载分布在多个实例上。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T00:42:35.357

不，它根本不支持它们。

# javascript - 用于执行多项任务的书签

> ID：739225
> 
> 赞同：2
> 
> 时间：2009-04-11T00:14:20.043
> 
> 标签：javascript, jquery, bookmarklet

我整天都在修补这个应用程序并且遇到了一些困难。所以基本上小书签需要允许用户使用来自多个 JavaScript 文件的大量函数，尽管用户将使用的所有函数都是从一个文件中调用的。基本上，它包括执行特定功能所需的所有文件。它使用 jQuery，我发现让 jQuery 在你的书签上运行真的很困难。

我的问题是：如何将多个 javascript 代码文件加载到您的 Bookmarklet 中？

*你真的，
**埃米尔·哈杰里克。***

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T06:19:51.333

如果您必须使用书签运行多个 JavaScript 文件，我建议在书签中创建一个函数来导入文件。

该函数可以写为

```
var importJs=function(jsUrl){
  var s=document.createElement("script");
  s.setAttribute("src",jsUrl);
  document.body.appendChild(s);
}; 
```

为了在书签中实际使用，只需声明该函数，然后为您必须导入的每个文件调用一次。

```
javascript:(function(){
  var importJs=function(jsUrl){
    var s=document.createElement("script");
    s.setAttribute("src",jsUrl);
    document.body.appendChild(s);
  };
  importJs("http://jqueryjs.googlecode.com/files/jquery-1.3.2.min.js");
  importJs("http://your.domain.com/codeThatUsesJQuery.js");
})(); 
```

（注意：要将其实际用作书签，必须将所有行合并为一行。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T01:11:53.210

如果您的书签类似于

```
 javascript:void((function(){var e=document.createElement('script');
    e.setAttribute('type','text/javascript');
    e.setAttribute('charset','UTF-8');
    e.setAttribute('src','http://yoursite/bookmarklet.js');
    document.body.appendChild(e)})()); 
```

您可以根据需要添加任意数量的脚本元素，尝试在其中添加 jquery。

# actionscript - 如何访问 Flex Builder Actionscript 项目中的“mx”或“fl”命名空间？

> ID：739226
> 
> 赞同：1
> 
> 时间：2009-04-11T00:14:30.713
> 
> 标签：actionscript, namespaces, flexbuilder, swc

如何访问 Flex Builder Actionscript 项目中的`mx`或 命名空间？`fl`

我需要包含某个 .swc 文件吗？

我似乎找不到哪一个。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T07:09:32.977

```
import mx.effects.easing.*; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T00:46:48.670

您可以只导入 mx，但请注意您的项目将承受 Flex 框架的大量重量。所有 l 包类都在您的 Flash 安装文件夹中，需要作为源文件夹添加到 FB 中的编译器路径中。

如果您只想使用缓动功能，则该解决方案比导入任何 MX 包更容易。当我在 AS3 项目中使用 GTween 时，我只是简单地将函数剪切并粘贴到我自己的静态类中。

# php - 在 php/mysql 中实现基于时间的排序的最佳方法是什么？

> ID：739227
> 
> 赞同：1
> 
> 时间：2009-04-11T00:16:05.450
> 
> 标签：php, mysql

我有 1 张桌子，里面装满了文章。为了这篇文章的目的，假设它有 4 个字段。story_id、story_title、story_numyes、story_numno

每篇文章都可以投票赞成或反对。我将每个评分存储在另一个表中，其中包含 3 个字段：vote_storyid、vote_date（作为时间戳）、vote_code（1 = 是，0 = 否）。

因此，当有人对一篇文章投赞成票时，它会运行一个更新查询 story_numyes+1 以及一个插入查询来记录第二个表中的故事 ID、日期和 vote_code。

我想根据文章的“是”或“否”票数对文章进行排序。对于“有史以来最好的”评级显然很简单.... ORDER BY story_numyes DESC。

但是，我将如何在今天、本周、本月撰写最佳/最差文章？

我通过以下方式获取时间戳以标记每个时期的截止日期：

```
$yesterday= strtotime("yesterday");
$last_week = strtotime("last week");
$last_month = strtotime("last month"); 
```

但我不确定如何在 mysql 查询中利用这些时间戳来达到预期的结果。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T00:22:27.963

尝试类似的东西

> SELECT id,
> SUM(CASE WHEN votedate >= $yesterday THEN 1 ELSE 0 END) AS daycount,
> SUM(CASE WHEN votedate >= $last_week THEN 1 ELSE 0 END) AS weekcount,
> SUM(1) AS monthcount
> FROM votes
> WHERE yes_no = 'YES'
> AND votedate >= $last_month
> GROUP BY id

然后将其设为子查询，您可以获得计数的最大值。

（请允许未经测试的查询中固有的通常语法草率。）

* * *

回应评论：

将其用作有效的子查询（即不相关）以获得最大值：

> SELECT
> MAX(daycount) AS MaxDayCount,
> MAX(weekcount) AS MaxWeekCount,
> MAX(monthcount) AS MaxMonthCount
> FROM
> (
> .... all that stuff ...
> ) AS qcounts

但当然你不能将它们归因于 id，因为它们是不同的。如果您希望他们一次使用 id，您可以

> SELECT id, monthcount
> FROM
> (
> .... all that stuff ...
> ) AS qcounts
> ORDER BY monthcount DESC
> LIMIT 1

做三遍，一天/一周/一个月一次。

注意：这一切都是为了说明您可以在一个合理有效的查询中完成的一些事情。如果您发现按照其他人的建议将其分解是最简单的（并且简单 == 好），我不会感到惊讶。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-11T00:22:50.023

一般来说：

```
select story_id, sum(vote_code)
from story_vote
group by story_id; 
```

对于特定的投票日期范围：

```
select story_id, sum(vote_code)
from story_vote
where vote_date >= 'least date, inclusive' 
and vote_date < 'last date, exclusive'
group by story_id; 
```

OP评论：

> 我将如何使用 ORDER BY 子句？

你会添加一个`order by sum(vote_code)`. 如果您想要首先获得最多票数的故事，则降序：

```
order by sum(vote_code) desc; 
```

编辑时：我注意到他想要所有故事，而不是一个，所以我删除了having子句。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T00:27:39.307

```
SELECT a.*, SUM(vote_code) AS votes
FROM articles a JOIN votes v ON (a.story_id = v.vote_storyid)
WHERE v.vote_date >= $yesterday
GROUP BY a.story_id
ORDER BY 2 DESC; 
```

对于`$last_week`和 也是如此`$last_month`。

如果您希望对结果进行排序，最好在单独的查询中执行此操作，而不是尝试在单个查询中执行此操作。因为这三个时期中的每一个时期的排序顺序都可能非常不同。

# c - 预处理器蓝调有什么治疗方法吗？

> ID：739230
> 
> 赞同：10
> 
> 时间：2009-04-11T00:17:33.857
> 
> 标签：c, vim, c-preprocessor

`-E`我知道我可以在我的特定情况下使用该选项踢预处理器以吐出输出。对于生成的代码，这个预处理器的输出是致命的。例如，我有一个 4gl 应用程序，Informix 将它转换成**C 语言**，而 C 语言又被吐出一个可怕的丑陋的烂摊子。

我想要的是一个编辑器，它允许我指定有效的预处理器值并只显示相关代码。我在 Vim 匹配`#ifdef`和中有一些非常基本的工作`#endif`，但代码中充斥着更高级的构造，例如 is `#ifndef`、`#if`和`#else`。更糟糕的是，这些结构在逻辑上更复杂，而且我认为我的 Vim 脚本技能不足以让我从中得到我想要的东西。例如：

```
#if DLEVEL > 5
    #define SIGNAL  1
    #if STACKUSE == 1
        #define STACK   200
    #else
        #define STACK   100
    #endif
#else
    #define SIGNAL  0
    #if STACKUSE == 1
        #define STACK   100
    #else
        #define STACK   50
    #endif
#endif
#if DLEVEL == 0
    #define STACK 0
#elif DLEVEL == 1
    #define STACK 100
#elif DLEVEL > 5
    display( debugptr );
#else
    #define STACK 200
#endif 
```

如果我想解决它，包括定义一个表达式评估器。这必须是一个已解决的问题！如果您有 Vim 建议或其他建议，请告诉我。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-11T00:21:40.367

Eclipse [CDT](http://www.eclipse.org/cdt/)编辑器可以很好地根据您声明为活动的宏来突出显示代码。你可能想检查一下。![替代文字](https://i.stack.imgur.com/Egekv.png)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-11T01:11:20.077

对于编辑器，[Eclipse CDT](http://www.eclipse.org/cdt/)工作得很好。它显示了哪些代码处于活动状态，哪些代码被#ifdef 删除，它在#ifdef 被删除的代码中提供语法突出显示，因此您仍然可以轻松阅读它，并且如果您使用鼠标，它可以一次执行一个宏扩展在一个宏上。

从命令行`cpp -dM filename.c`处理文件并仅显示有效的#defines。例如，在您的代码中，它可能会吐出

```
#define DLEVEL 5
#define SIGNAL 1
#define STACK 200
#define STACKUSE 1 
```

不会使列表与其他预处理器指令或 C/C++ 代码混淆。

（在相关说明中，`cpp -dM /dev/null`这是为您的平台查找预定义宏的便捷方法。）

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-11T02:08:28.443

考虑查看“Unifdef 之子”，在[Is there a C pre-processor which 根据定义/未定义的值消除#ifdef 块的答案中引用？](https://stackoverflow.com/questions/525283/is-there-a-c-pre-processor-which-eliminates-ifdef-blocks-based-on-values-defined). 这不是一个可视化编辑器 - 但是，它会采用 C 代码（或其中包含 C 预处理器指令的代码）并生成一个修改后的文件，然后您可以将其与原始文件进行比较。

我很好奇提到 Informix 4GL (I4GL)。它生成的 C 代码不是，AFAIK，带有`#ifdef`结构。至少，在我负责的时候，输出不允许包含任何内容。（您使用的是哪个版本的 I4GL？）`#line`条目很多；这些允许您将生成的代码追回相应的 I4GL 源。我有一个脚本，可以将这些转换为简单的 C 注释，以便我可以在编译的代码上使用调试器（`gdb`或`dbx`或...消除想法，`sdb`或）。`adb`而且我还看到了用于生成 I4GL 源代码以提交给 I4GL 编译器的预处理器（两者）`cpp`。`m4`

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T01:13:26.407

如果您是 Linux 用户并且还使用 GNOME，那么我将不得不推荐[GEdit](http://projects.gnome.org/gedit/)。在我安装了一些用于 Intellisense、文件浏览等的[插件](http://live.gnome.org/Gedit/Plugins)之后，我真的很喜欢它……如果你没有运行 GNOME，但仍在使用 Linux (KDE)，你也许可以使用[Kate](http://kate-editor.org/)。我没有玩太久，所以我没有太多要说的。GEdit 可以在 KDE 中工作，但看起来不正确。

如果您使用的是 Windows 并且拥有一台非常好的 PC，那么请尝试[Netbeans](http://www.netbeans.org/)（是的，它也适用于 C++，而不仅仅是 Java）。如果不是，总是有[Visual C++ 2008](http://www.microsoft.com/express/vc/)（尽管仍然相当依赖 RAM）。

我不确定 Mac，因为我买不起，但 Netbeans 也适用于它（以及 Linux）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-12T19:42:07.107

Emacs 有 hide-ifdef-mode（我自己从来没用过，所以我不能保证它的质量）

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-01-18T21:14:07.577

您也可以尝试[unifdef](http://dotat.at/prog/unifdef)，它比 sunifdef 更简单。

# ruby - Ruby 数组 - 无法访问值

> ID：739239
> 
> 赞同：1
> 
> 时间：2009-04-11T00:22:12.973
> 
> 标签：ruby, arrays

所以我正在为我的班级做一个小而简单的项目，由于某种原因，我无法使用变量访问值。

这是我的课：（我在使用 getAnswer 方法时遇到问题，尤其是 answerArray 数组）

```
#Create random fact array
class RandomFact
    def initialize()
        @randomNum = rand(5)
    end

    def getQuestion
        randomNum = @randomNum
        questionArray = Array.new
        questionArray[0] = "Do you liek mudkipz?"
        questionArray[1] = "Question2"
        questionArray[2] = "Three"
        questionArray[3] = "Reddit"
        questionArray[4] = "4chan"

        puts questionArray[randomNum]
        return randomNum
    end

    def getAnswer(randomNum,answer)
        answerArray = Array.new
        answerArray[0] = "one"
        answerArray[1] = "two"
        answerArray[2] = "three"
        answerArray[3] = "four"
        answerArray[4] = "five"

        return answerArray[randomNum]
    end

end 
```

这是我的班级：

```
 randomNum = cgi['randomNum']
    answer = cgi['answer']
    puts newQuestion.getAnswer(randomNum,answer) 
```

现在的问题是 randomNum 保存了以前形式的值。如果我在我从表单中提取值的位置打印出 randomNum，我会得到它。
如果我在 getAnswer 方法中打印出 randomNum，我就明白了。
如果我打印出 answerArray[0] 我会得到一个值。
如果我打印出 answerArray[randomNum] 我什么也得不到。

它几乎是上面 getQuestion 方法的精确副本，并且可以正常工作。有输入吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T00:28:09.150

随机数可能是来自 CGI 的字符串。使用 randomNum.to_i 将其转换为整数，您将被设置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T01:37:22.510

它必须是你的输入。当我在 irb 中尝试它时，它对我有用。

```
>> new_q = RandomFact.new
=> #<RandomFact:0x41028e74 @randomNum=2>
>> new_q.getQuestion
Three
=> 2
>> new_q.getAnswer(2, "")
=> "three" 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T01:59:31.333

我不确定你在这里真正想要做什么，但如果你真的只是想按照你的示例显示的那样做，那么你不需要创建类和函数。一组问题和答案会很好用。

```
QA = [
  ["What is the capital of Estonia?","Tallinn"],
  ["How many times to 6 go into 18?","3"],
  ["What have I got in my pocket?","The Ring"]
]

qnum = cgi["qnum"].to_i
question = QA[qnum].first
answer = QA[qnum].last 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-11T02:26:31.893

你在某处初始化 newQuestion 吗？在您给出的示例中，它将为零。

一些与问题无关的花絮：您不需要 return 语句。Ruby 总是返回最后一个值。只需将值本身放在那里。在 Ruby 中，标准做法是将变量写为 new_question，而不是 newQuestion。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-11T04:03:54.233

您的代码中有许多看起来很不规则的东西。

在两个单独的数组中描述问题和答案是很麻烦的，无论你如何分割它。更好的是在一个简单、一致的数组数组中定义它们，然后使用内置的 Array#rand 方法选择其中一个元素，该方法将随机选择其中一个。

例如

```
 class RandomFact
    QUESTIONS = [
      [ 'How many nuts can a squirrel eat?', '2' ],
      [ 'What is my favorite color?', 'blue' ]
    ]

    def self.rand
      QUESTIONS.rand
    end
  end

  (question, answer) = RandomFact.rand

  puts "Question: #{question}"
  puts "Answer: #{answer}" 
```

# python - 日期顺序输出？

> ID：739241
> 
> 赞同：26
> 
> 时间：2009-04-11T00:22:31.723
> 
> 标签：python

我想知道是否有一种快速简便的方法来输出给定 python 中的数字的序数。

例如，给定数字`1`，我想输出`"1st"`数字`2`，`"2nd"`等等，等等。

这是用于处理面包屑路径中的日期

```
Home >  Venues >  Bar Academy >  2009 >  April >  01 
```

是当前显示的

我想要一些类似的东西

```
Home >  Venues >  Bar Academy >  2009 >  April >  1st 
```

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-04-11T00:48:09.120

或缩短大卫的答案：

```
if 4 <= day <= 20 or 24 <= day <= 30:
    suffix = "th"
else:
    suffix = ["st", "nd", "rd"][day % 10 - 1] 
```

* * *

## 回答 #2

> 赞同：29
> 
> 时间：2009-04-11T01:11:30.950

这是一个更通用的解决方案：

```
def ordinal(n):
    if 10 <= n % 100 < 20:
        return str(n) + 'th'
    else:
       return  str(n) + {1 : 'st', 2 : 'nd', 3 : 'rd'}.get(n % 10, "th") 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2014-02-10T04:04:22.080

当您问这个问题时，不确定它是否存在于 5 年前，但是[inflect](https://pypi.python.org/pypi/inflect)包具有执行您正在寻找的功能的功能：

```
>>> import inflect
>>> p = inflect.engine()
>>> for i in range(1,32):
...     print p.ordinal(i)
...
1st
2nd
3rd
4th
5th
6th
7th
8th
9th
10th
11th
12th
13th
14th
15th
16th
17th
18th
19th
20th
21st
22nd
23rd
24th
25th
26th
27th
28th
29th
30th
31st 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2016-05-27T02:14:33.703

这些天我会使用 Arrow [http://arrow.readthedocs.io/en/latest/](http://arrow.readthedocs.io/en/latest/)（这在 09 年肯定不存在）

```
>>> import arrow
>>> from datetime import datetime
>>> arrow.get(datetime.utcnow()).format('Do')
'27th' 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2010-02-09T21:20:51.720

在这里，它使用字典作为函数或 lambda ...

如果你向后看字典，你可以把它读成……

一切都以'th'结尾

...除非它以 1、2 或 3 结尾，否则它以 'st'、'nd' 或 'rd' 结尾

...除非它以 11、12 或 13 结尾，否则它以 'th、'th' 或 'th' 结尾

```
# as a function
def ordinal(num):
    return '%d%s' % (num, { 11: 'th', 12: 'th', 13: 'th' }.get(num % 100, { 1: 'st',2: 'nd',3: 'rd',}.get(num % 10, 'th')))

# as a lambda
ordinal = lambda num : '%d%s' % (num, { 11: 'th', 12: 'th', 13: 'th' }.get(num % 100, { 1: 'st',2: 'nd',3: 'rd',}.get(num % 10, 'th'))) 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2013-01-10T11:47:26.917

更通用和更短的解决方案（作为函数）：

```
def get_ordinal(num)
    ldig = num % 10
    l2dig = (num // 10) % 10

    if (l2dig == 1) or (ldig > 3):
        return '%d%s' % (num, 'th')
    else:
        return '%d%s' % (num, {1: 'st', 2: 'nd', 3: 'rd'}.get(ldig)) 
```

我只是结合了 David 的解决方案和库（就像 deegeedubs 所做的那样）。您甚至可以将变量 (ldig, l2dig) 替换为真正的数学运算（因为 l2dig 仅使用一次），然后您将得到四行代码。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-11T00:40:24.317

除了第 1、第 2 和第 3 次，我认为他们都只是添加第...第 4、第 5、第 6、第 11、第 21 次...哦，哎呀 ;-)

我认为这可能有效：

```
def ordinal(num):
     ldig = num % 10
     l2dig = (num // 10) % 10
     if l2dig == 1:
         suffix = 'th'
     elif ldig == 1:
         suffix = 'st'
     elif ldig == 2:
         suffix = 'nd'
     elif ldig == 3:
         suffix = 'rd'
     else: 
         suffix = 'th'
     return '%d%s' % (num, suffix) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2014-01-15T16:56:58.390

```
def ordinal(n):
    return ["th", "st", "nd", "rd"][n%10 if n%10<4 and not (10<n%100<14) else 0] 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-08-31T18:37:22.883

我做了一个似乎在这种情况下有效的功能。只需传入一个日期对象，它将使用日期来计算后缀。希望能帮助到你

```
from datetime import date
def get_day_ordinal(d):

    sDay = '%dth'
    if d.day <= 10 or d.day >= 21:
        sDay = '%dst' if d.day % 10 == 1 else sDay
        sDay = '%dnd' if d.day % 10 == 2 else sDay
        sDay = '%drd' if d.day % 10 == 3 else sDay

    return sDay % d.day

d = date.today()
print get_day_ordinal(d) 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2010-02-16T22:28:19.187

这是一个更短的通用解决方案：

```
def foo(n):
    return str(n) + {1: 'st', 2: 'nd', 3: 'rd'}.get(4 if 10 <= n % 100 < 20 else n % 10, "th") 
```

尽管上面的其他解决方案乍一看可能更容易理解，但在使用较少代码的情况下也同样有效。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-01-21T16:00:04.380

基于 eric.frederich 的 nice sol'n（仅`abs`在使用 时添加`%`）修复了负输入：

```
def ordinal(num):
    return '%d%s' % (num, { 11: 'th', 12: 'th', 13: 'th'}.get(abs(num) % 100, { 1: 'st',2: 'nd',3: 'rd',}.get(abs(num) % 10, 'th'))) 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-05-21T13:24:25.437

我必须从 javascript 转换一个脚本，在那里我有一个有用的 fn 可以复制 phps date obj。非常相似

```
def ord(n):
    return str(n)+("th" if 4<=n%100<=20 else {1:"st",2:"nd",3:"rd"}.get(n%10, "th")) 
```

这与我的日期样式器有关：

```
def dtStylish(dt,f):
    return dt.strftime(f).replace("{th}", ord(dt.day)) 
```

ps - 我是从另一个被报告为重复的线程来到这里的，但这并不完全是因为该线程也解决了日期问题

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2013-09-07T07:20:57.080

我想在我的一个项目中使用序数，经过几个原型后，我认为这种方法虽然不小，但适用于任何正整数，是的，任何整数。

它的工作原理是确定数字是高于还是低于 20，如果数字低于 20，它将把 int 1 变成字符串 1st , 2 , 2nd ；3、3；其余的将添加“st”。

对于超过 20 的数字，它将采用最后一位和倒数第二位数字，我分别将其称为十位和单位，并测试它们以查看要添加到数字中的内容。

顺便说一句，这是在 python 中，所以我不确定其他语言是否能够找到字符串上的最后一个或倒数第二个数字，如果他们这样做应该很容易翻译。

```
def o(numb):
    if numb < 20: #determining suffix for < 20
        if numb == 1: 
            suffix = 'st'
        elif numb == 2:
            suffix = 'nd'
        elif numb == 3:
            suffix = 'rd'
        else:
            suffix = 'th'  
    else:   #determining suffix for > 20
        tens = str(numb)
        tens = tens[-2]
        unit = str(numb)
        unit = unit[-1]
        if tens == "1":
           suffix = "th"
        else:
            if unit == "1": 
                suffix = 'st'
            elif unit == "2":
                suffix = 'nd'
            elif unit == "3":
                suffix = 'rd'
            else:
                suffix = 'th'
    return str(numb)+ suffix 
```

为了便于使用，我将函数称为“o”，并且可以通过导入我称为“ordinal”的文件名来调用，方法是先导入序数，然后是 ordinal.o(number)。

让我知道你的想法：D

PS我已经在另一个序数问题上发布了这个答案，但考虑到它是python，我意识到这个答案更适用。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2015-04-10T05:34:12.480

这是我作为日历类型程序的一部分编写的函数（我不包括整个程序）。它为任何大于 0 的数字添加了正确的序数。我包含了一个循环来演示输出。

```
def ordinals(num):
    # st, nums ending in '1' except '11'
    if num[-1] == '1' and num[-2:] != '11':
        return num + 'st'
    # nd, nums ending in '2' except '12'
    elif num[-1] == '2' and num[-2:] != '12':
        return num + 'nd'
    # rd, nums ending in '3' except '13'
    elif num[-1] == '3' and num[-2:] != '13':
        return num + 'rd'
    # th, all other nums
    else:
        return num + 'th'

data = ''

# print the first 366 ordinals (for leap year)
for i in range(1, 367):
    data += ordinals(str(i)) + '\n'

# print results to file
with open('ordinals.txt', 'w') as wf:
   wf.write(data) 
```

# silverlight - 编译 Silverlight 运行时问题

> ID：739252
> 
> 赞同：0
> 
> 时间：2009-04-11T00:34:05.407
> 
> 标签：silverlight, silverlight-3.0, silverlight-2.0

我创建了一个 Silverlight 项目，其中还包含一个 Web 项目。

我的 Web 项目中有一些使用 System.Windows.Point 和 System.Windows.Size 数据类型的类文件，当我尝试`List<Point>`在 Silverlight 项目中的列表中传递这两种类型中的任何一种时，我遇到了编译错误。如果我尝试不使用，`List<>`我仍然会收到 Point 数据类型错误。

[我从David Betz](http://www.netfxharmonics.com/2008/12/Reusing-NET-Assemblies-in-Silverlight)站点查看了有关编译 Silverlight 程序集的信息，我找到了一个[工具](http://www.codeproject.com/KB/silverlight/SLAssemblies.aspx)来帮助我使用他讨论的两种方法中的第一种，并成功编译了运行时并在我的 Silverlight 项目中引用了它。

以下是错误：

*   'System.Windows.Point' 类型是在未引用的程序集中定义的。您必须添加对程序集“WindowsBase，Version=3.0.0.0，Culture=neutral，PublicKeyToken=31bf3856ad364e35”的引用。C:\Documents and Settings\Gary\My Documents\Visual Studio 2008\Projects\GEP.Reports.Spatial\GEP.Reports.Spatial\MainPage.xaml.cs
*   无法从 'System.Collections.Generic.List [c:\Program Files\Reference Assemblies\Microsoft\Framework\Silverlight\v3.0\mscorlib.dll]' 转换为 'System.Collections.Generic.List [c:\Program Files\Reference Assemblies\Microsoft\Framework\Silverlight\v3.0\mscorlib.dll]

为了将这些类型添加到我的 Silverlight 运行时中，我缺少什么步骤。

谢谢你的帮助。

加里

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T00:42:37.493

对于像 Point 和 Size 这样的简单类型，最好滚动自己的结构/类，而不是尝试找到引用非 Silverlight 程序集的方法。此外，您真的不希望将诸如 System.Windows 程序集之类的东西包含在您的 .xap 中，因为 Point 结构之类的东西。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-11-11T08:43:06.287

实际上你可以使用 System.Windows.Point。只需在您的 WS 中使用**SL** dll：

C:\Program Files\Reference Assemblies\Microsoft\Framework\v3.0\WindowsBase.dll

# asp.net - asp.net - 动态设置母版页表单 ID

> ID：739254
> 
> 赞同：0
> 
> 时间：2009-04-11T00:36:12.003
> 
> 标签：asp.net, master-pages

我正在一个使用母版页的网站上工作（没什么大不了的），并且在母版页中有一个表单。

目前，呈现内容中的表单名称始终为“aspnetform”。

我需要更改一些使用此母版页的页面，并且需要将表单名称设置为特定于该页面的名称（出于 SEO 原因）。

在使用母版页的页面中，有没有一种简单的方法可以做到这一点？

注意：我不会更改使用母版的所有页面，因此母版页确实不应该更改；没有重新架构。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T01:11:21.327

[这篇文章](http://forums.asp.net/p/883974/929349.aspx)可能会对您有所帮助，尽管此解决方案的设计器模式似乎存在问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T01:46:02.770

经过一番考虑，我决定从我需要更改的页面中删除主文件的使用。不理想，但最简单的解决方案。

导致我找到这个解决方案的研究： [http ://forums.asp.net/t/899152.aspx](http://forums.asp.net/t/899152.aspx)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2011-06-09T19:43:35.330

您需要在母版页中覆盖 UniqueID。默认情况下返回 aspnetForm。

# python - 自定义/删除 Django 选择框空白选项

> ID：739260
> 
> 赞同：82
> 
> 时间：2009-04-11T00:43:58.457
> 
> 标签：python, django, django-models, django-forms

我正在使用 Django 1.0.2。我写了一个由模型支持的 ModelForm。此模型有一个 ForeignKey，其中空白 = False。当 Django 为这个表单生成 HTML 时，它会为 ForeignKey 引用的表中的每一行创建一个带有一个选项的选择框。它还在列表顶部创建了一个没有值的选项并显示为一系列破折号：

```
<option value="">---------</option> 
```

我想知道的是：

1.  从选择框中删除此自动生成的选项的最简洁方法是什么？
2.  自定义它以使其显示为最干净的方法是什么：

    ```
    <option value="">Select Item</option> 
    ```

在寻找解决方案时，我遇到了[Django ticket 4653](http://code.djangoproject.com/ticket/4653)，它给我的印象是其他人也有同样的问题，并且 Django 的默认行为可能已被修改。这张票已有一年多的历史了，所以我希望可能有一种更清洁的方法来完成这些事情。

谢谢你的帮助，

杰夫

编辑：我已经将 ForeignKey 字段配置为：

```
verb = models.ForeignKey(Verb, blank=False, default=get_default_verb) 
```

这确实设置了默认值，因此它不再是空/破折号选项，但不幸的是它似乎无法解决我的任何一个问题。也就是说，空/破折号选项仍然出现在列表中。

* * *

## 回答 #1

> 赞同：96
> 
> 时间：2009-04-11T12:40:43.337

尚未对此进行测试，但基于在[这里](http://code.djangoproject.com/browser/django/trunk/django/forms/models.py#L680)和[这里](http://code.djangoproject.com/browser/django/trunk/django/forms/models.py#L710)阅读 Django 的代码，我相信它应该可以工作：

```
class ThingForm(models.ModelForm):
  class Meta:
    model = Thing

  def __init__(self, *args, **kwargs):
    super(ThingForm, self).__init__(*args, **kwargs)
    self.fields['verb'].empty_label = None 
```

**编辑**：这是[记录在案](http://docs.djangoproject.com/en/dev/ref/forms/fields/#modelchoicefield)的，但如果您使用自动生成的 ModelForm，您不一定知道要查找 ModelChoiceField。

**编辑**：正如 jlpp 在他的回答中指出的那样，这并不完整 - 您必须在更改 empty_label 属性后将选择重新分配给小部件。由于这有点 hacky，另一个可能更容易理解的选项只是覆盖整个 ModelChoiceField：

```
class ThingForm(models.ModelForm):
  verb = ModelChoiceField(Verb.objects.all(), empty_label=None)

  class Meta:
    model = Thing 
```

* * *

## 回答 #2

> 赞同：39
> 
> 时间：2009-04-11T00:58:57.440

从文档

> 如果模型字段具有 blank=False 和显式默认值（最初将选择默认值），则不会包含空白选项。

所以设置默认值就可以了

* * *

## 回答 #3

> 赞同：24
> 
> 时间：2009-04-12T05:13:30.360

以卡尔的回答为指导，在围绕 Django 源代码扎根几个小时后，我认为这是完整的解决方案：

1.  要删除空选项（扩展 Carl 的示例）：

    ```
    class ThingForm(models.ModelForm):
      class Meta:
        model = Thing

      def __init__(self, *args, **kwargs):
        super(ThingForm, self).__init__(*args, **kwargs)
        self.fields['verb'].empty_label = None
        # following line needed to refresh widget copy of choice list
        self.fields['verb'].widget.choices =
          self.fields['verb'].choices 
    ```

2.  自定义空选项标签本质上是一样的：

    ```
    class ThingForm(models.ModelForm):
      class Meta:
        model = Thing

      def __init__(self, *args, **kwargs):
        super(ThingForm, self).__init__(*args, **kwargs)
        self.fields['verb'].empty_label = "Select a Verb"
        # following line needed to refresh widget copy of choice list
        self.fields['verb'].widget.choices =
          self.fields['verb'].choices 
    ```

我认为这种方法适用于将 ModelChoiceFields 呈现为 HTML 的所有场景，但我并不肯定。我发现当这些字段被初始化时，它们的选择被传递给 Select 小部件（参见 django.forms.fields.ChoiceField._set_choices）。初始化后设置 empty_label 不会刷新 Select 小部件的选项列表。我对 Django 不够熟悉，不知道这是否应该被视为一个错误。

* * *

## 回答 #4

> 赞同：21
> 
> 时间：2014-07-21T15:22:22.313

您可以在您的模型上使用它：

```
class MyModel(models.Model):
    name = CharField('fieldname', max_length=10, default=None) 
```

**默认=无**是答案：D

注意：我在 Django 1.7 上试过这个

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2012-07-30T12:50:51.640

至于 django 1.4，您只需要在选择字段上设置“默认”值和“空白=假”

```
class MyModel(models.Model):
    CHOICES = (
        (0, 'A'), 
        (1, 'B'),
    )
    choice_field = models.IntegerField(choices=CHOICES, blank=False, default=0) 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2013-04-27T10:52:25.097

您可以在管理员中执行此操作：

```
formfield_overrides = {
    models.ForeignKey: {'empty_label': None},
} 
```

* * *

## 回答 #7

> 赞同：5
> 
> 时间：2009-09-01T15:29:11.007

有关此问题的完整辩论和解决方法，请参见[此处。](http://code.djangoproject.com/ticket/4653)

* * *

## 回答 #8

> 赞同：5
> 
> 时间：2015-05-24T09:03:09.010

`self.fields['xxx'].empty_value = None`如果您的字段类型是`TypedChoiceField`没有`empty_label`属性的，则不起作用。

我们应该做的是删除第一选择：

1\. 如果你想建立一个`BaseForm`自动检测`TypedChoiceField`

```
class BaseForm(forms.ModelForm):

    def __init__(self, *args, **kwargs):
        super(BaseForm, self).__init__(*args, **kwargs)

        for field_name in self.fields:
            field = self.fields.get(field_name)
            if field and isinstance(field , forms.TypedChoiceField):
                field.choices = field.choices[1:]
            # code to process other Field
            # ....

class AddClientForm(BaseForm):
     pass 
```

2.只有几种形式，你可以使用：

```
class AddClientForm(forms.ModelForm):

    def __init__(self, *args, **kwargs):
        super(AddClientForm, self).__init__(*args, **kwargs)
        self.fields['xxx'].choices = self.fields['xxx'].choices[1:] 
```

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2017-09-21T14:55:29.857

对于`ForeignKey`字段，将`default`值设置`''`为模型将删除空白选项。

```
verb = models.ForeignKey(Verb, on_delete=models.CASCADE, default='') 
```

`CharField`对于像您这样的其他字段，可以将 设置`default`为`None`，但这不适用于`ForeignKey`Django 1.11 中的字段。

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-01-12T06:13:41.323

我今天搞砸了这个，只是想出了一个~~懦夫黑客~~漂亮的解决方案：

```
# Cowardly handle ModelChoiceField empty label
# we all hate that '-----' thing
class ModelChoiceField_init_hack(object):
    @property
    def empty_label(self):
        return self._empty_label

    @empty_label.setter
    def empty_label(self, value):
        self._empty_label = value
        if value and value.startswith('-'):
            self._empty_label = 'Select an option'
ModelChoiceField.__bases__ += (ModelChoiceField_init_hack,) 
```

现在您可以将默认的`ModelChoiceField`空标签调整为您想要的任何内容。:-)

PS：不需要投票，无害的猴子补丁总是很方便。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2015-03-27T14:33:39.483

对于 django 的最新版本，第一个答案应该是这样的

```
class ThingForm(models.ModelForm):
class Meta:
 model = Thing

  def __init__(self, *args, **kwargs):
    self.base_fields['cargo'].empty_label = None
    super(ThingForm, self).__init__(*args, **kwargs)` 
```

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2018-04-26T18:18:02.210

从 Django 1.7 开始，您可以通过在模型字段定义中的选择列表中添加一个值来自定义空白值的标签。从有关配置[字段选择](https://docs.djangoproject.com/en/2.0/ref/models/fields/#choices)的文档中：

> 除非在字段上设置了空白=假以及默认值，否则将使用选择框呈现包含“---------”的标签。要覆盖此行为，请向包含 None 的选项添加一个元组；例如（无，'您的显示字符串'）。或者，您可以在有意义的情况下使用空字符串而不是 None - 例如在 CharField 上。

我检查了 Django 不同版本的文档，发现这是在[Django 1.7](https://docs.djangoproject.com/en/3.1/releases/1.7/#forms)中添加的。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2014-02-14T16:52:00.390

我找到解决方案！

但不适用于 ForeignKey :-)

我也许可以帮你。我查看了 Django 源代码，发现在 django.forms.extras.widgets.SelecteDateWidget() 中有一个名为 none_value 的属性，它等于 (0, '-----') 所以我在我的代码中做了这个

```
class StudentForm(ModelForm):
    class Meta:
        this_year = int(datetime.datetime.today().strftime('%Y')) 
        birth_years = []
        years = []

        for year in range(this_year - 2, this_year + 3 ):
            years.append(year)
        for year in range(this_year - 60, this_year+2):
            birth_years.append(year)

        model = Student
        exclude = ['user', 'fullname']
        date_widget = SelectDateWidget(years=years)

        date_widget.__setattr__('none_value', (0, 'THERE WAS THAT "-----" NO THERES THIS:-)'))
        widgets = {
            'beginning': date_widget,
            'birth': SelectDateWidget(years=birth_years),
        } 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2018-02-14T04:17:00.177

这里有很多很好的答案，但我仍然对实现并不完全满意。我也有点沮丧，从不同来源（外键、选择）选择小部件会产生不同的行为。

我有一个我正在使用的设计，其中选择字段**总是**有一个空白选项，如果需要它们，它们旁边会有一个星号，并且表单根本不会验证它们是否为空。也就是说，我只能正确覆盖非`TypedChoiceField`s 字段的 empty_label。

结果*应该*是这样的。第一个结果始终是字段的名称——在我的例子中是`label`.

[![选择小部件](https://i.stack.imgur.com/Vdg76.png)](https://i.stack.imgur.com/Vdg76.png)

这就是我最终做的事情。以下是`__init__`我的表单的重写方法：

```
def __init__(self, *args, **kwargs):
    super().__init__(*args, **kwargs)
    for _, field in self.fields.items():
        if hasattr(field, 'empty_label'):
            field.empty_label = field.label
        if isinstance(field, forms.TypedChoiceField):
            field.choices = [('', field.label)] + [choice for choice in field.choices if choice[0]] 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-08-23T23:46:35.997

This becomes more complicated when the **choices are foreign keys** and if you want to **filter the choices based on some criteria** . 在这种情况下，如果您设置`empty_label`然后重新分配选项（您也可以在此处应用过滤），则空标签将为空白：

```
class ThingForm(models.ModelForm):

    class Meta:
    model = Thing

    def __init__(self, *args, **kwargs):
        super(ThingForm, self).__init__(*args, **kwargs)
        self.fields['verb'].empty_label = None
        self.fields['verb'].queryset=Verb.objects.all() 
```

基本上，下面的第一行`init`可以通过循环或内联循环应用于表单中的所有字段：

```
def __init__(self,user, *args, **kwargs):
    super(NewTicket, self).__init__(*args, **kwargs)
    for f in self.fields:
       self.fields[f].empty_label = None # or "Please Select" etc 
```

# c# - File.Exists on network == 错误？

> ID：739265
> 
> 赞同：4
> 
> 时间：2009-04-11T00:47:14.487
> 
> 标签：c#

在我的代码中我做

```
 if (!File.Exists(getSomePath()))
    {
        MessageBox.Show("... existing" + " " + getSomePath());
        this.Close();
    } 
```

我可以看到`getSomePath()`是正确的，但是当我在网络上打开应用程序时，它说它不存在。当我将文件夹复制到本地驱动器时，它说它确实存在。

这是怎么回事？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T01:14:05.063

如果您从网络共享运行它，那么您需要让用户将已编译的程序集添加为 .net 中的受信任程序。做到这一点的方法是通过“强命名”您的程序集，并在每个用户的计算机上信任该强名称。

**编辑**：这样做的原因是出于安全考虑，因此粗心的用户不会感染从远程（网络共享等）位置运行的病毒。这仅在用户运行位于远程位置的应用程序时发生。他既不能从该远程应用程序访问文件共享，也不能访问他自己的本地系统。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-11T01:13:46.343

[如果调用者没有足够的权限来读取指定的文件，则不抛出异常，并且无论路径是否存在，该方法都返回 false。](http://msdn.microsoft.com/en-us/library/system.io.file.exists.aspx)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2013-09-05T01:01:03.010

可能 SMB 缓存导致 File.Exists 看到延迟的结果。

[http://technet.microsoft.com/en-us/library/ff686200(v=WS.10).aspx](http://technet.microsoft.com/en-us/library/ff686200(v=WS.10).aspx)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T00:57:47.863

您提到它在本地工作正常，但当您从网络共享运行它时却不行。您的应用程序是否具有访问文件系统的适当安全权限？默认情况下，从网络共享运行的应用程序具有降低的安全权限。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-11T01:12:39.277

[File.Exists 大多数地方都是可疑的。](https://stackoverflow.com/questions/673654/when-is-it-okay-to-check-if-a-file-exists) 但是当您确实打开文件时，这听起来像是网络权限问题。

# jquery - 如何在点击时更改图像和 alt 属性？

> ID：739267
> 
> 赞同：5
> 
> 时间：2009-04-11T00:48:13.300
> 
> 标签：jquery, image, accessibility, onclick, alt-attribute

我希望使用 JQuery 而不是普通的 JavaScript 更改几个图像 onclick，并同时更改图像 alt 属性以实现可访问性。

这应该很容易，因为我不想对变化做一些特殊的影响，但我仍然没有找到任何关于它的东西。

这是我使用 JS 的方式（不更改 alt 属性）：

```
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
 <title>Change Image using Javascript</title>
<script type="text/javascript">
   function changeImg(image_id, image_folder){
   document.getElementById(image_id).src = image_folder;
}
</script>
</head>
<body>
<div align="center">

<img id="image1" src="images/nameofthesubfolder/originalimage1.jpg" alt="Original Image 1" />
<br />
  <label><input type="radio" name="radio_btn1" onclick="changeImg('image1', 'images/nameofthesubfolder/image1.jpg')"/>Image 1</label>
  <label><input type="radio" name="radio_btn1" onclick="changeImg('image1', 'images/nameofthesubfolder/image2.gif');"/>Image 2</label>
  <label><input type="radio" name="radio_btn1" onclick="changeImg('image1', 'images/nameofthesubfolder/image3.png');"/>Image 3</label>
  <label><input type="radio" name="radio_btn1" onclick="changeImg('image1', 'images/nameofthesubfolder/image4.jpeg');"/>Image 4</label>
<br />
<br />
<img id="image2" src="images/nameofthesubfolder/originalimage2.jpg" alt="Original Image 2" />
<br />
  <label><input type="radio" name="radio_btn2" onclick="changeImg('image2', 'images/nameofthesubfolder/image5.gif')"/>Image 5</label>
  <label><input type="radio" name="radio_btn2" onclick="changeImg('image2', 'images/nameofthesubfolder/image6.png);"/>Image 6</label>
  <label><input type="radio" name="radio_btn2" onclick="changeImg('image2', 'images/nameofthesubfolder/image7.jpeg');"/>Image 7</label>
  <label><input type="radio" name="radio_btn2" onclick="changeImg('image2', 'images/nameofthesubfolder/image8.gif');"/>Image 8</label>
</div>
</body>
</html> 
```

有没有办法避免重复图像/子文件夹的名称/？

*编辑：*非常感谢 altCognito 但我不明白如何使用此代码**为每个图像**设置不同的 alt 属性。也许我忘了提到我正在寻找它（我的错）。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-11T00:53:59.213

让我们一起去吧。（我一开始就匆匆忙忙）

```
<img id="radio_btn1" src="originalimage1.jpg" />
<br />
  <input type="radio" name="radio_btn1" value='image1.jpg' />
  <input type="radio" name="radio_btn1" value='image2.gif' />
  <input type="radio" name="radio_btn1" value='image3.png' />
  <input type="radio" name="radio_btn1" value='image4.jpeg' /> 
```

然后是 jQuery：

```
imgFldr = 'images/nameofthesubfolder/';
$("input[type='radio']").click(function() {
   $('#'+this.name).attr('src', imgFldr+this.value).attr('alt', 'newattribute');
}); 
```

[请参阅示例](http://jsbin.com/esebu)。

你可以在这里编辑它：http: [//jsbin.com/esebu/edit](http://jsbin.com/esebu/edit)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2011-08-25T13:22:50.353

您实际上不需要那么多代码更改..

这是一个例子：

```
function changeImg(image_id, image_folder) {
    $("#" + image_id).attr({ 'src': image_folder, 'alt': image_folder });
} 
```

你可以保留你的html代码..

```
 <label><input type="radio" name="radio_btn2" onclick="changeImg('image2', 'images/nameofthesubfolder/image5.gif')"/>Image 5</label> 
```

# wcf - WCF 应用程序启动事件

> ID：739268
> 
> 赞同：59
> 
> 时间：2009-04-11T00:48:27.590
> 
> 标签：wcf

首次启动 WCF 服务时获得通知的最佳方式是什么？

是否有类似于 ASP.NET 应用程序的 Global.asax 中的 Application_Start 方法的东西？

* * *

## 回答 #1

> 赞同：87
> 
> 时间：2009-04-11T00:54:57.760

由于它只是一个类，因此您可以使用静态构造函数，该构造函数将在第一次使用 Type 时被调用。

```
public Service : IContract
{
    public Service(){ // regular constructor }
    static Service(){ // Only called first time it's used. }
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-11T07:29:22.930

好吧，这可能有点棘手，因为调用 WCF 服务的首选方式是基于“每次调用”，例如，您实际上并没有任何“开始”的东西，然后只是闲逛，真的。

如果您在 IIS 或 WAS 中托管您的服务，它甚至是您的服务主机的“按需加载”——当消息到达时，主机被实例化并处理请求。

如果您是自托管的，您要么有一个控制台或 Winforms 应用程序——因此您可以连接到那里以了解它们何时启动。如果您有一个 Windows 服务来托管您的服务主机，那么您很可能会覆盖 ServiceBase 类上的 OnStart 和 OnStop 方法 --> 挂钩到那里。

问题更多：你到底想完成什么？只是记录或类似的东西，还是你想在内存中建立一些东西来坚持？

马克

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2014-07-09T07:41:03.443

您始终可以手动将 global.asax 文件添加到您的 WCF 服务应用程序，因为它托管在 IIS 上并与 ASP.NET 管道集成：

```
<%@ Application Codebehind="Global.asax.cs" Inherits="WcfApplication" Language="C#" %>

public class WcfApplication : HttpApplication
{
    protected void Application_Start()
    {
    }
} 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2011-07-19T19:50:19.750

如果你有一个自托管的 WCF 服务，你可以在服务的开启中添加一个事件，在这个事件中你可以分配一个静态变量，就像这篇文章一样：

```
//Static Variables in a WCF Service
public class Post2331848
{
    [ServiceContract]
    public interface ITest
    {
        [OperationContract]    
        string GetString();
    }    

    public class Service : ITest
    {
        public static string TheString; 
        public string GetString()
        {
            return TheString;
        }
    }

    static void host_Opening(object sender, EventArgs e)
    {
        Service.TheString = "This is the original string";
    } 

    public static void Test() 
    {
        string baseAddress = "http://" + Environment.MachineName + ":8000/Service"; 
        ServiceHost host = new ServiceHost(typeof(Service), new Uri(baseAddress)); 
        ServiceEndpoint endpoint = host.AddServiceEndpoint(typeof(ITest), new BasicHttpBinding(), ""); 

        //This is the magic line!
        host.Opening += new EventHandler(host_Opening);

        host.Open();

        Console.WriteLine("Host opened"); 
        Console.ReadLine();
        host.Close();
    }
} 
```

（原文来自[http://www.eggheadcafe.com/community/aspnet/18/10162637/help-in-maintain-global-variable-in-wcf.aspx](http://www.eggheadcafe.com/community/aspnet/18/10162637/help-in-maintain-global-variable-in-wcf.aspx)）

祝你好运！

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-04-24T20:26:52.293

```
Imports System.ServiceModel
Imports System.ServiceModel.Description

Public Class MyServiceHost
   Inherits Attribute
    Implements IServiceBehavior

    Public Sub AddBindingParameters(serviceDescription As System.ServiceModel.Description.ServiceDescription, serviceHostBase As System.ServiceModel.ServiceHostBase, endpoints As System.Collections.ObjectModel.Collection(Of System.ServiceModel.Description.ServiceEndpoint), bindingParameters As System.ServiceModel.Channels.BindingParameterCollection) Implements System.ServiceModel.Description.IServiceBehavior.AddBindingParameters

    End Sub

    Public Sub ApplyDispatchBehavior(serviceDescription As System.ServiceModel.Description.ServiceDescription, serviceHostBase As System.ServiceModel.ServiceHostBase) Implements System.ServiceModel.Description.IServiceBehavior.ApplyDispatchBehavior
        AddHandler serviceHostBase.Opened, AddressOf serviceHostBase_Opened
        AddHandler serviceHostBase.Closed, AddressOf serviceHostBase_Closed
    End Sub

    Public Sub Validate(serviceDescription As System.ServiceModel.Description.ServiceDescription, serviceHostBase As System.ServiceModel.ServiceHostBase) Implements System.ServiceModel.Description.IServiceBehavior.Validate

    End Sub

#Region "Event Handlers"

    Private Sub serviceHostBase_Opened(ByVal sender As Object, ByVal e As EventArgs)

    End Sub

    Private Sub serviceHostBase_Closed(ByVal sender As Object, ByVal e As EventArgs)

    End Sub

#End Region 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2014-03-18T11:21:03.460

用于在 Windows Communication Foundation (WCF) 中托管服务的标准 ServiceHost API 是 WCF 体系结构中的一个扩展点。用户可以从 ServiceHost 派生自己的主机类，通常在打开服务之前覆盖 OnOpening 以使用 ServiceDescription 强制添加默认端点或修改行为。

[http://msdn.microsoft.com/en-us/library/aa702697%28v=vs.110%29.aspx](http://msdn.microsoft.com/en-us/library/aa702697%28v=vs.110%29.aspx)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2015-03-02T22:41:06.647

有一个名为 WebActivator 的 nuget 包，我发现它对 IIS 托管很有用。

[https://www.nuget.org/packages/WebActivatorEx/](https://www.nuget.org/packages/WebActivatorEx/)

您将一些程序集属性添加到您的 WCF 项目。

```
[assembly: WebActivatorEx.PreApplicationStartMethod
(
    typeof(MyActivator),
    "Start")
]

public static class MyActivator
{
    public static void Start()
    {
        // do stuff here
    }
} 
```

# javascript - 取消加载缓慢的外部脚本

> ID：739270
> 
> 赞同：2
> 
> 时间：2009-04-11T00:49:29.520
> 
> 标签：javascript, json

我正在向 DOM 动态添加脚本标签，以便下载 JSON 数据。下载有时会出现问题，脚本无法正确加载。

如何告诉浏览器放弃加载时间过长的脚本？我认为这很重要，因为浏览器一次限制了打开请求的数量，我不想把它浪费在死连接上。

我尝试从 DOM 中删除脚本标记，但这似乎没有效果。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T01:08:22.970

我不确定一旦将脚本插入 DOM，您是否可以控制浏览器加载脚本的方式。

但是，如果您使用 XMLHttpRequest 下载 JSON 数据，[`abort`](https://developer.mozilla.org/en/XMLHttpRequest#abort())如果请求时间过长，您可以调用该方法。

史蒂夫

# vmware - 将 VMware 虚拟机存储在外部硬盘中

> ID：739283
> 
> 赞同：8
> 
> 时间：2009-04-11T00:57:35.353
> 
> 标签：vmware

在外部硬盘上存储 VMware 虚拟机有什么问题吗？

我最近在我的外部硬盘上安装了一个 Ubuntu 虚拟机。一旦我不小心移除了外部硬盘 USB 连接，当我再次尝试启动 Ubuntu VM 时，我遇到了内核恐慌。

我正在考虑编写一个 cron 脚本以每天备份到另一个位置以防止此问题。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-11T01:06:12.477

我的主要开发设备是在 VMWare 虚拟机上运行的 Windows 2003 Server 安装，该虚拟机使用 500 GB 外部 (USB 2.0) 硬盘驱动器。它工作正常。一些注意事项：

*   它适用于打开或关闭写缓存。带上它更好。
*   无论您是否打开或关闭了写入缓存，请**始终**确保正确关闭（或挂起）VM，并**始终**使用弹出硬件功能停止驱动器，然后再断开硬盘连接。
*   弹出/停止驱动器时，可能需要几分钟才能将所有数据写入外部驱动器。不要强迫它或匆忙它，否则你将拥有一个损坏的虚拟机。

我的主机是一台运行 XP Pro 的笔记本电脑，因此它受到断电保护。我还有一个 UPS，我可以将外部驱动器插入以防电源闪烁。

如果您最终得到一个损坏的虚拟机（这种情况很少发生），那么在最坏的情况下，您需要做的就是创建一个新虚拟机并将相同的驱动器连接到它。它对我来说总是运行良好。

**编辑：** 您的备份策略应该独立于它是否在外部硬盘上进行选择。即使您在本地拥有它们，VM 也可能损坏或丢失数据。选择您需要多久备份一次并执行此操作。但是，您应该在进行备份之前完全停止 VM 并将其关闭（不要只是暂停它）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T01:07:39.773

除了 USB 接口的速度因素与 PATA/SATA 问题相比。这应该没有问题。备份整个 VM 配置将有助于保护电源问题。

VMWare 为这种使虚拟机能够从 USB 驱动器运行的确切场景创建了 Pocket ACE 版本。

# perl - 如何在 Perl 中用越来越多的数字替换标记？

> ID：739285
> 
> 赞同：3
> 
> 时间：2009-04-11T00:57:54.477
> 
> 标签：perl, string

我想用数字替换文本文件中的标记。令牌是“ `<count>`”，我希望将其替换为到目前为止的计数。例如：

```
This <count> is a <count> count.
The <count> count increases <count><count><count>.
<count><count><count><count><count><count> 
```

变成：

```
This 1 is a 2 count.
The 3 count increases 456.
789101112 
```

我不太确定该怎么做，也许有一些循环？

```
my $text = (the input from file, already taken care of in my script);
my $count = 1;
while( regex not found? )
{
    $text =~ s/<count>/($count);
    $count ++;
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-11T01:02:22.923

```
my $text = "whatever";
my $count = 1;
$text =~ s/<count>/$count++/ge; 
```

应该为你做。替换结束时的 /e 会有所不同。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T01:09:39.550

这是一个`procFile`执行您要求的脚本：

```
$val = 1;                         # Initial change value.
while (<STDIN>) {                 # Process all lines.
    chomp;                        # Remove linefeed.
    $ln = $_;                     # Save it.
    $oldln = "x" . $ln;           # Force entry into loop.
    while ($oldln ne $ln) {       # Loop until no more changes.
        $oldln = $ln;             # Set lines the same.
        $ln =~ s/<count>/$val/;   # Change one occurrence if we can.
        if ($oldln ne $ln) {      # Increment count if change was made.
            $val++;
        }
    }
    print "$ln\n";                # Print changed line.
} 
```

`cat inputFile | perl procFile`您使用示例文件运行它：

```
This <count> is a <count> count.
The <count> count increases <count><count><count>.
<count><count><count><count><count><count> 
```

生成：

```
This 1 is a 2 count.
The 3 count increases 456.
789101112 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T03:09:53.053

这是另一种使用位置扫描的方法。

它使用 \G 位置引用来匹配行的开头或上一个匹配之后的位置。

```
#!/usr/bin/perl 
use strict;      # always strict + warnings 
use warnings;

my $count = 1;   # start at 1; 

while ( my $line = <STDIN> ) {                            # read stdin 
    while ( $line =~ /\G.*?(<count>)/g ) {                 # scan left to right and pick out one <count> at a time.
        substr( $line, $-[1], $+[1] - $-[1], $count++ );  # replace the substring and increment
    }
    print $line;
} 
```

它的功能几乎与发布的 regex-eval 解决方案相同，只是它在没有 eval 的情况下工作。我之前发布了一些反评估的恐惧，但它只是来自其他较小语言的 FUD 并没有安全地进行评估。

/e 方式有效地做到了这一点：

```
replace_callback( \$input, $regex, sub{ 
   return $count++;
}); 
```

（其中替换回调是完成所有工作的一些臃肿函数）

这真的像鸡蛋一样安全，只是不明显它是安全的。

# python - QFileDialog 将目录传递给 python 脚本

> ID：739288
> 
> 赞同：0
> 
> 时间：2009-04-11T01:00:10.447
> 
> 标签：python, qt, parsing, pyqt, qfile

我正在编写一个小 python 程序，它通过一个 XML 文件并替换一些标签。它接受三个参数，一个创建目录树的路径，读取的 XML 文件和输出到的 xml 文件。只需传入参数，它就可以从命令行正常工作。因为它不只是为了我，我认为 id 在它前面放了一个 Qt。下面是 Qt 前端的大部分内容。MOVtoMXF 是执行所有替换的类。所以你可以看到我基本上只是抓住字符串并将它们输入到我已经制作和测试过的课程中。

```
class Form(QDialog):

    def ConnectButtons(self):
        self.connect(self.pathBrowseB, SIGNAL("clicked()"), self.pathFileBrowse)
        self.connect(self.xmlFileBrowseB, SIGNAL("clicked()"), self.xmlFileBrowse)
        self.connect(self.outputFileBrowseB, SIGNAL("clicked()"), self.outputFileBrowse)

    def accept(self):
        path = self.pathBox.displayText()
        xmlFile = self.xmlFileBox.displayText()
        outFileName = self.outfileNameBox.displayText()
        print path + "  " + xmlFile + " " + outFileName
        mov1 = MOVtoMXF.MOVtoMXF(path, xmlFile, outFileName)
        mov1.ScanFile()
        self.done()

    def pathFileBrowse(self):
        file = str(QFileDialog.getExistingDirectory(self, "Select Directory"))
        self.pathBox.setText(file)

    def xmlFileBrowse(self):
        file = str(QFileDialog.getOpenFileName(self, "Save File"))
        self.xmlFileBox.setText(file)

    def outputFileBrowse(self):
        file = str(QFileDialog.getSaveFileName(self, "Save File"))
        self.outfileNameBox.setText(file) 
```

问题是当我输入一个路径时，它现在返回一个错误，或者目录不存在，或者我最后有一个斜杠

文件“/System/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/posixpath.py”，第 62 行，加入 elif path == '' 或 path.endswith('/')：

我认为它可能在 QFileDialog、它的传回的 QString 和我的 python 期望的字符串之间存在一些不匹配。但我不确定如何修复它。

我在 Max OS X 10.5.6 pyQt 4.4.4 QT 4.4.0 上运行

谢谢你提供的所有帮助。

标记

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T01:30:27.393

两种可能的解决方案。

方法一：

如果您必须使用 displayText() 方法，我建议您使用显式字符串转换来包装对 displayText() 的调用：

```
path = str(self.pathBox.displayText()) 
xmlFile = str(self.xmlFileBox.displayText()) 
outFileName = str(self.outfileNameBox.displayText()) 
```

原因是 displayText() 返回我认为是 C++ 级别的常量内存引用，这意味着您不会返回 QString 的副本，而是实际上在内存引用处可用的任何 QString。

当您调用 displayText() 函数时，它是您期望的字符串，但当内存引用的内容发生更改时，最终它是其他东西。我已经注意到不同控件上的几种方法的这种特殊性，最值得注意的是 QDateEdit/QDateTimeEdit/QTimeEdit 控件，我通常必须通过将 QDateEdit 的 date() 函数返回的 QDate 包装在QDate 构造函数。

方法二：

否则，请改用 text() 方法。返回的 QString 是一个常量值，而不是一个常量内存引用。请参阅此文档：

[http://doc.trolltech.com/4.4/qlineedit.html#text-prop](http://doc.trolltech.com/4.4/qlineedit.html#text-prop)

```
displayText : const QString 
text : QString 
```

**更新：**

看起来 Riverbank 将在 PyQt 的未来版本中解决这个问题，以防有人仍然遇到这个问题：

[PyQt4 路线图](http://www.riverbankcomputing.co.uk/software/pyqt/roadmap/index.html#implicit-copying-of-const)

> const& 的隐式复制
> 
> 在当前快照中实现。
> 
> 当 PyQt 包装由 C++ 函数返回的 const& 值时，它会包装值本身的地址。此外，它不强制执行 const 属性。这可能通过底层值消失或值被意外修改而导致意外行为（和程序崩溃）。
> 
> 处理此问题的正确方法是使用其类型的复制构造函数显式地制作该值的副本。然而，这不是 Pythonic 并且知道它需要完成需要 C++ API 的知识。
> 
> PyQt 将被更改，以便它会自动调用复制构造函数并包装副本。

# python - 为什么我的 send_mail() 命令在 Django 中不起作用？

> ID：739289
> 
> 赞同：5
> 
> 时间：2009-04-11T01:00:40.507
> 
> 标签：python, django, email

我将以下内容放在我的 settings.py 文件中。电子邮件地址有一个测试。[我从Webfaction](https://help.webfaction.com/index.php?_m=knowledgebase&_a=viewarticle&kbarticleid=128&nav=0,3)的网站找到了电子邮件设置：

```
EMAIL_HOST = 'smtp.webfaction.com'
EMAIL_HOST_USER = 'hekevintran_test'
EMAIL_HOST_PASSWORD = 'testpass'
EMAIL_PORT = 465
EMAIL_USE_TLS = True 
```

这是我的文件的样子：

```
from django.core.mail import send_mail

send_mail(subject='subject',
          message='message',
          from_email='hekevintran_test@webfaction.com',
          recipient_list=['recipient@yahoo.com'],
          fail_silently=False) 
```

当我运行上面它停顿很长时间，然后给我这个错误：

```
SMTPServerDisconnected: Connection unexpectedly closed 
```

我究竟做错了什么？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-11T01:04:03.307

我现在在 Webfaction 上有一个 Django 项目，可以正常发送电子邮件。您的设置和我的设置之间的唯一区别是我没有指定`EMAIL_PORT`or `EMAIL_USE_TLS`。在没有这些设置的情况下尝试一下，让 Django 使用它的默认设置，看看它是否有效。

为便于参考，[默认设置](http://docs.djangoproject.com/en/dev/ref/settings/#email-port)为：

```
EMAIL_PORT = 25
EMAIL_USE_TLS = False 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-01-16T20:35:30.390

我在 asmallorange.com 上的托管帐户遇到了这个问题。在那里，这是一个防火墙问题。我建议联系支持并确保端口 465 可以通过防火墙。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-07-01T10:18:57.673

我也有这个问题。我删除了 EMAIL_PORT 并设置 EMAIL_USE_TLS = True。现在是工作。

# objective-c - NSNotificationCenter 的继承与处理

> ID：739296
> 
> 赞同：0
> 
> 时间：2009-04-11T01:08:28.570
> 
> 标签：objective-c, oop, inheritance

NSNotificationCenter 观察者的继承是如何工作的？我有一个父类，其他几个类最终成为子类。父类将自己注册为特定通知的观察者。我的印象是，只要您调用发生注册的超级方法，孩子也会被注册为观察者。我碰巧把它放到了viewDidLoad中。

我是否需要重新注册子类也是观察者并重新实现他们的委托方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-11T01:13:49.167

您正在向通知中心注册*对象*，而不是*类。*当您注册通知时，您注册的回调方法会在注册的对象上被调用，如果您在子类中覆盖了它，那么被覆盖的方法会被调用。

如果您在子类中执行此操作，请询问自己注册通知的父代码是否在子类中被调用。

这都是面向对象编程和继承的核心。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T01:12:38.297

每个调用的实例`-[super viewDidLoad]`最终都应该收到通知。您不需要重写通知处理方法，因为将调用超类的实现。当然，如果在子类中这还不够，那么您将不得不提供覆盖。

# php - NuSOAP PHP 网络服务

> ID：739303
> 
> 赞同：5
> 
> 时间：2009-04-11T01:12:34.940
> 
> 标签：php, web-services

我正在使用 NuSOAP 尝试使用 Java 构建的 Web 服务。到目前为止我有这个代码：

```
<?php
require_once('lib/nusoap.php'); 
$wsdl="http://localhost:8080/HelloWorldWS/sayHiService?WSDL";
$client=new nusoap_client($wsdl, 'wsdl');
$param='John';#array('name'=>'John'); 
echo $client->call('Hey', $param);
unset($client);
?> 
```

但是当网页被加载时，我什至在代码中都没有得到一个空白页面，我真的不知道为什么。难道我做错了什么？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-11T11:36:30.230

虽然 NuSOAP 是一个非常常见的 PHP SOAP 库，但我认为它主要用于 PHP4 应用程序。因为 PHP5 有一个更快的内置 SOAP 扩展（因为它是一个编译扩展）。我还推荐使用 Zend Framework SOAP 库。但我记得我想使用一些 Web 服务（不是我编写的，用 Java 实现的）并且这些 SOAP 客户端都没有工作，但是 NuSOAP。我真的不知道为什么。

无论如何，这是我当时使用该 Web 服务所做的事情：

```
$soapClient = new nusoap_client($wsdlFile, 'wsdl', '', '', '', '');
$soapClient->soap_defencoding = 'UTF-8';
$soapClient->debug_flag = false;
$soapError = $soapClient->getError();
if (! empty($soapError)) {
    $errorMessage = 'Nusoap object creation failed: ' . $soapError;
    throw new Exception($errorMessage);
}
// calling verifyT method, using 2 parameters.
$tResult = $soapClient->call( 'verifyT', array($param1, $param2) );
$soapError = $soapClient->getError();
if (! empty($soapError)) {
    $errorMessage = 'SOAP method invocation (verifyT) failed: ' . $soapError;
    throw new Exception($errorMessage);
}
if ($soapClient->fault) {
    $fault = "{$soapClient->faultcode}: {$soapClient->faultdetail} ";
    // handle fault situation
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-11T11:17:12.850

不要使用 NuSoap。PHP 从版本 5 开始就有一个[原生的 soap 客户端](http://www.php.net/soap)，除了速度更快之外，它更加稳定。

> ..当网页被加载时，我得到一个空白页面，什么都没有..

这可能是一个致命的错误。尝试检查错误日志以查看问题所在。或设置[`display_errors = on`](http://www.php.net/manual/en/security.errors.php)

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-01-18T15:33:30.693

> 不要使用 NuSoap。PHP 从版本 5 开始就有一个原生的 soap 客户端

在 PHP5 上继续使用 NuSOAP 有一些很好的理由：

*   **NuSOAP 在您获取**页面时生成方法列表
*   NuSOAP “动态”生成 WSDL，这是 PHP 5 中 SOAP 的本机实现未提供的非常有用的功能

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T05:36:10.470

是的，你做错了什么。很难知道基于空白页的内容是什么，但我将从这行开始，它看起来不像有效的 PHP：

$param='John';#array('name'=>'John');

"#" 在 PHP 中不开始注释；“//“ 做

如果修复仍然导致空白页面，请打开错误报告和/或在整个过程中添加更多输出以查看到底发生了什么。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-01-19T20:06:46.957

请在您的浏览器中验证服务器生成的 HTML。就我而言，结果包含 XML 标记，因此浏览器无法正确显示信息。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-05-08T02:40:40.223

我刚刚面临同样的问题。

使用`include_once`代替`require_once`解决了空白页问题。这当然不是完美的解决方案，因为：[require、include 和 require_once 之间的区别？](https://stackoverflow.com/questions/2418473/when-should-i-use-require-once-vs-include)

# python - 组织一个必须共享内部状态的大型 Python 项目？

> ID：739311
> 
> 赞同：1
> 
> 时间：2009-04-11T01:14:52.020
> 
> 标签：python, project-management, code-organization

我目前正在移植一个相当大的 Perl 问题是它使用小的 Perl 技巧来使其代码可用于`use`ing。我对 Python 做了同样的事情，使代码库成为一个大模块`import`。我已经牢牢掌握 Python 很长时间了，但是我没有使用 Python 编写的大型项目的经验，这些项目需要在保持内部状态的同时访问自身的其他部分。

我还没有尝试将整个内容简单地导入一行 ( `import core`)，但我知道我目前没有以最好的方式做事。这是主脚本中的一个示例，它设置了所有内容：

```
self.Benchmark = Benchmark(self)

self.Exceptions = Exceptions

self.Settings = Settings(self)
self.Cache = Cache(self)

self.Deal = Deal(self)
self.Utils = Utils(self)
self.FileParsers = FileParsers(self)
self.Network = Network(self)
self.Plugins = Plugins(self)
self.Misc = Misc(self) 
```

它*有效*，但我对此不满意。现在，主类脚本导入`core`模块的每个部分并创建包含的类的实例，将自身作为参数传递给`__init__`这些类。像这样：

```
class FileParsers:
    def __init__(self, parent):
        self.parent = parent 
```

现在该类中的代码可以通过父类访问整个代码库的其余部分。

```
self.parent.Settings.loadSysConfig() 
```

所以我的问题是：考虑到上述情况，重组项目和重构代码以保持其当前访问其他所有内容的能力的最佳方式是什么？代码非常不重要，所以我并不*担心*内部数据的完整性，我只是不喜欢以如此丑陋的方式遍历父类。那些长链也会减慢代码的速度。

编辑：哎呀，忘记了这些：两个项目的 SVN 存储库的链接。我的[在这里](http://erok.svn.sf.net/viewvc/erok/trunk/)，我正在移植的项目在[这里](http://openkore.svn.sf.net/viewvc/openkore/openkore/trunk/)。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T01:23:40.797

如果没有真正能够看到代码，真的很难判断，但您可能应该考虑在该模块中导入每个模块使用的项目。有很长的进口清单并不罕见 - 这是我自己网站上的一个例子：

```
# standard
import inspect
import linecache
import neo_cgi
import neo_cs
import neo_util
import os
import random
import sys
import time
from _apache import SERVER_RETURN
from mod_python import apache
from mod_python import util
from mod_python.util import FieldStorage
from os.path import dirname, isfile, join, splitext

# set up path
pydir = dirname(__file__)
if pydir not in sys.path:
    sys.path.append(pydir)

# things I wrote
import auth
import handlers.accounts, handlers.publish, handlers.standard
import logger
import markup
import programs
import summarize
from auth import check_auth
from common import hdf_iterate, load_hdf_cgi_vars, load_hdf_common_vars
from common import hdf_insert_value, hdf_insert_list, hdf_insert_dict
from handlers import chain, farm, opt
from handlers import URIPrefixFilter
from handlers.standard import TabBarHandler 
```

而且我敢肯定很多更大的模块有更长的列表。

在您的情况下，可能有一个`Settings`带有单例对象的模块（或将设置作为模块属性）并执行

```
import Settings 
```

管他呢。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T15:35:41.497

> 重组项目和重构代码以保持其当前访问其他所有内容的能力的最佳方式是什么？

我认为你实际上已经很接近了，并且可能比许多 Python 项目更好，他们只是假设只有一个应用程序实例，并将应用程序特定的值存储在模块全局或单例中。

（这对于许多简单的应用程序来说是可以的，但实际上最好能够将所有内容捆绑到一个 Application 对象中，该对象拥有所有需要了解应用程序状态的内部类和方法。）

从上面的代码来看，我要做的第一件事是剔除那些不是应用程序核心能力的模块和类，这些东西不一定需要访问应用程序的状态。像“Utils”和“Misc”这样的名字听起来很可疑，因为它们的大部分内容并不是你的应用程序所特有的；它们也许可以重构为单独的独立模块，或者包的子模块，它们只有静态函数，不依赖于应用程序状态的东西。

接下来，我会将主要所有者 Application 类放在包的 __init__.py 中，而不是“主脚本”中。然后从您的运行脚本或解释器中，您可以获得应用程序的完整实例，如下所示：

```
import myapplication

a= myapplication.Application() 
```

您还可以考虑将任何基本部署设置从 Settings 类移动到初始化程序中：

```
a= myapplication.Application(basedir= '/opt/myapp', site= 'www.example.com', debug= False) 
```

（如果您只有一组可能的设置，并且每次实例化 Application() 时都会得到相同的设置，那么拥有所有这些能力来封装整个应用程序几乎没有用处；您还不如简单地使用模块全局变量。）

我对我的一些应用程序所做的是将拥有的类猴子修补成所有者应用程序对象的实际成员：

```
# myapplication/__init__.py

class Application(object):
    def __init__(self, dbfactory, debug):
        # ...
        self.mailer= self.Mailer(self)
        self.webservice= self.Webservice(self)
        # ...

import myapplication.mailer, myapplication.webservice

# myapplication/mailer.py

import myapplication

class Mailer(object):
    def __init__(self, owner):
        self.owner= owner

    def send(self, message, recipients):
        # ...

myapplication.Application.Mailer= Mailer 
```

然后可以通过替换/子类化内部类从外部扩展、更改或配置应用程序：

```
import myapplication

class MockApplication(myapplication.Application):
    class Mailer(myapplication.Application.Mailer):
        def send(self, message, recipients):
            self.owner.log('Mail send called (not actually sent)')
            return True 
```

> 我并不担心内部数据完整性

好吧，不，这是 Python 而不是 Java：我们不用太担心邪恶的程序员使用他们不应该使用的属性和方法，我们只是在名称的开头加上“_”，让它成为对所有人的适当警告。

> 那些长链也会减慢代码的速度。

不是很明显。可读性是重要因素；其他任何事情都是过早的优化。

# c# - WCF 在大约 10 个左右的调用后停止响应（限制）

> ID：739312
> 
> 赞同：40
> 
> 时间：2009-04-11T01:14:58.697
> 
> 标签：c#, wcf, web-services, throttling

我有一个 WCF 服务和一个带有对它的服务引用的应用程序，并且对于该应用程序，我有一个循环，并且在每次迭代中，它都会调用这个 wcf web 服务中的一个方法。

问题是在大约 9 次调用之后，它就停止了……如果你`Pause`按下 VS 的按钮，你会看到它卡在它发出调用的线路上。

在等待一段时间后，会抛出这个**TimeoutException ：**

> 请求通道在 00:00:59.9970000 之后等待回复时超时。增加传递给 Request 调用的超时值或增加 Binding 上的 SendTimeout 值。分配给此操作的时间可能是较长超时的一部分。

* * *

我对此进行了一些研究，发现了一些涉及在应用程序中编辑 app.config 的解决方案，以下是其中的摘录：

```
<serviceBehaviors>
    <behavior name="ThrottlingIssue">
        <serviceThrottling maxConcurrentCalls="500" maxConcurrentSessions="500" />
    </behavior>
</serviceBehaviors> 
```

.

```
<readerQuotas maxDepth="2147483647" maxStringContentLength="2147483647" 
 maxArrayLength="2147483647" 
 maxBytesPerRead="2147483647" maxNameTableCharCount="2147483647" /> 
```

然后，在我停止调试后，几分钟后，会弹出一条错误消息，告诉我发生了**灾难性故障**。

我该如何解决这个问题？当我使用普通的 Web 服务时，我没有遇到这个问题。

* * *

供参考，这里是整个`app.config`：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
    <system.serviceModel>
        <behaviors>
            <serviceBehaviors>
                <behavior name="ThrottlingIssue">
                    <serviceThrottling maxConcurrentCalls="500" maxConcurrentSessions="500" />
                </behavior>
            </serviceBehaviors>
        </behaviors>
        <bindings>
            <wsHttpBinding>
                <binding name="WSHttpBinding_IDBInteractionGateway" closeTimeout="00:01:00"
                    openTimeout="00:01:00" receiveTimeout="00:10:00" sendTimeout="00:01:00"
                    bypassProxyOnLocal="false" transactionFlow="false" hostNameComparisonMode="StrongWildcard"
                    maxBufferPoolSize="524288" maxReceivedMessageSize="65536"
                    messageEncoding="Text" textEncoding="utf-8" useDefaultWebProxy="true"
                    allowCookies="false">
                    <readerQuotas maxDepth="2147483647" maxStringContentLength="2147483647"
                        maxArrayLength="2147483647" maxBytesPerRead="2147483647" maxNameTableCharCount="2147483647" />
                    <reliableSession ordered="true" inactivityTimeout="00:10:00"
                        enabled="false" />
                    <security mode="Message">
                        <transport clientCredentialType="Windows" proxyCredentialType="None"
                            realm="" />
                        <message clientCredentialType="Windows" negotiateServiceCredential="true"
                            algorithmSuite="Default" establishSecurityContext="true" />
                    </security>
                </binding>
            </wsHttpBinding>
        </bindings>
        <client>
            <endpoint address="http://localhost:28918/DBInteractionGateway.svc"
                binding="wsHttpBinding" bindingConfiguration="WSHttpBinding_IDBInteractionGateway"
                contract="DBInteraction.IDBInteractionGateway" name="WSHttpBinding_IDBInteractionGateway">
                <identity>
                    <dns value="localhost" />
                </identity>
            </endpoint>
        </client>
    </system.serviceModel>
</configuration> 
```

* * *

**[更新] 解决方法：**

显然，**在每次请求之后你必须`Close`连接**......我现在在每次请求后关闭连接，它的工作就像一个魅力。

~~*虽然我仍然无法理解的是，在我的 app.config 中，我将 maxConcurrentCalls 和 maxConcurrentSessions 设置为 500，但我只能设置 10。任何人对此有任何答案吗？（也许我在上面发布的 app.config 中有问题）*~~

上述问题的答案（现在用虚线表示）是因为我正在编辑客户端`app.config`，而不是服务配置文件（`web.config`）

* * *

## 回答 #1

> 赞同：27
> 
> 时间：2009-04-11T02:00:08.853

允许的默认并发连接数是 10。
很可能您的客户端没有关闭连接。

要增加并发调用的数量，您必须将您的行为添加到服务配置，而不是客户端。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2011-08-02T15:43:31.217

调用 clientservice.close() 将解决问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-08-05T18:29:50.337

本周我遇到了这个问题，我无法弄清楚发生了什么。实际上，我确实将我的服务调用更改为`Dispose()`服务客户端，但它似乎没有任何效果。显然，还有另一个服务电话潜伏在某个地方。

值得注意的是，是什么让我认为这*不是*问题所在：这个限制与 Web 服务的实际套接字连接数无关。当你达到`maxConcurrentSessions`限制时，仍然只有**一个实际的套接字连接**。我正在检查这个`netstat`，这让我得出了错误的结论。所以，**不要将会话与套接字混淆**。

我们为所有 WCF 服务定义了接口，所以我现在计划在我的代码中调整这种模式：

```
IMyService service = new MyServiceClient();
using (service as IDisposable)
{
    service.MyServiceMethod();
} 
```

同样有趣的是，当服务（和网站）托管在 IIS 上时，我并没有出现这个问题。配置（几乎）相同，但我无法在该机器上重现此行为。我想这是件好事：）

## @John Saunders（关于变量赋值`using`）：

我通常会将变量赋值放在`using`语句中。但是生成的 IMyService 不能隐式转换为`IDisposable`. 如果您真的想要那里的作业，我想替代方案是：

```
IService service;
using ((service = new ServiceClient()) as IDisposable)
{
} 
```

尽管如此，这仍然存在变量范围错误的问题。引用`IService service`不可用，但仍在范围内。所以这在这方面会更好：

```
using (IDisposable serviceDisposable = new ServiceClient())
{
     IService service = (IService)serviceDisposable;
} 
```

不过，这需要我引入一个额外的变量名。***嗯***

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-06-25T15:39:02.827

这可以通过创建单例类作为 Web 服务引用和应用程序之间的接口来解决。然后它将只创建一个服务引用实例。

```
class ServiceInterface
{
     private static ServiceInterface  _instance;
     private ServiceClient _service = new ServiceClient ;
     private ServiceInterface()
     {
       //Prevent accessing default constructor
     }

     public static ServiceInterface GetInstance()
     {

     if(_instance == null)

     {

      _instance = new ServiceInterface();

    }

        return _instance;

 }

   // You can add your functions to access web service here

    Public int PerformTask()
    {
         return _service.PerformTask();
    }
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-11T01:49:52.013

您可以[配置跟踪](http://msdn.microsoft.com/en-us/library/ms733025.aspx)并运行循环吗？可能是通道出现故障并导致客户端超时。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-08-18T20:16:21.547

在把我的头发拉到一个*非常*相似的问题上之后，`Close()`或者`Dispose()`我想添加一个简单的解决方案让我很开心，即增加[`ServicePointManager.DefaultConnectionLimit`](http://msdn.microsoft.com/en-us/library/system.net.servicepointmanager.defaultconnectionlimit.aspx)默认情况下的 2。

> “DefaultConnectionLimit 属性设置了 ServicePointManager 对象在创建 ServicePoint 对象时分配给 ConnectionLimit 属性的默认最大并发连接数。”

在我的情况下，我的应用程序成功连接到我的远程服务 2 次，在第三次尝试时它根本没有尝试连接到该服务。相反，它在超时之前等待了一段时间，并出现与上述问题相同的错误消息。增加`DefaultConnectionLimit`解决了这个问题。更令人沮丧的是，这种行为在某种程度上是随机的——在 10 次的情况下，Web 服务被成功调用了多次（>2 次）。

该解决方案起源于并进一步讨论了这两个线程：[wcf-timeout-exception-detailed-investigation](https://stackoverflow.com/questions/981475/wcf-timeout-exception-detailed-investigation)和[wcf-service-throttling](https://stackoverflow.com/questions/2454362/wcf-service-throttling)。解决了我的问题。

# python - 生成本地化文件的最简单方法

> ID：739314
> 
> 赞同：22
> 
> 时间：2009-04-11T01:16:14.777
> 
> 标签：python, localization, internationalization, translation

我目前正在用 Python 编写一个应用程序，需要为其提供本地化。

我可以使用 gettext 和它附带的实用程序来生成 .po 和 .mo 文件。但是，逐个编辑每种语言的 .po 文件似乎有点乏味。然后，为每种语言创建目录并一个接一个地生成 .mo 文件，似乎有点过头了。最终结果是这样的：

```
/en_US/LC_MESSAGES/en_US.mo
/en_CA/LC_MESSAGES/en_CA.mo
etc. 
```

我可能是错的，但似乎必须有更好的方法来做到这一点。有没有人有我还没有找到的任何工具、技巧或一般知识？

提前致谢！

编辑：为了更清楚一点，我正在寻找可以加快进程的东西。因为它已经很容易了。例如，在 .NET 中，我可以生成所有需要翻译成 excel 文件的字符串。然后，翻译人员可以填写 excel 文件并为每种语言添加列。然后，我可以使用 xls2resx 生成语言资源文件。gettext 有类似的东西吗？我意识到我可以编写一个脚本来创建和读取 csv 并生成文件——我只是希望已经制作了一些东西。

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-07-03T13:55:24.377

我刚刚为我正在做的一个项目做了这个，对我们来说这个过程是这样的：

首先，我有一个 POTFILES.in 文件，其中包含需要翻译的源文件列表。我们实际上有两个文件（例如 admin.in 和 user.in），因为管理界面并不总是需要翻译。所以我们可以只向翻译人员发送包含用户看到的字符串的文件。

运行以下命令将从 POTFILES.in 创建一个 .pot 模板：

```
xgettext --files-from=POTFILES.in --directory=.. --output=messages.pot 
```

从 po/ 目录运行上述命令，该目录应该是项目的子目录并包含 POTFILES.in 文件。.pot 文件与 .po 文件具有完全相同的格式，但它是一个不包含翻译的模板。每当将新的可翻译字符串添加到源文件中时，您都会创建一个新模板。

要更新已翻译的 .po 文件并向其中添加新字符串，请运行：

```
msgmerge --update --no-fuzzy-matching --backup=off da.po messages.pot 
```

在上面的例子中，我禁用了模糊匹配，因为我们的字符串是一团糟，而且弊大于利。我还禁用了备份文件，因为这里的一切都在颠覆。为每种语言运行上述命令，在这种情况下，我更新了丹麦语翻译。

最后运行 msgfmt 从 .po 文件创建 .mo 文件：

```
msgfmt nl.po --output-file nl.mo 
```

当然，您不希望每次都手动运行它，因此创建一些脚本（或者最好是一个或多个 Makefile）来为您执行此操作。

请注意，您的目录布局与我的情况略有不同，因此您必须稍微调整输出文件名/路径，但步骤应该相同。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2012-02-25T07:34:13.133

您可以使用[Transifex](https://www.transifex.com/)，很多 Python 项目（Django、Mercurial）都在使用它。它有一个基于 Web 的编辑器和用于自动化的命令行客户端，如果有帮助的话，它还支持 .NET。

免责声明：我是 Transifex 项目负责人。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-11T02:49:57.890

它使我无法理解您如何在不编辑每种语言的 .po 文件的情况下实现真正的翻译？魔法？

编辑（评论后） - 如何自动生成**.po**文件：

我不使用 Gettext，但从[wiki 页面](http://en.wikipedia.org/wiki/Gettext)看起来你只需要调用

> msginit --locale=xx --input=name.pot

对于您想要支持的每种语言。我会生成一个脚本来生成所有语言文件，将它们提供给翻译人员，当你把它们拿回来时，对它们运行**msgfmt**。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-11T17:01:27.483

使用脚本。假设您的源代码位于 $SRC 目录中，因此为 i18n 文件（pot、po、mo 等）创建目录 $SRC/po。然后创建文件 $SRC/po/POTFILES.in ，其中使用 gettext 函数调用指定源代码文件的路径。它可能看起来像：

```
[encoding: UTF-8]
./main.cpp
./plugins/list.cpp 
```

现在您可以使用以下命令（在目录 $SRC 内）：

用于更新主文件messages.pot：

```
intltool-update --pot --gettext-package=messages --verbose 
```

用于合并从 messages.pot 到 fr.po 文件的更改，例如：

```
msgmerge -U fr.po messages.pot 
```

生成 mo 文件使用命令：

```
msgmerge -o - fr.po messages.pot | msgfmt -c -o fr/LC_MESSAGES/programname.mo - 
```

当然目录 fr/LC_MESSAGES/ 必须在调用之前创建，您也可以在执行之前删除现有的 fr/LC_MESSAGES/programname.mo

例如，为了加快进程，将所有此类命令放入相应的 .sh 文件中。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-05-30T21:05:20.883

您可以尝试[Translate Toolkit](http://toolkit.translatehouse.org/)进行各种 po 文件转换（例如 po2csv）。子项目[Pootle](http://pootle.translatehouse.org/)允许通过网络管理翻译。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-11T04:28:23.787

我正在使用[poEdit](http://www.poedit.net/)进行翻译。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-05-31T04:43:41.867

我的建议是[django-rosetta](http://code.google.com/p/django-rosetta/)，它为您提供了一个基于 Web 的界面来编辑您的翻译。Django 根本不需要参与您的应用程序，您只是将它用于在线 .PO 编辑工具。

[另一个有趣的新翻译站点是Transifex](http://www.transifex.net/) ，我相信它是使用 Django/Pinax 构建的，尽管我不确定它是否允许直接编辑 .PO 文件。

# git - 如何找到离另一棵树最近的树？

> ID：739317
> 
> 赞同：0
> 
> 时间：2009-04-11T01:17:47.910
> 
> 标签：git

这是场景：我有一个本地 git 存储库，它反映了另一个源控制系统（专有系统）的内容。我编写了一个脚本，它定期将我的 git 分支与该系统的同一分支的最新副本同步（由另一个系统中的另一个术语调用，但在概念上相似）。

现在，假设在另一个系统中，有人从我当前正在同步的分支中创建了一个分支并开始对其进行黑客攻击。我想做的是拉下另一个分支的第一个版本，然后在我的主分支的 git 版本中找到最接近新分支的提交。如果我能做到这一点，我会知道主分支中的哪个提交作为这个新分支的父级。

在我看来，这听起来像是计算“树距离”的问题。但是由于 SHA1 哈希没有距离度量，除了在每个提交上进行明显的手动深度搜索以找出哪个具有最多相似 blob 的地方之外，还有其他方法可以做到这一点吗？

更新：见下文，找到了一种特定于域的方法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T01:44:00.263

一种完全笨拙的方法是针对每个候选分支创建补丁文件，看看哪个是最小的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-11T18:34:36.230

感谢您的回答！

事实证明，我对我的特定应用程序很幸运。目标系统删除一个描述文件，其中包含构成当前分支状态的文件和版本号。我提交了这些文件，所以我可以找到所有这些文件，并使用一个简单的评分系统来找出其中两个文件之间的“接近”程度，正分表示你的文件较新，负分表示分支较新。与分数最接近零的配对找到与新分支最相似的提交。

不过，我不会将此答案标记为最佳答案，因为它仅适用于我的情况。

所有其他人，我浏览了 git 源代码并找到了 match_trees.c。这目前由子树合并策略使用，但它有一个漂亮的 score_tree() 方法，可以为此目的向用户展示。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T01:39:00.527

比那更糟；在一般情况下，您必须计算 blob 上的编辑距离以查看它们的相似程度。

希望这是一个罕见的事件，我会克隆 git 存储库并开始回滚版本以找到最接近您希望复制的树的提交。考虑使用它会很好`git bisect`，但是由于没有总排序，也没有`good`or的绝对概念`bad`，我不知道如何避免尝试每次提交。

最小编辑距离也是 NP 难的，所以你在这里真的很痛苦。

如果幸运的话，在另一个系统中，您可以恢复创建新分支的日期和时间。那么也许你可以**抓住那个时间戳之前的最后一次提交**？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T01:39:14.910

当您需要提交时，为什么不在您**自己的分支中工作并与主干合并？**

听起来你可能需要一个[供应商分支](http://svnbook.red-bean.com/en/1.5/svn.advanced.vendorbr.html)来解决这个问题。

# sql - 如何更新嵌套集树结构？

> ID：739319
> 
> 赞同：2
> 
> 时间：2009-04-11T01:23:15.727
> 
> 标签：sql, hierarchical-data, nested-sets, updating

我看过[在 MySQL 中管理分层数据](http://mikehillyer.com/articles/managing-hierarchical-data-in-mysql/)，但它实际上只处理在嵌套集模型中添加和删除节点。

我需要能够**移动**带有和不带有子节点的节点。

我该怎么做？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T08:09:03.630

嵌套集设计不是对树进行这种更改的好选择。在移动节点时重新计算右/左数字真的很复杂。

**邻接表**是移动子树最简单的树设计：

```
UPDATE TreeTable
SET parent = $newparent
WHERE id = 123; 
```

**路径枚举**设计还可以轻松地重新定位节点及其子节点：

```
UPDATE TreeTable
SET path = REPLACE(path, 'A/B/C/', 'A/D/F/') -- MySQL function
WHERE path LIKE 'A/B/C/%'; 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T15:09:15.273

与子节点一起移动：

在“left”和“right”值都位于 0..n*2 值的连续块中的经典嵌套集中，将有一系列行将“x”位置移动到左侧或“x”移动子树时向右放置，其中“x”是被移动的左/右值的数量。例如。

```
A: 1,6
   B: 2,3
   C: 4,5
D: 7,8
E: 9,10 
```

如果您将带有后代的“A”移动到“D”和“E”之间，则“A”右侧但“E”左侧的所有内容都需要将其左/右索引减少 6（“ A' 与后代）：

```
UPDATE things
SET nsl=nsl+(
    IF nsl BETWEEN 1 AND 6 THEN 6  -- A-C go forward 6
    ELSE -6                        -- D goes back 6
), nsr=nsr+(                       -- same again
    IF nsl BETWEEN 1 AND 6 THEN 6
    ELSE -6
)
WHERE
    nsl BETWEEN 1 AND 6            -- select A-C
    OR nsl BETWEEN 7 AND 8         -- select D 
```

没有子节点的移动更复杂。包含的节点要后退1，删除节点之后的节点都要后退2，然后新插入点之后的节点要前进2以腾出空间。

虽然您*可以*以与上述相同的方式执行此操作，但它开始变得非常混乱，您可能需要考虑替代方法，例如手动重写*所有*左/右值或使用不同的模式类型，使这些操作更简单，例如完整的祖先-后代邻接关系。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-08T05:36:02.923

这是一个解决方案，可让您将节点移动到树中的任何位置，只需一个输入参数 - 节点的新左侧位置 (newpos)。此方法无法移动没有子节点的节点，但我很想知道您的用例。

基本上分为三组：

*   为子树创建新空间。
*   将子树移动到该空间中。
*   删除子树腾出的旧空间。

在 psuedo-sql 中，它看起来像这样：

```
//
 *  -- create new space for subtree
 *  UPDATE tags SET lpos = lpos + :width WHERE lpos >= :newpos
 *  UPDATE tags SET rpos = rpos + :width WHERE rpos >= :newpos
 * 
 *  -- move subtree into new space
 *  UPDATE tags SET lpos = lpos + :distance, rpos = rpos + :distance
 *           WHERE lpos >= :tmppos AND rpos < :tmppos + :width
 * 
 *  -- remove old space vacated by subtree
 *  UPDATE tags SET lpos = lpos - :width WHERE lpos > :oldrpos
 *  UPDATE tags SET rpos = rpos - :width WHERE rpos > :oldrpos
 */ 
```

:distance 变量是新位置和旧位置之间的距离，:width 是子树的大小，:tmppos 用于跟踪在更新期间移动的子树。这些变量定义为：

```
// calculate position adjustment variables
int width = node.getRpos() - node.getLpos() + 1;
int distance = newpos - node.getLpos();
int tmppos = node.getLpos();

// backwards movement must account for new space
if (distance < 0) {
    distance -= width;
    tmppos += width;
} 
```

有关完整的代码示例，请参阅我的博客：

[https://rogerkeays.com/how-to-move-a-node-in-nested-sets-with-sql](https://rogerkeays.com/how-to-move-a-node-in-nested-sets-with-sql)

如果您喜欢此解决方案，请投票。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-11T01:31:11.310

考虑移动节点相当于删除该节点及其所有子节点（如果有），并将该节点及其子节点（如果有）插入新位置。

现在重新阅读技术文章，了解在执行删除和插入后整个表的外观，您会发现执行相同操作的更新。

# c# - 从非常大的 HTML 文件中解析特定元素

> ID：739325
> 
> 赞同：1
> 
> 时间：2009-04-11T01:26:22.490
> 
> 标签：c#, c++, python, html, parsing

我有一个非常大的 HTML 文件（几兆字节）。我知道我想要的数据如下`<div class=someName>here</div>`

什么是解析 HTML 页面的好库，以便我可以循环遍历元素并抓取每个元素`someName`？我想在 C#、Python 或 C++ 中执行此操作。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-11T01:29:21.437

我会使用 Python 和[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)来完成这项工作。它在处理这类东西方面非常扎实。

对于您的情况，您可以使用[SoupStrainer](http://www.crummy.com/software/BeautifulSoup/documentation.html#Improving%20Performance%20by%20Parsing%20Only%20Part%20of%20the%20Document)使 BeautifulSoup 仅解析文档中具有您想要的类的 DIV，因此它不必将整个内容都保存在内存中。

例如，假设您的文档如下所示：

```
<div class="test">Hello World</div>
<div class="hello">Aloha World</div>
<div>Hey There</div> 
```

你可以这样写：

```
>>> from BeautifulSoup import BeautifulSoup, SoupStrainer
>>> doc = '''
...     <div class="test">Hello World</div>
...     <div class="hello">Aloha World</div>
...     <div>Hey There</div>
... '''
>>> findDivs = SoupStrainer('div', {'class':'hello'})
>>> [tag for tag in BeautifulSoup(doc, parseOnlyThese=findDivs)]
[<div class="hello">Aloha World</div>] 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-11T01:37:30.047

如果您想使用 C#，Html Agility Pack 是一个不错的[选择](http://www.codeplex.com/htmlagilitypack)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T10:42:33.557

听起来像是一个好的旧正则表达式的案例。

输入：

```
<div class="test">Hello World</div>
<div class="somename">Aloha World</div>
<div>Hey There</div> 
```

正则表达式：

```
\<div\sclass\=\"somename\"\>(?<Text>.*?)\<\/div\> 
```

产量：

```
Aloha World (note: In a single group named Text) 
```

可能需要考虑缺少引号等...

虽然现在使用正则表达式有[两个问题](http://www.codinghorror.com/blog/archives/001016.html)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T01:29:01.297

Xerces 有很好的文档记录、支持和测试。(C++)

[http://xerces.apache.org/xerces-c/](http://xerces.apache.org/xerces-c/)

（是的，它是一个 XML 解析器，但它应该可以解决问题）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-12T15:07:07.563

[试试](http://www.grinninglizard.com/tinyxml/)TinyXML 。（C++ XML 解析器）

# c# - 为什么通过集合枚举会引发异常但遍历其项目不会

> ID：739326
> 
> 赞同：4
> 
> 时间：2009-04-11T01:27:17.557
> 
> 标签：c#, .net, synchronization, list, enumerators

我正在测试一些同步结构，我注意到一些让我感到困惑的东西。当我枚举一个集合同时写入它时，它抛出了一个异常（这是预期的），但是当我使用 for 循环遍历集合时，它没有。有人可以解释一下吗？我认为 List 不允许读取器和写入器同时操作。我本来希望循环遍历集合会表现出与使用枚举器相同的行为。

**更新：这是一个纯粹的学术练习。我知道如果同时写入列表，枚举列表是不好的。我也明白我需要一个同步构造。我的问题再次是关于为什么操作一个按预期抛出异常而另一个没有。**

代码如下：

```
 class Program
   {
    private static List<string> _collection = new List<string>();
    static void Main(string[] args)
    {
        ThreadPool.QueueUserWorkItem(new WaitCallback(AddItems), null);
        System.Threading.Thread.Sleep(5000);
        ThreadPool.QueueUserWorkItem(new WaitCallback(DisplayItems), null);
        Console.ReadLine();
    }

    public static void AddItems(object state_)
    {
        for (int i = 1; i <= 50; i++)
        {
            _collection.Add(i.ToString());
            Console.WriteLine("Adding " + i);
            System.Threading.Thread.Sleep(150);
        }
    }

    public static void DisplayItems(object state_)
    {
        // This will not throw an exception
        //for (int i = 0; i < _collection.Count; i++)
        //{
        //    Console.WriteLine("Reading " + _collection[i]);
        //    System.Threading.Thread.Sleep(150);
        //}

        // This will throw an exception
        List<string>.Enumerator enumerator = _collection.GetEnumerator();
        while (enumerator.MoveNext())
        {
            string value = enumerator.Current;
            System.Threading.Thread.Sleep(150);
            Console.WriteLine("Reading " + value);
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-11T01:54:00.880

枚举时不能修改集合。即使没有考虑线程问题，该规则仍然存在。来自[MSDN](http://msdn.microsoft.com/en-us/library/system.collections.ienumerable.getenumerator.aspx)：

> 只要集合保持不变，枚举数就保持有效。如果对集合进行了更改，例如添加、修改或删除元素，则枚举器将不可恢复地失效，并且其行为未定义。

基于整数的 for 循环实际上不是枚举数。在大多数情况下是完成同样的事情。但是，IEnumerator 的接口保证您可以遍历整个集合。如果在修改集合后发生对 MoveNext 的调用，则平台通过引发异常在内部强制执行此操作。此异常由枚举器对象引发。

基于整数的 for 循环仅遍历其数字列表。当您按整数索引集合时，您只是在该位置获取项目。如果从列表中插入或删除了某些内容，您可以跳过一个项目或运行相同的项目两次。当您需要在遍历集合时修改集合时，这在某些情况下很有用。for 循环没有枚举器对象来保证 IEnumerator 契约，因此不会引发异常。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-11T04:46:40.950

要回答您的实际问题...

枚举时，您将获得一个绑定到列表状态的 IEnumerator，就像您请求它时一样。对枚举器（MoveNext，Current）进行进一步的操作。

使用 for 循环时，如果调用按索引获取特定项目，则您正在创建一个序列。没有诸如枚举器之类的外部上下文知道您处于循环中。对于所有收藏都知道，您只要求一件物品。由于该集合从未分发过枚举器，因此它无法知道您要求第 0 项、第 1 项、第 2 项等的原因是因为您正在遍历列表。

如果您在遍历列表的同时对列表进行处理，那么无论哪种方式，您都会遇到错误。如果添加项目，那么 for 循环可能会默默地跳过一些，而 foreach 循环会抛出。如果删除项目，那么如果你不走运，for 循环可能会抛出一个超出范围的索引，但可能大部分时间都可以工作。

但我想你明白这一切，你的问题只是为什么两种迭代方式的行为不同。答案是当您在一种情况下调用 GetEnumerator 和在另一种情况下调用 get_Item 时，集合的状态是已知的（对集合而言）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T01:41:04.123

**一旦列表被更改**，枚举器就会失效。如果您在枚举列表时更改列表，则需要重新考虑您的策略。

当您开始显示功能时获取一个新的枚举器并在此过程中锁定列表。或者，将您的 List 复制到一个新的 _displayCollection List 中，并枚举这个单独的集合，除非在显示过程开始之前被填充，否则不会写入该集合。希望这可以帮助。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T01:52:06.577

不同之处在于，当您说“循环遍历集合”时，实际上并不是循环遍历集合，而是遍历 1 到 50 之间的整数，并在这些索引处添加到集合中。这对 1 到 50 之间的数字仍然存在这一事实没有影响。

枚举列表时，您是在枚举项目，而不是索引。因此，当您在枚举时添加项目时，会使枚举无效。它的构建方式是为了防止像您正在做的事情这样的情况，您可能会枚举到列表中的第 6 项，同时在索引 6 处插入一个项目，您可能会枚举旧的或新的项目，或者一些未定义的状态。

如果您想这样做，请查找“线程安全”列表，但要准备好同时处理读+写的不准确性:)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-11T01:58:52.863

该列表有一个内部版本计数器，当您更改列表的内容时会更新该计数器。枚举器跟踪版本并在发现列表已更改时抛出异常。

当您只是循环列表时，没有任何东西可以跟踪版本，因此没有任何东西可以捕捉到列表已更改。

如果您在循环时更改列表，您可能会得到不需要的效果，这是枚举器保护您免受的影响。例如，如果您从列表中删除一个项目而不更改循环索引，以便它仍然指向同一个项目，您可能会错过循环中的项目。同样，如果您在不更正索引的情况下插入项目，您可能会多次迭代同一个项目。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-11T01:45:32.617

您不能在枚举时更改集合。

问题是您在集合未满时开始枚举，并尝试在枚举时继续添加项目

* * *

## 回答 #7

> 赞同：-1
> 
> 时间：2009-04-11T01:44:10.530

代码有缺陷，因为您睡了 5 秒钟，但并非所有项目都已添加到列表中。这意味着您在第一个线程完成将项目添加到列表之前开始在一个线程上显示项目，从而导致基础集合更改并使枚举器无效。

从 Add 代码中删除 Thread.Sleep 突出显示了这一点：

```
public static void AddItems(object state_)
{     
   for (int i = 1; i <= 50; i++)      
   {        
       _collection.Add(i.ToString());      
       Console.WriteLine("Adding " + i);  
   }   
} 
```

您应该使用同步机制来等待第一个线程完成添加项目的工作，而不是休眠。

# silverlight - 我可以向 Silverlight 元素添加绑定规则吗？

> ID：739327
> 
> 赞同：0
> 
> 时间：2009-04-11T01:28:02.703
> 
> 标签：silverlight, image, data-binding

希望我正确地表达了这个问题。如果不是，让我解释一下。我想将 Image 元素的 Source 属性绑定到我的 DataContext 对象的 ImageUrl 属性。这是 XAML：

```
<Image
    x:Name="EmployeeImage"
    Grid.Column="0"
    Grid.Row="0"
    Grid.RowSpan="2"
    Source="{Binding Path=ImageUrl}"
    Stretch="UniformToFill">
</Image> 
```

显然，我可以在代码隐藏中执行绑定并在那里执行任何检查，但是如果 ImageUrl 属性为 null 或为空，是否有办法以声明方式为图像源提供替代 Url？

**编辑：我添加了一个转换器，它检查 ImageUrl 并在它为空或空时返回默认路径。如果还有其他方法，我很想听听。**

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T01:58:08.403

为什么不让你绑定的对象来处理它？

```
public string ImageURL
{
  get { return (_ImageURL != string.Empty) ? _ImageURL : _MyDefaultImageURL; }
} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T01:58:24.753

有一种方法可以声明式地执行此操作，但您需要先编写一个派生自[IValueConverter](http://msdn.microsoft.com/en-us/library/system.windows.data.ivalueconverter.aspx)的类。完成后，您可以使用该类进行任何检查，以便在激活路径绑定时调用。

XAML 示例：

```
<Image Source="{Binding Path=ImageUrl, Converter={StaticResource YourImagePathConverter}}"/> 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-10-09T21:49:54.977

`Source="{Binding Path=ImageUrl, FallbackValue=DefaultPathHere}"`在 WPF 中工作，不确定是否`FallbackValue`在 Silverlight 中工作。

[http://msdn.microsoft.com/en-us/library/system.windows.data.bindingbase.fallbackvalue.aspx](http://msdn.microsoft.com/en-us/library/system.windows.data.bindingbase.fallbackvalue.aspx)

一项小研究表明，Silverlight 4 中提供了 FallbackValue，但之前的版本中没有。

# silverlight - Sys.InvalidOperationException：控件“Silverlight1”中的 ImageError 错误 #4001：AG_E_NETWORK_ERROR

> ID：739338
> 
> 赞同：1
> 
> 时间：2009-04-11T01:36:33.463
> 
> 标签：silverlight, image, data-binding, exception-handling

每次我的 Silverlight 应用程序加载时，我都会收到以下错误，并且无法弄清楚如何解决它。此错误发生在加载 UserControl 时（但在绑定 Source 之前）。我尝试在 ImageFailed 事件期间处理此错误，但在引发此异常时不会触发它。我能做些什么？

```
<Image
    x:Name="EmployeeImage"
    Source="{Binding Path=ImageUrl}"
    Stretch="UniformToFill">
</Image> 
```

**编辑（澄清）：**我有一个包含 ImageUrl 字段的 Employee 对象。我的 UserControl 的 DataContext 绑定到包含 SelectedEmployee 属性的 ViewModel 对象。所以我的 Image 元素绑定到 SelectedEmployee 的 ImageUrl 属性。这很好用，除了第一次加载图像时（并且在绑定 DataContext 之前）。如果我在 ViewModel 的构造函数中实例化 SelectedEmployee，那么错误就会消失。如果我不这样做，我会收到错误消息。这对我来说很奇怪，因为实例化一个新的 Employee 对象会导致 ImageUrl 为空。无论哪种方式，当设置 DataContext 时 Image 成功绑定（并且 Employee 对象填充了数据）。我只是想弄清楚为什么我会收到错误消息。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T01:44:34.350

您很可能正在尝试访问与 Silverlight 页面不在同一域中的网络资源。出于安全原因，您不允许在 Silverlight 中进行跨域调用。

# iphone - 音频服务功能帮助

> ID：739353
> 
> 赞同：1
> 
> 时间：2009-04-11T01:45:53.347
> 
> 标签：iphone, objective-c, xcode, audio

这是音频服务函数 AudioServicesSetProperty 附带的简介。它有点过头了。有人可以给我一个如何实际使用它的例子。谢谢。

> AudioServicesSetProperty 设置指定系统声音服务属性的值。
> 
> OSStatus AudioServicesSetProperty (
> AudioServicesPropertyID inPropertyID, UInt32 inSpecifierSize, const void *inSpecifier, UInt32 inPropertyDataSize, const void *inPropertyData);
> 
> 参数：
> 
> inPropertyID：要设置其值的属性。
> 
> inSpecifierSize：inSpecifier 参数指向的缓冲区的大小。如果不需要说明符缓冲区，则传递 0。
> 
> inSpecifier：指向说明符缓冲区的指针，如果您需要有关其信息的属性需要这样的缓冲区。如果不需要说明符，则传递 NULL。
> 
> inPropertyDataSize：outPropertyData 参数指向的缓冲区的大小（以字节为单位）。
> 
> inPropertyData：要设置的属性值。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-11T02:34:56.617

如果您使用系统声音服务机制播放短系统声音（少于 30 秒）（代码如下所示）

```
#include <AudioToolbox/AudioToolbox.h>

    SystemSoundID aSoundID;

/* Setup */
    SystemSoundID aSoundID;
    OSStatus error = 
             AudioServicesCreateSystemSoundID((CFURLRef)aFileURL, &aSoundID);
    if (error == kAudioServicesNoError) { // success
        _soundID = aSoundID;
    }

/* Play */
    AudioServicesPlaySystemSound(aSoundID);

/* Dispose */
    AudioServicesDisposeSystemSoundID(aSoundID); 
```

您可以使用**AudioServicesSetProperty**使用此函数设置两个属性。

它们是：kAudioServicesPropertyIsUISound = 'isui'，kAudioServicesPropertyCompletePlaybackIfAppDies = 'ifdi'

**kAudioServicesPropertyIsUISound**，如果设置为 1 表示对于 inSpecifier 参数中传入的系统声音指定的音频文件，系统声音服务器尊重用户在 Sound Effects 首选项中的设置，并且在用户关闭音效时静音。

此属性默认设置为 1。将其设置为 0 以使系统声音在传递给 AudioServicesPlaySystemSound 时始终播放，而不管用户在声音首选项中的设置如何。

**kAudioServicesPropertyCompletePlaybackIfAppDies**，如果设置为 1 则表示在 inSpecifier 参数中传递的系统声音指定的音频文件应该完成播放，即使客户端应用程序终止。例如，如果用户退出或应用程序在播放声音时意外终止，则可能会发生这种情况。默认值为 0。也就是说，如果您希望声音在应用程序终止的情况下完成播放，则必须显式将此属性的值设置为 1。

**编辑：**重新阅读您的问题后，似乎“我如何设置属性”而不是“这件事做什么”在这种情况下，以下内容将更有用：

假设您按照我上面指定的方式设置声音，您可以通过执行以下操作设置此特定 SystemSoundID 对象以忽略手机侧面的“静音”设置：

```
UInt32 flag = 0;
err = AudioServicesSetProperty(kAudioServicesPropertyIsUISound,
                               sizeof(UInt32),
                               &aSoundID,
                               sizeof(UInt32),
                               &flag); 
```

# qt - 有人将 Qt 提交给他们自己的源代码控制吗？

> ID：739355
> 
> 赞同：2
> 
> 时间：2009-04-11T01:46:22.613
> 
> 标签：qt, version-control

有人将 Qt 提交给他们自己的源代码控制吗？如果是这样，你怎么做？您是提交整个 Qt 目录还是只选择应用程序需要的目录（bin/lib/include/src）

Qt 新版本问世时如何处理？

我问是因为我正在尝试设置构建自动化，而 Qt moc 有点痛苦……只是想知道人们通常如何处理提交 3rd 方库。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-11T01:59:35.810

在我的公司，我们不将 Qt 提交到源代码，我们在构建机器上单独编译它，然后在项目中链接到它，无论是 C++、Java (Jambi) 还是 Python (PyQt)。

在构建/打包阶段，我们的构建工具会根据需要记录依赖项并包含 DLL 等。如果您有兴趣，我们正在使用 Kitware 的 CMake。

[http://www.cmake.org/](http://www.cmake.org/)

它具有跨平台的额外好处。根据您的项目规模，可以考虑使用 Kitware 提供的补充工具 CPack、CTest 和 CDash。（免责声明：我不为 Kitware 工作，但我确实帮助编写了一个依赖于 Kitware 某些产品的项目）。

我还听说有些人使用 Qt 自己的 QMake 工具取得了巨大的成功，该工具应该与 Qt 的源代码分发一起提供。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T11:23:45.253

对于 git，我使用 git-submodule。这允许我链接到另一个存储库（git、svn 等）但不将源保存到您的存储库，您只需使用“git 子模块”来拉取它。当您推送主仓库时，它不包含子模块。这允许您保留本地副本，其他任何人都可以使用 submodule 命令拉取子模块。

见：[http ://www.kernel.org/pub/software/scm/git-core/docs/git-submodule.html](http://www.kernel.org/pub/software/scm/git-core/docs/git-submodule.html)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T01:59:11.320

我不确定您的大部分帖子，但我可以告诉您的一件事是您不必每次新版本发布时都进行更新。稍等片刻，您稍后可能会感谢自己。可以在家更改版本以随意使用它，但是如果您在商业上这样做，那可能会非常痛苦！微软让我很难学会这一点！

# jsf - JSF 1.1：关于生命周期的问题，为什么渲染属性会影响下面的托管 bean 操作？

> ID：739373
> 
> 赞同：0
> 
> 时间：2009-04-11T02:02:12.920
> 
> 标签：jsf, lifecycle

我有一个页面“start.jsf”，它指向一个动作#{ruler.start}，这个动作将请求转发到“flow.jsf”。

**托管 bean** “ ruler”（请求范围）包含一些属性，其中之一称为“ruler.operation”，正确填充到“start.jsf”中。

页面“flow.jsf”有一个命令按钮，指向另一个名为“objectList”（会话范围）的**托管 bean**，其中包含一个名为“objectList.selectedContractor”的属性对象（在构造函数中初始化的 POJO，因此其子属性始终为空仅在第一次*MB*调用时，或错误？），它的动作是#{objectList.itemInsert}。

“flow.jsf”的表单页面包含以下标签：

```
 <h:form>
 <h:inputText id="crnameNew" value="#{objectList.selectedContractor.crname}" rendered="#{ruler.operation eq ruler.codeOperationNew}" />

 <h:inputText id="someProp" value="#{objectList.someProp}" />
 <h:commandButton styleClass="importedButton" value="insert" action="#{objectList.itemInsert}" />
 </h:form> 
```

好吧，当我提交动作 #{objectList.itemInsert} 时，只有“someProp”正确填充到 MB 中，而“selectedContractor.crname”结果为空。

但是，如果我从绑定 #{objectList.selectedContractor.crname} 的标签中切换“rendered”属性，它会在调用 #{objectList.itemInsert} 时正常工作并正确填充......那么**为什么“rendered”会影响处理提交？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T18:17:39.300

正如该属性所暗示的，它只影响渲染。如果它在页面上呈现，则该值将在表单提交时发送回 Bean。如果它正在渲染并且没有发生这种情况，那么还有其他问题。

# svn - 你对版本控制有多远？

> ID：739391
> 
> 赞同：5
> 
> 时间：2009-04-11T02:26:35.123
> 
> 标签：svn, git, version-control

“磁盘”便宜的理论最近有点失控了。版本控制有一些强大的方面使我们能够使用一些引导文件和一个简单的命令来拉动工具链来让新开发人员加入。

最近对系统的升级提示了存储构建二进制文件的请求。随后请求对整个虚拟化构建系统进行版本控制。添加到顶部的每一层都会在存储库之间创建重要的关系，并且需要良好的基础设计来管理它。

工具链的存储带来了即时的好处，而构建的二进制文件的存储带来了即时的责任。不幸的是，Git 在处理大型二进制文件时存在一些基本问题。

在以正确的方式使用 VC 时，您在哪里划定界限，您什么时候开始研究更合适的解决方案？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-11T02:55:35.757

您可能不应该将“整个虚拟化构建系统”存储为巨大的二进制文件。如果要对应用程序进行版本控制，请对源代码进行版本控制，而不是编译后的二进制文件。

许多商店所做的是将重新创建构建服务器的*步骤存储在版本控制中。*然后，您需要一个固定映像（库存、开箱即用的操作系统安装），以及少量文件（在其上安装什么以及如何安装）。有些地方甚至让他们的服务器在每次部署/重新启动时，在干净的操作系统安装上从源代码重建应用程序。

将操作系统映像本身作为一个巨大的二进制文件进行版本控制几乎没有那么有用。你不能分支。你不能合并。你无法区分。重点是什么？如果您的 VCS 可以进行二进制差异，您可能会节省空间，但这可能需要大量的 CPU 和内存才能完成，如果它们处于“磁盘便宜”的狂热中，那么没有理由仅仅为了节省而让生活变得痛苦磁盘空间。

将安装脚本/库存储在 VC 中并根据需要重新构建 VM 映像，或者仅将 VM 映像存储在普通文件中。我认为将图像放入 VCS 没有任何意义。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-11T02:36:50.183

我想说这里有一个操作顺序：

如果他们需要存储文件，请使用文件系统。

如果他们需要跟踪更改，请使用版本控制。

如果他们需要跟踪与数据的关系，请使用数据库。

需求越复杂，解决方案就越复杂。但是纪律是为了那些想要更复杂的解决方案的人。在这些不确定的时期，必须避免浪费时间。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-11T16:34:42.150

我一直在版本控制中放置的内容：

*   源代码和生成文件：构建二进制文件所需的最低要求。
*   测试套件

我从未在版本控制中加入的内容：

*   构建的二进制文件：它们可以从源代码控制中重新创建，如果我知道我可能需要立即发布特定版本，我会以类似于 Linux 内核的方式将它们存储在文件系统中。

我根据项目进行版本控制的内容：

*   构建链：当我信任提供者或者我可以重新创建环境时（Apple 的 Xcode，开源工具，如 gcc 或 doxygen，......），我不会将其置于版本控制中。当它专门用于项目时（例如，自制的交叉编译链），以及当我需要重新创建一个二进制文件时，我将它放在版本控制中，因为它是为交付而构建的（用于在可能涉及任何组件时查找 heisenbugs，从到操作系统或编译器的代码）。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-11T06:46:02.283

对于一个相当极端的方法，请查看[Vesta](http://www.vestasys.org/)。

来自[艾伦·海顿、罗伊·莱文、蒂莫西·曼恩、袁宇。 *Vesta 软件配置管理方法*](ftp://gatekeeper.research.compaq.com/pub/DEC/SRC/research-reports/SRC-168.pdf)：

Vesta 方法基于以下基础：

*   所有资源和工具的不可变、不朽、版本化存储。与 ClearCASE 不同，Vesta 使用明确的版本号而不是视图。

*   完整的、基于源的配置描述。通过完整，我们的意思是描述命名了对构建有贡献的所有元素。计算环境的每个方面，包括工具、库、头文件和环境变量，都由 Vesta 完全描述和控制。基于源，我们的意思是配置描述指定如何仅使用不可变的源（即非派生文件）从头开始构建系统。描述本身是版本化和不可变的来源，它们的含义是不变的；即使在创建了新版本的源和描述之后，特定的顶级描述始终使用相同的源精确描述相同的构建。

*   自动派生文件管理。派生文件的存储和命名由 Vesta 存储库自动管理，从而减轻了构建多个版本或为多个目标平台构建的负担。

*   所有构建工作的站点范围缓存。Vesta 具有共享站点范围的构建结果缓存，因此开发人员可以从彼此的构建中受益。

*   自动依赖检测。Vesta builder 动态检测并记录所有依赖项，因此不会因人为错误而遗漏任何一个。动态地，我们的意思是构建器检测在构建构建结果的过程中实际使用了哪些源并仅记录对它们的依赖关系。Vesta 的依赖分析没有使用任何关于构建工具如何工作的知识；因此，在 Gunter [7] 的术语中，它是与语义无关的。例如，如果编译器在编译文件 foo.c 的过程中读取文件 foo.h，Vesta 将假定编译器的输出依赖于所有 foo.h，即使具有 C 知识的工具可能能够找到单个foo.h 中可以在不改变编译结果的情况下更改的项目。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-11T02:39:14.140

没有它就无法重新创建的版本控制。因此，工具链不能轻易地重新创建——版本控制是有意义的。使用版本控制下的工具链（和源代码），无需存档构建产品 - 或者至少在构建测试完成后不需要存档。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-11T05:04:28.970

应该指导您如何控制和配置您的工具链的常识，而不是 IT 的繁琐。如果您拥有标准硬件并且经常添加开发人员，那么将构建的工具链存储为图像是有意义的；但图像不必受版本控制。如果您有 50 名开发人员，则工具链的配置管理系统将减少开销；如果您有 5 个开发人员，则开销更大——另一个需要学习的系统。

那么，Git 是否妨碍了您想要做的事情？或者你收到请求是因为用户试图说你应该让你的系统更复杂，因为你可以？

如果您的构建工具已经成熟，那么构建日期可能足以确定所使用工具的版本。您可以让构建脚本轮询编写构建工具及其版本的文本文件，类似于依赖项列表。

如果您正在使用快速变化的内部工具，或者正在积极开发的项目的 alpha/beta 版本，那么将构建工具置于版本控制之下是一个很好的理由——但这将解决错误的问题。为什么要使用不稳定的工具链构建？？？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-11T02:39:03.673

我坚持存储构建最终产品所需的任何东西的经典答案。不需要二进制文件和中间文件，但包含构建中使用的任何脚本。

我使用我的 git 存储库作为备份，在至少两个地方存储裸克隆，所以我尽量不遗漏构建所需的任何东西，但我不费心存储任何临时的东西。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-16T21:30:59.977

我一直在为我的整个工具链使用源代码控制。如上所述，这有很大的好处：

*   每个人都使用相同的工具，所以我们永远不必担心不兼容。
*   构建机器生成与开发人员相同的工件。
*   我们总是可以在未来的任何时候重新创建任何工件，因为工具链是完全版本化的。

我在操作系统上方的某处画了一条线；我提交的一些内容是：

视窗

*   平台 SDK（现为[Windows SDK](http://msdn.microsoft.com/en-us/windows/bb980924.aspx)）
*   [Visual C++ Toolkit](http://blogs.msdn.com/brianjo/archive/2004/04/17/115335.aspx)，后来获得许可的 Visual C++，现在 Windows SDK 包括编译器。

Linux

*   海合会
*   制作
*   glibc

两个都

*   JDK

我在尝试这样做时遇到的一些问题是：

*   在 Linux 上，诸如[Perl](http://www.jaredoberhaus.com/tech_notes/2004/03/perl-and-relocating-its-installation.html)和 gcc 之类的东西将它们的安装目录嵌入到它们的可执行文件中。这意味着开发人员和构建机器可以运行一个签出后脚本，通过将路径插入二进制文件来更新这些脚本。
*   在任一平台上，您都有一个更长、更复杂的编译选项列表来指定每个头文件和库目录；这种事情在“正常”安装时是自动的。其中不明显的事情之一是`crti.o`and friends 是默认情况下找到的东西，`/usr/lib`实际上是由`glibc-devel`(or ) 拥有的，所以除非安装`libc6-dev`它，否则它不在文件系统中。`glibc-devel`
*   对于 Windows，2003 年之后的编译器都使用并行程序集，因此为了避免在目标机器上进行安装过程，我不得不将它们挖出来并将它们放在源代码控制中的编译器可执行文件旁边。
*   带有编译器（并且没有帮助/示例）的 Windows SDK v6.1 是巨大的：如果我算对的话，有 427MB。

我已经开始尝试使用[Apache Ivy](http://ant.apache.org/ivy/)（类似于[Maven](http://maven.apache.org/)）来帮助我管理工具链，但是我还没有看到任何使用 Ivy 或 Maven 来管理非 Java`.jar`文件的示例。我不知道我是否能够管理诸如 C 编译器之类的东西。

理想情况下，我希望源代码控制签出或 Ivy 或 Maven 解析以使开发人员的文件系统中的每个工具和库都可以使用。但我开始认为，要求开发人员安装少量关键的东西，如 Windows SDK 或`gcc`and`glibc-devel`包并不是一个坏主意。如上所述，这是一个 5 或 50 名开发人员的问题，以及创建这样一个解决方案所涉及的时间。

# django - 通过中间表从多个对象中获取 ManyToMany 对象

> ID：739394
> 
> 赞同：1
> 
> 时间：2009-04-11T02:28:10.593
> 
> 标签：django, django-models, django-templates

有没有一种简单的方法可以从返回多个对象的查询中获取 ManyToMany 对象？我现在这样做的方式并不像我想要的那样性感。在我看来，这是我现在的做法：

```
contacts = Contact.objects.all()
# Use Custom Manager Method to Fetch Each Contacts Phone Numbers
contacts = PhoneNumber.objects.inject(contacts) 
```

我的模型：

```
class PhoneNumber(models.Model):
    number = models.CharField()
    type = models.CharField()

    # My Custom Manager
    objects = PhoneNumberManager()

class Contact(models.Model):
    name = models.CharField()
    numbers = models.ManyToManyField(PhoneNumber, through='ContactPhoneNumbers')

class ContactPhoneNumbers(models.Model):
    number = models.ForeignKey(PhoneNumber)
    contact = models.ForeignKey(Contact)
    ext = models.CharField() 
```

我的客户经理：

```
class PhoneNumberManager(models.Manager):
    def inject(self, contacts):
        contact_ids = ','.join([str(item.id) for item in contacts])
        cursor = connection.cursor()

        cursor.execute("""
            SELECT l.contact_id, l.ext, p.number, p.type
            FROM svcontact_contactphonenumbers l, svcontact_phonenumber p
            WHERE p.id = l.number_id AND l.contact_id IN(%s)
            """ % contact_ids)

        result = {}
        for row in cursor.fetchall():
            id = str(row[0])
            if not id in result:
                result[id] = []

            result[id].append({
                 'ext': row[1],
                 'number': row[2],
                 'type': row[3]
            })

        for contact in contacts:
            id = str(contact.id)
            if id in result:
                contact.phonenumbers = result[id]

        return contacts 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T11:06:21.847

你可以做几件事来在这里找到性感:-)

Django 没有任何 OOTB 方式将直通表的属性注入到您的 Contact 实例中。带有额外数据的 M2M 表是一个 SQL 概念，因此 Django 不会尝试对抗关系，也不会猜测在命名空间冲突的情况下会发生什么，等等......。事实上，我什至会说您可能不想将任意模型属性注入到您的 Contact 对象中......如果您发现自己需要这样做，那么这可能是您应该修改模型定义的信号.

相反，Django 提供了方便的方法来无缝访问关系，无论是在查询中还是在数据检索中，同时保持实体的完整性。在这种情况下，您会发现您的`Contact`对象提供了一个`contactphonenumbers_set`可用于访问直通数据的属性：

```
>>> c = Contact.objects.get(id=1)
>>> c.contactphonenumbers_set.all()
# Would produce a list of ContactPhoneNumbers objects for that contact 
```

这意味着，在您的情况下，要迭代所有联系电话号码（例如），您将：

```
for contact in Contact.objects.all():
    for phone in contact.contactphonenumbers_set.all():
        print phone.number.number, phone.number.type, phone.ext 
```

如果你真的、真的、真的出于某种原因想要进行注入，你会看到你可以使用上面的 3 行代码示例来做到这一点：只需将打印语句更改为赋值语句。

* * *

另外，为了将来参考，您可以编写没有 SQL 语句的注入函数。在Django中，through表本身就是一个模型，所以可以直接查询：

```
def inject(self, contacts):
    contact_phone_numbers = ContactPhoneNumbers.objects.\
                            filter(contact__in=contacts)
    # And then do the result construction... 
    # - use contact_phone_number.number.phone to get the phone and ext
    # - use contact_phone_number.contact to get the contact instance 
```

# .net - 如何创建 Silverlight 3 主题？

> ID：739397
> 
> 赞同：3
> 
> 时间：2009-04-11T02:31:39.823
> 
> 标签：.net, silverlight, silverlight-3.0

新的 Silverlight 3 功能页面说：

*开发人员现在可以通过将样式应用到他们的 Silverlight 3 应用程序并在运行时更改它们来为应用程序设置主题。*

但我找不到有关此的任何信息。我想为可能的应用程序创建一个主题来定义按钮样式/等...

有人可以让我知道如何执行此操作或将我指向网络教程吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T18:43:56.420

你在 Mix09 网上看到 Karen Corby 的演讲了吗？

在她演讲的 43-44 分钟左右，她展示了使用 Silverlight 3 的动态造型，并且她的博客上有一些示例代码。

[Karen](http://videos.visitmix.com/MIX09/T16F)在[Mix 视频网站](http://videos.visitmix.com/MIX09)上的演讲。 [Karen 的博客](http://scorbs.com/)，其中包含示例代码和幻灯片

# c++ - 从 COBOL 转换到 C++

> ID：739398
> 
> 赞同：3
> 
> 时间：2009-04-11T02:33:11.800
> 
> 标签：c++, cobol

我是一名相当初级的程序员，我的任务是面试一位经验丰富的大型机 COBOL 程序员，以担任为 Windows Mobile 进行 C++ 开发的职位。我所说的经验丰富是指候选人的整个编程生涯都是 COBOL。

我对任何特定的语言没有偏见，只是有点担心我进行彻底采访的能力。

在面试中，没有 COBOL 经验的我如何才能很好地了解这位面试者的能力？

我应该询问或寻找任何具体的事情吗？

我已经阅读了很多关于 SO 的一般面试内容，考虑到候选人背景的性质，我寻找的任何具体内容都会有所帮助。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-11T03:49:13.397

如果这个人是一个优秀的程序员，他/她有其他语言的经验。（作为一个从 COBOL 甚至更糟糕的 RPG/II 开始的老屁说话。）即使这个人从未从事过其他任何工作。

以下是您可能会问的一些问题：

*   “你是怎么开始接触电脑的？”
*   “你会为了好玩而编程吗？”
*   “为什么要迁移到 C++ 环境？” （这是一个特别好的问题，因为现在实际上很难找到好的 COBOL 程序员。我敢打赌，这个人想学习新东西。）
*   “你做过汇编语言编程吗？” （如果他们对这台机器感到满意，他们会很快接受 C/C++ 的几率会大得多。）
*   “你能描述一下‘面向对象编程’是什么意思吗？” （关键：寻找“对象”是什么、“继承”和“多态性”的描述。如果可行，询问他们何时使用继承与聚合，即“是”关系与“具有”关系。）
*   “你家里有一台 Windows 电脑~~还是有一台真正的电脑~~？”

如果他们声称有任何 C++ 知识，那么一组非常好的筛选问题是：

*   *“C 中的声明*和*定义*有什么区别？”
*   “一个类中的‘私有’、‘受保护’和‘公共’声明有什么区别？”
*   “什么是‘朋友’？” （如果他们知道说“在 C++ 中只有你的朋友可以访问你的私人部分”，那就加分。）
*   “什么是虚拟成员函数？”
*   “什么是‘虚拟继承’？”

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-11T02:43:22.557

最好的事情是，给他一个任务，类似于他在你的公司必须做的事情。告诉他他可以使用伪代码（所以不需要互联网）。

此外，Cobol 的主要问题是掌握 OO（因为 Cobol 主要是程序性的......我知道新的 OO 版本）。

Cobol 人的另一个陷阱是掌握范围概念，作为传统的 Cobol，每个变量从他所在的应用程序的开始到底部都存在。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-01-25T08:13:04.510

确保他们了解并理解结构/类、类型、多态性、模板、函数以及最重要的指针。确保他们理解语法。例如，他们将如何声明一个指向带有两个整数参数的 void 函数的指针？他们将如何解决最棘手的解析？初始化列表如何优化代码？他们熟悉标准模板库吗？他们可以手工编写原始链表或向量数组吗？这些东西是你想要一个能够编写高效和干净代码的程序员的东西。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T02:42:52.573

弄清楚被采访者在 C++ 方面有多好不是更重要吗，如果那是他应该做的事情吗？

# windows - cmd上的matlab（winxp）

> ID：739409
> 
> 赞同：5
> 
> 时间：2009-04-11T02:40:10.427
> 
> 标签：windows, command-line, cmd, matlab

我刚开始用 Matlab 做一些实验，因为我习惯了 Vim 的界面，所以我尽量远离 Matlab 的编辑器。困扰我的是每次我启动一个 .m 文件时，它都会调出界面。

有没有办法从 cmd 行启动 test.m，并让它在 cmd 上输出，就像在 Matlab 环境中通常那样。类似“Matlab shell”的东西（像 Python 的，只有 Matlab 的）？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-13T18:39:16.577

要回答您的问题，请像这样启动 matlab：

`matalb -nodesktop -nosplash`

这确实适用于linux和windows。在 linux 上，您在命令提示符下键入此命令，matlab 将以文本模式在同一命令窗口中运行。所以你会得到你想要的“matlab shell”。在 Windows 上，cd 进入安装 matlab 的目录，然后键入相同的命令。它将打开一个精简的 matlab 命令行窗口，没有 matlab 桌面的所有花里胡哨。

现在在我个人看来，带有集成调试器的 matlab 编辑器是你的朋友。如果有帮助，它还具有 emacs 键绑定。当 matlab 在文本模式下运行时，在 matlab 桌面中执行命令和查看结果也更容易。您真正想要使用文本模式的唯一一次是您的 matlab 代码需要很长时间才能运行，并且您只对最终结果感兴趣。或者，如果您正在运行多个 matlab 实例。文本模式占用的内存要少得多，在 linux 上，您可以轻松地从命令行开始运行并将其置于后台。

事实上，检查 matlab 的命令行参数。你可以做其他有趣的事情，比如让 matlab 执行一个函数并退出，一个 la perl，或者像这样将脚本重定向到 matlab：`matlab < script.m`

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-12T21:25:43.067

你真的愿意在没有 m 文件调试器的情况下进行开发工作吗？在我看来，这会将您限制在实际上微不足道的程序中。经过非常简短的学习曲线后，我认为您会发现 Matlab 集成调试器非常棒（而且我是 VS 人）。

如果您坚持这样做，您最好的选择是将您的 m 文件编译为可独立运行。这将需要访问（不便宜的）[matlab 编译器](http://www.mathworks.com/products/compiler/)。

请注意，使用最高 6.5 版的 matlab 分发的编译器与使用 matlab 7+ 分发的编译器之间存在显着差异（不知道编译器版本号）。在 6.5 中，编译器生成 c 代码，可以单独编辑和编译。从 7 开始，编译器不再为此进行编译、转换或任何代码生成：今天运行“编译”程序实际上是在称为[MCR](http://www.mathworks.com/access/helpdesk/help/toolbox/compiler/br2jauc-31.html)的虚拟 Matlab 机器上运行它——它几乎包含所有 matlab 功能。这是一个巨大的 - MCR 安装程序（安装程序！）我上次检查时重达 130M。
在新闻组上仍然可以找到一些关于此的辩论，但现在这并不重要。事实上，MCR 方法似乎更接近您所寻求的。

顺便说一句，对我来说，`matlab -nosplash -nodesktop`在 Windows 上完美运行 - 它作为控制台启动 matlab，但这会剥夺你的文本编辑器*和*调试器......

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-12T21:37:26.487

我会做的是：

1.  启动 MATLAB
2.  *不要*在 matlab 中打开 .m 文件
3.  在您选择的编辑器中打开文件
4.  像往常一样在 MATLAB 中运行函数

我无法想象这不起作用的任何原因，因为 MATLAB 不应该关心用于编辑文件的内容。

这不会给你一个“shell”，而是整个 GUI，但我想不出你为什么不想拥有它，如果它可用的话。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-11T03:44:36.603

在 Linux 环境下，Matlab 可以文本模式启动

```
matlab -nosplash -nodesktop 
```

~~但这在 Windows 上不起作用。~~在当前 shell 中启动它。在 Windows 上，这会打开一个新的纯文本窗口。我知道没有办法让它在 Windows 上的当前控制台中运行。

也许您可以通过某种方式附加到它在 http://www.mathworks.com/access/helpdesk/help/techdoc/index.html?/access/helpdesk/help/techdoc/ref/matlabwindows.shtml&http:/ 中运行它/www.google.com/search?rlz=1C1GGLS_enUS302US311&sourceid=chrome&ie=UTF-8&q=matlab+command+line+windows'>自动化服务器模式。

如果您真的很绝望，另一种选择可能是制作一个虚拟机并在其中安装 linux。然后我想有一些方法可以配置 vim 以很好地与 Matlab 一起工作（这些天我是一个 emacs 人，并且有 emacs 的解决方案）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-10T07:33:55.210

我和Kigurai有同样的问题。我需要用 Python 驱动 Matlab，所以我找到了这个解决方案：

在 Python 中：

```
import os

os.chdir('W:\\monrépertoire')

os.spawnl(os.P_NOWAIT, 'monscript.bat') 
```

在 monscript.bat 中：

```
matlab.exe -r interp_3D  -nodesktop –nosplash 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-06-01T03:52:30.867

在某些情况下，确实不需要太多调试，并且在调用之间应保留 Matlab 的状态。一个（唯一的？）示例是 Emacs [org-mode](http://orgmode.org)。它可用于根据[文学编程等](http://orgmode.org/worg/org-contrib/babel/intro.html)编写与代码交错的文本。虽然可以在 Matlab 中使用注释并[发布](http://www.mathworks.com/help/techdoc/matlab_env/f6-30186.html)HTML 或 LaTeX 代码，但它确实需要离开 Emacs 的舒适性。

有一个[独立程序可用](http://www.cs.umb.edu/~ram/matlabShell/index.html)，它使用 Matlab 引擎来评估在标准输入上接收到的命令，并转储结果。然而，这个特定版本缺乏对 if/else/end 或 for/end 等多行命令的支持。这是[engEvalString](http://www.mathworks.com/help/techdoc/apiref/engevalstring.html)的一个限制，它需要一次完成所有操作。有一个[丑陋的解决方法可以](https://github.com/mlt/matlabShell)使它对 org-mode 足够[可用。](http://emacswiki.org/emacs/MatlabMode#toc3)

```
#+begin_src matlab :session *MATLAB* :exports none :cache no :results value
if 3>1
 'wow!!!'
end
#+end_src

#+RESULTS:
: wow!!! 
```

# jquery - 如何使用 JQuery 解决 livequery 的问题

> ID：739416
> 
> 赞同：0
> 
> 时间：2009-04-11T02:52:16.933
> 
> 标签：jquery

我动态加载 HTML 元素.. 并使用 livequery() 插件来处理点击事件.. 但只能点击第一个元素。

这是我最初的 DOM：

```
<div id="styleList">
    <h4 class="subPaneTitle blurred">List of themes</h4>
    <ul>
        <li class="listHeader">
            <span class="themeID">Theme ID</span><span class="themeName">Theme Name</span>
            <span class="themeAction">Action</span>
        </li>
    </ul>
    <p class="createNewStyle clearfix"><a id="createNewStyle" class="btnStyle1 blurred ui-corner-all">Create new theme</a></p>
</div> 
```

这是我从 xml 动态加载元素的代码：

```
$.get("http://localhost/ShopNGo_Blitz_revised_w_YAML/site_styles_list.xml", loadAllThemes);
function loadAllThemes(data) {
    $(data).find("style").each(function () {
        var thisStyle = $(this);
        var styleID = thisStyle.attr('id');
        var styleName = thisStyle.attr('name');
        var styleStatus = "";
        if (thisStyle.attr('status') == "used") {
            styleStatus = '<span class="statusIndicator">Current theme</span>';
        }
        $("#styleList ul").append('<li><span class="themeID">' + styleID + '</span><span class="themeName">' + styleName + '</span><span class="themeAction"><a id="themePreview">Preview</a></span><span class="themeAction"><a id="themeEdit">Edit</a></span><span class="themeAction"><a id="themeDelete">Delete</a></span><span class="themeAction"><a id="themeUse">Use</a></span>' + styleStatus + '</li>');
    });
} 
```

这是我的“编辑”点击事件代码：

```
$("div#styleList").find("ul").find("li").find("a#themeEdit").livequery("click", function () { //this gets only the first element.
    var themeName = $(this).parent().prev().prev(".themeName").text();
    $("#siteStyleContent").tabs("select", "#styleEditTabs");
    $("div#styleEditTabs").children("#themeName").text(themeName);
}); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T02:59:27.010

您将 ID 用作类。查看所有这些问题，了解为什么这是一件坏事：

*   [CSS：class 和 id 可以互换吗？](https://stackoverflow.com/questions/671954/css-are-class-and-id-interchangeable)
*   [级联样式表使用“id”或“class”</a>](https://stackoverflow.com/questions/670820/cascading-style-sheets-use-id-or-class)
[](https://stackoverflow.com/questions/670820/cascading-style-sheets-use-id-or-class)
*   [CSS：div id VS。div 类](https://stackoverflow.com/questions/544010/css-div-id-vs-div-class)
*   [div 类与 id](https://stackoverflow.com/questions/84378/div-class-vs-id)
*   [关于 ID 和 Class 的 CSS 最佳实践？](https://stackoverflow.com/questions/298607/css-best-practice-about-id-and-class)

本质上，ID 应该是唯一的。当您有一组东西（例如，编辑链接）时，将它们分组的正确方法是使用一个类。当您搜索`#themeEdit`jQuery 时，会假设只有一个并返回第一个，因为它应该是这样的。您需要给链接一个*类*`themeEdit`并搜索它们为`.themeEdit`.

此外，jQuery 1.3 具有[`live`](http://docs.jquery.com/Events/live)内置的功能，所以如果您正在使用它，真的没有必要去插件做这样的事情。

# java - 我可以在 OS X 中进行 Java 6 开发吗？

> ID：739418
> 
> 赞同：7
> 
> 时间：2009-04-11T02:59:03.530
> 
> 标签：java, macos

我知道当 Leopard 出现时，每个人（好吧，每个人都是 Java 开发人员并且足够关心在 Mac 上进行开发）对没有 Java 6 SDK 支持感到愤怒。我知道在 Leopard 发布几个月后有人提供了某种破解方式，但我可以发誓我后来读到 Apple 和/或 Sun 终于推出了 Java 6 SDK 的正式版本。

所以现在一年半之后，我终于有兴趣在 Mac 上做一些 Java 开发（感谢 Google App Kit）。但是当我访问 Apple 的 Java 站点时……我看到的都是关于 Java 5 的内容。

那么，我可以在 Mac 上做 Java 6 吗？

**另请参阅**：[在 Mac OS 上安装 Java 6](https://stackoverflow.com/questions/607945)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-11T03:04:54.767

是的，JDK6 可用，而且非常好，例如它支持 DTrace，否则只能在 Solaris 上使用。

主要缺点是 Apple 在弃用旧硬件（和操作系统版本）方面非常激进。Java6 永远不会在 10.5 之前的 Mac 版本中发布，并且仅适用于 64 位 Intel。这也会扼杀原生 32 位库，例如 Eclipse 使用的 SWT/Carbon（他们现在需要迁移到 Cocoa）。

*更新：* Snow Leopard[显然也有用于 32 位 Intel 的 Java6](https://superuser.com/questions/31526/does-snow-leopard-provide-java-6-for-32-bit-machines)（除了 64 位）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-11T03:20:32.403

[http://developer.apple.com/java/](http://developer.apple.com/java/)（仅适用于 64 位 Mac）

[http://landonf.bikemonkey.org/static/soylatte/（SoyLatte](http://landonf.bikemonkey.org/static/soylatte/)，一个单独的 Java 6 端口）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-11T03:00:53.900

是的，JDK6 可用。

但是，某些版本的 Eclipse 不支持它。有一个新的（基于 Cocoa）应该但它不是正式可用的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-11T03:15:20.777

你可以，但你必须对苹果非常警惕。[Sun 于 2006 年 12 月发布了 JDK 6](http://www.theserverside.com/news/thread.tss?thread_id=43434)。[一年后](http://www.artima.com/weblogs/viewpost.jsp?thread=229789)，Apple 发布了用于 MacOS X 的 Java 6 。

为什么延迟？似乎集成新的外观是答案，但我们没有官方理由。

现在，如果当时 Java 6 对您很重要，那将是（并且曾经是）一件大事。

正如其他答案所提到的，对某些硬件和库的支持也可能存在问题。

Windows 和 Linux（恕我直言）仍然是首选的 Java 开发平台。但是，如果它变得至关重要，您总是可以在 Mac 上的 VM 中进行 Java 开发。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-11T03:20:40.343

部分地。几个月前，Apple 发布了其 Java SDK 6 版本。但是在 Sun 的 Java SDK 6 中仍有一些 Apple 的 SDK 6 不可用的功能。我不知道为什么会这样。

例如，在Unisys 的GIF 格式专利到期后，Java 在SDK6 中包含了以GIF 格式编写图像文件的功能。然而，您仍然不能在 Apple 的 SDK 上编写 GIF 文件。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-11T03:00:38.347

[http://developer.apple.com/java/](http://developer.apple.com/java/)

看起来你可以。

# c# - 如何在 wpf 中隐藏和显示内容？

> ID：739419
> 
> 赞同：0
> 
> 时间：2009-04-11T02:59:20.723
> 
> 标签：c#, wpf

假设我有两个容器：

```
<StackPanel>
  <Label>First</Label>
</StackPanel>
<StackPanel>
  <Label>Second</Label>
</StackPanel> 
```

我绑定到这个对象：

```
public class Model 
{
  public bool ShowFirst { get; set; }
  public bool ShowSecond { get; set; }
} 
```

我将如何设置绑定以显示和隐藏相应的面板？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-11T03:18:35.997

绑定可见性属性。您将需要使用 BooleanToVisibilityConverter。

```
<!-- in the Resources section -->
<BooleanToVisibilityConverter x:Key="bvc" />

<!-- then -->
<Label Visibility="{Binding ShowFirst, Converter={StaticResource bvc}}">First</Label> 
```

这假设 DataContext 是模型；否则，您还需要在 Binding 上指定源。

顺便说一句，这可能只是因为您已经缩写了模型代码，但是如果您想动态显示和隐藏，您的模型将需要实现 INotifyPropertyChanged。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T03:19:44.107

您可以使用[事件触发器](http://msdn.microsoft.com/en-us/library/system.windows.eventtrigger.sourcename.aspx)。

# postgresql - PostgreSQL：约束，仅当列存在于另一个表中时才在列中插入值

> ID：739426
> 
> 赞同：2
> 
> 时间：2009-04-11T03:01:49.423
> 
> 标签：postgresql

我想向我的表 student 添加一个约束，以便在其专业列中输入的任何值也必须存在于专业表中。我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-11T03:06:57.943

这是一个外键约束。

```
ALTER TABLE student 
 ADD CONSTRAINT somename 
 FOREIGN KEY (major_id) REFERENCES major (id); 
```

请注意，如果 student.major_id 可以为空，则该列的值仍然可以为空。

另请注意，您的桌子不适合双专业。为此，我们有一个 student_major 表，它是学生和专业之间的多对多关系。这也演示了在 create table 中而不是在 alter table 中创建外键

```
create table student_major (
 id serial not null unique primary key,           -- optional, but good idea
 student_id int not null references student(id),  -- fk 
 major_id int not null references major(id),      -- fk
 UNIQUE (student_id, major_id)                    -- no redundant relations
); 
```

评论：

> -1 用于拒绝复合键。——比尔·卡尔文

所以让我理解这一点。比尔同意我正确回答了 OP 关于约束的问题。他同意我正确地看到了 OP 没有问的问题，可能是双专业。但是比尔仍然认为这个答案是错误的，因为比尔和我在复合键上存在分歧。

我什至没有说合成 id 是*必要*的；确实，我特别说这是*可选*的，但在我看来是个好主意。（为什么？它在删除、可能引用 student_majors 的表以及 ORMS 和生成的代码方面“表现得更好”。）

比尔，坦率地说，这是小事。您在详细说明（学生：专业是 M:M 而不是 M:1）的详细说明（复合/综合）以及什么是“宗教”战争上标记了正确答案。您是否因为不同意回答者对制表符*与*空格或 vi*与*emacs 的立场而标记正确答案？也许您应该花时间给出自己的答案，而不是记下正确的答案。

# asp.net - 如何像 VS2008 那样使用 msbuild 构建 ASP.NET 网站？

> ID：739427
> 
> 赞同：0
> 
> 时间：2009-04-11T03:03:33.707
> 
> 标签：asp.net, msbuild

对于 VS2008 中的网站（没有 .csproj 文件的网站），构建会进行一种验证，其中网站被“编译”到无处，网站依赖项被复制到网站的 Bin 目录中。

我想做这个确切的过程，但在命令行使用 msbuild。也就是说，我想要一个我的 msbuild 目标可以执行的 msbuild 任务，它可以验证网站，报告任何编译错误并将依赖项复制到 Bin，但*不需要*IIS 虚拟目录，也不需要将所有 aspx 和其他文件预编译到Bin 目录中的 DLL。

AspNetCompiler 任务似乎进行了完整的预编译，创建了一个充满已编译 aspx 页面的目录。它需要一个 IIS 虚拟目录。所以我不认为这个任务对我有用。

如何才能做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T03:13:09.737

您是否检查过 VS [Web 部署项目](http://weblogs.asp.net/scottgu/archive/2008/01/28/vs-2008-web-deployment-project-support-released.aspx) 。另外，如果您担心，请查看[aspnet_merge工具](http://msdn.microsoft.com/en-us/library/bb397866.aspx)

> AspNetCompiler 任务似乎进行了完整的预编译，创建了一个充满已编译 aspx 页面的目录。

而且我认为 aspnet_compile 不需要 IIS 虚拟目录

# multithreading - 关于在几个 CPU 机器中具有多个线程的应用程序的问题

> ID：739437
> 
> 赞同：2
> 
> 时间：2009-04-11T03:09:21.480
> 
> 标签：multithreading

给定一台具有 1 个 CPU 和大量 RAM 的机器。除了其他类型的应用程序（Web 服务器等）之外，还有 2 个其他服务器应用程序在该机器上运行，执行完全相同的处理，尽管一个使用 10 个线程，其他用户使用 1 个线程。假设每个请求的处理逻辑是 100% 受 CPU 限制的，并且通常需要不超过 2 秒才能完成。问题是，就每分钟处理的事务而言，谁的吞吐量可能更好？为什么？

注意，以上不是真实环境，我只是为了把问题说清楚，编造数据。我目前的想法是应该没有区别，因为这些应用程序是 100% 受 CPU 限制的，因此如果机器可以为第二个应用程序每分钟处理 30 个请求，它也将能够为每个应用程序每分钟处理 3 个请求第一个应用程序的 10 个线程。但我很高兴被证明是错误的，因为机器中运行着其他应用程序，并且一个应用程序可能并不总是获得 100% 的 CPU 时间。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T03:22:16.767

任务切换总是有一些开销，所以如果线程没有阻塞任何东西，那么更少的线程通常会更好。此外，如果线程没有执行相同的代码部分，则每次切换时都会刷新缓存。

另一方面，差异可能无法衡量。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T03:18:22.737

调度开销可能会使具有 10 个线程的应用程序比具有 1 个线程的应用程序慢。除非您创建测试，否则您将无法确定。

有关多线程的一些背景信息，请参见[http://en.wikipedia.org/wiki/Thread_(computer_science)](http://en.wikipedia.org/wiki/Thread_(computer_science))

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T03:18:24.453

这很可能取决于操作系统调度程序。例如，在单线程时代，调度程​​序只知道进程，并且有诸如“niceness”之类的措施来确定要分配多少。

在多线程代码中，如果另一个进程只有一个线程，则可能有一种方式，即一个拥有 100 个线程的进程无法获得 99% 的 CPU 时间。另一方面，如果您只有两个进程，其中一个是多线程的，我怀疑操作系统可能会给它更多的总时间。然而，AFAIK 没有什么是真正保证的。

同一进程中线程之间的切换成本可能比进程之间的切换成本更低（例如，由于缓存行为）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-13T20:34:49.593

有趣的问题。

我写了一个示例程序来做这件事。它有一个类可以执行一些处理器密集型工作，然后返回。我指定了我想运行的线程总数，以及我希望工作运行的总次数。然后，程序将在所有线程之间平均分配工作（如果只有一个线程，它就会全部完成）并启动它们。

我在单个 proc VM 上运行它，因为我可以找到一台只有 1 个处理器的真实计算机。

独立运行：

```
1 Thread    5000 Work Units - 50.4365sec
10 Threads  5000 Work Units - 49.7762sec 
```

这似乎表明，在单进程 PC 上，有许多线程正在执行处理器密集型工作，Windows 足够聪明，不会快速切换它们，它们需要大约相同的时间。

一起跑（或者尽可能接近同时推入）：

```
1 Thread    5000 Work Units - 99.5112sec
10 Threads  5000 Work Units - 56.8777sec 
```

这是问题的实质。当您运行 10 个线程 + 1 个线程时，它们似乎都被平等地安排了。这 10 个线程每个花费了 1/10 的时间（因为有第 11 个线程在运行），而另一个线程花费了几乎两倍的时间（实际上，它在前 56 秒内完成了 1/10 的工作，然后是另一个 9/在接下来的 43 秒内的第 10 秒......这是正确的）。

结果：Window 的调度程序在线程级别上是公平的，但在进程级别上不公平。如果您创建了很多线程，那么您可以让其他不够聪明的进程使大量线程变得高而干燥。或者只是做对了，我们有一个线程池:-)

如果您有兴趣自己尝试，可以找到我的代码： [http ://teeks99.com/ThreadWorkTest.zip](http://teeks99.com/ThreadWorkTest.zip)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-11T03:21:01.560

您必须考虑的一件事是交易另一端的等待时间。拥有多个线程将允许您在准备下一个事务的同时等待一个响应。至少我是这么理解的。所以我认为一些线程会比一个线程更好。

另一方面，您必须考虑处理多个线程所涉及的开销。申请的细节是这里考虑的重要部分。

# c++ - PS3 的 Cell 架构是不是学习游戏编程的错误平台？

> ID：739439
> 
> 赞同：6
> 
> 时间：2009-04-11T03:11:15.640
> 
> 标签：c++, ps3

我有机会参加索尼授权的培训课程，学习如何使用 PS3 的单元架构进行编程。

然而，我对 C++ 仅有基本的了解，并且想知道 PS3 对于像我这样有抱负的初学者游戏开发者来说是否有点矫枉过正。

还有什么是让我在大约 2 个月的时间内达到 C++ 图形编程水平的最佳资源？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-11T03:16:17.500

我敢打赌这会很有趣，而且你在课程中学到的任何东西都会帮助你成为一个更好的程序员。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-11T04:58:41.903

最后一个关于我日常工作的问题.... :)

你学到的很多关于 PS3 的知识将适用于其他架构，因为并行编程开始看起来像未来。PS3 上使用的许多并行技术直接适用于 Xbox 360。我怀疑未来的许多游戏机将朝着同一个方向发展，我们都需要开始更多地考虑并行化目前。

也就是说，如果您对 C++ 仅有基本的了解，那么很多材料可能会超出您的想象。我想这取决于你想从会议中得到什么。您是在寻找 PS3 的介绍，还是希望能够在会议结束后的第二天开始在 PS3 Linux 上制作游戏？

假设您负担得起，这些信息会很有趣并且可能会有所帮助。除非您觉得成本大于收益，否则我不会放弃这样的机会。（我假设有成本，我真的不知道。）

游戏编程资源遍布网络。如果你想参加 C++ 速成课程，我会选择 Lippman 等人的 C++ Primer。如果你想要一个图形速成课程，那么实时渲染是最好的起点，还有一本关于数学的好书，比如 Eric Lengyel 的 3D 游戏编程数学。还可以浏览一些 OpenGL 或 D3D 教程；即使两者都不常用在 PS3 上，其原理也与任何 API 相同。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-11T03:15:35.410

问题不在于 PS3 太过分了，而在于 Cell 处理器是出了名的难以编程以发挥其潜力。高度并行化的架构可能非常强大，但要真正获得这种性能并不容易。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-11T03:14:29.703

我认为这是一个为未来做准备的伟大架构（多核编程）。但是，对于大多数实际目的，您实际上最好学习基于 Windows 的游戏开发，因为使用控制台的启动成本要高得多。例如，开始为 DirectX 编码会容易得多。

所以，是的，在某些方面你是在找麻烦。如果您决定使用 PS3，请务必查看 MIT PS3 课程。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-11T03:14:56.770

不，一点也不，如果您使用.NET 作为您的主要语言，它只会变得更加困难。如果你想使用 .NET，我建议 XBOX 360 使用 C#/XNA。

**编辑：** 这是一个很好的链接，可以帮助您入门： http: [//www.cag.cs​​ail.mit.edu/ps3/](http://www.cag.csail.mit.edu/ps3/)

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-11T04:20:20.123

我认为，如果您有机会参加而不是什么都不做，那么您绝对应该去参加。从比你了解更多的人那里学到东西的回报是很多人没有的礼物。它来自有执照的培训师，这一事实使它更加值得。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-11T12:36:18.807

他在学习 PS3 架构、库、特殊技巧等时专门谈论学习 C++。我不建议这样做。你需要在你的 C++ 功夫上很强大才能在 PS3 上很好地编码，如果你出现并且甚至不知道这门语言，你就会出丑。

最糟糕的是，您将浪费专业开发人员的时间。他们实际上可以使用这些信息，但你会花时间处理你应该已经知道的新手问题。

我不是要刻薄；我也不会去，因为我不太了解 C++。试着体谅那些花钱去那里的人。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-16T23:19:16.907

在过去的几个月里，我一直在自学 Cell 处理器编程（用 C 语言）。这绝对不是最好的起点，因为成功编程 Cell 需要掌握很多技能：C/C++、pthreads、libspe、cell 上的各种通信类型（DMA、邮箱、信号、中断、原子 I/ ○）。为了使这更难，Cell 的文档可能是神秘的、难以找到的和错误的。如果您使用更通用的平台（XNA、pyGame、SDL），将会有更大的用户社区。这并不是说 Cell 没有任何用户社区，只是它更小。即使在其他环境中，人们可能会发现多处理器编程，但由于其独特的架构，很难将这些环境的技术翻译到单元中。还，

但这并不全是坏事。学习 PS3/Cell 会教你很多关于机器附近编程的知识。你真的别无选择，因为程序员可用的抽象并不多。Cell 上的每个 SPU 都有 256KB 的本地内存，如果您需要更多，那么您需要找出某种方案来发出正确的 DMA 请求，以便在正确的时间将正确的值带入内存，并且（希望如此）在 DMA 请求正在进行时让 SPU 忙于做某事。学习细胞

所以，也许不是最好的学习平台，但考虑到你有机会从索尼那里上课，这听起来是一个很好的机会。

无论如何，如果您有兴趣，[Scarpino 的书](https://rads.stackoverflow.com/amzn/click/com/0136008860)是一本很好的参考书，其中有几章关于使用 OGRE 引擎在单元上进行游戏编程，您可能也会感兴趣。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-11T03:48:29.607

虽然我没有在 360 或 PS3 上开发应用程序的经验，但我对这两个平台的各种优点进行了大量研究。我使用 C++ 已经很长时间了，尽管我已经用它构建了几个 MFC 和 BeOS 应用程序，但我已经用它构建了许多 UNIX 服务器应用程序，但控制台游戏环境仍然有很大不同。

正如其他人在这里所说，PS3 的 Cell 芯片确实是一头难以驯服的野兽，并且需要 Carmack 级别的才能才能正确使用。话虽如此，如果免费参加课程并没有错，尤其是如果您遇到以前开发过游戏并可以给您一些建议的人。

如果您想为控制台开发游戏，对于只有基本 C++ 知识的人来说，最好的选择是使用 Xbox 360 的基于 C# 的 XNA 套件。如果您熟悉 C++ 的工作方式，C# 不是t那么难拿起。事实上，我认为这比跳到基于单元的多核、多线程编程要小得多。如果您以前从未开发过内核级应用程序，那么在您准备好之前，您应该避开这类事情。两个月的时间还不够。

XNA 平台对有抱负的游戏机开发者来说非常有吸引力，其中最重要的一点是 C# 与 C++ 的相对安全性，以及 XNA 游戏可以通过 Microsoft 市场销售的事实。

我不知道有多少是单手开发的 PS3 游戏，但在 360 上有一些例子，例如 Braid，它们几乎是单独开发的。XNA 示例也非常有趣且具有教育意义。

# c# - 使用 C# 更新/保存到 SQL 数据库？

> ID：739441
> 
> 赞同：1
> 
> 时间：2009-04-11T03:12:57.493
> 
> 标签：c#, sql, sql-server, save

我无法在任何地方的谷歌上找到如何做到这一点。如何仅使用 C# 代码保存到 SQL DB？可能吗？使用向导创建数据库时默认的保存方法实际上并没有保存数据库：

```
this.Validate();
this.studentsBindingSource.EndEdit();
this.studentsTableAdapter.Update(this.studentsDataSet.FirstClass); 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T03:22:35.580

在我看来，好像你做得对。

您应该检查您的表适配器并验证是否分配了更新语句。如果您正在使用存储过程并且只分配了选择存储过程，那么它将是只读的（并且不会提示您更新/插入/删除存储过程）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T00:51:00.717

您的连接字符串可能是一些东西，具体取决于您配置为登录 SQL 的方式。

```
Data Source=ServerName;Initial Catalog=DatabaseName;User Id=myUsername;Password=myPassword; 
```

或者

```
Data Source=ServerName;Initial Catalog=DatabaseName;Integrated Security=SSPI; 
```

后者是如果您使用的是 Windows 身份验证；即使用与您登录Windows 相同的用户帐户。

DataSource 通常是您机器的名称，或者如果它位于您正在使用的同一台机器上，您可以使用（本地）来帮助您克服困难。

# java - AppEngine 开发服务器的数据查看器

> ID：739451
> 
> 赞同：9
> 
> 时间：2009-04-11T03:18:29.337
> 
> 标签：java, database, google-app-engine, testing

Google AppEngine[开发服务器](http://code.google.com/appengine/docs/java/tools/devserver.html)使用嵌入式数据库模拟 Google 的后端数据库。它会在您的本地磁盘上创建一个文件，您可以删除该文件以清除数据库。是否有允许浏览和编辑此数据的工具，类似于您为已部署的应用程序获得的数据查看器？

**澄清**：我问的是 Java 工具包，而不是 Python 工具包。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-05-03T19:52:17.750

最后，数据查看器附带 Google App Engine Java SDK 版本 1.2.2。它可以在以下位置访问：

[http://localhost:8080/_ah/admin](http://localhost:8080/_ah/admin)

或者

[http://localhost:8888/_ah/admin](http://localhost:8888/_ah/admin)

与 Python 版本相同的链接。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-01-08T06:58:52.587

在我的系统（我认为是 sdk 1.2.8）上，开发服务器在端口 8888 上运行。所以数据查看器位于[http://localhost:8888/_ah/admin](http://localhost:8888/_ah/admin)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T11:31:21.530

您可以在[http://localhost:8080/_ah/admin](http://localhost:8080/_ah/admin)找到它。看起来有点不同，但提供了相同的功能（除了[一些错误](http://code.google.com/p/googleappengine/issues/detail?id=502)）。

但是根据 OP 问题修正，这个答案不再相关。

# c# - 小数，整数，铸造......哦，我的！

> ID：739461
> 
> 赞同：3
> 
> 时间：2009-04-11T03:28:53.803
> 
> 标签：c#, .net, casting, integer, decimal

我正在阅读“Head First C#”一书，在其中一章中我创建了一个程序并使用声明为整数和小数的变量。Visual Studio 对我有好几次混合和匹配这两者的问题。例如：

```
dinnerParty.NumberOfPeople = (int) numericUpDown1.Value; 
```

NumberOfPeople 被声明为 int 并且显然数字 updowns 是小数。

此外，这本书在将它们加在一起时在一些数字之后加上了一个 M。例如：

```
public void SetHealthyOption(bool healthy)
{
    if (healthy)
    {
        CostOfBeveragesPerPerson = 5.00M;
    }
    else
    {
        CostOfBeveragesPerPerson = 20.00M;
    }
} 
```

CostOfBeveragesPerPerson 被声明为小数。

所以我有两个具体问题：

1）你怎么知道什么时候需要投射东西？我敢肯定有相当多的铸造...任何人都可以提供一些好的链接来了解铸造？

2) 数字后面的 M 有什么作用？

*编辑*

所以 M 表示该数字是小数而不是双精度数。为什么不将数字转换为小数，例如：（十进制）50.00？那个“功能”叫什么？如果我想看看有哪些“字母”可用，我会用谷歌搜索什么？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-11T03:32:51.640

1.  当两种类型之间存在精度损失时，通常需要显式转换。例如，如果您有一个 int 并将其分配给 long，则不需要强制转换，因为 long 可以保存 int 可以保存的所有值。但是，如果您将 long 分配给 int，则需要进行强制转换，因为 int 可以保存的值比 long can 少，这可能导致数据丢失。
2.  M 将数字定义为 Decimal 类型。如果您省略它，该数字将被解释为双精度数。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-11T03:59:35.600

```
Type    Suffix          Example
uint    U or u          100U
long    L or l          100L
ulong   UL or ul        100UL
float   F or f          123.45F
decimal M or m          123.45M 
```

There's a lot of pages that explain [C# numeric literals.](http://www.blackwasp.co.uk/CSharpNumericLiterals.aspx) The letter at the end is not a cast or any kind of function. It is syntax showing that what you are writing represents a value of a particular type. So writing (decimal) 5.0 uses a cast, but writing 5.0m does not.

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-11T03:40:29.563

1.  这是直接从 MSDN[投射](http://msdn.microsoft.com/en-us/library/ms173105(VS.80).aspx)的一个很好的链接。
2.  The M tells the compiler that the number is a `decimal`, otherwise it will assume it to be a `double`

# winforms - UserControl 怎么能自我毁灭呢？

> ID：739469
> 
> 赞同：7
> 
> 时间：2009-04-11T03:44:27.073
> 
> 标签：winforms

当用户单击窗口的某个部分时，我将 UserControl 添加到窗口的控件中。UserControl 有一个关闭按钮。我可以在 UserControl 的按钮处理程序中做什么来销毁 UserControl？似乎没有 .net 模拟 Win32 DestroyWindow 调用，并且没有用于控件的 Close() 方法。到目前为止，我有这个：

```
private void sbClose_Click(object sender, EventArgs e)
{
    Parent.Controls.Remove(this);
    this.Dispose();
} 
```

而且，如果父级需要销毁控件，步骤是什么？这是我到目前为止所拥有的：

```
 Controls.Remove(control);
    control.Dispose(); 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-11T04:32:51.857

您正在使用垃圾收集的托管代码环境中工作 -您无法**强制***销毁*用户控件。

所有你需要做的，你*所*能做的就是将它从父级中删除，并确保没有剩余的引用。

这通常就足够了：

```
private void sbClose_Click(object sender, EventArgs e)
{
    Parent.Controls.Remove(this);
} 
```

唯一需要更多的时候是将事件与事件联系在一起，因为您也需要注销这些事件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T04:48:23.707

控件不能自毁。就让父母这样做而言，您走在正确的轨道上。您可以让父控件或其他控件对其调用 Dispose 并删除对此控件的所有引用。以这种方式取消引用控件将允许 GC 清理内容。

# asp.net - ASP.NET 中的 Silverlight

> ID：739473
> 
> 赞同：1
> 
> 时间：2009-04-11T03:47:04.603
> 
> 标签：asp.net, silverlight

### 复制：

[如何从 ASP.NET 使用 Silverlight？](https://stackoverflow.com/questions/737705/how-do-i-use-silverlight-from-asp-net)

如何将一些 Silverlight 内容添加到已创建的 ASP.NET 网站？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T03:57:17.557

将新的 Silverlight 应用程序添加到您现有的解决方案中。这是一篇[MSDN 文章](http://msdn.microsoft.com/en-us/library/cc838260(VS.95).aspx)，展示了如何将其与现有网站集成，因此构建 Silverlight 应用程序会将 Silverlight 控件部署到 ASP.NET 网站的 Client_Bin 文件夹。

要将 Silverlight 控件添加到您网站中的网页，您可以引用自动为您创建的 Silverlight 测试页，或者您可以使用[ASP:Silverlight 控件](http://msdn.microsoft.com/en-us/library/cc838274(VS.95).aspx)，它将负责加载 Silverlight 对象。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T13:43:11.347

您只需将 XAP 文件复制到您的站点并引用它。

当您创建一个空白 SL 项目时，您将免费获得 ASp .net 站点的样板代码。

*   拥有启用 ASP .net 3.5 SP1 的站点，您可以使用 asp:Silverlight 控件：

*   没有任何 ASP .net 糖控制（您可以在 php 页面上使用它），您可以在 div 中使用 Object 实例：

Soirry 尝试粘贴代码示例，但效果不佳 :-(。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-01-20T02:15:35.483

从 Silverlight 3 开始，Microsoft 不建议使用 ASP:Silverlight 控件。

MSDN 上有一篇很棒的文章，介绍了如何使用`<object>`标签或使用 silverlight.js 库来包含 Silverlight：[Integrating Silverlight with a Web Page](http://msdn.microsoft.com/en-us/library/cc838145%28VS.95%29.aspx)。这帮助我消除了很多困惑。

这使得提供更适合您应用程序其余部分的定制化体验变得更加容易。

（还有一篇不错的文章解释了在将 Silverlight 控件嵌入您的页面后如何与它进行交互：[HTML Bridge: Interaction Between HTML and Managed Code](http://msdn.microsoft.com/en-us/library/cc645076%28VS.95%29.aspx)）

# string - 如何反转sed输出？

> ID：739477
> 
> 赞同：9
> 
> 时间：2009-04-11T03:52:35.510
> 
> 标签：string, unix, shell, sed

我正在阅读大约 500 个字符的行。我怎样才能得到 sed，而不是用某些东西替换该字符串，而是用某些东西替换该行的其余部分？简而言之，我想删除指定字符串周围的所有文本。用 awk 删除列是行不通的，因为在匹配的字符串之前和之后有不确定数量的字符。有任何想法吗？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-11T04:00:18.347

尝试使用反向引用：

```
sed 's/.*\(searchstring\).*/___\1___/' 
```

`.*`搜索字符串周围的 ' 将匹配除字符串之外的所有内容，括号告诉记住`sed`它匹配的内容。您可以使用 引用第一个匹配的字符串`\1`。

这是一个示例（替换除“bar baz”之外的所有内容）：

```
$ echo "foo bar baz qux" | sed 's/.*\(bar baz\).*/___\1___/'
___bar baz___ 
```

您可以在上面用您喜欢的任何模式替换“bar baz”；为简单起见，我只是使用了一个基本字符串。

# php - 是否有类似于 webrick 或 mongrel 的实时 apache/php 控制台，带有 ruby on rails？

> ID：739480
> 
> 赞同：0
> 
> 时间：2009-04-11T03:54:02.400
> 
> 标签：php, ruby-on-rails, apache, mongrel, webrick

是否有类似于 webrick 或 mongrel 的实时 apache/php 控制台，带有 ruby​​ on rails？

我希望能够监控我的服务器在做什么。

## 编辑：

但我不想grep日志

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T09:36:47.133

我相信[FirePHP](http://www.firephp.org/)可能与您所寻找的有点等价。

**简单示例：**

```
 <?php
 FB::log('Log message');
 FB::info('Info message');
 FB::warn('Warn message');
 FB::error('Error message');
 ?> 
```

[![替代文字](https://i.stack.imgur.com/t3fPf.png)](https://i.stack.imgur.com/t3fPf.png)
[（来源：[firephp.org](http://www.firephp.org/images/Screenshots/SimpleConsole.png)）]

[阅读更多](http://www.firephp.org/HQ/Use.htm)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-02-23T08:12:57.227

您可以在应用程序目录中使用以下命令：

```
mongrel_rails start -B 
```

这将在调试模式下启动它，并像 Webrick 一样为您提供所有请求。是的，包括所有那些“看跌”声明。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2010-05-04T12:57:35.210

总是有 gdb 和 strace/dtrace。还有 xdebug 模块，但它不是实时的。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2013-09-16T10:27:21.697

There is a really simple way: instead of monitoring the access.log apache2 file or the mongrel one, you can simple tail the production.log file and you will get the exact same behavior of webrick. So a solution is:

```
tail -f /your/project/path/log/production.log 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-05-24T01:13:28.307

[ApacheTop](http://www.howtogeek.com/howto/ubuntu/monitor-your-website-in-real-time-with-apachetop/)可能无法*完全*满足您的需求，但以防万一……尽管如此，您可能会发现它很有用 :) 它基本上类似于 UNIX top，但用于 Apache。

# visual-studio - 使用 C# 智能感知的 Visual Studio 语言服务

> ID：739483
> 
> 赞同：9
> 
> 时间：2009-04-11T03:55:12.710
> 
> 标签：visual-studio, plugins, intellisense, nhaml

去年我为 Visual Studio 编写了一个语言服务，它为 NHaml 文件添加了语法高亮：http: [//github.com/snappycode/hamleditor](http://github.com/snappycode/hamleditor)。

澄清一下，NHaml 是一种 html 模板语言，它可以像 aspx 文件一样混入代码元素。这个插件增加了对编辑 NHaml 文件的 IDE 的支持，但基本上只增加了语法高亮。

我想知道是否有人知道如何像现在在 aspx 文件中那样将内联 c# 智能感知添加到服务中。我希望不用自己为插件专门编写整个 c# 语法就可以做到这一点。

有没有人写过混合语言的语言服务？

更新：看起来火花视图引擎的家伙在这里取得了一些进展，我正在调查他们的实施

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-20T22:45:29.097

我检查了 Spark View Engine，他们似乎制作了一个通用的 ATL 东西（称为 SparkLanguagePackageLib），实际上似乎不包含任何 Spark 特定的东西。它似乎只是一个需要以下内容的通用 C# 智能感知库：

*   原始代码
*   从原始代码生成的 C# 源代码
*   两者之间的位置映射（例如，第 2 行 pos 5 上的代码在输出中映射到第 4 行 pos 10 等）
*   其他一些东西，比如绘画（？）

之后，您可以致电：

```
events.OnGenerated(
    primaryText, // original source code
    entry.SourceCode, // generated sourcecode
    cMappings, // mappings between the two
    ref mappings[0], // ?
    cPaints, // ?
    ref paints[0]); // ? 
```

我试图在该 C++ 库中找到特定于 Spark 的东西，但我找不到任何东西：所有与 spark 相关的东西都被拆分为一个单独的 C# 代码文件。我认为这很好，因为：

*   您不需要编辑 C++ 文件
*   如果安装了 spark 视图引擎的智能感知支持，它也可以被其他视图引擎使用
*   您只需要创建一个类，该类在原始 naml 文件和生成的 C# 对应文件之间进行映射。

顺便提一句。你还在研究这个 NHaml Intellisense 库吗？如果没有，我会尝试修补他们的实现，希望它可以轻松转换为 NHaml。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-17T02:28:38.777

这看起来可能会有所帮助

[http://www.codeproject.com/KB/recipes/VSLanguageService.aspx](http://www.codeproject.com/KB/recipes/VSLanguageService.aspx)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-02-08T02:39:56.643

我终于设法修改代码以支持 NHaml。一点也不难。不幸的是，原来的 NHaml 库不支持所需的一切，所以我不得不为 NHaml 创建一个新的解析器。它不支持所有的结构，但它支持大多数（足以使 NHaml 编程更容易）

下载：http: [//github.com/sztupy/nhamlsense](http://github.com/sztupy/nhamlsense)

[截屏： http](http://www.youtube.com/watch?v=8jTZ2zC9eYc) ://www.youtube.com/watch?v= 8jTZ2zC9eYc

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T20:50:10.267

您可以通过创建或修改 usertype.dat 文件轻松[添加关键字。](http://msdn.microsoft.com/en-us/library/zy61y8b8(VS.80).aspx)[在此处](http://codebetter.com/blogs/darrell.norton/archive/2004/04/21/11837.aspx)查看有关附加到特定文件扩展名的一些说明。这可能会让您至少部分完成，而无需重做完整的 c# 语法。

（事实上​​，在这种情况下，我不确定您所说的“语法突出显示”究竟是什么意思。我敢肯定，例如，您可以在编辑器中免费获得大括号匹配突出显示）。

# java - 使用 NetBeans 设置图像库

> ID：739484
> 
> 赞同：0
> 
> 时间：2009-04-11T03:56:50.677
> 
> 标签：java, netbeans, image, event-handling

我想在我的窗口上显示一组图像（带有相关文本）。我想使用上一个和下一个按钮遍历它们。到目前为止，我只能将图像与`JLabel`. =/

我该如何去做剩下的事情？我应该为整套使用不同的容器吗？我应该将图像加载到类似的数据结构上`ArrayList`，还是将它们保存在文件夹中就足够了？如何添加事件处理以便按下按钮显示下一个或上一个图像？

这是我到目前为止的[屏幕截图。](http://img19.imageshack.us/img19/3042/screenshotbyz.jpg)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2010-11-04T13:07:16.707

你还在吗 ？

我假设您已经找到了如何加载每个图像的路径（如果它们在同一个文件夹中）。您应该将目录的路径存储在全局变量中，然后将每个图像的名称存储到 Vector 中，如果您想遍历它们。只存储文件的名称，而不是整个图像。您还必须将当前图像的索引存储为全局变量。

如果您使用 JFrame 作为主窗口，则必须指定它以这种方式实现类 ActionListener：

```
public class MyClass extends JFrame implements ActionListener 
```

然后您必须将事件处理程序附加到您的按钮（JButton）。这必须放在窗口（MyClass）的构造函数中：

```
nextButton.addActionListener(this);
previousButton.addActionListener(this); 
```

实现 ActionListener 后，您的类必须定义方法 actionPerformed。在其中，您必须根据已按下的按钮更改图像的内容。

```
public void actionPerformed(ActionEvent e)
{
     Object o = e.getSource();
     if(o == nextButton)
     {
          currentIndex++;
          if(currentIndex == vectorImages.size())
          {
               currentIndex = 0;
          }
          //Change the image in the JLabel
          label.setIcon(new ImageIcon(vectorImages.get(currentIndex)));
     }
     else
     {
          //Iterate backwards
     }
} 
```

希望这可以帮助...

# python - Google App Engine：为有 SQL 背景的人介绍他们的 Data Store API？

> ID：739490
> 
> 赞同：7
> 
> 时间：2009-04-11T04:00:13.353
> 
> 标签：python, sql, google-app-engine, gql

除了 Google 提供的 Google App Engine 文档之外，有没有人有任何好的信息，这些文档为具有 MS SQL 背景的人提供了一个很好的概述，以移植他们的知识和有效地使用 Google App Engine Data Store API。

例如，如果您有一个自建的用户表和一个消息表

如果用户和消息之间存在关系（由 UserID 连接），那么这种结构将如何在 Google App Engine 中表示？

```
SELECT * FROM Users INNER JOIN Message ON Users.ID = Message.UserID 
```

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-11T04:08:26.343

这是一个很好的链接：使用 Google App Engine 进行一对多加入。

[http://blog.arbingersys.com/2008/04/google-app-engine-one-to-many-join.html](http://blog.arbingersys.com/2008/04/google-app-engine-one-to-many-join.html)

这是另一个很好的链接：Many to Many Join using Google App Engine：

[http://blog.arbingersys.com/2008/04/google-app-engine-many-to-many-join.html](http://blog.arbingersys.com/2008/04/google-app-engine-many-to-many-join.html)

这是关于上述两个链接的很好的讨论：

[http://groups.google.com/group/google-appengine/browse_thread/thread/e9464ceb131c726f/6aeae1e390038592?pli=1](http://groups.google.com/group/google-appengine/browse_thread/thread/e9464ceb131c726f/6aeae1e390038592?pli=1)

就我个人而言，我在讨论中发现此评论对 Google App Engine Data Store 非常有用：

[http://groups.google.com/group/google-appengine/msg/ee3bd373bd31e2c7](http://groups.google.com/group/google-appengine/msg/ee3bd373bd31e2c7)

> 在规模上，你最终会做很多看起来错误的事情，但这是我们正在运行的数字所要求的。去观看 eBay 的演讲。或者阅读有关 FaceBook 正在运行多少数据库实例的帖子。
> 
> 简单的事实是，我们在 uni 中学到的东西对于中小型企业应用程序的业务自动化应用程序非常有用，其中负载是可预测的，并且有足够的钱购买处理 50 个人数据负载所需的服务器进入帐户或业务计划和控制应用程序......

搜索了一下，发现了这篇 Google Doc 文章：

[http://code.google.com/appengine/articles/modeling.html](http://code.google.com/appengine/articles/modeling.html)

> App Engine 允许在数据存储实体之间创建易于使用的关系，这些关系可以代表现实世界的事物和想法。当您需要将任意数量的重复信息类型与单个实体相关联时，请使用 ReferenceProperty。当您需要允许许多不同的对象在彼此之间共享其他实例时，请使用键列表。您会发现这两种方法将为您提供创建出色应用程序背后的模型所需的大部分内容。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-05-19T21:59:07.617

我可以通过视频链接进一步补充上面的出色答案吗？

[http://sites.google.com/site/io/building-scalable-web-applications-with-google-app-engine](http://sites.google.com/site/io/building-scalable-web-applications-with-google-app-engine)

这是 Google 的 Brett Slatkin 的精彩演讲，他用一个小时的时间讲述了您需要以特殊方式思考您的应用程序，然后才能期望它能够很好地扩展。如果您来自关系背景，则有一些真正的 WTF（例如数据库查询中没有 count() ）会让您感到困惑。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-19T18:27:09.047

我认为这是基础知识：键和实体组在 appengine 文档中查找它。（我是新来的，所以不能发链接）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-15T03:18:42.947

虽然谷歌应用引擎是非常好的东西，但我已经研究过它，但不是专家，它是未来，因为它实现了平台即服务和软件即服务。Google 应用引擎提供了一个非关系型数据库。所以你不能在这里写关系。

问候， Gaurav J

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-02T11:07:57.697

这些链接很棒，但主要是 python 偏向，我使用 GWT，因此必须使用 GAE 的 java 风格，有没有人有任何示例说明如何在 GAE 的 Java 版本中实现这些“加入”等效性？

干杯，约翰

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2010-11-24T03:23:05.237

独立的 GAE SDK 很难用于将数据放入和检索 Google App Engine 数据存储中的数据。

“Objectify”是一个 GAE 扩展，使这些操作变得更加容易。Objectify wiki 和源代码可以在这里找到。我强烈建议在您的 GAE 项目中使用 Objectify。

[http://code.google.com/p/objectify-appengine/](http://code.google.com/p/objectify-appengine/)

这里有一些关于在应用引擎中使用 Objectify 的教程。遵循这些教程，您将立即存储和检索数据。

[http://www.fishbonecloud.com/2010/11/use-objectify-to-store-data-in-google.html](http://www.fishbonecloud.com/2010/11/use-objectify-to-store-data-in-google.html)

# java - JavaFX 绑定/循环问题

> ID：739492
> 
> 赞同：0
> 
> 时间：2009-04-11T04:01:14.270
> 
> 标签：java, javafx

好的，我正在学习 JavaFX with Passion 课程，但遇到了一个我似乎无法弄清楚的问题。

它类似于这个问题 -

[为什么这个“绑定”代码在 JavaFX 中不能按预期工作？](https://stackoverflow.com/questions/657486/why-doesnt-this-binding-code-work-as-expected-in-javafx)

```
def numbers = [1..10];
var currentNumber = 0;    

for (currentNumber in numbers){
var evenOrOdd = bind if (numbers[currentNumber] mod 2 == 0)
    "----{numbers[currentNumber]} is an even number"
    else "----{numbers[currentNumber]} is an odd number";
println("{evenOrOdd}");
} 
```

和我的输出 -

```
----2 is an even number
----3 is an odd number
----4 is an even number
----5 is an odd number
----6 is an even number
----7 is an odd number
----8 is an even number
----9 is an odd number
----10 is an even number
----0 is an even number 
```

我遇到的问题是它“看起来”运行正确，只是它没有将 1 显示为奇数，然后在 10 之后添加了一个 0。我花了一些时间逐步执行该程序，但似乎无法找出它是如何/为什么这样做的。

我可以让它在没有任何绑定的情况下运行良好，所以不确定这是否是导致我的问题的原因。

有什么想法/想法吗？

~艾伦

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T13:18:16.850

currentNumber 是 numbers 的元素之一，而不是索引

```
var evenOrOdd = bind if (currentNumber mod 2 == 0)
    "----{currentNumber} is an even number"
    else "----{currentNumber} is an odd number"; 
```

# refactoring - 如何重构链式方法？

> ID：739498
> 
> 赞同：3
> 
> 时间：2009-04-11T04:07:01.760
> 
> 标签：refactoring, fluent-interface

从此代码开始：

```
 new Person("ET").WithAge(88) 
```

如何将其重构为：

```
 new Person("ET", 88) 
```

需要执行哪些重构序列才能完成转换？

为什么？因为可能有数百个，我不想通过手动操作来引入错误。

你会说流畅接口的一个缺点是它们不容易被重构吗？

注意：我想自动执行此操作而无需手动输入代码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-11T04:14:32.647

也许最简单的重构方法是将名称“WithAge”更改为“InitAge”，设为`InitAge`私有，然后从您的构造函数中调用它。然后更新所有引用`new Person(string).WithAge(int)`以使用新的构造函数。

如果`WithAge`是单行代码，则可以将代码移至新的构造函数，并`InitAge`完全取消，除非使用附加方法提供额外的可读性。

拥有良好的单元测试将隔离引入错误的位置（如果有的话）。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-11T04:13:40.327

假设 WithAge 是一个返回 Person 的 Person 方法，那么类似

```
Person(string name, int age)
{
    this.name = name;
    this.WithAge(age);
} 
```

或更笼统地说：

```
Person(SomeType originalParameter, FluentParamType fluentParameter)
{
    //Original constructor stuff
    this.FluentMethod(fluentParameter);
} 
```

然后，如果您不想要 FluentMethod，则将其设为私有，或者如果您想同时允许两种方式，则将其公开。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-11T08:17:24.750

如果这是 C#（理想情况下你会用语言标记问题）， Person 类需要这个构造函数：

```
public Person(string name, int age)
    : this(name) { WithAge(age); } 
```

然后要更改所有客户端代码以在适当的情况下调用此新构造函数，您需要找到所有出现的模式：

```
new Person(x1).WithAge(x2) 
```

其中 x1 和 x2 是表达式，并将它们替换为：

```
new Person(x1, x2) 
```

如果除了 WithAge 之外还有其他修饰符方法，它可能会变得更加复杂。例如：

```
new Person(x1).WithHair(x2).WithAge(x3) 
```

也许你希望它变成：

```
new Person(x1, x3).WithHair(x2) 
```

这完全取决于您是否有一个 IDE，可以让您定义类似的语言感知搜索/替换模式。通过简单的文本搜索和替换，结合重放一系列按键的宏，您可以获得很长的解决方案。

> 你会说流畅接口的一个缺点是它们不容易被重构吗？

并非特别 - IDE 中的重构功能要么设计得足够灵活，让您创造性地发明新的重构，要么针对某些常见情况进行硬编码。我更愿意将常见案例定义为我可以变异以发明新案例的示例。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T08:01:21.900

我在这类事情上没有任何实际经验，但如果我遇到你的情况，我会去寻找[自定义 Eclipse 重构](http://www.eclipse.org/articles/article.php?file=Article-Unleashing-the-Power-of-Refactoring/index.html)（或 Refactor 中的等价物！Pro for .Net，如果你是这样的话使用）。

基本上你想要的是匹配和替换，除了你的正则表达式应该匹配抽象语法树而不是纯文本。这就是自动化重构。

这种重构的一个风险是目标版本不如原始版本精确。考虑：

```
类人{
  公共人员（字符串名称，整数年龄）；
  公共人员（字符串名称，int numberOfChildren）；
}

```

无法判断对 Person.WithAge 的链式调用应该替换为哪些构造函数。

因此，对此的自动支持必须在允许您继续之前检查此类歧义。如果已经存在带有目标参数的构造函数，则中止重构。

除此之外，它似乎很简单。给新的构造函数以下内容：

```
公共人员（字符串名称，整数年龄）{
  这个（名字）；
  与年龄（年龄）；
}

```

然后，您可以安全地用新调用替换原来的调用。

（还有一个微妙的额外风险，因为在构造函数中调用 withAge ，即在部分构造的对象上，与在构造函数之后调用它并不完全相同。如果你有一个继承链*并且*如果 withAge 做了一些事情，差异很重要不平凡。但这就是你的单元测试的目的......）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-11T04:11:13.640

1.  为旧代码编写单元测试。

2.  重构直到测试再次通过。

# vba - Excel 中的 VBA 无知需要：设置 Cell.RowHeight 将单元格值更改为 TRUE 或 FALSE？

> ID：739507
> 
> 赞同：0
> 
> 时间：2009-04-11T04:14:14.787
> 
> 标签：vba, excel

**编辑：**

**发生这种情况是因为单元格设置为按钮的 LinkedCell 属性。当我将其设置为 null 时，一切正常（当然，我使用的是该属性，但是很好）。**

通过 Google 找不到任何关于此的内容...

我有一个单元格，该单元格在相当窄的列中包含大量文本。我想要一个按钮，用于在按下单元格时展开/缩回单元格的高度（你知道，“显示”和“隐藏”）。问题是，每当我设置单元格的 RowHeight 属性时，单元格的值都会设置为 TRUE 或 FALSE。有人可以告诉我为什么会这样吗？

顺便说一句，我使用的是 Excel 2003。

```
Private Sub ToggleButton1_Click()
    new_caption = ToggleButton1.Caption
    Dim height As Integer
    If new_caption = "Show" Then
        new_caption = "Hide"
        height = 125
    Else
        new_caption = "Show"
        height = ToggleButton1.height
    End If
    ToggleButton1.Caption = new_caption
    Range(ToggleButton1.LinkedCell).RowHeight = height
End Sub 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T04:40:28.140

这对我来说很好，虽然我使用的是 Office XP 而不是 2003。你确定这是为那个按钮运行的代码（或唯一的代码）吗？

它正确设置了高度，但根本不改变单元格的内容。

我已经尝试将其作为由按键驱动的宏和工作表上的命令按钮，没有问题。

**更新：**

根据您声明您正在使用 LinkedCell 从按钮中查找单元格的编辑，我认为您没有正确使用它。LinkedCell 将单元格的值绑定到控件的值。

按下按钮时发生的情况是它的值被设置为布尔值（按下时可能为真，释放时可能为假，我不确定）。因为它链接到一个单元格，所以单元格值也将更改为按钮值。您需要找到一种不同的方式将按钮“链接”到单元格。

我的第一个想法是将它链接到单元格 B1，以便您的值在 A1、A2、A3、...（我们称它们为 Ax）中，并且您的控件按钮在（并链接到）Bx 中并且不使用 Bx其他任何东西（按钮可能会出现在它们上方）。

```
 `A               B
  +--------------------+--------+
1 | Long text which is | [Hide] |
  | wrapped because    |        |
  | the state is SHOW. |        |
  +--------------------+--------+
2 | More text which is | [Hide] |
  | wrapped because    |        |
  | the state is SHOW. |        |
  +--------------------+--------+
3 | Hidden text becaus | [Show] |
  +--------------------+--------+
4 | Even more text     | [Hide] |
  | that's wrapped     |        |
  | because the state  |        |
  | is SHOW.           |        |
  +--------------------+--------+` 
```

`然后在您的 VBA 代码中，您仍然可以设置 Bx 的行高（因为它会影响整行）并且您不会关心 B 列单元格中放置了什么 - A 列单元格的值将保持不变.`

 `或者，如果您*将*B 列用于某事，请将其链接到 ZZx（或 IVx 或任何最右边的列在一行中）。

# php - Wordpress：如何修复我的帖子类？

> ID：739523
> 
> 赞同：0
> 
> 时间：2009-04-11T04:28:33.537
> 
> 标签：php, html, wordpress

当 wordpress 调用 post 类时，我似乎有点搞砸了。我查看了“主索引模板”，但它只是说“ `<div <?php post_class() ?> id="post-<?php the_ID(); ?>">`”所以我不知道该怎么做。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T05:51:13.897

你的意思是id和类名没有在前端打印出来吗？

添加如下示例所示的回显，以便打印出 id 和 class。

```
<div <?php echo post_class() ?> id="post-<?php echo the_ID(); ?>"> 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T06:17:15.927

您需要提供更多信息，但如果由于您编辑文件而出现问题，那么我建议您从 www.wordpress.org 替换文件。

如果是主题文件，则替换主题。

# scheme - 为 Dr. Scheme 寻找简单的 Scheme 习语

> ID：739525
> 
> 赞同：2
> 
> 时间：2009-04-11T04:36:55.107
> 
> 标签：scheme, racket

我正在学习 SICP，同时使用 Ableson/Sussman 讲座和 Berkeley 61A 讲座，这比我的速度要快得多。我想做一些伯克利的作业，但需要句子的定义，butfirst，butlast 等等。看起来曾经有一种简单的方案语言内置于 Dr. Scheme，但最新的 4.1.5 版没有它。从[Planet PLT](http://coach.cs.uchicago.edu/package-source/dyoo/simply-scheme.plt/1/0/doc.txt) ，我想我可以在我的定义窗口中简单地添加 (require (planet "simply-scheme.ss" ("dyoo" "simply-scheme" 1 0)))。我明白了

```
require: PLaneT
could not find the requested package: Server had no matching package:
No package matched the specified criteria 
```

[我尝试从这里](http://www.cs.berkeley.edu/~bh/downloads/simply/simply.scm)抓取 simple.scm 文件 并将其粘贴到我的 Dr Scheme 定义窗口中，但它不起作用：

在高级学生模式下，我读到：非法使用“。”

对于以下代码中的 (lambda (string . args) 行。

```
(define whoops
  (let ((string? string?)
    (string-append string-append)
    (error error)
    (cons cons)
    (map map)
    (apply apply))
    (define (error-printform x)
      (if (string? x)
      (string-append "\"" x "\"")
      x))
    (lambda (string . args)
      (apply error (cons string (map error-printform args)))))) 
```

在 R5RS 中，我设置了！：无法改变模块所需的标识符：数字->字符串（以下代码的第 7 行）

```
(if (char=? #\+ (string-ref (number->string 1.0) 0))
    (let ((old-ns number->string)
      (char=? char=?)
      (string-ref string-ref)
      (substring substring)
      (string-length string-length))
      (set! number->string
        (lambda args
          (let ((result (apply old-ns args)))
        (if (char=? #\+ (string-ref result 0))
            (substring result 1 (string-length result))
            result)))))
    'no-problem) 
```

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-11T05:47:14.780

除非您遵循为其设计的示例，否则 Advanced Student 永远不会真正为您工作。大多数书籍和示例将假定[R ⁵ RS](http://www.schemers.org/Documents/Standards/R5RS/)或类似的东西。我建议使用 Pretty Big 语言，因为它包括 R ⁵ RS、PLT`require`语法和其他一些东西。

为了使用 PLaneT 的 Simply Scheme 包，您需要使用新的 require 语法（您可以在[包列表页面](http://coach.cs.uchicago.edu/display.ss?package=simply-scheme.plt&owner=dyoo)上找到它；看起来[包的文档](http://coach.cs.uchicago.edu/package-source/dyoo/simply-scheme.plt/1/2/doc.txt)还没有更新）：

```
(require (planet dyoo/simply-scheme:1:2/simply-scheme)) 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2011-08-26T23:43:19.567

跟进；可以在以下位置找到 Racket 的简单方案支持库： http://planet.plt-scheme.org/display.ss?package=simply-scheme.plt&owner= [dyoo](http://planet.plt-scheme.org/display.ss?package=simply-scheme.plt&owner=dyoo) 我在[http://planet 中做了一些简单的文档更新。 plt-scheme.org/package-source/dyoo/simply-scheme.plt/2/1/planet-docs/manual/index.html](http://planet.plt-scheme.org/package-source/dyoo/simply-scheme.plt/2/1/planet-docs/manual/index.html)。

# vb.net - 使用 System.Console.Write 禁用滚动

> ID：739526
> 
> 赞同：0
> 
> 时间：2009-04-11T04:38:32.030
> 
> 标签：vb.net, console

是否可以使用 Console.Write 将单个字符放在典型 80x25 控制台的右下角，而无需控制台向上滚动行？这是我正在使用的代码...

```
Imports System
Console.SetCursorPosition(Console.WindowWidth-1, Console.WindowHeight-1)
Console.Write("x") 
```

这不像我想要的那样工作。有什么建议或替代方案吗？我已经测试过 SetCursorPosition 确实使用了 0,0 坐标系。使用 WindowWidth-1/Height-1 应该把我放在屏幕的右下角......确实如此，但随后 Console.Write 将“x”放下并继续到下一行。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-11T15:15:32.467

您可以尝试移动缓冲区。例如：

```
Console.WriteLine("Top")
Console.SetCursorPosition(Console.WindowWidth - 1, Console.WindowHeight - 1)
Console.Write("x")
Console.MoveBufferArea(0, 0, 80, 25, 0, 1)
Console.ReadLine() 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T04:59:36.940

问题是，每当您写入特定行中的最后一个位置时，控制台总是将您移动到下一行。您可以做的最接近的事情是写入倒数第二个位置：

```
 Console.CursorLeft = Console.WindowWidth - 1;
        Console.Write("X"); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-22T18:40:34.357

我以一种肮脏但实用的方式解决了它。

```
Console.SetCursorPosition(79, 24); //last pos
Console.BufferWidth++;
Console.Write("x");
Console.BufferWidth--;
Console.ReadKey(); 
```

盒子的侧面确实闪烁了一毫秒，但我认为没有人会注意到:)

# google-app-engine - 从 MSI 安装 Google App Engine 时出现问题

> ID：739527
> 
> 赞同：1
> 
> 时间：2009-04-11T04:39:56.830
> 
> 标签：google-app-engine

我下载了 Python 并安装了它，当我去下载 GoogleAppEngine_1.2.0.msi 并尝试安装它时，我收到了这个错误：

> 无法打开此安装包。请与应用程序供应商联系以验证这是否是有效的 Windows Installer 程序包。

我是不是忘记了什么？我假设这很简单。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T07:55:15.830

再次下载并尝试安装新下载的文件。也许文件在下载过程中被损坏或没有完全下载，有时这两种情况都会发生。

如果这没有帮助并且出现相同的错误消息，您可以控制应该是的校验和

5ea87b8ed3011a5f55a9135c96abe96b6a6fd48b

对于这个文件。

当您确定下载的文件没问题时，请检查您的操作系统版本是否受支持。

也许安装 Windows 安装程序会有所帮助？

[http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=5a58b56f-60b6-4412-95b9-54d056d6f9f4](http://www.microsoft.com/downloads/details.aspx?displaylang=en&FamilyID=5a58b56f-60b6-4412-95b9-54d056d6f9f4)

如果没有，请在另一台机器上或在虚拟机内尝试。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-07T18:24:10.320

我有同样的错误。IE下载的文件大约190k，无法运行。该文件应该是2.7M。Firefox 正确下载。如果您选择 RUN 而不是 SAVE，IE 也将正确下载。这是我的经验，我现在已经安装了 SDK。我希望这可以帮助你。

# java - BigDecimal 的对数

> ID：739532
> 
> 赞同：48
> 
> 时间：2009-04-11T04:47:38.357
> 
> 标签：java, bigdecimal, logarithm

如何计算 BigDecimal 的对数？有谁知道我可以使用的任何算法？

到目前为止，我的谷歌搜索已经提出了一个（无用的）想法，即转换为双精度并使用 Math.log。

我将提供所需答案的准确性。

编辑：任何基地都可以。如果在 base x 中更容易，我会这样做。

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-04-14T01:18:23.077

[Java Number Cruncher：Java Programmer's Guide to Numerical Computing](http://books.google.com.au/books?id=h0d8hVA5HyQC&dq=books+Java+Number+Cruncher:+The+Java+Programmer%27s+Guide+to+Numerical+Computing&printsec=frontcover&source=bn&hl=en&ei=MOLjSaPQBdaSkAX4w-nbCw&sa=X&oi=book_result&ct=result&resnum=4)提供了一个使用[牛顿法](http://en.wikipedia.org/wiki/Newton%27s_method)的解决方案。本书的源代码可[在此处](http://www.apropos-logic.com/nc/download.html)获得。以下内容取自第*12.5 章大十进制函数*（p330 和 p331）：

```
/**
 * Compute the natural logarithm of x to a given scale, x > 0.
 */
public static BigDecimal ln(BigDecimal x, int scale)
{
    // Check that x > 0.
    if (x.signum() <= 0) {
        throw new IllegalArgumentException("x <= 0");
    }

    // The number of digits to the left of the decimal point.
    int magnitude = x.toString().length() - x.scale() - 1;

    if (magnitude < 3) {
        return lnNewton(x, scale);
    }

    // Compute magnitude*ln(x^(1/magnitude)).
    else {

        // x^(1/magnitude)
        BigDecimal root = intRoot(x, magnitude, scale);

        // ln(x^(1/magnitude))
        BigDecimal lnRoot = lnNewton(root, scale);

        // magnitude*ln(x^(1/magnitude))
        return BigDecimal.valueOf(magnitude).multiply(lnRoot)
                    .setScale(scale, BigDecimal.ROUND_HALF_EVEN);
    }
}

/**
 * Compute the natural logarithm of x to a given scale, x > 0.
 * Use Newton's algorithm.
 */
private static BigDecimal lnNewton(BigDecimal x, int scale)
{
    int        sp1 = scale + 1;
    BigDecimal n   = x;
    BigDecimal term;

    // Convergence tolerance = 5*(10^-(scale+1))
    BigDecimal tolerance = BigDecimal.valueOf(5)
                                        .movePointLeft(sp1);

    // Loop until the approximations converge
    // (two successive approximations are within the tolerance).
    do {

        // e^x
        BigDecimal eToX = exp(x, sp1);

        // (e^x - n)/e^x
        term = eToX.subtract(n)
                    .divide(eToX, sp1, BigDecimal.ROUND_DOWN);

        // x - (e^x - n)/e^x
        x = x.subtract(term);

        Thread.yield();
    } while (term.compareTo(tolerance) > 0);

    return x.setScale(scale, BigDecimal.ROUND_HALF_EVEN);
}

/**
 * Compute the integral root of x to a given scale, x >= 0.
 * Use Newton's algorithm.
 * @param x the value of x
 * @param index the integral root value
 * @param scale the desired scale of the result
 * @return the result value
 */
public static BigDecimal intRoot(BigDecimal x, long index,
                                 int scale)
{
    // Check that x >= 0.
    if (x.signum() < 0) {
        throw new IllegalArgumentException("x < 0");
    }

    int        sp1 = scale + 1;
    BigDecimal n   = x;
    BigDecimal i   = BigDecimal.valueOf(index);
    BigDecimal im1 = BigDecimal.valueOf(index-1);
    BigDecimal tolerance = BigDecimal.valueOf(5)
                                        .movePointLeft(sp1);
    BigDecimal xPrev;

    // The initial approximation is x/index.
    x = x.divide(i, scale, BigDecimal.ROUND_HALF_EVEN);

    // Loop until the approximations converge
    // (two successive approximations are equal after rounding).
    do {
        // x^(index-1)
        BigDecimal xToIm1 = intPower(x, index-1, sp1);

        // x^index
        BigDecimal xToI =
                x.multiply(xToIm1)
                    .setScale(sp1, BigDecimal.ROUND_HALF_EVEN);

        // n + (index-1)*(x^index)
        BigDecimal numerator =
                n.add(im1.multiply(xToI))
                    .setScale(sp1, BigDecimal.ROUND_HALF_EVEN);

        // (index*(x^(index-1))
        BigDecimal denominator =
                i.multiply(xToIm1)
                    .setScale(sp1, BigDecimal.ROUND_HALF_EVEN);

        // x = (n + (index-1)*(x^index)) / (index*(x^(index-1)))
        xPrev = x;
        x = numerator
                .divide(denominator, sp1, BigDecimal.ROUND_DOWN);

        Thread.yield();
    } while (x.subtract(xPrev).abs().compareTo(tolerance) > 0);

    return x;
}

/**
 * Compute e^x to a given scale.
 * Break x into its whole and fraction parts and
 * compute (e^(1 + fraction/whole))^whole using Taylor's formula.
 * @param x the value of x
 * @param scale the desired scale of the result
 * @return the result value
 */
public static BigDecimal exp(BigDecimal x, int scale)
{
    // e^0 = 1
    if (x.signum() == 0) {
        return BigDecimal.valueOf(1);
    }

    // If x is negative, return 1/(e^-x).
    else if (x.signum() == -1) {
        return BigDecimal.valueOf(1)
                    .divide(exp(x.negate(), scale), scale,
                            BigDecimal.ROUND_HALF_EVEN);
    }

    // Compute the whole part of x.
    BigDecimal xWhole = x.setScale(0, BigDecimal.ROUND_DOWN);

    // If there isn't a whole part, compute and return e^x.
    if (xWhole.signum() == 0) return expTaylor(x, scale);

    // Compute the fraction part of x.
    BigDecimal xFraction = x.subtract(xWhole);

    // z = 1 + fraction/whole
    BigDecimal z = BigDecimal.valueOf(1)
                        .add(xFraction.divide(
                                xWhole, scale,
                                BigDecimal.ROUND_HALF_EVEN));

    // t = e^z
    BigDecimal t = expTaylor(z, scale);

    BigDecimal maxLong = BigDecimal.valueOf(Long.MAX_VALUE);
    BigDecimal result  = BigDecimal.valueOf(1);

    // Compute and return t^whole using intPower().
    // If whole > Long.MAX_VALUE, then first compute products
    // of e^Long.MAX_VALUE.
    while (xWhole.compareTo(maxLong) >= 0) {
        result = result.multiply(
                            intPower(t, Long.MAX_VALUE, scale))
                    .setScale(scale, BigDecimal.ROUND_HALF_EVEN);
        xWhole = xWhole.subtract(maxLong);

        Thread.yield();
    }
    return result.multiply(intPower(t, xWhole.longValue(), scale))
                    .setScale(scale, BigDecimal.ROUND_HALF_EVEN);
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-11T05:12:44.223

一个适用于大量数字的 hacky 小算法使用了关系`log(AB) = log(A) + log(B)`。这是以 10 为底的方法（您可以轻松地将其转换为任何其他对数底）：

1.  计算答案中的小数位数。这是你的对数的组成部分，*加一*。示例：`floor(log10(123456)) + 1`是 6，因为 123456 有 6 位数字。

2.  如果您只需要对数的整数部分，您可以在这里停下来：只需从第 1 步的结果中减去 1。

3.  要获得对数的小数部分，请将数字除以`10^(number of digits)`，然后使用`math.log10()`（或其他方法；如果没有其他可用，请使用简单的级数近似）计算该数字的对数，并将其添加到整数部分。示例：获取 的小数部分`log10(123456)`，计算`math.log10(0.123456) = -0.908...`并将其添加到第 1 步的结果中：`6 + -0.908 = 5.092`，即`log10(123456)`。请注意，您基本上只是在大数前面加上小数点；在你的用例中可能有一个很好的方法来优化它，对于非常大的数字，你甚至不需要费心去抓取所有的数字——`log10(0.123)`这是一个很好的近似`log10(0.123456789)`。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2012-02-03T08:07:14.517

这个超级快，因为：

*   不`toString()`
*   没有`BigInteger`数学（牛顿/连分数）
*   甚至没有实例化一个新的`BigInteger`
*   仅使用固定数量的非常快速的操作

一个调用大约需要 20 微秒（每秒大约 50k 调用）

但：

*   仅适用于`BigInteger`

解决方法`BigDecimal`（未测试速度）：

*   移动小数点直到值 > 2^53
*   使用`toBigInteger()`（`div`内部使用一个）

* * *

该算法利用了对数可以计算为指数和尾数的对数的事实。例如：

12345 有 5 位，因此以 10 为底的日志介于 4 和 5 之间。 log(12345) = 4 + log(1.2345) = 4.09149...（以 10 为底的日志）

* * *

此函数计算以 2 为底的对数，因为查找占用位数很简单。

```
public double log(BigInteger val)
{
    // Get the minimum number of bits necessary to hold this value.
    int n = val.bitLength();

    // Calculate the double-precision fraction of this number; as if the
    // binary point was left of the most significant '1' bit.
    // (Get the most significant 53 bits and divide by 2^53)
    long mask = 1L << 52; // mantissa is 53 bits (including hidden bit)
    long mantissa = 0;
    int j = 0;
    for (int i = 1; i < 54; i++)
    {
        j = n - i;
        if (j < 0) break;

        if (val.testBit(j)) mantissa |= mask;
        mask >>>= 1;
    }
    // Round up if next bit is 1.
    if (j > 0 && val.testBit(j - 1)) mantissa++;

    double f = mantissa / (double)(1L << 52);

    // Add the logarithm to the number of bits, and subtract 1 because the
    // number of bits is always higher than necessary for a number
    // (ie. log2(val)<n for every val).
    return (n - 1 + Math.log(f) * 1.44269504088896340735992468100189213742664595415298D);
    // Magic number converts from base e to base 2 before adding. For other
    // bases, correct the result, NOT this number!
} 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-11T05:14:07.810

你可以使用分解它

```
log(a * 10^b) = log(a) + b * log(10) 
```

基本上`b+1`将是数字中的位数，并且`a`将是一个介于 0 和 1 之间的值，您可以使用常规`double`算术计算其对数。

或者您可以使用一些数学技巧 - 例如，可以通过级数展开计算接近 1 的数字的对数

```
ln(x + 1) = x - x^2/2 + x^3/3 - x^4/4 + ... 
```

根据您尝试取对数的数字类型，您可能可以使用类似的东西。

*编辑*：要获得以 10 为底的对数，您可以将自然对数除以`ln(10)`，或类似地除以任何其他基数。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-14T01:16:53.877

这就是我想出的：

```
//http://everything2.com/index.pl?node_id=946812        
public BigDecimal log10(BigDecimal b, int dp)
{
    final int NUM_OF_DIGITS = dp+2; // need to add one to get the right number of dp
                                    //  and then add one again to get the next number
                                    //  so I can round it correctly.

    MathContext mc = new MathContext(NUM_OF_DIGITS, RoundingMode.HALF_EVEN);

    //special conditions:
    // log(-x) -> exception
    // log(1) == 0 exactly;
    // log of a number lessthan one = -log(1/x)
    if(b.signum() <= 0)
        throw new ArithmeticException("log of a negative number! (or zero)");
    else if(b.compareTo(BigDecimal.ONE) == 0)
        return BigDecimal.ZERO;
    else if(b.compareTo(BigDecimal.ONE) < 0)
        return (log10((BigDecimal.ONE).divide(b,mc),dp)).negate();

    StringBuffer sb = new StringBuffer();
    //number of digits on the left of the decimal point
    int leftDigits = b.precision() - b.scale();

    //so, the first digits of the log10 are:
    sb.append(leftDigits - 1).append(".");

    //this is the algorithm outlined in the webpage
    int n = 0;
    while(n < NUM_OF_DIGITS)
    {
        b = (b.movePointLeft(leftDigits - 1)).pow(10, mc);
        leftDigits = b.precision() - b.scale();
        sb.append(leftDigits - 1);
        n++;
    }

    BigDecimal ans = new BigDecimal(sb.toString());

    //Round the number to the correct number of decimal places.
    ans = ans.round(new MathContext(ans.precision() - ans.scale() + dp, RoundingMode.HALF_EVEN));
    return ans;
} 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-12-08T15:06:18.090

Meower68 伪代码的 Java 实现，我用几个数字进行了测试：

```
public static BigDecimal log(int base_int, BigDecimal x) {
        BigDecimal result = BigDecimal.ZERO;

        BigDecimal input = new BigDecimal(x.toString());
        int decimalPlaces = 100;
        int scale = input.precision() + decimalPlaces;

        int maxite = 10000;
        int ite = 0;
        BigDecimal maxError_BigDecimal = new BigDecimal(BigInteger.ONE,decimalPlaces + 1);
        System.out.println("maxError_BigDecimal " + maxError_BigDecimal);
        System.out.println("scale " + scale);

        RoundingMode a_RoundingMode = RoundingMode.UP;

        BigDecimal two_BigDecimal = new BigDecimal("2");
        BigDecimal base_BigDecimal = new BigDecimal(base_int);

        while (input.compareTo(base_BigDecimal) == 1) {
            result = result.add(BigDecimal.ONE);
            input = input.divide(base_BigDecimal, scale, a_RoundingMode);
        }

        BigDecimal fraction = new BigDecimal("0.5");
        input = input.multiply(input);
        BigDecimal resultplusfraction = result.add(fraction);
        while (((resultplusfraction).compareTo(result) == 1)
                && (input.compareTo(BigDecimal.ONE) == 1)) {
            if (input.compareTo(base_BigDecimal) == 1) {
                input = input.divide(base_BigDecimal, scale, a_RoundingMode);
                result = result.add(fraction);
            }
            input = input.multiply(input);
            fraction = fraction.divide(two_BigDecimal, scale, a_RoundingMode);
            resultplusfraction = result.add(fraction);
            if (fraction.abs().compareTo(maxError_BigDecimal) == -1){
                break;
            }
            if (maxite == ite){
                break;
            }
            ite ++;
        }

        MathContext a_MathContext = new MathContext(((decimalPlaces - 1) + (result.precision() - result.scale())),RoundingMode.HALF_UP);
        BigDecimal roundedResult = result.round(a_MathContext);
        BigDecimal strippedRoundedResult = roundedResult.stripTrailingZeros();
        //return result;
        //return result.round(a_MathContext);
        return strippedRoundedResult;
    } 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2011-04-04T05:56:45.630

如果您只需要在可以使用的数字中找到 10 的幂：

```
public int calculatePowersOf10(BigDecimal value)
{
    return value.round(new MathContext(1)).scale() * -1;
} 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-01-15T18:45:22.090

做对数的伪代码算法。

假设我们想要 x 的 log_n

```
double fraction, input;
int base;
double result;

result = 0;
base = n;
input = x;

while (input > base){
  result++;
  input /= base;
}
fraction = 1/2;
input *= input;   

while (((result + fraction) > result) && (input > 1)){
  if (input > base){
    input /= base;
    result += fraction;
  }
  input *= input;
  fraction /= 2.0;
 } 
```

大的 while 循环可能看起来有点混乱。

在每次通过时，您可以对输入进行平方，也可以取基数的平方根；无论哪种方式，您都必须将分数除以 2。我发现将输入平方并单独留下基数，这样会更准确。

如果输入变为 1，我们就完成了。对于任何基数，1 的对数都是 0，这意味着我们不需要再添加了。

如果 (result + fraction) 不大于结果，那么我们已经达到了编号系统的精度极限。我们可以停下来。

显然，如果您正在使用具有任意多位精度的系统，您将需要在其中放置其他东西来限制循环。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-05-29T18:48:33.063

我一直在寻找这个确切的东西，并最终采用了连续分数方法。连分数可以在[这里](http://en.wikipedia.org/wiki/Generalized_continued_fraction "一些疱疹和derp")或[这里找到](http://functions.wolfram.com/ElementaryFunctions/Log/10/ "法律")

代码：

```
import java.math.BigDecimal;
import java.math.MathContext;

public static long ITER = 1000;
public static MathContext context = new MathContext( 100 );
public static BigDecimal ln(BigDecimal x) {
    if (x.equals(BigDecimal.ONE)) {
        return BigDecimal.ZERO;
    }

    x = x.subtract(BigDecimal.ONE);
    BigDecimal ret = new BigDecimal(ITER + 1);
    for (long i = ITER; i >= 0; i--) {
    BigDecimal N = new BigDecimal(i / 2 + 1).pow(2);
        N = N.multiply(x, context);
        ret = N.divide(ret, context);

        N = new BigDecimal(i + 1);
        ret = ret.add(N, context);

    }

    ret = x.divide(ret, context);
    return ret;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2014-08-20T20:50:26.610

老问题，但我实际上认为这个答案更可取。它具有良好的精度并支持几乎任何大小的参数。

```
private static final double LOG10 = Math.log(10.0);

/**
 * Computes the natural logarithm of a BigDecimal 
 * 
 * @param val Argument: a positive BigDecimal
 * @return Natural logarithm, as in Math.log()
 */
public static double logBigDecimal(BigDecimal val) {
    return logBigInteger(val.unscaledValue()) + val.scale() * Math.log(10.0);
}

private static final double LOG2 = Math.log(2.0);

/**
 * Computes the natural logarithm of a BigInteger. Works for really big
 * integers (practically unlimited)
 * 
 * @param val Argument, positive integer
 * @return Natural logarithm, as in <tt>Math.log()</tt>
 */
public static double logBigInteger(BigInteger val) {
    int blex = val.bitLength() - 1022; // any value in 60..1023 is ok
    if (blex > 0)
        val = val.shiftRight(blex);
    double res = Math.log(val.doubleValue());
    return blex > 0 ? res + blex * LOG2 : res;
} 
```

核心逻辑（方法）是从我的[另一个答案](https://stackoverflow.com/questions/6827516/logarithm-for-biginteger/7982137#7982137)`logBigInteger`中复制而来的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2019-01-13T08:29:45.460

我为 BigInteger 创建了一个函数，但它可以很容易地为 BigDecimal 修改。分解日志并使用日志的某些属性是我所做的，但我只得到双精度。但它适用于任何基地。:)

```
public double BigIntLog(BigInteger bi, double base) {
    // Convert the BigInteger to BigDecimal
    BigDecimal bd = new BigDecimal(bi);
    // Calculate the exponent 10^exp
    BigDecimal diviser = new BigDecimal(10);
    diviser = diviser.pow(bi.toString().length()-1);
    // Convert the BigDecimal from Integer to a decimal value
    bd = bd.divide(diviser);
    // Convert the BigDecimal to double
    double bd_dbl = bd.doubleValue();
    // return the log value
    return (Math.log10(bd_dbl)+bi.toString().length()-1)/Math.log10(base);
} 
```

# database - 从头开始的数据库

> ID：739534
> 
> 赞同：2
> 
> 时间：2009-04-11T04:52:13.540
> 
> 标签：database

如何从头开始创建数据库管理系统？有没有高质量的书籍、网站和教程？

高质量我的意思是它应该易于使用并且在解释概念时应该直截了当。

以下是我正在寻找的 calibre 质量资源的示例：

1.  如果我要从头开始创建操作系统，我会考虑学习 MINIX 3。

2.  如果我要从头开始创建一个编译器，那么著名的龙书编译器：原理、技术和工具就是一本好书。

如果有可用的 C 或任何接近 C 的编程语言的源代码的工作示例来完成这项任务，那就太好了。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T06:02:37.130

Ramakrishnan 和 Gehrke 的“数据库管理系统”。 [http://pages.cs.wisc.edu/~dbbook/](http://pages.cs.wisc.edu/~dbbook/)

第一部分是对数据建模、SQL 等的介绍，但后半部分深入介绍了内部设计（包括事务控制、锁定、日志记录、存储管理、ACID 保证等）。

在研究内部结构方面，有一个名为 MiniBase 的教育软件，同样来自威斯康星州，但我只是开始研究 Postgres 内部结构。非常干净，做了很多，做的很多对。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T05:05:54.477

关系数据库设计的学术教科书有：

*   数据库系统简介 - CJ Date
*   数据库系统：设计、实施和管理的实用方法 - Thomas Connolly

这些中的任何一个都是开始研究该理论的好地方。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T14:45:45.140

我还要添加 CJ Date 的另一本书 - [Date on Database](https://rads.stackoverflow.com/amzn/click/com/159059746X)

# c++ - 持续集成：Visual Studio 2008 上的非托管 C++

> ID：739539
> 
> 赞同：2
> 
> 时间：2009-04-11T04:54:31.337
> 
> 标签：c++, visual-studio, unit-testing, continuous-integration, build-automation

我花了 4 年时间为一家商业公司使用 Visual Studio 2008 开发 C++；现在是我升级开发流程的时候了。

这是问题所在：我没有 1 按钮构建自动化。我也没有在提交发生时自动构建的 CI 服务器，并且无论构建是否损坏都会通过电子邮件发送给我。更糟糕的是，我们甚至没有一个单元测试！

有人可以指点我如何开始吗？

我看过很多工具，我想我可能会选择：

[Visual Build](http://www.kinook.com/VisBuildPro)（用于构建自动化）（注意：我也考虑过 Final Builder）

[Cruise](http://studios.thoughtworks.com/cruise-continuous-integration)（用于 CI 服务器）

我现在也刚刚开始练习 TDD ......所以我也想自动化我的单元测试。我选择 Google Test/Mock 是因为他们有大量的文档。（我不能用谷歌品牌出错吗？=p）

价格不是问题，我想要最好和最容易上手的东西。

**对非托管 MSVC++**使用真正的 CI/自动化工具的人能否告诉我他们的工具以及我该如何开始？

我们的源代码控制是 Subversion。

最后一点：我还在考虑直接集成到 VSTD 中的项目管理/跟踪工具 ..并考虑使用 OnTime。VSTS 成本太高。我试过FogBugz，但我觉得太简单了。还有其他人吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T05:08:25.233

上次我处理一个非托管的 MSVC++ 项目（我可能会添加它的大小适中）时，我们使用 FinalBuilder 进行自动构建和版本控制（甚至还执行 PCLint 和其他分析工具）。

话虽如此，如果您愿意投入时间，MSBuild（或者可能是 nAnt？）可以完成您需要的一切 - 即使对于非托管解决方案也是如此。

这给我们带来了权衡：Visual Build Pro 和 Final Builder 等工具让您快速启动并运行。如果您想要提供更大范围定制的东西，您可能会花费大量时间来学习和理解它——即 MSBuild、CIFactory、nAnt 等都不是小菜一碟。

所以，如果价格不是问题——时间是问题吗？如果时间很宝贵，我会研究 GUI 驱动的工具，它们会带你快速到达你想去的地方。如果您知道您将需要扩展简单的一键式构建 + 单元测试 + 部署场景（这种情况经常发生！）然后决定是否可以将时间投入到更复杂的工具上，例如 MSBuild？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-11T14:48:50.703

我们使用[Boost.Build](http://www.boost.org/doc/tools/build/index.html)、[NAnt](http://nant.sourceforge.net/)、[CPPUnit](http://cppunit.sourceforge.net/doc/lastest/cppunit_cookbook.html)和[Cruise Control.NET](http://ccnet.thoughtworks.com)或[Hudson](http://hudson-ci.org)的组合（我们已经将它们用于各种项目，但开始更喜欢 Hudson）。

尽管我们正在考虑替换 CPPUnit，但它们都是很好的工具——就我所见，Google 单元测试系统非常好。

如果你很高兴只在 Windows 上运行，你可以失去 Boost.Build 并从 NAnt 调用 Visual Studio。

至于问题跟踪/项目管理，经过长期调查，我们选择了[Vision Project 。](http://www.visionproject.se/)它（目前）还不为人所知，但我们发现它非常适合我们的环境。Fogbugz 很棒，一个漂亮、清晰的界面，但我们得出的结论是你也这样做了；对我们的需求来说太简单了。

尽管 .NET 世界被这些工具宠坏了，但 C++ 的持续集成仍然很容易设置！如果不安装这些系统，我不会考虑开始一个重要的项目。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-12T03:35:19.257

我会花一些时间认真考虑[TeamCity](http://www.jetbrains.com/teamcity/)。我们使用 CruiseControl.NET 有一段时间，TeamCity 彻底摧毁了它。此外，它还内置了用于 Boost 和 CppUnit 的插件，因此您的单元测试将免费提供。

最重要的是，该工具对 < 20 个用户免费，并为您提供三个构建代理。

我刚刚在工作中完成了我们的 C++ 产品的实现，它相当简单。我们使用 msbuild 完成了它，并且基本上使用 msbuild 任务来编译解决方案。其他目标可用于复制文件、运行单元测试等。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-25T20:08:10.710

我们使用 subversion + Cruisecontrol + wix 来完成 CI 自动化构建，输出一键式安装程序。这个组合对我们来说效果很好。我们已经为 svn 用户组和权限的管理员创建了自己的站点，并将 Web 界面添加到 cc 中。我们有一个 sql server 存储从 svn 和 cc 收集的所有统计信息，并将它们用于我们网站上可用的自定义报告。我们正在寻求添加其他工具来检查存储在 svn 中的代码的各种属性。这个组合对我们来说效果很好。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-11T05:05:41.323

在我的公司，我们使用 CruiseControl ( [http://cruisecontrol.sourceforge.net/](http://cruisecontrol.sourceforge.net/) )。Java 版本，而不是 .NET，用于在 Windows 和 OS X 上构建我们的 wxWidgets 应用程序。到目前为止，对我们来说工作得很好。

# java - ext js 与 .jsp、java 后端兼容吗？

> ID：739547
> 
> 赞同：2
> 
> 时间：2009-04-11T05:05:44.240
> 
> 标签：java, javascript, jsp, extjs

ext js 与 .jsp、java 后端兼容吗？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-11T05:38:32.057

Ext JS 是一个 JavaScript 库。它存在于浏览器的客户端。所以不管你用的是 PHP、JSP 还是 ASP.Net，只要浏览器支持 javascript，ExtJS 就可以在那里工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-11T05:09:39.490

简而言之，是的，但请参阅以下文章，就易于使用的集成（标签库）而言：

[http://raibledesigns.com/rd/entry/ext_js_tag_library](http://raibledesigns.com/rd/entry/ext_js_tag_library)

和参考的文章：

[http://blog.james-carr.org/2008/01/22/making-extjs-more-accessible-to-java-developers/](http://blog.james-carr.org/2008/01/22/making-extjs-more-accessible-to-java-developers/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-23T16:21:26.053

我强烈推荐看看 Grails。它生活在 java 世界中，与 ExtJS 一起玩得非常好。例如，您可能必须在服务器和 ExtJS 客户端之间生成和解析大量 JSON，而 Grails 将其视为一种内置语言。

# c# - 整理库 API

> ID：739549
> 
> 赞同：1
> 
> 时间：2009-04-11T05:06:02.977
> 
> 标签：c#, unit-testing, mocking

我目前正在用 C# 编写一个包装器库，它包装一个 COM 对象，该对象的 API 非常小而且使用起来很痛苦，并且在混乱方面遇到了一些问题。

这是我使用 TDD 和模拟的第一个项目，如果这不是一个大问题，很抱歉。我把我的库的副本给了我的一个同事，他注意到的第一件事是 API 中的大量接口。

我向他解释说，因为我在进行单元测试和模拟，所以我需要接口来停止测试接触 COM 对象，他有点理解，但这让我想也许我的 API 有点混乱，很难理解。

我的问题是 - 如果我正在编写一个包装库，其中每个对象都在某处接触 COM API，那么整理我的 API 并仍然能够测试代码的最佳方法是什么。

对于大多数事情，我应该使用抽象类而不是接口吗？还是我应该将仅出于模拟原因的接口隐藏在某个名称空间中？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T01:46:05.960

除了对同事的评论之外，我还没有发现公开的 API 有什么大不了的。你的同事会欣赏你的应用程序在你前进的过程中所改变的灵活性，而不是“混乱”的 API。

我不会担心它，继续你的生活。

至于模拟，我绝对更喜欢接口而不是抽象类。您会发现越深入，您将编写*组合*应用程序而不是*继承*的应用程序。这是因为您希望保持对象较小且依赖项很少，因此测试不会变得一团糟。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T05:10:35.477

如果接口仅用于模拟目的，我建议将其设置为内部。然后，您可以将 InternalsVisibleToAttribute 应用到您的包装库，以将内部接口公开给您的测试。

# mysql - 为 Access 中的链接表选择 @@Identity 返回 0

> ID：739556
> 
> 赞同：0
> 
> 时间：2009-04-11T05:11:31.233
> 
> 标签：mysql, ms-access, ms-access-2007

我正在使用 Access 2007 并且有一些链接到 mySQL 数据库的表。我正在使用 DAO 将记录插入到 mySQL 链接表中，并尝试使用 Select @@identity 检索插入的 PK，但该选择返回 0。

```
 Dim sql As String

  Dim oDB As Database
  Set oDB = CurrentDb 

  sql = "INSERT INTO Quotes ( CustomerID ) SELECT 1 AS Expr1;" 

  oDB.Execute sql 

  If oDB.RecordsAffected <> 1 Then 
    MsgBox "cannot create new quote"
    Exit Function
  End If

  Dim rsNewID As DAO.Recordset
  Set rsNewID = oDB.OpenRecordset("SELECT @@IDENTITY")  ' Create a recordset and SELECT the new Identity

  Dim intNewID As Long
  intNewID = rsNewID(0).Value ' Store the value of the new identity in variable intNewID
  'This value is 0, why? 
```

我见过[另一个这样的问题，](https://stackoverflow.com/questions/186544/identity-after-insert-statement-always-returns-0)对我来说没有得到满意的回答

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T08:07:22.230

选择 LAST_INSERT_ID()

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T17:46:18.047

fredrik 获得了 mySQL 语句的部分功劳。需要注意的是，我使用的是 DAO，因此语句由 JET 引擎处理，它不支持此语句。这需要在 Access 中作为传递查询运行才能正常工作。在我使用 fredrik 的 select 语句进行查询后，就成功了。我从我的 DAO 代码中调用了这个 Access 直通查询，它起作用了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T06:03:10.327

我没用过mysql。所以，翻译一下我对mysql说的话。

CustomerID 是一个身份列（即它自己生成 ID）吗？
如果是这样，请使用返回最后生成的 ID 的函数。

@@Identity 函数是人们在 SQL Server 中使用的。我不知道mysql中的等价物。
看到[这个](http://dev.mysql.com/doc/refman/5.0/en/mysql-insert-id.html)

查看上面的代码，您不需要打开第二个记录集。`rsNewID1`应该可以帮助您获取最后插入的 ID 。

希望这可以帮助。

# sql - 两个表上的 SQL 查询 - 返回一个表中没有另一个表中的条目的行

> ID：739557
> 
> 赞同：3
> 
> 时间：2009-04-11T05:12:08.750
> 
> 标签：sql

对于我正在处理的库存控制系统，我有两个数据库表，类别和超级类别：

类别：ID_Category、CategoryName

SuperCategories：ID_SuperCategory、CategoryID、SuperCategoryID

我将类别-子类别关系放入 SuperCategories 表中。我将所有类别都放入类别表中。

这是一个例子：

```
    分类：
    ID_Category 类别名称
    1 盒
    2 红盒
    3 蓝盒
    4个蓝色塑料盒
    5 可以
    6 锡罐  

```

```

    超级分类：
    ID_Super CategoryID SuperCategoryID
    1 2 1
    2 3 1
    3 4 3
    4 6 5

```

CategoryID 和 SuperCategoryID 与 Categories 表中的主键 ID_Category 相关。

我想要的是一个查询，它返回不是任何其他类别的父类的所有类别名称：

红盒
蓝色塑料盒
锡罐

这相当于查找未显示在 SuperCategoryID 列（2、4 和 6）中的所有 ID_Category 值，但我在编写 SQL 时遇到了麻烦。

我正在使用 VB6 来查询 Access 2000 数据库。

任何帮助表示赞赏。谢谢！

**编辑：**我投票赞成每个人的答案，这给了我一些有用的东西。我接受了我认为最有启发性的答案。再次感谢您的帮助！

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-11T05:34:41.053

```
SELECT
     CAT.ID_Category,
     CAT.CategoryName
FROM
     Categories CAT
WHERE
     NOT EXISTS
     (
          SELECT
               *
          FROM
               SuperCategories SC
          WHERE
               SC.SuperCategoryID = CAT.ID_Category
     ) 
```

或者

```
SELECT
     CAT.ID_Category,
     CAT.CategoryName
FROM
     Categories CAT
LEFT OUTER JOIN SuperCategories SC ON
     SC.SuperCategoryID = CAT.ID_Category
WHERE
     SC.ID_Super IS NULL 
```

我还会建议您的命名标准可能会使用一些工作。他们似乎到处都是，很难相处。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-11T07:15:51.277

Mike Pone 的回答有效，因为他将“Categories”表与“SuperCategories”表作为“LEFT OUTER JOIN”加入 - 这将获取“Categories”中的所有条目并将“SuperCategories”中的列添加到链接存在的那些 -在它不存在的地方（例如，在“SuperCategories”中没有条目的地方），您将获得 SuperCategories 列的 NULL - 这正是 Mike 的查询随后检查的内容。

如果您要这样编写查询：

```
SELECT c.CategoryName, s.ID_Super 
FROM Categories c 
LEFT OUTER JOIN SuperCategories s ON c.ID_Category = s.SuperCategoryID 
```

你会得到这样的东西：

```
CategoryName    ID_Super
Box               1
Box               2
Red Box           NULL
Blue Box          3
Blue Plastic Box  NULL
Can               4
Tin Can           NULL 
```

所以这基本上给了你答案 - LEFT OUTER JOIN 上的 ID_Super 为 NULL 的所有行都是在 SuperCategories 表中没有任何条目的行。全清？:-)

马克

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-11T05:33:39.043

仅包括那些不是超级类别的类别。一个简单的外连接

```
select CategoryName from Categories LEFT OUTER JOIN
SuperCategories ON Categories.ID_Category =SuperCategories.SuperCategoryID
WHERE SuperCategories.SuperCategoryID is  null 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-11T05:24:39.017

不确定语法是否适用于 Access，但类似这样的东西会起作用：

```
select CategoryName from Categories
where ID_Category not in (
    select SuperCategoryID 
    from SuperCategories 
) 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-05-07T11:43:08.950

我总是按照 marc_s 的建议采用外连接方法。使用 OUTER JOINS 时有很大的威力。很多时候，我必须执行 FULL OUTER JOIN 来检查查询两边的数据。

您还应该查看 ISNULL 函数，如果您正在执行数据可以在表 A 或表 B 中的查询，那么我将使用 ISNULL 函数从任一列返回值。

这是一个例子

```
 SELECT 
       isNull(a.[date_time],b.[date_time]) as [Time Stamp]
      ,isnull(a.[ip],b[ip]) as [Device Address]
      ,isnull(a.[total_messages],0) as [Local Messages]
      ,isnull(b.[total_messages],0) as [Remote Messages]
  FROM [Local_FW_Logs] a
FULL OUTER JOIN [Remote_FW_Logs] b 
on b.ip = a.ip 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2013-05-30T08:30:25.063

我有两张桌子`interface_category`和`interface_subcategory`.

`Interface_subcategory`包含`SubcategoryID, CategoryID, Name(SubcategoryName)`

`Interface_category`包含`CategoryID, Name(CategoryName)`

现在我想要输出`CategoryID`和名称（子类别名称）

我写的查询如下，它对我有用

```
select ic.CategoryID, ic.Name CategoryName, ISC.SubCategoryID, ISC.Name SubCategoryName from Interface_Category IC
inner join Interface_SubCategory ISC
on ISC.CategoryID = ic.CategoryID
order by ic.CategoryID, isc.SubCategoryID 
```

# programming-languages - 登月使用了哪些编程语言？

> ID：739561
> 
> 赞同：36
> 
> 时间：2009-04-11T05:22:26.557
> 
> 标签：programming-languages

我一直想知道：登月使用了哪些编程语言？我意识到可能没有单一的答案/语言，但它让我感兴趣。

有多少人为这些系统编写代码？它是如何测试的？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-04-11T05:33:49.963

不是完整的答案，而是更多信息：

“板载 Apollo 导航计算机 (AGC) 大约 1 立方英尺，带有 2K 的 16 位 RAM 和 36K 的硬线芯绳存储器，铜线穿过或不穿过微小的磁芯。16 位字**“** _ _

[http://www.hq.nasa.gov/alsj/a11/a11.1201-fm.html](http://www.hq.nasa.gov/alsj/a11/a11.1201-fm.html)

补充：BBC最近发表了[一篇关于AGC的精彩文章，](http://news.bbc.co.uk/2/hi/technology/8148730.stm)包括对设计师的采访，以及对编织“绳芯”的“小老太太”的采访。它不包括软件是如何设计、编码或测试的，但您可能会发现它仍然很有趣！

此外，主模块和登陆模块的源代码可以在[这里找到](https://github.com/chrislgarry/Apollo-11)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-11T05:32:02.337

阿波罗[导航计算机](http://en.wikipedia.org/wiki/Apollo_Guidance_Computer)是用汇编语言编写的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-12-19T01:54:45.247

摘自[“太空飞行中的数字阿波罗人类和机器”](http://www.worldcat.org/title/digital-apollo-human-and-machine-in-spaceflight/oclc/228031739&referer=brief_results)，David A. Mindell，麻省理工学院出版社 (C) 2008

pg。149

> 阿波罗的软件源自火星任务的基本设计。设计师 Hugh-Blair Smith 创建了一种称为“Basic”的语言，这是一种大约 40 条指令的低级 assmelby 语言（与大约同时在达特茅斯开发的高级 BASIC 编程语言不同）。在 BASIC 之上是“解释器”，它是 Hal Laning 的创意，这种语言实际上是一组例程，以高精度数据格式执行与引导和控制相关的高级数学函数。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T05:34:15.140

不完全是月球，而是[JPL 的 Lisping](http://www.flownet.com/gat/jpl-lisp.html)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-11T06:23:48.687

我记得读到完全相同的软件是由（至少）两个不同的不相交的团队编写的。然后，计算机会将他们的答案进行比较，并检查是否存在任何差异……不确定如果发现会做什么，但至少他们会知道有问题。我认为他们实际上使用了四台不同的计算机，并且获得了多数票，所以如果一台计算机出错了，它就会被忽略。

# c# - 隐藏另一个应用的任务栏按钮

> ID：739574
> 
> 赞同：15
> 
> 时间：2009-04-11T05:35:52.640
> 
> 标签：c#, .net, pinvoke

我希望能够从任务栏中隐藏另一个应用程序的窗口，而不隐藏窗口本身。具体来说，我希望在 Alt+Tab 列表中运行、可见、可用的几个不同的 Web 浏览器，但不占用任务栏上的空间。

（如果有人好奇为什么：我编写了一个仪表板应用程序，它使用 Vista 的 DwmRegisterThumbnail API 来一次显示多个窗口的实时预览——如果你愿意的话，这是一种“画中画”。那时，还有任务栏按钮因为那些窗户似乎是多余的。）

我知道将另一个窗口的样式更改为包含`WS_EX_TOOLWINDOW`会将其从任务栏中隐藏，我首先尝试了这个。但是，正如预期的那样，它有一些我不想要的副作用：标题栏变短了（我猜不是全是坏的），最小化和最大化按钮消失了（不好）。我还必须隐藏并重新显示窗口以使任务栏识别更改，这在我对 IE 窗口执行此操作时会导致重新绘制工件。

我的下一个想法是，由于默认情况下具有所有者的窗口从任务栏中隐藏，也许我可以将其他窗口更改为我的。但是 MSDN[非常清楚](http://msdn.microsoft.com/en-us/library/ms632599(VS.85).aspx#owned_windows)“[a] 在创建一个拥有的窗口之后，应用程序不能将窗口的所有权转移到另一个窗口。”

我发现[这个问题](https://stackoverflow.com/questions/261601/hide-a-forms-taskbar-button-without-using-wsextoolwin)的措辞与我的相似，但它专门针对您自己进程中的窗口，您可以完全控制窗口所有权。

有谁知道隐藏任务栏按钮的任何其他方法，这将适用于另一个进程的窗口？

* * *

**更新：** Tormod 通过 ITaskbarList 让我走上了正轨——效果很好。pinvoke.net 页面有一些错误（错误的 GUID，按字母顺序而不是按接口顺序声明的方法），但我对其进行了编辑，进行了更正，并添加了一个如何通过其 coclass 实例化 ITaskbarList 的示例。

**更新 2：**如果您使用 DeleteTab 隐藏窗口的任务栏按钮，然后将其设为活动窗口（例如通过`SetForegroundWindow`或 Alt+Tab），其任务栏按钮将重新出现。为了隐藏任务栏按钮，我必须添加一个计时器并继续调用 DeleteTab。只要您不介意在窗口获得焦点时任务栏按钮会短暂重新出现，这很有效。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-11T12:33:48.220

来自[MSDN](http://msdn.microsoft.com/en-us/library/bb776822(loband).aspx)：

> Shell32.dll 4.71 及更高版本添加了修改任务栏内容的功能。从应用程序中，您现在可以添加、删除和激活任务栏按钮。激活项目不会激活窗口；它显示在任务栏上按下的项目。
> 
> 任务栏修改功能在公开 ITaskbarList 接口 (IID_ITaskbarList) 的组件对象模型 (COM) 对象 (CLSID_TaskbarList) 中实现。您必须调用 ITaskbarList::HrInit 方法来初始化对象。然后可以使用 ITaskbarList 接口的方法来修改任务栏的内容。

似乎 COM 互操作是可靠地操作任务栏内容的方法。特别是，您需要调用以下函数：

*   [ITaskbarList::AddTab](http://msdn.microsoft.com/en-us/library/bb774646(loband).aspx)
*   [ITaskbarList::DeleteTab](http://msdn.microsoft.com/en-us/library/bb774648(loband).aspx)

您可以在 pinvoke.net 上找到 ITaskbarList 接口的 C# 签名[： ITaskbarList](http://www.pinvoke.net/default.aspx/shell32/ITaskbarList.html)。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T06:56:07.237

你试过删除[`WS_EX_APPWINDOW`](http://msdn.microsoft.com/en-us/library/ms632680(VS.85).aspx)吗？

# nhibernate - ORM 中的数据结构

> ID：739578
> 
> 赞同：0
> 
> 时间：2009-04-11T05:36:53.853
> 
> 标签：nhibernate, data-structures, mapping

如何在 NHibernate 等 ORM 中映射基本数据结构（例如树、字典）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T10:15:03.063

O/R 映射是关于将类映射到表/视图，因此两者（对象和表/视图行）实例中的数据意味着相同的事情。

因此，映射树/字典没有任何意义，因为它与此无关。如果您的实体在代码中由字典表示，那么这是有道理的，但是这永远不会发生。

# objective-c - @property(copy) - 是否正在制作整个副本？

> ID：739581
> 
> 赞同：0
> 
> 时间：2009-04-11T05:40:07.730
> 
> 标签：objective-c

我正在使用此属性访问器获取 CALayer 的子层：

```
// @property(copy) NSArray *sublayers

NSArray* layer = mylayer.layer.sublayers; 
```

由于此属性使用“复制”，因此每次我只需执行：

```
mylayer.layer.sublayers 
```

是为我制作的 sublayers 数组的完整副本吗？如果是这样，那可能会很糟糕，因为我可以有一百多个层，并且绝对不想创建它们的巨大副本。我只是想获得一个计数并遍历现有层，只是一个指向现有层的指针，

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T10:45:44.783

当您使用“复制”声明和`@synthesize`属性时，则在设置属性时使用复制。

在您的示例中，您仅访问仅为您提供指向子层数组的指针的值。

这是关于这一点的 ADC 文档[的链接。](http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Articles/ocProperties.html#//apple_ref/doc/uid/TP30001163-CH17-SW32)

**更新**

1.  IIRC，运行时足够聪明，可以知道被设置的对象是否是可变的。如果将不可变对象传递给属性，它将被保留而不是复制。
2.  在某些情况下，如果您要传入一个希望能够修改的可变对象，那么您应该编写自己的 setter 来调用`mutableCopy`该对象。这显示在我提供的[文档链接中。](http://developer.apple.com/documentation/Cocoa/Conceptual/ObjectiveC/Articles/ocProperties.html#//apple_ref/doc/uid/TP30001163-CH17-SW32)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T12:10:51.443

我不确定我是否理解您的回答 Abizern 所以让我这样说：

如果您在属性上使用（复制），您将制作该对象的全新副本，因此会浪费大量内存。我不确定他们为什么这样做，如果他们想保护值不被更改，他们可以只使用 (readonly) 代替。另外请记住，大多数值类在 Obj-C 中是不可变的，因此它们无论如何都无法更改值。

# php - 与隐藏的表单字段基础知识（PHP）作斗争

> ID：739583
> 
> 赞同：0
> 
> 时间：2009-04-11T05:44:50.123
> 
> 标签：php, forms

我在使用带有 PHP 数据的隐藏表单时遇到了困难。我一生都无法弄清楚我做错了什么。

我的代码应该

1.  检查攻击是否成功；
2.  如果成功，则从健康中减去伤害；
3.  重写 $health 变量。
4.  在下一轮使用新的 $health 值。

问题是，它一直在重置健康值。

这是我的代码（设置为使攻击始终成功）：

```
<?php
$health = $_REQUEST["health"];
$attack = rand(10,20);
$defend = rand(1,9);
$damage = rand(1,5);
$health =50;

if ($attack>$defend){
    print "<p>Jim hit the robot for $damage.</p>";
    $health = $health - $damage;
    print "<p>The robot has $health health remaining.</p>";
} else {
    print "<p>Jim missed.</p>";
    print "<p>The robot has $health health remaining.</p>";
} // end if statement

print <<<HERE

<input type="text"
   name="openMonsterHealth"
   value="$health">
<input type="hidden"
   name="hdnMonsterHealth"
   value="$health">
<input type="submit"
   value="click to continue">

HERE;
?> 
```

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-11T06:02:39.207

如果您希望 $health 跟随您进入下一页，请使用会话。

[PHP 会话手册](http://us3.php.net/session)

基本上，你会开始你的页面

```
session_start();
if(isset($_SESSION['health'])) {
    $health = $_SESSION['health'];
}
else {
    //However you normally set health when the user is just starting
} 
```

如果您像这样设置它，它将从上一页加载健康值：

```
$_SESSION['health'] = $health;
```

PHP 脚本会自动编写和关闭会话，因此您无需担心除了在会话全局数组中创建变量之外的任何事情。当您想从上一页检索会话数组中的数据时，不要忘记启动会话。但是，您的用户必须能够接受 cookie。

如果您继续使用隐藏字段，玩家可以在将其发送回您之前更改该信息（另外，跟踪它们更麻烦）。

## 编辑：

* * *

但是，您的错误是您在代码的第 5 行将您的健康状况重置为 50，您没有使用请求中的健康状况的正确变量名称，并且您没有任何表单标签。

```
 <?php
if(isset($_REQUEST['hdnMonsterHealth']))
    $health = $_REQUEST['hdnMonsterHealth'];
else 
    $health = 50;
$attack = rand(10,20);
$defend = rand(1,9);
$damage = rand(1,5);

if ($attack > $defend) {
print "<p>Jim hit the robot for $damage.</p>";
$health = $health - $damage;
print "<p>The robot has $health health remaining.</p>";
} else {
    print "<p>Jim missed.</p>";
    print "<p>The robot has $health health remaining.</p>";
} // end if statement

print <<<HERE

<form method="post">
<input type="text"
   name="openMonsterHealth"
   value="$health">
<input type="hidden"
   name="hdnMonsterHealth"
   value="$health">
<input type="submit"
   value="click to continue">
</form>

HERE;
?> 
```

编辑：对于所有的怪异抱歉，这段代码破坏了格式，所以我不得不手动`<`在代码中插入`&lt;`. 但是，此代码现在可以使用。

你仍然有一个负面健康的错误。不过，我不是为你写游戏。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T05:49:45.557

抱歉，您没有提到 $health 变量的范围。它属于会话，还是仅在请求的生命周期内？

我强烈建议使用会话变量，即：

```
$_SESSION["health"] = $_SESSION["health"] - $_REQUEST["DAMAGE"];

```

# c - 关于 C 编程的文件处理问题

> ID：739589
> 
> 赞同：2
> 
> 时间：2009-04-11T05:48:24.280
> 
> 标签：c, filehandle

我想从给定的输入文件中逐行读取，处理每一行（即它的单词），然后移动到另一行......

所以我正在使用 fscanf(fptr,"%s",words) 来读取单词，一旦遇到行尾它应该停止......

但这在 fscanf 中是不可能的，我猜……所以请告诉我该怎么做……

我应该阅读给定行中的所有单词（即应该遇到行尾）以终止然后移动到另一行，并重复相同的过程..

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-11T05:54:17.853

使用[fgets()](http://www.cplusplus.com/reference/clibrary/cstdio/fgets/)。是的，链接指向 cplusplus，但它源自 c `stdio.h`。

您也可以使用`sscanf()`从字符串中读取单词，或者只是`strtok()`将它们分开。

* * *

*回应评论：（*`fgets()`留在字符串中）的这种行为`\n`允许您确定是否遇到了实际的行尾。请注意，`fgets()`如果提供的缓冲区不够大，也可能只从文件中读取部分行。`\n`在你的情况下 -如果你不需要它，只需检查并删除它。像这样的东西：

```
// actually you'll get str contents from fgets()
char str[MAX_LEN] = "hello there\n";
size_t len = strlen(str);
if (len && str[len-1] == '\n') {
    str[len-1] = 0;
} 
```

就那么简单。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-11T09:07:43.660

如果您在使用可用的 GNU 扩展的系统上工作，则有一个叫做 getline (man 3 getline) 的东西，它允许您逐行读取文件，而 getline 会在需要时为您分配额外的内存。手册页包含一个示例，我修改该示例以使用 strtok (man 3 strtrok) 拆分行。

```
#include <stdio.h>
#include <stdlib.h>

int main(void)
{
    FILE * fp;
    char * line = NULL;
    size_t len = 0;
    ssize_t read;

    fp = fopen("/etc/motd", "r");
    if (fp == NULL)
    {
        printf("File open failed\n");
        return 0;
    }

    while ((read = getline(&line, &len, fp)) != -1) {
        // At this point we have a line held within 'line'
        printf("Line: %s", line);
        const char * delim = " \n";
        char * ptr; 
        ptr = (char * )strtok(line,delim);

        while(ptr != NULL)
        {
            printf("Word: %s\n",ptr);
            ptr = (char *) strtok(NULL,delim);
        }
    }

    if (line)
    {
        free(line);
    }
    return 0;
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-11T06:15:40.640

鉴于所有 stdio 函数中固有的缓冲，我很想用 getc() 逐个字符地读取流。如果需要，一个简单的有限状态机可以识别字边界和行边界。一个优点是完全没有缓冲区溢出，如果您的进一步处理需要它，除了您收集当前单词的任何缓冲区之外。

您可能想做一个快速基准测试，比较使用 getc() 与 fgets() 完全读取大文件所需的时间...

如果外部约束要求文件确实一次读取一行（例如，如果您需要处理来自 tty 的面向行的输入），那么 fgets() 可能是您的朋友，正如其他答案所指出的那样，但即便如此只要输入流在行缓冲模式下运行，getc() 方法就可以接受，如果标准输入在 tty 上，这对于标准输入很常见。

**编辑：**要控制输入流上的缓冲区，您可能需要调用 setbuf() 或 setvbuf() 将其强制为缓冲模式。如果输入流最终没有缓冲，那么在原始流上使用某种形式的显式缓冲区总是比 getc() 快。

最佳性能可能会使用与您的磁盘 I/O 相关的缓冲区，至少两个磁盘块的大小并且可能远不止于此。通常，即使是这种性能也可以通过将输入安排为内存映射文件并在处理文件时依赖内核的分页来读取和填充缓冲区，就好像它是一个巨大的字符串一样。

无论选择哪种方式，如果性能很重要，那么您将需要对几种方法进行基准测试并选择最适合您的平台的方法。即便如此，如果你的问题被编写、调试和使用，最简单的问题表达可能仍然是最好的整体答案。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T06:48:31.640

> 但这在 fscanf 中是不可能的，

是的，有点邪恶；）

**更新：关于邪恶的更多说明**

> 但不幸的是有点错误。我认为`[^\n]%*[^\n]`应该阅读`[^\n]%*`. 此外，应该注意这种方法会从行中去除空格。– 蜻蜓

请注意，`xstr(MAXLINE) [^\n]`读取`MAXLINE`的字符可以是换行符以外的任何字符（即`\n`）。说明符的第二部分即`*[^\n]`拒绝任何内容（这就是`*`字符存在的原因），如果该行有多个`MAXLINE`字符但***不***包括换行符。换行符告诉`scanf`停止匹配。如果我们按照蜻蜓的建议做呢？唯一的问题是`scanf`不知道在哪里停止并且会一直抑制分配，直到下一个换行符被击中（这是第一部分的另一个匹配项）。因此，您将在报告时跟踪一行输入。

如果你想循环阅读怎么办？需要稍作修改。我们需要添加一个`getchar()`来使用不匹配的换行符。这是代码：

```
#include <stdio.h>

#define MAXLINE 255

/* stringify macros: these work only in pairs, so keep both */
#define str(x) #x
#define xstr(x) str(x)

int main() {
    char line[ MAXLINE + 1 ];
    /* 
       Wickedness explained: we read from `stdin` to `line`.
       The format specifier is the only tricky part: We don't
       bite off more than we can chew -- hence the specification 
       of maximum number of chars i.e. MAXLINE. However, this
       width has to go into a string, so we stringify it using  
       macros. The careful reader will observe that once we have
       read MAXLINE characters we discard the rest upto and
       including a newline.
     */
    int n = fscanf(stdin, "%" xstr(MAXLINE) "[^\n]%*[^\n]", line);
    if (!feof(stdin)) {
        getchar();
    }
    while (n == 1) {
        printf("[line:] %s\n", line);
        n = fscanf(stdin, "%" xstr(MAXLINE) "[^\n]%*[^\n]", line);
        if (!feof(stdin)) {
            getchar();
        }
    } 
    return 0;
} 
```

# c++ - 静态代码分析器：非托管 C++ Visual Studio 2008

> ID：739594
> 
> 赞同：8
> 
> 时间：2009-04-11T05:52:31.540
> 
> 标签：c++, visual-studio, visual-c++, static-analysis

我在 Visual Studio 2008 上开发商业非托管 C++ 应用程序，我想添加一个静态代码分析工具。

有什么建议吗？

我认为如果该工具可以集成到 MSVC 中会非常好。

我正在考虑[PC-Lint](http://www.gimpel.com/) + [Visual Lint](http://www.riverblade.co.uk/products/visual_lint/index.html)

但是，我也一直在认真研究[Coverity](http://www.coverity.com/)、[Understand](http://www.scitools.com)和[Klockwork](http://www.klocwork.com/)。

价格真的不是问题。**我希望得到那些在 MSVC 上实际使用过非托管 C++**工具的人的意见，他们非常喜欢它。

最后，VSTS 和 Intel Parallel Studio 现在还提供静态代码分析。不错~

注意：相关[帖子](https://stackoverflow.com/questions/639694/are-c-static-code-analyis-tools-worth-it)建议 Coverity 是最好的（？）（见最后 2 个帖子）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T07:02:18.970

除了你提到的所有这些，VS Team Developer 版本还捆绑了一个很好的静态分析工具，称为 prefast。它（显然......）很好地集成到了 IDE 中，并且可以通过菜单访问。它实际上是一个 MS 内部工具的公开版本——一个名为 Prefix 的工具的精简版本，它们在他们的构建上运行。就个人而言，当我面临同样的决定时，prefast 就足够了。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-11T23:30:19.437

我刚开始使用我非常喜欢的[cppcheck ，因为它的噪音很低。](http://cppcheck.sourceforge.net/)

虽然它不直接与 Visual Studio 2008 集成，但可以自定义 VS，您应该可以将它直接集成到 IDE 中。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-10-10T00:37:30.817

我为 RedLizard 构建[Goanna](http://redlizards.com)工作，这是 Visual Studio 的 C++ 静态分析插件。它的重点是程序员使用桌面。您可以在单个文件上运行它，就像编译器一样，它可以快速为您提供结果。

有一个[试用版](http://redlizards.com/download.html)。右键单击文件，选择*Run Goanna*，结果将显示在 Visual Studio 警告列表中。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-06-29T15:06:12.980

You can try [CppDepend](http://www.cppdepend.com), a pretty complete c and c++ static analyzer, well integrated with VS 2008, 2010, 2012, 2013 and 2015.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-06-29T12:22:49.367

我使用[PVS-Studio 静态代码分析器](http://www.viva64.com/en/pvs-studio-download/)。这个静态代码分析器很好地与 Visual Studio 2005、2008、2010、2012、2013 集成。

它有许多附加功能：

1.  验证几天前最近修改过的文件；

2.  通过文本文件列表中的文件名验证文件；

3.  version control systems integration; ability to operate fro m command line interface;

4.  «False Alarms» marking; saving and loading of analysis results;

5.  utilizing all available cores and processors;

6.  etc...

# c - 为什么我对 wc 的实现只差一个字？

> ID：739596
> 
> 赞同：1
> 
> 时间：2009-04-11T05:54:47.087
> 
> 标签：c

**[已解决]**编写解析代码是个陷阱。有 15 个空格的行将有 15 个单词。空行也算作一个单词。回到我的弯曲和野牛。

```
#include        <stdio.h>                         
#include        <stdlib.h>                        

int     main(int argc, char     *argv[]) {

        FILE    *fp = NULL;
        int             iChars =0, iWords =0, iLines =0;
        int             ch;                             

        /* if there is a command line arg, then try to open it as the file
                otherwise, use stdin */                                   

        fp = stdin;
        if (argc == 2) {
                fp = fopen(argv[1],"r");
                if (fp == NULL) {       
                        fprintf(stderr,"Unable to open file %s. Exiting.\n",argv[1]);
                        exit(1);
                }
        }

        /* read until the end of file, counting chars, words, lines */
        while ((ch = fgetc(fp)) != EOF) {
                if (ch == '\n') {
                        iWords++;
                        iLines++;
                }

                if (ch == '\t' || ch == ' ') {
                        iWords++;
                }

                iChars++;
        }

        /* all done. If the input file was not stdin, close it*/
        if (fp != stdin) {
                fclose(fp);
        }

        printf("chars: %d,\twords: %d,\tlines: %d.\n",iChars,iWords,iLines);
} 
```

**测试数据 foo.sh**

```
#!/home/ojblass/source/bashcrypt/a.out
This is line 1
This is line 2
This is line 3 
```

> ojblass@linux-rjxl:~/source/bashcrypt> wc foo.sh
> 
> 5 **13** 85 foo.sh
> 
> ojblass@linux-rjxl:~/source/bashcrypt> a.out foo.sh
> 
> 字符：85， **字数：14，** 行数：5。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T06:01:48.413

你的算法是错误的。如果您在测试文件中连续有 2 个空白字符，则单词计数器将增加两次，但它应该只增加一次。

一个解决方案是记住最后读取的字符。如果读取的字符是特殊字符（空白、新行、...）并且前一个字符是字母数字，那么您增加单词的计数器。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-11T05:59:51.427

即使是空行，您也将 \n 视为一个单词。

# jquery - 使用 JQuery 访问受保护的 REST 端点

> ID：739598
> 
> 赞同：2
> 
> 时间：2009-04-11T05:58:55.003
> 
> 标签：jquery, wcf, authentication, rest

我有一个网站，成员可以登录到他们的帐户（FormsAuth）。我想设置一个可以使用 jQuery 访问的 RESTful 服务。我想使用相同的 FormsAuth 保护这些服务。

第三方站点如何能够访问这些服务？他们需要将 Principal/Identity 传递给服务，对吗？

我只看到了基本身份验证的示例（Twitter 使用并且 jQuery 支持）。

我对 WCT/REST 很陌生，所以不知道应该怎么做。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-14T17:57:36.233

要记住的重要一点是表单身份验证基于 cookie 工作。当客户端浏览器向服务器发送请求时，它会随每个请求一起发送 cookie。如果服务器需要特定的 cookie（如果您在特定 URL 上执行身份验证，ASP.NET 会要求这样做）并且 cookie 不存在，这就是您收到未经授权的错误的时候。

为了获取您的 jQuery 代码，客户端必须从主机页面请求它，该主机页面可能是受表单身份验证保护的 ASP.NET 页面。这是第一步 - 保护对 jQuery 代码本身的访问。您需要做的下一件事是安全访问 RESTful 端点。

如果您将 .svc 端点（假设您在 IIS 中托管 RESTful WCF 服务）作为应用程序的一部分（通过 Web.config 设置受表单身份验证保护）位于同一目录中，则 ASP.NET 将拒绝对WCF 之前的 .svc 端点被告知该请求。以这种方式，您可以将 WCF 服务包装在 Forms Authentication 中，而无需在服务中进行任何复杂的编码。

由于 jQuery 在向端点发出 HTTP 请求时是在浏览器的上下文中进行的，所以从 jQuery 发出的 HTTP 请求（只要 jQuery 是从与表单认证站点相同的根目录加载的）将包含身份验证 cookie .

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T18:23:51.210

您可以使其复杂化并使用令牌。[Flickr](http://www.flickr.com/services/api/flickr.auth.getToken.html)就是这种授权机制的一个例子。

从理论上讲，令牌的有效期很长，并且您在请求等中传递它。虽然它不是很RESTy（恕我直言）。但是您基本上提供了一种方法，该方法返回令牌和可能的日期（供其他应用程序记住），然后其他应用程序使用该令牌直到它过期，也就是它必须请求一个新的令牌。

# silverlight - Silverlight：用于重复触发事件的 MouseLeftButtonDown 计时器

> ID：739605
> 
> 赞同：1
> 
> 时间：2009-04-11T06:07:55.980
> 
> 标签：silverlight, events, silverlight-3.0, user-controls, scrollbar

我正在尝试创建一个自定义滚动条并使用图像作为按钮。

现在一个简单的

我可以很好地处理 MouseLeftButtonDown 和 Up 事件，但我想做的是在按住它的同时，每隔这么多毫秒触发一个事件。

我尝试过这样的事情，但它不是很有效。建议？

```
public delegate void Changed(RangeScrollButtonControl sender, int value);
public event Changed OnChanged;
private System.Threading.Timer Timer;

private void Image_MouseLeftButtonDown(object sender, MouseButtonEventArgs e)
{
    this.Timer = new System.Threading.Timer(Timer_Callback, null, 0, 100);
}

private void Image_MouseLeftButtonUp(object sender, MouseButtonEventArgs e)
{
    this.Timer = null;
}

private void Timer_Callback(object sender)
{
    if (this.OnChanged != null) 
    {
        this.OnChanged(this, 1);
    }
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-14T22:21:25.053

您正在寻找的功能是一个重复按钮，这将在按住鼠标按钮时重复触发它的 Click 事件。您可以配置事件的延迟和间隔。

然后，您可以设置此按钮的样式以使用[Silverlight Show 上的图像](http://www.silverlightshow.net/items/Using-the-RepeatButton-control-in-Silverlight-2.aspx)

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T02:55:11.480

哪一块“不太好用”？

此外，您能否重新设计或重新设计 Silverlght 的滚动条，类似于在此[博客文章](http://mark-dot-net.blogspot.com/2008/04/styling-listbox-in-silverlight-part-2.html)中看到的内容，以获得您需要的内容？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T12:08:04.833

我会使用故事板作为计时器。就像是：

然后你可以做一个 MouseSTB.Begin。故事板完成后，您可以在 MouseSTB.Completed 事件中捕捉它。在那种情况下，您可以做任何您需要做的事情，然后重新开始。它可以通过在 mouseover、mouseenter 和 mouseleave 事件上设置一些标志来轻松控制。我在很多地方都使用这些计时器，它们工作得很好，而且它们不会与处理器挂钩。

# time - 执行一个批处理文件需要多长时间？

> ID：739606
> 
> 赞同：20
> 
> 时间：2009-04-11T06:09:06.087
> 
> 标签：time, batch-file, executable

如何编写脚本来计算脚本完成所需的时间？

我以为会是这样，但显然不是..

```
@echo off
set starttime=%time%
set endtime=%time%

REM do stuff here

set /a runtime=%endtime%-%starttime%
echo Script took %runtime% to complete 
```

* * *

## 回答 #1

> 赞同：40
> 
> 时间：2009-04-11T06:41:45.493

关于原始批处理文件有两件事情发生。~~但从长远来看，两者都无济于事。~~

1.  无论您采用何种基准测试方法，请务必捕获操作*前的开始时间和操作**后*的结束时间。你的样本没有这样做。

2.  `%time%`计算结果类似于“12:34:56.78”，并且该`SET /A`命令不能减去这些。您需要一个生成简单标量时间戳的命令。

我本来想说它做不到，但是批处理语言比它所认为的要强大得多，所以这里是一个简单的 TIMER.BAT 实现。为了记录，Pax 在我摆弄时击败了我一个显示弦分裂的答案，并且 Johannes Rössel 建议将算术移到测量区域之外：

```
@echo off
setlocal

rem Remeber start time. Note that we don't look at the date, so this
rem calculation won't work right if the program run spans local midnight.
set t0=%time: =0%

rem do something here.... but probably with more care about quoting.
rem specifically, odd things will happen if any arguments contain 
rem precent signs or carets and there may be no way to prevent it.
%*

rem Capture the end time before doing anything else
set t=%time: =0%

rem make t0 into a scaler in 100ths of a second, being careful not 
rem to let SET/A misinterpret 08 and 09 as octal
set /a h=1%t0:~0,2%-100
set /a m=1%t0:~3,2%-100
set /a s=1%t0:~6,2%-100
set /a c=1%t0:~9,2%-100
set /a starttime = %h% * 360000 + %m% * 6000 + 100 * %s% + %c%

rem make t into a scaler in 100ths of a second
set /a h=1%t:~0,2%-100
set /a m=1%t:~3,2%-100
set /a s=1%t:~6,2%-100
set /a c=1%t:~9,2%-100
set /a endtime = %h% * 360000 + %m% * 6000 + 100 * %s% + %c%

rem runtime in 100ths is now just end - start
set /a runtime = %endtime% - %starttime%
set runtime = %s%.%c%

echo Started at %t0%
echo Ran for %runtime%0 ms 
```

您可以通过不打扰第二部分的百分之一来简化算术并对其整体准确性更加诚实。假设你有一个 sleep 命令或其他一些浪费时间的命令，它就在这里起作用：

```
C:> TIMER SLEEP 3
Script took 3000 ms to complete
C:> 
```

**编辑：**我按照评论中的建议修改了代码及其描述。

我认为，当 NT 团队将 COMMAND.COM 替换为 CMD.EXE 时，他们认为他们无法让它变得非常不同。但实际上，它几乎是一种全新的语言。如果启用了扩展，许多常用的常用命令都有新功能。

其中之一是`SETLOCAL`防止变量修改调用者的环境。另一个是`SET /A`给你大量的算术。我在这里使用的主要技巧是新的子字符串提取语法，这`%t:~3,2%`意味着在名为的变量的值中从偏移量 3 开始的两个字符`t`。

对于真正令人震惊的事情，请查看 set 的完整描述（尝试`SET /?`提示），如果这不会吓到您，请查看`FOR /?`并注意它可以解析文件中的文本......

**编辑 2：**修复了对 Frankie 在评论中包含`08`或`09`报告的时间字段的错误处理。调整了一些东西，并添加了一些评论。

请注意，这里有一个明显的疏忽，我可能不会修复。如果命令的开始日期与结束日期不同，它将不起作用。也就是说，它会做一些与一天中的时间相关的数学运算并报告差异，但差异并不意味着什么。

修复它以至少警告这种情况很容易。修复它以做正确的事情更难。

**编辑 3：**修复了 %h% 未正确设置单位数小时的错误。这是由于 %time% 返回“9:01:23.45”。注意空间。使用 %time: =0% 将空格替换为前导零，并且将正确设置 %h%。仅当脚本从一位数小时运行到下一小时时，才会发生此错误。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-11T06:28:40.673

这有点切线，但它可能会帮助你。

Microsoft 有一个 timeit.exe 程序，其工作方式或多或少类似于 unix 'time' 命令的增强版本。它出现在[Windows Server 2003 Resource Kit](http://www.microsoft.com/downloads/details.aspx?FamilyID=9D467A69-57FF-4AE7-96EE-B18C4790CFFD&displaylang=en)中，并且几乎取代了我一直想做的事情，就像你建议的那样。

可能值得一看。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2012-10-31T13:37:47.780

优秀的小程序。但是，如果计算跨越两天，则计算不正确。结果需要从 24 小时（8640000 厘秒）中减去。

还要删除相关行中重复的“设置”命令之一。

请注意，区域设置会影响 TIME 函数的格式，小数点在英国是句号而不是逗号。

线条

rem，我们可能已经测量了几天之间的时间

```
if %ENDTIME% LSS %STARTTIME% set set /A DURATION=%STARTTIME%-%ENDTIME% 
```

需要更改为

rem，我们可能已经测量了几天的时间

```
if %ENDTIME% LSS %STARTTIME% set /A DURATION=8640000 - (%STARTTIME% - %ENDTIME%) 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-11T06:24:39.950

我个人的偏好是安装 Cygwin 并使用该`time`命令，但是，如果您实际上*必须*将其作为批处理文件执行，则不能只减去字符串，您必须将它们视为部分。

以下脚本将为 10 秒的 ping 命令计时，该命令能够跨越一天的边界而不会被负数束缚。轻微的增强将允许它跨越许多天的界限。

```
@echo off
setlocal enableextensions enabledelayedexpansion
set starttime=%time%
ping -n 11 127.0.0.1 >nul: 2>nul:
set endtime=%time%

set /a hrs=%endtime:~0,2%
set /a hrs=%hrs%-%starttime:~0,2%

set /a mins=%endtime:~3,2%
set /a mins=%mins%-%starttime:~3,2%

set /a secs=%endtime:~6,2%
set /a secs=%secs%-%starttime:~6,2%

if %secs% lss 0 (
    set /a secs=!secs!+60
    set /a mins=!mins!-1
)
if %mins% lss 0 (
    set /a mins=!mins!+60
    set /a hrs=!hrs!-1
)
if %hrs% lss 0 (
    set /a hrs=!hrs!+24
)
set /a tot=%secs%+%mins%*60+%hrs%*3600

echo End     = %endtime%
echo Start   = %starttime%
echo Hours   = %hrs%
echo Minutes = %mins%
echo Seconds = %secs%
echo Total   = %tot%

endlocal 
```

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2011-03-11T17:31:03.910

查看此脚本，该脚本将通过 WMI 检索时间，因此它与区域设置无关。

```
@echo off
::::::::::::::::::::::::::::::::::::::::::
::  TimeDiff v1.00 by LEVENTE ROG       ::
::       www.thesysadminhimself.com     ::
::::::::::::::::::::::::::::::::::::::::::

::[ EULA ]:::::::::::::::::::::::::::::::::::::::::::::::::::::::::
::  Feel free to use this script. The code can be redistributed  ::
::  and edited, but please keep the credits.                     ::
:::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::

::[ CHANGELOG ]::::::::::::::
::  v1.00 - First Version  ::
:::::::::::::::::::::::::::::

FOR /F "skip=1 tokens=1-6" %%A IN ('WMIC Path Win32_LocalTime Get Day^,Hour^,Minute^,Second /Format:table ^| findstr /r "."') DO (
 set Milisecond=%time:~9,2% 
 set Day=%%A
 set Hour=%%B
 set Minute=%%C
 set Second=%%D
)
set /a Start=%Day%*8640000+%Hour%*360000+%Minute%*6000+%Second%*100+%Milisecond%

::
::
:: PUT COMMANDS HERE
ping www.thesysadminhimself.com
::
::

FOR /F "skip=1 tokens=1-6" %%A IN ('WMIC Path Win32_LocalTime Get Day^,Hour^,Minute^,Second /Format:table ^| findstr /r "."') DO (
 set Day=%%A
 set Hour=%%B
 set Minute=%%C
 set Second=%%D
)
set Milisecond=%time:~9,2% 
set /a End=%Day%*8640000+%Hour%*360000+%Minute%*6000+%Second%*100+%Milisecond%
set /a Diff=%End%-%Start%
set /a DiffMS=%Diff%%%100
set /a Diff=(%Diff%-%DiffMS%)/100
set /a DiffSec=%Diff%%%60
set /a Diff=(%Diff%-%Diff%%%60)/60
set /a DiffMin=%Diff%%%60
set /a Diff=(%Diff%-%Diff%%%60)/60
set /a DiffHrs=%Diff%

:: format with leading zeroes
if %DiffMS% LSS 10 set DiffMS=0%DiffMS!%
if %DiffSec% LSS 10 set DiffMS=0%DiffSec%
if %DiffMin% LSS 10 set DiffMS=0%DiffMin%
if %DiffHrs% LSS 10 set DiffMS=0%DiffHrs%

echo %DiffHrs%:%DiffMin%:%DiffSec%.%DiffMS% 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-11T06:21:25.090

您不能直接在批处理脚本中进行时间算术，因此您需要一个外部程序来计算时间差，或者提取时间的每个部分并以这种方式进行算术。

[查看此论坛主题](http://fixunix.com/ms-dos/23271-how-calculate-time-taken-batch-file-run.html)的底部，了解如何执行后者的示例。摘录在这里：

```
@echo 关闭
分类
REM ================================================== = ======
REM = 设置日期时间格式 =
REM ================================================== = ======
设置 DT=%DATE% %TIME%
设置年份=%DT:~10,4%
设置第 mth=%DT:~4,2%
设置日期=%DT:~7,2%
设置小时=%DT:~15,2%
设置 min=%DT:~18,2%
设置秒=%DT:~21,2%
设置 newDT=%year%_%mth%_%date% %hour%%min%%sec%

设置小时=14
设置最小值=10

REM ================================
REM = 获得结束时间 =
REM ================================
设置结束时间=%TIME%
设置 EndHour=%EndTime:~0,2%
设置 EndMin=%EndTime:~3,2%

REM ================================
REM = 寻找差异 =
REM ================================
设置 /a Hour_Diff=EndHour - 小时 >nul
设置 /a Min_Diff=EndMin - min >nul

REM ================================
REM = 时针变化？=
REM ================================
IF [%Hour_Diff]==[0] (

设置持续时间=%Min_Diff%
） 别的 （

设置 /a 持续时间=60-%Min_Diff% >nul
)

echo 开始时间 = %hour% : %min%
回声结束时间 = %EndHour% : %EndMin%
回声。
回声最小差异 = %Min_Diff%
回声。
回波时间差（分钟）= %Duration%

```

我也认为这是一个错字，但您确实希望确保在处理`endtime` *后*进行设置。

# asp.net-mvc - 在 ASP.NET MVC 中处理表单的正确方法是什么？

> ID：739608
> 
> 赞同：3
> 
> 时间：2009-04-11T06:11:46.377
> 
> 标签：asp.net-mvc, forms, webforms, view, controller

Forms + ASP.NET MVC = 让我困惑：

1.  **为表单帖子设置控制器操作的首选方法是什么？**

    *   我是否需要指定具有 [AcceptVerbs(HttpVerbs.Post)] 的属性？
    *   控制器操作应该采用“FormCollection”还是应该使用 ModelBinders？
    *   如果我应该使用 ModelBinders，如何使用？
2.  **如何在视图中设置表单？**

    *   我应该使用 Html 助手，如 Html.BeginForm/Html.EndForm 还是自己指定表单标签？
    *   您如何指定要在表单中使用的控制器和操作（使用 Html 帮助程序或使用手动表单标记）？

**有人可以向我展示一个带有表单的简单视图〜和〜它对应的控制器动作吗？**

我正在尝试使用单个文本框编写一个表单，我可以将其提交给 Home/Create 操作并将字符串从文本框传递给它。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-11T08:24:50.737

ScottGu 的[处理表单编辑和发布场景](http://weblogs.asp.net/scottgu/archive/2007/12/09/asp-net-mvc-framework-part-4-handling-form-edit-and-post-scenarios.aspx)正是您想要的。还有[表单发布场景](http://weblogs.asp.net/scottgu/archive/2008/09/02/asp-net-mvc-preview-5-and-form-posting-scenarios.aspx)，即使它是为预览版 5 编写的，它仍然大部分是有效的。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T06:34:16.493

模板的 AccountController.LogOn 和 .Register 方法以及相应的视图应该为您提供所需的简单介绍。

# data-structures - 传递延迟消息并检查唯一性的消息队列

> ID：739609
> 
> 赞同：1
> 
> 时间：2009-04-11T06:13:56.480
> 
> 标签：data-structures, message-queue

我有一个接收传入事件的在线服务（每秒很少）。服务需要在 30 秒或更长时间没有事件时处理作业。服务分布在多台 PC 上，并使用 Amazon Web 服务（SQS 和 SimpleDB）作为主干。

我了解当有传入事件时如何安排作业（只需将消息放入消息队列即可完成），但是当条件为“X 秒内无事件”时如何安排作业？

理想情况下，我想要一个不允许重复消息、允许安排未来并允许调整每条消息的“交付日期”的消息队列。

有这样的消息队列实现吗？这个问题是否可以完全解决而无需在数据库中保留一些数据？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T06:39:32.347

BizTalk 或 SQL Server Service Broker 都符合您的要求。如果它们太重，您可以编写一个简单的服务，每隔几秒查看一次队列，如果在 30 秒内没有看到任何内容，则超时。然而，跨机器水平扩展将更加困难。

# .net - 图像识别库

> ID：739613
> 
> 赞同：0
> 
> 时间：2009-04-11T06:19:48.090
> 
> 标签：.net, image-processing, image-recognition

我想知道.Net中是否有任何称职的图像识别库（最好是开源的）？我有一个批量扫描页面和文档的应用程序。为了将一个文档与另一个文档分开（因为这些文档可能有多个页面），我计划要求用户放置一个页面，上面有一个北极熊图像来分隔文档。所以我的应用程序会进行所有的扫描，检查页面是否包含北极熊，如果是，则将其称为第一个文档的结尾。

我知道 OCR，应用程序将在其中识别文本，但图像中的等价物呢？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T06:48:59.860

我不确定我是否完全理解您要执行的操作，但您可以查看以下问题：

*   [一种简单的工具来比较不同格式的图像像素换像素](https://stackoverflow.com/questions/691799/an-easy-way-tool-to-compare-images-pixel-for-pixel-in-different-formats)
*   [删除重复图像](https://stackoverflow.com/questions/225210/removing-duplicate-images)
*   [是否有任何好的图像识别库换网](https://stackoverflow.com/questions/152028/are-there-any-ok-image-recognition-libraries-for-net)
*   [bmp 文件比较](https://stackoverflow.com/questions/649720/comparison-of-bmp-files)

如果您想自己实现一些东西来将图像与另一个图像的一部分进行比较。您可以通过使用模板匹配来做到这一点。您可以使用[OpenCV](http://opencv.willowgarage.com/wiki/)，它也有一个[.NET 包装器](http://www.emgu.com/wiki/index.php/Main_Page)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T06:38:26.623

我没有关于图像识别的一般问题的答案，但鉴于您的具体要求，替换一个更简单的识别域会不会更容易？

具体来说，在您要求用户在文档之间放置的页面上，您可以包含一个漂亮的粗条码以及北极熊（或其他）图像。然后，您可以检查易于识别的条形码，而不必识别北极熊图像本身。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-26T01:04:03.983

Maybe this framework could be of help:

[AForge.NET Framework](http://www.aforgenet.com/)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-11T10:57:38.967

也许值得看一下[二维码](http://en.wikipedia.org/wiki/QR_Code)？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-12T08:43:02.073

图像识别很难，主要是因为每个不同的应用程序都需要不同的解决方案。例如，尝试识别白色背景上的单个黑色符号需要一种完全不同的技术，而不是尝试识别彩色照片中的所有人，其中一些人重叠并且背景中有风景。会影响使用哪种方法的一些因素是：

*   **图像类型：**符号/字符、日常照片、医学图像、形状等。
*   **颜色：**黑白、灰度、彩色
*   **感兴趣的物体：**人脸、人物、形状、符号、一般物体、指纹、虹膜、肿瘤等。
*   **训练：**你有训练数据集吗？

所以你真正需要做的是告诉我们更多关于你试图识别的图像类型的信息，这样我们就可以告诉你什么库和最好的方法。

# api - Eclipse 插件 API：如何为特定平台插件添加 javadoc 支持？

> ID：739616
> 
> 赞同：2
> 
> 时间：2009-04-11T06:21:21.860
> 
> 标签：api, eclipse-plugin, javadoc, jface

使用 Eclipse 3.4 Ganymede，我找不到为所有平台插件 api 添加 javadoc 支持的方法，但特别是对 JFace e Ui Forms 包。

打开链接到名为“插件依赖项”的库的任何 jar 的属性面板，我在“Javadoc 位置”节点中收到以下消息：

> 当前的类路径条目属于容器“插件依赖项”，它不允许用户修改其条目中的 Javadoc 位置”...

这是什么意思，我必须用一些有线的 javadoc 位置重新构建 Eclipse？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T10:25:24.440

如果您安装了 eclipse SDK [“经典”、“RCP/Plugin”或“Modeling”](http://www.eclipse.org/downloads/packages/compare-packages)，则意味着包含 eclipse 插件的源代码。

虽然您确实无法为这些插件设置 Javadoc，但您仍然可以访问该文档，因为源代码在这里，完全“Java 文档化”。

如果没有源，您仍然可以在专用工作区中[导入所有 eclipse 插件及其源](http://www.vogella.de/articles/EclipseCodeAccess/article.html)。

[替代文字 http://www.vogella.de/articles/EclipseCodeAccess/images/eclipsesource30.gif](http://www.vogella.de/articles/EclipseCodeAccess/images/eclipsesource30.gif)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-07-19T18:32:16.370

我正在使用带有可视化编辑器 1.4.0 的 eclipse 3.4.2。出于某种原因，我的 Eclipse 默认找不到 swt javadocs，并且“导入插件方法”不起作用。但我找到了一个工作：

项目属性 -> Java 构建路径 -> 库 -> 添加外部 Jar 添加 /plugins/org.eclipse.swt.gtk.linux.x86_64.3.4.1.v3452b.jar

将“源附件”编辑为 org.eclipse.swt.gtk.linux.x86_64.source_3.4.1.v3452b.jar

按确定。请注意，您现在正在使用 swt "两次" :O)

如果仍然无法正常工作，请转到同一个对话框，删除“Standard Widget Toolkit (SWT)”，然后按确定。返回对话框并使用按钮“添加库”-> SWT -> IDE 平台再次添加它。按确定。关闭所有可视化编辑器。并转到项目-> 清洁...

现在您的 Javadocs 直接显示在 Eclipse 中，并且 Visual Editor 仍然可以工作。

# database - 在数据库中维护历史

> ID：739623
> 
> 赞同：7
> 
> 时间：2009-04-11T06:30:17.503
> 
> 标签：database, linq-to-sql, database-design, triggers, history

我正在设计这个数据库，它必须保留员工工资和组织内变动的历史记录。基本上，我的设计有 3 个表（我的意思是，还有更多的表，但对于这个问题，我会提到 3 个，所以请耐心等待）。Employee 表（包含最新的薪水、职位数据等）、SalaryHistory 表（薪水、日期、原因等）和 MovementHistory（职务、部门、评论）。我将使用 Linq to Sql，所以我的想法是每次更新员工数据时，旧值都会被复制到各自的历史表中。**这是一个好方法吗？我应该使用 Linq to SQL 还是触发器来完成它？**感谢您的任何帮助、建议或想法。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-11T06:46:37.197

看看[http://www.simple-talk.com/sql/database-administration/database-design-a-point-in-time-architecture](http://www.simple-talk.com/sql/database-administration/database-design-a-point-in-time-architecture)。

基本上，这篇文章建议您在需要跟踪历史记录的表中有以下列 -

```
* DateCreated – the actual date on which the given row was inserted.
* DateEffective – the date on which the given row became effective.
* DateEnd – the date on which the given row ceased to be effective.
* DateReplaced – the date on which the given row was replaced by another row.
* OperatorCode – the unique identifier of the person (or system) that created the row. 
```

DateEffective 和 DateEnd 一起告诉您该行有效的时间（或员工在部门的时间，或他获得特定薪水的时间）。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-11T06:38:51.570

将该逻辑保留在数据库内部是一个好主意：这基本上就是触发器存在的原因。但是，我要小心地说，因为有很多理由将其保留在外部。很多时候——尤其是使用像 LINQ-to-SQL 这样简单的技术——在外部编写代码更容易。根据我的经验，使用 C#/LINQ 编写该逻辑的人比使用触发器正确编写的人多。

触发器很快 - 它们已编译！但是，它们很容易被误用，并使您的逻辑过于复杂，以至于性能会迅速下降。考虑到您的用例有多简单，**我会选择使用 triggers**，但这是我个人的情况。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-11T06:40:15.060

触发器可能会更快，并且不需要“中间人”来完成工作，从而至少消除了一次出错的机会。

根据您选择的数据库，您可以只使用一个表并在其上启用 OID，然后再添加两列，“flag”和“previous”。永远不要更新这个表，只插入。添加一个触发器，以便在为员工#id 添加一行时，将所有具有员工#id 的记录设置为具有“旧”标志，并将新行的“上一个”值设置为前一行。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-11T11:32:32.173

我认为这属于数据库有两个原因。

首先，中间层来来去去，但数据库永远存在。今年是 Java EJB，明年是 .NET，后年是别的东西。根据我的经验，数据仍然存在。

其次，如果数据库是完全共享的，它不应该依赖每个使用它的应用程序来知道如何维护其数据完整性。我认为这是一个封装数据库的例子。为什么要强制每个客户了解和维护历史？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-11T06:50:26.847

触发器使您的前端更容易迁移到其他东西，并且无论如何插入/更新/删除数据，它们都会保持数据库的一致性。

此外，在您的情况下，我会将工资直接写入工资历史记录-从您的描述中，我看不出您应该通过员工表上的更新触发器来解决问题的原因。

# python - setattr 与 kwargs，pythonic 与否？

> ID：739625
> 
> 赞同：19
> 
> 时间：2009-04-11T06:31:19.370
> 
> 标签：python, initialization

我`__init__()`在一些具有许多参数（最多 20 个）的 SQLAlchemy ORM 类中使用这样的方法。

```
def __init__(self, **kwargs):
    for k, v in kwargs.iteritems():
        setattr(self, k, v) 
```

设置这样的属性是“pythonic”吗？

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-04-11T11:04:09.980

是的。另一种方法是。

```
def __init__(self, **kwargs):
    self.__dict__.update( kwargs ) 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-13T14:58:48.543

是的，如果没有提供论点的“更好”方式。

例如，使用您提到的 ORM 类，也许它会更 Python'y 允许..

```
col = Varchar()
col.index = True
col.length = 255 
```

..而不是..

```
col = Varchar(index = True, length = 255) 
```

好吧，这不是最好的例子，因为该`**kwargs`方法实际上会更好.. 但我的观点是，在使用有时不受欢迎的东西之前，您应该始终考虑实现某些目标的替代方法`**kwargs`..

要记住的另一件事是，您可能会失去用户期望的行为，例如如果用户提供了无效的关键字 arg，则引发 TypeError，这可以像..

```
def __init__(self, **kwargs):
    valid_kwargs = ['x', 'y', 'z']
    for k, v in kwargs.iteritems():
        if k not in valid_kwargs:
            raise TypeError("Invalid keyword argument %s" % k)
        setattr(self, k, v) 
```

最后要考虑的事情：

```
class Hmm:
    def __init__(self, **kwargs):
        for k, v in kwargs.iteritems():
            setattr(self, k, v)
    def mymethod(self):
        print "mymethod should print this message.."

x = Hmm(mymethod = None)
x.mymethod() # raises TypeError: 'NoneType' object is not callable 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T06:49:43.603

对我来说，如果您只在代码中的一个地方需要它，这似乎很pythonic。

以下链接为同一问题提供了一种更“通用”的方法（例如，使用装饰器和一些额外功能），请查看：[http ://code.activestate.com/recipes/551763/](http://code.activestate.com/recipes/551763/)

# asp.net - 数据访问 ASP.NET

> ID：739628
> 
> 赞同：1
> 
> 时间：2009-04-11T06:34:53.420
> 
> 标签：asp.net, dataset, data-access, system.data.datatable

我建立了一个在线新闻门户网站，之前它对我来说很好，但有人说主页有点慢。当我想到它时，我看到了一个原因。

网站首页显示

1.  头条新闻
2.  现场新闻（副标题
3.  有图片的景点
4.  阅读最多的新闻（作为标题）
5.  评论最多的新闻（作为标题）
6.  每个新闻类别 5 个新闻标题（总共 11 个，例如体育、经济、地方、健康等）

现在，每一个都是对数据库的单独查询。我有 tableadapter 数据集和数据表（标准数据访问场景），所以对于标题，我调用新闻类中的业务逻辑，它通过 tableadapter 返回数据表。从那里开始，我要么通过将数据表绑定到控件来使用数据表，要么（大多数情况下）对象将其转换为（新闻）列表，然后我从那里使用它。

为上述每一项执行此操作似乎都可以正常工作。至少它不会带来巨大的负担。但是让我想知道是否有更好的方法。

例如，我上面描述的项目是一个高度动态的网站，当新闻从机构 24 小时不间断地到达时插入。所以在这种情况下缓存可能听起来不太好。但另一方面，我知道当地报纸还有另一个类似的项目。该网站每天只会更新一次。在这种情况下：我是否可以只运行一个查询，它会返回一个包含今天插入的所有新闻项目的数据表，然后查询该数据表并将标题、热点和其他项目放在网站上各自的位置？或者周围有更好的选择吗？我只是想知道其他人如何以最有效的方式执行类似的任务。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T06:41:45.273

如果你的表现很差，你的第一步不是开始胡闹。**分析您的代码。**找出为什么它很慢。是传输页面、渲染页面还是动态生成页面的速度变慢了？单个查询是否耗时太长？

准确找出瓶颈在哪里，从根本上解决问题。

缓存也是一个非常好的主意，即使在内容更新得相当快的情况下也是如此。只要你的缓存机制是智能的，你仍然会节省大量的生成时间。对于新闻门户或博客而不是论坛，您可能会通过缓存系统大大提高性能。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-11T07:35:19.810

我认为您应该使用 FireBug 找出哪些元素需要时间来加载。有时大图像会破坏节目（屏幕上图像的大小并不总是相对于其下载大小）。

其次，您可以下载 Yahoo Firefox 插件 YSlow 并检查您是否有任何变慢的脚本。

但 Firebug 应该给你最好的评价。加载 Firebug 后，单击“Net”选项卡以查看页面中每个元素的加载时间。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T07:12:02.037

如果您发现延迟来自数据库，请检查您的表，确保根据表中的数据量对它们进行正确的索引、集群或其他任何您需要的操作。此外，如果您使用动态查询，请尝试使用存储过程。

如果您想在一个数据库请求中完成多个查询，您可以。由于最初在所有查询完成之前您不会显示任何数据，并且除非出现任何其他问题，因此您至少可以节省每次查询再次访问数据库的时间。DataSet 包含一组表，它们可以由同一个请求中的多个查询生成。

ASP.NET 已经为您提供了一个非常好的缓存机制 (HttpContext.Cache)，您可以将其包裹起来并使其更易于使用。由于您可以为缓存对象设置生命周期，因此您不必担心文章和标题不是最新的。

如果您在该网站上使用 WebForms，请禁用那些并不真正需要它们的控件的 ViewState，以使页面加载速度更快一些。更不用说许多其他的调整和更改以使页面加载更快（gzipping、最小化脚本等）

尽管如此，在执行任何操作之前，请按照[Anthony 的建议](https://stackoverflow.com/questions/739628/data-access-asp-net/739633#739633)执行并分析您的代码。找出真正的问题是什么。

# c# - 哪些是您的 asp.net C# 调试包装器

> ID：739635
> 
> 赞同：0
> 
> 时间：2009-04-11T06:44:28.450
> 
> 标签：c#, asp.net

没有收到任何确切的答案，因此我不得不接受我的……见下面的代码

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-20T07:30:57.620

我只是希望有人也会建议其他选项，例如[log4net](http://logging.apache.org/log4net/download.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T11:13:31.923

```
using System;
using System.Text.RegularExpressions;
using System.Data;
using System.Collections.Specialized;
using System.Text;

namespace YourDebug.Name.Space
{

/// <summary>
///Debugs passed objects and returns ready formatted html with the objects values
/// </summary>
public class HtmlDebugger
{
    public static string DumpDataSet(string msg, DataSet ds)
    {
        StringBuilder sb = new StringBuilder();

        sb.Append("<p> START " + msg + "</p>");
        if (ds == null)
            return msg + " null ds passed ";

        if (ds.Tables == null || ds.Tables.Count == 0)
            return msg + " no tables in ds ";

            sb.Append("<p> DEBUG START --- " + msg + "</p>");            
            foreach (System.Data.DataTable dt in ds.Tables)
            {
                sb.Append("================= My TableName is  " +
                dt.TableName + " ========================= START");
                sb.Append("<table>\n");
                int colNumberInRow = 0;
                foreach (System.Data.DataColumn dc in dt.Columns)
                {
                    sb.Append(" <th>  ");
                    sb.Append(" |" + colNumberInRow + "| ");
                    sb.Append(dc.ColumnName + " </th> ");
                    colNumberInRow++;
                } //eof foreach (DataColumn dc in dt.Columns)
                int rowNum = 0;
                foreach (System.Data.DataRow dr in dt.Rows)
                {
                    string strBackGround = String.Empty;
                    if (rowNum% 2 == 0)
                        strBackGround = " bgcolor=\"#D2D2D2\" "; 

                    sb.Append("\n " + rowNum + "<tr " + strBackGround + " >");
                    int colNumber = 0;
                    foreach (System.Data.DataColumn dc in dt.Columns)
                    {
                        sb.Append("<td> |" + colNumber + "| ");
                        sb.Append(dr[dc].ToString() + " </td>");
                        colNumber++;
                    } //eof foreach (DataColumn dc in dt.Columns)
                    rowNum++;
                    sb.Append("</tr>");
                }    //eof foreach (DataRow dr in dt.Rows)
                sb.Append(" \n");
                sb.Append("</table>");
            }    //eof foreach (DataTable dt in sb.Append.Tables)
            sb.Append("<p> DEBUG END--- " + msg + "</p>");            

            return sb.ToString();

    }//eof method  

    public static string DumpMsgList(string msg, 
    System.Collections.Generic.List<GenApp.Dh.Msg> listMsgs)
    {

        System.Text.StringBuilder echo = new System.Text.StringBuilder();
        if (listMsgs == null)
            return "null listMsgs passed for debugging ";

        if (listMsgs.Count == 0)
            return "listMsgs.Count == 0"; 

        echo.Append("<table>");
        for (int msgCounter = 0; msgCounter < listMsgs.Count; msgCounter++)
        {
            GenApp.Dh.Msg objMsg = listMsgs[msgCounter];
            string strBackGround = String.Empty;
            if (msgCounter % 2 == 0)
                strBackGround = " bgcolor=\"#D2D2D2\" "; 

            echo.Append("<tr" + strBackGround + ">");
            echo.Append("<td>msg.MsgKey</td> <td> " + objMsg.MsgKey + "</td>");
            echo.Append("<td>msg.MsgId</td><td>" + objMsg.MsgId + "</td>");
            echo.Append("</tr>");
        } //eof foreach 
        echo.Append("</table>");
        return echo.ToString();

    } //eof method 

    public static string DumpIDataReader(string msg, IDataReader rdr)
    {
        StringBuilder sb = new StringBuilder();

        if (rdr == null)
            return " <p> IDataReader rds is null </p>";

            sb.Append("DEBUG START ---" + msg);
            sb.Append("<table>");
            int counter = 0; 
            while (rdr.Read() )
            {
                string strBackGround = String.Empty;
                if (counter % 2 == 0)
                    strBackGround = " bgcolor=\"#3EBDE8\" "; 

                sb.Append("<tr" + strBackGround + ">");
                for (int i = 0; i < rdr.FieldCount; i++)
                {
                    sb.Append("<td>");
                    sb.Append(rdr[i].ToString() + " ");
                    sb.Append("<td>");
                } //eof for 
                sb.Append("</br>");
                sb.Append("</tr>");
                counter++; 
            }
            sb.Append("<table>");
            sb.Append("DEBUG END ---" + msg);

            return sb.ToString();        
    } //eof method 

    public static string DumpListDictionary(string msg , 
    ListDictionary list)
    {
      if (list == null)
        return "<p> null list passed </p>";

      if (list.Count == 0)
        return "<p> list.Count = 0 </p> "; 

          System.Text.StringBuilder sb = new System.Text.StringBuilder();

          sb.Append("<p> START DUMP " + msg + " </p>");
          sb.Append("<table>");

          int counter = 0; 
          foreach (object key in list.Keys)
          {
            string strBackGround = String.Empty;
            if (counter % 2 == 0)
              strBackGround = " bgcolor=\"#D2D2D2\" ";

            sb.Append("<tr" + strBackGround + "><td> key - </td><td> " + 
            key.ToString());
            sb.Append("</td><td>===</td><td>value - </td><td> " + list[key] + 
            "</td></br></tr>");
            counter++;
          } //eof foreach 

          sb.Append("</table>");
          sb.Append("<p> END DUMP " + msg + " </p>");
      return sb.ToString();
    } //eof method 

} //eof class 
```

} //eof 命名空间

# iphone - 触及 UILabel

> ID：739637
> 
> 赞同：0
> 
> 时间：2009-04-11T06:44:43.160
> 
> 标签：iphone

在我在模拟器上测试时，在我的程序标签中没有检测到触摸。但它在设备上运行良好。为什么会这样？我想在模拟器上工作时捕获我的应用程序的视频。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T13:02:58.010

如果您需要快速解决方法来录制视频，只需在标签顶部放置一个清晰的 UIButton 即可在点击时调用相同的功能。

# asp.net - 您将如何在 asp.net 中设计 BPM 应用程序？

> ID：739645
> 
> 赞同：0
> 
> 时间：2009-04-11T06:50:47.827
> 
> 标签：asp.net, database-design, entity-attribute-value

我们创建了一个简单的基于 asp.net/sqlserver 2000 的业务流程管理工具，其中我们有一个功能，用户可以创建简单的单列表单并附加到流程并定义规则和路径。

我们将动态创建的表单控件值保存在 EAV 设计表中，但是随着事务的增加，我们在报告自定义表单值时遇到了性能问题，我的问题是这个问题的替代方案是什么，其中 BPM 解决方案的主要要求是该用户将动态创建表单，你们认为其他大型 BPM 供应商（如 Skelta/ultimus/K2.net）的实施正在管理这一要求。**你的东西xml可以救我吗？如果是，那么你们将如何或如何设计 BPM 应用程序的模型**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T07:17:57.373

我不是 EAV 的粉丝。它使用关系数据库来解决关系数据库无法解决的问题。

我建议您设计一种[特定于域的语言](http://en.wikipedia.org/wiki/Domain-specific_language)来表示您的表单定义。您可以使用 XML 作为一种格式。

否则，您应该将[RDF](http://www.openrdf.org)用于动态结构化数据。

# asp.net - 尝试通过 LAN 测试 ASP.NET 网站

> ID：739646
> 
> 赞同：0
> 
> 时间：2009-04-11T06:50:58.793
> 
> 标签：asp.net

我在工作组 LAN 上安装了 XP Pro 和 Vista 机器，正常情况下使用 NAT 路由器/adsl 调制解调器。Latop是无线的。

XP Pro 笔记本电脑上有 IIS，我编写了一个 ASP.NET 应用程序。

当我尝试从 Vista PC 上的浏览​​器访问该应用程序时，我收到一条错误消息，提示无法连接到站点。

我尝试了以下方法：

1.  可以从 Vista PC ping XP Pro PC。
2.  从 Windows 防火墙打开 Web 访问。
3.  重新启动。
4.  当我远程登录它时，我收到 http 400 错误请求。

请问有什么我没有做的吗？

马尔科姆

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T07:39:49.393

如果您允许通过防火墙进行访问，我建议您查看网站的 IIS 设置。是否允许匿名访问？如果不需要，您需要什么样的身份验证？该网站实际上是否在您请求的网址中运行？

由于 IIS 设置，会出现许多不同的问题。玩每一个可能的原因，一次一个，直到你找出真正的原因，如果你仍然找不到它，一次玩两个。

当您最终发现问题时，请记住它，因为 IIS 的问题往往会被遗忘，然后您必须重新检查所有内容。可悲的是，我从经验中知道这一点。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T06:56:36.300

您是否正在使用 ASP.net 开发服务器调试您的项目？我相信服务器不接受外部连接。

# iphone - 如何在 iPhone 上显示流媒体视频

> ID：739647
> 
> 赞同：0
> 
> 时间：2009-04-11T06:52:52.610
> 
> 标签：iphone, video, streaming

我正计划编写一个 iPhone 应用程序，它可以显示来自互联网的流式音频/视频（后端很可能是 Red5 或 Wowza 并且视频将在 RTMP 上流式传输（尽管我可以选择更改它）。关于实施的任何想法？

[http://www.youtube.com/watch?v=5-UoLsSSw30](http://www.youtube.com/watch?v=5-UoLsSSw30)演示了与我的想法类似的东西。

--
米

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-01-07T11:11:32.973

[您最好了解这一点](http://www.tuaw.com/2009/12/16/apple-requiring-the-http-live-stream-protocol-for-iphone-apps)，然后开始研究[HTTP Live Streaming](https://datatracker.ietf.org/doc/html/draft-pantos-http-live-streaming-02)！

显示视频就像`<video>`在 HTML5 页面中添加标签一样简单，但也应该有一个 API（我不是 iPhone 开发人员）

# python - 将多个负正则表达式应用于 Python 中的表达式

> ID：739651
> 
> 赞同：1
> 
> 时间：2009-04-11T06:58:44.470
> 
> 标签：python, regex, coding-style

这个问题类似于[“How to concisely cascade through multiple regex statements in Python”](https://stackoverflow.com/questions/597476/how-to-concisely-cascade-through-multiple-regex-statements-in-python)，除了不是匹配一个正则表达式而是做一些我需要确保我不匹配一堆正则表达式，并且如果没有找到匹配项（又名我有有效的数据）然后做点什么。我找到了一种方法，但我认为必须有更好的方法，特别是如果我最终得到许多正则表达式。

基本上，我正在过滤 URL 中的坏东西（“”，\\“等），当我从 HTML 文档中拉出看起来像有效的 URL 但结果是 JavaScript 的一部分（因此需要被评估，因此转义字符）。我不能使用 Beautiful Soup 来处理这些页面，因为它们远未损坏（实际上我使用 BeautifulSoup，然后回退到我丑陋但可行的解析器）。

到目前为止，我发现以下工作相对较好：我在主循环之外编译一个 dict 或正则表达式（所以我只需要编译一次，但每次使用它都会受益于速度的提高），然后我循环一个 URL通过这个 dict，如果匹配，则 URL 是错误的，如果不是，则 url 是好的：

```
regex_bad_url = {"1" :   re.compile('\"\"'),
                 "2" :   re.compile('\\\"')} 
```

其次是：

```
url_state = "good"

for key, pattern in regex_bad_url_components.items():
    match = re.search(pattern, url)
    if (match):
        url_state = "bad"

if (url_state == "good"):
# do stuff here ... 
```

现在明显的想法是使用正则表达式“或”（“|”），即：

```
re.compile('(\"\"|\\\")') 
```

这减少了比较次数和诸如此类的东西，但使故障排除变得更加困难（每次比较一个表达式，我可以轻松地添加一个打印语句，例如：

```
print "URL: ", url, " matched by key ", key 
```

那么是否有某种方法可以两全其美（即比较次数最少），但仍然能够打印出哪个正则表达式与 URL 匹配，或者我只是需要硬着头皮让我的代码更慢但更容易解决问题调试时，然后将所有正则表达式合并到一条生产线中？（这意味着多一步的编程和代码维护以及可能的问题）。

更新：

Dave Webb 的回答很好，因此实际代码如下所示：

```
match = re.search(r'(?P<double_quotes>\"\")|(?P<slash_quote>\\\")', fullurl)
if (match == None):
    # do stuff here ...
else:
    #optional for debugging
    print "url matched by", match.lastgroup 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T07:09:30.373

将所有正则表达式“Squoosh”放在一行中，但将每个正则表达式放在一个命名组中，[`(?P<name>...)`](http://docs.python.org/library/re.html#regular-expression-syntax)然后使用[`MatchOjbect.lastgroup`](http://docs.python.org/library/re.html#match-objects)它来查找匹配的。

# python - 如何制作函数装饰器并将它们链接在一起？

> ID：739654
> 
> 赞同：3005
> 
> 时间：2009-04-11T07:05:31.503
> 
> 标签：python, decorator, python-decorators

如何在 Python 中制作两个可以执行以下操作的装饰器？

```
@makebold
@makeitalic
def say():
   return "Hello" 
```

...应该返回：

```
"<b><i>Hello</i></b>" 
```

我并不想`HTML`在真实的应用程序中采用这种方式——只是想了解装饰器和装饰器链接是如何工作的。

* * *

## 回答 #1

> 赞同：4546
> 
> 时间：2009-10-20T13:05:46.550

如果您不喜欢冗长的解释，请参阅[Paolo Bergantino 的回答](https://stackoverflow.com/questions/739654/understanding-python-decorators#answer-739665)。

# 装饰器基础

## Python 的函数是对象

要了解装饰器，首先必须了解函数是 Python 中的对象。这具有重要的后果。让我们用一个简单的例子来看看为什么：

```
def shout(word="yes"):
    return word.capitalize()+"!"

print(shout())
# outputs : 'Yes!'

# As an object, you can assign the function to a variable like any other object 
scream = shout

# Notice we don't use parentheses: we are not calling the function,
# we are putting the function "shout" into the variable "scream".
# It means you can then call "shout" from "scream":

print(scream())
# outputs : 'Yes!'

# More than that, it means you can remove the old name 'shout',
# and the function will still be accessible from 'scream'

del shout
try:
    print(shout())
except NameError as e:
    print(e)
    #outputs: "name 'shout' is not defined"

print(scream())
# outputs: 'Yes!' 
```

请记住这一点。我们很快就会回到它。

Python 函数的另一个有趣特性是它们可以在另一个函数中定义！

```
def talk():

    # You can define a function on the fly in "talk" ...
    def whisper(word="yes"):
        return word.lower()+"..."

    # ... and use it right away!
    print(whisper())

# You call "talk", that defines "whisper" EVERY TIME you call it, then
# "whisper" is called in "talk". 
talk()
# outputs: 
# "yes..."

# But "whisper" DOES NOT EXIST outside "talk":

try:
    print(whisper())
except NameError as e:
    print(e)
    #outputs : "name 'whisper' is not defined"*
    #Python's functions are objects 
```

## 函数参考

好的，还在吗？现在有趣的部分...

您已经看到函数是对象。因此，功能：

*   可以分配给变量
*   可以在另一个函数中定义

这意味着**一个函数可以`return`另一个函数**。

```
def getTalk(kind="shout"):

    # We define functions on the fly
    def shout(word="yes"):
        return word.capitalize()+"!"

    def whisper(word="yes") :
        return word.lower()+"..."

    # Then we return one of them
    if kind == "shout":
        # We don't use "()", we are not calling the function,
        # we are returning the function object
        return shout  
    else:
        return whisper

# How do you use this strange beast?

# Get the function and assign it to a variable
talk = getTalk()      

# You can see that "talk" is here a function object:
print(talk)
#outputs : <function shout at 0xb7ea817c>

# The object is the one returned by the function:
print(talk())
#outputs : Yes!

# And you can even use it directly if you feel wild:
print(getTalk("whisper")())
#outputs : yes... 
```

还有更多！

如果您可以`return`使用函数，则可以将其作为参数传递：

```
def doSomethingBefore(func): 
    print("I do something before then I call the function you gave me")
    print(func())

doSomethingBefore(scream)
#outputs: 
#I do something before then I call the function you gave me
#Yes! 
```

好吧，你已经具备了理解装饰器所需的一切。您会看到，装饰器是“包装器”，这意味着**它们允许您在它们装饰的函数之前和之后执行代码，而**无需修改函数本身。

## 手工装饰器

你将如何手动进行：

```
# A decorator is a function that expects ANOTHER function as parameter
def my_shiny_new_decorator(a_function_to_decorate):

    # Inside, the decorator defines a function on the fly: the wrapper.
    # This function is going to be wrapped around the original function
    # so it can execute code before and after it.
    def the_wrapper_around_the_original_function():

        # Put here the code you want to be executed BEFORE the original function is called
        print("Before the function runs")

        # Call the function here (using parentheses)
        a_function_to_decorate()

        # Put here the code you want to be executed AFTER the original function is called
        print("After the function runs")

    # At this point, "a_function_to_decorate" HAS NEVER BEEN EXECUTED.
    # We return the wrapper function we have just created.
    # The wrapper contains the function and the code to execute before and after. It’s ready to use!
    return the_wrapper_around_the_original_function

# Now imagine you create a function you don't want to ever touch again.
def a_stand_alone_function():
    print("I am a stand alone function, don't you dare modify me")

a_stand_alone_function() 
#outputs: I am a stand alone function, don't you dare modify me

# Well, you can decorate it to extend its behavior.
# Just pass it to the decorator, it will wrap it dynamically in 
# any code you want and return you a new function ready to be used:

a_stand_alone_function_decorated = my_shiny_new_decorator(a_stand_alone_function)
a_stand_alone_function_decorated()
#outputs:
#Before the function runs
#I am a stand alone function, don't you dare modify me
#After the function runs 
```

现在，您可能希望每次调用`a_stand_alone_function`,时`a_stand_alone_function_decorated`都会被调用。`a_stand_alone_function`这很简单，只需用返回的函数覆盖`my_shiny_new_decorator`：

```
a_stand_alone_function = my_shiny_new_decorator(a_stand_alone_function)
a_stand_alone_function()
#outputs:
#Before the function runs
#I am a stand alone function, don't you dare modify me
#After the function runs

# That’s EXACTLY what decorators do! 
```

## 装饰师揭秘

前面的例子，使用装饰器语法：

```
@my_shiny_new_decorator
def another_stand_alone_function():
    print("Leave me alone")

another_stand_alone_function()  
#outputs:  
#Before the function runs
#Leave me alone
#After the function runs 
```

是的，就是这样，就是这么简单。`@decorator`只是一个捷径：

```
another_stand_alone_function = my_shiny_new_decorator(another_stand_alone_function) 
```

装饰器只是[装饰器设计模式](http://en.wikipedia.org/wiki/Decorator_pattern)的 Python 变体。Python 中嵌入了几种经典设计模式以简化开发（如迭代器）。

当然，你可以积累装饰器：

```
def bread(func):
    def wrapper():
        print("</''''''\>")
        func()
        print("<\______/>")
    return wrapper

def ingredients(func):
    def wrapper():
        print("#tomatoes#")
        func()
        print("~salad~")
    return wrapper

def sandwich(food="--ham--"):
    print(food)

sandwich()
#outputs: --ham--
sandwich = bread(ingredients(sandwich))
sandwich()
#outputs:
#</''''''\>
# #tomatoes#
# --ham--
# ~salad~
#<\______/> 
```

使用 Python 装饰器语法：

```
@bread
@ingredients
def sandwich(food="--ham--"):
    print(food)

sandwich()
#outputs:
#</''''''\>
# #tomatoes#
# --ham--
# ~salad~
#<\______/> 
```

您设置装饰器的顺序很重要：

```
@ingredients
@bread
def strange_sandwich(food="--ham--"):
    print(food)

strange_sandwich()
#outputs:
##tomatoes#
#</''''''\>
# --ham--
#<\______/>
# ~salad~ 
```

* * *

# 现在：回答这个问题...

作为结论，您可以很容易地看到如何回答这个问题：

```
# The decorator to make it bold
def makebold(fn):
    # The new function the decorator returns
    def wrapper():
        # Insertion of some code before and after
        return "<b>" + fn() + "</b>"
    return wrapper

# The decorator to make it italic
def makeitalic(fn):
    # The new function the decorator returns
    def wrapper():
        # Insertion of some code before and after
        return "<i>" + fn() + "</i>"
    return wrapper

@makebold
@makeitalic
def say():
    return "hello"

print(say())
#outputs: <b><i>hello</i></b>

# This is the exact equivalent to 
def say():
    return "hello"
say = makebold(makeitalic(say))

print(say())
#outputs: <b><i>hello</i></b> 
```

你现在可以开心地离开，或者多费点脑筋，看看装饰器的高级用途。

* * *

# 将装饰器提升到一个新的水平

## 将参数传递给装饰函数

```
# It’s not black magic, you just have to let the wrapper 
# pass the argument:

def a_decorator_passing_arguments(function_to_decorate):
    def a_wrapper_accepting_arguments(arg1, arg2):
        print("I got args! Look: {0}, {1}".format(arg1, arg2))
        function_to_decorate(arg1, arg2)
    return a_wrapper_accepting_arguments

# Since when you are calling the function returned by the decorator, you are
# calling the wrapper, passing arguments to the wrapper will let it pass them to 
# the decorated function

@a_decorator_passing_arguments
def print_full_name(first_name, last_name):
    print("My name is {0} {1}".format(first_name, last_name))

print_full_name("Peter", "Venkman")
# outputs:
#I got args! Look: Peter Venkman
#My name is Peter Venkman 
```

## 装饰方法

Python 的一大优点是方法和函数实际上是相同的。唯一的区别是方法期望它们的第一个参数是对当前对象的引用（`self`）。

这意味着您可以以相同的方式为方法构建装饰器！请记住`self`考虑：

```
def method_friendly_decorator(method_to_decorate):
    def wrapper(self, lie):
        lie = lie - 3 # very friendly, decrease age even more :-)
        return method_to_decorate(self, lie)
    return wrapper

class Lucy(object):

    def __init__(self):
        self.age = 32

    @method_friendly_decorator
    def sayYourAge(self, lie):
        print("I am {0}, what did you think?".format(self.age + lie))

l = Lucy()
l.sayYourAge(-3)
#outputs: I am 26, what did you think? 
```

如果您正在制作通用装饰器——您将应用于任何函数或方法，无论其参数如何——那么只需使用`*args, **kwargs`：

```
def a_decorator_passing_arbitrary_arguments(function_to_decorate):
    # The wrapper accepts any arguments
    def a_wrapper_accepting_arbitrary_arguments(*args, **kwargs):
        print("Do I have args?:")
        print(args)
        print(kwargs)
        # Then you unpack the arguments, here *args, **kwargs
        # If you are not familiar with unpacking, check:
        # http://www.saltycrane.com/blog/2008/01/how-to-use-args-and-kwargs-in-python/
        function_to_decorate(*args, **kwargs)
    return a_wrapper_accepting_arbitrary_arguments

@a_decorator_passing_arbitrary_arguments
def function_with_no_argument():
    print("Python is cool, no argument here.")

function_with_no_argument()
#outputs
#Do I have args?:
#()
#{}
#Python is cool, no argument here.

@a_decorator_passing_arbitrary_arguments
def function_with_arguments(a, b, c):
    print(a, b, c)

function_with_arguments(1,2,3)
#outputs
#Do I have args?:
#(1, 2, 3)
#{}
#1 2 3 

@a_decorator_passing_arbitrary_arguments
def function_with_named_arguments(a, b, c, platypus="Why not ?"):
    print("Do {0}, {1} and {2} like platypus? {3}".format(a, b, c, platypus))

function_with_named_arguments("Bill", "Linus", "Steve", platypus="Indeed!")
#outputs
#Do I have args ? :
#('Bill', 'Linus', 'Steve')
#{'platypus': 'Indeed!'}
#Do Bill, Linus and Steve like platypus? Indeed!

class Mary(object):

    def __init__(self):
        self.age = 31

    @a_decorator_passing_arbitrary_arguments
    def sayYourAge(self, lie=-3): # You can now add a default value
        print("I am {0}, what did you think?".format(self.age + lie))

m = Mary()
m.sayYourAge()
#outputs
# Do I have args?:
#(<__main__.Mary object at 0xb7d303ac>,)
#{}
#I am 28, what did you think? 
```

## 将参数传递给装饰器

太好了，现在您对将参数传递给装饰器本身有何看法？

这可能会有些扭曲，因为装饰器必须接受一个函数作为参数。因此，您不能将装饰函数的参数直接传递给装饰器。

在急于解决之前，让我们写一点提醒：

```
# Decorators are ORDINARY functions
def my_decorator(func):
    print("I am an ordinary function")
    def wrapper():
        print("I am function returned by the decorator")
        func()
    return wrapper

# Therefore, you can call it without any "@"

def lazy_function():
    print("zzzzzzzz")

decorated_function = my_decorator(lazy_function)
#outputs: I am an ordinary function

# It outputs "I am an ordinary function", because that’s just what you do:
# calling a function. Nothing magic.

@my_decorator
def lazy_function():
    print("zzzzzzzz")

#outputs: I am an ordinary function 
```

完全一样。“ `my_decorator`”被称为。因此，当您`@my_decorator`告诉 Python 调用由变量“ `my_decorator`”标记的函数时。

这个很重要！你给的标签可以直接指向装饰器——<strong>或者不是。

让我们变得邪恶。☺</p>

```
def decorator_maker():

    print("I make decorators! I am executed only once: "
          "when you make me create a decorator.")

    def my_decorator(func):

        print("I am a decorator! I am executed only when you decorate a function.")

        def wrapped():
            print("I am the wrapper around the decorated function. "
                  "I am called when you call the decorated function. "
                  "As the wrapper, I return the RESULT of the decorated function.")
            return func()

        print("As the decorator, I return the wrapped function.")

        return wrapped

    print("As a decorator maker, I return a decorator")
    return my_decorator

# Let’s create a decorator. It’s just a new function after all.
new_decorator = decorator_maker()       
#outputs:
#I make decorators! I am executed only once: when you make me create a decorator.
#As a decorator maker, I return a decorator

# Then we decorate the function

def decorated_function():
    print("I am the decorated function.")

decorated_function = new_decorator(decorated_function)
#outputs:
#I am a decorator! I am executed only when you decorate a function.
#As the decorator, I return the wrapped function

# Let’s call the function:
decorated_function()
#outputs:
#I am the wrapper around the decorated function. I am called when you call the decorated function.
#As the wrapper, I return the RESULT of the decorated function.
#I am the decorated function. 
```

这里没有惊喜。

让我们做同样的事情，但跳过所有讨厌的中间变量：

```
def decorated_function():
    print("I am the decorated function.")
decorated_function = decorator_maker()(decorated_function)
#outputs:
#I make decorators! I am executed only once: when you make me create a decorator.
#As a decorator maker, I return a decorator
#I am a decorator! I am executed only when you decorate a function.
#As the decorator, I return the wrapped function.

# Finally:
decorated_function()    
#outputs:
#I am the wrapper around the decorated function. I am called when you call the decorated function.
#As the wrapper, I return the RESULT of the decorated function.
#I am the decorated function. 
```

让我们让它*更短*：

```
@decorator_maker()
def decorated_function():
    print("I am the decorated function.")
#outputs:
#I make decorators! I am executed only once: when you make me create a decorator.
#As a decorator maker, I return a decorator
#I am a decorator! I am executed only when you decorate a function.
#As the decorator, I return the wrapped function.

#Eventually: 
decorated_function()    
#outputs:
#I am the wrapper around the decorated function. I am called when you call the decorated function.
#As the wrapper, I return the RESULT of the decorated function.
#I am the decorated function. 
```

嘿，你看到了吗？我们使用了带有“ `@`”语法的函数调用！:-)

所以，回到带参数的装饰器。如果我们可以使用函数动态生成装饰器，我们可以将参数传递给该函数，对吗？

```
def decorator_maker_with_arguments(decorator_arg1, decorator_arg2):

    print("I make decorators! And I accept arguments: {0}, {1}".format(decorator_arg1, decorator_arg2))

    def my_decorator(func):
        # The ability to pass arguments here is a gift from closures.
        # If you are not comfortable with closures, you can assume it’s ok,
        # or read: https://stackoverflow.com/questions/13857/can-you-explain-closures-as-they-relate-to-python
        print("I am the decorator. Somehow you passed me arguments: {0}, {1}".format(decorator_arg1, decorator_arg2))

        # Don't confuse decorator arguments and function arguments!
        def wrapped(function_arg1, function_arg2) :
            print("I am the wrapper around the decorated function.\n"
                  "I can access all the variables\n"
                  "\t- from the decorator: {0} {1}\n"
                  "\t- from the function call: {2} {3}\n"
                  "Then I can pass them to the decorated function"
                  .format(decorator_arg1, decorator_arg2,
                          function_arg1, function_arg2))
            return func(function_arg1, function_arg2)

        return wrapped

    return my_decorator

@decorator_maker_with_arguments("Leonard", "Sheldon")
def decorated_function_with_arguments(function_arg1, function_arg2):
    print("I am the decorated function and only knows about my arguments: {0}"
           " {1}".format(function_arg1, function_arg2))

decorated_function_with_arguments("Rajesh", "Howard")
#outputs:
#I make decorators! And I accept arguments: Leonard Sheldon
#I am the decorator. Somehow you passed me arguments: Leonard Sheldon
#I am the wrapper around the decorated function. 
#I can access all the variables 
#   - from the decorator: Leonard Sheldon 
#   - from the function call: Rajesh Howard 
#Then I can pass them to the decorated function
#I am the decorated function and only knows about my arguments: Rajesh Howard 
```

这是：带有参数的装饰器。参数可以设置为变量：

```
c1 = "Penny"
c2 = "Leslie"

@decorator_maker_with_arguments("Leonard", c1)
def decorated_function_with_arguments(function_arg1, function_arg2):
    print("I am the decorated function and only knows about my arguments:"
           " {0} {1}".format(function_arg1, function_arg2))

decorated_function_with_arguments(c2, "Howard")
#outputs:
#I make decorators! And I accept arguments: Leonard Penny
#I am the decorator. Somehow you passed me arguments: Leonard Penny
#I am the wrapper around the decorated function. 
#I can access all the variables 
#   - from the decorator: Leonard Penny 
#   - from the function call: Leslie Howard 
#Then I can pass them to the decorated function
#I am the decorated function and only know about my arguments: Leslie Howard 
```

如您所见，您可以像使用此技巧的任何函数一样将参数传递给装饰器。`*args, **kwargs`如果你愿意，你甚至可以使用。但请记住，装饰器**只被调用一次**。就在 Python 导入脚本时。之后您不能动态设置参数。当您执行“import x”时，**该功能已被装饰**，因此您无法更改任何内容。

* * *

# 让我们练习一下：装饰一个装饰器

好的，作为奖励，我会给你一个片段，让任何装饰器都能接受任何参数。毕竟，为了接受参数，我们使用另一个函数创建了我们的装饰器。

我们包裹了装饰器。

我们最近看到的其他包装函数是什么？

哦，是的，装饰师！

让我们玩得开心，为装饰器写一个装饰器：

```
def decorator_with_args(decorator_to_enhance):
    """ 
    This function is supposed to be used as a decorator.
    It must decorate an other function, that is intended to be used as a decorator.
    Take a cup of coffee.
    It will allow any decorator to accept an arbitrary number of arguments,
    saving you the headache to remember how to do that every time.
    """

    # We use the same trick we did to pass arguments
    def decorator_maker(*args, **kwargs):

        # We create on the fly a decorator that accepts only a function
        # but keeps the passed arguments from the maker.
        def decorator_wrapper(func):

            # We return the result of the original decorator, which, after all, 
            # IS JUST AN ORDINARY FUNCTION (which returns a function).
            # Only pitfall: the decorator must have this specific signature or it won't work:
            return decorator_to_enhance(func, *args, **kwargs)

        return decorator_wrapper

    return decorator_maker 
```

它可以按如下方式使用：

```
# You create the function you will use as a decorator. And stick a decorator on it :-)
# Don't forget, the signature is "decorator(func, *args, **kwargs)"
@decorator_with_args 
def decorated_decorator(func, *args, **kwargs): 
    def wrapper(function_arg1, function_arg2):
        print("Decorated with {0} {1}".format(args, kwargs))
        return func(function_arg1, function_arg2)
    return wrapper

# Then you decorate the functions you wish with your brand new decorated decorator.

@decorated_decorator(42, 404, 1024)
def decorated_function(function_arg1, function_arg2):
    print("Hello {0} {1}".format(function_arg1, function_arg2))

decorated_function("Universe and", "everything")
#outputs:
#Decorated with (42, 404, 1024) {}
#Hello Universe and everything

# Whoooot! 
```

我知道，上一次你有这种感觉，是在听一个人说：“在理解递归之前，你必须先理解递归”之后。但是现在，你不觉得掌握这个很好吗？

* * *

# 最佳实践：装饰器

*   装饰器是在 Python 2.4 中引入的，因此请确保您的代码将在 >= 2.4 上运行。
*   装饰器减慢了函数调用。记住这一点。
*   **您不能取消装饰功能。**（有*一些*技巧可以创建可以删除的装饰器，但没有人使用它们。）因此，一旦一个函数被装饰，它就会被*所有代码*装饰。
*   装饰器包装函数，这会使它们难以调试。（这从 Python >= 2.5 变得更好；见下文。）

该`functools`模块是在 Python 2.5 中引入的。它包括 function `functools.wraps()`，它将修饰函数的名称、模块和文档字符串复制到其包装器中。

（有趣的事实：`functools.wraps()`是一个装饰师！☺）

```
# For debugging, the stacktrace prints you the function __name__
def foo():
    print("foo")

print(foo.__name__)
#outputs: foo

# With a decorator, it gets messy    
def bar(func):
    def wrapper():
        print("bar")
        return func()
    return wrapper

@bar
def foo():
    print("foo")

print(foo.__name__)
#outputs: wrapper

# "functools" can help for that

import functools

def bar(func):
    # We say that "wrapper", is wrapping "func"
    # and the magic begins
    @functools.wraps(func)
    def wrapper():
        print("bar")
        return func()
    return wrapper

@bar
def foo():
    print("foo")

print(foo.__name__)
#outputs: foo 
```

* * *

# 装饰器如何有用？

**现在有个大问题：**我可以用装饰器做什么？

看起来很酷很强大，但是一个实际的例子会很棒。好吧，有1000种可能性。经典用途是从外部库扩展函数行为（您不能修改它），或用于调试（您不想修改它，因为它是临时的）。

您可以使用它们以 DRY 的方式扩展多个功能，如下所示：

```
def benchmark(func):
    """
    A decorator that prints the time a function takes
    to execute.
    """
    import time
    def wrapper(*args, **kwargs):
        t = time.clock()
        res = func(*args, **kwargs)
        print("{0} {1}".format(func.__name__, time.clock()-t))
        return res
    return wrapper

def logging(func):
    """
    A decorator that logs the activity of the script.
    (it actually just prints it, but it could be logging!)
    """
    def wrapper(*args, **kwargs):
        res = func(*args, **kwargs)
        print("{0} {1} {2}".format(func.__name__, args, kwargs))
        return res
    return wrapper

def counter(func):
    """
    A decorator that counts and prints the number of times a function has been executed
    """
    def wrapper(*args, **kwargs):
        wrapper.count = wrapper.count + 1
        res = func(*args, **kwargs)
        print("{0} has been used: {1}x".format(func.__name__, wrapper.count))
        return res
    wrapper.count = 0
    return wrapper

@counter
@benchmark
@logging
def reverse_string(string):
    return str(reversed(string))

print(reverse_string("Able was I ere I saw Elba"))
print(reverse_string("A man, a plan, a canoe, pasta, heros, rajahs, a coloratura, maps, snipe, percale, macaroni, a gag, a banana bag, a tan, a tag, a banana bag again (or a camel), a crepe, pins, Spam, a rut, a Rolo, cash, a jar, sore hats, a peon, a canal: Panama!"))

#outputs:
#reverse_string ('Able was I ere I saw Elba',) {}
#wrapper 0.0
#wrapper has been used: 1x 
#ablE was I ere I saw elbA
#reverse_string ('A man, a plan, a canoe, pasta, heros, rajahs, a coloratura, maps, snipe, percale, macaroni, a gag, a banana bag, a tan, a tag, a banana bag again (or a camel), a crepe, pins, Spam, a rut, a Rolo, cash, a jar, sore hats, a peon, a canal: Panama!',) {}
#wrapper 0.0
#wrapper has been used: 2x
#!amanaP :lanac a ,noep a ,stah eros ,raj a ,hsac ,oloR a ,tur a ,mapS ,snip ,eperc a ,)lemac a ro( niaga gab ananab a ,gat a ,nat a ,gab ananab a ,gag a ,inoracam ,elacrep ,epins ,spam ,arutaroloc a ,shajar ,soreh ,atsap ,eonac a ,nalp a ,nam A 
```

当然，装饰器的好处是您可以立即在几乎任何东西上使用它们而无需重写。干，我说：

```
@counter
@benchmark
@logging
def get_random_futurama_quote():
    from urllib import urlopen
    result = urlopen("http://subfusion.net/cgi-bin/quote.pl?quote=futurama").read()
    try:
        value = result.split("<br><b><hr><br>")[1].split("<br><br><hr>")[0]
        return value.strip()
    except:
        return "No, I'm ... doesn't!"

print(get_random_futurama_quote())
print(get_random_futurama_quote())

#outputs:
#get_random_futurama_quote () {}
#wrapper 0.02
#wrapper has been used: 1x
#The laws of science be a harsh mistress.
#get_random_futurama_quote () {}
#wrapper 0.01
#wrapper has been used: 2x
#Curse you, merciful Poseidon! 
```

Python 本身提供了几个装饰器：`property`、`staticmethod`等。

*   Django 使用装饰器来管理缓存和查看权限。
*   扭曲为伪造的内联异步函数调用。

这真的是一个很大的游乐场。

* * *

## 回答 #2

> 赞同：3040
> 
> 时间：2009-04-11T07:16:18.420

查看[文档](http://docs.python.org/reference/compound_stmts.html#function)以了解装饰器是如何工作的。这是您的要求：

```
from functools import wraps

def makebold(fn):
    @wraps(fn)
    def wrapper(*args, **kwargs):
        return "<b>" + fn(*args, **kwargs) + "</b>"
    return wrapper

def makeitalic(fn):
    @wraps(fn)
    def wrapper(*args, **kwargs):
        return "<i>" + fn(*args, **kwargs) + "</i>"
    return wrapper

@makebold
@makeitalic
def hello():
    return "hello world"

@makebold
@makeitalic
def log(s):
    return s

print hello()        # returns "<b><i>hello world</i></b>"
print hello.__name__ # with functools.wraps() this returns "hello"
print log('hello')   # returns "<b><i>hello</i></b>" 
```

* * *

## 回答 #3

> 赞同：152
> 
> 时间：2009-04-11T07:32:15.467

或者，您可以编写一个工厂函数，该函数返回一个装饰器，该装饰器将装饰函数的返回值包装在传递给工厂函数的标记中。例如：

```
from functools import wraps

def wrap_in_tag(tag):
    def factory(func):
        @wraps(func)
        def decorator():
            return '<%(tag)s>%(rv)s</%(tag)s>' % (
                {'tag': tag, 'rv': func()})
        return decorator
    return factory 
```

这使您可以编写：

```
@wrap_in_tag('b')
@wrap_in_tag('i')
def say():
    return 'hello' 
```

或者

```
makebold = wrap_in_tag('b')
makeitalic = wrap_in_tag('i')

@makebold
@makeitalic
def say():
    return 'hello' 
```

就我个人而言，我会以不同的方式编写装饰器：

```
from functools import wraps

def wrap_in_tag(tag):
    def factory(func):
        @wraps(func)
        def decorator(val):
            return func('<%(tag)s>%(val)s</%(tag)s>' %
                        {'tag': tag, 'val': val})
        return decorator
    return factory 
```

这将产生：

```
@wrap_in_tag('b')
@wrap_in_tag('i')
def say(val):
    return val
say('hello') 
```

不要忘记装饰器语法是简写的构造：

```
say = wrap_in_tag('b')(wrap_in_tag('i')(say))) 
```

* * *

## 回答 #4

> 赞同：136
> 
> 时间：2009-04-11T08:00:42.777

看起来其他人已经告诉你如何解决这个问题。我希望这将帮助您了解装饰器是什么。

装饰器只是语法糖。

这

```
@decorator
def func():
    ... 
```

扩展到

```
def func():
    ...
func = decorator(func) 
```

* * *

## 回答 #5

> 赞同：72
> 
> 时间：2010-10-25T06:18:12.333

当然，您也可以从装饰器函数返回 lambda：

```
def makebold(f): 
    return lambda: "<b>" + f() + "</b>"
def makeitalic(f): 
    return lambda: "<i>" + f() + "</i>"

@makebold
@makeitalic
def say():
    return "Hello"

print say() 
```

* * *

## 回答 #6

> 赞同：65
> 
> 时间：2009-04-11T07:19:12.923

Python 装饰器为另一个函数添加额外的功能

斜体装饰器可能就像

```
def makeitalic(fn):
    def newFunc():
        return "<i>" + fn() + "</i>"
    return newFunc 
```

请注意，函数是在函数内部定义的。它基本上所做的就是用新定义的函数替换一个函数。例如，我有这堂课

```
class foo:
    def bar(self):
        print "hi"
    def foobar(self):
        print "hi again" 
```

现在说，我希望这两个函数在完成之后和之前都打印“---”。我可以在每个打印语句之前和之后添加一个打印“---”。但是因为我不喜欢重复自己，所以我会做一个装饰器

```
def addDashes(fn): # notice it takes a function as an argument
    def newFunction(self): # define a new function
        print "---"
        fn(self) # call the original function
        print "---"
    return newFunction
    # Return the newly defined function - it will "replace" the original 
```

所以现在我可以把我的班级改成

```
class foo:
    @addDashes
    def bar(self):
        print "hi"

    @addDashes
    def foobar(self):
        print "hi again" 
```

有关装饰器的更多信息，请查看 [http://www.ibm.com/developerworks/linux/library/l-cpdecor.html](http://www.ibm.com/developerworks/linux/library/l-cpdecor.html)

* * *

## 回答 #7

> 赞同：44
> 
> 时间：2015-05-17T03:26:24.683

您*可以*制作两个单独的装饰器来执行您想要的操作，如下所示。注意在函数`*args, **kwargs`声明中的使用，`wrapped()`它支持具有多个参数的修饰函数（这对于示例`say()`函数并不是真正必需的，但为了通用性而包含在内）。

出于类似的原因，`functools.wraps`装饰器用于将包装函数的元属性更改为被装饰函数的元属性。这使得错误消息和嵌入式函数文档 ( `func.__doc__`) 成为修饰函数的那些，而不是`wrapped()`'s。

```
from functools import wraps

def makebold(fn):
    @wraps(fn)
    def wrapped(*args, **kwargs):
        return "<b>" + fn(*args, **kwargs) + "</b>"
    return wrapped

def makeitalic(fn):
    @wraps(fn)
    def wrapped(*args, **kwargs):
        return "<i>" + fn(*args, **kwargs) + "</i>"
    return wrapped

@makebold
@makeitalic
def say():
    return 'Hello'

print(say())  # -> <b><i>Hello</i></b> 
```

## 改进

如您所见，这两个装饰器中有很多重复的代码。鉴于这种相似性，您最好改为创建一个实际上是*装饰器工厂*的通用型 - 换句话说，创建其他装饰器的装饰器函数。这样一来，代码重复就会减少——并允许遵循[DRY原则。](https://en.wikipedia.org/wiki/Don't_repeat_yourself)

```
def html_deco(tag):
    def decorator(fn):
        @wraps(fn)
        def wrapped(*args, **kwargs):
            return '<%s>' % tag + fn(*args, **kwargs) + '</%s>' % tag
        return wrapped
    return decorator

@html_deco('b')
@html_deco('i')
def greet(whom=''):
    return 'Hello' + (' ' + whom) if whom else ''

print(greet('world'))  # -> <b><i>Hello world</i></b> 
```

为了使代码更具可读性，您可以为工厂生成的装饰器指定一个更具描述性的名称：

```
makebold = html_deco('b')
makeitalic = html_deco('i')

@makebold
@makeitalic
def greet(whom=''):
    return 'Hello' + (' ' + whom) if whom else ''

print(greet('world'))  # -> <b><i>Hello world</i></b> 
```

甚至像这样组合它们：

```
makebolditalic = lambda fn: makebold(makeitalic(fn))

@makebolditalic
def greet(whom=''):
    return 'Hello' + (' ' + whom) if whom else ''

print(greet('world'))  # -> <b><i>Hello world</i></b> 
```

### 效率

虽然上面的示例可以完成所有工作，但当同时应用多个装饰器时，生成的代码会以无关函数调用的形式产生相当多的开销。这可能无关紧要，具体取决于确切的用法（例如，可能是 I/O 绑定的）。

如果装饰函数的速度很重要，可以通过编写一个稍微不同的装饰器工厂函数来保持单个额外函数调用的开销，该函数实现一次添加所有标签，因此它可以生成避免额外函数调用的代码通过为每个标签使用单独的装饰器。

这需要装饰器本身中的更多代码，但这仅在应用于函数定义时运行，而不是稍后调用它们本身时。`lambda`这也适用于使用前面说明的函数创建更具可读性的名称时。样本：

```
def multi_html_deco(*tags):
    start_tags, end_tags = [], []
    for tag in tags:
        start_tags.append('<%s>' % tag)
        end_tags.append('</%s>' % tag)
    start_tags = ''.join(start_tags)
    end_tags = ''.join(reversed(end_tags))

    def decorator(fn):
        @wraps(fn)
        def wrapped(*args, **kwargs):
            return start_tags + fn(*args, **kwargs) + end_tags
        return wrapped
    return decorator

makebolditalic = multi_html_deco('b', 'i')

@makebolditalic
def greet(whom=''):
    return 'Hello' + (' ' + whom) if whom else ''

print(greet('world'))  # -> <b><i>Hello world</i></b> 
```

* * *

## 回答 #8

> 赞同：23
> 
> 时间：2011-12-26T06:13:01.397

做同样事情的另一种方法：

```
class bol(object):
  def __init__(self, f):
    self.f = f
  def __call__(self):
    return "<b>{}</b>".format(self.f())

class ita(object):
  def __init__(self, f):
    self.f = f
  def __call__(self):
    return "<i>{}</i>".format(self.f())

@bol
@ita
def sayhi():
  return 'hi' 
```

或者，更灵活：

```
class sty(object):
  def __init__(self, tag):
    self.tag = tag
  def __call__(self, f):
    def newf():
      return "<{tag}>{res}</{tag}>".format(res=f(), tag=self.tag)
    return newf

@sty('b')
@sty('i')
def sayhi():
  return 'hi' 
```

* * *

## 回答 #9

> 赞同：21
> 
> 时间：2015-12-03T18:09:54.917

> # 如何在 Python 中制作两个可以执行以下操作的装饰器？

调用时需要以下函数：

> ```
> @makebold
> @makeitalic
> def say():
>     return "Hello" 
> ```

返回：

> ```
> <b><i>Hello</i></b> 
> ```

## 简单的解决方案

要最简单地做到这一点，请制作返回关闭函数（闭包）并调用它的 lambdas（匿名函数）的装饰器：

```
def makeitalic(fn):
    return lambda: '<i>' + fn() + '</i>'

def makebold(fn):
    return lambda: '<b>' + fn() + '</b>' 
```

现在根据需要使用它们：

```
@makebold
@makeitalic
def say():
    return 'Hello' 
```

现在：

```
>>> say()
'<b><i>Hello</i></b>' 
```

## 简单解决方案的问题

但我们似乎几乎失去了原来的功能。

```
>>> say
<function <lambda> at 0x4ACFA070> 
```

为了找到它，我们需要深入研究每个 lambda 的闭包，其中一个隐藏在另一个中：

```
>>> say.__closure__[0].cell_contents
<function <lambda> at 0x4ACFA030>
>>> say.__closure__[0].cell_contents.__closure__[0].cell_contents
<function say at 0x4ACFA730> 
```

因此，如果我们将文档放在这个函数上，或者希望能够装饰带有多个参数的函数，或者我们只是想知道我们在调试会话中查看的是什么函数，我们需要对我们的包装。

## 全功能解决方案 - 克服大部分问题

我们有标准库`wraps`中模块的装饰器！`functools`

```
from functools import wraps

def makeitalic(fn):
    # must assign/update attributes from wrapped function to wrapper
    # __module__, __name__, __doc__, and __dict__ by default
    @wraps(fn) # explicitly give function whose attributes it is applying
    def wrapped(*args, **kwargs):
        return '<i>' + fn(*args, **kwargs) + '</i>'
    return wrapped

def makebold(fn):
    @wraps(fn)
    def wrapped(*args, **kwargs):
        return '<b>' + fn(*args, **kwargs) + '</b>'
    return wrapped 
```

不幸的是，仍然有一些样板，但这是我们可以做到的最简单的。

在 Python 3 中，您还可以默认获取`__qualname__`和`__annotations__`分配。

所以现在：

```
@makebold
@makeitalic
def say():
    """This function returns a bolded, italicized 'hello'"""
    return 'Hello' 
```

现在：

```
>>> say
<function say at 0x14BB8F70>
>>> help(say)
Help on function say in module __main__:

say(*args, **kwargs)
    This function returns a bolded, italicized 'hello' 
```

## 结论

所以我们看到这`wraps`使得包装函数几乎可以做所有事情，除了告诉我们函数将什么作为参数。

还有其他模块可能会尝试解决这个问题，但标准库中还没有解决方案。

* * *

## 回答 #10

> 赞同：14
> 
> 时间：2012-07-26T16:11:42.627

装饰器接受函数定义并创建一个执行该函数并转换结果的新函数。

```
@deco
def do():
    ... 
```

相当于：

```
do = deco(do) 
```

## 例子：

```
def deco(func):
    def inner(letter):
        return func(letter).upper()  #upper
    return inner 
```

这

```
@deco
def do(number):
    return chr(number)  # number to letter 
```

相当于这个

```
def do2(number):
    return chr(number)

do2 = deco(do2) 
```

65 <=> '一个'

```
print(do(65))
print(do2(65))
>>> B
>>> B 
```

要理解装饰器，重要的是要注意，装饰器创建了一个新的函数 do，它是内部的，它执行函数并转换结果。

* * *

## 回答 #11

> 赞同：11
> 
> 时间：2018-11-06T17:09:44.893

这个答案早就得到了回答，但我想我会分享我的 Decorator 类，这使得编写新的装饰器变得简单而紧凑。

```
from abc import ABCMeta, abstractclassmethod

class Decorator(metaclass=ABCMeta):
    """ Acts as a base class for all decorators """

    def __init__(self):
        self.method = None

    def __call__(self, method):
        self.method = method
        return self.call

    @abstractclassmethod
    def call(self, *args, **kwargs):
        return self.method(*args, **kwargs) 
```

一方面，我认为这使得装饰器的行为非常清晰，但它也很容易非常简洁地定义新的装饰器。对于上面列出的示例，您可以将其解决为：

```
class MakeBold(Decorator):
    def call():
        return "<b>" + self.method() + "</b>"

class MakeItalic(Decorator):
    def call():
        return "<i>" + self.method() + "</i>"

@MakeBold()
@MakeItalic()
def say():
   return "Hello" 
```

您还可以使用它来执行更复杂的任务，例如一个装饰器，它自动使函数递归地应用于迭代器中的所有参数：

```
class ApplyRecursive(Decorator):
    def __init__(self, *types):
        super().__init__()
        if not len(types):
            types = (dict, list, tuple, set)
        self._types = types

    def call(self, arg):
        if dict in self._types and isinstance(arg, dict):
            return {key: self.call(value) for key, value in arg.items()}

        if set in self._types and isinstance(arg, set):
            return set(self.call(value) for value in arg)

        if tuple in self._types and isinstance(arg, tuple):
            return tuple(self.call(value) for value in arg)

        if list in self._types and isinstance(arg, list):
            return list(self.call(value) for value in arg)

        return self.method(arg)

@ApplyRecursive(tuple, set, dict)
def double(arg):
    return 2*arg

print(double(1))
print(double({'a': 1, 'b': 2}))
print(double({1, 2, 3}))
print(double((1, 2, 3, 4)))
print(double([1, 2, 3, 4, 5])) 
```

哪个打印：

```
2
{'a': 2, 'b': 4}
{2, 4, 6}
(2, 4, 6, 8)
[1, 2, 3, 4, 5, 1, 2, 3, 4, 5] 
```

请注意，此示例未`list`在装饰器的实例化中包含类型，因此在最终的 print 语句中，该方法将应用于列表本身，而不是列表的元素。

* * *

## 回答 #12

> 赞同：10
> 
> 时间：2014-04-03T09:43:12.280

```
#decorator.py
def makeHtmlTag(tag, *args, **kwds):
    def real_decorator(fn):
        css_class = " class='{0}'".format(kwds["css_class"]) \
                                 if "css_class" in kwds else ""
        def wrapped(*args, **kwds):
            return "<"+tag+css_class+">" + fn(*args, **kwds) + "</"+tag+">"
        return wrapped
    # return decorator dont call it
    return real_decorator

@makeHtmlTag(tag="b", css_class="bold_css")
@makeHtmlTag(tag="i", css_class="italic_css")
def hello():
    return "hello world"

print hello() 
```

您也可以在 Class 中编写装饰器

```
#class.py
class makeHtmlTagClass(object):
    def __init__(self, tag, css_class=""):
        self._tag = tag
        self._css_class = " class='{0}'".format(css_class) \
                                       if css_class != "" else ""

    def __call__(self, fn):
        def wrapped(*args, **kwargs):
            return "<" + self._tag + self._css_class+">"  \
                       + fn(*args, **kwargs) + "</" + self._tag + ">"
        return wrapped

@makeHtmlTagClass(tag="b", css_class="bold_css")
@makeHtmlTagClass(tag="i", css_class="italic_css")
def hello(name):
    return "Hello, {}".format(name)

print hello("Your name") 
```

* * *

## 回答 #13

> 赞同：8
> 
> 时间：2013-06-17T04:43:25.847

这是链接装饰器的简单示例。注意最后一行 - 它显示了幕后发生的事情。

```
############################################################
#
#    decorators
#
############################################################

def bold(fn):
    def decorate():
        # surround with bold tags before calling original function
        return "<b>" + fn() + "</b>"
    return decorate

def uk(fn):
    def decorate():
        # swap month and day
        fields = fn().split('/')
        date = fields[1] + "/" + fields[0] + "/" + fields[2]
        return date
    return decorate

import datetime
def getDate():
    now = datetime.datetime.now()
    return "%d/%d/%d" % (now.day, now.month, now.year)

@bold
def getBoldDate(): 
    return getDate()

@uk
def getUkDate():
    return getDate()

@bold
@uk
def getBoldUkDate():
    return getDate()

print getDate()
print getBoldDate()
print getUkDate()
print getBoldUkDate()
# what is happening under the covers
print bold(uk(getDate))() 
```

输出如下所示：

```
17/6/2013
<b>17/6/2013</b>
6/17/2013
<b>6/17/2013</b>
<b>6/17/2013</b> 
```

* * *

## 回答 #14

> 赞同：7
> 
> 时间：2012-03-02T21:47:17.320

说到计数器示例 - 如上所述，计数器将在所有使用装饰器的函数之间共享：

```
def counter(func):
    def wrapped(*args, **kws):
        print 'Called #%i' % wrapped.count
        wrapped.count += 1
        return func(*args, **kws)
    wrapped.count = 0
    return wrapped 
```

这样，你的装饰器可以被不同的函数重用（或用于多次装饰同一个函数：）`func_counter1 = counter(func); func_counter2 = counter(func)`，并且计数器变量对每个函数都是私有的。

* * *

## 回答 #15

> 赞同：7
> 
> 时间：2013-04-05T18:18:08.690

# 用不同数量的参数装饰函数：

```
def frame_tests(fn):
    def wrapper(*args):
        print "\nStart: %s" %(fn.__name__)
        fn(*args)
        print "End: %s\n" %(fn.__name__)
    return wrapper

@frame_tests
def test_fn1():
    print "This is only a test!"

@frame_tests
def test_fn2(s1):
    print "This is only a test! %s" %(s1)

@frame_tests
def test_fn3(s1, s2):
    print "This is only a test! %s %s" %(s1, s2)

if __name__ == "__main__":
    test_fn1()
    test_fn2('OK!')
    test_fn3('OK!', 'Just a test!') 
```

结果：

```
Start: test_fn1  
This is only a test!  
End: test_fn1  

Start: test_fn2  
This is only a test! OK!  
End: test_fn2  

Start: test_fn3  
This is only a test! OK! Just a test!  
End: test_fn3 
```

* * *

## 回答 #16

> 赞同：7
> 
> 时间：2019-03-11T15:24:57.607

[Paolo Bergantino 的答案](https://stackoverflow.com/a/739665/7262247)具有仅使用 stdlib 的巨大优势，并且适用于这个没有*装饰器*参数或*装饰函数*参数的简单示例。

但是，如果您想处理更一般的情况，它有 3 个主要限制：

*   正如在几个答案中已经指出的那样，您不能轻易修改代码以**添加可选的装饰器参数**。例如，创建`makestyle(style='bold')`装饰器并非易事。
*   此外，使用创建的包装器`@functools.wraps` **不保留签名**，因此如果提供了错误的参数，它们将开始执行，并可能引发与通常不同的错误`TypeError`。
*   `@functools.wraps`最后，在使用创建的包装器中**访问基于其名称的参数**是相当困难的。实际上，参数可以出现在`*args`、 中`**kwargs`，或者根本不出现（如果它是可选的）。

我写信[`decopatch`](https://smarie.github.io/python-decopatch/)是为了解决第一个问题，写信[`makefun.wraps`](https://smarie.github.io/python-makefun/#signature-preserving-function-wrappers)是为了解决另外两个问题。请注意，它`makefun`利用了与著名的[`decorator`](https://github.com/micheles/decorator)lib 相同的技巧。

这就是你如何创建一个带参数的装饰器，返回真正的签名保留包装器：

```
from decopatch import function_decorator, DECORATED
from makefun import wraps

@function_decorator
def makestyle(st='b', fn=DECORATED):
    open_tag = "<%s>" % st
    close_tag = "</%s>" % st

    @wraps(fn)
    def wrapped(*args, **kwargs):
        return open_tag + fn(*args, **kwargs) + close_tag

    return wrapped 
```

`decopatch`根据您的喜好，为您提供隐藏或显示各种 Python 概念的另外两种开发风格。最紧凑的样式如下：

```
from decopatch import function_decorator, WRAPPED, F_ARGS, F_KWARGS

@function_decorator
def makestyle(st='b', fn=WRAPPED, f_args=F_ARGS, f_kwargs=F_KWARGS):
    open_tag = "<%s>" % st
    close_tag = "</%s>" % st
    return open_tag + fn(*f_args, **f_kwargs) + close_tag 
```

在这两种情况下，您都可以检查装饰器是否按预期工作：

```
@makestyle
@makestyle('i')
def hello(who):
    return "hello %s" % who

assert hello('world') == '<b><i>hello world</i></b>' 
```

有关详细信息，请参阅[文档](https://smarie.github.io/python-decopatch/)。

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2021-04-24T21:42:53.170

当您需要在装饰器中添加自定义参数，将其传递给最终函数然后使用它时，我添加了一个案例。

非常装饰者：

```
def jwt_or_redirect(fn):
  @wraps(fn)
  def decorator(*args, **kwargs):
    ...
    return fn(*args, **kwargs)
  return decorator

def jwt_refresh(fn):
  @wraps(fn)
  def decorator(*args, **kwargs):
    ...
    new_kwargs = {'refreshed_jwt': 'xxxxx-xxxxxx'}
    new_kwargs.update(kwargs)
    return fn(*args, **new_kwargs)
  return decorator 
```

和最终功能：

```
@app.route('/')
@jwt_or_redirect
@jwt_refresh
def home_page(*args, **kwargs):
  return kwargs['refreched_jwt'] 
```

# c# - 如何使用 C# 滚动到 WinForms TextBox 中的指定行？

> ID：739656
> 
> 赞同：13
> 
> 时间：2009-04-11T07:06:48.710
> 
> 标签：c#, winforms, textbox, line

如何使用 C# 滚动到 WinForms TextBox 中的指定行？

谢谢

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-04-11T07:16:03.243

以下是滚动到选择的方式：

```
textBox.ScrollToCaret(); 
```

要滚动到指定的行，您可以遍历 TextBox.Lines 属性，合计它们的长度以找到指定行的开头，然后设置 TextBox.SelectionStart 来定位插入符号。

与此类似的东西（未经测试的代码）：

```
int position = 0;

for (int i = 0; i < lineToGoto; i++)
{
    position += textBox.Lines[i].Length;
}

textBox.SelectionStart = position;

textBox.ScrollToCaret(); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2012-10-28T03:17:39.810

```
 private void MoveCaretToLine(TextBox txtBox, int lineNumber)
    {
        txtBox.HideSelection = false;
        txtBox.SelectionStart = txtBox.GetFirstCharIndexFromLine(lineNumber - 1);
        txtBox.SelectionLength = txtBox.Lines[lineNumber - 1].Length;
        txtBox.ScrollToCaret();
    } 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2015-08-24T13:29:31.983

这是我找到的最佳解决方案：

```
const int EM_GETFIRSTVISIBLELINE = 0x00CE;
const int EM_LINESCROLL = 0x00B6;

[DllImport("user32.dll")]
static extern int SendMessage(IntPtr hWnd, int wMsg, int wParam, int lParam);

void SetLineIndex(TextBox tbx, int lineIndex)
{
  int currentLine = SendMessage(textBox1.Handle, EM_GETFIRSTVISIBLELINE, 0, 0);
  SendMessage(tbx.Handle, EM_LINESCROLL, 0, lineIndex - currentLine);
} 
```

它的好处是选择和插入符号的位置不会改变。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-19T14:45:47.043

找到正确插入符号位置的循环答案有几个问题。首先，对于大文本框，它很慢。其次，制表符似乎会混淆它。更直接的方法是使用您想要的行上的文本。

```
String textIWantShown = "Something on this line.";
int position = textBox.Text.IndexOf(textIWantShown);
textBox.SelectionStart = position;
textBox.ScrollToCaret(); 
```

当然，此文本必须是唯一的，但您可以从 textBox.Lines 数组中获取它。在我的例子中，我在我显示的文本中添加了行号，所以这让生活更轻松。

# sql - 将 VWD Express 2008 连接到 SQL Server Express 2005 时出现问题

> ID：739659
> 
> 赞同：1
> 
> 时间：2009-04-11T07:10:33.800
> 
> 标签：sql, sql-server-express

当我尝试从 Visual Web Developer Express 2008 连接到 SQL Express 2005 时，我收到了诸如“无法加载文件或程序集 Microsoft.SqlServer.Management.Sdk.Sfc”之类的错误。

我阅读了一些帖子，建议我下载并安装 3 个应用程序来解决上述问题（ SharedManagementObjects.msi、sqlncli.msi、SQLSysClrTypes.msi ）。

我这样做了，现在我得到一个不同的连接错误

'建立与 SQL Server 的连接时发生与网络相关或特定于实例的错误。服务器未找到或无法访问。验证实例名称是否正确以及 SQL Server 是否配置为允许远程连接。（提供者：SQL 网络接口，错误：26 - 错误定位服务器/指定的实例）'。

有谁知道克服这个的方法？

谢谢。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T07:23:28.980

你是如何尝试连接的？只是一个普通的 ADO.NET 连接？如果是这样，你的连接字符串是什么？

您是否尝试使用 SMO（SQL Mgmt 对象）？听起来您的某些 SMO 对象由于某种原因不可用 - 您可能希望从[此处](http://www.microsoft.com/downloads/details.aspx?FamilyID=d09c1d60-a13c-4479-9b91-9e8b9d835cdc&displaylang=en)下载并重新安装这些 SMO 组件。您想要的文件位于页面下方，位于“ **Microsoft SQL Server 2005 管理对象集合**”标题下 - 文件称为“SQLServer2005_XMO.msi”（带有一些 x64 变体）。

安装那个 MSI 有帮助吗？

马克

PS：好的，谢谢，根据您的评论 - 您可以在这里尝试这个连接字符串：

```
string connectionString = @"Server=.\SQLEXPRESS2005;Database=DBName;Integrated Security=SSPI"; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T07:29:55.800

如果您在本地运行 SQL Sever Express，您可能需要检查服务控制台（WinKey、Run、“services.msc”）并验证您是否具有 SQL Server 和 SQL Server Agent 条目并且它们都在运行。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T07:31:00.787

我认为这个问题肯定与您的连接字符串有关。尝试这样做

1.  运行 SQL Management Express，并从中获取服务器实例名称。

通常，当服务器实例名称错误时会出现此问题（在许多计算机上可能是 SQLEXPRESS）。

# business-objects - 用户对象对话框 - 不打开（业务对象）

> ID：739672
> 
> 赞同：0
> 
> 时间：2009-04-11T07:25:23.437
> 
> 标签：business-objects

在业务对象中，当我在 Universe 的查询面板中单击“用户对象”图标时，不会打开“用户对象”对话框，但是，我检查了其他 Universe，会打开用户对象对话框。

我不确定 Designer 中的 Universe 参数究竟是什么在 Business Objects 中启用了此功能。有人可以帮助我吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-02T10:56:51.613

第一个答案很好，但我有一些额外的信息：

1）我使用的是BO XI Release 2，.udo文件的路径如下：C:\Documents and Settings{username}\Application Data\Business Objects\Business Objects 11.5\Universes

2) .udo 文件的名称由带有 .udo 扩展名的 Universe 名称给出。因此，如果 Universe 被称为“Housing Repairs”，则用户对象文件的名称将是“Housing Repairs.udo”。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T05:56:49.063

当 Universe.udo 文件损坏时会发生这种情况。

因此，从 Universe 文件夹中删除 Universe.udo 文件，即在“Document & Settings\Application Data\BusinessObjects\Universe

# multithreading - 在单个应用程序中从多个线程调用 dll 函数是否安全？

> ID：739673
> 
> 赞同：12
> 
> 时间：2009-04-11T07:26:17.273
> 
> 标签：multithreading, delphi, dll

我正在 Delphi 2009 中编写一个服务器应用程序，它实现了几种类型的身份验证。每个身份验证方法都存储在一个单独的 dll 中。第一次使用身份验证方法时，会加载适当的 dll。dll 仅在应用程序关闭时释放。

在服务器线程（连接）之间没有任何形式的同步的情况下访问 dll 是否安全？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-04-11T08:00:10.360

**简短的回答：**

是的，通常可以从多个线程调用 DLL 函数，因为每个线程都有自己的堆栈，调用 DLL 函数或多或少与调用您自己代码的任何其他函数相同。

**长答案：**

是否*真的*可能取决于是否使用**共享可变状态**的 DLL 函数。

例如，如果您执行以下操作：

```
DLL_SetUser(UserName, Password)
if DLL_IsAuthenticated then
begin
...
end; 
```

那么从不同的线程中使用肯定是**不安全的。**在此示例中，您不能保证在`DLL_SetUser`且`DLL_IsAuthenticated`没有其他线程对`DLL_SetUser`.

但是如果 DLL 函数不依赖于某种预定义的状态，即所有必要的参数一次都可用并且所有其他配置对于所有线程都是相同的，那么您可以假设它会起作用。

```
if DLL_IsAuthenticated(UserName, Password) then
begin
...
end; 
```

但请注意：DLL 函数可能看起来是原子的，但在内部使用了某些东西，但事实并非如此。例如，如果 DLL 创建了一个始终具有相同名称的临时文件，或者它访问的数据库一次只能处理一个请求，则它被视为共享状态。（对不起，我想不出更好的例子）

**概括：**

如果 DLL 供应商说他们的 DLL 是线程安全的，我会从多个线程中使用它们而不加锁。如果他们不是——或者即使供应商不知道——你应该安全地使用它并使用锁定。

至少在您遇到性能问题之前。在这种情况下，您可以尝试创建多个应用程序/进程来包装您的 DLL 调用并将它们用作代理。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-11T07:50:55.857

为了使您的 DLL 成为线程安全的，您需要保护一个进程中的多个线程可以同时访问的所有共享数据结构 - 为 DLL 编写代码与为可执行文件编写代码之间没有区别。

对于多个进程，并发访问没有风险，因为每个进程都有自己的 DLL 数据段，所以同名的变量从不同的进程来看实际上是不同的。实际上，在 DLL 中提供来自不同进程的相同数据要困难得多，您基本上需要实现用于进程之间数据交换的相同事物。

请注意，DLL 的特殊之处在于，当进程或线程附加到 DLL 或从 DLL 分离时，您会收到通知。有关说明，请参阅[DllMain 回调函数](http://msdn.microsoft.com/en-us/library/ms682583.aspx)的文档，有关如何在 Delphi 编写的 DLL 中使用此功能的示例，请参阅[本文](http://delphi.about.com/cs/adptips2003/a/bltip1003_2.htm)。因此，如果您的线程彼此不完全独立（并且没有共享数据被写入访问），那么您将需要一些具有同步访问的共享数据结构。各种通知可以帮助您正确设置 DLL 中的任何数据结构。

如果您的 DLL 允许完全独立执行导出的函数，请检查*threadvar*线程特定变量。请注意，对于他们来说，*初始化*和*终结*部分是不可用的，但也许线程通知也可以帮助您。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T07:59:02.077

事情就是这样 - 如果您无法控制源代码（或说明它的文档），您不能假设 DLL 是线程安全的，因此您应该假设它不是

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-11T07:29:40.993

如果您谈论的是 Win32 DLL，那么它们在被多个线程、应用程序调用时是安全的。我不知道你的 DLL 是做什么的，但如果你的 DLL 使用的是可锁定的资源，如文件或端口，那么基于 DLL 内部的实现可能会出现问题。

我不熟悉 Delphi 2009 身份验证 DLL 的工作。也许您应该将该信息添加到标题中（您正在专门谈论 Delphi 2009 DLL）

# objective-c - 如何将百分号添加到 NSString

> ID：739682
> 
> 赞同：464
> 
> 时间：2009-04-11T07:33:57.037
> 
> 标签：objective-c, nsstring, string-literals

我想在我的字符串中有一个数字后的百分号。像这样：75%。

我怎样才能做到这一点？我试过：

```
[NSString stringWithFormat:@"%d\%", someDigit]; 
```

但这对我不起作用。

* * *

## 回答 #1

> 赞同：952
> 
> 时间：2009-04-11T07:48:36.317

百分号`NSString`格式的代码是`%%`. `NSLog()`对于和`printf()`格式也是如此。

* * *

## 回答 #2

> 赞同：140
> 
> 时间：2009-04-11T08:03:41.350

百分号的转义码是“%%”，所以你的代码看起来像这样

```
[NSString stringWithFormat:@"%d%%", someDigit]; 
```

此外，所有其他格式说明符都可以在[概念字符串文章中找到](http://developer.apple.com/documentation/Cocoa/Conceptual/Strings/Articles/formatSpecifiers.html)

* * *

## 回答 #3

> 赞同：17
> 
> 时间：2013-02-12T15:06:07.073

如果这在某些情况下有帮助，则可以使用 unicode 字符：

```
NSLog(@"Test percentage \uFF05"); 
```

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2015-01-15T19:52:09.230

接受的答案不适用于 UILocalNotification。出于某种原因，`%%%%`（4 个百分号）或 unicode 字符 ' `\uFF05`' 仅适用于此。

回顾一下，在格式化字符串时，您可以使用`%%`. 但是，如果您的字符串是 UILocalNotification 的一部分，请使用`%%%%`或`\uFF05`。

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2013-06-13T03:14:03.297

似乎如果`%%`后面跟着 a `%@`，`NSString`会去一些奇怪的代码试试这个，这对我有用

```
NSString *str = [NSString stringWithFormat:@"%@%@%@", @"%%", 
                 [textfield text], @"%%"]; 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2013-04-14T11:56:00.670

使用以下代码。

```
 NSString *searchText = @"Bhupi"
 NSString *formatedSearchText = [NSString stringWithFormat:@"%%%@%%",searchText]; 
```

将输出：**%Bhupi%**

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2016-02-09T17:30:05.007

iOS 9.2.1、Xcode 7.2.1、ARC 已启用

您始终可以在附加的字符串中单独附加 '%' 而无需任何其他格式说明符，就像这样......

```
int test = 10;

NSString *stringTest = [NSString stringWithFormat:@"%d", test];
stringTest = [stringTest stringByAppendingString:@"%"];
NSLog(@"%@", stringTest); 
```

**iOS7.0+**

要将答案扩展到可能导致您发生冲突的其他字符，您可以选择使用：

`- (NSString *)stringByAddingPercentEncodingWithAllowedCharacters:(NSCharacterSet *)allowedCharacters`

一步一步写出来是这样的：

```
int test = 10;

NSString *stringTest = [NSString stringWithFormat:@"%d", test];
stringTest = [[stringTest stringByAppendingString:@"%"] 
             stringByAddingPercentEncodingWithAllowedCharacters:
             [NSCharacterSet alphanumericCharacterSet]];
stringTest = [stringTest stringByRemovingPercentEncoding];

NSLog(@"percent value of test: %@", stringTest); 
```

或简写：

```
NSLog(@"percent value of test: %@", [[[[NSString stringWithFormat:@"%d", test] 
stringByAppendingString:@"%"] stringByAddingPercentEncodingWithAllowedCharacters:
[NSCharacterSet alphanumericCharacterSet]] stringByRemovingPercentEncoding]); 
```

感谢所有原始贡献者。希望这可以帮助。干杯!

# python - Python：来自“线程”和“多处理”的锁可以互换吗？

> ID：739687
> 
> 赞同：7
> 
> 时间：2009-04-11T07:37:24.937
> 
> 标签：python, multithreading, locking, multiprocessing

模块中的锁可以与`threading`模块中的锁互换`multiprocessing`吗？

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-11T14:34:57.120

您通常可以互换使用这两者，但您需要认识到差异。例如，multiprocessing.Event 由一个命名信号量支持，该信号量对应用程序下的平台很敏感。

Multiprocessing.Lock 由 Multiprocessing.SemLock 支持 - 因此它需要命名信号量。本质上，您可以互换使用它们，但是使用多处理的锁会对应用程序带来一些平台要求（即，它不能在 BSD 上运行:)）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T07:42:18.483

我不这么认为。线程锁在同一个进程中，而多进程锁可能在共享内存中。

上次我检查时，多处理不允许您共享队列中的锁，这是一个线程锁。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T07:48:01.497

是的，您可以在单进程应用程序中正常使用多处理模块中的锁，但如果您使用多处理，则应该使用它的锁。

# asp.net - 专用服务器上 asp.net 中的会话超时

> ID：739688
> 
> 赞同：1
> 
> 时间：2009-04-11T07:37:40.210
> 
> 标签：asp.net, session-timeout

我有一个托管在专用服务器中的 asp.net 网站。我正在使用 web.config 来处理会话超时，即 60 分钟。我在专用服务器上做了以下设置（windows server 2003 和 IIS 6.0 版本）

*   在IIS的默认网站属性-->ASP.net tab-->Edit configuration-->Session timeouts-->60
*   应用程序池中的会话超时已延长至 60。
*   在应用程序池中回收工作进程已设置为 60。

我可以在我的本地系统上正确完成这项工作，问题出在专用服务器（Goddady）上。没有针对此问题的客户支持如果会话超时也是无限的，这也是公平的。但是，如果网络表单保持空闲，则每 20 分钟就会发生一次超时。如何摆脱这个？我猜测空闲超时正在覆盖会话超时，因为我四处搜索但尚未找到解决方案

请帮我........

谢谢，普拉巴

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T07:45:26.167

我们在托管服务器上遇到了同样的问题，并决定与其与托管公司争吵，不如在计时器上使用一些 javascript 来向服务器执行 AJAX 请求，以在会话即将到期时重置会话。

这个[站点（PreventTimeout）](http://www.ajaxlines.com/ajax/stuff/article/prevent_session_timeout_in_your_aspnet_ajax_application.php)与我们所做的非常接近。

我知道这并不能直接回答您的问题，但这对我们来说是一个很好的解决方法。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T09:38:51.090

如果您每 60 分钟回收一次应用程序池，那么（假设您的会话在池回收时终止）在池回收前 10 分钟开始的会话将仅持续 10 分钟。

平均而言，您希望一个会话持续 30 分钟。

# java - 如何将 Java 对象（bean）转换为键值对（反之亦然）？

> ID：739689
> 
> 赞同：97
> 
> 时间：2009-04-11T07:37:51.507
> 
> 标签：java, reflection, collections, javabeans

假设我有一个非常简单的 java 对象，它只有一些 getXXX 和 setXXX 属性。此对象仅用于处理值，基本上是记录或类型安全（和高性能）映射。我经常需要将此对象转换为键值对（字符串或类型安全）或从键值对转换为此对象。

除了反射或手动编写代码来进行此转换之外，实现此目的的最佳方法是什么？

一个示例可能是通过 jms 发送此对象，而不使用 ObjectMessage 类型（或将传入消息转换为正确类型的对象）。

* * *

## 回答 #1

> 赞同：186
> 
> 时间：2010-01-10T23:30:06.510

很多潜在的解决方案，但让我们再添加一个。使用[Jackson](https://github.com/FasterXML/jackson)（JSON 处理库）进行“无 json”转换，例如：

```
ObjectMapper m = new ObjectMapper();
Map<String,Object> props = m.convertValue(myBean, Map.class);
MyBean anotherBean = m.convertValue(props, MyBean.class); 
```

（[此博客条目](http://www.cowtowncoder.com/blog/archives/2009/12/entry_336.html)有更多示例）

您基本上可以转换任何兼容的类型：兼容意味着如果您确实从类型转换为 JSON，并且从该 JSON 转换为结果类型，条目将匹配（如果配置正确也可以忽略无法识别的条目）。

适用于人们期望的情况，包括地图、列表、数组、原语、类 bean 的 POJO。

* * *

## 回答 #2

> 赞同：56
> 
> 时间：2009-04-11T08:30:03.377

总是有 apache [commons beanutils](http://commons.apache.org/beanutils/)但当然它在引擎盖下使用反射

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-04-11T07:53:13.713

代码生成将是我能想到的唯一其他方式。就个人而言，我得到了一个通常可重用的反射解决方案（除非那部分代码绝对是性能关键的）。使用 JMS 听起来有点矫枉过正（额外的依赖，这甚至不是它的本意）。此外，它可能在引擎盖下也使用反射。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-10-15T19:28:56.753

这是一种将 Java 对象转换为 Map 的方法

```
public static Map<String, Object> ConvertObjectToMap(Object obj) throws 
    IllegalAccessException, 
    IllegalArgumentException, 
    InvocationTargetException {
        Class<?> pomclass = obj.getClass();
        pomclass = obj.getClass();
        Method[] methods = obj.getClass().getMethods();

        Map<String, Object> map = new HashMap<String, Object>();
        for (Method m : methods) {
           if (m.getName().startsWith("get") && !m.getName().startsWith("getClass")) {
              Object value = (Object) m.invoke(obj);
              map.put(m.getName().substring(3), (Object) value);
           }
        }
    return map;
} 
```

这是如何称呼它的

```
 Test test = new Test()
   Map<String, Object> map = ConvertObjectToMap(test); 
```

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2018-01-31T13:03:31.397

可能迟到了。您可以使用 Jackson 并将其转换为 Properties 对象。这适用于嵌套类，如果您想要 for abc=value 中的键。

```
JavaPropsMapper mapper = new JavaPropsMapper();
Properties properties = mapper.writeValueAsProperties(sct);
Map<Object, Object> map = properties; 
```

如果你想要一些后缀，那就做

```
SerializationConfig config = mapper.getSerializationConfig()
                .withRootName("suffix");
mapper.setConfig(config); 
```

需要添加这个依赖

```
<dependency>
  <groupId>com.fasterxml.jackson.dataformat</groupId>
  <artifactId>jackson-dataformat-properties</artifactId>
</dependency> 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2015-11-04T01:56:06.947

使用 Java 8 你可以试试这个：

```
public Map<String, Object> toKeyValuePairs(Object instance) {
    return Arrays.stream(Bean.class.getDeclaredMethods())
            .collect(Collectors.toMap(
                    Method::getName,
                    m -> {
                        try {
                            Object result = m.invoke(instance);
                            return result != null ? result : "";
                        } catch (Exception e) {
                            return "";
                        }
                    }));
} 
```

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-11T16:56:44.000

[JSON](http://www.json.org/)，例如使用 XStream + Jettison，是一种带有键值对的简单文本格式。例如，Apache ActiveMQ JMS 消息代理支持它，用于与其他平台/语言进行 Java 对象交换。

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2012-05-13T07:55:40.963

只需使用反射和 Groovy ：

```
def Map toMap(object) {             
return object?.properties.findAll{ (it.key != 'class') }.collectEntries {
            it.value == null || it.value instanceof Serializable ? [it.key, it.value] : [it.key,   toMap(it.value)]
    }   
}

def toObject(map, obj) {        
    map.each {
        def field = obj.class.getDeclaredField(it.key)
        if (it.value != null) {
            if (field.getType().equals(it.value.class)){
                obj."$it.key" = it.value
            }else if (it.value instanceof Map){
                def objectFieldValue = obj."$it.key"
                def fieldValue = (objectFieldValue == null) ? field.getType().newInstance() : objectFieldValue
                obj."$it.key" = toObject(it.value,fieldValue) 
            }
        }
    }
    return obj;
} 
```

* * *

## 回答 #9

> 赞同：3
> 
> 时间：2013-06-15T16:40:42.937

使用[juffrou-reflect](http://juffrou.sourceforge.net/)的 BeanWrapper。它非常高效。

以下是将 bean 转换为地图的方法：

```
public static Map<String, Object> getBeanMap(Object bean) {
    Map<String, Object> beanMap = new HashMap<String, Object>();
    BeanWrapper beanWrapper = new BeanWrapper(BeanWrapperContext.create(bean.getClass()));
    for(String propertyName : beanWrapper.getPropertyNames())
        beanMap.put(propertyName, beanWrapper.getValue(propertyName));
    return beanMap;
} 
```

我自己开发了 Juffrou。它是开源的，因此您可以自由使用和修改。如果您对此有任何疑问，我将非常乐意回复。

干杯

卡洛斯

* * *

## 回答 #10

> 赞同：3
> 
> 时间：2014-10-23T08:53:29.787

使用 Spring 时，还可以使用 Spring Integration object-to-map-transformer。可能不值得为此添加 Spring 作为依赖项。

[有关文档，请在http://docs.spring.io/spring-integration/docs/4.0.4.RELEASE/reference/html/messaging-transformation-chapter.html](http://docs.spring.io/spring-integration/docs/4.0.4.RELEASE/reference/html/messaging-transformation-chapter.html)上搜索“Object-to-Map Transformer”

本质上，它遍历作为输入的对象可到达的整个对象图，并从对象上的所有原始类型/字符串字段生成映射。它可以配置为输出：

*   平面图：{rootObject.someField=Joe, rootObject.leafObject.someField=Jane}，或
*   结构化映射：{someField=Joe, leafObject={someField=Jane}}。

这是他们页面中的一个示例：

```
public class Parent{
    private Child child;
    private String name; 
    // setters and getters are omitted
}

public class Child{
   private String name; 
   private List<String> nickNames;
   // setters and getters are omitted
} 
```

输出将是：

> {person.name=乔治，person.child.name=珍娜，person.child.nickNames[0]=Bimbo。. . ETC}

也可提供反向变压器。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-04-11T17:50:12.203

您可以使用 Joda 框架：

[http://joda.sourceforge.net/](http://joda.sourceforge.net/)

并利用 JodaProperties。但是，这确实规定您以特定方式创建 bean，并实现特定接口。但是，它确实允许您从特定类返回属性映射，而无需反射。示例代码在这里：

[http://pbin.oogly.co.uk/listings/viewlistingdetail/0e78eb6c76d071b4e22bbcac748c57](http://pbin.oogly.co.uk/listings/viewlistingdetail/0e78eb6c76d071b4e22bbcac748c57)

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2009-04-14T10:31:58.643

如果您不想硬编码对每个 getter 和 setter 的调用，反射是调用这些方法的唯一方法（但这并不难）。

您可以重构相关类以使用 Properties 对象来保存实际数据，并让每个 getter 和 setter 只调用 get/set 吗？然后你就有了一个非常适合你想做的事情的结构。甚至还有以键值形式保存和加载它们的方法。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2009-06-02T17:22:45.640

最好的解决方案是使用推土机。你只需要在映射器文件中这样的东西：

```
<mapping map-id="myTestMapping">
  <class-a>org.dozer.vo.map.SomeComplexType</class-a>
  <class-b>java.util.Map</class-b>
</mapping> 
```

就是这样，Dozer 负责其余的工作！！！

[推土机文档 URL](http://dozer.sourceforge.net/documentation/faq.html#complex-to-map)

* * *

## 回答 #14

> 赞同：2
> 
> 时间：2014-07-31T19:00:36.263

当然有可能是最简单的转换方式 - 根本没有转换！

不要使用类中定义的私有变量，而是使类只包含一个存储实例值的 HashMap。

然后你的 getter 和 setter 返回并设置值进出 HashMap，到时候将其转换为地图，瞧！- 它已经是一张地图。

使用一点 AOP 魔法，您甚至可以通过允许您仍然使用特定于每个值名称的 getter 和 setter 来保持 bean 固有的不灵活性，而不必实际编写单独的 getter 和 setter。

* * *

## 回答 #15

> 赞同：2
> 
> 时间：2016-05-04T14:46:40.630

您可以使用 java 8 流过滤器收集器属性，

```
public Map<String, Object> objectToMap(Object obj) {
    return Arrays.stream(YourBean.class.getDeclaredMethods())
            .filter(p -> !p.getName().startsWith("set"))
            .filter(p -> !p.getName().startsWith("getClass"))
            .filter(p -> !p.getName().startsWith("setClass"))
            .collect(Collectors.toMap(
                    d -> d.getName().substring(3),
                    m -> {
                        try {
                            Object result = m.invoke(obj);
                            return result;
                        } catch (Exception e) {
                            return "";
                        }
                    }, (p1, p2) -> p1)
            );
} 
```

* * *

## 回答 #16

> 赞同：1
> 
> 时间：2009-04-13T12:00:57.707

我的 JavaDude Bean Annotation Processor 生成代码来执行此操作。

[http://javadude.googlecode.com](http://javadude.googlecode.com)

例如：

```
@Bean(
  createPropertyMap=true,
  properties={
    @Property(name="name"),
    @Property(name="phone", bound=true),
    @Property(name="friend", type=Person.class, kind=PropertyKind.LIST)
  }
)
public class Person extends PersonGen {} 
```

上面生成的超类 PersonGen 包含一个 createPropertyMap() 方法，该方法为使用 @Bean 定义的所有属性生成一个 Map。

（请注意，我正在为下一个版本稍微更改 API —— 注释属性将为 defineCreatePropertyMap=true）

* * *

## 回答 #17

> 赞同：1
> 
> 时间：2009-04-14T11:00:41.087

你应该写一个通用的转换服务！使用泛型使其保持类型自由（因此您可以将每个对象转换为 key=>value 并返回）。

哪个领域应该是关键？从 bean 中获取该字段并在值映射中附加任何其他非瞬态值。

回来的路很轻松。读取 key(x) 并首先写入 key，然后将每个列表条目写回一个新对象。

[您可以使用apache commons beanutils](http://commons.apache.org/beanutils/)获取 bean 的属性名称！

* * *

## 回答 #18

> 赞同：1
> 
> 时间：2011-09-22T16:45:06.857

如果涉及到一个简单的对象树到键值列表的映射，其中键可能是从对象的根元素到被检查的叶子的虚线路径描述，很明显，树到键值列表的转换类似于对象到 xml 的映射。XML 文档中的每个元素都有一个定义的位置，并且可以转换为路径。因此，我将[XStream](http://xstream.codehaus.org)作为一个基本稳定的转换工具，并用自己的实现替换了分层驱动程序和编写器部分。XStream 还带有一个基本的路径跟踪机制 - 与其他两个结合起来 - 严格地导致一个适合该任务的解决方案。

* * *

## 回答 #19

> 赞同：1
> 
> 时间：2012-05-31T16:39:01.623

如果你真的想要性能，你可以走代码生成路线。

您可以通过自己的反射和构建 mixin AspectJ ITD 来实现这一点。

或者您可以使用 Spring Roo 并制作[Spring Roo Addon](http://www.ibm.com/developerworks/java/library/os-springroo5/index.html?ca=drs-)。您的 Roo 插件将执行与上述类似的操作，但所有使用 Spring Roo 的人都可以使用，并且您不必使用运行时注释。

我都做过。人们对 Spring Roo 很感兴趣，但它确实是 Java 最全面的代码生成。

* * *

## 回答 #20

> 赞同：1
> 
> 时间：2012-07-01T19:39:49.613

另一种可能的方式是在这里。

BeanWrapper 提供设置和获取属性值（单独或批量）、获取属性描述符以及查询属性以确定它们是可读还是可写的功能。

```
Company c = new Company();
 BeanWrapper bwComp = BeanWrapperImpl(c);
 bwComp.setPropertyValue("name", "your Company"); 
```

* * *

## 回答 #21

> 赞同：1
> 
> 时间：2017-03-22T21:45:37.863

在 Jackson 库的帮助下，我能够找到 String/integer/double 类型的所有类属性，以及 Map 类中的相应值。（*不使用反射 api！*）

```
TestClass testObject = new TestClass();
com.fasterxml.jackson.databind.ObjectMapper m = new com.fasterxml.jackson.databind.ObjectMapper();

Map<String,Object> props = m.convertValue(testObject, Map.class);

for(Map.Entry<String, Object> entry : props.entrySet()){
    if(entry.getValue() instanceof String || entry.getValue() instanceof Integer || entry.getValue() instanceof Double){
        System.out.println(entry.getKey() + "-->" + entry.getValue());
    }
} 
```

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2018-12-11T09:28:05.833

通过使用 Gson，

1.  将 POJO 转换`object`为 Json
2.  将 Json 转换为地图

    ```
     retMap = new Gson().fromJson(new Gson().toJson(object), 
                new TypeToken<HashMap<String, Object>>() {}.getType()
        ); 
    ```

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2019-11-25T07:06:14.670

我们可以使用 Jackson 库轻松地将 Java 对象转换为 Map。

```
<dependency>
   <groupId>com.fasterxml.jackson.core</groupId>
   <artifactId>jackson-databind</artifactId>
   <version>2.6.3</version>
</dependency> 
```

如果在 Android 项目中使用，您可以在应用程序的 build.gradle 中添加 jackson，如下所示：

```
implementation 'com.fasterxml.jackson.core:jackson-core:2.9.8'
implementation 'com.fasterxml.jackson.core:jackson-annotations:2.9.8'
implementation 'com.fasterxml.jackson.core:jackson-databind:2.9.8' 
```

示例实现

```
public class Employee {

    private String name;
    private int id;
    private List<String> skillSet;

    // getters setters
}

public class ObjectToMap {

 public static void main(String[] args) {

    ObjectMapper objectMapper = new ObjectMapper();

    Employee emp = new Employee();
    emp.setName("XYZ");
    emp.setId(1011);
    emp.setSkillSet(Arrays.asList("python","java"));

    // object -> Map
    Map<String, Object> map = objectMapper.convertValue(emp, 
    Map.class);
    System.out.println(map);

 }

} 
```

输出：

{name=XYZ, id=1011, 技能=[python, java]}

# java - 在 J2ME 中读取文本文件

> ID：739691
> 
> 赞同：4
> 
> 时间：2009-04-11T07:38:36.853
> 
> 标签：java, java-me

我正在尝试读取资源（asdf.txt），但如果文件大于 5000 字节，（例如）将 4700 个空字符插入到内容变量的末尾。有什么办法可以去除它们吗？（或设置正确的缓冲区大小？）

这是代码：

```
String content = "";
try {
    InputStream in = this.getClass().getResourceAsStream("asdf.txt");
    byte[] buffer = new byte[5000];
    while (in.read(buffer) != -1) {
        content += new String(buffer);
    }
} catch (Exception e) {
    e.printStackTrace();
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-11T08:15:14.537

最简单的方法是做正确的事情：使用 Reader 读取文本数据：

```
public String readFromFile(String filename, String enc) throws Exception {
    String content = "";
    Reader in = new 
    InputStreamReader(this.getClass().getResourceAsStream(filename), enc);
    StringBuffer temp = new StringBuffer(1024);
    char[] buffer = new char[1024];
    int read;
    while ((read=in.read(buffer, 0, buffer.length)) != -1) {
        temp.append(buffer, 0, read);
    }
    content = temp.toString();
    return content;
} 
```

请注意，您*绝对*应该定义要读取的文本文件的编码。

请注意，您的代码和此示例代码在 Java SE 和 J2ME 上同样适用。

# c# - 保持单元测试组织和命名正确的工具

> ID：739694
> 
> 赞同：4
> 
> 时间：2009-04-11T07:40:23.167
> 
> 标签：c#, unit-testing, naming, refactoring

我一直在尝试清理我们项目的单元和集成测试的命名和组织约定。我们正在使用 C#、NUnit、Visual Studio 和 Resharper。

似乎如果单元测试组织有一个最佳实践，那就是测试类和命名空间的布局和命名应该反映被测代码的布局和命名。结果，文件结构也将被复制。

拥有一个可以自动执行和帮助重构代码以符合这些约定的工具不是很好吗？有这样的工具吗？

例如，Resharper 很容易识别 OrderTest 是 Order 类的测试夹具。然后它可以确保 Order 类存在并且它在同一个命名空间中。如果 Order 类经历了重构并被重命名，则 OrderTest 类也应该被重命名。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-12T03:31:18.453

我也经常想要那个。我查看了 Resharper bug tracker，发现了这个问题的增强请求。它计划用于 Resharper 5.0。这是它的描述： http: [//www.jetbrains.net/jira/browse/RSRP-64050](http://www.jetbrains.net/jira/browse/RSRP-64050)。

至于单元测试的命名和组织，标准正在发生相当大的变化，特别是随着一些 bdd 样式的出现。 [这](http://elegantcode.com/2008/09/08/bdd-test-naming-experiment/)是关于这种命名风格的好帖子。我认为最好的工具是让团队适应并创建自己的标准。对于集体代码所有权，一段时间后应该只有一个标准。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-13T18:34:06.823

我们目前是Test01、Test02、Test03等……就像海盗裤子里的方向盘。

我更喜欢并且正在改用这种命名方式：[行为驱动开发：尽可能人性化](http://secretgeek.net/behaviorDdAhap.asp)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-13T21:23:53.763

实际上，ReSharper 4.5 具有命名样式，如果您不遵循您设置的命名约定，它会警告您。几天前，我在博客上写过这个。

如果您有兴趣，请点击此链接：http: [//vkreynin.wordpress.com/2009/04/09/resharper-45-complains-about-my-private-fields/](http://vkreynin.wordpress.com/2009/04/09/resharper-45-complains-about-my-private-fields/)。

# jquery - jQuery选择器值转义

> ID：739695
> 
> 赞同：56
> 
> 时间：2009-04-11T07:40:43.573
> 
> 标签：jquery, jquery-selectors, escaping

我有一个包含一系列选项的下拉列表：

```
<select id=SomeDropdown>
  <option value="a'b]&lt;p>">a'b]&lt;p></option>
  <option value="easy">easy</option>
<select> 
```

请注意，选项值/文本包含一些讨厌的东西：

*   单引号
*   右方括号
*   转义的 html

我需要删除 a'b]<p> 选项，但我没有运气编写选择器。两者都不：

```
$("#SomeDropdown >option[value='a''b]&lt;p>']"); 
```

或者

```
$("#SomeDropdown >option[value='a\'b]&lt;p>']"); 
```

正在返回选项。

使用“value =”选择器时转义值的正确方法是什么？

* * *

## 回答 #1

> 赞同：53
> 
> 时间：2010-06-24T20:46:28.130

我使用这个函数来转义 jquery 选择器。它基本上避开了所有有问题的东西，但可能过于激进。

```
函数 escapeStr(str)
{
    如果（字符串）
        return str.replace(/([ #;?%&,.+*~\':"!^$[\]()=>|\/@])/g,'\\$1');      

    返回字符串；
}

```

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-04-11T14:18:44.787

我不认为你可以。它*应该*是：

```
#SomeDropdown >option[value='a\'b]<p>'] 
```

这确实可以用作 CSS 选择器（在现代浏览器中）。以 JavaScript 字符串文字表示，您自然需要另一轮转义：

```
$("#SomeDropdown >option[value='a\\'b]<p>']") 
```

但这在 jQuery 中不起作用，因为它的选择器解析器并不完全符合标准。它使用这个正则表达式来解析条件的`value`一部分`[attr=value]`：

```
(['"]*)(.*?)\3|)\s*\] 
```

\3 是包含开头引号的组，奇怪的是允许多个开头引号，或者根本没有开头引号。这 。*？然后可以解析任何字符，*包括引号*，直到它遇到第一个 ']' 字符，结束匹配。没有提供反斜杠转义 CSS 特殊字符的规定，因此您无法匹配 jQuery 中的任意字符串值。

（再一次，正则表达式解析器失败了。）

但好消息是您不必依赖 jQuery 选择器；您可以使用非常好的 DOM 方法，尤其是 HTMLSelectElement.options：

```
var select= document.getElementById('SomeDropdown');
for (var i= select.options.length; i-->0;) {
    if (select.options[i].value=="a'b]<p>") {
        // do something with option
}   } 
```

这比要求 jQuery 费力地解析和实现您的选择器要简单和快很多倍，并且您可以使用任何您喜欢的值字符串，而不必担心转义特殊字符。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-06-10T04:32:49.270

`.filter()`与自定义函数一起使用。`txt`应该包含你讨厌的字符串，或者你可以`indexOf`用你选择的任何其他函数替换。

```
$("#SomeDropdown option")
   .filter(function(i){
       return $(this).attr("value").indexOf(txt) != -1;
   })
   .remove(); 
```

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2012-11-23T16:52:01.250

我发现您可以使用 \\ 来转义选择器。将其视为正则表达式的一个 \ 和一个从正则表达式中逃脱的。

例子：

```
$(this).find('input[name=user\\[1\\]\\[name\\]]').val(); 
```

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2013-03-18T23:56:40.640

如果您尝试以编程方式进行转义，则只需要一组斜杠。这不起作用：

```
var key = 'user[1][name]';
$(this).find('select[name=' + key + ']'); 
```

但这将：

```
var key = 'user\[1\]\[name\]';
$(this).find('select[name=' + key + ']'); 
```

这也将是：

```
$(this).find('select[name=user\\[1\\]\\[name\\]]'); 
```

您可以使用此 javascript 构建正确转义的选择器：

```
if(key.indexOf('[') !== -1) {
    key = key.replace(/([\[\]])/g, "\\$1");
} 
```

这是一个 JS Fiddle，它显示了一些奇怪的行为：

[http://jsfiddle.net/dH3cV/](http://jsfiddle.net/dH3cV/)

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-11T22:46:05.130

问题是由于 HTML 实体造成的；“ **`&lt;`**”被浏览器视为“ **`<`**”。

bobince 提供的例子也是如此；请注意，以下内容不适用于 Win + FF3 上的 jQuery 1.32：

```
var select= document.getElementById('SomeDropdown');
for (var i= select.options.length; i-->0;) {
    if (select.options[i].value=="a'b]&lt;p>") {
        alert('found it');
    }   
} 
```

但是，将实体更改为文字确实会找到所需的值：

```
var select= document.getElementById('SomeDropdown');
for (var i= select.options.length; i-->0;) {
    if (select.options[i].value=="a'b]<p>") {
        alert('found it');
    }   
} 
```

当然，这里有一个问题，因为您指定的值不是您要查找的确切值。这也可以通过添加辅助函数来纠正：

```
function html_entity_decode(str) {
    var decoder = document.createElement('textarea');
    decoder.innerHTML = str;
    return decoder.value;
} 
```

现在都在一起了：

```
var srcValue = html_entity_decode("a'b]&lt;p>");
var select= document.getElementById('SomeDropdown');
for (var i= select.options.length; i-->0;) {
    if (select.options[i].value == srcValue) {
        alert('found it');
    }   
} 
```

现在，您正在搜索的输入值与选择元素的值完全匹配。

这也可以使用 jQuery 方法编写：

```
var srcValue = html_entity_decode("a'b]&lt;p>");
$($('#SomeDropdown').attr('options')).each(function() {
    if (this.value == srcValue)
    {
        $(this).remove();
    }
}); 
```

最后，作为一个插件，因为它们很容易制作：

```
jQuery.fn.removeByValue = function( val )
{
    var decoder = document.createElement('textarea');
    decoder.innerHTML = val;    
    var srcValue = decoder.value;

    $( $(this)[0].options ).each(function() {
        if (this.value == srcValue) {
            $(this).remove();
        }
    });

    return this;
};

$('#SomeDropdown').removeByValue("a'b]&lt;p>"); 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2020-06-09T16:33:36.047

[`jQuery.escapeSelector()`](https://api.jquery.com/jQuery.escapeSelector/)在 jQuery 3 中引入。要将选项与`a'b]&lt;p>`问题中的值匹配，您可以使用：

```
$("#SomeDropdown > option[value='" + $.escapeSelector("a'b]<p>") + "']") 
```

一般来说，对于变量可能包含特殊 CSS 符号`jQuery.escapeSelector()`的情况，使用是一种很好的做法。`$('#' + $.escapeSelector(id))``id`

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-12-11T00:38:28.623

jQuery 的论坛对此有一个很好的解决方案：

[https://learn.jquery.com/using-jquery-core/faq/how-do-i-select-an-element-by-an-id-that-has-characters-used-in-css-notation/](https://learn.jquery.com/using-jquery-core/faq/how-do-i-select-an-element-by-an-id-that-has-characters-used-in-css-notation/)

他们建议的这个稍微修改过的版本也是空安全的。

```
function jqid (id) {
  return (!id) ? null : '#' + id.replace(/(:|\.|\[|\]|,)/g, '\\$1');
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2016-03-09T20:37:44.190

安全地[转义 CSS 字符串](https://mathiasbynens.be/notes/css-escapes)并不容易，而且不能用简单的正则表达式来完成。

您可以使用[`CSS.escape()`](https://developer.mozilla.org/en-US/docs/Web/API/CSS/escape).

并非所有浏览器都支持此功能，但[存在 polyfill](https://github.com/mathiasbynens/CSS.escape)。

# silverlight - 从 JavaScript 获取 XAML UI 元素

> ID：739708
> 
> 赞同：0
> 
> 时间：2009-04-11T07:50:27.667
> 
> 标签：silverlight

我已经为此尝试过 Google，但也许我没有正确地形成我的查询，因为我得到了很多废话和无关紧要的东西。可能问题太简单了。抱歉，自从我上次做 Silverlight 以来已经有一段时间了！

如果我有一个 XAML 元素：

```
<Image Canvas.Top="128" x:Name="img4_7" Width="180.3" Height="117" Source="monkey1.jpg" Stretch="Fill" Canvas.Left="-3.344" Opacity="0.595"/> 
```

如何使用 x:Name 在 JavaScript 中获得它？我正在寻找类似 getElementById() 的东西，但对于 Silverlight。我几乎想要这样的东西：

```
img4_7=rootElement.children.getItem('img4_7'); 
```

显然，这是行不通的！

我没有使用 ASP.NET AJAX。

感谢您对这个菜鸟问题的任何帮助！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T08:42:46.060

弄清楚了。

需要使用 control.content.findName()

这是我的handLoad，供其他人受益：

```
handleLoad: function(control, userContext, rootElement) 
{
    this.control = control;

    // Sample event hookup: 
    rootElement.addEventListener("MouseLeftButtonDown", Silverlight.createDelegate(this, this.handleMouseDown));

    this.img4_7=control.content.findName("img4_7"); 

    if (this.img4_7) {
        this.img4_7.addEventListener("MouseEnter", Silverlight.createDelegate(this,this.handleMouseEnter));
        this.img4_7.addEventListener("MouseLeave",Silverlight.createDelegate(this,this.handleMouseLeave));

    }

}, 
```

# vb.net - 从datagridview数据创建类的有效方法

> ID：739709
> 
> 赞同：0
> 
> 时间：2009-04-11T07:50:48.463
> 
> 标签：vb.net, datagridview

是否有替代方法将数据从 datagridview 加载到类中，而不是遍历 datagridview？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T08:02:20.120

```
IEnumerable myList = myDataGrid.ItemsSource; 
```

# java - Java：使用符合我的接口的外部类

> ID：739715
> 
> 赞同：1
> 
> 时间：2009-04-11T07:55:59.043
> 
> 标签：java, class, interface

我可以在 Java 中采用符合我的自定义接口之一的外部类并将其“转换”到该接口吗？

例子：

```
public class YouCanNotChangeMe_IAmNotYours{
    public void doSomethingSpecial();
}

public interface MyInterface{
    void doSomethingSpecial();
} 
```

我可以在需要我的界面的地方使用那个外国类吗？

**为什么我需要这个？**

[正如我在**这里**](https://stackoverflow.com/questions/728140/can-i-dynamically-unload-and-reload-other-versions-of-the-same-jar)提到的，我想在运行时动态重新加载一些 JAR 的较新版本 。

现在，服务器知道所有接口（在编译时知道 JAR 的旧版本）。问题是，在运行时从该 JAR 的较新版本加载类之后，这些“新”类的行为就好像它们不“知道”编译时已知接口一样。

*示例：一个名为HelloClass*的旧类（在编译时已知）**确实**实现了接口*HelloInterface*，但**新加载**的类*HelloClass* **没有**实现相同的接口！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T08:09:10.073

您可以扩展外部类（假设它是非最终类）并使该类实现接口。

或者，您可以围绕该接口实现自己的包装器：

```
public class ForeignClassWrapper implements MyInterface {
  private final YouCanNotChangeMe_IAmNotYours delegate;

  public ForeignClassWrapper(YouCanNotChangeMe_IAmNotYours delegate) {
    this.delegate = delegate;
  }

  public void doSomethingSpecial() {
    delegate.doSomethingSpecial();
  }
} 
```

更一般地，您可以使用反射获得相同的效果（因此您不需要`YouCanNotChangeMe_IAmNotYours`在包装类中进行硬编码）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T09:30:28.303

除非我弄错了，听起来您需要重新考虑您的容器和 ClassLoader 设计。您正在尝试实现您的普通 servlet 容器支持的相同类型的功能，因此可能是一个想法来寻找灵感。

至于具体问题：如果**x.getClass().getClassLoader() == A.class.getClassLoader()**，类型**A的实例****x**只是类**A**的一个实例。因此，即使两个或多个对象可能属于**A**类，如果它们具有不同的 ClassLoader，Java 也会将它们视为不同的类型。

 ******听起来您尝试转换的接口应该位于公共基础（或系统）类加载器中。

# pdf-generation - 在 wiki 中创作、生成 PDF 文档、CHM 文件或嵌入式帮助

> ID：739725
> 
> 赞同：4
> 
> 时间：2009-04-11T08:02:16.517
> 
> 标签：pdf-generation, documentation-generation

任何人都知道生成跨越整个 wiki 的 PDF 文件或 CHM 文件的 wiki 或 wiki 插件？

*   我想控制目录。
*   我希望内部和外部链接能够正常工作。
*   理想情况下允许调整输出模板，但这不会破坏交易。

我想使用 WIKI 语法和思维方式（大量的交叉链接等）生成内容，但以 PDF、CHM 或嵌入式应用程序表单的形式发送内容。比在最终用户机器上安装 wiki 软件更友好的东西...

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-06-03T22:05:55.923

[XWiki](http://xwiki.org/)开箱即用。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T08:53:24.913

MediaWiki [PDF 导出扩展](http://www.mediawiki.org/wiki/Extension:Pdf_Export)允许您选择一组 PDF 页面。我还没有安装它，所以不确定是否可以轻松使用该功能来选择*所有*页面。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-18T03:52:03.517

Sphinx ( [https://www.sphinx-doc.org](https://www.sphinx-doc.org) ) 是一个相当不错的工具，用于生成 HTML（或 CHM）和 PDF 文档，具有类似 wiki 的语法。它不是维基；您无法通过网络进行编辑，并且生成 HTML 需要构建过程。尽管如此，它还是相当不错的，具有[交叉引用](https://www.sphinx-doc.org/en/master/usage/restructuredtext/roles.html#cross-referencing-syntax)、[相当简单的标记](https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html)和（在 HTML 输出中）用 JavaScript 实现的搜索引擎，除了静态文件托管之外没有服务器端依赖项。Sphinx 是为新版本的[Python 文档](http://docs.python.org/)开发的，并且非常具有主题性；例如，GeoServer 项目（我正在研究，请原谅无耻的插件）正在使用带有自定义主题的 Sphinx，用于新版本的用户和开发人员[手册](http://docs.geoserver.org/)。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-24T21:55:17.530

Confluence 允许您在将空间导出为 PDF 时选择页面
但是您不能自定义很多 PDF
您可以通过主题稍微自定义它（基于速度）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-23T02:11:54.913

JIRA ( [http://www.atlassian.com/software/jira/default.jsp](http://www.atlassian.com/software/jira/default.jsp) ) 是您在控制方面的怪诞梦；它导出为 PDF（以及其他），您可以完全控制页面、TOC 和其他方面，尽管设置它会有些复杂。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-04T19:07:43.747

Microsoft 有一个 HtmlHelp 创作工具，可以从 html 文件创建 chm 文件。

如果您在 Web 上和已部署的应用程序中都需要帮助文件，则从 Web 上使用的相同文件生成帮助可能是一个很好的解决方案。如果帮助站点是使用 asp.net（即数据库驱动）创建的，那么可能值得使用基本样式并创建一个工具来通过读取提供的页面来生成 html 文件？

看看： http: [//msdn.microsoft.com/en-us/library/ms524239 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/ms524239(VS.85).aspx)

我想还可以从 Html 页面创建一个 PDF？

# c - C：为什么 size_t 不是 C 关键字？

> ID：739727
> 
> 赞同：26
> 
> 时间：2009-04-11T08:03:38.837
> 
> 标签：c, types, sizeof, size-t

`sizeof`是一个 C*关键字*。它以名为 的类型返回大小`size_t`。但是，`size_t`不是关键字，**而是**主要在**`stddef.h`**可能还有其他 C 标准头文件中定义。

考虑一个场景，您想要创建一个**不**包含任何 C 标准头文件或库的 C 程序。（例如，如果您正在创建 OS 内核。）现在，在这样的代码中，`sizeof`可以使用（它是 C 关键字，因此它是*语言*的一部分），但它返回的类型 ( `size_t`) 不是可用的！

这不是表示 C 标准规范中存在某种问题吗？你能澄清一下吗？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-11T08:24:06.823

它并没有真正返回 size_t 类型的值，因为 size_t 本身不是具体类型，而是未指定的内置类型的 typedef。Typedef 标识符（例如 size_t）完全等同于它们各自的底层类型（并在编译时转换为）。如果 size_t 在您的平台上定义为 unsigned int，则 sizeof 在您的系统上编译时返回一个 unsigned int。size_t 只是维护可移植性的一种方便方式，如果您通过名称显式使用它，则只需将其包含在 stddef.h 中。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-11T08:17:40.443

`sizeof`是一个关键字，因为尽管它有名称和用法，但它是一个类似or or的*运算符*，而不是类似or or的*函数*。很多人忘记（或只是不知道）它实际上是一个运算符，并且*总是*在编译时而不是在运行时解析。`+``=``<`*`printf()``atoi()``fgets()``sizeof`*

 **C 语言不需要`size_t`是一种可用的、一致的语言。这只是标准库的一部分。C 语言需要所有运算符。如果`+`C 使用关键字`plus`来添加数字，而不是 ，则将其设为运算符。

此外，我一直在将 s 半隐式重铸为`size_t`s `unsigned int`（以及常规`int`s，但 Kernighan 和 Ritchie 总有一天会为此而惩罚我）。如果愿意，您可以将 a 的返回类型分配给`sizeof`int，但在我的工作中，我通常只是将它直接传递给 a`malloc()`或其他东西。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-04-11T08:37:05.980

C 标准中的一些头文件是为*独立*环境定义的，即适合在操作系统内核中使用。它们不定义任何函数，仅定义和 typedef。

它们是 float.h、iso646.h、limits.h、stdarg.h、stdbool.h、stddef.h 和 stdint.h。

在操作系统上工作时，从*这些*标头开始并不是一个坏主意。让它们可用会使你的内核中的许多事情变得更容易。尤其是 stdint.h 会变得很方便（uint32_t 等）。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-11T23:10:25.943

> 这不是表示 C 标准规范中存在某种问题吗？

查找 C 的托管实现和独立 C 实现之间的区别。独立式 (C99) 实现需要提供标头：

*   `<float.h>`
*   `<iso646.h>`
*   `<limits.h>`
*   `<stdarg.h>`
*   `<stdbool.h>`
*   `<stddef.h>`
*   `<stdint.h>`

这些头文件根本没有定义任何功能。它们定义了语言的某些特定于编译器的部分（例如， 中的`offsetof`宏`<stddef.h>`，以及 中的变量参数列表宏和类型`<stdarg.h>`），但它们可以在不作为完整关键字实际构建到语言中的情况下进行处理。

这意味着即使在您假设的内核中，您也应该期望 C 编译器提供这些头文件和任何底层支持函数——即使您提供了其他所有内容。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-11T10:03:48.673

我认为`size_t`不是关键字的主要原因是：

*   没有令人信服的理由。C 和 C++ 语言的设计者一直倾向于在可能且合理的情况下在库中实现语言特性
*   将关键字添加到语言可能会给现有的遗留代码体带来问题。这是他们通常不愿添加新关键字的另一个原因。

例如，在讨论 C++ 标准的下一个主要修订版时，[Stroustrup 曾这样说](http://www.artima.com/cppsource/cpp0x.html)：

> C++0x 的改进应该以这样一种方式进行，即生成的语言更容易学习和使用。委员会的经验法则包括：
> 
> `...`
> 
> *   喜欢标准库设施而不是语言扩展
> 
> `...`

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-04-11T08:08:04.473

没有理由不包含 stddef.h，即使您正在使用内核 - 它为您的特定编译器定义了任何代码都需要的类型大小。

另请注意，几乎所有 C 编译器都是自编译的。因此， sizeof 运算符的实际编译器代码将使用 size_t 并引用与用户代码相同的 stddef.h 文件。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-11T08:04:59.070

size_t 实际上是一种类型 - 通常是无符号整数。Sizeof 是一个给出类型大小的运算符。sizeof 返回的类型实际上是特定于实现的，而不是 C 标准。它只是一个整数。

编辑：要非常清楚，您不需要 size_t 类型即可使用 sizeof。我认为您正在寻找的答案是 - 是的，它是不一致的。不过，**没关系。**您实际上仍然可以正确使用 sizeof 而无需从头文件中定义 size_t 。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-11T08:12:25.307

来自[MSDN](http://msdn.microsoft.com/en-us/library/4s7x1k91(VS.71).aspx)：

> 当 sizeof 运算符应用于 char 类型的对象时，它产生 1

即使您没有可用/包含的 stddef.h 并且不知道 size_t，使用 sizeof 也可以获取对象相对于 char 的大小。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-11T08:10:16.747

**size_t**不是必要的关键字。不同的架构通常对整数类型有不同的大小。例如，如果 64 位机器没有决定将**int**设置为 64 位数据类型，则它们可能具有**unsigned long long** as **size_t 。**

 **如果您将 sizeof 设置为编译器的内置类型，那么它将带走进行交叉编译的能力。

此外，**sizeof**更像是一个神奇的编译时宏（想想 c++ 模板），它解释了为什么它是一个关键字而不是定义的类型。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-11T08:21:38.640

原因很简单，因为它不是基本类型。如果您查看 C 标准，您会发现基本类型包括`int`等，`char`但不包括`size_t`。为什么这样？正如其他人已经指出的那样，`size_t`它是一种特定于实现的类型（即，一种能够保持任何对象的“C 字节”数量大小的类型）。

另一方面，`sizeof`是（一元）运算符。所有运算符都是关键字。

# html - 在 DataList 中呈现 HTML

> ID：739730
> 
> 赞同：1
> 
> 时间：2009-04-11T08:07:19.780
> 
> 标签：html, formatting, datalist

我有一个格式化文本，其中包含在消息中实现的粗体、斜体和其他样式。我将此消息存储在数据库中。现在我想在 DataList 的字段中实现这些标签。我该怎么做？

不工作。它只是这样显示标签。有什么帮助吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T09:04:59.253

如果您的意思是您的“消息”包含格式化的 HTML，您应该在 DataBinder 评估“消息”属性的值之后简单地对其进行 HTMLDecode。例如：

```
' "message" contains the string "<b>Hello World!</b>"
' Within the DataList:
<ItemTemplate>
  <asp:Label ID="lbl1" runat="server" Text='<%# Server.HtmlDecode(Eval("message").ToString()) %>' />
</ItemTemplate> 
```

# fluent-nhibernate - FluentNHibernate HasMany 未填充集合

> ID：739746
> 
> 赞同：0
> 
> 时间：2009-04-11T08:17:18.960
> 
> 标签：fluent-nhibernate

我与以下配置有一对多关系

```
 HasMany(x => x.Staff)  
       .Inverse()  
       .Cascade.All(); 
```

但我得到一个集合未能初始化错误。

我不必在这里指定外键，我找到的例子不需要？？？？

它如何知道哪个是外键？

编辑：当我说它是 StaffID 时，仔细查看 sql 尝试使用字段 Staff_id 的异常？

马尔科姆

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-11T12:23:18.807

尝试

```
 HasMany(x => x.Staff)
   .KeyColumnNames.Add("StaffID")
   .Inverse()  
   .Cascade.All(); 
```

Staff_id 是自动配置的默认值，尽管您可以设置自动配置使用的约定。

如果要将集合映射到 IList `<T`>，则需要添加 AsBag() 否则 NHibernate 会抱怨缺少“idx”列。如果要延迟加载集合，请添加 .LazyLoad()。我通常使用 .Cascade.AllDeleteOrphan()。

# .net - 如何重构 WinForms 应用程序？

> ID：739749
> 
> 赞同：2
> 
> 时间：2009-04-11T08:18:56.383
> 
> 标签：.net, winforms, refactoring, legacy-code

我将在不久的将来修复 WinForms 应用程序 (.NET 2.0)。通过查看源代码，我发现大型代码文件（超过 2000 行）其中大多数是生成的对话框，其中包含大量代码隐藏。

有没有人可以分享我的建议？任何关于错误修复或重构 WinForms 应用程序的战争故事或最佳实践？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T11:08:45.257

简短版本：

购买 Michael Feathers 的书，有效地使用旧代码。

更长的版本：

维护（更改）此类应用程序的最大挑战是在不破坏某些内容的情况下进行。这意味着您需要了解应用程序的行为，最简单的方法是围绕它进行测试。正如您所指出的，起初这可能令人生畏，但并非不可能。它需要纪律和耐心。

您不必从单元测试开始。获得自动化框架（例如 NUnitForms 或 White）通常更容易首先将应用程序作为黑盒来驱动。在你需要改变的区域周围建立一套测试，让你有足够的信心在不破坏任何东西的情况下改变它。然后进入并开始针对单元可测试性进行重构。

如果它类似于我正在开发的应用程序，它主要涉及：

*   删除未使用的代码（这会分散注意力）。
*   删除公共静态方法调用并用接口替换它们（依赖注入是这里的关键技术）。
*   将重复的代码提取到类中。
*   隐藏适配器后面的文件处理、网络 IO 和用户界面代码（这些最初可能是非常薄的包装器，足以让您在测试时用存根替换它们）。
*   寻找机会将行为提取到小班中。

有时重写代码部分比重构它们更容易，但这需要通过测试或参考规范（如果存在）来理解行为。

除了任何实用建议外，如果您是从事此工作的团队的一员，请确保您*在一起工作*。这将使工作更轻松、更愉快，并确保您今天所做的更改明天不会被不了解您正在做什么的人撤消。

我可以在这个话题上写一整天，但羽毛先生在这方面做得更好，而且我很饿。祝你好运！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-11T08:32:00.360

*   首先尝试理解代码及其背后的逻辑。
*   一旦你理解了一些代码，试着为业务对象建模必要的类
*   在您的新设计中使用某种层方法（3 层是经典的）：接口层、业务层、数据访问层（或其他一些服务层）。
*   耐心和记录一切！

我认为这是基本的东西。这里很多人一定有很多建议。祝你好运！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T08:31:03.717

我会先写一些单元测试。如果代码相当密集，您将需要这些来保持理智。

它们会给你一些信心，让你在重构中相当积极。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T09:19:03.650

从头到尾的几件事：

*   将所有生成的代码放入部分类或区域（*我使用区域*）
*   将所有代码从操作移动到单独的区域或类作为函数
*   为每个函数编写一个单元测试
*   在此之后进行常见的重构模式，将相同/相似的功能组合到一个函数中
*   确保不同的按钮不使用不同的功能来做同样的事情（尤其是在 VB.NET 中，这是很常见的设计，所以你可以在你的应用程序中发现）
*   在可能的情况下正确使用发送者对象，而不是在控件事件处理程序中硬编码控件名称
*   如果你看到任何代码都可以转换为一个不错的类，那就去做吧。从 WinForms 中删除所有非 GUI 代码。有时需要重构原始类以使其能够与 GUI 一起使用，编写单元测试并重构它们。*（通常即使没有单元测试你也应该没问题）*

# sqlite - SQLite - 获得最接近的价值

> ID：739759
> 
> 赞同：15
> 
> 时间：2009-04-11T08:29:37.607
> 
> 标签：sqlite

我有 SQLite 数据库，并且其中有某些类型为“double”的列。我想获得该列值中最接近指定值的行。

例如，在我的表中，我有：

```
id: 1; value: 47
id: 2; value: 56
id: 3; value: 51 
```

我想得到一个值最接近 50 的行。所以我想接收 id: 3 (value = 51)。

我怎样才能实现这个目标？

谢谢。

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2015-08-14T18:58:21.547

使用 order-by，SQLite 将扫描整个表并将所有值加载到临时 b-tree 中以对它们进行排序，从而使任何索引都无用。这将非常慢并且在大表上使用大量内存：

```
explain query plan select * from 'table' order by abs(10 - value) limit 1;
0|0|0|SCAN TABLE table
0|0|0|USE TEMP B-TREE FOR ORDER BY 
```

您可以使用如下索引获得下一个更低或更高的值：

```
select min(value) from 'table' where x >= N;
select max(value) from 'table' where x <= N; 
```

您可以使用`union`从单个查询中获取两者：

```
explain query plan 
        select min(value) from 'table' where value >= 10
  union select max(value) from 'table' where value <= 10;
1|0|0|SEARCH TABLE table USING COVERING INDEX value_index (value>?)
2|0|0|SEARCH TABLE table USING COVERING INDEX value_index (value<?)
0|0|0|COMPOUND SUBQUERIES 1 AND 2 USING TEMP B-TREE (UNION) 
```

即使在大桌子上，这也会非常快。您可以简单地加载这两个值并在代码中评估它们，或者使用更多的 sql 以各种方式选择一个：

```
explain query plan select v from
   (      select min(value) as v from 'table' where value >= 10
    union select max(value) as v from 'table' where value <= 10)
  order by abs(10-v) limit 1;
2|0|0|SEARCH TABLE table USING COVERING INDEX value_index (value>?)
3|0|0|SEARCH TABLE table USING COVERING INDEX value_index (value<?)
1|0|0|COMPOUND SUBQUERIES 2 AND 3 USING TEMP B-TREE (UNION)
0|0|0|SCAN SUBQUERY 1
0|0|0|USE TEMP B-TREE FOR ORDER BY 
```

或者

```
explain query plan select 10+v from
   (      select min(value)-10 as v from 'table' where value >= 10
    union select max(value)-10 as v from 'table' where value <= 10)
  group by v having max(abs(v)) limit 1;
2|0|0|SEARCH TABLE table USING COVERING INDEX value_index (value>?)
3|0|0|SEARCH TABLE table USING COVERING INDEX value_index (value<?)
1|0|0|COMPOUND SUBQUERIES 2 AND 3 USING TEMP B-TREE (UNION)
0|0|0|SCAN SUBQUERY 1
0|0|0|USE TEMP B-TREE FOR GROUP BY 
```

由于您对任意大于和小于目标的值都感兴趣，因此您无法避免进行两次索引搜索。但是，如果您知道目标在一个很小的范围内，则可以使用“between”来只命中索引一次：

```
explain query plan select * from 'table' where value between 9 and 11 order by abs(10-value) limit 1;
0|0|0|SEARCH TABLE table USING COVERING INDEX value_index (value>? AND value<?)
0|0|0|USE TEMP B-TREE FOR ORDER BY 
```

当它只评估 1-2 个值时，这将比上面的联合查询快 2 倍左右，但是如果您开始必须加载更多数据，它会很快变得更慢。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-11T08:33:21.247

这应该有效：

```
SELECT * FROM table
ORDER BY ABS(? - value)
LIMIT 1 
```

where`?`代表您要比较的值。

# .net - 非托管代码中的 Windows 窗体？

> ID：739763
> 
> 赞同：1
> 
> 时间：2009-04-11T08:32:31.327
> 
> 标签：.net, c++, visual-studio, windows-forms-designer

我发现自己很恼火 Visual Studio 带有一个精美的 GUI 界面设计器，而且它只能被 .NET 应用程序访问，甚至不能被托管 C++ 访问。

有什么简单的方法可以至少用非托管/外部代码打开一个 C DLL 类型的接口？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-11T08:45:07.567

Windows 窗体在很大程度上是 .NET 框架的一部分，不能从非托管代码访问（至少在任何实际意义上都不能）。但是，可以从托管 C++ 调用它（我不知道 Visual Studio 本身的设计器支持，但托管 C++ 绝对可以使用 Windows 窗体库）。

您可能想查看其他 C++ GUI 选项，例如[Qt](http://www.qtsoftware.com/products/)、[wxWidgets](http://www.wxwidgets.org/)或[Gtkmm](http://www.gtkmm.org/)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-11T10:34:02.237

MFC 仍然是在 Visual C++ 2008 中开发 GUI 的可行选择。这里甚至是一个关于[如何将 MFC 与 WinForms 集成](http://msdn.microsoft.com/en-us/library/ms239720.aspx)的示例。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-11T08:45:32.967

通过 Visual Studio 托管的 C++ 至少从 2003 年起就支持表单设计器，[带有托管扩展](http://msdn.microsoft.com/en-us/library/aa983522(VS.71).aspx)和 C++/CLI 项目的 C++ 允许使用表单设计器，这里有一个快速的[hello world](http://www.codeproject.com/KB/mcpp/hellocli_part1.aspx)示例来帮助您找到它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-07-04T13:57:03.170

有志者事竟成。如果您愿意跳过障碍，您可以混合和匹配几乎任何托管/非托管代码的组合。

这是一个很好的（虽然是旧的）概述：http: [//msdn.microsoft.com/en-us/library/ms973872.aspx](http://msdn.microsoft.com/en-us/library/ms973872.aspx)

# django - 如何在 Django 查询中进行 OR 过滤？

> ID：739776
> 
> 赞同：419
> 
> 时间：2009-04-11T09:02:06.717
> 
> 标签：django, django-queryset

我希望能够列出用户添加的项目（它们被列为创建者）或项目已被批准。

所以我基本上需要选择：

```
item.creator = owner or item.moderated = False 
```

我将如何在 Django 中执行此操作？（最好使用过滤器或查询集）。

* * *

## 回答 #1

> 赞同：741
> 
> 时间：2009-04-11T09:32:22.947

有些[`Q`](http://docs.djangoproject.com/en/stable/topics/db/queries/#complex-lookups-with-q-objects)对象允许进行复杂的查找。例子：

```
from django.db.models import Q

Item.objects.filter(Q(creator=owner) | Q(moderated=False)) 
```

* * *

## 回答 #2

> 赞同：159
> 
> 时间：2009-04-11T11:43:27.017

您可以使用 | 运算符直接组合查询集而不需要 Q 对象：

```
result = Item.objects.filter(item.creator = owner) | Item.objects.filter(item.moderated = False) 
```

（编辑 - 我最初不确定这是否会导致额外的查询，但@spookylukey 指出惰性查询集评估会解决这个问题）

* * *

## 回答 #3

> 赞同：68
> 
> 时间：2017-06-26T16:44:12.810

值得注意的是，可以添加**Q**表达式。

例如：

```
from django.db.models import Q

query = Q(first_name='mark')
query.add(Q(email='mark@test.com'), Q.OR)
query.add(Q(last_name='doe'), Q.AND)

queryset = User.objects.filter(query) 
```

这最终会出现如下查询：

```
(first_name = 'mark' or email = 'mark@test.com') and last_name = 'doe' 
```

这样就不需要处理*或*操作符、reduce 等。

* * *

## 回答 #4

> 赞同：38
> 
> 时间：2014-09-21T08:44:30.303

您想使过滤器动态化，那么您必须使用 Lambda

```
from django.db.models import Q

brands = ['ABC','DEF' , 'GHI']

queryset = Product.objects.filter(reduce(lambda x, y: x | y, [Q(brand=item) for item in brands])) 
```

`reduce(lambda x, y: x | y, [Q(brand=item) for item in brands])`相当于

```
Q(brand=brands[0]) | Q(brand=brands[1]) | Q(brand=brands[2]) | ..... 
```

* * *

## 回答 #5

> 赞同：27
> 
> 时间：2015-03-26T14:26:36.113

类似于较旧的答案，但更简单，没有 lambda ...

要过滤这两个条件，请使用`OR`：

```
Item.objects.filter(Q(field_a=123) | Q(field_b__in=(3, 4, 5, )) 
```

要以编程方式获得相同的结果：

```
filter_kwargs = {
    'field_a': 123,
    'field_b__in': (3, 4, 5, ),
}
list_of_Q = [Q(**{key: val}) for key, val in filter_kwargs.items()]
Item.objects.filter(reduce(operator.or_, list_of_Q)) 
```

`operator`在标准库中：`import operator`
来自文档字符串：

> or_(a, b) -- 同 a | 湾。

对于 Python3，`reduce`不再是内置的，但仍在标准库中：`from functools import reduce`

* * *

附言

不要忘记确保`list_of_Q`它不是空的 -`reduce()`会在空列表中窒息，它至少需要一个元素。

* * *

## 回答 #6

> 赞同：7
> 
> 时间：2021-12-04T16:42:15.767

有多种方法可以做到这一点。

**1.直接使用管道| 操作员。**

```
from django.db.models import Q

Items.objects.filter(Q(field1=value) | Q(field2=value)) 
```

**2.使用`__or__`方法。**

```
Items.objects.filter(Q(field1=value).__or__(field2=value)) 
```

**3\. 通过更改默认操作。（注意重置默认行为）**

```
Q.default = Q.OR # Not recommended (Q.AND is default behaviour)
Items.objects.filter(Q(field1=value, field2=value))
Q.default = Q.AND # Reset after use. 
```

**4.通过使用`Q`类参数`_connector`。**

```
logic = Q(field1=value, field2=value, field3=value, _connector=Q.OR)
Item.objects.filter(logic) 
```

**Q 实现的快照**

```
class Q(tree.Node):
    """
    Encapsulate filters as objects that can then be combined logically (using
    `&` and `|`).
    """
    # Connection types
    AND = 'AND'
    OR = 'OR'
    default = AND
    conditional = True

    def __init__(self, *args, _connector=None, _negated=False, **kwargs):
        super().__init__(children=[*args, *sorted(kwargs.items())], connector=_connector, negated=_negated)

    def _combine(self, other, conn):
        if not(isinstance(other, Q) or getattr(other, 'conditional', False) is True):
            raise TypeError(other)

        if not self:
            return other.copy() if hasattr(other, 'copy') else copy.copy(other)
        elif isinstance(other, Q) and not other:
            _, args, kwargs = self.deconstruct()
            return type(self)(*args, **kwargs)

        obj = type(self)()
        obj.connector = conn
        obj.add(self, conn)
        obj.add(other, conn)
        return obj

    def __or__(self, other):
        return self._combine(other, self.OR)

    def __and__(self, other):
        return self._combine(other, self.AND)
    ............. 
```

参考。[Q 实现](https://github.com/django/django/blob/d3a64bea51676fcf8a0ae593cf7b103939e12c87/django/db/models/query_utils.py#L29)

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-01-26T12:42:48.997

这可能很有用[https://docs.djangoproject.com/en/dev/topics/db/queries/#spanning-multi-valued-relationships](https://docs.djangoproject.com/en/dev/topics/db/queries/#spanning-multi-valued-relationships)

基本上听起来他们充当或

* * *

## 回答 #8

> 赞同：-2
> 
> 时间：2021-03-14T06:25:20.687

```
Item.objects.filter(field_name__startswith='yourkeyword') 
```

# deployment - 在 Windows Installer 项目中删除横幅中的文本

> ID：739777
> 
> 赞同：5
> 
> 时间：2009-04-11T09:02:39.913
> 
> 标签：deployment, installation, windows-installer

我正在使用标准的 Visual Studio 部署项目，并希望删除横幅中的文本（显示“欢迎使用您的项目设置向导”的文本。

我想删除它，因为我想要一个自定义横幅并且不希望将文本写在横幅上。

我在 VS 中看不到任何允许这样做的属性。是否可以在 .MSI 中不进行任何刺激的情况下完成？

干杯，

史蒂夫

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-11T09:53:18.060

您可以通过删除欢迎对话框并将其替换为自定义对话框来“删除”文本。在 VS 2005 中 -

*   右键单击解决方案资源管理器中的安装项目
*   选择视图 - 用户界面
*   在安装和管理安装的开始组下删除“欢迎”

然后你可以在项目中添加一个“文本框（A）”对话框（右键单击“开始”组并选择添加对话框），将文本框的可见属性设置为false。将文本框 (A) 移动到“开始”序列的顶部。

此对话框的属性包括：

*   横幅位图
*   横幅文字
*   主体

这应该允许您（在一定程度上）控制这个新“欢迎”页面的外观/感觉。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2010-03-17T19:54:17.517

我想补充一点，有时创建自定义对话框很麻烦，您可以按照[http://social.msdn.microsoft.com/Forums/en-US/winformssetup/thread上的建议进行操作/5af7ff28-3dbb-4a8a-8d62-a09af9e32b29](http://social.msdn.microsoft.com/Forums/en-US/winformssetup/thread/5af7ff28-3dbb-4a8a-8d62-a09af9e32b29)使用名为 InstEdit 的工具（[http://www.instedit.com](http://www.instedit.com) - 有免费版本）编辑输出的安装程序并删除 BannerText

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T09:39:29.997

我不相信有一个*简单*的方法（例如更改属性）。我最近遇到了同样的问题。我什么也找不到。最终使用[Orca](http://support.microsoft.com/kb/255905)来“在 .msi 中四处寻找”。您似乎唯一可以轻松更改的是它显示的语言。

# eclipse - 无法安装 Eclipse 插件

> ID：739778
> 
> 赞同：3
> 
> 时间：2009-04-11T09:04:06.710
> 
> 标签：eclipse, plugins, installation

我正在尝试为 Mylyn/Fogbugz 安装 Eclipse 插件，当我尝试 EclipseBugz 或 Foglyn 时出现以下错误：

```
Cannot find a solution satisfying the following requirements Match[requiredCapability: org.eclipse.equinox.p2.iu/org.eclipse.swt 
```

我正在使用 Eclipse 3.4.1

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-11T10:09:13.607

您在 Eclipse 安装中启用了哪些其他更新站点？

从旧的 Mylyn 升级时我遇到了类似的问题，并发现它有助于禁用其他更新站点。在安装新插件，甚至更新旧插件时，Eclipse 倾向于联系所有启用的更新站点。我不知道它到底想做什么，但它帮助我禁用了除我想使用的站点之外的所有站点。

顺便说一句，Eclipse 3.5M6 可以选择仅使用选定的更新站点——它在更新/安装插件时很有帮助。我迫不及待地想看到 Eclipse 3.5 最终发布，就为了这个特性。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T09:36:01.580

Eclipse 插件需要 Equinox UI 进行依赖。请阅读[Equinox 安装程序](http://wiki.eclipse.org/Equinox_p2_Installer) 。希望对您有所帮助。:)

# extjs - 外部区域属性

> ID：739790
> 
> 赞同：3
> 
> 时间：2009-04-11T09:21:24.517
> 
> 标签：extjs

我现在正在学习extjs。

```
new Ext.Viewport({
layout: 'border',
items: [{
    region: 'north',
    html: '<h1 class="x-panel-header">Page Title</h1>',
    autoHeight: true,
    border: false,
    margins: '0 0 5 0'
},... 
```

我在 API 中找不到“区域”属性。

我检查了视口、组件和其他类。我找不到。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-05-05T13:41:35.830

您是对的，“区域”属性不是视口本身的直接属性，而是您分配给视口的区域的属性。

每个视口必须至少包含两个区域。这些区域被定义为 Ext.layout.BorderLayout.Region 类 ( [http://extjs.com/deploy/dev/docs/?class=Ext.layout.BorderLayout.Region](http://extjs.com/deploy/dev/docs/?class=Ext.layout.BorderLayout.Region) ) 的一部分。基本上，您可以将“北”、“东”、“南”和“西”区域与“中心”区域结合使用。你可以拥有所有或那些，或只有一个，只要你也有你的“中心”区域。“中心”区域将自动调整大小以占用您未定义为其他区域一部分的任何剩余空间。

# hibernate - Spring：没有配置事务管理器

> ID：739791
> 
> 赞同：2
> 
> 时间：2009-04-11T09:21:59.697
> 
> 标签：hibernate, spring, transactions

我一直在努力解决这个问题，但没有找到解决方案。希望任何人都可以帮助我。

我配置了一个 HibernateTransactionManager。但是，我在日志文件中看到以下消息：

调试 [http-8080-1] AnnotationTransactionAttributeSource.getTransactionAttribute(107) | 添加具有属性 [PROPAGATION_REQUIRED, ISOLATION_DEFAULT, -nl.forestfields.picnic.domain.model.exception.IllegalCostException] 的事务方法 [cashIn]

调试 [http-8080-1] AnnotationTransactionAspect.createTransactionIfNecessary(267) | 跳过事务连接点 [nl.forestfields.picnic.view.controller.ShoppingListController.cashIn] 因为没有配置事务管理器

此外，如果发生异常，事务不会回滚。

这是我的配置：

野餐-servlet.xml：

```
 <beans>

    <context:component-scan base-package="picnic" />
    <context:annotation-config />

    <tx:annotation-driven />
    .
    .
    . 
```

野餐-上下文-db.xml：

```
<bean class="org.springframework.orm.hibernate3.LocalSessionFactoryBean" id="sessionFactory">

    <property name="configLocation" value="classpath:hibernate.cfg.xml" />
    <property name="hibernateProperties">
        <props>
            <prop key="hibernate.dialect">${hibernate.dialect}</prop>
            <prop key="hibernate.show_sql">${hibernate.show_sql}</prop>
        </props>
    </property>
    <property name="dataSource" ref="dataSource" />
</bean>

<bean id="hibernateTemplate" class="org.springframework.orm.hibernate3.HibernateTemplate">
    <property name="sessionFactory" ref="sessionFactory" />
 </bean>

<bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
    <property name="driverClassName">
        <value>${hibernate.connection.driver_class}</value>
    </property>
    <property name="url">
        <value>${hibernate.connection.url}</value>
    </property>
    <property name="username">
        <value>${hibernate.connection.username}</value>
    </property>
    <property name="password">
        <value>${hibernate.connection.password}</value>
    </property>
</bean>

<bean id="transactionManager" class="org.springframework.orm.hibernate3.HibernateTransactionManager">
    <property name="sessionFactory" ref="sessionFactory" />
</bean> 
```

应在事务中执行的代码：

```
@Transactional(rollbackFor=IllegalCostException.class)
public ModelAndView cashIn(@RequestParam final Long id) throws IllegalCostException, llegalOrderStateException, IllegalShoppingListStateException {

  final ShoppingList shoppingList = shoppingListRepository.getById(id);
  shoppingList.cashIn();
  shoppingListRepository.add(shoppingList);

  return new ModelAndView(...);
} 
```

任何人都可以看到问题吗？

干杯，吉普

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-11T12:33:23.073

尝试改变

```
<tx:annotation-driven />
       to
<tx:annotation-driven transaction-manager="transactionManager" /> 
```

在这里找不到任何其他问题。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-14T12:49:45.350

此外，回滚只发生在**Unchecked Exceptions**。如果要回滚检查的异常，则必须在 @Transactional 注释中声明它：

```
@Transactional(rollbackFor = { IllegalCostException.class, llegalOrderStateException.class })
public ModelAndView cashIn(@RequestParam final Long id) throws IllegalCostException, llegalOrderStateException, IllegalShoppingListStateException {

  final ShoppingList shoppingList = shoppingListRepository.getById(id);
  shoppingList.cashIn();
  shoppingListRepository.add(shoppingList);

  return new ModelAndView(...);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2012-01-25T00:59:32.957

要解决问题，您必须声明：

```
<tx:annotation-driven /> 
```

进入**picnic-context-db.xml**而不是**picnic-servlet.xml**

lrdblck

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T14:56:48.260

你说你有两个不同的bean定义文件。这些是代表两种不同的应用程序上下文，还是一个导入另一个？

spring 文档对此并不清楚，但如果它与自身处于相同的上下文中，它可能只会自动定位“transactionManager”bean。如果 transactionManager 在父上下文中，它可能找不到它。

正如 jerrish 所说，只需明确指定元素的 transaction-manager 属性即可。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-10-17T07:53:04.417

> 尝试改变
> 
> `<tx:annotation-driven />
> 
> ```
>  to 
> ```
> 
> <tx:annotation-driven transaction-manager="transactionManager" />
> 
> 在这里找不到任何其他问题。

这不可能是解决方案，因为弹簧文档说：

> 如果要连接的 PlatformTransactionManager 的 bean 名称具有名称 transactionManager，则可以省略标记中的 transaction-manager 属性。 [使用@Transactional](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/transaction.html#transaction-declarative-annotations)

应该是别的东西变了...

# php - 在while循环中将值与前一行进行比较？

> ID：739807
> 
> 赞同：7
> 
> 时间：2009-04-11T09:52:12.930
> 
> 标签：php

我是 PHP 的新手，所以请原谅我提出一个基本问题。

在`While`语句中，有没有办法知道一行中的值是否等于前一行中的值？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-11T09:55:30.660

只需存储它：

```
$get = mysql_query("...");
$previous = '';
while ($row = mysql_fetch_assoc($get)) {
  $current = $row['...'];
  if ($current == $previous) {
    // do stuff
  }
  $previous = $current;
} 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-12-08T21:45:21.347

```
$get = mysql_query("...");
$previous = '';
while ($row = mysql_fetch_assoc($get)) {
  $current = $row['...'];
  if ($current == $previous) {
  // do stuff
}
$previous = $current;
} 
```

此示例将无法正常工作。它总是会跳过数组中的第一条记录。第一次通过 $previous 将是空白的，因此 $current 和 $previous 将不相等。$current 必须像以前一样空白第一遍。$current 必须在 if 循环内相等。

```
$get = mysql_query("...");
$previous = '';
$current = '';
while ($row = mysql_fetch_assoc($get)) {

  if ($current == $previous) {
     $current = $row['...'];
    // do stuff
   }
 $previous = $current;
} 
```

# silverlight - 将鼠标悬停在 Silverlight 中的 UI 元素上时将指针设置为手

> ID：739811
> 
> 赞同：3
> 
> 时间：2009-04-11T09:55:49.893
> 
> 标签：silverlight

我有一个图像，它附加到 MouseEnter 上的一些 JavaScript。

这一切都很好。当用户“鼠标悬停”时，将调用 JS 并且情节提要按预期运行。

当用户悬停在鼠标上方时，我还想将鼠标光标更改为“手形指针”，我猜这可能发生在同一个 JS 函数中。

还有，怎么改回来？

非常感谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T10:17:03.073

再次回答我自己的问题：

原来有一个我错过的手属性。

```
<Image Canvas.Left="719.732" x:Name="img17_18" Width="180" Height="208.09" Source="Padmamand1.jpg" Stretch="Fill" Canvas.Top="36.91" Opacity="0.595" Cursor="Hand"/> 
```

甜的。

# android - Eclipse：如何在批处理文件中自动导出未签名的应用程序

> ID：739818
> 
> 赞同：7
> 
> 时间：2009-04-11T10:14:26.480
> 
> 标签：android, eclipse, batch-file

我正在 Windows Vista 环境中为 Android 开发游戏。我想在批处理文件中自动导出未签名的应用程序操作。因此，只要我想运行我的项目，我就不必右键单击项目，转到 Android 工具，然后选择导出未签名的应用程序包...。谢谢你。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2010-10-20T06:24:23.713

这是一个很好的链接：[http](http://www.androidengineer.com/2010/06/using-ant-to-automate-building-android.html) ://www.androidengineer.com/2010/06/using-ant-to-automate-building-android.html ，由 Matt Quigley 编写。

简而言之：

您可以通过转到根路径并输入来创建一个 build.xml 文件`android update project --path .`。

这将创建一个 build.xml 文件。从那时起，您应该能够通过运行来构建未签名的 apk `ant release`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T11:38:09.307

Android 的 Eclipse SDK 只是在后台使用[Ant来导出应用程序包。](http://ant.apache.org/)您可以只编写一个 ANT 构建文件并执行您要尝试的导出，然后您将自己完成批处理文件的任务。

# iphone - 是否可以访问 App Store 数据进行市场分析？

> ID：739820
> 
> 赞同：5
> 
> 时间：2009-04-11T10:15:20.503
> 
> 标签：iphone, app-store

我想知道 App Store 是否提供 API 允许其他人访问描述、价格、评论等数据？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T10:29:35.150

iTunes Store*是*API。

iTunes Store 中的所有页面都只是由 iTunes 呈现的 XML 文件。您可以自己解析这些文件并导航到您想要的内容。

这是首页的网址：

```
http://ax.phobos.apple.com.edgesuite.net/WebObjects/MZStore.woa/wa/com.apple.jingle.app.store.DirectAction/storeFront 
```

您可能还想看看：

*   [http://www.aaronsw.com/2002/itms/](http://www.aaronsw.com/2002/itms/)
*   [http://www.s-seven.net/itunes_xml](http://www.s-seven.net/itunes_xml)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2016-09-26T16:19:48.030

Apple 为 App Store 提供了一个官方 API，名为[iTunes Search API](https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/)。在文档中还有一些[关于](https://affiliate.itunes.apple.com/resources/documentation/itunes-store-web-service-search-api/#lookup)如何使用“查找”和“搜索”端点的示例，非常易于使用并且数据以 JSON 格式返回:)

不幸的是，这与不通过 API 公开应用程序元数据的 Google Play（以前称为 Android Market）不同。

要为 Android 获取该数据，您可以开发自己的 HTML 爬虫，解析页面并提取您需要的应​​用元数据。此主题已在其他问题中涵盖，例如[此处](https://stackoverflow.com/questions/17002181/crawling-the-google-play-store?rq=1)。

如果您不想自己实现所有这些，您可以使用第三方服务通过基于 JSON 的 API 访问 Android 应用程序元数据。

例如，[42matters.com](https://42matters.com?utm_source=stackoverflow.com&utm_medium=Referral&utm_campaign=739820)（我工作的公司）为 Android 和 iOS 提供了统一的 API，这里有更多详细信息：

[https://42matters.com/app-market-data](https://42matters.com/app-market-data?utm_source=stackoverflow.com&utm_medium=Referral&utm_campaign=739820)

端点范围从“查找”（获取一个应用程序的元数据，可能是您需要的）到“搜索”，但我们还公开了来自领先应用商店的“排名历史”和其他统计数据。我们为所有支持的功能提供了大量文档，您可以在左侧面板中找到它们：[https ://42matters.com/docs/overview](https://42matters.com/docs/overview?utm_source=stackoverflow.com&utm_medium=Referral&utm_campaign=739820)

我希望这会有所帮助，否则请随时与我联系。我非常了解这个行业，可以为您指明正确的方向。

问候，

安德烈亚

# jsp - 属性问题

> ID：739822
> 
> 赞同：1
> 
> 时间：2009-04-11T10:18:03.493
> 
> 标签：jsp, onclick, tags

我的问题是标签**a中的属性****onclick 。我想在属性****onclick**中执行 scriplet 命令。当我写这个时......

 ****```
<a href="somethig" onclick="session.setAttribute('newAttribute','value')" >Click on me</a> 
```

...所以什么都没有发生（**会话的属性未设置**），如果我写这个

```
<a href="somethig" onclick="<% session.setAttribute('newAttribute','value'); %>" >Click on me</a> 
```

所以，会话的属性现在设置（**不是当我点击它时**）。

（对不起我的英语，我是初学者:)

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-11T11:04:45.267

您混淆了客户端代码和服务器端代码的角色。

锚标记的“onclick”事件将仅在客户端上执行。

您的代码将发送给客户端：

```
<a href="somethig" onclick="" >Click on me</a> 
```

但会在服务器上执行以下操作：

```
session.setAttribute('newAttribute','value'); 
```

<% %> 标签表示代码在服务器上运行，而不是在客户端上。

因此，为了使其工作，您需要执行某种 javascript 来“回调”到服务器，以表明链接已被点击。这通常是通过对服务器上另一个页面的 AJAX 调用来完成的。

# .net - 如何使用 ASP.Net（或 C#）在 IIS 服务器上创建子域？

> ID：739824
> 
> 赞同：1
> 
> 时间：2009-04-11T10:21:25.653
> 
> 标签：.net, asp.net, iis, hosting, subdomain

我想创建一个网站，注册的用户可以在我的主域上获得一个子域，例如 blogspot.com（例如 user.mywebsite.com）

我真的不知道该怎么做。我想这将涉及DNS。这是有关我的要求的更多信息。

1.  也不需要设置 IIS 网站。
2.  我想要一个将子域路由到目录内的文件夹的应用程序。

这可以使用 ISAPI DLL 完成吗？一些DNS魔法？什么？

所有的线索都将受到欢迎和帮助。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T10:55:34.947

您可能想查看通配符 DNS，然后检查该网站是否真的存在于您的应用程序中。在 IIS 中设置每一个都会有点混乱。

[http://en.wikipedia.org/wiki/Wildcard_DNS_record](http://en.wikipedia.org/wiki/Wildcard_DNS_record)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-12T18:49:38.060

也许[这可以帮助](http://msmvps.com/blogs/bernard/archive/2005/03/22/39218.aspx)？这是关于为子域设置通配符。然后，您可以检查 Uri.Host 属性以确定请求的子域。

# ironpython - IronPython 用于 IronPython Studios 的单元测试

> ID：739825
> 
> 赞同：3
> 
> 时间：2009-04-11T10:22:15.697
> 
> 标签：ironpython, ironpython-studio

我想玩 IronPython，并认为编写单元测试是一种足够简单的入门方式。这实质上意味着我的核心应用程序代码仍将使用 C# 编写，而我的测试是 python。

考虑到这一点，我的理想情况是在 Visual Studio 的同一解决方案中开发 C# 和 IronPython 代码。环顾四周，我发现有一个适合我的视觉工作室编辑器“IronPythonStudios”，尽管到目前为止我遇到了一些问题：

1.  导入核心 python 库（例如“Import os”）失败。我相信这是因为这些通用库的路径没有在 IDE 中设置，我不知道如何设置它。
2.  我无法识别来自视觉工作室的 .pyproj 文件，我*相信*我的 IronPythonStudios 版本在隔离模式下运行并且未集成。知道我如何改变这个吗？
3.  IronPythonStudos 似乎正在编译 .py 文件，而不仅仅是解释它们。这本质上意味着单元测试与使用 C#/Vb.net 一样慢，因为测试、构建然后执行周期仍然存在。知道如何阻止 VS/IPS 编译文件并让它动态编译脚本吗？

干杯，克里斯。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-11-06T16:28:33.107

您可以使用 ipy 2.6 并在 eclipse 中使用 pydev 插件和代码。很抱歉，我要求您切换您的 IDE（我知道这有时会很痛苦），但我已经使用了很多 IDE，包括 Visual Studio 和 Eclipse 我在[这里](https://stackoverflow.com/questions/755883/ide-for-ironpython-on-windows/1652889#1652889)讨论过这个问题，我发现 eclipse 是迄今为止我用过的最好的 IDE。此外，在 Eclipse 中有一个用于 C# 编程的插件，所以我强烈建议您切换。

将 pydev 插件用于 eclipse 的有趣之处在于您不会遇到您所描述的导入问题。此外，编译/解释问题也得到了解决。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T14:13:21.647

如果有人想知道，为了回答我的问题的第一部分，我发现我需要添加对 Python 系统路径的引用，即

```
import sys
sys.path.append(r'c:\PathToPythonCommonLibs') 
```

编辑：

还值得注意的是，我下载了独立且未集成的 IronPython 工作室发行版，这是我的第一个问题。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-12T09:13:27.883

我也一直在尝试整合 IronPython 和 Visual Studio。您可以通过下载 Visual Studio SDK 并按照[此处](http://blogs.msdn.com/aaronmar/archive/2006/02/16/a-bit-more-on-ironpython.aspx)列出的步骤进行操作。唯一的问题是集成是针对 IPy v 1.x 而不是 2.* 构建的。不知道这对你有多大帮助。

# c++ - 服务器端库 (c/c++) xmlrpc

> ID：739830
> 
> 赞同：3
> 
> 时间：2009-04-11T10:29:07.147
> 
> 标签：c++, c, xml-rpc

我想为我的服务器实现对 XMLRPC 协议的支持，它是用 C 和 C++ 编写的，现在正在寻找最广泛采用的 xmlrpc 库。许可证不是问题，GPL 就可以了。你有什么建议？是否有任何事实上的标准 xmlrpc C 库用于此目的？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-11T10:44:59.060

imo 的事实上的标准是这样的：http: [//xmlrpc-c.sourceforge.net/](http://xmlrpc-c.sourceforge.net/)，它同时支持 C 和 C++，它甚至有自己的嵌入式 http 守护进程来服务 http 请求......

编辑：它在 BSD 风格的许可下可用，所以它允许你大胆地去 GPL 之前不允许你去的地方；）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-17T17:14:43.390

这里有两个选项：

*   [用于 C 和 C++ 的 XML-RPC](http://xmlrpc-c.sourceforge.net/)

我从来没有用过这个。

*   [肥皂](http://gsoap2.sourceforge.net/)

我用过这个。它具有工业实力，并做到了它在锡上所说的那样。

# php - 用于海量邮件的电子邮件队列系统

> ID：739831
> 
> 赞同：2
> 
> 时间：2009-04-11T10:29:09.190
> 
> 标签：php, email

我正在为我的 php 应用程序开发电子邮件队列模块。所以所有的邮件（用户通知、密码提醒...）都会被放入队列中，并根据邮件的优先级由 cron 进程发送。但我很快就会有新闻信模块。所以我的问题是要么将时事通讯保持在单独的队列中，要么可以使用集中队列，因为我对所有电子邮件都有优先级属性？

谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-11T14:09:21.220

温馨提示：您有构建电子邮件发件人的经验吗？这是一场艰巨的冒险，外包任务几乎总是更好。电子邮件的送达性并不容易或可预测。

您可以坚持使用一个队列，但请确保能够指定可以从哪个 IP 地址发送特定电子邮件。您将需要不同的 IP 地址来发送新闻通讯、注册、发票等。更进一步，您需要有一个 IP 用于将新闻通讯发送到受信任的地址和不受信任的地址。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-11T10:37:19.763

如果您可以使用相同的模块来完成它们，我会认为这更可取，因为需要担心的代码更少。

我能看到的唯一*潜在*问题是两种电子邮件类型的不同性质。用户通知和密码提醒往往只有一个收件人。时事通讯将立即通过电子邮件发送给您的所有用户。

如果这不会导致问题（并且您看不到任何其他问题），我会坚持使用一个邮寄者来统治所有人的方法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-08-02T11:49:21.397

正如[Gary Richardson](https://stackoverflow.com/questions/739831/email-queue-system-for-massive-mailing/740152#740152)所提到的，电子邮件的传递性可能很棘手。

这不是广告。但我强烈推荐 PostMarkApp.com。除了作为付费客户之外，我与该公司没有任何其他关系（好吧，我的公司付费）。

他们有一个邮件传递系统和一个 API，您可以从您的 PHP 脚本中使用它们。您只需将邮件提交到他们的队列，他们就会发送和处理垃圾邮件报告、退回等。他们的 API 允许您知道哪些邮件被退回并处理它们。

此服务相当于用于发送原始电子邮件的 CampaignMonitor。顺便说一句，您不能通过 PostMarkApp 发送时事通讯，它们只允许一对一的电子邮件（例如您的用户通知和密码提醒）。

几年前，我开始构建自己的电子邮件传递脚本，直到托管公司提到每天最多有 500 封电子邮件。然后我使用了一个“时事通讯”传递系统，并使用了一些变通的方法来使其达到我想要的效果。这是一团糟。

直到最近，我们还在使用另一个定制的邮件投递脚本，但正如 Gary Richardson 所说，您需要考虑 IP、退回邮件等。我发现邮戳的事情如此令人兴奋（以一种极客的方式），令人尴尬： D

话虽如此，一旦您将邮件的实际交付外包，您可以使用您的优先级为您的系统设置一个邮件队列。这样，您的应用程序会将邮件添加到您自己的邮件队列中，而您的邮件系统会将其传递到外包平台。这比在用户按下提交或类似操作后在页面刷新期间尝试立即发送电子邮件更可取。

PS：如果有人知道类似邮戳的服务，请告诉我！

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-18T18:04:52.110

看看 SendGrid。在最近意识到处理电子邮件不值得花费开发时间之后，似乎对我们很有用。

# php - Smarty 不渲染图像和 CSS

> ID：739833
> 
> 赞同：0
> 
> 时间：2009-04-11T10:30:42.993
> 
> 标签：php, html, css, smarty

所以我给自己做了一个小小的 html/css 模板。现在我正在尝试将它与一些 PHP 代码一起使用，但是它只呈现文本。图像和 css 不存在。一切都在模板/默认目录中。我必须对模板中的路径做一些时髦的事情吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T13:06:35.693

使用[萤火虫](http://getfirebug.com/)，看看为什么图像不显示。您需要激活“NET”选项卡，然后您会看到浏览器请求页面时发出的所有请求。我的猜测是 CSS 和图像的路径不正确。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T12:19:55.617

哇，这是一个奇怪的问题... :)

只需在查找样式表/图像时检查浏览器请求的 URL。我认为您将不得不调整您在 smarty 模板中使用的路径。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-12T07:51:24.163

可能是的，抱歉，链接图像和 css 总是很痛苦 - 看起来很简单，但并非总是如此！！！

是否为图像应该在的位置创建空间？如果是这样，请右键单击并查看图像调用的路径并确保将其上传到那里。

否则，使用诸如 firebug（firefox 插件）之类的工具来找出调用 css 和图像的位置，或者只需右键单击并“查看页面源代码”，然后确保从正确的位置调用所有内容！如果需要，请放置图像的直接网址，即。www.mysite.com/templates/templatename/images/myimage.gif - 只是为了确保它们在您认为的位置！

祝你好运

* * *

## 回答 #4

> 赞同：-4
> 
> 时间：2009-04-11T10:35:35.150

你应该把你的图片放在 html/img

然后所有图像路径都应该以 /img/ 开头

# database-design - 批评我的数据库设计

> ID：739838
> 
> 赞同：2
> 
> 时间：2009-04-11T10:34:17.667
> 
> 标签：database-design

我没有太多设计数据库的经验。虽然我有一些粗略的理论知识。

所以，关于我的问题。我们有一堆 excel 文件的数据（是的，惊喜！），我们想将它们移动到数据库中。

为简化起见，假设该系统是一个集中式报警系统。数据从远程位置收集并显示在集中监控室中。每个位置都有一个唯一的名称和多个设备。在一个位置内，设备名称是唯一的，并且设备有多个警报。在一个设备中，一个警报名称是唯一的。

在每个位置，我们都有一个或多个终端单元 (TU)，用于聚合该位置的警报并发送它。每个 TU 里面都有一堆卡片，每个卡片都有每个 TU 的唯一 ID。每张卡都有一个用于每个警报的接线终端触点，每张卡都有一个唯一的地址。

这些实体中的任何一个都可以重命名/重新寻址。

如您所见，数据是高度分层的。而且我需要存储每个接线接触警报分配（关系）的历史记录。警报可以将其分配从一个联系人更改为另一个联系人。

```
Location             TU
|                    |
+- Device            +- Card 
    |                    |
    +-- Alarm            +--Contact 
        |                     |
        +----Alarm-Contact----+ 
```

*我的设计：* 我为上面显示的每个实体创建了一个表。我对所有这些都使用了人工主键作为自动增量整数。层次结构 (Tn) 中向下的表将对组合 (Tn.name, Tn-1.pk, Tn-2.pk,...) 具有唯一性约束，其中 Tn 是表 (n) 中的第 (n) 个深度层次结构和 (pk) 是表的主键。

我将使用 SQL Server，我对自动增量整数 PK 有疑问。假设我有 10 条记录，我删除了除最后一条 (10th) 之外的所有记录。下一条添加的记录是编号为11，还是DBMS将它们重新编号为10->1和new->2。如果前者正确，如何解决PK溢出的问题。

另一个问题是我应该如何为此建模历史数据。我在想我应该创建与 Alarm-Contact 表具有 n-1 关系的 Alarm-Contact-History 表。

谢谢

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T10:46:30.227

如果您只是创建一个警报-联系-历史表，您将不会创建准确的历史记录。假设每张卡都可以移动到另一个 TU，那么您描述的历史将不知道当警报器使用卡的联系人时卡安装在哪个 TU 中。

也许包含卡 ID、TU Id、位置 ID 和设备 ID 的增强警报联系历史记录会更好。这样，您就可以了解生成历史记录时的确切配置。如果有什么东西在中间的时间范围内移动，你不会介意，因为你知道当时的情况。

SQL Server 将继续递增分配给标识符的值。你预计有多少记录？如果金额很大（约 21.4 亿），我建议使用 bigint 作为标识符。

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2009-04-11T12:50:27.230

我建议一个不同的计划。

作为热身，将您的数据从 Excel 转换为 MS Access。转换非常容易，因为 Excel 和 Access 可以互操作。

不要使用自动递增的数字。相反，安排一个您在 VBA 中编写的函数或在插入新数字时运行的任何函数。创建您自己的算法来控制新号码的分配，而不是受制于 DBMS。

使用 MS Access 中的交互式查询构建器等来帮助您练习或节省您的精力。但是使用 SQL 视图来弄清楚所有查询是如何工作的，即使你没有构建它们。

然后构建一个 SQL Server 版本。抽象出 MS Access 的 SQL 方言特有的特性，但使用您所学的大部分内容来构建原型。您的自动增量代码将在触发器中。

哦，顺便说一句，不要忘记你学过的理论。它可能会派上用场。

# windows - 如何以编程方式操作“开始”菜单的“最近使用的程序”列表？

> ID：739839
> 
> 赞同：4
> 
> 时间：2009-04-11T10:35:17.227
> 
> 标签：windows, rot13

我正在寻找一种使程序出现（经常）使用的方法，以便它们出现在“开始”菜单的“最近使用的程序”中（在零触摸安装之后）。

我试图弄清楚 Windows 如何存储与程序使用频率相关的信息。

当我从“开始”菜单运行程序时，我可以看到的唯一（可能）相关的事情是一些（似乎没有记录的）BagMRU 注册表项，这些注册表项对我没有任何意义。

我确实找到[了一种](http://www.microsoft.com/technet/scriptcenter/resources/qanda/nov04/hey1111.mspx)固定程序的方法，但这不是我在这里寻找的。

**更新：请参阅评论以解释我为什么要这样做......**

**更新2**：我正在取得进展......现在我知道它们的密钥存储在哪里，并且我知道这些密钥是**ROT13** “加密”的。值的第二个 4 字节是计数器.. [http://blog.didierstevens.com/2006/07/24/rot13-is-used-in-windows-you're-joking/](http://blog.didierstevens.com/2006/07/24/rot13-is-used-in-windows-you%E2%80%99re-joking/)

这个[**ROT13**（*维基百科*）](http://en.wikipedia.org/wiki/ROT13)加密的东西很有趣。嗯，当然是有原因的。他们不希望您能够通过简单的搜索找到它。

[大声笑，在 Windows 7 中，他们正在使用 Vigenère 加密！](http://blog.didierstevens.com/2009/01/18/quickpost-windows-7-beta-rot13-replaced-with-vigenere-great-joke/)好多了:D

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-11T10:41:52.467

冒着被否决的风险，这不是你应该做的事情。“最近使用的程序”属于计算机的所有者，而不是您的程序。

如果你的程序和你想象的一样有用，它会自动出现在那里。

Raymond Chen 写了很多文章来解释为什么这种事情是个坏主意。

这在所有其他坏主意中占了上风，例如：

*   如何强制我的程序成为某些文件类型的处理程序？
*   我怎样才能让我的程序始终处于领先地位。
*   当他们以前有权自行决定如何配置他们的软件时，我怎么能通过为他们做决定来惹恼我的用户？:-)

* * *

*更新：*

您可能想尝试几件事。

*   将程序 (explorer.exe) 复制到 axolotl.exe 并运行它足够的次数以将其列入列表。然后在注册表中搜索它（假设您的磁盘上没有另一个 axolotl.exe）。请注意，某些字符串存储为 Unicode，因此可能不是简单的搜索。如果 MS 以某种方式对它们进行编码以使其变得更加困难，我也不会感到惊讶。
*   微软的 sysinternals 有一个可以监控注册表的工具（regmon，看[这里](http://technet.microsoft.com/en-us/sysinternals/bb896652.aspx)，你可以在运行一个程序几次的同时运行它，看看它添加到列表中时会更新什么。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-15T15:55:40.213

我在这里找到了我想要的东西：

[http://blog.didierstevens.com/2006/07/24/rot13-is-used-in-windows-you're-joking/](http://blog.didierstevens.com/2006/07/24/rot13-is-used-in-windows-you%E2%80%99re-joking/)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T10:45:00.510

如果这是可能的，我建议不要这样做。正如您所说，这是未记录的行为，并规避了常用程序列表的预期用途。桌面图标和快速启动快捷方式有什么问题？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-12T06:07:30.403

使用 Win32 Shell COM 接口
它已经解释了几十年，就像所有未记录的功能一样，在 Google Groups (Win32) 上，与 W95 上的方法相同。

# implementation - setTimeout 一般是如何在 javascript 解释器或计时器中实现的？

> ID：739847
> 
> 赞同：25
> 
> 时间：2009-04-11T10:41:00.723
> 
> 标签：implementation, interpreted-language

一段时间后调用的函数如何用 javascript 或任何其他解释语言实现？

换句话说，javascript解释器中是否有一个循环一直检查计时器列表，或者操作系统是否有任何特定的处理方式？

谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2021-03-28T12:03:27.387

您维护一个允许您存储（超时、回调）的排序数据结构（例如优先级队列）。这使您可以快速确定下一次超时时间。关键方面是我们如何等待，以及我们如何中断等待以安排新的回调。

1.  `sleep`您可以通过(3) 在线程中等待，完成后调用回调。当您需要安排新的（超时、回调）时，向线程发送`signal`(2) 或(3)。`pthread_cond_signal`

2.  与上面类似，但是您使用`pthread_cond_timedwait`(2) 并且线程在超时发生时唤醒，或者当条件变量触发以安排新的回调时。

3.  您可以安排`alarm`(2) 并继续您正在执行的任何其他任务。当警报响起时，它会向您的进程发送信号，您可以在方便时调用回调。要安排新的超时，您可以设置一个新的警报，该警报将取消旧的。

4.  您使用`select`(2)/ `poll`(2)/ `epoll_*`(2) 超时。当超时发生时，您调用回调。要安排一个新的回调，您需要将一个字节写入管道，该字节专门用于让 select/poll/epoll 返回，以便您安排一个新事件。例如，chrome/node/v8 使用这种方法，只是包装在一个兼容层中（请参阅[如何在 node.js 中实现 setTimeout](https://stackoverflow.com/questions/13616102/how-is-settimeout-implemented-in-node-js)）。

5.  像上面一样，但不使用 timeout 参数，您可以使用`timerfd_create`(2) ，它是一个文件描述符，用于传递时间到期。

# c# - 如何纠正这个错误

> ID：739849
> 
> 赞同：0
> 
> 时间：2009-04-11T10:42:05.947
> 
> 标签：c#, remoting, vpn

如何纠正这个错误？

异常：System.Net.Sockets.SocketException 消息：请求的名称有效，但未找到请求类型的数据来源：mscorlib

服务器堆栈跟踪：System.Net.Dns.GetHostByName(String hostName) at System.Net.Dns.Resolve(String hostName)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T10:55:11.453

这完全取决于导致它的代码。如果它是对 System.Net.Dns.Resolve 的显式调用，则可能是 DNS 服务器的故障。将有问题的代码包装在 try-catch 块中以捕获 SocketException 并优雅地处理此类事件。否则，没有看到任何代码，是不可能知道的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-07-26T17:09:16.123

尝试连接到 SFTP 站点时，我遇到了同样的错误。

我从 URL (sftp://127.0.0.1/) 中删除了尾随的“/”并成功连接。

这可能不是您遇到的问题，但我希望它能激发您“尝试简单的更改”。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-08-06T15:14:44.323

使用 IPHostEntry 主机 = Dns.GetHostEntry(string HostName);

# javascript - 如何使外部代码“安全”运行？只是禁止eval（）？

> ID：739850
> 
> 赞同：7
> 
> 时间：2009-04-11T10:42:30.920
> 
> 标签：javascript, security, xss

我希望能够允许社区成员提供他们自己的 javascript 代码供其他人使用，因为用户的想象力比我能想到的任何东西都大得多。

但这引发了内在的安全问题，特别是当目的是*允许*外部代码运行时。

那么，我可以禁止`eval()`提交并完成它吗？还是有其他方法可以评估代码或在 javascript 中引起大规模恐慌？

还有其他事情是不允许的，但我主要担心的是，除非我可以阻止字符串被执行，否则我为特定方法设置的任何其他过滤器都可以被规避。可行，还是我必须求助于要求作者提供 Web 服务接口？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2014-02-11T15:45:11.260

由于[HTML5](http://en.wikipedia.org/wiki/HTML5)现在已经可用，您可以使用[沙箱](http://www.html5rocks.com/en/tutorials/security/sandboxed-iframes/)来处理不受信任的 JavaScript 代码。

[OWASP HTML5 安全备忘单](https://www.owasp.org/index.php/HTML5_Security_Cheat_Sheet)对[沙盒框架](https://www.owasp.org/index.php/HTML5_Security_Cheat_Sheet#Sandboxed_frames)的评论：

> *   将 iframe 的沙盒属性用于不受信任的内容。
> *   iframe 的沙盒属性启用对`iframe`. 设置沙盒属性时，以下限制处于活动状态：
>     
>     
>     1.  所有标记都被视为来自唯一来源。
>         
>         
>     2.  所有表单和脚本都被禁用。
>         
>         
>     3.  所有链接都被阻止以其他浏览上下文为目标。
>     4.  所有自动触发的功能都被阻止。
>     5.  所有插件都被禁用。
>         
>         
>         
>         可以使用属性`iframe`的值对功能进行细粒度控制。`sandbox`
>         
>         
> *   在不支持此功能的旧版本用户代理中，此属性将被忽略。将此功能用作额外的保护层或检查浏览器是否支持沙盒框架，并且仅在支持时显示不受信任的内容。
>     
>     
> *   除了这个属性，为了防止点击劫持攻击和不请自来的框架，鼓励使用`X-Frame-Options`支持`deny`和`same-origin`值的标头。`if(window!== window.top) { window.top.location = location; }`不建议使用其他解决方案，例如 framebusting 。

您可以允许脚本运行，同时保留其他限制。但是，您应该确保脚本从与您的主要内容不同的域运行，以防止攻击者重定向用户直接加载页面（即不通过您的 IFrame）进行的[XSS攻击。](https://www.owasp.org/index.php/Cross-site_Scripting_(XSS))

这将限制脚本`eval`用于攻击​​您的主域，但这也可能会阻止脚本实际上足够强大以满足您的需求。与您的主域的任何交互都必须通过[`Window.postMessage`](https://developer.mozilla.org/en-US/docs/Web/API/Window.postMessage). 如果这限制性太强，那么[@bobince 的回答](https://stackoverflow.com/a/739937/413180)仍然有解决方法的最佳建议。

有关如何安全实施沙箱的详细信息，请参阅[我的其他答案。](https://stackoverflow.com/a/21244925/413180)

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-11T11:57:42.973

> 还是有其他方法来评估代码

您无法`eval()`在脚本解析级别过滤掉调用，因为 JavaScript 是一种图灵完备的语言，可以在其中混淆调用。例如。请参阅 svinto 的解决方法。您可以通过用空值覆盖它来隐藏`window.eval`它，但确实有其他方法可以评估代码，包括（就在我的脑海中）：

*   新功能（'代码'）（）
*   document.write('%3Cscript>code%3C/script>')
*   document.createElement('script').appendChild(document.createTextNode('code'))
*   window.setTimeout('code', 0);
*   window.open(...).eval('code')
*   location.href='javascript:code'
*   在 IE 中，style/node.setExpression('someproperty', 'code')
*   在某些浏览器中，node.onsomeevent='code';
*   在旧浏览器中， Object.prototype.eval('code')

> 或在javascript中引起大规模恐慌？

那么 createElement('iframe').src='http​://evil.iframeexploitz.ru/aff=2345' 是您可以预料到的最糟糕的攻击之一......但实际上，当脚本具有控制权时，它可以做到用户可以在您的网站上做的任何事情。它可以让他们发布“我是一个大的老恋童癖！” 在你的论坛上一千次，然后删除自己的帐户。例如。

> 我必须诉诸于要求作者提供 Web 服务接口吗？

是的，或者：

*   什么都不做，让需要此功能的用户下载 GreaseMonkey
*   自己审核每个脚本提交
*   使用你自己的（可能类似于 JavaScript）迷你语言，你可以实际控制它

您可能感兴趣的后者的一个例子是[Google Caja](http://code.google.com/p/google-caja/)。我不完全确定我会相信它。这是一项艰巨的工作，到目前为止，他们肯定存在一些安全漏洞，但如果你真的必须采用这种方法，这已经是最好的了。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-11T10:54:01.033

确实没有任何方法可以保证任意 Javascript 的执行是安全的。实际上，您为防止恶意代码而提供的任何类型的过滤都会去除访问类似功能或数据的合法代码。我不认为你想做的事情以这种方式是可行的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2015-01-18T14:08:25.923

您需要在沙盒环境中执行不受信任的代码。`sandbox`这意味着使用该属性创建一个 iframe （请参阅[本文](http://www.html5rocks.com/en/tutorials/security/sandboxed-iframes/)），并在该框架内另外创建一个 web-worker（以便代码在单独的线程中运行，并且如果用户提交了一些奇怪的东西，则不会挂断 UI） .

如果您需要以某种方式与以所述方式沙盒化的代码进行交互，则可以使用[消息传递机制。](https://developer.mozilla.org/en-US/docs/Web/API/Window.postMessage)这有点棘手，但有一些库简化了任务，包括我自己创建的一个：[https ://github.com/asvd/jailed](https://github.com/asvd/jailed)

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-11T11:03:52.757

不，您实际上不能阻止用户提供的 Javascript 代码运行它想要的任何东西 - 即使禁止`eval()`也不能阻止它运行任意程序（它可能是一个 Javascript 解释器本身，在这种情况下它只是实现该`eval()`函数，以及许多其他方式 - 例如，它可以以字符串形式添加带有一些事件处理程序的 HTML，然后执行它们，它可以`document.write()`是一个新脚本等）。

如果您的网站不需要此用户提供的 JS 来在其他用户的计算机上运行，​​我只会发出一个大警告，添加一些人工控制（可能会标记流氓代码），也许是服务器上的一些防病毒软件（对此了解不多）。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-11T11:04:15.503

过滤掉 eval 可能不起作用。我想你可以像这样破解它：`window['ev' + 'al']('alert("hello world");');`. 您当然可以替换 eval 函数...

# iphone - UITableViewController 和 NavigationController

> ID：739858
> 
> 赞同：0
> 
> 时间：2009-04-11T10:50:07.097
> 
> 标签：iphone, cocoa-touch

我在将 UITableViewController 推送到 NavigationController 时遇到问题。使用以下代码：

```
ProblemEditController *problemEditController = [[[ProblemEditController alloc] initWithNibName:@"ProblemEditController" bundle:nil] retain];
problemEditController.problem = [[Problem alloc] init];
[self.navigationController pushViewController:problemEditController animated:YES];
[problemEditController release]; 
```

导航控制器按预期工作，但是表格视图未显示。numberOfSectionsInTableView 在我的 UITableViewController 上被调用，但是 numberOfRowsInSection 和 cellForRowAtIndexPath 没有被调用，并且视图显示为空白。

我有什么明显的遗漏吗？

*编辑*

我已经更改了 nib 文件中的某些内容（愚蠢地，不记得是什么），我现在看到 numberOfRowsInSection 被调用。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T12:43:23.160

好的，我发现我做错了什么。我在我的 nib 中添加了一个 TableViewController，而不仅仅是添加了一个表格视图。

我基本上搞砸了在 IB 中查看的连接。为了将来参考，这是自定义 UITableViewController 在 IB 中的样子：

[替代文字 http://pix.im/files/134/scaled.jpg?1239453713](http://pix.im/files/134/scaled.jpg?1239453713)

现在我觉得自己像个白痴。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T11:34:50.907

现在尝试在 **problemEditController* 上使用保留或释放。

这段代码对我来说很好：

```
formationsController = [[FormationsController alloc] initWithNibName:@"Formations" bundle:nil];
[navigationController pushViewController:formationsController animated:YES]; 
```

# .net - 从 JSON 网络服务返回 HTML - 什么是“.d”？

> ID：739859
> 
> 赞同：8
> 
> 时间：2009-04-11T10:50:31.183
> 
> 标签：.net, javascript, web-services, json

这是我不得不拿起并使用新技术而没有时间学习基础的情况之一！

我有以下调用 PrintService 的 js 函数，它返回要注入 div 的 HTML：

```
function showPrintDialog() {
  $.ajax({
        type: "POST",
        contentType: "application/json; charset=utf-8",
        data: "{}",
        dataType: "json",
        url: "http://localhost/PrintService/PrintService.asmx/RenderPrintDialog",

        success: function(data) {
            $("#printdialoginner").html(data.d); 
```

[在我注意到另一个例子](http://encosia.com/2008/03/27/using-jquery-to-consume-aspnet-json-web-services/)中的“.d”之前，我一直在努力解决这个问题

所以，它有效——但为什么呢？这是什么“.d”？

抱歉，如果这是一个菜鸟问题，但谷歌在这里不是我的朋友。

谢谢

***编辑：Magnar 是对的，它是 .NET 特定的东西。在这里查看 Rick Strahl - [http://www.west-wind.com/weblog/posts/164419.aspx](http://www.west-wind.com/weblog/posts/164419.aspx)***

让我感到困惑的是，它必须返回 JSON，因为我的客户端脚本代码对返回非常满意，但是当我访问浏览器时，我得到 XML...？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-11T11:13:08.367

PrintService 以 JSON 响应，这是一种基于 JavaScript Object Notation 的数据传输格式。所以数据参数是一个对象，而不是 HTML 字符串。该对象似乎有一个名为 的成员`d`，其中包含 HTML。

如果您直接访问 URL `http://localhost/PrintService/PrintService.asmx/RenderPrintDialog`，您应该会看到以下内容：

```
{
    d: "<html here>"
} 
```

可能还有其他成员。

花括号表示一个对象，里面是键：用逗号分隔的值对。[您可以在json.org](http://json.org/)阅读有关 json 的更多信息。

调用它的确切原因`d`是您必须与 PrintService 的作者讨论的问题。;-) 也许`markup`或者`html`会是一个更有帮助的名字。

## 编辑

事实证明，Duncan 是 PrintService 的作者，他自己并没有包含“d”。此外，在访问 URL 时，他看到的是 XML，而不是 JSON。当在 http 请求中请求 JSON 时，正在使用的 Web 服务的 .NET 框架会以 JSON 响应。该框架添加了臭名昭著的`d`成员作为包装器，以防止跨站点脚本。

本文解释了整个交易：[ASP.NET AJAX 版本之间的重大变化](https://web.archive.org/web/20090220075515/http://encosia.com/2009/02/10/a-breaking-change-between-versions-of-aspnet-ajax/)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-11T12:21:25.723

由于跨站点脚本攻击，ASP.Net 将 JSON 数据嵌套在 d 属性中。

可以将脚本代码作为 JSON 响应返回，并且将数据嵌套在 .d 属性中使其无法被浏览器解析。

请参阅此处： [JSON 漏洞](http://www.ajaxprojects.com/ajax/tutorialdetails.php?itemid=436)

问候 K

# entity-framework - 使用相关代码表创建客户端实体

> ID：739867
> 
> 赞同：1
> 
> 时间：2009-04-11T10:58:26.907
> 
> 标签：entity-framework, asynchronous

我在 Silverlight 的学习曲线上。我是一个以数据为中心的开发人员，所以我自然而然地选择了 ADO.NET 数据服务客户端。我在一个真实的场景中摸不着头脑，似乎在文档、博客等方面找不到任何帮助。

我有一个复杂的 Tutor 实体，其中包含地址、电话号码和电子邮件地址的相关实体集。我还有一些其他的集合，比如主题和认证。除了所有这些之外，还有用于查找诸如 StatusCodes、AddressTypes（如 Home、Business 等）、EmailTypes 等表的外键。所有这些都封装在我的模型项目中的 edmx 中。这是结构的一部分。

![替代文字](https://pqgd7w.bay.livefilestore.com/y1msuZUam9y4h52ek7DvFQt_MDGXSdxpncm5jffDz-wYaVanAL9cF5m8x3pXLn57DZkDQOBjMN6eC07FJglepwj7IzoD1LGpxp_bqKZ2lv5xpQXCCYzAyt3jK3EzBZwnpyJKGY9-AmByWubry6gYSrTiQ/image[4].png)

在 Silverlight 中，我有一个 UserControl，它是这个导师的数据输入表单。我创建了一个类似 DTO 的对象，用于将数据绑定到客户端的 TextBox 控件。一切都很好，直到用户点击保存。

Save 例程创建并添加一个 Tutor 和 Person 对象，并将它们添加到 DataServiceContext 并正确链接它们。我遇到麻烦的地方是我必须添加一个已经存储在数据库上下文中的相关实体，例如代码表。

例如，该人可能有多个学科专业：基础数学、基础科学等。TutorSubjectSet 必须与其他 3 个集合相关：学科（例如数学）、学科级别（例如基础），然后是导师。我的 DTO 有一个组合的 Subject_With_Level 项目列表，它显示了一个真正的笛卡尔选择的子集（至少在我上学的地方没有小学（学校）微积分之类的东西 :-)。该列表在 UI 上显示为复选框列表。因此，当用户单击“保存”时，我会选择选中的项目，并尝试针对具有这些值的代码表查找组合的 Subject_With_Level.SubjectId 和 .SubjectLevelId 值。

这就是我迷路的地方。在服务器端功能中，我可以，因为我可以在线进行这些查找并立即获取实体。在异步情况下，如何在忙于组装人员图时获取相关实体？在保存过程中进行异步调用不起作用。

我尝试了各种方法：我尝试使用 Subject_With_Level.SubjectLevelId 制作 SubjectLevel 的临时副本，并将其附加到上下文中，如下所示：

```
 public static SubjectLevel MakeFakeSubjectLevelFor(TutoringEntities ctx, Subject_With_Level subjectAndLevel)
{
     var subjectLevel = new SubjectLevel()
                       {
                         SubjectLevelId = subjectAndLevel.SubjectLevelId,
                         Description = subjectAndLevel.SubjectLevel,
                         EffectiveDate = DateTime.Now,
                         EnteredBy = "",
                         EnteredDate = DateTime.Now,
                         Type = subjectAndLevel.SubjectLevel
                       }; 
    try { ctx.AttachTo("SubjectLevelSet", subjectLevel); }
    catch { //this tries to catch situations where the level (eg. Elementary) has already been created }
    return subjectLevel; 
} 

```

这种方法适用于没有重复的情况（它还有一个优点是我不必进行额外的调用。）例如在地址中，将只有一个家庭地址（我有一个类似的函数：MakeAFakeAddressTypeFor( ））。你会注意到如果项目已经插入到 SubjectLevelSet 中，我有一个 try/catch 来捕获错误。如果该项目已被插入并且我遇到了该错误，则返回的 subjectLevel 不会附加到上下文。我收到一个错误，因为该项目没有被跟踪。但是，如果不对 SubjectLevelSet 发出异步查询，即使它在我的本地上下文中，我也无法检索现有的 subjectLevel。

我想做的是：

```
 var lev = ctx.SubjectLevelSet.Where(l => l.SubjectLevelId == subjectAndLevel.SubjectLevelId).FirstOrDefault();
if(lev == null )
  lev = Helpers.MakeFakeSubjectLevelFor(ctx, subjectAndLevel); 
```

但我得到：“不支持指定的方法”，我认为这意味着我必须执行查询 Async 所以我又回到了同样的情况。

我还尝试在 Loaded 事件委托中检索 SubjectLevels 列表。这样，当按下“保存”按钮时，我手头就有一组 SubjectElements。同样的问题，即使我手头有它，我也必须发出异步调用来进行搜索。我尝试遍历列表以查找我需要的列表，但这给了我一个错误，说该实体没有被上下文跟踪。

所以......显然我不理解这一点并且做错了，但我找不到任何做这种事情的实际例子。操作方法示例只是愉快地将原语加载到要存储的实体中。我见过的任何示例都没有显示相关实体以及如何检索它们。我可以让它变得简单，只为 codeId 存储整数值，而不是通过 FK 将它们关联起来，但这太过妥协了。

感谢您为我提供的任何帮助。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-19T02:19:28.253

实际上，我认为您觉得您必须执行查询 Async 因为它花费的时间太长？这个假设正确吗？如果是这种情况，您应该检查您尝试对查询本身执行的操作。我总是发现，如果我可以编写 SQL 来准确获取我想要的数据，那么我可以继续将 LINQ 写入它（使用 LINQPad 之类的东西）。

此外，您还可以创建一个“扁平化”复杂图形的 SQL 视图。然后在 EF 更新向导中确保选择视图。这样，每次您构建此自定义复杂 DTO 时，您只需发出服务器端 where 子句并在那里填充您的值。

如果我在左侧领域出路，请告诉我，我在非常复杂的业务数据对象场景中拥有丰富的 EF 经验，而且我很可能错误地阅读了您的情况。

我认为 SO 上的人没有回答，因为它很长而且他们希望得到赏金，不过只是猜测。

# java - 在Java中提取光标图像

> ID：739870
> 
> 赞同：7
> 
> 时间：2009-04-11T11:01:54.633
> 
> 标签：java, c++, winapi

我想知道是否有办法从 Java 中的 Cursor 对象中提取 Image 对象。

例如，一个用途是：

```
Image img = extractCursorImage(Cursor.getDefaultCursor()); 
```

然后您可以在工具栏按钮上绘制它（这就是我想要它的目的）。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-11T17:55:24.750

[Cursor](http://java.sun.com/javase/6/docs/api/java/awt/Cursor.html)类非常抽象——所有重要的东西都委托给本地代码，所以你不能只在[图形](http://java.sun.com/javase/6/docs/api/java/awt/Graphics2D.html)上下文中绘制一个。没有一种直接明显的方法可以解决预定义图标或在本机代码中执行的需要。

* * *

> 你能帮我使用你提到的那个功能吗？

[下面是一些使用JNA](https://github.com/twall/jna/)库绘制内置 Windows 光标的代码。如果可以使用 JNA，则可以避免使用 C++ 编译器。

我可能进行了太多本地调用，但对于一次性图标生成而言，成本并不高。

[用 Java 绘制的手形光标 http://f.imagehost.org/0709/hand.png](http://f.imagehost.org/0709/hand.png)

将光标显示为 Java 图像的代码：

```
public class LoadCursor {

  public static void draw(BufferedImage image, int cursor,
      int diFlags) {
    int width = image.getWidth();
    int height = image.getHeight();

    User32 user32 = User32.INSTANCE;
    Gdi32 gdi32 = Gdi32.INSTANCE;

    Pointer hIcon = user32
        .LoadCursorW(Pointer.NULL, cursor);
    Pointer hdc = gdi32.CreateCompatibleDC(Pointer.NULL);
    Pointer bitmap = gdi32.CreateCompatibleBitmap(hdc,
        width, height);

    gdi32.SelectObject(hdc, bitmap);
    user32.DrawIconEx(hdc, 0, 0, hIcon, width, height, 0,
        Pointer.NULL, diFlags);

    for (int x = 0; x < width; x++) {
      for (int y = 0; y < width; y++) {
        int rgb = gdi32.GetPixel(hdc, x, y);
        image.setRGB(x, y, rgb);
      }
    }

    gdi32.DeleteObject(bitmap);
    gdi32.DeleteDC(hdc);
  }

  public static void main(String[] args) {
    final int width = 128;
    final int height = 128;

    BufferedImage image = new BufferedImage(width, height,
        BufferedImage.TYPE_INT_ARGB);
    draw(image, User32.IDC_HAND, User32.DI_NORMAL);
    BufferedImage mask = new BufferedImage(width, height,
        BufferedImage.TYPE_INT_RGB);
    draw(mask, User32.IDC_HAND, User32.DI_MASK);
    applyMask(image, mask);

    JLabel icon = new JLabel();
    icon.setIcon(new ImageIcon(image));

    JFrame frame = new JFrame();
    frame.setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
    frame.setContentPane(icon);
    frame.pack();
    frame.setVisible(true);
  }

  private static void applyMask(BufferedImage image,
      BufferedImage mask) {
    int width = image.getWidth();
    int height = image.getHeight();
    for (int x = 0; x < width; x++) {
      for (int y = 0; y < height; y++) {
        int masked = mask.getRGB(x, y);
        if ((masked & 0x00FFFFFF) == 0) {
          int rgb = image.getRGB(x, y);
          rgb = 0xFF000000 | rgb;
          image.setRGB(x, y, rgb);
        }
      }
    }
  }

} 
```

User32.dll 接口：

```
public interface User32 extends Library {

  public static User32 INSTANCE = (User32) Native
      .loadLibrary("User32", User32.class);

  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_ARROW = 32512;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_IBEAM = 32513;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_WAIT = 32514;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_CROSS = 32515;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_UPARROW = 32516;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_SIZENWSE = 32642;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_SIZENESW = 32643;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_SIZEWE = 32644;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_SIZENS = 32645;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_SIZEALL = 32646;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_NO = 32648;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_HAND = 32649;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_APPSTARTING = 32650;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_HELP = 32651;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_ICON = 32641;
  /** @see #LoadCursorW(Pointer, int) */
  public static final int IDC_SIZE = 32640;

  /** @see #DrawIconEx(Pointer, int, int, Pointer, int, int, int, Pointer, int) */
  public static final int DI_COMPAT = 4;
  /** @see #DrawIconEx(Pointer, int, int, Pointer, int, int, int, Pointer, int) */
  public static final int DI_DEFAULTSIZE = 8;
  /** @see #DrawIconEx(Pointer, int, int, Pointer, int, int, int, Pointer, int) */
  public static final int DI_IMAGE = 2;
  /** @see #DrawIconEx(Pointer, int, int, Pointer, int, int, int, Pointer, int) */
  public static final int DI_MASK = 1;
  /** @see #DrawIconEx(Pointer, int, int, Pointer, int, int, int, Pointer, int) */
  public static final int DI_NORMAL = 3;
  /** @see #DrawIconEx(Pointer, int, int, Pointer, int, int, int, Pointer, int) */
  public static final int DI_APPBANDING = 1;

  /** http://msdn.microsoft.com/en-us/library/ms648391(VS.85).aspx */
  public Pointer LoadCursorW(Pointer hInstance,
      int lpCursorName);

  /** http://msdn.microsoft.com/en-us/library/ms648065(VS.85).aspx */
  public boolean DrawIconEx(Pointer hdc, int xLeft,
      int yTop, Pointer hIcon, int cxWidth, int cyWidth,
      int istepIfAniCur, Pointer hbrFlickerFreeDraw,
      int diFlags);

} 
```

Gdi32.dll 接口：

```
public interface Gdi32 extends Library {

  public static Gdi32 INSTANCE = (Gdi32) Native
      .loadLibrary("Gdi32", Gdi32.class);

  /** http://msdn.microsoft.com/en-us/library/dd183489(VS.85).aspx */
  public Pointer CreateCompatibleDC(Pointer hdc);

  /** http://msdn.microsoft.com/en-us/library/dd183488(VS.85).aspx */
  public Pointer CreateCompatibleBitmap(Pointer hdc,
      int nWidth, int nHeight);

  /** http://msdn.microsoft.com/en-us/library/dd162957(VS.85).aspx */
  public Pointer SelectObject(Pointer hdc, Pointer hgdiobj);

  /** http://msdn.microsoft.com/en-us/library/dd145078(VS.85).aspx */
  public int SetPixel(Pointer hdc, int X, int Y, int crColor);

  /** http://msdn.microsoft.com/en-us/library/dd144909(VS.85).aspx */
  public int GetPixel(Pointer hdc, int nXPos, int nYPos);

  /** http://msdn.microsoft.com/en-us/library/dd183539(VS.85).aspx */
  public boolean DeleteObject(Pointer hObject);

  /** http://msdn.microsoft.com/en-us/library/dd183533(VS.85).aspx */
  public boolean DeleteDC(Pointer hdc);

} 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2019-12-10T12:27:39.720

Linux 解决方案：

```
private BufferedImage getCursorImage(){
    X11 x11 = X11.INSTANCE;
    Xfixes xfixes = Xfixes.INSTANCE;

    X11.Display display = x11.XOpenDisplay(null);

    Xfixes.XFixesCursorImage cursorImage = xfixes.XFixesGetCursorImage(display);

    ByteBuffer buf = cursorImage.pixels.getPointer().getByteBuffer(0,
            cursorImage.width * cursorImage.height * NativeLong.SIZE);
    buf.order(ByteOrder.LITTLE_ENDIAN);
    BufferedImage bim = new BufferedImage(cursorImage.width, cursorImage.height, BufferedImage.TYPE_INT_ARGB);
    WritableRaster raster = bim.getRaster();
    for (int y = 0; y < cursorImage.height; y++) {
        for (int x = 0; x < cursorImage.width; x++) {
            long z = NativeLong.SIZE == 8 ? buf.getLong() : buf.getInt();
            int b = (int) ((z >> 24) & 0xFF);
            int a = (int) ((z >> 16) & 0xFF);
            int g = (int) ((z >> 8) & 0xFF);
            int r = (int) (z & 0xFF);
            raster.setPixel(x, y, new int[] { a, r, g, b });
        }
    }

    x11.XCloseDisplay(display);
    return bim;
} 
```

JNA接口：

```
public interface Xfixes extends Library {

    Xfixes INSTANCE = Native.load("Xfixes", Xfixes.class);

    @Structure.FieldOrder({ "x", "y", "width", "height", "xhot", "yhot", "cursor_serial", "pixels", "atom", "name"})
    class XFixesCursorImage extends Structure {
        public short x;
        public short y;
        public short width;
        public short height;
        public short xhot;
        public short yhot;
        public NativeLong cursor_serial;

        public NativeLongByReference pixels;

        public NativeLong atom;
        public Pointer name;

        public XFixesCursorImage() {
            super();
        }
    }

    XFixesCursorImage XFixesGetCursorImage(X11.Display dpy);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T04:36:35.057

可以从 JRE 中找到系统光标图像。查看源代码也可能很有趣。

# asp.net - HTML 错误检查器

> ID：739871
> 
> 赞同：1
> 
> 时间：2009-04-11T11:02:26.257
> 
> 标签：asp.net, html, parsing, messages

我正在使用 Asp.net。，假设我允许用户在我的网站上发布带有 HTML 标记的消息。我如何确保他已正确关闭所有标签？是否有任何可用的 HTML-tag-checker 尝试解析标签并报告错误（如果有）？可能就像 BLOGGER 一样。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T11:07:18.740

您可以使用[HTMLTidy](http://tidy.sourceforge.net/)来确保 HTML 格式正确。不确定它是否会在不修复错误的情况下报告错误，但它是开源的，所以你可以破解它来做到这一点。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T11:15:15.367

您可以自己轻松地解析文本。定义允许需要关闭的标签列表（strong、em 等）。解析代码并将每个 HTML 标记作为标记并将其推送到堆栈中。找到结束标记后，查看顶部项目，如果它不是找到的结束标记的补充，则 HTML 嵌套不正确。

假设从堆栈中删除成对的标签/结束标签，剩余元素是已开始但未完成的标签。这只是一种初步的方法，但它可能只需要几行代码就可以识别不正确的嵌套标签或未闭合的标签。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T13:39:27.783

[我认为您可以尝试使用WYSIWIG](http://tinymce.moxiecode.com/)编辑器之一……（好的编辑器包括[http://www.fckeditor.net/、http://tinymce.moxiecode.com/、http://freetextbox.com/](http://freetextbox.com/) [）](http://www.fckeditor.net/)您应该能够强制它进入“源代码模式”，他们可能会为你整理糟糕的 HTML（尽管我自己实际上并没有绑定这种技术：D）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-11T12:30:37.917

我喜欢使用 wc3 在[http://validator.w3.org/](http://validator.w3.org/)上的在线 html 验证器 ，但请记住首先确保您的整个文档在评论之外是有效的，否则这可能是一次非常有趣的旅行。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-11T13:43:50.767

只是一个离题的想法 - 使用 Wiki 风格的引擎。这样你就可以按照你想要的方式自己格式化 HTML。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-06-15T20:08:49.223

Firefox 的 webdeveloper 工具栏插件有一个功能，允许您使用 w3c 验证器 - 工具->验证本地 HTML 来验证您当前正在查看的页面的 html。

无论如何，它可能正在使用验证器中可用的功能。我认为它可能会创建一个临时的 html 文件并上传它。

# javascript - 在 IE 7 中查找 Javascript 错误？

> ID：739879
> 
> 赞同：-1
> 
> 时间：2009-04-11T11:09:42.527
> 
> 标签：javascript, cross-browser

我在我的博客中放了一个 digg 按钮。该博客在 firefox 和 opera 上运行良好，但是当我在 ie7 中打开它时，它显示 javascript 错误。单击那个小三角形没有显示任何信息..如何删除该错误？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T11:35:49.997

尝试在 Google 上搜索 Firebug Lite。这是 Firebug 的一个版本，可以直接集成到网页中，并允许在 IE 上也具有出色的 Firebug 功能。它可能有助于找到您的 JavaScript 问题。

# python - 在 Python 中迭代给定类的对象实例

> ID：739882
> 
> 赞同：20
> 
> 时间：2009-04-11T11:13:09.880
> 
> 标签：python, oop

给定一个保存其对象注册表的类：

```
class Person(object):
   __registry = []

   def __init__(self, name):
       self.__registry.append(self)
       self.name = name 
```

我将如何使以下代码工作（不使用 Person.__registry）：

```
for personobject in Person:
    print personobject 
```

在研究过程中，我发现了一个提示，即可以使用`__metaclass__`with a`__getitem__`方法。有什么想法吗？

* * *

## 回答 #1

> 赞同：30
> 
> 时间：2009-04-11T12:10:20.587

您可以使用简单的元类使您的类对象可迭代。

```
class IterRegistry(type):
    def __iter__(cls):
        return iter(cls._registry)

class Person(object):
    __metaclass__ = IterRegistry
    _registry = []

    def __init__(self, name):
        self._registry.append(self)
        self.name = name 
```

（我也进行了更改`__registry`以`_registry`使其更容易从元类访问）。然后，

```
>>> p = Person('John')
>>> p2 = Person('Mary')
>>> for personobject in Person:
...     print personobject
...
<person.Person object at 0x70410>
<person.Person object at 0x70250> 
```

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-11T11:57:21.523

首先，不要使用双重`__`名称。它们保留供 Python 使用。如果你想“私人”使用 single `_`。

其次，让这种事情尽可能简单。不要在复杂的事情上浪费大量的时间和精力。这是一个简单的问题，保持代码尽可能简单以完成工作。

```
class Person(object):
    _registry = []

    def __init__(self, name):
        self._registry.append(self)
        self.name = name

for p in Person._registry:
    print p 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-11T11:24:13.380

你可以这样做：

```
for item in Person.__registry:
    print(item) 
```

# java - Toplink 无应用服务器

> ID：739888
> 
> 赞同：2
> 
> 时间：2009-04-11T11:20:01.800
> 
> 标签：java, database, toplink

是否可以在没有应用程序服务器的情况下仅在桌面应用程序上使用**Toplink Essentials ？**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T11:23:19.873

可以，但对于某些行为，您可能必须使用 JVM 启动选项来启用 toplink 代理。我相信这是为了延迟加载或类似的东西。

您是指 TopLink 还是 TopLink Essentials？第一个是商业 Oracle 产品。后者是 JPA 1.0 的参考实现，它是一个稍微精简的版本。

老实说，我认为除了 EclipseLink（它将是 JPA 2.0 参考实现）或 Hibernate 之外，没有任何理由使用任何东西。

要真正做到这一点：

*   [Java SE 的休眠](http://www.onjava.com/pub/a/onjava/2005/11/16/hibernate-for-java-se.html)；
*   [J2SE RCP 应用程序中的 Eclipselink](http://www.weheartcode.com/2008/08/27/eclipselink-in-j2se-rcp-applications/)；和
*   [在桌面应用程序中使用 Java Persistence API](http://java.sun.com/developer/technicalArticles/J2SE/Desktop/persistenceapi/)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T11:23:34.397

是的，只要您不需要 JNDI 命名服务。Toplink 和 Hibernate 都可以在没有应用服务器的情况下运行。您只需要一个关系数据库和一个 JDBC 驱动程序。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T11:26:27.243

是的，toplink 是一个纯 Java 类库

# .net - 从数据库中读取 .NET 配置

> ID：739890
> 
> 赞同：13
> 
> 时间：2009-04-11T11:21:15.133
> 
> 标签：.net, sql-server, configuration

.NET 2.0 及更高版本的配置系统非常强大且可扩展——只要您不想改变它全部来自文件系统中的 XML 文件的事实。

根据我的要求，我无法更改文件，因为我的应用程序在我无法触及的托管环境中运行 - 但我可以更改 SQL Server 数据库。

因此，我正在考虑将配置文件或部分存储在 SQL 表中 - 但是如何将 .NET 2.0 配置系统与此绑定？

有没有办法编写一个“自定义配置提供程序”，它不会从文件系统中的 *.config 文件中读取其配置部分，而是从 SQL 数据库中的表中读取？

我一直在考虑创建自己的自定义 ConfigurationSection 或 ConfigurationElement，甚至是自定义配置本身 - 但似乎我总是回到我可以随心所欲地扩展文件系统中的配置系统的地步，但我不能让它从数据库表中读取我的 XML 片段.....

我错过了什么？是否有人已经这样做并愿意解释/分享？

谢谢！马克

PS：我还尝试将配置 XML 读入字符串，然后将其反序列化为适当的例如 ServiceModelConfigSection - 不幸的是，这不起作用，因为 ConfigSection 基类不知何故没有实现它所需的方法是 XML 可序列化的............（YIKES !!!）

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-11T14:46:49.367

这里有一篇文章谈到做你正在谈论的事情：

> [http://www.wrox.com/WileyCDA/Section/Redirecting-Configuration-with-a-Custom-Provider.id-291932.html](http://www.wrox.com/WileyCDA/Section/Redirecting-Configuration-with-a-Custom-Provider.id-291932.html)

总之，他们所做的是创建 ProtectedConfigurationProvider 的派生版本，通常用于加密 .config 文件。在 Decrypt 方法中，不是解密配置信息，而是从数据库中检索它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2012-08-06T23:29:17.397

You can use the same xml parsing .NET uses when reading the web.config and configuration sections with some reflection.

Here is the [sample code](https://github.com/pauldotknopf/DotNetConfigurationFromDatabase) to do it.

Here is a class that you want represented in xml.

```
public class TestConfiguration : ConfigurationSection
{
    [ConfigurationProperty("optionalProperty", DefaultValue = "defaultValue")]
    public string OptionalProperty
    {
        get { return (string)base["optionalProperty"]; }
        set { base["optionalProperty"] = value; }
    }

    [ConfigurationProperty("requiredProperty", IsRequired = true)]
    public string RequiredProperty
    {
        get { return (string)base["requiredProperty"]; }
        set { base["requiredProperty"] = value; }
    }
} 
```

Here is how you instantiate this ConfigurationSection using XML from a string (or a database). This was taken from the tests on GitHub that was linked in the blog post above.

```
[TestMethod]
public void Can_build_configuration_with_default_value_set()
{
    var result = _configurationSectionBuilder
        .BuildSection<TestConfiguration>("<config requiredProperty=\"required\" optionalProperty=\"setValue\"></config>");

    Assert.AreEqual("setValue", result.OptionalProperty);
} 
```

You get all the .NET lift with this approach using the System.Configuration namespace.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-12-16T09:57:04.287

尝试使用“.NET 应用程序和 WCF 服务的配置服务”，它是 MSFT 的 StockTrader 2.0 示例应用程序的一部分：

[StockTrader 2.0 配置服务概述](http://msdn.microsoft.com/en-us/netframework/dd164388)

[StockTrader 2.0 配置服务文档](http://download.microsoft.com/download/4/8/6/486b4b4f-5a87-4b5c-beec-455290f83274/ConfigServiceTechnicalGuide.pdf)

[为 .NET 4.0 下载 StockTrader 2.0](http://download.microsoft.com/download/8/1/9/8192E4B2-1054-45CD-9AC8-94CE2C777264/StockTraderSetup.msi)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-03-23T15:11:15.780

您可以根据需要尝试[Cinchoo 框架](http://www.cinchoo.com)。

它支持读取和写入配置条目到文件、注册表、INI、数据库等。

Here is the simple way to define and use the configuration object using Cinchoo framework

```
namespace HelloWorld
{
    #region NameSpaces

    using System;
    using Cinchoo.Core.Configuration;

    #endregion NameSpaces

    [ChoConfigurationSection("sample")]
    public class SampleConfigSection : ChoConfigurableObject
    {
        [ChoPropertyInfo("name", DefaultValue="Mark")]
        public string Name;

        [ChoPropertyInfo("message", DefaultValue="Hello World!")]
        public string Message;
    }

    static void Main(string[] args)
    {
        SampleConfigSection sampleConfigSection = new SampleConfigSection();
        Console.WriteLine(sampleConfigSection.ToString());
    }

} 
```

Very first time, when you run the application, Cinchoo framework automatically generates the configuration section as below. Then onwards, you can control them either through configuration source or by code.

```
<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <configSections>
    <section name="sample" type="Cinchoo.Core.Configuration.ChoNameValueSectionHandler, Cinchoo.Core, Version=1.0.0.0, Culture=neutral, PublicKeyToken=b7dacd80ff3e33de" />
  </configSections>
  <sample>
    <add key="name" value="Mark" />
    <add key="message" value="Hello World!" />
  </sample>
</configuration> 
```

Try it!

# php - PHP mkdir()、chmod() 和 Windows

> ID：739891
> 
> 赞同：4
> 
> 时间：2009-04-11T11:22:04.413
> 
> 标签：php, windows, directory, chmod

我正在使用 PHP 函数 mkdir($path, 0777) 在 Apache 服务器（在 Windows 上运行）上创建一个新目录。

当我创建它并查看文件夹时，Windows 已将目录设置为只读。有没有办法在不使用 exec() 到 cacls.exe 的情况下改变它？PHP 文档指出 chmod() 在 Windows 上不起作用，但没有说明替换方法。

谷歌似乎在这方面有点无益。

编辑：在与我的两位教育机构的管理员交谈几分钟后，似乎他们的学生测试 PHP 服务器正在使用 USB 驱动器运行。我有一种感觉，这将与它*拍脑袋有关*

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T11:44:27.717

以下：

```
<?php
mkdir( "foo" )
?> 
```

（注意没有指定模式）在 Win2K 上适用于我 - 它创建一个没有设置属性的文件夹。

**编辑：**只是有一个想法-可能与权限有关吗？尝试从命令行运行上面的代码，看看会发生什么：

```
C:> c:\php\pgp.exe
    <?php
    mkdir( "foo" )
    ?>
    ^Z 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-05-07T14:56:20.187

我在 php 和 cakephp for windows 中使用 mkdir("my dir name",0777,true); 它对我来说很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T11:51:24.907

根据 PHP 文档，mode 参数在 Windows 上被完全忽略（但默认为 0777，因此您不必指定它）。尝试根本不指定模式，看看会发生什么。也许它把事情搞砸了？

# rest - 如何在资源上建模不同的视图（角色）？

> ID：739900
> 
> 赞同：2
> 
> 时间：2009-04-11T11:26:40.707
> 
> 标签：rest, roles

如何从容地为角色视图建模？

假设我有一个可供买家或卖家查看的资源（有些内容在资源上在他们之间共享，有些内容对他们每个人都是唯一的）

我是否应该将它们设为单独的资源：/resource/1/buyer、/resource/1/seller

或者我应该传递一个格式：/resource/1?viewer=seller

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T12:46:06.397

我不会把它放在任何地方。相反，我会让相同的 URL 根据经过身份验证的用户显示资源的适用部分。

用户的角色在身份验证时已经确定，要求在查询中复制数据是没有意义的。想象一下，您有一个复杂的用户权限系统。然后你会让用户在 URL 中复制他们的整个 ACL 吗？:/ 这样用户甚至不必知道它的角色。

如果视图根本不同（例如，根本不共享任何字段或字段具有不同的语义），那么我将创建两个资源（/auction/1/buyer-info、/auction/1/seller-info）。但这可能不是这里的情况。

如果实际上*用户可以选择*同一资源的多个视图，那么我会将视图放在查询参数 (?view=simple) 中，因为它与资源本身无关，但实际上是“查询参数”。但请记住，这里的查询参数是“view”，而不是“viewer”（如您的示例中），这是 IMO 的一个重要区别。

通过遵循这三种方法，您可以缓存资源，然后根据 a) 当前用户和 b) 视图查询参数从中剥离相关数据。

# c# - 从 SQL Server 数据库中检索时间戳的简单方法

> ID：739901
> 
> 赞同：0
> 
> 时间：2009-04-11T11:27:25.197
> 
> 标签：c#, sql, sql-server

我的 Microsoft Sql Server 数据库中有一个时间戳列（已更新），并希望使用 SqlConnection 和 SqlCommand 将该值作为 DateTime 对象检索。

最简单的方法是什么？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-11T11:32:50.690

SQL Server 数据库中的时间戳字段与日期和时间无关，而只是一个序列号。

另一方面，MySql 中的时间戳是一个日期时间值。

# linq-to-sql - 将现有的 LinqToSQL 代码转换为与其他数据库兼容

> ID：739902
> 
> 赞同：0
> 
> 时间：2009-04-11T11:28:38.407
> 
> 标签：linq-to-sql, ado.net

我有一个与 SQL Server 数据库通信的工作应用程序。此应用程序使用 LinqToSQL。

出于多种原因，我想将此应用程序转换为使用 Microsoft Access。（这是一小组数据，可以同时使用但很少见，我想部署在无法访问 SQL Server 的机器上，并且我希望能够将整个数据库作为一个文件发送给只有 Microsoft Access 的同事）。

我应该如何转换应用程序？由于 LinqToSQL 仅为 SQL Server 提供，我怀疑我遇到了其他开发人员偶尔遇到的问题；例如，将 SQL Server 应用程序发送到使用 Oracle 的新站点。

我能想到的唯一策略是搜索每次使用 LinqToSQL 的代码并将其更改为使用 ADO.NET。显然，这将是一项耗时且容易出错的任务。

有没有更好的方法，还是我应该咬紧牙关继续做下去？

下面是一段代码，以防万一示例有助于对话：

```
 var existing =
           from ph in _dataContext.pub_hols
           where ph.pub_hol_def_id == this._publicHolidayDefId
              &&
           ph.pub_hol_date.Year == year
           select ph;
        _dataContext.pub_hols.DeleteAllOnSubmit(existing);
        _dataContext.pub_hols.InsertAllOnSubmit(GetPublicHolidays(cellsForYear));
        _dataContext.SubmitChanges(); 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T11:58:24.873

我建议通过 nHibernate 之类的东西切换到更通用的 DAL。这样下次您需要再次切换数据库时，您将无需更改任何内容。根据您的 LINQ 查询的复杂程度，您甚至可以将它们与 nHibernate LINQ 模块一起使用。该模块仍处于测试阶段，我自己不能代表它。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T12:38:26.180

ADO.NET Entity Framework 是跨数据库的，应该更接近您当前的代码。

# c# - 为什么 C# 中的 SWF 文件在使用 AxShockwaveFlash 时不会暂停

> ID：739914
> 
> 赞同：0
> 
> 时间：2009-04-11T11:36:22.057
> 
> 标签：c#, .net, flash, axshockwaveflash

我需要在 C# 应用程序中播放各种 swf 文件。

他们似乎开始玩得很好，但第一次尝试暂停它没有效果，如果我再试一次，面板就会变白。

我正在使用的代码如下。

倒带和前进也没有效果。

任何意见或帮助将不胜感激。

大卫奈特

```
namespace MyUI
{
    public partial class ABWithSWF : MyAbstractABFrm
    {
        // Keep Track of whats happening
        enum StateOfPlay {NotSet, Playing, Paused };

        private AxShockwaveFlashObjects.AxShockwaveFlash axShockwaveFlashCube = new AxShockwaveFlashObjects.AxShockwaveFlash();

        StateOfPlay playState = StateOfPlay.NotSet;

        public ABWithSWF()
        {
            InitializeComponent();
            pnlSwf.Controls.Add(axShockwaveFlashCube);
            axShockwaveFlashCube.Dock = DockStyle.Fill;
        }

        // One button that is either play or pause
        private void btnPlay_Click(object sender, EventArgs e)
        {
            // File to play
            string path = string.Format(@"{0}\graphical summary.swf", Utils.GetSWFPath());

            switch (playState)
            {
                case StateOfPlay.Paused:
                    axShockwaveFlashCube.Play();
                    btnPlay.ImageIndex = 3;
                    playState = StateOfPlay.Playing;
                    break;
                case StateOfPlay.Playing:
                    axShockwaveFlashCube.StopPlay();
                    btnPlay.ImageIndex = 4;
                    playState = StateOfPlay.Paused;
                    break;
                case StateOfPlay.NotSet:
                    axShockwaveFlashCube.LoadMovie(0, path);
                    axShockwaveFlashCube.Play();
                    btnPlay.ImageIndex = 4;
                    playState = StateOfPlay.Playing;
                    break;
            }
        }

        private void button2_Click(object sender, EventArgs e)
        {
            axShockwaveFlashCube.Rewind();
        }

        private void button3_Click(object sender, EventArgs e)
        {
            axShockwaveFlashCube.Forward();
        }
    }
} 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2011-05-06T11:33:04.183

我刚刚在 c# 中开发了一个项目，将 Flash 对象嵌入到 WPF UserControl 中，它必须嵌入 Windows Forms UserControl 才能播放它。

所以，我的经验是axShockwaveFlashObjects 的**Stop()****方法实际上是在暂停**电影，而**Play() 实际上是在恢复**电影（也正在启动它）。

这是我在 Windows 窗体 UserControl 中用于播放、暂停、恢复和停止 swf 对象的代码：

```
 /// <summary>
    /// Starts playing the movie, or resumes
    /// it if it is paused.
    /// </summary>
    public void Play()
    {
        Stop();
        flash_control.Play();
    }

    /// <summary>
    /// Pauses the movie. To resume it, 
    /// call <see cref="Play()"/>.
    /// </summary>
    public void Pause()
    {
        flash_control.Stop();
    }

    /// <summary>
    /// Stops playing the movie
    /// </summary>
    public void Stop()
    {
        flash_control.Stop();
        flash_control.FrameNum = 0;
    } 
```

# vb.net - 使用 oled 或 odbc 连接在 Excel 文件中插入、更新、删除数据

> ID：739918
> 
> 赞同：1
> 
> 时间：2009-04-11T11:38:16.140
> 
> 标签：vb.net, excel, odbc

我已经尝试了所有方法，但无法插入、更新和删除 Excel 文件。我能够连接excel表。连接似乎也已打开。这是我的连接字符串：

```
 Dim sConnectionString As String
        Const kunal = "C:\"
        sConnectionString = "Provider=Microsoft.Jet.OLEDB.4.0;" & _
            "Data Source=" & kunal & _
            "login.xls;Extended Properties=Excel 8.0;"
        Dim con As New OleDbConnection(sConnectionString)
        con.Open()
        'MsgBox("hi") 
```

消息框来了。所以连接没问题，但现在我只想在 Excel 表中添加细节，但出现了错误。这是我的插入代码：

```
 Dim cmd As OleDbCommand
        cmd = New OleDbCommand("insert into [Sheet1$] (FirstName,LastName) values('admin','kunal')", con)
        cmd.ExecuteNonQuery()
        con.Close() 
```

这是我在页面加载时遇到的错误。

> Microsoft Jet 数据库引擎找不到对象“Sheet1$”。确保对象存在并且正确拼写其名称和路径名。我已经为他提供了正确的道路。拼写也正确。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-11T11:55:53.350

也许看看[Linq to Excel](http://solidcoding.blogspot.com/2008/02/linq-to-excel-code-generator_2842.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T18:58:18.670

Sheet1（不带 $）必须是您尝试写入的工作表名称，它还需要您在第一行中写入的列的列标题。还要确保您没有在 Excel 中打开电子表格，否则会锁定它。我试过你的语法，它工作正常。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-24T17:40:25.243

即使看起来不像，它仍然可能是连接问题*。*

[http://support.microsoft.com/kb/316809](http://support.microsoft.com/kb/316809)

如果您看到的是这个错误，那么这是一个误导性的异常。

# svn - git svn dcommit to sourceforge 失败，但它直接通过 svn 工作

> ID：739923
> 
> 赞同：0
> 
> 时间：2009-04-11T11:43:54.550
> 
> 标签：svn, git, git-svn

我正在使用 Subversion 在 SourceForge 上开发一个开源项目。几天前，我做了一个`git svn clone`并开始使用 Git 跟踪我的更改。

过了一会儿，我尝试将`dcommit`我的更改返回上游。但这失败了，出现以下错误：

`Autorisierung schlug fehl: MKACTIVITY von »/svnroot/housebot/!svn/act/b8dbd0ff-f224-4899-b6fe-06a514fa2dbf«: Autorisierung schlug fehl: Could not authenticate to server: rejected Basic challenge (https://housebot.svn.sourceforge.net) at /sw/lib/git/git-svn line 3649`

（请忽略德语。它说的是“授权失败”。）。所以我认为我的 SSH 密钥设置不正确，但是当我尝试通过 svn 提交更改时，它工作得很好。

所以我不知道这里到底出了什么问题。我会假设它要么在 svn 和 git svn 中工作，要么根本不工作。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-17T14:06:59.707

嗯...当您通过 HTTPS + WebDAV 访问存储库时（如错误消息所示），将不会使用 SSH 密钥，而是使用普通的用户名和密码...

所以要么设置正确的用户名和密码，要么使用 svn+ssh 而不是 https（虽然我不知道 sourceforge 是否支持 Subversion 的 svn+ssh）。

请注意，SourceForge 的 Subversion 已设置为您可以匿名签出和更新，但需要您的密码才能提交。如果您想为您还不是成员的项目准备补丁，并且希望稍后在您成为成员时提交它，这将非常有用。但是当您第一次尝试提交更改时，它会触发代码中的一些极端情况。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-17T19:27:41.230

您可以发布设置 svn 存储库以由 git 跟踪时所采取的步骤吗？听起来你一路上错过了一些东西。奇怪的是，您能够克隆 repo 而没有任何错误，但在 dcommitting 时出错。

我打算在黑暗中拍摄，但听起来你在最初克隆 svn 存储库后忘记运行“git svn rebase”。我在传球中被烧死了。

# html - 检测浏览器字体大小

> ID：739940
> 
> 赞同：10
> 
> 时间：2009-04-11T11:59:48.380
> 
> 标签：html, css, browser, font-size

是否可以检测浏览器字体大小？当用户从菜单选择更改字体大小时，是否可以检测新的字体大小？非常感谢大家的帮助。此致。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-11T13:51:05.163

> 是否可以检测浏览器字体大小？

有点，但它很少是一个好主意。假设 <body> 没有设置字体大小并且没有干扰规则（如“body div”）：

```
var measure= document.createElement('div');
measure.style.height= '10em';
document.body.appendChild(measure);
var size= measure.offsetHeight/10;
document.body.removeChild(measure); 
```

为您提供 1em 的像素大小。

> 当用户从菜单选择更改字体大小时，是否可以检测新的字体大小？

不是直接的，但你可以像上面那样经常轮询一个测量器函数。在 IE 上，您可以挂起检查 CSS 表达式（），因为这些会在字体大小更改时重新计算（以及许多其他时间），但这可能不值得（您仍然需要其他浏览器和表达式的轮询器（ ) 无论如何都已弃用)。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2013-01-08T09:06:35.497

我需要同样的东西。在这里我找到了最好的答案。

[https://developer.mozilla.org/en-US/docs/DOM/window.getComputedStyle](https://developer.mozilla.org/en-US/docs/DOM/window.getComputedStyle)

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-11T14:49:09.690

据我所知，没有办法查明。您只需假设默认大小为 16 像素，这是标准。

最佳做法是在 ems 中设置所有字体大小，并根据基本字体大小进行缩放。

大多数人将基本字体设置为 10 像素，这使得使用 em 更容易。

**例子**

16px = 1em

```
p {
    font-size:2em;
} 
```

那将等于 32px

* * *

10px = 0.625em

```
body {
    font-size:0.625em;
}

p {
    font-size:2em;
} 
```

那将等于 20px；

我希望这有帮助。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-11T12:02:06.223

最简洁的答案是不。但是，我怀疑您希望根据用户的字体大小在不同的元素上放置不同的大小。如果是这样，您可能想看看在“em”中指定 CSS 规则，它被定义为相对于当前字体大小。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-10T16:15:13.137

我监控文本大小变化的动机是动态改变元素的高度（或宽度），这样整个页面就不需要浏览器窗口滚动条。通常，当您这样做时，您会响应 resize 事件，但字体大小更改也会影响您的计算。我不太关心实际的字体大小是多少，我只需要知道它什么时候改变。

这是我使用的一些 jQuery 代码。这类似于 bobince 建议的解决方案。我有一个调整大小的功能，它将更新 div 的高度等。

```
$(window).resize(resize); // update when user resizes the window.

$("body").append("<p id='textSizeReference' style='display:none;padding:0'>T</p>");
var refTextHeight = $("#textSizeReference").height();
setInterval(function() {
    var h = $("#textSizeReference").height();
    if (h != refTextHeight) {
        refTextHeight = h;
        resize(); // update when user changes text size
    }
}, 500); 
```

如果这是一个轮询 location.hash 更改的 ajax 应用程序，您可以使用相同的轮询函数来更改文本大小。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2011-07-07T11:53:09.153

这是我发现在 IE 中检测文档的当前字体系列时效果很好的东西：

document.documentElement.currentStyle["fontFamily"]

在 Firefox/Opera 中：

有一个名为 getComputedStyle 的方法应该返回给定特定元素的 css 样式，但我还没有找到一种方法让它返回整个文档。

希望这会有所帮助！

# javascript - 如何将 Django 中的数组传递给模板并将其与 JavaScript 一起使用

> ID：739942
> 
> 赞同：56
> 
> 时间：2009-04-11T12:02:06.533
> 
> 标签：javascript, django, django-templates

我想将数组传递给模板，然后通过 JavaScript 使用它。

在我的*views.py*中，我有：

```
arry1 = ['Str',500,20]
return render_to_response('test.html', {'array1': arry1}) 
```

在我的模板中：

```
var array1 = {{ array1 }}; 
```

但是当我访问该网站时，它会输出：

```
var array1 = [&#39;Str&#39;,500,20]; 
```

我必须改变什么？

* * *

## 回答 #1

> 赞同：108
> 
> 时间：2009-04-11T12:22:38.403

尝试使用`{{ array1|safe }}`，看看是否有什么不同。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-04-11T12:26:20.890

如前所述，您可以使用`|safe`过滤器，这样 Django 就不会清理数组并保持原样。

另一种选择，从长远来看可能更好的是使用`simplejson`模块（它包含在 django 中）将您的 Python 列表格式化为 JSON 对象，您可以在其中返回 Javascript。您可以像遍历任何数组一样遍历 JSON 对象。

```
from django.utils import simplejson
list = [1,2,3,'String1']
json_list = simplejson.dumps(list)
render_to_response(template_name, {'json_list': json_list}) 
```

在您的 Javascript 中，只需`{{ json_list }}`

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2013-01-25T20:47:12.017

**在 Django 中：**

```
from django.utils import simplejson
json_list = simplejson.dumps(YOUR_LIST) 
```

并在上下文中传递“json_list”

**在 JS 中：**

```
var YOUR_JS_LIST = {{YOUR_LIST|safe}}; 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2021-06-02T16:08:58.167

只需尝试替换`var array1 = {{ array1 }};`为`var array1 = '{{ array1|safe }}';`. 我不知道为什么，但这对我有用。 [![在此处输入图像描述](https://i.stack.imgur.com/Alk1m.png)](https://i.stack.imgur.com/Alk1m.png)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2022-01-25T17:12:46.767

不确定何时将其添加到 Django，相同结果的候选是[json-script](https://docs.djangoproject.com/en/dev/ref/templates/builtins/#json-script)：

> `{{ value|json_script:"hello-data" }}`
> 
> 如果 value 是字典 {'hello': 'world'}，输出将是：
> 
> `<script id="hello-data" type="application/json">{"hello": "world"}</script>`
> 
> 可以像这样在 JavaScript 中访问结果数据：
> 
> `const value = JSON.parse(document.getElementById('hello-data').textContent);`

在 4.0 之后的 Django 版本中，上述情况中的 ID 和“hello-data”将是可选的。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2016-05-20T06:30:54.253

它可以通过 django 核心序列化程序来完成。您需要做的就是在 json 中序列化您的数据，然后将其传递给模板。

```
data = serializers.serialize("json", <list>)
return render(request, 'view.html', {'data':data}) 
```

在您的模板中将此列表保存到 javascript 变量中。

```
var list = {{data|safe}} 
```

# asp.net - 用户控件 - 从 javascript 调用 vb 链接按钮的（在用户控件内）单击事件

> ID：739943
> 
> 赞同：0
> 
> 时间：2009-04-11T12:02:07.360
> 
> 标签：asp.net, javascript, vb.net, visual-studio-2008, user-controls

我如何`deleteevent()`从 usercontrol.ascx 中的 javascript 函数调用 VB 函数 - 在 usercontrol.ascx.vb`clickhandler(e)`中。**该调用应该会导致回发**，因为我需要用户控件来显示更改。

我目前正在尝试通过使用带有样式 display:none 的链接按钮并从 javascript 函数调用其单击事件来做到这一点。但我不知道如何调用点击事件。

我必须从 javascript 向 vb 函数传递一个值，但我正在使用隐藏字段来处理它。

环境是asp.net 3.0 语言：vb

谢谢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-11T12:11:52.250

检查这两个关于使用 JQuery 调用代码隐藏方法的链接：

[使用jQuery直接调用ASP.NET AJAX页面方法](http://encosia.com/2008/05/29/using-jquery-to-directly-call-aspnet-ajax-page-methods/)

[使用 jQuery 调用 ASP.NET AJAX 页面方法](http://weblogs.asp.net/craigshoemaker/archive/2008/09/29/using-jquery-to-call-asp-net-ajax-page-methods.aspx)

您应该调用 aspx 而不是 ascx 方法。因为在运行时所有用户控件 (ascx) 合并到您的页面 (aspx)。

如果您在一个页面中有一个具有多个实例的用户控件，您应该使用一个参数来定义每个用户控件中的方法的上下文。也许是用户控件的客户端 ID。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-14T10:04:45.370

这个有点棘手，但有点有趣。

基本上，您需要：

1.  在要引发事件的控件上实现 IPostBackEventHandler
2.  为控件创建回发引用
3.  通过超链接或 jscript 调用回发引用
4.  在后面的代码中，处理回发引用并调用您的代码

    ```
    Public Class MyControl
    Inherits UserControl
    Implements IPostBackEventHandler

    Public Sub RaisePostBackEvent(ByVal eventArgument As String) Implements System.Web.UI.IPostBackEventHandler.RaisePostBackEvent

        ' Call deleteEvent here
        DeleteEvent(eventArgument)  ' This will contain "SomeArgumentYouWantToPassToDeleteEvent"

    End Sub

    Protected Sub Page_Load(ByVal sender As Object, ByVal e As System.EventArgs)
        Dim cs As ClientScriptManager = Page.ClientScript

        Dim a As New HtmlAnchor()
        a.ID = "myanchor1"
        a.InnerText = "Delete Event"
        a.HRef = cs.GetPostBackClientHyperlink(Me, "SomeArgumentYouWantToPassToDeleteEvent")

        ' You could alternatively construct some jscript and output it.

        Controls.Add(a)

    End Sub
    End Class 
    ```

有关详细信息，请参阅此处：[ClientScriptManager.GetPostBackEventReference](http://msdn.microsoft.com/en-us/library/ms153112.aspx)

# c# - 如何查找类的对象是否存在

> ID：739944
> 
> 赞同：0
> 
> 时间：2009-04-11T12:02:28.187
> 
> 标签：c#, wpf, object, instanceof

在我的 ListBoxItem MouseEnter 事件中，我正在使用以下代码创建一个新窗口。

```
Window w = new Window();
w.Show(); 
```

当鼠标离开当前项目时，我想关闭窗口。

我怎么做？

非常感谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-11T12:05:35.340

将对窗口的引用（`w`在您的情况下）存储在 MouseEnter 和 MouseExit 的事件处理程序都可以访问它的地方，然后只需执行`w.Close()`.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T13:20:50.917

与其将 w 存储在局部变量中，不如将其存储在当前类的成员变量中。在 MouseExit 上，使用成员变量关闭窗口。

```
public partial class ListWindow
{
    Window displayWindow;

    public void OnListBoxItem_MouseEnter()
    {
        displayWindow = new Window();
        displayWindow.Show();
    }

    public void OnListBoxItem_MouseExit()
    {
        displayWindow.Close();
    }
} 
```

# regex - 为什么 Regex 完成 3000 行的 XML 文件非常慢？

> ID：739950
> 
> 赞同：1
> 
> 时间：2009-04-11T12:07:45.570
> 
> 标签：regex, regex-greedy

我注意到正则表达式完成一个包含 3000 行 [1] 的 XML 文件非常慢：

```
\(<Annotation\(\s*\w\+="[^"]\{-}"\s\{-}\)*>\)\@<=\(\(<\/Annotation\)\@!\_.\)\{-}"MATCH\_.\{-}\(<\/Annotation>\)\@= 
```

我一直认为正则表达式是有效的。为什么完成 Regex 需要这么长时间？

**[1]** [如何在 VIM 中从 A 到 B 重复匹配？](https://stackoverflow.com/questions/736376/how-can-i-repeatedly-match-from-a-until-b-in-vim)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-11T12:47:01.263

它是否有效取决于正则表达式本身。它使效率低下的是回溯。为了避免这种情况，正则表达式必须尽可能不同。

我们以正则表达式`a.*b`为例，将其应用于字符串`abcdef`。该算法将首先将文字`a`in匹配`a.*b`到`a`in `abcdef`。接下来`.*`将处理表达式。`bcdef`在正常的贪心模式下，乘数被扩大到最大值，它将匹配`abdef`. 最后一个文字`b`in`a.*b`将被处理。但是由于已经到达字符串的末尾并且正在使用乘法器，该算法将尝试回溯以匹配整个模式。`.*`( )的匹配`bcdef`将减少一个字符 ( `bcde`) 并且算法尝试遵守模式的其余部分。但是`b`in`a.*b`不匹配`f`在`abcdef`. So`.*`将再减少一个字符，直到它匹配空字符串（因此`.`重复零次）并且`b`in`a.*b`匹配`b`in `abcdef`。

如您所见，`a.*b`应用于整个正则表达式匹配之前`abdef`需要 6 种回溯方法。`.*`但是如果我们改变正则表达式并通过使用来区分它`a[^b]*b`，则不需要回溯，并且正则表达式可以在第一种方法中匹配。

如果你现在考虑改用惰性修饰符，我要告诉你，这条规则适用于每个修饰符，包括贪婪和惰性修饰符。不同之处在于不是首先将匹配扩展到最大值，而不是通过一次减少一个字符（贪婪）来进行回溯，惰性修饰符将首先扩展到最小匹配，而不是一次增加一个字符。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-11T12:33:48.860

REs*是*有效的，但它们不是魔法 :-)

让你慢下来的不是输入文件中的行数（3,000 是一个非常小的数字）。当一个 RE 被编译时，它基本上必须（从概念上）编写一个可以基于该 RE 解析输入文件的程序。

该“程序”的速度始终取决于 RE 的复杂性。

例如，`"^$"`会非常快，`"[0-9]{1,9}"`会稍微慢一些，任何涉及回溯（即，必须在 RE 中备份，通常任何涉及多个可变元素数子句的任何内容，您的就是一个例子）都将是还是慢点。

您可以采取任何措施预先减少行数，这在一定程度上会有所帮助，但对于优化 RE 本身，这通常被认为是一种黑色艺术。一种可能性是首先去除注释停止和开始的行之间的行以外的行。

我不太担心优化我的 RE（但它们通常不会这么复杂）。我的观点是，只要他们愿意，他们就会坚持下去。如果时间太长，我通常会寻找另一种更快但适应性不强的解决方案。

在您想要获取`about`属性包含 MATCH 的所有 Annotation XML 的 RE 的情况下，我会在 Perl 中进行（或者对于我们的老前辈来说是 awk :-)，因为输入文件的格式相当固定：

*   第一行 [a] 上的“<Annotation”。
*   “匹配”也在第一行 [a]。
*   </Annotation> 在最后一行和它自己的 [b]。

这将是一个简单的线扫描仪，在满足 [a] 条件时打开回显（并打印该行），在回显打开时打印任何其他行，并在满足 [b] 条件时关闭回显（在印刷线）。

是的，适应性要差得多，但几乎可以肯定更快（鉴于您的输入格式正确）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-11T13:02:36.187

我发现很难用所有反斜杠阅读你的正则表达式；如果我正确解释了这种正则表达式（vim？）的方言，那么您所说的是详细的 pcre 会拼写什么：

```
(?<= <Annotation(\s*\w+="[^"]*?"\s*?)*> )
    ((?! <\/Annotation).)*?
    "MATCH.*?
(?= <\/Annotation> ) 
```

一个明显的问题是它以可变长度的lookbehind断言开始。可变长度的lookbehind 已经够麻烦了（并且在许多正则表达式方言中不支持），但是它后面跟着一个自由匹配（任何带有否定lookahead 的字符）。

这对于处理器来说*很难*匹配；这种组合几乎扼杀了它可能实现的任何可能的优化。对于文件中的每个字符，它必须回溯（可能到文件开头/前一个匹配的结尾）以查看后向是否匹配，然后向前（可能到文件末尾）查找“MATCH.

您可以通过仅使用固定大小的后视来帮助它，或者只是忘记环视并在匹配中包含整个字符串，这将更有效地查找，但需要更多的后处理来挑选您感兴趣的组。

```
<Annotation(\s+(\w+="[^"]))*\s*>
    (.*? "MATCH .*?)
<Annotation> 
```

但是，与此类问题一样，Clippy sez：

> 看起来您正在使用正则表达式解析 XML。
> 
> 你需要帮助吗？
> 
> ( ) 使用真正的 XML 解析器，因为正则表达式天生无法解析 XML
> 
> （）只是士兵制作仍然无法工作的难以理解的复杂正则表达式
> 
> [ ] 不要再给我看这个提示

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T12:52:02.403

“正则表达式是有效的”是一个太宽泛的描述，不准确。如果您忽略不同正则表达式引擎提供的相对性能的差异，那么您的正则表达式的效率仍然取决于模式的复杂性。

正则表达式在更快地失败时是有效的，而不是成功地更快地匹配部分文本。IOW，它需要足够具体，以便不完全匹配的文本应该在匹配过程的早期被拒绝，而不是到达结尾。这也意味着需要最小化回溯。请注意，回溯可能会达到[灾难性水平](http://www.regular-expressions.info/catastrophic.html)，即使是最好的 Regex 引擎也会冻结。在 Jan Goyvaerts 提供的示例中，文件的大小甚至没有被提及并且不相关。然而，重要的是字符串的大小。

这是我几年前在 RegexAdvice.com 上开始[的一个讨论线程，试图让人们讨论正则表达式的性能。](http://regexadvice.com/forums/thread/15742.aspx)我想它确实有一些值得学习的地方。

# java - 可以使用哪种机制来访问与 JavaScript 关键字冲突的 Java 方法？

> ID：739951
> 
> 赞同：0
> 
> 时间：2009-04-11T12:08:23.243
> 
> 标签：java, javascript, javafx, interop

我有一个 Javascript 源，它使用定义“删除”方法的 Java 类（使用 jdk6 脚本）。由于 delete 是一个关键字，我无法调用该方法。

在 JavaFX 脚本中，任何包含在 <> 中的字符序列都被视为词法标识符。因此，您可以使用关键字“insert”作为标识符：

```
var textField = new javax.swing.JTextField();
textField.<<insert>>("Hello World"); 
```

Javascript提供了一种保护关键字的方法？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-11T13:08:33.050

在javascript中你会这样做：

```
textField["insert"]("Hello World"); 
```

# .net - C++/CLI：链接器为 win32 函数提供“未解析的令牌”

> ID：739952
> 
> 赞同：2
> 
> 时间：2009-04-11T12:09:32.443
> 
> 标签：.net, visual-studio, c++-cli

伙计们，

我刚刚创建了我的第一个 C++/CLI 项目 (Visual Studio 2008)，它是一个库，允许我的 C# 应用程序访问销售点计数打印机。

当从 C# exe 调用时，我的库构建良好，并且琐碎的函数可以正常工作。

但是，一旦我包含 WinGDI 调用（在本例中为[DeleteObject](http://msdn.microsoft.com/en-us/library/dd183539(VS.85).aspx)），链接器就会抱怨“未解析的令牌”错误。

> 错误 2 错误 LNK2028：未解析的令牌 (0A000088) "extern "C" int __stdcall DeleteObject(void *)" (?DeleteObject@@$$J14YGHPAX@Z) 在函数 "private: __clrcall ReceiptPrinter::Epson::~Epson( void)" (??1Epson@ReceiptPrinter@@$$FA$AAM@XZ) ReceiptPrinter.obj ReceiptPrinter

在过去的 4 年里，我没有做过任何严肃的 C++，而且我对 MS C++ 编译器的经验也很少，因此我不知道我在链接器设置中寻找什么。

任何帮助都将受到极大的欢迎。

谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-11T12:28:17.687

> 其他依赖项是“NoInherit”，当我查看“设置”时，有一个库列表，gdi32.lib 在列表中。我检查了“从父项目继承”，它现在可以工作了。德克，如果您将所有这些都添加为答案，我会选择它并给您代表。

检查链接器命令行中是否存在 Gdi32.lib（属性 > 链接器 > 命令行）。

（你去——你已经成功地吸引了我自私、寻求代表的灵魂；））

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-11T12:22:18.123

您应该将您的 dll 与 Gdi32.lib 链接。

您可以使用#pragma comment(lib, "gdi32.lib") 或在链接器下的项目设置中执行此操作。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-10-24T13:32:19.143

线索在函数声明的 __clrcall 修饰符中。默认情况下，您的 Windows 窗体应用程序使用纯公共语言运行时代码和调用约定。您链接到的外部库没有。您需要将项目属性的项目默认值区域中的公共语言运行时支持设置从 /clr:pure 更改为 /clr。这对我有用。

# drupal - Drupal 中的面板模板重用

> ID：739956
> 
> 赞同：1
> 
> 时间：2009-04-11T12:11:37.430
> 
> 标签：drupal

如何在 Drupal中创建[面板模板（使用面板模块）？](http://drupal.org/project/panels)我问这个的原因是因为我有一个面板模板来显示不同院系的信息。每个教师将具有相同的页面布局，但页面内显示的信息将是教师特定的。

所以我正在考虑通过url将参数传递到面板模板中，内容将根据给定的参数显示。

有任何想法吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-12-08T22:32:47.223

这无疑是一个[冷案](http://en.wikipedia.org/wiki/Cold_case)，但我会试一试，因为到目前为止没有其他人回答，而且答案对我来说似乎很简单！（也许我错过了什么？）

我会说您应该**在 panel 中定义一个上下文**，以便显示的所有位都能够引用相同的功能*并*呈现正确的内容（这确实是 panel 相对于块的主要优势之一，它确实不知道页面上的其余内容是什么）。

虽然这是一个老问题 - 因此您肯定已经选择并完成了您的设计 - 从您的问题中我想知道您是否真的必须使用面板，或者您是否可以达到相同的结果（但以一种资源较少的方式，对于繁忙的大学网站可能是一个优势）通过实现一个视图，该视图将显示有关教师的核心信息，并将使用分类过滤链接节点（分类中的术语可以是“医学”、“法律”、“工程”.. .)

嗯……谁知道？我希望至少 OP 会看到这个答案及时丢失了一个老问题...... ;)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-01-23T01:36:35.457

对于搜索者......您确实可以拥有一个包含多个变体的面板。每个变体都由特定的页面 URL 定义。就是这样：

1.  定义一个面板。给它一个路径，例如 myportal，例如对于 DNS 为 www.mysite.com 的站点，面板根目录的路径将是 www.mysite.com/myportal，您只需指定 myportal 作为路径
2.  为路径上的一个页面定义一个变体，例如 pageFlavorX。定义变体时，选中选择规则框
3.  对于选择规则，选择 String:URL 路径。对于路径（使用我们的示例），输入来自 DNS 的完整路径，例如，您将输入 myportal/pageFlavorX
4.  对于变体，配置您的布局和内容
5.  配置您的其他变体，随时保存和测试。例如，要测试您的第一个变体，您将打开一个浏览器选项卡并点击[http://www.mysite.com/myportal/pageFlavorX](http://www.mysite.com/myportal/pageFlavorX)

# mysql - 是什么导致 MyISAM 腐败？

> ID：739958
> 
> 赞同：4
> 
> 时间：2009-04-11T12:12:29.490
> 
> 标签：mysql, myisam

我听说 MyISAM 表可能会损坏，哪种操作最有可能损坏它们，以及如何安全地修复所述损坏。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-11T12:16:05.673

MySQL 文档对此非常明确： http: [//dev.mysql.com/doc/refman/5.1/en/corrupted-myisam-tables.html](http://dev.mysql.com/doc/refman/5.1/en/corrupted-myisam-tables.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-11T14:14:04.377

我有一个生产服务器，如果发生冷重置（例如电源故障），更新过程中的所有 MyISAM 表都会损坏。**mysqlcheck**解决了这个问题。我建议将带有 --auto-repair 选项的**mysqlcheck**放在cron 中，以修复在运行时发生的罕见损坏情况。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-11T13:10:12.190

我有时会收到 MyISAM 损坏。在我的服务器上，问题是非常重的负载，可能会使 MySQL 不堪重负，导致它挂起。这就是现实世界中发生的事情；）

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-11T12:40:08.160

MyISAM 的另一个问题（虽然严格意义上不是真正的数据库损坏）是它不能正确支持事务（提交 - 回滚）。

这**也**可能迟早导致数据完整性问题（取决于数据库层实施的质量）。

在我看来，这使得MySQL 中的“快速”MyISAM**后端仅适用于非常简单或非常小的数据库......**

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2019-01-13T21:19:34.520

据我所知，我发现电源故障或同步突然失败会导致 Myisam 数据损坏。

切换到 innodb 将是这里的最佳选择。

# regex - 我什么时候应该使用解析器？

> ID：739983
> 
> 赞同：8
> 
> 时间：2009-04-11T12:28:58.310
> 
> 标签：regex, parsing

我在正则表达式中遇到了将代码划分为功能组件的问题。它们可能会断裂，或者它们可能需要很长时间才能完成。经验提出了一个问题：

> “我什么时候应该使用解析器？”

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-11T12:35:19.887

*当您对 text 的词汇或语义含义*感兴趣时，您应该使用解析器，而模式可能会有所不同。*当您只是想匹配或替换字符模式时*，无论其功能意义如何，解析器通常都会过度使用。

在您的情况下，您似乎对文本背后的含义（代码的“功能组件”）感兴趣，因此解析器将是更好的选择。但是，解析器可以在内部使用正则表达式，因此不应将它们视为互斥的。

* * *

然而，“解析器”并不意味着它必须是复杂的。例如，如果您对 C 代码块感兴趣，您可以简单地解析 { 和 } 的嵌套组。这个解析器只对两个标记（'{' 和 '}'）以及它们之间的文本块感兴趣。

但是，由于嵌套语义，简单的正则表达式比较在这里是不够的。采取以下代码：

```
void Foo(bool Bar)
{
    if(Bar)
    {
        f();
    }
    else
    {
        g();
    }
} 
```

解析器将了解 Foo 的整体范围，以及 Foo 中包含的每个内部范围（if 和 else 块）。当它遇到每个'{'标记时，它“理解”它们的含义。然而，一个简单的搜索并不能理解文本背后的含义，可能会将以下内容解释为一个块，我们当然知道这是不正确的：

```
{
    if(Bar)
    {
        f();
    } 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-11T14:10:41.467

在以下情况下需要解析器：

1.  语言不规则（[维基百科](http://en.wikipedia.org/wiki/Regular_language)）
2.  您需要一个解析树（更一般地，当您需要根据上下文执行操作时）
3.  当生成的正则表达式太晦涩/复杂时

我的 2 美分。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-11T12:39:33.213

解析器在正则表达式上有一些引人注目的用例。您应该使用解析器而不是正则表达式：

*   每当您想要使用的表达式类型比少数语义实体（标签、变量、电话号码等）更复杂时。
*   每当您需要知道文本的语义而不是仅仅匹配一个模式时。例如，如果您尝试匹配所有可能的电话号码书写方式，则解析器可能比正则表达式更好。如果您尝试匹配恰好对应于电话号码的特定模式，则正则表达式可能没问题。
*   每当输入不能保证格式正确时。
*   如果您完全在具有语法规范（C#、XML、C++、Ruby 等）的定义明确的语言的结构中工作，那么已经有了解析器，因此您已经完成了一些工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-12T23:09:04.050

[Dragon Book](http://en.wikipedia.org/wiki/Compilers:_Principles,_Techniques,_and_Tools)有一小部分介绍了您不能将正则表达式用于什么：

*   他们无法检测到字符串的重复，这意味着您无法匹配像“wcw”这样的结构，其中 w 是相同的符号连续
*   只能检测固定的重复次数或未指定的重复次数，也就是说不能使用已经解析过的token来确定重复次数，比如：'n s1 s2 ... sn'
*   “正则表达式不能用于描述平衡或嵌套结构，[比如]所有平衡括号的字符串集”

* * *

对于 1 和 2，有一个简单的解释，你不能*捕获*一个子字符串，所以你可以稍后匹配它。如果您愿意，那么您将使用解析器。想想你将如何在这些情况下使用正则表达式，你会直观地得出你做不到的结论。:)

对于 3，它与 K&R 中解析字符串文字的问题相同。您不能只说字符串文字位于第一个 ' " ' 和第二个 ' " ' 之间，但是当存在转义引号 (\") 时会发生什么？

至于与罗素悖论的关系，我认为你的直觉是对的，因为问题在于正则表达式的自省能力有限。书中引用了证明。如果你愿意，我可以帮你查。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-11T12:36:56.060

一旦遇到正则表达式不打算（或根本不能）解决的问题，您就需要使用解析器。例如，匹配（非）平衡括号（递归）就是这些问题之一。尽管有些风格，比如 PCRE，让你走得很远，但它们并不能胜过手写的解析器。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-11T13:09:23.470

以下是一些用例，由 Steve Yegge：[Rich Programmer Food](http://steve-yegge.blogspot.com/2007/06/rich-programmer-food.html)提供。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-11T12:36:34.157

你的问题有点含糊，但我想我的观点是，当你的正则表达式变得复杂或花费太长时间，并且你有一个合理定义的“语言”来处理时，解析器会更容易。

我不认为你可以在沙子上划出一条线，说一方面任何事情都可以通过正则表达式来完成，另一方面你需要一个解析器。这取决于实际情况。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-12T23:19:12.403

有些事情是正则表达式不能做而解析器可以做的。
例如：

开始 ::= (内部);
内部 ::= 开始 | X;

正则表达式无法做到这一点，因为正则表达式无法跟踪是否有相同数量的开括号和右括号。这就是为什么当您尝试标记和解析大文件时，预计会使用解析器，而正则表达式可以简单地在文件中找到特殊模式。

# wpf - 在按钮单击时对 WPF ListBox 进行排序？

> ID：739988
> 
> 赞同：3
> 
> 时间：2009-04-11T12:32:13.653
> 
> 标签：wpf, vb.net, sorting, listbox

首先让我说我对编码很陌生，所以我的知识存在很大差距......任何人：

对，我试图在单击按钮时对 WPF 列表框进行排序，最好是在纯 xaml 中（否则为 VB）。我很难看到大多数示例都是用 C# 编写的。这是我的代码：

```
 <Grid.Resources>
      <CollectionViewSource x:Key="myCollectionView"
                            Source="{Binding Path=Query4, Source={x:Static Application.Current}}" >
           <CollectionViewSource.SortDescriptions>
                <scm:SortDescription PropertyName="ContactID"
                                     Direction="Descending"/>
           </CollectionViewSource.SortDescriptions>
      </CollectionViewSource>
</Grid.Resources>

<ListBox x:Name="ContDefault"
         IsSynchronizedWithCurrentItem="True"
         ItemsSource="{Binding Source={StaticResource myCollectionView}}"
         ItemTemplate="{StaticResource ContactsList}" /> 
```

现在，我想做的是添加一个按钮，如下所示：

```
 <Button x:Name="SortNameAsc"
         Content="Sort By Name"
         Visibility="Visible"> 
```

现在，当单击此按钮时，我希望列表框按“名字”字段排序，我假设我必须以某种方式更改排序描述，所以有人能告诉我怎么做吗？还是我要走这条老路。再次优选在 XAML 中，但如果需要在 VB 中，您可以尝试保持简单吗？

多谢你们

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T09:06:29.497

希望它有所帮助：谷歌想出了这个（[http://www.kudzuworld.com/blogs/Tech/20070815A.en.aspx](http://www.kudzuworld.com/blogs/Tech/20070815A.en.aspx)）

```
ListCollectionView view = new ListCollectionView(channel.Members);
view.SortDescriptions.Add(new System.ComponentModel.SortDescription("lastName",
  System.ComponentModel.ListSortDirection.Ascending);
view.SortDescriptions.Add(new System.ComponentModel.SortDescription("firstName",
  System.ComponentModel.ListSortDirection.Ascending); 
view.CustomSort = new IComprarerImplementation; //Do this if you want a custom sort;
view.Refresh(); 
```

Regarding Example 3 this should be correct:

```
<ListBox x:Name="ContDefault"
         IsSynchronizedWithCurrentItem="True"
         ItemsSource="{Binding Source={StaticResource myCollectionView}}"
         ItemTemplate="{StaticResource ContactsList}"
         SortDescription="First Name" /> 
```

# python - 如何获取本地安装的 Python 模块的列表？

> ID：739993
> 
> 赞同：1134
> 
> 时间：2009-04-11T12:34:18.360
> 
> 标签：python, module, pip

我想获取 Python 安装（UNIX 服务器）中的 Python 模块列表。

如何获取计算机中安装的 Python 模块列表？

* * *

## 回答 #1

> 赞同：1167
> 
> 时间：2009-04-11T12:45:45.307

```
help('modules') 
```

在 Python 外壳/提示中。

* * *

## 回答 #2

> 赞同：650
> 
> 时间：2014-05-27T09:05:42.540

## 解决方案

# 不要与 pip > 10.0 一起使用！

从 Python 脚本中获取类似`pip freeze`列表的 50 美分：

```
import pip
installed_packages = pip.get_installed_distributions()
installed_packages_list = sorted(["%s==%s" % (i.key, i.version)
     for i in installed_packages])
print(installed_packages_list) 
```

作为（太长）一个班轮：

```
sorted(["%s==%s" % (i.key, i.version) for i in pip.get_installed_distributions()]) 
```

给予：

```
['behave==1.2.4', 'enum34==1.0', 'flask==0.10.1', 'itsdangerous==0.24', 
 'jinja2==2.7.2', 'jsonschema==2.3.0', 'markupsafe==0.23', 'nose==1.3.3', 
 'parse-type==0.3.4', 'parse==1.6.4', 'prettytable==0.7.2', 'requests==2.3.0',
 'six==1.6.1', 'vioozer-metadata==0.1', 'vioozer-users-server==0.1', 
 'werkzeug==0.9.4'] 
```

## 范围

`setuptools`此解决方案适用于系统范围或虚拟环境范围，并涵盖由,`pip`和 ( [god forbid](https://stackoverflow.com/questions/3220404/why-use-pip-over-easy-install) )安装的软件包`easy_install`。

## 我的用例

我将此调用的结果添加到了我的烧瓶服务器，所以当我调用它时，`http://example.com/exampleServer/environment`我得到了安装在服务器的 virtualenv 上的软件包列表。它使调试变得更加容易。

## 注意事项

我注意到这种技术的一个奇怪行为 - 当 Python 解释器在与`setup.py`文件相同的目录中被调用时，它不会列出由`setup.py`.

### 重现步骤：

创建虚拟环境

```
$ cd /tmp
$ virtualenv test_env
New python executable in test_env/bin/python
Installing setuptools, pip...done.
$ source test_env/bin/activate
(test_env) $ 
```

克隆一个 git repo`setup.py`

```
(test_env) $ git clone https://github.com/behave/behave.git
Cloning into 'behave'...
remote: Reusing existing pack: 4350, done.
remote: Total 4350 (delta 0), reused 0 (delta 0)
Receiving objects: 100% (4350/4350), 1.85 MiB | 418.00 KiB/s, done.
Resolving deltas: 100% (2388/2388), done.
Checking connectivity... done. 
```

我们有表现`setup.py`在`/tmp/behave`：

```
(test_env) $ ls /tmp/behave/setup.py
/tmp/behave/setup.py 
```

从 git repo 安装 python 包

```
(test_env) $ cd /tmp/behave && pip install . 
running install
...
Installed /private/tmp/test_env/lib/python2.7/site-packages/enum34-1.0-py2.7.egg
Finished processing dependencies for behave==1.2.5a1 
```

### 如果我们从`/tmp`

```
>>> import pip
>>> sorted(["%s==%s" % (i.key, i.version) for i in pip.get_installed_distributions()])
['behave==1.2.5a1', 'enum34==1.0', 'parse-type==0.3.4', 'parse==1.6.4', 'six==1.6.1']
>>> import os
>>> os.getcwd()
'/private/tmp' 
```

### 如果我们从`/tmp/behave`

```
>>> import pip
>>> sorted(["%s==%s" % (i.key, i.version) for i in pip.get_installed_distributions()])
['enum34==1.0', 'parse-type==0.3.4', 'parse==1.6.4', 'six==1.6.1']
>>> import os
>>> os.getcwd()
'/private/tmp/behave' 
```

`behave==1.2.5a1`第二个示例中缺少，因为工作目录包含`behave`的`setup.py`文件。

我在文档中找不到对此问题的任何参考。也许我会为它打开一个错误。

* * *

## 回答 #3

> 赞同：321
> 
> 时间：2011-01-16T03:42:15.970

现在，我自己尝试了这些方法，我得到了宣传的内容：所有模块。

唉，你真的不太关心标准库，你知道安装 python 会得到什么。

*真的，我想要我*安装的东西。

实际上，令人惊讶的是，工作得很好的是：

```
pip freeze 
```

哪个返回：

```
Fabric==0.9.3
apache-libcloud==0.4.0
bzr==2.3b4
distribute==0.6.14
docutils==0.7
greenlet==0.3.1
ipython==0.10.1
iterpipes==0.4
libxml2-python==2.6.21 
```

我说“令人惊讶”是因为软件包安装工具正是人们期望找到此功能的确切位置，虽然不是以“冻结”的名义，但 python 打包是如此奇怪，以至于我惊讶于这个工具是有意义的。点 0.8.2，Python 2.7。

* * *

## 回答 #4

> 赞同：132
> 
> 时间：2013-07-25T22:56:32.387

从 pip 1.3 版开始，您可以访问：

```
pip list 
```

这似乎是“pip freeze”的语法糖。它将列出特定于您的安装或 virtualenv 的所有模块，以及它们的版本号。不幸的是，它不会显示任何模块的当前版本号，也不会洗碗或擦鞋。

* * *

## 回答 #5

> 赞同：94
> 
> 时间：2012-02-08T13:24:27.897

*   [`ipython`](http://ipython.org/)你可以在里面输入“ `import``Tab`”。

*   在标准 Python 解释器中，您可以键入“ `help('modules')`”。

*   在命令行中，您可以使用.[`pydoc`](http://docs.python.org/library/pydoc.html) `modules`

*   在脚本中，调用[`pkgutil.iter_modules()`](http://docs.python.org/library/pkgutil.html#pkgutil.iter_modules).

* * *

## 回答 #6

> 赞同：89
> 
> 时间：2012-06-22T22:02:06.130

我只是用它来查看当前使用的模块：

```
import sys as s
s.modules.keys() 
```

它显示了在你的 python 上运行的所有模块。

对于所有内置模块，请使用：

```
s.modules 
```

这是一个包含所有模块和导入对象的字典。

* * *

## 回答 #7

> 赞同：64
> 
> 时间：2013-08-23T09:45:31.870

在普通外壳中只需使用

```
pydoc modules 
```

* * *

## 回答 #8

> 赞同：57
> 
> 时间：2018-04-25T02:58:49.393

从 pip 10 开始，接受的答案将不再有效。开发团队已删除对`get_installed_distributions`例程的访问权限。在 for 中有一个替代函数`setuptools`做同样的事情。这是与 pip 10 一起使用的替代版本：

```
import pkg_resources
installed_packages = pkg_resources.working_set
installed_packages_list = sorted(["%s==%s" % (i.key, i.version)
     for i in installed_packages])
print(installed_packages_list) 
```

请让我知道它是否也适用于以前版本的 pip。

* * *

## 回答 #9

> 赞同：36
> 
> 时间：2014-01-02T09:26:40.460

如果我们需要在 Python shell 中列出已安装的包，可以使用`help`如下命令

```
>>> help('modules package') 
```

* * *

## 回答 #10

> 赞同：36
> 
> 时间：2020-04-03T15:37:56.540

## 无论 Pip 版本如何均有效

在您的 python 编辑器或 IPython 中运行以下命令：

```
import pkg_resources
installed_packages = {d.project_name: d.version for d in pkg_resources.working_set}
print(installed_packages) 
```

阅读其他答案并将这个组合放在一起，这是*Python*中最快和最简单的。

### 查找特定的包

然后，您可以方便地从您的字典中轻松获取项目，即

`installed_packages['pandas']`>> '1.16.4'

### 很好地使用点子列表

`!pip list`如果在那里工作，将在您的 jupyter 笔记本中运行，简化“快速检查”结合其他实用程序，如 grep（如果您已安装） `pip list | grep pandas` 将获得您当前的 pandas 版本，例如

* * *

## 回答 #11

> 赞同：25
> 
> 时间：2018-07-06T19:10:03.770

我通常`pip list`用来获取软件包列表（带有版本）。

当然，这也适用于虚拟环境。要显示仅在虚拟环境（而不是全局包）中安装的内容，请使用`pip list --local`.

[这是](https://pip.pypa.io/en/stable/reference/pip_list/)显示所有可用`pip list`选项的文档，并带有几个很好的示例。

* * *

## 回答 #12

> 赞同：18
> 
> 时间：2019-08-06T06:48:39.940

# 这将有助于

在终端或 IPython 中，键入：

```
help('modules') 
```

然后

```
In [1]: import                      #import press-TAB
Display all 631 possibilities? (y or n)
ANSI                   audiodev               markupbase
AptUrl                 audioop                markupsafe
ArgImagePlugin         avahi                  marshal
BaseHTTPServer         axi                    math
Bastion                base64                 md5
BdfFontFile            bdb                    mhlib
BmpImagePlugin         binascii               mimetools
BufrStubImagePlugin    binhex                 mimetypes
CDDB                   bisect                 mimify
CDROM                  bonobo                 mmap
CGIHTTPServer          brlapi                 mmkeys
Canvas                 bsddb                  modulefinder
CommandNotFound        butterfly              multifile
ConfigParser           bz2                    multiprocessing
ContainerIO            cPickle                musicbrainz2
Cookie                 cProfile               mutagen
Crypto                 cStringIO              mutex
CurImagePlugin         cairo                  mx
DLFCN                  calendar               netrc
DcxImagePlugin         cdrom                  new
Dialog                 cgi                    nis
DiscID                 cgitb                  nntplib
DistUpgrade            checkbox               ntpath 
```

* * *

## 回答 #13

> 赞同：17
> 
> 时间：2019-06-18T03:21:20.380

试试这些

```
pip list 
```

或者

```
pip freeze 
```

* * *

## 回答 #14

> 赞同：14
> 
> 时间：2012-05-12T12:34:44.393

[使用pkgutil.iter_modules](http://docs.python.org/library/pkgutil.html#pkgutil.iter_modules)进行非常简单的搜索

```
from pkgutil import iter_modules
a=iter_modules()
while True:
    try: x=a.next()
    except: break
    if 'searchstr' in x[1]: print x[1] 
```

* * *

## 回答 #15

> 赞同：13
> 
> 时间：2015-12-11T13:26:27.980

on windows, Enter this in cmd

```
c:\python\libs>python -m pip freeze 
```

* * *

## 回答 #16

> 赞同：12
> 
> 时间：2012-08-24T10:28:05.147

我在 OS X 上遇到了自定义安装的 python 2.7。它需要 X11 列出已安装的模块（使用帮助和 pydoc）。

为了能够在不安装 X11 的情况下列出所有模块，我将 pydoc 作为 http-server 运行，即：

```
pydoc -p 12345 
```

然后可以指示 Safari`http://localhost:12345/`查看所有模块。

* * *

## 回答 #17

> 赞同：10
> 
> 时间：2018-12-16T18:48:43.460

**警告：Adam Matan 不鼓励在 pip > 10.0 中使用这种方法。另外，请阅读下面@sinoroc 的评论**

这是受到 Adam Matan 的[回答](https://stackoverflow.com/a/23885252/277267)（被接受的回答）的启发：

```
import tabulate
try:
  from pip import get_installed_distributions
except:
  from pip._internal.utils.misc import get_installed_distributions

tabpackages = []
for _, package in sorted([('%s %s' % (i.location, i.key), i) for i in get_installed_distributions()]):
  tabpackages.append([package.location, package.key, package.version])

print(tabulate.tabulate(tabpackages)) 
```

然后以以下形式打印出一个表格

```
19:33 pi@rpi-v3 [iot-wifi-2] ~/python$ python installed_packages.py
-------------------------------------------  --------------  ------
/home/pi/.local/lib/python2.7/site-packages  enum-compat     0.0.2
/home/pi/.local/lib/python2.7/site-packages  enum34          1.1.6
/home/pi/.local/lib/python2.7/site-packages  pexpect         4.2.1
/home/pi/.local/lib/python2.7/site-packages  ptyprocess      0.5.2
/home/pi/.local/lib/python2.7/site-packages  pygatt          3.2.0
/home/pi/.local/lib/python2.7/site-packages  pyserial        3.4
/usr/local/lib/python2.7/dist-packages       bluepy          1.1.1
/usr/local/lib/python2.7/dist-packages       click           6.7
/usr/local/lib/python2.7/dist-packages       click-datetime  0.2
/usr/local/lib/python2.7/dist-packages       construct       2.8.21
/usr/local/lib/python2.7/dist-packages       pyaudio         0.2.11
/usr/local/lib/python2.7/dist-packages       tabulate        0.8.2
-------------------------------------------  --------------  ------ 
```

然后，您可以轻松辨别您安装了哪些软件包，其中包含和不包含`sudo`.

* * *

顺便说一句：我注意到，当我安装一个数据包一次通过`sudo`和一次不安装时，一个优先，因此另一个没有被列出（只显示一个位置）。我相信只有本地目录中的一个被列出。这可以改进。

* * *

## 回答 #18

> 赞同：9
> 
> 时间：2017-03-08T14:25:43.143

此解决方案主要基于模块`importlib`，`pkgutil`可与 CPython 3.4 和 CPython 3.5 一起使用，但不支持 CPython 2。

* * *

**解释**

1.  `sys.builtin_module_names`- 命名所有内置模块（[在这里](https://stackoverflow.com/a/42673644/6003870)查看我的答案）
2.  `pkgutil.iter_modules()`- 返回有关所有可用模块的信息
3.  `importlib.util.find_spec()`- 返回有关导入模块的信息（如果存在）
4.  `BuiltinImporter`- 内置模块的导入器（[文档](https://docs.python.org/3/library/importlib.html#importlib.machinery.BuiltinImporter)）
5.  `SourceFileLoader`- 标准 Python 模块的导入器（默认扩展名为 *.py）（[文档](https://docs.python.org/3/library/importlib.html#importlib.machinery.SourceFileLoader)）
6.  `ExtensionFileLoader`- 作为[共享库](http://www.cprogramming.com/tutorial/shared-libraries-linux-gcc.html)的模块导入器（使用 C 或 C++ 编写）

* * *

**完整代码**

```
import sys
import os
import shutil
import pkgutil
import importlib
import collections

if sys.version_info.major == 2:
    raise NotImplementedError('CPython 2 is not supported yet')

def main():

    # name this file (module)
    this_module_name = os.path.basename(__file__).rsplit('.')[0]

    # dict for loaders with their modules
    loaders = collections.OrderedDict()

    # names`s of build-in modules
    for module_name in sys.builtin_module_names:

        # find an information about a module by name
        module = importlib.util.find_spec(module_name)

        # add a key about a loader in the dict, if not exists yet
        if module.loader not in loaders:
            loaders[module.loader] = []

        # add a name and a location about imported module in the dict
        loaders[module.loader].append((module.name, module.origin))

    # all available non-build-in modules
    for module_name in pkgutil.iter_modules():

        # ignore this module
        if this_module_name == module_name[1]:
            continue

        # find an information about a module by name
        module = importlib.util.find_spec(module_name[1])

        # add a key about a loader in the dict, if not exists yet
        loader = type(module.loader)
        if loader not in loaders:
            loaders[loader] = []

        # add a name and a location about imported module in the dict
        loaders[loader].append((module.name, module.origin))

    # pretty print
    line = '-' * shutil.get_terminal_size().columns
    for loader, modules in loaders.items():
        print('{0}\n{1}: {2}\n{0}'.format(line, len(modules), loader))
        for module in modules:
            print('{0:30} | {1}'.format(module[0], module[1]))

if __name__ == '__main__':
    main() 
```

* * *

**用法**

对于 CPython3.5（截断）

```
$ python3.5 python_modules_info.py 
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
30: <class '_frozen_importlib.BuiltinImporter'>
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
_ast                           | built-in
_codecs                        | built-in
_collections                   | built-in
_functools                     | built-in
_imp                           | None
_io                            | built-in
_locale                        | built-in
_operator                      | built-in
_signal                        | built-in
_sre                           | built-in
_stat                          | built-in
_string                        | built-in
_symtable                      | built-in
_thread                        | built-in
(****************************truncated*******************************)
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
227: <class '_frozen_importlib_external.SourceFileLoader'>
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
__future__                     | /usr/local/lib/python3.5/__future__.py
_bootlocale                    | /usr/local/lib/python3.5/_bootlocale.py
_collections_abc               | /usr/local/lib/python3.5/_collections_abc.py
_compat_pickle                 | /usr/local/lib/python3.5/_compat_pickle.py
_compression                   | /usr/local/lib/python3.5/_compression.py
_dummy_thread                  | /usr/local/lib/python3.5/_dummy_thread.py
_markupbase                    | /usr/local/lib/python3.5/_markupbase.py
_osx_support                   | /usr/local/lib/python3.5/_osx_support.py
_pydecimal                     | /usr/local/lib/python3.5/_pydecimal.py
_pyio                          | /usr/local/lib/python3.5/_pyio.py
_sitebuiltins                  | /usr/local/lib/python3.5/_sitebuiltins.py
(****************************truncated*******************************)
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
64: <class '_frozen_importlib_external.ExtensionFileLoader'>
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
_bisect                        | /usr/local/lib/python3.5/lib-dynload/_bisect.cpython-35m-x86_64-linux-gnu.so
_bz2                           | /usr/local/lib/python3.5/lib-dynload/_bz2.cpython-35m-x86_64-linux-gnu.so
_codecs_cn                     | /usr/local/lib/python3.5/lib-dynload/_codecs_cn.cpython-35m-x86_64-linux-gnu.so
_codecs_hk                     | /usr/local/lib/python3.5/lib-dynload/_codecs_hk.cpython-35m-x86_64-linux-gnu.so
_codecs_iso2022                | /usr/local/lib/python3.5/lib-dynload/_codecs_iso2022.cpython-35m-x86_64-linux-gnu.so
(****************************truncated*******************************) 
```

对于 CPython3.4（截断）

```
$ python3.4 python_modules_info.py
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
54: <class '_frozen_importlib.BuiltinImporter'>
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
_ast                           | built-in
_bisect                        | built-in
_codecs                        | built-in
_collections                   | built-in
_datetime                      | built-in
_elementtree                   | built-in
_functools                     | built-in
_heapq                         | built-in
_imp                           | None
_io                            | built-in
_locale                        | built-in
_md5                           | built-in
_operator                      | built-in
_pickle                        | built-in
_posixsubprocess               | built-in
_random                        | built-in
(****************************truncated*******************************)
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
246: <class '_frozen_importlib.SourceFileLoader'>
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
__future__                     | /usr/lib/python3.4/__future__.py
_bootlocale                    | /usr/lib/python3.4/_bootlocale.py
_collections_abc               | /usr/lib/python3.4/_collections_abc.py
_compat_pickle                 | /usr/lib/python3.4/_compat_pickle.py
_dummy_thread                  | /usr/lib/python3.4/_dummy_thread.py
_markupbase                    | /usr/lib/python3.4/_markupbase.py
_osx_support                   | /usr/lib/python3.4/_osx_support.py
_pyio                          | /usr/lib/python3.4/_pyio.py
(****************************truncated*******************************)
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
44: <class '_frozen_importlib.ExtensionFileLoader'>
------------------------------------------------------------------------------------------------------------------------------------------------------------------------
_bz2                           | /usr/lib/python3.4/lib-dynload/_bz2.cpython-34m-x86_64-linux-gnu.so
_codecs_cn                     | /usr/lib/python3.4/lib-dynload/_codecs_cn.cpython-34m-x86_64-linux-gnu.so
_codecs_hk                     | /usr/lib/python3.4/lib-dynload/_codecs_hk.cpython-34m-x86_64-linux-gnu.so
_codecs_iso2022                | /usr/lib/python3.4/lib-dynload/_codecs_iso2022.cpython-34m-x86_64-linux-gnu.so
_codecs_jp                     | /usr/lib/python3.4/lib-dynload/_codecs_jp.cpython-34m-x86_64-linux-gnu.so
_codecs_kr                     | /usr/lib/python3.4/lib-dynload/_codecs_kr.cpython-34m-x86_64-linux-gnu.so
_codecs_tw                     | /usr/lib/python3.4/lib-dynload/_codecs_tw.cpython-34m-x86_64-linux-gnu.so
_crypt                         | /usr/lib/python3.4/lib-dynload/_crypt.cpython-34m-x86_64-linux-gnu.so
(****************************truncated*******************************) 
```

* * *

## 回答 #19

> 赞同：8
> 
> 时间：2013-01-25T20:20:06.863

除了使用`pip freeze`我一直在我的虚拟环境中安装[蛋黄。](http://pypi.python.org/pypi/yolk)

* * *

## 回答 #20

> 赞同：7
> 
> 时间：2013-12-05T23:38:03.163

In case you have an [anaconda python distribution](https://store.continuum.io/cshop/anaconda/) installed, you could also use

```
$conda list 
```

in addition to solutions described above.

* * *

## 回答 #21

> 赞同：6
> 
> 时间：2014-01-21T06:42:12.657

1.  要获取所有可用模块，请运行`sys.modules`
2.  要获取所有*已安装*的模块（阅读：安装者`pip`），您可以查看`pip.get_installed_distributions()`

对于第二个目的，示例代码：

```
import pip
for package in pip.get_installed_distributions():
    name = package.project_name # SQLAlchemy, Django, Flask-OAuthlib
    key = package.key # sqlalchemy, django, flask-oauthlib
    module_name = package._get_metadata("top_level.txt") # sqlalchemy, django, flask_oauthlib
    location = package.location # virtualenv lib directory etc.
    version = package.version # version number 
```

* * *

## 回答 #22

> 赞同：5
> 
> 时间：2019-01-28T06:57:02.197

*给猫剥皮的方法有很多。*

*   最简单的方法是`pydoc`直接从 shell 中使用该函数：
    `pydoc modules`

*   但要了解更多信息，请使用名为[pip-date](https://github.com/E3V3A/pip-date)的工具，该工具还会告诉您安装日期。
    `pip install pip-date`

* * *

[![在此处输入图像描述](https://i.stack.imgur.com/9rEqz.png)](https://i.stack.imgur.com/9rEqz.png)

* * *

## 回答 #23

> 赞同：4
> 
> 时间：2016-04-21T10:52:02.893

**pip freeze**会全部查找包，但是可以简单地编写以下命令来列出 python 包所在的所有路径。

```
>>> import site; site.getsitepackages()
['/usr/local/lib/python2.7/dist-packages', '/usr/lib/python2.7/dist-packages'] 
```

* * *

## 回答 #24

> 赞同：3
> 
> 时间：2019-03-01T07:31:58.903

我需要在 AWS Lambda 中找到默认可用的特定版本的软件包。我是通过这个页面上的一些想法来做到这一点的。我分享给后人。

```
import pkgutil

__version__ = '0.1.1'

def get_ver(name):
    try:
        return str(__import__(name).__version__)
    except:
        return None

def lambda_handler(event, context):
    return {
        'statusCode': 200,
        'body': [{
                   'path': m.module_finder.path,
                   'name': m.name,
                   'version': get_ver(m.name),
                 } for m in list(pkgutil.iter_modules())
                 #if m.module_finder.path == "/var/runtime" # Uncomment this if you only care about a certain path
                ],
    } 
```

我发现提供的 boto3 库已经过时了，我的代码失败不是我的错。我只需要将 boto3 和 botocore 添加到我的项目中。但是如果没有这个，我会一直认为我的代码很糟糕。

```
{
  "statusCode": 200,
  "body": [
    {
      "path": "/var/task",
      "name": "lambda_function",
      "version": "0.1.1"
    },
    {
      "path": "/var/runtime",
      "name": "bootstrap",
      "version": null
    },
    {
      "path": "/var/runtime",
      "name": "boto3",
      "version": "1.9.42"
    },
    {
      "path": "/var/runtime",
      "name": "botocore",
      "version": "1.12.42"
    },
    {
      "path": "/var/runtime",
      "name": "dateutil",
      "version": "2.7.5"
    },
    {
      "path": "/var/runtime",
      "name": "docutils",
      "version": "0.14"
    },
    {
      "path": "/var/runtime",
      "name": "jmespath",
      "version": "0.9.3"
    },
    {
      "path": "/var/runtime",
      "name": "lambda_runtime_client",
      "version": null
    },
    {
      "path": "/var/runtime",
      "name": "lambda_runtime_exception",
      "version": null
    },
    {
      "path": "/var/runtime",
      "name": "lambda_runtime_marshaller",
      "version": null
    },
    {
      "path": "/var/runtime",
      "name": "s3transfer",
      "version": "0.1.13"
    },
    {
      "path": "/var/runtime",
      "name": "six",
      "version": "1.11.0"
    },
    {
      "path": "/var/runtime",
      "name": "test_bootstrap",
      "version": null
    },
    {
      "path": "/var/runtime",
      "name": "test_lambda_runtime_client",
      "version": null
    },
    {
      "path": "/var/runtime",
      "name": "test_lambda_runtime_marshaller",
      "version": null
    },
    {
      "path": "/var/runtime",
      "name": "urllib3",
      "version": "1.24.1"
    },
    {
      "path": "/var/lang/lib/python3.7",
      "name": "__future__",
      "version": null
    },
... 
```

我发现的也和[他们官方公布](https://docs.aws.amazon.com/lambda/latest/dg/current-supported-versions.html)的不一样。在撰写本文时：

> *   操作系统 – 亚马逊 Linux
> *   AMI – amzn-ami-hvm-2017.03.1.20170812-x86_64-gp2
> *   Linux 内核 – 4.14.77-70.59.amzn1.x86_64
> *   适用于 JavaScript 的 AWS 开发工具包 – 2.290.0\
> *   适用于 Python 的 SDK (Boto 3) – 3-1.7.74 botocore-1.10.74

* * *

## 回答 #25

> 赞同：3
> 
> 时间：2018-09-19T09:06:22.313

思路很多，最初我在琢磨这两个：

**点子**

> 缺点：并不总是安装

**帮助（'模块'）**

> 缺点：输出到控制台；模块损坏（请参阅 ubuntu ...）可能会出现段错误

我需要一种简单的方法，使用基本库并与旧的 python 2.x 兼容

我看到了曙光：[listmodules.py](http://svn.python.org/projects/python/tags/r256/Doc/tools/listmodules.py)

隐藏在 2.5 的文档源目录中的是一个小脚本，它列出了 Python 安装的所有可用模块。

优点：

> 仅使用*imp、sys、os、re、time*
> 
> 设计为在 Python 1.5.2 和更新版本上运行
> 
> 源代码非常紧凑，因此您可以轻松修改它，例如传递错误模块的异常列表（不要尝试导入它们）

* * *

## 回答 #26

> 赞同：2
> 
> 时间：2019-12-11T23:28:23.230

这是一个 python 代码解决方案，它将返回已安装模块的列表。可以轻松地修改代码以包含版本号。

```
import subprocess
import sys
from pprint import pprint

installed_packages = reqs = subprocess.check_output([sys.executable, '-m', 'pip', 'freeze']).decode('utf-8')
installed_packages = installed_packages.split('\r\n')
installed_packages = [pkg.split('==')[0] for pkg in installed_packages if pkg != '']
pprint(installed_packages) 
```

* * *

## 回答 #27

> 赞同：1
> 
> 时间：2019-10-16T04:30:27.937

安装

```
pip install pkgutil 
```

代码

```
import pkgutil

for i in pkgutil.iter_modules(None): # returns a tuple (path, package_name, ispkg_flag)
    print(i[1]) #or you can append it to a list 
```

样本输出：

```
multiprocessing
netrc
nntplib
ntpath
nturl2path
numbers
opcode
pickle
pickletools
pipes
pkgutil 
```

* * *

## 回答 #28

> 赞同：1
> 
> 时间：2021-04-22T01:34:11.833

```
pip install pip-chill 
pip-chill 
```

* * *

## 回答 #29

> 赞同：0
> 
> 时间：2020-07-26T08:59:37.477

如果上述方法似乎都没有帮助，那么在我的环境中，系统升级被破坏了，我无法升级 pip。虽然它不会为您提供准确的列表，但您只需查看 env>lib>python(version here)>site-packages> 即可了解安装了哪些库。在这里，您将很好地了解已安装的模块。

* * *

## 回答 #30

> 赞同：-2
> 
> 时间：2019-07-11T22:05:09.180

对于想知道如何`pip list`从 Python 程序调用的任何人，您可以使用以下命令：

```
import pip
pip.main(['list])  # this will print all the packages 
```

* * *

## 回答 #31

> 赞同：-10
> 
> 时间：2009-04-11T12:38:07.697

从贝壳

```
ls site-packages 
```

如果这没有帮助，您可以这样做。

```
import sys
import os
for p in sys.path:
    print os.listdir( p ) 
```

看看会产生什么。

# sql - SQL 从 2 列中查找最近的日期，并确定它在哪一列

> ID：739994
> 
> 赞同：0
> 
> 时间：2009-04-11T12:35:09.387
> 
> 标签：sql, aggregate

我有一个名为 tblAssetsInUse 的表，其结构如下：

```
intPK      intAssetID      datCheckedOut     datCheckedIn
1          450             1/5/2009          10/5/2009
2          300             2/5/2009          <NULL>
3          200             2/5/2009          <NULL>
4          450             12/5/2009         5/7/2009 
```

并且我有一个 SP 接收扫描的资产 ID，然后分别插入或更新表中的资产以检出或检入。如您所见，datCheckedIn 可能为 Null，用于计算当前正在使用的资产。此过程完美运行。我希望能够确定要扫描的最后一个资产是什么，以及表的最后一个操作是什么（即签入或签出）。我有一些 SQL 代码可以找到具有最近日期的行（无论哪一列），然后我使用它来加入一个单独的资产视图，它也可以工作。我只需要能够以某种方式确定最近的日期是否在“签出”或“签入”列中。

```
SELECT TOP (1) allDates.intPK, MAX(allDates.datLastAction) AS datLastScan,    dbo.viwAssets.strFriendlyName, tblAssetsInUse_join.intAssetID
FROM (SELECT intPK, MAX(datCheckedOut) AS datLastAction
      FROM dbo.tblAssetsInUse AS tblAssetsInUse_out
      GROUP BY intPK

      UNION ALL

      SELECT intPK, MAX(datCheckedIn) AS datLastAction
      FROM dbo.tblAssetsInUse AS tblAssetsInUse_in
      GROUP BY intPK) AS allDates 
INNER JOIN
dbo.tblAssetsInUse AS tblAssetsInUse_join ON allDates.intPK = tblAssetsInUse_join.intPK 
INNER JOIN
dbo.viwAssets ON tblAssetsInUse_join.intAssetID = dbo.viwAssets.intPK
GROUP BY allDates.intPK, dbo.viwAssets.strFriendlyName, tblAssetsInUse_join.intAssetID
ORDER BY datLastScan DESC 
```

是否有某种我可以添加的文字值，以便它在结果中标记一个位值？

谢谢你的帮助，

保罗雷诺兹

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-11T12:46:03.480

试试这个作为你的内部查询：

```
SELECT intPK, 'Out', MAX(datCheckedOut)
FROM dbo.tblAssetsInUse
GROUP BY intPK

UNION

SELECT intPK, 'In', MAX(datCheckedIn)
FROM dbo.tblAssetsInUse
GROUP BY intPK 
```

编辑添加：一个更巧妙的解决方案是创建一个比较两个日期的更大的用户定义函数。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-11T12:44:03.797

一种方法是使用[`CASE`](http://msdn.microsoft.com/en-us/library/ms181765.aspx)语句和 SELECT`IN`或者`OUT`取决于`MAX`日期值是`IN`或`OUT`

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T13:00:08.970

除了获得执行的操作类型之外，我认为整个查询可以通过这种方式简化（和优化）：

```
SELECT TOP 1 allDates.intPK, allDates.datLastAction AS datLastScan, allDates.operation, dbo.viwAssets.strFriendlyName, tblAssetsInUse_join.intAssetID
FROM (SELECT TOP 1 intPK, intAssetID, datCheckedOut AS datLastAction, 'Out' AS operation
  FROM dbo.tblAssetsInUse AS tblAssetsInUse_out
  ORDER BY datCheckedOut DESC

  UNION ALL

  SELECT TOP 1 intPK, intAssetID, datCheckedIn AS datLastAction, 'In' AS operation
  FROM dbo.tblAssetsInUse AS tblAssetsInUse_in
  ORDER BY datCheckedIn DESC) AS allDates 
INNER JOIN
  dbo.viwAssets ON allDates.intAssetID = dbo.viwAssets.intPK
ORDER BY datLastScan DESC 
```

编辑：还请注意，通过删除第一行中的 TOP 1，您可以获得最后一个签入的资产和最后一个签出的资产。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-11T13:15:22.567

这应该有效。如果您最终在同一时间签入或签出两个项目，您当然会得到多行。

```
SELECT
     intPK,
     intAssetID,
     datCheckedOut,
     datCheckedIn,
     CASE
          WHEN datCheckedIn IS NOT NULL THEN 'Checked In'
          ELSE 'Checked Out'
     END AS last_action
FROM
     tblAssetsInUse AIU
INNER JOIN
     (
          SELECT
               MAX(datCheckedOut) AS max_in,
               MAX(datCheckedIn) AS max_out
          FROM
               tblAssetsInUse
     ) SQ ON
     CASE
          WHEN max_in > max_out THEN max_in
          ELSE NULL
     END = AIU.datCheckedIn OR
     CASE
          WHEN max_out > max_in THEN max_out
          ELSE NULL
     END = AIU.datCheckedOut 
```**************`*