# StackOverflow 问答 000646000-000646999

# c - 分发可加载的内置 bash 模块

> ID：646010
> 
> 赞同：1
> 
> 时间：2009-03-14T14:47:51.343
> 
> 标签：c, bash, cd, distribute, built-in

我为 bash 编写了一个内置程序，它修改了“cd”命令，这是我的软件的要求。有没有办法独立于 bash 本身实际分发可加载的？理想情况下，我希望只发布一小部分“附加功能”，因为我知道人们可以通过从源代码修补和编译他们的 shell 来推迟。

我想计算用户在目录中的时间，以便确定他们想要在哪里。就是这个功能： http: [//github.com/joelthelion/autojump/tree/master](http://github.com/joelthelion/autojump/tree/master)重写为 bash 内置，以解决性能问题。这个实现用来`$PROMPT_COMMAND`工作，但我想要一些集成的东西。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2013-09-21T13:06:40.713

目前尚不清楚您修改了什么，但无论如何，`bash`（至少像`ksh93`IIRC 引入的概念和`zsh`）支持使用`enable -f file name`语法将内置函数加载为外部动态加载的模块。

这些作为普通文件的模块当然可以独立分发，只要您确保它们与目标版本/架构兼容。五年前当你问这个问题时，这已经是真的了。

在您的情况下，一个问题是似乎没有记录的方法可以`cd`通过动态加载的方式重载内部内置，同时保持访问前者的能力。

一个简单的解决方法是使用不同的名称实现您的自定义 cd，例如 mycd，如下所示：

```
int mycd_builtin(list)
WORD_LIST *list;
{
  int rv;
  rv=cd_builtin(list);
  if(rv == EXECUTION_SUCCESS) {
    char wd[PATH_MAX+1];
    getcwd(wd,sizeof(wd));
    // do your custom stuff knowing the new working directory
    ...
  }
  return (rv);
} 
```

然后为您的自定义版本使用别名或更好的 shell 函数，而不是常规版本：

```
cd() {
  mycd "$@"
} 
```

只要您的自定义不影响标准命令的行为，因此不会冒险破坏使用它的脚本，您的方法就没有错。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-15T02:50:22.340

更改内置 cd 对任何管理员来说都是一场噩梦，不欢迎外国用户。将其命名为“smart-cd”并让用户通过将其包含在 .bashrc 或 .profile 中来决定他们是否需要该功能有什么问题？然后他们可以随心所欲地设置东西。

此外，使用您在目录中的时间长度是一个很差的偏好指示。您如何区分空闲（一个被遗忘的外壳在一夜之间挂在 /tmp 中）、长时间运行的脚本（每晚 cron 作业）和实际活动。

有许多其他方法可以创建收藏目录的快捷方式：别名、软链接、$VARIABLES、脚本。假设您的使用模式会受到您系统的其他用户的欢迎，这是傲慢的。

# java - 如何判断 Java 整数是否为空？

> ID：646012
> 
> 赞同：27
> 
> 时间：2009-03-14T14:48:01.827
> 
> 标签：java, integer

问候，

我正在尝试验证我的整数是否为空。如果是，我需要提示用户输入一个值。我的背景是 Perl，所以我的第一次尝试是这样的：

```
int startIn = Integer.parseInt (startField.getText());

if (startIn) { 
    JOptionPane.showMessageDialog(null,
         "You must enter a number between 0-16.","Input Error",
         JOptionPane.ERROR_MESSAGE);                
} 
```

这不起作用，因为 Java 需要布尔逻辑。

在 Perl 中，我可以使用“exists”来检查哈希/数组元素是否包含以下数据：

```
@items = ("one", "two", "three");
#@items = ();

if (exists($items[0])) {
    print "Something in \@items.\n";
}
else {
    print "Nothing in \@items!\n";
} 
```

Java有没有办法做到这一点？感谢您的帮助！

耶利米

PS Perl[存在](http://perldoc.perl.org/functions/exists.html)信息。

* * *

## 回答 #1

> 赞同：41
> 
> 时间：2009-03-14T14:52:32.940

`parseInt()`如果解析无法成功完成，只会抛出异常。您可以改为使用`Integers`相应的对象类型，这会使事情变得更简洁。所以你可能想要更接近的东西：

```
Integer s = null;

try { 
  s = Integer.valueOf(startField.getText());
}
catch (NumberFormatException e) {
  // ...
}

if (s != null) { ... } 
```

*当心*，如果你决定使用`parseInt()`！`parseInt()`不支持良好的国际化，所以你必须跳过更多的障碍：

```
try {
    NumberFormat nf = NumberFormat.getIntegerInstance(locale);
    nf.setParseIntegerOnly(true);
    nf.setMaximumIntegerDigits(9); // Or whatever you'd like to max out at.

    // Start parsing from the beginning.
    ParsePosition p = new ParsePosition(0);

    int val = format.parse(str, p).intValue();
    if (p.getIndex() != str.length()) {
        // There's some stuff after all the digits are done being processed.
    }

    // Work with the processed value here.
} catch (java.text.ParseFormatException exc) {
    // Something blew up in the parsing.
} 
```

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-14T14:58:06.950

试试这个：

```
Integer startIn = null;

try {
  startIn = Integer.valueOf(startField.getText());
} catch (NumberFormatException e) {
  .
  .
  .
}

if (startIn == null) {
  // Prompt for value...
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-14T14:53:31.173

`int`s 是值类型；他们永远不可能`null`。相反，如果解析失败，`parseInt`将抛出一个`NumberFormatException`你需要捕获的。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-14T19:02:44.150

`exists`无论如何，Perl中没有*SCALAR*。Perl的方式是

```
defined( $x ) 
```

等效的Java是

```
anInteger != null 
```

这些是等价物。

```
exists $hash{key} 
```

就像Java

```
map.containsKey( "key" ) 
```

从您的示例中，我认为您正在寻找

if ( startIn != null ) { ...

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2012-03-15T19:34:57.550

对我来说，只需使用 Integer.toString() 方法就可以了。如果你只是想非常如果它为空，你可以将它转换过来。下面的例子：

```
private void setCarColor(int redIn, int blueIn, int greenIn)
{
//Integer s = null;
if (Integer.toString(redIn) == null || Integer.toString(blueIn) == null ||     Integer.toString(greenIn) == null ) 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-14T15:36:11.057

我认为您不能在 Perl 中的整数上使用“存在”，只能在集合上使用。你能举一个例子来说明你在 Perl 中的意思，它与你在 Java 中的例子相匹配。

> 给定一个指定哈希元素或数组元素的表达式，如果哈希或数组中的指定元素曾经被初始化，则返回 true，即使相应的值未定义。

这表明它仅适用于哈希或数组元素！

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2012-07-12T22:48:23.863

这应该会有所帮助。

```
Integer startIn = null;

// (optional below but a good practice, to prevent errors.)
boolean dontContinue = false;
try {
  Integer.parseInt (startField.getText());
} catch (NumberFormatException e){
  e.printStackTrace();
}

// in java = assigns a boolean in if statements oddly.
// Thus double equal must be used. So if startIn is null, display the message
if (startIn == null) {
  JOptionPane.showMessageDialog(null,
       "You must enter a number between 0-16.","Input Error",
       JOptionPane.ERROR_MESSAGE);                            
}

// (again optional)
if (dontContinue == true) {
  //Do-some-error-fix
} 
```

# objective-c - Objective-C 中的数组

> ID：646014
> 
> 赞同：0
> 
> 时间：2009-03-14T14:49:07.893
> 
> 标签：objective-c, arrays

如果你想使用一组字符/坏人，最好有一个坏人对象数组，每个对象都有像 Badguy1 这样的属性：颜色=蓝色，健康=80。然后你遍历你的字符数组并提取该信息......或者让多个小数组（如字符数组、颜色数组、健康数组和所有 3 个数组的索引对齐为同一个字符）更好？

如果每个数组是单独的，我知道如何从每个数组中提取信息，但如果每个字符都包含在 1 个数组中，我不知道如何获取它的属性。

我问只是因为使用单个数组并拉出您需要的部分似乎更有意义。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-14T15:09:03.727

其实，现在想想。我想我应该只有一个指针数组，然后从对象中获取我的值，而不是尝试将所有这些都存储在数组中。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T15:12:55.823

> 如果每个数组是单独的，我知道如何从每个数组中提取信息，但如果每个字符都包含在 1 个数组中，我不知道如何获取它的属性。我问只是因为使用单个数组并拉出您需要的部分似乎更有意义。

您是正确的，因为将相关事物放在一起通常更聪明，也是更好的设计决策。如果您想以这种方式存储它们，您可以简单地执行以下操作：

```
// Get the character at index 3 in the "characters" array
//   and print how many hit points it has left.
GameCharacter *ch = [characters objectAtIndex:3];
NSLog(@"This character has: %@ hit points", ch.hitPointsRemaining); 
```

# flash - 通过 ActionScript 2.0 的 Flash 运动速度/在时间轴中移动关键帧？

> ID：646018
> 
> 赞同：0
> 
> 时间：2009-03-14T14:52:12.237
> 
> 标签：flash, actionscript-2

我目前正在处理一个对象沿运动引导路径移动的 Flash 项目。但是，关键帧决定了该移动的速度。我正在寻找一种通过 ActionScript 2 代码更改移动速度的方法。

您对如何完成此操作有任何提示吗？我可以改变时间轴中第二个关键帧的位置吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-14T15:26:24.137

我认为最好的方法是在 Actionscript 中制作整个动画。您可以使用简单的动作脚本轻松完成大部分 Flash 舞台效果（运动、Alpha 和颜色补间）。对于更高级的效果（例如，基于时间的动画），有许多库（例如[这个](http://www.ultrashock.com/tutorials/flashmx/moose2.php)）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T20:00:50.030

如果可能的话，我也建议在代码中制作动画。如果这不切实际（可能看不到您正在使用运动指南），只要最慢的场景可以制作动画，我就会制作动画，然后使用`gotoAndStop(Math.round(_totalframes * progress))`它来逐步完成。

# windows-mobile - 如何在 Windows Mobile 6 上使用没有软键/菜单栏的软键？

> ID：646019
> 
> 赞同：2
> 
> 时间：2009-03-14T14:52:19.353
> 
> 标签：windows-mobile, compact-framework

有人知道是否可以在 WM 6 设备（摩托罗拉 MC 35）上使用软键而不实际显示底栏/菜单栏？我有一个全屏 Compact Framework 应用程序，我想在其中使用软键，但我不想显示底部菜单栏（会浪费屏幕空间）。不幸的是，软键似乎没有产生任何键盘事件！？

我通常也可以将软键重新映射到一些标准键，例如 F1 和 F2，可能有一些黑客或注册表调整吗？

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T16:18:18.537

具有讽刺意味的是，我认为 MS 调用这些硬件按钮，也许这是谷歌搜索时的问题。有一个 Hardwarekey 组件，设置它的 Key 属性 (Key1 .. 5) 并将其重定向到 Control。该控件可以是您的表单。在 Controls KeyDown 事件中，将 KeyCode 类型转换为 Hardwarekeys 枚举。

请参阅此[MSDN 页面](http://inthehand.net/library/InTheHand.WindowsCE.Forms.HardwareButton.html)上的示例代码。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T19:21:58.477

如果你想使用按键，我认为你不能“没有”菜单栏，但你可以像任何窗口一样“隐藏”菜单栏窗口。

例如

```
ShowWindow(SHFindMenuBar(window_handle), SW_HIDE); 
```

您将遇到的一个问题是某些设备没有软键的硬件按钮，因此隐藏它们将意味着用户无法使用它们。

# delphi - WMDeviceChange函数调用其他函数/过程时的Delphi Pascal问题

> ID：646023
> 
> 赞同：1
> 
> 时间：2009-03-14T14:53:43.390
> 
> 标签：delphi, function, pascal, procedure

解决了

我正在使用 delphi 2009。我的程序会监听 USB 驱动器的连接和移除。在过去的一年里，我在 10 个应用程序中使用了非常相似的代码。它一直很完美。当我迁移时，我不得不放弃使用 thddinfo 来获取驱动器型号。这已被 WMI 取代。WMI 查询需要物理磁盘号，而我恰好在应用程序中已经有一个功能可以做到这一点。

当我测试时，我将它放在一个按钮中并运行它，它成功确定 psp 是物理驱动器 4 并返回模型（全部在调试器中检查，在另一个示例中使用显示消息）：

```
function IsPSP(Drive: String):Boolean;
var
Model: String;
DriveNum: Byte;
begin
  Result := False;
  Delete(Drive, 2, MaxInt);
  DriveNum := GetPhysicalDiskNumber(Drive[1]);
  Model := (MagWmiGetDiskModel(DriveNum));
  if Pos('PSP',Model) > 0 then Result := True;
end;

procedure TfrmMain.Button1Click(Sender: TObject);
var DriveNum: Byte;
begin
  IsPSP('I');
end; 
```

它工作得很好，直到我允许我使用了一年的 WMDeviceChange 调用 getphysicaldisknumber 和 wmi 查询语句。我自己试过了，它们都是一个问题。GetPhysicalDiskNumber 在逻辑磁盘上执行 CloseHandle 时冻结非常糟糕，但最终确实返回了数字。WMI 查询失败且没有错误，只是将“调试器点”返回到从未发生连接的 wbemscripting_tlb 中。请记住，一年中唯一改变的是我调用什么来获取我正在使用 api 调用的模型，而现在我正在使用其他东西。

以下是此时涉及的其余代码，没有上面显示的 ispsp：

```
procedure TfrmMain.WMDeviceChange(var Msg: TMessage);
var Drive: String;
begin
  case Msg.wParam of
    DBT_DeviceArrival: if PDevBroadcastHdr(Msg.lParam)^.dbcd_devicetype = DBT_DevTyp_Volume then
      begin
        Drive := GetDrive(PDevBroadcastVolume(Msg.lParam)) + '\';
        OnDeviceInsert(Drive);
      end;
    DBT_DeviceRemoveComplete: if PDevBroadcastHdr(Msg.lParam)^.dbcd_devicetype = DBT_DevTyp_Volume then
      begin
        Drive := GetDrive(PDevBroadcastVolume(Msg.lParam)) + '\';
        OnDeviceRemove(Drive);
      end;
  end;
end;

Procedure TfrmMain.OnDeviceInsert(Drive: String);
var PreviousIndex: Integer;
begin
  if (getdrivetype(Pchar(Drive))=DRIVE_REMOVABLE) then
  begin
    PreviousIndex := cbxDriveList.Items.IndexOf(cbxDriveList.Text);
    cbxDriveList.Items.Append(Drive);
    if PreviousIndex = -1 then //If there was no drive to begin with then set index to 0
    begin
      PreviousIndex := 0;
      cbxDriveList.ItemIndex := 0;
    end;
    if isPSP(Drive) then
    begin
      if MessageDlg('A PSP was detect @ ' + Drive + #10#13 + 'Would you like to select this drive?',mtWarning,[mbYes,mbNo], 0) = mrYes then
      cbxDriveList.ItemIndex := cbxDriveList.Items.IndexOf(Drive)
      else cbxDriveList.ItemIndex := PreviousIndex;
    end
    else if MessageDlg('USB Drive ' + Drive + ' Detected' + #10#13 + 'Is this your target drive?',mtWarning,[mbYes,mbNo], 0) = mrYes then
        cbxDriveList.ItemIndex := cbxDriveList.Items.IndexOf(Drive)
    else cbxDriveList.ItemIndex := PreviousIndex;
  end;
end;

Procedure TfrmMain.OnDeviceRemove(Drive: String);
begin
  if not (getdrivetype(Pchar(Drive)) = DRIVE_CDROM) then
  begin
    if cbxDriveList.Text = (Drive) then ShowMessage('The selected drive (' + Drive + ') has been removed');
    cbxDriveList.Items.Delete(cbxDriveList.Items.IndexOf(Drive));
    if cbxDriveList.Text = '' then cbxDriveList.ItemIndex := 0;
    if Drive = PSPDrive then //Check Detect PSP and remove reference if its been removed
    begin
      PSPDrive := '';
    end;
  end;
end; 
```

Rob 在下面说了一些关于我没有调用继承的消息处理程序的内容，我阅读了文档，我看到了一些我可以返回的东西......但我不确定我是否理解，但我会调查它。我不是一个非常好的 Pascal 程序员，但我学到了很多东西。到 2009 年的过渡也有一些困难。

USB 驱动器检测和所有这些都可以完美运行。如果我从 is psp 中删除这两个东西，那么用户会立即用 wis this yourwhat 向用户致意，并将 I:\ 添加到列表中。它只是在应用程序中发生变化的两个新事物在被 wmdevicechange 调用时失败，并且正如在它们自己工作之前所说的那样。

编辑 - 已解决

好吧，我按照建议使用计时器，问题似乎已经解决。需要注意的是，在 wmdevicechange 获取物理磁盘号后不久被计时器调用时，它似乎仍然很慢。我将此归因于仍连接到系统的设备。

在那张纸条上，我经常使用 P2 450。我将 PSP 和应用程序连接到一台 1.8Ghz 双核笔记本电脑，程序检测到 psp 并很快通知用户。因此，除非在非常慢的计算机上，否则该应用程序不会冻结，并且在这种缓慢的 onw 上它只会持续几秒钟，并且不会影响程序的运行，尽管不是很酷。但我觉得所有现代计算机都会快速运行检测，特别是因为它们可以更快地连接设备。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T16:21:56.220

您尚未在代码中指出“语句 1”是什么。

我对部分代码有一些评论，这些评论可能与您遇到的问题有关，也可能无关。

`DriveNum`首先，您为in分配了一个值`IsPSP`，但您不使用它。编译器应该对此发出提示；不要忽视提示和警告。您还将幻数 4 传递给`MagWmiGetDiskModel`; 那应该是`DriveNum`吗？

您没有调用继承的消息处理程序，也没有在消息处理程序中返回结果。[该文档](http://msdn.microsoft.com/en-us/library/aa363480.aspx)告诉您应该返回哪些值。要从 Delphi 消息处理程序返回一个值，请为该`Msg.Result`字段分配一个值。对于您的消息处理程序无法处理的情况，请确保您调用`inherited`，以便链上的下一个处理程序可以处理它们。如果没有 next 处理程序，那么 Delphi 将调用`DefWindowProc`以获取操作系统的默认行为。

您说明的更改称为*重构*，它不会影响您的代码运行方式。但是，它使代码更易于阅读，因此请保留第二个版本。至于发现问题，我最好的建议是使用调试器来逐步执行代码，以识别出现问题的地方以及运行速度比您想要的慢的部分。您还可以尝试删除部分代码，以确认其他部分单独工作是否正常。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T16:53:41.527

您查询的信息可能仅*在*WMDeviceChange 消息处理程序运行后才可用。如果从按钮调用时相同的代码有效，请尝试以下操作：

1.  将您的 WMDeviceChange 处理程序代码重构为一个或多个单独的方法。
2.  在 WMDeviceChange 处理程序中，激活一个预先创建的计时器并让它在一秒钟后触发，或者类似的东西。
3.  从计时器处理程序代码中调用以前的 WMDeviceChange 处理程序代码。

# iphone - 什么时候用自己？

> ID：646024
> 
> 赞同：1
> 
> 时间：2009-03-14T14:54:20.987
> 
> 标签：iphone, objective-c

我有一个 iPhone 应用程序，其中一个视图视图 A 更新选项卡栏中的另一个视图视图 B，使用：

```
// This works.
- (void) reloadData
{
    MyDB * db = _GET_DB_CLASS;
    if(data != nil) // data is a property of type NSMutableArray
        [data release];

    NSMutableArray * d = [db getDataQuery];
    data = s; // Don't release since we are not using the accessor. And retain count should be 1.
} 
```

如果我这样做，它就不起作用（例如，我更新 B，然后切换到 B，崩溃。我在日志中也看不到任何有用的东西......）。

```
 NSMutableArray * d = [db getDataQuery];
    self.data = s; // Doesn't work
    [data release]; 
```

我没有使用自定义设置器。到底是怎么回事？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-12T23:46:15.943

我完全忘记了这一点。太多的工作。所以我不确定问题的确切性质是什么。但我仔细查看了调试器中的 retainCounts（在尝试 Lou 的建议之前）。

这是一个保留/释放问题。我想规则是要与你的用法一致。无论如何，这有效：

```
- (void) reloadFridgeData
{
    MyDB * db = _GET_DB_CLASS;
    if(self.data != nil)
    {
        self.data = nil;
    }

    NSMutableArray * newData = [db getData];
    self.data = newData;
    【新数据发布】；
}

```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T20:14:10.840

您是否已将您的数据属性声明为“保留”，而不是“分配”？你应该有类似的东西：

@property(retain) NSMutableArray *data;

如果不是，那么当您分配给 data 属性时，它不会增加引用计数。您的后续版本将释放对象，并且对 data 属性的下一个引用将崩溃。

查看[Apple docs for setter semantics](http://developer.apple.com/DOCUMENTATION/Cocoa/Conceptual/ObjectiveC/Articles/ocProperties.html#//apple_ref/doc/uid/TP30001163-CH17-SW27)，了解有关保留的更多信息。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T00:49:28.097

通常，如果您只是使用保留属性，则应始终使用 self.data 并调用生成的 setter。

它：

1.  自动调用 release 旧值（检查 nil）
2.  调用保留在新值上

那么您的代码将很简单：

```
self.data = s;
[s release]; 
```

调试需要做两件事：

1.  使用静态分析——我个人发现这个工具在保留/释放问题上是 100% 准确的：http: [//clang.llvm.org/StaticAnalysisUsage.html](http://clang.llvm.org/StaticAnalysisUsage.html)

2.  按照我关于 iPhone 上的内存调试的博客文章中的说明进行操作：

[http://loufranco.com/blog/files/debugging-memory-iphone.html](http://loufranco.com/blog/files/debugging-memory-iphone.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-22T19:46:11.810

如果 data 绝对是一个没有同名基础值的属性，那么它必须从`self`as in `[[self data] release]`or中访问`[self.data release]`。但是，如前所述，如果属性设置为自动保留，您可以通过将属性设置为新值来完成相同的操作，例如`nil`. （正如您在您注意到的代码中所做的那样。）

# c# - 如何从来自 ASP.net 中的 GET 方法的 url 访问变量？

> ID：646047
> 
> 赞同：1
> 
> 时间：2009-03-14T15:07:16.367
> 
> 标签：c#, asp.net, vb.net, query-string

事实证明，Asp.net 比 PHP 更容易使用（到目前为止）。但是，我一直在寻找一段时间，根本无法弄清楚这一点。如何获取页面 url 中包含的变量（源自具有“GET”方法的表单）并使用它们？

例如，我的页面是 www.example.com/index.asp?somevariable=something

我将如何获得某个变量的值？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T15:17:36.047

您可以使用 ybo 所说的，但它并不完整（至少对于 VB）。仅此一项就可能引发空引用异常。您想要转换（即 TryParse）这些值，并处理您希望包含值的任何空参数：

```
Dim itemId As Integer
Dim itemType as String

If Not Integer.TryParse(Request.QueryString("i").ToString, itemId) Then
    itemId = -1 ' Or whatever your default value is
Else
    ' Else not required. Variable itemId contains the value when Integer.TryParse returns True.
End If

itemType = Request.QueryString("t").ToString ' <-- ToString important here! 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T15:10:53.723

这很简单：

```
Request.QueryString["somevariable"]; // C#
Request.QueryString("somevariable") ' VB 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T15:14:02.607

这适用于 ASPX c#：

```
NameValueCollection pColl = Request.Params;
if (pColl["somevariable"] != null)
{
    string yourvalue = pColl["somevariable"];
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T16:00:26.177

任何像样的 HTTP 框架或库或软件，脚本/本机/托管/路由，都可以为您烹饪/分解/破解 URL 组件。

Request.QueryString 是一种古老的处理方式。查找 Uri 模板机制或新的 MVC 位。你迟早会需要它。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-09-17T12:50:30.253

```
NameValueCollection col1 = Request.Query;
name=col1.GetValues("somevariable")[0].ToString(); 
```

# asp.net-3.5 - 我应该将我的 connectionString 放在 ASP.Net 3.5 的什么位置？

> ID：646049
> 
> 赞同：1
> 
> 时间：2009-03-14T15:07:35.743
> 
> 标签：asp.net-3.5

我有两个项目：

1.  ASP.Net 3.5 网站（前端、UI）
2.  VB 类库（数据访问逻辑）

我应该在哪里保存我的connectionString，以便我可以从类库中使用if？这对我部署/发布时的放置位置有何影响？

笔记：

1.  我不想将它传递给我的 VB 类中的每个函数

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-14T15:18:57.353

根据您构建 DAL 的方式——LINQ、TableAdapters 等——它可能会自动在 web.config 文件中查找它。如果您通过设计器创建了 DAL，它可能会将默认连接字符串存储在您的类库的 app.config 文件中。我将连接字符串部分从 app.config 文件复制到我的 web.config 并将连接字符串更改为正确的数据库（我有单独的 web.config 用于 DEV/QA/PROD）。这使得它变得微不足道，因为设计者生成的代码已经实现了从配置文件中检索它的代码。

如果您正在手动编写 DAL 并需要传入连接字符串，我建议设置一个强类型配置类，该类与 web.config 接口并延迟加载配置值。使用工厂创建您的 DAL 并通过构造函数将配置类注入您的工厂，以便它知道如何使用从配置文件中检索到的 connectionsString 创建您的 DAL。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T23:43:09.857

我的问题来自于花了半天的时间试图完成这项工作，但是在部署时我一直得到错误的连接（我使用另一个数据库）。

我的问题是，我正在使用

```
My.Settings.DefaultConnectionString 
```

...在我的 VB 类库中检索 connectionString。

在遵循 tvanfossons anwer 之后，我又挖了一些，发现我可以简单地使用（在引用 system.configuration 之后）：

```
System.Configuration.ConfigurationManager.ConnectionStrings.Item("DefaultConnectionString").ConnectionString 
```

它在 web-config 中查找 webapplications，在 app.config 中查找 windows/类库应用程序。

我很高兴它现在可以工作，但更高兴我知道为什么。;)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-23T21:40:08.837

我遇到了同样的问题，我最终使用 System.Configuration.ConfigurationManager 类从我的类库中获取存储在我的 web.config 文件中的连接字符串，就像 Kjensen 的回答所建议的那样。这产生了奇迹，如果我有更多经验，我会投票赞成这个答案。

我需要连接字符串来构建我的 Linq2Sql 数据上下文，该方法为我提供了该上下文。

我现在构建我的数据上下文，如下所示（记得添加对 System.Configuration 的引用） -

公共 MyDataContext() : base(System.Configuration.ConfigurationManager.ConnectionStrings["MyConnectionString"] .ConnectionString, mappingSource)

只要 web.config 文件包含“MyConnectionString”，配置管理器就会负责其余的工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T15:11:23.470

我们将我们的保留在每个服务器的 machine.config 中，并有一个自定义 DAL 来处理我们的 Web 应用程序的所有数据库交互。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-14T15:11:44.873

将它放在连接字符串部分的 web.config 中。

在 VB 项目中使用 HttpContext.Current.GetSection 来检索节。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-14T23:51:05.873

一位开发人员曾经的想法是，我们应该将所有连接字符串存储在数据库表中。

不要尝试那样做。你不会走得很远。:)

# asp.net - 在站点处于活动状态时重新发布 ASP.NET Web 应用程序

> ID：646055
> 
> 赞同：6
> 
> 时间：2009-03-14T15:09:48.047
> 
> 标签：asp.net, deployment

我试图掌握如何在站点上有用户的情况下处理对实时运行的 ASP.NET（2.0 或更高版本）应用程序的更新。

例如，假设 SO 是一个 ASP.NET Web 应用程序项目。项目代码编译为 BIN 文件夹中的单个 .DLL。现在，SO 上经常有用户，那么如果您在用户使用该站点时使用 Visual Studio .NET“发布”功能（或者只是手动再次 FTP 所有内容），用户的操作/会话会发生什么？

相反，创建 ASP.NET 网站是否会缓解上述场景可能存在或不存在的任何问题？我开始将网站开发为用户驱动的 Web 应用程序，我想确保我在这方面的缺乏经验不会潜在地惹恼我 [想要] 24/7 拥有的 [潜在] 许多用户。

编辑：对不起，我应该把它放在更准确的上下文中。假设该站点由按月收费的网络托管服务托管。我不会管理服务器本身，只是网络主机允许作为其服务的用户。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-14T15:57:03.487

我在 IIS 中创建了两个网站。一个是生产网站，另一个是带有 HttpHandler 的静态网站，它将所有请求发送到单个静态“我们正在更新”HTML 页面，该页面使用 HTTP 503 服务不可用。通常更新网站是关闭的。当需要更新时，我们停止生产网站，启动更新网站，现在我们可以随意摆弄生产网站，而不必担心 DLL 被锁定或工作进程需要停止运行。

我开始这样做是因为

*   App_Offline.htm 在我们使用的 Web Gardens 中确实不能很好地工作。
*   App_Offline.htm 将其页面作为 404 提供，如果您在有意义的时间段内停机，这很糟糕。
*   我们可以使用修改后的设置启动升级后的生产网站（仅在 localhost 上监听），在我们打开开关、关闭更新网站并重新启用生产网站。

这不能解决的事情包括

*   任何需要重新启动服务器的维护——您仍然有停机时间，没有提供任何页面。
*   任何与 .NET 运行时有关的维护，例如升级到最新的服务包。

我见过的其他方法包括

*   有两台服务器。将所有负载均衡请求发送到一台服务器，升级另一台服务器；然后冲洗并重复。我们大多数人都没有这种奢侈。
*   创建多个 bin 目录，如 bin-1.0.0.0 和 bin-1.1.0.0 并告诉 ASP.NET 在 web.config 文件中使用哪个 bin 目录。（这样做的一个优点是恢复到以前的二进制文件只是编辑一个配置文件。一个缺点是很难恢复未在二进制文件中结束的资源，例如模板和图像等。）我不记住这实际上是如何工作的——我认为该应用程序基于其自己的 web.config 部分在其 Global.asax 中进行了一些后期程序集加载（因为您触摸了 web.config，该应用程序已重新启动，所以没关系）。

如果您找到更好的方法，请告诉我！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-19T06:52:34.230

更改为 asp.net 网站模型不会产生任何影响，因为循环也会发生，一些肯定会触发它的更改：web.config、global.asax、app_code。

回收后，用户仍将登录，因为 asp.net 只会验证语法。前提是您使用固定的机器密钥，否则每次回收时它都会改变。无论如何，这是您想要做的事情，因为如果请求之间的密钥更改即视图状态验证、嵌入式资源（url 的解密失败），其他东西可能会中断。

如果您可以将会话置于进程之外，例如在 sql server 中，您将避免丢失会话。如果你不能，你的代码将不得不考虑这一点。在很多情况下您可以避免使用会话，而在其他情况下，您可以包装它并在会话被清理后重新检索信息。这应该会给你留下一些你知道会给用户带来麻烦的特定案例，所以对于那些你做一些其他人已经提出的建议的人。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-14T15:35:22.027

一种解决方案可能是将您的应用程序部署到负载平衡环境（网络场）中。
部署新版本时，您将使用负载均衡器将请求重定向到您未部署到的服务器。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-14T15:40:37.723

我认为[App_offline.htm是很好的解决方案。](http://weblogs.asp.net/scottgu/archive/2005/10/06/426755.aspx)

在 SO 中，我们在部署开始时看到应用程序当前不可用页面。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-14T15:37:19.773

我不确定 SO 是如何处理它的。但我们通常会放置一个保留页面。因此，用户所做的任何事情（添加问题或回答问题）都不会得到更新。一旦他更新了一些东西，他就会看到一个等待页面，要求他稍后再试。

如果我是用户，我通常会按下后退按钮以确保我输入的内容保存在浏览器历史记录中，以便稍后发布。

某些站点使用是在集群环境中使用的，因此我将一台服务器脱机并通知负载均衡器她将不可用，一旦我确保新版本工作正常，我就会将其上线。我对下一个服务器。

我们还有其他选择吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T00:06:59.853

这不是一个技术解决方案，而是设置一个计划的维护窗口。您可以提前向您的用户群发出公平警告，即在该时间范围内应用程序可能不可用。

# frameworks - 用于审计的调度程序框架 - 软件过程的平衡和控制

> ID：646065
> 
> 赞同：-1
> 
> 时间：2009-03-14T15:13:51.750
> 
> 标签：frameworks, controls, audit, scheduler, balance

我正在寻找一个可以提供以下功能的调度程序框架 -

```
1\. Audit of the processes - start time, end time and throughput of the process
2\. Balance - if necessary schedule jobs according to the load
3\. Control - when to run a job? like cron of Unix, helps us to schedule processes at the specified time intervals. 
```

如果我们研究数据仓库类型的应用程序 - 假设我想监控 ETL 流程。提取完成后，应开始加载。加载时间不应超过 15 分钟 - 如果需要，则记录审核消息等。我确信必须有一些框架已经到位，有助于协调整个软件系统 - 何时运行哪些进程？他们的依赖是什么？如何记录进程的吞吐量等。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-06-30T08:00:26.893

如果您已经在使用 dbms_scheduler 的 oracle 环境中，那么答案将是。它具有您要求的所有功能以及更多功能。负载平衡内置于数据库中，由资源管理器处理并与 Oracle 调度程序完全集成。

您可以定义一个作业以在其运行时间超过预期时生成一个事件。监控进程可以从调度程序事件 Q 中选择该事件，并以您喜欢的方式对其做出反应。

有一本关于这个主题的[好书](http://www.packtpub.com/mastering-oracle-scheduler-in-oracle-11g-databases)，解释了如何充分利用它

最好的问候， [罗纳德](http://ronr.blogspot.com)

# asp.net - 使用 ASP.NET 的成本

> ID：646067
> 
> 赞同：19
> 
> 时间：2009-03-14T15:14:21.717
> 
> 标签：asp.net, mono, open-source

关于 ASP.NET 和 MSFT 技术，我经常听到的一件事是使用它们需要花钱。通常，当将它们与开源语言进行比较时，有人会提到支持开源的一个因素是它是免费的（在一定程度上）。我的问题是，就使用专有技术而言，ASP.NET 何时真正花钱使用？

可以理解的是托管费用，但我对这些托管费用之外的费用感到好奇。我对此特别好奇，因为它涉及到一个人的小型站点开发（非团队/大型企业）。任何帮助表示赞赏。

（编辑）

**一些优秀的答案。非常感谢** 我希望使用这些技术的项目将是个人站点和非常小的企业站点（1 或 2）。目的当然是让这些项目变得更大。似乎对于商业生产，将收取费用。仅提供信息的基本动态“共享托管”站点呢？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-14T18:04:48.577

在确定成本时，您必须衡量许多事情。我们最近接受了外部供应商对平台选择的评估，建议我们继续使用 Microsoft.NET 平台。为什么？对我们来说，原因是一旦您获得企业级产品套件，差异并不像人​​们希望您相信的那么大。

购买 Microsoft 产品是一个不错的选择。初始成本可能看起来很高，但请记住，如果您在购买时获得了软件保障（例如 Visual Studio），只要您保持 SA 最新，您就有权免费升级 - 而且成本只是成本的一​​小部分的回购。许多人认为您每次都需要购买完整的零售版，但事实并非如此。与 CDW 等大型供应商合作，帮助解决许可问题。他们让微软许可部门的人与我们通电话，帮助我们选择正确的方法。一点压力都没有。他们实际上在我们认为需要的一些事情上说服了我们。

MSDN 订阅很棒。我有一个通过我的雇主，但也用于个人维护一个。如果您是承包商/个体经营者，这是一项运营费用。与购买完整产品一样，与购买相比，续订 MSDN 订阅非常便宜，尤其是考虑到您所获得的内容。MSDN 中的许可相当慷慨，而且由于您是一家单人商店，如果我没看错的话，一个 MSDN 足以满足您的非生产需求。此外，捆绑的支持事件也是一个不错的加分项。

Visual Studio 有许多版本，从 Express Edition 一直到 Team Edition。例如，我们现在正在推出 Team Foundation Server，因此我们的成本显然更高。对于初创公司或小商店，有 TFS 托管合作伙伴，您可以免费获得 Team Explorer。或者，您可以混合搭配，使用 Visual Studio 进行开发，使用 VSS、SVN 或无数其他版本控制产品。

仅仅因为有人“开源”，并不意味着它是免费的。是的，平台选择可能是免费的，工具也可能是免费的，但是您很可能有一天会需要一个商业库或组件。此外，也没有什么能阻止您与 Microsoft 一起使用开源产品。有许多用 .NET 编写的开源项目可以与您的解决方案一起使用，而且 Microsoft 正变得更加透明。我们现在正在开发一个非常大的企业解决方案，并且在我们的开发工具之外，我们只使用一种“商业”产品。有很多开源用法，很多实现都是从社区的思考和示例中拼凑出来的。

经常被忽视的一件事是这些决策的人力成本。许多人讨厌微软，他们的解决方案可能不是最快或最强大的（尽管我将在 W2K8 上使用 IIS7，而不是任何其他 Web 服务器配置）他们专注于让人们在他们可以做的事情上更有效率。您不只是购买产品，您实际上是在购买生产力。作为在一些开源商店工作过的人，我非常感谢他们做对的所有事情，并且明白免费并不总是意味着更好。

我有一个“单人”副业，我真的建议您研究 MSDN 订阅。它将使您可以访问工具和技术，否则您将无法在没有零售路线点菜的情况下获得这些工具和技术。与 CDW 等人交谈，以帮助您确定您的许可需求。如果成功了，一定要试试这条路线。您可以通过 MSDN 订阅在一个人的商店中满足您的所有内部需求，最有可能（例如，许多产品可以安装给您（作为用户）最多十倍于机器它们安装在“你的”和非生产上。有例外，但不多。）

如果这不起作用，请尝试免费路线。您绝对可以将 Mono 用于 .NET 开发以及 Express Edition。我认识一些 C# 开发人员，他们对 Mono 发誓并且非常高兴。

祝你好运！

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-14T15:17:16.563

> 通常，当将它们与开源语言进行比较时，有人会提到支持开源的一个因素是它是免费的（在一定程度上）。我的问题是，就使用专有技术而言，ASP.NET 何时真正花钱使用？

通常，当人们以您描述的方式提及“成本”时，他们隐含地指的是 TCO 或[总拥有成本](http://en.wikipedia.org/wiki/Total_cost_of_ownership)。成本不是您直接为某物付费的显性成本，而是*在其生命周期内使用某物的长期价格*。

例如，即使一项特定的专有技术是免费的，雇用和找到了解它的人来从事您的项目可能会更加困难。因此，如果它不如某些开源同类产品受欢迎，那么您最终可能会为相同数量的劳动力支付更多费用，因为合适的人才将更难找到并且需求量更大。

相反，如果开源产品是免费的，但注意力不集中或性能不佳，那么为昂贵的闭源专有解决方案付费可能是值得的，而不必学习开源版本的特质。

自然，围绕如何衡量 TCO 存在一些争议，两个阵营都有一些有效点。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2009-03-14T16:13:14.710

*   .NET 是免费的
*   C# 编译器是免费的
*   某些版本的 Visual Studio 是免费的，而且您实际上并不需要它来为 .NET 编写（尽管它确实非常有帮助！）
*   有很多学习.NET的免费在线资源，比如[http://asp.net](http://asp.net)

简而言之，使用 ASP.NET 并没有真正的成本，除了网站的托管费用或您可能购买的选项（更好的 Visual Studio 版本）。

还有更多的意识形态分歧，一方面是开源人员非常反对微软，因此声称使用成本很高。我不会担心他们。;)

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-03-15T02:16:38.583

已经有几个很好的答案，但我想补充一下“这取决于”。

joseph.ferris 显然在一个大型组织中工作，切换平台的成本将非常非常昂贵，因此支付许可成本的成本远低于切换成本。看看 Jonathan Schwartz 在 3 月 11 日的[博客文章](http://blogs.oracle.com/jonathan/)，尤其是标题为“当免费太贵时”的部分，这是使用完全支持的基础架构的另一个原因。

但是考虑其他几个场景。

首先是业余爱好者，这似乎是你要解决的问题——你想玩弄这项技术，可能会建立一个或三个网站。隐私或可扩展性没有任何问题，因此您可以在廉价的共享托管解决方案上部署您的应用程序。在这种情况下，成本几乎无关紧要 - 无论您选择什么平台，您都可以获得免费工具来帮助您入门。 *记住孩子们，第一次点击总是免费的。*

对于初创公司来说，情况有些不同。如果目标是建立一个大型网站，那么潜在的许可成本可能会令人望而生畏——使用开源可能会便宜很多。除了生产环境，您还需要为开发环境、测试等付费。即使对于一家小公司，许可证也可能超出他们的预算——一个 Windows 2003 服务器企业版许可证清单价格为 4000 美元。如果您试图闯入竞争环境并在价格上竞争，仅此一项可能会让您失去竞争力。我见过基于 Windows 的解决方案（服务器、数据库和自定义开发加上内容管理系统）的价格是开源解决方案的两到三倍的情况。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2010-03-17T00:22:01.263

我知道它已被回答，但我会投入我的 2 美分。您为什么想知道 ASP.net 的成本？在我看来，在您的案例（1-2 人开发自由职业者团队）中选择技术应该由技术熟悉度决定。如果您是 ASP.net 专家，那么购买产品和订阅 MSDN 的费用是非常值得的，因为它是您熟悉的首选语言，因此您实施的项目将会做得更好更快，所以坚持下去是有意义的。

但是，如果您碰巧也了解另一种技术，并且您对可以按时交付强大的产品感到满意，那么降低成本可能是值得的。作为承包商，主要目标是不浪费时间/金钱，因此您选择一种能够平衡您的费用和学习时间的技术。换句话说，如果您是 Java 专家，那么为 asp.net 付费是没有意义的。如果你已经很了解 asp,net，那么当然，坚持下去。

客户很少关心您使用的是 Ruby、PHP、Python、Java 还是 ASP.net。他们关心时间线、成本和质量。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-14T15:19:07.947

我发现使用它并不需要太多钱。事实上，获得基于 Windows 的主机确实要花不少钱。Visual Studio 也很贵。但是，在那之后，遇到的费用并不多。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-14T15:26:11.813

如果您想使用更专业的 Visual Studio 版本来开发您的应用程序：您需要为此付费。此外，市场上有很多商业组件。这些将节省您的时间或改进您的产品，但需要付出一定的代价。

对于开源，也有很多组件，但在这个场景中大部分是免费/开放的。

# graphics - 查找在彩色表面上绘制的最易读的文本颜色

> ID：646068
> 
> 赞同：4
> 
> 时间：2009-03-14T15:17:15.500
> 
> 标签：graphics, colors, drawing, grayscale

我不知道如何问这个，但这里有。

我在屏幕上绘制了一个填充的彩色矩形。颜色是 R,G,B 的形式

然后我想在矩形顶部绘制文本，但是文本的颜色必须能够提供最佳对比度，这意味着它是可读的。

例子：

如果我画一个黑色矩形，文本的明显颜色将是白色。

我现在尝试的是这个。我将矩形的颜色传递给这个函数，它返回一个反转的颜色，然后我将它用于我的文本。

它有效，但这不是最好的方法。

有什么建议么？

```
// eg. usage: Color textColor = GetInverseLuminance(rectColor);
private Color GetInverseLuminance(Color color)
{
    int greyscale = (int)(255 - ((color.R * 0.30f) + (color.G * 0.59f) + (color.B * 0.11f)));

    return Color.FromArgb(greyscale, greyscale, greyscale);
} 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T17:34:59.257

保证提供显着不同颜色的一种简单方法是切换 RGB 三元组的每个组件的最高位。

```
Color inverse(Color c)
{
    return new Color(c.R ^ 0x80, c.G ^ 0x80, c.B ^ 0x80);
} 
```

如果原始颜色为#1AF283，则“反色”将为#9A7203。

对比将是显着的。我对美学不做任何保证。

**2009 年 4 月 3 日更新：**我尝试了这个和其他方案。结果在[我的博客](http://weblogs.asp.net/george_v_reilly/contrasting-colors-for-text-and-background)。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T15:28:27.237

最易读的颜色将是白色或黑色。最“舒缓”的颜色将不是白色也不是黑色，它将是一种与背景颜色形成轻微对比的颜色。没有办法以编程方式执行此操作，因为它是主观的。你不会为每个人找到最易读的颜色，因为每个人对事物的看法都不一样。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-14T16:03:38.650

关于颜色的一些技巧，特别是关于前景和背景并置的提示，例如与文本。

人眼本质上是一个简单的镜头，因此一次只能有效地聚焦一种颜色。大多数现代相机中使用的镜头通过使用多个不同折射率的镜头（彩色镜头）来解决这个问题，以便所有颜色同时聚焦，但人眼并没有那么先进。

出于这个原因，您的用户应该一次只关注一种颜色来阅读文本。这意味着**要么前景是彩色的，要么是背景，但绝不是两者兼而有之。** 这会导致一种通常称为振动的情况，在这种情况下，眼睛会在前景颜色和背景颜色之间快速转移焦点，试图分辨形状，但它永远不会分辨，形状永远不会聚焦，并导致眼睛疲劳。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-14T16:05:28.460

**如果您为它提供 RGB(127,127,127)，您的函数将不起作用**，因为它将返回完全相同的颜色。（修改你的函数以返回黑色或白色会稍微改善一些事情）

始终保持可读性的最好方法是在白色文本周围加上黑色，或者反过来。

它通常通过首先在 (x-1,y-1),(x+1,y-1),(x+1,y-1),(x+1,x+1) 和然后是 (x,y) 处的白色文本。

或者，您可以先绘制一个半透明的黑色块，然后在其上绘制不透明的白色文本。这样可以确保您的背景和文本之间始终存在一定程度的对比。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-14T15:22:17.017

为什么是灰色的？最好是黑色或白色。深色搭配白色，浅色搭配黑色。只需查看亮度是否高于阈值并选择一个或另一个

（顺便说一下，您不需要 .net、c# 或 asp.net 标签）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-14T15:28:32.853

你需要学习一些色彩理论。一个名为“Color Wheel Pro”的程序玩起来很有趣，会给你一个大致的想法。

本质上，您正在寻找给定颜色的互补色。

也就是说，我想你会发现虽然色彩理论有帮助，但你仍然需要人眼来微调。

# linq-to-sql - Linq - 将行添加到结果中仅用于显示

> ID：646081
> 
> 赞同：0
> 
> 时间：2009-03-14T15:21:35.990
> 
> 标签：linq-to-sql

我有一个 linq 查询，它返回一个简短的订单摘要 - 绑定到数据控件的产品描述和产品价格。我想在显示税收信息的同一个控件中添加要绑定的行。产品描述栏会简单地说“税”，而产品价格栏会给出税额。

我曾经检索这些结果的 DataTable 并简单地执行 NewRow()，然后将我的控件的数据源设置为 DataTable。我正在寻找使用 LINQ to SQL 时的等效技术。谢谢。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T16:43:46.777

`orderSummary.Union(taxRow)`

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T15:36:37.140

为了便于将另一个“行”添加到 LINQ 查询的结果中，您可能需要考虑创建一个类来保存查询的结果。然后，您可以将结果转换为列表，计算税款，并将税款附加为类的对象。

```
public class OrderSummary
{
    public string Description { get; set; }
    public decimal Amount { get; set; }
}

var taxRate = ...
var orderSummary = db.Orders.Where( o => o.ID == id )
                            .Select( o => new OrderSummary
                                {
                                    Description = o.Product
                                                   .Details
                                                   .Description,
                                    Amount = o.Qty * o.Product.Price
                                })
                            .ToList();

var tax = new OrderSummary
              {
                  Description = "Tax",
                  Amount = orderSummary.Sum( o => o.Amount * taxRate );
              };
orderSummary.Add( tax ); 
```

然后，您可以使用 Description 作为键和 Amount 作为值将列表绑定到您的控件。

# delphi - 自动构建脚本

> ID：646083
> 
> 赞同：1
> 
> 时间：2009-03-14T15:22:08.797
> 
> 标签：delphi, build-automation

如何在 delphi 项目的项目文件中增加版本。我正在使用 Delphi 10 进行 win32 应用程序开发。我包含一个项目的 bdsproj、dpr 和 res 文件。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-14T16:02:04.130

如果您使用 delphi 构建您的应用程序，您可以在 projectsettings 下打开 buildnumber 的自动递增。

我们使用自制实用程序根据 ini 文件中的值生成版本资源（rc 文件）。然后我们将 rc 文件编译成 res 文件，我们将其包含在项目中。我们使用 finalbuilder-scripts 来自动化这个过程。我知道 finalbuilder 对版本号有自己的支持，但我们不使用它。我不知道为什么，虽然...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-16T16:31:08.583

我之前使用了一个名为[StampVer](http://blog.dixo.net/downloads/stampver-win32-version-resource-stamping/)的程序，您需要在文件中已经有版本信息才能使用 StampVer。StampVer 是免费软件，但不是开源软件。

关于 stampver 的好处是它可以为你自动增加。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-16T10:02:26.457

我使用了一个合适的构建脚本工具[FinalBuilder](http://www.finalbuilder.com/)，它具有一组属性管理命令，可以将构建中的所有项目设置为相同的版本。这使我在整个构建中编号的一致性，以及整个负载也更多。如果您没有合适的构建工具，并且仍在使用批处理文件或等效文件，那么现在是查看选项的好时机。很值得去做。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-14T16:49:28.993

我使用一个程序来管理 .ini 文件中的版本号，并在项目的预构建事件中生成一个 .res 文件。此 .res 文件仅包含版本，不包含图标。该图标包含在单独的 .res 文件中。两者都包含在项目的 dpr 文件中：

```
{$R *_version.res}
{$R *_icon.res} 
```

只有 *__i_con.res 文件被检入到源代码控制中，如上所述，版本保存在 .ini 文件中，因此可以在必要时生成 *_version.res 文件。这消除了 .res 和 .dproj 文件由于内部版本号的增加而不断变化的烦恼。

哦，我刚刚意识到你说的是“Delphi 10”，我认为是 Delphi 2006。那个 Delphi 版本没有构建前和构建后的事件，所以你必须自己调用程序来维护版本。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-06-22T10:15:59.293

阅读 Primoz Gabrijelcic 的这篇文章[http://www.thedelphigeek.com/2008/01/tdm-rerun-2-better-build-process.html](http://www.thedelphigeek.com/2008/01/tdm-rerun-2-better-build-process.html) ，最初发表于 The Delphi Magazine。它包含有关您需要做什么的完整描述。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-14T20:07:36.660

如果您正在寻找一种非 gui 方式来执行此操作，那么我认为如果您查看 bdsproj 文件，您会在 xml 中找到编写版本的部分，您可以在此处更改它。下次构建时将使用此版本。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T18:06:44.390

DDevExtensions 中有一个构建增量器，我不确定如何获得 delphi 2006 版本，但我认为它存在并且非常方便。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-06-22T13:27:34.087

从 IDE 或外部编译时是否需要增加内部版本号？IDE 可以自动递增它，只需检查项目设置中的标志。在 IDE 之外增加该数字并不简单，因为它存储在由 IDE 管理和重新生成的默认 .res 文件中。命令行编译器不会修改它。有几种修改它的方法（正如其他答案所解释的那样），通常它最适用于可以生成内部版本号的构建系统，特别是如果有多个开发人员在项目上工作。我发布了 QC #70564 问题，询问可以通过命令行编译器设置版本信息。

# jsp - 下载并更改使用 JSP 生成的文件的扩展名

> ID：646085
> 
> 赞同：1
> 
> 时间：2009-03-14T15:22:39.247
> 
> 标签：jsp, csv, file-conversion

我正在使用 Java Server Pages (JSP) 生成一个 csv（逗号分隔值）文件。URL 显示“ `my_generated_csv.jsp`”。

我想做的很简单：用户点击“ `Generate`”下载生成的`CSV`文件。我想用 JSP 生成它。我需要重新考虑我的方法吗？

### 编辑：

以下代码使文件可下载，但扩展名保持不变。有谁知道如何改变它？

```
<% response.setContentType("text/csv"); %> 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T15:30:31.647

让 JSP 保存文件，然后为用户提供文件的链接。要么给页面一个 csv 文件 (text/csv) 的 MIME 类型。

我相信你会用

```
<% response.setContentType("text/csv"); %> 
```

设置 mime 类型。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T18:12:40.040

找到了答案：

```
response.setContentType("application/csv");
response.setHeader("Content-Disposition", "inline;filename=myfile.csv"); 
```

# c - 产品密钥的实现

> ID：646086
> 
> 赞同：23
> 
> 时间：2009-03-14T15:24:26.607
> 
> 标签：c, encryption, licensing, key, product

我正在用 C 语言实现一个小型应用程序，我想稍后以合理的价格将其作为共享软件出售。它将以 30 天的试用期开始，我已经非常确定如何实施它。

不过，我的问题是我不太确定如何实施产品密钥验证。我想到的是客户可以在我的网页上注册（在试用产品一段时间后），支付产品费用，并通过 e 获得 aaaaa-bbbbb-ccccc-ddddd-eeeee 形式的产品密钥-mail（或者可以通过他在我网站上的个人资料获得）。到目前为止没有问题。然后他/她将密钥放在我的应用程序的适当关键字段中，然后*应用*程序注册成功。

从我目前收集到的信息来看，人们要么为此推荐 AES 要么 RSA。老实说，我在大学的另一个方向（不是密码学），我上过的一门密码学课是不久前的。但据我记忆，AES 是一种对称加密算法，也就是说我只有一个密钥用于加密和解密，对吧？然后我怎么能生成数千个产品密钥并仍然在我的应用程序中验证它们（顺便说一句，这不需要互联网访问......所以不需要用服务器检查）？

所以我想RSA会是要走的路吗？但是 RSA 不会产生相当长的密钥（至少比上面所需的 25 个字符长）？

在[另一个线程](https://stackoverflow.com/questions/453030/how-can-i-create-a-product-key-for-my-c-app)中，我读到某些产品甚至不会使用加密来生成/验证产品密钥，而是只使用一些检查，例如“添加 2\. 和 17\. 字符，总计应为 x”。

去这里最快、最简单、最安全的方式是什么？:-) 代码示例将是糖！

问候，

塞巴斯蒂安

PS：哦...请不要告诉我我的密钥在某个时候会如何被破解......我知道，这主要是为什么我不想花很多时间在这个问题，但同时也不能让偶尔的破解者变得太容易。

* * *

## 回答 #1

> 赞同：35
> 
> 时间：2009-03-14T19:19:41.127

对称算法是有限的，因为任何具有反汇编程序的新手破解者都可以找到您的密钥（或用于生成密钥的算法）并制作“keygen”。

出于这个原因，非对称密码学是要走的路。基本前提是这样的：

*   当用户从您那里购买许可证时，您会收集有关用户和/或其环境的某些识别详细信息（通常，这只是一个全名；有时也是一个公司）。
*   您对此信息进行 128 位 MD5 散列。
*   使用 128 位[椭圆曲线加密，使用服务器上的](http://en.wikipedia.org/wiki/Elliptic_curve_cryptography)*私钥*加密此哈希。
*   128 位密文可以向用户表示为由字母和数字组成的 25 个字符的字符串（加上分隔破折号以提高可读性）。请注意，26 个字母 + 10 个数字 = 36 个离散值，并且 36^25 > 2^128。
*   用户在您的注册对话框中键入此产品密钥。客户端软件将其转换回 128 位数字（16 字节），使用您的 EC 加密的公钥对其进行解密，并将结果与​​用户个人信息的 MD5 散列进行比较，该散列必须与用于注册的内容相匹配.

当然，这只是基本的想法。有关更多详细信息和源代码，请参阅[基于椭圆曲线加密的产品密钥](http://www.codeguru.com/cpp/cpp/algorithms/general/article.php/c12799/Product-Keys-Based-on-Elliptic-Curve-Cryptography.htm)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T15:41:05.117

如果您只是购买解决方案，生活会更简单。

[http://www.kagi.com/kagisolutions/index.php](http://www.kagi.com/kagisolutions/index.php)

Kagi 允许您收款，他们可以帮助您管理密钥。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T15:54:41.370

一个人写了一篇关于他如何处理注册号问题的博客。他的一篇博客文章是[生成唯一注册号](http://www.mere-mortal-software.com/blog/details.php?d=2008-05-07)。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T16:23:43.313

是的，RSA 和 AES 是两个非常不同的东西：

*   RSA是公钥密码学，涉及公钥和私钥，速度相当慢。主要用途是建立对称加密会话密钥的安全交换。
*   AES 是对称加密，它既快速又安全。

由于您的应用程序不通过公共渠道进行通信，并且加密技术的使用仅限于产品激活/注册，因此您需要使用对称密码。公钥密码的好处在于密钥管理，您将在您的网站上或通过电子邮件进行处理。

请注意，您不必为每个客户分发相同的密钥。您可以生成一些注册信息的散列，然后将其与其他内容（也许是固定的会话密钥）进行异或。将其发送给客户，程序可以生成相同的散列，并对您发送的密钥进行异或运算以生成原始固定密钥。

处理密码学不是一件容易的事。正如您所提到的，您希望这会被破解。如果你自己做，这几乎肯定会发生。你仍然可以使用你自己的实现来“让诚实的人保持诚实”，但要意识到这是你所能得到的。如果您需要更强大的东西，那么您应该在对解决方案进行彻底研究后购买解决方案。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-14T18:39:17.527

您可以查看此[代码项目](http://www.codeproject.com/KB/cpp/softwarekey.aspx)文章。它描述了基于执行软件的机器的 MAC 地址的软件密钥的实现。正如作者本人承认的那样，该方法并不理想，并且与您正在寻找的方法有些不同，但也许它可以帮助您。

# java - Java Robot createScreenCapture 性能

> ID：646089
> 
> 赞同：12
> 
> 时间：2009-03-14T15:25:48.507
> 
> 标签：java, performance, swing

我需要抓取一系列屏幕截图并将它们连接成电影。我正在尝试使用 java Robot 类来捕获屏幕。

但是 createScreenCapture() 方法在我的机器上需要超过 1 秒。我什至无法获得1 fps。有没有办法加快速度？还是有其他API？

编辑：它正在分配缓冲图像。

BufferedImage image = robot.createScreenCapture(screen); //将截图保存为jpg
File file = new File("images/screen"+ index + ".jpg");
ImageIO.write(image, "jpg", file); 索引++；

将其写入 jpg 文件大约需要 200 毫秒，而获取 BufferedImage 大约需要 1400 毫秒。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T17:59:00.353

我建议为此使用 C 或 C++，它可以更直接地访问硬件。

如果您想要绝对的最大性能，请转到驱动程序级别，然后直接从视频卡中获取数据。很难找到这样的驱动程序，因为它可以用来轻松击败任何复制保护，因为它会在数据进入屏幕时抓取数据。

但是，如果您需要坚持使用 Java 和 Robot，您确定只是这一个函数调用需要这么长时间吗？它没有分配 BufferedImage 或其他东西？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-01-17T19:42:13.897

尝试使用不同的屏幕设置。颜色深度会影响它，因为 AWT 必须将所有内容转换为常见的光栅格式。

我的电脑上的一些示例计时：

```
 Resolution | Depth | Time taken 
------------+-------+------------
 1280x1024  | 32    | 215ms
 1280x1024  | 16    | 155ms
 1600x900   | 32    | 235ms 
```

我的适配器无法执行 24bpp 或 64bpp，因此我无法测试这些深度，但我猜想它们需要更多 CPU 周期才能转换。

# javascript - DOM 内存和 CPU 管理

> ID：646096
> 
> 赞同：1
> 
> 时间：2009-03-14T15:29:03.773
> 
> 标签：javascript, dom, elements

我正在创建一个逐步构建的单页（如果启用了 Javascript）“博客”，它使用 AJAX 为用户导航到的新页面请求 HTML。

当用户导航到新页面时，它们将在一个带有“溢出：隐藏；”的小窗口中一个接一个地添加到 DOM 中：

```
<div id="foo" style="width:200px; height:100px;">
  <div id="bar" style="width:999999px">
  </div>
</div> 
```

当 AJAX 调用返回成功时，将在 #bar 中附加一个 div。

当#foo 宽度之外有很多隐藏页面时，它将如何影响浏览器？

当用户离开它们时，我是否需要从 DOM 中删除 div？然后，如果用户选择再次导航到它们，我将需要发出新的 AJAX 请求。:(

谢谢

威廉

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T16:05:44.417

无论人们说 GC 会为您做什么，无论是在 JavaScript、C# 还是 Java 中，请当心并忘记自动管理的愚蠢承诺。明确地清理它并睡个好觉。

非常简单的原因：当你离开最简单的场景（浏览器的 JavaScript 和 C#/java 都是这种情况）时，闭包泄漏和泄漏非常糟糕。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T15:46:37.850

现代浏览器布局引擎通常足够智能，不会处理隐藏的元素，因此不会占用太多 CPU 资源。但是，在某些浏览器中添加大量具有高度复杂对象图的节点可能会很昂贵，因此我会小心处理。另请注意，即使它们没有布置，它们仍然作为 DOM 的一部分存在，如果这些节点很大，内存使用可能会成为一个问题。

# linux - 关于命令“find”的问题

> ID：646101
> 
> 赞同：3
> 
> 时间：2009-03-14T15:31:43.407
> 
> 标签：linux, shell, command-line

```
寻找 。\( -name "_*" -or -newer while2 \) -type f -print
```

在上面的 linux 命令中，为什么要引用 _* ？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-14T15:34:36.083

首先，shell 扩展所有未加引号的 * 以匹配本地目录中的文件名。

之后，shell`find`使用该文件名列表运行命令。

通常，您不希望 shell 在本地目录中执行 '*' 通配符。通常，您使用 find 命令在其他目录中进行文件名匹配。

shell 在运行命令之前还有其他几件事。$VARIABLE 替换就是其中之一。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-14T15:34:35.087

> 为什么 _* 应该被引用？

如果不是，您的 shell 可能会扩展`*`以替换为当前目录中的文件。这可能不是你想要的。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-14T15:38:11.863

如果你不引用它，shell（bash？）会尝试扩展。如果当前目录中有任何以 ' ' 开头的文件`_`，你会得到类似：

```
find . \(-name _somefile _someother _file3 .... -or -newer while2 \) -type f -print 
```

当然不是你想要的。我总是引用模式，只是为了确保外壳不会弄乱它们

# c++ - 开源和跨平台多人游戏/网络库？

> ID：646116
> 
> 赞同：3
> 
> 时间：2009-03-14T15:38:24.577
> 
> 标签：c++, open-source, network-programming, udp

虽然[raknet](http://www.jenkinssoftware.com/)看起来相当有趣并且从功能的角度来看确实很吸引人，但它的[许可条款](http://creativecommons.org/licenses/by-nc/2.5/)似乎对于可能在商业上利用的 GPL 项目来说可能很麻烦，这是知识共享许可条款明确禁止的。

虽然也有[opentnl](http:///www.opentnl.org)，但它现在似乎不再被积极维护，事实上下载最新的稳定 tarball 甚至在编译过程中也会失败，因为它似乎不支持 gcc >= 3.0 (?)

当然，还有[enet](http://enet.bespin.org/)，但是这个不能和 raknet/opentnl 支持的抽象特性相比。

那么，除了诸如 ACE、Boost 或 Poco 之类的重要依赖项之外，是否有任何可行的替代方案来嵌入一个相当紧凑、维护良好的 UDP 网络库？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T17:12:25.583

Ogre3D的[wiki](http://www.ogre3d.org/wiki/index.php/Libraries#Networking)提供了一个网络库列表和对它们的简短描述。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-16T22:14:40.333

虽然这个答案来晚了，但我在我的游戏 Bitfighter 中使用 OpenTNL [，](http://bitfighter.org)我真的很喜欢它。我在 OS X、Windows 和 Linux 上使用它没有任何障碍。确实，它不是由它的创建者维护的，但是当我有时间时，我将为它创建一个新的 SourceForge 项目，这样人们就有地方发布他们的补丁了。它很稳定并且（相当）有据可查，所以我建议再看一下。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-03T00:42:46.473

我一直在寻找非常相似的东西，但无济于事。因此，我决定创建自己的 C++ 网络库，在撰写本文时它还没有完成，但很快就会完成。如果您有兴趣尝试一下，我会及时通知您。到目前为止，它的功能是 TCP/UDP、IPv4、IPv6 Async/Sync 和多播。如果您有任何其他需要实现的功能，请告诉我 :)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T22:21:51.210

不幸的是，网络编程往往不是微不足道的。

说建议您熟悉 Boost 或 ACE 的网络编程工具，因为它们都是已在许多应用程序中成功使用的成熟库。

我还建议阅读[C++ Network Programming: Mastering Complexity Using ACE and Patterns](http://www.cs.wustl.edu/~schmidt/ACE/book1/)和[C++ Network Programming: Systematic Reuse with ACE and Frameworks](http://www.cs.wustl.edu/~schmidt/ACE/book2/)

# java - 如何使用 JCreator (Pro) 设置执行目录？

> ID：646117
> 
> 赞同：1
> 
> 时间：2009-03-14T15:38:49.333
> 
> 标签：java, jcreator

是否可以在指定目录中执行一个类？

我的意思是，a.class 在目录 abc 中，我希望它像在目录 xyz 中一样执行（直接来自 JCreator 的 IDE）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-22T19:42:06.250

这不是在运行时环境设置中吗？如果不是，我会尝试创建一个运行 JCreator 完整路径的快捷方式，但将当前目录设置为您希望执行的位置。

# jquery - jQuery元素选择器问题

> ID：646118
> 
> 赞同：0
> 
> 时间：2009-03-14T15:39:05.510
> 
> 标签：jquery, fancybox, selector

我的问题有点复杂。

我有以下代码：

```
$(document).ready(function() {

    var hash = window.location.hash.substr(1);
    var href = $('#nav li a').each(function(){
        var href = $(this).attr('href');
        if(hash==href.substr(0,href.length-5)){
            var toLoad = hash+'.html #content';
            $('#content').load(toLoad)
        }                                           
    });

    $('#nav li a').click(function(){

        var toLoad = $(this).attr('href')+' #content';
        $('#content').hide('fast',loadContent);
        $('#load').remove();
        $('#wrapper').append('<span id="load">LOADING...</span>');
        $('#load').fadeIn('normal');
        window.location.hash = $(this).attr('href').substr(0,$(this).attr('href').length-5);
        function loadContent() {
            $('#content').load(toLoad,'',showNewContent())
        }
        function showNewContent() {
            $('#content').show('normal',hideLoader());
        }
        function hideLoader() {
            $('#load').fadeOut('normal');
        }
        return false;

    });

}); 
```

好的，首先它不是我编写的，所以我真的不明白它的作用，我也试图改变它，但我没有成功。该代码将选择一个“nav li”链接并以 AJAX 方式显示页面，这意味着无需重新加载它。它正确地做到了这一点:) 现在，我要做的就是添加一个fancybox 来注册用户。为此，我应该添加以下代码。

```
$("a#reg").fancybox({
    'hideOnContentClick': false
}); 
```

现在我只是将代码放在 $document.readyfunction 中，花哨的盒子可以正常工作，nav li 链接也可以正常工作。那么问题出在哪里？当我点击“nav li”链接并加载内容然后再次点击主页链接时，（我返回第一页），花式框不再起作用。我知道它非常敏感，所以可能你对它有不好的理解，所以让我换一种方式解释它。我有'nav li'的选择器和花式框链接的选择器，让它们一起工作的最佳方法是什么？

也有人可以向我解释代码的作用。
谢谢你。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T16:10:33.563

好的......这是代码的作用：

```
 var hash = window.location.hash.substr(1);
    var href = $('#nav li a').each(function(){
        var href = $(this).attr('href');
        if(hash==href.substr(0,href.length-5)){
                var toLoad = hash+'.html #content';
                $('#content').load(toLoad)
        }                                                                                       
    }); 
```

第一部分将获取当前页面的[哈希值](https://developer.mozilla.org/en/DOM/window.location)，检查其中一个“nav li”链接是否以该哈希值结尾（预期为 5 个字符），如果是这种情况，将在当前页面的元素`#content`中加载页面元素（I假设它是一个div）。`hash + ".html"``#content`

想象一下，您加载了网址“ [http://.../page1.html#page2](http://.../page1.html#page2) ”。Page1 将被加载，然后 page2.html 的 #content 将通过 page1 的 #content 中的 ajax 调用加载。

```
 $('#nav li a').click(function(){

        var toLoad = $(this).attr('href')+' #content';
        $('#content').hide('fast',loadContent);
        $('#load').remove();
        $('#wrapper').append('<span id="load">LOADING...</span>');
        $('#load').fadeIn('normal');
        window.location.hash = $(this).attr('href').substr(0,$(this).attr('href').length-5);
        function loadContent() {
                $('#content').load(toLoad,'',showNewContent())
        }
        function showNewContent() {
                $('#content').show('normal',hideLoader());
        }
        function hideLoader() {
                $('#load').fadeOut('normal');
        }
        return false;

    }); 
```

这将为“nav li”链接添加以下行为：单击时，显示“加载消息”并在当前页面的#content 元素中加载目标页面的#content。

I don't have any idea why this script, despite being terrible, would cause your fancybox not to show. My guess is that the "nav li" links will load the content with an ajax call and this will not affect your fancybox, which is already loaded, but when you click the home link, the page is completely reloaded and the fancybox code is not executed, for a reason. You can check that by adding a simple alert :

```
alert("initializing fancybox");
$("a#reg").fancybox({
    'hideOnContentClick': false
}); 
```

If the full page is reloaded when you click the home link, and this alert does not popup, you found the cause of your problem.

# ruby - 不使用字符串文字时的字符串插值

> ID：646126
> 
> 赞同：15
> 
> 时间：2009-03-14T15:47:49.763
> 
> 标签：ruby

我有一个 Ruby 脚本，它使用字符串插值来构建错误消息。

```
p "#{vName} is not a defined variable"  => 'xxx is not a defined variable' 
```

另一位程序员通过并试图将字符串文字外部化到单独的配置文件中。当然，他没有得到替补。

```
p err_string_from_config  => '#{vName} is not a defined variable' 
```

我环顾四周，但想不出比转换为 sprintf 字符串并使用 printf 更好的方法。

有人知道如何让 #{} 替换来处理 Ruby 脚本中不是双引号文字的字符串吗？

* * *

## 回答 #1

> 赞同：24
> 
> 时间：2009-03-14T16:21:41.557

实际上 Ruby 的功能与 John 的 Python 示例非常相似：

```
$ irb
>> greeting = 'hello %s, my name is %s!'
>> interpolated = greeting % ['Mike', 'John']
=> "hello Mike, my name is John!"
>> 
```

如果您的参数是数组常量，这也很有用。如果您必须使用 #{} 样式插值，您可以使用 eval：

```
>> greeting = 'hi #{name}'    # notice name is not defined yet
>> name = "mike"
>> eval '"' + greeting + '"' 
```

eval 方法将比使用 % 样式插值慢得多，因此这是一种权衡。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T17:35:53.997

我建议你看一下[Liquid 模板语言](http://www.liquidmarkup.org/)，它提供了更强大的功能（例如，你可以通过名称引用参数）。上一个示例如下所示：

```
greeting = Liquid::Template.parse("hello {{your_name}}, my name is {{my_name}}!")
interpolated = greeting.render('your_name' => 'Mike', 'my_name' => 'John')
# => "hello Mike, my name is John!" 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-14T16:57:23.047

这是我的做法，仅供参考。更清晰的imo。

```
gief = '#{later} please'
later = "later"

puts eval(%Q["#{gief}"])
# => later please 
```

但老实说，这是*一个*黑客。除非您有充分的理由使用字符串，否则请改用 proc。我总是尝试使用纯红宝石而不是评估字符串。

```
gief = Proc.new {|l| "#{l} please" }
later = "later"

puts gief.call(later)
# => later please 
```

# sql-server-2008 - 用于 sql express 2008 的 sql profiler 显示带有参数信息的查询

> ID：646127
> 
> 赞同：1
> 
> 时间：2009-03-14T15:48:03.773
> 
> 标签：sql-server-2008, trace, sql-server-profiler

重复：[sql profiler 是否向您显示传入的参数值？](https://stackoverflow.com/questions/645876/does-sql-profiler-show-you-the-paramater-values-that-were-passed-in) （由同一用户询问。）

你好，

我需要一个 sql profiler 来显示调用到数据库的所有 sql（原始 sql 或 sproc），以及传递给查询的参数。

如果有试用版，我不介意商业产品。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T15:52:54.713

这是我与 SQL Server 2008 一起使用并取得巨大成功的开源项目： [SqlExpressProfiler](http://code.google.com/p/sqlexpressprofiler/)

[这是带有参数值的屏幕截图：](http://www.freeimagehosting.net/uploads/db50c0a595.png)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-23T19:40:03.470

[您可以在http://www.xsqlsoftware.com/Product/xSQL_Profiler.aspx](http://www.xsqlsoftware.com/Product/xSQL_Profiler.aspx)上查看 xSQL Profiler 。 它对 SQL Express 是免费的。

# fluent-nhibernate - Fluent NHibnernate HasManyToMany 和索引

> ID：646138
> 
> 赞同：2
> 
> 时间：2009-03-14T15:59:11.220
> 
> 标签：fluent-nhibernate

我正在尝试使用 Fluent NHibnernate 映射多对多集合。我的模型类有这个属性：

```
public virtual IList<Resource> Screenshots
{
    get { return _screenshots; }
    protected set { _screenshots = value; }
} 
```

我流畅的映射是：

```
HasManyToMany(x => x.Screenshots)
                .AsList(x => x.WithColumn("Index"))
                .Cascade.AllDeleteOrphan(); 
```

当我运行我的应用程序时，我收到以下异常消息：

> 命名空间“urn:nhibernate-mapping-2.2”中的元素“列表”在命名空间“urn:nhibernate-mapping-2.2”中具有无效的子元素“多对多”。预期的可能元素列表：命名空间“urn：nhibernate-mapping-2.2”中的“索引，列表索引”。

应该有办法做到这一点。有谁知道我做错了什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2011-05-07T05:05:50.117

当前的 FluentNHibernate 语法如下：

```
HasManyToMany(x => x.Screenshots)
    .AsList(i => i.Column("`Index`")); 
```

索引列默认为索引，但这是 SQL Server（可能还有其他数据库）上的保留字，因此您必须用反引号引用它。

另外，我建议不要对这种关系设置级联。考虑以下代码：

```
x.Screenshots.Remove(s);
session.SaveOrUpdate(x); 
```

即使没有指定级联，NHibernate 也会正确地从链接表中删除行。但是，如果您指定 AllDeleteOrphan，则 NHibernate 将从链接表中删除该行并删除 Resource `s`。我怀疑这是您在多对多关系中想要的行为。

# asp.net - Jqmodal 在更新面板中不起作用

> ID：646140
> 
> 赞同：0
> 
> 时间：2009-03-14T16:00:41.043
> 
> 标签：asp.net, jquery, ajax, updatepanel, jqmodal

我有一个名为 raise_alarm() 的方法，它显示一个基于 jquery 的消息框。但是，当我从 Updatepanel 内部的控件事件（例如提交按钮）调用此方法时，它不起作用。相关代码如下。我该如何解决？

```
 Public Sub Raise_Alarm(ByVal p_Page As Page, ByVal p_Message As String, Optional ByVal p_IsError As Boolean = True)
        Dim strScript As String
        strScript = "$(function() { Mesaj('" & p_Message & "'); });" & ControlChars.NewLine
        p_Page.ClientScript.RegisterStartupScript(p_Page.GetType(), "alert", strScript, True)
end sub

Private Sub dtlQuestion_ItemCommand(ByVal source As Object, ByVal e As System.Web.UI.WebControls.DataListCommandEventArgs) Handles dtlQuestion.ItemCommand
        If Not User.Identity.IsAuthenticated Then
            Raise_Alarm(Me, "Giriş Yapmadan Oy Veremezsiniz")
            Exit Sub
        End If
end sub 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T16:13:18.050

您必须使用`ScriptManager`而不是`p_Page.ClientScript`.

编辑：示例。我在您的代码中替换`p_Page.ClientScript`为。`ScriptManager`

```
Public Sub Raise_Alarm(ByVal p_Page As Page, ByVal p_Message As String, Optional ByVal p_IsError As Boolean = True)
        Dim strScript As String
        strScript = "$(function() { Mesaj('" & p_Message & "'); });" & ControlChars.NewLine
        ScriptManager.RegisterStartupScript(p_Page.GetType(), "alert", strScript, True)
end sub

Private Sub dtlQuestion_ItemCommand(ByVal source As Object, ByVal e As System.Web.UI.WebControls.DataListCommandEventArgs) Handles dtlQuestion.ItemCommand
        If Not User.Identity.IsAuthenticated Then
            Raise_Alarm(Me, "Giriş Yapmadan Oy Veremezsiniz")
            Exit Sub
        End If
end sub 
```

ClientScript 没有启用 ajax，ScriptManager 知道如何处理部分回发。请在 msdn 上快速查看[这篇文章](http://msdn.microsoft.com/en-us/magazine/cc163354.aspx)。

# iphone - 如何检测鼠标/手指是否沿特定路径移动？

> ID：646141
> 
> 赞同：1
> 
> 时间：2009-03-14T16:00:57.533
> 
> 标签：iphone, path, onmousemove

我正在为 iPhone 开发一个应用程序，我想检测用户何时沿着特定路径移动手指。

具体来说，我想检测用户何时沿着特定的圆形路径移动手指。

这可能很容易通过检测沿路径的鼠标运动来适应。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T18:04:32.370

似乎一个特定的案例可以相当简单地实现。将输入区域划分为四个象限，并通过每个象限跟踪位置。象限的顺序决定了它们是否已经完成或绕了一圈。

描述这个想法的伪代码：

```
static touchKeeper; //touch, quadrant
static touchIndex=0;
- (void)touchesMoved:(NSSet *)touches withEvent:(UIEvent *)event
{
   UITouch *touch = [[allTouches allObjects] objectAtIndex:0];
   touchKeeper[touchIndex].touch =  touch;
   touchKepper[touchIndex].quadrant = DetectQuadrant(touch));
   if (touchIndex > 3 && (touchKeeper[3].quadrant == touchKeeper[2].quadrant+1 == touchKeeper[1].quadrant+2 == touchKeeper[0].quadrant+3)) {
     [self doCircleAction];
     touchIndex=0;
   } 
     else touchIndex++;
 } 
```

这个想法是你只需要粗略地识别一个区域的特定触摸。所以象限例程是这样的：

```
int DetectQuadrant(UITouch *touch) {
 CGPoint point;
 point = [touch locationInView:self];
 if (endPoint.x > X1 && endPoint.x < X2 && endPoint.Y > Y1 && endPoint.Y < Y2)
  return QUAD1;
 } else etc 
```

我以象限为例——显然你可以画一个正方形，然后想'圆！'。通过在 Detect 方法中制作更多区域来提高准确性。主要思想是根据区域序列进行思考，以便在没有过多复杂性的情况下实现所需的行为（如贝塞尔曲线检测或类似的废话）。这个伪代码肯定是野蛮的，我相信有一个很好的方法来完善实现。我一直在为我正在从事的项目考虑“圆周运动检测”，这是我想出的粗略想法。

享受！

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T16:14:32.353

由于我不熟悉 iPhone SDK 本身，我不确定是否有用于捕获非标准手势的内置设施。但是，这是您可以执行此操作的手动方法之一。

[本教程](http://www.bytearray.org/?p=91)适用于 Flash，但它的操作原理相同。每个方向代表一个数字。使用指点设备跟踪一个圆圈将生成一系列数字，代表随着时间或距离行进的方向，这取决于您。将该数字序列与表示圆圈的预定义序列进行比较。如果它们匹配，则触发一个事件。

有很多教程解释了如何制作像这样“模糊”的手势，这样就需要不太精确的点运动。

# language-agnostic - 跨平台开发的好处？

> ID：646149
> 
> 赞同：3
> 
> 时间：2009-03-14T16:06:09.533
> 
> 标签：language-agnostic, cross-platform

在两个或更多不同平台上开发应用程序有什么好处吗？即使在同一个平台上使用不同的编译器也有好处吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T16:11:06.277

是的，特别是如果您计划为多个平台分发代码。

但即使你不跨平台开发也是一种面向未来的形式；如果它今天在多个（不同的）平台上运行，它更有可能在未来的平台上运行，而不是经过调整、调整和专门用于供应商 X 的 Q 系列盒子的 7.8.3 版全新安装（补丁级别 1452） )，仅此而已。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T16:11:12.517

使用不同的编译器和不同的操作系统查找并简单地防止错误似乎是有好处的。不同的 CPU 可以尽早解决字节序问题。如果您想在该级别保持原生，那么在 GUI 级别会很痛苦。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-14T16:13:24.727

简短的回答：是的。

如果不克隆磁盘，几乎不可能使两个系统完全相同，因此无论您是否有意，您最终都会在“不同的平台”上运行。通过专门面对和解决“如果系统 A 不像 B 那样做事情怎么办？” 你的问题更可能找到你的代码所做的那些关键假设。

也就是说，我想说你应该让你的大部分基本代码在系统 A 上运行，然后花一天（或一周或……）让它在系统 B 上运行。这可能很有教育意义。

当我将源级 C 调试器移植到 100 多种 U*NX 中时，我的教育又回到了 80 年代。盖克！

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-14T16:23:40.507

> 在两个或更多不同平台上开发应用程序有什么好处吗？

如果这是生产软件，显而易见的原因是更大客户群的诱惑。当客户听说您支持多个平台时，您的产品的吸引力就会被放大。请记住，大多数企业不使用单一操作系统，甚至不使用单一版本的操作系统。找到一个使用 Windows、另一台 Mac 和较小版本的 Linux 的部分是相当典型的。

还可以看出，为单个平台定制产品通常比让它在多平台上运行要乏味得多。收益递减规律甚至在你知道之前就开始了。

当然，如果您正在为客户专有硬件的现有产品进行定制工作，那么所有这些都毫无意义。但即便如此，也要留意你的客户在他的曲目中拥有的所有硬件——你永远不知道他什么时候会要求它。

> 即使在同一个平台上使用不同的编译器也有好处吗？

是的，再次。不同的编译器实现不同的扩展。确保您不依赖于特定编译器的特定版本。

此外，编译器本身可能存在一两个错误。使用多个编译器有助于解决这些问题。

我进一步看到了使用两种不同编译器的（跨平台）产品的一些部分——一个用于浮点操作需要非常高准确度的模块中。（有一段时间我听说其他人这样做，但是......）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-14T16:29:13.970

我已经将一个大型 C++ 程序（最初是 Win32）移植到 Linux。这不是很困难。主要处理编译器不兼容问题，因为当时的 MS C++ 编译器在各种方面都不兼容。我预计这个问题现在已经基本消失了（直到 C++0x 功能开始逐渐出现）。还编写了一个简单的平台抽象库，将特定于平台的代码集中在一个地方。这取决于您对操作系统服务的依赖程度，这些服务在新平台上难以模仿。

您不必从头开始构建可移植性。这就是为什么“移植”通常被描述为您可以在最重要的平台上首次发布后一次性执行的活动。您不必从一开始就连续进行。纯粹出于经济原因，如果你能避免做可能永远不会有回报的工作，显然你应该这样做。以后移植的成本，当真的有必要时，结果并没有那么糟糕。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-14T16:37:16.713

大多数情况下，有一个为（**单个软件**）编写应用程序的现有平台。但是，如果您决定提供一种独立的语言，那么您将面向**更多的开发人员（两个平台）。**

中小企业的产品（**标准软件**）如果在不同的平台上运行，**也可以更好地销售！**您可以进入两个市场，WIN&LINUX！（和 MacOSx 等等......）

大公司大多购买产品供应商支持/认证的硬件，只是为了部署指定的产品。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-14T17:12:42.087

如果您同时在多个平台上开发，您将获得能够使用不同工具的优势。例如，我曾经有一次内存覆盖（我仍然发誓我不需要空字节的 +1！）导致“免费”崩溃。我在 Windows 上加快了代码的速度，并在大约 1 分钟内用 Rational Purify 发现了覆盖……在 Linux 下我花了一周的时间来追逐它（valgrind 可能已经找到它……但我不知道当时）。

对我来说，相同或不同平台上的不同编译器是必须的，因为每个编译器都会报告不同的东西，有时一个编译器关于错误的报告会是胡言乱语，但另一个编译器会说得很清楚。

在开发过程中使用多个数据库之类的东西意味着您不太可能将自己绑定到特定数据库，这意味着如果有理由可以换出数据库。例如，如果您想将使用 Oracle 的东西集成到使用 SQL Server 的现有基础架构中，那它真的很糟糕——如果可以将 Oracle 或 SQL Server 部分移动到另一个系统（我知道有些地方有 3 个不同的他们的金融系统的数据库...... ick）。

一般来说，总是为两三件事开发意味着你发现错误的几率更高，系统更灵活的几率更高。

另一方面，所有这些都需要时间和精力，而这在当下被视为不必要的费用。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-14T16:17:09.943

有些平台有非常糟糕的开发工具。我曾经在一家 IB 工作过，他们没有使用 Sun 可怕的工具集，而是使用 VC++ 开发代码，然后移植到 Solaris。

# asp.net - Silverlight 的 WebClient 没有连接到我的服务器

> ID：646150
> 
> 赞同：0
> 
> 时间：2009-03-14T16:10:10.617
> 
> 标签：asp.net, httpwebrequest, silverlight-2.0, webclient

我这里有问题。

我有一个托管 silverlight 2 应用程序的 ASP.net 网站。我希望该站点能够与 silverlight 应用程序来回通信，并且我正在通过 http 请求进行此操作。顺便说一句，如果有人知道更好的方法，请告诉我。

我的服务器设置了以下 http 侦听器。我从某处的教程站点复制了这个，因为它目前主要是实验：

```
 HttpListener listener = new HttpListener (  );
      listener.Prefixes.Add("http://localhost:4531/MyApp/");  
      listener.Start(  );                                         

      // Wait for a client request:
      HttpListenerContext context = listener.GetContext(  );

      // Respond to the request:
      string msg = "You asked for: " + context.Request.RawUrl;
      context.Response.ContentLength64 = Encoding.UTF8.GetByteCount (msg);
      context.Response.StatusCode = (int) HttpStatusCode.OK;

      using (Stream s = context.Response.OutputStream)
      using (StreamWriter writer = new StreamWriter (s))
        writer.Write (msg);

      listener.Stop(  ); 
```

我正在使用以下代码发送请求：

```
 private void MyButton_Click(object sender, RoutedEventArgs e)
        {
            Button b = sender as Button;
            b.Content = "Hello World";

            Uri serviceUri = new Uri("http://localhost:4531/MyApp/");
            WebClient downloader = new WebClient();
            downloader.DownloadStringCompleted += new DownloadStringCompletedEventHandler(TestDownloadStoriesCompleted);
            downloader.DownloadStringAsync(serviceUri);

        }
        void TestDownloadStoriesCompleted(object sender, DownloadStringCompletedEventArgs e)
        {
            if (e.Error == null)
            {
                TextBox1.Text = e.Result;
            }
        } 
```

我的问题是我可以使用几乎相同的代码从控制台应用程序连接到网络服务器（我通过在代码中设置断点对其进行了测试），但是当我单击 Silverlight 中的按钮时没有任何反应。（我添加了“Hello World”来测试我确实将代理连接到按钮。）

我读过silverlight 需要通过webclient 连接的策略，但如果我为服务器和silverlight 应用程序使用相同的服务器和相同的域，情况就不应该如此！

感谢您的回复！

编辑：我收到此异常：

System.Security.SecurityException ---> System.Security.SecurityException：安全错误。

此外，根据我正在[阅读](http://scorbs.com/2008/04/05/silverlight-http-networking-stack-part-1-site-of-origin-communication/)的内容显然是源站点，xap 的部署 URI 和请求 URI 也必须是相同的端口。

但是，当我将服务器的属性设置为托管在特定端口上，并将侦听器设置为侦听同一端口时，它会失败并显示消息该进程无法访问该文件，因为它正在被另一个进程使用. 我认为这是因为 http 侦听器无法侦听用于托管它的同一端口：| 但是，我怎样才能让 Silverlight 执行源 Web 客户端请求的主机呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T17:04:37.490

由于这只是一个测试添加一个“else TextBox1.Text=e.Error.ToString();” 在您的 TestDownloadStoriesCompleted 处理程序中查看您收到的错误。

编辑：

您不能在同一端口上同时托管 asp.net 应用程序和侦听器 - 您可以通过使用不同的端口并从 httplistener 提供 clientaccesspolicy.xml 来解决此问题。

但是，我认为查看 WCF Web 服务对您来说更有意义（您将 svc 添加到您的 asp.net 应用程序中）。这是一个[示例](http://blogs.msdn.com/suwatch/archive/2008/04/07/tutorial-using-silverlight-web-service-client-configuration.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T23:42:38.703

您可以使用[http://www.fiddler2.com/fiddler2/](http://www.fiddler2.com/fiddler2/)之类的工具 来实际查看请求期间发生了什么......这可以为进一步调试提供一些帮助......

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T18:54:10.690

我现在使用 HTTP 处理程序进行通信。尽管我仍然想尝试一些 WCF，但它们似乎可以很好地满足我的目的。

# css - 我怎样才能在 CSS 和 HTML 中实现这样的东西？

> ID：646151
> 
> 赞同：0
> 
> 时间：2009-03-14T16:10:32.067
> 
> 标签：css, html

我怎样才能在 CSS 和 HTML 中实现这样的东西？

```
 <bod>     
 <div id="corner">    
 <div id"link_img"></div>  
 <div id "link_text">LINK</div> 
 <div> 
 <bod> 
```

[http://img7.imageshack.us/my.php?image=linke.jpg](http://img7.imageshack.us/my.php?image=linke.jpg)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T16:26:52.993

像这样的东西（如果你不能改变标签，但可以添加`&nbsp;`一个

```
 <div id="corner">    
     <div id="link_img">&nbsp;</div>  
     <div id="link_text">LINK</div> 
 <div> 

<style type="text/css">

#link_img {float: left; width: 20px; background-color: #ffff00; margin-right: 5px;}
#link_text {float: left; color: #ffff00;}

</style> 
```

如果你不能添加`&nbsp;`你需要`height: 20px;`的`#link_img`

或者是这样的：

```
<div id="link_text">LINK</div> 

<style type="text/css">

#link_text {color: #ffff00; border-left: 20px solid #ffff00; padding-left: 5px;}

</style> 
```

# php - AJAX 和 MVC 模式

> ID：646156
> 
> 赞同：4
> 
> 时间：2009-03-14T16:11:53.357
> 
> 标签：php, ajax, model-view-controller

如果存在类似问题，请重定向我。我找不到任何东西，但我确信我的问题相当普遍......

我有一个包含 5-6 个 div 的页面，可以通过 Ajax 请求单独加载。通过原型 ajax.request()，服务器 (php) 在客户端刷新 div 的 innerHTML 之前回显该部门的 HTML 代码。

这是我的问题：**关于它抛出的 HTML 代码，在服务器端保留 MVC 模式的最佳实践是什么？**

目前，我的模型将数据库数据返回给控制器，使其能够启动一个**非常长**的 var，其中包含它随后回显的 HTML 代码。我的问题是我的控制器类中有很多 HTML 代码......

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-14T16:14:59.963

您可以使用[JSON](http://json.org/)将数据传输到客户端并在那里构建它。这样，您将拥有一个不受标记约束的抽象数据源。JSON 可以直接评估为 javascript 对象。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T17:10:00.957

你真的喜欢使用 MVC 吗？C 主要可以通过约定/RESTful URL 删除。

就像 Andy 说的，你应该使用 JSON 将数据传输到客户端。XML 也是一种广泛使用的替代方案（因为如果其他应用程序必须使用您的服务，它的效果会更好）。XML 可以轻松转换为 JSON！JSON 代码是有效的 JavaScript 对象代码。因此，您可以使用它来将客户端模板与它缝合在一起。

您应该尝试将[EJS](http://embeddedjs.com/)用于浏览器/客户端模板！如果这样做，您的控制器中就没有 HTML 样板！只是业务逻辑。这遵循了许多 SOA 最佳实践。架构模式称为 SOFEA 或 SOUI（相同）。

我已经用它写了我的主页。很多模板引擎的评估已经证明 EJS 是最佳候选者。

因为： 1\. 速度快！2\. 它是免费的（MIT 许可证）！3\. 它与JQuery 4\. 配合得很好。它确实修改了DOM，所以其他方法可以访问使用的模板（[JS Repeater](http://jsrepeater.devprog.com/)不能）。

其他框架：

1.  [JSmarty](http://code.google.com/p/jsmarty/)：不是那么好用，但可以使用 Smarty 模板。它尚未经过企业验证，仍在大力发展中。

2.  [Trimpath Javascript 模板](http://code.google.com/p/trimpath/wiki/JavaScriptTemplates)：不适用于 JQuery/Prototype... 仍在开发中。

3.  [jQSmarty](http://www.balupton.com/sandbox/jquery_smarty/) : 不错，但开发似乎停止了。最后一次改变是在 2008 年。

4.  [seethrough_js](http://wiki.github.com/bard/seethrough_js)：侵入式模板布局。很适合 Erlang 人。

5.  [JsonML](http://jsonml.org/BST/)：也是一种基于 JSON 的侵入式模板格式。你怎么看待这件事？我认为设计师应该停留在他们的 HTML/CSS 元素上，所以不会浪费任何知识。

6.  [JS 中继器](http://jsrepeater.devprog.com/)：提醒我自己的错误尝试。我已经检查过并使用它..但它不能很好地处理很多事情。（例如空字段等）

7.  [Pure](http://beebole.com/pure/) : 是时候开始一场关于如何开发页面的 relegios 战争了？我认为 Pure 不是答案。如果您定义了真正要做的事情并且它无法像 JSF 那样扩展，那就太臃肿了。它没有侵入性语法，这非常好。但是渲染问题的难以使用的规则的代价对我来说是不行的。就是感觉不太对。我遇到过其他想法完全不同的人！测试一下，让我知道你的想法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-14T17:20:15.440

这就是我为 MVC + AJAX 所做的......

非常简单的实现，如果你要问我的话。

[http://jarrettwork.blogspot.com/2009/02/aspnet-mvc-ajax-brief-introduction.html](http://jarrettatwork.blogspot.com/2009/02/aspnet-mvc-ajax-brief-introduction.html)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-02T07:43:45.513

如果认为 MVC 中最重要的字母是用于 AJAX 的 V。带有 HTML 的 AJAX，而 JS 是表示层的一部分，因此理论上它是 View 的一部分。

View 负责您发送给最终用户的内容，而 MVC 模式不仅用于分离 Model、View 和 Controller，而且使我们能够为提供的相同数据模型提供多个视图。

因此最好将代码封装在一个类中，并使用相同的控制器代码来呈现不同的视图。在第一种情况下，可能是静态页面的绘制，但在其他情况下，它是专为 AJAX 调用设计的视图，数据可能是 JSON 或其他标准格式，这无关紧要，只要您尊重每一层的职责.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-14T16:26:22.107

如果 HTML 主要是字符串文字，据我了解，您可能应该将 HTML 移到 <? ?> 标记并从数据库中插入动态内容，其中包含引用控制器设置的变量的小型内联 PHP 片段。

这实际上是一种模板机制。请记住，PHP 本质上是一个模板引擎。

例子：

```
<?php
include 'controller.php'; // set variables used below
?>
<div>
   <h1>Hi there, <?=$UserName?></h1>
   <p>Since you've been here, <?=$numberOfDays?> days have gone by</p>
</div> 
```

等等。这也为您提供了 HTML 中的语法突出显示，并让您不必在 PHP 代码中连接所有长字符串文字，这通常会破坏代码的可读性。

# .net - 我必须委托一个委托，这样当我的状态栏更新时，就会触发一个事件并显示相应的文本

> ID：646158
> 
> 赞同：0
> 
> 时间：2009-03-14T16:12:41.233
> 
> 标签：.net, winforms, delegates, statusbar

我有一个项目，其中状态栏会多次更新。现在我想创建一个委托，这样每当我的状态栏更新时，就会在主表单类中触发一个事件，并且相应的文本会显示在状态栏中，这样我就不必每次都创建不同的 StatusLabel.Text状态栏得到更新。怎么做？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-14T16:54:17.077

这个描述听起来有点绕。您确定要使用 statusbar_updated 事件来更新状态栏吗？我认为这会导致无限循环。

我认为您想要的是表单上的一个事件，以便在触发时更新状态栏。然后所有其他代码可以在想要更新状态栏时触发事件。这样做的好处是，如果您想要记录，您可以创建另一个订阅者来订阅该事件并且它可以工作。

# c++ - 在不更改 main() 函数的情况下更改 C++ 输出

> ID：646169
> 
> 赞同：9
> 
> 时间：2009-03-14T16:16:05.267
> 
> 标签：c++

```
#include<iostream.h>
void main()
{
    cout<<"Love";
} 
```

问题是我们怎样才能在不改变`main()`.

* * *

## 回答 #1

> 赞同：90
> 
> 时间：2009-03-14T16:21:39.917

好的，修复你的主要功能和 iostream.h ......这就是方式

```
#include <iostream>

// to make sure std::cout is constructed when we use it
// before main was called - thxx to @chappar
std::ios_base::Init stream_initializer;

struct caller {
    caller() { std::cout << "I "; }
    ~caller() { std::cout << " You"; }
} c;

// ohh well, for the br0ken main function
using std::cout;

int main()
{
    cout<<"Love";
} 
```

我想我应该解释为什么会这样。该代码定义了一个具有构造函数和析构函数的结构。构造函数在您创建结构的对象时运行，而析构函数在该对象被销毁时运行。现在，在结构定义的末尾，您可以放置​​类型为 的声明符`caller`。

因此，我们在上面所做的是创建一个名为的对象，该对象`c`在程序启动时构造（以及调用的构造函数）——甚至在 main 运行之前。并且当程序终止时，对象被销毁并运行析构函数。其间，`main`印有“爱”字。

这种模式实际上是众所周知的，`RAII`它通常在构造函数中声明一些资源并在析构函数调用中再次释放它。

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-03-14T17:27:55.187

```
#include <iostream>
class tclass
{
  public:
    void operator <<(char *s)
    {
          std::cout<<"I"<<s<<"You"<<std::endl;
    }
};

tclass cout;

int main()
{
  cout<<"love";
} 
```

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-03-14T19:29:18.483

Not as elegant as litb's, but it works

```
#include <iostream> 
#include <cstdio> 
#include <sstream> 

#define cout     printf("I love you\n"); std::ostringstream os; os 

int main() 
{ 
    cout << "love"; 
} 
```

Of course, you don't need to use a `stringstream`, you could use any class with `operator<<`.

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2009-03-14T17:43:02.343

不像 litb 那样优雅，而是另一种选择：

```
#include <iostream>
using namespace std;

int foo()
{
    cout << "I Love You" << endl;
    return cout.rdbuf(0);
}
int i = foo();

int main()
{
    cout << "Love" << endl;
} 
```

* * *

## 回答 #5

> 赞同：8
> 
> 时间：2009-03-14T16:22:08.683

像这样：

```
#include <iostream>
int main() {
   std::cout << "I Love You" << std::endl;
   return 0;
}

/*
#include<iostream.h>
void main()
{
    cout<<"Love";
}
*/ 
```

这样，您没有*更改* `main`. :-p

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-12-11T15:55:17.993

我们也可以这样做：

```
#include <iostream>
#include <cstdlib>
using namespace std;

int fnfoo(int inum){
   cout << "I Love You" << endl;
   return (exit(0),inum);
}

int dummy = fnfoo(5);

int main()
{
   cout << "Love" << endl;
} 
```

简单且完美运行；）

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-14T16:20:37.517

该代码没有 using std，但无论如何它需要在 cout 周围编写自己的包装器，如果有，则删除 using std，并在定义包装器的地方使用 using mystd 替换。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-14T16:21:07.797

我想您可以编写一个运算符<<，在当前输出之前添加“I”，在当前输出之后添加“You”。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-14T16:19:12.777

您的 main 函数不应该返回一个 int 吗？您要么需要更改方法，要么编写另一个程序将这个管道输入，但这是更改简单字符串的最全面的方法......

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-14T17:45:02.900

教训是 C++ 可以通过静态构造函数/析构函数在 main() 之前和之后执行代码，例如。litb 发布的代码。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-29T21:48:40.537

假设这是一个班级作业，我敢打赌这个想法是你可以重写`iostream.h`，因为 C++ 并不把它视为特殊的（对于“特殊”的某些定义）。

* * *

## 回答 #12

> 赞同：-1
> 
> 时间：2009-03-14T16:18:06.540

您需要通过调用另一个函数或更改文本来更改 main。因为`main()`是你程序的主要输出

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-03-14T16:18:46.913

你能再精确一点吗？

您希望那段代码的输出是“我爱你”而不是“爱”吗？

编辑：我认为你不能不更改 main() 中的至少一行代码。您可以从 cout<<"Love" 更改为 cout<<"I love you" 或仅添加一个输出该特定行的函数。

* * *

## 回答 #14

> 赞同：-1
> 
> 时间：2010-01-27T08:17:10.207

我真的很惊讶没有人建议#define "Love" "I love you" ... :)

# java - 为什么我使用 Apache Commons FileUpload 得到“FileUploadException：流意外结束”？

> ID：646189
> 
> 赞同：13
> 
> 时间：2009-03-14T16:23:05.950
> 
> 标签：java, file-upload, apache-commons

遇到此异常的原因是什么：

```
org.apache.commons.fileupload.FileUploadException: 
  Processing of multipart/form-data request failed. Stream ended unexpectedly 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-14T16:47:37.610

主要原因是底层套接字被关闭或重置。最常见的原因是用户在文件完全上传之前关闭了浏览器。或者在上传过程中互联网中断。无论如何，服务器端代码应该能够优雅地处理这个异常。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T17:20:19.200

我处理那个库已经有一年了，但如果我没记错的话，如果有人尝试上传文件，然后更改浏览器 URL（单击链接、打开书签等），那么您可能会遇到该异常。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2016-11-18T09:15:43.843

如果您使用 FileUpload 从闪存接收上传，您可能会遇到此异常。

> 至少从版本 8 开始，Flash 包含一个已知的错误：它产生的多部分流被破坏，因为最终边界不包含后缀“--”，这应该表明没有更多的项目跟随。因此，FileUpload 等待下一个项目（它没有得到）并引发异常。

有一种解决方法建议使用流 API 并捕获异常。

```
catch (MalformedStreamException e) {
    // Ignore this
} 
```

更多详情请参考[https://commons.apache.org/proper/commons-fileupload/faq.html#missing-boundary-terminator](https://commons.apache.org/proper/commons-fileupload/faq.html#missing-boundary-terminator)

# html - XSL 字符转义问题

> ID：646194
> 
> 赞同：9
> 
> 时间：2009-03-14T16:24:53.420
> 
> 标签：html, xslt, escaping

我写这篇文章是因为我真的碰壁了，无法继续前进。在我的数据库中，我已经像这样转义了 HTML `"&lt;p&gt;My name is Freddy and I was"`：.

我想将其显示为 HTML 或去除我的 XSL 模板中的 HTML 标记。两种解决方案都对我有用，我会选择更快的解决方案。

我在网上阅读了几篇文章，但找不到解决方案。我也尝试过禁用输出转义但没有成功。基本上，问题似乎是在 XSL 执行的某个地方，引擎正在将其更改`&lt;p&gt;`为：`&amp;lt;p&amp;gt;`.

它正在转换`&`成`&amp;`. 如果有帮助，这是我的 XSL 代码。我尝试了几种在顶部有和没有输出标签的组合。

任何帮助将不胜感激。提前致谢。

```
<?xml version="1.0" encoding="utf-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

  <xsl:output method="html" omit-xml-declaration="yes"/>

  <xsl:template match="DocumentElement">
    <div>
      <xsl:attribute name="id">mySlides</xsl:attribute>
      <xsl:apply-templates>
        <xsl:with-param name="templatenumber" select="0"/>
      </xsl:apply-templates>
    </div>

    <div>
      <xsl:attribute name="id">myController</xsl:attribute>
      <xsl:apply-templates>
        <xsl:with-param name="templatenumber" select="1"/>
      </xsl:apply-templates>
    </div>
  </xsl:template>

  <xsl:template match="DocumentElement/QueryResults">
    <xsl:param name="templatenumber">tobereplace</xsl:param>

    <xsl:if test="$templatenumber=0">
      <div>
        <xsl:attribute name="id">myController</xsl:attribute>
        <div>
          <xsl:attribute name="class">article</xsl:attribute>
          <h2>
            <a>
              <xsl:attribute name="class">title</xsl:attribute>
              <xsl:attribute name="title"><xsl:value-of select="Title"/></xsl:attribute>
              <xsl:attribute name="href">/stories/stories-details/articletype/articleview/articleid/<xsl:value-of select="ArticleId"/>/<xsl:value-of select="SEOTitle"/>.aspx</xsl:attribute>
              <xsl:value-of select="Title"/>
            </a>
          </h2>
          <div>
            <xsl:attribute name="style">text-indent: 25px;</xsl:attribute>
            <xsl:attribute name="class">articlesummary</xsl:attribute>
            <xsl:call-template name="removeHtmlTags">
              <xsl:with-param name="html" select="Summary" />
            </xsl:call-template>
          </div>
        </div>
      </div>
    </xsl:if>
    <xsl:if test="$templatenumber=1">
      <div>
        <xsl:attribute name="id">myController</xsl:attribute>
        <span>
          <xsl:attribute name="class">jFlowControl</xsl:attribute>
          aa
        </span>
      </div>
    </xsl:if>
  </xsl:template>

  <xsl:template name="removeHtmlTags">
    <xsl:param name="html"/>
    <xsl:choose>
      <xsl:when test="contains($html, '&lt;')">
        <xsl:value-of select="substring-before($html, '&lt;')"/>
        <!-- Recurse through HTML -->
        <xsl:call-template name="removeHtmlTags">
          <xsl:with-param name="html" select="substring-after($html, '&gt;')"/>
        </xsl:call-template>
      </xsl:when>
      <xsl:otherwise>
        <xsl:value-of select="$html"/>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:template>
</xsl:stylesheet> 
```

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-03-15T14:22:55.060

*基于你有这个*HTML 字符串的假设，

```
<p>My name is Freddy &amp; I was 
```

*然后，如果您将其转义并将其存储在数据库中*，它将变为：

```
&lt;p&gt;My name is Freddy &amp;amp; I was 
```

因此，如果您将其作为 XML 检索（没有事先取消转义），结果将*是*：

```
&amp;lt;p&amp;gt;My name is Freddy &amp;amp;amp; I was 
```

并`<xsl:value-of select="." disable-output-escaping="yes" />`会产生：

```
&lt;p&gt;My name is Freddy &amp;amp; I was 
```

您将获得与数据库中完全相同的内容，但当然您会在输出中看到 HTML 标记。因此，您需要一种机制来执行以下字符串替换：

*   `"&amp;lt;"`with `"&lt;"`（有效地更改`&lt;`为`<`未转义的输出）
*   `"&amp;gt;"`with `"&gt;"`（有效地更改`&gt;`为`>`未转义的输出）
*   `"&amp;quot;"`with `"&quot;"`（有效地更改`&quot;`为`"`未转义的输出）
*   `"&amp;amp;"`with `"&amp;"`（有效地更改`&amp;`为`&`未转义的输出）

从您的 XSL 我推断出以下测试输入 XML：

```
<DocumentElement>
  <QueryResults>
    <Title>Article 1</Title>
    <ArticleId>1</ArticleId>
    <SEOTitle>Article_1</SEOTitle>
    <Summary>&amp;lt;p&amp;gt;Article 1 summary &amp;amp;amp; description.&amp;lt;/p&amp;gt;</Summary>
  </QueryResults>
  <QueryResults>
    <Title>Article 2</Title>
    <ArticleId>2</ArticleId>
    <SEOTitle>Article_2</SEOTitle>
    <Summary>&amp;lt;p&amp;gt;Article 2 summary &amp;amp;amp; description.&amp;lt;/p&amp;gt;</Summary>
  </QueryResults>
</DocumentElement> 
```

我已经更改了您提供的样式表并实现了这样的替换机制。如果您对其应用以下 XSLT 1.0 模板：

```
<xsl:stylesheet
  version="1.0"
  xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
  xmlns:my="my:namespace"
  exclude-result-prefixes="my"
>

  <xsl:output method="html" omit-xml-declaration="yes"/>

  <my:unescape>
    <my:char literal="&lt;" escaped="&amp;lt;" />
    <my:char literal="&gt;" escaped="&amp;gt;" />
    <my:char literal="&quot;" escaped="&amp;quot;" />
    <my:char literal="&amp;" escaped="&amp;amp;" />
  </my:unescape>

  <xsl:template match="DocumentElement">
    <div id="mySlides">
      <xsl:apply-templates mode="slides" />
    </div>
    <div id="myController">
      <xsl:apply-templates mode="controller" />
    </div>
  </xsl:template>

  <xsl:template match="DocumentElement/QueryResults" mode="slides">
    <div class="article">
      <h2>
        <a class="title" title="{Title}" href="{concat('/stories/stories-details/articletype/articleview/articleid/', ArticleId, '/', SEOTitle, '.aspx')}">
          <xsl:value-of select="Title"/>
        </a>
      </h2>
      <div class="articlesummary" style="text-indent: 25px;">
        <xsl:apply-templates select="document('')/*/my:unescape/my:char[1]">
          <xsl:with-param name="html" select="Summary" />
        </xsl:apply-templates>
      </div>
    </div>
  </xsl:template>

  <xsl:template match="DocumentElement/QueryResults" mode="controller">
    <span class="jFlowControl">
      <xsl:text>aa </xsl:text>
      <xsl:value-of select="Title" />
    </span>
  </xsl:template>

  <xsl:template match="my:char">
    <xsl:param name="html" />
    <xsl:variable name="intermediate">
      <xsl:choose>
        <xsl:when test="following-sibling::my:char">
          <xsl:apply-templates select="following-sibling::my:char[1]">
            <xsl:with-param name="html" select="$html" />
          </xsl:apply-templates>
        </xsl:when>
        <xsl:otherwise>
          <xsl:value-of select="$html" disable-output-escaping="yes" />
        </xsl:otherwise>
      </xsl:choose>
    </xsl:variable>
    <xsl:call-template name="unescape">
      <xsl:with-param name="html" select="$intermediate" />
    </xsl:call-template>
  </xsl:template>

  <xsl:template name="unescape">
    <xsl:param name="html" />
    <xsl:choose>
      <xsl:when test="contains($html, @escaped)">
        <xsl:value-of select="substring-before($html, @escaped)" disable-output-escaping="yes"/>
        <xsl:value-of select="@literal" disable-output-escaping="yes" />
        <xsl:call-template name="unescape">
          <xsl:with-param name="html" select="substring-after($html, @escaped)"/>
        </xsl:call-template>
      </xsl:when>
      <xsl:otherwise>
        <xsl:value-of select="$html" disable-output-escaping="yes"/>
      </xsl:otherwise>
    </xsl:choose>
  </xsl:template>

</xsl:stylesheet> 
```

然后生成此输出 HTML：

```
<div id="mySlides">
  <div class="article">
    <h2>
      <a class="title" title="Article 1" href="/stories/stories-details/articletype/articleview/articleid/1/Article_1.aspx">Article 1</a>
    </h2>
    <div class="articlesummary" style="text-indent: 25px;">
      <p>Article 1 summary &amp; description.</p>
    </div>
  </div>
  <div class="article">
    <h2>
      <a class="title" title="Article 2" href="/stories/stories-details/articletype/articleview/articleid/2/Article_2.aspx">Article 2</a>
    </h2>
    <div class="articlesummary" style="text-indent: 25px;">
      <p>Article 2 summary &amp; description.</p>
    </div>
  </div>
</div>
<div id="myController">
  <span class="jFlowControl">aa Article 1</span>
  <span class="jFlowControl">aa Article 2</span>
</div> 
```

笔记

*   使用临时命名空间和嵌入元素 ( `<my:unescape>`) 创建要替换的字符列表
*   使用递归来模拟输入中所有受影响字符的迭代替换
*   使用`unescape`模板中的隐式上下文来传输当前要替换哪个字符的信息

另外注意：

*   使用模板模式为相同的输入获得不同的输出（这取代了你的`templatenumber`参数）
*   大多数时候不需要`<xsl:attribute>`元素。它们可以安全地替换为内联符号 ( `attributename="{attributevalue}"`)
*   使用`concat()`函数创建 URL

一般来说，将转义的 HTML 存储在数据库中是一个坏主意（更一般地说：将 HTML 存储在数据库中是一个坏主意。）。你让自己遇到各种各样的问题，这就是其中之一。如果您无法更改此设置，我希望该解决方案对您有所帮助。

我不能保证它在所有情况下都做正确的事情，并且它可能会打开安全漏洞（想想 XSS），但处理这个问题不是问题的一部分。无论如何，请考虑自己受到警告。

我现在需要休息。;-)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-14T16:38:20.953

您不应该在数据库中存储转义的 HTML。如果您的数据库包含实际的“<”字符，那么“disable-output-escaping”命令将执行您想要的操作。

如果您无法更改数据，那么您必须在执行转换之前取消转义数据。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2012-01-17T15:56:55.590

将此行添加到您的样式表

```
<xsl:output method="html" indent="yes" version="4.0"/> 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2010-02-01T00:37:08.577

> 将 HTML 存储在数据库中是个坏主意

什么？那你应该怎么保存呢？在 XML 文档中，所以无论如何您都必须使用 XSLT？作为 Web 开发人员，我们一直使用 SQL 数据库来存储用户定义的 HTML 数据。只要根据您的目的对其进行了适当的消毒，该方法就没有任何问题。

# php - 使用 PHP 创建一个加密的 zip 存档

> ID：646195
> 
> 赞同：26
> 
> 时间：2009-03-14T16:24:56.447
> 
> 标签：php, encryption, zip

我正在寻找一种将 .txt 文件加密为 zip 的方法，但要以安全的密码保护方式进行。我的目标是将此文件通过电子邮件发送给我，而任何人都无法阅读附件的内容。

有没有人知道一个简单的，最重要的是，安全的方法来完成这个？我可以创建 zip 档案，但我不知道如何加密它们，或者，这有多安全。

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2017-12-01T08:49:15.403

从 php 7.2（几小时前发布）开始，正确的做法是使用[ZipArchive](http://php.net/manual/en/class.ziparchive.php)原生 php 代码中包含的附加功能。（感谢[abraham-tugalov](https://stackoverflow.com/users/3684575/abraham-tugalov)指出这种变化即将到来）

现在简单的答案看起来像这样：

```
<?php
$zip = new ZipArchive();
if ($zip->open('test.zip', ZipArchive::CREATE) === TRUE) {
    $zip->setPassword('secret_used_as_default_for_all_files'); //set default password

    $zip->addFile('thing1.txt'); //add file
    $zip->setEncryptionName('thing1.txt', ZipArchive::EM_AES_256); //encrypt it

    $zip->addFile('thing2.txt'); //add file
    $zip->setEncryptionName('thing2.txt', ZipArchive::EM_AES_256); //encrypt it

    $zip->close();

    echo "Added thing1 and thing2 with the same password\n";
} else {
    echo "KO\n";
}
?> 
```

但是您也可以通过索引而不是名称设置加密方法，并且您可以基于每个文件设置每个密码......以及使用[新支持的加密选项指定较弱的加密选项。](http://php.net/manual/en/zip.constants.php)

这个例子练习了这些更复杂的选项。

```
<?php
$zip = new ZipArchive();
if ($zip->open('test.zip', ZipArchive::CREATE) === TRUE) { 
     //being here means that we were able to create the file..

     //setting this means that we do not need to pass in a password to every file, this will be the default
    $zip->addFile('thing3.txt');

    //$zip->setEncryptionName('thing3.txt', ZipArchive::EM_AES_128);
    //$zip->setEncryptionName('thing3.txt', ZipArchive::EM_AES_192);
    //you should just use ZipArchive::EM_AES_256 unless you have super-good reason why not. 
    $zip->setEncryptionName('thing3.txt', ZipArchive::EM_AES_256, 'password_for_thing3');

     $zip->addFile('thing4.txt');
    //or you can also use the index (starting at 0) of the file...
    //which means the following line should do the same thing...
    //but just referencing the text.txt by index instead of name..
    //$zip->setEncryptionIndex(1, ZipArchive::EM_AES_256, 'password_for_thing_4'); //encrypt thing4, using its index instead of its name...

    $zip->close();
    echo "Added thing3 and thing4 with two different passwords\n";
} else {
    echo "KO\n";
}
?> 
```

由于 libzip 1.2.0 引入了对加密的支持，因此启用了对 zip 加密的底层支持。因此，您将需要 php 7.2 和 libzip 7.2 才能运行此代码...希望此注释“很快”会在此答案上变得很简单

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-03-14T16:45:17.007

> 注意：此答案推荐一种已知不安全的加密方法，即使密码良好。请[参阅评论中的链接](http://math.ucr.edu/~mike/zipattacks.pdf) 和[AES 上的 Winzip QA](http://kb.winzip.com/kb/entry/80/)。[php 7.2](http://php.net/manual/en/ziparchive.setencryptionname.php)（和[libzip 1.2.0](https://libzip.org/news/release-1.2.0.html) ）支持 in-php AES zip 加密，这意味着这个答案也很快就会过时。在此之前，[请参阅此答案，了解如何调用 7z 而不是支持 winzip 的 AES 加密的 zip 命令](https://stackoverflow.com/a/13483798/144364)。

你可以使用这个：

```
<?php echo system('zip -P pass file.zip file.txt'); ?> 
```

其中 pass 是密码，file.txt 会被压缩成 file.zip。这应该适用于 Windows 和 Linux，您只需要获得适用于 Windows 的免费版本的 zip ( [http://www.info-zip.org/Zip.html#Win32](http://www.info-zip.org/Zip.html#Win32) )

这种安全性可以被蛮力攻击、字典攻击等破坏。但这并不容易，特别是如果你选择了一个长而难以猜到的密码。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2017-07-19T22:16:41.283

尽管 PHP 是一门成熟的语言，但没有足够的方法（不包括自定义扩展或类似的东西）来用纯 PHP 完成如此简单的任务。

您还可以做的是等到[PHP 7.2](http://windows.php.net/qa/)可用于生产（因为[ZipArchive::setEncryptionName](http://php.net/manual/en/ziparchive.setencryptionname.php)已实现（感谢 Pierre 和 Remi））。

但是，在那之前你也可以尝试将[php_zip](http://pecl.php.net/package/zip) >= 1.14.0 移植到 PHP < 7.2，但是目前没有可用的编译二进制文件，所以你必须自己编译它并尝试是否可能（我相信它是）。

PS我会尝试一下，但我的电脑上现在没有VS2015+。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-22T10:17:02.397

越来越多的工具支持 AES 加密的 ZIP 文件。它有效，它是安全的。

EDIT2：您可以使用PHP 中的[DotNetZip](http://dotnetzip.codeplex.com)从 PHP 动态生成 AES 加密的 zip 存档。DotNetZip 是一个 .NET 库，专为 .NET 语言（C#、VB 等）而设计。它只能在 Windows 上运行 :(。但 DotNetZip 使用 AES，而且它是免费的，并且可以在 PHP 上运行。

这是我使用的代码。（Win32 上的 PHP v5.2.9）

```
<?php
try
{
  $fname = "zip-generated-from-php-" . date('Y-m-d-His') . ".zip";
  $zipOutput = "c:\\temp\\" . $fname;
  $zipfact = new COM("Ionic.Zip.ZipFile");
  $zip->Name = $zipOutput;
  $dirToZip= "c:\\temp\\psh";
  # Encryption:  3 => 256-bit AES.  
  #     2 => 128-bit AES.  
  #     1 => PKZIP (Weak).  
  #     0 => None
  $zip->Encryption = 3;
  $zip->Password = "AES-Encryption-Is-Secure";
  $zip->AddDirectory($dirToZip);
  $zip->Save();
  $zip->Dispose();

  if (file_exists($zipOutput))
  {
    header('Cache-Control: no-cache, must-revalidate');
    header('Content-Type: application/x-zip'); 
    header('Content-Disposition: attachment; filename=' . $fname);
    header('Content-Length: ' . filesize($zipOutput));
    readfile($zipOutput);
    unlink($zipOutput);
  }
  else 
  {
    echo '<html>';
    echo '  <head>';
    echo '  <title>Calling DotNetZip from PHP through COM</title>';
    echo '  <link rel="stylesheet" href="basic.css"/>';
    echo '  </head>';
    echo '<body>';
    echo '<h2>Whoops!</h2>' . "<br/>\n";
    echo '<p>The file was not successfully generated.</p>';
    echo '</body>';
    echo '</html>';
  } 
}
catch (Exception $e) 
{
    echo '<html>';
    echo '  <head>';
    echo '  <title>Calling DotNetZip from PHP through COM</title>';
    echo '  <link rel="stylesheet" href="basic.css"/>';
    echo '  </head>';
    echo '<body>';
    echo '<h2>Whoops!</h2>' . "<br/>\n";
    echo '<p>The file was not successfully generated.</p>';
    echo '<p>Caught exception: ',  $e->getMessage(), '</p>', "\n";
    echo '<pre>';
    echo $e->getTraceAsString(), "\n";
    echo '</pre>';
    echo '</body>';
    echo '</html>';
}

?> 
```

我必须修改 DotNetZip 以使其与 PHP 一起使用：我必须使 Name 属性为读/写，并且我必须使它成为 COM 可调用的。此更改首先在[v1.8.2.3 版本](http://dotnetzip.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=23152)中可用。

* * *

## 回答 #5

> 赞同：-4
> 
> 时间：2014-01-01T21:53:51.587

我就是这样做的。这是一个excel，但它是一样的。

*   让 php 创建一个随机代号。
*   将代号保存在db 或retrieve.php 包含的文件中。
*   给自己邮寄代号。

*   通过网络访问retrieve.php?codename=[codename]

*   让 php 检查代号是否正确。（甚至可能是年龄）。
*   根据需要发送给您的数据在内存中创建 excel/文本文件。
*   通过添加带有代号的本地密码（只有您知道）来创建加密代码。（我说添加但也可以混合或异或或子...）
*   使用创建的加密代码即时加密。
*   从 db 或配置文件中删除代号。
*   在邮件中返回此加密文档（压缩或不压缩）。
*   也许在邮件中添加代号的前两个字符，以了解要使用的本地完整代号。

*   使用本地解密脚本对下载的文件进行解码。使用相同的代号/密码算法来创建解密密钥。

我使用乱码-aes-php。（[https://github.com/ivantcholakov/gibberish-aes-php](https://github.com/ivantcholakov/gibberish-aes-php)）
因为那时我可以在客户端解码器上使用[https://github.com/mdp/gibberish-aes](https://github.com/mdp/gibberish-aes)作为 javascript （我想快速在浏览器中查看）。

# apache - 相同的端口，但不同的 DocumentRoots

> ID：646207
> 
> 赞同：0
> 
> 时间：2009-03-14T16:37:29.707
> 
> 标签：apache, redirect

我打开一个端口，比如说端口 81 来监听传入的请求。

如果传入的请求是 www.myexample.com，那么我想将它重定向到

```
C:\myexamplemain 
```

文件夹。

如果传入的请求是 blog.myexample.com，那么我想将它重定向到

```
C:\myexampleblog 
```

文件夹。

鉴于 和 有很多重定向规则`www.myexample.com`，`blog.myexample.com`我必须为这两个创建单独的 VirtualHost 文件。所以我需要一个单独的配置文件来解析 DocumentRoot。如何最好地做到这一点？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T16:45:35.600

最好的方法是通过[虚拟主机](http://httpd.apache.org/docs/2.2/vhosts/)。

```
NameVirtualHost *:81

<VirtualHost *:81>
    DocumentRoot C:\myexamplemain
    ServerName www.myexample.com
</VirtualHost>

<VirtualHost *:81>
    DocumentRoot C:\myexampleblog
    ServerName blog.myexample.com
</VirtualHost> 
```

这些在什么文件中并不重要。Apache 处理其配置，就好像它们都在一个文件中一样。您可以将一个位放在一个文件中，将另一个虚拟主机位放在另一个文件中，就可以了。

# xsd - 在 XSD 中，如何定义两个具有相同名称的不同元素？

> ID：646216
> 
> 赞同：0
> 
> 时间：2009-03-14T16:42:20.337
> 
> 标签：xsd

我在制作`xsd`文件时遇到问题。我需要一个`xsd`文件`xml`文件，如下所示：

```
<message type="login">
  <login nick="Ben" gameId="chess" desiredRole="simple "/>
</message> 
```

或者像这样

```
<message type="error">
  Error message
</message> 
```

这意味着总是有一个`message`标签，但它具有不同的属性`type`值，并且根据类型值，`message`标签内有不同的东西。我试过这样的事情：

```
<xsd:element name ='message' type='messageType'>
</xsd:element>

<xsd:complexType name='messageType'/>
  <xsd:complexType name='error'>
    <xsd:complexContent>
      <xsd:extension base='messageType'>
        <xsd:attribute name ='type' use='required'>
          <xsd:simpleType>
            <xsd:restriction base='xsd:string'>
              <xsd:enumeration value='error'/>
            </xsd:restriction>
          </xsd:simpleType>
        </xsd:attribute>
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

  <xsd:complexType name='login'>
    <xsd:complexContent>
      <xsd:extension base='messageType'>
        <xsd:sequence>
          <xsd:element name='login'>
            <xsd:complexType>
              <xsd:attribute name='nick' type='xsd:string' use='required'>
              </xsd:attribute>
              <xsd:attribute name='gameId' type='xsd:string' use='required'>
              </xsd:attribute>
              <xsd:attribute name='desiredRole' type='xsd:string' use='required'>
              </xsd:attribute>
            </xsd:complexType>
          </xsd:element>
        </xsd:sequence>
        <xsd:attribute name ='type' use='required'>
          <xsd:simpleType>
            <xsd:restriction base='xsd:string'>
              <xsd:enumeration value='login'/>
            </xsd:restriction>
          </xsd:simpleType>
        </xsd:attribute>
      </xsd:extension>
    </xsd:complexContent>
  </xsd:complexType>

</xsd:schema> 
```

但它不起作用（我收到未定义属性类型的错误）。有人可以帮我解决这个问题吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T16:46:23.603

怎么样

```
<message>
    <login />
</message> 
```

和

```
<message>
    <error />
</message> 
```

也就是说，去掉 type 属性，并且在 message 中总是有一个元素。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T17:15:22.097

XSD 不允许您精确地做您想做的事情，即创建一个根据属性值具有不同结构的元素。但是，如果您确实需要此元素具有像这样的不同结构，您可以创建一个允许所有可能结构的元素定义。您只是不能让解析器自动验证它以证明它完全符合一个定义或另一个定义。无论如何，不​​在 XSD 中。

尝试这样的事情：

```
<xsd:schema xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <xsd:element name="message" type="messageType"/>

  <xsd:simpleType name="typeType">
    <xsd:restriction base="xsd:string">
      <xsd:enumeration value="login"/>
      <xsd:enumeration value="error"/>
    </xsd:restriction>
  </xsd:simpleType>

  <xsd:element name="login">
    <xsd:complexType>
      <xsd:attribute name='nick'        type='xsd:string' use='required'/>
      <xsd:attribute name='gameId'      type='xsd:string' use='required'/>
      <xsd:attribute name='desiredRole' type='xsd:string' use='required'/>
    </xsd:complexType>
  </xsd:element>

  <xsd:complexType name='messageType'/>
    <xsd:sequence>
      <xsd:element ref="login" minOccurs="0" maxOccurs="1"/>
    </xsd:sequence>
    <xsd:attribute name="type" type="typeType" use="required"/>
  </xsd:complexType>
</xsd:schema> 
```

# c++ - 如何从 C++ 程序运行 bash 脚本

> ID：646217
> 
> 赞同：59
> 
> 时间：2009-03-14T16:43:07.807
> 
> 标签：c++, linux, bash, shell

Bash 脚本非常有用，可以节省大量编程时间。那么如何在 C++ 程序中启动 bash 脚本呢？另外，如果您知道如何使用户成为超级用户，那也很好。谢谢！

* * *

## 回答 #1

> 赞同：78
> 
> 时间：2009-03-14T16:45:32.107

使用该`system`功能。

```
system("myfile.sh"); // myfile.sh should be chmod +x 
```

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-14T16:46:16.567

```
#include <stdio.h>
#include <stdlib.h>

// ....

system("my_bash_script.sh"); 
```

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2017-08-05T11:27:52.823

由于这是一个非常古老的问题，并且尚未添加此方法（除了`system()`调用函数），我想包含使用 C 二进制文件本身创建 shell 脚本会很有用。shell 代码将存放在`file.c`源文件中。这是一个代码示例：

```
#include <stdio.h>
#include <stdlib.h>

#define SHELLSCRIPT "\
#/bin/bash \n\
echo -e \"\" \n\
echo -e \"This is a test shell script inside C code!!\" \n\
read -p \"press <enter> to continue\" \n\
clear\
"

int main() {

system(SHELLSCRIPT);
return 0;
} 
```

基本上，简而言之（双关语），我们定义脚本名称，充实脚本，用双引号将它们括起来（同时插入适当的转义符以忽略 shell 代码中的双引号），然后调用该脚本的名称，这在此示例中`SHELLSCRIPT`使用.`system()``main()`

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2009-03-14T16:46:24.397

唯一的标准强制实现依赖方式是使用`system()`来自`stdlib.h`.

> 另外，如果您知道如何使用户成为超级用户，那也很好。

您希望脚本以超级用户身份运行还是提升 C 可执行文件的权限？前者可以完成，`sudo`但在开始使用`sudo`.

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-03-14T17:04:22.607

[StackOverflow：如何在 C++ 中执行命令并获取命令输出？](https://stackoverflow.com/questions/478898/how-to-execute-a-command-and-get-output-of-command-within-c/479103)

[StackOverflow：（使用 fork、pipe、select）：......没有人再用艰难的方式做事......](https://stackoverflow.com/questions/478898/how-to-execute-a-command-and-get-output-of-command-within-c/479103#479103)

> > ***另外，如果您知道如何使用户成为超级用户，那也很好。谢谢！***

须藤。苏。chmod 04500。（setuid() 和 seteuid()，但它们要求您已经是 root。例如 chmod'ed 04***。）

小心。这些可以打开*“有趣”*的安全漏洞......

根据您的操作，您可能不需要 root。（例如：我经常*chmod/chown /dev*设备（串行端口等）（在*sudo root*下）所以我可以在我的软件中使用它们而无需成为 root。另一方面，当加载/卸载内核模块...）

# java - 创建帐户时，如何将密码哈希安全地存储在内存中？

> ID：646224
> 
> 赞同：6
> 
> 时间：2009-03-14T16:45:50.343
> 
> 标签：java, security, hash, passwords

我们基于 Web 的应用程序将用户帐户绑定到具有在帐户创建期间指定的密码的用户。在 Java 的情况下，在将其哈希值保存在数据库中之前，如何安全地处理密码。

更具体地说，如何确保保存密码的字符串在足够短的时间间隔内被垃圾收集？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-14T17:10:54.683

如果您有可能（在 Web 应用程序中可能很难），最好将密码存储在字符数组中而不是将它们存储在字符串中。如果您完成了密码的存储，您可以使用[Array.fill()](http://java.sun.com/javase/6/docs/api/java/util/Arrays.html#fill(char[],%20char))将其覆盖在内存中，并通过丢弃它来使垃圾收集器可以使用该引用：

```
Arrays.fill(password, ' ');
password = null; 
```

我只是注意到将密码归零会有点偏执，但如果它让您放心，您可以这样做:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-14T18:06:30.993

您不使用字符串。您使用 char[]，然后在完成后覆盖 char[]。

在垃圾收集方面绝对不能保证（除了终结器将在收集对象之前运行）。GC 可能永远不会运行，如果它运行它可能永远不会 GC 包含密码的字符串。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-14T16:50:00.520

如果在客户端创建哈希，应该不需要考虑这个问题。明文密码永远不会提交给服务器。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-14T16:53:16.223

两个词：本地范围。用于密码处理的声明变量需要具有可能的绝对最小范围。

一旦变量超出范围，对象就有资格进行垃圾回收。

通常，您会从请求中挑选内容。您需要一个非常非常小的事务来接受请求、对密码进行哈希处理、持久化并重定向。然后，您重定向到的页面可以获取内容并执行属于您的应用程序的所有“其他”处理。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-14T17:04:16.773

无法保证在 Java 中从内存中删除明文密码。

然而，黑客不需要访问程序的内存来获取明文密码。有更简单的方法（例如嗅探数据包），因此任何人都不太可能依赖这种方法。

最好的方法是让客户端按照@Mork0075 的建议加密密码。但是，虽然这意味着您无法轻松获取密码，但程序仍然可以获取密码的加密版本，从而伪装成用户。解决此问题的一种方法是使用 SSL 加密整个连接。

所有这些都是相当学术的，因为黑客最简单的方法是监视到数据库的数据包并获取数据库的密码。我怀疑直接访问您的数据库更令人担忧……或者可能不是。;)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-14T17:46:42.303

使用密码质询：

1.  服务器选择一个**挑战值**并将其发送给客户端
2.  **服务器使用密码**和挑战执行单向转换，例如。`MD5(CONCAT(challenge, password))`并将其分配给会话。
3.  纯文本密码现在超出范围并准备好进行垃圾收集。
4.  客户端也执行相同的翻译并将结果发送到服务器。
5.  如果 Server 和 Client 选择相同的最终值，则客户端通过身份验证。

这种方法可以防止**重放攻击**，但要求**挑战值**非常不可预测（随机）并且不经常重复使用（长时间）。

纯文本密码仅在处理初始连接请求的范围内 - 而不是在身份验证期间。单向翻译结果在范围内多久（不是垃圾收集）并不重要，因为它几乎没有重播价值。

# qt - /usr/bin/ld: 找不到 -lfreetype qt

> ID：646232
> 
> 赞同：3
> 
> 时间：2009-03-14T16:50:00.427
> 
> 标签：qt, freetype

在 Fedora 10 上编译。

我是第一次使用 qt。我首先使用所有默认设置创建了一个简单的 GUI 应用程序。当我尝试构建项目时，我收到以下错误消息。

但是，当我搜索 -lfreetype 时，我在以下目录中找到了它。/usr/lib/libfreetype.so.6 /usr/lib/libfreetype.so.6.3.18

有没有办法解决这个问题？

非常感谢您的任何建议

```
Running build steps for project test1...
Creating gdb macros library...
Configuration unchanged, skipping QMake step.
Starting: /usr/bin/make debug -w 
make: Entering directory `/home/steve/projects/qt/test1/test1'
/usr/bin/make -f Makefile.Debug
make[1]: Entering directory `/home/steve/projects/qt/test1/test1'
g++ -Wl,-rpath,/opt/qtsdk-2009.01/qt/lib -o test1 debug/main.o 
  debug/mainwindow.o debug/moc_mainwindow.o 
  -L/opt/qtsdk-2009.01/qt/lib 
  -lQtGui -L/opt/qtsdk-2009.01/qt/lib -L/usr/X11R6/lib 
  -pthread -lfreetype 
  -lgobject-2.0 -lSM -lICE -pthread -pthread 
  -lXrender -lfontconfig 
  -lXext -lX11 -lQtCore -lm -pthread -lgthread-2.0 -lrt 
  -lglib-2.0 -ldl -lpthread
/usr/bin/ld: cannot find -lfreetype
collect2: ld returned 1 exit status
make[1]: *** [test1] Error 1
make[1]: Leaving directory `/home/steve/projects/qt/test1/test1'
make: *** [debug] Error 2
make: Leaving directory `/home/steve/projects/qt/test1/test1'
Exited with code 2.
Error while building project test1
When executing build step 'Make' 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-14T16:53:19.297

您必须安装 freetype-devel 软件包。devel 包包含头文件，在 freetype 的情况下应该位于：/usr/include/freetype。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-20T03:23:27.920

我在 Ubuntu 8.10、QT 4.5 上遇到了同样的问题。我用以下奇怪的技巧“修复”了它：

1.  构建失败后，将 QT lib 目录重命名为其他名称 - 例如“mv ../../qtsdk-2009.01/qt/lib ../../qtsdk-2009.01/qt/lib2”

2.  再次运行“make”，它会再次失败。

3.  恢复lib目录

4.  再次运行“make”，现在它可以工作了。

我不知道为什么会这样。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-14T21:38:20.120

安装 freetype1-dev libgtk2.0-dev 就可以编译了。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-31T19:22:38.557

在 Ubuntu 9.04 上，安装 freetype1-dev & libgtk2.0-dev 解决了这个问题。

但令大家惊讶的是，Ross 提到的 hack 也有效，我真的很想知道如何以及为什么.. M 查看 QTcreator 的源代码，看看我是否能找出原因。如果有人已经知道原因，请告诉我。

谢谢..

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-06-09T22:20:00.447

刚刚安装了一个新的 ubuntu 9.04 (dell D820)-安装了 qt creator 没有别的-同样的问题

使用来自 SR 的选项，因为它需要从包管理器安装 libgtk2.0-dev （这也将加载 freetype6 ）。

如果您还从包管理器安装 qt Designer，您将看到相同的效果（它将安装所有正确的包

关于尼科

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-09-20T01:38:36.367

我在使用 Elive、freetype1-dev 和 libgtk2.0-dev 时遇到了同样的问题，对于 /usr/bin/ld: cannot find -lSM thing xorg-dev 解决了这个问题。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-09-30T13:05:21.840

您必须确保的第一件事是在您的计算机中安装了 libfreetype.so。使用命令'locate libfreetype.so'，你可能会发现结果中有一个'/usr/lib/libfreetype.so.6'。编译软件无法将 libfreetype.so.6 识别为共享库，因此，您必须对目标进行符号链接。使用命令'ln -s /usr/lib/libfreetype.so.6 /usr/lib/libfreetype.so'，当你再次编译程序时，你会发现错误已经消失了。您还可以解决可能出现的错误。祝你好运！

# c - C：运行系统命令并获取输出？

> ID：646241
> 
> 赞同：162
> 
> 时间：2009-03-14T16:54:12.273
> 
> 标签：c, linux, system

> **可能重复：**
> [如何从 C 运行外部程序并解析其输出？](https://stackoverflow.com/questions/43116/how-can-i-run-an-external-program-from-c-and-parse-its-output)

我想在 linux 中运行一个命令并返回它输出的文本，但我**不**希望这个文本打印到屏幕上。有没有比制作临时文件更优雅的方法？

* * *

## 回答 #1

> 赞同：294
> 
> 时间：2009-03-14T17:01:06.767

你想要“ [popen](http://linux.die.net/man/3/popen) ”功能。这是运行命令“ls /etc”并输出到控制台的示例。

```
#include <stdio.h>
#include <stdlib.h>

int main( int argc, char *argv[] )
{

  FILE *fp;
  char path[1035];

  /* Open the command for reading. */
  fp = popen("/bin/ls /etc/", "r");
  if (fp == NULL) {
    printf("Failed to run command\n" );
    exit(1);
  }

  /* Read the output a line at a time - output it. */
  while (fgets(path, sizeof(path), fp) != NULL) {
    printf("%s", path);
  }

  /* close */
  pclose(fp);

  return 0;
} 
```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-14T16:59:59.310

您需要某种进程间通信。使用[管道](http://linux.die.net/man/2/pipe)或共享缓冲区。

# java - 如何重定向到 html 页面并将变量传递给 Java 中的该页面？

> ID：646247
> 
> 赞同：6
> 
> 时间：2009-03-14T16:59:20.887
> 
> 标签：java, html, forms, servlets

我的 index.html 页面上有一个表单，它向 Java Servlet 发出 POST 请求。这个 servlet 做了一些处理，我想用 servlet 产生的一些变量重定向回 index.html。

在 PHP 中，它很简单：

```
header("Location: index.html?var1=a&var2=b"); 
```

我怎样才能用 Java 达到同样的效果，希望利用 GET 请求。

谢谢大家

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-14T17:06:35.660

在 Java Servlet 中，您需要编写：

```
response.sendRedirect("index.html?var1=a&var2=b..."); 
```

哦，对了，我应该注意，您需要在 doGet() 或 doPost() 等处理器方法中执行此操作...

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T17:07:23.957

您将响应重定向到具有一些附加值的同一 servlet：

```
req.setAttribute("message","Hello world");
rd =req.getRequestDispatcher("/index.jsp"); 
```

在您的 servlet 中，您可以通过以下方式获取数据：

```
<%=request.getAttribute("message");%> 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-14T17:06:42.260

您可以使用

```
HttpResponse.sendRedirect("Location: index.html?var1=a&var2=b"); 
```

有关更多信息，请参阅[此链接](http://java.sun.com/products/servlet/2.3/javadoc/javax/servlet/http/HttpServletResponse.html#sendRedirect(java.lang.String))。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-14T17:08:06.453

它很简单：

```
response.sendRedirect("index.html?var1=a&var2=b"); 
```

# c# - 如何在 C# 中动态地将字段添加到类中

> ID：646258
> 
> 赞同：25
> 
> 时间：2009-03-14T17:03:51.703
> 
> 标签：c#, reflection

有没有办法在运行时向一个类添加`Field`（或者`FieldInfo`，也许这是相同的）？

* * *

## 回答 #1

> 赞同：28
> 
> 时间：2009-03-14T17:07:13.567

您不能在运行时更改类定义。但是，您可以创建一个从原始类（如果不是`sealed`）继承的新类并声明该字段。您可以通过使用 发出适当的 IL 代码来做到这一点`System.Reflection.Emit`。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-14T17:06:57.530

不，C# 不允许[猴子补丁](http://en.wikipedia.org/wiki/Monkey_patch)。

您可以使用 CodeDOM 或 Reflection.Emit 生成*新*类，但不能修改现有类。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-14T17:42:37.133

C# 不允许这样做，因为它的所有类都基于元数据。**CLR**（不是 C#）不允许在运行时向元数据添加字段 (1) 。这是 C# 能够在 runitme 添加字段的唯一方法。

这与 IronPython 等动态语言不同，后者本质上没有具体的元数据类。它们有更多的动态结构，可以在运行时改变。我相信 IronPython 只是将它的成员（字段和方法）保存在相当于一个可以在运行时轻松更改的哈希表中。

在 C# 3.0 中，最好的资源是使用 Reflection.Emit。但这将生成一个全新的类，而不是改变现有的类。

(1) 有某些 API，例如分析 API 或 ENC，允许这样做，但我不确定它们的功能是否扩展到添加字段。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2012-08-10T02:40:58.013

有关在 C# 4.0 中执行此操作的简单方法，请参阅[此问题](https://stackoverflow.com/q/4938397/370671)`ExpandoObject`，方法是将an 强制转换为`IDictionary`，这会导致添加到字典中的值成为对象的属性。[我在我的另一个答案中](https://stackoverflow.com/a/11893463/370671)证明了这一点，表明它们实际上成为了属性。

但是，这仅适用于 的实例`ExpandoObject`或子类`DynamicObject`。

如果它们实现，也可以与其他类一起使用`IDynamicMetaObjectProvider`，但我认为需要做太多工作才能使其正常工作。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-14T17:07:23.630

不完全是。

但是，您可以实现 ICustomTypeDescriptor 来近似它，然后只使用哈希表来存储字段名/值对。许多使用反射的框架首先要求 ICustomTypeDescriptor。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-14T17:12:48.267

直到 C# 4.0 添加了动态查找并基于包含 DLR 的 CLR 4.0，然后它不会严格添加到类中，因为类不会出现在图片中。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-14T18:02:08.913

正如其他人已经说过的那样，这是不可能的。你的问题的原因是什么？如果您需要在类中动态存储一些额外的数据，那么您可能只使用字典：

```
class My { 
   Dictionary<string, object> data;
   public My() { data = new Dictionary<string, object>(); }
} 
```

..但这真的取决于你真正想要达到的目标？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2013-02-23T11:13:55.273

也许您可以使用装饰器模式。

In object-oriented programming, the decorator pattern is a design pattern that allows behavior to be added to an individual object, either statically or dynamically, without affecting the behavior of other objects from the same class.

[http://www.dofactory.com/Patterns/PatternDecorator.aspx](http://www.dofactory.com/Patterns/PatternDecorator.aspx)

# asp.net-mvc - ASP.NET MVC - 值类型的自定义验证消息

> ID：646270
> 
> 赞同：23
> 
> 时间：2009-03-14T17:07:56.327
> 
> 标签：asp.net-mvc, validation

当我使用 UpdateModel 或 TryUpdateModel 时，MVC 框架足够聪明，可以知道您是否尝试将 null 传递给值类型（例如，用户忘记填写所需的生日字段）。

不幸的是，我不知道如何覆盖默认消息“需要一个值”。在摘要中插入更有意义的内容（“请输入您的生日”）。

必须有一种方法可以做到这一点（无需编写太多变通代码），但我找不到它。有什么帮助吗？

**编辑**

另外，我想这也是无效转换的问题，例如BirthDay =“Hello”。

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2010-04-23T13:29:12.257

通过扩展 DefaultModelBinder 来制作你自己的 ModelBinder：

```
public class LocalizationModelBinder : DefaultModelBinder 
```

覆盖 SetProperty：

```
 base.SetProperty(controllerContext, bindingContext, propertyDescriptor, value);

        foreach (var error in bindingContext.ModelState[propertyDescriptor.Name].Errors.
            Where(e => IsFormatException(e.Exception)))
        {
            if (propertyDescriptor.Attributes[typeof(TypeErrorMessageAttribute)] != null)
            {
                string errorMessage =
                    ((TypeErrorMessageAttribute)propertyDescriptor.Attributes[typeof(TypeErrorMessageAttribute)]).GetErrorMessage();
                bindingContext.ModelState[propertyDescriptor.Name].Errors.Remove(error);
                bindingContext.ModelState[propertyDescriptor.Name].Errors.Add(errorMessage);
                break;
            }
        } 
```

添加`bool IsFormatException(Exception e)`检查异常是否为 FormatException 的函数：

```
if (e == null)
            return false;
        else if (e is FormatException)
            return true;
        else
            return IsFormatException(e.InnerException); 
```

创建一个属性类：

```
[AttributeUsage(AttributeTargets.All, Inherited = false, AllowMultiple = false)]
public class TypeErrorMessageAttribute : Attribute
{
    public string ErrorMessage { get; set; }
    public string ErrorMessageResourceName { get; set; }
    public Type ErrorMessageResourceType { get; set; }

    public TypeErrorMessageAttribute()
    {
    }

    public string GetErrorMessage()
    {
        PropertyInfo prop = ErrorMessageResourceType.GetProperty(ErrorMessageResourceName);
        return prop.GetValue(null, null).ToString();
    }
} 
```

将属性添加到您要验证的属性：

```
[TypeErrorMessage(ErrorMessageResourceName = "IsGoodType", ErrorMessageResourceType = typeof(AddLang))]
    public bool IsGood { get; set; } 
```

AddLang 是一个 resx 文件，IsGoodType 是资源的名称。

最后将其添加到 Global.asax.cs Application_Start 中：

```
ModelBinders.Binders.DefaultBinder = new LocalizationModelBinder(); 
```

干杯!

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-09-03T16:52:43.553

使用 DefaultModelBinder 可以覆盖默认的必需错误消息，但不幸的是它会全局应用，恕我直言，它完全没用。但如果你决定这样做，方法如下：

1.  将 App_GlobalResources 文件夹添加到您的 ASP.NET 站点
2.  添加一个名为 Messages.resx 的资源文件
3.  在资源文件中声明一个带有键`PropertyValueRequired`和一些值的新字符串资源
4.  在 Application_Start 添加以下行：

    ```
    DefaultModelBinder.ResourceClassKey = "Messages"; 
    ```

如您所见，您正在验证的模型属性与错误消息之间没有任何联系。

总之，最好编写自定义验证逻辑来​​处理这种情况。一种方法是使用可为空的类型 (System.Nullable<TValueType>)，然后：

```
if (model.MyProperty == null || 
    /** Haven't tested if this condition is necessary **/ 
    !model.MyProperty.HasValue)
{
    ModelState.AddModelError("MyProperty", "MyProperty is required");
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-06T15:09:45.183

我一直在使用很棒的[xVal](http://xval.codeplex.com/)验证框架。它让我可以在模型中进行所有验证（甚至是 LINQ-SQL :)）。它还发出客户端验证所需的 javascript。

**编辑：**抱歉遗漏了如何让它为 LINQ-SQL 工作的[链接](http://goneale.wordpress.com/2009/03/04/using-metadatatype-attribute-with-aspnet-mvc-xval-validation-framework/)

基本的工作流程是这样的。

```
public partial class YourClass
{
    [Required(ErrorMessage = "Property is required.")]
    [StringLength(200)]
    public string SomeProperty{ get; set; }
} 
```

* * *

```
try
{
    // Validate the instance of your object
    var obj = new YourClass() { SomeProperty = "" }
    var errors = DataAnnotationsValidationRunner.GetErrors(obj);
    // Do some more stuff e.g. Insert into database
}
catch (RulesException ex)
{
    // e.g. control name 'Prefix.Title'
    ex.AddModelStateErrors(ModelState, "Prefix");   
    ModelState.SetModelValue("Prefix.Title", new ValueProviderResult(ValueProvider["Prefix.Title"].AttemptedValue, collection["Prefix.Title"], System.Globalization.CultureInfo.CurrentCulture));

} 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-10-11T21:47:55.397

这个怎么样？

```
[RegularExpression(@"^[a-zA-Z''-'\s]{1,40}$",
                   ErrorMessage = "Characters are not allowed.")] 
```

这应该允许您为要使用的任何 MVC 验证器标记带有特定错误消息的属性...

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-11-27T05:41:51.977

在 ASP.NET MVC 1 中，我也遇到了这个问题。

在我的项目中，有一个名为“Entry”的模型或业务对象，它的主键EntryId是int？类型，EntryId的值可以允许用户输入。

所以问题是，当字段为空白或零或某个已存在的整数值时，可以很好地显示自定义错误消息，但如果该值是像“a”这样的非整数值，我找不到方法使用自定义消息替换默认消息，例如“值'a'无效”。

当我在ModelState中跟踪错误信息时，我发现当值为非整数时，会出现两个与EntryId相关的错误，并且第一项的错误信息是空白的......

现在我不得不使用如此丑陋的代码来破解这个问题。

```
if (ModelState["EntryId"].Errors.Count > 1)
{
    ModelState["EntryId"].Errors.Clear(); //should not use ModelState["EntryId"].remove();
    ModelState.AddModelError("EntryId", "必须为大于0的整数"); //必须为大于0的整数 means "it should be an integer value and great than 0"
} 
```

但这会使控制器发胖，希望有一个真正的解决方案来解决它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-14T17:11:59.437

抬头看`ModelState.AddError`。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-11-27T15:06:35.800

是的，有一种方法，您必须将**System.ComponentModel.DataAnnotations**与**xVal**结合使用，您将能够使用 Attributes
***look为您的每个属性设置验证规则和消息（您甚至可以使用资源文件进行本地化）这里*** [http://blog.codeville.net/2009/01/10/xval-a-validation-framework-for-aspnet-mvc/](http://blog.codeville.net/2009/01/10/xval-a-validation-framework-for-aspnet-mvc/)

# css - Zend Framework 中使用默认样式的表单元素样式

> ID：646272
> 
> 赞同：1
> 
> 时间：2009-03-14T17:08:25.453
> 
> 标签：css, zend-framework, forms

我目前正在使用自定义 CSS 类对表单元素进行样式设置，以对文本输入进行不同的样式设置，例如：

```
$submit = new Zend_Form_Element_Submit('login');
$submit->setLabel('Log in')
    ->setAttrib('class', 'submit'); 
```

和

```
$username = new Zend_Form_Element_Text('username');
$username->setLabel('Username')
    ->setAttrib('class', 'textinput'); 
```

但是假设我有多个表单，并且希望默认设置所有文本元素`textinput`和所有提交元素的样式。`submit`有没有办法在全球范围内做到这一点？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-05-06T18:01:56.880

不用在每种不同类型的对象上设置类，而是使用 CSS 来设置元素的样式：

```
input[type="submit"] {
    /* Here goes the stuff that you put in your submit class */
}

input[type="text"] {
    /* here goes the stuff you put in your textinput class */
}

textarea {
    /* here goes the stuff for a text area */
} 
```

This will do what you want it to do and you don't have to sub-class the Zend Framework default helpers. Also, it will output less HTML so your pages will be smaller and the CSS can be re-used for each and every input element on the page.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T17:12:06.223

我不是 Zend 专家，但我猜你可以子类化每个 Zend_Form_Element_* 类并设置你想在它们的构造函数中设置的属性——即 Zend_Form_Element_Text_Yatta 中的子类 Zend_Form_Element_Text；然后在其构造函数中将属性“class”设置为“textinput”。

# objective-c - 除法和 NSUInteger

> ID：646276
> 
> 赞同：0
> 
> 时间：2009-03-14T17:11:14.480
> 
> 标签：objective-c, cocoa, cocoa-touch, nsuinteger

我有一些涉及负值的计算：

```
row = (stagePosition - col) / PHNumRow; 
```

假设 stagePosition 为 -7，col 为 1。它们都是 NSInteger，包括行。PHNumRow 为 8。

如果 PHNumRow 是 NSInteger，我会得到我期望的结果：-1。但是如果 PHNumRow 是 NSUInteger，结果就是垃圾。

除数是未签名还是已签名为什么重要？我没有将结果放入无符号整数中。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-14T17:42:53.420

因为整数提升。当评估右侧时，所有参数都被提升为表达式操作数的最高类型，如果`PHNumRow`是无符号的，则将是无符号整数。编译器执行类似于以下的操作：

```
((NSUInteger)stagePosition - (NSUInteger)col) / PHNumRow; 
```

因为，`stagePosition`是负数，所以有一个环绕，你的计算就会繁荣！

# open-source - 开源项目中的匿名贡献者和贡献者

> ID：646278
> 
> 赞同：7
> 
> 时间：2009-03-14T17:11:54.803
> 
> 标签：open-source

在我参与的各种开源项目中见证了几个或多或少重要的完全匿名贡献，我想知道这些匿名贡献背后的可能理由是什么？

偶尔，有些贡献者显然更愿意保持完全匿名 - 即通过使用明显的昵称发布到邮件列表几个月（而其他人都会使用他们的真实姓名），或者有时甚至通过向跟踪器提交完全匿名的补丁在 sourceforge 上，甚至没有关于来源/作者的任何评论，通常只是一个许可证标题或一个标题，说明有问题的代码将被发布到公共领域。

通常，有问题的代码显然是由相当称职的程序员/开发人员甚至软件工程师编写的，他们可能以代码为生。

我想知道：

*   这些贡献背后的动机是什么？
*   你以前在开源项目中见过这样和类似的例子吗？
*   您自己是否可能以这种方式为开源项目做出过贡献？
*   如果是这样，为什么？
*   您能否对此提供任何其他见解？

在阅读了关于 SO 的[另一个](https://stackoverflow.com/questions/455221/releasing-open-source-without-the-permission-of-your-employer/646208#646208)问题之后，并且在阅读了关于为开源项目做出贡献时潜在的工作合同相关问题的两个相关讨论（在[slashdot](http://developers.slashdot.org/article.pl?sid=02/03/21/0139244)和[perlmonks](http://www.perlmonks.org/index.pl?lastnode_id=26179&node_id=153046)）之后，我想知道是否有些贡献者可能更愿意保持完全匿名由于他们的合同要求，以避免潜在的法律问题。

谢谢

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-14T18:26:00.947

我拥有两个相当流行的开源项目。我已经接受了这样的贡献。理由很简单。他们正在使用该项目，并希望尽快解决问题或实现功能。

贡献使他们受益！

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-14T18:33:40.270

我能想到几个原因：

1.  有些人只是重视隐私-我知道我通常不会在大多数论坛上以我的名字发帖-所以对我来说是个例外（即使在这里也只是几个月后）；
2.  许多程序员在雇佣协议的一部分是您编写的任何代码（无论是否在公司时间）都属于雇主的地方工作。无论这些协议是否适用于提交，程序员可能希望避免“污染”提交，或者可能希望避免通过官僚圈子获得雇主的许可；
3.  提交者可能不想被联系以获得支持；
4.  提交者可能不会对代码感到特别自豪（无论对错）；

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T17:41:09.557

我能想到的最可能的原因是他们有某种合同约束力，阻止他们公开贡献，例如为一家将开源项目视为潜在责任的大型软件公司工作。或者他们只是不想被要求更多信息或更多支持的人打扰。

# html - PSD 到 HTML（带文本）的转换

> ID：646280
> 
> 赞同：0
> 
> 时间：2009-03-14T17:12:00.747
> 
> 标签：html, dreamweaver, psd

我刚刚下载了一个 .PSD 格式的网站模板。我已经通过 Photoshop 进行了更改，设置了拼接，然后单击“保存为网络设备”。

我导出网站并获得图像目录和 html 文件。到目前为止一切正常。

接下来我使用 Dreamweaver 打开 html 文件。

我的问题是创建网站文本内容的最佳方法是什么。图像都嵌入在表格的一部分，即

```
<tr>
    <td colspan="2" rowspan="8">
    <img src="images/storage.jpg" width="28" height="118" alt=""></td>
    <td colspan="4" rowspan="5">
    <img src="images/index_39.jpg" width="125" height="75" alt=""></td>
    <td colspan="4" rowspan="8">
    <img src="images/storage-41.jpg" width="81" height="118" alt=""></td>
    <td>
    <img src="images/spacer.gif" width="1" height="3" alt=""></td>
</tr> 
```

我将图像设置为表格元素的背景，但是我想知道创建文本的最佳方法是什么，即在表格中创建表格或 div 等？
我对css不太了解，所以如果你有一个例子，我将不胜感激

此外，是否有工具/网站可以自动为您执行此操作？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T17:39:40.057

您的模板是否仅附带 PSD 文件？

通常，PSD 文件允许您编辑图形部分，然后保存您需要的图像，将其放回 HTML，而不是直接从 PSD 生成 HTML。

既然你要求*最好*的方法来做到这一点，我会根据我的意见给你答案。

使用表格进行布局并不是设计网页的好方法。

表格应该用于表格数据。

您应该将内容放在 HTML 中，并使用 CSS 进行布局/演示。

如果你想了解 CSS，我建议如下：

*   [CSSZen](http://www.csszengarden.com/)
*   [HTML狗](http://htmldog.com/guides/cssbeginner/)
*   [设计模因](http://www.designmeme.com/articles/beginnercss/)

如果您有 Mac，我强烈建议您下载并试用 CSSEdit。对于 PC，Visual Studio 2008 也有一个不错的 CSS 编辑器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T17:18:14.680

我认为从 Photoshop 开始创建网站并不是最好的方法，正如您从标记中看到的那样。首先学习一些简单的教程，让您了解基本的 html 元素，以及创建网站样式的主要标记（通常使用 div 元素）。在此之后，您手动输入所需的图形。这以一个更易于维护的网站结束。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T17:25:19.077

如果您不想了解详细信息，可以将您的 psd 发送到[http://www.psd2html.com/](http://www.psd2html.com/)之类的服务。他们是为了钱...

# python - 如何使用 PIL 将 PNG 图像写入字符串？

> ID：646286
> 
> 赞同：115
> 
> 时间：2009-03-14T17:15:17.870
> 
> 标签：python, python-imaging-library

我已经使用[PIL](http://www.pythonware.com/products/pil/)生成了一个图像。如何将其保存到内存中的字符串？该`Image.save()`方法需要一个文件。

我想将几个这样的图像存储在字典中。

* * *

## 回答 #1

> 赞同：220
> 
> 时间：2009-03-14T17:21:04.113

您可以使用[`BytesIO`](https://docs.python.org/3.7/library/io.html#io.BytesIO)该类来获取行为类似于文件的字符串的包装器。该`BytesIO`对象提供与文件相同的接口，但仅将内容保存在内存中：

```
import io

with io.BytesIO() as output:
    image.save(output, format="GIF")
    contents = output.getvalue() 
```

您必须使用`format`参数显式指定输出格式，否则 PIL 在尝试自动检测时会引发错误。

如果你从一个文件加载图像，它有一个[`format`](https://pillow.readthedocs.io/en/stable/reference/Image.html#PIL.Image.format)包含原始文件格式的参数，所以在这种情况下你可以使用`format=image.format`.

在引入`io`模块之前的旧 Python 2 版本中，您将使用该[`StringIO`](https://docs.python.org/2/library/stringio.html)模块。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2015-04-30T15:16:32.053

对于 Python3，需要使用 BytesIO：

```
from io import BytesIO
from PIL import Image, ImageDraw

image = Image.new("RGB", (300, 50))
draw = ImageDraw.Draw(image)
draw.text((0, 0), "This text is drawn on image")

byte_io = BytesIO()

image.save(byte_io, 'PNG') 
```

阅读更多： http: [//fadeit.dk/blog/post/python3-flask-pil-in-memory-image](http://fadeit.dk/blog/post/python3-flask-pil-in-memory-image)

* * *

## 回答 #3

> 赞同：25
> 
> 时间：2011-03-31T17:46:26.717

某事的解决方案对我不起作用，
因为...

> Imaging/PIL/Image.pyc line 1423 -> raise KeyError(ext) # unknown extension

它试图从文件名中的扩展名中检测格式，这在 StringIO 情况下不存在

您可以通过在参数中自己设置格式来绕过格式检测

```
import StringIO
output = StringIO.StringIO()
format = 'PNG' # or 'JPEG' or whatever you want
image.save(output, format)
contents = output.getvalue()
output.close() 
```

* * *

## 回答 #4

> 赞同：15
> 
> 时间：2009-03-14T17:39:25.690

`save()`可以采用类似文件的对象以及路径，因此您可以使用内存缓冲区，例如`StringIO`：

```
buf = StringIO.StringIO()
im.save(buf, format='JPEG')
jpeg = buf.getvalue() 
```

* * *

## 回答 #5

> 赞同：13
> 
> 时间：2017-08-23T00:10:07.030

使用现代（截至 2017 年中期 Python 3.5 和 Pillow 4.0）：

StringIO 似乎不再像以前那样工作了。BytesIO 类是处理这个问题的正确方法。Pillow 的保存函数需要一个字符串作为第一个参数，但令人惊讶的是，它并没有看到 StringIO 是这样的。以下类似于旧的 StringIO 解决方案，但使用了 BytesIO。

```
from io import BytesIO
from PIL import Image

image = Image.open("a_file.png")
faux_file = BytesIO()
image.save(faux_file, 'png') 
```

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-03-14T17:36:43.403

当您说“我希望将大量此类图像存储在字典中”时，尚不清楚这是否是内存结构。

您无需执行任何这些操作即可在内存中柔和图像。只需将`image`对象保存在字典中即可。

如果您要将字典写入文件，您可能需要查看 `im.tostring()`方法和`Image.fromstring()`函数

[http://effbot.org/imagingbook/image.htm](http://effbot.org/imagingbook/image.htm)

> im.tostring() => 字符串
> 
> 使用标准的“原始”编码器返回一个包含像素数据的字符串。
> 
> Image.fromstring(mode, size, data) => image
> 
> 使用标准“原始”解码器从字符串中的像素数据创建图像内存。

当您交换文件时，“格式”（.jpeg、.png 等）仅在磁盘上很重要。如果您不交换文件，则格式无关紧要。

# java - 为什么 JList 选择会出现两次？

> ID：646288
> 
> 赞同：7
> 
> 时间：2009-03-14T17:16:32.517
> 
> 标签：java, swing, jlist

我有一个包含一些项目的 JList。我添加了一个侦听器，以便选择列表中的项目。以下是选择列表中的项目时发生的情况的代码：

```
private void questionaireNamesListValueChanged(ListSelectionEvent evt) {
    try {
        inputPanel.setEnabled(false);
        inputPanel.setVisible(false);
        inputTextField.setText("");
        inputStatusLabel.setText("");
        int questionaireIndex = questionaireNamesList.getSelectedIndex();

        // Why will this be printed twice?
        System.out.println("Questionaire Index: " + questionaireIndex);

        if (remoteQuestionServer.getQuestionCount(questionaireIndex) == 5) {
            answerQuestionButton.setEnabled(true);
            addQuestionButton.setEnabled(false);
        } else {
            addQuestionButton.setEnabled(true);
            answerQuestionButton.setEnabled(false);
        }
    } catch (RemoteException ex) {
        ex.printStackTrace();
    }
} 
```

正如您在上面可以看到的那样，我在其中添加了一条`System.out.print`语句，每次单击列表中的某些内容时，我都会得到该项目的两个输出，例如。

```
Questionaire Index: 4
Questionaire Index: 4
Questionaire Index: 2
Questionaire Index: 2
Questionaire Index: 0
Questionaire Index: 0
Questionaire Index: 2
Questionaire Index: 2 
```

知道为什么会这样吗？

谢谢，帕特里克

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-14T17:24:14.777

当您更改选择时，可能会发生一两个事件，具体取决于实现。如果选择索引 #4 并单击第二项，则会发生以下情况：

*   首先，索引#4 未选择。根据型号，`questionaireNamesList.getSelectedIndex()`可以合法地返回 2 或 -1。
*   其次，索引#2 被选中。此时，`questionaireNamesList.getSelectedIndex()`肯定会返回2。

因此，触发了两个事件。这些事件如何生成的定义为不同的 JVM 实现留有余地，它们的处理方式略有不同。

注意：您可能应该检查 的值[`ListSelectionEvent#getValueIsAdjusting()`](http://java.sun.com/javase/6/docs/api/javax/swing/event/ListSelectionEvent.html#getValueIsAdjusting())以查看您正在处理的事件是否是一系列事件中的一个。您可能需要忽略 this 返回的所有事件`true`。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T17:33:28.060

除了 Eddie 的回答，请查看事件的 getValueIsAdjusting 方法。

# php - 需要对一小段代码进行 php 脚本诊断

> ID：646300
> 
> 赞同：0
> 
> 时间：2009-03-14T17:23:00.300
> 
> 标签：php, regex, arrays

有人可以告诉我我真的做错了什么吗？我要疯了，以下代码在 localhost/WIN 上运行完美，当我在 webhost/linux 上尝试它时，它会发出警告：

```
$lines = file('english.php');
foreach($lines as $line) {
    $matches=array();
    if (preg_match('/DEFINE\(\'(.*?)\',\s*\'(.*)\'\);/i', $line, $matches)) {
        $keys[] = $matches[1];
        $values[] = $matches[2];
    }
}
$lang = array_combine($keys, $values); 
```

当我在虚拟主机上测试时：

```
Warning: array_combine() expects parameter 1 to be array, null given in /home/xx/public_html/xx on line 616 
```

但是在本地服务器（windows xp）上它工作得很好。我不知道我做错了什么，请帮我解决这个噩梦:(

谢谢。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T17:40:17.950

我看不出您的代码有任何明显错误，但我很好奇您为什么要构建单独的数组然后将它们组合起来，而不是仅仅构建一个组合数组：

```
// Make sure this file is local to the system the script is running on.
// If it's a "url://" path, you can run into url_fopen problems.
$lines = file('english.php');

// No need to reinitialize each time.
$matches = array();

$lang = array();
foreach($lines as $line) {
    if (preg_match('/DEFINE\(\'([^\']*)\',\s*\'([^\\\\\']*(?:\\.[^\\\\\']*)*)\'\);/i', $line, $matches)) {
        $lang[$matches[1]] = $matches[2];
    }
} 
```

（我还更改了您的正则表达式以处理单引号。）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T17:26:01.587

php版本是一样的吗？

您确定您已将所有文件传输到虚拟主机吗？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T17:27:10.057

您的 $keys 变量似乎为空，因为您没有在任何地方对其进行初始化。

我最好的猜测是您服务器上的 english.php 文件是空的（或不存在），所以当您尝试读取它时，$keys 变量中没有保存任何内容；

尝试在 foreach 语句之前为该变量添加一个初始值：

```
$lines = file('english.php');
$keys = array();
foreach($lines as $line) {
$matches=array();
    if (preg_match('/DEFINE\(\'(.*?)\',\s*\'(.*)\'\);/i', $line, $matches)) {
        $keys[] = $matches[1];
        $values[] = $matches[2];
    }
}
$lang = array_combine($keys, $values); 
```

这样，即使文件不存在或为空，您也可以覆盖所有可能的路径。

您应该始终编码好像一切都可能出错，而不是相反:)

# eclipse - 在 Eclipse 中运行单个 JUnit 测试

> ID：646307
> 
> 赞同：87
> 
> 时间：2009-03-14T17:27:13.287
> 
> 标签：eclipse, junit

如果我有一个包含多个测试的测试套件，当我尝试从代码编辑器的上下文菜单或 JUnit 视图运行单个单元测试时，它似乎坚持始终运行整个套件，而不是单测试。有没有办法禁用更改此行为，以便我可以要求运行它，并且只有那个，测试。

* * *

## 回答 #1

> 赞同：97
> 
> 时间：2009-03-14T17:34:20.133

在包资源管理器中展开类。它应该向您展示所有方法。右键单击要运行的一种方法，然后从上下文菜单中选择 Run As -> JUnit（刚刚使用 Eclipse 3.4.1 进行了测试）。同样在 JUnit-results 视图中的单个条目上选择“运行”以重新运行测试以相同的方式工作。

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2014-03-14T11:11:43.020

我知道的最快方法：

1.  按`Ctrl`+ `Shift`+`↑</kbd> (moves cursor to current method declaration),`
2.  按`Alt`+ `Shift`+ `x`（或`d`调试）然后按`t`（*“运行 JUnit 测试”*的热键），
3.  检查测试结果，
4.  按`Alt`+`←</kbd> to get back to the line of code you were before.`

如果要运行所有测试，可以跳过步骤 1 和 4。

* * *

## 回答 #3

> 赞同：13
> 
> 时间：2009-08-19T10:53:32.557

在 Eclipse 3.5 中，您可以通过将测试运行程序更改为 JUnit 3 来解决此问题。这仅适用于 JUnit 3 测试，不适用于 JUnit 4 测试。您可以通过执行以下操作来更改测试运行器：

1.  右键单击大纲资源管理器中的一种测试方法
2.  选择运行方式-> 运行配置
3.  在“测试”选项卡上，选择“运行单个测试”
4.  在 Test Runner 下拉列表中，选择“JUnit 3”

它也可以在其他版本中工作。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2011-11-03T04:24:03.660

这在带有 JUnit 4.8.2 的 Eclipse Indigo 中是可能的。`Outline`在窗格中右键单击要单独进行单元测试的方法，然后选择`Run As -> JUnit Test`.

您甚至可以有选择地在源代码编辑器中右键单击测试方法名称并选择`Run As -> Junit Test`.

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-04-08T15:19:05.070

我将通过包含一个高效的键盘唯一方法来添加其他方法，该方法允许您调试单个单元测试（方法）。

使用以下任一方法将光标移动到方法名称

*   `Ctrl`+ `Shift`+`Up`或
*   `Ctrl`+ `Shift`+`Down`或
*   `Ctrl`+`o`然后输入方法的名称

一旦您的光标位于方法名称上（或在它之前）：

*   `Alt`+ `Shift`+ `D`-> `T`（调试）
*   `Alt`+ `Shift`+ `X`-> `T`（运行）

运行测试后，您可以通过执行以下操作返回光标所在的位置：

`Alt`+`Back`

您几乎可以通过以下方式获得类似 REPL 的行为：

`Ctrl`+ `Shift`+`Up`和`Alt`+ `Shift`+ `X`->`T`和`Alt`+`Back`

您还可以快速设置断点：

`Ctrl`+ `Shift`+`B`

* * *

## 回答 #6

> 赞同：9
> 
> 时间：2009-03-16T15:02:21.760

不要使用`Strg`+`F11`但热键`Alt`+ `Shift`+ `X`-> `T`。
然后 Eclipse 会将当前打开的文件作为 JUnit 测试执行。绿色播放按钮将只运行最后选择的运行配置。

对我来说，它适用于`Alt`+ `Shift`+ `X`-> `T`。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-08-06T13:27:54.913

右键单击文件中测试方法名称的某处，然后选择“运行”->“Junit 测试”。我一直使用 Kepler 和 JUnit 4 来做这件事。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-02-22T21:40:08.143

我遇到了其他人在使用 Eclipse 3.4.1 和 JUnit 4 测试运行程序时遇到的同样问题——无法运行单个测试。但我在其他地方找到了解决问题的建议。我的测试类仍在扩展 junit.framework.TestCase。当我停止扩展 TestCase 时，一切正常，我能够使用 JUnit 4 测试运行器运行单个 JUnit 测试。当然，我需要 JUnit 4 注释对断言方法使用静态导入，但我已经这样做了——我只是没有删除 TestCase 继承。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2019-12-02T16:08:41.863

只运行一种测试方法。
在（包资源管理器或项目资源管理器）中展开类。它应该向您展示所有方法。右键单击要运行的一种方法，然后从上下文菜单中选择 Run As -> JUnit。
[![在此处输入图像描述](https://i.stack.imgur.com/UMeKS.png)](https://i.stack.imgur.com/UMeKS.png)

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-14T19:40:15.290

If you have many tests in more than one file, and you want to run only the tests in a particular file, you could right click that file, and select run as -> junit test. Now, if you want to run only one test, contained in a file with many tests, my guess is (I dont have eclipse installed here) that the Outline view will list all test methods for a file, and you will probably be able to right click a single test method and execute it as a JUNit test.

Hope it helps.

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-09T04:48:02.360

我同意关于 3.4.2 不再像以前版本那样工作的观点。在您可以从 JUnit 视图中右键单击一组测试中的单个测试并只执行该测试之前。在最新版本中，它坚持始终运行所有这些。当然，该视图确实会运行您首先单击的测试，并将其余部分转储到名为“Unrooted Tests”的汇总中。如果有人弄清楚这一点，我想知道如何解决它。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-05T16:23:42.987

对我来说，它在 Eclipse 3.4.2 中也不起作用，尽管它在以前的版本中起作用（我尝试从包资源管理器运行单个方法并从 junit 视图运行单个 junit 测试）

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-03-14T11:34:48.050

阅读这里的一些评论，您似乎有兴趣在更改代码时运行测试，而不会失去对您正在处理的代码的关注。有一个 Eclipse 插件可以做到这一点。见[无穷大](http://infinitest.github.io/)。

# vb.net - 获取应用程序内的资源文件

> ID：646310
> 
> 赞同：0
> 
> 时间：2009-03-14T17:28:13.517
> 
> 标签：vb.net

我想知道我是否可以访问应用程序资源文件夹中的文件夹？我会消除在存储文件中使用调试目录并使用 clickonce 部署。

我需要你的意见和建议。谢谢你。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T17:48:29.413

您可以更改项目将其构建到的输出位置。右键单击项目名称并单击属性，然后转到构建并在底部附近向下，它会告诉您将构建输出到哪里。如果你在调试中构建它，它通常去 bin\Debug，release 去 \bin\Release，等等。

您可以[在此处](http://www.15seconds.com/issue/041229.htm)查看有关 ClickOnce 部署的信息。

# regex - 在替换之前对正则表达式中捕获的数字进行计算

> ID：646316
> 
> 赞同：2
> 
> 时间：2009-03-14T17:31:59.640
> 
> 标签：regex, notepad++

使用正则表达式，我能够找到一堆我想要替换的数字。但是，我想用另一个使用原始捕获的数字计算的数字替换该数字。

在notepad ++中使用替换部分中的一种表达式是否可能？

**编辑：**也许是一个奇怪的想法，但计算可以在搜索部分完成，生成第二个捕获的数字，这将有效地成为结果？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T17:34:24.593

> 在notepad ++中使用替换部分中的一种表达式是否可能？

正则表达式匹配的插值评估是一个相对高级的功能，我可能不希望在通用文本编辑应用程序中找到它。我玩了一下记事本++，但无法让它工作，我也无法在文档中找到任何表明这是可能的东西。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-03T19:06:11.367

即使*有*可能，它也几乎肯定会“混乱”——为什么不用一个简单的脚本来代替呢？例如..

```
#!/usr/bin/env ruby
f = File.new("f1.txt", File::RDWR)
contents = f.read()

contents.gsub!(/\d+/){|m|
  m.to_i + 1 # convert the current match to an integer, and add one
}

f.truncate(0) # empty the existing file
f.seek(0) # seek to the start of the file, before writing again
f.write(contents) # write modified file
f.close() 
```

..和输出：

```
$ cat f1.txt
This was one: 1
This two two: 2
$ ruby replacer.rb
$ cat f1.txt
This was one: 2
This two two: 3 
```

* * *

在回复 jeroen 的评论时，

> 我真的很感兴趣，如果正则表达式本身存在这种可能性，因为它们是如此普遍

正则表达式实际上只是一种简单的模式匹配语法。做任何比搜索/替换匹配项更高级的事情将取决于文本编辑器，但是这样做的用处非常有限，并且可以通过大多数编辑器允许的脚本来实现（[Notepad++](http://notepad-plus.sourceforge.net/uk/download.php)有一个插件系统，虽然我已经不知道它是多么容易使用）。

基本上，如果 regex/search-and-replace 不能达到你想要的，我会说要么使用你的编辑器脚本能力，要么使用外部脚本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-14T17:35:30.693

嗯...我不得不推荐 AWK 来做这件事。

[http://en.wikipedia.org/wiki/AWK](http://en.wikipedia.org/wiki/AWK)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-03T18:33:42.020

notepad++ 内置了有限的正则表达式。有一些扩展为正则表达式查找和替换添加了更多内容，但我发现那些很难使用。我建议编写一个小外部程序来为您完成。Ruby、Perl 或 Python 都适合它。如果你知道那些语言。我使用 Ruby 并取得了很大的成功。

# jquery - 如何检查 JQuery 选择中是否已存在选项

> ID：646317
> 
> 赞同：191
> 
> 时间：2009-03-14T17:32:17.360
> 
> 标签：jquery

如何检查 JQuery 选择中是否已存在选项？

我想动态地将选项添加到选择中，所以我需要检查该选项是否已经存在以防止重复。

* * *

## 回答 #1

> 赞同：377
> 
> 时间：2009-03-14T17:34:24.877

如果它已经存在，则计算结果为 true：

```
$("#yourSelect option[value='yourValue']").length > 0; 
```

* * *

## 回答 #2

> 赞同：27
> 
> 时间：2012-03-30T11:45:04.153

使用 jQuery 的另一种方式：

```
var exists = false; 
$('#yourSelect  option').each(function(){
  if (this.value == yourValue) {
    exists = true;
  }
}); 
```

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-03-14T17:35:01.253

```
if ( $("#your_select_id option[value=<enter_value_here>]").length == 0 ){
  alert("option doesn't exist!");
} 
```

* * *

## 回答 #4

> 赞同：19
> 
> 时间：2016-05-20T11:10:26.867

```
var exists = $("#yourSelect option")
               .filter(function (i, o) { return o.value === yourValue; })
               .length > 0; 
```

这具有自动为您转义值的优点，这使得文本中的随机引号更容易处理。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2020-06-19T12:42:26.390

尽管大多数其他答案对我有用，但我使用了 .find()：

```
if ($("#yourSelect").find('option[value="value"]').length === 0){
    ...
} 
```

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2011-03-14T20:02:10.570

不起作用，你必须这样做：

```
if ( $("#your_select_id option[value='enter_value_here']").length == 0 ){
  alert("option doesn't exist!");
} 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-09-24T18:38:25.353

这对我有帮助：

```
 var key = 'Hallo';

   if ( $("#chosen_b option[value='"+key+"']").length == 0 ){
   alert("option not exist!");

    $('#chosen_b').append("<option value='"+key+"'>"+key+"</option>");
    $('#chosen_b').val(key);
   $('#chosen_b').trigger("chosen:updated");
                         }
  }); 
```

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2019-11-12T19:24:08.290

我有一个类似的问题。我不是每次都通过选择控件的循环运行 dom 搜索，而是将 jquery select 元素保存在一个变量中并执行此操作：

```
function isValueInSelect($select, data_value){
    return $($select).children('option').map(function(index, opt){
        return opt.value;
    }).get().includes(data_value);
} 
```

# nhibernate - NHibernate 与 TransactionScope

> ID：646318
> 
> 赞同：34
> 
> 时间：2009-03-14T17:33:07.857
> 
> 标签：nhibernate, transactionscope

谁能给我一个快速概述使用 NHibernate 的 TransactionScope？我需要对 session/IEnlistmentNotification/等做任何特别的事情吗？让它工作？有什么我应该担心的陷阱吗？例如，我可以替换我所有的休眠事务：

```
var transaction = session.BeginTransaction();
try
{
    // code
    transaction.Commit();
}
catch (Exception)
{
    transaction.Rollback();
} 
```

有了这个？：

```
using (var scope = new TransactionScope())
{
    // code
    scope.Complete();
} 
```

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2010-11-03T08:46:26.563

我使用 nHibernate 2.1 已经有一段时间了，在经历了一些生产问题并尝试了很多变体之后，我们根据[避免与 NHibernate 和 TransactionScope 的泄漏连接](http://davybrion.com/blog/2010/05/avoiding-leaking-connections-with-nhibernate-and-transactionscope/)确定了以下方法：

```
 using (var scope = new TransactionScope(TransactionScopeOption.Required))
        {
            using (var session = sessionFactory.OpenSession())
            using (var transaction = session.BeginTransaction())
            {
                // do what you need to do with the session
                transaction.Commit();
            }
            scope.Complete();
        } 
```

由于我们使用的是 MSMQ 和 WCF，所以我们不得不使用环境事务。

我们发现不使用 session.BeginTransaction() 会导致连接泄漏。我们还发现，在提交事务后重新使用会话会导致竞争条件（nHibernate 不是线程安全的，DTSC 提交/回滚发生在后台线程上）。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-30T19:37:36.743

我已经使用不同的供应商对此进行了测试，并且可以正常工作。如果您没有“scope.Complete()”，那么事务将回滚。如果有多个持久资源，您可能需要让 MSDTC 运行所涉及的计算机。在这种情况下，MSDTC 将自动检测环境 ADO.NET 事务并管理整个事务。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-07-06T09:55:07.310

如果您使用的连接提供程序支持使用轻量级事务管理器，如 SQL Server 2005/2008，则上述工作正常。

如果您使用的是 SQL Server 7/2000，那么即使您只点击一个数据库/资源​​，您的所有事务都将变为分布式事务。在大多数情况下，这可能不是您想要的，并且在性能方面会很昂贵。

因此，请检查您的连接提供程序和数据库服务器组合是否适合与 TransactionScope 一起使用。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2013-02-28T13:06:33.700

我相信你可以用这个替换 NHibernate 事务，只要你尊重一些约束，正如一些人已经说过的：

*   使用相当新的 NHibernate 版本（[>=3.1](http://thatextramile.be/blog/2010/05/avoiding-leaking-connections-with-nhibernate-and-transactionscope)）。
*   底层 ADO.NET 数据提供程序必须支持 TransactionScope（适用于 SQL-Server，Oracle >= 10 和 ODP.NET）。
*   *在*TransactionScope 中创建您的 NH 会话以确保它被登记。
*   手动处理 NHibernate[冲洗。](http://nhforge.org/doc/nh/en/index.html#manipulatingdata-flushing)另请参阅[此处](https://stackoverflow.com/questions/5187860/nhibernate-3-0-transactionscope-and-auto-flushing)和[此处](https://stackoverflow.com/a/15135552/1654527)。
*   准备分布式事务。如果您在一个范围内创建多个会话，最初的本地事务可能会升级为分布式事务。即使在使用 ODAC 11.2.0.3.20 的 Oracle 11.2 DB 上使用相同的连接字符串，我也看到了这种情况。在 SQL-Server 2008 R2 上它没有提升。（顺便说一句，可以通过观看 Transaction.Current.TransactionInformation.DistributedIdentifier 来了解这一点，这对于本地事务来说是空的。）虽然分布式事务有一些优点，但它们更昂贵，而且设置它们会带来一些额外的痛苦。（请参阅[此处](http://docs.oracle.com/cd/E11882_01/win.112/e26104/using.htm#i1007181)如何为 Oracle 执行此操作）。为确保 Oracle 中永远不会发生升级，请在连接字符串中设置“ [Promotable Transaction](http://docs.oracle.com/cd/E11882_01/win.112/e23174/featADO20.htm#CJAEDJII) =local”。如果某些代码尝试这样做，则会产生异常。

我希望这就是全部;-)

PS：我添加了 Oracle 详细信息，因为它们是我和其他人可能受益的地方。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-09-14T12:46:35.133

根据 Fabio Maulo 在与[NH-2107](https://nhibernate.jira.com/browse/NH-2107)相关的评论中所说：

> 你可以使用 TransactionScope，你也应该继续使用 NH 的事务。您在哪里读到 TransactionScope 的使用意味着避免使用 NH 的事务？

我会假设没有必要明确使用 NHibernate 的事务，但显然这是最佳实践

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-11-16T20:14:34.733

此外，如果您使用 TransactionScope，请升级到 NHibernate 2.1。只有在 2.1 中，NH 才真正与 TransactionScope 很好地集成。

# deployment - JBoss5：由于 java.util.zip.ZipException 无法部署：打开 zip 文件时出错

> ID：646322
> 
> 赞同：12
> 
> 时间：2009-03-14T17:33:42.553
> 
> 标签：deployment, jboss, war, ear

我有一个使用 Eclipse 3.4 创建的 Web 客户端和一个 EJB 项目。当我想在 Jboss 5.0.1 上部署它时，我收到以下错误。我进行了很多搜索，但找不到解决方案。

```
18:21:21,899 INFO  [ServerImpl] Starting JBoss (Microcontainer)...
18:21:21,900 INFO  [ServerImpl] Release ID: JBoss [Morpheus] 5.0.1.GA (build: SVNTag=JBoss_5_0_1_GA date=200902231221)
18:21:21,900 INFO  [ServerImpl] Bootstrap URL: null
18:21:21,900 INFO  [ServerImpl] Home Dir: /Applications/jboss-5.0.1.GA
18:21:21,900 INFO  [ServerImpl] Home URL: file:/Applications/jboss-5.0.1.GA/
18:21:21,901 INFO  [ServerImpl] Library URL: file:/Applications/jboss-5.0.1.GA/lib/
18:21:21,901 INFO  [ServerImpl] Patch URL: null
18:21:21,901 INFO  [ServerImpl] Common Base URL: file:/Applications/jboss-5.0.1.GA/common/
18:21:21,902 INFO  [ServerImpl] Common Library URL: file:/Applications/jboss-5.0.1.GA/common/lib/
18:21:21,902 INFO  [ServerImpl] Server Name: default
18:21:21,902 INFO  [ServerImpl] Server Base Dir: /Applications/jboss-5.0.1.GA/server
18:21:21,902 INFO  [ServerImpl] Server Base URL: file:/Applications/jboss-5.0.1.GA/server/
18:21:21,902 INFO  [ServerImpl] Server Config URL: file:/Applications/jboss-5.0.1.GA/server/default/conf/
18:21:21,902 INFO  [ServerImpl] Server Home Dir: /Applications/jboss-5.0.1.GA/server/default
18:21:21,902 INFO  [ServerImpl] Server Home URL: file:/Applications/jboss-5.0.1.GA/server/default/
18:21:21,903 INFO  [ServerImpl] Server Data Dir: /Applications/jboss-5.0.1.GA/server/default/data
18:21:21,903 INFO  [ServerImpl] Server Library URL: file:/Applications/jboss-5.0.1.GA/server/default/lib/
18:21:21,903 INFO  [ServerImpl] Server Log Dir: /Applications/jboss-5.0.1.GA/server/default/log
18:21:21,903 INFO  [ServerImpl] Server Native Dir: /Applications/jboss-5.0.1.GA/server/default/tmp/native
18:21:21,903 INFO  [ServerImpl] Server Temp Dir: /Applications/jboss-5.0.1.GA/server/default/tmp
18:21:21,903 INFO  [ServerImpl] Server Temp Deploy Dir: /Applications/jboss-5.0.1.GA/server/default/tmp/deploy
18:21:22,669 INFO  [ServerImpl] Starting Microcontainer, bootstrapURL=file:/Applications/jboss-5.0.1.GA/server/default/conf/bootstrap.xml
18:21:23,535 INFO  [VFSCacheFactory] Initializing VFSCache [org.jboss.virtual.plugins.cache.CombinedVFSCache]
18:21:23,541 INFO  [VFSCacheFactory] Using VFSCache [CombinedVFSCache[real-cache: null]]
18:21:23,942 INFO  [CopyMechanism] VFS temp dir: /Applications/jboss-5.0.1.GA/server/default/tmp
18:21:23,943 INFO  [ZipEntryContext] VFS force nested jars copy-mode is enabled.
18:21:26,263 INFO  [ServerInfo] Java version: 1.5.0_16,Apple Inc.
18:21:26,264 INFO  [ServerInfo] Java Runtime: Java(TM) 2 Runtime Environment, Standard Edition (build 1.5.0_16-b06-284)
18:21:26,264 INFO  [ServerInfo] Java VM: Java HotSpot(TM) Server VM 1.5.0_16-133,Apple Inc.
18:21:26,264 INFO  [ServerInfo] OS-System: Mac OS X 10.5.6,i386
18:21:26,336 INFO  [JMXKernel] Legacy JMX core initialized
18:21:30,432 INFO  [ProfileServiceImpl] Loading profile: default from: org.jboss.system.server.profileservice.repository.SerializableDeploymentRepository@e1d5d9(root=/Applications/jboss-5.0.1.GA/server, key=org.jboss.profileservice.spi.ProfileKey@143b82c3[domain=default,server=default,name=default])
18:21:30,436 INFO  [ProfileImpl] Using repository:org.jboss.system.server.profileservice.repository.SerializableDeploymentRepository@e1d5d9(root=/Applications/jboss-5.0.1.GA/server, key=org.jboss.profileservice.spi.ProfileKey@143b82c3[domain=default,server=default,name=default])
18:21:30,436 INFO  [ProfileServiceImpl] Loaded profile: ProfileImpl@ae002e{key=org.jboss.profileservice.spi.ProfileKey@143b82c3[domain=default,server=default,name=default]}
18:21:32,935 INFO  [WebService] Using RMI server codebase: http://localhost:8083/
18:21:42,572 INFO  [NativeServerConfig] JBoss Web Services - Stack Native Core
18:21:42,573 INFO  [NativeServerConfig] 3.0.5.GA
18:21:52,836 ERROR [AbstractKernelController] Error installing to ClassLoader: name=vfsfile:/Applications/jboss-5.0.1.GA/server/default/deploy/TwitterEAR.ear/ state=Describe mode=Manual requiredState=ClassLoader
org.jboss.deployers.spi.DeploymentException: Error creating classloader for vfsfile:/Applications/jboss-5.0.1.GA/server/default/deploy/TwitterEAR.ear/
    at org.jboss.deployers.spi.DeploymentException.rethrowAsDeploymentException(DeploymentException.java:49)
    at org.jboss.deployers.structure.spi.helpers.AbstractDeploymentContext.createClassLoader(AbstractDeploymentContext.java:576)
    at org.jboss.deployers.structure.spi.helpers.AbstractDeploymentUnit.createClassLoader(AbstractDeploymentUnit.java:159)
    at org.jboss.deployers.spi.deployer.helpers.AbstractClassLoaderDeployer.deploy(AbstractClassLoaderDeployer.java:53)
    at org.jboss.deployers.plugins.deployers.DeployerWrapper.deploy(DeployerWrapper.java:171)
    at org.jboss.deployers.plugins.deployers.DeployersImpl.doDeploy(DeployersImpl.java:1439)
    at org.jboss.deployers.plugins.deployers.DeployersImpl.doInstallParentFirst(DeployersImpl.java:1157)
    at org.jboss.deployers.plugins.deployers.DeployersImpl.install(DeployersImpl.java:1098)
    at org.jboss.dependency.plugins.AbstractControllerContext.install(AbstractControllerContext.java:348)
    at org.jboss.dependency.plugins.AbstractController.install(AbstractController.java:1598)
    at org.jboss.dependency.plugins.AbstractController.incrementState(AbstractController.java:934)
    at org.jboss.dependency.plugins.AbstractController.resolveContexts(AbstractController.java:1062)
    at org.jboss.dependency.plugins.AbstractController.resolveContexts(AbstractController.java:984)
    at org.jboss.dependency.plugins.AbstractController.change(AbstractController.java:822)
    at org.jboss.dependency.plugins.AbstractController.change(AbstractController.java:553)
    at org.jboss.deployers.plugins.deployers.DeployersImpl.process(DeployersImpl.java:781)
    at org.jboss.deployers.plugins.main.MainDeployerImpl.process(MainDeployerImpl.java:698)
    at org.jboss.system.server.profileservice.ProfileServiceBootstrap.loadProfile(ProfileServiceBootstrap.java:304)
    at org.jboss.system.server.profileservice.ProfileServiceBootstrap.start(ProfileServiceBootstrap.java:205)
    at org.jboss.bootstrap.AbstractServerImpl.start(AbstractServerImpl.java:405)
    at org.jboss.Main.boot(Main.java:209)
    at org.jboss.Main$1.run(Main.java:547)
    at java.lang.Thread.run(Thread.java:613)
Caused by: java.lang.Error: Error visiting FileHandler@5567366[path=TwitterEAR.ear/TwitterPoCEJB.jar context=file:/Applications/jboss-5.0.1.GA/server/default/deploy/ real=file:/Applications/jboss-5.0.1.GA/server/default/deploy/TwitterEAR.ear/TwitterPoCEJB.jar/]
    at org.jboss.classloading.plugins.vfs.PackageVisitor.determineAllPackages(PackageVisitor.java:98)
    at org.jboss.deployers.vfs.plugins.classloader.VFSDeploymentClassLoaderPolicyModule.determineCapabilities(VFSDeploymentClassLoaderPolicyModule.java:108)
    at org.jboss.classloading.spi.dependency.Module.getCapabilities(Module.java:654)
    at org.jboss.classloading.spi.dependency.Module.determinePackageNames(Module.java:713)
    at org.jboss.classloading.spi.dependency.Module.getPackageNames(Module.java:698)
    at org.jboss.deployers.vfs.plugins.classloader.VFSDeploymentClassLoaderPolicyModule.determinePolicy(VFSDeploymentClassLoaderPolicyModule.java:129)
    at org.jboss.deployers.vfs.plugins.classloader.VFSDeploymentClassLoaderPolicyModule.determinePolicy(VFSDeploymentClassLoaderPolicyModule.java:48)
    at org.jboss.classloading.spi.dependency.policy.ClassLoaderPolicyModule.getPolicy(ClassLoaderPolicyModule.java:195)
    at org.jboss.deployers.vfs.plugins.classloader.VFSDeploymentClassLoaderPolicyModule.getPolicy(VFSDeploymentClassLoaderPolicyModule.java:122)
    at org.jboss.deployers.vfs.plugins.classloader.VFSDeploymentClassLoaderPolicyModule.getPolicy(VFSDeploymentClassLoaderPolicyModule.java:48)
    at org.jboss.classloading.spi.dependency.policy.ClassLoaderPolicyModule.registerClassLoaderPolicy(ClassLoaderPolicyModule.java:131)
    at org.jboss.deployers.plugins.classloading.AbstractLevelClassLoaderSystemDeployer.createClassLoader(AbstractLevelClassLoaderSystemDeployer.java:120)
    at org.jboss.deployers.structure.spi.helpers.AbstractDeploymentContext.createClassLoader(AbstractDeploymentContext.java:562)
    ... 21 more
Caused by: java.lang.RuntimeException: java.util.zip.ZipException: error in opening zip file
    at org.jboss.virtual.plugins.context.AbstractExceptionHandler.handleZipEntriesInitException(AbstractExceptionHandler.java:39)
    at org.jboss.virtual.plugins.context.helpers.NamesExceptionHandler.handleZipEntriesInitException(NamesExceptionHandler.java:63)
    at org.jboss.virtual.plugins.context.zip.ZipEntryContext.ensureEntries(ZipEntryContext.java:610)
    at org.jboss.virtual.plugins.context.zip.ZipEntryContext.checkIfModified(ZipEntryContext.java:757)
    at org.jboss.virtual.plugins.context.zip.ZipEntryContext.getChildren(ZipEntryContext.java:829)
    at org.jboss.virtual.plugins.context.zip.ZipEntryHandler.getChildren(ZipEntryHandler.java:159)
    at org.jboss.virtual.plugins.context.DelegatingHandler.getChildren(DelegatingHandler.java:121)
    at org.jboss.virtual.plugins.context.AbstractVFSContext.getChildren(AbstractVFSContext.java:211)
    at org.jboss.virtual.plugins.context.AbstractVFSContext.visit(AbstractVFSContext.java:328)
    at org.jboss.virtual.plugins.context.AbstractVFSContext.visit(AbstractVFSContext.java:298)
    at org.jboss.virtual.VFS.visit(VFS.java:433)
    at org.jboss.virtual.VirtualFile.visit(VirtualFile.java:437)
    at org.jboss.virtual.VirtualFile.getChildren(VirtualFile.java:386)
    at org.jboss.virtual.VirtualFile.getChildren(VirtualFile.java:367)
    at org.jboss.classloading.plugins.vfs.PackageVisitor.visit(PackageVisitor.java:200)
    at org.jboss.virtual.plugins.vfs.helpers.WrappingVirtualFileHandlerVisitor.visit(WrappingVirtualFileHandlerVisitor.java:62)
    at org.jboss.virtual.plugins.context.AbstractVFSContext.visit(AbstractVFSContext.java:353)
    at org.jboss.virtual.plugins.context.AbstractVFSContext.visit(AbstractVFSContext.java:298)
    at org.jboss.virtual.VFS.visit(VFS.java:433)
    at org.jboss.virtual.VirtualFile.visit(VirtualFile.java:437)
    at org.jboss.classloading.plugins.vfs.PackageVisitor.determineAllPackages(PackageVisitor.java:94)
    ... 33 more
Caused by: java.util.zip.ZipException: error in opening zip file
    at java.util.zip.ZipFile.open(Native Method)
    at java.util.zip.ZipFile.<init>(ZipFile.java:203)
    at java.util.zip.ZipFile.<init>(ZipFile.java:234)
    at org.jboss.virtual.plugins.context.zip.ZipFileWrapper.ensureZipFile(ZipFileWrapper.java:175)
    at org.jboss.virtual.plugins.context.zip.ZipFileWrapper.acquire(ZipFileWrapper.java:245)
    at org.jboss.virtual.plugins.context.zip.ZipEntryContext.initEntries(ZipEntryContext.java:470)
    at org.jboss.virtual.plugins.context.zip.ZipEntryContext.ensureEntries(ZipEntryContext.java:603)
    ... 51 more
18:21:56,772 INFO  [JMXConnectorServerService] JMX Connector server: service:jmx:rmi://localhost/jndi/rmi://localhost:1090/jmxconnector
18:21:56,959 INFO  [MailService] Mail Service bound to java:/Mail
18:21:59,450 WARN  [JBossASSecurityMetadataStore] WARNING! POTENTIAL SECURITY RISK. It has been detected that the MessageSucker component which sucks messages from one node to another has not had its password changed from the installation default. Please see the JBoss Messaging user guide for instructions on how to do this.
18:21:59,489 WARN  [AnnotationCreator] No ClassLoader provided, using TCCL: org.jboss.managed.api.annotation.ManagementComponent
18:21:59,789 INFO  [TransactionManagerService] JBossTS Transaction Service (JTA version) - JBoss Inc.
18:21:59,789 INFO  [TransactionManagerService] Setting up property manager MBean and JMX layer
18:22:00,040 INFO  [TransactionManagerService] Initializing recovery manager
18:22:00,160 INFO  [TransactionManagerService] Recovery manager configured
18:22:00,160 INFO  [TransactionManagerService] Binding TransactionManager JNDI Reference
18:22:00,184 INFO  [TransactionManagerService] Starting transaction recovery manager
18:22:01,243 INFO  [Http11Protocol] Initializing Coyote HTTP/1.1 on http-localhost%2F127.0.0.1-8080
18:22:01,244 INFO  [AjpProtocol] Initializing Coyote AJP/1.3 on ajp-localhost%2F127.0.0.1-8009
18:22:01,244 INFO  [StandardService] Starting service jboss.web
18:22:01,247 INFO  [StandardEngine] Starting Servlet Engine: JBoss Web/2.1.2.GA
18:22:01,336 INFO  [Catalina] Server startup in 161 ms
18:22:01,360 INFO  [TomcatDeployment] deploy, ctxPath=/invoker
18:22:02,014 INFO  [TomcatDeployment] deploy, ctxPath=/web-console
18:22:02,459 INFO  [TomcatDeployment] deploy, ctxPath=/jbossws
18:22:02,570 INFO  [RARDeployment] Required license terms exist, view vfszip:/Applications/jboss-5.0.1.GA/server/default/deploy/jboss-local-jdbc.rar/META-INF/ra.xml
18:22:02,586 INFO  [RARDeployment] Required license terms exist, view vfszip:/Applications/jboss-5.0.1.GA/server/default/deploy/jboss-xa-jdbc.rar/META-INF/ra.xml
18:22:02,645 INFO  [RARDeployment] Required license terms exist, view vfszip:/Applications/jboss-5.0.1.GA/server/default/deploy/jms-ra.rar/META-INF/ra.xml
18:22:02,663 INFO  [RARDeployment] Required license terms exist, view vfszip:/Applications/jboss-5.0.1.GA/server/default/deploy/mail-ra.rar/META-INF/ra.xml
18:22:02,705 INFO  [RARDeployment] Required license terms exist, view vfszip:/Applications/jboss-5.0.1.GA/server/default/deploy/quartz-ra.rar/META-INF/ra.xml
18:22:02,801 INFO  [SimpleThreadPool] Job execution threads will use class loader of thread: main
18:22:02,850 INFO  [QuartzScheduler] Quartz Scheduler v.1.5.2 created.
18:22:02,857 INFO  [RAMJobStore] RAMJobStore initialized.
18:22:02,858 INFO  [StdSchedulerFactory] Quartz scheduler 'DefaultQuartzScheduler' initialized from default resource file in Quartz package: 'quartz.properties'
18:22:02,858 INFO  [StdSchedulerFactory] Quartz scheduler version: 1.5.2
18:22:02,859 INFO  [QuartzScheduler] Scheduler DefaultQuartzScheduler_$_NON_CLUSTERED started.
18:22:03,888 INFO  [ConnectionFactoryBindingService] Bound ConnectionManager 'jboss.jca:service=DataSourceBinding,name=DefaultDS' to JNDI name 'java:DefaultDS'
18:22:04,530 INFO  [ServerPeer] JBoss Messaging 1.4.1.GA server [0] started
18:22:04,624 INFO  [QueueService] Queue[/queue/DLQ] started, fullSize=200000, pageSize=2000, downCacheSize=2000
18:22:04,632 WARN  [ConnectionFactoryJNDIMapper] supportsFailover attribute is true on connection factory: jboss.messaging.connectionfactory:service=ClusteredConnectionFactory but post office is non clustered. So connection factory will *not* support failover
18:22:04,632 WARN  [ConnectionFactoryJNDIMapper] supportsLoadBalancing attribute is true on connection factory: jboss.messaging.connectionfactory:service=ClusteredConnectionFactory but post office is non clustered. So connection factory will *not* support load balancing
18:22:04,742 INFO  [ConnectionFactory] Connector bisocket://localhost:4457 has leasing enabled, lease period 10000 milliseconds
18:22:04,742 INFO  [ConnectionFactory] org.jboss.jms.server.connectionfactory.ConnectionFactory@6af9ad started
18:22:04,746 INFO  [QueueService] Queue[/queue/ExpiryQueue] started, fullSize=200000, pageSize=2000, downCacheSize=2000
18:22:04,747 INFO  [ConnectionFactory] Connector bisocket://localhost:4457 has leasing enabled, lease period 10000 milliseconds
18:22:04,747 INFO  [ConnectionFactory] org.jboss.jms.server.connectionfactory.ConnectionFactory@5ac953 started
18:22:04,750 INFO  [ConnectionFactory] Connector bisocket://localhost:4457 has leasing enabled, lease period 10000 milliseconds
18:22:04,750 INFO  [ConnectionFactory] org.jboss.jms.server.connectionfactory.ConnectionFactory@e8fa3a started
18:22:05,050 INFO  [ConnectionFactoryBindingService] Bound ConnectionManager 'jboss.jca:service=ConnectionFactoryBinding,name=JmsXA' to JNDI name 'java:JmsXA'
18:22:05,073 INFO  [TomcatDeployment] deploy, ctxPath=/
18:22:05,178 INFO  [TomcatDeployment] deploy, ctxPath=/jmx-console
18:22:05,290 ERROR [ProfileServiceBootstrap] Failed to load profile: Summary of incomplete deployments (SEE PREVIOUS ERRORS FOR DETAILS):

DEPLOYMENTS IN ERROR:
  Deployment "vfsfile:/Applications/jboss-5.0.1.GA/server/default/deploy/TwitterEAR.ear/" is in error due to the following reason(s): java.util.zip.ZipException: error in opening zip file

18:22:05,301 INFO  [Http11Protocol] Starting Coyote HTTP/1.1 on http-localhost%2F127.0.0.1-8080
18:22:05,364 INFO  [AjpProtocol] Starting Coyote AJP/1.3 on ajp-localhost%2F127.0.0.1-8009
18:22:05,373 INFO  [ServerImpl] JBoss (Microcontainer) [5.0.1.GA (build: SVNTag=JBoss_5_0_1_GA date=200902231221)] Started in 43s:467ms 
```

提到的 ear 和 war 文件都在 deploy 目录中。

有人有提示吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2010-05-12T17:20:59.747

问题很可能是 ZIP 文件的低级格式，可能是 JBoss 尝试部署部分上传的存档的结果，

```
Caused by: java.util.zip.ZipException: error in opening zip file
    at java.util.zip.ZipFile.open(Native Method)
    at java.util.zip.ZipFile.<init>(ZipFile.java:203)
    at java.util.zip.ZipFile.<init>(ZipFile.java:234 
```

如果您通过慢速链接上传到服务器，请尝试将存档上传到 JBoss 不监视的目录，然后将存档移动到部署目录。移动将是原子操作，或者至少比上传快很多。

我通过 rsync'ing 到 ~/deployment-unit/ 来部署档案，然后在 ssh 上运行一个远程脚本，最后进入 JBoss 的部署目录。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-30T09:27:15.040

我在 FTP 传输传输模式设置为 ASCII 而不是二进制的文件时看到了这一点。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2010-07-14T21:06:19.523

我得到了一个非常相似的错误，这是由于达到了最大打开文件的数量。我在 ulimit -n 8192 之后启动了应用程序，它能够“解压缩”文件。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2010-12-14T18:04:12.883

我在使用复制任务通过 ANT 部署的“大”EAR 时遇到了同样的问题。似乎 JBoss 试图在它被完全复制之前解压缩它。我使用移动任务而不是副本解决了 pb（注意移动的源文件夹在同一个磁盘分区上）

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-05-26T16:06:20.010

我通过使用与编译/构建 EAR 相同的 JDK 运行服务器解决了这个问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-02T15:11:10.743

好的，我终于找到了解决我的问题的方法。Eclipse 中似乎存在一个错误，它阻止了 .settings/org.eclipse.wst.common.component 文件的创建。在项目属性中设置 EJB3 和 Java6 方面时，应创建此文件。

这是一个 org.eclipse.wst.common.component 示例文件：

```
<?xml version="1.0" encoding="UTF-8"?>
<project-modules id="moduleCoreId" project-version="1.5.0">
    <wb-module deploy-name="project_name">
        <wb-resource deploy-path="/" source-path="/src/main/java"/>
        <wb-resource deploy-path="/" source-path="/src/main/resources"/>
        <wb-resource deploy-path="/" source-path="/src/test/java"/>
        <wb-resource deploy-path="/" source-path="/src/test/resources"/>
        <property name="java-output-path"/>
    </wb-module>
</project-modules> 
```

必须定义部署路径才能创建服务器在部署时使用的 EJB Jar 文件。创建后，Jboss 会正确发布 EJB 模块。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-24T00:29:49.303

有时，由于 jar/ear 的编译版本与服务器上的 jdk 不同，会显示此错误。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2010-12-07T06:21:45.523

`web.xml`我在下面添加了下面提到的代码，`yourServletName`错误被删除了

```
<servlet-name>youServletName</servlet-name>
<servlet-class>org.springframework.web.servlet.DispatcherServlet</servlet-class>
 **<init-param>
  <param-name>contextClass</param-name>
  <param-value>org.jboss.spring.vfs.context.VFSXmlWebApplicationContext</param-value>
</init-param> 
<load-on-startup>2</load-on-startup>**
</servlet> 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-07-10T06:58:07.100

我在使用 JBoss 5.1.0.GA 和 Seam 2.1.1.GA 时遇到了同样的问题。Eclipse 3.5 和 JBoss 的 JDK 都是 java jdk1.6.0._07。

我能够解决这个问题。也许问题的根源与您的具体案例有关，也可能与您无关，但无论如何，我认为它可能会有所帮助。

我正在使用 Seam 安装示例中包含的构建文件创建应用程序 EAR 文件；我的构建文件是预订示例附带的一个修改版本。此示例构建文件包含对所有示例通用的构建文件。它提供了很多功能，您可以利用这些功能来创建您的分发文件。

常见的构建示例提供了几个文件集和路径条目，您可以覆盖这些条目以包含项目独有的库。

具体来说，我覆盖了“build.classpath.extras”和“ear.lib.extras”。

我想在 EJB jar 文件中包含一个确定的库，该文件被打包到 EAR 文件中（我的模型和动作类所在的 jar 文件）；所以我只是在我的构建文件中覆盖了“jar.extras”。

当时就是我遇到这个问题的时候。尽管根目录中我想要的库已复制到 EJB jar 文件的根文件夹中，但显然没有问题，JBoss 正在删除此错误消息。

所以我只是停止使用“jar.extras”，并将对所需库的引用移动到“build.classpath.extras”：此操作的效果是该库已复制到 EAR 文件的 \lib 文件夹. 现在该应用程序似乎运行良好，并且问题消失了。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2010-02-03T23:48:08.467

我遇到了同样的问题，我的解决方案/问题是我将导致问题的 jar 添加为我的 EJB 中的 EE 依赖项。jar 包含在 EAR 文件中，但不在 org.eclipse.wst.common.component 对应文件中。我在EAR文件中添加了依赖，我的问题就解决了（至少我认为，我用eclipse做了这个之后有问题，但是当我解决它时，发布很顺利）。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-14T18:08:12.783

你能在 JBoss 之外打开 ear 文件吗（使用 WinZip 或 WinRAR）？可能是 zip 文件已损坏。

您可以尝试使用 java.util.zip.ZipFile.open() 编写一个小测试程序，看看是否可以在更孤立的情况下调试它。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-31T05:40:21.690

我也有这个，但是当我将 maven-war-plugin 和 maven-ejb-plugin 添加到我的项目中时，一切都会再次运行......

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-05-12T16:11:09.903

我在我的 Mac 上遇到了同样的问题。我的 windows 开发机器（工作中的客户端：-/）运行 GateIN 和 eclipse 太慢，所以我在我的 Macbooc Pro 上安装了 GateIN，并让 eclipse 在构建时将耳朵复制到它。我在控制台上看到：zip 中的异常。

所以我决定调查是否可以使用 Stufit Manager 打开存档。我打开它的那一刻，显然文件以某种方式被“触摸”了，GateIN 扫描仪检测到更改立即重新部署，这次没有错误。所以我猜想在耳朵完全复制之前尝试重新部署 Mac 实在是太快了......如果你有问题，只需使用 touch 命令......

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-08-12T14:30:06.387

我们通过从 jdk1.6.0._06 更新到 jdk1.6.0._26 解决了这个问题。jar 包含 _26 并在 JBoss 6.0 中很好地部署在那里。但是，我们的客户无法使用 _06 进行部署。希望有帮助！

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-06-27T16:30:27.383

我有问题，但这是因为它们是 webapp 中的 zip 文件。当 Eclipse 尝试将 webapp 部署到 dev Tomcat 服务器时，它正在尝试解压缩 zip 文件。是的，我继承了这个 webapp。现在我将尝试将其添加到过滤器中以防止这种情况发生，祝我好运。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2011-03-31T17:36:56.453

有用的 [http://community.jboss.org/message/205738](http://community.jboss.org/message/205738)

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-03-15T00:24:36.170

这可能是权限问题吗？我看到你在 Mac OS 下运行。当您成功打开 EAR 文件时，您以什么用户身份运行？当您运行 JBoss 时，它以什么用户身份运行？它对文件有读取权限吗？

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2013-05-31T09:50:29.663

有同样的问题，使用 JBoss 4.4.2 并使用 maven-war-plugin 构建我的应用程序（将 JBoss 部署目录指定为 outputDirectory）。似乎 JBoss 试图重新加载部分复制的战争，因为它的 ScannerThread 在 maven 仍在构建战争时激活。我部分解决了将扫描时间从 5000 毫秒（默认值）增加到 15 秒的问题。这并不能解决问题，但至少它发生的频率较低！

```
 <!-- Frequency in milliseconds to rescan the URLs for changes -->
  <attribute name="ScanPeriod">15000</attribute> 
```

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2009-03-31T14:14:38.273

尝试从 Eclipse 更新安装 Web 工具平台（WTP）...我听说有某种错误，您需要 3.0.4 版本。我找不到链接，对不起...希望这会有所帮助！

* * *

## 回答 #20

> 赞同：0
> 
> 时间：2009-03-31T15:07:48.677

我刚刚发现，如果您不在 maven-war-plugin 中指定版本号，它将使用某种 alpha 版本。给它版本号 2.0，对我来说有效。

* * *

## 回答 #21

> 赞同：0
> 
> 时间：2009-10-31T13:59:57.643

好吧，我三天都面临同样的问题..查看您的类路径以查找具有 .rar 扩展名的文件或其他类型的文件，就我而言，我从类路径中删除了一个 .rar 文件，一切都很好。

* * *

## 回答 #22

> 赞同：0
> 
> 时间：2010-06-10T01:07:31.070

我见过嵌套的罐子也这样做（另一个罐子里的罐子，或一个空罐子）。就我而言，它是一个 microsoft sql jdbc 驱动程序 jar。通过查看堆栈跟踪，OP 似乎是 TwitterPoCEJB.jar。

但是，有很多事情会导致这种情况，如前所述，只是一个坏的拉链等。

如果是嵌套 jar 问题，你可以告诉 VFS 哪些位置包含嵌套 jar，尽管默认情况下 ./deploy 目录就是其中之一，所以里面的任何东西都应该没问题（除非你有一个 jboss-{something }.xml 明确地配置其他东西）。

* * *

## 回答 #23

> 赞同：0
> 
> 时间：2013-09-03T07:21:33.350

可能是你的 web.xml 文件问题，我也面临同样的问题，经过很多不同的尝试，我正打算继续讨论另一篇关于 web.xml 和 web-app 3.0 的文章。这让我开始思考，我检查了我的 web.xml。果然，下面一行就在顶部。

```
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd" id="WebApp_ID" version="3.0"> 
```

我改用 2.5 web-app 规范。WAR 和 EAR 都不会部署。

```
<web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns="http://java.sun.com/xml/ns/javaee" xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd" id="WebApp_ID" version="2.5"> 
```

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2019-10-31T13:42:44.897

我在部署战争时遇到了同样的错误，对我来说，这是一个与使用 tar 中的“z”选项提取野蝇档案有关的问题，我输入了

```
 tar -xvzf wildfly_v_.tar.gz 
```

然后我删除并重新安装了所有但这次

```
 tar -xvf wildfly_v_.tar.gz 
```

配置后我部署并且问题消失了 - 我认为这是与 gzip 相关的问题

* * *

## 回答 #25

> 赞同：-1
> 
> 时间：2011-08-18T21:54:17.817

我遇到了这个确切的问题，发现 WEB-INF/lib 目录中有损坏/空的 jar 文件。一旦我用一个好的副本替换了每个，部署就顺利进行了。

# sql - 是否可以在 sql From 子句中使用 Case 语句

> ID：646334
> 
> 赞同：27
> 
> 时间：2009-03-14T17:36:12.500
> 
> 标签：sql, sql-server, sql-server-2005

是否可以在使用 SQL 2005 的 sql From 子句中使用 Case 语句？例如，我正在尝试类似：

```
SELECT Md5 FROM 
CASE
    WHEN @ClientType = 'Employee' THEN @Source = 'HR'
    WHEN @ClientType = 'Member' THEN  @Source = 'Other'
END CASE 
WHERE Current = 2; 
```

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-14T17:54:21.800

我不相信这是可能的。一方面，查询优化器假定 FROM 子句中有一个特定的类似表的列表。

我能想到的最简单的解决方法是两个表之间的 UNION：

```
SELECT  md5
FROM    hr
WHERE   @clienttype = 'Employee'
AND     current = 2
UNION
SELECT  md5
FROM    other
WHERE   @clienttype = 'Member'
AND     current = 2; 
```

给定@clienttype 谓词，只有一半的 UNION 可能是 True。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-14T17:42:29.473

假设 SQL Server：

您将需要使用动态 SQL。构建字符串，然后使用该字符串调用 sp_executesql。

编辑：更好的是，只需使用 if 语句来执行适当的语句并将值分配给变量。如果可能，您应该避免使用动态 SQL。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-14T17:54:51.253

不，您不能使用 CASE 语句选择要查询的表。CASE 语句只能在表达式中使用，例如对于列的值或作为 WHERE 表达式的一部分。

如果您只寻找一个值，应该这样做：

```
IF @ClientType = 'Employee' BEGIN
    SET @Source = (SELECT Md5 FROM HR WHERE Current = 2)
END
ELSE IF @ClientType = 'Member' BEGIN
    SET @Source = (SELECT Md5 FROM Other WHERE Current = 2)
END 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T17:39:38.670

由于您没有指定要针对的 SQL 后端，因此很难正确回答....

据我所知，您既不能针对 MS SQL Server 也不能针对 Interbase/Firebird 执行此操作。不过，我不能代表其他后端服务器...

马克

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-14T17:41:12.143

我认为可以肯定地说答案是不可能的。这与 SQL 方言无关。

# html - HTML 按钮样式

> ID：646338
> 
> 赞同：1
> 
> 时间：2009-03-14T17:38:26.817
> 
> 标签：html, css

我怎样才能让按钮看起来像此页面上的“检查”按钮[http://www.intus.co.za/](http://www.intus.co.za/)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-14T17:40:18.403

HTML：

```
<input class="field" type="submit" style="margin-right: 10px;" value="Check It"/> 
```

CSS：

```
.field {
border:1px solid #000000;
font-family:Arial,Helvetica,sans-serif;
font-size:11px;
} 
```

我使用 Firebug（一个 Firefox 插件）得到了这个。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T17:41:07.480

如果您要做这么多，请获取 Firebug，然后简单地检查您喜欢的元素。表明：

```
<input class="field" type="submit" onclick="javascript:popup();return false;" style="margin-right: 10px;" value="Check It"/>

.field {
  border:1px solid #000000;
  font-family:Arial,Helvetica,sans-serif;
  font-size:11px;
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-14T17:41:12.597

您想尝试在网络上复制的任何内容都应该使用 Firebug 进行检查：http: [//getfirebug.com](http://getfirebug.com)

您可以看到您需要的 HTML 和 CSS（以及 JavaScript）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-14T17:45:04.677

[我在Firebug](https://addons.mozilla.org/firefox/addon/1843)中使用了元素检查器，它为按钮显示了这个。

```
element.style {
margin-right:10px;
}

.field {
border:1px solid #000000;
font-family:Arial,Helvetica,sans-serif;
font-size:11px;
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-14T17:39:46.360

style="border: 1px #000 实心"

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-14T17:52:12.307

...或者，如果您使用 IE，则有[IE Developer Toolbar](http://www.microsoft.com/en-us/download/details.aspx?id=18359)。

# c# - 分层架构中的实体框架？

> ID：646358
> 
> 赞同：4
> 
> 时间：2009-03-14T17:44:24.570
> 
> 标签：c#, .net, wcf, entity-framework

围绕 WCF 和实体框架做一些实验。几个问题。

**选项1：**

我知道实体框架类可以直接通过 WCF 序列化，从 sp1 开始。但是，我想知道延迟加载、急切加载、上下文管理等场景是如何处理的，如果它们被处理了吗？

**选项 2：**

另一种选择可能是使用 EFPocoAdapter，在实体框架之上有一个普通的 POCO 包装器，而不是直接公开实体框架类。[http://code.msdn.microsoft.com/EFPocoAdapter](http://code.msdn.microsoft.com/EFPocoAdapter)。有人用过这个吗？在这个方向上有什么想法吗？

**其他想法：**

关于 ADO.NET 数据服务 - 据我了解，ADO.NET 数据服务无法通过远程处理（nettcp 绑定）进行配置？它仅支持基于 http 的访问。我们都知道二进制序列化比较慢。

任何指针或任何其他选项？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-15T16:33:42.937

我已经对此进行了一些挖掘，这是我对此的发现。

**ADO.NET 数据服务：**

您可以使用 ADO.NET 数据服务（您需要 SP1）通过网络公开您的实体框架，代码几乎为零。但据我了解，唯一的限制是，事务是通过 HTTP 进行的。这意味着，在序列化方面有一个小的开销（我们都知道二进制序列化更快），但优势是我们服务的实现速度。

我从 John [ [http://twitter.com/John_Papa]](http://twitter.com/John_Papa])那里得到了一个非官方的消息 ——“wcf 绝对有更多的选择。在大多数情况下也有更多的工作。Astoria 很容易暴露实体。在大多数情况下，性能差异可以忽略不计”

优点 - 您根本不需要编写任何服务 - 您只需围绕数据服务和实体框架挂钩验证和安全逻辑，我们就完成了。如果您通过 http 使用以数据为中心的服务是理想的 - 在诸如拥有 silverlight 客户端或通过 http 的 winform/wpf 前端等场景中。

**通过 WCF 公开实体框架：**

在 SP1 中，很多支持在分层架构中使用实体框架。这包括对预先加载和上下文管理的支持。当然，在这种情况下，我们需要编写服务（以及方法背后的逻辑）。或者，如果我们拥有与数据库完全一致的实体框架模型，我们可以生成大部分服务，其中包括我们需要的方法。

建议您阅读此[http://msdn.microsoft.com/en-us/magazine/cc700340.aspx](http://msdn.microsoft.com/en-us/magazine/cc700340.aspx)

另一种选择可能是使用 EFPocoAdapter，在 dtos 的实体框架之上有一个普通的 POCO 包装器，而不是直接公开实体框架类。现在它是实体框架 [http://code.msdn.microsoft.com/EFPocoAdapter](http://code.msdn.microsoft.com/EFPocoAdapter)的下一个版本的指南针项目。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T19:19:29.227

通过 WCF 公开 EF 类是一个非常糟糕的主意。微软犯了一些严重的错误，使这种情况无法成为有用的场景。他们将实体公开为数据合同，还公开了实体的基类，并且对于反向链接，公开了链接的两个副本。

另一方面，ADO.NET 数据服务似乎有一些魔力，可以让类似的东西发挥作用。阅读本月 MSDN 杂志中的 SilverLight 文章，了解从客户端使用 ADO.NET 数据服务的示例。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-06T23:23:58.150

不是要提出旧帖子，而是......我在处理完全相同的问题时发现了这个清单。我们有 WCF 服务和实体框架域模型。最后，我最终根据 Danny Simmons 的工作制作了一个 T4，它采用 EDMX 并构建 POCO 消息类以及映射 entity.ToMessage() 和 message.ToEntity(objectcontext) 的扩展方法。

这似乎是 .NET 4.0 之前最好的中间方法，因为它不需要额外的外部项目依赖项或像我发现的其他方法（基于 PostSharp）那样跳过的箍。

如果其他人认为这种方法会有所帮助，请告诉我，我将在我们的 googlecode 网站上发布指向 TT 文件的链接。

# c# - 如何从asp中的查询字符串中获取数据？

> ID：646365
> 
> 赞同：4
> 
> 时间：2009-03-14T17:49:23.107
> 
> 标签：c#, asp.net, query-string

我正在开发一个 IT 类项目，我需要在 php 页面中的查询字符串中传递一个值，并将其读入 ASP 页面上的隐藏字段。

我目前正在将参数很好地从 php 页面传递给 ASP，但总的来说，我对 .NET 还是很陌生。如何将数据从字符串中取出并放入 C# 中的变量中？例如，如果 url 是**`blah.com/upload?username=washington`**，我将如何获得“washington”并将其保存到隐藏字段中？万分感谢。

杰加森

编辑

我知道这很容易。万分感谢。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-14T17:53:13.537

看来你只是想要：

```
string username = Request.QueryString["username"]; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-14T17:56:23.747

您可以在您的 aspx 文件中添加一个隐藏字段：

```
<asp:HiddenField ID="username" runat="server" /> 
```

并在您后面的代码中从请求参数中填充它：

```
protected void Page_Load(object sender, EventArgs e)
{
    if (!IsPostBack)
    {
        username.Value = Request["username"];
    }
} 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-14T18:20:18.867

**这从表单**元素返回值：

```
string username = Request.Form["username"]; 
```

**这从查询字符串**返回值：

```
string username = Request.QueryString["username"]; 
```

这看起来**既是**表单又是查询字符串集合：

```
string username = Request["username"]; 
```

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2011-07-25T11:59:09.750

```
if session ("blnIsuSERGOOD") = False or  is null (session ("blnISuSERGoo")) = True then
Response.Redirect.Querystring("name") 
```

# asp.net - 如何在 ASP.NET 中通过 LAN 访问您的网站

> ID：646370
> 
> 赞同：39
> 
> 时间：2009-03-14T17:52:37.327
> 
> 标签：asp.net, asp.net-2.0

我有一个 asp.net 网页应用程序，我希望使用局域网 (LAN) 或无线局域网 (WLAN) 访问它。

我不知道从哪里开始。为了让其他人访问我的网页，我会配置一些东西吗？

非常感谢您的回答，非常感谢.. (^_^)...

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-03-14T18:00:37.357

我不确定你有多难：

**您必须有一个 Web 服务器**（Windows 自带一个称为 IIS，但它可能没有安装）

1.  确保您确实安装了 IIS！尝试`http://localhost/`在浏览器中输入，看看会发生什么。如果没有任何反应，则意味着您**可能**没有安装 IIS。请参阅[安装 IIS](https://msdn.microsoft.com/en-GB/library/ms181052(v=vs.80).aspx)
2.  设置 IIS[如何设置您的第一个 IIS 网站](http://support.microsoft.com/kb/323972)
3.  您甚至可能需要[安装 .NET Framework](http://www.microsoft.com/downloads/details.aspx?familyid=0856eacb-4362-4b0d-8edd-aab15c5e04f5&displaylang=en)（或者您的服务器将只提供静态 html 页面，而不提供 asp.net 页面）

**安装您的应用程序**

完成此操作后，您可以或多或少地将您的应用程序复制到`C:\inetpub\wwwroot`. 阅读[安装 ASP.NET 应用程序 (IIS 6.0)](http://www.microsoft.com/technet/prodtechnol/WindowsServer2003/Library/IIS/fd7236aa-f429-4139-adc2-6834595d051f.mspx?mfr=true)了解更多信息

**从另一台机器访问网站**

理论上，一旦您运行了 Web 服务器并安装了应用程序，您只需要`IP address`Web 服务器的 即可访问该应用程序。

要查找您的 IP 地址，请尝试： `Start`-> `Run`-> type `cmd`(hit `ENTER`) -> type `ipconfig`(hit `ENTER` )

一次

*   你有IP地址并且
*   IIS 运行和
*   应用程序已安装

您只需输入您的网络服务器的 IP 地址和应用程序的正确路径，即可从 LAN 中的另一台计算机访问您的网站。

如果您将应用程序放在名为 的目录中`NewApp`，则需要键入类似的内容`http://your_ip_address/NewApp/default.aspx`

**关闭防火墙**

如果您在第一次尝试连接时确实有防火墙将其关闭，您可以稍后对其进行排序。

* * *

## 回答 #2

> 赞同：31
> 
> 时间：2012-10-10T13:49:09.477

您可能还需要启用万维网服务入站防火墙规则。

在 Windows 7 上：开始 -> 控制面板 -> Windows 防火墙 -> 高级设置 -> 入站规则

在列表中查找`World Wide Web Services (HTTP Traffic-In)`并选择启用规则。变化几乎是立竿见影的。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-14T18:08:45.400

您需要配置 IIS（假设这是您正在/将要使用的 Web 服务器），允许从 WLAN/LAN 访问特定用户（或匿名用户）。如果您有防火墙，请允许 IIS 通过您的防火墙。

您的应用程序不需要更改，这只是网络问题和配置，您必须面对仅允许通过 LAN 和 WLAN 访问的配置。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2012-01-19T06:50:02.237

如果您通过 Visual Studio 而不是内置的 ASP.net 主机使用[IIS Express ，则可以实现此目的。](http://www.microsoft.com/download/en/details.aspx?id=1038)

[将 IIS Express 绑定到 IP 地址](https://stackoverflow.com/questions/4866547/binding-iis-express-to-an-ip-address)

# ruby - Ruby 符号是如何工作的？

> ID：646371
> 
> 赞同：3
> 
> 时间：2009-03-14T17:52:50.853
> 
> 标签：ruby, symbols

我读到 Ruby 有一种名为“标签”的语言，它是如何工作的？

更新：

我在[http://ruby.about.com/od/gems/qt/shorturl.htm](http://ruby.about.com/od/gems/qt/shorturl.htm)看到了它，作者在文章底部谈到了一个标签：

`puts ShortURL.shorten('http://ruby.about.com', :lns)`

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-03-14T18:28:13.077

认为作者的意思是说**符号**。[您可以在此处](http://glu.ttono.us/articles/2005/08/19/understanding-ruby-symbols)阅读有关它们的信息，以及[文档](http://www.ruby-doc.org/core-2.0/Symbol.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T18:10:49.077

我刚刚查阅了我的“ [Pickaxe](http://www.pragprog.com/titles/ruby/programming-ruby) ”书，并没有这样的功能。能不能换个名字？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T18:12:53.927

Rails 框架有**标签**，但这些只是 HTML*标签*标签的助手。

# php - SourceGuardian 错误

> ID：646374
> 
> 赞同：1
> 
> 时间：2009-03-14T17:54:38.617
> 
> 标签：php, http, encoding

**错误打印到屏幕：**

> 致命错误：SourceGuardian Loader - 脚本校验和错误 [12] 在第 2 行的 /home/user/public_html/domain_com/includes_encoded/params.php 中修改了编码脚本

**事实：**

使用已经安装了 SourceGuardian 加载器的 Hostgator 主机，phpinfo 还确认它们已加载。

使用 SourceGuardian 的演示版。

问题：

*   我需要上传一些许可证密钥文件吗？
*   是否有任何特殊标签可以将编码文件包含到页面中？
*   我如何解决它？

我通过 PDF 和在线阅读了所有文档。不知道我的问题出在哪里。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-24T02:49:01.067

这个问题是因为演示版使用了演示加载器，而不是主机使用的完整加载器。

# java - 使用 JDK LDAP 库，如何添加多个描述？

> ID：646376
> 
> 赞同：-1
> 
> 时间：2009-03-14T17:55:21.283
> 
> 标签：java, ldap

我可以使用我的 IDE 添加两个描述（属性），但在 Java 中我只能添加一个描述。如何添加第二个？

我正在使用 JDK LDAP 库。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-14T18:38:23.990

经过一些尝试，我自己能够做到

```
 Attributes attrs = new BasicAttributes(true);
BasicAttribute b = new BasicAttribute("description");
b.add("a");
b.add("b");
attrs.put(b); 
```

# c# - 如果类型在运行时之前未知，您可以在 C# 中使用泛型方法吗？

> ID：646377
> 
> 赞同：18
> 
> 时间：2009-03-14T17:56:15.337
> 
> 标签：c#, generics, types

解释我的意思的最简单方法是使用代码示例。这不会编译，但是有什么办法可以达到这种效果：

```
foreach(Type someType in listOfTypes)
{
    SomeMethod<someType>();
} 
```

如果这可行，那将非常方便，但事实并非如此。是否有另一种方法可以实现与上述相同的事情，为什么 C# 不允许将其作为法律声明？

编辑：似乎唯一的方法是通过反射，这对于我们的需求来说可能太慢了。关于为什么没有内置有效方法以及类似的东西是否适用于 C# 4.0 的任何见解？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-14T17:59:57.997

您可以使用反射。假设当前对象包含该`SomeMethod()`方法，执行此操作的代码如下所示：

```
GetType().GetMethod("SomeMethod").
    MakeGenericMethod(new Type[] { someType }).Invoke(this, null); 
```

请注意，如果`SomeMethod()`是非公开的，您的代码可能无法在信任度较低的环境中执行。

* * *

## 回答 #2

> 赞同：23
> 
> 时间：2009-03-14T18:11:45.753

> 为什么 C# 不允许将其作为法律声明？

正如其他人所指出的，您不能这样做。为什么不？好吧，考虑你的例子：

```
foreach(Type someType in listOfTypes)
{
    SomeMethod<someType>();
} 
```

请注意，类型列表中的每个类型在*运行时*才能知道，而类型参数`SomeMethod`必须在*编译时*知道。编译器不可能告诉你将调用解析到*哪个，所以这是非法的。* `SomeMethod<T>`

在 C# 4 中，通过将 DLR 包含到 CLR 中，这和许多其他类似的事情将成为可能。特别是，动态方法调用将使您能够调用在编译时可能不知道的方法。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-14T17:59:29.573

今天做到这一点的唯一方法是通过反思。请参阅[MethodInfo.MakeGenericMethod(Type[])](http://msdn.microsoft.com/en-us/library/system.reflection.methodinfo.makegenericmethod.aspx)。

# qt - 对于在 windows 和 linux 上运行的应用程序，我需要为 qt 安装哪个平台

> ID：646381
> 
> 赞同：0
> 
> 时间：2009-03-14T17:57:57.127
> 
> 标签：qt

我是qt的新手。我不确定我应该下载和安装什么安装。

我想开发在 Windows 和 Linux x86 上运行的桌面应用程序。

我是否必须在 Windows 上下载并安装才能在 Windows 上运行我的应用程序。并且还下载另一个安装并安装在我的 Ubuntu 上以在 Linux 上运行我的应用程序？

或者我可以在 Ubuntu 上安装并编译我的应用程序以在 Windows 和 Linux 上运行吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T18:36:18.020

理论上可以交叉编译代码，但如果你只是在目标平台上编译它，生活会容易得多。（这意味着一次用于 Windows，一次用于 linux。）

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T18:14:24.593

大部分源代码将保持不变。由于这两个操作系统使用不同的二进制格式，因此您必须在适当的平台上分别为 Windows 和 Linux 编译源代码。另外，请注意，您需要适当的 Qt dll/共享库才能在给定的操作系统上运行。

# ruby-on-rails - Ruby on Rails 单表继承 (STI) 和单元测试问题（使用 PostgreSQL）

> ID：646391
> 
> 赞同：5
> 
> 时间：2009-03-14T18:05:06.563
> 
> 标签：ruby-on-rails, ruby, unit-testing, postgresql, single-table-inheritance

我正在使用带有单个“帐户”表的 STI 模型来保存用户和技术人员的信息（即用户 < 帐户，技术人员 < 帐户）。从功能的角度来看，一切都有效，但是在运行单元测试时事情会爆炸：

... 8）错误：test_the_truth（UserTest）：ActiveRecord::StatementInvalid：PGError：错误：关系“技术人员”不存在：从“技术人员”中删除......

本质上，标准框架不承认 Technicians 和 Users 表（或 PostgreSQL 称之为“关系”）不存在，事实上，应该将其别名为 Accounts。

有任何想法吗？我对 RoR 比较陌生，我不知道如何解决这个问题而不把 STI 一起撕掉。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-15T01:14:45.267

原来，问题是由于存在：

./test/fixtures/technicians.yml ./test/fixtures/users.yml

这是有道理的，因为框架希望能够将数据插入到类似命名的表中。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2010-04-26T15:54:12.273

我有一个类似的问题，通过删除子模型的 YAML 文件得到了解决。本质上，rails 正在查看 /test/fixtures/ 中创建的夹具，并尝试清空每个表，以便它可以为您重新加载它们。

在我的例子中，我运行了脚本/生成模型命令，它会自动创建一个新的夹具。然后我将模型更改为从正确的父类继承。好吧，由于夹具仍然存在，rails 试图在加载夹具之前从子项中删除。

如果您确实需要预加载数据，您应该使用父模型夹具并将类型字段设置为正确的模型名称。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T18:56:32.603

*   您是否确保您的帐户表包含“类型”列？您需要一个才能使 STI 发挥作用。
*   实际上，我在一个名为“type”的列上遇到了一些数据库兼容性问题，偶尔会切换到“kind”来缓解这种情况。这可能是问题所在；尝试在基类（帐户）中设置 self.inheritance_column = "kind" 看看是否有帮助。

# c++ - 如何为键类型和映射执行通用打印

> ID：646392
> 
> 赞同：2
> 
> 时间：2009-03-14T18:05:29.107
> 
> 标签：c++, map, printing

关于这个问题[StackoVerflow 529831](https://stackoverflow.com/questions/529831/returning-the-greatest-key-strictly-less-than-the-given-key-in-a-c-map)，这是建议的方法之一

```
template<typename Map> typename Map::const_iterator 
greatest_less(Map const& m, typename Map::key_type const& k) {
    //How to print K and Map m
    typename Map::const_iterator it = m.lower_bound(k);
    if(it != m.begin()) {
      return --it;
    }
    return m.end();
} 
```

我会对打印键 K 和 Map m 感兴趣，该怎么做。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-14T18:08:08.600

使用`<<`运算符，确保为您的类型和类型`<<`都定义了它（您将知道是否不是这种情况，因为代码不会编译。）`Map::key_type``Map::data_type`

```
cout << k << endl;
for (typename Map::const_iterator it = m.begin(); it != m.end(); ++i) {
  cout << it->first << " -> " << it->second << endl;
} 
```

例如，如果你`Map::data_type`是一个`struct fraction`与成员`float numerator`和`float denominator`，

```
ostream& operator<<(ostream& os, const fraction& obj) {
   return os << obj.numerator << '/' << obj.denominator;
} 
```

# c# - 如何在自己的客户端-服务器应用程序中使用 System.IdentityModel

> ID：646395
> 
> 赞同：13
> 
> 时间：2009-03-14T18:08:01.237
> 
> 标签：c#, wcf-security, .net-3.0

我有一个基于 TcpClient/TcpListener 和 SslStream 的简单客户端-服务器应用程序。客户端可以使用 X509Certificate 或在 SslStream 建立后发送用户名和密码来向服务器验证自己的身份。

WCF 使用**System.IdentityModel**命名空间进行身份验证，但[显然](http://www.leastprivilege.com/CommentView.aspx?guid=85585fae-f04f-4de9-8207-631a0b228b06)可以在任意应用程序中使用——这听起来很有趣。不过，关于如何做到这一点的信息很少（或者我的 Google foo 今天很弱）。

所以，我的问题是：**我需要做什么才能将 System.IdentityModel 与我的应用程序集成？**我不确定我是否需要所有 ClaimSet 的东西，但如果用户可以只使用他们的 Windows 帐户或任何其他提供的身份验证机制登录，那就太好了。（不幸的是，我不能只切换到 WCF，而是必须使用自定义协议，但如果需要，我可以对其进行一些更改。）

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-14T22:14:39.040

我的 Google foo 确实很弱。答案就在我问题的链接后面。所以这里有几个链接到[这个博客](http://leastprivilege.com/category/identitymodel/)，以防有人最终有同样的问题。

首先，您应该尝试理解“声明集的东西”：

*   [索赔](http://leastprivilege.com/2008/02/19/using-identitymodel-claims/)
*   [索赔集](http://leastprivilege.com/2008/02/23/using-identitymodel-claim-sets/)
*   [检查声明集](http://leastprivilege.com/2008/02/23/using-identitymodel-inspecting-claim-sets/)
*   [Windows 和 X509Certificate 声明集](http://leastprivilege.com/2008/02/24/using-identitymodel-windows-and-x509certificate-claim-sets/)
*   [声明集的典型操作](http://leastprivilege.com/2008/02/24/using-identitymodel-typical-operations-on-claim-sets/)

然后，您需要知道声明集的来源：

*   [授权策略、上下文和声明转换](http://leastprivilege.com/2008/02/29/using-identitymodel-authorization-policies-context-and-claims-transformation/)
*   [WCF 中的声明转换](http://leastprivilege.com/2008/03/04/using-identitymodel-claims-transformation-in-wcf/)
*   [WCF 之外的授权上下文和声明转换](http://leastprivilege.com/2008/03/04/using-identitymodel-authorization-context-and-claims-transformation-outside-of-wcf/)

有了这些知识，它实际上变得非常简单。

如果我理解正确，基本工作流程将是这样的：

1.  客户`SecurityToken`使用 a创建一个`SecurityTokenProvider`
2.  客户端序列化`SecurityToken`使用`SecurityTokenSerializer`
3.  服务器反序列化`SecurityToken`使用`SecurityTokenSerializer`
4.  服务器`IAuthorizationPolicy`使用 a 创建 s`SecurityTokenAuthenticator`
5.  服务器`AuthorizationContext`从`IAuthorizationPolicy`s创建
6.  完毕

例子：

```
// Create the SecurityTokenProvider
var p = new UserNameSecurityTokenProvider("username", "password");

// Get the SecurityToken from the SecurityTokenProvider
var t = p.GetToken(TimeSpan.FromSeconds(1.0)) as UserNameSecurityToken;

// ... transmit SecurityToken to server ...

// Create the SecurityTokenAuthenticator
var a = new CustomUserNameSecurityTokenAuthenticator(
    UserNamePasswordValidator.None);

// Create IAuthorizationPolicies from SecurityToken
var i = a.ValidateToken(t);

// Create AuthorizationContext from IAuthorizationPolicies
var c = AuthorizationContext.CreateDefaultAuthorizationContext(i);
ShowClaims(c.ClaimSets); 
```

对于`X509SecurityToken`s 使用`X509SecurityTokenProvider`/ `Authenticator`。对于`WindowsSecurityToken`s 有一个`WindowsSecurityTokenAuthenticator`但没有一个提供者；相反，使用`WindowsSecurityToken`构造函数：

```
var t = new WindowsSecurityToken(WindowsIdentity.GetCurrent()); 
```

这工作得很好。到目前为止，我唯一省略的是令牌序列化。有一个`SecurityTokenSerializer`类在.NET 框架中有一个实现：`WSSecurityTokenSerializer`WCF 附带的类。

序列化`UserNameSecurityToken`s 和`X509SecurityToken`s 就像一个魅力（没有尝试过反序列化），但`WindowsSecurityToken`序列化程序显然不支持 s 。这给我留下了我已经拥有的两种身份验证方法（证书和用户名/密码），因为`AuthorizationContext`无论如何我都不想要那样，我会坚持我所拥有的:)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2013-02-07T10:01:10.910

我没有对现有解决方案发表评论的声誉，但我想将新 URL 发布到解决方案中列出的博客，因为这些不再有效。如果有人可以将其更改为评论，我将不胜感激。

*   [索赔](http://leastprivilege.com/2008/02/19/using-identitymodel-claims/%20Claims)
*   [索赔集](http://leastprivilege.com/2008/02/23/using-identitymodel-claim-sets/ "声明集")
*   [检查声明集](http://leastprivilege.com/2008/02/23/using-identitymodel-inspecting-claim-sets/ "检查声明集")
*   [Windows 和 X509 证书声明集](http://leastprivilege.com/2008/02/24/using-identitymodel-windows-and-x509certificate-claim-sets/ "Windows 和 X509 证书声明集")
*   [声明集的典型操作](http://leastprivilege.com/2008/02/24/using-identitymodel-typical-operations-on-claim-sets/ "声明集的典型操作")
*   [授权策略、上下文和声明转换](http://leastprivilege.com/2008/02/29/using-identitymodel-authorization-policies-context-and-claims-transformation/ "授权策略、上下文和声明转换")
*   [WCF 中的声明转换](http://leastprivilege.com/2008/03/04/using-identitymodel-claims-transformation-in-wcf/ "WCF 中的声明转换")
*   [WCF 之外的授权上下文和声明转换](http://leastprivilege.com/2008/03/04/using-identitymodel-authorization-context-and-claims-transformation-outside-of-wcf/ "WCF 之外的授权上下文和声明转换")

# c# - 是否可以使用 Apache 进行 ClickOnce 部署？

> ID：646409
> 
> 赞同：0
> 
> 时间：2009-03-14T18:14:46.387
> 
> 标签：c#, .net-3.5, clickonce

我可以使用 ClickOnce 部署将 winforms 应用程序发布到 apache 服务器吗？

尝试发布到 Apache 服务器时，我收到此错误：

> 无法连接到“ [http://10.200.0.80:8081/WinSync/](http://10.200.0.80:8081/WinSync/) ”，出现以下错误：无法打开网站“ [http://10.200.0.80:8081/WinSync/](http://10.200.0.80:8081/WinSync/) ”。要访问本地 IIS Web 服务器上的网站，您必须在管理员帐户下运行 Visual Studio 才能访问 IIS 元数据库。或者，安装 FrontPage 服务器扩展 (FPSE)，然后将 FPSE 访问权限授予将运行 Visual Studio 的用户。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T18:16:41.107

ClickOnce 对我所知道的任何 Web 服务器都没有固有的依赖关系。它的部署模型非常灵活。实际上，它只需要一个可访问的 URI 和一个存储它的位的地方。如果您愿意，您实际上可以部署到文件共享。我以这种方式运行几个内部应用程序。

所以是的，部署到 Apache 服务器不应该有任何限制，只要

1.  您实际上可以将这些位放到服务器上
2.  消费者可以看到它们停放的 URL。

此博客条目详细介绍了如何部署到 Apache：http: [//blogs.msdn.com/josephkiran/archive/2009/01/06/clickonce-deployment-using-iis-apache-server-for-vsto。 aspx](http://blogs.msdn.com/josephkiran/archive/2009/01/06/clickonce-deployment-using-iis-apache-server-for-vsto.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T18:40:30.270

我找到了解决方案。您将 mime 类型添加到 httpd.conf 中，就像 JaredPar 提供的链接一样，您将发布文件夹设置为 web 文件夹的目录，然后将安装文件夹设置为它的等效 URI

例如，我目前有发布文件夹`C:\Program Files (x86)\Apache Software Foundation\Apache2.2\htdocs\WinSync\`
和安装文件夹，因为 `http://10.200.0.80:8081/WinSync/`
我还告诉它每次都生成一个 publish.htm，但我认为这没有什么不同。

# eclipse - 在 GEF 中垂直居中 TextFlow

> ID：646410
> 
> 赞同：0
> 
> 时间：2009-03-14T18:15:02.657
> 
> 标签：eclipse, layout, swt, eclipse-gef

我试图在 GEF 的 RectangleFigure 中垂直居中多行文本框。它需要在调整大小时进行调整。

这最好通过布局来完成，但我不知道它是如何工作的。

我将 BorderMargin 添加到父 FlowPage 并在调整 RectangleFigure 大小时更改边距。不幸的是，在那个特定的点上，TextFlow 还没有被布局，而且它通常不再有正确的行数。

鉴于我只需要行数，我该如何计算。

或者，“自动居中”布局是什么样的？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-16T23:55:28.187

我（还）没有看到答案，但我确实有一些问题：

*   到目前为止，您可以发布您的代码示例吗？
*   将父 BorderMargin 置于中心位置可能是错误的做法。如果你不这样做会发生什么？
*   你在做 invalidateTree() 来强制重新计算/布局吗？
*   当您说“您只需要行数”时，您指的是哪个对象以及您打算如何处理答案？

# java - Axis2 会话管理

> ID：646414
> 
> 赞同：0
> 
> 时间：2009-03-14T18:18:21.603
> 
> 标签：java, web-services, session, axis2

我在axis2中构建了一个小型webservice（自下而上，我编写java类并让eclipse wtp生成服务）。我想使用会话，以便用户可以使用用户名登录并通过它是否存在于数据库中，而不是使用 web 服务，但在他的会话上下文中。坦率地说，我不知道从哪里开始。我如何创建一个会话，然后再处理它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T13:45:43.550

您可能希望使用处理程序进行身份验证。建议您[从](http://www.developer.com/services/article.php/3529321)该主题开始。

有关会话信息，请[从此处开始](http://www.developer.com/java/web/article.php/3620661)。

正如@Maurice Perry 所说，我不确定您的问题是否有意义……请记住，Web 服务应该是无状态的。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-19T10:43:57.420

Web 服务应该是无状态的。因此，如果您计划使用“会话”进行身份验证，您可以考虑以下方法：

*   定义身份验证 API，返回一些密钥/令牌，服务器可以在连续调用中识别用户
*   客户端必须先调用认证API
*   客户端必须通过 API 参数或自定义 http 标头形式的任何连续调用来传递身份验证密钥。

您可以看一下[eBay API](http://developer.ebay.com/DevZone/XML/docs/HowTo/index.html)，它们同时使用 http 标头和方法参数。

您必须记住，如果您计划使用 session 来保持状态，那么在集群环境中您必须处理很多问题，因为同一个客户端可以由不同的节点提供服务。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2013-03-28T10:59:11.517

我让你使用 Eclipse 和轴 2 创建 Soap 服务

只需更改服务 XML 文件以具有范围

```
 <service name="Myservice"  scope="soapsession"> 
```

然后您的服务将作为请求状态完整而不是默认会话

你要做出改变还有很长的路要走，我不能讨论所有这些

链接在这里

[http://blogs.deepal.org/2009/06/axis2-tutorials-and-articles.html](http://blogs.deepal.org/2009/06/axis2-tutorials-and-articles.html)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-16T00:40:08.727

我不确定我是否完全理解你的问题。servlet 容器（tomcat？）将负责会话管理，它还可以负责身份验证。

# jquery-ui - jQuery Accordion 和通过 AJAX 加载内容

> ID：646415
> 
> 赞同：25
> 
> 时间：2009-03-14T18:20:15.420
> 
> 标签：jquery-ui, jquery

我想使用 jQuery [load](http://docs.jquery.com/Ajax/load)命令加载每个 jQuery[手风琴](http://docs.jquery.com/UI/Accordion)标题下的内容。目前，我已将其设置为以下

```
$(function() {

    $("#accordion").accordion({          
        header: "h2",
        active: false              
    });

    $("h2", "#accordion").click(function(e) {
        var contentDiv = $(this).next("div");
        contentDiv.load($(this).find("a").attr("href"));      
    });                    
}); 
```

和 HTML（*相关片段*）

```
<div id="accordion">
    <div>
        <h2><a href="home.htm">Home</a></h2>
        <div>
           <!-- placeholder for content -->
        </div>
    </div>
    <div>
        <h2><a href="products.htm">Products</a></h2>
        <div>
           <!-- placeholder for content -->       
        </div>
    </div>
</div> 
```

现在这一切正常，但存在一个问题，以这种方式加载内容会中断手风琴插件在某些浏览器（IE6）上的向下滑动动画，而在其他浏览器（FF）上则不会出现向下滑动动画。

我在想我需要防止在内容加载之前发生向下滑动动画（使用加载回调函数），但我不确定如何将其挂接到手风琴插件中。

任何想法都非常感谢！

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2013-03-22T14:53:11.760

只是快速抬头。

这些答案都不会像预期的那样与最新的 API 一起工作，因为自 jQuery UI 1.9 以来，事件`change`并`changestart`已分别更改为“ [activate](http://api.jqueryui.com/accordion/#event-activate) ”和“ [beforeActivate](http://api.jqueryui.com/accordion/#event-beforeActivate) ”。

希望可以节省几分钟。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-12-01T17:32:57.813

这应该可以解决您的问题：

```
 $('#accordion').accordion({ 
    changestart: function(event, ui){
        var clicked = $(this).find('.ui-state-active').attr('id');
        $('#'+clicked).load('/widgets/'+clicked);
    }
}); 
```

它的诀窍是手风琴更改了活动容器的类，因此您可以使用 .find() 来定位活动的手风琴并对其执行操作。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-17T03:12:33.470

我刚刚做了类似的事情，发现诀窍是在 DOM 准备好后立即从 ajax 请求加载内容，并在请求的回调函数中启用手风琴。

我尝试用 jquery 的 load 函数来做，但遇到了麻烦，最终改用了 ajax 函数。

在您有多个 ajax 调用的情况下，我想您可以将每个调用嵌套在前一个的回调函数中。这确实是一种非常低效的方法，但如果它们只是小文本文件，那应该没问题。

示例如下：

```
$.ajax({type:"get",url:"home.htm",success: function(data){
    $("#homeDiv").html(data);
    $.ajax({type:"get",url:"products.htm",success: function(data){
            $("#productsDiv").html(data);
            $("#accordion").accordion();
        }
    });
}}); 
```

那应该这样做...

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-06-05T19:19:58.103

我在尝试使用 Jquery UI 将手风琴加载到 ajax 选项卡时遇到了同样的问题。手风琴在销毁之前无法初始化。

这是示例 javascript 代码：

```
 $("#navigation").tabs({ 
    show: function(ui) {
        $('#browse').accordion('destroy').accordion({autoHeight: false, collapsible: true , active: false, header: 'h3'});
    } 
}); 
```

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2011-01-18T05:46:58.900

我已经这样做了，然后让我将其复制并粘贴到此处。

```
<div class="accordion">
    {section name=cat_loop loop=$cats}
            <h3  data-id="{$cats[cat_loop].subcat_id}">
                <a href='#' rel='loaderAnchor' id='lanch-{$cats[cat_loop].subcat_id}'>
                    {print id=$cats[cat_loop].subcat_title}
                </a>
            </h3>
            <div id='section-{$cats[cat_loop].subcat_id}' >
                {include file='include/section_profile_fields.stpl'}
            </div>
    {section}
<div> 
```

里面的东西`{}`包含服务器端脚本，基本上是一个循环打印多个手风琴的内容。这是javascript：

```
jQuery('.accordion').accordion({
            changestart: function(event, ui){
                   var $activeCord = jQuery(this).find('.ui-state-active');
                   var contentDiv = $activeCord.next("div");
                contentDiv.load('ajax_member_profile_edit.aspx?cat_id='+$activeCord.attr('data-id'));
            }

}); 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2011-05-16T14:52:28.763

这是最简单和最简单的方法

```
    $("#accordion").accordion({
                主动：假，
                更改：函数（事件，用户界面）{
                    if(ui.newContent.html()==""){
                        ui.newContent.load(ui.newHeader.find('a').attr('href'));
                        }
                },
                自动高度：假
            });

```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2011-12-15T00:41:41.870

这应该可以解决在激活之前加载手风琴的问题：

```
<script type="text/javascript">//<![CDATA[
$(document).ready(function() {

  $("#accordion").children("div").each( function() {
    var a = $(this).find("a");
    var ref = $(a).attr("href");
    $(a).attr("href", "#");
    $(this).find("div").load(ref);
  });

  $("#accordion").ajaxStop(function() {
    $(this).accordion({
      header: "h2",
      active: false,
      collapsible: true,
      clearStyle: true
    });
  });

})
//]]></script>
<div id="accordion">
  <div><h2><a href="home.htm">Home</a></h2><div></div></div>
  <div><h2><a href="products.htm">Products</a></h2><div></div></div>
</div> 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-02-25T14:11:45.980

也许这与这里讨论的内容不完全一样，但是很多这些片段帮助我让我的解决方案正常工作，所以我认为我应该分享它，以防其他人需要做（完全正确！）我需要做的事情。

我想将外部内容片段加载到手风琴中，但让它正确调整大小等很麻烦，这是我的解决方案：

```
$(document).ready(function () { //All the content is loaded at page load which means you dont get screwy animations
    $('#accordion').accordion({
        autoHeight: false, // set to false incase theres loads more in one panel than the others
        create: function (event, ui) {
            $('div#accordion > div').each(function () { //for each accordion panel get the associated content from external file and load it in.
                var id = $(this).attr('id');
                $(this).load('ajax_content.html #' + id, function () {
                    $('#accordion').accordion('resize');
                });
            });
        }
    });
}); 
```

希望这可以帮助某人=)

哦，我应该提到，显然在 ajax_content.html 文件中有一个与每个手风琴面板具有相同 id 的 div，因此它知道将什么放在哪里！

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-03-14T18:48:13.497

只是在框外思考片刻，您使用 ajax 加载内容有什么原因吗？至少从您的示例中看起来，好像内容可以最初加载并完成。

至于您的实际问题，您是否尝试过这样的事情：

```
var contentDiv = $(this).find("div"); 
```

或探索您的加载可能会干扰手风琴对 DOM 树的视图的任何其他方式？（例如，尝试加载嵌套更深的 div）？

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2011-07-29T09:08:23.733

这实际上比你们想象的要容易得多！

在您的文档就绪功能中：

```
$('#accordion').accordion();
$("#accordion").click(function(e) {
  $('.ui-accordion-content-active').load('/path/to/content');
}); 
```

和你的 html

```
<div id = "accordion">
  <h3>Click me</h3>
  <p>Loading....</p>
  <h3>Or even click me!</h3>
  <p>Loading...</p>
  <h3>Etc..</h3>
  <p>Loading</p>
</div> 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2012-01-26T15:16:24.303

我相信这是尚未给出的最简单的答案，并且满足所有 OP 的要求......在显示 div 之前加载，并根据 a 标签的 href 动态加载：

```
$("#accordion").accordion({

    active: false,
    clearStyle: true,
    changestart: function(event, ui){

        var href = $(ui.newHeader.find("a")).attr("href");

        $.post(href, function(data) {

            ui.newHeader.next("div").html(data);
        });

    }
}); 
```

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-03-08T19:41:30.390

我一直在使用 jquery 1.4 处理这个问题，这就是我解决它的方法。“ui”对象有两个重要的属性“newContent”和“newHeader”。我使用 newContent 并在将保存内容的 div 上放置了一个 id。我还有一个隐藏的输入标签来保存重要数据，感觉更干净。

```
 $("#accordion").accordion({
         disabled: false,
         autoHeight: false,
         collapsible: true,
         active: false,
         header: 'h2',
         animated: 'bounceslide',
         changestart: function (event, ui) {
             var location = ui.newContent.find('input:hidden[name=location]').val();
             ui.newContent.find('#data').load(location);

         }

     }); 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2010-10-19T19:43:30.713

```
$( "#accordion" ).bind( "accordionchange", function(event, ui) {   
    if (ui.newHeader.text()=="LaLaLa"){
       do here ....
    }
   }); 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2011-06-21T22:38:24.990

我一直在寻找相同问题的答案，并在此处尝试了几个示例。但是，使用带有 ui-state-active 的示例，我得到了一个未定义的值：

```
var clicked = $(this).find('.ui-state-active').attr('id'); 
```

我还想确保仅在每个手风琴面板第一次展开时才调用 .load 函数。通过结合其他几个海报的答案，我得到了我想要的结果：

```
$('#accordion').accordion({ 
    changestart: function(event, ui){
         if(ui.newContent.html() == ""){
             var id = ui.newContent.attr("id");
             ui.newContent.load("[your url]" + id);
         }
}); 
```

# c++ - 在 C++ 中使用带有 .h 标头的 DLL

> ID：646423
> 
> 赞同：5
> 
> 时间：2009-03-14T18:26:19.977
> 
> 标签：c++, dll, header, function

我得到了一个小库，由一个 .dll、一个 .h 头文件和一个 .def 文件组成。我相当确定该库是用 C 编写的，但可能是 C++。

我是否可以在不使用通常谈论的 LoadLibrary/GetProcAddress/FreeLibrary 方法的情况下访问库中的函数。我没有 .lib 文件 - 通常有一个吗？

在过去的两天里，我一直在寻找这个。似乎因为我已经获得了一个定义我希望从 dll 使用的函数的头文件和一个 .def 文件，所以我不需要手动显式“加载”每个函数（LoadLibrary/GetProAddress/FreeLibrary） - 在在我的情况下，我将使用 .dll 中的大约 5 或 6 个函数，但大约有 70 个可用，这似乎会让人头疼，并导致不必要的代码混乱。

感谢您的任何建议。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-14T18:40:20.177

有几种方法可以为 DLL 创建导入库 - Microsoft 记录了一种通过构建您自己的 .DEF 文件来创建导入库的方法：

*   [http://support.microsoft.com/kb/131313](http://support.microsoft.com/kb/131313)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T19:01:17.240

Visual C++ 有“lib”——在联机帮助中查找它。

使用“lib /def”制作 .lib 文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-14T18:37:57.827

您需要一个 lib 文件 - 它包含链接器为您的 DLL 创建导入表所需的存根。

不确定这是否可行，但您可以尝试：

使用空存根和 .DEF 文件创建一个 .C 文件。编译为具有完全相同名称的 DLL 以生成 .lib。丢弃新的 DLL，并与 lib 链接，如果现有的 DLL 与您的 exe 位于同一目录中，则您的程序应该能够加载和绑定它。

我相信这会起作用，因为本机 DLL 没有强命名。

# sql-server - 如何获取 MS SQL Server 2005 的登录历史记录

> ID：646425
> 
> 赞同：4
> 
> 时间：2009-03-14T18:29:16.583
> 
> 标签：sql-server, sql-server-2005, tsql

是否有任何系统视图或表可用于获取 MS SQL Server 2005 的历史登录？

如果可用，我想使用 TSQL 获取有关日期时间范围的登录信息的信息。由于存储过程访问的表上的线程死锁异常，我有一个计划的作业失败了。通过在此期间检查登录信息，它可以提供有关可能导致问题的原因的缩小信息。

我想可能有一些 SQL 服务器设置来启用保存登录信息。如果默认没有登录信息的系统历史记录，是否有任何设置/配置以便可以保存详细的登录信息？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-23T05:46:18.887

SQL Server 具有基本审计功能，可以审计登录到 ERRORLOG。在对象资源管理器中右键单击 SQL Server 并选择属性。选择安全部分并在登录审核中选择“失败和成功登录”。根据连接到 SQL Server 的人数，ERRORLOG 会填满很多。确保在发现问题后关闭。

您还可以为作业设置 DEADLOCK_PRIORITY 设置，以便它始终赢得死锁而不是失败。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T19:04:54.907

AFAIK 在 SQL Server 2005 中没有开箱即用的登录历史记录。

但是，正如[这里](http://blogs.msdn.com/sqlprogrammability/archive/2006/08/16/703079.aspx)和[这里](http://www.sqlservercentral.com/articles/SQLServerCentral/sqlserver2005logontriggers/2366/)所描述的，有不同的方法来实现这个功能。两种方法都使用登录审计事件。其中一种使用 SQL Server 2005 的事件通知系统来捕获和存储信息，另一种使用跟踪。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-15T15:12:21.743

我认为这是 SQL Server 2008 - [SQL Server Audit](http://msdn.microsoft.com/en-us/library/cc280386.aspx)中相当有用的新功能之一。

但由于它是 SQL Server 2008 中的一项新功能 - 它不在 SQL Server 2005 中:-(

马克

# c++ - 析构函数应该是线程安全的吗？

> ID：646427
> 
> 赞同：17
> 
> 时间：2009-03-14T18:30:07.580
> 
> 标签：c++, multithreading, destructor

我正在浏览旧代码并找到以下代码段：

```
MyClass::~MyClass()
{
   EnterCriticalSection(&cs);

//Access Data Members, **NO Global** members are being accessed here

  LeaveCriticalSection(&cs);
} 
```

我想知道它是否有助于保护析构函数？

考虑一个场景：

```
1\. Thread1 - About to execute any of the member function which uses critical section
2\. Thread2-  About to execute destructor. 
```

如果执行顺序是 1=>2，那么它可能会起作用。但是如果顺序颠倒了怎么办？

是设计问题吗？

* * *

## 回答 #1

> 赞同：37
> 
> 时间：2009-03-14T18:32:20.027

**使用对象时不应调用**析构函数。如果您正在处理这种情况，**则需要进行根本的修复**。然而，析构函数可能想要改变一些其他的东西（这与被破坏的类无关）并且它可能需要一个临界区（例如递减一个*全局*计数器）。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-14T18:33:25.077

我认为你有一个更根本的问题。当另一个线程仍在调用成员函数时，在一个线程上销毁您的对象是不合法的。这本身就是错误的。

即使你成功地用临界区保护了你的析构函数，当另一个线程开始执行函数的其余部分时会发生什么？它将在一个已删除的对象上执行此操作，该对象（取决于它的分配位置）将是垃圾内存或简单的无效对象。

您需要更改代码以确保对象在仍在使用时不会被破坏。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-14T18:46:12.097

如果您正在访问全局变量，您可能需要线程安全，是的

例如。我的“Window”类将自己添加到构造函数中的列表“knownWindows”中，并在析构函数中将自己删除。“knownWindows”需要是线程安全的，因此它们在执行此操作时都会锁定互斥锁。

另一方面，如果你的析构函数只访问被销毁对象的成员，那么你就有了设计问题。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-15T00:08:06.940

我见过一个 ACE 线程的案例，其中线程在 ACE_Task_Base 对象上运行，并且该对象被另一个线程销毁。析构函数在等待条件之前获取锁并通知包含的线程。在 ACE_Task_Base 信号上运行的线程在退出时发出条件信号，并让析构函数完成并退出第一个线程：

```
class PeriodicThread : public ACE_Task_Base
{
public:
   PeriodicThread() : exit_( false ), mutex_()
   {
   }
   ~PeriodicThread()
   {
      mutex_.acquire();
      exit_ = true;
      mutex_.release();
      wait(); // wait for running thread to exit
   }
   int svc()
   {
      mutex_.acquire();
      while ( !exit_ ) { 
         mutex_.release();
         // perform periodic operation
         mutex_.acquire();
      }
      mutex_.release();
   }
private:
   bool exit_;
   ACE_Thread_Mutex mutex_;
}; 
```

在这段代码中，析构函数必须使用线程安全技术来保证对象在运行*svc()*的线程退出之前不会被销毁。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-14T18:45:14.020

定义“线程安全”。这可能是现代计算中最难理解的两个词。

但是，如果有可能从两个不同的线程中两次输入析构函数（正如同步对象的使用所暗示的那样），那么您的代码就处于深度 doo-doo 中。正在删除您所询问的对象的对象应该对此进行管理 - （可能）应该在该级别进行同步。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-14T18:45:23.487

不会有所作为。如果，正如你所说，调用的顺序是相反的，那么你正在调用一个被破坏的对象的成员函数，这将失败。同步无法修复该逻辑错误（对于初学者来说，成员函数调用将尝试获取已被破坏的锁对象）。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-14T19:17:27.157

我支持 Neil ButterWorth 的评论。当然，负责删除和访问 myclass 的实体应该对此进行检查。

这种同步实际上是从创建 MyClass 类型的对象的那一刻开始的。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-01-28T23:16:14.167

您的评论说“这里没有访问**全球**成员”所以我猜不是。只有创建对象的线程才能销毁它，那么您将从哪个线程保护它？

我自己喜欢有序的创建和销毁，其中只有一个对象拥有另一个子对象，并且引用该子对象的任何其他对象都是树中更靠下的后代。如果这些子对象中的任何一个代表不同的线程，那么它们将确保在销毁继续向上树之前完成。

例子：

*   main() 创建对象 A
    *   对象 A 包含对象 B
        *   对象 B 包含对象 C
            *   对象 C 创建一个访问对象 A 和 B 的线程
            *   对象 C 的析构函数运行，等待其线程完成
        *   对象 B 的析构函数运行
    *   对象 A 的析构函数运行
*   main() 返回

对象 A 和 B 的析构函数根本不需要考虑线程，对象 C 的析构函数只需要与它选择创建自己的线程实现一些通信机制（例如等待事件）。

如果您开始将对象的引用（指针）分发给任意线程而不跟踪这些线程的创建和销毁时间，那么您只会遇到麻烦，但是如果您这样做，那么您应该使用引用计数，如果那么在调用析构函数时为时已晚。如果仍然有一个对象的引用，那么没有人应该尝试调用它的析构函数。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-11-13T16:35:03.387

老问题，但仍然有效的恕我直言。

一般来说，改变临界区的类的公共成员，可以从不同的线程访问，应该锁定这个临界区。但是对象的破坏是对象状态的最终改变，*包括*临界区。

因此，如果正在进行异步操作，进入对象的这个临界状态，销毁肯定应该等到该临界区再次离开。一种方法是在析构函数中使用锁定。当然，这无助于保证对象本身以后不会再被错误地访问。

但该技术可用于同步。在异步结束时销毁对象。临界区的操作。

# .net - NSIS：查找和下载 .Net 版本

> ID：646428
> 
> 赞同：5
> 
> 时间：2009-03-14T18:31:41.367
> 
> 标签：.net, nsis

如何获得带有 NSIS 的 .NET 版本？如果我没有必要的版本，它会将我重定向到一个站点以下载它。

我已经找到了一些解决方案，但它们通常有一些硬编码的东西（例如几十个特定链接）。

有什么好的解决方案吗？

谢谢

*注意：我不想使用 Windows 安装程序/clickonce。*

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-14T18:40:37.790

.NET 没有单一版本。您可以安装 2.0 但没有安装 1.1，反之亦然；您可以安装 3.5，其中包括 2.0 和 3.0；*等等。所以从*这个意义上说，你不能检查版本。相反，您可能应该检查您需要的特定版本是否存在。

*   [NSIS 站点有一个脚本](http://nsis.sourceforge.net/How_to_insure_a_required_version_of_.NETFramework_is_installed)，用于检查所有已安装版本的注册表，然后检查文件系统是否`mscorlib.dll`存在每个版本。
*   可以在[此处](http://www.walkernews.net/2008/05/16/how-to-check-net-framework-version-installed/)找到许多替代方案。
*   您可以使用[这样的工具](http://blogs.msdn.com/astebner/archive/2006/08/02/687233.aspx)来检测可用版本。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T18:48:51.967

看看这里。我相信我已经改变了 NSIS 论坛的一些东西，但这很好用

[http://stochfit.svn.sourceforge.net/viewvc/stochfit/trunk/StochFitMain/Installer.nsi?revision=108&view=markup](http://stochfit.svn.sourceforge.net/viewvc/stochfit/trunk/StochFitMain/Installer.nsi?revision=108&view=markup)

# java - 有没有好的 J2ME IDE？

> ID：646431
> 
> 赞同：20
> 
> 时间：2009-03-14T18:33:14.907
> 
> 标签：java, ide, java-me

有没有好的 J2ME IDE？我的意思是轻巧便携的东西。可以运行您在其上编程的东西。我最喜欢的 Java IDE 是 JCreator Lite。J2ME 有类似的东西吗？另外，您认为哪个是最好的 J2ME IDE？

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-14T18:49:31.233

[Netbeans](http://www.netbeans.org/features/javame/index.html)相当不错，虽然不是很轻量级。
[本教程](http://www.defza.com/wordpress/development/j2me-tutorial)提供了一个很好的说明。

![替代文字](https://i.stack.imgur.com/zvXSq.png)

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-17T11:50:26.860

Eclipse 插件[EclipseME](http://eclipseme.org/)（现在是[Mobile Tools for Java](http://www.eclipse.org/dsdp/mtj/ "MTJ")）非常好，可以很好地与设备制造商的 SDK 集成。我已将它用于索尼爱立信设备上的开发，它可以让您在 IDE 中进行设备调试等操作。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-16T14:09:37.270

你有两个选择。Netbeans 和 Eclipse，但我不认为它们都是轻量级的，它们实际上是重量级冠军。考虑到 J2ME netbeans 是一个很好的入门平台。它很容易为 J2ME 设置配置，现在所有东西都捆绑到 netbeans 包中。

* * *

然后你就有了同样优秀且被广泛使用的 Eclipse。Eclipse 正在为 J2ME 提供新的 MTJ（Java 移动工具）包，这使得许多任务比以前更容易。它正在成为许多语言和框架的理想 IDE。作为一个 IDE，与 Netbeans 相比，Eclipse 有更多的好处。

无论如何，您必须尝试两种选择，选择您觉得舒服的一种。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-02-12T22:48:57.073

NetBeans IDE & Eclipse IDE are the best two environments to work for developing JavaME applications.

The only difference which I found out between the two IDE when I coded on JavaME was that for NetBeans , J2me environment was already added.

For Eclipse , the developer was required to add the j2me plugin , antenna for building , J2me Wirless toolkits

NetBeans IDE can be downloaded from the following link

**http://netbeans.org/features/javame/**

Eclipse IDE & EclipseME plugin can be downloaded from the following links respectively

**http://www.eclipse.org/downloads/**

**http://eclipseme.org/**

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-12-03T04:23:41.833

Netbeans 不是 sun 的产品。

为了选择 IDE。1st 我们决定我们的应用程序是为哪种手机（诺基亚、三星等）构建的。然后我们从供应商那里得到他们的特定组件、sdk 等。然后我们在 SDK 上工作很有用。

谢谢和问候， Sivakumar.J

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-12-11T09:55:11.827

Sun 的 NetBeans 也可以通过使用[Java ME SDK 3.0 Mac OS X](http://java.sun.com/javame/downloads/sdk30_mac.jsp)版本来支持 Mac OS X。这就是我喜欢它的原因。

# asp.net - ASP.NET 3.5 和 SQL Server 2008

> ID：646434
> 
> 赞同：0
> 
> 时间：2009-03-14T18:34:30.050
> 
> 标签：asp.net, sql-server, asp.net-3.5

我是 ASP.NET 和 SQL Server 的新手。我来自 PHP/MySQL 世界，所以我对这些东西很困惑。我需要帮助，因为我正在尝试创建一个简单的博客作为第一次认真的练习。我不知道如何从我的 c# 代码连接到我的 sql 服务器。我的 sql 服务器与 IIS 在同一台机器上。当我使用 SQL Server Management Studio 时，它说它连接到 BAMF\SQLEXPRESS。那是我应该放在我的连接字符串中的吗？一点指导会很棒。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-14T18:37:28.967

[http://www.connectionstrings.com/](http://www.connectionstrings.com/)

> Standard Security Data Source=myServerAddress;Initial Catalog=myDataBase;User Id=myUsername;Password=myPassword;使用 serverName\instanceName 作为 Data Source 连接到特定的 SQL Server 实例。
> 
> 您使用的是 SQL Server 2008 Express 吗？不要错过服务器名称语法 Servername\SQLEXPRESS，您可以在其中将 Servername 替换为 SQL Server Express 安装所在的计算机的名称。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T18:36:13.213

是的，这将在您的机器上运行。为了使其更便携，您可能希望使用`.\SQLExpress`其中的点表示*本地计算机*（无论它具有什么计算机名称）并且`SQLExpress`是 SQL Express 安装的*实例名称*。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T18:38:47.263

在这种情况下，BAMF 是运行 SQL Server 的服务器/计算机的名称。SQLExpress 是数据库的命名实例。有很多方法可以设置您的连接字符串，只需 google，您就会得到答案。

# ssl - 在哪里可以找到关于使用 OpenSSL 的 SSL 的介绍？

> ID：646437
> 
> 赞同：2
> 
> 时间：2009-03-14T18:36:41.183
> 
> 标签：ssl, openssl, stunnel

我想了解使用 SSL 来保护客户端/服务器通信的具体细节。是否有任何关于如何使用 OpenSSL 执行此操作的文档？

到目前为止，我能找到的最好的是 stunnel 的源代码（[http://www.stunnel.org/](http://www.stunnel.org/)）......

更准确地说，我希望客户端能够与服务器连接，进行安全握手，验证服务器的证书是否有效（例如，由受信任的 CA 签名、未过期等）然后发送一些数据。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T19:47:29.690

这些看起来很有希望：

[http://www.openssl.org/docs/apps/openssl.html](http://www.openssl.org/docs/apps/openssl.html)

[http://www.ibm.com/developerworks/linux/library/l-openssl.html](http://www.ibm.com/developerworks/linux/library/l-openssl.html)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T21:25:40.887

我还发现了这个：[http](http://www.rtfm.com/openssl-examples/) ://www.rtfm.com/openssl-examples/有很好的简单示例。

# visual-studio - C# 开发人员应该学习 Emacs/Vim 有什么理由吗？

> ID：646438
> 
> 赞同：24
> 
> 时间：2009-03-14T18:37:09.390
> 
> 标签：visual-studio, vim, emacs

我在一家纯粹的 Microsoft 商店担任 ac# 开发人员。

我最近开始在工作之余利用 Gas 和 Linux 自学组装。我喜欢搞乱Linux，不过我对它还是很陌生。

我一直听说我应该学习 VIM 或 Emacs，但问题是，我绝对不需要在工作中使用它们，所以我觉得花时间掌握其中一个有点内疚。更糟糕的是，我想知道学习 VIM 或 Emacs 是否会使我在使用 Visual Studio 时变慢，因为我会混淆快捷键。

目前我正在使用 SciTE 在 Linux 中进行编辑（我认为这在 Windows 上变成了 notepad++）。

对于在纯 ms 产品环境中工作的人来说，我是否有任何真正的理由来学习 Emacs/VIM？我看到 vs studio 中有一个使用 Emacs 快捷方式的设置，这里有没有人通过在 vs 中掌握它们来提高工作效率，或者换句话说，你能看到它值得吗？

提前致谢！

> **相关：** [学习 VIM 值得付出努力吗？](https://stackoverflow.com/questions/597077/is-learning-vim-worth-the-effort)
> **相关：** [花时间学习使用 Emacs 是否值得？](https://stackoverflow.com/questions/48006/is-it-worth-investing-time-in-learning-to-use-emacs)
> **相关：** [为什么要使用 IDE？](https://stackoverflow.com/questions/208193/why-should-i-use-an-ide)（从另一边看）

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2009-03-14T18:41:11.003

开始火焰战争:)

我是一个 VIM 瘾君子，并不羞于承认这一点。我发现使用 VIM 让我在日常生活中的工作效率显着提高。当您不必将手从键盘上移开时，编码速度会快得多。

默认情况下，VS 对 VIM 绑定的支持很差。但是，有一个廉价的加载项 ( [ViEmu](http://viemu.com) ) 可以为 Visual Studio提供**出色的 VIM 键绑定。**我有个人执照，我相信每一分钱都值得。

话虽如此，与 VIM 相关的学习曲线很**陡峭。**它很可能会在一两个星期内扼杀你的生产力。不过在那之后，好处就会开始出现，你应该注意到你的生产力有所提高。

* * *

## 回答 #2

> 赞同：19
> 
> 时间：2009-03-14T18:44:12.023

我在一家 90% 的 Microsoft 商店工作，但我仍然每天使用 gvim。我使用的每个 IDE 都有一个 vi 插件。如果您要学习其中一种，我会推荐 vim，但我知道 emacs 用户会强烈反对。

emacs 和 vi 已经存在了很长时间，并且都非常强大。学习其中之一可能会让您大开眼界，进入一个更高效的编码世界。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-15T01:31:06.243

我也为一家只有微软的商店工作，但在家里，我只使用 Linux。可以说我只在家里使用 Vim 进行编辑。在工作中，我使用 Visual Studio 进行所有开发，但我使用 Vim 完成许多需要复杂文本操作的任务。即使我没有在家里使用 Vim，它对我在工作中所做的事情仍然非常有用。当我们的 IT 人员看到我在做 Vim 杂技时，他会认为我是某种魔术师。那一定是值得的，对吧？;)

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-29T02:14:38.957

我一起使用 emacs 和 Visual Studio，如果没有 emacs，我会很难过。VS 当然是必不可少的，但它没有提供 emacs 所做的文本编辑。Emacs 对我来说是 98.4% 的编辑面板。Visual Studio 有 12 个不同的面板，每个面板都很重要，但有时我只想看看代码。Emacs 让我这样做。而且我可以分屏并在一个屏幕上看到 4 个编辑窗口，即使在同一个文件中也是如此。使用双显示器，我可以在每个显示器上都有 emacs 窗口。这听起来很奇怪，但是当我同时处理代码的不同部分时（假设同时处理接口定义和实现），它对我很有帮助。正则表达式搜索和替换。

我在 emacs 中打开了自动恢复模式，这类似于 VS 功能，即“文件在 Visual Studio 之外更改，您要重新加载它吗？” 除了在 emacs 中它总是默默地重新加载，这是我想要的方式。因此，我从 VS 跳到 emacs 并返回，源代码中未显示在其他编辑器中的未决更改从来没有问题。VS 具有“全屏”功能，但我还没有发现它像 emacs 那样灵活或有用。

我无法想象没有这种工具组合的能力。单独的 Visual Studio 无法提供此功能。仅 Emacs 是不够的。我仍然将 emacs 用于基本的代码片段和小型测试程序。我使用 VS 来管理项目、TFS、测试和调试。

在这一点上，我不能选择使用 emacs。我很久以前在以前的一家公司捡到​​它，emacs 是标准工具，所以它......不是说“简单”而是自动的。我无法想象“自己”学习 emacs。我只是从我周围的其他 emacs 用户社区中学到了一些东西。从走廊里的人那里，我为我的设置获取并定制了一堆 elisp 代码。用一本书来做......我无法想象。

至于因为手指混乱而降低您的工作效率……我没有遇到任何问题。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-21T09:10:50.900

我是 VIM 的铁杆用户，还为 C# ( [http://insenvim.sourceforge.net/](http://insenvim.sourceforge.net/) ) 开发了智能感知。但是随着最新的语言更改，我无法避免使用 Visual Studio。但是很多时候回顾使用 VIM 是出于简单的原因。Visual Studio 占用大量内存并且启动时间非常长。即使是读取文件或做一些简单的事情也需要几分钟。但是，打开文件和导航非常容易。我可能会将 VIM 智能感知移植到 C# 3.0。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-14T18:43:10.450

我以前几乎只使用 VIM，在搬到几乎 100% 使用 MS 的商店后，发现来回切换没有问题。

如果你愿意学习键盘快捷键，VIM 和 EMACS 就很棒。我发现当我来回前进时我并没有真正遇到问题 - 我认为它们是一个与 VS 完全不同的环境，因此很容易进行心理转换，这很有帮助。

你总是可以慢慢开始 - 使用它们，看看它是如何进行的。你会有一些学习曲线，但这在很大程度上取决于你。

如果 Scite 为您工作，而您只是将“玩”作为一种爱好，那可能不值得付出努力。不过，对我来说，努力学习新的和不同的工作/思维方式是乐趣的一部分。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-14T18:47:32.627

掌握一个好的编辑器**总是值得**的，作为一名开发人员，您花费大量时间输入纯文本、编写程序、XML、HTML，您可以通过使用一个好的编辑器并有效地使用它来节省**大部分时间。**

我像九年前一样开始学习 Vi，现在我离不开它。

无论您选择哪种编辑器，我认为几乎您都可以在所有主要的 IDE 中找到插件来拥有您选择的编辑器的输入模型，对于 Visual Studio，您可以使用[ViEmu](http://www.viemu.com/)或[Emacs 键绑定](http://msdn.microsoft.com/en-us/library/ms165509(VS.80).aspx)

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-03-15T09:00:03.450

我已经是一名专业的 C/C++ 程序员 16 年了。5 年前，我学习了一些 Common Lisp，最后也学习了 elisp/emacs。我也涉足 Haskell。我发现这些经验对 C++ 编程非常有帮助。如果不出意外，你会看到未来，因为 C++ 通过采用 CL 几十年来拥有的东西慢慢变得更具表现力。

学习 emacs 是一个漫长而缓慢的过程，一旦您完全熟悉它的功能、做事方式和 elisp，就会开始获得回报。我在很多开发中都使用 Visual Studio，但我经常切换到 emacs 以利用快速使用关键宏的优势，或者对值表进行一些复杂的处理。很多东西你可以在 elisp 中快速敲出，而使用 Visual Studios 插件需要花费几个小时的时间。

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-05T04:32:45.740

恕我直言，不。我在 vim 上使用 acme。gedit 或 vs2008 在工作。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-14T21:44:07.130

学习一个将是完全值得的。我个人会推荐emacs，但我有偏见。我 99% 确信可以将 emacs 设置到 .net devlopment 后端（想不出正确的词对不起）。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-15T01:43:43.857

JaredPar 提到[了 ViEmu](http://www.viemu.com/)，我听说过非常好的事情。但是，如果您真的想知道切换的好处是什么，ViEmu 网站上有一篇很好的文章：[为什么，哦，为什么，这样做#?@！疯子用vi？](http://www.viemu.com/a-why-vi-vim.html)

就我个人而言，我觉得使用 gvim 极大地提高了我的工作效率，我绝对更喜欢它而不是 Visual Studio 编辑器或 SlickEdit 或我使用过的任何其他工具。但正如前面的答案中提到的，Vim 可能是一个陡峭的学习曲线。有些人已经专业使用它 5-10 年，并且仍在学习它。Vim 可能很像 perl……有很多方法可以进行任何一系列的编辑，而学习最好的方法可能需要一段时间。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2011-02-16T04:15:12.927

我使用（并且喜欢）Emacs，但我可以理解那里的 vi 人（我总是在极简主义和厨房水槽主义之间徘徊）。是什么让我日复一日地使用 Emacs，以及让我最终放弃我曾经使用过的每一个 IDE，是我可以编写*函数*。当我说*功能*时，我的意思是**功能**；我真的可以对编辑器本身进行*编程。*我添加了一个新函数，评估它，然后*bam*现在它在我的编辑器中。如果我大量使用该功能，那么它会获得一个键绑定。

我注意到使用 IDE，它们在特定语言方面表现*出色*（Eclipse 擅长Java）。我不认为 Emacs 擅长任何一种语言（可能作为 Lisp IDE 除外，但我不会在这里尝试赞美它的优点......）作为专用 IDE 但它更擅长语言*N*，其中“N”实际上是已经*或将要*发明的任何编程语言。如果我正在学习一种新的编程语言（或者甚至只是在 C、PowerShell、Haskell、Lisp、Java 等任何一种语言之间来回切换），那我的环境会很舒服而且很能干，这很好。那么我的回答是“是”，因为 Emacs（或者我认为是 vi）为您提供了*可移植性*在您的工具集中。您今天可能正在使用 C#，但下线，谁知道您可能会在 Monad#++ 上进行黑客攻击，如果您是，您可以打赌会有一个 Emacs 模式。

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2015-08-24T15:35:27.150

一直提到vim“快捷键”的人应该更深入地学习它。很多 vim 的键盘命令都使用一种真正结构化的文本导航和操作“语言”（即范围、计数、动作、移动、文本对象等），而不仅仅是你必须记住的“快捷方式”就像在大多数文本编辑器中一样。这是 vim 受到欢迎以及它在生产力方面受到赞誉的主要原因之一。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-14T18:41:30.363

看看 JP Boodhoo 和他在做什么[www.jpboodhoo.com](http://www.jpboodhoo.com)。他和 Kyle Bailey 最近一直在写博客，介绍使用 VIM 作为 VS2008 开发经验的一部分。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-29T02:23:31.620

您至少应该学习如何`:w`在 VIM 中保存（）和编辑文件（魔术）——即使是最小的操作系统安装也包含它。这样，如果您被困在一个空的 unix 盒子上，您至少可以编辑文件。

否则，不——我不相信炒作。你有更大的鱼要炸，而且`nano`一直在变好。哎呀，nano 有一些语法着色和自动缩进，它甚至可以在 PuTTY 上使用鼠标。

最好的学习方法是如何在你的 unix 机器上配置 Samba，然后在你的 Windows 机器上使用真正的文本编辑器，比如 UltraEdit（提示火焰战争）。我使用此配置来编辑比 /etc 中的配置文件更大的任何内容。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2009-03-29T02:25:08.900

我也是一名长期的 C# 开发人员。在 Linux 中开发 C++ 时，我使用[Eclipse CDT](http://www.eclipse.org/downloads/)，因为它是我发现的最接近 Visual Studio 的东西。

我对 vim 非常有经验，我用它来编辑 Linux 配置文件等，但是当我可以使用 IDE 时，我并不特别喜欢它进行开发。

顺便说一句，如果你使用 vim，你可能想要启用行号和语法高亮；我总是将这些行添加到我的 ~/.vimrc 文件中：

```
number on
set syntax 
```

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2009-04-05T04:14:51.897

如果你在 VS 中使用 Vim，或者考虑使用它，你应该知道 Vim Intellisense 项目：http: [//insenvim.sourceforge.net/](http://insenvim.sourceforge.net/)

* * *

## 回答 #18

> 赞同：0
> 
> 时间：2009-04-21T09:55:27.157

编码速度在很大程度上取决于编辑器的选择，因此它是您将采取的最重要的决定之一。

* * *

## 回答 #19

> 赞同：0
> 
> 时间：2012-07-15T15:05:38.663

我使用了 Vim 和 Emacs，但它可能慢了 5%。我曾经测量过开发人员实际输入代码的时间（我不是在谈论滚动），它可能大约占您一天的 5%。我们正在争论大约 5% 的 5% ...

归根结底是 Emacs 和 Vim 用户已经使用了很长时间，以至于他们懒得改变。他们中的大多数人只能通过鼠标驱动 VS，并且不知道大多数热键。

# javascript - 如何订阅 javascript 事件表单 Flex 3 操作脚本代码？

> ID：646450
> 
> 赞同：0
> 
> 时间：2009-03-14T18:40:17.183
> 
> 标签：javascript, apache-flex, actionscript-3, dom, actionscript

我们让那个 Flex 应用程序与服务器通信。我们需要某种*FlexEvent.ON_BROWSER_WINDOW_CLOSE*事件，但不幸的是 Flex 没有提供这样的事件。

所以我得到的建议是捕捉一个javascript“onbeforeunload”事件并通过ExternalInterface-registred方法调用flash客户端。

有没有什么方法可以在没有任何 javascript 代码的情况下订阅 javascript 事件？

**更新**我想要做的是增加 Flash 应用程序托管页面。当然我们可以通过外部 javascript 文件来管理它，但目前还不清楚......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T18:57:28.467

您可以使用 ExternalInterface 调用容器中定义的 Javascript 函数。看到[这个](http://livedocs.adobe.com/flex/3/html/help.html?content=19_External_Interface_06.html#126566)。

[这篇](http://gregjessup.com/flex-3-catch-browser-exit-or-close-event-using-javascript-and-externalinterface/)文章描述了与您类似的情况。看一看。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-31T07:16:59.400

您可以编译 js 代码注入到您的 SWF 文件中：

```
package
{

import flash.display.Sprite;
import flash.external.ExternalInterface;
import flash.net.SharedObject;

public class CloseTest extends Sprite
{
    private var so:SharedObject = SharedObject.getLocal("hello");

    public function CloseTest()
    {
        if (ExternalInterface.available)
        {
            ExternalInterface.addCallback("onclose", onClose);
            ExternalInterface.call(this.javascript);
        }

        this.so.data.count ||= 0;

        trace(so.data.count);
    }

    private function onClose ():void
    {
        this.so.data.count++;
        this.so.flush();
        this.so.close();
    }

    private var javascript:XML = <javascript><![CDATA[function ()
    {
        window.onbeforeunload = function ()
        {
            alert("hello");
            document.getElementById("CloseTest").onclose();
        }

    }]]></javascript>;
}

} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T22:33:40.943

抱歉，如果不使用 Javascript 和 ExternalInterface，就无法完成您正在寻找的事情。

# c# - 如何旋转二维整数数组

> ID：646468
> 
> 赞同：17
> 
> 时间：2009-03-14T18:45:45.063
> 
> 标签：c#, c++, arrays, math

我正在编写俄罗斯方块克隆，在我的游戏中，我将我的 tetromino 块存储为 4x4 块数组。我现在需要能够旋转数组中的整数位置，以便获得旋转的俄罗斯方块块。我不能简单地旋转纹理，因为我所有的碰撞检测等都被设计为与 2D 数组一起使用。该游戏是使用 XNA 用 C# 编写的。

我怎么可能将我的二维整数数组顺时针/逆时针旋转 90 度。

以下是我的“L”块的存储方式作为示例。

```
0 1 0 0
0 1 0 0
0 1 1 0 
0 0 0 0 
```

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-14T18:51:27.420

如果它们是二维数组，您可以通过使用不同的数组访问顺序进行复制来实现旋转。

即，对于顺时针旋转，请尝试：

```
int [,] newArray = new int[4,4];

for (int i=3;i>=0;--i)
{
    for (int j=0;j<4;++j)
    {
         newArray[j,3-i] = array[i,j];
    }
} 
```

逆时针方向类似。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-14T18:55:42.090

不要用代码旋转碎片。只需存储一组不同的工件方向，并在工件旋转时循环遍历它们。无需在俄罗斯方块游戏中动态旋转它们。

由于问题域是俄罗斯方块，您会发现旋转算法会导致不良影响，例如长而细的 Tetronimo 不会在两个位置之间交替（就像在真实事物中那样）。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-14T18:54:21.970

在经典的俄罗斯方块中，对象的排列很少。我只需在 4 个位置中的每个位置为每个“tetromino”设置一个常量数组，并使用简单的逻辑根据输入选择合适的位置。

为什么要浪费 CPU 周期来尝试旋转它？

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-14T18:53:52.703

如果要旋转 4 x 4 块，只需移动位置：

```
A B C A
C D D B
B D D C
A C B A 
```

每个 A 移动到下一个 A，对于 B、C 和 D 也是如此。

```
 /-----\
   |     |
   |     V
   A B C A
/->C D>D B--\
|  B D D C  |
|  A C B A  |
|    | ^    |
|    | |    |
\----/ \----/ 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-14T19:31:46.217

我会存储“单元格”的 (x, y) 坐标并使用旋转矩阵来旋转它们。例如，请参阅[绘制旋转矩形](https://stackoverflow.com/questions/644378/drawing-a-rotated-rectangle/644433)。您可能必须将结果四舍五入到最接近的 0.5 增量。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-03-15T06:15:23.077

顺时针和逆时针的js代码：

```
function arrRotation90(arr, clockwise) {
            var arr_rotated = [];
            for (var i = 0; i < arr[0].length; i++) {
                arr_rotated[i] = [];
            }
            if (clockwise) {
                for (var i = 0; i < arr.length; i++) {
                    for (var j = 0; j < arr[i].length; j++) {
                        arr_rotated[arr[i].length-1-j][i] = arr[i][j];
                    }
                }
            } else {
                for (var i = 0; i < arr.length; i++) {
                    for (var j = 0; j < arr[i].length; j++) {
                        arr_rotated[j][arr.length - 1 - i] = arr[i][j];
                    }
                }
            }
            return arr_rotated;
        } 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2020-02-06T17:48:54.017

```
int[,] source = { { 1,2,3 }, {4,5,6 }, { 7,8,9} };
int[,] result = new int[3,3];
var rows = source.GetLength(0);
var cols = source.GetLength(1);

for (var r=0; r<rows; r++)
{
    for (var c = 0; c < cols; c++)
    {
        result[r, c] = source[rows - 1 - c, r];
    }
} 
```

# c# - 是否使用互斥锁来防止同一程序的多个实例安全运行？

> ID：646480
> 
> 赞同：47
> 
> 时间：2009-03-14T18:53:08.367
> 
> 标签：c#, winforms, mutex, single-instance

我正在使用此代码来防止我的程序的第二个实例同时运行，它安全吗？

```
Mutex appSingleton = new System.Threading.Mutex(false, "MyAppSingleInstnceMutx");
if (appSingleton.WaitOne(0, false)) {
    Application.EnableVisualStyles();
    Application.SetCompatibleTextRenderingDefault(false);
    Application.Run(new MainForm());
    appSingleton.Close();
} else {
    MessageBox.Show("Sorry, only one instance of MyApp is allowed.");
} 
```

我担心如果某些东西引发异常并且应用程序崩溃，Mutex 仍将被保留。真的吗？

* * *

## 回答 #1

> 赞同：65
> 
> 时间：2009-03-14T19:00:30.393

为此目的使用 Windows 事件更为常用和方便。例如

```
static EventWaitHandle s_event ;

bool created ;
s_event = new EventWaitHandle (false, 
    EventResetMode.ManualReset, "my program#startup", out created) ;
if (created) Launch () ;
else         Exit   () ; 
```

当您的进程退出或终止时，Windows 将为您关闭该事件，如果没有打开的句柄，则将其销毁。

*添加*：管理会话、事件（或互斥体）名称的使用`Local\`和`Global\`前缀。如果您的应用程序是每个用户的，只需将一个经过适当修改的登录用户名附加到事件名称。

* * *

## 回答 #2

> 赞同：43
> 
> 时间：2009-03-14T18:57:32.087

一般来说，是的，这会起作用。然而，魔鬼在细节中。

首先，您要在一个`finally`块中关闭互斥锁。否则，您的进程可能会突然终止并使其处于信号状态，例如异常。这将使未来的流程实例无法启动。

不幸的是，即使有一个`finally`块，您也必须处理进程将在不释放互斥锁的情况下终止的可能性。例如，如果用户通过 TaskManager 终止进程，就会发生这种情况。您的代码中有一个竞争条件，允许第二个进程`AbandonedMutexException`在`WaitOne`调用中获得一个。您需要为此制定恢复策略。

我鼓励您阅读[Mutex 类的详细信息](http://msdn.microsoft.com/en-us/library/system.threading.mutex.aspx)。使用它并不总是那么简单。

* * *

扩展竞争条件的可能性：

可能会发生以下事件序列，这将导致应用程序的第二个实例抛出：

1.  正常进程启动。
2.  第二个进程启动并获取互斥锁的句柄，但在`WaitOne`调用之前被关闭。
3.  进程#1 突然终止。互斥体没有被破坏，因为进程#2 有一个句柄。相反，它被设置为废弃状态。
4.  第二个进程再次开始运行并获得一个`AbanonedMutexException`.

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-03-14T19:02:38.610

您可以使用互斥锁，但首先要确保这确实是您想要的。

因为“避免多个实例”没有明确定义。这可能意味着

1.  避免在同一个用户会话中启动多个实例，无论该用户会话有多少桌面，但允许多个实例针对不同的用户会话同时运行。
2.  避免在同一个桌面上启动多个实例，但允许多个实例运行，只要每个实例都在单独的桌面上。
3.  避免为同一用户帐户启动多个实例，无论存在多少在此帐户下运行的桌面或会话，但允许多个实例同时运行以在不同用户帐户下运行的会话。
4.  避免在同一台机器上启动多个实例。这意味着无论任意数量的用户使用多少桌面，最多只能有一个程序实例在运行。

通过使用互斥体，您基本上使用的是定义编号 4。

* * *

## 回答 #4

> 赞同：11
> 
> 时间：2010-04-13T06:36:35.113

我使用这种方法，我相信它是安全的，因为如果不再被任何应用程序持有，互斥锁将被销毁（如果应用程序最初无法创建互斥锁，则应用程序将被终止）。这在“AppDomain-processes”中可能会或可能不会同样有效（参见底部的链接）：

```
// Make sure that appMutex has the lifetime of the code to guard --
// you must keep it from being collected (and the finalizer called, which
// will release the mutex, which is not good here!).
// You can also poke the mutex later.
Mutex appMutex;

// In some startup/initialization code
bool createdNew;
appMutex = new Mutex(true, "mutexname", out createdNew);
if (!createdNew) {
  // The mutex already existed - exit application.
  // Windows will release the resources for the process and the
  // mutex will go away when no process has it open.
  // Processes are much more cleaned-up after than threads :)
} else {
  // win \o/
} 
```

以上内容受到其他答案/评论中关于恶意程序能够位于互斥锁上的注释的影响。这里不用担心。此外，在“本地”空间中创建的无前缀互斥锁。这可能是正确的事情。

请参阅：[http](http://ayende.com/Blog/archive/2008/02/28/The-mysterious-life-of-mutexes.aspx) ://ayende.com/Blog/archive/2008/02/28/The-mysterious-life-of-mutexes.aspx - Jon Skeet 附带 ;-)

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-03-14T19:01:11.483

在 Windows 上，终止进程会产生以下结果：

*   进程中的任何剩余线程都被标记为终止。
*   进程分配的任何资源都被释放。
*   所有内核对象都已关闭。
*   进程代码从内存中删除。
*   进程退出代码已设置。
*   过程对象发出信号。

互斥对象是内核对象，因此当进程终止时（无论如何在 Windows 中），进程持有的任何对象都会关闭。

但是，请注意 CreateMutex() 文档中的以下内容：

> 如果您使用命名互斥锁将应用程序限制为单个实例，则恶意用户可以在您创建此互斥锁之前创建此互斥锁并阻止您的应用程序启动。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-14T19:02:31.887

是的，这很安全，我建议使用以下模式，因为您需要确保`Mutex`始终发布。

```
using( Mutex mutex = new Mutex( false, "mutex name" ) )
{
    if( !mutex.WaitOne( 0, true ) )
    {
        MessageBox.Show("Unable to run multiple instances of this program.",
                        "Error",  
                        MessageBoxButtons.OK, 
                        MessageBoxIcon.Error);
    }
    else
    {
        Application.EnableVisualStyles();
        Application.SetCompatibleTextRenderingDefault(false);
        Application.Run(new MainForm());                  
    }
} 
```

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2016-07-13T20:06:39.010

这是代码片段

```
public enum ApplicationSingleInstanceMode
{
    CurrentUserSession,
    AllSessionsOfCurrentUser,
    Pc
}

public class ApplicationSingleInstancePerUser: IDisposable
{
    private readonly EventWaitHandle _event;

    /// <summary>
    /// Shows if the current instance of ghost is the first
    /// </summary>
    public bool FirstInstance { get; private set; }

    /// <summary>
    /// Initializes 
    /// </summary>
    /// <param name="applicationName">The application name</param>
    /// <param name="mode">The single mode</param>
    public ApplicationSingleInstancePerUser(string applicationName, ApplicationSingleInstanceMode mode = ApplicationSingleInstanceMode.CurrentUserSession)
    {
        string name;
        if (mode == ApplicationSingleInstanceMode.CurrentUserSession)
            name = $"Local\\{applicationName}";
        else if (mode == ApplicationSingleInstanceMode.AllSessionsOfCurrentUser)
            name = $"Global\\{applicationName}{Environment.UserDomainName}";
        else
            name = $"Global\\{applicationName}";

        try
        {
            bool created;
            _event = new EventWaitHandle(false, EventResetMode.ManualReset, name, out created);
            FirstInstance = created;
        }
        catch
        {
        }
    }

    public void Dispose()
    {
        _event.Dispose();
    }
} 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2015-12-14T18:21:07.090

这是我的处理方式

在程序类中：

1.  使用 Process.GetCurrentProcess() 获取您的应用程序的 System.Diagnostics.Process

2.  使用 Process.GetProcessesByName(thisProcess.ProcessName) 逐步浏览具有应用程序当前名称的打开进程集合

3.  对照 thisProcess.Id 检查每个 process.Id，如果实例已打开，则至少 1 将匹配名称但不匹配 Id，否则继续打开实例

    ```
    using System.Diagnostics;

    .....    

    static void Main()
    {
       Process thisProcess = Process.GetCurrentProcess();
       foreach(Process p in Process.GetProcessesByName(thisProcess.ProcessName))
       {
          if(p.Id != thisProcess.Id)
          {
             // Do whatever u want here to alert user to multiple instance
             return;
          }
       }
       // Continue on with opening application 
    ```

完成此操作的一个很好的方法是将已经打开的实例呈现给用户，他们可能不知道它是打开的，所以让我们向他们展示它。为此，我使用 User32.dll 将一条消息广播到 Windows 消息传递循环中，一条自定义消息，我让我的应用程序在 WndProc 方法中侦听它，如果它收到此消息，它会将自己呈现给用户，Form .Show() 之类的。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-14T19:17:53.927

如果您想使用基于互斥锁的方法，您应该真正使用本地互斥锁来[将方法限制为仅当前用户的登录会话](http://www.yoda.arachsys.com/csharp/faq/#one.application.instance)。还要注意该链接中关于使用互斥锁方法进行强大的资源处理的另一个重要警告。

需要注意的是，基于互斥锁的方法不允许您在用户尝试启动第二个实例时激活应用程序的第一个实例。

另一种方法是 PInvoke 到 FindWindow，然后在第一个实例上使用 SetForegroundWindow。另一种选择是按名称检查您的进程：

```
Process[] processes = Process.GetProcessesByName("MyApp");
if (processes.Length != 1)
{
    return;
} 
```

后两种选择都有一个假设的竞争条件，其中应用程序的两个实例可以同时启动，然后相互检测。这在实践中不太可能发生 - 事实上，在测试期间我无法实现。

后两种选择的另一个问题是它们在使用终端服务时不起作用。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2015-07-28T06:45:08.313

使用具有超时和安全设置的应用程序，避免 AbandonedMutexException。我使用了我的自定义类：

```
private class SingleAppMutexControl : IDisposable
    {
        private readonly Mutex _mutex;
        private readonly bool _hasHandle;

        public SingleAppMutexControl(string appGuid, int waitmillisecondsTimeout = 5000)
        {
            bool createdNew;
            var allowEveryoneRule = new MutexAccessRule(new SecurityIdentifier(WellKnownSidType.WorldSid, null),
                MutexRights.FullControl, AccessControlType.Allow);
            var securitySettings = new MutexSecurity();
            securitySettings.AddAccessRule(allowEveryoneRule);
            _mutex = new Mutex(false, "Global\\" + appGuid, out createdNew, securitySettings);
            _hasHandle = false;
            try
            {
                _hasHandle = _mutex.WaitOne(waitmillisecondsTimeout, false);
                if (_hasHandle == false)
                    throw new System.TimeoutException();
            }
            catch (AbandonedMutexException)
            {
                _hasHandle = true;
            }
        }

        public void Dispose()
        {
            if (_mutex != null)
            {
                if (_hasHandle)
                    _mutex.ReleaseMutex();
                _mutex.Dispose();
            }
        }
    } 
```

并使用它：

```
 private static void Main(string[] args)
    {
        try
        {
            const string appguid = "{xxxxxxxx-xxxxxxxx}";
            using (new SingleAppMutexControl(appguid))
            {
                //run main app
                Console.ReadLine();
            }
        }
        catch (System.TimeoutException)
        {
            Log.Warn("Application already runned");
        }
        catch (Exception ex)
        {
            Log.Fatal(ex, "Fatal Error on running");
        }
    } 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2020-04-10T16:16:51.540

重要的是要记住，可以通过 Microsoft sysinternals 中的 handle.exe 等程序轻松查看此互斥体\事件，然后如果使用常量名称，邪恶的人可能会使用它来阻止您的应用程序启动。

以下是微软关于安全替代品建议的一些引用：

> 但是，恶意用户可以在您创建此互斥锁之前阻止您的应用程序启动。为防止出现这种情况，请创建一个随机命名的互斥体并将名称存储起来，以便只能由授权用户获取。或者，您可以为此目的使用文件。要将您的应用程序限制为每个用户一个实例，请在用户的配置文件目录中创建一个锁定文件。

取自这里： [https ://docs.microsoft.com/en-us/sysinternals/downloads/handle](https://docs.microsoft.com/en-us/sysinternals/downloads/handle)

# regex - 屏幕抓取：正则表达式还是 XQuery 表达式？

> ID：646484
> 
> 赞同：6
> 
> 时间：2009-03-14T18:55:13.510
> 
> 标签：regex, screen-scraping, xquery

我正在回答一些面试问题，问题是关于我将如何进行屏幕抓取。也就是说，从网页中挑选内容，假设您没有更好的结构化方式来直接查询信息（例如 Web 服务）。

我的解决方案是使用**XQuery**表达式。表达式相当长，因为我需要的内容在 HTML 层次结构中很深。在找到具有`id`属性的元素之前，我必须以公平的方式搜索祖先。例如，为 Product Dimensions 抓取 Amazon.com 页面如下所示：

```
//a[@id="productDetails"]
/following-sibling::table
//h2[contains(child::text(), "Product Details")]
/following-sibling::div
//li
/b[contains(child::text(), "Product Dimensions:")]
/following-sibling::text() 
```

这是一个非常讨厌的表达方式，但这就是亚马逊提供 Web 服务 API 的原因。无论如何，这只是一个例子。问题不是关于亚马逊，而是关于屏幕抓取。

面试官不喜欢我的解决方案。他认为它很脆弱，因为亚马逊对页面设计的更改可能需要重写 XQuery 表达式。调试与应用它的页面中的任何内容都不匹配的 XQuery 表达式是很困难的。

我并不反对他的说法，但我认为他的解决方案没有任何改进：他认为最好使用**正则表达式**，并在运输重量附近搜索内容和标记。例如，使用 Perl：

```
$html =~ m{<li>\s*<b>\s*Product Dimensions:\s*</b>\s*(.*?)</li>}s; 
```

我的反驳是，这也容易受到亚马逊更改其 HTML 代码的影响。他们可以用大写字母 ( ) 拼写 HTML 标签`<LI>`，或添加 CSS 属性或将标签“产品尺寸：”更改`<b>`或`<span>`更改为“尺寸：”或许多其他类型的更改。我的观点是，正则表达式并不能解决他在我的 XQuery 解决方案中指出的弱点。

但除此之外，正则表达式可能会发现误报，除非您为表达式添加足够的上下文。它还可能无意中匹配恰好位于注释、属性字符串或 CDATA 部分中的内容。

我的问题是，您使用什么技术来进行屏幕抓取？你为什么选择那个解决方案？有什么令人信服的理由使用一个吗？或者从不使用另一个？除了我上面展示的那些之外，还有第三种选择吗？

PS：为了论证起见，假设没有 Web 服务 API 或其他更直接的方式来获取所需的内容。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-14T19:06:02.033

我会使用正则表达式，但这只是因为大多数 HTML 页面不是有效的 XML，所以你永远不会让 XQUERY 工作。

我不知道 XQuery，但这对我来说就像一个 XPATH 表达式。如果是这样，其中有这么多“//”运算符看起来有点贵。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T19:01:19.567

由于经理给出的原因，我会使用正则表达式，再加上一些（更便携，更容易让外部程序员遵循等）。

您的反驳论点忽略了一点，即他的解决方案在*局部*变化方面很脆弱，而您的解决方案在*全球*变化方面很脆弱。任何破坏他的东西都可能破坏你的，但反之亦然。

最后，在他的解决方案中构建 slop / flex 要容易得多（例如，如果您必须处理输入中的多个细微变化）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-22T16:06:00.720

试试 JTidy 或 BeautifulSoup 对我来说效果很好。当然 // XPATH experssion 报废成本很高。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-14T19:08:50.763

我正在使用[BeautifulSoup](http://www.crummy.com/software/BeautifulSoup/)进行报废。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-14T19:11:07.827

实际上，我发现 CSS 搜索表达式比任何一个都更容易阅读。您选择的语言中可能至少存在一个库，可以解析页面并允许您编写 CSS 指令来定位特定元素。如果附近有适当的类或 ID 挂钩，则表达式非常简单。否则，抓住看起来合适的元素并遍历它们以找到您需要的元素。

至于脆弱，嗯，它们都是脆弱的。根据定义，屏幕抓取取决于该页面的作者，不会大幅改变其布局。使用可读且以后可以轻松更改的解决方案。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-14T19:53:43.917

屏幕抓取的非脆性解决方案？祝面试官好运：正则表达式抛弃了很多上下文并不意味着它们不那么脆弱：只是它们在其他方面很脆弱。脆弱性甚至可能不是一个缺点：如果源网页发生变化，如果您的解决方案发出警报，您通常会更好，而不是试图以一种聪明（且不可预测）的方式进行补偿。正如你所指出的。这些事情总是取决于你的假设：在这种情况下，取决于什么构成了可能的变化。

我更喜欢[HTML 敏捷包](http://www.codeplex.com/htmlagilitypack)：您可以容忍不符合 XHTML 的网页以及 XPath 的表达能力。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2010-01-23T19:50:39.393

正则表达式非常快，并且适用于非 XML 文档。这些都是针对 XQuery 的真正优点。但是我认为使用一些转换器到 XHTML 就像整洁并且可能更简单的 XQuery，就像你的最后一部分一样：

```
//b[contains(child::text(), "Product Dimensions:")]/following-sibling::text() 
```

是一个很好的选择。

问候，

[拉法尔·鲁辛](http://rrusin.blogspot.com)

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2012-12-30T05:17:04.107

要处理 html 页面，最好使用 HTMLAgilityPack（以及一些 Linq 代码）。这是解析所有元素和/或使用 XPath 进行直接搜索的好方法。在我看来，它比 RegEx 更准确，更容易编程。我以前有点不愿意使用它，但它很容易添加到您的项目中，我认为这是使用 html 的事实标准。[http://htmlagilitypack.codeplex.com/](http://htmlagilitypack.codeplex.com/)

祝你好运！

# vb.net - 数据访问层是静态的还是基于实例的？

> ID：646507
> 
> 赞同：6
> 
> 时间：2009-03-14T19:03:21.387
> 
> 标签：vb.net, .net-3.5, data-access-layer

我当前的应用程序正在使用基于实例的数据访问层。我用连接字符串实例化层。然后我调用一个方法来执行某种命令。例如，有一种方法可以填充数据集。基本上，我传递存储过程和任何 SQL 参数并取回数据集。有一个静态类来处理我的数据访问还是基于实例更好？我确实有一个包含对象的域层，但我没有像 ORM 那样映射对象。我将对象传递给工厂，然后实例化数据层以拉回数据集。然后我将数据集映射到对象。我计划更新我的应用程序（是的，迁移到 C#），但我没有时间改变整个事情。我对插入更新和删除做同样的事情。如果我现在所做的一切正常，请告诉我。您认为这种方法有什么问题吗？否则，我该怎么办？我没有写这门课。我在网上找到了它，并认为这是我需要的。

以下是数据类的示例：

```
Public Sub New(ByVal connectionString As String)
        _connectionString = connectionString
    End Sub

Public Function FillDataset(ByVal cmd As String, ByVal cmdType As CommandType, Optional ByVal parameters() As SqlParameter = Nothing) As DataSet
        Dim connection As SqlConnection = Nothing
        Dim command As SqlCommand = Nothing
        Dim sqlda As SqlDataAdapter = Nothing
        Dim res As New DataSet
        Try
            connection = New SqlConnection(_connectionString)
            command = New SqlCommand(cmd, connection)
            command.CommandType = cmdType
            AssignParameters(command, parameters)
            sqlda = New SqlDataAdapter(command)
            sqlda.Fill(res)
        Catch ex As Exception
            'CreateDataEntry(ex, WriteType.ToFile, cmd)
        Finally
            If Not (connection Is Nothing) Then connection.Dispose()
            If Not (command Is Nothing) Then command.Dispose()
            If Not (sqlda Is Nothing) Then sqlda.Dispose()
        End Try
        Return res
    End Function

         Public Function ExecuteNonQuery(ByVal spname As String, ByVal ParamArray parameterValues() As Object) As Object
        Dim connection As SqlConnection = Nothing
                    Dim command As SqlCommand = Nothing
        Dim res As Object = Nothing
        Try
            connection = New SqlConnection(_connectionString)
            command = New SqlCommand(spname, connection)
            command.CommandType = CommandType.StoredProcedure
            command.Parameters.AddRange(parameterValues)
            connection.Open()
            command.ExecuteNonQuery()
            res = command.Parameters(command.Parameters.Count - 1).Value
         Catch ex As Exception
            CreateDataEntry(ex, WriteType.ToFile, spname)
            If Not (transaction Is Nothing) Then
                transaction.Rollback()
            End If                
        Finally
            If Not (connection Is Nothing) AndAlso (connection.State = ConnectionState.Open) Then connection.Close()
            If Not (command Is Nothing) Then command.Dispose()                
        End Try
        Return res
    End Function 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-03-14T19:18:51.130

首先，我认为基于实例的方法是正确的。使用静态类会使对 DAL 进行单元测试以及在对其他类进行单元测试时模拟 DAL 变得更加困难。其次，我认为您应该重新考虑构建自己的 DAL。您将通过使用现有的（经过充分测试的）ORM（如 LINQtoSQL、nHibernate、nTier 甚至实体框架）在可能的情况下投入大量时间来创建、维护和测试 DAL，将更多时间花在直接有利于您的业务需求的代码。我已经完成了手工构建的 DAL 和 ORM，在我的例子中是 LINQtoSQL，我发现我花费更少的时间测试（和修复）我的 DAL 去 ORM 路线。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T00:10:16.000

实例基础更灵活。

您可以更轻松地更改底层技术（只需提供不同的实现）。

您还可以代理数据访问层。就我而言，我最近这样做是为了检查本地数据库中是否存在某些内容，如果没有，则从远程数据库获取它的副本，然后将其存储在本地。这对应用程序的其余部分完全透明。

# low-level - 可以使用寄存器的增量来确定时钟速率吗？

> ID：646512
> 
> 赞同：0
> 
> 时间：2009-03-14T19:06:01.037
> 
> 标签：low-level, cpu-architecture, cpu-registers, cpu-speed, clockrates

可以使用寄存器的增量（在循环中）来确定（有效）时钟速率吗？我很自然地认为它可以，但有人评论说 Cpu 可能会植入超标量技术，使这种计算变得无用。另外有人告诉我，CPU 上的寄存器的递增可以在不到一个时钟周期内完成。

是真的吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T19:16:51.977

不，不可靠。增加寄存器所需的周期数可能因不同类型的处理器而异，并且您还必须包括循环的开销。在任何现代操作系统中，您都将不得不处理抢占式多任务，因此您不知道进程调度程序将为您提供多少 CPU 时间。根据其他进程正在执行的工作量，您可能会获得很多或很少的 CPU 时间，因此您每秒可以执行的寄存器增量的数量是高度可变的。

此外，在多核环境中，时钟可能不会以相同的速率滴答作响。如果您的进程由于某种原因被调度程序在内核之间移动，您的时钟频率可能会发生不可预测的变化。

有更好的方法来获取时钟频率，例如向操作系统询问（当然，如何做到这一点因操作系统而异）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T19:14:07.040

不，您不能使用它来确定时钟速率。不能保证每个时钟可以精确地递增一次寄存器。

你的目标是什么CPU？至少在 x86 上，有更明确的方法来确定时钟频率。

# python - 在 pypi 包索引上查找包版本的优雅方法是什么？

> ID：646515
> 
> 赞同：4
> 
> 时间：2009-03-14T19:07:17.117
> 
> 标签：python, package, search, pypi

目前我正在使用一种基于正则表达式的非常丑陋的方法来查找链接并将它们分开。

我对代码不满意，所以我要求更好的解决方案，最好只使用stdlib。

### 编辑

手头的任务有两个部分：

1.  查找符合特定条件（如名称前缀）的所有分布。
2.  查找每个找到的发行版中可用的所有版本。

预期的结果是分布 -> 版本 -> 文件的映射。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-15T13:02:06.363

有一个 XML-RPC 接口。请参阅[Cheese Shop（PyPi 的旧名称）API 上的 Python.org wiki 页面](http://wiki.python.org/moin/PyPiXmlRpc?action=show&redirect=CheeseShopXmlRpc)。

摘自该维基：

```
>>> import xmlrpclib
>>> server = xmlrpclib.Server('http://pypi.python.org/pypi')
>>> server.package_releases('roundup')
['1.1.2']
>>> server.package_urls('roundup', '1.1.2')
[{'has_sig': True, 'comment_text': '', 'python_version': 'source', 'url': 'http://pypi.python.org/packages/source/r/roundup/roundup-1.1.2.tar.gz', 'md5_digest': '7c395da56412e263d7600fa7f0afa2e5', 'downloads': 2989, 'filename': 'roundup-1.1.2.tar.gz', 'packagetype': 'sdist', 'size': 876455}, {'has_sig': True, 'comment_text': '', 'python_version': 'any', 'url': 'http://pypi.python.org/packages/any/r/roundup/roundup-1.1.2.win32.exe', 'md5_digest': '983d565b0b87f83f1b6460e54554a845', 'downloads': 2020, 'filename': 'roundup-1.1.2.win32.exe', 'packagetype': 'bdist_wininst', 'size': 614270}] 
```

`list_packages`并且`package_releases`似乎正是您正在寻找的。

### @罗尼的评论

您只需要在 Python 中编写一些代码来确定列出的哪些包满足标准；即如果包名必须以`foo`：

```
>>> packages = server.list_packages()
>>> match_foo = [package for package in packages if package.startswith('foo')]
>>> print len(match_foo)
2 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2011-10-10T15:08:34.557

我们将在短期内将 distutils2 发布到 PyPI。它包含一个 distutils2.pypi 模块，它可以让你从 Python 代码中搜索 PyPI 和一个 pysetup 程序，它是一个命令行脚本来做同样的事情（等等）。该文档仍在进行中，但有一些示例和 API 参考：

*   [http://docs.python.org/dev/library/packaging.pypi.simple](http://docs.python.org/dev/library/packaging.pypi.simple)
*   [http://docs.python.org/dev/library/packaging.pypi.xmlrpc](http://docs.python.org/dev/library/packaging.pypi.xmlrpc)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2012-11-07T17:27:20.807

很不幸，但由于其他索引上缺少 xmlrpc，我需要保留我的解决方案

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-03-14T19:15:17.863

在访问 pypi 的构建中，我将版本固定如下：

Products.PloneFormGen==1.2.5

在这里它搜索版本 1.2.5 并使用 this..

不知道这是不是你要找的...

# c# - 在 C# 中使用泛型时的装箱

> ID：646517
> 
> 赞同：12
> 
> 时间：2009-03-14T19:09:50.917
> 
> 标签：c#, generics

我有以下简单的 C# 代码：

```
private Stack<Person> m_stack = new Stack<Person>();

public void Add<T>(T obj)
  where T : Person
{
     m_stack.Push(obj);
} 
```

这将产生以下 IL 代码：

```
 .method public hidebysig instance void 
          Add<(ConsoleApplication1.Person) T>(!!T obj) cil managed
  {
    // Code size       20 (0x14)
    .maxstack  8
    IL_0000:  nop
    IL_0001:  ldarg.0
    IL_0002:  ldfld      class [System]System.Collections.Generic.Stack`1<class ConsoleApplication1.Person> ConsoleApplication1.Pool::m_stack
    IL_0007:  ldarg.1
    IL_0008:  box        !!T
    IL_000d:  callvirt   instance void class [System]System.Collections.Generic.Stack`1<class ConsoleApplication1.Person>::Push(!0)
    IL_0012:  nop
    IL_0013:  ret
  } // end of method Pool::Add 
```

所以我的问题是……为什么要拳击？（IL_0008）我可以理解向下转换甚至编译错误，但是为什么要装箱（Person 是引用类型...）

提前致谢！

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-03-14T19:47:21.857

Excerpt from Ecma-335 Partition III 4.1

> If *typeTok* is a reference type, the box instruction does nothing.

where *typeTok* is *!!T* in your case.

My guess is that when the compiler compiles the code, it always calls *box* regardless whether the type of the operand is reference type or not. Because of the semantic of the *box* instruction, the desired result is always guaranteed.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T19:16:31.510

我相信这是对您执行此操作的通用方法约束-但是...

无论如何，根本不需要泛型方法。只需将其写为：

```
`public void Add(Person person)
{
    m_stack.Push(person);
}` 
```

`你会发现 IL 被简化了，并且完全避免了这个问题。如果您要限制特定的引用类型，则可以只使用该引用类型。`

 `这更容易理解，也更清楚。除非确实需要，否则我建议避免使用通用方法调用。泛型方法使类不那么明显，这意味着从长远来看，可读性和可维护性较差，并且更难使用。

# python - Python：如何检测调试解释器

> ID：646518
> 
> 赞同：12
> 
> 时间：2009-03-14T19:10:14.613
> 
> 标签：python, debugging

我如何在我的 python 脚本中检测它是否由调试解释器运行（即 python_d.exe 而不是 python.exe）？我需要更改传递给扩展的一些 dll 的路径。

例如，我想在我的 python 脚本开始时做这样的事情：

```
#get paths to graphics dlls
if debug_build:
    d3d9Path   = "bin\\debug\\direct3d9.dll"
    d3d10Path  = "bin\\debug\\direct3d10.dll"
    openGLPath = "bin\\debug\\openGL2.dll"
else:
    d3d9Path   = "bin\\direct3d9.dll"
    d3d10Path  = "bin\\direct3d10.dll"
    openGLPath = "bin\\openGL2.dll" 
```

我考虑在扩展中添加一个“IsDebug()”方法，如果它是调试版本（即使用“#define DEBUG”构建），它将返回 true，否则返回 false。但这似乎有点像我确定我可以让 python 告诉我的东西......

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-15T04:39:26.650

[Distutils 用于`sys.gettotalrefcount`检测调试 python 构建](http://bugs.python.org/file2086/build.py.diff)：

```
# ...
if hasattr(sys, 'gettotalrefcount'):
   plat_specifier += '-pydebug' 
```

*   此方法不依赖于可执行名称“ `*_d.exe`”。它适用于任何名称。
*   这种方法是跨平台的。它不依赖于 ' `_d.pyd`' 后缀。

请参阅[调试构建](http://docs.python.org/c-api/intro.html#debugging-builds)和[Misc/SpecialBuilds.txt](http://svn.python.org/view/python/trunk/Misc/SpecialBuilds.txt?view=markup)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T20:25:31.890

更好，因为当您运行嵌入式 Python 解释器时它也可以工作是检查返回值

```
imp.get_suffixes() 
```

对于调试版本，它包含一个以“_d.pyd”开头的元组：

```
# debug build:
[('_d.pyd', 'rb', 3), ('.py', 'U', 1), ('.pyw', 'U', 1), ('.pyc', 'rb', 2)]

# release build:
[('.pyd', 'rb', 3), ('.py', 'U', 1), ('.pyw', 'U', 1), ('.pyc', 'rb', 2)] 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-14T19:24:01.803

一个简单的方法，如果你不介意依赖文件名：

```
if sys.executable.endswith("_d.exe"):
  print "running on debug interpreter" 
```

[您可以在此处](http://docs.python.org/library/sys.html)阅读有关该`sys`模块及其各种设施的更多信息。

# iphone - 如何覆盖 UIViewController 中的“视图”属性？

> ID：646521
> 
> 赞同：29
> 
> 时间：2009-03-14T19:13:05.263
> 
> 标签：iphone, cocoa-touch, uiview, uiviewcontroller

我有一个自定义 UIViewController 和自定义 UIView。我想覆盖 viewcontroller.view 属性以返回 MyCustomUIView。

现在我有：

```
@interface MyViewController : UIViewController {    
    IBOutlet MyView* view;
}

@property (nonatomic, retain) IBOutlet MyView* view; 
```

这可以编译，但我收到警告：属性“视图”类型与超类“UIViewController”属性类型不匹配。

如何缓解此警告？

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2013-05-07T16:03:34.210

@lpaul7 已经发布了 Travis Jeffery 博客的链接作为评论，但它比所有其他答案更正确，它确实需要代码作为答案：

**视图控制器.h：**

```
@interface ViewController : UIViewController

@property (strong, nonatomic) UIScrollView *view;

@end 
```

**视图控制器.m：**

```
@implementation ViewController

@dynamic view;

- (void)loadView {
  self.view = [[UIScrollView alloc] initWithFrame:[[UIScreen mainScreen] applicationFrame]];
}

@end 
```

如果您使用 xib，而不是覆盖`loadView`更改视图控制器的根视图的类型并添加`IBOutlet`到属性中。

有关详细信息，请参阅[重写 UIViewController 的 View 属性，正确完成](http://travisjeffery.com/b/2012/12/overriding-uiviewcontrollers-view-property-done-right/)。

* * *

## 回答 #2

> 赞同：18
> 
> 时间：2009-03-14T19:48:22.027

简短的回答是你没有。原因是属性实际上只是方法，如果你试图改变返回类型，你会得到：

*   (UIView *) 视图；
*   （我的视图 *）视图；

Objective-C*不允许*返回类型协变。

您可以做的是添加一个新属性“myView”，并使其简单地对“view”属性进行类型转换。这将减轻整个代码中的类型转换。只需将您的视图子类分配给视图属性，一切都会正常工作。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-14T19:49:38.637

UIViewController 的视图属性/方法将自动返回您的视图。我认为您只需将结果转换为 MyView （或仅使用 id 类型）：

```
MyView *myView = (MyView*)controller.view;
id myView = controller.view; 
```

我认为您在上面发布的代码会给您带来麻烦。您可能不想自己创建视图成员（因为控制器将存储 2 个视图，并且可能不会在内部使用正确的视图）或覆盖视图属性（因为 UIViewController 对其进行了特殊处理。）（请参阅[此有关](https://stackoverflow.com/questions/640904/why-is-this-iphone-program-not-calling-loadview)后者的更多信息的问题。）

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-04-25T22:35:23.657

对不起，但你的简短回答是错误的。

正确的实现是使用您的返回类型将@property 添加到头文件。然后手动添加 getter 和 setter 而不是 @synthesize，并从 [super view] 返回一个强制转换类型

例如我的类是 PlayerViewController

播放器视图控制器.h

```
@property (strong, nonatomic) IBOutlet PlayerView *view; 
```

播放器视图控制器.m

```
- (PlayerView *)view{
    return (PlayerView*)[super view];
}
- (void)setView:(PlayerView *)view{
    [super setView:view];
} 
```

重要的是把正确的类放到视图中。

将 UIView 放在 PlayerView 所在的位置可能会在 Interface Builder 中工作，但在代码中无法正常运行。

我目前正在使用这个实现。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-10-14T04:19:17.297

如果有人使用 Swift 2.0+，您可以使用协议扩展来实现可重用：

```
// Classes conforming to this protocol...
protocol CustomViewProvider {

    typealias ViewType
}

// ... Will get customView accessor for free
extension CustomViewProvider where Self: UIViewController, Self.ViewType: UIView {

    var customView: Self.ViewType {
        return view as! Self.ViewType
    }
}

// Example:
extension HomeViewController: CustomViewProvider {
    typealias ViewType = HomeView
}

// Now, we can do something like
let customView: HomeView = HomeViewController().customView 
```

# c# - 在 ASP.NET 中获取服务器的 IP 地址？

> ID：646525
> 
> 赞同：44
> 
> 时间：2009-03-14T19:15:42.790
> 
> 标签：c#, asp.net, dns, referrer

如何获取调用我的 ASP.NET 页面的服务器的 IP 地址？我见过关于 Response 对象的东西，但在 c# 中我很新。万分感谢。

* * *

## 回答 #1

> 赞同：66
> 
> 时间：2009-03-14T19:20:43.280

这应该有效：

```
 //this gets the ip address of the server pc

  public string GetIPAddress()
  {
     IPHostEntry ipHostInfo = Dns.GetHostEntry(Dns.GetHostName()); // `Dns.Resolve()` method is deprecated.
     IPAddress ipAddress = ipHostInfo.AddressList[0];

     return ipAddress.ToString();
  } 
```

[http://wec-library.blogspot.com/2008/03/gets-ip-address-of-server-pc-using-c.html](http://wec-library.blogspot.com/2008/03/gets-ip-address-of-server-pc-using-c.html)

或者

```
 //while this gets the ip address of the visitor making the call
  HttpContext.Current.Request.UserHostAddress; 
```

[http://www.geekpedia.com/KB32_How-do-I-get-the-visitors-IP-address.html](http://www.geekpedia.com/KB32_How-do-I-get-the-visitors-IP-address.html)

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2012-07-18T13:22:44.073

`Request.ServerVariables["LOCAL_ADDR"];`

这为多宿主服务器提供了请求进入的 IP

* * *

## 回答 #3

> 赞同：14
> 
> 时间：2010-02-10T19:08:17.990

上面的方法很慢，因为它需要一个 DNS 调用（如果一个不可用，显然不会工作）。您可以使用下面的代码获取当前 pc 的本地 IPV4 地址及其相应子网掩码的映射：

```
public static Dictionary<IPAddress, IPAddress> GetAllNetworkInterfaceIpv4Addresses()
{
    var map = new Dictionary<IPAddress, IPAddress>();

    foreach (var ni in NetworkInterface.GetAllNetworkInterfaces())
    {
        foreach (var uipi in ni.GetIPProperties().UnicastAddresses)
        {
            if (uipi.Address.AddressFamily != AddressFamily.InterNetwork) continue;

            if (uipi.IPv4Mask == null) continue; //ignore 127.0.0.1
            map[uipi.Address] = uipi.IPv4Mask;
        }
    }
    return map;
} 
```

*警告：这还没有在 Mono 中实现*

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2011-04-04T11:30:27.967

```
 //this gets the ip address of the server pc
  public string GetIPAddress()
  {
     string strHostName = System.Net.Dns.GetHostName();
     //IPHostEntry ipHostInfo = Dns.Resolve(Dns.GetHostName()); <-- Obsolete
     IPHostEntry ipHostInfo = Dns.GetHostEntry(strHostName);
     IPAddress ipAddress = ipHostInfo.AddressList[0];

     return ipAddress.ToString();
  } 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2015-06-15T12:56:44.737

这适用于 IPv4：

```
public static string GetServerIP()
{            
    IPHostEntry ipHostInfo = Dns.GetHostEntry(Dns.GetHostName());

    foreach (IPAddress address in ipHostInfo.AddressList)
    {
        if (address.AddressFamily == AddressFamily.InterNetwork)
            return address.ToString();
    }

    return string.Empty;
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-09-05T11:17:06.863

下面的快照取自[Mkyong](https://www.mkyong.com/computer-tips/how-to-view-http-headers-in-google-chrome/)以在谷歌浏览器中显示开发人员控制台内的网络选项卡。在**“请求标头”**选项卡中，您可以看到所有服务器变量的列表，如下所示：

[![在此处输入图像描述](https://i.stack.imgur.com/dSrfo.png)](https://i.stack.imgur.com/dSrfo.png)

下面是几行代码，它们获取访问您的应用程序的客户端的 IP 地址

```
//gets the ipaddress of the machine hitting your production server              
string ipAddress = HttpContext.Current.Request.ServerVariables["HTTP_X_FORWARDED_FOR"]; 

if (ipAddress == "" || ipAddress == null)  
{                                     
  //gets the ipaddress of your local server(localhost) during development phase                                                                         
  ipAddress = HttpContext.Current.Request.ServerVariables["REMOTE_ADDR"];              
}

//Output:                                                                           
For production server - 122.169.106.247 (random)
For localhost         - ::1 
```

# delphi - 如何判断 Delphi 控件当前是否可见？

> ID：646527
> 
> 赞同：10
> 
> 时间：2009-03-14T19:16:18.407
> 
> 标签：delphi, custom-controls, visible, paint

我需要一种方法来让自定义控件（从 TCustomControl 继承）来判断它当前是否可见。我不是在谈论 .Visible 属性；我的意思是它现在是否真的显示在屏幕上。有谁知道如何做到这一点？

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-16T18:39:03.487

几年前，我遇到了同样的表单问题：我一直在寻找一种方法来确定表单是否对用户真正可见（甚至只是部分可见）。
特别是当它应该是可见的并且 Showing 是 True 但窗口实际上完全在另一个窗口后面时。
这是代码，它可以适用于 WinControl ...

```
{----------------------------------------------------------}
function IsMyFormCovered(const MyForm: TForm): Boolean;
var
   MyRect: TRect;
   MyRgn, TempRgn: HRGN;
   RType: Integer;
   hw: HWND;
begin
  MyRect := MyForm.BoundsRect;            // screen coordinates
  MyRgn := CreateRectRgnIndirect(MyRect); // MyForm not overlapped region
  hw := GetTopWindow(0);                  // currently examined topwindow
  RType := SIMPLEREGION;                  // MyRgn type

// From topmost window downto MyForm, build the not overlapped portion of MyForm
  while (hw<>0) and (hw <> MyForm.handle) and (RType <> NULLREGION) do
  begin
    // nothing to do if hidden window
    if IsWindowVisible(hw) then
    begin
      GetWindowRect(hw, MyRect);
      TempRgn := CreateRectRgnIndirect(MyRect);// currently examined window region
      RType := CombineRgn(MyRgn, MyRgn, TempRgn, RGN_DIFF); // diff intersect
      DeleteObject( TempRgn );
    end; {if}
    if RType <> NULLREGION then // there's a remaining portion
      hw := GetNextWindow(hw, GW_HWNDNEXT);
  end; {while}

  DeleteObject(MyRgn);
  Result := RType = NULLREGION;
end;

function IsMyFormVisible(const MyForm : TForm): Boolean;
begin
  Result:= MyForm.visible and
           isWindowVisible(MyForm.Handle) and
           not IsMyFormCovered(MyForm);
end; 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T20:05:09.287

您能否将代码附加到 OnPaint 事件？这经常被调用，我认为只有在实际绘制控件时才会调用（例如，以您的意思可见）。

# encryption - 加密的 JDBC 连接

> ID：646531
> 
> 赞同：2
> 
> 时间：2009-03-14T19:17:45.563
> 
> 标签：encryption, jdbc

我在互联网上的数据库上做了很多工作。我的公司正在制定不发送任何非加密信息（包括普通 JDBC）的政策。我目前连接到 MS SQL Server 和 IBM DB2 数据库（LUW 和 AS/400）。有没有一种简单的方法来加密/解密这些连接？

编辑：找到一篇有趣且相对简单的 SSH 隧道文章，可能会有所帮助。 [http://www.ibm.com/developerworks/data/library/techarticle/dm-0312lurie/index.html](http://www.ibm.com/developerworks/data/library/techarticle/dm-0312lurie/index.html)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-14T19:42:48.063

如果您的数据库也支持 SSL 和您的 JDBC 驱动程序，也许 JDBC over SSL。快速谷歌搜索显示 Microsoft SQL Server JDBC Driver 1.2 支持 SSL 加密，IBM DB2 JDBC Driver 9.1 包括对同样支持 SSL 的数据库服务器的 SSL 支持。

一些链接：

*   [SQL Server 2005 JDBC 驱动程序 v1.2 八月 CTP 上线](http://blogs.msdn.com/jdbcteam/archive/2007/09/04/sql-server-2005-jdbc-driver-v1-2-aug-ctp-is-live.aspx)(2007-09-04)
*   [Microsoft SQL Server JDBC 1.2 驱动程序中的 SSL](http://blogs.msdn.com/bindeshv/archive/2008/02/04/ssl-in-microsoft-sql-server-jdbc-1-2-driver.aspx) (2008-02-04)
*   [V9.1 的新增功能：JDBC 和 SQLJ 增强](http://publib.boulder.ibm.com/infocenter/db2luw/v9/index.jsp?topic=/com.ibm.db2.udb.rn.doc/doc/c0023512.htm)(2008-10-01)

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2015-08-05T17:02:04.533

我会使用带有公钥认证或 VPN 网络的 SSH 隧道。这样，您可以在应用程序/数据库之外定义加密，并添加额外的身份验证层。

然后确保 MySQL 仅在 localhost 或 VPN 接口上侦听（或仅允许连接）。

然后，您的 JDBC 连接 URL 只需连接到 localhost:[TUNNEL_PORT]

您不需要为加密配置 JDBC 或 MySQL 的额外开销。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-14T19:41:47.987

文件：

对于 DB2：[用于 JDBC 和 SQLJ 的 IBM DB2 驱动程序](http://publib.boulder.ibm.com/infocenter/db2luw/v9/index.jsp?topic=/com.ibm.db2.udb.apdv.java.doc/doc/rjvdsprp.htm) 的属性（查看属性 sslConnection）
对于 MSSQL：[使用 SSL 加密](http://msdn.microsoft.com/en-us/library/bb879935.aspx)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T19:39:07.323

不知道那些数据库，但是可以设置 oracle 来加密它发送的连接数据（我认为它接收）。标准的 oracle jdbc jar 无需任何客户端配置或编程更改即可处理加密数据。

另外-如果您使用VPN通过互联网连接到您的数据库，那么无论如何这都会被加密，不是吗？

# python - In what way would you present an algorithm to detect collisions between different objects?

> ID：646539
> 
> 赞同：3
> 
> 时间：2009-03-14T19:21:13.137
> 
> 标签：python, collision-detection

While working on a really only-for-fun project I encountered some problem.

There is a 2D world populated with Round Balls, Pointy Triangles and Skinny Lines (and other wildlife too, maybe). They all are subclasses of WorldCreatures. They can move inside this world. When they meet each other, a Collision happens.

The thing I'd like to do is to make a way of detecting Collision between them. Here's what I'm standing on right now:

*   For me Ball-Ball is easy, I just calculate their distance from their positions and compare it with the sum of their 'sizes'.
*   Collision between Ball and edge of the world is simple too - I just check the distance from it, which, in Cartesian coordinates, is simple.
*   More generic problems are - how to detect a collision between Line (starting and ending at some points) or other objects I could have there? Distance between a line and a point can be calculated easily too, but what I'd like is to have

Some kind of generic way to say if Object `A` collides with Object `B`. The code as it is now looks somewhat like:

```
class WorldCreature:
    def detectCollision(self, otherObject):
        # do something 
        if collision:
            self.onCollision(otherObject)
            otherObject.onCollision(self)
class Ball(WorldCreature):
    # someing here
class Line(WorldCreature):
    # someing here 
```

Now, the collision detection mechanizm should depend on what objects can collide. So will the effect.

Should I just keep a list of all the objects in memory and loop through all them in *every single* step? Or, is there some better way to improve the performance of this task?

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-14T19:24:59.697

Use a [quadtree](http://en.wikipedia.org/wiki/Quadtree). They're used to eliminate large regions that you know are outside a collision radius, plus they let you quickly search for the closest point.

As far as actual collision detection goes, since you're only using convex objects, take a look at [Metanet Software's tutorial](http://www.metanetsoftware.com/technique/tutorialA.html) on [the separating axis theorem](http://en.wikipedia.org/wiki/Separating_axis_theorem). In their flagship game, they actually use a grid to find all the objects to check for collision against, but it shouldn't be too hard to use a quadtree instead.

(I remember reading an article on quadtrees that used circles in a grid to illustrate how you can find the points within a radius. I can't seem to find it though.)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T19:30:03.833

The answer to this depends on a number of factors, such as how many objects there are, how many are moving vs. non-moving, how fast they move, etc. I think that the right place to start is by getting the core collision detection and behavior code correct while ignoring the optimizations you might do to prune collision checks, etc.

Once the core code is correct, you can start running experiments to see what will perform well for you. I would recommend some kind of spatial subdivision technique, such as kd-trees (although in 2d, you may as well use quadtrees).

Fundamentally, though, there's probably no single right answer, except what you are able to determine by coding up your game and experimenting with it.

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-03T22:18:52.967

Python. Kinda strange beast for me 8)

I have c++ experience creating games -- so I talk from this point of view.

First of all (you can skip this if you have low number of objects) you need broad-phase collision detection. Already mentioned quadtree is just one possible implementation. Broad-phase is needed to find pairs of possibly colliding objects.

Then goes the narrow phase -- when pairs are checked.

I used the following scheme (note -- this was created with primitives in mind, if you need polyhedra collisions -- just use GJK and spheres, plus rays,segments):

Everything that needs collisions have CollisionObject which handles transform and store CollisionPrimitive (box, sphere etc)

Each CollisionPrimitive has type_id -- when you write A_B_CheckIntersection -- the first object always have lower type_id

For each Pair in the list that you get from broad phase -- you swap objects if needed and index an array where pointers to specific collision functions are stored. Sure -- for that you should have them have identical interfaces (c++) but it is easy 8)

As for specific collision routines: visit [http://realtimerendering.com/intersections.html](http://realtimerendering.com/intersections.html) It is good place to start

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T19:46:19.443

I think [**Hough Transform**](http://en.wikipedia.org/wiki/Hough_transform) should help somehow.

# bug-tracking - 适用于 Windows 的最佳免费软件缺陷跟踪软件？

> ID：646542
> 
> 赞同：8
> 
> 时间：2009-03-14T19:23:26.283
> 
> 标签：bug-tracking, defects

我正在寻找免费软件缺陷跟踪解决方案。我有使用 Mercury Quality Center 的经验，但我听说它带有五位数的价格标签。我的个人项目需要一些东西。Webforms（即 ASP.NET）将是可取的。外面有什么好东西吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-14T20:02:56.703

我不喜欢 BugZilla，它非常强大，但用户界面很糟糕。我推荐[Mantis](http://www.mantisbt.org/)或[Trac](http://trac.edgewall.org/)。我的篮子里没有 ASP.NET。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-14T19:28:24.790

如果它仅供您使用，您可以免费获得一个[Fogbugz](http://www.fogcreek.com/FogBugz/)帐户。但它只允许最多 2 个用户，同时仍然是免费的。

我目前正在和朋友一起将它用于我的高级项目

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-14T20:59:57.377

我和[螳螂](http://www.mantisbt.org/)的支持者在一起。我们在团队中采用它来迁移非常旧的[TeamTrack](http://www.serena.com/products/teamtrack/)版本，我们对此印象非常深刻。但是，我们非常接近于使用[Trac](http://trac.edgewall.org/)。

还有[Jira](http://www.atlassian.com/software/jira/)，男孩，如果我们只有钱买它，我们会在心跳中使用它。在我审查过的所有问题跟踪器中，没有一个能与 JIRA 的流动性和灵活性相近，同时仍然很好地支持基本功能。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-14T19:26:58.193

您可以使用[Bugzilla](http://www.bugzilla.org/)。它是开源的，很多项目都使用它。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-14T20:00:28.427

我真的很喜欢[螳螂](http://www.mantisbt.org/)。它不如 Bugzilla 强大，但您可以轻松地让它运行并快速配置您喜欢的方式。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-14T20:04:01.210

Jira 还提供[个人许可证](http://www.atlassian.com/software/jira/personal.jsp)。它不是基于 asp.net 的，但它很容易安装，而且由于您不会在其上进行开发，因此构建它所使用的技术应该无关紧要。

[Trac](http://trac.edgewall.org/)是一个免费的选项，无论用户数量如何。如果你使用颠覆，Trac 与它有很好的集成。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-01-15T14:54:04.367

我偏爱[Eventum by MySQL](http://dev.mysql.com/downloads/other/eventum/)。免费、轻量级、高度可配置，我几乎在所有项目中都使用过它。

# asp.net - How to Deploy/Publish an ASP.NET website?

> ID：646551
> 
> 赞同：11
> 
> 时间：2009-03-14T19:27:24.853
> 
> 标签：asp.net, deployment, asp.net-2.0

Is there any easy way to Deploy/Publish a website written in asp.net ? And what is the difference between deploy and publish ?

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-14T19:31:54.670

Here is a site that shows different techniques how to accomplish this task. There are many techniques that can be utilized as a deployment strategy for your web application.:

[Beansoftware How to Deploy ASP.NET Web Application](http://www.beansoftware.com/ASP.NET-Tutorials/Deploy-ASP.NET.aspx)

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-14T19:47:35.493

**Alt + B + H** combination (opens publish window for ASP.NET web site / application) is the most simple way to deploy an application to the required location.

Publish used for compiling and deploying application to server.

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-03-14T20:02:20.637

好吧，这取决于您从正常运行时间/可用性的角度要完成的工作。publish/xcopy/installer 选项很有趣，但都忽略了解决这些选项需要时间才能完成的问题。从第一个文件被复制到目录中到最后一个文件在站点中被复制的时间处于不一致的状态。

ASPX 文件可能引用尚未在 bin 目录中的数据层对象，或者 bin 目录可能有一个 DLL，其中一个函数的参数集已更改，但尚未安装 aspx，所以aspx 仍在寻找旧功能。简而言之，因为部署不是一个原子过程，您可以/将会遇到问题。

我们通过将新文件安装到新目录，然后进入 IIS 并将网站更改为指向新目录来解决此问题。这使更改成为一个原子过程，并使事情变得更加顺利。完美吗？没有。您可能会遇到视图状态问题或会话问题（会话被保留，但新代码可能会在会话中查找旧代码未设置的内容），但它仍然使过程更加顺畅。

当然，这些解决方案都没有解决升级网站的其他非原子部分......数据库。同样，更改数据库模式的过程需要时间。你是先升级代码还是先升级数据库？数据库更改可以在没有代码更改的情况下工作（支持 null 或具有默认值的新列）还是代码更改可以在没有数据库更改的情况下工作（删除列）？这是一个个案分析，任何这些解决方案都没有解决

当然，如果您可以在一段时间内将您的用户踢出网站，那么生活会更轻松，但如果您想实现 100% 的正常运行时间，那就没那么简单了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-11-02T22:20:01.613

有时将 Web Publish 设置为您想要的目标是不切实际的。如果是这种情况，您可能仍然能够发布到本地计算机（如下所述），然后 XCOPY 部署到您的目标。

1.  在 IIS 中右键单击站点，然后单击添加网站
2.  如图所示设置一个新网站，然后单击确定 [![在此处输入图像描述](https://i.stack.imgur.com/F8SP4.jpg)](https://i.stack.imgur.com/F8SP4.jpg)
3.  在 Visual Studio（以管理员权限运行）中，右键单击您的 ASP.NET Web 项目，选择发布...
4.  单击配置文件标题，然后从下拉列表中选择新建自定义配置文件...
5.  输入配置文件名称，如“localhost44321”，如图所示设置配置文件，然后单击发布 [![在此处输入图像描述](https://i.stack.imgur.com/CDBlR.jpg)](https://i.stack.imgur.com/CDBlR.jpg)

# c++ - 两个包含 main() Visual Studio 定义的文件？

> ID：646559
> 
> 赞同：8
> 
> 时间：2009-03-14T19:31:00.757
> 
> 标签：c++, visual-studio, visual-studio-2008

我在 Visual Studio 2008 Professional Edition 中创建了一个项目。

该项目包含一个 .cpp 文件，用于像这样的每个作业...

```
[-]Source Files
   \
   |-- 233.cpp
   |-- test.cpp 
```

**每个文件都包含 main() 的定义。**

操作：CTRL+F5

```
Error   1   error LNK2005: _main already defined in 233.obj test.obj
Error   2   fatal error LNK1169: one or more multiply defined symbols found 
```

**如何编译并查看每个文件的输出？**

谢谢。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-14T19:33:07.680

在一个项目中不能有两个名为 main() 的函数。您应该做的是更改函数的名称，然后从一个新的 main() 函数调用它们，该函数将用作菜单。

如果将它们设为单独的项目，则可以使用解决方案属性 -> 启动项目切换要运行的项目。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T22:27:48.307

我猜在您的情况下，您的项目仅包含一个文件。如果您想单独编译它们，那么我建议：

*   为每个项目创建单独的项目（CSPROJ）文件
*   使用命令行编译器 CSC 分别编译这些文件
*   或（根据建议）将您当前的 Main 方法重命名为 Run 方法，创建一个名为 Program.cs 的单独文件，其中仅包含 Main 方法，并从此方法调用特定的 Run 方法（取决于您要执行的任务）

# jquery - 如何从字段中删除“另一个就地编辑器”（jQuery inplace.js 插件）

> ID：646567
> 
> 赞同：0
> 
> 时间：2009-03-14T19:35:04.040
> 
> 标签：jquery, jquery-plugins, edit-in-place

我可以设置就地编辑器没问题，一切都很好，但是一旦它附加到一个字段，我还没有找到一种方法来删除它，有人知道怎么做吗？

我在这里谈论这个插件：[http ://www.davehauenstein.com/code/jquery-edit-in-place/](http://www.davehauenstein.com/code/jquery-edit-in-place/)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-15T04:01:20.907

我想你的意思是你想禁用就地编辑器。

我从未使用过此插件，但我在网站上没有看到任何代码示例导致您相信您要求的行为已实现。

如果不是，也许您可​​以使用旧的 div 缓存技巧：

```
$.fn.disableWithADiv() {
    var element = $(this);
    var pos = element.offset();
    $("body").append($("<div />").css({
        "position": "absolute",
        "z-index": 1000,
        "left": pos.left+"px",
        "top": pos.top+"px",
        "width": element.width(),
        "height": element.height(),
        "display": "block"
    }).attr("id",element.attr("id")+"-div-disabler"));
}

$.fn.removeDivDisabler() {
    var element = $(this);
    $("#"+element.attr("id")+"-div-disabler").remove();
} 
```

然后使用

```
$("#yourElement").disableWithADiv();   // To disable
$("#yourElement").removeDivDisabler(); // To re-enable 
```

如果一切按计划进行，则 div 将代替您的元素捕获点击事件，并且就地编辑器将永远不会打开。

那是我的想法，不确定那里没有错字或主要的逻辑缺陷；）

编辑：

嗯，有一个问题......这两个函数的主体应该封装到这个构造中：

```
return this.each(function() {
    // Body here
}); 
```

傻我。

# algorithm - pseudo code for finding closed paths in a graph

> ID：646569
> 
> 赞同：-1
> 
> 时间：2009-03-14T19:38:55.123
> 
> 标签：algorithm, graph-theory, pseudocode

I have an adjaceny matrix for a graph which tracks the edges between the nodes by having a 1 in the corresponding adjMat[i,j] = 1; Through this adjaceny matrix i wish to find out all the closed paths of length 4 which exists in the graph. Can anyone please provide me with a pseudo code. thank u

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T19:57:48.807

This sounds like homework, so I won't give the whole thing away. But here's a hint: since you are interested in finding cycles of length 4, take the 4th power of the adjacency matrix and scan along the diagonal. If any entry M[i,i] is nonzero, there is a cycle containing vertex i.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T20:15:18.810

也许它不是计算它的最佳方法（它是`O(n^4)`），但一种非常直接的方法是扫描所有顶点

```
a, b, c, d such that b > a, c > b, d > c 
```

您可以检查然后检查以下每个周期：

```
1\. ([a,b] && [b,c] && [c,d] && [d,a])
 2\. ([a,b] && [b,d] && [d,c] && [c,a])
 3\. ([a,d] && [d,b] && [b,c] && [c,a])

 1：2：3：
 A---B A---BAB
 | | \ / |\ /|
 | | X | X |
 | | / \ |/ \|
 D---C D---CCD

```

您基本上是在检查每个有序的顶点集 (a,b,c,d) 以了解它们可以形成循环的 3 种方式。

所以伪代码将是：

```
for a = 0 to <lastVertex>
 for b = a + 1 to <lastVertex>
  for c = b + 1 to <lastVertex>
   for d = c + 1 to <lastVertex>

    if(IsCycle(a,b,c,d)) AddToList([a,b,c,d])
    if(IsCycle(a,b,d,c)) AddToList([a,b,d,c])
    if(IsCycle(a,c,b,d)) AddToList([a,c,b,d])

   next d
  next c
 next b    
next a 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T19:56:15.067

Apply a depth-limited depth-first-search to every node and record nodes where the DFS finds the starting node. For the search, see pseudo-code here: [http://en.wikipedia.org/wiki/Depth-limited_search](http://en.wikipedia.org/wiki/Depth-limited_search). You just need to add something like

```
if(node' == node && node'.depth==4) memorize(node) 
```

to the beginning of the loop.

# php - 用于 OpenId 的 Janrain php 库和 google 端点

> ID：646576
> 
> 赞同：0
> 
> 时间：2009-03-14T19:41:50.153
> 
> 标签：php, zend-framework, openid, janrain

我使用 janRain Php 库进行 OpenId 和 yadis 发现，无论我做什么，我都会在 user.openid.org 或我自己的提供商之类的东西中工作，但如果我尝试使用 google 端点，我无法获得任何发现信息。

即使我为 janrain 库运行发现示例，我也会得到下一个结果

```
Identifier  http://www.google.com/accounts/o8/id
No OpenID services discovered. 
```

如果我在 url 之前添加 https:// 也会发生同样的情况。

我的问题可能不是如何让它工作，但如果它真的可能，我还有什么其他选择（在我的网站上运行，项目中不需要时髦的身份验证）。

为什么 openId 如此 #@!#@ 复杂且无证？（注意，我给了 zend_openid 几个小时以获得相同的结果）

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-16T16:27:52.820

它在这里工作。一些提示：

*   据我了解，它`http(s)://www.google.com/accounts/o8/id`不是 openid 端点，而是谷歌的*发现*端点。您必须为其提供一个有效的 (google) OpenID 标识符，例如`example.blogspot.com`，它会返回声明的标识符、服务器 URL、服务类型等。
*   我只有在修复`<?`and `<?=`in （用and`discover.php`替换它们）后才得到发现示例。或者，您可以. 它在默认情况下处于关闭状态。`<?php``<?php echo``ini_set('short_open_tag', '1')``php.ini-recommended`
*   你的 PHP 安装支持 SSL 吗？请参阅[README](http://openidenabled.com/files/php-openid/repos/2.x.x/README)，特别是这部分：

```
并非所有 PHP 安装都支持 SSL。你可以看看你的
通过阅读输出的“HTTP Fetching”部分来支持 SSL
“示例/检测.php。” 如果您的安装不支持 SSL，
那么 https:// 身份 URL 和服务器 URL 将不受支持
图书馆。尝试使用此类身份 URL 将是
相当于使用无效的 OpenID。要启用 SSL 支持，
使用 OpenSSL 支持重新编译 PHP 或安装适当的 OpenSSL
适合您平台的模块。如果您使用 CURL，CURL 将需要
内置 OpenSSL 支持。
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-06-02T14:31:48.877

这是正宗的牛肉。谷歌表示他们支持 OpenID，但他们的工作不像其他任何人。MyOpenID.com、blogspot、aol、yahoo、wordpress、myspace、livejournal 和许多其他都正确支持该标准，并且可以按预期工作。与您自己的 OpenID 提供程序一样，您可以使用 CommunityID 服务器项目进行构建。

/叹

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T19:10:38.653

您需要执行定向身份请求。通常这只涉及传递 URL，就好像用户输入了它一样……过去对我来说总是有效的（只要您使用的库支持 OpenID2.0）。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-03-12T16:37:38.950

我建议你看看这个问题：[Janrain's PHP-OpenID and Google/Yahoo](https://stackoverflow.com/questions/992682/janrains-php-openid-and-google-yahoo)

# python - 是否有任何好的 Python 教程/指南可以将 XML-RPC 与 Last.fm API 结合使用？

> ID：646578
> 
> 赞同：2
> 
> 时间：2009-03-14T19:43:00.073
> 
> 标签：python, web-services, xml-rpc

我是 XML-RPC 的新手，我想知道是否有任何好的教程可以将 XML-RPC 与 Last.fm API 一起使用。

是否可以使用 xmlrpclib 模块调用 API 方法，如下例所示？

```
import xmlrpclib
myserver = xmlrpclib.ServerProxy('http://ws.audioscrobbler.com/2.0/') 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-05T01:51:30.963

你的代码看起来很好。

您可能不知道这一点，但大多数 XML-RPC 端点（例如 Last.fm 的）都支持[XML-RPC 自省](http://xmlrpc-c.sourceforge.net/introspection.html)。例如，如果您想找出它公开了哪些方法，请执行以下操作：

```
import xmlrpclib
svc = xmlrpclib.ServerProxy('http://ws.audioscrobbler.com/2.0/')
print svc.system.listMethods() 
```

您将获得 XML-RPC 端点公开的方法列表。

顺便说一句，上面的那段代码演示了如何使用`ServerProxy`对象来调用它所绑定的端点所公开的方法，在这种情况下，就是`system.listMethods`方法。如果您想调用 Last.fm 公开的`user.getTopTags`（如[API 文档主页](http://www.last.fm/api/xmlrpc)所示）方法，您可以这样做：

```
print svc.user.getTopTags({'user': 'foo', 'api_key': 'bar'}) 
```

死简单！当然，您需要 Last.fm 的 API 密钥才能使用 API。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-05T00:50:05.197

现在不是处理 last.fm 的 api 的好时机。我想他们会在几天内改变它。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-07T08:35:35.107

# pylast

* * *

### Python 中的最后一个 fm 库

[pylast 库](http://pypi.python.org/pypi/pylast/0.3.1)是这项工作的不错选择。

该库具有非常庞大的功能集，涵盖了[last.fm API](http://www.last.fm/api)的所有主要部分。

### 功能性

这包括：专辑、艺术家、授权、事件、地理、图书馆、播放列表、标签、品味计评级、用户和场地。

使用这样的库意味着为您完成了很多工作，因此您不必花时间重新发明轮子。（库本身是 3,000 多行代码）。

### 执照

因为这个库是在许可下发布的，所以可以自己修改代码。

[在http://sourceforge.net/tracker/?group_id=66150&atid=513503](http://sourceforge.net/tracker/?group_id=66150&atid=513503)上还有一个社区致力于突出库中的任何错误

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T19:53:50.907

你可以使用这个：

[http://pypi.python.org/pypi/pylast/0.3.1](http://pypi.python.org/pypi/pylast/0.3.1)

或者如果你自己做，你可以检查代码......

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-24T07:58:53.740

是的，您使用 xmlrpclib 的示例看起来不错。

Pylast 可能不是最好的初学者示例。从 Python 中，我认为最简单的选择是使用您提到的 XML-RPC，或者使用 JSON 响应格式和[simplejson的](http://pypi.python.org/pypi/simplejson)[REST API](http://www.last.fm/api/rest)来解码输出。

# entity-framework - EF insert related objects

> ID：646581
> 
> 赞同：2
> 
> 时间：2009-03-14T19:47:11.313
> 
> 标签：entity-framework, transactions, silverlight-2.0, wcf-data-services, foreign-key-relationship

I am using silverlight client with ado.net dataservices on entity framework.

I have an Entity Contact and an Entity Address which is related with a foreign key relation ship... A contact can have 1 or more Adresses but a Address needs always at least 1 contact.. pretty basic...

I have a Repository for my contacts and Address which has a Method Add(T entity),...

On my Client I have a form with allows users to add a contact with an address

and I want to save both away to the database...

```
Address a = new Address();
a.Street="Street",
a.City = "City"
a.Contact = 
 new Contact(){ Name="Name",Age="60"}

_repository.Add(a);

.... 
```

Ok i figured out that I can not save a related object graph right away so i did something like this

```
DataBaseEntities.AddToContact(obj2Badded.Contact);
DataBaseEntities.AddToAddress(obj2Badded);
DataBaseEntities.SetLink(obj2Badded,"Contact",object2Badded.Contact);
DataBaseEinties.BeginSaveChanges(...) 
```

Is there away to do this in transations like when contact is not added address will also not be added and vice versa...

... and all what I have tried is not working...

It would be great if someone can point me in the right direction on this topic I simply want to add a related object graph =} ...

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-17T14:31:06.867

您的第一个示例应该可以正常工作，相关实体和所有。如果您要为这两个实体插入新对象，则无需单独将相关实体添加到上下文中。因此，除非您在运行此代码时告诉我们问题出在哪里，否则将很难提供帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2012-03-20T14:06:38.760

我有一个类似的问题，在添加了类似的东西后它对我有用

```
DatabaseEntities.UpdateObject(obj2Badded); 
```

就在之前

```
DatabaseEntities.BeginSavingChanged(); 
```

如果您在项目中包含 edmx 并使用 ObjectContext，则不需要这样做，但如果您创建服务引用并使用生成的 DataServiceContext，则需要这样做。

# c# - Catch tasks from windows task scheduler in a .net app

> ID：646590
> 
> 赞同：0
> 
> 时间：2009-03-14T19:51:38.243
> 
> 标签：c#, .net, windows, scheduled-tasks

I have a program that is running in the background, this program has to be notified when a specific windows event is occurring.

I know the name and id for the event and i know how to schedule an action for it in the task scheduler, but here i can only start a new program. I want to call a function in an already running application.

**Edit:** Solved it like this.

The main program is listening for a TCP connection and from the task scheduler i start another instance of the program with a command line argument. If the program receives this argument it will connect to the main program that performs some action when it receives the connection.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T19:59:51.563

我会让调度程序启动一个新进程（它可能是同一个应用程序 exe）并让这个进程设置一个第一个进程正在等待的事件。对我来说似乎很干净，特别是如果您让调度程序启动相同的应用程序（可能使用特殊的命令行）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-15T10:24:28.240

我不确定您所说的“Windows 事件”是什么意思——实在太多了！您在标题中谈论的是任务调度程序，但您在问题中所写的内容似乎表明您在调度程序的帮助下正在寻找一些外部更改。我假设它不是键盘、鼠标或 Windows 事件，因为这就是 GUI 框架的用途。

如果“胶水”应用程序方法对您来说不够优雅或不够快，我会说深入[研究 Windows Management Instrumentation](http://en.wikipedia.org/wiki/Windows_Management_Instrumentation)。查看[MSDN](http://msdn.microsoft.com/en-us/library/aa393013(VS.85).aspx)上的这篇文章作为入门，也许[这篇文章是关于如何在 VS 中工作的](http://msdn.microsoft.com/en-us/magazine/cc302051.aspx)：如果失败，您可能必须下降到[COM 互操作](http://en.wikipedia.org/wiki/Com_interop)级别来注册您的侦听器。

您还没有说明您的“后台应用程序”是如何实现的：无论是作为有或没有窗口/GUI 的正常进程，还是作为 Windows 服务，或[更现代](http://msdn.microsoft.com/en-us/library/ms730158.aspx)的 . 我认为 WMI 侦听器可以处理所有这些，但思考不能替代测试（反之亦然！）。

我有些犹豫地提供了这个建议：WMI 基于[DCOM](http://en.wikipedia.org/wiki/Distributed_Component_Object_Model)，如果您开始跨网络工作，有时在单台机器上（在不同的用户帐户下运行）工作，这可能会给您带来痛苦。我敢肯定，在所有神秘的参数和配置之下，有一个经过深思熟虑的安全模型！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T20:07:23.620

我支持（并赞成）默里的评论。只需启动一个新进程，该进程“通知”事件发生的现有进程然后终止。如果您只需要知道它发生在等待一个全局事件（windows 这个词的意思，而不是 .net 的）似乎很简单。

# javascript - eval 是邪恶的……那我应该用什么代替呢？

> ID：646597
> 
> 赞同：22
> 
> 时间：2009-03-14T19:55:25.177
> 
> 标签：javascript, ajax, eval

ajax 请求返回一个标准 JSON 数组，其中填充了我的用户输入。输入已经过清理，使用 eval() 函数，我可以轻松创建我的 javascript 对象并更新我的页面......

所以这就是问题所在。无论我多么努力地清理输入，我都宁愿不使用 eval() 函数。我已经检查了谷歌的方法来使用“没有 eval 的 AJAX 中的 JSON”并且已经运行了一堆不同的方法......

我应该使用哪一个？是否有一种标准的、经过验证的安全方式来执行此操作？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-03-14T20:08:04.070

json.org 有一个不错的[javascript 库](http://www.json.org/js.html)

简单用法：

```
JSON.parse('[{"some":"json"}]');
JSON.stringify([{some:'json'}]); 
```

**编辑**：正如评论中所指出的，如果你查看它的源代码，这将使用 eval （尽管它看起来首先被清理了）

要完全避免它，请查看[json_parse](http://www.json.org/json_parse.js)或[json-sans-eval](http://code.google.com/p/json-sans-eval/)

json2.js 不安全，json_parse.js 很慢，json-sans-eval.js 没有验证

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-14T20:09:37.717

> 是否有一种标准的、经过验证的安全方式来执行此操作？

在即将推出的 JavaScript 的 ECMAScript 3.1 版本中，有一种建议的标准方法：[JSON.parse](http://wiki.ecmascript.org/doku.php?id=es3.1:json_support)。

它将在 IE8、Firefox 3.1/3.5 以及很可能在未来的其他流行浏览器中得到支持。同时，您可以回退到或独占使用 eval()。邪恶可能是也可能不是；当然它会比 JSON.parse 慢。但这是当今解析 JSON 的常用方法。

如果攻击者能够将恶意 JavaScript 注入到您通过 JSON 吐出的内容中，那么您需要担心的问题比 eval-is-evil 更大。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2009-03-14T19:58:17.137

我想说，一旦输入被清理， eval 是最好的方法。如果您的服务器受到威胁，人们无论如何都可以向客户端发送他们想要的任何脚本。因此，进行评估并不是很大的安全风险。如果您担心人们会在数据包到达客户端之前对其进行操作，那么同样可以修改脚本本身。

不用担心评估。但是请确保将其包装在 try...catch 块中，这样如果您的 JSON 被破坏，您的用户就不会收到 JS 错误。

:)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-14T20:09:49.883

为了安全地将 JSON 转换为 JS 对象，您应该使用 JSON 解析器，例如[此库](https://github.com/douglascrockford/JSON-js/blob/master/json2.js)提供的 JSON.parse() 函数。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-14T19:58:56.073

与命令设计模式比较：[http](http://en.wikipedia.org/wiki/Command_pattern) ://en.wikipedia.org/wiki/Command_pattern 。鉴于此，您可以精确定义客户端可以执行的操作，并且您的应用程序将与底层解释一样安全。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-14T20:04:10.880

取决于你想用卫生设施完成什么。我在[原型](http://www.prototypejs.org)框架对 JSON 和安全评估的支持方面取得了巨大的成功。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-06-04T03:19:12.297

如果您确定没有注入风险，并且您没有`eval()ing`处于循环中，请使用`eval()`. 与其他肯定会更慢、可能会中断并且需要客户端下载额外代码的选项相比，它将具有优势。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2010-07-28T09:55:21.433

从 jQuery 中“窃取”

```
// Try to use the native JSON parser first
return window.JSON && window.JSON.parse ?
    window.JSON.parse( data ) :
    (new Function("return " + data))(); 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-04-30T07:26:29.903

**问题：** eval 提出的问题是它在全局范围内执行

```
eval.call(document, "console.log(this)")
eval.call(navigator, "console.log(this)")
eval.call(window, "console.log(this)")
(function(){eval.call(document, "console.log(this)")})()
>Window 
```

**设想：**

假设您在各种文档元素的标记代码中使用单个属性，例如属性*onvisible*

```
<img src="" onvisible="src='http://www.example.com/myimg.png';"> 
```

您想获取具有此属性的所有元素，将 onvisible-content-string 转换为闭包并将其放入 EventHandler 队列中。这就是 JS Function 构造函数发挥作用的地方。

```
Function === 0..constructor.constructor
>true

Function('return [this, arguments]').call(window, 1,2,3)
>Window, Arguments[3]]
Function('return [this, arguments]').call(document, 1,2,3)
>Document, Arguments[3]]
Function('return [this, arguments]').call(navigator, 1,2,3)
>Navigator, Arguments[3]] 
```

把它们放在一起：

```
var eventQueue = [];
var els = document.querySelectorAll('[onvisible]');

for (var el in els) {
    var jscode = els[el].getAttribute('onvisible');
    eventQueue.push( {el:els[el], cb:Function(jscode)} )
}

//eventQueue[0].cb.call(scope, args); 
```

# resize - 调整 Jtable 列宽的大小不起作用

> ID：646606
> 
> 赞同：1
> 
> 时间：2009-03-14T20:00:40.890
> 
> 标签：resize, jtable

```
//can set column widths using percentages   
private void setPreferredTableColumnWidths(JTable table, double[] percentages) 
{
    Dimension tableDim = table.getSize(); 

    double total = 0; 
    for(int i = 0; i < table.getColumnModel().getColumnCount(); i++) 
      total += percentages[i]; 

    table.setAutoResizeMode(JTable.AUTO_RESIZE_OFF);
    for(int i = 0; i < table.getColumnModel().getColumnCount(); i++) 
    { 
      TableColumn column = table.getColumnModel().getColumn(i); 
      column.setPreferredWidth((int) (tableDim.width * (percentages[i] / total)));
    }
} 
```

我希望能够根据表格总宽度的百分比来更改 JTable 的宽度。上面的代码看起来应该可以工作，但是当我使用“setPreferredTableColumnWidths(table, new double[] {.01,.4,.2,.2,.2}); 调用它时，我只能得到等宽的列。

可能是什么问题呢？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-16T00:25:02.167

尝试添加该行：

table.doLayout();

在方法结束时。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-08-26T14:43:01.247

您的代码工作正常，但取决于您调用它的位置，表格可能有也可能没有宽度。在 Panel 的构造函数（或任何包含表格的东西）中，还没有宽度。

我在paint() 方法中调用了您的方法。但一定要保持跟踪并且只调用一次，否则它会一遍又一遍地调整列的大小。

```
@Override
public void paint(Graphics g) {
    super.paint(g);

    if(! this.initialSizeSet){
        this.setPreferredTableColumnWidths(this.table, new double[] {0.1, 0.1, 0.5, 0.3});
        this.initialSizeSet = true;
    }
} 
```

# javascript - 以编程方式选择输入字段中的部分文本

> ID：646611
> 
> 赞同：48
> 
> 时间：2009-03-14T20:03:28.887
> 
> 标签：javascript, html, html-input

如何以编程方式在 HTML`input`字段中选择特定范围的文本？（我不想选择*整个*字段，只是一个子集）

另外，如何确定字段中当前选择的范围？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-03-14T20:27:50.263

以下是选择文本框的一部分（范围选择）并获取所选文本的方法：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<title> Test </title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
  window.onload = function() {
    var message = document.getElementById('message');
    // Select a portion of text
    createSelection(message, 0, 5);
    // get the selected portion of text
    var selectedText = message.value.substring(message.selectionStart, message.selectionEnd);
    alert(selectedText);
  };

  function createSelection(field, start, end) {
    if( field.createTextRange ) {
      var selRange = field.createTextRange();
      selRange.collapse(true);
      selRange.moveStart('character', start);
      selRange.moveEnd('character', end);
      selRange.select();
      field.focus();
    } else if( field.setSelectionRange ) {
      field.focus();
      field.setSelectionRange(start, end);
    } else if( typeof field.selectionStart != 'undefined' ) {
      field.selectionStart = start;
      field.selectionEnd = end;
      field.focus();
    }
  }
</script>
</head>
<body>
<input type="text" name="message" id="message" value="Hello World" />
</body>
</html>
```

[演示](http://jsbin.com/anadox/3/edit)

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-28T00:30:00.417

小修正。似乎 IE moveEnd() 方法逐渐移动，因此`selRange.moveEnd('character', end)` 应替换为`selRange.moveEnd('character', end-start)`：

```
function createSelection(field, start, end) {
    if( field.createTextRange ) {
        var selRange = field.createTextRange();
        selRange.collapse(true);
        selRange.moveStart('character', start);
        selRange.moveEnd('character', end-start);
        selRange.select();
    } else if( field.setSelectionRange ) {
        field.setSelectionRange(start, end);
    } else if( field.selectionStart ) {
        field.selectionStart = start;
        field.selectionEnd = end;
    }
    field.focus();
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2011-12-29T14:08:28.907

谢谢！我现在想分享我的功能，它在 Ajaxel CMS 中与 Instant messenger 一起使用

```
,wrapText:function(o, ot, ct) {
    var s = o[0].selectionStart; 
    var e = o[0].selectionEnd;
    o.val(o.val().substring(0, s)+ot+o.val().substring(s,e)+ct+o.val().substring(e, o.val().length)); 
    if (o[0].createTextRange){
        var sr = o[0].createTextRange(); 
        sr.collapse(true); 
        sr.moveStart('character', s); 
        sr.moveEnd('character',e-s+ot.length+ct.length); 
        sr.select();
    }
    else if(o[0].setSelectionRange){ 
        o[0].setSelectionRange(s,e+ot.length+ct.length); 
    }
    else if(o[0].selectionStart){ 
        o[0].selectionStart=s; 
        o[0].selectionEnd=e+ot.length+ct.length; 
    }
} 
```

# iphone - 如何创建类似于地址簿编辑联系人的视图

> ID：646618
> 
> 赞同：1
> 
> 时间：2009-03-14T20:07:16.613
> 
> 标签：iphone

任何人都可以提供如何从地址簿创建联系人视图的示例。

我主要感兴趣的是：

1.  使用什么 UIKit 类来添加照片
2.  使用什么类来编辑名称和公司
3.  如何在我可以编辑电话、铃声的地方实现复合控制

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T21:44:07.350

我建议您查看iPhone 开发人员网站上的[iPhone OS 通讯簿编程指南](http://developer.apple.com/iphone/library/documentation/ContactData/Conceptual/AddressBookProgrammingGuideforiPhone/100-Introduction/Introduction.html)部分。

iPhone SDK 带有预构建的类和视图，可以处理所有地址簿数据的选择、编辑或添加。您只需创建这些预先构建的控制器之一（例如 ABPersonViewController）并填写人员的 ID，以及用户可以选择/更改的详细信息。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T18:23:38.073

我已经将 ImageView 和几个 TableView 的样式设置为 Groped。我的所有表视图都有一个控制器数据源，这就是为什么我将每个表视图标记属性设置为唯一的 int 值以在 numberOfRowsInSection 和 cellForRowAtIndexPath 中区分它们。

然后一切都很标准，你正在做 pushViewController 和 popViewControllerAnimated 来显示和隐藏细节控制器。

对我来说很好。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2011-08-26T16:02:16.767

Apple 的示例项目 QuickContacts 涵盖了[这一点](http://developer.apple.com/library/ios/#samplecode/QuickContacts/Introduction/Intro.html)。

# javascript - 如何检查一个字符串“StartsWith”是否是另一个字符串？

> ID：646628
> 
> 赞同：1773
> 
> 时间：2009-03-14T20:12:51.233
> 
> 标签：javascript, string, startswith

[`String.StartsWith`](http://msdn.microsoft.com/en-us/library/baketfxw.aspx)我将如何在 JavaScript 中编写相当于 C# 的代码？

```
var haystack = 'hello world';
var needle = 'he';

haystack.startsWith(needle) == true 
```

注意：这是一个老问题，正如评论中指出的 ECMAScript 2015 (ES6) 介绍了该[`.startsWith`](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith)方法。但是，在撰写此更新 (2015) 时，[浏览器支持还远未完成](http://kangax.github.io/compat-table/es6/#test-String.prototype_methods_String.prototype.startsWith)。

* * *

## 回答 #1

> 赞同：1838
> 
> 时间：2009-03-14T20:19:13.077

您可以使用 ECMAScript 6 的[`String.prototype.startsWith()`](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith)方法，但[尚未在所有浏览器中都支持](http://kangax.github.io/compat-table/es6/#test-String.prototype_methods_String.prototype.startsWith)。您需要使用 shim/polyfill 将其添加到不支持它的浏览器上。创建一个符合[规范中列出的所有细节](http://www.ecma-international.org/ecma-262/6.0/#sec-string.prototype.startswith)的实现有点复杂。如果您想要一个忠实的垫片，请使用：

*   [Matthias Bynens 的`String.prototype.startsWith`垫片](https://github.com/mathiasbynens/String.prototype.startsWith)，或
*   es6 [-shim](https://github.com/paulmillr/es6-shim)，它尽可能多地填充 ES6 规范，包括`String.prototype.startsWith`.

一旦你填充了这个方法（或者如果你只支持已经拥有它的浏览器和 JavaScript 引擎），你可以像这样使用它：

```
 console.log("Hello World!".startsWith("He")); // true

var haystack = "Hello world";
var prefix = 'orl';
console.log(haystack.startsWith(prefix)); // false
```

* * *

## 回答 #2

> 赞同：1305
> 
> 时间：2011-01-02T16:14:42.457

另一种选择[`.lastIndexOf`](https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/String/lastIndexOf)：

```
haystack.lastIndexOf(needle, 0) === 0 
```

这会向后看，`haystack`以查找`needle`从 的索引开始`0`的事件`haystack`。换句话说，它只检查是否`haystack`以`needle`.

原则上，这应该比其他一些方法具有性能优势：

*   它不会搜索整个`haystack`.
*   它不会创建一个新的临时字符串然后立即丢弃它。

* * *

## 回答 #3

> 赞同：598
> 
> 时间：2009-03-14T20:14:12.107

```
data.substring(0, input.length) === input 
```

* * *

## 回答 #4

> 赞同：186
> 
> 时间：2011-01-04T00:59:29.600

没有辅助函数，只需使用正则表达式的[`.test`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/RegExp/test)方法：

```
/^He/.test('Hello world') 
```

要使用动态字符串而不是硬编码的字符串来执行此操作（假设字符串不包含任何正则表达式控制字符）：

```
new RegExp('^' + needle).test(haystack) 
```

您应该查看[JavaScript 中是否有 RegExp.escape 函数？](https://stackoverflow.com/questions/3561493/is-there-a-regexp-escape-function-in-javascript)如果存在正则表达式控制字符出现在字符串中的可能性。

* * *

## 回答 #5

> 赞同：72
> 
> 时间：2016-04-26T21:56:14.360

**最佳解决方案：**

```
function startsWith(str, word) {
    return str.lastIndexOf(word, 0) === 0;
} 
```

如果您也需要，这里是**endsWith ：**

```
function endsWith(str, word) {
    return str.indexOf(word, str.length - word.length) !== -1;
} 
```

**对于那些喜欢将其原型化为字符串的人：**

```
String.prototype.startsWith || (String.prototype.startsWith = function(word) {
    return this.lastIndexOf(word, 0) === 0;
});

String.prototype.endsWith   || (String.prototype.endsWith = function(word) {
    return this.indexOf(word, this.length - word.length) !== -1;
}); 
```

**用法：**

```
"abc".startsWith("ab")
true
"c".ensdWith("c") 
true 
```

用方法：

```
startsWith("aaa", "a")
true
startsWith("aaa", "ab")
false
startsWith("abc", "abc")
true
startsWith("abc", "c")
false
startsWith("abc", "a")
true
startsWith("abc", "ba")
false
startsWith("abc", "ab")
true 
```

* * *

## 回答 #6

> 赞同：55
> 
> 时间：2016-02-12T14:47:19.157

我只是想补充一下我对此的看法。

我认为我们可以这样使用：

```
var haystack = 'hello world';
var needle = 'he';

if (haystack.indexOf(needle) == 0) {
  // Code if string starts with this substring
} 
```

* * *

## 回答 #7

> 赞同：40
> 
> 时间：2009-05-27T02:54:51.353

这是对 CMS 解决方案的一个小改进：

```
if(!String.prototype.startsWith){
    String.prototype.startsWith = function (str) {
        return !this.indexOf(str);
    }
}

"Hello World!".startsWith("He"); // true

 var data = "Hello world";
 var input = 'He';
 data.startsWith(input); // true 
```

检查该函数是否已经存在，以防将来的浏览器以本机代码实现它，或者它是否由另一个库实现。例如，原型库已经实现了这个功能。

使用`!`起来比`=== 0`可读性要快一些，也更简洁。

* * *

## 回答 #8

> 赞同：21
> 
> 时间：2011-05-31T18:29:50.940

另请查看[underscore.string.js](https://github.com/edtsech/underscore.string)。它带有一堆有用的字符串测试和操作方法，包括一个`startsWith`方法。从文档：

> **以。。开始** `_.startsWith(string, starts)`
> 
> 此方法检查是否`string`以`starts`.
> 
> ```
> _("image.gif").startsWith("image")
> => true 
> ```

* * *

## 回答 #9

> 赞同：15
> 
> 时间：2014-05-17T09:07:07.260

我最近问自己同样的问题。
有多种可能的解决方案，这里有 3 个有效的解决方案：

*   `s.indexOf(starter) === 0`
*   `s.substr(0,starter.length) === starter`
*   `s.lastIndexOf(starter, 0) === 0`（看到马克拜尔斯的[回答](https://stackoverflow.com/a/4579228/2279260)后添加）
*   使用循环：

    ```
    function startsWith(s,starter) {
      for (var i = 0,cur_c; i < starter.length; i++) {
        cur_c = starter[i];
        if (s[i] !== starter[i]) {
          return false;
        }
      }
      return true;
    } 
    ```

我还没有遇到最后一个使用循环的解决方案。
令人惊讶的是，该解决方案的性能明显优于前 3 个。
这是我为得出这个结论而执行的 jsperf 测试：http: [//jsperf.com/startswith2/2](http://jsperf.com/startswith2/2)

和平

ps：ecmascript 6 (harmony)`startsWith`为字符串引入了原生方法。
试想一下，如果他们考虑在初始版本本身中包含这个急需的方法，将会节省多少时间。

**更新**

正如史蒂夫指出的那样（对此答案的第一条评论），如果给定的*前缀*比整个字符串短，上述自定义函数将引发错误。他已经解决了这个问题并添加了一个循环优化，可以在[http://jsperf.com/startswith2/4](http://jsperf.com/startswith2/4)查看。

请注意，Steve 包含了 2 个循环优化，其中第一个表现出更好的性能，因此我将在下面发布该代码：

```
function startsWith2(str, prefix) {
  if (str.length < prefix.length)
    return false;
  for (var i = prefix.length - 1; (i >= 0) && (str[i] === prefix[i]); --i)
    continue;
  return i < 0;
} 
```

* * *

## 回答 #10

> 赞同：11
> 
> 时间：2016-01-05T11:34:05.247

由于这很受欢迎，我认为值得指出的是，在 ECMA 6 中有这种方法的实现，并且为了准备应该使用“官方”polyfill 以防止将来出现问题和撕裂。

幸运的是，Mozilla 的专家为我们提供了一个：

[https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith](https://developer.mozilla.org/de/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith)

```
if (!String.prototype.startsWith) {
    String.prototype.startsWith = function(searchString, position) {
        position = position || 0;
        return this.indexOf(searchString, position) === position;
    };
} 
```

请注意，这具有在过渡到 ECMA 6 时被优雅地忽略的优势。

* * *

## 回答 #11

> 赞同：5
> 
> 时间：2014-07-15T01:39:46.940

最好的性能解决方案是停止使用库调用，而只是认识到您正在使用两个数组。与我在这里看到的所有其他解决方案相比，手动实现既短又快。

```
function startsWith2(str, prefix) {
    if (str.length < prefix.length)
        return false;
    for (var i = prefix.length - 1; (i >= 0) && (str[i] === prefix[i]); --i)
        continue;
    return i < 0;
} 
```

有关性能比较（成功和失败），请参阅[http://jsperf.com/startswith2/4](http://jsperf.com/startswith2/4)。（确保您检查可能胜过我的更高版本。）

* * *

## 回答 #12

> 赞同：3
> 
> 时间：2019-07-14T14:26:44.320

2019.  这个问题有点老了，但我想写这个答案来向你展示我根据这里提供的所有答案和 Jim Buck 分享的 jsperf 所做的一些基准测试。

我基本上需要一种快速的方法来确定一根长针是否在一个长长的大海捞针中，它们非常相似，除了最后一个字符。

这是我编写的代码，它为每个函数（拼接、子字符串、startsWith 等）测试它们在返回 false 和 true 时针对`nestedString`1.000.0001 个字符的 haystack 字符串 ( ) 和 1.000.000 的假或真针字符串字符（`testParentStringFalse`和`testParentStringTrue`，分别）：

```
// nestedString is made of 1.000.001 '1' repeated characters.
var nestedString = '...'

// testParentStringFalse is made of 1.000.000 characters,
// all characters are repeated '1', but the last one is '2',
// so for this string the test should return false.
var testParentStringFalse = '...'

// testParentStringTrue is made of 1.000.000 '1' repeated characters,
// so for this string the test should return true.
var testParentStringTrue = '...'

// You can make these very long strings by running the following bash command
// and edit each one as needed in your editor
// (NOTE: on OS X, `pbcopy` copies the string to the clipboard buffer,
//        on Linux, you would probably need to replace it with `xclip`):
// 
//     printf '1%.0s' {1..1000000} | pbcopy
// 

function testString() {
    let dateStart
    let dateEnd
    let avg
    let count = 100000
    const falseResults = []
    const trueResults = []

    /* slice */
    console.log('========> slice')
    dateStart = +new Date()
    var res
    for (let j = 0; j < count; j++) {
        res = nestedString.slice(0, testParentStringFalse.length) === testParentStringFalse
    }
    dateEnd = +new Date()
    avg = (dateEnd - dateStart)/count
    falseResults[falseResults.length] = {
        label: 'slice',
        avg
    }
    console.log(`testString() slice = false`, res, 'avg: ' + avg + 'ms')

    dateStart = +new Date()
    var res
    for (let j = 0; j < count; j++) {
        res = nestedString.slice(0, testParentStringTrue.length) === testParentStringTrue
    }
    dateEnd = +new Date()
    avg = (dateEnd - dateStart)/count
    trueResults[trueResults.length] = {
        label: 'slice',
        avg
    }
    console.log(`testString() slice = true`, res, 'avg: ' + avg + 'ms')
    console.log('<======== slice')
    console.log('')
    /* slice END */

    /* lastIndexOf */
    console.log('========> lastIndexOf')
    dateStart = +new Date()
    var res
    for (let j = 0; j < count; j++) {
        res = nestedString.lastIndexOf(testParentStringFalse, 0) === 0
    }
    dateEnd = +new Date()
    avg = (dateEnd - dateStart)/count
    falseResults[falseResults.length] = {
        label: 'lastIndexOf',
        avg
    }
    console.log(`testString() lastIndexOf = false`, res, 'avg: ' + avg + 'ms')

    dateStart = +new Date()
    var res
    for (let j = 0; j < count; j++) {
        res = nestedString.lastIndexOf(testParentStringTrue, 0) === 0
    }
    dateEnd = +new Date()
    avg = (dateEnd - dateStart)/count
    trueResults[trueResults.length] = {
        label: 'lastIndexOf',
        avg
    }
    console.log(`testString() lastIndexOf = true`, res, 'avg: ' + avg + 'ms')
    console.log('<======== lastIndexOf')
    console.log('')
    /* lastIndexOf END */

    /* indexOf */
    console.log('========> indexOf')
    dateStart = +new Date()
    var res
    for (let j = 0; j < count; j++) {
        res = nestedString.indexOf(testParentStringFalse) === 0
    }
    dateEnd = +new Date()
    avg = (dateEnd - dateStart)/count
    falseResults[falseResults.length] = {
        label: 'indexOf',
        avg
    }
    console.log(`testString() indexOf = false`, res, 'avg: ' + avg + 'ms')

    dateStart = +new Date()
    var res
    for (let j = 0; j < count; j++) {
        res = nestedString.indexOf(testParentStringTrue) === 0
    }
    dateEnd = +new Date()
    avg = (dateEnd - dateStart)/count
    trueResults[trueResults.length] = {
        label: 'indexOf',
        avg
    }
    console.log(`testString() indexOf = true`, res, 'avg: ' + avg + 'ms')
    console.log('<======== indexOf')
    console.log('')
    /* indexOf END */

    /* substring */
    console.log('========> substring')
    dateStart = +new Date()
    var res
    for (let j = 0; j < count; j++) {
        res = nestedString.substring(0, testParentStringFalse.length) === testParentStringFalse
    }
    dateEnd = +new Date()
    avg = (dateEnd - dateStart)/count
    falseResults[falseResults.length] = {
        label: 'substring',
        avg
    }
    console.log(`testString() substring = false`, res, 'avg: ' + avg + 'ms')

    dateStart = +new Date()
    var res
    for (let j = 0; j < count; j++) {
        res = nestedString.substring(0, testParentStringTrue.length) === testParentStringTrue
    }
    dateEnd = +new Date()
    avg = (dateEnd - dateStart)/count
    trueResults[trueResults.length] = {
        label: 'substring',
        avg
    }
    console.log(`testString() substring = true`, res, 'avg: ' + avg + 'ms')
    console.log('<======== substring')
    console.log('')
    /* substring END */

    /* startsWith */
    console.log('========> startsWith')
    dateStart = +new Date()
    var res
    for (let j = 0; j < count; j++) {
        res = nestedString.startsWith(testParentStringFalse)
    }
    dateEnd = +new Date()
    avg = (dateEnd - dateStart)/count
    falseResults[falseResults.length] = {
        label: 'startsWith',
        avg
    }
    console.log(`testString() startsWith = false`, res, 'avg: ' + avg + 'ms')

    dateStart = +new Date()
    var res
    for (let j = 0; j < count; j++) {
        res = nestedString.startsWith(testParentStringTrue)
    }
    dateEnd = +new Date()
    avg = (dateEnd - dateStart)/count
    trueResults[trueResults.length] = {
        label: 'startsWith',
        avg
    }
    console.log(`testString() startsWith = true`, res, 'avg: ' + avg + 'ms')
    console.log('<======== startsWith')
    console.log('')
    /* startsWith END */

    falseResults.sort((a, b) => a.avg - b.avg)
    trueResults.sort((a, b) => a.avg - b.avg)

    console.log('false results from fastest to slowest avg:', falseResults)
    console.log('true results from fastest to slowest avg:', trueResults)
} 
```

**我在Chrome 75**、**Firefox 67**、**Safari 12**和**Opera 62**上运行了这个基准测试。

我没有包括 Edge 和 IE，因为我在这台机器上没有它们，但是如果你们中的某个人想要针对 Edge 和至少 IE 9 运行脚本并在此处共享输出，我会非常好奇地看到结果。

请记住，您需要重新创建 3 个长字符串并将脚本保存在一个文件中，然后在浏览器中打开该文件，因为在浏览器控制台上的复制/粘贴将阻止它，因为每个字符串的长度 >= 1.000.000）。

以下是输出：

Chrome 75（`substring`获胜）：

```
false results from fastest to slowest avg:
1)  {"label":"substring","avg":0.08271}
2)  {"label":"slice","avg":0.08615}
3)  {"label":"lastIndexOf","avg":0.77025}
4)  {"label":"indexOf","avg":1.64375}
5)  {"label":"startsWith","avg":3.5454}

true results from fastest to slowest avg:
1)  {"label":"substring","avg":0.08213}
2)  {"label":"slice","avg":0.08342}
3)  {"label":"lastIndexOf","avg":0.7831}
4)  {"label":"indexOf","avg":0.88988}
5)  {"label":"startsWith","avg":3.55448} 
```

Firefox 67（`indexOf`获胜）：

```
false results from fastest to slowest avg
1)  {"label":"indexOf","avg":0.1807}
2)  {"label":"startsWith","avg":0.74621}
3)  {"label":"substring","avg":0.74898}
4)  {"label":"slice","avg":0.78584}
5)  {"label":"lastIndexOf","avg":0.79668}

true results from fastest to slowest avg:
1)  {"label":"indexOf","avg":0.09528}
2)  {"label":"substring","avg":0.75468}
3)  {"label":"startsWith","avg":0.76717}
4)  {"label":"slice","avg":0.77222}
5)  {"label":"lastIndexOf","avg":0.80527} 
```

Safari 12（`slice`假结果`startsWith`获胜，真结果获胜，就执行整个测试的总时间而言，Safari 也是最快的）：

```
false results from fastest to slowest avg:
1) "{\"label\":\"slice\",\"avg\":0.0362}"
2) "{\"label\":\"startsWith\",\"avg\":0.1141}"
3) "{\"label\":\"lastIndexOf\",\"avg\":0.11512}"
4) "{\"label\":\"substring\",\"avg\":0.14751}"
5) "{\"label\":\"indexOf\",\"avg\":0.23109}"

true results from fastest to slowest avg:
1) "{\"label\":\"startsWith\",\"avg\":0.11207}"
2) "{\"label\":\"lastIndexOf\",\"avg\":0.12196}"
3) "{\"label\":\"substring\",\"avg\":0.12495}"
4) "{\"label\":\"indexOf\",\"avg\":0.33667}"
5) "{\"label\":\"slice\",\"avg\":0.49923}" 
```

Opera 62（`substring`获胜。结果与 Chrome 相似，我并不感到惊讶，因为 Opera 基于 Chromium 和 Blink）：

```
false results from fastest to slowest avg:
{"label":"substring","avg":0.09321}
{"label":"slice","avg":0.09463}
{"label":"lastIndexOf","avg":0.95347}
{"label":"indexOf","avg":1.6337}
{"label":"startsWith","avg":3.61454}

true results from fastest to slowest avg:
1)  {"label":"substring","avg":0.08855}
2)  {"label":"slice","avg":0.12227}
3)  {"label":"indexOf","avg":0.79914}
4)  {"label":"lastIndexOf","avg":1.05086}
5)  {"label":"startsWith","avg":3.70808} 
```

事实证明，每个浏览器都有自己的实现细节（除了基于 Chrome 的 Chromium 和 Blink 的 Opera）。

当然，可以并且应该对不同的用例进行进一步测试（例如，当针与干草堆相比真的很短时，当干草堆比针短时等等......），但在我的情况下，我需要比较非常长的字符串和想在这里分享。

* * *

## 回答 #13

> 赞同：2
> 
> 时间：2014-04-29T10:22:18.047

我刚刚了解了这个字符串库：

[http://stringjs.com/](http://stringjs.com/)

包含 js 文件，然后`S`像这样使用变量：

```
S('hi there').endsWith('hi there') 
```

它也可以通过安装在 NodeJS 中使用：

```
npm install string 
```

然后要求它作为`S`变量：

```
var S = require('string'); 
```

如果您不喜欢这个网页，该网页还包含指向备用字符串库的链接。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2012-05-04T14:04:52.403

```
var str = 'hol';
var data = 'hola mundo';
if (data.length >= str.length && data.substring(0, str.length) == str)
    return true;
else
    return false; 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-09-24T15:29:26.357

根据此处的答案，这是我现在正在使用的版本，因为它似乎提供了基于 JSPerf 测试的最佳性能（据我所知，它在功能上是完整的）。

```
if(typeof String.prototype.startsWith != 'function'){
    String.prototype.startsWith = function(str){
        if(str == null) return false;
        var i = str.length;
        if(this.length < i) return false;
        for(--i; (i >= 0) && (this[i] === str[i]); --i) continue;
        return i < 0;
    }
} 
```

这是基于这里的startsWith2：http: [//jsperf.com/startswith2/6](http://jsperf.com/startswith2/6)。我为微小的性能改进添加了一个小调整，并且此后还添加了对比较字符串是否为空或未定义的检查，并使用 CMS 答案中的技术将其转换为添加到字符串原型。

请注意，此实现不支持此[Mozilla 开发人员网络](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/startsWith)页面中提到的“位置”参数，但这似乎不是 ECMAScript 提案的一部分。

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2019-07-11T09:09:47.443

我不确定javascript但在打字稿中我做了类似的事情

```
var str = "something";
(<String>str).startsWith("some"); 
```

我想它也应该适用于js。我希望它有帮助！

* * *

## 回答 #17

> 赞同：0
> 
> 时间：2020-08-02T05:32:23.083

字符串对象具有诸如startsWith、endsWith 之类的方法并包含方法。

*   StartsWith 检查给定的字符串是否从开头开始。

*   endsWith 检查给定的字符串是否在末尾。

*   包括检查给定字符串是否存在于任何部分。

您可以在下面的 youtube 视频中找到这三者之间的完全区别

[https://www.youtube.com/watch?v=E-hyeSwg0PA](https://www.youtube.com/watch?v=E-hyeSwg0PA)

* * *

## 回答 #18

> 赞同：-2
> 
> 时间：2012-10-21T06:07:57.867

如果您正在使用`startsWith()`，`endsWith()`那么您必须小心前导空格。这是一个完整的例子：

```
var str1 = " Your String Value Here.!! "; // Starts & ends with spaces    
if (str1.startsWith("Your")) { }  // returns FALSE due to the leading spaces…
if (str1.endsWith("Here.!!")) { } // returns FALSE due to trailing spaces…

var str2 = str1.trim(); // Removes all spaces (and other white-space) from start and end of `str1`.
if (str2.startsWith("Your")) { }  // returns TRUE
if (str2.endsWith("Here.!!")) { } // returns TRUE 
```

* * *

## 回答 #19

> 赞同：-3
> 
> 时间：2013-07-19T21:50:02.373

您还可以通过为数组原型创建自己的原型/扩展来返回以字符串开头的数组的所有成员，即

```
Array.prototype.mySearch = function (target) {
    if (typeof String.prototype.startsWith != 'function') {
        String.prototype.startsWith = function (str){
        return this.slice(0, str.length) == str;
      };
    }
    var retValues = [];
    for (var i = 0; i < this.length; i++) {
        if (this[i].startsWith(target)) { retValues.push(this[i]); }
    }
    return retValues;
}; 
```

并使用它：

```
var myArray = ['Hello', 'Helium', 'Hideout', 'Hamster'];
var myResult = myArray.mySearch('Hel');
// result -> Hello, Helium 
```

# keyboard - 使用箭头键导航

> ID：646632
> 
> 赞同：1
> 
> 时间：2009-03-14T20:14:40.997
> 
> 标签：keyboard, navigation, usability, spatial

使用箭头键在画布中不规则放置和大小的元素（例如表单上的控件）之间导航有哪些普遍接受的做法？

例如，如果当前聚焦的元素是一个 tall 元素 (A)，其高度包含其右侧三个较短的元素（B、C 和 D）：

```
#######    #######
#     #    #  B  #
#     #    #######
#     #
#     #    #######
#  A  #    #  C  #
#     #    #######
#     #  
#     #    #######
#     #    #  D  #
#######    ####### 
```

`Right`当用户按下箭头时，哪些元素应该被聚焦？顶部元素（B）？中间的那个（C）？

如果在用户通过按下将焦点移到 A 之前 D 已经被聚焦`Left`怎么办？当用户随后按下时，焦点是否应该返回到 D `Right`？

我想知道这些场景是否有一些已发布的指南。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T20:23:18.620

我没有研究任何具体的指导方针或任何东西，但似乎在第一种情况下，当你在 A 并且你按 Right 时，它应该转到 B。

如果你在推 A 时已经在 C 或 D 上，那么回到那个位置可能是有意义的。我不太确定这一点，因为用户可能已经从底部到 A 作为到达 B 的“快捷方式”（如果右列中有很多元素，这是有道理的，所以不要去 ( Up-Up-Up-Up-Up-Up 你从左到右）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T20:49:37.840

我认为注意您要导航到的元素“B”也很重要。假设 B 是一个文本框。如果您从 A 转到 B，您会假设用户想要输入输入并自动将光标聚焦在文本框中吗？这将使用户立即使用输入框，但如果他/她想改为移动到 C 或 D，则会立即出现问题。

我认为更重要的是向用户反馈他/她所在的字段。Windows 控件往往会因为显示突出显示的字段而很糟糕，而在 OS X 中，您会在所选控件周围获得独特的突出显示（在大多数情况下）例）。

如果他们想去其他地方，请注意不要妨碍用户。如果他们只想移动到另一个元素，则不要在移动到 AD 后锁定他们的键盘。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T14:41:36.053

通常，浏览控件应遵循用户的自然阅读顺序。在西方文化中，这是从左到右，从上到下。这一直是 Microsoft 的可用性标准，可以追溯到出色的软件设计和[Microsoft Windows 用户体验](https://rads.stackoverflow.com/amzn/click/com/0735605661)[的 Windows 界面指南](https://rads.stackoverflow.com/amzn/click/com/1556156790)。

在您的示例中，通过控件导航应该是 ABCDA-...

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T20:37:41.503

如果你在 A 上并且击中正确，你应该去 B。

如果你在D上，然后你按左，有两个选择：“向左”，即A，或“返回”，即去B。如果选择第二种方式，则无处可去迷路，虽然起初看起来有点奇怪。

也就是说，如果你选择第一种方式，我认为正确的方式是 B：不需要记住你在哪里，只是你在哪里，知道你会在哪里。（“状态不好。不要让用户去想它。”）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-14T21:08:07.513

看看[微软](http://msdn.microsoft.com/en-us/library/aa511279.aspx)对 Vista 应用程序的评价。

# lua - 低级 Lua 解释器

> ID：646633
> 
> 赞同：7
> 
> 时间：2009-03-14T20:14:45.317
> 
> 标签：lua

有没有办法以比标准“lua_pcall”函数调用更细粒度的级别从 C/C++ 程序运行 Lua 代码？理想情况下，我希望能够遍历一个低级字节码指令列表（假设它有这样的东西）并一个接一个地运行它们，这样我就可以编写自己的调度程序，它对事情的控制不仅仅是运行从头到尾一个完整的 Lua 函数。

我想这样做的原因是因为我希望实现 Lua 代码可以调用的 C 函数，这将导致程序等到某个（可能是冗长的）动作完成后再继续执行。在典型的 Lua 脚本中会有很大比例的此类函数调用，因此在操作完成后重写它以使用回调的想法并不实际。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-03-14T20:22:26.983

也许回避这个问题，但您可以使用 Lua 协程而不是自定义 C 的东西来等到某个事件发生。

例如，一个协程可以调用 waitForEvent() 函数。在那里，您可以切换到另一个 coro，直到该事件发生，然后恢复第一个。查看[lua coro 文档](http://www.lua.org/pil/9.1.html)以了解更多信息。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-14T20:56:40.693

如果您可以使用 Lua 的协作线程（显式屈服）功能编写那些等待已久的 C 例程，Jder 使用协程的建议将非常有效。您仍将使用 lua_pcall() 进入 Lua，但入口点将是您的协程管理器函数。

这只有在 C 例程在等待时不做任何事情时才有效。如果它们因为计算某些东西而长时间运行，那么您需要运行多个操作系统线程。Lua 是线程安全的——只需创建多个线程并在每个线程中运行 lua_open()。

来自[http://www.lua.org/pil/24.1.html](http://www.lua.org/pil/24.1.html)

> Lua 库根本没有定义全局变量。它将所有状态保存在动态结构 lua_State 中，指向该结构的指针作为参数传递给 Lua 内部的所有函数。此实现使 Lua 可重入并准备好在多线程代码中使用。

您也可以将这两种方法结合起来。如果你有一个包装 Lua 函数来启动一个 OS 线程，你可以在启动线程后让出。协程管理器将跟踪线程并在它启动的线程完成时继续协程。这使您可以使用单个 Lua 解释器和多个运行纯 C 代码的工作线程。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-15T23:10:24.217

如果您采用操作系统线程方式，请查看[Lua Lanes](http://luaforge.net/frs/?group_id=265)。我会认为它是您想要实现的目标的完美解决方案（= 将一个插件模块添加到混合中，您将使用无缝内置的多线程制作清晰、易于理解和简单的代码）。

请告诉我们您的问题是如何解决的。:)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-14T20:19:06.650

[调试界面](http://www.lua.org/manual/5.1/manual.html#3.8)有帮助吗？

# javascript - javascript块内的XSL标签

> ID：646635
> 
> 赞同：3
> 
> 时间：2009-03-14T20:15:11.823
> 
> 标签：javascript, xslt, scripting

我需要我的 XSL 将动态内容添加到 javascript 块。我想知道这是否可能。这是我想做的一个例子。以下代码不起作用：

```
<script>
    // Loads the video.
    var s1 = new SWFObject("player-viral.swf","ply","670","350","9","#ffffff");
    s1.addParam("allowfullscreen","true");
    s1.addParam("allownetworking","all");
    s1.addParam("allowscriptaccess","always");
    s1.addParam("flashvars","file=/Portals/0/<xsl:value-of select="MediaUrlFolder"/><xsl:value-of select="ImageUrlFileName"/>&image=/Portals/0/<xsl:value-of select="ImageUrlFolder"/><xsl:value-of select="ImageUrlFileName"/>");
    s1.write("container");
</script> 
```

当我添加 XSL value-of tag 时，解析器会中断`<xsl:value-of select="MediaUrlFolder"/>`。

有解决方案吗？嗨，我可以安全地添加这种代码吗？谢谢！

======================================

现在有一个奇怪的问题（之前肯定存在，但我没有查看源代码）。该`<script>`块根本没有被渲染，里面没有任何东西，甚至没有`<script></script>`标签。你知道为什么会发生这种情况吗？谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T21:05:43.433

您似乎在 MediaUrlFolder 和 ImageUrlFileName 之间缺少一个 /，尽管您的文件夹可能已经有一个尾随 /。此外，您似乎有一个未转义的 & 应该是`&amp`;

我可能更喜欢这种方法：-

```
<script>
    // Loads the video.
    var mediaUrlFolder = '<xsl:value-of select="MediaUrlFolder"/>'
    var imageUrlFileName = '<xsl:value-of select="ImageUrlFileName"/>'
    var imageUrlFolder = '<xsl:value-of select="ImageUrlFolder"/>'
    var s1 = new SWFObject("player-viral.swf","ply","670","350","9","#ffffff");
    s1.addParam("allowfullscreen","true");
    s1.addParam("allownetworking","all");
    s1.addParam("allowscriptaccess","always");
    s1.addParam("flashvars","file=/Portals/0/" + mediaUrlFolder  + "/" + imageUrlFileName + "&amp;image=/Portals/0/" + imageUrlFolder + "/" + imageUrlFileName);
    s1.write("container");
</script> 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-07-29T08:33:20.737

```
<xsl:comment>//<![CDATA[
<script>        // Loads the video.        var s1 = new SWFObject("player-viral.swf","ply","670","350","9","#ffffff");        s1.addParam("allowfullscreen","true");        s1.addParam("allownetworking","all");        s1.addParam("allowscriptaccess","always");        s1.addParam("flashvars","file=/Portals/0/<xsl:value-of select="MediaUrlFolder"/><xsl:value-of select="ImageUrlFileName"/>&image=/Portals/0///]]><xsl:value-of select="ImageUrlFolder"/><xsl:value-of select="ImageUrlFileName"/><![CDATA[");        s1.write("container");</script>
//]]></xsl:comment> 
```

# html - 造型`` 在 Internet Explorer 中 有什么方法可以在 IE 中自定义 HTML <select> 的边框和背景？我可以在 Firefox 中使用简单的 CSS 设置边框样式，但在 IE 中显然不行。IE 很可能处于怪癖模式。以前版本的 IE 本身并没有绘制 select 元素，因此无法正确设置样式（以及一些 z-order 怪癖），所以在 IE < 8 上你根本无法做到，除非你重新实现类似于 JS 中的选择。看看开发者工具（F12）看看IE是在哪个浏览器

> ID：646639
> 
> 赞同：5
> 
> 时间：2009-03-14T20:17:04.000
> 
> 标签：html, css, internet-explorer, internet-explorer-8, html-select

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-14T20:42:31.383

IE 很可能处于怪癖模式。以前版本的 IE 没有`select`自己绘制元素，因此无法正确设置样式（以及一些 z-order 怪癖），所以在 IE < 8 上你根本无法做到这一点，除非你重新实现某些东西就像`select`在 JS 中一样。看看开发者工具（F12）看看IE是在哪个浏览器和文档模式下；如果浏览器模式显示“Internet Explorer 8”而不是文档模式显示“Quirks 模式”，你应该没问题 :)

以下代码段在这里可以正常工作（IE8β2）：

```
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
            "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <head>
        <style type="text/css">
            select {
                border: 1px solid red;
            }
        </style>
    </head>
    <body>
        <form>
            <select>
                <option>1</option>
                <option>2</option>
            </select>
        </form>
    </body>
</html> 
```

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2012-06-12T21:57:05.437

在您的代码中包含这些标签：

```
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
</head> 
```

这将解决与 Internet Explorer 相关的问题。

# python - 如何在 Python 中获取列表的最后一项？

> ID：646644
> 
> 赞同：379
> 
> 时间：2009-03-14T20:19:44.587
> 
> 标签：python, list, slice

我需要列表的最后 9 个数字，我确信有一种方法可以通过切片来实现，但我似乎无法理解。我可以像这样得到前 9 个：

```
num_list[0:9] 
```

* * *

## 回答 #1

> 赞同：663
> 
> 时间：2009-03-14T20:22:54.987

为此，您可以将负整数与切片运算符一起使用。这是使用 python CLI 解释器的示例：

```
>>> a = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
>>> a
[1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12]
>>> a[-9:]
[4, 5, 6, 7, 8, 9, 10, 11, 12] 
```

重要的线是`a[-9:]`

* * *

## 回答 #2

> 赞同：121
> 
> 时间：2009-03-14T20:21:07.267

负索引将从列表末尾开始计算，因此：

```
num_list[-9:] 
```

* * *

## 回答 #3

> 赞同：86
> 
> 时间：2014-07-07T22:10:41.003

# 切片

Python 切片是一种非常快速的操作，它是一种快速访问部分数据的便捷方式。

从列表（或任何其他支持它的序列，如字符串）中获取最后九个元素的切片表示法如下所示：

```
num_list[-9:] 
```

当我看到这一点时，我将括号中的部分读为“从末尾到末尾的第 9 个”。（其实我在心里把它缩写成“-9, on”）

## 解释：

完整的符号是

```
sequence[start:stop:step] 
```

但是冒号告诉 Python 你给了它一个切片而不是一个常规索引。这就是为什么在 Python 2 中复制列表的惯用方式是

```
list_copy = sequence[:] 
```

清除它们是：

```
del my_list[:] 
```

（列表在 Python 3 中得到`list.copy`和。）`list.clear`

## 给你的切片一个描述性的名字！

您可能会发现将形成切片与将切片传递给`list.__getitem__`方法分开是很有用的（[这就是方括号的作用](https://docs.python.org/2/reference/datamodel.html#object.__getitem__)）。即使您不熟悉它，它也可以使您的代码更具可读性，以便可能必须阅读您的代码的其他人可以更容易地理解您在做什么。

但是，您不能只将一些用冒号分隔的整数分配给变量。您需要使用切片对象：

```
last_nine_slice = slice(-9, None) 
```

第二个参数 ,`None`是必需的，因此第一个参数被解释为`start`参数[，否则它将是`stop`参数](https://docs.python.org/2/library/functions.html#slice)。

然后，您可以将切片对象传递给您的序列：

```
>>> list(range(100))[last_nine_slice]
[91, 92, 93, 94, 95, 96, 97, 98, 99] 
```

# `islice`

`islice`来自 itertools 模块是获得此功能的另一种可能的高性能方式。`islice`不接受否定论点，因此理想情况下，您的可迭代对象有一个`__reversed__`特殊的方法 - 列表*确实*有 - 因此您必须首先将列表（或可迭代的`__reversed__`）传递给`reversed`.

```
>>> from itertools import islice
>>> islice(reversed(range(100)), 0, 9)
<itertools.islice object at 0xffeb87fc> 
```

islice 允许对数据管道进行惰性求值，因此要实现数据，请将其传递给构造函数（如`list`）：

```
>>> list(islice(reversed(range(100)), 0, 9))
[99, 98, 97, 96, 95, 94, 93, 92, 91] 
```

* * *

## 回答 #4

> 赞同：45
> 
> 时间：2009-03-15T04:27:16.677

最后 9 个元素可以根据需要使用 numlist[-9:] 从左到右读取，或者使用 numlist[:-10:-1] 从右到左读取。

```
>>> a=range(17)
>>> print a
[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16]
>>> print a[-9:]
[8, 9, 10, 11, 12, 13, 14, 15, 16]
>>> print a[:-10:-1]
[16, 15, 14, 13, 12, 11, 10, 9, 8] 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2017-08-22T19:50:20.283

以下是获取可迭代的“尾部”项的几个选项：

**给定**

```
n = 9
iterable = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10] 
```

期望的输出

```
[2, 3, 4, 5, 6, 7, 8, 9, 10] 
```

**代码**

我们使用以下任何选项获得后者的输出：

```
from collections import deque
import itertools

import more_itertools

# A: Slicing
iterable[-n:]

# B: Implement an itertools recipe
def tail(n, iterable):
    """Return an iterator over the last *n* items of *iterable*.

        >>> t = tail(3, 'ABCDEFG')
        >>> list(t)
        ['E', 'F', 'G']

    """
    return iter(deque(iterable, maxlen=n))
list(tail(n, iterable))

# C: Use an implemented recipe, via more_itertools
list(more_itertools.tail(n, iterable))

# D: islice, via itertools
list(itertools.islice(iterable, len(iterable)-n, None))

# E: Negative islice, via more_itertools
list(more_itertools.islice_extended(iterable, -n, None)) 
```

* * *

**细节**

*   A. 传统的 Python[切片](https://stackoverflow.com/questions/509211/explain-slice-notation)是该语言固有的。此选项适用于字符串、列表和元组等[序列。](https://docs.python.org/2.4/lib/typesseq.html)但是，这种切片不适用于[迭代器](https://stackoverflow.com/questions/9884132/what-exactly-are-pythons-iterator-iterable-and-iteration-protocols)，例如`iter(iterable)`.
*   B.[`itertools`食谱](https://docs.python.org/3/library/itertools.html#itertools-recipes)。它适用于任何可迭代对象，并解决了最后一个解决方案中的迭代器问题。这个配方必须手动实现，因为它没有正式包含在`itertools`模块中。
*   C. 许多配方，包括后一种工具 (B)，已在第三方包中方便地实现。安装和导入这些库可以避免手动实现。其中一个库被称为`more_itertools`（通过安装`> pip install more-itertools`）；见[`more_itertools.tail`](https://more-itertools.readthedocs.io/en/latest/api.html#more_itertools.tail)。
*   D.`itertools`图书馆成员。注意，`itertools.islice` [不支持负切片](https://docs.python.org/3/library/itertools.html#itertools.islice)。
*   E. 另一个工具实现了`more_itertools`泛化`itertools.islice`以支持负切片；见[`more_itertools.islice_extended`](https://more-itertools.readthedocs.io/en/latest/api.html#more_itertools.islice_extended)。

*我用哪一个？*

*这取决于*. 在大多数情况下，切片（选项 A，如其他答案中所述）是最简单的选项，因为它内置在语言中并支持大多数可迭代类型。对于更通用的迭代器，请使用任何剩余选项。请注意，选项 C 和 E 需要安装第三方库，一些用户可能会觉得这很有用。

# tomcat - 从 Maven 开始时 Tomcat 的备用端口（不是 8080）？

> ID：646649
> 
> 赞同：77
> 
> 时间：2009-03-14T20:22:17.297
> 
> 标签：tomcat, maven-2

是否有一种简单的方法可以在 pom 或命令行中为 Tomcat 指定备用端口。我想在同一台机器上运行多个项目。

* * *

## 回答 #1

> 赞同：109
> 
> 时间：2011-07-01T12:51:55.580

我知道这个帖子很旧，但是……</p>

Greg 提供的文档链接很有趣：

```
port:
The port to run the Tomcat server on.
    Type: int
    Required: No
    Expression: ${maven.tomcat.port}
    Default: 8080 
```

表达式是 Maven 用来在其代码中获取值的。它可以来自配置文件，也可以来自命令行。

你可以跑

```
mvn -Dmaven.tomcat.port=8181 tomcat:run-war 
```

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2010-04-09T15:06:12.547

使用[tomcat-maven-plugin](https://tomcat.apache.org/maven-plugin-trunk/run-mojo-features.html)上给出的语法，您可以直接指定端口：

> ```
> <plugin>
>   <groupId>org.codehaus.mojo</groupId>
>   <artifactId>tomcat-maven-plugin</artifactId>            
>   <configuration>          
>     <server>tomcat-development-server</server>
>     <port>9966</port>
>   </configuration>
> </plugin> 
> ```

* * *

## 回答 #3

> 赞同：28
> 
> 时间：2012-09-26T19:44:37.987

当我有几个同时运行集成测试阶段的小 servlet 时，我遇到了类似的问题，这成为一个问题，因为它们被配置为使用相同的端口。但是由于[build-helper-maven-plugin:reserve-network-port](http://mojo.codehaus.org/build-helper-maven-plugin/reserve-network-port-mojo.html)目标，可以获得可用的随机端口号。然后，我可以创建一个包含*[http://localhost:[port]/[servletname]](http://localhost:[port]/[servletname])*的 URL ，该 URL[将输入到](http://maven.apache.org/plugins/maven-failsafe-plugin/integration-test-mojo.html#systemPropertyVariables)Java 测试类中。

**检索随机端口**：

```
<plugin>
<groupId>org.codehaus.mojo</groupId>
<artifactId>build-helper-maven-plugin</artifactId>
<version>1.7</version>
<executions>
    <execution>
        <id>reserve-network-port</id>
        <goals>
            <goal>reserve-network-port</goal>
        </goals>
        <phase>pre-integration-test</phase>
        <configuration>
            <portNames>
                <portName>tomcat.http.port</portName>
            </portNames>
        </configuration>
    </execution>
</executions> 
```

**用端口启动tomcat**

```
<plugin>
<groupId>org.apache.tomcat.maven</groupId>
<artifactId>tomcat6-maven-plugin</artifactId>
<configuration>
    <port>${tomcat.http.port}</port>
    <useTestClasspath>true</useTestClasspath>
</configuration>
....
</plugin> 
```

**将 URL 提供给故障安全插件运行的 Java 集成测试**

```
<plugin>
<groupId>org.apache.maven.plugins</groupId>
<artifactId>maven-failsafe-plugin</artifactId>
<version>2.12.3</version>
....
<configuration>
    <systemPropertyVariables>
        <integration-test.url>http://localhost:${tomcat.http.port}/${project.build.finalName}/</integration-test.url>
    </systemPropertyVariables>
</configuration>
</plugin> 
```

**Java 代码**

```
public class DownloadAreaIT {
    private static final String URL = System.getProperty("integration-test.url");
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2015-12-02T17:23:40.303

下面为我​​工作：

```
 <properties>
            <maven.tomcat.port>9090</maven.tomcat.port>
        </properties>

        <plugin>
            <groupId>org.apache.tomcat.maven</groupId>
            <artifactId>tomcat7-maven-plugin</artifactId>
            <version>2.2</version>
            <configuration>
                <port>${maven.tomcat.port}</port>
            </configuration>
        </plugin> 
```

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2013-08-06T15:43:50.997

您可以通过向其添加属性端口来永久添加端口配置。

```
<build>
    <plugins>
        <plugin>
            <groupId>org.apache.tomcat.maven</groupId>
            <artifactId>tomcat7-maven-plugin</artifactId>
            <version>2.0</version>
            <configuration>
                <port>9090</port>
            </configuration>
        </plugin>
    </plugins>
</build> 
```

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2016-11-02T10:15:01.600

从 Maven 开始时，有最好和最简单的方法来更改 Tomcat（不是 8080）

只需编辑您的 application.properties（如果您没有 application.properties 文件，则在您的 maven 项目的资源目录中创建一个 application.properties 文件）文件并设置以下行
**server.port=8181** //您可以选择您的端口号。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-14T21:12:34.897

如果您使用的是 maven tomcat 插件，您可以通过将插件配置块添加到 pom.xml来[指定 context.xml ：](http://mojo.codehaus.org/tomcat-maven-plugin/examples/deployment.html)

```
<project>
  ...
  <build>
    <plugins>
      <plugin>
        <groupId>org.codehaus.mojo</groupId>
        <artifactId>tomcat-maven-plugin</artifactId>
        <version>1.0-beta-1</version>
        <configuration>
          <mode>both</mode>
        </configuration>
      </plugin>
    </plugins>
  </build>
  ...
</project> 
```

使用的默认 context.xml 文件位于`src/main/webapp/META-INF/context.xml`.

在那里设置不同的端口。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2013-06-22T21:33:19.270

我认为最好和最简单的是（如果您的测试正确绑定到集成阶段）：

```
<plugin>
    <groupId>org.codehaus.mojo</groupId>
    <artifactId>build-helper-maven-plugin</artifactId>
    <executions>
        <execution>
            <id>reserve-network-port</id>
            <goals>
                <goal>reserve-network-port</goal>
            </goals>
            <phase>pre-integration-test</phase>
            <configuration>
                <portNames>      
                    <portName>maven.tomcat.port</portName>
                </portNames>
            </configuration>
        </execution>
    </executions>
</plugin> 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2017-08-05T03:57:28.910

```
<plugin>
    <groupId>org.apache.tomcat.maven</groupId>
    <artifactId>tomcat7-maven-plugin</artifactId>
    <version>2.2</version>
    <configuration>
        <server>tomcat-development-server</server>
        <port>9090</port>
    </configuration>
</plugin> 
```

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2018-05-05T03:23:15.013

我知道这是一个非常古老的问题，还没有答案。

当我需要将使用外部 tomcat 的旧项目转换为使用 tomcat7-maven-plugin 的嵌入式 tomcat 时，我遇到了类似的问题。

我需要的是构建一个可执行的 jar。但是现有的答案对我不起作用……无论我`java -jar project-name.jar`追求什么`mvn package`。它总是在我不想要的端口上运行`8080`......然后我搜索文档[可执行战争](https://tomcat.apache.org/maven-plugin-2.2/executable-war-jar.html) ，我修复的只是在命令中添加一个参数

```
java -jar my_project.jar -httpPort 9091 
```

在文档中：

> 用法：java -jar [你的 exec 战争 jar 的路径] ...
> 
> -httpPort 使用的http端口
> 
> -httpsPort https 端口使用...

希望它有用。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2017-06-30T11:54:46.290

在花了大约 3 个小时研究如何更改 POM.xml 中的端口后，这是我最新的解决方案。

```
<plugin>
  <groupId>org.apache.tomcat.maven</groupId>
  <artifactId>tomcat7-maven-plugin</artifactId>
  <version>2.2</version>
  <configuration>
  <maven.tomcat.port>8081</maven.tomcat.port>
  </configuration>
 </plugin> 
```

使用 just`port`不起作用，因为这不是您可以设置的属性`<configuration>`。我们需要了解导致问题的原因。就我而言，错误是该端口`8080`被占用。我将端口更改为`server.xml`，`8081`但 Maven 没有从那里获取它。我们需要在`configuration`现场具体说明。这是`<maven.tomcat.port>8081</maven.tomcat.port>`救援的地方。注意：您可以将端口 8081 更改为您喜欢的其他端口。

# python - 让 pywin32 excelAddin.py 在 Windows XP Microsoft Excel 2007 上工作

> ID：646652
> 
> 赞同：3
> 
> 时间：2009-03-14T20:22:30.183
> 
> 标签：python, excel, windows-xp, add-in, pywin32

我正在尝试使用 python 2.5.4 和 pywin32 在 Windows XP 上为 Microsoft Office Excel 2007 获取演示脚本：[Python for Windows Extensions](https://sourceforge.net/projects/pywin32/)

虽然 Com 加载项注册成功并显示在 Excel 的“com 加载项”列表中，但它不起作用。

我得到的唯一错误反馈是在 excel 的“com 加载项”对话框中的“加载行为”行中，显示“未加载。`runtime`加载 com 加载项期间发生错误”

是否`excel`或`office，在系统的任何地方登录？我怎样才能找出问题所在？

# refactoring - 过早重构？

> ID：646653
> 
> 赞同：19
> 
> 时间：2009-03-14T20:22:35.283
> 
> 标签：refactoring, anti-patterns

我们都听说过[过早优化](http://en.wikipedia.org/wiki/Program_optimization#When_to_optimize)，但是您如何看待过早重构？你认为有这样的事情吗？这就是我的意思。

首先，阅读 Martin Fowler 的开创性著作[《重构》](http://refactoring.com/)从字面上改变了我在编程方面的生活。

然而，我注意到的一件事是，如果我开始过快地重构一个类或框架，我有时会发现自己被编码到一个角落里。现在，我怀疑问题本身并不是真正的重构，而可能是过早/糟糕的设计决策/假设。

您对这个问题有什么想法、见解和/或意见？您对此问题有什么建议或常见的反模式吗？

**编辑：**

通过阅读您的答案并更多地反思这个问题，我想我已经意识到我在这种情况下的问题实际上是一个“过早的设计”问题，而不一定是“过早的重构”。在编码过程的早期，我一直在假设一个设计并朝那个方向重构。保持一定程度的设计不可知论并专注于重构以实现干净的代码，我有一点耐心，这将使我不会走上这些设计兔子的道路。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-03-14T20:27:51.823

其实我的想法正好相反。

你越早开始考虑你的设计是否需要重构越好。不断地重构，所以它从来都不是一个大问题。

我还发现，我越早重构，就越能更好地提前编写代码。我倾向于创建更少的大型方法，并且问题更少。

但是，如果您发现自己将自己“重构”到了一个角落，我认为这更多的是缺乏初始设计或缺乏对类的使用范围的规划。在开始编写代码之前，试着写出你想如何使用类或框架——它可以帮助你避免这个问题。这也是我认为测试驱动设计的一个优势——它可以帮助你强迫自己在编写对象之前考虑使用它。

请记住，从技术上讲，重构永远不应该把你锁在角落里——它是在不改变类使用方式的情况下重新设计内部结构。如果你用重构来困住自己，那意味着你最初的设计是有缺陷的。

您可能会发现，随着时间的推移，这个问题会变得越来越好。您的类和框架设计最终可能会更加灵活。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-14T21:44:55.943

> 我们都听说过过早优化，但是您对过早重构有什么看法？你认为有这样的事情吗？

就在这里。重构是一种偿还在整个开发过程中累积的*技术债务的方法。*然而，仅仅积累技术债务并不一定是坏事。

要了解原因，假设您正在为 IRS 编写纳税申报表分析软件。突然，在最后一刻引入了新的规定，打破了你最初的几个假设。尽管您设计得很好，但您的领域模型至少在一个重要的地方已经从根本上转移到了您的脚下。现在是 4 月 14 日，该项目明天必须上线，无论是地狱还是高潮。你做什么工作？

*   如果您以一些适度的技术债务为代价来实施一个具体的解决方案，您的系统将变得更加僵化，并且无法承受另一轮这些变化。但是网站可以上线继续进行，不存在延迟交付的风险；您有信心可以进行所需的更改。
*   另一方面，如果您花时间重构解决方案，以便它现在以更复杂和灵活的方式支持新设计，那么您在适应未来的变化时将毫无困难。但是你冒着公司的旗舰产品争分夺秒的风险；您不确定重新设计是否会比今天花费更长的时间。

在这种情况下，第一个选项是更好的选择。假设您以前几乎没有技术债务，那么现在收下您的资金并在以后还清是值得的。当然，这是一项商业决策，而不是设计决策。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-14T20:43:33.907

我认为重构过早是可能的。

**设计**的具体细节是代码本身。设计的最后阶段在您编写代码时就存在，它有时会存在缺陷，随着代码的发展，您会看到这一点。如果你过早地重构，就很难改变有缺陷的设计。

例如，当你意识到它是垃圾或方向错误时删除一个长函数比删除一个格式良好的函数及其使用的函数和它们使用的函数等要容易得多，同时确保您不会破坏重构中的其他内容。

可以说，也许您应该花更多的时间进行设计，但敏捷过程中的一个关键要素是编码是设计过程的一部分，并且在大多数情况下，在设计中付出了一些合理的努力后，最好继续用它。

**编辑**回应评论： -

在您编写代码之前，设计尚未完成。我们无法解决预编码设计中的**所有问题，敏捷背后的全部意义在于编码****就是**解决问题。如果非代码设计在编码之前预先解决了所有问题，则无需**重新**分解，我们只需一步将设计转换为分解良好的代码。

任何人都记得 1980 年代末和 1990 年代初的结构化设计方法，在您编写一行代码之前，您可以在巧妙的图表中解决所有问题？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-14T22:23:46.693

**过早重构是没有单元测试的重构。**那时你还没有准备好进行重构。首先进行一些单元测试，然后开始考虑重构。否则，您将（可能）伤害项目多于帮助。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-14T20:26:57.520

我认为任何“1.0”项目都容易受到这种......我们称之为“迭代设计”。如果在开始设计对象之前没有明确的规范，您可能会想到许多设计和解决问题的方法。

所以，我认为克服这个特定问题是在开始编写代码之前清楚地设计事物。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-14T20:31:34.433

视情况而定，有几个有前途的解决方案可以解决这类问题。

如果问题是您决定可以以某种方式优化某些东西，并且您提取了一种方法或某些东西并意识到由于该决定，您被迫以一种复杂的方式对其他所有内容进行编码，那么问题可能是您没有在设计过程中想得不够远。如果有一个精心编写和计划好的规范，你会提前知道这个问题（除非你没有阅读规范，但这是另一个问题:)）

根据具体情况，快速原型制作也可以解决这个问题，因为当您开始实际工作时，您将对这些实现细节有更好的了解。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-14T20:53:19.343

我坚信不断重构。没有理由等到某个特定时间开始重构。

任何时候你看到一些应该做得更好的事情，重构。

请记住这一点。我认识一个开发人员（一个纯粹的天才），他进行了如此多的重构（他非常聪明，总能找到更好的方法）他从未完成过一个项目。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-14T21:07:29.700

过早优化不好的原因是优化通常会导致更糟糕的设计。与重构不同，重构会带来更好、更简洁的设计，如果做得深思熟虑和正确的话。我学到的对我分析重构有用性有用的是首先查看我们的 UML 图以可视化更改，然后首先为类编写代码文档（例如 Javadoc），并在任何实际代码之前添加存根。当然，经验对此有很大帮助，如果有疑问，请询问您最喜欢的建筑师；）

# html - HTML 锚标记中超链接文本的内联换行

> ID：646657
> 
> 赞同：9
> 
> 时间：2009-03-14T20:24:51.410
> 
> 标签：html, css, formatting, hyperlink

我正在尝试找到一种方法来允许 HTML 链接中的非常长的文本进行换行，同时将链接包含在一个紧凑的矩形中。

本质上，我想要这个：

```
                      真的，真的
    这是一些文本长链接，   这里是一些更多的文本。
                      在一个矩形周围

```

代替：

```
   这里有一些文本，链接非常长，环绕
   在一个矩形中，这里还有一些文本。

```

我怎样才能做到这一点？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-14T20:38:39.160

你可以在 Firefox 中这样做 - 但它在 IE 中不起作用:(

```
<p>Here is some text <a href="#">with a really, really long link that wraps</a> around in a rectangle and here is some more text.

<style type="text/css">

a {display: inline-block; max-width: 100px; vertical-align: middle;}

</style> 
```

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2014-10-21T19:56:32.933

我知道这已经很老了，但它仍然是我在这个主题上出现的第一批搜索结果之一。我发现使用：

```
white-space: pre-wrap; 
```

强制锚将文本围绕我的宽度限制

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-14T20:46:48.220

您可以`display:inline-block;`在链接上使用 css 属性，这将为您提供您想要的效果（不要忘记设置宽度:)。

IE 不支持 display:inline-block，但幸运的是，有人已经完成了艰苦的工作并在[这里](http://blog.hedgerwow.com/2007/11/14/item-list-grid-real-world-practice-with-displayinline-block-across-browsers/)提出了解决方法。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2015-06-15T20:32:18.153

我最终遇到了这个问题，因为我使用的是引导程序，默认情况下将其设置为其中一种样式

```
.dropdown-menu > li > a{
    white-space: nowrap;
} 
```

这使得“word-break”和“width”css属性无法实际解决问题

所以我首先必须将该空白属性设置为“预包装”

# php - PHP 可以从 PowerPoint 文件中读取文本吗？

> ID：646659
> 
> 赞同：2
> 
> 时间：2009-03-14T20:26:14.963
> 
> 标签：php, powerpoint

我想让 PHP 阅读（上传的）PowerPoint 演示文稿，并从每张幻灯片中提取最少的文本（获取更多信息，如图像和布局甚至会更好，但此时我只满足于文本）。

我知道谷歌应用程序在其演示应用程序中执行此操作，所以我猜测有一些方法可以翻译 powerpoint 二进制文件，但我似乎找不到任何有关如何执行此操作的信息。

关于尝试什么的任何想法？

谢谢 -

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-15T01:52:09.000

根据版本，您可以查看 Zend 框架，因为 Zend_Search_Lucene 能够索引 PowerPoint 2007 文件。看看相应的类文件，我认为它类似于`Zend_Search_Lucene_Document_Pptx`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T20:55:56.577

是的，当然这是可能的。

[这是一个开始。]( [http://download.microsoft.com/download/0/B/E/0BE8BDD7-E5E8-422A-ABFD-4342ED7AD886/PowerPoint97-2007BinaryFileFormat(ppt)Specification.pdf)](http://download.microsoft.com/download/0/B/E/0BE8BDD7-E5E8-422A-ABFD-4342ED7AD886/PowerPoint97-2007BinaryFileFormat(ppt)Specification.pdf))我不会说它有很好的文档/格式，但是一旦你开始它并不难。首先只关注您需要的元素（幻灯片、文本等）。

一个不太详细和更简单的方法是在十六进制编辑器中打开 .ppt 文件并查找您感兴趣的信息（您应该能够看到二进制数据中的文本）及其周围的内容。然后根据围绕该信息的内容，您可以编写一个解析器来提取该信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2010-05-19T16:02:14.123

这是我从 Word 文档中提取文本的[类似](https://stackoverflow.com/questions/188452/reading-writing-a-ms-word-file-in-php/265017#265017)函数创建的示例函数。我用 Microsoft PowerPoint 文件对其进行了测试，但它不会解码保存为 .ppt 的 OpenOfficeImpress 文件

对于 .pptx 文件，您可能需要查看 Zend Lucene。

```
 function parsePPT($filename) {
    // This approach uses detection of the string "chr(0f).Hex_value.chr(0x00).chr(0x00).chr(0x00)" to find text strings, which are then terminated by another NUL chr(0x00). [1] Get text between delimiters [2] 
    $fileHandle = fopen($filename, "r");
    $line = @fread($fileHandle, filesize($filename));
    $lines = explode(chr(0x0f),$line);
    $outtext = '';

    foreach($lines as $thisline) {
        if (strpos($thisline, chr(0x00).chr(0x00).chr(0x00)) == 1) {
            $text_line = substr($thisline, 4);
            $end_pos   = strpos($text_line, chr(0x00));
            $text_line = substr($text_line, 0, $end_pos);
            $text_line = preg_replace("/[^a-zA-Z0-9\s\,\.\-\n\r\t@\/\_\(\)]/","",$text_line);
            if (strlen($text_line) > 1) {
                $outtext.= substr($text_line, 0, $end_pos)."\n";
            }
        }
    }
    return $outtext;
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-04T15:49:26.977

我想对此发表我的决心。

不幸的是，我无法让 PHP 可靠地读取二进制数据。

我的解决方案是编写一个小型 vb6 应用程序，通过自动化 PowerPoint 来完成这项工作。

不是我想要的，但是，现在解决了这个问题。

话虽如此，Zend 选项看起来在某些时候可能是可行的，所以我会注意的。

谢谢。

# c++ - 奇怪的临时数组损坏

> ID：646660
> 
> 赞同：1
> 
> 时间：2009-03-14T20:26:34.760
> 
> 标签：c++, arrays, corrupt

我正在尝试创建一个排列，当我完成我的问题时收到这个奇怪的错误：

```
Stack around the variable "temp" was corrupted 
```

变量的段在嵌套的 for 循环中：

```
for(int i = 0 ; i < str_length ; i++)
{
    for(int j = 0 ; j < str_length ; j++)
    {
        char temp[1];

        temp[1] = text[i];
        text[i] = text[j];
        text[j] = temp[1];

        cout << text << endl;
    }
} 
```

text 在 for 循环之外被初始化为字符串，当我将 temp[1] 转换为 char 或 int 时，我得到了同样的错误。该程序运行良好，但我担心为什么会收到此错误，有人知道为什么吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-14T20:29:11.023

你只需要使用`char temp;`和访问它`temp = text[i];`，等等。

您正在访问堆栈上一个字节的 PAST temp 点，这是无效的。在这种情况下，由于您只需要一个字符，因此根本不需要数组。

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-03-14T20:29:55.733

temp[1] 不存在，你应该做 temp[0]。或者，像这样：

```
char temp;
temp = text[i];
text[i] = text[j];
text[j] = temp; 
```

或者

```
char temp[1];
temp[0] = text[i];
text[i] = text[j];
text[j] = temp[0]; 
```

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-14T20:27:54.833

用于`temp[0]`访问第一个元素

# macos - 如何为我的应用程序的 Mac OS X 应用程序包设置图标？

> ID：646671
> 
> 赞同：24
> 
> 时间：2009-03-14T20:30:16.497
> 
> 标签：macos

我有一个捆绑到 Mac OS X 应用程序包中的应用程序。一切正常，但我想改变它的默认图标。如何设置它的图标？谢谢。

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-14T20:34:12.197

在你的`info.plist`添加

```
<key>CFBundleIconFile</key>
<string>iconfile</string> 
```

`iconfile.icns`在资源目录中带有图标文件

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2015-08-07T17:06:27.517

我制作了一个小脚本，它拍摄一张大图像并将其调整为 Mac OS 的所有预期图标大小，包括用于视网膜显示器的双倍图标大小。它需要原始 png 文件，我希望它与最大尺寸一样大，如果不是更大的话，以确保它们以最高质量呈现。

它调整它们的大小并将它们复制到一个图标集，并使用 Mac OS 的“iconutil”工具将它们连接到一个 .icns 文件中。

要运行此脚本，您需要将原始图标文件设为 png，并且您的包或多或少处于工作状态。您只需要触摸前三行。

```
export PROJECT=Myproject
export ICONDIR=$PROJECT.app/Contents/Resources/$PROJECT.iconset
export ORIGICON=Mybigfile.png

mkdir $ICONDIR

# Normal screen icons
for SIZE in 16 32 64 128 256 512; do
sips -z $SIZE $SIZE $ORIGICON --out $ICONDIR/icon_${SIZE}x${SIZE}.png ;
done

# Retina display icons
for SIZE in 32 64 256 512; do
sips -z $SIZE $SIZE $ORIGICON --out $ICONDIR/icon_$(expr $SIZE / 2)x$(expr $SIZE / 2)x2.png ;
done

# Make a multi-resolution Icon
iconutil -c icns -o $PROJECT.app/Contents/Resources/$PROJECT.icns $ICONDIR
rm -rf $ICONDIR #it is useless now 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2014-06-06T04:05:59.963

如果您来这里是因为您只有一个应用程序并且只想更改计算机上的图像（不确定它是如何进行共享的），那么还有更简单的方法。特别是，这里有两个我使用过的选项：

1.  如果要复制现有图标：

    *   选择源项目并按 Cmd-I (Apple-I)
    *   选择要更改的项目并按 Cmd-I (Apple-I)
    *   将图标从源拖动到您要更改的图标的左上角（示例图像显示目标图标：它是“bird_id 2”字样左侧的“文件夹”图标）： ![在此处输入图像描述](https://i.stack.imgur.com/Nuc01.png)
2.  从任何图像创建一个 .icns 文件。如果您使用 MacPorts，我建议您改用端口 makeicns - 请参阅下文了解更多信息。[您也可以按照https://discussions.apple.com/thread/2773825](https://discussions.apple.com/thread/2773825)的建议，使用[http://www.img2icnsapp.com/](http://www.img2icnsapp.com/)等应用程序来执行此操作。

```
makeicns v1.4.10 (284bd686824f)

用法：makeicns [k1=v1] [k2=v2] ...

键和值包括：
    512：512x512 图标变体的输入图像名称
    256：256x256 图标变体的输入图像名称
    128：128x128 图标变体的输入图像名称
     32：32x32 图标变体的输入图像名称
     16：16x16 图标变体的输入图像名称
     in：所有没有明确名称的变体的输入图像的名称
    out：输出文件的名称，默认为第一个非空输入名称，
         但带有 icns 扩展名

  align: [center, left, right, top, bottom] {第一个字母就够了！}

例子：

  makeicns -512 图像.png -32 图像.png
      创建仅具有 512x512 和 32x32 变体的 image.icns。

  makeicns -in myfile.jpg -32 otherfile.png -out outfile.icns
      创建包含数据的大小为 512、256、128 和 16 的 outfile.icns
      来自 myfile.jpg，大小为 32，包含来自 otherfile.png 的数据。

```

# linux - Shell 脚本 - 两个 for 循环和更改文件扩展名

> ID：646672
> 
> 赞同：0
> 
> 时间：2009-03-14T20:31:19.507
> 
> 标签：linux, bash, shell, command-line

我有这个 Shell 脚本，我设法把它搞砸了，我希望我能得到纠正并走上正确的道路，并希望添加一些我自己没有能力做的事情。我已经在下面的 Shell 脚本中添加了我想要做的注释。

```
#!/bin/bash
#Get all files from dir "videos" and send to processLine function one at a time
cd /home/test/videos/
for file in `dir -d *` ; do
processLine -f $file
done

processLine(){
# I was hoping to have a further for loop that would loop 4 times and change the $ext
#variable to avi, mpg, wmv and mov
#For loop, execute a command on each file
for i in 1 2 3 4 5 6 7 8 9 10
do
START=$(date +%s.%N)
echo "$line"
#The saved file in done dir should have filename as $file + START.
eval "ffmpeg -i $file -ar 44100 /home/test/videos/done/$fileSTART.$ext" > /dev/null 2>&1

END=$(date +%s.%N)
DIFF=$(echo "$END - $START" | bc)

echo "$line, $START, $END, $DIFF" >> file.csv 2>&1
echo "It took $DIFF seconds"
echo $line
done
} 
```

该脚本的基本思想是：从 dir 获取所有文件并在它们上运行 ffmpeg 命令，看看需要多长时间。我正在尝试收集一些统计数据

感谢您的任何帮助

## 更新

利用 Juliano 的脚本并交换循环 2 和 3。我设法在下面得到了这个输出：

```
.
.
.
/home/test/videos/done 8 mov took 0.012 seconds
/home/test/videos/done 9 mov took 0.012 seconds
/home/test/videos/video1236104961.flv 0 avi took 0.446 seconds 
```

它停在那里。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T21:10:42.703

很多事情都是错的。

1.  不要在 for 循环中使用 dir 或 ls。
2.  为什么要评估？你期望得到什么？
3.  您使用 $line 而不定义它。
4.  不要使用 bc 来做数学，因为 bash 已经具备了这样做的能力。
5.  不要使用日期来测量时间，bash 已经为此提供了一个命令。
6.  传递给 processLine() 的“-f”是什么？

再次尝试，修复一些问题：

```
#!/bin/bash
TIMEFORMAT=%6R
for file in /home/test/videos/* ; do
  if [ ! -f "$file" ]; then
    continue   # anything that is not a regular file
  fi
  for ext in avi mpg wmv mov; do
    for (( i = 0; i < 10; i++ )); do
      base="${file##*/}"
      elapsed=$({ time ffmpeg -i "$file" -ar 44100 -y "${file%/*}/done/${base%.*}-$i.$ext" &>/dev/null; } 2>&1)
      echo "$file $ext $i took $elapsed seconds"
    done
  done
done 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T20:51:48.940

1）在哪里`$line`定义？

2）你曾经使用过`$i`吗？

3）您可以通过以下方式循环扩展

```
for ext in avi mov mpg wmv; do
    ffmpg ...
done 
```

4）您可以使用双括号在 bash 中进行基本算术运算。所以`$(($x-$y))`而不是管道到 bc

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T21:15:24.050

我闻到了一个 bash 陷阱。

```
$ touch aaa
$ touch "bbb ccc"
$ ls -1
aaa
bbb ccc
$ for file in `dir -d *`; do echo $file; done
aaa
bbb\
ccc 
```

# c++ - 如何让 FindFirstFile 对文件进行排序

> ID：646673
> 
> 赞同：5
> 
> 时间：2009-03-14T20:31:34.233
> 
> 标签：c++, c, winapi

我正在使用标准`FindFirst`并`FindNext`检索目录中的所有文件，但我需要对结果进行排序（与单击资源管理器中的名称列基本上对它们进行排序的顺序相同）我怎样才能实现这个必须完成通过 Win32 谢谢

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-03-14T20:37:43.750

您可以为此使用[索引服务](http://msdn.microsoft.com/en-us/library/ms692260(VS.85).aspx)，但我建议您在使用 FindFirstFile 时自己处理排序。

FindFirstFile Win32 API 无法进行排序。有一个稍微高级的[FindFirstFileEx](http://msdn.microsoft.com/en-us/library/aa364419(VS.85).aspx)，但即使这样也不允许排序。

[关于 FindFirstFile 的限制，](http://blogs.msdn.com/oldnewthing/archive/2005/07/21/441330.aspx) Raymond Chen在 The Old New Thing 上发表了一篇文章。

您最好的选择可能是将所有结果加载到一个向量中，然后对其进行排序。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-14T22:14:57.900

正如每个人都指出的那样，`FindFirstFile()`它不会也不能对它返回的文件进行排序。它在相当低的级别上运行，并以与文件系统在目录中的目录条目的自然顺序相关的顺序返回文件。

在使用 FAT 和 FAT32 格式化的磁盘上，该顺序与文件的创建顺序、文件删除修改顺序以及可能重新使用现在空的目录条目插槽的顺序密切相关。这是因为 FAT 目录（就像在许多 unix 文件系统上一样）只是一个固定大小的目录条目结构的打包数组，以及一个丑陋的 hack，用于将用 Unicode 编写的长文件名放入为用 ASCII 编写的 8.3 名称设计的目录结构中。与 Unix 不同，读取目录条目需要 Win32 API 调用，但这不会影响读取条目的顺序。

在 NTFS（据我了解）上，目录以 B 树的某些变体表示，因此 Win32 API 看到的文件的自然顺序与该数据结构的自然索引有关。

您可以`DIR`在命令提示符下查看与命令的差异。在 FAT32 卷上，`DIR`显示文件的顺序与将同一文件夹复制到 NTFS 卷时的顺序不同。`DIR /ON`无论使用的底层文件系统如何，都应该以相同的顺序列出文件。

当您按名称排序时，DIR 生成的未排序顺序与 Windows 资源管理器生成的顺序不同。（就此而言，`DIR /ON`也不相同。）

Windows 资源管理器使用与大小写无关的排序，它似乎也忽略了排序中的一些标点符号，并试图巧妙地处理数字。特别是，简单地使用`qsort()`with`stricmp()`不会得到与 Explorer 相同的答案。目前尚不清楚 Explorer 或 DIR 使用的实际排序顺序是否记录在任何地方。

例如，以下名称在 DIR 中排序如下：

```
C:\temp\test> dir/on/b
aoli.txt
a-one.txt
atwo.txt
b1.txt
b10.txt
b2.txt
b-20.txt
b21.txt
b3.txt
b-4.txt 
```

但从资源管理器转录，在名称列中排序，它们的顺序如下：

```
aoli.txt
a-one.txt
atwo.txt
b1.txt
b2.txt
b3.txt
b10.txt
b21.txt
b-4.txt
b-20.txt 
```

我很难想象在比较函数中应用简单以获得后一种效果。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-05-19T19:20:07.247

您可以通过将文件名放入 std::set 来轻松地对文件名进行排序，如下所示：

```
std::string FileName;
std::set<string> ListOfFileNames;

WIN32_FIND_DATAA findFileData;
HANDLE MyHandle = FindFirstFileA("*.*",&findFileData);

if( MyHandle != INVALID_HANDLE_VALUE)
{
    FileName = findFileData.cFileName;
    ListOfFileNames.insert(FileName);

    while(FindNextFileA(MyHandle,&findFileData) != 0)
    {
        FileName = findFileData.cFileName;
        ListOfFileNames.insert( FileName );
    }
}

FindClose(MyHandle);

// Output the list of names found
for(std::set<string>::iterator Name = ListOfFileNames.begin() ; Name != ListOfFileNames.end() ; ++Name)
{
    cout << *Name << endl;
} 
```

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-14T20:34:29.280

您需要将所有文件名读入一些合适的集合中，然后自己对它们进行排序。Windows API 不提供任何排序​​工具。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-14T20:49:40.320

Win32

首先，使用 findfirst 和 findnext 查找所有文件（请记住，findfirst 和 findnext 支持 glob'ing（*.exe 等）...将匹配的文件加载到列表中并对其进行排序。STL 将帮助您。

Linux

使用 opendir() 和 readdir() 查找目录中的所有文件。在这些文件上使用 fnmatch() 来进行全局搜索。就像 Windows 一样，将匹配的文件加载到列表中并对其进行排序。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2018-11-08T09:54:53.280

Windows 确实有针对这种确切情况的 API。例如，您可以使用`CompareString`它，它可以`hyphens/numbering/etc`像 Explorer 一样使用，我相信默认情况下 ( `flags = 0`)

# asp.net - Asp.Net 网址处理

> ID：646685
> 
> 赞同：1
> 
> 时间：2009-03-14T20:38:52.593
> 
> 标签：asp.net, url, friendly-url

是否有内置方法来处理像 Def​​ault.aspx/mycontent 这样的 url，还是我需要通过获取 url 并剥离文件路径来自己处理它？

我已经尝试搜索它，但无法找到任何东西。

我想处理 .aspx/parameters 而不是在看 Mod/URL Rewrite。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T20:52:27.880

您可以编写一个[url 重写处理程序](http://msdn.microsoft.com/en-us/library/ms972974.aspx)，在您的 webforms 应用程序中使用[ASP.NET MVC 路由](http://haacked.com/archive/2008/03/11/using-routing-with-webforms.aspx)，或者使用[ASP.NET MVC](http://www.asp.net/mvc/)而不是 webforms。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T20:46:38.657

看看[ASP.NET MVC](http://www.asp.net/mvc/)。这个框架显然远远超出了“用户友好”的 URL，但它也将其作为副产品处理。

或者你可以写一个 HttpFilter ...

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T20:47:02.167

如果您希望您的应用程序执行“友好的 url”，那么您肯定希望避免“.aspx”出现在 URL 中吗？已经考虑过 ASP.NET-MVC 或至少它的路由元素。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T20:55:24.050

您可以使用 Request.Url.Segments 数组解析出附加的“文件夹”：

```
this.Response.Write(this.Request.Url.Segments[this.Request.Url.Segments.Length - 1]); 
```

然后使用 Server.Transfer 或渲染任何你喜欢的东西。对于 CSS 等，您经常会遇到相对路径等问题。

# visual-studio - 如何解决“二进制文件未使用调试信息构建”？

> ID：646689
> 
> 赞同：0
> 
> 时间：2009-03-14T20:43:22.533
> 
> 标签：visual-studio, delphi, debugging, visual-c++, dll

我正在尝试调试与 Delphi 程序一起使用的 C DLL。我使用 Visual C++ 构建了 DLL，并启用了调试信息。我使用 Delphi 2009 构建了 Delphi 程序，并启用了调试信息。但显然他们使用不同的格式，因为当我尝试将 VC++ 调试器附加到我的程序时，它说“二进制文件不是使用调试信息构建的”，甚至不会接受我在 C 代码中放置的有效断点，*即*使用 VC++ 理解的格式的调试信息构建。

有谁知道我怎样才能让它工作？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T21:26:36.563

当您说“不接受有效”时，C 代码中的调试断点是什么意思？它不启用它们吗？如果是这样，当您设置断点时，DLL 是否已加载？我发现如果我等到确定有问题的 DLL 已经加载之后再设置断点，它可以简化问题。如果这不是正在发生的事情，请详细说明“有效”断点的含义。

其他选项是设置函数断点，或使用策略性放置的[`DebugBreak()`](http://msdn.microsoft.com/en-us/library/ms679297.aspx)调用编译 DLL。

您确定加载的是正确的 DLL（即调试版本）吗？同样，即使正在加载正确的 DLL，我也不确定该错误是否一定适用于 DLL 而不仅仅是主可执行文件。或者它可能在加载符号数据库时遇到问题，如 jdigital 建议的那样，假设您将它们提取出来用于 DLL 的调试构建。即使没有调试符号，调试仍然是可行的，特别是因为它是一个 DLL，您可以使用导出的符号进行工作。

这不是 COM 组件吗？如果是，我会仔细检查调试版本是否是在您启动进程之前注册的版本。

同样，当您尝试设置断点时，我仍然有兴趣确切了解会发生什么。如果您转到 VS 中的断点窗口，它应该澄清为什么无法设置断点，如果这是正在发生的事情。

唔。我没有太多经验`/Z7`，你还有 .obj 文件的 DLL 吗？文档似乎暗示这是调试所必需的。或者，我会尝试构建`/Zi`并为那个傻瓜获取一个 .pdb 。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T20:48:46.437

调试格式不是标准化的——基本上你不能使用 Delphi 来调试 MS 编译的代码，反之亦然。

您可以在 Delphi 中调试 Delphi DLL，并且您可以将这些 DLL 与其他未使用 Delphi 编译的应用程序一起使用，前提是您将 Delphi 函数标记为导出。您不能做的是在第 3 方调试器中象征性地调试这些 DLL，这至少必须理解 Object Pascal 名称修改。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-14T21:17:37.070

不确定 Visual C++（根本不再安装它），但也许这会有所帮助......

如果您在 Delphi 中编写一个 DLL 并从 C++ 中使用它，并且您想调试该 DLL，您将在*Delphi*中打开该 DLL 的源代码并设置一个断点。然后，您将使用 Run|Parameters 并将 C++ 应用程序设置为主机可执行文件并在 Delphi IDE 中运行。然后 IDE 将启动 C++ 应用程序并照常运行它，直到 DLL 中的断点被命中，然后会按您的预期中断。

VC++中有类似的东西吗？（您没有说您使用的是哪个版本的 VC++，或者是哪个版本的 Visual Studio 或更早的 IDE。）

如果没有，我能想到的唯一选择是做一个快速的 VC++ 应用程序，它使用 DLL 并通过它进行调试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T00:01:38.867

确保在调试文件夹中打开 DLL，而不是在其他文件夹中打开另一个。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-15T00:02:32.807

您是否将调试器指向您的 DLL 的符号？如果有任何疑问，请尝试使用[Filemon](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Process.html)运行以查看调试器在尝试加载符号时是否失败。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-02-01T15:04:26.627

十年后，这发生在我身上，在调试 Team Developer 中使用的自定义 DLL 时，设置调试命令以启动 Team Developer IDE。目标是通过第 3 方代码单步执行从 DLL 调用导出函数的点。

启动调试器会正确启动 IDE，但在 TD IDE 中运行 TD 项目会导致 VS 中 TD IDE 使用的 DLL 出现异常。

如何忽略项目外部的异常？自 09 年以来，有没有人能够解决这个问题？

# mysql - In MySQL, can I have a table returning the ten last rated games by rating?

> ID：646696
> 
> 赞同：2
> 
> 时间：2009-03-14T20:46:37.940
> 
> 标签：mysql

The actual question is a little more complex than that, so here goes.

I have a website which reviews games. Ratings/reviews are posted for each game, and so I have a MySQL database to handle it all.

Thing is, I'd really like a page that showed what score (out of 10) meant what, and to illustrate it would have the game that was **last reviewed** as an example. I can always do it without, but this would be cooler.

So the query should return something like this (but running from 10 to 0):

```
|---------------*----------------*-----------------*-----------------|
* game.gameName | game.gameImage | review.ourScore | review.postedOn *
|---------------*----------------*-----------------*-----------------|
| Top Game      | img            | 10              | (unix timestamp)|
| NearlyTop Game| img            | 9               | (unix timestamp)|
| Great Game    | img            | 8               | (unix timestamp)|
|---------------*----------------*-----------------*-----------------| 
```

The information is in two tables, game and review. I think you'd use MAX() to find out the last timestamp and corresponding game information, but as far as complex queries go, I'm in way over my head.

Of course this could be done with 10 simple SELECTs but I'm sure there must be a way to do this in one query.

Thanks for any help.

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-15T09:20:22.323

Here is an ugly solution I found:

This query simply gets the IDs and scores of the reviews that you want to look at. I have included it so that you can understand what the trick is, without getting distracted by other stuff:

```
SELECT * FROM
(SELECT reviewID, ourScore FROM review ORDER BY postedOn DESC) as `r`
GROUP BY ourScore
ORDER BY ourScore DESC; 
```

This exploits MySQL's 'GROUP BY' behavior. When the grouping is done, if the source rows have different values for different columns, then the value of the topmost source row is used. So if you had rows in this order:

```
reviewId  Score
1           3
0           3
2           3 
```

Then after you group by score, the reviewId is 1 because that row was on the top:

```
reviewId  Score
1           3 
```

So we want to put the most recent review on the top before we do the group by. Since ORDERing is always dones after grouping, in a single SELECT statement, I had to make a subquery to accomplish this. Now we just dress up this query a little bit to get all the fields you wanted:

```
SELECT `r`.*, game.gameName, game.gameImage FROM
(SELECT reviewID, ourScore, postedOn, gameID FROM review ORDER BY **postedOn DESC**) as `r`
JOIN game ON `r`.gameID = game.gameID
GROUP BY ourScore
ORDER BY ourScore DESC; 
```

That should work.

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T20:58:41.640

```
SELECT DISTINCT game.gameName, game.gameImage, review.ourScore FROM game
LEFT JOIN review
ON game.ID = review.gameID
ORDER BY review.postedOn
LIMIT 10 
```

Or something like that, check out how to use the Distinct first, I'm not sure on the syntax, and you may have to tell the ORDER BY DESC or ASC depending on what you want.

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T21:18:07.757

Well..

```
SELECT game.gameName, game.gameImage, review.ourScore
FROM game
LEFT JOIN review ON game.gameID = review.gameID
GROUP BY review.ourScore DESC 
LIMIT 10 
```

returns a list of games grouped by each individual score. But this isn't what I want, I want the game that is last posted - this is why the timestamp is important. With that query, MySQL returns the first result it can find.

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-15T00:23:40.913

I think this would work:

```
select g.gameName, g.gameImage, r.ourScore, r.postedOn
from game g, review r
where g.gameId = r.gameId 
and r.postedOn = (select max(sr.postedOn) 
                  from review sr where sr.ourScore = r.ourScore)
group by r.ourScore
order by r.ourScore desc; 
```

**Edit**: above SQL was corrected after David Grayson's comment. I think this query is pretty easy to understand but probably performs poorly compared with his solution.

# java - 如何在 Java 中实现多核算法？

> ID：646700
> 
> 赞同：0
> 
> 时间：2009-03-14T20:47:37.627
> 
> 标签：java, algorithm, multithreading, multicore

现代计算机的内核越来越多。我们想改变我们当前的线性算法来使用这些核心。

只有在有空闲处理器的情况下，拆分任何算法以使用不同的线程才有意义。

如果有免费处理器，是否有任何好的库可以帮助并行化某些步骤？

我会举一些例子。

*   如果只有一个处理器，那么创建多个线程是没有意义的。它会降低速度。
*   如果在一个核心二重奏上运行 2 个进程（服务器上的请求），那么启动线程也是没有意义的。
*   如果核心二重奏上只有一个进程，那是有道理的。

抽象算法有 4 个步骤 A、B、C 和 D。步骤 A、B 和 C 可以并行执行。步骤 D 需要来自 A、B 和 C 的结果。

编辑：我的意思是一个数学算法。无 IO，无事件等

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-14T20:55:02.850

这不一定是真的。

根据算法，即使只有一个内核可用，将其拆分为多个线程通常也是有意义的。如果套接字、IO 等有任何等待，您可以从中受益。如果有 2 个进程，则“其他”进程可能不会 100% 使用其他核心，因此线程在这里可以提供帮助。在这种情况下，请相信您的操作系统能够正确处理它。

您始终可以使用 Runtime.availableProcessors() 检查处理器计数，以确定如何将其拆分为单独的线程。或者，您可以使用线程池，它应该可以使用更多处理器正确扩展。

不过，总的来说，如果算法对并行化有意义，我会设计您的算法以使用多个处理器。大多数系统将有更多可用的内核/处理器，如果你发现它需要它，你可以随时调整你的实现。如果进程长时间运行，那么生成线程的开销将是值得的——如果它已经很快了，可能更值得寻找其他地方进行优化。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T21:17:52.000

查看 Java 5 及更高版本中的各种并发类。您很可能需要一个 ThreadPoolExecutor - [http://java.sun.com/javase/6/docs/api/java/util/concurrent/ThreadPoolExecutor.html](http://java.sun.com/javase/6/docs/api/java/util/concurrent/ThreadPoolExecutor.html)。

ThreadPool 的适当值很可能因系统而异，具体取决于工作负载和硬件架构。使其用户可调节。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-14T20:55:58.667

对于一些想法，请查看[JSR166 和 JSR166y](http://gee.cs.oswego.edu/dl/concurrency-interest/)（类似于带有工作窃取 (166) 和并行数组 (166y) 的分叉连接系统）。

一些不错的阅读和对 Java 未来方向的概述。看起来还不错（对高级并发和并行编程的强大支持）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-14T21:15:29.867

我经常有一个固定的线程池，它的线程数与处理器的数量动态相同（请参阅运行时）我将任务添加到这个线程池中，以便它使用所有可用的处理器。

我不认为您应该尝试在操作系统中重新发明进程调度程序。它做得很好，所以让它做它做得好的事情。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-14T21:36:20.723

拥有比核心更多的线程/进程不一定是坏事。如果您的代码是严格数学的，几乎没有 I/O 并且没有副作用，那么是的，内核和线程之间的 1:1 对应关系是最佳的。但通常情况并非如此。与时钟周期相比，I/O 需要数亿年。当操作系统可以交换另一个线程以继续运行时，为什么要在等待 I/O 时完全停止内核？

问题是没有很多语言/编译器可以为您做出并发决定。您需要设计程序以利用并发性。而且您可能需要为多个目标环境设计程序，通常不受您的控制。因此，通常情况下，最佳实践是为任何有意义的事情创建线程以并行化并让线程调度程序处理它。应该调整线程调度程序以在特定硬件上使用，这比您针对“任何硬件出现”调整程序要好得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-03-16T18:39:47.420

> 抽象算法有 4 个步骤 A、B、C 和 D。步骤 A、B 和 C 可以并行执行。步骤 D 需要来自 A、B 和 C 的结果。

这是使用 Ateji PX 表示法的单行代码，Java 语言的扩展：

```
[ A(); || B(); || C(); ]; D(); 
```

作为程序员，你的职责是表达哪里有可能并行执行，这就是双杠“||”的作用 在代码中。调度程序现在能够充分利用可用硬件，即在可用时在三个不同的内核上运行 A、B 和 C。

这是一个非常高级的视图，在 A、B 或 C 内部可能会展示更多的并行性。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-14T22:01:34.687

我认为您需要来自 Javolution 的 ConcurrentContext 。请参阅[http://javolution.org/target/site/apidocs/javolution/context/ConcurrentContext.html](http://javolution.org/target/site/apidocs/javolution/context/ConcurrentContext.html)

# c# - 使用 XSD.exe 自定义类名称生成的类

> ID：646705
> 
> 赞同：12
> 
> 时间：2009-03-14T20:50:39.553
> 
> 标签：c#, .net, xsd.exe

是否可以控制使用 .Net XSD.exe 工具生成的类名？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-14T21:11:20.283

基本上，没有。如果您手动编写类，您可以：

```
[XmlType("bar")]
class Foo {} 
```

但是，您不能对 xsd 生成的类执行此操作。不幸的是，你*不能*用 a 做的事情之一`partial class`就是重命名它。当然，您可以使用`xsd`它来生成它，更改 .cs 文件**并不再生成它**，但这并不适合维护。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-14T21:11:24.010

据我所知，我认为这是不可能的，类名几乎与模式中的内容完全匹配。

我个人会在 XSD 生成代码后更改类名，但老实说，我通常只坚持 XSD 生成的内容。这样其他人阅读代码就更容易理解哪些类映射到 XML 的哪些部分。

或者，如果您可以控制架构，您可以更新它吗？

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2011-11-21T13:07:41.943

任何嵌套较深的模式都会以完全无用的名称结束。

我不知道有什么方法可以解决这个问题，但我至少可以减少负面影响的建议是：为名称非常糟糕的类型定义一个别名列表。通过这种方式，您可以编写并非完全不可读的代码，而不会失去重新生成的能力。

```
使用 AgentAddress = Example.Namespace.DataContract.RootElementNestedElementAgentAddress;
...

```

It's a pity this list itself has to be copy-pasted to all code files needing it, but I think this at least constitutes an improvement.

# asp.net - SQLServer 2005/Net 2.0.Win2003 上的 DotNetNuke 3.0.x - 可能吗？

> ID：646712
> 
> 赞同：1
> 
> 时间：2009-03-14T20:53:43.103
> 
> 标签：asp.net, dotnetnuke

我已经答应为客户查看一个旧的 DotNetNuke 安装，目的是进行一些（希望是微小的）更改。安装相当旧 - 我相信版本 3.0.013 - 生产副本针对 SQL Server 2000、Windows 2003 和 .Net 1.1 运行。

由于生产服务器是实时的并且被大量使用，我们首先需要一个开发安装。我试图在我的本地服务器上安装一个副本 - Windows 2003、SQL Server 2005、.Net 2.0，虽然通过一些调整我可以成功地让它显示该站点，但我无法登录，甚至无法访问登录模块（即只是输入空白用户名和密码试图生成“必须输入用户名”类型错误）而没有收到错误“对象引用未设置为对象的实例”

我花了一些时间试图解决这个错误，但没有成功，尽管我之前没有使用过这个包。

所以我的问题是

有没有人设法使用这种配置运行 DotNetNuke 3.0.x（或者我是否需要设置一个带有 SQL 2000 和 .Net 1.0 的机器才能运行）？

有什么建议我应该从哪里开始寻找这个错误，或者以前有没有人遇到过类似的事情？

编辑：最终退缩并安装在带有 Win2003/SQL 2000/Net 1.1 的旧网络服务器上，并且在相同的安装中运行良好。所以我想答案是否定的，它不能直接开箱即用。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T23:54:22.967

我的感觉是，您在上述环境中运行应该没有任何问题。但仔细研究错误本身将有助于我们证明这一点。

如果错误仅在您导航到登录模块时发生，则可能是加载身份验证提供程序时出现问题。找出答案的最佳方法是查看 DNN 事件日志并查看完整的错误消息。

因为您无法登录访问事件日志，所以您可能应该只查看在收到错误时在数据库中创建的行。该表称为 EventLog，在解析错误消息时可能会有些麻烦，因为所有详细信息都以 XML 格式存储在数据库中。

通常，将站点从一个环境移动到另一个环境时，您只需要做几件事：

1.  确保您可以连接到数据库
2.  设置文件系统权限

听起来您已经有了数据库连接，因为您可以加载该站点。

但是，您可能需要仔细检查（只是重新应用）相关机器上网站根目录的文件系统权限。确保网站的身份（通常是 ASP.NET 机器帐户或网络服务）对根网站目录具有“修改”权限。由于缺少权限，网站可能无法加载特定程序集。

# cocoa - 在 Cocoa 应用程序中访问控制器

> ID：646713
> 
> 赞同：0
> 
> 时间：2009-03-14T20:53:53.740
> 
> 标签：cocoa, model-view-controller

我开始认为我的 Cocoa 应用程序并没有真正按照 MVC 的原则完成。我的问题如下：

我的项目中有一些类，一个是被调用的`Copier.h`，另一个是被调用的`DropReciever.h`。`Copier`是我的主要视图控制器，因为它具有所有绑定和主要方法。`DropReciever`是一个自定义实现，`NSView`允许应用通过拖放接受文件。

现在，有没有一种简单的方法可以将消息发送到`Copier`from `DropReceiver`？现在，两者互不认识，我想不出一种优雅的方式来连接它们，因为它们都是单独实例化的。我怎样才能让他们看到对方？或者，有没有一种优雅的、可口的方式来做得更好？

（如果你想看我的源代码，它就在[这里](http://bitbucket.org/winsmith/copymeister/src/)。）

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T23:22:12.760

另一种方法是将放置接收器的属性公开为绑定，并将复制器绑定到它（以编程方式）。然后，在 drop 方法中，让 drop 接收器将放置的内容设置为此属性的值（您可以将其命名为`droppedObject`）。

当您设置属性时，Bindings 的魔力将设置您的复印机的绑定属性。复印机可以在其设置器方法中做出适当的反应。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T23:39:46.637

我会在 DropReceiver 上有一个委托属性。任何负责将这些事情联系在一起的人都会设置委托。委托对象可以是一个 id，或者您可以为它创建一个协议（这两个习惯用法在 Cocoa 中都很常见）。我到处都这样做。你得到你需要的分离，而不必在房子周围工作太多。

唯一的缺点是，如果您没有在初始化时设置委托，那么您对它的所有调用都需要通过`if( delegate )`检查来保护。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-14T21:08:17.247

我通常这样做的方式是在 nib 中实例化 DropReceiver ，然后将一个连接添加`IBOutlet DropReceiver *`到您的 Copier.h，然后将连接从 Copier 实例拖到窗口中的 DropReceiver

# html - HTML 按钮“推送”效果

> ID：646719
> 
> 赞同：10
> 
> 时间：2009-03-14T20:56:10.133
> 
> 标签：html, css

我不知道是什么让一个 html 按钮元素看起来被推动（右键单击一个 html 按钮，然后悬停在上下以查看我的意思）。

以下两个例子我取自其他网站。第一个具有典型的按钮推动效果。第二个没有。

```
.button { 
border:none 0; 
background-color:Transparent; }
.button .l { background:url('img.gif') no-repeat 0 0; 
padding-left:7px;
display:block; 
height:32px; }
.button .c { background:url('img.gif') repeat-x 0 0; 
display:block; 
height:32px; 
padding-top:7px; }
.button .r {
background:url('img.gif') no-repeat right top; 
padding-right:7px; 
display:block; 
height:32px; } 
```

和

```
.button {
background:#F0F0F0 url(img.gif) repeat-x scroll 0 0;
border:1px solid Black;
color:#333333;
font-size:12px;
height:20px;
padding-left:8px;
padding-right:8px; } 
```

编辑：@ skeet 先生，我想要一个在所有浏览器中看起来都一样的按钮（即背景图像），但仍然像真正的 html 按钮一样具有推送效果。我是否正确假设我需要为此使用javascript？和不同的 css 用于推送状态？一个例子/教程会很棒

* * *

## 回答 #1

> 赞同：23
> 
> 时间：2009-03-14T21:07:31.463

要么使用

```
<input type="button" value="Click Me"/> 
```

它会自动像一个按钮一样工作，或者使用 :hover 和 :active CSS 伪类来获得你想要的......

```
a.likeAButton {
  background-color:#67a0cf;
  border:1px outset #2683cf;
  color:#fff;
  padding:3px 3px 3px 3px;
  margin:1px;
  text-decoration:none;
}
a.likeAButton:hover {
  background-color:#5788af;
  border:1px outset #2683cf;
  color:#fcffdf;
  padding:3px 3px 3px 3px;
  margin:1px;
  text-decoration:none;
}
a.likeAButton:active {
  background-color:#67b4cf;
  border:1px inset #1d659f;
  color:#e0ffaf;
  padding:4px 2px 2px 4px;
  margin:1px;
  text-decoration:none;
}

<a href="somepage.html" class="likeAButton">Fake Button</a> 
```

* * *

## 回答 #2

> 赞同：-2
> 
> 时间：2012-04-02T16:41:43.730

您还可以为每个元素添加边框半径，例如 a.likeabutton、a.likeabutton:hover 等。这会让它看起来很好看。如果我们可以让它像一个按钮列表，那么它将有一个更好的导航栏功能，虽然我试过了，但这些按钮的位置在最大化和恢复的浏览器中不会保持不变。

# c++ - 不同类型的boost功能图？

> ID：646737
> 
> 赞同：7
> 
> 时间：2009-03-14T21:10:29.410
> 
> 标签：c++, boost

我想知道是否有办法在 C++ 中做到这一点？

```
void func1(const std::string& s)
{
std::cout << s << std::endl;
}

void func2(int me)
{
std::cout << me << std::endl;
}

int main()
{
std::map<std::string, boost::function< ??? > > a_map;

a_map["func1"] = &func1;
a_map["func1"]("HELLO");

} 
```

有什么方法可以使用增强功能和地图来完成我上面的操作吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T21:16:54.340

您可能无法使用，`std::map`因为它是同质容器。尝试，类似[`boost::variant`](http://www.boost.org/doc/libs/1_38_0/doc/html/variant.html)（他们支持访问者模式）或[`boost::tuple`](http://www.boost.org/doc/libs/1_38_0/libs/tuple/doc/tuple_users_guide.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-03-14T21:18:45.430

有一些方法可以存储函数，问题是，为了能够使用所需的参数调用函数，无论如何你都必须知道函数的调用签名，如果你有这些信息，你也可以使用单独的映射，或者使用比 boost::function 更复杂的对象。

如果您愿意做一些工作并拥有有限数量的签名，则可以执行以下操作：

```
class MultiFunc
{
protected:
    MultiFunc() {}

public:
    typedef void (*stringFunc)(const std::string&);
    typedef void (*intFunc)(int);

    static MultiFunc *Create(stringFunc function);
    static MultiFunc *Create(intFunc function);

    virtual void operator()(const string &) { throw exception(); }
    virtual void operator()(int) { throw exception(); }
    virtual ~MultiFunc();
};

class MultiFuncString : public MultiFunc
{
private:
    stringFunc Function;
public:
    MultiFuncString(stringFunc function) : Function(function) {}
    virtual void operator()(const string &arg) { Function(arg); }
};

class MultiFuncInt : public MultiFunc
{
private:
    intFunc Function;
public:
    MultiFuncInt(intFunc function) : Function(function) {}
    virtual void operator()(int arg) { Function(arg); }
};

MultiFunc *MultiFunc::Create(MultiFunc::stringFunc function)
{
    return new MultiFuncString(function);
}
MultiFunc *MultiFunc::Create(MultiFunc::intFunc function)
{
    return new MultiFuncInt(function);
}

void func1(const std::string& s)
{
std::cout << s << std::endl;
}
void func2(int me)
{
std::cout << me << std::endl;
}

int main()
{
    map<string, MultiFunc *> a_map;
    a_map["func1"] = MultiFunc::Create(&func1);
    (*a_map["func1"])("Hello");
    a_map["func2"] = MultiFunc::Create(&func2);
    (*a_map["func2"])(3);

    // Remember to delete the MultiFunc object, or use smart pointers.
} 
```

这输出：

```
你好
3

```

不幸的是，您不能制作模板化的虚函数，或者您很容易将这一切概括。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-14T23:36:51.853

你正在尝试做的事情听起来有点奇怪。通常，您将拥有一个容器，该容器是具有相同签名的抽象类型或对象或函数的集合。否则，您如何知道在迭代容器时如何调用该函数？我喜欢使容器成为具有已知签名的函数对象的集合，然后使用 Boost.Bind 来存储调用带有附加参数的函数的闭包。

例如：

```
typedef boost::function<void, void> Function;
typedef std::map<std::string, Function> Functions;

Functions functions:

void foo()
{
  ...
}

functions["foo"] = foo;

void bar(std::string &s)
{
  ...
}

// binds the value "hello" to the s parameter
functions["bar"] = boost::bind(bar, "hello"); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T21:33:57.763

阅读下面的链接。它讨论了使用 boost::bind 将函数指针存储在 std::map 中

[http://www.gamedev.net/community/forums/topic.asp?topic_id=526381&whichpage=1฻](http://www.gamedev.net/community/forums/topic.asp?topic_id=526381&whichpage=1&#3411515)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-14T21:42:39.943

商店接口：

```
struct IStringData
{
    virtual std::string get() const = 0;
    virtual ~IStringData() {}
}; 
```

并进行实现，一个只保存字符串值，其他实现将存储仿函数，也许您将来会有其他实现。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-14T22:24:29.733

不，你不能。由于 boost::function 不是多态的，它在那里分解。（它需要一组固定的参数类型。）

不过，在 boost 邮件列表上讨论了这方面的工作，所以搜索档案，看看是否有一些你可以使用的代码。

一种解决方法是使用 boost::function，但是您需要添加到映射中的不是真正的函数（即 func1/func2），而是从任何容器中提取类型并调用实际函数的调度函数。（如果它是错误的，就像在任何动态语言中一样。）

# c# - 如何以编程方式关闭 IE8 WebBrowser 控件中的怪癖模式？

> ID：646742
> 
> 赞同：20
> 
> 时间：2009-03-14T21:11:28.583
> 
> 标签：c#, internet-explorer-8, webbrowser-control, standards-compliance, quirks-mode

我想在 C# 应用程序中使用 IE8 作为 WebBrowser 控件。如何禁用“怪癖模式”并强制 IE 符合标准（就其实施而言）？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-20T00:46:46.607

如果您不想使用注册表项技术，可以插入以下标记：

`<meta http-equiv="X-UA-Compatible" content="IE=8" />`

“内容”属性强制以各种模式进行渲染。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-03-14T21:37:42.310

我认为您面临的问题在[IEBlog: WebBrowser Control Rendering Modes in IE8](http://blogs.msdn.com/ie/archive/2008/03/18/webbrowser-control-rendering-modes-in-ie8.aspx)中有描述：

> 虽然网站管理员可以轻松地更改他们的网站以在新版本的 IE 中正确呈现，但许多软件供应商没有资源立即推出具有更新的内部页面的应用程序的新版本。为了确保这些现有应用程序保持正常工作， **IE8 默认以 IE7 标准模式呈现在 WebBrowser 控件实例中运行的页面。**

在这里我应该注意到，页面上的评论说上面的内容是不正确的，并且“ **IE8 默认情况下会在 IE7 严格模式或 Quirks 模式下呈现在 WebBrowser 控件实例中运行**的页面，具体取决于页面的文档类型。”

解决方法如下：

> 当可执行文件加载 WebBrowser 控件的实例时，它会扫描注册表以检查可执行文件是否需要 IE7 标准或 IE8 标准模式。
> 
> ...
> 
> 要在 IE8 标准模式下运行，请插入以下注册表值：
> 
> `[HKEY_CURRENT_USER\Software\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_NATIVE_DOCUMENT_MODE]`
> 
> `"MyApplication.exe"=dword:13880`
> 
> 在这两种情况下，应将 MyApplication.exe 替换为将在指定模式下运行 WebBrowser 控件的可执行文件的名称。

因此，听起来“程序化”解决方案是在注册表中写入一个键，说明您希望 IE8 标准模式用于`WebBrowser`特定应用程序中的控件。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-03-14T21:17:19.427

我最后听说的是 IE8[默认使用标准模式](http://blogs.msdn.com/ie/archive/2008/03/03/microsoft-s-interoperability-principles-and-ie8.aspx)。您是否发现最新测试版存在实际问题？您确定它以怪异模式开始渲染，而没有用户明确点击[兼容性视图按钮](http://blogs.msdn.com/ie/archive/2008/12/03/compatibility-view-improvements-to-come-in-ie8.aspx)吗？

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-18T17:35:21.277

请注意，自测试版以来发生了一些变化，注册表项已重命名等 。[在此处阅读更多信息](http://blogs.msdn.com/ie/archive/2009/03/10/more-ie8-extensibility-improvements.aspx)。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2013-12-30T23:24:19.410

这有实际代码以编程方式执行此操作，并且到目前为止最多可处理 IE11：

[C# webbrowser Ajax 调用](https://stackoverflow.com/questions/18333459/c-sharp-webbrowser-ajax-call/20848398#20848398)

# jquery - 最近查看的 DIV，无需重新加载页面

> ID：646744
> 
> 赞同：0
> 
> 时间：2009-03-14T21:12:46.737
> 
> 标签：jquery, session, persistence, browser-history

我想要一个由 javascript 脚本填充的“最近查看的页面”div，该脚本在用户在网站上的整个会话期间请求新页面时添加标题和 url，div 的内容也由在会话之间持续存在的 cookie。

注意：添加到 div 的“历史列表”的新页面包括单击 href 链接，该链接仅包含一个静态变量，因此只会将窗口向下移动，而不是获取一个全新的页面。EG这些链接：

```
<a class="link" href="#john">  <a class="link" href="#mary"> 
```

*   这是要展示的两个新项目。

这里有一些代码示例并不能真正解决我的问题，因为它们在同一页面上不包含静态变量 GET：

[http://community.actinic.com/showthread.php?t=33229](http://community.actinic.com/showthread.php?t=33229)
[http://wordpress.org/extend/plugins/last-viewed-posts/installation/](http://wordpress.org/extend/plugins/last-viewed-posts/installation/)

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-15T03:29:30.873

这是应该使用 jQuery 做你想做的事情：

```
(function($){

    var history;

    function getHistory() {
        var tmp = $.cookie("history");
        if (tmp===undefined || tmp===null) tmp = "";
        if ($.trim(tmp)=="") tmp = [];
        else tmp = tmp.split("||");
        history = [];
        $.each(tmp, function(){
            var split = this.split("|");
            history.push({
                title: split[0],
                url: split[1]
            });
        });
    }

    function saveHistory() {
        var tmp = [];
        $.each(history, function(){
            tmp.push(this.title+"|"+this.url);
        });
        $.cookie("history",tmp.join("||"),{ expires: 60, path: "/" });
    }

    function addToHistory(title,url) {
        var newHistory = []
        $.each(history, function(){
            if (this.url!=url) newHistory.push(this);
        });
        history = newHistory;
        if (history.length>=10) {
            history.shift();
        }
        history.push({
            title: title,
            url: url
        });
        saveHistory();
        writeHistory();
    }

    function writeHistory() {
        var list = $("<ul />");
        $.each(history, function() {
            var element = $("<li />");
            var link = $("<a />");
            link.attr("href",this.url);
            link.text(this.title);
            element.append(link);
            list.append(element);
        });
        $("#history").empty().append(list);
    }

    $(document).ready(function(){
        getHistory();
        var url = document.location.href;
        var split = url.split("#");
        var title;
        if (split.length > 1) {
            title = $("#"+split[1]).text();
        } else {
            title = document.title;
        }
        if (title===undefined || title===null || $.trim(title)=="") title = url;
        addToHistory(title,url);
        url = split[0];
        $("a[href^='#']").click(function(){
            var link = $(this);
            var href = link.attr("href");
            var linkUrl = url+href;
            var title = $(href).text();
            if (title===undefined || title===null || $.trim(title)==="") title = linkUrl;
            addToHistory(title,linkUrl);
        });
    });

})(jQuery); 
```

放入一个包含在所有页面中的 js 文件。您还需要在它之前包含 jquery.cookie.js ( [http://www.stilbuero.de/2006/09/17/cookie-plugin-for-jquery/](http://www.stilbuero.de/2006/09/17/cookie-plugin-for-jquery/) )

您的页面必须采用以下两个测试页面的格式：

[历史.html]

```
    <html>
     <头部>
      <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
      <script type="text/javascript" src="jquery.cookie.js"></script>
      <script type="text/javascript" src="history.js"></script>
      <title>我的第一页</title>
     </head>
     <正文>
      <h2>第一页</h2>
      <h3>历史</h3>
      <div id="历史"></div>
      <h3>链接</h3>
      <a href="#part1">第 1 页 - 第 1 部分</a>
      <a href="#part2">第 1 页 - 第 2 部分</a>
      <a href="history2.html#part1">第 2 页 - 第 1 部分</a>
      <a href="history2.html#part2">第 2 页 - 第 2 部分</a>
      <h3>零件</h3>
      <h4 id="part1">首页第一部分</h4>
      <h4 id="part2">首页第二部分</h4>
     </正文>
    </html>

```

[历史2.html]

```
    <html>
     <头部>
      <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
      <script type="text/javascript" src="jquery.cookie.js"></script>
      <script type="text/javascript" src="history.js"></script>
      <title>我的第二页</title>
     </head>
     <正文>
      <h2>第二页</h2>
      <h3>历史</h3>
      <div id="历史"></div>
      <h3>链接</h3>
      <a href="#part1">第 2 页 - 第 1 部分</a>
      <a href="#part2">第 2 页 - 第 2 部分</a>
      <a href="history.html#part1">第 1 页 - 第 1 部分</a>
      <a href="history.html#part2">第 1 页 - 第 2 部分</a>
      <h3>零件</h3>
      <h4 id="part1">第二页第一部分</h4>
      <h4 id="part2">第二页第二部分</h4>
     </正文>
    </html>

```

请注意，用于历史记录块的标题是链接所针对的标记的文本，如果它是 #something href 或页面的标题，如果不是。

任何对 jQuery 有一定了解的编码人员都可以根据您的特定需求对其进行调整。

# php - PHP中的MySQL查询给出了明显的错误结果

> ID：646746
> 
> 赞同：3
> 
> 时间：2009-03-14T21:14:46.670
> 
> 标签：php, mysql, phpmyadmin

我正在使用 PHP 和 PHPMyAdmin 创建一个小型个人资料网站。我给成员一个 ID 号，基于它是数据库中当前最大的数字，+1

在得到我想要的 PHP 脚本之前，我做了 25 次测试。

然后我使用 PHPMyAdmin 删除了这 25 个条目。

但是现在，当我的 PHP 代码这样做时：

```
function getLatestID() {
    $query = "SELECT max(member_id) FROM members";
    $result = @mysql_query($query) or showError("unable to query database for user information");
    if (!($record = mysql_fetch_array($result))) return null;
    return $record[0];
} 
```

我弄错号码了。

测试场景：数据库表包含 3 个条目，ID 分别为 1、2 和 3。

我开始调试会话并在 return 上放置一个断点`$record[0]`。我检查了它的内容，最大的数字不是 3，而是 28。

如 25+3=28，我已经删除的 25 个条目...

有人知道是什么原因造成的，我该如何解决？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-03-14T21:21:35.423

这可能是因为您设置了 auto_increment 并且查询返回了最高 id。当您删除其他记录时，您可能没有重置自动增量计数。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-14T21:20:31.337

如果您`auto_increment`在 MySQL 中使用，则删除记录不会减少下一个值。

您可以清空一个表`TRUNCATE TABLE mytable`- 这将重置该值。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-14T21:39:24.770

您还可以更改自动增量认为是下一个要分配的值的值：

```
ALTER TABLE members AUTO_INCREMENT = 3; 
```

请注意，如果您在自动增量列中输入的值小于当前最大值，它会将值更改为 MAX+1。要查看当前的下一个值设置为什么，请执行以下操作：

```
SHOW CREATE TABLE members; 
```

在表定义的末尾，它会显示“ `AUTO_INCREMENT = 26`”或者它的当前值。

# javascript - JavaScript：合并文件没有问题？

> ID：646747
> 
> 赞同：0
> 
> 时间：2009-03-14T21:15:16.030
> 
> 标签：javascript, performance, optimization

我有三个要合并到一个文件中的 javascript 文件。是否可以将所有代码复制粘贴到一个文件中，还是会出现命名空间冲突和其他问题？

编辑：我担心每个文件都像封装每个文件代码的命名空间一样，如果我合并文件，这种封装将不复存在。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T21:18:05.027

如果脚本文件全部加载到 中，`<head>`并且您按照它们在 HTML 中出现的顺序粘贴它们，那么应该没有任何问题。

话虽如此，如果他们使用 document.write 我不确定......

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-14T21:18:29.737

如果它们在按顺序加载时都可以工作，那么将它们连接到一个文件并改为使用它没有区别。只需确保按照与单独加载时相同的顺序将它们放在一起。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-14T21:59:15.770

回答您的编辑：不，每个文件都不会充当单独的命名空间。

每个文件的顶层将共享相同的全局命名空间。因此，具有所有三个内容的单个文件与单独引用每个文件相同，假设内容以相同的顺序出现。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T21:18:36.397

试试看它是否有效。:) 命名空间冲突将完全取决于代码，所以如果不发布它，很难告诉你。只要它们没有错误，将它们放在一个文件中就不应该有问题，但是如果一个依赖于另一个，请确保将它们按正确的顺序放置。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-16T06:27:40.797

JavaScript 中绝对没有命名空间封装，除非您竭尽全力实现它。默认情况下，一切都在全局命名空间中结束。[JavaScript 模块模式](http://ajaxian.com/archives/a-javascript-module-pattern)有助于减少全局命名空间污染。

# visual-studio-2008 - 我可以保存来自 Visual Studio 2008 调试器的数据吗？

> ID：646750
> 
> 赞同：1
> 
> 时间：2009-03-14T21:16:49.770
> 
> 标签：visual-studio-2008

我在某些代码中有一个罕见的数据相关错误。很难重现生成有问题数据的条件，因此我需要能够将导致错误的（相当大的）数据序列化到磁盘以制作测试用例。有没有办法从调试器中序列化数据？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T21:19:34.820

您想要的所有数据是否已经以某种可序列化的形式存在？如果是这样，您可以使用立即窗口创建适当的序列化程序并以这种方式将其写入磁盘。

如果您需要合理地定期执行此操作，并且如果您要获取单个对象中包含的数据，则可以向该类型添加一个方法以将数据转储到仅给出文件名的磁盘 - 再次，从即时窗口。

# css - 为李使用背景图片

> ID：646764
> 
> 赞同：11
> 
> 时间：2009-03-14T21:19:12.387
> 
> 标签：css

我正在使用`<li>`将用作按钮的背景图像，但它没有完全显示；但是，当编写文本时，它会显示。我不想写已经打印在背景图像上的文本。我无法设置宽度 - 我该如何解决这个问题？

```
#footernav li#footerlocation
{
    display: inline;
    padding-right: 20px;
    background-image: url(../images/ourlocation.jpg);
    background-repeat: no-repeat;
    background-position: 0 -.2em;
} 
```

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-14T21:22:04.000

您的问题在于将显示设置为内联。如果需要背景和宽度，但还需要内联类型列表，请设置 float:left。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-03-16T03:00:37.797

看看下面的例子：

```
 ul#footernav li { 
        display:inline; 
        }
    ul#footernav li a{ 
        display:block; 
        width:155px;
        text-indent:-9999px;
        }
    ul#footernav li.footerlocation a{ 
        height:30px ; 
        background: url('images/image.jpg') bottom left no-repeat; 
        }
    ul#footernav li.footerlocation a:hover{ 
        height:30px ; 
        background: url(images/image.jpg) top left no-repeat; 
        } 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2010-01-25T11:30:20.390

是的，我有同样的问题，我只是删除了 css 样式`display: inline`并添加`display: list-item; float:left;`了我的问题解决了，希望这会有所帮助。

谢谢，桑卡尔B

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-14T21:25:01.047

设置图像的宽度和高度

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-09-10T10:25:02.347

可能在这方面有所帮助

```
.tab-content ul li{display: block;padding-left: 30px;background-image:url('images/blue-icon.png');background-repeat: no-repeat;background-position: 0 2px;margin-bottom: 10px;} 
```

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2019-05-22T09:39:08.950

我们可以简单地添加以下 css 规则：

```
ul.check-list{  
    list-style-image: url(images/tick.jpg);
} 
```

# ruby-on-rails - 保存 Rails 中对象的更新

> ID：646768
> 
> 赞同：5
> 
> 时间：2009-03-14T21:21:16.047
> 
> 标签：ruby-on-rails, ruby

我正在尝试在我的 rails 应用程序中更新我的一个对象，但这些更改并没有生效。没有错误，单步执行调试器只是表明它认为一切都在更新。

无论如何，这是有问题的代码......

```
 qm = QuestionMembership.find(:first, :conditions => ["question_id = ? AND form_id = ?", q_id, form_id])
  qm.position = x
  qm.save 
```

作为参考，QuestionMembership 有 question_id、form_id 和 position 字段。都是整数，并且没有 db 约束。

这基本上是我的表格和问题之间的连接表。

单步执行代码，qm 得到一个有效对象，对象的位置确实更改为 x 的值，并且 save 返回“true”。

但是，方法退出后，db中的对象并没有改变。

我错过了什么？

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-03-14T22:35:45.883

您可能找不到您认为的对象。在 irb 中进行的一些实验可能会很有启发性。

此外，作为一般规则，当只更改一个属性时，最好写

```
qm.update_attribute(:position, x) 
```

而不是设置和保存。然后 Rails 将只更新该列而不是整行。您还可以从数据被清除中受益。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T03:21:04.527

有after_save吗？

是否发出了正确的 SQL？

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-16T03:10:09.303

在开发日志中，您实际上可以看到生成的sql。

对于这样的事情：

```
qm = QuestionMembership.find(:first, :conditions => ["question_id = ? AND form_id = ?", q_id, form_id])
qm.position = x
qm.save 
```

您应该看到以下效果：

```
SELECT * FROM question_memberships WHERE question_id=2 AND form_id=6 LIMIT 1
UPDATE question_memberships SET position = x WHERE id = 5 
```

你能输出你实际看到的 sql 以便我们进行比较吗？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-06-09T22:03:41.463

更新属性或调用：

```
qm.reload 
```

之后`qm.save`

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-14T21:36:09.833

尝试将 qm.save 更改为 qm.save！并查看是否收到异常消息。

编辑：当您查看调用 .save! 的日志时会发生什么？它会生成预期的 SQL 吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-14T22:32:13.240

结果是`qm.save`什么？对或错？那么`qm.errors`，这是否提供了对您有意义的任何东西？development.log 说什么？

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-14T23:41:37.037

我经常遇到这个问题。（我正要始终如一地说，但我不能，因为这意味着我会知道它什么时候会发生。）

虽然我没有解决根本问题，但我发现它似乎只有在我尝试更新`mysql text`字段时才会发生。我的解决方法是将字段设置为执行以下操作：

```
qm.position = ""
qm.save
qm.position = x
qm.save 
```

并回答其他所有人......当我运行时，`qm.save!`我没有收到任何错误。我没试过`qm.save?`

当我在 rails 控制台中运行我的代码时，一切正常，正如使用相同查询重新查找对象带来的预期结果所证明的那样。

我在使用时也有同样的`qm.update_attribute(...`问题

我的解决方法让我一瘸一拐，但希望这个线程上的人能够提供帮助。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-03-16T08:54:17.013

使用 ./script/console 并运行此脚本.. 一步一步..

运行第 2 行时查看对象的位置字段是否更新

然后点击 qm.save 或 qm.save!... 进行测试

走着瞧吧。正如蒂姆所提到的 .. 检查日志

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-03-17T04:54:08.673

检查您的 QuestionMembership 课程并确认该职位没有类似

```
 attr_readonly :position 
```

最好的调试方法是

```
 tail -f log/development.log 
```

然后打开另一个控制台并执行执行保存语句的代码。验证是否执行了实际的 SQL Update 语句。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-19T18:54:08.840

检查以确保您的数据库设置正确。如果您正在使用多个数据库（或尚未将默认 sqlite3 数据库更改为 MySQL），您可能正在使用错误的数据库。

运行 ./script/console 中的命令以查看您是否看到相同的行为。

验证是否保存了类似的对象（例如表单或问题）。

如果 Form 或 Question 保存，请找出 QuestionMembership 与 Form 或 Question 对象之间的差异。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-19T19:57:19.670

原来它发出了错误的 SQL。基本上它是通过不存在的 id 列寻找 QuestionMembeship 对象。

我的印象是，对于 has_many_through 关系，该列是不必要的，尽管我似乎被误导了。

为了解决这个问题，我只是将 id 列作为主键添加到表中。感谢所有的指点。

# algorithm - 稀疏位向量的散列

> ID：646771
> 
> 赞同：2
> 
> 时间：2009-03-14T21:22:34.467
> 
> 标签：algorithm, hash

有没有人对稀疏位向量的良好哈希函数有任何好的直觉？举一个具体的例子，假设我想散列一个 4096 位整数，其中每个位为 1 的概率为 10%。

我想在哈希中进行一些压缩。例如 4096 位输入和 32 位输出。这只是一个例子来说明我在寻找什么。当然，非常感谢所有答案。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T21:42:00.677

[布隆过滤器](http://en.wikipedia.org/wiki/Bloom_filter)会有帮助吗？

如果位向量是 2^32 位，那么为什么不直接使用 32 位整数呢？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2010-04-07T06:31:27.340

我会像往常一样通过调用来散列这些位

```
hash<vector<bool>>(...) 
```

如果您使用的是 C++0x，否则请参阅 boost::hash。

# asp.net - 如何使用 BlockUI 和 Jquery 中断 ASP.NET 按钮回发

> ID：646773
> 
> 赞同：1
> 
> 时间：2009-03-14T21:25:33.807
> 
> 标签：asp.net, jquery, blockui

我有一个 ASP.NET 页面，上面有许多 ASP:Button 实例。对于某些人，我需要显示确认提示，如果用户选择是，则调用原始回发方法。否则，整个过程被取消。

我有一个正在运行的示例，但我得到不一致的结果，主要是在 FF3 中抛出异常：

```
[Exception... "Illegal operation on WrappedNative prototype object"  nsresult: "0x8057000c (NS_ERROR_XPC_BAD_OP_ON_WN_PROTO)"  location: "JS frame :: 
```

我已经查看了这个错误，但我不知道我哪里出错了。这是我的示例案例。请注意，现在我只是使用 css 类作为查找。从长远来看，如果证明有必要，我可以将控件的 clientID 嵌入到我的 JS 中:)。

html片段：

```
<asp:Button ID="StartButton" runat="server" CssClass="startbutton" Text="Start" OnClick="OnStartClicked" /> 
```

Javascript：

```
$(".startbutton").each(function(){
            $(document).data("startclick", $(this).get()[0].click);
            $(this).unbind("click");
        }).click(function(){
            var oldclick = $(document).data("startclick");
            alert("hello");
            try
            {
                oldclick();
            }
            catch(err)
            {
                alert(err);
                alert(err.description);
            }
            return false;
        }); 
```

我后面的代码比较简单，OnStart方法简单的执行了一个Response.Write

我才刚刚开始研究绑定、取消绑定和触发，所以我在这里的使用几乎是“第一次”。

感谢您的任何帮助或建议。

小号

编辑：

这描述了我正在尝试做的事情，并且还给出了一种陷阱：

[http://www.nabble.com/onClick-prepend-td15194791s27240.html](http://www.nabble.com/onClick-prepend-td15194791s27240.html)

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-14T22:21:59.943

这个怎么样？

```
$(document).ready( function() {
    $('.startbutton').click(function() {
        return confirm('Are you sure?');
    })
}); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T11:51:38.747

我已经解决了 IE7 和 FF3 的问题。

诀窍是通过按钮上的 ASP.NET 属性使回发作为“onclick”工作（见下文）。在 Javascript 中，当您阅读 JQuery 中的点击时，它会作为函数引用被提取出来。

为了使它工作，然后清除 onclick 属性（保存后）并稍后调用它。

我下面的代码显示了它的实际效果。此代码不完整，因为我正在将其变成我的应用程序的通用提示。它的布局也有点糟糕！但至少它显示了原理。

ASP.NET 按钮

```
<asp:Button ID="StartButton" runat="server" CssClass="startbutton" Text="Start" OnClick="OnStart" UseSubmitBehavior="false" /> 
```

Javascript：

```
$(".startbutton").each(function(){
            $(document).data("startclick", $(this).attr("onclick"));
            $(this).removeAttr("onclick");
        }).click(function(){

            $.blockUI({ message: $('#confirm'), css: { width: '383', cursor: 'auto' } }); 

            $("#yes").click(function(){ 

                $.unblockUI();
                var oldclick = $(document).data("startclick");
                try
                {
                    oldclick();
                }
                catch(err)
                {
                    alert(err);
                    alert(err.description);
                }
            });

            $("#no").click(function(){
                $.unblockUI();
            });

            return false;
        }); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T22:28:47.977

你的问题来自这里：

```
$(document).data("startclick", $(this).get()[0].click);
...
var oldclick = $(document).data("startclick");
...
oldclick(); 
```

在这里，您尝试拦截本机事件侦听器，但有两个错误：

1.  使用 unbind 不会删除本机事件侦听器，只会删除使用 jQuery 添加的事件侦听器
2.  `click`是，AFAIK，一种仅用于模拟点击的 IE 方法，它不是事件处理程序本身

您必须使用`onclick`将其值设置为 null 而不是使用 unbind。最后，不要存储在 中`$(document).data(...)`，添加其他按钮时会出现一些问题。这是您可以使用的示例代码：

```
 $("selector").each(function()
  {
    var oldclick = this.onclick;
    this.onclick = null;
    $(this).click(function()
    {
      if (confirm("yes or no ?")) oldclick();
    });
  }); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-17T07:40:22.017

对于 mi 作品： this.OnClientClick = "$.blockUI({ message: $('#ConfirmacionBOX'), css: { width: '275px' } });return false;"; 这是一个按钮（是一个按钮类）

# wcf - 使用 WCF 和 Silverlight 对对象进行序列化

> ID：646777
> 
> 赞同：0
> 
> 时间：2009-03-14T21:27:26.720
> 
> 标签：wcf, silverlight

有没有办法在使用 WCF 和 Silverlight 时挂钩特定类型的序列化方式。例如，我需要调整 System.DateTime 属性的序列化/反序列化方式。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-15T00:52:05.260

这里要小心。每当您更改某些内容的序列化方式时，您还必须更改客户端对其进行反序列化的方式。在更改数据合约的序列化方式之前，您应该有一个很好的理由，因为它们具有很强的互操作性。您所做的任何更改都可能降低互操作性水平。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T21:49:18.867

在您的数据合同中，使用 [OnSerialized] 属性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-12-12T22:57:19.770

由于 Silverlight 不支持序列化回调（请参见[此处](http://blog.wouldbetheologian.com/2009/10/really-missing-serialization-callbacks.html)），您最好将辅助属性添加到包含您需要控制的 DateTime 属性的任何对象，并处理该属性中的任何“序列化”需求。

只是一个想法。

# c# - C# 是否内联属性？

> ID：646779
> 
> 赞同：15
> 
> 时间：2009-03-14T21:29:54.293
> 
> 标签：c#, .net, optimization, clr

C# 是否内联访问属性？我知道内联 JIT 的 32 字节（指令？）限制，但它是内联属性还是*纯*方法调用？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-03-14T21:33:34.410

这取决于 JIT（据我所知，C# 编译器不做任何内联），但我相信 JIT 在大多数情况下会内联琐碎的属性。

请注意，它*不会*内联派生自`MarshalByRefObject`包含`System.Windows.Forms.Control`(via `System.ComponentModel.Component`) 的类型的成员。

我还看到`double`通过属性访问字段时效率最终会降低 - 可能是围绕它有一些微妙之处（由于注册使用等）。

另请注意，64 位和 32 位 JIT 是不同的，包括它们对内联内容的处理。

编辑：我刚刚找到了David Notario 的[2004 年博客文章](http://blogs.msdn.com/davidnotario/archive/2004/11/01/250398.aspx)，其中包含更多信息。然而，那是在 2.0 发布之前——我不会惊讶地看到它现在至少有*一些*改变了。反正可能很感兴趣。

编辑：[另一个问题](https://stackoverflow.com/questions/648409/inlining-functions)提到了[2008 Vance Morrison 博客条目](http://blogs.msdn.com/vancem/archive/2008/08/19/to-inline-or-not-to-inline-that-is-the-question.aspx)，它提供了更多信息。有趣的东西。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-03-14T21:38:48.237

属性访问*只是*一个纯方法调用。编译器为属性访问和具有类似签名的方法调用发出的 IL 没有区别，这可以回答您的问题。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-14T22:01:15.123

我花了一段时间才弄清楚，在JIT 编译**之后，您可以在 Visual Studio 中查看托管代码的反汇编。**

那么为什么不创建一个具有非常简单的访问器属性的类，在发布模式下运行它，设置一个断点，然后看看反汇编的内容呢？

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-03-14T22:19:40.057

我最近发布了一个类似的问题：

[为什么公共领域比属性快？](https://stackoverflow.com/questions/632831/why-are-public-fields-faster-than-properties)

我的问题是公共字段比属性快，因为我正在运行 64 位 Vista，并且 JIT 也将我的代码编译为 64 位，并且我的属性**没有**内联。强制项目为 x86 编译确实内联属性，并且属性和公共字段之间没有速度差异。

因此，C# 32 位 JIT 具有内联属性，而 64 位则没有，也没有任何其他非静态方法。

# macos - 我应该如何从 NSArrayController 控制的 NSTableView 中删除所有项目？

> ID：646787
> 
> 赞同：7
> 
> 时间：2009-03-14T21:39:06.737
> 
> 标签：macos, cocoa, nsarraycontroller

我正在使用`NSArrayController`,`NSMutableArray`并`NSTableView`显示我自己的自定义对象的列表（尽管如果您也只是显示香草`NSString`对象的列表，这个问题可能适用）。

在不同的时间点，我需要清除我的数组并刷新我的数据源中的数据。但是，仅调用`removeAllObjects`我的`NSMutableArray`对象不会触发 KVO 更新，因此屏幕上的列表保持不变。

`NSArrayController`没有可用**的** `removeAllObjects`方法，这看起来很奇怪。（它确实有`addObject`，我用它来添加对象，确保触发 KVO 并更新 UI。）

我设法使这种情况正确发生的最干净的方法是：

```
[self willChangeValueForKey:@"myArray"];
[myArray removeAllObjects];
[self didChangeValueForKey:@"myArray"]; 
```

...所以我不得不自己手动执行 KVO 通知（这是在我的测试应用程序类中，它包含`myArray`属性，`NSMutableArray`如前所述。）

这似乎是错误的 - 有更好的方法吗？从我的谷歌搜索来看，似乎有些人对`removeAllObjects`in的缺乏感到困惑`NSArrayController`，但还没有看到任何更好的解决方案。

我已经看到了这个解决方案：

```
[self removeObjectsAtArrangedObjectIndexes:
  [NSIndexSet indexSetWithIndexesInRange:
    NSMakeRange(0, [[self arrangedObjects] count])]]; 
```

但这对我来说看起来更不愉快。至少我的解决方案至少是少量的自我记录。

Apple 是否没有注意到有时人们可能想要清空通过`NSArrayController`对象管理的列表控件？这似乎很明显，所以我想我一定错过了一些东西......

另外：当然，如果我向数组中添加新项目（通过`NSArrayController`），那么这会触发带有 的 KVO 更新`NSArrayController/NSTableView`，但是：

1.  有时我不会在列表中放入任何项目，因为没有。所以你只看到旧物品。
2.  无论如何，这有点恶心。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-14T23:38:08.043

您不会从表格视图中删除项目。它没有任何项目——它只是显示另一个对象的项目。

如果您将数组控制器的内容数组绑定绑定到某个其他对象的数组属性，那么您应该使用该对象的该属性。使用`[[object mutableArrayValueForKey:@"property"] removeAllObjects]`.

另一方面，如果您没有绑定数组控制器的内容数组绑定，那么您需要`content`直接与其交互。使用`[[arrayController mutableArrayValueForKey:@"content"] removeAllObjects]`. （您也可以使用`arrangedObjects`代替`content`。如果一个不起作用，请尝试另一个 - 我只做过第一种方式，将数组控制器绑定到其他东西。）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-08-15T20:16:46.663

也有这个问题并以这种方式解决：

```
NSArrayController* persons = /* your array controller */;
[[persons content] removeAllObjects]; 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2016-01-17T22:36:44.137

迅速

```
@IBOutlet var acLogs: NSArrayController!

acLogs.removeObjects(acLogs.content as! [AnyObject]) 
```

为我工作。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2015-05-02T09:39:00.643

Swift 中的解决方案：

```
if let ac = arrayController
{
    let range:NSRange = NSMakeRange(0, ac.arrangedObjects.count);
    let indexSet:NSIndexSet = NSIndexSet(indexesInRange: range);
    ac.removeObjectsAtArrangedObjectIndexes(indexSet);
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2018-11-24T01:05:28.920

只是一个适用于 Swift 4 的更新：

```
let range = 0 ..< (self.arrayController.arrangedObjects as AnyObject).count
self.arrayController.remove(atArrangedObjectIndexes: IndexSet(integersIn: range)) 
```

# .net - 什么是一流的编程结构？

> ID：646794
> 
> 赞同：27
> 
> 时间：2009-03-14T21:43:47.553
> 
> 标签：.net

当尝试在 C# 中做一些相当高级的事情（比如某种 hack）时，会提出“一流”的概念。

例如，方法是一流的编程构造，因为你可以用它来做 xyz（xyz 不是方法所做的，而是方法通常给你的，我不记得现在 xyz 是什么了），但是在 . NET 1.1 委托无法传递给方法，因为它们不是一流的编程结构（我读过一些类似的东西）。

究竟什么是一流的编程结构？

谢谢

* * *

## 回答 #1

> 赞同：42
> 
> 时间：2009-03-14T22:31:15.817

[编程语言中“一等公民”或“一等元素”](http://C2.Com/cgi/wiki/?FirstClass)的概念是由英国计算机科学家[Christopher Strachey](http://Wikipedia.Org/wiki/Christopher_Strachey)在 1960 年代在一流函数的背景下引入的。这个原则最著名的表述可能是Gerald Jay Sussman 和 Harry Abelson在[计算机程序的结构和解释](https://mitpress.mit.edu/sites/default/files/sicp/full-text/book/book-Z-H-12.html#%_sec_1.3)（就在之前）中：`Exercise 1.40`

*   它们可以由变量命名。
*   它们可以作为参数传递给过程。
*   它们可以作为程序的结果返回。
*   它们可能包含在数据结构中。

基本上，这意味着你可以用这个编程语言元素做你可以用编程语言中的所有其他元素做的所有事情。

* * *

## 回答 #2

> 赞同：22
> 
> 时间：2009-03-14T21:51:01.763

~~我怀疑你找不到正式的定义~~ [显然 Jörg W Mittag 找到了一个](https://stackoverflow.com/a/646862/22656):)

鉴于这个正式的定义，我剩下的答案只是我当时对它的理解。当然，每个使用“一流构造”一词的人是否意味着完全相同的东西是另一回事。

确定某物是否是“一流”构造的方法是问自己这样的问题：

> 该功能是否受支持并与语言的其余部分完全集成，或者是否存在许多不必要的限制，给人的印象是它只是被“固定”可能只是为了解决 *一个*特定的用例而没有考虑构建的其他区域如果它更充分地成为“语言的一部分”，它真的有用吗？

如您所见，这是一个明确的灰色区域:)

实际上，C# 中的委托就是一个很好的例子。在 C# 1 中，您*可以*将委托传递给方法，并且有很多方法可以将它们*很好*地集成到语言中（例如可用的转换、事件处理、+= 和 -= 转换为 Delegate.Combine/Remove）。我会说它们*是*一流的构造。但是，这并不与委托从 C# 2 和 3 中获得*巨大*收益的事实相矛盾，包括匿名方法、隐式方法组转换、lambda 表达式和协变。它们现在可以说*更像*是一流的构造......即使我会说它们是 C# 1 中的“一流”，我也能理解为什么有人可能不同意。

类似的情况可能会发生`IEnumerable`。在 C# 1.0 中，它被支持，`foreach`但`foreach`循环不会`IEnumerator`在最后处理 。这部分在 C# 1.2 中已修复，但仍然只有语言支持*消费* `IEnumerable`s，而不是创建它们。C# 2.0 提供了迭代器块，这使得实现`IEnumerable`（及其通用等效项）变得微不足道。这是否意味着可迭代序列的概念不是 C# 1.0 中的“一流”构造？值得商榷，基本上...

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-14T21:51:14.697

> 究竟什么是一流的编程结构？

**如果语言以类似于其他类型的对象的方式**支持某事物，那么它就是一流的构造。

例如，在 C++ 中，函数不会被视为一等构造：您可以在运行时创建其他类型的对象，但不能实例化新函数。相比之下，在 C# 3 及更高版本中，函数可能会被视为引入 lambdas/匿名函数的一流构造。

与许多其他事物一样，这自然是一个主观定义。Wikipedia对更具体的示例进行[了很好的总结，](http://en.wikipedia.org/wiki/First-class_object) [C2](http://c2.com/cgi/wiki?FirstClass)也是如此。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-14T21:55:18.070

[C2 wiki 有一个很好的关于一流语言结构的条目。](http://c2.com/cgi/wiki?FirstClass)基本上，这是您不必在语言中伪造的东西。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-14T21:55:39.053

我对一流的编程结构的理解是，它意味着你可以用最好的方式来做这*件事*，不管那是什么，而不必做两三件事，或者结合两三个其他概念。

所以，Java 没有一流的闭包支持。然而，我们可以通过构建一个类（使用另一个概念）来支持几乎所有您使用闭包的东西，然后创建该类的实例（*另一个*概念）或匿名扩展该类（*另一个*概念），从而在某种程度上伪造它。

与“功能”相同。在 Java 中你不能有函数，但你可以有静态方法，这是一个相似但仍然不同的概念。

一个人（不是我）也可能会争辩说 Java 的泛型支持不是一流的，因为它是一种库 hack，实际上并不是“在”该语言中的。这意味着您可以在 C# 中使用泛型执行的某些操作在 Java 中无法执行。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-14T23:31:18.667

*究竟什么是一流的编程结构？*

简单的回答：它支持该语言提供的所有标准操作。在面向对象的语言中，如您所料，第一类构造是对象。事实证明，在这样的语言中，出于效率或遗留原因，通常存在二等公民，通常是原始数据类型，它们不是适当的对象，并且您无法对其进行某些操作。

例如，在 Java 中，Point 是一个完整的对象。你可以声明一个

`List<Point> plist;`

然后把积分放进去。int 不是完整的对象。有些事情你不能用一个 int 来做——例如，它的子类，或者除了一些预定义的运算符之外调用它的方法。也不能将其存储在

`List<int> intlist;`

Java 解决了这个问题，因为它有一个“盒装”类型，整数，它是一个完整的对象。例如，您可以声明一个`List<Integer>`。但是，使用 Integer 的效率远低于使用“int”。Java 提供了 Integer 类型到 int 的自动装箱和拆箱（即转换），并在需要其中一种或另一种的上下文中再次返回，以帮助程序员结合两全其美。

整数和整数有两种类型——整数和整数——令人困惑，而且有点骇人听闻。有人告诉我，Java 的早期版本没有原语，它的所有类型都是成熟的对象。结果对于它的预期用途来说太慢了（当然，早期的 Java 还是很慢！）所以添加了一些不支持正确对象语义的原语。

*在 .NET 1.1 中，委托无法传递给方法，因为它们不是一流的编程结构（我读过一些类似的东西）。*

我对 .NET 一无所知，但您似乎有这个想法。你是对的——如果委托不能像任何其他标准对象一样传递给方法，它们就不是一流的编程结构。

# gwt - 使用 gwt 将请求发送到不同的域

> ID：646800
> 
> 赞同：0
> 
> 时间：2009-03-14T21:45:23.150
> 
> 标签：gwt

有没有一种方法可以向与使用 RequestBuilder 进行开发的服务器不同的服务器发出请求？

我不断得到

```
com.google.gwt.http.client.RequestPermissionException: The URL
http://127.0.0.1:4321/getSellers is invalid or violates the same-origin
security restriction 
```

当我从 127.0.0.1:8888 发送请求时

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-15T11:09:09.583

GWT 目前不支持跨域 ajax 调用 - 但如果您愿意做一些 jsni，它可以解决。前段时间我听说有一个 gwt 补丁可以解决这个问题，但它并不完美。看到这个[http://groups.google.com/group/Google-Web-Toolkit-Contributors/browse_thread/thread/94c18c4ec158070c/](http://groups.google.com/group/Google-Web-Toolkit-Contributors/browse_thread/thread/94c18c4ec158070c/)

要使用 jsni，您可以使用所谓的 windows.name 传输 - 请参阅此博客[http://www.sitepen.com/blog/2008/07/22/windowname-transport/](http://www.sitepen.com/blog/2008/07/22/windowname-transport/)。我还没有找到一个用于 gwt 的库来自动执行此操作，但我认为在 jsni 中做自己并不难（不要被关于 dojo 的博客误导，它是一种通用技术）。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T21:54:00.587

这里有关于同源策略的主题及其使用 GWT 开发的后果的详细说明：

[http://code.google.com/p/google-web-toolkit-doc-1-5/wiki/FAQ_SOP](http://code.google.com/p/google-web-toolkit-doc-1-5/wiki/FAQ_SOP)

简单的答案是：不，出于安全原因，这是不允许的。但是，应该可以使用各种技术（代理服务器、[Yahoo Pipes](http://www.badlydrawntoy.com/2008/07/08/yahoo-pipes-and-jquery-same-origin-policy/)等）来解决这个限制。由于我不是 AJAX 专家，我将把这些解释留给其他人。

# iphone - 如何在表格单元格中使用 UIWebView？

> ID：646809
> 
> 赞同：16
> 
> 时间：2009-03-14T21:54:08.230
> 
> 标签：iphone, cocoa-touch, uitableview, uiwebview

我正在构建一个带有一些 HTML 文本的表格，因此我使用 UIWebView 作为我的自定义表格单元格的子视图。我已经遇到了一个问题——当我在表格中向下滚动时，UIWebViews 需要一秒钟才能更新。例如，我将查看编号为 1、2 和 3 的行的单元格。我会向下滚动到 8、9 和 10。有一会儿，在单元格 #8 中可见的 UIWebView 的内容是单元格#1 中的内容，单元格#9 中的内容是单元格#2 中的内容，依此类推。

我了解到问题在于 UIWebViews 只是缓慢地渲染它们的文本。建议尽快将内容预加载到 UIWebView 中，而不是等到表接收到 cellForRowAtIndexPath。所以现在，我有一个域对象，它之前只有 WebView 的文本内容 - 但现在它实际上有对 UIWebView 本身的引用。

但是现在 UIWebView 中的一些内容呈现，当我滚动表格时 UIWebView 仅显示为灰色框。如果我触摸灰色框，它实际上会接收触摸并更新 WebView - 例如，如果我触摸一个链接（我可能会或可能不会这样做，因为该框是灰色的，而且很幸运），链接到的页面将被请求并正确显示。

```
- (id)initWithFrame:(CGRect)frame reuseIdentifier:(NSString *)reuseIdentifier {
if (self = [super initWithFrame:frame reuseIdentifier:reuseIdentifier]) {
            // I suppose this isn't necessary since I am just getting it from the
            // Domain Object anyway
    content = [[UIWebView alloc] initWithFrame:CGRectZero];
    content.backgroundColor = [UIColor blackColor];
    [self addSubview:content];
    [content release];
}
return self;
}

// called by cellForRowAtIndexPath 
- (void)setMyDomainObject:(MyDomainObject*)anObject {
UIWebView *contentWebView = anObject.contentWebView;
int contentIndex = [self.subviews indexOfObject:content];
[self insertSubview:contentWebView atIndex:contentIndex];
} 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-05-30T05:59:28.203

解决这个问题的一种方法是使用多个 UILabel，每个 UILabel 都有不同的字体。然后策略性地将它们放置在单元格中，使它们看起来像连续的文本。我已经在 UITableView 中看到了这一点，效果非常好。

另一个性能问题可能是您正在覆盖 UItableViewCell 和它的 init 方法。这几乎总是会导致 UITableView 的性能不佳。相反，只需使用常规 UITableViewCell 实例并将子视图添加到它的 contentView。

这已被 Matt Gallagher 的[Easy Custom UITableView Drawing](http://cocoawithlove.com/2009/04/easy-custom-uitableview-drawing.html)广泛涵盖。

描述的另一种方法是使用 Three20，它也可以为您提供样式文本。

您当前尝试的操作无法使用 UIWebview 完成。

预加载无济于事：当 UIWebview 在屏幕外渲染时，这会减慢 UI；你应该经常在 iPhone 上练习延迟加载。

将 UIWebviews 放入 UITableView 会带来潜在的不可接受的性能影响。您将需要使用其他方式来实现您的目标。

不幸的是，NSAttributedString 在 UIKit 中不可用，它可以轻松解决您的问题。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-04-28T19:27:28.607

所以这是我更新的答案：我已经使用一个大的 UIWebView 实现了一个表格，将样式化文本放在我自己的 Twitter 客户端应用程序[HelTweetica](http://felttip.com/heltweetica/)的表格单元格中（有可用的源代码）。只要您了解如何在 HTML 和 CSS 中进行布局，它就可以很好地工作。

您只需创建一个`NSMutableString`并添加构成文档的 HTML 行。您可以引用应用程序沙箱中的外部文件，例如 CSS 文件。您可以设置自定义 URL 操作，例如“youraction://file.txt”，您的 Web 视图代理可以拦截和处理这些操作作为替换`IBAction`s：

```
- (void) refreshWebView {
    TwitterAccount *account = [twitter currentAccount];
    NSMutableString *html = [[NSMutableString alloc] init];
    // Open html and head tags
    [html appendString:@"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\n"];
    [html appendString:@"<html xmlns=\"http://www.w3.org/1999/xhtml\" xml:lang=\"en\" lang=\"en\">\n"];
    [html appendString:@"<head>\n"];
    [html appendString:@"<meta name='viewport' content='width=device-width' />"];
    [html appendString:@"<link href='style-ipad.css' rel='styleSheet' type='text/css' />"];
    [html appendString:@"<script language='JavaScript' src='functions.js'></script>"];

    // Body
    [html appendString:@"</head><body><div class='artboard'>"];

    // [...]

    // Close artboard div, body. and html tags
    [html appendString:@"</div></body></html>\n"];

    NSURL *baseURL = [NSURL fileURLWithPath: [[NSBundle mainBundle] bundlePath]];
    [self.webView loadHTMLString:html baseURL:baseURL];
    [html release];
} 
```

您可以使用 javascript 重新加载页面的某些部分：

```
- (void) refreshTabArea {
    NSString *html = [self stringByEscapingQuotes: [self tabAreaHTML]];
    NSString *js = [NSString stringWithFormat: @"document.getElementById(\"tab_area\").innerHTML = \"%@\";", html];
    [self.webView stringByEvaluatingJavaScriptFromString:js];
} 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-05-27T19:03:40.807

如果 Web 视图中的内容仅限于样式文本或超链接，您可能需要查看 Three20 项目：http: [//github.com/joehewitt/three20/tree/master](http://github.com/joehewitt/three20/tree/master)

它的`TTStyledText`类支持`<b>, <i>, <img>, and <a>`内容中的标签。可能比 webviews 更轻量级。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-20T21:38:10.700

这不是回答最初提出的问题，而是退后一步，看看更大的图景，如果您尝试在表格单元格中显示超链接，这是否意味着当您单击它时会打开 Web 浏览器？如果您在表格单元格中显示样式文本，看起来像或提示链接，但打开一个带有全屏 Web 视图的单独屏幕，让您点击链接，会不会一样？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-16T04:43:21.420

您说“由 setRowAtIndexPath 调用”，您可能是指“cellForRowAtIndexPath”，它是当行变得可见并需要创建单元格时调用的 UITableView 方法。确保在此方法中正确初始化和更新单元格内容。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-14T23:24:47.123

您是否考虑过在表格单元子类上覆盖 -prepareForReuse 方法？如果滚动时单元格似乎没有更新，则可能是可重用单元格的内容没有被清除和重置。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2010-04-27T19:04:54.193

我的理解是，除非您在 viewDidLoad() 发生后开始加载它，否则 WebView 不会呈现。

# iphone - 如何准确计时在 iPhone 上调用函数所需的时间？

> ID：646815
> 
> 赞同：9
> 
> 时间：2009-03-14T21:59:15.847
> 
> 标签：iphone, benchmarking

我想知道以至少 1ms 的精度向对象发送消息需要多长时间。我该怎么做呢？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-03-15T02:16:44.260

您可以使用`mach_absolute_time`以纳秒为单位进行测量。

```
#import <mach/mach_time.h>

uint64_t startTime = 0;
uint64_t endTime = 0;
uint64_t elapsedTime = 0;
uint64_t elapsedTimeNano = 0;

mach_timebase_info_data_t timeBaseInfo;
mach_timebase_info(&timeBaseInfo);

startTime = mach_absolute_time();

//do something here

endTime = mach_absolute_time();

elapsedTime = endTime - startTime;
elapsedTimeNano = elapsedTime * timeBaseInfo.numer / timeBaseInfo.denom; 
```

参考： [技术问答 QA1398：马赫绝对时间单位](http://developer.apple.com/qa/qa2004/qa1398.html)

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2009-03-14T22:14:53.110

这就是我所做的：

```
NSDate * start = [NSDate date];
// do whatever I need to time
NSLog(@"time took: %f", -[start timeIntervalSinceNow]); 
```

输出将以秒为单位（带小数部分）。 `NSDate`s 具有毫秒级的分辨率，尽管我不确定它们的精确度。

如果您尝试计时的代码太快，请将其放入运行代码一百次的循环中。（当然，这假设您正在计时的代码没有副作用。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2016-11-02T07:28:46.040

使用**dispatch_benchmark**以纳秒为单位记录方法执行时间。
它的语法比手动循环好得多，并且调用**mach_absolute_time()** dispatch_benchmark 是 Grand Central Dispatch 的一部分。此函数未公开声明，因此您必须在使用前自行声明：

`extern uint64_t dispatch_benchmark(size_t count, void (^block)(void));`

我将其用于日志执行时间：

```
size_t const  blockIterations = 1; //block call count
uint64_t t = dispatch_benchmark(blockIterations, ^{ //your code inside block
        [self TEST_processJSONDataRecordsWithCompletionHandler:^(id handler) {}];
    });
NSLog(@" Avg. Runtime in nanoseconds : %llu ns", t); 
```

归功于[基准测试](http://nshipster.com/benchmarking/)

# c# - 使用 LINQ C# 填充组合框

> ID：646816
> 
> 赞同：0
> 
> 时间：2009-03-14T22:00:16.077
> 
> 标签：c#, linq-to-sql

我有一个基于 linq 的 windows 项目。有一个表单可以保存人员的部门、职位、姓氏等。在这个表单中，有 2 个组合框项包含标题和部门对象和 1 个文本框、1 个列表框。加载表单时我填写带有 Personel 类的列表框。当列表框的选定索引更改事件发生时，我想用这个 Personel 的部门和标题信息填充 comboDepartman 和 comboTitle（从 DB 获取）。我已经这样做了，但是有一个问题。当我完成这个 ComboBoxes 显示我只有这个人的部门和职务信息不是整个部门和职务信息。当我用整个部门和职务填充组合框时，我想将 selectedindex 更改为人员的部门或职务。

有一个简单的解决方案吗？

// 如果 DepartmanID -1 > selectedindex 值而不是获取 ArgumentOutOfRangeException 所以我的算法不适用于这种情况。

```
 if (listPersonel.SelectedItem !=null)
        {
             Personel p = (Personel)listPersonel.SelectedItem;
             txtPersonelName.Text = p.PersonelName;
             txtPersonelNo.Text = p.PersonelNo.ToString();
             cmbDepartmant.SelectedIndex = Convert.ToInt32(p.DepartmantID) - 1;
             cmbTitle.SelectedIndex = Convert.ToInt32(p.TitleID) - 1;
        } 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-15T10:36:46.697

```
cmbDepartmant.SelectedValue = Convert.ToInt32(p.DepartmantID) 
```

# php - 在 Zend_Loader 中包含 HTMLpurifier

> ID：646827
> 
> 赞同：3
> 
> 时间：2009-03-14T22:11:49.483
> 
> 标签：php, zend-framework, htmlpurifier

我想将 HTMLpurifier 与 Zend 框架结合使用。我很想用 Zend_Loader 加载类及其文件。你将如何包括它？您会只使用 HTMLPurifier.auto.php 还是您知道更好的方法？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2010-07-06T18:59:24.043

我在 Zend Framework 项目中使用 HTML Purifier 作为过滤器。这是我的课程的修改版本：

```
require_once 'HTMLPurifier.includes.php';
require_once 'HTMLPurifier.autoload.php';

class My_Filter_HtmlPurifier implements Zend_Filter_Interface
{
    protected $_htmlPurifier = null;

    public function __construct($options = null)
    {
        // set up configuration
        $config = HTMLPurifier_Config::createDefault();
        $config->set('HTML.DefinitionID', 'My Filter');
        $config->set('HTML.DefinitionRev', 1); // increment when configuration changes
        // $config->set('Cache.DefinitionImpl', null); // comment out after finalizing the config

        // Doctype
        $config->set('HTML.Doctype', 'XHTML 1.0 Transitional');

        // configure caching
        $cachePath = APPLICATION_PATH . '/../cache/htmlpurifier';
        if (!is_dir($cachePath)) {
            mkdir($cachePath, 0755, true);
        }
        $cachePath = realpath($cachePath);
        $config->set('Cache.SerializerPath', $cachePath);

        if (!is_null($options)) {
            //$config = HTMLPurifier_Config::createDefault();
            foreach ($options as $option) {
                $config->set($option[0], $option[1], $option[2]);
            }
        }

        $this->_htmlPurifier = new HTMLPurifier($config);
    }

    public function filter($value)
    {
        return $this->_htmlPurifier->purify($value);
    }
} 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-15T03:46:36.527

除非我误解了这个问题（或 HTMLpurifier）。如果你有 Zend_Loader 运行并且它被设置为自动加载。

```
require_once('Zend/Loader.php');
Zend_Loader::registerAutoload(); 
```

或者类似的东西。将 HTMLpurifier 类放在您的库目录中。我只是不确定它的实际类名。

您可以将类文件放在库目录中并按其名称调用它，或者将其扔进杂项包中。

## 例子

```
// SITE/library/Zend/Auth.php
class Zend_Auth
{
}

// SITE/library/htmlpurifier.php
class htmlpurifier
{
}

// SITE/library/misc/htmlpurifier.php
class Misc_HTMLpurifier
{
} 
```

说得通？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T05:14:59.147

您可以使用 Zend_Loader 类注册一个自动加载器类。当您不带任何参数调用 registerAutoLoad() 方法时，您实际上是将 Zend_Loader 本身注册为自动加载器。所以：

```
Zend_Loader::registerAutoLoad(); 
```

// 等于： Zend_Loader::registerAutoLoad('Zend_Loader'),true);

Zend_Loader 尝试使用 Zend Framework 的命名约定加载类，如下所示：

*   每个类都在单独的文件中定义
*   每个类名都以大写字母开头
*   类名中的下划线，表示目录级别。

所以如果'Zend_Loader'是一个类的名字，它在你的路径'Zend'目录下的'Loader.php'文件中定义。对你来说 PHP 可以从文件 Zend/Loader.php 文件加载这个类

如果您的类遵循此命名约定，则可以使用相同的自动加载器自动加载它们。否则，您需要定义自己的自动加载器。编写一个自动加载器类绞盘可以扩展 Zend_Loader，并定义加载功能，以便它将加载具有其他命名约定的类。然后用 Zend_Loader 注册你自己的自动加载器。像这样：

```
Zend_Loader::registerAutoLoad('myLoader',true); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2010-10-18T13:12:38.600

我已将 HTMLPurifier 存档库的内容放在我的库路径中。所以我有这个目录结构：

```
library/
  HTMLPurifier\
  HTMLPurifier.auto.php
  ...
  HTMLPurifier.safe-includes.php 
```

然后我把它放在我使用 HTMLPurifier 的文件的顶部：

```
require_once 'HTMLPurifier.safe-includes.php'; 
```

丑陋，但它的工作。

# c - 编译C程序时出错

> ID：646828
> 
> 赞同：3
> 
> 时间：2009-03-14T22:13:28.887
> 
> 标签：c, compiler-errors, pthreads

我正在尝试完成一个涉及使用信号量的学校项目。我已经包含了正确的头文件（加上一个用于 pthreads）。我也将编译器指向了正确的库。这是用 C 编写的。是的，这是一个作业，但请注意，我不是在寻求实现方面的帮助，而是我似乎无法弄清楚这个该死的编译错误。

这是我的代码的第 47 到 50 行，它们是信号量的“简单”声明并初始化它们：

```
sem_t empty;
sem_init(&empty, 0, 5); 
sem_t full;
sem_init(&full, 0, 0); 
```

以下是我在尝试编译第 48 行时收到的消息。我在第 50 行得到了相同的设置，但为简洁起见没有发布：

```
|48|error: expected declaration specifiers or ‘...’ before ‘&amp;’ token|
|48|error: expected declaration specifiers or ‘...’ before numeric constant|
|48|error: expected declaration specifiers or ‘...’ before numeric constant|
|48|warning: data definition has no type or storage class|
|48|warning: type defaults to ‘int’ in declaration of ‘sem_init’| 
```

我已经在 main() 函数之外声明了所有这些。如何解决这些错误？我很困惑，因为它似乎表明 sem_t 没有数据类型，但它是在我已包含的 semaphore.h 中定义的。我在使用 gcc 的 Ubuntu 下使用 Code::Blocks 编译它。即使从命令行编译也会出现此错误。

在此先感谢您的帮助。

* * *

## 回答 #1

> 赞同：17
> 
> 时间：2009-03-14T22:19:30.353

我认为您的问题可能与[范围](http://www.tru64unix.compaq.com/docs/base_doc/DOCUMENTATION/V40F_HTML/AQTLTBTE/DOCU_016.HTM)有关。

> “我已经在 main() 函数之外声明了所有这些”

听起来很可疑，因为我可以看到您在声明后立即调用了一个函数。

**尝试将呼叫移至`sem_init`内部`main`**

您可以在文件范围内声明事物（即在 main 之外，有效地创建全局变量），但您不能`sem_init`在文件范围内调用函数（如 ）。它们必须在函数范围内调用（例如，在内部`main()`）

# apache-flex - Flash：带有参考表的 AMF3？

> ID：646833
> 
> 赞同：5
> 
> 时间：2009-03-14T22:15:05.667
> 
> 标签：apache-flex, flash, flex3, erlang, amf

[AMF3 规范](http://download.macromedia.com/pub/labs/amf/amf3_spec_121207.pdf)定义了所谓的“参考表”的使用（参见本规范的第 2.2 节）。

我在我用 Erlang 开发的 AMF3 编码器/解码器中实现了这种行为，但是我对 Flash API 不是很有经验，我几乎找不到在将对象序列化为 AMF3 时如何轻松地强制 Flash 使用这些引用表；例如，如果我使用 ByteArray，它似乎只是重复完整的对象编码

```
 var ba:ByteArray = new ByteArray();
 ba.writeObject("some string1");
 ba.writeObject("some string1");
 # =>
 # <<6,25,115,111,109,101,32,115,116,114,105,110,103,49,
 #   6,25,115,111,109,101,32,115,116,114,105,110,103,49>> 
```

（这显然是重复）。

但是，如果这两个字符串在一个单独的 writeObject 调用中，它似乎确实使用了引用：

```
 ba.writeObject(["some string1", "some string1"]);
 # => <<9,5,1,6,25,115,111,109,101,32,115,116,114,105,110,103,49,6,0>> 
```

Socket 的行为似乎相同。

那么，我可以在 Flash 代码中使用引用表吗？（假设我**可能**在 Flash 应用程序和服务器之间有一个非标准协议）

谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-15T17:06:18.053

我认为不同之处在于，在第一个示例中，您正在编写两个字符串文字。在第二个示例中，您正在编写一个引用两个字符串的数组（或 Adob​​e 规范中的复杂对象）。因此，如果您从对象或数组中引用字符串，它会将其写入引用表中。

这不一定是强制执行它的方法，但内置于闪存中的 AMF 序列化程序以这种方式序列化对象似乎是合乎逻辑的，因此它可能是获得所需行为的可靠方法（参考表字符串）。

我希望这对你有帮助！

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-10-12T22:52:23.480

根据 AMF3 规范的最后一句话（[Adobe.com 上的 AMF 3.0 Spec](http://opensource.adobe.com/wiki/download/attachments/1114283/amf3_spec_05_05_08.pdf "Adobe.com 上的 AMF 3.0 规范")）：

> 另请注意，ByteArray 为每个 readObject 和 writeObject 调用使用一组新的对象、对象特征和字符串的隐式引用表。

看来 ByteArray.writeObject 的目的是创建一个可以基于每个对象存储或恢复的序列化。

NetConnection 对象的行为与您所希望的相似。

更新字符串引用表时，不要将空字符串添加到引用表中，这一点很重要。

在维护对象引用表时，您可以按如下方式实现防御性编程：对象引用表是递归构造的，有时包含特征尚未完全了解的对象。如果没有预先分配表索引，则应用程序之间的编号将不一致。AMF3 解码器不应使用部分构造对象的特征——此类输入应标记为错误。

字符串引用表是在编码器处通过“标记”内存中的字符串对象在序列化时实现的。对具有相同内容（匹配字符串）的两个不同字符串对象进行编码似乎没有使用一个字符串引用另一个字符串进行编码。两个字符串都将被输出，并且不会使用按引用的字符串。

您的原始问题可能有解决方案。如果您有许多属于同一个类的对象，并且您希望将这些对象全部存储在一个存储中，我建议如下： 创建一个“父对象”，其中包含对您打算存储的所有对象的引用。然后使用 ByteArray.writeObject 来持久化该父对象。AMF 将对所有引用的对象进行编码，并以有效的方式表示重复对象类的特征。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-08-15T05:01:48.857

查看官方 AMF3 规范的最后一页，您会发现 ByteArray 几乎一文不值。您必须编写自己的 AMF3 序列化器/解串器。

# javascript - 通过平面 POST 请求从 javascript 发送分层数据

> ID：646834
> 
> 赞同：0
> 
> 时间：2009-03-14T22:15:23.733
> 
> 标签：javascript

我有一个页面，用户可以在该页面上动态创建一些相同的输入组，填充它并发送到服务器。

```
<input type="text" name="firstName"/>  
<input type="text" name="lastName"/> 
```

将此数据发送到服务器的更好方法是什么？

也许有一些简单的方法可以通过 POST 请求模拟分层数据，避免 XML 结构？

不同的“name”属性值（“firstName1”、“firstname2”）？

为每个组或输入创建 ID？

依赖 POST 请求中名称-值对的顺序？

编辑：我当然知道 JSON。但只是为了使用一些最小的层次结构，我想遵循第二个答案：在 post 请求中依赖 firstname-lastname 的顺序。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T22:57:28.873

您可以使用 JSON 序列化而不是 XML。在浏览器端，您可以使用像[这样的 Javascript JSON 库之一](http://www.json.org/js.html)，并且有很多服务器端语言的实现，您可以将其用于反序列化。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T23:09:19.533

如果数据对是有序的，则不需要额外的标识符，因为订单已经标识了数据对。因此，您可以对每个数据对使用`firstName`and ：`lastName`

```
firstName=First%20Name%201&lastName=Last%02Name%201&firstName=First%20Name%202&lastName=Last%20Name%202&… 
```

然后，您的服务器端应用程序只需组合每个数据对。

但是当数据具有特殊格式时，某些语言/系统已经这样做了。在 PHP 中，您可以[使用语法自动获取数据数组*`arg`*`[]`](http://docs.php.net/manual/en/faq.html.php#faq.html.select-multiple)。

# c# - EntityFramework 多对多与联结表

> ID：646838
> 
> 赞同：2
> 
> 时间：2009-03-14T22:19:33.147
> 
> 标签：c#, wpf, entity-framework, data-binding, sql-server-ce

我有两个表，多对多关系，有一个联结表，如下所示：

```
Member       MemberGroup        Group
=========    ============       =======
PK | ID      PK | ID            PK | ID
   | Name       | Member           | Name
                | Group
                | MemberSince 
```

我需要将特定组的所有成员添加到列表框中。该组是从数据绑定组合框中选择的。我想做这样的事情：

```
listbox1.ItemsSource = DataModel.Members.Where(u=>u.Group == mygroup); 
```

但是，Member 实体仅包含 MemberGroup 条目....而不是实际的组。

做这个的最好方式是什么？

顺便说一句，.NET Framework 3.5、WPF、Entity Framework、C#、SQL Server Compact Edition (2008)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T22:48:58.457

找到了解决方案。

```
public partial class Group
{
    public ObjectQuery<Member> Members
    {
        get
        {
            return (from j in DataModel.MemberGroup
                    where j.Group.ID == this.ID
                    select j.Member) as ObjectQuery<Member>;
        }
    }
} 
```

# c++ - 二进制协议 - 字节交换技巧

> ID：646842
> 
> 赞同：4
> 
> 时间：2009-03-14T22:20:15.313
> 
> 标签：c++, c

假设我们有一个二进制协议，字段网络有序（大端）。

```
struct msg1
{
    int32 a;
    int16 b;
    uint32 c
} 
```

如果不是将网络缓冲区复制到我的 msg1，然后使用“networkToHost”函数读取 msg1

我重新排列/反转 msg1 到

```
struct msg1
{
    uint32 c
    int16 b;
    int32 a;
} 
```

并简单地从网络缓冲区进行反向复制以创建 msg1。在这种情况下，不需要 networkToHost 函数。这种惯用的方法在大端机器中不起作用，但对我来说这不是问题。除此之外，还有其他我想念的缺点吗？

谢谢

PS 对于上述我们强制执行严格对齐（`#pragma pack(1)`等）

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-03-14T22:57:21.837

*除此之外，还有其他我想念的缺点吗？*

恐怕你误解了字节序转换问题的本质。“大端”并不意味着您的字段是反向布局的，因此

```
struct msg1_bigendian
{
    int32 a;
    int16 b;
    uint32 c
} 
```

在大端架构上相当于

```
struct msg1_littleendian 
{
   uint32 c;
   int16 b;
   int32 a;
} 
```

关于小端架构。相反，这意味着每个字段中的字节顺序*是*颠倒的。让我们假设：

```
a = 0x1000000a;
b = 0xb;
c = 0xc; 
```

在大端架构上，这将被布置为：

```
10 00 00 0a
00 0b
00 00 00 0c 
```

高阶（最高有效）字节首先出现。

在 little-endian 机器上，这将被布置为：

```
0a 00 00 10
0b 00
0c 00 00 00 
```

最低位字节在前，最高位在后。

将它们序列化并将消息的序列化形式叠加在一起，您会发现不兼容：

```
10 00 00 0a  00 0b  00 00 00 0c (big endian)
0a 00 00 10  0b 00  0c 00 00 00 (little endian)

   int32 a  int16 b    int32 c 
```

请注意，这不仅仅是字段反向运行的情况。您的提议会导致小端机器将大端表示误认为：

a = 0xc000000; b = 0xb00；c = 0xa000010;

当然不是传输的内容！

对于传输的每个字段，您确实必须将每个单独的字段转换为网络字节顺序并再次转换回来。

更新：

好的，我明白你现在想要做什么。您想反向定义结构，然后 memcpy 从字节字符串的*末尾*到开头（反向复制）并以这种方式反转字节顺序。在这种情况下，我会说，是的，这是一个 hack，是的，它使您的代码不可移植，是的，这不值得。实际上，字节顺序之间的转换并不是一项非常昂贵的操作，而且比反转每个结构的布局要容易得多。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-03-14T22:23:51.403

你确定这是必需的吗？更有可能的是，您的网络流量将成为您的瓶颈，而不是 CPU 速度。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-03-14T22:28:16.713

同意@ribond -

这很有可能让开发人员感到非常困惑，因为他们必须努力将它们与语义相同的结构分开。

鉴于网络延迟比 CPU 处理它的速度要慢 10,000,000 倍，我会保持它们不变。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-14T22:28:09.210

根据编译器将字节打包到结构中的方式，中间的 16 位数字可能不会出现在正确的位置。它可能存储在 32 位字段中，当您反转字节时，它会“消失”。

说真的，这样的技巧在您编写时可能看起来很可爱，但从长远来看，它们根本不值得。

**编辑**

您添加了“pack 1”信息，因此错误消失了，但关于“可爱技巧”的事情仍然存在 - 不值得。编写一个函数来反转 32 位和 16 位数字。

```
inline void reverse(int16 &n)
{
  ...
}

inline void reverse(int32 &n)
{
  ...
} 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-03-15T00:40:06.957

除非您可以证明存在显着的性能损失，否则您应该使用相同的代码将数据传入和传出网络，而不管机器的字节序。作为优化，对于网络顺序与硬件字节顺序相同的平台，您可以使用技巧，但请记住对齐要求等。

在这个例子中，许多机器（尤其是大端的机器）在 int16 成员的末尾和下一个 int32 成员之间需要一个 2 字节的填充。因此，尽管您可以读取 10 字节的缓冲区，但不能将该缓冲区视为结构的图像 - 在大多数平台上它将是 12 字节。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-15T02:32:55.580

正如您所说，这不适用于大端机器。如果您希望您的代码在 x86 世界之外使用，那绝对是一个大问题。帮我们其他人一个忙，只需使用 ntoh/hton 例程，否则您可能会发现自己出现在 thedailywtf someady 上。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-14T23:34:26.850

请帮助您的程序员，并在某个缓冲区中写入与字节序列之间的显式转换。结构的诡计将导致您直接进入字节顺序和对齐地狱（去过那里）。

# sql - SQL Server 2008 日志不会截断

> ID：646845
> 
> 赞同：22
> 
> 时间：2009-03-14T22:23:03.077
> 
> 标签：sql, sql-server, sql-server-2008

我认为自己是一个非常有经验的 SQL 人。但我没有做这两件事：

*   减小已分配日志的大小。
*   截断日志。

    DBCC sqlperf（日志空间）

返回：

```
Database Name   Log Size (MB)   Log Space Used (%)  Status
ByBox       1964.25     30.0657         0 
```

以下不适用于 SQL 2008

```
DUMP TRANSACTION ByBox WITH TRUNCATE_ONLY 
```

运行以下命令也无济于事

```
DBCC SHRINKFILE ('ByBox_1_Log' , 1)
DBCC shrinkdatabase(N'bybox') 
```

我试过备份。我还尝试将数据库的属性 - 'Recover Model' 设置为 'FULL' 和 'SIMPLE' 以及以上所有内容的组合。我还尝试将兼容性设置为 SQL Server 2005（我使用此设置，因为我想匹配我们的生产服务器）和 SQL Server 2008。

无论我尝试什么，日志都保持在 1964.25 MB，使用了 30%，而且还在增长。

我希望日志回到 0% 附近，并将日志文件大小减小到 100 MB，这已经足够了。我的数据库一定很讨厌我；它只是忽略了我要求它对日志执行的所有操作。

进一步说明。生产数据库有相当多的复制表，当我使用以下命令在我的开发盒上执行还原时将其关闭：

```
-- Clear out pending replication stuff
exec sp_removedbreplication
go
EXEC sp_repldone @xactid = NULL, @xact_segno = NULL,
     @numtrans = 0, @time = 0, @reset = 1
go 
```

试：

```
SELECT log_reuse_wait, log_reuse_wait_desc
FROM sys.databases
WHERE NAME='bybox' 
```

退货

```
log_reuse_wait  log_reuse_wait_desc
0   NOTHING 
```

我该如何解决这个问题？

* * *

查看[此](http://social.msdn.microsoft.com/Forums/en-US/sqldatabaseengine/thread/9f9ae5c5-3031-4963-bb16-c7ed05d9890a/)并将恢复模式设置为 FULL 我尝试了以下操作：

```
USE master
GO

EXEC sp_addumpdevice 'disk', 'ByBoxData', N'C:\<path here>\bybox.bak'

-- Create a logical backup device, ByBoxLog.
EXEC sp_addumpdevice 'disk', 'ByBoxLog', N'C:\<path here>\bybox_log.bak'

-- Back up the full bybox database.
BACKUP DATABASE bybox TO ByBoxData

-- Back up the bybox log.
BACKUP LOG bybox TO ByBoxLog 
```

返回：

```
Processed 151800 pages for database 'bybox', file 'ByBox_Data' on file 3.
Processed 12256 pages for database 'bybox', file 'ByBox_Secondary' on file 3.
Processed 1 pages for database 'bybox', file 'ByBox_1_Log' on file 3.
BACKUP DATABASE successfully processed 164057 pages in 35.456 seconds (36.148 MB/sec).

Processed 2 pages for database 'bybox', file 'ByBox_1_Log' on file 4.
BACKUP LOG successfully processed 2 pages in 0.056 seconds (0.252 MB/sec). 
```

完美的！但事实并非如此。

DBCC SHRINKFILE ('ByBox_1_Log' , 1) 现在返回

```
DbId    FileId  CurrentSize MinimumSize UsedPages   EstimatedPages
7   2   251425  251425  251424  251424 
```

并且 DBCC SQLPERF(LOGSPACE) 仍然报告 30% 的使用率。

我想我可能不得不承认 SQL Server 2008 中很可能存在错误，或者我的日志文件已以某种方式损坏。但是，我的数据库处于良好的工作状态，这让我认为有一个错误*（一想到就发抖）*。

* * *

## 回答 #1

> 赞同：36
> 
> 时间：2011-09-01T01:30:28.503

在我的情况下，我在 SQL Server 2008 中有一个 650 MB 的数据库和一个 370 GB 的日志文件。无论我尝试什么，我都无法让它缩小。我尝试了这里列出的所有答案，但仍然没有任何效果。

最后，我在其他地方找到了一个非常简短的评论。它是运行这个：

```
BACKUP LOG DatabaseName TO DISK = N'D:\Backup\DatabaseName_log.bak'
GO
DBCC SHRINKFILE('MyDatabase_Log', 1)
GO 
```

这导致日志文件从 37 GB 缩小到 1 MB。哇！

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-01T14:37:48.087

我找到了*[DBCC SHRINKFILE (Transact-SQL)](http://technet.microsoft.com/en-us/library/ms189493.aspx)* (MSDN)。

以下示例将 AdventureWorks 数据库中的日志文件缩小到 1 MB。为了允许该`DBCC SHRINKFILE`命令收缩文件，首先通过将数据库恢复模型设置为 SIMPLE 来截断文件。

```
USE AdventureWorks;
GO
-- Truncate the log by changing the database recovery model to SIMPLE.
ALTER DATABASE AdventureWorks
SET RECOVERY SIMPLE;
GO
-- Shrink the truncated log file to 1 MB.
DBCC SHRINKFILE (AdventureWorks_Log, 1);
GO
-- Reset the database recovery model.
ALTER DATABASE AdventureWorks
SET RECOVERY FULL;
GO 
```

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2010-09-22T21:50:28.350

## **当心改变恢复模式的影响！！**

现在，对于所有考虑使用该脚本的**生产[DBA](http://en.wikipedia.org/wiki/Database_administrator)**来说，还有一个发人深省的想法：

在您将恢复模型从完整更改为简单之前...如果您处于开发/[质量保证](http://en.wikipedia.org/wiki/Software_quality_assurance)环境中，请不要担心。但是，如果您在生产环境中负责确保在发生问题时完全恢复数据，您可能需要仔细查看 BOL 关于执行此操作的说明（请参阅 BOL 下：“管理数据库” -> “事务日志管理” -> “恢复模型和事务日志管理”）：

一个数据库可以随时切换到另一个恢复模式。然而，从简单的恢复模式转换，是不寻常的。请注意，如果在批量操作期间切换到完整恢复模式，批量操作的日志记录将从最小日志记录更改为完整日志记录，反之亦然。

从简单恢复模式切换后

> 如果您从完整或大容量日志恢复模式切换到简单恢复模式，则会中断备份日志链。因此，我们强烈建议您在切换前立即备份日志，这样您就可以将数据库恢复到该点。切换后，您需要进行定期数据备份以保护您的数据并截断事务日志的非活动部分。
> 
> 切换到简单恢复模式后
> 
> 如果您从完整或大容量日志恢复模式切换到简单恢复模式，则会中断备份日志链。因此，***我们强烈建议您在切换前立即备份日志，这样您就可以将数据库恢复到该点。***切换后，您需要进行定期数据备份以保护您的数据并截断事务日志的非活动部分。

真的吗？“***我们强烈建议您在切换之前立即备份日志，这样您就可以将数据库恢复到那个时候。*** ” 我不明白为什么这个*小*花絮会隐藏在一个名为“切换到简单恢复模式后”的部分中” 让大多数“正常人”认为他们可以继续切换它然后继续或在改变它后回来阅读。

## 咆哮

致微软：所以，如果我错了，请纠正我，如果我在从 FULL 更改为 SIMPLE 之前没有进行 t-log 备份，然后瞧瞧我的数据库以某种方式损坏（听说过[墨菲定律](https://en.wikipedia.org/wiki/Murphy's_law)？）就在我之前'我能够备份......然后我搞砸了，对吧？如果将我的 ****production**** 数据库的恢复模式从 FULL 切换到 SIMPLE 会破坏备份日志链，因此如果我在执行之前未能进行事务日志备份（就像上面建议的那样）***我可能会丢失数据***，那么你为什么不在一个闪烁的选框中突出显示它，让它比你看起来更重要？？！你真的应该抓住我的衬衫并扇我耳光以引起我的注意（可以这么说）并警告我这个UPFRONT的重要性！

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2012-10-23T12:20:52.587

另一种减小日志文件大小的简单方法是：

*   备份日志
*   数据库的完整备份
*   收缩日志文件
*   再次备份日志
*   再次收缩日志文件

通过这种方式，您不必修改任何数据库参数，并且您的日志文件大小为 1 MB。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-03-15T03:34:03.093

我一直讨厌 SQL Server 处理日志文件物理收缩的方式。请注意，我总是通过 Enterprise Manager/SQL Server Management Studio 完成此操作，但似乎当您缩小/截断日志文件时，日志文件的物理大小在对数据库进行完整备份之前不会减小数据文件，然后再次备份日志文件。我永远无法确定确切的模式，但你可以尝试看看确切的顺序是什么。但是，它始终涉及对数据文件进行完整备份。

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-03-24T14:50:22.330

**找到了解决方案！**

我向数据库添加了一个数据负载，因此日志被迫扩展。然后，我删除了不需要的数据，以使我的数据库恢复原状。

备份，瞧，完美的 0% 日志。

所以解决办法就是让日志展开。

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-03-15T03:26:48.337

尝试运行

```
DBCC OPENTRAN 
```

检查是否有任何未结交易。

* * *

## 回答 #8

> 赞同：4
> 
> 时间：2012-08-21T01:42:57.800

这听起来有点愚蠢，但我发现我必须执行两个完整的数据库和日志文件备份才能缩小数据库。

使用[SQL Server Management Studio](http://en.wikipedia.org/wiki/SQL_Server_Management_Studio)时，在执行完整数据库备份和完整事务日志备份后，压缩文件页面显示有大量可用空间，但不会截断日志文件。

但是，当我对数据库和日志文件进行第二次完整备份时，我发现事务日志的完整备份要小得多，因为它似乎只备份自上次备份以来的新更改。

第二次备份完成后，我在管理工作室中再次运行压缩工具。它仍然显示有足够的​​可用空间，但是这次当我单击“确定”时，日志文件的大小会减小。

所以，试试下面的。

1.  对数据库和日志文件进行完整备份。如果您在收缩工具中进行检查，您应该会看到日志文件中现在有大量可用空间。但是单击确定不会删除可用空间。

2.  对数据库和日志文件进行第二次完整备份。您应该会发现数据库的完整备份与第一次完整备份的大小相似。完整事务日志备份的大小应该小得多。

3.  在日志文件上运行收缩工具，如果运气好的话，日志文件的大小应该会减小。上次我这样做时，它从 180 GB 减少到 12 MB，并且压缩工具指出文件中仍有 10 MB 的可用空间。

* * *

## 回答 #9

> 赞同：4
> 
> 时间：2013-08-02T19:39:59.537

我终于找到了解决日志文件收缩问题的方法。之前的所有选项都对我不起作用，并且没有将日志文件缩小到所需的大小。我找到的解决方案是：

*   备份您的数据库
*   将恢复模式设置为简单
*   [使用SQL Server Management Studio](http://en.wikipedia.org/wiki/SQL_Server_Management_Studio)分离数据库
*   删除日志文件
*   附加没有日志文件的数据库。在“添加屏幕”的下半部分，您会看到一条说明日志文件丢失的行
*   单击此行的删除和附加的确定
*   将恢复模式设置回完全

* * *

## 回答 #10

> 赞同：2
> 
> 时间：2009-03-14T22:54:14.107

我知道你的意思 - SQL Server 那样可能有点让人抓狂。这是一些示例代码供您试用。本质上，它会截断日志文件，*然后*尝试缩小文件。让我知道它是如何工作的。另一件事......你不会有未提交的交易，对吗？

```
Use YourDatabase
GO

DBCC sqlperf(logspace)  -- Get a "before" snapshot
GO  

BACKUP LOG BSDIV12Update WITH TRUNCATE_ONLY;  -- Truncate the log file, don't keep a backup
GO

DBCC SHRINKFILE(YourDataBaseFileName_log, 2);  -- Now re-shrink (use the LOG file name as found in Properties / Files.  Note that I didn't quote mine).
GO

DBCC sqlperf(logspace)  -- Get an "after" snapshot
GO 
```

**更新：**西蒙指出他在 BACKUP 命令上遇到错误。当我之前回答时，我没有意识到 SQL Server 2008 中已停用“Truncate_only”。经过一番研究，压缩日志文件的推荐步骤是 (a) 将恢复模式更改为简单，然后 (b) 使用 DBCC ShrinkFile 压缩文件，如上所述。不幸的是，您提到您已经尝试将恢复模式设置为 Simple，因此我假设您之后还运行了 DBCC Shrinkfile。它是否正确？请告诉我。

* * *

## 回答 #11

> 赞同：2
> 
> 时间：2009-03-15T00:03:36.063

这可能是一种痛苦，并且可能有很多事情。您应该确保的第一件事是没有“卡住”的交易。如果你有一个永远不会关闭的事务，你就永远无法收缩日志。运行“DBCC OPENTRAN”以查找运行时间最长的事务。

另外，请确保您重新组织（我认为这是正确的术语）并在缩小之前将所有内容移动到文件的开头。

* * *

## 回答 #12

> 赞同：2
> 
> 时间：2011-12-01T00:07:31.800

阅读答案，我几乎不相信它们是由 DBA 编写的。基本黄金法则：

1.  在执行任何维护（包括缩小日志）之前，您应该在任何数据库中执行完整备份。

2.  在整个维护期间，当特定数据库上没有发生任何其他事情时，执行任何数据库维护，包括缩减。如有必要，暂停非必要的应用程序。永远记住，健康的数据库是与之交互的任何应用程序的灵魂。

毕竟，以下用于缩小数据库事务日志的命令在 SQL Server 2005 和更高版本的 SQL Server 上总是能正常工作：

```
USE DatabaseName
GO
-- Truncate the Transaction log
ALTER DATABASE DatabaseName SET RECOVERY SIMPLE
CHECKPOINT
ALTER DATABASE DatabaseName SET RECOVERY FULL
GO
-- Shrink the Transaction Log as recommended my Microsoft.

DBCC SHRINKFILE ('database_txlogfilelogicalname', [n -size to shrink in MBytes])
GO
 -- Pass the freed pages back to OS control.
DBCC SHRINKDATABASE (DatabaseName, TRUNCATEONLY)
GO
-- Tidy up the pages after shrink
DBCC UPDATEUSAGE (0);
GO
-- IF Required but not essential
-- Force to update all tables statistics
exec sp_updatestats
GO 
```

* * *

## 回答 #13

> 赞同：1
> 
> 时间：2009-03-18T09:46:32.167

我终于得出结论，SQLServer 2008 中存在错误。

我已经尝试了一切，以及我能想到的每一种组合。我已经备份了数据库，删除了它，重新创建了它，恢复了它。完全相同的问题。

我也跑了：

```
DBCC CHECKDB
DBCC UPDATEUSAGE (bybox) 
```

并且所有检查都可以。

我只能说下一个服务包。

* * *

## 回答 #14

> 赞同：1
> 
> 时间：2014-12-02T18:51:26.577

[SQL Server 2012](https://en.wikipedia.org/wiki/Microsoft_SQL_Server#SQL_Server_2012)：我遇到了一个问题，即没有日志文件（并且所有文件都已经在 SIMPLE 恢复中）会缩小。

这对我有用......我重新启动了 SQL Server 实例（因为我可以）并且每个坏男孩都缩小了。

任何阻碍它收缩的东西都随着重新启动而释放。这仅适用于紧急情况（或当它是您的服务器时），而不是常规的长期解决方案。

* * *

## 回答 #15

> 赞同：-1
> 
> 时间：2018-03-27T17:36:29.130

请运行：

```
SELECT name, log_reuse_wait, log_reuse_wait_desc FROM sys.databases 
```

看看`log_reuse_wait`你的问题数据库是什么，如果是复制，这是错误，你需要这个值 0、2 或 4

# linux - 为什么这个 bash 脚本需要我按回车键才能继续？

> ID：646846
> 
> 赞同：0
> 
> 时间：2009-03-14T22:23:24.277
> 
> 标签：linux, bash, shell, command-line, scripting

几分钟前，一个名叫 Juliano 的用户很好地帮助了我，脚本运行良好，但它让我感到困惑，为什么当我按下 enter 时它会继续工作，如果我不这样做，它就会坐在那里直到我必须继续按下 enter。我以为那是 for 循环的工作？

```
 #!/bin/bash
    TIMEFORMAT=%6R
    for file in /home/test/videos/* ; do
     #for loop 2
     for (( i = 0; i < 10; i++ )); do
      #for loop 3
      for ext in avi mpg wmv mov; do
          base="${file##*/}"
          elapsed=$({ time ffmpeg -i "$file" -ar 44100 "${file%/*}/done/${base%.*}.$ext" &>/dev/null; } 2>&1)
          echo "$file $i $ext took $elapsed seconds"
        done
      done
    done 
```

我也可以交换循环 2 和 3 吗？

谢谢大家

## 更新

我怎样才能在for循环中使用变量“i”，以便它在文件末尾连接。它是否正确：

${file%/ *}/done/${base%.* } **$i** .$ext

谢谢你的帮助。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T22:49:03.760

我怀疑`ffmpeg`程序是在进程结束时等待按键的东西。您也许可以向它发送按键，例如：

```
echo -e \\n | time ffmpeg ... 
```

这可能会在 ffmpeg 程序的标准输入中回显一个新行。

是的，您可以交换循环#2 和#3。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T23:23:07.360

我已经在另一个问题中回答了。ffmpeg 要求您覆盖输出文件。提供唯一名称（文件名中带有 $i ）并将 -y 传递给 ffmpeg 可以解决问题。

# sql-server - 在 select 语句的 from 子句中使用变量

> ID：646847
> 
> 赞同：0
> 
> 时间：2009-03-14T22:23:34.947
> 
> 标签：sql-server

我可以编写一个 select 语句，其中 from 子句有一个包含表名的标量变量吗？实际上，我想编写一个存储过程，它将表名作为输入并显示该表中空值的百分比。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T22:25:56.610

不，您必须将语句构建为字符串并在其上调用 sp_execute。

# objective-c - sortUsingFunction 和“不应忽略的无效值”

> ID：646867
> 
> 赞同：1
> 
> 时间：2009-03-14T22:34:39.333
> 
> 标签：objective-c

在我的目标 c 类中，我想对这样的数组进行排序：

```
NSArray *sorted = [unsortedArray sortUsingFunction: mySort context: NULL]; 
```

我的排序功能实现为：

```
NSInteger mySort(id one, id two, void *ctx) { return 1; } 
```

当我构建程序时，编译器告诉我：

```
error: void value not ignored as it ought to be 
```

现在我想我知道编译器试图告诉我什么：

*“我不知道‘mySort’到底是什么，所以我假设它返回‘void’。哎呀，看起来你正试图将‘void’分配给一个变量，不，不能这样做。再试一次。”*

好吧，编译器先生，我要告诉你什么让你知道函数原型是*NSInteger mySort(id, id, void*)*？我尝试将该行放在类头文件中，在“@interface”之前，之后，几乎所有地方，但我无法让它工作。

我必须在哪里/如何为我的排序函数声明函数原型？

提前非常感谢，马克。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-14T23:18:38.667

`sortUsingFunction:`是一个 NSMutableArray 方法，它对数组对象重新排序并且不返回值。看起来您正在寻找`sortedArrayUsingFunction:`NSArray 方法，该方法返回数组的已排序、自动释放的浅表副本。

# c - 如何使用 C 捕获另一个进程的输出？

> ID：646868
> 
> 赞同：4
> 
> 时间：2009-03-14T22:35:09.363
> 
> 标签：c, capture

如何使用纯 C 捕获另一个进程的输出？你能提供示例代码吗？

编辑：让我们假设 Linux。我会对“非常便携”的代码感兴趣。我想做的就是执行一个命令，捕获它的输出并以某种方式处理它。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-14T22:49:44.463

有几种选择，但它在某种程度上取决于您的平台。那说`popen`应该在大多数地方都有效，例如

```
#include <stdio.h>

FILE *stream;
stream = popen("acommand", "r");

/* use fread, fgets, etc. on stream */

pclose(stream); 
```

请注意，这有一个非常具体的用途，它通过运行命令来创建进程，`acommand`并以某种方式附加其标准，以便您的程序可以通过 stream 访问它`FILE*`。

如果您需要连接到现有流程，或者需要进行更丰富的操作，您可能需要研究其他设施。Unix 有各种机制来连接进程标准输出等。

在 Windows 下，您可以使用`CreateProcess`API 创建一个新进程并将其标准输出句柄连接到您想要的。Windows 还支持`popen`.

我知道没有简单的 C 方法可以做到这一点，所以它总是在某种程度上依赖于特定于平台的 API。

根据您的编辑`popen`似乎很理想，它“非常便携”，我认为没有它就没有像操作系统这样的 unix，确实它是 Single Unix Specification 和[POSIX](http://www.opengroup.org/onlinepubs/009695399/functions/popen.html)的一部分，它可以让你做你想做的事，执行一个进程，获取它的输出并处理它。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T22:38:18.513

如果您可以使用系统管道，只需将其他进程的输出通过管道传输到您的 C 程序，然后在您的 C 程序中，只需读取标准输入即可。

```
otherprocess | your_c_program 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-14T22:38:32.337

您使用的是哪个操作系统？在 *nix 类型的操作系统上，如果您的进程正在输出到 STDOUT 或 STDERR，您显然可以使用管道

# xslt - XSLT 中的主样式表共享

> ID：646878
> 
> 赞同：4
> 
> 时间：2009-03-14T22:42:25.853
> 
> 标签：xslt

我想在 XSLT 中创建一个主模板，它可以存储在一个单独的文件中。所有其他页面样式表都使用 xsl:import 共享它。

大师.xslt

```
 <xsl:template match="Page">
  <html>
   <head>
   </head>
   <body>

     <call-template name="Content"/>

   </body>
  </html> 
 </xsl:template>
<xsl:stylesheet> 
```

页面.xslt

```
<xsl:stylesheet>
<xsl:import href="master.xslt"/>

<xsl:template match="/">
  <apply-templates match="Page"/>
</xsl:template>

<xsl:template name="Content">
  ... apply something page-specific
</xsl:template>

</xsl:stylesheet> 
```

页面.xml

```
<Page>
 ... something page-specific
</Page> 
```

我可以改进这个解决方案吗？

*   我不能从主样式表开始，因为我需要 xsl:import 一切。
*   我不希望 master.xslt 在每个特定页面上都包含引用。

另一个决定（违反 xslt 精神）可能是这样的：

大师.xslt

```
<xsl:template name="masterHead">
 <html>
  <head>
  </head>
  <body>
</xsl:template>

<xsl:template name=masterEnd>
 </body>
 </html> 
</xsl:template>

</xsl:stylesheet> 
```

页面.xslt

```
<xsl:stylesheet>
<xsl:import href="master.xslt"/>

<xsl:template match="/">
  <call-template name=masterHead>
   ... apply something page-specific
  <call-template name=masterEnd/>
</xsl:template>

</xsl:stylesheet> 
```

我们不需要任何通用的根`<Page>`元素。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-15T14:55:56.777

**使用[`<xsl:import>`](http://www.w3.org/TR/xslt#import)是正确的设计决策**。这正是该 XSLT 指令的主要用例。

**可以走得更远**——查找[**`<xsl:apply-imports>`**](http://www.w3.org/TR/xslt#element-apply-imports)指令，以及导入的样式表如何应用模板，了解其操作和含义，它绝对不知道任何事情。后者称为[**高阶函数**](http://en.wikipedia.org/wiki/Higher-order_function)，在 XSLT 中使用[**FXSL 库**](http://fxsl.sf.net)（完全用 XSLT 编写）实现。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T23:11:20.370

这对我来说看起来很合适......对于我过去使用的非常常见（虽然我经常使用`<xsl:include/>`，但两者都应该工作）。我可能做出的主要改变是使匹配更加明确（至少在主 xslt 中） - 即

```
<xsl:template match="/Page"> <!-- leading slash --> 
```

所以它不会意外匹配`Page`其他位置的元素（例如，数据分页，like `<Page Index="3" Size="20"/>`）。

我做的另一件常见的事情是添加一个“*”匹配，`xsl:message`如果我没有更具体的节点匹配，则该匹配用于引发错误。当您有错字等时，这会更加明显。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-09-23T12:53:25.370

我真的很高兴找到这个例子，因为我一直在寻找验证这实际上是主/从模板设置的正确方法。但是，所提供的示例在 Tomcat 上无法开箱即用 - 因此，为了帮助只知道如何在此处复制粘贴的其他人，提供一组工作的 Tomcat 主/从文件。

大师.xsl：

```
<?xml version="1.0" encoding="iso-8859-1" ?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output method="xml" encoding="iso-8859-15" doctype-system="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd" doctype-public="-//W3C//DTD XHTML 1.0 Transitional//EN" indent="no"/>
<!-- http://stackoverflow.com/questions/646878/master-stylesheet-sharing-in-xslt -->
 <xsl:template match="ms247">
  <html>
   <head>
    <title>test</title>
   </head>

   <body>
    <div style="border: 1px solid black; width: 200px; float: left; margin: 10px; padding: 5px;">
     <xsl:call-template name="left"/>
    </div>
    <div style="border: 1px solid black; width: 200px; float: left; margin: 10px; padding: 5px;">
     <xsl:call-template name="content"/>
    </div>
    <div style="border: 1px solid black; width: 200px; float: left; margin: 10px; padding: 5px;">
     <xsl:call-template name="right"/>
    </div>
   </body>
  </html>
 </xsl:template>

 <xsl:template name="content">
  <span style="color: red">Content template is empty - overrule in page template.</span>
 </xsl:template>

 <xsl:template name="left">
  <span style="color: red">Left template is empty - overrule in page template.</span>
 </xsl:template>

 <xsl:template name="right">
  <span style="color: red">Right template is empty - overrule in page template.</span>
 </xsl:template>
</xsl:stylesheet> 
```

和slave.xsl：

```
<?xml version="1.0" encoding="iso-8859-1" ?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:import href="master.xsl"/>

 <xsl:template name="content">
  ... apply something page-specific
 </xsl:template>

 <xsl:template name="right">
  And we have RIGHT content!
  <!-- Execute matching template which is NOT triggered automatically -->
  <xsl:apply-templates select="params/param"/>
 </xsl:template>

 <!-- And we do not define any left template -->

 <!-- Example -->
 <xsl:template match="ms247/params/param">
  Paramters on page: <xsl:value-of select="@name"/><br/>
 </xsl:template>
</xsl:stylesheet> 
```

希望这可以帮助其他人 - 不要害羞给我留言。

# google-maps - Google 地图小部件的窗口设置

> ID：646880
> 
> 赞同：0
> 
> 时间：2009-03-14T22:43:49.453
> 
> 标签：google-maps

我在页面中有一个普通的谷歌地图小部件，如果行车路线在新窗口中打开而不是接管当前窗口，我希望它。有这个设置吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-02T22:03:18.957

行车路线进入您在构造 GDirections 对象时指定为第二个参数的任何 HTML 元素。所以我想这意味着你必须在创建 GDirections 对象之前创建窗口，这可能不是你想要的。

查看文档，跳出来的另一件事是，您可以使用选项 getSteps = true 调用 load() 方法。目前尚不清楚“步骤”数据是什么样的，但我认为它本质上是作为 HTML 字符串返回的。（实际上，甚至不清楚你是如何*获取*数据的，但我假设它是 GDirections.getSteps() 或类似的东西。）所以当“加载”事件发生时，你可以创建新窗口然后把“步骤”数据。

# c# - 当存储在结构中时，类分配到哪里？

> ID：646890
> 
> 赞同：3
> 
> 时间：2009-03-14T22:52:37.903
> 
> 标签：c#

我读了一个线程（它有 Marc Gravell 和 Jon Skeet 的输入），它提到如果一个结构在一个类中，那么该结构就像类一样存储在堆上。

如果一个类是结构的成员怎么办？班级被分配到哪里？

谢谢

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-14T22:54:15.513

如果类是结构的成员，则只有**引用**存储在结构中（即实例的 32/64 位地址）。类的实例**总是**在堆上。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T22:54:41.830

还在堆上。该结构将仅包含对类实例的引用（如指针）。

# apache-flex - 有状态客户端中的对象完整性和缓存

> ID：646897
> 
> 赞同：0
> 
> 时间：2009-03-14T22:59:24.097
> 
> 标签：apache-flex, silverlight, caching, object

我想知道在有状态的客户端（如 Flex 或 Silverlight 应用程序）中处理对象完整性的策略有哪些。

我的意思是：考虑一个应用程序，其中有一个 Group 和一个 Member 实体。组包含多个成员，成员可以属于多个组。视图列出了不同的组，这些组是延迟加载的（最初没有成员）。当请求组的详细信息时，所有成员都被加载并缓存，因此下次我们不需要调用服务来获取组的详细信息和成员。

现在，当我们请求另一个组的详细信息时，该组具有已加载的组的相同成员，我们是否会关心该成员已经在内存中的事实？

如果我们不这样做，当我们编辑成员（在第一组中引用）并且更改不会应用于其他成员实例时，我会看到潜在的数据冲突。所以为了解决这个问题，我们可以检查已经加载的成员的服务调用结果（获取组详细信息），然后用缓存的成员替换加载的成员。

有什么技巧、想法或经验可以分享吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T23:05:54.110

您所描述的是通常由“一级缓存”（在 Hibernate 中为“Session”；在 JPA 中为“EntityManager”）解决的问题，它确保特定实体的一个实例仅存在于特定上下文中. 正如您所建议的，这可以应用于从服务器获取的对象，以确保对特定实体的所有引用实际上都是对同一对象实例的引用。您还需要一种机制来确保在 AVM 内创建的实体存在于相同的上下文中，以便它们具有相似的逻辑应用于它们。

Granite Data Services 项目有一个名为“Tide”的项目，旨在解决这个问题：

[http://www.graniteds.org/confluence/display/DOC/6.+Tide+Data+Framework](http://www.graniteds.org/confluence/display/DOC/6.+Tide+Data+Framework)

就 DDD 而言，重要的是不要将后端设计为简单的数据访问 API，例如简单地公开一组 DAO 或存储库。客户端应用程序是不可信的，实际上使用 Charles 等调试代理很容易操作。我总是设计一个为 UI 量身定制的服务 API（以便可以在一次调用中获取屏幕的数据）并强制执行必要的安全或验证逻辑，通常使用注释和 Spring AOP。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-14T23:41:09.317

我要做的是创建一个客户端应用程序服务，它对数据请求进行缓存和服务。这将处理缓存中是否已经存在对象。如果您使用的是 DDD，那么您需要决定什么是您的聚合根实体。组或成员。不能让双方互相控制。需要有一点来管理加载等。在加拿大 ALT.NET OpenSpaces 上查看有关 DDD 的视频。[http://altnetpedia.com/Calgary200808.ashx](http://altnetpedia.com/Calgary200808.ashx)

# java - 奇怪的 ClassCastException

> ID：646899
> 
> 赞同：1
> 
> 时间：2009-03-14T23:05:00.120
> 
> 标签：java, generics, exception, type-inference, classcastexception

这个：

```
Timerange longest = Timerange.longest(breaks);
if (longest.durationInHours() >= MIN_FREE_HOURS)
    return true; 
```

没关系。

但是这个：

```
if (Timerange.longest(breaks).durationInHours() >= MIN_FREE_HOURS)
    return true; 
```

给出：

```
java.lang.ClassCastException 
```

你知道**为什么**吗？！

为简单起见：

```
public static final <T extends Timerange> T longest(List<T> timeranges) {
    return timeranges.get(0);
} 
```

休息：

```
List<Duty> breaks = week.substract(weekDuties); 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T23:10:28.547

如果您尝试：

```
if (((Timerange) Timerange.longest(breaks)).durationInHours() >= MIN_FREE_HOURS)
    return true; 
```

例如，投吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-16T12:39:35.910

大概在您的代码中的某个地方，您会收到警告。听听你的编译器。

要获取详细信息，请将`-Xlint`（特别是`-Xlint:unchecked`）添加到您的 javac 命令行（或执行您的开发环境的等效项）。

# css-sprites - 我还需要在 CSS Sprite 中填充图像吗？

> ID：646901
> 
> 赞同：22
> 
> 时间：2009-03-14T23:06:49.523
> 
> 标签：css-sprites

在 CSS Sprites 中，您经常会在每个图像之间找到填充。我相信这个想法是，如果页面被调整大小，那么一个图像不会渗入另一个图像。

我认为这取决于不同类型的浏览器缩放[（杰夫最好解释）](https://blog.codinghorror.com/the-two-types-of-browser-zoom/)。

但是，我无法在我的测试中看到这种行为。这只是旧浏览器的问题吗？（我目前无法使用 IE6 进行测试，所以我将其视为“旧”）。

我还应该担心留下空间吗？它是一种痛苦。

例如 ：

> 我为 AOL 找到的 CSS Sprite 在每个图像之间都有填充：[查看](http://www.websiteoptimization.com/speed/tweak/css-sprites/aol_dir_sprite.png)
> 
> 但每日秀决定不打扰：[查看](http://www.thedailyshow.com/sitewide/images/top_nav/menu.gif)

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-03-15T00:08:02.683

它*不应该*需要填充，但是在缩放时，尤其是在 IE8（比 RC 更多的测试版）中，如果没有填充，则会出现图像渗色。

最好的例子是转到 Google.com -> 搜索，然后缩放...随着缩放向上/向下舍入，您将开始在图像的右下角看到“下划线”。

理论上，精灵四面的 1px 内边距应该没问题。

这是来自谷歌的精灵（图片）......

![替代文字](https://images.google.ca/images/nav_logo3.png)

但是当放大时，+、-、x 图标会渗入 Google 的主徽标中。

![替代文字](https://i.stack.imgur.com/75VB1.png)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2011-03-12T07:07:01.243

基本上答案是肯定的。两年后，我问了这个问题之后，就会看到 IE9 的发布。IE9 也有这个问题——如果不是比任何其他浏览器更多的话......

这非常令人恼火，因为它是一件很容易解决的事情。

随着 iPad 的市场份额不断增加 - 至少有一半体面的缩放不均匀数量的体验非常重要。

我将不得不在每个图像周围放置一个像素边框，以匹配相邻元素的背景颜色（每侧可能不同）。幸运的是，我基于 .xml 文件自动生成所有 csssprites - 所以我可以以编程方式执行此操作而不会太麻烦。不过还是很痛的。。。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2011-03-22T05:38:53.093

西蒙 - 我的经验是，这当然仍然是一个问题。

针对您的第二个问题，为什么不使用透明填充？（也许你还在支持ie6，这很重要，在这种情况下，我真的很抱歉）。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-03-27T23:12:26.050

说到较旧的浏览器（使用文本缩放的浏览器），您并不总是需要填充。

您的两个示例之间的主要区别在于 Daily Show 精灵已经在图像本身中包含了菜单项的文本。

使用文本缩放时，由于字体较大，AOL 菜单项可能会垂直拉伸，菜单文本甚至可能会换行至两行。为了适应这种可能性，这些图标需要一点填充以确保它们不会流血。通常，您只需尝试确保它不会在 IE6 的五种文本大小中的任何一种上流血。

由于 The Daily Show 的菜单不包含任何（可见的）HTML 文本，它的大小不会受到文本缩放的影响（尽管您可能需要一个`line-height: 0;`左右来确定），所以它不需要任何填充。

正如[sculiffe](https://stackoverflow.com/questions/646901/do-i-still-need-to-pad-images-in-a-css-sprite/646981#646981)已经展示的那样，由于舍入错误，使用页面缩放的浏览器可能需要精灵有一点填充。

# python - PIR 传感器 + Arduino + Python + 电子邮件警报

> ID：646903
> 
> 赞同：5
> 
> 时间：2009-03-14T23:08:52.527
> 
> 标签：python, email, arduino

我们正在为学校开展一个项目，我们有 2 个[PIR](http://en.wikipedia.org/wiki/Passive_infrared_sensor)运动传感器运行 Arduino 微控制器。[我们可以在 Ardunio IDE 和 Python IDLE](http://en.wikipedia.org/wiki/IDLE_%28Python%29)中查看串口的输出。

我们接下来要做的是，在检测到大约 30 秒的运动后，发送电子邮件警报，看到此时我们没有以太网功能，我们认为最简单的方法是通过 Python 获取电子邮件。

如何做到这一点？

### 更新：

此时我们可以从 Python 发送一封电子邮件，我们可以在 Python 中读取 Arduino 串行端口，但我们只是在将它们放在一起时遇到了问题。

这就是我们的 Python 代码的样子，在 while 1: 是发生混淆的地方：

```
import smtplib,serial

ser = serial.Serial(port=2, baudrate=9200)

from email.MIMEMultipart import MIMEMultipart
from email.MIMEBase import MIMEBase
from email.MIMEText import MIMEText
from email import Encoders
import os

gmail_user = "usr@gmail.com"
gmail_pwd = "pw"

def mail(to, subject, text, attach):
   msg = MIMEMultipart()

   msg['From'] = gmail_user
   msg['To'] = to
   msg['Subject'] = subject

   msg.attach(MIMEText(text))

   part = MIMEBase('application', 'octet-stream')
   part.set_payload(open(attach, 'rb').read())
   Encoders.encode_base64(part)
   part.add_header('Content-Disposition',
           'attachment; filename="%s"' % os.path.basename(attach))
   msg.attach(part)

   mailServer = smtplib.SMTP("smtp.gmail.com", 587)
   mailServer.ehlo()
   mailServer.starttls()
   mailServer.ehlo()
   mailServer.login(gmail_user, gmail_pwd)
   mailServer.sendmail(gmail_user, to, msg.as_string())
   # Should be mailServer.quit(), but that crashes...
   mailServer.close()

while 1: **// CONFUSION HAPPENS HERE //** <----------------------

   ser.readline()

   if ser.readline() = "motion" 

   do this mail sequence?

   mail("usr2@gmail.com",
   "Alarm Alert!",
   "Both Motion Sensor A & B have been active for over # seconds",
   "stor_fight.jpg") 
```

任何提示将不胜感激。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-14T23:56:53.223

我不确定你在这个过程的哪一部分遇到了问题，但这里有一个解决方案的草图：

当 Arduino 通过 USB 插入计算机时，您可以使用[pyserial库从 python 与 Arduino 进行通信。](http://pyserial.wiki.sourceforge.net/pySerial)

在 python 方面，您的代码将如下所示：

```
serial = serial.Serial("/dev/tty.usbserial-A6007btF", 38400) # the serial name you can see in the Arduino GUI - you might just need to say "COM1" on Windows
result = serial.readline(); # blocks until you get something from the Arduino
if result == "motion":
    # send email here 
```

在 Arduino 方面，您只需执行以下操作：

```
void loop()
{
    if(30 seconds have passed with motion)
        Serial.println("motion");
} 
```

说得通？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2012-08-01T14:27:35.387

```
ser.readline()

   if ser.readline() = "motion" 
```

此代码从串行端口读取一行两次并丢弃第一个。

您还需要一个双等号进行比较，并且该行将（我假设...）在其末尾有回车符。

您可能想尝试类似的东西

```
if ser.readline().starts_with("motion") 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-15T16:57:20.387

您需要在 Arduino 草图中使用串行库。请参阅`Communication/Serial`此页面上的部分：

[http://arduino.cc/en/Reference/HomePage](http://arduino.cc/en/Reference/HomePage)

`4.Communication`在 Arduino 环境的文件夹中有串行库的示例。

在您的主机上，按照 jder 的建议使用 pySerial 模块。

您可能还会发现 Arduino Playground 中的此页面是一个有用的起点：

[http://www.arduino.cc/playground/Interfacing/Python](http://www.arduino.cc/playground/Interfacing/Python)

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-15T17:26:07.540

从这个问题来看，我想你已经知道如何从串口读取数据了。

所以我建议这样的事情

```
import time,smtplib

beginTime = time.time() + 86400 # stay one day ahead for now
while True:
  if serial port has values : # ie. motion detected
    beginTime = time.time()
  if time.time() - beginTime > 30 :
    mailObj = smtplib.SMTP('smtp_server_here', smtp_server_port)
    mailObj.sendmail('from', 'to..', 'message')
    beginTime = time.time() + 86400 # reset time 
```

我希望这会有所帮助

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-15T00:00:18.770

据我所知，该板有一个标准的 RS-232 端口。您可以创建一个侦听器 Python 脚本，该脚本在事件发生时接受来自板的信号，然后触发发送电子邮件的方法。如果您想要一个设计精美的作品，请查看 Twisted，它包含用于串行端口通信和邮件的软件包。否则检查：

[http://docs.python.org/library/email](http://docs.python.org/library/email)

[http://www.varesano.net/blog/fabio/serial+rs232+connections+python](http://www.varesano.net/blog/fabio/serial+rs232+connections+python)

# ssl - 为什么我使用 SSL 收到“Error commiting response java.io.IOException: Broken pipe at sun.nio.ch.FileDispatcher.write0(Native Method)”

> ID：646909
> 
> 赞同：0
> 
> 时间：2009-03-14T23:19:43.097
> 
> 标签：ssl

遇到此异常的原因是什么：

```
Error commiting responsejava.io.IOException: Broken pipe at sun.nio.ch.FileDispatcher.write0(Native Method) 
```

当我将页面从 http 重定向到 https 时，我遇到了这个异常。奇怪的是，我可以在前 10 到 20 个请求中访问 https。但随后的请求我遇到了这个破管道问题

以下是完整的例外

提交 responsejava.io.IOException 时出错：sun.nio.ch.IOUtil 的 sun.nio.ch.SocketDispatcher.write(SocketDispatcher.java:29) 的 sun.nio.ch.FileDispatcher.write0(Native Method) 的管道损坏。 writeFromNativeBuffer(IOUtil.java:104) 在 sun.nio.ch.IOUtil.write(IOUtil.java:75) 在 sun.nio.ch.SocketChannelImpl.write(SocketChannelImpl.java:302) 在 com.sun.enterprise.server .ss.ASOutputStream.write(ASOutputStream.java:120) 在 com.sun.net.ssl.internal.ssl.OutputRecord.writeBuffer(OutputRecord.java:283) 在 com.sun.net.ssl.internal.ssl.OutputRecord .write(OutputRecord.java:272) 在 com.sun.net.ssl.internal.ssl.SSLSocketImpl.writeRecord(SSLSocketImpl.java:666) 在 com.sun.net.ssl.internal.ssl.AppOutputStream.write(AppOutputStream .java:59) 在 org.apache.coyote.http11.InternalOutputBuffer.commit(InternalOutputBuffer.java:602) 在 com.sun.enterprise.web.connector。grizzly.ProcessorTask.action(ProcessorTask.java:721) at org.apache.coyote.Response.action(Response.java:188) at org.apache.coyote.Response.sendHeaders(Response.java:380) at org.apache .coyote.tomcat5.OutputBuffer.doFlush(OutputBuffer.java:357) 在 org.apache.coyote.tomcat5.OutputBuffer.close(OutputBuffer.java:318) 在 org.apache.coyote.tomcat5.CoyoteResponse.finishResponse(CoyoteResponse.java :528) 在 com.sun.enterprise.web.connector.grizzly.ProcessorTask.doProcess(ProcessorTask.java:604) 在 com.sun 的 org.apache.coyote.tomcat5.CoyoteAdapter.service(CoyoteAdapter.java:192)。 Enterprise.web.connector.grizzly.ProcessorTask.process(ProcessorTask.java:475) 在 com.sun.enterprise.web.connector.grizzly.ProcessorTask.doTask(ProcessorTask.java:426) 在 com.sun.enterprise.web。 com.sun.enterprise.web.connector 上的 connector.grizzly.TaskBase.run(TaskBase.java:281)。grizzly.WorkerThread.run(WorkerThread.java:83

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-03-15T01:45:54.087

断管通常意味着对方关闭或中止了管道。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-15T01:07:10.967

因为有些事情没有奏效。

如果您想要更详细的答案，请尝试编辑您的问题并提供一些上下文（例如，当它发生时您在做什么，您的代码是什么样的，等等）。

否则，这就是任何人都能够给你的最好答案，除非他们纯粹是偶然知道你在说什么。

# windows - 隐藏（或不为人知的）windows 和 unix 命令？

> ID：646916
> 
> 赞同：0
> 
> 时间：2009-03-14T23:25:29.337
> 
> 标签：windows, unix, command-line

您知道的 unix 和 windows 中通常不知道的命令是什么？

听说 windows 包含几个隐藏的应用程序，有时它们可​​能非常有用。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T23:28:28.613

linux: history（命令行的历史）

mogrify（满足所有图像需求/操作）

屏幕（用于通过 ssh 注销后运行的程序）

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T23:47:59.440

在 widows XP 中，如果你曾经尝试过这样的事情

```
cd \\pc\c$ 
```

您将收到错误

```
CMD does not support UNC paths as current directories. 
```

好吧，只要将它们映射到像这样的临时驱动器号，您就可以使用 UNC 路径。

```
pushd \\pc\c$ 
```

然后当你想简单地返回时......

```
popd 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-15T00:04:49.103

视窗：

```
fdisk /mbr 
```

在 Linux 分区失控后救了我的命（和系统）。

Linux：

```
strace 
```

与从我登录的 shell 运行 telnet 的同学一起获取密码很方便；-)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-14T23:29:20.543

我不确定这是否算作未知，但**`rsync`**它是无价的。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-03-14T23:39:21.223

在旧版本的 Windows（尤其是 XP）中，我发现 shutdown 命令非常有用。例如：

```
shutdown /s /t 3600 
```

将在一个小时内关闭计算机。当然，Linux 也有类似的命令（我想说大多数 Linux 用户都非常熟悉“shutdown -h now”），但 Windows 等价的命令却鲜为人知。

我提到旧版本的 Windows 的原因是在较新的版本中（我肯定知道 Vista，不知道 Windows Server 200x）的关机功能已经有点蹒跚。例如，您最多只能设置 10 分钟的等待时间，如果您希望计算机在一两个小时内完成下载后关闭，这将毫无用处。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-03-14T23:53:32.920

[hosts 文件](http://en.wikipedia.org/wiki/Hosts_file)可用于过滤在线广告。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-03-14T23:53:58.333

在 bash 的 ~/.bashrc 文件中：

```
set -o vi 
```

并在 ~/.inputrc

```
set editing-mode vi
set keymap vi 
```

此外，使用**!$**避免重新输入：

```
ls long/dir/name/i/dont/want/to/repeat/file.txt
rm !$ 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-15T00:09:45.097

在 Unix 中：apropos *（大致了解您想要什么）* | 较少的

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-15T19:17:00.657

在 Windows XP+ 上：

*   `fsutil`，文件系统实用程序。当我必须创建特定大小的测试文件 ( `fsutil file createnew <filename> <length>`) 时，我会使用它。
*   `netstat`, 显示协议统计和当前 TCP/IP 网络连接。
*   `netsh`，网络服务外壳；命令行挂钩到各种网络信息。
*   `reg`，注册表外壳，用于从命令行处理注册表。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-03-14T23:42:19.063

在 Windows 上我曾经喜欢 gpedit.msc 但我认为它只在某些版本的 xp 上

当然还有注册

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-03-14T23:54:05.837

mmc.exe

您可以使用管理控制台的准系统做一些惊人的事情，给予管理员访问网络中某些机器的权限。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-03-15T00:06:48.490

在 PowerShell 中，您可以：

```
cd \\server\c$\ 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-15T00:12:47.133

在 Windows 中，我经常使用 SET 来轻松获取计算机的基本信息。还有：IPCONFIG /FLUSHDNS、IPCONFIG /REGISTERDNS（用于清除和重新加载 dns 条目）、TRACERT（用于跟踪您的位置与网络/互联网上的另一个位置之间的路径）、NETSTAT -s -p tcp（用于网络统计）、和 PATHPING（像 ping 但更好！）

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-15T00:19:08.880

我发现这`findstr`是相对未知的，至少我不知道。`grep`当您不一定想要或不需要安装诸如 mingw 或 cygwin之类的东西，甚至是本地构建的`grep`.

```
 c:\Users\logan>findstr /?
 Searches for strings in files.

 FINDSTR [/B] [/E] [/L] [/R] [/S] [/I] [/X] [/V] [/N] [/M] [/O] [/P] [/F:file]
         [/C:string] [/G:file] [/D:dir list] [/A:color attributes] [/OFF[LINE]]
         strings [[drive:][path]filename[ ...]]

   /B         Matches pattern if at the beginning of a line.
   /E         Matches pattern if at the end of a line.
   /L         Uses search strings literally.
   /R         Uses search strings as regular expressions.
   /S         Searches for matching files in the current directory and all
              subdirectories.
   /I         Specifies that the search is not to be case-sensitive.
   /X         Prints lines that match exactly.
   /V         Prints only lines that do not contain a match.
   /N         Prints the line number before each line that matches.
   /M         Prints only the filename if a file contains a match.
   /O         Prints character offset before each matching line.
   /P         Skip files with non-printable characters.
   /OFF[LINE] Do not skip files with offline attribute set.
   /A:attr    Specifies color attribute with two hex digits. See "color /?"
   /F:file    Reads file list from the specified file(/ stands for console).
   /C:string  Uses specified string as a literal search string.
   /G:file    Gets search strings from the specified file(/ stands for console).
   /D:dir     Search a semicolon delimited list of directories
   strings    Text to be searched for.
   [drive:][path]filename
              Specifies a file or files to search.

 Use spaces to separate multiple search strings unless the argument is prefixed
 with /C.  For example, 'FINDSTR "hello there" x.y' searches for "hello" or
 "there" in file x.y.  'FINDSTR /C:"hello there" x.y' searches for
 "hello there" in file x.y.

 Regular expression quick reference:
   .        Wildcard: any character
   *        Repeat: zero or more occurrences of previous character or class
   ^        Line position: beginning of line
   $        Line position: end of line
   [class]  Character class: any one character in set
   [^class] Inverse class: any one character not in set
   [x-y]    Range: any characters within the specified range
   \x       Escape: literal use of metacharacter x
   \<xyz    Word position: beginning of word
   xyz\>    Word position: end of word

 For full information on FINDSTR regular expressions refer to the online Command
 Reference. 
```

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2009-03-16T23:19:04.483

我只是想把它放进去，因为我今天在 5 台 Windows XP 机器上使用它。

```
systeminfo 
```

为您提供系统详细信息列表，包括操作系统、修补程序/更新、硬件和网络信息。当然，您可以在许多其他地方获得所有这些信息，无论是使用命令还是在 GUI 中，但这是一个很好的命令，可以快速找到有关机器的很多信息。

# installation - 使安装程序元包需要 SIMBL？

> ID：646918
> 
> 赞同：1
> 
> 时间：2009-03-14T23:26:12.113
> 
> 标签：installation, packagemaker, simbl

使用 PackageMaker，我如何制作需要安装 SIMBL 的 .(m)pkg - 如果已安装，安装应该简单地继续，否则，应该在安装我的 SIMBL 插件之前安装 SIMBL？

我尝试简单地将 SIMBL.pkg 拖到左侧窗格中，但不知何故所有资源和`InstallationCheck`脚本都丢失了，所以这可能不对。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-08-22T20:17:28.243

我建议只安装 SIMBL 而不检查。现在，因为 InputManagers 只能进入 /Library（而不是 ~/Library），所以 SIMBL 总是在同一个地方。在这种情况下，安装 SIMBL 并没有什么坏处——作者这些天并不经常更新 SIMBL，因此您不太可能意外“降级”用户的 SIMBL 安装。（[SIMBL 的最后一个版本](http://www.culater.net/software/SIMBL/SIMBL.php)是在 2006 年。）

要将 SIMBL 添加到您的项目中，您可以从左下角的“齿轮”按钮中选择“添加包引用”。您也可以将 SIMBL 文件夹（来自 InputManagers）拖到新选项中（请参阅同一齿轮按钮下的“新选项”）并手动设置其安装位置。

例如，这是我编写的名为[Scalp的 SIMBL 插件](http://pygmysoftware.com/software/scalp/)[的 .pmdoc 文件](http://files.radbox.org/scalp-install.pmdoc.zip)。

# php - 将 PHP 用于守护进程是否明智？

> ID：646928
> 
> 赞同：22
> 
> 时间：2009-03-14T23:29:52.837
> 
> 标签：php, c, linux, daemon

我希望创建一个后台进程，有人告诉我这些通常是用 C 或类似的东西编写的。我最近发现 PHP 可以用来创建一个守护进程，如果我应该以这种方式使用 PHP，我希望能得到一些建议。

这是我对守护进程的要求。

*   不断检查是否有行已添加到 MySQL 数据库表中
*   对从数据库检索到的内容运行 FFmpeg 命令
*   将输出插入 MySQL 表

我不确定我还能提供什么来帮助做出这个决定。只是补充一下，我以前没有做过C。只有 Java 和 PHP 以及基本的 bash 脚本。

它甚至会产生如此大的性能差异吗？

请原谅我的无知，我正在学习！:)

谢谢大家

* * *

## 回答 #1

> 赞同：29
> 
> 时间：2009-03-15T13:20:47.223

正如其他人所指出的，各种版本的 PHP 都存在垃圾收集器的问题。当然，如果您知道您的版本没有此类问题，您就可以消除该问题。关键是，在您编写守护程序并通过 valgrind 运行它以查看安装的 PHP 是否在任何给定机器上泄漏之前，您**不知道（肯定）。**因此，在这方面，您可能编写它只是为了发现 Zend 认为已修复的内容可能仍然存在错误，或者您正在处理稍微旧版本的 PHP 或某些扩展。恶心。

另一个问题是有些错误的信号。以我的经验，信号处理程序并不总是用 PHP 正确输入，尤其是当信号排队而不是合并时。这对您来说可能不是问题，即如果您只需要处理 SIGINT/SIGUSR1/SIGUSR2/SIGHUP。

所以，我建议：

如果守护程序很简单，请继续使用 PHP。如果它看起来会变得相当复杂，或者分配大量内存，您可以考虑在 PHP 中对其进行原型设计后用 C 语言编写它。

我是一个相当顽固的C人。但是，我认为使用 PHP 快速完成一些事情并没有错（除了我解释的情况）。我也认为使用 PHP 对以后可能会或可能不会用 C 重写的东西进行原型设计没有任何问题。例如，如果您使用 PHP，处理数据库内容会比使用 C 中的其他接口管理回调要简单得多。所以在在那种情况下，对于“一次性”，您肯定会更快地完成它。

* * *

## 回答 #2

> 赞同：16
> 
> 时间：2009-03-14T23:35:18.877

我倾向于使用 cron 作业执行此任务，而不是在守护进程中轮询数据库。

您的 FFmpeg 命令可能需要一段时间才能完成，对吧？在那种情况下，*真的*有必要不断地轮询数据库吗？每分钟（或每五、十或二十分钟）运行的 cronjob 不是实现相同目标的更简单方法吗？

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-03-14T23:35:32.153

对于这种事情，Php 并没有比任何其他常见的脚本语言更好或更差。它可以完全访问完成此类工作所需的所有系统调用和库实用程序。如果您最喜欢使用 PHP 编写脚本，那么 php 将为您完成这项工作。

唯一的缺点是 php 不像 perl 或 python 那样无处不在，它们几乎安装在每一种风格的 unix 上。Php 只能在将要提供动态 Web 内容的系统上找到。并不是说 Php 解释器太大或安装成本太高，但如果您最关心的是让您的程序适用于许多系统，那可能是一个小障碍。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-03-15T00:45:33.530

我会相反，建议您尝试使用 php 守护程序。这显然是你最了解的语言。在任何情况下，您都可能会合并一个计时器，因此您可以复制数据库上的查询频率。只要您不天真地循环查询，就没有任何惩罚。

如果它不经常执行，您也可以从 cron 运行 php，让您或代码排空队列然后死掉。

但不要害怕坚持你最了解的东西，作为第一个近似值。

尽量不要使用触发器。它们会强加不必要的耦合，而且测试和调试也没有乐趣。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-03-16T21:17:00.783

正确守护 PHP 脚本的一个问题是 PHP 没有到 dup() 或 dup2() 系统调用的接口，而这些接口是分离文件描述符所必需的。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2009-03-15T13:00:04.777

如果不需要近乎即时的操作，cron-job 可能会工作得很好。

我即将上线，一个我建立的系统，基于排队守护进程'beanstalkd'。我从（在本例中为 PHP）网页调用向守护程序发送各种小消息，然后 PHP 脚本从队列中提取它们并执行各种任务，例如调整图像大小或检查数据库（通常通过 Memcache 传回信息基于商店）。

为了避免长时间运行的进程，我将它包装在一个 BASH 脚本中，根据脚本返回的值 ("exit(1);") 将重新启动脚本，对于它执行的每（比如说）50 个任务. 如果它因为我的计划而重新启动，它将立即执行，任何其他退出值（默认值为 0，所以我不使用它）将在重新启动前暂停几秒钟。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-03-15T12:15:58.953

作为具有合理确定的周期性的 cron 作业运行，PHP 脚本可以完成这项工作，并且生产稳定性当然是可以实现的。您可能希望限制同时 FFMpeg 实例的数量，并确保具有完整的应用程序日志记录和异常处理。我已经在 J​​ava 中实现了连续运行的轮询进程，以及每 10 分钟一次的 cron'd PHP 脚本，两者都很好地完成了这项工作。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-03-14T23:36:44.117

您可能需要考虑制作一个执行[系统](http://dev.mysql.com/doc/refman/5.0/en/mysql-commands.html#id4404990)命令（即 FFmpeg）而不是守护进程的 mysql[触发器。](http://dev.mysql.com/doc/refman/5.0/en/triggers.html)如果一些滞后不是问题，您还可以在 cron 中放置一些每隔几分钟执行一次的内容来检查。如果可以选择，Cron 将是我的选择。

要回答您的问题，php 作为守护程序运行是完全可以的。它不必在 C 中完成。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-15T00:19:27.397

如果你结合 Kent Fredric、tokenmacguy 和 Domster 的答案，你会得到一些有用的东西。

php 可能不适合较长的执行时间，所以让我们缩短每个执行周期，并确保操作系统负责清理任何内存泄漏。作为启动 php 脚本的工具，cron 可以是一个很好的工具。如果你这样做，语言之间没有太大区别。

然而，问题仍然存在。php 甚至能够长时间（几年）作为普通守护进程运行吗？或者各种内存泄漏会吃掉你所有的内存并杀死系统？

/约翰

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-03-15T01:34:31.523

如果这样做，请注意内存泄漏。[据此](http://bugs.php.net/bug.php?id=33595)（在 5.3 中修复），PHP 5.2 的垃圾收集器存在一些问题。也许使用 cron 会更好，所以脚本每次运行都会开始清理。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2009-03-15T12:52:29.490

对于你所描述的，我会选择一个守护进程。确保您在轮询循环中保持睡眠，这样您就不会在没有新任务时轰炸数据库。cronjob 更适合工作流/报告类型的作业，其中没有触发下一次运行的特定事件。

如前所述，PHP 在内存管理方面存在一些问题。您需要确保测试代码是否存在内存泄漏，因为这些会随着时间的推移在长时间运行的脚本中累积。PHP 没有真正的垃圾回收——它依赖于引用计数，这意味着循环引用会导致泄漏。如果您知道这一点，您可以围绕它编写代码。

* * *

## 回答 #12

> 赞同：1
> 
> 时间：2009-11-12T08:05:02.593

如果你决定走守护进程路线，有一个很棒的 PEAR 模块**`System_Daemon`**，我最近在 PHP v5.3.0 安装中成功使用了它。它记录在作者博客上：http: [//kevin.vanzonneveld.net/techblog/article/create_daemons_in_php](http://kevin.vanzonneveld.net/techblog/article/create_daemons_in_php/)

如果您安装了 PEAR，您可以使用以下命令安装此模块：

```
pear install -f System_Daemon 
```

您还需要创建一个初始化脚本：`/etc/init.d/<your_daemon_name>`

那么你就可以：

*   启动守护进程：`/etc/init.d/projNotifMailDaemon start`
*   停止守护进程：`/etc/init.d/projNotifMailDaemon stop`

日志保存在：`/var/log/<your_daemon_name>.log`

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-03-14T23:34:41.560

我不会推荐它。PHP 不是为长期执行而设计的。它的设计主要是短暂的页面。

以我的经验，PHP 在一些较大的任务中可能会出现内存泄漏问题。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2009-03-15T00:44:00.053

听起来，一个 cron 作业和一点点 bash 脚本应该是您所需要的一切。您可以执行以下操作：

```
$file=`mysqlquery -h server < "select file from table;"`
ffmpeg $file -fps 50 output.a etc. 
```

所以 bash 比使用 PHP 更容易编写、移植和维护恕我直言。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2015-11-09T09:33:14.587

如果你知道你在做什么肯定。您需要很好地了解您的操作系统。PHP 通常不适合大多数守护进程，因为它不是线程的，并且没有适合所有任务的基于事件的系统。但是，如果它适合您的需求，那么没问题。现代 PHP (5.3+) 非常稳定，没有任何内存泄漏。只要您启用 GC 并且不实现自己的内存泄漏等，就可以了。

以下是我正在运行的一个守护进程的统计信息：正常运行时间 17 天（由于 PHP 升级而最后重新启动）。写入的字节数：200GB 连接数：处理了数百个连接，处理了数十万个项目/请求：数百万

node.js 通常更适合，尽管有一些小烦恼。已经在相同领域进行了一些改进 PHP 的尝试，但它们并不是真的那么好。

* * *

## 回答 #16

> 赞同：-2
> 
> 时间：2009-03-15T08:11:24.113

克朗工作？是的。

永远运行的守护进程？不。

PHP 没有垃圾收集器（或者至少，上次我检查它没有）。因此，如果您创建循环引用，它永远不会被清理 - 至少在主脚本执行完成之前不会。在守护进程中，这几乎是永远不会发生的。

如果他们在新版本中添加了 GC，那么可以。

* * *

## 回答 #17

> 赞同：-5
> 
> 时间：2009-03-16T21:02:45.950

去吧。我也必须这样做一次。就像其他人说的那样，这并不理想，但它会完成。使用Windows，对吗？好的。

**如果您只需要它偶尔运行**（每小时一次等）。为您的 Firefox 创建一个新的快捷方式，将其放在相关的地方。打开快捷方式的属性，将“目标”更改为：

```
"C:\Program Files\Mozilla Firefox\firefox.exe" http://localhost/path/to/script.php 
```

转到控制面板>计划任务将您的新计划任务指向快捷方式。

**如果您需要它持续运行**或伪持续运行，则需要为脚本添加一些趣味。

开始你的脚本

```
set_time_limit(0);
ob_implicit_flush(true); 
```

如果脚本使用循环（如*while*），则必须清除缓冲区：

```
$i=0;
while($i<sizeof($my_array)){
     //do stuff
     flush();           
     ob_clean();
     sleep(17);
     $i++;
} 
```

# linux - 无法使用 Qt 应用程序连接到 X 服务器：0.0

> ID：646930
> 
> 赞同：28
> 
> 时间：2009-03-14T23:32:40.240
> 
> 标签：linux, qt, x11

在 Fedora 10 上编译。

我刚刚启动了我的第一个 qt GUI 应用程序。我使用了所有默认设置。

它只是一个简单的形式。它构建良好，没有任何错误。但是当我尝试运行应用程序时。我收到以下消息：

```
Starting /home/rob/projects/qt/test1/test1/test1...
No protocol specified
test1: cannot connect to X server :0.0 
```

感谢您的任何建议，

* * *

## 回答 #1

> 赞同：46
> 
> 时间：2009-03-14T23:42:15.193

造成这种情况的一般原因如下：

1.  环境中未设置 DISPLAY。
    **解决方案**：

    ```
    export DISPLAY=:0.0
    ./myQtCmdHere 
    ```

    （不过，这个似乎不是错误的，正如它所说的 X 显示它试图连接的那个。此外，它并不总是 0.0，但大多数时候它是）

2.  **尝试运行 X 应用程序解决方案**的非授权用户（作为 X 拥有用户，即：您自己）

    ```
    xhost +local:root   # where root is the local user you want to grant access to. 
    ```

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-03-15T00:18:53.233

此外，如果您希望您的 X 服务器能够通过 TCP 接收连接，那么这些天您几乎总是必须显式启用它。要测试您的服务器是否允许远程 TCP 连接，请尝试：

远程登录 127.0.0.1 6000

如果 telnet 能够连接，那么您的 X 服务器正在监听。如果不能，那么任何远程 X 应用程序都不会，您需要在服务器上启用远程 TCP 连接。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2016-04-05T20:39:10.800

添加到上述答案。在 travis运行[Code2Pdf测试时，我也遇到了类似的情况。](https://github.com/tushar-rishav/code2pdf)[我使用xvfb-run](http://manpages.ubuntu.com/manpages/lucid/man1/xvfb-run.1.html)解决了这个问题。引用手册页，

> xvfb-run 是 Xvfb(1x) 命令的包装器，它简化了在虚拟 X 服务器环境中运行命令（通常是 X 客户端，或包含要运行的客户端列表的脚本）的任务。

我写的脚本是：

```
check_install_xvfb() { # check and install xvfb
    if hash xvfb-run 2>/dev/null; then
        :
    else
        sudo apt-get update
        sudo apt-get upgrade
        sudo apt-get install xvfb
    fi
}
check_install_xvfb
export DISPLAY=localhost:1.0
xvfb-run -a bash .misc/tests.sh
# .misc/tests.sh is script that runs unit tests. You can replace it with something suitable to you. 
```

> 请忍受我的 bash 代码风格。我是一个菜鸟 bash 程序员。

运行上面的脚本对我有帮助。您可以看到[失败的构建](https://travis-ci.org/tushar-rishav/code2pdf/builds/120957939)和[通过的构建](https://travis-ci.org/tushar-rishav/code2pdf/builds/120988164)。

希望能帮助到你

# java - 为什么 java 的 inputstream.close() 会阻塞？

> ID：646940
> 
> 赞同：7
> 
> 时间：2009-03-14T23:39:21.067
> 
> 标签：java, inputstream

我的 Java 程序使用 ProcessBuilder（redirectErrorStream 设置为 true），并且有一个循环运行进程的输入流的 read 方法，该方法是阻塞的。然后我调用的外部程序停止等待输入和标准输入。我现在想终止该进程。这不是通过（在单独的线程中）调用进程的destroy方法，并调用inputstream的close方法来阻止read方法阻塞，这样我的初始线程就可以结束它的生命了吗？

由于某种原因`process.getInputStream().close()`阻塞。从 JavaDoc 我看不出为什么会发生这种情况。此外，我不明白为什么 javadoc 说“InputStream 的 close 方法什么都不做”。（[指向 javadoc 的链接](http://java.sun.com/javase/6/docs/api/java/io/InputStream.html#close())）有人可以解释一下吗？

谢谢 ：-）

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-14T23:57:40.087

关于阻塞行为，Java 中有一个已知问题，即在与另一个进程通信时会导致死锁。我不知道这是否是您所看到的，但值得研究。[java.lang.Process](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Process.html)的文档说：

> 由于部分原生平台只为标准输入输出流提供有限的缓冲区大小，未能及时写入子进程的输入流或读取输出流可能会导致子进程阻塞，甚至死锁。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-03-14T23:50:01.277

> 由于某种原因 process.getInputStream().close() 块。从 JavaDoc 我看不出为什么会发生这种情况。此外，我不明白为什么 javadoc 说“InputStream 的 close 方法什么都不做”。（链接到 javadoc）有人可以解释一下吗？

如果您查看 Javadoc，您会看到 InputStream 是一个抽象类。扩展 InputStream 的子类应该覆盖 close() 方法（如果需要的话）。显然，您正在使用的 InputStream 子类在 close 方法中做了一些事情。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-15T00:10:48.667

添加到 jdigital 写的内容，查看这篇[文章](http://www.javaworld.com/javaworld/jw-12-2000/jw-1229-traps.html?page=1)。它处理`Runtime.exec()`方法，并`ProcessBuilder`在 Java 5 中引入，但在我看来，讨论可以推广到一般的系统进程。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-03-15T11:35:44.107

我想我想通了。显然，在 process.getInputStream().close() 和 process.getErrorStream().close() 之前调用 process.getOutputStream().close() 很重要。

# xml - 您见过的最严重的 XML 滥用是什么？

> ID：646943
> 
> 赞同：16
> 
> 时间：2009-03-14T23:39:53.967
> 
> 标签：xml

XML 有它的用途。

您见过的最严重的 XML 滥用是什么？XML 是什么使它如此不适合这项任务？

* * *

## 回答 #1

> 赞同：33
> 
> 时间：2009-03-15T00:11:46.480

将其用作数据库，在每次更新/插入时重写文件。一直看到这个...

* * *

## 回答 #2

> 赞同：24
> 
> 时间：2009-03-14T23:56:16.237

存储图像。

特别是作为代表单个字节的数字数组。

[http://thedailywtf.com/Articles/哦，-XML.aspx](http://thedailywtf.com/Articles/Oh,-XML.aspx)

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2009-03-15T00:10:49.383

人们在他们的简历上注明了使用“XML 编程语言”的经验。即时圆形文件。

* * *

## 回答 #4

> 赞同：20
> 
> 时间：2009-03-15T00:14:10.797

在一个政府项目上

XML 包裹在 XML 包裹在 XML 包裹在 XML 包裹

原始 XML 中的数据已经有 8 层深。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-03-15T01:54:07.467

任何类型的配置文件：

*   [马文](http://maven.apache.org/)
*   [蚂蚁](http://ant.apache.org/)
*   [弹簧配置文件](http://static.springframework.org/spring/docs/2.0.x/reference/xsd-config.html)

我认为 XML 的整个概念最令人不安的是，它被用于配置，而它的重点似乎更像是一种[用于解析文档的数据格式](http://www.w3.org/TR/2006/REC-xml-20060816/#sec-origin-goals)。我绝对讨厌这些天不得不写这么多来配置任何东西。您可能会说我是从 Java 背景开始的，但是当我看到[YAML](http://www.yaml.org/start.html)、[JSON](http://www.json.org/)甚至[DSL](http://thediscoblog.com/2007/07/06/builders-are-groovys-bag/)中的示例时，我希望 XML 在人们寻找更严肃的替代方案之前从未流行过。XML 是不可读的，至少与[这些](http://www.json.org/)[替代方案](http://thediscoblog.com/2007/07/06/builders-are-groovys-bag/)[相比](http://www.yaml.org/start.html)根本不可读，我希望能够推动一些重要的影响力来降低 XML 的主导地位。

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2009-03-15T11:40:25.810

敲XML 的人——我认为——并没有意识到在它之前的生活是多么可怕。每次您想要交换数据时，您都必须详细记录如何将其编码为 80 列文本。通常前十列左右是元数据。

然后双方都必须为其编写代码。

正确使用 XML 和模式是您不必编写、测试和调试的一页又一页的代码。

打败我为什么当它用于保存配置数据时人们会讨厌它。这通常是完成这项工作的好方法。我认为这里发生的事情是配置本身是一个痛苦，人们错误地认为问题在于 XML。

世界需要的是一个能够理解模式和 CSS 的优秀 XML 编辑器。与 XML 相关的主要痛苦是必须使用普通的 txt 编辑器对其进行编辑。

* * *

## 回答 #7

> 赞同：11
> 
> 时间：2009-03-15T12:34:11.577

编写自己的 XML 解析器，这是我过去曾犯过的罪过。

* * *

## 回答 #8

> 赞同：8
> 
> 时间：2009-03-15T04:55:24.847

XML 用于将数据从关系数据库中的表移动到**同一应用程序****中同一数据库**中的其他表中。其中一些数据也存储在文本列中，多个值组合成固定的列宽、备忘录字段样式。从多值列构建的多值列。

 *** * *

## 回答 #9

> 赞同：7
> 
> 时间：2010-07-07T07:27:10.793

一些“开发人员”这样做（不，这不是有人在这里开的关于 XML 的有趣笑话，这个人是真的）：

```
<binary>
  <byte i="1">123</byte>
  <byte i="2">99</byte>
  etc...
</binary> 
```

我想当我看到那件事时，我什至气得脸都红了。这样的人应该立即被解雇。

* * *

## 回答 #10

> 赞同：6
> 
> 时间：2009-03-15T01:38:27.693

几乎所有用 Java 编写的东西都在滥用它，或者通过将它用作配置文件的格式来滥用用户。

* * *

## 回答 #11

> 赞同：6
> 
> 时间：2009-03-15T03:37:44.783

[恕我直言， XMPP](http://en.wikipedia.org/wiki/Jabber)非常令人震惊，因为它将整个通信会话编码为单个 XML 文档。结果，不仅基于 DOM 的 API 在实现 XMPP 应用程序中毫无用处（尽管对某些人来说，我确信这是一个特性），而且即使是 SAX 在没有多线程的情况下也是有问题的。

几年前我在这样的环境中实现了一个 Jabber 客户端（单线程，使用 SAX API）；当套接字不再返回数据时，我必须对解析器进行修改以将控制权返回到应用程序级别。

* * *

## 回答 #12

> 赞同：5
> 
> 时间：2009-03-15T00:17:20.397

引自[thedailywtf](http://thedailywtf.com/)：

*   [哦，XML](http://thedailywtf.com/Articles/Oh,-XML.aspx)
*   [平面文件协会使用 XML](http://thedailywtf.com/Articles/The_Flat-File_Society_Does_XML.aspx)
*   [XML vs CSV：选择是显而易见的](http://thedailywtf.com/Articles/XML_vs_CSV__0x3a__The_Choice_is_Obvious.aspx)

* * *

## 回答 #13

> 赞同：5
> 
> 时间：2009-03-15T00:37:03.673

在一个跨部门的政府项目中，我们必须向他们发送数据。他们听说 xml 是未来的方式，所以他们切换了。

他们一直说我们的 xml 无法正确解析。我们查看了我们正在生成的数据，它是有效的 xml，所以我们询问了问题所在。

原来他们已经编写了自己的解析器，它正在计算空格，而我们的 xml 中有太多的空格。

* * *

## 回答 #14

> 赞同：4
> 
> 时间：2009-03-15T01:04:39.503

将其用于少量数据。

* * *

## 回答 #15

> 赞同：4
> 
> 时间：2009-03-15T11:59:48.027

使用 SOAP 传输 XML 文档，该文档只有一个包含编码数据的节点，当解码时，它会为您提供名称-值对的一层深层 XML。

严重地。我已经在我不得不使用的 API 中处理了这个问题。

* * *

## 回答 #16

> 赞同：4
> 
> 时间：2009-03-15T12:34:33.467

使用 XML 来描述 UI 可能不是最糟糕的滥用，但它仍然很糟糕。

我认为引入一种新语言没有意义（每个 XML 模式实际上都是一种新语言，具有您必须学习的特定标签和属性）来完成这项工作，比如说，普通的旧 Java 非常有能力做的。此外，在使用 Java（或任何常规编程语言）编码时，您可以访问标准编程结构，如`if`s 和循环，以及调用方法、为常见结构创建工厂等的能力。以及来自 IDE 的所有其他好处，如调用层次结构，在工作空间中寻找方法的用途等。

在我看来，这适用于桌面和 Web 环境。例如，在 JSP 中，您首先使用 XHTML 来定义您的 Web 页面界面……只是意识到您毕竟需要条件和循环，并且可能还需要一些额外的编程逻辑。于是人们添加了新的标签，比如`c:if, c:forEach`，和一种“表达式语言”，所以你最终用 XML 进行编程，带有这种尴尬的结构，必须作为“标签库”引入。我想得越多，它看起来就越糟糕:)

* * *

## 回答 #17

> 赞同：4
> 
> 时间：2009-03-16T13:58:43.833

**用 XSLT 以外的东西处理 XML**。

我见过太多的基于 DOM 的类似意大利面条的程序，包括它们的作者在内的任何人都无法理解。

只要了解*[**身份转换**](http://dpawson.co.uk/xsl/sect2/identity.html)*作为处理 (XML) 树的通用和最有用的设计模式，人们就会受益匪浅。

* * *

## 回答 #18

> 赞同：2
> 
> 时间：2009-03-15T00:33:50.797

欧洲似乎有某种标准化的 XML 文件格式用于存储银行交易。我见过一个编写新 XML 解析器的竞赛，该解析器能够比其他方法更快地解析这些文件（大小大于 10 GiB）。在这些文件大小下，我不希望 XML 成为一个很好的文件格式选择。

还有一个经常困扰我的问题：某种 Java 对象序列化，它似乎与三个不同的标签一起工作`java`：`object`和`void`. 其余的都是用两个或三个属性和大量嵌套完成的。

* * *

## 回答 #19

> 赞同：2
> 
> 时间：2009-03-15T01:07:21.433

apache配置文件

* * *

## 回答 #20

> 赞同：2
> 
> 时间：2009-03-15T11:54:11.627

营销。认为说“我们制作 Java + XML”就足以吸引一些付费客户。

* * *

## 回答 #21

> 赞同：2
> 
> 时间：2011-06-10T02:55:59.893

数据（大约 40 个字段）存储为 XML 文件，然后 xml 文件存储在 mysql 中......我不明白为什么......

* * *

## 回答 #22

> 赞同：2
> 
> 时间：2011-08-03T09:46:09.870

我已经看到 XML 被（错误地）用作 PLSQL 过程的参数格式（！）。输入参数应采用如下格式：

```
<procedure>
  <parameter1>
    <value1>
  </parameter1>
  ...
</procedure> 
```

并且返回值被类似地格式化为 <result> （eek！）

* * *

## 回答 #23

> 赞同：1
> 
> 时间：2009-03-15T00:21:49.530

当我看到人们真正需要的是 DOM 解析器时使用 SAX 解析器时，我总是很烦。

* * *

## 回答 #24

> 赞同：0
> 
> 时间：2009-03-15T04:21:09.297

[Fontconfig 的配置格式](http://fontconfig.org/fontconfig-user.html)。说真的，谁需要学习一些特殊的 XML 语法（几乎是对 XSTL 的重写）只是为了改变*某些*字体大小的抗锯齿？

* * *

## 回答 #25

> 赞同：0
> 
> 时间：2009-03-15T12:40:19.007

Microsoft 集成服务包生成/使用的 XML。数十/数千行代码 - 在一行中。

* * *

## 回答 #26

> 赞同：-2
> 
> 时间：2010-07-07T07:33:39.543

XAML。

XML 不是，也不应该是一种编程语言。

# .net - 如何在 Windows 7 上调试源代码？

> ID：646944
> 
> 赞同：0
> 
> 时间：2009-03-14T23:40:19.240
> 
> 标签：.net, debugging, xaml, windows-7

我有一个最近开始在 Windows 7 的 beta 版本上崩溃的[项目](http://code.google.com/p/videobrowser/source/browse/#svn/trunk/Configurator)。关于 XAML 解析器的一些问题。

如果这很容易，我不介意解决问题以补偿 Windows 7 中的新 .Net 行为。

我将如何在 Windows 7 上进行调试？

*   第 1 步：在 VM 中安装 Windows 7。
*   第2步 ： ？？？？（安装VS？安装VS调试工具？安装Windows调试工具？）
*   第 3 步：利润

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-03-15T00:02:14.287

最简单的方法可能是安装 VS2k8 并从那里调试它。正如评论中已经指出的那样，该问题很可能与 XAML 没有直接关系，因为初始化窗口时的任何异常（例如构造函数或数据绑定）都可能产生该错误。最里面的例外通常是负责的那个。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-03-15T01:13:34.537

如果你想在 VM 中运行它，你可能不想在 VM 中安装整个 Visual Studio 套件来调试应用程序。将 msvsmon.exe 从您的物理计算机复制到 VM 并运行它。然后，您可以在 VM 内启动该程序，并将 Visual Studio 从您的物理设备附加到它。

如果您更熟悉该调试器，Windbg 还支持远程调试。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-16T05:51:23.347

我发现对我来说最简单的调试方法是[为 windows 安装调试工具](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)，然后使用以下命令手动加载 sos：

```
!load C:\Windows\Microsoft.NET\Framework\v2.0.50727\sos.dll 
```

（注意：我遇到了问题！loadby sos mscorwks）

最后，使用各种[SOS 命令](http://msdn.microsoft.com/en-us/library/bb190764.aspx)进行调试。当然，为了获得更丰富的调试体验，您将需要 PDB 和源代码。

# ruby-on-rails - Rails 中的单数或复数控制器和助手名称

> ID：646951
> 
> 赞同：114
> 
> 时间：2009-03-14T23:43:17.687
> 
> 标签：ruby-on-rails, naming-conventions

对控制器和助手使用单数名称有什么缺点吗？似乎没有什么依赖于此。至少根据我有限的实验，助手似乎不必像他们相应的控制器那样在单数与复数之间做出相同的选择。真的吗？

* * *

## 回答 #1

> 赞同：161
> 
> 时间：2010-10-01T03:09:26.857

绝对是**复数**。

## 带有宁静的路由和单一的控制器

控制器：

```
dog_controller.rb 
```

路线：

```
map.resources :dogs  # => blows up  
map.resources :dog  # is ok, but...  
dogs_path # => blows up  
dog_path  # => ok 
```

## 使用复数控制器

控制器：

```
dogs_controller.rb 
```

路线：

```
map.resources :dogs  
dogs_path # => ok  
dog_path # => ok 
```

`rails generate controller --help`有复数例子：

```
Example:
`rails generate controller CreditCards open debit credit close`

CreditCards controller with URLs like /credit_cards/debit.
    Controller: app/controllers/credit_cards_controller.rb
    Test:       test/controllers/credit_cards_controller_test.rb
    Views:      app/views/credit_cards/debit.html.erb [...]
    Helper:     app/helpers/credit_cards_helper.rb 
```

* * *

## 回答 #2

> 赞同：28
> 
> 时间：2009-03-14T23:49:37.423

对控制器使用复数名称只是一种约定。

复数名称通常听起来更自然（特别是对于直接绑定到特定模型的控制器：用户 -> 用户等），但您可以使用任何您想要的名称。

至于助手，默认情况下所有控制器都可以使用所有助手，因此从技术上讲，如何命名助手根本不重要。将控制器的辅助函数保存在与控制器同名的辅助函数中只是另一种约定。

* * *

## 回答 #3

> 赞同：21
> 
> 时间：2010-08-03T18:47:55.537

模型是单数的，因为它引用了像用户这样的单个对象。控制器是复数，因为它是用户集合的控件（方法）。如何命名路线完全取决于单个开发人员。我从来没有遇到过用户抱怨 Web 请求的 URL 是单数还是复数。在为最终用户提供高质量页面显示或 API 请求的同时，为当前和未来的贡献者维护一个通用约定的最终结果。

* * *

## 回答 #4

> 赞同：13
> 
> 时间：2010-12-09T20:46:27.933

您在 Rails 指南中有非常完整的解释：http: [//edgeguides.rubyonrails.org/routing.html#resource-routing-the-rails-default](http://edgeguides.rubyonrails.org/routing.html#resource-routing-the-rails-default)

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2013-06-07T14:19:10.443

Rails 约定一个控制器处理一个模型，无论该模型的一个或多个实例在运行时是否可以存在。但是，您可以拥有一个 Rails 应用程序，其中（某些）控制器（和相关视图）不与任何特定模型相关联，而是处理一组更复杂的功能。在这种情况下，自动复数没有任何意义。

我目前正在开发的 Rails 应用程序就属于这一类，Rails 期望我在一个地方定义为单数的标识符然后在其他地方以它们的复数形式使用，这让我很恼火。例如，我可能想定义这样的东西`config/routes.rb`：

```
 resource :dashboard, :only => [:show] 
```

然后我想要一个控制器`DashboardController`来显示有关应用程序某些方面的摘要信息，从多个数据库表中收集信息。所以在这里，`Dashboard`不指代应用程序的任何模型，如果控制器的名称是`DashboardsController`.

[我在这个答案](https://stackoverflow.com/a/6940226/351716)中找到了一个很好的解决自动复数形式的烦恼。简而言之，编辑文件`config/initializers/inflections.rb`并将您不想自动复数的单词添加到此定义中：

```
ActiveSupport::Inflector.inflections do |inflect|
  inflect.uncountable %w( dashboard foo bar baz )
end 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2016-09-30T16:32:46.120

Rails中控制器的命名约定**倾向于**控制器名称中最后一个单词的复数形式，尽管**这不是严格要求**的（例如`ApplicationController`）。

例如，`ClientsController`比 更可取`ClientController`，`SiteAdminsController`比`SiteAdminControlle`r 或更可取`SitesAdminsController`，等等。

遵循此约定将允许您使用默认路由生成器（例如资源等），而无需限定每个`:path`or `:controller`，并将在整个应用程序中保持 URL 和路径助手的使用一致。

参考：[控制器命名约定-Rails Doc](http://guides.rubyonrails.org/action_controller_overview.html#controller-naming-convention)

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-02-18T18:34:36.143

如果控制器是资源，那么它必须是复数......

例如

控制器

```
articles_controller.rb 
```

模型

```
article.rb 
```

但是当您没有相应的模型时，您可以使用单数控制器名称，例如

```
welcome_controller.rb 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-01-06T13:47:45.313

当我使用单数作为控制器名称时，我感觉更好

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-03-15T00:22:49.323

使用复数听起来更好，然后如果你有一个控制器来处理单数资源，即用户，那么你仍然可以将 URL 命名为 /user。

有了帮助器，通常不需要为每个控制器都有一个帮助器，并且通常会有帮助器方法，您可以使用多个控制器，而是通过应用程序帮助器将它们全部扔掉，您可以将它们放在自定义帮助器中，而不是像 layout_helper 或任何其他命名良好的文件。

# c++ - 如何判断一个文件在 Python 中是否可以在 Windows 上执行？

> ID：646955
> 
> 赞同：7
> 
> 时间：2009-03-14T23:48:40.217
> 
> 标签：c++, python, windows, winapi

我正在编写[`grepath`](http://gist.github.com/79233)实用程序来查找`%PATH%`与模式匹配的可执行文件。我需要定义路径中给定的文件名是否是可执行的（重点是命令行脚本）。

基于[“判断文件是否可执行”](http://timgolden.me.uk/python/win32_how_do_i/tell-if-a-file-is-executable.html)，我得到了：

```
import os
from pywintypes import error
from win32api   import FindExecutable, GetLongPathName

def is_executable_win(path):
    try:
        _, executable = FindExecutable(path)
        ext = lambda p: os.path.splitext(p)[1].lower()
        if (ext(path) == ext(executable) # reject *.cmd~, *.bat~ cases
            and samefile(GetLongPathName(executable), path)):
            return True
        # path is a document with assoc. check whether it has extension
        # from %PATHEXT% 
        pathexts = os.environ.get('PATHEXT', '').split(os.pathsep)
        return any(ext(path) == e.lower() for e in pathexts)
    except error:
        return None # not an exe or a document with assoc. 
```

在哪里`samefile`：

```
try: samefile = os.path.samefile
except AttributeError:    
    def samefile(path1, path2):
        rp = lambda p: os.path.realpath(os.path.normcase(p))
        return rp(path1) == rp(path2) 
```

`is_executable_win`在给定的上下文中如何改进？Win32 API 中的哪些函数可以提供帮助？

附言

*   时间表现并不重要
*   `subst`驱动器和 UNC，未考虑 unicode 路径
*   如果使用 Windows XP 上可用的功能，C++ 答案是可以的

### 例子

*   `notepad.exe`是可执行的（通常）
*   `which.py`如果它与某些可执行文件（例如，python.exe）相关联并且`.PY`在`%PATHEXT%`ie 中，则它是可执行的，`'C:\> which'`可以启动：

    ```
    some\path\python.exe another\path\in\PATH\which.py 
    ```

*   `somefile.doc`很可能是*不可*执行的（例如，当它与 Word 相关联时）

*   `another_file.txt`不可*执行*（通常）
*   `ack.pl`如果它与某个可执行文件（很可能是 perl.exe）相关联并且在其中，则它是可执行`.PL`的（即，如果它在路径中，`%PATHEXT%`我可以在不指定扩展名的情况下运行）`ack`

### 这个问题中的“可执行”是什么

```
def is_executable_win_destructive(path):
    #NOTE: it assumes `path` <-> `barename` for the sake of example
    barename = os.path.splitext(os.path.basename(path))[0]
    p = Popen(barename, stdout=PIPE, stderr=PIPE, shell=True)
    stdout, stderr = p.communicate()
    return p.poll() != 1 or stdout != '' or stderr != error_message(barename) 
```

在哪里`error_message()`取决于语言。英文版是：

```
def error_message(barename):
    return "'%(barename)s' is not recognized as an internal" \
           " or external\r\ncommand, operable program or batch file.\r\n" \
           %  dict(barename=barename) 
```

`is_executable_win_destructive()`当它定义路径是否指向可执行文件时，如果返回此问题的目的。

例子：

```
>>> path = r"c:\docs\somefile.doc"
>>> barename = "somefile" 
```

之后它执行 %COMSPEC% （默认为 cmd.exe）：

```
c:\cwd> cmd.exe /c somefile 
```

如果输出如下所示：

```
'somefile' 不被识别为内部或外部
命令、可运行的程序或批处理文件。

```

然后它不是可执行文件（为了举例，假设和`path`之间存在一对一的对应关系）。`path``barename`

另一个例子：

```
>>> path = r'c:\bin\grepath.py'
>>> barename = 'grepath' 
```

如果`.PY`在`%PATHEXT%`并且`c:\bin`在`%PATH%`那么：

```
c:\docs> grepath
Usage:
  grepath.py [options] PATTERN
  grepath.py [options] -e PATTERN

grepath.py: error: incorrect number of arguments 
```

上面的输出不等于`error_message(barename)`因此`'c:\bin\grepath.py'`是一个“可执行文件”。

所以问题是如何在不实际运行的情况下找出是否`path`会产生错误？什么 Win32 API 函数以及用于触发“不被识别为内部..”错误的条件是什么？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-03-14T23:56:53.740

shoosh 打败了我 :)

如果我没记错的话，您应该尝试读取文件中的前 2 个字符。如果您返回“MZ”，则您有一个 exe。

```
 hnd = open(file,"rb")
if hnd.read(2) == "MZ":
  print "exe" 
```

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-11-15T20:25:05.977

我认为，这应该足够了：

1.  检查 PATHEXT 中的文件扩展名 - 文件是否可以直接执行
2.  使用 cmd.exe 命令“assoc .ext”，您可以查看文件是否与某个可执行文件关联（启动此文件时将启动某些可执行文件）。您可以解析不带参数的 assoc 的捕获输出，并收集所有关联的扩展名并检查测试的文件扩展名。
3.  其他文件扩展名将触发错误“命令无法识别......”因此您可以假设此类文件不可执行。

我真的不明白你如何区分 somefile.py 和 somefile.txt 因为关联可能真的是一样的。您可以将系统配置为以与 .py 文件相同的方式运行 .txt 文件。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-03-14T23:55:21.997

Windows [PE](http://en.wikipedia.org/wiki/Portable_Executable)总是以字符“MZ”开头。然而，这也包括不一定是可执行文件的任何类型的 DLL。
但是，要检查这一点，您必须打开文件并阅读标题，这样可能不是您要查找的内容。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-11-15T21:29:10.537

这是我在问题中链接的[grepath.py ：](http://gist.github.com/79233/)

```
#!/usr/bin/env python
"""Find executables in %PATH% that match PATTERN.

"""
#XXX: remove --use-pathext option

import fnmatch, itertools, os, re, sys, warnings
from optparse import OptionParser
from stat import S_IMODE, S_ISREG, ST_MODE
from subprocess import PIPE, Popen

def warn_import(*args):
    """pass '-Wd' option to python interpreter to see these warnings."""
    warnings.warn("%r" % (args,), ImportWarning, stacklevel=2)

class samefile_win:
    """
http://timgolden.me.uk/python/win32_how_do_i/see_if_two_files_are_the_same_file.html
"""
    @staticmethod
    def get_read_handle (filename):
        return win32file.CreateFile (
            filename,
            win32file.GENERIC_READ,
            win32file.FILE_SHARE_READ,
            None,
            win32file.OPEN_EXISTING,
            0,
            None
            )

    @staticmethod
    def get_unique_id (hFile):
        (attributes,
         created_at, accessed_at, written_at,
         volume,
         file_hi, file_lo,
         n_links,
         index_hi, index_lo
         ) = win32file.GetFileInformationByHandle (hFile)
        return volume, index_hi, index_lo

    @staticmethod
    def samefile_win(filename1, filename2):
        """Whether filename1 and filename2 represent the same file.

It works for subst, ntfs hardlinks, junction points.
It works unreliably for network drives.

Based on GetFileInformationByHandle() Win32 API call.
http://timgolden.me.uk/python/win32_how_do_i/see_if_two_files_are_the_same_file.html
"""
        if samefile_generic(filename1, filename2): return True
        try:
            hFile1 = samefile_win.get_read_handle (filename1)
            hFile2 = samefile_win.get_read_handle (filename2)
            are_equal = (samefile_win.get_unique_id (hFile1)
                         == samefile_win.get_unique_id (hFile2))
            hFile2.Close ()
            hFile1.Close ()
            return are_equal
        except win32file.error:
            return None

def canonical_path(path):
    """NOTE: it might return wrong path for paths with symbolic links."""
    return os.path.realpath(os.path.normcase(path))

def samefile_generic(path1, path2):
    return canonical_path(path1) == canonical_path(path2)

class is_executable_destructive:
    @staticmethod
    def error_message(barename):
        r"""
"'%(barename)s' is not recognized as an internal or external\r\n
command, operable program or batch file.\r\n"

in Russian:
"""
        return '"%(barename)s" \xad\xa5 \xef\xa2\xab\xef\xa5\xe2\xe1\xef \xa2\xad\xe3\xe2\xe0\xa5\xad\xad\xa5\xa9 \xa8\xab\xa8 \xa2\xad\xa5\xe8\xad\xa5\xa9\r\n\xaa\xae\xac\xa0\xad\xa4\xae\xa9, \xa8\xe1\xaf\xae\xab\xad\xef\xa5\xac\xae\xa9 \xaf\xe0\xae\xa3\xe0\xa0\xac\xac\xae\xa9 \xa8\xab\xa8 \xaf\xa0\xaa\xa5\xe2\xad\xeb\xac \xe4\xa0\xa9\xab\xae\xac.\r\n' % dict(barename=barename)

    @staticmethod
    def is_executable_win_destructive(path):
        # assume path <-> barename that is false in general
        barename = os.path.splitext(os.path.basename(path))[0]
        p = Popen(barename, stdout=PIPE, stderr=PIPE, shell=True)
        stdout, stderr = p.communicate()
        return p.poll() != 1 or stdout != '' or stderr != error_message(barename)

def is_executable_win(path):
    """Based on:
http://timgolden.me.uk/python/win32_how_do_i/tell-if-a-file-is-executable.html

Known bugs: treat some "*~" files as executable, e.g. some "*.bat~" files
"""
    try:
        _, executable = FindExecutable(path)
        return bool(samefile(GetLongPathName(executable), path))
    except error:
        return None # not an exe or a document with assoc.

def is_executable_posix(path):
    """Whether the file is executable.

Based on which.py from stdlib
"""
    #XXX it ignores effective uid, guid?
    try: st = os.stat(path)
    except os.error:
        return None

    isregfile = S_ISREG(st[ST_MODE])
    isexemode = (S_IMODE(st[ST_MODE]) & 0111)
    return bool(isregfile and isexemode)

try:
    #XXX replace with ctypes?
    from win32api import FindExecutable, GetLongPathName, error
    is_executable = is_executable_win
except ImportError, e:
    warn_import("is_executable: fall back on posix variant", e)
    is_executable = is_executable_posix

try: samefile = os.path.samefile
except AttributeError, e:
    warn_import("samefile: fallback to samefile_win", e)
    try:
        import win32file
        samefile = samefile_win.samefile_win
    except ImportError, e:
        warn_import("samefile: fallback to generic", e)
        samefile = samefile_generic

def main():
    parser = OptionParser(usage="""
%prog [options] PATTERN
%prog [options] -e PATTERN""", description=__doc__)
    opt = parser.add_option
    opt("-e", "--regex", metavar="PATTERN",
        help="use PATTERN as a regular expression")
    opt("--ignore-case", action="store_true", default=True,
        help="""[default] ignore case when --regex is present; for \
non-regex PATTERN both FILENAME and PATTERN are first \
case-normalized if the operating system requires it otherwise \
unchanged.""")
    opt("--no-ignore-case", dest="ignore_case", action="store_false")
    opt("--use-pathext", action="store_true", default=True,
        help="[default] whether to use %PATHEXT% environment variable")
    opt("--no-use-pathext", dest="use_pathext", action="store_false")
    opt("--show-non-executable", action="store_true", default=False,
        help="show non executable files")

    (options, args) = parser.parse_args()

    if len(args) != 1 and not options.regex:
       parser.error("incorrect number of arguments")
    if not options.regex:
       pattern = args[0]
    del args

    if options.regex:
       filepred = re.compile(options.regex, options.ignore_case and re.I).search
    else:
       fnmatch_ = fnmatch.fnmatch if options.ignore_case else fnmatch.fnmatchcase
       for file_pattern_symbol in "*?":
           if file_pattern_symbol in pattern:
               break
       else: # match in any place if no explicit file pattern symbols supplied
           pattern = "*" + pattern + "*"
       filepred = lambda fn: fnmatch_(fn, pattern)

    if not options.regex and options.ignore_case:
       filter_files = lambda files: fnmatch.filter(files, pattern)
    else:
       filter_files = lambda files: itertools.ifilter(filepred, files)

    if options.use_pathext:
       pathexts = frozenset(map(str.upper,
            os.environ.get('PATHEXT', '').split(os.pathsep)))

    seen = set()
    for dirpath in os.environ.get('PATH', '').split(os.pathsep):
        if os.path.isdir(dirpath): # assume no expansion needed
           # visit "each" directory only once
           # it is unaware of subst drives, junction points, symlinks, etc
           rp = canonical_path(dirpath)
           if rp in seen: continue
           seen.add(rp); del rp

           for filename in filter_files(os.listdir(dirpath)):
               path = os.path.join(dirpath, filename)
               isexe = is_executable(path)

               if isexe == False and is_executable == is_executable_win:
                  # path is a document with associated program
                  # check whether it is a script (.pl, .rb, .py, etc)
                  if not isexe and options.use_pathext:
                     ext = os.path.splitext(path)[1]
                     isexe = ext.upper() in pathexts

               if isexe:
                  print path
               elif options.show_non_executable:
                  print "non-executable:", path

if __name__=="__main__":
   main() 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-15T07:25:12.413

解析PE格式。

[http://code.google.com/p/pefile/](http://code.google.com/p/pefile/)

除了使用 python 实际尝试运行程序之外，这可能是您将获得的最佳解决方案。

编辑：我看到您还想要具有关联的文件。这将需要在我没有相关信息的注册表中进行处理。

Edit2：我还看到您区分 .doc 和 .py。这是一个相当随意的区分，必须使用手动规则指定，因为对于 Windows，它们都是程序读取的文件扩展名。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-03-15T08:00:04.233

你的问题无法回答。Windows 无法区分与脚本语言相关联的文件与其他一些任意程序之间的区别。对于 Windows，.PY 文件只是一个由 py​​thon.exe 打开的文档。

# asp.net - 服务器向 Web 客户端发送消息的最佳方式是什么？

> ID：646958
> 
> 赞同：3
> 
> 时间：2009-03-14T23:50:04.363
> 
> 标签：asp.net, javascript, asp.net-mvc, ajax, web-applications

*文章的链接也将不胜感激——我不知道要搜索的术语。*

我希望了解 Web 应用程序如何允许服务器到客户端的通信。我知道网络不是为此而设计的，并且它一直是一个障碍，我只是想知道这是什么状态，以及最佳实践是什么。

另一种方法是通过 ajax 进行持续或偶尔轮询，但是 Web 服务器是否可以维护与 Web 客户端的有状态连接？

**编辑：**问这个问题的另一种方法是 StackOverflow 如何告诉页面有新帖子可供它在顶部显示那个小栏？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-03-15T00:01:03.417

StackOverflow 轮询服务器以检查是否有更多数据。

您正在寻找的是[Comet](http://en.wikipedia.org/wiki/Comet_(programming))。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T00:16:43.880

要从浏览器获得真正的双向通信，您需要使用 Silverlight、Flash 等插件技术。这些插件可以创建可以与服务器套接字建立双向持久连接的 TCP 连接。请注意，您无法真正与 HTTP 服务器建立 TCP 连接，因此您必须创建一个额外的服务器代理来与浏览器进行通信。

基本上，它与 Stackoverflow、Gmail 等 AJAX 站点使用的部署模型完全不同。它们都依赖于浏览器以设定的时间间隔轮询服务器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-15T00:01:39.483

Web 浏览器确实没有设置为处理这种通信。通信是单向通道，Web 服务器在端口（通常为 80 或 443）上侦听以获取要发送给它的信息。

我刚刚阅读了关于彗星的链接，这是一种有趣的方法，但必须记住的是，它在技术上仍然是由客户端打开的。服务器正在发送代码以供其执行，但浏览器最终处于控制之中，并确定服务器何时与其通信。

对于今天的网络浏览器，如果没有浏览器的帮助，服务器在技术上永远无法执行发送给它的消息。从技术上讲，您可以通过在客户端计算机上执行一些 Active X 控件来解决这个问题……但我还没有尝试过。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-15T00:13:22.873

你不能，HTTP 是无状态的。很久以前，Netscape 实现了 HTTP Push，但并不成功。

我会使用网络服务或类似服务进行轮询；没有插件（即 Flash、Java、Silverlight）在其沙箱中有权使用原始套接字，因此尝试以这种方式实现它会浪费时间。

# .net - 是否有将二进制数据打包成 UTF-16 字符串的标准技术？

> ID：646974
> 
> 赞同：11
> 
> 时间：2009-03-15T00:01:47.470
> 
> 标签：.net, unicode, encoding, binary, utf-16

（在 .NET 中）我将任意二进制数据存储在*byte[]*（例如图像）中。现在，我需要将该数据存储在一个*字符串*中（遗留 API 的“注释”字段）。是否有将这种二进制数据**打包**成*字符串*的标准技术？通过“打包”，我的意思是对于任何相当大的随机数据集，*bytes.Length/2与**packed.Length 大致*相同；因为两个字节或多或少是一个字符。

两个“明显”的答案不符合所有标准：

```
string base64 = System.Convert.ToBase64String(bytes) 
```

没有非常有效地使用*字符串*，因为它只使用大约 60,000 个可用字符中的 64 个字符（我的存储是*System.String*）。一起去

```
string utf16 = System.Text.Encoding.Unicode.GetString(bytes) 
```

更好地利用了*string*，但它不适用于包含无效 Unicode 字符的数据（比如不匹配的代理对）。 [这篇 MSDN 文章](http://msdn.microsoft.com/en-us/library/ms172827.aspx)展示了这种精确（差）的技术。

让我们看一个简单的例子：

```
byte[] bytes = new byte[] { 0x41, 0x00, 0x31, 0x00};
string utf16 = System.Text.Encoding.Unicode.GetString(bytes);
byte[] utf16_bytes = System.Text.Encoding.Unicode.GetBytes(utf16); 
```

在这种情况下*bytes*和*utf16_bytes*是相同的，因为原始*字节*是 UTF-16 字符串。使用 base64 编码执行相同的过程会得到 16 个成员的*base64_bytes*数组。

现在，使用无效的 UTF-16 数据重复该过程：

```
byte[] bytes = new byte[] { 0x41, 0x00, 0x00, 0xD8}; 
```

您会发现*utf16_bytes*与原始数据不匹配。

我编写了在无效 Unicode 字符之前使用 U+FFFD 作为转义的代码；它有效，但我想知道是否有比我自己制作的更标准的技术。更不用说，我不喜欢将*DecoderFallbackException**作为*检测无效字符的方式。

我想您可以将其称为“基本 BMP”或“基本 UTF-16”编码（使用 Unicode 基本多语言平面中的所有字符）。是的，理想情况下，我会遵循[Shawn Steele 的建议](http://blogs.msdn.com/shawnste/archive/2005/09/26/474105.aspx)并传递*byte[]*。

* * *

~~我将接受 Peter Housel 的建议作为“正确”答案，因为他是唯一一个接近建议“标准技术”的人。~~

* * *

编辑[base16k](http://www.unicode.org/mail-arch/unicode-ml/y2004-m05/1671.html) [看起来](http://sites.google.com/site/markusicu/unicode/base16k)更好。Jim Beveridge 有一个[实现](http://qualapps.blogspot.com/2011/11/base64-for-unicode-utf16.html)。

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-03-19T14:43:18.687

我可以建议你*使用*base64 吗？它可能不是最有效的存储方式，但它确实有它的好处：

1.  您对代码的担忧已经结束。
2.  如果有的话，您与其他播放器的兼容性问题最少。
3.  如果在转换、导出、导入、备份、恢复等过程中将编码字符串视为 ASCII，您也不会有任何问题。
4.  如果您曾经摔死或最终在公共汽车或其他东西下，任何接触到评论字段的程序员都会立即知道它是base64，而不是假设它都是加密的或其他东西。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-27T15:08:18.357

阅读您的问题后，我偶然发现了[Base16k 。](https://sites.google.com/site/markusicu/unicode/base16k)严格来说不是一个标准，但它似乎运行良好并且很容易在 C# 中实现。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-03-21T13:16:40.943

**首先，请记住 Unicode 并不意味着 16 位。**System.String 在内部使用 UTF-16 的事实既不存在也不存在。Unicode 字符是抽象的——它们只能通过编码获得位表示。

你说“我的存储是一个 System.String”——如果是这样，你就不能谈论位和字节，只能谈论 Unicode 字符。System.String 当然有它自己的内部编码，但（理论上）可能会有所不同。

顺便说一句，如果您认为 System.String 的内部表示对于 Base64 编码的数据来说内存效率太低，您为什么不担心拉丁/西方字符串呢？

如果要将二进制数据存储在 System.String 中，则需要位和字符集合之间的映射。

选项 A：有一个预制的 Base64 编码形状。正如您所指出的，这对每个字符编码六位数据。

选项 B：如果您想为每个字符打包更多位，那么您需要创建一个包含 128、256、512 等 Unicode 字符的数组（或编码），并为每个字符打包 7、8、9 等位数据特点。这些字符必须是真正的 Unicode 字符。

为了简单地回答您的问题，是的，有一个标准，它是 Base64 编码。

这是一个真正的问题吗？您是否有性能数据来支持您不使用 Base64 的想法？

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-03-15T03:30:51.557

您可以将二进制数据视为[UTF-8b](https://web.archive.org/web/20090830064219/http://mail.nl.linux.org/linux-utf8/2000-07/msg00040.html)。UTF-8b 编码假定字节是 UTF-8 多字节序列，但是对于不是的东西有一个备用编码。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-02-24T16:03:31.790

这是 Jim Beveridge 的 C++[实现](http://qualapps.blogspot.com/2011/11/base64-for-unicode-utf16.html)的 C# 版本：

```
using System;
using System.Collections.Generic;
using System.Text;
using System.Text.RegularExpressions;
using System.Linq;

//
// Base16k.cpp : Variant of base64 used to efficiently encode  binary into Unicode UTF16 strings. Based on work by
// Markus Scherer at https://sites.google.com/site/markusicu/unicode/base16k
//
// This code is hereby placed in the Public Domain.
// Jim Beveridge, November 29, 2011.
//
// C# port of http://qualapps.blogspot.com/2011/11/base64-for-unicode-utf16.html
// This code is hereby placed in the Public Domain.
// J. Daniel Smith, February 23, 2015
//

namespace JDanielSmith
{
    public static partial class Convert
    {
        /// <summary>
        /// Encode a binary array into a Base16k string for Unicode.
        /// </summary>
        public static string ToBase16kString(byte[] inArray)
        {
            int len = inArray.Length;

            var sb = new StringBuilder(len*6/5);
            sb.Append(len);

            int code = 0;

            for (int i=0; i<len; ++i)
            {
                byte byteValue = inArray[i];
                switch (i%7)
                {
                case 0:
                    code = byteValue<<6;
                    break;

                case 1:
                    code |= byteValue>>2;
                    code += 0x5000;
                    sb.Append(System.Convert.ToChar(code));
                    code = (byteValue&3)<<12;
                    break;

                case 2:
                    code |= byteValue<<4;
                    break;

                case 3:
                    code |= byteValue>>4;
                    code+=0x5000;
                    sb.Append(System.Convert.ToChar(code));
                    code = (byteValue&0xf)<<10;
                    break;

                case 4:
                    code |= byteValue<<2;
                    break;

                case 5:
                    code|=byteValue>>6;
                    code+=0x5000;
                    sb.Append(System.Convert.ToChar(code));
                    code=(byteValue&0x3f)<<8;
                    break;

                case 6:
                    code|=byteValue;
                    code+=0x5000;
                    sb.Append(System.Convert.ToChar(code));
                    code=0;
                    break;
                }
            }

            // emit a character for remaining bits
            if (len%7 != 0) {
                code += 0x5000;
                sb.Append(System.Convert.ToChar(code));
            }

            return sb.ToString();
        }

        /// <summary>
        ///  Decode a Base16k string for Unicode into a binary array.
        /// </summary>
        public static byte[] FromBase16kString(string s)
        {
            // read the length
            var r = new Regex(@"^\d+", RegexOptions.None, matchTimeout: TimeSpan.FromMilliseconds(100));
            Match m = r.Match(s);
            if (!m.Success)
                return null;

            int length;
            if (!Int32.TryParse(m.Value, out length))
                return null;

            var buf = new List<byte>(length);

            int pos=0;  // position in s
            while ((pos < s.Length) && (s[pos] >= '0' && s[pos] <= '9'))
                ++pos;

            // decode characters to bytes
            int i = 0;    // byte position modulo 7 (0..6 wrapping around)
            int code=0;
            byte byteValue=0;

            while (length-- > 0)
            {
                if (((1<<i)&0x2b)!=0)
                {
                    // fetch another Han character at i=0, 1, 3, 5
                    if(pos >= s.Length)
                    {
                        // Too few Han characters representing binary data.
                        System.Diagnostics.Debug.Assert(pos < s.Length);
                        return null;
                    }

                    code=s[pos++]-0x5000;
                }

                switch (i%7)
                {
                case 0:
                    byteValue = System.Convert.ToByte(code>>6);
                    buf.Add(byteValue);
                    byteValue = System.Convert.ToByte((code&0x3f)<<2);
                    break;

                case 1:
                    byteValue |= System.Convert.ToByte(code>>12);
                    buf.Add(byteValue);
                    break;

                case 2:
                    byteValue = System.Convert.ToByte((code>>4)&0xff);
                    buf.Add(byteValue);
                    byteValue = System.Convert.ToByte((code&0xf)<<4);
                    break;

                case 3:
                    byteValue |= System.Convert.ToByte(code>>10);
                    buf.Add(byteValue);
                    break;

                case 4:
                    byteValue = System.Convert.ToByte((code>>2)&0xff);
                    buf.Add(byteValue);
                    byteValue = System.Convert.ToByte((code&3)<<6);
                    break;

                case 5:
                    byteValue |= System.Convert.ToByte(code>>8);
                    buf.Add(byteValue);
                    break;

                case 6:
                    byteValue = System.Convert.ToByte(code&0xff);
                    buf.Add(byteValue);
                    break;
                }

                // advance to the next byte position
                if(++i==7)
                    i=0;
            }

            return buf.ToArray();
        }
    }
}

namespace Base16kCS
{
    class Program
    {
        static void Main(string[] args)
        {
            var drand = new Random();

            // Create 500 different binary objects, then encode and decode them.
            // The first 16 objects will have length 0,1,2 ... 16 to test boundary conditions.
            for (int loop = 0; loop < 500; ++loop)
            {
                Console.WriteLine("{0}", loop);

                int dw = drand.Next(128000);
                var org = new List<byte>(dw);
                for (int i = 0; i < dw; ++i)
                    org.Add(Convert.ToByte(drand.Next(256)));

                if (loop < 16)
                    org = org.Take(loop).ToList();

                string wstr = JDanielSmith.Convert.ToBase16kString(org.ToArray());

                byte[] bin = JDanielSmith.Convert.FromBase16kString(wstr);

                System.Diagnostics.Debug.Assert(org.SequenceEqual(bin));
            }
        }
    }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-19T10:04:33.270

我用直接 char 数组愚弄了，你的一个失败案例适用于我的实现。代码已经过很好的测试：所以先做你的测试。

您可以通过使用不安全的代码来加快速度。但我确信 UnicodeEncoding 一样慢（如果不是更慢的话）。

```
/// <summary>
/// Represents an encoding that packs bytes tightly into a string.
/// </summary>
public class ByteEncoding : Encoding
{
    /// <summary>
    /// Gets the Byte Encoding instance.
    /// </summary>
    public static readonly Encoding Encoding = new ByteEncoding();

    private ByteEncoding()
    {
    }

    public override int GetBytes(char[] chars, int charIndex, int charCount, byte[] bytes, int byteIndex)
    {
        for (int i = 0; i < chars.Length; i++)
        {
            // Work out some indicies.
            int j = i * 2;
            int k = byteIndex + j;

            // Get the bytes.
            byte[] packedBytes = BitConverter.GetBytes((short) chars[charIndex + i]);

            // Unpack them.
            bytes[k] = packedBytes[0];
            bytes[k + 1] = packedBytes[1];
        }

        return chars.Length * 2;
    }

    public override int GetChars(byte[] bytes, int byteIndex, int byteCount, char[] chars, int charIndex)
    {
        for (int i = 0; i < byteCount; i += 2)
        {
            // Work out some indicies.
            int j = i / 2;
            int k = byteIndex + i;

            // Make sure we don't read too many bytes.
            byte byteB = 0;
            if (i + 1 < byteCount)
            {
                byteB = bytes[k + 1];
            }

            // Add it to the array.
            chars[charIndex + j] = (char) BitConverter.ToInt16(new byte[] { bytes[k], byteB }, 0);
        }

        return (byteCount / 2) + (byteCount % 2); // Round up.
    }

    public override int GetByteCount(char[] chars, int index, int count)
    {
        return count * 2;
    }

    public override int GetCharCount(byte[] bytes, int index, int count)
    {
        return (count / 2) + (count % 2);
    }

    public override int GetMaxByteCount(int charCount)
    {
        return charCount * 2;
    }

    public override int GetMaxCharCount(int byteCount)
    {
        return (byteCount / 2) + (byteCount % 2);
    }
} 
```

这是一些测试代码：

```
 static void Main(string[] args)
    {
        byte[] original = new byte[256];

        // Note that we can't tell on the decode side how
        // long the array was if the original length is
        // an odd number. This will result in an
        // inconclusive result.
        for (int i = 0; i < original.Length; i++)
            original[i] = (byte) Math.Abs(i - 1);

        string packed = ByteEncoding.Encoding.GetString(original);
        byte[] unpacked = ByteEncoding.Encoding.GetBytes(packed);

        bool pass = true;

        if (original.Length != unpacked.Length)
        {
            Console.WriteLine("Inconclusive: Lengths differ.");
            pass = false;
        }

        int min = Math.Min(original.Length, unpacked.Length);
        for (int i = 0; i < min; i++)
        {
            if (original[i] != unpacked[i])
            {
                Console.WriteLine("Fail: Invalid at a position {0}.", i);
                pass = false;
            }
        }

        Console.WriteLine(pass ? "All Passed" : "Failure Present");

        Console.ReadLine();
    } 
```

该测试有效，但您将不得不使用您的 API 函数对其进行测试。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-19T10:26:13.030

还有另一种解决此限制的方法：尽管我不确定它的效果如何。

首先，您需要弄清楚 API 调用期望的字符串类型以及该字符串的结构是什么。如果我举一个简单的例子，让我们考虑 .Net 字符串：

*   Int32 _长度；
*   字节[]_数据；
*   字节_终止符= 0；

为您的 API 调用添加重载，因此：

```
[DllImport("legacy.dll")]
private static extern void MyLegacyFunction(byte[] data);

[DllImport("legacy.dll")]
private static extern void MyLegacyFunction(string comment); 
```

然后，当您需要调用字节版本时，您可以执行以下操作：

```
 public static void TheLegacyWisperer(byte[] data)
    {
        byte[] realData = new byte[data.Length + 4 /* _length */ + 1 /* _terminator */ ];
        byte[] lengthBytes = BitConverter.GetBytes(data.Length);
        Array.Copy(lengthBytes, realData, 4);
        Array.Copy(data, 0, realData, 4, data.Length);
        // realData[end] is equal to 0 in any case.
        MyLegacyFunction(realData);
    } 
```

# java - 是否可以等待不在线程中的方法在 Java 中完成？

> ID：646990
> 
> 赞同：1
> 
> 时间：2009-03-15T00:11:12.317
> 
> 标签：java, multithreading, concurrency

我有一个进行一些计算的对象，然后对于每个迭代我想绘制发生了什么。当绘图正在进行时，我希望它等待。

这就是我所做的，基本上：

```
synchronized public void compute()
{
    other.mark(variable);
    try
    {
        wait();
    }
    catch(InterruptedException e)
    {
    }
} 
```

在其他类中，我有

```
synchronized public void mark(int var)
{
    //change some stuff
    repaint();
    notify();
} 
```

发生的事情是 compute() 永远等待。我认为这会起作用，因为编译器没有给出错误。两个类都没有实现 Runnable 或扩展 Thread，所以也许这就是问题所在？我不确定，因为我认为如果这些对象不能使用这些方法，我会收到警告。

我认为这可能是关于程序本身逻辑的错误，但简而言之，这就是我所拥有的。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-16T09:35:09.707

您的问题表明您希望执行一些操作，以在完成时更新 GUI 状态或通知 GUI 其进度。这就是[SwingWorker](http://java.sun.com/javase/6/docs/api/javax/swing/SwingWorker.html)的设计目的。对于这两种情况，链接的 javadoc 都有一些示例。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T00:24:42.707

这根本不像你想象的那样工作。来自`wait()`方法的Javadoc（强调我的）：

> 使当前线程等待，直到**另一个线程**为此对象调用 notify() 方法或 notifyAll() 方法。

您的程序中显然没有其他线程可以唤醒睡眠`compute()`方法。

要解决您的特定问题，您要么必须有两个线程，要么将`compute()`方法实现为可恢复的，在伪 Java 中是这样的：

```
ComputeStatus status = new ComputeStatus();
do {
    compute(status);  // compute iteration
    mark(status);     // draw iteration
    status.next();    // next iteration
} while (!status.isFinished()); 
```

这里`ComputeStatus`保存当前的计算状态，并且`comupte()`知道如何从该状态继续计算。无论您是在主循环中`compute()`还是在主循环中更改状态，都取决于您和您要解决的问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-03-15T02:08:49.053

repaint 方法注册了绘制组件的需要，但它实际上并不绘制它，但是 Java 将在下次有机会时重新绘制对象。如果您正在尝试制作类似动画的东西，那么等待重绘完成是没有意义的。相反，我建议您使用计时器。现在您有 2 个计时器选项。如果您正在更新时间不必精确的东西，那么 javax.swing.Timer 通常就是您要寻找的东西。你像这样使用它：

```
//imports (before class definition)
import javax.swing.Timer;
import java.awt.event.ActionListener;
import java.awt.event.ActionEvent;

//put this code where you want to start doing calculations
int delay = 1000; //milliseconds
ActionListener taskPerformer = new ActionListener() {
    public void actionPerformed(ActionEvent evt) {
        //update your calculations
        model.calculate();
        //tell Java to call paint at the next chance it gets
        viewer.repaint();
    }
};
new Timer(delay, taskPerformer).start(); 
```

在上面的代码中，模型是您要对其执行计算的对象，查看器是基于模型绘制的对象。

摆动计时器的计时不是很精确，这对很多事情都很好，但有时您需要更准确地安排代码。在这种情况下，您可能需要使用 java.util.Timer 类。你像这样使用它：

```
//imports (before class definition)
import java.util.Timer;
import java.util.TimerTask;

//inner class that does the calculations
public class CalculateTask extends TimerTask {
    public void run() {
        model.calculate();
        view.repaint();
    }
}

//put this code where you want to start doing calculations
int delay = 0;//time before running CalculateTask.run()
int repeat = 1000; //time between each subsequent rums of CalculateTask.run()
boolean isDaemon = true;//allow java to shutdown without stopping timer
Timer timer = new Timer(isDaemon);
timer.scheduleAtFixedRate(new CalculateTask(), delay, repeat); 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-15T00:22:18.357

Object.wait() 和 Object.notify() 仅供线程使用。在您显示的代码中，方法 mark(int var) 直到完成才会返回，无需等待。此外，仅在多线程程序中才需要同步方法。

您的代码应该是：

```
public void compute()
{
    other.mark(variable);
}

public void mark(int var)
{
    //change some stuff
    repaint();
} 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-03-15T00:26:45.117

由于您的程序是一个 GUI 程序（我是通过`repaint()`调用收集的），因此它本质上是多线程的，即使您不知道它也是如此。（如果不是，它将表现得非常糟糕。）

如果您不使用线程，则不能使用等待/通知或任何其他类型的同步，因为没有两个线程要同步。但是您不必在 GUI 程序中显式地使用 Threads 以最终使用 Threads。

请注意，如果您使用依赖于线程的方法但实际上并没有以任何方式使用线程，Java 编译器不会警告您。

您有以下问题之一：

1）您正在使用线程而不知道它，并且您正在使用两个不同的监视器对象。因此，当您调用 时`notify()`，它会通知该对象的监视器，但不会通知您正在调用的第一个对象`wait()`。有许多可能的解决方案。最简单的方法之一是使用 JDK 5 并发实用程序来执行此操作，它比内置的基本监视器等待/通知方法要好得多。或者，

2）您在单个线程中运行并且等待/通知不好。在单线程程序中等待另一个线程通知是没有意义的——没有其他线程可以这样做。

假设您实际上使用了多个线程，使用 Java 5 及更高版本解决此问题的一个好方法是在包含和简化一点的类中使用[semaphore](http://java.sun.com/j2se/1.5.0/docs/api/java/util/concurrent/Semaphore.html)，也许是通过：`mark()`

```
private final Semaphore sem = new Semaphore(1);

public void mark(int var) {
  sem.acquire();
  //change some stuff
  repaint();
  sem.release();
}

waitForSemaphore() {
  sem.acquire();
} 
```

然后在`compute`，`waitForSemaphore()`当你想等待被通知的时候打电话`mark()`。因为`mark()`已经获取了信号量，所以你必须等待`mark()`释放信号量，然后计算才能通过调用`waitForSemaphore()`.

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-03-16T14:45:30.803

wait() 永远不会被释放，因为您没有在同一个对象上同步。您的计算方法位于不同的对象中，因此通知调用未与您的 mark() 方法共享相同的监视器。

等待/通知机制用于共享监视器，也就是说，它们必须共享相同的线程锁定机制。

wait() 将“唤醒”的唯一方法是，如果另一个线程从同一对象的同步块内调用 notify()。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-03-16T19:08:58.237

不幸的是 wait() 永远不会停止等待。主要原因，看看你把你的通知（）。它被同一个线程调用，并且无法唤醒自己。

这很简单。当您到达 wait() 命令时，mark(int var) 已经完成运行，因此 mark(int var) 中的 notify() 无法唤醒它。

# iphone - 带有导航控制器的多个层次结构级别

> ID：646995
> 
> 赞同：1
> 
> 时间：2009-03-15T00:14:12.183
> 
> 标签：iphone, cocoa-touch, uikit

我正在尝试让多个层次结构与导航控制器一起使用。我有 3 个层次结构，我可以向下移动层次结构，但我只能返回一个层次而不是两个层次，回到起始视图。

我首先为 View #1 创建一个导航控制器，然后将下一个视图 View #2 推送到它上面。然后我在 didSelectRowAtIndexPath 中将导航控制器添加到窗口的子视图中。单击 View #1 中的表行，将我带到下一个层次结构级别 View #2。

下一个层级视图也是一个表视图。这是我认为问题发生的地方。我创建了另一个导航控制器，并在视图 #2 的视图控制器中的 didSelectRowAtIndexPath 中将视图 #3 推送到它上面。单击视图#2 中的表行将我带到视图#3。但是当我使用后退按钮返回视图#2 时，我会返回一个空视图，而不是真正的视图#2。

1.  我是否只需要一个导航控制器来处理 3 个层次结构而不是两个导航控制器？

2.  如果 #1 是，那么我如何将导航控制器传递给查看 #2 的控制器，以便我可以将视图 #3 推送到导航控制器上？

3.  还是我需要将所有三个视图都推送到视图#1 中的导航控制器上？

4.  或者...？

提前致谢，

吉姆

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-03-16T14:02:54.540

Apple Developer 站点中的 DrillDownSave 示例代码：

[https://developer.apple.com/library/ios/#samplecode/DrillDownSave/](https://developer.apple.com/library/ios/#samplecode/DrillDownSave/)

使用导航控制器使用三个层次结构级别的视图完全符合我的要求。感谢您的回答。

吉姆

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-03-15T09:10:58.617

`UIViewController`旨在与`UINavigationController`. 推送新视图时，a`UINavigationController`将注入对自身的引用以及`UINavigationItem`包含有关导航的元数据（后退按钮及其后面的视图标题等...）。

通常，您希望`UINavigationController`使用“NIB 名称”字段来指定“根视图控制器”（即出现的第一个视图不应该有后退按钮）来初始化您的 Interface Builder。代码中的等价物大致如下所示：

```
 UIViewController *rootController = [[UIViewController alloc] initWithNibName:@"RootController"];
UINavigationController *navCtl = [[UINavigationController alloc] initWithRootController:rootcontroller]; 
```

然后，当您需要推送一个新的视图控制器时（可能在您`didSelectRowAtIndexPath`的 rootController 中的委托方法中）

```
 SecondViewController *secondViewController = [[SecondViewController alloc] initWithNibName:@"SecondViewController"];
[self.navigationController pushViewController:secondViewController];
[secondViewController release]; 
```

请注意，您不必创建`self.navigationController`属性，它已经在其中定义，`UIViewController`并将根据导航的当前状态注入正确的引用。它像魔术一样工作！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-03-15T01:16:09.117

通常，您的所有层次结构都应包含在单个 UINavigationController 中。我不确定是否甚至支持嵌套它们。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-03-23T22:56:08.320

如果后续视图是同一控制器的附加实例，您将如何执行此操作，那只不过是表视图的真正层次结构......该示例显示了硬编码的视图......但它们基本上做同样的事情。我的 OO 背景说，如果我分配/初始化控制器的新实例，我不应该能够推动它，然后在弹出（后退按钮）时恢复其状态吗？这似乎对我不起作用。控制器（UITableViewController）的每个实例都有自己的数组实例作为其数据......

# embedded - 什么是绘制亚毫秒时间线的好工具？

> ID：646997
> 
> 赞同：4
> 
> 时间：2009-03-15T00:16:23.833
> 
> 标签：embedded, visualization, real-time, timeline, graphing

我正在尝试为我的实时嵌入式代码生成时间线。我需要显示所有中断、触发它们的原因、服务时间、执行时间等。我已经完成了分析并拥有原始数据，现在我需要一种以图形方式显示时间线的方法，以进行缩放。

我一直在寻找一个好的工具，但还没有想出任何好的工具。我发现的所有东西都在几天和几年的时间线上工作。我想要一个显示单个 2 毫秒周期的图表。现在我正在使用 Visio，但我一直在想一定有更简单的东西。有任何想法吗？

我希望能产生这样的东西：![](https://www.keil.com/support/man/docs/mcbstr7/mcbstr7_interrupt_func1.png).
不幸的是，我的更复杂，但这是一般的想法。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-03-15T00:43:56.340

所以在那个尺度上，你的横坐标将是一个纯数字（例如，从开始时间开始的微秒，或类似的）。用于绘制此类图形的绘图工具很常见。

我建议使用[gnuplot](http://www.gnuplot.info/)之类的东西，但我怀疑问题比你的总结中明显的要多。

啊，这张图让一切都清楚多了。如果 gnuplot 不适合你，我会提供另一个建议（或者至少告诉你我会做什么）：从头开始编写。

具体来说，我可能会用脚本语言（ruby、python 等）组合一些东西来读取数据并生成看起来像我想要的方式的[pic代码。](http://www.ece.uwaterloo.ca/~aplevich/dpic/)如果你决定走那条路，这里是[图片基础的概述](http://www.onlamp.com/pub/a/onlamp/2007/06/21/in-praise-of-pic.html?page=1)和[手册](http://www.kohala.com/start/troff/cstr116.ps)。如果你深入研究，你应该在一小时内得到一些合理的东西，在一周内你会得到比任何现成的 GUI 应用程序更适合你的东西。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-03-15T09:54:22.710

我对你有感觉。在我的系统中，我们有一个 1.1 毫秒的周期和 4 个不同组件的 13 个测量点。我怀疑你面临着类似的复杂性。

坏消息是我知道没有现成的解决方案。然而 MarkusQ 是正确的，你可以使用（滥用？）标准图形包来完成你需要的。但是您需要花费一些时间来根据自己的喜好自定义输出。

我们通过[RPy R/Python 桥](http://rpy.sourceforge.net/)广泛使用由 Python 代码驱动的[R 项目](http://www.r-project.org/)来生成我们的绘图。这种设置对我们来说非常有效，并使我们能够自动化该过程。Python 用于从实时系统中获取和清理数据，R 进行绘图。

R 的图形自定义支持非常广泛，允许您控制情节、位置、大小等的各个方面。起初可能会令人生畏，但有一本优秀的书[R Graphics](https://rads.stackoverflow.com/amzn/click/com/158488486X)可以帮助您使用[包含本书所有示例的配套网站](http://www.stat.auckland.ac.nz/~paul/RGraphics/rgraphics.html).

无论您选择什么，请确保能够通过脚本实现自动化。如果没有灵活的工具，实时系统生成的数据量太大了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-27T04:58:50.723

gtkwave 可以使用**`