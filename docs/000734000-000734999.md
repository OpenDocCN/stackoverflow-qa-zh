# StackOverflow 问答 000734000-000734999

# javascript - Javascript 语法问题——找到它

> ID：734002
> 
> 赞同：1
> 
> 时间：2009-04-09T12:30:35.633
> 
> 标签：javascript, html

我有以下 javascript 片段，由于缺少而无法加载；before 声明之前的 url withing searchUserInfo .. 我已经双重和三重检查了这段代码

```
function submitUserInfo(username) {

    url = "edit_user.php?cmd=submitinfo&username="+username+"&firstname="+document.userForm.firstname.value+"&lastname="+document.userForm.lastname.value+"&flaggedauctions="+document.userForm.flaggedauctions.value+"&lastauction="+document.userForm.lastauction.value+"&street1="+document.userForm.street1.value+"&city1="+document.userForm.city1.value+"&postcode1="+document.userForm.postcode1.value+"&street2="+document.userForm.street2.value+"&city2="+document.userForm.city2.value+"&postcode2="+document.userForm.postcode2.value+"&phone="+document.userForm.phone.value+"&mobilephone="+document.userForm.mobilephone.value+"&fax="+document.userForm.fax.value+"&email="+document.userForm.email.value+"&website="+document.userForm.website.value+"&bank="+document.userForm.bank.value+"&banknumber="+document.userForm.banknumber.value+"&accountnumber="+document.userForm.accountnumber.value+"&comments="+document.userForm.comments.value;

    var xmlHttp=GetXmlHttpObject(); //you have this defined elsewhere

    //if(xmlHttp.responseText == 'true') {

        xmlHttp.open("GET",url,true);

        xmlHttp.send(null);

        updateByUser(username);

    //}

}

function searchUserInfo() {

    url = "get_results.php?cmd=SearchUserData&searchstring="+document.searchForm.search.value"&subcat="+subcat;

    var xmlHttp=GetXmlHttpObject(); //you have this defined elsewhere

    //if(xmlHttp.responseText == 'true') {

        xmlHttp.open("GET",url,true);

        xmlHttp.send(null);

        update('Layer3', url);

    //}

} 
```

我用过 jslint，看不到什么，如果有什么改变。没有错误。我正在使用萤火虫，但它对我没有帮助。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T12:34:32.100

你忘了一个`+`接线员。这：

```
url = "get_results.php?cmd=SearchUserData&searchstring="+document.searchForm.search.value"&subcat="+subcat; 
```

应该：

```
url = "get_results.php?cmd=SearchUserData&searchstring="+document.searchForm.search.value+"&subcat="+subcat; 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T12:32:58.763

你在这里缺少一个 +

```
value"&subcat="+subcat 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T12:34:18.980

searchUserInfo，第一行，需要加一个“+”

> ...document.searchForm.search.value **+** "&subcat="...

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T12:52:27.983

双，三，四检查是好的，但还不够。一次注释掉代码行以查明错误所在的行。

记住这句话“计算机永远不会出错”并习惯它。

例如

第一次测试：

```
/*
function blah(do){
   line 1
   line 2
   line 3
}
*/ 
```

然后：

```
function blah(do){
/*
   line 1
   line 2
   line 3
*/
} 
```

然后：

```
function blah(do){

   line 1
   /*
   line 2
   line 3
   */

} 
```

直到错误出现

# c# - 是否可以通过 .net 应用程序以编程方式关闭“远程 PC”？

> ID：734005
> 
> 赞同：2
> 
> 时间：2009-04-09T12:31:45.490
> 
> 标签：c#, remoting

我想知道，是否可以通过 .net 应用程序以编程方式关闭远程 PC？

如果是，怎么可能？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T12:37:38.223

请参阅[此知识库文章](http://support.microsoft.com/kb/317371)

例如：

```
System.Diagnostics.Process proc = new System.Diagnostics.Process();
proc.EnableRaisingEvents=false;
proc.StartInfo.FileName = "shutdown.exe";
proc.StartInfo.Arguments = @"\\computername /t:120 ""The computer is shutting down"" /y /c";
proc.Start(); 
```

上面的示例使用以下开关（摘自链接文章）

*   \\computername：使用此开关指定要关闭的远程计算机。如果省略此参数，则使用本地计算机名称。

*   /t:xx：使用此开关指定关闭计算机的时间（以秒为单位）。默认值为 20 秒。

*   “计算机正在关闭”：使用此开关指定关闭过程中的消息。消息可以包含的最大字符数为 127。

*   /y：使用此开关强制对来自计算机的所有查询回答“是”。

*   /c：使用此开关退出所有正在运行的程序。如果您使用此开关，Windows 会强制所有正在运行的程序退出。保存任何可能已更改的数据的选项将被忽略。这可能导致之前未保存数据的任何程序中的数据丢失。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T12:43:57.863

WMI 将用于此任务。Win32_OperatingSystem 类有一个名为 Win32Shutdown 的方法。这可用于关闭远程计算机。

Win32Shutdown： http: [//msdn.microsoft.com/en-us/library/aa394058 (VS.85).aspx](http://msdn.microsoft.com/en-us/library/aa394058(VS.85).aspx)

以下博客条目有一个完整的 C# 程序，演示了如何使用 WMI 关闭计算机。在页面上搜索Win32Shutdown（关于下第2篇）

[http://urkec.mojblog.rs/](http://urkec.mojblog.rs/)

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T12:35:28.773

为此，您可以使用程序中的 WMI。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-06-15T20:18:31.090

我有一个与用户一起运行的本地应用程序，而不是有一个指示该用户无法关闭电脑的组策略。然后我使用你的代码，但是当我通过用户和密码要求模拟我的应用程序时。我收到下一个错误 System.Management.ManagementException：无法将用户的凭据用于本地连接

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-09T12:53:41.040

我的方式：

```
Process.Start("ShutDown", "/s"); 
```

当然是从远程 ASP.NET 页面触发的。

# winforms - 防止从只读 RichTextBox 闪烁光标 (IBeam)

> ID：734032
> 
> 赞同：10
> 
> 时间：2009-04-09T12:38:34.773
> 
> 标签：winforms, richtextbox

`RichRextBox`无论如何，当文本框获得焦点时，是否可以防止只读光标（IBeam）闪烁？

我试图阻止`WM_SETFOCUS`来自 的消息，`WndProc`但这会导致表单挂起。

```
if( m.Msg == 0x0007 ) return; 
```

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-09T12:52:48.513

您需要使用 Win32 API。以下是您可以在 VB 中执行的操作：

```
'API declares
Private Declare Function HideCaret Lib "user32" _
(ByVal hwnd As IntPtr) As Integer
Private Declare Function ShowCaret Lib "user32" _
(ByVal hwnd As IntPtr) As Integer
'hide the caret in myTextBox
Call HideCaret(myTextBox.Handle)
'show the caret back..
Call ShowCaret(myTextBox.Handle) 
```

在 C# 中

```
 [DllImport("user32.dll", EntryPoint = "ShowCaret")]
 public static extern long ShowCaret(IntPtr hwnd);
 [DllImport("user32.dll", EntryPoint = "HideCaret")]
 public static extern long HideCaret(IntPtr hwnd); 
```

然后打电话给

```
 HideCaret(richtextbox.Handle) 
```

当你想隐藏它时。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2011-09-09T12:22:33.420

只是说 Anirudh Goel 的答案不起作用（至少在 C# 中）。克拉仍然在闪烁：/

我在以下位置找到了解决方案：[http ://www.experts-exchange.com/Programming/Languages/C_Sharp/Q_21896403.html](http://www.experts-exchange.com/Programming/Languages/C_Sharp/Q_21896403.html)

他的类总是隐藏插入符号，这是一个改进的类，因此您可以选择隐藏或不隐藏插入符号。

**如果你想隐藏不要忘记将 MustHideCaret 设置为 true**

```
using System;
using System.ComponentModel;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace Lm
{
    public class RichTextBoxEx : RichTextBox
    {
        private readonly object mustHideCaretLocker = new object();

        private bool mustHideCaret;

        [DefaultValue(false)]
        public bool MustHideCaret
        {
            get
            {
                lock (this.mustHideCaretLocker)
                    return this.mustHideCaret;
            }
            set
            {
                TabStop = false;
                if (value)
                    SetHideCaret();
                else
                    SetShowCaret();
            }
        }

        [DllImport("user32.dll")]
        private static extern int HideCaret(IntPtr hwnd);
        [DllImport("user32.dll", EntryPoint = "ShowCaret")]
        public static extern long ShowCaret(IntPtr hwnd);

        public RichTextBoxEx()
        {
        }

        private void SetHideCaret()
        {
            MouseDown += new MouseEventHandler(ReadOnlyRichTextBox_Mouse);
            MouseUp += new MouseEventHandler(ReadOnlyRichTextBox_Mouse);
            Resize += new EventHandler(ReadOnlyRichTextBox_Resize);
            HideCaret(Handle);
            lock (this.mustHideCaretLocker)
                this.mustHideCaret = true;
        }

        private void SetShowCaret()
        {
            try
            {
                MouseDown -= new MouseEventHandler(ReadOnlyRichTextBox_Mouse);
                MouseUp -= new MouseEventHandler(ReadOnlyRichTextBox_Mouse);
                Resize -= new EventHandler(ReadOnlyRichTextBox_Resize);
            }
            catch
            {
            }
            ShowCaret(Handle);
            lock (this.mustHideCaretLocker)
                this.mustHideCaret = false;
        }

        protected override void OnGotFocus(EventArgs e)
        {
            if (MustHideCaret)
                HideCaret(Handle);
        }

        protected override void OnEnter(EventArgs e)
        {
            if (MustHideCaret)
                HideCaret(Handle);
        }

        private void ReadOnlyRichTextBox_Mouse(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            HideCaret(Handle);
        }

        private void ReadOnlyRichTextBox_Resize(object sender, System.EventArgs e)
        {
            HideCaret(Handle);
        }
    }
} 
```

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2014-01-15T13:03:28.390

更简单的方法：将此事件附加到 RichTextBox 的 Enter 事件中：

```
 private void Control_Enter(object sender, EventArgs e) {
    ActiveControl = null;
  } 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-05-21T21:13:21.587

对我来说，Pedro77 的解决方案也不起作用......我已经将该类修改为：

```
using System;
using System.ComponentModel;
using System.Runtime.InteropServices;
using System.Windows.Forms;

namespace Lm
{
    public class RichTextBoxEx : RichTextBox
    {
        private readonly object mustHideCaretLocker = new object();

        private bool mustHideCaret;

        [DefaultValue(false)]
        public bool MustHideCaret
        {
            get
            {
                lock (this.mustHideCaretLocker)
                    return this.mustHideCaret;
            }
            set
            {
                TabStop = false;
                if (value)
                    SetHideCaret();
                else
                    SetShowCaret();
            }
        }

        [DllImport("user32.dll")]
        private static extern int HideCaret(IntPtr hwnd);
        [DllImport("user32.dll", EntryPoint = "ShowCaret")]
        public static extern long ShowCaret(IntPtr hwnd);

        public RichTextBoxEx()
        {
        }

        private void SetHideCaret()
        {
            MouseDown += new MouseEventHandler(ReadOnlyRichTextBox_Mouse);
            MouseUp += new MouseEventHandler(ReadOnlyRichTextBox_Mouse);
            Resize += new EventHandler(ReadOnlyRichTextBox_Resize);
            HideCaret(Handle);
            lock (this.mustHideCaretLocker)
                this.mustHideCaret = true;
        }

        private void SetShowCaret()
        {
            try
            {
                MouseDown -= new MouseEventHandler(ReadOnlyRichTextBox_Mouse);
                MouseUp -= new MouseEventHandler(ReadOnlyRichTextBox_Mouse);
                Resize -= new EventHandler(ReadOnlyRichTextBox_Resize);
            }
            catch
            {
            }
            ShowCaret(Handle);
            lock (this.mustHideCaretLocker)
                this.mustHideCaret = false;
        }

        protected override void OnGotFocus(EventArgs e)
        {
            if (MustHideCaret)
            {
                HideCaret(Handle);
                this.Parent.Focus();//here we select parent control in my case it is panel
            }
        }

        protected override void OnEnter(EventArgs e)
        {
            if (MustHideCaret)
                HideCaret(Handle);
        }

        private void ReadOnlyRichTextBox_Mouse(object sender, System.Windows.Forms.MouseEventArgs e)
        {
            HideCaret(Handle);
        }

        private void ReadOnlyRichTextBox_Resize(object sender, System.EventArgs e)
        {
            HideCaret(Handle);
        }
    }
} 
```

然后将我的 RichTextBoxEx 放入（内部）面板控件...修复了鼠标单击时闪烁的插入符号...

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-04-14T04:47:42.603

经过多次试验和错误，我找到了简单的解决方案。

在表单的“加载”子例程中，添加以下行：

```
AddFocusHandlers(Me) 
```

然后将以下内容添加到表单代码的底部。在“HideCaret”例程中规定您希望“阻止进入”的控件（我列出了属于我的表单的三个文本框）：

```
Private Sub AddFocusHandlers(ByVal parentCtr As Control)
    Dim ctr As Control
    For Each ctr In parentCtr.Controls
        AddHandler ctr.LostFocus, AddressOf meLostFocus
        AddFocusHandlers(ctr)
    Next
End Sub

Private Sub meLostFocus(ByVal sender As Object, ByVal e As System.EventArgs)
    LastFocused = DirectCast(sender, Control)
End Sub

'This routine will activate each time any of the listed controls are entered.
Private Sub HideCaret(sender As Object, e As EventArgs) _
               Handles tbDate.Enter, tbAttachments.Enter, tbTemplate.Enter
    LastFocused.Select()
End Sub 
```

最后放置在表单代码的顶部（在类名和第一个子或函数之间：

```
 Private LastFocused As Control  'Control which previously had focus 
```

Then when the user clicks on any control shown in the list of controls in the "HideCaret" routine, the cursor simply stays in the previously selected control. Isn't VB.Net wonderful? You can achieve almost anything you thought not possible.

# jasper-reports - 在 Jasper 报告查看器中突出显示一些文本

> ID：734038
> 
> 赞同：1
> 
> 时间：2009-04-09T12:41:45.513
> 
> 标签：jasper-reports, reportviewer, highlighting

我想突出显示我为显示而生成的报告的某些部分。
我不想更改报告定义。我想在运行时突出显示输出。

但是我使用的 JRViewer 并没有太多的 API。
并且在显示之前使用 setForecolor/setBackcolor 操作 JasperPrint 对象，似乎并没有改变输出。

有任何想法吗？还是我必须重载/重新实现查看器？因为它是开源的，所以问题不大，但我想防止重新发明轮子。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-14T10:03:55.513

看起来我必须自己回答我的问题......再次。

我重载了 JRViewer 类（实际上复制了 JRViewer 的代码，因为没有一个有趣的面板可以访问）并添加了一些突出显示方法来执行以下操作：

基于模板的 JasperPrint 数据使用 - 顾名思义 - 模板。这意味着文本对象没有自己的样式，它们使用模板的样式。
这就是为什么 setForecolor 没有做任何事情的原因 - JRTemplatePrintElement 实现是空的。

但是，如果我在文本模板上设置突出显示，我最终会得到一整列突出显示的文本，因为它们共享模板实例。
相反，我创建了一个新模板作为带有突出显示的原始模板的副本，并在突出显示的打印元素中使用它。顺便说一句，那些 jasper 元素真的可以使用 clone() 方法。
感觉像一个黑客，但我没有看到更好的方法。

更新：
但是，这对基于文件的（虚拟化）报告有一个令人讨厌的副作用。这些显然保存了您在浏览页面时对元素所做的任何更改。但是，如果同时查看器导致虚拟器丢弃您引用的元素（例如通过翻页），您的进一步更改将不会被保存......

所以这让我重新考虑，现在我只是在 Jasper 的 PageRenderer 绘制的 Graphics 对象上绘制我的突出显示。
更简单，更清洁。仅突出显示背景不会以这种方式工作。

# javascript - 如何在div内容之上添加段落

> ID：734041
> 
> 赞同：29
> 
> 时间：2009-04-09T12:42:59.193
> 
> 标签：javascript, jquery, dom

如何在 div 容器的顶部添加多个段落标签、新标签。

```
<div id="pcontainer">
  <p>recently added on top every time on click event recently added paragarph on top</p>
  <p>added before recent</p>
</div> 
```

我正在使用追加，但每次单击按钮时，它都会添加到底部，我需要将其添加到所有段落的顶部，请帮助。

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-04-09T12:46:28.483

您可以使用[prepend](http://docs.jquery.com/Manipulation/prepend)在容器顶部添加段落：

```
// HTML: <div><p>Lorem ipsum</p></div>
$('div').prepend('<p>Bla bla bla'); 
```

**更新**：关于您对如何在段落中淡入淡出的评论 - 使用[fadeIn](http://docs.jquery.com/Effects/fadeIn#speedcallback)：

```
$("#pcontainer").prepend($('<p>This paragraph was added by jQuery.</p>').fadeIn('slow')); 
```

一个工作演示：http: [//jsbin.com/uneso](http://jsbin.com/uneso)

* * *

## 回答 #2

> 赞同：47
> 
> 时间：2013-09-13T16:10:27.630

没有jQuery的更优雅的方式：

```
var container = document.getElementById('pcontainer');
container.insertBefore(document.createElement("p"), container.firstChild); 
```

这假设容器中已经有一个元素。

* * *

## 回答 #3

> 赞同：15
> 
> 时间：2009-07-09T17:36:47.360

非 jQuery 用户的示例：

```
document.getElementById('pcontainer').innerHTML = '<p>new paragraph</p>' + document.getElementById('pcontainer').innerHTML; 
```

虽然可能没有那么短和漂亮:)

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-09T12:45:52.463

尝试使用[前置](http://docs.jquery.com/Manipulation)而不是附加。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2012-04-14T19:45:27.583

这是一种没有jQuery的方法：

```
function prependParagraphs()
{
     var choosenDiv = document.getElementById("pcontainer");
     for(var i=0; i<5; i++)
     {
         var newP = document.createElement("p");
         var text = document.createTextNode("new paragraph number: " + i);
         newP.appendChild(text);
         choosenDiv.insertBefore(newP, choosenDiv.firstChild);
     }
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T12:51:27.143

特定于您的 HTML，它将是：

```
$("#pcontainer").prepend('<p>here's a new paragraph!</p>'); 
```

# php - 替换本地链接，保留外部链接

> ID：734047
> 
> 赞同：0
> 
> 时间：2009-04-09T12:44:29.860
> 
> 标签：php, regex, parsing, negative-lookahead

我有一个 API 调用，它本质上返回托管 wiki 应用程序页面的 HTML。然后我根据我的网站风格指南做一些 substr、str_replace 和 preg_replace 功夫来格式化它。

我做了一组调用来格式化我的左侧导航（将指向 pageX 的链接更改为我的 wikiParse?page=pageX 类型的东西）。我可以在左侧导航中安全地执行此操作。然而，在正文中，我不能安全地假设链接是指向内部页面的链接。它很可能是指向外部资源的链接。所以我需要做一个 preg_replace 匹配 href= 后面没有 http://。

这是我的尝试：

```
$result = preg_replace('href\=\"(?!http\:\/\/)','href="bla?id=',$result); 
```

这似乎去除了页面上的全部内容。有人看到我在哪里滑倒了吗？我不认为我离得太远了，只是看不到下一步该去哪里。

干杯

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T12:52:22.960

这些[`preg_*`函数](http://docs.php.net/manual/en/ref.pcre.php)需要与Perl[兼容的正则表达式 (PCRE)](http://docs.php.net/manual/en/regexp.reference.php)。与普通正则表达式的结构区别在于，表达式本身被包装在分隔符中，将表达式与可能的[修饰符](http://docs.php.net/manual/en/reference.pcre.pattern.modifiers.php)分开。经典的分隔符是，`/`但 PHP 允许除反斜杠字符之外的任何其他非字母数字字符。另请参阅[PHP 中的 PCRE 简介](http://docs.php.net/manual/en/intro.pcre.php)。

所以试试这个：

```
$result = preg_replace('/href="(?!http:\/\/)/', 'href="bla?id=', $result); 
```

这`href="(?!http://)`是正则表达式。但是当我们`/`用作分隔符时，`/`正则表达式内部的出现必须使用反斜杠进行转义。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T12:53:14.643

您的正则表达式缺少开始和结束分隔符（默认为“/”）；

```
$result = preg_replace('/href\=\"(?!http\:\/\/)/','href="bla?id=',$result); 
```

# nhibernate - 将类映射为nhibernate中的组件时如何进行构造函数注入？

> ID：734054
> 
> 赞同：1
> 
> 时间：2009-04-09T12:46:56.827
> 
> 标签：nhibernate

对于 nhibernate 中的映射组件，在 hmb 文件中是否有一种方法可以指示要使用的重载构造函数而不是默认构造函数。

在下面的映射中，nHibernate 在从数据库读取数据时将使用 MyClass 的默认构造函数——我想知道我们是否可以指示 nhibernate 使用重载的构造函数来代替？

```
 <component name="MyProperty" class="MyClass" >
  <property name="Member1" column="member_1" />
  <property name="Member2" column="member_2" />
  <property name="Member3" column="member_3" />
</component > 
```

**编辑 #1** 或者，nHibernate 是否允许将静态值映射到属性而不是列？如下所示：

```
 <component name="MyProperty" class="MyClass" >
  <property name="Member1" column="member_1" />
  <property name="Member2" column="member_2" />
  <property name="Member3" **value="555"** />
</component > 
```

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T12:50:26.180

您可以使用`select new` [HQL 构造](http://www.hibernate.org/hib_docs/nhibernate/html/queryhql.html)在 NHibernate 中使用带有参数的构造函数的唯一标准方法：

```
select new Family(mother, mate, offspr)
from Eg.DomesticCat as mother
    join mother.Mate as mate
    left join mother.Kittens as offspr 
```

否则，它将无参数构造函数用于所有目的。我不确定这是否可以通过破解 NHibernate 内部（`IClassPersister`，`IInterceptor`等）来改变

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T12:51:31.623

NHibernate 将始终使用默认构造函数来实例化该类型的对象，（除非您想创建某种 DTO 并通过 HQL 检索它）然后它将使用属性（或支持字段，如果指定）来填充对象。

如果您有一个不想公开默认（无参数）构造函数的类型，但您想确保只能通过特定构造函数实例化该类型，那么我总是这样做：

```
public class MyClass
{
    private MyClass()
    {
       // Default constructor has been made private, so it is not usable
       // by user code, but NHibernate requires a default constructor
       // (it may be private)
    }

    public MyClass( int member1, int member2, string member3 )
    {
    }
} 
```

# wpf - ListItem 鼠标进入消息框

> ID：734055
> 
> 赞同：0
> 
> 时间：2009-04-09T12:47:48.353
> 
> 标签：wpf, events, triggers, mouse, enter

我在我的 XAML 中使用事件触发器，我在 ListItem 上设置了以下样式。我想要的是在鼠标进入列表项时在消息框中显示 ListItem 的内容。

```
 <Style.Triggers>
            <EventTrigger RoutedEvent="Mouse.MouseEnter">

            </EventTrigger>
        </Style.Triggers> 
```

我想知道当鼠标进入列表项时是否可以触发代码。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T12:57:07.613

```
<ListBox>
    <ListBox.ItemContainerStyle>
        <Style TargetType="ListBoxItem">
            <EventSetter Event="MouseEnter" Handler="_listBoxItem_MouseEnter"/>
        </Style>
    </ListBox.ItemContainerStyle>
</ListBox> 
```

# windows - 什么是最好的安装程序？

> ID：734057
> 
> 赞同：23
> 
> 时间：2009-04-09T12:48:11.693
> 
> 标签：windows, installation

投票：与 .NET 3.5 SP1 Windows 应用程序一起使用的最佳且易于使用的安装程序是什么？

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-09T12:59:27.313

### My vote is for:

[**Nullsoft Scriptable Install System**](http://nsis.sourceforge.net/) - it's popular, easy to use and FREE

> **Nullsoft Scriptable Install System** (NSIS) is a script-driven Windows installation system with minimal overhead backed by Nullsoft, the creators of Winamp. NSIS has risen to popularity as a widely used alternative to commercial and proprietary products like InstallShield. - [Wikipedia](http://en.wikipedia.org/wiki/Nullsoft_Scriptable_Install_System)

There is rich plugins directory for NSIS, where you can find for example a plugin for installing windows services.

[http://nsis.sourceforge.net/Category:Plugins](http://nsis.sourceforge.net/Category:Plugins)

### Commercial alternatives:

*   [InstallShield](http://www.installshield.com/) - probably the most popular one and the most expensive option
*   [Wise](http://www.wise.com) - also very popular
*   [Advanced Installer](http://www.advancedinstaller.com/) - new and nice, not that popular yet, but trending

### Other:

*   [WiX](http://wix.sourceforge.net/) - could be very good if you can spent some time on the learning curve. It is used by many Microsoft products.
*   [Inno Setup](http://jrsoftware.org/isinfo.php)

### [List of Installation Software](http://en.wikipedia.org/wiki/List_of_installation_software) at Wikipedia

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-09T13:09:43.467

My personal preference is [Advanced Installer](http://www.advancedinstaller.com/), it has a nice GUI for creation and editing of projects which are XML files so fits into source control easily.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-09T13:02:50.377

[Innosetup](http://jrsoftware.org/isinfo.php) is the fastest one I've used to make setup files quickly and easily (out of Nullsoft and VS), providing you get the designer that is a [separate download](http://www.istool.org/).

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T13:15:33.170

You could use ClickOnce deployment, if your environment allows you to do so. (If it's convenient).

Actually any answer could apply to your question here, choosing the "right" installer never possible for "a windows application".

*   How many different machines are your going to install to?
*   How large is your application?
*   Does it have many dependencies? (Databases etc.)
*   What is the "level" of the users who are going to install your app? Are they system administrators who install apps for a living, or are they joe-random "Hey lets click install because it looks cool" types.

just my 2ct.

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-09T12:52:26.457

过去我使用过[InstallShield](http://www.acresso.com/products/is/installshield-overview.htm)和[Wise](http://www.symantec.com/business/wise-installation-studio)。我不会说使用它们中的任何一个是一种乐趣，但它们可以为大型 Windows 应用程序完成工作。

在这两者中，我通常更喜欢InstallShield。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-09T12:53:01.103

我非常喜欢[WiX](http://wix.sourceforge.net/)，据说它是 MS 内部用于 Office 的安装程序。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-09T12:56:23.450

我在我的第一个也是最后一个 Windows 项目中使用了[NSIS](http://nsis.sourceforge.net/)，并且对它非常满意。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-09T12:50:44.837

Visual Studio 2008 的开箱即用。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T13:12:23.553

Nullsoft Scriptable Install System anytime... simply because of it's ease of use and more than that, it's free!

# jquery - 使用 JQuery 淡化 span 标签的背景颜色

> ID：734068
> 
> 赞同：25
> 
> 时间：2009-04-09T12:50:54.620
> 
> 标签：jquery, jquery-animate, fade, background-color, html

我正在尝试使用 JQuery 淡化 span 标签的背景颜色，以强调何时发生更改。我在想代码在点击处理程序中会像下面这样，但我似乎无法让它工作。你能告诉我我哪里出错了吗？谢谢拉斯。

```
$("span").fadeOut("slow").css("background-color").val("FFFF99"); 
```

* * *

这样更好，但现在它会同时淡化 span 标签的背景颜色和 span 标签的文本值。我试图只是淡化背景颜色并让文本可见。可以这样做吗？

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-09T13:04:45.520

可以使用[彩色动画插件](http://plugins.jquery.com/project/color)来完成。然后你会做类似的事情

```
$('span').animate({'backgroundColor' : '#ffff99'}); 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-09T13:05:24.227

哦，我不知道你想褪色！好的，所以你需要查看 jQuery 颜色插件：

~~[http://plugins.jquery.com/project/color](http://plugins.jquery.com/project/color)~~

[https://github.com/jquery/jquery-color/](https://github.com/jquery/jquery-color/)

这是 jQuery 文档网站的另一个有用部分：

[http://docs.jquery.com/Release:jQuery_1.2/Effects#Color_Animations](http://docs.jquery.com/Release:jQuery_1.2/Effects#Color_Animations)

我从来没有真正这样做过，所以我不会尝试给你代码，但我想颜色插件会给你你需要的功能。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2012-02-17T19:14:26.183

如果使用纯 jQ 淡出背景在没有插件的情况下不起作用，那么有一个聪明的（虽然不是逐渐增强的）方法可以用 CSS3 来做到这一点。

此函数将通过 CSS 将“transition”属性应用于给定元素。接下来，该元素被赋予 CSS 淡入的背景颜色。

如果您希望它像波浪一样（“看这里！”），延迟半秒后，一个函数会排队以将元素变回白色。

本质上 jQ 只是将元素闪烁到一种颜色，然后再变回白色。CSS3 负责褪色。

```
//reusable function to make fading colored hints
function fadeHint(divId,color) {
    switch(color) {
        case "green":
        color = "#17A255";
        break;

        case "blue":
        color = "#1DA4ED";
        break;

        default: //if "grey" or some misspelled name (error safe).
        color = "#ACACAC";
        break;
    }

    //(This example comes from a project which used three main site colors: 
    //Green, Blue, and Grey)

    $(divId).css("-webkit-transition","all 0.6s ease")
    .css("backgroundColor","white")
    .css("-moz-transition","all 0.6s ease")
    .css("-o-transition","all 0.6s ease")
    .css("-ms-transition","all 0.6s ease")
    /* Avoiding having to use a jQ plugin. */

    .css("backgroundColor",color).delay(200).queue(function() {
        $(this).css("backgroundColor","white"); 
        $(this).dequeue(); //Prevents box from holding color with no fadeOut on second click.
    }); 
    //three distinct colors of green, grey, and blue will be set here.
} 
```

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-05-24T18:50:24.753

这可以通过 jQuery（或任何库）和一个简单的 CSS hack 来完成：

```
#wrapping-div {
 position:relative;
 z-index:1;
}
#fadeout-div {
 height:100%;
 width:100%;
 background-color: #ffd700;
 position:absolute;
 top:0;
 left:0;
 z-index:-1
} 
```

HTML：

```
<div id="wrapping-div">
  <p>This is some text</p>
  <p>This is some text</p>
  <p>This is some text</p>
  <div id="fadeout-div"></div>
</div> 
```

然后，您需要做的就是：

```
$("#fadeout-div").fadeOut(1100); 
```

十分简单！看看这个：http: [//jsfiddle.net/matthewbj/jcSYp/](http://jsfiddle.net/matthewbj/jcSYp/)

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2010-08-13T13:05:37.987

试试这个

```
 $(this).animate({backgroundColor:"green"},  100);
    $(this).animate({backgroundColor:"white" },  1000); 
```

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2012-04-23T15:14:56.180

可能会迟到回答，但可以直接解决您的答案。

```
 $('span').css('background-color','#<from color>').animate({backgroundColor: '#<to color>'},{duration:4000}); 
```

简单的。不需要 jqueryUI 插件、3rd 方工具等等。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2014-02-07T08:56:10.530

我不想使用插件所以为了淡入淡出背景，我将这个包含在 div 类中，以使其背景淡出

```
.div-to-fade {
    -webkit-transition:background 1s;
    -moz-transition:background 1s;
    -o-transition:background 1s;
    transition:background 1s
} 
```

按钮单击中的jquery

```
$('.div-to-fade').css('background', 'rgb(70, 70, 70)');
setTimeout(function(){$('.div-to-fade').css('background', '')}, 1000); 
```

这会将背景着色为浅灰色，然后淡化回原始颜色，我希望这会有所帮助

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-12-21T17:23:27.950

这就是你在 span 标签上调用 fadeOut 的原因。要获得背景淡入淡出动画，您应该使用：

```
$('span').animate({'backgroundColor' : '#ffff99'}); 
```

正如mishac所指出的。另一种方式可能是这样的：

```
$("span").fadeTo(0.5,"slow", function () {
  $(this).css("background-color", "#FFFF99");
  $(this).fadeIn("slow");
}); 
```

上面的代码将淡出到整个 span 标签的 50%，然后改变背景和淡入。这不是你要找的，而是创建一个不依赖于其他 jquery 插件的欺骗动画；）

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2011-01-07T08:24:59.777

最新的 jQuery UI 业务允许您对大多数对象进行背景颜色转换。见这里：http: [//jqueryui.com/demos/animate/](http://jqueryui.com/demos/animate/)

至于那个要求在翻转时使背景透明以显示图像的人，像人们用来切换导航图像的普通 jQuery 图像翻转那样构建它不是更简单吗？

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-09T12:52:29.030

你会想要使用这个语法：

```
$("span").fadeOut("slow").css("background-color", "#FFFF99"); 
```

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2012-09-10T10:50:30.183

这就是我通过悬停为我的列表修复它的方式：

CSS：

```
ul {background-color:#f3f3f3;}
li:hover {background-color: #e7e7e7} 
```

jQuery：

```
$(document).ready(function () {
    $('li').on('touchstart', function () { $(this).css('background-color', ''); });
    $('li').on('touchend', function () { $(this).css('background-color', 'inherit'); });
}); 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-03-23T12:37:27.067

另一个**没有**jQuery UI的解决方案[https://stackoverflow.com/a/22590958/781695](https://stackoverflow.com/a/22590958/781695)

```
//Color row background in HSL space (easier to manipulate fading)
$('span').css('backgroundColor','hsl(0,100%,50%');

var d = 1000;
for(var i=50; i<=100; i=i+0.1){ //i represents the lightness
    d  += 10;
    (function(ii,dd){
        setTimeout(function(){
            $('span').css('backgroundColor','hsl(0,100%,'+ii+'%)'); 
        }, dd);    
    })(i,d);
} 
```

演示：http: [//jsfiddle.net/5NB3s/3/](http://jsfiddle.net/5NB3s/3/)

# c - 在为定制平台构建 newlib 时指示 libgloss 机器

> ID：734070
> 
> 赞同：1
> 
> 时间：2009-04-09T12:51:05.727
> 
> 标签：c, embedded, cross-compiling, newlib

我正在为没有操作系统的定制 PowerPC 平台编译 newlib。在网上阅读信息我意识到我需要在`<newplatform>`libgloss 的子目录中实现存根函数。

我的困惑是当我编译 newlib 时将如何处理它。`--target`它是配置例如参数的最后一部分`powerpc-ibm-<newplatform>`吗？

如果是这种情况，那么我想我应该`--target`在编译 binutils 和 gcc 时使用相同的？

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T22:55:07.557

我自己也移植了 newlib 和 GCC。而且我记得我不需要做太多事情来使 newlib 工作（移植 GCC、gas 和 libbfd 是大部分工作）。

只需要调整一些关于浮点数的文件，关闭一些 POSIX/SomeOtherStandard 标志，使其不使用一些更复杂的功能，并为`longjmp`/编写支持代码`setjmp`，将寄存器状态加载和存储到跳转缓冲区中。但是您当然必须告诉它使用的目标，`--target`以便它使用正确的机器子目录等等。我记得我必须添加小代码以`configure.sub`使其了解我的目标并打印出完整的配置三元组（cpu-manufacturer-os 或类似）。刚刚发现我必须编辑一个名为`configure.host`too 的文件，该文件为您的目标设置了一些选项（例如，操作系统是否处理上升的信号`raise`，或者 newlib 本身是否应该模拟处理）。

我以 Anthony Green 的[这篇博客](http://spindazzle.org/ggx/)为指导，他在其中描述了 GCC、newlib 和 binutils 的移植。我认为当您必须自己做时，这是一个很好的来源。总之读起来很有趣。总共花了 2 个月时间编译和运行一些有趣的 C 程序，这些程序只需要独立的 C（带有写入模拟器终端的虚拟读/写函数）。

所以我认为工作量肯定是可控的。让我几乎抓狂的是`libgloss`的构建脚本。我当然迷失在那些 autoconf 魔法中 :) 无论如何，祝你好运！:)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T22:31:12.543

查看[移植 Newlib](http://wiki.osdev.org/Porting_Newlib)。

引用：

> 我决定在尝试将 newlib 移植到我自己的操作系统的艰难的一周之后，我将编写一个教程，概述移植 newlib 的要求以及如何实际去做。我假设您已经可以从某个地方加载二进制文件并且这些二进制文件是编译的 C 代码。我还假设您已经设置了系统调用接口。为什么要等？让我们开始吧！

# vb.net - 等待安装项目在 .NET 中关闭

> ID：734072
> 
> 赞同：3
> 
> 时间：2009-04-09T12:51:15.943
> 
> 标签：vb.net, installation

我的最终结果是我想在第一个安装项目关闭后启动另一个安装项目。问题是由于 setup.exe 只是 MSI 包的包装，当 setup.exe 完成而不是 foo.msi 时，WaitForExit 正在退出。

```
Using Process As New System.Diagnostics.Process
      Process.StartInfo.FileName = "setup.exe"
      Process.StartInfo.WindowStyle = ProcessWindowStyle.Normal
      Process.WaitForExit()
End Using

'Launch next setup here 
```

有什么方法可以做到这一点？该设置是一个 Visual Studio 设置项目。

我相信我需要尝试一些专业的安装程序产品，看看是否能得到我想要的结果。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T12:55:16.217

尝试

```
msiexec 
```

运行您的 msi 文件而不是*setup.exe* ( [http://technet.microsoft.com/en-us/library/cc759262.aspx](http://technet.microsoft.com/en-us/library/cc759262.aspx) )

这是一个详细的示例：[从 C# 启动 MSIExec.exe](http://murrayon.net/2008/06/launching-msiexecexe-from-c.html)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T16:37:24.320

我们公司决定使用 InstallAware Studio Edition。它能够在安装完全完成后运行设置以及我可能需要的所有其他内容。

# c++ - C ++中的朋友类/函数

> ID：734075
> 
> 赞同：1
> 
> 时间：2009-04-09T12:51:39.127
> 
> 标签：c++, friend

> **可能重复：**
> [什么时候应该在 C++ 中使用“朋友”？](https://stackoverflow.com/questions/17434/when-should-you-use-friend-in-c)

我看到很多人推荐一个函数/类成为 SO 中另一个类的朋友，尽管还有其他选择。在 C++ 中不应该少用朋友吗？我觉得在决定使用朋友功能之前必须考虑其他选项。欢迎提出意见/建议。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T13:02:08.430

有人说`friend`是违反封装。在我看来，恰恰相反。如果没有`friend`，我们最终会得到：

*   巨大的单体类，做了很多他们不应该做的事情，只是为了避免让外部类访问它们的内部
*   封装不良的类：为了分离关注点并编写具有一个且只有一个职责的类，我们需要提供对相关类集所需的内部数据的公共访问。

`friend`是克服这个问题的好方法，因为它可以让您自由地在几个类中分离职责，同时让您可以将实现细节的访问限制为需要它们的少数函数或类型。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T13:00:06.093

我同意。应谨慎使用friend关键字。

如果您有一组可以交互的类，当您想将这些类的干净 api 公开给用户时，它可能会很有用，但是当这些类可以使用更丰富的接口相互交互时。

例如：

```
class Folder
{
public:
  int GetFileCount();
private:
  void IncrementFileCount();  // users of this class have no right to use this

  friend class File;
};

class File
{
public:
  File(string name, Folder& containingFolder)
  {
     containingFolder.IncrementFileCount(); // except for indirectly when they create a file
  }
}; 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T12:58:02.230

如果没有具体的例子，这很难决定。虽然`friend`不是绝对必要的，但它确实有它的用途。如果，正如您所声称的，有更好的选择，那么显然使用*它们*，通过“更好”这个词的简单定义。或者，也许哪个解决方案更好的决定毕竟不是那么干净利落。

就个人而言，我更喜欢尽可能避免它，但我更喜欢使用它而不是方法重复：例如，我不喜欢编写一个`print`方法只是为了避免制作`operator <<`a `friend`，因为我没有看到重复方法的好处。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T13:02:12.407

对于所有认为朋友违反封装的人，这里是 Bjarne Stroustup 不得不[说](http://www.stroustrup.com/bs_faq2.html#friend)的。

但我个人不使用朋友，除非它是不可避免的。像实现 [迭代器](http://sourcemaking.com/design_patterns/iterator/cpp/1)模式这样的场景没有其他选择。

如果使用得当，朋友就是朋友，否则他就是敌人！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-08-24T13:11:29.747

在您想要调用需要访问您的类成员的第 3 方库函数的情况下，Friend 函数是有利的，例如：

```
`class A {
private:
     int x,y;
     double result;
public:
     friend void *power(void *x);
}` 
```

您现在可以使用这个友元函数调用在 math.h 中找到的 pow 函数。您的幂函数现在可以定义为：

```
 void *power(void *X)
{
     A *a;
     a = static_cast< A *> (X);
     a->result = pow(a->x,a->y);
     return NULL;
} 
```

虽然调用 pow 函数有更简单的方法。这个例子只是为了说明友元函数在调用库函数中的重要性。希望它是有用的。

# math - 如何用贝塞尔曲线最好地逼近几何弧？

> ID：734076
> 
> 赞同：38
> 
> 时间：2009-04-09T12:51:58.767
> 
> 标签：math, graphics, geometry

在使用贝塞尔曲线近似绘制 2D 圆弧时，考虑到圆的中心点、起点和终点角度以及半径，如何计算两个控制点？

* * *

## 回答 #1

> 赞同：26
> 
> 时间：2017-06-29T15:29:30.130

这是一个有 8 年历史的问题，但我最近一直在努力解决这个问题，所以我想我会分享我的想法。我花了很多时间尝试使用[本文](http://itc.ktu.lt/index.php/ITC/article/view/11812/6479)中的解决方案 (9)，但无法从中获得任何合理的数字，直到我进行了一些谷歌搜索并了解到，显然，方程式中有一些拼写错误。[根据这篇博](https://hansmuller-flex.blogspot.com/2011/10/more-about-approximating-circular-arcs.html?showComment=1498749617507#c2109832351939371205)文中列出的更正，给定弧的起点和终点（分别为 [x1, y1] 和 [x4, y4]）和圆的中心（[xc, yc]），可以导出三次贝塞尔曲线（[x2, y2] 和 [x3, y3]）的控制点，如下所示：

```
ax = x1 - xc
ay = y1 - yc
bx = x4 - xc
by = y4 - yc
q1 = ax * ax + ay * ay
q2 = q1 + ax * bx + ay * by
k2 = (4/3) * (sqrt(2 * q1 * q2) - q2) / (ax * by - ay * bx)

x2 = xc + ax - k2 * ay
y2 = yc + ay + k2 * ax
x3 = xc + bx + k2 * by                                 
y3 = yc + by - k2 * bx 
```

希望这对我以外的人有所帮助！

* * *

## 回答 #2

> 赞同：20
> 
> 时间：2009-04-09T13:07:37.027

这在 StackOverflow 帖子中不容易解释，特别是因为向您证明它将涉及许多详细步骤。但是，您所描述的是一个常见问题，并且有许多详尽的解释。看**[这里](http://www.tinaja.com/glib/bezarc1.pdf)**和**[这里](http://www.tinaja.com/glib/bezcirc2.pdf)**；我非常喜欢#2 并且以前使用过它。

* * *

## 回答 #3

> 赞同：9
> 
> 时间：2016-06-15T14:03:55.737

[“圆弧的三次贝塞尔曲线](https://people.mozilla.org/~jmuizelaar/Riskus354.pdf)近似”中提供了一个很好的解释

长话短说：使用贝塞尔曲线，您可以实现 1.96×10^-4 的最小误差，这对于大多数应用程序来说都还可以。

对于正象限弧，请使用以下几点：

```
p0 = [0, radius]

p1 = [radius * K, radius]  

p2 = [radius, radius * K]

p3 = [radius, 0] 
```

其中K是所谓的“幻数”，是一个无理数。它可以近似如下：

```
K = 0.5522847498 
```

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2016-10-30T10:11:41.520

我正在用一些演示来回答这个老问题（它应该属于数学，所以写公式会很糟糕）。

假设*P0*和*P3*是弧的起点和终点，*P1*和*P2*是贝塞尔曲线的控制点，*x*是角度除以 2 的度量。假设*x*小于*pi* /2。

设*PM*为段*P0P3*的中点，*PH*为弧的中点。为了近似圆弧，我们希望贝塞尔曲线从*P0*开始，经过*PH*，在*P3*结束，并在*P0*和*P3*中与圆弧相切。

（单击“运行代码片段”以显示该图。诅咒 imgur 仍然不支持 SVG。）

```
<svg xmlns="http://www.w3.org/2000/svg" viewBox="10 20 80 80">
    <style>text{font-size:40%;font-style:italic;text-anchor:middle}tspan{font-size:50%;font-style:normal}</style>
    <rect x="10" y="20" width="80" height="80" fill="none" stroke="gray"></rect>
    <path stroke="gray" stroke-dasharray="3,2" fill="none" d="M25,30 62.6,31.62 80,65 22.19,95.13 25,30 80,65 M22.19,95.13 62.6,31.62"></path>
    <path stroke="black" fill="none" d="M25,30A65.19 65.19 0 0 1 80,65"></path>
    <circle r="1" fill="red" cx="25" cy="30"></circle>
    <circle r="1" fill="green" cx="80" cy="65"></circle>
    <circle r="1" fill="magenta" cx="22.19" cy="95.13"></circle>
    <circle r="1" fill="darkgreen" cx="52.5" cy="47.5"></circle>
    <circle r="1" fill="yellow" cx="57.19" cy="40.13"></circle>
    <circle r="1" fill="maroon" cx="62.6" cy="31.62"></circle>
    <circle r="1" fill="orange" cx="48.27" cy="31"></circle>
    <circle r="1" fill="teal" cx="69.24" cy="44.35"></circle>
    <text x="25" y="28">P<tspan>0</tspan></text>
    <text x="48.27" y="29">P<tspan>1</tspan></text>
    <text x="71.24" y="42.35">P<tspan>2</tspan></text>
    <text x="83" y="63">P<tspan>3</tspan></text>
    <text x="62.6" y="29.62">P<tspan>E</tspan></text>
    <text x="59.19" y="47.13">P<tspan>H</tspan></text>
    <text x="54.5" y="54.5">P<tspan>M</tspan></text>
</svg>
```

设*PE为与**P0*和*P3*中圆弧相切的线的交点。为了使曲线与圆弧相切，*P1*必须位于线段*P0PE*上，而*P2*必须位于*P3PE*上。设*k*为比率*P0P1* / *P0PE*（也等于*P3P2* / *P3PE*）：

> *P1* = (1 - *k* ) *P0* + *k* *PE*
> 
> *P2* = (1 - *k* ) *P3* + *k* *PE*

我们还有以下（做一些比例）：

> *下午*= ( *P0* + *P3* ) / 2
> 
> *PH* = *PM* / cos( *x* ) = *PM*秒( *x* ) = ( *P0* + *P3* ) 秒( *x* ) / 2
> 
> *PE* = *PH* / cos( *x* ) = *PM*秒( *x* )^2 = ( *P0* + *P3* ) 秒( *x* )^2 / 2

为了简化我们的计算，我认为所有矢量点都是基于中心的，但最终它并不重要。

通用 4 点贝塞尔曲线由公式给出

> *C* ( *t* ) = *t* ^3 *P3* + 3(1 - *t* ) *t* ^2 *P2* + 3(1 - *t* )^2 *t* *P1* + (1 - *t* )^3 *P0*

我们必须有*C* (1/2) = *PH*，所以

> *C* (1/2) = ( *P0* + 3 *P1* + 3 *P2* + *P3* ) / 8
> 
> = (( *P0* + *P3* ) + 3(1 - *k* ) *P0* + 3 *k PE* + 3(1 - *k* ) *P3* + 3 *k PE* ) / 8
> 
> = (( *P0* + *P3* ) + 3(1 - *k* )( *P0* + *P3* ) + 6 *k PE* ) / 8
> 
> = ( *P0* + *P3* )(1 + 3(1 - *k* ) + 3 *k*秒( *x* )^2) / 8

*所以，这是我们找到k*的方程（乘以 8）：

> 8 *℃* (1/2) = 8 *PH*
> 
> => ( *P0* + *P3* )(4 - 3 *k* + 3 *k*秒( *x* )^2) = 4( *P0* + *P3* ) 秒( *x* )

让我们摆脱向量（*P0* + *P3*），我们得到：

> 4 - 3 *k* + 3 *k*秒( *x* )^2 = 4 秒( *x* )
> 
> => 3 *k* (sec( *x* )^2 - 1) = 4(sec( *x* ) - 1)
> 
> => *k* = 4 / 3(秒( *x* ) + 1)

现在您知道在哪里放置控制点了。万岁！

如果你有*x* = *pi* /4，你会得到*k* = 0.552...你可能已经看到了这个值。

在处理椭圆弧时，您所要做的就是相应地缩放点的坐标。

如果你必须处理更大的角度，我建议将它们分成更多的曲线。这实际上是一些软件在绘制圆弧时所做的，因为计算贝塞尔曲线有时比使用正弦和余弦更快。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-09T13:06:18.060

Wolfram MathWorld 上有 Mathematica 代码：[Bézier Curve Approximation of an Arc](http://demonstrations.wolfram.com/BezierCurveApproximationOfAnArc/)，应该可以帮助您入门。

也可以看看：

*   [用贝塞尔曲线画一个圆](http://www.whizkidtech.redprince.net/bezier/circle/)
*   [使用三次贝塞尔曲线逼近圆](http://www.mathworks.com/matlabcentral/fileexchange/6844)

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2012-10-28T02:13:28.667

Raphael 2.1.0 支持 Arc->Cubic (path2curve-function)，并且在修复了 S 和 T 路径规范化中的一个错误之后，它现在似乎可以工作了。我更新了****随机路径生成器****使其仅生成弧线，因此可以轻松测试所有可能的路径组合：

[http://jsbin.com/oqojan/53/](http://jsbin.com/oqojan/53/)

测试，如果某些路径失败，我很乐意得到报告。

编辑：刚刚意识到这是3岁的线程......

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2011-04-08T00:04:48.810

[对于任何椭圆弧](http://www.spaceroots.org/documents/ellipse/elliptical-arc.pdf)作为三次贝塞尔曲线，我已经成功地使用了这个通用解决方案。它甚至包括公式中的开始和结束角度，因此不需要额外的旋转（这对于非圆形椭圆来说是个问题）。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-04-11T15:52:40.443

我最近偶然发现了这个问题。我从这里提到的文章中以模块的形式编译了一个解决方案。

它接受起始角度、结束角度、中心和半径作为输入。

它非常接近小弧（<= PI/2）。如果您需要近似从 PI/2 到 2*PI 的弧线，您始终可以将它们分成 < PI/2 的部分，然后计算相应的曲线并加入它们。

此解决方案与开始和结束角度顺序无关 - 它总是选择小弧。

结果，您获得了在绝对坐标中定义三次贝塞尔曲线所需的所有四个点。

我认为这在代码和注释中得到了最好的解释：

```
'use strict';

module.exports = function (angleStart, angleEnd, center, radius) {
    // assuming angleStart and angleEnd are in degrees
    const angleStartRadians = angleStart * Math.PI / 180;
    const angleEndRadians = angleEnd * Math.PI / 180;

    // Finding the coordinates of the control points in a simplified case where the center of the circle is at [0,0]
    const relControlPoints = getRelativeControlPoints(angleStartRadians, angleEndRadians, radius);

    return {
        pointStart: getPointAtAngle(angleStartRadians, center, radius),
        pointEnd: getPointAtAngle(angleEndRadians, center, radius),
        // To get the absolute control point coordinates we just translate by the center coordinates
        controlPoint1: {
            x: center.x + relControlPoints[0].x,
            y: center.y + relControlPoints[0].y
        },
        controlPoint2: {
            x: center.x + relControlPoints[1].x,
            y: center.y + relControlPoints[1].y
        }
    };
};

function getRelativeControlPoints(angleStart, angleEnd, radius) {
    // factor is the commonly reffered parameter K in the articles about arc to cubic bezier approximation 
    const factor = getApproximationFactor(angleStart, angleEnd);

    // Distance from [0, 0] to each of the control points. Basically this is the hypotenuse of the triangle [0,0], a control point and the projection of the point on Ox
    const distToCtrPoint = Math.sqrt(radius * radius * (1 + factor * factor));
    // Angle between the hypotenuse and Ox for control point 1.
    const angle1 = angleStart + Math.atan(factor);
    // Angle between the hypotenuse and Ox for control point 2.
    const angle2 = angleEnd - Math.atan(factor);

    return [
        {
            x: Math.cos(angle1) * distToCtrPoint,
            y: Math.sin(angle1) * distToCtrPoint
        },
        {
            x: Math.cos(angle2) * distToCtrPoint,
            y: Math.sin(angle2) * distToCtrPoint
        }
    ];
}

function getPointAtAngle(angle, center, radius) {
    return {
        x: center.x + radius * Math.cos(angle),
        y: center.y + radius * Math.sin(angle)
    };
}

// Calculating K as done in https://pomax.github.io/bezierinfo/#circles_cubic
function getApproximationFactor(angleStart, angleEnd) {
    let arc = angleEnd - angleStart;

    // Always choose the smaller arc
    if (Math.abs(arc) > Math.PI) {
        arc -= Math.PI * 2;
        arc %= Math.PI * 2;
    }
    return (4 / 3) * Math.tan(arc / 4);
} 
```

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2020-01-01T15:43:25.670

**基于@k88lawrence[答案的](https://stackoverflow.com/a/44829356/4691224)**快速解决方案****

 **适用于弧 <= PI / 2

```
func controls(center: CGPoint, start: CGPoint, end: CGPoint) -> (CGPoint, CGPoint) {
    let ax = start.x - center.x
    let ay = start.y - center.y
    let bx = end.x - center.x
    let by = end.y - center.y
    let q1 = (ax * ax) + (ay * ay)
    let q2 = q1 + (ax * bx) + (ay * by)
    let k2 = 4 / 3 * (sqrt(2 * q1 * q2) - q2) / ((ax * by) - (ay * bx))
    let control1 = CGPoint(x: center.x + ax - (k2 * ay), y: center.y + ay + (k2 * ax))
    let control2 = CGPoint(x: center.x + bx + (k2 * by), y: center.y + by - (k2 * bx))
    return (control1, control2)
} 
```

# multithreading - 如果没有事件发生，为什么主运行循环让执行线程进入睡眠状态？

> ID：734104
> 
> 赞同：0
> 
> 时间：2009-04-09T12:59:04.053
> 
> 标签：multithreading, event-handling

如果应用程序运行循环中没有事件，我不明白为什么线程必须“休眠”。这会节省能源、内存还是其他什么？

当来自源输入的事件发生时，它将再次唤醒该线程以处理此事件。之后，它会再次休眠，因为队列中没有更多事件等待处理。

有人对这个睡眠问题有很好的解释吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T13:01:25.640

休眠线程允许 OS 调度程序（将 CPU 时间分配给线程的子系统）运行其他线程。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T13:02:35.417

这不是问题。那是一件好事。主线程还会做什么？它不应该处理长时间运行的任务 - 当 UI 事件出现时，这会降低 UI 的“敏捷性”。

在事件到来之前，它不应该是紧密循环的——这会占用处理器时间，否则其他应用程序可以明智地使用这些时间。

睡眠（或者更确切地说是等待）正是您希望它做的事情 - 因此它可以在它有有用的工作要做时立即唤醒，但不会影响系统。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T13:15:16.713

正如其他人所说，将线程置于睡眠状态允许执行其他线程。

我要补充一点，因为您可能指的是 iPhone（基于您的大多数其他问题），即使没有其他线程需要运行，这也会很有用，因为 CPU 功耗会在空闲时下降。

# c# - 如何在 C# 中使用 Codedom 向 hashTable 添加值

> ID：734108
> 
> 赞同：0
> 
> 时间：2009-04-09T12:59:51.507
> 
> 标签：c#

```
CodeVariableDeclarationStatement hashTableParam = new CodeVariableDeclarationStatement();
            hashTableParam.Name = "hashtable";
            hashTableParam.Type = new CodeTypeReference(typeof(System.Collections.Hashtable)); 
```

在上面的代码中，我尝试为 hashTable 做一个基本的声明。现在我需要将值添加到哈希表（键，值）。

```
ht.Add("testKey","testData") 
```

即我如何生成这样的代码以使用 codeDom 以编程方式将键和值添加到 HashTable

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T16:04:01.523

可能有一种更面向 CodeDom 的方法，这将允许更轻松的跨语言支持，但这会起作用

假设您已经创建了一个类和一个方法，请创建一个新的 CodeSnippetExpression 并将您想要的代码放入其中，然后将其添加到您的方法主体中。

# java - Java中的持久数据结构

> ID：734110
> 
> 赞同：18
> 
> 时间：2009-04-09T13:00:26.170
> 
> 标签：java, data-structures, immutability

有谁知道一个库或至少有一些关于在 Java 中创建和使用持久数据结构的研究？我不将持久性称为长期存储，而是将持久性称为不变性（参见[Wikipedia entry](http://en.wikipedia.org/wiki/Persistent_data_structure)）。

我目前正在探索为持久结构建模 api 的不同方法。使用构建器似乎是一个有趣的解决方案：

```
// create persistent instance
Person p = Builder.create(Person.class)
             .withName("Joe")
             .withAddress(Builder.create(Address.class)
                 .withCity("paris")
                 .build())
              .build();

// change persistent instance, i.e. create a new one 
Person p2 = Builder.update(p).withName("Jack");

Person p3 = Builder.update(p)
              .withAddress(Builder.update(p.address())
                .withCity("Berlin")
                .build)
            .build(); 
```

但这仍然让人感觉有些样板。有任何想法吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-09T14:21:29.567

构建器会使您的代码过于冗长而无法使用。在实践中，我见过的几乎所有不可变数据结构都通过构造函数传递状态。对于它的价值，这里有一系列很好的文章，描述了 C# 中的不可变数据结构（应该很容易转换成 Java）：

*   [第 1 部分：不变性的种类](http://blogs.msdn.com/ericlippert/archive/2007/11/13/immutability-in-c-part-one-kinds-of-immutability.aspx)
*   [第 2 部分：简单的不可变堆栈](http://blogs.msdn.com/ericlippert/archive/2007/12/04/immutability-in-c-part-two-a-simple-immutable-stack.aspx)
*   [第 3 部分：协变不可变堆栈](http://blogs.msdn.com/ericlippert/archive/2007/12/06/immutability-in-c-part-three-a-covariant-immutable-stack.aspx)
*   [第 4 部分：不可变队列](http://blogs.msdn.com/ericlippert/archive/2007/12/10/immutability-in-c-part-four-an-immutable-queue.aspx)
*   [第 5 部分：大声笑！](http://blogs.msdn.com/ericlippert/archive/2007/12/13/immutability-in-c-part-five-lolz.aspx)（包括在内是为了完整性）
*   [第 6 部分：简单二叉树](http://blogs.msdn.com/ericlippert/archive/2007/12/18/immutability-in-c-part-six-a-simple-binary-tree.aspx)
*   [第 7 部分：关于二叉树的更多信息](http://blogs.msdn.com/ericlippert/archive/2007/12/19/immutability-in-c-part-seven-more-on-binary-trees.aspx)
*   [第 8 部分：关于二叉树的更多信息](http://blogs.msdn.com/ericlippert/archive/2008/01/18/immutability-in-c-part-eight-even-more-on-binary-trees.aspx)
*   [第 9 部分：AVL 树实现](http://blogs.msdn.com/ericlippert/archive/2008/01/21/immutability-in-c-part-nine-academic-plus-my-avl-tree-implementation.aspx)
*   [第 10 部分：双端队列](http://blogs.msdn.com/ericlippert/archive/2008/01/22/immutability-in-c-part-10-a-double-ended-queue.aspx)
*   [第 11 部分：工作双端队列实现](http://blogs.msdn.com/ericlippert/archive/2008/02/12/immutability-in-c-part-eleven-a-working-double-ended-queue.aspx)

C# 和 Java 非常冗长，所以这些文章中的代码非常吓人。我建议学习 OCaml、F# 或 Scala，并熟悉这些语言的不变性。一旦掌握了这项技术，您就可以更轻松地将相同的编码风格应用到 Java 中。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-09T13:21:42.347

我想显而易见的选择是：

o 切换到临时数据结构（构建器）进行更新。这是很正常的。`StringBuilder`以`String`操纵为例。作为你的例子。

```
Person p3 =
    Builder.update(p)
    .withAddress(
        Builder.update(p.address())
       .withCity("Berlin")
       .build()
    )
    .build(); 
```

o 始终使用持久结构。虽然看起来有很多复制，但实际上你应该共享几乎所有的状态，所以它远没有看起来那么糟糕。

```
final Person p3 = p
    .withAddress(
        p.address().withCity("Berlin")
    ); 
```

o 将数据结构分解为大量变量，并用一个庞大且令人困惑的构造函数重新组合。

```
final Person p3 = Person.of(
    p.name(),
    Address.of(
       p.house(), p.street(), "Berlin", p.country()
    ),
    p.x(),
    p.y(),
    p.z()
 ); 
```

o 使用回调接口提供新数据。甚至更多样板。

```
final Person p3 = Person.of(new PersonInfo(
    public String  name   () { return p.name(); )
    public Address address() { return Address.of(new AddressInfo() {
       private final Address a = p.address();
       public String house  () { return a.house()  ; }
       public String street () { return a.street() ; }
       public String city   () { return "Berlin"   ; }
       public String country() { return a.country(); }
    })),
    public Xxx     x() { return p.x(); }
    public Yyy     y() { return p.y(); }
    public Zzz     z() { return p.z(); }
 }); 
```

o 使用讨厌的 hack 使字段暂时可用于代码。

```
final Person p3 = new PersonExploder(p) {{
    a = new AddressExploder(a) {{
        city = "Berlin";
    }}.get();
}}.get(); 
```

（有趣的是，我刚刚收到了 Chris Okasaki 的《纯函数式数据结构》的副本。）

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-09T18:15:13.143

看看[函数式 Java](http://functionaljava.org)。当前提供的持久数据结构包括：

*   单链表 (fj.data.List)
*   惰性单链表 (fj.data.Stream)
*   非空列表 (fj.data.NonEmptyList)
*   可选值（长度为 0 或 1 的容器）（fj.data.Option）
*   设置（fj.data.Set）
*   多路树（又名玫瑰树）（fj.data.Tree）
*   不可变映射 (fj.data.TreeMap)
*   arity 1-8 (fj.P1..P8) 的乘积（元组）
*   arity 2-8 向量 (fj.data.vector.V2..V8)
*   指向列表 (fj.data.Zipper)
*   尖头树 (fj.data.TreeZipper)
*   类型安全的通用异构列表 (fj.data.hlist.HList)
*   不可变数组 (fj.data.Array)
*   不相交的联合数据类型（fj.data.Either）

二进制发行版提供了许多使用示例。[源代码可在Google Code](http://code.google.com/p/functionaljava)的 BSD 许可下获得。

* * *

## 回答 #4

> 赞同：5
> 
> 时间：2009-11-18T18:56:35.850

我用 Java 实现了一些持久性数据结构。Google 代码上的所有开源 (GPL) 代码供感兴趣的人使用：

[http://code.google.com/p/mikeralib/source/browse/#svn/trunk/Mikera/src/mikera/persistent](http://code.google.com/p/mikeralib/source/browse/#svn/trunk/Mikera/src/mikera/persistent)

到目前为止，我主要有：

*   持久可变的测试对象
*   持久哈希映射
*   持久向量/列表
*   持久集（包括专门的持久整数集）

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-10T11:24:10.283

使用动态代理遵循一个非常简单的尝试：

```
class ImmutableBuilder {

    static <T> T of(Immutable immutable) {
        Class<?> targetClass = immutable.getTargetClass();
        return (T) Proxy.newProxyInstance(targetClass.getClassLoader(),
            new Class<?>[]{targetClass},
            immutable);
    }

    public static <T> T of(Class<T> aClass) {
        return of(new Immutable(aClass, new HashMap<String, Object>()));
    }
}

class Immutable implements InvocationHandler {

    private final Class<?> targetClass;
    private final Map<String, Object> fields;

    public Immutable(Class<?> aTargetClass, Map<String, Object> immutableFields) {
        targetClass = aTargetClass;
        fields = immutableFields;
    }

    public Object invoke(Object proxy, Method method, Object[] args) throws Throwable {
        if (method.getName().equals("toString")) { 
            // XXX: toString() result can be cached
            return fields.toString();
        }

        if (method.getName().equals("hashCode")) { 
            // XXX: hashCode() result can be cached
            return fields.hashCode();
        }

        // XXX: naming policy here
        String fieldName = method.getName(); 

        if (method.getReturnType().equals(targetClass)) {
          Map<String, Object> newFields = new HashMap<String, Object>(fields);
          newFields.put(fieldName, args[0]);
          return ImmutableBuilder.of(new Immutable(targetClass, newFields));
        } else {
            return fields.get(fieldName);
        }
    }

    public Class<?> getTargetClass() {
        return targetClass;
    }
} 
```

用法：

```
interface Person {
    String name();
    Person name(String name);
    int age();
    Person age(int age);
}

public class Main {

    public static void main(String[] args) {
        Person mark = ImmutableBuilder.of(Person.class).name("mark").age(32);
        Person john = mark.name("john").age(24);
        System.out.println(mark);
        System.out.println(john);
    }
} 
```

成长方向：

*   命名策略（getName、withName、name）
*   缓存 toString(), hashCode()
*   equals() 实现应该很简单（尽管没有实现）

希望能帮助到你 ：）

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T13:42:08.507

如果不是不可能的话，要让原本不是这样设计的东西不可变是非常困难的。

如果您可以从头开始设计：

*   仅使用最终字段
*   不要引用非不可变对象

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T16:41:54.350

你想要不变性：

1.  所以外部代码不能改变数据？
2.  所以一旦设置一个值就不能改变？

在这两种情况下，都有更简单的方法来实现所需的结果。

使用接口可以很容易地阻止外部代码更改数据：

```
public interface Person {
   String getName();
   Address getAddress();
}
public interface PersonImplementor extends Person {
   void setName(String name);
   void setAddress(Address address);
}

public interface Address {
    String getCity();
}

public interface AddressImplementor {
    void setCity(String city);
} 
```

然后使用 java.util.concurrent.atomic.AtomicReference 来停止对值的更改也是“容易的”（尽管可能需要修改休眠或其他一些持久层的用法）：

```
class PersonImpl implements PersonImplementor {
    private AtomicReference<String> name;
    private AtomicReference<Address> address;

    public void setName(String name) {
        if ( !this.name.compareAndSet(name, name) 
           && !this.name.compareAndSet(null, name)) {
            throw new IllegalStateException("name already set to "+this.name.get()+" cannot set to "+name);
        }
    }
    // .. similar code follows....
} 
```

但是，为什么您需要的不仅仅是接口来完成任务呢？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2015-04-14T10:44:22.227

Google Guava 现在托管各种[不可变/持久数据结构](https://github.com/google/guava/wiki/ImmutableCollectionsExplained)。

# c# - C# 中的部分接口

> ID：734112
> 
> 赞同：63
> 
> 时间：2009-04-09T13:01:36.123
> 
> 标签：c#

C# 是否允许部分接口？即，在 ManagerFactory1.cs 类中，我有

```
public partial interface IManagerFactory
{
    // Get Methods
    ITescoManager GetTescoManager();
    ITescoManager GetTescoManager(INHibernateSession session);
} 
```

在 ManagerFactory.cs 类中，我有：

```
public partial interface IManagerFactory
{
    // Get Methods
    IEmployeeManager GetEmployeeManager();
    IEmployeeManager GetEmployeeManager(INHibernateSession session);
    IProductManager GetProductManager();
    IProductManager GetProductManager(INHibernateSession session);
    IStoreManager GetStoreManager();
    IStoreManager GetStoreManager(INHibernateSession session);
} 
```

ManagerFactory 和 ManagerFactory1 都位于同一个程序集中。

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-04-09T13:03:38.177

最简单的方法就是尝试一下:)

但是是的，允许部分接口。

修饰符的有效位置`partial`（带有 C# 3.0 规范参考）：

*   课程 (10.1.2)
*   结构 (11.1.2)
*   接口 (13.1.2)
*   方法 (C# 3.0+) (10.2.7; 10.6.8)

规范的第 10.2 节包含部分类型的大部分一般细节。

无效地点：

*   枚举
*   代表们

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-09T13:03:20.360

### 是的，它确实。

MSDN 上的[部分类和方法（C# 编程指南）](http://msdn.microsoft.com/en-us/library/wa80x488.aspx)

### 限制：

*   所有属于同一类型的部分类型接口定义必须修改为`**partial**`
*   部分修饰符只能出现在关键字之前`interface`。
*   所有属于同一类型的部分类型定义必须在同一程序集和同一模块（.exe 或 .dll 文件）中定义。

涉及代码生成时，主要使用部分接口。例如，当界面的一部分是生成的，而另一部分是用户编写的。

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-09T13:16:11.907

确实如此，但一个重要的问题是**为什么？**

部分类在那里，以便您可以扩展自动生成的代码。VS 可以生成表单文件，或代码隐藏，或 Linq to SQL 访问器，您可以使用部分扩展它。

我会避免使用部分来拆分类（或在这种情况下为接口），因为这通常会产生比其价值更多的混乱。

在这种情况下，我将调查为什么这需要跨多个文件 - 工厂模式接口可以使通过您的代码进行回溯变得更加复杂，但在这里您将通过多个文件进行回溯。

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-09T13:03:53.747

是的，[确实如此](http://msdn.microsoft.com/en-us/library/wbx7zzdd.aspx)。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-09T13:17:36.257

在使您的界面局部化之前请三思而后行。也许将它分成两个 itnerfaces 更好？

保持你的界面小而专注。部分是代码气味。

* * *

## 回答 #6

> 赞同：3
> 
> 时间：2010-06-08T07:17:52.507

好的。

我同意这可能是一种气味，但我仍然可以想到一个这样做的理由。

我目前正在为 WPF 和 Silverlight 开发应用程序 MVVM 框架。我遇到的是 WPF 和 Silverlight 如此不同，以至于部分接口/类实际上可以区分两个框架之间的差异，而不是在整个代码中使用定义，并且仍然保持代码干净和几乎单一来源。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-04-09T13:04:11.450

是的，它确实。两个部分接口是否都定义在同一个命名空间中？

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-09T13:04:45.397

请参阅说明它可以用于类、结构或接口的[文档](http://msdn.microsoft.com/en-us/library/wa80x488.aspx)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2009-04-09T13:05:34.520

简短而简单：是的！

# php - Best Practices for Processing Errors from Database in CodeIgniter

> ID：734138
> 
> 赞同：5
> 
> 时间：2009-04-09T13:06:53.240
> 
> 标签：php, database, codeigniter

I have a table with a unique key (`date` + `userid`) in my web application database. When I try to insert record with existing `date` and `userid` I receive the following error:

```
dupicate key in table 
```

I turned on the database debugger in application config, because I needed to use MySQL error numbers and messages. Now I need to process this error. I can use hard coded constants in the controller, but I think it's not good idea. I need database error handling in many places, and I dont like CodeIgniter's error handling. What is a best practice concerning the processing of database errors.

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T13:22:37.897

We use in our project constructions like these:

```
$this->db->_error_number();  
$this->db->_error_message(); 
```

but this undocumented functions and in next releases this could change. Of course you can simply use standard php for mysql error handle function:

```
mysql_errno()  
mysql_error() 
```

internally CI use these functions.

As for me the best practice is use in custom Model's base class (BaseModel)

```
$this->db->_error_number(); 
```

and determine error, next throw exception with information error message taken from

```
$this->db->_error_message(); 
```

All your Model derived from BaseModel, and call method to check last request for db error and your Model must handle exception, and process it (may be additionally log), of course you can implement check result as result value and avoid of throwing exception.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2013-01-22T08:10:37.110

我对此有不同的建议，我会推荐这个

```
$this->form_validation->set_rules('email', 'Email', 'required|max_length[32]|valid_email|callback_email_available'); 
```

在提交表单时，您需要定义规则。总是使用回调与数据库交互

控制器回调方法

```
public function email_available($str)
{
    // You can access $_POST variable
    $this->load->model('mymodel');
    $result =   $this->mymodel->emailAvailability($_POST['email']);
    if ($result)
    {
        $this->form_validation->set_message('email_available', 'The %s already exists');
        return FALSE;
    }else{
        return TRUE;
    }
} 
```

和模型方法

```
public function emailAvailability($email)
{
    $this->db->where('email',$email);
    $query  =   $this->db->get('tablename');
    return $query->row();
} 
```

这样，您将始终避免前面的数据库错误，并且可以让用户以更好的方式查看事物。您不必处理数据库错误，因为表单验证正在为您处理一切。

# c# - 加载 C++ dll 时 C# 崩溃

> ID：734140
> 
> 赞同：0
> 
> 时间：2009-04-09T13:07:01.710
> 
> 标签：c#, c++, dll, crash

我的程序是用 C# NET 2.0 编写的，它使用来自使用 Microsoft Visual Studio 2008 SP1 用 C++ 编写的 dll 的外部函数。如果我从放置程序的目录中删除 dll，程序在它应该使用 dll 的那一刻崩溃。这很正常。

但是使用我的程序的用户在不移动 dll 的情况下在同一个地方得到了同样的错误。他们都从[>here<获得了 C++ Redistributable 2008](http://www.microsoft.com/downloads/details.aspx?FamilyID=9b2da534-3e03-4391-8a4d-074b9f2bc1bf&displaylang=en)

是因为我在 .NET 2.0 而不是 NET 3.5 中制作了程序，还是因为可再发行组件应该是旧版本而发生这种情况？

编辑：请注意，程序运行良好。

[>>新线程<<](https://stackoverflow.com/questions/735346/cannot-load-c-dll-in-c)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T13:45:15.643

它很可能是错误的运行时。确保您分发的是正确的。这些将始终在您的开发箱上工作，因为运行时在路径中。对于测试软件，我使用的是 windows xp 虚拟机。我将虚拟机设置为全新安装，安装我知道我需要的组件（.NET 框架等），然后运行我的安装程序。执行此操作会遇到数量惊人的设置问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T13:20:58.727

您链接到的 C++ Redistributable 看起来像是来自 Visual Studio 2008 的原始版本。如果随着 SP1 发生变化，我可以看到导致崩溃的原因。也许您的用户需要安装可再发行组件的更新版本？

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T13:26:19.480

您的问题中关于实际崩溃的信息很少，这可能意味着很多事情。根据我混合 .NET 和本机 C++ 的经验，并行 (SxS) 可能会出现许多问题，特别是如果 DLL 和 .NET 应用程序是使用不同版本的编译器构建的。

您可能需要在本地机器上重现此问题以进行调试。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T13:30:20.780

[Dependency Walker](http://www.dependencywalker.com/)非常适合追踪这类问题。您可以将 DLL 加载到其中，它会告诉您是否有任何依赖项不可用。有时缺少 DLL 不一定是问题（如果您不沿着该代码路径走），但它比猜测要好得多。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T13:30:46.643

在这种情况下使用 .NET 2.0 或 3.5 没有区别。
查看从 C++ 链接和导出函数的方法（如果它是非托管的）如果外部函数是在托管 C++ 上编写的，请查看 dll 的签名和版本

# iphone - UIApplication 对象、UIWindow 对象、UIView 对象或任何 UIView 子类是“响应程序对象”吗？

> ID：734147
> 
> 赞同：0
> 
> 时间：2009-04-09T13:09:37.117
> 
> 标签：iphone

我的理解是否正确，UIApplication 对象、UIWindow 对象、UIView 对象或任何 UIView 子类都是“响应程序对象”？

他们在这里说：

> 应用程序中的响应程序对象包括 UIApplication、UIWindow、UIView 和所有 UIView 子类的实例。

我的英语不太好理解“包含”的含义。因此它们可能“包含”一个 Responder 对象，或者一大群著名的 Responder 对象“包含”这些类（或者换句话说：它们属于这个组，称为“Responder 对象”）。知道这意味着什么吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T13:20:33.940

是的，它们都继承自`UIResponder`. 您可以通过查看 API 来检查这一点。

这里以[UIApplication API 页面](http://developer.apple.com/iphone/library/documentation/UIKit/Reference/UIApplication_Class/Reference/Reference.html)为例。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T13:18:41.137

它们的意思是它们继承自 UIResponder 类。

# sql - 评级系统的数据库设计

> ID：734151
> 
> 赞同：3
> 
> 时间：2009-04-09T13:10:45.243
> 
> 标签：sql, database-design, rating-system

该应用程序处理用户和对象，用户对具有 3 个特征的对象进行评分（每个特征一个评分）。

**编辑**：最后一句话不清楚：我所说的特征是指所有对象共享的标准

为这样的系统设计数据库的效率如何？设计处理评级系统的数据库的最佳实践是什么？

我在想什么：

表：

*   用户
*   对象
*   成绩单
*   成绩单
*   费率

和关系：一个对象有很多

*   成绩单
*   成绩单
*   费率

一个用户有很多

*   成绩单
*   成绩单
*   费率

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-09T13:21:36.510

假设您不打算增加或减少要评分的评分功能的数量，我会制作一个评分表来跟踪用户、产品和三列（每个功能一个）

所以你有你的用户表、一个对象表和你的评级表，它有用户 ID 和对象 ID 作为组合的主键，这样你就可以根据用户标准对每个对象执行一个评级。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-09T13:24:49.450

您希望以这样一种方式封装数据，即每个表只包含与其需要处理的内容直接相关的信息。创建链接表以提供不同数据集（在本例中为用户和对象）之间的关系。

我将创建以下表格：

**用户**- 用户的基本信息：登录名、密码、用户 ID，无论您需要什么。

**对象**- 要评价的对象：其名称/ID 和属性。

**特征**- 描述一种特征类型的表，带有某种特征名称/ID。这可能从您的三种主要类型开始，但您始终可以扩展/修改它。您还可以自定义每个对象可用于评级的功能。

**ObjectFeature** - 对象和特征的链接表。包含每个表的主键，在两者之间创建多对多关系。

**UserRating** - ObjectFeature 和用户之间的另一个链接表。包含这两个表的主键，以及分配的等级。

From a relational standpoint, this is a better way of organizing the data than what you presented. Through its design it makes clear how each set of data is connected and makes expandability (e.g. adding additional features to rate, having different objects have different features to rate) much cleaner.

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-09T13:14:49.287

非常奇怪的设计，我必须说。考虑：

```
Object: ID, ...

// Provided features cannot be shared between objects
ObjectFeature: ID, ObjectID, ... 

User: ID, ...

UserObjectFeatureRating: UserID, ObjectFeatureID, Rating 
```

# wpf - MVVM WPF - 视图模型的使用

> ID：734156
> 
> 赞同：0
> 
> 时间：2009-04-09T13:12:57.343
> 
> 标签：wpf, mvvm

我有一个 WPF 数据输入表单，其中有 3 个组合框，需要填写主详细信息，如部门、职位和薪酬类型及其他信息。所有这 3 个主信息都需要从数据库中获取。我使用 LINQ to SQL 作为我的数据层。我已经为这些主信息（即 3 个 Viewmodels）建立了维护页面。

现在我的问题：

是否建议将这 3 个视图模型用于组合框（这会破坏 MVVM，因为有多个视图模型用于视图）并直接绑定它们，或者如果我只使用 3 个主要类的 observablecollection（部门、职位和薪酬类型）。

我真的很感激在这方面的任何帮助。我有很多相同场景的表格，我无法决定走哪条路线。

提前致谢。

拉贾

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T13:19:11.523

我认为`ObservableCollection`在 ViewModel 类中使用三个 s 是可以的。这样，您可以将其用作`DataContext`视图本身，这将使设置绑定更加容易。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-15T18:33:22.003

作为对此的轻微变化，我可能使用了 ViewModels 的 ObservableCollections。

这在您的情况下可能没有意义，但我发现它在组合/列表使用相当复杂的数据模板并且用户可以与列表项中的元素交互的情况下很有帮助......

# c++ - 重新安排条件评估会加速循环吗？

> ID：734158
> 
> 赞同：11
> 
> 时间：2009-04-09T13:13:58.837
> 
> 标签：c++, optimization, micro-optimization, premature-optimization

有点奇怪：一位朋友不久前告诉我，重新排列这个示例`for`循环：

```
for(int i = 0; i < constant; ++i) {
    // code...
} 
```

到：

```
for(int i = 0; constant > i; ++i) {
    // code...
} 
```

会略微提高 C++ 的性能。我看不出将常量值与变量进行比较比反之亦然更快，而且我运行的一些基本测试没有显示两种实现之间的速度有任何差异。测试这个 Python`while`循环也是如此：

```
while i < constant:
    # code...
    i += 1 
```

与：

```
while constant > i:
    # code...
    i += 1 
```

我错了吗？我的简单测试不足以确定速度变化吗？其他语言也是这样吗？或者这只是一个新的最佳实践？

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-09T13:18:29.497

它更像是 C++ 的民间传说，手动微优化曾经在特定编译器的特定版本上工作过，然后作为某种传说将拥有者与普通群体区分开来。太垃圾了 剖析是真理。

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-09T13:16:33.183

可能不会，但如果确实如此，编译器可能会自动为您进行优化。因此，无论以何种方式使您的代码最具可读性，都可以这样做。

* * *

## 回答 #3

> 赞同：10
> 
> 时间：2009-04-09T13:16:52.293

我怀疑你的朋友是 100% 错的。但我不会再相信我的意见，就像我不会相信你的朋友一样。事实上，如果出现性能问题，您应该只信任一个人。

# 探查器

**只有**这样，您才能以任何权威声称一种方式比另一种方式快或不快。

* * *

## 回答 #4

> 赞同：8
> 
> 时间：2009-04-09T13:47:19.053

您提供的示例在 C++ 中应该绝对没有性能差异，我怀疑它们在 Python 中也会有所不同。

也许您将它与不同的优化混淆了：

```
for (int i = 0; i < variable; ++i)

// ...vs...

for (int i = variable; i ; --i) 
```

后者在某些体系结构中更快，因为递减变量的行为将设置零标志，然后可以在非零跳转指令中对其进行检查，从而一次性为您提供循环迭代和条件。前一个示例需要执行显式比较或减法以设置标志，然后基于该标志进行跳转。

**但是**，大多数时候编译器可以将第一种情况优化为第二种情况（特别是如果它看到变量实际上是一个常量），并且在某些编译器/架构组合上可能会生成使第一种方法更像第二种方法的指令. 只有当你的分析器告诉你有一个紧密的内部循环很昂贵时，这样的事情才值得尝试，但你永远不会注意到差异，即使有一个。

* * *

## 回答 #5

> 赞同：5
> 
> 时间：2009-04-09T13:28:15.667

假设[短路评估](http://en.wikipedia.org/wiki/Short-circuit_evaluation)，唯一一次应该有很大不同的是，如果您在循环中调用了慢速函数。例如，如果您有一个函数从数据库中查询一个值并返回它，那么：

```
while(bContinue && QueryStatusFromDatabase==1){
}  //while 
```

会比：

```
while(QueryStatusFromDatabase==1 && bContinue){
}  //while 
```

尽管它们在逻辑上是相同的。

这是因为第一个可以在一个简单的布尔值为 FALSE 时立即停止 - 查询只需要在布尔值为 TRUE 时运行，但第二个将*始终*运行查询。

除非您需要从循环中挤出所有可能的 CPU 周期，否则这些极端情况可能是唯一值得您花时间处理的情况。可以这样想：为了弥补你花在问这个问题上的时间，你的循环可能需要数十亿次迭代。

最糟糕的是，当您将函数作为条件时，并且该函数具有代码中其他地方秘密预期的副作用。因此，当您进行少量优化时，副作用只会在*某些*时候发生，并且您的代码会以奇怪的方式中断。但这有点切线。您的问题的简短回答是“有时，但通常没关系”。

* * *

## 回答 #6

> 赞同：4
> 
> 时间：2009-04-09T13:59:29.150

虽然分析是最好的，但它不是**唯一**的方法。

您可以比较每个选项创建的程序集，对于像这样的微优化来说，这不应该是不可能的。对您的硬件平台的命令进行一点研究可以让您了解这种变化是否会产生影响以及它可能会如何以不同的方式执行。我假设您将为您的示例计算移动次数并比较命令。

如果您的调试器允许您在单步执行时在源视图和反汇编视图之间切换，这应该很容易。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2009-04-09T13:15:54.807

最好不要不顾一切地进行这样的优化调整，这会给你带来微不足道的好处（假设它*是*一个调整）。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2009-04-09T18:20:44.160

任何理智的编译器都将以相同的方式实现。如果在某些架构上一个比另一个快，编译器会以这种方式对其进行优化。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-08-03T06:15:04.397

与 0 比较非常快，所以这实际上会稍微快一些：

```
for (int i = constant; i > 0; --i)
{ 
  //yo
} 
```

我认为`!=`在任何情况下都最好使用它，因为它使一个错误更容易检测，并且是使用具有非连续数据结构（如链表）的迭代器的唯一方法。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-09T13:39:50.337

今天，关于一个好的编译器，一点也不。

首先，操作数顺序对我看到的指令集没有任何影响。其次，如果有一个，任何体面的优化器都会选择更好的。

不过，我们不应该盲目地忽视性能。响应性仍然很重要，计算时间也很重要。尤其是在编写库代码时，您不知道何时会连续被调用 200 万次。

此外，并非所有平台都是平等的。嵌入式平台通常会受到低（er）处理能力和实时处理要求之上的不合标准的优化器的影响。

在桌面/服务器平台上，权重已经转移到实现更好扩展算法的良好封装的复杂性上。

**微优化**只有在损害其他方面（例如可读性、复杂性或可维护性）时才是不好的。当其他一切都相同时，为什么不选择更快的呢？

* * *

曾经有一段时间，在 x86 上以零结束循环（例如通过倒计时）实际上可以显着改善紧密循环，因为 a`DEC CX/JCXNZ`更快（它仍然可能是，因为它可以为比较对象节省寄存器/内存访问; 编译器执行优化现在通常超出此范围）。你的朋友听到的可能是一个错误的版本。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-09T15:17:58.593

我谦虚地建议，在某些架构上的某些编译器上，以下内容可以比变体更有效地减少：

```
i = constant - 1
while (--i) {
} 
```

获得*不断*的迭代。

正如许多评论所暗示的那样，编译器将为您优化循环做得很好（编译器优化人员已经花了很多时间思考它）。清晰的代码可能更有价值，但是 YMMV！

如果您真的想优化超出您认为编译器可能能够做的事情，我建议查看高级语言生成的程序集，并从那里考虑进一步优化。

在较高级别上，您还可以通过使用 OpenMP 或在较低级别上通过矢量指令集（例如 MMX）在单个指令中执行多个计算来获得显着更高的性能。这有点超出了问题的范围，你必须提供更多关于循环在做什么的信息，以获得有用的建议。

希望有帮助和欢呼。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-07-31T20:46:18.820

提供的优化只会为给定的编译器优化更多（也许）。抽象地说，它应该生成相同的代码。

如果您正在进行微优化——假设满足微优化的要求——您的第一步应该是查看生成的程序集，然后查看您的体系结构的程序集手册。

例如，i++ 可能比 i+1 快。依靠。在幼稚的 CPU 中，等于 0 比小于值快得多。如果您的编译器/CPU 不支持指令重新排序，您可能会发现在计算中穿插分配会加快您的代码速度。（某些计算可能会导致管道停顿）但这是您必须为*您的*编译器/架构组合专门确定的内容。

*坦率地说，除非我绝对需要*处理器的每个最后一个周期，否则我不会费心进行这种级别的优化。传统上，图形或科学计算是你需要这类东西的地方[*]。

*我知道一个程序，经过数月的优化*和*在现代机器上，仍然需要数月来处理数据。单个数据集的运行时间在周范围内。有很多数据可以使用......

* * *

## 回答 #13

> 赞同：-1
> 
> 时间：2009-04-09T13:18:47.407

这绝对是一个微优化的案例，真的不需要做。

确实（尤其是）在 C++ 中，后自增操作和预自增操作之间存在很小的性能差异，但在当今的编译器中，这种差异通常可以忽略不计。更改条件顺序的原因是由于从后自增到前自增的变化。

# java - Maven 如何知道在哪里可以找到 Java 1.5

> ID：734166
> 
> 赞同：3
> 
> 时间：2009-04-09T13:16:41.170
> 
> 标签：java, maven-2

在`pom.xml`您可以：

```
<build>
    <plugins>
        <plugin>
            <artifactId>maven-compiler-plugin</artifactId>
            <configuration>
                <source>1.5</source>
                <target>1.5</target>
            </configuration>
        </plugin>
    </plugins>
</build> 
```

Maven 怎么知道我在哪里有 1.5 版本？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-09T13:19:01.570

据我所知，这*不会*使 Maven 针对 Java 1.5 库进行编译。这只会告诉编译器接受 1.5 级源代码并生成 1.5 级类文件。

只要您的 Maven 任务使用 Java 6 JVM 运行，您的代码仍然可能引用 Java 6 类。

如果您执行：

```
mvn -v 
```

输出将显示正在使用的 Java 版本。例如：

```
Apache Maven 2.1.0 (r755702; 2009-03-18 19:10:27+0000)
Java version: 1.6.0_13
Java home: C:\Program Files\Java\jdk1.6.0_13\jre
Default locale: en_IE, platform encoding: Cp1252
OS name: "windows vista" version: "6.0" arch: "x86" Family: "windows" 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T13:18:11.777

我认为我们在这里谈论的是 Maven。我会通过 JAVA_HOME 环境变量猜测。如果 Windows 执行 echo %JAVA_HOME% 或 Linux 执行 echo $JAVA_HOME 并查看。

哎呀：对不起，我看到它是 Maven。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-04-16T20:20:01.343

我知道 Maven 已经知道在哪里可以找到我的 JDK，而无需我设置 $JAVA_HOME。删除默认JDK版本后，Maven仍然在原始位置查找并抛出错误。

如果已经存在机制，我不想设置 $JAVA_HOME。最后我找到了~/.mavenrc，里面有JAVA_HOME的设置。

我解决了这个问题，很快，事情就很开心了。

# jquery - 如果通过 JQuery 创建 html，鼠标触发不会正确发生

> ID：734168
> 
> 赞同：1
> 
> 时间：2009-04-09T13:17:00.390
> 
> 标签：jquery, user-interface, triggers, mouse

> **HTML**

```
<div id="header">top of page</div>
<div class="message">hello, how are you</div>
<div class="message">I am fine</div> 
```

> **jQuery**

```
$(document).ready(function () {
    $("#header").append('<div class="message">appended DIV</div>');
    $('div.message').hover(
        function () {
            alert('hi');
        },
        function () {
            alert('bye');
        }
    );
}); 
```

为什么 HTML 中的现有 DIV 甚至会触发鼠标并因此发出警报，但附加的 DIV 不会并且“死”。附加的 DIV 如何像现有的 DIV 一样做出反应？

> **编辑：总而言之，这是解决方案：**

```
$('<span />').addClass('message').text('(mouse 1)').appendTo('#header');
$('<span />').addClass('message').text('(mouse 2)').appendTo('#header');

$('.message').hover(
    function () {
        $('#header').prepend('in');
    },
    function () {
        $('#header').prepend('out');
    }
); 
```

**请注意，如果 SPAN 放置在悬停功能下方，它将不起作用。**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T13:57:34.553

这是从当前代码生成的 XHTML：

```
<div id="header2">put mouse here<div class="message"></div></div> 
```

如您所见，您希望悬停的部分没有文本。

尝试：

```
$('<div />').addClass('message').text('appended DIV').appendTo('#header'); 
```

您现在将看到`div`附有`message`类的新文本中的文本。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T13:26:03.240

它不起作用，因为这样你是在附加文本而不是创建一个 DOM 对象，你以后可以选择它。

您可能应该执行以下操作：

```
var divObj = $('<div>').attr('class', 'message');
$('#header').append(divObj);
$(divObj).hover(
    function () {
        alert('hi');
    },
    function () {
        alert('bye');
    }
); 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T13:34:41.160

您的代码实际上在 Firefox 中非常适合我，所以我认为这一定是其他问题。你认为还有什么可能会影响它吗？

# ruby - hpricot with firebug's XPath

> ID：734178
> 
> 赞同：2
> 
> 时间：2009-04-09T13:18:55.377
> 
> 标签：ruby, xpath, firebug, hpricot

I'm trying to extract some info from a table based website with hpricot. I get the XPath with FireBug.

```
/html/body/div/table/tbody/tr/td/table/tbody/tr[2]/td/table/tbody/tr/td[2]/table/tbody/tr[3]/td/table[3]/tbody/tr 
```

This doesn't work... Apparently, the FireBug's XPath, is the path of the rendered HTML, and no the actual HTML from the site. I read that removing tbody may resolve the problem.

I try with:

```
/html/body/div/table/tr/td/table/tr[2]/td/table/tr/td[2]/table/tr[3]/td/table[3]/tr 
```

And still doesn't work... I do a little more research, and some people report they get their XPath removing the numbers, so I try this:

```
/html/body/div/table/tr/td/table/tr/td/table/tr/td/table/tr/td/table/tr 
```

Still no luck...

So I decide to do it step by step like this:

```
(doc/"html/body/div/table/tr").each do |aaa |
  (aaa/"td").each do | bbb|
        pp bbb
        (bbb/"table/tr").each do | ccc|
            pp ccc 
      end
  end
end 
```

I find the info I need in bbb, but not in ccc.

What am I doing wrong, or is there better tool to scrap HTML with long/complex XPath.

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-06-09T12:21:38.840

您的问题出在 XPather（或 firebug XPath）中。我认为 Firefox 正在内部修复格式错误的表格以具有 tbody 元素，即使在 HTML 中没有。Nokogiri 没有这样做，而是允许 tr 标签位于表格内。

所以很有可能你的路径看起来像这样的 nokogiri：

```
/html/body/div/table/tr/td/table/tr[2]/td/table/tr/td[2]/table/tr[3]/td/table[3]/tr 
```

这就是nokogiri会接受它的方式:)

你可能想看看这个

```
require 'open-uri'
require 'nokogiri'

class String
  def relative_to(base)
    (base == self[0..base.length-1]) &&
      self[base.length..-1]
  end
end

module Importer
  module XUtils
    module_function

    def match(text, source)
      case text
      when String
        source.include? text
      when Regexp
        text.match(source)
      when Array
        text.all? {|tt| source.include?(tt)}
      else
        false
      end
    end

    def find_xpath (doc, start, texts)
      xpath = start
      found = true

      while(found)
        found = [:inner_html, :inner_text].any? do |m|
          doc.xpath(xpath+"/*").any? do |tag|
            tag_text = tag.send(m).strip.gsub(/[\302\240]+/, ' ')
            if tag_text && texts.all?{|text| match(text, tag_text)}
              xpath = tag.path.to_s
            end
          end
        end
      end

      (xpath != start) && xpath
    end

    def fetch(url)
      Nokogiri::HTML(open(url).read)
    end
  end
end 
```

我写了这个小模块来帮助我在网络抓取和数据挖掘时使用 Nokogiri。

基本用法：

```
 include XUtils
 doc = fetch("http://some.url.here") # http:// is impotrtant!

 base = find_xpath(doc, '/html/body', ["what to find1", "What to find 2"]) # when you provide array, then it'll find element conaining ALL words

 precise = find_xpath(doc, base, "what to find1")
 precise.relative_to base 
```

祝你好运

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-10T06:43:09.350

使用 hpricot 的 CSS 解析而不是 XPath 可能会更好。_why 曾经谈论过可能贬低 XPath。

你有更好的数据示例吗？他们是否使用易于引用的 css 标签？

像这样搜索要容易得多：

```
doc.search("#id_tag > table > tr.class_tag > td").each do |aaa|
    aaa.search("blah > blah").each do |bbb|
        bbb.inner_html 
```

_why 的网站上有一个较旧的页面（我现在似乎找不到）正在讨论 hpricot，一些评论暗示在进行类似于你的嵌套搜索时，CSS 版本是如何比 XPath 更好的选择.

希望我能给出一个更好的答案，但我强烈建议先试一试 CSS 方法，看看它是如何进行的，然后再用 XPath 撕掉你的头发。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-30T10:44:11.447

我现在正在使用 css，并用这个很棒的工具“计算”它：[www.selectorgadget.com](http://www.selectorgadget.com)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-11T05:21:50.797

值得注意的是，[Nokogiri](http://nokogiri.rubyforge.org/nokogiri/)使用与 Hpricot 相同的 API，但也支持 XPath 表达式。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2010-08-22T00:43:44.117

您的 HTML 代码中没有 TBODY 标记。Firebug 会自动生成它。

# asp.net - .net 网页中的 AsyncCallback 跑掉了

> ID：734183
> 
> 赞同：1
> 
> 时间：2009-04-09T13:19:21.680
> 
> 标签：asp.net, ftp, asynccallback

我一直在断断续续地从事一个小项目，我想我已经接近了，但它有“问题”。我们的想法是将文件通过 FTP 传输到第 3 方，他们对其进行处理，并在 5-10 分钟后生成一个结果集，该结果集需要在我们这边下载和处理。

所以代码可能有点简单，只是我拼凑的东西

```
            如果（！Page.IsPostBack）
            {
                字符串 baseLocation = "C:\\temp\\";
                字符串 fn = baseLocation +“fxxxupld.inc”；

                ftp = new FtpClient(FTPServer, FTPUserName, FTPPassword);
                ftp.登录（）；
                ftp.上传（fn）；

                AsyncCallback 回调 = new AsyncCallback(CloseConnection);

                ftp.ChangeDir("结果");
                字符串[] 文件 = ftp.GetBloombergUploadList();
                int CHigh = Files.GetUpperBound(0);
                字符串最新文件 = CheckForNewFile(CHigh, ftp);
                ftp.BeginDownload(LatestFile, "c:\\temp\\Results.txt", 回调);
            }

        私有静态字符串 CheckForNewFile(int CHigh,FtpClient ftp)
        {
            int NHigh = 0;
            字符串最新文件 = "";
            而（CHigh >= NHigh）
            {
                字符串[] 文件 = ftp.GetBloombergUploadList();
                NHigh = Files.GetUpperBound(0);
                最新文件 = 文件[NHigh-1].ToString();
                线程.睡眠（3000）；
            }
            返回最新文件；
        }

        私人无效关闭连接（IAsyncResult 结果）
        {
            Debug.WriteLine("文件下载：" + result.IsCompleted.ToString());
            if (ftp != null) ftp.Close();
            ftp =空；
        }

```

很简单，向上推文件，获取当前处理的文件列表，等待并经常检查，当出现新文件时，下载它。

在我添加 AsyncCallback 之前，该过程运行良好，除了用户在页面返回之前无法执行任何操作，并且我无法显示任何类型的进度指示器等。突然添加 AsyncCallback 后，UPLOAD 部分是向远端发送垃圾邮件，我设法使它们崩溃（或至少我们的特定连接）。

对此的任何想法将不胜感激......需要说我有点需要修复这个过程，因为我们的交易员在他们无法工作时会有点不安，而彭博社在他们不得不花费 3 多个小时时会有点不安试图解决它:(

谢谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T18:43:20.207

我猜你的最重要的代码块在`Page_Load`处理程序中？和线

```
 ftp.Upload(fn); 
```

是造成问题吗？如果是这样，我会说您的用户正在重新加载页面，所以这比以前更频繁地调用。

您在正确的路线上查看异步模式，但听起来您需要防止人们刷新页面过多的情况。

# c# - 是否可以仅在 ReSharper 中启用 Agent Smith 检查？

> ID：734196
> 
> 赞同：1
> 
> 时间：2009-04-09T13:21:18.587
> 
> 标签：c#, coding-style, resharper

我们希望实习生使用 ReSharper 的 Agent Smith 插件检查我们的源文件以进行拼写检查和命名约定强制执行。通过禁用除 Agent Smith 插件提供的选项之外的所有检查选项，将 ReSharper 检查的“噪音”降至最低会非常好。这可能吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T13:23:39.377

可以在 R# 中禁用检查，所以是的，这是可能的。

# jquery - jQuery通过嵌套循环 要使用的元素：gt

> ID：734205
> 
> 赞同：0
> 
> 时间：2009-04-09T13:23:23.697
> 
> 标签：jquery

希望你能帮忙。试图隐藏所有大于 <ul> 中第三个标签的 <li> 标签。然而，发生的事情是在前 3 个 <li> 标签之后，所有后续的 <li> 与 :gt(2) 相关的所有内容都隐藏在所有后续的 <ul> 中。

这是我的 HTML 结构。

*   列表标题
    *   第 1 项
    *   第 2 项
    *   第 3 项
    *   应该隐藏
    *   应该隐藏
*   列表标题
    *   第 1 项
    *   第 2 项
    *   第 3 项
    *   应该隐藏
    *   应该隐藏
*   列表标题
    *   第 1 项
    *   第 2 项
    *   第 3 项
    *   应该隐藏
    *   应该隐藏

这是我的 jQuery。

```
$("ul li ul li:gt(2)").each(function () {
    $(this).hide();
}); 
```

如果您需要更多信息，请告诉我。谢谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T13:29:02.593

嗯，我想不出用选择器解决这个问题的方法，但你可以用两个选择器来解决这个问题：

```
$("ul li ul").each(function () {
    $(this).find("li:gt(2)").hide();
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T13:28:19.553

尝试这样的事情：

```
var counter;
$("ul").each(function() {
    counter = 1;
    $(this).children("li").each(function() {
        if (counter > 3) $(this).hide()
        counter++;
    });
}); 
```

# c++ - 多少 STL 太多了？

> ID：734217
> 
> 赞同：6
> 
> 时间：2009-04-09T13:26:38.307
> 
> 标签：c++, stl, coding-style

我使用了很多带有,等的`STL`代码，但我注意到有时使用不是一个好主意。`std::for_each``bind``STL`

例如，如果您有一个`std::vector`并且想要对向量的每个项目执行一个操作，您的第一个想法是使用这个：

```
std::for_each(vec.begin(), vec.end(), Foo()) 
```

它优雅而好，有一段时间。但是随后出现了第一组错误报告，您必须修改代码。现在您应该向 call 添加参数`Foo()`，所以现在它变为：

```
std::for_each(vec.begin(), vec.end(), std::bind2nd(Foo(), X)) 
```

但这只是临时解决方案。现在项目正在成熟，您更好地理解业务逻辑并且您想要对代码添加新的修改。正是在这一点上，您意识到应该使用 old good：

```
for(std::vector::iterator it = vec.begin(); it != vec.end(); ++it) 
```

这只是发生在我身上吗？你在你的代码中识别出这种模式吗？您是否使用过类似的反模式`STL`？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T13:31:33.430

将[boost::bind](http://www.boost.org/doc/libs/1_38_0/libs/bind/bind.html)与 std::for_each 一起使用可以干净利落地解决这个问题。或者你可以使用[BOOST_FOREACH](http://www.boost.org/doc/libs/1_35_0/doc/html/foreach.html)。

std::for_each 的示例：

```
std::for_each(v.begin(), v.end(), boost::bind(&C::f, _1, param)); 
```

BOOST_FOREACH 示例：

```
std::list<int> list_int( /*...*/ );
BOOST_FOREACH( int i, list_int )
{
    // do something with i
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-09T13:52:33.800

不过，它也可以反过来。假设您从一个只需要几行代码的操作开始。您不想费心创建一个只会被调用一次的函数，只是为了压缩循环，所以您编写如下内容：

```
for ()
{
    // do
    // some
    // stuff
} 
```

然后，随着您需要执行的操作变得越来越复杂，您意识到将其拉入单独的函数是有意义的，因此您最终会得到

```
for ()
    do_alot_more_stuff(); 
```

然后将其修改为像您的原始方法一样进一步压缩它是有意义的：

```
std::for_each(begin, end, do_alot_more_stuff); 
```

*最后，真正将 for_each 更改为 for 循环有多难，反之亦然？不要因为小细节而自责！*

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-09T13:55:28.660

像使用任何其他语言工具一样使用它。当它使您的生活更轻松时，请使用它。当它变得麻烦时，做其他事情。当需求发生变化时，以一种或另一种方式重构循环并不是真的很难。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-09T13:32:09.090

与您的问题类似，我经常注意到 C++ 中的“仿函数”模式/习语实际上非常笨拙。这就是为什么我期待 C++0X 中的[Lambda 函数](http://en.wikipedia.org/wiki/C%2B%2B0x#Lambda_functions_and_expressions "Lambda 函数")。现在使用 boost::lambda 可以实现其中的一些。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-09T14:35:05.087

我对算法中的很多东西都有同样的问题。它有一个令人讨厌的趋势，即最终成为*更多*的代码，而不是只使用老式的 for 循环。

我真的不能证明使用适当的构造函数和析构函数，也许还有一些访问器创建一些特殊的仿函数类（这是 C++ 中的一个中等高级主题，我的许多维护人员不会完全理解），只是为了避免单行 for 循环。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T14:00:35.107

也许您首先使用 for_each 而不是 transform ...

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-09T14:30:05.380

我从不使用 std::for_each （或很少使用）。

我建议现在使用[Boost.Foreach](http://www.boost.org/doc/libs/1_38_0/doc/html/foreach.html)和经典的“for”结构。当 C++0x 发布时，您可以考虑使用新的“for”构造，使其更易于遍历容器。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T13:57:23.710

还可以考虑并行性，通过一个函数，您可以定义将发生什么变化，并指示一系列元素是否可以改为并行完成，而不是从开始到结束一次 1 个。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T14:34:39.627

或者您可以等待 C++0x 并使用与`for(elem& e, container){e.something();}`
非常相同`BOOST_FOREACH()`，但属于标准的一部分（在某些年份......）。

# windows - Crash shows Visual studio option. But not showing dont send message

> ID：734219
> 
> 赞同：0
> 
> 时间：2009-04-09T13:27:35.747
> 
> 标签：windows, visual-studio, debugging, crash

When I get any crash in my pc, I used to get don't send dialog box. But recently it is always showing some dialogbox, and it is asking to debug in visual studio. I dont want this dialog option. How can I remove this option.

Could any one knows information about this. Thanks & regards, Haranadh

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T13:31:41.183

您遇到了 Visual Studio 的“即时调试”功能。您可以通过删除以下 reg 键来禁用此功能

要禁用此功能，请按照以下链接中的说明操作：http: [//msdn.microsoft.com/en-us/library/k8kf6y2a (VS.80).aspx](http://msdn.microsoft.com/en-us/library/k8kf6y2a(VS.80).aspx)

即去工具->选项->调试->及时。取消选中两个复选框

功能链接：[及时调试](http://msdn.microsoft.com/en-us/library/5hs4b7a6(VS.80).aspx)

# c++ - 混合低级 C/C++ 代码

> ID：734227
> 
> 赞同：3
> 
> 时间：2009-04-09T13:29:44.493
> 
> 标签：c++, c

我打算编写一个代码库来访问一些低级别的硬件（即翻转寄存器位等）。

以前，我将所有内容都编写为 C 函数，并使用 extern "C" 使库编译为 C 和 C++ 代码。因此，C 和 C++ 用户只需包含头文件并按原样调用函数即可。

现在，我正在考虑将事物组织为类。例如，我可以将初始化、配置、发送和接收 UART 的所有函数放在一个类中。这在 C++ 中运行良好，但 C 呢？我不能在整个班级中使用“C”。

我在想的一件事：用标准 C 函数编写所有内容，用 extern "C" 转义。然后，为 C++ 提供一个包装类，它有一堆调用这些“C”函数的内联方法。

```
int foo_bar (int *address, int data) {...} // extern C stuff
int foo::bar (int *address, int data) { return foo_bar(address, data); } // inline method 
```

可以吗？还有其他想法吗？最佳实践？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T13:37:21.903

您提出的建议有一些先例 - Microsoft 的 MFC 类只是 C 兼容的 Windows API 周围的 C++ 包装器。

不过，在开始之前，您应该有一些目标，而不仅仅是为自己创造忙碌的工作。C++ 应该比 C 更容易使用，否则您将一无所获。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T13:46:24.953

这样做的一个充分理由是，如果您的 C 接口使用典型的“句柄”习语来表示资源。

```
OpaqueThingHandle t = CreateOpaqueThing();

DoStuffWithOpaqueThing(t);

DestroyOpaqueThing(t); 
```

在 C 中，为了实现信息隐藏，`OpaqueThingHandle`通常是 typedef，`void *`以便客户端无法看到它是如何实现的。

C++ 包装器将能够添加一些真正有用的东西，只需将 RAAI 映射到获取或释放由句柄类型标识的资源的函数上：

```
class OpaqueThing : boost::noncopyable
{
    OpaqueThingHandle handle;

public:
    OpaqueThing()
        : handle(CreateOpaqueThing()) {}

    ~OpaqueThing()
        { DestroyOpaqueThing(handle); }

    void DoStuff()
        { DoStuffWithOpaqueThing(handle); }
}; 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T13:33:21.117

你可以这样做，但它对你有什么好处？除非该类添加了一些功能，否则我会坚持使用自由函数方法。

另一方面，类方法有可能使 C 函数更易于使用，方法是为类客户端管理缓冲区等 - 该类仍然使用 C API 来完成实际工作。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T13:54:33.453

您需要同时导出 C - 基于方法和 C++ - 类接口。您可以采用两种方式 - 围绕 C 函数的薄 C++ 包装器，或围绕 C++ 实例的 C 函数。

对于后者，一个典型的模式是这样的：

```
void * c_open_thing(id) { return new CThing(id); }
void c_close_thing(void * handle) { delete (CThing) handle; }
int c_transmit(void * handle, transmitbuf) 
  { return ((CThing *)handle)->Transmit(transmitbuf); } 
```

不过，这样一个简单的包装是没有意义的，不管你用哪种方式来做。C++ 包装器可以通过以下方式增加价值：

*   强制构造/销毁要求
    在这里使用 cosntructor/destructor 通常是不够的，除非您可以提供分配和复制构造。我通常会使用[引用计数句柄](http://www.codeproject.com/KB/stl/boostsp_handleref.aspx)。

*   错误处理
    这可能需要清理，将错误转换为（有意义的！）异常等。

*   线程安全当然，如果你控制了原始库，你可以在那里添加它。

*   ...

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T13:37:48.967

我知道您希望从 C++ 的抽象功能中受益，但您的代码仍然可以访问用 C 编写的代码。实现此目的的一种方法是用 C++ 编写大部分代码，然后创建一组薄的 extern "C " 将您的代码连接到 C 世界的包装函数。

您建议的方法也有效，但正如另一位受访者指出的那样，它不会为您购买任何额外的权力。

请注意，与普通 C 函数方法相比，这两种方法都会带来轻微的性能损失。在您的建议中，C++ 代码付出了代价，而在我的建议中，C 代码付出了代价。这可以通过将函数定义为内联来最小化。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T13:49:15.070

坦率地说，我看不出本质上重复的 C 和 C++ 函数能给你带来什么。

我建议保持 C 函数尽可能基本，定义一个 API 暴露所有原语，不要花哨。然后在更高级别定义 C++ 类，因此 UART 将具有构造函数、析构函数、有意义的方法等。它将拥有所有必要的数据存储。C++ 类不会公开所有可能的原语；为了做一些不同的事情，您将编写一个新的成员函数或类或其他任何东西，调用 C API。

这就是 OCCI（Oracle C++ 调用接口）和 MFC 等系统中的方法，并且效果很好。

# c# - InitiateSystemShutdown 调用不起作用

> ID：734242
> 
> 赞同：1
> 
> 时间：2009-04-09T13:33:07.747
> 
> 标签：c#, winapi

我正在编写一个需要重新启动运行代码的 Windows 机器的应用程序。

.NET 中似乎没有 API 来执行此操作，因此我为此查找了 Win32 API，它被称为 InitiateSystemShutdown。extern 声明如下：

```
[DllImport("advapi32.dll")]
public static extern bool InitiateSystemShutdown(string Machinename, string
Message, long Timeout, int ForceAppsClosed, int RebootAfterShutdown); 
```

然后我尝试使用以下参数调用此操作系统例程：

```
InitiateSystemShutdown(null, null, 30, 1, 1); 
```

但是，这总是返回 false。所以我调用 Marshal.GetLastWin32Error 方法，它返回一个错误代码 1008。这个错误代码的消息是：

“试图引用一个不存在的令牌。”

该代码在 Windows 服务中运行，并在管理员帐户下运行。我试过将它作为本地系统运行，但没有效果。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T02:21:52.367

请参阅 MSDN 中的以下示例：[显示关机对话框](http://msdn.microsoft.com/en-us/library/aa376861(VS.85).aspx)。

您需要为您的线程获得正确的权限。

# sql-server - 使用“<>”或“！=”，或者它真的很重要

> ID：734244
> 
> 赞同：1
> 
> 时间：2009-04-09T13:33:11.867
> 
> 标签：sql-server, tsql

> 重复：[我应该在 TSQL 中使用 != 还是 <> 表示不相等](https://stackoverflow.com/questions/723195/should-i-use-or-for-not-equal-in-tsql)

在 SQL Server 的 T-SQL 中，我应该使用“<>”还是“!=”，或者它真的重要吗？

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-04-09T13:37:09.563

我不知道SQLServer，但是SQL标准使用'<>'，所以遵循标准

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-09T13:36:52.277

我相信 != 是特定于 T-SQL 的（即不是标准 SQL）。因此，如果您有可能将代码移植到使用不同的 DBMS，则应该使用 <>。

就个人而言，我会使用 <> 并忘记它。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T13:36:21.920

根据我的经验，典型的 SQL 用法是使用 <>。我从未见过有人使用 !=; 我什至不知道这有效。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-09T13:38:51.040

!= 不是标准的一部分，但它是 T-SQL 的一部分。

SQL [-](http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt) [92标准](http://www.contrib.andrew.cmu.edu/~shadow/sql/sql1992.txt)

重复的帖子..

[我应该在 TSQL 中使用 != 或 <> 来表示不相等吗？](https://stackoverflow.com/questions/723195/should-i-use-or-for-not-equal-in-tsql/723203#723203)

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2009-04-09T13:38:40.183

使用 <> 因为大多数人都熟悉这一点，并且只要可能有 NULL，请记住 NULL 不等于 NULL，因此有时这是必要的：

```
ISNULL(MY_FIELD,0) <> ISNULL(MY_FIELD,0) 
```

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T13:37:51.043

如果你只使用 SQL Server，那没关系。它们是同义词。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-09T13:39:25.547

它们是相同的。

看[MSDN](http://msdn.microsoft.com/en-us/library/ms190296(SQL.90).aspx)。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-09T13:39:51.333

我会说这取决于您的编码约定。我个人喜欢使用 != 因为 <> 让我想起肮脏肮脏的 VB 并给我一种糟糕的直觉。另外，我更好地理解它，因为它与 C# 的不等于运算符完全相同。

# php - 寻找重复检查变量的更好方法

> ID：734247
> 
> 赞同：2
> 
> 时间：2009-04-09T13:33:23.300
> 
> 标签：php

我最近创建了一个站点，该站点仅包含一个变量，并根据各种可能的值对其进行检查并给出适当的响应。该程序使用了很多`else if`语句。

我确信有更好的方法可以做到这一点，但不知道该使用什么。我仍然在学习 PHP 真的。

这是源代码，可以让您更好地了解：

[http://github.com/r3morse/isitup/blob/a7a972bcf125d1f058a44406a467438d46aa4b16/functions.php](http://github.com/r3morse/isitup/blob/a7a972bcf125d1f058a44406a467438d46aa4b16/functions.php)

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T13:37:53.117

可能 switch 是你所追求的，它相当于 if... else if... 。

[http://be.php.net/switch](http://be.php.net/switch)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T13:41:28.040

尝试[状态](http://en.wikipedia.org/wiki/State_pattern)或[责任链](http://en.wikipedia.org/wiki/Chain-of-responsibility_pattern)

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T13:47:52.377

如果每个代码都需要不同的操作，我认为你不能伪装 else..if 结构..

你可以用一个开关

```
switch($code){
case "200":
  //then you code
 break;
case "401":
  //other code
 break;
} 
```

等等..但我认为你不会获得相关的东西..

其他方式可以将所有代码存储在一个数组中，索引为 $code => $message.. 但前提是您只为每个代码打印一些内容。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T14:05:29.963

另一种可能性是为适当的操作和调度定义一个对象。

像 ...

```
<?php
    class Dispatcher {
        public function action_404($code) {
            return 'foo bar ' . $code;
        }

        public function action_200($code) {
            return 'far boo ' . $code;
        }

        public function action_301($code) {
            return $this->action_200($code);
        }

        /* and so on */

        public function unknownAction($code) {
            return 'don\'t know ' . $code;
        }

    }

    $code       = (int)$_REQUEST['code'];
    $methodName = 'action_' . $code;
    $dispatcher = new Dispatcher();

    if (method_exists($dispatcher, $methodName)) {
        $result = $dispatcher->$methodName($code);
    } else {
        $result = $dispatcher->unknownAction($code);
    }

    echo $result;
?> 
```

在你的情况下真的没有意义。

# asp.net - 具有多个路由值的 ASP.NET MVC URL 路由

> ID：734249
> 
> 赞同：50
> 
> 时间：2009-04-09T13:33:46.450
> 
> 标签：asp.net, asp.net-mvc, url-routing

当我的路由需要多个参数时，我遇到了 Html.ActionLink 问题。例如，给定在我的 Global.asax 文件中定义的以下路由：

```
routes.MapRoute(
    "Default",                                              // Route name
    "{controller}.mvc/{action}/{id}",                           // URL with parameters
    new { controller = "Home", action = "Index", id = "" }  // Parameter defaults
);

routes.MapRoute(
    "Tagging",
    "{controller}.mvc/{action}/{tags}",
    new { controller = "Products", action = "Index", tags = "" }
);

routes.MapRoute(
    "SlugsAfterId",
    "{controller}.mvc/{action}/{id}/{slug}",
    new { controller = "Products", action = "Browse", id = "", slug = "" }
); 
```

前两条路线没有问题，但是当我尝试使用以下命令创建到第三条路线的操作链接时：

```
<%= Html.ActionLink(Html.Encode(product.Name), "Details", new { id = product.ProductId, slug = Html.Encode(product.Name) }) %> 
```

我最终得到一个类似**[site-root]/Details/1?slug=url-slug**的 URL，而我希望 URL 更像**[site-root]/Details/1/url-slug**

谁能看到我哪里出错了？

* * *

## 回答 #1

> 赞同：60
> 
> 时间：2009-04-09T13:36:26.460

它正在使用完全满意的第一条路线。试着把你的`SlugsAfterId`路线放在上面`Default`。

它基本上是这样的：“检查默认值。有一个动作吗？是的。有一个 id 吗？是的。使用这个并在查询字符串中添加任何其他参数。”

附带说明一下，这样做会使您的`Default`路由变得多余，因为您为参数提供了默认值`slug`。

* * *

## 回答 #2

> 赞同：32
> 
> 时间：2009-04-09T13:39:46.047

加里（上图）是正确的。您可以使用 Haack 先生的 MVC 路由调试器。它可以通过向您显示命中哪些路由以及何时命中来帮助解决路由问题。

这是[博客文章](http://haacked.com/archive/2008/03/13/url-routing-debugger.aspx)。这是[Zip 文件](http://haacked.com/code/RouteDebug-Binary.zip)。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2009-06-22T21:17:59.233

您可以在包含“id”的路线中添加一个约束，因为它可能只接受一个数字。这样，第一个路由只会在“id”为数字时匹配，然后它将为所有其他值创建第二个路由。然后将包含 {slug} 的那个放在顶部，一切都应该正常工作。

```
routes.MapRoute(
    "SlugsAfterId",
    "{controller}.mvc/{action}/{id}/{slug}",
    new { controller = "Products", action = "Browse", id = "", slug = "" },
    new { id = @"\d+" }
);

routes.MapRoute(
    "Default",                                              // Route name
    "{controller}.mvc/{action}/{id}",                           // URL with parameters
    new { controller = "Home", action = "Index", id = "" },  // Parameter defaults
    new { id = @"\d+" }
);

routes.MapRoute(
    "Tagging",
    "{controller}.mvc/{action}/{tags}",
    new { controller = "Products", action = "Index", tags = "" }
); 
```

# sql-server - 修剪 GETDATE() 年份的前两个字符

> ID：734250
> 
> 赞同：1
> 
> 时间：2009-04-09T13:33:52.253
> 
> 标签：sql-server, tsql, datetime

我正在尝试创建一个 WHERE 子句，上面写着

```
WHERE column_1 = TRIM(LEADING '20' FROM(DATEPART(year, GETDATE()))) 
```

基本上`column_1`包含会计年度，但会计年度在数据库中为 8 或 9 而不是 2008 或 2009。

所以我需要想办法至少修剪一下，`'20'`这样查询才能正确运行......动态越多越好，因为我需要将它设置为在 SSIS pkg 中运行，并且编码越少越好。

有什么建议么？提前致谢！乔恩

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T13:39:22.537

而不是修剪，使用模数：

```
...
WHERE column_1 = (YEAR(GETDATE()) % 100) 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T13:37:45.443

取决于 column_1 的数据类型

print right(datepart(year,getdate()),2) -- 带前导零的字符串 print convert(int,right(datepart(year,getdate()),2))--int

**编辑**

基于@Richard 的回答
print datepart(year,getdate()) % 100

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T13:39:37.123

是不是有一种只打印年份的最后 2 位数字的转换格式？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T13:46:11.723

如果您的列保证引用 >= 2000 和 < 2100 年，那么您将摆脱相当明显的问题：

```
SELECT YEAR(GETDATE()) - 2000 
```

但是……老实说，在生产环境中看到这样的代码会让我哭泣。这有点太WTF了，imo。

# apache - Apache/Weblogic 9.2 上的 HTTP 标头损坏

> ID：734251
> 
> 赞同：0
> 
> 时间：2009-04-09T13:34:12.907
> 
> 标签：apache, spring, caching, http-headers

我有一个非常奇怪的问题。我的应用程序堆栈基于 J2EE，并使用 Spring 2.5.6 和 Spring webflow 2.0.6。应用服务器是 Weblogic 9.2，前面有一个 Apache 服务器（负载平衡）。我们使用 SiteMinder Webagent 作为 apache 中的身份验证层。

下面的问题可能是由上面的任何层引起的 -

我们的网站性能很慢，原因是某些 javascript 和 css 文件没有被缓存。我们知道 Siteminder 会去除 If-Modified 标头，因此我们启用了 IgnoreExt 参数（在 WebAgent 中）以将 .js 和 .css 扩展名添加到现有的未受保护文件类型列表（没有缓存此 JS 或 CSS 文件）。现在的问题是我只看到 2 个文件没有被缓存（即服务器没有返回 304），原因是响应标头已损坏。服务器确实返回 304，但标头中有一些垃圾文本，因此客户端无法决定从哪里获取内容。看起来像这样 -

[替代文字 http://img187.imageshack.us/img187/2358/dojo.gif](http://img187.imageshack.us/img187/2358/dojo.gif)

[替代文字 http://img246.imageshack.us/img246/2087/tundra.gif](http://img246.imageshack.us/img246/2087/tundra.gif)

**现在这可能是 2 个文件（Spring Webflow 的一部分）或 Apache 中的配置与 SiteMinder 或其他东西的已知问题。有人遇到过这个吗？知道从哪里开始寻找吗？**

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-05-10T20:56:55.930

我们在运行 Apache 2.0.59 和 WebLogic 10mp2 时遇到了类似的情况。间歇性地，我们会发现数据位于有效的 HTTP 响应前面。在 304 Not-Modified 响应之后，数据始终是 gzipped 0。损坏的标头以签名 1F 8B 08... 开头

该问题似乎源于将 mod_deflate 与缓存资源一起使用。我们已经能够通过禁用 mod_deflate 来消除这个问题。迄今为止，我们已禁用 mod_deflate 批发，但正在努力缩小禁用 mod_deflate 的范围。Apache WebServer 项目暗示了 2.1.1 中的修复：

*) mod_deflate：不要缩小长度为零的响应，例如代理 304 的 [Allan Edwards]

# .net - 当我使用转换时，我的打印输出看起来不像打印预览

> ID：734253
> 
> 赞同：0
> 
> 时间：2009-04-09T13:34:35.153
> 
> 标签：.net, winforms, datagridview, printing

我正在尝试使用 PrintDocument 打印出 DataGridView。在我的 PrintPage 事件处理程序中，我使用 e.Graphics 对象绘制一些网格线，然后在创建的“单元格”中打印一些文本——顺便说一句，这确实应该由 Microsoft 完成，但我离题了。

无论如何，这工作得很好。PrintDocument 与 PrintPreviewDialog 绑定，当我打开它时，DGV 会正确呈现。用户可以单击预览对话框的打印按钮并获得打印输出。我的问题是有时 DGV 对页面来说太宽了，所以我希望能够缩放它（仅水平）以适应。我打电话

```
e.Graphics.ScaleTransform(printableWidth / gridWidth) 
```

在我真正开始画任何东西之前。这使预览看起来完全符合我的要求，但由于某种原因，实际的打印输出看起来与我添加缩放代码之前完全一样——如果报告太宽，它就会落在这页纸！

处理 PrintPage 事件以进行预览的方式与将其发送到打印机的方式之间是否存在一些差异？我的普通 PostScript 办公室激光打印机不能处理 ScaleTransform 功能吗？我认为它应该只是盲目地打印发送给它的内容，但可能涉及的处理比我想象的要多。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T15:11:45.200

好的，我发现了我的问题——我以为我正在为每个页面调用 ScaleTransform，但事实证明它只是在第一次调用 PrintPage 处理程序时才真正执行。由于包含条件，随后的调用跳过了该行。因此，明智的一句话-确保如果要转换打印输出，请为每一页独立进行。

# python - Django中的站点和应用程序有什么区别？

> ID：734255
> 
> 赞同：26
> 
> 时间：2009-04-09T13:35:00.037
> 
> 标签：python, django

我知道一个站点可以有很多应用程序，但我看到的所有示例都有一个名为“mysite”的站点。我认为该站点将是您站点的名称，例如 StackOverflow。

你会这样做，然后拥有“身份验证”、“问题”和“搜索”等应用程序吗？或者你真的只有一个名为 mysite 的网站和一个名为 StackOverflow 的应用程序吗？

* * *

## 回答 #1

> 赞同：25
> 
> 时间：2009-04-09T13:48:52.747

Django在这里实际上有3个概念：

*   **项目**（我认为这就是您所说的站点）：这是包含所有应用程序的目录。它们共享一个共同的运行时调用，并且可以相互引用。

*   **App**：这是一组视图、模型和模板。应用程序通常被设计成可以插入另一个项目。

*   **站点**：您可以根据所访问的站点（即：URL）为应用指定不同的行为。这样，同一个“应用程序”可以根据用户是否访问过“StackOverflow.com”或“RackOverflow.com”（或将调用的任何 IT 目标版本）进行自我定制，即使它是相同的代码库那是处理请求。

你如何安排这些真的取决于你的项目。在复杂的情况下，您可能会这样做：

```
Project: StackOverflowProject
    App: Web Version
        Site: StackOverflow.com
        Site: RackOverflow.com
    App: XML API Version
        Site: StackOverflow.com
        Site: RackOverflow.com
    Common non-app settings, libraries, auth, etc 
```

或者，对于想要利用开源插件的更简单的项目：

```
Project: StackOverflowProject
    App: Stackoverflow
        (No specific use of the sites feature... it's just one site)
    App: Plug-in TinyMCE editor with image upload
        (No specific use of the sites feature) 
```

除了需要有一个项目和至少一个应用程序之外，这种安排非常灵活；您可以适应最适合的方式来帮助抽象和管理部署的复杂性（或简单性）。

* * *

## 回答 #2

> 赞同：8
> 
> 时间：2009-04-09T13:43:20.657

从[Django 文档](http://docs.djangoproject.com/en/dev/intro/tutorial01/)：

> ## 项目与应用
> 
> 项目和应用程序有什么区别？应用程序是做某事的 Web 应用程序——例如，网络日志系统、公共记录数据库或简单的投票应用程序。项目是特定网站的配置和应用程序的集合。一个项目可以包含多个应用程序。一个应用程序可以在多个项目中。

从[这个链接](http://www.b-list.org/weblog/2006/sep/10/django-tips-laying-out-application/)：

> ## 项目与应用程序
> 
> 这实际上更像是一个单独的（尽管相关的）问题，但是理解 Django 在“项目”和“应用程序”之间的区别是良好代码布局的重要组成部分。粗略地说，这就是这两个术语的含义：
> 
> *   应用程序试图提供一个单一的、相对独立的相关功能集。允许应用程序定义一组模型（尽管它不是必须）以及定义和注册自定义模板标签和过滤器（尽管它也不是必须）。
>     
>     
> *   项目是应用程序的集合，安装在同一个数据库中，并且都使用相同的设置文件。从某种意义上说，项目的定义方面是它提供了一个设置文件，该文件指定要使用的数据库、要安装的应用程序以及其他配置。一个项目可能对应于一个网站，但不是必须的——多个项目可以在同一个网站上运行。该项目还负责根 URL 配置，但在大多数情况下，仅包含调用以包含从单个应用程序中提取 URL 配置的调用是有用的。
>     
>     
> 
> 视图、自定义操纵器、自定义上下文处理器和 Django 允许您创建的大多数其他东西都可以在项目或应用程序级别定义，您在哪里执行应该取决于对您最有效的内容；不过，一般来说，它们最好放在应用程序中（这增加了它们在项目之间的可移植性）。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-04-19T04:21:29.200

如果你有一个项目，只有一个名为 StackOverflow 的应用程序，答案是肯定的。像这样的网站可能有 20 多个应用程序。

请参阅 James Bennett 的“ [DjangoCon 2008: Reusable Apps](http://www.youtube.com/watch?v=A-S0tqpPga4 "DjangoCon 2008：可重用应用程序") ”视频演示，它很好地解释了这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T13:38:13.100

正如您所说，您将拥有一个名为 StackOverflow 的网站，其中包含身份验证应用程序、问题应用程序等。

你应该看看[Pinax 项目](http://pinaxproject.com/)，看看他们是如何布局的。这是更好的方法之一，因为它将增加应用程序的模块化和可移植性。

# git - 有没有办法从克隆的 git-svn 存储库中“git svn dcommit”：

> ID：734256
> 
> 赞同：8
> 
> 时间：2009-04-09T13:35:04.217
> 
> 标签：git, git-svn

有没有办法从克隆的 git-svn 存储库中“git svn dcommit”：

我的 svn 中有几个分支，有时它是非常小的分支，将它放在同一个目录中很好，但有时这些分支会变大，将整个东西移动到另一个文件夹很好。

但是当我从这个本地存储库执行 git clone 到磁盘上的另一个位置时，git-svn 丢失了所有信息，我不知道如何将其连接回来。我想我可以只复制该文件夹，但通过 git 来做会更好。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-09T21:27:15.677

克隆`git-svn`存储库后，您可以通过使用`git svn init`与创建原始存储库相同的参数运行来获取所需的信息。根据[WebKit 的`git-svn`说明](http://trac.webkit.org/wiki/UsingGitWithWebKit)，诀窍是用来`update-ref`让自己进入一个可以快进到 SVN 树顶端的状态：

```
git svn init -T trunk http://svn.webkit.org/repository/webkit
git update-ref refs/remotes/trunk origin/master 
```

传递给的确切参数`git svn init`取决于您的 Subversion 存储库和`git-svn`克隆的设置。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T13:39:26.937

不幸的是，没有，因为在执行克隆时`git-clone`不会克隆`git-svn`信息。[您可以在此处](http://lovebug356.blogspot.com/2009/01/cloning-git-svn-clone.html)阅读有关情况的更多信息。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-10-07T10:46:33.077

这是可能的，但是您必须进行一些不同的设置。以下是我们在[numpy](http://projects.scipy.org/numpy/wiki/GitMirror)上的操作方式——repo是使用[git-svn-automirror创建的](http://github.com/pv/git-svn-automirror)

您可以查看函数 _git_update_mirror 以了解如何手动执行

* * *

## 回答 #4

> 赞同：-1
> 
> 时间：2009-04-09T21:06:23.887

svn 信息只不过是文件中的几位信息`.git/config`，对吧？你可以用手把它们塞进去，然后就可以开始了。

# image - 是否有一个所见即所得的文本编辑器，允许从网页中剪切和粘贴图像

> ID：734258
> 
> 赞同：2
> 
> 时间：2009-04-09T13:36:06.960
> 
> 标签：image, drag-and-drop, web-based

我需要一个基于 Web 的编辑器，它允许用户在屏幕上放置图像，它会上传图像然后引用它。有没有编辑可以填补这个账单。我主要需要它在 IE6 中工作，因为这就是这里 IT 认为的标准浏览器。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T13:44:57.623

我不知道有一个编辑器这样做，但我认为你不需要在编辑器中这样做。上传 HTML 时，您可以“直接”浏览它并查找`img src`指向非本地（相对于您的应用程序）地址的任何属性并将其上传。

如果您在服务器端执行此操作，它将仅适用于`http://`图像 url，而不适用于用户在本地存储的图像（例如`file:///`-protocol）。我不确定您是否可以获取这些文件，它需要是客户端 JavaScript 解决方案，它以某种方式将引用图像的二进制图像数据获取到服务器。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T13:59:57.573

它几乎肯定必须用 Flash 或 Java 之类的东西编写。

[这是扩展 TinyMCE 编辑器的一些 Java 代码的链接](http://tinymce.moxiecode.com/punbb/viewtopic.php?id=5585)，它可能会执行您想要的操作

一些工作始于一个名为[JavaPaste](http://twiki.org/cgi-bin/view/Plugins/JavaPasteAddOn)的 Twiki 插件，如果您找不到其他任何东西，它可能会作为一个有用的起点。

# c++ - 使用 OpenGL，如何正确使用 gluOrtho2D 和默认投影？

> ID：734259
> 
> 赞同：3
> 
> 时间：2009-04-09T13:36:13.997
> 
> 标签：c++, opengl

我正在尝试将 gluOrtho2D 与 glutBitmapCharacter 一起使用，以便我可以在屏幕上渲染文本以​​及我的 3D 对象。但是，当我使用 glOrtho2D 时，我的 3D 对象消失了；我认为这是因为我没有将投影设置回 OpenGL/GLUT 默认值，但我不确定那是什么。

无论如何，这是我用来呈现文本的功能：

```
void GlutApplication::RenderString(Point2f point, void* font, string s)
{
    glMatrixMode(GL_PROJECTION);
    glPushMatrix();
    glLoadIdentity();
    gluOrtho2D(0.0, WindowWidth, 0.0, WindowHeight);

    glMatrixMode(GL_MODELVIEW);
    glPushMatrix();
    glLoadIdentity();

    glDisable(GL_TEXTURE);
    glDisable(GL_TEXTURE_2D);

    glRasterPos2f(point.X, point.Y);
    for (string::iterator i = s.begin(); i != s.end(); ++i)
    {
        glutBitmapCharacter(font, *i);
    }

    glEnable(GL_TEXTURE);
    glEnable(GL_TEXTURE_2D);

    glMatrixMode(GL_MODELVIEW);
    glPopMatrix();

    glMatrixMode(GL_PROJECTION);
    glPopMatrix();
} 
```

并且，渲染函数类似于：

```
glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);

glPushMatrix();
glLoadIdentity();

// Do some translation here.

// Draw some 3D objects.

glPopMatrix();

// For some reason, this stops the above from being rendered,
// where the camera is facing (I assume they are still being rendered).
Point2f statusPoint(10, 10);
RenderString(statusPoint, GLUT_BITMAP_9_BY_15, "Loading..."); 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T13:50:19.420

当我需要类似的东西时，我没有尝试推送和弹出矩阵状态，而是每次都从头开始设置：

```
void set2DMode()
{
        glMatrixMode(GL_PROJECTION);
        glLoadIdentity();
        glOrtho(0, w, h, 0, -1, 1);

        glMatrixMode(GL_MODELVIEW);
        glLoadIdentity();
}

void set3DMode()
{
        glMatrixMode(GL_PROJECTION);
        glLoadIdentity();
        gluPerspective(50.0, (float) w / h, 1, 1024);
        gluLookAt(0, 0, 400, 0, 0, 0, 0.0, 1.0, 0.0);

        glMatrixMode(GL_MODELVIEW);
        glLoadIdentity();
}

void cb_display(void)
{
        set3DMode();
        // draw some stuff

        set2DMode();
        // draw some text
        // and some more
 } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T13:50:29.593

你的代码看起来不错。很可能您只是在某个地方弄乱了矩阵堆栈。

我建议你检查一下你是否忘记了`glPopMatrix`某个地方。为此，您可以通过`glGet(GL_MODELVIEW_STACK_DEPTH)`. 其他矩阵堆栈的吸气剂也可用。

您还可以查看当前矩阵。打电话`glGetFloatv(GL_MODELVIEW_MATRIX, Pointer_To_Some_Floats)`去拿。每次设置模型视图或投影矩阵时，都可以打印出浮点数。这样，您应该能够找出哪个矩阵不规则地最终成为当前矩阵。

这应该为您提供足够的线索来找到错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T16:24:48.353

调用 RenderString() 函数后，您处于投影模式。不确定这是否会破坏任何东西，但它对我来说很突出。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-09-20T18:22:17.220

我同意安德烈的观点。基本上，您要做的是：在 glClear 使用投影矩阵之后的第二帧和所有下一帧，因为最后一个操作是 glMatrixMode(GL_PROJECTION); 在 RenderString 的末尾。（至少查看您发布的代码）。

尝试在 glClear 之后放置：glMatrixMode(GL_MODELVIEW)。

# javascript - Mozilla Firefox 与 Javascript 和 Flash 通信的问题

> ID：734262
> 
> 赞同：1
> 
> 时间：2009-04-09T13:36:50.577
> 
> 标签：javascript, flash, firefox, variables, communication

我有一个显示歌曲名称列表的脚本，当用户单击“收听”按钮时，文件名将传递给加载和播放 mp3 的 Flash 播放器。这适用于 Safari 和 IE，但不适用于 Mozilla。有谁知道围绕 Mozilla 和使用 Javascript 将变量传递给 flash 并在 flash 中调用函数的任何问题。

在我的头文件中，我有 -

```
<script type="text/javascript">
var flash;
  window.onload = function() {
     if(navigator.appName.indexOf("Microsoft") != -1) {
       flash = window.flashObject;
     }else {
       flash = window.document.flashObject;
     }
  } 
```

和

```
function PassFlash($preview_mp3){
   if(navigator.appName.indexOf("Microsoft") != -1) {
      window.flashObject.SetVariable("fileToPlay", $preview_mp3);
      window.flashObject.updatePlayer();    
   }
   else {
     window.document.flashObject.SetVariable("fileToPlay", $preview_mp3);
     window.document.flashObject.updatePlayer();
  } 
```

然后我像这样嵌入swf ...

```
<object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="http://fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=8,0,0,0" name="flashObject" width="191" height="29" align="middle" id="flashObject">
    <param name="allowScriptAccess" value="sameDomain" />
    <param name="movie" value="preview.swf" />
    <param name="quality" value="high" />
    <param name="bgcolor" value="#ffffff" />
  <embed src="preview.swf" quality="high" bgcolor="#ffffff" width="191" height="29" name="flashObject" align="middle" allowScriptAccess="sameDomain" type="application/x-shockwave-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" />
</object> 
```

swf 已在所有浏览器（主要浏览器）中成功加载，但在 Firefox 中似乎没有接收到 javascript 传递的变量或函数调用。

非常感谢您提供有关您自己的经验的任何提示或故事。

斯蒂芬

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T15:01:33.417

+1 swf 对象

我认为 swfObject 允许您将 Flashvars 写入嵌入代码，其结果与硬编码 flashvars 的结果相同。我认为尝试以您的方式更改硬编码部分与尝试在 swf 已经加载后，在运行时更改 flashvars。Firefox 很可能会在访问 html 后加载 swf，而不是让 javascript 有机会更改代码。

另外，请阅读[ExternalInterface.addCallback](http://livedocs.adobe.com/flash/8/main/wwhelp/wwhimpl/common/html/wwhelp.htm?context=LiveDocs_Parts&file=00002200.html)，如果您自己编译 swf，这可能会很酷。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T14:16:23.727

在使用 javascript 与 Flash 进行通信时，我总是最容易使用[swfObject](http://code.google.com/p/swfobject/)。它只是一个简单的 javascript 库，它将嵌入 swf 并使来回通信变得容易。它也适用于所有主要浏览器。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-14T12:13:32.330

使用[swfObject](http://code.google.com/p/swfobject/)。阅读它的文档。我相信你会发现它轻而易举:)

# c++ - 如何使用 WinDbg 分析 VC++ 应用程序的故障转储？

> ID：734272
> 
> 赞同：46
> 
> 时间：2009-04-09T13:38:22.773
> 
> 标签：c++, visual-c++, windbg, crash-dumps

如何使用[WinDbg](http://en.wikipedia.org/wiki/WinDbg)分析转储文件？

* * *

## 回答 #1

> 赞同：72
> 
> 时间：2009-04-17T03:05:43.620

以下是一些可以帮助您上路的一般步骤：

首先，您必须更改编译器的设置，以便它创建 PDB 文件，即使对于发布版本也是如此。更高版本的[Visual C++](http://en.wikipedia.org/wiki/Visual_C++)编译器默认执行此操作，但在许多 Visual C++ 版本中，您必须自己执行此操作。创建程序数据库文件，然后将这些文件与应用程序的每个构建一起保存。至关重要的是，您的应用程序的每个构建都有自己的一组 PDB。例如，您不能只重用您在构建 10 中创建的相同内容来检查构建 15 生成的转储。在您的项目的整个生命周期中，您最终会得到大量的 PDB，因此请为此做好准备。

接下来，您需要能够识别生成转储文件的应用程序的确切版本。如果您正在创建自己的 MiniDump（例如通过调用[MiniDumpWriteDump()](http://msdn.microsoft.com/en-us/library/ms680360.aspx)），最简单的方法可能是简单地将 MiniDump 的文件名的一部分作为应用程序的完整版本号。您需要有一个合理的版本编号方案才能正常工作。在我的商店中，每次自动构建器创建构建时，我们都会将所有分支的构建号加一。

现在您已经从客户那里收到了转储文件，您知道创建转储的应用程序的精确版本，并且您已经找到了此构建的 PDB 文件。

现在您需要查看源代码控制的历史并找到该软件版本的源代码。最好的方法是在每次构建时将“标签”应用于分支。将标签的值设置为准确的版本号，在历史记录中很容易找到。

您几乎准备好启动 WinDbg/Visual C++：

1.  获取该版本应用程序的完整源代码树。将其放在硬盘驱动器上的单独位置，例如`c:\app_build_1.0.100`应用程序版本 1.0 build #100。
2.  获取应用程序的确切版本的二进制文件并将它们放在硬盘上的某个位置。安装该版本的应用程序以获取二进制文件可能是最简单的。
3.  将 PDB 文件放在与步骤 2 中的二进制文件相同的位置。

现在您有两种查看转储文件的选项。您可以使用[Visual Studio](http://en.wikipedia.org/wiki/Microsoft_Visual_Studio)或 WinDbg。使用 Visual Studio 更容易，但 WinDbg 更强大。大多数情况下，Visual Studio 中的功能就足够了。

要使用 Visual Studio，您只需像打开项目一样打开转储文件。打开后，“运行”转储文件（`F5`默认情况下），如果所有路径都设置正确，它将带您直接找到崩溃的代码，为您提供调用堆栈等。

要使用 WinDbg，您必须跳过几个环节：

1.  启动 WinDbg
2.  打开转储文件。( `Ctrl`+`D`默认情况下)
3.  告诉 WinDbg 去获取正确的 MicroSoft 符号文件。键入`.symfix`。这可能需要一些时间，因为它会从 Internet 上下载大量内容。
4.  告诉 WinDbg 符号（PDB 文件）在哪里。键入`.sympath+ c:\pdblocation`，用放置 PDB 文件的位置替换路径名。确保你在那里得到了加号，`.sympath`和`+`符号之间没有空格，否则你会搞砸第 3 步。
5.  告诉 WinDbg 源代码在哪里。键入`.srcpath c:\app_build_1.0.100`替换您从源代码控制获取此版本软件的代码的路径。
6.  告诉 WinDbg 分析转储文件。类型`!analyze -v`

片刻之后，如果一切配置正确，WinDbg 会直接将您带到崩溃的位置。在这一点上，你有一百万个选项可以深入挖掘应用程序的内存空间、关键部分的状态、窗口等。但这超出*了*本文的范围。

祝你好运！

* * *

## 回答 #2

> 赞同：40
> 
> 时间：2014-08-09T21:02:21.337

（请参阅下面的“转储”部分）

## 使用WinDbg的基础教程和演示

*   [安装和配置 WinDbg（Windows 调试工具）](http://www.sysads.co.uk/2012/05/installing-and-configuring-windbg-windows-debug-tools%E2%80%8F/)
*   [Mike Taulty - WinDBG 的一句话](http://mtaulty.com/communityserver/blogs/mike_taultys_blog/archive/2004/08/03/4656.aspx)
*   [WinDbg 教程](http://blogs.msdn.com/b/iliast/archive/2006/12/10/windbg-tutorials.aspx)
*   [Windows 调试器：第 1 部分：WinDbg 教程](http://www.codeproject.com/Articles/6084/Windows-Debuggers-Part-1-A-WinDbg-Tutorial)

## “启动”/附加 WinDBG 的不同方式

*   [使用 Windbg 开始调试（包括如何调试 .msi）](http://blogs.msdn.com/b/emreknlk/archive/2011/03/27/start-debugging-with-windbg.aspx)
*   [如何调试 Windows 服务](http://bugslasher.net/2010/10/14/how-to-debug-a-windows-service/)
*   [设置 Windows 调试](http://blogs.msdn.com/b/jankrivanek/archive/2012/10/26/setting-up-windows-debugging.aspx)

## 工作区

了解工作区的工作原理...

*   [Pimp up your debugger：为 windbg 调试创建自定义工作区](http://blogs.msdn.com/b/tess/archive/2008/04/18/pimp-up-your-debugger-creating-a-custom-workspace-for-windbg-debugging.aspx?Redirected=true)
*   [揭示工作区在 WinDbg 中的工作方式](http://blogs.msdn.com/b/ntdebugging/archive/2010/05/07/uncovering-how-workspaces-work-in-windbg.aspx)

## 命令树

“cmdtree”允许您定义调试器命令的“菜单”，以便轻松访问常用命令，而无需记住简洁的命令名称。

您不必将所有命令定义放入同一个 cmdtree 文本文件中......如果您愿意，您可以将它们分开并加载多个（然后它们会获得自己的窗口）。

*   [惊人的助手 .cmdtree](http://voneinem-windbg.blogspot.co.uk/2008/09/amazing-helper-cmdtree.html)
*   [如何在 WinDBG 中启动时制作 cmdtree 窗口停靠](https://stackoverflow.com/questions/2655168/how-do-i-make-a-cmdtree-window-dock-at-startup-in-windbg)
*   [使用 .cmdtree 可以更轻松地在 windbg 中调试 .net 转储](http://blogs.msdn.com/b/tess/archive/2008/09/18/making-it-easier-to-debug-net-dumps-in-windbg-using-cmdtree.aspx)
*   [Microshaoft Cmdtree](http://www.cnblogs.com/Microshaoft/p/3183173.html)
*   [特殊命令——使用 .cmdtree 从自定义用户界面执行命令](http://blogs.msdn.com/b/debuggingtoolbox/archive/2008/09/17/special-command-execute-commands-from-a-customized-user-interface-with-cmdtree.aspx)

## 启动脚本

您可以在命令行中使用 -c 选项在启动 WinDBG 时自动运行 WinDBG 脚本。

提供了打开 DML（调试器标记语言）模式、加载特定扩展、设置 .NET 异常断点、设置内核标志的机会（例如，在内核调试时，您可能需要更改 DbgPrint 掩码，以便查看跟踪信息......ed nt !Kd_DEFAULT_Mask 0xffffffff)，加载 cmdtrees 等。

*   [http://yeilho.blogspot.co.uk/2012/10/windbg-init-script.html](http://yeilho.blogspot.co.uk/2012/10/windbg-init-script.html)
*   [控制 WinDBG](http://blogs.msdn.com/b/carloc/archive/2007/10/14/take-control-over-windbg.aspx)

一个示例脚本：

```
$$ Include a directory to search for extensions
$$ (point to a source controlled or UNC common directory so that all developers get access)
.extpath+"c:\svn\DevTools\WinDBG\Extensions"
$$ When debugging a driver written with the Windows Driver Framework/KMDF
$$ load this extension that comes from the WinDDK.
!load C:\WinDDK\7600.16385.1\bin\x86\wdfkd.dll
!wdftmffile C:\WinDDK\7600.16385.1\tools\tracing\i386\wdf01009.tmf
$$ load some extensions
.load msec.dll
.load byakugan.dll
.load odbgext.dll
.load sosex
.load psscor4
$$ Make commands that support DML (Debugger Markup Language) use it
.prefer_dml 1
.dml_start
$$ Show NTSTATUS codes in hex by default
.enable_long_status 1
$$ Set default extension
.setdll psscor4
$$ Show all loaded extensions
.chain /D
$$ Load some command trees
.cmdtree c:\svn\DevTools\WinDBG\cmdtree\cmdtree1.txt
.cmdtree c:\svn\DevTools\WinDBG\cmdtree\cmdtree2.txt
$$ Show some help for the extensions
!wdfkd.help
!psscor4.help
.help /D 
```

## 命令备忘单

*   [故障转储分析海报 v3.0](http://www.dumpanalysis.org/CDAPoster.html)
*   [SOS 备忘单 (.NET 2.0/3.0/3.5)](http://blogs.msdn.com/b/alejacma/archive/2009/06/30/sos-cheat-sheet-net-2-0-3-0-3-5.aspx)
*   [WinDbg 备忘单（开发艺术）](http://theartofdev.wordpress.com/windbg-cheat-sheet/)
*   [WinDbg 内核模式扩展命令抽认卡](http://quizlet.com/12326943/windbg-kernel-mode-extension-commands-flash-cards/)

## 扩展

“扩展”允许您扩展 WinDBG 中支持的命令/功能范围。

*   [bigLasagne (bldbgexts & blwdbgue)](http://dbgext.biglasagne.com/index.html)
    - 汇编语法高亮和驱动映射工具）

*   [BigLib 数字阅读器](http://rcejunk.blogspot.co.uk/2009/07/windbg-extension-to-read-biglib-numbers.html)

*   [Byakugan](https://community.rapid7.com/community/metasploit/blog/2008/08/20/byakugan-windbg-plugin-released)
    - 检测反调试方法、vista 堆可视化/仿真、跟踪内存中的缓冲区

*   [呼叫流分析器 + KnExt](http://blog.naver.com/PostView.nhn?blogId=gloryo&logNo=110178730959)

*   [CmdHist](http://www.osronline.com/article.cfm?article=547)
    - 记录您在调试会话中执行的每个命令，以便您可以轻松地重新执行

*   [Core Analyzer](http://core-analyzer.sourceforge.net/index_files/Page335.html)
    - 检查堆结构是否损坏，检测线程共享的对象等

*   [dom WinDBG 扩展](http://www.denismo.name/domdbg/WebPages/MainPage.htm)
    - (!stlpvector, !idt, !unhex, !grep 等)

*   [dumppe](https://code.google.com/p/dumppe/)
    - 从内存中转储 PE 文件

*   [图像查看器扩展 (Vladimir Vukićević)](http://blog.vlad1.com/2010/07/18/windbg-image-viewer-extension/)

*   [Intel UEFI Development Kit Debugger Tool](http://www.intel.com/content/www/us/en/architecture-and-technology/unified-extensible-firmware-interface/intel-uefi-development-kit-debugger-tool.html)
    - 调试 UEFI 固件

*   [泄漏陷阱](https://code.google.com/p/leaktrap/)
    - GDI/USER 句柄跟踪器，以帮助进行泄漏检测

*   [Mona](http://redmine.corelan.be/projects/mona)（需要 PyKD）
    - 帮助高级分析/发现漏洞的一组命令

*   [MSEC](http://msecdbg.codeplex.com/)
    - 提供自动崩溃分析和安全风险评估

*   [narly](https://code.google.com/p/narly/)
    - 列出有关已加载模块的信息，例如是否使用 SafeSEH、ASLR、DEP、/GS（缓冲区安全检查）

*   [netext](http://www.infoq.com/news/2013/11/netext) (Rodney Viana)
    - (!wservice - 列出 WCF 服务对象，!wconfig - 显示 .config 行，!whttp - 列出 HttpContexts，!wselect/!wfrom - 支持类似 SQL 的数组查询)

*   [ODbgExt](http://odbgext.codeplex.com/)
    - 打开调试器扩展

*   [OllyMigrate](http://low-priority.appspot.com/ollymigrate/)
    - 将调试对象传递给另一个调试器而不重新启动

*   [Psscor2](http://www.microsoft.com/en-gb/download/details.aspx?id=1073)
    - SOS 的超集，用于协助调试 .NET 2.0 托管代码

*   [Psscor4](http://www.microsoft.com/en-us/download/details.aspx?id=21255)
    - SOS 的超集，用于协助调试 .NET 4 托管代码

*   [PyDBGExt](http://sourceforge.net/projects/pydbgext/)
    - 允许使用 python 脚本

*   [PyKD](http://pykd.codeplex.com/)
    - 允许使用 Python 编写 WinDBG 脚本

*   [sdbgext (Nynaeve)](http://www.nynaeve.net/?p=6)
    -(!valloc, !vallocrwx, !heapalloc, !heapfree, !remotecall, !remotecall64, !loaddll, !unloaddll, !close, !killthread, !adjpriv, !ret)

*   [SieExtPub](http://msdn.microsoft.com/en-us/library/windows/hardware/ff556890%28v=vs.85%29.aspx)
    -legacy 扩展...现在内置于 ext.dll 中的 WinDBG

*   [SOSEX](http://www.stevestechspot.com/SOSEXV40NowAvailable.aspx)
    - 更多帮助调试托管 NET 2.0 或 4.0 代码的命令

*   [SPT/SDBGExt2 (Steve Niemitz)](http://www.steveniemitz.com/Blog/post/SPT-A-WinDBG-extension-for-debugging-NET-applications.aspx)
    - (!DumpHttpContext, !DumpASPNetRequests, !DumpSqlConnectionPools, !DumpThreadPool 等)

*   [Uniqstack](http://www.osronline.com/OsrDown.cfm/apexts.zip?name=apexts.zip&id=559)
    - 调试器扩展的源代码（需要 OSR 在线帐户才能访问它）

*   [viscope](https://code.google.com/p/viscope/)
    - 代码覆盖率图

*   [等待链遍历/wct.dll（Codeplex 调试扩展](http://debuggingextensions.codeplex.com/)
    - 显示应用程序线程的等待链（帮助查找[死锁](http://joeduffyblog.com/2006/07/06/new-to-vista-deadlock-detection/)）

*   [windbgshark](https://code.google.com/p/windbgshark/)
    - 集成 Wireshark 协议分析器以启用 VM 流量操作和分析

*   [WinDBG 扩展 (Sasha Goldstein)](https://github.com/goldshtn/windbg-extensions)
    - Tracer、WCT、heap_stat、bkb、traverse_map、traverse_vector)

*   [WinDBG Highlight](http://hi.baidu.com/linx2008/item/0bee3aedc6d49e275b2d6441) (ColorWindbg.dll) [使用谷歌翻译翻译链接]
    - asm 语法高亮

## 编写你自己的扩展

*   [行业工具：第四部分 - 开发 WinDbg 扩展 DLL](http://blogs.msdn.com/b/sqlblog/archive/2009/12/30/tools-of-the-trade-part-iv-developing-windbg-extension-dlls.aspx)
*   [调试器扩展的基础知识：短期努力，长期收益](http://www.osronline.com/custom.cfm?name=articlePrint.cfm&id=559)

## 使用 WinDBG 调试托管代码

*   [打破异常](http://blogs.msdn.com/b/alejacma/archive/2009/08/24/managed-debugging-with-windbg-breaking-on-an-exception-part-1.aspx)
*   [打破特定的 CLR 异常](http://blogs.msdn.com/b/rihamselim/archive/2012/11/15/windbg-breaking-on-specific-clr-exception.aspx)
*   [在 Windbg 中调试 .Net 框架源代码](http://naveensrinivasan.com/2010/03/10/debugging-net-framework-source-code-within-windbg/)
*   [使用 Windbg 调试托管代码中的异常](http://blogs.msdn.com/b/kristoffer/archive/2007/01/03/debugging-exceptions-in-managed-code-using-windbg.aspx)
*   [使用 WinDbg 和 SOS.dll 调试托管代码](http://blogs.msdn.com/b/rextang/archive/2007/07/24/4026494.aspx)
*   [使用 WinDbg 进行调试。应用程序中的死锁。](http://blog.scriptico.com/04/debugging-with-windbg-deadlocks-in-applications/)
*   [使用 WINDBG 进行托管调试。简介与索引](http://blogs.msdn.com/b/alejacma/archive/2009/07/07/managed-debugging-with-windbg-introduction-and-index.aspx)
*   [在 Windbg 中为启动时崩溃的应用程序设置 .NET 断点](http://blogs.msdn.com/b/tess/archive/2008/06/05/setting-net-breakpoints-in-windbg-for-applications-that-crash-on-startup.aspx)

## 脚本（C#、PS、Python、WinDBG）

*   [KDAR (Kernel Debugger Anti Rootkit)](http://kdar.codeplex.com/)
    - WinDBG 脚本的集合

*   [Sysnative BSOD 脚本/处理应用程序](http://www.sysnative.com/forums/sysnative-news-and-announcements/2486-sysnative-blue-screen-of-death-scripts.html)

*   [WinDBG 脚本库](http://www.woodmann.com/collaborative/tools/index.php/WinDbg_Script)
    - WinDBG 脚本的集合

*   [编写 MDbg 和 DbgHostLib 脚本](http://blog.diniscruz.com/2012/11/scripting-mdbg-and-dbghostlib.html)
    - 允许托管代码编写托管调试器 (MDBG) 和 DbgEng 脚本

*   [ExtCS](http://extcs.codeplex.com/)
    - 允许通过 C# 脚本控制 WinDBG

*   [PowerDBG](http://powerdbg.codeplex.com/)
    - 允许通过 Powershell 脚本控制 WinDBG

*   [Pykd](http://pykd.codeplex.com/)
    - 允许通过 Python 脚本控制 WinDBG

*   [windbglib](http://redmine.corelan.be/projects/windbglib)
    - 围绕 WinDBG 的 pykd 扩展的 python 包装库，模仿 immlib（因此您可以使用最初为 Immunity Debugger 编写的脚本）

## 使用 dbgeng.dll API/WinDBG 工具的调试器/工具

*   [一个简单的基于 Dbgeng 的用户模式调试器](http://www.woodmann.com/forum/entry.php?246-A-Simple-Dbgeng-Based-User-Mode-Debugger)
*   [Acorns.Debugging NET 死锁检测器](http://corneliutusnea.wordpress.com/2008/07/30/acornsdebugging-the-net-deadlock-detector/)（使用 cdb.exe）（[下载](http://web.archive.org/web/20090913063343/http://www.acorns.com.au/files/ACorns.Debugging.DeadlockTests.1.0.1.zip)）
*   [CLR 托管调试器](http://www.microsoft.com/en-us/download/details.aspx?id=2282)(MDBG)
*   [DbgHost - 如何控制调试引擎](http://codenasarre.wordpress.com/2011/06/14/how-to-control-a-debugger-engine/)
*   [调试诊断工具 v1.2](http://www.microsoft.com/en-us/download/details.aspx?id=26798) (DebugDiag), [Ver 2.0](http://www.microsoft.com/en-us/download/details.aspx?id=40336) + [DebugDiag 博客](http://blogs.msdn.com/b/debugdiag/)
*   [Dynamorio](http://dynamorio.org/) - 可以与 WinDBG 交互的动态二进制检测工具
*   [IDA](https://www.hex-rays.com/products/ida/index.shtml) + [WinDBG 插件](https://www.hex-rays.com/products/ida/support/idadoc/1520.shtml)
*   [图形界面 WinDBG](http://www.woodmann.com/collaborative/tools/index.php/GUI_WinDbg)
*   [LeakShell](http://codenasarre.wordpress.com/2011/05/18/leakshell-or-how-to-automatically-find-managed-leaks/)（查找托管泄漏）
*   [mdbglib - 托管调试 API](http://mdbglib.codeplex.com/)
*   [PyDbgEng](http://pydbgeng.sourceforge.net/)
    - Windows 调试引擎的 python 包装器
*   [SOSNET](https://bitbucket.org/grozeille/sosnet/wiki/Home) - 专注于使用 SOS 扩展并支持 C# 脚本的 WinDBG Fork/替代外壳
*   [SOSNET O2 fork](http://blog.diniscruz.com/2012/11/windbg-cdb-sun-of-strike-and-util-start.html) - 将 Rosyln 用于 C# REPL（读取-评估-打印-循环）脚本引擎的 SOSNET 的分支
*   [VDB/Vivisect](http://visi.kenshoto.com/viki/MainPage) (kenshoto) - 提供基于 WinDBG 的跨平台调试 API
*   [WinAppDbg](http://winappdbg.sourceforge.net/) + [Heappie-WinAppDbg](http://breakingcode.wordpress.com/2012/03/18/heappie-winappdbg/)
*   [编写一个基本的 Windows 调试器](http://www.codeproject.com/Articles/43682/Writing-a-basic-Windows-debugger)

## 为事后分析生成故障转储文件的不同方法

*   [调试诊断 2.0](http://blogs.msdn.com/b/chaun/archive/2013/11/12/steps-to-catch-a-simple-crash-dump-of-a-crashing-process.aspx)
*   [转储备忘单](http://nicholasconnolly.com/?p=293)
    - 包括如何从 Hyper-V、VMWare ESX 和 XenServer VM 生成转储。
*   [思杰系统转储](http://support.citrix.com/article/CTX111072)
*   [键盘按键组合](http://msdn.microsoft.com/en-us/library/windows/hardware/ff545499%28v=vs.85%29.aspx)
*   [MiniDumpWriteDump](http://msdn.microsoft.com/en-us/library/windows/desktop/ms680360%28v=vs.85%29.aspx)
    -（通过应用程序内的 WIN32 API 调用）。[（C# 应用程序示例）](http://brakertech.com/howto-c-generate-dump-file-on-crash/)
*   [NMI Switch](http://support.microsoft.com/kb/927069)，或[（此处）](http://support.microsoft.com/kb/927069/en-us)
    （生成 NMI 的基于硬件的功能......通常在高端服务器上找到，例如[HP](http://h20195.www2.hp.com/V2/GetPDF.aspx/4AA4-7853ENW.pdf)，或者您可以获得附加 PCI 卡[“通用 PCI Dump Switch”](http://www.dpie.com/manuals/pcbus/connecttech/manual_DumpSwitch-v.001.pdf)）。微软 NMI 技术[背景](http://archive.is/ENCii)。
*   [过程转储](http://technet.microsoft.com/en-gb/sysinternals/dd996900.aspx)
*   [系统|高级系统设置|启动和恢复](http://www.sevenforums.com/tutorials/204214-dump-file-change-default-location.html)
    （[注册表信息](http://support.microsoft.com/kb/307973)），
    （[如何配置完整（完整）内存转储](http://www.symantec.com/business/support/index?page=content&id=HOWTO31321)），
    （[如何启用完整内存转储](http://www.sophos.com/en-us/support/knowledgebase/111474.aspx)），
    （[当 PC 有很多时如何在 Windows 7 上启用完整内存转储内存...通常在超过 2GB 内存时不可用](http://www.osronline.com/article.cfm?article=545)）
*   [任务管理器“创建转储文件”](http://blogs.msdn.com/b/debugger/archive/2009/12/30/what-is-a-dump-and-how-do-i-create-one.aspx)
*   [UserDump](http://support.microsoft.com/kb/253066)，[说明](http://support.microsoft.com/kb/241215)（非常旧的工具）
*   [UserModeProcessDumper](http://www.microsoft.com/en-gb/download/details.aspx?id=4060) ,[说明](http://www.symantec.com/business/support/index?page=content&id=TECH87208)
*   [Visual Studio“将转储另存为...”](http://blogs.msdn.com/b/debugger/archive/2009/12/30/what-is-a-dump-and-how-do-i-create-one.aspx)
*   [WER（Windows 错误报告....本地转储）](http://msdn.microsoft.com/en-us/library/windows/desktop/bb787181%28v=vs.85%29.aspx)
*   [WinDBG](https://github.com/Windower/Issues/wiki/Creating-crash-dumps-with-Windbg)

## 转储分析工具

*   [BlueScreenView](http://www.nirsoft.net/utils/blue_screen_view.html) - 查找在 BSOD 后由 Windows 保存的 minidump .dmp 文件，并提取有关导致崩溃的原因的信息
*   [Debug.Analyzer](http://www.debuganalyzer.net/)（可以分析转储文件，插件可以用.NET编写）
*   [SAD - 转储后简单](http://codenasarre.wordpress.com/2011/06/26/s-a-d-or-simple-after-dump/)（事后分析器）
*   [Volatility](https://code.google.com/p/volatility/) - 用于分析转储文件中记录的“内存”的框架（[备忘单](https://volatility.googlecode.com/files/CheatSheet_v2.3.pdf)）

## 转储相关工具

*   Citrix dumpcheck - 检查转储文件的一致性（看起来它已被放弃[链接](http://www.freelists.org/post/thin/KB-CTX108890-Citrix-DumpCheck-Utility-Command-Line)+[链接](http://support.citrix.com/article/CTX138159)）
*   [dumpchk](http://support.microsoft.com/kb/156280)（调试工具的一部分） - 检查转储文件的一致性
*   [MoonSols Windows Memory Toolkit](http://web.archive.org/web/20100119182120/http://windd.msuiche.net/)（以前称为[windd](http://web.archive.org/web/20100119182120/http://windd.msuiche.net/)） - 将各种原始内存转储文件转换为 WinDBG 兼容的 dmp 文件
*   [vm2dmp](http://archive.msdn.microsoft.com/vm2dmp) - Microsoft Hyper-V VM 状态到内存转储转换器
*   [vmss2core](http://kb.vmware.com/selfservice/microsites/search.do?language=en_US&cmd=displayKC&externalId=2003941) - 将 VMWare 快照文件转换为核心转储文件（[下载](https://labs.vmware.com/flings/vmss2core)），（[说明](http://www.vmware.com/pdf/snapshot2core_technote.pdf)）

## 内核调试虚拟机

*   [VMKD](http://www.nynaeve.net/?page_id=168) - 虚拟机 KD 扩展
*   [VirtualKD](http://virtualkd.sysprogs.org/) -（对托管在 VMWare/VirtualBox 中的操作系统的内核调试器支持）

## 视频

*   [.NET 破解 101 #2 - WinDbg 基础知识](http://www.youtube.com/watch?v=q-IWHHFQcXg)
*   [生产环境的 .NET 调试 (Channel9)](http://channel9.msdn.com/Series/-NET-Debugging-Stater-Kit-for-the-Production-Environment)
*   [dotnetConf - 使用 WinDbg 和 SOS 进行高级调试](http://www.youtube.com/watch?v=yVzNrz1jJHU)
*   [David Truxall “使用 WinDBG 进行调试”](http://blog.davidtruxall.com/2009/09/28/debugging-with-windbg/)
*   [Mike Taulty 调试内存泄漏](http://www.microsoft.com/uk/msdn/screencasts/screencast/102/Scenarios-Debugging-Memory-Leaks.aspx)
*   [oredev 2009 会议：使用 WinDbg 调试 .NET 应用程序](http://oredev.org/videos/debugging--net-apps-with-windbg)
*   [Pluralsight 高级 Windows 调试](http://www.pluralsight.com/training/Courses/TableOfContents/adv-win-debug-part-1)
    （以及 Pluralsight 的其他各种调试）
*   [Tess Ferrandez WinDBG (Channel9)](http://channel9.msdn.com/blogs/msdnsweden/vanliga-fel-som-grs-med-aspnet-och-hur-du-hittar-dem-med-windbg)

## 博客

一些博客（本机和托管代码调试的混合）。

*   [高级 .NET 调试](http://dotnetdebug.net/)
*   [你所有的基地都属于我们](http://blogs.microsoft.co.il/blogs/sasha/)(Sasha Goldshtein)
*   [分析-v](http://analyze-v.com/)
*   [ASP.NET 调试](http://blogs.msdn.com/b/tom/)
*   [Cyber​​iafreak](http://maheshkumar.wordpress.com/)（线程和高级 Windows 编程和调试）
*   [调试分析器.NET](http://www.debuganalyzer.net/blog.aspx)
*   [调试及超越](http://debugbeyond.blogspot.co.uk/)
*   [在线调试专家杂志](http://www.debuggingexperts.com/)
*   [调试工具箱](http://blogs.msdn.com/b/debuggingtoolbox/)（Windbg 脚本、调试和故障排除工具和技术，可帮助您隔离软件问题。）
*   [解密我的世界](http://blogs.msdn.com/b/alejacma/)
*   [greggm 的网络日志](http://blogs.msdn.com/b/greggm/)
*   [张俊峰的Windows编程笔记](http://blogs.msdn.com/b/junfeng/)
*   [克里斯托弗的花絮](http://blogs.msdn.com/b/kristoffer/)
*   [Mark Russinovich 的博客](http://blogs.msdn.com/b/jmstall/)
*   [Mike Stalls .NET 调试博客](http://blogs.msdn.com/b/jmstall/)
*   [纳文的博客](http://naveensrinivasan.com/category/windbg/)
*   [永远不要怀疑你的调试器 (Carlo)](http://blogs.msdn.com/b/carloc/)
*   [黑暗角落的笔记](http://blogs.msdn.com/b/dougste/archive/tags/debugging/)
*   [Ntdebugging 博客](http://blogs.msdn.com/b/ntdebugging/)（Microsoft 全球升级服务团队）
*   [尼奈芙。Windows 调试和逆向工程历险记](http://www.nynaeve.net/)
*   [现场 PFE 开发人员说明](http://blogs.msdn.com/b/pfedev/)
*   [Visual Studio 调试器团队](http://blogs.msdn.com/b/debugger/)
*   [Volker von Einem 的 WinDbg](http://voneinem-windbg.blogspot.co.uk/)

## 高级文章和教程资源

*   [WinDbg 中的高级调试技术](http://sourceforge.net/projects/windbguncovered/)
*   [MS.Net 和 Windows 的调试应用程序（Powerpoint 幻灯片）](http://www.lcs.syr.edu/faculty/fawcett/handouts/testingseminar/)
*   [使用 WinDbg 调试 STL 容器](http://blogs.msdn.com/b/ambrosew/archive/2013/01/14/debugging-stl-containers-with-windbg-prolog.aspx)
*   [调试教程 1-7 (CodeProject-Toby Opferman)](http://www.codeproject.com/Articles/6469/Debug-Tutorial-Part-1-Beginning-Debugging-Using-CD)
*   [调试.tv](http://www.debugging.tv/)
*   [开发者 WinDBG 标记文章](http://browse.develop.com/cnsign/windbg/)
*   [傅博士的安全博客 - 恶意软件分析教程 - 逆向工程方法](http://fumalwareanalysis.blogspot.co.uk/p/malware-analysis-tutorials-reverse.html)
*   [漏洞利用编写教程第 5 部分：调试器模块和插件如何加速基本漏洞利用开发](http://www.corelan.be:8800/index.php/2009/09/05/exploit-writing-tutorial-part-5-how-debugger-modules-plugins-can-speed-up-basic-exploit-development/)
*   [狩猎 Rootkit](http://www.slideshare.net/frankboldewin/hunting-rootkits-with-windbg)
*   [使用 Dell Windows Debugger Utility (DWDU) 远程调试 Microsoft Windows Server OS 内核](http://freedownloadb.net/pdf/remote-microsoftr-windows-server-os-kernel-debugging-using-29667909.html)（[DELL(TM) Windows(R) Debugger Utility 1.1 自述文件](ftp://ftp.dell.com/FOLDER00634762M/1/readme_DWindbg_A00.txt)）

## 替代调试器

*   [Bokken](http://inguma.eu/projects/bokken/files) - ( [Inguma](http://ingumadev.blogspot.com.es/2012/01/bokken-16-is-more-stable-and-easier-to.html) ) (雷达的 GUI)
*   [错误数据库](http://pespin.w.interia.pl/)
*   [Debug++](http://www.turboirc.com/debugpp/)（尚未发布）
*   [调试](http://web.vip.hr/inga.vip/)
*   [变色环 0 调试器](http://ai222.narod.ru/discoloured.html)（[下载](http://ai222.narod.ru/discoloured/108.zip)）
*   [edb](http://codef00.com/projects#debugger) (Linux)
*   [FDBG](http://fdbg.x86asm.net/)
*   [GoBug](http://www.goprog.com/)
*   [Hades（具有反调试器检测策略的 Ring 3 调试器）](https://github.com/jnraber/Hades)
*   [Hopper](http://www.hopperapp.com/)（Linux、OSX 和 Windows）（当前未实现 Windows 调试）
*   [超数据库](https://code.google.com/p/hyperdbg/)
*   [IDA 调试器](https://www.hex-rays.com/products/ida/debugger/)
*   [免疫调试器](http://www.immunitysec.com/products-immdbg.shtml)
*   [纳米石](https://github.com/zer0fl4g/Nanomite)
*   [黑曜石（非侵入式调试器）](http://www.deneke.biz/deneke/obsidian/)
*   [OllyDBG](http://www.ollydbg.de/)
*   [PE浏览](http://www.smidgeonsoft.prohosting.com/pebrowse-pro-interactive-debugger.html)
*   [RaceVB6](http://www.racevb6.com/)（VB6 P 代码调试器）
*   [雷达](http://radare.nopcode.org/)
*   [radare2ui](http://locklabs.com/?Products)（雷达的图形用户界面）
*   [Rasta Ring 0 调试器](http://web.archive.org/web/20120702124850/http://rr0d.droids-corp.org/)(RR0D)
*   [Syser 内核调试器](http://www.sysersoft.com/)
*   [TRW 2000](http://www.softpedia.com/get/Programming/Debuggers-Decompilers-Dissasemblers/TRW.shtml)（非常旧的调试器，大约 W9x）+ [dions 插件存档](http://www.freewebz.com/daner/trw.htm)
*   [VisualDux 调试器](http://www.duxcore.com/index.php/prod/visual-duxdebugger/overview)
*   [Wintruder](http://www.woodmann.com/collaborative/tools/images/Bin_Wintruder_2008-10-24_22.21_wintruder.zip)（可扩展调试器）
*   [WKTVDebugger](http://web.archive.org/web/20120205204128/http://members.fortunecity.com/blackfenix/wktvbdebug)（Visual Basic P-Code 的调试器）（[下载](http://www.woodmann.com/collaborative/tools/images/Bin_Whiskey_Kon_Tequilla_VB_P-Code_Debugger_2007-12-28_8.57_WKTDBG13e.zip)）
*   [x64_dbg](https://bitbucket.org/mrexodia/x64_dbg)
*   [Zeta 调试器](http://zeta-debugger.software.informer.com/)

## 其他链接

*   [协作 RCE 工具库](http://www.woodmann.com/collaborative/tools/index.php/Category:Debuggers)
    - 大量的调试器和系统级工具
*   [cr4zyserb](http://deroko.phearless.org/index.html)
    - 大量插件和其他调试工具
*   [How to Write a Windows Debugger References (Devon Straw)](http://devonstrawntech.tumblr.com/post/15878429193/how-to-write-a-windows-debugger-references)
    - 大量链接为您提供了您想要编写自己的调试器所需的详细信息，例如 PDB 文件格式、.DMP 文件格式、PE 文件结构、如何记录堆栈痕迹等等等等。
*   [Tuts4You](http://tuts4you.com/)
    - 解包器、IDA、OllyDBG、Immunity Debugger 插件等。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-04-09T16:23:22.210

这是一个非常广泛的问题。

1.  第一步是将转储文件加载到 WinDbg 实例中。
2.  接下来，您需要确保已设置符号。
3.  最后，您可以运行该命令`!analyze -v`以对其执行基本分析。您需要为您的代码提供可用的符号信息，以使转储文件有价值。

*[内存转储、软件跟踪、调试、恶意软件、受害者软件和情报分析门户网站](http://www.dumpanalysis.org/)*对我来说非常有用。我也很喜欢这本书， Mario Hewardt 和 Daniel Pravat 的*[Advanced Windows Debugging](https://rads.stackoverflow.com/amzn/click/com/0321374460)*。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-11T04:27:31.447

Tess Ferrandez 有一套[很棒的基础教程和实验](http://blogs.msdn.com/tess/pages/net-debugging-demos-information-and-setup-instructions.aspx)，可以帮助您开始使用 Windbg。我强烈推荐他们。

# asp.net-mvc - ASP.NET MVC：路由中的命名空间

> ID：734273
> 
> 赞同：6
> 
> 时间：2009-04-09T13:38:26.207
> 
> 标签：asp.net-mvc, routing, namespaces

我有一个小问题，我找不到有关 MapRoute 的命名空间参数的任何文档。谁能解释我应该如何使用它？

我想将**~/Controllers/Projects/ProjectController.cs**映射到这个 url **~/Projects/但我在****~/Controllers/Projects**中还有其他控制器，我想映射到其他 URL。所以我需要为这些 URL 添加一个命名空间。如何？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T13:47:32.830

namespaces 参数允许您指定基础结构应在何处搜索其他控制器类型，默认情况下，mvc 将搜索正在执行的程序集（站点项目）中的所有类，而那些实现 IController 的类将成为候选者。基本上，您可以将控制器放入如果它们是 asp.net mvc 项目的一部分，则可以有尽可能多的嵌套文件夹。

namespaces 参数的主要用途是如果要将控制器类存储在外部程序集中，在这种情况下，您可以指定这些控制器所在的命名空间。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T13:53:42.283

我不确定这是否是你想要的。

[http://haacked.com/archive/2008/11/04/areas-in-aspnetmvc.aspx](http://haacked.com/archive/2008/11/04/areas-in-aspnetmvc.aspx)

# sql-server - 动态 SQL Server 问题

> ID：734275
> 
> 赞同：0
> 
> 时间：2009-04-09T13:38:36.080
> 
> 标签：sql-server, tsql, dynamic-sql

我想创建动态 SQL 代码来自动创建表复制。

我坚持如何使以下代码动态化，以便可以传入 SQL 变量并在代码中使用它们。我现在帮助自己搜索和更换`'TODO:'`零件，这不是很好......这是代码：

```
DECLARE @sql VARCHAR(MAX)
SET @sql = ''

SELECT
  @sql = @sql + 
         'exec sp_addarticle @publication = ''TODO:TREP_PUBLICATION_NAME'',@article = N''' + 
         name + 
         ''', @source_owner = N''dbo'', @source_object = N''' + 
         name + 
         ''', @type = N''logbased'', @description = N'''', @creation_script = N'''', @pre_creation_cmd = N''delete'', @schema_option = 0x0000000000000000, @identityrangemanagementoption = N''none'', @destination_table = N''' + 
         name + 
         ''', @destination_owner = N''dbo'', @status = 8, @vertical_partition = N''false'', @ins_cmd = N''SQL'', @del_cmd = N''SQL'', @upd_cmd = N''SQL'''
FROM
  TODO:PUBLICATION_DB.sys.tables
WHERE
  type      = 'U'
  AND name IN (
    SELECT 
      name
    FROM
      OPENROWSET('SQLOLEDB', 'TODO:SUBSCRIBER_SERVER';
                 'TODO:SUBSCRIBER_LOGIN';
                 'TODO:SUBSCRIBER_PASSWORD', 'select * from TODO:SUBSCRIBER_DB.sys.tables where type=''U''')
  )
  AND name IN (
    SELECT
      TABLE_NAME
    FROM
      TODO:PUBLICATION_DB.INFORMATION_SCHEMA.TABLE_CONSTRAINTS
    WHERE
      TODO:TABLE_NAME_FILTER
  )

EXEC(@Sql) 
```

一个问题是我需要动态 SQL 块内的动态 SQL。如果有人可以帮助我使用变量转换此代码，我将不胜感激！

谢谢丹尼尔

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T22:53:43.567

动态 SQL 可能不是答案——但这并不意味着您不能更容易地实现自动化和“参数化”。

换句话说，我曾经管理过一个巨大的复制拓扑，我经常不得不拆除订阅者，甚至（偶尔）重新创建发布，等等。我没有尝试生成动态查询事物并一举完成所有事情的 T-SQL，而是创建了许多 T-SQL 模板（.tql 文件），然后我可以使用这些模板填充一些参数，并且然后松开。

如果您不熟悉模板，只需观看此视频 - 它将让您快速上手：

[http://www.sqlservervideos.com/video/using-sql-server-templates](http://www.sqlservervideos.com/video/using-sql-server-templates)

这是我用来添加文章的模板类型的示例 - 正如您正在拍摄的那样：

```
/* Add Article */

USE [<database,sysname,--Default>]
GO

EXEC sp_addarticle
    @publication = N'<publicationName,sysname,--Default>',
    @article = N'<article_1,sysname,--Default>',
    @source_owner = N'dbo', 
    @source_object = N'<article_1,sysname,--Default>',
    @destination_table = N'<article_1,sysname,--Default>',
    @type = N'logbased', 
    @creation_script = null, 
    @description = null, 
    @pre_creation_cmd = N'drop', 
    @schema_option = <bitmask_1,binary(8),0x000000000000CCD3>,
    @status = 16, 
    @vertical_partition = N'false', 
    @ins_cmd = N'CALL sp_MSins_<article_1,sysname,--Default>', 
    @del_cmd = N'CALL sp_MSdel_<article_1,sysname,--Default>', 
    @upd_cmd = N'MCALL sp_MSupd_<article_1,sysname,--Default>', 
    @filter = null, 
    @sync_object = null, 
    @auto_identity_range = N'false'
GO

EXEC sp_addarticle
    @publication = N'<publicationName,sysname,--Default>',
    @article = N'<article_2,sysname,--Default>',
    @source_owner = N'dbo', 
    @source_object = N'<article_2,sysname,--Default>',
    @destination_table = N'<article_2,sysname,--Default>',
    @type = N'logbased', 
    @creation_script = null, 
    @description = null, 
    @pre_creation_cmd = N'drop', 
    @schema_option = <bitmask_2,binary(8),0x000000000000CCD3>,
    @status = 16, 
    @vertical_partition = N'false', 
    @ins_cmd = N'CALL sp_MSins_<article_2,sysname,--Default>', 
    @del_cmd = N'CALL sp_MSdel_<article_2,sysname,--Default>', 
    @upd_cmd = N'MCALL sp_MSupd_<article_2,sysname,--Default>', 
    @filter = null, 
    @sync_object = null, 
    @auto_identity_range = N'false'
GO

EXEC sp_addarticle
    @publication = N'<publicationName,sysname,--Default>',
    @article = N'<article_3,sysname,--Default>',
    @source_owner = N'dbo', 
    @source_object = N'<article_3,sysname,--Default>',
    @destination_table = N'<article_3,sysname,--Default>',
    @type = N'logbased', 
    @creation_script = null, 
    @description = null, 
    @pre_creation_cmd = N'drop', 
    @schema_option = <bitmask_3,binary(8),0x000000000000CCD3>,
    @status = 16, 
    @vertical_partition = N'false', 
    @ins_cmd = N'CALL sp_MSins_<article_3,sysname,--Default>', 
    @del_cmd = N'CALL sp_MSdel_<article_3,sysname,--Default>', 
    @upd_cmd = N'MCALL sp_MSupd_<article_3,sysname,--Default>', 
    @filter = null, 
    @sync_object = null, 
    @auto_identity_range = N'false'
GO

EXEC sp_addarticle
    @publication = N'<publicationName,sysname,--Default>',
    @article = N'<article_4,sysname,--Default>',
    @source_owner = N'dbo', 
    @source_object = N'<article_4,sysname,--Default>',
    @destination_table = N'<article_4,sysname,--Default>',
    @type = N'logbased', 
    @creation_script = null, 
    @description = null, 
    @pre_creation_cmd = N'drop', 
    @schema_option = <bitmask_4,binary(8),0x000000000000CCD3>,
    @status = 16, 
    @vertical_partition = N'false', 
    @ins_cmd = N'CALL sp_MSins_<article_4,sysname,--Default>', 
    @del_cmd = N'CALL sp_MSdel_<article_4,sysname,--Default>', 
    @upd_cmd = N'MCALL sp_MSupd_<article_4,sysname,--Default>', 
    @filter = null, 
    @sync_object = null, 
    @auto_identity_range = N'false'
GO 
```

在某些情况下......我还使用了这些模板，这些模板又具有一些嵌套/动态 SQL。但是通过使用两者，我发现我能够非常轻松地驯服一些必要的冗余任务，而不会使事情过于复杂。

# assembly - 阅读 ASM 代码的技巧？

> ID：734286
> 
> 赞同：6
> 
> 时间：2009-04-09T13:40:32.050
> 
> 标签：assembly

我有一个关于 HC12 摩托罗拉汇编代码的考试。有什么技巧可以提高我高效准确地阅读和理解 asm 代码的时间吗？我的问题：我需要很长时间才能准确地阅读 asm 代码，如果我着急，我的堆栈就会搞砸！

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-09T13:59:13.877

ASM 代码很难阅读。没有什么神奇的东西可以让破译变得更容易。

我能给你的唯一提示是：在代码中添加*大量*注释。记录一系列指令的作用。除非必须，否则不要专注于说明本身。

还可以快速练习汇编阅读技巧。如果你花一些晚上编写小玩具程序，你将能够轻松理解其他人的代码。您将培养专注于重要事物的技能，因此您需要阅读的代码更少。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T14:09:39.717

[这篇博](http://benfry.com/distellamap/)文有点相关。这是一系列 Atari 2600 游戏的可视化，它们的机器代码和数据段，用表示跳跃的线条进行说明。

这不是答案，但很有趣。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T14:03:26.927

我记得我的研究所。我在纸卷上打印了困难的汇编程序，然后我用彩线（用铅笔）覆盖了这个角色，指定程序，块，跳跃和其他东西。也许有一些摩托罗拉汇编代码“可视化”的程序，但我不知道。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T14:08:02.950

因为这是一场考试，所以像任何其他考试一样处理它——组织起来！您需要能够快速识别代码块。从中断控制流的分支/返回指令开始。这些通常表示循环或标记子例程。一旦你知道代码是如何流动的，然后弄清楚它在每个块中的作用。

# database - 如何在 mod_perl 中建立 DBIC 持久数据库连接？

> ID：734289
> 
> 赞同：2
> 
> 时间：2009-04-09T13:41:16.103
> 
> 标签：database, perl, persistence, dbi, dbix-class

我正在为我的 Web 应用程序使用 mod_perl。目前，我计划在网络上使用一个mysql数据库。在对 display_customer_transaction.cgi 的每个 CGI 请求中，我的脚本将

1.  跨网络打开数据库连接
2.  使用 SQL 语句对数据库执行查询
3.  分析从数据库中检索到的数据
4.  以 HTML 格式打印数据
5.  关闭数据库连接

经过一些分析，我意识到步骤（1）是瓶颈。因此，我希望避免为每个 CGI 请求打开和关闭数据库连接。我的愿望是，如果我的第一个 CGI 请求打开了一个数据库连接，我的第二个传入 CGI 请求（来自不同的客户端）可能会重用第一个数据库连接。

我试图用谷歌搜索“DBIX 持久数据库连接”，但几乎找不到相关结果。（编辑：那是因为它被称为 DBIC，或 DBIx::Class，而不是 DBIX。）

[我使用Apache::DBI](http://search.cpan.org/~abh/Apache-DBI/DBI.pm)进一步查找相关信息（但是，我的意图是在 DBIX 上，而不是 Apache::DBI）。有一些信息让我感到困惑：

> Apache::DBI 模块仍然有一个限制：它在每个进程的基础上保持数据库连接的持久性。

一直以来，我对 Apache 如何服务 CGI 请求的概念是

1.  Apache 将始终生成一个新进程来服务传入的新 CGI 请求。每当 Perl 解释器执行完 Perl 脚本时，进程就会死掉。

那么，如果 Apache::DBI 模块只能在每个进程的基础上保持数据库连接的持久性，我的第二个 CGI 请求如何重新使用第一个 CGI 请求打开的连接？

但回到我原来的问题。如何在 mod_perl 中建立 DBIX 持久数据库连接？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T15:36:39.640

在注销之前尝试 Apache::DBI。但是，您还想让 CGI 脚本持久化。如果您现在有 vanilla CGI 程序，您可以使用 PerlRun 或 PerlRegistry 选项使它们持久化。这与 Apache::DBI 一起应该可以完成这项工作。当然，每个子进程都有 DBI 连接，但这并非不合理。

在你放弃之前试一试。:)

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-06T20:40:49.463

Apache::DBI 改变了 DBI 模块的工作方式。假设您正在使用 DBIx::Class （您不够具体），那么它使用 DBI 模块来获取其数据库连接，所以这对您有用。

当您使用 mod_perl（并假设您的 mod_perl 设置正确）时，一个 Perl 解释器被加载到 Apache 中，您的程序也加载到其中。Apache 运行有限数量的进程来服务请求——每个进程服务多个请求。

Apache 进程最终确实会死掉并重新生成，但在此之前它们会处理许多请求。这些是 Apache::DBI 文档所指的过程；它试图说“您将一遍又一遍地重复使用相同的连接，但这并不意味着一次只打开一个连接。”

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-26T03:42:49.733

最后，基于我的每秒连接数非常低的判断，我这个时候没有使用持久连接。对于性能扩展计划，我宁愿选择 DBIx + memcache 解决方案。

# c# - c#你如何从PropertyInfo获取base.Name

> ID：734295
> 
> 赞同：2
> 
> 时间：2009-04-09T13:42:57.630
> 
> 标签：c#, propertyinfo

我正在单步执行一些代码并查看 PropertyInfo 对象并想知道如何获取它的 base.Name

[替代文字 http://www.yart.com.au/stackoverflow/propertyinfo.png](http://www.yart.com.au/stackoverflow/propertyinfo.png)

我可以在调试器中看到这一点，但我不确定如何执行此操作，因为 PropertyInfo 上没有“基础”属性

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T13:46:35.017

您可以通过 property.Name 访问此属性。

调试器显示 base.Name 的事实有点用词不当。实际上，C# EE 正在评估幕后的 property.Name。它实际上并不评估“base.Name”。

无论属性/方法是否是虚拟的，这都是正确的。原因是 CLR 调试器没有提供 EE 可以在非虚拟方法中调用虚拟方法的方法。有一些方法可以通过 relfection 调用方法来实现这种效果，但 C# 或 VB.Net 在各自的 EE 中都没有走这条路。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-09T13:45:10.760

只需使用`.Name`; `PropertyInfo`没有定义这个 - 它继承自`MemberInfo`

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T13:45:14.550

只是：

```
property.Name 
```

# tsql - SQL 查询中的多个计数

> ID：734305
> 
> 赞同：2
> 
> 时间：2009-04-09T13:45:15.657
> 
> 标签：tsql, sql-server-2000, group-by

给出以下简单的表结构：

> ```
> Departments
> PK - DeptID    DeptName
> --------------------------
> 1              Department 1
> 2              Department 2
> 3              Department 3
> 4              Department 4
> 
> Groups
> PK - GroupdID    DeptID
> --------------------------
> 1                1
> 2                1
> 3                3 
> 4                4
> 5                2
> 6                3
> 7                1
> 8                3
> 
> Inventory
> PK - ItemID    GroupID
> --------------------------
> 1              2
> 2              3
> 3              8
> 4              1
> 5              4
> 6              5
> 7              1
> 8              2
> 9              2
> 10             3
> 11             7 
> ```

有没有办法不使用子查询（这很容易），我可以获得部门列表、每个部门的组数以及每个部门的库存数？

示例输出：

```
DeptID    DeptName          GroupCount      ItemCount
-----------------------------------------------------
1         Department 1      3               6
2         Department 2      1               1
3         Department 1      3               3
4         Department 4      1               1 
```

我的直觉告诉我，让 GROUP BY 语句正确只是一件简单的事情，但到目前为止，我还处于空白状态。如果它确实需要使用子查询，这不是问题。我只是想确认以供将来参考。

**注意**：使用 SQL Server 2000 解决这个特定问题

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-09T14:06:29.163

```
SELECT  d.deptID,
        COUNT(DISTINCT g.GroupID) AS Groups,
        COUNT(DISTINCT i.ItemID) AS Items
FROM    Departments d
LEFT JOIN 
        Groups g
ON      g.deptID = d.deptID
LEFT JOIN
        Items i
ON      i.GroupID = g.GroupID
GROUP BY
        d.deptID 
```

产生的结果是：

```
deptID  Groups  Items
-----   ------  -----
1       3       6 
2       1       1
3       3       3
4       1       1 
```

这也将产生正确`0`的`Departments`那些没有`Groups`，或只有`Groups`没有`Items`。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T14:04:28.997

以下是获得结果的至少一种方法。

```
SELECT d.DeptID, d.DeptName, ISNULL(g.Groups, 0), ISNULL(t.TotalItems, 0)
FROM 
  Departments d
  LEFT OUTER JOIN (
    SELECT d.DeptID, Groups = COUNT(*)
    FROM Departments d
         INNER JOIN Groups g ON g.DeptID = d.DeptID
    GROUP BY d.DeptID
  ) g ON g.DeptID = d.DeptID
  LEFT OUTER JOIN (
    SELECT d.DeptID, TotalItems = COUNT(*)
    FROM Departments d
         INNER JOIN Groups g ON g.DeptID = d.DeptID
         INNER JOIN Inventory i ON i.GroupID = g.GroupID
    GROUP BY d.DeptID
  ) t ON t.DeptID = d.DeptID 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T14:45:20.350

这是我的尝试...

```
declare @Depatments table
(
DeptID  int
,DeptName  varchar(15)
)

declare @Groups table
(
GroupID  int
,DeptID  int
)

declare @Inventory table
(
ItemID    int
,GroupID  int
)

INSERT INTO @Depatments VALUES (1,'Department 1')
INSERT INTO @Depatments VALUES (2,'Department 2')
INSERT INTO @Depatments VALUES (3,'Department 3')
INSERT INTO @Depatments VALUES (4,'Department 4')

INSERT INTO @Groups VALUES (1,1)
INSERT INTO @Groups VALUES (2,1)
INSERT INTO @Groups VALUES (3,3)
INSERT INTO @Groups VALUES (4,4)
INSERT INTO @Groups VALUES (5,2)
INSERT INTO @Groups VALUES (6,3)
INSERT INTO @Groups VALUES (7,1)
INSERT INTO @Groups VALUES (8,3)

INSERT INTO @Inventory VALUES (1 ,2)
INSERT INTO @Inventory VALUES (2 ,3)
INSERT INTO @Inventory VALUES (3 ,8)
INSERT INTO @Inventory VALUES (4 ,1)
INSERT INTO @Inventory VALUES (5 ,4)
INSERT INTO @Inventory VALUES (6 ,5)
INSERT INTO @Inventory VALUES (7 ,1)
INSERT INTO @Inventory VALUES (8 ,2)
INSERT INTO @Inventory VALUES (9 ,2)
INSERT INTO @Inventory VALUES (10,3)
INSERT INTO @Inventory VALUES (11,7)

--works with derived tables
SELECT
    d.DeptName,dt_g.CountOf AS GroupCount, dt_i.CountOf AS InventotyCount
    FROM @Depatments  d
        LEFT OUTER JOIN (SELECT
                             COUNT(*) AS CountOf,DeptID
                             FROM @Groups
                             GROUP BY DeptID
                        ) dt_g ON d.DeptID=dt_g.DeptID
        LEFT OUTER JOIN (SELECT
                             COUNT(*) AS CountOf,g.DeptID
                             FROM @Groups               g
                                 INNER JOIN @Inventory  i ON g.GroupID=i.GroupID
                             GROUP BY DeptID
                        ) dt_i ON d.DeptID=dt_i.DeptID 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T13:52:13.333

抱歉，我没有坐在我的 SQL Server 前面。这是您的第一次尝试。我可能无法正确理解您想要的结果，但也许您可以以此为起点？

```
SELECT 
  Department.DeptId,
  Department.DeptName,
  Group.GroupId,
  COUNT (Inventory.GroupId) as TotalItems
FROM
  Department
  INNER JOIN Groups
    On (Department.DeptId = Groups.DeptId)
  INNER JOIN Inventory
    On (Inventory.GroupId = Groups.GroupId)
GROUP BY
  Department.DeptId,
  Department.DeptName
  Group.GroupId,
  Inventory.GroupId 
```

# visual-studio - 编辑器视觉工作室 2008

> ID：734306
> 
> 赞同：1
> 
> 时间：2009-04-09T13:46:06.140
> 
> 标签：visual-studio, visual-studio-2008, editor, tabs, space

我有这个烦人的问题。我使用了某种组合键，现在我的空格是点，我的标签是箭头等。有人知道如何关闭它吗？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T13:48:35.183

编辑->高级->显示空白。

# windows - 用于 Windows 的 Haskell IDE？

> ID：734309
> 
> 赞同：72
> 
> 时间：2009-04-09T13:46:27.357
> 
> 标签：windows, haskell, ide

我真的搜索过这个。（E/TextMate 是我在[这个主题](https://stackoverflow.com/questions/68504/what-are-my-ide-editor-choices-for-haskell)中找到的最接近的，但似乎没什么大不了的）

我尝试了 emacs，但似乎没有找到适用于 Windows 的 Haskell 模式。VisualHaskell 似乎没有遵循新的 VisualStudio 更新...

我可以尝试 VIM，但 Haskell 模式是否适用于那里的 Windows？

叹息......一直是“接近但没有雪茄”的感觉。

在 Windows 下真的有这么编程 Haskell 吗？

* * *

## 回答 #1

> 赞同：49
> 
> 时间：2009-04-09T15:37:09.200

我认为 Windows 的主要 IDE-ish 选项依次是：

1.  [使用 Eclipse 作为您的 Haskell IDE](http://sdasrath.blogspot.com/search/label/Haskell)
2.  [Leksah](http://www.leksah.org/index.html)，一个用 Haskell 编写的 Haskell 集成 IDE。
3.  [Visual Haskell](http://haskell.org/visualhaskell/screenshots.html) （最近状态未知）
4.  [Vim + 哈斯克尔](http://projects.haskell.org/haskellmode-vim/screencasts.html)
5.  [Emacs + 哈斯克尔](http://www.haskell.org/haskellwiki/Emacs)

我使用选项 4。

* * *

## 回答 #2

> 赞同：11
> 
> 时间：2011-03-08T10:06:20.367

**Windows 上的 Emacs 提示：**

*   下载[ntemacs](http://ntemacs.sourceforge.net/)并解压ntemacs24-bin-xxxxxxxx.7z到你喜欢的位置，例如`D:\`
*   `D:\ntemacs24\bin\runemacs.exe`为Emacs创建桌面快捷方式并运行
*   去`C:\Users\UserName\AppData\Roaming\.emacs.d\`
*   创建一个目录`haskell-mode`并将文件放入其中：`haskell-mode.el`, `haskell-font-lock.el`,`haskell-doc.el`来自[Emacs 的 Haskell 模式](http://code.haskell.org/haskellmode-emacs/)
*   在`..\emacs.d\`创建文件`init.el`

前 8 行是可选的，取决于偏好。

```
(tool-bar-mode -1)
(scroll-bar-mode -1)
(setq-default truncate-lines t)

(setq line-number-mode t)
(setq column-number-mode t)

(set-keyboard-coding-system 'cp1250)
(prefer-coding-system 'windows-1250)

(set-face-attribute 'default nil :font "Consolas-11")

(setq-default indent-tabs-mode nil)
(setq default-tab-width 4)

(load "~/.emacs.d/haskell-mode/haskell-mode")

(add-to-list 'auto-mode-alist '("\\.hs\\'" . haskell-mode))
(add-to-list 'auto-mode-alist '("\\.lhs\\'" . literate-haskell-mode))
(add-hook 'haskell-mode-hook 'turn-on-haskell-doc-mode) 
```

而已！

Ps [Komodo Edit](http://www.activestate.com/komodo-edit)支持 Haskell 的语法。

* * *

## 回答 #3

> 赞同：8
> 
> 时间：2012-04-08T21:45:50.797

另一个选择是[Sublime Text](http://www.sublimetext.com/ "崇高的文本")，它很容易成为我遇到的最好的通用代码编辑器。它通常与 Vi/Vim 或 EMACS 填补相同的领域，但通常遵循现代界面标准，并且具有一些我在任何其他编辑器中都没有见过的非常有用的功能，例如小地图和多选（按 ctrl-d选择了一些文本，它将选择相同文本的下一个实例，同时仍保持旧选择不变，基本上将输入光标放在两个位置，因此您可以同时编辑它们）。

标准下载带有基本的 Haskell 语法高亮。如果您想要更多功能，有一个名为 SublimeHaskell 的插件，它添加了 Cabal 支持，以实现更智能的自动完成和有限的 linting。要安装它，你首先要安装[Sublime 包控制](http://wbond.net/sublime_packages/package_control "崇高的包控制")（很容易做到，只需从安装部分复制一个字符串到 Sublime 的内部命令行中），重新启动 Sublime，然后使用包控制安装 SublimeHaskell（点击 ctrl-shift -p，输入“package”，选择“Package Control: Install Package”，然后输入“haskell”，选择“SublimeHaskell”，然后重启Sublime）。

它甚至可以在编辑器中构建（工具 -> 构建，或 ctrl-b）。此功能仅支持有限的一组语言，但幸运的是 Haskell 就是其中之一。

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2012-01-14T23:49:35.330

# 崇高文本

[**Sublime Text**](http://sublimetext.com)是一个非常时尚和舒适的编辑器。它不是一个 IDE，但它可以构建您的项目，将其作为一个项目使用，并且是高度可定制的。与 IDE 不同的是，它非常轻巧，而且“无干扰”功能令人惊叹。它也是跨平台的，无缝支持所有三个主要操作系统。

安装[**苏打主题**](https://github.com/buymeasoda/soda-theme)后，它变得更加悦目。

## SublimeHaskell 插件

还有一个第三方插件[**SublimeHaskell**](https://github.com/SublimeHaskell/SublimeHaskell)，它使编辑器能够深入支持 cabal、linting、自动补全和类似的东西。

SublimeText 解决方案唯一不能做的就是重构，但同样没有一个竞争解决方案可以。

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-06-06T16:50:35.337

Emacs 在 Windows 上运行良好。我在 Windows 上使用 Haskell 时使用过它。所以，这是我的建议。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-09T13:50:17.627

Visual Haskell 对我来说很好用。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2009-12-27T02:13:37.287

Leksah还不错，安装haskell平台，然后下载最新的Leksah，就大功告成了。它不如 VS 强大，但它还有其他让我喜欢使用它的品质，包括易于创建 cabal 包、语法突出显示、函数名称的自动完成（它们也应该将其扩展到语法）、函数搜索等.

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2011-02-26T06:47:18.320

Leksah 看起来很像 Linux 应用程序，当您尝试打开文件时会看到更多。它看起来不像 Windows 本机应用程序。否则，它可以。Eclipse 总是很好，但他们在他们的网站上说他们现在将 Haskell 作为他们最重要的东西（2011 年 2 月 26 日）。我也应该看看其他选项，到目前为止我还使用了 Notepad++。

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-09T13:53:44.157

我在大学时做了一些 Haskell，我必须承认我使用了记事本。那时还没有 IDE。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2012-05-18T09:52:39.563

我使用[记事本++](http://notepad-plus-plus.org/)。它有haskell语法高亮，只需要在偏好中打开haskell制表模式（4个空格而不是制表符），但没什么大不了的。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-05-11T22:32:39.347

haskellmode-vim 在 Windows 上工作得很好——我在那里使用它。这是我首选的 Haskell IDE。

见[http://projects.haskell.org/haskellmode-vim/](http://projects.haskell.org/haskellmode-vim/)

# iis - 我是否需要以编程方式更改任何内容以利用 IIS7 中的集成管道？

> ID：734310
> 
> 赞同：0
> 
> 时间：2009-04-09T13:46:34.780
> 
> 标签：iis, iis-7, pipeline, integrated

我是否需要以编程方式更改任何内容以利用 IIS7 中的集成管道？

如果是这样，优雅降级并在 IIS6 上保持功能的最佳方法是什么？

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-18T20:49:43.210

不，选择应用程序池（集成模式）时设置在 IIS 中。我最近从 IIs 6.0 升级到 IIS 7.0。该应用程序在 IIS 6.0 和 7.0 上运行良好。

# c# - jQuery Modal Example with .Net 2.0 Infragistics Grid

> ID：734312
> 
> 赞同：1
> 
> 时间：2009-04-09T13:46:38.027
> 
> 标签：c#, jquery, .net, infragistics, ignite-ui

I'm new to jQuery (I must have had my head buried in sand for the last few years!) and I'm wondering if I could use it with an Infragistics grid for updating and inserting instead of the edit row template. We're currently constrained to using the 2.0 framework, and I'm stuck with the infra grids as well.

*   Does anyone know if this is possible?

*   Do you think this is a bad/good idea?

*   Any good sample/walk-throughs out
    there?

Any, and all, advice/opinions appreciated!

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T14:54:27.397

Why don't you use the WebDialogWindow in infragistics toolset itself. I support both, modal and non-modal modes and is a control container so you can put anything in there.

You can handle the template open client side event, cancel the default one and show the WebDialogWindow, let the user name changes and once they are done you can take values from those editors and update the grid cells. You can learn more about the WebDialogWindow [here](http://community.infragistics.com/aspnet/media/default.aspx?tags=WebDialogWindow).

HTH.

Taz.

# c# - 尽管设置了 DataContext，但未设置我的 WPF Toolkit DataGrid 上的 Columns 属性

> ID：734313
> 
> 赞同：0
> 
> 时间：2009-04-09T13:47:04.157
> 
> 标签：c#, datagrid, wpftoolkit

我使用反射创建了一个 DataTable 以从我的类中获取属性并将其设置为我的 Microsoft.Windows.Controls.DataGrid 的 DataContext：

```
// Create the columns based on the data in the album info - get by reflection
var ai = new AlbumInfo();
Type t = ai.GetType();

dataTable.TableName = t.Name;

foreach (PropertyInfo p in t.GetProperties())
{
    var columnSpec = new DataColumn();
    // If boolean or int type can create directly into grid, else create a text box
    if (p.PropertyType == typeof(bool) || p.PropertyType == typeof(int))
    {
        columnSpec.DataType = p.PropertyType;
    }
    else
    {
        columnSpec.DataType = typeof(string);
    }
    columnSpec.ColumnName = p.Name;
    dataTable.Columns.Add(columnSpec);
}

dataGridView.DataContext = dataTable; 
```

AlbumInfo 包含 Title、Artist、BitRate、HasImage 等属性。

我试图在 DataTable 填充数据之前设置 DataGrid 中某些列的可见性。但是，dataGridView.Columns 属性为空。如果我等到填充 DataTable 之后，则设置 dataGridView.Columns 属性。

DataTable.Columns 属性是在表格填充之前设置的。

将 DataTable 绑定到 DataGrid 时，我还需要做些什么吗？我无法在 XAML 中做任何事情，因为我正在通过反射动态构建 DataTable。

**编辑：**

我已将代码移至 AutoGeneratedColumns 事件处理程序（似乎被调用了两次），因此只要检查 Columns.Count 我就可以访问数据。

但是，我可以设置列可见性或显示索引 - 但不能同时设置。如果我尝试同时执行这两项操作，我会在 WPFToolkit DataGrid 代码的其他地方得到索引超出范围异常。任何人有任何想法为什么？

我的代码是：

```
foreach (object columnData in Properties.Settings.Default.ColumnData)
{
    DataGridColumn column = dataGridView.Columns[index];
    column.DisplayIndex = columnData.DisplayIndex;
    column.Visibility = columnData.Visible ? Visibility.Visible : Visibility.Hidden;

    AddContextMenuItem(dataGridView.ContextMenu, columnData.Header, index++, columnData.Visible);
} 
```

AddContextMenuItem 是我的方法之一：

```
private void AddContextMenuItem(ContextMenu contextMenu, string columnName, int index, bool visible)
{
    var menuItem = new MenuItem() { Header = columnName, Tag = index, IsCheckable = true, IsChecked = visible };
    menuItem.Click += new RoutedEventHandler(contextMenu_onClick);
    contextMenu.Items.Add(menuItem);
} 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T14:34:22.483

我是否了解您想要控制自动生成的列的可见性？我认为 DataGrid 的 AutoGeneratingColumn 事件将是完美的。它为每个自动生成的列触发一次。此时您可以修改列的属性（例如设置可见性）或完全`e.Cancel = true`阻止创建该列*。*

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T20:59:05.410

我意识到我看到的行为是正确的，我只能在丹尼尔的回答指出我正确的方向后访问这些列（即使它不是 100% 正确）。然而，这导致了尝试设置可见性和显示索引的后续问题。

我报告了无法在 Codeplex 讨论板上同时设置显示索引和可见性的问题，并且刚刚收到此回复：

> 这确实是一个错误，我们已经在我们的数据库中提交了一个错误来跟踪问题。
> 
> 您可以尝试通过在 Loaded 事件中以后台优先级调用 Dispatcher.BeginInvoke 来解决此问题。如果在页面达到稳定状态后更改订单，似乎不会出现此问题。

我不确定我是否会检查这个解决方法。我在 WPF 中重写了一个 WinForms 应用程序作为一个学习练习，而这项工作并不是真正重要的。

**更新**

我使用的是 3.5.40320.1 版本，标记为 2009 年 3 月。

我刚刚更新到版本 3.5.40619.1，标记为 2009 年 6 月，设置可见性和显示索引的问题已得到修复。

# asp.net - 如果 ModelState 无效，ASP.NET MVC AJAX 更改 UpdateTargetId

> ID：734314
> 
> 赞同：3
> 
> 时间：2009-04-09T13:47:05.967
> 
> 标签：asp.net, asp.net-mvc

我使用一个内部有两个局部视图的视图。

```
<div id="matches">
    <% foreach (var item in Model)
       { %>
    <% Html.RenderPartial("RenderMatchesListRowUserControl", item); %>
    <% } %>
</div>
<div id="addMatchFormBox">    
    <% Html.RenderPartial("AddNewMatchUserControl");%>
</div> 
```

第一个部分视图“RenderMatchesListRowUserControl”呈现一个简单的 div 元素（用于匹配列表），第二个“AddNewMatchUserControl”呈现一个表单以在列表下方创建一个新匹配：

AddNewMatchUserControl 的来源：

```
<%= Html.ValidationSummary("Create was unsuccessful. Please correct the errors and try again.") %>

<% using (Ajax.BeginForm("Create", new AjaxOptions
   {
       UpdateTargetId = "matches",
       InsertionMode = InsertionMode.InsertAfter,
       OnSuccess = "flashit",
       OnFailure = "renderForm"
   }))
   {%>
<fieldset>
    <legend>New Match</legend>
    <p>
        <label for="DurationBetweenMovesInDays">
            Dauer (in Tagen) zwischen den Z&uuml;gen:</label>
        <%= Html.TextBox("DurationBetweenMovesInDays")%>
        <%= Html.ValidationMessage("DurationBetweenMovesInDays", "*")%>
    </p>
    <p>
        <input type="submit" value="Create" />
    </p>
</fieldset>
<% } %> 
```

根据 ModelState，控制器返回新匹配条目的局部视图或表单的局部视图，以显示模型错误。

```
if (Request.IsAjaxRequest()) {
            return ModelState.IsValid ?    PartialView("RenderMatchesListRowUserControl", match) : PartialView("AddNewMatchUserControl");
        } 
```

它工作正常，直到 ModelState 变得无效。在这种情况下，表单将在匹配列表的末尾呈现，因为 updatetargetid 引用包含匹配列表的 div 元素。为避免这种情况，必须更改 updatetargetid 以引用包含表单的 div 元素。但我不知道该怎么做。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2018-10-05T08:58:02.360

我也有同样的问题。如果模型状态无效，我想更新包含表单的 div 中的内容，如果成功保存，则更新数据集合。所以我使用的技巧是而不是使用“UpdateTargetId”。我使用“OnSuccess”来处理它。

这是一个例子。

```
 @using (Ajax.BeginForm("SaveUser", new AjaxOptions{
HttpMethod = "Post",
LoadingElementId = "save-progress",
OnSuccess = "onUpdateSuccess"
InsertionMode = InsertionMode.Replace})) 
```

这是一个javascript示例。

```
function onUpdateSuccess(response, xhr) {
     $('#progress-bar').css({ 'display': 'none' });
     if (response.indexOf('form') != -1) {
        $('#addOrEditUserForm').html(response);

     } else {
       $('#user-table').html(response);
       $('#addOrEditUserForm').html('')
 } 
```

};

* * *

## 回答 #2

> 赞同：-3
> 
> 时间：2009-04-17T20:58:59.857

好的。没有办法以这种方式实现这一目标。我用jQuery解决了它。

# php - 将 PHP 代码写入文件

> ID：734325
> 
> 赞同：4
> 
> 时间：2009-04-09T13:50:02.417
> 
> 标签：php, quotes

我想知道是否可以将php代码写入文件。例如：

```
fwrite($handle, "<?php $var = $var2 ?>"); 
```

我希望它在文件中生成确切的字符串，而不是经过评估的代码。这可能吗？

我目前得到以下输出（其中 $var = 1 和 $var2 = 2）：

```
<?php 1 = 2 ?> 
```

而我想要实际的字符串：

```
<?php $var = $var2 ?> 
```

谢谢您的帮助

* * *

## 回答 #1

> 赞同：19
> 
> 时间：2009-04-09T13:52:16.373

您可以使用单引号代替双引号，双引号不会扩展内联变量名称：

```
fwrite($handle, '<?php $var = $var2 ?>'); 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-12T07:39:31.383

只需转义 $ 符号

```
<?php
fwrite($handle, "<?php \$var = \$var2 ?>");
?> 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T14:30:19.013

为变量解析双引号字符串，并将变量值插入该位置。我想这是因为 php 最初被设计为一个瘦 webserver-database 模板层。

就个人而言，我不喜欢这样，因此从不使用双引号。相反，我总是使用单引号和字符串连接：

```
<?php echo 'hello, ' . $name; ?> 
```

与以下内容相同：

```
<?php echo "hello, $name"; ?> 
```

单引号：语法着色效果更好，它（略微）更快并且更容易发现错误

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T14:17:36.610

这与文件 io 无关。阅读 PHP 中字符串中的变量替换和转义。

# asp.net - 无法在字段为 Guid 的地方插入 null（SqlDataSource 中的对象）

> ID：734326
> 
> 赞同：0
> 
> 时间：2009-04-09T13:50:07.050
> 
> 标签：asp.net

我有一个表链接到 ASP.NET 成员模式中的另一个表。

问题是，ASP.NET 表的所有 PK 都是唯一标识符，所以我的也必须如此。当我添加一个 SqlDatasource 并调用它的 Insert() 方法时，我收到以下错误：

无法将值 NULL 插入到列“DiscountCode”、表“CreamDb.dbo.CustomInfo1”中；列不允许空值。插入失败。该语句已终止。

uniqueidentifier 也被视为对象（其数据类型），但没有 Guid 数据类型。我以前遇到过这个问题，但是架构要简单得多，所以我可以修复它。

我该如何解决这个问题？如果我去掉标记中的数据类型部分（所以只留下字段/参数名称而不是数据类型的东西），我会得到另一个错误，所以这是不可能的。

谢谢

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T13:52:07.157

“没有 Guid 数据类型”是什么意思？有什么问题`System.Guid`？你不能只使用`Guid.NewGuid()`，适当地设置字段，然后插入吗？

编辑：只是为了提供更多内容：将事件处理程序附加到[Inserting](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.sqldatasource.inserting.aspx)事件，然后通过[`DbCommand`](http://msdn.microsoft.com/en-us/library/system.data.common.dbcommand.aspx)返回的[`SqlDataSourceCommandEventArgs.Command`](http://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.sqldatasourcecommandeventargs.command.aspx). 或者更改 INSERT 命令使用的 SQL 以要求数据库为您填充 GUID 字段。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T14:51:16.743

将 SQL Sever 中列的默认值设置为“newid()”。

Asp.net 不会发送该值，并且该字段将获得一个新的 guid。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T14:08:06.540

处理对 ASP.NET 成员资格提供程序的数据的引用时，一种流行的方法是，不是为 GUID 保留适当的外键，而是在表中存储类似 LoweredUserName 的内容。然后，使用 Membership Provider 的 API 与您需要的对象进行交互。在某些情况下，您需要一个 ObjectDataSource 抽象层来完成 CRUD 场景。

# google-maps - Google Map API 与 MS 虚拟地球 API

> ID：734327
> 
> 赞同：1
> 
> 时间：2009-04-09T13:50:07.737
> 
> 标签：google-maps, virtual-earth

我想在我的博客中使用地图。那么哪个api适合我？我期待地图应该有更多的功能。我不知道如何使用它。对不起，如果我的问题很愚蠢。
我需要两者的文档。请告诉我？？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T13:54:17.510

双方的映射 API 都有很好的文档记录，只需 google 一下，您就会找到所需的内容。MS Api 限制性更强，但 MS 地图更好地支持显示漂亮的弹出框等。

使用两者后唯一真正的考虑因素是设计以及您是否需要 https 支持，因为谷歌地图会给 https 上的 IE 用户一个讨厌的安全对话框弹出窗口，除非您向 Google 支付 10,000 美元（但对于您的博客我不会想象你对此大惊小怪）

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T13:56:22.200

他们都很相似。我使用过 Google Maps API，它很容易启动和运行，并且可以满足我的一切需求。它也有街景，这是一个很好的额外。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T13:57:18.250

您应该向我们提供更多详细信息以获得更好的答案，但无论如何我都会给您我的想法：

我在 2007 年做的一个项目中使用了虚拟地球 API。那时我们决定选择 MS 版本，因为它有更好的文档，并且更适合我们的技术集，即 MS SQL、.NET 等...... . 最重要的是：它是免费的！

谷歌当时为地图和其他东西提供了一个更好的用户界面，但在一定数量的请求之后，你就会开始被收费......

如果您在.NET 中进行开发，我现在肯定会选择 Virtual Earth，因为 Microsoft 已经发布了官方的虚拟地球[服务器端控制](http://blogs.msdn.com/virtualearth/archive/2008/07/28/announcing-the-microsoft-virtual-earth-asp-net-server-control.aspx)......

一些链接：

[http://dev.live.com/Virtualearth/sdk/](http://dev.live.com/Virtualearth/sdk/)

[http://code.google.com/apis/maps/](http://code.google.com/apis/maps/)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T13:53:58.897

个人认为，与带有街景的谷歌地图相比，Virtual Earth 是一个劣质产品。我没有看过任何一个 API，但我使用 Google 和 Microsoft 的其他基于 Web 的 API 的经验是，Google 提供了更多的功能。网络是他们的生计。这是MS的防御动作。顺便说一句，我喜欢 MS，所以这不是讨厌的咆哮……

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-09T13:56:02.183

可以肯定的是，MS Virtual Earth 将要求您的用户下载特定于实际查看地图并与之交互的查看器。Google API 将直接与浏览器一起使用。真的归结为您希望包含什么样的功能？如果你只是想在地图上显示不同的地方，那么 GoogleAPI 可以很好地为你工作在一个快速移动的飞机上，然后是 MS Earth。 [Google Maps API](http://code.google.com/apis/maps/)或[MS Earth 开发者](http://www.microsoft.com/virtualearth/developers/)

# c# - 视频转换为 WMV

> ID：734332
> 
> 赞同：1
> 
> 时间：2009-04-09T13:51:14.443
> 
> 标签：c#, video, wmv

我目前正在工作的一个项目需要能够将视频从其他格式转换为 WMV 格式。我们需要能够将几乎任何常用的视频格式转换为 WMV 格式。我正在寻找一种解决方案，例如 On2 的 flix 引擎将其他视频类型转换为`.flv`视频。我知道 Windows 提供的编码器，但它可以转换的视频类型列表非常有限。如果您有任何建议或意见，或推荐我可以用来执行此操作的软件，请告诉我。我需要能够批量进行转换，并且我需要能够使用 C# 以编程方式进行转换。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T13:54:36.837

你看过[ffmpeg](http://www.ffmpeg.org/)吗？

它似乎是许多开源视频转换实用程序的核心，所以我想你可以在你描述的场景中使用它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T14:39:19.677

[SUPER](http://www.erightsoft.com/SUPER.html)，这个名字真是包罗万象！

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T14:17:47.437

嗯，首先你必须能够解码文件格式。您需要使用 directshow 进行设置，这很难使用。您可以查看 mediaportal 项目，了解用 C# 编写的 directshow 文件播放器。您可以重新编码视频和音频并将它们混合到一个 .wmv 文件中，而不是在 directshow 图形的末尾使用视频渲染器。这是一个非常复杂的项目。您基本上必须模仿玩家玩任何格式和处理失败的能力。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T14:27:19.503

我对使用[Quick Media Converter](http://www.cocoonsoftware.com/#us)非常满意。

# web-services - 内容类型与绑定不匹配

> ID：734343
> 
> 赞同：5
> 
> 时间：2009-04-09T13:52:59.867
> 
> 标签：web-services, content-type

我正在从 C# 调用第三方 Java Web 服务。`Mtom`在他们将服务器的消息编码从更改为文本之前，它工作正常。我更改了配置文件中的绑定，现在每当我调用该服务时，我都会收到此错误：

> 内容类型 multipart/related；类型=“文本/xml”；响应消息的内容类型与绑定的内容类型不匹配 (text/xml; charset=utf-8)。

如果您查看响应，它包含以下内容：

> 内容类型：文本/xml；字符集=utf-8

当内容类型完全相同时，我不明白为什么它会抱怨绑定。有没有人有任何想法？这真让我抓狂。

# php - 如何以下载的形式向用户提供 Ajax POST 响应？

> ID：734353
> 
> 赞同：3
> 
> 时间：2009-04-09T13:54:25.667
> 
> 标签：php, jquery, download

我正在尝试在包含帐户信息的现有页面中包含 vCard 导出功能。

丑陋的方法将涉及 1，将表单提交到同一页面，对其进行处理并重新呈现整个页面，或者 2，针对页面上的 iframe 的 GET。我真的很想避免这两种情况，但我可能不得不使用#2 来实现目标。

现在我有：

```
<input type="image" src="/intra/imgs/icons/vcard.png" onclick="$.post('/intra/vcard.php', { id: '992772', type: 'sponsor'});"> 
```

从某种意义上说，如果我在 Firebug 中观看 XHR 活动，我会看到请求以正确的响应返回，其中充满了 vCard 格式的数据。但是，它不会提示用户将响应下载为文件，即使卡是通过以下方式发送的：

```
header('Content-Type: text/x-vcard');
header("Content-Disposition: attachment; filename={$this->name_first}{$this->name_last}.vcf"); 
```

我做错了什么，还是这不可能？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T14:20:06.307

我很困惑到底是什么问题。为什么不这样做：

```
<input type="image"
       src="/intra/imgs/icons/vcard.png"
       onclick="window.location='/intra/vcard.php?id=992772&type=sponsor';"> 
```

然后返回适当的下载标题`vcard.php`？当浏览器获取这些内容时，它将停留在同一页面上并提示下载。您将不得不更改代码来处理变量`$_GET`而不是，`$_POST`但无论如何您都应该使用 GET。

**正如评论中指出的那样编辑**，这样做会更合适：

```
<a href="/intra/vcard.php?id=992772&type=sponsor"><img src="/intra/imgs/icons/vcard.png"></a> 
```

这样，禁用了 javascript 的用户就可以访问它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T14:16:33.337

是的，您无法从 xhr 触发下载。我发现的唯一方法是选项#2，使用 iframe。

也许一个 jquery 插件（我假设你正在使用 jquery）只是为了这个目的而过度杀伤，但这[可能](http://www.nicolas.rudas.info/jQuery/xajaSubmit.js)对你有用。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T14:53:56.507

检查文件名 ´{$this->name_first}{$this->name_last}.vcf´) 是否有效以及 firebug 中的 http 响应！（标签网络，点击响应）。

那里的内容正确吗？
内容长度是否正确？http状态呢？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-14T20:00:41.100

在发布期间生成您的内容，然后重定向到该内容。

# c# - 对如何创建 SOAP 一无所知 标题

> ID：734355
> 
> 赞同：14
> 
> 时间：2009-04-09T13:54:28.523
> 
> 标签：c#, .net, soap

我几乎没有使用 SOAP 协议的经验。我需要连接到所需标头的服务。我认为这在 Java 中有点标准，但在 C# 中必须手动创建此标头。

这里有没有人能够连接到类似的服务：已经创建了标头，或者甚至可能知道一些可以简化标头创建的标准库？你能分享一些代码或参考资料吗？

我还发现了一个线索，如果使用 WS2005，可能会生成标题，因为它有 WS3 插件。有人可以对此发表评论吗？快速查看此插件后，我发现与安全标头中类似的字段，但仍然无法创建标头。

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2012-01-05T18:15:44.577

我们能够使用以下代码解决它：

```
public class SecurityHeader : System.ServiceModel.Channels.MessageHeader {
    public string userName;
    public string password;

    protected override void OnWriteStartHeader (System.Xml.XmlDictionaryWriter writer, System.ServiceModel.Channels.MessageVersion messageVersion)
    {
        writer.WriteStartElement("wsse", Name, Namespace);
        writer.WriteXmlnsAttribute("wsse", Namespace);
    }

    protected override void OnWriteHeaderContents (System.Xml.XmlDictionaryWriter writer, System.ServiceModel.Channels.MessageVersion messageVersion)
    {
        writer.WriteStartElement("wsse", "UsernameToken", Namespace);

        writer.WriteStartElement("wsse", "Username", Namespace);
        writer.WriteValue(userName);
        writer.WriteEndElement();

        writer.WriteStartElement("wsse", "Password", Namespace);
        writer.WriteValue(password);
        writer.WriteEndElement();

        writer.WriteEndElement();

    }

    public override string Name
    {
        get { return "Security"; }
    }

    public override string Namespace
    {
        get { return "http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"; }
    }
} 
```

这编写了 DataPower 框所需的标头。

如何使用类 SecurityHeader

```
 public static void Main(string[] args)
    {

        var webService = new ServiceReference1.MyWebService();
        ....
       webService.Open();

        using (OperationContextScope scope = new OperationContextScope((IContextChannel)webService.InnerChannel))
        {

            var myObjRequest = GetMyObjRequest();

            MessageHeaders messageHeadersElement = OperationContext.Current.OutgoingMessageHeaders;
            messageHeadersElement.Add(SecurityHeader("UserName", "Password"))

             var res = webService.MyServe(myObjRequest);
            Console.WriteLine(res.ToString());
        }
    } 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-09T14:02:49.250

有趣的是，您应该提到这一点-我最近一直在这样*做*。

我已经设法使用`SoapExtension`它`ChainStream`来保存原始流的副本，只需`BeforeDeserialize`在`AfterSerialize`.

添加标头是将“新”流的内容（`ChainStream`从.`XDocument``ChainStream`

不幸的是，这很脏，并且您不能（据我所知）在需要时使用具有适当身份验证信息的新实例。

我已经使用 a代替了*大部分*`SoapHeader`方法，为 Web 服务的每个方法添加了一个适当的属性，以及一个带有所需标头实例的适当字段/属性 - 但是 SOAP 序列化目前让我头疼指定正确的元素名称（带有命名空间）。这是我一直计划在我有时间的时候问其他人的事情。

很抱歉不能给你一个完整的答案——也很抱歉缺少代码，它属于公司而不是我——但希望它至少能给你一个起点。

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-09T14:06:09.307

在 .Net 中将 SOAP 标头添加到您的 Web 服务代理通常非常容易。这是一个快速的代码示例。

创建新的 SOAP 标头

```
using System.Web.Services.Protocols;

public class SoapAuthHeader : SoapHeader
{
public string Username;
public string Password;
} 
```

在您的 Web 服务代理类中：

```
public class MyWebServicesProxy : System.Web.Services.Protocols.SoapHttpClientProtocol {

    public SoapAuthHeader AuthHeader;

    ...

} 
```

然后使用：

```
SoapAuthHeader authHeader = new SoapAuthHeader();
authHeader.Username = "username";
authHeader.Password = "password";

MyWebServicesProxy myProxy = new MyWebServicesProxy();
myProxy.AuthHeader = authHeader; 
```

编辑：还有其他方法，微软确实有一个包含 WS-Security的[WSE 库，它提供了比上面的简单示例更多的功能。](http://msdn.microsoft.com/en-us/library/aa529300.aspx)如果您在 SOAP 标头中需要 Kerberos 令牌或证书签名，那么这是可行的方法。如果您只需要为通过 SSL 运行的 Web 服务添加简单的用户名和密码，那么示例可能就是您所需要的。

编辑：**关于 WSE 的快速宣传**本十年早些时候，当 Web 服务将接管世界时，一群行业参与者（微软、IBM、Sun 等）聚集在一起，提出了在它们之上做事的标准方法。形成的身体是[OASIS](http://www.oasis-open.org/committees/tc_cat.php?cat=ws)。从那时起，微软发布了许多版本的 WSE 库来支持一些规范，但有趣的是，尽管第一个版本在 2003 年左右公开，但它们从未被合并到 .Net 框架中。

Web 服务虽然仍然非常流行，并且在我看来是一种在不同 Internet 应用程序之间集成的好方法，但它已经有点失宠了。原因之一无疑是因为 AJAX 和 Web 服务并不是最好的伙伴，尽管情况有所改善。一旦你开始包含所有额外的 sWSE 规范，Web 服务也会变得相当复杂，并且 Web 服务应该解决的一个问题是其他 RPC 协议、CORBA 等的复杂性。与此同时，REST 以牺牲为代价获得了很大的普及Web 服务和 AJAX 库通常更喜欢它。

无论如何，Web 服务都不会很快消失，但它们也可能不会很快接管世界。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2021-01-09T13:06:11.853

谢谢各位。您收集的所有代码和想法如下。

### 班级：

```
 public class SecurityHeader : System.ServiceModel.Channels.MessageHeader
{
    public string userName;
    public string password;

    public SecurityHeader(string userName, string password)
    {
        this.userName = userName;
        this.password = password;
    }

    protected override void OnWriteStartHeader(System.Xml.XmlDictionaryWriter writer, System.ServiceModel.Channels.MessageVersion messageVersion)
    {
        writer.WriteStartElement("wsse", Name, Namespace);
        writer.WriteXmlnsAttribute("wsse", Namespace);
    }

    protected override void OnWriteHeaderContents(System.Xml.XmlDictionaryWriter writer, System.ServiceModel.Channels.MessageVersion messageVersion)
    {
        writer.WriteStartElement("wsse", "UsernameToken", Namespace);
        writer.WriteStartElement("wsse", "Username", Namespace);
        writer.WriteValue(userName);
        writer.WriteEndElement();
        writer.WriteStartElement("wsse", "Password", Namespace);
        writer.WriteAttributeString("Type", "http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText");
        writer.WriteValue(password);
        writer.WriteEndElement();
        writer.WriteEndElement();
    }

    public override string Name
    {
        get { return "Security"; }
    }

    public override string Namespace
    {
        get { return "http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"; }
    }
} 
```

### 使用：

```
 using (IdsTestSvc.MedulaIlacDagitimSistemiIslemleriClient client = new IdsTestSvc.MedulaIlacDagitimSistemiIslemleriClient("MedulaIlacDagitimSistemiIslemleriPort"))
                    {
                        using (OperationContextScope scope = new OperationContextScope(client.InnerChannel))
                        {
                            MessageHeaders messageHeadersElement = OperationContext.Current.OutgoingMessageHeaders;
                            messageHeadersElement.Add(new SecurityHeader(_main.IdsFirmCode, _main.IdsFirmCode));
 ....Do something
                        }
                    } 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-21T21:42:31.047

有一个名为 ClearUserNameBinding 的开源自定义绑定，此绑定有助于在 Http 上将 UserNameToken 作为 clearText 传递。当需要使用 WCF 客户端使用基于 Java 的 Web 服务时，这对我有帮助。

[http://code.google.com/p/wcf-clear-username-binding/](http://code.google.com/p/wcf-clear-username-binding/) [http://webservices20.blogspot.com/2008/11/introducing-wcf-clearusernamebinding.html](http://webservices20.blogspot.com/2008/11/introducing-wcf-clearusernamebinding.html)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2019-03-11T05:46:15.057

**Domenico Zinzi**的解决方案对我进行了以下修改：我在 SecurityHeader 类中创建了一个构造函数：

`public SecurityHeader(string userName, string password){ userName = userName; password = password; }`

在调用它时，我使用了“New”关键字，如下所述：

`messageHeadersElement.Add(New SecurityHeader("UserName", "Password"))`

它奏效了:)

PS 无法将其添加为评论，这就是为什么在此处添加它。

# c# - 时间：2019-01-10 标签：c#.netSandbar.dll

> ID：734363
> 
> 赞同：0
> 
> 时间：2009-04-09T13:56:34.023
> 
> 标签：c#, .net

我正在使用sandbar.dll 1.1.0.2 版作为wondows 应用程序中的工具栏菜单。它在windows xp 中运行良好，如果我在vista 中使用经典主题也运行良好但是如果我使用vista 主题，它会在vista 中弹出空白。

提前谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T14:38:23.707

尝试将您的 SandBar.dll 更新到最新版本。

# python - 参数类型检查 Python

> ID：734368
> 
> 赞同：41
> 
> 时间：2009-04-09T13:57:28.843
> 
> 标签：python, typechecking

有时检查 Python 中的参数是必要的。例如，我有一个函数接受网络中其他节点的地址作为原始字符串地址或封装其他节点信息的类节点。

我使用 type() 函数，如下所示：

```
 if type(n) == type(Node):
        do this
    elif type(n) == type(str)
        do this 
```

这是一个好方法吗？

**更新 1：** Python 3 有函数参数的注释。这些可用于使用工具进行类型检查：http: [//mypy-lang.org/](http://mypy-lang.org/)

* * *

## 回答 #1

> 赞同：118
> 
> 时间：2009-04-09T14:00:36.447

使用`isinstance()`. 样本：

```
if isinstance(n, unicode):
    # do this
elif isinstance(n, Node):
    # do that
... 
```

* * *

## 回答 #2

> 赞同：17
> 
> 时间：2009-04-09T14:01:36.150

```
>>> isinstance('a', str)
True
>>> isinstance(n, Node)
True 
```

* * *

## 回答 #3

> 赞同：6
> 
> 时间：2009-04-09T14:34:17.943

听起来你在追求一个“通用函数”——一个根据给定的参数表现不同的函数。这有点像在不同对象上调用方法时如何获得不同的函数，但不是仅使用第一个参数（对象/自身）来查找函数，而是使用所有参数。

Turbogears 使用类似的东西来决定如何将对象转换为 JSON - 如果我没记错的话。

IBM有[一篇](http://www.ibm.com/developerworks/library/l-cppeak2/](http://www.ibm.com/developerworks/library/l-cppeak2/)关于将调度程序包用于此类事情的文章：

从那篇文章：

```
import dispatch
@dispatch.generic()
def doIt(foo, other):
    "Base generic function of 'doIt()'"
@doIt.when("isinstance(foo,int) and isinstance(other,str)")
def doIt(foo, other):
    print "foo is an unrestricted int |", foo, other
@doIt.when("isinstance(foo,str) and isinstance(other,int)")
def doIt(foo, other):
    print "foo is str, other an int |", foo, other
@doIt.when("isinstance(foo,int) and 3<=foo<=17 and isinstance(other,str)")
def doIt(foo, other):
    print "foo is between 3 and 17 |", foo, other
@doIt.when("isinstance(foo,int) and 0<=foo<=1000 and isinstance(other,str)")
def doIt(foo, other):
    print "foo is between 0 and 1000 |", foo, other 
```

* * *

## 回答 #4

> 赞同：6
> 
> 时间：2009-04-09T14:48:23.137

如有必要，您还可以使用 try catch 进行类型检查：

```
def my_function(this_node):
    try:
        # call a method/attribute for the Node object
        if this_node.address:
             # more code here
             pass
    except AttributeError, e:
        # either this is not a Node or maybe it's a string, 
        # so behavior accordingly
        pass 
```

*你可以在关于生成器的第二篇《开始 Python* 》中看到一个例子（我的版本中的第 197 页），我相信*Python Cookbook*。很多时候捕捉`AttributeError`or`TypeError`更简单，而且显然更快。此外，它可能以这种方式工作得最好，因为这样您就不会被绑定到特定的继承树（例如，您的对象可能是 a`Node`或者它可能是具有与 a 相同行为的其他对象`Node`）。

* * *

## 回答 #5

> 赞同：4
> 
> 时间：2009-04-09T16:14:56.957

不，Python 中的类型检查参数不是必需的。**从来没有**必要 。

如果您的代码接受作为原始字符串或`Node`对象的地址，那么您的设计将被破坏。

这是因为如果您还不知道自己程序中对象的类型，那么您已经做错了。

类型检查会损害代码重用并降低性能。拥有一个根据传递的对象类型执行不同操作的函数很容易出错，并且具有更难以理解和维护的行为。

您有以下更明智的选择：

1.  创建一个`Node`接受原始字符串的对象构造函数，或一个转换`Node`对象中字符串的函数。让你的函数假设传递的参数是一个`Node`对象。这样，如果您需要将字符串传递给函数，您只需执行以下操作：

    ```
    myfunction(Node(some_string)) 
    ```

    这是您的最佳选择，它干净、易于理解和维护。任何阅读代码的人都会立即了解正在发生的事情，而您不必进行类型检查。

2.  创建两个函数，一个接受`Node`对象，一个接受原始字符串。您可以以最方便的方式在内部进行一个调用（`myfunction_str`可以创建一个`Node`对象并调用 `myfunction_node`，或者相反）。

3.  使`Node`对象具有`__str__`方法并在函数内部调用`str()`接收到的参数。这样你总是通过强制得到一个字符串。

无论如何，**不​​要 typecheck**。这是完全没有必要的，只有缺点。以不需要类型检查的方式重构代码。从短期和长期来看，这样做只会使您受益。

# c# - string.IsNullOrEmpty() 与 string.NotNullOrEmpty()

> ID：734372
> 
> 赞同：32
> 
> 时间：2009-04-09T13:58:03.567
> 
> 标签：c#, .net, string

我很好奇是否有任何开发人员更频繁地使用 string.IsNullOrEmpty() 否定而不是肯定

例如

```
if (!string.IsNullOrEmpty()) 
```

这就是我 99% 的时间使用该方法的方式。对此的设计决策是什么？

* * *

## 回答 #1

> 赞同：61
> 
> 时间：2009-04-09T14:01:13.157

因为“IsNullOrEmpty”比“NotNullOrEmpty”更容易理解。后者可以解释为：

1.  它不为空，也不为空
2.  它不为空或为空

* * *

## 回答 #2

> 赞同：38
> 
> 时间：2009-04-09T14:00:56.323

在命名事物时通常不鼓励双重否定。`!string.NotNullOrEmpty(...)`会做一个。

* * *

## 回答 #3

> 赞同：12
> 
> 时间：2009-04-09T14:42:23.260

对于那些逻辑学家来说，!string.IsNullOrEmpty 不等同于 string.IsNotNullOrEmpty。@Guffa 说得对。使用德摩根定律，它必须是 string.IsNotNullAndNotEmpty 才能等价。

¬(null ∨ 空) ⇔ ¬null ∧ ¬empty

¬(null ∨ 空) ≠ ¬null ∨ 空

我想，这里的重点是它目前的方式是明确的，而将相反的方式明确会很麻烦。

* * *

## 回答 #4

> 赞同：7
> 
> 时间：2009-04-09T14:00:56.307

C# 命名约定规定您的表达式应该是肯定的，例如“Is...”而不是“IsNot...”

编辑：通常，我在方法开头进行错误检查和输入验证时使用它，如果参数为空或为空，则引发异常。

`if (string.IsNullOrEmpty(myParameter))
{
throw new ....
}` 

* * *

## 回答 #5

> 赞同：7
> 
> 时间：2009-04-09T14:05:22.257

我更喜欢扩展方法：

```
public static class StringExtensions
{
    public static bool IsNullOrEmpty(this string value)
    {
        return string.IsNullOrEmpty(value);
    }
} 
```

我觉得最好说：

```
if(myValue.IsNullOrEmpty()) 
```

或者

```
if(!myValue.IsNullOrEmpty()) 
```

* * *

## 回答 #6

> 赞同：6
> 
> 时间：2010-04-27T13:37:30.643

我总是为“HasContent()”创建一个扩展方法，这通常是有意义的，遵循“积极”规范，并且节省了代码膨胀，因为我使用它的频率比它的对应物要多得多：

```
public static bool HasContent(this string s) {
    return !string.IsNullOrEmpty(s);
} 
```

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-09T14:02:01.453

也许是因为那样的话，名称必须很长`IsNotNullAndNotEmpty`才能具体。

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2010-05-06T09:24:15.040

当然，您`string.IsNullOrWhiteSpace(string)`现在总是可以使用，而不是`string .IsNullOrEmpty(string)`从 .NET 4.0

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2009-04-09T14:00:33.297

这是我见过的最常见的用法。

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-10T00:16:31.387

“NotNullOrEmpty”是模棱两可的，它可能表示“（非空）或空”，也可能表示“非（空或空）”。为了明确起见，您必须使用“NotNullAndNotEmpty”，这是一个满口的。

此外，“IsNullOrEmpty”命名鼓励用作保护子句，我认为这很有用。例如：

```
if (String.IsNullOrEmpty(someString))
{
   // error handling
   return;
}
// do stuff 
```

我认为这通常比：

```
if (!String.IsNullOrEmpty(someString))
{
   // do stuff
}
else
{
   // error handling
   return;
} 
```

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2010-02-15T14:39:59.373

实际上，我倾向于提供与其他几个人提供的“它是模棱两可的”解释不同的答案（尽管我也同意这个答案）：

就个人而言，我喜欢尽量减少代码中的嵌套，因为（对我而言）花括号代码越多，就越难遵循。

因此我更喜欢这个（例如）：

```
public bool DoSomethingWithString(string s) {
    if (string.IsNullOrEmpty(s))
        return false;

    // here's the important code, not nested
} 
```

对此：

```
public bool DoSomethingWithString(string s) {
    if (!string.IsNullOrEmpty(s)) {
        // here's the important code, nested
    } else {
        return false;
    }
} 
```

这是一个非常具体的场景（空/空字符串提示立即退出），显然不是使用方法`IsNullOrEmpty`总是结构化的方式；但我认为这实际上很常见。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-09T14:01:33.047

就个人而言，我更喜欢首先迎合非否定的情况。对我来说，先做真实的部分然后做虚假的部分才有意义。归结为个人风格。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-04-09T14:10:32.087

我一直认为这似乎是错误的方式，因为我使用负数的次数多于正数。

我还希望有一个实例 IsEmpty() 或 IsNotEmpty() 在函数中声明变量时使用。这不能是 IsNullOrEmpty() 或 IsNotNullOrEmpty() ，就好像实例为空一样，您将获得空引用异常。

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2020-11-14T12:53:33.523

我有同样的问题，然后才意识到我所要做的就是将 Not 运算符放在条件前面。我认为它清理了我的代码。

```
 // need to check if tBx_PTNum.Text is empty
        /*
        if (string.IsNullOrWhiteSpace(tBx_PTNum.Text))
        {
            // no pt number yet
        }
        else
        {
            ptNum = Convert.ToInt32(tBx_PTNum.Text);
        }
        */

        if(!string.IsNullOrEmpty(tBx_PTNum.Text))
        {
            ptNum = Convert.ToInt32(tBx_PTNum.Text);
        } 
```

# visual-studio - 当您通过网络共享处理 Visual Studio 项目时，您是否遇到性能问题？

> ID：734373
> 
> 赞同：9
> 
> 时间：2009-04-09T13:58:14.737
> 
> 标签：visual-studio, visual-studio-2008

当通过网络驱动器访问项目时，Visual Studio（2008，如果重要的话）锁定和减慢了巨大的问题。通过映射驱动器打开一个大型网站项目可能需要几分钟，即使保存一个文件也可能需要一分钟或更长时间。

我启动了 Wireshark 并观察了交通情况。VS 似乎从网络请求大量文件——有大量的 SMB 流量。我做了一些研究，这种流量似乎源于两种情况。

1.  VS 必须在自己的进程中拥有一切才能提供 Intellisense。
2.  VS 需要拥有所有源代码才能编译项目。

我读过的所有建议似乎都归结为同一件事：在本地工作，而不是在远程机器上工作，然后通过源代码控制将您的代码推送到集成服务器。

这肯定会解决我们的问题（VS 在本地工作非常快），但是如果你*不能*在本地工作怎么办？如果项目和运行它所需的基础设施太大太复杂而无法在每个人的个人机器上复制怎么办？

我们已经多次解决这个问题，我们能想到处理这些项目的唯一方法是通过映射驱动器直接访问。但是，VS 速度慢和死机确实成为一个问题。

一种解决方案：我们在服务器上安装了 VS，并通过 RDP 直接在服务器上处理项目。严重地。

所以，我问：

其他人都做什么？您是通过网络工作，还是在本地复制项目？如果远程，您是否会遇到 VS 性能问题。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T14:02:20.500

我们在本地工作并使用 SVN 将我们所有的代码保存在服务器上。

我发现 VS 2008 有时在本地工作很慢，所以我不想在网络共享上工作。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T14:50:37.623

使用 Visual Studio 尝试通过网络共享进行编译非常慢。随着智能感知数据库的重新生成，您的开始时间将会很糟糕。每次编译都必须通过网络多次。链接需要永远。

如果您需要网络上的编译输出，我建议您在本地进行编译并定义一个构建后命令以将结果复制到您的共享中。

如果，正如你所说，你不能把所有东西都拉到本地，那么我建议你的项目太大，需要分解成更易于管理的块。对于多层应用程序，将其逐层分解并投资于某种形式的持续集成（例如 CruiseControl）以自动构建各个部分。通过这种方式，您可以在本地处理特定部分并从 CI 中提取预构建部分以用于应用程序的其他部分。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T14:05:57.653

对于使用 VS 通过网络共享加载项目存在性能问题，我并不感到非常惊讶。VS（任何语言）不断从项目中的文件中获取信息。一旦你开始通过网络加载它，你就会受到底层网络连接的支配。所有滞后和访问问题将直接转化为 VS 在加载文件内容时出现问题。

我建议在本地复制解决方案并使用某种形式的源代码控制来同步共享上的项目。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-10T05:52:37.990

如果代码太复杂无法安装在每个人的机器上，那就不要把它放在每个人的机器上。每个人都需要拥有*一切*才能进行富有成效的工作吗？

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-27T19:25:08.207

我的解决方案中有 79 个项目可供我使用。几十万行代码。我每天从 TFS 中提取源代码并构建它；它有很多代码，但它比尝试通过网络共享工作要好得多。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-05-15T13:47:19.760

将源代码放在共享上的一种更合理的情况是，当一个非 Windows 主机上运行着（多个）虚拟 Windows 机器时。

我有这种确切的情况，我的台式机（*主机*）正在运行 Debian，我使用 VMware 运行各种虚拟 Windows 机（*来宾*），包括安装了 Visual Studio 的一台，以便我可以针对 Windows 操作系统。将源代码放在主机上的 Samba 共享中具有以下优点：

*   源不重复，因此在同时在多个虚拟机上工作时，无法混淆不同的副本。
*   我可以完全控制我喜欢的操作系统的源代码。
*   我可以打开和关闭任何虚拟机，或者回滚到快照，而不会有丢失更改的风险。
*   **我可以在多台机器上从同一个**源构建（等），**而无需**在源完全测试之前提交更改（原因：我必须使用 Subversion <1.5）。

此设置的*唯一*问题是 Visual Studio (6,7,8,9) 非常缓慢。

我已经使用“relatime”安装了分区（共享所在的分区），并且只要共享上的磁盘活动适中，它就可以工作，但是 Visual Studio 一直保持（虚拟）网卡被占用。

对此的任何解决方案将不胜感激。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T14:03:06.037

每次我通过网络驱动器工作（工作=其他任何东西，然后只是复制/粘贴文件）时，我都会遇到类似的问题。ZendStudio 和 Eclipse 出现了问题。

为什么不使用任何类型的源代码控制？

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T14:04:15.237

在处理基于 Windows 的项目时，我总是在本地工作。

一旦在 unix 商店 (AIX iirc) 开发人员将通过 NFS 挂载和通过 RCS 签入/签出工作......

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T15:05:50.770

我在网络共享上使用 VS2005，没有任何性能问题。但是，它是一个新服务器（Windows Server 2008）。我没有 VS 的任何其他数据点，因为在工作中使用它对我来说相对较新。

但是，在网络共享上使用 Netbeans 进行先前项目的一些数据点...我的项目的本地构建时间在 Vista 上为 2 分钟，在快速双核 AMD 64 位机器上。对于网络共享项目，在 Server 2003 机器上，需要 20 分钟。从一台在本地运行 XP 的古老 Tablet PC（1ghz，单核）构建相同的项目大约需要 5 分钟。有趣的是，Tablet PC 可以在同样的 5 分钟内构建在 Server 2003 机器上。

对于那些在网络共享上询问“为什么”的人。网络共享会自动备份、存档等。此外，这样我可以很容易地从多台机器上查看相同的项目，而不必担心推回存储库等。一旦你去拥有你的开发设备上的东西，您可以从任何地方/任何地方访问它，您再也不想做本地存储了！

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-10T05:13:59.503

我通过网络遇到任何性能问题，它们还不够好。

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-10T05:17:38.357

我认为众所周知，在 Windows 中使用 VS 时，磁盘速度是主要的“缓慢”因素之一。我建造的大多数开发机器都有位于 10k RPM RAID0 驱动器或至少一个 10k RPM 驱动器上的项目。即便如此，有时它似乎也很慢。我想，在 VS2009/VS2010 修复它之前，它就是这样吗？:)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2009-04-28T15:38:46.450

根据我的经验，由于 Intellisense，在网络共享上工作时的延迟为 99%。禁用它，你会看到。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2009-11-26T15:16:43.333

禁用 Intellisense 确实可以显着加快通过 UNC 共享保存和打开文件的速度

[http://blogs.msdn.com/saraford/archive/2007/12/03/did-you-know-how-to-turn-off-intellisense-by-default.aspx](http://blogs.msdn.com/saraford/archive/2007/12/03/did-you-know-how-to-turn-off-intellisense-by-default.aspx)

但是话又说回来，正如其他评论中所述，您不妨使用一个好的文本编辑器

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2012-01-10T12:09:23.647

我也遇到过上述性能问题。它似乎因项目而异，但我确实找到了一种方法可以**显着**提高某些项目类型的性能。

按照[本文](http://imar.spaanjaars.com/364/how-do-i-allow-my-visual-studio-net-projects-to-run-from-a-network-location)中的建议，以前在网络位置上无法使用的项目（打开一个文件需要几分钟）几乎可以像本地项目一样执行。基本要点是您需要授予`FULL TRUST`网络位置：

要授予网络上 Visual Studio Projects 文件夹中所有项目的权限，请执行以下 8 个步骤：

> 打开 Microsoft .NET Framework 1.1（或 2.0）配置，您可以在“控制面板”的“管理工具”下找到该配置。
> 
> 展开运行时安全策略 | 机器, | 代码组 | 全部代码 | LocalIntranet_Zone 在右侧窗格中，单击添加子代码组。
> 
> 在随后的对话框中，选择创建新代码组并填写名称，如 Visual Studio Projects。
> 
> （可选）提供代码组的描述。（当您单击左侧树中的代码组时，您将看到说明，帮助您识别您可能拥有的各种代码组）。
> 
> 在条件类型下拉列表中，选择 URL
> 
> 对于 URL 字段，键入如下内容：
> 
> ```
> file://YourServer/My Documents/Visual Studio Projects/* 
> ```
> 
> 在使用现有权限集下，选择 FullTrust（即，如果您信任自己的应用程序。如果不信任，请选择不同的权限集或创建新的权限集）。

不知道为什么会这样，但它使以前无法使用的 NET 2.0 项目的性能显着提高。

原文：http: [//imar.spaanjaars.com/364/how-do-i-allow-my-visual-studio-net-projects-to-run-from-a-network-location](http://imar.spaanjaars.com/364/how-do-i-allow-my-visual-studio-net-projects-to-run-from-a-network-location)

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2014-10-15T13:54:59.950

我遇到了同样的问题。我有一个我们的构建系统的本地副本，它需要某些驱动器号，并且也遇到了缓慢的问题。

我通过添加以下注册表项解决了这个问题：

[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Session Manager\DOS 设备] "R:"="\DosDevices\D:\devel\build "S:"="\DosDevices\D:\devel\src"

请注意，上面的双 '\' 是 .reg 文件格式的一部分。使用 regedit 时，始终使用单个“\”。

我的构建时间除以 3。:)

我在 SUBST 命令的维基百科文章中找到了信息。

# c# - C#中泛型的参数问题

> ID：734398
> 
> 赞同：3
> 
> 时间：2009-04-09T14:02:30.780
> 
> 标签：c#, generics, parameters

我有这样的课：

```
Class foo<T> 
{
  anotherfoo<T>;

  foo(){}
  foo(foo<T> aFoo)
  { anotherfoo = aFoo; }
}
void main() 
{
foo<string> obj1 = new foo<string>();
foo<int> obj2 = new foo<int>(obj1);
} 
```

这次我得到一个错误：无法从 foo<string> 转换为 foo<int>。

但是我需要在这个类“foo”中有另一个类型的另一个 obj foo，这可能吗？

* * *

## 回答 #1

> 赞同：12
> 
> 时间：2009-04-09T14:04:54.923

您的班级`Foo<T>`有一个 type 字段`Foo<T>`。这意味着您为类型选择的任何内容都`T`将决定该字段的类型。

另一种方法可能是提供一个非泛型基类（或接口）：

```
public abstract class FooBase
{
}

public class Foo<T> : FooBase
{
    private FooBase _anotherFoo;
    ...
} 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T14:14:08.240

您可以让 Foo 实现非通用接口并在其中公开非通用功能。

```
interface IFoo {
  // add whatever you need here
}

class Foo<T>: IFoo {
  IFoo anotherfoo;

  Foo(){}
  Foo(IFoo aFoo)
  { anotherfoo = aFoo; }
}

void main() {
  Foo<string> obj1 = new Foo<string>();
  Foo<int> obj2 = new Foo<int>(obj1);
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T15:28:21.267

另一种选择是将您的类型 T 限制为 IConvertible。

如果您这样做，您可以添加一个方法，该方法使用 IConvertible.ToType 构造特定类型的 foo 以将其直接转换为您的类型。

这适用于 string 和 int，以及任何其他实现 IConvertible 的类型，但仅限于这些类型。

# iphone - 使用 NSTimer 获得准确的计时

> ID：734399
> 
> 赞同：2
> 
> 时间：2009-04-09T14:02:41.000
> 
> 标签：iphone, cocoa

我需要以非常准确的时间运行我的游戏循环。我正在尝试使用 NSTimer 来执行此操作，并且我得到了不错的结果，但是有一点偏差。当 NSTimer 触发时，下一次事件在处理程序完成时开始计数还是立即开始计数。如果前者对我来说是合理的，我可以使用 setFireDate 来尝试抵消下一次计时器触发 - 当我尝试这种情况时，情况似乎更糟。

我的计时器设置为每 44 毫秒触发一次，我想阻止它漂移超过 20 毫秒。如果它确实漂移，我想为下一次火灾纠正它。尝试使用 NSTimer 做这件事是否合理？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T14:13:58.383

我不认为 N​​STimer 会给你“非常”准确的时间。它在运行循环上触发，所以如果它在你的主线程中，那么它会被从 UI 更新到事件处理的所有事情延迟。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T16:00:41.437

您可以尝试创建一个线程并在该线程的运行循环上安排您的计时器。将该计时器作为该运行循环上唯一的东西应该限制可以干扰它的东西的数量。

如果这不起作用，那么你已经让它在一个线程上工作，所以你也可以切换到一个 usleep() 循环。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-07-19T21:33:12.467

另请记住，NSTimer 文档指出：

> 由于典型的运行循环管理的各种输入源，计时器的时间间隔的有效分辨率被限制在 50-100 毫秒的数量级。如果在运行循环处于未监视计时器的模式或长时间调用期间发生计时器的触发时间，则计时器不会触发，直到运行循环下次检查计时器。因此，定时器触发的实际时间可能是计划触发时间之后的一个重要时间段。

# c# - 使用 HttpWebRequest 通过 PUT 上传文件时出错

> ID：734404
> 
> 赞同：3
> 
> 时间：2009-04-09T14:04:12.603
> 
> 标签：c#, networking

我们有一个 .NET 2.0 WinForms 应用程序，它需要通过 WebDav 将文件上传到 IIS6 服务器。我们不时收到来自远程办公室的投诉，称他们收到以下错误消息之一

*   底层连接已关闭：发送时发生意外错误。
*   底层连接已关闭：接收时发生意外错误。

这似乎只发生在大文件（~20Mb plus）上。我已经使用家用计算机上的 40Mb 文件对其进行了测试，并尝试将“睡眠”置于循环中以模拟慢速连接，因此我怀疑它最终归结为网络问题......但是

1.  远程办公室的 IT 无济于事
2.  我想排除我的代码有问题的可能性。

所以 - 任何人都可以发现任何错误或提出任何可能“防弹”代码来解决这个问题的解决方法。谢谢你的帮助。代码的缩减版本如下：

```
 public bool UploadFile(string localFile, string uploadUrl)
    {
        HttpWebRequest req = (HttpWebRequest)WebRequest.Create(uploadUrl);

        try
        {
            req.Method = "PUT";
            req.AllowWriteStreamBuffering = true;
            req.UseDefaultCredentials = Program.WebService.UseDefaultCredentials;
            req.Credentials = Program.WebService.Credentials;
            req.SendChunked = false;
            req.KeepAlive = true;
            Stream reqStream = req.GetRequestStream();
            FileStream rdr = new FileStream(localFile, FileMode.Open, FileAccess.Read);
            byte[] inData = new byte[4096];
            int bytesRead = rdr.Read(inData, 0, inData.Length);

            while (bytesRead > 0)
            {
                reqStream.Write(inData, 0, bytesRead);
                bytesRead = rdr.Read(inData, 0, inData.Length);
            }

            reqStream.Close();
            rdr.Close();

            System.Net.HttpWebResponse response = (HttpWebResponse)req.GetResponse();
            if (response.StatusCode != HttpStatusCode.OK && response.StatusCode!=HttpStatusCode.Created)
            {
                MessageBox.Show("Couldn't upload file");
                return false;
            }
        }
        catch (Exception ex)
        {
            MessageBox.Show(ex.ToString());
            return false;
        }
        return true;
    } 
```

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-05-20T06:11:15.497

尝试将[KeepAlive](http://msdn.microsoft.com/en-us/library/system.net.httpwebrequest.keepalive.aspx)设置为 false：

```
req.KeepAlive = false; 
```

这将允许关闭并再次打开连接。它不允许使用[持久连接](http://en.wikipedia.org/wiki/HTTP_persistent_connections)。我在网上找到了很多建议这样做的参考资料，以解决与您的错误类似的错误。这是一个相关[链接](http://connectionstringexamples.com/article.php?story=underlying-connection-closed)。

无论如何，使用 HTTP PUT（或 HTTP POST）上传大文件并不是一个好主意。最好使用 FTP 或下载/上传管理器。这些将自动为您处理重试、连接问题、超时。上传速度也会更快，您也可以恢复停止的上传。如果您决定继续使用 HTTP，您至少应该尝试添加重试机制。如果上传时间过长，那么由于代理、服务器超时、防火墙或任何不使用代码的原因，它很可能会失败。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-05-21T12:28:29.037

要消除代码中出现错误的风险，请尝试使用[`WebClient`](http://msdn.microsoft.com/en-us/library/system.net.webclient.aspx)：

```
using (WebClient client = new WebClient())
{
    client.UseDefaultCredentials = Program.WebService.UseDefaultCredentials;
    client.Credentials = Program.WebService.Credentials;
    client.UploadFile(uploadUrl, "PUT", localFile);
} 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-05-20T04:53:54.363

也许尝试使用 POST，但真正的罪魁祸首可能是内容类型。

尝试设置

```
req.ContentType = "application/octet-stream";
req.ContentLength = inData.Length; 
```

或在此处查看已接受答案中的代码：[Upload files with HTTPWebrequest (multipart/form-data)](https://stackoverflow.com/questions/566462/upload-files-with-httpwebrequest-multipart-form-data)

我的示例和我提供的链接都涉及修改 ContentType - 我的示例更简单但可能不起作用，因为大多数接收文件的应用程序都需要多部分

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-05-25T07:10:29.477

请检查 IIS 管理器的 [Web Site] 选项卡中的 [Enable Http Keep-Alives] 是否设置为 [on]。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T14:57:28.997

上传的大小可能会受到限制。

请参阅此处进行讨论： http: [//www.codeproject.com/KB/aspnet/uploadlargefilesaspnet.aspx](http://www.codeproject.com/KB/aspnet/uploadlargefilesaspnet.aspx)

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-05-21T20:17:45.253

首先检查一些基本配置。以下任一的默认值可能会导致文件上传出现问题 - 包括连接终止。我相信 IIS 6 永远不会允许文件上传 > 2GB（即使它可以完成，无论配置如何）。[Msdn 很好地描述了这些](http://msdn.microsoft.com/en-us/library/e1f13641(VS.80).aspx)。

```
<httpRuntime executionTimeout = "30"  maxRequestLength="200"/> 
```

编辑：当然，这是 ASP.NET 配置，它假定您在 ASP.NET 中运行自己的 webdav 服务器或 [第 3 方服务器](http://www.webdavsystem.com/)。如果它是不同的 webdav 服务器，您将需要寻找等效的服务器。

# windows - 我无法获取崩溃转储文件

> ID：734408
> 
> 赞同：0
> 
> 时间：2009-04-09T14:04:49.917
> 
> 标签：windows, visual-c++, crash

当我停止服务器时，我崩溃了。但是我看不到这次崩溃的任何转储文件。为什么没有创建转储文件。如果可能的话，任何人都可以让我知道将在哪里创建转储文件。

谢谢哈拉纳德

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T02:13:05.180

安装[Windows 调试工具](http://www.microsoft.com/whdc/devtools/debugging/default.mspx)，在停止服务器之前在 cmd 行执行：

"C:\Program Files\Debugging Tools for Windows (x86)\adplus" -pn process-name.exe -hang -o path-of-output-files

并为您创建转储文件。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T15:14:59.483

首先：您正在运行什么“服务器”？主机操作系统？

# c# - 来自 Python 的漂亮打印 C#

> ID：734413
> 
> 赞同：1
> 
> 时间：2009-04-09T14:05:37.577
> 
> 标签：c#, python, ruby, parsing, pretty-print

假设我用 Python 或 Ruby 编写了一个编译器，可以将一种语言翻译成 C# AST。

如何从 Python 或 Ruby 漂亮地打印此 AST 以获得良好缩进的 C# 代码？

```
Thanks, Joel 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T14:14:26.150

在 python 中，[pprint](http://docs.python.org/library/pprint.html)模块可用。

根据您的数据的结构方式，它可能不会返回您要查找的结果。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-11T01:50:20.623

一旦你有了 AST，这应该很容易。当你走你的 AST 时，你所要做的就是跟踪你当前的缩进级别是什么——你可以使用一个全局的。遍历树的代码只需要在每次进入块时增加缩进级别，并在退出块时减少缩进级别。然后，每当您打印一行代码时，您都可以这样调用它：

```
print "\t"*indentlevel + code 
```

您应该得到格式良好的代码。但是，我对您提出这个问题感到有些困惑——如果您具备将 C# 解析为 AST 的技能，我无法想象您将无法编写打印精美的输出函数。:-)

* * *

## 回答 #3

> 赞同：-2
> 
> 时间：2009-04-09T15:17:35.347

一种方法是打印它然后调用代码格式化程序。

# asp.net - 从 ASP .Net Web 服务访问 MSMQ 的权限错误

> ID：734417
> 
> 赞同：3
> 
> 时间：2009-04-09T14:06:10.070
> 
> 标签：asp.net, iis, permissions, msmq, web-services

我编写了一个**从消息队列中读取的 Web 服务**。这在卡西尼下运行良好。

现在我已经在 IIS 下部署了服务，当服务尝试访问队列时我收到一条错误消息：

**队列不存在或您没有足够的权限来执行该操作。**

我已将IIS虚拟目录上的匿名访问用户设置为我自己的域帐户，该帐户是本地计算机上管理员组的成员。我已授予同一用户对队列以及 NETWORK SERVICE 和 ASPNET 的完全权限。

我仍然收到相同的错误消息。

我还尝试禁用对虚拟目录的匿名访问并使用我自己的登录详细信息连接到服务 - 无济于事。

任何有关此问题的帮助将不胜感激！

* * *

我还尝试了以下各种组合：

并且 testUsr 对队列具有完全权限。我在 C:\ 上的 MSMQ 存储文件夹中添加了用户和 ASPNET 的权限

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-14T09:58:31.843

我对这个问题的理解是，尝试执行代码的进程在 IIS 下作为与 Cassini 下不同的帐户运行。

问题在于，无论我模拟的是哪个用户——我总是收到相同的错误消息——即使该用户是本地和域管理员组的成员，并且该用户对队列具有完全权限。即几乎不可能为用户分配更多权限。

事实证明，使用队列的 FormatName 而不是路径名 (myMachine\queueName) 解决了问题......

FormatName:DIRECT=OS:myMachine\myQueue

我不确定为什么会这样。阅读表明，当使用路径名时，有必要进行 AD 查找，尽管我认为我一直在测试的用户应该有权执行此操作，但也许缺少一些东西。

然而，眼前的问题得到了解决，这对我来说已经足够了。

# version-control - 变更集编号

> ID：734422
> 
> 赞同：2
> 
> 时间：2009-04-09T14:07:41.907
> 
> 标签：version-control, changeset

一般使用的系统是什么？是否有通用系统，或者所有 SCM 都只是设置递增数字？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T14:25:12.457

[**单片机**](https://stackoverflow.com/questions/645008/what-are-the-basic-clearcase-concepts-every-developer-should-know/645771#645771)有三种内部编号：

*   以文件为中心的 id（版本 1，版本 2，...），用于 SCM 在文件到文件基本 (ClearCase) 上管理其元素，基于简单的基于 0 的增量
*   以存储库为中心的 id：它建立了一个 ID（Subversion 修订号）用于引用所有文件（同样，简单增量）
*   基于 DAG 的 SCM（有向无环图）的以提交为中心的 id（例如 Git 的 SHA1，意思是基于*内容*），其中文件的历史记录链接到链接到提交的目录之一。

它基于：

*   中央 SCM 的内部基础，或
*   为分布式 SCM 计算的唯一键或散列

这两个标准的组合为您提供了最终的 id。

不应将内部版本号误认为是应用程序版本号（如major.minor.build）

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T14:14:17.227

TFS 使用 TFS 服务器唯一的编号序列

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T14:20:17.010

我认为大多数 SCM 将使用每个跟踪项目的递增数字。例如，Vault 确实支持文件和文件夹的版本控制，因此每个文件都有一个（递增的）版本号，而包含的文件夹也有一个。

分布式 SCM 不能使用递增数字，因此它们将使用哈希、唯一标识符或其他任何东西......

# c# - 如何在 DateFormat 字符串上指定时区？

> ID：734426
> 
> 赞同：0
> 
> 时间：2009-04-09T14:08:39.690
> 
> 标签：c#

我正在尝试在传递给的字符串上指定时区`DateFormat.parse`。我们目前正在使用 .net 框架 2.0。当前代码是

```
DateTimeFormatInfo DATE_FORMAT = CultureInfo.CurrentCulture.DateTimeFormat;
DateTime first = DateTime.Parse("Wed, 31 Oct 2007 8:00:00 -5", DATE_FORMAT); 
```

但是当我这样做时`first.ToString("r")`，结果是

```
Wed, 31 Oct 2007 09:00:00 GMT 
```

我究竟做错了什么？我还尝试使用`DateTime.SpecifyKind`方法将我的 DateTime 对象的 Kind 设置为 Local，但如果时区是字符串的一部分，您似乎需要在解析字符串之前将类型指定为本地。

我的本地时区是 EDT，这就是我最终想要得到的日期。

编辑 - 我们的解决方案：

输入 ：

```
DateTime first = DateTime.SpecifyKind(DateTime.Parse("OCT 31, 2007 8:00 AM", DATE_FORMAT), DateTimeKind.Local); 
```

输出 ：

```
first.ToLocalTime().ToString("our format") 
```

仍然没有找到获取时区缩写的方法，例如“EDT”。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T14:23:21.417

[`ToLocalTime()`](http://msdn.microsoft.com/en-us/library/system.datetime.tolocaltime.aspx)在调用之前使用方法`ToString()`。

```
first.ToLocalTime().ToString(); 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T14:16:17.347

您可以使用“zz”或“zzz”日期格式为您提供 -5 或 -5:00。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T14:26:05.747

当你调用 first.ToString(" **r** "),

这是基于MSDN的

> 表示由 DateTimeFormatInfo..::.RFC1123Pattern 属性定义的自定义日期和时间格式字符串。该模式反映了定义的标准，并且该属性是只读的。因此，无论使用的文化或提供的格式提供程序如何，它总是相同的。自定义格式字符串为“ddd, dd MMM yyyy HH':'mm':'ss 'GMT'”。

可以将定义的格式信息传入ToString，尝试调用该方法

DateTime..::.ToString 方法 (IFormatProvider)

相反，并传递您的 DateTimeFormatInfo 对象。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T14:16:55.677

看看`DateTimeOffset`结构，我认为这就是你需要的。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T14:17:18.110

尝试使用 ParseExact() - 你可以指定去哪里。

在您的情况下，您可以使用以下方法解析它：

```
 string str = "Wed, 31 Oct 2007 8:00:00 -5";
        string fmt = "ddd, dd MMM yyyy H:mm:ss z";

        DateTime d = DateTime.ParseExact(str, fmt, null);
        Console.WriteLine(d); 
```

# svn - 删除了一个添加到 TortoiseSVN 但未提交的文件

> ID：734427
> 
> 赞同：3
> 
> 时间：2009-04-09T14:08:53.713
> 
> 标签：svn, version-control, tortoisesvn

我正在使用 TortoiseSVN。

在我的项目中，我创建了一个目录，将文件放在上面，将所有内容添加到 SVN 源代码控制，但尚未将其提交到存储库。它看起来像这样：

```
/root_project_dir
-> .svn
-> dir1
  -> .svn
-> added_dir
  -> .svn
  -> subdir 
```

但我错误地使用常规 Windows 删除删除了它。现在，如果我再次创建目录，我无法将它添加到 TortoiseSVN，它说：

“包含工作副本管理区域的目录'.../ added_dir/.svn'丢失。请执行“清理”命令。

好的，但是当我运行“清理”命令时，我得到了这个：

“.../ added_dir”不是工作副本目录。

我尝试删除目录，进行清理，再次创建它，但无法成功。

如何再次将此目录添加到版本控制中？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T14:13:31.253

尝试还原添加：右键单击“root_project_dir”文件夹（那是父文件夹，对吗？）并选择“还原”。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T14:12:35.217

`svn revert`对您删除的目录执行操作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T14:14:07.803

在我头顶

```
svn revert --force <dirname> 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T14:11:29.557

尝试在不使用 SVN Add 命令的情况下创建目录。然后提交。

# delphi - IIS 之外的 Delphi 7 ADO 连接池

> ID：734443
> 
> 赞同：0
> 
> 时间：2009-04-09T14:15:28.177
> 
> 标签：delphi, iis, connection, pooling

我们有一个 Delphi 7 应用程序，它在 IIS6 中作为 ISAPI 扩展运行。该代码使用 ADO 连接到 MS SQL 2000 数据库并对数据库执行多次读取（无写入）。如果我在 SQL 分析器中查看审核登录和注销事件，我可以看到对应用程序的大量请求仅导致 1 个审核登录事件。但是，如果我从 IIS 外部运行相同的代码（即在 dll 中调用相同方法的测试应用程序），我会看到许多登录和注销事件。我的猜测是 IIS 正在执行一些自动连接池，而我没有做任何事情。出于性能原因，当我从 IIS 外部运行 dll 时，我希望看到相同的行为 - 在这种情况下，应用程序几乎慢了 100%。当 dll 在 IIS 之外运行时，如何获得 ADO 连接池？

编辑 - 我实际上正在使用 SQL ole 提供程序。连接字符串如下所示：

提供程序=SQLOLEDB.1；初始目录=%s；数据源=%s；密码=%s；用户 ID=%s；池=True；最小池大小=5；最大池大小=50；连接寿命=120

我尝试添加 Pooling=True 属性，但这并没有改变。此外，我了解到审核登录和注销事件不一定会因连接池而改变，因此我开始使用 Logins/sec、Logouts/sec 和 User Connections 性能计数器 (SQLServer:GeneralStatistics) 来确定是否发生连接池。从 IIS 内部，我看到许多登录/秒，而没有注销/秒。在 IIS 之外，我看到每秒有很多登录和注销，并且用户连接会波动（它在 IIS 中保持稳定）。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-10T17:06:28.090

根据给定的信息很难说，但是连接池绝对是基于连接字符串的——如果连接字符串完全相同，那么连接可以被池化......听起来你的外部应用程序可能正在改变连接细绳？

IIS 没有池化 ADO 连接。不过，它可能会缓存 ISAPI dll。您是否连续启动/停止您的外部应用程序？还是一次运行导致多个登录事件？

# sharepoint - MOSS 2007 搜索中心。更改搜索范围

> ID：734444
> 
> 赞同：2
> 
> 时间：2009-04-09T14:16:03.383
> 
> 标签：sharepoint, search, moss

我正在创建一个新的 Sharepoint 网站集，作为一个子网站，我有一个搜索中心。

创建新的内容搜索（文件共享）后，我可以使用主页的下拉菜单进行搜索。

使用范围“All”搜索“sharepoint”：返回 4 个项目

使用范围“ISO 和工具”搜索“sharepoint”：返回 2 个项目

现在我正在尝试将搜索中心配置为使用此搜索范围。但是每次我进行搜索时，都会返回结果，因为我选择了范围“全部”，即 4 项！

如何将搜索配置为在特定范围内进行？

提前致谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-13T16:29:14.503

如果您的意思是搜索中心中的默认搜索页面始终搜索“全部”范围 - 好吧，确实如此！

如果您编辑页面，您应该能够编辑搜索框的属性。在这些属性中，您可以附加到搜索查询“范围：”和范围名称。不过，此范围将显示在您的结果页面的搜索框中。

或者，创建一个新的结果页面。在搜索核心结果 Web 部件中，您可以设置用于结果的范围 - 这是一个杂项属性。

然后，您需要编辑搜索中心的主页，将那里的搜索框指向您的新结果页面，并在新结果页面本身上进行同样的操作。

见[http://andrewwburns.com/2009/02/20/search-a-single-list-and-dont-use-the-osssearchresultsaspx-page/](http://andrewwburns.com/2009/02/20/search-a-single-list-and-dont-use-the-osssearchresultsaspx-page/)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-10T19:21:17.563

确保您已通过共享服务管理员重置/重新抓取您的内容。

通过在 SiteCollection 的搜索设置中添加“ContentSource”规则，确保将 Scope 限制为正确的内容源

确保您已更新共享服务中的范围。

# wcf - 为什么 WCF 不能序列化 long 或 int？

> ID：734455
> 
> 赞同：1
> 
> 时间：2009-04-09T14:18:39.463
> 
> 标签：wcf, serialization

我不是 100% 确定正确的术语是什么，但是..

我有一个名为 InParams 的类，它有两个字段，一个字符串和一个 long 以及它们对应的属性访问器。它们分别用 [DataContract] 和 [DataMember] 装饰。

我有一个名为 void Test(InParams inParams) 的 WCF 服务方法

使用 svcutil 生成的代理很好，我能够设置长字段，但是当执行服务方法时，长字段始终为 0，即使我明确设置了长字段。我看了看肥皂信封，没有看到我的长领域的标签。

当我将长字段更改为字符串字段时，它会被序列化。这对于整数也是一样的。

我错过了一个属性还是什么？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T14:27:15.527

你可以发布一个样本吗？仔细检查：

*   确保类具有 [DataContract()] 装饰
*   确保**PUBLIC**属性具有 [DataMember()] 装饰

通过删除/重新生成代理类来确保它是最新的。看看有没有区别？

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-12-15T15:12:14.257

If you have a boolean YourPropertyNameSpacified property on the client in addition to YourPropertyName, you must set it to true on the client. This goes for all fields of value type, I believe. Also see [WCF service proxy not setting "FieldSpecified" property](https://stackoverflow.com/questions/1680356/wcf-service-proxy-not-setting-fieldspecified-property).

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T14:48:02.043

除了执行 Tanner 提到的操作之外，DataContractSerializer 还明确支持 long 和 int。

.NET Framework 基元类型。.NET Framework 中内置的以下类型都可以序列化并被视为原始类型：Byte、SByte、Int16、Int32、Int64、UInt16、UInt32、UInt64、Single、Double、Boolean、Char、Decimal、Object 和细绳。[关联](http://msdn.microsoft.com/en-us/library/ms731923.aspx)

# perl - 为什么从我的网络应用程序调用 PDF::FromHTML 时的行为会有所不同？

> ID：734458
> 
> 赞同：1
> 
> 时间：2009-04-09T14:19:41.223
> 
> 标签：perl, pdf, pdf-generation

我正在使用 PDF::FromHTML 从 HTML 生成 PDF（正如模块名称所暗示的那样）:)

我可以从命令行很好地运行它并接收我的预期输出 - 但是当我在我的网络应用程序中使用**完全相同的代码**时，输​​出看起来根本不正确 - 文本出现在错误的位置而不是这一切都在出现。

我在 Web 应用程序和命令行中使用**完全相同的输入文件**- 出于某种原因，当从我的 Web 应用程序内部调用它时，它的显示方式有所不同。

这是代码：

```
use PDF::FromHTML;

my $filename = '/tmp/backup.html';

my $font      = 'Helvetica';
my $encoding  = 'utf-8';
my $size      = 12;
my $landscape = 0;

my $pdf = PDF::FromHTML->new(
 encoding => $encoding,
);

my $input_file = $filename;
my $output_file = "$input_file.pdf";

warn "$input_file\n$output_file\n";
$pdf->load_file($input_file);
$pdf->convert(
  Font        => $font,
  LineHeight  => $size,
  Landscape   => $landscape,
);

$pdf->write_file($output_file); 
```

Web 应用程序代码是相同的，只是将该块放入方法中。

我在十六进制编辑器中查看了两个生成的 PDF 文件并发现了差异。在我无法理解其意图的块之前，它们是相同的......

该块的良好PDF内容：

```
/Length 302 >> stream
**binary data
endstream endobj
10 0 obj << /Filter [ /FlateDecode ] /Length 966 
```

错误的 PDF 内容：

```
/Length 306 >> stream
**binary data
endstream endobj
10 0 obj << /Filter [ /FlateDecode ] /Length 559 
```

如您所见，此处包含的内容的长度不同，该流中包含的二进制数据（长度 302 与长度 306 一个）以及下一个流（长度 966 与 559 一个）中包含的二进制数据也是如此。

我不完全确定是什么导致了这种差异，我唯一能想到的就是当我在命令行上以用户身份运行它与从 Web 应用程序运行它时，环境中的某种差异。但是，我不知道应该从哪里开始调试。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T15:30:59.357

一般来说，CGI 环境与您的交互式登录环境不同，就像其他人的登录环境与您的不同一样。诀窍是弄清楚你在命令行上设置或取消设置的哪些东西使你的程序工作。

您可能希望查看我的[Perl CGI 脚本疑难解答](http://www.perlmonks.org/?node_id=380424)，以了解跟踪这些问题的分步方法。

需要调查的一些事情：

*   您的 CGI 脚本是否在同一平台上运行（即它是 Windows 还是 Unix 之类的东西）
*   环境变量有什么不同？
*   您的 CGI 脚本是否使用相同版本的 Perl？
*   那个 perl 二进制文件有不同的编译选项吗？
*   您是否使用相同版本的模块？
*   如果其中一些模块使用外部库，它们是否相同？

一个有用的技术是让您的登录 shell 临时具有与您的 CGI 环境相同的设置。一旦你这样做了，即使这些结果是错误的，你也应该在命令行上得到相同的结果。但是，一旦您得到错误的结果，您就可以从命令行开始跟踪它。

祝你好运。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-15T20:13:07.553

几个建议：

*   PDF::FromHTML 使用 PDF::Writer，后者又使用 PDF 渲染库作为插件（认为选项是 PDFLib 和其他一些）。相同版本的库是否可用作插件？
*   您的 HTML 输入文件是否有您尚未上传的 CSS 文件？
*   尝试设置其他 PDF::FromHTML 变量：PageWidth、PageResolution、PageSize 等

输出文本的顺序是不同的还是仅仅是位置不同？如果它的位置然后尝试将 PageWidth 等设置为正在使用的库（PDFLib 或其他）可能会在两个环境之间选择不同的默认值。如果订购错误，那么我不知道。

您发布的两个 PDF 块并没有真正显示太多 - 只是显示压缩部分的大小不同。这两个示例在语法上实际上都没有错误。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-17T07:02:42.863

也许有一些编码问题？看看标题。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-17T21:12:00.310

我会好好看看 Web 服务器以什么用户身份运行以及用户环境变量是什么样的。还要注意用户对目录的权限。还有其他限制Web服务器用户的东西，例如Linux机器上的SElinux吗？

# hibernate - 休眠，更改标识符/主键

> ID：734461
> 
> 赞同：18
> 
> 时间：2009-04-09T14:20:40.923
> 
> 标签：hibernate, primary-key

当我尝试更改我`@ID`的`@Entity`.

```
identifier of an instance of com.google.search.pagerank.ItemEntity was altered from 1 to 2. 
```

我知道我正在更改表中的主键。我正在使用 JPA 注释。

我通过使用这个单一的 HQL 查询解决了这个问题：`update Table set name=:newName where name=:oldName`

而不是使用更多的OO方法：

```
beginTransaction();
T e = session.load(...);
e.setName(newName);
session.saveOrUdate(e);
commit(); 
```

知道差异是什么吗？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2010-02-07T14:31:12.830

实际上，根据 JPA 规范，禁止更改主键：

> 应用程序不得更改主键的值[8]。如果发生这种情况，则行为未定义。 [9]

（来自 EJB 3 持久性 (JPA) 规范，第 2.1.4 段）

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-10T15:45:39.873

我无法想象你为什么要这么做。完全没有。为什么要更改实体的身份？您还需要更新指向它的其他表中的所有外键。好像很痛苦，没有收获。您最好将其设为“业务密钥”（普通属性）并使用更永久的代理密钥。我有一种感觉，你做这一切都错了，但如果你坚持...

本质上，您所做的是创建一个新客户并删除旧客户，这就是我在 Hibernate 中完成它的方式。

[伪代码]

```
Begin Transaction

// create new customer from old
newC = Session.Load<Customer>(42)
Session.Evict(newC)
newC.Id = 1492
Session.Save(newC)

// update other relationships to point to newC
// ....

// delete old customer
oldC = Session.Load<Customer>(42)
Session.Delete(oldC)

Commit Transaction 
```

但是，您最好只在一个普通的单个 SQL 事务中一次完成所有操作，并且在任何一种情况下，您都可能面临已经拥有“旧”客户实例的并行进程的风险，这可能会导致一些错误。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-06-12T09:04:20.253

我的朋友，你是对的。如果不使用 HQL 语句，就无法（或者我不知道如何）更改主键。这不正常，但这是真的。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2011-03-25T17:55:14.233

这不是一个解决方案，因为我相信上面已经回答了。

但是，我想提供我认为是想要这样做的有效方案。（欢迎评论）

1) 表 USER_ELECTRONICS 与表 ELECTRONICS_DEF 多对多

2）这个多对多是一个有序列表。每个 USER_ELECTRONIC_ID 都有一个 ELECTRONICS_DEF_ID 的优先列表。例如，我有一部 iPhone、一部 iPad、手机，我按照我喜欢它们的程度对它们进行排名。为了做到这一点，我有 USER_ELEC_PRIORITY_MAP 表，看起来像这样 -

`USER_ELEC_ID` `ELEC_DEF_ID` `PRIORITY`

`1` `IPAD` `1`
`1` `IPHONE` `2`
`1` `CELL` `3`

USER_ELEC_ID 和 ELEC_DEF_ID 是 PFK。优先级是复合 FK。

3) 当我想根据我的偏好重新编排表格时（我的新 iPad2 位居榜首，iPad 移动到 #4），我需要更新部分复合 FK（优先级）。

# asp.net - 如何访问 DataGrid 的选定 BoundColumn 的文本？

> ID：734465
> 
> 赞同：1
> 
> 时间：2009-04-09T14:23:00.233
> 
> 标签：asp.net, datagrid, boundcolumn

```
<asp:DataGrid ID="dgResetPassword" DataKeyField="user_id" OnItemCommand="resetSelect" CellPadding="10" HeaderStyle-BorderStyle="none" AutoGenerateColumns="False" runat="server" ForeColor="#333333" GridLines="None" Width="550px">
        <Columns>
            <asp:ButtonColumn DataTextField="sap_id" HeaderText="SAP ID" />
            <asp:BoundColumn DataField="lastname" HeaderText="Last Name" />
            <asp:BoundColumn DataField="firstname" HeaderText="First Name"/>
            <asp:BoundColumn DataField="username" HeaderText="User Name"/>
            <asp:BoundColumn DataField="jobtitle" HeaderText="Job Title"/>
            <asp:BoundColumn DataField="orgunit" HeaderText="Organization Unit"/>
        </Columns>
        <FooterStyle BackColor="#5D7B9D" Font-Bold="True" ForeColor="White" />
        <EditItemStyle BackColor="#999999" />
        <SelectedItemStyle BackColor="#E2DED6" Font-Bold="True" ForeColor="#333333" />
        <PagerStyle BackColor="#284775" ForeColor="White" HorizontalAlign="Center" />
        <AlternatingItemStyle BackColor="White" ForeColor="#284775" />
        <ItemStyle BackColor="#F7F6F3" ForeColor="#333333" />
        <HeaderStyle BackColor="#5D7B9D" BorderStyle="None" Font-Bold="True" ForeColor="White" />
    </asp:DataGrid> 
```

那是网格，这里是函数...

```
Sub resetSelect(ByVal s As Object, ByVal e As DataGridCommandEventArgs)
    lblResponse.Text = [want to access text of username here]
    lblResponse.Visible = True
    lblID.Text = dgResetPassword.DataKeys.Item(e.Item.ItemIndex)
End Sub 
```

如何为用户名引用所选项目的 DataField 文本？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T14:39:35.810

用户名在第三列。所以你可以这样做（C#）：

```
lblResponse.Text = e.Item.Cells[3].Text; 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2015-08-28T18:36:19.860

这将是 VB.net 的做法。

```
lblResponse.Text = e.Item.Cells(3).Text 
```

设置一个表示列及其索引的枚举可能对您有益。因此，您的代码将成为

```
lblResponse.Text = e.Item.Cells(DataColumns.Username).Text 
```

# regex - 如何使用 URL 重写从 URI 中去除 index.php？

> ID：734468
> 
> 赞同：1
> 
> 时间：2009-04-09T14:23:54.723
> 
> 标签：regex, .htaccess, mod-rewrite

这就是我需要的-

1.  正则表达式匹配 url 模式并将其重写为其他内容
2.  301 将旧模式重定向到新模式

这就是我所拥有的-

我有一个目前看起来像这样的 url 模式——

[http://www.foo.com/press/index.php/2009/4-reasons-to-buy-now/](http://www.foo.com/press/index.php/2009/4-reasons-to-buy-now/)

我想在 url“ [http://www.foo.com/press/index.php/](http://www.foo.com/press/index.php/) ”上创建一个模式匹配并重写以删除“/index.php”，新的 url 将是 -

[http://www.foo.com/press/2009/4-reasons-to-buy-now/](http://www.foo.com/press/2009/4-reasons-to-buy-now/)

但我希望将其作为重定向和重写的模式匹配，因此其他 url 也将被删除“/index.php”，该“/index.php”将*始终*落在[http://www.foo.com/press/之后](http://www.foo.com/press/)

提前感谢您的帮助！

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T14:39:27.837

```
RewriteRule ^press/index.php/(.*) /press/$1 [R=301] 
```

# version-control - 是否有构成版本（修订）更改的标准定义

> ID：734470
> 
> 赞同：5
> 
> 时间：2009-04-09T14:24:11.663
> 
> 标签：version-control, standards

我目前在公司的官僚地狱中，需要定义对我们的测试程序进行不同级别的软件更改的构成。我们有一个内部遵循的粗略做法，但我正在寻找一个标准（如果存在）以在我们的质量体系中参考。我认识到开发人员之间的系统可能会有很大差异，但最终我正在寻找一个“最佳实践”指南，说明什么是重大变化、微小变化等。我想在提交给我们的质量系统时参考一个已发布的文档如果可能，ISO 目的。

澄清我公司开发的软件在内部用于半导体的测试自动化。我们不出售此代码，版本控制实际上仅用于记录保存。我们正在使用 xyz 更改来影响发布所需的签核和批准级别。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T14:35:15.773

一个好的做法是使用 3 级修订号：

xyz

x 是主要的 y 是次要的 z 是错误修复

重要的是具有相同 x 的两个不同软件版本应该具有二进制兼容性。ay 大于另一个的软件版本，但相同的 x 可能会添加功能，但不会删除任何功能。这确保了在同一主要号码内的可移植性。最后 z 不应该改变任何功能行为，除了错误修复。

* * *

编辑：

以下是一些使用的修订号方案的链接：

*   [http://en.wikipedia.org/wiki/Software_versioning](http://en.wikipedia.org/wiki/Software_versioning)
*   [http://apr.apache.org/versioning.html](http://apr.apache.org/versioning.html)
*   [http://www.advogato.org/article/40.html](http://www.advogato.org/article/40.html)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T14:51:11.427

我会将内部版本号添加到 xyz 格式：

xyzbuild

x = 主要功能更改
y = 次要功能更改
z = 仅修复错误
build = 每次编译代码时递增

包括内部版本号对于人们试图弄清楚他们拥有的二进制文件中是否存在特定更改的内部目的至关重要。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T14:48:20.140

要放大@lewap 所说的内容，请使用

xyz

其中 z 级别的更改几乎完全是错误修复，不会更改接口或涉及外部系统

其中 y 级别更改添加功能并可能更改 UI/API 接口，此外还修复可能涉及外部系统的更严重的错误

其中 x 级别更改涉及从完全重写/重新设计到仅更改数据库结构到更改数据库（即从 Oracle 到 SQLServer）的任何事情 - 换句话说，任何不是需要“端口”或“转换”的更改的下降“ 过程

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-07-09T21:54:57.200

正如我之前在回答类似问题时所说：使用的术语不是很精确。有一篇文章描述了五个相关维度。用于软件开发的数据管理工具往往不会同时一致地支持三个以上的工具。如果你想支持所有五个，你必须描述一个开发过程：

*   版本（语义：修改）
*   视图（语义：等价，推导）
*   层次结构（语义：包括）
*   状态（语义：批准、可访问性）
*   变体（语义：产品变体）

Peter van den Hamer 和 Kees Lepoeter (1996) 管理设计数据：CAD 框架、配置管理和产品数据管理的五个维度，IEEE 会议记录，卷。84，第1号，1996年1月

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T19:09:37.163

我认为，如果您正在开发内部软件与外部软件（产品），它可能会有所不同。

对于内部软件，使用正式定义的方案几乎永远不会成为问题。然而，对于产品而言，版本或发布号在大多数情况下是不反映任何技术或功能标准的商业决策。

在我们公司，xyz 编号方案中的 xy 由营销男孩和女孩确定。z 和内部版本号由研发部门确定，并追溯到我们的修订控制系统，并与生成它的 sprint 相关（sprint 是迭代的 Scrum 术语）。

此外，正式定义版本和发行版之间的某种程度的兼容性可能会导致您非常快速地升级或几乎不升级。这可能不会反映添加的功能。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T19:19:40.523

我认为让您向您的同事解释这一点的最佳方法是通过从知名和成功的软件包中提取的示例，以及它们处理主要和次要版本的方式。

我要说的第一件事是，用于发布的major.minor 点表示法是一项相对较新的发明。例如，大多数 UNIX 版本实际上都有名称（有时包括一个无意义的数字）而不是版本号。

但是假设您要使用major.minor 编号，那么主编号表示的版本基本上与以前的许多版本不兼容。考虑从 Windows 2,0 到 3.0 的变化 - 大多数 2,0 应用程序根本不适合 Windows 3,0 中新的重叠窗口。对于不那么包罗万象的应用程序，文件格式的根本变化（例如）可能是主要版本更改的原因 - WP &n 图形应用程序通常以这种方式工作。

主要版本号更改的另一个原因是用户注意到了差异。从 Windows 2.0 到 3.0 的变化再一次如此，并为后者的成功负责。如果您的应用程序看起来非常不同，那是一个重大变化。

A 表示次要版本号，这通常用于表示实际上非常主要的 chanhe，但用户不会注意到。例如，Win 3.0 和 Win 3.1 的内部差异实际上是相当大的，但界面保持不变。

关于第三个版本号，很少有人知道它的真正含义和更少的关心。例如，在我的日常工作中，我使用 GNU C++ 编译器版本 3.4.5 - 这与 3.4.4 有什么不同 - 我不知道！

# c# - 如何将自定义对象的集合存储到 user.config 文件中？

> ID：734474
> 
> 赞同：34
> 
> 时间：2009-04-09T14:25:15.920
> 
> 标签：c#, configuration, collections, app-config

我想将自定义对象的集合存储在 user.config 文件中，并希望以编程方式从集合中添加和删除项目，然后将修改后的列表保存回配置文件。

我的项目具有以下简单形式：

```
class UserInfo
{
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public string Email { get; set; }        
} 
```

在我的 app.config 中，我已经创建了一个自定义部分：

```
<configuration>
  <configSections>
    <section name="userInfo" type="UserInfoConfigurationHandler, MyProgram"/>

  </configSections>
  <userInfo>
    <User firstName="John" lastName="Doe" email="john@example.com" />
    <User firstName="Jane" lastName="Doe" email="jane@example.com" />
  </userInfo>

</configuration> 
```

我还可以通过实现读取设置`IConfigurationSectionHandler`：

```
class UserInfoConfigurationHandler : IConfigurationSectionHandler
{
    public UserInfoConfigurationHandler() { }

    public object Create(object parent, object configContext, System.Xml.XmlNode section)
    {
        List<UserInfo> items = new List<UserInfo>();
        System.Xml.XmlNodeList processesNodes = section.SelectNodes("User");

        foreach (XmlNode processNode in processesNodes)
        {
            UserInfo item = new UserInfo();
            item.FirstName = processNode.Attributes["firstName"].InnerText;
            item.LastName = processNode.Attributes["lastName"].InnerText;
            item.Email = processNode.Attributes["email"].InnerText;
            items.Add(item);
        }
        return items;
    }
} 
```

我在这篇[文章](http://www.dotneat.net/2007/10/16/StoringACollectionOnYourAppconfigUsingSectionHandlers.aspx)之后做了所有这些。但是，使用这种方法，我只能将app.config 中的设置**读取**`List<UserInfo>`到集合中，但我还需**要写**回修改后的列表。

我正在搜索文档但没有成功，现在我有点卡住了。我错过了什么？

* * *

## 回答 #1

> 赞同：56
> 
> 时间：2009-04-16T15:49:28.503

添加自定义配置的方法（如果您需要的不仅仅是简单类型）是使用 ConfigurationSection，在您定义的架构中，您需要一个 ConfigurationElementCollection（设置为没有名称的默认集合），其中包含一个 ConfigurationElement，如下所示：

```
public class UserElement : ConfigurationElement
{
    [ConfigurationProperty( "firstName", IsRequired = true )]
    public string FirstName
    {
        get { return (string) base[ "firstName" ]; }
        set { base[ "firstName" ] = value;}
    }

    [ConfigurationProperty( "lastName", IsRequired = true )]
    public string LastName
    {
        get { return (string) base[ "lastName" ]; }
        set { base[ "lastName" ] = value; }
    }

    [ConfigurationProperty( "email", IsRequired = true )]
    public string Email
    {
        get { return (string) base[ "email" ]; }
        set { base[ "email" ] = value; }
    }

    internal string Key
    {
        get { return string.Format( "{0}|{1}|{2}", FirstName, LastName, Email ); }
    }
}

[ConfigurationCollection( typeof(UserElement), AddItemName = "user", CollectionType = ConfigurationElementCollectionType.BasicMap )]
public class UserElementCollection : ConfigurationElementCollection
{
    protected override ConfigurationElement CreateNewElement()
    {
        return new UserElement();
    }

    protected override object GetElementKey( ConfigurationElement element )
    {
        return ( (UserElement) element ).Key;
    }

    public void Add( UserElement element )
    {
        BaseAdd( element );
    }

    public void Clear()
    {
        BaseClear();
    }

    public int IndexOf( UserElement element )
    {
        return BaseIndexOf( element );
    }

    public void Remove( UserElement element )
    {
        if( BaseIndexOf( element ) >= 0 )
        {
            BaseRemove( element.Key );
        }
    }

    public void RemoveAt( int index )
    {
        BaseRemoveAt( index );
    }

    public UserElement this[ int index ]
    {
        get { return (UserElement) BaseGet( index ); }
        set
        {
            if( BaseGet( index ) != null )
            {
                BaseRemoveAt( index );
            }
            BaseAdd( index, value );
        }
    }
}

public class UserInfoSection : ConfigurationSection
{
    private static readonly ConfigurationProperty _propUserInfo = new ConfigurationProperty(
            null,
            typeof(UserElementCollection),
            null,
            ConfigurationPropertyOptions.IsDefaultCollection
    );

    private static ConfigurationPropertyCollection _properties = new ConfigurationPropertyCollection();

    static UserInfoSection()
    {
        _properties.Add( _propUserInfo );
    }

    [ConfigurationProperty( "", Options = ConfigurationPropertyOptions.IsDefaultCollection )]
    public UserElementCollection Users
    {
        get { return (UserElementCollection) base[ _propUserInfo ]; }
    }
} 
```

我使 UserElement 类保持简单，尽管它确实应该遵循完全声明每个属性的模式，如[这篇出色的 CodeProject 文章中所述](http://www.codeproject.com/KB/dotnet/mysteriesofconfiguration.aspx#writingasection)。如您所见，它代表您提供的配置中的“用户”元素。

UserElementCollection 类只支持拥有多个“用户”元素，包括在运行时修改集合中添加/删除/清除项目的能力。

最后是 UserInfoSection，它简单地统计它有一个默认的“用户”元素集合。

接下来是 App.config 文件的示例：

```
<?xml version="1.0" encoding="utf-8" ?>
<configuration>
  <configSections>
    <sectionGroup>
      <section
        name="userInfo"
        type="ConsoleApplication1.UserInfoSection, ConsoleApplication1"
        allowDefinition="Everywhere"
        allowExeDefinition="MachineToLocalUser"
      />
    </sectionGroup>
  </configSections>

  <userInfo>
    <user firstName="John" lastName="Doe" email="John.Doe@company.com" />
    <user firstName="Jane" lastName="Doe" email="Jane.Doe@company.com" />
  </userInfo>
</configuration> 
```

如您所见，在此示例中，我在 App.config 中包含了一些 userInfo/user 元素。我还添加了设置，表示可以在机器/应用程序/用户/漫游用户级别定义它们。

接下来我们需要知道如何在运行时更新它们，下面的代码展示了一个例子：

```
Configuration userConfig = ConfigurationManager.OpenExeConfiguration( ConfigurationUserLevel.PerUserRoamingAndLocal );

var userInfoSection = userConfig.GetSection( "userInfo" ) as UserInfoSection;

var userElement = new UserElement();

userElement.FirstName = "Sample";
userElement.LastName = "User";
userElement.Email = "Sample.User@company.com";

userInfoSection.Users.Add( userElement );

userConfig.Save(); 
```

如果需要，上面的代码将创建一个新的 user.config 文件，该文件深埋在用户的“Local Settings\Application Data”文件夹中。

如果您希望将新用户添加到 app.config 文件中，只需将 OpenExeConfiguration() 方法的参数更改为 ConfigurationUserLevel.None。

正如你所看到的，它相当简单，尽管找到这些信息需要一些挖掘。

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-09T14:47:43.557

我不会将这种数据存储在 app.config 中，至少如果它打算以编程方式更新的话。从概念上讲，它是用于配置设置，而不是应用程序数据，所以也许您想将用户名和密码信息存储在单独的 XML 文件中（假设您不能或不想使用数据库）？

话虽如此，那么我认为您最好的选择是将 app.config 作为标准 XML 文件读取，对其进行解析，添加所需的节点并将其写回。内置的 ConfigurationManager API 不提供写回新设置的方法（我想这暗示了微软的预期用途）。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T15:23:56.253

使用.Net Framework **2中的****新System.Configuration API。** *（程序集：System.Configuration）* IConfigurationSectionHandler 已过时。

 ***[您可以在http://www.codeproject.com/KB/dotnet/mysteriesofconfiguration.aspx](http://www.codeproject.com/KB/dotnet/mysteriesofconfiguration.aspx)找到很多非常好的示例和说明

还有一个代码示例，关于如何修改和保存值。

**编辑：** codeproject 中文档的相关部分

如果存在任何更改，则仅保存修改后的值

```
Configuration.Save() 
```

如果存在任何更改，则保存指定级别的更改

```
Configuration.Save(ConfigurationSaveMode) 
```

保存指定级别的更改，如果第二个参数为 true，则强制进行保存

```
Configuration.Save(ConfigurationSaveMode, bool) 
```

ConfigurationSaveMode 枚举具有以下值：

*   **完整**- 保存所有配置属性，无论它们是否已更改
*   **已修改**- 保存已修改的属性，即使当前值与原始值相同
*   **最小**- 仅保存已修改且值与原始值不同的属性

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2011-03-24T07:21:12.410

```
 private void frmLocalFileTransfer_Load(object sender, EventArgs e)
    {
        try
        {
            dt.Columns.Add("Provider");
            dt.Columns.Add("DestinationPath");
            string[] folders = null;
            dt.Columns.Add("SourcePath");

            for (int i = 1; i < System.Configuration.ConfigurationManager.ConnectionStrings.Count; i++)
            {
                string key = System.Configuration.ConfigurationManager.ConnectionStrings[i].Name;
                string constr = System.Configuration.ConfigurationManager.ConnectionStrings[i].ConnectionString;
                DataGridViewTextBoxColumn column = new DataGridViewTextBoxColumn();
                folders = constr.Split('\\');
                string newstr = (folders[folders.Length - 2]);
                if (!newstr.Contains("BackUp"))
                {
                    DataRow row = dt.NewRow();
                    row[dt.Columns[0].ToString()] = key;
                    row[dt.Columns[1].ToString()] = constr;
                    row[dt.Columns[2].ToString()] = constr;
                    dt.Rows.InsertAt(row, i - 1);
                }
            }

            foreach (DataColumn dc in dt.Columns)
            {
                DataGridViewTextBoxColumn column = new DataGridViewTextBoxColumn();
                column.DataPropertyName = dc.ColumnName;
                column.HeaderText = dc.ColumnName;
                column.Name = dc.ColumnName;
                column.SortMode = DataGridViewColumnSortMode.Automatic;
                column.ValueType = dc.DataType;
                GVCheckbox();

                gevsearch.Columns.Add(column);
            }
            if (gevsearch.ColumnCount == 4)
            {
                DataGridViewButtonColumn btnColoumn = new DataGridViewButtonColumn();
                btnColoumn.Width = 150;
                btnColoumn.HeaderText = "Change SourcePath";
                btnColoumn.DefaultCellStyle.Alignment = DataGridViewContentAlignment.MiddleCenter;
                gevsearch.Columns.Insert(4, btnColoumn);

            }
             gevsearch.DataSource = dt;
        }
        catch (Exception ex)
        {
            MessageBox.Show(ex.ToString());
        }
    }

private void btnAddProvider_Click(object sender, EventArgs e)
    {
        try
        {
            System.Xml.XmlDocument xDoc = new System.Xml.XmlDocument();
            path = "D:\\Pandurang\\Jitendra\\LocalFileTransfer\\LocalFileTransfer
            xDoc.Load(path);
            System.Xml.XmlElement element = xDoc.CreateElement("add");
            element.SetAttribute("name", txtProviderName.Text.Trim());
            element.SetAttribute("connectionString", txtNewPath.Text.Trim());
            System.Xml.XmlElement elementBackup = xDoc.CreateElement("add");
            elementBackup.SetAttribute("name", BackUpName);
            elementBackup.SetAttribute("connectionString", txtBackupPath.Text.Trim());
            System.Xml.XmlNode node= xDoc.ChildNodes[1].ChildNodes[0];
            node.AppendChild(element);
            node.AppendChild(elementBackup);
            xDoc.Save(path);
          }
        catch (Exception ex)
        {
            MessageBox.Show(ex.ToString());
        }
    } 
```

* * *

## 回答 #5

> 赞同：-1
> 
> 时间：2009-04-09T16:48:46.207

你应该创建一个类，如：

```
public class MySettings : ConfigurationSection 
{
    public MySettings Settings = (MySettings)WebConfigurationManager.GetSection("MySettings");

    [ConfigurationProperty("MyConfigSetting1")]
    public string DefaultConnectionStringName
    {
        get { return (string)base["MyConfigSetting1"]; }
        set { base["MyConfigSetting1"] = value; }
    }
} 
```

之后在您的 web.config 中使用：

```
<section name="MySettings" type="MyNamespace.MySettings"/>
<MySettings MyConfigSetting1="myValue"> 
```

就是这样）如果您想使用的不是属性，而是属性，只需创建从 ConfigurationElement 派生的类并将其包含到从 ConfigurationSettings 定义的类中。

# java - 如何使用 Log4J 设置我的 BlazeDS 实现？

> ID：734477
> 
> 赞同：8
> 
> 时间：2009-04-09T14:27:00.923
> 
> 标签：java, apache-flex, logging, blazeds

我正在使用 BlazeDS 在 Java Web 应用程序之上编写一个 Flex 应用程序。BlazeDS 内部有日志记录，但我想将其设置为使用与我的应用程序中相同的日志记录框架。

有没有办法设置 BlazeDS 以使用 Log4J？还是我坚持使用已经融入 BlazeDS 的 Flex 日志记录？

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-09T22:38:19.750

不，开箱即用的 BlazeDS 不直接支持 log4j 或其他框架。

但是，添加对您最喜欢的日志框架的支持非常简单；我使用以下内容将输出转换为[SLF4J](http://www.slf4j.org/)：

```
package example;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import flex.messaging.log.AbstractTarget;
import flex.messaging.log.LogEvent;

public class Slf4jTarget extends AbstractTarget {
    // log4j levels:   OFF - FATAL - ERROR - WARN - INFO - DEBUG - TRACE - ALL
    // blazeds levels:  NONE - FATAL - ERROR - WARN - INFO - DEBUG - ALL

    @Override
    public void logEvent(LogEvent event) {
        Logger log = LoggerFactory.getLogger(event.logger.getCategory());

        if (event.level >= LogEvent.ERROR)
            log.error(event.message, event.throwable);
        else if (event.level >= LogEvent.WARN)
            log.warn(event.message, event.throwable);
        else if (event.level >= LogEvent.INFO)
             log.info(event.message, event.throwable);
        else if (event.level >= LogEvent.DEBUG)
             log.debug(event.message, event.throwable);
        else
             log.trace(event.message, event.throwable);
    }
} 
```

..并使用它，启用它`services-config.xml`：

```
<?xml version="1.0" encoding="UTF-8"?>
<services-config>
    <logging>
        <target class="example.Slf4jTarget" level="Info">
    </logging>
</services-config> 
```

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-01-19T19:10:02.560

**使用 CommonsLoggingTarget。**

请参阅[http://static.springsource.org/spring-flex/docs/1.0.x/javadoc-api/org/springframework/flex/core/CommonsLoggingTarget.html](http://static.springsource.org/spring-flex/docs/1.0.x/javadoc-api/org/springframework/flex/core/CommonsLoggingTarget.html)。

请注意在 service-config.xml 中设置日志级别。如果将其设置为“All”，并在 log4j.xml 中定义“blazeds”记录器，那么 BlazeDS/LCDS 会生成大量冗余日志消息，这可能会对性能产生重大影响。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T22:29:13.283

我不相信有任何内置功能可以让您将 Blaze DS 日志输出重定向到 log4j、commons-logging 等。但是这个 JIRA 问题可能对您有用：

[http://jira.springframework.org/browse/FLEX-18](http://jira.springframework.org/browse/FLEX-18)

包括用于重定向输出的 Java 类和 services-config.xml 的示例配置

# structuremap - StructureMap：如何为开放的泛型定义默认构造函数？

> ID：734478
> 
> 赞同：0
> 
> 时间：2009-04-09T14:27:08.553
> 
> 标签：structuremap

我有一些带有开放泛型的配置，如下所示：

```
 x.ForRequestedType(typeof(IRepository<>))
      .TheDefaultIsConcreteType(typeof(MyRepository<>)); 
```

我需要告诉 SM 在构建我的 repo 时它不应该使用最贪婪的构造函数。我该怎么做呢？

当我使用 ForRequestedType<> 时它很容易，但似乎我无法使用非通用版本来做到这一点。

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-07-03T06:56:29.077

回复有点晚了，但您可以尝试将`[DefaultConstructor]`属性放在您希望默认的构造函数上。

# sql - 是否可以将此查询转换为使用联接而不是子查询？

> ID：734481
> 
> 赞同：1
> 
> 时间：2009-04-09T14:27:39.237
> 
> 标签：sql, mysql, join, subquery

```
SELECT
    number, count(id)
FROM
    tracking
WHERE
    id IN (SELECT max(id) FROM tracking WHERE splitnr = 'a11' AND number >0 AND timestamp >= '2009-04-08 00:00:00' AND timestamp <= '2009-04-08 12:55:57' GROUP BY ident)
GROUP BY
    number 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T14:35:08.050

这个怎么样：

```
SELECT    number, count(id)
FROM    tracking 
  INNER JOIN (SELECT max(id) ID FROM tracking  
                 WHERE splitnr = 'a11' AND 
                       number >0 AND timestamp >= '2009-04-08 00:00:00' AND 
                       timestamp <= '2009-04-08 12:55:57'
              GROUP BY ident
             ) MID ON (MID.ID=tracking.id)
WHERE   
GROUP BY number 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T14:35:45.350

在没有看到数据并确切知道您要实现的目标的情况下，很难确保我完全正确，但我个人会将子查询变成一个视图，然后加入它，所以：

```
create view vMaximumIDbyIdent

as

SELECT ident, max(id) maxid

FROM tracking 

WHERE splitnr = 'a11' AND number >0 

AND timestamp >= '2009-04-08 00:00:00' 

AND timestamp <= '2009-04-08 12:55:57' 

GROUP BY ident

then:

SELECT

    number, count(id)
FROM

    tracking,

    vMaximumIDbyIdent

WHERE

    tracking.id = vMaximumIDbyIdent.maxid

GROUP BY

    number 
```

更具可读性和可维护性。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T14:45:32.503

你能不能做这样的事情：

```
SELECT
    number,
    count(id)
FROM
    tracking
WHERE
    splitnr = 'a11' AND number > 0 AND timestamp >= '2009-04-08 00:00:00' AND timestamp <= '2009-04-08 12:55:57'
GROUP BY
    number
ORDER BY
    number DESC
LIMIT 0,1 
```

（顺便说一句，我真的不知道 MySQL）

我假设这会给您返回相同的结果集，您按数字 desc 对其进行排序，因为您想要最大的一个，对吗？然后，您可以将 WHERE 子句放入其中并将其限制为一个，从而为您提供第一个与 MAX 基本相同的子句（我认为），从而完全删除 JOIN。

**编辑**：我认为您也不需要 GROUP BY identd

# language-agnostic - 将伪随机数限制在较小范围内的正确方法是什么？

> ID：734482
> 
> 赞同：7
> 
> 时间：2009-04-09T14:28:50.187
> 
> 标签：language-agnostic, random

将 PRNG 的值限制在较小范围内的最佳方法是什么？如果您使用模数并且旧的最大数不能被新的最大数整除，那么您会偏向`0`through `(old_max - new_max - 1)`。我认为最好的方法是这样的（这是浮点数，而不是整数数学）

```
random_num = PRNG() / max_orginal_range * max_smaller_range 
```

但是我的直觉让我质疑这种方法（也许浮点实现和表示差异？）。

随机数生成器将在硬件和软件平台上产生一致的结果，约束也需要如此。

我怀疑上面的伪代码是对的（但不是因为我想的原因）。MichaelGG 的[回答](https://stackoverflow.com/questions/734482/what-is-the-proper-method-of-constraining-a-pseduo-random-number-to-a-smaller-ran/739945#739945)让我以不同的方式思考这个问题。我可以使用较小的数字对其进行建模并测试每个结果。因此，假设我们有一个 PRNG，它产生一个介于 0 和 31 之间的随机数，并且您希望较小的范围为 0 到 9。如果使用模数，则偏向于 0、1、2 和 3。如果使用伪代码上面你偏向于 0、2、5 和 7。我认为没有一种好方法可以将一组映射到另一组。到目前为止，我想出的最好的方法是重新生成大于 的随机数`old_max/new_max`，但这也有很深的问题（减少周期、生成新数字的时间，直到一个在正确的范围内，等等）。

我想我可能天真地处理了这个问题。可能是时候开始对文献进行认真的研究了（之前必须有人解决过这个问题）。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T14:33:38.880

我知道这可能不是一个特别有用的答案，但我认为最好的方法是构思几种不同的方法，然后尝试数百万次，然后检查结果集。

如有疑问，请自行尝试。

**编辑**

应该注意的是，许多语言（如 C#）在其功能中内置了限制

```
int maximumvalue = 20;
Random rand = new Random();

rand.Next(maximumvalue); 
```

并且只要有可能，您应该使用那些而不是您自己编写的任何代码。不要重新发明轮子。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2020-08-26T16:45:54.030

这个问题类似于在只给定一个*p面骰子的情况下滚动一个**k*面骰子，而不会浪费随机性。

 *在这个意义上， B. Kloeckner在“[用骰子模拟骰子](https://perso.math.u-pem.fr/kloeckner.benoit/papiers/DiceSimulation.pdf)”中引理 3指出，这种浪费是不可避免的，除非“每个除*k*的素数也除*p* ”。因此，例如，如果*p*是 2 的幂（并且任何随机位块都与以 2 面数的幂掷骰子相同）并且*k*的质因数不是 2，那么您能做的最好的事情就是任意接近不浪费随机性，例如通过批量处理*p*面骰子的多个卷，直到*p* ^ *n* “足够接近” *k*的幂。

让我也谈谈您对重新生成随机数的一些担忧：

*   “减少周期”：除了对位进行批处理外，还可以通过以下几种方式来解决此问题：
    *   使用[具有更大“周期”](https://peteroupc.github.io/hqprng.html)（最大周期长度）的 PRNG。
    *   在 PRNG 的实现中添加[Bays-Durham shuffle 。](https://peteroupc.github.io/bdshuffle.html)
    *   使用“真”随机数生成器；这不是微不足道的。
    *   *使用随机抽取*，这在Devroye[和 Gravel 2015-2020](https://arxiv.org/abs/1502.02539)以及我[的关于随机抽取的注释](https://peteroupc.github.io/randextract.html)中进行了讨论。但是，随机性提取非常复杂。
    *   忽略问题，特别是如果它不是安全应用程序或严肃的模拟。
*   “是时候生成新数字，直到一个在正确的范围内”：如果您想要无偏的随机数，那么在最坏的情况下，任何这样做的算法通常都必须永远运行。同样，根据引理 3，算法将在最坏的情况下永远运行，除非“除*k*的每个素数也除*p* ”，如果*k*为 10 且*p*为 32，则情况并非如此。

另请参阅问题：[如何在不浪费位的情况下从随机位流中生成 [0,n] 范围内的随机整数？](https://stackoverflow.com/questions/6046918/how-to-generate-a-random-integer-in-the-range-0-n-from-a-stream-of-random-bits)，尤其是我的回答。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-11T12:03:09.060

以下是 CLR 的 Random 类在受限时的工作方式（根据 Reflector）：

```
long num = maxValue - minValue;
if (num <= 0x7fffffffL) {
    return (((int) (this.Sample() * num)) + minValue);
}
return (((int) ((long) (this.GetSampleForLargeRange() * num))) + minValue); 
```

即使你得到一个正整数，也不难得到一个双倍的整数。只需将随机整数乘以 (1/maxint)。从 32 位 int 到 double 应该提供足够的精度。（我实际上还没有测试过这样的 PRNG，所以我可能会遗漏一些浮点数。）

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T14:33:57.320

如果 PRNG() 正在生成均匀分布的随机数，那么上面看起来不错。事实上（如果你想缩放平均值等）以上对于所有目的都应该没问题。我想您需要询问与原始 PRNG() 相关的错误是什么，以及进一步的操作是否会大大增加该错误。

如有疑问，请生成适当大小的样本集，并在 Excel 或类似文件中查看结果（以检查您的均值/std.dev 等是否符合您的预期）

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T14:34:01.080

如果您有权访问将生成 0 <= x < 1 范围内的数字的 PRNG 函数（例如 random()），您是否可以不这样做：

```
 random_num = (int) (random() * max_range); 
```

给你0到max_range范围内的数字？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-11T15:11:14.020

伪随机数生成器本质上是产生一个由 1 和 0 组成的随机序列，当它们相互附加时，它们是基数为 2 的无限大数。每次您从prng中消耗一点时，您都​​会将该数字除以2并保持模数。您可以永远做到这一点，而不会浪费一点点。

如果您需要 [0, N) 范围内的数字，则需要相同的数字，但不是以 2 为底，而是需要以 N 为底。转换基数基本上是微不足道的。消耗您需要的位数，将这些位的剩余部分返回到您的 prng 以在下次需要数字时使用。

# flexbuilder - FlexBuilder 中等效的 Visual Studio 区域

> ID：734483
> 
> 赞同：0
> 
> 时间：2009-04-09T14:29:58.703
> 
> 标签：flexbuilder

FlexBuilder 中有类似区域的东西吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T14:37:17.203

Flex Builder 没有此功能。我希望它做到了。有一个[功能请求](http://bugs.adobe.com/jira/browse/FB-16348)，但它似乎已经死了。

# msbuild - 使用 cc.net 在测试执行中处理超时而不显示任何错误

> ID：734484
> 
> 赞同：1
> 
> 时间：2009-04-09T14:30:02.773
> 
> 标签：msbuild, nunit, cruisecontrol.net

通过 cc.net 运行时，nunit 测试会失败，说进程超时。进程已被杀死通过 nUNIt 或 VS 时一切正常。

即使构建是干净的，cc.net 也会显示先前构建的结果。

任何帮助请。

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T14:38:13.660

默认超时为 600 秒。如果您的测试开始超出该范围，则构建将失败且没有任何迹象。您可能需要增加 cc.net nunit 任务的超时时间

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-05-13T13:34:00.147

如果您看到之前构建的结果，可能是因为您没有删除之前构建的结果。

例如，我的 NUnit 测试结果被写入名为 {foo}-results.xml 的文件中：

```
<publishers>
    <merge>
        <files>
            <file>bin\debug\*-results.xml</file>
        </files>
    </merge>
</publishers> 
```

在我的任务中，我的构建文件中有一个步骤删除了整个“bin\debug”目录，这样我的结果始终是当前的。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-10-29T22:11:52.490

如果测试有断言，我已经看到会发生这种情况，例如 Debug.Assert(something here)。当我在 CC.Net 中发生这种情况时，CC.Net 构建会弹出一个断言消息框。由于没有人关闭构建服务器上的消息框，NUnit 测试超时。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-05-27T15:16:34.117

一种可能性是您有权限问题。CruiseControl 可能在服务帐户下运行，并且具有与您的用户帐户不同的权限（我假设您使用它来手动运行测试。）尝试以服务帐户身份登录机器，然后查看是否可以运行单元测试通过 VS 或 NUnit。

# c++ - 将“输入键”事件传递给 ATL 窗口中的 Flash 播放器？

> ID：734490
> 
> 赞同：0
> 
> 时间：2009-04-09T14:31:03.597
> 
> 标签：c++, flash, atl

我在 ATL 窗口中嵌入了一个 Flash 播放器 (flash9.ocx)，并在 swf 中编码了功能以响应按下的返回/输入键。在独立的 swf 播放器上运行良好，但一旦在我的嵌入式播放器中播放，它就不会执行。好像我的窗户以某种方式挡住了路？有没有办法将按键传递给播放器？

仅供参考，表格上没有任何奇怪的地方。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2010-06-12T20:35:12.050

我不经常使用闪存，但我是一名 C++ 程序员。=) 让我们看看我能不能帮你。我相信您的应用程序会在您的 Flash 电影之前捕获所有事件。我不知道是否有更好的方法可以做到这一点，但您可以监听表单上的任何键盘事件并使用 ActiveX 组件的 SetVariable 在 Flash 中设置变量。然后，在 Flash 电影中，您可以设置监视此变量的任何更改并触发您的 Enter 事件。

希望这可以帮助。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-12T20:47:43.330

I'm not VC++ developer, but I use Flash a lot.

Though not sure, it seems that the embedded player doesn't have the focus. Make sure you've got this part covered on the Flash side of things:

*   the stage exists ( you movie is properly initialized)
*   you set the KeyboardEvent listener to the stage.

You could use the [FocusManager](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/fl/managers/FocusManager.html) to make sure you've got the focus.

I don't know if you can pass the focus from you app to the SWF OLE through some tabIndex or something.

If still this doesn't work you can try using the [External Interface](http://livedocs.adobe.com/flash/9.0/ActionScriptLangRefV3/flash/external/ExternalInterface.html) to add callbacks from your app to flash player ( basically call and actionscript function from your app ).

This was achieved through [fscommand](http://help.adobe.com/en_US/AS3LCR/Flash_10.0/flash/system/package.html) before, but External Interface seems to be the thing to use now.

Good luck!

# apache-flex - 将 dataprovider DataGrid 绑定到数组

> ID：734497
> 
> 赞同：1
> 
> 时间：2009-04-09T14:33:38.303
> 
> 标签：apache-flex, binding

如何将 Flex 中的 DataGrid 的数据提供者绑定到数组？

这似乎不起作用：

```
<mx:DataGrid 
    id="valuesDataGrid" 
    editable="true" 
    width="100%" 
    height="100%" 
    dataProvider="{_metaDataKey.values}">
...

[Bindable]
public class EnumMetaDataKey{

    private var _values:Array = [];

    public function get values():Array { return _values; }
    public function set values(value:Array):void { _values = value; }
    ... 
```

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T15:59:45.340

改用一个`ArrayCollection`。`Array`s 不适合装订。IIRC，这在 Flex 3 help on [Binding to functions Objects and Arrays](http://livedocs.adobe.com/flex/3/html/databinding_4.html)中有记录：

> **注意：**在定义使用数组作为数据绑定表达式源的数据绑定表达式时，数组应该是类型`ArrayCollection`，因为`ArrayCollection`当数组或数组元素发生更改以触发数据绑定时，类会调度事件。例如，调用`ArrayCollection.addItem()`、`ArrayCollection.addItemAt()`、`ArrayCollection.removeItem()`和`ArrayCollection.removeItemAt()`所有触发数据绑定。

# internet-explorer - Internet Explorer 8 构建 18702 和 8702IC？

> ID：734503
> 
> 赞同：0
> 
> 时间：2009-04-09T14:34:22.077
> 
> 标签：internet-explorer, internet-explorer-8

我遇到了一个奇怪的 IE8 版本问题，直到现在我还没有遇到过。给我带来麻烦的版本是8.0.6001.8702IC？有人遇到过这个版本吗？

这个时髦的版本破坏了我工作过的很多网站，主要是 asp.net 1.1 和 2.0 网站。但是，[据说] IE 8.0.6001.18702 的最终版本可以完美地显示我的网页。

除了“重构您的 HTML 和 CSS”之外，任何人都可以阐明这个问题吗？

非常感谢！

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T14:58:19.523

“IC”表示它是“互联网内容提供商”版本——它是由第三方定制的，通常带有他们的品牌。

不应该有任何功能差异 - 也许有一个插件导致了您遇到的问题？

# wpf - WPF中的绑定和布局关系

> ID：734519
> 
> 赞同：8
> 
> 时间：2009-04-09T14:37:59.150
> 
> 标签：wpf, layout, binding

在调查我正在处理的应用程序问题时，我遇到了一种我不太了解的行为。似乎当您有一个带有绑定 Text 属性的 TextBox（例如）时，系统会比拥有静态 Text 时多进行一次布局传递。

请任何人解释为什么会发生这种额外的通行证？引擎是否先放置未绑定的控件，然后绑定它，然后再放置它？

为了测试这一点，我构建了这样的测试用例：

我已经声明了一个继承自 TextBox 的类（所以我可以覆盖 ArrangeOverride）：

```
public class MultiBoundTextBox : TextBox
{
    protected override Size ArrangeOverride(Size arrangeBounds)
    {
        Console.WriteLine("TextBox.Arrange");
        return base.ArrangeOverride(arrangeBounds);
    }
} 
```

然后我在一个窗口中放置了这个文本框的一个实例：

```
<local:MultiBoundTextBox x:Name="tb">
Some text
</local:MultiBoundTextBox> 
```

并为测试窗口添加了一些代码：

```
 public Window11()
    {
        InitializeComponent();
    }

    private void Window_Loaded(object sender, RoutedEventArgs e)
    {
        Console.WriteLine("Window.Loaded");
    }

    protected override Size ArrangeOverride(Size arrangeBounds)
    {
        Console.WriteLine("Window.Arrange");
        return base.ArrangeOverride(arrangeBounds);
    }

    private void Window_Initialized(object sender, EventArgs e)
    {
        Console.WriteLine("Window.Initialized");
        tb.DataContext = DateTime.Now;
    } 
```

现在，当我运行它时，我得到了这个输出：

```
Window.Initialized
Window.Arrange
TextBox.Arrange
Window.Arrange
Window.Loaded 
```

但是，如果我将 Text 属性更改为这样绑定：

```
 <local:MultiBoundTextBox x:Name="tb">
        <Binding Path="Day" Mode="OneWay" />
    </local:MultiBoundTextBox> 
```

我在输出中得到这个：

```
Window.Initialized
Window.Arrange
TextBox.Arrange
Window.Arrange
TextBox.Arrange
Window.Arrange
Window.Loaded 
```

请注意额外的一对 TextBox.Arrange 和 Window.Arrange。为什么这个额外的通行证是必要的？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-09-03T09:43:49.603

> 引擎是否先放置未绑定的控件，然后绑定它，然后再放置它？

情况可能确实如此 - [WPF 数据绑定](http://msdn.microsoft.com/en-us/library/ms752347.aspx)在很大程度上建立在[Dependency Properties](http://msdn.microsoft.com/en-us/library/ms752914.aspx)之上，这实际上会影响 WPF 布局过程，请参阅[Layout Performance Considerations](http://msdn.microsoft.com/en-us/library/ms745058.aspx#LayoutSystem_Performance)：

> 其值可以导致布局系统被初始化的依赖属性用公共标志标记。[AffectsMeasure](http://msdn.microsoft.com/en-us/library/system.windows.frameworkpropertymetadata.affectsmeasure.aspx)和 [AffectsArrange](http://msdn.microsoft.com/en-us/library/system.windows.frameworkpropertymetadata.affectsarrange.aspx)提供有用的线索，说明哪些属性值更改将强制布局系统进行递归更新。通常，任何可能影响元素边界框大小的属性都应将 [AffectsMeasure](http://msdn.microsoft.com/en-us/library/system.windows.frameworkpropertymetadata.affectsmeasure.aspx)标志设置为 true。有关详细信息，请参阅[依赖属性概述](http://msdn.microsoft.com/en-us/library/ms752914.aspx)。

[特别是关于您的问题，请参阅Optimizing Performance: Layout and Design](http://msdn.microsoft.com/en-us/library/bb613542.aspx)中的引用：

> 如果发生以下任何操作，则会再次调用布局传递过程：
> 
> *   [...]
> *   当使用影响度量或排列通道的元数据标记的依赖属性的值发生更改时。

因此，我可以想象初始布局传递与稍后更改绑定值的用例没有任何不同，这将解释您所遇到的行为。虽然这*可能*仍然是优化启动体验的错失机会，但通常的优化警告适用：*没有测量就没有优化*- 例如，这种假设的冗余（如果在技术上完全可以避免）可能没有可测量的影响，因为窗口/控件尚未显示等

* * *

**调试：**

要添加关于调试辅助的 Drews[建议，](https://stackoverflow.com/questions/734519/binding-and-layout-relation-in-wpf/1367696#1367696)在 .NET Framework 3.5 中引入了与绑定相关的新专用调试辅助，请参见[`PresentationTraceSources.TraceLevel`](http://msdn.microsoft.com/en-us/library/system.diagnostics.presentationtracesources.tracelevel.aspx)- 示例：

```
<Window ... xmlns:diag="clr-namespace:System.Diagnostics;assembly=WindowsBase">
    <local:MultiBoundTextBox x:Name="tb">
        <Binding Path="Day" Mode="OneWay"
                 diag:PresentationTraceSources.TraceLevel="High"/>
    </local:MultiBoundTextBox>
</Window> 
```

但是，这有一些限制，请务必阅读 中的备注*部分*[`PresentationTraceSources Class`](http://msdn.microsoft.com/en-us/library/system.diagnostics.presentationtracesources.aspx)。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-09-02T13:29:29.220

不是直接的答案，但是如果您将转换器添加到绑定中，除了写出一条消息告诉您在哪个点评估绑定之外什么都不做？

```
public sealed class LoggingConverter : IValueConverter
{
    public void Convert(object value, Type targetType,
                        object parameter, CultureInfo culture)
    {
        Console.WriteLine("Binding.Convert");
        return value;
    }

    public void ConvertBack(object value, Type targetType,
                            object parameter, CultureInfo culture)
    {
        Console.WriteLine("Binding.ConvertBack");
        return value;
    }
} 
```

# postgresql - 如何在本地系统帐户下运行 PostgreSQL 数据库服务？

> ID：734521
> 
> 赞同：3
> 
> 时间：2009-04-09T14:38:17.013
> 
> 标签：postgresql

我在我的应用程序中使用 PostgreSQL DB，我曾经创建特殊的 Windows 用户帐户来运行 DB 服务。

现在我需要在本地系统帐户下运行 PostgreSQL 服务！PostgreSQL 中是否有配置来指定运行服务的用户帐户？

谢谢，

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2011-08-06T12:57:22.323

从 PostgreSQL 站点下载 zip 归档二进制文件。提取内容。创建一个文件夹，比如“data”，用于存储 db 文件等。打开 Windows 高级系统配置 -> 环境变量。

创建一个名为 PGDATA 的新系统变量并将其值设置为数据文件夹的完整路径，如 - 'C:\PostgreSQL\data'（不带单引号）。

路径变量中的下一个包括 bin 文件夹的完整路径，如 - 'C:\PostgreSQL\bin;....' 。

完成后，请执行以下操作...

1.  打开命令提示符（在 Vista 和 Win 7 系统中作为管理员）。键入：“initdb”，然后按 Enter。这将进行初始设置。
2.  在同一命令提示符窗口中，键入：'pg_ctl register -N PostgreSQL -U LocalSystem' 并按 Enter。打开运行并输入 services.msc 并检查进程“PostgreSQL”是否已创建以及您是否可以实际启动它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T14:54:26.770

计算机管理 -> 服务 -> 选择 Postgres 服务器服务 -> 右键单击​​ -> 属性 -> 选中登录选项卡，就像任何其他 Windows 服务一样。

（命名可能有点偏离，我家里没有 Windows 机器，但我相信你可以即兴发挥。）

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T14:52:37.197

我不相信你需要做任何特别的事情来在本地系统帐户下运行它。我们在这里使用 PostgreSQL 数据库，并且一直将它们安装在本地系统帐户上。我从未在安装中看到允许您为服务指定系统帐户的配置设置。

# utf-8 - 如何正确验证浏览器是否支持 UTF-8 字符？

> ID：734534
> 
> 赞同：3
> 
> 时间：2009-04-09T14:41:27.707
> 
> 标签：utf-8, multilingual

有没有办法从 Javascript 中识别浏览器编码是否设置为/支持“UTF-8”？

我想根据浏览器设置透明地发送“UTF-8”或“英文”字母（即不询问用户）

编辑：对不起，我对这个问题不是很清楚。在浏览器中，编码通常指定为`Auto-Detect (or) Western (Windows/ISO-9959-1) (or) Unicode (UTF-8)`. 如果用户将默认设置为西方，那么我发送的字符是不可读的。在这种情况下，我想通知用户将编码设置为`"Auto Detect" (or) "UTF-8"`.

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T15:00:22.123

首先，UTF-8 是 Unicode 字符集的编码。英语是一种语言。我假设您的意思是“ASCII”（字符集及其编码）而不是英语。

二、ASCII和UTF-8重叠；当以 UTF-8 发送时，任何 ASCII 字符都以完全相同的位发送。我很确定所有现代浏览器都支持 UTF-8，而那些不支持的浏览器可能只会将其视为 latin1 或 cp1252（两者都与 ASCII 重叠），因此它仍然可以工作。

换句话说，我不会担心它。

只需确保在 HTTP 标头或元标记中正确地将您的文档标记为 UTF-8。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T15:11:01.490

我假设输出的长度（您在输出后读回）可以告诉您发生了什么（或者，如果没有 JavaScript，请使用 Accept-Charset HTTP 标头，并假设在接受 Unicode 时支持 UTF-8 编码）。

但您最好担心发送正确的 UTF-8 标头等，以及可访问性的回退方案，而不是担心当前浏览器的 UTF-8 功能。

# web-applications - 最酷的网络应用安装程序

> ID：734538
> 
> 赞同：0
> 
> 时间：2009-04-09T14:42:33.337
> 
> 标签：web-applications, installation

我正在做一个项目，并且正在考虑如何为它构建一个安装程序。因为我希望它非常易于使用，所以我需要看看其他很酷的安装程序。你见过最酷的是什么？

我看了一下[Woltlab 烧录板](http://www.woltlab.com/products/burning_board/screenshots_en.php)安装程序。

安装程序稍后应该可以在 windows、linux 和 mac 上运行，所以基本上我想把它变成一个 php 应用程序本身。

我将在我的服务器上托管任何文件，但带宽不是问题。

**我不是在谈论桌面安装程序**

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T15:23:58.797

到目前为止，Wordpress 是我的最爱。您只需将整个目录上传到您的网络服务器，从浏览器访问它并执行一些简单的步骤即可。我不认为你能做的远不止这些。也许也从安装程序创建数据库？

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T14:58:18.430

我实际上更喜欢安装程序，我在其中完成所有下载，它只是创建数据库/插入设置/检查权限。

如果我愿意，下载自己可以让我检查哈希，而不必相信您在代码中正确地执行了所有操作。对我来说，自行下载的软件也有点令人毛骨悚然，这让我在网络设置中偏执。

[Drupal](http://drupal.org)现在有一个相当不错的安装程序。他们通过一个简单的向导进行演示，该向导允许您输入设置并添加所需的数据库表。完成后，它会告诉您可以加强哪些内容（配置文件的权限以及哪些不可以），并为您提供有关如何执行此操作的明确说明。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T15:08:10.593

我不确定为什么需要桌面或 CLI 安装程序，但 Wordpress，复制粘贴 PHP 文件并单击按钮。它是跨平台的，而且非常简单。

如果您需要使用安装程序设置服务器、数据库等，那么我仍然建议您使用 PHP（或您的语言安装程序，它需要在开始时以特权运行，然后强制客户端修复特权或自动放弃它自己的特权）

# java - java SWT：如何将小部件绘制到屏幕外缓冲区

> ID：734540
> 
> 赞同：0
> 
> 时间：2009-04-09T14:42:59.980
> 
> 标签：java, swt

我想将 StyledText 小部件的内容绘制到图像中；这将提供一种方便的方式将图像粘贴到表格单元格中。

关于解决此问题的最佳方法有什么建议吗？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-15T20:58:00.550

为什么要创建图像？

您可以只在表格单元格中呈现 StyledText-widget。如果您有很多项目并且这是一个性能问题，您可以使用 SWT.VIRTUAL 创建一个虚拟表。如果您使用的是 JFace，请查看[org.eclipse.jface.viewers.DelegatingStyledCellLabelProvider.IStyledLabelProvider](http://help.eclipse.org/stable/nftopic/org.eclipse.platform.doc.isv/reference/api/org/eclipse/jface/viewers/DelegatingStyledCellLabelProvider.IStyledLabelProvider.html)。

如果您使用的是纯 SWT，您应该能够使用带有 StyledText-widget 的 TableEditor 作为编辑器。像这样的东西：

```
Table table = new Table(new Shell(new Display()), SWT.NONE);
table.setHeaderVisible (true);
TableColumn column = new TableColumn (table, SWT.NONE);
StyledText styledText = new StyledText(table, SWT.NONE);
TableItem item = new TableItem (table, SWT.NONE);
TableEditor editor = new TableEditor (table);
editor.grabHorizontal = true;
editor.grabVertical = true;
editor.setEditor (styledText, item, 0); 
```

# .net - 如何在表示层（WPF/Silverlight）之外使用 XAML？

> ID：734544
> 
> 赞同：2
> 
> 时间：2009-04-09T14:44:12.443
> 
> 标签：.net, xaml

XAML 应该是“可扩展的应用程序标记语言”——即用于创建应用程序标记的**通用**、灵活的框架。但是，大多数 XAML 搜索都会产生 WPF 或 Silverlight 特定的材料。

目前唯一的例外（我知道）是 Oslo 框架（M-language & co.）——证明 XAML 可以在表示层之外使用。

我正在寻找有关如何在我自己的应用程序中包含 XAML 的信息。如何将我的应用程序对象序列化为 XAML，然后将此 XAML 反序列化为该对象的新实例？有这方面的官方 MSFT 信息吗？.NET BCL 中的通用 XAML 支持怎么样？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T14:59:34.683

看看[XamlReader](http://msdn.microsoft.com/en-us/library/system.windows.markup.xamlreader.aspx)类

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T14:57:09.200

[System.Windows.Markup](http://msdn.microsoft.com/en-us/library/system.windows.markup.aspx)命名空间中的 .Net BCL 支持 XAML 。它具有可以加载和理解 XAML 片段的类。

# matlab - 双线性变换

> ID：734547
> 
> 赞同：0
> 
> 时间：2009-04-09T14:45:26.810
> 
> 标签：matlab, controls

这个特定主题与数字控制有关。我的工厂有一个传递函数，在这种情况下是一个伺服电机，它位于 z 域中。为了确定相位裕度，我需要查看波特图，但首先我必须使用双线性变换：

```
z = (1+(T/2)*w) / (1-(T/2)*w); T-sampling rate,
w = e^(j*omega) (frequency response) 
```

MATLAB 是否有一个函数可以为我进行这种转换？从 z 域到 w 域。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T14:55:55.550

如果有的话，信号处理工具箱中有一个名为[BILINEAR的函数。](http://www.mathworks.com/access/helpdesk/help/toolbox/signal/bilinear.html)我不确定这是否正是您所需要的，但这可能是一个不错的起点。

**编辑：**检查的其他一些选项可能对您有所帮助：控制系统工具箱中的[C2D](http://www.mathworks.com/access/helpdesk/help/toolbox/control/ref/c2d.html)和[D2C](http://www.mathworks.com/access/helpdesk/help/toolbox/control/ref/d2c.html)功能有助于在连续时间和离散时间模型之间进行转换。

# c++ - 如何通过函数内的 SetDlgItemText 更新对话框并使其在 Windows 中立即生效？

> ID：734551
> 
> 赞同：0
> 
> 时间：2009-04-09T14:46:19.460
> 
> 标签：c++, windows

如果我调用 SetDlgItemText() 来更新对话框文本的值，它似乎只在函数返回时更新。我正在使用它来更新状态消息，通知用户当前的进度中间功能，所以我希望它立即更新。

如果无法做到这一点，我还能做些什么来获得相同的结果吗？

任何帮助，将不胜感激。

谢谢。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T16:12:16.637

我认为处理函数不允许调用您设置消息的窗口的 OnPaint 消息。您可以将处理函数移至线程，以便主线程处理 UI 消息。

# jquery - 通过 jQuery on event 向元素添加样式

> ID：734553
> 
> 赞同：0
> 
> 时间：2009-04-09T14:46:44.183
> 
> 标签：jquery, ajax

希望这是一个 jQuery newbee 的简单问题。是否可以从 javascript 方法执行 jQuery 方法？

我有一些 jQuery 的东西将斑马条纹添加到表中以及其他一些事情，但是该表通过 mvc ajax 请求更新，然后在 ajax 调用完成后没有任何样式应用于表。这显然是因为这些样式仅在 dom 准备就绪时应用（当前使用标准 jQuery $(function() {... magic in here }) 方法调用它）。

ajax 请求提供了一种在回调上执行 javascript 方法的方法，我希望能够通过 jQuery 从该 javascript 函数应用这些相同的样式。

提前致谢！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T14:49:38.983

jQuery 是用 JavaScript 构建的；它是一个 JavaScript 框架（或库，取决于你如何看待它）。从 JavaScript 执行 jQuery 应该没有问题，因为这就是您首先执行 jQuery 的方式。

您应该能够将提供给 jQuery 的相同函数作为 AJAX 请求的回调传递。例如（在伪代码中）：

```
// Define your function ahead of time so that you can reuse it easily.
var myMagicFunction = function() { // magic happens here };

// This occurs when your page loads
$(document).ready(myMagicFunction());

// Assuming that you pass a url and your magic function as the callback
myMagicAJAXCall(url, myMagicFunction); 
```

# jquery - jQuery：淡出然后上滑

> ID：734554
> 
> 赞同：30
> 
> 时间：2009-04-09T14:47:18.067
> 
> 标签：jquery, fadeout, slideup

如果正在删除一个项目，那么我想将其淡出并向上滑动其他元素以填充空白空间。现在，当我使用`fadeOut()`该项目时，最后没有高度，这会导致其他项目向上跳跃（而不是很好地向上滑动）。

之后我怎么能`slideUp()`和元素`fadeOut()`呢？

* * *

## 回答 #1

> 赞同：54
> 
> 时间：2009-04-09T15:55:00.157

听起来使用 jQuery [fadeTo](http://docs.jquery.com/Effects/fadeTo)命令会更好

```
 $(function() {

     $("#myButton").click(function() {
         $("#myDiv").fadeTo("slow", 0.00, function(){ //fade
             $(this).slideUp("slow", function() { //slide up
                 $(this).remove(); //then remove from the DOM
             });
         });

     });

}); 
```

[工作演示在这里](http://jsbin.com/avebe/16)。

通过执行前一个命令的回调函数中的每一个命令，直到前一个命令完成后该命令才会运行；当元素从 DOM 中移除而不等待 slideUp 完成时，会发生“跳转”。

* * *

## 回答 #2

> 赞同：41
> 
> 时间：2009-04-09T15:31:29.637

```
jQuery.fn.fadeThenSlideToggle = function(speed, easing, callback) {
  if (this.is(":hidden")) {
    return this.slideDown(speed, easing).fadeTo(speed, 1, easing, callback);
  } else {
    return this.fadeTo(speed, 0, easing).slideUp(speed, easing, callback);
  }
}; 
```

我在 JQuery 1.3.2 上对其进行了测试，它确实有效。

编辑：这是我调用它的代码。#slide-then-fade 是按钮元素的 ID，article-text 是 div 标签上的类：

```
$(document).ready(function() {
  $('#slide-then-fade').click(function() {
    $('.article-text').fadeThenSlideToggle();
  });
}); 
```

编辑 2：修改为使用内置的 slideUp。

编辑3：重写为切换，并使用fadeTo

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T14:48:21.170

不能挂链吗？

```
$('myelement').fadeOut().slideUp(); 
```

**编辑**：

也许[这](http://www.learningjquery.com/2008/02/simple-effects-plugins)会有所帮助？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2012-07-04T18:02:31.170

```
$("#id").fadeIn(500, function () {

    $("#id2").slideUp(500).delay(800).fadeOut(400);

}); 
```

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2015-09-18T09:17:23.610

尝试`$('.row').animate({ height: 'toggle', opacity: 'toggle' }, 'slow').slideUp();`

[演示在这里](http://jsfiddle.net/a1fdu3qp/)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-09T15:02:47.140

fadeOut 函数接受回调函数的第二个可选参数，因此您应该能够执行以下操作：

```
$('elementAbove').fadeOut(500, function() {
    $('elementBelow').slideUp();
}); 
```

编辑：忘记添加淡出的速度作为第一个参数

# asp.net - ASP.NET 数据集与业务对象/ORM

> ID：734560
> 
> 赞同：4
> 
> 时间：2009-04-09T14:48:57.440
> 
> 标签：asp.net, orm, dataset

我正在考虑 ASP.NET 应用程序的数据访问。来自一家使用大量带有客户端数据集的 Windows 应用程序的公司，自然而然地倾向于使用 DataSet 方法来处理数据。

我更热衷于业务对象方法，我不喜欢在会话中缓存 DataSet 然后应用更新的想法。

有没有人有任何经验/帮助传递这两种方法的优缺点？

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T14:55:58.640

你很聪明地考虑在你的应用程序中设计一个数据层。在 ASP.NET 应用程序中，这将帮助您标准化并大大简化您的数据访问。您*将*需要学习如何创建和使用 ObjectDataSource，但这非常简单。

数据访问层（使用单独的项目/DLL 构建）的另一个优点是它使单元测试更加简单。我还鼓励您构建一个业务层来完成大部分数据处理（例如，业务层将负责将 ObjectDataSources 从 DAL 拉到 UI 代码中）。这不仅可以让您封装业务逻辑，还可以提高代码的可测试性。

您不想*在*会话中缓存数据集（或 DAL 对象）！您将构建一个 Web 应用程序，以便记录修改通过唯一 ID（或其他主键规范）工作，并在进行更改时直接将更改提供给 DAL。如果您要缓存所有内容，您将*大大*降低应用程序的可扩展性。

更新：这个线程上的其他人正在推广使用 ORM 的想法。[出于我之前在此处](https://stackoverflow.com/questions/458802/doesnt-linq-to-sql-miss-the-point-arent-orm-mappers-subsonic-etc-sub-opti)和[此处](https://stackoverflow.com/questions/640004/is-linqtosql-powerful-enough-isnt-a-more-powerful-but-equally-fluent-interface)概述的原因，我会谨慎采用成熟的 ORM 。*不过，*我同意避免使用 DataSet 是明智之举。在我自己的工作中，我广泛使用 DataReaders 来填充我的 ObjectDataSources（由于我的 DAL 的设计，这很简单）并且发现它非常有效。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T14:52:05.560

与其他 ADO.NET 对象（如 DataReaders）相比，DataSet 的效率可能非常低。我建议根据您所说的走向 BO/ORM 路线。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T14:51:08.387

如果你要跟随微软的方向，那么趋势肯定是朝向 LINQ (ORM) 与 DataSets。当 DataSets 出现时（ASP.NET 1.0），LINQ 甚至是不可能的。使用 LINQ，您可以获得类型安全和内置函数来从数据库中创建/更新/删除。

Microsoft 甚至尝试通过[LINQ to DataSet](http://msdn.microsoft.com/en-us/library/bb386977.aspx)使转换更容易。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T14:57:12.583

我们即将对大量使用 DataSet 对象的现有 asp 应用程序进行重大更新；虽然不期待痛苦，但还是要坚持走BO路线。现在一想到要让数据集工作就让我大汗淋漓。

我认为我们将走 LINQ 路线并使用轻量级实体对象。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T15:15:17.190

我工作的公司也大量使用数据集，同时也有业务层。BL 主要从数据库中加载数据集。

我个人不喜欢这种方法。还有一种做法是在加载后/保存前直接修改数据集，以满足一些即时需求。对我来说，它确实违反了业务对象的概念，但它就是这样做的。

ORM 框架确实可以为您节省大量时间，尤其是在具有大量具有类似按钮和操作的视图的企业应用程序中。

但也很容易失控。从那时起，它会慢慢变成一团糟。

在正确的情况下使用这两个选项都很好。只是不要混合它们。决定以一种方式去做并遵循它。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-06-20T15:34:36.530

Mark Brittingham 的回答对于两层应用程序来说是准确的。但是，如果我想使用服务层怎么办。数据集是可序列化的。类型化的数据集节省了手动编码您自己的对象的时间。类型化数据集是可扩展的。Linq to Entities 有性能问题，Linq to SQL 现在已经死了。Linq to DataSet 将始终是一个选项。

我将使用 Typed DataSet 和多层架构来节省时间和组织代码。我已经尝试过手动编码的 BO，额外的时间和维护时间不值得。

# javascript - 是否可以隐藏或加扰/混淆网页的 javascript 代码？

> ID：734561
> 
> 赞同：8
> 
> 时间：2009-04-09T14:49:12.120
> 
> 标签：javascript, html, hide

我知道客户端代码必须可以从浏览器中读取，但我想知道（因为我忽略了太多东西）是否有办法混淆最终用户的代码，如果没有，“打包”的最佳实践是什么" javascript 代码。

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-09T14:51:19.400

[使用YUI Compressor](http://yui.github.io/yuicompressor/)等工具缩小 JS 是一种很好的做法。除非您有特殊需要，否则我不会混淆它。有很多在线混淆器，例如[这个](http://www.javascriptobfuscator.com/Default.aspx)

看到这篇文章：http: [//developer.yahoo.net/blog/archives/2007/07/high_performanc_8.html](http://developer.yahoo.net/blog/archives/2007/07/high_performanc_8.html)

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T14:50:33.303

看看[这个](https://stackoverflow.com/questions/702907/what-are-some-good-css-and-js-minimizers-for-production-code)。

除了挖掘它，我认为你不能真正隐藏 js。这一切都通过用户的浏览器进行，一旦出现，就有很多方法可以看到它。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T14:52:44.263

请参阅[此处](http://www.javascriptobfuscator.com/)获取免费的 Javascript 混淆器。

鉴于这实际上是可能的，如果您打算混淆的原因是为了保护知识产权，那么您可能正试图以错误的方式从您的工作中获取价值。逆转混淆相当容易，您可能会浪费时间维护您的代码。

更多地关注您打算为访问您网站的人提供哪些服务，以使您的网站与竞争对手区分开来

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-10T20:41:48.087

任何混淆都不会让你的代码真正安全，它可能只会给你一种安全的错觉（参见[security by obscurity](http://en.wikipedia.org/wiki/Security_by_obscurity)）。

如果您确实需要对代码的某些部分保密，请考虑将敏感部分拉入服务器端脚本并对脚本进行（例如）AJAX 调用。尤其是随着 JSON 的出现，与服务器端脚本的通信从未如此简单。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T14:52:46.150

有一些[工具](https://stackoverflow.com/questions/599911/what-do-you-use-to-minimize-and-compress-javascript-libraries)可用于压缩 javascript 代码并使最终用户难以理解。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T14:53:03.903

有没有理由为什么这对你不起作用？

[http://www.javascriptobfuscator.com/](http://www.javascriptobfuscator.com/)

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T16:08:46.490

不要在 javascript 中放置任何敏感或个人信息。

花时间保护服务器上的数据安全。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T16:22:19.577

第 1 步：不要。

你必须做很多事情才能达到任何有意义的混淆水平。仅对名称进行混淆是不够的，因为所有标准函数仍然存在（尽管它们可能隐藏在一层较短/混淆的别名中），并且一旦代码格式良好，就很容易得出特定函数的目的再次。任何真正想知道你的 JS 代码做什么的人都可以并且愿意，无论你在他们的浏览器得到它的副本之前对它做了什么。

如果您的 JavaScript 中*确实*有有价值的业务流程，那么您做错了（tm）。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2012-08-12T09:57:41.710

可以使用以下工具：

*   YUI Compressor - 需要 Java - 非常好的压缩器

*   Packer - 创建最令人困惑和最小的代码，但脚本的运行速度不如 YUI - 这可以在线使用。选择“Base62 编码”以获得最大效果。

*   Dojo Compressor 我从来没有使用过这个，但它在顶级列表中。它还需要Java。

*   JSMIN By Douglas Crockford，这个算法非常简单，但还是不错的。旨在与 JSLint 结合使用。

# mysql - 从多个表中删除行

> ID：734567
> 
> 赞同：10
> 
> 时间：2009-04-09T14:50:43.880
> 
> 标签：mysql, delete-row, sql-delete

我正在尝试使用 SQL 从连接在一起的多个表中删除多行。

表 A 连接到表 B 表 B 连接到表 C

我想删除表 B 和 C 中与表 A 中的行相对应的所有行

```
CREATE TABLE `boards` (
  `boardid` int(2) NOT NULL AUTO_INCREMENT,
  `boardname` varchar(255) NOT NULL DEFAULT '',
  PRIMARY KEY  (`boardid`)
);

-- --------------------------------------------------------

-- 
-- Table structure for table `messages`
-- 

CREATE TABLE `messages` (
  `messageid` int(6) NOT NULL AUTO_INCREMENT,
  `boardid` int(2) NOT NULL DEFAULT '0',
  `topicid` int(4) NOT NULL DEFAULT '0',
  `message` text NOT NULL,
  `author` varchar(255) NOT NULL DEFAULT '',
  `date` datetime DEFAULT NULL,
  PRIMARY KEY  (`messageid`)
);

-- --------------------------------------------------------

-- 
-- Table structure for table `topics`
-- 

CREATE TABLE `topics` (
  `topicid` int(4) NOT NULL AUTO_INCREMENT,
  `boardid` int(2) NOT NULL DEFAULT '0',
  `topicname` varchar(255) NOT NULL DEFAULT '',
  `author` varchar(255) NOT NULL DEFAULT '',
  PRIMARY KEY  (`topicid`)
); 
```

* * *

## 回答 #1

> 赞同：20
> 
> 时间：2009-04-09T14:58:33.313

好吧，如果您使用过 InnoDB 表，则可以使用外键设置[级联删除，](http://dev.mysql.com/doc/refman/5.1/en/innodb-foreign-key-constraints.html)这一切都会自动完成。但是如果你有使用 MyISAM 的原因，你只需使用[多表 DELETE](http://dev.mysql.com/doc/refman/5.1/en/delete.html)：

```
DELETE FROM boards, topics, messages
USING boards INNER JOIN topics INNER JOIN messages
WHERE boards.boardid = $boardid
    AND topics.boardid = boards.boardid
    AND messages.boardid = boards.boardid; 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-09T14:54:11.703

如果您使用带有“on delete cascade”的外键，这可以由您的数据库系统完成。

看看这里： [http ://dev.mysql.com/doc/refman/5.1/en/innodb-foreign-key-constraints.html](http://dev.mysql.com/doc/refman/5.1/en/innodb-foreign-key-constraints.html)

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T15:00:11.470

您可以只检查是否存在

```
delete from topics where boardid in (select boardid from boards)
delete from messages where boardid in (select boardid from boards) 
```

但这只有在这种行为不应该总是适用的情况下才有意义。当行为应始终适用时，在级联上使用 delete 实现外键

在无数个网站、您的帮助文件和[此处进行了解释](http://en.wikipedia.org/wiki/Foreign_key#CASCADE)

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2014-02-24T10:12:27.447

从多个表中删除行可以通过两种方式完成：

*   从一个表中删除行，通过引用另一个表来确定要删除的行
*   使用单个语句从多​​个表中删除行

* * *

多表 DELETE 语句可以用两种格式编写。以下示例演示了一种语法，用于从表 t1 中删除 id 值与表 t2 中的值匹配的行的查询：

```
DELETE t1 FROM t1, t2 WHERE t1.id = t2.id; 
```

第二种语法略有不同：

```
DELETE FROM t1 USING t1, t2 WHERE t1.id = t2.id; 
```

要从两个表中删除匹配的记录，语句是：

```
DELETE t1, t2 FROM t1, t2 WHERE t1.id = t2.id;
DELETE FROM t1, t2 USING t1, t2 WHERE t1.id = t2.id; 
```

当这些语句用于多表操作时，不允许使用通常由 UPDATE 和 DELETE 支持的 ORDER BY 和 LIMIT 子句。

# asp.net - 用于通用编辑器的 ASP.NET UserControl

> ID：734571
> 
> 赞同：2
> 
> 时间：2009-04-09T14:51:12.427
> 
> 标签：asp.net, architecture

我想为 ASP.NET 制作一个更通用的编辑器控件，从而可以在我的站点上的任何编辑器中使用相同的事件/通用代码。有没有人对此有任何经验/见解？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T15:03:10.090

您说的是富文本/HTML 编辑器吗？您可能想先查看一些可用选项：

*   [CodePlex 的富文本编辑器](http://www.codeplex.com/rte)
*   [FCKEditor](http://www.fckeditor.net/)（他们有一个 ASP.NET 集成包）
*   [YUI 富文本编辑器](http://developer.yahoo.com/yui/editor/)（使用[YUIAsp.Net](http://www.yuiasp.net/)与 ASP.NET 集成）

这些选项（我相信）都是开源的，是前进的良好基础。我确定还有其他人。

# visual-studio - 在调试一个项目时阻止 Visual Studio 构建所有项目

> ID：734573
> 
> 赞同：29
> 
> 时间：2009-04-09T14:51:55.077
> 
> 标签：visual-studio

我有一个包含几个不同项目的解决方案：几个 dll 项目、一个控制台项目和几个 WCF 项目。

控制台项目使用其中一个项目的 dll，但我设置了 VS，因此控制台项目没有依赖项。但是，当我调试控制台项目时，VS 会启动或构建我的所有项目。这只是一个痛苦，因为 WCF 项目编译和启动 WCF 客户端或 asp.net dev IIS 进程。有没有办法防止这种行为？

编辑：我已经半修好了。为了防止 WCF 库启动，我遵循了这个：[如何防止 Visual Studio 在 Debuggin 中启动 WcfSvcHost.exe？](https://stackoverflow.com/questions/283145/how-to-prevent-visual-studio-launch-wcfsvchost-exe-in-debuggin)

但我仍然无法阻止 asp.net 开发服务器启动。

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-04-09T14:54:56.240

右键单击您的解决方案，然后转到“属性”、“配置属性”并选择要编译的项目。

* * *

## 回答 #2

> 赞同：25
> 
> 时间：2009-04-09T15:30:18.860

您可以尝试在运行项目时检查 Visual Studio 构建的内容。打开选项对话框，然后转到项目和解决方案 | 构建并运行。尝试打开“仅在运行时构建启动项目和依赖项”。

* * *

## 回答 #3

> 赞同：16
> 
> 时间：2009-08-17T18:18:02.053

要阻止 ASP.Net 开发服务器启动：

只需在解决方案资源管理器中单击 Web 项目，然后按 F4 以显示属性窗口，并将“调试时始终启动”从“True”更改为“False”。您可能需要检查解决方案中的所有项目。

有关更多信息，请参阅[此线程](https://stackoverflow.com/questions/127093/why-do-vs2008-spawn-one-cassini-for-each-web-site-application-when-going-into-deb/759270#759270)。

* * *

## 回答 #4

> 赞同：-3
> 
> 时间：2014-06-19T11:37:54.107

只需卸载项目，右键单击项目 -> 卸载项目

# asp.net-mvc - 使用 ASP.NET MVC 的 SEO URL

> ID：734583
> 
> 赞同：5
> 
> 时间：2009-04-09T14:53:56.350
> 
> 标签：asp.net-mvc, routing, seo

实施 seo url 时是否有明确的**DO**和**DONT ？**许多好的做法对于 .html 网站来说似乎很好，但在中型/大型数据库网站上却失败了。

AFAIK 网址应该是**www.mysite.com/category/page-name-here**

如果我希望创建一个内容丰富的网站并且默认类别和页面是数据库驱动的 - 这是否会阻止我将**www.mysite.com/about**或**www.mysite.com/home**等页面作为 about 和 home 页面可能会发生冲突。

尽管路由引擎很灵活，但上述是否可行和/或值得？

-编辑-

只是为了详细说明我的问题，是否可以使用数据库控制路由引擎？

url 包含有意义的描述是一种很好的做法 - 例如 **stackoverflow.com/category/mvc**和**stackoverflow.com/questions/seo-urls-with-asp-net-mvc**是好的（而不是**stackoverflow.com/category /9955**和**stackoverflow.com/questions/734583**）

作为一个过期，我想将控制提升到另一个层次，假设上面的两个控制器（类别和问题），每个显示动态数据都可以修改为简单的 **stackoverflow.com/mvc**和**stackoverflow.com/seo- urls-with-asp-net-mvc**。

我需要确保我的数据库包含一个表，告诉我前者将作为类别路由，而后者作为问题路由 - 这可以通过简单的数据库查找来实现，并且需要在 Global.asax 中实现

我的问题是，这可以实现吗？潜在的陷阱是什么。

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-09T14:58:24.157

如果您在通用路由之上添加硬编码路由，这很容易实现：

```
// AboutController.Index()
routes.MapRoute( 
    "About",
    "about",
    new { controller = "About", action = "Index" });

// HomeController.Index()
routes.MapRoute( 
    "Home",
    "home",
    new { controller = "Home", action = "Index" });

// ArticleController.Index(string category, string pagename)
routes.MapRoute( 
    "Article",
    "{category}/{pagename}",
    new { controller = "Article", action = "Index" }); 
```

如果您愿意，他们都可以使用相同的控制器，但如果他们使用单独的控制器，可能会更容易一些。

您遇到的唯一问题是如果您有一个名为“关于”或“家”的类别，但我想这不太可能。

还应该注意的是，[您不必使用 ASP.NET MVC 来使用路由功能](http://msdn.microsoft.com/en-us/library/cc668202.aspx)。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-09T15:09:23.647

为了避免您提到的静态页面（关于、主页等）的问题，您可以采取一些不同的方法：

1.  将动态类别页面放在单独的路径中（例如 www.mysite.com/shop/category/page-name-here）
2.  将静态页面放在单独的路径中（例如 www.mysite.com/pages/about）。现在您不能有一个名为“页面”的类别，但所有其他类别都可以。
3.  将静态路由置于动态路由之上。不理想，因为如果您将类别命名不当，它可能会隐藏类别页面，但即使您执行了 #1 或 #2，您仍然希望将其作为以防万一的措施。

其他注意事项/陷阱：

1.  您还需要确保您的类别名称和页面名称是唯一的。在大型网站上，这并不总是微不足道的（甚至是实用的），这可能就是为什么您会在 Stack Overflow 上看到类似此处的 URL，其中问题 id 实际上位于 URL 中，而“页面名称”部分只是 SEO 糖。

2.  您需要制定处理名称更改的策略。如果类别名称或页面名称发生更改，您需要准备好一些东西来将旧名称的链接重定向到新名称，以获得最大的 SEO 优势。您还需要确保类别/页面的新名称与另一个类别/页面的旧名称不同，这会增加图片的复杂性。

综上所述，这是可行的，在我看来这当然是值得的。特别是如果您希望您的大部分流量来自搜索引擎。

# c# - 从字符串创建对象名称

> ID：734591
> 
> 赞同：2
> 
> 时间：2009-04-09T14:55:10.093
> 
> 标签：c#, reflection, loops

假设我想遍历数据读取器并创建一定类型的对象的负载，但使用数据读取器中的值作为对象名称，例如

```
String "string_" + <value from datareader> = new String(); 
```

因此，如果我从数据读取器中获得值 temp1、temp2 和 temp3，我将拥有 3 个字符串类型的新对象，例如

```
string_temp1
string_temp2
string_temp3 
```

如何使用数据读取器中的名称创建对象？或者有什么更好的方法来做到这一点？

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-09T14:58:10.537

而不是使用反射，我认为使用 a`Dictionary`将您希望对象具有的名称映射到它们的值会更容易：

```
var map = new Dictionary<String, String>();
map[...] = new String();
//   ^
//   |
//   +---- substitute with whatever naming scheme you deem suitable 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T15:21:07.320

这样做没有什么价值。如果您从该值创建变量 NAME，则无法在此后的代码中引用该变量，因为代码是在编译时编译的，并且您试图在运行时设置变量名称。

请记住，变量名实际上只是为了让编译器能够映射到 IL，并最终正确地 JIT。这就是混淆起作用的原因 - 大多数混淆器所做的主要事情之一就是将所有变量名打乱成非常短的、无意义的名称。这对运行时行为没有影响——名称一旦编译就毫无意义。

我建议采用 John Feminella 的方法，或类似的方法。

# batch-file - 遇到错误时如何使批处理文件终止？

> ID：734598
> 
> 赞同：331
> 
> 时间：2009-04-09T14:56:16.533
> 
> 标签：batch-file

我有一个批处理文件，它使用不同的参数一遍又一遍地调用相同的可执行文件。如果其中一个调用返回任何级别的错误代码，如何使其立即终止？

基本上，我想要相当于 MSBuild 的`ContinueOnError=false`.

* * *

## 回答 #1

> 赞同：337
> 
> 时间：2009-04-09T15:03:30.290

检查`errorlevel`in`if`语句，然后**（**`exit /b`仅退出批处理文件，而不是整个 cmd.exe 进程）检查 0 以外的值。

 **```
same-executable-over-and-over.exe /with different "parameters"
if %errorlevel% neq 0 exit /b %errorlevel% 
```

如果您希望错误级别的值传播到批处理文件之外

```
if %errorlevel% neq 0 exit /b %errorlevel% 
```

但如果这是在里面，`for`那就有点棘手了。你需要更多类似的东西：

```
setlocal enabledelayedexpansion
for %%f in (C:\Windows\*) do (
    same-executable-over-and-over.exe /with different "parameters"
    if !errorlevel! neq 0 exit /b !errorlevel!
) 
```

**编辑：**您必须在每个命令后检查错误。cmd.exe/command.com 批处理中没有全局“on error goto”类型的构造。我还根据[CodeMonkey](https://stackoverflow.com/questions/734598#734744)更新了我的代码，尽管我在 XP 或 Vista 上的任何批量黑客攻击中从未遇到过负错误级别。

* * *

## 回答 #2

> 赞同：275
> 
> 时间：2012-01-22T21:58:52.297

添加`|| goto :label`到每一行，然后定义一个`:label`.

例如，创建这个 .cmd 文件：

```
@echo off

echo Starting very complicated batch file...
ping -invalid-arg || goto :error
echo OH noes, this shouldn't have succeeded.
goto :EOF

:error
echo Failed with error #%errorlevel%.
exit /b %errorlevel% 
```

另请参阅[有关退出批处理文件子例程](https://superuser.com/questions/80485/exit-batch-file-from-subroutine)的问题。

* * *

## 回答 #3

> 赞同：110
> 
> 时间：2014-02-20T15:26:00.503

最短的：

```
command || exit /b 
```

如果需要，可以设置退出代码：

```
command || exit /b 666 
```

您还可以登录：

```
command || echo ERROR && exit /b 
```

* * *

## 回答 #4

> 赞同：27
> 
> 时间：2017-10-18T14:55:15.770

这是一个用于 BASH 和 Windows CMD 的[多语言程序](https://en.wikipedia.org/wiki/Polyglot_(computing))，它运行一系列命令并在其中任何一个失败时退出：

```
#!/bin/bash 2> nul

:; set -o errexit
:; function goto() { return $?; }

command 1 || goto :error

command 2 || goto :error

command 3 || goto :error

:; exit 0
exit /b 0

:error
exit /b %errorlevel% 
```

我过去曾将这种类型的东西用于多平台[持续集成](https://en.wikipedia.org/wiki/Continuous_integration)脚本。

* * *

## 回答 #5

> 赞同：24
> 
> 时间：2009-04-09T15:30:52.493

一个小更新，您应该将“if errorlevel 1”的检查更改为以下...

```
IF %ERRORLEVEL% NEQ 0 
```

这是因为在 XP 上您可以得到负数作为错误。0 = 没有问题，其他都是问题。

请记住 DOS 处理“IF ERRORLEVEL”测试的方式。如果您要检查的数字是该数字或更高，它将返回 true，因此如果您正在寻找特定的错误数字，您需要从 255 开始并向下工作。

* * *

## 回答 #6

> 赞同：15
> 
> 时间：2018-08-17T14:20:18.203

我更喜欢 OR 形式的命令，因为我发现它们最易读（而不是在每个命令之后都有 if）。但是，这样做的幼稚方式`command || exit /b %ERRORLEVEL%`是*错误*的。

这是因为批处理会在第一次读取一行时扩展变量，而不是在使用它们时。这意味着如果`command`上面一行中的 失败，批处理文件会正确退出，但它会以返回码 0 退出，因为那是`%ERRORLEVEL%`行开头的值。显然，这在我们的脚本中是不可取的，所以我们必须启用 [延迟扩展](https://ss64.com/nt/delayedexpansion.html)，如下所示：

```
SETLOCAL EnableDelayedExpansion

command-1 || exit /b !ERRORLEVEL!
command-2 || exit /b !ERRORLEVEL!
command-3 || exit /b !ERRORLEVEL!
command-4 || exit /b !ERRORLEVEL! 
```

此代码段将执行命令 1-4，如果其中任何一个失败，它将以与失败命令相同的退出代码退出。

* * *

## 回答 #7

> 赞同：2
> 
> 时间：2014-11-26T06:06:21.927

我们不能总是依赖 ERRORLEVEL，因为很多时候外部程序或批处理脚本不会返回退出代码。

在这种情况下，我们可以对这样的故障使用通用检查：

```
IF EXIST %outfile% (DEL /F %outfile%)
CALL some_script.bat -o %outfile%
IF NOT EXIST %outfile%  (ECHO ERROR & EXIT /b) 
```

如果程序向控制台输出了一些东西，我们也可以检查它。

```
some_program.exe 2>&1 | FIND "error message here" && (ECHO ERROR & EXIT /b)
some_program.exe 2>&1 | FIND "Done processing." || (ECHO ERROR & EXIT /b) 
```

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2017-09-05T15:13:22.107

无论我如何尝试，即使 msbuild 失败，errorlevel 始终保持为 0。所以我建立了我的解决方法：

构建项目并将日志保存到 Build.log

```
SET Build_Opt=/flp:summary;logfile=Build.log;append=true

msbuild "myproj.csproj" /t:rebuild /p:Configuration=release /fl %Build_Opt% 
```

在构建日志中搜索“0 Error”字符串，将结果设置为 var

```
FOR /F "tokens=* USEBACKQ" %%F IN (`find /c /i "0 Error" Build.log`) DO (
    SET var=%%F
)
echo %var% 
```

获取最后一个字符，表示有多少行包含搜索字符串

```
set result=%var:~-1%

echo "%result%" 
```

如果未找到字符串，则错误 > 0，构建失败

```
if "%result%"=="0" ( echo "build failed" ) 
```

该解决方案的灵感来自 Mechaflash 在[如何将命令输出设置为批处理文件中的变量的帖子](https://stackoverflow.com/questions/6359820/how-to-set-commands-output-as-a-variable-in-a-batch-file)

和[https://ss64.com/nt/syntax-substring.html](https://ss64.com/nt/syntax-substring.html)

* * *

## 回答 #9

> 赞同：-3
> 
> 时间：2013-09-05T23:27:23.360

```
@echo off

set startbuild=%TIME%

C:\WINDOWS\Microsoft.NET\Framework\v3.5\msbuild.exe c:\link.xml /flp1:logfile=c:\link\errors.log;errorsonly /flp2:logfile=c:\link\warnings.log;warningsonly || goto :error

copy c:\app_offline.htm "\\lawpccnweb01\d$\websites\OperationsLinkWeb\app_offline.htm"

del \\lawpccnweb01\d$\websites\OperationsLinkWeb\bin\ /Q

echo Start Copy: %TIME%

set copystart=%TIME%

xcopy C:\link\_PublishedWebsites\OperationsLink \\lawpccnweb01\d$\websites\OperationsLinkWeb\ /s /y /d

del \\lawpccnweb01\d$\websites\OperationsLinkWeb\app_offline.htm

echo Started Build: %startbuild%
echo Started Copy: %copystart%
echo Finished Copy: %TIME%

c:\link\warnings.log

:error

c:\link\errors.log 
```

# jquery - 在 jEditable 中将父母的 ID 作为参数发送

> ID：734599
> 
> 赞同：4
> 
> 时间：2009-04-09T14:56:17.843
> 
> 标签：jquery

给定

```
$(".foo").editable("script.php") 
```

如何将`.foo`父级的 ID 作为参数传递？我试过了

```
$(".foo").editable("script.php", { 

     submitdata: {

          parent_id: $(this).parent().attr('id')

                 }
     }); 
```

以及我能想到的所有变体，但似乎 $(this) 对象在这种情况下不起作用。

* * *

## 回答 #1

> 赞同：15
> 
> 时间：2009-09-03T21:16:40.427

我在这里遇到了同样的问题，找到了以下解决方案：

```
$('.jeditable').each(function() {
   var $this = $(this);
   $this.editable('submit.jsp', {
      submitdata  : { parent_id : $this.parent().attr('id') }
   });
}); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-11-23T10:36:28.180

您可以进行 Ajax 调用，这样您就可以传递所有内容（如果您正在寻找未来，也许您将添加一些功能......）。

例子：

```
$('.edit').editable(
    function(value, settings) {

        // prepare the data, add all parameters you want

        var data = "param1=value1" +
            "&param2=value2";

        var ret = "";

        // make the ajax call to do the work (not async)
        $.ajax({
            type: "POST",
            url: "page.php",
            data: data,
            async: false,
            success: function(msg) {

                if (msg.length != 0) {

                    // set the value to write in the element
                    ret = msg;

                }

            }

        });

        // return the element to save into the element
        return ret;

    }, {

        // set the jeditable setting
        cssclass: 'classname'
    }

); 
```

我认为这种方法更灵活地处理每种情况。

* * *

## 回答 #3

> 赞同：-1
> 
> 时间：2009-04-09T15:05:10.553

我会这样做：

`$(".foo").editable("script.php", { submitdata: { parent_id: $(".foo").parent().attr('id') } });`

你的问题也有错字，你有 $(.foo).editable() 而不是 $(".foo").editable()。如果这也在您的实际代码中，那可能是问题的根源。

# vb.net - VB.NET中连接字符串的+和&的区别

> ID：734600
> 
> 赞同：72
> 
> 时间：2009-04-09T14:56:42.537
> 
> 标签：vb.net, string

在 VB.NET 中加入字符串`+`和加入字符串有什么区别？`&`

* * *

## 回答 #1

> 赞同：94
> 
> 时间：2009-04-09T15:02:50.620

如果两个操作数都是字符串，则没有区别。但是，如果一个操作数是一个字符串，一个是一个数字，那么就会遇到问题，请参见下面的代码。

```
"abc" + "def" = "abcdef"
"abc" & "def" = "abcdef"
"111" + "222" = "111222"
"111" & "222" = "111222"
"111" & 222 = "111222"
"111" + 222 = 333
"abc" + 222 = conversion error 
```

因此，我建议`&`在您想要连接时始终使用，因为您可能会尝试将整数、浮点数、小数连接到字符串，这将导致异常，或者充其量不会执行您可能希望它执行的操作。

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-09T15:01:05.553

& 运算符始终确保两个操作数都是字符串，而 + 运算符查找与操作数匹配的重载。

表达式`1 & 2`给出值“12”，而表达式 1 + 2 给出值 3。

如果两个操作数都是字符串，则结果没有区别。

* * *

## 回答 #3

> 赞同：11
> 
> 时间：2010-09-13T19:32:03.283

没有任何。

正如你在下面看到的。这两行代码完全编译为相同的 CIL 代码：

```
Module Module1

    Sub Main()
        Dim s1 As String = "s1"
        Dim s2 As String = "s2"
        s2 += s1
        s1 &= s2
    End Sub

End Module 
```

编译为（注`System.String::Concat`）：

```
.method public static void  Main() cil managed
{
.entrypoint
.custom instance void [mscorlib]System.STAThreadAttribute::.ctor() = ( 01 00 00 00 )
// Code size       31 (0x1f)
.maxstack  2
.locals init ([0] string s1,
       [1] string s2)
IL_0000:  nop
IL_0001:  ldstr      "s1"
IL_0006:  stloc.0
IL_0007:  ldstr      "s2"
IL_000c:  stloc.1
IL_000d:  ldloc.1
IL_000e:  ldloc.0
IL_000f:  call       string [mscorlib]System.String::Concat(string,
                                                          string)
IL_0014:  stloc.1
IL_0015:  ldloc.0
IL_0016:  ldloc.1
IL_0017:  call       string [mscorlib]System.String::Concat(string,
                                                          string)
IL_001c:  stloc.0
IL_001d:  nop
IL_001e:  ret
} // end of method Module1::Main 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-09T15:01:22.217

大多数情况下没有区别。但是，最佳做法是：

"+" 应该为*整数加法*保留，因为如果你不使用**Option Strict On**那么你可能真的搞砸了，比如：

`Input + 12`可能会给你`20`而不是`812`. 这在输入来自 POST/GET 的 ASP.NET 应用程序中尤其糟糕。

简单地说：**对于连接字符串，总是使用“&”而不是“+”。**

*显然，在合适的地方使用[StringBuilder](http://msdn.microsoft.com/en-us/library/2839d5h5%28v=vs.71%29.aspx) :)*

* * *

## 回答 #5

> 赞同：3
> 
> 时间：2009-04-09T15:03:41.633

+ 运算符可以是加法或串联。& 只是连接。如果表达式都是字符串，则结果将是相同的。

我在处理字符串时使用 &，在处理数字时使用 +，所以我的意图永远不会混淆。如果您错误地使用 + 并且一个表达式是一个字符串而一个是一个数字，那么您将面临不想要的结果的风险。

* * *

## 回答 #6

> 赞同：2
> 
> 时间：2009-04-09T15:05:48.570

如果这两种类型都静态类型为[System.String](http://msdn.microsoft.com/en-us/library/system.string.aspx)，则代码之间的差异为零。两者都将解析为[String.Concat](http://msdn.microsoft.com/en-us/library/khca9w90.aspx)成员（这就是`+`字符串的作用）。

但是，如果对象不是强类型为字符串，Visual Basic 后期绑定将启动并采用两条截然不同的路线。该`+`版本将尝试执行*添加*操作，该操作实际上会尝试添加对象。这将尝试将两个值都转换为数字，然后将它们相加。

运算符将`&`尝试连接。Visual Basic 运行时将通过各种方式将两个值都转换为字符串。然后就会`String.Concat`出结果。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2016-05-05T19:13:37.827

直接来自 MSDN 文档：[Visual Basic 中的连接运算符](https://msdn.microsoft.com/en-us/library/te2585xw.aspx)

> 两个连接运算符之间的差异
> 
> + 运算符 (Visual Basic) 的主要目的是将两个数字相加。但是，它也可以将数字操作数与字符串操作数连接起来。+ 运算符有一组复杂的规则，用于确定是添加、连接、发出编译器错误信号还是抛出运行时 InvalidCastException 异常。
> 
> & 运算符 (Visual Basic) 仅为 String 操作数定义，它总是将其操作数扩展为 String，而不管 Option Strict 的设置如何。建议将 & 运算符用于字符串连接，因为它是专门为字符串定义的，可以减少生成意外转换的机会。

请相信 MSDN！:-)

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T15:00:06.493

加入字符串时无：

```
 Dim string1 As String = "A" + "B"
    Dim string2 As String = "A" & "B"

    If string1.Equals(string2) And string2.Equals(string1) Then
        Debugger.Break()
    End If 
```

# vb6 - 列表视图上的 VB6 AllowColumnReorder 不起作用

> ID：734602
> 
> 赞同：0
> 
> 时间：2009-04-09T14:57:12.023
> 
> 标签：vb6

我已经安装了最新的 VB6 补丁，我正在尝试设置一个列表视图以允许列重新排序。我已经尝试在可视化编辑器中将属性 AllowColumnReorder 设置为 True，以及在表单加载过程中调用 AllowColumnReorder=true。

然而，在运行应用程序时，我仍然无法移动列。

还有其他我应该寻找的东西吗？代码中没有任何地方明确关闭此功能。

谢谢！

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-17T13:29:35.367

您需要使用 User32 API：

```
Declare Auto Function SendMessage Lib "user32" _
  (ByVal hwnd As IntPtr, _
   ByVal Msg As Integer, _
   ByVal wParam As Integer, _
   ByVal lParam() As Integer) As Integer

Dim colArray(colCount - 1) As Integer
SendMessage(ListView1.Handle, LVM_GETCOLUMNORDERARRAY, colCount, colArray) 
```

# regex - 正则表达式和 XSS 上的“战争”

> ID：734611
> 
> 赞同：1
> 
> 时间：2009-04-09T14:58:54.700
> 
> 标签：regex, xss, markup, text-parsing, bbcode

我一直对编写像论坛或博客这样的网络软件很感兴趣，这些东西需要有限的标记才能重写为 HTML。但是最近，我越来越多地注意到对于 PHP，尝试谷歌搜索“PHP BBCode parser -PEAR”并测试一些，你要么得到一个低效的混乱，要么你得到的代码很糟糕，到处都是 XSS 漏洞。

以我之前提到的例子为例，在那些糟糕的 BBCode 解析器中，你将如何避免 XSS？我现在将使用您的典型正则表达式来处理链接，您可以提及它的脆弱性以及如何避免它。

```
// Assume input has already been encoded by htmlspecialchars with ENT_QUOTES
$text = preg_replace('#\[url\](.*?)\[/url\]#i','<a href="\1">\1</a>', $text);
$text = preg_replace('#\[url=(.*?)\](.*?)\[/url\]#i','<a href="\1">\2</a>', $text); 
```

处理图像标签几乎没有比这更安全的了。

所以我有几个具体的问题，主要是针对 PHP 实现的。

1.  在此示例中，仅使用 uri/url 验证表达式进行匹配是否更好？或者，最好使用`(.*?)`回调，然后确定输入是否是有效链接？正如上面显而易见的`javascript:alert('XSS!')`那样，在上面的 URL 标记中可以工作，但如果完成 uri 匹配，则会失败。
2.  回调中的函数怎么样`urlencode()`，它们会是什么威慑或问题（就 URI 标准而言）？
3.  编写全栈解析器会更安全吗？或者，对于每页处理多个不同条目的东西来说，开发和使用这样的东西所需的时间和处理能力是否太重了？

我知道我的示例是众多示例之一，并且比某些示例更具体。但是，不要逃避提供自己的。 *因此，我正在寻找文本解析情况下 XSS 保护的原则和最佳实践以及一般建议。*

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T17:27:19.593

> 测试一些，你要么得到一个低效的混乱，要么你得到带有 XSS 漏洞的糟糕代码

地狱是的。我还没有遇到过不受 XSS 攻击的 bbcode 实现。

```
'<a href="\1">\1</a>' 
```

不好：无法 HTML 转义 '<'、'&' 和 '"' 字符。

> 在此示例中，仅使用 uri/url 验证表达式进行匹配是否更好？或者，最好使用 (.*?) 和回调，然后确定输入是否是有效链接？

我会接电话。无论如何，您都需要回调来进行 HTML 转义；仅通过简单的字符串替换是不可能安全的。在你做的时候把消毒剂放进去。

> 回调中的 urlencode() 之类的函数呢？

几乎; 实际上你需要 htmlspecialchars()。urlencode() 是关于编码查询参数的，这不是你需要的。

> 编写全栈解析器会更安全吗？

是的。

bbcode 并不真正适合正则表达式解析，因为它是一种基于递归标记的语言（如 XML，正则表达式也无法解析）。许多 bbcode 漏洞是由嵌套和错误嵌套问题引起的。例如：

```
[url]http://www.example.com/[i][/url]foo[/i] 
```

可能会像这样

```
<a href="http://www.example.com/&lt;i>">foo</i> 
```

还有许多其他陷阱会在各种 bbcode 实现上生成损坏的代码（最多包括 XSS 漏洞）。

> 我正在寻找原则和最佳实践

如果您需要一种可以正则表达式的类似 bbcode 的语言，您需要：

*   减少可以放在其他标签内的可能标签的数量。任意嵌套实际上是不可能支持的
*   对 '<' 使用特殊字符 和'>' HTML 标记分隔符，以将它们与应该在文本中显示的真实尖括号区分开来。我使用 ASCII 控制代码（之前在用户输入阶段过滤了任何控制字符）。
*   将在这些控制字符上处理的字符串拆分为这两个控制字符之间的内容，这样您就永远不会让 bbcode 跨度到达标签内部或标签边界之上。
*   因为你不能让 bbcode 跨度通过标签边界从外向内工作，首先做大块元素，然后向内工作到链接，最后是粗体和斜体。
*   为了理智，一次处理一个块。例如。如果您在双换行符上开始一个新的 <p>，则没有 bbcode 标记可以跨越两个单独的块。

做对还是很困难的。一个合适的解析器更有可能是无懈可击的。

# hibernate - Spring / Hibernate / JUnit - 没有绑定到线程的休眠会话

> ID：734614
> 
> 赞同：19
> 
> 时间：2009-04-09T15:00:10.347
> 
> 标签：hibernate, spring, junit

我正在尝试在测试用例中访问当前的休眠会话，并收到以下错误：

> org.hibernate.HibernateException：没有 Hibernate Session 绑定到线程，并且配置不允许在 org.hibernate.impl 的 org.springframework.orm.hibernate3.SpringSessionContext.currentSession(SpringSessionContext.java:63) 处创建非事务性会话.SessionFactoryImpl.getCurrentSession(SessionFactoryImpl.java:574)

我显然错过了某种设置，但不确定是什么。

任何帮助将不胜感激。这是我对 Hibernate / Spring 等的第一次尝试，学习曲线肯定很陡峭！

代码如下：

违规类：

```
public class DbUnitUtil extends BaseDALTest {
    @Test
    public void exportDtd() throws Exception
    {

        Session session = sessionFactory.getCurrentSession();

        session.beginTransaction();
        Connection hsqldbConnection = session.connection(); 

        IDatabaseConnection connection = new DatabaseConnection(hsqldbConnection);

        // write DTD file
        FlatDtdDataSet.write(connection.createDataSet(), new FileOutputStream("test.dtd"));
    }
} 
```

基类：

```
@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(locations={"classpath:applicationContext.xml"})
public class BaseDALTest extends AbstractJUnit4SpringContextTests {
    public BaseDALTest()
    {
        super();
    }
        @Resource
        protected SessionFactory sessionFactory;
} 
```

应用程序上下文.xml：

```
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">

    <bean id="dataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
        <property name="driverClassName">
            <value>org.hsqldb.jdbcDriver</value>
        </property>
        <property name="url">
            <value>jdbc:hsqldb:mem:sample</value>
        </property>
        <property name="username">
            <value>sa</value>
        </property>
        <property name="password">
            <value></value>
        </property>
    </bean>

    <bean id="sessionFactory" class="com.foo.spring.AutoAnnotationSessionFactoryBean">
        <property name="dataSource" ref="dataSource" />
        <property name="entityPackages">
            <list>
                <value>com.sample.model</value>
            </list>
        </property>
        <property name="schemaUpdate">
            <value>true</value>
        </property>
        <property name="hibernateProperties">
            <props>
                <prop key="hibernate.dialect">org.hibernate.dialect.HSQLDialect
                </prop>
                <prop key="hibernate.show_sql">true</prop>
            </props>
        </property>
    </bean>
</beans> 
```

* * *

## 回答 #1

> 赞同：31
> 
> 时间：2009-07-18T12:07:45.947

错了，那只会用会话管理代码填充您的代码。

首先，在您的上下文中添加一个事务管理 bean：

```
 <bean id="transactionManager" 
          class="org.springframework.orm.hibernate3.HibernateTransactionManager">
        <property name="sessionFactory" ref="sessionFactory"/>
    </bean> 
```

第二件事，扩展 AbstractTransactionalJUnit4SpringContextTests

```
 public class BaseDALTest 
           extends AbstractTransactionalJUnit4SpringContextTests{ 
```

第三件事，用注释你的测试类

```
 @TransactionConfiguration
    @Transactional 
```

如果您的事务分界正确（围绕您的 dao 或服务），您应该完成。

在您的代码周围（甚至在您的测试中）散布会话和事务处理代码并不好。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2010-06-14T21:09:57.693

请参阅 Spring 文档。有一整章是关于测试的，还有一节是关于事务管理的：

[http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/testing.html#testing-tx](http://static.springsource.org/spring/docs/3.0.x/spring-framework-reference/html/testing.html#testing-tx)

我已经成功扩展 AbstractTransactionalJUnit4SpringContextTests，但有一个解决方法：

```
TransactionTemplate transactionTemplate = new TransactionTemplate(transactionManager);
transactionTemplate.execute(new TransactionCallbackWithoutResult() {
    @Override
    protected void doInTransactionWithoutResult(TransactionStatus status) {
        // DAO has access to the session through sessionFactory.getCurrentSession()
        myDao.findSomething(id);
    }
}); 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2010-04-26T16:10:08.627

有了上面的Spring配置，编码应该就够了

```
Session session = sessionFactory.getCurrentSession(); 
```

在您的方法和类中进行测试。会话管理由 Hibernate / Spring /JUnit 测试配置完成，稍后在*实际*应用程序中的 Hibernate / Spring 配置中完成。

这就是它对我的测试的工作方式。在最终的 Web 应用程序中，将自动有一个与当前 Web 请求关联的 Hibernate 会话，因此在测试中不应该`sessionFactory.openSession()`调用。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T15:08:29.047

呃。

> 会话会话 = ~~sessionFactory.openSession();~~

```
Session session = sessionFactory.getCurrentSession(); 
```

哎呀。

（编辑，因为这是错误的，并得到了赞成）。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-06-24T16:05:53.750

Spring 忽略`hibernate.current_session_context_class=thread`属性（**您不使用**）并将 Hibernate 包装`SessionFactory`在它自己的事务版本中，如此[处所述](http://www.theresearchkitchen.com/archives/73)

解决方法是设置属性

```
<property name="exposeTransactionAwareSessionFactory"><value>false</value></property> 
```

在会话工厂 bean 配置中

# powershell - 为什么哈希表键上有尾随空格？

> ID：734616
> 
> 赞同：1
> 
> 时间：2009-04-09T15:00:19.580
> 
> 标签：powershell

我不明白为什么这个脚本中的字符串连接存在差异。我真的不明白空格是从哪里来的？你能告诉我有什么问题吗？

```
$table = @{
"aaa"=1
}

$x = "qqq"
$y = "rrr"

$table.GetEnumerator() | ForEach-Object { 
Write-Host $_.Key$x            #THIS PRINTS "aaa qqq"
}

Write-Host $x$y   #THIS PRINTS : "qqqrrr" 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-12T21:46:48.133

在处理命令的参数时，如果第一个片段是可识别的表达式，PowerShell 解析器会将相邻的表达式拆分为离散的参数，例如 $()。因为 PowerShell 是基于对象的，所以我们尝试保持对象完整性，直到我们必须渲染为字符串。如果您想强制字符串扩展，请按照其他海报之一的建议，在整个参数序列周围加上双引号。请注意，带有前导字符（如 a$x）的参数将被视为双引号字符串“a$x”。这是因为前导字符未被识别为有效表达式，因此我们默认将其视为可扩展字符串。

-布鲁斯

微软公司 Windows PowerShell 团队的 Bruce Payette

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-10T04:56:08.220

它不仅仅发生在哈希表键上。例如看这个：

```
PS > Write-Host $x.Length$y
3 rrr 
```

但`$x.Length$y`不是一个有效的表达式：

```
PS > $x.Length$y
Unexpected token 'y' in expression or statement.
At line:1 char:11
+ $x.Length$y <<<< 
```

所以必须发生的是powershell`$x.Length$y`在将它们传递给Write-Host之前将它们解释为两个单独的表达式，并且由于它们中有两个，Write-Host用分隔符将它们分开。

那么这里发生了什么？：

```
PS > Write-Host $x$y
qqqrrr 
```

`$x$y`也不是有效的表达式：

```
PS > $x$y
Unexpected token 'y' in expression or statement.
At line:1 char:4
+ $x$y <<<< 
```

但是，使用双引号，它是一个有效的字符串：

```
PS > "$x$y"
qqqrrr 
```

Powershell 必须先转换`$x$y`为字符串，然后才能将其作为单个参数传递给 Write-Host。

然而，基本上这只是猜测。这对我来说听起来很合理。简短的回答是，您可以自己将字符串连接在一起以摆脱空间：

```
Write-Host ($_.Key + $x) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-10T15:07:43.833

恕我直言，Powershell 解析器正在使用

```
Write-Host $_.Key$a 
```

并通过拆分“$”将其标记为两个表达式。实际上，向管道发出两个命令：

```
Write-Host $_.Key
$x 
```

我认为这主要是因为您正在访问一个属性并将其扩展为一个变量旁边的字符串，该变量在评估时变成一个字符串。

你应该这样做的方式是：

```
PS C:\Users\jpogran> $table = @{
>> "aaa"=1
>> }
>>
PS C:\Users\jpogran> $x = "qqq"
PS C:\Users\jpogran> $y = "rrr"
PS C:\Users\jpogran> $table

Name                           Value
----                           -----
aaa                            1
PS C:\Users\jpogran> $table.Getenumerator() | %{ Write-host "$($_.key)$x" }
aaaqqq 
```

'$()' 告诉 Powershell 解析器您希望扩展该对象上的该属性，并将值放入字符串中之后/之前的任何内容旁边。

詹姆士

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T15:15:54.333

如果将密钥和 $x 连接起来会发生什么？

$_.Key + $x

Write-Host 似乎有一种语法，您可以在其中输入变量并将它们分开：Write-Host (a,b,c) -separator "_"

也许您使用的是速记？

# c# - 在 .NET 应用程序中禁用辅助功能快捷方式？

> ID：734618
> 
> 赞同：7
> 
> 时间：2009-04-09T15:00:30.563
> 
> 标签：c#, windows, pinvoke, accessibility, shortcuts

这篇 msdn 文章 -- [http://msdn.microsoft.com/en-us/library/bb219746(VS.85).aspx#Disabling_Accessibility_Shortcut_Keys](http://msdn.microsoft.com/en-us/library/bb219746(VS.85).aspx#Disabling_Accessibility_Shortcut_Keys) -- 为 C++ 程序员提供了有关如何临时禁用 Windows 快捷方式以实现可访问性的信息（例如如按住 Shift 8 秒，或快速连续按 Shift 5 次以上）。

在 C# 中肯定有一些简单的方法可以做到这一点，但我找不到任何资源。我在非全屏应用程序中使用 DirectInput。

我想做的就是不要出现烦人的弹出窗口；不过，我更喜欢不必破坏 Windows 设置的东西，以防应用程序以非优雅的方式关闭（我不希望在这些情况下永久更改用户的设置） .

有什么想法吗？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T17:38:23.200

以防万一其他人需要这个，这是转换后的 C# 代码，它终于可以工作了：

```
 [DllImport( "user32.dll", EntryPoint = "SystemParametersInfo", SetLastError = false )]
    private static extern bool SystemParametersInfo( uint action, uint param,
        ref SKEY vparam, uint init );

    [DllImport( "user32.dll", EntryPoint = "SystemParametersInfo", SetLastError = false )]
    private static extern bool SystemParametersInfo( uint action, uint param,
        ref FILTERKEY vparam, uint init );

    private const uint SPI_GETFILTERKEYS = 0x0032;
    private const uint SPI_SETFILTERKEYS = 0x0033;
    private const uint SPI_GETTOGGLEKEYS = 0x0034;
    private const uint SPI_SETTOGGLEKEYS = 0x0035;
    private const uint SPI_GETSTICKYKEYS = 0x003A;
    private const uint SPI_SETSTICKYKEYS = 0x003B;

    private static bool StartupAccessibilitySet = false;
    private static SKEY StartupStickyKeys;
    private static SKEY StartupToggleKeys;
    private static FILTERKEY StartupFilterKeys;

    private const uint SKF_STICKYKEYSON = 0x00000001;
    private const uint TKF_TOGGLEKEYSON = 0x00000001;
    private const uint SKF_CONFIRMHOTKEY = 0x00000008;
    private const uint SKF_HOTKEYACTIVE = 0x00000004;
    private const uint TKF_CONFIRMHOTKEY = 0x00000008;
    private const uint TKF_HOTKEYACTIVE = 0x00000004;
    private const uint FKF_CONFIRMHOTKEY = 0x00000008;
    private const uint FKF_HOTKEYACTIVE = 0x00000004;

    [StructLayout( LayoutKind.Sequential, CharSet = CharSet.Auto )]
    public struct SKEY
    {
        public uint cbSize;
        public uint dwFlags;
    }

    [StructLayout( LayoutKind.Sequential, CharSet = CharSet.Auto )]
    public struct FILTERKEY
    {
        public uint cbSize;
        public uint dwFlags;
        public uint iWaitMSec;
        public uint iDelayMSec;
        public uint iRepeatMSec;
        public uint iBounceMSec;
    }

    private static uint SKEYSize = sizeof( uint ) * 2;
    private static uint FKEYSize = sizeof( uint ) * 6;

    public static void ToggleAccessibilityShortcutKeys( bool ReturnToStarting )
    {
        if ( !StartupAccessibilitySet )
        {
            StartupStickyKeys.cbSize = Configuration.SKEYSize;
            StartupToggleKeys.cbSize = Configuration.SKEYSize;
            StartupFilterKeys.cbSize = Configuration.FKEYSize;
            SystemParametersInfo( SPI_GETSTICKYKEYS, SKEYSize, ref StartupStickyKeys, 0 );
            SystemParametersInfo( SPI_GETTOGGLEKEYS, SKEYSize, ref StartupToggleKeys, 0 );
            SystemParametersInfo( SPI_GETFILTERKEYS, FKEYSize, ref StartupFilterKeys, 0 );
            StartupAccessibilitySet = true;
        }

        if ( ReturnToStarting )
        {
            // Restore StickyKeys/etc to original state and enable Windows key
            SystemParametersInfo( SPI_SETSTICKYKEYS, SKEYSize, ref StartupStickyKeys, 0 );
            SystemParametersInfo( SPI_SETTOGGLEKEYS, SKEYSize, ref StartupToggleKeys, 0 );
            SystemParametersInfo( SPI_SETFILTERKEYS, FKEYSize, ref StartupFilterKeys, 0 );
        }
        else
        {
            // Disable StickyKeys/etc shortcuts but if the accessibility feature is on, 
            // then leave the settings alone as its probably being usefully used
            SKEY skOff = StartupStickyKeys;
            //if ( ( skOff & SKF_STICKYKEYSON ) == 0 )
            {
                // Disable the hotkey and the confirmation
                skOff.dwFlags &= ~SKF_HOTKEYACTIVE;
                skOff.dwFlags &= ~SKF_CONFIRMHOTKEY;

                SystemParametersInfo( SPI_SETSTICKYKEYS, SKEYSize, ref skOff, 0 );
            }
            SKEY tkOff = StartupToggleKeys;
            //if ( ( tkOff & TKF_TOGGLEKEYSON ) == 0 )
            {
                // Disable the hotkey and the confirmation
                tkOff.dwFlags &= ~TKF_HOTKEYACTIVE;
                tkOff.dwFlags &= ~TKF_CONFIRMHOTKEY;

                rs = SystemParametersInfo( SPI_SETTOGGLEKEYS, SKEYSize, ref tkOff, 0 );
            }

            FILTERKEY fkOff = StartupFilterKeys;
            //if ( ( fkOff & FKF_FILTERKEYSON ) == 0 )
            {
                // Disable the hotkey and the confirmation
                fkOff.dwFlags &= ~FKF_HOTKEYACTIVE;
                fkOff.dwFlags &= ~FKF_CONFIRMHOTKEY;

                SystemParametersInfo( SPI_SETFILTERKEYS, FKEYSize, ref fkOff, 0 );
            }
        }
    } 
```

Do note that I was unable to convert three of the IF statements from C++ (those are commented out). Microsoft recommends those, but I don't know a way to make them work in C#. Additionally, I'm not using sizeof() on the structs (instead manually creating variables for their size), because to do that would require unsafe code, and I don't want that to be a requirement for my particular program.

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2012-07-01T16:08:29.417

Thanks guys with some minor finishing off that worked in my XNA game to prevent the sticky key popup.

Here is the finished code:

```
using System;
using System.Diagnostics;
using System.Collections.Generic;
using Microsoft.Xna.Framework;
using System.Runtime.InteropServices; 

namespace Engine
{
#if WINDOWS
    /// <summary>
    /// Helper for Windows to temporarily disable the popup caused by the 
    /// Accessibility features.
    /// See: http://stackoverflow.com/questions/734618/disabling-accessibility-shortcuts-in-net-application
    /// and: http://msdn.microsoft.com/en-us/library/ee416808(v=vs.85).aspx
    /// </summary>
    public class WindowsHelperAccessibilityKeys
    {
        [DllImport("user32.dll", EntryPoint = "SystemParametersInfo", SetLastError = false)]
        private static extern bool SystemParametersInfo(uint action, uint param,
            ref SKEY vparam, uint init);

        [DllImport("user32.dll", EntryPoint = "SystemParametersInfo", SetLastError = false)]
        private static extern bool SystemParametersInfo(uint action, uint param,
            ref FILTERKEY vparam, uint init);

        private const uint SPI_GETFILTERKEYS = 0x0032;
        private const uint SPI_SETFILTERKEYS = 0x0033;
        private const uint SPI_GETTOGGLEKEYS = 0x0034;
        private const uint SPI_SETTOGGLEKEYS = 0x0035;
        private const uint SPI_GETSTICKYKEYS = 0x003A;
        private const uint SPI_SETSTICKYKEYS = 0x003B;

        private static bool StartupAccessibilitySet = false;
        private static SKEY StartupStickyKeys;
        private static SKEY StartupToggleKeys;
        private static FILTERKEY StartupFilterKeys;

        private const uint SKF_STICKYKEYSON = 0x00000001;
        private const uint TKF_TOGGLEKEYSON = 0x00000001;
        private const uint SKF_CONFIRMHOTKEY = 0x00000008;
        private const uint SKF_HOTKEYACTIVE = 0x00000004;
        private const uint TKF_CONFIRMHOTKEY = 0x00000008;
        private const uint TKF_HOTKEYACTIVE = 0x00000004;
        private const uint FKF_CONFIRMHOTKEY = 0x00000008;
        private const uint FKF_HOTKEYACTIVE = 0x00000004;
        private const uint FKF_FILTERKEYSON = 0x00000001;

        [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)]
        public struct SKEY
        {
            public uint cbSize;
            public uint dwFlags;
        }

        [StructLayout(LayoutKind.Sequential, CharSet = CharSet.Auto)]
        public struct FILTERKEY
        {
            public uint cbSize;
            public uint dwFlags;
            public uint iWaitMSec;
            public uint iDelayMSec;
            public uint iRepeatMSec;
            public uint iBounceMSec;
        }

        private static uint SKEYSize = sizeof(uint) * 2;
        private static uint FKEYSize = sizeof(uint) * 6;
        /// <summary>
        /// False to stop the sticky keys popup.
        /// True to return to whatever the system has been set to.
        /// </summary>
        public static void AllowAccessibilityShortcutKeys(bool bAllowKeys)
        {
            if (!StartupAccessibilitySet)
            {
                StartupStickyKeys.cbSize = SKEYSize;
                StartupToggleKeys.cbSize = SKEYSize;
                StartupFilterKeys.cbSize = FKEYSize;
                SystemParametersInfo(SPI_GETSTICKYKEYS, SKEYSize, ref StartupStickyKeys, 0);
                SystemParametersInfo(SPI_GETTOGGLEKEYS, SKEYSize, ref StartupToggleKeys, 0);
                SystemParametersInfo(SPI_GETFILTERKEYS, FKEYSize, ref StartupFilterKeys, 0);
                StartupAccessibilitySet = true;
            }

            if (bAllowKeys)
            {
                // Restore StickyKeys/etc to original state and enable Windows key 
                SystemParametersInfo(SPI_SETSTICKYKEYS, SKEYSize, ref StartupStickyKeys, 0);
                SystemParametersInfo(SPI_SETTOGGLEKEYS, SKEYSize, ref StartupToggleKeys, 0);
                SystemParametersInfo(SPI_SETFILTERKEYS, FKEYSize, ref StartupFilterKeys, 0);
            }
            else
            {
                // Disable StickyKeys/etc shortcuts but if the accessibility feature is on,  
                // then leave the settings alone as its probably being usefully used 
                SKEY skOff = StartupStickyKeys;
                if ( ( skOff.dwFlags & SKF_STICKYKEYSON ) == 0 ) 
                {
                    // Disable the hotkey and the confirmation 
                    skOff.dwFlags &= ~SKF_HOTKEYACTIVE;
                    skOff.dwFlags &= ~SKF_CONFIRMHOTKEY;
                    SystemParametersInfo(SPI_SETSTICKYKEYS, SKEYSize, ref skOff, 0);
                }
                SKEY tkOff = StartupToggleKeys;
                if ( ( tkOff.dwFlags & TKF_TOGGLEKEYSON ) == 0 ) 
                {
                    // Disable the hotkey and the confirmation 
                    tkOff.dwFlags &= ~TKF_HOTKEYACTIVE;
                    tkOff.dwFlags &= ~TKF_CONFIRMHOTKEY;
                    SystemParametersInfo(SPI_SETTOGGLEKEYS, SKEYSize, ref tkOff, 0);
                }

                FILTERKEY fkOff = StartupFilterKeys;
                if ( ( fkOff.dwFlags & FKF_FILTERKEYSON ) == 0 ) 
                {
                    // Disable the hotkey and the confirmation 
                    fkOff.dwFlags &= ~FKF_HOTKEYACTIVE;
                    fkOff.dwFlags &= ~FKF_CONFIRMHOTKEY;
                    SystemParametersInfo(SPI_SETFILTERKEYS, FKEYSize, ref fkOff, 0);
                }
            }
        } 

    }
#endif
} 
```

I use it at the start of the game with the parameter set to false and just before the game exits with the parameter set to true:

```
 /// <summary>
    /// This is the preferred way to return to the operating system.
    /// </summary>
    public void ExitAndTidyUP()
    {
#if WINDOWS
        WindowsHelperAccessibilityKeys.AllowAccessibilityShortcutKeys(true);
#endif
        Exit();
    } 
```

It works perfectly as far as I can tell.

Regards

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T15:06:04.090

您必须执行与您引用的链接中相同的操作。SystemParametersInfo API 函数可以通过 P/Invoke 层调用，您可以在此处找到定义：

[http://www.pinvoke.net/default.aspx/user32/SystemParametersInfo.html](http://www.pinvoke.net/default.aspx/user32/SystemParametersInfo.html)

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2011-08-04T06:03:10.960

Note in relation to the C# code posted above: You can convert those problem lines by AND-ing with the flags field of the struct like so: if ((skOff.dwFlags & SKF_STICKYKEYSON) == 0) You'll need to add the line: private const uint FKF_FILTERKEYSON = 0x00000001; under the const definitions as well.

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-10-03T16:22:43.817

You may look this also C#

```
using System;
using System.Windows.Forms;
using System.Runtime.InteropServices;

namespace WindowsFormsApplication1 {
  public partial class Form1 : Form {
    private const int MYKEYID = 0;    // In case you want to register more than one...
    public Form1() {
      InitializeComponent();
      RegisterHotKey(this.Handle, MYKEYID, MOD_ALT, Keys.Tab);
      this.FormClosing += Form1_FormClosing;
    }
    private void Form1_FormClosing(object sender, FormClosingEventArgs e) {
      UnregisterHotKey(this.Handle, MYKEYID);
    }
    protected override void WndProc(ref Message m) {
      if (m.Msg == WM_HOTKEY && m.WParam.ToInt32() == MYKEYID) {
        Console.Beep();
      }
      base.WndProc(ref m);
    }
    // P/Invoke declarations
    private const int WM_HOTKEY = 0x312;
    private const int MOD_ALT = 1;
    private const int MOD_CONTROL = 2;
    private const int MOD_SHIFT = 4;
    [DllImport("user32.dll")]
    private static extern int RegisterHotKey(IntPtr hWnd, int id, int modifier, Keys vk);
    [DllImport("user32.dll")]
    private static extern bool UnregisterHotKey(IntPtr hWnd, int id);
  }
} 
```

found it here [http://social.msdn.microsoft.com/Forums/en-US/csharplanguage/thread/47647b7e-b23f-4f80-9363-ffd5f11a2570](http://social.msdn.microsoft.com/Forums/en-US/csharplanguage/thread/47647b7e-b23f-4f80-9363-ffd5f11a2570)

cheers

# java - 为可执行 Jar 提供自定义图像

> ID：734622
> 
> 赞同：2
> 
> 时间：2009-04-09T15:01:23.183
> 
> 标签：java, jar, executable-jar

刚刚完成了一个我想分发的小应用程序，目前对于 Windows 平台它只是一个可执行的 jar。反正有没有给这个罐子比java杯另一个图像？

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T15:11:04.220

我认为您指的是 jar 文件在 Windows 资源管理器中的显示方式？如果是这样，它可能是操作系统设置（需要逐台干预）。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T15:09:58.543

如果您在使用的任何文件管理器中谈论图像，那么它是您的操作系统提供的。如果您在谈论应用程序窗口中的图标，您可以使用 Window.setIconImage 更改它

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T17:08:20.043

您可以创建 JAR 文件的快捷方式，然后可以更改快捷方式的图标。

# asp.net - PasswordRecovery asp.net 控件

> ID：734626
> 
> 赞同：1
> 
> 时间：2009-04-09T15:02:18.157
> 
> 标签：asp.net, user-controls, asp.net-2.0

我正在尝试访问作为 asp.net 2.0 中 PasswordRecovery 控件的一部分的提交按钮。据我所知，API 不允许这样做。

有没有人知道如何在单击此按钮时添加 Javascript 确认弹出窗口。

我试图将 onclick 添加到 SendingMail 事件中 PasswordRecovery 控件的属性，如下所示，但没有运气。

```
 protected void PasswordRecovery1_SendingMail(object sender, MailMessageEventArgs e)
    {
        //storing audit information
        PasswordRecovery myPasswordRecovery = new PasswordRecovery();
        myPasswordRecovery = (PasswordRecovery)sender;
        myPasswordRecovery.SubmitButton.Attributes.Add("onclick", "return confirm('" + confirmationMessage + "');"); 
```

}

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T21:15:13.443

我会尝试模板化控件并替换提交按钮。

```
<asp:Button ID="SubmitButton" runat="server" CommandName="Submit" Text="Submit" ValidationGroup="PasswordRecovery1" OnClientClick="return confirm('You sure you want to recover?');" /> 
```

[如何：自定义密码恢复控件](http://msdn.microsoft.com/en-us/library/ms178341.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T15:08:11.327

您是否在尝试访问按钮时指定模板，例如：

```
passwordRecovery.UserNameTemplateContainer.FindControl("submitButton") 
```

# ruby - 是否有任何模块或内置函数可以在 Ruby 中进行错误报告？

> ID：734627
> 
> 赞同：0
> 
> 时间：2009-04-09T15:02:27.737
> 
> 标签：ruby, error-reporting

只是想知道是否有任何内置的方法来处理 Ruby 中的错误报告？PHP 自己做，Perl 和 Python 你可以导入模块来使用。

列维

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-21T21:29:16.617

试试 ruby​​ 调试： [http ://www.datanoise.com/articles/2006/7/12/tutorial-on-ruby-debug](http://www.datanoise.com/articles/2006/7/12/tutorial-on-ruby-debug)

# c# - 是什么导致 System.Drawing.Printing.PrinterSettings.InstalledPrinters 抛出 Win32Exception“RPC 服务器不可用”？

> ID：734628
> 
> 赞同：8
> 
> 时间：2009-04-09T15:02:29.280
> 
> 标签：c#, .net, printing

我有一个正在开发的应用程序，我允许用户在从应用程序打印表单时选择一台打印机作为他们的打印机。我正在使用 .NET 2.0

在设置屏幕中，我调用

```
System.Drawing.Printing.PrinterSettings.InstalledPrinters 
```

获取可用打印机的列表。

在客户端的机器上，该属性会引发异常：

```
System.ComponentModel.Win32Exception: The RPC server is unavailable 
```

客户端报告 Windows 将他的打印机显示为“就绪”，并且客户端可以从打印机打印测试页。但是，我无法在本地重现这个问题，而且我的想法已经不多了。有没有人有任何想法可能导致这个问题？任何想法或方向都会有所帮助。谢谢

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2011-07-08T22:51:25.650

我在 Windows 7 中也发生了同样的事情。停止和启动**服务**中的打印假脱机程序会修复，直到它再次发生。

以下命令可以快速执行此操作：

```
net stop "print spooler"
net start "print spooler" 
```

注意：以管理员身份运行命令提示符。我制作了一个批处理文件来执行此操作，因为它在开发过程中每天发生 4-5 次。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T15:29:50.310

如果可以打印，很可能是安全问题。否则我会投票给“dead spooler service”，但您的应用程序更有可能无权与 spooler 服务进行通信......

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T15:25:32.350

RPC 服务已关闭或 Windows 防火墙正在阻止它。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-09-28T18:28:23.847

我在使用 PrinterSettings.InstalledPrinters 时遇到了类似的问题，原因是应用程序以“部分信任”权限运行。

在 Visual Studio 中，转到 Project Properties\Security 并选择“这是一个完全信任的应用程序”。

我不确定这是否会帮助你，但它是为我做的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-10-23T04:49:09.890

另一种可能是 PrintSpooler 服务已设置为已禁用

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T15:16:10.197

这可能与网络打印机有关吗？RPC 是远程过程调用，也许这是用于检测已安装的网络打印机？

在对错误进行一些谷歌搜索后：

InstalledPrinters 使用 WMI 来查找打印机。WMI 反过来使用 RPC。

让 WMI 返回您的错误可能意味着以下情况：

*   [MSDN 支持](http://support.microsoft.com/kb/884564)
*   它可能与帐户有关：检查您的应用程序的本地/网络/系统帐户并尝试在注册帐户（用户+密码）下运行您的应用程序
*   另请查看论坛帖子，为 ASP.NET 应用程序解决此问题：[链接](http://social.microsoft.com/Forums/en-US/vscrystalreports/thread/8716ee12-20c7-4042-a2f2-90c00cacd32d)

以及一个有用的[WMI 资源](http://www.microsoft.com/technet/scriptcenter/resources/wmifaq.mspx)来解决您的问题。

# content-management-system - 用于 CMS 的 SCM

> ID：734629
> 
> 赞同：2
> 
> 时间：2009-04-09T15:02:35.847
> 
> 标签：content-management-system, joomla, version-control

我无法涵盖在 CMS（特别是 Joomla！）上进行软件配置管理的所有问题。当然，我正在编写自定义模板，还有自定义模块和组件。这些网站和应用程序是针对客户的，而不是内部的。

我想对站点的配置进行实际版本化，而不仅仅是其模板和组件的代码，因为我希望它能够尽快进行修复或转移给其他人。现在，这意味着存储一个完整的 Joomla！为 SVN 中的每个站点安装，包括已安装的组件和模板版本，以及存储实际的数据库导出。对于组件，我还保留了代码的“打包”版本（见下文）。我通常不会为模板而烦恼，因为您可以将其放入 Joomla！安装，它的工作原理。

我目前正在讨论的这种设置的问题在于自定义组件开发。在 Joomla！（和大多数其他 CMS）扩展通常使用 Web 安装程序部署 - 您不能（至少在最初）只是将文件放在某个文件夹中，因为需要更改数据库。Joomla！安装程序系统通过安装和卸载钩子提供数据库和文件迁移，因此它是一个非常合理的部署系统。

现在，我要么：1）直接在已安装的组件上工作，添加和更改文件，然后手动将它们复制到组件的打包版本中，或者 2）在打包的组件上工作并使用安装程序实际查看结果。这个选项通常花费的时间太长，但它确实具有保持代码“可发布”的优势，尤其是在数据库迁移方面。

在任何一种情况下，在签入之前，更改都会复制到文件的两个版本中，并且复制对我来说似乎是一种气味。

那么，还有其他人这样做吗？有更好的选择吗？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T15:46:13.487

“1/”应该是“一种”要走的路

当你有“包装”这个词时，这意味着你不是版本一个，而是两个“组件”（文件集）

*   一个“开发”组件：非常大，包含您需要的每个文件
*   一个“分发”组件：非常小，其中包含一些压缩文件。

它涉及：

*   一种自动构建和版本化分发组件的方法（通过压缩这些文件并存储它们）
*   一种自动复制该分发组件（代表您的打包版本的压缩版本）、解压缩它并使用测试或生产平台进行 rsynch-it 的方法。

这样，您就不会简单地“复制”更改，而是跟踪实际的完整配置：

*   准备部署在另一个平台上
*   或用于 rsynch 当前部署的包。

# iphone - 级联模态视图

> ID：734633
> 
> 赞同：0
> 
> 时间：2009-04-09T15:03:28.247
> 
> 标签：iphone

我正在尝试做的事情：

1.  显示一个模态视图，我可以在其中获得一些用户输入
2.  显示另一个并获得更多输入
3.  用 1\. 和 2 的输入做一些事情。

问题是： presentModalViewController:animated: 是*非阻塞*的。这意味着我不能只执行步骤 1.-3。依次。

我如何尝试解决它：

ViewController0 构建 ViewController1 并给他一个自身的引用，然后做 presentModalViewController:animated:。ViewController1 将收集用户输入，然后在 ViewController0 上调用一个方法（它有引用）。该方法将构建 ViewController2 并执行与第一个相同的操作。ViewController2 还将调用 ViewController0 上的方法（甚至可能是同一个）。现在 ViewController0 拥有所有数据（或应该），可以继续执行第 3 步。

这种方法的问题：

1.  它看起来像一个可怕的黑客（必须*有*更好的方法来做到这一点）。
2.  它*不起作用*。:-) 问题出在 ViewController0 尝试显示 ViewController2 时。那个甚至不会显示。我的假设（我是 iPhone 编程的新手，但我之前做过一些 Windows 编程）是这个操作不会立即完成，而是发布在某个地方以进行进一步处理（类似于 WIN32 消息队列），因此它会以某种方式与删除ViewController1的操作！

那么，知道如何以更简单的方式解决这个问题或让它以这种方式工作吗？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T04:55:44.460

您是否尝试`self presentModalViewController:ViewController2]`过从 ViewController1 调用 [？

我问是因为我知道这种方法有效，从 VC0 启动了一个模态视图控制器：

```
[self.navigationController presentModalViewController:VC1] 
```

然后在 VC1 中按照我上面描述的方式进行操作。第二个模态视图以覆盖的形式出现，当您关闭时返回 VC1。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-13T10:35:59.033

我在这里找到了解决这个问题的方法：[http](http://forums.macrumors.com/showthread.php?t=513131) ://forums.macrumors.com/showthread.php?t=513131（lawicko 的回答）。

无论如何感谢您的回复。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T16:45:40.613

您可能希望使其成为一个模式视图控制器，而不是包含 2 个子控制器。主模态视图控制器可以是一个`UINavigationController`，以便将第二个子控制器推送到导航堆栈，或者您可以将其设为普通视图控制器并以编程方式交换子控制器的视图。

您尝试执行此操作的方式应该可行，但可能会感觉有些笨拙。确保在呈现第二个模态视图控制器之前关闭第一个模态视图控制器。

# serialization - 支持序列化协程的语言

> ID：734638
> 
> 赞同：7
> 
> 时间：2009-04-09T15:04:47.807
> 
> 标签：serialization, programming-languages, dsl, coroutine

我认为当前语言中不存在这种支持。我认为我想做的事情可以通过“工作流引擎”来解决。但是我对工作流程的问题通常是：

1.  声明式/冗长，我发现命令式风格更简洁
2.  重量级，我会有很多简单但多样的小状态机

我已经研究[了 C# 中的序列化迭代器，](https://stackoverflow.com/questions/321827/serializing-anonymous-delegates-in-c)但这并没有让我得到我想要的确切位置。我目前正在考虑在[Boo](http://boo.codehaus.org/)中组合一个 DSL，但不确定我是否能够在 Boo 中获得类似协程的行为，并且也能够对其进行序列化。

## 例子

这是我想做的有限的虚构示例。主要问题是，在例程中的任何时候，您都可能需要获取用户输入。输入之间的时间可能很长，因此需要将服务状态序列化到磁盘。

```
 def RunMachine(user)
      var lever = user.ChooseLever()
      lever.Pull()
      var device = CreateDevice(user)
      machine.Add(device)
      machine.Run()

   def CreateDevice(user)
      var color = user.ChooseColor()
      var shape = user.ChooseShape()
      return Device(color, shape) 
```

# 更新

我在 CPython 中有一个工作的“引擎”。它搭载了 python 中的迭代器/产量支持。所以代码看起来像这样：

```
def escape(self, you):        
    roll = yield self.game.rollDice(you)
    if roll < 5:
        self.caughtAction(you) 
```

哪里`rollDice`可以打断。通过一些用户操作。**然而， CPython**不会序列化迭代器。

由于游戏的整个状态可以定义为一系列命令，因此我将游戏状态序列化到协程开始的位置，然后是剩余的命令列表。所以保存/恢复看起来像这样：

```
def dumpGameState(game):
    if gameState.partialState:
        return pickle.dumps({ 'partialState': game.partialState, 'partialInputs': game.partialInputs })

    return pickle.dumps(game)

def loadGameState(data):
    state = pickle.loads(data)

    if state.__class__ is Game:
        return state

    r = pickle.loads(state['partialState'])

    for input in state['partialInputs']:
        game.execute(**input)   
    return game 
```

## 目前的调查

我仍然觉得这不令人满意。因为我最终不得不在几乎每种方法上都使用“yield”。我宁愿不必专门装饰一个方法。它在序列化方面也很失败。

目前我正在研究走函数式路线，因为函数式语言似乎对元编程/DSL 创建有更好的支持。目前在看

*   [F# 计算表达式](http://en.wikibooks.org/wiki/F_Sharp_Programming/Computation_Expressions#Defining_Computation_Expressions)
*   哈斯克尔

我希望通过足够强大的元编程设施，我可以自动化状态存储机制。另外，如果我走 F# 路线，我很确定我可以依靠我用来序列化迭代器的[“技术”/（hack） 。](https://stackoverflow.com/questions/321827/serializing-anonymous-delegates-in-c)

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T18:25:44.833

有趣的是你今天应该问这个，然后我读到了[Mono 中的 Continuations](http://tirania.org/blog/archive/2009/Apr-09.html)。看起来像你所追求的那种东西。特别是[在 Second Life 中有对 Microthreading](http://secondlife.blogs.com/babbage/2006/05/microthreading_.html)的引用，包括以下描述：

> SecondLife 要求代码在任何时间点暂停，并且其整个状态可以序列化为适合存储到数据库中的格式。然后可以在不同的时间点或在不同的计算机上恢复序列化状态（例如，在从一个节点移动到另一个节点时）。

除非我误解了你，否则这可能是一个很好的探索途径。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2010-03-01T19:15:00.240

我发现对序列化[协程](http://lua-users.org/wiki/CoroutinesTutorial)的最佳支持似乎是通过[Pluto](http://lua-users.org/wiki/PlutoLibrary)库在 Lua 中。

我试用[Mono 2.6](http://www.mono-project.com/Continuations)，但无法让协程工作。然后我用 Python/IronPython 试验了一段时间，但缺乏序列化支持。

现在使用 Lua，我必须[通过 P/Invoke 从 .NET 连接到 Lua](http://ttuxen.wordpress.com/2009/11/03/embedding-lua-in-dotnet/)，这被证明是在 Linux 和 Windows 上工作的挑战，但最终如果我正在寻找一种脚本语言来支持游戏，可能最好使用已经普遍选择的东西。

**更新**

我最终暂时放弃了 Lua。我在集成问题上陷入了困境。我又回到了 Python。我正在为我的协程使用[python yield 表达式](http://docs.python.org/release/2.7/reference/expressions.html#yield-expressions)，并解决[pickle 不支持 generators](http://docs.python.org/library/pickle.html#what-can-be-pickled-and-unpickled)的问题。

就我而言，程序状态并不总是有活动的协程，这意味着有时我可以腌制状态。否则，我会存储最后一个泡菜状态，以及此后操作的“重播历史”。然后恢复状态只是取消最后一个状态，并重放任何动作。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T15:38:15.207

您在寻找[续](http://en.wikipedia.org/wiki/Continuation)作吗？

> 在任何支持闭包的语言中，都可以以连续传递风格编写程序并手动实现 call/cc。

`call/cc`是`call-with-current-continuation`.

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T15:10:37.497

您可能想看看 Windows 工作流：

[http://msdn.microsoft.com/en-us/netframework/aa663328.aspx](http://msdn.microsoft.com/en-us/netframework/aa663328.aspx)

它旨在以这样的方式使用，如果工作流处于不活动状态，则能够保持工作流，以及重新启动它的能力。

虽然从技术上讲它不是语言支持，但它应该可以完成工作。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2011-09-04T12:51:07.583

最新版本的 Java 包括 Rhino，一个支持可序列化延续的 javascript 解释器。还有 Pluto+Lua，我现在正在研究。

我想听听您最终选择的路径，因为可序列化的延续对[http://weaverengine.com](http://weaverengine.com)项目很重要。

# sql-server - 关于将包部署到生产服务器的问题

> ID：734646
> 
> 赞同：1
> 
> 时间：2009-04-09T15:07:01.920
> 
> 标签：sql-server, ssis

我有 etl 任务，它将从 Mysql 数据库中提取数据并加载到 sqlserver 中。我创建了 ssis 包来在我的本地机器上执行这项工作。在源代码中，我使用 ADO.net 和 mysql 驱动程序。一切正常。但是当我将包文件 dtsx 文件移动到作为 64 位 Windows 2008 框的服务器并执行它时，我得到了 sqlserver.dts.runtime.dtscouldnotcreatemanagedconnectionexception。但是如果我将整个项目移过来，并在服务器上使用 BIDS 打开项目，我看到在 mysql 的连接管理器中我丢失了 mysql 驱动程序设置，它默认为 sqlserver 驱动程序。我必须将其重置为服务器上的正确驱动程序才能运行。我也尝试过使用配置文件，它也不起作用。谢谢

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-05-22T14:18:14.517

你的包必须是mysql吗？

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-08-10T01:00:04.870

BIDS 环境是 32 位的，在设置软件包时将使用 32 位驱动程序。在 64 位机器上运行它时，它默认为 64 位驱动程序。听起来您没有在服务器上安装 64 位驱动程序。您可以安装 64 位驱动程序，或使用位于“C:\Program Files (x86)\Microsoft SQL Server\100\DTS\Binn”的 32 位版本的 DTEXEC 运行包。

# .htaccess - Mod_rewrite 不适用于以 %（百分号）开头的 url

> ID：734654
> 
> 赞同：2
> 
> 时间：2009-04-09T15:08:59.653
> 
> 标签：.htaccess, mod-rewrite, symbols, pagerank

有几个链接指向我管理的网站，其中网站管理员错误地在域名和页面名称之间**包含了一个空格：**

```
    www.domain.com/page.html

```

当用户点击时，这给出

```
    www.domain.com/%20page.html

```

我想使用 mod_rewrite 将命中重定向到不正确的地址到正确的地址，但是**我的重写规则不起作用**。我尝试了以下方法但没有成功：

```
    重写 ^\%20page.html$ /page.html [R=301,L]
    rewriterule ^.20page.html$ /page.html [R=301,L]

```

**如何编写规则来捕获此地址？**我想保留 PageRank 并且不会因链接损坏而受到处罚，而且我无法让网站管理员修复他的链接。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T15:14:26.740

使用文字空间，用反斜杠转义，这样它就不会结束正则表达式：

```
RewriteRule ^\ page.html$ /page.html [R=301,L] 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T15:12:42.563

将空格放在您的 RewriteRule 中。可能在 mod_rewrite 看到它的时候，它已经被解码了。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-15T15:03:00.607

您可以使用类似这样的方法来删除所有控制字符：

```
RewriteRule ^([^\x00-\x19\x7F]*)[\x00-\x19\x7F]+(.*) /$1$2 [L,R=301] 
```

对于您的额外空格字符：

```
RewriteRule ^([^\x00-\x20\x7F]*)[\x00-\x20\x7F]+(.*) /$1$2 [L,R=301] 
```

# jquery - jQuery 加/减或展开/折叠列表

> ID：734657
> 
> 赞同：2
> 
> 时间：2009-04-09T15:09:25.660
> 
> 标签：jquery, hide, show

任何人都想通过加号/减号图标在列表中显示/隐藏元素来模仿 BBC 在其主页盒装内容上所做的事情。[http://www.bbc.co.uk/](http://www.bbc.co.uk/)

我试过这样做，但到目前为止效果并不完全正确。

或者，是否有插件或其他东西可以让你做类似的事情？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-17T11:10:31.643

感谢您的回复。我确实尝试过这个，但对于我正在做的事情来说似乎有点矫枉过正。另外，我想在网站的不同部分执行几次代码。

最后，我找到了一个名为 Collapsorz 的插件，[https:](https://github.com/akuzemchak/collapsorz) //github.com/akuzemchak/collapsorz正是我想要的。

还是要谢谢你的帮助。非常感激。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T15:54:48.770

这只是隐藏和删除元素的问题：

```
<a href="javascript:void(0)" click="$('#somelist li:visible:last').hide()">+</a>
<a href="javascript:void(0)" click="$('#somelist li:hidden:first').show()">-</a> 
```

当然，您需要将其与在页面加载时为每个项目输出正确 CSS 的东西联系起来。（这样您就可以跟踪要显示的项目数量。

你甚至可以在这个页面上试试这个：

```
$('.nav li:visible:last').hide() 
```

如果您使用的是 firebug，只需运行它，您就会看到导航栏发生变化：顶部的“按钮”会消失，每次运行时都会一个一个消失。

您可能可以处理这部分，但无论如何都在这里。

```
<style>
  .hideme {
    display:none;
  }
</style>
<?php
$num_of_items = 5;
$items = array('one', 'two', 'three', 'four', 'five', 'six', 'seven');
echo "<ul id='somelist'>";
for($i=0;$i<sizeof($items);$i++) {
  echo "<li".(($i<$num_of_items)?"":" class='hideme'").">".$items[$i]."</li>";
}
echo "</ul>";
?> 
```

# ruby-on-rails - 带有 Memcache 的 Rails 返回错误的缓存对象？

> ID：734664
> 
> 赞同：7
> 
> 时间：2009-04-09T15:11:04.343
> 
> 标签：ruby-on-rails, ruby, caching, memcached

我有一个相当大的 Rails 应用程序，它在单独的服务器上使用 memcached 作为其缓存存储。

问题是我在生产环境中随机出现错误，这*似乎*表明 memcached 返回了不正确的对象。

例子：

在这个例子中，`current_site`是一个辅助方法，它访问`Site`模型上的一个方法，该方法使用 Rails.cache 来缓存模型

```
ActionView::TemplateError in ListingsController#edit
undefined method `settings' for #<String:0xb565f8a0>

On line #12 of app/views/layouts/site.html.erb

    9:         <meta name="robots" content="noodp, all" />
    10:         <meta name="distribution" content="Global" />
    11: 
    12:         <% unless current_site.settings[:google_webmaster_verification_code].blank? %>
    13:         <meta name="verify-v1" content="<%= current_site.settings[:google_webmaster_verification_code] %>" />
    14:         <% end %>
    15: 
```

与……形成对比

```
ActionView::TemplateError in ApplicationController#not_found
undefined method `settings' for #<Category:0xd5c6c34>

On line #12 of app/views/layouts/site.html.erb

    9:         <meta name="robots" content="noodp, all" />
    10:         <meta name="distribution" content="Global" />
    11: 
    12:         <% unless current_site.settings[:google_webmaster_verification_code].blank? %>
    13:         <meta name="verify-v1" content="<%= current_site.settings[:google_webmaster_verification_code] %>" />
    14:         <% end %>
    15: 
```

当两者都应该返回`Site`模型时！

缓存行为异常的另一个示例：

```
ActionView::TemplateError in AccountsController#show
can't convert Category into String

On line #141 of app/views/layouts/site.html.erb

    138:                    <li<%=  class="first" if i == 0 %>><%= link_to top_level_category.title, top_level_category.path %></li><% end %>
    139:                </ul>
    140:            <% end %>
    141:            <% cache bottom_pages do %>
    142:                <ul><% Page.top_level.active.show_in_navigation.find(:all, :include => :slugs).each_with_index do |top_level_page, i| %>
    143:                    <li<%=  class="first" if i == 0 %>><%= link_to top_level_page.title, top_level_page.path %></li><% end %>
    144:                </ul> 
```

有没有人遇到过这样的事情？任何人都对诊断这个不可复制的问题有想法！？我尝试过切换 memcached 客户端 gem，认为这可能是一个奇怪的错误，但这没有任何效果！谢谢。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-13T20:05:22.113

这是由乘客共享其与 Memcached 服务器的连接引起的。检查[http://www.modrails.com/documentation/Users%20guide.html#_example_1_memcached_connection_sharing_harmful](http://www.modrails.com/documentation/Users%20guide.html#_example_1_memcached_connection_sharing_harmful)。

解决方法是将Passenger's Rails spawn 更改为`conservative`.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2010-11-17T22:57:46.480

我也遇到了这个问题，并且在缓存提供者的解组操作之前为每个类/模型添加了 require_dependency。也许在生产环境中这不是必需的，因为选项：config.cache_class 设置为 true，但在测试和开发中它是 false。

事实上，Memcache（是我正在使用的缓存提供程序）没有找到引用的类来执行解组然后引发此错误。

在这篇文章中对这个问题有一个更好的解决方案：http: [//kballcodes.com/2009/09/05/rails-memcached-a-better-solution-to-the-undefined-classmodule-problem/](http://kballcodes.com/2009/09/05/rails-memcached-a-better-solution-to-the-undefined-classmodule-problem/)

问候！

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T17:43:26.980

一些可能有帮助的事情：

*   添加检测/日志记录以`current_site`准确查看返回的内容。
*   您如何在 memcache 中指定键？您可能会不小心在两个不同的地方为两个不同的对象使用相同的键。
*   用于`memcached-tool host:port dump > /tmp/keys`查看内存缓存中的实际内容。
*   您的 memcached 位于防火墙后面，并且没有暴露在公共 IP 上，对吧？

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-11-19T20:02:00.767

是的，我遇到过这种情况。对我来说，这是因为我在做`Rails.cache.fetch(key)`，而钥匙是空白的。

我在 Rails 控制台中进行了一些操作，并使用了以下内容：

```
Rails.cache.read validkey  # Get back the proper data
Rails.cache.fetch('') { 'abc' } # Error in rails log: 'MemCacheError ():'
Rails.cache.read validkey # Get back nil
Rails.cache.read validkey # May get back proper data 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2012-02-14T02:47:48.217

添加评论以防其他人出现... kballcodes.com 网址不再有效（尽管您仍然可以通过[archive.org](http://web.archive.org/web/20100211113207/http://kballcodes.com/2009/09/05/rails-memcached-a-better-solution-to-the-undefined-classmodule-problem/)访问它）。在该博客文章的评论中，有人描述了一种方法，如果 Marshal 首先抛出“未定义的类/模块”错误，则可以尝试加载有问题的对象。我在下面包含了该代码，并在代码示例下方引用了原作者。

将此添加到 RAILS_ROOT/config/initializers/ 文件夹中的初始化程序文件中：

```
# 
# Marshal.load is a C-method built into Ruby; because it's so low-level, it
# bypasses the full classloading chain in Ruby, in particular the #const_missing
# hook that Rails uses to auto-load classes as they're referenced. This monkey
# patch catches the generated exceptions, parses the message to determine the
# offending constant name, loads the constant, and tries again.
#
# This solution is adapted from here:
# http://kballcodes.com/2009/09/05/rails-memcached-a-better-solution-to-the-undefined-classmodule-problem/
#
class <<Marshal
  def load_with_rails_classloader(*args)
    begin
      load_without_rails_classloader(*args)
    rescue ArgumentError, NameError => e
      if e.message =~ %r(undefined class/module)
        const = e.message.split(' ').last
        const.constantize
        retry
      else
        raise(e)
      end
    end
  end

  alias_method_chain :load, :rails_classloader
end 
```

这一切都归功于[马特布朗](http://outoftime.github.com/)，他把[这段代码写成了一个馅饼](http://pastie.org/720905)，并评论了上面现在已经死掉的文章：

# genetic-algorithm - 遗传算法中的轮盘赌选择。人口需要先排序？

> ID：734668
> 
> 赞同：9
> 
> 时间：2009-04-09T15:11:47.680
> 
> 标签：genetic-algorithm, roulette-wheel-selection

在遗传算法中，当使用轮盘选择方法选择成员进行交叉时，是否首先需要对种群进行适应度排序？

可能性似乎是：

1.  首先按适应度升序对种群进行排序
2.  按适应度降序对种群进行排序
3.  不要对人口进行排序，让轮盘赌球落在它可能的地方。

我认为无论哪种方式进行排序都可能没有效果 - 无论较大的切片是否组合在一起，随机落在包含不同大小（按健身）切片的轮子上的鹅卵石将具有完全相同的结果机会。但我不是 100% 相信的。

你怎么看？

每一代都需要进行排序也会影响算法的速度，所以我不希望这样做（如果使用精英主义，我会进行排序，但我不在这种情况下）。谢谢，如果你知道，因为我无法通过谷歌等找到明确的答案。

* * *

## 回答 #1

> 赞同：5
> 
> 时间：2009-04-09T15:21:11.643

不，您实际上不需要对它们进行排序。您完全正确的是，无论是否将较高级别的成员分组在一起（至少使用一个好的随机数生成器:)），它都不会产生任何影响。

你的直觉在这里已经死了 - 从统计上讲，它不会对排序产生影响，而且正如你所提到的，你不必浪费大量时间和精力来排序！

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-06-01T09:35:53.620

即使你应用精英主义，也没有必要对人口进行分类。

找到最好的 N 个个体只需要在整个种群中进行一次迭代。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T15:23:24.087

如果您使用此类选择，则无需对总体进行排序。

而且您对复杂性的看法也是正确的，排序是 n*log(n)，这使得遗传算法明显变慢（但复杂性仍然是多项式的，这是遗传算法的一个关键特征）。

这是我的做法（并为此在学校获得加分）：

1.  使用钩子实现更通用的解决方案 - 突变之前，选择之后等。

2.  测量迭代次数和算法/每次迭代的速度

3.  用钩子进行分类。措施。现在让钩子为空并测量等等。

你会得到一些很好的数据，并通过实验验证你的直觉告诉你什么。

# java - 在类路径中读取文件

> ID：734671
> 
> 赞同：32
> 
> 时间：2009-04-09T15:13:23.373
> 
> 标签：java, spring, file-io, classpath

这是我想做的，我想知道是否有任何 Spring 类可以帮助实现。对于这个特殊问题，我不必使用 spring，我只是用其他所有东西来实现它。

在我的 DAO 层中，我想外部化我的 sql 文件，也就是每个文件 1 个 sql。我想读取和缓存 sql 语句，甚至可能作为一个 spring bean 单例。但在我最初的挣扎中，我在类路径中加载一个 sql 文件时遇到了问题......

春天有什么可以帮助的吗？我已经阅读了文档，但没有任何事情发生在我身上。

这是我所追求的……但我无法让它识别文件或类路径……不确定是否需要在 applicationContext 中定义某些内容？

这里有一些似乎不起作用的尝试...... spring'ish 和 java'ish。

```
reader = new BufferedReader(new InputStreamReader(new ClassPathResource("com.company.app.dao.sql.SqlQueryFile.sql").getInputStream())

reader = new BufferedReader(new InputStreamReader(ClassLoader.getSystemResourceAsStream("com.company.app.dao.sql.SqlQueryFile.sql"))); 
```

有什么想法吗？

* * *

## 回答 #1

> 赞同：39
> 
> 时间：2009-04-09T15:14:47.440

改变 。以 / 作为路径分隔符并使用`getResourceAsStream`：

```
reader = new BufferedReader(new InputStreamReader(
    getClass().getClassLoader().getResourceAsStream(
        "com/company/app/dao/sql/SqlQueryFile.sql"))); 
```

或者

```
reader = new BufferedReader(new InputStreamReader(
    getClass().getResourceAsStream(
        "/com/company/app/dao/sql/SqlQueryFile.sql"))); 
```

`Class.getResourceAsStream()`使用vs时请注意前导斜杠`ClassLoader.getResourceAsStream`。 `getSystemResourceAsStream`使用不是您想要的*系统类加载器。*

我怀疑使用斜线而不是点也可以`ClassPathResource`。

* * *

## 回答 #2

> 赞同：34
> 
> 时间：2009-04-09T15:17:50.853

假设您使用 Spring 作为依赖注入框架，请尝试让 Spring 注入它。

在你的课堂上，做这样的事情：

```
public void setSqlResource(Resource sqlResource) {
    this.sqlResource = sqlResource;
} 
```

然后在您的应用程序上下文文件中，在 bean 定义中，只需设置一个属性：

```
<bean id="someBean" class="...">
    <property name="sqlResource" value="classpath:com/somecompany/sql/sql.txt" />
</bean> 
```

Spring 应该足够聪明，可以从类路径加载文件并将其作为资源提供给您的 bean。

您还可以查看[PropertyPlaceholderConfigurer](http://static.springframework.org/spring/docs/2.0.x/api/org/springframework/beans/factory/config/PropertyPlaceholderConfigurer.html)，并将所有 SQL 存储在属性文件中，并在需要时单独注入每个 SQL。有很多选择。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2015-07-15T15:49:45.253

```
import java.io.BufferedReader;
import java.io.File;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.IOException;

public class readFile {
    /**
     * feel free to make any modification I have have been here so I feel you
     * 
     * @param args
     * @throws InterruptedException
     */
    public static void main(String[] args) throws InterruptedException {
        File dir = new File(".");// read file from same directory as source //
        if (dir.isDirectory()) {
            File[] files = dir.listFiles();
            for (File file : files) {
                // if you wanna read file name with txt files
                if (file.getName().contains("txt")) {
                    System.out.println(file.getName());
                }

                // if you want to open text file and read each line then
                if (file.getName().contains("txt")) {
                    try {
                        // FileReader reads text files in the default encoding.
                        FileReader fileReader = new FileReader(
                                file.getAbsolutePath());
                        // Always wrap FileReader in BufferedReader.
                        BufferedReader bufferedReader = new BufferedReader(
                                fileReader);
                        String line;
                        // get file details and get info you need.
                        while ((line = bufferedReader.readLine()) != null) {
                            System.out.println(line);
                            // here you can say...
                            // System.out.println(line.substring(0, 10)); this
                            // prints from 0 to 10 indext
                        }
                    } catch (FileNotFoundException ex) {
                        System.out.println("Unable to open file '"
                                + file.getName() + "'");
                    } catch (IOException ex) {
                        System.out.println("Error reading file '"
                                + file.getName() + "'");
                        // Or we could just do this:
                        ex.printStackTrace();
                    }
                }
            }
        }

    }`enter code here`

} 
```

# c++ - 使用 CreateWindow 创建一个 win32 模态窗口

> ID：734674
> 
> 赞同：19
> 
> 时间：2009-04-09T15:13:44.370
> 
> 标签：c++, windows, winapi, modal-dialog

我创建一个窗口`CreateWindow()`并用`ShowWindow()`. 但是创建它的父窗口应该被禁用，直到用户从这个窗口返回，即它应该模拟模式对话框。

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-04-10T12:14:14.767

确保在显示弹出窗口后设置`hwndParent`in`CreateWindow`并使用来禁用父级。然后在弹出窗口关闭后`EnableWindow(hwndParent, FALSE)`启用父级。`EnableWindow(hwndParent, TRUE)`

* * *

## 回答 #2

> 赞同：14
> 
> 时间：2009-04-09T15:28:15.527

[模态，第 1 部分：UI 模态与代码模态](https://devblogs.microsoft.com/oldnewthing/20050218-00/?p=36413)解释了如何执行此操作，以及您可能不想这样做的原因。

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-09T15:19:12.303

您需要考虑成为模态窗口意味着什么 - 基本上，窗口的父级被禁用。这样做的唯一自动方法（我知道）是调用`DialogBox()`创建一个模式对话框。但是，既然要使用`CreateWindow()`，那么您需要做的就是自己手动禁用父窗口。

理想情况下，最好走对话框路线（因为操作系统确切地知道必须做什么才能创建模式窗口），但我想如果你必须使用它，这个选项就在那里。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2010-05-31T12:09:18.557

您还可以运行“辅助消息循环”，使父窗口保持非活动状态，直到您使用“模态”对话框完成工作。

* * *

## 回答 #5

> 赞同：2
> 
> 时间：2018-01-15T20:10:09.583

好吧，我自己也遇到了同样的问题。如果我使用 DialogBox()，我需要一个快速对话框，但我不想为我正在使用的特定项目创建模板。

我发现如果你禁用对话框的父窗口，你也会禁用对话框。如果不重新启用父对话框，您将无法启用该对话框。所以这种方法行不通。

我还发现您不能使用 SetCapture() / ReleaseCapture() 因为对话框的子窗口不会收到消息。

我确实找到了一个可行的解决方案：使用由 PeekMessage() 或 GetMessage() 驱动的本地消息泵。这是对我有用的代码：

```
 while (!m_bFinished)
  {
     BOOL bEat;

     if (PeekMessage(&msg, NULL, 0, 0, PM_REMOVE))
     {
        if (msg.message == WM_CHAR)
        {
           if (msg.wParam == VK_ESCAPE)
           {
              m_bFinished = TRUE;
              continue;
           }
        }

        bEat = FALSE;

        if (msg.message >= WM_MOUSEFIRST &&
           msg.message <= WM_MOUSELAST)
        {
           RECT rectMe;

           pcMe->GetWindowRect(&rectMe);
           if (!::PtInRect(&rectMe, msg.pt))
              bEat = TRUE;
        }

        if (!bEat)
        {
           ::TranslateMessage(&msg);
           ::DispatchMessage(&msg);
        }
     }
  } 
```

对于传递给该应用程序的所有消息，这实际上会“吃掉”窗口客户区域之外的任何鼠标消息。它不禁止在应用程序外部单击，只需单击应用程序内部不在“模态”窗口客户区域内的任何位置。如果您在接收消息时添加 MessageBeep()，您将获得与真正的模态对话框完全相同的行为。

m_bFinished 是该类的 BOOL 成员，如果在“对话框”上访问“确定”或“取消”按钮，并且在此处代码片段范围之外的某些其他条件下，它就会被设置。

# wpf - 如何为控件设置动画，使其像 WPF 中的羊皮纸滚动一样滚动？

> ID：734688
> 
> 赞同：1
> 
> 时间：2009-04-09T15:17:13.103
> 
> 标签：wpf, animation

有谁知道如何为面板设置动画，使其看起来像 WPF 中的旧式羊皮纸卷轴一样向下滚动？任何帮助将不胜感激。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T15:32:30.990

问题是这是一个相当复杂的动画，它需要将控件的一部分反转和挤压，而控件的其余部分则不需要。所以这不能用简单的缩放或拉伸动画来回答。您可能能够在指向您的用户控件的 VisualBrushes 上使用多个动画，但是在运行时将这些东西换入和换出确实变得复杂。

我想建议您查看 CodePlex 上的 Transitionals 项目：

[过渡项目](http://www.codeplex.com/transitionals)

过渡包括许多不同类型的动画，其中一种可能对您来说足够接近。如果没有，您可以查看过渡是如何构建的，看看是否可以调整一个以满足您的需求。

最后，最高效的方法是使用着色器。但是，着色器需要一些数学知识，并且是用 HLSL（不是 C#）编写的。如果您有兴趣了解更多信息，我强烈建议您查看以下文章：

[为 WPF 编写基于 GPU 的自定义效果](http://blogs.msdn.com/greg_schechter/archive/2008/05/12/introduction-to-writing-effects.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T15:43:10.933

您寻找的效果非常复杂。但是一个简单的替代方法是为高度/宽度设置动画。
在此示例中，我为堆栈面板设置动画，但您可以将其替换为任何控件。

```
<StackPanel Name="myStackPanel">
...
    <StackPanel.Triggers>
        <EventTrigger RoutedEvent="StackPanel.MouseEnter">
            <BeginStoryboard>
                <Storyboard>
                    <DoubleAnimation Storyboard.TargetName="myStackPanel"
                                     Storyboard.TargetProperty="Height"
                                     To="100" Duration="0:0:1.0" />
                </Storyboard>
            </BeginStoryboard>
        </EventTrigger>
    </StackPanel.Triggers>
</StackPanel> 
```

您可能需要添加第二个动画到 5 的触发器（例如在 MouseLeave 上）。动画到 0 可能会阻止 MouseEnter 事件。

# sqlite - 多列上的 Sqlite 主键

> ID：734689
> 
> 赞同：694
> 
> 时间：2009-04-09T15:17:31.807
> 
> 标签：sqlite, primary-key, ddl, composite-primary-key

在 SQLITE 中的多于 1 列上指定主键的语法是什么？

* * *

## 回答 #1

> 赞同：904
> 
> 时间：2009-04-09T15:21:34.683

根据[文档](http://www.sqlite.org/lang_createtable.html)，它是

```
CREATE TABLE something (
  column1, 
  column2, 
  column3, 
  PRIMARY KEY (column1, column2)
); 
```

* * *

## 回答 #2

> 赞同：176
> 
> 时间：2011-02-19T02:57:56.233

```
CREATE TABLE something (
  column1 INTEGER NOT NULL,
  column2 INTEGER NOT NULL,
  value,
  PRIMARY KEY ( column1, column2)
); 
```

* * *

## 回答 #3

> 赞同：47
> 
> 时间：2010-09-10T14:57:11.010

是的。但请记住，这样的主键允许`NULL`两列中的值多次。

像这样创建一个表：

```
 sqlite> CREATE TABLE something (
column1, column2, value, PRIMARY KEY (column1, column2)); 
```

现在这可以在没有任何警告的情况下工作：

```
sqlite> insert into something (value) VALUES ('bla-bla');
sqlite> insert into something (value) VALUES ('bla-bla');
sqlite> select * from something;
NULL|NULL|bla-bla
NULL|NULL|bla-bla 
```

* * *

## 回答 #4

> 赞同：37
> 
> 时间：2015-11-19T14:24:09.067

基本的 ：

```
CREATE TABLE table1 (
    columnA INTEGER NOT NULL,
    columnB INTEGER NOT NULL,
    PRIMARY KEY (columnA, columnB)
); 
```

如果您的列是其他表的外键（常见情况）：

```
CREATE TABLE table1 (
    table2_id INTEGER NOT NULL,
    table3_id INTEGER NOT NULL,
    FOREIGN KEY (table2_id) REFERENCES table2(id),
    FOREIGN KEY (table3_id) REFERENCES table3(id),
    PRIMARY KEY (table2_id, table3_id)
);

CREATE TABLE table2 (
    id INTEGER NOT NULL,
    PRIMARY KEY id
);

CREATE TABLE table3 (
    id INTEGER NOT NULL,
    PRIMARY KEY id
); 
```

* * *

## 回答 #5

> 赞同：16
> 
> 时间：2012-10-16T23:41:44.173

主键字段应声明为不为空（这是非标准的，因为主键的定义是它必须是唯一的且不为空）。但对于任何 DBMS 中的所有多列主键，以下是一个很好的做法。

```
create table foo
(
  fooint integer not null
  ,foobar string not null
  ,fooval real
  ,primary key (fooint, foobar)
)
; 
```

* * *

## 回答 #6

> 赞同：13
> 
> 时间：2015-11-02T10:55:05.390

从 SQLite 版本 3.8.2 开始，显式 NOT NULL 规范的替代方案是“WITHOUT ROWID”规范：[ [1](https://www.sqlite.org/withoutrowid.html) ]

```
NOT NULL is enforced on every column of the PRIMARY KEY
in a WITHOUT ROWID table. 
```

“WITHOUT ROWID”表具有潜在的效率优势，因此要考虑的不太冗长的替代方案是：

```
CREATE TABLE t (
  c1, 
  c2, 
  c3, 
  PRIMARY KEY (c1, c2)
 ) WITHOUT ROWID; 
```

例如，在 sqlite3 提示符下： `sqlite> insert into t values(1,null,3); Error: NOT NULL constraint failed: t.c2`

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2018-10-16T11:52:02.153

以下代码在 SQLite 中创建一个以**2 列作为主键的表。**

**解决方案：**

```
CREATE TABLE IF NOT EXISTS users (
    id TEXT NOT NULL, 
    name TEXT NOT NULL, 
    pet_name TEXT, 
    PRIMARY KEY (id, name)
) 
```

* * *

## 回答 #8

> 赞同：2
> 
> 时间：2017-05-16T09:33:06.883

另一种方式，你也可以让*两列主键* `unique`和*自增*键`primary`。就像这样：[https ://stackoverflow.com/a/6157337](https://stackoverflow.com/a/6157337)

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2018-12-12T06:21:41.383

`PRIMARY KEY (id, name)`对我不起作用。添加约束代替了这项工作。

```
CREATE TABLE IF NOT EXISTS customer (
    id INTEGER, name TEXT,
    user INTEGER,
    CONSTRAINT PK_CUSTOMER PRIMARY KEY (user, id)
) 
```

# c# - C# 委托可以使用更通用的对象类型吗？

> ID：734698
> 
> 赞同：2
> 
> 时间：2009-04-09T15:20:27.057
> 
> 标签：c#, functional-programming, delegates, type-conversion

我想创建一个委托和一个方法，可以用来调用我的应用程序需要的任意数量的 Web 服务：

例子：

```
public DateCheckResponseGetDate(DateCheckRequest requestParameters)
{
    delegate object WebMethodToCall(object methodObject);

    WebMethodToCall getTheDate = new WebMethodToCall(WebServices.GetTheDate);

    return (DateCheckResponse)CallWebMethod(getTheDate , requestParameters);
}

public TimeCheckResponse GetTime(TimeCheckRequest requestParameters)
{
    delegate object WebMethodToCall(object methodObject);

    WebMethodToCall getTheTime = new WebMethodToCall(WebServices.GetTheTime);

    return (TimeCheckResponse)CallWebMethod(getTheTime, requestParameters);
}

private object CallWebMethod(WebMethodToCall method, object methodObject)
{
    return method(methodObject);
} 
```

但是，不幸的是，当我尝试编译时，出现以下错误：

> 'GetTheDate' 没有重载匹配委托 'WebMethodToCall' 没有重载 'GetTheTime' 匹配委托'WebMethodToCall'

似乎代表应该工作。

WebServices.GetTheDate 和 WebServices.GetTheTime 都采用一个参数（分别为 DateCheckRequest 和 TimeCheckRequest）并且都返回一个值。

那么委托不匹配两个 Web 方法的签名吗？（从对象派生的接受和返回类型）。

是否可以使用对象类型在 .NET 2.0 中创建一个非常可重用的委托？

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T15:27:11.970

我建议您将代码更改为：

```
 public DateCheckResponseGetDate(DateCheckRequest requestParameters)
{
    Func<DateCheckRequest, DateCheckResponse> getTheDate = new Func<DateCheckRequest, DateCheckResponse>(WebServices.GetTheDate);

    return CallWebMethod(getTheDate , requestParameters);
}

//DEFINE CallWebMethod ADEQUATELY!
public T CallWebMethod<T,U> (Func<T,U> webMethod, U arg)
{
    return webMethod(arg);
} 
```

这样你就可以避免所有丑陋的垂头丧气:)

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-09T15:30:37.377

我建议您使用通用委托，例如`Func<T, TResult>`：

```
public DateCheckResponseGetDate(DateCheckRequest requestParameters)
{
    // Split declaration/assignment just to avoid wrapping
    Func<DateCheckRequest, DateCheckResponse> method;
    method = WebServices.GetTheDate;
    return CallWebMethod(method, requestParameters);
} 
```

然后你也会`CallWebMethod`通用：

```
public TResponse CallWebMethod<TRequest, TResponse>
    (Func<TRequest, TResponse> method, TRequest request)
{
    // Whatever you do in here.
} 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T17:37:33.313

感谢这里的评论，我解决了。

```
private delegate object WebMethodToCall<T>(T methodObject);

public DateCheckResponseGetDate(DateCheckRequest requestParameters)
{
    WebMethodToCall<DateCheckRequest> getTheDate = new WebMethodToCall<DateCheckRequest>(WebServices.GetTheDate);

    return CallWebMethod<DateCheckResponse, DateCheckRequest>(getTheDate, requestParameters);
}

public TimeCheckResponse GetTime(TimeCheckRequest requestParameters)
{
    WebMethodToCall<TimeCheckRequest> getTheTime = new WebMethodToCall<TimeCheckRequest>(WebServices.GetTheTime);

    return CallWebMethod<TimeCheckResponse, TimeCheckRequest>(getTheTime, requestParameters);
}

private T CallWebMethod<T, U>(WebMethodToCall<U> method, U methodObject)
{
    return (T)method(methodObject);
} 
```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T15:28:21.547

是的，但是您必须重写 WebServices.GetTheData 和 GetTheTime 来获取对象，或者提供获取对象的重载。

这是因为您不能在 .NET 中隐式向上转换对象*。*换句话说，您可以这样做：

```
TimeCheckRequest myTimeCheckRequest;
object foo = myTimeCheckRequest; 
```

但你不能这样做：

```
object myTimeCheckRequest;
TimeCheckRequest  foo = myTimeCheckRequest; 
```

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T16:14:56.270

您可以将 Func 定义为：

```
public delegate TResult Func<T, TResult>(T arg); 
```

此定义不需要 .NET 2.0 中不可用的任何内容，并且添加到我在上面发布的片段中可以解决您的问题 :)

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-09T15:42:44.600

**更新：** *可能不再有效？不知道，我在 C# 2.0 中做过这个*

要扩展 Will 的答案，虽然 .NET 不会为您隐式执行此操作，但您可以通过向 TimeCheckRequest 类添加隐式运算符来强制执行此操作：

```
public class TimeCheckRequest
{
    ...

    public static implicit operator TimeCheckRequest(object request)
    {
        return (TimeCheckRequest) request;
    }
} 
```

但是，我**不**建议这样做，因为您可以使用[通用委托](http://msdn.microsoft.com/en-us/library/sx2bwtw7(VS.80).aspx)而不需要所有转换的性能成本。

# database - 数据库与 ExtendScript 一起使用（用于 Adob e Illustrator）

> ID：734700
> 
> 赞同：3
> 
> 时间：2009-04-09T15:21:08.007
> 
> 标签：database, adobe-illustrator, extendscript

我想将一个 VB 程序重构为 ExtendScript 以自动化 Adob​​e Illustrator CS4 中的一些绘图，但需要从数据库中读取。是否可以使用 ExtendScript 从数据库中读取？如何？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2012-04-27T02:26:53.450

是的，ES 可以读取 CSV。只需使用逗号描述格式化您的数据库。

这是一个可以解决问题的函数：

```
function readPref (thePath) {
    if (File(thePath).exists == true) {

    var file = File(thePath);
    file.open("r");
    file.encoding= 'BINARY';
    var theText = file.read();
    file.close();
    return String(theText).split(",")

    }
}; 
```

应该返回一个包含你需要的数组。让VB导出一个数据库，然后用它来读取它。多佐。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-12-16T15:10:19.993

我有一些我一直在成功使用的不同解决方案：创建一个可以访问您的数据库的 Web 服务，然后从 ExtendScript 使用 http 连接来使用这些服务（从那里您几乎可以做任何您想做的事情） .

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-07-18T17:36:45.320

Illustrator 脚本引擎没有提供任何直接读取外部数据的机制，但是您有几种方法可以做到这一点......

1.  编写一个连接数据库的外部程序以生成VB脚本，并使用Illustrator执行“生成”脚本，这是我以前的做法。
2.  自cs3以来的新ScriptUI提供了打开一个Window，包含一个flash swf作为驱动Illustrator JS引擎的接口。您可以在 Flash 内容中读取 xml、调用 webservices、Flash Remoting。我不确定您是否对这些工具集感到满意。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-07-02T03:54:53.650

我的理解是，您需要在 VB 代码中使用 ExtendScript 来“doScript()”。ExtendScript 本身没有任何真正的数据库连接。但我熟悉使用 VB 代码连接数据库并返回结果的人。ExtendScript 具有运行 VB 代码的 doScript 方法。诀窍，它接缝，是找到一种方法将数据返回到 ExtendScript 以告诉 Adob​​e 应用程序该做什么。据我所知，.doScript 没有一种很好的方式来接受嵌入代码的结果。所以我听说人们做的是以下几件事之一：

*   让 VB 代码编写一个 ExtendScript 代码可以读取和解析的文本文件。
*   让 VB 代码将“ScriptLabel”添加到您的 Adob​​e Illustrator 文档中。然后使用 ExtendScript 读取相同的标签。这实际上与编写文本文件相同，只是没有文件。

高温高压

Jon S. Winters，ExtendScript 支持，电子出版支持

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2015-04-14T22:06:08.060

无论您是否需要将 VB 重构为 100% 的 ExtendScript（没有 VB 代码，全部为 ExtendScript），我想说最简单的解决方案是这样的：

有一个调用 ExtendScript 的 VB/VBScript 包装器，该包装器处理数据库交互并将数据来回传递给 ExtendScript。这允许您保持数据库代码简单，重用您在 VB 中拥有的内容，并使 ExtendScript 保持简单。

您可以使用 Adob​​e 应用程序的 COM API 从 VB/VBScript 调用 ExtendScript，它具有从 ExtendScript 获得的所有绘图方法以及用于执行 javascript（或更实际地是 ExtendScript）代码的 doJavascript() 方法。同样的 doJavascript() 方法可用于拉入 ExtendScript JSX 文件，而不是一段 javscript 代码。您可以在相关的 SO 帖子中找到更多详细信息：

[是否可以从 ExtendScript 外部执行 JSX 脚本？](https://stackoverflow.com/questions/3846626/is-it-possible-to-execute-jsx-scripts-from-outside-extendscript)

查看特定于 Windows 的答案。进一步考虑这个问题和解决方案，它也可以适用于其他平台（Mac、Python、Perl 等）它不一定适用于 VB 和 Windows，同样的方法可以用于通过 COM 与外部的 ExtendScript 交互Mac 上的 Windows 或 Applescript，这将适用于任何与 COM/Applescript 兼容（或接口）的语言。

# sql - 使用存储过程导致更新语句

> ID：734712
> 
> 赞同：1
> 
> 时间：2009-04-09T15:24:14.117
> 
> 标签：sql, sql-server, tsql, sql-update

我有一个包含两列（除其他外）的表：id 和 created_in_variant 以及一个基于 id 计算 created_in_variant 值的存储过程。我想做这样的事情：

```
UPDATE [dbo].[alerts]
     SET [created_in_variant] = find_root [id] 
```

有什么好的方法吗？

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T15:26:53.797

对于此类问题，您可能希望查看使用*标量值函数*（也称为*用户定义函数）而不是存储过程。*

**编辑**：以下是有关 SVF 的一些信息：[单击](http://www.sqlteam.com/article/user-defined-functions)

**编辑 2**：这里是[15 Seconds的更多信息](http://www.15seconds.com/Issue/000817.htm)

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T15:28:19.473

将您的 proc 更改为 UDF，您基本上完全按照您的要求调用它

```
UPDATE [dbo].[alerts]
     SET [created_in_variant] = dbo.find_root([id]) 
```

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T17:54:55.783

如果您*被迫*使用存储过程来实现您所要求的，您可以简单地将找到的根值保存在一个变量中并传递它。除非您像其他人提到的那样使用 UDF（用户定义函数），否则没有更简单的方法**。**

这是使用存储过程时最简单的答案之一，*因为*您不能将存储过程直接传递给`UPDATE`语句。没有像 C# 或 Java 等其他语言那样的插值。

```
declare @root int
-- 1) Return the root through output parameter
exec find_root @id, @root out
-- or make the sproc to return the root value
exec @root = find_root @id
UPDATE [dbo].[alerts]
     SET [created_in_variant] = @root 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T15:26:10.633

将存储过程重写为标量值函数。然后，您可以将其用于更新。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T15:26:35.780

您可以将 created_in_variant 设为计算域吗？

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T15:26:58.010

您可以使用 UDF 而不是存储过程。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T15:27:07.230

我不这么认为。如果您将存储过程转换为可以工作的缩放函数。

如果您想使用存储过程，则必须为每个 id（在游标中）调用存储过程并在 OUTPUT 变量中返回值，然后使用输出变量对每个 id 进行更新。但是，使用 UDF 会好得多。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T15:27:24.403

您可以将存储过程重新编程为用户定义的函数并使用它。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2010-10-26T16:51:59.210

您只是缺少dbo。，DJ回答应该已经很好了。我今天有同样的问题。

# c# - 在构造函数中传递对“this”的引用

> ID：734715
> 
> 赞同：10
> 
> 时间：2009-04-09T15:26:02.397
> 
> 标签：c#, constructor

我知道我以前做过这个，但我认为我的构造函数执行顺序有点扭曲......

```
public class Class1
{
    Class2 _class2;

    public Class1()
    {
        _class2 = new Class2(this);
    }
}

public class Class2 
{
    Class1 _parent; //corrected typo

    public Class2(Class1 parent)
    {
        _parent = parent;
    }
} 
```

问题是 parent 总是以 null 结尾。

这样做的正确方法是什么？（也许我可以把我的慢归咎于感冒......）

编辑以纠正错字（这不是真实代码中的问题！）

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T15:29:27.440

您可能打错了代码，但我认为您想要 Class2 的这个定义（注意Class2 构造函数中的*this限定符）：*

```
public class Class2 
{
    Class1 parent;

    public Class2(Class1 parent)
    {
        this.parent = parent;
    }
} 
```

* * *

## 回答 #2

> 赞同：10
> 
> 时间：2009-04-09T15:33:51.317

从技术上讲，这应该可以工作，前提是您将 Class2 更改为包含`this.parent = parent;`

但是，我不建议这样做。相反，我建议在 class1 中延迟初始化您的 class2 实例。根据 Class2 的构造函数中所做的一切，您可能会将自己带入令人讨厌的情况。

在 class1 上创建 Class2 属性并延迟初始化它会导致 Class2 在 Class1 的构造函数完成后被构造，而不是在它的构造过程中，如果你的类变得更复杂，这很可能不太容易出错。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T15:29:13.447

```
Class1 parent;
_parent = parent; 
```

_parent 从未定义；你拼错了。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2016-07-18T13:07:47.527

我知道这是一个老问题，但我想我会投入两分钱。谷歌把我带到了这里，所以它可能会把其他人带到这里。

这可疑地看起来像一个循环依赖......这是相当代码气味有两个相互使用/引用的独立类。

如果您想为对象建立父/子关系，请考虑为您的类创建一个二叉树实现（或类似的）。

如果您想利用类继承，请正确使用它 > `Class2`是 for 的基类`Class1`，您的`Class1`声明将是`public class Class1 : Class2`. 您可以使用关键字引用`Class2`'s 方法。`Class1``base`

所以简而言之，这个答案是：你需要重新设计你的类以更好地适应你想要完成的事情，而不是让编译器做一些比它需要的更令人困惑的事情。

特别是因为您将要用来测试它的代码可能是 newing up `Class1`，然后查询该对象以获取其对`Class2`的引用`Class1`... 这绝对没有意义。

附录2：

语义上，`Class1`可以改写如下：

```
public class Class1
{
    Class2 _class2;

    public Class1()
        :this(new Class2(this))
    {
    }
    public Class1(Class2 class2)
    {
        _class2 = class2;
    }
} 
```

...除了它不能，因为`:this(new Class2(this))`它的语法完全不正确。这也正是你正在做的事情。请不要。

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T15:50:05.287

我不明白为什么这不起作用。它对我有用。

声明：http: [//vvcap.net/db/I2OZoapbIRREvQ8ymPym.htp](http://vvcap.net/db/I2OZoapbIRREvQ8ymPym.htp)

跨过：http: [//vvcap.net/db/ehsYqCY6JByqZQq-RXGp.htp](http://vvcap.net/db/ehsYqCY6JByqZQq-RXGp.htp)

结果如下：http: [//vvcap.net/db/ZWjqb_Yv1yAisX0BYUns.htp](http://vvcap.net/db/ZWjqb_Yv1yAisX0BYUns.htp)

# c++ - 如何在 C++ 中删除文件夹？

> ID：734717
> 
> 赞同：54
> 
> 时间：2009-04-09T15:26:23.440
> 
> 标签：c++, delete-directory

如何使用 C++ 删除文件夹？

如果不存在跨平台方式，那么对于最流行的操作系统——Windows、Linux、Mac、iOS、Android，如何做到这一点？POSIX 解决方案是否适用于所有人？

* * *

## 回答 #1

> 赞同：63
> 
> 时间：2009-04-09T15:36:35.333

我强烈建议使用 Boost.FileSystem。

[http://www.boost.org/doc/libs/1_38_0/libs/filesystem/doc/index.htm](http://www.boost.org/doc/libs/1_38_0/libs/filesystem/doc/index.htm)

在你的情况下，那将是

[boost::filesystem::remove_all(yourPath)](http://www.boost.org/doc/libs/1_48_0/libs/filesystem/v3/doc/reference.html#remove_all)

* * *

## 回答 #2

> 赞同：55
> 
> 时间：2017-04-13T12:58:30.537

使用 C++17 可以使用[`std::filesystem`](http://en.cppreference.com/w/cpp/filesystem)，在 C++14[`std::experimental::filesystem`](http://en.cppreference.com/w/cpp/experimental/fs)中已经可用。两者都允许使用[`filesystem::remove()`](http://en.cppreference.com/w/cpp/filesystem/remove).

C++17：

```
#include <filesystem>
std::filesystem::remove("myEmptyDirectoryOrFile"); // Deletes empty directories or single files.
std::filesystem::remove_all("myDirectory"); // Deletes one or more files recursively. 
```

C++14：

```
#include <experimental/filesystem>
std::experimental::filesystem::remove("myDirectory"); 
```

注意 1：如果出现错误，这些函数会抛出[filesystem_error](http://en.cppreference.com/w/cpp/filesystem/remove)。如果您想避免捕获异常，请使用重载变体[`std::error_code`](http://en.cppreference.com/w/cpp/error/error_code)作为第二个参数。例如

```
std::error_code errorCode;
if (!std::filesystem::remove("myEmptyDirectoryOrFile", errorCode)) {
    std::cout << errorCode.message() << std::endl;
} 
```

注意 2：转换为[`std::filesystem::path`](http://en.cppreference.com/w/cpp/filesystem/path)隐式地发生在不同的编码中，因此您可以将字符串传递给[`filesystem::remove()`](http://en.cppreference.com/w/cpp/filesystem/remove).

* * *

## 回答 #3

> 赞同：23
> 
> 时间：2012-05-31T15:03:42.387

在不使用 Shell API 的 Windows (VisualC++) 中删除文件夹（子文件夹和文件），这是最好的工作示例：

```
#include <string>
#include <iostream>

#include <windows.h>
#include <conio.h>

int DeleteDirectory(const std::string &refcstrRootDirectory,
                    bool              bDeleteSubdirectories = true)
{
  bool            bSubdirectory = false;       // Flag, indicating whether
                                               // subdirectories have been found
  HANDLE          hFile;                       // Handle to directory
  std::string     strFilePath;                 // Filepath
  std::string     strPattern;                  // Pattern
  WIN32_FIND_DATA FileInformation;             // File information

  strPattern = refcstrRootDirectory + "\\*.*";
  hFile = ::FindFirstFile(strPattern.c_str(), &FileInformation);
  if(hFile != INVALID_HANDLE_VALUE)
  {
    do
    {
      if(FileInformation.cFileName[0] != '.')
      {
        strFilePath.erase();
        strFilePath = refcstrRootDirectory + "\\" + FileInformation.cFileName;

        if(FileInformation.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY)
        {
          if(bDeleteSubdirectories)
          {
            // Delete subdirectory
            int iRC = DeleteDirectory(strFilePath, bDeleteSubdirectories);
            if(iRC)
              return iRC;
          }
          else
            bSubdirectory = true;
        }
        else
        {
          // Set file attributes
          if(::SetFileAttributes(strFilePath.c_str(),
                                 FILE_ATTRIBUTE_NORMAL) == FALSE)
            return ::GetLastError();

          // Delete file
          if(::DeleteFile(strFilePath.c_str()) == FALSE)
            return ::GetLastError();
        }
      }
    } while(::FindNextFile(hFile, &FileInformation) == TRUE);

    // Close handle
    ::FindClose(hFile);

    DWORD dwError = ::GetLastError();
    if(dwError != ERROR_NO_MORE_FILES)
      return dwError;
    else
    {
      if(!bSubdirectory)
      {
        // Set directory attributes
        if(::SetFileAttributes(refcstrRootDirectory.c_str(),
                               FILE_ATTRIBUTE_NORMAL) == FALSE)
          return ::GetLastError();

        // Delete directory
        if(::RemoveDirectory(refcstrRootDirectory.c_str()) == FALSE)
          return ::GetLastError();
      }
    }
  }

  return 0;
}

int main()
{
  int         iRC                  = 0;
  std::string strDirectoryToDelete = "c:\\mydir";

  // Delete 'c:\mydir' without deleting the subdirectories
  iRC = DeleteDirectory(strDirectoryToDelete, false);
  if(iRC)
  {
    std::cout << "Error " << iRC << std::endl;
    return -1;
  }

  // Delete 'c:\mydir' and its subdirectories
  iRC = DeleteDirectory(strDirectoryToDelete);
  if(iRC)
  {
    std::cout << "Error " << iRC << std::endl;
    return -1;
  }

  // Wait for keystroke
  _getch();

  return 0;
} 
```

来源：[http ://www.codeguru.com/forum/showthread.php?t=239271](http://www.codeguru.com/forum/showthread.php?t=239271)

* * *

## 回答 #4

> 赞同：10
> 
> 时间：2009-04-09T15:32:09.387

目录应该是空的。

```
BOOL RemoveDirectory( LPCTSTR lpPathName ); 
```

* * *

## 回答 #5

> 赞同：9
> 
> 时间：2014-12-22T14:02:58.363

```
void remove_dir(char *path)
{
        struct dirent *entry = NULL;
        DIR *dir = NULL;
        dir = opendir(path);
        while(entry = readdir(dir))
        {   
                DIR *sub_dir = NULL;
                FILE *file = NULL;
                char abs_path[100] = {0};
                if(*(entry->d_name) != '.')
                {   
                        sprintf(abs_path, "%s/%s", path, entry->d_name);
                        if(sub_dir = opendir(abs_path))
                        {   
                                closedir(sub_dir);
                                remove_dir(abs_path);
                        }   
                        else 
                        {   
                                if(file = fopen(abs_path, "r"))
                                {   
                                        fclose(file);
                                        remove(abs_path);
                                }   
                        }   
                }   
        }   
        remove(path);
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2012-11-06T17:28:21.933

Use SHFileOperation to remove the folder recursivelly

* * *

## 回答 #7

> 赞同：4
> 
> 时间：2009-04-09T15:31:25.253

该目录必须为空，并且您的程序必须具有删除它的权限

但是名为 rmdir 的函数会做到这一点

```
rmdir("C:/Documents and Settings/user/Desktop/itsme") 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2013-01-08T06:54:01.223

如果你在 linux 上，你也可以试试这个：

```
system("rm -r path"); 
```

* * *

## 回答 #9

> 赞同：2
> 
> 时间：2020-02-02T19:36:52.460

这适用于删除目录中的所有目录和文件。

```
#include <iostream>
#include <cstring>
#include <cstdlib>
using namespace std;
int main()
{
    cout << "Enter the DirectoryName to Delete : ";
    string directoryName;
    cin >> directoryName;
    string a = "rmdir /s /q " + directoryName;
    system(a.c_str());
    return 0;
} 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2009-04-09T15:29:33.713

C++ 标准定义了 remove() 函数，它可能会也可能不会删除文件夹，具体取决于实现。如果不需要，则需要使用特定于实现的函数，例如 rmdir()。

* * *

## 回答 #11

> 赞同：1
> 
> 时间：2021-06-10T12:15:06.737

我没有评论的“声誉”，所以我必须做出回答。

据我所见，以前的 Windows 解决方案包含一个错误（在检查“.”时：它不会删除像 .ssh 这样的目录）。

此外，缺少 UTF-8 路径的（现在必须的）管理。

```
// OK we want the UTF-8 compatible functions
#ifndef UNICODE
#define UNICODE
#endif

#include <stdio.h>
#include <windows.h>
#include <string>
#include <assert.h>

// 16bit wide string to UTF-8 
std::string wtou(const wchar_t* i_string) 
{
    assert(sizeof(wchar_t)==2);     // Not always true 
    assert((wchar_t)(-1)==65535);   // not too big
    std::string myresult;
    if (!i_string) 
        return myresult;
    for (; *i_string; i_string++) 
    {
        if (*i_string<128) 
            myresult+=*i_string;
        else 
        if (*i_string<2048) 
            myresult+=192+*i_string/64, myresult+=128+*i_string%64;
        else 
            myresult+=224+*i_string/4096, myresult+=128+*i_string/64%64, myresult+=128+*i_string%64;
    }
    return myresult;
}

// UTF-8 to wide string
std::wstring utow(const char* i_string) 
{
    assert(sizeof(wchar_t)==2);
    assert((wchar_t)(-1)==65535);
    std::wstring myresult;
    if (!i_string) 
        return myresult;
    const unsigned char* s=(const unsigned char*)i_string;
    for (; s && *s; s++) 
    {
        if (s[0]<128) 
            myresult+=s[0];
        else 
        if (s[0]>=192 && s[0]<224 && s[1]>=128 && s[1]<192)
            myresult+=(s[0]-192)*64+s[1]-128, ++i_string;
        else 
        if (s[0]>=224 && s[0]<240 && s[1]>=128 && s[1]<192 && s[2]>=128 && s[2]<192)
            myresult+=(s[0]-224)*4096+(s[1]-128)*64+s[2]-128, s+=2;
    }
    return myresult;
}

int win_erredbarras(const std::string &i_path,bool i_flagrecursive=true)
{
    bool    flagdebug=true;
    bool    flagsubdir=false;
    HANDLE  myhandle;
    std::wstring wfilepath;
    WIN32_FIND_DATA findfiledata;

    std::string pattern=i_path+"\\*.*";

    std::wstring wpattern   =utow(pattern.c_str());
    std::wstring wi_path    =utow(i_path.c_str());

    myhandle=FindFirstFile(wpattern.c_str(),&findfiledata);

    if (myhandle!=INVALID_HANDLE_VALUE)
    {
        do
        {
            std::string t=wtou(findfiledata.cFileName);

            if ((t!=".") && (t!=".."))
            {
                wfilepath=wi_path+L"\\"+findfiledata.cFileName;
                if (findfiledata.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY)
                {
                    if (i_flagrecursive)
                    {
                        const std::string temp(wfilepath.begin(),wfilepath.end());
                        if (flagdebug)
                            printf("\n\nDelete directory   %s\n",temp.c_str());
                        int myresult=win_erredbarras(temp,i_flagrecursive);
                        if (myresult)
                            return myresult;
                    }
                    else
                        flagsubdir=true;
                }
                else
                {
                    const std::string ttemp(wfilepath.begin(), wfilepath.end() );
                    if (flagdebug)
                        printf("Try to delete file %s\n",ttemp.c_str());

                    if (SetFileAttributes(wfilepath.c_str(),FILE_ATTRIBUTE_NORMAL) == FALSE)
                    {
                        if (flagdebug)
                            printf("31019: ERROR cannot change attr of file %s\n",ttemp.c_str());
                        return GetLastError();
                    }

                    if (DeleteFile(wfilepath.c_str())==FALSE)
                    {
                        if (flagdebug)
                            printf("31025: ERROR highlander file %s\n",ttemp.c_str());
                        return GetLastError();
                    }
                }
            }
        } while(FindNextFile(myhandle,&findfiledata)==TRUE);

        FindClose(myhandle);

        DWORD myerror=GetLastError();
        if (myerror==ERROR_NO_MORE_FILES)
        {
            if (!flagsubdir)
            {
                const std::string dtemp(wi_path.begin(), wi_path.end());

                if (flagdebug)
                    printf("Delete no subdir   %s\n",dtemp.c_str());

                if (SetFileAttributes(wi_path.c_str(),FILE_ATTRIBUTE_NORMAL)==FALSE)
                {
                    if (flagdebug)
                        printf("30135: ERROR cannot change folder attr %s\n",dtemp.c_str());
                    return GetLastError();
                }

                if (RemoveDirectory(wi_path.c_str())==FALSE)
                {
                    if (flagdebug)
                        printf("31047: ERROR highlander dir %s\n",dtemp.c_str());
                    return GetLastError();
                }
            }
        }
        else
            return myerror;
    }
    return 0;
}

int main()
{
    win_erredbarras("z:\\knb",true);
    return 0;
} 
```

**现在我放了一个 UNIX/Linux 版本，基于以前固定的功能**

```
#include <stdio.h>
#include <string>
#include <dirent.h>
#include <sys/stat.h>

/// secondary functions to be #ifdeffed on Windows
bool isdirectory(std::string i_filename)
{
    if (i_filename.length()==0)
        return false;
    else
        return i_filename[i_filename.size()-1]=='/';
}
bool delete_file(const char* i_filename) 
{
    return remove(i_filename)==0;
}
bool delete_dir(const char* i_directory) 
{
    return remove(i_directory)==0;
}

int erredbarras(const std::string &i_path,bool i_flagrecursive=true)
{
    bool    flagdebug=true;
    bool    risultato=false;

    DIR *d=opendir(i_path.c_str());

    if (d) 
    {
        struct dirent *p;
        risultato=true;
        while (risultato && (p=readdir(d))) 
        {
            if (!strcmp(p->d_name, ".") || !strcmp(p->d_name, ".."))
                continue;
            bool risultato2=false;
            struct stat statbuf;

            std::string temp;
            if (isdirectory(i_path))
                temp=i_path+p->d_name;
            else
                temp=i_path+"/"+p->d_name;

            if (!stat(temp.c_str(), &statbuf)) 
            {
                if (S_ISDIR(statbuf.st_mode))
                    risultato2=erredbarras(temp);
                else
                {
                    if (flagdebug)
                        printf("Delete file %s\n",temp.c_str());
                    risultato2=delete_file(temp.c_str());
                }
            }
            risultato=risultato2;
        }
        closedir(d);
    }

    if (risultato)
    {
        if (flagdebug)
            printf("Delete dir  %s\n\n",i_path.c_str());
        delete_dir(i_path.c_str());
    }
   return risultato;
}

int main()
{
    printf("Risultato %d\n",erredbarras("/tmp/knb/"));
    return 0;
} 
```

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-02-26T08:48:48.677

尝试使用系统“ `rmdir -s -q file_to_delte`”。
这将删除文件夹及其中的所有文件。

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2012-06-01T03:02:07.647

//对于窗口：

```
#include <direct.h>

if(_rmdir("FILEPATHHERE") != -1)
{
  //success     
} else {
  //failure
} 
```

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2019-06-07T03:34:21.183

如果您使用的是[Poco](https://github.com/pocoproject/poco)库，这是一种删除目录的可移植方法。

```
#include "Poco/File.h"
...
...
Poco::File fooDir("/path/to/your/dir");
fooDir.remove(true); 
```

使用“true”调用的 remove 函数意味着递归删除目录中的所有文件和子目录。

* * *

## 回答 #15

> 赞同：0
> 
> 时间：2018-06-08T17:44:55.063

对于 linux（我在上面的代码中修复了错误）：

```
void remove_dir(char *path)
{
        struct dirent *entry = NULL;
        DIR *dir = NULL;
        dir = opendir(path);
        while(entry = readdir(dir))
        {   
                DIR *sub_dir = NULL;
                FILE *file = NULL;
                char* abs_path new char[256];
                 if ((*(entry->d_name) != '.') || ((strlen(entry->d_name) > 1) && (entry->d_name[1] != '.')))
                {   
                        sprintf(abs_path, "%s/%s", path, entry->d_name);
                        if(sub_dir = opendir(abs_path))
                        {   
                                closedir(sub_dir);
                                remove_dir(abs_path);
                        }   
                        else 
                        {   
                                if(file = fopen(abs_path, "r"))
                                {   
                                        fclose(file);
                                        remove(abs_path);
                                }   
                        }   
                }
                delete[] abs_path;   
        }   
        remove(path);
} 
```

对于窗户：

```
void remove_dir(const wchar_t* folder)
{
    std::wstring search_path = std::wstring(folder) + _T("/*.*");
    std::wstring s_p = std::wstring(folder) + _T("/");
    WIN32_FIND_DATA fd;
    HANDLE hFind = ::FindFirstFile(search_path.c_str(), &fd);
    if (hFind != INVALID_HANDLE_VALUE) {
        do {
            if (fd.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY) {
                if (wcscmp(fd.cFileName, _T(".")) != 0 && wcscmp(fd.cFileName, _T("..")) != 0)
                {
                    remove_dir((wchar_t*)(s_p + fd.cFileName).c_str());
                }
            }
            else {
                DeleteFile((s_p + fd.cFileName).c_str());
            }
        } while (::FindNextFile(hFind, &fd));
        ::FindClose(hFind);
        _wrmdir(folder);
    }
} 
```

* * *

## 回答 #16

> 赞同：0
> 
> 时间：2016-09-19T00:27:34.953

我自己的实现基于 hB0，它还允许您查看每个文件夹中的文件数量，同时也提高了一点性能。

```
#include <string>
#include <iostream>
#include <cstdlib>
#include <cstdio>
#include <windows.h>
#include <conio.h>

union seperated {
  struct {
    unsigned int low;
    unsigned int high;
  } uint;
  unsigned long long ull;
};

unsigned long long num_dirs  = 1;
unsigned long long num_files = 0;
seperated size_files;

int DeleteDirectory( char* refRootDirectory );      //predeclare it

int DeleteDirectory( char* refRootDirectory ) {
    HANDLE      hFile;              // Handle to directory
    std::string strFilePath;            // Filepath
    WIN32_FIND_DATA FileInformation;    // File information
    int     dwError;            // Folder deleting error
    std::string strPattern;         // Pattern

    strPattern = (std::string)(refRootDirectory) + "\\*.*";
    hFile = ::FindFirstFile( strPattern.c_str(), &FileInformation );

    if( hFile != INVALID_HANDLE_VALUE )
    {
        do {
            if( FileInformation.cFileName[0] != '.' ) {
                strFilePath.erase();
                strFilePath = std::string(refRootDirectory) + "\\" + FileInformation.cFileName;

                if( FileInformation.dwFileAttributes & FILE_ATTRIBUTE_DIRECTORY ) {
                    DeleteDirectory( (char*)strFilePath.c_str() );

                    dwError = ::GetLastError();
                    if( dwError != ERROR_NO_MORE_FILES ) {
                        std::cout << "!ERROR!: [[" << strFilePath.c_str() << "]]\n";
                        return dwError;
                    } else {
                        // Set directory attributes
                        if( ! ::SetFileAttributes(refRootDirectory,FILE_ATTRIBUTE_NORMAL) ) {
                            std::cout << "!ERROR!: [[" << strFilePath.c_str() << "]]\n";
                            return ::GetLastError();
                        }

                        // Delete directory
                        if( ! ::RemoveDirectory(refRootDirectory) ) {
                            std::cout << "!ERROR!: [[" << strFilePath.c_str() << "]]\n";
                            return ::GetLastError();
                        }
                    }

                    ++num_dirs;
                } else {

                    // Set file attributes
                    if( ! ::SetFileAttributes(strFilePath.c_str(),FILE_ATTRIBUTE_NORMAL) ) {
                        std::cout << "!ERROR!: [[" << strFilePath.c_str() << "]]\n";
                        return ::GetLastError();
                    }

                    // Delete file
                    if ( ! ::DeleteFile(strFilePath.c_str()) ) {
                        std::cout << "!ERROR!: [[" << strFilePath.c_str() << "]]\n";
                        return ::GetLastError();
                    }

                    size_files.ull       += FileInformation.nFileSizeLow;
                    size_files.uint.high += FileInformation.nFileSizeHigh;

                    ++num_files;
                }
            }
        } while( ::FindNextFile(hFile,&FileInformation) );

        // Close handle
        ::FindClose( hFile  );
    }

    return 0;
}

unsigned long long num_files_total=0;
unsigned long long num_dirs_total=0;
unsigned long long total_size_files=0;

void my_del_directory( char* dir_name ) {
    int iRC = DeleteDirectory( dir_name );
    //int iRC=0;

    std::cout << "\"" << dir_name << "\""
             "\n    Folders: " << num_dirs
          << "\n    Files:   " << num_files
          << "\n    Size:    " << size_files.ull << " Bytes";
    if(iRC)
    {
        std::cout << "\n!ERROR!: " << iRC;
    }
    std::cout << "\n\n";

    num_dirs_total   += num_dirs;
    num_files_total  += num_files;
    total_size_files += size_files.ull;
    num_dirs  = 1;
    num_files = 0;
    size_files.ull = 0ULL;
    return;
}

int main( void )
{
    size_files.ull = 0ULL;

    my_del_directory( (char*)"C:\Windows\temp"      );
        // This will clear out the System temporary directory on windows systems

    std::cout << "\n\nResults" << "\nTotal Folders: " << num_dirs_total
                   << "\nTotal Files:   " << num_files_total
                   << "\nTotal Size:    " << total_size_files << " Bytes\n";

    return 0;
} 
```

* * *

## 回答 #17

> 赞同：-1
> 
> 时间：2009-04-09T15:35:21.733

如果您使用的是 Windows，请查看[此链接](https://stackoverflow.com/questions/213392/what-is-the-win32-api-function-to-use-to-delete-a-folder)。否则，您可能会寻找您的操作系统特定版本的 api。我不认为 C++ 带有跨平台的方式来做到这一点。最后，这不是 C++ 的工作，而是操作系统的工作。

# ruby-on-rails - AASM 宝石被 Rails 2.3.2 破坏？

> ID：734718
> 
> 赞同：1
> 
> 时间：2009-04-09T15:26:23.720
> 
> 标签：ruby-on-rails, ruby, rubygems, aasm

有没有人在使用带有 Rails 2.3.2的[AASM](http://github.com/rubyist/aasm/tree/master)状态机 Gem 时遇到任何问题？它对我来说工作正常，但现在给出`NoMethodError`：

```
NoMethodError (undefined method `state' for #<Comment:0x25cb8ac>):
  /usr/local/lib/ruby/gems/1.8/gems/rubyist-aasm-2.0.5/lib/persistence/active_record_persistence.rb:231:in `send'
  /usr/local/lib/ruby/gems/1.8/gems/rubyist-aasm-2.0.5/lib/persistence/active_record_persistence.rb:231:in `aasm_read_state'
  /usr/local/lib/ruby/gems/1.8/gems/rubyist-aasm-2.0.5/lib/persistence/active_record_persistence.rb:135:in `aasm_current_state'
  /usr/local/lib/ruby/gems/1.8/gems/rubyist-aasm-2.0.5/lib/persistence/active_record_persistence.rb:156:in `aasm_ensure_initial_state'
 app/controllers/comments_controller.rb:12:in `create' 
```

这是我的模型中使用 AASM 的相关代码：

```
class Comment < ActiveRecord::Base
  include AASM
  belongs_to :post          
  after_create :spam_check

  aasm_column :state
  aasm_initial_state :submitted
  aasm_state :submitted
  aasm_state :approved
  aasm_state :rejected

  aasm_event :ham do
    transitions :to => :approved, :from => [:submitted, :rejected]
  end

  aasm_event :spam do
    transitions :to => :rejected, :from => [:submitted, :approved]
  end     

  private          
  def spam_check
    # Invoke Askismet to see if the comment is spam...
  end
end 
```

请注意，我的表`state`中有该列`comments`。

*   任何想法为什么它不再起作用？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T21:56:30.350

嗯，您需要在评论表中添加一个名为“状态”的字段。您使用`aasm_column :state`. 这不是 Rails 2.3.2 的错误！:D

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T15:39:04.097

从[aasm 主页](http://rubyi.st/aasm/)看来，在撰写本文时，即将有更新......

[关于Ruby on Rails 小组](http://groups.google.com/group/rubyonrails-talk/browse_thread/thread/709e918b40d7d4e8/69b63a0dc88541c2?lnk=gst&q=aasm#69b63a0dc88541c2)有一些讨论——我不知道这是否有帮助。

执行

```
gem list .*aasm --remote 
```

扔了一堆参考资料：

```
aasmith-yodlee (0.0.1.20090301132701)
bloom-aasm (2.0.3)
bloom-bloom-aasm (2.0.3)
caleb-aasm (2.0.2)
dunedain289-aasm (2.1.3)
dvdplm-aasm (2.0.6)
eric-aasm (2.0.4)
factorylabs-aasm (2.0.5.2)
gvaughn-aasm (2.0.4)
lostboy-aasm (2.0.5.1)
mikowitz-aasm (2.0.6)
netguru-aasm (2.0.6)
notch8-aasm (2.0.5)
rubyist-aasm (2.0.5)
runcoderun-aasm (2.0.5.1)
snoozer05-aasm (2.0.2)
spicycode-aasm (2.0.0) 
```

它怀疑部分或全部“dvdplm-”、“factorylabs-”和“runco​​derun-”可能是 git fork。您可能会发现一个或多个解决了您的问题。

# dynamic-data - ASP.NET 动态数据向页面添加其他筛选条件

> ID：734741
> 
> 赞同：8
> 
> 时间：2009-04-09T15:30:05.740
> 
> 标签：dynamic-data, linqdatasource, asp.net-dynamic-data

我应该如何向动态数据 Web 应用程序添加额外的搜索/过滤条件？

我使用 Northwind 数据库创建了一个动态数据 Web 应用程序，并且我正在为员工表使用自定义页面（基于 ListDetails.aspx 页面模板）。我想向页面添加额外的搜索/过滤器/位置参数。默认情况下，where 参数集合是基于 FilterRepeater 控件动态创建的，该控件也是基于 Employee Table 具有的“外键”关系动态创建的。

在尝试添加其他搜索条件时，我已绑定到 GridView 的 LinqDataSource 的 Selecting 事件，并尝试将其他项目添加到 LinqDataSourceSelectEventArgs 的 WhereParameters 集合中。

问题是我无法指定需要执行哪种类型的比较。WhereParameters 集合只接受一个字符串和一个对象，但不接受如何比较它们。我真正想做的是添加到谓词代表的集合中......

我应该如何向此页面添加其他搜索条件？通过属性应用于 LINQ To SQL 实体（如果是，如何）？如果条件/标准不是基于实体本身，在这种情况下我将如何添加到搜索条件中？

**亚伦霍夫曼**

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T16:58:25.560

如果您想将自己的标准添加到 DD 未自动提供给您的应用程序中，则必须使用[DynamicDataFiltering](http://www.codeplex.com/DynamicDataFiltering)来执行此操作。DynamicData 本身目前不支持自定义过滤器和搜索。实施起来并不难。Josh Heyes 在这方面做得很好。

如果那不是您想要的，请回来

编辑：另外，如果您只是打算对显示的数据进行进一步过滤，您可以在没有 Josh 过滤项目的情况下在 Page_Init 中编写类似这样的内容：

```
GridDataSource.WhereParameters.Add(new Parameter("it.myColumn", TypeCode.Int32, myValue)); 
```

执行“in”或“contains”比这要复杂一些，并且需要 DynamicDataFiltering。

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2010-07-29T12:02:00.787

以下是 ASP.NET 4.0 中的工作原理：[http ://www.olegsych.com/2010/07/understanding-aspnet-dynamic-data-filter-templates/](http://www.olegsych.com/2010/07/understanding-aspnet-dynamic-data-filter-templates/)

# c++ - 锁定焦点并捕捉到特定窗口

> ID：734751
> 
> 赞同：0
> 
> 时间：2009-04-09T15:32:36.467
> 
> 标签：c++, mouse, cursor, capture, setfocus

我可以使用切换机制调用 setfocus 和 setcapture，并在 OnLButtonDown 中确保消息不会被传递，但在您左键单击时似乎失败了。有什么办法可以确保有捕获和焦点的窗口不会放弃它？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-10T01:50:45.217

对于颜色选择器，请尝试阅读[这篇](http://www.codeproject.com/KB/GDI/screencolorpicker.aspx)关于从屏幕上的任何位置获取颜色的文章。

[这](http://www.codeproject.com/KB/applications/colour.aspx)是一个更完整的实用程序，让您为所欲为。不同之处在于在组合键 [Alt+Ctrl+P] 上捕获停止，您希望在单击时停止。

在第二个链接中，以下函数调用将对您有用：

```
SetWindowPos(&wndTopMost, 0, 0, 0, 0, SWP_NOMOVE | SWP_NOSIZE);
RegisterHotKey(m_hWnd, 0x1FEB, MOD_CONTROL | MOD_ALT, 0x50); 
```

第一个使窗口保持活动状态，第二个寄存器 Alt+Ctrl+P （当按下它时，窗口将收到一个 WM_HOTKEY 事件，您可以在此停止捕获颜色）。遗憾的是，您不能将 RegisterHotKey 与鼠标按钮一起使用。您将需要查看[SetWindowsHookEx](http://msdn.microsoft.com/en-us/library/ms644990(VS.85).aspx)

使用 SetWindowsHookEx，您可以确保您的应用程序即使没有焦点也能接收事件。使用钩子“WH_MOUSE”调用 SetWindowsHookEx 以及[Mouse Procedure](http://msdn.microsoft.com/en-us/library/ms644988(VS.85).aspx)。

在此过程中，您将收到鼠标消息，停止捕获鼠标移动的位置（锁定颜色），并使用 SetWindowPos 将窗口移动到顶部。[然后用UnhookWindowsHookEx](http://msdn.microsoft.com/en-us/library/ms644993(VS.85).aspx)取消注册你的钩子。

这是你可能需要学习的很多东西，但是我链接到你的所有 MSDN 页面都有很多信息可以帮助你，更不用说你是否愿意使用组合键而不是第二个链接非常适合您。

希望有帮助。

# c++ - 您将如何设计一个完美哈希的函数？

> ID：734754
> 
> 赞同：10
> 
> 时间：2009-04-09T15:33:19.990
> 
> 标签：c++, c, string, function, hash

感兴趣的领域是字符串匹配。假设我有这样的结构。

```
typedef struct
{
    char *name,
    int (*function)();

} StringArray

StringArray s[] = 
{
    {"George", func1},
    {"Paul",   func2},
    {"Ringo",  func3},
    {"John",   func4},
    {"",       NULL}   /* End of list */ 
} 
```

数组中有固定数量的字符串。如示例中所示，它们是硬编码的。如果表发生变化，则需要重新评估散列函数的质量。

我想将哈希函数应用于字符串，如果字符串与数组中的一个匹配，则调用该函数。为此需要一个完美的哈希函数。不允许冲突。要求散列的目的是在查找时获得 O(1) 性能。

你对设计一个功能来做到这一点有什么想法？

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T16:10:29.433

摘要列出了 C 和 C++。你在找他们中的哪一个？C 和 C++ 是两种不同的语言，它们的字符串处理和数据结构有很大不同（C 语言在 C++ 中工作的事实并没有改变这一点）。

为什么，具体来说，你想要一个完美的散列函数？您是否想将字符串与函数相关联，并认为这是一种好方法？这是某种家庭作业吗？你有理由不在 C++ 中使用 map<> 吗？（或 unordered_map<> 如果可用？）

如果您确实需要一个完美的哈希，那么字符串的约束是什么？会有某个固定的系列你想派发吗？与其中一个集合不匹配的字符串怎么办？您是否愿意接受来自随机字符串的命中，或者传入字符串的数量是否有限？

如果您可以编辑您的问题以包含此类信息，我们可能会更有帮助。

编辑（回应前两条评论）：

好的，我们应该看看 C 解决方案，因为您可能希望在您的 C 和 C++ 工作中都使用它。您大概想要性能，但是您测试过吗？如果我们正在处理进入 I/O 系统的字符串，那么那里的时间可能会使调度时间相形见绌。

您期待任意字符串。期望一个完美的哈希函数可以避免来自随机数据的所有冲突有点过分，因此您确实需要考虑这一点。

你有没有考虑过[trie](http://en.wikipedia.org/wiki/Trie)？它可能比完美的哈希函数更有效（或者可能不是），它应该很容易在 C 中实现，并且可以避免重做调度字符串列表或可能的冲突的问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2011-01-01T17:32:27.010

这个练习的最终结果是

*   从网上窃取许多面向字符串的哈希函数。
*   构建一种工厂类，使用一系列 mod 运算符值针对数据集测试每个函数，寻找适用于该函数的最小完美哈希。
*   该工厂类默认构造函数返回一个字符串，它表示一组参数，在使用时选择正确的哈希函数，以及 mod size 以提供需要最少内存的完美哈希。
*   在正常使用情况下，您只需使用返回的参数实例化类，然后类将自身置于具有所需功能的工作状态。
*   该构造函数验证没有冲突并中止（如果有）。
*   在没有找到完美哈希的情况下，它会降级为跨输入表的排序版本的二进制搜索。

对于我在我的域中拥有的一组数组，这似乎工作得非常好。未来可能的优化是对输入的子字符串进行相同类型的测试。在示例案例中，每个音乐家姓名的第一个字母足以区分他们。然后需要平衡实际散列函数的成本与使用的内存。

我感谢所有贡献想法的人。

邪恶的

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T15:35:58.267

你可以使用地图

```
std::string foo() { return "Foo"; }
std::string bar() { return "Bar"; }

int main()
{
   std::map<std::string, std::string (*)()> m;
   m["foo"] = &foo;
   m["bar"] = &bar; 
} 
```

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T15:41:26.507

如果*绝对*不允许冲突，您唯一的选择是跟踪数据库中的每个字符串，这可能不是最好的方法。

我要做的是应用现有的一种常见的强哈希算法，例如：MD5 或 SHA。周围有大量样本，例如： http: [//www.codeproject.com/KB/security/cryptest.aspx](http://www.codeproject.com/KB/security/cryptest.aspx)

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T16:03:27.237

使用平衡二叉树。然后你*知道*行为总是 O(logn)。

我非常不喜欢哈希。人们没有意识到他们的算法承担了多大的风险。他们运行一些测试数据，然后在现场部署。我从未见过部署的哈希算法在现场检查行为。

O(log n) 代替 O(1) 几乎总是可以接受的。

* * *

## 回答 #6

> 赞同：-1
> 
> 时间：2009-04-09T15:41:49.877

好吧，没有完美的哈希函数。

您有几个可以最大限度地减少碰撞，但没有一个可以消除它们。

虽然不能建议一个：P

编辑：解决方案不能找到完美的散列函数。解决方案是注意碰撞。通常散列函数有冲突。这显然取决于数据集和生成的哈希码的大小。

# c# - 最佳外部 REST API 访问模式？

> ID：734755
> 
> 赞同：3
> 
> 时间：2009-04-09T15:33:29.913
> 
> 标签：c#, rest, design-patterns, decorator

我参与了几个与 Facebook 和 Netflix 等外部服务连接的项目。目前，我用来访问这些 API 的大多数库（包括我自己编写的库）都有单一方法，因此调用特定的 API 函数但似乎总是调用某种基本方法来发出请求。像这样的东西：

```
public class ExternalApi
{
    public string SendMessage( criteria )
    {
         //do something unique to this method with criteria like
         //like generating an xml statement or fql query

         return SendRestRequest( modifiedCriteria );
    }

    public string GetData( criteria )
    {
         //do something unique to this method with criteria like
         //like generating an xml statement or fql query

         return SendRestRequest( modifiedCriteria );
    }

    public string SendRestRequest( modifiedCriteria )
    {
         //add global things to modifiedCriteria like authentication bits
         //or wrapping the criteria in some xml or json shell

        var request = new HttpRequest();
        //make the request, return data
    }
} 
```

所以我的问题是在这里使用更好的模式或 OO 主体，所以在每个单一的 API 调用方法中，我不是每次都显式调用基本方法？

我正在寻找某种调用拦截模式，例如 ASP.NET MVC 框架和 ActionResults 吗？

编辑 1：我不希望使用任何其他服务或库（如 Wcf）的功能。对于这些项目，我只使用了这些 API 功能的 1-5%，并且更喜欢为这些东西滚动我自己的代码。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T15:40:45.277

这是一个很好的示例：

MSDN 上的[REST 和 POX](http://msdn.microsoft.com/en-us/library/aa395208.aspx)

还可以查看 CodePlex 的[WCF REST Starter Kit Preview 2](http://aspnet.codeplex.com/Release/ProjectReleases.aspx?ReleaseId=24644)，应该有与 REST 客户端相关的编码示例

在这里：[Windows Communication Foundation (WCF) 中的 REST](http://msdn.microsoft.com/en-us/netframework/cc950529.aspx)

这一个也可能有帮助：[REST API 的示例客户端库](http://msdn.microsoft.com/en-us/library/dd179456.aspx)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T22:55:35.793

我必须为我的一项学位作业组装一个 REST 客户端。我采用分层方法并尝试应用外观模式来抽象细节

```
interface HTTPRequest{
  public void get();
  public void post();
  public void put();
  public void delete();
} 
```

HTTPRequest 提供了基本的 HTTP 功能，然后我创建了 RestClient

```
interface RestClient{
  public void create();
  public void read();
  public void update();
  public void delete();
} 
```

这给了我一个更像 CRUD 的界面。然后我所做的是构建一个基本的 RestClient 类，可以将其子类化以添加自定义功能。每个函数都有一个相应的回调函数，它在将数据返回给调用者之前调用它。这被命名为“createResultProcessor”之类的东西，可以覆盖在 RestClient 的子类中，以提供自定义结果解析等。

从来没想过我会这么说，因为我一生都制作了足够多的 UML 图，但确实可以使用一些 UML 图工具！

# flash - Flash Actionscript 3 和振荡对象 Alpha 动画

> ID：734758
> 
> 赞同：0
> 
> 时间：2009-04-09T15:34:57.630
> 
> 标签：flash, actionscript-3, animation

我将如何通过 Flash 中的 Actionscript 制作动画，如下所示？：

我的舞台上散布了几个带有随机 Alpha 值的正方形。当电影加载时，我希望每个方块都能平滑地动画到它们当前的 alpha 值为零，然后到 1，并无限期地重复循环。

作为奖励，我希望在继续循环之前能够在 alpha=1 时让每个正方形停顿一段时间。

我从一个在线教程中收集到，我应该将我的正方形（ImageTile）设置为一个对象：

```
package {

    import flash.display.*;
    import flash.events.*;

    public class ImageTile extends MovieClip {

        var tileAlpha = this.alpha;

        public function ImageTile() {
            // construct here
            this.addEventListener(Event.ENTER_FRAME, AnimateTile);
        }

        function AnimateTile(e:Event) {
            // animation to go here
        }

    }

} 
```

...但是我想做的事情的数学使我无法理解。任何帮助将不胜感激！

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T16:02:55.083

也许是[溶解](http://livedocs.adobe.com/flex/3/langref/mx/effects/Dissolve.html)效果或[淡入淡出](http://livedocs.adobe.com/flex/3/langref/mx/effects/Fade.html)（两者都带有页面底部的示例和代码）。我相信您会希望这些效果按顺序播放（可能不需要在 ActionScript 中对其进行编码）。然后为了让它保持在 alpha=1，我会在效果中添加一个事件并检查它的 alpha 值，然后设置延迟或暂时暂停动画。我运行了一个简单的测试，只是为 alpha 值设置动画，它似乎工作。

您可以将 repeatCount 设置为 0 以无限期地播放效果，并设置 repeatDelay 以使其保持最终的 alpha 值（那么您可能不必添加任何额外的事件处理程序）。

```
var eff : Dissolve = new Dissolve();
eff.alphaFrom = ...;
eff.alphaTo = 0;
// set repeatCount & repeatDelay if necessary
eff.play([list of targets]); 
```

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T19:21:32.220

好的，所以我设法使用两个计时器大致弄清楚我想要什么：

```
package {

import flash.display.MovieClip;
import flash.events.*;
import gs.TweenLite;
import fl.motion.easing.*;
import flash.utils.Timer;

public class ImageTile extends MovieClip {      

    public function ImageTile() {
        var atimer:Timer = new Timer(Math.floor(Math.random()*20*1000),1);
        atimer.addEventListener(TimerEvent.TIMER, initSquares);
        atimer.start();
    }

    function initSquares(e:Event) {
        //trace("should be 15 of these, no more!");
        var timer:Timer = new Timer(10000);
        timer.addEventListener(TimerEvent.TIMER, fade);
        timer.start();
    }

    function fade(e:Event) {
        TweenLite.to(this, 2, {alpha:Math.random()});
    }

}

} 
```

基本上，我的主要要求是每个方块都以固定的间隔进行淡入淡出动画，并且它们都不会在相同的时间间隔内进行。我确信这并不像它可能的那样干净，所以任何重构都会受到赞赏。

我还会注意到我正在使用 TweenLite 库进行渐变。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T23:32:24.410

您可能可以摆脱计时器，但老实说，它不会改变太多。

```
import fl.motion.easing.*;

import flash.display.MovieClip;
import flash.events.*;
import flash.utils.Timer;
import flash.utils.setInterval;
import flash.utils.setTimeout;

public class ImageTile extends MovieClip {              

    public function ImageTile() 
    {
        flash.utils.setTimeout(initSquares, Math.floor(Math.random()*20*1000);
    }

    function initSquares() 
    {
            flash.utils.setInterval(fade, 10000);
    }

    function fade() 
    {
            TweenLite.to(this, 2, {alpha:Math.random()});
    }

} 
```

# c# - OO 设计 - 您在内部使用公共属性还是私有字段？

> ID：734760
> 
> 赞同：6
> 
> 时间：2009-04-09T15:35:43.043
> 
> 标签：c#, oop, coding-style

我正在使用 C# 2.0，但这适用于大多数面向对象的语言。当我创建具有包含私有字段的公共属性的类时，我会在是否应该在内部使用该属性或字段之间来回切换。当然，C# 3.0 使用自动属性使这更容易，但它仍然适用。

有关系吗？

```
public class Person
{
    private string _name = "";

    public string Name
    {
        get { return _name; }
        set { _name = value; }
    }

    public Person(string name)
    {
        _name = name; //should I use the property or field here?
    }
} 
```

* * *

## 回答 #1

> 赞同：14
> 
> 时间：2009-04-09T15:42:14.570

基本上，因为您可以在属性中实现验证和其他逻辑，所以您应该通过属性访问，除非您有特定的理由不这样做。

它有助于您的对象内的一致性，因为这样您就知道您的私有字段的值已经经历了您选择放入访问器或设置器方法的任何严格要求。

另一方面，构造函数可能是一个例外，因为您可能想要设置初始值。

但总的来说，我会说通过财产访问。

**编辑**

一个（琐碎/人为的）示例

```
public class Person
{
    private string _name = "";
    private List<String> oldnames = new ArrayList();

    public string Name
    {
        get { return _name; }
        set 
        {
           oldnames.Add(_name);
           _name = value; 
        }
    }

    public Person(string name)
    {
        _name = name; //should I use the property or field here?
    }
} 
```

因此，在这种情况下，您可能希望构造函数跳过该属性，但如果您再次使用该字段，您将在代码中导致错误，因为您正在跳过“名称归档”。将验证放在您的属性中的原因是您不需要在访问该字段的每个地方都复制验证代码，因此即使在私有方法中也不应该跳过它。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T15:39:19.883

大多数情况下，它就像代码偏好，但我更喜欢使用公共属性或私有属性，您可以简单地向属性添加一些逻辑，而无需对调用者代码进行任何更改。同样在 3.5 .NET 中，您有有用的代码糖作为自动属性。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T15:39:44.280

我建议使用该物业，您永远不知道何时可能在您的物业内做某事。如果您使用私有成员，延迟加载、转换、格式化、计算等会引入错误......

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T16:25:15.687

如果使用字段名称，则不会得到封装。封装不仅适用于类之间，也适用于类内。

如果在将来的某个时间点，您重新定义该字段但保持访问器/设置器函数的签名相同，则不仅使用您的类的外部类不会中断，而且您自己类中的内部例程也不会中断。

以这段代码为例，它松散地基于 Apache Wicket 框架中显示的代码（尽管该框架没有遇到这个问题；我只是用它来说明）：

假设这是原始类：

```
class RadioChoice {
  private String prefix;

  RadioChoice( String prefix ) {
    this.prefix = prefix ;

  setPrefix( String prefix )  {
    this.prefix = prefix ;
   }
} 
```

在这里我们已经可以看到一个问题：相同的操作`this.prefix = prefix`发生在两个地方。它的目的是做完全相同的事情，但由于它发生在两个地方，“同一件事”可以分成两个不同的事情。（将此与数据库规范化进行比较，这是一种旨在防止这种情况发生的做法。）

现在，Apache Wicket 有一个记录如何呈现网页的更改的概念，以便可以撤消这些更改。它通过存储“撤消”对象的列表来做到这一点。RadioChoice 的前缀是可以撤消的事情之一，因此“前缀”设置器必须记录更改：

```
class RadioChoice {
  private String prefix;

  RadioChoice( String prefix ) {
    this.prefix = prefix ;

  setPrefix( String prefix )  {
    // save the old prefix
    this.getPage().addChange( new PrefixChange( this.prefix ) );
    // set the new one
    this.prefix = prefix ;
   }
} 
```

现在看看会发生什么：因为构造函数直接设置了前缀，所以 ctor 没有保存任何更改。如果我们使用了 setter，ctor 会在重构后自动“做正确的事”。相反，我们必须重构 setter*和*ctor。

当然，我们的代码仍然不是最优的，实际上应该是这样的：

```
 setPrefix( String prefix )  {
    // save the old prefix
    this.getPage().addChange( new PrefixChange( this.getPrefix() ) );
    // set the new one
    this.prefix = prefix ;
   }
} 
```

* * *

Scott Meyers 有一系列关于此的文章，其中他主张（在具有自由函数的 C++ 中）一个类*只*公开原始函数（*原始函数：*除了类 iteslf 之外不可能的函数）并且所有可以组合的函数从原始函数中变成自由函数。这使得界面更精简，界面更稳定。

同样，如果您可以将类中的函数视为仅依赖于其原始接口，那么您拥有的灵活性就越大；特别是，这些功能可能会被移出班级。更一般地说，使用 setter 和 getter 可以使您免受更改的影响。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T15:41:50.733

使用属性。或者更好的是，如果您使用 C# 3.0 或更高版本，请使用自动属性，如下所示：

```
public class Person
{
    public string Name { get; set; }

    public Person(string name)
    {
        Name = name; //should I use the property or field here?
    }
} 
```

如果您现在使用该属性，您将在修改代码以使用自动属性时做好准备。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T15:58:59.897

在某些情况下，您必须在内部访问该字段。例如，当您只公开提供对属性的只读访问权限并且不允许在实例化对象后更改值时。

```
public class MyClass
{
    private string _MyProperty;

    public MyProperty { get { return _MyProperty; } }

    public MyClass ()
    {
        _MyProperty = SomeVeryComplexPropertyInitializationLogic ();
    }
} 
```

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T15:40:00.990

通常我会使用公共属性，但有一些例外，我可能希望避免在属性访问器中编写任何额外的代码。使用 C#3.0 中的自动属性，我很少手动创建支持字段；通常仅当自动支持字段的默认值不适合我的属性时。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T15:40:11.847

至少在 Java 中，没有办法使用公共字段，因为每个人似乎都在使用旧的 JavaBeans 约定。我猜 C# 具有作为第一语言结构的属性。我会去的

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T15:40:29.473

您应该使用“名称”（属性），因为如果您想对该值进行一些检查，您可以将其放入“名称”属性的设置器中，然后将用于构造函数和最近的设置值。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-09T15:42:48.360

这取决于。有时，您会编写 getter/setter，为与该字段的任何实际交互进行重要的预处理。例如，如果字符串字段具有必须始终为小写的约束，那么您的 getter/setter 方法中至少有一个必须调用 .ToLower() 或 .ToLowerInvariant()，并且在您的类代码中，您可能希望使用它来确保强制执行约束。

但是，有时您也需要绕过该预处理逻辑。事实上，我曾见过开发人员通过使用公共属性而不是私有字段无意中创建了无限循环（我想不出一个例子，抱歉）。

我认为 Linq To SQL 生成的类是一个很好的例子，因为它们显示了属性中可以存在多少逻辑。尝试编写一些扩展方法，您将开始了解其中的区别。

I think the bottom line is that it depends on what kind of logic you are using at any given point in the class, and what kind of preprocessing exists in the getters/setters. If you are ever unsure or it seems like it doesn't matter, it is probably better to use the getters/setters/public Property so that you write more maintainable code that will follow constraints added later.

# css - 这个 CSS 是被接受和定义明确的，还是容易失败的 hack？

> ID：734761
> 
> 赞同：2
> 
> 时间：2009-04-09T15:35:46.023
> 
> 标签：css

用 CSS隐藏`<br />`标签是否是一种明确定义的方式，可以根据标签的 CSS 样式的定义进行换行？它可以跨浏览器移植吗？当我希望它显示时，“内联”是最好的显示类型吗？

给定以下 CSS 和 HTML，

```
<style type="text/css">
  .maybe-hidden {display:inline}
</style>

abra<br class='maybe-hidden' />
ca<br class='maybe-hidden' />
dabra<br class='maybe-hidden' /> 
```

我希望看到：

```
abra
ca
dabra 
```

将可能隐藏的更改为`maybe-hidden {display:hidden}`，我希望看到

```
abracadabra 
```

编辑：

我很欣赏有关如何更好地做到这一点的答案。我可能没有说的是，这将在生成的 HTML 中，并且正如一些人所建议的那样，更改实际元素的 CSS 类是不可行的。

但是更改样式的定义是可行的，更改*父/封闭/包含*HTML 元素的类也是可行的。

这就是为什么我需要知道这是否定义明确。虽然我将接受一个回答该问题的答案，但这绝不意味着我认为建议改变班级的答案是“错误的”；在我的情况下，它们是不可行的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T15:41:32.700

就个人而言，我认为最好创建两个 CSS 类（例如，“隐藏”和“显示”），然后动态更改 DOM 元素的类。

如果您担心一次更改所有 <br> 标签，可以使用基于其容器的选择器：

CSS：

```
.hidden maybe-hidden
{
    display: none;
}

.shown maybe-hidden
{
    display: inline;
} 
```

HTML：

```
<div class="shown">
    abra<br class='maybe-hidden' />
    ca<br class='maybe-hidden' />
    dabra<br class='maybe-hidden' />
</div> 
```

然后用 JS 改变`div`.

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T15:42:42.683

我不会使用这种有条件地插入换行符的方法。如果有可能是单行或多行，请不要使用用于换行和防止换行的 HTML 元素，而是使用预期的 CSS。这可能是：

```
<span class="first">abra</span>
<span class="second">ca</span>
<span class="third">dabra</span> 
```

并使它们成为`display:inline;`or `display:block;`。

您也可以使用浮点数，但这会导致诸如清除浮点数之类的副作用，这对您的特定情况没有任何帮助。最好使用正确的（语义）HTML 标记、正确的类名和 CSS 来获得您需要的标记。

另请参阅：[http](http://tantek.com/log/2002/12.html) ://tantek.com/log/2002/12.html了解有关此主题的一些想法。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T15:39:30.710

您可以简单地完全删除“显示：内联”。括号之间没有任何内容将使您的类“未定义”并赋予 <br> 标签其通常的含义。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T15:43:42.883

它应该可以在浏览器中正常工作。不过，我根本不会为该课程设置任何默认显示：

```
.maybe-hidden-show { /* display:default; */ }
.maybe-hidden-hide { display: none; } 
```

I include the obviously invalid `display:default` in comments in the `-show` class to express the intent of the class (use the element's default `display`).

Then you can just swap the class on the element using jQuery or plain JavaScript.

# java - com.liferay.util.PwdGenerator

> ID：734785
> 
> 赞同：2
> 
> 时间：2009-04-09T15:41:19.457
> 
> 标签：java, liferay

快速提问：

我需要将什么 jar 添加到 com.liferay.util.PwdGenerator 的类路径中？我已经尝试了一些，但还没有找到一个有效的。

谢谢

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T15:51:09.480

util-java.jar

# vb6 - Vista 上的 VB6 应用程序运行缓慢，带有大量“FAST IO DISALLOWED”

> ID：734796
> 
> 赞同：0
> 
> 时间：2009-04-09T15:43:02.230
> 
> 标签：vb6, windows-vista, legacy-code

我有一个客户端正在运行他们在 Vista 上编写的自定义 VB 6 应用程序。该应用程序在 Vista 上安装并运行良好。但是，在一台 Vista PC 上，应用程序的加载和运行速度非常慢。我让 IT 运行了一个进程监控跟踪，我看到了大量的“FAST IO DISALLOWED”结果以及其他问题。什么会导致“FAST IO DISALLOWED”，我该如何解决？请参阅下面的部分跟踪：

更新：似乎应用程序加载正常，但在打开报告等时运行缓慢。

更新：我有一个工作正常的 PC 的踪迹。但是，我相信缓慢是因为他们离开了 ODBC 跟踪。有很多这样的：

```
10:06:30.7641621 AM Cert.exe    2940    WriteFile   C:\Users\clw\AppData\Local\Temp\SQL.LOG SUCCESS Offset: 15,622,144, Length: 4,096, I/O Flags: Non-cached, Paging I/O, Synchronous Paging I/O, Priority: Normal 
```

* * *

```
10:03:41.8117795 AM Cert.exe    2940    FileSystemControl   C:\Program Files    END OF FILE Control: FSCTL_FILE_PREFETCH
10:03:41.8120107 AM Cert.exe    2940    FileSystemControl   C:\Program Files\cert client    END OF FILE Control: FSCTL_FILE_PREFETCH
10:03:41.8132994 AM Cert.exe    2940    FileSystemControl   C:\Users    END OF FILE Control: FSCTL_FILE_PREFETCH
10:03:41.8135160 AM Cert.exe    2940    FileSystemControl   C:\Users\clw    END OF FILE Control: FSCTL_FILE_PREFETCH
10:03:41.8139291 AM Cert.exe    2940    FileSystemControl   C:\Users\clw\AppData\Local  END OF FILE Control: FSCTL_FILE_PREFETCH
10:03:41.8141457 AM Cert.exe    2940    FileSystemControl   C:\Users\clw\AppData\Local\Temp END OF FILE Control: FSCTL_FILE_PREFETCH
10:03:41.8143618 AM Cert.exe    2940    FileSystemControl   C:\Windows  END OF FILE Control: FSCTL_FILE_PREFETCH
10:03:41.8152178 AM Cert.exe    2940    FileSystemControl   C:\Windows\AppPatch END OF FILE Control: FSCTL_FILE_PREFETCH
10:03:41.8156104 AM Cert.exe    2940    FileSystemControl   C:\Windows\System32 END OF FILE Control: FSCTL_FILE_PREFETCH
10:03:41.8159341 AM Cert.exe    2940    FileSystemControl   C:\Windows\System32\en-US   END OF FILE Control: FSCTL_FILE_PREFETCH
10:03:41.8364376 AM Cert.exe    2940    CreateFile  C:\Users\clw\AppData\Local\Temp\~DF9022.TMP NAME NOT FOUND  Desired Access: Read Data/List Directory, Execute/Traverse, Read Attributes, Disposition: Open, Options: Non-Directory File, Complete If Oplocked, Attributes: N, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8365446 AM Cert.exe    2940    CreateFile  C:\Users\clw\AppData\Local\Temp\~DFD6E5.TMP NAME NOT FOUND  Desired Access: Read Data/List Directory, Execute/Traverse, Read Attributes, Disposition: Open, Options: Non-Directory File, Complete If Oplocked, Attributes: N, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8366473 AM Cert.exe    2940    CreateFile  C:\Users\clw\AppData\Local\Temp\~DFCFD9.TMP NAME NOT FOUND  Desired Access: Read Data/List Directory, Execute/Traverse, Read Attributes, Disposition: Open, Options: Non-Directory File, Complete If Oplocked, Attributes: N, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8458081 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\MSVBVM60.DLL   FAST IO DISALLOWED  
10:03:41.8458819 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\MSVBVM60.DLL   NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8460056 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\msvbvm60.dll    FAST IO DISALLOWED  
10:03:41.8465561 AM Cert.exe    2940    RegOpenKey  HKLM\System\CurrentControlSet\Control\SafeBoot\Option   REPARSE Desired Access: Query Value, Set Value
10:03:41.8465840 AM Cert.exe    2940    RegOpenKey  HKLM\System\CurrentControlSet\Control\SafeBoot\Option   NAME NOT FOUND  Desired Access: Query Value, Set Value
10:03:41.8466314 AM Cert.exe    2940    RegQueryValue   HKLM\SOFTWARE\Policies\Microsoft\Windows\safer\codeidentifiers\TransparentEnabled   NAME NOT FOUND  Length: 80
10:03:41.8466735 AM Cert.exe    2940    RegOpenKey  HKCU\Software\Policies\Microsoft\Windows\Safer\CodeIdentifiers  NAME NOT FOUND  Desired Access: Query Value
10:03:41.8503387 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\shimeng.dll FAST IO DISALLOWED  
10:03:41.8513365 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\shimeng.dll FAST IO DISALLOWED  
10:03:41.8524301 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\apphelp.dll    FAST IO DISALLOWED  
10:03:41.8525127 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\apphelp.dll    NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8526418 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\apphelp.dll FAST IO DISALLOWED  
10:03:41.8535673 AM Cert.exe    2940    RegOpenKey  HKLM\System\CurrentControlSet\Control\SafeBoot\Option   REPARSE Desired Access: Query Value
10:03:41.8535961 AM Cert.exe    2940    RegOpenKey  HKLM\System\CurrentControlSet\Control\SafeBoot\Option   NAME NOT FOUND  Desired Access: Query Value
10:03:41.8536132 AM Cert.exe    2940    RegOpenKey  HKLM\System\CurrentControlSet\Control\Session Manager\AppCompatibility  REPARSE Desired Access: Query Value
10:03:41.8536279 AM Cert.exe    2940    RegOpenKey  HKLM\System\CurrentControlSet\Control\Session Manager\AppCompatibility  NAME NOT FOUND  Desired Access: Query Value
10:03:41.8536435 AM Cert.exe    2940    RegOpenKey  HKLM\Software\Policies\Microsoft\Windows\AppCompat  NAME NOT FOUND  Desired Access: Query Value
10:03:41.8540884 AM Cert.exe    2940    RegQueryValue   HKCU\Software\Microsoft\Windows NT\CurrentVersion\AppCompatFlags\ShowDebugInfo  NAME NOT FOUND  Length: 256
10:03:41.8554647 AM Cert.exe    2940    QueryOpen   C:\Windows\AppPatch\AcLayers.dll    FAST IO DISALLOWED  
10:03:41.8563921 AM Cert.exe    2940    QueryOpen   C:\Windows\AppPatch\AcLayers.dll    FAST IO DISALLOWED  
10:03:41.8584068 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\USERENV.dll    FAST IO DISALLOWED  
10:03:41.8584865 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\USERENV.dll    NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8586292 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\userenv.dll FAST IO DISALLOWED  
10:03:41.8596784 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\Secur32.dll    FAST IO DISALLOWED  
10:03:41.8597688 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\Secur32.dll    NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8598876 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\secur32.dll FAST IO DISALLOWED  
10:03:41.8609065 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\WINSPOOL.DRV   FAST IO DISALLOWED  
10:03:41.8609847 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\WINSPOOL.DRV   NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8611001 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\winspool.drv    FAST IO DISALLOWED  
10:03:41.8621551 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\MPR.dll    FAST IO DISALLOWED  
10:03:41.8622367 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\MPR.dll    NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8623555 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\mpr.dll FAST IO DISALLOWED  
10:03:41.8635846 AM Cert.exe    2940    RegQueryValue   HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\DllNXOptions\MSVBVM60.DLL    NAME NOT FOUND  Length: 1,024
10:03:41.8640720 AM Cert.exe    2940    QueryOpen   C:\Windows\AppPatch\AcLayers.dll    FAST IO DISALLOWED  
10:03:41.8647012 AM Cert.exe    2940    QueryOpen   C:\Windows\AppPatch\AcLayers.dll    FAST IO DISALLOWED  
10:03:41.8652669 AM Cert.exe    2940    QueryOpen   C:\Windows\AppPatch\AcLayers.dll    FAST IO DISALLOWED  
10:03:41.8658389 AM Cert.exe    2940    QueryOpen   C:\Windows\AppPatch\AcGenral.dll    FAST IO DISALLOWED  
10:03:41.8671217 AM Cert.exe    2940    QueryOpen   C:\Windows\AppPatch\AcGenral.dll    FAST IO DISALLOWED  
10:03:41.8685097 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\UxTheme.dll    FAST IO DISALLOWED  
10:03:41.8685815 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\UxTheme.dll    NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8687057 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\uxtheme.dll FAST IO DISALLOWED  
10:03:41.8698204 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\WINMM.dll  FAST IO DISALLOWED  
10:03:41.8698927 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\WINMM.dll  NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8700262 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\winmm.dll   FAST IO DISALLOWED  
10:03:41.8710641 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\OLEACC.dll FAST IO DISALLOWED  
10:03:41.8711384 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\OLEACC.dll NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8712509 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\oleacc.dll  FAST IO DISALLOWED  
10:03:41.8731507 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\NETAPI32.dll   FAST IO DISALLOWED  
10:03:41.8732118 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\NETAPI32.dll   NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8733267 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\netapi32.dll    FAST IO DISALLOWED  
10:03:41.8744751 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\MSACM32.dll    FAST IO DISALLOWED  
10:03:41.8745411 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\MSACM32.dll    NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8746462 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\msacm32.dll FAST IO DISALLOWED  
10:03:41.8754788 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\VERSION.dll    FAST IO DISALLOWED  
10:03:41.8755423 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\VERSION.dll    NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8756391 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\version.dll FAST IO DISALLOWED  
10:03:41.8765001 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\sfc.dll    FAST IO DISALLOWED  
10:03:41.8765651 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\sfc.dll    NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8766658 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\sfc.dll FAST IO DISALLOWED  
10:03:41.8774055 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\sfc_os.DLL FAST IO DISALLOWED  
10:03:41.8774647 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\sfc_os.DLL NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8775795 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\sfc_os.dll  FAST IO DISALLOWED  
10:03:41.8787514 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\dwmapi.dll FAST IO DISALLOWED  
10:03:41.8788140 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\dwmapi.dll NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a
10:03:41.8789108 AM Cert.exe    2940    QueryOpen   C:\Windows\System32\dwmapi.dll  FAST IO DISALLOWED  
10:03:41.8809343 AM Cert.exe    2940    QueryOpen   C:\Windows\AppPatch\AcLayers.dll    FAST IO DISALLOWED  
10:03:41.8814584 AM Cert.exe    2940    QueryOpen   C:\Windows\AppPatch\AcGenral.dll    FAST IO DISALLOWED  
10:03:41.8819923 AM Cert.exe    2940    QueryOpen   C:\Windows\AppPatch\AcLayers.dll    FAST IO DISALLOWED  
10:03:41.8824723 AM Cert.exe    2940    QueryOpen   C:\Windows\AppPatch\AcLayers.dll    FAST IO DISALLOWED  
10:03:41.8828336 AM Cert.exe    2940    QueryOpen   C:\Program Files\cert client\SHUNIMPL.dll   FAST IO DISALLOWED  
10:03:41.8828918 AM Cert.exe    2940    CreateFile  C:\Program Files\cert client\SHUNIMPL.dll   NAME NOT FOUND  Desired Access: Read Attributes, Disposition: Open, Options: Open Reparse Point, Attributes: n/a, ShareMode: Read, Write, Delete, AllocationSize: n/a 
```

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T15:49:53.243

您是否让 IT 在工作机器上运行相同的监视器作为控制测试？

我想你可能会发现快速 IO 失败是正常的（API 旨在首先尝试快速 IO，然后回退到更传统的失败方法）。无论哪种方式，这都将是机器配置问题（例如驱动程序问题）而不是编程问题。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T15:55:27.817

尝试重新安装 Microsoft VB6 运行时组件。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-28T20:43:51.137

他们让 ODBC 跟踪处于打开状态，这就是速度缓慢的原因。关闭 ODBC 跟踪修复它。谢谢大家。

# c++ - 模板类中函数的模板特化

> ID：734797
> 
> 赞同：4
> 
> 时间：2009-04-09T15:43:08.033
> 
> 标签：c++, function, templates, specialization

我有一个模板类，里面有一个模板函数（不同的模板参数），我在让编译器调用正确的函数时遇到问题。

例子：

```
template< class Parm1, class Parm2, class Parm3 >
class Class {
public:
   void   Func( Parm1 arg1, Parm2 arg2 ) {
      Call<Parm3>( arg1, arg2 ); 
   }

protected:
   template< class Type >
   void   Call( Parm1 arg1, Parm2 arg2 ) {
   }

   template<>
   void   Call<void>( Parm1 arg1, Parm2 arg2 ) {
   }
}; 
```

因此，如果 Parm3 的类型是“无效”，我希望调用第二个 Call。否则第一个。VS 它工作正常，但 GCC 到处都是。它总是调用第一个。现在这是在非专业类中专攻的问题，还是与我专攻“无效”这一事实有关

任何帮助都会很棒。谢谢。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T15:50:57.077

是的，在不完全特化所有外部模板的情况下显式特化一个函数是不可能的（显式函数特化是一个真正的函数——它周围不能有任何仍然由模板参数化的“变量部分”）

一种简单的方法是将 type2type 模板与重载一起使用：

```
template<typename T> struct t2t { typedef T type; };

void Func( Parm1 arg1, Parm2, arg2 ) { Call<Parm3>(arg1, arg2, t2t<Parm3>()); }
template< class Type, class V >  void Call( Parm1 arg1, Parm2 arg2, t2t<V>) { }
template< class Type >  void Call( Parm1 arg1, Parm2 arg2, t2t<void>) { } 
```

现在，如果你用 调用它，它将调用第二个`Call`重载`t2t<void>`，否则调用第一个，因为第一个不那么特别。

也可以使用[`enable_if`](http://www.boost.org/doc/libs/1_38_0/libs/utility/enable_if.html)：

```
void Func( Parm1 arg1, Parm2, arg2 ) { Call<Parm3>(arg1, arg2); }

template< class Type > typename disable_if< is_same<Type, void> >::type
Call( Parm1 arg1, Parm2 arg2) { }

template< class Type > typename enable_if< is_same<Type, void> >::type 
Call( Parm1 arg1, Parm2 arg2) { } 
```

现在，如果`Type`是 void，则采用第二个，如果`Type`再次是其他内容，则采用第一个。但是使用不同的技术。这个叫`SFINAE`。另一种方法，但又增加了一个参数，这是为了演示 SFINAE 的工作方式：

```
void Func( Parm1 arg1, Parm2, arg2 ) { Call<Parm3>(arg1, arg2); }

template< class Type >
void Call( Parm1 arg1, Parm2 arg2, char(*)[!is_same<Type, void>::value] = 0) { }

template< class Type > 
void Call( Parm1 arg1, Parm2 arg2, char(*)[ is_same<Type, void>::value] = 0) { } 
```

`SFINAE`如果模板参数的替换产生了无效的类型或构造，就会发生这种情况。下面，我们尝试分别创建一个指向大小为 0 或 1 的数组的指针。大小为 0 的数组无效，将导致 SFINAE 失败 - 如果它是函数，则相应的模板特化将不会被视为调用候选。

在上述`enable_if`情况下，它的工作方式不同。如果`enable_if`给出了从 派生的东西`false_type`，那么它会使其`::type`typedef 不存在。在案例类型不同的情况下[`is_same`](http://www.boost.org/doc/libs/1_38_0/libs/type_traits/doc/html/boost_typetraits/reference/is_same.html)派生自。`false_type`然后我们会尝试访问一个不存在的名称——这是一个无效的结构，因此也会导致 SFINAE 失败。

# c++ - C++ 中的定宽整数

> ID：734802
> 
> 赞同：19
> 
> 时间：2009-04-09T15:44:49.387
> 
> 标签：c++, c, visual-c++, types, portability

有时我需要使用固定宽度的整数与 PLC 等外部设备进行通信。我还使用它们来定义位掩码并执行图像数据的位操作。AFAIK C99 标准定义了固定宽度的整数，如 int16_t。但是我使用的编译器 VC++ 2008 不支持 C99 并且 AFAIK 微软不打算支持它。

我的问题是在 C++ 中使用固定宽度整数的最佳做法是什么？

我知道 VC++ 定义了像 __int16 这样的非标准固定宽度整数，但我对使用非标准类型犹豫不决。下一个 C++ 标准会定义固定宽度的整数吗？

* * *

## 回答 #1

> 赞同：18
> 
> 时间：2009-04-09T15:47:05.263

`#ifdef`您可以使用一些指令来解决问题。

```
#ifdef _MSC_VER
   typedef __int16 int16_t
#else
   #include <stdint.h>
#endif 
```

* * *

## 回答 #2

> 赞同：12
> 
> 时间：2009-04-09T15:52:39.867

Boost 具有所有 C99 类型和更多类型的 typedef： [“Boost integer library”](http://www.boost.org/doc/libs/1_38_0/libs/integer/index.html)

* * *

## 回答 #3

> 赞同：7
> 
> 时间：2009-04-09T15:50:31.353

包含该文件`<stdint.h>`以获取类型的定义，例如`uint16_t`. VC++ 默认不附带`<stdint.h>`，但您可以从多个地方获取该文件。 [维基百科](http://en.wikipedia.org/wiki/Stdint.h#Downloads)列出了一些，谷歌会找到更多。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-09T15:50:38.687

> 下一个 C++ 标准会定义固定宽度的整数吗？

是的。

正如 Mehrdad 所说，您`#ifdefs`现在可以使用。另一种选择是一些精心制作的模板魔术。Boost 在这个方向上有了一些东西，[Boost Integer library](http://www.boost.org/doc/libs/1_38_0/libs/integer/index.html)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T16:09:54.630

我使用了`stdint.h`mingw 包中提供的 Danny Smith 的公共领域（不是 GPL - 真正的公共领域）版本：

*   [http://www.mingw.org/download.shtml](http://www.mingw.org/download.shtml)

我不得不调整该版本以使用一些非 VC 8 编译器（主要是 VC6）进行编译——它对我很有帮助。

也许有一天我会在某个地方发布我的 VC6 兼容版本。更改非常小——只是一些宏技巧将 VC6 特定关键字用于 64 位类型。如果您不需要 VC6 支持，mingw 版本可能就是您所需要的。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T15:52:30.537

有不同的路径可供选择。大多数环境会认为`short int`s 是 16 位，而`long int`s 是 32 位。（`long`当您简单地`int`声明.`typedef``short int`

另一种可能性在于结构中的位字段。你可以这样说：

```
struct x {
    int a : 16;
    int b : 5;
    ...
}; 
```

等等。如果您随后定义：

```
struct x myvar;
myvar.a = 54; 
```

您可以确定 myvar.a 将保存 16 位，而 myvar.b 将使用 5；myvar 的总大小四舍五入为所有位组成，当然还有任何其他字段的大小。

# software-update - 新软件修订通知工具

> ID：734805
> 
> 赞同：2
> 
> 时间：2009-04-09T15:46:32.253
> 
> 标签：software-update

我想知道是否有任何项目可以创建一个标准，以一种易于聚合的方式订阅软件更新通知（例如 RSS 提要？），以便轻松检查数十或数百个软件项目我'对新版本感兴趣。

[**编辑：** 移动了以前在这里[的问题的另一半]](https://stackoverflow.com/questions/735445/)

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T15:53:34.047

[Appcast是](http://connectedflow.com/appcasting/)[Sparkle](http://sparkle.andymatuschak.org/)和[AppFresh](http://metaquark.de/appfresh/)等工具使用的一种选项。还有[PAD](http://www.asp-shareware.org/pad/)，它更倾向于应用程序描述而不是更新提要。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2016-05-01T09:46:07.143

您可以使用[Touchpine](https://touchpine.com/)订阅您感兴趣的应用程序，并通过列出所有新版本的每日电子邮件摘要接收更新。还有一个 API 允许您将其集成到您的软件或自动化工具中。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2014-03-24T11:20:00.470

[UpdateNode](http://www.updatenode.com)非常新鲜，是管理更新的良好 Web 2.0 解决方案。客户端是跨平台的，完整的解决方案对开源免费。

# database - 另一个多对多场景

> ID：734806
> 
> 赞同：1
> 
> 时间：2009-04-09T15:46:47.213
> 
> 标签：database, many-to-many, relational

我的数据库模型中有 2 个需要多对多关系的特定表。表格是`Systems`和`Users`。一个用户可以是多个系统的成员，一个系统中有多个用户。

`system_id`是系统表`user_id`中的PK，是用户表中的PK。我将它们链接`system_id`为用户表中的 FK。我似乎无法在两者之间找到一张桌子。我有形成一个`system_user`表并在其中使用两个外键的想法，但看不到它是如何工作的。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T15:50:11.807

你答对了。为多对多关系使用映射表。您的系统或用户表中不需要任何外键列。您的映射表将包含 MappingID PK、SystemID 和 UserID 之类的内容。您也可以将一整行设为 PK，但这是不必要的（如果您不想使用 MappingID）。然后，只需在此表中插入将系统与用户关联的对。您可以通过 SystemID 或 UserID 选择以获取某个实体具有的所有关系。您还可以包含映射可能具有的任何元数据，例如建立关联的日期。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T15:56:24.803

你正朝着正确的方向前进。

创建一个表“system_user”：

```
CREATE TABLE system_user (system_id INT NOT NULL, user_id INT NOT NULL); 
```

这不是严格关系建模意义上的实体，因此它不需要主键。但是，如果您的方案需要，您可以添加一个。

要获取系统中的所有用户，您可以这样查询：

```
SELECT u.* FROM user u, system_user su WHERE su.system_id = ? 
```

要获取用户可以访问的所有系统，您可以这样查询：

```
SELECT s.* FROM system s, system_user su WHERE u.user_id = ? 
```

希望这可以帮助！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T15:53:20.707

```
系统 System_User 用户        
------ ------------ ----
 *system_id ---> *system_id             
  数据 *user_id <--- *user_id
                                       数据

* 表示主键列
---> 表示 PK/FK 关系

```

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T15:50:06.050

你在正确的轨道上。您的新 system_user 表至少有 3 列：

*   systemuser_id - 主键
*   user_id - 用户表的外键
*   system_id - 系统表的外键

# wpf - 您如何让 Silverlight 调整文本内容的大小以适合？

> ID：734809
> 
> 赞同：16
> 
> 时间：2009-04-09T15:49:20.187
> 
> 标签：wpf, silverlight, silverlight-2.0, font-size

我有一个用户控件（如下），我将文本绑定到数据源并实例化了一堆用户控件。

我希望文本的大小尽可能大，仍然适合控件的范围。在 Windows 编程中，我可以通过减小字体大小来测量文本大小，直到它适合目标尺寸。

**在 Silverlight 中有什么方法可以做到这一点吗？**

我知道我*大概*可以以类似的方式做到这一点，但是有没有“更好”的方法呢？

```
<Grid x:Name="gdBubble" Width="180" Height="95">
    <Ellipse x:Name="elBubble" Fill="#FFFFA300" />
    <TextBlock x:Name="txtContent" Text="{ Binding ClientName }" HorizontalAlignment="Center" VerticalAlignment="Center" />
</Grid> 
```

[我在这里使用网格以使文本块正确居中。]

**答案正如 Rich 所描述的那样使用 Viewbox。**

这是获胜的配置（对我而言）：

```
<Grid x:Name="gdBubble" Width="180" Height="95">
    <Ellipse x:Name="elBubble" Fill="#FFFFA300" />
    <controls:Viewbox Margin="10,10,10,10" VerticalAlignment="Stretch" Height="Auto">
        <TextBlock x:Name="txtContent" FontSize="18" Text="{ Binding ClientName }" HorizontalAlignment="Center" VerticalAlignment="Center" />
    </controls:Viewbox>
</Grid> 
```

* * *

## 回答 #1

> 赞同：21
> 
> 时间：2009-04-09T16:22:45.473

昨天有人问了一个类似的问题，关于根据容器大小自动调整内容大小。这种情况下的答案是一样的：使用 Viewbox。如果您将 TextBlock 放在 Viewbox 内，TextBlock 将自行调整大小以仅使用它需要的空间，并且 Viewbox 将处理将其拉伸到容器的尺寸。使用拉伸属性从四种拉伸方法之一中进行选择。

看看昨天的这个帖子：

[随窗口改变大小的WPF Gui？](https://stackoverflow.com/questions/729534/wpf-gui-that-changes-size-with-window/729743#729743)

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T15:54:34.557

尝试使用[Dockpanel](http://www.silverlightshow.net/items/Using-the-DockPanel-in-Silverlight-2.aspx)而不是 Grid。使用 LastChildFill=true 应该可以获得您正在寻找的行为。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T17:16:48.120

您是否研究过变换 ScaleTransform？

ib。

# asp.net - 跨线程使用 HTTPContext

> ID：734821
> 
> 赞同：13
> 
> 时间：2009-04-09T15:51:30.057
> 
> 标签：asp.net, multithreading, httpcontext

用户点击页面 spawn.aspx，然后生成六个线程，渲染页面全部使用

```
 ((System.Web.IHttpHandler)instance).ProcessRequest(reference to spawn's HTTPContext); 
```

不要担心 ASP.Net 似乎向用户发送 1 个请求的 7 个响应这一事实，该部分已处理并且只发送一个响应。

问题是，在具有许多线程（quad-quads）的高流量环境（我们的生产环境）中，我们得到一个错误：

> ```
> System.IndexOutOfRangeException 
> at System.collections.ArrayList.Add 
> at System.Web.ResponseDependencyList.AddDependencies(String[] items, String argname, Boolean cloneArray, DateTime utcDepTime) 
> at System.Web.ResponseDependencyList.AddDependencies(String[] items, String argname, Boolean cloneArray, String requestVritualPath)
> at System.Web.UI.Page.AddWrappedFileDependencies(Object virtualFileDependencies) 
> at ASP.spawned_page_no_1_aspx.FrameworkInitialize()
> at System.Web.UI.Page.ProcessRequest 
> ```

我们不能在其他地方复制它。我的同事认为这是因为我重用了原始 HTTPContext 并将其传递给其他线程，并且它不是线程安全的。

按照这个逻辑，我尝试制作一个新的 HTTPContext 来传递给线程。但它的某些部分似乎不会“合并”。具体来说，我需要将 Session 对象放入新的 HTTPContext。我想我也想加入其他部分，比如缓存。对于记录 HTTPContext.Current.Session.IsSynchronized 是假的。

我的问题是：

1.  您认为错误是由于跨线程使用 HTTPContext 造成的吗？
2.  我该如何解决？
3.  如果修复是为每个线程复制 HTTPContext，我怎样才能将会话（和缓存）放入新的线程中？Request 和 Response 在 ctor 中，但 Session 不可设置。

**编辑：更多细节**

所以回到这个声明：“不要担心 ASP.Net 似乎为 1 个请求向用户发送了 7 个响应，该部分被处理并且只发送一个响应。” Raymond Chen 的超级粉丝，我同意你的观点：“现在你有两个问题”在没有更多信息的情况下是一个合理的说法。

实际发生的是，我正在构建一个 Excel 文档以发回。在 spawn.aspx 页面中，它设置了一些状态信息，包括它正在渲染到 excel 的事实，以及要渲染到的对象。每个生成的页面都会获取该信息，并且会一直阻塞，直到轮到它们呈现给对象。如果字面上看起来像这样：

```
 protected override void Render(System.Web.UI.HtmlTextWriter writer)
 {
    if (this.RenderToExcel)
    {
      Deadlocker.SpinUntilCurrent(DeadLockToken);
      RenderReport(this, this.XLSWriter);
      Deadlocker.Remove(DeadLockToken);
    }
    else
      base.Render(writer);
 } 
```

但到那时为止的所有处理——数据库访问、控制层次结构，所有这些都是并行完成的。并且有很多 - 足以将它并行化同时仍然让它在 Render 上阻塞将把总时间减少一半以上。

最好的部分是 - 无需为 Excel 渲染重写任何内容。所有控件都知道如何将自己呈现为 excel，并且您可以独立访问每个生成的页面（这实际上是“正常情况” - excel 报告只是所有生成页面的聚合。）

所以我认为最终结果将是“你不能这样做，你需要重新考虑方法”——但我至少必须尝试一下，因为事实上一切都运行得非常好，无需复制任何逻辑或任何代码或必须抽象任何东西真是太完美了。而且只有多线程才是问题所在，如果我连续渲染页面一切都很好，只是速度很慢。

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T22:29:36.357

虽然 HttpContext 旨在处理不是特定于线程的上下文（因为 http 上下文可以在一个线程上开始并在另一个线程上结束），但它并不是隐式线程安全的。

本质上问题是您正在做一些不打算做的事情，这些请求通常是多个请求，每个请求都有自己分配的 HttpApplication 来完成请求，并且每个请求都有自己的 HttpContext。

我真的会尝试让 asp.net 基础设施自己委托请求。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T15:57:35.580

你的同事是对的，如果一个线程锁定了一个资源而另一个线程试图使用它，那么你的线程池就会繁荣起来！结果不是很好。大多数人通过创建新对象并将它们传递给参数化线程来解决这个问题。如果你绝对需要使用同一个对象，那么你必须实现一些代码，首先检查资源是否被另一个线程使用，然后等待一段时间再检查。一个示例是创建一个您始终首先检查的 IsInUse 布尔值，然后如果它正在使用该资源，则您的线程将其设置为 true，然后在完成时将其设置为 false，以防止其他线程尝试使用底层资源（您的 httpContext） . 我希望这有帮助。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-11T03:29:26.437

由于 HttpContext 是 .Net 库的一部分，我希望所有静态函数都是线程安全的，但在针对对象的同一实例调用时，任何非静态成员都不是线程安全的。所以希望下次你会预料到跨线程共享 HttpContext 实例会有问题。

有没有一种方法可以将需要并行执行的操作与 HttpContext 分离？如果他们只是加载数据并写入 CSV 格式，那么该代码对 ASP.NET 用户控件或页面生命周期没有必要的依赖。删除该依赖项后，您可以使用异步 HttpHandler 实现页面，在 IHttpHandler.BeginProcessingRequest() 和 IHttpHandler.EndProcessingRequest() 之间运行并行操作。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2011-02-27T04:00:31.393

我会确保在您访问 HttpContext.Current.Items 集合时，您使用 HttpContext.Current.Items.SyncRoot 对象上的监视器锁 (C#)/SyncLock(VB) 块来包装您的调用。

# asp.net - 任何人都有解决 Internet Explorer 上“剩余 n 项”问题的想法吗？

> ID：734824
> 
> 赞同：31
> 
> 时间：2009-04-09T15:53:04.140
> 
> 标签：asp.net, jquery, css, internet-explorer, jquery-ui

在我的 ASP.Net 应用程序中，它是 javascript 和 jQuery，但也使用母版页和 .Net Ajax 片段，我一直在 IE 6（有时是 IE 7）的状态栏上看到消息“剩余 2 项”或“剩余 15 项”，然后是“正在加载*somegraphicsfile.png|gif* ”。此消息永远不会消失，并且可能会或可能不会阻止某些页面功能运行（它肯定似乎陷入困境，但我并不积极）。

只需刷新 .aspx 年龄，我就可以在 99% 的情况下导致这种情况发生，但是项目的数量，有时，它提到的文件会有所不同。通常是 2、3、12、13 或 15。

我用谷歌搜索了答案，有几个建议或解释。其中一些对我们没有用，而另一些对我们实施或尝试不切实际。

以下是一些想法/理论：

*   IE 没有正确缓存图像，因此如果图像在页面上重复，它会反复询问相同的图像，并且服务器假定它应该在本地缓存，因为它已经在该页面上下文中提供了它。IE 可以正确显示图像，但会坐下来等待永远不会出现的服务器响应。通常，它说它正在等待的文件会在页面上重复。

*   该页面使用具有透明度的 PNG 图形。确实如此，但它们是 jQuery-UI Themeroller 生成的图形，根据 jQuery-UI 人员的说法，它是 IE 安全的。jQuery-UI 组件是唯一使用 PNG 的东西。如果有帮助，我们所有的 PNG 引用都在 CSS 中。我已经将一些图形从 PNG 更改为 GIF，但很可能会说它正在等待*somegraphicsfile.png*和等待*somegraphicsfile.gif*

*   图像是在 CSS 和/或 JavaScript 中指定的，但在当前未显示的事物上（例如显示：无项目）。这*可能*是真的，但如果是这样，那么我认为预加载图像会起作用，但到目前为止，添加预加载器并没有任何好处。

*   IIS 的缓存策略使浏览器感到困惑。如果这是真的，那么只有微软服务器软件与微软的浏览器有问题（这一点都不让我感到惊讶）。不幸的是，我对托管应用程序的 IIS 配置没有太多控制权。

有没有人看到这一点并找到了对抗它的方法？特别是在带有 jQ​​uery 和 jQuery-UI 的 ASP.Net 应用程序上？

**更新**

另一个数据点：在至少一个页面上，仅注释掉 jQuery-UI Datepicker 组件设置会导致问题消失，但我不认为（或者至少我不确定）是否可以解决所有问题的页面。如果它确实“修复”了它们，我将不得不换掉插件，因为该功能需要在那里。目前在 IE6/7 上似乎没有针对 jQuery-UI 的任何未解决问题...

**更新 2**

*我检查了 IIS 设置，并没有*在我的任何文件夹上设置“启用内容过期” 。取消选中该设置是解决此问题的常见建议。

我有另一个更简单的页面，我可以始终在该页面上创建错误。我正在使用 jQuery-UI 1.6rc6 文件（尽管我也尝试过 jQuery-UI 1.7.1 并获得相同的结果）。仅当我刷新包含 jQuery-UI Datepicker 的页面时才会出现此问题。如果我注释掉 Datepicker 设置，问题就会消失。当我这样做时，我注意到以下几点：

1.  此页面始终显示“（剩余 1 项）下载图片 http:///images/Calendar_scheduleHS.gif”，但仅在重新加载时显示。
2.  当我查看 HTTP 日志记录时，我发现它每次动态打开时都会从服务器请求该图像，而不考虑缓存。
3.  该图形的所有请求都已完成并正确返回图形。没有一个标记为代码 200 或 304（表示服务器告诉 IE 使用缓存版本）。为什么它说在所有请求都完成后等待该图形，我不知道。
4.  页面上有一个其他图形（UI PNG 文件之一），其代码为 304（未修改）。在我设法记录“剩余 2 项”的 HTTP 流量的另一个页面上，两个不同的图形文件（两个 UI PNG）也有 304（但也没有列为“正在下载”的那个。
5.  这个错误不是无害的——页面没有完全响应。例如，如果我单击应该执行客户端操作的按钮之一，页面会刷新。
6.  离开页面并返回不会产生错误。
7.  我已将脚本和脚本引用移至内容底部，这不会影响此问题。该脚本仍在 $(document).ready() 中运行（除非我绝对必须这样做，否则它太毛茸茸了）。

**最终更新和答案**

下面有很多很好的答案和建议，但都不是我们的问题。最接近的一个（也是让我找到解决方案的那个）是关于长期运行的 JavaScript 的，所以我在那里奖励了赏金（我想我可以自己回答这个问题，但我宁愿奖励导致解决方案的信息） .

这是我们的解决方案：我们在 ASP.Net 母版页中包含的脚本中的 $(document).ready 事件上创建了多个 jQueryUI 日期选择器。在此客户端页面上，本地脚本的 $(document).ready 事件具有在某些条件下破坏日期选择器的脚本。我们不得不使用“destroy”，因为之前版本的 datepicker 有“disable”的问题。当我们升级到最新版本的 jQuery UI (1.7.1) 并将日期选择器的“destroy”替换为“disable”时，问题就消失了（或者大部分消失了——如果你在页面上做的事情太快了）正在加载，仍然可以获得“剩余n项”状态）。

我对发生的事情的理论是这样的：

1.  页面内容加载并有 12 个左右带有 datepicker 类的文本框。
2.  母版页脚本在这些文本框上创建日期选择器。
3.  IE 将每个日历图形的请求单独排队，因为 IE 不知道如何正确缓存动态图像请求。
4.  在处理请求之前，客户区脚本会销毁这些日期选择器，因此不再需要图形。
5.  IE 留下了一些它不知道如何处理的孤立请求。

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T18:31:49.033

如果您在代码中的任何地方使用行为（或您使用的库使用它们），例如

```
<style>
  body * {
    behavior:url(anyfile.htc);
  }
</style> 
```

然后没有我知道的**解决方案，并且****[在 IE 反馈中提交的关于连接](https://connect.microsoft.com/IE/feedback/ViewFeedback.aspx?FeedbackID=337678)**IE8（和 IE7）的错误报告被两个版本拒绝，并带有以下一揽子罐头声明：

> 这是 IE 中的一个已知错误，也发生在以前的 IE 版本中。您在状态栏中看到数百个请求的原因是 IE 试图为页面上的每个元素一遍又一遍地从磁盘读取 htc 文件。不幸的是，目前我们不打算解决这个问题。我们将在 IE 的未来版本中考虑这一点。
> 
> 最好的问候， IE 团队

由于这与 IE7 开发收到的回复相同，因此我不会屏住呼吸来**解决**这个问题。

**更新：**

基于您的更新说明的另一种想法。如果页面响应不是很灵敏，就好像它仍在加载一样，检查渲染的 DOM 内容是否有任何调用`document.write()` {您可能没有添加它们，但 lib 可能有}。

如果它们存在，请尝试`document.close();`在它们完成后添加一条语句，这将告诉浏览器您已“完成”渲染。

PS这里是一个可以保存为书签的链接（右键单击“添加到收藏夹...”），它将向您显示IE看到的生成的DOM（丑陋的quoteLess = CaMelCaSeMeSS）对结果进行搜索以找到任何可能导致问题的古怪代码。

IE Generated Source：（添加这个作为任何书签的位置，编辑器不会让我链接它）

```
javascript:'<xmp>'+window.document.body.parentNode.outerHTML+'</xmp>'; 
```

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-09T15:58:26.547

我之前也遇到过类似的问题，这是由于页面中间有一个长时间运行的 JS 片段，浏览器正在等待它完成执行，然后才能完成为站点下载附加文件。

我不确定这对你来说是否是一个问题，但它以类似的方式表现出来。

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T16:32:00.957

关于缓存图像，我必须使用 HTTP 处理程序来正确缓存图像。具体来说，CSS 菜单中有一个箭头图片，它会导致您正在处理的确切行为，因为它在每个菜单中被多次使用。

这是处理程序的代码：[http ://www.groovybits.com/SrcViewer.aspx?inspect=~/PersistantImage.ashx](http://www.groovybits.com/SrcViewer.aspx?inspect=~/PersistantImage.ashx)

您可以通过添加`AppSetting`in来使用它`web.config`：

```
<add key="UniqueImageName" value="~/Images/image_name.gif"/> 
```

并使用处理程序而不是图像本身的路径来引用每个图像的源：

```
~/Handlers/PersistantImage.ashx?key=UniqueImageName 
```

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-14T05:34:24.507

这与 IE 中透明 PNG 的“修复”有关。

我在正在处理的网站上遇到了同样的问题，很快发现没有有效的解决方案可以解决这个问题和透明 PNG 图像。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2010-04-14T01:09:10.483

这家伙有[一篇关于 IE6 缓存问题的精彩](http://www.zachleat.com/web/2008/10/18/dear-ie6-please-cache-my-images/ "亲爱的IE6：请缓存我的图片")文章，但博客似乎已关闭。

他将问题分为两部分：

1.  [IE6 背景图片闪烁](http://ajaxian.com/archives/no-more-ie6-background-flicker "不再有 IE6 背景闪烁")
2.  一个 IE 错误/功能：[运行 innerHTML 代码多次插入相同图像时不使用 Internet Explorer 缓存](http://support.microsoft.com/default.aspx?scid=kb;en-us;319546)。Microsoft 提出了两个非常糟糕的解决方法（在我的情况下，它们甚至都不起作用），但您也可以通过确保不`<img>`通过 innerHTML 插入标签来解决此问题。

问题 #2 的自然解决方案是使用`background-image`而不是`<img>`标签；阴险地，这将迫使您直接进入问题＃1；结果，你可能会打败问题 #2，错误地认为你没有取得任何进展。

就我而言，当我将`innerHTML` `<img>`标签替换`<div>`为具有`background-image` **并**用于`document.execCommand("BackgroundImageCache", false, true)`修复闪烁的标签时，我同时解决了这两个问题。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2011-01-20T20:45:29.930

我为我的大多数项目找到了解决方案。

我几乎在每个项目中都使用**jQuery Fancybox 插件。**如果您正在使用 Fancybox 并遇到**“剩余 x 个项目”**问题，那么解决方案如下：

在靠近文件末尾的 fancybox 的 css 文件中，有一堆 IE 过滤器可以让半透明 png 正确加载。像这样的东西：

```
.fancybox-ie6 #fancybox-close { background: transparent; 
filter: progid:DXImageTransform.Microsoft.AlphaImageLoader
(src='fancybox/fancy_close.png', sizingMethod='scale'); } 
```

您可以注意到 src 属性中的路径是错误的。

只需修复所有过滤器的路径（大约有 20 个），问题就会解决！

我建议放置一个相对于根的路径，如下所示：

```
.fancybox-ie6 #fancybox-close { background: transparent; 
filter: progid:DXImageTransform.Microsoft.AlphaImageLoader
(src='/css/fancybox/fancy_close.png', sizingMethod='scale'); } 
```

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2011-02-10T01:01:41.093

我通过执行以下操作解决了这个问题。这是一个黑客，但它的工作原理。

只需在 body 标签之后使用不可见的 IMG 标签加载您的图像。例如，

```
<body>
  <img src="problem_image_here.jpg" style="display:none">

  ...
</body> 
```

IE 似乎通过 css 加载相同的图像，此后没有任何问题。

# c# - 跨系统进程产生和交互

> ID：734832
> 
> 赞同：0
> 
> 时间：2009-04-09T15:54:48.393
> 
> 标签：c#, .net, networking, remoting

我有一个我正在开发的软件，它会在远程系统上生成短暂的进程来运行一些代码（主要是 SerialPort IO），这些代码可能会或可能不会与生成应用程序交互（但应该假设它会），然后将根据命令终止。

生成这样的远程进程的最佳方法是什么（PSExec？WMI？System.Diagnostics.Process 也许？） **在进程生成之后，我如何告诉它订阅它的主机？SO 社区对于基于事件/消息的基本通信流程框架有何建议？WCF 是否非常适合这项任务？远程处理会更容易吗？我在这里有什么选择？**

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T19:19:21.117

我不认为 System.Diagnostics.Process 允许在远程系统上启动进程。因此，WMI 或脱壳到 psexec 之类的东西可能是您在这里唯一的选择。

关于订阅/交互选项，是的，WCF 是要走的路。避免远程处理：它对一般情况没有任何好处，不再得到增强，并且由于各种原因而被弃用，取而代之的是 WCF（由于版本控制和状态考虑，基本上分布式对象变得令人头疼；消息传递通常是更容易设置，理解和维护。如果我没记错的话，远程处理也没有安全性）。为了进行设置，当父进程生成远程进程时，它可以将 URL 作为命令行参数传递。父级在该 URL 上托管 WCF 服务。现在，如果生成的进程需要与父进程通信/订阅父进程，它只需连接到给定的 URL。如果父需要发起通信，则使WCF服务双工，

# java - Java中的简单异常处理

> ID：734839
> 
> 赞同：2
> 
> 时间：2009-04-09T15:56:11.357
> 
> 标签：java, exception-handling

你能告诉我我的代码是否正确吗？我在两个小时内准备考试，所以我真的没有时间编写应用程序来测试它。

问题是：如果我有一个带有数字作为标签的 JLabel。例如，只是一个标有 34 的标签。我想从标签中提取数字。但我需要处理异常，即它不是一个数字，它可以是一个字母。

我下面的代码会正确处理异常吗？

```
JLabel label = new JLabel("34");
int extracted; 
```

这就是我要做的

```
try{
    extracted = Integer.parseInt(extracted.getText());
    System.out.println("the number was: "+ extracted);
}
catch(IOException exception){
    System.out.println(label.getText() + " is not a number");
} 
```

* * *

## 回答 #1

> 赞同：8
> 
> 时间：2009-04-09T16:02:09.703

关闭，但捕获 IOException 将不起作用，因为 parseInt() 方法不会抛出该异常类型。尝试捕获 NumberFormatException 代替：

```
try{
    extracted = Integer.parseInt(extracted.getText());
    System.out.println("the number was: "+ extracted);
} catch(NumberFormatException exception) {
    System.out.println(label.getText() + " is not a number");
} 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-09T15:58:34.157

我会检查[Integer.parseInt()的文档](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Integer.html#parseInt(java.lang.String))

此外，我强烈建议在您使用的任何 IDE 中设置一个测试项目，这样您就可以自己快速测试这些东西！即使它是一个 vim/javac+make 脚本。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T15:59:18.510

这几乎是正确的，只是你捕捉到了错误的异常；[parseInt()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Integer.html#parseInt(java.lang.String))抛出 NumberFormatException。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T15:59:39.180

[Integer.parseInt()](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/Integer.html#parseInt(java.lang.String))抛出[NumberFormatException](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/NumberFormatException.html)而不是[IOException](http://java.sun.com/j2se/1.5.0/docs/api/java/io/IOException.html)。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T16:08:34.413

NumberFormatException 是一个 RunTimeException （未选中），出于编译目的，您实际上不必将它写在 catch 部分。

如果您要做的是确定用户是否将在 JTextField 中键入数字（而不是任何其他字符），您应该查看正则表达式（正则表达式），而不是使用 try .. catch 机制来捕获这个。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T15:59:26.277

你应该抓住[`NumberFormatException`](http://java.sun.com/j2se/1.5.0/docs/api/java/lang/NumberFormatException.html)。否则，很好。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T16:01:20.953

[Integer.parseInt()](http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Integer.html#parseInt(java.lang.String))的javadoc声明它可以抛出 NumberFormatException，而不是 IOException。

您编写的代码不会编译，因为 IOException 是一个已检查的异常，try 块中的任何代码都不能抛出该异常。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T16:02:05.727

[http://java.sun.com/javase/6/docs/api/java/lang/Integer.html#parseInt(java.lang.String)](http://java.sun.com/javase/6/docs/api/java/lang/Integer.html#parseInt(java.lang.String))

你应该使用 NumberFormatException

[http://java.sun.com/javase/6/docs/api/java/lang/NumberFormatException.html](http://java.sun.com/javase/6/docs/api/java/lang/NumberFormatException.html)

# java - 如何禁用 JFace 菜单的所有图像但在工具栏中启用它们

> ID：734841
> 
> 赞同：0
> 
> 时间：2009-04-09T15:56:35.147
> 
> 标签：java, swt, jface

如果我创建了一组要在 JFace 应用程序中使用的操作并将图像分配给这些操作，那么这些图像会同时显示在工具栏（我想要它们的位置）和菜单中（我不想要它们的位置）。

除了提供两组完全独立的动作（首先消除了部分动作点）之外，我如何安排这些图像仅显示在工具栏中，而菜单仅显示文本？

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-09-25T19:17:44.540

我也遇到了这个问题（除了我想要工具栏和菜单的不同文本。）我最终使用了相同的操作，但它有两个不同的实例。

```
// Use this one in the menu
Action a = new Action();

// Use this one in the toolbar
Action a2 = new Action();
a2.setImageDescriptor(img); 
```

或者，您可以将图像描述符存储在工具栏版本的操作中，并将其设置为 null 以用于菜单版本。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T16:51:49.567

我自己没有检查过这个，但是给这个方法看看：

```
public int getStyle() { ... } 
```

它在 Action 类中定义，它似乎返回了 Action 以图形方式表示的界面元素的类型。那么你可以覆盖 getImageDescriptor() 方法：

```
public ImageDescriptor getImageDescriptor() {
    if (getStyle() == AS_DROP_DOWN_MENU)
        return null; // No icon in a menu
    return someImageDescriptor; // Actual icon
} 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-05-13T11:07:03.210

我最终基本上复制了动作，配对，一个有图像，一个没有，因此首先消除了动作的好处（叹气）。另一方面，由于每个动作都只是调用控制器中的一个方法来执行工作，所以它并不太隐蔽，将这些对组合在一起可以合理地清楚发生了什么。

# internet-explorer - IE8 探查器显示的 ActiveXObject 是什么

> ID：734844
> 
> 赞同：0
> 
> 时间：2009-04-09T15:57:36.530
> 
> 标签：internet-explorer, activex

我在网页上遇到错误，并使用顶部 ActiveXObject 的 IE8 分析器列表检查它，只有页面是 Apache 上的 PHP，没有任何嵌入式对象；我知道我已经检查了来源。

关于对象是什么的任何想法：- 托管页面的浏览器窗口？恶意代码？将某种类型的图像更改为可以托管它的 mime 类型的 activex 控件？

* * *

## 回答 #1

> 赞同：0
> 
> 时间：2009-04-09T16:52:49.923

我猜是一个 XMLHttpRequest。

检查您的脚本是否有 AJAX 调用。如果发生这种情况，您可能会考虑将 AJAX 代码更改为使用本机“new XMLHttpRequest()”接口，而不是使用旧的“new ActiveXObject('MSXML2.XMLHttp')”接口（IE7+）。

# windows - 调用_freea 真的有必要吗？

> ID：734854
> 
> 赞同：9
> 
> 时间：2009-04-09T15:59:38.913
> 
> 标签：windows, stack, memory-management

我正在使用 DevStudio 在 C/C++ 非托管的 Windows 上进行开发。

我想在堆栈而不是堆上分配一些内存，因为我不想手动释放该内存（我知道智能指针和所有这些东西。我需要一个非常具体的内存分配案例处理），类似于使用 A2W() 和 W2A() 宏。

**_alloca**这样做，但它已被弃用。建议改用***malloca*。但是 _malloca 文档说**每次调用 _malloca 都必须调用 ___freea。然后它破坏了我使用 _malloca 的目的，我将使用 malloc 或 new 代替。

任何人都知道我是否可以不调用 _freea 而不会泄漏以及内部影响是什么？

否则，我最终将只使用已弃用的 _alloca 函数。

* * *

## 回答 #1

> 赞同：16
> 
> 时间：2009-04-09T16:06:13.267

在每次调用 _malloca 之后调用 _freea 总是很重要的。

_malloca 类似于 _alloca，但为您的保护添加了一些额外的安全检查和增强功能。因此，_malloca 可以在堆而不是堆栈上进行分配。如果发生这种情况，并且您没有调用 _freea，您将遇到内存泄漏。

在调试模式下，_malloca 总是在堆上分配，所以也应该被释放。

搜索 _ALLOCA_S_THRESHOLD 以获取有关阈值如何工作的详细信息，以及为什么存在 _malloca 而不是 _alloca，这应该是有意义的。

* * *

编辑：

有评论表明该人只是在堆上分配，并使用智能指针等。

堆栈分配有一些优势，_malloca 将为您提供，所以有理由想要这样做。_alloca 将以相同的方式工作，但更有可能导致堆栈溢出或其他问题，不幸的是，它没有提供好的异常，而是倾向于仅仅拆除你的进程。_malloca 在这方面更安全，并且可以保护您，但代价是您仍然需要使用 _freea 释放内存，因为 _malloca 可能（但在释放模式下不太可能）选择在堆上而不是在堆栈上分配。

如果您的唯一目标是避免释放内存，我建议您使用智能指针，在成员超出范围时为您处理内存释放。这将在堆上分配内存，但要安全，并防止您不得不释放内存。不过，这仅适用于 C++ - 如果您使用的是普通的 C，这种方法将不起作用。

如果您出于其他原因尝试在堆栈上分配（通常是性能，因为堆栈分配非常非常快），我建议您使用 _malloca 并接受您需要在您的值上调用 _freea 的事实。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T17:10:24.187

另一件要考虑的事情是使用 RAII 类来管理分配——当然，这只有在您的宏（或其他）可以限制为 C++ 时才有用。

如果您出于性能原因想避免撞到堆，请查看 Matthew Wilson 的`auto_buffer<>`模板类 ( [`http://www.stlsoft.org/doc-1.9/classstlsoft_1_1auto__buffer.html`](http://www.stlsoft.org/doc-1.9/classstlsoft_1_1auto__buffer.html)) 使用的技术。这将在堆栈上分配，除非您的运行时大小请求超过编译器时指定的大小 - 因此您可以获得大多数分配的无堆分配速度（如果您正确调整模板大小），但如果超过那个尺寸。

由于 STLsoft 在处理可移植性问题上有很多麻烦，您可能希望查看`auto_buffer<>`Wilson 的书[“不完美的 C++”中描述的更简单的版本。](https://rads.stackoverflow.com/amzn/click/com/0321228774)

我发现它在嵌入式项目中非常方便。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T16:01:19.317

要在堆栈上分配内存，只需声明一个适当类型和大小的变量。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2013-08-22T10:54:37.127

我之前回答过这个问题，但我错过了一些基本的东西，这意味着它只能在调试模式下工作。我将对 _malloca 的调用移到将自动释放的类的构造函数中。

在调试中这很好，因为它总是在堆上分配。但是，在释放时，它在堆栈上分配，并且在从构造函数返回时，堆栈指针已被重置，并且内存丢失。

我回去采用了不同的方法，结果结合使用宏 (eurgh) 来分配内存并实例化一个将自动在该内存上调用 _freea 的对象。由于它是一个宏，它被分配在同一个堆栈帧中，因此实际上可以在释放模式下工作。它和我的课一样方便，但使用起来略逊一筹。

我做了以下事情：

```
class EXPORT_LIB_CLASS CAutoMallocAFree
{
public:
    CAutoMallocAFree( void *pMem ) : m_pMem( pMem ) {}
    ~CAutoMallocAFree() { _freea( m_pMem ); }

private:
    void    *m_pMem;

    CAutoMallocAFree();
    CAutoMallocAFree( const CAutoMallocAFree &rhs );
    CAutoMallocAFree &operator=( const CAutoMallocAFree &rhs );
};

#define AUTO_MALLOCA( Var, Type, Length ) \
    Type* Var = (Type *)( _malloca( ( Length ) * sizeof ( Type ) ) ); \
    CAutoMallocAFree __MALLOCA_##Var( (void *) Var ); 
```

这样我可以使用以下宏调用进行分配，并且在实例化的类超出范围时释放它：

```
 AUTO_MALLOCA( pBuffer, BYTE, Len );
            Ar.LoadRaw( pBuffer, Len ); 
```

对于发布明显错误的内容，我深表歉意！

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2009-04-09T16:58:53.030

如果您担心必须释放临时内存，并且您对智能指针之类的东西了如指掌，那么为什么不使用类似的模式来释放超出范围的内存呢？

```
template <class T>
class TempMem
{
  TempMem(size_t size)
  {
    mAddress = new T[size];
  }

  ~TempMem
  {
    delete [] mAddress;
  }

  T* mAddress;
}

void foo( void )
{
  TempMem<int> buffer(1024);

  // alternatively you could override the T* operator..
  some_memory_stuff(buffer.mAddress);

  // temp-mem auto-freed
} 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2017-05-07T21:31:06.197

如果您正在使用，`_malloca()`那么您必须调用`_freea()`以防止内存泄漏，因为`_malloca()`可以在堆栈或堆上进行分配。如果给定大小超过_ALLOCA_S_THRESHOLD 值，它会在堆上分配。因此，`_freea()`如果分配发生在堆栈上，调用 which 不会做任何事情会更安全。

如果您使用`_alloca()`的似乎从今天开始已被弃用；`_freea()`由于分配发生在堆栈上，因此无需调用。

# interface - DDD：您对实体松散耦合的充分理由是什么？

> ID：734857
> 
> 赞同：2
> 
> 时间：2009-04-09T16:00:29.300
> 
> 标签：interface, domain-driven-design, loose-coupling

早在 12 月，就有一篇[帖子](https://stackoverflow.com/questions/352618/should-every-single-object-have-an-interface-and-all-objects-loosely-coupled)被回答为“可以使用具体类型 [用于简单对象]”。

但是我不断在示例项目中看到越来越多的带有接口的简单实体，甚至是我刚刚控制的非常大的企业应用程序（计数 89 个接口并且还在继续）。

是不是人们没有选择最好的方法，只是用“我的项目是松散耦合的！” 方法？

或者，我错过了什么。我可以对我拥有的 IService、IFactory 和 IRepository 实现使用具体类型进行单元测试（并且工作得很好）。我还在构建我的第一个“反腐败层”，用于从主域中抽象出许多这些 3rd 方工具。这个反腐败层有许多 Facades、Translators 和 Adapters - 所有这些都是松散耦合的（或计划是）。

那么，对于具有接口的实体，我是否遗漏了什么？

```
public interface IContent
{
  Int32 ContentID {get; set;}
}

IList<IContent> list = new List(); 
```

编辑：我还应该提到，我拥有的具有所有这些接口的企业应用程序具有零单元测试。哈哈

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T16:24:45.017

*与简单数据对象相比，具有责任*的实体符合接口更为重要。如果您可以根据方法定义实体，那么，是的，您将从接口中受益。我看不出一个在应用程序中仅用作 DTO 的对象通过具有接口获得任何巨大优势。

也就是说，在我看来，抽象出由第三方工具或像 L2S 这样的框架创建的“实体”肯定会带来好处。

# java - 使用 HashMap 的 put 方法时出现 NullPointerException

> ID：734861
> 
> 赞同：27
> 
> 时间：2009-04-09T16:00:58.520
> 
> 标签：java, hashmap, nullpointerexception

下面的代码给了我一个`NullPointerException`. 问题出在以下行：

```
... 
dataMap.put(nextLine[0], nextLine[6]); 
```

奇怪的是，我在没有上述行的情况下运行了这段代码，并且调用`nextLine[0]`并`nextLine[6]`完全按预期工作——也就是说，它们给了我一个 csv 文件的元素。`HashMap`我用代码声明并初始化

```
HashMap<String, String> dataMap = null; 
```

在方法的早期

```
 String[] nextLine;
  int counter=0;
  while (counter<40) {
    counter++;

    System.out.println(counter);
    nextLine = reader.readNext(); 
    // nextLine[] is an array of values from the line
    System.out.println(nextLine[0] + " - " + nextLine[6] +" - " + "etc...");
    dataMap.put(nextLine[0], nextLine[6]);
  }
  return dataMap;
} 
```

* * *

## 回答 #1

> 赞同：45
> 
> 时间：2009-04-09T16:05:53.733

```
HashMap<String, String> dataMap = new HashMap<String,String>(); 
```

此时您的`dataMap`变量尚未初始化。你应该得到一个编译器警告。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-09T16:04:28.933

数据图在哪里初始化？它始终为空。

为了澄清，您声明变量并将其设置为空。但是你需要实例化一个新的 Map，不管是 HashMap 还是类似的。

例如

```
datamap = new HashMap(); 
```

（撇开泛型等）

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T16:05:15.110

dataMap 已声明但未初始化。它可以用初始化

数据映射 = 新哈希映射（）；

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T16:05:32.300

好吧，在那条线上访问了三个对象。如果 nextLine[0] 和 nextLine[6] 不为空，因为上面的 println 调用有效，则剩下 dataMap。你做了 dataMap = new HashMap(); 某处？

* * *

## 回答 #5

> 赞同：0
> 
> 时间：2021-02-10T13:00:31.410

我的情况与通常不同，hashmaps 在尝试读取不存在的键时抛出空指针异常，例如我有一个

`HashMap<String, Integer> map = new HashMap<String, Integer>();`

哪个是空的或有除“someKey”之外的键，所以当我尝试

`map.get("someKey") == 0;`

现在，由于将 null 与某个整数匹配，这将产生一个 nullPointerExeption。

我应该怎么做？

Ans: 我应该检查 null 之类的

`map.get("someKey") != null;`

现在运行时错误 Nullpointer 不会引发！

* * *

## 回答 #6

> 赞同：-2
> 
> 时间：2009-04-09T16:06:12.750

嗯，当你这样做时，你到底期望**什么**？

```
HashMap<String, String> dataMap = null;
...
dataMap.put(...) 
```

# nhibernate - NHibernate：在 HQL 中返回一个常量

> ID：734864
> 
> 赞同：2
> 
> 时间：2009-04-09T16:01:32.060
> 
> 标签：nhibernate, hql

我需要从 NHIbernate 中的 HQL 查询中返回一个常量

```
SELECT new NDI.SomeQueryItem(user, account, " + someNumber + ") 
FROM NDI.SomeObject object 
```

我正在尝试类似上面的东西。我试过这个：

```
SELECT new NDI.SomeQueryItem(user, account, :someNumber) 
FROM NDI.SomeObject object 
```

然后后来：

```
.SetParameter("someNumber", 1).List<SomeQueryItem>(); 
```

但在第一种情况下，我得到一个“未定义的别名或未知的映射 1”。这是有道理的，因为它可能认为 1 是别名。

第二个我得到一个“未定义的别名或未知的映射：someNumber”，如果它从不设置参数，这又是有意义的。

我必须相信有某种方法可以做到这一点。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T16:06:06.573

请继续相信有一些方法可以做到这一点 - 但 HQL 没有！

你为什么还要呢？如果您想将此属性的值更新为您指定的值，请在加载对象后执行此操作。或者，如果您的结果集与您的对象不完全匹配，您总是可以使用 SQL 查询（您仍然可以通过 NHibernate 会话进行）。但是 NHibernate 的目的是将数据库中的内容映射到对象上，因此不允许像这样指定手动覆盖。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T16:30:35.143

听起来您的域对象和数据库模型之间存在（小？）脱节。创建一个小的“DTO”对象来弥补这个差距怎么样？

让您的查询返回 SomeQueryItemDTO （或任何您想称呼它的名称）的列表，由于命名，您知道它不是您的域的真实部分。然后有一些函数来处理列表并通过合并与数据库无关的数据来构建真正的 SomeQueryItem 对象列表。

如果您已经在使用存储库模式，这应该会更容易，因为所有丑陋的细节都隐藏在存储库中。

# svn - 颠覆入门

> ID：734880
> 
> 赞同：2
> 
> 时间：2009-04-09T16:06:49.753
> 
> 标签：svn, version-control

**重复..：**

*   [版本控制。开始吧……</a>](https://stackoverflow.com/questions/2658/version-control-getting-started)
[](https://stackoverflow.com/questions/2658/version-control-getting-started)
*   [如何开始使用 SVN？](https://stackoverflow.com/questions/35670/how-do-I-begin-using-svn)
*   [SVN安装](https://stackoverflow.com/questions/131367/svn-installation)
*   [最佳 SVN 工具](https://stackoverflow.com/questions/48992/best-svn-tools)
*   [Visual Studio 的颠覆插件？](https://stackoverflow.com/questions/453481/subversion-plugin-to-visual-studio)
*   [良好的 Visual Studio SVN 工具](https://stackoverflow.com/questions/372687/good-visual-studio-svn-tool)
*   [如何说服我的团队放弃 sourcesafe 并转向 SVN？](https://stackoverflow.com/questions/115493/how-do-I-convince-my-team-to-drop-sourcesafe-and-move-to-svn)

* * *

我们目前正在使用与 Visual Studio 集成的 SourceSafe，并且不断评论说 SourceSafe 显然有多糟糕，我决定我们应该尝试迁移到 Subversion。

问题是，除了 SourceSafe 之外没有使用任何东西，我需要从某个地方开始并需要一些指导。

我需要下载和安装什么软件？服务器？客户？

我需要在什么设备上安装软件？视窗 2003？

我应该有一个专用服务器还是现有的文件服务器就足够了？

开发人员能以多快的速度跟上进度？集成是否足够相似，可以正常进行？

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T16:08:08.317

让您的开发人员阅读免费的在线[红豆书](http://svnbook.red-bean.com/)。它非常棒，涵盖了流程的所有方面，可能包括您在任何地方都能找到的对分支的最佳描述。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T16:16:01.433

我发现 Pragmatic Programmer's Pragmatic Guide to Subversion 对于这个确切的场景非常有帮助。

[http://www.pragprog.com/titles/svn2/pragmatic-version-control-using-subversion](http://www.pragprog.com/titles/svn2/pragmatic-version-control-using-subversion)

有许多集成工具[——TortoiseSVN](http://tortoisesvn.tigris.org)是一个很好的文件系统级别控制工具。我并没有深入了解 Visual Studio 集成，但我听到了有关 AnkhSVN 的好消息。

现在使用现有的服务器可能没问题。SVN 服务器可以在任何 Windows 平台上运行。

非常值得花时间学习摆脱 SourceSafe。

祝你好运！

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-14T15:48:02.800

要回答您的问题：

**问：**我需要下载和安装什么软件？服务器？客户？
**答：**有许多适用于 Windows 的 Subversion 客户端，包括与 VisualStudio 集成的[AnkhSVN](http://ankhsvn.open.collab.net/)和一个在我们的客户端中非常受欢迎的[TortoiseSVN](http://tortoisesvn.tigris.org/)，它与 Windows 资源管理器集成。
在服务器端，如果您的公司政策允许，我建议使用托管解决方案。只需将“颠覆托管”放入 Google 并比较可用的提供商。如果没有，我建议从[Subversion 站点](http://subversion.tigris.org/)安装 Windows 二进制文件。

**问：**安装软件需要什么？视窗 2003？
**答：** Subversion 可通过上述链接在所有主要平台上使用，所以如果您是 Windows 商店，当然，Windows 2003 没问题。如果您是异构的，那么在 Linux 上的 Apache 后面配置它可能会更容易一些。Subversion 是有据可查的，并且有在所有平台上的配置说明。

**问：**我应该有一个专用服务器还是现有的文件服务器就足够了？
**答：**同样，我建议在外部托管而不是自己托管。任何值得使用的托管服务提供商都将提供以下优势：
*可通过 HTTPS 从任何地方安全访问（无需配置公司防火墙以在家或客户端站点工作）
*异地备份（无需为该专用服务器设置新的备份程序或您办公室的文件服务器）
*正常运行时间（无需担心盒子融化或遇到您的团队必须直接处理的其他问题）
*配置（基于 UI 的设置，而不必学习服务器端配置程序)
如果您的公司需要自己托管，并且文件服务器上有足够的空间，我会说使用现有服务器不是问题。如果您有一个方便的专用服务器，那么从不必与组织的其他部分“碰撞”假设它是共享资源的角度来看，这会更好。

**问：**开发人员能以多快的速度跟上进度？集成是否足够相似，可以正常进行？
**答：** Subversion 有一点学习曲线，但[Red Bean 书](http://svnbook.red-bean.com)的第 2 章以及客户文档解释了正常工作周期是如何进行的。如果您的开发人员熟悉 CVS，他们很快就会跟上进度。如果不是，则可能需要一些时间来习惯您不必锁定文件来处理它们的概念（Subversion 具有锁定机制，但它并非设计为标准工作周期的一部分） .

如果您有任何其他问题，请随时直接与我联系。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T16:10:03.817

要快速启动和运行，请考虑使用 VisualSVN Server。他们还为 Visual Studio 集成制作了一个不错的插件，它位于名为 TortoiseSVN 的 Windows 资源管理器集成实用程序的顶部。可悲的是它不是免费的（服务器虽然我似乎记得）。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T16:11:44.767

就工具而言：

*   颠覆服务器：[http ://subversion.tigris.org/](http://subversion.tigris.org/)

*   使用 VisualSvn 进行 Visual Studio 集成： http: [//www.visualsvn.com/](http://www.visualsvn.com/)

*   用于 Windows Explorer/Shell 集成的 Tortoise Svn：http: [//tortoisesvn.tigris.org/](http://tortoisesvn.tigris.org/)

在 Microsoft Team 做了一些小工作后，我开始使用 Svn，并且很快就掌握了它。学习如何使用分支和合并是迄今为止最难的部分。

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T16:12:25.280

要回答您的上述问题：

1.  服务器，以及每个开发人员的客户端软件
2.  应该适用于大多数操作系统
3.  取决于开发人员的活动/数量等。但从现有服务器开始
4.  啊! 这取决于您的开发人员:-) 但是创建/签入/签出等非常容易。但是在让其他人放松之前，我会阅读有关设置存储库的内容！

阅读红豆书的建议是无价的。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-09T16:16:06.987

首先下载颠覆。您不妨下载客户端/服务器安装，以获得所需的一切。

接下来在单独的机器上安装服务器端组件。Jeffs [Setting Up Subversion On Windows](https://blog.codinghorror.com/setting-up-subversion-on-windows/)文章是一本不错的读物。

在您的客户端机器上安装 TortoiseSVN。这将使您将 Explorer 集成到 SVN 存储库中，这非常有用[VisualSVN](http://www.visualsvn.com/)提供了与 Visual Studio 的集成并且很有用，尽管我一直发现 TortoiseSVN 对我自己来说已经足够了。

* * *

## 回答 #8

> 赞同：1
> 
> 时间：2009-04-09T16:32:39.223

对 SourceSafe 以外的任何东西都不熟悉，您已经决定使用 Subversion 了吗？那是明智的吗？也许您应该尝试几种不同的系统，看看哪一种最适合您。我衷心建议您尝试 svn 以及一个或多个分布式系统，例如 git、mercurial 等。如果你正在打破旧的方式，你应该自己检查你的选择。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T16:11:22.363

我建议你依赖命令行，svn 很简单。

```
>svn update 
```

从存储库更新您的本地副本

```
>svn commit -m"commit message" 
```

将本地更改提交到存储库

如果您创建新文件，则必须添加它们（否则它们不会被提交）：

> svn 添加文件1 文件2 ..

以我个人的经验，这比依赖一些 GUI 要简单得多。那里的任何 GUI 只会给相当简单的东西增加噪音和开销。

我的一些团队成员试图依赖 Eclipse 插件，但有时它会发疯。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-14T15:57:03.603

为什么选择颠覆？为什么不尝试一个分布式 VC，它对分支和合并有很好的支持？我建议您研究 mercurial 或 git。

# c# - Winform 的覆盖控制

> ID：734881
> 
> 赞同：1
> 
> 时间：2009-04-09T16:07:44.293
> 
> 标签：c#, winforms, overlay

是否可以在 Winform 的特定位置将控件（比如说富文本框或链接标签）覆盖在其他控件上？

我用 GDI+ 做了一些测试，但没有运气......

* * *

## 回答 #1

> 赞同：2
> 
> 时间：2009-04-09T18:14:04.957

您希望两者同时可见吗？如果是这样，请查看[为您的控件提供透明背景](http://msdn.microsoft.com/en-us/library/wk5b13s4(VS.71).aspx)。

如果只是将两个控件放在同一个位置并显示一个或另一个，您可以使用`Control.BringToFront()`and `.SendToBack()`，以及单独控制它们的可见性。

最后，如果您想在另一个控件上绘制文本，您可能需要考虑自己从另一个控件中绘制该文本 -[`TextRenderer`该类](http://msdn.microsoft.com/en-us/library/system.windows.forms.textrenderer.aspx)使这样做非常容易。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T16:15:52.667

您可以将一个控件放在另一个控件之上，但它会掩盖它下面的控件。某些控件（如 Label）支持透明背景，在这种情况下，它不会遮挡其下的控件。

# java - 在不受信任的客户端上保护 java 运行时数据

> ID：734887
> 
> 赞同：0
> 
> 时间：2009-04-09T16:09:54.647
> 
> 标签：java, security, encryption

我什至不确定这是否可能，但是在不受控制的客户端上保护端到端运行时数据是否可行？

具体来说，Java 中是否有任何功能可以接收加密数据，对其进行处理并将其加密发送回，而所有这些都不会以明文形式将数据暴露给对客户端具有完全访问权限的好奇的第 3 方？

此外，我知道代码混淆只是对具有反编译器的专用人员的烦恼，因此我假设对于这种情况，攻击方具有完整的源代码/操作知识。

无论哪种方式，我都对答案感兴趣。如果没有现成的功能，考虑到 Java 的架构是否可行？如果 Java 做不到，还有其他语言/平台可以吗？我担心这可能需要特殊的硬件。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T16:15:57.877

如果客户端没有被锁定，基本上不可能完全安全。在某些时候，字节将存在于内存中，并且该内存可以被恶意应用程序读取。

如果您的目标不是使其完全安全，而只是为随便好奇的人带来不便，那么请确保不要将数据写入临时文件或其他任何容易检查的地方。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T17:24:54.620

为了有机会做你所说的，你需要特殊的硬件。您不能在不安全层的“顶部”设置安全层。例如，如果攻击者完全控制了硬件，他总是可以破坏运行在该主机上的操作系统。

特殊硬件称为“可信平台模块”或 TPM。这支持远程证明，这将允许您验证客户端没有被篡改。TPM 的某些部分可用于许多计算机（例如我的戴尔笔记本电脑）。事实上，我认为美国联邦政府购买的所有计算机都必须有 TPM。然而，大多数消费者并没有启用 TPM，而且隐私倡导者对 TPM 有很多敌意。我也不确定有多少具有 TPM 的机器包含远程证明功能。

无论如何，底线是你不能给别人一个秘密和秘密的钥匙，并期望它保持秘密。你必须保持对整个堆栈的控制，从上到下。~~受信任~~的背叛计算允许您这样做，即使您没有合法拥有相关硬件。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-15T19:04:35.267

不仅“做不到”，而且“容易妥协”。

查看“面向方面的编程”和字节编译器类。这通常用于插入数据库事务、性能日志记录、日志记录语句（因此您可以从源代码中删除调用并使其更简洁）、访问控制（因此您将实现和授权分开）等。如果您可以悄悄地将一个类与另一个类包装起来，那么您可以做很多非常有用的事情。

但这也意味着包装你的类以捕获应用程序中所有未加密的消息、加密密钥等是微不足道的。我想即使你在一个漫长的过程中完成所有事情，我也可以进入，尽管可能需要更多时间努力。

# java - 聚合与组合

> ID：734891
> 
> 赞同：95
> 
> 时间：2009-04-09T16:10:37.140
> 
> 标签：java, oop, uml

我很难理解 UML 中组合和聚合之间的区别。有人可以给我一个很好的比较和对比吗？我也很想学习识别它们在代码中的区别和/或查看一个简短的软件/代码示例。

编辑：我问的部分原因是因为我们在工作中正在进行反向文档活动。我们已经编写了代码，但我们需要返回并为代码创建类图。我们只想正确捕获关联。

* * *

## 回答 #1

> 赞同：103
> 
> 时间：2013-02-05T21:25:00.123

根据经验： ![在此处输入图像描述](https://i.stack.imgur.com/WC2eJ.png)

```
class Person {
    private Heart heart;
    private List<Hand> hands;
}

class City {
    private List<Tree> trees;
    private List<Car> cars
} 
```

**在组合**（Person、Heart、Hand）中，“子对象”（Heart、Hand）会在 Person 被销毁后立即销毁。

**在聚合**(City, Tree, Car) 中，“子对象” (Tree, Car) 在 City 被销毁时不会被销毁。

**底线是，组合强调相互存在，而在聚合中，这个属性不是必需的。**

* * *

## 回答 #2

> 赞同：92
> 
> 时间：2009-04-09T16:37:10.570

聚合和组合之间的区别取决于上下文。

以另一个答案中提到的汽车为例 - 是的，汽车尾气确实可以“独立”站立，因此可能不会与汽车组成 - 但这取决于应用程序。如果您构建的应用程序实际上必须处理独立的汽车尾气（汽车店管理应用程序？），聚合将是您的选择。但如果这是一个简单的赛车游戏，而汽车尾气只是作为汽车的一部分——那么，构图就很好了。

棋盘？同样的问题。仅在某些应用程序中，没有棋盘就不存在棋子。在其他（如玩具制造商）中，棋子肯定不能组成棋盘。

当尝试将组合/聚合映射到您最喜欢的编程语言时，情况会变得更糟。在某些语言中，差异可能更容易注意到（“按引用”与“按值”，当事情很简单时），但在其他语言中可能根本不存在。

最后一句忠告？不要在这个问题上浪费太多时间。这不值得。这种区别在实践中几乎没有用（即使您有一个完全清晰的“组合”，由于技术原因，您可能仍希望将其实现为聚合 - 例如，缓存）。

* * *

## 回答 #3

> 赞同：64
> 
> 时间：2009-09-23T20:12:49.717

组合和聚合是关联的类型。它们密切相关，就编程而言，两者之间似乎没有太大区别。我将尝试通过java代码示例来解释这两者之间的区别

**聚合**：对象存在于另一个之外，在外部创建，因此它作为参数（例如）传递给构造函数。例如：人——汽车。汽车是在不同的环境中创建的，然后成为个人财产。

```
// code example for Aggregation:
// reference existing HttpListener and RequestProcessor
public class WebServer {
  private HttpListener listener;
  private RequestProcessor processor;
  public WebServer(HttpListener listener, RequestProcessor processor) {
    this.listener = listener;
    this.processor = processor;
  }
} 
```

**构图**：对象仅作为其他对象的一部分存在或仅在其他对象内部才有意义。例如：人——心。你不会创造一颗心，然后将它传递给一个人。相反，心是在人被创造的时候被创造出来的。

```
// code example for composition:
// create own HttpListener and RequestProcessor
public class WebServer {
  private HttpListener listener;
  private RequestProcessor processor;
  public WebServer() {
    this.listener = new HttpListener(80);
    this.processor = new RequestProcessor(“/www/root”);
  }
} 
```

这里用一个例子来解释[聚合和组合之间的区别](http://www.skill-guru.com/blog/2009/08/26/difference-between-aggregation-and-composition/)

* * *

## 回答 #4

> 赞同：36
> 
> 时间：2009-04-09T16:15:10.843

组合意味着子对象与父对象共享一个生命周期。聚合没有。例如，棋盘是由棋盘组成的——没有棋盘，棋盘就不会真正存在。但是，汽车是零件的集合体——如果当时不是汽车的一部分，汽车尾气仍然是汽车尾气。

* * *

## 回答 #5

> 赞同：19
> 
> 时间：2009-04-09T16:51:37.307

我学到的例子是手指到手。你的手是由手指组成的。它拥有它们。如果手死了，手指也会死。你不能“聚合”手指。你不能随便抓住多余的手指，随意将它们从你的手上取下来。

正如另一位海报所说，从设计的角度来看，这里的价值通常与对象的寿命有关。假设您有一个客户并且他们有一个帐户。该帐户是客户的“组合”对象（至少，在我能想到的大多数情况下）。如果您删除客户，则该帐户本身没有任何价值，因此它也会被删除。在创建对象时，通常情况正好相反。由于帐户仅在客户的上下文中有意义，因此您将创建帐户作为客户创建的一部分（或者，如果您懒惰地这样做，它将成为某些客户交易的一部分）。

在设计中考虑哪些对象拥有（组合）其他对象与仅引用（聚合）其他对象的对象是很有用的。它可以帮助确定对象创建/清理/更新的责任所在。

就代码而言，通常很难说清楚。代码中的大多数内容都是对象引用，因此引用的对象是组合（拥有）还是聚合可能并不明显。

* * *

## 回答 #6

> 赞同：19
> 
> 时间：2015-01-11T16:00:06.570

***令人惊讶的是，关于部分-整体***关联概念***聚合***和***组合***之间的区别存在多少混淆。主要问题是普遍存在的误解（甚至在专业软件开发人员和 UML 的作者之间），即组合的概念意味着整体与其部分之间的生命周期依赖关系，因此如果没有整体，部分就无法存在。但这种观点忽略了这样一个事实，即在某些情况下，部分与不可共享的部分之间存在关联，其中部分可以从整体中分离出来，并在整体的破坏中幸存下来。

在 UML 规范文档中，术语“组合”的定义一直暗示着不可共享的部分，但一直不清楚“组合”的定义特征是什么，什么仅仅是可选特征。即使在新版本（截至 2015 年）UML 2.5 中，在尝试改进术语“组合”的定义后，它仍然模棱两可，并且没有提供任何指导如何对不可共享的部分-整体关联进行建模部分可以与整体分离并在整体破坏中幸存的部分，而不是部分不能分离并与整体一起被破坏的情况。他们说

> 如果删除了复合对象，则它的所有作为对象的零件实例都将随之删除。

但同时他们也说

> 部分对象可以在复合对象被删除之前从复合对象中移除，因此不会作为复合对象的一部分被删除。

这种混淆表明 UML 定义的不完整，它没有考虑组件和组合之间的生命周期依赖关系。因此，重要的是要了解如何通过为 << ***inseparable*** >> 组合引入 UML 原型来增强 UML 定义，其中组件不能从它们的组合中分离，因此，只要它们的组合被破坏，就必须被破坏。

## 作品

正如[Martin Fowler 所解释](http://martinfowler.com/bliki/AggregationAndComposition.html)的，表征组合的主要问题是“一个对象只能是一个组合关系的一部分”。Geert Bellekens的优秀博文[UML Composition vs Aggregation vs Association](http://bellekens.com/2010/12/20/uml-composition-vs-aggregation-vs-association/)也解释了这一点。除了组合的这个定义特征（具有***独占***的或***不可共享***的部分）之外，组合还可能带有组合及其组件之间的生命周期依赖关系。事实上，这样的依赖有两种：

1.  每当一个组件***必须始终附加***到一个组合时，或者换句话说，当它具有***强制组合***时，如组合线的组合侧的“完全一个”多重性所表示的那样，那么它必须要么被重新使用在（或重新附加到）另一个复合体中，或在其当前复合体被破坏时被破坏。这可以通过 和 之间的组合来举例说明`Person`，`Heart`如下图所示。当它的主人去世时，心脏要么被摧毁，要么被移植给另一个人。
2.  每当一个组件***不能***从它的组合中分离出来，或者换句话说，当它是***不可分离***的，那么，只有这样，当它的组合被销毁时，该组件才必须被销毁。这种具有不可分割部分的组合的一个例子是 和 之间的`Person`组合`Brain`。

![人脑心](https://i.stack.imgur.com/OjBaI.png)

总而言之，生命周期依赖只适用于特定的组合情况，但并不普遍，因此它们不是一个定义特征。

UML 规范声明：“可以在组合实例被删除之前从组合实例中移除一部分，因此不会作为组合实例的一部分被删除。” 在一个`Car`-<code>Engine组合的例子中，如下图所示，很明显是在汽车被销毁之前，可以将引擎从汽车上分离出来的情况，在这种情况下，引擎没有被破坏，可以重新-用过的。这由合成线的复合侧的***零或一个***多重性暗示。

![在此处输入图像描述](https://i.stack.imgur.com/ns5sf.png)

The ***multiplicity*** of a composition's association end at the composite side is either 1 or 0..1, depending on the fact if components have a mandatory composite (must be attached to a composite) or not. If components are *inseparable*, this implies that they have a mandatory composite.

## Aggregation

An aggregation is another special form of association with the intended meaning of a part–whole relationship, where the parts of a whole can be shared with other wholes. For instance, we can model an aggregation between the classes `DegreeProgram` and `Course`, as shown in the following diagram, since a course is part of a degree program and a course can be shared among two or more degree programs (e.g. an engineering degree could share a C programming course with a computer science degree).

![在此处输入图像描述](https://i.stack.imgur.com/dkm9P.png)

***但是，具有可共享部分***的聚合的概念实际上并没有多大意义，因此它对实现没有任何影响，因此许多开发人员不喜欢在他们的类图中使用白色菱形，而只是建模一个简单的关联反而。UML 规范说：“共享聚合的精确语义因应用领域和建模者而异”。

聚合在整体侧的关联端的***多重***性可以是任意数量（*），因为一部分可能属于任意数量的整体，或在它们之间***共享。***

* * *

## 回答 #7

> 赞同：8
> 
> 时间：2009-04-09T17:07:50.013

用代码术语来说，组合通常表明包含对象负责创建组件*的实例，并且包含对象持有对它的唯一长期引用。因此，如果父对象被取消引用并被垃圾回收，那么子对象也将如此。

所以这段代码...

```
Class Order
   private Collection<LineItem> items;
   ...
   void addOrderLine(Item sku, int quantity){
         items.add(new LineItem(sku, quantity));
   }
} 
```

表明 LineItem 是 Order 的一个组件 - LineItem 在其包含的订单之外不存在。但是 Item 对象不是按订单构造的——它们是根据需要传入的，并且会继续存在，即使商店没有订单。所以它们是关联的，而不是组件。

* nb 容器*负责*实例化组件，但它实际上可能不会调用 new...() 本身 - 这是 java，通常首先要经过一两个工厂！

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T18:22:59.397

其他答案中提供的概念插图很有用，但我想分享另一点我发现有帮助的观点。

对于代码生成、源代码或关系数据库的 DDL，我已经取得了一些进展。在那里，我使用组合来指示一个表在我的代码中具有一个不可为空的外键（在数据库中）和一个不可为空的“父”（通常是“最终”）对象。我使用聚合，我希望记录或对象能够作为“孤儿”存在，不附加到任何父对象，或者被不同的父对象“采用”。

换句话说，我使用组合表示法作为简写来暗示在为模型编写代码时可能需要的一些额外约束。

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-29T02:19:15.410

我喜欢的例子： **组成：** 水是池塘的**一部分。**（池塘是水的组合物。） **聚合：** 池塘**有**鸭和鱼（池塘聚合鸭和鱼）

如您所见，我将“part-of”和“has”加粗，因为这两个短语通常可以指出类之间存在什么样的联系。

但正如其他人所指出的，很多时候连接是组合还是聚合取决于应用程序。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2013-11-01T11:44:28.833

很难区分聚合关系和复合关系，但我要举一些例子，我们有一个房子和房间，这里我们有一个复合关系，房间是房子的一部分，房间生活开始了with house life's and will finish when house life's done, 房间是房子的一部分，我们谈论构图，比如国家和首都，书籍和页面。以聚合关系为例，拿球队和球员来说，球员可以没有球队而存在，球队是一群球员，球员的生活可以在球队生活之前开始，如果我们谈到编程，我们可以创建球员，然后我们将创建球队，但是对于组合 no，我们在 house 内创建了 room s。合成---->合成|合成。聚合 --------> 组 | 元素

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2014-01-16T12:04:05.813

让我们设定条款。Aggregation 是 UML 标准中的一个元术语，表示组合和共享聚合，简称为*shared*。通常它被错误地命名为“聚合”。这很糟糕，因为组合也是一种聚合。据我了解，您的意思是“共享”。

进一步从 UML 标准：

> 复合 - 表示属性是复合聚合的，即复合对象负责组合对象（部分）的存在和存储。

因此，大学与大教堂协会是一个组合，因为大学不存在大教堂（恕我直言）

> 共享聚合的精确语义因应用领域和建模者而异。

即，如果您仅遵循您或其他人的某些原则，则所有其他关联都可以绘制为共享聚合。也看[这里](https://stackoverflow.com/a/21279410/715269)。

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2014-12-07T15:15:21.697

考虑人体部位，如肾脏、肝脏、大脑。如果我们尝试在这里映射组合和聚合的概念，它会像：

在肾、肝等身体部位移植出现之前，这两个身体部位是与人体组成的，不能与人体孤立存在。

但是在身体部位移植出现之后，它们可以移植到另一个人体中，因此这些部位与人体是聚合的，因为它们现在可以与人体隔离存在。

# asp.net-mvc - ASP.NET MVC 现在是“开源的”。这是一件好事吗？

> ID：734892
> 
> 赞同：7
> 
> 时间：2009-04-09T16:11:08.823
> 
> 标签：asp.net-mvc, open-source

这个问题只是在寻找关于**ASP.NET MVC 作为平台的方向的反馈**。我真的没有把它作为火焰诱饵发布。我的公司正在计划一项重大的 Web 应用程序投资，我们需要确定 ASP.NET MVC 是否是正确的方向。

===

*更新* **微软答案**

ASP.NET 开发负责人 Scott Guthrie 在他的博客上发表了这篇文章：

> **ASP.NET MVC 是一个免费的、*完全受支持*的 Microsoft 产品，它使开发人员能够使用模型-视图-控制器模式轻松构建 Web 应用程序**

因此，只要上述陈述为真，那么**ASP.NET MVC 就可以安全地部署在**.

ASP.NET MVC 在[Microsoft 公共许可证](http://www.opensource.org/licenses/ms-pl.html)(MS-PL) 下发布。MS-PL 是[OSI 批准的开源许可证](http://www.opensource.org/licenses/ms-pl.html)。MS-PL 不包含平台限制，并提供修改和重新分发源代码的广泛权利。

===

当 Microsoft 在开源 (MS-PL) 许可下发布 ASP.NET MVC 时，我的第一个想法是 MS 可能很快就会放弃对它的支持。有了这个想法，出于显而易见的原因，我不想投资掌握它。

我可能是错的，所以我想在做出任何可靠的决定之前得到一些反馈。

这是一件好事吗？

*更新*：

一位朋友就这个主题提出了一个令人信服的问题：ASP.NET MVC 是开源的还是共享源的？这让我想到了微软的类似开源的计划与开源社区的“真正的”（如果你愿意的话）开源之间的区别。这种差异确实引起了人们对微软开源重要产品的关注。访问源代码并不是不受欢迎的。这太棒了。我希望我们能够访问 Win32 源代码，甚至是 Windows 的整个源代码。谈论快速解决问题！问题在于 MS 现在是否会对**ASP.NET MVC 采取不干涉的态度**. 在那种情况下，我不知道我们是否应该使用它，因为可能需要一段时间才能获得强大的社区支持来围绕最初由一家通常不以提供源代码而闻名的公司拥有的源代码集进行构建。

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T16:15:16.473

开源总是一件好事。现在，如果 MS 放弃对它的支持，社区将继续开发它。以前，如果 MS 放弃了它，它就永远不会更新。

* * *

## 回答 #2

> 赞同：4
> 
> 时间：2009-04-09T16:14:11.750

你应该问的问题是“这是一件坏事吗？” 当然不是。

微软选择将 MVC 作为开源发布是他们改变对开源和自由软件的看法的一个例子。我非常怀疑他们是否已经这样做了，所以他们可以放弃对它的支持。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T16:15:19.187

为什么会有人认为开源是一件坏事？

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T16:16:31.010

如果 MS 仅仅因为它是开源的而放弃对它的支持，我会感到震惊。

当 MS 宣布他们将发布 jQuery 时，同时声明他们将开始支持 jQuery 作为产品。

因此，如果他们将支持他们不维护的开源产品，如果他们停止支持他们维护的开源产品，我会感到震惊。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T16:19:46.917

微软将asp.net MVC开源与不支持无关。请记住它作为开源发布的方式，这意味着 MS 将在此过程中进行更改。请注意，目前他们不会接受提交补丁，这是他们完全控制项目的另一个明确迹象。

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2009-04-09T16:17:41.583

您可以获得整个[.NET Framework](http://referencesource.microsoft.com/netframework.aspx)的源代码——我认为 MS 不会很快放弃它。我认为开源 MVC 反映了 MS 对源代码更加透明并与开源运动合作所采取的立场，而不是他们期望很快将其放宽。无论如何，它是一个巨大的框架，我完全期望 MVC 将继续支持它，因为它允许他们在 MVC 领域与 Ruby/Python/Java 竞争。

* * *

## 回答 #7

> 赞同：0
> 
> 时间：2009-04-09T16:19:50.817

我们昨晚刚刚在 MVC 上为我们的本地 .net 用户组进行了 MS[演示。](http://www.bellinghamdotnet.org/events.aspx)有关于它的开源方面的讨论。在源代码发布后的 24 小时内，Mono 的人就采用了 MVC。这都是好东西！

我在开发社区中听到了对 MVC 的极大兴趣。微软似乎坚定地支持这种模式和框架。我非常怀疑他们会很快放弃对它的官方支持。

* * *

## 回答 #8

> 赞同：0
> 
> 时间：2009-04-09T16:21:18.033

即使 MS 放弃对它的支持，它也真的不重要。因为自从它开源以来，社区将继续致力于它

这就是开源社区的力量——即使是像 MS 这样的软件巨头也被迫改变看法并接受它。这些天，他们正在做越来越多的开源。它对我们所有人（开发者社区）都有好处；-)

* * *

## 回答 #9

> 赞同：0
> 
> 时间：2009-04-09T16:28:23.417

每个打算使用 MVC 的项目都值得花时间考虑 MVC 是否得到 Microsoft 和社区的认真支持，以及使用 MVC 对项目有哪些风险（与收益相反）。

一旦部署，MVC 会持续到项目的预期生命周期吗？如果最佳猜测不确定或不确定，则可能考虑不使用 MVC。

* * *

## 回答 #10

> 赞同：0
> 
> 时间：2009-04-14T22:25:08.180

Microsoft 对支持任何产品的承诺基于市场接受度、竞争考虑和产品定位。无论他们是否开源，他们的记录都是不一致的。想想 IE 和 Frontpage。从长远来看，打开源代码只会增加您获得稳定性的机会，恕我直言。

# python - Python mechanize - “提交”类型的两个按钮

> ID：734893
> 
> 赞同：29
> 
> 时间：2009-04-09T16:11:15.907
> 
> 标签：python, mechanize

我有一个用python编写的机械化脚本，它填写了一个网络表单，应该点击“创建”按钮。但是有一个问题，表单有两个按钮。一个用于“添加附件”，一个用于“创建”。两者都是“提交”类型，附加按钮是列出的第一个按钮。因此，当我选择论坛并执行 br.submit() 时，它会单击“附加”按钮而不是“创建”。广泛的谷歌搜索对于选择表单中的特定按钮没有任何用处。有谁知道跳过第一个“提交”按钮并单击第二个的任何方法？

* * *

## 回答 #1

> 赞同：22
> 
> 时间：2009-11-06T06:17:16.903

我尝试使用 nr 参数，但没有任何运气。

我能够让它与名称和标签参数的组合一起使用，其中“标签”似乎对应于 HTML 中的“值”：

这是我的两个提交按钮：

```
<input type="submit" name="Preview" value="Preview" />
<input type="submit" name="Create" value="Create New Page" /> 
```

...这是单击第一个，返回，然后单击第二个的代码：

```
from mechanize import Browser
self.br = Browser()
self.br.open('http://foo.com/path/to/page.html')
self.br.select_form(name='my_form')
self.br['somefieldname'] = 'Foo'
submit_response = self.br.submit(name='Preview', label='Preview')
self.br.back()
self.br.select_form(name='my_form')
self.br['somefieldname'] = 'Bar'
submit_response = self.br.submit(name='Create', label='Create New Page') 
```

有一个变体也对我有用，其中提交按钮的“名称”是相同的，例如：

```
<input type="submit" name="action" value="Preview" />
<input type="submit" name="action" value="Save" />
<input type="submit" name="action" value="Cancel" /> 
```

和

```
self.br.select_form(name='my_form')
submit_response = self.br.submit(name='action', label='Preview')
self.br.back()
submit_response = self.br.submit(name='action', label='Save') 
```

重要提示 -在清理页面其余部分的一些 HTML**后，我***只能*让任何这个多提交按钮代码工作。

 **具体来说，我不能拥有`<br/>`——相反我必须拥有`<br />`......而且，更没有意义的是，我不能在两个提交按钮之间拥有任何东西。

我追了两个多小时的 mechanize/ClientForm 错误归结为：这让我非常沮丧：

```
<tr><td colspan="2"><br/><input type="submit" name="Preview" value="Preview" />&nbsp;<input type="submit" name="Create" value="Create New Page" /></td></tr> 
```

（都在一条线上）没有用，但是

```
<tr><td colspan="2"><br />
<input type="submit" name="Preview" value="Preview" />
<input type="submit" name="Create" value="Create New Page" /></td></tr> 
```

工作正常（在多行上，这也不重要）。

我喜欢 mechanize 因为它很容易安装（只需将文件复制到我的包含目录中）并且因为它非常易于使用，但除非我错过了一些重要的东西，否则我认为像这样的错误有点可怕 - 我可以'根本想不出为什么第一个例子应该失败而第二个例子应该工作的充分理由。

而且，顺便说一句，我还发现了另一个机械化错误，`<textarea>`其中包含在 a 中的 a`<p>`未被识别为有效控件，但是一旦将其从`<p>`容器中取出，它就会被识别得很好。而且我检查过， textarea允许包含在其他块级元素中，**例如**`<p>`.

* * *

## 回答 #2

> 赞同：7
> 
> 时间：2009-04-09T16:50:55.797

我建议你使用使用机械化（主要是猴子补丁）的斜纹。所以说你有一些字段的表单和两个**名为**“submit_to_preview”和“real_submit”的提交按钮。以下代码应该可以工作。

顺便说一句，这不是线程安全的，因此如果您想在线程环境中使用代码，您可能需要使用锁。

```
import twill.commands
b = twill.get_browser()
url = "http://site/myform"
twill.commands.go(url)
twill.commands.fv("2", "name", "Me")
twill.commands.fv("2", "age", "32")
twill.commands.fv("2", "comment", "useful article")
twill.commands.browser.submit("real_submit") 
```

希望有帮助。干杯。

* * *

## 回答 #3

> 赞同：5
> 
> 时间：2009-08-11T23:10:18.520

使用“点击”方法。例如

```
mybrowser.select_form(nr=0)
req = mybrowser.click(type="submit", nr=1)
mybrowser.open(req) 
```

应该管用。

* * *

## 回答 #4

> 赞同：2
> 
> 时间：2009-04-09T16:28:42.213

我可以从使用 HTTP 的经验谈起，而不是机械化，但我认为这可能是你想要的。

当一个表单中有两个提交按钮时，服务器可以确定哪个被按下，因为客户端应该为提交按钮添加一个参数。所以：

```
<form action="blah" method="get">
    <p>
        <input type="submit" name="button_1" value="One" />
        <input type="submit" name="button_2" value="Two" />
    </p>
</form> 
```

将为您提供以下 URL：

```
blah?button_1=One 
```

或者：

```
blah?button_2=Two 
```

取决于按下哪个按钮。

如果您以编程方式确定要发送哪些参数，则需要添加一个参数，其中包含按下的提交按钮的名称及其值。

# sql - 如何有效地进行数据库大规模更新？

> ID：734901
> 
> 赞同：1
> 
> 时间：2009-04-09T16:12:32.610
> 
> 标签：sql, sql-update, temp-tables

我有一个包含一些重复条目的表。我必须丢弃除一个之外的所有内容，然后更新这个最新的。我尝试过使用临时表和 while 语句，以这种方式：

```
CREATE TABLE #tmp_ImportedData_GenericData
(
    Id int identity(1,1),
    tmpCode varchar(255)  NULL,
    tmpAlpha3Code varchar(50)  NULL,
    tmpRelatedYear int NOT NULL,
    tmpPreviousValue varchar(255)  NULL,
    tmpGrowthRate varchar(255)  NULL
)

INSERT INTO #tmp_ImportedData_GenericData
SELECT
    MCS_ImportedData_GenericData.Code, 
MCS_ImportedData_GenericData.Alpha3Code,
MCS_ImportedData_GenericData.RelatedYear,
MCS_ImportedData_GenericData.PreviousValue,
MCS_ImportedData_GenericData.GrowthRate
FROM MCS_ImportedData_GenericData
INNER JOIN
(
    SELECT CODE, ALPHA3CODE, RELATEDYEAR, COUNT(*) AS NUMROWS
    FROM MCS_ImportedData_GenericData AS M
    GROUP BY M.CODE, M.ALPHA3CODE, M.RELATEDYEAR
    HAVING count(*) > 1
) AS M2 ON MCS_ImportedData_GenericData.CODE = M2.CODE
    AND MCS_ImportedData_GenericData.ALPHA3CODE = M2.ALPHA3CODE
    AND MCS_ImportedData_GenericData.RELATEDYEAR = M2.RELATEDYEAR
WHERE
(MCS_ImportedData_GenericData.PreviousValue <> 'INDEFINITO')

 -- SELECT * from #tmp_ImportedData_GenericData
 -- DROP TABLE #tmp_ImportedData_GenericData

DECLARE @counter int
DECLARE @rowsCount int

SET @counter = 1

SELECT @rowsCount =  count(*) from #tmp_ImportedData_GenericData
-- PRINT @rowsCount

WHILE @counter  < @rowsCount
BEGIN
    SELECT 
        @Code = tmpCode, 
        @Alpha3Code = tmpAlpha3Code, 
        @RelatedYear = tmpRelatedYear, 
        @OldValue = tmpPreviousValue, 
        @GrowthRate = tmpGrowthRate 
    FROM 
        #tmp_ImportedData_GenericData
    WHERE 
        Id = @counter

    DELETE FROM MCS_ImportedData_GenericData 
    WHERE 
        Code = @Code 
        AND Alpha3Code = @Alpha3Code  
        AND RelatedYear = @RelatedYear  
        AND PreviousValue <> 'INDEFINITO' OR PreviousValue IS NULL  

    UPDATE 
        MCS_ImportedData_GenericData 
        SET 
          PreviousValue = @OldValue, GrowthRate = @GrowthRate 
    WHERE 
        Code = @Code 
        AND Alpha3Code = @Alpha3Code  
        AND RelatedYear = @RelatedYear  
        AND MCS_ImportedData_GenericData.PreviousValue ='INDEFINITO'

    SET @counter = @counter + 1
END 
```

但它需要很长时间，即使只有 20000 - 30000 行需要处理。

有没有人有一些建议以提高性能？

提前致谢！

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T16:19:32.627

```
WITH q AS (
        SELECT  m.*, ROW_NUMBER() OVER (PARTITION BY CODE, ALPHA3CODE, RELATEDYEAR ORDER BY CASE WHEN PreviousValue = 'INDEFINITO' THEN 1 ELSE 0 END)
        FROM    MCS_ImportedData_GenericData m
        WHERE   PreviousValue <> 'INDEFINITO'
        )
DELETE
FROM    q
WHERE   rn > 1 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T18:12:31.497

Quassnoi 的答案使用 SQL Server 2005+ 语法，所以我认为我应该投入我的价值，使用更通用的东西......

首先，要删除所有重复项，但不删除“原始”，您需要一种区分重复记录的方法。（Quassnoi 答案的 ROW_NUMBER() 部分）

在您的情况下，源数据似乎没有标识列（您在临时表中创建一个）。如果是这样的话，我想到了两个选择：
1\. 将标识列添加到数据中，然后删除重复项
2\. 创建一个“重复数据删除”数据集，从原始数据中删除所有内容，然后将去重数据插入到原始数据中

选项 1 可能类似于...（使用新创建的 ID 字段）

```
DELETE
   [data]
FROM
   MCS_ImportedData_GenericData AS [data]
WHERE
   id > (
         SELECT
            MIN(id)
         FROM
            MCS_ImportedData_GenericData
         WHERE
            CODE = [data].CODE
            AND ALPHA3CODE = [data].ALPHA3CODE
            AND RELATEDYEAR = [data].RELATEDYEAR
        ) 
```

或者...

```
DELETE
   [data]
FROM
   MCS_ImportedData_GenericData AS [data]
INNER JOIN
(
   SELECT
      MIN(id) AS [id],
      CODE,
      ALPHA3CODE,
      RELATEDYEAR
   FROM
      MCS_ImportedData_GenericData
   GROUP BY
      CODE,
      ALPHA3CODE,
      RELATEDYEAR
)
AS [original]
   ON [original].CODE = [data].CODE
   AND [original].ALPHA3CODE = [data].ALPHA3CODE
   AND [original].RELATEDYEAR = [data].RELATEDYEAR
   AND [original].id <> [data].id 
```

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-07-07T10:17:30.517

我对所用语法的理解不够完美，无法发布确切的答案，但这是一种方法。

确定要保留的行（例如，选择值，... from .. where ...）

在识别时执行更新逻辑（例如，选择值 + 1 ... from ... where ...）

将选择插入新表。

删除原始文件，将新名称重命名为原始文件，重新创建所有授权/同义词/触发器/索引/FKs/...（或截断原始文件并从新文件中插入选择）

显然这有相当大的开销，但如果你想更新/清除数百万行，这将是最快的方法。

# tomcat - tomcat 连接池

> ID：734902
> 
> 赞同：1
> 
> 时间：2009-04-09T16:13:04.653
> 
> 标签：tomcat, dynamic, connection-pooling

我有一个在 Tomcat 中运行的简单 servlet。因为 servlet 连接到数据库，所以我需要使用连接池。但是，互联网上的所有示例都假定（开发人员）永远不会更改 servlet 连接到的数据库。

例如，这里是一个示例 context.xml 文件。

```
<?xml version="1.0" encoding="UTF-8"?>
<Context antiJARLocking="true" path="/feeds">
    <Resource name="jdbc/TestDB"
        auth="Container"
        type="javax.sql.DataSource"
        factory="org.apache.tomcat.dbcp.dbcp.BasicDataSourceFactory"
        username="username"
        password="password"
        driverClassName="org.postgresql.Driver"
        url="jdbc:postgresql://example.com:1234/myDB"
        maxWait="1000"
        removeAbandoned="true"
        maxActive="30"
        maxIdle="10"
        removeAbandonedTimeout="60"
        logAbandoned="true"/>
</Context> 
```

就我而言，我有一个测试服务器（postgresql）和一个生产服务器（ms sql），所以所有假设我可以在 context.xml 中硬编码设置的教程都行不通。

我有 2 个用于数据库 url、身份验证等的不同属性文件，一个用于测试服务器，一个用于生产服务器，效果很好，但是现在如果我想使用连接池，我将如何将其集成到我的小服务程序？

我希望能够在 Netbeans 6.5 中点击“构建”，将战争放在 dist 目录中，并将其放入任一服务器的 tomcat 应用程序目录中，而不必在新战争部署后四处更改 xml 文件。servlet 知道在每个系统上从何处获取属性文件，因此如果我可以将属性文件与连接池属性集成在一起，我就准备好了。

有任何想法吗... ？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T17:32:53.387

我把我所有的数据源定义都放在了tomcat的conf/server.xml文件中，所以war完全独立于数据源。

服务器.xml：

```
<GlobalNamingResources>
    <Resource name="mail/Mail" auth="Container" type="javax.mail.Session"
              mail.smtp.host="localhost"/>
    <Resource auth="Container" type="javax.sql.DataSource" name="jdbc/lagalerie"
              driverClassName="org.postgresql.Driver"
              url="jdbc:postgresql://localhost/lagalerie?charSet=LATIN1"
              maxActive="100" maxIdle="30" maxWait="10000"
              username="casashop" password="casashop"/>
</GlobalNamingResources> 
```

上下文.xml：

```
 <ResourceLink global="jdbc/lagalerie" name="jdbc/lagalerie" type="javax.sql.DataSource"/>
  <ResourceLink global="mail/Mail" name="mail/Mail" type="javax.mail.Session"/> 
```

网页.xml：

```
<resource-ref>
    <description>The datasource</description>
    <res-ref-name>jdbc/DataSource</res-ref-name>
    <res-type>javax.sql.DataSource</res-type>
    <res-auth>Container</res-auth>
</resource-ref>
<resource-ref>
    <description>The mail session</description>
    <res-ref-name>mail/Mail</res-ref-name>
    <res-type>javax.mail.Session</res-type>
    <res-auth>Container</res-auth>
</resource-ref> 
```

* * *

## 回答 #2

> 赞同：-1
> 
> 时间：2009-04-09T16:26:40.893

您可以有 2 个不同的连接，并动态检测要在应用程序中使用的连接。

# c# - 如何使用 C# 裁剪图像？

> ID：734930
> 
> 赞同：255
> 
> 时间：2009-04-09T16:21:26.460
> 
> 标签：c#, image-processing

如何编写一个将在 C# 中裁剪图像的应用程序？

* * *

## 回答 #1

> 赞同：283
> 
> 时间：2009-04-09T16:23:16.330

查看此链接：[http ://www.switchonthecode.com/tutorials/csharp-tutorial-image-editing-saving-cropping-and-resizing](http://web.archive.org/web/20130126075626/http://www.switchonthecode.com:80/tutorials/csharp-tutorial-image-editing-saving-cropping-and-resizing)

```
private static Image cropImage(Image img, Rectangle cropArea)
{
   Bitmap bmpImage = new Bitmap(img);
   return bmpImage.Clone(cropArea, bmpImage.PixelFormat);
} 
```

* * *

## 回答 #2

> 赞同：244
> 
> 时间：2009-04-09T16:23:31.507

您可以使用[`Graphics.DrawImage`](http://msdn.microsoft.com/en-us/library/ktyfbs10.aspx)从位图中将裁剪后的图像绘制到图形对象上。

```
Rectangle cropRect = new Rectangle(...);
Bitmap src = Image.FromFile(fileName) as Bitmap;
Bitmap target = new Bitmap(cropRect.Width, cropRect.Height);

using(Graphics g = Graphics.FromImage(target))
{
   g.DrawImage(src, new Rectangle(0, 0, target.Width, target.Height), 
                    cropRect,                        
                    GraphicsUnit.Pixel);
} 
```

* * *

## 回答 #3

> 赞同：65
> 
> 时间：2011-10-29T15:50:58.030

比公认的答案更简单的是：

```
public static Bitmap cropAtRect(this Bitmap b, Rectangle r)
{
    Bitmap nb = new Bitmap(r.Width, r.Height);
    using (Graphics g = Graphics.FromImage(nb))
    {
        g.DrawImage(b, -r.X, -r.Y);
        return nb;
    }
} 
```

它避免了最简单答案的“***内存不足***”异常风险。

请注意，`Bitmap`并且`Graphics`因此`IDisposable`是`using`子句。

**编辑**：我发现这对于由`Bitmap.Save`或 Paint.exe 保存的 PNG 来说很好，但对于由例如*Paint Shop Pro 6*保存的 PNG 则失败- 内容被替换。加法`GraphicsUnit.Pixel`给出不同的错误结果。也许只是这些失败的 PNG 是错误的。

* * *

## 回答 #4

> 赞同：9
> 
> 时间：2012-10-30T11:34:11.550

> 采用`bmp.SetResolution(image.HorizontalResolution, image .VerticalResolution);`

即使您在此处实施最佳答案，这也可能是必要的，特别是如果您的图像真的很棒并且分辨率不完全是 96.0

我的测试示例：

```
 static Bitmap LoadImage()
    {
        return (Bitmap)Bitmap.FromFile( @"e:\Tests\d_bigImage.bmp" ); // here is large image 9222x9222 pixels and 95.96 dpi resolutions
    }

    static void TestBigImagePartDrawing()
    {
        using( var absentRectangleImage = LoadImage() )
        {
            using( var currentTile = new Bitmap( 256, 256 ) )
            {
                currentTile.SetResolution(absentRectangleImage.HorizontalResolution, absentRectangleImage.VerticalResolution);

                using( var currentTileGraphics = Graphics.FromImage( currentTile ) )
                {
                    currentTileGraphics.Clear( Color.Black );
                    var absentRectangleArea = new Rectangle( 3, 8963, 256, 256 );
                    currentTileGraphics.DrawImage( absentRectangleImage, 0, 0, absentRectangleArea, GraphicsUnit.Pixel );
                }

                currentTile.Save(@"e:\Tests\Tile.bmp");
            }
        }
    } 
```

* * *

## 回答 #5

> 赞同：6
> 
> 时间：2009-04-10T16:33:44.643

这是裁剪图像的简单示例

```
public Image Crop(string img, int width, int height, int x, int y)
{
    try
    {
        Image image = Image.FromFile(img);
        Bitmap bmp = new Bitmap(width, height, PixelFormat.Format24bppRgb);
        bmp.SetResolution(80, 60);

        Graphics gfx = Graphics.FromImage(bmp);
        gfx.SmoothingMode = SmoothingMode.AntiAlias;
        gfx.InterpolationMode = InterpolationMode.HighQualityBicubic;
        gfx.PixelOffsetMode = PixelOffsetMode.HighQuality;
        gfx.DrawImage(image, new Rectangle(0, 0, width, height), x, y, width, height, GraphicsUnit.Pixel);
        // Dispose to free up resources
        image.Dispose();
        bmp.Dispose();
        gfx.Dispose();

        return bmp;
    }
    catch (Exception ex)
    {
        MessageBox.Show(ex.Message);
        return null;
    }            
} 
```

* * *

## 回答 #6

> 赞同：5
> 
> 时间：2009-04-09T16:25:50.880

这很容易：

*   `Bitmap`使用裁剪后的大小创建一个新对象。
*   用于为新位图`Graphics.FromImage`创建对象。`Graphics`
*   使用该`DrawImage`方法将图像绘制到具有负 X 和 Y 坐标的位图上。

* * *

## 回答 #7

> 赞同：3
> 
> 时间：2016-04-15T01:16:36.263

如果您使用的是[AForge.NET](http://www.aforgenet.com/)：

```
using(var croppedBitmap = new Crop(new Rectangle(10, 10, 10, 10)).Apply(bitmap))
{
    // ...
} 
```

* * *

## 回答 #8

> 赞同：3
> 
> 时间：2017-11-08T12:59:43.077

我一直在寻找一个简单而快速的功能，不需要额外的库来完成这项工作。我尝试了[Nicks 解决方案](https://stackoverflow.com/a/734938/6089294)，但我需要 29.4 秒来“提取”1195 个图集文件的图像。所以后来我以这种方式管理并需要 2,43 秒来完成同样的工作。也许这会有所帮助。

```
// content of the Texture class
public class Texture
{
    //name of the texture
    public string name { get; set; }
    //x position of the texture in the atlas image
    public int x { get; set; }
    //y position of the texture in the atlas image
    public int y { get; set; }
    //width of the texture in the atlas image
    public int width { get; set; }
    //height of the texture in the atlas image
    public int height { get; set; }
}

Bitmap atlasImage = new Bitmap(@"C:\somepicture.png");
PixelFormat pixelFormat = atlasImage.PixelFormat;

foreach (Texture t in textureList)
{
     try
     {
           CroppedImage = new Bitmap(t.width, t.height, pixelFormat);
           // copy pixels over to avoid antialiasing or any other side effects of drawing
           // the subimages to the output image using Graphics
           for (int x = 0; x < t.width; x++)
               for (int y = 0; y < t.height; y++)
                   CroppedImage.SetPixel(x, y, atlasImage.GetPixel(t.x + x, t.y + y));
           CroppedImage.Save(Path.Combine(workingFolder, t.name + ".png"), ImageFormat.Png);
     }
     catch (Exception ex)
     {
          // handle the exception
     }
} 
```

* * *

## 回答 #9

> 赞同：1
> 
> 时间：2013-01-18T07:57:03.137

在 C# 中裁剪图像非常容易。然而，你将如何管理图像的裁剪会有点困难。

下面的示例是如何在 C# 中裁剪图像的方法。

```
var filename = @"c:\personal\images\horizon.png";
var img = Image.FromFile(filename);
var rect = new Rectangle(new Point(0, 0), img.Size);
var cloned = new Bitmap(img).Clone(rect, img.PixelFormat);
var bitmap = new Bitmap(cloned, new Size(50, 50));
cloned.Dispose(); 
```

* * *

## 回答 #10

> 赞同：1
> 
> 时间：2013-04-22T22:21:48.050

有一个 C# 包装器，它是开源的，托管在 Codeplex 上，称为**[Web Image Cropping](https://imagecropping.codeplex.com/)**

**注册控件**

`<%@ Register Assembly="CS.Web.UI.CropImage" Namespace="CS.Web.UI" TagPrefix="cs" %>`

**调整大小**

```
<asp:Image ID="Image1" runat="server" ImageUrl="images/328.jpg" />
<cs:CropImage ID="wci1" runat="server" Image="Image1" 
     X="10" Y="10" X2="50" Y2="50" /> 
```

**在后面的代码中裁剪**- 例如，单击按钮时调用裁剪方法；

`wci1.Crop(Server.MapPath("images/sample1.jpg"));`

* * *

## 回答 #11

> 赞同：0
> 
> 时间：2009-04-09T16:29:48.450

假设您的意思是要获取图像文件（JPEG、BMP、TIFF 等）并将其裁剪然后保存为较小的图像文件，我建议使用具有 .NET API 的第三方工具。以下是我喜欢的一些流行的：

[LeadTools](http://www.leadtools.com/)
[Accusoft Pegasus](http://www.accusoft.com/) [Snowbound 成像 SDK](http://www.snowbound.com/imaging_sdk/rastermaster_overview.html)

* * *

## 回答 #12

> 赞同：0
> 
> 时间：2013-09-16T09:06:20.693

只有这个样本没有问题：

```
var crop = new Rectangle(0, y, bitmap.Width, h);
var bmp = new Bitmap(bitmap.Width, h);
var tempfile = Application.StartupPath+"\\"+"TEMP"+"\\"+Path.GetRandomFileName();

using (var gr = Graphics.FromImage(bmp))
{
    try
    {
        var dest = new Rectangle(0, 0, bitmap.Width, h);
        gr.DrawImage(image,dest , crop, GraphicsUnit.Point);
        bmp.Save(tempfile,ImageFormat.Jpeg);
        bmp.Dispose();
    }
    catch (Exception)
    {

    }

} 
```

* * *

## 回答 #13

> 赞同：0
> 
> 时间：2014-02-15T03:54:42.827

这是另一种方式。就我而言，我有：

*   2 个数字上下控件（称为 LeftMargin 和 TopMargin）
*   1个图片框（pictureBox1）
*   我称之为生成的 1 个按钮
*   C:\imagenes\myImage.gif 上有 1 张图片

在按钮里面我有这个代码：

```
Image myImage = Image.FromFile(@"C:\imagenes\myImage.gif");
Bitmap croppedBitmap = new Bitmap(myImage);
croppedBitmap = croppedBitmap.Clone(
            new Rectangle(
                (int)LeftMargin.Value, (int)TopMargin.Value,
                myImage.Width - (int)LeftMargin.Value,
                myImage.Height - (int)TopMargin.Value),
            System.Drawing.Imaging.PixelFormat.DontCare);
pictureBox1.Image = croppedBitmap; 
```

我在 Visual Studio 2012 中使用 C# 进行了尝试。我从这个[页面找到了这个解决方案](http://forum.codecall.net/topic/49829-c-tutorial-cropping-images-and-bitmaps/ "页")

* * *

## 回答 #14

> 赞同：0
> 
> 时间：2016-12-16T06:30:02.610

这是在 github 上的工作演示

[https://github.com/SystematixIndore/Crop-SaveImageInCSharp](https://github.com/SystematixIndore/Crop-SaveImageInCSharp)

```
<%@ Page Language="C#" AutoEventWireup="true" CodeBehind="WebForm1.aspx.cs" Inherits="WebApplication1.WebForm1" %>

<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head runat="server">
  <title></title>
 <link href="css/jquery.Jcrop.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>
<script type="text/javascript" src="js/jquery.Jcrop.js"></script>
</head>
<body>
  <form id="form2" runat="server">
  <div>
    <asp:Panel ID="pnlUpload" runat="server">
      <asp:FileUpload ID="Upload" runat="server" />
      <br />
      <asp:Button ID="btnUpload" runat="server" OnClick="btnUpload_Click" Text="Upload" />
      <asp:Label ID="lblError" runat="server" Visible="false" />
    </asp:Panel>
    <asp:Panel ID="pnlCrop" runat="server" Visible="false">
      <asp:Image ID="imgCrop" runat="server" />
      <br />
      <asp:HiddenField ID="X" runat="server" />
      <asp:HiddenField ID="Y" runat="server" />
      <asp:HiddenField ID="W" runat="server" />
      <asp:HiddenField ID="H" runat="server" />
      <asp:Button ID="btnCrop" runat="server" Text="Crop" OnClick="btnCrop_Click" />
    </asp:Panel>
    <asp:Panel ID="pnlCropped" runat="server" Visible="false">
      <asp:Image ID="imgCropped" runat="server" />
    </asp:Panel>
  </div>
  </form>
    <script type="text/javascript">
  jQuery(document).ready(function() {
    jQuery('#imgCrop').Jcrop({
      onSelect: storeCoords
    });
  });

  function storeCoords(c) {
    jQuery('#X').val(c.x);
    jQuery('#Y').val(c.y);
    jQuery('#W').val(c.w);
    jQuery('#H').val(c.h);
  };

</script>
</body>
</html> 
```

用于上传和裁剪的 C# 代码逻辑。

```
using System;
using System.Collections.Generic;
using System.Linq;
using System.Web;
using System.Web.UI;
using System.Web.UI.WebControls;
using System.IO;
using SD = System.Drawing;
using System.Drawing.Imaging;
using System.Drawing.Drawing2D;

namespace WebApplication1
{
    public partial class WebForm1 : System.Web.UI.Page
    {
        String path = HttpContext.Current.Request.PhysicalApplicationPath + "images\\";
        protected void Page_Load(object sender, EventArgs e)
        {

        }
        protected void btnUpload_Click(object sender, EventArgs e)
        {
            Boolean FileOK = false;
            Boolean FileSaved = false;

            if (Upload.HasFile)
            {
                Session["WorkingImage"] = Upload.FileName;
                String FileExtension = Path.GetExtension(Session["WorkingImage"].ToString()).ToLower();
                String[] allowedExtensions = { ".png", ".jpeg", ".jpg", ".gif" };
                for (int i = 0; i < allowedExtensions.Length; i++)
                {
                    if (FileExtension == allowedExtensions[i])
                    {
                        FileOK = true;
                    }
                }
            }

            if (FileOK)
            {
                try
                {
                    Upload.PostedFile.SaveAs(path + Session["WorkingImage"]);
                    FileSaved = true;
                }
                catch (Exception ex)
                {
                    lblError.Text = "File could not be uploaded." + ex.Message.ToString();
                    lblError.Visible = true;
                    FileSaved = false;
                }
            }
            else
            {
                lblError.Text = "Cannot accept files of this type.";
                lblError.Visible = true;
            }

            if (FileSaved)
            {
                pnlUpload.Visible = false;
                pnlCrop.Visible = true;
                imgCrop.ImageUrl = "images/" + Session["WorkingImage"].ToString();
            }
        }

        protected void btnCrop_Click(object sender, EventArgs e)
        {
            string ImageName = Session["WorkingImage"].ToString();
            int w = Convert.ToInt32(W.Value);
            int h = Convert.ToInt32(H.Value);
            int x = Convert.ToInt32(X.Value);
            int y = Convert.ToInt32(Y.Value);

            byte[] CropImage = Crop(path + ImageName, w, h, x, y);
            using (MemoryStream ms = new MemoryStream(CropImage, 0, CropImage.Length))
            {
                ms.Write(CropImage, 0, CropImage.Length);
                using (SD.Image CroppedImage = SD.Image.FromStream(ms, true))
                {
                    string SaveTo = path + "crop" + ImageName;
                    CroppedImage.Save(SaveTo, CroppedImage.RawFormat);
                    pnlCrop.Visible = false;
                    pnlCropped.Visible = true;
                    imgCropped.ImageUrl = "images/crop" + ImageName;
                }
            }
        }

        static byte[] Crop(string Img, int Width, int Height, int X, int Y)
        {
            try
            {
                using (SD.Image OriginalImage = SD.Image.FromFile(Img))
                {
                    using (SD.Bitmap bmp = new SD.Bitmap(Width, Height))
                    {
                        bmp.SetResolution(OriginalImage.HorizontalResolution, OriginalImage.VerticalResolution);
                        using (SD.Graphics Graphic = SD.Graphics.FromImage(bmp))
                        {
                            Graphic.SmoothingMode = SmoothingMode.AntiAlias;
                            Graphic.InterpolationMode = InterpolationMode.HighQualityBicubic;
                            Graphic.PixelOffsetMode = PixelOffsetMode.HighQuality;
                            Graphic.DrawImage(OriginalImage, new SD.Rectangle(0, 0, Width, Height), X, Y, Width, Height, SD.GraphicsUnit.Pixel);
                            MemoryStream ms = new MemoryStream();
                            bmp.Save(ms, OriginalImage.RawFormat);
                            return ms.GetBuffer();
                        }
                    }
                }
            }
            catch (Exception Ex)
            {
                throw (Ex);
            }
        }
    }
} 
```

# c++ - 在库中使用的最佳标头结构是什么？

> ID：734936
> 
> 赞同：4
> 
> 时间：2009-04-09T16:23:04.007
> 
> 标签：c++, header

关于库中的标题，我看到了两个选项，我不确定选择是否真的很重要。假设我创建了一个库，让我们调用它`foobar`。请帮我选择最合适的选项：

1.  在库项目的最根目录中包含一个，我们称之为它`foobar.h`，它包含库中的所有头文件，例如“src/some_namespace/SomeClass.h”等。然后从库外部，在我想使用与`foobar`库有关的任何文件中，只需`#include <foobar.h>`.

2.  没有主要包含，而是仅在我要使用它们的地方包含我们需要的标题，因此我可能在源文件中有一大堆包含。由于我使用的命名空间有时深达 3，因此包括标题似乎有点麻烦。

我选择了选项 1，因为它很容易实现。OpenGL 和许多其他库似乎都这样做了，所以这似乎是明智的。但是，标准 C++ 库可以要求我在任何给定文件中包含多个头文件，为什么他们不只有一个头文件？除非是我和白痴，他们是独立的图书馆......

### 更新：

除了答案，我认为提供这两个选项是有意义的，对吗？如果我想使用 std::string 但必须包含大量头文件，我会非常恼火；那太傻了。另一方面，`#include`当我想使用大部分库时，如果我不得不输入大量的行，我会很恼火。

### 转发标题：

感谢所有建议我前锋头球的人，这帮助我让头球丛林变得不那么复杂！:)

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T16:29:37.577

stl、boost等有很多头文件要包含的，他们为你提供了独立的工具，你可以独立使用它们。

因此，如果您的库是一组解耦工具，您必须选择将它们作为单独的部分包含，以及将整个库包含为一个文件。

* * *

## 回答 #2

> 赞同：5
> 
> 时间：2009-04-09T16:52:37.070

考虑一下您的库将如何使用，并以这种方式组织它。如果有人不太可能在不使用整个事物的情况下使用一小部分，则将其构建为一个大的包含。如果一小部分本身是独立且有用的，请确保您可以包含足够的部分。如果有一些有意义的逻辑分组，请为每个组创建包含文件。

与大多数编程问题一样，没有一刀切的答案。

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T16:57:48.680

必须处理所有#included 标头。这并不像它可能的那么糟糕，因为现代编译器提供了某种不重复处理它们的选项（可能有类似的东西`#pragma once`，或`ifndef`警卫）。尽管如此，每个翻译单元的每个#included 标头都必须处理一次，并且可以快速加起来。

通常的做法是头文件只#include 那些他们需要的头文件，并尽可能使用前向声明（`class foo;`）。这样，您就不会得到开销。

如果你想#include 一切和它的兄弟，你可以提供你自己的#includes 头文件。您不必在每个头文件和源文件中明确写出所有内容。该选项是您可以提供的，但是如果 std 中的所有内容都作为一个整体标头出现，那么您将没有选择。

* * *

## 回答 #4

> 赞同：1
> 
> 时间：2009-04-09T16:33:52.683

每次你#include 一个头文件时，你都会让编译器做一些非常艰苦的工作。#include 的标题越少，它要做的工作就越少，编译的速度就越快。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T16:53:56.130

所有包含文件都应该有自己的意义。您应该从 lib-users 位置选择标题结构：用户应该如何使用我的库？什么样的结构最适合用户？

**示例：**
如果您的库提供字符串算法 - 最好用所有文件制作一个标题 - string_algorithms.h；
如果您的库提供了某个外观对象-最好使用一个头文件（可能很少有其他带有扩展名或帮助程序的文件）；
如果您提供将独立使用的复杂对象，则制作不同的头文件（容器库提供不同的容器）；

* * *

## 回答 #6

> 赞同：1
> 
> 时间：2009-04-09T16:54:26.037

[转发声明](http://www-subatech.in2p3.fr/~photons/subatech/soft/carnac/CPP-INC-1.shtml)而不是一次包含所有这些头文件，然后在需要时包含。

* * *

## 回答 #7

> 赞同：1
> 
> 时间：2009-04-09T17:43:39.427

无论您决定为库的公共 API 提供的头文件（一个、几个或某种组合），为私有 API 至少拥有一个单独的头文件总是一个好主意。（无需公开非导出函数和类的原型或仅供内部使用的定义。）

# c# - 字符串解析，提取数字和字母

> ID：734937
> 
> 赞同：5
> 
> 时间：2009-04-09T16:23:05.427
> 
> 标签：c#, regex, string, text-parsing

解析字符串并提取数字和字母的最简单方法是什么？我有可以采用以下格式（数字|字母或字母|数字）的字符串，即“10A”、“B5”、“C10”、“1G”等。

我需要提取两个部分，即“10A”->“10”和“A”。

**更新：**感谢大家的所有优秀答案

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-09T16:30:48.650

最简单的方法可能是使用正则表达式。

```
((?<number>\d+)(?<letter>[a-zA-Z])|(?<letter>[a-zA-Z])(?<number>\d+)) 
```

然后，您可以将其与您的字符串匹配并从组中提取值。

```
Match match = regex.Match("10A");
string letter = match.Groups["letter"].Value;
int number = int.Parse(match.Groups["number"].Value); 
```

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-09T16:31:46.090

最简单最快的是使用简单的字符串操作。使用该`IsDigit`方法检查字母的位置，并将字符串的其余部分解析为一个数字：

```
char letter = str[0];
int index = 1;
if (Char.IsDigit(letter)) {
   letter = str[str.Length - 1];
   index = 0;
}
int number = int.Parse(str.Substring(index, str.Length - 1)); 
```

* * *

## 回答 #3

> 赞同：4
> 
> 时间：2009-04-09T16:34:40.110

只是要与众不同：

```
string number = input.Trim("ABCDEFGHIJKLMNOPQRSTUVWXYZ".ToCharArray());
string letter = input.Trim("0123456789".ToCharArray()); 
```

* * *

## 回答 #4

> 赞同：4
> 
> 时间：2009-04-09T16:46:56.897

```
char letter = str.Single(c => char.IsLetter(c));
int num = int.Parse(new string(str.Where(c => char.IsDigit(c)).ToArray())); 
```

这个解决方案不是非常严格（它允许“5A2”之类的东西并返回“A”和 52），但它可能适合您的目的。

* * *

## 回答 #5

> 赞同：1
> 
> 时间：2009-04-09T16:35:02.977

这是我将如何处理这个问题。您可以逐步执行此操作并将 gc1["letter"]、gc1["number"]、gc2["letter"] 和 gc2["number"] 放在监视窗口中以查看它是否有效（刚刚过去最后一步当然，这里的代码行）。

常规表达式将采用任何一种模式，在每种情况下都需要一个或多个字母和数字。

```
 Regex pattern = new Regex("^(?<letter>[a-zA-Z]+)(?<number>[0-9]+)|(?<number>[0-9]+)(?<letter>[a-zA-Z]+)$");
        string s1 = "12A";
        string s2 = "B45";
        Match m1 = pattern.Match(s1);
        Match m2 = pattern.Match(s2);
        GroupCollection gc1 = m1.Groups;
        GroupCollection gc2 = m2.Groups; 
```

* * *

## 回答 #6

> 赞同：0
> 
> 时间：2012-11-23T07:41:32.150

使用[Sprache](http://code.google.com/p/sprache/)和一些 Linq 功夫：

```
var tagParser =
    from a in Parse.Number.Or(Parse.Letter.Once().Text())
    from b in Parse.Letter.Once().Text().Or(Parse.Number)
    select char.IsDigit(a[0]) ?
           new{Number=a, Letter=b} : new{Number=b, Letter=a};

var tag1 = tagParser.Parse("10A");
var tag2 = tagParser.Parse("A10");

tag1.Letter; // should be A 
tag1.Number; // should be 10

tag2.Letter; // should be A
tag2.Number; // should be 10

/* Output:
   A
   10
   A
   10
 */ 
```

# tsql - 如何在 SQL Standard 上导出 SSIS 数据并在 SQL Express 上使用 Bulk Insert 导入？

> ID：734943
> 
> 赞同：0
> 
> 时间：2009-04-09T16:23:37.263
> 
> 标签：tsql, ssis, sql-server-express, bulkinsert, bcp

我想使用 SSIS 创建数据库表平面文件导出，然后将它们导入到各种分布式 SQL Express 安装中。正如您可能猜到的，SSIS 在 Express 版本中不可用。当我进行批量插入时，它会出错：

`Msg 4866, Level 16, State 8, Line 1 The bulk load failed. The column is too long in the data file for row 1, column 5\. Verify that the field terminator and row terminator are specified correctly.`

生成的文件是 ascii (1252)，字段之间有 char(09) (tab)，char(0d) char(0a) 结束一行（我认为是 \r\n）。

这是格式文件（第 4 列是列的宽度）：

`9.0`
`5`
`1 SQLCHAR 0 12 "\t" 1 Record_ID ""`
`2 SQLCHAR 0 498 "\t" 2 Filename SQL Latin1 General CP1 CI AS`
`3 SQLCHAR 0 498 "\t" 3 Path SQL Latin1 General CP1 CI AS`
`4 SQLCHAR 0 12 "\t" 4 Width ""`
`5 SQLCHAR 0 12 "\r\n" 5 Height ""`

从文件顶部开始的示例数据：

`Record_ID Filename Path Width Height`
`1437 BreadCakeCooknPie.eps G:\BakedGoods\BreadCakeCooknPie.eps 595 647`
`1438 CakeChocolateRoses.eps G:\BakedGoods\CakeChocolateRoses.eps 1200 848`

我使用以下 T-SQL 代码导入它：

`bulk insert item_table from 'Item_Table.txt' with`
`( FORMATFILE='Item_Table.fmt', FIRSTROW=2)`

表字段是：

`[Record_ID] [int] NULL,`
`[Filename] [nvarchar](249) NULL,`
`[Path] [nvarchar](249) NOT NULL,`
`[Width] [int] NULL,`
`[Height] [int] NULL`

有没有可用的文案？知道如何解决错误吗？知道如何获取 SSIS 创建的格式文件吗？还有其他想法吗？

非常感谢您考虑我的问题。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-10T02:16:43.407

这是否在数据流的源部分失败？您可以发布与源相关的元数据吗？我偶尔发现 SSIS 无法正确估计平面文件连接上的大小或数据类型。发生这种情况时，数据流任务将在导入的源部分遇到超过该位置预期的平面文件连接长度的数据时将失败。

这是否在数据流的目标部分失败？如果是这样，如果您使用数据读取器作为目标而不是实际的目标表，它至少可以工作吗？我猜你的问题是在管道的早期，但如果它超过了数据流的源部分，那么你至少可以将问题隔离为目标问题。

请让我们知道它在数据流中的实际中断位置。

* * *

## 回答 #2

> 赞同：0
> 
> 时间：2009-04-09T19:08:44.233

您是否考虑过以管道或逗号分隔格式运行 SSIS 导出？在导出和导入之间如何处理制表符可能存在问题。

您在此处列出的所有内容似乎都没有指向 SSIS 或批量插入的问题，只是文件本身的格式存在问题。

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-10T15:57:44.167

这是部分答案。显然，您可以从 BCP 开始，让它生成一个格式文件和一个文本数据转储，使用来自 bcp 的格式文件并在 SSIS 中完全匹配文本导出。数据文件中的物理字段排列（即使您可以在格式文件中对它们进行排序）和没有丢失的字段（即使您不需要它们）似乎是关键。

我必须手动使文本导出元数据与格式文件匹配（在文本文件连接管理器的列下手动键入元数据）。这导致文本文件中字段的物理顺序与表中的物理顺序相匹配（我之前使用格式文件列来匹配这些，这似乎不起作用）。

从 SSIS 导出的内容仍然不一样，但足够接近可以导入。例如，当 bcp 导出数据时，它会将 0.000 放在日期字段后面，将 .0 放在数字字段（浮点数等）后面。

我的最终格式文件如下。请注意，所有字段都是 SQLCHAR，即使有些是 unicode，所有大小都是错误的（int 是 10，但它有 12），（文本长度为 249，但它有 498），以及（我必须将所有字段放入，而不仅仅是我要导入的那些。它没有正确跳过字段。）

疯狂的世界。任何想法为什么会这样？

`9.0`
`29`
`1 SQLCHAR 0 12 "\t" 1 Record_ID ""`
`2 SQLCHAR 0 498 "\t" 2 Filename SQL_Latin1_General_CP1_CI_AS`
`3 SQLCHAR 0 498 "\t" 3 Path SQL_Latin1_General_CP1_CI_AS`
`4 SQLCHAR 0 498 "\t" 4 Extension_Win SQL_Latin1_General_CP1_CI_AS`
`5 SQLCHAR 0 498 "\t" 5 Short_Filename_Win SQL_Latin1_General_CP1_CI_AS`
`6 SQLCHAR 0 498 "\t" 6 Volume SQL_Latin1_General_CP1_CI_AS`
`7 SQLCHAR 0 24 "\t" 7 Created ""`
`8 SQLCHAR 0 24 "\t" 8 Last_Modified ""`
`9 SQLCHAR 0 24 "\t" 9 Cataloged ""`
`10 SQLCHAR 0 24 "\t" 10 Last_Updated ""`
`11 SQLCHAR 0 12 "\t" 11 File_Size ""`
`12 SQLCHAR 0 498 "\t" 12 Mac_File_Type SQL_Latin1_General_CP1_CI_AS`
`13 SQLCHAR 0 498 "\t" 13 Mac_Creator SQL_Latin1_General_CP1_CI_AS`
`14 SQLCHAR 0 498 "\t" 14 Mac_Zone SQL_Latin1_General_CP1_CI_AS`
`15 SQLCHAR 0 12 "\t" 15 Thumbnail_Size ""`
`16 SQLCHAR 0 12 "\t" 16 Color_Mode ""`
`17 SQLCHAR 0 30 "\t" 17 Horizontal_Resolution ""`
`18 SQLCHAR 0 30 "\t" 18 Vertical_Resolution ""`
`19 SQLCHAR 0 12 "\t" 19 Width ""`
`20 SQLCHAR 0 12 "\t" 20 Height ""`
`21 SQLCHAR 0 12 "\t" 21 MultipageCount ""`
`22 SQLCHAR 0 12 "\t" 22 PlaceHolder ""`
`23 SQLCHAR 0 12 "\t" 23 Watermarked ""`
`24 SQLCHAR 0 12 "\t" 24 FileStoreID ""`
`25 SQLCHAR 0 498 "\t" 25 Directory_Path SQL_Latin1_General_CP1_CI_AS`
`26 SQLCHAR 0 12 "\t" 26 RID ""`
`27 SQLCHAR 0 498 "\t" 27 Cataloged_By SQL_Latin1_General_CP1_CI_AS`
`28 SQLCHAR 0 498 "\t" 28 Updated_By SQL_Latin1_General_CP1_CI_AS`
`29 SQLCHAR 0 0 "\r\n" 29 File_Description SQL_Latin1_General_CP1_CI_AS`

# xslt - 使用 xslt 构建列表

> ID：734946
> 
> 赞同：2
> 
> 时间：2009-04-09T16:24:21.990
> 
> 标签：xslt

我正在尝试构建一个解析我的整个 xml 文档的列表。我需要列出数字名称，然后是字母名称。该列表应如下所示。

```
6
6600 Training
6500 Training

A
Accelerated Training

T
Training 
```

这是 xml 的一个片段。

```
<courses>
    <course>         
        <name>Accelerated Training</name>
    </course>
    <course>        
        <name>6600 Training</name>
    </course>   
         <course>        
        <name>Training</name>
    </course>
    <course>        
        <name>6500 Training</name>
    </course>   

</courses> 
```

这是我目前正在使用的代码。我在网站上的另一个问题中发现了这一点，并对其进行了一些定制。目前它没有考虑到我需要按数字进行解析，并且它也按字母顺序返回。

```
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"> 

  <xsl:output omit-xml-declaration="yes" indent="yes"/> 
  <xsl:variable name="vLower" select= "'abcdefghijklmnopqrstuvwxyz'"/> 
  <xsl:variable name="vUpper" select= "'ABCDEFGHIJKLMNOPQRSTUVWXYZ'"/> 

  <xsl:key name="kTitleBy1stLetter" match="courses/course"  use="substring(name,1,1)"/>    

  <xsl:template match="/*">      

    <xsl:for-each select="course [generate-id() = generate-id(key('kTitleBy1stLetter', substring(name,1,1)) [1] ) ]">        
      <xsl:variable name="v1st" select="substring(name,1,1)"/>        
      <h2><xsl:value-of select="$v1st"/></h2>        
      <div class="{translate($v1st, $vUpper, $vLower)}-content">
        <ul>
          <xsl:for-each select="key('kTitleBy1stLetter',$v1st)">               
            <li><xsl:value-of select="name"/></li>
          </xsl:for-each>          
        </ul>      
      </div>      
    </xsl:for-each>        
  </xsl:template>
</xsl:stylesheet> 
```

* * *

## 回答 #1

> 赞同：7
> 
> 时间：2009-04-09T16:50:22.880

Basically you need to group by first letter and sort by `<name>`. You are on a good way with your Muenchian grouping approach already.

I would suggest an alternative that's a bit easier on the eye:

```
<xsl:key name="kInitial" match="course" use="substring(name, 1, 1)" />

<xsl:template match="courses">
  <xsl:apply-templates select="course" mode="initial">
    <xsl:sort select="name" />
  </xsl:apply-templates>
</xsl:template>

<xsl:template match="course" mode="initial">
  <xsl:variable name="initial" select="substring(name, 1, 1)" />
  <xsl:variable name="courses" select="key('kInitial', $initial)" />
  <xsl:if test="generate-id() = generate-id($courses[1])">
    <h2><xsl:value-of select="$initial"/></h2>
    <ul>
      <xsl:apply-templates select="$courses">
        <xsl:sort select="name" />
      </xsl:apply-templates>
    </ul>
  </xsl:if>
</xsl:template>

<xsl:template match="course">
  <li>
    <xsl:value-of select="name"/>
  </li>
</xsl:template> 
```

outputs:

```
<h2>6</h2>
<ul>
  <li>6500 Training</li>
  <li>6600 Training</li>
</ul>
<h2>A</h2>
<ul>
  <li>Accelerated Training</li>
</ul>
<h2>T</h2>
<ul>
  <li>Training</li>
</ul> 
```

EDIT: For the sake of legibility I left out the upper-casing of the first letter. The correct key would be this (you can't use a variable in a key, hence the literal alphabet strings):

```
<xsl:key name="kInitial" match="course" use="
  translate(
    substring(name, 1, 1), 
    'abcdefghijklmnopqrstuvwxyz', 
    'ABCDEFGHIJKLMNOPQRSTUVWXYZ'
  )
" /> 
```

The same goes of course for the `$initial` variable in the second template, but here you can in fact use variables again.

EDIT #2: Since sorting is case-sensitive as well, you can use the same expression:

```
<xsl:sort select="translate(substring(name, 1, 1), $vLower, $vUpper)" /> 
```

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T18:36:09.193

**An XSLT 2.0 solution**:

```
<xsl:stylesheet version="2.0"
 xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
 <xsl:output method="text"/>

    <xsl:template match="/*">
      <xsl:for-each-group select="course"
           group-by="upper-case(substring(name,1,1))">
        <xsl:sort select="current-grouping-key()"/>

        <xsl:sequence select=
           "concat('&#xA;', current-grouping-key())"/>

        <xsl:for-each select="current-group()">
          <xsl:sort select="upper-case(name)"/>
          <xsl:sequence select="concat('&#xA;&#x9;', name)"/>
        </xsl:for-each>
      </xsl:for-each-group>
    </xsl:template>
</xsl:stylesheet> 
```

**When the above transformation is applied on the originally-provided XML document**:

```
<courses>
    <course>
        <name>Accelerated Training</name>
    </course>
    <course>
        <name>6600 Training</name>
    </course>
    <course>
        <name>Training</name>
    </course>
    <course>
        <name>6500 Training</name>
    </course>
</courses> 
```

**the wanted result is produced** (in text format for simplicity -- producing the Html is left as an exercise for the reader :)

```
6 
    6500 Training 
    6600 Training 
A 
    Accelerated Training 
T 
    Training 
```

**Do note**:

1.  The use of the **[`<xsl:for-each-group>`](http://www.w3.org/TR/xslt20/#element-for-each-group)** XSLT 2.0 instruction

2.  The use of the **[`current-grouping-key()`](http://www.w3.org/TR/xslt20/#dt-current-grouping-key)** and **[`current-group()`](http://www.w3.org/TR/xslt20/#dt-current-group)** XSLT 2.0 functions.

3.  The use of the **[`upper-case()`](http://www.w3.org/TR/xpath-functions/#func-upper-case)** XPath 2.0 function

* * *

## 回答 #3

> 赞同：0
> 
> 时间：2009-04-09T16:32:13.687

好吧，如果您想要任何复杂的东西，数字部分会很棘手，但是根据您的理想输出，您所缺少的只是对 for-each的简单[排序：](http://www.w3schools.com/xsl/el_sort.asp)

```
<xsl:sort select="key('kTitleBy1stLetter', substring(name,1,1))" /> 
```

*警告：我没有声称这是最好的或唯一的或其他方法，只是这完全停止，并使用你已经拥有的。*

# c++ - C++ 空括号成员初始化 - 将内存清零？

> ID：734958
> 
> 赞同：3
> 
> 时间：2009-04-09T16:28:09.687
> 
> 标签：c++, initialization, standards

我最初写了一些这样的代码：

```
class Foo
{
public:
  Foo() : m_buffer()
    {}

private:
  char   m_buffer[1024];
}; 
```

比我聪明的人说拥有 m_buffer() 初始化程序会将内存清零。我的意图是让内存保持未初始化状态。我没有时间进一步讨论它，但它激起了我的好奇心。

以前，我认为总是在初始化列表中列出每个成员是明智的。

有人可以进一步描述这种行为吗？

1）为什么空括号初始化器填充内存？

2) 它仅适用于 POD 数据类型吗？我听说是这样，但手头没有标准。

谢谢

* * *

## 回答 #1

> 赞同：11
> 
> 时间：2009-04-09T16:43:08.043

如果你有一个这样初始化的成员，它将是`value-initialized`. POD 也是如此。对于结构，每个成员都以这种方式进行值初始化，而对于数组，它的每个元素都是值初始化的。

对指针或整数等标量类型进行值初始化，您将对其进行初始化以`0`转换为正确的类型。因此，您将获得空指针或 false 或您具体拥有的任何类型。

Note that the rule changed subtly from C++98 to C++03 (what we have right now), which can have surprising effects. C++98 didn't have that `value-initialization`. It said default initialization happens, which for a non-POD type always meant it's default constructor invokes. But `value-initialization` in C++03 has special meaning if there is no user-declared constructor: Every element is value-initialized then.

Here is the difference:

```
struct A { int c; ~A() { } }; // non-POD, but no user declared ctor
struct B { A a; B():a(){ } } b; 
```

Now, in C++03, you will be guaranteed that `b.a.c` is zero. While in C++98, `b.a.c` will have some indeterminated value.

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T16:34:06.770

> 以前，我认为总是在初始化列表中列出每个成员是明智的。

这是为了确保所有成员都已初始化。

要解决您的任务，只需从初始化列表中删除 m_buffer。

```
template <typename T>
struct C
{
    C():
        buff(),
        var(),
        object()
    {
    }
    T buff[128];
    T var;
    std::string object;
}; 
```

使用 T() 的任何 T 类型都适用于默认构造函数。对于 int、chars 等它是 0，对于数组它是 {T()}。对于类来说，它只是它们的默认构造函数。

# logging - 具有复合滚动样式的 Log4Net RollingFileAppender 正在覆盖数据

> ID：734963
> 
> 赞同：11
> 
> 时间：2009-04-09T16:28:46.083
> 
> 标签：logging, log4net, rollingfileappender

我有一个 Log4Net RollingFileAppender 配置为：

```
<configuration>

  <configSections>
    <section name="log4net" type="log4net.Config.Log4NetConfigurationSectionHandler, log4net"/>
  </configSections>

  <log4net>

    <root>
      <level value="ALL" />
    </root>

    <logger name="RollingFileAppender" additivity="false">
      <level value="DEBUG"/>
      <appender-ref ref="RollingFileAppender" />
    </logger>

    <appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender" >
      <param name="File" value="C:\\MyLog.log" />
      <param name="AppendToFile" value="true" />
      <param name="DatePattern" value="yyyy-MM-dd"/>
      <layout type="log4net.Layout.PatternLayout">
        <param name="ConversionPattern" value="%m%n"/>
      </layout>
    </appender>

  </log4net>

</configuration> 
```

查看[文档](http://logging.apache.org/log4net/release/sdk/log4net.Appender.RollingFileAppender.RollingStyle.html)，**默认滚动样式是 Composite**，所以当它达到一定大小（默认为 10MB）时，它会滚动，而不仅仅是日期。

问题是当它达到大小时，它正在重新启动日志并且我正在丢失前半天的数据（它在中午左右达到这个大小）。
为什么这不只是滚动到一个新文件并将所有未来的日志行放入 MyLog.log 中？还是日志正在滚动，但在午夜，它再次滚动并覆盖过时的日志（例如，一旦达到 10MB，滚动到 MyLog.log2009-04-08，然后在午夜覆盖同一个文件）？

我将设置

```
<rollingStyle value="Date" /> 
```

这是我必须做的所有事情来确保它只在日期边界上滚动吗？我可以在 Log4Net.config 中即时更改它，还是必须重新启动应用程序？它在 IIS6 上运行。

* * *

## 回答 #1

> 赞同：13
> 
> 时间：2009-04-09T16:44:52.643

这是我的设置。它仅在日期滚动：

```
<log4net>
    <appender name="RollingFile" type="log4net.Appender.RollingFileAppender">
        <file value="c:\Logs\Today.log"/>
        <rollingStyle value="Date"/>
        <datePattern value="yyyyMMdd"/>
        <appendToFile value="true"/>
        <layout type="log4net.Layout.PatternLayout">
            <conversionPattern value="%level %logger %date{ISO8601} - %message%newline"/>
        </layout>
    </appender>
    <root>
        <!-- Options are "ALL", "DEBUG", "INFO", "WARN", "ERROR", "FATAL" and "OFF". -->
        <level value="ERROR"/>
        <appender-ref ref="RollingFile"/>
    </root>
</log4net> 
```

对 web.config 的更改将自动重新启动应用程序（因此您将丢失会话等）。

* * *

## 回答 #2

> 赞同：9
> 
> 时间：2009-04-10T04:37:01.107

尝试添加`maxSizeRollBackups`参数`RollingFileAppender`来解决我们一半的问题。这样，当日志文件滚动时，它不会覆盖您的旧日志，而是会将其滚动到另一个文件。

```
<appender name="RollingFileAppender" type="log4net.Appender.RollingFileAppender" >
  <param name="File" value="C:\\MyLog.log" />
  <param name="AppendToFile" value="true" />
  <param name="DatePattern" value="yyyy-MM-dd"/>
  <param name="maxSizeRollBackups" value="10" />
  <layout type="log4net.Layout.PatternLayout">
    <param name="ConversionPattern" value="%m%n"/>
  </layout>
</appender> 
```

# c# - 项目过期的 C# 集合

> ID：734965
> 
> 赞同：2
> 
> 时间：2009-04-09T16:29:36.003
> 
> 标签：c#, data-structures, caching

我正在用 C# 编写一个控制台应用程序，我想在其中将某些项目缓存一段预定义的时间（比如说 1 小时）。我希望已添加到此缓存中的项目在过期后自动删除。是否有我可以使用的内置数据结构？请记住，这是控制台应用程序而不是 Web 应用程序。

* * *

## 回答 #1

> 赞同：6
> 
> 时间：2009-04-09T16:52:04.437

它已经在 BCL 中。它只是不在您期望的位置：您也可以从其他类型的应用程序中使用 System.Web.Caching，而不仅仅是在 ASP.NET 中。

[这个在谷歌上的搜索链接到几个关于这个的资源。](http://www.google.com/search?client=safari&rls=nb-no&q=system.web.caching+winforms&ie=UTF-8&oe=UTF-8)

* * *

## 回答 #2

> 赞同：6
> 
> 时间：2009-04-09T16:40:10.843

您当时真的需要将它们从缓存中删除吗？或者只是未来对该项目的缓存请求应该在给定时间后返回 null ？

要执行前者，您将需要某种定期清除缓存的后台线程。仅当您担心内存消耗或其他问题时才需要这样做。如果你只是想让数据过期，那很容易做到。

创建这样一个类是微不足道的。

```
class CachedObject<TValue> 
{ 
 DateTime Date{get;set;}
 TimeSpan Duration{get;set;}
 TValue Cached{get;set;}
}

class Cache : Dictionary<TKey,TValue>
{
  public new TValue this(TKey key)
  {
    get{
    if (ContainsKey(key))
    {
       var val = base.this[key];
       //compare dates
       //if expired, remove from cache, return null
       //else return the cached item.
    }
    }

    set{//create new CachedObject, set date and timespan, set value, add to dictionary}

  } 
```

* * *

## 回答 #3

> 赞同：3
> 
> 时间：2009-04-09T16:33:47.367

我不知道 BCL 中有任何对象可以执行此操作，但我之前写过类似的东西。

您只需在缓存类中包含一个 System.Threading.Timer（没有 web/winforms 依赖项），并在对象上存储过期（或上次使用）时间，就可以相当容易地做到这一点。只需让计时器每隔几分钟检查一次，然后删除要过期的对象即可。

但是，请注意对象上的事件。我有一个这样的系统，并且没有非常小心地取消订阅缓存中我的对象上的事件，这防止了随着时间的推移微妙但令人讨厌的内存泄漏。这可能非常难以调试。

* * *

## 回答 #4

> 赞同：3
> 
> 时间：2009-04-09T16:51:03.830

在您将缓存的对象中包含一个 ExpirationDate 属性（可能是您真实对象的包装器），并在其构造函数中将其设置为在一小时内到期。不是从集合中删除项目，而是通过过滤掉过期项目的方法访问集合。或者创建一个自动执行此操作的自定义集合。如果您需要实际从缓存中删除项目，则您的自定义集合可以在每次调用其成员之一时清除过期项目。

# python - Python：从字符串中引用类？

> ID：734970
> 
> 赞同：4
> 
> 时间：2009-04-09T16:29:49.607
> 
> 标签：python

如何使用包含类名的字符串来引用类本身？
看到这个（不工作）的例子......

```
class WrapperClass:
    def display_var(self):
        #FIXME: self.__class_name__.__name__ is a string
        print self.__class__.__name__.the_var

class SomeSubClass(WrapperClass):
    var = "abc"

class AnotherSubClass(WrapperClass):
    var = "def" 
```

还有一个明显的错误信息：

```
>>> b = SomeSubClass()
>>> b.display_var()
回溯（最近一次通话最后）：
  文件“”，第 1 行，在
  文件“”，第 4 行，在 display_var 中
AttributeError：“str”对象没有属性“the_var”
>>>

```

谢谢！

* * *

## 回答 #1

> 赞同：9
> 
> 时间：2009-04-09T16:46:09.613

> 如何使用包含类名的字符串来引用类本身？

类并不特殊，它们只是包含在变量中的值。如果你说过：

```
class X(object): pass 
```

在全局范围内，变量“X”将是对类对象的引用。

您可以使用 'globals()' 将当前脚本/模块的全局变量作为字典获取，因此：

```
classobj= globals()[self.__class__.__name__]
print classobj.var 
```

（`locals()`也可用于局部变量；在它们之间，您永远不需要使用可怕`eval()`的变量来访问变量。）

然而正如大卫所说，`self.__class__`已经*是*，`classobj`所以没有必要通过名称从全局变量中获取它；`self.__class__.var`很好。虽然真的：

```
print self.var 
```

将是通常的简单方法。类成员可以作为其实例的成员使用，只要该实例没有用其他东西覆盖名称。

* * *

## 回答 #2

> 赞同：3
> 
> 时间：2009-04-09T16:36:52.130

根据您获得此字符串的位置，任何通用方法都可能不安全（一种方法是简单地使用`eval(string)`. 最好的方法是定义一个 dict 映射名称到类：

```
class WrapperClass:
    def display_var(self):
        #FIXME: self.__class_name__.__name__ is a string
        print d[self.__class__.__name__].the_var

class SomeSubClass(WrapperClass):
    the_var = "abc"

class AnotherSubClass(WrapperClass):
    the_var = "def"

d = {'WrapperClass': WrapperClass, 'SomeSubClass': SomeSubClass, 'AnotherSubClass': AnotherSubClass}
AnotherSubClass().display_var()
# prints 'def' 
```

* * *

## 回答 #3

> 赞同：2
> 
> 时间：2009-04-09T16:33:35.697

如果你打电话给你，你的例子会起作用`print self.__class__.var`。我认为没有必要使用这个名字。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2020-03-17T04:12:33.203

存在这样一种情况，即有一个类的名称，但没有对它的引用。tkinter Entry 小部件有一个 validate 方法，该方法返回回调函数（%W 参数）小部件的名称，而不是对其的引用。如果您有一个带有一组条目字段的窗口，则为每个条目使用不同的回调函数是不方便的。将字符串名称转换为回调函数中的引用是将回调关联到 validate 事件源的更有效方法。我会评论德文的回答，但还没有声誉点来发表评论。

# asp.net - 将 Sybase 数据拉入 SQL Server

> ID：734972
> 
> 赞同：1
> 
> 时间：2009-04-09T16:30:34.953
> 
> 标签：asp.net, sql-server, sap-ase

我有一个使用 SQL Server 数据库的 ASP.NET 应用程序。我现在需要将 Sybase ASE 中的数据提取到该 SQL Server 数据库中以供我的应用程序使用，但我的想法没有任何成功。

有人做过吗？任何想法/建议/提示？

* * *

## 回答 #1

> 赞同：4
> 
> 时间：2009-04-09T16:53:35.600

您可以配置从 SQL Server 到 Sybase 的链接服务器。在 MS 端使用 Sybase 提供程序应该是相当普通的。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-14T23:59:35.113

好的，我终于（通过蹩脚的试验和错误）找到了如何将我的 Sybase ASE (12.5) 服务器链接到我的 SQL Server (2008)，这将允许我想要的集成。我大致是这样做的：

*   登录到 Sybase ASE OLE DB 配置管理器（这类似于 Windows 的 ODBC 数据源的 Sybase 版本）并添加了一个 OLE DB 数据源。我相信您必须是 PC 上的管理员才能执行此操作。
*   在 SQL Server 2008 Management Studio 中，转到服务器对象 > 链接服务器。右键单击并选择“新建链接服务器”。
*   在链接服务器属性中，我设置了以下属性：
*   一般的：
*   --链接服务器：您希望它出现在链接服务器列表中的链接服务器的名称
*   --Provider：从下拉列表中选择*Sybase ASE OLE DB Provider 。*
*   --产品名称：您刚刚在 Sybase ASE OLE DB 配置管理器中创建的 OLD DB 数据源的确切名称。
*   --数据来源：与产品名称相同。
*   --提供者字符串：我把这个留空
*   --位置：我把这个留空
*   --Catalog：要登录的默认数据库（主数据库或其他数据库）。
*   安全：
*   --您需要将有效的 SQL Server 登录映射到有效的 Sybase 登录。我没有使用模拟（通过凭据传递）。
*   --我选择了我的连接*不使用安全上下文*。
*   服务器选项：
*   --所有默认值都对我有用。

自始至终，标准 SQL Server 帮助作为指南都非常有效。虽然并非总是如此，但 F1 是我在这里的朋友。

我现在可以进行分布式查询、DTS 或 SSIS 包，并使用 SSRS。这大大减少了 Sybase ASE 的负担。

当然以上可以通过命令行使用 sp_linkserver 来完成，但是 GUI 对于像我这样的低级开发人员来说更舒服。

* * *

## 回答 #3

> 赞同：1
> 
> 时间：2009-04-09T16:55:54.223

使用 Management Studio 或 Enterprise Manager 通过数据导入向导导入数据。应该就是这样，只要确保您在向导中选择了正确的数据提供者，您就可以开始了。

如果您希望这是一个实时提要，请创建一个小型 Windows 服务来管理信息交换。做起来应该相对简单，只需要一点点腿功就可以了。如果您对此持反对意见，那么有很多现成的解决方案可以为您做到这一点。

* * *

## 回答 #4

> 赞同：0
> 
> 时间：2009-04-09T17:36:52.813

这个问题在细节上有点模糊：

*   这是一次转换还是重复过程的一部分。
*   源计算机是否可以从您的目标计算机“访问”（您可以将两者连接起来还是需要读取文件）

大多数转换有两个部分：

*   物理地将数据从源获取到目标。
*   将数据从源表映射到目标表。

如果没有更多信息，很难提出任何建议。如果您需要每天一整天都读取数据，那么一次性转换就行不通了。此外，如果无法连接到源数据库并且您必须传递文件，则它们的方法会更改。

# c# - ShowDialog、PropertyGrid 和 Timer 问题

> ID：734978
> 
> 赞同：1
> 
> 时间：2009-04-09T16:32:09.663
> 
> 标签：c#, winforms, timer, propertygrid, showdialog

我有一个奇怪的错误，请让我知道您是否有任何关于原因的线索。

我的主窗体上有一个`Timer`( `System.Windows.Forms.Timer`)，它会触发一些更新，最终也会更新主窗体 UI。`ShowDialog()`然后我有一个编辑器，它是使用该方法从主窗体打开的。在这个编辑器上，我有一个`PropertyGrid`( `System.Windows.Forms.PropertyGrid`)。

我无法每次都重现它，但是通常，当我在编辑器中使用该属性网格上的下拉菜单时，它会卡住，即确定/取消按钮不会关闭表单，属性网格变得不可用，表单中的关闭按钮标题不起作用。

后台没有例外，如果我中断该过程，我会看到该应用程序正在执行与我在开头提到的更新相关的一些计算。

你能推荐什么？欢迎任何想法。

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T17:50:01.223

发生的事情是线程计时器的 Tick 方法不会在不同的线程上执行，因此它会锁定其他所有内容，直到完成。我制作了一个测试 winforms 应用程序，上面有一个计时器和 2 个按钮，其事件执行以下操作：

```
private void timer1_Tick(object sender, EventArgs e)
{
    Thread.Sleep(6000);
}

private void button1_Click(object sender, EventArgs e)
{
    timer1.Start();
}

private void button2_Click(object sender, EventArgs e)
{
    frmShow show = new frmShow();
    show.ShowDialog(); // frmShow just has some controls on it to fiddle with
} 
```

确实如您所描述的那样被阻塞了。以下解决了它：

```
private void timer1_Tick(object sender, EventArgs e)
{
    ThreadPool.QueueUserWorkItem(DoStuff);
}

private void DoStuff(object something)
{
    Thread.Sleep(6000);
} 
```

# sql-server - SQL Server 编译锁？

> ID：734987
> 
> 赞同：0
> 
> 时间：2009-04-09T16:34:04.527
> 
> 标签：sql-server, database, locking

SQL Server 2000 在这里。

我想成为一名临时 DBA，但对数据库服务器的机制了解不多，所以我有点卡住了。有一个客户端进程同时访问三个视图。这三个视图查询远程服务器以拉回数据。

看起来这些查询中的一个可以工作，但另外两个失败（客户端进程说它超时，所以我猜一个锁可以做到这一点）。查询进程有一个锁定，直到 SQL 进程重新启动（我有胆量并试图杀死 spid 一次，但它不会放手）。锁定后对该数据库的任何查询都会挂起，并责怪第一个进程阻塞它。

该过程报告了这些锁......（对格式化表示歉意，预览功能将其显示为完全排列）。

```
spid    dbid  ObjId       IndId   Type    Resource        Mode    Status
53    17    0           0       DB                      S       GRANT
53    17    1445580188  0       TAB                     Sch-S   GRANT
53    17    1445580188  0       TAB     [COMPILE]       X       GRANT 
```

这个我也不好分析。对象 1445580188 是 sp_bindefault，master 中的系统存储过程。它挂在独占锁上是为了什么？

查看代码，以保护专有...我只更改了名称（它们与别名和诸如此类的东西保持一致）并试图保持其他一切完全相同。

```
 SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO

ALTER view [dbo].[theView] 
as
select 
    a.[column1] column_1    
    ,b.[column2] column_2
    ,[column3]
    ,[column4]
    ,[column5]
    ,[column6]
    ,[column7]
    ,[column8]
    ,[column9]
    ,[column10]
    ,p.[column11]
    ,p.[column12]
FROM 
    [remoteServer].db1.dbo.[tableP] p
    join [remoteServer].db2.dbo.tableA a on p.id2 = a.id
    join [remoteServer].db2.dbo.tableB b on p.id = b.p_id
WHERE 
    isnumeric(b.code) = 1

GO

SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER ON
GO 
```

* * *

## 回答 #1

> 赞同：1
> 
> 时间：2009-04-09T17:29:21.210

对象 1445580188 是*master*数据库中的 sp_bindefault，不是吗？此外，它显示资源 = "TAB" = 表。

```
USE master
SELECT OBJECT_NAME(1445580188), OBJECT_ID('sp_bindefault')

USE mydb
SELECT OBJECT_NAME(1445580188) 
```

如果第二个查询返回 NULL，则该对象是一个工作表。

我猜这是为了在本地处理结果而生成的工作表。JOIN 将在本地发生，并且所有数据都必须拉过。

现在，我无法解释编译锁：视图应该已经编译过了。这因远程服务器访问而变得复杂，我对编译锁的体验都与存储过程有关。

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T16:46:38.910

看看[这个链接](http://support.microsoft.com/kb/263889)。您确定是阻塞的视图而不是存储过程吗？要找出答案，请使用上面表格中的 ObjId 运行下面的查询。您可以采取一些措施来减轻存储过程的重新编译。最重要的是避免使用“sp_”前缀命名您的存储过程，请参阅第 10 页的[这篇文章](http://www.quest.com/sql_server/pdfs/Stored-Procedure-BP.pdf)。同时避免在代码中使用 if/else 分支，而是使用带有 case 语句的 where 子句。我希望这有帮助。

**[编辑]：**

我相信 sp_binddefault/rule 与用户定义类型 (UDT) 结合使用。您的观点是否参考了任何 UDT？

```
SELECT * FROM sys.Objects where object_id = 1445580188 
```

# delphi - Delphi - 使用 TApplicationEvents OnShortCut 事件检测 Alt+C 按键

> ID：734990
> 
> 赞同：5
> 
> 时间：2009-04-09T16:34:46.537
> 
> 标签：delphi, vcl

我正在使用 TApplicationEvents OnShortCut 事件在 Delphi 程序中获取应用程序键盘快捷键。

使用以下代码：

```
procedure TForm1.ApplicationEvents1ShortCut(var Msg: TWMKey; var Handled: Boolean) ;
begin
   if (Msg.CharCode = VK_F9) then
   begin
     ShowMessage('F9 pressed!') ;
     Handled := True;
   end;
end; 
```

问题：

如何检测何时按下“ALT C”？

* * *

## 回答 #1

> 赞同：10
> 
> 时间：2009-04-09T17:26:16.473

像这样：

```
procedure TForm1.ApplicationEvents1ShortCut(var Msg: TWMKey;
  var Handled: Boolean);
begin
  if (Msg.CharCode = Ord('C'))
    and (HiWord(Msg.KeyData) and KF_ALTDOWN <> 0)
  then begin
    ShowMessage('Alt+C pressed!') ;
    Handled := TRUE;
  end;
end; 
```

请注意，仅使用 Alt 和某些键不是快捷方式的错误选择，因为系统使用它们来激活菜单项或对话框控件。

* * *

## 回答 #2

> 赞同：2
> 
> 时间：2009-04-09T18:07:10.760

或者你可以创建简单的 TAction，他们比其他人先吃捷径。

# c++ - 如何将结构的 C++/CLI 数组编组为非托管 C++

> ID：734996
> 
> 赞同：1
> 
> 时间：2009-04-09T16:37:00.820
> 
> 标签：c++, interop, unmanaged, managed

我正在寻找将结构数组传递给非托管 C++ dll 的正确语法。

我的 dll 导入是这样调用的

```
 #define _DllImport [DllImport("Controller.dll", CallingConvention = CallingConvention::Cdecl)] static
_DllImport bool _Validation(/* array of struct somehow */); 
```

在我的客户代码中，我有

```
List<MyStruct^> list;
MyObject::_Validation(/* list*/); 
```

我知道 System::Runtime::InteropServices::Marshal 有很多有用的方法来做这样的事情，但我不确定该使用哪个。

* * *

## 回答 #1

> 赞同：3
> 
> 时间：2009-04-09T17:14:48.950

使用 StructLayout.Sequential 创建非托管结构的托管版本（确保以相同的顺序放置）。然后，您应该能够像将其传递给任何托管函数（例如，Validation(MyStruct[] pStructs) 一样传递它。

例如，假设我们的原生函数有这个原型：

```
extern "C" {

STRUCTINTEROPTEST_API int fnStructInteropTest(MYSTRUCT *pStructs, int nItems);

} 
```

而原生的 MYSTRUCT 定义如下：

```
struct MYSTRUCT
{
    int a;
    int b;
    char c;
}; 
```

然后在 C# 中，定义结构的托管版本，如下所示：

```
[System.Runtime.InteropServices.StructLayoutAttribute(System.Runtime.InteropServices.LayoutKind.Sequential)]
public struct MYSTRUCT
{
    public int a;
    public int b;
    public byte c;
} 
```

托管原型如下：

```
 [System.Runtime.InteropServices.DllImportAttribute("StructInteropTest.dll", EntryPoint = "fnStructInteropTest")]
    public static extern int fnStructInteropTest(MYSTRUCT[] pStructs, int nItems); 
```

然后，您可以调用该函数，并传递一个 MYSTRUCT 结构数组，如下所示：

```
 static void Main(string[] args)
    {
        MYSTRUCT[] structs = new MYSTRUCT[5];

        for (int i = 0; i < structs.Length; i++)
        {
            structs[i].a = i;
            structs[i].b = i + structs.Length;
            structs[i].c = (byte)(60 + i);
        }

        NativeMethods.fnStructInteropTest(structs, structs.Length);

        Console.ReadLine();
    } 
```

* * *

## 回答 #2

> 赞同：1
> 
> 时间：2009-04-09T16:49:29.997

您可以使用[Marshall.StructureToPtr](http://msdn.microsoft.com/en-us/library/system.runtime.interopservices.marshal.structuretoptr.aspx)来获取一个 IntPtr，该 IntPtr 可以传递到本机 MyStruct* 数组中。

但是，我不确定如何直接从列表中执行此操作。我相信您需要将其转换为数组并使用 pin_ptr （以防止 GC 移动您的内存），然后再将其传递给本机代码。**********